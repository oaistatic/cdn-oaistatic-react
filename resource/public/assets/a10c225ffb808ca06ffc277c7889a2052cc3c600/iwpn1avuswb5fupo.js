var mt=Object.freeze,gt=Object.defineProperty,ae=Object.defineProperties;var ie=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var xt=Object.prototype.hasOwnProperty,Ct=Object.prototype.propertyIsEnumerable;var Et=(t,e,o)=>e in t?gt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,A=(t,e)=>{for(var o in e||(e={}))xt.call(e,o)&&Et(t,o,e[o]);if(q)for(var o of q(e))Ct.call(e,o)&&Et(t,o,e[o]);return t},P=(t,e)=>ae(t,ie(e));var I=(t,e)=>{var o={};for(var n in t)xt.call(t,n)&&e.indexOf(n)<0&&(o[n]=t[n]);if(t!=null&&q)for(var n of q(t))e.indexOf(n)<0&&Ct.call(t,n)&&(o[n]=t[n]);return o};var rt=(t,e)=>mt(gt(t,"raw",{value:mt(e||t.slice())}));import{r as x,b as wt,j as i,m as D,A as X,at as le}from"./jj85rqzpbnvv3emr.js";import{eD as ce,bb as ue,vw as fe,nX as w,nY as H,vx as bt,vy as kt,aq as de,ar as pe,k1 as he,uY as me,j$ as Ee,k0 as ge,oe as xe}from"./mclphevd122040jw.js";import{k as Y,i as _,e as Ce,c as B,f as Mt,w as be,x as _t,y as ye,z as jt,E as ve,A as Te}from"./erm6n5lmbxodgs50.js";import{C as yt}from"./kq1ir6pxp9hst9p9.js";import{T as Dt,Z as K}from"./nfygy4vif6crzpny.js";import{u as W,i as tt,d as Se}from"./m1gt25yur8ncekq0.js";import{cX as J,i as Le,O as Ne,e as j,lW as Ae,cu as Bt,dI as Oe,x as It,e$ as lt,iD as Pe,aV as et,dR as Rt,aN as we,dQ as ke,dT as Me,dS as Yt,a_ as _e,F as Gt,be as je}from"./lef5ym39glv4981l.js";import{p as Ht,q as Vt,a as De}from"./dbde1xv38cr6eaxy.js";import{P as Be,H as Ie}from"./em4qf21fn7t7dhqg.js";import{E as at,h as Re,G as M,c as vt}from"./g9xi6m5yzu4rtfn2.js";import{u as ot}from"./lbaueofbjv8jfqwm.js";import{S as Ye}from"./bw8gyicptzfjwyk2.js";import{i as Ge}from"./hzcock7l6ec8fnr2.js";var R=(t=>(t[t.up=-1]="up",t[t.down=1]="down",t))(R||{}),Q=(t=>(t.COMMENT="comment",t.COMPOSER="composer",t))(Q||{}),O=(t=>(t.COLLAPSED="collapsed",t.EXPANDED="expanded",t))(O||{});const Xt=([t,e],[o,n])=>{const s=t+e,r=o+n;return t<r&&o<s},ct=([t,e])=>t+e,V=t=>{var r;if(t.type===O.COLLAPSED)return[(r=t.offsetY)!=null?r:0,0];const{offsetY:e,shiftY:o=0,height:n=0}=t,s=e+o;return o<0?[s,n+Math.abs(o)]:[s,n]},He=(t,e,o)=>{if(!Xt(t,e))return null;const[n,s]=t,r=n+s,[a,c]=e,l=a+c,f=a-r,h=l-n;return o===R.up?f:h};var Kt=(t=>(t.ABOVE="above",t.BELOW="below",t))(Kt||{});function z(t,e){return J(t.coordsAtPos(e))}const Tt=360,Ve=250,Ft=44,Xe=.5,Ke=[.5,.9,1],Fe=[1,.75,.2],Ue=({onClose:t,onSubmit:e,opensOverDocument:o=!1,opensFromGutter:n=!1,gutterHasComments:s=!1},r)=>{const a=Le(),c=wt(),l=x.useRef(null),f=x.useRef(!1),[h,E]=x.useState(""),[u,m]=x.useState(!0),p=()=>{document.hasFocus()&&(E(""),t==null||t(f.current))},y=(d,v=h)=>{f.current=!0,e==null||e(d,v),E("")},C=Ne(()=>o?ce(a).width<Tt+100?Ve:Tt:at),g={};n&&(g.top=-12),o&&n?g.right=0:g.left=0;let b="";n&&!o?b="8px 50%":n&&o?b="calc(100% + 8px) 50%":o&&(b="center left");let L=0;n&&!o&&s&&(L=Re);const T=d=>{const{metaKey:v,shiftKey:k,key:N}=d;N==="Enter"&&!d.nativeEvent.isComposing&&h&&!(k||v)?(y(d),d.preventDefault()):N==="Escape"&&(E(""),t==null||t(!1))},S=c.formatMessage({id:"VvfbvY",defaultMessage:"Edit or explain..."});return i.jsx(D.div,{ref:ue(l,r),className:j("absolute flex items-center",K.commentComposer),style:P(A({},g),{minHeight:Ft}),transition:{type:"spring",bounce:.18,duration:.48},initial:{translateX:0},animate:{translateX:L},exit:{translateX:0},children:i.jsx(D.div,{className:j("no-scrollbar border-token-border-default relative z-10 flex items-center overflow-x-hidden border",Dt,{"rounded-full":u,"rounded-2xl":!u}),initial:{width:o?at:24,scale:o?void 0:Xe},animate:{width:C,scale:o?void 0:Ke},exit:{filter:"blur(16px)",scale:o?void 0:Fe,width:o?at:24,opacity:o?0:[1,1,0]},transition:{type:"spring",bounce:o?.14:0,duration:.28,scale:{type:"tween",duration:.2},opacity:{type:"tween",time:[0,.95,1]}},style:{transformOrigin:b},children:i.jsxs(D.div,{className:"bg-token-main-surface-primary relative z-0 flex w-full items-center px-4 py-2.5",children:[i.jsx(D.div,{className:"absolute inset-0 z-[-1] bg-gray-50/75 backdrop-blur-3xl backdrop-saturate-25 dark:bg-gray-700/75",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.2}}),i.jsx(Ge,{"aria-placeholder":S,value:h,className:"text-token-text-primary placeholder:text-token-text-secondary w-full resize-none border-0 bg-transparent px-1 py-0 pe-2 outline-0 focus:ring-0 focus-visible:ring-0",autoFocus:!0,maxRows:4,onBlur:p,onHeightChange:(d,{rowHeight:v})=>{m(Math.floor(d/v)<=1)},onChange:({target:{value:d}})=>E(d),onKeyDown:T}),!h&&i.jsx("span",{"aria-hidden":!0,className:"text-token-text-secondary absolute inline-block ps-1 text-nowrap",children:S}),i.jsx(D.button,{className:j("-me-1.5 h-6 w-6 rounded-full bg-black text-center dark:bg-white",{"self-end":!u}),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.1},onMouseDown:d=>y(d),children:i.jsx(fe,{className:"h-6 w-6 text-white dark:text-black"})})]})})})},Ut=x.forwardRef(Ue),ze=(t,e)=>{if((e==null?void 0:e.type)!==Y.SELECTION)return null;try{const{from:o,to:n}=e,{top:s}=t.dom.getBoundingClientRect(),{bottom:r,top:a}=z(t,o),{bottom:c}=z(t,n),l=tt(t)?-30:-24;let f=r-s+l;const h=a-s;return f=c-s+8,{composerTop:f,loadingTop:h}}catch(o){return w.logError("Invalid position in SelectionCommentComposer",o),null}},We=({toolbarPosition:t,composerRect:e,view:o})=>{const{width:n}=e;let{height:s}=e;if(s||(s=Ft),o==null||t==null)return null;const{right:r,left:a}=o.dom.getBoundingClientRect(),{left:c,top:l,aboveOrBelow:f,toolbarSize:h}=t,E=l-(f===Kt.ABOVE&&s!==0?s-h.height:0),u=Se(o)?12:0;return{left:Math.min(c,r-a-n-u),composerTop:E,aboveOrBelow:f}},$e=({toolbarPosition:t,commentingOn:e,isWaitingForCommentResponse:o=!1,onAddComment:n})=>{const s=W()(),[r,a]=ot(),c=We({view:s,toolbarPosition:t,composerRect:r});if(s==null||c==null)return null;const{left:l,composerTop:f}=c,h=(E,u)=>{if((e==null?void 0:e.type)!==Y.SELECTION)return;const{action:m,sourceRange:p}=e;n==null||n(E,u,m,p,e.type)};return i.jsx(X,{children:(e==null?void 0:e.type)===Y.SELECTION&&!o&&i.jsx("div",{className:j("absolute",K.commentComposer),style:{left:l,top:f},children:i.jsx(Ut,{opensOverDocument:!0,onClose:E=>{var u;E||(_.cancelCommentingOn(),s&&tt(s)&&!s.state.selection.empty&&s.dispatch(s.state.tr.setSelection(new Ae(s.state.selection.$from))),(u=document.getSelection())==null||u.removeAllRanges())},onSubmit:h,ref:a})},"composer")})};function qe(t,e,o){const n=t+e;for(const s of o.values()){const r=s.start,a=s.end;if(t<a&&r<n)return!0}return!1}const Ze=50,Je=200,Qe=[Be.proseMirrorNodeName(),Ie.proseMirrorNodeName()],to=t=>t?t.isBlock:!1,eo=t=>{if(!t)return!1;const{isBlock:e,type:{name:o}}=t;return e&&Qe.includes(o)},oo=(t,e,o,n)=>{const s=t.posAtCoords({left:e,top:o});if(s==null)return;const{pos:r,inside:a}=s;if(a===-1)return;const{state:c}=t;let l=r,f=c.doc.nodeAt(l);for(;!to(f)&&l>=0;)l--,f=c.doc.nodeAt(l);if(!f||!eo(f))return;const h=n!=null&&qe(l,f.nodeSize,n);return{node:f,nodeHasComment:h,pos:l}};function no(t,e,o){const n=oo(t,e.x,e.y,o);if(n==null)return null;const{node:s,pos:r,nodeHasComment:a}=n,{top:c}=t.coordsAtPos(0);function l(){const m=r+1;if(De(t.state.doc,m)){const p=t.state.doc.nodeAt(m);if(p!=null&&p.isText)return t.coordsAtPos(m).top}return t.coordsAtPos(r).top}const f=l(),h=f-c;return{height:t.coordsAtPos(r+s.nodeSize-1).bottom-f,nodeHasComment:a,mouseEnteredAt:Date.now(),yOffset:h,pos:r}}function so(t){var E;const e=x.useRef(!1),o=x.useRef(!1),[n,s]=x.useState(null),r=Ce(),a=(E=r())==null?void 0:E.dom,c=x.useRef(!1),l=B(({visibleBlockCommentLauncher_DEBUG_ONLY:u})=>u),f=x.useCallback(Bt(u=>{var v;e.current=!0;const{commentingOn:m}=B.getState();if(o.current||m!=null)return;const p=r();if(p==null||!e.current)return s(null);const{dom:y,state:C}=p,g=(v=Ht(Vt,C))==null?void 0:v.positions;if(g==null)return s(null);const b=no(p,u,g);if(b==null||b.nodeHasComment&&t===M.COLLAPSED){s(null);return}if(c.current&&b.yOffset!==(n==null?void 0:n.yOffset)){s(null);return}const L=p.coordsAtPos(0),T=y.getBoundingClientRect().width,d=(u.x-L.left)/T>=Ze/100;s(d?b:null)},Je),[r,c,n]);x.useEffect(()=>{if(a!=null)return Oe(a,{mouseenter:()=>{e.current=!0,o.current=!1},mouseleave:({relatedTarget:u})=>{if(f.cancel(),u instanceof HTMLElement&&u.closest("[data-block-comment-launcher]")){o.current=!0;return}o.current=!1,e.current=!1,B.getState().commentingOn==null&&s(null)},mousemove:f})},[r,a,t,f]);const h=x.useCallback(({relatedTarget:u})=>{const{commentingOn:m}=B.getState();m==null&&u!==a&&(o.current=!1,s(null))},[a]);return{visibleBlockComment:l!=null?l:n,handleMouseLeave:h,onComposerVisibleChange:u=>{c.current=u}}}const ro=({isWaitingForCommentResponse:t=!1,opensOverDocument:e=!1,hasComments:o=!1,activeBlockComment:n,composerRef:s,onLaunchComposer:r,onMouseLeave:a,onSubmit:c})=>{const[l,f]=x.useState(!1),{yOffset:h,height:E,pos:u}=n,m=()=>{f(!0),r==null||r(),w.logButtonClick(H.BLOCK_COMMENT_LAUNCHER),_.startCommentingOn({type:Y.BLOCK,pos:u})},p=g=>{g||(f(!1),_.cancelCommentingOn())},y=(g,b)=>{f(!1),c==null||c(g,b)};x.useEffect(()=>()=>{_.mouseLeaveBlock()},[]);const C=o&&l?e?-88:88:0;return i.jsx(D.div,{className:j("pointer-events-auto absolute flex h-6 w-5 origin-[14px_50%] items-start after:absolute after:-inset-4 after:content-['']",K.commentComposer),initial:!1,animate:{opacity:1},exit:{opacity:0},transition:{type:"spring",duration:.2,bounce:.1},style:{top:0,height:E,translateY:h},onMouseLeave:a,"data-block-comment-launcher":!0,children:i.jsxs(X,{children:[l?i.jsx(Ut,{ref:s,opensFromGutter:!0,onClose:p,onSubmit:y,gutterHasComments:o,opensOverDocument:e},"composer"):null,i.jsx(D.button,{initial:{opacity:0},animate:{opacity:l?0:1,translateX:C},transition:{duration:.15,translateX:{type:"spring",bounce:.18,duration:.48}},className:"group absolute z-10 flex h-6 gap-1 bg-transparent after:absolute after:-inset-y-4 after:-right-4 after:-left-1 after:content-['']",onClick:m,onMouseEnter:()=>_.mouseEnterBlock(u),onMouseLeave:()=>_.mouseLeaveBlock(),disabled:l||t,children:i.jsx(be,{isLoading:t})},"launcer")]})})},ao=({isWaitingForCommentResponse:t=!1,isRequestActive:e=!1,hasComments:o=!1,composerRef:n,gutterMode:s,onAddComment:r})=>{const a=Mt(),{visibleBlockComment:c,handleMouseLeave:l,onComposerVisibleChange:f}=so(s),h=(E,u)=>{if(!c||!a)return;const{doc:m}=a,{pos:p}=c,y=m.nodeAt(p);if(!y)return;const{attrs:{start:C,end:g}}=y;r==null||r(E,u,_t.ASK,{start:C,end:g},Y.BLOCK)};return i.jsx(X,{onExitComplete:()=>f(!1),children:c&&a&&(t||!e)&&i.jsx(ro,{composerRef:n,isWaitingForCommentResponse:t,opensOverDocument:s===M.COLLAPSED,activeBlockComment:c,hasComments:o,onSubmit:h,onMouseLeave:l,onLaunchComposer:()=>f(!0)},"launcher")})},io=({onAcceptComment:t,onDismissComment:e,disableActions:o=!1,entry:n,isGutterCollapsed:s=!1,isHovered:r=!1,isFocused:a=!1,isSomeCommentFocused:c=!1})=>{const{offsetY:l,type:f}=n,[h,E]=le();let u=null;if(f===O.COLLAPSED)u=!a&&i.jsx(ye,{offsetY:l,count:n.count,onClick:()=>{w.logButtonClick(H.COLLAPSED_COMMENT),_.focusComment(n.children[0])}},"collapsed");else{const{comment:m}=n;if(m==null||m.content===""||m.status===bt.DISMISSED)u=null;else if(m.status===bt.ACCEPT_INITIATED)u=i.jsx("div",{className:"absolute",style:{top:l},children:i.jsx(jt,{})},"loading");else{const{id:p}=m;u=i.jsx(ve,{isSomeCommentFocused:c,isHovered:r,isFocused:a,offsetY:l,disableActions:o,onClick:()=>{w.logButtonClick(H.EXPANDED_COMMENT),_.focusComment(p)},onMouseEnter:()=>_.mouseEnterComment(p),onMouseLeave:()=>_.mouseLeaveComment(),comment:m,onAccept:y=>{w.logButtonClick(H.COMMENT_ACCEPT,{commentId:p}),t==null||t(y,p)},onDismiss:()=>{w.logButtonClick(H.COMMENT_DISMISS,{commentId:p}),e==null||e(p)},opensOverDocument:s},"expanded")}}return i.jsx(X,{onExitComplete:()=>E==null?void 0:E(),children:h&&u})},St=({onMeasureHeight:t,comment:e,isFocused:o=!1})=>{const[{height:n},s]=ot();return It(()=>{t==null||t(n)},[n]),i.jsx(Te,{ref:s,comment:e,isFocused:o,disableAnimations:!0})},lo=({comments:t,onMeasure:e,getStableCommentId:o})=>{const n=x.useRef(new Map),s=x.useRef(new Map),r=x.useRef(null),a=(c,l,f=!1)=>{l&&(f?s.current.set(o(c),l):n.current.set(o(c),l),r.current&&cancelAnimationFrame(r.current),r.current=requestAnimationFrame(()=>{e==null||e({focusedHeights:new Map(s.current),heights:new Map(n.current)}),r.current=null}))};return t!=null&&t.length?i.jsxs("div",{className:"pointer-events-none invisible fixed start-0 top-0 overflow-clip","aria-hidden":"true",children:[t.map(c=>i.jsx(St,{comment:c,onMeasureHeight:l=>a(c.id,l)},o(c.id))),t.map(c=>i.jsx(St,{isFocused:!0,comment:c,onMeasureHeight:l=>a(c.id,l,!0)},"".concat(o(c.id),"-focused")))]}):null},Lt=(t,e,o)=>{let n=o+e;for(;e===R.down?n<t.length:n>-1;){const s=t[n],r=t[n-e],a=He(V(s),V(r),e);if(a!=null&&s.type!==O.COLLAPSED)s.shiftY+=a;else break;n+=e}},Nt=(t,e)=>{for(const o of e){const{index:n,amount:s}=o,r=t[n];r.type===O.EXPANDED&&(r.shiftY+=s),Lt(t,R.down,n),Lt(t,R.up,n);for(const a of t)a.type!==O.COLLAPSED&&(a.offsetY+=a.shiftY,a.shiftY=0)}},co=(t,e)=>{const o=[],[n,s]=e,r=n+s;for(let a=0;a<t.length;a++){const c=t[a],[l]=V(c),f=[l,c.type===O.EXPANDED?c.height:0],[h,E]=f;if(Xt(f,e)){const u=h+E,m=n-u,p=r-h,C=(Math.abs(m)<Math.abs(p)?R.up:R.down)===R.up?m:p;o.push({index:a,amount:C})}}return o},uo=({gutterMode:t,focusedCommentId:e,gutterPositions:o,getCommentKey:n,getComment:s})=>{var h,E,u,m,p,y;if(!(o!=null&&o.size))return[];const r=new Map,a=[];let c=null,l=-1;for(const C of o.values()){if(C.type===Q.COMPOSER){c=[C.offsetY,C.height];continue}const{commentId:g,height:b,collapsedOffsetY:L,offsetY:T}=C;if(t===M.EXPANDED){const v=lt(a),k=v?ct(V(v)):0;let N=T;v&&N<=k&&(N=k),r.set(g,{originalOffsetY:T,offsetY:N}),e===g&&(l=a.length),a.push({key:n(g),comment:s(g),type:O.EXPANDED,height:b,offsetY:N,shiftY:0});continue}let S=a.findIndex(({offsetY:v,type:k})=>k===O.COLLAPSED&&v===L),d=(h=a[S])!=null?h:null;if(!d)d={key:a.length,type:O.COLLAPSED,offsetY:T,count:1,children:[g]},S=a.length,a.push(d);else{if(d.type!==O.COLLAPSED)throw new Error("Collapsed parent type expected to be collapsed");d.count+=1,d.children.push(g),d.offsetY=L}e===g&&(l=S)}const f=a[l];if(t===M.COLLAPSED&&(f==null?void 0:f.type)===O.COLLAPSED){const C=[];for(let g=0;g<f.children.length;g++){const b=f.children[g];b===e&&(l+=g+1);const L=lt(C),T=L?ct(V(L)):0,S=(u=(E=o.get(b))==null?void 0:E.offsetY)!=null?u:0,d=Math.max(T,S);r.set(b,{originalOffsetY:S,offsetY:d}),C.push({type:O.EXPANDED,key:n(b),comment:s(b),offsetY:d,height:(p=(m=o.get(b))==null?void 0:m.height)!=null?p:0,shiftY:0})}a.splice(l,0,...C)}if(e){const C=r.get(e);if(!C)return a;const{offsetY:g,originalOffsetY:b}=C,L=b-g,T=[{amount:L,index:l}];let S=l+1;for(;S<a.length;){const d=a[S],{type:v}=d;let k=L;if(v===O.EXPANDED&&((y=d.comment)!=null&&y.id)){const{offsetY:N,originalOffsetY:U}=J(r.get(d.comment.id));if(N===U)break;k=Math.max(U-N,L)}else break;T.push({amount:k,index:S}),S++}T.length&&Nt(a,T)}else if(t!==M.COLLAPSED&&c){const C=co(a,c);Nt(a,C)}return a},fo=t=>{try{return uo(t)}catch(e){return w.logError("Generating comment gutter entries",e),[]}},po=t=>"length"in t?t.length===0:t.nodeSize===0,it=12,ho=({composerHeight:t,getCommentHeight:e,getCollapsedStartPos:o,commentingOn:n,commentPositions:s,view:r})=>{var f,h;if(!s||!r||po(r.state.doc))return null;const{top:a}=r.dom.getBoundingClientRect(),c=Array.from(s.entries()).sort(([E,u],[m,p])=>u.start-p.start),l=new Map;for(const[E,{start:u}]of c)try{const m=(f=o==null?void 0:o(u))!=null?f:u,{top:p}=z(r,m),{top:y}=z(r,u),C=y-a,g=p-a,b=((h=e(E))!=null?h:0)+it;l.set(E,{commentId:E,height:b,collapsedOffsetY:g,offsetY:C,type:Q.COMMENT})}catch(m){continue}if((n==null?void 0:n.type)===Y.BLOCK){const{pos:E}=n;try{const{top:u}=z(r,E),p=u-a-it;l.set("block-composer",{type:Q.COMPOSER,height:(t!=null?t:0)+it,offsetY:p})}catch(u){}}return l},zt=(t,e)=>{const o=e.nodeAt(t);return o!=null&&o.isBlock?t+1:zt(t-1,e)};function mo(t){const e=Mt(),o=W(),n=o==null?void 0:o();if(!n)return null;if(tt(n)){if(!e)return null;const s=Ht(Vt,e);return s?s.positions:null}return new Map(t.map(s=>[s.id,s.at]))}const Eo=({gutterMode:t,focusedCommentId:e,commentingOn:o,comments:n,getStableId:s})=>{const[{height:r},a]=ot(),c=W(),[l,f]=x.useState(()=>new Map),[h,E]=x.useState(()=>new Map),u=x.useCallback(({focusedHeights:T,heights:S})=>{f(T),E(S)},[]),m=T=>{var d,v;const S=s(T);return T===e?(d=l.get(S))!=null?d:0:(v=h.get(S))!=null?v:0},p=c(),y=p!=null&&tt(p)?T=>zt(T,p.state.doc):void 0,C=new Map(n==null?void 0:n.map(T=>[s(T.id),T])),g=mo(n),b=ho({composerHeight:r,commentingOn:o,getCommentHeight:m,getCollapsedStartPos:y,commentPositions:g,view:p}),L=fo({gutterMode:t,gutterPositions:b,focusedCommentId:e,getComment:T=>{var S;return(S=C.get(s(T)))!=null?S:null},getCommentKey:s});return{blockComposerRef:a,onMeasureComments:u,gutterEntries:L}};function go(){const e=W()(),o=B(({commentingOn:r})=>r),s=e==null?null:ze(e,o);return s==null?null:i.jsx(D.div,{className:"absolute",style:{top:s.loadingTop},initial:!1,animate:{opacity:1,scale:1},exit:{opacity:0,scale:0},transition:{delay:.2},children:i.jsx(jt,{})},"selection-loading")}const xo=t=>i.jsx("div",{className:"absolute",style:{top:ct(V(t))},children:i.jsx("div",{className:"h-[max(3rem,18vh)] w-1"})}),Qo=({availableWidth:t,comments:e,commentsMode:o,disableBlockComments:n=!1,isRequestActive:s=!1,isWaitingForCommentResponse:r=!1,onAddComment:a,onAcceptComment:c,onDismissComment:l,getStableCommentId:f})=>{const h=B(({focusedCommentId:N})=>N),E=B(({hoveredCommentId:N})=>N),u=B(({commentingOn:N})=>N),m=Pe(),p=t<vt?M.COLLAPSED:M.EXPANDED,{onMeasureComments:y,blockComposerRef:C,gutterEntries:g}=Eo({comments:e,getStableId:f,gutterMode:p,focusedCommentId:h,commentingOn:u}),b=g.length>0,L=u!=null&&!r&&u.type!=="selection"||b,S=(()=>{if(!L)return 0;switch(p){case M.COLLAPSED:return 0;case M.EXPANDED:return vt}})(),d=(u==null?void 0:u.type)==="selection",v=lt(g),k=o===yt.ENABLED&&m&&!d&&!n;return i.jsxs(D.div,{className:j("pointer-events-none relative flex h-full shrink-0",K.commentGutter,p===M.COLLAPSED&&S?"basis-[32px]":"basis-0"),initial:{width:0,opacity:0},animate:{width:S,opacity:1},exit:{width:0,opacity:0},children:[i.jsx(lo,{getStableCommentId:f,comments:e,onMeasure:y}),i.jsxs("div",{className:j("pointer-events-auto absolute start-0 top-0 bottom-0 w-0 overflow-visible",{"ps-2":L||!n}),children:[i.jsx(X,{children:g.map(N=>{var pt,ht;const{key:U,type:dt}=N,se=!!h&&dt===O.EXPANDED&&((pt=N.comment)==null?void 0:pt.id)===h,re=!!h&&N.type===O.COLLAPSED&&N.children.includes(h);return i.jsx(io,{isGutterCollapsed:p===M.COLLAPSED,isSomeCommentFocused:!!u||!!h,isHovered:dt===O.EXPANDED&&((ht=N.comment)==null?void 0:ht.id)===E,isFocused:se||re,entry:N,disableActions:s||r||o===yt.COMMENTS_READONLY,onAcceptComment:($,G)=>{try{c==null||c($,J(e==null?void 0:e.find(st=>st.id===G)))}catch(st){w.logError("Comment ".concat(G," not found"),st)}},onDismissComment:$=>{try{l==null||l(J(e==null?void 0:e.find(G=>G.id===$)))}catch(G){w.logError("Comment ".concat($," not found"),G)}}},U)})}),b&&v&&i.jsx(xo,A({},v)),k&&i.jsx(ao,{composerRef:C,gutterMode:p,onAddComment:a,isWaitingForCommentResponse:r,isRequestActive:s,hasComments:b}),r&&d&&i.jsx(go,{})]})]})};var Co="Separator",At="horizontal",bo=["horizontal","vertical"],Wt=x.forwardRef((t,e)=>{const l=t,{decorative:o,orientation:n=At}=l,s=I(l,["decorative","orientation"]),r=yo(n)?n:At,c=o?{role:"none"}:{"aria-orientation":r==="vertical"?r:void 0,role:"separator"};return i.jsx(et.div,P(A(A({"data-orientation":r},c),s),{ref:e}))});Wt.displayName=Co;function yo(t){return bo.includes(t)}var vo=Wt,ut="Toolbar",[To]=ke(ut,[Rt,kt]),ft=Rt(),$t=kt(),[So,qt]=To(ut),Zt=x.forwardRef((t,e)=>{const f=t,{__scopeToolbar:o,orientation:n="horizontal",dir:s,loop:r=!0}=f,a=I(f,["__scopeToolbar","orientation","dir","loop"]),c=ft(o),l=we(s);return i.jsx(So,{scope:o,orientation:n,dir:l,children:i.jsx(Me,P(A({asChild:!0},c),{orientation:n,dir:l,loop:r,children:i.jsx(et.div,P(A({role:"toolbar","aria-orientation":n,dir:l},a),{ref:e}))}))})});Zt.displayName=ut;var Jt="ToolbarSeparator",Qt=x.forwardRef((t,e)=>{const r=t,{__scopeToolbar:o}=r,n=I(r,["__scopeToolbar"]),s=qt(Jt,o);return i.jsx(vo,P(A({orientation:s.orientation==="horizontal"?"vertical":"horizontal"},n),{ref:e}))});Qt.displayName=Jt;var Lo="ToolbarButton",nt=x.forwardRef((t,e)=>{const r=t,{__scopeToolbar:o}=r,n=I(r,["__scopeToolbar"]),s=ft(o);return i.jsx(Yt,P(A({asChild:!0},s),{focusable:!t.disabled,children:i.jsx(et.button,P(A({type:"button"},n),{ref:e}))}))});nt.displayName=Lo;var No="ToolbarLink",Ao=x.forwardRef((t,e)=>{const r=t,{__scopeToolbar:o}=r,n=I(r,["__scopeToolbar"]),s=ft(o);return i.jsx(Yt,P(A({asChild:!0},s),{focusable:!0,children:i.jsx(et.a,P(A({},n),{ref:e,onKeyDown:_e(t.onKeyDown,a=>{a.key===" "&&a.currentTarget.click()})}))}))});Ao.displayName=No;var te="ToolbarToggleGroup",Oo=x.forwardRef((t,e)=>{const a=t,{__scopeToolbar:o}=a,n=I(a,["__scopeToolbar"]),s=qt(te,o),r=$t(o);return i.jsx(de,P(A(A({"data-orientation":s.orientation,dir:s.dir},r),n),{ref:e,rovingFocus:!1}))});Oo.displayName=te;var Po="ToolbarToggleItem",wo=x.forwardRef((t,e)=>{const a=t,{__scopeToolbar:o}=a,n=I(a,["__scopeToolbar"]),s=$t(o),r={__scopeToolbar:t.__scopeToolbar};return i.jsx(nt,P(A({asChild:!0},r),{children:i.jsx(pe,P(A(A({},s),n),{ref:e}))}))});wo.displayName=Po;var ko=Zt,Mo=Qt,_o=(t=>(t.CODE="code",t.WRITING="writing",t))(_o||{});const F=({children:t,toolbarType:e})=>i.jsx(ko,{className:j("border-token-border-default bg-token-main-surface-primary m-0 flex h-10 w-fit min-w-0 shrink items-center overflow-hidden rounded-full border px-2",Dt,e==="code"?"py-0":"py-1"),children:t}),ee=({icon:t,hideLabel:e,label:o})=>i.jsxs(i.Fragment,{children:[i.jsx(t,{className:j("icon-sm",{"text-token-text-tertiary me-0.5":!e,"text-token-text-primary":e})}),!e&&i.jsx("span",{className:"text-token-text-primary truncate text-sm",children:o})]});var Ot;const oe=Gt(nt)(Ot||(Ot=rt(["flex h-full items-center gap-1 rounded-lg px-2.5 hover:bg-[#f5f5f5] disabled:opacity-50 disabled:cursor-not-allowed dark:hover:bg-token-main-surface-secondary disabled:hover:bg-transparent"]))),jo=({label:t,icon:e,isDisabled:o=!1,hideLabel:n=!1,onClick:s,onMouseDown:r})=>i.jsx(oe,{onClick:s,"aria-label":n?t:void 0,onMouseDown:r,disabled:o,children:i.jsx(ee,{icon:e,hideLabel:n,label:t})}),Do=({icon:t,hideLabel:e,label:o,children:n,align:s="end"})=>i.jsxs(he,{children:[i.jsx(me,{asChild:!0,children:i.jsx(oe,{"aria-label":e?o:void 0,children:i.jsx(ee,{icon:t,hideLabel:e,label:o})})}),i.jsx(Ee,{children:i.jsx(ge,{align:s,className:j(K.toolbar,"popover"),sideOffset:8,children:n})})]});var Pt;F.Separator=Gt(Mo)(Pt||(Pt=rt(["mx-1 p-0 list-none h-full w-[1px] bg-token-border-default"])));F.Action=jo;F.Button=nt;F.Popover=Do;function ne(t){const e=t();if(e==null)return;const{from:o,to:n,sourceFrom:s,sourceTo:r}=e;if(o==null||n==null||s==null||r==null){w.logError("Missing selection range on targeted edit",e);return}const a=_t.ASK;w.logButtonClick(H.TOOLBAR_ASK_CHATGPT,{action:a,sourceFrom:s,sourceTo:r}),_.startCommentingOn({type:Y.SELECTION,from:o,to:n,sourceRange:{start:s,end:r},action:a})}function Bo(t,e,o){x.useEffect(()=>{if(o)return;const n=s=>{(s.metaKey||s.ctrlKey)&&s.key.toLowerCase()==="k"&&(s.preventDefault(),ne(e))};return t==null||t.addEventListener("keydown",n),()=>t==null?void 0:t.removeEventListener("keydown",n)},[t,e,o])}const Io=({isSendDisabled:t=!1,getSelectionRange:e})=>{const o=wt(),n=()=>{ne(e)};return i.jsx(F.Action,{isDisabled:t,label:o.formatMessage({id:"wOaJUU",defaultMessage:"Ask ChatGPT"}),onClick:n,icon:Ye})},tn=({getEditorDom:t,getToolbarPosition:e,getSelectionRange:o,toolbarType:n,children:s,onAddComment:r,isWaitingForCommentResponse:a=!1,isSendDisabled:c=!1})=>{const[{height:l,width:f},h]=ot(),[E,u]=x.useState(!0),[m,p]=x.useState(!1),y=t(),C=B(({commentingOn:d})=>d),[g,b]=x.useState(null);Bo(y,o,c);const L=x.useCallback(()=>{const d=t(),v=document.getSelection();return!v||v.type!=="Range"||v.isCollapsed||!(d!=null&&d.contains(v.anchorNode))},[t]);x.useEffect(()=>{const d=je(()=>{p(!0)},200,{leading:!0}),v=()=>{d.cancel(),p(!1)};return y==null||y.addEventListener("pointerdown",d,{passive:!0}),document.addEventListener("pointerup",v,{passive:!0}),()=>{y==null||y.removeEventListener("pointerdown",d),document.removeEventListener("pointerup",v)}},[y]),x.useEffect(()=>{const d=()=>{u(L())};return document.addEventListener("selectionchange",d,{passive:!0}),()=>{document.removeEventListener("selectionchange",d)}},[L]),It(()=>{if(E||L())return u(!0);try{const d=e({width:f,height:l});d!=null&&b(d)}catch(d){w.logError("Invalid position in getToolbarPosition",d)}},[l,f,E,L,e]);const T=i.jsxs(F,{toolbarType:n,children:[i.jsx(Io,{isSendDisabled:c,getSelectionRange:o}),s]}),S=!E&&!C&&g!=null;return i.jsxs(i.Fragment,{children:[i.jsx("div",{"aria-hidden":"true",className:"pointer-events-none invisible fixed start-0 top-0 h-0 overflow-clip",children:i.jsx("div",{ref:h,children:T})}),i.jsx(X,{children:S&&i.jsx(D.div,{initial:{opacity:0,scale:.95},animate:{opacity:m?0:1,scale:m?.95:1},style:{top:g.top,left:g.left},exit:{opacity:0,scale:.95},transition:{type:"spring",bounce:.1,duration:.1,delay:m?0:.1},className:j("absolute",K.toolbar,m?"pointer-events-none":"pointer-events-auto"),children:T})}),i.jsx($e,{toolbarPosition:g,commentingOn:C,isWaitingForCommentResponse:a,onAddComment:r})]})};function Ro(t){let e=t;for(;e;){const n=window.getComputedStyle(e).overflowY;if(n==="auto"||n==="scroll")return e;e=e.parentElement}return null}function en(t,e){const o=W(),n=xe(),s=o();x.useEffect(()=>{const r=s==null?void 0:s.dom;if(!r||t.length===0)return;const a=Ro(r),c=e?Bt(e,100):null;return a&&c&&a.addEventListener("scroll",c,{passive:!0}),()=>{c&&(a&&a.removeEventListener("scroll",c),c.cancel())}},[s,n,t,e])}let Z=null;function on(){if(Z!=null)return Z;if(typeof window>"u")return 0;const t=document.createElement("div");t.style.width="100px",t.style.height="100px",t.style.overflow="scroll",t.style.position="absolute",t.style.top="-9999px",document.body.appendChild(t);try{Z=t.offsetWidth-t.clientWidth}finally{document.body.removeChild(t)}return Z}function nn(t){return t==null?null:t.scrollHeight>t.clientHeight}export{Kt as A,Qo as C,tn as T,_o as a,po as b,F as c,on as g,nn as i,en as u};
//# sourceMappingURL=iwpn1avuswb5fupo.js.map
