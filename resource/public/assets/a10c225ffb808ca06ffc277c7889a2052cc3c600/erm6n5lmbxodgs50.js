var at=Object.freeze,lt=Object.defineProperty,ls=Object.defineProperties;var cs=Object.getOwnPropertyDescriptors;var ot=Object.getOwnPropertySymbols;var ds=Object.prototype.hasOwnProperty,us=Object.prototype.propertyIsEnumerable;var $e=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e);var it=(e,t,n)=>t in e?lt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,v=(e,t)=>{for(var n in t||(t={}))ds.call(t,n)&&it(e,n,t[n]);if(ot)for(var n of ot(t))us.call(t,n)&&it(e,n,t[n]);return e},L=(e,t)=>ls(e,cs(t));var G=(e,t)=>at(lt(e,"raw",{value:at(t||e.slice())}));var ue=function(e,t){this[0]=e,this[1]=t},ct=(e,t,n)=>{var r=(i,c,u,l)=>{try{var f=n[i](c),x=(c=f.value)instanceof ue,p=f.done;Promise.resolve(x?c[0]:c).then(m=>x?r(i==="return"?i:"next",c[1]?{done:m.done,value:m.value}:m,u,l):u({value:m,done:p})).catch(m=>r("throw",m,u,l))}catch(m){l(m)}},a=i=>o[i]=c=>new Promise((u,l)=>r(i,c,u,l)),o={};return n=n.apply(e,t),o[$e("asyncIterator")]=()=>o,a("next"),a("throw"),a("return"),o};var He=(e,t,n)=>(t=e[$e("asyncIterator")])?t.call(e):(e=e[$e("iterator")](),t={},n=(r,a)=>(a=e[r])&&(t[r]=o=>new Promise((i,c,u)=>(o=a.call(e,o),u=o.done,Promise.resolve(o.value).then(l=>i({value:l,done:u}),c)))),n("next"),n("return"),t);import{b as ce,r as d,j as s,M as A,A as pe,m as M,v as Fe,d as Le,ax as fs,c as ms,au as xs,f as Xe}from"./jj85rqzpbnvv3emr.js";import{C as Mt,bw as dt,T as De,B as se,fv as ps,id as hs,ax as Ke,$ as re,a0 as ae,e as C,f as gs,L as Ze,p as Je,tA as ys,eM as vs,hB as bs,eJ as Qe,bE as Es,i as At,fl as ws,kk as js,cX as xe,t as Lt,fs as Ss,dL as Ns,jJ as Cs,l_ as ks,iN as Ts,tB as _s,hF as Dt,aj as Is,aI as et,gE as Rs,S as Ms,dI as As,e$ as Ge,h5 as Ls,R as je,gL as Ds,gv as Os,dl as Bs,x as Ps,F as W,bo as $s,J as Hs,eF as Us,j as Fs}from"./lef5ym39glv4981l.js";import{nX as Gs,nY as qs,nP as Ws,fH as Ot,y7 as zs,xx as _e,y8 as Vs,f4 as Ys,k1 as Xs,uY as Ks,c7 as Zs,j$ as Js,k0 as Qs,dq as en,y9 as tn,wc as sn,be as nn,xZ as U,eI as Bt,fk as rn,gz as an,gO as Pt,N as ut}from"./mclphevd122040jw.js";import{u as on}from"./lbaueofbjv8jfqwm.js";import{T as Oe,E as ln,j as cn,h as dn,g as un,i as fn,d as mn}from"./g9xi6m5yzu4rtfn2.js";import{b as xn,i as pn,c as hn,L as gn}from"./zta1pq4ds1hak11y.js";import{E as te,M as I}from"./ns51nblw8ziscsgd.js";import{a as yn,D as vn,H as bn,Z as Ce}from"./nfygy4vif6crzpny.js";import{d as Be,c as he,E as Ie,D as me}from"./iqw8c7pica2coyb9.js";import{S as En,a as wn}from"./dl9z2ehd50icy9od.js";import{S as jn,u as Re,f as Sn,n as $t}from"./g2yrrlnprx92uhjb.js";const Ht=({origin:e,url:t})=>s.jsxs("div",{"aria-label":t,className:"w-full min-w-0 pe-4 text-start whitespace-nowrap",children:[s.jsx("span",{"aria-hidden":!0,className:"text-token-text-primary",children:e}),s.jsx("span",{"aria-hidden":!0,className:"text-token-text-tertiary",children:t.replace(e,"")})]}),Nn=({request:e,isDenied:t=!1,onClick:n})=>{const[{width:r},a]=on();return s.jsxs("button",{ref:a,className:"group relative z-0 my-1 flex w-full items-center",onClick:n,children:[s.jsx("div",{className:"sticky start-0 z-[-1] w-0",children:s.jsx("div",{className:"absolute top-0 hidden h-8 -translate-y-1/2 bg-gray-100 group-hover:block",style:{width:r}})}),s.jsx("div",{className:"bg-token-main-surface-primary text-token-text-secondary sticky start-0 z-10 flex h-8 shrink-0 items-center px-2 group-hover:bg-gray-100",children:t?s.jsx(Ws,{className:"icon text-red-500"}):s.jsx(hs,{className:"icon text-green-500"})}),s.jsx(Ht,v({},e))]})},Cn=({title:e,requests:t,onConfirm:n})=>{const r=ce(),[a,o]=d.useState(()=>new Set),i=()=>{for(const{requestId:f,approve:x,deny:p}of t)a.has(f)?p():x();n==null||n()},c=()=>{for(const f of t)f.deny()},u=f=>{o(x=>{const p=new Set(x);return p.has(f)?p.delete(f):p.add(f),p})},l=t.length-a.size;return s.jsx(Mt,{testId:"modal-confirm-fetch-request",isOpen:!0,shouldIgnoreClickOutside:!0,onClose:i,type:"success",title:s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-xl",children:s.jsx(A,{id:"VmMpF1",defaultMessage:"Allow network access?"})}),s.jsx(De,{side:"top",contentClassName:"max-w-2xs!",label:s.jsx(A,{id:"WT7tgj",defaultMessage:"Learn more about network requests in canvas"}),children:s.jsx(se,{icon:ps,openNewTab:!0,onClick:()=>Gs.logButtonClick(qs.LEARN_MODE_ABOUT_NETWORK_REQUESTS),as:"a",color:"ghost",size:"small",className:"text-token-text-secondary aspect-square p-1!",to:"https://help.openai.com/en/articles/9930697-what-is-the-canvas-feature-in-chatgpt-and-how-do-i-use-it#h_cd52fdbc16"})})]}),description:s.jsxs("div",{className:"mt-3 flex flex-col gap-3",children:[s.jsx("span",{className:"text-token-text-primary block",children:s.jsx(A,{id:"qk11AX",defaultMessage:"{title} is trying to connect to the network. If you don’t recognize {numRequests, plural, one {this request} other {any of these requests}}, don’t allow this app access to the network.",values:{title:'"'.concat(e,'"'),numRequests:t.length}})}),s.jsx("div",{className:"flex max-w-full flex-col",children:t.length>1?s.jsx("ul",{className:"border-token-border-default relative flex max-h-48 flex-col overflow-x-auto overflow-y-auto rounded-lg border",children:t.map(f=>{const{requestId:x}=f;return s.jsx("li",{children:s.jsx(Nn,{request:f,isDenied:a.has(x),onClick:()=>u(x)})},x)})}):s.jsx("div",{className:"no-scrollbar bg-token-main-surface-secondary overflow-x-auto rounded-lg p-2",children:s.jsx(Ht,v({},t[0]))})})]}),primaryButton:s.jsx(dt.Button,{disabled:l===0,title:t.length>1?r.formatMessage({id:"xpKkWv",defaultMessage:"Allow selected ({count})"},{count:l}):r.formatMessage({id:"ZeMrpd",defaultMessage:"Allow"}),color:"primary",onClick:i}),secondaryButton:s.jsx(dt.Button,{title:r.formatMessage({id:"TjJzqR",defaultMessage:"{count, plural, one {Deny} other {Deny all}}"},{count:t.length}),color:"secondary",onClick:c})})},kn=e=>{switch(e.type){case"hist":return re.hist(ae.WEB_SANDBOX,e.label,e.tags,e.value);case"count":return re.count(ae.WEB_SANDBOX,e.label,e.tags,e.count);case"error":return Ke.addError(e.error)}},Ut=({size:e=60,thickness:t=1/16,checkpoints:n,activeCheckpointId:r,isComplete:a=!1,onTransitionComplete:o,color:i})=>{const[c,u]=d.useState(0),l=n.findIndex(m=>m.id===r),f=d.useRef(null),x=n[l];d.useEffect(()=>{if(!x||a)return;const m=n.length,g=l*100/m,h=(l+1)*100/m;u(g);let w=null,j=null;const b=5/x.estimatedTime,y=R=>{j==null&&(j=R);const k=R-j;if(k!==0){const D=h-g,$=g+D*(1-Math.exp(-b*k));u(Math.min($,h-1e-4))}w=window.setTimeout(()=>{f.current=requestAnimationFrame(y)},16)};return f.current=requestAnimationFrame(y),()=>{w!=null&&window.clearTimeout(w),f.current!=null&&cancelAnimationFrame(f.current)}},[l,a]);const p=()=>{a&&(o==null||o())};return s.jsx(Ot,{sizeOverride:e,className:C(i==null&&"text-primary",i==="dark"&&"text-back",i==="light"&&"text-white"),thickness:t,backgroundStrokeClassName:C(i==null&&"stroke-[rgba(0,0,0,0.1)] dark:stroke-[rgba(0,0,0,0.32)]",i==="dark"&&"stroke-[rgba(0,0,0,0.32)]",i==="light"&&"stroke-[rgba(0,0,0,0.1)] "),percentage:a?100:c,onTransitionEnd:p,transitionDuration:"50ms",transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)"})},Tn=({checkpoints:e,activeCheckpointId:t,isIndeterminate:n=!1,isComplete:r})=>{const[a,o]=d.useState(r);return d.useEffect(()=>{o(r)},[t]),s.jsx(pe,{children:(t!=null&&!a||n)&&s.jsxs(M.div,{initial:{opacity:0},exit:{opacity:0},animate:{opacity:1},className:"bg-token-bg-primary absolute end-2 bottom-2 flex items-center gap-2 rounded-full px-3 py-1.5 shadow-lg",children:[n?s.jsx(Ot,{percentage:30,thickness:1/12,className:"text-primary animate-spin",backgroundStrokeClassName:"dark:stroke-[rgba(255,255,255,0.4)] stroke-[rgba(0,0,0,0.1)]",sizeOverride:12}):t&&s.jsx(Ut,{size:12,thickness:1/12,checkpoints:e,activeCheckpointId:t,isComplete:r,onTransitionComplete:()=>o(!0)}),s.jsxs("span",{className:"text-token-text-secondary flex items-baseline text-sm",children:[s.jsx(A,{id:"zfcWbe",defaultMessage:"Updating"}),s.jsx(Oe,{gap:1.5,padding:2,size:2})]})]})})},tt=()=>ys(Ze.getItem(Je.CODE_EXECUTION_DOMAIN_ALLOW_LIST),t=>vs(t,{origin:Qe,expiresAt:bs}),[]).filter(({expiresAt:t})=>t>=Date.now()),_n=()=>{Ze.removeItem(Je.CODE_EXECUTION_DOMAIN_ALLOW_LIST)},In=(e,t)=>{const{origin:n}=new URL(e);let r=[...xn];const a=tt().map(({origin:o})=>o);return t&&(r=r.concat(a)),r.includes(n)},Rn=({networkAccessDeniedMessage:e,disableNetworkRequests:t})=>{const n=gs(),r=ce(),[a,o]=d.useState([]);return{onViolation:d.useCallback(c=>{const{blockedURI:u}=c;try{if(t)return n.danger(e!=null?e:r.formatMessage({id:"Lp7cKY",defaultMessage:"Network access is disabled."}),{loggingTitle:"Network access is disabled.",toastId:"network_access_denied"});re.count(ae.WEB_SANDBOX,"network_access_requested");const{origin:l}=new URL(u),f=p=>{re.count(ae.WEB_SANDBOX,"network_access_request.".concat(p?"allow":"deny")),o(m=>m.filter(g=>!In(g.url,!t)&&g.url!==u))},x=()=>{Ze.setItem(Je.CODE_EXECUTION_DOMAIN_ALLOW_LIST,[...tt(),{origin:l,expiresAt:Date.now()+90*24*60*60*1e3}]),f(!0)};o(p=>[...p,{requestId:Fe(),url:u,origin:l,approve:x,deny:()=>f(!1)}])}catch(l){Ke.addError(l)}},[t,n,e,r]),pendingFetchRequests:a}},Mn="https://persistent.oaistatic.com/canvas/loop-swirl.mp4",An="https://persistent.oaistatic.com/canvas/loop-swirl-poster.jpg",ye=90,Ln=({title:e,checkpoints:t,activeCheckpointId:n,isComplete:r,onTransitionComplete:a})=>{const[o,i]=d.useState(!1),c=t.findIndex(f=>f.id===n),u=t[c],l=()=>{a==null||a(),i(!0)};return s.jsx(M.div,{className:"relative flex h-full w-full items-center justify-center",transition:{type:"spring",bounce:0},children:s.jsxs(M.div,{className:"flex -translate-y-12 flex-col items-center gap-3",style:{minWidth:ye,height:ye},initial:{opacity:0},animate:{opacity:1},transition:{type:"spring",duration:.5,bounce:0},children:[s.jsxs(M.div,{className:"bg-token-main-surface-primary absolute overflow-hidden rounded-3xl shadow-2xl",initial:!1,animate:{width:ye,height:ye,opacity:o?0:1},transition:{type:"spring",duration:.56,bounce:0},children:[s.jsx("video",{muted:!0,loop:!0,autoPlay:!0,playsInline:!0,src:Mn,poster:An,className:C("absolute inset-0 z-0 h-full w-full object-cover transition-opacity duration-200")}),s.jsx("div",{className:C("relative z-10 flex h-full w-full items-center justify-center",o?"opacity-0":"opacity-100"),children:s.jsx(Ut,{color:"light",checkpoints:t,activeCheckpointId:n,isComplete:r,onTransitionComplete:l,thickness:1/12})})]}),s.jsxs(M.div,{className:C("flex flex-col items-center transition-opacity duration-200",r?"opacity-0":"opacity-100"),style:{translateY:ye+20},children:[s.jsx("span",{className:"text-token-text-primary font-semibold",children:e}),u&&s.jsx(M.span,{className:"text-token-text-secondary flex items-baseline",children:s.jsx("span",{className:"loading-shimmer",children:u.label})})]})]})})},Dn=()=>"?"+[""].filter(Boolean).join("&"),ft=[{id:te.INITIALIZING,label:"Initializing environment",estimatedTime:1e3},{id:te.INSTALLING_PACKAGES,label:"Installing packages",estimatedTime:2e3},{id:te.RUNNING_CODE,label:"Ready",estimatedTime:1}],On=()=>Ss()?"ios":Ns()?"windows":Cs()?"android":ks()?"safari":Ts()||_s()?"chrome":"unknown",Bn=(e,t)=>{re.count(ae.WEB_SANDBOX,"".concat(t,".eval")),Lt(e,"chatgpt_web_sandbox_code_run","".concat(t))},Pn=(e,t)=>{var n,r;Lt(e,"chatgpt_web_sandbox_environment_error","".concat(t.error.name,": ").concat(t.error.message)),Ke.addError("Code execution environment error",L(v({},t.error),{errorMessage:"".concat(t.error.name,": ").concat(t.error.message)})),t.error.name==="ServiceWorker"&&re.count(ae.WEB_SANDBOX,"service_worker_connection_failure",[{key:"agent",value:On()},{key:"is_share",value:String(t.isShare)}]),((n=t.activeRun)==null?void 0:n.runId)!=null&&t.activeRun.runId===((r=t.activeRun)==null?void 0:r.runId)&&re.count(ae.WEB_SANDBOX,"".concat(t.activeRun.language,".environment_error"))},Sa=({ref:e,id:t,title:n,visuallyHidden:r,disablePermissions:a,isCodeUpdating:o,onCodeRunComplete:i,disableNetworkRequests:c=!1,networkAccessDeniedMessage:u,unsafeAllowAllNetworkRequests:l,enableTransition:f,onChangeBackgroundColor:x,onRetryCodeRun:p})=>{const[m,g]=d.useState(0),[h]=d.useState(()=>Es(null)),w=d.useRef(null),j=d.useRef(null),b=d.useRef(!1),[y,R]=d.useState(null),[k,D]=d.useState(!1),{onViolation:$,pendingFetchRequests:B}=Rn({disableNetworkRequests:c,networkAccessDeniedMessage:u});d.useEffect(()=>{const S=j.current;if(S)return b.current=!0,pn(S,{sendInstrument:kn,notifyEnvironmentError:T=>{Pn(z,{error:T,isShare:!1,activeRun:w.current}),_n(),g(N=>N+1),Y()},notifyBackgroundColor:x,notifySecurityPolicyViolation:$},["runUserCode"]).then(T=>{h.set(T)}),()=>{h.set(null),b.current=!1}},[m]);const q=async()=>(await js(()=>h()!=null),xe(h())),Y=()=>{w.current=null,R(null),D(!1),i==null||i()},z=At(),X=function(N){return ct(this,arguments,function*({code:S,language:T}){var P;R(te.INITIALIZING),Bn(z,T);const J=yield new ue(q()),E=Fe();w.current={runId:E,language:T};const _=tt().map(({origin:H})=>H),F=l?null:c?{resourceDomains:[],connectDomains:[],isTrusted:!1}:{connectDomains:_,resourceDomains:_,isTrusted:!1};try{for(var V=He(yield new ue(J.runUserCode({code:S,id:t,language:T,csp:F}))),ge,Pe,is;ge=!(Pe=yield new ue(V.next())).done;ge=!1){const H=Pe.value;const Se={timestamp:Date.now(),id:Fe(),runId:E};switch(H.type){case I.ERROR:re.count(ae.WEB_SANDBOX,"".concat(T,".error")),yield v(v({},H),Se);break;case I.ENVIRONMENT_STATUS:R(H.status),f||D(H.status===te.RUNNING_CODE),yield v(v({},H),Se);break;case I.RUN_COMPLETE:H.type===I.RUN_COMPLETE&&H.wasFatalError&&re.count(ae.WEB_SANDBOX,"".concat(T,".fatal_runtime_error")),yield v(v({},H),Se),((P=w.current)==null?void 0:P.runId)===E&&Y();break;case I.LOG:yield v(v({},H),Se);break;default:continue}}}catch(Pe){is=[Pe]}finally{try{ge&&(Pe=V.return)&&(yield new ue(Pe.call(V)))}finally{if(is)throw is[0]}}})},K=async(S,T)=>{(await q()).prepareEnvironment({code:S,language:T,id:t})},O=async()=>{(await q()).stop()};d.useImperativeHandle(e,()=>({stop:O,evalAsync:X,prepareEnvironment:K}));const Z={type:"spring",duration:k&&f?.56:0,delay:k?.12:0,bounce:0},oe=a?"":"midi";return s.jsxs(ws,{children:[s.jsxs("div",{className:C("relative flex",r?"fixed h-0 w-0":"h-full w-full"),children:[!r&&y!=null&&f&&s.jsx(Ln,{isComplete:y===te.RUNNING_CODE,onTransitionComplete:()=>D(!0),activeCheckpointId:y,title:n,checkpoints:ft}),s.jsx(M.div,{className:C("bg-token-main-surface-primary absolute inset-0 m-auto origin-center overflow-hidden",k?"pointer-events-auto":"pointer-events-none"),animate:v({opacity:k?1:0},k?{scale:1}:{scale:.95}),transition:Z,children:s.jsx(M.iframe,{title:n,className:"h-full w-full overflow-hidden",transition:Z,"aria-hidden":r?"true":void 0,allow:oe,src:"".concat(hn,"/index.html").concat(Dn()),sandbox:"allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox allow-forms",ref:j,tabIndex:-1},"sandbox-".concat(m))}),k&&s.jsx(Tn,{isIndeterminate:o,isComplete:y===te.RUNNING_CODE,activeCheckpointId:y,checkpoints:ft})]}),B.length>0&&s.jsx(Cn,{title:n,requests:B,onConfirm:()=>{g(S=>S+1),R(null),D(!1),setTimeout(()=>{p==null||p()})}})]})};function $n(e,t,n){const r=new Map;return e.forEach((a,o)=>{const i=zs(a,t,n);i&&r.set(o,i)}),r}function Hn(e,t){const n=Gn(e);if(n.length===0)return t;let r=t;return n.forEach(a=>{r=Un(a,r)}),r}function Un(e,t){return $n(t,{start:e.fromA,end:e.toA},Fn(e))}function Fn(e){const{fromA:t,toA:n,fromB:r,toB:a}=e;return a-r-(n-t)}function Gn(e){const t=[],n=(r,a,o,i)=>{t.push({fromA:r,toA:a,fromB:o,toB:i})};return e.changes.iterChangedRanges(n,!0),t}function qn(e,t){const n=Array.from(e.keys()),r=Array.from(t.keys());if(n.length!==r.length)return!1;n.sort(),r.sort();for(let a=0;a<n.length;a++)if(n[a]!==r[a])return!1;for(const a of n){const o=e.get(a),i=t.get(a);if(!o||!i||o.start!==i.start||o.end!==i.end)return!1}return!0}function Wn(e,t){return{"bg-yellow-100 dark:bg-yellow-400":!0,"bg-yellow-400/40 dark:bg-yellow-400/50":e&&!t,"bg-yellow-400/60 dark:bg-yellow-500/70":t,"bg-yellow-100 dark:bg-yellow-400/30":!e&&!t}}const zn={"bg-transparent!":!0};function Vn({isHovered:e,isFocused:t,isCode:n,diffStatus:r}){return C(n?yn:vn,"cursor-text group is-comment transition-colors",v({},r===_e.REMOVED?zn:Wn(e,t)),"group-[.is-comment]:bg-opacity-40")}function Yn(e,t){return e.map(n=>{const r=t.get(n.id);return r?L(v({},n),{at:r}):null}).filter(Dt)}var de=(e=>(e.ASK="ask",e.CREATE_TEXTDOC="create_textdoc",e.COMMENT="comment",e.EDIT="edit",e))(de||{}),Xn=(e=>(e.SELECTION="selection",e.BLOCK="block",e))(Xn||{});function Na(e){return(e==null?void 0:e.type)==="selection"}const Kn=Is(()=>({commentingOn:null,hoveredCommentId:null,focusedCommentId:null,visibleBlockCommentLauncher_DEBUG_ONLY:null,hoveredBlockCommentLauncherPos:null})),{setState:ee,getInitialState:Zn}=Kn,Me={reset:()=>ee(Zn()),startCommentingOn:e=>ee(t=>L(v({},t),{commentingOn:e})),cancelCommentingOn:()=>ee(e=>L(v({},e),{commentingOn:null})),focusComment:e=>ee(t=>L(v({},t),{focusedCommentId:e})),blurComment:()=>ee(e=>L(v({},e),{focusedCommentId:null})),mouseEnterComment:e=>ee(t=>L(v({},t),{hoveredCommentId:e})),mouseLeaveComment:()=>ee(e=>L(v({},e),{hoveredCommentId:null})),mouseEnterBlock:e=>ee(t=>L(v({},t),{hoveredBlockCommentLauncherPos:e})),mouseLeaveBlock:()=>ee(e=>L(v({},e),{hoveredBlockCommentLauncherPos:null})),setVisibleBlockComment_DEBUG_ONLY:e=>ee(t=>L(v({},t),{visibleBlockCommentLauncher_DEBUG_ONLY:e}))},Ft=Be.define(),Jn=Be.define(),Qn=Be.define(),er=Be.define();function tr(e){return new Map(e.map(t=>[t.id,t.at]))}const qe=he.define({create(){return null},update(e,t){for(const n of t.effects)if(n.is(Ft))return n.value;return e}}),We=he.define({create(){return[]},update(e,t){for(const i of t.effects)if(i.is(Jn))return i.value;const n=e,r=tr(n),a=Hn(t,r);return qn(r,a)?n:Yn(n,a)}}),ze=he.define({create(){return null},update(e,t){for(const n of t.effects)if(n.is(Qn))return n.value;return e}}),Ve=he.define({create(){return null},update(e,t){for(const n of t.effects)if(n.is(er))return n.value;return e}});function mt(e){if(!e||e.to-e.from===0)return me.none;const t=me.mark({class:bn.code});return me.set([t.range(e.from,e.to)])}function xt(e,t,n){if(e.length===0)return me.none;const a=[...e].sort((o,i)=>o.at.start-i.at.start).map(o=>{if(o.at.end-o.at.start===0)return null;const i=o.id===t,c=o.id===n,u=Vn({isHovered:i,isFocused:c,isCode:!0,diffStatus:o.diffStatus});return me.mark({class:u,attributes:{"data-comment-id":o.id}}).range(o.at.start,o.at.end)}).filter(Dt);return me.set(a)}const sr=he.define({create(e){const t=e.field(qe,!1);return mt(t!=null?t:null)},update(e,t){const n=t.state.field(qe,!1);return mt(n!=null?n:null)},provide:e=>Ie.decorations.from(e)}),nr=he.define({create(e){const t=e.field(We,!1),n=e.field(ze,!1),r=e.field(Ve,!1);return xt(t!=null?t:[],n!=null?n:null,r!=null?r:null)},update(e,t){const n=t.state.field(We,!1),r=t.state.field(ze,!1),a=t.state.field(Ve,!1);return xt(n!=null?n:[],r!=null?r:null,a!=null?a:null)},provide:e=>Ie.decorations.from(e)});function rr(e){e.state.selection.main.empty&&e.dispatch({effects:Ft.of(null)})}function Gt(e){let t=e.dataset.commentId;for(let n=0;n<10&&!t&&e.parentElement;n++)e=e.parentElement,t=e.dataset.commentId;return t}function ar(e){const t=e.target,n=Gt(t);n&&Me.focusComment(n)}function or(e){const t=e.target,n=Gt(t);n?Me.mouseEnterComment(n):Me.mouseLeaveComment()}function Ca(e,t=null,n=null){return[We.init(()=>e),qe,ze.init(()=>t),Ve.init(()=>n),sr,nr,Ie.updateListener.of(r=>{r.selectionSet&&rr(r.view)}),Ie.domEventHandlers({click:ar,mouseover:or})]}const ir=({onClose:e,title:t,actions:n,showBorder:r=!1})=>s.jsxs("div",{className:C("bg-token-bg-primary flex items-center justify-between border-b py-2 ps-2 pe-2.5",{"border-token-border-light":r,"border-transparent":!r}),children:[s.jsx("div",{className:"text-token-text-primary flex items-center gap-2 ps-4 text-sm select-none",children:t}),s.jsxs("div",{className:"flex items-center gap-2",children:[n.map(({tooltip:a,icon:o,onClick:i},c)=>{const u=s.jsx(se,{size:"small",color:"ghost",as:"button",className:"text-token-text-primary aspect-square p-1!",icon:o,onClick:i},c);return a?s.jsx(De,{label:a,children:u},c):u}),s.jsx(se,{size:"small",color:"ghost",as:"button",className:"text-token-text-primary aspect-square p-1!",onClick:e,icon:et})]})]}),qt=e=>Rs([I.ERROR,I.LOG,I.OUTPUT],e.type),Wt=e=>e.type===I.OUTPUT&&zt(e.output),zt=e=>typeof e=="string"&&e.startsWith("data:image/png;"),ve=({as:e="li",contentBefore:t,contentAfter:n,disableEntryAnimation:r=!1,hasHint:a=!1,bottomBorder:o=!1,isHintOpen:i=!1,isSticky:c=!1,onClick:u,children:l})=>{const f=!!u,x=e==="div"?M.div:M.li;return s.jsxs(x,{initial:r?!1:{opacity:0},animate:{opacity:1},transition:{duration:.32},role:f?"button":void 0,className:C("bg-token-bg-primary flex items-start justify-between py-1.5 ps-6 pe-4 font-mono text-sm whitespace-pre",o&&"border-token-border-xlight border-b",c&&"sticky top-0 z-10",f&&"cursor-pointer",f&&a&&"hover:bg-red-500/10",f&&!a&&"hover:bg-gray-50 dark:hover:bg-gray-700",a&&i&&"bg-red-500/10"),onClick:f?u:void 0,children:[t&&s.jsx("div",{className:"me-3 flex h-6 w-5 items-start",children:t}),s.jsx("div",{className:"flex min-h-6 min-w-0 flex-1 items-start justify-start gap-2 leading-6",children:l}),n&&s.jsx("div",{className:"ms-3 flex min-h-6 items-start leading-6",children:n})]})};function lr(e){switch(e){case"dark_gray":return{normal:"text-token-text-secondary dark:text-white-400",hover:"cursor-pointer hover:text-token-text-primary group-hover:text-token-text-primary"};case"light_gray":return{normal:"text-gray-400",hover:"cursor-pointer hover:text-token-text-secondary group-hover:text-token-text-secondary"};case"error":return{normal:"text-red-500",hover:"cursor-pointer hover:text-red-500 group-hover:text-red-500"}}}function st({children:e,className:t,onClick:n,isClickable:r=!1,theme:a="dark_gray"}){const o=lr(a),i=(n!=null||r)&&o.hover;return s.jsxs("div",{className:C("icon relative inline-block transition-opacity",t,i,o.normal),onClick:n,children:[e?s.jsx(En,{className:"icon"}):s.jsx(wn,{className:"icon"}),s.jsx("span",{className:C("absolute inset-0 flex items-center justify-center text-[8px] font-black",i,o.normal),children:e})]})}function nt(){return s.jsx(st,{theme:"light_gray",children:s.jsx(Oe,{})})}function cr({count:e,isLoading:t,onClick:n,isError:r=!1}){return t?s.jsx(nt,{}):s.jsx(st,{onClick:n,theme:r?"error":"dark_gray",children:e})}function ka({isLoading:e=!1,onClick:t}){return e?s.jsx(nt,{}):s.jsx(st,{isClickable:!0,onClick:t,theme:"light_gray"})}const Vt={type:"spring",bounce:.12,duration:.5},Yt="opacity-50",dr=({position:e="absolute",count:t,offsetY:n,isLoading:r=!1,onClick:a,isError:o=!1})=>s.jsx(M.div,{className:C("flex",e,Ce.collapsedComment),initial:{opacity:0},animate:{opacity:1},style:{translateY:n},transition:Vt,exit:{opacity:0},children:s.jsx(cr,{count:t,isLoading:r,onClick:a,isError:o})}),ur=({isFocused:e,isHovered:t})=>{const n=e||t?"grow font-medium text-token-text-primary transition-colors":"grow font-medium text-token-text-secondary transition-colors",r=e||t?"opacity-100 transition":"opacity-75 transition";return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:r,children:s.jsx("div",{className:"gizmo-bot-avatar rounded-full",children:s.jsx(Vs,{iconName:"openai"})})}),s.jsx("span",{className:n,children:"ChatGPT"})]})},fr=({comment:{diffStatus:e,content:t},isFocused:n,isSomeCommentFocused:r,isHovered:a})=>{const o=e===_e.REMOVED;return s.jsx("div",{className:C("text-token-text-primary mt-2 transition-all",{"opacity-80":!n&&!r&&!a&&!o,"opacity-40":!n&&r&&!a&&!o,[Yt]:o}),children:s.jsx(Ys,{text:t})})},mr=({acceptButtonLabel:e,position:t="absolute",left:n,right:r,comment:a,disableAnimations:o=!1,onClick:i,onMouseEnter:c,onMouseLeave:u,onAccept:l,onDismiss:f,translateY:x,isFocused:p=!1,isSomeCommentFocused:m=!1,disableActions:g=!1,isHovered:h=!1},w)=>{const[j,b]=d.useState(!1),y=a.diffStatus===_e.ADDED,R=a.diffStatus===_e.REMOVED,k=a.diffStatus!=null,D=()=>{b(!0),c==null||c()},$=()=>{b(!1),u==null||u()},B=ce(),q=p||j&&!m;return s.jsx(M.div,{ref:w,className:C(t,Ce.expandedComment,{"cursor-default":p,"cursor-pointer":!p,[Ce.expandedCommentFocused]:p,[Ce.expandedCommentHovered]:h}),style:{left:n,right:r},initial:o?!1:{translateY:x,scale:.85,opacity:0},animate:o?void 0:{translateY:x,scale:p?1:.97,opacity:1},exit:o?void 0:{scale:.85,opacity:0,filter:"blur(16px)"},transition:Vt,onClick:i,onMouseEnter:g?void 0:D,onMouseLeave:g?void 0:$,"data-comment-id":a.id,children:s.jsxs("div",{className:C("flex min-h-8 flex-col overflow-hidden rounded-2xl border p-4 pt-2 text-start text-sm transition-all",{"border-transparent bg-gray-50 dark:bg-gray-800":!p&&!h,"border-token-border-default bg-token-main-surface-primary":h&&!p,"border-token-border-default bg-token-main-surface-primary shadow-xl":p||j&&!m,"relative after:absolute after:start-0 after:top-0 after:bottom-0 after:w-1":k,"after:bg-green-500":y,"after:bg-red-500":R}),style:{width:ln},children:[s.jsxs("div",{className:C("flex h-8 flex-row items-center gap-2.5",{[Yt]:R}),children:[s.jsx(ur,{isFocused:p,isHovered:h}),s.jsx("button",{className:C("text-token-text-secondary -me-1 rounded-full bg-transparent p-1",{"hover:text-token-text-primary cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700":!g,"cursor-not-allowed":g}),onClick:f,disabled:g,"aria-label":B.formatMessage({id:"fYDa3C",defaultMessage:"Dismiss comment"}),children:s.jsx(Ms,{className:"icon-sm"})})]}),s.jsx(fr,{comment:a,isFocused:p,isHovered:h,isSomeCommentFocused:m}),s.jsx(pe,{initial:!1,children:q&&s.jsx(M.div,{initial:o?!1:{opacity:0,height:0},animate:{opacity:1,height:"auto",transition:{opacity:{delay:.14,duration:.2},height:{bounce:0,duration:.2}}},exit:o?void 0:{opacity:0,height:0,transition:{opacity:{duration:.08},height:{bounce:0,duration:.2}}},className:"flex items-center justify-start",children:s.jsx("div",{className:"mt-2.5",children:s.jsx(se,{color:"secondary",onClick:l,disabled:g,children:e!=null?e:B.formatMessage({id:"WIW5OL",defaultMessage:"Apply"})})})})})]})})},Xt=d.forwardRef(mr),Ta=({offsetY:e,opensOverDocument:t=!1,disableActions:n=!1,isFocused:r=!1,isSomeCommentFocused:a=!1,onAccept:o,onClick:i,onDismiss:c,onMouseEnter:u,onMouseLeave:l,comment:f,isHovered:x=!1})=>{const p=d.useRef(null);return d.useEffect(()=>As(document,{mousedown:({target:m})=>{var g;m instanceof HTMLElement&&!m.closest("[data-comment-id]")&&!((g=p.current)!=null&&g.contains(m))&&Me.blurComment()}})),s.jsx(Xt,{ref:p,comment:f,disableActions:n,onAccept:o,onDismiss:c,onMouseEnter:u,onMouseLeave:l,isSomeCommentFocused:a,isHovered:x,onClick:i,translateY:e,isFocused:r,left:t?void 0:dn,right:t?cn:void 0})};var ne=(e=>(e.LOADING="loading",e.READY="ready",e.RESOLVED="resolved",e))(ne||{});const Kt=({hint:e,onClickFix:t,isOpen:n,onOpenChange:r})=>{var i;const a=d.useRef(null),o=ce();return e?s.jsx("div",{className:"relative flex items-center font-sans",onClick:c=>c.stopPropagation(),children:s.jsxs(Xs,{open:n,onOpenChange:r,children:[s.jsx(Ks,{asChild:!0,ref:a,children:e.status==="resolved"?s.jsx("div",{className:"flex h-5 w-5 items-center",children:s.jsx(Zs,{className:"text-token-text-tertiary",size:16})}):s.jsx("button",{className:"h-5 w-5",disabled:e.status==="loading",children:e.status==="loading"?s.jsx(nt,{}):s.jsx(dr,{position:"static",isError:!0,count:1,offsetY:0})})}),s.jsx(pe,{children:n&&s.jsx(Js,{forceMount:!0,container:(i=a.current)==null?void 0:i.ownerDocument.body,children:s.jsx(Qs,{side:"top",align:"start",alignOffset:-4,sideOffset:10,children:s.jsx(Xt,{position:"static",translateY:0,right:0,isFocused:!0,onDismiss:()=>r==null?void 0:r(!1),onAccept:c=>{r==null||r(!1),t==null||t(c)},comment:e,acceptButtonLabel:o.formatMessage({id:"Dl9vBh",defaultMessage:"Fix bug"})})})})})]})}):s.jsx("div",{className:"w-5"})},xr="module:",Ye=({log:e,isDisabled:t=!1,onClick:n})=>s.jsx("div",{className:"flex items-center",children:"line"in e&&e.line!=null&&s.jsxs("button",{onClick:()=>e.line!=null&&(n==null?void 0:n(e.line)),className:"text-token-text-tertiary select-none enabled:hover:underline",disabled:t,children:[xr,e.line]})}),pr=({isPreview:e=!1,log:t,level:n})=>s.jsxs("span",{className:C("text-token-text-primary flex min-w-0 flex-wrap gap-1",e?"shrink truncate":"whitespace-pre-wrap",n==="warn"&&"text-yellow-600"),children:[n==="warn"&&"[warn]: ",typeof t=="string"?t:t.map((r,a)=>s.jsx(gn,{isPreview:e,value:r},a))]}),Zt=({error:e,isPreview:t=!1,isResolved:n=!1})=>{const r=e.name+":";return s.jsxs("span",{className:C("whitespace-pre-wrap",n?"text-token-text-primary":"text-red-500"),children:[s.jsx("span",{className:"font-semibold",children:r})," ",e.message,s.jsx("div",{children:e.stack.length>0&&!t?e.stack.join("\n"):""})]})},hr=({output:e,isPreview:t=!1})=>{const n=ce();return e==null?null:zt(e)?s.jsx("img",{alt:n.formatMessage(yr.imgAlt),className:C(t&&"border-token-border-xlight h-6 rounded-lg border"),src:e}):s.jsx("span",{className:"flex items-center gap-2",children:Qe(e)})},rt=({log:e,isHintResolved:t,isPreview:n=!1})=>{switch(e.type){case I.LOG:return s.jsx(pr,v({isPreview:n},e));case I.ERROR:return s.jsx(Zt,v({isPreview:n,isResolved:t},e));case I.OUTPUT:return s.jsx(hr,v({isPreview:n},e));default:return null}},gr=({log:e,isStale:t=!1,onClickFix:n,onClickLineNumber:r,hint:a})=>{const[o,i]=d.useState(!1);if(e.type===I.RUN_COMPLETE)return null;const c=(a==null?void 0:a.status)===ne.RESOLVED,u=e.type===I.ERROR&&(a==null?void 0:a.status)===ne.READY;return s.jsx(ve,{hasHint:u,isHintOpen:o,bottomBorder:!0,onClick:a&&!c&&(()=>i(!0)),contentBefore:s.jsx(Kt,{hint:a,isOpen:o,onOpenChange:i,onClickFix:l=>e.type===I.ERROR&&a&&(n==null?void 0:n(l,a.id,e.error))}),contentAfter:s.jsx(Ye,{log:e,isDisabled:t,onClick:r}),children:s.jsx(rt,{log:e,isHintResolved:c})})},yr=Le({imgAlt:{id:"L6t7Yb",defaultMessage:"Plot"},ranCode:{id:"ffa9Nt",defaultMessage:"Ran code"},askForHelp:{id:"wMZco9",defaultMessage:"Ask ChatGPT for help"},askForFix:{id:"A9pxgT",defaultMessage:"Fix it for me"}}),vr=({timestamp:e,duration:t})=>{const[,n]=d.useState(0);d.useEffect(()=>{setInterval(()=>{n(o=>o+1)},5e3)},[]);const r=Date.now(),a=Math.round((r-e)/1e3);return s.jsx(De,{label:s.jsx(A,{id:"bFO21A",defaultMessage:"Code ran {count, plural, =0 {instantly} one {in # second} other {in # seconds}}",values:{count:Math.floor(t/1e3)}}),children:s.jsx("span",{className:"text-token-text-tertiary",children:a>=60?s.jsx(fs,{value:-a,updateIntervalInSeconds:60,numeric:"auto"}):s.jsx(A,{id:"bRCEFN",defaultMessage:"Just now"})})})},Jt=({isComplete:e,timestamp:t,duration:n})=>e&&t!=null&&n!=null?s.jsx(vr,{timestamp:t,duration:n}):e&&n==null?s.jsx("span",{className:"text-token-text-tertiary",children:s.jsx(A,{id:"EMebM9",defaultMessage:"Stopped"})}):s.jsx(Oe,{gap:2}),br=e=>{switch(e){case te.INITIALIZING:return s.jsx(A,{id:"J183Z0",defaultMessage:"initializing environment"});case te.INSTALLING_PACKAGES:return s.jsx(A,{id:"21sQ8o",defaultMessage:"installing packages"});case te.RUNNING_CODE:return s.jsx(A,{id:"nHITHk",defaultMessage:"running code"})}},ke=e=>{"use forget";const t=ms.c(6),{message:n,isComplete:r,statusLogs:a}=e;let o;if(t[0]!==r||t[1]!==n||t[2]!==a){const i=Ge(a);let c;t[4]!==n?(c=s.jsx("span",{className:"text-token-text-secondary font-semibold",children:s.jsx(A,v({},n))}),t[4]=n,t[5]=c):c=t[5],o=s.jsxs("span",{className:"flex items-center",children:[c,!r&&i&&s.jsxs(M.span,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{delay:.3,duration:.1},className:"text-token-text-tertiary ms-2 flex items-baseline",children:[br(i.status),s.jsx(Oe,{gap:2,size:2})]})]}),t[0]=r,t[1]=n,t[2]=a,t[3]=o}else o=t[3];return o},Er=({children:e,firstLog:t,lastLog:n,isHintResolved:r,duration:a,isComplete:o=!1,isLast:i=!1,statusLogs:c})=>{const[u,l]=d.useState(!0),[f,x]=d.useState(!1),p=()=>{l(!u)},m=d.useCallback(g=>{if(!g)return;const h=new IntersectionObserver(w=>{x(w[0].intersectionRatio===0)},{threshold:0});return h.observe(g),()=>{h.disconnect()}},[]);return s.jsxs("li",{className:"relative flex flex-col",children:[s.jsx("div",{"aria-hidden":"true",className:"pointer-events-none absolute h-[1px] bg-transparent",ref:m}),s.jsxs(ve,{as:"div",disableEntryAnimation:!0,isSticky:!0,bottomBorder:f||!i&&!u,contentAfter:s.jsx(Jt,{isComplete:o,duration:a,timestamp:t==null?void 0:t.timestamp}),contentBefore:s.jsx("button",{className:"text-token-text-tertiary",onClick:()=>p(),children:s.jsx(en,{className:C("icon transition-transform",u&&"rotate-90")})}),onClick:()=>p(),children:[s.jsx(ke,{isComplete:o,message:Te.run,statusLogs:c}),!u&&n&&s.jsx(rt,{isPreview:!0,isHintResolved:r,log:n})]}),u&&e]})},wr=({runMessages:e,onClickFix:t,onClickLineNumber:n,hints:r,isLast:a,includeContentBefore:o=!1})=>{var j;const[i,c]=d.useState(!1),u=e.filter(b=>b.type===I.ENVIRONMENT_STATUS),l=e.filter(qt),f=Ge(e),x=(f==null?void 0:f.type)===I.RUN_COMPLETE,p=x?f.duration:null,m=l[0];if(x){if(l.length===0)return s.jsx(ve,{isHintOpen:i,bottomBorder:!0,contentBefore:o,contentAfter:s.jsx(Jt,{isComplete:x,duration:p,timestamp:m==null?void 0:m.timestamp}),children:s.jsx(ke,{isComplete:x,message:Te.success,statusLogs:u})});if(l.length===1&&(m==null?void 0:m.type)===I.ERROR){const b=r.get(m.id);return s.jsxs(ve,{hasHint:!!b,isHintOpen:i,bottomBorder:!0,contentBefore:(o||!!b)&&s.jsx(Kt,{hint:b,isOpen:i,onOpenChange:c,onClickFix:y=>t==null?void 0:t(y,m.id,m.error)}),contentAfter:s.jsx(Ye,{log:m,onClick:n}),onClick:b&&b.status!==ne.RESOLVED&&(()=>c(!0)),children:[s.jsx(ke,{isComplete:x,message:Te.run,statusLogs:u}),s.jsx(Zt,v({isResolved:(b==null?void 0:b.status)===ne.RESOLVED},m))]})}else if(l.length===1&&m&&!Wt(l[0]))return s.jsxs(ve,{bottomBorder:!0,contentBefore:o,contentAfter:s.jsx(Ye,{log:m,onClick:n}),children:[s.jsx(ke,{isComplete:x,message:Te.run,statusLogs:u}),s.jsx(rt,{log:m})]})}const g=Ge(l.filter(b=>b.type!==I.RUN_COMPLETE)),h=g&&r.get(g.id),w=(h==null?void 0:h.status)===ne.RESOLVED;return s.jsx(Er,{statusLogs:u,firstLog:(j=e[0])!=null?j:null,lastLog:g!=null?g:null,duration:p,isComplete:x,isHintResolved:w,isLast:a,children:s.jsx("ol",{children:l.map(b=>s.jsx(gr,{log:b,onClickLineNumber:n,onClickFix:t,hint:r.get(b.id)},b.id))})})},Te=Le({success:{id:"laZI5H",defaultMessage:"Run successfully"},run:{id:"o7dgBT",defaultMessage:"Run"}}),jr=({messages:e,scrollRef:t,onClose:n,onClickLineNumber:r,onClickFix:a,title:o,headerActions:i,hints:c,paddingBottom:u})=>{const l=c.size>0,f=d.useMemo(()=>Object.entries(Ls(e,"runId")),[e]),x=f.some(([,p])=>{const m=p.filter(qt);return m.length>1||m.length===1&&Wt(m[0])});return s.jsxs(s.Fragment,{children:[s.jsx(ir,{title:o,actions:i,onClose:n,showBorder:e.length>0}),s.jsx("div",{ref:t,className:"bg-token-bg-primary flex flex-1 flex-col-reverse overflow-auto",children:s.jsx("ol",{className:"flex flex-1 flex-col justify-start pb-4",style:{paddingBottom:u},children:s.jsx(pe,{children:f.map(([p,m],g)=>s.jsx(wr,{runMessages:m,includeContentBefore:x||l,onClickFix:a,onClickLineNumber:r,hints:c,isLast:g===f.length-1},p))})})})]})},Sr=({onDrag:e,onDragEnd:t,onDoubleClick:n})=>s.jsx(M.div,{drag:"y",className:"bg-token-text-quaternary absolute top-[-2px] z-10 h-[4px] w-full cursor-ns-resize opacity-0",whileHover:{opacity:.5},whileDrag:{opacity:.75,height:"8px",top:"-4px"},transition:{type:"tween",duration:.1},style:{x:0,y:0,transform:"translateY(0px)"},dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:{left:0,right:0,top:0,bottom:0},onDrag:(r,a)=>{e==null||e(a)},onDragEnd:t,onDoubleClick:n}),Nr=({textdocTitle:e,onClickViewConsole:t,onClickFix:n,onDismiss:r})=>s.jsxs(M.div,{initial:{scale:.95,opacity:0},exit:{scale:.95,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",bounce:.12,duration:.3},className:"border-token-border-default bg-token-main-surface-primary absolute end-2 bottom-2 flex w-fit max-w-80 flex-col gap-4 rounded-xl border px-4 py-4 shadow-xl",children:[s.jsxs("div",{className:"flex items-start",children:[s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsx("div",{className:"text-sm font-semibold",children:s.jsx(A,{id:"ObCQBq",defaultMessage:"Cannot preview your code"})}),s.jsx("div",{className:"text-sm",children:s.jsx(A,{id:"3ZeoP8",defaultMessage:"An error occured while trying to run {name}",values:{name:e}})})]}),s.jsx(se,{size:"small",color:"ghost",as:"button",className:"text-token-text-tertiary -m-1! aspect-square p-0!",onClick:r,icon:et})]}),s.jsxs("div",{className:"flex items-center justify-end gap-2",children:[s.jsx(se,{size:"small",color:"secondary",onClick:t,children:s.jsx(A,{id:"Fch32I",defaultMessage:"View console"})}),s.jsx(se,{size:"small",color:"primary",onClick:n,children:s.jsx(A,{id:"HRfYX0",defaultMessage:"Fix bug"})})]})]}),Qt=(e,{name:t,message:n,line:r,stack:a})=>{const o=r!=null?"\n\nError occured in:\n".concat(e.split("\n").slice(r-1,r+1).join("\n")):"";return"".concat(t,": ").concat(n,"\n\nStack:\n").concat(a.join("")).concat(o)},Ue=new tn({capacity:5}),Cr=async(e,t,n)=>{var i;const r=Qt(t,n.error),a=Qe(Ue.get(r));if(Ue.get(r))return a;const{hint:o}=await je.safePost("/textdoc/{textdoc_id}/code/hint",{parameters:{path:{textdoc_id:e}},requestBody:{error:r,line:(i=n.error.line)!=null?i:-1}});return Ue.set(r,o),o},kr="You're a professional developer highly skilled in debugging. The user ran the textdoc's code, and an error was thrown.\nPlease think carefully about how to fix the error",Tr=(e,t,n)=>{const r=Qt(e,n);return"\n".concat(kr,", and then rewrite the textdoc to fix it.\n\n- NEVER change existing test cases unless they're clearly wrong.\n- ALWAYS add more test cases if there aren't any yet.\n- ALWAYS ask the user what the expected behavior is in the chat if the code is not clear.\n\n").concat(t?"# Hint\n\n".concat(t,"\n\n"):"","\n# Error\n\n").concat(r).trim()},_r=({sandboxRef:e,textdocContent:t,textdocTitle:n,textdocId:r,isOpen:a,isTextdocAttachedPending:o,headerActions:i=[],highlightLine:c,createTextdocTurn:u,onOpenChange:l},f)=>{const[x,p]=d.useState(!1),[m,g]=d.useState(!1),[h,w]=d.useState([]),[j,b]=d.useState(0),[y,R]=d.useState(null),[k,D]=d.useState(null),[$,B]=d.useState(()=>new Map),[q,Y]=d.useState(320),z=d.useRef(null),X=ce();d.useEffect(()=>D(null),[t]);const K=h.filter(E=>[I.LOG,I.ERROR,I.OUTPUT].includes(E.type)).length;d.useEffect(()=>{a&&b(K)},[a]);const O=d.useMemo(()=>{for(let E=h.length-1;E>=0;E--){const _=h[E];if(_.runId!==k)return null;if(_.type===I.ERROR)return _}return null},[h,k]),Z=(E,_,F)=>{var V;const P=$.get(_);if(P){const{id:ge,content:Pe}=P;B(is=>{const H=new Map(is);return H.set(ge,{id:ge,content:Pe,status:ne.RESOLVED}),H})}R(_),u({sourceEvent:E,action:de.EDIT,userMessageType:U.CONSOLE,content:Tr(t,(V=P==null?void 0:P.content)!=null?V:null,F)})},oe=async(E,_)=>{if(!o){B(F=>{const P=new Map(F);return P.set(E,{id:E,status:ne.LOADING,content:""}),P});try{const F=await Cr(r,t,_);B(P=>{const V=new Map(P);return V.set(E,{id:E,status:ne.READY,content:F}),V})}catch(F){B(P=>{const V=new Map(P);return V.delete(E),V})}}},S=async(E,_)=>{const F=un(E,_),P=fn(E,_),V=mn(E);if(!F||!V&&!P)return;V&&(l==null||l(!0)),g(!0),w(Q=>Q.map(ie=>L(v({},ie),{isStale:!0})));let ge=!1;const Pe=xe(e.current).evalAsync({code:_,language:F});try{for(var is=He(Pe),H,Se,Fa;H=!(Se=await is.next()).done;H=!1){const Q=Se.value;if(Q.type===I.RUN_START&&requestAnimationFrame(()=>{var ie;(ie=z.current)==null||ie.scrollTo({top:0,behavior:"smooth"})}),Q.type===I.ERROR){if(Q.line!=null){const{line:ie}=Q;requestAnimationFrame(()=>c(ie))}ge=!0,oe(Q.id,Q)}D(Q.runId),w(ie=>[...ie,L(v({},Q),{isStale:!1})])}}catch(Se){Fa=[Se]}finally{try{H&&(Se=is.return)&&await Se.call(is)}finally{if(Fa)throw Fa[0]}}ge&&(l==null||l(!0)),g(!1)};d.useImperativeHandle(f,()=>({runCode:S,stopCode:()=>{var E;return(E=e.current)==null?void 0:E.stop()}}));const T=!a&&m,N=T&&O&&O.id!==y,J=!N&&T&&K>j;return s.jsxs(pe,{children:[x&&s.jsx("div",{className:"pointer-events-auto absolute inset-0 bg-transparent"},"drag-overlay"),J&&s.jsx(M.button,{initial:{scale:.95,opacity:0},exit:{scale:.95,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",bounce:.12,duration:.3},className:"bg-token-bg-primary hover:bg-token-bg-secondary absolute end-2 bottom-2 flex items-center gap-2 rounded-full px-3 py-1.5 shadow-lg",onClick:()=>l==null?void 0:l(!0),children:s.jsxs("span",{className:"text-token-text-secondary flex items-center gap-1 text-sm",children:[s.jsx(sn,{className:"icon-sm"}),s.jsx(A,{id:"etzFTa",defaultMessage:"{numLogs, plural, one {{numLogs} message} other {{numLogs} messages}}",values:{numLogs:K}})]})},"view-console"),N&&s.jsx(Nr,{textdocTitle:n,onClickViewConsole:()=>l==null?void 0:l(!0),onDismiss:()=>R(O.id),onClickFix:E=>{Z(E,O.id,O.error)}},"error-modal"),a&&s.jsxs(M.div,{initial:{translateY:"100%",opacity:0},animate:{translateY:"0%",opacity:1},exit:{translateY:"100%",opacity:0},transition:{type:"spring",bounce:0,duration:.48},className:"border-token-border-default relative z-10 w-full border-t shadow-[0px_0px_32px_rgba(0,0,0,0.08)]",children:[s.jsx(Sr,{onDragEnd:()=>p(!1),onDrag:({delta:{y:E}})=>{p(!0),Y(_=>_-E)}}),s.jsx("div",{className:"flex flex-col",style:{height:q},children:s.jsx(jr,{scrollRef:z,messages:h,onClose:()=>l==null?void 0:l(!1),onClickLineNumber:c,onClickFix:Z,title:X.formatMessage({id:"P9VJDk",defaultMessage:"Console"}),headerActions:[...i,{tooltip:X.formatMessage({id:"gAICYK",defaultMessage:"Clear console"}),icon:nn,onClick:()=>{b(0),w([]),B(new Map)}}],hints:$})})]},"console")]})},_a=d.forwardRef(_r);function Ae(e){if(e.type.name!=="text"){const{start:a,end:o}=e.attrs;return a==null||o==null?null:{start:a,end:o}}const t=e.marks.find(a=>a.type.name===jn.proseMirrorMarkName());if(!t)return null;const{start:n,end:r}=t.attrs;return n==null||r==null?null:{start:n,end:r}}function Ir(e,t){const{parent:n,textOffset:r}=t,a=e.nodeAt(t.pos);if(!a)return xe(Ae(n)).end;const{start:o}=xe(Ae(a));return o+r}function Rr(e,t){const n=e.nodeAt(t.pos);if(n){const{start:r}=xe(Ae(n));return r+t.textOffset}return xe(Ae(t.parent)).end}function Ia(e,t){const n=new Map;for(const[r,a]of t){const o=Ir(e,e.resolve(a.start)),i=Rr(e,e.resolve(a.end));n.set(r,{start:o,end:i})}return n}const Mr=d.createContext(()=>null),Ar=d.createContext(null),Lr=d.createContext(0),Ra=()=>d.useContext(Mr),Ma=()=>d.useContext(Ar),Aa=()=>d.useContext(Lr),Dr=d.createContext(()=>null),Or=d.createContext(null),La=d.createContext(0),Da=()=>d.useContext(Dr),Oa=()=>d.useContext(Or),Br=/\s/,Pr=30;function pt(e,t){const n=e.indexOf(t);return n===-1?!1:e.indexOf(t,n+t.length)===-1}function le(e,t){return Br.test(e[t])}function ht(e,t,n=!1){if(t===0||n&&le(e,t-1))return t;for(;t>0&&le(e,t-1);)t--;for(;t>0&&!le(e,t-1);)t--;return le(e,t)&&t++,t}function gt(e,t,n=!1){if(t===e.length||n&&le(e,t))return t;for(;t<e.length&&le(e,t);)t++;for(;t<e.length&&!le(e,t);)t++;return le(e,t-1)&&t--,t}function $r(e,t,n=!0,r=Pr){if(e.start<0||e.end>t.length||e.start>e.end)throw new Error("Invalid commentSourceRange provided.");const a=t.substring(e.start,e.end);let o=e.start,i=e.end;n&&(o=ht(t,o,!0),i=gt(t,i,!0));let c=t.substring(o,e.start),u=t.substring(e.end,i),l="".concat(c).concat(a).concat(u);if(pt(t,l)&&(r==null||l.length>=r))return{before:c,after:u,allSurrounding:l};let f=o,x=i,p=!0;for(;p&&(r==null||l.length<r);){let m=!1;const g=f>0?ht(t,f):f;g<f&&(f=g,m=!0);const h=x<t.length?gt(t,x):x;if(h>x&&(x=h,m=!0),m){const w=t.substring(f,e.start),j=t.substring(e.end,x),b="".concat(w).concat(a).concat(j);if(pt(t,b)&&(r==null||b.length>=r))return{before:w,after:j,allSurrounding:b};c=w,u=j,l=b}else p=!1}return{before:c,after:u,allSurrounding:l}}const be="# Context",Ee="# Instructions";function we(e,t,n){if(t==null||n==null)return'The user is referring to the entire text of "'.concat(e,'".');const r='\n## Selected Text\nThe user has selected this text in "'.concat(e,'" in particular:\n').concat(t,"\n").trim();return n.allSurrounding===t?r:"\n".concat(r,"\n\n## Surrounding Context\nHere is the surrounding context:\n").concat(n.allSurrounding,"\n").trim()}function es(e,t){return e==null||t==null?"entire document":e===t.allSurrounding?"selected text":"surrounding context"}function ts(e){return"For the update pattern, create a regex which exactly matches the ".concat(e,". Edit just this string in order to fullfill the user's request. NEVER rewrite the entire document. Instead, ALWAYS edit ONLY the ").concat(e,". The only exception to this rule is if the ").concat(e,' includes markdown lists or tables. In that case, fully rewrite the document using ".*" as the regex update pattern.').trim()}function Hr(e,t,n,r){if(!Bt(t)&&n&&r){const a=es(n,r);return"\n".concat(be,"\nThe user requests that you directly edit the document.\n\n").concat(we(e,n,r),"\n\n").concat(Ee,"\nUse the update_textdoc tool to make this edit. ").concat(ts(a)).trim()}return"\n".concat(be,"\nThe user requests that you directly edit the document.\n\n").concat(we(e,n,r),"\n\n").concat(Ee,'\nUse the update_textdoc tool to make this edit. You MUST fully rewrite the entire document by using ".*" as the update regex pattern.').trim()}function Ur(e,t,n){return"\n".concat(be,"\nThe user requests that you add comments about some text.\n\n").concat(we(e,t,n),"\n\n").concat(Ee,"\nDo not respond to the user's question directly, just leave comments.").trim()}function Fr(e,t){return Bt(e)?t==="entire document"?" If you choose to update the ".concat(t,", you MUST fully rewrite the ").concat(t,' by using ".*" as the update regex pattern.'):" If you choose to update the ".concat(t,', you MUST fully rewrite the entire document by using ".*" as the update regex pattern. When you do so, ONLY modify the ').concat(t," and rewrite other sections exactly as is, except for parts that must change based on this update"):t==="entire document"?"":" If you choose to update the ".concat(t,", follow these instructions: ").concat(ts(t))}function Gr(e,t,n,r){const a=es(n,r),o=Fr(t,a);return"\n".concat(be,"\n").concat(we(e,n,r),"\n\n").concat(Ee,"\nThe user would like you perform one of the following actions:\n- Update the ").concat(a," via the `update_textdoc` tool.").concat(o,"\n- Explain the selected text via chat, or answer a general question about the selected text (no tool call required).\n- Comment on the ").concat(a," with feedback via the `comment_textdoc` tool. This should only be used if the user very explicitly asks for feedback, critique, or comments.\n\nBased on the user's request, choose the appropriate action.\n").trim()}function qr(e,t,n){return"\n".concat(be,"\n").concat(we(e,t,n),"\n\n").concat(Ee,"\nThe user would like you to create a new textdoc.\n").trim()}function Wr(e,t,n,r=null,a=null){switch(n){case de.ASK:return Gr(e,t,r,a);case de.CREATE_TEXTDOC:return qr(e,r,a);case de.EDIT:return Hr(e,t,r,a);case de.COMMENT:return Ur(e,r,a)}}function zr(e){switch(e){case U.ACCELERATOR:case U.CONSOLE:case U.ACCEPT_COMMENT:case U.HIVE_SPEAKER_EDIT:return!0;case U.ASK_CHATGPT:case U.FULL_SCREEN_SUBMIT:return!1}}function Vr(e,t){switch(t){case U.ASK_CHATGPT:case U.ACCEPT_COMMENT:case U.FULL_SCREEN_SUBMIT:return e.formatMessage(Xr.askChatGPT);case U.ACCELERATOR:case U.CONSOLE:case U.HIVE_SPEAKER_EDIT:return}}const Yr=(e,t)=>{const n=ce(),r=rn(e),a=an(e),o=Ds();return d.useCallback(async({content:i,sourceRange:c,action:u,userMessageType:l,acceleratorMetadata:f,selectionMetadata:x,sourceEvent:p})=>{if((t==null?void 0:t.versionInt)==null||o)return;const{textdocId:m,type:g,versionInt:h,content:w}=t;let j,b=null;c&&c.start!==c.end&&(j=w.slice(c.start,c.end),b=$r(c,w));const y=Wr(m,g,u,j,b),k=Os(y,{exclude_after_next_user_message:!0});a({sourceEvent:p,promptMessage:Bs(i,{canvas:{textdoc_id:m,textdoc_type:g,version:h,textdoc_content_length:w.length,user_message_type:l,accelerator_metadata:f,selection_metadata:x},is_visually_hidden_from_conversation:zr(l),targeted_reply:j,targeted_reply_label:Vr(n,l),open_in_canvas_view:{type:"canvas_textdoc",id:m}}),completionMetadata:r?{conversationMode:r}:void 0,appendMessages:[k]})},[t,o,a,r,n])},Xr=Le({askChatGPT:{id:"h5ANdM",defaultMessage:"Asked ChatGPT"}}),Kr=(e,t,n=1)=>{xs(e.scrollTop,t,{duration:n,ease:"easeInOut",onUpdate:r=>{e.scrollTop=r}})};var bt;const ss=W.div(bt||(bt=G(["flex w-full grow flex-col gap-1 rounded-xl p-2 pe-5 text-sm"])));var Et;const Zr=W.input(Et||(Et=G(["ms-[-2px] w-auto rounded-none border-none bg-[#E5F3FF] p-0 px-0.5 text-sm font-semibold outline-none focus:outline-none"])));var wt;const Jr=W(M.span)(wt||(wt=G(["start border-token-text-tertiary absolute -bottom-0.5 w-full origin-left border-b border-solid"])));var jt;const Qr=W(M.span)(jt||(jt=G(["start border-token-text-tertiary absolute -bottom-0.5 w-full border-b border-dashed"])));var St;const Ne=W.div(St||(St=G(["w-full loading-results-shimmer bg-token-bg-secondary h-2 rounded-full"]))),ea=()=>s.jsxs(ss,{className:"gap-2",children:[" ",s.jsx(Ne,{className:"w-[48px]"})," ",s.jsx(Ne,{})," ",s.jsx(Ne,{})," ",s.jsx(Ne,{className:"w-1/2"})]}),ta={initial:{scaleX:0,opacity:1},animate:{scaleX:1,opacity:0,transition:{scaleX:{duration:.85,ease:[.65,0,.35,1]},opacity:{delay:.85,duration:.1}}}},sa={initial:{opacity:0},animate:{opacity:1,transition:{delay:.85,duration:.1}}};var Nt;W.div(Nt||(Nt=G(["ms-2 rounded-full px-2 py-0.5 text-xs font-medium"])));const ns=({speakerId:e,content:t,range:n,filterDecision:r,isEditing:a,isSaving:o,containerRef:i,measuredTextContainerRef:c,isEditingEnabled:u})=>{var Z,oe,S,T;const l=d.useRef(null),{setSpeakers:f,setEditingSpeaker:x,hoveringSpeakerId:p,setHoveringSpeakerId:m,speakers:g,editingSpeaker:h,enableDebugger:w}=Re.getState(),j=Re(N=>N.currentTime),b=n.max==null?j===n.min:j>=n.min&&j<=n.max;d.useEffect(()=>{if(b&&l.current&&i.current){const N=i.current,J=l.current,E=N.getBoundingClientRect().top,F=J.getBoundingClientRect().top-E+N.scrollTop-20;Kr(N,F,.3)}},[n.min,n.max,b,i]);const y=g.get(e),R=!!(y!=null&&y.storedName)&&y.storedName!==(y==null?void 0:y.placeholderName)||((Z=y==null?void 0:y.isEdited)!=null?Z:!1),k=(T=(S=(oe=y==null?void 0:y.name)!=null?oe:y==null?void 0:y.storedName)!=null?S:y==null?void 0:y.placeholderName)!=null?T:"Unidentified Speaker",D=d.useRef(null),$=e===(h==null?void 0:h.id),B=e===p,[q,Y]=d.useState(!1),[z,X]=d.useState(!1);d.useEffect(()=>{var N;D.current&&(!$||!z||((N=D.current)==null||N.focus(),R&&(D.current.value=k)))},[R,$,z,k]),Ps(()=>{if(c!=null&&c.current&&D.current){const N=c.current.offsetWidth;D.current.style.width="".concat(N,"px")}},[h==null?void 0:h.name]);const K=d.useCallback(()=>{if(!h||!y)return;x(null),X(!1),Y(!1),m(null);const N=g.set(e,L(v({},y),{name:h.name?h.name:y.placeholderName,isEdited:!!h.name}));f(N)},[h,y,x,m,g,e,f]),O=!a||o;return s.jsxs(ss,{ref:l,className:C(b&&"animate-[hive-log-fadeout_0.3s_1.5s_forwards] bg-blue-500/10",!1,!1),children:[!1,s.jsxs("div",{className:"mb-[1px] flex w-full items-center justify-between",children:[u&&($?s.jsx(Zr,{ref:D,disabled:!z,onBlur:K,className:C(!$&&"hidden w-0"),placeholder:y!=null&&y.isEdited||y==null?void 0:y.placeholderName,value:h==null?void 0:h.name,onKeyDown:N=>{N.key==="Enter"&&K()},onChange:N=>x({id:e,name:N.target.value})}):s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsxs("div",{onClick:()=>{O||(x({id:e,name:R?k:""}),X(!0))},onMouseEnter:()=>{O||(m(e),Y(!0))},onMouseLeave:()=>{O||(m(null),Y(!1))},className:C("relative flex font-semibold transition-colors",{"text-blue-400!":B&&!O},{"cursor-pointer":!O},{"text-token-text-tertiary":!O&&!R}),children:[k,!O&&!R&&s.jsxs(s.Fragment,{children:[s.jsx(Jr,v({},ta)),s.jsx(Qr,L(v({},sa),{className:C(B&&!O&&"border-blue-400!")}))]})]}),q&&!O&&s.jsx(Pt,{className:"h-4 w-4 text-blue-400"}),!1]})),s.jsx("div",{className:"text-xs text-[#5D5D5D]",children:Sn(n.min)})]}),s.jsx("div",{className:"flex",children:t})]})},na=e=>Xe({queryKey:["sharedHiveLog",e],queryFn:()=>je.safeGet("/hive/textdoc/shared/{shared_textdoc_id}/transcript",{parameters:{path:{shared_textdoc_id:e}}}),select:$t}),ra=e=>Xe({queryKey:["hiveLog",e],queryFn:()=>je.safeGet("/hive/{hive_id}/transcript",{parameters:{path:{hive_id:e}}}),enabled:!!e,select:$t}),aa=()=>Xe({queryKey:["hiveLogPrompts"],queryFn:()=>je.safeGet("/hive/prompts"),enabled:!0}),oa=(e,t)=>je.safePost("/hive/{hive_id}/speakers",{parameters:{path:{hive_id:e}},requestBody:{speakers:t}});var Ct;const ia=W.div(Ct||(Ct=G(["invisible absolute start-0 top-0 rounded-md border px-0.5 text-sm font-semibold whitespace-pre"]))),la=(e,t)=>!t||!e?"":t.isEdited||e.name&&e.name!==t.placeholderName?e.name:t.placeholderName,rs=()=>s.jsx(Us,{children:s.jsx(A,v({},fe.researchPreview))});var kt;const ca=W.div(kt||(kt=G(["flex h-full w-full max-w-[360px] min-w-[240px] flex-col border-l border-gray-200"])));var Tt;const da=W.div(Tt||(Tt=G(["flex w-full max-w-[360px] min-w-[240px] flex-col border-l border-gray-200"])));var _t;const ua=W.div(_t||(_t=G(["bg-token-bg-primary mt-[0.5px] flex h-18 w-full items-center justify-between border-b-[0.5px] border-gray-200 p-4"])));var It;const as=W.div(It||(It=G(["flex h-full w-full flex-col gap-2 overflow-y-auto p-2"])));var Rt;const yt=W(M.div)(Rt||(Rt=G(["flex items-center gap-2"]))),vt={initial:{opacity:0,y:-4},animate:{opacity:1,y:0,transition:{duration:.2}},exit:{opacity:0,y:-4,transition:{duration:.2}}},Ba="ts",Pa=({sharedTextDocId:e})=>{const t=na(e),n=d.useRef(null),r=$s(),{selectedFilters:a,isOpen:o,currentTime:i,closeSidebar:c}=Re(),u=d.useMemo(()=>{var x;return(x=t.data)==null?void 0:x.filter(({filterDecision:p})=>!p||(a==null?void 0:a.includes(p)))},[t.data,a]);if(t.isError)return null;const l=s.jsxs("div",{className:"text-token-text-secondary flex items-center gap-1.5 px-2 py-2 text-base font-medium md:px-0",children:[s.jsx(A,v({},fe.transcript)),s.jsx(rs,{})]}),f=s.jsxs(s.Fragment,{children:[t.isLoading&&Array.from({length:16}).map((x,p)=>s.jsx(ea,{},"loading-".concat(p))),u==null?void 0:u.map(x=>s.jsx(ns,v({isEditingEnabled:!1,containerRef:n},x),os(x)))]});return!o||!i?null:r?s.jsxs(da,{children:[s.jsxs(ua,{children:[l,s.jsx(Hs,{onClick:c})]}),s.jsx(as,{ref:n,children:f})]}):s.jsx(Mt,{contentRef:n,testId:"modal-shared-canvas-transcript-modal",isOpen:o,title:l,contentClassName:"overflow-y-auto gap-2 p-2 flex flex-col",showCloseButton:!0,onClose:c,children:f})},$a=({hiveId:e,clientThreadId:t,ts:n,textdocVersion:r})=>{const a=ra(e),o=aa(),i=ce(),[c,u]=d.useState(!1),l=d.useRef(null),f=At(),x=Fs(f,"2986567482"),{isOpen:p,closeSidebar:m,openSidebar:g,setCurrentTime:h,speakers:w,setSpeakers:j,editingSpeaker:b,enableDebugger:y,setEnableDebugger:R,selectedFilters:k,setSelectedFilters:D}=Re();d.useEffect(()=>{n!==void 0&&(g(),h(n))},[n,g,h]);const $=d.useRef(null),[B,q]=d.useState(!1),Y=Yr(t,r);if(a.isLoading||o.isLoading||a.isError||o.isError||!a.data||!o.data)return null;const z=b?w.get(b.id):null,X=Array.from(w.values()).some(({isEdited:S})=>S),K=()=>{const S=new Map(Array.from(w.entries()).map(([T,N])=>[T,L(v({},N),{name:void 0,isEdited:!1})]));j(S),u(!1)},O=S=>{if(!o.data.speaker_edits)return;const T=o.data.speaker_edits.replace("{speakers}",JSON.stringify(Array.from(w.entries())));return Y({sourceEvent:S,action:de.EDIT,content:T,userMessageType:U.HIVE_SPEAKER_EDIT,selectionMetadata:void 0})},Z=async S=>{if(X){q(!0);try{const T=[];Array.from(w.entries()).forEach(([E,_])=>{!_.isEdited||!_.name||T.push({id:E,updated_name:_.name})});const N=await oa(e,T);if(!N)throw new Error("Failed to update hive content");const J=new Map(w);for(const E of N.updated_speakers){if(!J.has(E.id))continue;const _=J.get(E.id);_&&J.set(E.id,L(v({},_),{storedName:E.updated_name,isEdited:!1}))}await O(S),j(J),u(!1)}catch(T){}finally{q(!1)}}},oe=a.data.filter(({filterDecision:S})=>!S||(k==null?void 0:k.includes(S)));return s.jsxs(ca,{className:C(p?"visible":"invisible hidden"),children:[s.jsxs("div",{className:"flex h-14 w-full items-center justify-between border-b border-gray-200 p-4",children:[s.jsxs("div",{className:"text-token-text-secondary group/debug flex items-center gap-1.5 py-2 text-base font-medium",children:[s.jsx(A,v({},fe[c?"edit":"transcript"])),s.jsx(rs,{}),!1]}),s.jsx("div",{className:"flex h-10 items-center gap-2",children:s.jsx(pe,{mode:"wait",children:c?s.jsxs(yt,L(v({},vt),{children:[s.jsx(se,{onClick:K,color:"secondary",disabled:B,children:s.jsx(A,v({},fe.cancelButton))}),s.jsx(se,{color:"primary",onClick:Z,disabled:!X,loading:B,children:s.jsx(A,v({},fe.saveButton))})]}),"edit-buttons"):s.jsxs(yt,L(v({},vt),{children:[x&&s.jsx(De,{className:"h-10",label:i.formatMessage(fe.editButtonTooltip),children:s.jsx(ut,{icon:Pt,onClick:()=>u(!0)})}),s.jsx(ut,{icon:et,onClick:()=>m()})]}),"non-edit-buttons")})})]}),!1,s.jsxs(as,{ref:l,children:[x&&b&&s.jsx(ia,{ref:$,children:la(b,z)}),oe.map(S=>s.jsx(ns,v({isEditingEnabled:x,measuredTextContainerRef:$,containerRef:l,isEditing:c,isSaving:B},S),os(S)))]})]})},os=e=>{const{speakerId:t,content:n,range:r}=e;return"".concat(t,"-").concat(r.min,"-").concat(r.max,"-").concat(n.slice(0,2))},fe=Le({researchPreview:{id:"HiveLogSidebar.researchPreview",defaultMessage:"Research Preview"},edit:{id:"HiveLogSidebar.edit",defaultMessage:"Edit"},transcript:{id:"HiveLogSidebar.transcript",defaultMessage:"Transcript"},editButtonTooltip:{id:"HiveLogSidebar.editButtonTooltip",defaultMessage:"Edit speakers"},cancelButton:{id:"HiveLogSidebar.cancelButton",defaultMessage:"Cancel"},saveButton:{id:"HiveLogSidebar.saveButton",defaultMessage:"Save"}});export{Xt as A,Ir as B,Sa as C,Rr as D,Ta as E,Yr as F,We as G,Ba as H,Ia as I,Dr as J,Or as K,La as L,Pa as S,$a as T,Ma as a,Aa as b,Kn as c,_a as d,Da as e,Oa as f,Ae as g,$n as h,Me as i,Yn as j,Xn as k,Vn as l,Ca as m,Na as n,Ft as o,Qn as p,er as q,Mr as r,Jn as s,Ar as t,Ra as u,Lr as v,ka as w,de as x,dr as y,nt as z};
//# sourceMappingURL=erm6n5lmbxodgs50.js.map
