var nt=Object.defineProperty,ot=Object.defineProperties;var it=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var rt=Object.prototype.hasOwnProperty,ct=Object.prototype.propertyIsEnumerable;var U=(t,e,s)=>e in t?nt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,D=(t,e)=>{for(var s in e||(e={}))rt.call(e,s)&&U(t,s,e[s]);if(M)for(var s of M(e))ct.call(e,s)&&U(t,s,e[s]);return t},W=(t,e)=>ot(t,it(e));import{r as u,ar as lt,i as dt,b as ut,j as c,A as mt,m as v}from"./jj85rqzpbnvv3emr.js";import{i as O,O as L,hB as ht,L as H,cj as Y,bI as w,fU as pt,mA as ft,gw as xt,iq as K,ft as Ct,dF as z,qY as gt,mh as Tt}from"./lef5ym39glv4981l.js";import{eD as j,n_ as vt,n$ as X,kJ as It,C as I,o0 as wt,o1 as Et,m9 as bt,c$ as yt,o2 as St,o3 as _t,o4 as At,o5 as Nt,nZ as Rt,o6 as Dt,o7 as Ft,o8 as Ot,o9 as G,oa as $,nX as Lt,u as jt,eE as P,ob as V,oc as q,od as Pt,oe as kt,of as Mt}from"./mclphevd122040jw.js";import{L as Ut}from"./kq1ir6pxp9hst9p9.js";import{T as Wt}from"./m1gt25yur8ncekq0.js";import{g as Ht}from"./bj1ejin6tzi0v3v8.js";import"./nfygy4vif6crzpny.js";import"./f3wj76d1ulqyss85.js";import"./g9xi6m5yzu4rtfn2.js";import"./ns51nblw8ziscsgd.js";import"./lbaueofbjv8jfqwm.js";import"./b2bzebhpy3vjflr5.js";import"./moqemqor8gto0ynb.js";import"./kl7c6054usfnqmd4.js";import"./k97n0y6ba9c9h39c.js";import"./hhs3uwxj7uii5eg7.js";import"./erm6n5lmbxodgs50.js";import"./zta1pq4ds1hak11y.js";import"./iqw8c7pica2coyb9.js";import"./dl9z2ehd50icy9od.js";import"./g2yrrlnprx92uhjb.js";import"./gwaaxp36jr4o1a8o.js";import"./l66h8h301eaq59ck.js";import"./hzcock7l6ec8fnr2.js";import"./fue7kd61xxcv74sk.js";import"./ng0sx063g0r0whhb.js";import"./fvmxudg74tbhlabl.js";import"./hnotrmacgvnfyexv.js";import"./irqko7c1s7qpl41n.js";import"./bx2wdn43543b9ysc.js";import"./n5wrqpcxv1sjah44.js";import"./kkl7694f44ns8yp6.js";import"./mw2u7timj0qnsnvj.js";import"./dvqe6kc43fkjsavv.js";import"./nq5i976pifkrt40a.js";import"./fnnulb9pmlo3cgid.js";const B="oai/apps/canmoreSidebarWidth",zt=.25,Gt=400,J=400;function Z(t){return t-Gt}function A(t,e){return lt(J,Z(t),e!=null?e:zt*t)}function Vt(){const t=O(),e=L(()=>j(t).width),s=A(e,ht(H.DANGER_SECRET_FOLDERS_ONLY_getItem(B))),n=Q(),[a,r]=u.useState(s);u.useEffect(()=>{(a<J||a>Z(e))&&r(A(e,a))},[e]);function l(m){r(f=>A(e,f+=m.delta.x))}function i(m){r(m),H.DANGER_SECRET_FOLDERS_ONLY_setItem(B,m)}function d(){const m=A(e,void 0);i(m)}const o="calc(100vw - ".concat(a,"px)");return n?{chatWidth:a,canvasWidth:e-a,canvasWidthCalc:o,viewportWidth:e,handleDrag:l,handleDoubleClick:d,persist:i}:{chatWidth:0,canvasWidth:e,canvasWidthCalc:"100vw",viewportWidth:e,handleDrag:()=>{},handleDoubleClick:()=>{},persist:()=>{}}}function Q(t){const e=O();return L(()=>(t!=null?t:j(e).width)>1e3)}const F="sharedCanvas";function qt(){const[t,e]=dt(),s=t.get(F),n=ut();u.useEffect(()=>{const a=s&&vt.createRemixTempTextdoc(s,n);if(!a)return;requestAnimationFrame(()=>{X(a)});const r=new URLSearchParams(t);r.delete(F),e(r);const l=new URL(window.location.href);l.searchParams.delete(F),history.replaceState(null,"",l)},[s,t,e,n])}const Bt="textdocId",Yt=t=>{const s=new URLSearchParams(window.location.search).get(Bt),n=Y(t,a=>{var r,l,i;return(i=(l=(r=w.findNode(a,({message:d})=>{var m;const o=(m=d.metadata)==null?void 0:m.canvas;return(o==null?void 0:o.create_source)===It.HIVE&&(s?(o==null?void 0:o.textdoc_id)===s:!0)}))==null?void 0:r.message.metadata)==null?void 0:l.canvas)==null?void 0:i.textdoc_id});u.useEffect(()=>{n&&requestAnimationFrame(()=>{X(n)})},[n])};function Kt(t,e){let s;return(e==null?void 0:e.type)===I.Textdoc&&(e.textdocId.startsWith(wt)||(s={type:"canvas_textdoc",id:e.textdocId})),Et(t,{promptMessage:{metadata:{open_in_canvas_view:s}}})}const tt=({isFullScreen:t=!1,clientThreadId:e,focusedObject:s,onClose:n,isAnimating:a=!1,width:r})=>{const{setTargetedContent:l}=bt(),i=u.useRef(!1);if(u.useEffect(()=>(i.current&&l(void 0),i.current=!0,()=>{i.current=!1}),[s]),s==null)return null;switch(s.type){case I.Textdoc:return c.jsx(Wt,{isFullScreen:t,onClose:n,clientThreadId:e,focusedTextdoc:s,isAnimating:a,width:r});case I.ADAVisualization:return null}},Xt=300,$t=t=>{switch(t==null?void 0:t.type){case I.Textdoc:return t.textdocId;default:return null}};function Jt({clientThreadId:t,isDisabled:e,disabledTypes:s}){const[n,a,r,l,i]=Y(t,p=>[w.getRequestId(p),w.getConversationLastTurn(p),w.isMessageTurnEnded(p),w.getVariantIds(p).length>1,w.lastUserMessage(p)],{disablePerfDetector:!0}),d=yt(n),o=St(),[m,f]=u.useMemo(()=>{if(a&&l)return[void 0,null];if(e===!0)return[void 0,null];if(i!=null){const h=_t(i);if(h)return[i.id,{type:I.Textdoc,textdocId:h}]}let p;return!r&&a&&(p=pt(a.messageGroups,h=>h.type!==ft)),Zt({groupedMessage:p,isRequestActive:d,latestTextdocId:o,disabledTypes:s})},[r,a,l,e,d,o,s,i]),y=f!=null,E=$t(f),R=At("canvas");u.useEffect(()=>{if(f&&m&&!xt()&&(R(),Nt(f,m),f.type===I.Textdoc)){const{textdocId:p}=f,h=Ht(p);Rt(document.getElementById(h))}},[y,E])}function Zt({groupedMessage:t,isRequestActive:e,latestTextdocId:s,disabledTypes:n}){var a,r;if(t!=null&&t.type&&n.includes(t.type))return[void 0,null];switch(t==null?void 0:t.type){case K.Canmore:{const[l,i]=t.messages;if(!Dt(l))break;const d=Ft(e,l,i!=null?i:null),o=(a=d.textdocId)!=null?a:s;if(o&&(d.function===Ot.CreateTextdoc?((r=d.content)!=null?r:"").length>Xt||d.status===G.WAITING:d.status===G.STREAMING))return[d.messageId,{type:I.Textdoc,textdocId:o}];break}}return[void 0,null]}const N={type:"spring",bounce:.12,duration:.64},Qt={type:"spring",bounce:0,duration:.58},C={duration:0},te=({clientThreadId:t,focusedObject:e,onClose:s})=>{const n=O(),{chatWidth:a,canvasWidthCalc:r,handleDrag:l,handleDoubleClick:i,persist:d}=Vt(),o=P(),[m,f]=u.useState(!o),[y,E]=u.useState(!1),R=o?C:N,p=o?C:Qt,h=Pt(({rect:T})=>T),{height:b,width:S}=L(()=>j(n));let x=h!=null?h:{top:0,left:a,width:S-a,height:b},k=!1;if(h&&(x.top<0||x.top+x.height>b)){k=!0;const T={width:(S-a)*.75,height:b*.75};x={top:b/2-T.height/2,left:(S-a-T.width)/2+a,width:T.width,height:T.height}}const _=h==null?void 0:h.borderRadius,g=kt(),et=(g==null?void 0:g.history)!=null||(g==null?void 0:g.showChangesAtVersion)!=null,st=Tt();return c.jsxs(c.Fragment,{children:[et&&c.jsx(Ut,{onClick:()=>Mt(g.textdocId),zIndexKey:"chatOverlay"}),c.jsxs(v.div,{initial:{marginInlineEnd:st?-260:0},animate:{marginInlineEnd:0},transition:p,children:[c.jsx(v.div,{initial:{opacity:1},animate:{opacity:0},exit:{opacity:[1,0]},transition:o?C:W(D({},N),{delay:.22}),className:"bg-token-main-surface-primary pointer-events-none absolute start-0 top-0 z-20 h-full w-full"}),c.jsx(v.div,{className:"relative z-20 h-full",style:{width:r},exit:{width:0},transition:o?C:{type:"spring",bounce:0,duration:.1}})]}),c.jsx(v.div,{className:"bg-token-bg-primary absolute start-0 z-20 h-full overflow-hidden shadow-[0_0_18px_rgba(0,0,0,0.12)] dark:shadow-[0_0_18px_rgba(0,0,0,0.48)]",initial:{borderRadius:_,opacity:k?0:1,x:x.left,y:x.top,height:x.height,width:x.width},animate:{opacity:1,x:a,y:0,width:r,height:b,borderRadius:0},exit:{scale:.64,opacity:0,filter:"blur(12px)",transition:o?C:{opacity:{duration:.14,bounce:.1}},borderRadius:_},transition:y||o?C:N,onAnimationComplete:()=>f(!1),children:c.jsx(v.div,{className:"dark:border-token-border-light border-token-border-medium h-full overflow-hidden border-s",initial:{borderRadius:_},animate:{borderRadius:0},exit:{borderRadius:_},transition:R,children:c.jsxs("div",{className:"h-full",children:[c.jsx(v.div,{drag:"x",className:"bg-token-text-quaternary absolute start-[-2px] z-10 h-full w-[4px] cursor-ew-resize opacity-0",whileHover:{opacity:.5},whileDrag:{opacity:.75,width:"8px",left:"-4px"},transition:o?C:{type:"tween",duration:.1},style:{x:0,y:0,transform:"translateX(0px)"},dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:{left:0,right:0,top:0,bottom:0},onPointerDown:()=>E(!0),onPointerUp:()=>E(!1),onDrag:(T,at)=>l(at),onDragEnd:()=>{E(!1),d(a)},onDoubleClick:()=>i()}),y&&c.jsx("div",{className:"absolute inset-0 z-10"}),c.jsx(tt,{onClose:s,clientThreadId:t,isAnimating:!o&&m,focusedObject:e,width:S-a})]})})})]})},ee=u.memo(te),se=({clientThreadId:t,focusedObject:e,onClose:s})=>{const n=P();return c.jsx(gt,{open:!0,className:"fixed inset-0 z-50 h-full w-full",children:c.jsx(v.div,{className:"z-40 h-full w-full overflow-hidden shadow-xl md:border-gray-100 md:dark:border-gray-700",initial:{scale:.98},animate:{scale:1},transition:n?C:N,children:c.jsx(tt,{isFullScreen:!0,clientThreadId:t,focusedObject:e,onClose:s})})})},ae=({clientThreadId:t,overrideWidth:e,isAutoFocusDisabled:s=!1})=>{const n=jt(),a=Q(e),r=P();Jt({clientThreadId:t,isDisabled:s,disabledTypes:r?[K.Canmore]:[]}),qt(),Yt(t);const l=u.useRef(!1);u.useEffect(()=>{l.current?$():l.current=!0},[t]);const i=n&&(a?c.jsx(ee,{clientThreadId:t,onClose:q,focusedObject:n},"canvas-sidebar"):c.jsx(se,{clientThreadId:t,onClose:q,focusedObject:n},"canvas-modal"));u.useEffect(()=>{if(n)return V(o=>Kt(o,n)),()=>V(null)},[n]);const d=i!=null;return u.useEffect(()=>(z.setActiveStageSidebar(d),()=>{d&&z.setActiveStageSidebar(!1)}),[d]),r?i:c.jsx(mt,{children:i},t)},He=t=>{const e=u.useRef(null);return c.jsx(Ct,{ref:e,onError:(s,n)=>{$(),setTimeout(()=>{var a;(a=e.current)==null||a.resetErrorBoundary()}),Lt.logError("Error boundary hit",s,{componentStack:n})},name:"canmore-focused-view",children:c.jsx(ae,D({},t))})};export{He as CanvasFocusedViewManager};
//# sourceMappingURL=lixhsjk8741nqzx6.js.map
