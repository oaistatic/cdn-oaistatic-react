var X=Object.defineProperty,Y=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var H=Object.getOwnPropertySymbols;var ee=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var _=(s,a,i)=>a in s?X(s,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[a]=i,D=(s,a)=>{for(var i in a||(a={}))ee.call(a,i)&&_(s,i,a[i]);if(H)for(var i of H(a))se.call(a,i)&&_(s,i,a[i]);return s},A=(s,a)=>Y(s,J(a));import{j as e,M as m,g as ne,i as te,u as ae,b as re,r as ie,p as oe,a as le,x as me,ak as ce,G as de}from"./jj85rqzpbnvv3emr.js";import{a3 as ue,dQ as he}from"./mclphevd122040jw.js";import{W as fe}from"./i5w9a1ap4yrxpqjj.js";import{f as xe,i as ge,r as pe,b$ as ve,pj as je,hZ as we,es as Ce,I as Me,B as Ne,E as be,p$ as Ee,T as Le,e as F}from"./lef5ym39glv4981l.js";import{S as ye}from"./i5op8b3itzauzv94.js";import{S as Se}from"./hd0url6fqbbbkmkc.js";import{T as t}from"./i5991cad8s41d2db.js";import{I as ke}from"./l45tzjfw41ny1oxj.js";import{u as Pe}from"./iv7wsx4h3mnmu7bd.js";import{E as w}from"./iie09zeu4q9g9ba8.js";import{W,i as Ie}from"./ef92qx749w9klz4o.js";import"./hqbuxjfjvu1puiaw.js";import"./jxokrjy8ycftw0wv.js";import"./jk4cx3iywxazx01l.js";import"./hc8beflnn681x6ow.js";import"./mw2u7timj0qnsnvj.js";import"./dvqe6kc43fkjsavv.js";import"./nk7ydxm8ptxusvbt.js";import"./k059n59kmbyb9lsl.js";import"./ojb4d4bxj44fs0l8.js";import"./oz589d7sqtxcbljf.js";import"./hxd0yong6zdu9u3r.js";import"./kxedrjbxv2qblujd.js";function Te(){return e.jsx("div",{className:"border-token-border-heavy flex items-center border-b",children:e.jsx("div",{className:"py-2 text-xl leading-7 font-medium",children:e.jsx(m,{id:"wham.environmentsHeader.message",defaultMessage:"Environments"})})})}const He=25,_e=100;function De({isPinned:s,onToggle:a,intl:i,isCreator:d}){return e.jsx(t.Cell,{className:"content-center pe-1!",children:e.jsx(Le,{side:"bottom",align:"center",className:"block w-full",alignOffset:0,label:d?s?e.jsx(m,{id:"wham.environmentsList.unpin",defaultMessage:"Unpin environment for everyone in your workspace"}):e.jsx(m,{id:"wham.environmentsList.pin",defaultMessage:"Pin environment to the top for everyone in your workspace"}):e.jsx(m,{id:"wham.environmentsList.pin.notCreator",defaultMessage:"You can only pin and unpin environments you created."}),children:e.jsxs("button",{disabled:!d,onClick:a,className:F("group/cell relative flex h-10 w-full items-center px-4 group-hover/row:opacity-100",!s&&"opacity-0",s&&!d&&"opacity-50"),"aria-label":s?i.formatMessage({id:"wham.environmentsList.unpinEnvironment",defaultMessage:"Unpin environment"}):i.formatMessage({id:"wham.environmentsList.pinEnvironment",defaultMessage:"Pin environment"}),children:[s&&e.jsx(Se,{className:"icon absolute opacity-0 group-hover/cell:opacity-100"}),e.jsx(ye,{className:F("icon absolute",s&&"opacity-100 group-hover/cell:opacity-0")})]})})})}function Ae(){var S,k;const s=ne(),[a,i]=te(),d=ae(),o=re(),R=xe(),U=ge(),c=pe(U),C=!!(c!=null&&c.isWorkspaceAccount()),M=Pe(),[p,O]=ie.useState((S=a.get("search"))!=null?S:""),{data:v,isLoading:Q,error:N,fetchNextPage:B,hasNextPage:g,isFetchingNextPage:G}=oe({queryKey:["wham","environments","with-creators"],initialPageParam:null,queryFn:({pageParam:n})=>W.getEnvironmentWithCreators(n?_e:He,n),getNextPageParam:n=>{var r;return(r=n.cursor)!=null?r:null}}),{mutate:q}=le({mutationFn:({environmentId:n,isPinned:r})=>(d.setQueryData(["wham","environments","with-creators"],l=>l&&ve(l,u=>{for(const f of u.pages)for(const h of f.items)if(h.id===n){h.is_pinned=!h.is_pinned;break}})),d.setQueryData(["wham","environments"],l=>l&&l.map(u=>u.id===n?A(D({},u),{is_pinned:r}):u)),W.updateEnvironment(n,{is_pinned:r})),onSettled:()=>{Ie(d)},onError:()=>{R.danger(o.formatMessage({id:"wham.environmentsList.failedToPinEnvironment",defaultMessage:"Failed to pin environment"}))}}),{isConnected:b,isLoading:z}=je(Ce.GITHUB_CONNECTOR,"github","/codex/settings/environments",we.CODEX),E=(k=v==null?void 0:v.pages.flatMap(n=>n.items))!=null?k:[],j=p.trim().toLowerCase(),V=E.filter(n=>n.label.toLowerCase().includes(j)),L=n=>{const r=n.toLowerCase();return r===j?0:r.startsWith(j)?1:2},y=V.slice().sort((n,r)=>{if(n.is_pinned!==r.is_pinned)return n.is_pinned?-1:1;const l=L(n.label)-L(r.label);return l!==0?l:n.label.localeCompare(r.label)});return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex flex-row justify-between pb-4",children:[e.jsx("div",{className:"flex flex-row gap-2",children:e.jsx(Me,{name:"search-environments",color:"search",containerInputClassName:"w-full",className:"text-token-text-primary flex h-8 w-full items-center rounded-md!",value:p,disabled:z||!b||N!==null,onChange:n=>{const r=n.target.value;O(r),r?i({search:r},{replace:!0}):i({},{replace:!0})},placeholder:o.formatMessage({id:"wham.environmentsList.searchEnvironmentsPlaceholder",defaultMessage:"Search environments"}),ariaLabel:o.formatMessage({id:"wham.environmentsList.searchEnvironmentsAria",defaultMessage:"Search environments"})})}),e.jsx(Ne,{onClick:()=>s("/codex/settings/environment/create"),disabled:!b,color:"primary",icon:ue,className:"h-8","aria-label":o.formatMessage({id:"wham.environmentsList.createEnvironmentAriaLabel",defaultMessage:"Link to create a new environment"}),children:e.jsx("span",{className:"hidden md:inline",children:e.jsx(m,{id:"wham.environmentsList.createEnvironment",defaultMessage:"Create environment"})})})]}),Q?e.jsx("div",{className:"flex h-full items-center justify-center pt-5",children:e.jsx(be,{})}):N?e.jsx(w,{title:o.formatMessage({id:"wham.environmentsList.error",defaultMessage:"Failed to load environments"}),description:o.formatMessage({id:"wham.environmentsList.errorDescription",defaultMessage:"Please try refreshing the page, if that does not work, please contact support."})}):E.length===0?e.jsx(w,{title:o.formatMessage({id:"wham.environmentsList.noEnvironments",defaultMessage:"No environments"}),description:o.formatMessage({id:"wham.environmentsList.noEnvironmentsDescription",defaultMessage:"Create an environment for Codex to work in"})}):e.jsxs(e.Fragment,{children:[e.jsxs(t.Root,{className:"overflow-x-auto overflow-y-clip",disableScroll:!0,children:[e.jsxs(t.Header,{children:[e.jsx(t.HeaderCell,{className:"ps-2 text-sm",children:e.jsx(m,{id:"wham.environmentsList.name",defaultMessage:"Name"})}),e.jsx(t.HeaderCell,{className:"text-sm",children:e.jsx(m,{id:"wham.environmentsList.repo",defaultMessage:"Repo"})}),e.jsx(t.HeaderCell,{className:"text-sm",children:e.jsx(m,{id:"wham.environmentsList.numberOfTasks",defaultMessage:"Number of tasks"})}),M&&e.jsx(t.HeaderCell,{className:"text-sm",children:e.jsx(m,{id:"wham.environmentsList.sharing",defaultMessage:"Sharing"})}),e.jsx(t.HeaderCell,{className:"text-sm",children:e.jsx(m,{id:"wham.environmentsList.creator",defaultMessage:"Creator"})}),e.jsx(t.HeaderCell,{className:"text-sm",children:e.jsx(m,{id:"wham.environmentsList.createdAt",defaultMessage:"Created at"})}),C&&e.jsx(t.HeaderCell,{}),e.jsx(t.HeaderCell,{})]}),e.jsx(t.Body,{children:y.length===0&&!g?e.jsx(t.Row,{children:e.jsx(t.Cell,{colSpan:100,children:e.jsx(w,{title:o.formatMessage({id:"wham.environmentsList.search.noEnvironments",defaultMessage:"No matches for {search}"},{search:p}),description:o.formatMessage({id:"wham.environmentsList.search.noEnvironmentsDescription",defaultMessage:"Create an environment for Codex to work in"})})})}):y.map(({id:n,label:r,is_pinned:l,repos:u,repo_map:f,creator:h,created_at:P,task_count:Z,share_settings:$})=>{const K=!!(c!=null&&c.authUserId)&&h.id.includes(c==null?void 0:c.authUserId);return e.jsxs(t.Row,{role:"row",className:"group/row hover:bg-token-bg-tertiary h-14 px-2 text-sm hover:cursor-pointer",onClick:()=>s("/codex/settings/environment/".concat(n)),tabIndex:0,"aria-label":o.formatMessage({id:"wham.environmentsList.environmentAriaLabel",defaultMessage:"View environment {label}"},{label:r}),children:[e.jsx(t.Cell,{divClassName:"flex h-14 items-center group-hover/row:underline ps-2",children:r}),e.jsx(t.Cell,{divClassName:"flex h-14 items-center",children:u.map(x=>{var I,T;return e.jsx("div",{children:(T=(I=f==null?void 0:f[x])==null?void 0:I.repository_full_name)!=null?T:x},x)})}),e.jsx(t.Cell,{divClassName:"flex h-14 items-center",children:Z}),M&&e.jsx(t.Cell,{divClassName:"flex h-14 items-center",children:Fe(o,$)}),e.jsx(t.Cell,{divClassName:"flex h-14 items-center",children:h.email}),e.jsx(t.Cell,{divClassName:"flex h-14 items-center",children:P?e.jsx(me,{value:new Date(P*1e3),year:"numeric",month:"long",day:"numeric"}):e.jsx(m,{id:"wham.environmentsList.na",defaultMessage:"N/A"})}),C&&e.jsx(De,{isPinned:l,isCreator:K,onToggle:x=>{x.stopPropagation(),q({environmentId:n,isPinned:!l})},intl:o})]},n)})})]}),e.jsx(ke,{isFetchingNextPage:G,hasNextPage:g!=null?g:!1,fetchNextPage:B})]})]})})}function Fe(s,a){switch(a){case"public":return s.formatMessage({id:"wham.environmentsList.public",defaultMessage:"Public"});case"private":return s.formatMessage({id:"wham.environmentsList.private",defaultMessage:"Private"});case"workspace":return s.formatMessage({id:"wham.environmentsList.workspace",defaultMessage:"Workspace"});default:Ee.assertNever(a)}}function We(){const{eligible:s}=he();return s?e.jsx(ce,{to:"/codex"}):e.jsx(fe,{topPadding:!0,children:e.jsxs("div",{className:"mx-auto flex h-full max-w-screen-xl flex-1 flex-col gap-4 ps-4 pe-4 md:pe-12",children:[e.jsx(Te,{}),e.jsx(Ae,{})]})})}const ms=()=>[{title:"Codex"}],cs=de(function(){return e.jsx(We,{})});export{cs as default,ms as meta};
//# sourceMappingURL=9uj9vwy1849ed4z8.js.map
