var pt=Object.defineProperty;var V=Object.getOwnPropertySymbols;var ht=Object.prototype.hasOwnProperty,bt=Object.prototype.propertyIsEnumerable;var X=(e,r,n)=>r in e?pt(e,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[r]=n,L=(e,r)=>{for(var n in r||(r={}))ht.call(r,n)&&X(e,n,r[n]);if(V)for(var n of V(r))bt.call(r,n)&&X(e,n,r[n]);return e};import{j as t,b as it,r as h,M as Z}from"./jj85rqzpbnvv3emr.js";import{i as D,j as w,Y as kt,h0 as jt,e as p,B as yt,bK as I,bF as vt,e$ as Nt,bP as gt,hR as wt,f as _t,P as U,bM as M,R as St,bI as Ct,bJ as Pt,cj as Tt,bQ as tt}from"./lef5ym39glv4981l.js";import{kw as rt,fH as st,fL as ot,mx as Et,dq as At,ho as Dt,my as $t,mz as zt,mA as Bt,eO as Ft}from"./mclphevd122040jw.js";import{S as Lt}from"./pa27hmbnxjn1cx3w.js";import{M as et}from"./hnotrmacgvnfyexv.js";function nt({message:e,simulatedDuration:r=8*60*1e3,maxFill:n=100,isCircular:i=!1}){var l;((l=e==null?void 0:e.metadata)==null?void 0:l.model_slug)!=="o1-pro"&&(r=20*60*1e3);const u=e!=null&&e.create_time?new Date(e.create_time*1e3):Date.now(),o=rt(+u,r),d=D(),s=w(d,"3208967109");return i?t.jsx(st,{percentage:o,className:"me-4 w-full!",transitionDuration:"".concat((100-o)/100*5,"s"),transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)"}):t.jsx(ot,{percentage:Math.min(o,n),className:"me-4 w-full!",backgroundClassName:"bg-token-sidebar-surface-secondary rounded-full",barClassName:"bg-token-text-secondary rounded-full",transitionDuration:"".concat((100-o)/100*.2,"s"),transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)",height:s?4:8})}function It({title:e,content:r,buttons:n,time:i,icon:u,size:o="default",progressBar:d,disabled:s=!1,onClick:l}){const m=o==="small"?"w-full flex max-w-[calc(0.8*var(--thread-content-max-width,40rem))] ps-[20px] pt-[13px] pb-[10px] ".concat(s?"":"gap-4"):"w-full gap-4 px-[22px] pb-[22px] pt-[18px]",f=l?"cursor-pointer":"",x=o==="small"?"text-[15px]":"",y=kt(jt);return t.jsxs("div",{className:p("relative inline-flex flex-col items-start justify-start rounded-2xl border","bg-token-bg-primary border-token-border-default box-content rounded-2xl border bg-clip-padding px-5 py-4",!y&&"mx-[calc(--spacing(-2)-1px)] -my-[1px] @max-3xl:-top-2 @3xl:-start-3 @3xl:-top-4",m,f,x),onClick:l,children:[t.jsxs("div",{className:p("flex flex-col items-start justify-start self-stretch",o!=="small"&&"gap-1.5"),children:[t.jsxs("div",{className:p("inline-flex items-start justify-start self-stretch",o!=="small"&&"gap-2"),children:[t.jsx("div",{className:p("shrink grow basis-0 leading-normal font-medium","text-token-text-secondary hover:text-token-text-primary"),children:e}),t.jsx("div",{className:"relative h-6 w-6"}),!s&&(u||t.jsx(Lt,{className:"relative h-6 w-6"}))]}),t.jsx("div",{className:p("flex w-full flex-col items-start justify-start",o==="small"&&"mt-[-2px]"),children:t.jsx("div",{className:p("inline-flex w-full items-start justify-start self-stretch rounded-sm",o==="small"?"gap-1":"gap-2.5 py-1"),children:t.jsx("div",{className:p("w-full leading-relaxed font-normal",s?"text-token-text-tertiary":"text-token-text-secondary"),children:r})})})]}),d?t.jsxs("div",{className:p("mb-2 inline-flex items-center justify-between self-stretch",(n==null?void 0:n.length)&&"mt-[-10px]"),children:[d,n]}):t.jsxs("div",{className:"inline-flex items-center justify-end self-stretch",children:[i&&t.jsx("div",{className:"text-token-text-tertiary shrink grow basis-0 text-[15px] leading-normal font-normal",children:i}),t.jsx("div",{className:"flex gap-2",children:n})]})]})}function at({message:e,isCircular:r=!1}){var m,f,x;const n=5.333333333333334;let i=(f=(m=e==null?void 0:e.metadata)==null?void 0:m.tournament_progress)!=null?f:0;const u=((x=e==null?void 0:e.metadata)==null?void 0:x.model_slug)==="o1-pro"?8*60*1e3:20*60*1e3,o=e!=null&&e.create_time?e.create_time*1e3:Date.now(),d=rt(o,u);i=Math.max(d,i);const s=D(),l=w(s,"3208967109");return l&&(i=Math.max(i,n)),r?t.jsx(st,{percentage:i,className:"me-4 w-full!",sizeOverride:20,thickness:1/8,transitionDuration:"".concat((100-i)/100*5,"s"),transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)"}):t.jsx(ot,{percentage:i,className:"me-4 w-full!",backgroundClassName:"bg-token-sidebar-surface-secondary dark:bg-token-border-default rounded-full",barClassName:"bg-token-text-secondary rounded-full",transitionDuration:"".concat((100-i)/100*5,"s"),transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)",height:l?4:8})}function Rt({errorNotice:e,onOpenSidebarSummarizer:r,isReceivingUpdates:n,lastMessage:i,latestTitle:u,summarizationHeadline:o,handleSkipClick:d,clientThreadId:s}){var a,E,v,k,j,N,S;const l=D(),m=it(),f=w(l,"4094234945"),x=w(l,"3208967109"),y=w(l,"3327816228"),T=Et(s);h.useEffect(()=>{T&&r()},[T,r]);const b=f?at:nt,_=n&&y&&((a=i==null?void 0:i.metadata)==null?void 0:a.tournament_progress),$=(((E=i==null?void 0:i.metadata)==null?void 0:E.bon_skipped)||((v=i==null?void 0:i.clientMetadata)==null?void 0:v.bonSkipPending))&&n;if(x){if($)return t.jsx("span",{className:"result-streaming pulse relative pt-1",children:t.jsx("span",{})});const g=(j=n?u:(k=i==null?void 0:i.metadata)==null?void 0:k.finished_text)!=null?j:m.formatMessage({id:"hgnsat",defaultMessage:"Thinking"});return t.jsxs("div",{className:"flex items-start gap-3 pb-2",children:[t.jsxs("div",{className:"flex w-full flex-col",children:[t.jsxs("div",{className:"flex w-full items-center justify-between",children:[t.jsx("button",{type:"button",onClick:r,className:"group inline-flex max-w-full items-center rounded-md focus:outline-none",children:t.jsxs("span",{className:n?"loading-shimmer text-token-text-secondary inline-flex max-w-full items-center gap-0.5 truncate text-base leading-5 font-medium md:text-base":"text-token-text-tertiary hover:text-token-text-primary inline-flex max-w-full items-center gap-0.5 truncate text-base leading-5 font-medium md:text-base",children:[g,t.jsx(At,{className:"icon-xs text-token-text-tertiary group-hover:text-token-text-primary"})]})}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:d,className:"text-token-text-tertiary hover:text-token-text-primary whitespace-nowrap transition-opacity duration-1000 ease-out ".concat(_?"pointer-events-auto opacity-100":"pointer-events-none opacity-0"),"aria-hidden":!_,tabIndex:_?0:-1,children:t.jsx("span",{className:"flex items-center gap-0.5 underline decoration-dotted decoration-[8%]",children:t.jsx(Z,{id:"xMM6dg",defaultMessage:"Answer now"})})}),n&&t.jsx("div",{className:"ms-1 shrink-0 self-start md:hidden",children:t.jsx(b,{message:i,isCircular:!0})})]})]}),n&&t.jsx("div",{className:"mt-[22px] mb-2 hidden self-stretch md:inline-flex",children:t.jsx("div",{className:"w-full max-w-[150px]",children:t.jsx(b,{message:i,isCircular:!1})})})]}),e]})}return t.jsxs("div",{className:"flex pb-2",children:[t.jsx(It,{buttons:n?[t.jsx(yt,{onClick:g=>{g.stopPropagation(),r()},color:"secondary",className:"text-token-text-secondary h-[38px]! text-[15px] font-normal",children:t.jsx("div",{className:"px-1",children:t.jsx(Z,{id:"wQcuK8",defaultMessage:"Details"})})},"Details")]:[],time:null,title:o,icon:n?t.jsx("div",{className:""}):null,content:n?"".concat(u,"..."):(S=(N=i==null?void 0:i.metadata)==null?void 0:N.finished_text)!=null?S:"",size:"small",disabled:!n,onClick:r,progressBar:n?f?t.jsx(at,{message:i}):t.jsx(nt,{message:i}):null}),e]})}const Gt=/\*\*(.*?)(?:\*\*|\n|$)/g,Ht=e=>{let r=null,n;for(;(n=Gt.exec(e))!=null;)r=n[1].trim();return r},Wt=()=>null;function Vt({messages:e,isStreaming:r,isCompletionRequestInProgress:n,hasActiveRequest:i,isLastMessage:u,isFinalTurn:o,isFeedbackEnabled:d,clientThreadId:s,currentGroupedMessageIndex:l,turnIndex:m}){var G,H,W,q,K,Q,J,O,Y;const[f,x]=h.useState(""),[y,T]=h.useState(!1),b=I(s),_=((G=Dt(s))==null?void 0:G.value)===vt.STREAMING,$=$t(I(s)),a=Nt(e),E=a==null?void 0:a.id,v=(H=a==null?void 0:a.metadata)==null?void 0:H.initial_text,k=(W=a==null?void 0:a.metadata)==null?void 0:W.summarization_headline,j=e.map(c=>gt(c)).join("\n\n"),{toggleThreadSidebar:N}=wt(),S=it(),g=_t(),C=(q=a==null?void 0:a.metadata)==null?void 0:q.async_task_id;zt(C,a,s),Bt(C);const lt=h.useCallback(()=>{N(C?{type:"caterpillar",clientThreadId:s,caterpillarId:C,initialTab:"activity"}:{type:"summarizer",clientThreadId:s,currentGroupedMessageIndex:l,turnIndex:m})},[N,s,l,m,C]),ct=h.useCallback(()=>{if(!b||!(a!=null&&a.id))return;U.logEventWithStatsig("chatgpt_web_pro_skip_clicked","chatgpt_web_pro_skip_clicked",{conversationId:b,messageId:a.id});const c=a.id,z=a.clientMetadata?L({},a.clientMetadata):void 0,B=a.metadata?L({},a.metadata):void 0;M(s,F=>{tt.updateTree(F,P=>{P.updateNodeMetadata(c,{bonSkipPending:!0}),P.updateNodeMessageMetadata(c,{bon_skipped:!0})})}),St.safePost("/pro_mode/{conversation_id}/skip",{parameters:{path:{conversation_id:b}}}).catch(()=>{g.danger(S.formatMessage({id:"summmarizer.skip.toast",defaultMessage:"Failed to answer now. Please try again."}),{hasCloseButton:!0,toastId:"summarizer_skip_failed"}),M(s,F=>{tt.updateTree(F,P=>{P.updateNodeMetadata(c,{bonSkipPending:z==null?void 0:z.bonSkipPending}),P.updateNodeMessageMetadata(c,{bon_skipped:B==null?void 0:B.bon_skipped})})})})},[s,b,S,a,g]),dt=D(),R=w(dt,"3208967109");h.useEffect(()=>{const c=Ht(j);if(c){x(c);return}if(R&&k!=null){x(k);return}v!=null&&x(v)},[j,k,R,v]),h.useEffect(()=>{j.length>0&&T(!0)},[j]),h.useEffect(()=>{y&&U.logEvent("Tool: Received a8km123 message",{client_thread_id:s,message_id:E,conversationId:I(s)})},[y]);const ut=o&&u&&(_||r),xt=Wt()!=null,mt=Ct.isLastActorMessage(Pt(s),e[0].id),ft=!!Tt(s,c=>c==null?void 0:c.sharedConversationMetadata),A=Ft(e[0],mt,xt,n||i,ft);return!$&&((Q=(K=a==null?void 0:a.metadata)==null?void 0:K.finish_details)==null?void 0:Q.type)==="interrupted"&&((O=(J=a==null?void 0:a.metadata)==null?void 0:J.finish_details)==null?void 0:O.reason)!=="server_timeout"||(Y=a==null?void 0:a.clientMetadata)!=null&&Y.err?t.jsx("div",{children:A&&t.jsx(et,{errorState:A,nodeId:e[0].id,isFeedbackEnabled:d,clientThreadId:s,isUserTurn:!1})}):t.jsx(Rt,{errorNotice:A&&t.jsx(et,{errorState:A,nodeId:e[0].id,isFeedbackEnabled:d,clientThreadId:s,isUserTurn:!1}),onOpenSidebarSummarizer:lt,isReceivingUpdates:ut,lastMessage:a,latestTitle:f,summarizationHeadline:k,handleSkipClick:ct,clientThreadId:s})}export{Vt as default};
//# sourceMappingURL=dx2mscxiioa7gv4g.js.map
