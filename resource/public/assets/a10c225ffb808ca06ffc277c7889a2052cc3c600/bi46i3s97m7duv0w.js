var D=Object.defineProperty,H=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var U=(e,o,n)=>o in e?D(e,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[o]=n,w=(e,o)=>{for(var n in o||(o={}))q.call(o,n)&&U(e,n,o[n]);if(C)for(var n of C(o))z.call(o,n)&&U(e,n,o[n]);return e},B=(e,o)=>H(e,G(o));var K=(e,o)=>{var n={};for(var r in e)q.call(e,r)&&o.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&C)for(var r of C(e))o.indexOf(r)<0&&z.call(e,r)&&(n[r]=e[r]);return n};import{j as v,i as I,b as J,r as ee,d as te,v as ne}from"./jj85rqzpbnvv3emr.js";import{ch as L,ot as Q,fM as oe,hZ as se,l0 as ie,fD as re,ci as b,fN as ae,l3 as ce,bK as de,cc as ue,er as le,ou as fe,cg as W}from"./lef5ym39glv4981l.js";import{C as me}from"./bfo1h8l0zwcd8b61.js";import{cq as ge,cr as pe,ck as _e,cl as y,cs as he}from"./mclphevd122040jw.js";function we({messages:e,nextMessage:o,clientThreadId:n,isLastTurnInConversation:r,isLastMessageInTurn:d,onRequestCompletion:a}){var l,f,u,m,g;const t=e.find(c=>c.author.role===L.Tool&&c.recipient==="assistant"||c.author.role===L.Assistant&&c.recipient==="user");if(!t)return null;const i=(f=(l=t.metadata)==null?void 0:l.elicitation_metadata)==null?void 0:f.tool_call_message;if(!i)return null;const s=(m=(u=t.metadata)==null?void 0:u.elicitation_metadata)==null?void 0:m.plugin_data;return!s||!s.from_server||!("body"in((g=s.from_server)!=null?g:{}))?null:v.jsx(ye,{messages:e,nextMessage:o,clientThreadId:n,isLastTurnInConversation:r,isLastMessageInTurn:d,onRequestCompletion:a,serverActionMessage:s.from_server,toolCallMessage:i})}function ye({messages:e,nextMessage:o,clientThreadId:n,isLastTurnInConversation:r,isLastMessageInTurn:d,onRequestCompletion:a,serverActionMessage:t,toolCallMessage:i}){var s;if(!("body"in t))return null;if(t.type=="oauth_required"){const f=((s=t.body.actions)!=null?s:[]).find(Se);return f?v.jsx(Me,{messages:e,nextMessage:o,clientThreadId:n,isLastTurnInConversation:r,isLastMessageInTurn:d,onRequestCompletion:a,toolCallMessage:i,oauthTargetMessageId:f.oauth_redirect.target_message_id}):null}}function Me({messages:e,nextMessage:o,clientThreadId:n,isLastTurnInConversation:r,isLastMessageInTurn:d,onRequestCompletion:a,toolCallMessage:t,oauthTargetMessageId:i}){var x;const[s,l]=I(),f=J(),u=e.find(M=>{var _,S,k;return(k=(S=(_=M.metadata)==null?void 0:_.elicitation_metadata)==null?void 0:S.plugin_data)==null?void 0:k.from_client}),m=Q(t==null?void 0:t.recipient),g=(x=Q(o==null?void 0:o.recipient))==null?void 0:x.namespace,{connectorId:c,connectorToolStatus:A,connectorStatusMessage:j}=ve(m==null?void 0:m.namespace,g,e,r),h=oe(!0,se.JIT_PLUGIN).platformConnectors.get(c!=null?c:""),T=!!(c&&h&&!u&&d),Y=ie(),p=re();ee.useEffect(()=>{var _,S,k,F;if(((F=(k=(S=(_=u==null?void 0:u.metadata)==null?void 0:_.elicitation_metadata)==null?void 0:S.plugin_data)==null?void 0:k.from_client)==null?void 0:F.type)==="oauth_success")return;s.get("oauth_success")&&(l(V=>(V.delete("oauth_success"),V),{replace:!0}),E({eventSource:"url",assistantMessage:t,onRequestCompletion:a,actionData:{type:"oauth_success",target_message_id:i},conversationMode:{kind:b.PrimaryAssistant},activeSystemHint:p!=null?p:void 0,messageTextContent:"Login successful."}))},[t,e,n,a,r,s,l,p,i,u]);const Z=ae({skip:!1,fetchValidLinksOnly:!0,productSku:"n7jupd"}),X=Array.from(Z.connectorLinks.values()).some(M=>M.some(_=>_.connector_id===c)),{addSource:$,selectedSources:R}=ge(n),{selectedRepos:O}=pe(n);return v.jsxs(v.Fragment,{children:[j&&v.jsx(_e,{highlightedCommand:h?f.formatMessage(j,{domain:h.name}):v.jsx("br",{}),status:A,showWorkUserSetting:!1}),T&&h&&v.jsx("div",{className:"mb-2 flex gap-2",children:v.jsx(me,{connector:h,onConnect:M=>{if(X){$(ce[c!=null?c:""]),E({sourceEvent:M,assistantMessage:t,onRequestCompletion:a,actionData:{type:"oauth_success",target_message_id:i},conversationMode:{kind:b.PrimaryAssistant},activeSystemHint:p!=null?p:void 0,messageTextContent:"Login successful.",selectedSources:R,selectedRepos:O});return}const _=de(n),S=_?new URL(ue(_),window.location.origin):new URL(window.location.href);S.searchParams.set("oauth_success","true"),Y({connectorId:h.id,redirectAfter:S.toString(),referrer:le.JitPluginMessage})},onProceedWithoutConnecting:M=>{E({sourceEvent:M,assistantMessage:t,onRequestCompletion:a,actionData:{type:"deny",target_message_id:i},messageTextContent:"Login declined.",conversationMode:{kind:b.PrimaryAssistant},activeSystemHint:p!=null?p:void 0,selectedSources:R,selectedRepos:O})}})})]})}function Se(e){var o;return(e==null?void 0:e.type)==="oauth_redirect"&&typeof((o=e==null?void 0:e.oauth_redirect)==null?void 0:o.target_message_id)=="string"}function ve(e,o,n,r){var f,u,m,g,c,A,j,N,h;var d=(f=fe(e))!=null?f:void 0;const a=n[n.length-1],t=(u=a==null?void 0:a.metadata)==null?void 0:u.jit_plugin_data;if(!d&&((m=t==null?void 0:t.from_server)==null?void 0:m.type)==="oauth_required"&&(d=(g=t==null?void 0:t.from_server)==null?void 0:g.body.connector_id),!d)return{connectorId:void 0,connectorToolStatus:null,connectorStatusMessage:null,showConnectorConnect:!1};if(o===e)return{connectorId:d,connectorToolStatus:null,connectorStatusMessage:null,showConnectorConnect:!1};var i=y.Running,s=null,l=!1;return n.some(T=>T.content.content_type===W.SystemError)?(i=y.Error,s=P.error):a?((c=t==null?void 0:t.from_server)==null?void 0:c.type)==="oauth_required"&&r?(i=y.Paused,s=null,l=!0):((A=t==null?void 0:t.from_server)==null?void 0:A.type)==="oauth_required"&&!r?(i=y.Stopped,s=P.connectorDeclined):((j=t==null?void 0:t.from_client)==null?void 0:j.type)==="deny"?(i=y.Stopped,s=P.connectorDeclined):((N=t==null?void 0:t.from_client)==null?void 0:N.type)==="oauth_success"?(i=y.Stopped,s=P.connectorAccepted):(h=a==null?void 0:a.metadata)!=null&&h.invoked_plugin?(i=y.Finished,s=P.finished):(i=y.Stopped,s=P.stopped):(i=y.Running,s=P.running),{connectorId:d,connectorToolStatus:i,connectorStatusMessage:s,showConnectorConnect:l}}function E(f){var u=f,{actionData:e,assistantMessage:o,turnGizmo:n,onRequestCompletion:r,conversationMode:d,activeSystemHint:a,messageTextContent:t,selectedSources:i,selectedRepos:s}=u,l=K(u,["actionData","assistantMessage","turnGizmo","onRequestCompletion","conversationMode","activeSystemHint","messageTextContent","selectedSources","selectedRepos"]);var g;const m={id:ne(),author:{role:L.Tool,name:o.recipient},content:{content_type:W.Text,parts:[t!=null?t:""]},recipient:"all",metadata:w(w({jit_plugin_data:{from_client:e},gizmo_id:n==null?void 0:n.gizmo.id,elicitation_metadata:{plugin_data:{from_client:e}}},i&&{selected_sources:he(i)}),s&&{selected_github_repos:[...(g=s.selectedRepos)!=null?g:[]],selected_all_github_repos:s.selectedAllRepos}),clientMetadata:{completionSampleFinishTime:Date.now()}};r(B(w({},l),{promptMessage:m,completionMetadata:{conversationMode:d!=null?d:{kind:b.PrimaryAssistant},systemHints:a?[a]:void 0}}))}const P=te({starting:{id:"jitPluginMessage.starting",defaultMessage:"Starting action"},confirmingSimple:{id:"jitPluginMessage.confirming.simple",defaultMessage:"{gizmoName} wants to talk to {domain}"},confirmingSubtitle:{id:"jitPluginMessage.confirming.subtitle",defaultMessage:"Only allow sites you trust."},running:{id:"jitPluginMessage.runningV4",defaultMessage:"Talking to {domain}"},finished:{id:"jitPluginMessage.finishedV4",defaultMessage:"Talked to {domain}"},stopped:{id:"jitPluginMessage.stoppedV4",defaultMessage:"Stopped talking to {domain}"},error:{id:"jitPluginMessage.errorV5",defaultMessage:"Error talking to {domain}"},declined:{id:"jitPluginMessage.declined",defaultMessage:"You declined this action"},ranTest:{id:"jitPluginMessage.ranTest",defaultMessage:"Tested {operationName}"},confirmParamsTitle:{id:"jitPluginMessage.confirmParamsTitleV3",defaultMessage:"{gizmoName} wants to share this info with {domain}"},sentParamsTitle:{id:"jitPluginMessage.sentParamsTitleV2",defaultMessage:"{gizmoName} sent this info to {domain}"},privacyPolicyLink:{id:"jitPluginMessage.privacyPolicyLinkV2",defaultMessage:"Privacy policy"},connectorAccepted:{id:"jitPluginMessage.connectorAccepted",defaultMessage:"Accepted using {domain}"},connectorDeclined:{id:"jitPluginMessage.connectorDeclined",defaultMessage:"Declined connection to {domain}"},rememberForThisConversation:{id:"jitPluginMessage.rememberForThisConversation",defaultMessage:"Remember for this conversation"}});export{we as APIToolElicitationMessage};
//# sourceMappingURL=bi46i3s97m7duv0w.js.map
