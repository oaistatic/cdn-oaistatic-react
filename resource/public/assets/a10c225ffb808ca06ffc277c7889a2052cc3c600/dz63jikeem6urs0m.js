var D=Object.defineProperty,ee=Object.defineProperties;var te=Object.getOwnPropertyDescriptors;var V=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var Y=(e,t,l)=>t in e?D(e,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[t]=l,U=(e,t)=>{for(var l in t||(t={}))se.call(t,l)&&Y(e,l,t[l]);if(V)for(var l of V(t))oe.call(t,l)&&Y(e,l,t[l]);return e},$=(e,t)=>ee(e,te(t));import{r as y,j as o,A as le,M as B}from"./jj85rqzpbnvv3emr.js";import{i as X,cj as ne,gi as ce,j as re,n4 as ie,ch as ae,cg as de,e as P,ib as ue,P as q,bI as J}from"./lef5ym39glv4981l.js";import{cJ as H,cK as pe,cL as _e,cM as W,cN as xe,cO as K,Y as fe,bs as C,cP as me,cQ as ge,cR as he,cp as ve}from"./mclphevd122040jw.js";import{F as be}from"./n8vi41od4r1tq9yq.js";function z(e,t){const l=new RegExp("<\\s*".concat(t,"\\s*>([\\s\\S]*?)<\\s*/\\s*").concat(t,"\\s*>"),"i"),u=e.match(l);return u&&u[1]?u[1].trim():e}function je(e){if(e===void 0)return;const t="Content Snippet:",l=e.indexOf(t);return l===-1?e:e.substring(l+t.length).trim()}function ye(e,t){var l,u,F,i,d;t.text=je(e.contents),(l=e.documentId)!=null&&l.includes("ks--slack")||(u=t.cloud_doc_url)!=null&&u.match(/^https:\/\/github\.com\/[^/]+\/[^/]+\/(issues|pull)\/\d+/)?(t.text=void 0,t.name="#".concat(t.name)):(F=t.cloud_doc_url)!=null&&F.startsWith("https://docs.google.com/spreadsheets/")&&t.text!==void 0?t.text=z(t.text,"sheet_summary"):(i=t.cloud_doc_url)!=null&&i.match(/^https:\/\/github\.com\/[^/]+\/[^/]+\/commit\//)&&t.text!==void 0?t.text=z(t.text,"git_summary"):(d=t.cloud_doc_url)!=null&&d.match(/^https:\/\/github\.com\/[^/]+\/[^/]+\/blob\//)&&t.text!==void 0&&(t.text=z(t.text,"code_summary")),t.text&&(t.text=t.text.slice(0,250))}function Ne({turnIndex:e,clientThreadId:t,variant:l="sidebar"}){const u=X(),F=H(),i=pe(),d=_e(),[c,k]=ne(t,_=>[J.getTurnContentReferences(_,e),J.getConversationTurnAtIndex(_,e).messages]),S=ce(t),p=re(u,"2137702454"),E=y.useMemo(()=>({turnIndex:e,clientThreadId:t}),[t,e]),N=y.useMemo(()=>{const _=[],x=new Set,a=new Map;if(d.forEach(s=>{a.set(s,[])}),c.forEach(s=>{var f,w,I,r,T,g,R,v,A;if(s.type==="file"&&!x.has(s.id)){const n=W((f=s.cloud_doc_url)!=null?f:""),m={id:s.id,name:(w=n==null?void 0:n.type)!=null?w:s.name,subtitle:n!=null&&n.type?s.name:void 0,cloud_doc_url:(r=s.cloud_doc_url)!=null?r:(I=s.extra)==null?void 0:I.cloud_doc_url,text:p?s.snippet:void 0,authors:(T=s.medical_file_reference)==null?void 0:T.authors_display,publication_year:(g=s.medical_file_reference)==null?void 0:g.publication_year,journal_name:(R=s.medical_file_reference)==null?void 0:R.journal_name,doi:(v=s.medical_file_reference)==null?void 0:v.doi};_.push(m),a.has(s.type)&&((A=a.get(s.type))==null||A.push(m)),x.add(s.id)}else s.type==="file_navlist"?s.items.forEach(n=>{var m,M,O;if(!x.has(n.id)){const b=W((m=n.cloud_doc_url)!=null?m:""),j={name:(M=b==null?void 0:b.type)!=null?M:n.name,subtitle:b!=null&&b.type?n.name:void 0,cloud_doc_url:n.cloud_doc_url,text:p?n.description:void 0,id:n.id,lastModifiedTime:n.last_modified_time};_.push(j),a.has(s.type)&&((O=a.get(s.type))==null||O.push(j)),x.add(n.id)}}):s.type==="grouped_webpages"&&i&&s.items.forEach(n=>{var m,M,O,b;if(!x.has(n.url)){const j=W((m=n.url)!=null?m:""),Q={name:(M=j==null?void 0:j.type)!=null?M:n.title,subtitle:j!=null&&j.type?n.title:void 0,cloud_doc_url:n.url,text:p&&(O=n.snippet)!=null?O:void 0,journal_name:n.attribution,id:n.url};_.push(Q),a.has(s.type)&&((b=a.get(s.type))==null||b.push(Q)),x.add(n.url)}})}),d.length>0){const s=[];return d.forEach(f=>{var w;a.has(f)&&s.push(...(w=a.get(f))!=null?w:[])}),s}return _},[d,c,p,i]),h=ie(S),L=y.useMemo(()=>{var a,s;if(!h||l==="bottom")return[];const _=[],x=new Set;for(const f of k)if(f.author.role===ae.Tool&&f.author.name==="file_search"&&f.content.content_type===de.TetherBrowsingDisplay){const w=xe(f.content.result),I=(s=(a=f.metadata)==null?void 0:a.cloud_doc_urls)!=null?s:[];w.chunks.forEach((r,T)=>{var n,m;if(!r.documentId||x.has(r.documentId))return;x.add(r.documentId);let g;if(r.metadata.cloud_doc_url)g=r.metadata.cloud_doc_url.toString();else if(T<I.length)g=I[T];else if(r.documentId.endsWith("--google")){const M=r.documentId.split("--")[1];g="https://drive.google.com/file/d/".concat(M)}const R=(n=r.metadata["File last modified at"])!=null?n:r.metadata["File created at"],v=W(g!=null?g:""),A={id:r.documentId,name:(m=v==null?void 0:v.type)!=null?m:r.title,subtitle:v!=null&&v.type?r.title:void 0,cloud_doc_url:g,text:r.contents,lastModifiedTime:R?R.toString():void 0};ye(r,A),_.push(A)})}return _},[h,k,l]),G=[];return o.jsx(le,{children:o.jsxs("div",{className:P("bg-token-main-surface-primary flex w-full flex-col",l==="sidebar"&&"mt-[calc(var(--threadFlyOut-leading-height,57px)*-1)]"),children:[o.jsx(Z,{title:o.jsx(B,{id:"dlVlo6",defaultMessage:"Citations"}),items:N,clientThreadId:t,sectionId:"citations",analyticsMetadata:E}),!F&&o.jsx(Z,{title:o.jsx(B,{id:"njZblE",defaultMessage:"Search Results"}),items:L,clientThreadId:t,sectionId:"search-results",analyticsMetadata:E,unstructuredResults:G})]})})}function Z({title:e,items:t,scrollToHeader:l,shouldAnimateScroll:u,clientThreadId:F,analyticsMetadata:i,sectionId:d,unstructuredResults:c=[]}){const k=X(),S=ue(k),p=y.useRef(null),E=y.useMemo(()=>i?$(U({},i),{sectionId:d,numResultsInSection:t.length}):void 0,[i,t.length,d]);return y.useEffect(()=>{p.current&&l&&setTimeout(()=>{p.current&&p.current.scrollIntoView({behavior:u?"smooth":"instant"})},300)},[l,u]),c.length===0&&(!t||t.length===0)?null:o.jsxs("div",{ref:p,children:[o.jsx(K,{className:P("bg-token-main-surface-primary text-token-text-primary sticky top-0 z-1 flex items-center px-6 pt-4 pb-4 text-sm font-medium",S?"border-b-thin h-[calc(var(--header-height,3.5rem))] border-(--bento-border-color)":"border-token-border-sharp h-[calc(var(--header-height,3.5rem)+1px)] border-b"),children:e}),o.jsxs("div",{className:"flex list-none flex-col px-3 py-2",children:[t.map((N,h)=>o.jsx(K,{index:h,children:o.jsx(Fe,{positionInSection:h,item:N,analyticsMetadata:E,clientThreadId:F},h)},"".concat(e,"-").concat(h))),c]})]})}function Fe({item:e,analyticsMetadata:t,positionInSection:l,clientThreadId:u}){var _,x,a;const F=fe(),i=H(),d=i&&e.journal_name!=null?e.journal_name:e.name,c=W((_=e.cloud_doc_url)!=null?_:"");let k=d!=null?d:o.jsx(B,{id:"bqY3sN",defaultMessage:"File"}),S=(x=c==null?void 0:c.Icon)!=null?x:e.cloud_doc_url?C:me;!e.cloud_doc_url&&!ge(e.id)&&(k=o.jsx(B,{id:"hGgoxF",defaultMessage:"Source"}),S=C);const[p,E]=y.useState(!1),N=e.cloud_doc_url?e.cloud_doc_url:"";i&&N.length>0&&(S=({className:s})=>o.jsx(ve,{url:N,className:P(s,"object-cover"),size:32,fallback:o.jsx(C,{className:s})}));const h=y.useCallback(()=>{t&&q.logEventWithStatsig("File Sources Sidebar Item Clicked","file_sources_sidebar_link_clicked",$(U({},t),{positionInSection:l,sourceType:c==null?void 0:c.type,hasUrl:!!e.cloud_doc_url}))},[t,e.cloud_doc_url,c==null?void 0:c.type,l]),L=y.useCallback(()=>{t&&q.logEventWithStatsig("File Source Sidebar Item Followup Clicked","file_sources_sidebar_item_followup_clicked",$(U({},t),{positionInSection:l,sourceType:c==null?void 0:c.type,hasUrl:!!e.cloud_doc_url}))},[t,e.cloud_doc_url,c==null?void 0:c.type,l]);return o.jsx(o.Fragment,{children:o.jsxs("a",{href:e.cloud_doc_url,target:"_blank",rel:"noreferrer",onClick:h,className:P("group relative flex flex-col gap-0.5 rounded-xl px-3 py-2.5","hover:bg-token-main-surface-secondary",p&&"bg-token-main-surface-secondary"),children:[o.jsxs("div",{className:"ellipses flex h-6 items-center gap-2 text-xs",children:[S&&o.jsx(S,{className:"icon-sm bg-primary flex-none rounded-full object-cover"}),o.jsx("p",{className:"text-token-text-secondary flex-auto truncate overflow-ellipsis",children:k})]}),i&&e.name!=null&&o.jsx("div",{className:"line-clamp-2 text-sm font-bold break-words",children:e.name}),i&&e.authors!=null&&e.publication_year!=null&&o.jsxs("div",{className:"line-clamp-2 text-sm break-words",children:[o.jsx("span",{className:"italic",children:e.authors}),o.jsx("span",{className:"ms-1 not-italic",children:e.publication_year})]}),i&&e.doi!=null&&o.jsx("div",{className:"line-clamp-2 text-sm break-words",children:e.doi}),e.subtitle&&o.jsx("div",{className:"text-token-text-primary line-clamp-1 text-sm font-semibold",children:e.subtitle}),((a=e.text)!=null?a:e.lastModifiedTime)&&o.jsxs("div",{className:"text-token-text-secondary line-clamp-2 text-sm leading-snug font-normal",children:[e.lastModifiedTime&&o.jsxs("span",{children:[o.jsx(he,{date:new Date(e.lastModifiedTime.trim())}),e.text&&" â€” "]}),e.text]}),F?null:o.jsx(be,{className:P("absolute end-2 top-2 flex h-7 w-7 items-center justify-center rounded-sm p-1 transition","text-token-text-secondary group-hover:text-token-text-primary","invisible group-hover:visible","bg-token-main-surface-secondary hover:bg-token-main-surface-tertiary",p&&"bg-token-main-surface-tertiary text-token-text-primary visible"),clientThreadId:u,fileId:e.id,fileName:e.name,fileCloudDocUrl:e.cloud_doc_url,isFollowupMenuOpen:p,setIsFollowupMenuOpen:E,trackFileSourceFollowup:L})]})})}export{Ne as ChatScreenRetrievalResultsFlyoutContent,Z as SourcesListGroup,ye as __hacky_maybe_enhance_ref};
//# sourceMappingURL=dz63jikeem6urs0m.js.map
