var Y=Object.freeze,ae=Object.defineProperty,je=Object.defineProperties;var be=Object.getOwnPropertyDescriptors;var Z=Object.getOwnPropertySymbols;var ve=Object.prototype.hasOwnProperty,ke=Object.prototype.propertyIsEnumerable;var ee=(a,s,t)=>s in a?ae(a,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[s]=t,B=(a,s)=>{for(var t in s||(s={}))ve.call(s,t)&&ee(a,t,s[t]);if(Z)for(var t of Z(s))ke.call(s,t)&&ee(a,t,s[t]);return a},se=(a,s)=>je(a,be(s));var te=(a,s)=>Y(ae(a,"raw",{value:Y(s||a.slice())}));import{b as y,j as e,d as Me,m as oe,am as Ce,r as u,A as Se,M as G,R as Ne}from"./jj85rqzpbnvv3emr.js";import{eE as C,E as ie,P as A,e5 as Ee,e6 as Ie,j7 as Pe,e as g,_ as Re,e7 as Be,e9 as Le,ed as Ae,F as ye,eb as De,ec as Ue,f as Te,i as le,r as ce,bJ as J,bI as q,bK as We,J as $e,R as Fe,ax as H}from"./lef5ym39glv4981l.js";import{dK as z,f as Ge,kF as He,bm as Xe,kG as w,au as Je,dB as qe}from"./mclphevd122040jw.js";import{X as ze,L as Ke,R as Ve}from"./ln8ki2e0zoiayj0p.js";import{u as Oe}from"./ih9wj2grf6eudhng.js";import{d as ne}from"./kl7c6054usfnqmd4.js";import{g as Qe}from"./k97n0y6ba9c9h39c.js";const X=Me({download:{id:"postSharingModal.download",defaultMessage:"Download"},downloadPdfButtonMenu:{id:"postSharingModal.download-pdf-button.menu",defaultMessage:"PDF Document (.pdf)"},downloadDocxButtonMenu:{id:"postSharingModal.download-docx-button.menu",defaultMessage:"Microsoft Word Document (.docx)"}}),Ye=({downloading:a,onOdysseyFileDownload:s,disabled:t,icon:r,label:c,odysseyShareIntent:n})=>{const o=y();return n.fileName.endsWith("md")?e.jsxs(C.Root,{open:!t&&!a?void 0:!1,children:[e.jsx(C.BasicTrigger,{asChild:!0,children:e.jsxs("button",{onClick:()=>{A.logEventWithStatsig("Share Post: Social Clicked","chatgpt_post_share_link_social_clicked",{platform:"download"})},disabled:t,className:"relative flex flex-col gap-y-4 disabled:opacity-50 max-sm:gap-y-2",children:[e.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-full shadow-lg max-sm:h-12 max-sm:w-12 max-sm:shadow-md dark:shadow-md",children:e.jsx("div",{className:"pointer-events-none flex h-8 w-8 items-center justify-center max-sm:h-6 max-sm:w-6",children:a?e.jsx(ie,{}):r})}),e.jsx("div",{className:"w-full text-center text-xs",children:c})]})}),e.jsx(C.Portal,{children:e.jsxs(C.Content,{align:"end",children:[e.jsx(C.Item,{onClick:i=>{i.preventDefault(),s==null||s(n.fileName,n.fileId,n.messageId,"pdf")},children:o.formatMessage(X.downloadPdfButtonMenu)}),e.jsx(C.Item,{onClick:i=>{i.preventDefault(),s==null||s(n.fileName,n.fileId,n.messageId,"docx")},children:o.formatMessage(X.downloadDocxButtonMenu)})]})})]},"download"):e.jsxs("button",{onClick:()=>{s==null||s(n.fileName,n.fileId,n.messageId,null),A.logEventWithStatsig("Share Post: Social Clicked","chatgpt_post_share_link_social_clicked",{platform:"download"})},disabled:t,className:"relative flex flex-col gap-y-4 disabled:opacity-50 max-sm:gap-y-2",children:[e.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-full shadow-lg max-sm:h-12 max-sm:w-12 max-sm:shadow-md dark:shadow-md",children:e.jsx("div",{className:"pointer-events-none flex h-8 w-8 items-center justify-center max-sm:h-6 max-sm:w-6",children:e.jsx(z,{})})}),e.jsx("div",{className:"w-full text-center text-xs",children:o.formatMessage(X.download)})]},"download")};function Ze({className:a,children:s,position:t="center",size:r,removePopoverStyling:c=!1,shadow:n="normal"}){const o=Ce(),i=y(),f=Math.random()*40-20;return u.useEffect(()=>{o.start({x:0,y:0,rotate:0,opacity:1,transition:{type:"spring",duration:.6,bounce:.15}})},[o]),e.jsx(oe.div,{initial:{x:0,y:"100%",rotate:0,opacity:1},animate:o,exit:{x:0,y:"100%",rotate:f,opacity:1},transition:{type:"spring",duration:.6,bounce:.15},className:g("z-50 h-full w-full overflow-y-auto",r!=="fullscreen"&&"grid grid-cols-[10px_1fr_10px]",r!=="fullscreen"&&t==="center"&&"grid-rows-[minmax(10px,1fr)_auto_minmax(10px,1fr)] md:grid-rows-[minmax(20px,1fr)_auto_minmax(20px,1fr)]",r!=="fullscreen"&&t==="bottom"&&"grid-rows-[minmax(10px,1fr)_auto_10px] md:grid-rows-[minmax(20px,1fr)_auto_20px]"),children:e.jsx(Le,{className:g(!c&&"popover","bg-token-sidebar-surface relative start-1/2 col-auto col-start-2 row-auto row-start-2 h-full w-full min-w-0 gap-4 p-4 text-start ltr:-translate-x-1/2 rtl:translate-x-1/2 dark:bg-[#171717]",r!=="fullscreen"&&"rounded-[36px]",n==="normal"&&"shadow-[0_32px_48px_rgba(0,0,0,0.175),_0_0_1px_rgba(0,0,0,0.2)] dark:shadow-[0_32px_48px_rgba(0,0,0,0.175),_0_0_1px_rgba(255,255,255,0.4)]",a),"aria-description":i.formatMessage({id:"slide-up-modal.share-sheet.description",defaultMessage:"Share sheet"}),"aria-describedby":"",children:s})})}function ea({isOpen:a,onClose:s,children:t,shouldIgnoreClickOutside:r=!1,className:c}){var n;return e.jsx(Ee,{open:a,onOpenChange:o=>{r||o===!1&&s(!1)},children:e.jsx(Ie,{container:(n=Pe())==null?void 0:n.document.body,children:e.jsx("div",{className:g("absolute inset-0",c),children:t})})})}function aa({className:a,children:s,showBackground:t=!0}){const r=Re(),c=t?r?"rgba(0, 0, 0, 0.8)":"rgba(249,249,249,0.8)":"rgba(0, 0, 0, 0)";return e.jsx(Be,{asChild:!0,children:e.jsx(oe.div,{initial:{backdropFilter:"blur(0px)",backgroundColor:r?"rgba(0, 0, 0, 0)":"rgba(255, 255, 255, 0)"},animate:{backdropFilter:t?"blur(4px)":"blur(0px)",backgroundColor:c},exit:{backdropFilter:"blur(0px)",backgroundColor:r?"rgba(0, 0, 0, 0)":"rgba(255, 255, 255, 0)"},className:g("fixed inset-0 z-50",a),children:s})})}function sa({title:a,description:s,icon:t,type:r}){return e.jsxs("div",{className:"flex max-w-full min-w-0 items-center",children:[e.jsx(na,{icon:t,type:r}),e.jsxs("div",{className:"flex max-w-full min-w-0 grow flex-col gap-1",children:[a!=null&&e.jsx(De,{className:"text-token-text-primary text-3xl leading-6 font-semibold tracking-tight max-sm:text-xl",children:a}),s!=null&&e.jsx(Ue,{className:"text-token-text-tertiary text-sm",children:s})]})]})}function ta({title:a,accessory:s,description:t,withSeparator:r=!0,icon:c,type:n,closeButton:o,textCenter:i}){return!a&&!t?null:e.jsxs(ra,{$hasSeparator:r,children:[e.jsx("div",{className:g("flex max-w-full",i&&"flex-1 justify-center text-center"),children:e.jsx(sa,{title:a,description:t,icon:c,type:n})}),e.jsxs("div",{className:"flex items-center gap-5",children:[s,o!=null&&e.jsx(Ae,{asChild:!0,className:"sm:mt-0",children:o})]})]})}const na=({type:a,icon:s})=>s==null?null:e.jsx("div",{className:g("me-4 flex h-12 w-12 shrink-0 items-center justify-center rounded-full sm:h-10 sm:w-10",a==="danger"&&"bg-red-100",a==="warning"&&"bg-yellow-100",a==="success"&&"bg-green-100"),children:e.jsx(s,{className:g("icon-lg",a==="danger"&&"text-red-600",a==="warning"&&"text-yellow-700",a==="success"&&"text-green-700"),"aria-hidden":"true"})});var re;const ra=ye.div(re||(re=te(["px-4 pb-2 sm:p-6 flex items-center justify-between ",""])),({$hasSeparator:a})=>a&&"border-b border-black/10 dark:border-white/10"),L={Root:ea,Overlay:aa,Content:Ze,Header:ta};function oa({showLinkCopied:a,isGeneratingShareLink:s,onClick:t,postText:r,showDownloadButton:c,odysseyShareIntent:n,isDownloadingOdyssey:o,onOdysseyFileDownload:i,disabled:f}){const x=y(),I=le(),S=ce(I),P=S==null?void 0:S.isWorkspaceAccount();let _=[{id:"copy",icon:s?e.jsx(ie,{}):e.jsx(Je,{}),label:a?x.formatMessage(w.linkCopied):x.formatMessage(w.copyLink),action:"copy"}];P?c&&_.push({id:"download",icon:e.jsx(z,{}),label:x.formatMessage({id:"postSharingModal.download",defaultMessage:"Download"}),action:"download"}):_=_.concat({id:"x",href:d=>"https://twitter.com/intent/tweet?url=".concat(encodeURIComponent(d),"&text=").concat(r?encodeURIComponent(r):""),icon:e.jsx(ze,{initialFillColor:"var(--text-primary)"}),label:x.formatMessage({id:"postSharingModal.x",defaultMessage:"X"}),action:"share"},{id:"linkedin",href:d=>"https://www.linkedin.com/shareArticle?url=".concat(encodeURIComponent(d),"&text=").concat(r?encodeURIComponent(r):""),icon:e.jsx(Ke,{initialFillColor:"var(--text-primary)"}),label:x.formatMessage({id:"postSharingModal.linkedin",defaultMessage:"LinkedIn"}),action:"share"},{id:"reddit",href:d=>"https://www.reddit.com/submit?url=".concat(encodeURIComponent(d),"&title=").concat(r?encodeURIComponent(r):""),icon:e.jsx(Ve,{initialFillColor:"var(--text-primary)"}),label:x.formatMessage({id:"postSharingModal.reddit",defaultMessage:"Reddit"}),action:"share"},...c?[{id:"download",icon:e.jsx(z,{}),label:x.formatMessage({id:"postSharingModal.download",defaultMessage:"Download"}),action:"download"}]:[]);const j=!!o;return e.jsx(e.Fragment,{children:_.map(d=>d.id==="download"&&n?e.jsx(Ye,{downloading:j,onOdysseyFileDownload:i,disabled:f!=null?f:!1,icon:d.icon,label:d.label,odysseyShareIntent:n},d.id):e.jsxs("button",{onClick:()=>{t(d),A.logEventWithStatsig("Share Post: Social Clicked","chatgpt_post_share_link_social_clicked",{platform:d.id})},disabled:f,className:"relative flex flex-col gap-y-4 disabled:opacity-50 max-sm:gap-y-2",children:[e.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-full shadow-lg max-sm:h-12 max-sm:w-12 max-sm:shadow-md dark:shadow-md",children:e.jsx("div",{className:"pointer-events-none flex h-8 w-8 items-center justify-center max-sm:h-6 max-sm:w-6",children:d.icon})}),e.jsx("div",{className:"w-full text-center text-xs",children:d.label})]},d.id))})}function ia(a,s){const t=J(a);return t?{id:"tmp",kind:"message_slice",messages:s.map(c=>{const n=q.findNode(t,({message:o})=>o.id===c);return n?n.message:null}).filter(Boolean)}:null}function la(a){return{id:"tmp",kind:"message_slice",messages:[a.previewMessage]}}function wa({postSharingData:a,onClose:s}){const{clientThreadId:t,postText:r,generateShareLinkFn:c,coverImageUrl:n,messageSliceIds:o,odysseyShareIntent:i}=a,f=u.useRef(void 0),[x,I]=u.useState(!1),[S,P]=u.useState(!1),_=y(),j=Te(),[d,K]=u.useState(!0),de=le(),D=ce(de),U=D==null?void 0:D.isWorkspaceAccount();u.useEffect(()=>{A.logEventWithStatsig("Share Post: Post Sharing Modal Shown","chatgpt_post_share_modal_shown")},[]),u.useEffect(()=>{f.current=void 0},[t]);const N=u.useMemo(()=>i?la(i):n||!o||o.length===0?null:ia(t,o),[n,t,o,i]),T=u.useMemo(()=>{const m=J(t);return m?q.getConversationTurns(m).flatMap(h=>h.messages):[]},[t]);u.useEffect(()=>{if(!o||o.length===0)return;const m=J(t);o.filter(p=>!q.findNode(m,({message:b})=>b.id===p)).length>0&&Ge(t)},[t,o]);const{hasImage:me,hasScreenshot:fe}=u.useMemo(()=>{let m=!1,h=!1;if(T.length){const p=T,b=/\.(jpe?g|png|gif|webp|bmp|tiff)$/i,E=v=>{if(!Array.isArray(v))return!1;for(const l of v)if(l.type==="image_inline"&&l.clicked_from_url&&(h=!0),l.type==="file"&&"file_name"in l){const M=l.file_name.toLowerCase();(M.endsWith(".pptx")||b.test(M))&&(m=!0)}};p.forEach(v=>{var R,V,O,Q;const l=v.metadata;if(!l)return;const M=[...Object.values((R=l.n7jupd_crefs_by_file)!=null?R:{}).flat(),...Object.values((V=l.content_references_by_file)!=null?V:{}).flat()],F=[...(O=l.n7jupd_crefs)!=null?O:[],...(Q=l.content_references)!=null?Q:[]];E(M),E(F)})}return{hasImage:m,hasScreenshot:h}},[T]),W=We(t),ue=async(m,h)=>{if(!(x||!W)&&W){if(!f.current){I(!0);try{const p=await c();p&&(f.current=p)}catch(p){j.danger(w.failedToGenerateShareLink,{toastId:"failed_to_generate_share_link"})}finally{I(!1)}}if(f.current){if(m.action==="copy")navigator.clipboard.writeText(f.current),P(!0),j.success(_.formatMessage(w.linkCopied)),setTimeout(()=>{P(!1)},3e3);else if(m.action==="share"&&m.href)window.open(m.href(f.current),"_blank","noopener,noreferrer");else if(m.action==="download"){if(!n)return;qe({url:n,fileName:"".concat(r,".png")})}}}},xe=e.jsx("div",{className:g("flex w-full justify-center rounded-xl",n||N&&(i!=null&&i.isStandaloneAttachment)?"max-xs:max-h-[260px] h-[30vh] max-h-[550px] max-sm:max-h-[300px]":"aspect-[1200/630]",!n&&!(i!=null&&i.isStandaloneAttachment)&&"outline-token-border-light overflow-hidden shadow-sm outline outline-1"),children:n?e.jsx("img",{src:n,alt:r}):i!=null&&i.isStandaloneAttachment&&N?e.jsx(He,{attachments:[N],variant:"unfurl",className:"h-full w-full",clientThreadId:t}):N?e.jsx(Xe,{attachments:[N],clientThreadId:t,className:"h-full"}):null}),ge="normal",[he,$]=u.useState(!1),{presentationMap:pe}=Oe(),k=_.formatMessage(w.downloadFileError),we=async(m,h,p,b)=>{var v;const E=W;if(!(!m||!h||!E))if($(!0),m.endsWith("md")){if(!b)return;try{const l=await Fe.safePost("/export_doc/n7jupd",{requestBody:{conversation_id:E,message_id:p,file_id:h,export_type:b},skipJsonTransform:!0});l.ok||(j.danger(k,{toastId:"post_sharing_modal_download_error",loggingTitle:k,loggingDescription:"Error message when a file download fails"}),H.addError("post_sharing_modal_download_error",{statusText:l.statusText,status:l.status}));const M=await l.blob(),F=l.headers.get("Content-Disposition"),R=(v=Qe(F))!=null?v:"Agent.".concat(b);ne(M,R)}catch(l){j.danger(k,{toastId:"post_sharing_modal_download_error",loggingTitle:k,loggingDescription:"Error message when a file download fails"}),H.addError(l)}finally{$(!1)}}else{const l=pe[h];if(!l||!l.fileBlob){j.danger(k,{toastId:"post_sharing_modal_download_error",loggingTitle:k,loggingDescription:"Error message when a file download fails"}),H.addError("post_sharing_modal_download_error"),$(!1);return}ne(l.fileBlob,m)}},_e=e.jsxs(e.Fragment,{children:[e.jsx("div",{className:g("flex flex-wrap justify-center space-y-4 space-x-12 max-sm:space-x-6","mt-12 max-sm:mt-6"),children:e.jsx(oa,{showLinkCopied:S,isGeneratingShareLink:x,disabled:x,onClick:ue,postText:r,showDownloadButton:!!(n||i),odysseyShareIntent:i,isDownloadingOdyssey:he,onOdysseyFileDownload:we})}),ca(me,fe,U!=null?U:!1)]});return e.jsx(Se,{onExitComplete:s,children:d&&e.jsx(L.Root,{isOpen:!0,onClose:()=>{K(!1)},className:"max-w-[664px] px-4",children:e.jsx(L.Overlay,{showBackground:!0,children:e.jsxs(L.Content,{size:"normal",position:"center",className:g("flex flex-col pb-4 focus:outline-hidden",{"max-w-[640px]":ge==="normal"}),removePopoverStyling:!1,shadow:"normal",children:[e.jsx(L.Header,{title:r,type:"success",closeButton:e.jsx($e,{onClick:()=>K(!1)})}),e.jsxs("div",{children:[e.jsx("div",{className:g("flex justify-center",!i&&"pointer-events-none"),children:xe}),_e]})]})})})})}function ca(a,s,t){const r=[];return t&&r.push(e.jsx(G,B({},w.shareLinkVisibleToWorkspaceOnly),"workspace")),s&&r.push(e.jsx(G,B({},w.screenshotDisclaimer),"screenshot")),a&&r.push(e.jsx(G,se(B({},w.imageLicenseDisclaimer),{values:{nbsp:" ",link:c=>e.jsx("a",{href:"https://help.openai.com/",target:"_blank",rel:"noopener noreferrer",className:"underline",children:c})}}),"image")),r.length?e.jsx("p",{className:"text-token-text-tertiary text-center text-sm sm:mt-2",children:r.map((c,n)=>e.jsxs(Ne.Fragment,{children:[n>0&&e.jsx(e.Fragment,{children:" "}),c]},n))},"image-disclaimer"):null}export{wa as PostSharingModal};
//# sourceMappingURL=gvpqzrcgxbwujqw7.js.map
