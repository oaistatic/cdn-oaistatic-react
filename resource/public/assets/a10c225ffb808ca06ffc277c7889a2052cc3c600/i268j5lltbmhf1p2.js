const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/lz9e0y9lvu5e72oe.js","assets/jj85rqzpbnvv3emr.js","assets/lef5ym39glv4981l.js","assets/root-ogjlcpyy.css","assets/mueia064md5nlhd6.js","assets/eyi9jrf1bwm7dn6f.js","assets/mclphevd122040jw.js","assets/conversation-small-g7l5datj.css","assets/l041el2tch1t3nkf.js"])))=>i.map(i=>d[i]);
var Re=Object.freeze,We=Object.defineProperty,va=Object.defineProperties;var ja=Object.getOwnPropertyDescriptors;var ae=Object.getOwnPropertySymbols;var Ge=Object.prototype.hasOwnProperty,qe=Object.prototype.propertyIsEnumerable;var Fe=(a,s,t)=>s in a?We(a,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[s]=t,n=(a,s)=>{for(var t in s||(s={}))Ge.call(s,t)&&Fe(a,t,s[t]);if(ae)for(var t of ae(s))qe.call(s,t)&&Fe(a,t,s[t]);return a},j=(a,s)=>va(a,ja(s));var Ye=(a,s)=>{var t={};for(var i in a)Ge.call(a,i)&&s.indexOf(i)<0&&(t[i]=a[i]);if(a!=null&&ae)for(var i of ae(a))s.indexOf(i)<0&&qe.call(a,i)&&(t[i]=a[i]);return t};var He=(a,s)=>Re(We(a,"raw",{value:Re(s||a.slice())}));import{b as D,r as y,j as e,M as l,d as I,q as ia,f as J,e as ya,u as ba,a as Ke,c as Sa,g as Ma,i as Ba,G as _a}from"./jj85rqzpbnvv3emr.js";import{e as na,g as wa,f as la,a as Ca,c as Na,d as Ia,h as La}from"./fya3qb1e1s8z4llj.js";import{ai as ne,oA as Ta,c6 as ka,aj as R,lV as ra,dK as Ea,dn as Qe,be as Pa,gO as za,kf as Ua,a8 as xe,bH as ee,og as te,bJ as se,tC as Da,gt as oa,d7 as Aa,dq as Oa,Q as Ra,nF as $e,jU as Fa,g2 as Wa,aU as Ga,nG as qa,hz as Ya,mq as Ha,tD as Ka,nP as Qa,bV as $a,tE as Va,tF as Xa,nH as Za}from"./mclphevd122040jw.js";import{f as he,aE as A,b as Ja,i as O,q as et,C as fe,ez as oe,I as da,j as ve,B as w,bi as F,t as pe,R as z,ax as ca,ex as ga,ey as ma,P as N,iK as je,hj as ye,F as at,e as K,eE as U,E as le,lb as ie,fv as ua,d as be,s as pa,ho as tt,jc as st,T as it,n as nt,dZ as lt,fw as rt}from"./lef5ym39glv4981l.js";import{u as xa,T as ot,a as dt}from"./oup0p7xztimao0r3.js";import{T as ct,a as gt}from"./ghs0b9qiouvv0rxl.js";import{u as mt,T as Y,d as ut}from"./gnu79wd8bxnkjimp.js";import{R as pt,B as xt,X as ht,Y as ft,T as vt,d as Ve,e as Xe,S as Ze,M as jt}from"./ck1161dhvnx32o2f.js";import{c as yt,E as bt}from"./h0k73bnwu158btqf.js";import{L as Se}from"./b2skq2o9dgw287ng.js";import"./n82i9qkvs5r9bggc.js";import"./9z485wf4plyfoo73.js";import"./cncd8uuk5eicbkeu.js";import"./dta5t6ifyam55mk9.js";import"./cdk0cmbgnafohb1q.js";import"./gyvvad7btmtz1x9o.js";import"./n6vmm5pyahusdy8e.js";import"./l041el2tch1t3nkf.js";import"./easgat082167v0i8.js";import"./dvqe6kc43fkjsavv.js";import"./mw2u7timj0qnsnvj.js";import"./hnotrmacgvnfyexv.js";import"./mej2ctt6swvc1m1z.js";import"./go9515ghq3pauvs4.js";import"./d9serb02oz4r1lgw.js";import"./n5wrqpcxv1sjah44.js";import"./bm60ocel3j0ixm99.js";import"./eksfatdee5z30mgz.js";import"./cfjmhsr8xf6xwmmf.js";import"./m46a0bw94g3hbrbv.js";import"./mueia064md5nlhd6.js";import"./eyi9jrf1bwm7dn6f.js";import"./gd5k9khi2ma4fx2d.js";import"./392jyrzapv8u4xa7.js";import"./byc485nmh825ib1a.js";import"./fnnulb9pmlo3cgid.js";import"./k6u2cn52t3dhqz8s.js";import"./c631j8z7keqfibnl.js";import"./galyil7vygq0i5a6.js";import"./f8qcx5r3ombc6w5p.js";import"./l5n8sav08y32nia1.js";import"./efsl2tpd3w39q64v.js";import"./nuvef33udhwgu2hu.js";import"./fue7kd61xxcv74sk.js";const St="https://q.surveyfeedbackresponse.com/jfe/form/SV_9vIX2bUyeLKgCZo";function Mt({isOpen:a,onClose:s}){var T,k;const t=D(),i=he(),{data:c,isLoading:d}=ne(),r=A(),o=Ta(r==null?void 0:r.id),g=Ja(),p=O(),[u,x]=y.useState(""),[h,m]=y.useState(!1),b=(g==null?void 0:g.email)&&u.toLowerCase()==g.email.toLowerCase(),[v,L]=y.useState(!!(c&&!c.will_renew));if(!a||d||!r||!c)return null;const M=!v&&((T=r==null?void 0:r.isWorkspaceAccount())!=null?T:!1)&&((k=r==null?void 0:r.isTeam())!=null?k:!1)&&et(p,"4280292244").get("enabled",!1),B=async()=>{m(!0);try{await o.mutateAsync(r.id),L(!0),window.open("".concat(St,"?user_id=").concat(g==null?void 0:g.id,"&account_id=").concat(r.id,"&plan_type=").concat(c.plan_type),"_blank")}catch(E){i.warning(t.formatMessage(P.errorCancellingSubscription),{hasCloseButton:!0})}finally{m(!1)}};return e.jsx(fe,{testId:"modal-cancel-team-plan",type:"success",onClose:s,showCloseButton:!0,isOpen:a,className:"",title:e.jsx("span",{className:"text-lg",children:e.jsx(l,n({},P.cancelPlan))}),children:v?e.jsxs("div",{children:[e.jsx("h3",{className:"text-token-text-primary mb-2 text-base font-semibold",children:e.jsx(l,n({},P.successfullyCanceled))}),c.active_until!=null&&e.jsx("p",{className:"text-token-text-primary text-sm",children:e.jsx(l,j(n({},M?q.workspaceAccessEnds:V.retainUntil),{values:{expiryDate:new Date(c.active_until)}}))}),e.jsx("div",{className:"mt-6 flex w-full flex-row justify-end",children:e.jsx(oe,{title:t.formatMessage(P.doneButton),color:"primary",onClick:s,disabled:h})})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4",children:[e.jsxs("div",{className:"flex w-full items-center gap-4",children:[e.jsx(ka,{src:r.data.profilePictureUrl,size:"large"}),e.jsxs("div",{className:"flex-col",children:[e.jsx("p",{className:"font-semibold",children:r.data.name}),e.jsx("p",{className:"text-token-text-secondary text-sm",children:e.jsx(l,j(n({},P.membersCount),{values:{count:c.seats_entitled}}))})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("h3",{className:"text-token-text-primary mb-2 text-base font-semibold",children:e.jsx(l,n({},M?q.areYouSure:V.areYouSure))}),M?e.jsxs(e.Fragment,{children:[e.jsxs("ul",{className:"text-token-text-secondary list-disc ps-5 text-sm",children:[e.jsx("li",{className:"my-2",children:e.jsx(l,n({},q.dataUnavailable))}),e.jsx("li",{className:"my-2",children:e.jsx(l,n({},q.adminControlsUnavailable))}),e.jsx("li",{className:"my-2",children:e.jsx(l,n({},q.dataPrivacyUnavailable))}),e.jsx("li",{className:"my-2",children:e.jsx(l,n({},q.businessFeaturesUnavailable))})]}),c.active_until!=null&&e.jsx("p",{className:"text-token-text-secondary mt-4 text-sm",children:e.jsx(l,j(n({},q.workspaceAccessEnds),{values:{expiryDate:new Date(c.active_until)}}))})]}):e.jsxs("ul",{className:"text-token-text-secondary list-disc ps-5 text-sm",children:[e.jsx("li",{className:"my-2",children:e.jsx(l,n({},V.dataUnavailable))}),c.active_until!=null&&e.jsx("li",{className:"my-2",children:e.jsx(l,j(n({},V.retainUntil),{values:{expiryDate:new Date(c.active_until)}}))}),e.jsx("li",{className:"my-2",children:e.jsx(l,n({},V.retainEmailAccess))})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("h3",{className:"text-token-text-primary mb-2 text-base font-semibold",children:e.jsx(l,n({},P.enterEmailToConfirm))}),e.jsx(da,{ariaLabel:t.formatMessage(P.enterEmailToConfirm),type:"text",name:"user-email",placeholder:"abcd@acme.com",onChange:E=>{x(E.target.value)}})]})]}),e.jsxs("div",{className:"mt-6 flex w-full flex-row justify-end",children:[e.jsx(oe,{title:t.formatMessage(P.keepSubscriptionButton),onClick:s,disabled:h}),e.jsx(oe,{title:t.formatMessage(P.cancelSubscriptionButton),onClick:B,disabled:!b,loading:h,color:"danger",className:"ms-2"})]})]})})}const P=I({cancelPlan:{id:"cancelTeamPlanModal.cancelPlan",defaultMessage:"Cancel subscription"},errorCancellingSubscription:{id:"cancelTeamPlanModal.errorCancellingSubscription",defaultMessage:"There was a problem cancelling your subscription."},doneButton:{id:"cancelTeamPlanModal.doneButton",defaultMessage:"Done"},keepSubscriptionButton:{id:"cancelTeamPlanModal.keepSubscriptionButton",defaultMessage:"Keep subscription"},cancelSubscriptionButton:{id:"cancelTeamPlanModal.cancelSubscriptionButton",defaultMessage:"Cancel subscription"},successfullyCanceled:{id:"cancelTeamPlanModal.successfullyCanceled",defaultMessage:"You have successfully canceled your subscription."},membersCount:{id:"cancelTeamPlanModal.membersCount",defaultMessage:"{count, plural, one {# member} other {# members}}"},enterEmailToConfirm:{id:"cancelTeamPlanModal.strongerCopy.enterEmailToConfirm",defaultMessage:"Enter your email address to confirm:"}}),V=I({dataUnavailable:{id:"cancelTeamPlanModal.dataUnavailable",defaultMessage:"All workspace data including chat history and settings will not be available."},areYouSure:{id:"cancelTeamPlanModal.areYouSure",defaultMessage:"Are you sure?"},retainUntil:{id:"cancelTeamPlanModal.retainUntil",defaultMessage:"You will retain access to the workspace until the end of your billing cycle on {expiryDate, date, long}."},retainEmailAccess:{id:"cancelTeamPlanModal.retainEmailAccess",defaultMessage:"You will still be able to use ChatGPT with the other workspaces associated with this email address."}}),q=I({dataUnavailable:{id:"cancelTeamPlanModal.strongerCopy.dataUnavailable",defaultMessage:"All workspace data, including chat history and settings"},adminControlsUnavailable:{id:"cancelTeamPlanModal.strongerCopy.adminControlsUnavailable",defaultMessage:"Essential admin controls, SAML SSO, and MFA"},dataPrivacyUnavailable:{id:"cancelTeamPlanModal.strongerCopy.dataPrivacyUnavailable",defaultMessage:"Data privacy (default-exclusion from training)"},businessFeaturesUnavailable:{id:"cancelTeamPlanModal.strongerCopy.businessFeaturesUnavailable",defaultMessage:"Unlimited ChatGPT + access to business features (analysis, Deep Research, and more)"},workspaceAccessEnds:{id:"cancelTeamPlanModal.strongerCopy.workspaceAccessEnds",defaultMessage:"Workspace access will end at the end of your billing cycle on {expiryDate, date, long}."},areYouSure:{id:"cancelTeamPlanModal.strongerCopy.areYouSure",defaultMessage:"Are you sure? Canceling means losing access to:"}});function Bt({numInUse:a,numAllocated:s,isTeam:t,subscriptionWillRenew:i,subscriptionBillingPeriod:c,accountId:d,subscriptionRenewalDate:r,billingDetails:o}){const g=O(),p=ve(g,"3954884439"),{promoEligibility:u,seatThresholdGap:x,shouldShowFreeSeatsCta:h,shouldShowSeatsPromoRedemptionNotice:m}=xa({seatsEntitled:s}),b=c==="monthly"?R.FLEXIBLE:R.ANNUAL,v=()=>{F(g,dt,{initialTeamBillingType:b,initialSeats:s,accountId:d,renewalDate:r,billingDetails:o})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-start text-base",children:e.jsx(l,j(n({},wt.description),{values:{num:"".concat(a,"/").concat(s),bold:L=>e.jsx("span",{className:"font-medium",children:L},"bolded-num-in-use")}}))}),t&&i&&p&&e.jsx("div",{className:"flex items-center gap-2",children:h?e.jsx(_t,{promoSeatThresholdGap:x,onClick:v}):e.jsx(w,{color:"secondary",onClick:v,children:e.jsx(l,{id:"components.business.NumSeats.manageSeats",defaultMessage:"Manage seats"})})})]}),t&&i&&p&&m&&e.jsx("div",{className:"mt-3",children:e.jsx(ot,{promoEligibility:u,discountPercent:ra})})]})}function _t({promoSeatThresholdGap:a,onClick:s}){const t=O();y.useEffect(()=>{pe(t,"chatgpt_business_seats_promo_cta_shown",void 0,{seat_threshold_gap:a!=null?a.toString():"null"})},[t,a]);const i=()=>{s(),pe(t,"chatgpt_business_seats_promo_cta_clicked",void 0,{seat_threshold_gap:a!=null?a.toString():"null"})};return e.jsx(w,{color:"purple",onClick:i,children:e.jsx(l,{id:"components.business.NumSeats.getSeatsPromoCta",defaultMessage:"Get discount"})})}const wt=I({description:{defaultMessage:"<bold>{num}</bold> seats in use",id:"components.business.NumSeats.description"}}),Ct=()=>ia({queryKey:["credit-pleas"],queryFn:async()=>{try{return await z.safeGet("/credits/pleas")}catch(a){ca.addError("getCreditPleas: Error fetching credit pleas",{error:a})}}}),Je="admin-credit-limit-alert-banner",Nt=ga(()=>ma(()=>import("./lz9e0y9lvu5e72oe.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(a=>a.CreditPurchaseModal)),It=()=>{const[a,s]=y.useState(!1),{data:t,isLoading:i,isError:c}=J(Ct()),d=y.useMemo(()=>{var h;const x=new Set;return(h=t==null?void 0:t.pleas)==null||h.forEach(m=>{x.add(m.user.id)}),x.size},[t]),r=y.useMemo(()=>{var m;const x=(m=t==null?void 0:t.pleas)==null?void 0:m.map(b=>b.id);if(!x||x.length===0)return null;const h=[...x].sort();return btoa(h.join(","))},[t]),o=y.useMemo(()=>localStorage.getItem(Je),[]),g=d>0&&!i&&!c&&r&&r!==o&&!a;y.useEffect(()=>{!g||!r||N.logEventWithStatsig("ChatGPT Credits: Admin Credit Limit Alert Banner Shown","chatgpt_credits_admin_credit_limit_alert_banner_shown",{numBlockedUsers:d,newEncodedIdSet:r})},[g,r,d]);const p=O(),u=y.useCallback(()=>{r&&localStorage.setItem(Je,r),s(!0),N.logEventWithStatsig("ChatGPT Credits: Admin Credit Limit Alert Banner Dismissed","chatgpt_credits_admin_credit_limit_alert_banner_dismissed",{numBlockedUsers:d,newEncodedIdSet:r})},[r,d]);return g?e.jsx(je,{primaryCtaText:e.jsx(l,n({},de.addCredits)),onPrimaryCtaClick:()=>F(p,Nt),onDismiss:u,content:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ye,{}),e.jsxs("div",{className:"grow",children:[e.jsx("div",{className:"flex items-center gap-2 font-bold",children:e.jsx(l,n({},de.licenseLimitWarning))}),e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(l,j(n({},de.licenseLimitWarningDetails),{values:{numBlockedUsers:d}}))})]})]})}):null},de=I({addCredits:{id:"organizationBillingInfo.addCredits",defaultMessage:"Add credits"},licenseLimitWarning:{id:"organizationBillingInfo.licenseLimitWarning",defaultMessage:"Some teammates are blocked"},licenseLimitWarningDetails:{id:"organizationBillingInfo.licenseLimitWarningDetails",defaultMessage:"{numBlockedUsers, plural, one {# user hit their limit and needs} other {# users hit their limits and need}} credits to continue. Add credits to unblock {numBlockedUsers, plural, one {them} other {them}}."}}),Lt=!1;function X(a,{toastId:s="chatgpt.workspaceBilling.defaultErrorToastId",message:t}={}){return mt(async(...i)=>await a(...i),{toastId:s,message:t})}const ce=5;var sa;const ge=at.div(sa||(sa=He(["loading-results-shimmer rounded-sm"])));function Tt(t){var i=t,{usageData:a}=i,s=Ye(i,["usageData"]);return e.jsxs("div",{className:"mt-6 w-full",children:[a.status==="success"&&e.jsx(kt,j(n({},s),{usageData:a.data})),a.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"h-[28px] w-[230px] opacity-50"}),e.jsx(ge,{className:"my-2 h-[20px] w-full"}),e.jsx(ge,{className:"mb-[4px] h-[20px] w-[350px] opacity-50"})]}),a.status==="error"&&e.jsx("div",{className:"h-[90px]",children:e.jsx(ye,{className:"text-token-interactive-label-danger-secondary-default"})})]})}function kt({usageData:a,denominator:s,isCurrentCycle:t}){const{total_usage:i,usage_detail:c,current_balance:d}=a,r=D(),[o,g]=y.useState(),p=na();let u=c,x=[];const h=r.formatMessage(Z.otherBarLabel);u.length>ce&&(x=u.slice(ce-1),u=[...u.slice(0,ce-1),{label:h,amount:x.reduce((M,{amount:B})=>M+B,0)}]);const m=r.formatMessage(Z.currentBalanceBarLabel),b=j(n({},u.reduce((M,{label:B,amount:T})=>j(n({},M),{[B]:T}),{})),{[m]:d}),v=i+Math.max(d,0),L=[b];return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-token-text-secondary flex items-center gap-1",children:[e.jsxs("span",{className:"flex items-center gap-1 text-xl",children:[e.jsx("span",{className:K("font-medium",t&&i>0&&i>=s?"text-token-interactive-label-danger-secondary-default":"text-token-text-primary"),children:Y.format(i)}),t&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"/"}),e.jsx("span",{children:Y.format(s)})]})]}),e.jsx("span",{children:t?e.jsx(l,j(n({},Z.creditsUsed),{values:{percentage:(s===0?1:i/s).toLocaleString(void 0,{style:"percent"})}})):e.jsx(l,n({},Z.historicalCreditsUsed))})]}),t&&p&&e.jsxs("div",{className:"text-token-interactive-label-danger-secondary-default bg-token-bg-status-error flex items-center gap-1 rounded-md p-1 text-xs",children:[e.jsx(ye,{className:"h-4 w-4"}),e.jsx(l,n({},Z.overageLimitReachedWarning))]})]}),v!==0&&e.jsx(pt,{className:"relative z-1 my-2",width:"100%",height:20,children:e.jsxs(xt,{data:L,layout:"vertical",margin:{top:0,right:0,left:0,bottom:0},children:[e.jsx(ht,{type:"number",hide:!0,domain:[0,v]}),e.jsx(ft,{type:"category",hide:!0}),e.jsx(vt,{isAnimationActive:!1,content:e.jsx(Et,{hoveredSegment:o,totalUsage:i,barMaximum:v,additionalSeries:o===h?x:void 0}),cursor:!1}),u.map(({label:M},B)=>{const T=B===0,k=B===u.length-1&&d<=0;return e.jsx(Ve,{dataKey:M,stackId:"a",id:M,isAnimationActive:!1,onMouseOver:()=>g(M),onMouseOut:()=>g(void 0),radius:T?k?[4,4,4,4]:[4,0,0,4]:k?[0,4,4,0]:void 0,children:e.jsx(Xe,{fill:Ze[B],opacity:o&&M!==o?.8:1,className:"transition-opacity duration-200 ease-in-out"})},M)}),d>0&&e.jsx(Ve,{dataKey:m,stackId:"a",isAnimationActive:!1,onMouseOver:()=>g(m),onMouseOut:()=>g(void 0),radius:[0,4,4,0],children:e.jsx(Xe,{fill:jt,opacity:.15})})]})}),e.jsx("div",{className:"text-token-text-primary flex w-full flex-wrap items-center justify-start text-sm",children:u.map(({label:M},B)=>e.jsxs("div",{className:"me-6 mb-1 flex cursor-default items-center",title:M,children:[e.jsx("div",{className:"me-1 h-2 w-2 rounded-[1px]",style:{backgroundColor:Ze[B]}}),e.jsx("span",{className:"me-1 max-w-32 overflow-hidden text-ellipsis whitespace-nowrap",children:M})]},M))})]})}const Et=({active:a,payload:s,hoveredSegment:t,barMaximum:i,additionalSeries:c})=>{if(!(a&&s&&t))return null;const d=({amount:o})=>e.jsxs("span",{children:[e.jsx("span",{className:"font-semibold",children:Y.format(o)})," (",(o/i).toLocaleString(void 0,{style:"percent"}),")"]}),r=s[0].payload[t];return e.jsxs("div",{className:"border-token-border-heavy bg-token-bg-primary relative z-100 flex flex-col gap-1 rounded-lg border p-2 shadow-md",children:[e.jsxs("div",{children:[e.jsx("div",{children:t}),e.jsx("div",{children:e.jsx(d,{amount:r})})]}),c&&e.jsx("div",{className:"border-token-border-default mt-1 border-t pt-1",children:c.map(({label:o,amount:g})=>e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{children:o}),e.jsx(d,{amount:g})]},o))})]})},Z=I({creditsUsed:{id:"organizationBillingInfo.creditUsageSettings.creditsUsed",defaultMessage:"credits used ({percentage})"},historicalCreditsUsed:{id:"organizationBillingInfo.creditUsageSettings.historicalCreditsUsed",defaultMessage:"credits used"},otherBarLabel:{id:"organizationBillingInfo.creditUsageSettings.otherBarLabel",defaultMessage:"Other"},currentBalanceBarLabel:{id:"organizationBillingInfo.creditUsageSettings.currentBalanceBarLabel",defaultMessage:"Remaining credits"},overageLimitReachedWarning:{id:"organizationBillingInfo.creditUsageSettings.overageLimitReachedWarning",defaultMessage:"Limit reached"}});function Pt({cycle:a,mostRecentExportResult:s}){const t=D(),i=A(),[c,d]=y.useState(!1),r=!(i!=null&&i.id),o=async()=>{var g,p;if(!r){N.logEventWithStatsig("ChatGPT Credits: Download Usage Report Clicked","chatgpt_credits_download_usage_report_clicked",{workspaceId:i.id,workspaceName:i.name,startDate:a.start.toISOString(),endDate:a.end.toISOString()}),d(!0);try{const u=await z.safeGet("/subscriptions/{workspace_id}/usage/export",{parameters:{path:{workspace_id:i.id},query:{start_date:a.start.toISOString(),end_date:a.end.toISOString()}}});ut({data:(g=u.csv_content)!=null?g:"No results for the given date range",mimeType:"text/csv",filename:t.formatMessage(me.filename,{workspaceName:(p=i.name)!=null?p:"Workspace",startDate:ie(a.start,"MMM d"),endDate:ie(a.end,"MMM d")})}),N.logEventWithStatsig("ChatGPT Credits: Download Usage Report Complete","chatgpt_credits_download_usage_report_complete",{workspaceId:i.id,workspaceName:i.name})}finally{d(!1)}}};return e.jsx(U.Item,{onClick:o,disabled:r||c,secondary:s&&e.jsx(l,j(n({},me.buttonDescription),{values:{date:new Date(s)}})),label:e.jsx(l,n({},me.buttonText)),badge:c&&e.jsx(le,{}),icon:Ea})}const me=I({buttonText:{id:"organizationBillingInfo.creditUsageSettings.downloadUsageReportButton.buttonText",defaultMessage:"Download usage data"},buttonDescription:{id:"organizationBillingInfo.creditUsageSettings.downloadUsageReportButton.buttonDescription",defaultMessage:"Updated {date, date}"},filename:{id:"organizationBillingInfo.creditUsageSettings.downloadUsageReportButton.filename",defaultMessage:"{workspaceName} Credit Usage Report ({startDate} - {endDate}).csv"}});function ha({value:a,name:s,onChange:t,className:i,placeholder:c,onPressEnter:d}){var r;return e.jsx(da,{inputClassName:"pe-14",className:K(i),ariaLabel:!1,placeholder:c,type:"number",name:s,value:(r=a==null?void 0:a.toString())!=null?r:"",onChange:o=>{const g=o.target.valueAsNumber;t==null||t(Number.isNaN(g)?null:g)},onPressEnter:d,insideContainerChildren:e.jsx("div",{className:"absolute end-0 top-1/2 -translate-y-1/2",children:e.jsx(l,n({},zt.unitDisplay))})})}const zt=I({unitDisplay:{id:"organizationBillingInfo.creditUsageSettings.unitDisplay",defaultMessage:"credits"}});function Ut({onClose:a,recipients:s,onSaveRecipients:t,thresholds:i,onSaveThresholds:c,isEnterprisey:d}){const r=A(),[o,g]=y.useState(),p=async m=>{await t(m),N.logEventWithStatsig("ChatGPT Credits: Save Additional Alert Recipients","chatgpt_credits_save_additional_alert_recipients",{workspaceId:r==null?void 0:r.id,workspaceName:r==null?void 0:r.name,recipientCount:m.length}),g(m)},[u,x]=y.useState(),h=async m=>{const b=m.slice().sort((v,L)=>v.credits-L.credits);await c(b),x(b)};return e.jsx(Dt,{onClose:a,recipients:o!=null?o:s,onSaveRecipients:p,thresholds:u!=null?u:i,onSaveThresholds:h,isEnterprisey:d})}function Dt({onClose:a,recipients:s,onSaveRecipients:t,thresholds:i,onSaveThresholds:c,isEnterprisey:d}){var u;const r=D(),o=O(),g=A(),p=(u=g==null?void 0:g.isTeam())!=null?u:!1;return e.jsx(Me,{title:e.jsx(l,n({},_.baseTitle)),primaryButton:e.jsx(w,{className:"min-w-[80px]",onClick:()=>F(o,({onClose:x})=>e.jsx(ea,{onClose:x,editingThreshold:void 0,onSaveThreshold:h=>c([...i,h])})),children:e.jsx(l,n({},_.newAlertButton))}),secondaryButton:!p&&e.jsx(w,{color:"secondary",onClick:()=>F(o,({onClose:x})=>e.jsx(At,{onClose:x,initialRecipients:s,onSaveRecipients:t})),children:e.jsx(l,n({},_.editRecipientsButton))}),onClose:a,footerIsSpacedBetween:!0,children:e.jsxs("div",{className:"min-h-[250px]",children:[e.jsx("div",{className:"text-token-text-secondary mb-3 text-sm",children:e.jsx(l,n({},_.alertDescription))}),e.jsx(ue,{children:e.jsx(l,n({},_.allCreditsUsedThreshold))}),d&&e.jsx(ue,{children:e.jsx(l,n({},_.overageLimitReachedThreshold))}),i.map((x,h)=>e.jsxs(ue,{children:[e.jsx("span",{className:"w-0 grow",children:e.jsx(l,j(n({},_.alertThresholdDescription),{values:{thresholdString:Y.format(x.credits),threshold:x.credits}}))}),e.jsx(Qe,{label:r.formatMessage(_.alertThresholdDeleteButtonLabel),onClick:async()=>{const m=i.slice();m.splice(h,1),N.logEventWithStatsig("ChatGPT Credits: Remove Alert Threshold","chatgpt_credits_remove_alert_threshold",{workspaceId:g==null?void 0:g.id,workspaceName:g==null?void 0:g.name,threshold:x.credits}),await c(m)},icon:e.jsx(Pa,{})}),e.jsx(Qe,{label:r.formatMessage(_.alertThresholdEditButtonLabel),onClick:()=>F(o,({onClose:m})=>e.jsx(ea,{onClose:m,editingThreshold:i[h],onSaveThreshold:async b=>{const v=i.slice();v.splice(h,1),await c([...v,b])}})),icon:e.jsx(za,{})})]},h))]})})}function ue({children:a}){return e.jsxs("div",{className:"border-token-border-default flex h-[54px] flex-row items-center justify-start gap-2 border-b text-sm font-medium",children:[e.jsx(Ua,{className:"bg-token-bg-secondary rounded-lg p-1"}),e.jsx("div",{className:"flex grow flex-row items-center gap-1",children:a})]})}function At({onClose:a,initialRecipients:s,onSaveRecipients:t}){const[i,c]=y.useState(()=>s.map(p=>yt(p.value))),[d,r]=y.useState(!1),o=i.every(p=>p.isValid),g=async()=>{if(o)try{r(!0),await t(i.map(p=>({type:"email",value:p.value}))),a()}finally{r(!1)}};return e.jsxs(Me,{title:e.jsx(l,n({},_.recipientsTitle)),primaryButton:e.jsx(w,{loading:d,onClick:g,disabled:!o,className:"min-w-[80px]",children:e.jsx(l,n({},_.saveButton))}),secondaryButton:e.jsx(w,{color:"secondary",onClick:a,children:e.jsx(l,n({},_.backButton))}),onClose:a,children:[e.jsx(je,{type:"info",icon:e.jsx(ua,{className:"text-token-text-secondary icon-sm"}),content:e.jsx("div",{className:"text-token-text-secondary text-xs",children:e.jsx(l,n({},_.recipientsHelpText))})}),e.jsx(Se,{className:"mt-4 mb-2 block font-medium",htmlFor:"add-member-emails",id:"add-emails-label",children:e.jsx(l,n({},_.recipientsFieldLabel))}),e.jsx(bt,{value:i,onChange:c})]})}function ea({onClose:a,editingThreshold:s,onSaveThreshold:t}){var u;const i=A(),[c,d]=y.useState((u=s==null?void 0:s.credits)!=null?u:null),[r,o]=y.useState(!1),g=c!=null&&Number.isInteger(c),p=async()=>{if(g)try{o(!0),N.logEventWithStatsig("ChatGPT Credits: Add Alert Threshold","chatgpt_credits_add_alert_threshold",{workspaceId:i==null?void 0:i.id,workspaceName:i==null?void 0:i.name,threshold:c}),await t({type:"absolute",credits:c}),a()}finally{o(!1)}};return e.jsxs(Me,{title:e.jsx(l,n({},_.thresholdTitle)),primaryButton:e.jsx(w,{className:"min-w-[80px]",loading:r,disabled:!g,onClick:p,children:e.jsx(l,n({},_.saveButton))}),secondaryButton:e.jsx(w,{color:"secondary",onClick:a,children:e.jsx(l,n({},_.backButton))}),onClose:a,children:[e.jsx(Se,{htmlFor:"new-threshold-field",className:"mt-4 mb-2 block font-medium",children:e.jsx(l,n({},_.thresholdFieldLabel))}),e.jsx(ha,{value:c,name:"new-threshold-field",onChange:d,onPressEnter:p})]})}function Me({title:a,primaryButton:s,secondaryButton:t,children:i,onClose:c,footerIsSpacedBetween:d}){return e.jsx(fe,{testId:"modal-manage-alerts",isOpen:!0,onClose:c,type:"success",title:a,hideSeparator:!0,noPadding:!0,showCloseButton:!0,size:"large",footerClassName:"p-6 pt-0",primaryButton:s,secondaryButton:t,footerIsSpacedBetween:d,children:e.jsx("div",{className:"px-6 pb-6",children:i})})}const _=I({baseTitle:{id:"organizationBillingInfo.creditUsageSettings.manageAlertsModal.base.title",defaultMessage:"Manage alerts"},editRecipientsButton:{id:"organizationBillingInfo.creditUsageSettings.manageAlertsModal.base.editRecipientsButton",defaultMessage:"Edit recipients"},newAlertButton:{id:"organizationBillingInfo.creditUsageSettings.manageAlertsModal.base.newAlertButton",defaultMessage:"New alert"},alertDescription:{id:"organizationBillingInfo.creditUsageSettings.manageAlertsModal.base.alertDescription",defaultMessage:"Specify when you wish to receive email alerts. Alerts are sent to all workspace owners by default."},allCreditsUsedThreshold:{id:"organizationBillingInfo.creditUsageSettings.manageAlertsModal.base.allCreditsUsedThreshold",defaultMessage:"All credits used"},overageLimitReachedThreshold:{id:"organizationBillingInfo.creditUsageSettings.manageAlertsModal.base.overageLimitReachedThreshold",defaultMessage:"Overage limit reached"},alertThresholdDescription:{id:"organizationBillingInfo.creditUsageSettings.manageAlertsModal.base.alertThresholdDescription",defaultMessage:"{thresholdString} {threshold, plural, one {credit} other {credits}} remaining"},alertThresholdDeleteButtonLabel:{id:"organizationBillingInfo.creditUsageSettings.manageAlertsModal.base.alertThresholdDeleteButtonLabel",defaultMessage:"Delete"},alertThresholdEditButtonLabel:{id:"organizationBillingInfo.creditUsageSettings.manageAlertsModal.base.alertThresholdEditButtonLabel",defaultMessage:"Edit"},thresholdTitle:{id:"organizationBillingInfo.creditUsageSettings.manageAlertsModal.threshold.title",defaultMessage:"New usage alert"},thresholdFieldLabel:{id:"organizationBillingInfo.creditUsageSettings.manageAlertsModal.threshold.fieldLabel",defaultMessage:"Alert when credit balance hits"},saveButton:{id:"organizationBillingInfo.creditUsageSettings.manageAlertsModal.saveButton",defaultMessage:"Save"},backButton:{id:"organizationBillingInfo.creditUsageSettings.manageAlertsModal.backButton",defaultMessage:"Back"},recipientsTitle:{id:"organizationBillingInfo.creditUsageSettings.manageAlertsModal.recipients.title",defaultMessage:"Edit alert recipients"},recipientsHelpText:{id:"organizationBillingInfo.creditUsageSettings.manageAlertsModal.recipients.helpText",defaultMessage:"Email alerts are sent to workplace owners by default. Anyone can be added to receive alerts, but only owners can view or make changes on the billing page."},recipientsFieldLabel:{id:"organizationBillingInfo.creditUsageSettings.manageAlertsModal.recipients.fieldLabel",defaultMessage:"Also send alerts to:"}});function Ot({currentLimit:a,onClose:s,onSubmit:t,denominator:i}){const c=D(),[d,r]=y.useState(!1),[o,g]=y.useState(a),p=o!==a&&(o==null||Number.isInteger(o)&&o>=0),u=async()=>{if(p){r(!0);try{await t(o),s()}finally{r(!1)}}},x=(o!=null?o:0)+i;return e.jsx(fe,{testId:"modal-overage-limit",isOpen:!0,onClose:s,type:"success",title:e.jsx(l,n({},H.title)),hideSeparator:!0,noPadding:!0,showCloseButton:!0,size:"large",footerClassName:"p-6 pt-0",primaryButton:e.jsx(w,{className:"min-w-[80px]",loading:d,disabled:!p,onClick:u,children:e.jsx(l,n({},H.saveButton))}),secondaryButton:e.jsx(w,{onClick:()=>g(null),color:"secondary",disabled:o==null,children:e.jsx(l,n({},H.clearButton))}),children:e.jsxs("div",{className:"px-6 pb-6",children:[e.jsx("div",{className:"text-token-text-secondary text-sm",children:e.jsx(l,n({},fa))}),e.jsx(Se,{htmlFor:"overage-limit-field",className:"mt-4 mb-2 block font-medium",children:e.jsx(l,n({},H.fieldLabel))}),e.jsx(ha,{value:o,name:"overage-limit-field",onChange:g,onPressEnter:u,placeholder:c.formatMessage(H.emptyFieldPlaceholder)}),e.jsx("div",{className:K("text-token-text-secondary pt-1 text-xs",o==null&&"invisible"),children:e.jsx(l,j(n({},H.helpText),{values:{newTotalAllowed:x,newTotalAllowedString:Y.format(x)}}))})]})})}const H=I({title:{id:"organizationBillingInfo.creditUsageSettings.overageLimitModal.title",defaultMessage:"Add overage limit"},fieldLabel:{id:"organizationBillingInfo.creditUsageSettings.overageLimitModal.fieldLabel",defaultMessage:"Overage limit"},emptyFieldPlaceholder:{id:"organizationBillingInfo.creditUsageSettings.overageLimitModal.emptyFieldPlaceholder",defaultMessage:"None"},helpText:{id:"organizationBillingInfo.creditUsageSettings.overageLimitModal.helpText",defaultMessage:"Advanced access will pause if your org exceeds {newTotalAllowedString} {newTotalAllowed, plural, one {credit} other {credits}} spent."},saveButton:{id:"organizationBillingInfo.creditUsageSettings.overageLimitModal.saveButton",defaultMessage:"Save"},clearButton:{id:"organizationBillingInfo.creditUsageSettings.overageLimitModal.clearButton",defaultMessage:"Clear"}}),fa=ya({id:"organizationBillingInfo.creditUsageSettings.overageLimitDescription",defaultMessage:"Your org can continue to use advanced features and models beyond your plan. Add an overage limit to control this amount."}),Rt=ga(()=>ma(()=>import("./lz9e0y9lvu5e72oe.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(a=>a.CreditPurchaseModal)),aa="https://help.openai.com/en/articles/11487671 ",Ft="https://help.openai.com/en/articles/11481834-chatgpt-rate-card";function Wt(){var Be,_e,we,Ce,Ne,Ie,Le,Te,ke,Ee,Pe,ze,Ue,De,Ae;const a=O(),s=D(),t=A(),i=be(S=>S.currentWorkspace),c=i!=null?xe(i.role):void 0,d=["subscription-settings",t==null?void 0:t.organizationId],r=J({queryKey:d,queryFn:X(()=>z.safeGet("/subscriptions/{organization_id}/settings",{parameters:{path:{organization_id:t==null?void 0:t.organizationId}}})),enabled:(t==null?void 0:t.organizationId)!=null}),o=ba(),g=Ke({mutationFn:X(S=>z.safePost("/subscriptions/{organization_id}/settings/limit",{parameters:{path:{organization_id:t==null?void 0:t.organizationId}},requestBody:{overage_limit:S==null?S:{type:"absolute",credits:S}}})),onSuccess:()=>{o.invalidateQueries({queryKey:d}),o.invalidateQueries({queryKey:wa(t==null?void 0:t.organizationId)})}}),{mutateAsync:p}=Ke({mutationFn:X(({recipients:S,thresholds:W})=>z.safePost("/subscriptions/{organization_id}/settings/alerts",{parameters:{path:{organization_id:t==null?void 0:t.organizationId}},requestBody:{alert_recipients:S,alert_thresholds:W}})),onSuccess:()=>{o.invalidateQueries({queryKey:d})}}),[u,x]=y.useState(0),h=u===0,m=la(u),b=t!=null&&t.id!=null&&t.organizationId!=null&&m!=null&&m!=="pending",v=J({queryKey:["organization-usage",t==null?void 0:t.organizationId,m!=="pending"&&(m==null?void 0:m.start),m!=="pending"&&(m==null?void 0:m.end)],queryFn:X(()=>{if(!b)throw new Error("Query not enabled");return z.safeGet("/subscriptions/{organization_id}/usage",{parameters:{path:{organization_id:t.organizationId},query:{start_date:m.start.toISOString(),end_date:m.end.toISOString()}}})}),enabled:b}),L=J({queryKey:["usage-export-data-freshness",t==null?void 0:t.id],queryFn:X(()=>{if(!b)throw new Error("Query not enabled");return z.safeGet("/subscriptions/{workspace_id}/usage/export_data_freshness",{parameters:{path:{workspace_id:t.id}}})}),enabled:b}),M=na();if(y.useEffect(()=>{b&&N.logEventWithStatsig("ChatGPT Credits: Admin Section Shown","chatgpt_credits_admin_section_shown")},[b]),!b)return null;const B=r.isFetching||g.isPending?"loading":((Be=r.data)==null?void 0:Be.overage_limit)==null?"noLimit":"limitSet";let T=(we=(_e=v.data)==null?void 0:_e.current_balance)!=null?we:0;t!=null&&t.isTeam()&&(T=Math.max(T,0));const k=((Ne=(Ce=v.data)==null?void 0:Ce.total_usage)!=null?Ne:0)+T,E=h&&(t==null?void 0:t.isEnterprisey())&&!M&&((Ie=v.data)==null?void 0:Ie.current_balance)!=null&&v.data.current_balance<0;return e.jsxs(e.Fragment,{children:[E&&e.jsx(je,{title:e.jsx(l,n({},C.inOverageBannerTitle)),content:e.jsx(l,j(n({},C.inOverageBannerContent),{values:{link:S=>e.jsx(pa,{openNewTab:!0,href:aa,children:S},aa)}})),icon:e.jsx(ua,{}),type:"info"}),e.jsxs(ee,{className:"border-token-border-default gap-0 rounded-xl border p-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("div",{children:e.jsxs("div",{children:[e.jsx(te,{children:e.jsx(l,n({},C.creditUsageSectionTitle))}),e.jsx(se,{className:"text-token-text-secondary mt-1 text-xs",children:h?e.jsx(l,j(n({},C.daysLeft),{values:{days:tt(m.end,new Date)}})):e.jsx(l,j(n({},C.cycleDateSpan),{values:n({},m)}))})]})}),e.jsxs("div",{className:"-me-2 -mt-2 flex items-center",children:[e.jsxs(U.Root,{children:[e.jsx(U.Trigger,{className:"px-2",children:e.jsx(Da,{className:"icon-lg"})}),e.jsx(U.Portal,{children:e.jsxs(U.Content,{size:"small",align:"end",children:[((Te=(Le=v.data)==null?void 0:Le.total_usage)!=null?Te:0)>0&&e.jsx(Pt,{cycle:m,mostRecentExportResult:(ke=L.data)==null?void 0:ke.most_recent_result}),e.jsx(st,{icon:oa,to:Ft,target:"_blank",rel:"noopener noreferrer",onClick:()=>{N.logEventWithStatsig("ChatGPT Credits: Rate Card Link Clicked","chatgpt_credits_rate_card_link_clicked",{workspaceId:t.id,workspaceName:t.name})},children:e.jsx(l,n({},C.rateCardLink))})]})})]}),e.jsxs("div",{className:K("items-center",{flex:m.period==="monthly",hidden:m.period!=="monthly"}),children:[e.jsx("div",{className:"bg-token-border-heavy me-2 h-full w-px",children:" "}),e.jsx(w,{className:"px-2",color:"ghost",onClick:()=>{x(S=>S-1),N.logEventWithStatsig("ChatGPT Credits: Usage Time Travel","chatgpt_credits_usage_time_travel",{workspaceId:t.id,workspaceName:t.name,direction:"back",cycleIndex:u-1})},disabled:u<-11,icon:Aa}),e.jsx(w,{className:"px-2",color:"ghost",onClick:()=>{x(S=>S+1),N.logEventWithStatsig("ChatGPT Credits: Usage Time Travel","chatgpt_credits_usage_time_travel",{workspaceId:t.id,workspaceName:t.name,direction:"forward",cycleIndex:u+1})},disabled:h,icon:Oa})]})]})]}),e.jsx(Tt,{usageData:v,denominator:k,isCurrentCycle:h}),(t==null?void 0:t.isEnterprisey())&&e.jsxs("div",{className:"border-token-border-default mt-6 border-t pt-6 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex w-0 grow items-center gap-1",children:[e.jsx("span",{className:"font-medium",children:e.jsx(l,n({},C.overageLimitLabel))}),e.jsx(it,{className:"flex items-center",label:e.jsx("span",{className:"text-token-bg-primary font-normal",children:e.jsx(l,n({},fa))}),side:"top",customBackgroundColorClassName:"bg-token-main-surface-primary-inverse",children:e.jsx(Ra,{className:"icon-sm text-token-text-secondary inline"})})]}),B==="loading"&&e.jsx(le,{}),e.jsx(nt,{"aria-label":s.formatMessage(C.toggleOverageLimitLabel),checked:B==="limitSet",onCheckedChange:async S=>{N.logEventWithStatsig(S?"ChatGPT Credits: Overage Limit Set":"ChatGPT Credits: Overage Limit Cleared",S?"chatgpt_credits_overage_limit_set":"chatgpt_credits_overage_limit_cleared",{workspaceId:t.id,workspaceName:t.name}),await g.mutateAsync(S?0:null)}})]}),e.jsx("div",{className:K("transition-duration-300 overflow-hidden transition-[height] ease-in-out",B==="limitSet"?"h-[60px]":"h-0"),children:e.jsxs("div",{className:"flex items-center gap-2 pt-6",children:[e.jsx("div",{className:"w-0 grow",children:e.jsx(l,j(n({},C.setOverageLimitAmount),{values:{bold:S=>e.jsx("span",{className:"font-medium",children:S},"bolded-overage-limit-label"),credits:Y.format((ze=(Pe=(Ee=r.data)==null?void 0:Ee.overage_limit)==null?void 0:Pe.credits)!=null?ze:0),total:Y.format(((Ae=(De=(Ue=r.data)==null?void 0:Ue.overage_limit)==null?void 0:De.credits)!=null?Ae:0)+k)}}))}),e.jsx(w,{color:"secondary",className:"min-w-[80px]",disabled:B==="loading",onClick:()=>F(a,({onClose:S})=>{var W,Q,$;return e.jsx(Ot,{currentLimit:($=(Q=(W=r.data)==null?void 0:W.overage_limit)==null?void 0:Q.credits)!=null?$:null,onSubmit:async G=>{N.logEventWithStatsig(G==null?"ChatGPT Credits: Overage Limit Cleared":"ChatGPT Credits: Overage Limit Set",G==null?"chatgpt_credits_overage_limit_cleared":"chatgpt_credits_overage_limit_set",{workspaceId:t.id,workspaceName:t.name,newLimit:G}),await g.mutateAsync(G),S()},onClose:S,denominator:k})}),children:e.jsx(l,n({},C.setOverageLimitButton))})]})})]}),(t==null?void 0:t.isTeam())&&c&&e.jsx("div",{className:"border-token-border-default mt-6 flex items-center gap-2 border-t pt-6",children:e.jsxs("div",{className:"flex grow items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(te,{children:e.jsx(l,{id:"organizationBillingInfo.additionalCredits",defaultMessage:"Add more credits"})}),e.jsx(se,{className:"text-token-text-secondary mt-1",children:e.jsx(l,{id:"organizationBillingInfo.additionalCreditsDescription",defaultMessage:"Give your team continued access after they hit their plan limits. Credits are valid for 12 months."})})]}),e.jsx(w,{color:"secondary",onClick:()=>F(a,Rt),children:e.jsx(l,{id:"organizationBillingInfo.addCredits",defaultMessage:"Add credits"})})]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"w-0 grow",children:[e.jsx(te,{children:e.jsx(l,n({},C.usageAlertLabel))}),e.jsx(se,{className:"text-token-text-secondary mt-1",children:e.jsx(l,n({},C.usageAlertDescription))})]}),e.jsx(w,{color:"secondary",className:"min-w-[80px]",onClick:()=>F(a,({onClose:S})=>{var W,Q,$,G,Oe;return e.jsx(Ut,{onClose:S,onSaveRecipients:async re=>{await p({recipients:re})},onSaveThresholds:async re=>{await p({thresholds:re})},recipients:(Q=(W=r.data)==null?void 0:W.alert_recipients)!=null?Q:[],thresholds:(G=($=r.data)==null?void 0:$.alert_thresholds)!=null?G:[],isEnterprisey:(Oe=t==null?void 0:t.isEnterprisey())!=null?Oe:!1})}),children:e.jsx(l,n({},C.usageAlertButton))})]})]})}const C=I({creditUsageSectionTitle:{id:"organizationBillingInfo.creditUsageSettings.creditUsageSectionTitle",defaultMessage:"Credit usage"},rateCardLink:{id:"organizationBillingInfo.creditUsageSettings.rateCardLink",defaultMessage:"View rate card"},daysLeft:{id:"organizationBillingInfo.creditUsageSettings.daysLeft",defaultMessage:"Next cycle in {days} {days, plural, one {day} other {days}}"},cycleDateSpan:{id:"organizationBillingInfo.creditUsageSettings.cycleDateSpan",defaultMessage:"{start, date, ::MMMdd} - {end, date, ::MMMdd}"},inOverageBannerTitle:{id:"organizationBillingInfo.creditUsageSettings.inOverageBannerTitle",defaultMessage:"Your org is using credits beyond your plan"},inOverageBannerContent:{id:"organizationBillingInfo.creditUsageSettings.inOverageBannerContent",defaultMessage:"Access to advanced features and models is still available. You’ll receive a separate invoice at the end of the month. <link>Learn more</link>"},overageLimitLabel:{id:"organizationBillingInfo.creditUsageSettings.overageLimitLabel",defaultMessage:"Set overage limit"},toggleOverageLimitLabel:{id:"organizationBillingInfo.creditUsageSettings.toggleOverageLimitLabel",defaultMessage:"Toggle overage limit"},setOverageLimitAmount:{id:"organizationBillingInfo.creditUsageSettings.setOverageLimitAmount",defaultMessage:"<bold>Overage limit:</bold> {credits} credits ({total} total)"},setOverageLimitButton:{id:"organizationBillingInfo.creditUsageSettings.setOverageLimitButton",defaultMessage:"Configure"},usageAlertLabel:{id:"organizationBillingInfo.creditUsageSettings.usageAlertLabel",defaultMessage:"Credit usage alerts"},usageAlertDescription:{id:"organizationBillingInfo.creditUsageSettings.usageAlertDescription",defaultMessage:"Send alerts to owners when credits are running low"},usageAlertButton:{id:"organizationBillingInfo.creditUsageSettings.usageAlertButton",defaultMessage:"Manage"}}),Gt=({params:a={},options:s,onError:t})=>ia({queryKey:["organization-invoices",j(n({},a),{options:s})],queryFn:async()=>await z.safeGet("/invoices",{parameters:{query:n({starting_after:s.startingAfter,ending_before:s.endingBefore,limit:s.limit},a)}}).catch(i=>{throw t==null||t(i),i}),enabled:"account_id"in a||"organization_id"in a});function qt(a){"use forget";var x;const s=Sa.c(13),t=A(),i=t==null?void 0:t.id,c=(x=t==null?void 0:t.data.organizationId)!=null?x:void 0;let d;s[0]!==t?(d=t==null?void 0:t.isEnterprisey(),s[0]=t,s[1]=d):d=s[1];const r=d,o=D(),g=he();let p,u;if(s[2]!==i||s[3]!==o||s[4]!==a||s[5]!==c||s[6]!==r||s[7]!==g){const h=r?{organization_id:c}:{account_id:i};let m;s[10]!==o||s[11]!==g?(m=v=>{g.danger(o.formatMessage(ta.invoicesLoadError,{error:v.message}),{toastId:"invoices",loggingTitle:ta.invoicesLoadError.defaultMessage,loggingDescription:"Failed to load invoices"})},s[10]=o,s[11]=g,s[12]=m):m=s[12];const b=m;p=J,u=Gt({params:h,options:a,onError:b}),s[2]=i,s[3]=o,s[4]=a,s[5]=c,s[6]=r,s[7]=g,s[8]=p,s[9]=u}else p=s[8],u=s[9];return p(u)}const ta=I({invoicesLoadError:{id:"organizationBillingInfo.invoicesLoadError.0",defaultMessage:"Failed to load invoices. Contact support@openai.com if error persists."}}),Yt="https://help.openai.com/en/articles/8792536-manage-billing-on-the-chatgpt-team-subscription-plan",Ht=(a,s)=>{const t=a==null?void 0:a.isEdu(),i=a==null?void 0:a.isTeam(),c=a==null?void 0:a.isEnterprisey(),d=a==null?void 0:a.isResellerHosted(),r=s==null?void 0:s.non_profit_org_discount_applied,o=s.active_until!=null;if(t)return o?f.activeEduLicense:d?f.resellerHostedEduLicense:f.pendingEduLicense;if(c)return o?f.activeEnterpriseLicense:d?f.resellerHostedEnterpriseLicense:f.pendingEnterpriseLicense;if(r)return o?f.activeTeamLicenseNonProfitOrg:f.pendingTeamLicense;if(i)return o?f.activeTeamLicense:f.pendingTeamLicense;throw ca.addError("getWorkspaceLicenseSubtitle: No license found",{subscription:s,currentAccount:a}),new Error("No license for workspace account.")};function Kt(){const{data:a,isLoading:s,isError:t}=ne(),i=A(),c=be(E=>E.currentWorkspace),d=c!=null?xe(c.role):void 0,r=O(),o=ve(r,"2861925050"),{shouldShowFreeSeatsCta:g,seatThresholdGap:p}=xa({seatsEntitled:a==null?void 0:a.seats_entitled}),u=g;if(s)return e.jsx("div",{className:"flex min-h-screen items-center justify-center",children:e.jsx(le,{})});if(t||!a||!i)return null;const x=a.active_until!=null,h=(a==null?void 0:a.seats_in_use)>(a==null?void 0:a.seats_entitled),m=a.active_until?new Date(a.active_until):null,b=Ht(i,a),v=i==null?void 0:i.isTeam(),L=(a==null?void 0:a.billing_period)==="monthly"?R.FLEXIBLE:R.ANNUAL,M=Wa(a.billing_currency),{discountedMonthlyCost:B,currencySign:T}=L===R.FLEXIBLE?M.flexibleBillingPlan:M.annualBillingPlan,k=e.jsxs(ee,{className:"border-token-border-default bg-token-bg-primary gap-0 rounded-xl border",children:[e.jsxs("div",{className:"z-10 flex flex-col gap-4 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(l,n({},b)),v&&e.jsx("div",{className:"rounded-sm bg-[#E0FFE7] px-1.5 py-1 text-sm font-medium text-[#24622B]",children:e.jsx(l,n({},L===R.FLEXIBLE?f.monthly:f.annual))})]}),m&&e.jsx(se,{className:"text-token-text-secondary mt-1",children:i!=null&&i.isEnterprisey()?e.jsx(l,j(n({},f.licenseExpiry),{values:{expiryDate:m}})):a.will_renew?e.jsx(l,j(n({},f.renewalDate),{values:{expiryDate:m}})):e.jsx(l,j(n({},f.deactivateDate),{values:{expiryDate:m}}))})]}),d&&e.jsx(Qt,{})]}),v&&!(a!=null&&a.non_profit_org_discount_applied)&&e.jsx("div",{className:"text-token-text-secondary h-[50px] text-sm",children:e.jsx(l,j(n({},f.pricePerSeat),{values:{symbol:e.jsx(l,n({},T)),amount:B,currency:E=>e.jsx("span",{className:"align-top text-xl",children:E}),price:E=>e.jsx("span",{className:"text-token-text-primary ps-[1px] pe-1 align-bottom text-[42px] leading-none",children:E})}}))})]}),e.jsx("hr",{}),x&&e.jsxs("div",{className:"p-6",children:[e.jsx(Xt,{isTeam:v,accountId:i.id}),v&&h&&e.jsx("span",{className:"text-token-text-secondary text-sm",children:e.jsx(l,j(n({},f.teamsAutochargeMessage),{values:{link:E=>e.jsx(pa,{className:"ps-1",openNewTab:!0,href:Yt,children:E})}}))})]})]});return e.jsxs(e.Fragment,{children:[o&&v&&e.jsx(It,{}),u?e.jsxs("div",{className:"rounded-xl bg-[#ECF0FF]",children:[e.jsx(Jt,{seatThresholdGap:p}),k]}):k,o&&e.jsx(Wt,{})]})}function Qt(){const[a,s]=y.useState(!1),t=D(),i=he(),c=A(),{data:d}=ne(),[r,o]=y.useState(!1),g=function(){o(!r)},[p,u]=y.useState(!1),x=O(),h=ve(x,"1318146997");if(!c||!c.isTeam()||!d)return;const m=async()=>{s(!0);try{const v=await z.safeGet("/payments/customer_portal",{parameters:{query:{account_id:c.getWorkspaceId()}},intercomEventOnError:"fetch-error:customer_portal:get"});location.href=v.url}catch(v){i.warning(t.formatMessage(f.stripeErrorWarning),{hasCloseButton:!0})}finally{s(!1)}},b=(d==null?void 0:d.billing_period)==="monthly"?R.FLEXIBLE:R.ANNUAL;return e.jsxs(e.Fragment,{children:[e.jsxs(rt,{size:"default",contentAlign:"end",sideOffset:4,triggerButton:e.jsx(w,{color:"secondary",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(l,n({},f.manageLicenseBtn)),e.jsx($a,{className:"icon-sm"})]})}),children:[e.jsx(U.Item,{icon:Ha,onClick:m,children:e.jsx(l,n({},f.managePaymentMethod))}),d.will_renew&&h&&e.jsx(U.Item,{icon:Ka,onClick:()=>u(!0),children:e.jsx(l,n({},f.manageBillingSchedule))}),(d==null?void 0:d.will_renew)&&e.jsx(U.Separator,{}),(d==null?void 0:d.will_renew)&&e.jsx(U.Item,{icon:Qa,color:"danger",onClick:()=>{g()},children:e.jsx(l,n({},f.cancelSubscriptionBtn))})]}),d.active_until!=null&&e.jsx(Va,{isOpen:p,onClose:()=>u(!1),initialTeamBillingType:b,renewalDate:new Date(d.active_until),accountId:c.id,billingDetails:{currency:d.billing_currency}}),e.jsx(Mt,{isOpen:r,onClose:g})]})}function $t({invoice:a}){const s=(a==null?void 0:a.status_transitions.paid_at)!=null&&new Date(a.status_transitions.paid_at*1e3),t=a&&new Date(a.due_date*1e3),i=a&&new Date(a.created*1e3);return e.jsxs(Za,{className:"items-center",children:[e.jsxs("div",{className:"flex grow flex-col gap-1",children:[e.jsx("span",{children:i?e.jsx(l,j(n({},f.invoiceName),{values:{createdDate:i}})):e.jsx(l,n({},f.defaultInvoiceName))}),a!=null&&a.paid&&s!=null?e.jsx("div",{className:"text-token-text-secondary text-xs",children:e.jsx(l,j(n({},f.paidInvoice),{values:{invoiceDate:s}}))}):a&&e.jsx("div",{className:"text-xs text-green-600",children:e.jsx(l,j(n({},f.upcomingInvoice),{values:{invoiceDate:t}}))})]}),e.jsx("a",{href:a==null?void 0:a.hosted_invoice_url,className:K("mx-auto",(a==null?void 0:a.hosted_invoice_url)===void 0&&"cursor-not-allowed opacity-20"),target:"_blank",rel:"noreferrer",children:e.jsx(oa,{className:"icon-sm text-green-600"})})]})}function Vt(){Ia();const[a,s]=y.useState({limit:5}),{data:t,isError:i,isLoading:c}=qt(a),d=a.startingAfter!=null||a.endingBefore!=null&&(t==null?void 0:t.has_more),r=a.endingBefore!=null||(t==null?void 0:t.has_more)&&a.endingBefore==null;return c?e.jsx(ee,{children:e.jsx("div",{className:"flex h-40 items-center justify-center",children:e.jsx(le,{})})}):i||t==null?e.jsx(ee,{children:e.jsx(Ga,{children:e.jsx(l,n({},f.noInvoices))})}):e.jsxs(ee,{children:[e.jsx(qa,{children:t.data.map(o=>e.jsx($t,{invoice:o},o.id))}),e.jsxs("div",{className:"flex",children:[d&&e.jsx("button",{onClick:()=>{t&&s(o=>j(n({},o),{endingBefore:t.data[0].id,startingAfter:void 0}))},children:e.jsx(Ya,{className:"icon-sm"})}),e.jsx("div",{className:"grow"}),r&&e.jsx("button",{onClick:()=>{t&&s(o=>j(n({},o),{startingAfter:t.data[t.data.length-1].id,endingBefore:void 0}))},children:e.jsx(lt,{className:"icon-sm"})})]})]})}function Xt({isTeam:a,accountId:s}){const{data:t,isLoading:i,isError:c}=ne();return c||!t||i||!t.billing_period||!t.active_until?null:e.jsx(Bt,{numInUse:t.seats_in_use,numAllocated:t.seats_entitled,isTeam:a,subscriptionWillRenew:t.will_renew,subscriptionBillingPeriod:t.billing_period,subscriptionRenewalDate:new Date(t.active_until),accountId:s,billingDetails:{currency:t.billing_currency}})}const Zt=a=>a==="plan"||a==="invoices";function Jt({seatThresholdGap:a}){const s=O();return y.useEffect(()=>{a!=null&&pe(s,"chatgpt_business_seats_promo_banner_shown",void 0,{seat_threshold_gap:a.toString()})},[s,a]),e.jsx("div",{className:"flex flex-wrap items-center justify-between gap-3 px-6 py-4 text-[#3855EA]",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xa,{}),e.jsx("span",{className:"text-sm font-medium",children:e.jsx(l,j(n({},f.limitedTimeOfferBody),{values:{seatThresholdGap:a,discountPercent:ra}}))})]})})}function es(){const a=be(m=>m.currentWorkspace),s=D(),t=Ma(),i=la(),c=a!=null?xe(a.role):void 0,d=y.useMemo(()=>[{key:"plan",label:s.formatMessage(f.planTabName),children:e.jsx($e,{children:e.jsx(Kt,{})})},{key:"invoices",label:s.formatMessage(f.invoicesTabName),children:e.jsx($e,{children:e.jsx(Vt,{})})}],[s]),[r]=Ba(),o=r.get("tab"),[g,p]=y.useState(o&&Zt(o)?o:d[0].key),u=m=>{p(m),t({pathname:window.location.pathname,search:new URLSearchParams({tab:m}).toString()})};if(!(a!=null&&a.organizationId))return null;const h=i!=null&&i!=="pending"&&i.start.getFullYear()!==i.end.getFullYear()?"MMM d, y":"MMM d";return e.jsxs(e.Fragment,{children:[e.jsx(Fa,{children:e.jsx("title",{children:s.formatMessage(f.adminBrowserPageTitle)})}),e.jsx(Ca,{title:s.formatMessage(f.title),subtitle:i&&(i==="pending"?e.jsx("div",{className:"loading-results-shimmer h-[24px] w-[300px] rounded-sm"}):e.jsx(l,j(n({},f.subtitle),{values:{start:ie(i.start,h),end:ie(i.end,h)}}))),tabsHeader:c&&e.jsx(ct,{items:d,activeTab:g,onTabChange:u})}),e.jsx(Na,{children:e.jsx(gt,{items:d,activeTab:g})})]})}const f=I({adminBrowserPageTitle:{id:"organizationBillingInfo.adminBrowserPageTitle",defaultMessage:"ChatGPT - Admin | Billing"},title:{id:"organizationBillingInfo.title.1",defaultMessage:"Billing"},limitedTimeOfferBody:{id:"organizationBillingInfo.limitedTimeOfferBody",defaultMessage:"Limited time offer: Purchase {seatThresholdGap} seats to get {discountPercent}% off your plan for one month."},subtitle:{id:"organizationBillingInfo.subtitle",defaultMessage:"Current cycle: {start} - {end}"},activeEnterpriseLicense:{id:"organizationBillingInfo.activeEnterpriseLicense",defaultMessage:"Enterprise License"},pendingEnterpriseLicense:{id:"organizationBillingInfo.pendingEnterpriseLicense",defaultMessage:"Enterprise License (pending activation)"},resellerHostedEnterpriseLicense:{id:"organizationBillingInfo.resellerHostedEnterpriseLicense",defaultMessage:"Enterprise License"},activeEduLicense:{id:"organizationBillingInfo.activeEduLicense",defaultMessage:"Edu License"},pendingEduLicense:{id:"organizationBillingInfo.pendingEduLicense",defaultMessage:"Edu License (pending activation)"},resellerHostedEduLicense:{id:"organizationBillingInfo.resellerHostedEduLicense",defaultMessage:"Edu License"},activeTeamLicense:{id:"organizationBillingInfo.activeTeamLicense",defaultMessage:"Business Plan"},activeTeamLicenseNonProfitOrg:{id:"organizationBillingInfo.activeTeamLicenseNonProfitOrg",defaultMessage:"Business License (Non Profit Discount)"},pendingTeamLicense:{id:"organizationBillingInfo.pendingTeamLicense",defaultMessage:"Business Plan (pending activation)"},licenseExpiry:{id:"organizationBillingInfo.licenseExpiry",defaultMessage:"Active until {expiryDate, date, long}"},renewalDate:{id:"organizationBillingInfo.renewalDate",defaultMessage:"Renews on {expiryDate, date, long}"},deactivateDate:{id:"organizationBillingInfo.deactivateDate",defaultMessage:"Deactivates on {expiryDate, date, long}"},invoiceName:{id:"organizationBillingInfo.invoiceName",defaultMessage:"Invoice: {createdDate, date, long}"},defaultInvoiceName:{id:"organizationBillingInfo.defaultInvoiceName",defaultMessage:"Invoice"},paidInvoice:{id:"organizationBillingInfo.paidInvoice",defaultMessage:"Paid: {invoiceDate, date, long}"},upcomingInvoice:{id:"organizationBillingInfo.upcomingInvoice",defaultMessage:"Due: {invoiceDate, date, long}"},noInvoices:{id:"organizationBillingInfo.noInvoices",defaultMessage:"No invoices found"},manageSubscription:{id:"organizationBillingInfo.manageSubscription",defaultMessage:"Manage subscription"},cancelSubscriptionBtn:{id:"organizationBillingInfo.cancelSubscriptionBtn",defaultMessage:"Cancel subscription"},manageLicenseBtn:{id:"organizationBillingInfo.manageLicenseBtn",defaultMessage:"Manage plan"},managePaymentMethod:{id:"organizationBillingInfo.managePaymentMethod",defaultMessage:"Payment method"},manageBillingSchedule:{id:"organizationBillingInfo.manageSchedule",defaultMessage:"Billing schedule"},stripeErrorWarning:{id:"organizationBillingInfo.stripeErrorWarning",defaultMessage:"Error loading account information"},teamsAutochargeMessage:{id:"organizationBillingInfo.teamsAutochargeMessage",defaultMessage:"Your additional seats will be included on your next invoice. <link>Learn more</link>"},planTabName:{id:"organizationBillingInfo.planTabName",defaultMessage:"Plan"},invoicesTabName:{id:"organizationBillingInfo.invoicesTabName",defaultMessage:"Invoices"},pricePerSeat:{id:"organizationBillingInfo.pricePerSeat",defaultMessage:"<currency>{symbol}</currency><price>{amount}</price>/seat"},monthly:{id:"organizationBillingInfo.monthly",defaultMessage:"Monthly"},annual:{id:"organizationBillingInfo.annual",defaultMessage:"Annual"}}),Hs=_a(function(){return La(),e.jsx(es,{})});export{Hs as default};
//# sourceMappingURL=i268j5lltbmhf1p2.js.map
