const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/d488vdccsjfd5637.js","assets/jj85rqzpbnvv3emr.js","assets/lef5ym39glv4981l.js","assets/root-ogjlcpyy.css","assets/lj9gcg948eq0zvwr.js","assets/fzrn137102spawew.js","assets/c631j8z7keqfibnl.js","assets/mclphevd122040jw.js","assets/conversation-small-g7l5datj.css"])))=>i.map(i=>d[i]);
var Q=Object.freeze,ee=Object.defineProperty,he=Object.defineProperties;var je=Object.getOwnPropertyDescriptors;var Y=Object.getOwnPropertySymbols;var ve=Object.prototype.hasOwnProperty,ge=Object.prototype.propertyIsEnumerable;var Z=(e,s,n)=>s in e?ee(e,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[s]=n,te=(e,s)=>{for(var n in s||(s={}))ve.call(s,n)&&Z(e,n,s[n]);if(Y)for(var n of Y(s))ge.call(s,n)&&Z(e,n,s[n]);return e},se=(e,s)=>he(e,je(s));var ne=(e,s)=>Q(ee(e,"raw",{value:Q(s||e.slice())}));import{C as be,f3 as _e,f4 as we,f5 as N,B as ye,J as Oe,na as C,e as V,ex as Ne,F as Ce,f as Pe,ey as Se}from"./lef5ym39glv4981l.js";import{R as h,j as t,r as j}from"./jj85rqzpbnvv3emr.js";import{dK as ke,md as ze,a4 as Ee,me as Me}from"./mclphevd122040jw.js";import{u as Ve,D as De}from"./nq8af3mzj5556837.js";import{u as Re,U as Fe,a as re}from"./e35egaqnsei5a2mf.js";import{s as Te}from"./lj9gcg948eq0zvwr.js";import"./f3wj76d1ulqyss85.js";import"./pa27hmbnxjn1cx3w.js";import"./f3nj9t0jhu8fhvoh.js";import"./oewf3dcf71lssqyb.js";import"./byc485nmh825ib1a.js";var fe={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},le=h.createContext&&h.createContext(fe),Ae=["attr","size","title"];function Le(e,s){if(e==null)return{};var n=$e(e,s),r,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],!(s.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function $e(e,s){if(e==null)return{};var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(s.indexOf(r)>=0)continue;n[r]=e[r]}return n}function P(){return P=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var n=arguments[s];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},P.apply(this,arguments)}function ae(e,s){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);s&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function S(e){for(var s=1;s<arguments.length;s++){var n=arguments[s]!=null?arguments[s]:{};s%2?ae(Object(n),!0).forEach(function(r){He(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ae(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function He(e,s,n){return s=Be(s),s in e?Object.defineProperty(e,s,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[s]=n,e}function Be(e){var s=Je(e,"string");return typeof s=="symbol"?s:s+""}function Je(e,s){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,s);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(e)}function pe(e){return e&&e.map((s,n)=>h.createElement(s.tag,S({key:n},s.attr),pe(s.child)))}function xe(e){return s=>h.createElement(Ie,P({attr:S({},e.attr)},s),pe(e.child))}function Ie(e){var s=n=>{var{attr:r,size:a,title:o}=e,f=Le(e,Ae),i=a||n.size||"1em",c;return n.className&&(c=n.className),e.className&&(c=(c?c+" ":"")+e.className),h.createElement("svg",P({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},n.attr,r,f,{className:c,style:S(S({color:e.color||n.color},n.style),e.style),height:i,width:i,xmlns:"http://www.w3.org/2000/svg"}),o&&h.createElement("title",null,o),e.children)};return le!==void 0?h.createElement(le.Consumer,null,n=>s(n)):s(fe)}function E(e){return xe({attr:{viewBox:"0 0 16 16",fill:"currentColor"},child:[{tag:"path",attr:{d:"M9 9H4v1h5V9z"},child:[]},{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M5 3l1-1h7l1 1v7l-1 1h-2v2l-1 1H3l-1-1V6l1-1h2V3zm1 2h4l1 1v4h2V3H6v2zm4 1H3v7h7V6z"},child:[]}]})(e)}function M(e){return xe({attr:{viewBox:"0 0 16 16",fill:"currentColor"},child:[{tag:"path",attr:{d:"M9 9H4v1h5V9z"},child:[]},{tag:"path",attr:{d:"M7 12V7H6v5h1z"},child:[]},{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M5 3l1-1h7l1 1v7l-1 1h-2v2l-1 1H3l-1-1V6l1-1h2V3zm1 2h4l1 1v4h2V3H6v2zm4 1H3v7h7V6z"},child:[]}]})(e)}const Ke=Ne(()=>Se(()=>import("./d488vdccsjfd5637.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(e=>e.JsonViewer));function it({threadId:e,threadUserId:s}){return Re(Fe.isDebugModalOpen)&&t.jsx(be,{testId:"modal-sonic-debug",isOpen:!0,onClose:()=>re.toggleDebugModalOpen(),type:"success",size:"fullscreen",noPadding:!0,rootClassName:"z-50",children:t.jsx(Xe,{threadId:e,threadUserId:s!=null?s:void 0,onClose:()=>re.toggleDebugModalOpen()})})}const Ue=(e,s)=>{const n=JSON.stringify(s,null,2),r=new Blob([n],{type:"application/json"}),a=window.URL.createObjectURL(r),o=document.createElement("a");o.href=a,o.download=e,o.click(),window.URL.revokeObjectURL(a)},oe="<|im_start|>",ie="<|im_sep|>",ce="<|im_end|>",We="<|fim_suffix|>",Ge="<|meta_sep|>";function de({prompt:e}){const[s,n]=j.useState({}),r=[],a=[];let o=0;for(;;){const i=e.indexOf(oe,o);if(i===-1)break;const c=e.indexOf(ie,i);if(c===-1)break;let l=e.indexOf(ce,c);const m=e.indexOf(We,c);if(m!==-1&&(l===-1||m<l)&&(l=m),l===-1)break;const d=e.substring(i+oe.length,c).replace(Ge," channel="),v=e.substring(c+ie.length,l);a.push(i);const O=s[i];r.push(t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("button",{onClick:()=>n(g=>se(te({},g),{[i]:!g[i]})),children:O?t.jsx(M,{size:14}):t.jsx(E,{size:14})}),t.jsxs("span",{className:"font-semibold",children:["[",d,"]"]})]}),t.jsx("div",{className:V("whitespace-pre-wrap",O&&"line-clamp-2 truncate"),children:v})]},i)),o=l+ce.length}function f(i){const c={};for(const l of a)c[l]=i;n(c)}return t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"absolute end-0 top-0 flex items-center gap-2 text-xs font-semibold",children:[t.jsxs("button",{className:"flex items-center gap-1 underline",onClick:()=>f(!0),children:[t.jsx(E,{size:14})," Collapse All"]}),"/",t.jsxs("button",{className:"flex items-center gap-1 underline",onClick:()=>f(!1),children:[t.jsx(M,{size:14})," Expand All"]})]}),t.jsx("div",{className:"flex flex-col gap-3",children:r})]})}var ue;const y=Ce.div(ue||(ue=ne(["mb-[-5px] pb-0.5 font-semibold uppercase border-b-2 ",""])),({$isSelected:e})=>e?"border-black dark:border-white":"border-transparent");function Xe({threadId:e,threadUserId:s,message:n,onClose:r}){var R,F,T,A,L,$,H,B,J,I,K;const[a,o]=j.useState(n?"message":"json"),{data:f,isLoading:i,refetch:c}=Ve({threadId:e,threadUserId:s,refetchOnMount:"always"}),l=f==null?void 0:f.thread;if(j.useEffect(()=>{o(n?"message":l!=null&&l.turns.length?"turn".concat((l==null?void 0:l.turns.length)-1):"thread")},[l==null?void 0:l.turns.length,n]),!i&&!l&&!n)return t.jsxs(De,{onClickRetry:()=>c(),children:["Failed to load."," "]});if(i)return t.jsx("div",{className:"flex h-full w-full items-center justify-center",children:"Loading..."});const m=l==null?void 0:l.turns,d=l==null?void 0:l.turns[l.turns.length-1],v=(F=(R=d==null?void 0:d.artifacts__)==null?void 0:R.model_snapshots)==null?void 0:F.default_id,O=($=(L=(A=(T=d==null?void 0:d.artifacts__)==null?void 0:T.settings)==null?void 0:A.model_response)==null?void 0:L.completion_model)==null?void 0:$.model,g=v!=null?v:O,k=(H=d==null?void 0:d.artifacts__)==null?void 0:H.eval_preset,D=s&&e?ze(s,e):null,b=(I=(J=(B=n==null?void 0:n.metadata)==null?void 0:B.__internal)==null?void 0:J.debug)==null?void 0:I.render_for_completion_result_decoded;return t.jsx("div",{className:"flex flex-col gap-2 font-mono text-xs break-words",children:t.jsxs(_e,{orientation:"vertical",value:a,onValueChange:p=>o(p),children:[t.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[t.jsxs(we,{className:"flex items-center justify-start gap-3 p-2",children:[n&&t.jsx(N,{value:"message",children:t.jsx(y,{$isSelected:a==="message",children:"Message"})},"message"),b&&t.jsx(N,{value:"render_for_completion",children:t.jsx(y,{$isSelected:a==="render_for_completion",children:"Prompt"})},"render_for_completion"),l&&t.jsx(N,{value:"thread",children:t.jsx(y,{$isSelected:a==="thread",children:"Thread"})},"thread"),m==null?void 0:m.map((p,u)=>{var x,_;return t.jsxs(j.Fragment,{children:[t.jsx(N,{value:"turn".concat(u),children:t.jsxs(y,{$isSelected:a==="turn".concat(u),children:["Turn[",u,"]"]})},u),(_=(x=p.artifacts__)==null?void 0:x.debug_ddtrace_urls)==null?void 0:_.map(w=>t.jsx(y,{$isSelected:!1,children:t.jsxs("a",{target:"_blank",href:w,className:"text-nowrap",rel:"noreferrer",children:["Trace[",u,"] â†—"]})},w))]},u)})]}),t.jsxs("div",{className:"flex items-center justify-end",children:[l&&t.jsxs(ye,{size:"small",color:"secondary",onClick:()=>Ue("thread.json",l),children:[t.jsx(ke,{className:"icon-sm"})," thread.json"]}),t.jsx(Oe,{onClick:r})]})]}),t.jsxs("div",{className:"flex items-center gap-2 px-2",children:[g&&t.jsxs(t.Fragment,{children:[t.jsx(z,{name:"Model",id:g,className:"shrink-0"})," ",t.jsx("span",{className:"text-gray-500 dark:text-white",children:"|"})]}),k&&k!=="production"&&t.jsxs(t.Fragment,{children:[t.jsx(z,{name:"Eval Preset",id:k,className:"shrink-0"}),t.jsx("span",{className:"text-gray-500 dark:text-white",children:"|"})]}),D&&t.jsx(t.Fragment,{children:t.jsx(z,{name:"Permalink",id:D,className:"flex-shrink-1"})})]}),m==null?void 0:m.map((p,u)=>{var _,w,U,W,G,X,q;const x=(_=p.model_response)==null?void 0:_.text;return t.jsxs(C,{value:"turn".concat(u),className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth",children:[t.jsxs("div",{className:V("flex flex-col gap-2 p-2",((w=p.index)!=null?w:0)%2===1&&"bg-token-main-surface-secondary"),children:[t.jsx(de,{prompt:(X=(G=(W=(U=p.artifacts__)==null?void 0:U.debug_info)==null?void 0:W.main_model_response)==null?void 0:G.prompt_string)!=null?X:""}),t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold",children:"[assistant]"}),t.jsx("div",{"data-testid":"assistant-response",className:"whitespace-pre-wrap",children:(q=Te(x!=null?x:""))!=null?q:x})]})]})," "]},u)}),l&&t.jsx(C,{value:"thread",className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth p-2",children:t.jsx(me,{data:l,collapsed:4,jsonFiltersKey:"thread"})}),n&&t.jsx(C,{value:"message",className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth p-2",children:t.jsx(me,{data:n,collapsed:4,jsonFiltersKey:"message"})}),b&&t.jsx(C,{value:"render_for_completion",className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth p-2",children:t.jsx(de,{prompt:b!=null?b:""})})]},(K=l==null?void 0:l.turns.length)!=null?K:"message")})}function me({data:e,collapsed:s,jsonFiltersKey:n}){const[r,a]=j.useState(s!=null?s:!0);return t.jsxs("div",{className:"flex flex-col items-start gap-1",children:[t.jsx("button",{onClick:()=>a(!r),className:"flex items-center gap-1",children:r?t.jsxs(t.Fragment,{children:[t.jsx(M,{size:14})," Expand all"]}):t.jsxs(t.Fragment,{children:[t.jsx(E,{size:14})," Collapse all"]})}),t.jsx("div",{className:"w-full",children:t.jsx(Ke,{jsonFiltersKey:n,json:e,jsonViewProps:{collapsed:r,shortenTextAfterLength:0}},String(r))})]})}function z({name:e,id:s,className:n}){const r=Pe(),a=j.useCallback(o=>{Ee(s,r,o)},[s,r]);return t.jsxs("div",{className:V("flex items-center gap-2 truncate",n),children:[t.jsxs("span",{className:"font-semibold text-nowrap",children:[e,":"]}),t.jsx("span",{title:s,className:"truncate text-gray-500 dark:text-white",children:s}),t.jsx(Me,{onCopy:a})]})}export{me as DebugJsonViewer,it as DebugModal,Xe as DebugModalContents};
//# sourceMappingURL=eefutgq650btdx3s.js.map
