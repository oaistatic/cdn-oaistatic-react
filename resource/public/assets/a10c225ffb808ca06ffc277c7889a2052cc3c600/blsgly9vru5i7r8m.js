var K=Object.freeze,Y=Object.defineProperty,ge=Object.defineProperties;var xe=Object.getOwnPropertyDescriptors;var V=Object.getOwnPropertySymbols;var Me=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable;var J=(s,r,t)=>r in s?Y(s,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[r]=t,Z=(s,r)=>{for(var t in r||(r={}))Me.call(r,t)&&J(s,t,r[t]);if(V)for(var t of V(r))ye.call(r,t)&&J(s,t,r[t]);return s},z=(s,r)=>ge(s,xe(r));var $=(s,r)=>K(Y(s,"raw",{value:K(r||s.slice())}));import{h as ve,j as e,m as pe,M as v,r as w,b as F,u as de,f as je,a as X}from"./jj85rqzpbnvv3emr.js";import{oF as ce,oG as be,oH as Ce,iG as ke,bR as me,bQ as Se,bS as we,bT as q,gO as _e,be as Re,bU as Ee,bV as Te,bW as Ne}from"./mclphevd122040jw.js";import{a4 as qe,a5 as Ie,eT as Le,rc as Fe,rd as Be,re as De,eZ as Ge,hz as Ue,mi as Oe,e as H,T as Q,hj as Pe,f as ue,B as I,P as R,C as fe,bw as ee,R as L,i as Ae,r as He,F as Qe,eE as N}from"./lef5ym39glv4981l.js";import{T as _}from"./i5991cad8s41d2db.js";var B,se;function We(){if(se)return B;se=1;var s=qe(),r=Ie(),t="[object RegExp]";function n(a){return r(a)&&s(a)==t}return B=n,B}var D,re;function Ke(){if(re)return D;re=1;var s=We(),r=Le(),t=Fe(),n=t&&t.isRegExp,a=n?r(n):s;return D=a,D}var G,te;function Ve(){if(te)return G;te=1;var s=Be(),r=s("length");return G=r,G}var U,ae;function Je(){if(ae)return U;ae=1;var s="\\ud800-\\udfff",r="\\u0300-\\u036f",t="\\ufe20-\\ufe2f",n="\\u20d0-\\u20ff",a=r+t+n,i="\\ufe0e\\ufe0f",d="["+s+"]",g="["+a+"]",M="\\ud83c[\\udffb-\\udfff]",j="(?:"+g+"|"+M+")",S="[^"+s+"]",b="(?:\\ud83c[\\udde6-\\uddff]){2}",C="[\\ud800-\\udbff][\\udc00-\\udfff]",x="\\u200d",p=j+"?",c="["+i+"]?",y="(?:"+x+"(?:"+[S,b,C].join("|")+")"+c+p+")*",f=c+p+y,o="(?:"+[S+g+"?",g,b,C,d].join("|")+")",l=RegExp(M+"(?="+M+")|"+o+f,"g");function m(h){for(var k=l.lastIndex=0;l.test(h);)++k;return k}return U=m,U}var O,ne;function Ye(){if(ne)return O;ne=1;var s=Ve(),r=ce(),t=Je();function n(a){return r(a)?t(a):s(a)}return O=n,O}var P,ie;function Ze(){if(ie)return P;ie=1;var s=De(),r=be(),t=ce(),n=Ge(),a=Ke(),i=Ye(),d=Ce(),g=Ue(),M=Oe(),j=30,S="...",b=/\w*$/;function C(x,p){var c=j,y=S;if(n(p)){var f="separator"in p?p.separator:f;c="length"in p?g(p.length):c,y="omission"in p?s(p.omission):y}x=M(x);var o=x.length;if(t(x)){var l=d(x);o=l.length}if(c>=o)return x;var m=c-i(y);if(m<1)return y;var h=l?r(l,0,m).join(""):x.slice(0,m);if(f===void 0)return h+y;if(l&&(m+=h.length-m),a(f)){if(x.slice(m).search(f)){var k,E=h;for(f.global||(f=RegExp(f.source,M(b.exec(f))+"g")),f.lastIndex=0;k=f.exec(E);)var u=k.index;h=h.slice(0,u===void 0?m:u)}}else if(x.indexOf(s(f),m)!=m){var T=h.lastIndexOf(f);T>-1&&(h=h.slice(0,T))}return h+y}return P=C,P}var ze=Ze();const $e=ve(ze),Xe=80,W=100;function es(s){return s<W?"bg-[#fcf6e0] text-yellow-500 dark:bg-yellow-600 dark:text-yellow-100":"bg-[rgba(229,76,66,0.16)] text-[#DC2626] dark:bg-[rgba(202,58,49,0.16)] dark:text-[#DC2626]"}function he(s){return ke()&&s!=null&&s>Xe}function ss({memoryFullPct:s,className:r,children:t,showInfoLabel:n,onManageMemories:a}){return he(s)?e.jsx("div",{className:H("border-token-border-default rounded-lg border p-1 text-sm",r),children:e.jsxs(pe.div,{className:H("flex items-center overflow-hidden rounded-sm px-2 py-1.5 whitespace-nowrap",es(s)),initial:{width:0},animate:{width:"".concat(s,"%")},transition:{duration:.5},children:[e.jsx(v,{id:"6D2etG",defaultMessage:"{memoryFullPct}% full",values:{memoryFullPct:s}}),t,n&&e.jsx(Q,{interactive:!0,label:s<W?e.jsx("div",{className:"whitespace-normal",children:e.jsx(v,{id:"gxY4wi",defaultMessage:"ChatGPT's almost out of space for new saved memories. <memoryModalLink>Manage saved memories</memoryModalLink> to create more space.",values:{memoryModalLink:d=>e.jsx("a",{href:"#",className:"cursor-pointer underline",onClick:g=>{g.preventDefault(),a==null||a()},children:d})}})}):e.jsx("div",{className:"whitespace-normal",children:e.jsx(v,{id:"1JxMf3",defaultMessage:"ChatGPT's out of space for saved memories. <memoryModalLink>Manage saved memories</memoryModalLink> to create more space.",values:{memoryModalLink:d=>e.jsx("a",{href:"#",className:"cursor-pointer underline",onClick:g=>{g.preventDefault(),a==null||a()},children:d})}})}),children:e.jsx(Pe,{className:"icon-sm ms-1"})})]})}):null}function rs({memoryFullPct:s,className:r}){return he(s)?e.jsxs("div",{className:H("flex flex-col gap-2",r),children:[e.jsx(ss,{memoryFullPct:s}),e.jsx("div",{className:"text-token-text-secondary ps-3 text-sm",children:s<W?e.jsx(v,{id:"SnInO0",defaultMessage:"<strong>Almost full.</strong> Once full, new memories won't be saved. You can remove existing memories to make room.",values:{strong:n=>e.jsx("strong",{children:n})}}):e.jsx(v,{id:"/LO3dv",defaultMessage:"<strong>Youâ€™re out of space.</strong> Remove existing memories to make room for ChatGPT to save new memories.",values:{strong:n=>e.jsx("strong",{children:n})}})})]}):null}function oe({description:s,onClose:r,onConfirm:t}){const n=F();return e.jsx(fe,{testId:"modal-confirm-reset-memory",isOpen:!0,onClose:r,type:"success",title:n.formatMessage({id:"MemoriesModal.resetModalTitle",defaultMessage:"Are you sure?"}),description:s,primaryButton:e.jsx(ee.Button,{title:n.formatMessage({id:"MemoriesModal.resetModalConfirm",defaultMessage:"Clear memory"}),color:"danger",onClick:t,"data-testid":"confirm-reset-memories-button"}),secondaryButton:e.jsx(ee.Button,{title:n.formatMessage({id:"MemoriesModal.resetModalCancel",defaultMessage:"Cancel"}),color:"secondary",onClick:r})})}function ts({onReset:s,gizmoId:r,memoryName:t}){const[n,a]=w.useState(!1),i=F(),d=ue(),g=me(),M=async()=>{R.logEvent("Memory Manage Reset Button Confirmed");try{await L.safeDelete("/settings/clear_account_user_memory",{requestBody:{gizmo_id:r}}),d.success(i.formatMessage({id:"ResetMemoriesButton.resetSuccess",defaultMessage:"Memory cleared."})),s==null||s(),a(!1)}catch(j){d.danger({id:"ResetMemoriesButton.resetFailed",defaultMessage:"Failed to clear memory.",description:"Error message for the reset memory modal"},{toastId:"reset_memories_button_reset_failed"})}};return e.jsxs(e.Fragment,{children:[e.jsx(I,{color:"danger-outline",onClick:()=>{R.logEvent("Memory Manage Reset Button Clicked"),a(!0)},"data-testid":"reset-memories-button",children:r?e.jsx(v,{id:"ResetMemoriesButton.resetGizmo",defaultMessage:"Clear this GPT's memory"}):e.jsx(v,{id:"ResetMemoriesButton.resetChatGPT",defaultMessage:"Delete all"})}),n&&(g?e.jsx(oe,{description:i.formatMessage({id:"MemoriesModal.resetGizmoModalDescriptionUpdated",defaultMessage:"Deleting your saved memories means {name} may not remember this information going forward. To fully remove this information from {name}'s memory, please delete any related chats. <link>Learn more</link>"},{name:t,link:j=>e.jsx("a",{className:"underline",href:"https://help.openai.com/en/articles/8983136-what-is-memory",children:j})}),onClose:()=>a(!1),onConfirm:M}):e.jsx(oe,{description:i.formatMessage({id:"MemoriesModal.resetGizmoModalDescription",defaultMessage:"{name} will forget everything it has remembered from your chats. This cannot be undone."},{name:t}),onClose:()=>a(!1),onConfirm:M}))]})}function as({gizmo:s,memory:r}){var f;const t=F(),n=ue(),a=de(),[i,d]=w.useState(!1),[g,M]=w.useState(r.content),j=w.useRef(null);w.useEffect(()=>{if(i&&j.current){const o=j.current,l=o.value.length;o.focus(),o.setSelectionRange(l,l)}},[i]);const{mutate:S,isPending:b}=X({mutationFn:async o=>{const{success:l}=await L.safeDelete("/memories/{memory_id}",{parameters:{path:{memory_id:o}},requestBody:{gizmo_id:s==null?void 0:s.id}});if(!l)throw new Error("An error occurred while deleting the memory")},onSettled:()=>{a.invalidateQueries({queryKey:q(s==null?void 0:s.id)})},onError:()=>{n.danger({id:"MemoriesModal.deleteFailed",defaultMessage:"Failed to forget memory",description:"Toast message when deleting memory fails"},{id:"memoryDeleteFailed",toastId:"memory_delete_failed"})}}),{mutate:C,isPending:x}=X({mutationFn:async()=>await L.safePatch("/memories/{memory_id}",{parameters:{path:{memory_id:r.id}},requestBody:{gizmo_id:s==null?void 0:s.id,content:g}}),onSuccess:o=>{const{memory_max_tokens:l,memory_num_tokens:m}=o;a.setQueryData(q(s==null?void 0:s.id),h=>{if(!h||typeof h!="object")return h;const k=h,E=Math.min(Math.floor(100*m/l),100);return z(Z({},k),{memory_max_tokens:l,memory_num_tokens:m,memoryFullPct:E})}),a.invalidateQueries({queryKey:q(s==null?void 0:s.id)}),d(!1)},onError:()=>{n.danger({id:"MemoriesModal.editFailed",defaultMessage:"Failed to update memory",description:"Toast message when editing memory fails"},{id:"memoryEditFailed",toastId:"memory_edit_failed"})}}),[p,c]=w.useState(!1),y=t.formatMessage({id:"N0czuB",defaultMessage:"Remove"});return e.jsxs(e.Fragment,{children:[e.jsx(_.Row,{disabled:b||x,children:i?e.jsxs(_.Cell,{colSpan:2,className:"relative pe-0",children:[e.jsx("input",{ref:j,autoFocus:!0,value:g,onChange:o=>M(o.target.value),className:"w-full rounded border-2 border-transparent py-2 pe-36 focus:outline-none",maxLength:500,onKeyDown:o=>{if(!o.nativeEvent.isComposing&&o.key==="Enter"){if(g.trim()===""){R.logEvent("Memory Manage Modal Memory Delete Clicked"),c(!0);return}C()}}}),e.jsxs("div",{className:"absolute end-1 top-1/2 flex -translate-y-1/2 gap-1",children:[e.jsx(I,{color:"secondary",size:"small",onClick:()=>{M(r.content),d(!1)},children:e.jsx(v,{id:"TTo8Tw",defaultMessage:"Cancel"})}),e.jsx(I,{size:"small",onClick:()=>{if(g.trim()===""){R.logEvent("Memory Manage Modal Memory Delete Clicked"),c(!0);return}C()},disabled:x,children:e.jsx(v,{id:"mDcKbU",defaultMessage:"Save"})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(_.Cell,{className:"pe-0",divClassName:"min-h-[40px] items-center w-full",children:e.jsx("div",{className:"border-2 border-transparent py-2 whitespace-pre-wrap",children:r.content})}),e.jsx(_.Cell,{textAlign:"right",children:e.jsxs(_.Actions,{children:[(()=>{const o=t.formatMessage({id:"EditableMemoriesModal.edit",defaultMessage:"Edit"});return e.jsx("button",{onClick:()=>d(!0),"aria-label":o,className:"text-token-text-tertiary hover:text-token-text-secondary",children:e.jsx(Q,{label:o,side:"top",className:"leading-none",children:e.jsx(_e,{className:"icon-sm"})})})})(),e.jsx("button",{onClick:()=>{R.logEvent("Memory Manage Modal Memory Delete Clicked"),c(!0)},"aria-label":y,className:"text-token-text-tertiary hover:text-token-text-secondary",children:e.jsx(Q,{className:"leading-none",label:y,side:"top",children:e.jsx(Re,{className:"icon-sm"})})})]})})]})}),p&&e.jsx(Ee,{isOpen:!0,primaryButtonColor:"danger",title:y,confirmText:t.formatMessage({id:"fCn0ar",defaultMessage:"Forget"}),onConfirm:()=>{R.logEvent("Memory Manage Modal Memory Delete Confirmed"),S(r.id),c(!1)},onClose:()=>{c(!1),M(r.content),d(!1)},children:e.jsx(v,{id:"j2cZHW",defaultMessage:'Remove "{title}" from {name}â€™s saved memories. This canâ€™t be undone. <link>Learn more</link>',values:{name:(f=s==null?void 0:s.name)!=null?f:"ChatGPT",title:e.jsx("strong",{children:$e(r.content,{length:130,omission:"..."})}),link:o=>e.jsx("a",{href:"https://help.openai.com/en/articles/8590148-memory-faq",target:"_blank",className:"underline",rel:"noreferrer",children:o})}})})]})}function ns({selectedGizmoId:s,onSelect:r,items:t}){const n=t.find(i=>i.id===s);function a(i){var d;return e.jsx(Ne,{isFirstParty:i.id===void 0,src:(d=i.iconUrl)!=null?d:null,className:"icon"})}return e.jsx("div",{className:"border-token-border-medium mb-2 inline-flex rounded-md border",children:e.jsxs(N.Root,{children:[e.jsx(N.Trigger,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[n?e.jsxs(e.Fragment,{children:[a(n),e.jsx("span",{className:"text-token-text-primary",children:n.name})]}):e.jsx(v,{id:"MemoriesModal.unknownGizmo",defaultMessage:"Unknown GPT"}),e.jsx(Te,{className:"icon-sm text-token-text-tertiary"})]})}),e.jsx(N.Portal,{children:e.jsx(N.Content,{children:t.map(i=>e.jsxs(N.Item,{className:"flex items-center gap-3",onClick:()=>{r(i.id)},children:[a(i),i.name]},i.id))})})]})})}var le;const A=Qe.div(le||(le=$(["flex h-full items-center justify-center pb-8 text-sm text-token-text-tertiary rounded-lg border border-token-border-default"])));function ms({onClose:s,initialGizmoId:r}){var h,k,E;const t=F(),n=de(),a=Se(),[i,d]=w.useState(r),g=Ae(),M=He(g),j=M==null?void 0:M.hasPlusFeatures(),S=me();w.useEffect(()=>{R.logEvent("Memory Modal Shown")},[]);const{data:b,isLoading:C,isError:x,refetch:p}=we(i,!0,a),c=b==null?void 0:b.memories,{data:y,refetch:f}=je({queryKey:["memory_gizmos"],queryFn:()=>L.safeGet("/memories/gizmos"),refetchOnMount:"always"}),o=[{id:void 0,name:"ChatGPT",iconUrl:null},...(h=y==null?void 0:y.items.map(({gizmo:u})=>{var T;return{id:u.id,name:u.display.name,iconUrl:(T=u.display.profile_picture_url)!=null?T:null}}))!=null?h:[]],l=o.find(u=>u.id===i);w.useEffect(()=>{!C&&!x&&i!==void 0&&(!c||c.length===0)&&d(void 0)},[C,x,c,i]);let m;return C?m=e.jsx(A,{children:e.jsx(v,{id:"MemoriesModal.loading",defaultMessage:"Loading..."})}):x?m=e.jsx(A,{children:e.jsxs("div",{className:"max-w-sm text-center",children:[e.jsx("div",{className:"mb-4 text-red-500",children:e.jsx(v,{id:"MemoriesModal.somethingWentWrong",defaultMessage:"Something went wrong..."})}),e.jsx("div",{children:e.jsx(I,{color:"secondary",onClick:()=>{p()},children:e.jsx(v,{id:"MemoriesModal.retry",defaultMessage:"Retry"})})})]})}):!c||c.length===0?m=e.jsx(A,{children:e.jsx("div",{className:"max-w-sm text-center",children:a?e.jsx(v,{id:"MemoriesModal.noMemories.1",defaultMessage:"As you chat with {name}, the details and preferences it saves will be shown here.",values:{name:(k=l==null?void 0:l.name)!=null?k:"ChatGPT"}}):e.jsx(v,{id:"MemoriesModal.noMemoriesAndDisabled",defaultMessage:"Memory is disabled. ChatGPT won't use or save memories."})})}):m=e.jsx(_.Root,{className:"h-full",size:"compact",bordered:!0,children:e.jsx(_.Body,{children:c.map(u=>e.jsx(as,{gizmo:l?{id:l.id,name:l.name}:void 0,memory:u},u.id))})}),e.jsxs(fe,{testId:"modal-memories",isOpen:!0,onClose:s,size:"custom",className:"max-w-5xl",type:"success",title:t.formatMessage({id:"MemoriesModal.title",defaultMessage:"Saved memories"}),description:e.jsx("div",{className:"text-token-text-secondary",children:S&&j?t.formatMessage({id:"MemoriesModal.description",defaultMessage:"ChatGPT tries to remember most of your chats, but it may forget things over time. Saved memories are never forgotten. <link>Learn more</link>"},{link:u=>e.jsx("a",{href:"https://help.openai.com/en/articles/8983136-what-is-memory",target:"_blank",rel:"noopener noreferrer",className:"underline",children:u})}):S?t.formatMessage({id:"MemoriesModal.description.freeMoonshine",defaultMessage:"ChatGPT tries to remember your recent chats, but it may forget things over time. Saved memories are never forgotten. <link>Learn more</link>"},{link:u=>e.jsx("a",{href:"https://help.openai.com/en/articles/8983136-what-is-memory",target:"_blank",rel:"noopener noreferrer",className:"underline",children:u})}):t.formatMessage({id:"MemoriesModalFree.description",defaultMessage:"ChatGPT remembers useful details about you and your preferences so it can be more helpful. <link>Learn more</link>"},{link:u=>e.jsx("a",{href:"https://help.openai.com/en/articles/8983136-what-is-memory",target:"_blank",rel:"noopener noreferrer",className:"underline",children:u})})}),showCloseButton:!0,children:[j&&o.length>1&&e.jsx("div",{className:"mb-4",children:e.jsx(ns,{selectedGizmoId:i,items:o,onSelect:u=>{n.invalidateQueries({queryKey:q(u)}),d(u)}})}),e.jsx(rs,{memoryFullPct:b==null?void 0:b.memoryFullPct,className:"mb-5"}),e.jsx("div",{className:"h-[24rem]",children:m}),e.jsx("div",{className:"mt-5 flex justify-end",children:e.jsx(ts,{onReset:()=>{p(),f(),i&&d(void 0)},gizmoId:i,memoryName:(E=l==null?void 0:l.name)!=null?E:"ChatGPT"})})]})}export{ms as E,rs as M,ts as R,ss as a,$e as t};
//# sourceMappingURL=blsgly9vru5i7r8m.js.map
