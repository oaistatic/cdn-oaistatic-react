var G=Object.defineProperty,F=Object.defineProperties;var v=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var S=(o,t,n)=>t in o?G(o,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[t]=n,m=(o,t)=>{for(var n in t||(t={}))j.call(t,n)&&S(o,n,t[n]);if(E)for(var n of E(t))q.call(t,n)&&S(o,n,t[n]);return o},R=(o,t)=>F(o,v(t));import{G as B,b as $,g as W,r as P,j as I,ae as N,d as z}from"./jj85rqzpbnvv3emr.js";import{fh as r,i as K,nL as J,f as Y,nM as Q,lC as V,R as b,fg as _,eq as X,es as Z,nN as ee,bv as h,l3 as te,bu as ne,nO as M,P as k,nP as se,k as oe}from"./lef5ym39glv4981l.js";import{g as ce}from"./lgin6mixrzyx9uwc.js";import{C as re}from"./k059n59kmbyb9lsl.js";const ae={OAUTH_SCOPES_MISMATCH:r.OAUTH_FAILED_SCOPE_MISMATCH,EMAIL_DOMAIN_CLAIMED_BY_ANOTHER_WORKSPACE:r.OAUTH_FAILED_EMAIL_DOMAIN_ENFORCEMENT},w=z({genericSuccess:{id:"connectorPlatformOauthRedirect.genericSuccess",defaultMessage:"{connector} is now connected"},slackAiAppSuccess:{id:"connectorPlatformOauthRedirect.slackAiAppSuccess",defaultMessage:"AI App for Slack is now installed"}}),pe=B(function(){const t=$(),n=K(),a=W(),g=V("installations/select_target"),p=J(),y=Y(),d=P.useRef(!1),{mutateAsync:U}=Q();return P.useEffect(()=>{if(d.current===!0)return;d.current=!0;async function L(){var C,A,O;const f=ce()==="popup"||p,H=window.location.href;try{const e=await b.safePost("/aip/connectors/links/oauth/callback",{requestBody:{full_redirect_url:H}});if(!(e!=null&&e.post_auth_url)){a(_(r.OAUTH_FAILED_GENERIC));return}const s=new URL(e.post_auth_url,location.origin),i=((C=e==null?void 0:e.link)==null?void 0:C.connector_id)===X[Z.GITHUB_CONNECTOR],u=s.searchParams.get("github_onboarding")==="sync-repos";if(i&&u){const c=await b.safePost("/aip/connectors/github/search_repos",{requestBody:{query:"",limit:20,next_token:null,link_id:e.link.id}});if(!c||c.repos.length===0){window.open("".concat(g,"?state=").concat(encodeURIComponent(JSON.stringify({client_redirect_to:"".concat(window.location.origin,"/?github_onboarding=sync-repos")}))),"_self");return}}const T=ee(s.hash)===h.Connectors;if(!T){const c=te[e.link.connector_id];c&&s.searchParams.set("add_source",c)}let l;if(T){const c=new URLSearchParams;c.set("connector",e.link.connector_id),i&&!u&&c.set("github_onboarding","configure-repos");const D=R(m({},s),{search:"",hash:ne(h.Connectors).hash+"?".concat(c.toString())});l=N(D)}else i&&!u&&s.searchParams.set("github_onboarding","configure-repos"),l=N({pathname:s.pathname,search:s.search,hash:s.hash});if(f){M({success:!0,connectorId:e.link.connector_id,linkId:e.link.id}),window.close();return}k.logEventWithStatsig("Connector OAuth Connect","chatgpt_connectors_oauth_connect_success",{success:!0,type:e.link.connector_id});const x=e.link.connector_id===se?t.formatMessage(w.slackAiAppSuccess):t.formatMessage(w.genericSuccess,{connector:e.link.name});a(_(r.CUSTOM_MSG,l,x))}catch(e){const s=e instanceof oe?(O=ae[(A=e.detail)==null?void 0:A.error_code])!=null?O:r.OAUTH_FAILED_GENERIC:r.OAUTH_FAILED_GENERIC;if(f){M({success:!1,connectorId:"",errorType:s}),window.close();return}k.logEventWithStatsig("Connector OAuth Connect","chatgpt_connectors_oauth_connect_error",{errorType:s,success:!1,type:"unknown"}),a(_(s,"#settings/".concat(h.Connectors)))}}L()},[n,p,g,t,a,y,U]),I.jsx("div",{className:"flex h-screen w-screen items-center justify-center",children:I.jsx(re,{size:36})})});export{pe as default};
//# sourceMappingURL=wh2v68u1zk8ldkwu.js.map
