const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/k0gobvgjs4pf35pv.js","assets/jj85rqzpbnvv3emr.js","assets/lef5ym39glv4981l.js","assets/root-ogjlcpyy.css","assets/mclphevd122040jw.js","assets/conversation-small-g7l5datj.css","assets/jo2rzlevh0fbjyvo.js","assets/ih9wj2grf6eudhng.js","assets/f8qcx5r3ombc6w5p.js","assets/d9yelnvmrbnletz1.js","assets/ou0dbpaenmm0r7gk.js","assets/cdzweje6r9a6j1aw.js","assets/fbqlxc5qyzowzfhb.js","assets/fr1sbwjfet6zl9mw.js","assets/oewf3dcf71lssqyb.js","assets/nq5i976pifkrt40a.js","assets/ojb4d4bxj44fs0l8.js","assets/efscvp3g4k0or8n5.js","assets/kxedrjbxv2qblujd.js","assets/doljxy43e4xie9bi.js","assets/lep2wptoy14cfe2w.js","assets/o00amwudg0s90vfh.js","assets/hnotrmacgvnfyexv.js","assets/hm94yzqatxa451b5.js","assets/ek7qgesc03yusf3u.js","assets/iiok29s29bpdre61.js","assets/ge4ozj790nfv3vb5.js","assets/hcsjwjl2ji65i21r.js","assets/jt0fc5oel309hgy2.js","assets/ef92qx749w9klz4o.js","assets/l45tzjfw41ny1oxj.js","assets/2dhqllc5pireni9q.js","assets/jza9spsuu2f7ynxb.js","assets/ht7of10t76s6p5h9.js","assets/efsl2tpd3w39q64v.js","assets/chkdmiqd2p7k2syq.js","assets/ogcl7v93rii15rrg.js","assets/ansi-1f6vhsjh.css","assets/mcz3fk8dwdc0wesf.js","assets/b2bzebhpy3vjflr5.js","assets/moqemqor8gto0ynb.js","assets/k059n59kmbyb9lsl.js","assets/kl7c6054usfnqmd4.js","assets/k97n0y6ba9c9h39c.js","assets/e35egaqnsei5a2mf.js","assets/ksbtr9cllybwh424.js","assets/brmoct65jnfspzpr.js","assets/n8vi41od4r1tq9yq.js","assets/mgvl43usqxj4xeax.js","assets/d4h5q8m41uvqlm3r.js","assets/i5991cad8s41d2db.js","assets/ifj2o3jul9ys1l79.js","assets/fna9z31n721lpf9f.js","assets/table-components-iztk4amh.css"])))=>i.map(i=>d[i]);
var Xs=Object.freeze,Ks=Object.defineProperty,kr=Object.defineProperties;var Sr=Object.getOwnPropertyDescriptors;var Tt=Object.getOwnPropertySymbols;var Js=Object.prototype.hasOwnProperty,Qs=Object.prototype.propertyIsEnumerable;var es=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t);var Zs=(t,e,s)=>e in t?Ks(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,A=(t,e)=>{for(var s in e||(e={}))Js.call(e,s)&&Zs(t,s,e[s]);if(Tt)for(var s of Tt(e))Qs.call(e,s)&&Zs(t,s,e[s]);return t},O=(t,e)=>kr(t,Sr(e));var ue=(t,e)=>{var s={};for(var a in t)Js.call(t,a)&&e.indexOf(a)<0&&(s[a]=t[a]);if(t!=null&&Tt)for(var a of Tt(t))e.indexOf(a)<0&&Qs.call(t,a)&&(s[a]=t[a]);return s};var ot=(t,e)=>Xs(Ks(t,"raw",{value:Xs(e||t.slice())}));var Et=function(t,e){this[0]=t,this[1]=e},en=(t,e,s)=>{var a=(i,l,c,d)=>{try{var u=s[i](l),m=(l=u.value)instanceof Et,b=u.done;Promise.resolve(m?l[0]:l).then(y=>m?a(i==="return"?i:"next",l[1]?{done:y.done,value:y.value}:y,c,d):c({value:y,done:b})).catch(y=>a("throw",y,c,d))}catch(y){d(y)}},r=i=>o[i]=l=>new Promise((c,d)=>a(i,l,c,d)),o={};return s=s.apply(t,e),o[es("asyncIterator")]=()=>o,r("next"),r("throw"),r("return"),o};var ts=(t,e,s)=>(e=t[es("asyncIterator")])?e.call(t):(t=t[es("iterator")](),e={},s=(a,r)=>(r=t[a])&&(e[a]=o=>new Promise((i,l,c)=>(o=r.call(t,o),c=o.done,Promise.resolve(o.value).then(d=>i({value:d,done:c}),l)))),s("next"),s("return"),e);import{j as n,M as D,b as W,r as f,v as Cr,a as ha,m as Dt,c as ge,z as Nr,f as Mr,h as Tr,n as pa,g as Er,R as xa,d as Cs,e as ss,A as tn}from"./jj85rqzpbnvv3emr.js";import{S as $r}from"./ojb4d4bxj44fs0l8.js";import{M as Pr,r as Ar,f as Lr,a as Ir,b as Rr,m as ga,u as ba,R as ya,c as va,S as xs,d as Dr,I as Fr,e as Or,C as zr,g as Br,h as Wr,i as Hr,j as Ur}from"./efscvp3g4k0or8n5.js";import{D7 as qr,D8 as Gr,D9 as ns,Da as Ie,hm as wa,me as _a,a4 as Ns,vF as Vr,ow as Yr,Db as Gt,Dc as Xr,dm as Zr,w as Kr,Y as pt,fb as Ce,f9 as Jr,cy as Qr,dK as gs,lO as eo,k1 as Ms,uY as Ts,j$ as Es,k0 as $s,Dd as to,hc as ja,hd as so,gY as no,gO as ao,hA as ro,wc as oo,kf as sn,De as io,Df as lo,Dg as co,h as uo,w5 as mo,w6 as fo,w7 as ho,Dh as po,xo,c7 as ka,bv as Sa,wv as go,Di as bo,Dj as yo,hj as vo,nX as wo,nY as _o,nZ as jo,eJ as ko,kJ as So,cA as Co,mM as No,mK as Mo,Dk as Lt,mH as Ke,Dl as To,Dm as Eo,mQ as bs,lP as Ps,Dn as $o,Do as Ca,Dp as As,kb as Po,d7 as Na,dq as Ls,Dq as Is,Dr as Ao,mI as Vt,cp as ct,lN as Lo,S as Io,cc as Ro,ut as Ma,Ds as Ta,Dt as Do,oP as Fo,Du as Oo,hv as zo,Dv as Ea,m9 as Bo,o1 as Wo,Dw as Ho,dp as Rs,Dx as $a,aT as Pa,Dy as Uo,Dz as qo,DA as Go,cx as Vo,cz as Yo,o4 as Xo,gE as Zo,DB as Ko,DC as Jo,DD as Qo,DE as ei,DF as ti,hP as si,cM as ni,bs as ys,cP as Aa,cQ as La,DG as ai,DH as ri,DI as oi,bV as ii,m$ as li,DJ as ci,tC as di,wd as ui,DK as mi,yc as fi,DL as hi,DM as pi,DN as xi,DO as gi,cg as bi,DP as yi,aO as vi,jC as wi,DQ as _i,DR as $t,DS as ji,DT as ki,DU as Si,x1 as Ci}from"./mclphevd122040jw.js";import{e as P,wm as Ni,bK as st,cj as nt,cg as Mi,E as xt,f as at,i as J,j as K,cK as Ds,oS as Ti,a8 as Ei,a2 as $i,ax as rt,ex as Ia,ey as Fs,fD as Pi,bs as Ai,a3 as nn,i6 as Li,gn as Ra,aj as Ii,L as Da,p as Fa,dJ as Ri,B as xe,bw as Re,aY as Di,eb as Fi,ec as Oi,T as Le,gC as zi,gz as Bi,qd as Wi,aa as gt,P as $e,cw as bt,mb as Hi,eE as Ee,hW as Ui,R as Os,fW as yt,A as Oa,bM as qi,bQ as Gi,iv as Vi,bI as Je,eN as vt,ib as wt,h1 as za,Z as Yt,iI as we,ly as Yi,wn as Xi,hz as Zi,h7 as Ki,mi as Ji,hR as _t,_ as jt,S as Qi,rh as el,be as tl,fl as sl,ie as nl,kl as al,id as rl,bv as ol,iV as il,J as ll,hi as as,f0 as cl,F as zs,Y as dl,wo as ul,lr as Ba,bZ as ml,mn as lt,bo as Wa,nn as fl,ia as hl,af as pl,wp as xl,fw as gl,mj as bl,ft as Ha,ch as yl,h0 as vl,x as wl,bJ as _l,cv as jl,cx as kl}from"./lef5ym39glv4981l.js";import{u as Bs}from"./o00amwudg0s90vfh.js";import{N as Sl}from"./hnotrmacgvnfyexv.js";import{g as an,F as Cl,i as Nl}from"./hm94yzqatxa451b5.js";import{S as Ml}from"./ek7qgesc03yusf3u.js";import{v as Tl,u as El,P as $l,W as Pl}from"./ih9wj2grf6eudhng.js";import{L as Al}from"./iiok29s29bpdre61.js";import{W as Ll,c as Il,b as Rl,a as Dl}from"./kxedrjbxv2qblujd.js";import{S as Fl}from"./ge4ozj790nfv3vb5.js";import{W as Xt}from"./hcsjwjl2ji65i21r.js";import{W as Ol}from"./jt0fc5oel309hgy2.js";import{m as Ua,t as zl,W as Bl,c as rn}from"./ef92qx749w9klz4o.js";import{u as Wl}from"./chkdmiqd2p7k2syq.js";import{A as Hl}from"./ogcl7v93rii15rrg.js";import{c as Ws}from"./mcz3fk8dwdc0wesf.js";import{s as Ul}from"./b2bzebhpy3vjflr5.js";import{C as on}from"./k059n59kmbyb9lsl.js";import{d as ql}from"./kl7c6054usfnqmd4.js";import{g as Gl}from"./k97n0y6ba9c9h39c.js";import{a as Vl}from"./e35egaqnsei5a2mf.js";import{u as Yl}from"./oewf3dcf71lssqyb.js";import{u as Xl}from"./nq5i976pifkrt40a.js";import{S as Zl}from"./ksbtr9cllybwh424.js";import{S as Kl}from"./brmoct65jnfspzpr.js";import{u as Jl,a as Ql}from"./n8vi41od4r1tq9yq.js";import{v as ln,C as ec,A as tc,h as sc,j as nc,f as ac,p as rc,k as oc,n as ic,P as lc,o as cc,q as dc,L as uc}from"./mgvl43usqxj4xeax.js";import{u as dt,t as cn,r as vs,g as Ne}from"./d4h5q8m41uvqlm3r.js";import{T as de}from"./i5991cad8s41d2db.js";import{c as qa}from"./ifj2o3jul9ys1l79.js";import{t as dn}from"./fna9z31n721lpf9f.js";const mc=qa("ChevronDownFilled","1em",["M15.8 7.73c.28.3.27.78-.03 1.06l-5.25 5a.75.75 0 0 1-1.04 0l-5.25-5a.75.75 0 0 1 1.04-1.08L10 12.2l4.73-4.5a.75.75 0 0 1 1.06.02Z"]),fc=qa("ChevronLeftFilled","1em",["M12.27 15.8a.75.75 0 0 1-1.06-.03l-5-5.25a.75.75 0 0 1 0-1.04l5-5.25a.75.75 0 1 1 1.08 1.04L7.8 10l4.5 4.73c.29.3.28.78-.02 1.06Z"]);function hc(s){var a=s,{children:t}=a,e=ue(a,["children"]);return n.jsxs(Pr,O(A({},e),{className:"decorated-link",children:[t,n.jsx("span",{"aria-hidden":!0,className:"ms-0.5 inline-block align-middle leading-none",children:n.jsx($r,{className:"block h-[0.75em] w-[0.75em] stroke-current stroke-[0.75]"})})]}))}const un=({children:t,"data-start":e=null,"data-end":s=null,"data-is-last-node":a,"data-is-only-node":r,tag:o})=>{const{animationTiming:i,shouldAnimate:l,shouldHide:c,isDisabled:d,onComplete:u,onReady:m}=qr({isMarker:!0,tag:o,children:t,start:e,end:s,isLastNode:a,isOnlyNode:r});return d||c?n.jsx(o,{"data-start":e,"data-end":s,className:P(c&&"hidden"),children:t}):n.jsx(o,{"data-start":e,"data-end":s,className:P(ns.marker,l?ns.animate:ns.hidden),onAnimationStart:()=>m(0),onAnimationEnd:()=>u(0),style:Gr(i),children:t})},pc={p:t=>n.jsx(Ie,A({tag:"p"},t)),h1:t=>n.jsx(Ie,A({tag:"h1"},t)),h2:t=>n.jsx(Ie,A({tag:"h2"},t)),h3:t=>n.jsx(Ie,A({tag:"h3"},t)),h4:t=>n.jsx(Ie,A({tag:"h4"},t)),h5:t=>n.jsx(Ie,A({tag:"h5"},t)),h6:t=>n.jsx(Ie,A({tag:"h6"},t)),li:t=>n.jsx(un,A({tag:"li",isListItem:!0},t)),hr:t=>n.jsx(un,A({tag:"hr"},t))};function xc(t){const e=t.split("\n");bc(e);const s=e.pop();if(s===":"||s==="::")e.push("");else{const a=gc(s).trimEnd();a&&e.push(a)}return e.join("\n")}function gc(t){if(!t||/^\s*-\s*([*_]+)?\s*$/.test(t))return"";const e=[];let s="",a=0;for(;a<t.length;){if(t[a]==="*"&&t[a+1]==="*"){s+="**",e.length&&e[e.length-1]==="**"?e.pop():e.push("**"),a+=2;continue}if(t[a]==="*"||t[a]==="_"){s+=t[a];const o=t[a];e.length&&e[e.length-1]===o?e.pop():e.push(o),a++;continue}if(t[a]==="["){const o=t[a];s+=o,e.push(o),a++;continue}if(t[a]==="]"){const o=t[a];s+=o,e.length&&e[e.length-1]==="["&&e.pop(),a++;continue}if(t[a]==="("&&t[a-1]==="]"){const o=t[a];s+=o,e.push(o),a++;continue}if(t[a]===")"){const o=t[a];s+=o,e.length&&e[e.length-1]==="("&&e.pop(),a++;continue}s+=t[a],a++}if(e.length===0)return t;let r=s.trimEnd();for(;e.length;){const o=e.pop();if(o==null)break;o==="("?r+=")":r.endsWith(o)?r=r.slice(0,-o.length).trimEnd():o==="["?r+="]()":r+=o}return r}function bc(t){let e=!1;for(let s=0;s<t.length;s++){const a=t[s];if(wc(a)){e=!e;continue}if(e)continue;const r=a.trim();if(r.startsWith(":::")&&r!==":::"){const o=r.indexOf("{");if(o===-1){const i=r.slice(3).trim();if(i.length>0&&!(i in Ni)){t[s]=":::";continue}const l=a.replace(/\s+$/,"");t[s]=l+"{}";continue}vc(r,o)||(t[s]=yc(a,a.indexOf("{")))}t.length>1&&t[t.length-1]===":::"&&t[t.length-2]===":::"&&t.splice(-2)}}function yc(t,e){const s=t.replace(/\s+$/,""),a=s.slice(0,e).replace(/\s+$/,""),r=s.slice(e+1);if(r.trim().length===0||!/=/.test(r))return a+"{}";let i=null,l=!1;for(let c=0;c<r.length;c++){const d=r[c];if(l){l=!1;continue}if(d==="\\"){l=!0;continue}if(i){d===i&&(i=null);continue}if(d==='"'||d==="'"){i=d;continue}}return i?s+i+"}":/=[\s]*$/.test(r)?s+'""}':s+"}"}function vc(t,e){let s=null,a=0,r=!1;for(let o=e;o<t.length;o++){const i=t[o];if(r){r=!1;continue}if(i==="\\"){r=!0;continue}if(s){i===s&&(s=null);continue}if(i==='"'||i==="'"){s=i;continue}if(i==="{"){a++;continue}if(i==="}"){if(a--,a===0)return!0;continue}}return!1}function wc(t){return t.trimStart().startsWith("```")}function _c({citation:t}){return n.jsx(wa,{side:"top",triggerButton:n.jsx("span",{className:"inline-flex items-center font-bold",children:n.jsx(D,{id:"ZNWtPG",defaultMessage:"{startChar}clipboard {icon}{endChar}",values:{startChar:"「",icon:n.jsx(Vr,{className:"mb-1 inline-block size-5"}),endChar:"」"}})}),className:"max-w-xl",children:n.jsxs("div",{className:"flex flex-col items-stretch gap-1",children:[n.jsx("div",{className:"flex justify-end border-b",children:n.jsx(_a,{onCopy:e=>Ns(t.text,void 0,e),buttonText:!0,textPosition:"left"})}),n.jsx("div",{children:t.text})]})})}function jc({citation:t,clientThreadId:e,nodeType:s}){const a=W(),r=st(e),o=Yr(t.screenshot_asset_pointer,r);return s==="containerDirective"&&a.formatMessage({id:"4/Vs6a",defaultMessage:"Cited Screenshot"}),n.jsx(wa,{side:"top",triggerButton:n.jsx("span",{className:"inline-flex items-center font-bold",children:n.jsx(D,{id:"qUxKU1",defaultMessage:"{startChar}screenshot {icon}{endChar}",values:{startChar:"「",icon:n.jsx(Gt,{className:"mb-1 inline-block size-5"}),endChar:"」"}})}),className:"max-w-xl",children:o?n.jsx("img",{className:"w-xl max-w-screen",src:o,alt:a.formatMessage({id:"4/Vs6a",defaultMessage:"Cited Screenshot"})}):n.jsx("div",{className:"text-sm",children:n.jsx(D,{id:"BUdJTR",defaultMessage:"Screenshot not available"})})})}function Ga({clientThreadId:t,messageId:e,fileId:s,fileName:a,processedMarkdownInfo:r,isStandaloneAttachment:o}){const i=st(t),l=nt(t,g=>{var j;return e?(j=g==null?void 0:g.tree.getNodeIfExists(e))==null?void 0:j.message:void 0}),c=f.useMemo(()=>{var _;if(!l)return null;const g={content_type:Mi.Text,parts:["{{file:".concat(s,"}}")]},j=O(A({},l==null?void 0:l.metadata),{is_synthetic_share_message:!0,is_standalone_share_attachment:o});return j.content_references=(_=r==null?void 0:r.displayedContentReferences.filter(N=>N.type!=="debug"))!=null?_:[],j.citations=[],r&&(g.parts=[r.rawText],j.n7jupd_crefs=r.n7jupdCrefs),O(A({},l),{id:Cr(),content:g,metadata:j})},[l,s,r,o]),d=f.useMemo(()=>{if(!(!l||!c||!i))return{previewMessage:c,clientThreadId:t,fileId:s,messageId:l.id,serverThreadId:i,isStandaloneAttachment:o,fileName:a}},[c,t,s,l,i,o,a]),u=Xr({odysseyShareIntent:d,clientThreadId:t}),[m,b]=f.useState(!1);return{onClick:f.useCallback(async()=>{b(!0),await u(),b(!1)},[b,u]),isLoading:m,isEnabled:!!d}}function kc({clientThreadId:t,messageId:e,fileId:s,fileName:a,processedMarkdownInfo:r}){const o=W(),{onClick:i,isLoading:l,isEnabled:c}=Ga({clientThreadId:t,messageId:e,fileId:s,fileName:a,processedMarkdownInfo:r,isStandaloneAttachment:!1});return c?n.jsx(Zr,{onClick:i,label:o.formatMessage({id:"ConversationTurn.sharePostButtonTooltip",defaultMessage:"Share"}),icon:l?xt:Kr}):null}function Sc(t){return t.endsWith(".md")}const Cc=({citation:t,clientThreadId:e,messageId:s})=>{const[a,r]=f.useState(!1),o=st(e),i=at(),[l,c]=f.useState(null),d=f.useRef(null),u=f.useCallback(w=>{i.danger(w,{toastId:"ttom_file_citation_failed_to_download_file"})},[i]),m=t.file_id,b=J(),y=K(b,"3154019201"),v=y,g=pt(),j=Bs(!0,o,m,void 0,u),_=j==null?void 0:j.data,N=(j==null?void 0:j.isPending)||!1;f.useEffect(()=>{var w;if((_==null?void 0:_.status)==="success"&&_.download_url){(w=d.current)==null||w.abort();const S=new AbortController;d.current=S,r(!0),(async()=>{try{const p=await fetch(_.download_url,{headers:g?{}:Ds(),signal:S.signal});if(!p.ok)throw new Error("HTTP ".concat(p.status));c(await p.text())}catch(p){p.name!=="AbortError"&&i.danger("Failed to download file",{toastId:"ttom_file_citation_failed_to_download_file"})}finally{r(!1)}})()}return()=>{var S;(S=d.current)==null||S.abort()}},[_,i,g]);const k=f.useContext(Ce),h=f.useMemo(()=>{var L,I,$,x,R,F,q,G,B;if(l==null)return null;const S=(x=(($=(I=(L=k==null?void 0:k.message)==null?void 0:L.metadata)==null?void 0:I.content_references_by_file)!=null?$:{})[t.cite_key])!=null?x:[],p=Ti(l,S);let C=p.processedText;const M=(R=p.displayedContentReferences)!=null?R:[],T=(B=((G=(q=(F=k==null?void 0:k.message)==null?void 0:F.metadata)==null?void 0:q.n7jupd_crefs_by_file)!=null?G:{})[t.cite_key])!=null?B:[];return T.length>0&&(C=Jr(C,T)),{processedText:C,displayedContentReferences:M,n7jupdCrefs:T,rawText:l}},[l,k,t.cite_key]);return N||a?n.jsx(xt,{className:"inline"}):!h||!(k!=null&&k.message)?"[Could not display report]":n.jsx(Ce.Provider,{value:O(A({},k),{contentReferences:h.displayedContentReferences,n7jupdCrefs:h.n7jupdCrefs}),children:n.jsxs("div",{className:"border-token-border-light dark:border-token-bg-tertiary @container relative mx-[-16px] mt-4 mb-4 flex cursor-text flex-col items-start overflow-hidden rounded-[14px] border px-4 pt-6 pb-6 contain-inline-size sm:mx-[-32px] sm:rounded-[28px] sm:px-8 sm:shadow-sm",children:[n.jsx("div",{className:"w-full pt-1 pb-1 sm:pt-4 sm:pb-3",children:n.jsx(Qr,{clientThreadId:e,componentOverrides:Sl,children:h.processedText})}),v&&n.jsx("div",{className:"flex",children:y&&n.jsx(kc,{clientThreadId:e,messageId:s,fileId:m,fileName:t.file_name,processedMarkdownInfo:h,isStandaloneAttachment:!1})})]})})},mn=(t,e)=>{const s=new Al(new URL("{{.assetPrefix}}/assets/walnut-worker-D0YBDB-v.js",import.meta.url),{type:"module"});return new Promise((a,r)=>{s.onmessage=o=>{var i;s.terminate(),o.data.error?r(new Error(o.data.error)):a((i=o.data.protoBytes)!=null?i:new Uint8Array)},s.onerror=o=>{s.terminate(),r(o)},s.postMessage({bytes:t.buffer,ext:e},[t.buffer])})},Nc="Walnut",Mc={hash:"sha256-cxFiGJTPH/YSMHl8CbBtO2YJSu/OO9llgx0UyKgIBCQ=",fingerprinting:{"DocumentFormat.OpenXml.Framework.zzrbdxy160.wasm":"DocumentFormat.OpenXml.Framework.wasm","DocumentFormat.OpenXml.9kx12hc5a3.wasm":"DocumentFormat.OpenXml.wasm","Google.Protobuf.ymcrlw7ls4.wasm":"Google.Protobuf.wasm","System.Collections.Concurrent.q7k9997daq.wasm":"System.Collections.Concurrent.wasm","System.Collections.NonGeneric.e29je1lh17.wasm":"System.Collections.NonGeneric.wasm","System.Collections.Specialized.za90e6uca4.wasm":"System.Collections.Specialized.wasm","System.Collections.l48alw8ik0.wasm":"System.Collections.wasm","System.ComponentModel.Primitives.o70rgbr7as.wasm":"System.ComponentModel.Primitives.wasm","System.ComponentModel.TypeConverter.83539jv8ad.wasm":"System.ComponentModel.TypeConverter.wasm","System.ComponentModel.0n5errmvx8.wasm":"System.ComponentModel.wasm","System.Diagnostics.DiagnosticSource.g8ajmpm5cd.wasm":"System.Diagnostics.DiagnosticSource.wasm","System.IO.Compression.y5glqpjnb8.wasm":"System.IO.Compression.wasm","System.IO.Packaging.8th4tkd3a0.wasm":"System.IO.Packaging.wasm","System.Linq.Expressions.biujz7ou20.wasm":"System.Linq.Expressions.wasm","System.Linq.6btt3su4oy.wasm":"System.Linq.wasm","System.Memory.m6pzfzg6nf.wasm":"System.Memory.wasm","System.Net.Http.5n712yykv5.wasm":"System.Net.Http.wasm","System.Net.Primitives.0h7y3g6nqf.wasm":"System.Net.Primitives.wasm","System.ObjectModel.7q79mw545v.wasm":"System.ObjectModel.wasm","System.Private.CoreLib.p01w1sybmx.wasm":"System.Private.CoreLib.wasm","System.Private.Uri.4o2ojye61w.wasm":"System.Private.Uri.wasm","System.Private.Xml.Linq.trt4nj2tpp.wasm":"System.Private.Xml.Linq.wasm","System.Private.Xml.fx4cl1bai1.wasm":"System.Private.Xml.wasm","System.Runtime.InteropServices.JavaScript.yoksv99ly5.wasm":"System.Runtime.InteropServices.JavaScript.wasm","System.Text.RegularExpressions.jeufitb0vn.wasm":"System.Text.RegularExpressions.wasm","System.m0fu6d0eya.wasm":"System.wasm","System.Xml.Linq.qsgzs1hc1j.wasm":"System.Xml.Linq.wasm","Walnut.u75jh9o819.wasm":"Walnut.wasm","dotnet.native.349ud2l9o5.js":"dotnet.native.js","dotnet.native.1m7zpjvglu.wasm":"dotnet.native.wasm","dotnet.js":"dotnet.js","dotnet.runtime.st3wwc8rqy.js":"dotnet.runtime.js","icudt_CJK.tjcz0u77k5.dat":"icudt_CJK.dat","icudt_EFIGS.tptq2av103.dat":"icudt_EFIGS.dat","icudt_no_CJK.lfu7j35m59.dat":"icudt_no_CJK.dat"},jsModuleNative:{"dotnet.native.349ud2l9o5.js":"sha256-XXFP8ueCRZ/9neduBaSJOons2XLlYXa2NlP5FnhUKNQ="},jsModuleRuntime:{"dotnet.runtime.st3wwc8rqy.js":"sha256-oBRKHAqZUsvCRnCzkQfB7zc45cpKLNq2NKyrG10IKx8="},wasmNative:{"dotnet.native.1m7zpjvglu.wasm":"sha256-SeYXztl9ztFuzCJUoLlFf/EtB8wHKOelu6wAJ3/gi+w="},icu:{"icudt_CJK.tjcz0u77k5.dat":"sha256-SZLtQnRc0JkwqHab0VUVP7T3uBPSeYzxzDnpxPpUnHk=","icudt_EFIGS.tptq2av103.dat":"sha256-8fItetYY8kQ0ww6oxwTLiT3oXlBwHKumbeP2pRF4yTc=","icudt_no_CJK.lfu7j35m59.dat":"sha256-L7sV7NEYP37/Qr2FPCePo5cJqRgTXRwGHuwF5Q+0Nfs="},coreAssembly:{"System.Private.CoreLib.p01w1sybmx.wasm":"sha256-18HeJL9OcGuyT9IVV5fEjllvMuAKwWG5goaCYZJDU6A=","System.Runtime.InteropServices.JavaScript.yoksv99ly5.wasm":"sha256-PpVo+nXFFVzcQmMcwj3t/pX3t8Gc+Y2rLawKTqz0jn8="},assembly:{"DocumentFormat.OpenXml.Framework.zzrbdxy160.wasm":"sha256-gewmYP6VBCfFJUjxGAmejSGxmz8pJfGHQf0NgrM6MZU=","DocumentFormat.OpenXml.9kx12hc5a3.wasm":"sha256-13lkooL5OK24XESOo9Cmv20rnNku0r0tWucBcL1Ljqw=","Google.Protobuf.ymcrlw7ls4.wasm":"sha256-ut3yq+p97V1SbQ9Zc0baUM07p9J1xZIfW02l4S3Vp5M=","System.Collections.Concurrent.q7k9997daq.wasm":"sha256-luuh8QlNVgtYEcAi6N+VXZUjrLjK5Mohr7YV2Qo44KI=","System.Collections.NonGeneric.e29je1lh17.wasm":"sha256-Wkm1IwLgktv0ufFAqQ2dmijAlJQmf+Fp4FmTlgILYXk=","System.Collections.Specialized.za90e6uca4.wasm":"sha256-5UpgSBxjmzatkMdip0WZHB3ZJJsd+zea3niJtfK/Xco=","System.Collections.l48alw8ik0.wasm":"sha256-pfzSuOk29FRrZOX567k+jaeA3dH92A/XVM7vtYtGhXg=","System.ComponentModel.Primitives.o70rgbr7as.wasm":"sha256-LDo5YlVF1j7HX6cIR9g2sO5xXkPw31mtOO8S6NnbqJc=","System.ComponentModel.TypeConverter.83539jv8ad.wasm":"sha256-fP45xSdHQOHnnNgF9GAkhkSdiLDsVHb3T/01W4ytVW8=","System.ComponentModel.0n5errmvx8.wasm":"sha256-DHujPeYswdt0JOBw03JC11hmqQ+Vtb1K9fkbgtDLtTM=","System.Diagnostics.DiagnosticSource.g8ajmpm5cd.wasm":"sha256-cMsx1BaqBdShCb2hCIIcg1cu8DpCR6mybVTUh61tCWM=","System.IO.Compression.y5glqpjnb8.wasm":"sha256-6mwr7Ug6Xh7nYE5sSoUjQtV7ehgyUiTuL+IETvfEL4U=","System.IO.Packaging.8th4tkd3a0.wasm":"sha256-1C+I5A7ESuL28X57RP+FiTL8ayuTe86SmJE6NSg4dQA=","System.Linq.Expressions.biujz7ou20.wasm":"sha256-M6AwJILP8bI0CD1p7jb1rT7DBE2E2SxUNiT+AArcV/A=","System.Linq.6btt3su4oy.wasm":"sha256-ouzI51Ta1wlktuj2h6VgfMn7RDDjWweSZ7nHHHRnV8k=","System.Memory.m6pzfzg6nf.wasm":"sha256-PsWHMVtxDG4tlLs5Ehnac6R7c/P12MhR2Hkn8UhYqfY=","System.Net.Http.5n712yykv5.wasm":"sha256-8QauHTjEWUMCHnUrtqi7oyjYh442Ih49nJaVLCyUNck=","System.Net.Primitives.0h7y3g6nqf.wasm":"sha256-rGIYM/g7mFHB4tUKXxzKAMTdeOGYJ8NmnYQ66r9vFwE=","System.ObjectModel.7q79mw545v.wasm":"sha256-XzW0DP5J4D5HhpBC9+IEXalmi7K0txtxRQRQloOFshI=","System.Private.Uri.4o2ojye61w.wasm":"sha256-fMF0tbuaB2aa9IXoBrucZrpL8wgrIr9KleX8BZeFpHE=","System.Private.Xml.Linq.trt4nj2tpp.wasm":"sha256-R42st1IgbrLRA1kwuI/YvAOjfn0pqcO7Y/eQZbtn1gg=","System.Private.Xml.fx4cl1bai1.wasm":"sha256-86zH8VBnIMhKsGkh8VEmfC3+Vm0QGzPiHxheWBPJLQQ=","System.Text.RegularExpressions.jeufitb0vn.wasm":"sha256-VSLyK4otYaCqpu8GYBmxEYokWbrAs9m/DliyakK7KMU=","System.m0fu6d0eya.wasm":"sha256-hkGLo/MuT/FJ0Xf4XUL0D2VA4dZV532GHNB1JicxLko=","System.Xml.Linq.qsgzs1hc1j.wasm":"sha256-yo+J3RWIIHIiwAhqsR9JizNkH/+hd3auB44RBmvvLoI=","Walnut.u75jh9o819.wasm":"sha256-1mn+BQUWdJi7VJm8/4GtlNyGXqc+zoIgl8EZ8bgguxg="}},Tc=0,Ec=!0,$c="sharded",Pc={mainAssemblyName:Nc,resources:Mc,debugLevel:Tc,linkerEnabled:Ec,globalizationMode:$c};let rs=null;async function Ac(){const t=await Tl.withConfig(Pc).withResourceLoader((s,a,r,o)=>s==="dotnetjs"?r:new URL(r,location.href).origin!==location.origin?fetch(r,{credentials:"omit",integrity:o}):r).create(),e=t.getConfig().mainAssemblyName;return e?t.getAssemblyExports(e):null}function Lc(){return f.useMemo(()=>(rs||(rs=Ac()),rs),[])}const Ic=Ia(()=>Fs(()=>import("./k0gobvgjs4pf35pv.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])).then(t=>t.WalnutMiniPlayer)),Rc=({citation:t,clientThreadId:e,messageId:s})=>{var z,X,H,Z,fe;const a=Lc(),[r,o]=f.useState(!1),[i,l]=f.useState(null),[c,d]=f.useState(!1),u=!!((X=(z=f.useContext(Ce))==null?void 0:z.message.metadata)!=null&&X.is_standalone_share_attachment),m=Ei(),{presentationMap:b,updatePresentationMap:y,open:v}=El(),g=J(),j=st(e),_=K(g,"3154019201")&&!!j,N=K(g,"638971034"),k=$i(g,"2888003541").value,h=Number((H=k==null?void 0:k.max_bytes)!=null?H:3e7),w=at(),S=f.useRef(null),p=f.useCallback(ne=>{w.danger(ne,{toastId:"w_failed_to_download_file"})},[w]),C=!!t.file_id,M=Bs(!1,e,t.file_id,()=>{},p),E=(Z=b[t.file_id])==null?void 0:Z.presentation,T=(fe=b[t.file_id])==null?void 0:fe.workbook,L=f.useCallback(async ne=>{if(e!==void 0){ne.preventDefault();const{data:Q}=await M.refetch();if(Q===void 0||(Q==null?void 0:Q.status)!=="success"){w.danger("Failed to download file");return}const ee=document.createElement("a");ee.href=Q.download_url,ee.click()}},[e,M,w]),{refetch:I}=M,$=pt();f.useEffect(()=>{var Q;(Q=S.current)==null||Q.abort();const ne=new AbortController;return S.current=ne,o(!0),(async()=>{var ie;let ee=!1;try{const{data:te}=await I();if(te===void 0||(te==null?void 0:te.status)!=="success"){w.danger("Failed to download file");return}const ae=await fetch(te.download_url,{headers:$?{}:Ds(),signal:ne.signal});if(!ae.ok)throw new Error("HTTP ".concat(ae.status));const le=await ae.blob();if(h!==0&&le.size>h){d(!0),l("fileTooLarge"),ee=!0;return}const re=new Uint8Array(await le.arrayBuffer()),he=(ie=an(t.file_name))!=null?ie:"pptx";if(he==="pptx"){let me;if(N)me=await mn(re,he);else{const be=await a;if(!be)return;me=be.PptxReader.ExtractSlidesProto(re,!1)}const Me=$l.decode(me);y(t.file_id,{fileBlob:le,fileName:t.file_name,presentation:Me,workbook:null,document:null,selectedSlideIdx:0,selectedSheetIdx:0})}else{let me;if(N)me=await mn(re,he);else{const be=await a;if(!be)return;me=be.XlsxReader.ExtractXlsxProto(re,!1)}const Me=Pl.decode(me);y(t.file_id,{fileBlob:le,fileName:t.file_name,presentation:null,workbook:Me,document:null,selectedSlideIdx:0,selectedSheetIdx:0})}}catch(te){te.name!=="AbortError"&&(d(!0),rt.addError(te,{file_id:t.file_id}))}finally{o(!1),m&&!ee&&v(t.file_id)}})(),()=>{var ee;(ee=S.current)==null||ee.abort()}},[I,w,y,t.file_name,t.file_id,m,v,h,$,a,N]);function x(ne){ne.preventDefault(),v(t.file_id)}const{onClick:R,isLoading:F,isEnabled:q}=Ga({clientThreadId:e,messageId:s,fileId:t.file_id,fileName:t.file_name,processedMarkdownInfo:null,isStandaloneAttachment:!0}),G=u&&!m,B=an(t.file_name);return n.jsxs("div",{className:P("border-token-border-light flex max-w-[calc(0.8*var(--thread-content-max-width,40rem))] flex-col overflow-hidden rounded-lg border",u&&"mx-auto my-0"),children:[n.jsxs("div",{className:"text-token-text-secondary border-token-border-light flex flex-row justify-between gap-4 border-b p-2",children:[n.jsxs("div",{className:"flex flex-row items-center gap-2 overflow-hidden",children:[n.jsx(Cl,{fileName:t.file_name}),n.jsx("div",{className:"truncate text-sm font-medium",children:B==="pptx"?n.jsx(D,{id:"HTIcmf",defaultMessage:"Presentation"}):n.jsx(D,{id:"pftlup",defaultMessage:"Spreadsheet"})})]}),n.jsxs("div",{className:"text-token-text-tertiary flex flex-row items-center",children:[!G&&n.jsxs(n.Fragment,{children:[C&&n.jsx("button",{className:"hover:text-token-text-secondary hover:bg-token-bg-tertiary rounded-full p-1",onClick:L,children:n.jsx(gs,{})}),n.jsx("button",{className:"hover:text-token-text-secondary hover:bg-token-bg-tertiary disabled:text-token-text-tertiary rounded-full p-1 disabled:cursor-not-allowed disabled:bg-transparent",disabled:!E&&!T,onClick:x,children:n.jsx(Ml,{})})]}),_&&!!s&&q&&n.jsx("button",{className:"hover:text-token-text-secondary hover:bg-token-bg-tertiary rounded-full p-1",disabled:!q,onClick:R,children:F?n.jsx(xt,{}):n.jsx(Dc,{})})]})]}),n.jsxs("div",{className:"bg-token-bg-secondary group relative p-2",children:[n.jsx(Ic,{walnutId:t.file_id,isLoading:r,isError:c,isInShareModal:G,errorMessage:i,handleDownloadClick:L}),G&&n.jsx("div",{className:"absolute end-5 top-46 z-10 inline-flex flex-shrink-0 items-end justify-end",children:n.jsx(eo,{className:P("inline h-4 w-24 text-end")})})]})]})},Dc=({className:t})=>n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",className:t,children:[n.jsx("path",{d:"M3 12.4428V12.2806C3 11.9219 3.2843 11.631 3.63497 11.631C3.98563 11.631 4.26993 11.9219 4.26993 12.2806V12.4428C4.26993 13.1372 4.2708 13.6193 4.3007 13.994C4.33 14.3609 4.38426 14.5675 4.46108 14.7218L4.52821 14.8459C4.69655 15.1266 4.93812 15.3556 5.22657 15.5061L5.35059 15.5604C5.48786 15.6107 5.6688 15.6476 5.938 15.6701C6.30417 15.7008 6.77519 15.7007 7.45408 15.7007H12.546C13.2246 15.7007 13.6959 15.7008 14.0621 15.6701C14.4204 15.6402 14.6226 15.5846 14.7735 15.5061L14.8946 15.4364C15.169 15.2642 15.3929 15.0169 15.5399 14.7218L15.593 14.595C15.6421 14.4546 15.6782 14.2692 15.7003 13.994C15.7301 13.6193 15.73 13.1372 15.73 12.4428V12.2806C15.73 11.922 16.0145 11.6312 16.3651 11.631C16.7157 11.631 17 11.9219 17 12.2806V12.4428C17 13.1158 17.0006 13.6601 16.9655 14.0999C16.9342 14.4916 16.8722 14.8443 16.7343 15.1731L16.6709 15.3123C16.4174 15.8213 16.0318 16.2469 15.5585 16.544L15.3506 16.6632C14.9909 16.8507 14.6028 16.9281 14.1655 16.9646C13.7356 17.0006 13.2038 17 12.546 17H7.45408C6.79615 17 6.26438 17.0006 5.8345 16.9646C5.45207 16.9327 5.10749 16.8699 4.78649 16.729L4.65035 16.6632C4.1528 16.4038 3.73604 16.0094 3.44569 15.5251L3.32914 15.3123C3.14585 14.9444 3.07023 14.5473 3.03451 14.0999C2.9994 13.6601 3 13.1158 3 12.4428Z"}),n.jsx("path",{d:"M9.99993 13.2544C10.3505 13.2544 10.6348 12.9635 10.6348 12.6047V5.218L12.7337 7.36545L12.8335 7.44845C13.0799 7.61506 13.4146 7.58749 13.6316 7.36545C13.8486 7.14342 13.8756 6.80101 13.7127 6.54884L13.6316 6.44677L10.4493 3.19088C10.3302 3.06897 10.1683 3 9.99993 3C9.8316 3.0001 9.67044 3.06906 9.55138 3.19088L6.36815 6.44677C6.12048 6.70037 6.12057 7.11179 6.36815 7.36545C6.58526 7.58755 6.92077 7.61523 7.1673 7.44845L7.26707 7.36545L9.36491 5.21897V12.6047C9.36491 12.9634 9.64934 13.2542 9.99993 13.2544Z"})]}),Fc=new Set(["jpg","jpeg","png","gif","webp","svg"]),Oc=t=>{const e=t.split(".").pop();return e?Fc.has(e):!1};function zc({citation:t,clientThreadId:e,messageId:s}){var l;const a=Pi(),r=Ai(),o=f.useRef(a!==nn.Research);f.useEffect(()=>{!o.current&&a===nn.Research&&(o.current=!0,r(null))},[a,r]);const i=J();return Nl(t.file_name)&&K(i,"3392860057")?n.jsx(Rc,{citation:t,clientThreadId:e,messageId:s,children:(l=t.label)!=null?l:t.file_name}):Sc(t.file_name)?n.jsx(Cc,{citation:t,clientThreadId:e,messageId:s}):n.jsx(Bc,{citation:t,clientThreadId:e,messageId:s})}function Bc({citation:t,clientThreadId:e}){var i,l;const s=st(e),a=at(),r=f.useCallback(c=>{a.danger(c,{toastId:"fcoa_renderer_failed_to_download_file"})},[a]),{data:o}=Bs(!0,s,t.file_id,void 0,r);return Oc(t.file_name)&&(o!=null&&o.download_url)?n.jsx("img",{src:o==null?void 0:o.download_url,alt:(i=t.label)!=null?i:t.file_name,className:"max-h-[350px] max-w-screen"}):n.jsx("a",{href:o==null?void 0:o.download_url,children:(l=t.label)!=null?l:t.file_name})}function Wc({citationIndex:t,clientThreadId:e,nodeType:s,messageId:a}){var l;const r=parseInt(t,10),o=f.useContext(Ce);if(!o)return null;const i=(l=o.n7jupdCrefs)==null?void 0:l[r];if(!i)return null;switch(i.type){case"clipboard":return n.jsx(_c,{citation:i});case"computer_output":return n.jsx(jc,{citation:i,clientThreadId:e,nodeType:s});case"file":return n.jsx(zc,{citation:i,clientThreadId:e,messageId:a});case"invalid":return null}}function Hc({path:t,lineRangeStart:e,lineRangeEnd:s,gitUrl:a}){const[r,o]=f.useState(!1),i=f.useContext(Xt),l=f.useRef(null),c=f.useRef(null),d=f.useRef(null),u=()=>{d.current&&(clearTimeout(d.current),d.current=null),o(!0)},m=()=>{d.current=window.setTimeout(()=>{o(!1)},200)};if(!t)return null;const b=i==null?void 0:i.fileSnapshots.find(v=>v.path===t);if(!b)return null;const y=qc(e,s,b);return y.length?n.jsxs(Ms,{open:r,onOpenChange:o,children:[n.jsx(Ts,{asChild:!0,onMouseEnter:u,onMouseLeave:m,children:n.jsx("span",{ref:l,className:"bg-token-bg-secondary text-token-text-secondary mx-0.5 inline-flex aspect-square size-min cursor-default items-center justify-center rounded-full p-1",children:n.jsx(Fl,{className:"size-[10px]"})})}),n.jsx(Es,{children:n.jsx($s,{ref:c,className:"z-50 focus:outline-none",side:"right",onMouseEnter:u,onMouseLeave:m,onOpenAutoFocus:v=>v.preventDefault(),children:n.jsx(Uc,{snapshot:b,snippetLines:y,lineRangeStart:e,lineRangeEnd:s,gitUrl:a})})})]}):null}function Uc({snapshot:t,snippetLines:e,lineRangeStart:s,lineRangeEnd:a,gitUrl:r}){var c;const o=(c=t.path.split(".").pop())!=null?c:"sh",i=e.reduce((d,u)=>{if(u.trim()==="")return d;const m=u.match(/^\s*/),b=m?m[0].length:0;return d===-1?b:Math.min(d,b)},-1),l=e.map(d=>i>0?d.slice(i):d).join("\n");return n.jsxs("div",{className:"bg-token-bg-primary border-token-border-default mx-4 flex max-h-[600px] flex-col rounded-2xl border px-2 pt-2 pb-4 shadow-[0px_4px_16px_0px_rgba(0,0,0,0.05)] focus:outline-none dark:shadow-none",children:[l&&n.jsx(to,{wrapperClassName:"rounded-lg !bg-token-bg-tertiary !border-none mb-3 max-h-[400px] overflow-auto text-xs w-[600px] max-w-full",codeContainerClassName:"!p-2",language:o,content:l,showActionBar:!1}),n.jsxs("div",{className:"grid w-full grid-cols-[minmax(0,1fr)_auto] items-center justify-between gap-1 px-2 text-sm",children:[t.path,n.jsxs("div",{className:"text-token-text-tertiary flex items-center gap-1 whitespace-nowrap",children:[n.jsx(D,{id:"wham.citation.file.lineRange",defaultMessage:"Lines {lineRangeStart}-{lineRangeEnd}",values:{lineRangeStart:s,lineRangeEnd:a}}),r&&n.jsx("a",{className:"group flex w-full items-center gap-1 p-1",href:r,target:"_blank",rel:"noopener noreferrer",children:n.jsx(Li,{className:"icon-xs hover:text-token-text-primary"})})]})]})]})}function qc(t,e,s){var i;if(s.contents){const l=s.contents.split("\n"),c=Math.max(0,t-1),d=e?Math.min(l.length,e):c+1;return l.slice(c,d)}const a=(i=s.line_range_contents)==null?void 0:i.find(l=>Gc(l,t,e));if(!a)return[];const r=Math.max(t-a.line_range_start,0),o=r+(e-t+1);return a.content.slice(r,o)}function Gc(t,e,s){return e<t.line_range_start?!1:!(s>t.line_range_end)}function Vc({assetPointer:t}){var i,l,c,d,u;const e=f.useContext(Xt),s=W(),a=e==null?void 0:e.imagePointers.find(m=>m.asset_pointer===t),r=ja({asset:{content_type:Ra.ImageAssetPointer,asset_pointer:(i=a==null?void 0:a.asset_pointer)!=null?i:"",size_bytes:(l=a==null?void 0:a.size_bytes)!=null?l:0,width:(c=a==null?void 0:a.width)!=null?c:0,height:(d=a==null?void 0:a.height)!=null?d:0}});if(!a||!((u=r.data)!=null&&u.url))return null;const o=s.formatMessage({id:"wham.contentReference.imageAlt",defaultMessage:"Captured screenshot"});return n.jsx(so,{src:r.data.url,alt:o,className:"max-h-[250px] max-w-[250px]",children:n.jsx(no,{src:r.data.url,alt:o,width:a.width,height:a.height,className:"max-h-[250px] max-w-[250px] object-contain"})})}function Yc(){const t=Da.getItem(Fa.ProposedTasks);return t&&typeof t=="object"?t:{}}const fn=Ii(t=>({tasks:Yc(),store(e){t(s=>{const a=O(A({},s.tasks),{[e.contentId]:e});return Da.setItem(Fa.ProposedTasks,a),{tasks:a}})}}));function Xc({title:t,prompt:e,environmentId:s,branch:a,contentId:r,hasHitRateLimit:o}){const[i,l]=f.useState(!1),c=Ri(),{setEnvironmentId:d,setBranch:u}=Ua(),{refetch:m}=zl(),b=W(),y=at(),v=fn(h=>h.tasks[r]),g=fn(h=>h.store),{mutate:j,isPending:_}=ha({mutationFn:()=>Bl.createNewTask(s,a,e,!1).catch(h=>{throw y.danger({id:"wham.whamComposer.failedToCreateTask",defaultMessage:"Failed to create task",description:"Toast text shown when a task failed to create."},{id:"suggestion-".concat(r),duration:5,hasCloseButton:!0,toastId:"wham_proposed_task_failed_to_create_task"}),h}),onSuccess:async h=>{await m(),N(h)}}),N=h=>{try{const w=h.task.id,S=h.turn.id,p="/codex/tasks/".concat(w);g({contentId:r,prompt:e,scheduledTaskId:w,turnId:S,url:p}),l(!1)}catch(w){}},k=!s||!a||_||o;return n.jsxs("div",{className:P("mt-1 mb-3 flex w-full items-center rounded-xl px-3 py-3",v?"bg-token-bg-secondary border border-transparent":"bg-token-bg-primary border-token-border-default border shadow-[0px_1px_1px_0px_rgba(0,0,0,0.05)]"),children:[n.jsxs("div",{className:P("group flex flex-1 items-center gap-1",!v&&"-my-3 py-3",!v&&!k&&"cursor-pointer"),onClick:()=>{k||v||(d(s),u(a),l(!0),rn.recordProposedTaskClicked("edit"))},children:[n.jsxs("div",{className:"flex flex-col gap-0.5",children:[n.jsx("span",{className:"text-token-text-tertiary text-xs",children:n.jsx(D,{id:"wham.whamProposedTask.title",defaultMessage:"Suggested task"})}),n.jsx("span",{className:P("text-sm font-medium",v&&"text-token-text-tertiary"),children:t})]}),!k&&!v&&n.jsx(ao,{className:"icon-sm text-token-text-secondary mb-0.5 cursor-pointer self-end opacity-0 transition-opacity group-hover:opacity-100"})]}),n.jsx("div",{className:"flex items-center justify-end gap-2 text-xs",children:v?n.jsx(xe,{size:"small",color:"secondary",as:"a",to:v==null?void 0:v.url,openNewTab:!0,children:n.jsx("span",{className:"text-token-text-primary font-medium",children:n.jsx(D,{id:"lwqFNG",defaultMessage:"View task"})})}):n.jsx(Zc,{prompt:o?b.formatMessage({id:"wham.proposedTask.hitRateLimit",defaultMessage:"You have reached your rate limit"}):e,tooltipEnabled:!v&&!i,children:n.jsx(xe,{size:"small",color:"secondary",disabled:k,onClick:()=>{rn.recordProposedTaskClicked("create"),j()},children:n.jsxs("div",{className:"flex items-center gap-0.5",children:[n.jsx(D,{id:"b2N2Y8",defaultMessage:"Start task"}),_?n.jsx(xt,{className:"icon-xs me-[2px]"}):n.jsx(ro,{className:"icon-sm"})]})})})}),n.jsx(Re.Root,{testId:"modal-task-stub-composer",isOpen:i,onClose:()=>l(!1),children:n.jsx(Re.Overlay,{children:n.jsxs(Re.Content,{className:"flex max-w-3xl! items-center justify-center px-12 py-4 focus:outline-hidden",size:"normal",removeBackground:!0,onEscapeKeyDown:h=>{h.stopPropagation(),l(!1)},children:[n.jsxs(Di,{children:[n.jsx(Fi,{children:n.jsx(D,{id:"wham.proposedTaskModel.title",defaultMessage:"Kick off a new Codex task"})}),n.jsx(Oi,{children:n.jsx(D,{id:"wham.proposedTaskModel.description",defaultMessage:"Codex can propose new follow up tasks"})})]}),n.jsx(Dt.div,{initial:{opacity:0,translateY:20},animate:{opacity:1,translateY:0},transition:{duration:c?0:.25},className:"w-full",children:n.jsxs("div",{className:"flex flex-col items-center gap-8",children:[n.jsx("h1",{className:"text-token-text-primary dark text-[28px] font-semibold",children:n.jsx(D,{id:"wham.proposedTaskModal.title",defaultMessage:"Edit suggested task"})}),n.jsx(Kc,{prompt:e,onSuccess:N})]})})]})})})]})}function Zc({prompt:t,tooltipEnabled:e,children:s}){return e?n.jsx(Le,{side:"right",label:n.jsx("span",{className:"block p-2 text-start whitespace-pre-wrap",children:t}),wide:!0,children:s}):s}function Kc({prompt:t,onSuccess:e}){const{composerController:s}=Wl();return f.useEffect(()=>{zi(Bi(s),t.trimEnd())},[s,t]),n.jsx(Wi.Provider,{value:s,children:n.jsx(Ol,{isBigBoxMode:!0,expanded:!0,disableDuringSubmit:!0,onSuccess:e})})}function Jc({title:t,prompt:e}){const s=f.useContext(Xt),a=Ua(o=>{var i;return((i=o.getRateLimit())==null?void 0:i.remaining)===0}),r=f.useMemo(()=>Qc("".concat(s==null?void 0:s.taskId,":").concat(t,":").concat(e)),[s==null?void 0:s.taskId,t,e]);return!s||!s.environmentId||!s.branch?null:n.jsx(Xc,{title:t,prompt:e,environmentId:s.environmentId,branch:s.branch,contentId:r,hasHitRateLimit:a})}function Qc(t){let e=5381;for(let s=0;s<t.length;s++)e=(e<<5)+e^t.charCodeAt(s);return(e>>>0).toString(16).padStart(8,"0")}function ed({chunkId:t,lineRangeStart:e,lineRangeEnd:s}){const[a,r]=f.useState(!1),o=f.useContext(Xt),i=o==null?void 0:o.terminalMessageContents.find(v=>v.includes(t)),l=f.useRef(null),c=f.useRef(null),d=f.useRef(null);if(!i)return null;const u=sd(i);if(!u)return null;const m=u.output.slice(e-1,s);if(!m.some(v=>!!v.length))return null;const b=()=>{d.current&&(clearTimeout(d.current),d.current=null),r(!0)},y=()=>{d.current=window.setTimeout(()=>{r(!1)},200)};return n.jsxs(Ms,{open:a,onOpenChange:r,children:[n.jsx(Ts,{asChild:!0,onMouseEnter:b,onMouseLeave:y,children:n.jsx("span",{ref:l,className:"bg-token-bg-secondary text-token-text-secondary mx-0.5 inline-flex aspect-square size-min cursor-default items-center justify-center rounded-full p-1",children:n.jsx(oo,{className:"size-[10px]"})})}),n.jsx(Es,{children:n.jsx($s,{ref:c,className:"z-50 focus:outline-none",side:"right",onMouseEnter:b,onMouseLeave:y,onOpenAutoFocus:v=>v.preventDefault(),children:n.jsx("div",{className:"max-h-[500px] max-w-screen px-4",children:n.jsx(td,{lines:m,lineRangeStart:e,lineRangeEnd:s})})})})]})}function td({lines:t,lineRangeStart:e,lineRangeEnd:s}){return n.jsxs("div",{className:"bg-token-bg-primary border-token-border-default mx-4 flex flex-col overflow-auto rounded-2xl border px-2 pt-2 pb-3 shadow-[0px_4px_16px_0px_rgba(0,0,0,0.05)] focus:outline-none dark:shadow-none",children:[n.jsx(Hl,{className:"bg-token-sidebar-surface-primary dark mb-2.5 max-h-[200px] w-full overflow-auto rounded-lg p-3 font-mono text-xs whitespace-pre text-white dark:border dark:border-white/10",children:t.join("\n")}),n.jsx("div",{className:"flex w-full justify-end gap-1 px-2 text-sm",children:n.jsx("span",{className:"text-token-text-tertiary",children:n.jsx(D,{id:"wham.citation.terminal.lineRange",defaultMessage:"Lines {lineRangeStart}-{lineRangeEnd}",values:{lineRangeStart:e,lineRangeEnd:s}})})})]})}function sd(t){try{const e=JSON.parse(t);return!("chunk_id"in e)||typeof e.chunk_id!="string"||!("session_name"in e)||typeof e.session_name!="string"||!("start_line_no"in e)||typeof e.start_line_no!="number"?null:"output"in e?e:null}catch(e){return null}}var Ft=(t=>(t.STANDARD="standard",t.EMAIL="email",t.CREATIVE="creative",t.CHAT_MESSAGE="chat_message",t.SOCIAL_POST="social_post",t.UNKNOWN="unknown",t))(Ft||{});function nd(t){return Object.values(Ft).includes(t)?t:"unknown"}const ws=["group my-4 w-full overflow-visible rounded-3xl","bg-token-bg-primary","dark:bg-[#2a2a2a]","shadow-[inset_0px_0px_0px_1px_rgba(0,0,0,0.08),0px_8px_480px_rgba(0,0,0,0.04)]","hover:shadow-[inset_0px_0px_0px_1px_rgba(0,0,0,0.16),0px_8px_480px_rgba(0,0,0,0.04)]","focus-within:shadow-[inset_0px_0px_0px_1px_rgba(0,0,0,0.24),0px_8px_480px_rgba(0,0,0,0.04)]","hover:focus-within:shadow-[inset_0px_0px_0px_1px_rgba(0,0,0,0.24),0px_8px_480px_rgba(0,0,0,0.04)]","dark:shadow-[inset_0px_0px_0px_1px_rgba(255,255,255,0.04)]","dark:hover:shadow-[inset_0px_0px_0px_1px_rgba(255,255,255,0.10)]","dark:focus-within:shadow-[inset_0px_0px_0px_1px_rgba(255,255,255,0.16)]","dark:hover:focus-within:shadow-[inset_0px_0px_0px_1px_rgba(255,255,255,0.16)]","dark:hover:bg-[#2a2a2a]","dark:focus-within:bg-[#2a2a2a]","dark:hover:focus-within:bg-[#2a2a2a]"].join(" "),ad="bg-token-bg-primary/90 dark:bg-[#2a2a2a]/90 group-hover:bg-token-bg-primary/90 dark:group-hover:bg-[#2a2a2a]/90 group-focus-within:bg-token-bg-primary/90 dark:group-focus-within:bg-[#2a2a2a]/90 group-hover:group-focus-within:bg-token-bg-primary/90 dark:group-hover:group-focus-within:bg-[#2a2a2a]/90",hn="placeholder:text-token-text-tertiary min-w-0 flex-1 shrink-0 truncate border-none bg-transparent focus:border-transparent focus:ring-0 focus:outline-hidden",Hs="text-sm font-medium";function rd({content:t,subject:e,recipient:s,clientThreadId:a,messageId:r}){const o=W(),i=()=>{$e.logEventWithStatsig("ChatGPT Writing Block Email Send Button Clicked","chatgpt_writing_block_email_send_button_clicked",A({},bt({clientThreadId:a,messageId:r})));const c=encodeURIComponent(e),d=encodeURIComponent(io(t));window.open("mailto:".concat(s,"?subject=").concat(c,"&body=").concat(d),"_blank")},l=!gt();return n.jsx("button",{className:P("text-token-text-secondary dark:text-token-text-tertiary dark:hover:text-token-text-primary hover:text-token-text-primary px-2 py-2",Hs,"font-normal"),"aria-label":o.formatMessage({id:"5fZEc+",defaultMessage:"Open in email"}),onClick:i,children:l?n.jsx(Le,{label:n.jsx(D,{id:"EmailSendButton.tooltip",defaultMessage:"Open in email"}),children:n.jsx(sn,{className:"icon-md"})}):n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(sn,{className:"icon-md"}),n.jsx(D,{id:"EmailSendButton.tooltip",defaultMessage:"Open in email"})]})})}const od=({markdown:t,onChange:e,isDisabled:s,className:a,maxLength:r,setDirty:o,flushPendingChanges:i})=>{"use forget";const l=Ws(e,300),c=f.useRef(null),d=f.useRef(t),u=f.useRef(s),m=f.useMemo(()=>/\[[^\[\]]+\]/g,[]),b="[data-placeholder-token]",y=f.useMemo(()=>/^\[[^\[\]]+\]$/,[]),v=f.useCallback(C=>{if(C.querySelectorAll(b).forEach(I=>{const $=I.parentNode;if($){for(;I.firstChild;)$.insertBefore(I.firstChild,I);$.removeChild(I)}}),s)return;const E=document.createTreeWalker(C,NodeFilter.SHOW_TEXT),T=[];let L=E.nextNode();for(;L;)L.textContent&&m.test(L.textContent)&&T.push(L),m.lastIndex=0,L=E.nextNode();T.forEach(I=>{var q,G;const $=(q=I.textContent)!=null?q:"";m.lastIndex=0;const x=$.matchAll(m),R=document.createDocumentFragment();let F=0;for(const B of x){const z=(G=B.index)!=null?G:-1;if(z<0)continue;const X=B[0];z>F&&R.append($.slice(F,z));const H=document.createElement("span");H.textContent=X,H.dataset.placeholderToken="true",H.className="text-token-text-primary cursor-text",H.style.backgroundColor="color-mix(in srgb, var(--selection) 20%, transparent)",H.style.paddingTop="4px",H.style.paddingBottom="4px",R.append(H),F=z+X.length}F<$.length&&R.append($.slice(F)),I.replaceWith(R)})},[m,s]),g=f.useCallback(C=>{C.querySelectorAll(b).forEach(E=>{var L;const T=(L=E.textContent)!=null?L:"";if(!y.test(T)){const I=E.parentNode;if(!I)return;for(;E.firstChild;)I.insertBefore(E.firstChild,E);I.removeChild(E)}})},[y]),j=f.useMemo(()=>{const C=new lo({codeBlockStyle:"fenced",headingStyle:"atx",bulletListMarker:"-"});return C.use(co),C},[]),_=f.useCallback(async C=>{const M=await uo().use(mo).use(fo,{singleTilde:!1}).use(Ar).use(ho).use(po).use(Lr).use(Ir).use(xo).use(Rr).process(C!=null?C:"");return String(M)},[]);f.useEffect(()=>{if(!c.current)return;const C=c.current,M=C.innerHTML.trim()!=="",E=t!==d.current||!M;if(!E&&s===u.current)return;let T=!1;return E?((async()=>{const I=await _(t),$=I.trim()===""?"<p><br></p>":I;!c.current||T||(c.current.innerHTML!==$&&(c.current.innerHTML=$),v(c.current),d.current=t,u.current=s)})(),()=>{T=!0}):(v(C),u.current=s,()=>{T=!0})},[t,_,v,s]);const N=f.useCallback(()=>{const C=c.current;if(!C)return;o(!0),g(C);const M=C.innerHTML,E=j.turndown(M);d.current=E,l({content:E})},[l,j,o,g]),k=()=>{var C,M;return(M=(C=window.getSelection())==null?void 0:C.toString().length)!=null?M:0},h=C=>{const M=window.getSelection();if(M&&M.rangeCount>0){const E=M.getRangeAt(0);E.deleteContents(),E.insertNode(document.createTextNode(C)),E.collapse(!1),M.removeAllRanges(),M.addRange(E)}},w=f.useCallback(C=>{var x,R,F,q,G,B,z,X;const M=C.nativeEvent;if(s||r==null)return;const E=c.current;if(!E||((x=M.inputType)!=null?x:"").startsWith("delete")||((R=M.inputType)!=null?R:"").startsWith("insertComposition"))return;const T=E.innerText.length,L=k();let I=0;if(((F=M.inputType)!=null?F:"")==="insertText"?I=(G=(q=M.data)==null?void 0:q.length)!=null?G:0:((B=M.inputType)!=null?B:"")==="insertParagraph"?I=1:((z=M.inputType)!=null?z:"")==="insertFromPaste"&&(I=0),T-L+I>r){C.preventDefault();const H=r-(T-L);if(H>0&&((X=M.inputType)!=null?X:"")==="insertText"&&M.data){const Z=M.data.slice(0,H);h(Z),N()}}},[s,r,N]),S=f.useCallback(C=>{var $,x;if(s||r==null)return;const M=c.current;if(!M)return;const E=(x=($=C.clipboardData)==null?void 0:$.getData("text/plain"))!=null?x:"",T=M.innerText.length,L=k(),I=r-(T-L);if(I<=0){C.preventDefault();return}if(E.length>I){C.preventDefault();const R=E.slice(0,I);h(R),N()}},[s,r,N]),p=f.useCallback(()=>{l.flush(),i==null||i()},[l,i]);return f.useEffect(()=>{const C=c.current;if(!C)return;const M=E=>{const T=E.target;if(!T)return;const L=T.closest(b);if(!L||!C.contains(L))return;E.preventDefault(),C.focus({preventScroll:!0});const I=window.getSelection();if(!I)return;I.removeAllRanges();const $=document.createRange();$.selectNodeContents(L),I.addRange($)};return C.addEventListener("pointerdown",M),()=>{C.removeEventListener("pointerdown",M)}},[b]),n.jsx("div",{className:"px-4 sm:px-5",children:n.jsx("div",{ref:c,className:P(["markdown","prose","dark:prose-invert","w-full","min-h-6","break-words","focus:outline-none",a]),contentEditable:!s,suppressContentEditableWarning:!0,onBeforeInput:w,onPaste:S,onInput:N,onBlur:p})})},id=2e4,Va=({isInlineWritingBlockEditEnabled:t,writingBlock:e,onChange:s,isStreaming:a,setDirty:r,flushPendingChanges:o})=>n.jsx(od,{setDirty:r,markdown:e.content,onChange:s,isDisabled:a||!t,maxLength:id,flushPendingChanges:o});function ld({content:t,clientThreadId:e,messageId:s}){const a=J(),r=W(),o=at(),[i,l]=f.useState(!1),c=Hi();return{handleCopy:async u=>{if(i)return;$e.logEventWithStatsig("ChatGPT Writing Block Copy Button Clicked","chatgpt_writing_block_copy_button_clicked",A({},bt({clientThreadId:e,messageId:s})));const m=await Ul(t),b=st(e);t!=null&&b!=null&&s!=null&&go(a,{type:"copy",source:"mouse",location:"writing-block",selectedText:m,messageId:s,serverThreadId:b,contentType:"text"});let y={"text/plain":m};try{y=ga(m,[])}catch(v){rt.addError(v)}Ns(y,o,u),l(!0),c(()=>l(!1),2e3)},Icon:i?ka:Sa,copyLabel:r.formatMessage({id:"D5UU6P",defaultMessage:"Copy"})}}function cd(t){"use forget";const e=ge.c(10),{clientThreadId:s,messageId:a,content:r}=t;let o;e[0]!==s||e[1]!==r||e[2]!==a?(o={clientThreadId:s,messageId:a,content:r},e[0]=s,e[1]=r,e[2]=a,e[3]=o):o=e[3];const{handleCopy:i,copyLabel:l}=ld(o),c=!gt();let d,u;e[4]===Symbol.for("react.memo_cache_sentinel")?(d=P("icon-md"),u=P(Hs,"font-normal","px-2 py-2"),e[4]=d,e[5]=u):(d=e[4],u=e[5]);const m=c?void 0:l;let b;return e[6]!==i||e[7]!==c||e[8]!==m?(b=n.jsx(_a,{onCopy:i,iconClassName:d,className:u,iconOnly:c,buttonText:m}),e[6]=i,e[7]=c,e[8]=m,e[9]=b):b=e[9],b}function dd({serverThreadId:t,messageId:e,index:s,title:a}){const r=at(),o=W(),[i,l]=f.useState(!1),c=!gt();if(!t)return null;const d=o.formatMessage({id:"writingblock.downloadFileError",defaultMessage:"Download failed. Please try again."});async function u(m){var b;l(!0);try{const y=await Os.safePost("/export_doc/writing_block",{requestBody:{conversation_id:t,message_id:e,index:s,export_type:m},skipJsonTransform:!0});y.ok||r.danger(d);const v=await y.blob(),g=y.headers.get("Content-Disposition"),j=(b=Gl(g))!=null?b:"".concat((a!=null?a:"Export").replaceAll("/","-"),".").concat(m);ql(v,j)}catch(y){rt.addError(y,{tags:["type:writing_block_download_button","export_type:".concat(m)]}),r.danger(d)}finally{l(!1)}}return n.jsxs(Ee.Root,{children:[n.jsx(Ee.BasicTrigger,{asChild:!0,children:n.jsx("button",{className:"flex items-center gap-1 px-2 py-2 select-none",disabled:i,children:c?i?n.jsx(on,{size:16}):n.jsx(Le,{label:n.jsx(D,{id:"WritingBlockDownloadButton.downloadTooltip",defaultMessage:"Download"}),children:n.jsx(gs,{className:"icon-md block"})}):n.jsxs("div",{className:P("flex items-center gap-1",Hs,"font-normal"),children:[i?n.jsx(on,{size:20}):n.jsx(gs,{className:"icon-md block"}),n.jsx(D,{id:"WritingBlockDownloadButton.downloadTooltip",defaultMessage:"Download"})]})})}),n.jsx(Ee.Portal,{children:n.jsxs(Ee.Content,{align:"end",children:[n.jsx(Ee.Label,{children:n.jsx(D,{id:"WritingBlockDownloadButton.menuTitle",defaultMessage:"Download"})}),n.jsx(Ee.Item,{onSelect:()=>{u("pdf")},icon:bo,label:o.formatMessage({id:"WritingBlockDownloadButton.downloadPdf.label",defaultMessage:"PDF document"}),trailing:n.jsx("span",{children:o.formatMessage({id:"WritingBlockDownloadButton.downloadPdf.ext",defaultMessage:".pdf"})})}),n.jsx(Ee.Item,{onSelect:()=>{u("docx")},icon:Ui,label:o.formatMessage({id:"WritingBlockDownloadButton.downloadDocx.label",defaultMessage:"Microsoft Word"}),trailing:n.jsx("span",{children:o.formatMessage({id:"WritingBlockDownloadButton.downloadDocx.ext",defaultMessage:".docx"})})})]})})]})}function ud({content:t,clientThreadId:e,title:s,messageId:a,messageRef:r}){const o=W(),i=yo(e);function l(){wo.logButtonClick(_o.OPEN_IN_CANVAS_WRITING_BLOCK),r.current&&jo(r.current);const c=ko.DOCUMENT;$e.logEventWithStatsig("ChatGPT Writing Block Edit in Canvas Button Clicked","chatgpt_writing_block_edit_in_canvas_button_clicked",A({},bt({clientThreadId:e,messageId:a}))),i({title:s!=null?s:o.formatMessage({id:"2V9CtJ",defaultMessage:"New document"}),textdocType:c,content:t,createSource:So.MESSAGE_WRITING_BLOCK})}return n.jsx("button",{className:"flex items-center px-1.5 py-1 select-none",onClick:l,children:n.jsx(Le,{label:n.jsx(D,{id:"WritingBlockOpenCanvasButton.openTooltip",defaultMessage:"Edit in Canvas"}),children:n.jsx(vo,{className:"icon-md block"})})})}const Ya=({primaryLabel:t,primaryAction:e,writingBlock:s,clientThreadId:a,messageId:r,isInlineWritingBlockExportEnabled:o,serverThreadId:i,shouldShowWritingBlockCanvasEdit:l,title:c,index:d,messageRef:u,autosaveStatus:m,hideDownloadButton:b=!1})=>{const y=J();K(y,"1600402835");const v=!1;return f.useMemo(()=>"text-token-text-tertiary",[m,v]),n.jsx("div",{className:"thread-xl:-top-[var(--header-height)] sticky top-0 mx-[1px] overflow-hidden rounded-t-[22px] rounded-b-lg backdrop-blur-md",children:n.jsxs("div",{className:P(ad,"flex w-full items-center justify-between gap-3 px-3.5 py-1.5 font-sans sm:ps-4.5 sm:pe-3.5"),children:[n.jsxs("div",{className:"text-token-text-secondary dark:text-token-text-tertiary text-token-text-primary flex max-w-[75%] flex-grow cursor-default items-center gap-2 text-sm",children:[t!=null?t:n.jsx(D,{id:"Ui6xge",defaultMessage:"Writing"}),v]}),n.jsxs("div",{className:"flex items-center justify-between",children:[a&&r&&n.jsx("div",{className:"text-token-text-secondary dark:text-token-text-tertiary dark:hover:text-token-text-primary hover:text-token-text-primary",children:n.jsx(cd,{content:s.content,clientThreadId:a,messageId:r})}),!b&&o&&i&&r&&n.jsx("div",{className:"text-token-text-secondary dark:text-token-text-tertiary dark:hover:text-token-text-primary hover:text-token-text-primary",children:n.jsx(dd,{serverThreadId:i,messageId:r,title:c,index:d})}),a&&r&&l&&n.jsx("div",{className:"text-token-text-secondary dark:text-token-text-tertiary dark:hover:text-token-text-primary hover:text-token-text-primary",children:n.jsx(ud,{content:s.content,clientThreadId:a,messageId:r,title:c,messageRef:u})}),e]})]})})},os={hr:"mx-4 my-0! border-0 border-t !border-token-border-light sm:mx-[1px]"},md=({children:t,hasBeenEdited:e,messageId:s,clientThreadId:a,messageRef:r,shouldShowWritingBlockCanvasEdit:o=!1,isInlineWritingBlockEditEnabled:i,isInlineWritingBlockExportEnabled:l,writingBlock:c,index:d,onChange:u,isStreaming:m,autosaveStatus:b,title:y,recipient:v,setDirty:g,flushPendingChanges:j})=>{var $,x,R;const _=yt(a),[N,k]=f.useState(($=c.title)!=null?$:""),[h,w]=f.useState(String((R=(x=c.metadata)==null?void 0:x.recipient)!=null?R:"")),S=W(),p=Ws(u,300),C=f.useCallback(F=>{g(!0),k(F.target.value),p({title:F.target.value})},[p,g]),M=f.useCallback(F=>{g(!0),w(F.target.value),p({metadata:{recipient:F.target.value}})},[p,g]),E=f.useCallback(F=>{g(!0),p({title:F.target.value}),p.flush(),j==null||j()},[p,j,g]),T=f.useCallback(F=>{g(!0),p({metadata:{recipient:F.target.value}}),p.flush(),j==null||j()},[p,j,g]),L=n.jsx(D,{id:"PrFQxx",defaultMessage:"Email"}),I=n.jsx(rd,{clientThreadId:a,messageId:s,content:c.content,subject:N,recipient:h});return n.jsxs("div",{ref:r,id:"writing-block-".concat(s),className:P(ws,"pt-0.5 pb-3"),"data-writing-block":!0,children:[n.jsx(Ya,{primaryLabel:L,primaryAction:I,writingBlock:c,clientThreadId:a,messageId:s,title:y,hideDownloadButton:!0,isInlineWritingBlockEditEnabled:i,hasBeenEdited:e,autosaveStatus:b,shouldShowWritingBlockCanvasEdit:o,isInlineWritingBlockExportEnabled:l,serverThreadId:_,index:d,messageRef:r}),n.jsx("hr",{className:os.hr}),n.jsxs("div",{className:"flex w-full min-w-0 items-center px-4 py-1 font-sans sm:px-5",children:[n.jsx("div",{className:"font-medium",children:n.jsx(D,{id:"NPvnYL",defaultMessage:"To"})}),n.jsx("input",{disabled:m||!i,className:P(hn),maxLength:240,placeholder:S.formatMessage({id:"12HHUV",defaultMessage:"name@email.com"}),value:m?v:h,onChange:M,onBlur:T,onCopy:F=>F.stopPropagation()})]}),n.jsx("hr",{className:os.hr}),n.jsxs("div",{className:"flex w-full min-w-0 items-center px-4 py-1 font-sans sm:px-5",children:[n.jsx("div",{className:"font-medium",children:n.jsx(D,{id:"eQGtfX",defaultMessage:"Subject"})}),n.jsx("input",{disabled:m||!i,className:P(hn),value:m?y:N,maxLength:240,onChange:C,onBlur:E,onCopy:F=>F.stopPropagation()})]}),n.jsx("hr",{className:P(os.hr,"mb-4!")}),n.jsx(Va,{isInlineWritingBlockEditEnabled:i,writingBlock:c,onChange:u,isStreaming:m,setDirty:g,flushPendingChanges:j,children:t})]})};function fd({serverThreadId:t,index:e,messageId:s,writingBlock:a,dirty:r,setDirty:o,delay:i=2e3}){const[l,c]=f.useState(!1),[d,u]=f.useState(null),[m,b]=f.useState(null),[y,v]=f.useState(!1),[g,j]=f.useState(!1),_=f.useRef(0),N=f.useRef(a.content),k=f.useRef(a.title),h=f.useRef(a.metadata),w=f.useRef(!1),S=f.useRef(!1),p=f.useRef(0),C=f.useRef(null),{mutate:M}=ha({mutationFn:async({content:$,title:x,metadata:R})=>{_.current+=1,_.current>1&&j(!0),!(!t||!s)&&await Os.safePost("/conversation/message/writing-blocks",{requestBody:{message_id:s,conversation_id:t,index:String(e),id:a.id,writing_block:{content:$,index:String(e),variant:a.variant.toString(),metadata:R,title:x,id:a.id},updated_at:new Date().toISOString()},authOption:Oa.SendIfAvailable})},onSuccess:($,x,R)=>{C.current===(R==null?void 0:R.myVersion)&&(o(!1),b(new Date))},onMutate:()=>{_.current=0,j(!1);const $=++p.current;return C.current=$,c(!0),u(null),{myVersion:$}},onError:($,x,R)=>{u($.message),o(!0)},onSettled:($,x,R,F)=>{_.current=0,j(!1),C.current===(F==null?void 0:F.myVersion)&&(c(!1),C.current=null,w.current&&E.flush())},retry:1,retryDelay:3e3}),E=Ws(({content:$,title:x,metadata:R})=>{w.current=!1,v(!1),M({content:$,title:x,metadata:R})},i);f.useEffect(()=>{var $;if(a.content===N.current&&a.title===k.current&&a.metadata===h.current){S.current=!1;return}N.current=a.content,k.current=a.title,h.current=a.metadata,w.current=!0,v(!0),E({content:a.content,title:a.title,metadata:($=a.metadata)!=null?$:{}}),S.current&&(Promise.resolve().then(()=>{E.flush()}),S.current=!1)},[a.content,a.title,a.metadata,E]),f.useEffect(()=>()=>{E.cancel(),S.current=!1,v(!1)},[E]);const T=f.useCallback(()=>{if(!r&&!w.current){S.current=!1,v(!1);return}S.current=!0,w.current&&(E.flush(),S.current=!1,v(!1))},[r,E]),L=f.useMemo(()=>!!m&&!r&&!l,[m,r,l]);return{status:f.useMemo(()=>g?"retrying":l?"saving":d?"error":y?"queued":r?"dirty":L?"saved":"idle",[g,l,d,y,r,L]),savedAt:m,error:d,flushPendingChanges:T}}const hd=()=>({editWritingBlock:f.useCallback(({content:e,clientThreadId:s,message:a,index:r,variant:o,metadata:i,title:l,id:c})=>{var d,u;(u=(d=a.metadata)==null?void 0:d.writing_blocks)!=null&&u[c]||$e.logEventWithStatsig("ChatGPT Writing Block First Edit","chatgpt_writing_block_first_edit",A({},bt({clientThreadId:s,messageId:a.id}))),qi(s,m=>Gi.updateTree(m,b=>{var y,v;return b.updateNodeMessageMetadata(a.id,{writing_blocks:O(A({},(v=(y=a.metadata)==null?void 0:y.writing_blocks)!=null?v:{}),{[c]:{id:c,index:r,content:e,variant:o,title:l,metadata:i}})})}))},[])}),pd=({title:t,children:e,originalContent:s,messageId:a,clientThreadId:r,variant:o,recipient:i,isStreaming:l,index:c,id:d})=>{var I,$;const[u,m]=f.useState(!1),b=Vi(Co.EditInCanvas),y=J(),v=K(y,"2740339093"),g=K(y,"669593727"),j=yt(r),_=nt(r,x=>a?Je.getNode(x,a).message:void 0,{disablePerfDetector:!0}),N=($=(I=_==null?void 0:_.metadata)==null?void 0:I.writing_blocks)==null?void 0:$[d],k=f.useMemo(()=>{var x;return(x=N==null?void 0:N.metadata)!=null?x:{recipient:i!=null?i:null}},[i,N==null?void 0:N.metadata]),h=!!N,{editWritingBlock:w}=hd(),S=pt(),p=v&&j!=null&&!S,C=f.useMemo(()=>{var x,R,F;return(F=(R=(x=_==null?void 0:_.metadata)==null?void 0:x.writing_blocks)==null?void 0:R[d])!=null?F:{id:d,content:s,index:c,variant:o,title:t,metadata:k}},[_,d,s,c,o,t,k]),{status:M,flushPendingChanges:E}=fd({serverThreadId:j,index:c,messageId:a,dirty:u,setDirty:m,writingBlock:C}),T=f.useCallback(({content:x,title:R,metadata:F})=>{!r||!_||!_.id||w({content:x!=null?x:C.content,clientThreadId:r,message:_,index:c,variant:o,metadata:Object.assign({},k,F),title:R!=null?R:C.title,id:d})},[r,_,c,o,w,d,C,k]),L=f.useRef(null);switch(o){case Ft.EMAIL:return n.jsx(md,{hasBeenEdited:h,messageRef:L,clientThreadId:r,messageId:a,index:c,shouldShowWritingBlockCanvasEdit:b,isInlineWritingBlockEditEnabled:p,isInlineWritingBlockExportEnabled:g,onChange:T,writingBlock:C,isStreaming:l,autosaveStatus:M,title:t!=null?t:"",recipient:i!=null?i:"",setDirty:m,flushPendingChanges:E,children:e});default:return l&&o===Ft.UNKNOWN&&s===""?n.jsx("div",{ref:L,id:"writing-block-".concat(a),className:P(ws,"px-4 py-2","h-10"),"data-writing-block":!0}):n.jsxs("div",{ref:L,id:"writing-block-".concat(a),className:P(ws,"pt-0.5 pb-3"),"data-writing-block":!0,children:[n.jsx(Ya,{hasBeenEdited:h,autosaveStatus:M,writingBlock:C,clientThreadId:r,messageId:a,isInlineWritingBlockExportEnabled:g,isInlineWritingBlockEditEnabled:p,serverThreadId:j,shouldShowWritingBlockCanvasEdit:b,title:t,index:c,messageRef:L}),n.jsx("hr",{className:"border-token-border-light! mx-4 my-0! mb-3! border-0 border-t sm:mx-[1px]"}),n.jsx(Va,{setDirty:m,isInlineWritingBlockEditEnabled:p,writingBlock:C,onChange:T,isStreaming:l,flushPendingChanges:E,children:e})]})}};function xd(t){return t&&/^turn[0-9]+ifs[0-9]+$/.test(t)}const pn=4;function gd({metadata:t,analyticsMetadata:e,trackContentReferenceEvent:s,imageSource:a,superWidgetImages:r,isFirstAssistantContent:o}){const i=a!=null?a:Ke.Turn,l=vt(),c=J(),d=wt(c)&&za(c),u=f.useMemo(()=>!d||!r?t.images:No(t.images.concat(r),_=>_.thumbnail_url),[t.images,d,r]),m=t.images.some(_=>_.is_proxied_image)?[]:u.map(_=>_.thumbnail_url),b=Nr({queries:m.map(_=>Mo(_,"_ImageCarousel")),combine:_=>{const N=new Set;return _.forEach((k,h)=>{k.isSuccess&&N.add(m[h])}),N}}),y=u.filter(_=>b.has(_.thumbnail_url)),v=t.images.length;if(t.images.some(_=>_.is_proxied_image)){const _=t.images.find(k=>k.is_proxied_image),N=P("mb-7 mt-1 min-w-32 max-w-[22%] rounded-xl border-[0.5px] border-token-border-default",_!=null&&_.float_top?"relative block":"float-image z-10 float-end clear-end ms-7 overflow-hidden");return n.jsx(Pe,{image:_,imageSource:i,analyticsMetadata:e,trackContentReferenceEvent:s,eventMetadata:{imageUse:"deepResearch"},aspectRatio:Lt,className:N,contentReferenceType:"image_v2"},_==null?void 0:_.content_url)}if(v===0)return null;if(v===1){const _=t.images[0];return n.jsx(Pe,{image:_,imageSource:i,analyticsMetadata:e,trackContentReferenceEvent:s,eventMetadata:{imageUse:"legacyCarousel"},aspectRatio:Lt,className:"float-image border-token-border-default float-end clear-end ms-7 mt-1 mb-7 max-w-[22%] min-w-32 overflow-hidden rounded-xl border-[0.5px]",contentReferenceType:"image_v2"},_.content_url)}const g=d?null:pn,j=l||g==null?y.length:Math.min(y.length,g);return y.length>pn&&d?n.jsx(yd,{images:y.slice(0,j),imageSource:i,analyticsMetadata:e,trackContentReferenceEvent:s,isFirstAssistantContent:o}):n.jsx("div",{className:"no-scrollbar mt-1 mb-6 flex min-h-36 flex-nowrap gap-0.5 overflow-auto sm:gap-1 sm:overflow-hidden xl:min-h-44",children:y.slice(0,j).map((_,N)=>n.jsx("div",{className:P("border-token-border-default relative aspect-square w-32 shrink-0 overflow-hidden rounded-xl border-[0.5px] md:shrink","max-h-48 sm:w-[calc((100%-0.5rem)/4)]",N===0&&"rounded-s-xl",N===j-1&&"rounded-e-xl"),children:n.jsx(Pe,{image:_,imageSource:i,analyticsMetadata:e,trackContentReferenceEvent:s,eventMetadata:{imageUse:"legacyCarousel"},aspectRatio:Lt,className:"h-full w-full",contentReferenceType:"image_v2"},_.thumbnail_url)},_.thumbnail_url))})}const Us=f.memo(gd,(t,e)=>t.numImageResults===e.numImageResults&&t.analyticsMetadata===e.analyticsMetadata&&t.trackContentReferenceEvent===e.trackContentReferenceEvent&&t.metadata.images.length===e.metadata.images.length&&t.metadata.images.every((s,a)=>s.content_url===e.metadata.images[a].content_url));function Pe({image:t,imageSource:e,className:s,imgClassName:a,style:r,analyticsMetadata:o,trackContentReferenceEvent:i,eventMetadata:l={},badge:c,lightboxImages:d,aspectRatio:u,enableHoverAnimation:m=!0,skeletonEl:b,contentReferenceType:y}){var E,T;const v=To(t,{width:Eo,aspectRatio:u!=null?u:void 0}),g=t==null?void 0:t.content_url.replace(/^http:\/\//,"https://"),j=_d(t),{isSuccess:_}=bs(v,"ImageCarousel_thumbnail"),{isSuccess:N,isError:k}=bs(j?g:void 0,"ImageCarousel_full"),h=f.useMemo(()=>A({image_url:v,title:t==null?void 0:t.title},l),[v,t==null?void 0:t.title,l]);f.useEffect(()=>{t&&_&&i("Search Content Reference Shown","search_content_reference_shown",y,h)},[i,t,_,h,y]),f.useEffect(()=>{g&&k&&rt.addAction("Failed to download full image",{url:g,thumbnailUrl:v})},[g,k,v]);const w=Ps.useStore(),S=$o((E=t==null?void 0:t.thumbnail_crop_info)!=null?E:null,(T=t==null?void 0:t.thumbnail_size)!=null?T:null,u!=null?u:void 0),p=!t||!(_||N||t.is_proxied_image),C=(()=>{if(!p)return t.is_proxied_image?t.url:j&&N?g:v})(),M=A(A({},r),u?{aspectRatio:"".concat(u.width,"/").concat(u.height)}:{});return n.jsxs("button",{className:P("relative overflow-hidden",s),style:M,onClick:()=>{i("Search Content Reference Clicked","search_content_reference_clicked",y,h),w.setCurrentImage(t?{image:t,source:e,analyticsMetadata:o,imageResults:d}:void 0)},children:[bd({isLoading:p,enableHoverAnimation:m,src:C,image:t,objectPosition:S,className:a,skeletonEl:b}),c&&n.jsx("div",{className:"pointer-events-none absolute end-2 bottom-2",children:c})]})}function bd({isLoading:t,enableHoverAnimation:e,src:s,image:a,objectPosition:r,className:o,skeletonEl:i}){if(t)return i!=null?i:n.jsx("div",{className:"bg-token-main-surface-tertiary aspect-square h-full w-full animate-pulse"});const l=n.jsx("img",{src:s,alt:a==null?void 0:a.content_url,style:r?{objectPosition:r}:{},className:P("bg-token-main-surface-tertiary m-0 h-full w-full object-cover",o)});return e?n.jsx(Ca,{children:l}):l}function yd(t){"use forget";const e=ge.c(13),{images:s,imageSource:a,analyticsMetadata:r,trackContentReferenceEvent:o,isFirstAssistantContent:i}=t,l=J(),c=Yt(l),d=wd,u=i&&"mt-2",m=c?"-mx-[var(--thread-content-margin)]":"-mx-6";let b;e[0]!==u||e[1]!==m?(b=P("relative mb-6",u,m),e[0]=u,e[1]=m,e[2]=b):b=e[2];let y;e[3]!==r||e[4]!==a||e[5]!==o?(y=j=>n.jsx(Pe,{image:j,imageSource:a,analyticsMetadata:r,trackContentReferenceEvent:o,className:"aspect-auto h-full w-full",aspectRatio:null,contentReferenceType:"image_v2"}),e[3]=r,e[4]=a,e[5]=o,e[6]=y):y=e[6];let v;e[7]!==s||e[8]!==y?(v=n.jsx(As,{items:s,getItemKey:vd,itemClassName:"max-w-[200px] min-w-[120px] sm:max-w-[calc((var(--thread-content-max-width)-2rem)/3)]",getItemStyle:d,onRenderItem:y,className:"h-48 min-h-48"}),e[7]=s,e[8]=y,e[9]=v):v=e[9];let g;return e[10]!==b||e[11]!==v?(g=n.jsx("div",{className:b,children:v}),e[10]=b,e[11]=v,e[12]=g):g=e[12],g}function vd(t){return t.thumbnail_url}function wd(t){const{width:e,height:s}=t.content_size;return{width:s?e/s*192:180}}function _d(t){return!t||t.is_proxied_image?!1:t.thumbnail_url.includes("images.openai.com/thumbnails")}function Xa({numImages:t}){return n.jsxs("div",{className:"flex items-center gap-1 rounded-full px-2 py-1.5 text-white backdrop-blur-md backdrop-brightness-75",children:[n.jsx(Po,{className:"h-4 w-4"}),n.jsx("span",{className:"text-xs font-semibold",children:t})]})}function jd(t){"use forget";const e=ge.c(72),{images:s,className:a,aspect:r,objectPosition:o,showArrows:i,imageClassName:l,slideClassName:c,gap:d,peekPercent:u,onClick:m}=t,b=a===void 0?"":a,y=r===void 0?"aspect-[16/9]":r,v=o===void 0?"object-cover":o,g=i===void 0?!0:i,j=l===void 0?"":l,_=c===void 0?"":c,N=d===void 0?2:d,k=u===void 0?95:u,[h,w]=f.useState(0),[S,p]=f.useState(!1),[C,M]=f.useState(!1),E=f.useRef(null);let T;e[0]===Symbol.for("react.memo_cache_sentinel")?(T=[],e[0]=T):T=e[0];const L=f.useRef(T),I=f.useRef(null),$=W(),x=s.length,R=Ye(k,0,100),F="".concat(R,"%");let q;e[1]!==F?(q={maxWidth:F},e[1]=F,e[2]=q):q=e[2];const G=q;let B;e[3]!==x?(B=(V,U)=>{const Y=L.current[V];if(!Y)return 0;const se=Y.offsetLeft,ce=se+Y.offsetWidth,Ve=U.clientWidth,_e=Math.max(0,U.scrollWidth-Ve);if(x<=1||V===0)return Ye(se,0,_e);if(V===x-1){const Mt=ce-Ve;return Ye(Mt,0,_e)}const Qt=se-(Ve-Y.offsetWidth)/2;return Ye(Qt,0,_e)},e[3]=x,e[4]=B):B=e[4];const z=B;let X;e[5]!==z||e[6]!==x?(X=(V,U)=>{const Y=U===void 0?"smooth":U;if(x===0||V<0||V>=x)return;const se=E.current;if(!se)return;const ce=z(V,se);if(gn(se.scrollLeft,ce)){Y!=="auto"&&se.scrollTo({left:ce,behavior:"auto"}),I.current=null;return}I.current=ce,se.scrollTo({left:ce,behavior:Y})},e[5]=z,e[6]=x,e[7]=X):X=e[7];const H=X;let Z,fe;e[8]!==g?(Z=()=>{if(!g)return;M(!0);const V=window.setTimeout(()=>M(!1),2e3);return()=>window.clearTimeout(V)},fe=[g],e[8]=g,e[9]=Z,e[10]=fe):(Z=e[9],fe=e[10]),f.useEffect(Z,fe);const ne=S&&h!==0,Q=S||C;let ee;e[11]!==h||e[12]!==H||e[13]!==x?(ee=V=>{if(x===0)return;const U=Ye(V,0,x-1);H(U,"smooth"),U!==h&&w(U)},e[11]=h,e[12]=H,e[13]=x,e[14]=ee):ee=e[14];const ie=ee;let te;e[15]!==ie||e[16]!==h||e[17]!==x?(te=()=>{if(x!==0){if(h>=x-1){ie(0);return}ie(h+1)}},e[15]=ie,e[16]=h,e[17]=x,e[18]=te):te=e[18];const ae=te;let le;e[19]!==ie||e[20]!==h?(le=()=>ie(h-1),e[19]=ie,e[20]=h,e[21]=le):le=e[21];const re=le;let he,me;e[22]!==z||e[23]!==h||e[24]!==x?(he=()=>{const V=E.current;if(!V)return;const U=()=>{const Y=V.scrollLeft||0,se=I.current;if(se!=null){gn(Y,se)&&(I.current=null);return}let ce=h,Ve=Number.POSITIVE_INFINITY;for(let _e=0;_e<x;_e++){const Qt=z(_e,V),Mt=Math.abs(Qt-Y);Mt<Ve-.5&&(Ve=Mt,ce=_e)}ce!==h&&w(ce)};return V.addEventListener("scroll",U,{passive:!0}),()=>V.removeEventListener("scroll",U)},me=[x,h,z],e[22]=z,e[23]=h,e[24]=x,e[25]=he,e[26]=me):(he=e[25],me=e[26]),f.useEffect(he,me);let Me,be;e[27]!==S||e[28]!==ae||e[29]!==re||e[30]!==x?(Me=()=>{if(!S)return;const V=U=>{if(U.defaultPrevented||U.altKey||U.ctrlKey||U.metaKey||U.shiftKey)return;const Y=U.target;if(Y instanceof HTMLElement){if(Y.isContentEditable)return;const se=Y.tagName;if(se==="INPUT"||se==="TEXTAREA"||se==="SELECT")return;const ce=Y.getAttribute("role");if(ce==="textbox"||ce==="combobox")return}x<=1||(U.key==="ArrowRight"?(U.preventDefault(),ae()):U.key==="ArrowLeft"&&(U.preventDefault(),re()))};return window.addEventListener("keydown",V),()=>window.removeEventListener("keydown",V)},be=[S,x,ae,re],e[27]=S,e[28]=ae,e[29]=re,e[30]=x,e[31]=Me,e[32]=be):(Me=e[31],be=e[32]),f.useEffect(Me,be);const Kt="select-none ".concat(b," relative");let St,Ct;e[33]===Symbol.for("react.memo_cache_sentinel")?(St=()=>p(!0),Ct=()=>p(!1),e[33]=St,e[34]=Ct):(St=e[33],Ct=e[34]);const Jt="relative w-full ".concat(y," overflow-clip");let We;e[35]!==N?(We={gap:N},e[35]=N,e[36]=We):We=e[36];let He;if(e[37]!==j||e[38]!==s||e[39]!==$||e[40]!==v||e[41]!==m||e[42]!==_||e[43]!==x||e[44]!==G){let V;e[46]!==j||e[47]!==$||e[48]!==v||e[49]!==m||e[50]!==_||e[51]!==x||e[52]!==G?(V=(U,Y)=>{var se;return n.jsx("div",{onClick:()=>m==null?void 0:m(U,Y),ref:ce=>{L.current[Y]=ce},className:P("relative flex h-full shrink-0 grow-0 snap-always items-stretch",Y===0&&"snap-start",Y===x-1&&"snap-end",Y>0&&Y<x-1&&"snap-center",_),style:G,children:U.content?U.content:n.jsx("img",{src:U.src,alt:(se=U.alt)!=null?se:$.formatMessage({id:"wHCsqa",defaultMessage:"Slide {index}"},{index:Y+1}),className:"h-full w-auto ".concat(v," ").concat(j)})},Y)},e[46]=j,e[47]=$,e[48]=v,e[49]=m,e[50]=_,e[51]=x,e[52]=G,e[53]=V):V=e[53],He=s.map(V),e[37]=j,e[38]=s,e[39]=$,e[40]=v,e[41]=m,e[42]=_,e[43]=x,e[44]=G,e[45]=He}else He=e[45];let Ue;e[54]!==We||e[55]!==He?(Ue=n.jsx("div",{ref:E,className:"no-scrollbar flex h-full w-full touch-pan-x snap-x snap-mandatory overflow-x-scroll scroll-smooth",style:We,children:He}),e[54]=We,e[55]=He,e[56]=Ue):Ue=e[56];let qe;e[57]!==s.length||e[58]!==$||e[59]!==ne||e[60]!==ae||e[61]!==re||e[62]!==Q||e[63]!==g?(qe=g&&s.length>1&&n.jsxs(n.Fragment,{children:[n.jsx(bn,{ariaLabel:$.formatMessage({id:"l9pylv",defaultMessage:"Previous slide"}),onClick:re,side:"start",visible:ne,children:n.jsx(Na,{className:"icon-md"})}),n.jsx(bn,{ariaLabel:$.formatMessage({id:"L0pbQh",defaultMessage:"Next slide"}),onClick:ae,side:"end",visible:Q,children:n.jsx(Ls,{className:"icon-md"})})]}),e[57]=s.length,e[58]=$,e[59]=ne,e[60]=ae,e[61]=re,e[62]=Q,e[63]=g,e[64]=qe):qe=e[64];let Ge;e[65]!==Jt||e[66]!==Ue||e[67]!==qe?(Ge=n.jsxs("div",{className:Jt,children:[Ue,qe]}),e[65]=Jt,e[66]=Ue,e[67]=qe,e[68]=Ge):Ge=e[68];let Nt;return e[69]!==Kt||e[70]!==Ge?(Nt=n.jsx("div",{className:Kt,"aria-roledescription":"carousel",onMouseEnter:St,onMouseLeave:Ct,children:Ge}),e[69]=Kt,e[70]=Ge,e[71]=Nt):Nt=e[71],Nt}const xn={width:4,height:5};function kd(t){"use forget";const e=ge.c(7),{image:s}=t,a=xn.height/xn.width;let r;e[0]===Symbol.for("react.memo_cache_sentinel")?(r={maxHeight:"calc(100cqw * ".concat(a,")")},e[0]=r):r=e[0];let o;e[1]!==s.alt||e[2]!==s.content||e[3]!==s.src?(o=s.content?s.content:n.jsx("img",{src:s.src,alt:s.alt,className:"h-full w-full object-cover"}),e[1]=s.alt,e[2]=s.content,e[3]=s.src,e[4]=o):o=e[4];let i;return e[5]!==o?(i=n.jsx("div",{className:"[container-type:inline-size] w-full overflow-hidden [font-size:0] leading-none",style:r,children:o}),e[5]=o,e[6]=i):i=e[6],i}function Sd(t){"use forget";const e=ge.c(4);if(t.images.length===0)return null;if(t.images.length===1){let a;return e[0]!==t.images[0]?(a=n.jsx(kd,{image:t.images[0]}),e[0]=t.images[0],e[1]=a):a=e[1],a}let s;return e[2]!==t?(s=n.jsx(jd,A({},t)),e[2]=t,e[3]=s):s=e[3],s}const Ye=(t,e,s)=>Math.min(Math.max(t,e),s),gn=(t,e,s=1)=>Math.abs(t-e)<=s;function bn(t){"use forget";const e=ge.c(8),{ariaLabel:s,onClick:a,side:r,visible:o,children:i}=t,l=r==="start"?"start-3":"end-3",c=o?"opacity-90 pointer-events-auto":"opacity-0 pointer-events-none";let d;e[0]!==l||e[1]!==c?(d=P("btn-secondary border-token-border-default active:bg-token-bg-tertiary hover:bg-token-bg-primary absolute top-1/2 flex h-8 w-8 -translate-y-1/2 items-center justify-center rounded-full bg-clip-padding backdrop-blur transition-opacity duration-300 hover:shadow-[0px_4px_16px_0px_rgba(0,0,0,0.05)] active:opacity-100!",c,l),e[0]=l,e[1]=c,e[2]=d):d=e[2];let u;return e[3]!==s||e[4]!==i||e[5]!==a||e[6]!==d?(u=n.jsx("button",{"aria-label":s,onClick:a,className:d,children:i}),e[3]=s,e[4]=i,e[5]=a,e[6]=d,e[7]=u):u=e[7],u}const Za="mt-1 mb-5 [&:not(:first-child)]:mt-4",Cd=/^image_group[\s\S]*$/;function Nd({contentReference:t,trackContentReferenceEvent:e,analyticsMetadata:s}){var d;const{images:a,layout:r="carousel",aspect_ratio:o}=t,i=Cd.test((d=t.matched_text)!=null?d:""),l=Ad(o!=null?o:"1:1"),c={images:a,trackContentReferenceEvent:e,analyticsMetadata:s,aspectRatio:l,isReferenceComplete:i};return r==="carousel"?n.jsx(Dd,A({},c)):r==="bento"?n.jsx(Ld,A({},c)):r==="full_width"?n.jsx(Od,A({},c)):null}const Qe={width:9,height:5},Md={width:Qe.width/3,height:Qe.height},Td={width:Qe.width/3,height:Qe.height/2};function Ed(t,e){if(e)switch(t){case 0:return"rounded-tr-md rounded-br-md rounded-tl-xl rounded-bl-xl";case 1:return"rounded-md";case 2:return"rounded-tr-xl rounded-br-md rounded-tl-md rounded-bl-md";case 3:return"rounded-tr-md rounded-br-xl rounded-tl-md rounded-bl-md";default:return""}switch(t){case 0:return"rounded-tr-md rounded-br-md rounded-tl-xl rounded-bl-xl";case 1:return"rounded-tr-xl rounded-br-md rounded-tl-md rounded-bl-md";case 2:return"rounded-tr-md rounded-br-xl rounded-tl-md rounded-bl-md";default:return""}}const $d=(t,e)=>{var s;return t.image_result?t.image_result.content_url:"".concat((s=t.image_search_query)!=null?s:t.image_ref_id,"-").concat(e)};function Pd({images:t,aspectRatio:e,trackContentReferenceEvent:s,analyticsMetadata:a}){const r=e.height>e.width,o=r?4:3;return n.jsx("div",{className:P("grid grid-flow-dense grid-cols-3 grid-rows-2 gap-1",Za),style:{aspectRatio:"".concat(Qe.width,"/").concat(Qe.height)},children:t.map((i,l)=>{var m;if(l>=o)return null;const d=r&&[0,1].includes(l),u=l===Math.min(o,t.length)-1&&t.length>o;return n.jsx(Pe,{image:(m=i.image_result)!=null?m:void 0,imageSource:Ke.ImageGroup,className:P("border-token-border-default h-full w-full border-[0.5px]",d&&"col-span-1 row-span-2",!r&&l===0&&"col-span-2 row-span-2",Ed(l,r)),badge:u?n.jsx(Xa,{numImages:t.length}):void 0,lightboxImages:t.map(b=>b.image_result).filter(b=>!!b),aspectRatio:d?Md:Td,trackContentReferenceEvent:s,eventMetadata:{imageUse:"imageGroup",layout:"bento"},analyticsMetadata:a,contentReferenceType:"image_group"},$d(i,l))})})}function Ad(t){const[e,s]=t.split(":"),a=parseFloat(e),r=parseFloat(s);return a<=0||r<=0?{width:1,height:1}:{width:a,height:r}}const qs=(t,e)=>t.images.length===e.images.length&&t.analyticsMetadata===e.analyticsMetadata&&t.trackContentReferenceEvent===e.trackContentReferenceEvent&&t.images.every((s,a)=>{var r,o;return((r=s.image_result)==null?void 0:r.content_url)===((o=e.images[a].image_result)==null?void 0:o.content_url)}),Ld=f.memo(Pd,qs),Id=3,is={width:5,height:4};function Rd({images:t,analyticsMetadata:e,trackContentReferenceEvent:s,isReferenceComplete:a}){var c;const r=vt(),o=t.length,i=t.map(d=>d.image_result).filter(d=>!!d);if(o===0)return null;if(o===1){const d=t[0];return!d.image_result&&!a?null:n.jsxs(n.Fragment,{children:[n.jsx("span",{"aria-hidden":!0,className:"clear-both m-0 block h-0 p-0"}),n.jsx(Pe,{image:(c=d==null?void 0:d.image_result)!=null?c:void 0,imageSource:Ke.ImageGroup,analyticsMetadata:e,trackContentReferenceEvent:s,eventMetadata:{imageUse:"imageGroup",layout:"single"},aspectRatio:Lt,className:"float-image border-token-border-default float-end clear-end ms-7 mt-1 mb-7 w-[22%] min-w-32 overflow-hidden rounded-xl border-[0.5px]",contentReferenceType:"image_group"})]})}const l=r?t.length:Math.min(t.length,Id);return n.jsx("div",{className:P("no-scrollbar flex min-h-36 flex-nowrap gap-0.5 overflow-auto sm:gap-1 sm:overflow-hidden xl:min-h-44",Za),children:t.slice(0,l).map((d,u)=>{var b,y,v;const m=u===l-1;return n.jsx("div",{className:P("border-token-border-default relative w-32 shrink-0 overflow-hidden rounded-xl border-[0.5px] md:shrink","max-h-64 sm:w-[calc((100%-0.5rem)/3)]",u===0&&"rounded-s-xl",m&&"rounded-e-xl"),style:{aspectRatio:"".concat(is.width,"/").concat(is.height)},children:n.jsx(Pe,{image:(b=d.image_result)!=null?b:void 0,imageSource:Ke.ImageGroup,lightboxImages:i,analyticsMetadata:e,trackContentReferenceEvent:s,eventMetadata:{imageUse:"imageGroup",layout:"carousel"},className:"h-full w-full",badge:m&&t.length>l&&n.jsx(Xa,{numImages:t.length}),aspectRatio:is,contentReferenceType:"image_group"})},(v=(y=d.image_result)==null?void 0:y.thumbnail_url)!=null?v:"".concat(d.image_search_query,"-").concat(d.image_ref_id,"-").concat(u))})})}const Dd=f.memo(Rd,qs);function Fd({images:t,analyticsMetadata:e,trackContentReferenceEvent:s}){var d;const a=Is(),[r,o]=Ao({track:"height"}),i=(d=r==null?void 0:r.height)!=null?d:null,l=a==null?void 0:a.onFullWidthImageHeightChange;f.useEffect(()=>{!l||i==null||l(i)},[l,i]);const c=t.map(u=>{var m;return{content:n.jsx(Pe,{image:(m=u.image_result)!=null?m:void 0,imageSource:Ke.ImageGroup,aspectRatio:null,enableHoverAnimation:!1,analyticsMetadata:e,trackContentReferenceEvent:s,skeletonEl:n.jsx("div",{className:"bg-token-main-surface-tertiary aspect-[3/2] h-full w-full animate-pulse"}),lightboxImages:t.map(b=>b.image_result).filter(b=>!!b),className:"h-full w-full",contentReferenceType:"image_group"})}});return n.jsx("div",{ref:o,className:"-mx-6 mt-[calc(-1rem-3px)] pb-2",children:n.jsx(Sd,{images:c,aspect:"aspect-[3/2]"})})}const Od=f.memo(Fd,qs),zd=200,Bd=100,Pt={id:"imagePill.screenshot",defaultMessage:"screenshot",description:"Brief text to be placed in a pill as generic fallback when screenshot url is missing"},Ka="m-0 p-[2px] pr-1",Wd=P(Ka,"h-full rounded-lg object-contain"),Hd=P(Ka,"p-[4px]");function yn({image:t}){const[e,s]=f.useState(!1),a=Ps.useStore(),r=f.useRef(null),o=f.useRef(null),i=W(),l=t==null?void 0:t.content_url,c=f.useMemo(()=>l?Vt(l,"hostname"):null,[l]),d=f.useCallback(()=>{r.current&&clearTimeout(r.current)},[]),u=f.useCallback(()=>{t&&(d(),s(!1),a.setCurrentImage({image:t}))},[a,t,d]),m=f.useCallback(()=>{o.current&&clearTimeout(o.current)},[]),b=f.useCallback(()=>{s(!1)},[s]),y=f.useCallback(j=>{j.stopPropagation(),m(),r.current=setTimeout(()=>{s(!0)},zd)},[m]),v=f.useCallback(j=>{j.stopPropagation(),d(),o.current=setTimeout(()=>{b()},Bd)},[d,b]);f.useEffect(()=>{e&&m()},[e,m]);const g=f.useMemo(()=>({onBlur:v,onMouseLeave:v,onMouseEnter:y,onFocus:y}),[v,y]);return t?n.jsxs("span",O(A({onClick:u,className:"relative"},g),{children:[n.jsxs(vn,{isOpen:e,children:[n.jsx("img",{className:Wd,src:t.thumbnail_url}),n.jsx("span",{children:c!=null?c:i.formatMessage(Pt)})]}),e&&n.jsx("div",{className:"absolute start-0 z-50",children:n.jsxs("div",O(A({className:P("text-token-text-secondary border-token-border-light w-[256px] cursor-pointer px-3 pt-2 pb-3 text-sm shadow-md outline-[0.5px] outline-black/5",Yi)},g),{children:[n.jsxs(we,{href:t.content_url,target:"_blank",rel:"noopener",className:"z-50 mb-2 flex items-center gap-2 hover:opacity-70",onClick:j=>j.stopPropagation(),children:[n.jsx(ct,{url:t.content_url,className:"m-0 size-4 p-0",size:32}),c!=null?c:i.formatMessage(Pt)]}),n.jsx("img",{className:"border-token-border-light m-0 cursor-pointer rounded-lg object-contain p-0 outline-[0.5px] outline-black/5",src:t.thumbnail_url,alt:c!=null?c:i.formatMessage(Pt),onClick:j=>{j.preventDefault(),u()}})]}))})]})):n.jsxs(vn,{isOpen:!1,children:[n.jsx("span",{className:Hd,children:n.jsx(xt,{})}),n.jsx("span",{children:c!=null?c:i.formatMessage(Pt)})]})}function vn(a){var r=a,{children:t,isOpen:e}=r,s=ue(r,["children","isOpen"]);return n.jsx("span",O(A({className:P("ms-1 cursor-pointer","inline-flex max-w-full items-center","relative top-[0.2rem]","animate-[show_150ms_ease-in]")},s),{children:n.jsx("span",{className:P("text-token-text-secondary flex h-4.5 overflow-hidden rounded-xl bg-[#F4F4F4] pe-2 text-[0.5625em] font-medium dark:bg-[#303030]","hover:bg-token-text-primary! hover:text-token-text-inverted",e&&"bg-token-main-surface-tertiary text-token-text-secondary","transition-colors duration-150 ease-in-out","items-center justify-center"),children:t})}))}async function Ud({conversationId:t,messageId:e,assetPointerLinks:s,sharedConversationLikeId:a}){return await Os.safePost("/conversation/get_images_for_message",{requestBody:{conversation_id:t!=null?t:null,share_id:a!=null?a:null,message_id:e,asset_pointer_links:s},authOption:Oa.SendIfAvailable})}function qd({reference:t,conversationId:e,messageId:s,sharedConversationLikeId:a,isN7jupdMessage:r}){return Mr(A({queryKey:["inline-images",t,e,s],queryFn:async()=>{if(!t.asset_pointer_links||t.asset_pointer_links.length===0||!e&&!a)return{images:[],formats:[]};const i=await Ud({conversationId:e,messageId:s,assetPointerLinks:t.asset_pointer_links,sharedConversationLikeId:a});for(let l=0;l<i.images.length;l++){const c=i.images[l],d=i.formats[l],u="image/".concat(d),m=Gd(c,u);i.images[l]=m}return i}},r?{retry:3,retryDelay:5e3}:{}))}function Gd(t,e="",s=512){const a=atob(t),r=[];for(let i=0;i<a.length;i+=s){const l=a.slice(i,i+s),c=new Array(l.length);for(let u=0;u<l.length;u++)c[u]=l.charCodeAt(u);const d=new Uint8Array(c);r.push(d)}const o=new Blob(r,{type:e});return URL.createObjectURL(o)}const Vd=200;function Yd({reference:t,clientThreadId:e,message:s,trackContentReferenceEvent:a}){var b;const r=yt(e),{postId:o}=f.useContext(Lo),{data:i,isLoading:l,isError:c,error:d}=qd({reference:t,conversationId:r,messageId:s.id,sharedConversationLikeId:o,isN7jupdMessage:(b=s.metadata)==null?void 0:b.n7jupd_message}),u=f.useRef([]);f.useEffect(()=>()=>{u.current.forEach(y=>{URL.revokeObjectURL(y)}),u.current=[]},[]);const m=Ja(s,t);return d||c||i&&!("images"in i)||l||!(i!=null&&i.images.length)?null:(u.current=[],n.jsx(n.Fragment,{children:i==null?void 0:i.images.map((y,v)=>{const g=Qa(t,y,m);return n.jsx(Us,{metadata:g,analyticsMetadata:{clientThreadId:e,messageId:s.id},numImageResults:1,trackContentReferenceEvent:a},"image-carousel-inline-".concat(v))})}))}const Xd=(t,e)=>{const s=new RegExp(e+"\\s*([^\\n]+)","m"),a=t.match(s);return a&&a[1]?a[1].trim().length:0};function Ja(t,e){return f.useMemo(()=>{let s=-1;return t.content.content_type==="text"&&(s=Xd(t.content.parts.join(""),e.matched_text)),s<Vd||s===-1},[t,e.matched_text])}function Qa(t,e,s){var a,r,o;return{matched_text:t.matched_text,start_idx:t.start_idx,end_idx:t.end_idx,safe_urls:t.safe_urls,alt:t.alt,prompt_text:t.prompt_text,type:"image_v2",refs:[],images:[{url:e,content_url:(a=t.clicked_from_url)!=null?a:"",thumbnail_url:e,title:(r=t.clicked_from_title)!=null?r:"",attribution:Vt((o=t.clicked_from_url)!=null?o:e,"hostname"),content_size:{width:wn,height:_n},thumbnail_size:{width:wn,height:_n},is_proxied_image:!0,float_top:s}]}}const wn=141,_n=143;function Zd({reference:t,clientThreadId:e,message:s,trackContentReferenceEvent:a}){var y,v,g,j,_;const r=((y=s.metadata)==null?void 0:y.n7jupd_message)&&t.matched_text.includes("screenshot"),o=yt(e),i=(g=(v=f.useContext(Io))==null?void 0:v.serverSharedThreadId)!=null?g:void 0,l=Ro(t.asset_pointer_links[0]),c=f.useMemo(()=>({content_type:Ra.ImageAssetPointer,size_bytes:0,width:0,height:0,asset_pointer:l}),[l]),d=ja({asset:c,sharedThreadId:i,conversationId:o}),u=(j=d.data)==null?void 0:j.url,m=Ja(s,t),b=f.useMemo(()=>u?Qa(t,u,m):null,[u,t,m]);return d.error||d.isError?null:r&&!((_=d.data)!=null&&_.url)&&d.isLoading?n.jsx(yn,{image:null},"image-pill-loading"):!r&&(d.isLoading||!d.data)||!b?null:r?n.jsx(yn,{image:b.images[0]}):n.jsx(Us,{metadata:b,analyticsMetadata:{clientThreadId:e,messageId:s.id},numImageResults:1,trackContentReferenceEvent:a})}const oe=1e-6;let et=typeof Float32Array<"u"?Float32Array:Array;function Kd(){const t=new et(2);return et!=Float32Array&&(t[0]=0,t[1]=0),t}function jn(t,e,s){return t[0]=e[0]+s[0],t[1]=e[1]+s[1],t}function Jd(t,e){return t[0]=-e[0],t[1]=-e[1],t}function er(t,e,s,a){const r=e[0],o=e[1];return t[0]=r+a*(s[0]-r),t[1]=o+a*(s[1]-o),t}(function(){const t=Kd();return function(e,s,a,r,o,i){let l,c;for(s||(s=2),a||(a=0),r?c=Math.min(r*s+a,e.length):c=e.length,l=a;l<c;l+=s)t[0]=e[l],t[1]=e[l+1],o(t,t,i),e[l]=t[0],e[l+1]=t[1];return e}})();function Qd(){const t=new et(3);return et!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function eu(t,e,s){return t[0]=e[0]+s[0],t[1]=e[1]+s[1],t[2]=e[2]+s[2],t}function tu(t,e,s){return t[0]=e[0]*s[0],t[1]=e[1]*s[1],t[2]=e[2]*s[2],t}function su(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}const nu=tu;(function(){const t=Qd();return function(e,s,a,r,o,i){let l,c;for(s||(s=3),a||(a=0),r?c=Math.min(r*s+a,e.length):c=e.length,l=a;l<c;l+=s)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],o(t,t,i),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2];return e}})();function au(t,e){const s=e[0],a=e[1],r=e[2],o=e[3],i=e[4],l=e[5],c=e[6],d=e[7],u=e[8],m=e[9],b=e[10],y=e[11],v=e[12],g=e[13],j=e[14],_=e[15],N=s*l-a*i,k=s*c-r*i,h=s*d-o*i,w=a*c-r*l,S=a*d-o*l,p=r*d-o*c,C=u*g-m*v,M=u*j-b*v,E=u*_-y*v,T=m*j-b*g,L=m*_-y*g,I=b*_-y*j;let $=N*I-k*L+h*T+w*E-S*M+p*C;return $?($=1/$,t[0]=(l*I-c*L+d*T)*$,t[1]=(r*L-a*I-o*T)*$,t[2]=(g*p-j*S+_*w)*$,t[3]=(b*S-m*p-y*w)*$,t[4]=(c*E-i*I-d*M)*$,t[5]=(s*I-r*E+o*M)*$,t[6]=(j*h-v*p-_*k)*$,t[7]=(u*p-b*h+y*k)*$,t[8]=(i*L-l*E+d*C)*$,t[9]=(a*E-s*L-o*C)*$,t[10]=(v*S-g*h+_*N)*$,t[11]=(m*h-u*S-y*N)*$,t[12]=(l*M-i*T-c*C)*$,t[13]=(s*T-a*M+r*C)*$,t[14]=(g*k-v*w-j*N)*$,t[15]=(u*w-m*k+b*N)*$,t):null}function ls(t,e,s){const a=e[0],r=e[1],o=e[2],i=e[3],l=e[4],c=e[5],d=e[6],u=e[7],m=e[8],b=e[9],y=e[10],v=e[11],g=e[12],j=e[13],_=e[14],N=e[15];let k=s[0],h=s[1],w=s[2],S=s[3];return t[0]=k*a+h*l+w*m+S*g,t[1]=k*r+h*c+w*b+S*j,t[2]=k*o+h*d+w*y+S*_,t[3]=k*i+h*u+w*v+S*N,k=s[4],h=s[5],w=s[6],S=s[7],t[4]=k*a+h*l+w*m+S*g,t[5]=k*r+h*c+w*b+S*j,t[6]=k*o+h*d+w*y+S*_,t[7]=k*i+h*u+w*v+S*N,k=s[8],h=s[9],w=s[10],S=s[11],t[8]=k*a+h*l+w*m+S*g,t[9]=k*r+h*c+w*b+S*j,t[10]=k*o+h*d+w*y+S*_,t[11]=k*i+h*u+w*v+S*N,k=s[12],h=s[13],w=s[14],S=s[15],t[12]=k*a+h*l+w*m+S*g,t[13]=k*r+h*c+w*b+S*j,t[14]=k*o+h*d+w*y+S*_,t[15]=k*i+h*u+w*v+S*N,t}function _s(t,e,s){const a=s[0],r=s[1],o=s[2];let i,l,c,d,u,m,b,y,v,g,j,_;return e===t?(t[12]=e[0]*a+e[4]*r+e[8]*o+e[12],t[13]=e[1]*a+e[5]*r+e[9]*o+e[13],t[14]=e[2]*a+e[6]*r+e[10]*o+e[14],t[15]=e[3]*a+e[7]*r+e[11]*o+e[15]):(i=e[0],l=e[1],c=e[2],d=e[3],u=e[4],m=e[5],b=e[6],y=e[7],v=e[8],g=e[9],j=e[10],_=e[11],t[0]=i,t[1]=l,t[2]=c,t[3]=d,t[4]=u,t[5]=m,t[6]=b,t[7]=y,t[8]=v,t[9]=g,t[10]=j,t[11]=_,t[12]=i*a+u*r+v*o+e[12],t[13]=l*a+m*r+g*o+e[13],t[14]=c*a+b*r+j*o+e[14],t[15]=d*a+y*r+_*o+e[15]),t}function tr(t,e,s){const a=s[0],r=s[1],o=s[2];return t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t[3]=e[3]*a,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function ru(t,e,s){const a=Math.sin(s),r=Math.cos(s),o=e[4],i=e[5],l=e[6],c=e[7],d=e[8],u=e[9],m=e[10],b=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*r+d*a,t[5]=i*r+u*a,t[6]=l*r+m*a,t[7]=c*r+b*a,t[8]=d*r-o*a,t[9]=u*r-i*a,t[10]=m*r-l*a,t[11]=b*r-c*a,t}function ou(t,e,s){const a=Math.sin(s),r=Math.cos(s),o=e[0],i=e[1],l=e[2],c=e[3],d=e[4],u=e[5],m=e[6],b=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r+d*a,t[1]=i*r+u*a,t[2]=l*r+m*a,t[3]=c*r+b*a,t[4]=d*r-o*a,t[5]=u*r-i*a,t[6]=m*r-l*a,t[7]=b*r-c*a,t}function iu(t,e,s,a,r){const o=1/Math.tan(e/2);if(t[0]=o/s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,r!=null&&r!==1/0){const i=1/(a-r);t[10]=(r+a)*i,t[14]=2*r*a*i}else t[10]=-1,t[14]=-2*a;return t}const lu=iu;function kn(t,e){const s=t[0],a=t[1],r=t[2],o=t[3],i=t[4],l=t[5],c=t[6],d=t[7],u=t[8],m=t[9],b=t[10],y=t[11],v=t[12],g=t[13],j=t[14],_=t[15],N=e[0],k=e[1],h=e[2],w=e[3],S=e[4],p=e[5],C=e[6],M=e[7],E=e[8],T=e[9],L=e[10],I=e[11],$=e[12],x=e[13],R=e[14],F=e[15];return Math.abs(s-N)<=oe*Math.max(1,Math.abs(s),Math.abs(N))&&Math.abs(a-k)<=oe*Math.max(1,Math.abs(a),Math.abs(k))&&Math.abs(r-h)<=oe*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(o-w)<=oe*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(i-S)<=oe*Math.max(1,Math.abs(i),Math.abs(S))&&Math.abs(l-p)<=oe*Math.max(1,Math.abs(l),Math.abs(p))&&Math.abs(c-C)<=oe*Math.max(1,Math.abs(c),Math.abs(C))&&Math.abs(d-M)<=oe*Math.max(1,Math.abs(d),Math.abs(M))&&Math.abs(u-E)<=oe*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(m-T)<=oe*Math.max(1,Math.abs(m),Math.abs(T))&&Math.abs(b-L)<=oe*Math.max(1,Math.abs(b),Math.abs(L))&&Math.abs(y-I)<=oe*Math.max(1,Math.abs(y),Math.abs(I))&&Math.abs(v-$)<=oe*Math.max(1,Math.abs(v),Math.abs($))&&Math.abs(g-x)<=oe*Math.max(1,Math.abs(g),Math.abs(x))&&Math.abs(j-R)<=oe*Math.max(1,Math.abs(j),Math.abs(R))&&Math.abs(_-F)<=oe*Math.max(1,Math.abs(_),Math.abs(F))}function cu(){const t=new et(4);return et!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function du(t,e,s){return t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s,t}function uu(t,e,s){const a=e[0],r=e[1],o=e[2],i=e[3];return t[0]=s[0]*a+s[4]*r+s[8]*o+s[12]*i,t[1]=s[1]*a+s[5]*r+s[9]*o+s[13]*i,t[2]=s[2]*a+s[6]*r+s[10]*o+s[14]*i,t[3]=s[3]*a+s[7]*r+s[11]*o+s[15]*i,t}(function(){const t=cu();return function(e,s,a,r,o,i){let l,c;for(s||(s=4),a||(a=0),r?c=Math.min(r*s+a,e.length):c=e.length,l=a;l<c;l+=s)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],t[3]=e[l+3],o(t,t,i),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2],e[l+3]=t[3];return e}})();function It(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Ze(t,e){const s=uu([],e,t);return du(s,s,1/s[3]),s}function js(t,e,s){return t<e?e:t>s?s:t}function mu(t){return Math.log(t)*Math.LOG2E}const fu=Math.log2||mu;function Ae(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const pe=Math.PI,sr=pe/4,ve=pe/180,ks=180/pe,ft=512,Sn=4003e4,At=85.051129,nr=1.5;function hu(t){return Math.pow(2,t)}function Xe(t){const[e,s]=t;Ae(Number.isFinite(e)),Ae(Number.isFinite(s)&&s>=-90&&s<=90,"invalid latitude");const a=e*ve,r=s*ve,o=ft*(a+pe)/(2*pe),i=ft*(pe+Math.log(Math.tan(sr+r*.5)))/(2*pe);return[o,i]}function ut(t){const[e,s]=t,a=e/ft*(2*pe)-pe,r=2*(Math.atan(Math.exp(s/ft*(2*pe)-pe))-sr);return[a*ks,r*ks]}function pu(t){const{latitude:e,longitude:s,highPrecision:a=!1}=t;Ae(Number.isFinite(e)&&Number.isFinite(s));const r=ft,o=Math.cos(e*ve),i=r/360,l=i/o,c=r/Sn/o,d={unitsPerMeter:[c,c,c],metersPerUnit:[1/c,1/c,1/c],unitsPerDegree:[i,l,c],degreesPerUnit:[1/i,1/l,1/c]};if(a){const u=ve*Math.tan(e*ve)/o,m=i*u/2,b=r/Sn*u,y=b/l*c;d.unitsPerDegree2=[0,m,b],d.unitsPerMeter2=[y,0,y]}return d}function xu(t){const{height:e,pitch:s,bearing:a,altitude:r,scale:o,center:i}=t,l=It();_s(l,l,[0,0,-r]),ru(l,l,-s*ve),ou(l,l,a*ve);const c=o/e;return tr(l,l,[c,c,c]),i&&_s(l,l,su([],i)),l}function gu(t){const{width:e,height:s,altitude:a,pitch:r=0,offset:o,center:i,scale:l,nearZMultiplier:c=1,farZMultiplier:d=1}=t;let{fovy:u=Ot(nr)}=t;a!==void 0&&(u=Ot(a));const m=u*ve,b=r*ve,y=ar(u);let v=y;i&&(v+=i[2]*l/Math.cos(b)/s);const g=m*(.5+(o?o[1]:0)/s),j=Math.sin(g)*v/Math.sin(js(Math.PI/2-b-g,.01,Math.PI-.01)),_=Math.sin(b)*j+v,N=v*10,k=Math.min(_*d,N);return{fov:m,aspect:e/s,focalDistance:y,near:c,far:k}}function bu(t){const{fov:e,aspect:s,near:a,far:r}=gu(t);return lu([],e,s,a,r)}function Ot(t){return 2*Math.atan(.5/t)*ks}function ar(t){return .5/Math.tan(.5*t*ve)}function yu(t,e){const[s,a,r=0]=t;return Ae(Number.isFinite(s)&&Number.isFinite(a)&&Number.isFinite(r)),Ze(e,[s,a,r,1])}function Cn(t,e,s=0){const[a,r,o]=t;if(Ae(Number.isFinite(a)&&Number.isFinite(r),"invalid pixel coordinate"),Number.isFinite(o))return Ze(e,[a,r,o,1]);const i=Ze(e,[a,r,0,1]),l=Ze(e,[a,r,1,1]),c=i[2],d=l[2],u=c===d?0:((s||0)-c)/(d-c);return er([],i,l,u)}function vu(t){const{width:e,height:s,bounds:a,minExtent:r=0,maxZoom:o=24,offset:i=[0,0]}=t,[[l,c],[d,u]]=a,m=wu(t.padding),b=Xe([l,js(u,-At,At)]),y=Xe([d,js(c,-At,At)]),v=[Math.max(Math.abs(y[0]-b[0]),r),Math.max(Math.abs(y[1]-b[1]),r)],g=[e-m.left-m.right-Math.abs(i[0])*2,s-m.top-m.bottom-Math.abs(i[1])*2];Ae(g[0]>0&&g[1]>0);const j=g[0]/v[0],_=g[1]/v[1],N=(m.right-m.left)/2/j,k=(m.top-m.bottom)/2/_,h=[(y[0]+b[0])/2+N,(y[1]+b[1])/2+k],w=ut(h),S=Math.min(o,fu(Math.abs(Math.min(j,_))));return Ae(Number.isFinite(S)),{longitude:w[0],latitude:w[1],zoom:S}}function wu(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(Ae(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const Nn=Math.PI/180;function _u(t,e=0){const{width:s,height:a,unproject:r}=t,o={targetZ:e},i=r([0,a],o),l=r([s,a],o);let c,d;const u=t.fovy?.5*t.fovy*Nn:Math.atan(.5/t.altitude),m=(90-t.pitch)*Nn;return u>m-.01?(c=Mn(t,0,e),d=Mn(t,s,e)):(c=r([0,0],o),d=r([s,0],o)),[i,l,d,c]}function Mn(t,e,s){const{pixelUnprojectionMatrix:a}=t,r=Ze(a,[e,0,1,1]),o=Ze(a,[e,t.height,1,1]),l=(s*t.distanceScales.unitsPerMeter[2]-r[2])/(o[2]-r[2]),c=er([],r,o,l),d=ut(c);return d.push(s),d}class zt{constructor(e={width:1,height:1}){this.equals=_=>_ instanceof zt?_.width===this.width&&_.height===this.height&&kn(_.projectionMatrix,this.projectionMatrix)&&kn(_.viewMatrix,this.viewMatrix):!1,this.project=(_,N={})=>{const{topLeft:k=!0}=N,h=this.projectPosition(_),w=yu(h,this.pixelProjectionMatrix),[S,p]=w,C=k?p:this.height-p;return _.length===2?[S,C]:[S,C,w[2]]},this.unproject=(_,N={})=>{const{topLeft:k=!0,targetZ:h=void 0}=N,[w,S,p]=_,C=k?S:this.height-S,M=h&&h*this.distanceScales.unitsPerMeter[2],E=Cn([w,C,p],this.pixelUnprojectionMatrix,M),[T,L,I]=this.unprojectPosition(E);return Number.isFinite(p)?[T,L,I]:Number.isFinite(h)?[T,L,h]:[T,L]},this.projectPosition=_=>{const[N,k]=Xe(_),h=(_[2]||0)*this.distanceScales.unitsPerMeter[2];return[N,k,h]},this.unprojectPosition=_=>{const[N,k]=ut(_),h=(_[2]||0)*this.distanceScales.metersPerUnit[2];return[N,k,h]};let{width:s,height:a,altitude:r=null,fovy:o=null}=e;const{latitude:i=0,longitude:l=0,zoom:c=0,pitch:d=0,bearing:u=0,position:m=null,nearZMultiplier:b=.02,farZMultiplier:y=1.01}=e;s=s||1,a=a||1,o===null&&r===null?(r=nr,o=Ot(r)):o===null?o=Ot(r):r===null&&(r=ar(o));const v=hu(c);r=Math.max(.75,r);const g=pu({longitude:l,latitude:i}),j=Xe([l,i]);j.push(0),m&&eu(j,j,nu([],m,g.unitsPerMeter)),this.projectionMatrix=bu({width:s,height:a,scale:v,center:j,pitch:d,fovy:o,nearZMultiplier:b,farZMultiplier:y}),this.viewMatrix=xu({height:a,scale:v,center:j,pitch:d,bearing:u,altitude:r}),this.width=s,this.height=a,this.scale=v,this.latitude=i,this.longitude=l,this.zoom=c,this.pitch=d,this.bearing=u,this.altitude=r,this.fovy=o,this.center=j,this.meterOffset=m||[0,0,0],this.distanceScales=g,this._initMatrices(),Object.freeze(this)}_initMatrices(){const{width:e,height:s,projectionMatrix:a,viewMatrix:r}=this,o=It();ls(o,o,a),ls(o,o,r),this.viewProjectionMatrix=o;const i=It();tr(i,i,[e/2,-s/2,1]),_s(i,i,[1,-1,0]),ls(i,i,o);const l=au(It(),i);if(!l)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=i,this.pixelUnprojectionMatrix=l}projectFlat(e){return Xe(e)}unprojectFlat(e){return ut(e)}getMapCenterByLngLatPosition({lngLat:e,pos:s}){const a=Cn(s,this.pixelUnprojectionMatrix),r=Xe(e),o=jn([],r,Jd([],a)),i=jn([],this.center,o);return ut(i)}fitBounds(e,s={}){const{width:a,height:r}=this,{longitude:o,latitude:i,zoom:l}=vu(Object.assign({width:a,height:r,bounds:e},s));return new zt({width:a,height:r,longitude:o,latitude:i,zoom:l})}getBounds(e){const s=this.getBoundingRegion(e),a=Math.min(...s.map(l=>l[0])),r=Math.max(...s.map(l=>l[0])),o=Math.min(...s.map(l=>l[1])),i=Math.max(...s.map(l=>l[1]));return[[a,o],[r,i]]}getBoundingRegion(e={}){return _u(this,e.z||0)}getLocationAtPoint({lngLat:e,pos:s}){return this.getMapCenterByLngLatPosition({lngLat:e,pos:s})}}function ju(t,e,s={}){const a={type:"Feature"};return(s.id===0||s.id)&&(a.id=s.id),s.bbox&&(a.bbox=s.bbox),a.properties=e||{},a.geometry=t,a}function rr(t,e,s={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Tn(t[0])||!Tn(t[1]))throw new Error("coordinates must contain numbers");return ju({type:"Point",coordinates:t},e,s)}function ku(t,e={}){const s={type:"FeatureCollection"};return e.id&&(s.id=e.id),e.bbox&&(s.bbox=e.bbox),s.features=t,s}function Tn(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function or(t,e,s){if(t!==null)for(var a,r,o,i,l,c,d,u=0,m=0,b,y=t.type,v=y==="FeatureCollection",g=y==="Feature",j=v?t.features.length:1,_=0;_<j;_++){d=v?t.features[_].geometry:g?t.geometry:t,b=d?d.type==="GeometryCollection":!1,l=b?d.geometries.length:1;for(var N=0;N<l;N++){var k=0,h=0;if(i=b?d.geometries[N]:d,i!==null){c=i.coordinates;var w=i.type;switch(u=0,w){case null:break;case"Point":if(e(c,m,_,k,h)===!1)return!1;m++,k++;break;case"LineString":case"MultiPoint":for(a=0;a<c.length;a++){if(e(c[a],m,_,k,h)===!1)return!1;m++,w==="MultiPoint"&&k++}w==="LineString"&&k++;break;case"Polygon":case"MultiLineString":for(a=0;a<c.length;a++){for(r=0;r<c[a].length-u;r++){if(e(c[a][r],m,_,k,h)===!1)return!1;m++}w==="MultiLineString"&&k++,w==="Polygon"&&h++}w==="Polygon"&&k++;break;case"MultiPolygon":for(a=0;a<c.length;a++){for(h=0,r=0;r<c[a].length;r++){for(o=0;o<c[a][r].length-u;o++){if(e(c[a][r][o],m,_,k,h)===!1)return!1;m++}h++}k++}break;case"GeometryCollection":for(a=0;a<i.geometries.length;a++)if(or(i.geometries[a],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function ir(t,e={}){if(t.bbox!=null&&e.recompute!==!0)return t.bbox;const s=[1/0,1/0,-1/0,-1/0];return or(t,a=>{s[0]>a[0]&&(s[0]=a[0]),s[1]>a[1]&&(s[1]=a[1]),s[2]<a[0]&&(s[2]=a[0]),s[3]<a[1]&&(s[3]=a[1])}),s}var Su=ir;function Cu(t,e={}){const s=ir(t),a=(s[0]+s[2])/2,r=(s[1]+s[3])/2;return rr([a,r],e.properties,e)}var Nu=Cu,cs,En;function Mu(){if(En)return cs;En=1;var t=Xi(),e=Zi(),s=Ki(),a=Ji(),r=t.isFinite,o=Math.min;function i(l){var c=Math[l];return function(d,u){if(d=s(d),u=u==null?0:o(e(u),292),u&&r(d)){var m=(a(d)+"e").split("e"),b=c(m[0]+"e"+(+m[1]+u));return m=(a(b)+"e").split("e"),+(m[0]+"e"+(+m[1]-u))}return c(d)}}return cs=i,cs}var ds,$n;function Tu(){if($n)return ds;$n=1;var t=Mu(),e=t("round");return ds=e,ds}var Eu=Tu();const Te=Tr(Eu),$u=f.createContext(null);function Pu(t,e){const s=Array.isArray(t)?t[0]:t?t.x:0,a=Array.isArray(t)?t[1]:t?t.y:0,r=Array.isArray(e)?e[0]:e?e.x:0,o=Array.isArray(e)?e[1]:e?e.y:0;return s===r&&a===o}function Se(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let s=0;s<t.length;s++)if(!Se(t[s],e[s]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const s=Object.keys(t),a=Object.keys(e);if(s.length!==a.length)return!1;for(const r of s)if(!e.hasOwnProperty(r)||!Se(t[r],e[r]))return!1;return!0}return!1}function Au(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function Pn(t,e){if(!t.getProjection)return;const s=t.getProjection(),a=e.getProjection();Se(s,a)||e.setProjection(s)}function An(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function Ln(t,e){const s=e.viewState||e;let a=!1;if("longitude"in s&&"latitude"in s){const r=t.center;t.center=new r.constructor(s.longitude,s.latitude),a=a||r!==t.center}if("zoom"in s){const r=t.zoom;t.zoom=s.zoom,a=a||r!==t.zoom}if("bearing"in s){const r=t.bearing;t.bearing=s.bearing,a=a||r!==t.bearing}if("pitch"in s){const r=t.pitch;t.pitch=s.pitch,a=a||r!==t.pitch}return s.padding&&!t.isPaddingEqual(s.padding)&&(a=!0,t.padding=s.padding),a}const Lu=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function In(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const a of t.layers)e[a.id]=a;const s=t.layers.map(a=>{let r=null;"interactive"in a&&(r=Object.assign({},a),delete r.interactive);const o=e[a.ref];if(o){r=r||Object.assign({},a),delete r.ref;for(const i of Lu)i in o&&(r[i]=o[i])}return r||a});return O(A({},t),{layers:s})}var Rn={};const Dn={version:8,sources:{},layers:[]},Fn={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},us={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},On={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},Iu=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],Ru=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class tt{constructor(e,s,a){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=r=>{const o=this.props[On[r.type]];o?o(r):r.type==="error"&&console.error(r.error)},this._onPointerEvent=r=>{(r.type==="mousemove"||r.type==="mouseout")&&this._updateHover(r);const o=this.props[Fn[r.type]];o&&(this.props.interactiveLayerIds&&r.type!=="mouseover"&&r.type!=="mouseout"&&(r.features=this._hoveredFeatures||this._queryRenderedFeatures(r.point)),o(r),delete r.features)},this._onCameraEvent=r=>{if(!this._internalUpdate){const o=this.props[us[r.type]];o&&o(r)}r.type in this._deferredEvents&&(this._deferredEvents[r.type]=!1)},this._MapClass=e,this.props=s,this._initialize(a)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const s=this.props;this.props=e;const a=this._updateSettings(e,s);a&&this._createShadowTransform(this._map);const r=this._updateSize(e),o=this._updateViewState(e,!0);this._updateStyle(e,s),this._updateStyleComponents(e,s),this._updateHandlers(e,s),(a||r||o&&!this._map.isMoving())&&this.redraw()}static reuse(e,s){const a=tt.savedMaps.pop();if(!a)return null;const r=a.map,o=r.getContainer();for(s.className=o.className;o.childNodes.length>0;)s.appendChild(o.childNodes[0]);r._container=s;const i=r._resizeObserver;i&&(i.disconnect(),i.observe(s)),a.setProps(O(A({},e),{styleDiffing:!1})),r.resize();const{initialViewState:l}=e;return l&&(l.bounds?r.fitBounds(l.bounds,O(A({},l.fitBoundsOptions),{duration:0})):a._updateViewState(l,!1)),r.isStyleLoaded()?r.fire("load"):r.once("styledata",()=>r.fire("load")),r._update(),a}_initialize(e){const{props:s}=this,{mapStyle:a=Dn}=s,r=O(A(A({},s),s.initialViewState),{accessToken:s.mapboxAccessToken||Du()||null,container:e,style:In(a)}),o=r.initialViewState||r.viewState||r;if(Object.assign(r,{center:[o.longitude||0,o.latitude||0],zoom:o.zoom||0,pitch:o.pitch||0,bearing:o.bearing||0}),s.gl){const u=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=u,s.gl)}const i=new this._MapClass(r);o.padding&&i.setPadding(o.padding),s.cursor&&(i.getCanvas().style.cursor=s.cursor),this._createShadowTransform(i);const l=i._render;i._render=u=>{this._inRender=!0,l.call(i,u),this._inRender=!1};const c=i._renderTaskQueue.run;i._renderTaskQueue.run=u=>{c.call(i._renderTaskQueue,u),this._onBeforeRepaint()},i.on("render",()=>this._onAfterRepaint());const d=i.fire;i.fire=this._fireEvent.bind(this,d),i.on("resize",()=>{this._renderTransform.resize(i.transform.width,i.transform.height)}),i.on("styledata",()=>{this._updateStyleComponents(this.props,{}),Pn(i.transform,this._renderTransform)}),i.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const u in Fn)i.on(u,this._onPointerEvent);for(const u in us)i.on(u,this._onCameraEvent);for(const u in On)i.on(u,this._onEvent);this._map=i}recycle(){const s=this.map.getContainer().querySelector("[mapboxgl-children]");s==null||s.remove(),tt.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const s=Au(e.transform);e.painter.transform=s,this._renderTransform=s}_updateSize(e){const{viewState:s}=e;if(s){const a=this._map;if(s.width!==a.transform.width||s.height!==a.transform.height)return a.resize(),!0}return!1}_updateViewState(e,s){if(this._internalUpdate)return!1;const a=this._map,r=this._renderTransform,{zoom:o,pitch:i,bearing:l}=r,c=a.isMoving();c&&(r.cameraElevationReference="sea");const d=Ln(r,A(A({},An(a.transform)),e));if(c&&(r.cameraElevationReference="ground"),d&&s){const u=this._deferredEvents;u.move=!0,u.zoom||(u.zoom=o!==r.zoom),u.rotate||(u.rotate=l!==r.bearing),u.pitch||(u.pitch=i!==r.pitch)}return c||Ln(a.transform,e),d}_updateSettings(e,s){const a=this._map;let r=!1;for(const o of Iu)if(o in e&&!Se(e[o],s[o])){r=!0;const i=a["set".concat(o[0].toUpperCase()).concat(o.slice(1))];i==null||i.call(a,e[o])}return r}_updateStyle(e,s){if(e.cursor!==s.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==s.mapStyle){const{mapStyle:a=Dn,styleDiffing:r=!0}=e,o={diff:r};return"localIdeographFontFamily"in e&&(o.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(In(a),o),!0}return!1}_updateStyleComponents(e,s){const a=this._map;let r=!1;return a.isStyleLoaded()&&("light"in e&&a.setLight&&!Se(e.light,s.light)&&(r=!0,a.setLight(e.light)),"fog"in e&&a.setFog&&!Se(e.fog,s.fog)&&(r=!0,a.setFog(e.fog)),"terrain"in e&&a.setTerrain&&!Se(e.terrain,s.terrain)&&(!e.terrain||a.getSource(e.terrain.source))&&(r=!0,a.setTerrain(e.terrain))),r}_updateHandlers(e,s){var a,r;const o=this._map;let i=!1;for(const l of Ru){const c=(a=e[l])!==null&&a!==void 0?a:!0,d=(r=s[l])!==null&&r!==void 0?r:!0;Se(c,d)||(i=!0,c?o[l].enable(c):o[l].disable())}return i}_queryRenderedFeatures(e){const s=this._map,a=s.transform,{interactiveLayerIds:r=[]}=this.props;try{return s.transform=this._renderTransform,s.queryRenderedFeatures(e,{layers:r.filter(s.getLayer.bind(s))})}catch(o){return[]}finally{s.transform=a}}_updateHover(e){var s;const{props:a}=this;if(a.interactiveLayerIds&&(a.onMouseMove||a.onMouseEnter||a.onMouseLeave)){const o=e.type,i=((s=this._hoveredFeatures)===null||s===void 0?void 0:s.length)>0,l=this._queryRenderedFeatures(e.point),c=l.length>0;!c&&i&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=l,c&&!i&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=o}else this._hoveredFeatures=null}_fireEvent(e,s,a){const r=this._map,o=r.transform,i=typeof s=="string"?s:s.type;return i==="move"&&this._updateViewState(this.props,!1),i in us&&(typeof s=="object"&&(s.viewState=An(o)),this._map.isMoving())?(r.transform=this._renderTransform,e.call(r,s,a),r.transform=o,r):(e.call(r,s,a),r)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const a in this._deferredEvents)this._deferredEvents[a]&&e.fire(a);this._internalUpdate=!1;const s=this._map.transform;e.transform=this._renderTransform,this._onAfterRepaint=()=>{Pn(this._renderTransform,s),e.transform=s}}}tt.savedMaps=[];function Du(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||Rn.MapboxAccessToken}catch(e){}try{t=t||Rn.REACT_APP_MAPBOX_ACCESS_TOKEN}catch(e){}return t}const Fu=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function Ou(t){if(!t)return null;const e=t.map,s={getMap:()=>e,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:a=>{const r=e.transform;e.transform=t.transform;const o=e.project(a);return e.transform=r,o},unproject:a=>{const r=e.transform;e.transform=t.transform;const o=e.unproject(a);return e.transform=r,o},queryTerrainElevation:(a,r)=>{const o=e.transform;e.transform=t.transform;const i=e.queryTerrainElevation(a,r);return e.transform=o,i},queryRenderedFeatures:(a,r)=>{const o=e.transform;e.transform=t.transform;const i=e.queryRenderedFeatures(a,r);return e.transform=o,i}};for(const a of zu(e))!(a in s)&&!Fu.includes(a)&&(s[a]=e[a].bind(e));return s}function zu(t){const e=new Set;let s=t;for(;s;){for(const a of Object.getOwnPropertyNames(s))a[0]!=="_"&&typeof t[a]=="function"&&a!=="fire"&&a!=="setEventedParent"&&e.add(a);s=Object.getPrototypeOf(s)}return Array.from(e)}const Bu=typeof document<"u"?f.useLayoutEffect:f.useEffect,Wu=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function Hu(t,e){for(const a of Wu)a in e&&(t[a]=e[a]);const{RTLTextPlugin:s="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=e;s&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(s,a=>{a&&console.error(a)},!0)}const Zt=f.createContext(null);function Uu(t,e,s){const a=f.useContext($u),[r,o]=f.useState(null),i=f.useRef(),{current:l}=f.useRef({mapLib:null,map:null});f.useEffect(()=>{const u=t.mapLib;let m=!0,b;return Promise.resolve(u||s).then(y=>{if(!m)return;if(!y)throw new Error("Invalid mapLib");const v="Map"in y?y:y.default;if(!v.Map)throw new Error("Invalid mapLib");if(Hu(v,t),!v.supported||v.supported(t))t.reuseMaps&&(b=tt.reuse(t,i.current)),b||(b=new tt(v.Map,t,i.current)),l.map=Ou(b),l.mapLib=v,o(b),a==null||a.onMapMount(l.map,t.id);else throw new Error("Map is not supported by this browser")}).catch(y=>{const{onError:v}=t;v?v({type:"error",target:null,originalEvent:null,error:y}):console.error(y)}),()=>{m=!1,b&&(a==null||a.onMapUnmount(t.id),t.reuseMaps?b.recycle():b.destroy())}},[]),Bu(()=>{r&&r.setProps(t)}),f.useImperativeHandle(e,()=>l.map,[r]);const c=f.useMemo(()=>A({position:"relative",width:"100%",height:"100%"},t.style),[t.style]),d={height:"100%"};return f.createElement("div",{id:t.id,ref:i,style:c},r&&f.createElement(Zt.Provider,{value:l},f.createElement("div",{"mapboxgl-children":"",style:d},t.children)))}const qu=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function ze(t,e){if(!t||!e)return;const s=t.style;for(const a in e){const r=e[a];Number.isFinite(r)&&!qu.test(a)?s[a]="".concat(r,"px"):s[a]=r}}function Gu(t,e){const{map:s,mapLib:a}=f.useContext(Zt),r=f.useRef({props:t});r.current.props=t;const o=f.useMemo(()=>{let g=!1;f.Children.forEach(t.children,N=>{N&&(g=!0)});const j=O(A({},t),{element:g?document.createElement("div"):null}),_=new a.Marker(j);return _.setLngLat([t.longitude,t.latitude]),_.getElement().addEventListener("click",N=>{var k,h;(h=(k=r.current.props).onClick)===null||h===void 0||h.call(k,{type:"click",target:_,originalEvent:N})}),_.on("dragstart",N=>{var k,h;const w=N;w.lngLat=o.getLngLat(),(h=(k=r.current.props).onDragStart)===null||h===void 0||h.call(k,w)}),_.on("drag",N=>{var k,h;const w=N;w.lngLat=o.getLngLat(),(h=(k=r.current.props).onDrag)===null||h===void 0||h.call(k,w)}),_.on("dragend",N=>{var k,h;const w=N;w.lngLat=o.getLngLat(),(h=(k=r.current.props).onDragEnd)===null||h===void 0||h.call(k,w)}),_},[]);f.useEffect(()=>(o.addTo(s.getMap()),()=>{o.remove()}),[]);const{longitude:i,latitude:l,offset:c,style:d,draggable:u=!1,popup:m=null,rotation:b=0,rotationAlignment:y="auto",pitchAlignment:v="auto"}=t;return f.useEffect(()=>{ze(o.getElement(),d)},[d]),f.useImperativeHandle(e,()=>o,[]),(o.getLngLat().lng!==i||o.getLngLat().lat!==l)&&o.setLngLat([i,l]),c&&!Pu(o.getOffset(),c)&&o.setOffset(c),o.isDraggable()!==u&&o.setDraggable(u),o.getRotation()!==b&&o.setRotation(b),o.getRotationAlignment()!==y&&o.setRotationAlignment(y),o.getPitchAlignment()!==v&&o.setPitchAlignment(v),o.getPopup()!==m&&o.setPopup(m),pa.createPortal(t.children,o.getElement())}const Vu=f.memo(f.forwardRef(Gu));function zn(t){return new Set(t?t.trim().split(/\s+/):[])}function Yu(t,e){const{map:s,mapLib:a}=f.useContext(Zt),r=f.useMemo(()=>document.createElement("div"),[]),o=f.useRef({props:t});o.current.props=t;const i=f.useMemo(()=>{const l=A({},t),c=new a.Popup(l);return c.setLngLat([t.longitude,t.latitude]),c.once("open",d=>{var u,m;(m=(u=o.current.props).onOpen)===null||m===void 0||m.call(u,d)}),c},[]);if(f.useEffect(()=>{const l=c=>{var d,u;(u=(d=o.current.props).onClose)===null||u===void 0||u.call(d,c)};return i.on("close",l),i.setDOMContent(r).addTo(s.getMap()),()=>{i.off("close",l),i.isOpen()&&i.remove()}},[]),f.useEffect(()=>{ze(i.getElement(),t.style)},[t.style]),f.useImperativeHandle(e,()=>i,[]),i.isOpen()&&((i.getLngLat().lng!==t.longitude||i.getLngLat().lat!==t.latitude)&&i.setLngLat([t.longitude,t.latitude]),t.offset&&!Se(i.options.offset,t.offset)&&i.setOffset(t.offset),(i.options.anchor!==t.anchor||i.options.maxWidth!==t.maxWidth)&&(i.options.anchor=t.anchor,i.setMaxWidth(t.maxWidth)),i.options.className!==t.className)){const l=zn(i.options.className),c=zn(t.className);for(const d of l)c.has(d)||i.removeClassName(d);for(const d of c)l.has(d)||i.addClassName(d);i.options.className=t.className}return pa.createPortal(t.children,r)}f.memo(f.forwardRef(Yu));function kt(t,e,s,a){const r=f.useContext(Zt),o=f.useMemo(()=>t(r),[]);return f.useEffect(()=>{const i=e,l=null,c=typeof e=="function"?e:null,{map:d}=r;return d.hasControl(o)||(d.addControl(o,i==null?void 0:i.position),l&&l(r)),()=>{c&&c(r),d.hasControl(o)&&d.removeControl(o)}},[]),o}function Xu(t){const e=kt(({mapLib:s})=>new s.AttributionControl(t),{position:t.position});return f.useEffect(()=>{ze(e._container,t.style)},[t.style]),null}f.memo(Xu);function Zu(t){const e=kt(({mapLib:s})=>new s.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return f.useEffect(()=>{ze(e._controlContainer,t.style)},[t.style]),null}f.memo(Zu);function Ku(t,e){const s=f.useRef({props:t}),a=kt(({mapLib:r})=>{const o=new r.GeolocateControl(t),i=o._setupUI;return o._setupUI=l=>{o._container.hasChildNodes()||i(l)},o.on("geolocate",l=>{var c,d;(d=(c=s.current.props).onGeolocate)===null||d===void 0||d.call(c,l)}),o.on("error",l=>{var c,d;(d=(c=s.current.props).onError)===null||d===void 0||d.call(c,l)}),o.on("outofmaxbounds",l=>{var c,d;(d=(c=s.current.props).onOutOfMaxBounds)===null||d===void 0||d.call(c,l)}),o.on("trackuserlocationstart",l=>{var c,d;(d=(c=s.current.props).onTrackUserLocationStart)===null||d===void 0||d.call(c,l)}),o.on("trackuserlocationend",l=>{var c,d;(d=(c=s.current.props).onTrackUserLocationEnd)===null||d===void 0||d.call(c,l)}),o},{position:t.position});return s.current.props=t,f.useImperativeHandle(e,()=>a,[]),f.useEffect(()=>{ze(a._container,t.style)},[t.style]),null}f.memo(f.forwardRef(Ku));function Ju(t){const e=kt(({mapLib:s})=>new s.NavigationControl(t),{position:t.position});return f.useEffect(()=>{ze(e._container,t.style)},[t.style]),null}f.memo(Ju);function Qu(t){const e=kt(({mapLib:o})=>new o.ScaleControl(t),{position:t.position}),s=f.useRef(t),a=s.current;s.current=t;const{style:r}=t;return t.maxWidth!==void 0&&t.maxWidth!==a.maxWidth&&(e.options.maxWidth=t.maxWidth),t.unit!==void 0&&t.unit!==a.unit&&e.setUnit(t.unit),f.useEffect(()=>{ze(e._container,r)},[r]),null}f.memo(Qu);const em=Fs(()=>import("./cdzweje6r9a6j1aw.js").then(t=>t.m),__vite__mapDeps([11,1])),tm=f.forwardRef(function(e,s){return Uu(e,s,em)}),sm=Vu,nm="pk.eyJ1Ijoib2FpLWRhdGEiLCJhIjoiY20yYzRzZmFtMGNqNjJscHo2dThqdnkwNCJ9.rTosfWNn9lUu4slvYfMzHg",am=t=>f.createElement("svg",A({width:20,height:20,viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},t),f.createElement("path",{d:"M10.001 1.83594C13.9484 1.83594 17.1659 4.90441 17.166 8.9873C17.166 11.8368 15.3695 14.1317 13.7002 15.6592C12.8541 16.4334 12.0106 17.0381 11.3799 17.4492C11.0639 17.6552 10.7992 17.8141 10.6123 17.9219C10.5189 17.9757 10.4443 18.0166 10.3926 18.0449C10.3667 18.059 10.3463 18.0705 10.332 18.0781C10.3251 18.0818 10.3195 18.0848 10.3154 18.0869C10.3134 18.088 10.3118 18.0892 10.3105 18.0898L10.3086 18.0908L10.001 17.501L10.3076 18.0908C10.1144 18.1913 9.88417 18.1912 9.69141 18.0898L10.001 17.501L9.69043 18.0889L9.68848 18.0879C9.68724 18.0872 9.68554 18.086 9.68359 18.085C9.67954 18.0828 9.67396 18.0799 9.66699 18.0762C9.65272 18.0685 9.63232 18.0573 9.60645 18.043C9.55471 18.0144 9.48007 17.9733 9.38672 17.9189C9.19995 17.8102 8.93589 17.6498 8.62012 17.4424C7.98975 17.0283 7.14642 16.4199 6.30078 15.6436C4.63333 14.1126 2.83594 11.8176 2.83594 8.9873C2.83602 4.90441 6.05356 1.83594 10.001 1.83594Z",fill:"rgb(85, 84, 84)",stroke:"rgb(85, 84, 84)",strokeWidth:1,strokeLinejoin:"round",paintOrder:"stroke fill"}),f.createElement("circle",{cx:10,cy:9,r:3,fill:"white"})),rm=t=>f.createElement("svg",A({width:20,height:20,viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},t),f.createElement("path",{d:"M10.001 1.83594C13.9484 1.83594 17.1659 4.90441 17.166 8.9873C17.166 11.8368 15.3695 14.1317 13.7002 15.6592C12.8541 16.4334 12.0106 17.0381 11.3799 17.4492C11.0639 17.6552 10.7992 17.8141 10.6123 17.9219C10.5189 17.9757 10.4443 18.0166 10.3926 18.0449C10.3667 18.059 10.3463 18.0705 10.332 18.0781C10.3251 18.0818 10.3195 18.0848 10.3154 18.0869C10.3134 18.088 10.3118 18.0892 10.3105 18.0898L10.3086 18.0908L10.001 17.501L10.3076 18.0908C10.1144 18.1913 9.88417 18.1912 9.69141 18.0898L10.001 17.501L9.69043 18.0889L9.68848 18.0879C9.68724 18.0872 9.68554 18.086 9.68359 18.085C9.67954 18.0828 9.67396 18.0799 9.66699 18.0762C9.65272 18.0685 9.63232 18.0573 9.60645 18.043C9.55471 18.0144 9.48007 17.9733 9.38672 17.9189C9.19995 17.8102 8.93589 17.6498 8.62012 17.4424C7.98975 17.0283 7.14642 16.4199 6.30078 15.6436C4.63333 14.1126 2.83594 11.8176 2.83594 8.9873C2.83602 4.90441 6.05356 1.83594 10.001 1.83594Z",fill:"white",stroke:"rgb(85, 84, 84)",strokeWidth:1,strokeLinejoin:"round",paintOrder:"stroke fill"}),f.createElement("circle",{cx:10,cy:9,r:3,fill:"rgb(85, 84, 84)"})),Bn=50,Wn=20,Hn=20,Un=20,om=400;function im(t){"use forget";const e=ge.c(37),{contentReference:s,clientThreadId:a,messageId:r,trackContentReferenceEvent:o}=t,i=s.entities,l=f.useRef(!0),c=f.useRef(null),d=f.useRef(null);let u;e[0]===Symbol.for("react.memo_cache_sentinel")?(u={longitude:0,latitude:0,zoom:12,pitch:0,bearing:0},e[0]=u):u=e[0];const[m,b]=f.useState(u),[y,v]=f.useState(-1),g=f.useRef(y);let j;e[1]===Symbol.for("react.memo_cache_sentinel")?(j=B=>{g.current=B,v(B)},e[1]=j):j=e[1];const _=j,N=!gt(),k=f.useRef(!1);let h,w;e[2]!==o?(h=()=>{k.current||(o("Search Content Reference Shown","search_content_reference_shown","map"),k.current=!0)},w=[o],e[2]=o,e[3]=h,e[4]=w):(h=e[3],w=e[4]),f.useEffect(h,w);let S,p;e[5]===Symbol.for("react.memo_cache_sentinel")?(S=()=>{if(!c.current)return;const B=tl(()=>{var X;(X=d.current)==null||X.resize()},100),z=new ResizeObserver(B);return z.observe(c.current),()=>{z.disconnect()}},p=[],e[5]=S,e[6]=p):(S=e[5],p=e[6]),f.useEffect(S,p);let C,M;e[7]!==i||e[8]!==y?(C=()=>{const B=function(){var ne;const X=function(ee,ie){const te=d.current;if(!te)return!1;const{width:ae,height:le}=te.getContainer().getBoundingClientRect(),re=te.unproject([Wn,Bn]),he=te.unproject([ae-Hn,le-Un]);return Te(ee,5)>=Te(he.lat,5)&&Te(ee,5)<=Te(re.lat,5)&&Te(ie,5)>=Te(re.lng,5)&&Te(ie,5)<=Te(he.lng,5)},H=ku(i.filter((Q,ee)=>l.current||y===-1||ee===y).map(cm)),Z=Su(H),fe=Nu(H);if(c.current){const Q=c.current.clientWidth,ee=c.current.clientHeight,ie=new zt({width:Q,height:ee,longitude:fe.geometry.coordinates[0],latitude:fe.geometry.coordinates[1]}),{zoom:te,latitude:ae,longitude:le}=ie.fitBounds([[Z[0],Z[1]],[Z[2],Z[3]]],{maxZoom:13.5,padding:{top:Bn,left:Wn,right:Hn,bottom:Un}});l.current?(b(re=>O(A({},re),{zoom:te,latitude:ae,longitude:le})),l.current=!1):X(ae,le)||(ne=d.current)==null||ne.flyTo({center:[le,ae]})}};i.length!==0&&(l.current?B():setTimeout(B,200))},M=[i,y],e[7]=i,e[8]=y,e[9]=C,e[10]=M):(C=e[9],M=e[10]),f.useEffect(C,M);const{openThreadSidebar:E}=_t(),{resetSidebarHistory:T}=Ma(),L=Is();let I;e[11]!==a||e[12]!==s.start_idx||e[13]!==L||e[14]!==r||e[15]!==E||e[16]!==T?(I=(B,z)=>{_(B),a&&(L||T(),E({type:"entity",clientThreadId:a,debugThreadId:void 0,messageId:r,contentReferenceStartIndex:s.start_idx,query:z.name,category:"local_business",extraParams:z.entity.location?{location:z.entity.location}:void 0}))},e[11]=a,e[12]=s.start_idx,e[13]=L,e[14]=r,e[15]=E,e[16]=T,e[17]=I):I=e[17];const $=I,x=jt();let R;if(e[18]!==i||e[19]!==x||e[20]!==$||e[21]!==y||e[22]!==o){let B;e[24]!==y?(B=(X,H)=>X.idx===y?1:H.idx===y?-1:X.idx-H.idx,e[24]=y,e[25]=B):B=e[25];let z;e[26]!==x||e[27]!==$||e[28]!==y||e[29]!==o?(z=X=>{const{business:H,idx:Z}=X,ne=Z==y?am:rm;return n.jsx(sm,{longitude:H.longitude,latitude:H.latitude,anchor:"bottom",children:n.jsx(Le,{label:n.jsx(dm,{business:H.entity,idx:Z,trackContentReferenceEvent:o,onOpenEntity:()=>$(Z,H)}),onOpenChange:Q=>_(Q?Z:-1),delayDuration:150,theme:x?"default":"white",customPaddingClassName:"bg-clip-padding",cornerRadius:"2xl",customBorderClassName:"border-token-border-default border",contentClassName:"animate-show",side:"top",sideOffset:10,wide:!0,interactive:!0,children:n.jsxs("div",{className:"relative",children:[n.jsx(ne,{className:"h-auto w-7"}),n.jsx("div",{className:"absolute start-1/2 top-full -translate-x-1/2 font-bold text-nowrap text-gray-700 [text-shadow:_-0.8px_-0.8px_0_#fff,_0.8px_-0.8px_0_#fff,_-0.8px_0.8px_0_#fff,_0.8px_0.8px_0_#fff]",children:H.name}),n.jsx("div",{className:"absolute inset-0 cursor-pointer rounded-xl",onClick:Q=>{Q.preventDefault(),_(Z),$(Z,H)}})]})},Z)},Z)},e[26]=x,e[27]=$,e[28]=y,e[29]=o,e[30]=z):z=e[30],R=i.map(lm).sort(B).map(z),e[18]=i,e[19]=x,e[20]=$,e[21]=y,e[22]=o,e[23]=R}else R=e[23];const F=R;let q;e[31]!==N||e[32]!==F||e[33]!==m?(q=!N&&n.jsx("div",{className:"bg-token-bg-primary pt-2",children:n.jsxs("div",{style:{height:om},className:"bg-token-bg-primary relative w-full",ref:c,children:[n.jsx("div",{className:"relative h-full w-full overflow-hidden rounded-xl",children:n.jsx(tm,O(A({},m),{mapboxAccessToken:nm,mapStyle:"mapbox://styles/mapbox/streets-v12",attributionControl:!1,renderWorldCopies:!1,onMove:B=>b(B.viewState),ref:d,keyboard:!1,children:F}))}),n.jsx("div",{className:"absolute start-3 top-3",children:n.jsx(fm,{})})]})}),e[31]=N,e[32]=F,e[33]=m,e[34]=q):q=e[34];let G;return e[35]!==q?(G=n.jsx(sl,{children:n.jsx("div",{className:"not-prose","data-testid":"businesses-map-widget",children:q})}),e[35]=q,e[36]=G):G=e[36],G}function lm(t,e){return{business:t,idx:e}}function cm(t){return rr([t.longitude,t.latitude])}function dm({business:t,idx:e,trackContentReferenceEvent:s,onOpenEntity:a}){var d;const r=!gt(),o={section:"map",section_location:"response",section_index:e},i="https://www.google.com/maps/dir/?api=1&destination=".concat(encodeURIComponent([t.name,t.address].join(",")));t.address&&s("link_action",null,"map",O(A({},o),{url:i,link_type:"button",action:"show"})),t.website_url&&s("link_action",null,"map",O(A({},o),{url:t.website_url,link_type:"button",action:"show"}));function l(){return n.jsx(n.Fragment,{children:n.jsxs("div",{className:"text-token-text-primary mt-auto flex min-h-9 w-full min-w-0 flex-wrap justify-center gap-2 text-base",children:[t.address&&n.jsx(xe,{onClick:()=>{s("link_action",null,"map",O(A({},o),{url:i,link_type:"button",action:"click"}))},as:"link",to:i,openNewTab:!0,rel:"noreferrer",color:"secondary",size:"small",className:"min-w-25 flex-1 rounded-full border",contentWrapperClassName:"text-token-text-primary font-semibold",children:n.jsx(D,{id:"+a2f/C",defaultMessage:"Directions"})}),t.website_url&&n.jsx(xe,{onClick:()=>{s("link_action",null,"map",O(A({},o),{url:t.website_url,link_type:"button",action:"click"}))},as:"link",to:t.website_url,openNewTab:!0,rel:"noreferrer",color:"secondary",size:"small",className:"min-w-25 flex-1 rounded-full border",contentWrapperClassName:"text-token-text-primary font-semibold",children:n.jsx(D,{id:"r0oqXM",defaultMessage:"Website"})}),t.phone&&n.jsx(xe,{as:"link",to:"tel:"+t.phone,openNewTab:!0,rel:"noreferrer",color:"secondary",size:"small",className:"min-w-25 flex-1 rounded-full border",contentWrapperClassName:"text-token-text-primary font-semibold",children:n.jsx(D,{id:"B/an6M",defaultMessage:"Call"})})]})})}const c=(d=t.image_urls)==null?void 0:d[0];return n.jsx(Dt.div,{initial:{x:"0%",opacity:0,pointerEvents:"none",transition:{duration:.1,ease:"easeOut"}},animate:{x:"0%",opacity:1,pointerEvents:"auto",transition:{duration:.15,ease:"easeOut"}},children:n.jsxs("div",{className:P("bg-token-main-surface-primary relative rounded-xl text-start font-normal"),children:[n.jsxs("div",{className:"flex flex-col gap-2 p-3",children:[n.jsxs("div",{className:"flex gap-3",children:[n.jsx("div",{className:"h-23 w-23 shrink-0 cursor-pointer overflow-hidden rounded-lg",onClick:u=>{u.preventDefault(),a==null||a()},children:c?n.jsx("img",{className:"h-full w-full object-cover",src:c!=null?c:void 0,alt:t.name}):n.jsx("div",{className:"h-full w-full bg-gray-100"})}),n.jsxs("div",{className:"flex min-w-0 flex-1 flex-col",children:[n.jsx("div",{className:"hover:entity-accent line-clamp-2 inline w-full cursor-pointer align-baseline text-base font-medium",onClick:u=>{u.preventDefault(),a==null||a()},children:t.name}),n.jsx("div",{className:"text-token-text-secondary text-sm",children:n.jsx(um,{business:t})})]})]}),!r&&n.jsx("div",{className:"mt-1",children:l()})]}),r&&l()]})})}function um({business:t}){var c,d;const e=W(),s=(d=(c=t.categories)==null?void 0:c[0])!=null?d:null,a=t.next_open_hour;let r=null,o;t.is_open!=null&&(r=t.is_open?e.formatMessage({id:"rNSVso",defaultMessage:"Open now"}):e.formatMessage({id:"3WBPtG",defaultMessage:"Closed"}),a&&(o=a.day===new Date().getDay()?e.formatMessage({id:"3IYYo+",defaultMessage:"until {time}"},{time:qn(e,t.is_open?a.end:a.start)}):e.formatMessage({id:"R23xLn",defaultMessage:"until {day} {time}"},{day:mm(e,a.day),time:qn(e,t.is_open?a.end:a.start)})));const i=t.rating,l=t.price!=null?"$".repeat(t.price):t.price_str!=null?t.price_str:null;return n.jsxs("div",{className:"flex flex-col gap-0.5",children:[s&&n.jsx("div",{className:"truncate",children:s}),r&&n.jsxs("div",{children:[n.jsx("span",{className:t.is_open?"text-green-600":"text-token-text-secondary",children:r}),o&&n.jsx("span",{className:"ms-1",children:o})]}),n.jsxs("div",{className:"flex items-center gap-1",children:[i!=null&&n.jsxs(n.Fragment,{children:[n.jsx(Ta,{className:"icon-sm text-token-text-secondary"}),n.jsx("span",{className:"text-token-text-primary",children:i.toFixed(1)})]}),l&&n.jsx("span",{className:"text-token-text-secondary font-black",children:n.jsx(D,{id:"IqwxqE",defaultMessage:"·"})}),l&&n.jsx("span",{className:"text-token-text-secondary",children:l})]})]})}function qn(t,e){const s=e.slice(0,2),a=e.slice(2,4),r=new Date(0,0,0,parseInt(s,10),parseInt(a,10));return t.formatTime(r,{hour:"numeric",minute:"2-digit"})}function mm(t,e){return t.formatDate(new Date(0,0,e),{weekday:"short"})}function fm(){const[t,e]=f.useState(!1),s=()=>e(r=>!r),a=t?Qi:el;return n.jsxs("div",{className:P("text-token-text-tertiary flex h-5 items-center justify-start overflow-hidden rounded-full text-[10px] font-light whitespace-nowrap transition-all",t?"w-full bg-white":"w-5 bg-white/50"),children:[n.jsx("button",{onClick:s,className:P("transition-all",t?"ms-1":"ms-[2px] mt-[1px]"),children:n.jsx(a,{className:"icon-sm hover:text-token-text-secondary transition-colors"})}),n.jsxs("div",{className:"ps-1 pe-2",children:["© ",n.jsx("a",{href:"https://www.mapbox.com/about/maps",target:"_blank",rel:"noreferrer",className:"text-[#2964aa]!",children:"Mapbox"})," ",n.jsx("a",{href:"https://www.mapbox.com/legal/end-user-terms",target:"_blank",rel:"noreferrer",className:"me-2 text-[#2964aa]!",children:n.jsx(D,{id:"u3dZJq",defaultMessage:"Terms"})}),"© ",n.jsx("a",{href:"http://www.openstreetmap.org/about",target:"_blank",rel:"noreferrer",className:"text-[#2964aa]!",children:"OpenStreetMap"})]})]})}const ke={TTFP:"products.ttfp",TTLT:"products.ttlt",TTF_VISIBLE_CONTENT_TOKEN:"products.ttf_visible_content_token"},Gs={[ke.TTFP]:new Set,[ke.TTLT]:new Set,[ke.TTF_VISIBLE_CONTENT_TOKEN]:new Set};function ms({profiler:t,messageId:e,metric:s,overrideDurationMs:a}){Gs[s].add(e);const r=zo();t.logTimingOnce(s,{context:{eval_preset:r.eval_preset},overrideDurationMs:a})}function fs({messageId:t,metric:e}){return Gs[e].has(t)}function lr(t){"use forget";const e=ge.c(27),{clientThreadId:s,messageId:a,products:r}=t;let o;e[0]!==a?(o=h=>[Je.getRequestId(h),Je.isMessageTurnEnded(h,a)],e[0]=a,e[1]=o):o=e[1];const[i,l]=nt(s,o);let c;e[2]!==s?(c={namespace:Fo.ProductsCompletionRequest,clientThreadId:s},e[2]=s,e[3]=c):c=e[3];const{profiler:d,isRequestActive:u}=Do(c),m=u&&!l,b=Xl(m);let y,v;e[4]!==m||e[5]!==a||e[6]!==r.length||e[7]!==d?(y=()=>{fs({messageId:a,metric:ke.TTFP})||d&&m&&r.length>0&&ms({profiler:d,messageId:a,metric:ke.TTFP})},v=[m,a,r.length,d],e[4]=m,e[5]=a,e[6]=r.length,e[7]=d,e[8]=y,e[9]=v):(y=e[8],v=e[9]),f.useEffect(y,v);let g,j;e[10]!==m||e[11]!==a||e[12]!==b||e[13]!==d?(g=()=>{fs({messageId:a,metric:ke.TTLT})||d&&b.current&&!m&&ms({profiler:d,messageId:a,metric:ke.TTLT})},j=[a,b,m,d],e[10]=m,e[11]=a,e[12]=b,e[13]=d,e[14]=g,e[15]=j):(g=e[14],j=e[15]),f.useEffect(g,j);const _=J();let N;e[16]!==_||e[17]!==a||e[18]!==d||e[19]!==i?(N=()=>{if(fs({messageId:a,metric:ke.TTF_VISIBLE_CONTENT_TOKEN}))return;const h=i?Oo(_,i):null;if(d&&h){const w=ke.TTF_VISIBLE_CONTENT_TOKEN;Gs[w].add(a),ms({profiler:d,messageId:a,metric:w,overrideDurationMs:h.turnTracker.first_visible_content_token_lat})}},e[16]=_,e[17]=a,e[18]=d,e[19]=i,e[20]=N):N=e[20];let k;e[21]!==_||e[22]!==a||e[23]!==r.length||e[24]!==d||e[25]!==i?(k=[a,d,i,r.length,_],e[21]=_,e[22]=a,e[23]=r.length,e[24]=d,e[25]=i,e[26]=k):k=e[26],f.useEffect(N,k)}function hm({contentReference:t,clientThreadId:e,messageId:s,turnIndex:a,trackContentReferenceEvent:r}){const o=f.useCallback(()=>r("Search Content Reference Shown","search_content_reference_shown","product_entity",{content_reference_start_index:t.start_idx,product_id:t.product.id}),[r,t.start_idx,t.product.id]),i=f.useCallback(()=>r("Search Content Reference Clicked","search_content_reference_clicked","product_entity",{content_reference_start_index:t.start_idx,product_id:t.product.id}),[r,t.start_idx,t.product.id]),l=t.product;f.useEffect(()=>o(),[o]),lr({clientThreadId:e,messageId:s,products:[l]});const{openThreadSidebar:c}=_t();return n.jsx("span",{className:"entity-underline hover:entity-accent inline cursor-pointer align-baseline",onClick:()=>{if(i(),l.offers||!l.url){if(!e)return;c({type:"product",clientThreadId:e,messageId:s,turnIndex:a,contentReferenceStartIndex:t.start_idx,productIndex:0,productUrl:l.url,interactionSource:"inline_link"})}else window.open(l.url,"_blank")},children:n.jsx("span",{className:"whitespace-normal",children:l.title})})}function cr({items:t,targetItemCount:e,onCardRender:s,onCardShown:a,onCardClicked:r,onReplyClicked:o,allowFullWidth:i=!1,cardClassName:l,showGradient:c=!0,arrowClassName:d}){const u=f.useRef(null),[m,b]=f.useState(null),y=f.useRef(null),v=()=>{y.current=setTimeout(()=>{b(null),y.current=null},200)},g=()=>{y.current&&(clearTimeout(y.current),y.current=null)},j=f.useRef(null),[_,N]=f.useState({left:0,top:0}),k=8;f.useEffect(()=>{const C=u.current,M=j.current;if(!o||!m||!C||!M)return;const E=()=>{const T=m.card.getBoundingClientRect(),L=C.getBoundingClientRect(),I=M.getBoundingClientRect(),$=T.bottom-L.top+k;var x=T.left-L.left;x=Math.max(0,x),x=Math.min(x,L.width-I.width),N({left:x,top:$})};return E(),C.addEventListener("scroll",E),()=>C.removeEventListener("scroll",E)},[m,t,o]);const h=vt(),w=h?2:4;if(e===void 0)e=t.length;else if(!e&&t.length<w)return null;const S=(e!=null?e:t.length)>=w,p=S&&h;return n.jsxs("div",{className:"relative",children:[n.jsx("div",{ref:u,className:P("flex flex-row gap-4 py-2",p&&"mx-[-1rem] px-[1rem]",S&&"no-scrollbar snap-x snap-proximity scroll-ps-4 overflow-x-scroll scroll-smooth"),children:t.map((C,M)=>n.jsx("div",{className:P(S||!i?"thread-lg:w-61 w-50 shrink-0 snap-start":"min-w-0 flex-1"),children:n.jsx(pm,{cardClassName:l,onShown:()=>a(C,M),onClick:()=>r(C,M),onHover:E=>{g(),E?b({card:E,item:C,index:M}):v()},children:s(C,!h&&e===1)})},M))}),S&&!p&&n.jsx(xm,{scrollableRef:u,units:t.length,showGradient:c,arrowClassName:d}),o&&n.jsx("div",{ref:j,className:P("absolute z-10",m?"pointer-events-auto opacity-100":"pointer-events-none opacity-0","transition-[transform,opacity] duration-200"),style:{willChange:"opacity, transform",left:_.left,top:_.top,transform:m?"translateY(0)":"translateY(".concat(-k,"px)")},onMouseEnter:g,onMouseLeave:v,children:n.jsx(xe,{className:P(m?"pointer-events-auto":"pointer-events-none","border-light bg-clip-padding px-4 py-2 shadow-md"),size:"small",color:"secondary",onClick:()=>m&&o(m.item,m.index),children:n.jsxs("div",{className:"flex flex-row items-center gap-1",children:[n.jsx(Zl,{className:"icon-sm text-token-text-secondary"}),n.jsx(D,{id:"9TG7OR",defaultMessage:"Ask about this"})]})})})]})}function pm({onShown:t,onClick:e,onHover:s,children:a,cardClassName:r}){const o=f.useRef(null),i=f.useRef(t);return f.useEffect(()=>{i.current=t},[t]),f.useEffect(()=>{if(!o.current)return;const l=new IntersectionObserver(([c])=>c.isIntersecting&&i.current(),{threshold:.5});return l.observe(o.current),()=>l.disconnect()},[]),n.jsx("div",{ref:o,className:P("h-full w-full","bg-token-bg-primary cursor-pointer",r),onClick:e,onMouseEnter:()=>o.current&&s(o.current),onMouseLeave:()=>s(null),children:a})}function xm({scrollableRef:t,units:e,showGradient:s,arrowClassName:a}){const[r,o]=f.useState({left:!1,right:!1}),[i,l]=f.useState(!1);f.useEffect(()=>{const d=t.current;if(!d)return;const u=()=>{const{scrollLeft:m,scrollWidth:b,clientWidth:y}=d,v=m/(b-y);o({left:v>0,right:v<1}),!i&&m>0&&l(!0)};return u(),d.addEventListener("scroll",u),()=>d.removeEventListener("scroll",u)},[t,e,i]);const c=d=>{if(!t.current)return;l(!0);const{clientWidth:u,scrollWidth:m}=t.current,b=m/e,y=Math.floor(u/b)*b;t.current.scrollBy({left:y*d,behavior:"smooth"})};return n.jsxs("div",{className:"pointer-events-none absolute start-0 top-0 flex h-full w-full flex-row",children:[n.jsx("div",{className:P("flex h-full w-9 items-center justify-start",i&&s&&"bg-linear-to-r from-(--bg-primary) to-transparent",r.left?"opacity-100":"opacity-0","transition-opacity duration-100"),children:n.jsx(xe,{color:"secondary",size:"small",className:P("border-token-border-default active:bg-token-bg-tertiary hover:bg-token-bg-primary h-8 w-8 translate-x-[-50%] rounded-full bg-clip-padding hover:shadow-[0px_4px_16px_0px_rgba(0,0,0,0.05)] active:opacity-100!",a),onClick:()=>c(-1),children:n.jsx(Na,{className:"icon"})})}),n.jsx("div",{className:P("ms-auto flex h-full w-9 items-center justify-end",i&&s&&"bg-linear-to-l from-(--bg-primary) to-transparent",r.right?"opacity-100":"opacity-0","transition-opacity duration-200"),children:n.jsx(xe,{color:"secondary",size:"small",className:P("border-token-border-default active:bg-token-bg-tertiary hover:bg-token-bg-primary h-8 w-8 translate-x-[50%] rounded-full bg-clip-padding hover:shadow-[0px_4px_16px_0px_rgba(0,0,0,0.05)] active:opacity-100!",a),onClick:()=>c(1),children:n.jsx(Ls,{className:"icon"})})})]})}function gm({contentReference:t,clientThreadId:e,messageId:s,turnIndex:a,analyticsMetadata:r}){const o=t.products,i=t.target_product_count;lr({clientThreadId:e,messageId:s,products:o});const{showDebugConversationTurns:l}=nl(),c=nt(e,w=>{var C,M;const p=(M=(C=Je.getNode(w,s).message.metadata)==null?void 0:C.content_references)==null?void 0:M.find(E=>E.type==="products");return t.start_idx===(p==null?void 0:p.start_idx)}),d=J(),u=K(d,"3144771298"),m=wt(d),b=Yt(d),y=K(d,"2212894775"),v=Ea(r),g=f.useCallback((w,S)=>v("Search Content Reference Shown","search_content_reference_shown","products",{content_reference_start_index:t.start_idx,product_index:S,product_id:w.id,product_url:w.url}),[v,t.start_idx]),j=f.useCallback((w,S)=>v("Search Content Reference Clicked","search_content_reference_clicked","products",{content_reference_start_index:t.start_idx,product_index:S,product_id:w.id}),[v,t.start_idx]),{openThreadSidebar:_}=_t(),N=(w,S)=>{e&&(j(w,S),w.offers?_({type:"product",clientThreadId:e,messageId:s,turnIndex:a,contentReferenceStartIndex:t.start_idx,productIndex:S,productUrl:w.url,interactionSource:"carousel"}):window.open(w.url,"_blank"))},{setTargetedContent:k}=Bo(),h=(w,S)=>{$e.logEventWithStatsig("Product Targeted Reply Clicked","product_targeted_reply_clicked",O(A({},bt(r)),{content_reference_start_index:t.start_idx,product_index:(S+1).toString(),product_id:w.id})),k({type:"object",label:w.title,createNewCompletionParams:p=>{var M;const C=al(w.title);return O(A({},p),{promptMessage:Wo(p.promptMessage,{metadata:{targeted_reply:w.title,targeted_reply_label:w.title,targeted_reply_icon:"product_tag"}}),appendMessages:[...(M=p.appendMessages)!=null?M:[],C]})},onCreateCompletion:({serverThreadId:p,currentLeafId:C})=>{$e.logEventWithStatsig("Targeted Reply Submitted","chatgpt_targeted_reply_submitted",{conversation_id:p,current_leaf_id:C,source_message_id:s,content_reference_start_index:t.start_idx,product_index:(S+1).toString(),product_id:w.id})},onCleared:({serverThreadId:p,currentLeafId:C})=>{$e.logEventWithStatsig("Targeted Reply Cleared","chatgpt_targeted_reply_cleared",{conversation_id:p,current_leaf_id:C,source_message_id:s,content_reference_start_index:t.start_idx,product_index:(S+1).toString(),product_id:w.id})}})};if(t.inline_carousel&&o.length===1){const w=o[0];return n.jsx("div",{className:"flex flex-col","data-testid":"shopping-widget",children:n.jsx(wm,{product:w,showDebug:l,onShown:()=>g(w,0),onClicked:()=>N(w,0)})})}return n.jsxs("div",{className:"flex flex-col","data-testid":"products-widget",children:[m?n.jsx("div",{className:P("relative mb-6",b?"-mx-[var(--thread-content-margin)]":"-mx-6"),children:n.jsx(As,{items:o,getItemKey:w=>w.id,onRenderItem:w=>n.jsx(Gn,{product:w,wide:!1,showDebug:l,isProductV2CardEnabled:y}),className:"min-h-36",itemClassName:"max-w-[200px] min-w-[120px] sm:max-w-[calc((var(--thread-content-max-width)-2rem)/3)] thread-lg:w-61 w-50 shrink-0 border-none",arrowClassName:y?"translate-y-[-85%]!":"",onShown:g,onClick:N})}):n.jsx(cr,{items:o,targetItemCount:i,onCardRender:(w,S)=>n.jsx(Gn,{product:w,wide:S,showDebug:l,isProductV2CardEnabled:y}),onCardShown:g,onCardClicked:N,onReplyClicked:y?void 0:h,arrowClassName:y?"translate-y-[-85%]":"",allowFullWidth:!0,showGradient:!y,cardClassName:P(y?"group":"transition-all duration-200 border-token-border-default hover:border-light border rounded-xl bg-clip-padding hover:shadow-md overflow-hidden")}),c&&u&&!y&&n.jsxs("div",{className:"text-token-text-tertiary flex text-xs hover:cursor-pointer hover:underline",onClick:()=>window.open("https://help.openai.com/en/articles/11128490","_blank"),children:[n.jsx(D,{id:"4Y5Zn5",defaultMessage:"ChatGPT chooses products independently. Learn more"}),n.jsx(Ls,{className:"icon -ms-0.5"})]})]})}function Gn(t){"use forget";const e=ge.c(5),{product:s,wide:a,showDebug:r,isProductV2CardEnabled:o}=t,i=r===void 0?!1:r;let l;return e[0]!==o||e[1]!==s||e[2]!==i||e[3]!==a?(l=o?n.jsx(ym,{product:s,wide:a,showDebug:i}):n.jsx(bm,{product:s,wide:a,showDebug:i}),e[0]=o,e[1]=s,e[2]=i,e[3]=a,e[4]=l):l=e[4],l}function bm({product:t,wide:e,showDebug:s=!1}){var l,c;const a=t.image_urls?t.image_urls[0]:void 0,[r,o]=f.useState("contain"),i=f.useRef(null);return n.jsxs("div",{className:P("flex",e?"flex-row":"flex-col"),children:[n.jsxs("div",{className:P("relative aspect-square",e?"w-1/3":"w-full","bg-token-main-surface-secondary dark:bg-token-main-surface-primary-inverse"),children:[a?n.jsx("img",{ref:i,className:"absolute inset-0 m-0 h-full w-full mix-blend-darken object-".concat(r),src:a,alt:t.title,onLoad:()=>{if(!i.current)return;const{naturalWidth:d,naturalHeight:u}=i.current,m=d/u;o(Math.abs(m-1)<.25?"cover":"contain")}}):n.jsx("div",{className:"flex aspect-square items-center justify-center",children:n.jsx(Gt,{className:"text-token-text-tertiary h-12 w-12"})}),t.featured_tag&&n.jsx("div",{className:"absolute start-3 end-3 bottom-3",children:n.jsxs("div",{className:"relative max-w-fit px-2 py-1",children:[n.jsx("div",{className:"absolute inset-0 rounded-full bg-white/60 backdrop-blur-xl"}),n.jsx("div",{className:"relative truncate text-xs font-semibold text-gray-950",children:t.featured_tag})]})})]}),n.jsxs("div",{className:"flex flex-1 flex-col p-4",children:[n.jsx("div",{className:"line-clamp-2 leading-snug font-semibold text-ellipsis",children:t.title}),t.description&&n.jsx("div",{className:"line-clamp-3 pt-3 text-sm text-ellipsis",children:t.description}),n.jsx("div",{className:"flex-1"}),n.jsxs("div",{className:"flex flex-row items-end pt-3",children:[n.jsxs("div",{className:"flex flex-col overflow-hidden",children:[n.jsx("div",{className:"text-md leading-snug font-semibold",children:t.price}),n.jsx("div",{className:"text-token-text-secondary overflow-hidden pt-0.5 text-xs text-ellipsis whitespace-nowrap",children:t.merchants})]}),n.jsx("div",{className:"flex-1"}),t.num_reviews&&t.num_reviews>0&&n.jsxs("div",{className:"text-token-text-secondary flex w-fit flex-row gap-1 text-sm",children:[n.jsx(Ho,{rating:(l=t.rating)!=null?l:0/5}),((c=t.rating)!=null?c:0).toFixed(1)]})]}),!1]})]})}function ym({product:t,wide:e,showDebug:s=!1}){const a=t.image_urls?t.image_urls[0]:void 0,[r,o]=f.useState("contain"),[i,l]=f.useState("top"),c=f.useRef(null);return n.jsxs("div",{className:P("flex pb-2",e?"flex-row gap-3":"flex-col gap-2"),children:[n.jsx("div",{className:P("relative",e?"aspect-square w-1/4":"aspect-[13/16] w-full","bg-token-bg-tertiary dark:bg-token-text-inverted overflow-clip rounded-xl"),children:n.jsx(Ca,{className:"mix-blend-darken dark:mix-blend-lighten",children:a?n.jsx("img",{ref:c,className:"absolute inset-0 m-0 h-full w-full object-".concat(r," object-").concat(i),src:a,alt:t.title,onLoad:()=>{if(!c.current)return;const{naturalWidth:d,naturalHeight:u}=c.current,m=d/u;o(Math.abs(m-1)<.4?"cover":"contain"),l(u>d?"top":"center")}}):n.jsx("div",{className:"flex aspect-square items-center justify-center",children:n.jsx(Gt,{className:"text-token-text-tertiary h-12 w-12"})})})}),n.jsxs("div",{className:"flex flex-col gap-1 px-1",children:[n.jsx("div",{className:P("line-clamp-2 font-medium text-ellipsis",e?"text-base":"text-sm"),children:t.title}),n.jsxs("div",{className:"text-token-text-secondary flex flex-row gap-0.25 text-sm",children:[n.jsx("div",{children:t.price}),n.jsx("div",{className:"mx-0.5",children:"•"}),n.jsx("div",{className:"truncate",children:t.merchants})]}),!1]})]})}function vm({className:t,imageUrl:e,productTitle:s,onClicked:a}){const[r,o]=f.useState("contain"),i=f.useRef(null);return n.jsx("div",{className:P(t,"hover:scale-[1.005]","dark:bg-token-text-inverted bg-token-bg-primary","cursor-pointer overflow-hidden rounded-xl shadow-inner transition-all duration-200","relative aspect-square max-h-60"),onClick:a,children:e?n.jsx("img",{ref:i,className:"m-0 h-full w-full overflow-hidden object-".concat(r," mix-blend-darken"),src:e,alt:s,onLoad:()=>{if(!i.current)return;const{naturalWidth:l,naturalHeight:c}=i.current,d=l/c;o(Math.abs(d-1)<.5?"cover":"contain")}}):n.jsx("div",{className:"flex aspect-square items-center justify-center",children:n.jsx(Gt,{className:"text-token-text-tertiary h-12 w-12"})})})}function wm({product:t,showDebug:e=!1,onShown:s,onClicked:a}){return f.useEffect(()=>{s()},[s]),n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"flex flex-row gap-2 py-2",children:t.image_urls&&t.image_urls.length>0&&t.image_urls.slice(0,3).map(r=>n.jsx(vm,{imageUrl:r,productTitle:t.title,onClicked:a},r))}),!1]})}function _m({metadata:t,trackContentReferenceEvent:e}){var i;const s=Er(),a=J(),r=pt(),o=K(a,"3375735072");return f.useEffect(()=>{e("Search Content Reference Shown","search_content_reference_shown",t.type,{checkout_id:t.checkout_id})},[e,t.type,t.checkout_id]),o?n.jsxs("div",{className:"border-token-border-default bg-token-bg-primary not-prose mb-6 flex max-w-[420px] flex-col gap-4 rounded-[20px] border py-4 shadow-[0px_4px_16px_0px_rgba(0,_0,_0,_0.05)]","data-order-id":t.checkout_id,role:"group",children:[n.jsxs("div",{className:"flex items-center gap-2 px-4 text-sm font-medium",children:[n.jsx(rl,{className:"icon-lg text-green-400"}),n.jsx(D,{id:"checkout_purchase_confirmation_status",defaultMessage:"Purchase complete"})]}),n.jsxs("div",{className:"border-token-border-light flex items-start gap-3 border-b px-4 pb-4",children:[n.jsx("div",{className:"flex-shrink-0 overflow-hidden rounded-xl bg-gray-100 dark:bg-gray-700",children:n.jsx("img",{src:t.product_image_urls[0],alt:t.title,className:"m-0 aspect-square h-32 w-32 object-cover mix-blend-darken dark:mix-blend-lighten"})}),n.jsxs("div",{className:"min-w-0 flex-1",children:[n.jsx("div",{className:"line-clamp-2 min-h-6 text-base leading-snug font-medium",title:t.title,children:t.title}),n.jsx("div",{className:"text-token-text-secondary text-[13px] leading-snug whitespace-pre-wrap",children:t.subtitle})]})]}),t.error_message&&n.jsx("div",{className:"bg-token-bg-status-error text-token-interactive-label-danger-secondary-default mx-4 flex items-center rounded-lg px-3 py-1 text-sm",children:t.error_message}),n.jsx("dl",{className:"space-y-1 px-4",children:(i=t.details)==null?void 0:i.map(l=>n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("dt",{className:"text-token-text-secondary flex-grow text-[13px] font-medium",children:l.label}),n.jsx("dd",{className:"text-token-text-primary text-[13px] font-medium",children:l.value})]},l.label))}),!r&&n.jsx("div",{className:"px-4",children:n.jsx(xe,{fullWidth:!0,color:"secondary",className:"rounded-2xl border",onClick:()=>{s("#settings/".concat(ol.Orders,"?order=").concat(t.checkout_id))},children:n.jsx(D,{id:"2Dn5nu",defaultMessage:"View details"})})})]}):null}function jm({attribution:t,wordFadeType:e}){var o;const s=f.useContext(Ce),a=Uo(s==null?void 0:s.message.id,t.attributable_index),r=qo();return n.jsx(Cm,{isHighlighted:a,isDebugMode:r&&!1,content:(o=t.alt)!=null?o:"",attributableIndex:t.attributable_index,attributions:void 0,attributionsDebug:void 0,wordFadeType:e})}const km=f.memo(Rs);function Sm({content:t,isHighlighted:e,isDebugMode:s,attributableIndex:a,attributions:r,attributionsDebug:o,wordFadeType:i}){const l=i==="indexed",c=$a(),d=f.useMemo(()=>l?{handlers:{text:(b,y,v)=>{const g=[];for(const j of c(y.value))g.push({type:"element",tagName:"span",properties:{className:Pa.fadeIn},children:[{type:"text",value:j}]});return g}}}:void 0,[l,c]),u=f.useMemo(()=>({p:({children:b})=>n.jsx(n.Fragment,{children:b})}),[]),m=n.jsx(km,{rehypePlugins:va,remarkPlugins:ya,urlTransform:ba,remarkRehypeOptions:d,components:u,children:t});return n.jsx(Nm,{isHighlighted:e,children:m})}const Cm=xa.memo(Sm);function Nm({isHighlighted:t,className:e,children:s}){return n.jsx("span",{className:P("relative","-mx-px my-[-0.2rem] rounded px-px py-[0.2rem]",t&&"attribution-highlight-bg","transition-colors duration-100 ease-in-out",e),children:s})}function Vn(t,e){try{return BigInt(t).toLocaleString(e)}catch(s){const a=Number(t);return t.includes("e")||t.includes("E")?a.toExponential():a.toLocaleString(e,{maximumFractionDigits:6})}}function Mm({data:t,trackContentReferenceEvent:e}){f.useEffect(()=>{e("Search Content Reference Shown","search_content_reference_shown",t.type)},[e,t.type]);const s=il().locale;return t.expression&&t.result!=null?n.jsxs("div",{className:"no-scrollbar overflow-auto sm:overflow-hidden",children:[n.jsxs("div",{className:"pb-1 text-lg font-semibold",children:[t.prefix&&n.jsx("span",{children:t.prefix}),n.jsx("span",{children:Vn(t.result,s)}),t.suffix&&n.jsx("span",{children:t.suffix})]}),n.jsx("div",{className:"text-token-text-primary tracking-wide",children:"".concat(t.expression,"=").concat(Vn(t.result,s))})]}):null}function dr({ref:t,onClick:e,onMouseEnter:s,onMouseLeave:a}){const r=W();return n.jsx("button",{ref:t,"aria-label":r.formatMessage({id:"citation.icon.label",defaultMessage:"Coding Citation"}),onClick:e,onMouseEnter:s,onMouseLeave:a,className:P("rounded-xl px-1","bg-token-interactive-bg-tertiary-press text-token-text-secondary hover:text-token-text-inverted hover:bg-token-interactive-bg-primary-selected"),children:n.jsx(Go,{className:"icon-sm"})})}function Tm({codeMessage:t,codeExecutionOutputMessage:e,onDismiss:s,FormattedText:a}){const r=W();return n.jsx(Re.Root,{isOpen:!0,onClose:s,testId:"modal-code-execution",children:n.jsx(Re.Overlay,{children:n.jsxs(Re.Content,{className:"flex max-h-[75vh] max-w-lg flex-col overflow-hidden",children:[n.jsx(Re.Header,{title:r.formatMessage(Em.title),type:"success",closeButton:n.jsx(ll,{onClick:s})}),n.jsxs("div",{className:"flex flex-1 flex-col overflow-auto",children:[n.jsx("div",{children:n.jsx(Vo,{FormattedText:a,message:t,codeRendererClassName:"border-none rounded-none",removeTopBorderRadius:!0})}),n.jsx("div",{children:n.jsx(Yo,{message:e})})]})]})})})}const Em=Cs({title:{id:"CodeExecutionOutputModal.title",defaultMessage:"Analysis"}});function $m({displayInfo:t,FormattedText:e,trackContentReferenceEvent:s}){const[a,r]=f.useState(!1),o=W();return f.useEffect(()=>{s("Search Content Reference Shown","search_content_reference_shown",t.type)},[s,t.type]),n.jsxs(n.Fragment,{children:[n.jsx(Le,{label:o.formatMessage(Pm.viewAnalysis),side:"top",delayDuration:150,className:"align-middle",children:n.jsx(dr,{onClick:()=>r(!0)})}),a&&n.jsx(Tm,{FormattedText:e,codeMessage:t.codeMessage,codeExecutionOutputMessage:t.codeExecutionOutputMessage,onDismiss:()=>r(!1)})]})}const Pm=Cs({viewAnalysis:{id:"viewAnalysis",defaultMessage:"View analysis"}});function Am({contentReference:t,clientThreadId:e,turnIndex:s}){var y,v,g,j,_,N,k;const{toggleThreadSidebar:a}=_t(),r=Xo("codingCitations"),[o,i]=f.useState(!1),l=f.useRef(null),c=()=>{l.current!=null&&window.clearTimeout(l.current),i(!0)},d=()=>{l.current=window.setTimeout(()=>i(!1),100)},u=f.useCallback(()=>{var h,w;e&&a({type:"codingCitations",clientThreadId:e,turnIndex:s||1,messageId:(w=(h=t.cited_message)==null?void 0:h.id)!=null?w:"",matchedText:t.matched_text},r)},[a,e,r,t,s]);if(!t.cited_message||!t.highlighted_text)return null;let m;t.type==="python"?m=(g=(v=(y=t.cited_message)==null?void 0:y.metadata)==null?void 0:v.aggregate_result)==null?void 0:g.code:t.type==="container"&&(m=(N=(_=(j=t.cited_message)==null?void 0:j.metadata)==null?void 0:_.container_citation)==null?void 0:N.source_cmd);const b=(k=m==null?void 0:m.split("\n").length)!=null?k:0;return n.jsx("span",{className:"relative top-[0.1rem] inline-block align-middle",children:n.jsx("span",{className:"inline-flex items-center",children:n.jsxs(Ms,{open:o,onOpenChange:i,children:[n.jsx(Ts,{asChild:!0,children:n.jsx(dr,{onClick:u,onMouseEnter:c,onMouseLeave:d})}),n.jsx(Es,{children:n.jsx($s,{align:"start",sideOffset:4,onMouseEnter:c,onMouseLeave:d,className:P("border-default bg-token-bg-primary rounded-2xl border p-3"),children:n.jsxs("aside",{className:"flex flex-col gap-3",children:[n.jsx("h2",{className:P("text-token-text-secondary text-xs font-medium"),children:t.type==="python"?n.jsx(D,{id:"citation.popover.label.python",defaultMessage:"Python script · {count, number} lines",values:{count:b}}):n.jsx(D,{id:"citation.popover.label.container",defaultMessage:"Bash script · {count, number} lines",values:{count:b}})}),n.jsx("hr",{}),n.jsx("h2",{className:P("text-sm font-medium","max-w-full break-words whitespace-pre-line sm:max-w-[300px]"),children:t.highlighted_text})]})})})]})})})}function Lm({business:t,mapUrl:e,showTitle:s=!1,showActionButtons:a=!0,trackContentReferenceEvent:r}){const o=t.categories&&t.categories.length>0?t.categories[0]:"",i=f.useRef({directions:null,website:null,phone:null});f.useEffect(()=>{i.current={directions:null,website:null,phone:null}},[t.id]);const l=f.useMemo(()=>({section:"entity_metadata",section_location:"response",entity_type:"local_business",business_id:t.id,provider:t.provider}),[t.id,t.provider]),c=f.useCallback((d,u,m)=>{r&&r("link_action",null,"entity_metadata",O(A({},l),{cta_type:d,url:m,link_type:"button",action:u}))},[l,r]);return f.useEffect(()=>{if(!(!r||!a)&&(e&&i.current.directions!==e&&(c("directions","show",e),i.current.directions=e),t.website_url&&i.current.website!==t.website_url&&(c("website","show",t.website_url),i.current.website=t.website_url),t.phone)){const d="tel:".concat(t.phone);i.current.phone!==d&&(c("phone","show",d),i.current.phone=d)}},[t.phone,t.website_url,e,a,r,c]),n.jsxs("div",{className:"text-token-text-primary bg-token-bg-primary max-w-md rounded-md py-1",children:[s&&t.name&&n.jsx("h2",{className:"mb-1 leading-tight",children:t.name}),n.jsx("div",{className:"flex flex-wrap items-center text-[15px] font-normal",children:[t.rating?n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(Ta,{className:"h-4 w-4"}),t.rating.toFixed(1)]},"rating"):null,o?n.jsx("span",{children:o},"category"):null,t.price_str?n.jsx("span",{children:t.price_str},"price"):null,t.is_open!==void 0&&t.is_open!=null?t.is_open?n.jsx("span",{className:"text-green-600",children:n.jsx(D,{id:"businessMetadata.openStatus",defaultMessage:"Open"})},"open"):n.jsx("span",{children:n.jsx(D,{id:"businessMetadata.closedStatus",defaultMessage:"Closed"})},"open"):null].filter(Boolean).map((d,u)=>n.jsxs(xa.Fragment,{children:[u>0&&n.jsx("span",{className:"mx-1",children:"•"}),d]},u))}),a&&n.jsxs("div",{className:"justify-left mt-3 flex w-full flex-wrap gap-2",children:[e&&n.jsx(as,{type:"button",className:"btn btn-secondary btn-small text-token-text-primary relative m-0! w-25 px-2.5 py-1 text-xs font-medium",onClick:()=>{c("directions","click",e),window.open(e,"_blank","noopener,noreferrer")},children:n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(Kl,{className:"text-token-text-primary h-4 w-4"}),n.jsx(D,{id:"businessMetadata.directions",defaultMessage:"Directions"})]},"rating")}),t.website_url&&n.jsx(as,{type:"button",className:"btn btn-secondary btn-small text-token-text-primary relative m-0! w-25 px-2.5 py-1 text-xs font-medium",onClick:()=>{const d=t.website_url;d&&(c("website","click",d),window.open(d,"_blank","noopener,noreferrer"))},children:n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(Zo,{className:"text-token-text-primary h-4 w-4"}),n.jsx(D,{id:"businessMetadata.website",defaultMessage:"Website"})]},"rating")}),t.phone&&n.jsx(as,{type:"button",className:"btn btn-secondary btn-small text-token-text-primary relative m-0! w-25 px-2.5 py-1 text-xs font-medium",onClick:()=>{const d="tel:".concat(t.phone);c("phone","click",d),window.location.href=d},children:n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(Ko,{className:"text-token-text-primary h-4 w-4"}),n.jsx(D,{id:"businessMetadata.phone",defaultMessage:"Phone"})]},"rating")})]})]})}function Im({product:t,clientThreadId:e,messageId:s,contentReferenceStartIndex:a,trackContentReferenceEvent:r,showTitle:o=!1,showImageGallery:i=!1}){var k,h,w,S;const l=J(),c=K(l,"3375735072"),d=K(l,"232003972"),u=f.useMemo(()=>({clientThreadId:e,messageId:s}),[e,s]),m=Ps.useStore(),[b,y]=f.useState(!1),[v,g]=f.useState(t),[j,_]=f.useState(!1),N=o||d||c;return f.useEffect(()=>{let p=!0;return(async M=>{_(!0);try{try{for(var E=ts(Rm(M)),T,L,I;T=!(L=await E.next()).done;T=!1){const $=L.value;p&&g($)}}catch(L){I=[L]}finally{try{T&&(L=E.return)&&await L.call(E)}finally{if(I)throw I[0]}}}finally{p&&_(!1)}})(v),()=>{p=!1}},[(k=v.product_lookup_key)==null?void 0:k.variant_options_query]),v?n.jsxs("div",{className:"-mx-6",children:[i&&n.jsx(Jo,{imageUrls:(h=v.image_urls)!=null?h:[],title:v.title,onImageClick:p=>{m.setCurrentImage({image:{url:p,content_url:p,thumbnail_url:p,title:v.title,content_size:{width:0,height:0},thumbnail_size:{width:0,height:0}},source:Ke.ProductDetails,analyticsMetadata:u,contentReferenceStartIndex:a})}}),n.jsxs("div",{className:"bg-token-bg-primary flex w-full flex-col",children:[N&&n.jsxs("div",{className:"border-token-border-light flex flex-col border-b px-6 pb-3",children:[o&&n.jsx("div",{className:"text-token-text-primary text-xl font-medium capitalize",children:v.title}),d&&v.num_reviews&&v.rating&&n.jsx(Qo,{rating:v.rating,numReviews:v.num_reviews,ratingGroupedCitation:v.rating_grouped_citation,trackContentReferenceEvent:()=>{},analyticsMetadata:u}),c&&v.variants&&v.variants.length>0&&n.jsx("div",{className:"mt-5 mb-2",children:n.jsx(ei,{options:v.variants,showErrors:b,updateOption:(p,C,M)=>g(E=>Dm({optionGroupId:p,selectedId:C,variant_index:M,product:E,trackContentReferenceEvent:r}))})})]}),n.jsx(ti,{className:"border-token-border-light -pt-3 -mx-3 flex flex-col border-b px-6 pb-3",offers:(w=t.offers)!=null?w:[],contentReferenceStartIndex:a,productIndex:0,product:t,trackContentReferenceEvent:r,analyticsMetadata:u,imageUrls:(S=t.image_urls)!=null?S:[],isLoading:j,onOpenCheckout:()=>y(!0)})]})]}):null}function Rm(t){return en(this,null,function*(){const{product_lookup_key:e}=t;if(!!!(e!=null&&e.variant_options_query)){yield t;return}const a=si("".concat(cl,"/search/product_info_variants"),{method:"POST",headers:A({},Ds({isAuthOptional:!0})),body:{product_lookup_key:t.product_lookup_key}});try{for(var r=ts(a),o,i,l;o=!(i=yield new Et(r.next())).done;o=!1){const c=i.value;"data"in c&&(yield c.data.product)}}catch(i){l=[i]}finally{try{o&&(i=r.return)&&(yield new Et(i.call(r)))}finally{if(l)throw l[0]}}})}function Dm({optionGroupId:t,selectedId:e,variant_index:s,product:a,trackContentReferenceEvent:r}){var d,u,m,b,y,v;const o=(d=a.variants)==null?void 0:d.find(g=>g.id===t);r("product_detail","product_detail","product_entity",{product_id:a.id,action:"variant_selected",section:"product_detail",section_location:"sidebar",variant_name:(u=o==null?void 0:o.label)!=null?u:"",variant_value:(b=(m=o==null?void 0:o.options.find(g=>g.id===e))==null?void 0:m.label)!=null?b:"",variant_index:s});const i=(v=(y=a.variants)==null?void 0:y.map(g=>g.id===t?O(A({},g),{options:g.options.map(j=>O(A({},j),{selected:j.id===e})),selected_option_id:e}):g))!=null?v:a.variants,c=(i==null?void 0:i.every(g=>g.selected_option_id))?i==null?void 0:i.reduce((g,j)=>(j.selected_option_id&&(g[j.id]=j.selected_option_id),g),{}):null;return O(A({},a),{variants:i,product_lookup_key:O(A({},a.product_lookup_key),{variant_options_query:c})})}function Fm({contentReference:t,clientThreadId:e,messageId:s,trackContentReferenceEvent:a}){var r,o;if(f.useEffect(()=>{var i,l;a("Search Content Reference Shown","search_content_reference_shown","entity_metadata",A({entity_type:t.entity_type},t.entity_type==="local_business"?{business_id:(i=t.entity_data)==null?void 0:i.id}:t.entity_type==="product"?{product_id:(l=t.entity_data)==null?void 0:l.id}:{}))},[a,t.entity_type,(r=t.entity_data)==null?void 0:r.id]),!(t!=null&&t.entity_data))return null;if(t.entity_type==="local_business"){const i=t.layout;return n.jsx(Lm,{business:t.entity_data,mapUrl:(o=t.metadata)==null?void 0:o.map_url,showActionButtons:i!=="one-line",showTitle:i!=="one-line",trackContentReferenceEvent:a})}else if(t.entity_type==="product")return n.jsx(Im,{product:t.entity_data,clientThreadId:e,messageId:s,contentReferenceStartIndex:t.start_idx,trackContentReferenceEvent:a});return null}function Om({iconRef:t,className:e,alt:s}){var r;const a=(r=t==null?void 0:t.vector_url)!=null?r:t==null?void 0:t.raster_url;return a?n.jsx("img",{src:a,className:e,alt:s}):n.jsx(Aa,{className:e})}function Ss(t,e,s,a){var v,g,j,_,N,k,h,w,S,p,C,M,E,T,L,I,$,x,R;const r=K(s,"3958255976"),o=K(s,"1424158285"),i=ni((v=t.cloud_doc_url)!=null?v:""),l=(j=r?(g=t.fff_metadata)==null?void 0:g.name:void 0)!=null?j:t.name,c=(k=(N=r?(_=t.fff_metadata)==null?void 0:_.display_file_type_name:void 0)!=null?N:i==null?void 0:i.type)!=null?k:a.formatMessage({id:"bqY3sN",defaultMessage:"File"}),d=(p=(S=r&&((h=t.fff_metadata)!=null&&h.display_file_type_icon)?n.jsx(Om,{alt:c,className:e,iconRef:(w=t.fff_metadata)==null?void 0:w.display_file_type_icon}):void 0)!=null?S:i!=null&&i.Icon?n.jsx(i.Icon,{alt:c,className:e}):t.cloud_doc_url?o?n.jsx(ct,{url:t.cloud_doc_url,className:e,fallback:n.jsx(ys,{alt:c,className:e})}):n.jsx(ys,{alt:c,className:e}):void 0)!=null?p:n.jsx(Aa,{alt:c,className:e}),u=(E=r?(M=(C=t.fff_metadata)==null?void 0:C.capabilities)==null?void 0:M.user_view:void 0)!=null?E:t.cloud_doc_url;let m;r&&((T=t.fff_metadata)!=null&&T.snippet)&&((L=t.fff_metadata)==null?void 0:L.snippet.content.content_type)==="text"?m=t.fff_metadata.snippet.content.text:m=(I=t.description)!=null?I:t.snippet;const b=(x=r?($=t.fff_metadata)==null?void 0:$.file_last_modified_time:void 0)!=null?x:t.last_modified_time,y=r?(R=t.fff_metadata)==null?void 0:R.file_created_time:void 0;return{fileName:l,fileTypeDisplayName:c,fileTypeIcon:d,url:u,snippet:m,fileLastModifiedTime:b,fileCreatedTime:y}}const Yn=32;function ur(t){const e=t.split(".");let s=t;return e.length>1&&e.slice(0,-1).some(a=>a.length>0)&&(s=e.slice(0,-1).join(".")),s.length>Yn&&(s=s.slice(0,Yn-1)+"…"),s}function mr({additionalFileRefs:t,fileRef:e,index:s,trackContentReferenceEvent:a}){var y;const r=dl(Yt),o=ul(),i=f.useContext(Ce),l=f.useMemo(()=>({source:e.source,index:s}),[e.source,s]);f.useEffect(()=>{a("File Citation Shown","file_citation_shown","file",l)},[]);const c=f.useCallback(v=>{v?a("File Citation Hovered","file_citation_hovered","file",l):a("File Citation Unhovered","file_citation_unhovered","file",l)},[l,a]),d=f.useCallback(()=>{a("File Citation Clicked","file_citation_clicked","file",l)},[l,a]),u=f.useCallback(()=>{a("File Citation Followup Clicked","file_citation_followup_clicked","file",l)},[l,a]),m=f.useCallback(()=>o(e.id,e.name),[o,e.id,e.name]),b=nt((y=i==null?void 0:i.analyticsMetadata.clientThreadId)!=null?y:Ba,v=>v==null?void 0:v.mode);return r&&La(e.id)?null:ai(b)?b.gizmo_id&&ml(b.gizmo_id)?n.jsx("span",{className:P(ri,"ms-1"),title:e.name,children:ur(e.name)}):null:n.jsx(zm,{additionalFileRefs:t,fileItem:e,onClickDownloadFile:m,trackCloudLinkClick:d,trackFileCitationFollowup:u,trackTooltipOpenChange:c})}var da;const Xn=zs.p(da||(da=ot(["not-prose mt-0! mb-0! flex-auto truncate"])));function zm({additionalFileRefs:t,className:e,fileItem:s,onClickDownloadFile:a,trackCloudLinkClick:r,trackFileCitationFollowup:o,trackTooltipOpenChange:i}){var h,w,S;const l=W(),c=J(),d=K(c,"1424158285"),{fileName:u,fileTypeDisplayName:m,fileTypeIcon:b,url:y,snippet:v}=Ss(s,"h-[16px] w-[16px] object-contain text-token-text-primary! flex-none",c,l),g=[{fileItem:s,fileName:u,fileTypeDisplayName:m,fileTypeIcon:b,url:y,snippet:v},...(h=t==null?void 0:t.map(p=>{const{fileName:C,fileTypeDisplayName:M,fileTypeIcon:E,url:T,snippet:L}=Ss(p,"h-[16px] w-[16px] object-contain",c,l);return{fileItem:p,fileName:C,fileTypeDisplayName:M,fileTypeIcon:E,url:T,snippet:L}}))!=null?h:[]];let j=P("ms-1 flex h-[25px] text-[10px] leading-[13px] rounded-xl items-center justify-center gap-1 px-2 relative","text-token-text-secondary! hover:text-token-text-primary! hover:bg-token-bg-secondary dark:bg-token-main-surface-secondary dark:hover:bg-token-bg-secondary",e);d||(j+=" bg-[#f4f4f4] ");const _=d&&s.medical_file_reference!==null&&((w=s.medical_file_reference)==null?void 0:w.journal_name)!==null?(S=s.medical_file_reference)==null?void 0:S.journal_name:s.name,N="".concat(ur(_)).concat(t&&t.length>0?" +".concat(t.length):""),k=n.jsx("span",{className:"relative inline-flex items-center",children:y?n.jsxs(we,{href:y,className:j,onClick:r,children:[b,n.jsx(Xn,{children:N})]}):La(s.id)?n.jsxs("button",{onClick:a,className:j,children:[b,n.jsx(Xn,{children:N})]}):n.jsx("span",{className:j,children:n.jsx(ys,{})})});return n.jsx(Bm,{items:g,contentType:m,trackFileCitationFollowup:o,trackTooltipOpenChange:i,children:k})}function Bm({items:t,children:e,contentType:s,trackFileCitationFollowup:a,trackTooltipOpenChange:r}){var j;const o=jt(),i=f.useContext(Ce),l=(j=i==null?void 0:i.clientThreadId)!=null?j:Ba,c=pt(),d=J(),u=K(d,"1424158285"),m=K(d,"733205176"),b=K(d,"2137702454"),y=Jl(l,t[0].fileItem.id,t[0].fileName,t[0].url),v=f.useCallback((_,N)=>{N.length&&(y(_,N),a==null||a())},[y,a]),g=()=>{var _,N,k;return b?n.jsx("div",{className:"max-h-[420px] max-w-sm min-w-xs overflow-y-auto p-2",children:t.map(({fileItem:h,fileName:w,snippet:S,url:p})=>{var C,M,E;return n.jsxs(we,{href:p,className:P("text-token-text-primary hover:bg-token-bg-tertiary flex flex-col gap-1 rounded-md p-2 text-start text-xs font-normal no-underline!"),children:[n.jsxs("div",{className:"flex items-center gap-1.5",children:[n.jsx("div",{className:"icon-sm h-4 w-4 shrink-0 items-center overflow-hidden rounded-full",children:t[0].fileTypeIcon}),n.jsx("div",{className:"text-token-text-secondary line-clamp-1 text-sm",children:u?(C=t[0].fileItem.medical_file_reference)==null?void 0:C.journal_name:s})]}),n.jsx("div",{className:P("text-sm font-medium break-all",S?"line-clamp-1":"line-clamp-2"),children:w}),u&&n.jsxs("div",{className:"line-clamp-2 text-sm break-words",children:[n.jsx("span",{className:"italic",children:(M=h.medical_file_reference)==null?void 0:M.authors_display}),n.jsx("span",{className:"ms-1 not-italic",children:(E=h.medical_file_reference)==null?void 0:E.publication_year})]}),S&&n.jsx("div",{className:"text-token-text-secondary line-clamp-3 text-sm break-all",children:S})]},h.id)})}):n.jsxs(n.Fragment,{children:[n.jsxs(we,{href:t[0].url,className:P("text-token-text-primary flex max-w-80 flex-col gap-1 text-start text-xs font-normal no-underline!"),children:[n.jsxs("div",{className:"flex items-center justify-center gap-1.5",children:[t[0].fileTypeIcon,n.jsx("div",{className:"text-token-text-primary flex-auto truncate",children:u?(_=t[0].fileItem.medical_file_reference)==null?void 0:_.journal_name:s})]}),n.jsx("div",{className:"line-clamp-2 text-sm font-medium break-all",children:t[0].fileName}),u&&n.jsxs("div",{className:"line-clamp-2 text-sm break-words",children:[n.jsx("span",{className:"italic",children:(N=t[0].fileItem.medical_file_reference)==null?void 0:N.authors_display}),n.jsx("span",{className:"ms-1 not-italic",children:(k=t[0].fileItem.medical_file_reference)==null?void 0:k.publication_year})]})]}),c||m?null:n.jsx("div",{className:"flex w-full cursor-pointer flex-row items-center gap-2 pt-3 text-sm",children:n.jsx(Ql,{sendReply:v})})]})};return n.jsx(Le,{label:n.jsx(g,{}),align:"start",cornerRadius:"xl",customBorderClassName:"border-token-border-default border",customPaddingClassName:b?"p-0":"p-3",delayDuration:150,interactive:!0,onOpenChange:r,side:"bottom",theme:o?"default":"white",wide:!0,children:e})}function Wm({contentReferences:t,fileRef:e,index:s,trackContentReferenceEvent:a}){const r=t[s-1];if((r==null?void 0:r.type)==="file"&&(r.end_idx===e.start_idx-1||r.end_idx===e.start_idx))return;const o=Hm({contentReferences:t,fileRef:e,index:s});return Object.entries(o).map(([i,l])=>n.jsx(mr,{additionalFileRefs:l.slice(1),fileRef:l[0],index:s,trackContentReferenceEvent:a},i))}const Hm=({contentReferences:t,fileRef:e,index:s})=>{var c,d;const a=[];let r=s,o=e;for(let u=r+1;u<t.length;u++){const m=t[u];if((m==null?void 0:m.type)==="file"&&(o.end_idx===m.start_idx-1||o.end_idx===m.start_idx))a.push(m),o=m,r=u;else break}const i=[e,...a],l={};for(const u of i){const m=(d=oi((c=u.cloud_doc_url)!=null?c:""))!=null?d:"unknown";l[m]||(l[m]=[]),l[m].push(u)}return l};function Um(t,e){return new Date(t).toLocaleDateString(e,{month:"long",day:"numeric",year:"numeric"})}function qm({metadata:t,trackContentReferenceEvent:e}){return t.items.length===0?null:n.jsx("div",{className:"mt-6 flex flex-col gap-3",children:t.items.map((s,a)=>n.jsx(Gm,{item:s,index:a,trackContentReferenceEvent:e},a))})}function Gm({item:t,index:e,trackContentReferenceEvent:s}){var b;const a=W(),r=J(),{fileName:o,fileTypeDisplayName:i,fileTypeIcon:l,snippet:c,url:d,fileLastModifiedTime:u}=Ss(t,"icon object-contain",r,a),m={title:o,description:(b=c==null?void 0:c.toString())!=null?b:"",index:e};return f.useEffect(()=>{s("Contextual Answers Content Reference Shown","contextual_answers_content_reference_shown","file_navlist",m)},[]),n.jsxs(we,{className:"group/nav-list relative flex items-center gap-6 py-1.5",href:d!=null?d:"/",onClick:()=>{s("Contextual Answers Content Reference Clicked","contextual_answers_content_reference_clicked","file_navlist",m)},children:[n.jsx("div",{className:"absolute start-0 top-0 bottom-0 w-[3px] rounded-t-lg rounded-b-lg bg-black/10"}),n.jsxs("div",{className:"ms-4 flex grow flex-col gap-1 overflow-hidden text-ellipsis",children:[n.jsxs("div",{className:"not-prose text-token-text-primary flex items-center gap-1.5 text-sm",children:[l,n.jsx("div",{className:"text-token-text-primary line-clamp-2 text-sm",children:i})]}),n.jsx("div",{className:"text-token-link decoration-token-link line-clamp-2 font-semibold group-hover/nav-list:underline",children:o}),n.jsx("div",{className:"text-token-text-primary line-clamp-2 text-sm leading-snug font-normal",children:c}),u&&n.jsx("div",{className:"text-token-text-secondary text-sm",children:Um(u,a.locale)})]})]})}var hs={line:{color:"#F66",width:1,dashPattern:[]},sync:{enabled:!0,group:1,suppressTooltips:!1},zoom:{enabled:!0,zoomboxBackgroundColor:"rgba(66,133,244,0.2)",zoomboxBorderColor:"#48F",zoomButtonText:"Reset Zoom",zoomButtonClass:"reset-zoom"},snap:{enabled:!1},callbacks:{beforeZoom:function(t,e){return!0},afterZoom:function(t,e){}}},Vm={id:"crosshair",afterInit:function(t){if(t.config.options.scales.x){var e=t.config.options.scales.x.type;if(!(e!=="linear"&&e!=="time"&&e!=="category"&&e!=="logarithmic")){t.options.plugins.crosshair===void 0&&(t.options.plugins.crosshair=hs),t.crosshair={enabled:!1,suppressUpdate:!1,x:null,originalData:[],originalXRange:{},dragStarted:!1,dragStartX:null,dragEndX:null,suppressTooltips:!1,ignoreNextEvents:0,reset:function(){this.resetZoom(t,!1,!1)}.bind(this)};var s=this.getOption(t,"sync","enabled");s&&(t.crosshair.syncEventHandler=function(a){this.handleSyncEvent(t,a)}.bind(this),t.crosshair.resetZoomEventHandler=function(a){var r=this.getOption(t,"sync","group");a.chartId!==t.id&&a.syncGroup===r&&this.resetZoom(t,!0)}.bind(this),window.addEventListener("sync-event",t.crosshair.syncEventHandler),window.addEventListener("reset-zoom-event",t.crosshair.resetZoomEventHandler)),t.panZoom=this.panZoom.bind(this,t)}}},afterDestroy:function(t){var e=this.getOption(t,"sync","enabled");e&&(window.removeEventListener("sync-event",t.crosshair.syncEventHandler),window.removeEventListener("reset-zoom-event",t.crosshair.resetZoomEventHandler))},panZoom:function(t,e){if(t.crosshair.originalData.length!==0){var s=t.crosshair.end-t.crosshair.start,a=t.crosshair.min,r=t.crosshair.max;e<0?(t.crosshair.start=Math.max(t.crosshair.start+e,a),t.crosshair.end=t.crosshair.start===a?a+s:t.crosshair.end+e):(t.crosshair.end=Math.min(t.crosshair.end+e,t.crosshair.max),t.crosshair.start=t.crosshair.end===r?r-s:t.crosshair.start+e),this.doZoom(t,t.crosshair.start,t.crosshair.end)}},getOption:function(t,e,s){return ln(t.options.plugins.crosshair[e]?t.options.plugins.crosshair[e][s]:void 0,hs[e][s])},getXScale:function(t){return t.data.datasets.length?t.scales[t.getDatasetMeta(0).xAxisID]:null},getYScale:function(t){return t.scales[t.getDatasetMeta(0).yAxisID]},handleSyncEvent:function(t,e){var s=this.getOption(t,"sync","group");if(e.chartId!==t.id&&e.syncGroup===s){var a=this.getXScale(t);if(a){var r=e.original.native.buttons===void 0?e.original.native.which:e.original.native.buttons;e.original.type==="mouseup"&&(r=0);var o={type:e.original.type=="click"?"mousemove":e.original.type,chart:t,x:a.getPixelForValue(e.xValue),y:e.original.y,native:{buttons:r},stop:!0};t._eventHandler(o)}}},afterEvent:function(t,e){if(t.config.options.scales.x.length==0)return;let s=e.event;var a=t.config.options.scales.x.type;if(!(a!=="linear"&&a!=="time"&&a!=="category"&&xscaleType!=="logarithmic")){var r=this.getXScale(t);if(r){if(t.crosshair.ignoreNextEvents>0){t.crosshair.ignoreNextEvents-=1;return}var o=s.native.buttons===void 0?s.native.which:s.native.buttons;s.native.type==="mouseup"&&(o=0);var i=this.getOption(t,"sync","enabled"),l=this.getOption(t,"sync","group");if(!s.stop&&i){var e=new CustomEvent("sync-event");e.chartId=t.id,e.syncGroup=l,e.original=s,e.xValue=r.getValueForPixel(s.x),window.dispatchEvent(e)}var c=this.getOption(t,"sync","suppressTooltips");if(t.crosshair.suppressTooltips=s.stop&&c,t.crosshair.enabled=s.type!=="mouseout"&&s.x>r.getPixelForValue(r.min)&&s.x<r.getPixelForValue(r.max),!t.crosshair.enabled&&!t.crosshair.suppressUpdate)return s.x>r.getPixelForValue(r.max)&&(t.crosshair.suppressUpdate=!0,t.update("none")),t.crosshair.dragStarted=!1,!1;t.crosshair.suppressUpdate=!1;var d=this.getOption(t,"zoom","enabled");if(o===1&&!t.crosshair.dragStarted&&d&&(t.crosshair.dragStartX=s.x,t.crosshair.dragStarted=!0),t.crosshair.dragStarted&&o===0){t.crosshair.dragStarted=!1;var u=r.getValueForPixel(t.crosshair.dragStartX),m=r.getValueForPixel(t.crosshair.x);Math.abs(t.crosshair.dragStartX-t.crosshair.x)>1&&this.doZoom(t,u,m),t.update("none")}t.crosshair.x=s.x,t.draw()}}},afterDraw:function(t){if(t.crosshair.enabled)return t.crosshair.dragStarted?this.drawZoombox(t):(this.drawTraceLine(t),this.interpolateValues(t),this.drawTracePoints(t)),!0},beforeTooltipDraw:function(t){return!t.crosshair.dragStarted&&!t.crosshair.suppressTooltips},resetZoom:function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(s){if(t.crosshair.originalData.length>0)for(var a=0;a<t.data.datasets.length;a++){var r=t.data.datasets[a];r.data=t.crosshair.originalData.shift(0)}t.crosshair.originalXRange.min?(t.options.scales.x.min=t.crosshair.originalXRange.min,t.crosshair.originalXRange.min=null):delete t.options.scales.x.min,t.crosshair.originalXRange.max?(t.options.scales.x.max=t.crosshair.originalXRange.max,t.crosshair.originalXRange.max=null):delete t.options.scales.x.max}t.crosshair.button&&t.crosshair.button.parentNode&&(t.crosshair.button.parentNode.removeChild(t.crosshair.button),t.crosshair.button=!1);var o=this.getOption(t,"sync","enabled");if(!e&&s&&o){var i=this.getOption(t,"sync","group"),l=new CustomEvent("reset-zoom-event");l.chartId=t.id,l.syncGroup=i,window.dispatchEvent(l)}s&&t.update("none")},doZoom:function(t,e,s){if(e>s){var a=e;e=s,s=a}var r=ln(t.options.plugins.crosshair.callbacks?t.options.plugins.crosshair.callbacks.beforeZoom:void 0,hs.callbacks.beforeZoom);if(!r(e,s))return!1;if(t.crosshair.dragStarted=!1,t.options.scales.x.min&&t.crosshair.originalData.length===0&&(t.crosshair.originalXRange.min=t.options.scales.x.min),t.options.scales.x.max&&t.crosshair.originalData.length===0&&(t.crosshair.originalXRange.max=t.options.scales.x.max),!t.crosshair.button){var o=document.createElement("button"),i=this.getOption(t,"zoom","zoomButtonText"),l=this.getOption(t,"zoom","zoomButtonClass"),c=document.createTextNode(i);o.appendChild(c),o.className=l,o.addEventListener("click",function(){this.resetZoom(t)}.bind(this)),t.canvas.parentNode.appendChild(o),t.crosshair.button=o}t.options.scales.x.min=e,t.options.scales.x.max=s;var d=t.crosshair.originalData.length===0,u=t.config.options.scales.x.type!=="category";if(u)for(var m=0;m<t.data.datasets.length;m++){var b=[],y=0,v=!1,g=!1;d&&(t.crosshair.originalData[m]=t.data.datasets[m].data);for(var j=t.crosshair.originalData[m],_=0;_<j.length;_++){var N=j[_],k=N.x!==void 0?N.x:NaN;k>=e&&!v&&y>0&&(b.push(j[y-1]),v=!0),k>=e&&k<=s&&b.push(N),k>s&&!g&&y<j.length&&(b.push(N),g=!0),y+=1}t.data.datasets[m].data=b}if(t.crosshair.start=e,t.crosshair.end=s,d){var h=this.getXScale(t);t.crosshair.min=h.min,t.crosshair.max=h.max}t.crosshair.ignoreNextEvents=2,t.update("none");var w=this.getOption(t,"callbacks","afterZoom");w(e,s)},drawZoombox:function(t){var e=this.getYScale(t),s=this.getOption(t,"zoom","zoomboxBorderColor"),a=this.getOption(t,"zoom","zoomboxBackgroundColor");t.ctx.beginPath(),t.ctx.rect(t.crosshair.dragStartX,e.getPixelForValue(e.max),t.crosshair.x-t.crosshair.dragStartX,e.getPixelForValue(e.min)-e.getPixelForValue(e.max)),t.ctx.lineWidth=1,t.ctx.strokeStyle=s,t.ctx.fillStyle=a,t.ctx.fill(),t.ctx.fillStyle="",t.ctx.stroke(),t.ctx.closePath()},drawTraceLine:function(t){var e=this.getYScale(t),s=this.getOption(t,"line","width"),a=this.getOption(t,"line","color"),r=this.getOption(t,"line","dashPattern"),o=this.getOption(t,"snap","enabled"),i=t.crosshair.x;o&&t._active.length&&(i=t._active[0].element.x),t.ctx.beginPath(),t.ctx.setLineDash(r),t.ctx.moveTo(i,e.getPixelForValue(e.max)),t.ctx.lineWidth=s,t.ctx.strokeStyle=a,t.ctx.lineTo(i,e.getPixelForValue(e.min)),t.ctx.stroke(),t.ctx.setLineDash([])},drawTracePoints:function(t){for(var e=0;e<t.data.datasets.length;e++){var s=t.data.datasets[e],a=t.getDatasetMeta(e),r=t.scales[a.yAxisID];a.hidden||!s.interpolate||(t.ctx.beginPath(),t.ctx.arc(t.crosshair.x,r.getPixelForValue(s.interpolatedValue),3,0,2*Math.PI,!1),t.ctx.fillStyle="white",t.ctx.lineWidth=2,t.ctx.strokeStyle=s.borderColor,t.ctx.fill(),t.ctx.stroke())}},interpolateValues:function(t){for(var e=0;e<t.data.datasets.length;e++){var s=t.data.datasets[e],a=t.getDatasetMeta(e),r=t.scales[a.xAxisID],o=r.getValueForPixel(t.crosshair.x);if(!(a.hidden||!s.interpolate)){var i=s.data,l=i.findIndex(function(m){return m.x>=o}),c=i[l-1],d=i[l];if(t.data.datasets[e].steppedLine&&c)s.interpolatedValue=c.y;else if(c&&d){var u=(d.y-c.y)/(d.x-c.x);s.interpolatedValue=c.y+(o-c.x)*u}else s.interpolatedValue=NaN}}}};const Bt=(t=1)=>"rgba(48, 166, 51, ".concat(t,")"),Wt=(t=1)=>"rgba(241, 77, 66, ".concat(t,")"),Zn="text-[#30a633]",Kn="text-[#f14d42]",Ym=["1d","5d","1m","6m","ytd","1y","5y","max"];function Xm({histories:t,selectedInterval:e,onSelectHistoryInterval:s}){var r;const a=Object.keys((r=t==null?void 0:t.quotes)!=null?r:{});return n.jsx("div",{className:"text-token-text-tertiary inline-flex items-start justify-between rounded-[10px] bg-[#f4f4f4] p-[3px] text-xs font-semibold sm:justify-start sm:gap-1 dark:bg-[#393939]",children:a.map(o=>n.jsx("button",{onClick:()=>{s==null||s(o)},className:P("border border-transparent px-3 py-1.5 text-xs font-semibold uppercase",e===o?"border-token-border-default! bg-token-main-surface-primary text-token-text-primary shadow-xxs dark:border-token-border-medium! rounded-lg":"hover:text-token-text-secondary"),children:fr[o].label},o))})}const fr={"1d":{label:"1D",formatTimestampLabel:Jn,formatTimestampTooltip:Jn,maxTicksLimit:6,lineTension:.1},"5d":{label:"5D",formatTimestampLabel:Qn,formatTimestampTooltip:Km,maxTicksLimit:6,lineTension:.1},"1m":{label:"1M",formatTimestampLabel:Qn,formatTimestampTooltip:Jm,maxTicksLimit:6,lineTension:.1,useUtc:!0},"6m":{label:"6M",formatTimestampLabel:ps,formatTimestampTooltip:it,maxTicksLimit:5,lineTension:.1,useUtc:!0},ytd:{label:"YTD",formatTimestampLabel:ps,formatTimestampTooltip:it,maxTicksLimit:5,lineTension:.1,useUtc:!0},"1y":{label:"1Y",formatTimestampLabel:ps,formatTimestampTooltip:it,maxTicksLimit:5,lineTension:.2,useUtc:!0},"5y":{label:"5Y",formatTimestampLabel:ea,formatTimestampTooltip:it,maxTicksLimit:5,lineTension:.2,useUtc:!0},max:{label:"max",formatTimestampLabel:ea,formatTimestampTooltip:it,maxTicksLimit:5,lineTension:.2,useUtc:!0}};function Zm(t){return t?Ym.filter(s=>s in t.quotes).find(s=>t.quotes[s].length>0):void 0}function Be(t,e){return dt(new Date(t*1e3),e!=null?e:"America/New_York")}function Jn(t,e,s){const a=Be(e,s);return t.formatTime(a,{hour:"numeric",minute:"numeric"})}function Km(t,e,s){const a=Be(e,s);return t.formatDate(a,{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"numeric"})}function it(t,e,s){const a=Be(e,s);return t.formatDate(a,{month:"short",day:"numeric",year:"numeric"})}function ps(t,e,s){const a=Be(e,s);return t.formatDate(a,{month:"short",year:"numeric"})}function Qn(t,e,s){const a=Be(e,s);return t.formatDate(a,{month:"short",day:"numeric"})}function Jm(t,e,s){const a=Be(e,s);return t.formatDate(a,{weekday:"short",month:"short",day:"numeric"})}function ea(t,e,s){const a=Be(e,s);return t.formatDate(a,{year:"numeric"})}ec.register(tc,sc,nc,ac,rc,oc,ic,lc,cc,Vm,dc);const Qm=100,ta={color:"#b4b4b4",font:{size:10,weight:"600",family:"Menlo"}};function ef({isUp:t,histories:e,selectedInterval:s,setHighlightedPrice:a,latestTradingPeriod:r,timezone:o}){return n.jsx(n.Fragment,{children:e&&s&&r?n.jsx(tf,{isUp:t,histories:e,selectedInterval:s,latestTradingPeriod:r,timezone:o,setHighlightedPrice:a}):n.jsx(lt,{className:"h-full",index:1,width:100})})}function tf({isUp:t,histories:e,selectedInterval:s,latestTradingPeriod:a,timezone:r,setHighlightedPrice:o}){const[i,l]=f.useState(null),[c,d]=f.useState(!1),u=s==="1d",m=f.useMemo(()=>{let h=e.quotes[s].filter(w=>w.close>=0);if(u&&a){const w=a.regular.start_timestamp,S=a.regular.end_timestamp;if(h=h.filter(p=>p.timestamp>=w&&p.timestamp<=S),h.length===0||h[h.length-1].timestamp<S){let C=h.length>0?h[h.length-1].timestamp:w-600;for(;C<S;)C+=600,h.push({timestamp:C,close:null})}}return h},[e,s,u,a]),b=fr[s],{formatTimestampTooltip:y,maxTicksLimit:v,useUtc:g=!1}=b,j=W(),_=Wa(),N=jt(),k=f.useMemo(()=>{const{formatTimestampLabel:h,lineTension:w}=b;return{labels:m.map(S=>h(j,S.timestamp,g?"UTC":r)),datasets:[{data:m.map(S=>S.close),borderColor:t?Bt():Wt(),pointRadius:0,pointHoverRadius:4,pointStyle:"circle",pointBackgroundColor:t?Bt():Wt(),pointHoverBorderWidth:2,pointHoverBorderColor:"rgba(255, 255, 255, 1)",backgroundColor:function(S){const{ctx:p,chartArea:C}=S.chart;if(C)return nf(p,C,t)},fill:!0,borderWidth:2,lineTension:w!=null?w:.4}]}},[b,m,t,g,r,j]);return n.jsx("div",{className:"flex h-full flex-col gap-6",children:n.jsxs("div",{className:"relative h-full",onMouseEnter:()=>d(!0),onMouseLeave:()=>{d(!1),o(null)},children:[n.jsx(uc,{options:{responsive:!0,maintainAspectRatio:!1,interaction:{intersect:!1,mode:"index"},hover:{mode:c?"index":"point"},animation:!1,scales:{x:{afterBuildTicks:h=>{if(h.ticks.length>v)if(u)h.ticks=h.ticks.filter((w,S)=>m[S].timestamp%(_?3600:7200)===0);else{const w=Math.ceil(h.ticks.length/(v-1));h.ticks=h.ticks.filter((S,p)=>p>0&&(p%w===0||p===h.ticks.length-1))}},grid:{display:!1},ticks:O(A({},ta),{align:"end"})},y:{ticks:O(A({},ta),{maxTicksLimit:7}),border:{display:!1},grid:{color:N?"rgba(255, 255, 255, 0.1)":"rgba(229, 229, 229, 0.5)"}}},plugins:{datalabels:{display:!1},legend:{display:!1},tooltip:{enabled:!1,animation:!1,displayColors:!1,callbacks:{title:function(h){var p;const w=h[0];if(!w)return"";const S=(p=m[w.dataIndex])==null?void 0:p.timestamp;return S?y(j,S,g?"UTC":r):""}},external:({tooltip:h})=>{var w,S,p,C;c&&h.opacity>0&&o(mt((C=(p=(S=(w=h.dataPoints)==null?void 0:w[0])==null?void 0:S.parsed)==null?void 0:p.y)!=null?C:0)),l(M=>{var L,I,$,x,R;const E=h.chart.width,T=h.caretX>E-Qm;return!M||M.x!==h.caretX||M.y!==h.caretY||M.opacity!==h.opacity||M.flip!==T?O(A({},M),{x:h.caretX,y:h.caretY,dateLabel:(L=h.title)==null?void 0:L[0],value:mt((R=(x=($=(I=h.dataPoints)==null?void 0:I[0])==null?void 0:$.parsed)==null?void 0:x.y)!=null?R:0),opacity:h.opacity,flip:T}):M})}},dropShadow:!1,crosshair:{line:{color:N?"rgba(255, 255, 255, 0.3)":"rgba(0, 0, 0, 0.3)",width:.5},zoom:{enabled:!1}}}},data:k}),n.jsx(sf,{tooltipData:i})]})})}function sf({tooltipData:t}){return!t||!t.opacity?null:n.jsx("div",{style:{left:t.x-5,top:10,transform:"translate(-50%, -50%)"},className:P("text-token-main-surface-primary dark:bg-token-main-surface-secondary pointer-events-none absolute translate-y-[-100%] rounded-lg bg-black px-2 py-1 font-mono font-semibold whitespace-nowrap dark:text-white"),children:n.jsx("div",{className:"text-xs",children:t.dateLabel})})}function nf(t,e,s){const a=t.createLinearGradient(0,e.top,0,e.bottom);return a.addColorStop(0,s?Bt(.4):Wt(.4)),a.addColorStop(1,s?Bt(0):Wt(0)),a}function mt(t){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t)}function je({label:t,value:e,className:s}){return n.jsxs("div",{className:P("flex w-full flex-1 flex-row justify-between text-sm",s),children:[n.jsx("span",{className:"text-token-text-secondary font-normal whitespace-nowrap",children:t}),n.jsx("span",{className:"text-token-text-primary font-normal whitespace-nowrap",children:e})]})}function af({metrics:t}){const e=W(),s=!!(t.marketCap&&t.peRatio&&t.eps);return n.jsx("div",{className:"border-token-border-default flex flex-col gap-1 rounded-b-lg border-t bg-[#f4f4f4] px-4 py-3 dark:bg-[#393939]",children:n.jsxs("div",{className:P("grid grid-cols-2 gap-x-10 gap-y-3 lg:grid-cols-3 lg:gap-x-6"),children:[n.jsx(je,{label:e.formatMessage({id:"MDHEj7",defaultMessage:"Open"}),value:e.formatNumber(t.openPrice,{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}),className:"order-1"}),n.jsx(je,{label:e.formatMessage({id:"PboNMC",defaultMessage:"Volume"}),value:e.formatNumber(t.intradayVolume,{notation:"compact",maximumFractionDigits:1}),className:P("order-2",!s&&"lg:order-last")}),n.jsxs("div",{className:"order-4 row-span-2 flex flex-col gap-3",children:[n.jsx(je,{label:e.formatMessage({id:"bresUW",defaultMessage:"Day Low"}),value:e.formatNumber(t.intradayLow,{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})}),n.jsx(je,{label:e.formatMessage({id:"oWyv5V",defaultMessage:"Day High"}),value:e.formatNumber(t.intradayHigh,{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})})]}),n.jsxs("div",{className:"order-5 row-span-2 flex flex-col gap-3",children:[n.jsx(je,{label:e.formatMessage({id:"DcEYIK",defaultMessage:"Year Low"}),value:e.formatNumber(t.fiftyTwoWeekLow,{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})}),n.jsx(je,{label:e.formatMessage({id:"ZfFtJ4",defaultMessage:"Year High"}),value:e.formatNumber(t.fiftyTwoWeekHigh,{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})})]}),t.marketCap&&n.jsx(je,{label:e.formatMessage({id:"BzyP4Y",defaultMessage:"Market Cap"}),value:e.formatNumber(t.marketCap,{notation:"compact",maximumFractionDigits:2}),className:"order-last lg:order-3"}),t.peRatio&&t.eps&&n.jsxs(n.Fragment,{children:[n.jsx(je,{label:e.formatMessage({id:"edGd+S",defaultMessage:"EPS (TTM)"}),value:e.formatNumber(t.eps,{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}),className:"order-last"}),n.jsx(je,{label:e.formatMessage({id:"AhpCu1",defaultMessage:"P/E Ratio"}),value:e.formatNumber(t.peRatio,{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}),className:"order-last"})]})]})})}function rf({data:t,priceChange:e,highlightedPrice:s,extendedPriceChange:a,url:r}){var i;function o(l,c="intraday",d=null){const{isUp:u,changePercentage:m,changeLabel:b,changeAmount:y}=l,v=Math.abs(m).toFixed(2),g=mt(y);return n.jsxs("span",{className:"flex min-w-0 items-center gap-1",children:[c==="extended_hours"&&d!=null&&n.jsx("span",{className:"font-semibold",children:n.jsx(D,{id:"HWwWpW",defaultMessage:"{price}",values:{price:d}})}),n.jsx("span",{className:P("font-semibold",u?Zn:Kn),children:n.jsx(D,{id:"3x4Lkl",defaultMessage:"{sign}{changeAmount}",values:{changeAmount:g,sign:u?"+":""}})}),n.jsx("span",{className:P("font-semibold",u?Zn:Kn),children:n.jsx(D,{id:"MbfF1T",defaultMessage:"({sign}{changePercentage}%)",values:{changePercentage:v,sign:u?"+":"-"}})}),c==="extended_hours"?n.jsx("span",{className:"text-token-text-primary min-w-0 truncate",children:b}):n.jsx("span",{className:"text-token-text-primary min-w-0 truncate",children:b})]})}return n.jsxs("div",{children:[n.jsx("div",{className:"mt-2 text-sm",children:t?n.jsx(D,{id:"+2WHuv",defaultMessage:"{name} ({ticker})",values:{name:t.asset.name,ticker:t.asset.ticker}}):n.jsx("div",{className:"w-32 font-medium",children:n.jsx(lt,{index:9,width:100})})}),n.jsx("div",{className:"text-token-text-tertiary text-sm",children:t?n.jsx(n.Fragment,{children:r!=null&&n.jsxs(n.Fragment,{children:[" · ",n.jsx(we,{href:r,className:"text-token-link hover:underline",children:Vt(r,"hostname")})]})}):n.jsx("div",{className:"mt-2 w-36",children:n.jsx(lt,{index:6,width:100})})}),n.jsx("div",{className:"mt-2 flex text-4xl font-semibold",children:t?n.jsx(D,{id:"s+1uly",defaultMessage:"{price}",values:{price:s!=null?s:mt(t.price.price)}}):n.jsx("div",{className:"w-32",children:n.jsx(lt,{index:0,width:100})})}),n.jsx("div",{className:"mt-2 flex items-center justify-start gap-1 text-sm",children:e?o(e):n.jsx("div",{className:"mt-2 w-40",children:n.jsx(lt,{index:3,width:100})})}),n.jsx("div",{className:"mt-0.5 flex items-center justify-start gap-1 text-sm",children:((i=t==null?void 0:t.price)==null?void 0:i.extended_price)!=null&&a!=null&&o(a,"extended_hours",mt(t.price.extended_price))})]})}function of({contentReference:t,trackContentReferenceEvent:e}){var N,k,h,w,S,p,C,M,E,T,L,I,$,x,R;const s=W();f.useEffect(()=>{e("Search Content Reference Shown","search_content_reference_shown","stock")},[e]);const a=Zm((N=t==null?void 0:t.stock)==null?void 0:N.histories),r=t==null?void 0:t.stock,[o,i]=f.useState(a),[l,c]=f.useState(null),d=o==="1d",u=(w=(h=(k=r==null?void 0:r.histories)==null?void 0:k.quotes)==null?void 0:h[o!=null?o:""])==null?void 0:w[0],m=o&&o in Rt?o:void 0,b=r&&(u&&!d?{changePercentage:(r.price.price-u.close)/u.close*100,changeAmount:r.price.price-u.close,changeLabel:m?s.formatMessage(Rt[m]):"",isUp:r.price.price>u.close}:r.price.change_percent&&r.price.change?{changePercentage:r.price.change_percent*100,changeAmount:r.price.change,changeLabel:cf(r.price.latest_trade_timestamp,r.asset.timezone,s),isUp:r.price.change?r.price.change>0:!1}:null),y=r&&r.price.extended_price!=null&&r.price.extended_change_percent!=null&&r.price.extended_change!=null?{changePercentage:r.price.extended_change_percent*100,changeAmount:r.price.extended_change,changeLabel:s.formatMessage((S=lf(r.price.market_status))!=null?S:Rt.extended),isUp:r.price.extended_change>0}:null,{fiftyTwoWeekHigh:v,fiftyTwoWeekLow:g}=f.useMemo(()=>{var B;const F=(B=r==null?void 0:r.histories)==null?void 0:B.quotes["1y"];if(!F)return{fiftyTwoWeekHigh:null,fiftyTwoWeekLow:null};const q=F.map(z=>z.high).filter(z=>z!=null),G=F.map(z=>z.low).filter(z=>z!=null);return{fiftyTwoWeekHigh:q.length>0?Math.max(...q):null,fiftyTwoWeekLow:G.length>0?Math.min(...G):null}},[(p=r==null?void 0:r.histories)==null?void 0:p.quotes]),j=r!=null&&r.price.open_price&&r.price.intraday_high&&r.price.intraday_low&&r.price.intraday_volume&&v&&g?{openPrice:r.price.open_price,intradayHigh:r.price.intraday_high,intradayLow:r.price.intraday_low,intradayVolume:r.price.intraday_volume,fiftyTwoWeekHigh:v,fiftyTwoWeekLow:g,marketCap:(M=(C=r.metrics)==null?void 0:C.market_cap)!=null?M:void 0,peRatio:(T=(E=r.metrics)==null?void 0:E.pe_ratio)!=null?T:void 0,eps:(I=(L=r.metrics)==null?void 0:L.eps)!=null?I:void 0}:null,_=j!=null;return n.jsxs("div",{"data-testid":"finance-widget",className:P("border-token-border-default mb-2 flex min-h-[480px] flex-col gap-8 rounded-lg border"),children:[n.jsxs("div",{className:"mx-6 flex flex-wrap items-end justify-between",children:[n.jsx(rf,{data:r!=null?r:null,highlightedPrice:l,priceChange:b!=null?b:null,extendedPriceChange:y!=null?y:null,url:($=t==null?void 0:t.url)!=null?$:null}),n.jsx("div",{className:"mt-4",children:n.jsx(Xm,{selectedInterval:o,onSelectHistoryInterval:i,histories:r==null?void 0:r.histories})})]}),n.jsx("div",{className:"mx-6 h-[340px]",children:n.jsx(ef,{isUp:(x=b==null?void 0:b.isUp)!=null?x:!1,selectedInterval:o,histories:r==null?void 0:r.histories,setHighlightedPrice:c,onSelectHistoryInterval:F=>i(F),latestTradingPeriod:r==null?void 0:r.asset.latest_trading_period,timezone:(R=r==null?void 0:r.asset.timezone)!=null?R:null})}),_&&n.jsx("div",{className:"-mt-4",children:n.jsx(af,{metrics:j})})]})}function lf(t){if(t==null)return null;const e=t.toLowerCase();return e==="premarket"||e==="open"?ss({id:"By+pvF",defaultMessage:"Pre-Market"}):e==="afterhours"||e==="closed"?ss({id:"aLCg3c",defaultMessage:"After Hours"}):ss({id:"2p526c",defaultMessage:"Extended Hours"})}function cf(t,e,s){function a(r,o){const l=dt(new Date,o),c=s.formatDate(l,{year:"numeric",month:"2-digit",day:"2-digit"}),d=cn(r*1e3),u=dt(d,o),m=s.formatDate(u,{year:"numeric",month:"2-digit",day:"2-digit"});return c===m}if(!t||!e||a(t,e))return s.formatMessage(Rt["1d"]);{const r=cn(t*1e3),o=dt(r,e);return s.formatDate(o,{month:"long",day:"numeric"})}}const Rt=Cs({"1d":{id:"SMdcuo",defaultMessage:"Today"},extended:{id:"2p526c",defaultMessage:"Extended Hours"},"5d":{id:"HCA6lr",defaultMessage:"Past 5 days"},"1m":{id:"DJpPMq",defaultMessage:"Past month"},"6m":{id:"1mUJ2L",defaultMessage:"Past 6 months"},ytd:{id:"b9KkhV",defaultMessage:"Year to date"},"1y":{id:"XnvD9A",defaultMessage:"Past year"},"5y":{id:"DfI1RB",defaultMessage:"Past 5 years"},max:{id:"WzOhuU",defaultMessage:"Max"}});function df({metadata:t,trackContentReferenceEvent:e}){const s=f.useCallback(l=>{e("link_action",null,t.type,{url:t.url,title:t.title,pub_date:null,sub_pill_index:null,link_type:"link_title",action:l})},[t.title,t.type,t.url,e]);f.useEffect(()=>{s("show")},[s]);const[a,r]=f.useState(!1),o=()=>{a||(s("hover"),r(!0))},i=()=>{s("click")};return n.jsx(we,{href:t.url,onClick:i,onMouseEnter:o,onFocus:o,className:"underline",children:t.title})}const uf={google_maps:{title:"Google Maps"}};function mf({metadata:t,trackContentReferenceEvent:e}){var a,r;f.useEffect(()=>{e("Search Content Reference Shown","search_content_reference_shown",t.type)},[e,t.type]);const s=(r=(a=uf[t.provider])==null?void 0:a.title)!=null?r:"Maps";return n.jsx("span",{children:n.jsx(D,{id:"ZSUz1k",defaultMessage:" ({link}) ",values:{link:n.jsx(we,{href:t.url,children:s})}})})}function ff(t){"use forget";const e=ge.c(29),{metadata:s,trackContentReferenceEvent:a,isFirstAssistantContent:r}=t,o=J();let i;e[0]!==o?(i=wt(o),e[0]=o,e[1]=i):i=e[1];const l=i;let c;e[2]!==o?(c=Yt(o),e[2]=o,e[3]=c):c=e[3];const d=c,u=s.items.length>0,m=f.useRef(a);let b,y;e[4]!==a?(b=()=>{m.current=a},y=[a],e[4]=a,e[5]=b,e[6]=y):(b=e[5],y=e[6]),f.useEffect(b,y);let v,g;e[7]!==u?(v=()=>{u&&m.current("Search Content Reference Shown","search_content_reference_shown","nav_list")},g=[u],e[7]=u,e[8]=v,e[9]=g):(v=e[8],g=e[9]),f.useEffect(v,g);let j;e[10]!==a?(j=(T,L)=>{a("link_action",null,"nav_list",O(A({},sa(T,L)),{action:"click"}))},e[10]=a,e[11]=j):j=e[11];const _=j;let N;e[12]!==a?(N=(T,L)=>{a("link_action",null,"nav_list",O(A({},sa(T,L)),{action:"show"}))},e[12]=a,e[13]=N):N=e[13];const k=N,h=l&&r,w=s.title&&!h;if(s.items.length===0)return null;const S=!h&&"mt-6";let p;e[14]!==S?(p=P("mb-1",S),e[14]=S,e[15]=p):p=e[15];let C;e[16]!==s.title||e[17]!==w?(C=w&&n.jsx("div",{className:"text-token-text-primary -mb-1 pb-3 font-semibold",children:s.title}),e[16]=s.title,e[17]=w,e[18]=C):C=e[18];let M;e[19]!==_||e[20]!==k||e[21]!==l||e[22]!==d||e[23]!==s.items?(M=l?n.jsx("div",{className:P("relative mb-6",d?"-mx-[var(--thread-content-margin)]":"-mx-6"),children:n.jsx(As,{items:s.items,getItemKey:xf,onRenderItem:pf,className:"min-h-36",itemClassName:"max-w-[200px] min-w-[120px] sm:max-w-[calc((var(--thread-content-max-width)-2rem)/3)] thread-lg:w-61 w-50 shrink-0",onShown:k,onClick:_})}):n.jsx(cr,{items:s.items,onCardRender:hf,onCardShown:k,onCardClicked:_,cardClassName:"transition-all duration-200 border-token-border-default hover:border-light border rounded-xl bg-clip-padding hover:shadow-md overflow-hidden"}),e[19]=_,e[20]=k,e[21]=l,e[22]=d,e[23]=s.items,e[24]=M):M=e[24];let E;return e[25]!==p||e[26]!==C||e[27]!==M?(E=n.jsxs("div",{className:p,"data-testid":"nav-list-widget",children:[C,M]}),e[25]=p,e[26]=C,e[27]=M,e[28]=E):E=e[28],E}function hf(t){return n.jsx(hr,{item:t})}function pf(t){return n.jsx(hr,{item:t})}function xf(t){return t.url}function hr({item:t}){var i,l;const{isSuccess:e}=bs((i=t.thumbnail_url)!=null?i:void 0,"NavListItem"),s=W(),a=J(),r=wt(a),o=fl(s,t.pub_date);return n.jsxs(we,{className:"flex flex-col items-center gap-4 overflow-hidden pb-6",href:t.url,children:[e&&t.thumbnail_url?n.jsx("div",{className:"relative h-36 w-full overflow-hidden",children:n.jsx("img",{src:t.thumbnail_url,className:"m-0 h-full w-full",style:{objectFit:"cover"},alt:t.title})}):n.jsxs("div",{className:P("icon-bg relative flex h-36 w-full shrink-0 items-center justify-center overflow-hidden",r&&"bg-token-bg-secondary"),children:[n.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-cover bg-center bg-no-repeat blur-3xl",children:n.jsx(ct,{url:t.url,size:256,minSize:128,className:"mix-soft-light opacity-30 dark:opacity-20"})}),n.jsx("div",{className:"absolute flex h-10 w-10 items-center justify-center",children:n.jsx(ct,{url:t.url,size:128,minSize:80,className:"icon-xl rounded-full"})})]}),n.jsxs("div",{className:P("flex flex-col gap-2 overflow-hidden px-4 text-ellipsis",r&&"w-full items-start"),children:[n.jsxs("div",{className:"text-token-text-primary flex items-center gap-1.5 text-xs",children:[n.jsx(ct,{url:t.url,size:32,minSize:16,className:"icon-xs my-0 rounded-full"}),(l=t.attribution)!=null?l:Vt(t.url)]}),n.jsx("div",{className:"text-token-text-primary decoration-token-link line-clamp-5 text-sm font-medium",children:t.title}),o&&n.jsx("div",{className:"text-token-text-secondary text-xs",children:o})]})]})}const sa=(t,e)=>({url:t.url,title:t.title,section_index:e,link_type:"text",section:"nav_list",section_location:"response"}),gf="{{.assetPrefix}}/assets/missing-logo-h96s4tk9.webp",na={src:gf};function pr({team:t,className:e}){var o;const[s,a]=f.useState((o=t.logo)!=null?o:na.src),r=()=>{rt.addError("Unable to load sports widget logo",{name:t.name,logo:t.logo}),a(na.src)};return n.jsx("img",{src:s,alt:t.name,className:e,onError:r})}const ht=["ipl"],aa=6,De="home",Fe="away";function bf({scheduleRef:t,trackContentReferenceEvent:e}){var v,g,j,_;const[s,a]=f.useState(!0),r=W(),o=t.games.length>0,i=t.league.id,l=hl(),c=vt();if(f.useEffect(()=>{o&&e("Search Content Reference Shown","search_content_reference_shown","sports",{hasSchedule:!0})},[o]),!o)return null;const u=((g=(v=r.formatDateToParts(new Date,{timeZoneName:"long"}).find(N=>N.type==="timeZoneName"))==null?void 0:v.value)!=null?g:Intl.DateTimeFormat().resolvedOptions().timeZone).replace(/Daylight|Standard/g,"");let m=t.games;const b=N=>Math.abs(new Date().getTime()-new Date(N.date).getTime());b(m[0])>b(m[m.length-1])&&(m=m.slice().reverse());const y=s?m.slice(0,aa):m;return n.jsxs("div",{className:"not-prose mb-3","data-testid":"sports-schedule-widget",children:[n.jsx("div",{className:"font-semibold",children:n.jsx(D,{id:"LA6z9q",defaultMessage:"{league} Schedule",values:{league:t.league.display_name}})}),n.jsx("div",{className:"text-token-text-secondary text-sm",children:u}),y.length===1?n.jsx("div",{children:n.jsx(tn,{children:n.jsx(Dt.div,{initial:{opacity:0,y:15},animate:{opacity:1,y:0},exit:{opacity:0,y:-15},transition:{duration:.2},children:n.jsx("div",{className:"border-token-border-medium mt-3 rounded-xl border py-3",children:n.jsx(vf,{game:y[0],useAlias:ht.includes(i),leagueId:i,activeTeam:(_=(j=y[0])==null?void 0:j.active_team)!=null?_:null,isMobile:c})})})})}):n.jsx("div",{className:"grid grid-cols-1 pt-3 lg:grid-cols-2",children:n.jsx(tn,{children:y.map((N,k)=>{var h;return n.jsx(Dt.div,{initial:{opacity:0,y:15},animate:{opacity:1,y:0,transition:{delay:k*.04}},exit:{opacity:0,y:-15},transition:{duration:.2},children:n.jsx("div",{className:P("border-token-border-medium border-b py-3",k%2===0&&"lg:border-e lg:pe-4",k%2===1&&"lg:ps-4",Math.floor(k/2)===Math.ceil(m.length/2)-1&&"lg:border-b-0",k===m.length-1&&"border-b-0"),children:n.jsx(yf,{game:N,useAlias:(l||c)&&ht.includes(i),leagueId:i,activeTeam:(h=N.active_team)!=null?h:null})})},k)})})}),m.length>aa&&n.jsx("div",{className:"mt-2 flex items-center justify-between",children:n.jsx("button",{className:"flex items-center text-sm font-semibold",onClick:()=>a(!s),children:s?n.jsx(D,{id:"BH/Ee5",defaultMessage:"Show more {icon}",values:{icon:n.jsx(ii,{className:"mb-[-2px]"})}}):n.jsx(D,{id:"Z9BlEu",defaultMessage:"Show less {icon}",values:{icon:n.jsx(li,{className:"mb-[-2px]"})}})})})]})}function yf({game:t,useAlias:e=!1,leagueId:s,activeTeam:a}){var u,m;const r=gr(t),o=[t.first_team_info,t.second_team_info],i=(u=o.find(b=>b.location===De))!=null?u:t.first_team_info,l=(m=o.find(b=>b.location===Fe))!=null?m:t.second_team_info,c=(r==null?void 0:r.team.name)===(i==null?void 0:i.team.name),d=(r==null?void 0:r.team.name)===(l==null?void 0:l.team.name);return n.jsxs("div",{className:"flex w-full gap-1.5 py-3 text-base",children:[n.jsxs("div",{className:"flex flex-auto flex-col items-start gap-1 pe-3",children:[n.jsx(Ut,{team:l.team,isWinner:d,isActive:a===Fe,logoSize:"small",useAlias:e}),n.jsx(Ut,{team:i.team,isWinner:c,isActive:a===De,logoSize:"small",useAlias:e})]}),n.jsxs("div",{className:P("flex flex-none flex-col items-start gap-1",ht.includes(s)&&"me-4"),children:[n.jsx(qt,{score:l.score,scoreSuffix:l.score_suffix,scoreParenthetical:l.score_parenthetical?{message:l.score_parenthetical,position:"right"}:null,isWinner:d,negateScore:Ht(s,Fe,a)}),n.jsx(qt,{score:i.score,scoreSuffix:i.score_suffix,scoreParenthetical:i.score_parenthetical?{message:i.score_parenthetical,position:"right"}:null,isWinner:c,negateScore:Ht(s,De,a)})]}),n.jsx("div",{className:"flex min-w-24 flex-none flex-col items-end justify-center gap-1 text-sm",children:n.jsx(br,{game:t})})]})}function vf({game:t,useAlias:e=!1,leagueId:s,activeTeam:a,isMobile:r}){var m,b;const o=gr(t),i=[t.first_team_info,t.second_team_info],l=(m=i.find(y=>y.location===De))!=null?m:t.first_team_info,c=(b=i.find(y=>y.location===Fe))!=null?b:t.second_team_info,d=(o==null?void 0:o.team.name)===(l==null?void 0:l.team.name),u=(o==null?void 0:o.team.name)===(c==null?void 0:c.team.name);return n.jsxs("div",{className:"flex w-full py-3 text-base",children:[n.jsx("div",{className:"flex flex-1 items-center justify-center px-2",children:n.jsx(Ut,{team:c.team,isWinner:u,isActive:a===Fe,useAlias:e,layoutDirection:r?"column":"row"})}),n.jsx("div",{className:"ms-2 flex items-center justify-start sm:ms-8",children:n.jsx(qt,{score:c.score,scoreSuffix:c.score_suffix,scoreParenthetical:c.score_parenthetical?{message:c.score_parenthetical,position:"bottom"}:null,isWinner:u,negateScore:Ht(s,Fe,a),className:"text-sm font-semibold sm:text-lg"})}),n.jsx("div",{className:"mx-2 flex w-24 shrink flex-col items-center justify-center gap-1 align-middle text-sm",children:n.jsx(br,{game:t})}),n.jsx("div",{className:"me-2 flex items-center justify-end sm:me-8",children:n.jsx(qt,{score:l.score,scoreSuffix:l.score_suffix,scoreParenthetical:l.score_parenthetical?{message:l.score_parenthetical,position:"bottom"}:null,isWinner:d,negateScore:Ht(s,De,a),className:"text-sm font-semibold sm:text-lg"})}),n.jsx("div",{className:"flex flex-1 items-center justify-center md:px-2",children:n.jsx(Ut,{team:l.team,isWinner:d,isActive:a===De,useAlias:e,layoutDirection:r?"column":"row"})})]})}function xr(t){return t.live?"live":new Date(t.date)<new Date?"complete":"scheduled"}function gr(t){return xr(t)!=="complete"||t.first_team_info.score==null||t.second_team_info.score==null?null:t.first_team_info.score>t.second_team_info.score?t.first_team_info:t.second_team_info}function Ht(t,e,s){return ht.includes(t)&&e===De&&s===Fe}function Ut({team:t,isWinner:e,isActive:s,logoSize:a,useAlias:r=!1,layoutDirection:o="row"}){return n.jsxs("span",{className:P("flex items-center gap-1",e&&"font-semibold","max-w-64 lg:max-w-52 xl:max-w-64",o==="column"&&"flex-col"),children:[t.logo&&n.jsx(pr,{team:{name:t.name,logo:t.logo},className:P(a==="small"?"w-6":"w-8")}),n.jsx("span",{className:"truncate",children:r?t.alias:t.name}),s&&n.jsx("span",{className:"bg-token-surface-error inline-block h-2 w-2 rounded-full"})]})}function qt({score:t,scoreSuffix:e,scoreParenthetical:s,isWinner:a,negateScore:r=!1,className:o}){const i=W();return t==null?null:n.jsxs("span",{className:P(a&&"font-semibold",o),children:[r?i.formatMessage({id:"sports.dash",defaultMessage:"-"}):t,e&&!r&&n.jsx("span",{children:e}),s&&!r&&n.jsx("span",{className:P("text-token-text-secondary font-normal",s.position==="right"&&"ms-1",s.position==="bottom"&&"mx-auto block text-center"),children:"(".concat(s.message,")")})]})}function br({game:t}){const e=W();switch(xr(t)){case"live":return n.jsxs(n.Fragment,{children:[n.jsx(wf,{}),n.jsx("div",{children:t.details})]});case"complete":return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"font-semibold",children:n.jsx(D,{id:"q/iMZL",defaultMessage:"Final"})}),n.jsx("div",{className:"text-token-text-secondary",children:vs(e,new Date(t.date))})]});case"scheduled":{const s=new Date(t.date);return isNaN(s.getTime())?null:n.jsxs(n.Fragment,{children:[n.jsx("div",{children:vs(e,s)}),n.jsx("div",{className:"text-token-text-secondary",children:e.formatDate(s,{timeStyle:"short"})})]})}}}function wf(){return n.jsx("div",{className:"bg-token-surface-error rounded-[4px] px-1.5 py-1 text-xs font-semibold text-white",children:n.jsx(D,{id:"vObALn",defaultMessage:"Live"})})}function _f({standingsRef:t,trackContentReferenceEvent:e}){const[s,a]=f.useState(0),r=t.conferences.length>0,o=vt(),i=t.league.id;f.useEffect(()=>{r&&e("Search Content Reference Shown","search_content_reference_shown","sports",{hasStandings:!0})},[r]);const l=t.conferences[s],c=t.conferences.length>1?t.conferences.map((d,u)=>n.jsx("button",{className:P(s===u?"text-token-text-primary":"text-token-text-tertiary","text-sm font-semibold"),onClick:()=>a(u),children:d.name},d.name)):null;return n.jsxs("div",{"data-testid":"sports-standings-widget",children:[c&&n.jsx("div",{className:"flex gap-4",children:c}),n.jsx("div",{className:"mt-3",children:l.divisions.map(d=>d.name?n.jsx("div",{className:"mt-3",children:n.jsx(ra,{division:d,teamsColumnHeader:d.name})},d.name):n.jsx(ra,{division:d,useAlias:o&&ht.includes(i)}))})]})}function ra({division:t,teamsColumnHeader:e,useAlias:s}){const a=t.headers.map(r=>r.key);return n.jsxs(de.Root,{size:"compact",className:"not-prose",children:[n.jsxs(de.Header,{children:[n.jsx(jf,{children:e!=null?e:n.jsx(D,{id:"kKSGje",defaultMessage:"Team"})}),t.headers.map(r=>n.jsx(yr,{textAlign:"center",className:"min-w-11 px-0!",children:n.jsx(oa,{data:r})},r.key))]}),n.jsx(de.Body,{children:t.teams.map(({team:r,data:o},i)=>{const l=o.reduce((c,d)=>(c[d.key]=d,c),{});return n.jsxs(de.Row,{children:[n.jsx(de.Cell,{className:"w-full border-0! py-0! ps-0!",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:"text-token-text-tertiary me-2 w-4 whitespace-nowrap tabular-nums",children:i+1}),n.jsxs("div",{className:"flex items-center justify-start gap-2",children:[n.jsx(pr,{team:r,className:"w-6"}),n.jsx("span",{className:"text-base whitespace-nowrap",children:s?r.alias:r.name})]})]})}),a.map(c=>n.jsx(de.Cell,{className:"min-w-11 border-0! px-0! py-0! text-start whitespace-nowrap tabular-nums",textAlign:"center",children:n.jsx(oa,{data:l[c]})},c))]},r.name)})})]})}function oa({data:t}){switch(t.type){case"text":return n.jsx(n.Fragment,{children:t.text});default:return n.jsx(n.Fragment,{children:t.alt})}}var ua;const yr=zs(de.HeaderCell)(ua||(ua=ot(["text-token-text-secondary font-normal! text-sm static! bg-transparent! border-token-border-default! border-t-0! border-s-0! border-e-0!"])));var ma;const jf=zs(yr)(ma||(ma=ot(["text-token-text-primary ps-0!"])));function kf({metadata:t,trackContentReferenceEvent:e}){f.useEffect(()=>{e("Search Content Reference Shown","search_content_reference_shown",t.type)},[e,t.type]);const s=W(),a=dt(t.utc_time,t.utc_offset),r=s.formatDate(a,{hour:"numeric",minute:"numeric"});return n.jsx("span",{children:r})}function Sf({metadata:t,trackContentReferenceEvent:e}){return f.useEffect(()=>{e("Search Content Reference Shown","search_content_reference_shown",t.type)},[e,t.type]),n.jsx("div",{children:t.url?n.jsx(ci,{webpageItem:{url:t.url,title:t.description,pub_date:null,snippet:"",attributions:null},className:"inline-flex flex-col",children:n.jsx(we,{href:t.url,className:"font-semibold!",children:t.description})}):n.jsx("div",{className:"font-semibold!",children:t.description})})}function Cf({videoId:t,title:e="YouTube video player",fallbackText:s,cookieLess:a=!0,timeoutMs:r=5e3,className:o=""}){const i=f.useRef(null),l=f.useRef(null),c=f.useRef(!1),[d,u]=f.useState("idle"),m=()=>{c.current=!0,l.current&&(clearTimeout(l.current),l.current=null)};if(f.useEffect(()=>{u("loading"),c.current=!1;let y=null;return Nf().then(()=>{if(!i.current)return;i.current.textContent="",y=document.createElement("div"),y.style.width="200px",y.style.height="150px",i.current.appendChild(y),l.current=window.setTimeout(()=>{c.current||u("timeout")},r);const v=a?"https://www.youtube-nocookie.com":"https://www.youtube.com";new window.YT.Player(y,{width:200,height:150,videoId:t,host:v,playerVars:{rel:0,playsinline:1,origin:window.location.origin},events:{onReady:()=>{m(),u("ready")},onError:()=>{m(),u("error")}}})}).catch(()=>u("error")),()=>{m()}},[t,a,r]),d==="error"||d==="timeout")return n.jsx("a",{href:"https://www.youtube.com/watch?v=".concat(t),target:"_blank",rel:"noopener noreferrer",children:s});const b=a?"https://www.youtube-nocookie.com":"https://www.youtube.com";return n.jsxs(n.Fragment,{children:[n.jsx("div",{ref:i,"aria-hidden":!0,inert:!0,className:"hidden"}),n.jsx("iframe",{src:"".concat(b,"/embed/").concat(t),allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerPolicy:"strict-origin-when-cross-origin",allowFullScreen:!0,className:o,title:e})]})}function Nf(){return new Promise(t=>{var s;if((s=window.YT)!=null&&s.Player)return t();const e=window.onYouTubeIframeAPIReady;if(window.onYouTubeIframeAPIReady=()=>{e==null||e(),t(),window.onYouTubeIframeAPIReady=e||(()=>{})},!document.querySelector("script[src*='youtube.com/iframe_api']")){const a=document.createElement("script");a.src="https://www.youtube.com/iframe_api",document.head.appendChild(a)}})}function Mf({url:t,className:e,iframeClassName:s,iframeTitle:a}){const r=J(),o=K(r,"1256582879");let i;const l=P("aspect-video w-full",s),c=Tf(t);c&&(i=o?n.jsx(Cf,{className:l,videoId:c,title:a,fallbackText:a!=null?a:n.jsx(D,{id:"sonic.video.youtube.title",defaultMessage:"YouTube video link"}),cookieLess:!1}):n.jsx(Ef,{videoId:c,className:l,iframeTitle:a}));const d=$f(t);return d&&(i=n.jsx(Pf,{videoId:d,className:l,iframeTitle:a})),i?n.jsx("div",{className:e,children:i}):null}function Tf(t){const e=/^(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/(?:watch\?v=|shorts\/|embed\/|v\/|live\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/,s=t.match(e);return s?s[1]:null}function Ef({videoId:t,className:e,iframeTitle:s}){return n.jsx("iframe",{className:e,src:"https://www.youtube.com/embed/".concat(t),frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerPolicy:"strict-origin-when-cross-origin",allowFullScreen:!0,title:s})}function $f(t){const e=/vimeo\.com\/(?:channels\/(?:\w+\/)?|groups\/[^/]+\/videos\/|video\/|)(\d+)/,s=t.match(e);return s?s[1]:null}function Pf({videoId:t,className:e,iframeTitle:s}){return n.jsx(n.Fragment,{children:n.jsx("iframe",{className:e,src:"https://player.vimeo.com/video/".concat(t),frameBorder:"0",allow:"autoplay; fullscreen; picture-in-picture",allowFullScreen:!0,title:s})})}function Af({video:t,trackContentReferenceEvent:e}){const s={url:t.url,title:t.title};return f.useEffect(()=>{e("Search Content Reference Shown","search_content_reference_shown",t.type,s)},[]),t.url==null||t.url===""?null:n.jsx("div",{className:"not-prose mb-3 flex flex-col gap-4 text-base","data-testid":"video-widget",children:n.jsx(Mf,{url:t.url,iframeClassName:"rounded-lg"})})}const Lf="webp",If=96,Rf=96,Df="srgb",Ff=4,Of="uchar",zf=288,Bf=!1,Wf=!1,Hf=!0,Uf="{{.assetPrefix}}/assets/cloud-foggy-o4a3hmky.webp",qf={format:Lf,width:If,height:Rf,space:Df,channels:Ff,depth:Of,density:zf,isProgressive:Bf,hasProfile:Wf,hasAlpha:Hf,src:Uf},Gf="webp",Vf=96,Yf=96,Xf="srgb",Zf=4,Kf="uchar",Jf=288,Qf=!1,eh=!1,th=!0,sh="{{.assetPrefix}}/assets/cloudy-co8vwrk7.webp",nh={format:Gf,width:Vf,height:Yf,space:Xf,channels:Zf,depth:Kf,density:Jf,isProgressive:Qf,hasProfile:eh,hasAlpha:th,src:sh},ah="webp",rh=96,oh=96,ih="srgb",lh=4,ch="uchar",dh=288,uh=!1,mh=!1,fh=!0,hh="{{.assetPrefix}}/assets/heavy-snow-mke52kag.webp",ph={format:ah,width:rh,height:oh,space:ih,channels:lh,depth:ch,density:dh,isProgressive:uh,hasProfile:mh,hasAlpha:fh,src:hh},xh="webp",gh=96,bh=96,yh="srgb",vh=4,wh="uchar",_h=288,jh=!1,kh=!1,Sh=!0,Ch="{{.assetPrefix}}/assets/light-snow-mcy1l7t9.webp",Nh={format:xh,width:gh,height:bh,space:yh,channels:vh,depth:wh,density:_h,isProgressive:jh,hasProfile:kh,hasAlpha:Sh,src:Ch},Mh="webp",Th=96,Eh=96,$h="srgb",Ph=4,Ah="uchar",Lh=288,Ih=!1,Rh=!1,Dh=!0,Fh="{{.assetPrefix}}/assets/moon-drizzle-cplxr2ub.webp",Oh={format:Mh,width:Th,height:Eh,space:$h,channels:Ph,depth:Ah,density:Lh,isProgressive:Ih,hasProfile:Rh,hasAlpha:Dh,src:Fh},zh="webp",Bh=96,Wh=96,Hh="srgb",Uh=4,qh="uchar",Gh=288,Vh=!1,Yh=!1,Xh=!0,Zh="{{.assetPrefix}}/assets/moon-hazy-jvgt25bp.webp",Kh={format:zh,width:Bh,height:Wh,space:Hh,channels:Uh,depth:qh,density:Gh,isProgressive:Vh,hasProfile:Yh,hasAlpha:Xh,src:Zh},Jh="webp",Qh=96,ep=96,tp="srgb",sp=4,np="uchar",ap=288,rp=!1,op=!1,ip=!0,lp="{{.assetPrefix}}/assets/moon-mostly-cloudy-cia3do0v.webp",cp={format:Jh,width:Qh,height:ep,space:tp,channels:sp,depth:np,density:ap,isProgressive:rp,hasProfile:op,hasAlpha:ip,src:lp},dp="webp",up=96,mp=96,fp="srgb",hp=4,pp="uchar",xp=288,gp=!1,bp=!1,yp=!0,vp="{{.assetPrefix}}/assets/moon-mostly-sunny-n3mh1b6a.webp",wp={format:dp,width:up,height:mp,space:fp,channels:hp,depth:pp,density:xp,isProgressive:gp,hasProfile:bp,hasAlpha:yp,src:vp},_p="webp",jp=96,kp=96,Sp="srgb",Cp=4,Np="uchar",Mp=288,Tp=!1,Ep=!1,$p=!0,Pp="{{.assetPrefix}}/assets/moon-shower-ntzhti9o.webp",Ap={format:_p,width:jp,height:kp,space:Sp,channels:Cp,depth:Np,density:Mp,isProgressive:Tp,hasProfile:Ep,hasAlpha:$p,src:Pp},Lp="webp",Ip=96,Rp=96,Dp="srgb",Fp=4,Op="uchar",zp=288,Bp=!1,Wp=!1,Hp=!0,Up="{{.assetPrefix}}/assets/moon-sunny-eg2emh4d.webp",qp={format:Lp,width:Ip,height:Rp,space:Dp,channels:Fp,depth:Op,density:zp,isProgressive:Bp,hasProfile:Wp,hasAlpha:Hp,src:Up},Gp="webp",Vp=96,Yp=96,Xp="srgb",Zp=4,Kp="uchar",Jp=288,Qp=!1,ex=!1,tx=!0,sx="{{.assetPrefix}}/assets/rain-thunder-bx7a0l5g.webp",nx={format:Gp,width:Vp,height:Yp,space:Xp,channels:Zp,depth:Kp,density:Jp,isProgressive:Qp,hasProfile:ex,hasAlpha:tx,src:sx},ax="webp",rx=96,ox=96,ix="srgb",lx=4,cx="uchar",dx=288,ux=!1,mx=!1,fx=!0,hx="{{.assetPrefix}}/assets/rain-cxs76xuj.webp",px={format:ax,width:rx,height:ox,space:ix,channels:lx,depth:cx,density:dx,isProgressive:ux,hasProfile:mx,hasAlpha:fx,src:hx},xx="webp",gx=96,bx=96,yx="srgb",vx=4,wx="uchar",_x=288,jx=!1,kx=!1,Sx=!0,Cx="{{.assetPrefix}}/assets/sleet-gc63vwmo.webp",Nx={format:xx,width:gx,height:bx,space:yx,channels:vx,depth:wx,density:_x,isProgressive:jx,hasProfile:kx,hasAlpha:Sx,src:Cx},Mx="webp",Tx=96,Ex=96,$x="srgb",Px=4,Ax="uchar",Lx=288,Ix=!1,Rx=!1,Dx=!0,Fx="{{.assetPrefix}}/assets/snow-d0k6tmmc.webp",Ox={format:Mx,width:Tx,height:Ex,space:$x,channels:Px,depth:Ax,density:Lx,isProgressive:Ix,hasProfile:Rx,hasAlpha:Dx,src:Fx},zx="webp",Bx=96,Wx=96,Hx="srgb",Ux=4,qx="uchar",Gx=288,Vx=!1,Yx=!1,Xx=!0,Zx="{{.assetPrefix}}/assets/sun-drizzle-g94obr5e.webp",Kx={format:zx,width:Bx,height:Wx,space:Hx,channels:Ux,depth:qx,density:Gx,isProgressive:Vx,hasProfile:Yx,hasAlpha:Xx,src:Zx},Jx="webp",Qx=96,eg=96,tg="srgb",sg=4,ng="uchar",ag=288,rg=!1,og=!1,ig=!0,lg="{{.assetPrefix}}/assets/sun-hazy-c3z1j0hy.webp",cg={format:Jx,width:Qx,height:eg,space:tg,channels:sg,depth:ng,density:ag,isProgressive:rg,hasProfile:og,hasAlpha:ig,src:lg},dg="webp",ug=96,mg=96,fg="srgb",hg=4,pg="uchar",xg=288,gg=!1,bg=!1,yg=!0,vg="{{.assetPrefix}}/assets/sun-mostly-cloudy-d4o4zkga.webp",wg={format:dg,width:ug,height:mg,space:fg,channels:hg,depth:pg,density:xg,isProgressive:gg,hasProfile:bg,hasAlpha:yg,src:vg},_g="webp",jg=96,kg=96,Sg="srgb",Cg=4,Ng="uchar",Mg=288,Tg=!1,Eg=!1,$g=!0,Pg="{{.assetPrefix}}/assets/sun-mostly-sunny-livrdkgu.webp",Ag={format:_g,width:jg,height:kg,space:Sg,channels:Cg,depth:Ng,density:Mg,isProgressive:Tg,hasProfile:Eg,hasAlpha:$g,src:Pg},Lg="webp",Ig=96,Rg=96,Dg="srgb",Fg=4,Og="uchar",zg=288,Bg=!1,Wg=!1,Hg=!0,Ug="{{.assetPrefix}}/assets/sun-shower-lvtjthah.webp",qg={format:Lg,width:Ig,height:Rg,space:Dg,channels:Fg,depth:Og,density:zg,isProgressive:Bg,hasProfile:Wg,hasAlpha:Hg,src:Ug},Gg="webp",Vg=96,Yg=96,Xg="srgb",Zg=4,Kg="uchar",Jg=288,Qg=!1,e1=!1,t1=!0,s1="{{.assetPrefix}}/assets/sun-sunny-kqjpjzd8.webp",n1={format:Gg,width:Vg,height:Yg,space:Xg,channels:Zg,depth:Kg,density:Jg,isProgressive:Qg,hasProfile:e1,hasAlpha:t1,src:s1},a1="webp",r1=96,o1=96,i1="srgb",l1=4,c1="uchar",d1=288,u1=!1,m1=!1,f1=!0,h1="{{.assetPrefix}}/assets/thunder-jgjqg9ai.webp",p1={format:a1,width:r1,height:o1,space:i1,channels:l1,depth:c1,density:d1,isProgressive:u1,hasProfile:m1,hasAlpha:f1,src:h1},x1="webp",g1=96,b1=96,y1="srgb",v1=4,w1="uchar",_1=288,j1=!1,k1=!1,S1=!0,C1="{{.assetPrefix}}/assets/tornado-opa24tq3.webp",N1={format:x1,width:g1,height:b1,space:y1,channels:v1,depth:w1,density:_1,isProgressive:j1,hasProfile:k1,hasAlpha:S1,src:C1},M1="webp",T1=96,E1=96,$1="srgb",P1=4,A1="uchar",L1=288,I1=!1,R1=!1,D1=!0,F1="{{.assetPrefix}}/assets/windy-mw0a3u21.webp",O1={format:M1,width:T1,height:E1,space:$1,channels:P1,depth:A1,density:L1,isProgressive:I1,hasProfile:R1,hasAlpha:D1,src:F1},z1="webp",B1=96,W1=96,H1="srgb",U1=4,q1="uchar",G1=288,V1=!1,Y1=!1,X1=!0,Z1="{{.assetPrefix}}/assets/cloud-foggy-fhg0jn0w.webp",K1={format:z1,width:B1,height:W1,space:H1,channels:U1,depth:q1,density:G1,isProgressive:V1,hasProfile:Y1,hasAlpha:X1,src:Z1},J1="webp",Q1=96,e0=96,t0="srgb",s0=4,n0="uchar",a0=288,r0=!1,o0=!1,i0=!0,l0="{{.assetPrefix}}/assets/cloudy-disd26f3.webp",c0={format:J1,width:Q1,height:e0,space:t0,channels:s0,depth:n0,density:a0,isProgressive:r0,hasProfile:o0,hasAlpha:i0,src:l0},d0="webp",u0=96,m0=96,f0="srgb",h0=4,p0="uchar",x0=288,g0=!1,b0=!1,y0=!0,v0="{{.assetPrefix}}/assets/heavy-snow-g6jjwo2d.webp",w0={format:d0,width:u0,height:m0,space:f0,channels:h0,depth:p0,density:x0,isProgressive:g0,hasProfile:b0,hasAlpha:y0,src:v0},_0="webp",j0=96,k0=96,S0="srgb",C0=4,N0="uchar",M0=288,T0=!1,E0=!1,$0=!0,P0="{{.assetPrefix}}/assets/light-snow-iz0efpkh.webp",A0={format:_0,width:j0,height:k0,space:S0,channels:C0,depth:N0,density:M0,isProgressive:T0,hasProfile:E0,hasAlpha:$0,src:P0},L0="webp",I0=96,R0=96,D0="srgb",F0=4,O0="uchar",z0=288,B0=!1,W0=!1,H0=!0,U0="{{.assetPrefix}}/assets/moon-drizzle-b1nfv39c.webp",q0={format:L0,width:I0,height:R0,space:D0,channels:F0,depth:O0,density:z0,isProgressive:B0,hasProfile:W0,hasAlpha:H0,src:U0},G0="webp",V0=96,Y0=96,X0="srgb",Z0=4,K0="uchar",J0=288,Q0=!1,eb=!1,tb=!0,sb="{{.assetPrefix}}/assets/moon-hazy-nfnzea7a.webp",nb={format:G0,width:V0,height:Y0,space:X0,channels:Z0,depth:K0,density:J0,isProgressive:Q0,hasProfile:eb,hasAlpha:tb,src:sb},ab="webp",rb=96,ob=96,ib="srgb",lb=4,cb="uchar",db=288,ub=!1,mb=!1,fb=!0,hb="{{.assetPrefix}}/assets/moon-mostly-cloudy-e56e3z55.webp",pb={format:ab,width:rb,height:ob,space:ib,channels:lb,depth:cb,density:db,isProgressive:ub,hasProfile:mb,hasAlpha:fb,src:hb},xb="webp",gb=96,bb=96,yb="srgb",vb=4,wb="uchar",_b=288,jb=!1,kb=!1,Sb=!0,Cb="{{.assetPrefix}}/assets/moon-mostly-sunny-ffu4gzf4.webp",Nb={format:xb,width:gb,height:bb,space:yb,channels:vb,depth:wb,density:_b,isProgressive:jb,hasProfile:kb,hasAlpha:Sb,src:Cb},Mb="webp",Tb=96,Eb=96,$b="srgb",Pb=4,Ab="uchar",Lb=288,Ib=!1,Rb=!1,Db=!0,Fb="{{.assetPrefix}}/assets/moon-shower-e5dy9u48.webp",Ob={format:Mb,width:Tb,height:Eb,space:$b,channels:Pb,depth:Ab,density:Lb,isProgressive:Ib,hasProfile:Rb,hasAlpha:Db,src:Fb},zb="webp",Bb=96,Wb=96,Hb="srgb",Ub=4,qb="uchar",Gb=288,Vb=!1,Yb=!1,Xb=!0,Zb="{{.assetPrefix}}/assets/moon-sunny-d9o08xiw.webp",Kb={format:zb,width:Bb,height:Wb,space:Hb,channels:Ub,depth:qb,density:Gb,isProgressive:Vb,hasProfile:Yb,hasAlpha:Xb,src:Zb},Jb="webp",Qb=96,ey=96,ty="srgb",sy=4,ny="uchar",ay=288,ry=!1,oy=!1,iy=!0,ly="{{.assetPrefix}}/assets/rain-thunder-eplemvu1.webp",cy={format:Jb,width:Qb,height:ey,space:ty,channels:sy,depth:ny,density:ay,isProgressive:ry,hasProfile:oy,hasAlpha:iy,src:ly},dy="webp",uy=96,my=96,fy="srgb",hy=4,py="uchar",xy=288,gy=!1,by=!1,yy=!0,vy="{{.assetPrefix}}/assets/rain-ogayr6kt.webp",wy={format:dy,width:uy,height:my,space:fy,channels:hy,depth:py,density:xy,isProgressive:gy,hasProfile:by,hasAlpha:yy,src:vy},_y="webp",jy=96,ky=96,Sy="srgb",Cy=4,Ny="uchar",My=288,Ty=!1,Ey=!1,$y=!0,Py="{{.assetPrefix}}/assets/sleet-o8noil7l.webp",Ay={format:_y,width:jy,height:ky,space:Sy,channels:Cy,depth:Ny,density:My,isProgressive:Ty,hasProfile:Ey,hasAlpha:$y,src:Py},Ly="webp",Iy=96,Ry=96,Dy="srgb",Fy=4,Oy="uchar",zy=288,By=!1,Wy=!1,Hy=!0,Uy="{{.assetPrefix}}/assets/snow-lq4cl3uc.webp",qy={format:Ly,width:Iy,height:Ry,space:Dy,channels:Fy,depth:Oy,density:zy,isProgressive:By,hasProfile:Wy,hasAlpha:Hy,src:Uy},Gy="webp",Vy=96,Yy=96,Xy="srgb",Zy=4,Ky="uchar",Jy=288,Qy=!1,ev=!1,tv=!0,sv="{{.assetPrefix}}/assets/sun-drizzle-htsohv65.webp",nv={format:Gy,width:Vy,height:Yy,space:Xy,channels:Zy,depth:Ky,density:Jy,isProgressive:Qy,hasProfile:ev,hasAlpha:tv,src:sv},av="webp",rv=96,ov=96,iv="srgb",lv=4,cv="uchar",dv=288,uv=!1,mv=!1,fv=!0,hv="{{.assetPrefix}}/assets/sun-hazy-nfj7clcd.webp",pv={format:av,width:rv,height:ov,space:iv,channels:lv,depth:cv,density:dv,isProgressive:uv,hasProfile:mv,hasAlpha:fv,src:hv},xv="webp",gv=96,bv=96,yv="srgb",vv=4,wv="uchar",_v=288,jv=!1,kv=!1,Sv=!0,Cv="{{.assetPrefix}}/assets/sun-mostly-cloudy-e3pqqgs7.webp",Nv={format:xv,width:gv,height:bv,space:yv,channels:vv,depth:wv,density:_v,isProgressive:jv,hasProfile:kv,hasAlpha:Sv,src:Cv},Mv="webp",Tv=96,Ev=96,$v="srgb",Pv=4,Av="uchar",Lv=288,Iv=!1,Rv=!1,Dv=!0,Fv="{{.assetPrefix}}/assets/sun-mostly-sunny-o99k1c7a.webp",Ov={format:Mv,width:Tv,height:Ev,space:$v,channels:Pv,depth:Av,density:Lv,isProgressive:Iv,hasProfile:Rv,hasAlpha:Dv,src:Fv},zv="webp",Bv=96,Wv=96,Hv="srgb",Uv=4,qv="uchar",Gv=288,Vv=!1,Yv=!1,Xv=!0,Zv="{{.assetPrefix}}/assets/sun-shower-ldwl4jbp.webp",Kv={format:zv,width:Bv,height:Wv,space:Hv,channels:Uv,depth:qv,density:Gv,isProgressive:Vv,hasProfile:Yv,hasAlpha:Xv,src:Zv},Jv="webp",Qv=96,ew=96,tw="srgb",sw=4,nw="uchar",aw=288,rw=!1,ow=!1,iw=!0,lw="{{.assetPrefix}}/assets/sun-sunny-kqjpjzd8.webp",cw={format:Jv,width:Qv,height:ew,space:tw,channels:sw,depth:nw,density:aw,isProgressive:rw,hasProfile:ow,hasAlpha:iw,src:lw},dw="webp",uw=96,mw=96,fw="srgb",hw=4,pw="uchar",xw=288,gw=!1,bw=!1,yw=!0,vw="{{.assetPrefix}}/assets/thunder-xzn1cku3.webp",ww={format:dw,width:uw,height:mw,space:fw,channels:hw,depth:pw,density:xw,isProgressive:gw,hasProfile:bw,hasAlpha:yw,src:vw},_w="webp",jw=96,kw=96,Sw="srgb",Cw=4,Nw="uchar",Mw=288,Tw=!1,Ew=!1,$w=!0,Pw="{{.assetPrefix}}/assets/tornado-diqu61wg.webp",Aw={format:_w,width:jw,height:kw,space:Sw,channels:Cw,depth:Nw,density:Mw,isProgressive:Tw,hasProfile:Ew,hasAlpha:$w,src:Pw},Lw="webp",Iw=96,Rw=96,Dw="srgb",Fw=4,Ow="uchar",zw=288,Bw=!1,Ww=!1,Hw=!0,Uw="{{.assetPrefix}}/assets/windy-n2v8wtyp.webp",qw={format:Lw,width:Iw,height:Rw,space:Dw,channels:Fw,depth:Ow,density:zw,isProgressive:Bw,hasProfile:Ww,hasAlpha:Hw,src:Uw},Gw={foggy:{default:qf},cloudy:{default:nh},"heavy-snow":{default:ph},"light-snow":{default:Nh},sleet:{default:Nx},drizzle:{default:Kx,night:Oh},hazy:{default:cg,night:Kh},"mostly-cloudy":{default:wg,night:cp},"mostly-sunny":{default:Ag,night:wp},shower:{default:qg,night:Ap},sunny:{default:n1,night:qp},"rain-thunder":{default:nx},rain:{default:px},snow:{default:Ox},thunder:{default:p1},tornado:{default:N1},windy:{default:O1}},Vw={foggy:{default:K1},cloudy:{default:c0},"heavy-snow":{default:w0},"light-snow":{default:A0},sleet:{default:Ay},drizzle:{default:nv,night:q0},hazy:{default:pv,night:nb},"mostly-cloudy":{default:Nv,night:pb},"mostly-sunny":{default:Ov,night:Nb},shower:{default:Kv,night:Ob},sunny:{default:cw,night:Kb},"rain-thunder":{default:cy},rain:{default:wy},snow:{default:qy},thunder:{default:ww},tornado:{default:Aw},windy:{default:qw}};function Yw({weatherCode:t,isDarkMode:e,isNight:s}){const a=e?Vw:Gw,r=Xw(t),o=a[r];return o.night&&s?o.night:o.default}function Xw(t){switch(t){case 1:case 33:return"sunny";case 2:case 3:case 34:case 35:case 36:return"mostly-sunny";case 4:case 6:case 13:case 14:case 38:return"mostly-cloudy";case 5:case 37:return"hazy";case 7:case 8:return"cloudy";case 11:return"foggy";case 12:case 39:case 40:return"shower";case 15:case 16:case 17:case 41:case 42:return"thunder";case 18:return"rain";case 19:case 20:case 21:case 43:return"light-snow";case 22:case 23:case 44:return"snow";case 24:case 25:case 26:case 29:return"sleet";case 32:return"windy";default:return"cloudy"}}const Zw="C";function Kw(t,e){return Math.round(t==="F"?e*9/5+32:(e-32)*5/9)}function ia(t,e,s=Zw){return t===s?"".concat(Math.round(e),"°"):"".concat(Kw(t,e),"°")}const Jw=7,la=8,Qw=f.memo(function({weatherResults:e,dateRange:s,turnIndex:a,trackContentReferenceEvent:r}){const[o,i]=d_(),l=s_(e);f.useEffect(()=>{r("Search Content Reference Shown","search_content_reference_shown","forecast")},[r]);const{daily:c,hourly:d,historical:u}=e;let m="daily";if(s||d&&c.length<2)m="hourly";else if(c.length>0)m="daily";else if(u&&(u==null?void 0:u.length)>0)m="historical";else return null;return n.jsxs("div",{className:"relative","data-testid":"weather-widget",children:[l?n.jsxs(n.Fragment,{children:[n.jsx(t_,{weatherResults:e}),n.jsx(n_,{weatherResults:e,temperatureUnit:o,setTemperatureUnit:i})]}):n.jsx("div",{className:"bg-token-main-surface-primary absolute end-0 top-3 z-10 rounded-sm",children:n.jsx(vr,{onTemperatureUnitChange:i,temperatureUnit:o})}),n.jsx(i_,{turnIndex:a}),m==="hourly"&&n.jsx(a_,{weatherResults:e,temperatureUnit:o,dateRange:s}),m==="daily"&&n.jsx(r_,{dailyForecast:c.slice(0,Jw),temperatureUnit:o}),m==="historical"&&n.jsx(o_,{historical:u,temperatureUnit:o})]})});function e_({weatherAlert:t}){const[e,s]=f.useState(!1),a=W(),r=Wa(),o=Ne(t.start_timestamp,t.utc_offset_sec),i=t.end_timestamp?Ne(t.end_timestamp,t.utc_offset_sec):null,l=n.jsxs(n.Fragment,{children:[n.jsx("div",{children:n.jsx(D,{id:"JnuGPS",defaultMessage:"{start}{separator}{end}",values:{start:a.formatDate(o,{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"numeric"}),separator:i?" - ":"",end:i?a.formatDate(i,{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"numeric"}):""}})}),n.jsx("div",{children:t.summary})]});return n.jsxs("button",{className:"my-2 flex w-full flex-col gap-2 rounded-xl border border-red-200 bg-red-100 px-4 py-3 text-start text-sm text-red-800",onClick:()=>s(!e),children:[n.jsxs("div",{className:"flex w-full items-center gap-4",children:[n.jsx(bl,{className:"h-9 w-9 shrink-0"}),n.jsxs("div",{className:"flex flex-col",children:[n.jsx("div",{className:"font-bold",children:n.jsx(D,{id:"y+fy/l",defaultMessage:"Severe Weather: {name}",values:{name:t.name}})}),r&&l]}),n.jsx("div",{className:"grow"}),n.jsx("div",{className:"opacity-30",children:e?n.jsx(fc,{className:"icon-lg"}):n.jsx(mc,{className:"icon-lg"})})]}),e&&t.details&&n.jsxs(n.Fragment,{children:[!r&&l,n.jsx("div",{className:"mt-1 whitespace-pre-wrap",children:t.details.trim()})]})]})}function t_({weatherResults:t}){const{severe:e}=t;return e?n.jsx("div",{className:"my-2",children:e.map((s,a)=>n.jsx(e_,{weatherAlert:s},a))}):null}function s_(t){const{historical:e,daily:s,hourly:a,current:r}=t;if(!r)return!1;let o=!1;const i=Ne(r.timestamp,r.utc_offset_sec);for(const l of[e,s,a])l&&(o=o||(l==null?void 0:l.some(c=>xl(i,Ne(c.timestamp,c.utc_offset_sec)))));return o}function n_({weatherResults:t,temperatureUnit:e,setTemperatureUnit:s}){const a=W(),{current:r}=t;if(!r)return null;const o=r.temperature.current,i=r.description,l=o!=null&&i&&" · ";return n.jsxs("div",{className:"not-prose flex items-center gap-4",children:[n.jsxs("div",{className:"grow",children:[n.jsxs("div",{className:"text-lg font-semibold",children:[o!=null&&n.jsx(D,{id:"FiwByI",defaultMessage:"Currently {temperature}",values:{temperature:Oe(a,o,e)}}),l,i.description]}),n.jsx("div",{className:"text-token-text-secondary",children:c_(t.location)})]}),n.jsxs("div",{className:"flex",children:[n.jsx(vr,{onTemperatureUnitChange:s,temperatureUnit:e}),n.jsx(Ys,{weatherDescriptionData:i,isNight:r.night})]})]})}function Vs({children:t}){return n.jsx("div",{className:"no-scrollbar not-prose mt-1 overflow-auto sm:overflow-hidden",children:n.jsx(de.Root,{className:"min-w-0",children:n.jsx(de.Body,{className:"border-token-border-medium border-b-[0.5px] [&_tr:last-child]:border-b-0",children:t})})})}function a_({weatherResults:t,temperatureUnit:e,dateRange:s}){const a=W(),{hourly:r,current:o}=t;let i=r!=null?r:[];s&&(i=i.filter(u=>u.timestamp>=s.start_timestamp&&u.timestamp<s.end_timestamp));const[l,c]=f.useState(!1),d=i.length>la;if(!l&&d){const u=i[0],m=Ne(u.timestamp,u.utc_offset_sec);let b=!1;if(o){const y=Ne(o.timestamp,o.utc_offset_sec);m.getTime()-y.getTime()>8*60*60*1e3&&i.length>18&&(i=i.slice(7,18),b=!0)}b||(i=i.slice(0,la))}return n.jsxs(Vs,{children:[i.map((u,m)=>n.jsxs(de.Row,{children:[n.jsxs(ye,{className:"w-44",children:[n.jsx(Ys,{weatherDescriptionData:u.description,isNight:u.night,size:"small"}),n.jsx("div",{className:"ms-3 whitespace-nowrap",children:n.jsx("span",{className:"lowercase",children:l_(a,u)})})]}),n.jsx(ye,{className:"w-[60px] tabular-nums",children:n.jsx("div",{children:Oe(a,u.temperature.current,e)})}),n.jsx(ye,{children:u.description.description})]},m)),d&&n.jsx(de.Row,{children:n.jsx(ye,{className:"w-44",children:n.jsx(xe,{color:"secondary",onClick:()=>c(!l),size:"small",children:l?n.jsx(D,{id:"KoC8Ym",defaultMessage:"Show less"}):n.jsx(D,{id:"X8F8Y/",defaultMessage:"Show more"})})})})]})}function r_({dailyForecast:t,temperatureUnit:e}){const s=W();return n.jsx(Vs,{children:t.map((a,r)=>n.jsxs(de.Row,{children:[n.jsxs(ye,{className:"w-[7.5rem] min-w-[7.5rem]",children:[n.jsx(Ys,{weatherDescriptionData:a.description,isNight:a.night,size:"small"}),n.jsx("div",{className:"ms-3 whitespace-nowrap",children:vs(s,Ne(a.timestamp,a.utc_offset_sec))})]}),n.jsxs(ye,{className:"tabular-nums",children:[n.jsx("div",{children:Oe(s,a.temperature.max,e)}),n.jsx("div",{className:"text-token-text-secondary ms-1",children:Oe(s,a.temperature.min,e)})]}),n.jsx(ye,{className:"min-w-80",children:a.description.description})]},r))})}function o_({historical:t,temperatureUnit:e}){const s=W();return t?n.jsx(Vs,{children:t.map((a,r)=>{const o=Ne(a.timestamp,a.utc_offset_sec);return n.jsxs(de.Row,{children:[n.jsx(ye,{className:"w-[250px]",children:n.jsx("div",{className:"ms-3 whitespace-nowrap",children:s.formatDate(o,{weekday:"long",month:"short",day:"numeric"})})}),n.jsx(ye,{className:"tabular-nums",children:a.temperature.max&&a.temperature.min?n.jsxs(n.Fragment,{children:[n.jsx("div",{children:Oe(s,a.temperature.max,e)}),n.jsx("div",{className:"text-token-text-secondary ms-1",children:Oe(s,a.temperature.min,e)})]}):n.jsx("div",{children:Oe(s,a.temperature.current,e)})}),n.jsx(ye,{})]},r)})}):null}function ye({className:t,children:e}){return n.jsx(de.Cell,{className:P("border-token-border-xlight! border-s-0! border-e-0! py-2! ps-4! pe-3! first:ps-0! last:pe-0!",t),divClassName:"items-start leading-relaxed",children:e})}function i_({turnIndex:t}){const e=ui(a=>{var r,o;return(o=(r=a.thread)==null?void 0:r.turns[t])==null?void 0:o.use_location}),[s]=Yl();return!s.useLocation&&e?n.jsx("div",{className:"mt-3",children:n.jsx(xe,{color:"secondary",icon:mi,onClick:()=>{Vl.setSettingsModalOpen(!0)},children:n.jsx(D,{id:"f47VEc",defaultMessage:"Share precise location"})})}):null}function vr({temperatureUnit:t,onTemperatureUnitChange:e}){const s=a=>t===a?"font-bold":"font-light";return n.jsx(gl,{size:"small",triggerButton:n.jsx("button",{className:"text-token-text-tertiary hover:text-token-text-primary flex items-center justify-center p-1.5",children:n.jsx(di,{className:"icon-sm"})}),children:n.jsxs(Ee.Item,{onClick:()=>{e(t==="C"?"F":"C")},className:"text-token-text-primary",children:[n.jsx(D,{id:"bQIoe/",defaultMessage:"Temperature"}),n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:s("F"),children:n.jsx(D,{id:"bvDeBB",defaultMessage:"°F"})}),n.jsx("div",{className:"mx-1 h-4 border-s border-gray-300"}),n.jsx("div",{className:s("C"),children:n.jsx(D,{id:"iNiz6O",defaultMessage:"°C"})})]})]})})}function Ys({weatherDescriptionData:t,isNight:e=!1,size:s="normal"}){const a=jt(),r=s==="small"?30:50;return n.jsx("img",{draggable:!1,alt:t.description,src:Yw({weatherCode:t.id,isDarkMode:a,isNight:e}).src,width:r,height:r})}function l_(t,e){const s=Ne(e.timestamp,e.utc_offset_sec);return t.formatDate(s,{hour:"numeric"})}function Oe(t,e,s){return e==null?"-":ia(s?s!=null?s:"F":wr(t),e)}function wr(t){const e=["en-US","en-BZ","en-BS","en-KY","en-PW"],s=t.locale||"en-US";return e.includes(s)?"F":"C"}function c_(t){const e=t.name.split(",").map(s=>s.trim());return t.country&&!e.includes(t.country)&&e.push(t.country),e.join(", ")}const d_=()=>{const t=W(),[e,s]=pl("USER_TEMPERATURE_UNIT",wr(t),a=>["F","C"].includes(a));return[e,s]};function ca({contentReference:t,clientThreadId:e,messageId:s,trackContentReferenceEvent:a,contentReferenceIndex:r}){var m;const o=Is(),i=o?"sidebar":"primary",l="metadata"in t&&((m=t.metadata)!=null&&m.location)?String(t.metadata.location):void 0,c=f.useMemo(()=>({content_reference_start_index:t.start_idx,entity_name:t.name,category:t.category,conversation_type:i,contentReferenceIndex:r,metadata_location:l}),[t.start_idx,t.name,t.category,i,r,l]);f.useEffect(()=>{a("Entity Anchor Content Reference Shown","entity_anchor_content_reference_shown","entity",c)},[a,c]);const{openThreadSidebar:d}=_t(),{resetSidebarHistory:u}=Ma();return n.jsx("span",{className:"hover:entity-accent entity-underline inline cursor-pointer align-baseline",onClick:b=>{var y,v;b.preventDefault(),a("Entity Anchor Content Reference Clicked","entity_anchor_content_reference_clicked","entity",c),e&&(o||u(),d({type:"entity",clientThreadId:e,debugThreadId:void 0,messageId:s,contentReferenceStartIndex:t.start_idx,query:t.name,category:(y=t.category)!=null?y:void 0,extraParams:(v=t.extra_params)!=null?v:void 0}))},children:n.jsx("span",{className:"whitespace-normal",children:t.name})})}const u_=Ia(()=>Fs(()=>import("./fbqlxc5qyzowzfhb.js"),__vite__mapDeps([12,1,2,3,4,5,13,14,15,16,17,18,19,20,21,22,23,24,7,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53])).then(t=>t.BusinessesMap));function m_(t){"use forget";var $;const e=ge.c(161),{index:s,FormattedText:a,node:r,wordFadeType:o}=t,i=parseInt(s,10),l=f.useContext(Ce),c=J(),d=K(c,"2137702454");let u;e[0]!==c?(u=wt(c),e[0]=c,e[1]=u):u=e[1];const m=u;let b;e[2]!==(l==null?void 0:l.analyticsMetadata)||e[3]!==m?(b=x=>m?Je.getConversationTurns(x).findIndex(p_)===(l==null?void 0:l.analyticsMetadata.turnIndex):void 0,e[2]=l==null?void 0:l.analyticsMetadata,e[3]=m,e[4]=b):b=e[4];const v=nt(l==null?void 0:l.clientThreadId,b)===!0&&i===0,g=Ea(l==null?void 0:l.analyticsMetadata),j=f.useRef(!1);if(l==null)return null;const{contentReferences:_,onShowSearchResults:N,numImageResults:k,analyticsMetadata:h,message:w,superWidgetImages:S}=l,p=_==null?void 0:_[i];if(!p||h.turnIndex===void 0||p.type===void 0)return null;let C;e[5]===Symbol.for("react.memo_cache_sentinel")?(C={img:h_},e[5]=C):C=e[5];let M;e[6]!==p.alt?(M=n.jsx(Rs,{components:C,children:p.alt}),e[6]=p.alt,e[7]=M):M=e[7];const E=M;let T=null;e:switch(p.type){case"title_citation":{let x;e[8]!==p||e[9]!==g?(x=n.jsx(Sf,{metadata:p,trackContentReferenceEvent:g}),e[8]=p,e[9]=g,e[10]=x):x=e[10],T=x;break e}case"link_title":{let x;e[11]!==p||e[12]!==g?(x=n.jsx(df,{metadata:p,trackContentReferenceEvent:g}),e[11]=p,e[12]=g,e[13]=x):x=e[13],T=x;break e}case"location_search":{let x;e[14]!==p||e[15]!==g?(x=n.jsx(mf,{metadata:p,trackContentReferenceEvent:g}),e[14]=p,e[15]=g,e[16]=x):x=e[16],T=x;break e}case"time":{let x;e[17]!==p||e[18]!==g?(x=n.jsx(kf,{metadata:p,trackContentReferenceEvent:g}),e[17]=p,e[18]=g,e[19]=x):x=e[19],T=x;break e}case"image_v2":{const x=k!=null?k:0;let R;e[20]!==h||e[21]!==p||e[22]!==g||e[23]!==v||e[24]!==S||e[25]!==x?(R=n.jsx(Us,{metadata:p,numImageResults:x,analyticsMetadata:h,trackContentReferenceEvent:g,superWidgetImages:S,isFirstAssistantContent:v}),e[20]=h,e[21]=p,e[22]=g,e[23]=v,e[24]=S,e[25]=x,e[26]=R):R=e[26],T=R;break e}case"nav_list":{let x;e[27]!==p||e[28]!==g||e[29]!==v?(x=n.jsx(ff,{metadata:p,trackContentReferenceEvent:g,isFirstAssistantContent:v}),e[27]=p,e[28]=g,e[29]=v,e[30]=x):x=e[30],T=x;break e}case"file_navlist":{let x;e[31]!==p||e[32]!==g?(x=n.jsx(qm,{metadata:p,trackContentReferenceEvent:g}),e[31]=p,e[32]=g,e[33]=x):x=e[33],T=x;break e}case"file":{if(d){let x;e[34]!==p||e[35]!==_||e[36]!==g||e[37]!==i?(x=n.jsx(Wm,{contentReferences:_,fileRef:p,index:i,trackContentReferenceEvent:g}),e[34]=p,e[35]=_,e[36]=g,e[37]=i,e[38]=x):x=e[38],T=x}else{let x;e[39]!==p||e[40]!==g||e[41]!==i?(x=n.jsx(mr,{fileRef:p,index:i,trackContentReferenceEvent:g}),e[39]=p,e[40]=g,e[41]=i,e[42]=x):x=e[42],T=x}break e}case"grouped_webpages_model_predicted_fallback":{let x;e[43]!==p||e[44]!==l.message.id||e[45]!==g||e[46]!==i||e[47]!==r?(x=n.jsx(hi,{webpageRef:p,node:r,trackContentReferenceEvent:g,messageId:l.message.id,index:i}),e[43]=p,e[44]=l.message.id,e[45]=g,e[46]=i,e[47]=r,e[48]=x):x=e[48],T=x;break e}case"grouped_webpages":{let x;e[49]!==p||e[50]!==l.message.id||e[51]!==g||e[52]!==i||e[53]!==r?(x=n.jsx(fi,{webpageRef:p,node:r,trackContentReferenceEvent:g,messageId:l.message.id,index:i}),e[49]=p,e[50]=l.message.id,e[51]=g,e[52]=i,e[53]=r,e[54]=x):x=e[54],T=x;break e}case"tldr":break e;case"navigation":{let x;e[55]!==p||e[56]!==g||e[57]!==N?(x=n.jsx(gi,{navigation:p,onShowSearchResults:N,trackContentReferenceEvent:g}),e[55]=p,e[56]=g,e[57]=N,e[58]=x):x=e[58],T=x;break e}case"stock":{let x;e[59]!==p||e[60]!==g?(x=n.jsx(of,{contentReference:p,trackContentReferenceEvent:g}),e[59]=p,e[60]=g,e[61]=x):x=e[61],T=x;break e}case"calculator":{let x;e[62]!==p||e[63]!==g?(x=n.jsx(Mm,{data:p,trackContentReferenceEvent:g}),e[62]=p,e[63]=g,e[64]=x):x=e[64],T=x;break e}case"python":case"container":{let x;e[65]!==h.turnIndex||e[66]!==p||e[67]!==l.clientThreadId?(x=n.jsx(Am,{clientThreadId:l.clientThreadId,turnIndex:h.turnIndex,contentReference:p}),e[65]=h.turnIndex,e[66]=p,e[67]=l.clientThreadId,e[68]=x):x=e[68],T=x;break e}case"code_execution":{let x;e[69]!==a||e[70]!==p||e[71]!==g?(x=n.jsx($m,{FormattedText:a,displayInfo:p,trackContentReferenceEvent:g}),e[69]=a,e[70]=p,e[71]=g,e[72]=x):x=e[72],T=x;break e}case"forecast":{let x;e[73]!==h||e[74]!==p.date_range||e[75]!==p.forecast||e[76]!==g?(x=(p==null?void 0:p.forecast)&&n.jsx(Qw,{weatherResults:p.forecast,dateRange:p.date_range,turnIndex:h.turnIndex,trackContentReferenceEvent:g}),e[73]=h,e[74]=p.date_range,e[75]=p.forecast,e[76]=g,e[77]=x):x=e[77],T=x;break e}case"businesses_map":{let x;e[78]!==p||e[79]!==g?(x=n.jsx(u_,{contentReference:p,trackContentReferenceEvent:g}),e[78]=p,e[79]=g,e[80]=x):x=e[80],T=x;break e}case"map":{let x;e[81]!==p||e[82]!==l.clientThreadId||e[83]!==l.message.id||e[84]!==g?(x=n.jsx(im,{contentReference:p,trackContentReferenceEvent:g,clientThreadId:l.clientThreadId,messageId:l.message.id}),e[81]=p,e[82]=l.clientThreadId,e[83]=l.message.id,e[84]=g,e[85]=x):x=e[85],T=x;break e}case"video":{let x;e[86]!==p||e[87]!==g?(x=n.jsx(Af,{video:p,trackContentReferenceEvent:g}),e[86]=p,e[87]=g,e[88]=x):x=e[88],T=x;break e}case"sports_standings":{let x;e[89]!==p||e[90]!==g?(x=n.jsx(_f,{standingsRef:p,trackContentReferenceEvent:g}),e[89]=p,e[90]=g,e[91]=x):x=e[91],T=x;break e}case"sports_schedule":{let x;e[92]!==p||e[93]!==g?(x=n.jsx(bf,{scheduleRef:p,trackContentReferenceEvent:g}),e[92]=p,e[93]=g,e[94]=x):x=e[94],T=x;break e}case"attribution":{let x;e[95]!==p||e[96]!==o?(x=n.jsx(jm,{attribution:p,wordFadeType:o}),e[95]=p,e[96]=o,e[97]=x):x=e[97],T=x;break e}case"debug":{let x;e[98]!==p?(x=Object.entries(p).map(f_),e[98]=p,e[99]=x):x=e[99];let R;e[100]!==x?(R=n.jsx(n.Fragment,{children:x}),e[100]=x,e[101]=R):R=e[101],T=R;break e}case"image_inline":{let x;e[102]!==p||e[103]!==l.clientThreadId||e[104]!==g||e[105]!==w?(x=($=w.metadata)!=null&&$.b1de6e2_rm?n.jsx(Yd,{reference:p,clientThreadId:l.clientThreadId,trackContentReferenceEvent:g,message:w}):n.jsx(Zd,{reference:p,clientThreadId:l.clientThreadId,trackContentReferenceEvent:g,message:w}),e[102]=p,e[103]=l.clientThreadId,e[104]=g,e[105]=w,e[106]=x):x=e[106],T=x;break e}case"image_group":{let x;e[107]!==h||e[108]!==p||e[109]!==g?(x=n.jsx(Nd,{contentReference:p,trackContentReferenceEvent:g,analyticsMetadata:h}),e[107]=h,e[108]=p,e[109]=g,e[110]=x):x=e[110],T=x;break e}case"product_entity":{if(K(c,"1225428216")){let R;e[111]!==p?(R=O(A({},p),{type:"entity",name:p.product.title,category:"product"}),e[111]=p,e[112]=R):R=e[112];let F;e[113]!==h.turnIndex||e[114]!==l.clientThreadId||e[115]!==l.message.id||e[116]!==g||e[117]!==i||e[118]!==R?(F=n.jsx(ca,{contentReference:R,clientThreadId:l.clientThreadId,messageId:l.message.id,turnIndex:h.turnIndex,trackContentReferenceEvent:g,contentReferenceIndex:i}),e[113]=h.turnIndex,e[114]=l.clientThreadId,e[115]=l.message.id,e[116]=g,e[117]=i,e[118]=R,e[119]=F):F=e[119],T=F}else{let R;e[120]!==h.turnIndex||e[121]!==p||e[122]!==l.clientThreadId||e[123]!==l.message.id||e[124]!==g?(R=n.jsx(hm,{contentReference:p,clientThreadId:l.clientThreadId,messageId:l.message.id,turnIndex:h.turnIndex,trackContentReferenceEvent:g}),e[120]=h.turnIndex,e[121]=p,e[122]=l.clientThreadId,e[123]=l.message.id,e[124]=g,e[125]=R):R=e[125],T=R}break e}case"entity_metadata":{let x;e[126]!==p||e[127]!==l.clientThreadId||e[128]!==l.message.id||e[129]!==g?(x=n.jsx(Fm,{contentReference:p,clientThreadId:l.clientThreadId,messageId:l.message.id,trackContentReferenceEvent:g}),e[126]=p,e[127]=l.clientThreadId,e[128]=l.message.id,e[129]=g,e[130]=x):x=e[130],T=x;break e}case"checkout_confirmation":{let x;e[131]!==p||e[132]!==g?(x=n.jsx(_m,{metadata:p,trackContentReferenceEvent:g}),e[131]=p,e[132]=g,e[133]=x):x=e[133],T=x;break e}case"entity":{let x;e[134]!==h.turnIndex||e[135]!==p||e[136]!==l.clientThreadId||e[137]!==l.message.id||e[138]!==g||e[139]!==i?(x=n.jsx(ca,{contentReference:p,clientThreadId:l.clientThreadId,messageId:l.message.id,turnIndex:h.turnIndex,trackContentReferenceEvent:g,contentReferenceIndex:i}),e[134]=h.turnIndex,e[135]=p,e[136]=l.clientThreadId,e[137]=l.message.id,e[138]=g,e[139]=i,e[140]=x):x=e[140],T=x;break e}case"products":{let x;e[141]!==h||e[142]!==p||e[143]!==l.clientThreadId||e[144]!==l.message.id?(x=n.jsx(gm,{contentReference:p,clientThreadId:l.clientThreadId,messageId:l.message.id,turnIndex:h.turnIndex,analyticsMetadata:h}),e[141]=h,e[142]=p,e[143]=l.clientThreadId,e[144]=l.message.id,e[145]=x):x=e[145],T=x;break e}case"product_reviews":{let x;e[146]!==p||e[147]!==g?(x=n.jsx(xi,{contentReference:p,disableAnimation:!0,trackContentReferenceEvent:g}),e[146]=p,e[147]=g,e[148]=x):x=e[148],T=x;break e}case"product_rationale":{let x;e[149]!==p||e[150]!==g?(x=n.jsx(pi,{contentReference:p,trackContentReferenceEvent:g,disableAnimation:!0}),e[149]=p,e[150]=g,e[151]=x):x=e[151],T=x;break e}case"sources_footnote":return null}"dil"in p&&p.dil&&K(c,"846037718");let L;e[154]!==E||e[155]!==p||e[156]!==g?(L=x=>(j.current||(g("Search Content Reference Failed","search_content_reference_failed",p.type),rt.addError("Error rendering content reference: ".concat(p.type),O(A({},x),{contentReference:p})),j.current=!0),p!=null&&p.alt?E:n.jsx("span",{className:"errored-object-".concat(p.type)})),e[154]=E,e[155]=p,e[156]=g,e[157]=L):L=e[157];let I;return e[158]!==T||e[159]!==L?(I=n.jsx(Ha,{name:"content-reference-renderer",fallback:L,children:T}),e[158]=T,e[159]=L,e[160]=I):I=e[160],I}function f_(t){const[e,s]=t;return n.jsx("sub",{className:"ms-1 w-fit rounded-md border-2 border-solid border-orange-500 px-1 leading-none",children:s},e)}function h_(t){const{src:e,alt:s}=t;return n.jsx("img",{src:e,alt:s,className:"max-h-28"})}function p_(t){return t.role===yl.Assistant}var fa;const x_=new RegExp(String.raw(fa||(fa=ot(["]((?!<)(","[^)\r\n]+?))"],["\\]\\((?!<)(","[^)\\r\\n]+?)\\)"])),xs),"g"),g_=/\s/;function b_(t){return t.replace(x_,(e,s)=>g_.test(s)?"](".concat("<".concat(s,">"),")"):e)}const y_=({onClick:t})=>{const[e,s]=f.useState(!1),a=bi(),r=W(),o=c=>{t(c),s(!0),setTimeout(()=>{a()&&s(!1)},2e3)},i=e?ka:Sa,l=r.formatMessage({id:"uG/ayY",defaultMessage:"Copy table"});return n.jsx(Le,{label:l,side:"bottom",align:"center",alignOffset:0,children:n.jsx("button",{"aria-label":l,onClick:o,className:"hover:bg-token-bg-tertiary text-token-text-secondary my-1 rounded-sm p-1 transition-opacity group-[:not(:hover):not(:focus-within)]:pointer-events-none group-[:not(:hover):not(:focus-within)]:opacity-0",children:n.jsx(i,{className:"icon"})})})},v_=r=>{var o=r,{onClickCopy:t,children:e,unstyledContainer:s}=o,a=ue(o,["onClickCopy","children","unstyledContainer"]);const i=J(),l=f.useRef(null),c=f.useRef(null),u=vl(i)&&za(i);return wl(()=>{var m;yi({axis:"height",target:(m=l.current)==null?void 0:m.firstElementChild,onChange:({height:b})=>{c.current&&(c.current.style.height="".concat(b,"px"))}})},[]),n.jsx("div",{className:P(s?void 0:u?"-mx-6":dn.tableContainer),children:n.jsxs("div",{tabIndex:-1,className:P("group",u?"flex w-full max-w-full overflow-x-auto overscroll-x-contain px-6":P(s?void 0:dn.tableWrapper,"flex w-fit flex-col-reverse")),children:[n.jsx("table",O(A({},a),{className:P(u?"w-full":"w-fit min-w-(--thread-content-width)"),ref:l,children:e})),n.jsx("div",{className:P("sticky h-0 select-none",u?"end-0 self-start":P(s?"end-0 self-end":"end-(--thread-content-margin) self-end")),children:n.jsx("div",{className:"absolute end-0 flex items-end",ref:c,children:n.jsx(y_,{onClick:t})})})]})})},w_=a=>{var r=a,{node:t,children:e}=r,s=ue(r,["node","children"]);return n.jsx("td",O(A({},s),{children:f.Children.map(e,(o,i)=>o==="<br>"?n.jsx("br",{},i):o)}))};function __(t){const l=t,{src:e,clientThreadId:s}=l,a=ue(l,["src","clientThreadId"]),r=yt(s),o=f.useContext(Ce),i=Ci(r,e,o==null?void 0:o.useSafeUrls);return i==null?n.jsx("div",{}):n.jsx("img",O(A({},a),{src:i}))}function j_(t){return n.jsx(m_,O(A({},t),{FormattedText:_r}))}function _r({size:t="medium",children:e,className:s,clientThreadId:a,messageId:r,isActivelyStreaming:o=!1,componentOverrides:i,isDeepResearchResultMessage:l,forceDarkMode:c,disableWordFade:d}){const u=jt()||c,{wordFadeType:m}=vi(),b=wi(),y=f.useMemo(()=>A(A(O(A({[kl]:h=>{var S;const w=nd(h.variant);return n.jsx(pd,{clientThreadId:a,messageId:r,title:h.title,originalContent:h.content,variant:w,recipient:h.recipient,isStreaming:o,index:h.index,id:(S=h.id)!=null?S:String(h.index),children:h.children})},pre:({children:h,"data-start":w,"data-end":S,"data-is-last-node":p})=>n.jsx("pre",{className:"overflow-visible!","data-start":w,"data-end":S,"data-is-last-node":p,children:h}),code:h=>n.jsx(Si,O(A({},h),{clientThreadId:a})),[jl]:h=>n.jsx(j_,A({wordFadeType:m},h)),[ki]:h=>a==null?null:n.jsx(Wc,O(A({},h),{clientThreadId:a,messageId:r})),[ji]:_i,[Dl]:Hc,[Rl]:ed,[Il]:Jc,[Ll]:Vc,a:h=>{var E,T,L,I;const M=h,{node:w,children:S}=M,p=ue(M,["node","children"]),C=(E=w==null?void 0:w.properties)==null?void 0:E.href;if(typeof C=="string"&&C.startsWith(xs))return a!=null&&r!=null?n.jsx(Dr,O(A({},p),{clientThreadId:a,messageId:r,href:C,children:S})):null;if(typeof C=="string"&&C===Fr){const $=(T=w==null?void 0:w.children)==null?void 0:T.map(x=>typeof x.value=="string"?x.value:"").join("").trim();return n.jsx(Or,O(A({},h),{text:$,clientThreadId:a,messageId:r,className:"cursor-pointer"}))}if(typeof C=="string"&&C===zr){const $=(L=w==null?void 0:w.children)==null?void 0:L.map(x=>typeof x.value=="string"?x.value:"").join("").trim();return n.jsx(Br,O(A({},h),{text:$,clientThreadId:a,messageId:r}))}if(typeof C=="string"&&C===Wr){const $=(I=w==null?void 0:w.children)==null?void 0:I.map(x=>typeof x.value=="string"?x.value:"").join("").trim();return n.jsx(Hr,O(A({},h),{text:$,clientThreadId:a,messageId:r}))}return C&&typeof C=="string"&&xd(C)?S:n.jsx(hc,O(A({},h),{clientThreadId:a,messageId:r}))},table:S=>{var p=S,{node:h}=p,w=ue(p,["node"]);return n.jsx(v_,O(A({},w),{onClickCopy:C=>{var E;$e.logEvent("ChatGPT Table Copy Clicked");const M=a!=null&&r!=null?Je.getNode(_l(a),r).message:void 0;Ns(ga(h.markdownSource,(E=M==null?void 0:M.metadata)==null?void 0:E.content_references),void 0,C)}}))},td:w_},b?{h1:S=>{var p=S,{node:h}=p,w=ue(p,["node"]);return n.jsx("h1",A({"data-section-id":$t(h.markdownSource)},w))},h2:S=>{var p=S,{node:h}=p,w=ue(p,["node"]);return n.jsx("h2",A({"data-section-id":$t(h.markdownSource)},w))},h3:S=>{var p=S,{node:h}=p,w=ue(p,["node"]);return n.jsx("h3",A({"data-section-id":$t(h.markdownSource)},w))},li:S=>{var p=S,{node:h}=p,w=ue(p,["node"]);return n.jsx("li",A({"data-section-id":$t(h.markdownSource)},w))}}:{}),{img:S=>{var p=S,{node:h}=p,w=ue(p,["node"]);var M;const C=(M=h==null?void 0:h.properties)==null?void 0:M.src;return typeof C=="string"&&(C.startsWith(xs)||C.startsWith("attachment:"))?null:n.jsx(__,O(A({},w),{clientThreadId:a}))}}),m==="delay"?pc:[]),i),[b,m,i,a,r,o]),v=J(),g=K(v,"1839283687"),j=f.useMemo(()=>{const h=e!=null?e:"",w=o&&e?xc(e):h;return b_(w)},[e,o]),_=$a(),N=f.useMemo(()=>[...va,[Ur,j]],[j]),k=f.useMemo(()=>m==="indexed"&&!d?{handlers:{text:(h,w,S)=>{const p=[];for(const C of _(w.value))p.push({type:"element",tagName:"span",properties:{className:Pa.fadeIn},children:[{type:"text",value:C}]});return p}}}:void 0,[m,_,d]);return g?!1:n.jsx(Ha,{name:"formatted_text_error",fallback:()=>n.jsx(n.Fragment,{children:j}),children:n.jsx(jr,{rehypePlugins:N,remarkPlugins:ya,remarkRehypeOptions:k,className:P(s,"markdown prose dark:prose-invert w-full break-words",u?"dark":"light",t==="small"&&"prose-xs",l&&"deep-research-result","markdown-new-styling"),urlTransform:ba,components:y,children:j})})}const jr=f.memo(Rs),r2=Object.freeze(Object.defineProperty({__proto__:null,FormattedText:_r,ReactMarkdownMemo:jr},Symbol.toStringTag,{value:"Module"}));export{r2 as F,tm as M,zt as W,nm as a,sm as b,Nu as c,ku as f,rr as p,Te as r,Su as t};
//# sourceMappingURL=nfea17qzp13xugdb.js.map
