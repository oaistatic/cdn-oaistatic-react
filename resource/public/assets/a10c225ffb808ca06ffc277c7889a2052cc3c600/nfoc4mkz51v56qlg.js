import{b as E,r as u,j as e,M as n,d as R,ah as Y,u as ee,g as z,x as se}from"./jj85rqzpbnvv3emr.js";import{f as F,C as I,B as C,i as D,r as W,ai as $,R as V,qa as X,E as Q,ax as te,aE as ae,j as re,e as oe}from"./lef5ym39glv4981l.js";import{d9 as ne,bj as de,gH as ie,lS as U,c7 as le,a3 as Z,lR as K,jU as ce,c3 as ue}from"./mclphevd122040jw.js";import{a as me,c as ge}from"./fya3qb1e1s8z4llj.js";import{T as t}from"./i5991cad8s41d2db.js";import{f as J,i as H,u as pe,R as xe}from"./gvj8b99px3hzuu19.js";import{G as fe}from"./j8iq8tz9iwf8tfnb.js";import{e as he,f as je,M as L}from"./cxka3f16uwxr0o9b.js";function Me({defaultName:s,placeholder:a,onSave:o,onClose:r}){const l=E(),j=s==null,[p,f]=u.useState(s||""),[h,y]=u.useState(!1),[S,x]=u.useState(null),m=F(),g=async()=>{if(p.trim()===""){x(l.formatMessage({id:"workspaceSettings.groups.emptyName",defaultMessage:"Group name cannot be empty"}));return}y(!0);try{await o(p),m.success(j?l.formatMessage({id:"workspaceSettings.groups.createdGroup",defaultMessage:"Group created successfully"}):l.formatMessage({id:"workspaceSettings.groups.nameChanged",defaultMessage:"Group name changed successfully"})),r()}catch(M){x(l.formatMessage({id:"workspaceSettings.groups.duplicateName",defaultMessage:"Group with this name already exists"}))}finally{y(!1)}};return e.jsx(I,{isOpen:!0,type:"success",onClose:r,title:j?l.formatMessage(O.newGroupTitle):l.formatMessage(O.updateNameTitle),testId:"modal-change-group-name",showCloseButton:!0,primaryButton:e.jsx(C,{color:"primary",onClick:()=>g(),loading:h,children:e.jsx(n,{id:"workspaceSettings.groups.save",defaultMessage:"Save"})}),secondaryButton:e.jsx(C,{onClick:r,color:"secondary",children:e.jsx(n,{id:"workspaceSettings.groups.cancel",defaultMessage:"Cancel"})}),children:e.jsxs("div",{className:"mb-3 flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:e.jsx(n,{id:"workspaceSettings.groups.groupNameLabel",defaultMessage:"Group Name"})}),e.jsx("input",{autoFocus:!0,type:"text",value:p,placeholder:a,onChange:M=>{f(M.target.value),x(null)},className:"border-token-border-secondary focus:border-token-accent bg-token-bg-primary w-full rounded border px-3 py-2 text-sm focus:outline-none",onKeyDown:M=>{M.key==="Enter"&&g()}}),S&&e.jsx("p",{className:"text-xs text-red-500",children:S})]})})}const O=R({newGroupTitle:{id:"workspaceSettings.groups.newGroup",defaultMessage:"New group"},updateNameTitle:{id:"workspaceSettings.groups.updateNameTitle",defaultMessage:"Update group name"}}),we=R({bulkAddMembersError:{id:"workspaceSettings.groups.bulkAddMembers.error",defaultMessage:"Unable to add some members to the group."}}),B=1e3;function Se({group:s,isOpen:a,onClose:o}){const r=E(),l=F(),j=r.formatMessage({id:"workspaceSettings.groups.addMember",defaultMessage:"Add members to the {groupName} group"},{groupName:s.name}),p=D(),f=W(p),[h,y]=u.useState([]),[S,x]=u.useState(!1);async function m(){var N;const g=f==null?void 0:f.getWorkspaceId();if(!g)throw new Error("No workspace ID found");x(!0);const M=[],b=50;for(let c=0;c<h.length;c+=b)M.push(h.slice(c,c+b));const A=async c=>V.safePost("/accounts/{account_id}/group/{group_id}/users",{parameters:{path:{account_id:g,group_id:s.id}},requestBody:{email_addresses:c}});try{const G=(await Promise.all(M.map(w=>A(w)))).reduce((w,d)=>w+d.added_group_users.length,0);l.success(r.formatMessage({id:"yU4Zf0",defaultMessage:"Added {numUsers} users to the group"},{numUsers:G})),o==null||o()}catch(c){const G=(N=J(r,c,{targetIsRestrictedSafeModeGroup:H(s)}))!=null?N:r.formatMessage(we.bulkAddMembersError);l.danger(G,{duration:3})}finally{x(!1)}}return e.jsxs(I,{testId:"modal-bulk-add-group-members",isOpen:a,onClose:o!=null?o:$,title:j,type:"success",showCloseButton:!0,primaryButton:e.jsx(C,{onClick:m,disabled:h.length===0||h.length>B,loading:S,children:e.jsx(n,{id:"EpbOzA",defaultMessage:"Add users to group"})}),children:[e.jsx(ye,{onChange:y}),h.length>B&&e.jsx("div",{className:"text-token-text-error mt-2 text-sm",children:e.jsx(n,{id:"9lp0Tc",defaultMessage:"Email list is limited to {maxEmails} users at once",values:{maxEmails:B}})})]})}function ye({onChange:s}){const[a,o]=u.useState("");return e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsxs("label",{htmlFor:"group-email-paste",children:[e.jsx(n,{id:"qvGcSC",defaultMessage:"Emails"}),e.jsx("br",{}),e.jsx("span",{className:"text-token-text-tertiary text-sm",children:e.jsx(n,{id:"Fhd+5h",defaultMessage:"Paste email addresses here, one per line:"})})]}),e.jsx(ne,{id:"group-email-paste",className:"h-[250px] text-sm",value:a,onChange:r=>{o(r.target.value),s(be(r.target.value))},placeholder:"jean@example.com\njoohyun@example.com\nmuhammed@example.com\nsusan@example.com"})]})}function be(s){return s.split("\n").map(a=>a.trim()).filter(a=>a.length>0).filter(a=>de.test(a))}function ke({group:s,isOpen:a,onClose:o}){var _;const r=E(),l=F(),j=r.formatMessage({id:"workspaceSettings.addGroupsMembersModal.title",defaultMessage:"Add members to the {groupName} group"},{groupName:s.name}),p=D(),f=W(p),h=f==null?void 0:f.getWorkspaceId(),[y,S]=u.useState(""),[x,m]=u.useState(0),{data:g,isLoading:M}=ie(h,x*U,y,U,Y),[b,A]=u.useState([]),[N,c]=u.useState([]),[G,w]=u.useState("interactive"),d=g?Math.ceil(((_=g.total)!=null?_:0)/U):0;async function v(i){var T;c(k=>[...k,i]);try{await Ne(h,s.id,i),A(k=>[...k,i])}catch(k){te.addError(k);const P=(T=J(r,k,{targetIsRestrictedSafeModeGroup:H(s)}))!=null?T:r.formatMessage(Ge.addMemberError);l.danger(P,{duration:3})}finally{c(k=>k.filter(P=>P!==i))}}return G==="batch"?e.jsx(Se,{group:s,isOpen:a,onClose:o}):e.jsx(I,{testId:"modal-add-group-member",type:"warning",isOpen:a,onClose:o!=null?o:$,title:j,size:"custom",className:"max-w-(--breakpoint-md)",showCloseButton:!0,primaryButton:e.jsx(C,{onClick:o,children:e.jsx(n,{id:"0NAzDq",defaultMessage:"Done"})}),children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex flex-row justify-between",children:[e.jsx("p",{children:j}),e.jsx(C,{onClick:()=>{w("batch")},color:"secondary",children:e.jsx(n,{id:"5GPldp",defaultMessage:"Bulk add users"})})]}),e.jsx(X,{value:y,inputClassName:"w-full",onChange:i=>{S(i.target.value)}}),e.jsxs(t.Root,{className:"min-w-full",children:[e.jsxs(t.Header,{children:[e.jsx(t.HeaderCell,{children:e.jsx(n,{id:"workspaceSettings.groups.addMember.name",defaultMessage:"Name"})}),e.jsx(t.HeaderCell,{children:e.jsx(n,{id:"workspaceSettings.groups.addMember.email",defaultMessage:"Email"})}),e.jsx(t.HeaderCell,{})]}),e.jsxs(t.Body,{children:[!g&&M&&e.jsx(t.Row,{children:e.jsx(t.Cell,{colSpan:3,children:e.jsx(Q,{})})}),g==null?void 0:g.items.map(i=>e.jsxs(t.Row,{children:[e.jsx(t.Cell,{children:i.name}),e.jsx(t.Cell,{children:i.email}),e.jsx(t.Cell,{textAlign:"right",className:"pe-1",children:e.jsx(C,{size:"small",color:"secondary",disabled:N.includes(i.id),onClick:()=>{b.includes(i.id)||v(i.id)},icon:b.includes(i.id)?le:Z,children:b.includes(i.id)?e.jsx(n,{id:"workspaceSettings.groups.addMember.addButton",defaultMessage:"Added"}):e.jsx(n,{id:"workspaceSettings.groups.addMember.addedButton",defaultMessage:"Add"})})})]},i.id))]})]}),e.jsx("div",{className:"flex flex-row justify-center",children:e.jsx(K,{currentPage:x,onChangeIndex:i=>{m(i)},length:d})})]})})}async function Ne(s,a,o){await V.safePatch("/accounts/{account_id}/group/{group_id}",{parameters:{path:{account_id:s,group_id:a}},requestBody:{user_id:o}})}const Ge=R({addMemberError:{id:"EnX2ZH",defaultMessage:"Unable to add member to the group."}});function Ce({workspaceId:s}){const a=E(),o=ee(),r=ae(),l=!(r!=null&&r.isAdminOfAccount()||r!=null&&r.isOwnerOfAccount()),j=D(),[p,f]=u.useState(""),h=ue(p,300),y=z(),[S,x]=u.useState(0),{groups:m,isLoading:g,isPlaceholderData:M}=he({workspaceId:s,currPage:S,groupFilter:h}),[b,A]=u.useState(!1),{data:N}=pe(s,re(j,"3020999601")),c=d=>{d&&(x(0),f("")),A(d)},{createGroup:G}=je({workspaceId:s,currentGroups:m});let w=m?[...m.items]:[];if(N&&m){const d=N.group;if(d){const v=w.filter(({id:_})=>_!==d.id);w=S===0?[d].concat(v):w}}return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-6 mb-3 flex flex-row justify-between gap-2",children:[e.jsx(X,{inputClassName:"w-[250px] rounded-full! text-sm",value:p,onChange:d=>{f(d.target.value),x(0)},placeholder:a.formatMessage({id:"workspaceSettings.groups.search",defaultMessage:"Search group name"})}),!l&&e.jsx(C,{onClick:()=>c(!0),icon:Z,children:e.jsx(n,{id:"workspaceSettings.groups.create",defaultMessage:"Create group"})})]}),e.jsxs("div",{children:[e.jsxs(t.Root,{className:"min-w-full",children:[e.jsxs("colgroup",{children:[e.jsx("col",{className:"w-[60%]"}),e.jsx("col",{className:"w-[20%]"}),e.jsx("col",{className:"w-[20%]"}),e.jsx("col",{className:"w-16"})]}),e.jsxs(t.Header,{children:[e.jsx(t.HeaderCell,{children:e.jsx(n,{id:"workspaceSettings.groups.groupName",defaultMessage:"Group name"})}),e.jsx(t.HeaderCell,{children:e.jsx(n,{id:"workspaceSettings.groups.members",defaultMessage:"Members"})}),e.jsx(t.HeaderCell,{children:e.jsx(n,{id:"workspaceSettings.groups.created",defaultMessage:"Created"})}),e.jsx(t.HeaderCell,{})]}),e.jsx(t.Body,{className:oe((g||M)&&"opacity-50"),children:m==null?e.jsx(t.Row,{children:e.jsx(t.Cell,{colSpan:5,textAlign:"center",children:e.jsx(Q,{})})}):w.length===0?e.jsx(t.Row,{children:e.jsx(t.Cell,{colSpan:5,textAlign:"center",children:p===""?e.jsx(n,{id:"workspaceSettings.groups.noGroups",defaultMessage:"No groups found."}):e.jsx(n,{id:"workspaceSettings.groups.noGroupsWithFIlter",defaultMessage:"No groups found. Try changing the search query."})})}):w.map(d=>e.jsx(Ae,{group:d,workspaceId:s,onAddMember:()=>{o.invalidateQueries({queryKey:[s,"groups"]})},readOnly:l},d.id))})]}),m&&e.jsx("div",{className:"text-center",children:e.jsx(K,{length:Math.ceil(m.total/L),currentPage:Math.min(S,Math.ceil(m.total/L)),onChangeIndex:d=>x(d)})})]}),b&&e.jsx(Me,{onClose:()=>c(!1),onSave:async d=>{const{id:v}=await G({name:d,workspaceId:s});y("/admin/groups/".concat(v))},placeholder:a.formatMessage({id:"workspaceSettings.groups.placeholder",defaultMessage:"E.g. marketing team"})})]})}function Ie({currentWorkspaceId:s}){const a=E();return e.jsxs(e.Fragment,{children:[e.jsx(ce,{children:e.jsx("title",{children:a.formatMessage(q.title)})}),e.jsx(me,{title:a.formatMessage(q.title),subtitle:e.jsx(n,{id:"NDDzzF",defaultMessage:"Only workspace admins can edit these settings."})}),e.jsx(ge,{showSpinner:!1,children:e.jsx(Ce,{workspaceId:s})})]})}function Ae({group:s,onAddMember:a,readOnly:o}){const[r,l]=u.useState(!1),j=z(),p=H(s);return e.jsxs(e.Fragment,{children:[e.jsxs(t.Row,{className:"[&>td]:py-2",onClick:()=>j("/admin/groups/".concat(s.id)),children:[e.jsxs(t.Cell,{children:[e.jsx(fe,{group:s}),e.jsx("div",{className:"flex flex-col gap-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s.name}),p&&e.jsx(xe,{})]})})]}),e.jsx(t.Cell,{children:e.jsx(n,{id:"workspaceSettings.groups.memberCount",defaultMessage:"{count} members",values:{count:s.num_members}})}),e.jsx(t.Cell,{children:s.created_time&&e.jsx(se,{value:s.created_time,year:"numeric",month:"short",day:"numeric"})})]}),r&&!o&&!s.is_scim_managed&&e.jsx(ke,{isOpen:!0,onClose:()=>{a(s.id),l(!1)},group:s})]})}const q=R({title:{id:"admin.groupsSettings.title",defaultMessage:"Groups"}});export{ke as A,Me as U,Ie as W,q as m};
//# sourceMappingURL=nfoc4mkz51v56qlg.js.map
