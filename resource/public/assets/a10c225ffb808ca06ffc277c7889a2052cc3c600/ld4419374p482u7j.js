const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/n5kvjsboidouv1r0.js","assets/jj85rqzpbnvv3emr.js","assets/mclphevd122040jw.js","assets/lef5ym39glv4981l.js","assets/root-ogjlcpyy.css","assets/conversation-small-g7l5datj.css","assets/bcqyuj3uj1pnpyhi.js","assets/fteqd6f5240seduu.js","assets/nuz80uov2gm1dlm5.js","assets/w705jdvl4grquz0l.js","assets/hhs3uwxj7uii5eg7.js","assets/hrd3zywe5ql748qg.js","assets/n9bxuhi2abjjjs86.js","assets/iiok29s29bpdre61.js"])))=>i.map(i=>d[i]);
var Ne=Object.defineProperty,Ge=Object.defineProperties;var Le=Object.getOwnPropertyDescriptors;var cA=Object.getOwnPropertySymbols;var WA=Object.prototype.hasOwnProperty,qA=Object.prototype.propertyIsEnumerable;var PA=(A,e,t)=>e in A?Ne(A,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):A[e]=t,B=(A,e)=>{for(var t in e||(e={}))WA.call(e,t)&&PA(A,t,e[t]);if(cA)for(var t of cA(e))qA.call(e,t)&&PA(A,t,e[t]);return A},$=(A,e)=>Ge(A,Le(e));var lA=(A,e)=>{var t={};for(var o in A)WA.call(A,o)&&e.indexOf(o)<0&&(t[o]=A[o]);if(A!=null&&cA)for(var o of cA(A))e.indexOf(o)<0&&qA.call(A,o)&&(t[o]=A[o]);return t};import{iZ as J,lL as me,lM as RA,fW as jA,sX as Je,dA as Xe,P as UA,i as ge,y as Pe,jI as We,ae as qe,dL as Ue,dK as Ke,fv as fe,sY as He,H as KA,bI as fA,bJ as yA,gk as ze,bw as $e,C as At,e as hA,T as he,E as DA,aI as et,B as tt,l_ as HA,lQ as ot,O as nt,_ as st,j as it,ey as pe,sZ as at,ex as rt}from"./lef5ym39glv4981l.js";import{r as s,h as ct,i as lt,g as Ce,b as X,j as c,m as F,A as sA}from"./jj85rqzpbnvv3emr.js";import{m0 as pA,v8 as BA,v9 as IA,va as zA,vb as Ee,vc as dt,vd as $A,ve as Ae,vf as ee,vg as ut,vh as mt,vi as gt,vj as ft,vk as ht,vl as pt,vm as ke,vn as Ct,vo as O,vp as Et,m3 as y,bC as kt,dp as vt,mY as St,vq as OA,m4 as bt,vr as Bt,m1 as It,vs as CA,vt as EA,vu as Mt,vv as L,dt as wt}from"./mclphevd122040jw.js";import{a as Tt,$ as xt,C as yt,_ as Z,R as Qt,b as W,y as Vt,M as Rt,c as D,W as jt,T as dA,O as ve,N as Dt,I as Ot,d as _t,e as Zt,f as Yt,Y as Ft,F as Nt,S as uA,h as _A,u as Se,g as QA,i as Gt,s as Lt,j as be,k as Jt,l as kA,A as ZA,m as AA,n as Xt,o as Pt,B as Be,p as Wt,q as qt,r as Ut,G as Kt,t as Ht,v as zt,w as $t,x as Ao,z as te,D as eo,E as to,V as oo,H as no,L as so,J as io,K as ao,P as ro,Q as co}from"./fteqd6f5240seduu.js";import{S as lo}from"./hrd3zywe5ql748qg.js";import{S as uo,a as mo,b as go,c as fo}from"./n9bxuhi2abjjjs86.js";import{L as ho}from"./iiok29s29bpdre61.js";function po(){const A=pA(),e=Tt(),t=s.useCallback(()=>{BA.debug("disconnected from room"),IA(A)},[A]),o=s.useCallback(r=>{e.danger("Something went wrong",{toastId:"livekit_room_error"}),BA.error("an error occurred within the room",r);const a=zA(A.getState());J.voiceMode.error($(B({},a),{error:r.message})),A.setState(i=>{i.metrics.livekitConnectSuccessTime||(i.metrics.livekitConnectFailTime=new Date)}),IA(A)},[e,A]),n=s.useCallback(r=>{e.danger("Something went wrong",{toastId:"livekit_room_error",loggingTitle:"Encryption error",loggingDescription:r.message}),BA.error("an encryption error occurred within the room",r);const a=zA(A.getState());J.voiceMode.error(B({encryptionError:r.message,eventSource:"voice-session"},a)),A.setState(i=>{i.metrics.livekitConnectSuccessTime||(i.metrics.livekitConnectFailTime=new Date)}),IA(A)},[e,A]);return{onDisconnected:t,onError:o,onEncryptionError:n}}function Ie(A){var e,t,o="";if(typeof A=="string"||typeof A=="number")o+=A;else if(typeof A=="object")if(Array.isArray(A)){var n=A.length;for(e=0;e<n;e++)A[e]&&(t=Ie(A[e]))&&(o&&(o+=" "),o+=t)}else for(t in A)A[t]&&(o&&(o+=" "),o+=t);return o}function Co(){for(var A,e,t=0,o="",n=arguments.length;t<n;t++)(A=arguments[t])&&(e=Ie(A))&&(o&&(o+=" "),o+=e);return o}function Eo(...A){return(...e)=>{for(const t of A)if(typeof t=="function")try{t(...e)}catch(o){console.error(o)}}}function Me(...A){const e=B({},A[0]);for(let t=1;t<A.length;t++){const o=A[t];for(const n in o){const r=e[n],a=o[n];typeof r=="function"&&typeof a=="function"&&n[0]==="o"&&n[1]==="n"&&n.charCodeAt(2)>=65&&n.charCodeAt(2)<=90?e[n]=Eo(r,a):(n==="className"||n==="UNSAFE_className")&&typeof r=="string"&&typeof a=="string"?e[n]=Co(r,a):e[n]=a!==void 0?a:r}}return e}const ko={connect:!0,audio:!1,video:!1};function vo(A){const Q=B(B({},ko),A),{token:e,serverUrl:t,options:o,room:n,connectOptions:r,connect:a,audio:i,video:l,screen:u,onConnected:f,onDisconnected:d,onError:m,onMediaDeviceFailure:h,onEncryptionError:E,simulateParticipants:k}=Q,S=lA(Q,["token","serverUrl","options","room","connectOptions","connect","audio","video","screen","onConnected","onDisconnected","onError","onMediaDeviceFailure","onEncryptionError","simulateParticipants"]);o&&n&&Z.warn("when using a manually created room, the options object will be ignored. set the desired options directly when creating the room instead.");const[g,v]=s.useState();s.useEffect(()=>{v(n!=null?n:new Qt(o))},[n]);const I=s.useMemo(()=>{const{className:b}=Vt();return Me(S,{className:b})},[S]);return s.useEffect(()=>{if(!g)return;const b=()=>{const M=g.localParticipant;Z.debug("trying to publish local tracks"),Promise.all([M.setMicrophoneEnabled(!!i,typeof i!="boolean"?i:void 0),M.setCameraEnabled(!!l,typeof l!="boolean"?l:void 0),M.setScreenShareEnabled(!!u,typeof u!="boolean"?u:void 0)]).catch(T=>{Z.warn(T),m==null||m(T)})},R=M=>{const T=Rt.getFailure(M);h==null||h(T)},C=M=>{E==null||E(M)};return g.on(W.SignalConnected,b).on(W.MediaDevicesError,R).on(W.EncryptionError,C),()=>{g.off(W.SignalConnected,b).off(W.MediaDevicesError,R).off(W.EncryptionError,C)}},[g,i,l,u,m,E,h]),s.useEffect(()=>{if(g){if(k){g.simulateParticipants({participants:{count:k},publish:{audio:!0,useRealTracks:!0}});return}if(!e){Z.debug("no token yet");return}if(!t){Z.warn("no livekit url provided"),m==null||m(Error("no livekit url provided"));return}a?(Z.debug("connecting"),g.connect(t,e,r).catch(b=>{Z.warn(b),m==null||m(b)})):(Z.debug("disconnecting because connect is false"),g.disconnect())}},[a,e,JSON.stringify(r),g,m,t,k]),s.useEffect(()=>{if(!g)return;const b=R=>{switch(R){case D.Disconnected:d&&d();break;case D.Connected:f&&f();break}};return g.on(W.ConnectionStateChanged,b),()=>{g.off(W.ConnectionStateChanged,b)}},[e,f,d,g]),s.useEffect(()=>{if(g)return()=>{Z.info("disconnecting on onmount"),g.disconnect()}},[g]),{room:g,htmlProps:I}}const So=s.forwardRef(function(A,e){const{room:t,htmlProps:o}=vo(A);return s.createElement("div",B({ref:e},o),t&&s.createElement(xt.Provider,{value:t},s.createElement(yt.Provider,{value:A.featureFlags},A.children)))});function bo(A){return A!==void 0}function Bo(...A){return Me(...A.filter(bo))}function Io(A,e={}){var k;const[t,o]=s.useState(Yt(A)),[n,r]=s.useState(t==null?void 0:t.isMuted),[a,i]=s.useState(t==null?void 0:t.isSubscribed),[l,u]=s.useState(t==null?void 0:t.track),[f,d]=s.useState("landscape"),m=s.useRef(),{className:h,trackObserver:E}=s.useMemo(()=>Ft(A),[(k=A.participant.sid)!=null?k:A.participant.identity,A.source,Nt(A)&&A.publication.trackSid]);return s.useEffect(()=>{const S=E.subscribe(g=>{Z.debug("update track",g),o(g),r(g==null?void 0:g.isMuted),i(g==null?void 0:g.isSubscribed),u(g==null?void 0:g.track)});return()=>S==null?void 0:S.unsubscribe()},[E]),s.useEffect(()=>{var S,g;return l&&(m.current&&l.detach(m.current),(S=e.element)!=null&&S.current&&!(ve(A.participant)&&(l==null?void 0:l.kind)==="audio")&&l.attach(e.element.current)),m.current=(g=e.element)==null?void 0:g.current,()=>{m.current&&(l==null||l.detach(m.current))}},[l,e.element]),s.useEffect(()=>{var S,g;if(typeof((S=t==null?void 0:t.dimensions)==null?void 0:S.width)=="number"&&typeof((g=t==null?void 0:t.dimensions)==null?void 0:g.height)=="number"){const v=t.dimensions.width>t.dimensions.height?"landscape":"portrait";d(v)}},[t]),{publication:t,isMuted:n,isSubscribed:a,track:l,elementProps:Bo(e.props,B({className:h,"data-lk-local-participant":A.participant.isLocal,"data-lk-source":t==null?void 0:t.source},(t==null?void 0:t.kind)==="video"&&{"data-lk-orientation":f}))}}var Mo=typeof uA=="object"&&uA&&uA.Object===Object&&uA,wo=typeof self=="object"&&self&&self.Object===Object&&self;Mo||wo||Function("return this")();const To=s.forwardRef(function(a,r){var i=a,{trackRef:A,onSubscriptionStatusChanged:e,volume:t,muted:o}=i,n=lA(i,["trackRef","onSubscriptionStatusChanged","volume","muted"]);const l=Ot(A),u=s.useRef(null);s.useImperativeHandle(r,()=>u.current);const{elementProps:f,isSubscribed:d,track:m,publication:h}=Io(l,{element:u,props:n});return s.useEffect(()=>{e==null||e(!!d)},[d,e]),s.useEffect(()=>{m===void 0||t===void 0||(m instanceof _t?m.setVolume(t):Z.warn("Volume can only be set on remote audio tracks."))},[t,m]),s.useEffect(()=>{h===void 0||o===void 0||(h instanceof Zt?h.setEnabled(!o):Z.warn("Can only call setEnabled on remote track publications."))},[o,h,m]),s.createElement("audio",B({ref:u},f))});function xo({volume:A,muted:e}){const t=jt([dA.Source.Microphone,dA.Source.ScreenShareAudio,dA.Source.Unknown],{updateOnlyOn:[],onlySubscribed:!0}).filter(o=>!ve(o.participant)&&o.publication.kind===dA.Kind.Audio);return s.createElement("div",{style:{display:"none"}},t.map(o=>s.createElement(To,{key:Dt(o),trackRef:o,volume:A,muted:e})))}const oe=A=>A.length>0?ut(A):null,V=A=>{var e;return(e=A==null?void 0:A.toISOString())!=null?e:null};async function yo(A){return await me(async()=>{const{voiceMode:e,metrics:t}=A.getState(),o=mt(),n=await gt(),r=await ft(),a=await ht(),i=await pt();return{session_create_time:V(t.sessionCreateTime),get_status_sent_time:V(t.getStatusSentTime),get_status_success_time:V(t.getStatusSuccessTime),get_status_failed_time:V(t.getStatusFailedTime),proof_of_work_start_time:V(t.proofOfWorkStartTime),proof_of_work_end_time:V(t.proofOfWorkEndTime),get_token_sent_time:V(t.getTokenSentTime),get_token_success_time:V(t.getTokenSuccessTime),get_token_failed_time:V(t.getTokenFailedTime),conversation_start_success_time:V(t.conversationStartSuccessTime),conversation_start_fail_time:V(t.conversationStartFailTime),livekit_connect_time:V(t.livekitConnectTime),livekit_connect_success_time:V(t.livekitConnectSuccessTime),livekit_connect_fail_time:V(t.livekitConnectFailTime),session_connected_time:V(t.sessionConnectedTime),data_channel_open_time:V(t.dataChannelOpenTime),conversation_latency_ms:t.conversationLatency,voice_mode:e,get_token:B({},o),peer_connection:B({},n),pre_connect:B({},r),connect:B({},i),post_connect:B({},a)}})}async function Qo(A,e,t){const o=await Ee();return me(()=>{const{voiceMode:n,metrics:r}=A.getState(),a=RA(),i=dt();return $(B(B(B(B({session_end_time:V(r.sessionEndTime),avg_total_latency_ms:oe(r.totalLatencyMs),avg_rtt_ms:oe(r.currentRttMs),num_of_turns_speaking:r.numSpeaking,num_of_turns_thinking:r.numThinking,num_of_turns_listening:r.numListening,protocol:a,voice_session_id:t,reason:e,conversation_latency_ms:r.conversationLatency},ee().length>0?{status_prefetch_failed_reasons:ee().join(",")}:{}),Ae().length>0?{status_prefetch_ineligible_reasons:Ae().join(",")}:{}),i?{status_cache_skipped_reason:i}:{}),$A().length>0?{status_prefetch_eligible_reasons:$A().join(",")}:{}),{voice_mode:n,microphone_permission_state:o})})}function we({conversationId:A}){const{shouldDelayDisconnect:e,delayDisconnect:t,immediateDisconnect:o}=_A({refetchLater:!0}),{toggleMute:n}=ke(),r=jA(A),a=pA(),i=Je();return s.useCallback(async l=>{J.voiceSessionEndedByUser.click({reason:l}),a.setState(C=>{C.metrics.sessionEndTime=new Date}),Xe.setState({voiceFeedbackThread:r,lastVoiceSessionEndTime:new Date});const u=await Qo(a,l,i),f=await yo(a),{metrics:{sessionCreateTime:d,sessionConnectedTime:m,sessionEndTime:h,numSpeaking:E,numThinking:k,numListening:S},voiceMode:g,server:{connectionState:v}}=a.getState(),I=d==null?void 0:d.getTime(),Q=h==null?void 0:h.getTime(),b=m==null?void 0:m.getTime(),R=I!==void 0&&Q!==void 0?Q-I:void 0;UA.logStructuredEvent(Ct,{voiceMode:g!=null?g:void 0,voiceSessionId:i||void 0,protocol:RA(),sessionStartTsMs:I,sessionEndTsMs:Q,sessionConnectedTsMs:b,sessionDurationMs:R,numOfTurnsSpeaking:E,numOfTurnsThinking:k,numOfTurnsListening:S,sessionEndReason:l,wasConnectedAtTimeOfExit:v===D.Connected}),UA.logEvent("Voice Session End Summary",B(B({},u),f)),e?(a.setState(C=>{C.video=O.Stopping,C.screenshare=O.Stopping}),await n(),t()):(o(),Et())},[t,o,r,e,n,a,i])}var MA,ne;function Vo(){return ne||(ne=1,MA={webm:"data:video/webm;base64,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",mp4:"data:video/mp4;base64,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"}),MA}var wA,se;function Ro(){if(se)return wA;se=1;const{webm:A,mp4:e}=Vo(),t=()=>typeof navigator<"u"&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,o=()=>"wakeLock"in navigator;class n{constructor(){if(this.enabled=!1,o()){this._wakeLock=null;const a=()=>{this._wakeLock!==null&&document.visibilityState==="visible"&&this.enable()};document.addEventListener("visibilitychange",a),document.addEventListener("fullscreenchange",a)}else t()?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("title","No Sleep"),this.noSleepVideo.setAttribute("playsinline",""),this._addSourceToVideo(this.noSleepVideo,"webm",A),this._addSourceToVideo(this.noSleepVideo,"mp4",e),this.noSleepVideo.addEventListener("loadedmetadata",()=>{this.noSleepVideo.duration<=1?this.noSleepVideo.setAttribute("loop",""):this.noSleepVideo.addEventListener("timeupdate",()=>{this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())})}))}_addSourceToVideo(a,i,l){var u=document.createElement("source");u.src=l,u.type="video/".concat(i),a.appendChild(u)}get isEnabled(){return this.enabled}enable(){return o()?navigator.wakeLock.request("screen").then(a=>{this._wakeLock=a,this.enabled=!0,console.log("Wake Lock active."),this._wakeLock.addEventListener("release",()=>{console.log("Wake Lock released.")})}).catch(a=>{throw this.enabled=!1,console.error("".concat(a.name,", ").concat(a.message)),a}):t()?(this.disable(),console.warn("\n        NoSleep enabled for older iOS devices. This can interrupt\n        active or long-running network requests from completing successfully.\n        See https://github.com/richtr/NoSleep.js/issues/15 for more details.\n      "),this.noSleepTimer=window.setInterval(()=>{document.hidden||(window.location.href=window.location.href.split("#")[0],window.setTimeout(window.stop,0))},15e3),this.enabled=!0,Promise.resolve()):this.noSleepVideo.play().then(i=>(this.enabled=!0,i)).catch(i=>{throw this.enabled=!1,i})}disable(){o()?(this._wakeLock&&this._wakeLock.release(),this._wakeLock=null):t()?this.noSleepTimer&&(console.warn("\n          NoSleep now disabled for older iOS devices.\n        "),window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause(),this.enabled=!1}}return wA=n,wA}var jo=Ro();const Do=ct(jo),ie="mode",Oo="voice",_o=()=>{const[A,e]=lt(),t=A.get(ie),o=pA(),n=y(f=>f.isVoiceModeActive),r=ge(),a=!Pe(r),i=We(),l=!a,u=Ce();s.useEffect(()=>{t===Oo&&!n&&(e(f=>(f.delete(ie),f)),i?u("/update-app"):l?o.setState({isVoiceModeActive:!0}):qe(r,{fallbackScreenHint:"login",callbackUrl:window.location.href}))},[r,l,i,t,u,e,n,o])},Te="inline-flex items-center bg-transparent text-token-text-secondary hover:text-token-text-primary",ae=({message:A,onClick:e,type:t})=>{const o=X(),n=Ue()&&Ke;switch(t){case"microphone_denied":return n?c.jsxs("a",{href:"ms-settings:privacy-microphone",className:Te,children:[A,c.jsx(fe,{className:"icon-sm ms-1"})]}):c.jsx(re,{onClick:e,message:A});case"disconnected":return c.jsxs("div",{className:"inline-flex items-center",children:[o.formatMessage(VA.lostConnection),c.jsx("button",{onClick:e,className:"ms-1",children:c.jsx("strong",{children:o.formatMessage(VA.retry)})})]});case"normal":return c.jsx(re,{onClick:e,message:A})}},re=({message:A,onClick:e})=>{const t=X();return c.jsxs("button",{onClick:e,className:Te,"aria-label":t.formatMessage(VA.openInfoModal),children:[A,c.jsx(fe,{className:"icon-sm ms-1"})]})},VA={openInfoModal:{id:"hintMessage.openInfoModal",defaultMessage:"Open info modal",description:"Open info modal about voice mode usage"},retry:{id:"hintMessage.retry",defaultMessage:"Retry",description:"Retry text next to lost connection message"},lostConnection:{id:"hintMessage.lostConnection",defaultMessage:"Lost connection.",description:"Hint message shown when the voice mode network connection is lost."}};function Zo(A){const{button:e,conversationId:t,onClick:o}=A,n=jA(t),{startVoiceMode:r}=Se(),a=Ce(),i=s.useCallback(()=>{switch(e.action){case"new_chat":{kt("/"),r(QA({serverThreadId:void 0,isAdvancedMode:!0,eventSource:"modal_".concat(e.action),parentMessageId:void 0,clientThreadId:ze(),gizmoId:void 0,skipCacheReason:"modal-new-chat-button"}));break}case"switch_to_standard":n&&r(QA({serverThreadId:n,isAdvancedMode:!1,eventSource:"modal_".concat(e.action),parentMessageId:void 0,clientThreadId:n,gizmoId:fA.getGizmoId(yA(t)),skipCacheReason:"modal-switch-to-standard-button"}));break;case"upgrade_to_plus":KA(a,"Voice Mode Upgrade To Plus Modal");break;case"upgrade_to_pro":KA(a,"Voice Mode Upgrade To Pro Modal");break}o==null||o()},[e.action,t,a,o,n,r]);return c.jsx($e.Button,{onClick:i,title:e.title,color:A.color})}const Yo={primary:"primary",secondary:"secondary",tertiary:"ghost"};function Fo({buttons:A,conversationId:e,onClick:t}){let o,n,r;const a=s.useCallback(i=>()=>{i==="upgrade_to_plus"?J.upsell.upgradeToPlus():i==="upgrade_to_pro"&&J.upsell.upgradeToPro(),t()},[t]);return!A||A.length===0?{primary:void 0,secondary:void 0,tertiary:void 0}:(A.forEach(i=>{if(!He.includes(i.action))return;const u=c.jsx(Zo,{button:i,conversationId:e,onClick:a(i.action),color:Yo[i.style]});switch(i.style){case"primary":o=u;break;case"secondary":n=u;break;case"tertiary":r=u;break}}),{primary:o,secondary:n,tertiary:r})}function No({conversationId:A,isOpen:e,onClose:t,buttons:o,title:n,description_markdown:r}){const a=Fo({buttons:o,conversationId:A,onClick:t}),i=c.jsx(vt,{className:"markdown text-token-text-secondary mb-6",urlTransform:l=>l,children:r});return c.jsx(At,{testId:"modal-voice-rate-limit",title:n,isOpen:e,onClose:t,size:"custom",className:"max-w-[550px]",type:"warning",showCloseButton:!0,children:c.jsxs("div",{className:"w-full",children:[i,c.jsxs("div",{className:"flex flex-row justify-end gap-6",children:[a.primary,a.secondary,a.tertiary]})]})})}function Go({conversationId:A}){var NA,GA,LA,JA,XA;const e=X(),t=pA(),o=we({conversationId:A}),n=y(p=>p.server.usage),r=y(p=>p.server.voiceConnectionQuality),a=p=>p===be.LOST,i=St(),{voiceName:l}=OA(),[u,f]=s.useState(!1),d=y(p=>p.server.toolUpdate),[m,h]=s.useState(!1),[E,k]=s.useState(!0),S=Gt(),[g,v]=s.useState(null),[I,Q]=s.useState(null),[b,R]=s.useState(null),C=s.useRef(!1),{prospectiveModelId:M}=bt(A),T=jA(A),{startVoiceMode:eA,stopVoiceMode:U,isVoiceModeActive:K}=Se(),w=y(p=>p.server.connectionState),aA=s.useRef(!1),tA=s.useRef(!1),{requestMicrophonePermissions:oA,userDeclinedMicrophonePermissions:_,microphoneAvailable:nA,microphoneLabel:rA}=Bt(),vA=s.useCallback(async()=>{if(aA.current)return;aA.current=!0;let p;const j=await Ee();j==="prompt"?p="userIgnoredMicrophonePrompt":j==="denied"?p="userDeniedMicrophonePrompt":tA.current?p="limitReached":w==null||w===D.Connecting||w===D.Reconnecting||w===D.SignalReconnecting?p="userAbort":w===D.Connected?p="userRequest":p="networkDisconnected",o(p)},[w,o]);s.useEffect(()=>{oA()},[oA]),s.useEffect(()=>{K&&_&&(f(!1),R(null),v(e.formatMessage(TA.hint)),Q({title:e.formatMessage(TA.title),description_markdown:e.formatMessage(TA.description_markdown),buttons:[]}))},[e,K,_]),s.useEffect(()=>{var p;if(nA&&!w&&!C.current){C.current=!0,v(null),Q(null);const j=yA(A);let G;S!==void 0?(G=S,Lt.set(void 0)):(G=QA({serverThreadId:T,parentMessageId:(p=fA.getCurrentNode(j))==null?void 0:p.id,isAdvancedMode:!0,eventSource:"composer_speech_button",clientThreadId:A,gizmoId:fA.getGizmoId(j)}),J.voiceSessionStarted.click({voice:l}),G.requested_default_model=M!=null?M:void 0),eA(G)}},[w,A,nA,M,T,eA,l,S]);const SA=y(p=>p.hasConnectedOnce),{reaching_limit_disclosure:N,exceed_limit_message:x}=(NA=n==null?void 0:n.rate_limit_message)!=null?NA:{},Y=i==null?void 0:i.modes.find(p=>p.mode===(i==null?void 0:i.default_voice_mode)),q=Y==null?void 0:Y.disclosure_message,P=Y==null?void 0:Y.info_message,Re=s.useMemo(()=>w!==D.Connected?!0:!!a(r),[w,r]),[je,FA]=s.useState(!1);s.useEffect(()=>{w===D.Connected&&FA(!1)},[w]);const bA=(JA=(LA=(GA=N==null?void 0:N.hint)!=null?GA:x==null?void 0:x.title)!=null?LA:q==null?void 0:q.hint)!=null?JA:null;s.useEffect(()=>{var p,j;Y&&!_&&v((j=(p=Y.disclosure_message)==null?void 0:p.hint)!=null?j:null)},[Y,_]),s.useEffect(()=>{const p=d==null?void 0:d.text;let j,G,z;return p&&(k(!1),j=setTimeout(()=>{h(!0),G=setTimeout(()=>{h(!1),z=setTimeout(()=>{k(!0),t.setState(Fe=>{Fe.server.toolUpdate=null})},750)},3e3)},750)),()=>{clearTimeout(j),clearTimeout(G),clearTimeout(z)}},[d,t]),s.useEffect(()=>{if(!_){if(bA&&v(bA),x&&K){tA.current=!0,U();const p={title:x.title,description_markdown:x.description_markdown,buttons:x.buttons};u?R(p):(Q(p),f(!0));const j=x.buttons.some(z=>z.action==="upgrade_to_plus"),G=x.buttons.some(z=>z.action==="upgrade_to_pro");J.rateLimitReached.success({upgrade_to_plus:j,upgrade_to_pro:G})}else if(!I){const p=N!=null?N:q;p&&Q({title:p.title,description_markdown:p.message_markdown,buttons:p.buttons})}}},[q,x,bA,u,K,I,N,U,_,P]);const De=s.useCallback(()=>{b&&(Q(b),R(null)),f(!0)},[b]),Oe=s.useCallback(()=>{P&&Q({title:P.title,description_markdown:P.message_markdown,buttons:P.buttons}),f(!0)},[P]),_e=s.useCallback(()=>{f(!1)},[]),Ze=y(p=>p.voiceMode),Ye=async()=>{try{v(null),FA(!0),await eA({conversation_id:T,eventSource:"lost_connection_hint_message",voice_mode:Ze,voice:l,clientThreadId:A,gizmo_id:fA.getGizmoId(yA(A)),skipCacheReason:"lost-connection-retry",forceDisconnect:!0})}catch(p){const j=p instanceof Error?p.message:String(p);J.voiceMode.error({error:j,eventSource:"lost_connection_hint_message"})}};let H="normal";return _?H="microphone_denied":g?H="normal":Re&&!je&&SA&&(H="disconnected"),c.jsxs("div",{className:"flex w-full flex-col items-center",children:[c.jsxs("div",{className:"text-token-text-secondary relative mb-6 flex min-h-5 w-full items-center justify-center text-xs",children:[(d==null?void 0:d.text)&&c.jsx(F.div,{initial:{opacity:0},animate:{opacity:m?1:0},transition:{duration:.5},style:{position:"absolute",left:"50%",transform:"translateX(-50%)",textAlign:"center"},children:c.jsxs("div",{className:"flex items-center",children:[(d==null?void 0:d.text)&&c.jsx(lo,{className:"icon-sm me-1"}),d==null?void 0:d.text]})}),c.jsx(F.div,{initial:{opacity:0},animate:{opacity:E?1:0},transition:{duration:.5},style:{position:"absolute",left:"50%",transform:"translateX(-50%)",textAlign:"center",pointerEvents:d!=null&&d.text?"none":"auto",cursor:d!=null&&d.text?"default":"pointer"},children:c.jsx("div",{className:"flex items-center",children:g||H==="disconnected"?c.jsx(ae,{type:H,message:g,onClick:H==="disconnected"?Ye:De}):P?c.jsx(ae,{type:"normal",message:P.title,onClick:Oe}):null})})]}),c.jsxs("div",{className:hA("flex flex-row items-center gap-6","rounded-full px-3 py-1","transition-width duration-200 ease-in-out"),children:[c.jsx(ce,{capability:"video",children:c.jsx(Lo,{})}),c.jsx(Jo,{hideTooltip:_,microphoneLabel:rA,isMicrophoneEnabled:nA}),c.jsx(ce,{capability:"screenshare",children:c.jsx(Xo,{})}),c.jsx(YA,{onClick:vA})]}),c.jsx(No,{conversationId:A,isOpen:u,onClose:_e,title:I==null?void 0:I.title,description_markdown:I==null?void 0:I.description_markdown,buttons:(XA=I==null?void 0:I.buttons)!=null?XA:[]}),!1]})}function ce({children:A,capability:e}){return Jt()[e]?A:null}function Lo(){const{cameraTrackState:A,toggleCamera:e}=CA(),t=X();let o=null;const n=[O.Starting,O.Stopping].includes(A),r=A===O.Started;n?o=DA:o=go;const a=r?"bg-gray-900 hover:bg-gray-800 active:bg-gray-700":"bg-black/5 hover:bg-black/10 active:bg-black/20 dark:bg-[rgba(255,255,255,0.04)] dark:hover:bg-white/5 dark:active:bg-white/10",i=r?"text-token-main-surface-primary":"text-token-main-surface-primary-inverse",l=t.formatMessage({id:"SRVwhB",defaultMessage:"Toggle video"});return c.jsx(iA,{"aria-label":l,onClick:()=>e("ControlButton"),disabled:n,icon:o,className:a,iconColor:i})}function Jo({hideTooltip:A,microphoneLabel:e,isMicrophoneEnabled:t}){const{isMuting:o,toggleMute:n}=ke(),r=X(),{disconnectPending:a}=_A(),i=!!y(E=>{var k;return(k=E.dev.room)==null?void 0:k.localParticipant.isMicrophoneEnabled}),l=!!y(E=>{var k;return(k=E.dev.room)==null?void 0:k.localParticipant.isMicrophoneForceMuted}),u=t&&i,f=u?uo:mo,d=u?"bg-black/5 hover:bg-black/10 active:bg-black/20 dark:bg-[rgba(255,255,255,0.04)] dark:hover:bg-white/5 dark:active:bg-white/10":"bg-red-500/10 hover:bg-red-500/15 active:bg-red-500/20 dark:bg-red-500/10 dark:hover:bg-red-500/15 dark:active:bg-red-500/20",m=u?"text-token-main-surface-primary-inverse":"text-danger",h=l?r.formatMessage({id:"bVgTcp",defaultMessage:"Microphone muted in system settings / hardware switch"}):u?r.formatMessage({id:"FI36QI",defaultMessage:"Turn off microphone"}):r.formatMessage({id:"j3oMt1",defaultMessage:"Turn on microphone"});return c.jsx(iA,{"aria-label":h,onClick:n,icon:f,disabled:o||a||l,className:d,iconColor:m,tooltipPrimaryLabel:!A&&e?h:"",tooltipSecondaryLabel:e})}function Xo(){const{screenshareTrackState:A,toggleScreenShare:e}=EA(),t=X();let o=null;const n=[O.Starting,O.Stopping].includes(A),r=A===O.Started;n?o=DA:o=fo;const a=r?"bg-gray-900 hover:bg-gray-800 active:bg-gray-700":"bg-black/5 hover:bg-black/10 active:bg-black/20 dark:bg-[rgba(255,255,255,0.04)] dark:hover:bg-white/5 dark:active:bg-white/10",i=r?"text-token-main-surface-primary":"text-token-main-surface-primary-inverse",l=t.formatMessage({id:"ShdqyW",defaultMessage:"Toggle screenshare"});return c.jsx(iA,{"aria-label":l,onClick:()=>e("ControlButton"),disabled:n,icon:o,className:a,iconColor:i})}function YA({className:A,onClick:e}){const t=X(),{disconnectPending:o}=_A(),n="bg-black/5 hover:bg-black/10 active:bg-black/20 dark:bg-[rgba(255,255,255,0.04)] dark:hover:bg-white/5 dark:active:bg-white/10",r=t.formatMessage({id:"9Mto0a",defaultMessage:"End"});return c.jsx(iA,{disabled:o,onClick:e,icon:o?DA:et,iconColor:"text-token-main-surface-primary-inverse",className:A!=null?A:n,"aria-label":t.formatMessage({id:"7/8k4Y",defaultMessage:"End voice mode"}),tooltipPrimaryLabel:r})}function iA(A){const S=A,{icon:e,disabled:t,className:o,iconColor:n="text-current",iconSize:r="icon-xl",buttonSize:a="h-16 w-16",tooltipPrimaryLabel:i,tooltipSecondaryLabel:l}=S,u=lA(S,["icon","disabled","className","iconColor","iconSize","buttonSize","tooltipPrimaryLabel","tooltipSecondaryLabel"]),[f,d]=s.useState(!1),m=s.useRef(void 0),h=s.useCallback(()=>{clearTimeout(m.current);const g=window.setTimeout(()=>{d(!0)},It);m.current=g},[]),E=s.useCallback(()=>{clearTimeout(m.current),d(!1)},[]);s.useEffect(()=>()=>{clearTimeout(m.current)},[]);const k=c.jsx(Wo,$(B({className:hA(o,a,"text-token-text-primary hover:text-token-text-secondary overflow-hidden rounded-full border-none p-0.5 transition-colors duration-200 ease-in-out"),disabled:t},u),{children:c.jsx(e,{className:hA(r,n)})}));return i?c.jsx(he,{sideOffset:14,label:i,secondaryLabel:l,contentClassName:"flex flex-col items-center justify-center",className:"flex",open:f,side:"top",children:c.jsx("span",{onPointerEnter:h,onPointerLeave:E,children:k})}):k}const Po=s.forwardRef(function(e,t){return c.jsx(tt,$(B({},e),{ref:t}))}),Wo=F.create(Po),TA={hint:{id:"micMessages.hint",defaultMessage:"Enable microphone access in Settings",description:"Hint to the user to manually enable microphone access for voice mode"},title:{id:"micMessages.title",defaultMessage:"Microphone access required",description:"Title for modal that informs the user that microphone access is required for voice mode"},description_markdown:{id:"micMessages.description_markdown",defaultMessage:"To use voice mode, you'll need to enable your microphone and try again.",description:"Description for modal that informs the user that microphone access is required for voice mode"}};function xe(A,e){if(e.srcObject instanceof MediaStream){const t=e.srcObject;t.removeTrack(A),t.getTracks().length>0?e.srcObject=t:e.srcObject=null}}function ye(A,e){let t;e.srcObject instanceof MediaStream?t=e.srcObject:t=new MediaStream;let o;A.kind==="audio"?o=t.getAudioTracks():o=t.getVideoTracks(),o.includes(A)||(o.forEach(n=>{t.removeTrack(n)}),t.addTrack(A)),(!HA()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=t.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==t&&(e.srcObject=t,(HA()||ot())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=t,e.play().catch(()=>{})},0))}function qo({children:A}){const{cameraTrackState:e}=CA(),{screenshareTrackState:t}=EA(),o=e===O.Started||t===O.Started,n=e===O.Started;return c.jsx(sA,{mode:"wait",children:o?c.jsx("div",{className:"flex h-full w-full flex-nowrap items-center",children:n?c.jsx(Uo,{}):c.jsx(Ko,{})}):c.jsx(F.div,{className:"relative flex h-full w-full items-center justify-center",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:A},"children")})}function Uo(){const{cameraTrackState:A,toggleCamera:e}=CA(),{getTracks:t}=kA(),n=t([ZA.Camera]).find(i=>i.origin===AA.Local),r=s.useRef(null),a=A===O.Started&&n;return s.useEffect(()=>{if(n){const i=()=>{e("Browser Video Controls")};return n.onEnded(i),()=>{n.offEnded(i)}}},[n,e]),s.useEffect(()=>{const i=r.current;return i&&n&&ye(n.track,i),()=>{i&&n&&xe(n.track,i)}},[n]),c.jsx(sA,{children:a&&c.jsx(Qe,{children:c.jsxs("div",{className:"aspect-w-16 aspect-h-9 group relative max-h-[95%] w-fit max-w-[60%] overflow-hidden rounded-3xl shadow-md",children:[c.jsx("div",{className:"absolute end-2 top-2 z-10 opacity-0 transition-opacity group-hover:opacity-90",children:c.jsx(YA,{onClick:()=>e("StopButton"),className:"bg-gray-900/20 backdrop-blur-lg hover:bg-gray-900/30 dark:backdrop-blur-lg"})}),c.jsx("video",{ref:r,className:"h-full w-full object-contain",muted:!0})]})},"camera-renderer")})}function Ko(){const{screenshareTrackState:A,toggleScreenShare:e}=EA(),{getTracks:t}=kA(),n=t([ZA.ScreenShare]).find(i=>i.origin===AA.Local),r=s.useRef(null),a=A===O.Started&&n;return s.useEffect(()=>{if(n){const i=()=>{e("Browser ScreenShare Controls")};return n.onEnded(i),()=>{n.offEnded(i)}}},[n,e]),s.useEffect(()=>{const i=r.current;return i&&n&&a&&ye(n.track,i),()=>{i&&n&&xe(n.track,i)}},[n,a]),c.jsx(sA,{children:a&&c.jsx(Qe,{children:c.jsxs("div",{className:"aspect-w-16 aspect-h-9 group relative max-h-[95%] w-fit max-w-[60%] overflow-hidden rounded-3xl shadow-md",children:[c.jsx("div",{className:"absolute end-2 top-2 z-10 opacity-0 transition-opacity group-hover:opacity-90",children:c.jsx(YA,{onClick:()=>e("StopButton"),className:"bg-gray-900/20 backdrop-blur-lg hover:bg-gray-900/30 dark:backdrop-blur-lg"})}),c.jsx("video",{ref:r,className:"h-full w-full object-contain",muted:!0})]})},"screenshare-renderer")})}function Qe({children:A,key:e}){return c.jsx(F.div,{className:"bg-token-main-surface-primary flex h-full w-full flex-col items-center justify-center gap-2",initial:{opacity:0,transform:"blur(12px)",scale:.75},animate:{opacity:1,transform:"blur(0px)",scale:1},exit:{opacity:0,transform:"blur(12px)",scale:.75},transition:{duration:.2},children:A},e)}const mA=(A,e)=>{const[t,o]=s.useState(A===e?performance.now():0),n=s.useRef(e);s.useEffect(()=>{n.current!==e&&A===e&&o(performance.now()),n.current=e},[e,A]);const r=s.useCallback(()=>{o(0)},[]);return[A===e?1:0,t,r]},gA=([A,e,t],o=500)=>{const[n,r]=s.useState(A),a=s.useRef(A),i=s.useRef(void 0),l=s.useCallback((u,f,d)=>{const m=h=>{const E=Math.min((h-u)/o,1),k=f+E*(d-f);r(k),E<1&&(i.current=requestAnimationFrame(m))};i.current=requestAnimationFrame(m)},[o]);return s.useEffect(()=>{if(a.current!==A){a.current=A,i.current&&cancelAnimationFrame(i.current);const u=n,f=A;l(performance.now(),u,f)}},[l,n,A]),[n,e/1e3,t]},le=A=>{const[e,t]=s.useState({audioData:[0,0,0,0],cumulativeAudioData:[0,0,0,0]}),o=s.useRef([0,0,0,0]),n=s.useRef(void 0),r=s.useRef(performance.now()),{bandMagnitudes:a,cumulativeMagnitude:i}=Xt(A,{bands:3,bins:1,gainMultipliers:[10,1,1]});o.current=[...a,i].flat();const l=s.useCallback(()=>{const u=performance.now(),f=(u-r.current)/1e3;r.current=u;const d=o.current,{audioData:m,cumulativeAudioData:h}=e,E=Pt({deltaTimeS:f,audioDataRaw:d,prevAudioData:m,prevCumulativeAudioData:h});t(E)},[e]);return s.useEffect(()=>(n.current||(n.current=window.setInterval(l,Be)),()=>{clearInterval(n.current),n.current=void 0}),[l]),e},Ve=()=>nt(()=>RA())==="transceiver";function de({className:A}){return c.jsx(nn,{className:A})}const Ho=1.55,zo=1.4,$o="audio",An="shout",en="User",tn={bands:4,loPass:0,hiPass:400},ue=[300,300];function on(){var R;const A=st(),e=y(C=>C.voiceMode==="advanced"),t=Ve(),o=ge(),n=it(o,"2624610486"),{getTracks:r}=kA(),a=r([ZA.Microphone]),i=a.find(C=>C.name===$o),l=a.find(C=>C.name===An);let u=te(l==null?void 0:l.track,tn);u.length===0&&(u=[0,0,0,0]),u.map(C=>C*zo);const f=le(l==null?void 0:l.track),d=le(i==null?void 0:i.track),m=f.audioData.map((C,M)=>{const T=d.audioData[M];return C>0&&T>0?(C+T)/2:C>0?C:T}),h=f.cumulativeAudioData.map((C,M)=>{const T=d.cumulativeAudioData[M];return C>0&&T>0?(C+T)/2:C>0?C:T}),E=y(C=>C.server.remoteState),k=y(C=>C.server.connectionState),S=y(C=>C.hasConnectedOnce),g=s.useMemo(()=>{switch(k){case D.Connected:return E;case D.Connecting:case D.Reconnecting:case D.SignalReconnecting:case null:return null;case D.Disconnected:return L.Halted}},[k,E]),v=s.useMemo(()=>{var C;return(C=a.find(M=>M.userName===en))==null?void 0:C.track},[a]),I=((R=te(v,{bands:1,loPass:0,hiPass:400})[0])!=null?R:0)*Ho,{voiceName:Q}=OA();let b;return t&&n?b="HELLO_TIBOR":Q==="shade"&&(b="ANGSTY_BLACK"),{hasConnectedOnce:S,connectionState:k,remoteState:g,userVolume:I,isAdvanced:e,avgMag:m,cumulativeAudio:h,isDarkMode:A,standardBloopVolumes:u,overrideColor:b}}function nn({className:A}){const{hasConnectedOnce:e,connectionState:t,remoteState:o,userVolume:n,isAdvanced:r,avgMag:a,cumulativeAudio:i,isDarkMode:l,standardBloopVolumes:u,overrideColor:f}=on(),[d,m]=s.useState(ue),{canvasSizeRef:h,handleCanvasSizeUpdate:E}=Mt(ue),k=s.useRef(void 0),S=s.useCallback(x=>{m([x.width,x.height])},[]),g=s.useRef([0,0,0,0]);s.useEffect(()=>{o===L.Connecting&&(g.current=[0,0,0,0])},[o]);const v=s.useRef(performance.now());s.useEffect(()=>{const x=performance.now();o===L.Speaking&&x-v.current>50&&(v.current=x,g.current=g.current.map((Y,q)=>Y+a[q]))},[o,a]);const[I,Q]=gA(mA(L.Listening,o)),[b,R]=gA(mA(L.Speaking,o)),[C,M]=gA(mA(L.Thinking,o)),[T,eA]=gA(mA(L.Halted,o)),[U,K]=s.useState(performance.now()/1e3);s.useEffect(()=>{const x=setInterval(()=>{K(performance.now()/1e3)},Be);return()=>clearInterval(x)},[]);const w=s.useMemo(()=>performance.now()/1e3,[]),[aA,tA]=s.useState(1e5),oA=s.useRef(o);s.useEffect(()=>{o===L.Connecting?tA(1e5):oA.current===L.Connecting&&tA(U),oA.current=o},[o,U]);const _=Wt({isAdvanced:r,overrideColor:f}),nA=r?a:u,rA=I===1||b===1,vA=qt({viewport:d,canvasSize:h.current,shouldMeasurePerf:rA,source:"VoiceMode"}),SA=Ut({shouldCalibrate:rA,viewport:d,initialScale:1}),N=s.useMemo(()=>t!==D.Connected&&e,[t,e]);return k.current={time:U-w,micLevel:n,stateListen:I,listenTimestamp:Math.max(Q-w,0),stateThink:C,thinkTimestamp:Math.max(M-w,0),stateSpeak:b,speakTimestamp:Math.max(R-w,0),readyTimestamp:aA-w,stateHalt:T,haltTimestamp:Math.max(eA-w,0),touchDownTimestamp:0,touchUpTimestamp:0,stateFailedToConnect:N?1:0,failedToConnectTimestamp:0,avgMag:nA,cumulativeAudio:i!=null?i:g.current,isNewBloop:!0,isAdvancedBloop:r,bloopColorMain:Array.from(_.bloopColorMain),bloopColorLow:Array.from(_.bloopColorLow),bloopColorMid:Array.from(_.bloopColorMid),bloopColorHigh:Array.from(_.bloopColorHigh),isDarkMode:l,screenScaleFactor:window.devicePixelRatio,viewport:d,silenceAmount:0,silenceTimestamp:0,fadeBloopWhileListening:!1},c.jsx(Kt,{className:hA("flex items-center justify-center",A),variablesRef:k,onViewportUpdate:S,textureImage:Ao,textureName:"uTextureNoise",onGlAvailable:vA,onCanvasSizeUpdate:E,scale:SA,GLUniformsSetter:$t,vert:zt,frag:Ht})}const sn=({conversationId:A})=>{const{getTracks:e}=kA(),t=e(),[o,n]=s.useState(!1),[r,a]=s.useState(!1),{voiceName:i}=OA(),l=X(),u=s.useCallback(()=>{for(const v of t)v.origin===AA.Local?(a(v.isMuted),v.setMuted(!0)):v.origin===AA.Remote&&v.setMuted(!0)},[t]),f=s.useCallback(()=>{for(const v of t)v.origin===AA.Local?r||v.setMuted(!1):v.origin===AA.Remote&&v.setMuted(!1)},[t,r]),d=s.useCallback(()=>{J.voiceSelectionShown.click({voice:i}),u(),n(!0)},[i,u]),m=()=>{f(),n(!1)},h=eo(),E=i==="shade",{alreadyTriggered:k}=to(),S=h&&!E&&!k,g=s.useMemo(()=>c.jsx(iA,{onClick:d,icon:wt,iconColor:"text-token-text-secondary",className:"h-[40px] w-[40px] bg-transparent hover:bg-black/10 active:bg-black/20 dark:bg-transparent dark:hover:bg-white/5 dark:active:bg-white/10",iconSize:"icon"}),[d]);return c.jsxs("div",{className:"relative h-[40px] w-[40px]",children:[S?c.jsx(he,{label:l.formatMessage({id:"SxYG4e",defaultMessage:"Talk to Monday (ugh)"}),children:g}):g,o&&c.jsx(oo,{conversationId:A,onClose:m})]})};function an(A={}){const[e,t]=s.useState(!1),[o,n]=s.useState(!1),[r,a]=s.useState(!1);let i=no().microphoneTrack;const[l,u]=s.useState();A.trackRef&&(i=A.trackRef.publication);const f=s.useCallback(async d=>{if(d){const{KrispNoiseFilter:m,isKrispNoiseFilterSupported:h}=await pe(async()=>{const{KrispNoiseFilter:E,isKrispNoiseFilterSupported:k}=await import("./ctkdf9ilw59d9tc6.js");return{KrispNoiseFilter:E,isKrispNoiseFilterSupported:k}},[]);if(!h()){console.warn("Krisp noise filter is not supported in this browser");return}l||u(m(A.filterOptions))}t(m=>(m!==d&&n(!0),d))},[]);return s.useEffect(()=>{var d;if(i&&i.track instanceof so&&l){const m=i.track.getProcessor();m&&m.name==="livekit-noise-filter"?(n(!0),m.setEnabled(e).finally(()=>{n(!1),a(e)})):!m&&e&&(n(!0),(d=i==null?void 0:i.track)==null||d.setProcessor(l).then(()=>l.setEnabled(e)).then(()=>{a(!0)}).catch(h=>{a(!1),console.error(h)}).finally(()=>{n(!1)}))}},[e,i,l]),{setNoiseFilterEnabled:f,isNoiseFilterEnabled:r,isNoiseFilterPending:o,processor:l}}const rn=s.memo(function(){const{setNoiseFilterEnabled:e}=an();return s.useEffect(()=>{e(!0)},[e]),null}),cn=new ho(new URL("{{.assetPrefix}}/assets/livekit-client.e2ee.worker-DU7GO4HO.js",import.meta.url),{type:"module"}),ln=s.memo(function({children:e}){const t=s.useRef({keyProvider:new io}).current,[o,n]=s.useState(!1),{token:r,url:a,e2eeKey:i}=y(h=>h.credentials),l=po(),u=y(h=>h.isVoiceModeActive),f=y(h=>{var E;return(E=h.audioInputDevice)==null?void 0:E.deviceId}),d=Ve(),m=d?ao:ro;return s.useEffect(()=>{const h=r&&a&&i;!o&&h?t.keyProvider.setKey(i).then(()=>{n(!0)}):o&&!h&&n(!1)},[r,a,i,o,t]),u?c.jsx(So,$(B({},l),{connect:!0,token:r!=null?r:void 0,serverUrl:a!=null?a:void 0,audio:{deviceId:{ideal:f,exact:f},noiseSuppression:!0,echoCancellation:!0},options:{e2ee:{keyProvider:t.keyProvider,worker:cn}},children:c.jsxs(m,{children:[e,d||o&&r&&a?c.jsx(co,{}):null,o&&r&&a&&c.jsx(xo,{}),o&&r&&a&&c.jsx(rn,{}),null]})})):null}),dn=rt(()=>pe(()=>import("./n5kvjsboidouv1r0.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13])).then(A=>A.VoiceModeDevPanel));function un({conversationId:A}){const[e,t]=s.useState(!1),{screenshareTrackState:o}=EA(),{cameraTrackState:n}=CA(),r=o===O.Started||n===O.Started,a=y(f=>f.isVoiceModeActive),i=y(f=>f.server.voiceConnectionQuality),l=X();_o();const u=we({conversationId:A});return at(()=>{a&&u("electron-app-minimized")}),s.useEffect(()=>{const f=new Do;return a?f.enable():f.disable(),()=>{f.disable()}},[a]),c.jsxs(ln,{conversationId:A,children:[c.jsx(sA,{children:a?c.jsx(F.div,{className:"bg-token-main-surface-primary fixed start-0 top-0 z-50 flex h-full w-full flex-col",initial:"hidden",animate:"visible",exit:"hidden",variants:xA,children:c.jsx(F.div,{className:"relative h-full w-full",variants:xA,children:c.jsxs(F.div,{variants:xA,className:"flex h-full w-full flex-col justify-between gap-6",children:[c.jsxs(F.div,{className:"relative mt-6 flex w-full justify-center",children:[c.jsx("div",{className:"flex w-full items-center justify-center",children:(r||!1)&&c.jsx(de,{className:"h-16 w-16"})}),c.jsxs("div",{className:"me-4 flex flex-row gap-2",children:[!1,c.jsx(sn,{conversationId:A})]})]}),c.jsxs("div",{className:"flex h-full min-h-0 items-center justify-center",children:[c.jsx(qo,{children:c.jsxs("div",{className:"relative",children:[c.jsx(de,{className:"min-h-bloop min-w-bloop h-max w-max"}),!1]})}),c.jsx(sA,{children:e?c.jsx(dn,{conversationId:A}):null})]}),c.jsx(F.div,{className:"mb-6 flex justify-center",children:c.jsx(Go,{conversationId:A})})]})})}):null}),i===be.POOR&&c.jsx("div",{className:"absolute start-1/2 top-6 z-50 -translate-x-1/2 transform",children:c.jsx("div",{className:"border-token-border-default bg-token-main-surface-primary inline-flex flex-col items-center rounded-full border px-6 py-3",children:c.jsx("span",{className:"text-token-text-secondary",children:l.formatMessage({id:"YE2Eng",defaultMessage:"Poor connection"})})})}),!1,!1]})}const xA={hidden:{opacity:0,transform:"blur(4px)"},visible:{transform:"blur(0px)",opacity:1},exit:{opacity:0,transform:"blur(4px)"}},vn=Object.freeze(Object.defineProperty({__proto__:null,VoiceModeLayout:un},Symbol.toStringTag,{value:"Module"}));export{yo as g,Fo as u,vn as v};
//# sourceMappingURL=ld4419374p482u7j.js.map
