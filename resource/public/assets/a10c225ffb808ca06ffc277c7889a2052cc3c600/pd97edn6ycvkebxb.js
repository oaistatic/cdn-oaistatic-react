import{r as f,j as p,b as T}from"./jj85rqzpbnvv3emr.js";import{e$ as M,$ as l,a0 as d,i as x,j as C,bP as _}from"./lef5ym39glv4981l.js";import{CoTChunks as E}from"./h2m7x328wbn748a6.js";import{h4 as m}from"./mclphevd122040jw.js";import"./l31shxiia7uxyucr.js";import"./hnotrmacgvnfyexv.js";import"./nq5i976pifkrt40a.js";import"./ojb4d4bxj44fs0l8.js";import"./gvtmvkg8brwofs4l.js";import"./iqw8c7pica2coyb9.js";import"./pbl95wx6493wq92j.js";import"./k059n59kmbyb9lsl.js";import"./o9hdwp5tn0xu3mwp.js";import"./o00amwudg0s90vfh.js";import"./be11s8wd1k6ws4r8.js";const k=(n,e)=>{if(e<=1)return n.formatMessage({id:"ZxhUq1",defaultMessage:"a second"});if(e<3)return n.formatMessage({id:"4GD7tD",defaultMessage:"a couple of seconds"});if(e<4)return n.formatMessage({id:"jx5V1u",defaultMessage:"a few seconds"});if(e>=60){const o=Math.floor(e/60),s=e%60;return"".concat(o,"m ").concat(s,"s")}return n.formatMessage({id:"p4/pTg",defaultMessage:"{seconds} seconds"},{seconds:e})},y=n=>{var o,s;let e=0;for(const t of n)e+=(s=(o=t.metadata)==null?void 0:o.finished_duration_sec)!=null?s:0;return e},R=(n,e,o)=>{var s,t,r;return e.length>1?n.formatMessage({id:"sdDgmZ",defaultMessage:"Thought for {timing}"},{timing:k(n,o)}):(r=(t=(s=M(e))==null?void 0:s.metadata)==null?void 0:t.finished_text)!=null?r:""},I=(n,e,o=!1)=>{var h;const s=[];let t={type:m.Thought,thought:{summary:"",content:""}};const r=()=>{t.thought.content.trim()&&(s.push(t),t={type:m.Thought,thought:{summary:t.thought.summary,content:""}})},u=n.split(/( {2}\n)|(\n\n)/).filter(i=>i!=null&&i.trim());if(!o&&u.length<2)return s;let c=!1;for(let i=0;i<u.length;i++){const a=u[i].trim();if(a.toLowerCase()==="none"){l.count(d.COT_SUMMARIZER,"num_none_chunks");continue}const g=a.match(/^\*\*(.*)\*\*$/);if(g)r(),t.thought.summary=(h=g[1])!=null?h:"";else if(a){if(a.startsWith("```")){if(c){t.thought.content+=t.thought.content?"\n".concat(a):a,r(),c=!1;continue}r(),c=!0}t.thought.content.trim()&&!a.startsWith("\\[")&&!a.startsWith("\\(")&&!c&&r(),t.thought.content+=t.thought.content?"\n".concat(a):a}}return t!=null&&t.thought.content.trim()&&s.push(t),o&&e&&s.push({type:m.Recap,content:e}),s},S=(n,e,o)=>{const s=!o,t=f.useMemo(()=>I(n,e,s),[n,e,s]);return f.useEffect(()=>{s&&l.hist(d.COT_SUMMARIZER,"num_cot_chunks",void 0,t.length)},[s]),t},$=({isStreaming:n,finishedText:e,summaryText:o,isFinalAssistantTurn:s})=>{const t=S(o,e,n),[r,u]=f.useState(!1);return p.jsx(E,{isStreaming:n,isFinalAssistantTurn:s,chunks:t,isExpanded:r,setIsExpanded:u})},j=8,N="\n\n",z=({messages:n,isStreaming:e,isFinalAssistantTurn:o})=>{const s=T(),t=x(),r=C(t,"1214379119"),u=y(n);let c="";return n.forEach(h=>{const i=_(h);c+=c?N+i:i}),r&&!e&&!c&&u<j?null:p.jsx($,{finishedText:R(s,n,u),summaryText:c,isStreaming:e,isFinalAssistantTurn:o})};export{$ as LegacyCoT,z as LegacyCoTMessage};
//# sourceMappingURL=pd97edn6ycvkebxb.js.map
