var ne=Object.freeze,ke=Object.defineProperty;var j=(n,s)=>ne(ke(n,"raw",{value:ne(s||n.slice())}));import{r as h,j as e,b as ye,M as o,x as be,A as Ie,g as R,m as ae,f as Se,G as Ae,ad as De}from"./jj85rqzpbnvv3emr.js";import{F as b,e as y,T as U,ck as Le,pX as Ee,pY as Re,E as Oe,g2 as Be,i as ve,j as Fe,o as C,J as Pe,ai as Ue,pZ as Ve,C as Je,B as ie,p_ as $e,f1 as He,r as We,pg as Ye,bZ as Qe}from"./lef5ym39glv4981l.js";import{N as qe}from"./nfygy4vif6crzpny.js";import{k2 as Ke,k3 as Ze,k4 as V,eQ as Xe,d7 as ze,k5 as m,bW as Te,k6 as p,k7 as L,k8 as Ge,hx as et,k9 as tt,r as st}from"./mclphevd122040jw.js";import{S as nt,a as at}from"./c9rbri58kv0ex0bj.js";import{G as it}from"./cjx9kl6wq86sx3q6.js";const lt=h.memo(function({onSelectVersion:s,selectedVersion:t,currentVersion:l,gizmoVersions:i}){return e.jsx(dt,{selectedVersion:t,onSelectVersion:s,currentVersion:l,gizmoVersions:i})});var re;const rt=b.div(re||(re=j(["flex h-full w-full max-w-3xs flex-col overflow-y-scroll bg-token-sidebar-surface-primary px-2 py-6"])));function dt({onSelectVersion:n,selectedVersion:s,currentVersion:t,gizmoVersions:l}){const i=l==null?void 0:l.items.reduce((a,d)=>{const r=new Date(d.updated_at),u="".concat(r.getFullYear(),"-").concat(r.getMonth()+1,"-").concat(r.getDate());return a[u]||(a[u]=[]),a[u].push(d),a},{});return i?e.jsx(rt,{children:Object.keys(i).map((a,d)=>e.jsx(ft,{date:a,entries:i[a],selectedVersion:s,onSelectVersion:n,currentVersion:t},d))}):null}const me=({name:n,userId:s,showName:t=!1})=>e.jsxs("div",{className:"flex items-center gap-1.5",children:[t&&e.jsx(U,{delayDuration:2e3,label:n,className:"text-token-text-secondary max-w-[100px] truncate text-xs",children:n}),e.jsx("div",{className:y("icon flex items-center justify-center rounded-full text-[8px] text-white",Ze(s)),children:Ke(n)})]});var de;const ot=b.div(de||(de=j(["flex w-full flex-col rounded-lg px-3 py-2 text-base hover:cursor-pointer hover:bg-token-sidebar-surface-tertiary"])));var oe;const ct=b.div(oe||(oe=j(["px-3 text-xs font-medium text-token-text-secondary"])));var ce;const ut=b.div(ce||(ce=j(["flex flex-col space-y-1"])));var ue;const xt=b.div(ue||(ue=j(["mb-8 flex flex-col space-y-2"])));function pe(n,s){const t=new Date(s),l=new Date,i=new Date(l);i.setDate(l.getDate()-1);const a=n.locale||"en-US";return t.toDateString()===l.toDateString()?"Today":t.toDateString()===i.toDateString()?"Yesterday":new Intl.DateTimeFormat(a,{dateStyle:"medium"}).format(t)}const ft=({date:n,entries:s,onSelectVersion:t,selectedVersion:l,currentVersion:i})=>{const a=ye(),d=r=>r===i;return e.jsxs(xt,{children:[e.jsx(ct,{children:pe(a,n)}),e.jsx(ut,{children:s.map((r,u)=>e.jsx(gt,{item:r,isCurrentVersion:d,selectedVersion:l,onSelectVersion:t},u))})]})},gt=({item:n,isCurrentVersion:s,selectedVersion:t,onSelectVersion:l})=>{const[i,a]=h.useState(!1),{version:d,updated_at:r,author:u}=n;return e.jsx(ot,{className:y(t===d&&"bg-token-sidebar-surface-tertiary"),onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),onClick:()=>l(d),children:e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx("div",{className:"text-base",children:s(d)?e.jsx(o,{id:"gizmo.version.current",defaultMessage:"Current version"}):e.jsx(be,{value:r,timeStyle:"short"})}),e.jsx(Ie,{children:!s(d)&&u&&e.jsx(me,{showName:t===d||i,name:u.user_name,userId:u.user_id})})]})})},jt=({gizmoId:n,version:s,skip:t=!1})=>Se({queryFn:async()=>He.getVersion({gizmoId:n,version:s}),queryKey:["gizmo","version",{gizmoId:n,version:s}],enabled:!t}),le=(n,s)=>"/gpts/editor/".concat(n,"?version=").concat(s);var xe;const we=b.div(xe||(xe=j(["flex h-screen w-full flex-col items-center"])));var fe;const Ce=b.div(fe||(fe=j(["flex w-full grow overflow-hidden"])));var ge;const _e=b.div(ge||(ge=j(["flex h-full grow flex-wrap items-start justify-between gap-4 overflow-auto"])));var je;const Me=b.div(je||(je=j(["sticky top-0 flex h-16 w-full items-center justify-between gap-2 border-b border-token-border-medium bg-token-main-surface-primary px-3 py-3"])));function ht({gizmoId:n}){var r,u,v;const{data:s,isLoading:t,refetch:l}=Le(n),i=(r=s==null?void 0:s.gizmo)==null?void 0:r.current_user_permission,a=(u=i==null?void 0:i.can_write)!=null?u:!1,d=(v=i==null?void 0:i.can_view_config)!=null?v:!1;return!s||t?null:a?e.jsx(bt,{gizmoResource:s,refetchGizmo:l}):d?e.jsx(yt,{gizmoResource:s}):null}const Ne=({children:n})=>{const s=R();return e.jsxs("div",{className:"flex cursor-pointer items-center gap-1.5",onClick:()=>s(-1),children:[e.jsx(ze,{className:"icon"}),e.jsx("div",{children:n})]})},yt=({gizmoResource:n})=>{const s=R(),t=Re(),l=n.gizmo.id,i=async()=>{const a=await t.mutateAsync({gizmoId:l});a.gizmo.id&&s("/gpts/editor/".concat(a.gizmo.id))};return e.jsxs(we,{children:[e.jsxs(Me,{children:[e.jsx(Ne,{children:e.jsx(o,{id:"gizmoReadOnly.configurationTitle",defaultMessage:"Configuration"})}),e.jsx("div",{className:"me-4 flex gap-2",children:e.jsx(V,{color:"secondary",loading:t.isPending,onClick:i,children:e.jsx(o,{id:"gizmo.readonly.duplicate",defaultMessage:"Duplicate"})})})]}),e.jsx(Ce,{children:e.jsx(_e,{children:e.jsx(J,{displayGizmo:n})})})]})},bt=({gizmoResource:n,refetchGizmo:s})=>{const t=n.gizmo.id,{data:l,refetch:i}=Ee({gizmoId:t});h.useEffect(()=>{s(),i()},[s,i]);const a=n==null?void 0:n.gizmo.live_version;return a==null||!l?null:e.jsx(vt,{gizmoResource:n,currentVersion:a,gizmoVersions:l})};function vt({gizmoResource:n,currentVersion:s,gizmoVersions:t}){const l=R(),i=n.gizmo.id,[a,d]=h.useState(s),[r,u]=h.useState(!1),[v,w]=h.useState(!1),g=()=>{l(a?le(i,a):$e(i))},O=()=>{if(a!==s&&n.tools.find(D=>{var M;return D.type===C.JIT_PLUGIN&&((M=D.metadata.auth)==null?void 0:M.type)!==Ve.None})){w(!0);return}l(le(i,a))},f=()=>{a===s&&s>1&&d(s-1),r&&d(s),u(!r)},N=s>1;h.useEffect(()=>{a===s&&u(!1)},[a,s]);const{data:_,isLoading:A}=jt({gizmoId:i,version:a});return e.jsxs(we,{children:[e.jsxs(Me,{children:[e.jsx(Ne,{children:e.jsx(o,{id:"gizmoReadOnly.versionHistoryTitle",defaultMessage:"Version History"})}),e.jsxs("div",{className:"me-4 flex gap-2",children:[N&&e.jsx(U,{label:e.jsx(o,{id:"gizmo.readonly.compareTooltip",defaultMessage:"Compare to the previous version"}),disabled:!N||r,triggerAs:null,children:e.jsx(V,{color:r?"primary":"secondary",className:y("btn rounded-full border transition-colors",r?y(qe,"border-transparent"):"border-token-border-default hover:bg-token-surface-hover bg-transparent"),onClick:f,icon:r?nt:at,children:r?e.jsx(o,{id:"gizmo.readonly.comparing",defaultMessage:"Comparing changes"}):e.jsx(o,{id:"gizmo.readonly.compare",defaultMessage:"Compare changes"})})}),e.jsx(U,{label:e.jsx(o,{id:"gizmo.readonly.restoreVersionTooltip",defaultMessage:"You will be able to edit before publishing"}),disabled:a===s,triggerAs:null,children:e.jsx(V,{color:"secondary",disabled:a===s,icon:Xe,onClick:O,children:e.jsx(o,{id:"gizmo.readonly.restoreVersion",defaultMessage:"Restore this version"})})})]})]}),e.jsxs(Ce,{children:[e.jsx(lt,{selectedVersion:a,currentVersion:s,onSelectVersion:d,gizmoVersions:t}),A&&e.jsx("div",{className:"flex h-full w-full grow flex-col items-center justify-center",children:e.jsx(Oe,{})}),_&&e.jsxs(_e,{children:[e.jsx(J,{displayGizmo:_,isComparing:r,gizmoVersions:t}),r&&e.jsx(J,{displayGizmo:n,compareToGizmo:_,setIsComparing:u,isComparing:!0,gizmoVersions:t})]})]}),v&&e.jsx(wt,{onClose:()=>w(!1),onContinue:g})]})}const P=(n,s=[],t=[],l)=>n?[...t,...s.filter(l)]:s,E=(n,s)=>y(n&&s?"bg-blue-400/10":"bg-token-main-surface-secondary");function J({isComparing:n,displayGizmo:s,compareToGizmo:t,setIsComparing:l,gizmoVersions:i}){var H,W,Y,Q,q,K,Z,X,z,T,G,ee,te,se;const a=ye(),{data:d}=Be(),r=ve(),u=Fe(r,"1854238036"),v=s.gizmo.default_model!==(t==null?void 0:t.gizmo.default_model),w=s.gizmo.display.name!==(t==null?void 0:t.gizmo.display.name),g=s.gizmo.display.description!==(t==null?void 0:t.gizmo.display.description),O=s.gizmo.instructions!==(t==null?void 0:t.gizmo.instructions),f=n&&!!t,N=P(f,(H=s.gizmo.display.prompt_starters)!=null?H:[],(W=t==null?void 0:t.gizmo.display.prompt_starters)!=null?W:[],c=>{var x;return!((x=t==null?void 0:t.gizmo.display.prompt_starters)!=null&&x.includes(c))}),_=P(f,(Y=s.files)!=null?Y:[],(Q=t==null?void 0:t.files)!=null?Q:[],c=>{var x;return!((x=t==null?void 0:t.files)!=null&&x.find(k=>k.id===c.id))}),A=P(f,(K=(q=s.tools)==null?void 0:q.filter(c=>c.type===C.JIT_PLUGIN))!=null?K:[],(X=(Z=t==null?void 0:t.tools)==null?void 0:Z.filter(c=>c.type===C.JIT_PLUGIN))!=null?X:[],c=>c.type===C.JIT_PLUGIN&&!(t!=null&&t.tools.find(x=>x.type===C.JIT_PLUGIN&&x.metadata.action_id===c.metadata.action_id))),D=s.gizmo.display.profile_picture_url!==(t==null?void 0:t.gizmo.display.profile_picture_url),M=(z=i==null?void 0:i.items.find(c=>c.version===s.gizmo.version))==null?void 0:z.author;return e.jsx(ae.div,{initial:{opacity:0,x:10},animate:{opacity:1,x:0},exit:{opacity:0,x:10},transition:{duration:.2},className:y("relative flex min-w-0 flex-1 grow justify-center overflow-auto",f&&"border-s"),children:e.jsxs("div",{className:"flex w-full max-w-2xl flex-col px-4 py-8 text-sm",children:[e.jsxs(ae.div,{initial:{opacity:0},animate:{opacity:n?1:0},transition:{duration:n?.2:0},className:"mb-4 flex w-full items-center justify-between",children:[e.jsx("div",{className:"text-token-text-tertiary text-base",children:t?e.jsx(o,{id:"gizmo.readonly.currentVersion",defaultMessage:"Current"}):e.jsx(o,{id:"gizmo.readonly.previous",defaultMessage:"Previous"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.gizmo.version_updated_at&&e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(o,{id:"gizmo.readonly.updatedAt",defaultMessage:"{date} at {time}",values:{date:pe(a,s.gizmo.version_updated_at),time:e.jsx(be,{value:new Date(s.gizmo.version_updated_at),hour:"numeric",minute:"numeric"})}})}),M&&e.jsx(me,{name:M.user_name,userId:M.user_id}),t&&l&&e.jsx(Pe,{onClick:()=>l(!1)})]})]}),e.jsx(m,{className:"self-center",children:e.jsx(Te,{src:s.gizmo.display.profile_picture_url,isFirstParty:!1,className:y("h-20 w-20",D&&t&&"border-opacity-10 rounded-full border-4 border-blue-400"),showLoading:!0})}),e.jsxs(m,{children:[e.jsx(p,{label:e.jsx(o,{id:"gizmo.readonly.nameLabel",defaultMessage:"Name"})}),e.jsx(L,{type:"text",value:(T=s.gizmo.display.name)!=null?T:"",disabled:!0,className:E(f,w)})]}),e.jsxs(m,{children:[e.jsx(p,{label:e.jsx(o,{id:"gizmo.readonly.descriptionLabel",defaultMessage:"Description"})}),e.jsx(L,{type:"text",value:(G=s.gizmo.display.description)!=null?G:"",disabled:!0,className:E(f,g)})]}),e.jsxs(m,{children:[e.jsx(p,{label:e.jsx(o,{id:"gizmo.readonly.instructionsLabel",defaultMessage:"Instructions"})}),e.jsx(Ge,{rows:8,value:(ee=s.gizmo.instructions)!=null?ee:"",disabled:!0,className:y("resize-none",E(f,O))})]}),N.length>0&&e.jsxs(m,{children:[e.jsx(p,{label:e.jsx(o,{id:"gizmo.readonly.conversationStartersLabel",defaultMessage:"Conversation starters"})}),N.map((c,x)=>{var I,S;const k=!((I=t==null?void 0:t.gizmo.display.prompt_starters)!=null&&I.includes(c)),B=!((S=s.gizmo.display.prompt_starters)!=null&&S.includes(c));return e.jsx(L,{type:"text",value:c,disabled:!0,className:y("bg-token-main-surface-secondary mb-2 resize-none",$(f,k,B))},x)})]}),_.length>0&&e.jsxs(m,{children:[e.jsx(p,{label:e.jsx(o,{id:"gizmo.readonly.knowledgeLabel",defaultMessage:"Knowledge"})}),e.jsx("div",{className:"flex flex-wrap gap-1",children:_.map((c,x)=>{var I,S;const k=!((I=t==null?void 0:t.files)!=null&&I.find(F=>F.id===c.id)),B=!((S=s.files)!=null&&S.find(F=>F.id===c.id));return e.jsx(et,{file:c.name,fileId:c.id,className:$(f,k,B)},x)})})]}),e.jsxs(m,{children:[e.jsx(p,{label:e.jsx(o,{id:"gizmo.readonly.capabilitiesLabel",defaultMessage:"Capabilities"})}),e.jsx(it,{enabledTools:s.tools,diffedEnabledTools:t==null?void 0:t.tools,onEnabledToolsChange:Ue})]}),u&&d&&e.jsxs(m,{children:[e.jsx(p,{label:e.jsx(o,{id:"gizmo.readonly.recommendedModelLabel",defaultMessage:"Recommended Model"})}),e.jsx(L,{type:"text",value:s.gizmo.default_model?(se=(te=d.models.get(s.gizmo.default_model))==null?void 0:te.title)!=null?se:s.gizmo.default_model:a.formatMessage({id:"gizmoEditor.noneOption",defaultMessage:"No Recommended Model - Users will use any model they prefer"}),disabled:!0,className:E(f,v)})]}),!!A.length&&e.jsxs(m,{children:[e.jsx(p,{label:e.jsx(o,{id:"gizmo.readonly.actionsLabel",defaultMessage:"Actions"})}),e.jsx("div",{className:"flex flex-col gap-1",children:A.map((c,x)=>e.jsx(pt,{tool:c,isDiffed:f,compareToGizmo:t,displayGizmo:s},x))})]})]})})}var he;const mt=b.textarea(he||(he=j(["mb-8 rounded-lg block h-96 w-full border-token-main-surface-tertiary bg-transparent p-2 font-mono text-xs text-token-text-primary"]))),pt=({tool:n,compareToGizmo:s,displayGizmo:t,isDiffed:l})=>{var v,w;const i=n,[a,d]=h.useState(!1),r=!((v=s==null?void 0:s.tools)!=null&&v.find(g=>g.type===C.JIT_PLUGIN&&g.metadata.action_id===i.metadata.action_id)),u=!t.tools.find(g=>g.type===C.JIT_PLUGIN&&g.metadata.action_id===i.metadata.action_id);return e.jsxs(e.Fragment,{children:[e.jsx(tt,{isDisabled:!1,actionTool:i,className:$(l,r,u),onShowActionsEditor:()=>d(g=>!g)}),a&&e.jsx(mt,{readOnly:!0,value:(w=i.metadata.raw_spec)!=null?w:""})]})},$=(n,s,t)=>y(n&&s&&"bg-blue-400/10!",n&&t&&"bg-blue-400/10! text-token-text-secondary line-through opacity-50");function wt({onClose:n,onContinue:s}){const[t,l]=h.useState(!1);return e.jsx(Je,{testId:"modal-gizmo-auth-restore",isOpen:!0,onClose:n,type:"warning",showCloseButton:!0,title:e.jsx(o,{id:"gizmoReadOnly.authModalWarningTitle",defaultMessage:"Reset Authentication for Custom Actions"}),primaryButton:e.jsx(ie,{onClick:()=>{l(!0),s()},loading:t,color:"secondary",children:e.jsx(o,{id:"gizmoReadOnly.authModalContinueButton",defaultMessage:"Continue"})}),secondaryButton:e.jsx(ie,{onClick:n,color:"secondary",children:e.jsx(o,{id:"gizmoReadOnly.authModalCancelButton",defaultMessage:"Cancel"})}),size:"normal",children:e.jsx(o,{id:"gizmoReadOnly.authModalWarningBody",defaultMessage:"Restoring this version will reset authentication of your custom actions. You may need to reconfigure each custom action afterwards."})})}const At=()=>(st(),null),Dt=Ae(function(){var r;const s=ve(),t=We(s),l=R(),a=(r=De().gizmoId)!=null?r:"",d=Ye(a);return h.useEffect(()=>{t!=null&&t.isFree()&&l("/")},[t,l]),h.useEffect(()=>{d&&Qe(d)&&l("/g/".concat(a,"/project"))},[d,l,a]),e.jsx(ht,{gizmoId:d})});export{At as clientLoader,Dt as default};
//# sourceMappingURL=j65cx9z1c625e775.js.map
