const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jz33sxazob8nvrz7.js","assets/lef5ym39glv4981l.js","assets/jj85rqzpbnvv3emr.js","assets/root-ogjlcpyy.css","assets/mclphevd122040jw.js","assets/conversation-small-g7l5datj.css","assets/hrd3zywe5ql748qg.js","assets/blsgly9vru5i7r8m.js","assets/i5991cad8s41d2db.js","assets/d3fvcsvcifg627w1.js","assets/ksbtr9cllybwh424.js","assets/caf1sdj80uq0brjb.js","assets/iz4ncq3w9yqnlqea.js","assets/fe7euoed9h00rh41.js","assets/dz63jikeem6urs0m.js","assets/n8vi41od4r1tq9yq.js"])))=>i.map(i=>d[i]);
var Bt=Object.freeze,qt=Object.defineProperty,to=Object.defineProperties;var no=Object.getOwnPropertyDescriptors;var Ye=Object.getOwnPropertySymbols;var $t=Object.prototype.hasOwnProperty,zt=Object.prototype.propertyIsEnumerable;var Wt=(a,s,n)=>s in a?qt(a,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[s]=n,B=(a,s)=>{for(var n in s||(s={}))$t.call(s,n)&&Wt(a,n,s[n]);if(Ye)for(var n of Ye(s))zt.call(s,n)&&Wt(a,n,s[n]);return a},le=(a,s)=>to(a,no(s));var Kt=(a,s)=>{var n={};for(var e in a)$t.call(a,e)&&s.indexOf(e)<0&&(n[e]=a[e]);if(a!=null&&Ye)for(var e of Ye(a))s.indexOf(e)<0&&zt.call(a,e)&&(n[e]=a[e]);return n};var Ze=(a,s)=>Bt(qt(a,"raw",{value:Bt(s||a.slice())}));import{r as c,j as t,M as X,d as wn,R as ao,i as oo,A as io,c as ro}from"./jj85rqzpbnvv3emr.js";import{ex as Ue,ey as Ge,F as ws,bJ as ns,e$ as T,bI as G,ch as $,e as Y,_ as lo,nl as co,cj as Ce,bM as he,bQ as js,bK as Ne,jk as uo,ca as jn,B as Cn,ie as En,R as mo,A as go,cX as Qt,ax as Jt,i as Ve,bG as Xt,b as ho,Y as kn,h0 as po,Z as Mn,ib as An,ov as fo,d as bo,h as xo,mA as _s,iq as vo,fU as _o,bO as Io,j as we,a3 as Fe,bq as So,g5 as To,kP as yo,ck as wo,bZ as jo,gi as Co,n7 as Eo,n4 as ko,n8 as Mo,nk as Ao,O as as,bF as es,cg as Ro,a9 as Po,a6 as Fo,P as Is,t as No,oJ as Do,fW as Uo,pN as Go,a8 as Vo,l2 as Oo,bP as ts,pO as Cs,pP as Yt,dA as Ho,pQ as Lo,de as Bo,df as Wo,el as qo,q as Zt,kn as ss,cf as en,ii as $o,hR as zo,k2 as Ko,h1 as Es,mv as Qo,pR as Jo,a2 as Xo,cM as Yo,bs as Zo}from"./lef5ym39glv4981l.js";import{iG as ei,c$ as Rn,iH as sn,bS as si,iI as tn,iJ as ti,iK as Pn,iL as nn,iM as ni,iN as ai,cJ as oi,cK as ii,iO as ri,bq as li,br as ci,iP as di,iQ as ui,iR as mi,Y as gi,k as hi,iS as pi,ho as fi,iT as an,iU as bi,cY as on,iV as xi,iW as vi,iX as _i,iY as Ii,aw as Si,iZ as Ti,i_ as yi,i$ as rn,j0 as wi,aV as ln,j1 as ji,j2 as Ci,j3 as Ei,j4 as ki,j5 as Mi,j6 as Ai,j7 as Ri,j8 as Pi,j9 as Fi,ja as Ni,jb as Di,jc as Ui,jd as Gi,je as Vi,jf as Fn,jg as Oi,jh as Hi,ji as Li,jj as Bi,jk as Wi,jl as qi,jm as $i,jn as zi,jo as Ki,jp as Qi,jq as Ji,jr as cn,js as Xi,jt as Yi,ju as Zi,jv as er,jw as sr,jx as tr,jy as nr,jz as ar,jA as or,jB as ir,jC as rr,jD as lr,jE as cr,az as dn,jF as dr,jG as ur,jH as mr,jI as De,jJ as Nn,jK as gr,jL as Dn,jM as Un,jN as Gn,jO as hr,jP as pr,jQ as fr,jR as br,jS as xr,jT as vr}from"./mclphevd122040jw.js";import{C as Ts}from"./ng0sx063g0r0whhb.js";const un=Ue(()=>Ge(()=>import("./jz33sxazob8nvrz7.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(a=>a.MemoryActionResult));function mn(a,s,n){he(a,e=>{js.updateTree(e,r=>{r.updateNodeMetadata(s,{inlineComparisonRating:n})})})}const gn=({messages:a})=>{for(const{metadata:s}of a){const{paragen_display_label:n}=s!=null?s:{};if(n)return n;const{augmented_paragen_prompt_label:e}=s!=null?s:{};if(e)return e}};function _r(a){const s=c.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),n=c.useRef({left:null,right:null});return a.variantIds.length<2?t.jsx(Vn,B({setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:s,firstVisibleTokenTimestampsRef:n},a)):t.jsx(Ir,le(B({},a),{visibilityStateRef:s,firstVisibleTokenTimestampsRef:n}))}function Ir(a){const{clientThreadId:s,variantIds:n,turnIndex:e,firstVisibleTokenTimestampsRef:r}=a;if(n.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const g=Pn(),d=lo(),[h,u]=n,v=c.useMemo(()=>co(h+u)()>=.5,[h,u]),[m,x]=v?[u,h]:[h,u],[_,y,C]=Ce(s,O=>{var R,P,M,W,i,A,F,K,ae,j,ce,de,S,H,ue,Q,q,pe,me,Ee;const D=Qt(O).tree.getLeafFromNode(m).id,E=Qt(O).tree.getLeafFromNode(x).id,k=G.getConversationTurns(O,D),p=G.getConversationTurns(O,E),z=e<k.length?k[e]:null,V=e<p.length?p[e]:null;return z||Jt.addError("Paragen Left turn index ".concat(e," out of bounds"),{turnIndex:e,turnCount:k.length,lastTurnRole:(R=T(k))==null?void 0:R.role,lastMessageAuthor:(M=T((P=T(k))==null?void 0:P.messages))==null?void 0:M.author,lastMessageContentType:(i=T((W=T(k))==null?void 0:W.messages))==null?void 0:i.content.content_type,lastMessageMetadata:(F=T((A=T(k))==null?void 0:A.messages))==null?void 0:F.metadata,altTurnCount:p.length,altLastTurnRole:(K=T(p))==null?void 0:K.role,altLastMessageRole:(j=T((ae=T(p))==null?void 0:ae.messages))==null?void 0:j.author.role}),V||Jt.addError("Paragen Right turn index ".concat(e," out of bounds"),{turnIndex:e,turnCount:p.length,lastTurnRole:(ce=T(p))==null?void 0:ce.role,lastMessageAuthor:(S=T((de=T(p))==null?void 0:de.messages))==null?void 0:S.author,lastMessageContentType:(ue=T((H=T(p))==null?void 0:H.messages))==null?void 0:ue.content.content_type,lastMessageMetadata:(q=T((Q=T(p))==null?void 0:Q.messages))==null?void 0:q.metadata,altTurnCount:k.length,altLastTurnRole:(pe=T(k))==null?void 0:pe.role,altLastMessageRole:(Ee=T((me=T(k))==null?void 0:me.messages))==null?void 0:Ee.author.role}),[D,z,V]}),[I,N]=v?[C,y]:[y,C],ie="skippable_parallel_2_in_stream:a:1.5";c.useEffect(()=>(nn.setState({displayingSideBySideFeedback:!0}),()=>{nn.setState({displayingSideBySideFeedback:!1})}),[]);const Z=c.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),ne=c.useCallback((O,{shouldSubmitParagenFeedback:D=!0}={})=>{var W,i;if(!y||!C||!I||!N)throw new Error("Expected both turns to exist");he(s,A=>{js.setCurrentBranch(A,O)});const E=O===m,k=O===h;I.messages.length>0&&mn(s,I.messages[I.messages.length-1].id,k?"original":"new"),N.messages.length>0&&mn(s,N.messages[N.messages.length-1].id,k?"original":"new");const p=Ne(s),z=[y,C].map((A,F)=>{var K,ae;return{messageId:A.messages[A.messages.length-1].id,loadFirstTokenTime:F===0?r.current.left:r.current.right,loadEndTime:(ae=(K=T(A.messages))==null?void 0:K.clientMetadata)==null?void 0:ae.completionSampleFinishTime}}),V=E?z[0].messageId:z[1].messageId,R=G.getParentPromptNode(ns(s),_);if(!R)throw new Error("Expected prompt for side by side feedback");const P={},M=((W=R.message.clientMetadata)==null?void 0:W.variantsInStreamInfo)==null&&((i=R.message.metadata)==null?void 0:i.paragen_variants_info)!=null;for(const A of z)P[A.messageId]=M?{load_first_token_time:a.conversationTurnMountTime,load_end_time:a.conversationTurnMountTime}:{load_first_token_time:A.loadFirstTokenTime,load_end_time:A.loadEndTime};D&&xn({params:{conversation_id:p,displayed_message_ids:z.map(A=>A.messageId),message_metadatas:P,rating:"selected",selected_message_id:V,source_timestamp:Date.now(),ui_variant:1,user_prompt_message_id:R.message.id}})},[s,m,h,I,N,y,C,_,r,a.conversationTurnMountTime]);return c.useEffect(()=>uo(jn,{requestCompletion:O=>{var R,P;const D=Ne(s),E=G.getParentPromptNode(ns(s),_);if(!E)throw new Error("Expected prompt for side by side feedback");if(!y||!C)throw new Error("Expected both turns to exist");const k=[y,C].map((M,W)=>{var i,A;return{messageId:M.messages[M.messages.length-1].id,loadFirstTokenTime:W===0?r.current.left:r.current.right,loadEndTime:(A=(i=T(M.messages))==null?void 0:i.clientMetadata)==null?void 0:A.completionSampleFinishTime}}),p={},z=((R=E.message.clientMetadata)==null?void 0:R.variantsInStreamInfo)==null&&((P=E.message.metadata)==null?void 0:P.paragen_variants_info)!=null;for(const M of k)p[M.messageId]=z?{load_first_token_time:a.conversationTurnMountTime,load_end_time:a.conversationTurnMountTime}:{load_first_token_time:M.loadFirstTokenTime,load_end_time:M.loadEndTime};const V=O.isForSkippingParagen;xn({params:{conversation_id:D,displayed_message_ids:k.map(M=>M.messageId),message_metadatas:p,rating:V?"explicit_skipped":"skipped",selected_message_id:null,source_timestamp:Date.now(),ui_variant:V?3:1,user_prompt_message_id:E.message.id}}),V&&ne(m,{shouldSubmitParagenFeedback:!1})}}),[y,C,_,s,a.conversationTurnMountTime,ie,I==null?void 0:I.messages,N==null?void 0:N.messages,d,r,ne,m]),t.jsx(Vn,le(B({},a),{setPreferredFeedback:ne,leftVariantId:m,rightVariantId:x,leftTurn:y,rightTurn:C,hasActiveRequest:g,originalTurn:I,visibilityStateRef:Z}))}function Vn(v){var m=v,{setPreferredFeedback:a,leftVariantId:s,rightVariantId:n,leftTurn:e,rightTurn:r,hasActiveRequest:g,originalTurn:d,visibilityStateRef:h}=m,u=Kt(m,["setPreferredFeedback","leftVariantId","rightVariantId","leftTurn","rightTurn","hasActiveRequest","originalTurn","visibilityStateRef"]);var ce,de,S;const x=(ce=e&&gn(e))!=null?ce:null,_=(de=r&&gn(r))!=null?de:null,y=c.useMemo(()=>{var H;return(H=e==null?void 0:e.messages)!=null?H:[]},[e==null?void 0:e.messages]),C=c.useMemo(()=>{var H;return(H=r==null?void 0:r.messages)!=null?H:[]},[r==null?void 0:r.messages]),{avatarClassName:I,firstVisibleTokenTimestampsRef:N}=u,ie=c.useMemo(()=>{var H;return(H=e==null?void 0:e.messageGroups)!=null?H:[]},[e==null?void 0:e.messageGroups]),Z=c.useMemo(()=>{var H;return(H=r==null?void 0:r.messageGroups)!=null?H:[]},[r==null?void 0:r.messageGroups]),ne=ei(),O=ns(u.clientThreadId),D=T(e==null?void 0:e.messages),E=T(r==null?void 0:r.messages),k=Rn(G.getRequestId(O,(S=D==null?void 0:D.id)!=null?S:E==null?void 0:E.id)),p=k&&!(D!=null&&D.end_turn),z=k&&!(E!=null&&E.end_turn),V=D!=null&&sn(D),R=E!=null&&sn(E),P=V!=null?V:R,M=(e==null?void 0:e.role)===$.User,W=(r==null?void 0:r.role)===$.User,i=c.useRef(null),A=c.useRef(null),F=c.useRef(null),K=e!=null,ae=r!=null;!K&&N.current.left==null&&(N.current.left=Date.now()),!ae&&N.current.right==null&&(N.current.right=Date.now()),c.useEffect(()=>{if(i.current&&A.current&&F.current){const H=Array(11).fill(0).map((Q,q)=>q/10),ue=new IntersectionObserver(Q=>Q.forEach(q=>{var pe,me;q.target===A.current?(h.current.left_visibility_initial==null&&(h.current.left_visibility_initial=q.intersectionRatio),h.current.left_visibility_max=Math.max((pe=h.current.left_visibility_max)!=null?pe:0,q.intersectionRatio)):q.target===F.current&&(h.current.right_visibility_initial==null&&(h.current.right_visibility_initial=q.intersectionRatio),h.current.right_visibility_max=Math.max((me=h.current.right_visibility_max)!=null?me:0,q.intersectionRatio))}),{root:i.current,threshold:H});return ue.observe(A.current),ue.observe(F.current),()=>ue.disconnect()}},[h]);const{data:j}=si(void 0,!1,ne);return t.jsxs("div",{className:"relative flex flex-col",children:[t.jsx("div",{className:"bg-token-main-surface-primary sticky top-[-1px] z-1 px-(--thread-content-margin) text-center text-lg text-pretty md:static","data-testid":"paragen-feedback-title",children:t.jsx(X,{id:"KKeSJV",defaultMessage:"You're giving feedback on a new version of ChatGPT."})}),t.jsx("div",{className:"text-token-text-secondary px-(--thread-content-margin) pt-1 pb-5 text-center text-sm text-pretty",children:t.jsx(X,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})}),t.jsx("div",{className:Y(ti("default"),"horzScrollShadows relative -mb-2 snap-x snap-mandatory overflow-x-auto overflow-y-clip pb-4"),ref:i,children:t.jsxs("div",{className:Y("mx-auto box-content max-w-[calc(2*var(--thread-content-max-width))] min-w-min px-(--thread-content-margin)","flex items-start gap-4 sm:gap-6"),children:[t.jsxs(hn,{rootElementRef:A,onClick:()=>{a(s)},hasActiveRequest:g,isImageGenInProgress:P,children:[t.jsxs(fn,{children:[t.jsx(tn,{messages:y,isUserTurn:M,avatarClassName:I}),t.jsx(pn,{children:t.jsx(X,le(B({},vn.responseNumber),{values:{responseIndex:1,display_label:x?" ".concat(x):""}}))})]}),t.jsxs(t.Fragment,{children:[j!=null&&!M&&t.jsx(un,{clientThreadId:u.clientThreadId,messages:y,isParagen:!0}),t.jsx(Ts,le(B({},u),{allMessages:y,groupedMessagesToRender:ie,allGroupedMessages:ie,isUserTurn:M,isFinalUserTurn:!1,isFinalAssistantTurn:!1,isCompletionRequestInProgress:p,hasActiveRequest:g,shouldGrowContainer:!1,isParagen:!0})),t.jsx(bn,{clientThreadId:u.clientThreadId,conversationTurnMountTime:u.conversationTurnMountTime,turn:e,originalTurn:d})]})]}),t.jsxs(hn,{rootElementRef:F,onClick:()=>{a(n)},hasActiveRequest:g,isImageGenInProgress:P,children:[t.jsxs(fn,{children:[t.jsx(tn,{messages:C,isUserTurn:W,avatarClassName:I}),t.jsx(pn,{children:t.jsx(X,le(B({},vn.responseNumber),{values:{responseIndex:2,display_label:_?" ".concat(_):""}}))})]}),t.jsxs(t.Fragment,{children:[j!=null&&!W&&t.jsx(un,{clientThreadId:u.clientThreadId,messages:C,isParagen:!0}),t.jsx(Ts,le(B({},u),{allMessages:C,groupedMessagesToRender:Z,allGroupedMessages:Z,isFinalUserTurn:!1,isFinalAssistantTurn:!1,isUserTurn:W,isCompletionRequestInProgress:z,hasActiveRequest:g,shouldGrowContainer:!1,isParagen:!0})),t.jsx(bn,{clientThreadId:u.clientThreadId,conversationTurnMountTime:u.conversationTurnMountTime,turn:r,originalTurn:d})]})]})]})})]})}function hn({rootElementRef:a,onClick:s,children:n,hasActiveRequest:e,isImageGenInProgress:r}){const g=c.useRef(null),d=c.useRef(null),h=c.useRef(null);return t.jsx("div",{"data-paragen-root":!0,className:"border-token-border-tertiary @container relative flex min-w-[min(450px,80cqw,80vw)] flex-1 snap-center flex-col gap-1 rounded-xl border text-start shadow-lg shadow-black/3",ref:a,children:t.jsxs("div",{className:Y(ni,"px-(--thread-content-margin) py-4"),children:[t.jsx("div",{className:Y("absolute top-48 right-0! left-0! h-px","invisible"),ref:g}),t.jsx("div",{className:Y("absolute top-48 right-0! bottom-0 left-0!","invisible"),ref:d}),t.jsx("div",{className:Y("absolute right-0! bottom-0 left-0! h-px","invisible"),ref:h}),n,e||r?null:t.jsx(Cn,{className:"mt-4 self-start",onClick:s,"data-testid":"paragen-prefer-response-button",children:t.jsx(X,{id:"U2EAH6",defaultMessage:"I prefer this response"})})]})})}var Sn;const pn=ws.div(Sn||(Sn=Ze(["text-sm text-token-text-secondary font-semibold"])));var Tn;const fn=ws.div(Tn||(Tn=Ze(["flex gap-4 items-center mb-1"])));function bn({clientThreadId:a,conversationTurnMountTime:s,turn:n,originalTurn:e}){var x,_,y,C,I,N;const r=En();if(!r.showParagenMetadata||!r.showDebugConversationTurns&&!r.forceParagen||n==null)return null;let g=n===e?"ORIGINAL":"NEW";const d=n.messages[n.messages.length-1],h=(x=d==null?void 0:d.metadata)==null?void 0:x.__internal,u=(_=d==null?void 0:d.metadata)==null?void 0:_.paragen_display_label;if(h){const{model_id:ie,model_definition_slug:Z,model_definition_virtual_model_id:ne,alternative_model_selection_rule:O,augmented_paragen_prompt_group_id:D,augmented_paragen_prompt_id:E,augmented_paragen_prompt:k}=h;ie&&(g+="\nModel ID: ".concat(ie)),Z&&(g+="\nModel Slug: ".concat(Z)),ne&&(g+="\nVirtual Model ID: ".concat(ne)),O&&(g+="\nAlternative Model Rule: ".concat(O)),D&&(g+="\nPrompt Group ID: ".concat(D)),E&&(g+="\nPrompt ID: ".concat(E)),k&&(g+="\nPrompt: ".concat(k)),u&&(g+="\nDisplay Label: ".concat(u))}g+="\nMessage ID: ".concat(d.id);const v=G.getParentPromptNode(ns(a),n.messages[0].id);if(!v)throw new Error("Expected prompt for side by side feedback");const m=((y=v.message.clientMetadata)==null?void 0:y.variantsInStreamInfo)==null&&((C=v.message.metadata)==null?void 0:C.paragen_variants_info)!=null;return g+="\nUser prompt message ID: ".concat(v.message.id),g+="\nIs Persisted Paragen? ".concat(m),g+="\nCompletion Sample Finish Time: ".concat(m?"".concat(s," (persisted)"):(N=(I=T(n.messages))==null?void 0:I.clientMetadata)==null?void 0:N.completionSampleFinishTime),t.jsx("div",{className:"text-sm whitespace-pre-wrap text-red-500",children:g})}async function xn({params:a}){await mo.safePost("/paragen_submission",{requestBody:a,authOption:go.SendIfAvailable})}const vn=wn({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}{display_label}"}}),Sr=Ue(()=>Ge(()=>import("./jz33sxazob8nvrz7.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(a=>a.MemoryActionResult)),Tr=Ue(()=>Ge(()=>import("./d3fvcsvcifg627w1.js"),__vite__mapDeps([9,2,1,3,10,4,5,11])).then(a=>a.AutomationSourceHeader)),_n=Ue(()=>Ge(()=>import("./iz4ncq3w9yqnlqea.js"),__vite__mapDeps([12,2,1,3,4,5,13])).then(a=>a.TextMessageEditor)),yr=Ue(()=>Ge(()=>import("./dz63jikeem6urs0m.js"),__vite__mapDeps([14,2,1,3,4,5,15])).then(a=>a.ChatScreenRetrievalResultsFlyoutContent)),In=80,Ss=16;function ys(){return{minHeight:"calc(100dvh - ".concat(cr,"px - 120px)")}}function wr(a){"use forget";var lt,ct,dt,ut,mt,gt,ht,pt,ft,bt,xt,vt,_t,It,St,Tt,yt,wt,jt,Ct,Et,kt,Mt,At,Rt,Pt,Ft,Nt,Dt;const{turnIndex:s,isFinalTurn:n,clientThreadId:e,onRequestCompletion:r,currentModelId:g,scrollToMessageId:d,dateHeaderType:h,hideUserActions:u,disableHorizontalPadding:v}=a,m=Ve(),x=Xt(m,e),_=ai(m),y=ho(),[C,I,N]=kn(o=>[po(o),Mn(o),An(o)]),ie=!!y&&fo(y),Z=bo(xo.isBusinessWorkspace),ne=oi(),O=ii(),D=ri(),E=lr(),{eligible:k}=li(ci.hasSeenAudioParagenPrompt),[p,z,V]=Ce(e,o=>{const l=G.getConversationTurnAtIndex(o,s),f=s>0?G.getConversationTurnAtIndex(o,s-1):null,b=(f==null?void 0:f.role)===$.User&&f.messages.some(L=>{var J;return(J=L.metadata)==null?void 0:J.visually_hide_response_from_conversation});return[l,b,f]},{disablePerfDetector:n}),{messages:R,messageGroups:P}=p,M=di(o=>o.size===0?-1:P.findIndex(l=>l.type===_s?l.groups.some(f=>f.messages.some(b=>o.has(b==null?void 0:b.id))):l.messages.some(f=>o.has(f==null?void 0:f.id)))),W=R[0],i=T(R),A=c.useMemo(()=>P.some(o=>o.type===vo.SearchGPTQuery),[P]),F=c.useMemo(()=>R.some(o=>{var l;return(l=o.metadata)==null?void 0:l.n7jupd_message}),[R]),K=c.useMemo(()=>F?_o(R,o=>o.author.name==="n7jupd.metadata"):null,[R,F]),ae=!!((lt=K==null?void 0:K.metadata)!=null&&lt.kaur1br5_mode),{messages:j,visibleMessages:ce,messageGroups:de,lastMessageToRender:S}=c.useMemo(()=>{const o=M!==-1&&M+1<P.length,l=o?P.slice(0,M+1):P,f=o?l.flatMap(b=>b.type===_s?b.groups.flatMap(L=>L.messages):b.messages):R;return{messages:f,visibleMessages:f.filter(Io),messageGroups:l,lastMessageToRender:T(f)}},[R,P,M]),H=M!==-1,ue=we(m,"1887864177"),Q=Ce(e,o=>G.getLastMessageSystemHints(o)),q=(Q==null?void 0:Q.includes(Fe.Tatertot))&&we(m,"28816792")&&So(m),{capabilitySuggestionsEnabled:pe}=ui(q),me=c.useMemo(()=>({clientThreadId:e,turnIndex:s,messageId:i==null?void 0:i.id}),[e,s,i==null?void 0:i.id]),[Ee,ks]=c.useState(!1),[Ms,Hn]=c.useState(!1),Ln=c.useContext(mi)!=null,U=p.role===$.User,os=To(),fe=yo(e),is=(ct=p.gizmoId)!=null?ct:fe,be=wo(is).data,rs=is&&!jo(is)?be:void 0,Bn=rs&&p.gizmoId!=null&&p.gizmoId!==fe&&we(m,"1418300125"),ls=Co(e),Wn=Eo(e),Oe=ko(ls),qn=Mo(ls,Wn),cs=Ao(),[xe,$n,zn,As,ds,Kn,He,Qn,Jn,Rs,us,re,Le,Be,Xn,Se,w]=Ce(e,o=>{var Ut,Gt,Vt,Ot;const l=G.getParentPromptNode(o,W.id),f=(Ot=(Ut=l==null?void 0:l.message.clientMetadata)==null?void 0:Ut.variantsInStreamInfo)!=null?Ot:(Gt=l==null?void 0:l.message.metadata)!=null&&Gt.paragen_variant_choice||(Vt=l==null?void 0:l.message.metadata)==null?void 0:Vt.paragen_variants_info,b=G.getVariantIds(o,W.id),L=G.getCurrentVariantId(o,W.id),J=L?b.indexOf(L):0,Ie=f&&(o==null?void 0:o.tree)!=null&&b.some(te=>{var Lt;const{errType:Ht}=(Lt=o.tree.getLeafFromNode(te).message.clientMetadata)!=null?Lt:{};return Ht!=null&&Ht!=="info"}),se=G.getConversationTurns(o),Re=se.findIndex(te=>te.role===$.Assistant),eo=dn(se,te=>te.role===$.Assistant),so=se.slice(Re,s+1).every(te=>te.role===$.Assistant);return[l,i!=null&&!Jo(i.id)&&G.isMessageTurnEnded(o,i.id),Ie,dr(o==null?void 0:o.mode,be==null?void 0:be.gizmo.id),se.findIndex(te=>te.role===$.User)===s,dn(se,te=>te.role===$.User)===s,Re===s,eo===s,so,G.getRequestId(o,i==null?void 0:i.id),f,b,J,!!(o!=null&&o.continuingFromSharedPostId),o==null?void 0:o.currentLeafId,G.getSuperWidgetMessages(o,s)[0],G.lastUserMessage(o)]},{disablePerfDetector:n}),We=gi(),qe=as(()=>{const o=hi(x);return(o==null?void 0:o.value)===es.STREAMING||(o==null?void 0:o.value)===es.REALTIME}),Yn=j.some(o=>o.content.content_type===Ro.MultimodalText),Zn=Po(m,"3119715334").get("should-enable-skip",!1),{isUnauthenticated:Ps}=Fo(),Fs=p.messages.map(o=>o.id),ee=c.useRef(null);jr({clientThreadId:e,turn:p,turnIndex:s,conversationTurnWrapperRef:ee});const Ns=!_&&((dt=d==null?void 0:d.length)!=null?dt:0)>2&&d!=="finalAgentTurn"&&n&&E,Te=U?T(ce):void 0,ms=Te==null?void 0:Te.id,ea=c.useCallback(()=>{ms&&(Is.logEvent("Edit Prompt",{id:ms,threadId:Ne(e)}),No(m,"chatgpt_edit_prompt"),ks(!0))},[m,ms,e]),sa=c.useCallback(()=>{ks(!1)},[]),{hasConnections:Ds}=Do(),{onChangeRating:ta}=pi({clientThreadId:e,currentModelConfig:ls}),na=o=>{var L;if(!i)return;const l=(L=i.clientMetadata)==null?void 0:L.rating,b=(l==="thumbs_up"?"thumbsUp":l==="thumbs_down"?"thumbsDown":l)===o?null:o;if(ta({nodeId:i.id,messageId:i.id,rating:b}),b){const J=Ds&&P.some(Ie=>{var se;return Ie.type!==_s&&((se=Ie.messages)==null?void 0:se.some(Qo))});Is.logEventWithStatsig(b==="thumbsDown"?"Message Feedback Thumbs Down Clicked":"Message Feedback Thumbs Up Clicked","chatgpt_thumb_feedback",B(B({id:i.id,threadId:Ne(e),model:g,rating:b},Ds?{isCATriggered:J}:{}),I?{isSidebar:!0}:{}))}Hn(b==="thumbsDown")},[aa]=c.useState(()=>Date.now()),Us=Uo(e),Gs=(ut=fi(e))==null?void 0:ut.value,oa=Gs===es.STREAMING,ia=Gs===es.REALTIME,ra=Rs!=null,la=Rn(Rs),ca=an.useState(o=>an.isReplayInProgress(o,Xn)),oe=!$n&&la||H||ia||ca&&n,Vs=Pn(),gs=c.useRef(!1),Os=c.useRef(void 0),da=Go({clientThreadId:e}),ua=bi(e,i)&&!da,[,ma]=oo(),{isOpen:$e}=on(),Hs=Vo(),ye=T(V==null?void 0:V.messages.filter(Oo)),hs=xi({clientThreadId:e,threadContent:(mt=Se==null?void 0:Se.content)!=null?mt:null,query:ye?ts(ye):null,triggeredSearch:A,messageGroups:de,allMessages:R}),Ls=Cs(m)&&He&&(!Q||Q.length===0||Q.includes(Fe.Search)),ge=Ls&&hs.showNavlinksWidget,{onMountNavlinks:Bs}=vi(m);c.useEffect(()=>{ge&&Bs()},[Bs,ge]);const Ws=j.filter(Yt),ga=ge&&Ws.length===0&&!F,qs=((gt=w==null?void 0:w.author.metadata)==null?void 0:gt.real_author)==="onboarding",$s=N&&He&&ge&&hs.showLongList;c.useEffect(()=>{const l=new URLSearchParams(window.location.search).get("message");!(l!=null&&Fs.includes(l))||!ee.current||(ee.current.scrollIntoView({behavior:"instant"}),ma(b=>(b.delete("message"),b),{replace:!0,preventScrollReset:!0}))},[]),c.useEffect(()=>{d!==Os.current&&(gs.current=!1,Os.current=d)},[d]),c.useEffect(()=>{if(_)return;const f=new URLSearchParams(window.location.search).get("message")!=null;if(gs.current||f||d===void 0||!E||!ee.current||Hs||qs||$s){d==="finalAgentTurn"&&n&&he(e,b=>{b.scrollToMessageId=void 0});return}(Fs.includes(d)||d==="finalAgentTurn"&&n)&&(gs.current=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(ee.current)if(d==="finalAgentTurn"&&n)ee.current.scrollIntoView({behavior:"instant",block:"end"}),he(e,b=>{b.scrollToMessageId=void 0});else{const b=ee.current.offsetHeight;let L=0;$e?L=-8:N?L=-1*Ss:b>In&&(L=In-b);const J=_i(Xt(m,e)).pinnedWidgetHeight$();J!=null&&(L+=J+Ss),ee.current.style.scrollMarginTop="".concat(L+Ss,"px"),ee.current.scrollIntoView({behavior:"smooth"})}})}))},[d,ee.current,$e,Hs,qs,$s]);const{showDebugConversationTurns:ha}=En(),pa=!We&&!Be&&!os&&!U,fa=(S==null?void 0:S.author.role)===$.Assistant?S:null,ba=(pt=(ht=S==null?void 0:S.metadata)==null?void 0:ht.system_hints)==null?void 0:pt.includes(Fe.Research),xa=(bt=(ft=S==null?void 0:S.metadata)==null?void 0:ft.system_hints)==null?void 0:bt.includes(Fe.Agent);Ii({isCompletionRequestInProgress:oe,isUserTurn:U,message:fa});const{isOpen:va}=on(),_a=Si(),ze=Ti(As),Ia=Ho(o=>o.voiceFeedbackThread),zs=Us===Ia,Sa=(xt=i==null?void 0:i.metadata)==null?void 0:xt.async_source,Ke=n&&ra,ve=qe||oe||oa,Ks=ce.length===0&&j.some(Lo),Qe=!Ee&&!Ks&&!We&&!Be&&!ze&&!va&&p.role!==$.Developer&&!(p.role===$.User&&u)&&!(n&&zs&&ve)&&!(Ke&&ve)&&!(n&&qe&&Sa)&&!(ve&&F)&&!((vt=i==null?void 0:i.metadata)!=null&&vt.is_auto_proceed_message)&&!((_t=i==null?void 0:i.metadata)!=null&&_t.is_takeover_ended_message)&&!ga,Ta=!Qe&&!(Ke&&ve)&&(We||Be)&&!I,ya=j.some(o=>Bo(o)===Wo.l1239dk1),ps=Ce(e,o=>{var b,L;const l=new Set,f=G.getParentPromptNode(o,W.id);return(L=(b=f==null?void 0:f.message.metadata)==null?void 0:b.attachments)==null||L.forEach(J=>{var Ie,se,Re;(Ie=J.mime_type)!=null&&Ie.startsWith("image/")||l.add((Re=(se=J.context_connector_info)==null?void 0:se.context_connector)!=null?Re:"file")}),l}),fs=qo(),bs=Zt(m,"110789670");let _e;fs.isLoading?_e=void 0:fs.canUpgradeGDrive&&ps.has(ss.GDRIVE)&&bs.get("enabled",!1)?_e=ss.GDRIVE:fs.canUpgradeSharepoint&&ps.has(ss.O365_BUSINESS)&&bs.get("enabled",!1)?_e=ss.O365_BUSINESS:ps.has("file")&&bs.get("enabled",!1)&&(_e="general");const wa=Ke&&!oe&&!I&&!We&&!Be&&!ya&&(ue||yi(m)||pe||q||!!_e),ke=i!=null&&(!Z||qn||ie||cs)&&!ze&&!Ps&&!os&&!((It=i.metadata)!=null&&It.b1de6e2_s),Qs=qe||oe,[ja,Ca]=c.useState(!1),Ea=!!((St=w==null?void 0:w.metadata)!=null&&St.dictation&&((Tt=w==null?void 0:w.metadata)!=null&&Tt.dictation_asset_pointer)&&!((yt=w==null?void 0:w.metadata)!=null&&yt.dictation_edited)),ka=!!(!k||ja||(wt=w==null?void 0:w.metadata)!=null&&wt.audio_paragen_result||rn(w==null?void 0:w.id)),Js=Ea&&!ka,Xs=Js&&(!Z||cs)&&ke&&!Qs&&!I&&!$e&&w!=null&&He&&we(m,"51772912"),Ma=wi(w==null?void 0:w.id,Xs),Ys=Xs&&Ma,Je=!ze&&pa&&n&&(us==null?void 0:us.num_variants_in_stream)===2&&re.length<=2&&!((jt=i==null?void 0:i.clientMetadata)!=null&&jt.inlineComparisonRating)&&!zn&&!Js&&!rn(w==null?void 0:w.id),Zs=!Ys&&(!Z||cs)&&ke&&(Ke||n&&zs)&&!Qs&&!I&&!$e&&!F,et=!((oe||qe)&&n)&&re.length>1&&!Je,st=U&&j.some(o=>{var l;return(l=ln(o))==null?void 0:l.shouldHideContent}),Aa=U&&Te!=null&&Us!=null&&!ze&&!Yn&&!st&&!Ps&&!ba&&!xa&&!I,Ra=i!=null&&en.getAudioAssetPointers(i).length>0,Pa=i!=null&&((Et=(Ct=i.clientMetadata)==null?void 0:Ct.disclaimers)!=null?Et:[]).length===0&&!I&&(!os||Ra),Fa=$o(m)&&Ls,tt=c.useCallback(o=>{var l;he(e,f=>{js.setCurrentBranch(f,re[o])}),Is.logEvent("Change Active Node",{intent:"toggle_between"}),we(m,"4126691920")&&ji({parent_prompt_id:(l=xe==null?void 0:xe.id)!=null?l:"",prev_branch_id:re[Le],next_branch_id:re[o]},Ne(e))},[e,re,Le,xe==null?void 0:xe.id,m]),Na=Ci(p,j,ha),Da=F&&Ei(j,n),{toggleThreadSidebar:nt}=zo(),Xe=i==null?void 0:i.id,at=c.useCallback(()=>{Xe&&nt({type:"retrievalResults",clientThreadId:e,turnIndex:s,messageId:Xe})},[Xe,nt,e,s]),Me=!1,ot=c.useMemo(()=>ki(p,Oe,!!fe),[p,Oe,fe]),Ua=c.useMemo(()=>ot&&!Me,[ot,Me]),Ga=c.useMemo(()=>Mi(p,!!fe,O),[O,fe,p]),it=we(m,"2137702454"),Va=c.useMemo(()=>p.role!==$.User&&Oe&&(it||Me),[p,Oe,it,Me]),Oa=Ko()&&CSS.supports("content-visibility: auto")&&!U&&Zt(m,"1011775750").get("enabled",!1)&&!Ai(j),Ha=c.useMemo(()=>j.some(o=>{var l;return((l=ln(o))==null?void 0:l.canRetry)===!1}),[j]),La=(kt=i==null?void 0:i.metadata)==null?void 0:kt.n7jupd_button_type,Ba=F&&i!=null&&i.id!=null&&!La,Wa=F&&n&&ve,qa=F&&n;if(!Na&&!Je&&!ge)return Ns?t.jsx("div",{style:ys()}):null;if(Da||z)return null;const $a=(Mt=S==null?void 0:S.metadata)!=null&&Mt.followup_prompts?S.metadata.followup_prompts.map(o=>({text:o,type:Ri.Reply})):[],za=(At=S==null?void 0:S.metadata)==null?void 0:At.category_suggestions,Ka=(Rt=S==null?void 0:S.metadata)==null?void 0:Rt.action_suggestions,Qa=(Pt=S==null?void 0:S.metadata)==null?void 0:Pt.pineapple_tool_suggestions,Ja=!j.some(o=>en.getAudioAssetPointers(o).length>0)&&!fe&&!Ha,Xa=!oe&&j.some(o=>{var l,f;return o.author.role===$.Assistant&&((f=(l=o.metadata)==null?void 0:l.onboarding)==null?void 0:f.main_usages)}),xs=j.find(o=>{var l,f;return!!((f=(l=o.metadata)==null?void 0:l.onboarding)!=null&&f.examples)}),vs=(Nt=(Ft=xs==null?void 0:xs.metadata)==null?void 0:Ft.onboarding)==null?void 0:Nt.examples,rt=!st&&(!n||!oe);if(!n&&Ws.length===0&&!F&&!ge)return null;let Ae="none";U&&ds&&(Ae="first");const Ya=V==null?void 0:V.messages.some(Yt);U&&!ds&&(Ya?Ae="large":Ae="none"),n&&(Ae="last");const Za=(()=>{if(U&&!Qe&&Es(m)&&C)return"mb-4";if(U&&!Qe&&!I)return"mb-10";if(!U&&I&&n)return"pb-[40px]"})();return t.jsx(Pi.Provider,{value:He,children:t.jsxs(Fi,{children:[t.jsx(Ni,{dateHeaderType:h,turn:p}),t.jsxs("article",{className:Y("text-token-text-primary w-full focus:outline-none",Oa&&"[content-visibility:auto] supports-[content-visibility:auto]:[contain-intrinsic-size:auto_100lvh]",!_&&d==="finalAgentTurn"&&E?"opacity-0":"",{hidden:Ln&&ds},U?"scroll-mt-(--header-height)":"scroll-mt-[calc(var(--header-height)+min(200px,max(70px,20svh)))]"),tabIndex:-1,style:Ns?ys():void 0,ref:ee,dir:"auto","data-turn-id":p.id,"data-testid":"conversation-turn-".concat(s),"data-scroll-anchor":!_&&n,"data-turn":U?"user":"assistant",children:[t.jsx(Di,{role:p.role,gizmo:rs}),t.jsx(Ui,{role:p.role,children:t.jsxs(Gi,{horizontalPadding:Je||v?"none":"standard",verticalPadding:Ae,children:[Je?t.jsxs(t.Fragment,{children:[t.jsx(_r,B({isFeedbackEnabled:ke,variantIds:re,conversationTurnMountTime:aa},a)),Zn&&t.jsx("div",{className:"mt-4 flex w-full justify-center",children:t.jsxs(Cn,{color:"secondary",className:"text-token-text-primary","data-testid":"paragen-skip-button",onClick:()=>{jn.publish({kind:"requestCompletion",isForSkippingParagen:!0})},children:[t.jsx(Vi,{className:"text-token-text-secondary me-1"}),t.jsx(X,{id:"IuTr+b",defaultMessage:"Skip"})]})})]}):t.jsxs(Fn,{tabIndex:-1,className:Y("group/turn-messages focus-visible:outline-hidden",ge&&"super-widget-visible",Za,ar({isUserTurn:U})),children:[Bn&&t.jsx(Oi,{gizmo:rs}),ge&&t.jsx(Hi,{clientThreadId:e,query:ye?ts(ye):null,state:hs,className:"mb-4!"}),Va&&t.jsx(Li,{handleShowRetrievalResults:at,clientThreadId:e,turnIndex:s,responseComplete:!ve,className:"mb-6"}),!U&&t.jsx(Sr,{messages:j,clientThreadId:e,gizmoId:be==null?void 0:be.gizmo.id}),!U&&j.some(o=>{var l,f,b;return!!((b=(l=o.metadata)==null?void 0:l.async_task_message_label)!=null?b:(f=o.metadata)!=null&&f.async_completion_id)})&&t.jsx(Bi,{message:j.find(o=>{var l,f,b;return!!((b=(l=o.metadata)==null?void 0:l.async_task_message_label)!=null?b:(f=o.metadata)!=null&&f.async_completion_id)}),clientThreadId:e}),_a&&U&&t.jsx(Tr,{clientThreadId:e,messages:j}),Ee&&Te?t.jsx(_n,{message:Te,clientThreadId:e,onRequestCompletion:r,onExitEdit:sa,disabled:Vs}):t.jsx(Ts,le(B({allMessages:R,groupedMessagesToRender:de,allGroupedMessages:P},a),{isUserTurn:U,isFinalUserTurn:Kn,isFinalAssistantTurn:Qn,isWithinFirstAssistantTurns:Jn,isCompletionRequestInProgress:oe,isFeedbackEnabled:ke,isFinalTurn:n,isGlauxTurn:Me,hasActiveRequest:Vs,isAgentTurn:F,isKAUR1BR5:ae,query:ye?ts(ye):null,wasInterrupted:Ks,superWidgetImages:(Dt=Se==null?void 0:Se.content.widgets.images)!=null?Dt:null,lastAgentMetadataNode:K,hideSearchGPTQuery:Fa})),Ua&&(ne&&Ga?t.jsx(yr,{turnIndex:s,clientThreadId:e,variant:"bottom"}):t.jsx(Wi,{handleShowRetrievalResults:at,clientThreadId:e,turnIndex:s,responseComplete:!ve})),Ba&&t.jsx(qi,{message:i,clientThreadId:e,turnIndex:s,referenceMessageId:i.id,responseComplete:!n||!oe}),Xa&&t.jsx($i,{clientThreadId:e}),vs&&vs.length>0&&!oe&&t.jsx(zi,{clientThreadId:e,examples:vs}),Qe&&t.jsx(Ki,{isUserTurn:U,alwaysShow:!0,children:U?I?null:t.jsx(Qi,{activeVariantIndex:Le,clientThreadId:e,numVariants:re.length,onAnticipateEdit:_n.prefetch,onChangeIndex:tt,onEnterEdit:ea,showCopyButton:rt,showEditMessageButton:Aa,showPagination:et,turnIndex:s}):t.jsxs(t.Fragment,{children:[t.jsx(Ji,{activeVariantIndex:Le,clientThreadId:e,conversationMode:As,lastMessage:i,messages:j,numVariants:re.length,onChangeIndex:tt,onRate:na,showCanvasButton:ua,showCopyButton:rt,showPagination:et,showPlayButton:Pa,showRatingButtons:ke,showRegenerateButton:Ja,turn:p,turnIndex:s,parentPrompt:xe,isAgentTurn:F,isKAUR1BR5:ae}),t.jsx(t.Fragment,{children:!D&&t.jsx(cn,{clientThreadId:e,message:i,turnIndex:s})}),Zs&&t.jsx(Xi,{canShowInlineMessageFeedback:Ms,clientThreadId:e,messageForRating:i}),!1]})}),Wa&&t.jsx(Yi,{clientThreadId:e}),qa&&t.jsx(Zi,{clientThreadId:e,messages:j}),Ta&&t.jsx(cn,{clientThreadId:e,message:i,turnIndex:s}),Zs&&t.jsx(er,{canShowInlineMessageFeedback:Ms,clientThreadId:e,messageForRating:i,allGroupedMessages:P,currentModelId:g}),t.jsx(io,{mode:"wait",children:Ys&&t.jsx(sr,{lastUserMessageId:w.id,setIsDismissed:Ca})}),wa&&(_e?t.jsx(tr,{clientThreadId:e,connectorToUpsell:_e,analyticsMetadata:me}):t.jsx(nr,{followups:$a,actionSuggestions:Ka,pineappleToolSuggestions:Qa,categorySuggestions:za,clientThreadId:e,lastMessageId:Xe,analyticsMetadata:me,isTatertotFollowupsEnabled:q}))]}),t.jsx(or,{clientThreadId:e,turn:p,isFinalTurn:n}),t.jsx(ir,{clientThreadId:e,turn:p})]})})]})]})})}const jr=({clientThreadId:a,turn:s,turnIndex:n,conversationTurnWrapperRef:e})=>{const r=rr();c.useEffect(()=>{if(!r)return;const g=new IntersectionObserver(d=>{d.forEach(h=>{h.isIntersecting?he(a,u=>{var v;u.turnIdsInViewpoint=[...(v=u.turnIdsInViewpoint)!=null?v:[],{turnId:s.id,turnIndex:n,role:s.role}]}):he(a,u=>{var v;u.turnIdsInViewpoint=(v=u.turnIdsInViewpoint)==null?void 0:v.filter(({turnId:m})=>m!==s.id)})})},{root:null,threshold:.1});return e.current&&g.observe(e.current),()=>{he(a,d=>{var h;d.turnIdsInViewpoint=(h=d.turnIdsInViewpoint)==null?void 0:h.filter(({turnId:u})=>u!==s.id)}),g.disconnect()}},[a,e,r,s.id,s.role,n])},Hr=ao.memo(wr);function Lr(){const[a,s]=kn(r=>[An(r),Mn(r)]),n=ur(),e=mr();return a&&!s&&!n&&!e}function On(){const a=Ve(),s=as(()=>Nn());return typeof s=="boolean"?s:Xo(a,"694761886").get("news_tab_enabled",!0)}function Br({className:a,textClassName:s}){const n=Ve(),e=Es(n),r=as(()=>De()),g=On(),d=Yo.useStore(),h=Zo(),u=Cs(n);c.useEffect(()=>{!g&&r==="news"&&De.set("answer")},[g,r]);function v(m){if(De.set(m),m!=="answer"){const x=d.getActiveSystemHintType();x&&x!==Fe.Search&&h(null)}}return u?e?t.jsx(fr,{selectedTab:r,selectTab:v,className:a,textClassName:s,showNewsTab:g}):t.jsxs("div",{className:Y("flex gap-8.5",a),children:[t.jsx(Pe,{className:s,$selected:r==="answer",onClick:()=>v("answer"),children:t.jsx(X,B({},je.chatTab))}),t.jsx(Pe,{className:s,$selected:r==="web",onClick:()=>v("web"),children:t.jsx(X,B({},je.linksTab))}),t.jsx(Pe,{className:s,$selected:r==="images",onClick:()=>v("images"),children:t.jsx(X,B({},je.imagesTab))}),t.jsx(Pe,{className:s,$selected:r==="videos",onClick:()=>v("videos"),children:t.jsx(X,B({},je.videosTab))}),g&&t.jsx(Pe,{className:s,$selected:r==="news",onClick:()=>v("news"),children:t.jsx(X,B({},je.newsTab))})]}):null}var yn;const Pe=ws.button(yn||(yn=Ze(["\n  ","\n"])),({$selected:a})=>a?"text-token-text-primary font-medium":"text-token-text-tertiary hover:text-token-text-secondary"),Cr={answer:()=>null,web:pr,images:Gn,videos:Un,news:Dn},Er={answer:()=>null,web:hr,images:Gn,videos:Un,news:Dn};function kr({userMessages:a,superWidgetMessageContents:s,tab:n,scrollToMessageId:e,isNewsTabEnabled:r}){"use forget";const g=Ve(),d=c.useRef({});function h(x,_="smooth"){const y=d.current[x];y&&y.scrollIntoView({behavior:_,block:"start"})}if(c.useEffect(()=>{requestAnimationFrame(()=>{if(a.length>0){const x=a[a.length-1];x&&h(x.id,"instant")}})},[]),c.useEffect(()=>{setTimeout(()=>{e&&h(e)},50)},[e]),n==="news"&&!r)return null;const u=Es(g),v=u?Er[n]:Cr[n],m=n==="web"||n==="videos"||n==="news";return t.jsx("div",{className:Y("flex w-full flex-col pt-2",u&&"thread-sm:px-2 px-4",m?"gap-4":"gap-10"),children:gr(a.length,x=>{var y,C,I;let _=null;return x===0?_=ts(a[x]):_=(I=(C=(y=s[x])==null?void 0:y.widgets)==null?void 0:C.query)!=null?I:null,t.jsxs("div",{className:"w-full",children:[x>0&&t.jsx("hr",{className:Y("border-heavy w-full",u?"pb-4.5":"pb-1.5")}),t.jsx("div",{className:Y(u?m?"mb-4":"mb-6":m?"mb-2.5":"mb-6","flex items-center text-base",u?"scroll-mt-6":"scroll-mt-4",x>0&&"mt-2.5"),ref:N=>{d.current[a[x].id]=N},children:t.jsx(Mr,{queryText:_,tab:n,isKirklandEnabled:u})}),s[x]?t.jsx(v,{content:s[x],turnIndex:x}):t.jsx("div",{style:ys(),children:t.jsx("div",{className:"result-streaming pulse",children:t.jsx("span",{})})})]},x)})})}function Mr(a){"use forget";const s=ro.c(11),{queryText:n,tab:e,isKirklandEnabled:r}=a;if(!n)return null;if(r){let d;s[0]!==n||s[1]!==e?(d=br(n,e),s[0]=n,s[1]=e,s[2]=d):d=s[2];let h;s[3]!==d?(h=t.jsx(xr,{href:d}),s[3]=d,s[4]=h):h=s[4];let u;return s[5]!==n||s[6]!==h||s[7]!==e?(u=t.jsx(vr,{queryText:n,tabType:e,searchIt:h}),s[5]=n,s[6]=h,s[7]=e,s[8]=u):u=s[8],u}let g;return s[9]!==n?(g=t.jsx("div",{dir:"auto",className:"text-token-text-tertiary flex max-w-[var(--user-chat-width,70%)] min-w-0 text-start text-sm",children:t.jsx(X,le(B({},je.resultsFor),{values:{prefix:Rr,query:t.jsx("span",{className:"min-w-0 flex-1 truncate",children:n}),trailingQuote:Ar}}))}),s[9]=n,s[10]=g):g=s[10],g}function Ar(a){return t.jsx("span",{"aria-hidden":"true",className:"shrink-0",children:a})}function Rr(a){return t.jsx("span",{className:"shrink-0",children:a})}function Wr({clientThreadId:a,children:s}){var m,x;const n=Ve(),e=as(()=>De()),r=On(),[g,d,h]=Ce(a,_=>[G.getUserMessages(_).filter(y=>{var C;return!((C=y.metadata)!=null&&C.is_visually_hidden_from_conversation)}),G.getSuperWidgetMessages(_),_==null?void 0:_.scrollToMessageId]),u=d[d.length-1],v=(x=(m=u==null?void 0:u.content)==null?void 0:m.widgets)==null?void 0:x.news_tab_enabled;return c.useEffect(()=>{Nn.set(typeof v=="boolean"?v:void 0)},[v]),c.useEffect(()=>{!r&&e==="news"&&De.set("answer")},[r,e]),Cs(n)?t.jsxs("div",{children:[t.jsx("div",{id:"mini-chat-content",className:e==="answer"?"block":"hidden",children:s}),t.jsx(Fn,{children:e!=="answer"&&(e!=="news"||r)&&t.jsx(kr,{userMessages:g,superWidgetMessageContents:d.map(_=>_.content),tab:e,scrollToMessageId:h,isNewsTabEnabled:r},e)})]}):s}const je=wn({chatTab:{id:"CSsJbp",defaultMessage:"Chat"},linksTab:{id:"U43uU/",defaultMessage:"Links"},imagesTab:{id:"ZY9oIP",defaultMessage:"Images"},videosTab:{id:"C8mH8+",defaultMessage:"Videos"},newsTab:{id:"RxIkHj",defaultMessage:"News"},resultsFor:{id:"V5ZXix",defaultMessage:"<prefix>Results for “</prefix>{query}<trailingQuote>”</trailingQuote>"}});export{Hr as C,Br as S,Wr as a,Lr as u};
//# sourceMappingURL=xx3svpq6qe4q5uu1.js.map
