var b=Object.defineProperty,w=Object.defineProperties;var C=Object.getOwnPropertyDescriptors;var m=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var v=(n,r,e)=>r in n?b(n,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[r]=e,x=(n,r)=>{for(var e in r||(r={}))R.call(r,e)&&v(n,e,r[e]);if(m)for(var e of m(r))$.call(r,e)&&v(n,e,r[e]);return n},T=(n,r)=>w(n,C(r));import{qq as P,qr as k,qs as O,qt as A,hF as S,qu as B}from"./lef5ym39glv4981l.js";import{N as h}from"./g2yrrlnprx92uhjb.js";class I extends h{unistNodeName(){return"text"}static proseMirrorNodeName(){return"text"}proseMirrorNodeSpec(){return{group:"inline"}}unistNodeToProseMirrorNodes({node:r,schema:e,attrs:t}){return P(r,e,t)}proseMirrorNodeToUnistNodes(r){var e;return[{type:this.unistNodeName(),value:(e=r.text)!=null?e:""}]}}class p{constructor(r,e,t={}){this.match=r,this.match=r,this.handler=typeof e=="string"?q(e):e,this.undoable=t.undoable!==!1,this.inCode=t.inCode||!1}}function q(n){return function(r,e,t,s){let o=n;if(e[1]){let i=e[0].lastIndexOf(e[1]);o+=e[0].slice(i+e[1].length),t+=i;let l=t-s;l>0&&(o=e[0].slice(i-l,i)+o,t=s)}return r.tr.insertText(o,t,s)}}const D=500;function W({rules:n}){let r=new k({state:{init(){return null},apply(e,t){let s=e.getMeta(this);return s||(e.selectionSet||e.docChanged?null:t)}},props:{handleTextInput(e,t,s,o){return y(e,t,s,o,n,r)},handleDOMEvents:{compositionend:e=>{setTimeout(()=>{let{$cursor:t}=e.state.selection;t&&y(e,t.pos,t.pos,"",n,r)})}}},isInputRules:!0});return r}function y(n,r,e,t,s,o){if(n.composing)return!1;let i=n.state,l=i.doc.resolve(r),d=l.parent.textBetween(Math.max(0,l.parentOffset-D),l.parentOffset,null,"￼")+t;for(let a=0;a<s.length;a++){let u=s[a];if(l.parent.type.spec.code){if(!u.inCode)continue}else if(u.inCode==="only")continue;let c=u.match.exec(d),f=c&&u.handler(i,c,r-(c[0].length-t.length),e);if(f)return u.undoable&&f.setMeta(o,{transform:f,from:r,to:e,text:t}),n.dispatch(f),!0}return!1}new p(/--$/,"—");new p(/\.\.\.$/,"…");new p(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(")$/,"“");new p(/"$/,"”");new p(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(')$/,"‘");new p(/'$/,"’");function J(n,r,e=null,t){return new p(n,(s,o,i,l)=>{let d=e instanceof Function?e(o):e,a=s.tr.delete(i,l),u=a.doc.resolve(i),c=u.blockRange(),f=c&&O(c,r,d);if(!f)return null;a.wrap(c,f);let g=a.doc.resolve(i-1).nodeBefore;return g&&g.type==r&&A(a.doc,i-1)&&(!t||t(o,g))&&a.join(i-1),a})}function E(n,r,e=null){return new p(n,(t,s,o,i)=>{let l=t.doc.resolve(o),d=e instanceof Function?e(s):e;return l.node(-1).canReplaceWith(l.index(-1),l.indexAfter(-1),r)?t.tr.delete(o,i).setBlockType(o,o,r,d):null})}function M(n,r,e,t={}){if(n==null)return null;const s=(Array.isArray(e)?e:[e]).filter(S),o=r.nodes[n].createAndFill(t,s);return o==null?null:o}const L={content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM(){return["p",0]}},U="paragraph";class F extends h{unistNodeName(){return U}static proseMirrorNodeName(){return"paragraph"}proseMirrorNodeSpec(){return L}unistNodeToProseMirrorNodes({schema:r,convertedChildren:e,attrs:t}){return M(this.proseMirrorNodeName(),r,e,t)}proseMirrorNodeToUnistNodes(r,e){return[{type:this.unistNodeName(),children:e}]}}class N extends h{static isAtStart(r,e){return r.selection.empty?e!==void 0?e.endOfTextblock("backward",r):r.selection.$anchor.parentOffset>0:!1}static headingLevelCommandBuilder(r,e,t){return(s,o,i)=>{if(t&&!N.isAtStart(s,i))return!1;const{$anchor:l}=s.selection,d=l.parent;if(d.type.name!=="heading")return!1;const a=d.attrs.level+e;if(a<0||a>6)return!1;if(o===void 0)return!0;const u=l.before(l.depth);return a>0?o(s.tr.setNodeMarkup(u,void 0,{level:a})):o(s.tr.setNodeMarkup(u,r.nodes.paragraph)),!0}}dependencies(){return[new F,new I]}unistNodeName(){return"heading"}static proseMirrorNodeName(){return"heading"}proseMirrorNodeSpec(){return{attrs:{level:{default:1}},content:"text*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM(r){return["h"+r.attrs.level.toString(),0]}}}proseMirrorInputRules(r){return[E(/^\s{0,3}(#{1,6})\s$/,r.nodes[this.proseMirrorNodeName()],e=>({level:e[1].length}))]}proseMirrorKeymap(r){const e={Tab:N.headingLevelCommandBuilder(r,1,!1),"#":N.headingLevelCommandBuilder(r,1,!0),"Shift-Tab":N.headingLevelCommandBuilder(r,-1,!1)};for(let t=1;t<=6;t++)e["Shift-Mod-".concat(t.toString())]=B(r.nodes[this.proseMirrorNodeName()],{level:t});return e}unistNodeToProseMirrorNodes({node:r,schema:e,convertedChildren:t,attrs:s}){const{depth:o}=r;return M(this.proseMirrorNodeName(),e,t,T(x({},s),{level:o}))}proseMirrorNodeToUnistNodes(r,e){return[{type:this.unistNodeName(),depth:r.attrs.level,children:e}]}}class K extends h{unistNodeName(){return"root"}static proseMirrorNodeName(){return"doc"}proseMirrorNodeSpec(){return{content:"block+"}}unistNodeToProseMirrorNodes({schema:r,convertedChildren:e,attrs:t}){return M(this.proseMirrorNodeName(),r,e,t)}proseMirrorNodeToUnistNodes(r,e){return[{type:this.unistNodeName(),children:e}]}}export{N as H,p as I,F as P,K as R,I as T,L as a,U as b,M as c,W as i,E as t,J as w};
//# sourceMappingURL=em4qf21fn7t7dhqg.js.map
