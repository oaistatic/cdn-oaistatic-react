var y=Object.freeze,M=Object.defineProperty;var m=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable;var E=(e,t,s)=>t in e?M(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,T=(e,t)=>{for(var s in t||(t={}))j.call(t,s)&&E(e,s,t[s]);if(m)for(var s of m(t))k.call(t,s)&&E(e,s,t[s]);return e};var N=(e,t)=>{var s={};for(var a in e)j.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(e!=null&&m)for(var a of m(e))t.indexOf(a)<0&&k.call(e,a)&&(s[a]=e[a]);return s};var P=(e,t)=>y(M(e,"raw",{value:y(t||e.slice())}));import{r as i,j as r,M as w}from"./jj85rqzpbnvv3emr.js";import{bo as U,cM as V,gG as O,bJ as Q,bI as W,pB as $,bD as X,dl as Y,P as v,bM as Z,bQ as q,bK as ee,iG as te,B as A,F as se,bP as ne}from"./lef5ym39glv4981l.js";import{hv as ae,hw as re,hx as oe}from"./mclphevd122040jw.js";import{E as ce}from"./fe7euoed9h00rh41.js";function ie({initialText:e,clientThreadId:t,currentLeaf:s,onExitEdit:a,onRequestCompletion:d,disabled:H,attachments:l}){const[g,I]=i.useState(e!=null?e:""),f=i.useRef(null),F=U(),S=V.useStore(),p=g.trim()==="",b=O(),G=i.useCallback(n=>{I(n.currentTarget.value)},[]),h=i.useCallback(n=>{if(p)return;const o={},c=ae();l&&(o.attachments=l),c&&(o.__internal={search_settings:c});const C=S.getActiveSystemHintType(),{systemHints:L,extraStreamParams:R}=re(C?[C]:[]),u=Q(t),z=W.getParentNode(u,s).message.id,{composerThinkingEffort$:D}=$(b),J=X(D);d({sourceEvent:n,parentMessageId:z,promptMessage:Y(g,Object.keys(o).length>0?o:void 0),extraStreamParams:R,completionMetadata:{conversationMode:u==null?void 0:u.mode,systemHints:L},thinkingEffort:J}),a(),v.logEvent("Change Active Node",{intent:"edit_save"})},[p,l,t,S,d,a,s,g,b]),x=i.useCallback(()=>{Z(t,n=>{q.setCurrentBranch(n,s)}),v.logEvent("Change Active Node",{intent:"edit_cancel"}),a(),v.logEvent("Cancel Edit Prompt",{threadId:ee(t)})},[s,a,t]);i.useEffect(()=>{const n=f.current;if(n){n.focus();const o=n.value.length;n.setSelectionRange(o,o)}},[]),i.useEffect(()=>{const n=f.current,o=c=>{c.isComposing||(c.key==="Enter"&&c.metaKey?h(c):c.key==="Escape"&&x())};return n&&n.addEventListener("keydown",o),()=>{n&&n.removeEventListener("keydown",o)}},[x,h]);const B=l&&l.length>0&&r.jsx(le,{children:l.map(n=>r.jsx(oe,{width:F?"wide":"normal",file:n.name,contextConnectorInfo:te(n.context_connector_info)},n.id))}),K=r.jsx("div",{className:"m-2 max-h-[25dvh] overflow-auto",children:r.jsx(ce,{ref:f,value:g,onChange:G,className:"m-0 w-full resize-none border-0 bg-transparent focus:ring-0 focus-visible:ring-0"})});return r.jsxs("div",{className:"bg-token-main-surface-tertiary rounded-3xl px-3 py-3",children:[B,K,r.jsxs("div",{className:"flex justify-end gap-2",children:[r.jsx(A,{as:"button",color:"secondary",onClick:x,children:r.jsx(w,{id:"D9gbPp",defaultMessage:"Cancel"})}),r.jsx(A,{as:"button",onClick:h,disabled:H||p,children:r.jsx(w,{id:"KGxIJG",defaultMessage:"Send"})})]})]})}var _;const le=se.div(_||(_=P(["flex gap-2 flex-wrap"])));function xe(s){var a=s,{message:e}=a,t=N(a,["message"]);var d;return r.jsx(ie,T({currentLeaf:e.id,initialText:ne(e),attachments:(d=e.metadata)==null?void 0:d.attachments},t))}export{xe as TextMessageEditor};
//# sourceMappingURL=iz4ncq3w9yqnlqea.js.map
