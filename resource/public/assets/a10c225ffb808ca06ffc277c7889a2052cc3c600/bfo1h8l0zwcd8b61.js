var re=Object.defineProperty,ae=Object.defineProperties;var ce=Object.getOwnPropertyDescriptors;var H=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var $=(t,e,n)=>e in t?re(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,M=(t,e)=>{for(var n in e||(e={}))K.call(e,n)&&$(t,n,e[n]);if(H)for(var n of H(e))Z.call(e,n)&&$(t,n,e[n]);return t},O=(t,e)=>ae(t,ce(e));var Q=(t,e)=>{var n={};for(var i in t)K.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&H)for(var i of H(t))e.indexOf(i)<0&&Z.call(t,i)&&(n[i]=t[i]);return n};import{d as J,v as de,c as ee,j as g,M as R,b as le,r as Y}from"./jj85rqzpbnvv3emr.js";import{cg as B,o as ue,ou as me,bJ as te,ci as ne,ch as ie,bP as fe,gc as ge,cj as pe,ck as _e,fD as ye,B as G,e as ve,qc as he,bK as we,cc as je,f_ as Me,f1 as xe,bI as Ae}from"./lef5ym39glv4981l.js";import{cm as ke,cl as C,j6 as ze,iZ as be,jF as Ce,gu as Se}from"./mclphevd122040jw.js";const q=J({starting:{id:"jitPluginMessage.starting",defaultMessage:"Starting action"},confirmingSimple:{id:"jitPluginMessage.confirming.simple",defaultMessage:"{gizmoName} wants to talk to {domain}"},confirmingSubtitle:{id:"jitPluginMessage.confirming.subtitle",defaultMessage:"Only allow sites you trust."},running:{id:"jitPluginMessage.runningV4",defaultMessage:"Talking to {domain}"},finished:{id:"jitPluginMessage.finishedV4",defaultMessage:"Talked to {domain}"},stopped:{id:"jitPluginMessage.stoppedV4",defaultMessage:"Stopped talking to {domain}"},error:{id:"jitPluginMessage.errorV5",defaultMessage:"Error talking to {domain}"},declined:{id:"jitPluginMessage.declined",defaultMessage:"You declined this action"},ranTest:{id:"jitPluginMessage.ranTest",defaultMessage:"Tested {operationName}"},confirmParamsTitle:{id:"jitPluginMessage.confirmParamsTitleV3",defaultMessage:"{gizmoName} wants to share this info with {domain}"},sentParamsTitle:{id:"jitPluginMessage.sentParamsTitleV2",defaultMessage:"{gizmoName} sent this info to {domain}"},privacyPolicyLink:{id:"jitPluginMessage.privacyPolicyLinkV2",defaultMessage:"Privacy policy"},connectorDeclined:{id:"jitPluginMessage.connectorDeclined",defaultMessage:"Declined connection to {domain}"},rememberForThisConversation:{id:"jitPluginMessage.rememberForThisConversation",defaultMessage:"Remember for this conversation"}});var A=(t=>(t[t.Running=0]="Running",t[t.Finished=1]="Finished",t[t.Error=2]="Error",t[t.Stopped=3]="Stopped",t[t.OauthLogin=4]="OauthLogin",t[t.NoAuthLink=5]="NoAuthLink",t[t.UserConfirmation=6]="UserConfirmation",t[t.Denied=7]="Denied",t[t.Hidden=8]="Hidden",t))(A||{});const Ne=t=>{const[e,...n]=t,i=n.filter(u=>u.author.role===ie.Tool),o=i.filter(u=>{var c,r,l;return((l=(r=(c=u.metadata)==null?void 0:c.jit_plugin_data)==null?void 0:r.from_server)==null?void 0:l.type)==="debug"}),s=i.filter(u=>!["debug","send_test"].some(c=>{var r,l,w;return c===((w=(l=(r=u.metadata)==null?void 0:r.jit_plugin_data)==null?void 0:l.from_server)==null?void 0:w.type)})),a=i[i.length-1];return{assistantMessage:e,toolMessages:i,debugMessages:o,actionableMessages:s,lastToolMessage:a}},X=new WeakMap,P=t=>{const e=X.get(t);if(e)return e;const n=Ne(t);return X.set(t,n),n};function Ee(t){if(t&&"user_action"in t){const e=t.user_action;t=M(M({},t),e.data),"target_message_id"in t&&e.target_message_id&&(t.target_message_id=e.target_message_id)}return t}function D(t,e){var n,i,o,s;return((n=t==null?void 0:t.from_server)==null?void 0:n.type)==="confirm_action"?(o=(i=t==null?void 0:t.from_server)==null?void 0:i.body)==null?void 0:o.operation:(s=e==null?void 0:e.parsed_function_call)==null?void 0:s.name}function We(t,e){var s,a;const{jitPluginData:n,invokedPlugin:i,lastConfirmActionJitPluginData:o}=V(t,e);return(a=(s=D(n,i))!=null?s:D(o,void 0))!=null?a:""}function Fe(t,e){var n,i,o,s;return((n=t==null?void 0:t.from_server)==null?void 0:n.type)==="confirm_action"?(o=(i=t==null?void 0:t.from_server)==null?void 0:i.body)==null?void 0:o.params:(s=e==null?void 0:e.parsed_function_call)==null?void 0:s.kwargs}function V(t,e){var s,a,u,c,r,l,w,p,_,y,v,z,k,m,h,b,E,S;const{assistantMessage:n,actionableMessages:i}=P(t);let o;for(let d=i.length-1;d>=0;d--){const f=(s=i[d].metadata)==null?void 0:s.jit_plugin_data;if(((a=f==null?void 0:f.from_server)==null?void 0:a.type)==="confirm_action"){o=f;break}}if(((r=(c=(u=n.metadata)==null?void 0:u.jit_plugin_data)==null?void 0:c.from_server)==null?void 0:r.type)==="send_test")return{uiState:A.Hidden,lastConfirmActionJitPluginData:o,jitPluginData:void 0,invokedPlugin:void 0,fileAttachments:void 0};if(i.some(d=>d.content.content_type===B.SystemError))return{uiState:A.Error,lastConfirmActionJitPluginData:o,jitPluginData:void 0,invokedPlugin:void 0,fileAttachments:void 0};if(ke(n))return{uiState:A.Stopped,lastConfirmActionJitPluginData:o,jitPluginData:void 0,invokedPlugin:void 0,fileAttachments:void 0};for(let d=i.length-1;d>=0;d--){const f=i[d];if((l=f.metadata)!=null&&l.invoked_plugin){const T=[];return i.forEach(oe=>{var F,L;const W=(L=(F=oe.metadata)==null?void 0:F.attachments)==null?void 0:L.filter(se=>se.display_files_from_actions_ext);W&&T.push(...W)}),{uiState:A.Finished,lastConfirmActionJitPluginData:o,jitPluginData:f.metadata.jit_plugin_data,invokedPlugin:f.metadata.invoked_plugin,fileAttachments:T}}const j=Ee((p=(w=f.metadata)==null?void 0:w.jit_plugin_data)==null?void 0:p.from_client);if(j!=null){if((j==null?void 0:j.type)==="contact_gizmo")return{uiState:A.Finished,lastConfirmActionJitPluginData:o,jitPluginData:(y=(_=i[d-1])==null?void 0:_.metadata)==null?void 0:y.jit_plugin_data,invokedPlugin:void 0,fileAttachments:void 0};if((j==null?void 0:j.type)==="deny")return{uiState:A.Denied,lastConfirmActionJitPluginData:o,jitPluginData:void 0,invokedPlugin:void 0,fileAttachments:void 0};if((j==null?void 0:j.type)==="oauth_success")return{uiState:A.Running,lastConfirmActionJitPluginData:o,jitPluginData:(v=f.metadata)==null?void 0:v.jit_plugin_data,invokedPlugin:void 0,fileAttachments:void 0};if((j==null?void 0:j.type)==="link_success")return{uiState:A.Running,lastConfirmActionJitPluginData:o,jitPluginData:(z=f.metadata)==null?void 0:z.jit_plugin_data,invokedPlugin:void 0,fileAttachments:void 0};break}const x=(m=(k=f.metadata)==null?void 0:k.jit_plugin_data)==null?void 0:m.from_server;if((x==null?void 0:x.type)==="preview"&&e)return{uiState:A.Running,lastConfirmActionJitPluginData:o,jitPluginData:(h=f.metadata)==null?void 0:h.jit_plugin_data,invokedPlugin:void 0,fileAttachments:void 0};if((x==null?void 0:x.type)==="confirm_action"&&e)return{uiState:A.UserConfirmation,lastConfirmActionJitPluginData:o,jitPluginData:(b=f.metadata)==null?void 0:b.jit_plugin_data,invokedPlugin:void 0,fileAttachments:void 0};if((x==null?void 0:x.type)==="oauth_required"&&e)return{uiState:A.OauthLogin,lastConfirmActionJitPluginData:o,jitPluginData:(E=f.metadata)==null?void 0:E.jit_plugin_data,invokedPlugin:void 0,fileAttachments:void 0};if((x==null?void 0:x.type)==="link_required"&&e)return{uiState:A.NoAuthLink,lastConfirmActionJitPluginData:o,jitPluginData:(S=f.metadata)==null?void 0:S.jit_plugin_data,invokedPlugin:void 0,fileAttachments:void 0}}return{uiState:e?A.Running:A.Stopped,lastConfirmActionJitPluginData:o,jitPluginData:void 0,invokedPlugin:void 0,fileAttachments:void 0}}function Le(t,e,n,i){var l,w,p,_,y,v,z,k,m,h;var o=(l=me(t,n))!=null?l:void 0;if(!o)return{connectorId:void 0,connectorToolStatus:null,connectorStatusMessage:null,showConnectorConnect:!1};if(e===t)return{connectorId:o,connectorToolStatus:null,connectorStatusMessage:null,showConnectorConnect:!1};var s=C.Running,a=null,u=!1;const c=n[n.length-1],r=(w=c==null?void 0:c.metadata)==null?void 0:w.jit_plugin_data;return n.some(b=>b.content.content_type===B.SystemError)?(s=C.Error,a=q.error):c?((p=r==null?void 0:r.from_server)==null?void 0:p.type)==="oauth_required"&&i?(s=C.Paused,a=null,u=!0):((_=r==null?void 0:r.from_server)==null?void 0:_.type)==="link_required"&&i?(s=C.Paused,a=null,u=!0):(((y=r==null?void 0:r.from_server)==null?void 0:y.type)==="oauth_required"||((v=r==null?void 0:r.from_server)==null?void 0:v.type)==="link_required")&&!i?(s=C.Stopped,a=q.connectorDeclined):((z=r==null?void 0:r.from_client)==null?void 0:z.type)==="deny"?(s=C.Stopped,a=q.connectorDeclined):((k=r==null?void 0:r.from_client)==null?void 0:k.type)==="oauth_success"?(s=C.Stopped,a=null):((m=r==null?void 0:r.from_client)==null?void 0:m.type)==="link_success"?(s=C.Stopped,a=null):(h=c==null?void 0:c.metadata)!=null&&h.invoked_plugin?(s=C.Finished,a=q.finished):(s=C.Stopped,a=q.stopped):(s=C.Running,a=q.running),{connectorId:o,connectorToolStatus:s,connectorStatusMessage:a,showConnectorConnect:u}}function Re({recipient:t,actionData:e,gizmoId:n}){return{id:de(),author:{role:ie.Tool,name:t},content:{content_type:B.Text,parts:[""]},recipient:"all",metadata:{jit_plugin_data:{from_client:e},gizmo_id:n},clientMetadata:{completionSampleFinishTime:Date.now()}}}function $e(a){var u=a,{clientThreadId:t,actionData:e,assistantMessage:n,onRequestCompletion:i,activeSystemHint:o}=u,s=Q(u,["clientThreadId","actionData","assistantMessage","onRequestCompletion","activeSystemHint"]);var r;const c=(r=te(t))==null?void 0:r.mode;i(O(M({},s),{promptMessage:Re({recipient:n.recipient,actionData:e,gizmoId:c&&"gizmo_id"in c?c.gizmo_id:void 0}),completionMetadata:{conversationMode:c!=null?c:{kind:ne.PrimaryAssistant},systemHints:o?[o]:void 0}}))}function Ke(t,e){if(t.type!==ue.JIT_PLUGIN||!t.metadata.json_schema)return!1;let n=!1;function i(o){for(const s in o)s==="operationId"&&o[s]===e&&(n=!0),o[s]&&typeof o[s]=="object"&&i(o[s])}return i(t.metadata.json_schema),n}function U(t){var e,n,i;if(t&&(((e=t.from_server)==null?void 0:e.type)==="confirm_action"||((n=t.from_server)==null?void 0:n.type)==="oauth_required"||((i=t.from_server)==null?void 0:i.type)==="preview"))return t.from_server.body.params}function I(t){var e,n,i;if(t&&(((e=t.from_server)==null?void 0:e.type)==="confirm_action"||((n=t.from_server)==null?void 0:n.type)==="preview"))return(i=t.from_server.body.tool_call_safety_summary)!=null?i:void 0}function Ge(t){const e=fe(t);if(e)try{return JSON.parse(e)}catch(n){return{text:e}}}function Ze(t,e){var s,a;const{assistantMessage:n}=P(t),{jitPluginData:i,lastConfirmActionJitPluginData:o}=V(t,e);return(a=(s=U(i))!=null?s:U(o))!=null?a:Ge(n)}function Qe(t,e){var o,s;const{jitPluginData:n,lastConfirmActionJitPluginData:i}=V(t,e);return(s=(o=I(n))!=null?o:I(i))!=null?s:void 0}function Oe(t){if(!t)return;const e=t.content.content_type===B.Text?t.content.parts[0]:t.content.content_type===B.Code?t.content.text:void 0;if(e)try{return JSON.parse(e)}catch(n){return e}}const Ye=t=>{const{lastToolMessage:e}=P(t);return Oe(e)},Xe=(t,e)=>{var i,o,s,a;const{jitPluginData:n}=V(t,e);return((i=n==null?void 0:n.from_server)==null?void 0:i.type)==="confirm_action"?(a=(s=(o=n==null?void 0:n.from_server)==null?void 0:o.body)==null?void 0:s.offer_remember_answer)!=null?a:!0:!1},qe=(t,e)=>{var i,o;const{jitPluginData:n}=V(t,e);return((i=n==null?void 0:n.from_server)==null?void 0:i.type)!=="denied_by_user"&&!!((o=n==null?void 0:n.from_server)!=null&&o.body.actions.length)},De=(t,e)=>ze(t)&&qe(t,e),Ue=t=>{"use forget";var b,E,S;const e=ee.c(25),{clientThreadId:n,action:i,messages:o,onRequestCompletion:s,handleUserAction:a,domain:u,rememberAnswer:c}=t;let r;e[0]!==o?(r=P(o),e[0]=o,e[1]=r):r=e[1];const{assistantMessage:l}=r,w=ge();let p;e[2]!==((b=l.metadata)==null?void 0:b.gizmo_id)||e[3]!==w?(p=d=>{var j,x;const f=(x=(j=l.metadata)==null?void 0:j.gizmo_id)!=null?x:d?Ae.getGizmoId(d):w;return[f,Ce(d==null?void 0:d.mode,f)]},e[2]=(E=l.metadata)==null?void 0:E.gizmo_id,e[3]=w,e[4]=p):p=e[4];const[_,y]=pe(n,p);let v;e[5]!==y||e[6]!==_?(v=be(y)&&y.gizmo_id===_,e[5]=y,e[6]=_,e[7]=v):v=e[7];const k=(S=_e(_,v))==null?void 0:S.data,m=ye();let h;return e[8]!==i.allow||e[9]!==i.always_allow||e[10]!==i.contact_gizmo||e[11]!==i.deny||e[12]!==i.name||e[13]!==i.oauth_redirect||e[14]!==i.type||e[15]!==m||e[16]!==l||e[17]!==n||e[18]!==k||e[19]!==u||e[20]!==a||e[21]!==o||e[22]!==s||e[23]!==c?(h=i.type==="deny"?g.jsx(G,{color:"secondary",size:"small",onClick:d=>{a({clientThreadId:n,sourceEvent:d,onRequestCompletion:s,assistantMessage:l,allMessages:o,actionData:O(M({type:"deny"},i.deny),{remember_answer:c}),activeSystemHint:m})},children:g.jsx(R,M({},i.name==="decline"?N.decline:N.deny))}):i.type==="allow"?g.jsx(G,{color:"primary",size:"small",onClick:d=>{a({clientThreadId:n,sourceEvent:d,onRequestCompletion:s,assistantMessage:l,allMessages:o,actionData:O(M({type:"allow"},i.allow),{remember_answer:c}),activeSystemHint:m})},children:g.jsx(R,M({},i.name==="allow"?N.allow:N.confirm))}):i.type==="always_allow"?g.jsx(G,{color:"secondary",size:"small",onClick:d=>{a({clientThreadId:n,sourceEvent:d,onRequestCompletion:s,assistantMessage:l,allMessages:o,actionData:M({type:"always_allow"},i.always_allow),activeSystemHint:m})},children:g.jsx(R,M({},N.alwaysAllow))}):i.type==="oauth_redirect"?g.jsx(G,{color:"primary",size:"small",onClick:()=>{Be(i.oauth_redirect,n,k)},children:g.jsx(R,O(M({},N.signInButton),{values:{domain:u}}))}):i.type==="contact_gizmo"?g.jsx(G,{color:"secondary",size:"small",onClick:d=>{a({clientThreadId:n,sourceEvent:d,onRequestCompletion:s,assistantMessage:l,allMessages:o,actionData:M({type:"contact_gizmo"},i.contact_gizmo),activeSystemHint:m})},children:g.jsx(R,M({},N.allow))}):null,e[8]=i.allow,e[9]=i.always_allow,e[10]=i.contact_gizmo,e[11]=i.deny,e[12]=i.name,e[13]=i.oauth_redirect,e[14]=i.type,e[15]=m,e[16]=l,e[17]=n,e[18]=k,e[19]=u,e[20]=a,e[21]=o,e[22]=s,e[23]=c,e[24]=h):h=e[24],h};function Ie(t){"use forget";const e=ee.c(29),{connector:n,onConnect:i,onProceedWithoutConnecting:o}=t,s=le(),[a,u]=Y.useState(!1);let c,r;if(e[0]===Symbol.for("react.memo_cache_sentinel")?(c=()=>{const d=requestAnimationFrame(()=>u(!0));return()=>cancelAnimationFrame(d)},r=[],e[0]=c,e[1]=r):(c=e[0],r=e[1]),Y.useEffect(c,r),!n)return null;const l=a?"scale-100 opacity-100":"scale-95 opacity-0",w=o?"pb-3":"";let p;e[2]!==l||e[3]!==w?(p=ve("shadow-long flex w-80 flex-col items-center rounded-2xl bg-white p-6 text-center transition-opacity transition-transform duration-300 dark:bg-[#333333]",l,w),e[2]=l,e[3]=w,e[4]=p):p=e[4];let _;e[5]!==n?(_=g.jsx(Se,{connector:n,size:"large",className:"bg-primary shadow-xxs max-h-fit rounded-2xl border bg-clip-padding p-2"}),e[5]=n,e[6]=_):_=e[6];let y;e[7]!==n.name||e[8]!==s?(y=he(n.name,s),e[7]=n.name,e[8]=s,e[9]=y):y=e[9];let v;e[10]!==y?(v=g.jsx("div",{className:"text-token-text-primary mt-5 px-6 text-lg leading-tight font-medium",children:g.jsx(R,O(M({},N.connectHeader),{values:{connectorName:y}}))}),e[10]=y,e[11]=v):v=e[11];let z;e[12]!==n.description?(z=n.description&&g.jsx("div",{className:"text-token-text-secondary mt-2 text-sm",children:n.description}),e[12]=n.description,e[13]=z):z=e[13];let k;e[14]===Symbol.for("react.memo_cache_sentinel")?(k=g.jsx(R,M({},N.connectButton)),e[14]=k):k=e[14];let m;e[15]!==i?(m=g.jsx(G,{className:"mt-6 w-full py-2 text-base",size:"medium",color:"primary",onClick:i,children:k}),e[15]=i,e[16]=m):m=e[16];let h;e[17]!==o?(h=o!==void 0&&g.jsx(G,{className:"mt-2 w-full border-0 text-sm font-normal! hover:bg-transparent",color:"secondary",size:"medium",onClick:o,children:g.jsx(R,M({},N.notNow))}),e[17]=o,e[18]=h):h=e[18];let b;e[19]!==m||e[20]!==h||e[21]!==p||e[22]!==_||e[23]!==v||e[24]!==z?(b=g.jsxs("div",{className:p,children:[_,v,z,m,h]}),e[19]=m,e[20]=h,e[21]=p,e[22]=_,e[23]=v,e[24]=z,e[25]=b):b=e[25];const E=b;let S;return e[26]!==E||e[27]!==n?(S=E,e[26]=E,e[27]=n,e[28]=S):S=e[28],S}function Be(t,e,n){var u;const i=te(e),o=we(e),s=((u=i==null?void 0:i.mode)==null?void 0:u.kind)===ne.GizmoTest,a=o&&!s?je(o,n):window.location.href;t.gizmo_id==="FAKE_PLUGIN_GIZMO"?Me({id:t.gizmo_action_id},a):xe.doOAuthRedirect(t.gizmo_id,t.gizmo_action_id,t.domain,a,s)}const N=J({connectHeader:{id:"jitPluginMessage.connectHeader",defaultMessage:"ChatGPT wants to connect to {connectorName}"},alwaysAllow:{id:"jitPluginMessage.alwaysAllow",defaultMessage:"Always Allow"},allow:{id:"jitPluginMessage.allow",defaultMessage:"Allow"},decline:{id:"jitPluginMessage.decline",defaultMessage:"Decline"},confirm:{id:"jitPluginMessage.confirm",defaultMessage:"Confirm"},deny:{id:"jitPluginMessage.deny",defaultMessage:"Deny"},signInButton:{id:"jitPluginMessage.signInButton",defaultMessage:"Sign in with {domain}"},connectButton:{id:"jitPluginMessage.connectButton",defaultMessage:"Continue"},notNow:{id:"jitPluginMessage.notNow",defaultMessage:"Do not connect"}});export{Ue as A,Ie as C,A as J,Xe as a,Ze as b,De as c,Ke as d,Le as e,Ee as f,V as g,$e as h,q as i,Qe as j,Ye as k,We as l,Fe as m,P as p};
//# sourceMappingURL=bfo1h8l0zwcd8b61.js.map
