var De=Object.defineProperty,_e=Object.defineProperties;var Se=Object.getOwnPropertyDescriptors;var se=Object.getOwnPropertySymbols;var Te=Object.prototype.hasOwnProperty,Be=Object.prototype.propertyIsEnumerable;var ne=(e,n,t)=>n in e?De(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,C=(e,n)=>{for(var t in n||(n={}))Te.call(n,t)&&ne(e,t,n[t]);if(se)for(var t of se(n))Be.call(n,t)&&ne(e,t,n[t]);return e},ae=(e,n)=>_e(e,Se(n));import{f as pe,u as G,a as Z,t as fe,b as ge,r,j as l,d as Re,M as P,G as We,a6 as Ee}from"./jj85rqzpbnvv3emr.js";import{jU as Fe}from"./mclphevd122040jw.js";import{f as J,R,x as qe,e as Y,n as Ve,B as le}from"./lef5ym39glv4981l.js";import{a as Le,c as Ke,u as Qe,d as He}from"./fya3qb1e1s8z4llj.js";import{W as ie}from"./nw87b28zzjde4xnt.js";import"./n82i9qkvs5r9bggc.js";import"./9z485wf4plyfoo73.js";import"./cncd8uuk5eicbkeu.js";import"./dta5t6ifyam55mk9.js";import"./cdk0cmbgnafohb1q.js";import"./gyvvad7btmtz1x9o.js";import"./n6vmm5pyahusdy8e.js";import"./l041el2tch1t3nkf.js";import"./easgat082167v0i8.js";import"./dvqe6kc43fkjsavv.js";import"./mw2u7timj0qnsnvj.js";import"./hnotrmacgvnfyexv.js";import"./mej2ctt6swvc1m1z.js";import"./go9515ghq3pauvs4.js";import"./d9serb02oz4r1lgw.js";import"./n5wrqpcxv1sjah44.js";function ze(e){return pe({queryKey:["workspace-ip-allowlist",e],queryFn:e?()=>R.safeGet("/accounts/{account_id}/ip-allowlist",{parameters:{path:{account_id:e}}}):fe})}function Ue(e){return pe({queryKey:["workspace-compliance-ip-allowlist",e],queryFn:e?()=>R.safeGet("/accounts/{account_id}/compliance-ip-allowlist",{parameters:{path:{account_id:e}}}):fe})}function $e(e){const n=G(),t=J();return Z({mutationFn:a=>R.safePost("/accounts/{account_id}/compliance-ip-allowlist",{parameters:{path:{account_id:e}},requestBody:a}),onSuccess:()=>{n.invalidateQueries({queryKey:["workspace-compliance-ip-allowlist",e]})},onError:a=>{t.danger(a.message,{toastId:"compliance_ip_allowlist_create",loggingTitle:a.message,loggingDescription:"Failed to update Compliance API IP Allowlist"})}})}function Oe(e){const n=G(),t=J();return Z({mutationFn:a=>R.safePost("/accounts/{account_id}/ip-allowlist",{parameters:{path:{account_id:e}},requestBody:a}),onSuccess:()=>{n.invalidateQueries({queryKey:["workspace-ip-allowlist",e]})},onError:a=>{t.danger(a.message,{toastId:"ip_allowlist_create",loggingTitle:a.message,loggingDescription:"Failed to update IP allowlist"})}})}function Ye(e){const n=G(),t=J();return Z({mutationFn:a=>R.safePatch("/accounts/{account_id}/ip-allowlist",{parameters:{path:{account_id:e}},requestBody:a}),onSuccess:()=>{n.invalidateQueries({queryKey:["workspace-ip-allowlist",e]})},onError:a=>{t.danger(a.message,{toastId:"ip_allowlist_toggle",loggingTitle:a.message,loggingDescription:"Failed to toggle IP allowlist"})}})}const oe={md:{font:14,h:18,gap:6},lg:{font:14,h:20,gap:6},xl:{font:14,h:24,gap:6},"2xl":{font:16,h:24,gap:8},"3xl":{font:16,h:32,gap:8}};function re({value:e,defaultValue:n=[],onChange:t,validator:a,placeholder:i="",disabled:c=!1,size:d="xl",rows:b=1,maxTags:w,delimiters:h=[","," "],autoFocus:u=!1,showCount:v}){const I=ge(),k=e!==void 0,[L,K]=r.useState(n),p=e!=null?e:L,N=r.useRef(null),M=r.useRef(null),x=r.useRef(null),[W,D]=r.useState(u),[y,_]=r.useState(""),[S,j]=r.useState(null),[me,X]=r.useState(new Set),[he,xe]=r.useState(16),E=!w||p.length<w,F=p.length===0,we=r.useMemo(()=>{const s=oe[d];return b*s.h+(b+1)*s.gap},[b,d]),Q=r.useMemo(()=>new Set(p.map(s=>s.value)),[p]),T=r.useCallback(s=>{t==null||t(s),k||K(s)},[t,k]),H=r.useCallback(s=>a?a(s):!0,[a]),z=r.useCallback(s=>{X(o=>new Set(o).add(s)),window.setTimeout(()=>{X(o=>{const f=new Set(o);return f.delete(s),f})},500)},[]),U=r.useCallback(s=>{const o=s.trim();if(!o)return;if(Q.has(o)){z(o);return}const f=[...p,{value:o,valid:H(o)}];T(f)},[p,Q,H,T,z]),ee=r.useCallback(s=>{const o=[...p];o.splice(s,1),T(o),j(null)},[p,T]),te=()=>{const s=N.current;return!s||s.selectionStart===0&&s.selectionEnd===0},ve=s=>{if(E)if(s.key==="ArrowLeft"||s.key==="ArrowUp")te()&&(s.preventDefault(),j(o=>o==null?p.length-1:Math.max(0,o-1)));else if(s.key==="ArrowRight"||s.key==="ArrowDown"){if(S!=null){s.preventDefault();const o=S+1;j(o>=p.length?null:o)}}else s.key==="Backspace"&&(S!=null?(s.preventDefault(),ee(S)):te()&&p.length&&(s.preventDefault(),j(p.length-1)))},ye=s=>{s.key==="Enter"||h.includes(s.key)?(s.preventDefault(),y&&(U(y),_(""))):s.key==="Tab"&&y&&(s.preventDefault(),U(y),_(""))},be=s=>{let f=[s.clipboardData.getData("text")];for(const m of h){const B=[];for(const O of f)B.push(...O.split(m));f=B}if(f=f.flatMap(m=>m.split(/\r?\n/)).map(m=>m.trim()).filter(Boolean),f.length>1){s.preventDefault();const m=[...p],B=new Set(Q);for(const O of f){const A=O.trim();if(A){if(B.has(A)){z(A);continue}if(w&&m.length>=w)break;m.push({value:A,valid:H(A)}),B.add(A)}}m.length!==p.length&&T(m),_("")}},Ie=()=>D(!0),Me=s=>{M.current&&s.relatedTarget instanceof Node&&M.current.contains(s.relatedTarget)||(D(!1),j(null),y.trim()&&(U(y),_("")))},je=s=>{var f;if(c)return;const o=s.target instanceof Element?s.target.closest("[data-tag]"):null;if(o){const m=Number(o.getAttribute("data-index"));j(isNaN(m)?null:m);return}s.preventDefault(),(f=N.current)==null||f.focus(),j(null)};qe(()=>{if(!E)return;const s=x.current,o=M.current;if(!s||!o)return;s.textContent=y||(F?i:"")||"";const f=s.getBoundingClientRect().width,m=o.getBoundingClientRect().width-32;xe(Math.max(16,Math.min(f+4,m)))},[y,i,E,F]);const $=oe[d],ke={"--input-font-size":"".concat($.font,"px"),"--input-height":"".concat($.h,"px"),"--input-tag-spacing":"".concat($.gap,"px"),minHeight:"".concat(we,"px")},Ae="flex items-center rounded px-[6px] py-[4px] text-[var(--input-font-size)] leading-none transition-colors select-none",Ce="bg-green-50 text-green-800 hover:bg-green-100",Pe="bg-red-50 text-red-800 hover:bg-red-100",Ne="font-bold";return l.jsxs(l.Fragment,{children:[l.jsx("div",{ref:M,className:Y("relative mb-[8px] cursor-text overflow-x-hidden overflow-y-auto rounded-xl border-2 px-4 py-2",c?"cursor-not-allowed border-neutral-200 bg-neutral-50 opacity-60":"border-neutral-300 hover:border-neutral-400"),style:ke,"data-size":d,"data-focused":W?"":void 0,"data-empty":F?"":void 0,"data-disabled":c?"":void 0,onKeyDown:ve,onMouseDown:je,onFocus:Ie,onBlur:Me,tabIndex:-1,children:l.jsxs("div",{className:"flex flex-wrap items-start gap-x-[var(--input-tag-spacing)] gap-y-[var(--input-tag-spacing)]",children:[p.map((s,o)=>{const f=S===o,m=me.has(s.value);return l.jsxs("div",{"data-tag":s.value,"data-index":o,className:Y(Ae,s.valid?Ce:Pe,f&&Ne,m&&"animate-pulse"),children:[l.jsx("span",{title:s.value,children:s.value}),!c&&l.jsx("button",{type:"button","aria-label":I.formatMessage({id:"4LMrjM",defaultMessage:"Remove"}),onClick:()=>ee(o),className:"ms-[2px] inline-flex h-3.5 w-3.5 items-center justify-center rounded text-xs text-neutral-500 hover:text-neutral-900",children:I.formatMessage({id:"3pDUsa",defaultMessage:"x"})})]},s.value)}),E&&l.jsxs("div",{className:"inline-flex items-center",children:[l.jsx("span",{ref:x,className:"invisible absolute -z-10 whitespace-pre text-[var(--input-font-size)]"}),l.jsx("input",{ref:N,type:"text",value:y,placeholder:F?i:void 0,disabled:c,onChange:s=>_(s.currentTarget.value),onKeyDown:ye,onPaste:be,className:Y("m-0 border-none bg-transparent p-0","leading-[1.4] text-[var(--input-font-size)] caret-current","outline-none focus:outline-none focus-visible:outline-none","ring-0 focus:ring-0 focus-visible:ring-0","placeholder:text-neutral-400"),style:{width:he},autoFocus:u})]})]})}),(w||v)&&l.jsxs("div",{className:"mt-1 w-full text-end font-mono text-[12px] tracking-widest text-neutral-500",children:[p.length,w?"/".concat(w):null]})]})}const ce=e=>e.split(".").reduce((n,t)=>(n<<8)+parseInt(t,10),0),q=e=>{const[n,t]=e.split("::"),a=n?n.split(":"):[],i=t?t.split(":"):[],c=new Array(8-(a.length+i.length)).fill("0");return[...a,...c,...i].reduce((b,w)=>b*BigInt(65536)+BigInt(parseInt(w||"0",16)),BigInt(0))},Ge=(e,n)=>{const[t,a]=n.split("/"),i=parseInt(a,10);return ce(e)>>32-i===ce(t)>>32-i},Ze=(e,n)=>{const[t,a]=n.split("/"),i=parseInt(a,10);return q(e)>>BigInt(128-i)===q(t)>>BigInt(128-i)},ue=(e,n)=>{const t=e.trim();return t?n.some(a=>{const i=a.trim();if(i.includes("/"))return i.includes(":")?Ze(t,i):Ge(t,i);if(i.includes(":"))try{return q(t)===q(i)}catch(c){return!1}return t===i}):!1},V=e=>{const n=e.trim();if(!n)return!1;const t=n.split("/");if(t.length>2)return!1;const[a,i]=t;if(i==="")return!1;let c;return i!==void 0&&(c=parseInt(i,10),isNaN(c))?!1:a.includes(":")?!(!Je(a)||c!==void 0&&(c<0||c>128)):!(!/^(\d{1,3}\.){3}\d{1,3}$/.test(a)||c!==void 0&&(c<0||c>32))},Je=e=>{const n=e.split("::");if(n.length>2)return!1;const t=n[0]?n[0].split(":"):[],a=n.length===2&&n[1]?n[1].split(":"):[],i=/^[0-9a-fA-F]{1,4}$/;return t.some(c=>!i.test(c))||a.some(c=>!i.test(c))?!1:n.length===1?t.length===8:t.length+a.length<8},g=Re({title:{id:"BQ70ZO",defaultMessage:"IP allowlists"},apiSectionTitle:{id:"UoxlHB",defaultMessage:"Workspace IP Allowlist"},complianceSectionTitle:{id:"n0UHsk",defaultMessage:"Compliance API IP Allowlist"},apiHelperText:{id:"hb/u6V",defaultMessage:"When enabled, only requests from the IP addresses or ranges you specify are allowed. You can toggle the allowlist on or off for the entire workspace. Changes may take up to 15 minutes to take effect."},complianceHelperText:{id:"Kog1O7",defaultMessage:"Always enforced for Compliance API keys: usage is restricted to the specified IP addresses or ranges. There is no global on/off toggle—add or remove IPs to change access. This does not impact other API keys or workspace permissions. Changes may take up to 15 minutes to take effect."},editIpsLabel:{id:"eoBlQ3",defaultMessage:"Allowed IPs / CIDR ranges"},emptyMessage:{id:"ynbWU8",defaultMessage:"Add IP address or CIDR range…"},saveButton:{id:"8c8mEa",defaultMessage:"Save"},invalidNotice:{id:"vwaoU9",defaultMessage:"One or more IP / CIDR entries are invalid."},emptyWarning:{id:"tus3/6",defaultMessage:"You are enabling an IP allowlist with no entries. This will block all traffic. Continue?"},currentIpNotInAllowlistWarning:{id:"NxwZWj",defaultMessage:"Your current IP address ({ip}) is not in this allowlist or in any of the allowed CIDR ranges. You may lose access after changes take effect. Continue?"},toggleLabel:{id:"eIKgW3",defaultMessage:"Enable IP allowlist"}});function de(e){var h;const n=r.useMemo(()=>{var u;return new Set((u=e==null?void 0:e.allowed_ips)!=null?u:[])},[e]),[t,a]=r.useState((h=e==null?void 0:e.allowed_ips)!=null?h:[]);r.useEffect(()=>{e&&a(e.allowed_ips)},[e]);const i=r.useMemo(()=>t.filter(u=>!V(u)),[t]),c=i.length===0,d=r.useMemo(()=>{var u,v;if(!e)return t.length>0;if(((v=(u=e.allowed_ips)==null?void 0:u.length)!=null?v:0)!==t.length)return!0;for(const I of t)if(!n.has(I))return!0;return!1},[e,t,n]),b=r.useMemo(()=>t.map(u=>({value:u,valid:V(u)})),[t]),w=r.useCallback(u=>{a(u.map(v=>v.value))},[]);return{ips:t,setIps:a,tagValues:b,invalidEntries:i,isValid:c,isDirty:d,handleTagChange:w}}function Xe({currentWorkspaceId:e,readonly:n=!1,clientIp:t=""}){const a=ge(),i=ze(e),c=Ue(e),d=r.useMemo(()=>{const x=i.data;if(x)return{allowed_ips:Array.isArray(x.allowed_ips)?x.allowed_ips:[],enabled:!!x.enabled}},[i.data]),b=!!(d!=null&&d.enabled),w=r.useMemo(()=>{const x=c.data;if(x)return{allowed_ips:Array.isArray(x.allowed_ips)?x.allowed_ips:[]}},[c.data]),h=de(d),u=de(w),v=Oe(e),I=$e(e),k=Ye(e),L=r.useCallback(()=>{h.isValid&&(b&&t&&!ue(t,h.ips)&&!window.confirm(a.formatMessage(g.currentIpNotInAllowlistWarning,{ip:t}))||v.mutate({allowed_ips:h.ips}))},[h.isValid,h.ips,v,t,a,b]),K=r.useCallback(()=>{u.isValid&&I.mutate({allowed_ips:u.ips})},[u.isValid,u.ips,I]),p=r.useCallback(x=>{var W;if(x){const D=(W=d==null?void 0:d.allowed_ips)!=null?W:[];if(D.length===0){if(!window.confirm(a.formatMessage(g.emptyWarning)))return}else if(t&&!ue(t,D)&&!window.confirm(a.formatMessage(g.currentIpNotInAllowlistWarning,{ip:t})))return}k.mutate({enabled:x})},[k,d==null?void 0:d.allowed_ips,a,t]),N=i.isLoading||c.isLoading,M=i.isFetching||c.isFetching;return l.jsxs(l.Fragment,{children:[l.jsx(Fe,{children:l.jsx("title",{children:a.formatMessage(g.title)})}),l.jsx(Le,{title:a.formatMessage(g.title)}),l.jsx(Ke,{showSpinner:N,children:l.jsxs("div",{className:"space-y-10 pt-6",children:[d&&l.jsx(ie,{title:g.apiSectionTitle,children:l.jsxs("div",{className:"max-w-4xl space-y-6 pb-6",children:[l.jsx("p",{className:"text-sm text-neutral-500",children:a.formatMessage(g.apiHelperText)}),l.jsx("label",{className:"block text-sm font-medium text-neutral-700",children:l.jsx(P,C({},g.editIpsLabel))}),l.jsx(re,{value:h.tagValues,onChange:h.handleTagChange,validator:V,placeholder:a.formatMessage(g.emptyMessage),disabled:n||v.isPending,size:"xl",rows:3}),l.jsxs("div",{className:"mt-2 flex w-full items-center",children:[h.invalidEntries.length>0&&l.jsx("div",{className:"text-sm text-red-600",role:"alert",children:a.formatMessage(g.invalidNotice)}),l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(Ve,{checked:!!d.enabled,disabled:n||k.isPending,onCheckedChange:p,"aria-label":a.formatMessage(g.toggleLabel)}),l.jsx("span",{className:"text-sm text-neutral-600",children:d.enabled?l.jsx(P,{id:"0eFOl8",defaultMessage:"Allowlist is active."}):l.jsx(P,{id:"4N2jsY",defaultMessage:"Allowlist is inactive."})})]}),l.jsx(le,{className:"ms-auto",onClick:L,disabled:n||!h.isDirty||!h.isValid||v.isPending||M,children:l.jsx(P,C({},g.saveButton))})]})]})}),w&&l.jsx(ie,{title:g.complianceSectionTitle,children:l.jsxs("div",{className:"max-w-4xl space-y-6 pb-6",children:[l.jsx("p",{className:"text-sm text-neutral-500",children:a.formatMessage(g.complianceHelperText)}),l.jsx("label",{className:"block text-sm font-medium text-neutral-700",children:l.jsx(P,C({},g.editIpsLabel))}),l.jsx(re,{value:u.tagValues,onChange:u.handleTagChange,validator:V,placeholder:a.formatMessage(g.emptyMessage),disabled:n||I.isPending,size:"xl",rows:3}),l.jsxs("div",{className:"mt-2 flex w-full items-center",children:[u.invalidEntries.length>0&&l.jsx("div",{className:"text-sm text-red-600",role:"alert",children:a.formatMessage(g.invalidNotice)}),l.jsx(le,{className:"ms-auto",onClick:K,disabled:n||!u.isDirty||!u.isValid||I.isPending||M,children:l.jsx(P,C({},g.saveButton))})]})]})})]})})]})}const et=r.memo(Xe),Mt=We(function(){const n=Qe(),{clientIp:t}=Ee();return He(),l.jsx(et,ae(C({},n),{clientIp:t}))});export{Mt as default};
//# sourceMappingURL=o7ntf4e1takjrqdj.js.map
