var Me=Object.defineProperty,_e=Object.defineProperties;var ye=Object.getOwnPropertyDescriptors;var ne=Object.getOwnPropertySymbols;var xe=Object.prototype.hasOwnProperty,Te=Object.prototype.propertyIsEnumerable;var de=(s,e,a)=>e in s?Me(s,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[e]=a,N=(s,e)=>{for(var a in e||(e={}))xe.call(e,a)&&de(s,a,e[a]);if(ne)for(var a of ne(e))Te.call(e,a)&&de(s,a,e[a]);return s},le=(s,e)=>_e(s,ye(e));import{c as De,b as me,r as $,d as Ce,j as t,M as V,u as be,a as ke}from"./jj85rqzpbnvv3emr.js";import{f as fe,D as se,P as f,bw as J,C as je,R as Ee,I as Se,B as re}from"./lef5ym39glv4981l.js";import{C as ce}from"./d2q2nhqj7harnnku.js";import{T as M}from"./i5991cad8s41d2db.js";import{cf as Ie,cg as we,ch as Be,be as Ne}from"./mclphevd122040jw.js";function Re(s){const e=be(),a=fe();return ke({mutationFn:({domainId:n})=>Ee.safePost("/accounts/{account_id}/domains/{domain_id}/check",{parameters:{path:{account_id:s,domain_id:n}}}),onSuccess:()=>{e.invalidateQueries({queryKey:["workspace/identity",s]}),e.invalidateQueries({queryKey:["builderProfile"]})},onError:n=>{a.danger(n.message,{toastId:"domain_modal",loggingTitle:n.message,loggingDescription:"Domain check failed"})}})}function Oe(s){"use forget";const e=De.c(75),{workspaceId:a,isOpen:n,onClose:m,currentDomain:d,domains:_,showUnverifiedDomains:y,onVerifyDomain:A}=s;let W;e[0]!==_?(W=_===void 0?[]:_,e[0]=_,e[1]=W):W=e[1];const x=W,Z=y===void 0?!1:y,o=me(),u=fe(),{mutateAsync:P,isPending:F}=Ie(a),p=we(),{mutateAsync:ee,isPending:H}=Re(a);let X,q;e[2]!==n?(X=()=>{n&&f.logEventWithStatsig("Identity: Domain Modal Opened","chatgpt_identity_domain_modal_opened")},q=[n],e[2]=n,e[3]=X,e[4]=q):(X=e[3],q=e[4]),$.useEffect(X,q);const[i,z]=$.useState(d!=null?d:void 0),[g,ue]=$.useState(d==null?void 0:d.hostname),[r,R]=$.useState((d==null?void 0:d.status)===void 0?0:(d==null?void 0:d.status)===se.PENDING?1:2);let O;e[5]!==d?(O=()=>{d||(z(void 0),R(0))},e[5]=d,e[6]=O):O=e[6];const te=O;let Q;e[7]!==m||e[8]!==te?(Q=()=>{te(),f.logEventWithStatsig("Identity: Domain Modal Closed","chatgpt_identity_domain_modal_closed"),m()},e[7]=m,e[8]=te,e[9]=Q):Q=e[9];const h=Q;let U;e[10]!==P||e[11]!==x||e[12]!==p||e[13]!==g?(U=async()=>{if(g===void 0)return;const c=x.find(v=>v.hostname===g&&v.status===se.PENDING);if(c)z(c),R(1),f.logEventWithStatsig("Identity: Domain Added","chatgpt_identity_domain_added");else try{const v=await P({hostname:g});if(!p())return;"id"in v&&(z(v),f.logEventWithStatsig("Identity: Domain Added","chatgpt_identity_domain_added")),R(1)}catch(v){const pe=v;if(!p())return;throw f.logEventWithStatsig("Identity: Domain Verification Error","chatgpt_identity_domain_verification_error"),pe}},e[10]=P,e[11]=x,e[12]=p,e[13]=g,e[14]=U):U=e[14];const T=U;let D;e[15]!==o?(D=o.formatMessage(l.check),e[15]=o,e[16]=D):D=e[16];const ie=(i==null?void 0:i.id)===void 0||H;let C;e[17]!==ee||e[18]!==i||e[19]!==o||e[20]!==p||e[21]!==A||e[22]!==u?(C=async()=>{if(i!=null&&i.id)try{const c=await ee({domainId:i.id});if(!p())return;f.logEventWithStatsig("Identity: Domain Verification Started","chatgpt_identity_domain_verification_started"),"error"in c&&(u.danger(o.formatMessage(l.domainCheckError,{message:c.error.message}),{toastId:"domain_modal",loggingTitle:l.domainCheckError.defaultMessage,loggingDescription:"Domain check failed"}),f.logEventWithStatsig("Identity: Domain Verification Error","chatgpt_identity_domain_verification_error")),"id"in c&&(A&&A(c),c.status===se.VERIFIED&&(f.logEventWithStatsig("Identity: Domain Verification Success","chatgpt_identity_domain_verification_success"),R(2)))}catch(c){const v=c;if(!p())return;throw f.logEventWithStatsig("Identity: Domain Verification Error","chatgpt_identity_domain_verification_error"),v}},e[17]=ee,e[18]=i,e[19]=o,e[20]=p,e[21]=A,e[22]=u,e[23]=C):C=e[23];let Y;e[24]!==H||e[25]!==ie||e[26]!==C||e[27]!==D?(Y=t.jsx(J.Button,{title:D,color:"primary",disabled:ie,loading:H,onClick:C}),e[24]=H,e[25]=ie,e[26]=C,e[27]=D,e[28]=Y):Y=e[28];const ge=Y;let b;e[29]!==o?(b=o.formatMessage(l.submit),e[29]=o,e[30]=b):b=e[30];const oe=g===void 0||F;let G;e[31]!==T||e[32]!==F||e[33]!==b||e[34]!==oe?(G=t.jsx(J.Button,{title:b,color:"primary",disabled:oe,loading:F,onClick:T}),e[31]=T,e[32]=F,e[33]=b,e[34]=oe,e[35]=G):G=e[35];const he=G;let k;e[36]!==o?(k=o.formatMessage(l.done),e[36]=o,e[37]=k):k=e[37];let K;e[38]!==h||e[39]!==k?(K=t.jsx(J.Button,{title:k,color:"primary",onClick:h}),e[38]=h,e[39]=k,e[40]=K):K=e[40];const ve=K;let j;e[41]!==o||e[42]!==r?(j=o.formatMessage(r===0?l.newTitle:l.editTitle),e[41]=o,e[42]=r,e[43]=j):j=e[43];const ae=r===0?he:r===1?ge:ve;let E;e[44]!==o?(E=o.formatMessage(l.cancel),e[44]=o,e[45]=E):E=e[45];let S;e[46]!==h||e[47]!==E?(S=t.jsx(J.Button,{title:E,color:"secondary",onClick:h}),e[46]=h,e[47]=E,e[48]=S):S=e[48];let I;e[49]!==x||e[50]!==T||e[51]!==Z||e[52]!==r||e[53]!==g||e[54]!==a?(I=r===0&&t.jsx(Ae,{hostname:g,onSetHostname:ue,onSubmit:T,unverifiedDomains:Z?x:[],onVerifyDomain:c=>{R(1),z(c)},workspaceId:a}),e[49]=x,e[50]=T,e[51]=Z,e[52]=r,e[53]=g,e[54]=a,e[55]=I):I=e[55];let w;e[56]!==i||e[57]!==o||e[58]!==r||e[59]!==u?(w=r===1&&t.jsxs("div",{className:"flex flex-col gap-3",children:[o.formatMessage(l.verificationTokenMessage,{hostname:i==null?void 0:i.hostname}),(i==null?void 0:i.dns_verification_token_string)&&t.jsx(ce,{value:i.dns_verification_token_string,onCopied:()=>{u.success(o.formatMessage(l.copiedTXTRecordToClipboard),{duration:3})}}),t.jsx(V,N({},l.verificationTokenFooter))]}),e[56]=i,e[57]=o,e[58]=r,e[59]=u,e[60]=w):w=e[60];let B;e[61]!==i||e[62]!==o||e[63]!==r||e[64]!==u?(B=r===2&&t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsx(V,le(N({},l.successfulVerification),{values:{hostname:i==null?void 0:i.hostname}})),(i==null?void 0:i.dns_verification_token_string)&&t.jsx(ce,{value:i.dns_verification_token_string,onCopied:()=>{u.success(o.formatMessage(l.copiedTXTRecordToClipboard),{duration:3})}})]}),e[61]=i,e[62]=o,e[63]=r,e[64]=u,e[65]=B):B=e[65];let L;return e[66]!==h||e[67]!==n||e[68]!==j||e[69]!==ae||e[70]!==S||e[71]!==I||e[72]!==w||e[73]!==B?(L=t.jsxs(je,{testId:"modal-domain",isOpen:n,onClose:h,type:"success",className:"text-token-text-secondary",title:j,primaryButton:ae,secondaryButton:S,children:[I,w,B]}),e[66]=h,e[67]=n,e[68]=j,e[69]=ae,e[70]=S,e[71]=I,e[72]=w,e[73]=B,e[74]=L):L=e[74],L}function Ve({unverifiedDomains:s,onVerifyDomain:e,workspaceId:a}){const{mutateAsync:n}=Be(a);return t.jsxs(M.Root,{fixed:!0,size:"compact",className:"border-token-border-default mb-6 border-b",children:[t.jsxs(M.Header,{children:[t.jsx(M.HeaderCell,{children:t.jsx(V,N({},l.unverifiedDomainsTableHeader))}),t.jsx(M.HeaderCell,{textAlign:"right"})]}),s.map(m=>t.jsxs(M.Row,{children:[t.jsx(M.Cell,{children:m.hostname}),t.jsx(M.Cell,{textAlign:"right",children:t.jsxs("div",{className:"flex gap-2",children:[t.jsx(re,{color:"secondary",size:"small",onClick:()=>e(m),children:t.jsx(V,N({},l.verifyDomainButton))}),t.jsx(re,{color:"secondary",size:"small",onClick:()=>{n({domainId:m.id}),f.logEventWithStatsig("Identity: Domain Removed","chatgpt_identity_domain_removed")},icon:Ne})]})})]},m.id))]})}function Ae({hostname:s,onSetHostname:e,onSubmit:a,unverifiedDomains:n,onVerifyDomain:m,workspaceId:d}){const _=me();return t.jsxs(t.Fragment,{children:[n&&n.length>0&&t.jsx(Ve,{workspaceId:d,unverifiedDomains:n,onVerifyDomain:m}),t.jsx("form",{onSubmit:y=>{y.preventDefault(),a()},children:t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{htmlFor:"hostname",className:"mb-2 flex items-center text-sm font-semibold",children:t.jsx(V,N({},l.domainInput))}),t.jsx(Se,{ariaLabel:!1,name:"hostname",placeholder:_.formatMessage(l.placeholder),value:s!=null?s:"",onChange:y=>{e(y.target.value)}})]})})]})}const l=Ce({newTitle:{id:"domainModal.newTitle.0",defaultMessage:"Verify a new domain"},editTitle:{id:"domainModal.editTitle",defaultMessage:"Manage Domain"},submit:{id:"domainModal.submit",defaultMessage:"Submit"},check:{id:"domainModal.check",defaultMessage:"Check"},done:{id:"domainModal.done",defaultMessage:"Done"},cancel:{id:"domainModal.cancel",defaultMessage:"Cancel"},domainInput:{id:"domainModal.domainInput.0",defaultMessage:"Add a new domain"},placeholder:{id:"domainModal.placeholder",defaultMessage:"openai.com"},domainCheckError:{id:"domainModal.domainCheckError",defaultMessage:"Your domain could not be verified: {message}"},verificationTokenMessage:{id:"domainModal.verificationTokenMessage",defaultMessage:"To verify ownership of {hostname}, navigate to your DNS provider and add a TXT record with this value:"},verificationTokenFooter:{id:"domainModal.verificationTokenFooter",defaultMessage:"Then, check the record to complete the verification."},successfulVerification:{id:"domainModal.successfulVerification.0",defaultMessage:'Success! Your domain, "{hostname}" has been verified.'},copiedTXTRecordToClipboard:{id:"domainModal.copiedTXTRecordToClipboard",defaultMessage:"Copied DNS TXT record to clipboard"},verifyDomainButton:{id:"domainModal.verifyDomainButton",defaultMessage:"Verify"},unverifiedDomainsTableHeader:{id:"domainModal.unverifiedDomainsTableHeader",defaultMessage:"Your unverified domains"}});export{Oe as default};
//# sourceMappingURL=iszj8l0y8vp33jrs.js.map
