var B=Object.freeze,Z=Object.defineProperty,ve=Object.defineProperties;var we=Object.getOwnPropertyDescriptors;var G=Object.getOwnPropertySymbols;var be=Object.prototype.hasOwnProperty,je=Object.prototype.propertyIsEnumerable;var Q=(e,t,s)=>t in e?Z(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,I=(e,t)=>{for(var s in t||(t={}))be.call(t,s)&&Q(e,s,t[s]);if(G)for(var s of G(t))je.call(t,s)&&Q(e,s,t[s]);return e},k=(e,t)=>ve(e,we(t));var J=(e,t)=>B(Z(e,"raw",{value:B(t||e.slice())}));import{r as f,b as ye,j as n,z as Ie,A as K,m as le}from"./jj85rqzpbnvv3emr.js";import{bE as F,dJ as ce,eN as ue,O as me,jL as ke,x as U,nm as _e,hB as Ne,t as Se,bH as Re,bw as V,aI as de,B as $,i as fe,h0 as Ee,h1 as Ce,bJ as Le,ct as X,cw as Y,P as E,j as Me,dI as Ae,iI as ee,e9 as Te,bI as H,e as Pe,F as ze,cp as qe}from"./lef5ym39glv4981l.js";import{mG as Oe,fF as De,N as Fe,d7 as Ve,dq as We,lP as P,mH as S,mI as D,mJ as te,mK as He,cp as ne,mL as Be,mM as Ge,mN as Qe,mO as Ze,mP as Je,mQ as se,mR as Ke}from"./mclphevd122040jw.js";const xe=f.createContext({imageList:[],activeIndex:null,isInFocusMode$:F(!1),isZoomed$:F(!1)}),z=()=>f.useContext(xe);function W(){for(var e,t=0,s="",a=arguments.length;t<a;t++)(e=arguments[t])&&typeof e=="string"&&(s+=(s&&" ")+e);return s}const Ue="_lightbox_1ruyj_1",$e={lightbox:Ue};function Xe({imageList:e,forceDarkMode:t=!1,initialIndex:s,isInFocusMode$:a,onClose:u,onScrollToEnd:m,children:c}){var r;const x=ye(),h=f.useRef(null),j=Oe(),[l,y]=f.useState(s),p=ce(),w=ue(),[v]=f.useState(()=>{var i,o;return F(((o=(i=window.visualViewport)==null?void 0:i.scale)!=null?o:1)!==1)}),g=me(()=>v());f.useEffect(()=>{j.signalTransitionReady()},[j]),f.useEffect(()=>{if(g)return ke(()=>{v()||requestAnimationFrame(()=>{var o,d;(d=(o=h.current)==null?void 0:o.querySelector('[data-position="'.concat(l,'"]')))==null||d.scrollIntoView({behavior:"smooth",inline:"center",block:"center"})})})},[g,l,v]),f.useEffect(()=>{var o;const i=()=>{var d,b;return v.set(((b=(d=window.visualViewport)==null?void 0:d.scale)!=null?b:1)!==1)};return(o=window.visualViewport)==null||o.addEventListener("resize",i),()=>{var d;return(d=window.visualViewport)==null?void 0:d.removeEventListener("resize",i)}},[v]),U(()=>{var i,o;(o=(i=h.current)==null?void 0:i.querySelector('[data-position="'.concat(s,'"]')))==null||o.scrollIntoView({behavior:"instant",inline:"center",block:"center"})},[s]);const R=f.useCallback(i=>{y(i),requestAnimationFrame(()=>{var d;const o=(d=e[i])==null?void 0:d.title;o&&_e.setLiveRegionPolite(o)}),i===e.length-1&&(m==null||m())},[e,m]);U(()=>{const i=h.current;if(!i)return;const o=new IntersectionObserver(d=>{const b=d.reduce((T,O)=>O.isIntersecting&&(!T||O.intersectionRatio>T.intersectionRatio)?O:T,null);b&&b.target instanceof HTMLElement&&R(Ne(b.target.dataset.position))},{root:i,rootMargin:"0px -50% 0px -50%",threshold:0});for(const d of i.querySelectorAll(":scope > li"))o.observe(d);return()=>{o.disconnect()}},[e,R]);const N=e.length-1,_=f.useCallback(i=>{const o=Math.min(Math.max(l+i,0),N);R(o),requestAnimationFrame(()=>{var d,b;(b=(d=h.current)==null?void 0:d.querySelector('[data-position="'.concat(o,'"]')))==null||b.scrollIntoView({behavior:p?"instant":"smooth",block:"center",inline:"center"})})},[l,N,p,R]);f.useEffect(()=>{requestAnimationFrame(()=>{const i=document.querySelector("[data-lightbox-close-button]");i instanceof HTMLElement&&i.focus()})},[]),f.useEffect(()=>{const i=o=>{if(a!=null&&a()){o.key==="Escape"&&a.set(!1);return}o.key==="ArrowLeft"?l>0&&(o.preventDefault(),_(-1)):o.key==="ArrowRight"?l<N&&(o.preventDefault(),_(1)):o.key==="Escape"&&u(l)};return window.addEventListener("keydown",i),()=>{window.removeEventListener("keydown",i)}},[l,N,_,u,a]),f.useEffect(()=>{Se(Re(),"chatgpt_web_image_library_lightbox_image_viewed")},[l]);const{footer:q,items:L,title:M,headerActions:A}=De(c,{title:he,items:ge,footer:pe,headerActions:Ye});return n.jsx(xe.Provider,{value:{imageList:e,activeIndex:l,isInFocusMode$:a,isZoomed$:v},children:n.jsxs(V.Root,{testId:"modal-image-gen-lightbox",isOpen:!0,onClose:()=>u(l),shouldIgnoreClickOutside:w,className:W(w||t?"dark bg-black":"bg-token-bg-primary","flex h-dvh max-h-full w-dvw max-w-full flex-col place-content-center",$e.lightbox),children:[n.jsxs("section",{className:"grid grid-cols-[auto_1fr_auto] items-start px-1 pt-1 [view-transition-name:var(--vt-page-title)] max-md:absolute max-md:start-0 max-md:end-0 max-md:top-0 max-md:items-center md:grid-cols-[1fr_auto_1fr] md:px-2 md:pt-2",children:[n.jsx("div",{className:"w-fit",children:n.jsx(Fe,{icon:de,"data-lightbox-close-button":!0,onClick:()=>u(l),"aria-label":x.formatMessage({id:"f08aLO",defaultMessage:"Close"})})}),!g&&M,(r=!g&&A)!=null?r:n.jsx("div",{className:"w-8 shrink-0 basis-auto"})]}),n.jsxs("div",{className:"no-scrollbar flex h-full snap-y snap-mandatory flex-col overflow-y-scroll scroll-smooth",onScroll:i=>{i.target.scrollTop===0&&!v()&&u(l)},children:[n.jsx("div",{className:"h-[15dvh] flex-shrink-0"}),n.jsxs("ol",{ref:h,className:W("flex max-h-full min-h-0 flex-shrink-0 grow basis-full gap-[min(10dvw,_200px)] overflow-x-auto scroll-smooth [anchor-name:--carousel] [view-transition-name:var(--vt-image-carousel)] max-md:gap-0",w&&"no-scrollbar",!g&&"snap-x snap-mandatory snap-center snap-always py-15"),onClick:i=>{(i.target instanceof HTMLOListElement||i.target instanceof HTMLLIElement)&&(i.preventDefault(),u(l))},children:[n.jsx("li",{className:"w-[50vw] flex-shrink-0"}),L,n.jsx("li",{className:"w-[50vw] flex-shrink-0"})]}),n.jsx("div",{className:"h-[15dvh] flex-shrink-0"})]}),!g&&n.jsxs("div",{className:"pointer-events-none absolute inset-5 z-20 flex items-center justify-between [view-transition-name:var(--vt-scroll-buttons)] max-md:hidden",children:[n.jsx($,{className:"pointer-events-auto aspect-square",disabled:l===0,color:"secondary",icon:Ve,onClick:()=>_(-1),"aria-label":x.formatMessage({id:"iQsFWe",defaultMessage:"Previous image"})}),n.jsx($,{className:"pointer-events-auto aspect-square",color:"secondary",disabled:l===N,icon:We,onClick:()=>_(1),"aria-label":x.formatMessage({id:"W7vnD4",defaultMessage:"Next image"})})]}),!g&&q]})})}function he({children:e}){const{imageList:t,activeIndex:s}=z();if(s==null)return null;const a=t[s];return a?e(a):null}function ge({children:e}){const{imageList:t,isZoomed$:s,activeIndex:a}=z(),u=ue(),m=ce(),c=me(()=>s==null?void 0:s());return t.map((x,h)=>{var v;const{width:j,height:l}=x,y=j!=null&&l!=null&&j===l;let p=null;a!=null&&(h===a?p="current":h+1===a?p="before":h-1===a&&(p="after"));const w=!u&&p!=="current";return n.jsx("li",{role:w?"button":void 0,className:W("flex max-h-full max-w-[70dvw] flex-shrink-0 snap-center items-center justify-center transition-opacity duration-0 motion-safe:duration-300 max-md:w-[100dvw] max-md:max-w-[100dvw] max-md:snap-always max-md:opacity-100",y&&"aspect-square",p==="current"||c?"opacity-100":"opacity-40"),"data-position":h,onClick:w?({currentTarget:g})=>g.scrollIntoView({behavior:m?"instant":"smooth",block:"center",inline:"center"}):void 0,children:e(k(I({},x),{index:h,position:p}))},(v=x.id)!=null?v:x.url)})}function pe({children:e}){const{imageList:t,activeIndex:s}=z();if(s==null)return null;const a=t[s];return a?n.jsx("footer",{className:"absolute bottom-0 z-10 flex w-full items-center justify-center px-5 pb-3 [view-transition-name:var(--vt-page-footer)] max-md:pb-6",children:e(a)}):null}function Ye({children:e}){const t=[];return f.Children.forEach(e,s=>{f.isValidElement(s)&&s.type===et&&t.push(s)}),n.jsx("div",{className:"flex items-center justify-end gap-2",children:t.map((s,a)=>n.jsx(f.Fragment,{children:s},a))})}function et({children:e}){const{imageList:t,activeIndex:s}=z();return s==null||t[s]==null?null:e(t[s])}function tt(e,t,s=!1){const a=H.getTurnContentReferences(e,t),u=Be(a),m=nt(e,t),c=u.concat(m);if(s){const x=st(e,t);c.push(...x)}return Ge(c,"content_url")}function nt(e,t){const s=H.getConversationTurnAtIndex(e,t).messages;return s?qe(s.flatMap(a=>{var u,m;return(m=(u=a.metadata)==null?void 0:u.image_results)!=null?m:[]})).map(a=>k(I({},a),{thumbnail_url:a.thumbnail_url.replace(/^http:\/\//,"https://"),content_url:a.content_url.replace(/^http:\/\//,"https://")})):[]}function st(e,t){return H.getSuperWidgetMessages(e,t).flatMap(a=>a.content.widgets.images)}function at(e,t,s,a){const{product:u}=Qe({thread:e,messageId:t,contentReferenceStartIndex:s,productIndex:a});return!u||!u.image_urls?[]:u.image_urls.map(m=>({url:m,content_url:m,thumbnail_url:m,title:u.title,content_size:{width:0,height:0},thumbnail_size:{width:0,height:0}}))}function ft({clientThreadId:e}){const t=fe(),s=Ee(t)&&Ce(t),a=P.useCurrentImage();if(!a)return null;const{image:u,source:m,analyticsMetadata:c,contentReferenceStartIndex:x,productIndex:h}=a;if(m==null||e==null||(c==null?void 0:c.turnIndex)==null)return n.jsx(C,{image:u,analyticsMetadata:{}});const j=Le(e),l=function(){switch(m){case S.ProductDetails:return at(j,c.messageId,x,h);case S.SuperWidget:case S.ImageGroup:return a.imageResults;default:return tt(j,c.turnIndex,s)}}();return n.jsx(C,{image:u,group:l,analyticsMetadata:c,groupSource:m})}function xt(){const e=P.useCurrentImage();if(!e)return null;const{image:t,source:s}=e;if(s==null)return n.jsx(C,{image:t,analyticsMetadata:{}});switch(s){case S.ImagesTab:return n.jsx(it,{image:t});case S.Turn:return n.jsx(rt,{image:t});default:return null}}function it({image:e}){const{imageResults:t}=Je();return n.jsx(C,{image:e,group:t,groupSource:S.ImagesTab,analyticsMetadata:{}})}function rt({image:e}){const{imageResults:t}=Ze();return n.jsx(C,{image:e,group:t,groupSource:S.Turn,analyticsMetadata:{}})}var oe;const ae=ze.div(oe||(oe=J(["grow flex items-start p-8"]))),ot={enter:e=>({x:e>0?1e3:-1e3,opacity:0}),center:{zIndex:1,x:0,opacity:1},exit:e=>({zIndex:0,x:e<0?1e3:-1e3,opacity:0})},ie=1e4,lt=(e,t)=>Math.abs(e)*t;function C({image:e,group:t,groupSource:s,analyticsMetadata:a}){var L,M,A;const u=f.useRef(null),m=(L=e.attribution)!=null?L:D(e.url),c=P.useCurrentImage(),x=P.useStore(),h=c==null?void 0:c.mountDirection;f.useEffect(()=>{var i,o;(o=(i=window==null?void 0:window.history)==null?void 0:i.state)!=null&&o.imageModalOpen||window.history.pushState({imageModalOpen:!0},"",window.location.href);const r=()=>{var d,b;(b=(d=window==null?void 0:window.history)==null?void 0:d.state)!=null&&b.imageModalOpen||x.setCurrentImage(void 0)};return window.addEventListener("popstate",r),()=>window.removeEventListener("popstate",r)},[x]);const j=e.content_url.replace(/^http:\/\//,"https://"),l=(M=t==null?void 0:t.findIndex(r=>X(e,r)))!=null?M:0,y=(A=t==null?void 0:t.length)!=null?A:1,p=l!=null&&y>1,w=k(I({},Y(a)),{url:e.url,link_type:"text",section:"image",section_location:"response",section_index:(l+1).toString()});f.useEffect(()=>{u.current!==e.url&&(u.current=e.url,E.logEventWithStatsig("Search Content Reference Shown","search_content_reference_shown",k(I({},Y(a)),{type:"full_screen_image",url:e.url,image_url:j})),E.logEvent("link_action",k(I({},w),{action:"show"})))},[j]);const v=()=>{window.history.go(-1),x.setCurrentImage(void 0)},g=f.useCallback(r=>{if(!p||t==null)return;const i=r==="next"?(l+1)%t.length:(l-1+t.length)%t.length;x.setCurrentImage({image:t[i],source:s,mountDirection:r==="next"?te.FromRight:te.FromLeft,analyticsMetadata:a,contentReferenceStartIndex:c==null?void 0:c.contentReferenceStartIndex,productIndex:c==null?void 0:c.productIndex,imageResults:c==null?void 0:c.imageResults})},[p,t,x,l,s,a,c]),R=t!=null?t:[];Ie({queries:R.map(r=>He(r.thumbnail_url,"ImageResultModal"))});const N=fe(),_=Me(N,"2804795149"),q=f.useMemo(()=>t!=null?t:[e],[t,e]);return f.useEffect(()=>{if(!_)return Ae(document,{keydown:r=>{r.key==="ArrowRight"?g("next"):r.key==="ArrowLeft"&&g("prev")}})},[_,g]),_?n.jsxs(Xe,{forceDarkMode:!0,imageList:q,initialIndex:l,onClose:v,children:[p&&n.jsx(he,{children:r=>{var i;return n.jsxs("div",{className:"text-token-text-tertiary -mt-0.25 shrink-0 px-4 md:mt-0 md:py-2",children:[((i=t==null?void 0:t.findIndex(o=>X(r,o)))!=null?i:0)+1," /"," ",y]})}}),n.jsx(ge,{children:r=>n.jsx(re,{image:r,isNewLightbox:!0})}),n.jsx(pe,{children:r=>{var i;return n.jsx("div",{className:"flex w-full justify-start",children:n.jsx("div",{className:"w-fit rounded-xl backdrop-blur-xl",children:n.jsx(ee,{onClick:()=>{E.logEvent("link_action",k(I({},w),{action:"click"}))},onMouseEnter:()=>{E.logEvent("link_action",k(I({},w),{action:"hover"}))},href:r.is_proxied_image?r.content_url:r.url,className:"flex min-h-20 w-fit shrink-0 items-center gap-8 px-4 py-2 text-sm hover:opacity-70",children:n.jsxs("div",{className:"flex grow flex-col gap-0.5 overflow-hidden pe-2",children:[n.jsxs("div",{className:"text-token-text-tertiary flex items-center gap-2 truncate",children:[n.jsx(ne,{url:r.content_url,className:"rounded-sm",size:16}),(i=r.attribution)!=null?i:D(r.url)]}),n.jsx("div",{className:"truncate font-semibold text-white",children:r.title})]})})})})}})]}):n.jsx(K,{children:e&&n.jsx(V.Root,{isOpen:!0,onClose:v,testId:"modal-image-result",children:n.jsx(V.Overlay,{children:n.jsxs(Te,{className:"flex h-full w-full flex-col bg-black/95",children:[n.jsxs("div",{className:"relative flex w-full grow justify-center overflow-hidden",children:[n.jsxs("div",{className:"absolute end-4 top-4 flex items-center sm:end-6 sm:top-6",children:[p&&n.jsxs("div",{className:"text-token-text-tertiary shrink-0 px-4 py-2",children:[l+1," / ",y]}),n.jsx("button",{onClick:r=>{r.stopPropagation(),v()},className:"flex h-9 w-9 items-center justify-center outline-hidden hover:opacity-70",children:n.jsx(de,{className:"h-6 w-6 text-gray-400"})})]}),y>1&&n.jsx(ae,{className:"cursor-w-resize",onClick:r=>{r.stopPropagation(),g("prev")}}),n.jsx(K,{initial:!1,custom:h,children:n.jsx(le.div,{variants:ot,custom:h!=null?h:0,className:"absolute top-24 bottom-4",initial:"enter",animate:"center",exit:"exit",transition:{x:{type:"spring",stiffness:300,damping:30},opacity:{duration:.2}},drag:y>1?"x":!1,dragConstraints:{left:0,right:0},dragElastic:1,onDragEnd:(r,{offset:i,velocity:o})=>{const d=lt(i.x,o.x);d<-ie?g("next"):d>ie&&g("prev")},children:n.jsx(re,{image:e})},l)}),y>1&&n.jsx(ae,{className:"cursor-e-resize",onClick:r=>{r.stopPropagation(),g("next")}})]}),n.jsx(ee,{onClick:()=>{E.logEvent("link_action",k(I({},w),{action:"click"}))},onMouseEnter:()=>{E.logEvent("link_action",k(I({},w),{action:"hover"}))},href:e.is_proxied_image?e.content_url:e.url,className:"flex min-h-20 w-full shrink-0 items-center gap-8 px-6 pt-8 pb-3 text-sm hover:opacity-70 sm:px-8 sm:pb-8",children:n.jsxs("div",{className:"flex grow flex-col gap-0.5 overflow-hidden pe-2",children:[n.jsxs("div",{className:"text-token-text-tertiary flex items-center gap-2 truncate",children:[n.jsx(ne,{url:e.content_url,className:"rounded-sm",size:16}),m!=null?m:D(e.url)]}),n.jsx("div",{className:"truncate font-semibold text-white",children:e.title})]})})]})})})})}function re({image:e,isNewLightbox:t=!1}){const s=e.content_url.replace(/^http:\/\//,"https://"),a=e.thumbnail_url.replace(/^http:\/\//,"https://"),u=e.content_size.width/e.content_size.height,{isError:m}=se(s,"ModalImage_main"),{isError:c}=se(a,"ModalImage_thumbnail"),x=e.is_proxied_image?e.url:m?a:s;return!c||!m||e.is_proxied_image?n.jsx(le.img,{src:x,alt:e.title,style:{backgroundImage:a?"url(".concat(a,")"):void 0,backgroundSize:"contain",aspectRatio:u,backgroundPosition:"center",backgroundRepeat:"no-repeat"},initial:{opacity:0},animate:{opacity:1},className:Pe(t?"h-full max-w-full object-contain":"h-full max-w-[100vw] object-contain sm:max-w-[calc(100vw-10rem)]")}):n.jsx("div",{className:"flex h-full grow items-center justify-center",children:n.jsx("div",{className:"flex h-96 w-96 items-center justify-center bg-white/10",children:n.jsx(Ke,{className:"text-token-text-tertiary h-12 w-12"})})})}export{ft as ImageLightbox,xt as ImageLightboxSearchGPT};
//# sourceMappingURL=jq5pvmx1nfwz5so0.js.map
