var Je=Object.defineProperty,Xe=Object.defineProperties;var Qe=Object.getOwnPropertyDescriptors;var z=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,he=Object.prototype.propertyIsEnumerable;var fe=(t,s,o)=>s in t?Je(t,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[s]=o,A=(t,s)=>{for(var o in s||(s={}))pe.call(s,o)&&fe(t,o,s[o]);if(z)for(var o of z(s))he.call(s,o)&&fe(t,o,s[o]);return t},T=(t,s)=>Xe(t,Qe(s));var ee=(t,s)=>{var o={};for(var n in t)pe.call(t,n)&&s.indexOf(n)<0&&(o[n]=t[n]);if(t!=null&&z)for(var n of z(t))s.indexOf(n)<0&&he.call(t,n)&&(o[n]=t[n]);return o};import{j as e,r as m,b as L,f as X,M as l,a as Ee,d as te}from"./jj85rqzpbnvv3emr.js";import{bl as _e,Q as $e,gH as se,lS as Ke,lR as et,gb as Ae,mf as Te,bf as tt}from"./mclphevd122040jw.js";import{sp as st,sq as nt,sr as at,ss as ot,st as it,su as je,sv as rt,sw as lt,sx as dt,P as D,f as I,C as O,n9 as G,iI as ne,T as De,fv as Le,sy as W,B as b,id as ae,fy as M,n as ct,E as Y,hj as Oe,i as P,r as U,rJ as Ie,sz as J,aA as ut,e as oe,mE as We,sA as gt,rL as mt,b as xt,p4 as ft,sB as pt,sC as ht,sD as ve,sE as _t,q as jt}from"./lef5ym39glv4981l.js";import{g as vt}from"./g08pdp1xd9ej04d4.js";import{I as ye,U as be}from"./iat1dicirypi0umq.js";import{S as Fe}from"./be11s8wd1k6ws4r8.js";import{S as yt}from"./gd5k9khi2ma4fx2d.js";import{S as bt}from"./bw1pc0e22u0sxerz.js";import{S as wt}from"./n5wrqpcxv1sjah44.js";import{S as kt}from"./lg1dt73yupron4vu.js";import{S as Mt}from"./daioev77nl79ehf6.js";const H={isOpen:!0,type:"success",size:"custom",className:"max-w-xl",showCloseButton:!0,shouldIgnoreClickOutside:!0,hideSeparator:!0,noPadding:!0},St={google_drive:e.jsx(dt,{}),slack:e.jsx(lt,{}),github:e.jsx(rt,{}),sharepoint:e.jsx(je,{}),sharepoint_admin:e.jsx(je,{}),confluence:e.jsx(it,{}),dropbox:e.jsx(ot,{}),box:e.jsx(at,{}),linear:e.jsx(nt,{}),notion:e.jsx(st,{})},R=Object.fromEntries(Object.entries(St).map(([t,s])=>[t,T(A({},H),{title:s})])),q=R.google_drive,ds=R.slack;R.github;R.sharepoint;R.dropbox;R.box;R.linear;const cs="https://help.openai.com/en/articles/10847137",we="https://help.openai.com/en/articles/10929079",ke="https://help.openai.com/en/articles/10847137-internal-knowledge-on-chatgpt-faq#h_cdbef125bf",Me="https://support.google.com/cloudidentity/answer/182080",ie=({link:t,location:s})=>{D.logEventWithStatsig("Contextual Answers Help Link Clicked","chatgpt_contextual_answers_help_link_clicked",{link:t,location:s})},re=m.createContext({triggerLocation:"admin_settings"});re.Provider;const B=()=>{const t=m.useContext(re);if(!t)throw new Error("useTriggerLocation must be used within a TriggerLocationProvider");return t};function Ct({accountId:t,connectionId:s,onClose:o,onNext:n,secondaryButton:r,footerContent:a}){const i=L(),d=I(),g=m.useId(),[u,h]=m.useState(""),[x,v]=m.useState(null),[w,f]=m.useState(!1),{triggerLocation:k}=B(),{isLoading:j,refetch:p,data:y}=X({queryKey:["admin:connection_instance",s],queryFn:async()=>await M.admin_get_connection_instance(t,s)});m.useEffect(()=>{var _;(y==null?void 0:y.connection_config.knowledge_connector_type)==="google_drive_dwd"&&h((_=y.connection_config.admin_email_address)!=null?_:"")},[y]);const c=(y==null?void 0:y.connection_config.knowledge_connector_type)==="google_drive_dwd"?y.connection_config.service_account_credential_id:void 0,C=u.trim().length>0&&(!!x||c),S=async()=>{if(!(!C||!t||w)){f(!0);try{let _;x&&(_=await x.text()),await M.admin_connection_update_credential(t,s,{admin_email:u,new_service_credential_content:_,credential_id:c&&!_?c:void 0}),d.success(i.formatMessage({id:"q/AX/d",defaultMessage:"Credentials successfully updated."})),n()}catch(_){let N=i.formatMessage({id:"qbD4Az",defaultMessage:"Failed to update credentials."});const E=vt(_);E&&(N=i.formatMessage({id:"pzfjhv",defaultMessage:"Failed to update credentials: {error}"},{error:E.message})),D.logEventWithStatsig("Contextual Answers Admin Connection Config Change Error","chatgpt_contextual_answers_admin_connection_config_change_error",{connectorType:"google_drive_dwd",error:E==null?void 0:E.error_type,triggerLocation:k}),d.danger(N,{toastId:"gdrive_dwd_credentials_modal",loggingTitle:"Failed to update credentials",loggingDescription:"Failed to update credentials"})}finally{p(),f(!1)}}};return e.jsx(O,T(A({},q),{onClose:o,testId:"modal-gdrive-dwd-credentials",children:j?e.jsx(G,{lines:4,className:"px-6 pt-4 pb-10"}):e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:_=>{_.preventDefault(),C&&S()},className:"flex flex-col px-6 pt-4 pb-10",children:[e.jsx("button",{type:"submit",className:"display-none"}),e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xl font-medium",children:e.jsx(l,{id:"qq+Txa",defaultMessage:"Setup a new connection"})}),e.jsx("div",{className:"text-token-text-secondary mt-2",children:e.jsx(l,{id:"oXAF7U",defaultMessage:"First, read the <link>setup instructions</link>, then upload the service account key provided by Google.",values:{link:_=>e.jsx(ne,{href:we,className:"underline",onClick:()=>ie({link:we,location:"admin_onboarding_dwd_credentials"}),children:_})}})})]}),e.jsx(Nt,{existingServiceKeyId:c,serviceKeyFile:x,setServiceKeyFile:v}),e.jsxs("div",{className:"mb-2 flex flex-col gap-2",children:[e.jsxs("label",{htmlFor:g,className:"flex flex-row items-center gap-2 text-base font-medium",children:[e.jsx("span",{children:e.jsx(l,{id:"sPqjJA",defaultMessage:"Google Workspace admin email address"})}),e.jsx(De,{withArrow:!0,side:"top",label:e.jsx("p",{className:"p-1 text-sm",children:e.jsx(l,{id:"4xWSaU",defaultMessage:"Your workspace admin’s email address is required to configure user access and select which shared drives you’d like to sync."})}),children:e.jsx(Le,{className:"icon text-token-text-tertiary"})})]}),e.jsx("input",{type:"text",value:u,onChange:_=>h(_.target.value),placeholder:i.formatMessage({id:"+zP1RE",defaultMessage:"admin@example.com"}),id:g,className:"border-token-border-default bg-token-main-surface-primary text-token-text-primary rounded-lg border border-solid"})]})]})]}),e.jsx(W,{primaryButton:e.jsx(b,{loading:w,color:"primary",disabled:!C||w,onClick:S,children:e.jsx(l,{id:"+itf/D",defaultMessage:"Save"})}),secondaryButton:r,footerContent:a})]})}))}function Nt({existingServiceKeyId:t,serviceKeyFile:s,setServiceKeyFile:o}){const n=m.useRef(null),r=m.useId();return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("p",{className:"text-base font-medium",children:e.jsx(l,{id:"gI0O53",defaultMessage:"Service account key"})}),!!t&&!s&&e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[e.jsx(ae,{className:"icon-sm"}),e.jsx(l,{id:"B+/4/L",defaultMessage:"Service account key already exists."})]}),!!s&&e.jsx("p",{className:"text-token-text-secondary",children:s.name}),e.jsxs("div",{className:"flex flex-row gap-2",children:[!t&&!s&&e.jsx(b,{color:"primary",type:"button",onClick:()=>{var a;return(a=n.current)==null?void 0:a.click()},children:e.jsx(l,{id:"4GjErm",defaultMessage:"Upload key"})}),(!!t&&!s||!t&&!!s)&&e.jsx(b,{color:"secondary",type:"button",onClick:()=>{var a;return(a=n.current)==null?void 0:a.click()},children:e.jsx(l,{id:"qV3zuG",defaultMessage:"Replace key"})}),!!t&&!!s&&e.jsx(b,{color:"danger-outline",type:"button",onClick:()=>o(null),children:e.jsx(l,{id:"NFpNok",defaultMessage:"Clear"})})]}),e.jsx("input",{type:"file",className:"hidden",id:r,ref:n,onChange:a=>{a.target.files&&a.target.files.length>0?o(a.target.files[0]):o(null)},accept:".json"})]})}function Et({isOpen:t,onClose:s,connectionId:o,accountId:n,primaryButton:r,secondaryButton:a,footerContent:i}){const{refetch:d,data:g,error:u,isLoading:h}=X({queryFn:()=>Tt({accountId:n,connectionId:o}),queryKey:["admin_connection_list_item_scopes",o,"shared_drive"]});return e.jsxs(O,T(A({},q),{isOpen:t,onClose:s,testId:"modal-gdrive-dwd-shared-drive-picker",children:[e.jsx("div",{className:"flex flex-col gap-6 px-6 pt-4 pb-10",children:h?e.jsx(G,{lines:4}):u?e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx("div",{className:"text-token-text-error",children:e.jsx(l,{id:"3BZzpX",defaultMessage:"Something went wrong"})}),e.jsx("div",{children:e.jsx(b,{color:"secondary",icon:Fe,onClick:()=>d(),children:e.jsx(l,{id:"fFd9RR",defaultMessage:"Try again"})})})]}):e.jsx(e.Fragment,{children:g&&e.jsx(At,{accountId:n,connectionId:o,sharedDriveDefaultScope:g.default_selection,sharedDriveScopes:g.object_selections,refetch:d})})}),e.jsx(W,{primaryButton:r,secondaryButton:a,footerContent:i})]}))}function At({refetch:t,accountId:s,connectionId:o,sharedDriveDefaultScope:n,sharedDriveScopes:r}){const a=L(),i=I(),{isPending:d,mutate:g}=Ee({mutationFn:async u=>await M.admin_connection_update_item_default_scope(s,o,"shared_drive",u),mutationKey:["admin_connection_update_item_default_scope",o,"shared_drive"],onError:()=>{i.danger(a.formatMessage({id:"YnlDV7",defaultMessage:"Failed to update policy."}),{toastId:"gdrive_dwd_shared_drive_picker_modal",loggingTitle:"Failed to update policy",loggingDescription:"Failed to update policy"})},onSettled:()=>{t()}});return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"text-xl font-medium",children:e.jsx(l,{id:"CIWfUm",defaultMessage:"How do you want to handle Shared Drives?"})}),e.jsx("div",{className:"text-token-text-secondary text-sm",children:e.jsx(l,{id:"BXG6kp",defaultMessage:"Add any Shared Drives you’d like to exclude or include by default."})}),e.jsx(yt,{ariaLabel:a.formatMessage({id:"ca.scope-selector.aria-label",defaultMessage:"Select whether Shared drives are included or excluded from syncing by default."}),onChange:u=>{d||g(u)},value:n,leftItem:{ariaLabel:a.formatMessage(Z.includeToggleLabel),label:a.formatMessage(Z.includeToggleLabel),value:"include"},rightItem:{ariaLabel:a.formatMessage(Z.excludeToggleLabel),label:a.formatMessage(Z.excludeToggleLabel),value:"exclude"}}),d?e.jsx(G,{lines:3}):n==="include"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-token-text-secondary text-sm",children:e.jsx(l,{id:"dmDuO6",defaultMessage:"All Shared drives will be synced except for ones you choose to exclude."})}),e.jsx("p",{className:"text-token-text-secondary font-medium",children:e.jsx(l,{id:"buyi/M",defaultMessage:"Excluded Shared drives"})}),e.jsx("ul",{children:r.filter(u=>u.selection==="exclude").map(u=>e.jsx(ye,{objectHandle:u.object_handle,objectType:"shared_drive",accountId:s,connectionId:o,scopeChangeIcon:_e,scopeChangeLabel:a.formatMessage({id:"NLi7nF",defaultMessage:"Remove exclusion"}),scopeChangeTarget:"include",onError:()=>{i.danger(a.formatMessage({id:"tdBT+A",defaultMessage:"Failed to remove exclusion. Please try again later."}),{toastId:"gdrive_dwd_shared_drive_picker_modal",loggingTitle:"Failed to remove exclusion",loggingDescription:"Toast message shown when an item (e.g. file, channel, document, etc.) that the admin requested to un-exclude from syncing was unable to be un-excluded."})},onScopeUpdated:()=>{i.success(a.formatMessage({id:"AC/4a7",defaultMessage:"Sucessfully removed exclusion."})),t()}},u.object_handle))}),e.jsx(be,{objectType:"shared_drive",targetScopeSelection:"exclude",accountId:s,connectionId:o,buttonLabel:a.formatMessage({id:"ThGxVh",defaultMessage:"Exclude"}),onSuccess:()=>{i.success(a.formatMessage({id:"1hsj8s",defaultMessage:"Shared drive has been excluded."})),t()},onError:()=>{i.danger(a.formatMessage({id:"4JkX1y",defaultMessage:"Failed to exclude Shared drive. Please try again later."}),{toastId:"gdrive_dwd_shared_drive_picker_modal",loggingTitle:"Failed to exclude Shared drive",loggingDescription:"Toast message shown an admin tries to exclude a Google Drive Shared drive from being synced, but the operation failed."})}})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-token-text-secondary text-sm",children:e.jsx(l,{id:"Pa+iyD",defaultMessage:"Only the Shared drives you select will be synced."})}),e.jsx("p",{className:"text-token-text-secondary font-medium",children:e.jsx(l,{id:"e4EV27",defaultMessage:"Included Shared drives"})}),e.jsx("ul",{children:r.filter(u=>u.selection==="include").map(u=>e.jsx(ye,{objectHandle:u.object_handle,objectType:"shared_drive",accountId:s,connectionId:o,scopeChangeIcon:_e,scopeChangeLabel:a.formatMessage({id:"/oSk2L",defaultMessage:"Remove inclusion"}),scopeChangeTarget:"exclude",onError:()=>{i.danger(a.formatMessage({id:"JhaVH0",defaultMessage:"Failed to remove inclusion. Please try again later."}),{toastId:"gdrive_dwd_shared_drive_picker_modal",loggingTitle:"Failed to remove inclusion",loggingDescription:"Toast message shown when an item (e.g. file, channel, document, etc.) that the admin requested to un-include from syncing was unable to be un-included."})},onScopeUpdated:()=>{i.success(a.formatMessage({id:"m6h3gf",defaultMessage:"Sucessfully removed inclusion."})),t()}},u.object_handle))}),e.jsx(be,{objectType:"shared_drive",targetScopeSelection:"include",accountId:s,connectionId:o,buttonLabel:a.formatMessage({id:"At82Iq",defaultMessage:"Include"}),onSuccess:()=>{i.success(a.formatMessage({id:"IMoGWZ",defaultMessage:"Shared drive has been included."})),t()},onError:()=>{i.danger(a.formatMessage({id:"De2z4Y",defaultMessage:"Failed to include Shared drive. Please try again later."}),{toastId:"gdrive_dwd_shared_drive_picker_modal",loggingTitle:"Failed to include Shared drive",loggingDescription:"Toast message shown an admin tries to include a Google Drive Shared drive for syncing, but the operation failed."})}})]})]})}const Z=te({includeToggleLabel:{id:"ca.scope-selection.include-by-default",defaultMessage:"Include by default"},excludeToggleLabel:{id:"ca.scope-selection.exclude-by-default",defaultMessage:"Exclude by default"},includeUserDrivesLabel:{id:"pDGrBu",defaultMessage:"Include user-owned files?"}});async function Tt({accountId:t,connectionId:s}){const o=[];let n=await M.admin_connection_list_item_scopes(t,s,"shared_drive",null);for(o.push(n);n.page_token!=null;)n=await M.admin_connection_list_item_scopes(t,s,"shared_drive",n.page_token),o.push(n);return{object_type:"shared_drive",default_selection:o[0].default_selection,object_selections:o.flatMap(a=>a.object_selections)}}function Dt({isOpen:t,onClose:s,connectionId:o,accountId:n,isPostActivation:r,footerContent:a,primaryButton:i,secondaryButton:d}){const g=L(),u=I(),{refetch:h,data:x,error:v,isLoading:w}=X({queryFn:async()=>await M.admin_connection_list_item_scopes(n,o,"user_drive"),queryKey:["admin_connection_list_item_scopes",o,"user_drive"]}),{isPending:f,mutate:k}=Ee({mutationFn:async p=>await M.admin_connection_update_item_default_scope(n,o,"user_drive",p?"include":"exclude"),mutationKey:["admin_connection_update_item_default_scope",o,"user_drive"],onError:()=>{u.danger(g.formatMessage({id:"YnlDV7",defaultMessage:"Failed to update policy."}),{toastId:"gdrive_dwd_user_drives_modal",loggingTitle:"Failed to update policy",loggingDescription:"Failed to update policy"})},onSettled:()=>{h()}}),j=(x==null?void 0:x.default_selection)==="include";return e.jsxs(O,T(A({},q),{isOpen:t,onClose:s,testId:"modal-gdrive-dwd-user-drives",children:[e.jsx("div",{className:"flex flex-col gap-6 px-6 pt-4 pb-10",children:w?e.jsx(G,{lines:4}):v?e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx("div",{className:"text-token-text-error",children:e.jsx(l,{id:"3BZzpX",defaultMessage:"Something went wrong"})}),e.jsx("div",{children:e.jsx(b,{color:"secondary",icon:Fe,onClick:()=>h(),children:e.jsx(l,{id:"fFd9RR",defaultMessage:"Try again"})})})]}):r?e.jsx("div",{className:"group border-token-border-medium flex w-full flex-row items-center gap-4 rounded-xl border px-8 py-4",children:j?e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"icon-lg"}),e.jsx("p",{className:"grow",children:e.jsx(l,{id:"rWqZ31",defaultMessage:"User owned files in My Drives are being synced."})})]}):e.jsxs(e.Fragment,{children:[e.jsx(bt,{className:"icon-lg"}),e.jsx("p",{className:"grow",children:e.jsx(l,{id:"/dUChW",defaultMessage:"User owned files in My Drives are not being synced."})})]})}):e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"text-xl font-medium",children:e.jsx(l,{id:"K4ZFoX",defaultMessage:"How do you want to handle My Drives?"})}),e.jsx("div",{className:"text-token-text-secondary text-sm",children:e.jsx(l,{id:"kAW/VW",defaultMessage:"Choose whether you want to sync the My Drive folder for your users."})}),e.jsxs("div",{className:"group border-token-border-medium flex w-full flex-row items-center gap-4 rounded-xl border px-8 py-4",children:[e.jsx(ct,{checked:j,disabled:f,"aria-label":g.formatMessage(Se.includeUserDrivesLabel),onCheckedChange:()=>{!f&&k(!j)}}),e.jsx("p",{children:e.jsx(l,A({},Se.includeUserDrivesLabel))}),f&&e.jsx(Y,{}),e.jsx("div",{className:"grow"}),e.jsx(De,{label:e.jsx("p",{children:e.jsx(l,{id:"xJvlxk",defaultMessage:"Enable this setting to sync files in users' individual My Drives."})}),children:e.jsx($e,{className:"icon-lg text-token-text-tertiary"})})]}),e.jsxs("div",{className:"bg-token-main-surface-secondary text-token-text-primary flex w-full flex-row items-center gap-4 rounded-xl p-4",children:[e.jsx(Oe,{className:"icon-lg"}),e.jsx("span",{className:"text-token-text-secondary text-sm",children:e.jsx(l,{id:"4vN9WK",defaultMessage:"You will not be able to change whether user My Drives are included once the connection starts syncing data."})})]})]})}),e.jsx(W,{footerContent:a,primaryButton:i,secondaryButton:d})]}))}const Se=te({includeUserDrivesLabel:{id:"75ojp7",defaultMessage:"Include user My Drives?"}});function Ge({onClose:t,footerContent:s,primaryButton:o,secondaryButton:n,pageSize:r=Ke,accountId:a,connectionId:i,connectorType:d,fallbackEstimatedMaxNumUsers:g}){var de,ce,ue,ge,me;const u=L(),h=P(),x=U(h),[v,w]=m.useState(""),[f,k]=m.useState(0),j=Ie(),{data:p,isLoading:y}=se(x==null?void 0:x.getWorkspaceId(),f*r,v,r),{data:c,isLoading:C,refetch:S,error:_}=X({queryKey:["admin_connection_get_access_policy",i],queryFn:()=>M.admin_connection_get_access_policy(a,i)}),N=Math.ceil(((de=p==null?void 0:p.total)!=null?de:0)/r);f>=N&&N!==0&&k(Math.max(N-1,0));const[E,Be]=m.useState(!1),[Ve,Ye]=m.useState(0),Q=Ve>0||E,le=C||y||Q,$=(ue=(ce=c==null?void 0:c.limits)==null?void 0:ce.max_allowed_users)!=null?ue:g,K=$===-1,He=!j&&(K||((ge=c==null?void 0:c.allowed_users.length)!=null?ge:0)<$);return d==="google_drive_dwd"?c==null?e.jsx(O,T(A({},H),{title:J(d),onClose:t,testId:"modal-allowed-users-picker",children:e.jsx("div",{className:"flex min-h-64 items-center justify-center p-8",children:e.jsx(Y,{})})})):e.jsx(Wt,{accountId:a,connectorType:d,connectionId:i,areAllUsersAllowed:c==null?void 0:c.allow_all_in_workspace,allowedUserIds:c==null?void 0:c.allowed_users,onClose:t,numWorkspaceMembers:p==null?void 0:p.total,refetch:S,primaryButton:o,secondaryButton:n,footerContent:s}):e.jsxs(O,T(A({},H),{title:J(d),onClose:t,testId:"modal-allowed-users-picker",children:[e.jsxs("div",{className:"flex flex-col px-6 pt-4 pb-10",children:[e.jsx("div",{className:"mb-3 text-xl font-medium",children:e.jsx(l,{id:"5e46Ss",defaultMessage:"Which workspace members can use this?"})}),e.jsx("div",{className:"text-token-text-secondary mb-4",children:K?e.jsx("p",{children:e.jsx(l,{id:"Ny/DGR",defaultMessage:"You must also select yourself, these changes will be auto-saved"})}):C?e.jsx(G,{lines:1,className:"w-full"}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:e.jsx(l,{id:"Ny/DGR",defaultMessage:"You must also select yourself, these changes will be auto-saved"})}),e.jsx("p",{children:e.jsx(It,{numSelectedUsers:(me=c==null?void 0:c.allowed_users.length)!=null?me:0,maxAllowedUsers:$})})]})}),e.jsxs("div",{className:"mb-4 flex flex-row items-center",children:[e.jsxs("div",{className:"group relative",children:[e.jsx("input",{type:"text",value:v,onChange:V=>{w(V.target.value),k(0)},disabled:!!(c!=null&&c.allow_all_in_workspace),placeholder:u.formatMessage({id:"RWqomV",defaultMessage:"Search"}),className:"border-token-border-default bg-token-main-surface-primary text-token-text-primary rounded-lg border border-solid ps-10"}),e.jsx("div",{className:"absolute start-2 top-0 flex h-full w-8 items-center justify-center",children:e.jsx(ut,{className:"icon text-token-text-tertiary group-focus-within:text-token-text-secondary"})})]}),le&&e.jsx(Y,{className:"ms-4 h-4 w-4"})]}),_&&e.jsxs("div",{className:"my-2 flex flex-row items-center gap-2 rounded-lg bg-red-500 p-2 text-white",children:[e.jsx(Oe,{className:"icon inline"}),e.jsx(l,{id:"ZhxtEO",defaultMessage:"Failed to load allowed users."}),e.jsx("button",{onClick:()=>S(),className:"underline",children:e.jsx(l,{id:"y/IEAC",defaultMessage:"Try again"})})]}),e.jsx("div",{className:oe("h-[200px] max-h-[600px] overflow-y-auto px-2",(c==null?void 0:c.allow_all_in_workspace)&&"opacity-50"),children:e.jsx("table",{children:e.jsx("tbody",{children:p!=null&&p.items.length?p.items.map(({id:V,name:ze,email:Ze})=>{const xe=!!(c!=null&&c.allowed_users.includes(V));return e.jsx("tr",{className:"mb-2",children:e.jsx("td",{children:e.jsx(Lt,{controlDisabled:!xe&&!He||!!(c!=null&&c.allow_all_in_workspace)||E,userId:V,isUserEnabled:xe||!!(c!=null&&c.allow_all_in_workspace),accountId:a,connectionId:i,refetch:S,setNumPendingUserOperations:Ye,name:ze,email:Ze})})},V)}):e.jsx("tr",{children:e.jsx("td",{children:e.jsx(l,{id:"n3uhaN",defaultMessage:"No users found"})})})})})}),N>1&&e.jsx("div",{className:"my-4",children:e.jsx(et,{currentPage:f,onChangeIndex:k,length:N})}),K&&e.jsx(Ot,{allowAllInWorkspace:!!(c!=null&&c.allow_all_in_workspace),controlDisabled:le||j&&!(c!=null&&c.allow_all_in_workspace),refetch:S,accountId:a,connectionId:i,setShouldBlockOtherInteractions:Be})]}),e.jsx(W,{footerContent:s,primaryButton:Q&&o?m.cloneElement(o,{disabled:!0,onClick:()=>{}}):o,secondaryButton:Q&&n?m.cloneElement(n,{disabled:!0,onClick:()=>{}}):n})]}))}function Lt({userId:t,controlDisabled:s,isUserEnabled:o,refetch:n,setNumPendingUserOperations:r,accountId:a,connectionId:i,name:d,email:g}){const u=L(),h=I(),[x,v]=m.useState(!1),w=async j=>{if(!s){v(!0),r(p=>p+1);try{await M.admin_connection_allow_user(a,i,j),await n()}catch(p){h.danger(u.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}),{toastId:"allowed_users_modal",loggingTitle:"Something went wrong. Please try again.",loggingDescription:"Admin connection allow user error"})}finally{v(!1),r(p=>p-1)}}},f=async j=>{v(!0),r(p=>p+1);try{await M.admin_connection_disallow_user(a,i,j),await n()}catch(p){h.danger(u.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}),{toastId:"allowed_users_modal",loggingTitle:"Something went wrong. Please try again.",loggingDescription:"Admin connection disallow user error"})}finally{v(!1),r(p=>p-1)}},k=e.jsxs("p",{children:[e.jsx("span",{className:"text-token-text-primary",children:d}),e.jsx("span",{className:"text-token-text-tertiary ms-2",children:g})]});return e.jsx(Pe,{isLoading:x,id:"is-user-enabled--".concat(t),disabled:s,checked:o,onChange:j=>{s||x||(j.currentTarget.checked?w(t):f(t))},label:k})}function Ot({allowAllInWorkspace:t,controlDisabled:s=!1,accountId:o,connectionId:n,refetch:r,setShouldBlockOtherInteractions:a}){const i=L(),d=I(),[g,u]=m.useState(!1),h=async x=>{if(!s){u(!0),a(!0);try{await M.admin_connection_update_access_policy(o,n,x),await r()}catch(v){await r(),d.danger(i.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}),{toastId:"allowed_users_modal",loggingTitle:"Something went wrong. Please try again.",loggingDescription:"Access error"})}finally{u(!1),a(!1)}}};return e.jsx(Pe,{isLoading:g,id:"enabled-for-everyone-checkbox",checked:t,disabled:s,onChange:x=>{s||h(x.currentTarget.checked)},label:e.jsx("span",{className:"text-token-text-primary ms-2",children:e.jsx(l,{id:"MsFKpF",defaultMessage:"Enable for everyone"})})})}function Pe(o){var n=o,{isLoading:t}=n,s=ee(n,["isLoading"]);return t?e.jsxs("div",{className:"form-check flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4"}),e.jsx("div",{className:"form-check-label text-token-text-primary",children:s.label})]}):e.jsx(tt,A({},s))}function It({maxAllowedUsers:t,numSelectedUsers:s}){return s>=t?e.jsx(l,{id:"JWJ5gc",defaultMessage:"{numSelectedUsers, plural,\n          =0 {No users}\n          one {# user}\n          other {# users}\n        } selected. You cannot select any more.",values:{numSelectedUsers:s}}):s>0?e.jsx(l,{id:"dYtUgP",defaultMessage:"{numSelectedUsers, plural,\n          =0 {No users}\n          one {# user}\n          other {# users}\n        } selected. You can select up to {remainingAllowedUsers} more.",values:{numSelectedUsers:s,remainingAllowedUsers:t-s}}):e.jsx(l,{id:"nVfqBL",defaultMessage:"Select up to {maxAllowedUsers, plural,\n          =0 {No users}\n          one {# user}\n          other {# users}\n        }.",values:{maxAllowedUsers:t}})}function Wt({connectionId:t,connectorType:s,accountId:o,onClose:n,refetch:r,numWorkspaceMembers:a,areAllUsersAllowed:i,allowedUserIds:d,primaryButton:g,secondaryButton:u,footerContent:h}){const x=L(),[v,w]=m.useState(i?"allow_all":"allow_admins"),[f,k]=m.useState(!1),j=I(),{data:p}=se(o,0,void 0,100,void 0,["account-owner","account-admin"]),y=p==null?void 0:p.items,c=async()=>{if(!(y!=null&&y.length)||f)return;i!==!1&&await M.admin_connection_update_access_policy(o,t,!1);const _=new Set(y.map(E=>E.id));await Promise.all(y.map(E=>M.admin_connection_allow_user(o,t,E.id)));const N=(d!=null?d:[]).filter(E=>!_.has(E));await Promise.all(N.map(E=>M.admin_connection_disallow_user(o,t,E)))},C=async()=>{f||i||await M.admin_connection_update_access_policy(o,t,!0)},S=async()=>{k(!0);try{await(v==="allow_admins"?c():C()),await r()}catch(_){j.danger(x.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}),{toastId:"allowed_users_modal",loggingTitle:"Something went wrong. Please try again.",loggingDescription:"Error saving"})}finally{k(!1)}};return e.jsxs(O,T(A({},H),{title:J(s),onClose:n,testId:"modal-dwd-allowed-users-picker",children:[e.jsx("div",{className:"px-6 py-4 text-xl font-medium",children:e.jsx(l,{id:"5e46Ss",defaultMessage:"Which workspace members can use this?"})}),e.jsxs(Ae,{value:v,onValueChange:_=>w(_),className:"flex w-full flex-col gap-2 px-6 py-4",children:[e.jsx(Ce,{optionValue:"allow_all",Icon:wt,optionName:x.formatMessage({id:"vtytpk",defaultMessage:"Everyone"}),subtitle:a!=null?x.formatMessage({id:"15cHOa",defaultMessage:"{count} members"},{count:a}):e.jsx(G,{lines:1}),isSelected:v==="allow_all"}),e.jsx("div",{className:"border-token-border-default border-t"}),e.jsx(Ce,{optionValue:"allow_admins",Icon:Mt,subtitle:y!=null?y.length>3?x.formatList([...y.slice(3).map(_=>{var N;return(N=_.name)!=null?N:_.email}),x.formatMessage({id:"zb4UOk",defaultMessage:"{count} more"},{count:y.length-3})]):x.formatList(y.map(_=>{var N;return(N=_.name)!=null?N:_.email})):e.jsx(G,{lines:1}),optionName:x.formatMessage({id:"l0D/jy",defaultMessage:"Admins only"}),isSelected:v==="allow_admins"})]}),e.jsx(W,{footerContent:h,primaryButton:g?m.cloneElement(g,{disabled:f,loading:f,onClick:async _=>{var N,E;await S(),(E=(N=g.props).onClick)==null||E.call(N,_)}}):e.jsx(b,{color:"primary",onClick:S,loading:f,disabled:f,children:e.jsx(l,{id:"+itf/D",defaultMessage:"Save"})}),secondaryButton:f&&u?m.cloneElement(u,{disabled:!0,onClick:()=>{}}):u})]}))}function Ce({optionName:t,optionValue:s,subtitle:o,Icon:n,isSelected:r,disabled:a}){const i=r?kt:We;return e.jsxs(Te,{value:s,id:"dwd-allowed-users-option-".concat(s),className:oe("flex w-full items-center justify-start gap-4",a&&"opacity-50"),disabled:a,children:[e.jsx("div",{className:"bg-token-bg-tertiary flex h-[40px] w-[40px] items-center justify-center rounded-xl",children:e.jsx(n,{className:"icon-lg"})}),e.jsxs("div",{className:"grow",children:[e.jsx("div",{className:"text-token-text-primary text-start",children:t}),e.jsx("div",{className:"text-token-text-secondary mt-1 text-start text-sm text-wrap",children:o})]}),e.jsx(i,{className:"icon-lg shrink-0"})]})}function Ft({connectionDisplayInfo:t}){return e.jsxs("span",{className:"bg-token-main-surface-secondary rounded-xl px-2 py-1 font-bold whitespace-nowrap",children:[t.icon_url&&e.jsx("img",{src:t.icon_url,alt:"",className:"icon-sm me-2 inline"}),t.display_name]})}function Gt({isOpen:t,onClose:s,onActivate:o,connectionId:n,accountId:r,connectionDisplayInfo:a,footerContent:i,secondaryButton:d,connectorType:g}){const u=L(),h=I(),x=Ie(),{triggerLocation:v}=B(),[w,f]=m.useState(!1),k=()=>{f(!0),M.admin_activate_connection_instance(r,n).then(()=>{D.logEventWithStatsig("Contextual Answers Admin Connection Activated","chatgpt_contextual_answers_admin_connection_activated",{connectorType:g,triggerLocation:v}),h.success(u.formatMessage({id:"y5DD0Z",defaultMessage:"Connection successfully activated."})),o==null||o(),s==null||s()}).catch(()=>{h.danger(u.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}),{toastId:"review_and_activate_modal",loggingTitle:"Failed to activate connection",loggingDescription:"Failed to activate connection"})}).finally(()=>{f(!1)})},j=e.jsx(b,{color:"primary",loading:w,onClick:k,disabled:x,children:e.jsx(l,{id:"C2dZRO",defaultMessage:"Done"})});return e.jsxs(O,T(A({},H),{testId:"modal-review-and-activate",isOpen:t,onClose:s,title:J(g),children:[e.jsxs("div",{className:"flex flex-col gap-3 px-6 pt-4 pb-10",children:[e.jsx("div",{className:"text-xl font-medium",children:e.jsx(l,{id:"38WXzu",defaultMessage:"Review"})}),e.jsx("p",{className:"text-token-text-secondary text-sm",children:e.jsx(l,{id:"yQhjtE",defaultMessage:"Confirm everything looks good to you, then click the button to activate the connection and start syncing. "})}),e.jsx(Ft,{connectionDisplayInfo:a})]}),e.jsx(W,{primaryButton:x?e.jsx(gt,{children:j}):j,secondaryButton:d,footerContent:i})]}))}function Ue({steps:t,onClose:s}){var g,u;const o=t.length,[n,r]=m.useState(0),a=(g=t[0])==null?void 0:g.connectorType,i=(u=t[0])==null?void 0:u.name;m.useEffect(()=>{!a||!i||D.logEventWithStatsig("Contextual Answers Admin Create Connection Step","chatgpt_contextual_answers_admin_create_connection_step",{connectorType:a,stepName:i})},[a,i]);const d=h=>{r(h),!(h<0||h>=t.length)&&D.logEventWithStatsig("Contextual Answers Admin Create Connection Step","chatgpt_contextual_answers_admin_create_connection_step",{connectorType:t[h].connectorType,stepName:t[h].name})};return n<t.length?t[n].fn({goForward:n<o-1?()=>d(n+1):void 0,goBackward:n>0?()=>d(n-1):void 0,close:s,stepNumber:n,totalSteps:o}):null}const Pt=-1;function Re(t){return qe(t.knowledge_connector_type)}function qe(t){return t?t==="google_drive_oauth"?25:t==="sharepoint"?10:Pt:0}const us={max_instances:0};function Ut({onClose:t,backButton:s}){const[o,n]=m.useState(),r=P(),a=U(r);return a?o?e.jsx(qt,{accountId:a.id,connection:o,onClose:()=>t(!0)}):e.jsx(Rt,{onClose:t,backButton:s,setConnection:n}):null}function Rt({onClose:t,setConnection:s,backButton:o}){const n=L(),r=I(),a=P(),i=U(a),d=m.useId(),{triggerLocation:g}=B();m.useEffect(()=>{D.logEventWithStatsig("Contextual Answers Admin Create Connection Step","chatgpt_contextual_answers_admin_create_connection_step",{connectorType:"google_drive_dwd",stepName:"basic_info",triggerLocation:g})},[g]);const[u,h]=m.useState(""),x=u.length>128,v=u.trim().length>0&&!x,[w,f]=m.useState(!1),k=m.useCallback(()=>{!v||!i||w||(f(!0),M.admin_create_connection_instance(i.id,{knowledge_connector_type:"google_drive_dwd",connection_config_id:"--fake-local-id"},u.trim()).then(j=>{s(j)}).catch(()=>{r.danger(n.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}),{toastId:"gdrive_dwd_setup_flow",loggingTitle:"Failed to create connection",loggingDescription:"Failed to create connection"})}).finally(()=>{f(!1)}))},[i,u,n,v,w,s,r]);return e.jsxs(O,T(A({},q),{onClose:()=>t==null?void 0:t(),testId:"modal-gdrive-dwd-basic-info",children:[e.jsxs("form",{onSubmit:j=>{j.preventDefault(),v&&k()},className:"flex flex-col px-6 pt-4 pb-10",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{htmlFor:d,className:"text-xl font-medium",children:e.jsx(l,{id:"+wLWeZ",defaultMessage:"Enter display name"})}),e.jsx("input",{type:"text",value:u,onChange:j=>h(j.target.value),id:d,className:"border-token-border-default bg-token-main-surface-primary text-token-text-primary rounded-lg border border-solid"}),e.jsx("div",{className:"text-token-text-tertiary text-sm",children:e.jsx(l,{id:"CPXVQO",defaultMessage:"This is the name your members will see in their ChatGPT connectors."})}),x?e.jsx("p",{className:"text-red-500",children:e.jsx(l,{id:"vT7EGU",defaultMessage:"Name is too long."})}):null]}),e.jsx("button",{type:"submit",className:"display-none"})]}),e.jsx(W,{secondaryButton:o,primaryButton:e.jsx(b,{color:"primary",disabled:!v||w,loading:w,onClick:k,children:e.jsx(l,{id:"lZthRm",defaultMessage:"Save Draft and Continue"})})})]}))}function qt({connection:t,accountId:s,onClose:o}){return e.jsx(Ue,{onClose:o,steps:[{connectorType:"google_drive_dwd",name:"credential",fn:({goForward:n,close:r,stepNumber:a,totalSteps:i})=>e.jsx(Ct,{onClose:()=>r==null?void 0:r(),accountId:s,connectionId:t.connection_config.connection_config_id,onNext:n!=null?n:()=>null,footerContent:e.jsx("span",{className:"text-token-text-secondary flex-1 align-middle font-medium",children:e.jsx(l,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:a+1,totalSteps:i}})})})},{connectorType:"google_drive_dwd",name:"user_drives",fn:({goForward:n,goBackward:r,close:a,stepNumber:i,totalSteps:d})=>e.jsx(Dt,{onClose:()=>a==null?void 0:a(),accountId:s,connectionId:t.connection_config.connection_config_id,primaryButton:n&&e.jsx(b,{color:"primary",onClick:n,children:e.jsx(l,{id:"z5fExR",defaultMessage:"Next"})}),secondaryButton:r&&e.jsx(b,{color:"secondary",onClick:r,children:e.jsx(l,{id:"xJnONr",defaultMessage:"Back"})}),footerContent:e.jsx("span",{className:"text-token-text-secondary flex-1 align-middle font-medium",children:e.jsx(l,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:i+1,totalSteps:d}})}),isOpen:!0,isPostActivation:!1})},{connectorType:"google_drive_dwd",name:"shared_drives",fn:({goForward:n,goBackward:r,close:a,stepNumber:i,totalSteps:d})=>e.jsx(Et,{onClose:()=>a==null?void 0:a(),accountId:s,connectionId:t.connection_config.connection_config_id,primaryButton:n&&e.jsx(b,{color:"primary",onClick:n,children:e.jsx(l,{id:"z5fExR",defaultMessage:"Next"})}),secondaryButton:r&&e.jsx(b,{color:"secondary",onClick:r,children:e.jsx(l,{id:"xJnONr",defaultMessage:"Back"})}),footerContent:e.jsx("span",{className:"text-token-text-secondary flex-1 align-middle font-medium",children:e.jsx(l,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:i+1,totalSteps:d}})}),isOpen:!0})},{connectorType:"google_drive_dwd",name:"allowed_users",fn:({goForward:n,goBackward:r,close:a,stepNumber:i,totalSteps:d})=>e.jsx(Ge,{connectorType:"google_drive_dwd",fallbackEstimatedMaxNumUsers:Re(t.connection_config),onClose:()=>a==null?void 0:a(),accountId:s,connectionId:t.connection_config.connection_config_id,primaryButton:n&&e.jsx(b,{color:"primary",onClick:n,children:e.jsx(l,{id:"z5fExR",defaultMessage:"Next"})}),secondaryButton:r&&e.jsx(b,{color:"secondary",onClick:r,children:e.jsx(l,{id:"xJnONr",defaultMessage:"Back"})}),footerContent:e.jsx("span",{className:"text-token-text-secondary flex-1 align-middle font-medium",children:e.jsx(l,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:i+1,totalSteps:d}})})})},{connectorType:"google_drive_dwd",name:"review_and_activate",fn:({goBackward:n,close:r,stepNumber:a,totalSteps:i})=>e.jsx(Gt,{isOpen:!0,onClose:()=>r==null?void 0:r(),accountId:s,connectorType:"google_drive_dwd",connectionId:t.connection_config.connection_config_id,connectionDisplayInfo:t.display_info,secondaryButton:n&&e.jsx(b,{color:"secondary",onClick:n,children:e.jsx(l,{id:"xJnONr",defaultMessage:"Back"})}),footerContent:e.jsx("span",{className:"text-token-text-secondary flex-1 align-middle font-medium",children:e.jsx(l,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:a+1,totalSteps:i}})})})}]})}const Bt=({domainName:t,intl:s})=>t.trim().toLocaleLowerCase()==="gmail.com"?{valid:!1,errorType:"domainChecker.error.gmail",error:s.formatMessage({id:"domainChecker.error.gmail",defaultMessage:"Personal Google Accounts (e.g. gmail.com) are not supported"})}:{valid:!0},Vt=({domainName:t,intl:s})=>{const o=t.trim();if(/^https?:\/\//i.test(o))return{valid:!1,errorType:"domainChecker.error.noHttp",error:s.formatMessage({id:"domainChecker.error.noHttp",defaultMessage:"Do not include http:// or https:// in the domain."})};if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o))return{valid:!1,errorType:"domainChecker.error.noEmail",error:s.formatMessage({id:"domainChecker.error.noEmail",defaultMessage:"Do not use an email address. Use only the domain name."})};if(/[^a-zA-Z0-9.-]/.test(o))return{valid:!1,errorType:"domainChecker.error.invalidCharacters",error:s.formatMessage({id:"domainChecker.error.invalidCharacters",defaultMessage:"Domain contains invalid characters. Only letters, numbers, hyphens, and dots are allowed."})};const n=o.split(".");if(n.length<2)return{valid:!1,errorType:"domainChecker.error.missingDot",error:s.formatMessage({id:"domainChecker.error.missingDot",defaultMessage:"Domain must include at least one dot (e.g., example.com)."})};for(const a of n){if(!a)return{valid:!1,errorType:"domainChecker.error.emptySection",error:s.formatMessage({id:"domainChecker.error.emptySection",defaultMessage:"Domain has empty sections between dots (e.g., '..' or '.com.')."})};if(a.length>63)return{valid:!1,errorType:"domainChecker.error.labelTooLong",error:s.formatMessage({id:"domainChecker.error.labelTooLong",defaultMessage:"Each part of the domain must be 63 characters or less."})};if(!/^[a-zA-Z0-9-]+$/.test(a))return{valid:!1,errorType:"domainChecker.error.invalidLabelCharacters",error:s.formatMessage({id:"domainChecker.error.invalidLabelCharacters",defaultMessage:'Domain label "{label}" has invalid characters.'},{label:a})};if(/^-|-$/.test(a))return{valid:!1,errorType:"domainChecker.error.hyphenPosition",error:s.formatMessage({id:"domainChecker.error.hyphenPosition",defaultMessage:'Domain label "{label}" cannot start or end with a hyphen.'},{label:a})}}const r=n[n.length-1];return r.length<2||!/^[a-zA-Z]+$/.test(r)?{valid:!1,errorType:"domainChecker.error.invalidTLD",error:s.formatMessage({id:"domainChecker.error.invalidTLD",defaultMessage:"Top-level domain must be at least 2 letters."})}:{valid:!0}};function Yt({onClose:t,backButton:s}){const[o,n]=m.useState(),r=P(),a=U(r);return a?o?e.jsx(Zt,{accountId:a.id,connection:o,onClose:t}):e.jsx(Ht,{onClose:t,backButton:s,setConnection:n}):null}function Ht({onClose:t,setConnection:s,backButton:o}){const n=L(),r=I(),a=P(),i=U(a),d=m.useId(),{triggerLocation:g}=B();m.useEffect(()=>{D.logEventWithStatsig("Contextual Answers Admin Create Connection Step","chatgpt_contextual_answers_admin_create_connection_step",{connectorType:"google_drive_oauth",stepName:"basic_info",triggerLocation:g})},[g]);const u=xt(),h=m.useMemo(()=>{var C;const c=(C=u==null?void 0:u.email)==null?void 0:C.split("@")[1];return c&&u.email_domain_type!=="social"?c:""},[u]),[x,v]=m.useState(h),[w,f]=m.useState(""),k=m.useCallback(c=>{let{valid:C,error:S,errorType:_}=Bt({domainName:c,intl:n});return C&&({valid:C,error:S,errorType:_}=Vt({domainName:c,intl:n})),S&&D.logEventWithStatsig("Contextual Answers Admin Connection Config Change Error","chatgpt_contextual_answers_admin_connection_config_change_error",{connectorType:"google_drive_oauth",stepName:"basic_info",error:"invalid_domain-".concat(_),triggerLocation:g}),{valid:C,error:S}},[n,g]),[j,p]=m.useState(!1),y=m.useCallback(async()=>{if(!x||!i)return;const{valid:c,error:C}=k(x);if(f(C!=null?C:""),!!c){p(!0);try{const S=await M.admin_create_connection_instance(i.id,{knowledge_connector_type:"google_drive_oauth",domain_name:x,connection_config_id:"--fake-local-id"});u&&await M.admin_connection_allow_user(i.id,S.connection_config.connection_config_id,u.id),await M.admin_activate_connection_instance(i.id,S.connection_config.connection_config_id),D.logEventWithStatsig("Contextual Answers Admin Connection Activated","chatgpt_contextual_answers_admin_connection_activated",{connectorType:"google_drive_oauth",connectionId:S.connection_config.connection_config_id,triggerLocation:g}),s(S)}catch(S){r.danger(n.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}),{toastId:"gdrive_oauth_setup_flow",loggingTitle:"Failed to create connection",loggingDescription:"Failed to create connection"})}finally{p(!1)}}},[i,x,n,s,r,u,k,g]);return e.jsxs(O,T(A({},q),{onClose:()=>t==null?void 0:t(),testId:"modal-gdrive-basic-info",children:[e.jsxs("form",{onSubmit:c=>{c.preventDefault(),y()},className:"flex flex-col px-6 pt-4 pb-10",children:[e.jsxs("label",{htmlFor:d,children:[e.jsx("div",{className:"mb-4 text-xl font-medium",children:e.jsx(l,{id:"EbU972",defaultMessage:"Enter your Google Workspace domain"})}),e.jsx("div",{className:"text-token-text-secondary mb-4 text-sm font-normal",children:e.jsx(l,{id:"i83LbI",defaultMessage:"Only users from this Google Workspace domain will be able to connect their account. You domain name should look like example.com"})})]}),e.jsx(ft,{type:"text",value:x,placeholder:"example.com",onChange:c=>{v(c.target.value),f("")},onBlur:()=>{const{error:c}=k(x);f(c!=null?c:"")},name:d,ariaLabel:"Domain name",className:"border-token-border-default bg-token-main-surface-primary text-token-text-primary rounded-lg border border-solid",error:w}),e.jsxs("div",{className:"bg-token-main-surface-secondary text-token-text-primary mt-6 flex w-full flex-row items-center gap-4 rounded-xl p-4",children:[e.jsx(Le,{className:"icon-lg"}),e.jsx("div",{children:e.jsx("div",{className:"text-token-text-secondary text-sm font-medium",children:e.jsx(l,{id:"N7rcxx",defaultMessage:"<link>Read our guide</link> to ensure you’ve added the correct domain name.",values:{link:c=>e.jsx(ne,{href:Me,className:"text-token-text-secondary text-sm underline",onClick:()=>ie({link:Me,location:"admin_onboarding_basic_info"}),children:c})}})})})]}),e.jsx("button",{type:"submit",className:"display-none"})]}),e.jsx(W,{primaryButton:e.jsx(b,{color:"primary",disabled:x.trim()===""||!!w,loading:j,onClick:y,children:e.jsx(l,{id:"+itf/D",defaultMessage:"Save"})}),secondaryButton:o})]}))}function zt({onClose:t,onSuccess:s,connection:o,accountId:n}){const{triggerLocation:r}=B();m.useEffect(()=>{D.logEventWithStatsig("Contextual Answers Admin Create Connection Step","chatgpt_contextual_answers_admin_create_connection_step",{connectorType:"google_drive_oauth",stepName:"quickstart",triggerLocation:r})},[r]);const a=async()=>{await M.admin_activate_connection_instance(n,o.connection_config.connection_config_id),D.logEventWithStatsig("Contextual Answers Admin Connection Activated","chatgpt_contextual_answers_admin_connection_activated",{connectorType:"google_drive_oauth",connectionId:o.connection_config.connection_config_id,adminQuickstart:!0,triggerLocation:r}),s()};return e.jsx(mt,{connectionId:o.connection_config.connection_config_id,location:"admin_connection_quickstart",isAdminFlow:!0,isAdminQuickstartFlow:!0,onClose:()=>{t==null||t()},onSuccess:a,accountId:n})}function Zt({connection:t,accountId:s,onClose:o,hasAdminAlreadyConnected:n=!1}){const r=L(),a=[{connectorType:"google_drive_oauth",name:"allowed_users",fn:({goForward:i,close:d})=>e.jsx(Ge,{connectorType:"google_drive_oauth",fallbackEstimatedMaxNumUsers:Re(t.connection_config),onClose:()=>d==null?void 0:d(),accountId:s,connectionId:t.connection_config.connection_config_id,primaryButton:n?e.jsx(b,{color:"primary",onClick:()=>o(),children:r.formatMessage(F.finish)}):i&&e.jsx(b,{color:"primary",onClick:i,children:r.formatMessage(F.continue)})})}];return n||a.push({connectorType:"google_drive_oauth",name:"admin_oauth_disclaimer",fn:({goForward:i,goBackward:d,close:g})=>e.jsx(pt,{isOpen:!0,onClose:()=>g==null?void 0:g(),isAdminFlow:!0,isAdminQuickstartFlow:!1,secondaryButton:d&&e.jsx(b,{color:"secondary",onClick:d,children:r.formatMessage(F.back)}),primaryButton:e.jsx(b,{color:"primary",onClick:i,children:r.formatMessage(F.continue)})})},{connectorType:"google_drive_oauth",name:"admin_oauth_cta",fn:({goForward:i,goBackward:d,close:g})=>e.jsx(ht,{isOpen:!0,onClose:()=>g==null?void 0:g(),secondaryButton:d&&e.jsx(b,{color:"secondary",onClick:d,children:r.formatMessage(F.back)}),primaryButton:e.jsx(ve,{onSuccess:()=>g==null?void 0:g(!0),onError:()=>i==null?void 0:i(),label:r.formatMessage(F.loginWithGoogle),connectionId:t.connection_config.connection_config_id,connectorType:"google_drive_oauth",location:"admin_flow"})})},{connectorType:"google_drive_oauth",name:"admin_oauth_error",fn:({close:i})=>e.jsx(_t,{isOpen:!0,onClose:()=>i==null?void 0:i(),primaryButton:e.jsx(ve,{onSuccess:()=>i==null?void 0:i(),label:r.formatMessage(F.reconnect),connectionId:t.connection_config.connection_config_id,connectorType:"google_drive_oauth",location:"admin_flow",isReconnect:!0})})}),e.jsx(Ue,{onClose:o,steps:a})}const F=te({back:{id:"RDaXnk",defaultMessage:"Back"},cancel:{id:"CfN1/v",defaultMessage:"Cancel"},continue:{id:"XGnWba",defaultMessage:"Continue"},loginWithGoogle:{id:"9ImAmL",defaultMessage:"Log in with Google"},reconnect:{id:"0qUCBD",defaultMessage:"Reconnect"},finish:{id:"5Wpd39",defaultMessage:"Finish"}});function gs(o){var n=o,{triggerLocation:t}=n,s=ee(n,["triggerLocation"]);var g;const r=P(),a=U(r),{data:i,isLoading:d}=se(a==null?void 0:a.getWorkspaceId(),0,void 0,1);return i||!d?e.jsx(re.Provider,{value:{triggerLocation:t},children:e.jsx(Jt,A({numUsersInWorkspace:(g=i==null?void 0:i.total)!=null?g:0},s))}):e.jsx(O,T(A({testId:"modal-gdrive-add-workspace-loader"},q),{isOpen:!0,onClose:s.onClose,children:e.jsx("div",{className:"flex min-h-64 items-center justify-center p-8",children:e.jsx(Y,{})})}))}function Jt({onClose:t,numUsersInWorkspace:s,isDwdEnabled:o}){const n=s>=qe("google_drive_oauth")&&o,[r,a]=m.useState(n?"gdrive-dwd":"gdrive-oauth"),[i,d]=m.useState(!0),[g,u]=m.useState(),[h,x]=m.useState(!1),v=i&&o&&!g,w=P(),f=U(w),k=async()=>{const p=jt(w,"516806730").get("quickstart_enabled");if(!(r==="gdrive-oauth"&&p)){d(!1);return}if(!(!(f!=null&&f.id)||g))try{x(!0),u(await M.admin_create_connection_instance(f.id,{knowledge_connector_type:"google_drive_oauth",domain_name:"",connection_config_id:"--fake-local-id"}))}catch(y){t()}finally{x(!1)}},{triggerLocation:j}=B();return m.useEffect(()=>{D.logEventWithStatsig("Contextual Answers Admin Create Connection Step","chatgpt_contextual_answers_admin_create_connection_step",{connectorType:"google_drive",stepName:"options",triggerLocation:j})},[j]),e.jsxs(e.Fragment,{children:[e.jsxs(O,T(A({testId:"modal-gdrive-add-workspace"},q),{isOpen:v,onClose:t,children:[e.jsx("div",{className:"px-6 pt-4 pb-10",children:e.jsx(Xt,{preferDwd:n,selectedConnector:r,setSelectedConnector:a})}),e.jsx(W,{footerContent:e.jsx(ne,{href:ke,className:"text-token-text-secondary text-sm underline",onClick:()=>ie({link:ke,location:"admin_onboarding_gdrive_options"}),children:e.jsx(l,{id:"ADGK4d",defaultMessage:"Which option is right for my team?"})}),primaryButton:e.jsx(b,{color:"primary",onClick:k,loading:h,disabled:h,children:e.jsx(l,{id:"z5fExR",defaultMessage:"Next"})}),secondaryButton:e.jsx(b,{color:"secondary",onClick:()=>t(),disabled:h,children:e.jsx(l,{id:"5Oo8TW",defaultMessage:"Cancel"})})})]})),!v&&(g&&f?e.jsx(zt,{onClose:()=>{d(!0),u(void 0),t()},onSuccess:()=>{d(!0),u(void 0),t(!0)},connection:g,accountId:f.id}):r==="gdrive-oauth"?e.jsx(Yt,{onClose:p=>{t(p),d(!0)},backButton:o&&e.jsx(b,{color:"secondary",onClick:()=>d(!0),children:e.jsx(l,{id:"xJnONr",defaultMessage:"Back"})})}):r==="gdrive-dwd"?e.jsx(Ut,{onClose:p=>{t(p),d(!0)},backButton:e.jsx(b,{color:"secondary",onClick:()=>d(!0),children:e.jsx(l,{id:"xJnONr",defaultMessage:"Back"})})}):null)]})}function Xt({selectedConnector:t,setSelectedConnector:s,preferDwd:o}){const n=L(),r=e.jsx(Ne,{optionValue:"gdrive-oauth",optionName:n.formatMessage({id:"vIdj3/",defaultMessage:"Self-service setup"}),isSelected:t==="gdrive-oauth",checkedBulletPoints:[n.formatMessage({id:"hXiuKC",defaultMessage:"Each member must authenticate their account"})]}),a=e.jsx(Ne,{optionValue:"gdrive-dwd",optionName:n.formatMessage({id:"ZNfVoO",defaultMessage:"Admin-managed setup"}),isSelected:t==="gdrive-dwd",checkedBulletPoints:[n.formatMessage({id:"A/omIq",defaultMessage:"Recommended for large teams"}),n.formatMessage({id:"1W662S",defaultMessage:"Centralized setup with service account credentials"})]});return e.jsxs("div",{children:[e.jsx("div",{className:"-mt-2 mb-6 text-start text-lg font-medium",children:e.jsx(l,{id:"JKSyU3",defaultMessage:"Choose how your team connects Google Drive"})}),e.jsx(Ae,{value:t,onValueChange:i=>s(i),className:"flex w-full flex-col gap-4",children:o?e.jsxs(e.Fragment,{children:[a,r]}):e.jsxs(e.Fragment,{children:[r,a]})})]})}function Ne({optionName:t,optionValue:s,isSelected:o,checkedBulletPoints:n,disabled:r}){const a=o?ae:We;return e.jsxs(Te,{value:s,id:"connector-group-option-".concat(s),className:oe("border-token-border-heavy flex w-full justify-between rounded-xl border border-solid p-4",r&&"opacity-50",o&&"border-token-text-primary"),disabled:r,children:[e.jsxs("div",{className:"max-w-96 shrink-0",children:[e.jsx("div",{className:"text-start font-medium",children:t}),e.jsx("div",{className:"font-tertiary mt-1 text-start text-sm",children:n.length&&e.jsx("ul",{className:"text-token-text-secondary mt-1 mb-2 flex-1 list-inside list-disc",children:n.map((i,d)=>e.jsx("li",{className:"text-sm",children:i},d))})})]}),e.jsx(a,{className:"icon-lg shrink-0"})]})}export{Ge as A,R as C,us as D,gs as G,Ue as M,Gt as R,Pt as S,ds as a,Ct as b,Dt as c,Et as d,Ft as e,H as f,Re as g,cs as h,ie as t,B as u};
//# sourceMappingURL=ox4t38w0o8phwghu.js.map
