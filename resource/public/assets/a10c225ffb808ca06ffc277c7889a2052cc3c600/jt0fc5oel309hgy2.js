const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/d448b1vfu6r7o26l.js","assets/jj85rqzpbnvv3emr.js","assets/lef5ym39glv4981l.js","assets/root-ogjlcpyy.css","assets/mclphevd122040jw.js","assets/conversation-small-g7l5datj.css","assets/nel1ztt16rssielp.js","assets/k6xevgslgqxumalm.js","assets/h0u5robawxnqftug.js","assets/hcsjwjl2ji65i21r.js","assets/ogcl7v93rii15rrg.js","assets/ansi-1f6vhsjh.css","assets/beyyb659nwss2eea.js","assets/d9xs85pwcfjntwwg.js","assets/ef92qx749w9klz4o.js","assets/kxedrjbxv2qblujd.js","assets/oz589d7sqtxcbljf.js","assets/lptwpbjabrvjmhsj.js","assets/d488vdccsjfd5637.js","assets/lj9gcg948eq0zvwr.js","assets/fzrn137102spawew.js","assets/c631j8z7keqfibnl.js","assets/f3wj76d1ulqyss85.js","assets/hzcock7l6ec8fnr2.js","assets/fue7kd61xxcv74sk.js","assets/wham-task-page-content-layout-ihk5sr3r.css","assets/l45tzjfw41ny1oxj.js","assets/2dhqllc5pireni9q.js","assets/jza9spsuu2f7ynxb.js","assets/ht7of10t76s6p5h9.js","assets/efsl2tpd3w39q64v.js"])))=>i.map(i=>d[i]);
var xn=Object.defineProperty,Cn=Object.defineProperties;var wn=Object.getOwnPropertyDescriptors;var ft=Object.getOwnPropertySymbols;var xs=Object.prototype.hasOwnProperty,Cs=Object.prototype.propertyIsEnumerable;var gs=(t,e,s)=>e in t?xn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,V=(t,e)=>{for(var s in e||(e={}))xs.call(e,s)&&gs(t,s,e[s]);if(ft)for(var s of ft(e))Cs.call(e,s)&&gs(t,s,e[s]);return t},Tt=(t,e)=>Cn(t,wn(e));var ws=(t,e)=>{var s={};for(var n in t)xs.call(t,n)&&e.indexOf(n)<0&&(s[n]=t[n]);if(t!=null&&ft)for(var n of ft(t))e.indexOf(n)<0&&Cs.call(t,n)&&(s[n]=t[n]);return s};import{r as w,h as Ls,b as T,u as vn,a as Os,j as r,M as I,p as bn,f as Xt,g as Ps,c as Ws,A as Hs,d as Mn}from"./jj85rqzpbnvv3emr.js";import{i as ae,j as fe,db as yn,f as Gs,B as W,E as Ne,T as ee,e as X,ba as En,I as Jt,eN as jn,a2 as An,tw as kn,tx as Sn,eR as qs,eT as Nn,ty as Bn,tz as _n,g_ as Fn,pj as vt,hZ as me,es as bt,sk as es,i6 as $s,lC as In,C as Vs,bi as Rn,ky as Dn,gG as Ks,O as $t,lS as Us,aI as Tn,ex as Ln,ey as On,R as Pn,q as Wn,gu as Hn,lR as vs,go as Lt,m5 as Gn,jG as mt,jH as qn,gr as $n,dI as Vn,gz as oe,gI as bs,rY as Kn,gC as Ms,k as pt,s2 as Un,gD as zn,gs as Yn}from"./lef5ym39glv4981l.js";import{y0 as Zn,h2 as Qn,uY as Xn,bV as Jn,dq as er,bg as tr,kt as Se,ku as ts,y1 as ss,c3 as zs,lS as sr,y2 as nr,hl as rr,y3 as or,as as ar,y4 as ir,y5 as cr,y6 as Vt,p8 as lr,k1 as ur,a3 as dr,eV as Ys,kT as hr,bO as Zs,q_ as fr,mT as mr,r0 as pr,r2 as gr,r3 as xr,r4 as Cr,r6 as ys,r8 as wr,ra as vr,p4 as br,rc as Mr,ri as yr,rj as Er}from"./mclphevd122040jw.js";import{W as Be,c as pe,m as F,o as ns,O as Mt,Y as jr,S as Ar,J as kr,K as Sr,L as Nr,Z as Br,G as _r,E as Es,D as Fr,h as Ir,t as Rr,q as Dr,s as Tr,k as js,w as As,F as Lr}from"./ef92qx749w9klz4o.js";import{I as Qs}from"./l45tzjfw41ny1oxj.js";import{u as Or}from"./2dhqllc5pireni9q.js";import{h as Pr}from"./jza9spsuu2f7ynxb.js";import{u as Wr}from"./ht7of10t76s6p5h9.js";import{e as Hr}from"./efsl2tpd3w39q64v.js";function Gr(){const t=ae();return fe(t,"3651421897")}const rs=t=>w.createElement("svg",V({width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),w.createElement("path",{d:"M18 4C19.6569 4 21 5.34315 21 7V14.5H21.5L21.6025 14.5049C22.1067 14.5562 22.5 14.9823 22.5 15.5V17C22.5 18.6569 21.1569 20 19.5 20H4.5C2.89489 20 1.58421 18.7394 1.50391 17.1543L1.5 17V15.5L1.50488 15.3975C1.55621 14.8933 1.98232 14.5 2.5 14.5H3V7C3 5.34315 4.34315 4 6 4H18ZM3.5 17L3.50488 17.1025C3.55621 17.6067 3.98232 18 4.5 18H19.5C20.0523 18 20.5 17.5523 20.5 17V16.5H3.5V17ZM6 6C5.44772 6 5 6.44772 5 7V14.5H19V7C19 6.44772 18.5523 6 18 6H6Z",fill:"currentColor"}));var Ot,ks;function qr(){if(ks)return Ot;ks=1;var t=yn(),e=Zn();function s(n,a){return n&&n.length?e(n,t(a,2)):0}return Ot=s,Ot}var $r=qr();const xt=Ls($r);function Vr({taskId:t,hasMultipleInProgressOrStreamingTurns:e}){const s=T(),n=Gs(),a=vn(),[i,o]=w.useState(!1),{mutate:c}=Os({mutationFn:async()=>{o(!0),await Be.cancelTask(t)},onError:()=>{n.danger(s.formatMessage({id:"wham.whamTaskRow.failedToCancelTask",defaultMessage:"Failed to cancel task"}))},onSuccess:()=>{a.refetchQueries({queryKey:["wham","task",t]}),a.invalidateQueries({queryKey:["wham","tasks"]})}});return r.jsx(W,{color:"primary",type:"button",size:"small",className:e?void 0:"h-9 w-9",icon:i?Ne:Qn,onClick:()=>(pe.recordCancel("task-details"),c()),disabled:i,"aria-label":s.formatMessage({id:"wham.composer.cancelTask",defaultMessage:"Cancel task"}),"data-testid":"stop-button",children:e&&r.jsx(I,{id:"wham.composer.stopButton.multipleInProgressOrStreamingTurns",defaultMessage:"Stop all"})})}const Le=t=>w.createElement("svg",V({width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),w.createElement("path",{d:"M17.5 3C19.1569 3 20.5 4.34315 20.5 6C20.5 7.30574 19.6645 8.413 18.5 8.8252V9C18.5 11.2091 16.7091 13 14.5 13H9.5C8.39543 13 7.5 13.8954 7.5 15V15.1738C8.66468 15.5859 9.5 16.6941 9.5 18C9.5 19.6569 8.15685 21 6.5 21C4.84315 21 3.5 19.6569 3.5 18C3.5 16.6941 4.33532 15.5859 5.5 15.1738V8.8252C4.33548 8.413 3.5 7.30574 3.5 6C3.5 4.34315 4.84315 3 6.5 3C8.15685 3 9.5 4.34315 9.5 6C9.5 7.30574 8.66452 8.413 7.5 8.8252V11.5361C8.08845 11.1956 8.77125 11 9.5 11H14.5C15.6046 11 16.5 10.1046 16.5 9V8.8252C15.3355 8.413 14.5 7.30574 14.5 6C14.5 4.34315 15.8431 3 17.5 3ZM6.5 17C5.94772 17 5.5 17.4477 5.5 18C5.5 18.5523 5.94772 19 6.5 19C7.05228 19 7.5 18.5523 7.5 18C7.5 17.4477 7.05228 17 6.5 17ZM6.5 5C5.94772 5 5.5 5.44772 5.5 6C5.5 6.55228 5.94772 7 6.5 7C7.05228 7 7.5 6.55228 7.5 6C7.5 5.44772 7.05228 5 6.5 5ZM17.5 5C16.9477 5 16.5 5.44772 16.5 6C16.5 6.55228 16.9477 7 17.5 7C18.0523 7 18.5 6.55228 18.5 6C18.5 5.44772 18.0523 5 17.5 5Z",fill:"currentColor"}));function yt({triggerText:t,toolTip:e,ariaLabel:s,Icon:n,truncate:a=!0}){return r.jsx(Xn,{className:"composer-btn px-2","aria-label":s,children:r.jsx(ee,{label:e,className:"text-sm font-medium",children:r.jsxs("div",{className:"flex max-w-full items-center gap-1.5 ps-1",children:[n,r.jsx("span",{className:X("hidden sm:block",a?"max-w-[8rem] truncate md:max-w-[10rem]":"w-fit"),children:t}),r.jsx(Jn,{"aria-hidden":!0,className:"icon-sm"})]})})})}function _e(C){var b=C,{children:t,className:e,onClick:s,isSelected:n,isActive:a,isVirtualHover:i=!1,label:o,isDisabled:c,tooltipLabel:l,isSubMenuTrigger:d,noDefaultHoverState:u,as:h="button",truncateLabel:m,infoIcon:f,infoLink:p,icon:v}=b,x=ws(b,["children","className","onClick","isSelected","isActive","isVirtualHover","label","isDisabled","tooltipLabel","isSubMenuTrigger","noDefaultHoverState","as","truncateLabel","infoIcon","infoLink","icon"]);const E=T();let y=r.jsx(r.Fragment,{});t?y=r.jsx("div",{className:"flex flex-1 items-center gap-4",children:t}):o&&(y=r.jsxs("div",{className:X("flex items-center gap-3",m?"w-0 flex-1":"w-full"),children:[v&&(w.isValidElement(v)?v:r.jsx(Kr,{icon:v})),o&&r.jsx("div",{className:X("flex flex-col items-start py-1",c&&"text-token-text-quaternary pointer-events-none",m&&"w-[100%]"),children:r.jsx("div",{className:X("flex items-center text-start text-sm",m&&"w-full"),children:r.jsx("span",{className:"w-full overflow-hidden text-ellipsis whitespace-nowrap",children:o})})})]}),l&&(y=r.jsx(ee,{sideOffset:-10,label:l,className:"w-full",children:y})));const j=r.jsxs("div",{className:X("flex items-center justify-center",(n||f&&p||d)&&"min-w-5"),children:[n&&r.jsx(En,{className:"icon color:var(--tint-color,#0285FF) icon-sm","aria-label":E.formatMessage({id:"wham.codexMenuRow.selected",defaultMessage:"Selected"})}),f&&p&&r.jsx("a",{href:p,target:"_blank",rel:"noopener noreferrer",children:f}),d&&r.jsx(er,{className:"icon text-token-text-tertiary w-7","aria-label":E.formatMessage({id:"wham.codexMenuRow.openSubmenu",defaultMessage:"Open submenu"})})]}),k=X("flex cursor-pointer items-center rounded-[10px] px-2.5 py-1",(n||f&&p||d)&&"gap-4",a&&"bg-black/5 dark:bg-white/5",!u&&"hover:bg-black/5 dark:hover:bg-white/5",i&&"bg-black/5 dark:bg-white/5",e);if(h==="div"){const M=x;return r.jsxs("div",Tt(V({},M),{className:k,children:[y,j]}))}const g=x;return r.jsxs("button",Tt(V({type:"button"},g),{onClick:M=>{M.persist(),requestAnimationFrame(()=>{s==null||s(M)})},className:k,children:[y,j]}))}function Kr({icon:t}){const e=t;return r.jsx("div",{className:"text-token-text-secondary flex h-5 w-5 items-center justify-center",children:r.jsx(e,{className:"h-5 w-5 shrink-0","aria-label":""})})}const Pt="wham-environment-popover-event";function Xs(t,e,s){w.useEffect(()=>{function a(i){i.detail.popover!==t&&s()}return window.addEventListener(Pt,a),()=>{window.removeEventListener(Pt,a)}},[t,s]);const n=w.useCallback(a=>{window.dispatchEvent(new CustomEvent(Pt,{detail:{popover:a}}))},[]);w.useEffect(()=>{e&&n(t)},[e,n,t])}const Js=({items:t,onSelect:e,keyExtractor:s})=>{const[n,a]=w.useState(null),[i]=w.useState(new Map);return{hoveredId:n,setHoveredId:a,getItemRef:c=>l=>{const d=s(c);return l&&i.set(d,l),()=>{i.delete(d)}},itemRefs:i,onKeyDown:c=>{var f;const l=c.key==="ArrowDown"||c.key==="n"&&c.ctrlKey,d=c.key==="ArrowUp"||c.key==="p"&&c.ctrlKey;if(!(l||d||c.key==="Enter"))return;if(c.preventDefault(),c.key==="Enter"){n&&e(n);return}const u=t.findIndex(p=>s(p)===n),h=tr(u-(d?1:-1),0,t.length-1),m=s(t[h]);(f=i.get(m))==null||f.scrollIntoView({behavior:"instant",block:"nearest"}),a(m)}}};function en({environment:t,repository:e}){var p,v,x,C;const s=T(),{branch:n,setBranch:a}=F(),[i,o]=w.useState(""),[c,l]=w.useState(!1),d=w.useRef(null),u=()=>l(!1),h=(x=(v=(p=t==null?void 0:t.repos)==null?void 0:p[0])!=null?v:e==null?void 0:e.id)!=null?x:null,m=w.useRef(h),f=t?tn(t):(C=e==null?void 0:e.default_branch)!=null?C:"main";return w.useEffect(()=>{const b=m.current;if(m.current=h,!h){a(null);return}(b!==h||!n)&&a(f)},[n,h,f,a]),Xs("branch",c,()=>l(!1)),ns([{key:"whamBranches",action:()=>l(!0),actionMessageDescriptor:s.formatMessage({id:"wham.keyboardActions.whamBranches",defaultMessage:"Branches"}),group:ts.Chat,keyboardBinding:[Se.Mod,"b"]}]),r.jsx("div",{className:"items-center rounded-full",children:r.jsxs(ss,{open:c,onOpenChange:l,children:[r.jsx(yt,{triggerText:n!=null?n:s.formatMessage({id:"wham.codexBranchPopover.selectABranch",defaultMessage:"Select a Branch"}),toolTip:n===""||c?"":n!=null&&n.length?n:s.formatMessage({id:"wham.codexBranchPopover.searchForYourBranchTooltip",defaultMessage:"Search for your branch"}),ariaLabel:s.formatMessage({id:"wham.codexBranchPopover.searchForYourBranchAria",defaultMessage:"Search for your branch"}),Icon:r.jsx(Le,{"aria-hidden":!0,className:"icon-sm"})}),r.jsx(Mt,{align:"start",isOpen:c,closePopover:u,popoverContentRef:d,children:r.jsx(Ur,{defaultBranch:f,repoId:h,searchQuery:i,setSearchQuery:o,setBranch:a,selectedBranch:n!=null?n:"",closePopover:u})})]})})}function Ur({repoId:t,defaultBranch:e,setBranch:s,selectedBranch:n,searchQuery:a,setSearchQuery:i,closePopover:o}){const c=T(),l=w.useRef(null),d=zs(a,300),{data:u,isLoading:h,fetchNextPage:m,hasNextPage:f,isFetchingNextPage:p,error:v}=bn({queryKey:["searchBranches",t,d],enabled:!!t,initialPageParam:null,queryFn:({pageParam:g})=>Be.searchBranchesByRepository(t!=null?t:"",d,sr,g!=null?g:null),getNextPageParam:g=>{var M;return(M=g==null?void 0:g.cursor)!=null?M:null}}),x=w.useMemo(()=>{var N,B,H;const M=[...(H=(B=(N=u==null?void 0:u.pages)==null?void 0:N.flat().map(R=>R.items.flatMap(Y=>Y.branch)))==null?void 0:B.flat())!=null?H:[]];return e&&!M.includes(e)&&M.unshift(e),M},[u,e]),C=g=>{s(g),o()},b=w.useMemo(()=>a!=null&&a.trim()?x.filter(g=>g.toLowerCase().includes(a.toLowerCase())):x!=null?x:[],[a,x]),{hoveredId:E,setHoveredId:y,onKeyDown:j,getItemRef:k}=Js({items:b,keyExtractor:g=>g,onSelect:C});return w.useEffect(()=>{l.current&&l.current.focus()},[]),r.jsxs("div",{className:"gap flex max-h-[280px] w-90 flex-col rounded-lg p-0 md:max-h-[360px]",onClick:g=>{g.stopPropagation()},children:[r.jsx(Jt,{ref:l,className:"placeholder:text-token-text-tertiary !focus-within:ring-0 my-1.5 w-full border-0 bg-transparent ps-4 outline-none focus:border-0 focus:ring-0 focus:outline-none",type:"text",autoComplete:"off",inputClassName:"text-sm",name:"search-branch",value:a,suppressFocus:!0,onKeyDown:j,onChange:g=>i(g.target.value),placeholder:c.formatMessage({id:"wham.codexBranchPopover.branch",defaultMessage:"Search branches…"}),ariaLabel:c.formatMessage({id:"wham.codexBranchPopover.createBranchAria",defaultMessage:"Create a new branch"})}),r.jsx("div",{className:"bg-token-border-default h-px w-full"}),r.jsxs("div",{className:"min-h-18 w-full overflow-y-auto p-1.5",children:[b==null?void 0:b.map(g=>{const M=g===n;return r.jsx(_e,{className:"w-full max-w-full whitespace-nowrap",as:"button",onMouseEnter:()=>y(g),isVirtualHover:E===g,ref:k(g),onClick:()=>{C(g)},isSelected:M,label:g,truncateLabel:!0},g)}),v?r.jsx("div",{className:"flex items-center justify-center",children:r.jsx(I,{id:"wham.branchPopover.error",defaultMessage:"Error loading branches"})}):null,r.jsx(Qs,{bgColor:"dark:bg-token-bg-secondary",hasNextPage:f,fetchNextPage:m,isFetchingNextPage:p||h})]})]})}function tn(t){var e;for(const s of t.repos){const n=(e=t.repo_map)==null?void 0:e[s];if(n!=null&&n.default_branch)return n.default_branch}return"main"}function zr(){"use forget";const t=T(),e=F(u=>u.selectedRepositoryId),s=F(u=>u.setEnvironmentId),n=F(u=>u.setBranch),a=F(u=>u.setAutoCreatedEnvironment),i=w.useRef(null),{data:o}=Xt({queryKey:["wham","repository",e!=null?e:""],enabled:!!e,queryFn:()=>Be.getRepository(e!=null?e:""),staleTime:5*60*1e3}),{mutateAsync:c,isPending:l}=Or({onSuccess:u=>{if(!u)return;if(s(u.id),!F.getState().branch){const m=tn(u);n(m)}a(u.id)}}),d=w.useCallback(async()=>{var f,p;const u=F.getState().environmentId;if(u)return u;if(!e)throw new Error("Repository is required to create an environment");if(i.current)return i.current;const h=(p=(f=o==null?void 0:o.repository_full_name)!=null?f:o==null?void 0:o.name)!=null?p:"",m=(async()=>{var x;const v=await c({label:h||t.formatMessage({id:"wham.envlessCreateEnvironmentModal.defaultLabel",defaultMessage:"Codex environment"}),description:"",share_settings:"workspace",machine:"wham-public/wham-universal",repositoryId:e,workspaceDirectory:"/workspace",agentNetworkAccess:{mode:"off"},setupCommands:"",maintenanceSetupCommands:"",secrets:[],envVars:[],autoSetupSettings:null,cacheSettings:{post_setup_cache_enabled:!0}});return(x=v==null?void 0:v.id)!=null?x:null})();i.current=m;try{return await m}finally{i.current=null}},[c,t,o,e]);return{isCreatingEnvironment:l,ensureEnvironment:d,hasRepository:!!e}}function sn(){const t=ae();return fe(t,"3516223039")||void 0}function Yr({isSubmitDisabled:t,createTask:e,disabledReason:s,isFollowUp:n}){const a=T(),i=jn(),[o,c]=w.useState(!1),l=F(x=>x.environmentId),d=sn(),{isCreatingEnvironment:u,ensureEnvironment:h,hasRepository:m}=zr(),f=d&&!n&&!l&&m,p=w.useCallback(x=>{pe.recordComposerAction(x?"ask":"code"),e({runEnvironmentInQaMode:x})},[e]),v=w.useCallback(async x=>{if(t){c(!0);return}if(!u){if(f){try{if(!await h())return}catch(C){return}p(x);return}p(x)}},[t,h,u,p,f]);return r.jsxs("div",{className:"flex items-center gap-2",onClick:x=>x.stopPropagation(),children:[r.jsx(ee,{open:i?o:void 0,onOpenChange:c,label:s!=null?s:a.formatMessage({id:"wham.whamComposer.fasterTitle",defaultMessage:"Fast mode where the agent doesn't edit code"}),children:r.jsx(W,{color:"secondary",type:"button",className:i&&t?"opacity-50":"",disabled:(t||u)&&!i,onClick:()=>v(!0),children:r.jsx(I,{id:"wham.composer.askButton",defaultMessage:"Ask"})})}),r.jsx(ee,{label:s,children:r.jsx(W,{color:"primary",type:"button",className:i&&t?"opacity-50":"",disabled:(t||u)&&!i,onClick:()=>v(!1),children:r.jsx(I,{id:"wham.composer.codeItButton",defaultMessage:"Code"})})})]})}const Zr=4,Qr=t=>{switch(t){case 1:return r.jsx(Nr,{"aria-hidden":!0,className:"icon-sm"});case 2:return r.jsx(Sr,{"aria-hidden":!0,className:"icon-sm"});case 3:return r.jsx(kr,{"aria-hidden":!0,className:"icon-sm"});default:return r.jsx(Ar,{"aria-hidden":!0,className:"icon-sm"})}};function Xr({attempts:t,setAttempts:e}){var d;const s=T(),[n,a]=w.useState(!1),i=w.useRef(null),o=()=>a(!1),c=ae(),l=(d=An(c,"2179180337").value.max_attempts)!=null?d:Zr;return r.jsx(Jr,{children:r.jsxs(ss,{open:n,onOpenChange:a,children:[r.jsx(yt,{triggerText:s.formatMessage({id:"wham.attemptsSelector.trigger",defaultMessage:"{count}x"},{count:t}),toolTip:s.formatMessage({id:"wham.attemptsSelector.tooltip",defaultMessage:"Number of simultaneous versions"}),ariaLabel:s.formatMessage({id:"wham.attemptsSelector.ariaLabel",defaultMessage:"Open versions number selector, currently set to {count}x"},{count:t}),Icon:Qr(t),truncate:!1}),r.jsx(Mt,{align:"start",isOpen:n,closePopover:o,popoverContentRef:i,children:r.jsx("div",{className:"flex w-50 flex-col rounded-lg p-1.5",children:[...Array(l)].map((u,h)=>r.jsx(_e,{className:"w-full",onClick:()=>{e(h+1),o()},isSelected:t===h+1,label:s.formatMessage({id:"wham.attemptsSelector.option",defaultMessage:"{count, plural, one {# version} other {# versions}}"},{count:h+1})},h+1))})})]})})}function Jr({children:t}){const e=T(),s=nr(),n=jr(),a=s&&!s.isLoading&&s.eligible&&!n.isLoading&&!!n.data;return r.jsx(rr,{side:"bottom",theme:"bright",dismissOnOutsideClick:!0,badge:"new",show:a,sideOffset:0,className:"w-60",announcementKey:or,title:e.formatMessage({id:"wham.composerBon.nuxTooltip.title",defaultMessage:"Best-of-N"}),description:e.formatMessage({id:"wham.composerBon.nuxTooltip.description",defaultMessage:"Generate multiple solutions so you can pick the best approach."}),onDismiss:s.markAsViewed,children:t})}function os({className:t}){return r.jsx(ar,{className:X("flex w-[8rem] items-center gap-1.5 rounded-full! md:w-[10rem]",t)})}function ne(t){return Array.isArray?Array.isArray(t):on(t)==="[object Array]"}function eo(t){if(typeof t=="string")return t;let e=t+"";return e=="0"&&1/t==-1/0?"-0":e}function to(t){return t==null?"":eo(t)}function J(t){return typeof t=="string"}function nn(t){return typeof t=="number"}function so(t){return t===!0||t===!1||no(t)&&on(t)=="[object Boolean]"}function rn(t){return typeof t=="object"}function no(t){return rn(t)&&t!==null}function q(t){return t!=null}function Wt(t){return!t.trim().length}function on(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const ro="Incorrect 'index' type",oo=t=>"Invalid value for key ".concat(t),ao=t=>"Pattern length exceeds max of ".concat(t,"."),io=t=>"Missing ".concat(t," property in key"),co=t=>"Property 'weight' in key '".concat(t,"' must be a positive integer"),Ss=Object.prototype.hasOwnProperty;class lo{constructor(e){this._keys=[],this._keyMap={};let s=0;e.forEach(n=>{let a=an(n);this._keys.push(a),this._keyMap[a.id]=a,s+=a.weight}),this._keys.forEach(n=>{n.weight/=s})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function an(t){let e=null,s=null,n=null,a=1,i=null;if(J(t)||ne(t))n=t,e=Ns(t),s=Kt(t);else{if(!Ss.call(t,"name"))throw new Error(io("name"));const o=t.name;if(n=o,Ss.call(t,"weight")&&(a=t.weight,a<=0))throw new Error(co(o));e=Ns(o),s=Kt(o),i=t.getFn}return{path:e,id:s,weight:a,src:n,getFn:i}}function Ns(t){return ne(t)?t:t.split(".")}function Kt(t){return ne(t)?t.join("."):t}function uo(t,e){let s=[],n=!1;const a=(i,o,c)=>{if(q(i))if(!o[c])s.push(i);else{let l=o[c];const d=i[l];if(!q(d))return;if(c===o.length-1&&(J(d)||nn(d)||so(d)))s.push(to(d));else if(ne(d)){n=!0;for(let u=0,h=d.length;u<h;u+=1)a(d[u],o,c+1)}else o.length&&a(d,o,c+1)}};return a(t,J(e)?e.split("."):e,0),n?s:s[0]}const ho={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},fo={isCaseSensitive:!1,ignoreDiacritics:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(t,e)=>t.score===e.score?t.idx<e.idx?-1:1:t.score<e.score?-1:1},mo={location:0,threshold:.6,distance:100},po={useExtendedSearch:!1,getFn:uo,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var A=V(V(V(V({},fo),ho),mo),po);const go=/[^ ]+/g;function xo(t=1,e=3){const s=new Map,n=Math.pow(10,e);return{get(a){const i=a.match(go).length;if(s.has(i))return s.get(i);const o=1/Math.pow(i,.5*t),c=parseFloat(Math.round(o*n)/n);return s.set(i,c),c},clear(){s.clear()}}}class as{constructor({getFn:e=A.getFn,fieldNormWeight:s=A.fieldNormWeight}={}){this.norm=xo(s,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((s,n)=>{this._keysMap[s.id]=n})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,J(this.docs[0])?this.docs.forEach((e,s)=>{this._addString(e,s)}):this.docs.forEach((e,s)=>{this._addObject(e,s)}),this.norm.clear())}add(e){const s=this.size();J(e)?this._addString(e,s):this._addObject(e,s)}removeAt(e){this.records.splice(e,1);for(let s=e,n=this.size();s<n;s+=1)this.records[s].i-=1}getValueForItemAtKeyId(e,s){return e[this._keysMap[s]]}size(){return this.records.length}_addString(e,s){if(!q(e)||Wt(e))return;let n={v:e,i:s,n:this.norm.get(e)};this.records.push(n)}_addObject(e,s){let n={i:s,$:{}};this.keys.forEach((a,i)=>{let o=a.getFn?a.getFn(e):this.getFn(e,a.path);if(q(o)){if(ne(o)){let c=[];const l=[{nestedArrIndex:-1,value:o}];for(;l.length;){const{nestedArrIndex:d,value:u}=l.pop();if(q(u))if(J(u)&&!Wt(u)){let h={v:u,i:d,n:this.norm.get(u)};c.push(h)}else ne(u)&&u.forEach((h,m)=>{l.push({nestedArrIndex:m,value:h})})}n.$[i]=c}else if(J(o)&&!Wt(o)){let c={v:o,n:this.norm.get(o)};n.$[i]=c}}}),this.records.push(n)}toJSON(){return{keys:this.keys,records:this.records}}}function cn(t,e,{getFn:s=A.getFn,fieldNormWeight:n=A.fieldNormWeight}={}){const a=new as({getFn:s,fieldNormWeight:n});return a.setKeys(t.map(an)),a.setSources(e),a.create(),a}function Co(t,{getFn:e=A.getFn,fieldNormWeight:s=A.fieldNormWeight}={}){const{keys:n,records:a}=t,i=new as({getFn:e,fieldNormWeight:s});return i.setKeys(n),i.setIndexRecords(a),i}function gt(t,{errors:e=0,currentLocation:s=0,expectedLocation:n=0,distance:a=A.distance,ignoreLocation:i=A.ignoreLocation}={}){const o=e/t.length;if(i)return o;const c=Math.abs(n-s);return a?o+c/a:c?1:o}function wo(t=[],e=A.minMatchCharLength){let s=[],n=-1,a=-1,i=0;for(let o=t.length;i<o;i+=1){let c=t[i];c&&n===-1?n=i:!c&&n!==-1&&(a=i-1,a-n+1>=e&&s.push([n,a]),n=-1)}return t[i-1]&&i-n>=e&&s.push([n,i-1]),s}const he=32;function vo(t,e,s,{location:n=A.location,distance:a=A.distance,threshold:i=A.threshold,findAllMatches:o=A.findAllMatches,minMatchCharLength:c=A.minMatchCharLength,includeMatches:l=A.includeMatches,ignoreLocation:d=A.ignoreLocation}={}){if(e.length>he)throw new Error(ao(he));const u=e.length,h=t.length,m=Math.max(0,Math.min(n,h));let f=i,p=m;const v=c>1||l,x=v?Array(h):[];let C;for(;(C=t.indexOf(e,p))>-1;){let g=gt(e,{currentLocation:C,expectedLocation:m,distance:a,ignoreLocation:d});if(f=Math.min(g,f),p=C+u,v){let M=0;for(;M<u;)x[C+M]=1,M+=1}}p=-1;let b=[],E=1,y=u+h;const j=1<<u-1;for(let g=0;g<u;g+=1){let M=0,N=y;for(;M<N;)gt(e,{errors:g,currentLocation:m+N,expectedLocation:m,distance:a,ignoreLocation:d})<=f?M=N:y=N,N=Math.floor((y-M)/2+M);y=N;let B=Math.max(1,m-N+1),H=o?h:Math.min(m+N,h)+u,R=Array(H+2);R[H+1]=(1<<g)-1;for(let _=H;_>=B;_-=1){let G=_-1,Z=s[t.charAt(G)];if(v&&(x[G]=+!!Z),R[_]=(R[_+1]<<1|1)&Z,g&&(R[_]|=(b[_+1]|b[_])<<1|1|b[_+1]),R[_]&j&&(E=gt(e,{errors:g,currentLocation:G,expectedLocation:m,distance:a,ignoreLocation:d}),E<=f)){if(f=E,p=G,p<=m)break;B=Math.max(1,2*m-p)}}if(gt(e,{errors:g+1,currentLocation:m,expectedLocation:m,distance:a,ignoreLocation:d})>f)break;b=R}const k={isMatch:p>=0,score:Math.max(.001,E)};if(v){const g=wo(x,c);g.length?l&&(k.indices=g):k.isMatch=!1}return k}function bo(t){let e={};for(let s=0,n=t.length;s<n;s+=1){const a=t.charAt(s);e[a]=(e[a]||0)|1<<n-s-1}return e}const Ct=String.prototype.normalize?t=>t.normalize("NFD").replace(/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/g,""):t=>t;class ln{constructor(e,{location:s=A.location,threshold:n=A.threshold,distance:a=A.distance,includeMatches:i=A.includeMatches,findAllMatches:o=A.findAllMatches,minMatchCharLength:c=A.minMatchCharLength,isCaseSensitive:l=A.isCaseSensitive,ignoreDiacritics:d=A.ignoreDiacritics,ignoreLocation:u=A.ignoreLocation}={}){if(this.options={location:s,threshold:n,distance:a,includeMatches:i,findAllMatches:o,minMatchCharLength:c,isCaseSensitive:l,ignoreDiacritics:d,ignoreLocation:u},e=l?e:e.toLowerCase(),e=d?Ct(e):e,this.pattern=e,this.chunks=[],!this.pattern.length)return;const h=(f,p)=>{this.chunks.push({pattern:f,alphabet:bo(f),startIndex:p})},m=this.pattern.length;if(m>he){let f=0;const p=m%he,v=m-p;for(;f<v;)h(this.pattern.substr(f,he),f),f+=he;if(p){const x=m-he;h(this.pattern.substr(x),x)}}else h(this.pattern,0)}searchIn(e){const{isCaseSensitive:s,ignoreDiacritics:n,includeMatches:a}=this.options;if(e=s?e:e.toLowerCase(),e=n?Ct(e):e,this.pattern===e){let v={isMatch:!0,score:0};return a&&(v.indices=[[0,e.length-1]]),v}const{location:i,distance:o,threshold:c,findAllMatches:l,minMatchCharLength:d,ignoreLocation:u}=this.options;let h=[],m=0,f=!1;this.chunks.forEach(({pattern:v,alphabet:x,startIndex:C})=>{const{isMatch:b,score:E,indices:y}=vo(e,v,x,{location:i+C,distance:o,threshold:c,findAllMatches:l,minMatchCharLength:d,includeMatches:a,ignoreLocation:u});b&&(f=!0),m+=E,b&&y&&(h=[...h,...y])});let p={isMatch:f,score:f?m/this.chunks.length:1};return f&&a&&(p.indices=h),p}}class ie{constructor(e){this.pattern=e}static isMultiMatch(e){return Bs(e,this.multiRegex)}static isSingleMatch(e){return Bs(e,this.singleRegex)}search(){}}function Bs(t,e){const s=t.match(e);return s?s[1]:null}class Mo extends ie{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const s=e===this.pattern;return{isMatch:s,score:s?0:1,indices:[0,this.pattern.length-1]}}}class yo extends ie{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const n=e.indexOf(this.pattern)===-1;return{isMatch:n,score:n?0:1,indices:[0,e.length-1]}}}class Eo extends ie{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const s=e.startsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[0,this.pattern.length-1]}}}class jo extends ie{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const s=!e.startsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[0,e.length-1]}}}class Ao extends ie{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const s=e.endsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[e.length-this.pattern.length,e.length-1]}}}class ko extends ie{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const s=!e.endsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[0,e.length-1]}}}class un extends ie{constructor(e,{location:s=A.location,threshold:n=A.threshold,distance:a=A.distance,includeMatches:i=A.includeMatches,findAllMatches:o=A.findAllMatches,minMatchCharLength:c=A.minMatchCharLength,isCaseSensitive:l=A.isCaseSensitive,ignoreDiacritics:d=A.ignoreDiacritics,ignoreLocation:u=A.ignoreLocation}={}){super(e),this._bitapSearch=new ln(e,{location:s,threshold:n,distance:a,includeMatches:i,findAllMatches:o,minMatchCharLength:c,isCaseSensitive:l,ignoreDiacritics:d,ignoreLocation:u})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}}class dn extends ie{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let s=0,n;const a=[],i=this.pattern.length;for(;(n=e.indexOf(this.pattern,s))>-1;)s=n+i,a.push([n,s-1]);const o=!!a.length;return{isMatch:o,score:o?0:1,indices:a}}}const Ut=[Mo,dn,Eo,jo,ko,Ao,yo,un],_s=Ut.length,So=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,No="|";function Bo(t,e={}){return t.split(No).map(s=>{let n=s.trim().split(So).filter(i=>i&&!!i.trim()),a=[];for(let i=0,o=n.length;i<o;i+=1){const c=n[i];let l=!1,d=-1;for(;!l&&++d<_s;){const u=Ut[d];let h=u.isMultiMatch(c);h&&(a.push(new u(h,e)),l=!0)}if(!l)for(d=-1;++d<_s;){const u=Ut[d];let h=u.isSingleMatch(c);if(h){a.push(new u(h,e));break}}}return a})}const _o=new Set([un.type,dn.type]);class Fo{constructor(e,{isCaseSensitive:s=A.isCaseSensitive,ignoreDiacritics:n=A.ignoreDiacritics,includeMatches:a=A.includeMatches,minMatchCharLength:i=A.minMatchCharLength,ignoreLocation:o=A.ignoreLocation,findAllMatches:c=A.findAllMatches,location:l=A.location,threshold:d=A.threshold,distance:u=A.distance}={}){this.query=null,this.options={isCaseSensitive:s,ignoreDiacritics:n,includeMatches:a,minMatchCharLength:i,findAllMatches:c,ignoreLocation:o,location:l,threshold:d,distance:u},e=s?e:e.toLowerCase(),e=n?Ct(e):e,this.pattern=e,this.query=Bo(this.pattern,this.options)}static condition(e,s){return s.useExtendedSearch}searchIn(e){const s=this.query;if(!s)return{isMatch:!1,score:1};const{includeMatches:n,isCaseSensitive:a,ignoreDiacritics:i}=this.options;e=a?e:e.toLowerCase(),e=i?Ct(e):e;let o=0,c=[],l=0;for(let d=0,u=s.length;d<u;d+=1){const h=s[d];c.length=0,o=0;for(let m=0,f=h.length;m<f;m+=1){const p=h[m],{isMatch:v,indices:x,score:C}=p.search(e);if(v){if(o+=1,l+=C,n){const b=p.constructor.type;_o.has(b)?c=[...c,...x]:c.push(x)}}else{l=0,o=0,c.length=0;break}}if(o){let m={isMatch:!0,score:l/o};return n&&(m.indices=c),m}}return{isMatch:!1,score:1}}}const zt=[];function Io(...t){zt.push(...t)}function Yt(t,e){for(let s=0,n=zt.length;s<n;s+=1){let a=zt[s];if(a.condition(t,e))return new a(t,e)}return new ln(t,e)}const wt={AND:"$and",OR:"$or"},Zt={PATH:"$path",PATTERN:"$val"},Qt=t=>!!(t[wt.AND]||t[wt.OR]),Ro=t=>!!t[Zt.PATH],Do=t=>!ne(t)&&rn(t)&&!Qt(t),Fs=t=>({[wt.AND]:Object.keys(t).map(e=>({[e]:t[e]}))});function hn(t,e,{auto:s=!0}={}){const n=a=>{let i=Object.keys(a);const o=Ro(a);if(!o&&i.length>1&&!Qt(a))return n(Fs(a));if(Do(a)){const l=o?a[Zt.PATH]:i[0],d=o?a[Zt.PATTERN]:a[l];if(!J(d))throw new Error(oo(l));const u={keyId:Kt(l),pattern:d};return s&&(u.searcher=Yt(d,e)),u}let c={children:[],operator:i[0]};return i.forEach(l=>{const d=a[l];ne(d)&&d.forEach(u=>{c.children.push(n(u))})}),c};return Qt(t)||(t=Fs(t)),n(t)}function To(t,{ignoreFieldNorm:e=A.ignoreFieldNorm}){t.forEach(s=>{let n=1;s.matches.forEach(({key:a,norm:i,score:o})=>{const c=a?a.weight:null;n*=Math.pow(o===0&&c?Number.EPSILON:o,(c||1)*(e?1:i))}),s.score=n})}function Lo(t,e){const s=t.matches;e.matches=[],q(s)&&s.forEach(n=>{if(!q(n.indices)||!n.indices.length)return;const{indices:a,value:i}=n;let o={indices:a,value:i};n.key&&(o.key=n.key.src),n.idx>-1&&(o.refIndex=n.idx),e.matches.push(o)})}function Oo(t,e){e.score=t.score}function Po(t,e,{includeMatches:s=A.includeMatches,includeScore:n=A.includeScore}={}){const a=[];return s&&a.push(Lo),n&&a.push(Oo),t.map(i=>{const{idx:o}=i,c={item:e[o],refIndex:o};return a.length&&a.forEach(l=>{l(i,c)}),c})}class Fe{constructor(e,s={},n){this.options=V(V({},A),s),this.options.useExtendedSearch,this._keyStore=new lo(this.options.keys),this.setCollection(e,n)}setCollection(e,s){if(this._docs=e,s&&!(s instanceof as))throw new Error(ro);this._myIndex=s||cn(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){q(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){const s=[];for(let n=0,a=this._docs.length;n<a;n+=1){const i=this._docs[n];e(i,n)&&(this.removeAt(n),n-=1,a-=1,s.push(i))}return s}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:s=-1}={}){const{includeMatches:n,includeScore:a,shouldSort:i,sortFn:o,ignoreFieldNorm:c}=this.options;let l=J(e)?J(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return To(l,{ignoreFieldNorm:c}),i&&l.sort(o),nn(s)&&s>-1&&(l=l.slice(0,s)),Po(l,this._docs,{includeMatches:n,includeScore:a})}_searchStringList(e){const s=Yt(e,this.options),{records:n}=this._myIndex,a=[];return n.forEach(({v:i,i:o,n:c})=>{if(!q(i))return;const{isMatch:l,score:d,indices:u}=s.searchIn(i);l&&a.push({item:i,idx:o,matches:[{score:d,value:i,norm:c,indices:u}]})}),a}_searchLogical(e){const s=hn(e,this.options),n=(c,l,d)=>{if(!c.children){const{keyId:h,searcher:m}=c,f=this._findMatches({key:this._keyStore.get(h),value:this._myIndex.getValueForItemAtKeyId(l,h),searcher:m});return f&&f.length?[{idx:d,item:l,matches:f}]:[]}const u=[];for(let h=0,m=c.children.length;h<m;h+=1){const f=c.children[h],p=n(f,l,d);if(p.length)u.push(...p);else if(c.operator===wt.AND)return[]}return u},a=this._myIndex.records,i={},o=[];return a.forEach(({$:c,i:l})=>{if(q(c)){let d=n(s,c,l);d.length&&(i[l]||(i[l]={idx:l,item:c,matches:[]},o.push(i[l])),d.forEach(({matches:u})=>{i[l].matches.push(...u)}))}}),o}_searchObjectList(e){const s=Yt(e,this.options),{keys:n,records:a}=this._myIndex,i=[];return a.forEach(({$:o,i:c})=>{if(!q(o))return;let l=[];n.forEach((d,u)=>{l.push(...this._findMatches({key:d,value:o[u],searcher:s}))}),l.length&&i.push({idx:c,item:o,matches:l})}),i}_findMatches({key:e,value:s,searcher:n}){if(!q(s))return[];let a=[];if(ne(s))s.forEach(({v:i,i:o,n:c})=>{if(!q(i))return;const{isMatch:l,score:d,indices:u}=n.searchIn(i);l&&a.push({score:d,key:e,value:i,idx:o,norm:c,indices:u})});else{const{v:i,n:o}=s,{isMatch:c,score:l,indices:d}=n.searchIn(i);c&&a.push({score:l,key:e,value:i,norm:o,indices:d})}return a}}Fe.version="7.1.0";Fe.createIndex=cn;Fe.parseIndex=Co;Fe.config=A;Fe.parseQuery=hn;Io(Fo);var Ht,Is;function Wo(){if(Is)return Ht;Is=1;var t=kn(),e=Sn(),s=_n(),n=qs(),a=Nn(),i=Bn(),o=Math.min;function c(l,d,u){for(var h=u?s:e,m=l[0].length,f=l.length,p=f,v=Array(f),x=1/0,C=[];p--;){var b=l[p];p&&d&&(b=n(b,a(d))),x=o(b.length,x),v[p]=!u&&(d||m>=120&&b.length>=120)?new t(p&&b):void 0}b=l[0];var E=-1,y=v[0];e:for(;++E<m&&C.length<x;){var j=b[E],k=d?d(j):j;if(j=u||j!==0?j:0,!(y?i(y,k):h(C,k,u))){for(p=f;--p;){var g=v[p];if(!(g?i(g,k):h(l[p],k,u)))continue e}y&&y.push(k),C.push(j)}}return C}return Ht=c,Ht}var Gt,Rs;function Ho(){if(Rs)return Gt;Rs=1;var t=ir();function e(s){return t(s)?s:[]}return Gt=e,Gt}var qt,Ds;function Go(){if(Ds)return qt;Ds=1;var t=qs(),e=Wo(),s=cr(),n=Ho(),a=s(function(i){var o=t(i,n);return o.length&&o[0]===i[0]?e(o):[]});return qt=a,qt}var qo=Go();const $o=Ls(qo);function Vo(){const{data:t}=Br(),{data:e,isLoading:s}=_r();return{environments:e!=null?e:t,fullEnvironmentsLoading:s}}function Ko({onCreateEnvironment:t,showBranchSelector:e=!0,filters:s=null}={}){var C,b,E,y;const n=T(),{environmentId:a,setEnvironmentId:i,selectedRepositoryId:o,setSelectedRepositoryId:c}=F(),[l,d]=w.useState(!1),u=w.useRef(null),{environments:h,fullEnvironmentsLoading:m}=Vo(),f=w.useMemo(()=>s!=null&&s.repos?h==null?void 0:h.filter(j=>$o(j.repos,s.repos).length>0):h,[h,s]),p=f==null?void 0:f.find(j=>j.id===a),v=w.useCallback(j=>{var M,N;if(!j)return null;const k=(N=j.repos)!=null?N:Object.keys((M=j.repo_map)!=null?M:{});if(!k.length)return null;const[g]=k;return g!=null?g:null},[]);Xs("environment",l,()=>d(!1)),w.useEffect(()=>{if(m)return;if(a&&!p){i(null),c(null);return}else if(!a&&(f!=null&&f.length)){const g=Vt(f,[N=>{var B;return!((B=N.is_pinned)!=null&&B)},N=>{var B;return-((B=N.task_count)!=null?B:0)}])[0];i(g.id);const M=v(g);c(M!=null?M:null);return}const j=v(p);j!=null&&j!==o?c(j):p&&j==null&&o!=null&&c(null)},[m,a,p,f,i,o,c,v]),ns([{key:"whamEnvironments",action:()=>d(!0),actionMessageDescriptor:n.formatMessage({id:"wham.keyboardActions.whamEnvironments",defaultMessage:"Environments"}),group:ts.Chat,keyboardBinding:[Se.Mod,"e"]}]);const x=()=>d(!1);return m&&!(f!=null&&f.length)?r.jsx("div",{className:"flex items-center gap-3 rounded-full",children:r.jsx(os,{})}):r.jsxs("div",{className:"flex items-center gap-2 rounded-full",children:[r.jsxs(ss,{open:l,onOpenChange:d,children:[r.jsx(yt,{triggerText:(C=p==null?void 0:p.label)!=null?C:n.formatMessage({id:"wham.codexEnvironmentPopover.selectEnvironment",defaultMessage:"Select environment"}),toolTip:((E=(b=p==null?void 0:p.label)==null?void 0:b.length)!=null?E:0)>16?(y=p==null?void 0:p.label)!=null?y:"":p!=null&&p.label||l?"":n.formatMessage({id:"wham.codexEnvironmentPopover.viewAllCodeEnvironments",defaultMessage:"View all code environments"}),ariaLabel:n.formatMessage({id:"wham.codexEnvironmentPopover.viewAll",defaultMessage:"View all code environments"}),Icon:r.jsx(rs,{"aria-hidden":!0,className:"icon-sm"})}),r.jsx(Mt,{align:"start",isOpen:l,closePopover:x,popoverContentRef:u,children:r.jsx(Uo,{isLoading:m,environments:f!=null?f:[],environmentId:a,setEnvironmentId:j=>{i(j);const k=f==null?void 0:f.find(M=>M.id===j),g=v(k);c(g!=null?g:null)},closePopover:x,onCreateEnvironment:t})})]}),p&&e&&r.jsx(en,{environment:p})]})}function Uo({isLoading:t,environments:e,environmentId:s,setEnvironmentId:n,closePopover:a,onCreateEnvironment:i}){const o=T(),c=w.useRef(null),[l,d]=w.useState(""),u=E=>{n(E),a()},h=Ps(),m=e.length>0,f=w.useMemo(()=>new Fe(e,{threshold:.4,keys:["label","repos"]}),[e]),p=w.useMemo(()=>{var k;if(!(l!=null&&l.trim())){const[g,M]=lr(e,N=>N.is_pinned);return[...Vt(g,N=>{var B;return-((B=N.task_count)!=null?B:0)}),...Vt(M,N=>{var B;return-((B=N.task_count)!=null?B:0)})]}const E=l.trim().toLowerCase(),y=(k=f==null?void 0:f.search(l).map(g=>g.item))!=null?k:[],j=g=>{const M=g.toLowerCase();return M===E?0:M.startsWith(E)?1:2};return y.sort((g,M)=>{if(g.is_pinned!==M.is_pinned)return g.is_pinned?-1:1;const N=j(g.label)-j(M.label);return N!==0?N:g.label.localeCompare(M.label)})},[l,f,e]),{hoveredId:v,setHoveredId:x,onKeyDown:C,getItemRef:b}=Js({items:p,keyExtractor:E=>E.id,onSelect:u});return w.useEffect(()=>{var E;(E=c.current)==null||E.focus()},[]),r.jsxs("div",{className:"flex max-h-[280px] w-80 flex-col overflow-y-auto rounded-lg md:max-h-[360px]",children:[e.length>4&&r.jsxs("div",{className:"contents",onClick:E=>{E.stopPropagation()},children:[r.jsx(Jt,{ref:c,className:"placeholder:text-token-text-tertiary !focus-within:ring-0 my-1.5 w-full border-0 bg-transparent ps-4 outline-none focus:border-0 focus:ring-0 focus:outline-none",inputClassName:"text-sm",type:"text",autoComplete:"off",name:"branch-to-add",value:l,onChange:E=>d(E.target.value),onKeyDown:C,suppressFocus:!0,placeholder:o.formatMessage({id:"wham.codexEnvironmentPopover.searchEnvironmentsTooltip",defaultMessage:"Search environments…"}),ariaLabel:o.formatMessage({id:"wham.codexEnvironmentPopover.searchEnvironmentsAria",defaultMessage:"Search environments"})}),r.jsx("div",{className:"bg-token-border-default h-px w-full"})]}),r.jsx("div",{className:"flex flex-col overflow-y-auto p-1.5",children:t?r.jsx("div",{className:"flex w-full items-center justify-center py-2",children:r.jsx(Ne,{className:"ms-2"})}):e.length>0?p.length>0?p.map(E=>{const y=s===E.id;return r.jsx(_e,{as:"button",ref:b(E),onMouseEnter:()=>x(E.id),className:"w-full",truncateLabel:!0,onClick:()=>{u(E.id)},isVirtualHover:v===E.id,isSelected:y,label:E.label},E.id)}):r.jsx("div",{className:"p-5 text-center",children:r.jsx("p",{className:"text-token-text-tertiary text-sm",children:r.jsx(I,{id:"wham.environmentPopover.noMatches",defaultMessage:"No matches found"})})}):r.jsxs("div",{className:"p-2 text-center",children:[r.jsx("p",{className:"text-token-text-primary text-sm",children:r.jsx(I,{id:"wham.environmentPopover.noEnvironments",defaultMessage:"No environments"})}),r.jsx("p",{className:"text-token-text-secondary text-xs",children:r.jsx(I,{id:"wham.environmentPopover.missingEnvironment",defaultMessage:"Codex requires an environment to work"})})]})}),r.jsx("div",{className:"bg-token-border-default h-px w-full"}),r.jsx("div",{className:"bg-token-bg-tertiary px-2 py-1.5",children:r.jsx(_e,{className:"w-full",noDefaultHoverState:!0,onClick:()=>{!m&&i?i():h("/codex/settings/environments")},isSelected:!1,icon:r.jsx(Fn,{className:"icon-sm"}),label:m?o.formatMessage({id:"wham.codexEnvironmentPopover.manageEnvironments",defaultMessage:"Manage environments"}):o.formatMessage({id:"wham.codexEnvironmentPopover.createEnvironment",defaultMessage:"Create environment"})},"environment-action")})]})}function zo({onCreateEnvironment:t,showBranchSelector:e,filters:s}={}){const n=T(),{isConnected:a,isLoading:i,openGithubModal:o,error:c,refetch:l}=vt(bt.GITHUB_CONNECTOR,"github","/codex",me.CODEX),{enabled:d}=es(me.CODEX);return i?r.jsx(os,{className:"h-9"}):c?r.jsx(ee,{label:n.formatMessage({id:"wham.whamComposerEnvironmentsSelector.failedClickToRetry",defaultMessage:"Click to retry"}),children:r.jsx(W,{color:"secondary",type:"button",className:"border-token-border-default flex w-fit items-center gap-1.5 rounded-full! border",onClick:l,children:r.jsxs("div",{className:"flex items-center gap-1.5",children:[r.jsx(rs,{"aria-hidden":!0,className:"icon-sm"}),r.jsx(I,{id:"wham.environmentsSelector.retry",defaultMessage:"Failed to load environments"})]})})}):d?r.jsx(r.Fragment,{children:r.jsx("div",{className:"z-0 flex w-full justify-between",children:a?r.jsx("div",{className:"flex gap-4",children:r.jsx(Ko,{onCreateEnvironment:t,showBranchSelector:e!=null?e:!0,filters:s!=null?s:null})}):r.jsx("div",{className:"flex gap-2",children:r.jsxs(W,{type:"button",color:"secondary",size:"small",onClick:o,children:[r.jsx(Le,{"aria-hidden":!0,className:"icon-sm me-1.5"}),r.jsx(I,{id:"wham.environmentsSelector.connectGithub",defaultMessage:"Connect GitHub"})]})})})}):r.jsx(ee,{label:n.formatMessage({id:"wham.whamComposerEnvironmentsSelector.disabledByWorkspaceAdmin",defaultMessage:"Disabled by workspace admin"}),children:r.jsxs(W,{type:"button",color:"secondary",onClick:o,disabled:!0,children:[r.jsx(Le,{"aria-hidden":!0,className:"icon-sm me-1.5"}),r.jsx(I,{id:"wham.environmentsSelector.connectGithub",defaultMessage:"Connect GitHub"})]})})}function Yo({selectedRepository:t,isLoading:e,combinedRepositories:s,search:n,setSearch:a,isFetching:i,isFetchingNextPage:o,hasNextPage:c,fetchNextPage:l,onSelect:d,onCreateEnvironmentFromRepo:u}){const h=T(),[m,f]=w.useState(!1),p=!e&&s.length===0,v=!c&&s.length>=Es,x=t?t.repository_full_name:h.formatMessage({id:"wham.codexRepositoryPopover.selectRepo",defaultMessage:"Select repository"}),C=w.useRef(null),b=w.useRef(null);w.useEffect(()=>{if(!m)return;const y=requestAnimationFrame(()=>{var j;(j=b.current)==null||j.focus()});return()=>cancelAnimationFrame(y)},[m]);const E=y=>{d(y),f(!1)};return r.jsx("div",{className:"flex items-center gap-2 rounded-full",children:r.jsxs(ur,{open:m,onOpenChange:f,children:[r.jsx(yt,{triggerText:x,toolTip:x,ariaLabel:h.formatMessage({id:"wham.codexRepositoryPopover.triggerAria",defaultMessage:"Select repository for Codex"}),Icon:r.jsx($s,{className:"icon-sm","aria-hidden":!0})}),r.jsx(Mt,{sideOffset:8,align:"start",isOpen:m,closePopover:()=>f(!1),popoverContentRef:C,children:r.jsxs("div",{className:"flex max-h-[320px] w-80 flex-col overflow-hidden",children:[r.jsxs("div",{className:"contents",onClick:y=>{y.stopPropagation()},children:[r.jsx(Jt,{ref:b,name:"repository-search",type:"text",autoComplete:"off",value:n,onChange:y=>a(y.target.value),className:"placeholder:text-token-text-tertiary !focus-within:ring-0 my-1.5 w-full border-0 bg-transparent ps-4 outline-none focus:border-0 focus:ring-0 focus:outline-none",inputClassName:"text-sm",placeholder:h.formatMessage({id:"wham.codexRepositoryPopover.searchPlaceholder",defaultMessage:"Search repositories…"}),ariaLabel:h.formatMessage({id:"wham.codexRepositoryPopover.searchAria",defaultMessage:"Search repositories"}),suppressFocus:!0}),r.jsx("div",{className:"bg-token-border-default h-px w-full"})]}),r.jsx("div",{className:"flex-1 overflow-y-auto px-2 py-1.5",children:e&&!s.length?r.jsx("div",{className:"flex items-center justify-center py-8",children:r.jsx(Ne,{})}):p?r.jsxs("div",{className:"flex flex-col items-center gap-1 py-8 text-center",children:[r.jsx("p",{className:"text-token-text-primary text-sm font-medium",children:r.jsx(I,{id:"wham.codexRepositoryPopover.noRepositories",defaultMessage:"No repositories"})}),r.jsx("p",{className:"text-token-text-secondary text-xs",children:r.jsx(I,{id:"wham.codexRepositoryPopover.noRepositoriesDescription",defaultMessage:"Connect a repository or adjust your search"})})]}):r.jsxs("div",{className:"flex flex-col gap-1",children:[s.map(y=>{const j=y.id===(t==null?void 0:t.id);return r.jsx(_e,{label:y.repository_full_name,truncateLabel:!0,isSelected:j,onClick:()=>E(y)},y.id)}),v?r.jsx("p",{className:"text-token-text-secondary py-2 text-center text-xs",children:r.jsx(I,{id:"wham.codexRepositoryPopover.maximumSuggestions",defaultMessage:"Displaying maximum {count} suggestions. Refine your search to see more.",values:{count:Es}})}):r.jsx(Qs,{isFetchingNextPage:!!o,hasNextPage:!!c,fetchNextPage:()=>{c&&!o&&l()},bgColor:"bg-transparent"}),i&&!o&&r.jsx("div",{className:"flex justify-center py-2",children:r.jsx(Ne,{className:"icon-sm"})})]})}),r.jsx("div",{className:"bg-token-border-default h-px w-full"}),r.jsx("div",{className:"bg-token-bg-tertiary px-2 py-1.5",children:r.jsx(_e,{className:X("w-full",t?"cursor-pointer":"cursor-not-allowed opacity-50"),noDefaultHoverState:!t,isDisabled:!t,icon:r.jsx(dr,{className:"icon-sm"}),onClick:()=>{t&&(u==null||u(t),f(!1))},label:h.formatMessage({id:"wham.codexRepositoryPopover.createEnvironment",defaultMessage:"Create environment from repo"})})})]})})]})})}function Zo(){return r.jsx(os,{className:"h-9"})}function Qo(t){"use forget";const e=Ws.c(36),{onClose:s}=t,n=T(),{enabled:a}=es(me.CODEX),i=ae();let o;e[0]===Symbol.for("react.memo_cache_sentinel")?(o=In("installations/select_target"),e[0]=o):o=e[0];const c=o;let l;e[1]!==i?(l=()=>{Pr(c)},e[1]=i,e[2]=l):l=e[2];const d=l;let u;e[3]!==n?(u=n.formatMessage({id:"wham.selectRepositoriesModal.title",defaultMessage:"Select repositories for Codex"}),e[3]=n,e[4]=u):u=e[4];let h;e[5]!==n?(h=n.formatMessage({id:"wham.selectRepositoriesModal.description",defaultMessage:"Codex needs access to at least one repository. Choose the repositories you want Codex to work in from your GitHub settings."}),e[5]=n,e[6]=h):h=e[6];let m;e[7]!==n?(m=n.formatMessage({id:"wham.selectRepositoriesModal.exampleFrontend",defaultMessage:"acme/frontend"}),e[7]=n,e[8]=m):m=e[8];let f;e[9]!==m?(f=r.jsx("span",{className:"text-token-text-primary font-mono",children:m}),e[9]=m,e[10]=f):f=e[10];let p;e[11]!==n?(p=n.formatMessage({id:"wham.selectRepositoriesModal.exampleMobile",defaultMessage:"acme/mobile"}),e[11]=n,e[12]=p):p=e[12];let v;e[13]!==p?(v=r.jsx("span",{className:"text-token-text-primary font-mono",children:p}),e[13]=p,e[14]=v):v=e[14];let x;e[15]!==f||e[16]!==v?(x=r.jsx("div",{className:"bg-token-bg-tertiary text-token-text-secondary border-token-border-subtle rounded-xl border p-4 text-sm leading-6",children:r.jsx(I,{id:"wham.selectRepositoriesModal.example",defaultMessage:"For example, allow Codex to access repositories like {frontend} or {mobile} so it can clone your code and run tasks.",values:{frontend:f,mobile:v}})}),e[15]=f,e[16]=v,e[17]=x):x=e[17];let C;e[18]===Symbol.for("react.memo_cache_sentinel")?(C=r.jsx(I,{id:"wham.selectRepositoriesModal.notNow",defaultMessage:"Maybe later"}),e[18]=C):C=e[18];let b;e[19]!==s?(b=r.jsx(W,{color:"secondary",onClick:s,children:C}),e[19]=s,e[20]=b):b=e[20];const E=!a;let y;e[21]===Symbol.for("react.memo_cache_sentinel")?(y=r.jsx(I,{id:"wham.selectRepositoriesModal.cta",defaultMessage:"Select repositories"}),e[21]=y):y=e[21];let j;e[22]!==d||e[23]!==E?(j=r.jsx(W,{color:"primary",icon:$s,disabled:E,onClick:d,children:y}),e[22]=d,e[23]=E,e[24]=j):j=e[24];let k;e[25]!==b||e[26]!==j?(k=r.jsxs("div",{className:"flex w-full justify-end gap-2",children:[b,j]}),e[25]=b,e[26]=j,e[27]=k):k=e[27];let g;e[28]!==k||e[29]!==x?(g=r.jsxs("div",{className:"flex flex-col gap-4",children:[x,k]}),e[28]=k,e[29]=x,e[30]=g):g=e[30];let M;return e[31]!==s||e[32]!==g||e[33]!==u||e[34]!==h?(M=r.jsx(Vs,{isOpen:!0,onClose:s,testId:"modal-select-repositories",title:u,description:h,children:g}),e[31]=s,e[32]=g,e[33]=u,e[34]=h,e[35]=M):M=e[35],M}function Xo({onCreateEnvironment:t}){"use no forget";const e=T(),[s,n]=w.useState(null),{isConnected:a,isLoading:i,openGithubModal:o,error:c,refetch:l}=vt(bt.GITHUB_CONNECTOR,"github","/codex",me.CODEX),{enabled:d}=es(me.CODEX),u=F(_=>_.setSelectedRepositoryId),h=F(_=>_.selectedRepositoryId),m=F(_=>_.setBranch),[f,p]=w.useState(""),v=zs(f.trim(),200),{data:x,isLoading:C,isError:b,fetchNextPage:E,hasNextPage:y,isFetchingNextPage:j,isFetching:k}=Fr(v),{data:g}=Xt({queryKey:["wham","repository",h!=null?h:""],enabled:!!h&&!s,queryFn:()=>Be.getRepository(h!=null?h:""),staleTime:5*60*1e3});w.useEffect(()=>{g&&n(g)},[g]),w.useEffect(()=>{!s&&!g&&m(null)},[s,g,m]),w.useEffect(()=>{!g&&!s&&x&&x.pages.length>0&&x.pages[0].repo_review_settings.length>0&&x.pages[0].repo_review_settings[0].repository&&(n(x.pages[0].repo_review_settings[0].repository),u(x.pages[0].repo_review_settings[0].repository.id))},[x,s,g,u]);const M=w.useMemo(()=>{var _;return((_=x==null?void 0:x.pages)!=null?_:[]).flatMap(G=>{var Z;return(Z=G.repo_review_settings)!=null?Z:[]}).map(G=>G.repository).filter(Boolean)},[x]),N=w.useMemo(()=>{var Oe;const _=[],G=new Set,Z=te=>{te&&te.id&&!G.has(te.id)&&(_.push(te),G.add(te.id))};return Z((Oe=s!=null?s:g)!=null?Oe:void 0),M.forEach(te=>Z(te)),_},[M,s,g]),B=()=>{t==null||t()},H=i||C&&!f,R=w.useRef(!1),Y=ae();return w.useEffect(()=>{R.current||H||C||b||M.length>0||k||i||!a||!d||c||(Rn(Y,Qo),R.current=!0)},[Y,M.length,N.length,c,i,k,a,C,d,H,b]),H?r.jsx(Zo,{}):c?r.jsx(ee,{label:e.formatMessage({id:"wham.whamComposerRepositorySelector.failedClickToRetry",defaultMessage:"Click to retry"}),children:r.jsx(W,{color:"secondary",type:"button",className:"border-token-border-default flex w-fit items-center gap-1.5 rounded-full! border",onClick:l,children:r.jsxs("div",{className:"flex items-center gap-1.5",children:[r.jsx(rs,{"aria-hidden":!0,className:"icon-sm"}),r.jsx(I,{id:"wham.whamComposerRepositorySelector.retry",defaultMessage:"Failed to load repositories"})]})})}):d?r.jsx("div",{className:"z-0 flex w-full justify-between",children:a?r.jsxs("div",{className:"flex gap-2",children:[r.jsx(Yo,{selectedRepository:s,onSelect:_=>{u(_.id),n(_)},isLoading:C,combinedRepositories:N,search:f,setSearch:p,isFetchingNextPage:j,hasNextPage:y,fetchNextPage:E,isFetching:k,onCreateEnvironmentFromRepo:B}),s?r.jsx(en,{repository:s}):null]}):r.jsx("div",{className:"flex gap-2",children:r.jsxs(W,{type:"button",color:"secondary",size:"small",onClick:o,children:[r.jsx(Le,{"aria-hidden":!0,className:"icon-sm me-1.5"}),r.jsx(I,{id:"wham.environmentsSelector.connectGithub",defaultMessage:"Connect GitHub"})]})})}):r.jsx(ee,{label:e.formatMessage({id:"wham.whamComposerRepositorySelector.disabledByWorkspaceAdmin",defaultMessage:"Disabled by workspace admin"}),children:r.jsxs(W,{type:"button",color:"secondary",onClick:o,disabled:!0,children:[r.jsx(Le,{"aria-hidden":!0,className:"icon-sm me-1.5"}),r.jsx(I,{id:"wham.environmentsSelector.connectGithub",defaultMessage:"Connect GitHub"})]})})}function is(t){const e=T(),s=F(n=>{var a;return(a=n.getRateLimit())==null?void 0:a.resets_after_text});switch(t){case"enabled":return;case"rate-limit":return e.formatMessage({id:"wham.whamComposer.hitRateLimit",defaultMessage:"You have reached your rate limit. It will reset {resetsAfterText}"},{resetsAfterText:s});case"no-environment":return e.formatMessage({id:"wham.whamComposer.noEnvironment",defaultMessage:"No environment selected"});case"no-content":return e.formatMessage({id:"wham.whamComposer.noContent",defaultMessage:"Enter a prompt to continue"});case"no-github-connection":return e.formatMessage({id:"wham.whamComposer.noGitHubConnection",defaultMessage:"No GitHub connection"});case"no-repository":return e.formatMessage({id:"wham.whamComposer.noRepository",defaultMessage:"No repository selected"});case"connect-github-error":return e.formatMessage({id:"wham.whamComposer.connectGitHubError",defaultMessage:"Failed to load environments"});default:Dn(t)}}function cs({isFollowUp:t,hasComments:e}){const s=F(m=>{var f;return((f=m.getRateLimit())==null?void 0:f.remaining)===0}),n=F(({environmentId:m})=>m),a=F(({selectedRepositoryId:m})=>m),i=sn(),o=F(({branch:m})=>m),c=Ks(),d=!$t(()=>Us(c))||e,{isConnected:u,error:h}=vt(bt.GITHUB_CONNECTOR,"github","/codex",me.CODEX);if(s)return"rate-limit";if(!n&&!o&&!t)if(i){if(!a)return"no-repository"}else return"no-environment";else{if(!t&&!u)return"no-github-connection";if(!t&&h)return"connect-github-error";if(!d)return"no-content"}return"enabled"}function Jo({comments:t,onClearComments:e}){const s=T();return t.length===0?null:r.jsxs("div",{className:"bg bg-token-bg-secondary mx-1 mt-1 flex items-center gap-2 rounded-t-3xl rounded-b-lg py-0.5 ps-3 pe-0.5 font-semibold text-blue-400",children:[r.jsx(Ys,{className:"icon"}),r.jsx("div",{className:"flex-1 text-sm",children:r.jsx(I,{id:"wham.composer.commentCount",defaultMessage:"{count, plural, one {One code comment} other {# code comments}}",values:{count:t.length}})}),r.jsx("button",{className:"text-token-text-secondary flex h-9 w-9 shrink-0 items-center justify-center",onClick:n=>{n.preventDefault(),n.stopPropagation(),e()},"aria-label":s.formatMessage({id:"wham.composer.clearComments",defaultMessage:"Clear comments"}),children:r.jsx(Tn,{className:"icon"})})]})}function ea(){const t=T(),e=Ps(),{setupMfa:s}=Wr({redirectUrl:"/codex"});return r.jsx(Vs,{isOpen:!0,onClose:()=>{},type:"warning",title:t.formatMessage({id:"wham.mfaRequiredModal.title",defaultMessage:"Enable multi-factor authentication to access Codex"}),description:t.formatMessage({id:"wham.mfaRequiredModal.description",defaultMessage:"To continue using Codex, please turn on multi-factor authentication for your account."}),testId:"modal-mfa-required",children:r.jsxs("div",{className:"flex w-full justify-end gap-2",children:[r.jsx(W,{color:"secondary",onClick:()=>{e("/")},children:r.jsx(I,{id:"wham.mfaRequiredModal.backToChatGPT",defaultMessage:"Back to ChatGPT"})}),r.jsx(W,{color:"primary",onClick:()=>{s()},children:r.jsx(I,{id:"wham.mfaRequiredModal.enableMFA",defaultMessage:"Enable MFA"})})]})})}const ta=t=>w.createElement("svg",V({width:18,height:18,viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),w.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.5 4.5C5.68355 4.5 5.84354 4.62492 5.88806 4.80299C6.08089 5.57434 6.30775 6.04206 6.63284 6.36716C6.95794 6.69225 7.42566 6.91911 8.19701 7.11194C8.37508 7.15646 8.5 7.31645 8.5 7.5C8.5 7.68355 8.37508 7.84354 8.19701 7.88806C7.42566 8.08089 6.95794 8.30775 6.63284 8.63284C6.30775 8.95794 6.08089 9.42566 5.88806 10.197C5.84354 10.3751 5.68355 10.5 5.5 10.5C5.31645 10.5 5.15646 10.3751 5.11194 10.197C4.91911 9.42566 4.69225 8.95794 4.36716 8.63284C4.04206 8.30775 3.57434 8.08089 2.80299 7.88806C2.62492 7.84354 2.5 7.68355 2.5 7.5C2.5 7.31645 2.62492 7.15646 2.80299 7.11194C3.57434 6.91911 4.04206 6.69225 4.36716 6.36716C4.69225 6.04206 4.91911 5.57434 5.11194 4.80299C5.15646 4.62492 5.31645 4.5 5.5 4.5Z",fill:"currentColor"}),w.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12.5 2.5C12.6835 2.5 12.8435 2.62492 12.8881 2.80299C13.0809 3.57434 13.3077 4.04206 13.6328 4.36716C13.9579 4.69225 14.4257 4.91911 15.197 5.11194C15.3751 5.15646 15.5 5.31645 15.5 5.5C15.5 5.68355 15.3751 5.84354 15.197 5.88806C14.4257 6.08089 13.9579 6.30775 13.6328 6.63284C13.3077 6.95794 13.0809 7.42566 12.8881 8.19701C12.8435 8.37508 12.6835 8.5 12.5 8.5C12.3165 8.5 12.1565 8.37508 12.1119 8.19701C11.9191 7.42566 11.6923 6.95794 11.3672 6.63284C11.0421 6.30775 10.5743 6.08089 9.80299 5.88806C9.62492 5.84354 9.5 5.68355 9.5 5.5C9.5 5.31645 9.62492 5.15646 9.80299 5.11194C10.5743 4.91911 11.0421 4.69225 11.3672 4.36716C11.6923 4.04206 11.9191 3.57434 12.1119 2.80299C12.1565 2.62492 12.3165 2.5 12.5 2.5Z",fill:"currentColor"}),w.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10.5 9.5C10.6835 9.5 10.8435 9.62492 10.8881 9.80299C11.0809 10.5743 11.3077 11.0421 11.6328 11.3672C11.9579 11.6923 12.4257 11.9191 13.197 12.1119C13.3751 12.1565 13.5 12.3165 13.5 12.5C13.5 12.6835 13.3751 12.8435 13.197 12.8881C12.4257 13.0809 11.9579 13.3077 11.6328 13.6328C11.3077 13.9579 11.0809 14.4257 10.8881 15.197C10.8435 15.3751 10.6835 15.5 10.5 15.5C10.3165 15.5 10.1565 15.3751 10.1119 15.197C9.91911 14.4257 9.69225 13.9579 9.36716 13.6328C9.04206 13.3077 8.57434 13.0809 7.80299 12.8881C7.62492 12.8435 7.5 12.6835 7.5 12.5C7.5 12.3165 7.62492 12.1565 7.80299 12.1119C8.57434 11.9191 9.04206 11.6923 9.36716 11.3672C9.69225 11.0421 9.91911 10.5743 10.1119 9.80299C10.1565 9.62492 10.3165 9.5 10.5 9.5Z",fill:"currentColor"}));function Sa(t){const{outputDiffs:e}=fn(t==null?void 0:t.output_items);return{filesModified:xt(e,s=>{var n;return(n=s.files_modified)!=null?n:0}),linesAdded:xt(e,s=>{var n;return(n=s.lines_added)!=null?n:0}),linesRemoved:xt(e,s=>{var n;return(n=s.lines_removed)!=null?n:0})}}function fn(t){let e=!1;return t?{outputDiffs:t.map(n=>{switch(n.type){case"output_diff":return n;case"pr":return e=!!n.pre_apply_patch,n.output_diff;case"cr":return n.reviewed_diff;default:return null}}).filter(n=>n!=null),hasPreApplyPatch:e}:{outputDiffs:[],hasPreApplyPatch:e}}const sa=Ln(()=>On(()=>import("./d448b1vfu6r7o26l.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30])).then(t=>t.SpeculativeTaskContentModal));function na({taskId:t,index:e,assistantTurn:s,suggestion:n,disabledReason:a,loading:i}){const{outputDiffs:o}=fn(s.output_items),c=o[0];return r.jsx(ee,{side:"right",sideOffset:10,label:a,children:r.jsxs("div",{className:"flex w-full items-center gap-1.5 rounded-lg px-2 py-1",children:[r.jsx("span",{className:"self-start pt-[0.125rem]",children:i?r.jsx(Ne,{className:"text-token-text-tertiary icon-sm"}):r.jsx(ta,{className:"text-token-text-tertiary icon-sm"})}),r.jsx("span",{className:"text-token-text-primary line-clamp-2 flex-1 text-start text-sm leading-snug break-words",children:n.title}),c&&c.lines_added!=null&&c.lines_removed!=null&&r.jsx(Ir,{className:"text-sm",linesAdded:c.lines_added,linesRemoved:c.lines_removed}),r.jsx(ra,{taskId:t,assistantTurn:s,suggestion:n,index:e})]})})}function ra({taskId:t,assistantTurn:e,suggestion:s,index:n}){const[a,i]=w.useState(!1);return r.jsxs("div",{onClick:o=>{o.stopPropagation(),o.preventDefault()},children:[r.jsx(W,{color:"secondary",size:"small",icon:hr,onClick:o=>{o.stopPropagation(),o.preventDefault(),i(!0)},children:r.jsx(I,{id:"wham.speculativeFollowUpSuggestionRow.preview",defaultMessage:"Preview"})}),r.jsx(sa,{taskId:t,suggestion:s,index:n,assistantTurn:e,isOpen:a,onClose:()=>i(!1)})]})}function oa({taskId:t,turnId:e,followupVisibilityState:s,followUpSuggestions:n,hasComments:a,isSubmitting:i,onSuggestionClick:o,children:c}){const l=T(),[d,u]=w.useState(null),{data:h}=aa({taskId:t,turnId:e}),m=cs({isFollowUp:!0,hasComments:a});let f=is(m);m==="no-content"&&(f=void 0);const p=!!(h!=null&&h.length)&&t&&e;return w.useEffect(()=>{p&&pe.recordFollowUpsSeen(t,e,n.length)},[p,t,e,n.length]),p?r.jsxs("div",{className:"bg-token-bg-tertiary flex flex-col gap-1.5 rounded-2xl p-2",children:[r.jsx(Hs,{initial:!1,children:s==="visible"&&r.jsx("div",{className:"flex flex-col",inert:i,children:h.map(({suggested_task:v,assistant_turn:x},C)=>r.jsx(na,{index:C,taskId:t,turnId:e,assistantTurn:x,suggestion:v,disabledReason:f,loading:d===C&&i,onClick:()=>{i||(u(C),o(v))}},C))})}),s==="collapsed"&&r.jsxs("button",{type:"button",className:"text-token-text-tertiary enabled:hover:text-token-text-secondary focus:bg-token-bg-secondary flex items-center gap-2 rounded-lg p-2 text-xs font-semibold focus:outline-none","aria-label":l.formatMessage({id:"wham.speculativeFollowUpContainer.showSuggestions",defaultMessage:"Show follow up suggestions"}),onClick:()=>{pe.recordFollowUpsExpanded(t,e)},children:[r.jsx(Zs,{className:"icon-sm"}),r.jsx(I,{id:"wham.composer.followup.show",defaultMessage:"Suggestions"},"text")]},"collapsed"),c({isWrappedByContainer:!0})]}):c({isWrappedByContainer:!1})}function aa({taskId:t,turnId:e}){return Xt({queryKey:["wham","speculative-turns",t,e],queryFn:async()=>{const s=await Pn.safeGet("/wham/tasks/{task_id}/speculative_turns/{task_turn_id}",{parameters:{path:{task_id:t,task_turn_id:e}}}),n=s.speculative_turns;return Hr(n,i=>i.assistant_turn.turn_status==="completed")?s.speculative_turns.filter(i=>!i.assistant_turn.discarded):[]},refetchInterval:s=>{var a,i;return s&&((i=(a=s.state)==null?void 0:a.data)==null?void 0:i.some(o=>o.assistant_turn.turn_status==="pending"||o.assistant_turn.turn_status==="in_progress"))?3e4:!1}})}function ia({taskId:t,turnId:e,isComposerExpanded:s,followUpSuggestions:n,hasComments:a,isSubmitting:i,onSuggestionClick:o,children:c}){const l=ae(),d=la(l,s),u=T(),[h,m]=w.useState(null),f=cs({isFollowUp:!0,hasComments:a});let p=is(f);f==="no-content"&&(p=void 0);const v=!(d==="hidden"||!n.length)&&t&&e;if(w.useEffect(()=>{v&&pe.recordFollowUpsSeen(t,e,n.length)},[v,t,e,n.length]),v){if(fe(l,"2007094101")&&n.find(x=>!!x.assistantTurnId))return r.jsx(oa,{taskId:t,turnId:e,followupVisibilityState:d,followUpSuggestions:n,hasComments:a,isSubmitting:i,onSuggestionClick:o,children:({isWrappedByContainer:x})=>c({isWrappedByContainer:x})})}else return c({isWrappedByContainer:!1});return r.jsxs("div",{className:"bg-token-bg-tertiary flex flex-col gap-1.5 rounded-2xl p-2",children:[r.jsx(Hs,{initial:!1,children:d==="visible"&&r.jsx("div",{className:"flex flex-col",inert:i,children:n.map((x,C)=>r.jsx(ca,{index:C,taskId:t,turnId:e,suggestion:x.suggestion,disabledReason:p,loading:h===C&&i,onClick:()=>{i||(m(C),o(x.suggestion))}},C))})}),d==="collapsed"&&r.jsxs("button",{type:"button",className:"text-token-text-tertiary enabled:hover:text-token-text-secondary focus:bg-token-bg-secondary flex items-center gap-2 rounded-lg p-2 text-xs font-semibold focus:outline-none","aria-label":u.formatMessage({id:"wham.followUpContainer.showSuggestions",defaultMessage:"Show follow up suggestions"}),onClick:()=>{pe.recordFollowUpsExpanded(t,e)},children:[r.jsx(Zs,{className:"icon-sm"}),r.jsx(I,{id:"wham.composer.followup.show",defaultMessage:"Suggestions"},"text")]},"collapsed"),c({isWrappedByContainer:!0})]})}function ca({taskId:t,turnId:e,index:s,suggestion:n,disabledReason:a,loading:i,onClick:o}){return r.jsx(ee,{side:"right",sideOffset:10,label:a,children:r.jsxs("button",{type:"button",disabled:!!a||i,className:"group hover:bg-token-bg-secondary focus:bg-token-bg-secondary -disabled:cursor-pointer flex w-full items-start gap-1.5 rounded-lg px-2 py-1 focus:outline-none disabled:cursor-not-allowed disabled:opacity-50",onClick:()=>{o(),pe.recordFollowUpsClicked(t,e,s,n.severity)},children:[r.jsx("span",{className:"pt-[0.125rem]",children:i?r.jsx(Ne,{className:"text-token-text-tertiary icon-sm"}):r.jsx(Ys,{className:"text-token-text-tertiary icon-sm"})}),r.jsx("span",{className:"text-token-text-primary line-clamp-2 text-start text-sm leading-snug break-words",children:n.title})]})})}function la(t,e){return fe(t,"3485296344")||void 0?e?"collapsed":"visible":"hidden"}function ua(){const t=ae(),e=F(n=>n.bestOfN);return e!=null?e:Wn(t,"2398649844").get("default_attempts",1)}function Na(t){"use forget";var ds,hs,fs,ms;const e=Ws.c(125),{disableAutoFocus:s,isBigBoxMode:n,disableDuringSubmit:a,expanded:i,followUp:o,onClearComments:c,onSubmit:l,onSuccess:d,onCreateEnvironment:u,attemptIndex:h,ariaLabel:m,showRepositorySelector:f}=t,p=s===void 0?!1:s,v=n===void 0?!1:n,x=a===void 0?!1:a,C=T(),b=Gs(),{refetch:E}=Rr(),{refetch:y}=Dr(o==null?void 0:o.taskId),{refetch:j}=Tr(o==null?void 0:o.taskId),k=F(xa),g=F(ga),[M,N]=w.useState(!0),[B,H]=w.useState(!1),R=Hn(),Y=vs(pa),_=vs(Lt.hasUploadInProgress),G=ua(),Z=F(ma),[Oe,te]=w.useState(1),ce=o?Oe:G,Et=o?te:Z,se=ae();let Pe;e[0]!==se?(Pe=fe(se,"3492040717"),e[0]=se,e[1]=Pe):Pe=e[1];const le=Pe;let We;e[2]!==se?(We=fe(se,"879591222")||void 0,e[2]=se,e[3]=We):We=e[3];const mn=We;let He;e[4]!==se?(He=fe(se,"3536244140"),e[4]=se,e[5]=He):He=e[5];const Ge=He,K=Gr(),[jt,ls]=w.useState(!1),S=Ks();let qe;e[6]!==S?(qe=fr(S),e[6]=S,e[7]=qe):qe=e[7];const ge=$t(qe.isWhisperActive$),us=w.useRef(null),$e=F(fa),xe=$e&&!!o,Ie=xe?!1:ge?!0:i;let Ve;e[8]!==S||e[9]!==Ie?(Ve=()=>Ie!=null?Ie:!Us(S)||Gn(S),e[8]=S,e[9]=Ie,e[10]=Ve):Ve=e[10];const re=$t(Ve),At=x&&B||xe,$=!!o&&((ds=o.comments.length)!=null?ds:0)>0;let Ke;e[11]!==R||e[12]!==C||e[13]!==b?(Ke=D=>{for(const L of D)mt.uploadFile(R,qn(L),L,$n.Codex,[],C,b)},e[11]=R,e[12]=C,e[13]=b,e[14]=Ke):Ke=e[14];const ue=Ke;let Ue;e[15]!==ue?(Ue=function(L){const O=L.target.files;O&&(ue(O),L.target.value="")},e[15]=ue,e[16]=Ue):Ue=e[16];const kt=Ue;let ze,Ye;e[17]!==S||e[18]!==K||e[19]!==ue?(ze=()=>{if(!K)return;const D=L=>{var De;const O=(De=L.clipboardData)==null?void 0:De.items;if(!O)return;const Q=[];for(const Dt of O)if(Dt.kind==="file"){const ke=Dt.getAsFile();ke&&ke.type.startsWith("image/")&&Q.push(ke)}Q.length>0&&(L.preventDefault(),ue(Q))};return Vn(oe(S).dom,{paste:D})},Ye=[S,K,ue],e[17]=S,e[18]=K,e[19]=ue,e[20]=ze,e[21]=Ye):(ze=e[20],Ye=e[21]),w.useEffect(ze,Ye);let Ze;e[22]!==R?(Ze=function(){return Lt.getReadyFiles(R.getState()).flatMap(ha)},e[22]=R,e[23]=Ze):Ze=e[23];const St=Ze;let Ce;e[24]!==S?(Ce=()=>bs(oe(S)),e[24]=S,e[25]=Ce):Ce=e[25];let we;e[26]!==C?(we=C.formatMessage({id:"wham.keyboardActions.focusComposer",defaultMessage:"Focus chat"}),e[26]=C,e[27]=we):we=e[27];let Qe;e[28]===Symbol.for("react.memo_cache_sentinel")?(Qe=[Se.Shift,Se.Escape],e[28]=Qe):Qe=e[28];let ve;e[29]!==o?(ve=o?void 0:[[Se.Mod,Se.Shift,"o"]],e[29]=o,e[30]=ve):ve=e[30];let Xe;e[31]!==Ce||e[32]!==we||e[33]!==ve?(Xe=[{key:"focusComposer",action:Ce,actionMessageDescriptor:we,group:ts.Chat,keyboardBinding:Qe,altKeyboardBindings:ve}],e[31]=Ce,e[32]=we,e[33]=ve,e[34]=Xe):Xe=e[34],ns(Xe);const Nt=!!o;let Je;e[35]!==$||e[36]!==Nt?(Je={isFollowUp:Nt,hasComments:$},e[35]=$,e[36]=Nt,e[37]=Je):Je=e[37];const pn=cs(Je),{isConnected:Re}=vt(bt.GITHUB_CONNECTOR,"github","/codex",me.CODEX),et=is(pn),be=!!et||B&&x||_;let Me;e[38]!==ce||e[39]!==le||e[40]!==S||e[41]!==R||e[42]!==o||e[43]!==St||e[44]!==$||e[45]!==C||e[46]!==M||e[47]!==K||e[48]!==l||e[49]!==b?(Me=async D=>{const{runEnvironmentInQaMode:L,promptOverride:O}=D===void 0?{runEnvironmentInQaMode:!1}:D,Q=O!=null?O:Kn(oe(S).state.doc).content,De=Lt.getReadyFiles(R.getState());if(!(!!Q.length||$))throw new Error("No content to submit");const ke=K?St():[];if(l==null||l(),mt.reset(R),H(!0),o)return await Be.createFollowUpTask(o.taskId,o.turnId,Q,o.comments,L,le?ce:void 0,ke).catch(z=>{var Te;throw O||(Ms(oe(S),Q),mt.restoreFiles(R,De)),z instanceof pt&&z.status===429?b.danger(C.formatMessage(Ts.rateLimit),{id:o.turnId,duration:5,hasCloseButton:!0}):z instanceof js?As(z,o.turnId,C,b):z instanceof pt&&z.status===403&&((Te=z.detail)!=null&&Te.toLowerCase().includes("multi-factor authentication"))?ls(!0):b.danger(C.formatMessage({id:"wham.whamComposer.failedToCreateFollowUpTask",defaultMessage:"Failed to create follow-up"}),{id:o.turnId,duration:5,hasCloseButton:!0}),z});{const{branch:z,environmentId:Te}=F.getState(),gn=M;if(z){if(!Te)throw new Error("Environment is required for new tasks.")}else throw new Error("Branch is required");const de=crypto.randomUUID();return F.getState().addPendingTaskId(de),Be.createNewTask(Te,z,Q,L,le?ce:void 0,ke).catch(P=>{throw F.getState().removePendingTaskId(de),O||(Un(oe(S).state.doc)?(Ms(oe(S),Q),mt.restoreFiles(R,De)):(b.danger(C.formatMessage({id:"wham.whamComposer.failedToCreateTaskCopyToClipboard",defaultMessage:"Failed to create task. Previous prompt copied to clipboard."}),{id:de,duration:5,hasCloseButton:!0}),navigator.clipboard.writeText(Q))),P}).catch(P=>{var ps;throw P instanceof pt&&P.status===429?b.danger(C.formatMessage(Ts.rateLimit),{id:de,duration:5,hasCloseButton:!0}):P instanceof js?As(P,de,C,b):P instanceof pt&&P.status===403&&((ps=P.detail)!=null&&ps.toLowerCase().includes("multi-factor authentication"))?ls(!0):b.danger(C.formatMessage({id:"wham.whamComposer.failedToCreateTask",defaultMessage:"Failed to create task"}),{id:de,duration:5,hasCloseButton:!0}),P}).then(P=>(F.getState().assignPendingTaskToFinalTask(de,P.task.id),F.getState().setRateLimit(P.rate_limit),gn&&N(!1),P))}},e[38]=ce,e[39]=le,e[40]=S,e[41]=R,e[42]=o,e[43]=St,e[44]=$,e[45]=C,e[46]=M,e[47]=K,e[48]=l,e[49]=b,e[50]=Me):Me=e[50];let ye;e[51]!==k||e[52]!==S||e[53]!==o||e[54]!==d||e[55]!==y||e[56]!==E||e[57]!==j||e[58]!==g?(ye=D=>{g(!0),k(D.task.id,D.turn),D.user_turn&&k(D.task.id,D.user_turn),d==null||d(D),setTimeout(()=>{bs(oe(S))},0),E(),o&&(y(),j())},e[51]=k,e[52]=S,e[53]=o,e[54]=d,e[55]=y,e[56]=E,e[57]=j,e[58]=g,e[59]=ye):ye=e[59];let tt;e[60]===Symbol.for("react.memo_cache_sentinel")?(tt=()=>{H(!1)},e[60]=tt):tt=e[60];let st;e[61]!==Me||e[62]!==ye?(st={mutationFn:Me,onSuccess:ye,onSettled:tt},e[61]=Me,e[62]=ye,e[63]=st):st=e[63];const{mutate:U,isPending:nt}=Os(st);let rt;e[64]!==U||e[65]!==be?(rt=D=>be?!1:D.metaKey?(U({runEnvironmentInQaMode:!1}),!0):D.altKey?(U({runEnvironmentInQaMode:!0}),!0):!1,e[64]=U,e[65]=be,e[66]=rt):rt=e[66];const ot=mr(rt);let at,it;e[67]!==S||e[68]!==ot?(at=()=>zn(oe(S),{Enter:ot}),it=[S,ot],e[67]=S,e[68]=ot,e[69]=at,e[70]=it):(at=e[69],it=e[70]),w.useEffect(at,it);let ct;e[71]!==o?(ct=xt(o?[o.turnStatus,...o.siblingTurnStatuses]:[],da),e[71]=o,e[72]=ct):ct=e[72];const lt=ct,ut=!!o&&mn&&lt>0,Bt=!ut&&(Ge?!ge:!0),_t=((fs=(hs=o==null?void 0:o.siblingTurnStatuses)==null?void 0:hs.length)!=null?fs:0)>1;let dt;e[73]!==h||e[74]!==_t||e[75]!==C?(dt=_t&&h?C.formatMessage({id:"wham.whamComposer.followUpOnTurn",defaultMessage:"Follow-up on version {version}"},{version:h}):C.formatMessage({id:"wham.whamComposer.requestChangesOrAskAQuestion",defaultMessage:"Request changes or ask a question"}),e[73]=h,e[74]=_t,e[75]=C,e[76]=dt):dt=e[76];const Ft=dt,It=o==null?void 0:o.taskId,Rt=o==null?void 0:o.turnId;let Ee;e[77]!==(o==null?void 0:o.followUpSuggestions)?(Ee=(ms=o==null?void 0:o.followUpSuggestions)!=null?ms:[],e[77]=o==null?void 0:o.followUpSuggestions,e[78]=Ee):Ee=e[78];let je;e[79]!==U?(je=D=>{U({runEnvironmentInQaMode:!1,promptOverride:D.body})},e[79]=U,e[80]=je):je=e[80];let Ae;e[81]!==m||e[82]!==ce||e[83]!==le||e[84]!==S||e[85]!==At||e[86]!==U||e[87]!==p||e[88]!==et||e[89]!==o||e[90]!==Ft||e[91]!==$||e[92]!==$e||e[93]!==lt||e[94]!==C||e[95]!==v||e[96]!==nt||e[97]!==re||e[98]!==M||e[99]!==Re||e[100]!==K||e[101]!==be||e[102]!==B||e[103]!==ge||e[104]!==c||e[105]!==u||e[106]!==kt||e[107]!==Y||e[108]!==Et||e[109]!==jt||e[110]!==xe||e[111]!==f||e[112]!==ut||e[113]!==Bt||e[114]!==Ge?(Ae=D=>{const{isWrappedByContainer:L}=D;return r.jsxs("div",{className:"contents",inert:At,children:[r.jsxs(pr,{expanded:re,canCollapseWithInput:!nt&&L,isTemporaryChat:!1,shouldUseTightRadius:L,onSubmit:()=>{nt||U({runEnvironmentInQaMode:!1})},composerController:S,ariaLabel:m!=null?m:C.formatMessage({id:"wham.whamComposer.ariaLabel",defaultMessage:"Codex composer"}),children:[r.jsx(gr,{children:ge?r.jsx("div",{className:X("flex max-w-full min-w-0 flex-1 items-center",v&&re&&"min-h-30"),children:r.jsx(xr,{composerController:S,className:"h-14"})}):r.jsx(Cr,{composerController:S,disableAutoFocus:p||$e,textareaMaxHeightClassName:X(v&&re&&"min-h-30",o?"max-h-[max(10rem,min(calc(100dvh-29rem),10rem))]":"max-h-[max(10rem,min(calc(100dvh-29rem),50dvh))]"),placeholder:o?Ft:M?C.formatMessage({id:"wham.whamComposer.describeACodingTask",defaultMessage:"Describe a task"}):C.formatMessage({id:"wham.whamComposer.describeAnotherCodingTask",defaultMessage:"Describe another task"})})}),Re&&K&&Y.length>0&&r.jsx(ys,{children:r.jsx(wr,{files:Y,selectedApps:[],activeSystemHintType:void 0,disableEditButton:!0,forceSmallView:!0,className:"no-scrollbar horizontal-scroll-fade-mask flex flex-nowrap gap-2 overflow-x-auto px-2.5 pt-2.5 pb-1.5 [--edge-fade-distance:1rem]"})}),Re&&K&&r.jsx(vr,{children:r.jsxs(r.Fragment,{children:[r.jsx("input",{ref:us,type:"file",accept:"image/*",multiple:!0,hidden:!0,onChange:kt}),r.jsx("button",{type:"button",className:"composer-btn","aria-label":C.formatMessage({id:"wham.whamComposer.attachImage",defaultMessage:"Attach image"}),onClick:()=>{var O;return(O=us.current)==null?void 0:O.click()},children:r.jsx(br,{className:"icon"})})]})}),$&&r.jsx(ys,{children:r.jsx(Jo,{comments:o.comments,onClearComments:c})}),!ge&&r.jsx(Mr,{children:r.jsxs("div",{className:"flex gap-2",children:[!o&&(f?r.jsx(Xo,{onCreateEnvironment:u}):r.jsx(zo,{onCreateEnvironment:u})),le&&Re&&r.jsx(Xr,{attempts:ce,setAttempts:Et})]})}),r.jsxs(yr,{children:[!xe&&r.jsxs("div",{className:"flex",children:[Ge&&r.jsx("div",{inert:B,children:r.jsx(Er,{composerController:S,composerType:"codex"})}),Bt&&r.jsx(Yr,{isSubmitDisabled:be,createTask:U,disabledReason:et,isFollowUp:!!o}),ut&&r.jsx(Vr,{taskId:o.taskId,hasMultipleInProgressOrStreamingTurns:lt>1})]}),xe&&r.jsx(Lr,{})]})]}),jt&&r.jsx(ea,{})]})},e[81]=m,e[82]=ce,e[83]=le,e[84]=S,e[85]=At,e[86]=U,e[87]=p,e[88]=et,e[89]=o,e[90]=Ft,e[91]=$,e[92]=$e,e[93]=lt,e[94]=C,e[95]=v,e[96]=nt,e[97]=re,e[98]=M,e[99]=Re,e[100]=K,e[101]=be,e[102]=B,e[103]=ge,e[104]=c,e[105]=u,e[106]=kt,e[107]=Y,e[108]=Et,e[109]=jt,e[110]=xe,e[111]=f,e[112]=ut,e[113]=Bt,e[114]=Ge,e[115]=Ae):Ae=e[115];let ht;return e[116]!==$||e[117]!==re||e[118]!==B||e[119]!==It||e[120]!==Rt||e[121]!==Ee||e[122]!==je||e[123]!==Ae?(ht=r.jsx(ia,{taskId:It,turnId:Rt,isComposerExpanded:re,followUpSuggestions:Ee,hasComments:$,isSubmitting:B,onSuggestionClick:je,children:Ae}),e[116]=$,e[117]=re,e[118]=B,e[119]=It,e[120]=Rt,e[121]=Ee,e[122]=je,e[123]=Ae,e[124]=ht):ht=e[124],ht}function da(t){return t==="pending"||t==="in_progress"?1:0}function ha(t){const e=t.fileSpec;return e&&"width"in e&&"height"in e&&t.fileId?[{type:"image_asset_pointer",asset_pointer:Yn(t.fileId),width:e.width,height:e.height,size_bytes:e.size}]:[]}function fa(t){var e;return((e=t.getRateLimit())==null?void 0:e.remaining)===0}function ma(t){return t.setBestOfN}function pa(t){return t.files}function ga(t){return t.setHasSubmittedTaskInSession}function xa(t){const{addTurnToTaskMap:e}=t;return e}const Ts=Mn({rateLimit:{id:"wham.whamComposer.failedToCreateTaskRateLimit",defaultMessage:"Codex is busy right now. Please try again later."}});export{rs as S,Na as W,sn as a,zr as b,fn as c,Sa as d,tn as g,xt as s,Gr as u};
//# sourceMappingURL=jt0fc5oel309hgy2.js.map
