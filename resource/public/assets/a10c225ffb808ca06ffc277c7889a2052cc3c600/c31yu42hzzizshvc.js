import{r as S,j as l}from"./jj85rqzpbnvv3emr.js";import{C as k}from"./mfwj3virv4i9ko6p.js";import{D as J,a as K}from"./m1gt25yur8ncekq0.js";import{T as Q,a as Y,A as P,u as Z,i as y,C as z,g as tt}from"./iwpn1avuswb5fupo.js";import{C as ot,c as et}from"./g9xi6m5yzu4rtfn2.js";import{C as M}from"./kq1ir6pxp9hst9p9.js";import{u as rt,a as it,b as nt,c as U}from"./erm6n5lmbxodgs50.js";import{C as st}from"./nfygy4vif6crzpny.js";import{b as lt,eE as mt,bb as R,l$ as ct}from"./mclphevd122040jw.js";import{cX as at}from"./lef5ym39glv4981l.js";import{u as ut}from"./lbaueofbjv8jfqwm.js";import"./iqw8c7pica2coyb9.js";import"./gvtmvkg8brwofs4l.js";import"./dbde1xv38cr6eaxy.js";import"./em4qf21fn7t7dhqg.js";import"./g2yrrlnprx92uhjb.js";import"./gwaaxp36jr4o1a8o.js";import"./l66h8h301eaq59ck.js";import"./hzcock7l6ec8fnr2.js";import"./fue7kd61xxcv74sk.js";import"./ng0sx063g0r0whhb.js";import"./fvmxudg74tbhlabl.js";import"./hnotrmacgvnfyexv.js";import"./irqko7c1s7qpl41n.js";import"./bx2wdn43543b9ysc.js";import"./n5wrqpcxv1sjah44.js";import"./kkl7694f44ns8yp6.js";import"./mw2u7timj0qnsnvj.js";import"./dvqe6kc43fkjsavv.js";import"./nq5i976pifkrt40a.js";import"./fnnulb9pmlo3cgid.js";import"./bw8gyicptzfjwyk2.js";import"./ns51nblw8ziscsgd.js";import"./f3wj76d1ulqyss85.js";import"./b2bzebhpy3vjflr5.js";import"./moqemqor8gto0ynb.js";import"./kl7c6054usfnqmd4.js";import"./k97n0y6ba9c9h39c.js";import"./hhs3uwxj7uii5eg7.js";import"./zta1pq4ds1hak11y.js";import"./dl9z2ehd50icy9od.js";function dt(t,o){const s=t.doc.lineAt(o.from);return o.from===s.from&&o.to-1===s.to}function pt(t){const o=t.dom.querySelector(".cm-gutters");return o?o.offsetWidth:0}const ft=({onAddComment:t,isSendDisabled:o=!1,isWaitingForCommentResponse:s=!1})=>{const i=rt(),f=it(),e=nt(),L=S.useCallback(r=>{const{height:n,width:u}=r,m=i();if(!f||!m)return null;const c=f.selection.asSingle();if(c.ranges.length===0)return null;const a=c.ranges[0],{empty:H,to:O}=a;let{head:g}=a;const{platform:N}=lt();g=N==="web"?g:O;const C=g===O;let v=g;if(C&&dt(f,a)&&(v-=1),H)return null;const{left:h,top:x,bottom:_}=m.contentDOM.getBoundingClientRect(),{left:w,top:G,bottom:b}=at(m.coordsAtPos(v,C?-1:1)),E=pt(m);function A(){if(C)return Math.max(w-h+E-u,E);let d=w-h+E;return d+u>e&&(d=-(u-e)),d}function W(d){const T=n*2,V=d.contentHeight-(b-_)>T&&window.innerHeight-b>T,B=b-x+8,I=G-x-n-8;return C&&V||I<0?{top:B,aboveOrBelow:P.BELOW}:{top:I,aboveOrBelow:P.ABOVE}}const j=W(m);return{left:A(),top:j.top,aboveOrBelow:j.aboveOrBelow,toolbarSize:r}},[f,i,e]),D=S.useCallback(()=>{var r,n;return(n=(r=i())==null?void 0:r.dom)!=null?n:null},[i]);return l.jsx(Q,{onAddComment:t,isWaitingForCommentResponse:s,isSendDisabled:o,toolbarType:Y.CODE,getToolbarPosition:L,getEditorDom:D,getSelectionRange:()=>{const r=i();if(!r)return null;const{state:n}=r,u=n.selection.asSingle();if(u.ranges.length===0)return null;const m=u.ranges[0],{from:c,to:a}=m;return c==null||a==null?null:{from:c,to:a,sourceFrom:c,sourceTo:a}}})};function gt({diff:t}){var o;return Z((o=t==null?void 0:t.edits)!=null?o:[]),null}function Ct(t,o,s){const i=s?tt():0;return t<=1e3-i?t-(o?ot:0):t-(o?et:0)}const io=({comments:t,currentlyStreamingLineIndex:o,isPreview:s=!1,isWaitingForCommentResponse:i=!1,isSendDisabled:f=!1,readonlyReason:e,isRequestActive:L=!1,language:D,value:r,textdocDiff:n,maxLength:u,onAcceleratorsExpandedChange:m,onAddComment:c,onAcceptComment:a,onDismissComment:H,onBlur:O,onSave:g,onChange:N,onCancelRequest:C,getStableCommentId:v=ct,commentsMode:h=M.ENABLED,hideToolbar:x,hideAccelerators:_=!1,onSubmitAccelerator:w,modelCursor:G,codemirrorRef:b})=>{var F;const E=S.useRef(null),A=mt(),[{width:W},j]=ut(),d=S.useRef(null),T=t.length>0,V=d.current,B=Ct(W,T,(F=y(V))!=null?F:!1),I=U(({commentingOn:p})=>p),X=U(({hoveredCommentId:p})=>p),$=U(({focusedCommentId:p})=>p);S.useEffect(()=>{var p;(p=E.current)==null||p.UNSAFE_setValue(r||"")},[r]);const q=W-B;return l.jsx("div",{className:st.code,ref:R(j,d),style:A&&s?{margin:"0 16px"}:{},children:l.jsxs(k,{id:"codemirror",comments:h===M.ALL_HIDDEN?void 0:t,commentingOn:I,currentlyStreamingLineIndex:o,hoveredCommentId:X,focusedCommentId:$,language:D,readonlyReason:e,onChange:N,maxLength:u,value:r,textdocDiff:n,editorRef:R(E,b),width:B,modelCursor:G,isPreview:s,hideLineNumbers:A&&s,onBlur:O,onSave:g,children:[l.jsxs(k.EditorChildren,{children:[!x&&l.jsx(ft,{onAddComment:c,isSendDisabled:f,isWaitingForCommentResponse:i}),h!==M.ALL_HIDDEN&&l.jsx("div",{className:T?"me-4":"",children:l.jsx(z,{getStableCommentId:v,availableWidth:q,comments:t,commentsMode:h,onAddComment:c,onAcceptComment:a,onDismissComment:H,isWaitingForCommentResponse:i,isRequestActive:L,disableBlockComments:!0})})]}),l.jsxs(k.ContextChildren,{children:[n&&l.jsx(gt,{diff:n}),!_&&l.jsx(J,{isRequestActive:L,isVisuallyHidden:f||!!(e!=null&&e.isStreamingFromNative)||(e==null?void 0:e.isReadonly)&&!e.isStreaming,onSubmit:w,onCancel:C,actions:K,onExpandedChange:m})]})]})})};export{io as CodeComposer};
//# sourceMappingURL=c31yu42hzzizshvc.js.map
