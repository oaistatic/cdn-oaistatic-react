var E=Object.defineProperty,S=Object.defineProperties;var b=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var p=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var A=(e,s,t)=>s in e?E(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t,M=(e,s)=>{for(var t in s||(s={}))p.call(s,t)&&A(e,t,s[t]);if(y)for(var t of y(s))D.call(s,t)&&A(e,t,s[t]);return e},x=(e,s)=>S(e,b(s));var I=(e,s)=>{var t={};for(var a in e)p.call(e,a)&&s.indexOf(a)<0&&(t[a]=e[a]);if(e!=null&&y)for(var a of y(e))s.indexOf(a)<0&&D.call(e,a)&&(t[a]=e[a]);return t};import{r as u,j as g,R as j}from"./jj85rqzpbnvv3emr.js";import{eK as w,eL as U,eM as k,eN as v,eO as F,aO as L}from"./mclphevd122040jw.js";import{T as B}from"./hnotrmacgvnfyexv.js";import{hH as G,bP as O,bI as X,bJ as _,cj as q,oP as H}from"./lef5ym39glv4981l.js";function J(e){var T;const o=e,{bufferType:s,isActivelyStreaming:t,messages:a,parts:d}=o,n=I(o,["bufferType","isActivelyStreaming","messages","parts"]),i=a[a.length-1].id,[l,f]=u.useState(G(d)),r=u.useRef(void 0),c=u.useMemo(()=>d,[d,!1]);if(r.current===void 0)switch(s){case"Adaptive":r.current=new k(c,f,t);break;case"ChunkedCatchup":r.current=new U(c,f,t);break;case"Punctuation":r.current=new w(c,f,t);break}return u.useEffect(()=>{r.current!=null&&(r.current.onMessagePartsUpdated(c,t),r.current.isBuffering()&&v.addDelayedRenderingMessage(i))},[c,i,t]),u.useEffect(()=>{r.current!=null&&r.current.removeDelayedRender()&&v.removeDelayedRenderingMessage(i)},[l,i]),u.useEffect(()=>()=>v.removeDelayedRenderingMessage(i),[i]),u.useEffect(()=>()=>{var h;(h=r.current)==null||h.destroy(),r.current=void 0},[]),g.jsx(B,x(M({},n),{messages:a,parts:d,displayParts:l,isActivelyStreaming:t||!!((T=r.current)!=null&&T.isBuffering())}))}function K({message:e,isCompletionInProgress:s,hasActiveRequest:t,clientThreadId:a,className:d,isUserTurn:n,isFinalUserTurn:i,isWithinFirstAssistantTurns:l,turnIndex:f,isFeedbackEnabled:r,prevGroupedMessageType:m,prevGroupedMessages:c,citableMessages:o,superWidgetImages:T}){var P,C,R;const h=u.useMemo(()=>"parts"in e.content?e.content.parts:[O(e)],[e]);return g.jsxs(g.Fragment,{children:[g.jsx($,{parts:h,messages:[e],hasActiveRequest:t,isCompletionInProgress:s,className:d,citations:(P=e.metadata)==null?void 0:P.citations,contentReferences:(C=e.metadata)==null?void 0:C.content_references,attachments:(R=e.metadata)==null?void 0:R.attachments,isUserTurn:n,isFinalUserTurn:i,isWithinFirstAssistantTurns:l,turnIndex:f,id:e.id,isFeedbackEnabled:r,clientThreadId:a,prevGroupedMessageType:m,prevGroupedMessages:c,citableMessages:o,superWidgetImages:T}),!1]})}const Z=j.memo(K),N=()=>null;function $(e){const s=N()!=null,t=e.messages.length>1,a=X.isLastActorMessage(_(e.clientThreadId),e.messages[0].id),d=!!q(e.clientThreadId,o=>o==null?void 0:o.sharedConversationMetadata),n=t?void 0:F(e.messages[0],a,s,e.isCompletionInProgress||e.hasActiveRequest,d),i=(n==null?void 0:n.flagSeverity)!=="danger"&&e.isCompletionInProgress,l=!e.parts.some(o=>o!==""),{bufferType:f,wordFadeType:r}=L(),[m,c]=u.useState(()=>r!=="indexed"&&f!=="none"&&!e.isUserTurn&&(e.isCompletionInProgress||l&&!n));return n&&m&&c(!1),m?g.jsx(J,x(M({},e),{bufferType:f,isActivelyStreaming:i,errorState:n})):g.jsx(B,x(M({},e),{displayParts:H({isUserTurn:e.isUserTurn,parts:e.parts}),isActivelyStreaming:i,errorState:n}))}export{Z as T,$ as a};
//# sourceMappingURL=fvmxudg74tbhlabl.js.map
