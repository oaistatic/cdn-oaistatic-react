var Gt=Object.freeze,qt=Object.defineProperty,Ss=Object.defineProperties;var Es=Object.getOwnPropertyDescriptors;var Vt=Object.getOwnPropertySymbols;var Ts=Object.prototype.hasOwnProperty,As=Object.prototype.propertyIsEnumerable;var ye=(s,e)=>(e=Symbol[s])?e:Symbol.for("Symbol."+s),Is=s=>{throw TypeError(s)};var Ht=(s,e,n)=>e in s?qt(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n,X=(s,e)=>{for(var n in e||(e={}))Ts.call(e,n)&&Ht(s,n,e[n]);if(Vt)for(var n of Vt(e))As.call(e,n)&&Ht(s,n,e[n]);return s},oe=(s,e)=>Ss(s,Es(e));var de=(s,e)=>Gt(qt(s,"raw",{value:Gt(e||s.slice())}));var me=function(s,e){this[0]=s,this[1]=e},Fe=(s,e,n)=>{var a=(i,l,d,g)=>{try{var c=n[i](l),p=(l=c.value)instanceof me,h=c.done;Promise.resolve(p?l[0]:l).then(x=>p?a(i==="return"?i:"next",l[1]?{done:x.done,value:x.value}:x,d,g):d({value:x,done:h})).catch(x=>a("throw",x,d,g))}catch(x){g(x)}},o=i=>r[i]=l=>new Promise((d,g)=>a(i,l,d,g)),r={};return n=n.apply(s,e),r[ye("asyncIterator")]=()=>r,o("next"),o("throw"),o("return"),r},it=s=>{var e=s[ye("asyncIterator")],n=!1,a,o={};return e==null?(e=s[ye("iterator")](),a=r=>o[r]=i=>e[r](i)):(e=e.call(s),a=r=>o[r]=i=>{if(n){if(n=!1,r==="throw")throw i;return i}return n=!0,{done:!1,value:new me(new Promise(l=>{var d=e[r](i);d instanceof Object||Is("Object expected"),l(d)}),1)}}),o[ye("iterator")]=()=>o,a("next"),"throw"in e?a("throw"):o.throw=r=>{throw r},"return"in e&&a("return"),o},Oe=(s,e,n)=>(e=s[ye("asyncIterator")])?e.call(s):(s=s[ye("iterator")](),e={},n=(a,o)=>(o=s[a])&&(e[a]=r=>new Promise((i,l,d)=>(r=o.call(s,r),d=r.done,Promise.resolve(r.value).then(g=>i({value:g,done:d}),l)))),n("next"),n("return"),e);import{b as je,j as t,d as ht,r as M,M as O,v as Ls,c as le,f as Fs,A as Os,m as Jt,e as K,i as Bs}from"./jj85rqzpbnvv3emr.js";import{K as Ps,B as _e,F as Ne,fN as fs,fM as yt,e as fe,fv as mt,bI as ut,bJ as Qt,ax as $s,l2 as Rs,rZ as Us,cg as Ws,ch as zs,cR as Ds,mj as Gs,iK as Vs,aI as xs,bH as Hs,jI as gs,s_ as qs,s$ as Js,gw as Qs,t0 as Ys,bE as Xs,kk as Ks,cX as ft,fl as Zs,P as tt,$ as Re,a0 as Ue,R as en,fw as tn,eE as lt,C as sn,i as nn,aF as an,bG as Yt,cM as on,O as re,t1 as rn,l_ as ln,bi as Xt,dF as cn,dZ as dn,i7 as mn,fD as un,gc as fn,cj as xn,ck as gn,ot as Kt,hx as pn,hZ as hn,l0 as yn,bK as bn,cc as vn,er as kn,iG as _n,ft as jn,bM as Nn,s as wn}from"./lef5ym39glv4981l.js";import{gu as xt,bV as nt,me as Cn,a4 as Mn,vz as Sn,dn as ct,ds as En,gt as Tn,hP as An,vA as In,mT as ke,mh as Ln,bb as Fn,vB as On,iX as Bn,vC as Pn,sy as $n,vD as Rn,sz as Un,sA as Be,hx as ps,cq as Wn,iZ as zn,cl as be,bf as Dn,ck as Zt,vE as Gn,j6 as Vn,gO as Hn,jF as qn}from"./mclphevd122040jw.js";import{L as gt,i as Jn,C as es,a as Qn}from"./zta1pq4ds1hak11y.js";import{S as Yn}from"./beyyb659nwss2eea.js";import{M as ts,E as Xn}from"./ns51nblw8ziscsgd.js";import{g as bt,A as hs,h as ve,a as ys,b as bs,J as b,c as vs,i as ee,p as Kn,d as Zn,e as ea,f as ta,j as sa,k as na,l as aa,m as ss,C as oa}from"./bfo1h8l0zwcd8b61.js";var is;const ra=Ne.div(is||(is=de(["h-px bg-token-border-default"])));var ls;const ie=Ne.div(ls||(ls=de(["text-sm font-medium py-3 leading-6"])));var cs;const ia=Ne.div(cs||(cs=de(["my-4 p-5 w-full rounded-2xl popover bg-token-main-surface-primary shadow-lg border border-token-border-default"]))),dt=":",la=({to:s,cc:e,bcc:n,subject:a,body:o,onClick:r,isDraft:i=!0,isCanceled:l=!1})=>{const d=je(),g=[];return s&&g.push(t.jsx("div",{children:t.jsxs("div",{className:"flex",children:[t.jsxs(ie,{className:"text-token-text-tertiary me-1",children:[d.formatMessage(ue.draftToFieldLabel),dt]}),t.jsx(ie,{children:s})]})},"to")),e&&g.push(t.jsx("div",{children:t.jsxs("div",{className:"flex",children:[t.jsxs(ie,{className:"text-token-text-tertiary me-1",children:[d.formatMessage(ue.draftCcFieldLabel),dt]}),t.jsx(ie,{children:e})]})},"cc")),n&&g.push(t.jsx("div",{children:t.jsxs("div",{className:"flex",children:[t.jsxs(ie,{className:"text-token-text-tertiary me-1",children:[d.formatMessage(ue.draftBccFieldLabel),dt]}),t.jsx(ie,{children:n})]})},"bcc")),a&&g.push(t.jsx(ie,{children:a},"subject")),o&&g.push(t.jsx(ie,{className:"whitespace-pre-line",children:o},"body")),t.jsxs(ia,{children:[t.jsxs("div",{className:"mb-4 flex items-center",children:[t.jsx(Ps,{className:"icon-sm me-4"}),t.jsx("div",{className:"font-semibold",children:i?d.formatMessage(ue.draftMessageLabel):d.formatMessage(ue.sentMessageLabel)})]}),g.map((c,p)=>t.jsxs(M.Fragment,{children:[t.jsx(ra,{}),c]},p)),i&&!l&&t.jsx("div",{className:"mt-2 flex justify-end gap-4",children:t.jsx(_e,{color:"primary",className:"py-2",onClick:r,children:d.formatMessage(ue.sendButton)})}),l&&t.jsx("div",{className:"mt-2 flex justify-end gap-4",children:t.jsx(_e,{color:"primary",className:"py-2",disabled:!0,children:d.formatMessage(ue.canceledButton)})})]})},ue=ht({draftMessageLabel:{id:"emailView.draftMessageLabel",defaultMessage:"Draft Message"},sentMessageLabel:{id:"emailView.sentMessageLabel",defaultMessage:"Sent Message"},sendButton:{id:"emailView.sendButton",defaultMessage:"Send"},draftToFieldLabel:{id:"emailView.draftToLabel",defaultMessage:"To"},draftCcFieldLabel:{id:"emailView.draftCcLabel",defaultMessage:"Cc"},draftBccFieldLabel:{id:"emailView.draftBccLabel",defaultMessage:"Bcc"},canceledButton:{id:"emailView.canceledButton",defaultMessage:"Canceled"}});function ca({functionName:s,params:e,toolCallSafetySummary:n,result:a,isWrite:o}){var g,c;const r=fs(),i=yt(),{namespace:l,actionName:d}=da(s);if(l==="api_tool"&&d==="call_tool"&&e&&"path"in e&&"args"in e&&typeof e.path=="string"&&(typeof e.args=="object"||typeof e.args=="string")&&e.args!=null){const[p,h,x]=e.path.split("/").filter(Boolean);if(p&&h&&x){const m=[...r.connectorLinks.values()].flat().find(f=>f.id===h),u=m&&i.platformConnectors.get(m.connector_id);return t.jsx(ns,{connector:{name:(g=u==null?void 0:u.name)!=null?g:p,logo_url:(c=u==null?void 0:u.logo_url)!=null?c:null},actionName:x,isWrite:o,params:typeof e.args=="object"?e.args:JSON.parse(e.args),toolCallSafetySummary:n,result:a})}}return t.jsx(ns,{connector:{name:l,logo_url:null},actionName:d,isWrite:o,params:e,result:a,toolCallSafetySummary:n})}function da(s){const e=s.indexOf("."),n=e===-1?s:s.slice(0,e),a=e===-1?"":s.slice(e+1);return{namespace:n,actionName:a}}function ns({connector:s,actionName:e,params:n,result:a,isWrite:o,toolCallSafetySummary:r}){var x,m;const i=je(),[l,d]=M.useState(!1),g=M.useId(),c=(x=r==null?void 0:r.title)!=null?x:"",p=(m=r==null?void 0:r.description)!=null?m:"",h=p.trim().length>0;return r?t.jsx("div",{className:"border-token-border-subtle bg-token-bg-tertiary/50 mt-1 mb-4 w-full max-w-xl rounded-3xl border p-6 text-start shadow-sm",children:t.jsxs("div",{className:"flex flex-col gap-6",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex w-full items-center gap-4",children:[t.jsx(xt,{connector:{name:s.name,logo_url:s.logo_url,logo_url_dark:void 0},className:"shrink-0",size:"large"}),t.jsx("h2",{className:"text-token-text-primary text-xl font-semibold",children:c})]}),t.jsxs("div",{className:"mt-2 space-y-4",children:[h&&t.jsx("div",{className:"flex w-full items-center gap-4",children:t.jsx("p",{className:"text-token-text-tertiary mt-2 text-sm",children:p})}),r.data_shared.length>0&&t.jsx("div",{className:"bg-token-bg-secondary/50 border-token-border-subtle mt-2 rounded-lg border p-2",children:t.jsxs("p",{className:"text-token-text-secondary text-sm",children:[t.jsx("strong",{className:"text-token-text-secondary",children:i.formatMessage(Pe.dataShared)}),r.data_shared.join(", ")]})})]})]}),t.jsxs("div",{className:"flex w-full flex-col gap-4",children:[n!=null&&t.jsxs("div",{children:[t.jsxs("button",{type:"button",onClick:()=>d(u=>!u),"aria-expanded":l,"aria-controls":g,className:"border-token-border-subtle bg-token-bg-tertiary text-token-text-primary hover:bg-token-bg-tertiary/80 focus-visible:ring-token-border-strong flex w-full items-center justify-between rounded-full border px-3 py-2 text-sm font-medium transition focus-visible:ring-2 focus-visible:outline-none",children:[t.jsx("span",{className:"truncate",children:e}),t.jsxs("span",{className:"flex items-center gap-2",children:[o&&t.jsx("span",{className:"bg-token-bg-secondary text-token-text-secondary inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-semibold tracking-wide uppercase",children:t.jsx(O,{id:"APIToolCallCard.write",defaultMessage:"Write"})}),t.jsx(nt,{className:fe("icon-sm transition-transform",l&&"rotate-180")})]})]}),l&&t.jsx("div",{className:"mt-3",id:g,children:t.jsx($e,{isInitialLevelExpanded:o,name:Pe.request,params:n})}),l&&a!=null&&t.jsx("div",{className:"mt-3",children:t.jsx($e,{name:Pe.response,params:a})})]}),o&&t.jsxs("div",{className:"text-token-text-secondary flex items-start gap-2 text-xs leading-4",children:[t.jsx(mt,{className:"icon-sm mt-0.5 shrink-0"}),t.jsx(O,{id:"APIToolCallCard.writeWarning",defaultMessage:"Write actions come with risks. <link>Learn more</link>",values:{link:u=>t.jsx("a",{href:"https://platform.openai.com/docs/mcp#risks-and-safety",className:"underline underline-offset-2",target:"_blank",rel:"noopener noreferrer",children:u},"link")}})]})]})]})}):t.jsxs("div",{className:"bg-token-bg-default mt-1 mb-4 grid max-w-xl gap-4 rounded-xl p-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(xt,{connector:{name:s.name,logo_url:s.logo_url,logo_url_dark:void 0},size:"large"}),t.jsxs("div",{className:"flex flex-1 flex-col",children:[t.jsx("div",{className:"text-token-text-secondary text-xs",children:s.name}),t.jsx("div",{className:"text-token-text-primary text-sm",children:e})]}),o&&t.jsx("div",{className:"border-token-text-quartenary text-token-text-secondary dark:border-token-border-heavy dark:text-token-text-tertiary items-center rounded-full border px-1 py-0.5 text-[8px] leading-3 font-semibold uppercase",children:t.jsx(O,{id:"APIToolCallCard.write",defaultMessage:"Write"})})]}),n!=null&&t.jsx($e,{isInitialLevelExpanded:o,name:Pe.request,params:n}),a!=null&&t.jsx($e,{name:Pe.response,params:a}),o&&t.jsxs("div",{className:"text-token-text-secondary text-sm",children:[t.jsx(mt,{className:"icon-sm me-1 mb-0.5 inline-block"}),t.jsx(O,{id:"APIToolCallCard.writeWarning",defaultMessage:"Write actions come with risks. <link>Learn more</link>",values:{link:u=>t.jsx("a",{href:"https://platform.openai.com/docs/mcp#risks-and-safety",className:"underline underline-offset-2",target:"_blank",rel:"noopener noreferrer",children:u},"link")}})]})]})}function $e({name:s,afterName:e,params:n,isInitialLevelExpanded:a=!1}){const o=je();return t.jsxs("div",{className:"bg-token-bg-secondary/30 max-w-full min-w-0 space-y-3 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center justify-between gap-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"text-token-text-secondary text-xs",children:typeof s=="string"?s:o.formatMessage(s)}),e]}),t.jsx(Cn,{buttonText:!0,className:"text-token-text-secondary text-xs",onCopy:()=>Mn(typeof n=="string"?n:JSON.stringify(n))})]}),typeof n=="string"?t.jsx("div",{className:"text-token-text-primary line-clamp-3 font-mono text-sm",children:n}):t.jsx(gt,{isInitialLevelExpanded:a,value:n})]})}const Pe=ht({request:{id:"APIToolCallCard.request",defaultMessage:"Request"},response:{id:"APIToolCallCard.response",defaultMessage:"Response"},dataShared:{id:"APIToolCallCard.dataShared",defaultMessage:"Data Shared"}}),ma=({chatSDK:s,prompt:e,persistedSystemHintsStore:n,clientThreadId:a})=>{var i;const o=ut.getRequestId(Qt(a));if(Sn(o))return null;if(!e)return $s.addError("No prompt provided to sendFollowUpMessage"),null;const r=ut.getBranch(Qt(a)).findLast(({message:l})=>Rs(l));return{completionType:Ds.Next,promptMessage:{id:Ls(),author:{role:zs.User,name:"user"},content:{content_type:Ws.Text,parts:[e]},recipient:"all",metadata:{system_hints:Us(n),developer_mode_connector_ids:(i=r==null?void 0:r.message.metadata)==null?void 0:i.developer_mode_connector_ids,chatgpt_sdk_attribution:s.metadata.attribution_id,is_visually_hidden_from_conversation:!0}},eventSource:"mouse"}};function as(s){if(!s)return null;const e=s.trim();if(!e)return null;const n=e.includes("://")||/^[a-z][a-z0-9+.-]*:/.test(e),a=/:[0-9]+(\/|$)/.test(n?e.replace(/^[a-z][a-z0-9+.-]*:\/\//i,""):e);try{return{url:new URL(e),protocolExplicit:n,portExplicit:a}}catch(o){if(!n)try{const r=e.startsWith("//")?"https:".concat(e):"https://".concat(e);return{url:new URL(r),protocolExplicit:!1,portExplicit:a}}catch(r){return null}return null}}function os(s){return s.replace(/\.$/,"").toLowerCase()}function ua(s,e){const n=os(s),a=os(e);return n===a||n.endsWith("."+a)}function fa(s,e){var o;if(!s||!((o=e==null?void 0:e.connectDomains)!=null&&o.length))return!1;const n=as(s);if(!n)return!1;const a=n.url;return e.connectDomains.some(r=>{const i=as(r);if(!i)return!1;const{url:l,protocolExplicit:d}=i;return!(d&&l.protocol!==a.protocol||!ua(a.hostname,l.hostname))})}const xa=s=>{"use forget";const e=le.c(18),{logoUrl:n,name:a,isLoading:o,addGutter:r,after:i,hideDivider:l,onClick:d}=s,g=r===void 0?!1:r,c=d?"button":"div",p=!l&&"border-token-border-light border-t pt-3",h=g&&"px-4";let x;e[0]!==p||e[1]!==h?(x=fe("text-token-text-tertiary flex w-full items-center gap-2 pb-4 text-sm max-sm:mt-1",p,h),e[0]=p,e[1]=h,e[2]=x):x=e[2];let m;e[3]!==o||e[4]!==n||e[5]!==a?(m=!n||o?t.jsx("div",{className:"loading-results-shimmer h-4.5 w-4.5 rounded-md"}):n&&a&&t.jsx("img",{className:"h-4.5 w-4.5 rounded-md",src:n,alt:a}),e[3]=o,e[4]=n,e[5]=a,e[6]=m):m=e[6];let u;e[7]!==a?(u=a?t.jsx("span",{children:a}):t.jsx("div",{className:"loading-results-shimmer h-4 w-16 rounded-md"}),e[7]=a,e[8]=u):u=e[8];let f;e[9]!==i?(f=i&&t.jsx("div",{className:"ms-auto",onClick:ga,children:i}),e[9]=i,e[10]=f):f=e[10];let y;return e[11]!==c||e[12]!==d||e[13]!==x||e[14]!==m||e[15]!==u||e[16]!==f?(y=t.jsxs(c,{onClick:d,className:x,children:[m,u,f]}),e[11]=c,e[12]=d,e[13]=x,e[14]=m,e[15]=u,e[16]=f,e[17]=y):y=e[17],y};function ga(s){return s.stopPropagation()}const pa=({title:s,logoUrl:e})=>t.jsxs("div",{className:"bg-token-bg-primary dark:bg-token-bg-elevated-secondary border-token-border-default dark:border-token-border-light my-2 flex w-fit items-center gap-2 rounded-xl px-4 py-2 pe-6",children:[e?t.jsx("img",{className:"h-5 w-5 rounded-md",src:e,alt:s!=null?s:""}):t.jsx("div",{className:"loading-results-shimmer h-5 w-5 rounded-md"}),t.jsx("div",{className:"text-token-text-primary text-base font-medium",children:s})]}),ha=s=>{"use forget";const e=le.c(5),{onClickRetry:n}=s;let a,o;e[0]===Symbol.for("react.memo_cache_sentinel")?(a=t.jsx(Gs,{className:"icon"}),o=t.jsx(O,{id:"DTbTrQ",defaultMessage:"Error loading app"}),e[0]=a,e[1]=o):(a=e[0],o=e[1]);let r;e[2]===Symbol.for("react.memo_cache_sentinel")?(r=t.jsx(O,{id:"thEh3U",defaultMessage:"Retry"}),e[2]=r):r=e[2];let i;return e[3]!==n?(i=t.jsx(Vs,{type:"error",icon:a,title:o,content:null,primaryCtaText:r,primaryCtaColor:"secondary",onPrimaryCtaClick:n}),e[3]=n,e[4]=i):i=e[4],i},ya=s=>{"use forget";const e=le.c(34),{setDisplayMode:n,title:a,widgetDisplayName:o,widgetDomain:r,onClickBack:i,onClickForward:l,onClickOpenInApp:d,canGoBack:g,canGoForward:c,logo:p}=s,h=je();let x;e[0]!==h?(x=h.formatMessage({id:"H0F9KU",defaultMessage:"Close"}),e[0]=h,e[1]=x):x=e[1];let m;e[2]!==n?(m=()=>n("inline"),e[2]=n,e[3]=m):m=e[3];let u;e[4]===Symbol.for("react.memo_cache_sentinel")?(u=t.jsx(xs,{className:"icon"}),e[4]=u):u=e[4];let f;e[5]!==x||e[6]!==m?(f=t.jsx(ct,{label:x,className:"h-7! w-7!",onClick:m,icon:u}),e[5]=x,e[6]=m,e[7]=f):f=e[7];let y;e[8]!==g||e[9]!==c||e[10]!==h||e[11]!==i||e[12]!==l?(y=(g||c)&&t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(ct,{label:h.formatMessage({id:"y0H9Ps",defaultMessage:"Back"}),className:"h-7! w-7!",onClick:i,disabled:!g,icon:t.jsx(En,{className:"icon"})}),t.jsx(ct,{label:h.formatMessage({id:"4zGgS+",defaultMessage:"Forward"}),className:"h-7! w-7!",onClick:l,disabled:!c,icon:t.jsx(Yn,{className:"icon"})})]}),e[8]=g,e[9]=c,e[10]=h,e[11]=i,e[12]=l,e[13]=y):y=e[13];let N;e[14]!==f||e[15]!==y?(N=t.jsxs("div",{className:"flex items-center justify-start gap-3",children:[f,y]}),e[14]=f,e[15]=y,e[16]=N):N=e[16];let w;e[17]!==a?(w=t.jsx("div",{className:"text-token-text-secondary flex items-center justify-center text-base",children:a}),e[17]=a,e[18]=w):w=e[18];const L=p?void 0:Tn,B=!r;let A;e[19]!==p||e[20]!==o?(A=p&&t.jsx("img",{src:p,alt:o,className:"me-2 h-4 w-4"}),e[19]=p,e[20]=o,e[21]=A):A=e[21];let I;e[22]!==o?(I=t.jsx(O,{id:"JvQEOX",defaultMessage:"Open in {app}",values:{app:o}}),e[22]=o,e[23]=I):I=e[23];let T;e[24]!==d||e[25]!==A||e[26]!==I||e[27]!==L||e[28]!==B?(T=t.jsx("div",{className:"flex items-center justify-end",children:t.jsxs(_e,{icon:L,disabled:B,onClick:d,color:"secondary",children:[A,I]})}),e[24]=d,e[25]=A,e[26]=I,e[27]=L,e[28]=B,e[29]=T):T=e[29];let $;return e[30]!==T||e[31]!==N||e[32]!==w?($=t.jsxs("div",{className:"border-token-border-secondary bg-token-bg-primary z-10 grid h-(--header-height) grid-cols-[1fr_auto_1fr] border-b px-2",children:[N,w,T]}),e[30]=T,e[31]=N,e[32]=w,e[33]=$):$=e[33],$};function ks(s){var e,n,a;return((a=(n=(e=s.modelPreferences)==null?void 0:e.hints)==null?void 0:n[0])==null?void 0:a.name)||"unknown-model"}function _s(s,e,n){var i;const a=window.location.origin+"/backend-api/ecosystem/completion",o=new AbortController,r=An(a,{ctx:Hs(),method:"POST",body:{method:"sampling/createMessage",params:{messages:s.messages,modelPreferences:s.modelPreferences,systemPrompt:s.systemPrompt,metadata:oe(X({},(i=s.metadata)!=null?i:{}),{app_uri:e})}},signal:o.signal,accessToken:n});return{stream:ba(In(r)),controller:o}}function ba(s){return Fe(this,null,function*(){try{for(var e=Oe(s),n,a,o;n=!(a=yield new me(e.next())).done;n=!1){const r=a.value;r&&typeof r=="object"&&"data"in r&&r.data&&typeof r.data=="object"&&"content"in r.data&&(yield r.data.content)}}catch(a){o=[a]}finally{try{n&&(a=e.return)&&(yield new me(a.call(e)))}finally{if(o)throw o[0]}}})}function va(s,e,n){return Fe(this,null,function*(){const a=ks(s),{stream:o,controller:r}=_s(s,e,n);try{try{for(var i=Oe(o),l,d,g;l=!(d=yield new me(i.next())).done;l=!1){const c=d.value;c.type==="text"&&(yield{content:{type:"text",text:c.text},model:a,role:"assistant"})}}catch(d){g=[d]}finally{try{l&&(d=i.return)&&(yield new me(d.call(i)))}finally{if(g)throw g[0]}}}finally{try{r.abort("Widget canceled reading completion stream")}catch(c){}}})}async function ka(s,e,n){const a=ks(s),{stream:o,controller:r}=_s(s,e,n);try{let c="";try{for(var i=Oe(o),l,d,g;l=!(d=await i.next()).done;l=!1){const p=d.value;p.type==="text"&&(c=p.text)}}catch(d){g=[d]}finally{try{l&&(d=i.return)&&await d.call(i)}finally{if(g)throw g[0]}}return{content:{type:"text",text:c},model:a,role:"assistant"}}finally{try{r.abort("Widget canceled reading completion call stream")}catch(c){}}}const _a=()=>{let s="unknown";return gs()?s="mobile":qs()?s="tablet":Js()&&(s="desktop"),{device:{type:s},capabilities:{hover:Ys(),touch:Qs()}}},ja=(s,e)=>"?"+["","app=".concat(s),"locale=".concat(e)].filter(Boolean).join("&"),Na=s=>{if(s){const e=new URL(es);return e.hostname="".concat(s,".").concat(e.hostname),e.protocol=Qn,e.origin}return es},wa=({host:s="chatgpt",isInert:e=!1,title:n,ref:a,subdomain:o,iframeRef:r,api:i,locale:l})=>{"use forget";const[d]=M.useState(()=>Xs(null)),g=ke(async(x,...m)=>{var f;return await Ks(()=>!!d()),ft((f=d())==null?void 0:f[x],"Method ".concat(String(x)," not found"))(...m)});M.useImperativeHandle(a,()=>new Proxy({},{get:(x,m)=>(...u)=>g(m,...u)}),[g]);const c=ke((x,...m)=>{const u=i[x];if(!u){console.warn("HostAPI method not found",x);return}return u(...m)}),p=ke(x=>x?(Jn(x,{drawBoundingBoxes:(...m)=>c("drawBoundingBoxes",...m),notifyBackgroundColor:(...m)=>c("notifyBackgroundColor",...m),notifyIntrinsicHeight:(...m)=>c("notifyIntrinsicHeight",...m),sendInstrument:(...m)=>c("sendInstrument",...m),getDownloadURL:(...m)=>c("getDownloadURL",...m),callTool:(...m)=>c("callTool",...m),streamCompletion:function(...u){return Fe(this,null,function*(){yield*it(c("streamCompletion",...u))})},callCompletion:(...m)=>c("callCompletion",...m),notifySecurityPolicyViolation:(...m)=>c("notifySecurityPolicyViolation",...m),notifyEnvironmentError:(...m)=>c("notifyEnvironmentError",...m),updateWidgetState:(...m)=>c("updateWidgetState",...m),sendFollowUpMessage:(...m)=>c("sendFollowUpMessage",...m),requestDisplayMode:(...m)=>c("requestDisplayMode",...m),notifyNavigation:(...m)=>c("notifyNavigation",...m),openExternal:(...m)=>c("openExternal",...m)},["runUserCode","runWidgetCode"]).then(m=>{d.set(m)}),()=>{d.set(null)}):d.set(null)),h=Na(o);return t.jsx(Zs,{children:t.jsx("iframe",{title:n,inert:e,src:"".concat(h,"/index.html").concat(ja(s,l)),ref:Ln(p,r),sandbox:"allow-scripts allow-same-origin allow-forms",className:"h-full w-full max-w-full"},"sandbox-".concat(h))})},vt=s=>{var e;return[{key:"attribution_id",value:s.attribution_id},{key:"name",value:(e=s.name)!=null?e:"unknown"}]},Ca=(s,e)=>{var a;const n=vt(e);switch("tags"in s&&n.push(...(a=s.tags)!=null?a:[]),s.type){case"interaction":tt.logEvent("Ecosystem app: Interaction",oe(X({},e),{event_type:s.label})),Re.count(Ue.ECOSYSTEM,"app.click",n);break;case"count":Re.count(Ue.ECOSYSTEM,s.label,n,s.count);break;case"error":tt.logEvent("Ecosystem app: Error",e),Re.count(Ue.ECOSYSTEM,"app.error",n);break}},Ma=s=>{tt.logEvent("Ecosystem app: Link out",s),Re.count(Ue.ECOSYSTEM,"app.link_out",vt(s))},Sa=s=>{tt.logEvent("Ecosystem app: Error",oe(X({},s),{was_fatal_error:!0})),Re.count(Ue.ECOSYSTEM,"app.fatal_error",vt(s))},Ea={insets:{top:0,bottom:0,left:0,right:0}},Ta=({host:s,ref:e,iframeRef:n,html:a,accessToken:o,safeArea:r=Ea,attributionId:i,widgetId:l,widgetParent:d,widgetType:g,csp:c,subdomain:p,widgetState:h=null,toolInput:x=null,toolOutput:m=null,toolResponseMetadata:u=null,maxHeight:f,theme:y,title:N,api:w,locale:L,displayMode:B="inline",onReady:A,onError:I})=>{"use forget";var V;const T=M.useRef(null),$=ke(()=>{I==null||I()}),R=ke(()=>{A==null||A()}),G=ke(async k=>{var D;const F=(D=T.current)==null?void 0:D.runWidgetCode({html:k,widgetId:l,widgetState:h,toolInput:x,toolOutput:m,toolResponseMetadata:u,maxHeight:f,theme:y,displayMode:B,safeArea:r,userAgent:_a(),csp:c});if(F)try{for(var W=Oe(await F),U,J,H;U=!(J=await W.next()).done;U=!1){const P=J.value;P.type===ts.ENVIRONMENT_STATUS&&P.status===Xn.RUNNING_CODE?R():P.type===ts.RUN_COMPLETE&&P.wasFatalError&&(Sa(C),$())}}catch(J){H=[J]}finally{try{U&&(J=W.return)&&await J.call(W)}finally{if(H)throw H[0]}}});M.useEffect(()=>{a&&G(a)},[a,G]),M.useEffect(()=>{var k;(k=T.current)==null||k.setWidgetProps({widgetId:l,widgetState:h,toolInput:x,toolOutput:m,toolResponseMetadata:u})},[l,h,x,m,u]),M.useEffect(()=>{var k;(k=T.current)==null||k.setAdditionalGlobals({additionalGlobals:{maxHeight:f}})},[f]),M.useEffect(()=>{var k;(k=T.current)==null||k.setAdditionalGlobals({additionalGlobals:{displayMode:B}})},[B]),M.useEffect(()=>{var k;(k=T.current)==null||k.setTheme({theme:y})},[y]),M.useEffect(()=>{var k;(k=T.current)==null||k.setSafeArea({safeArea:r})},[r]);const C={attribution_id:(V=i!=null?i:d)!=null?V:"",name:g};return t.jsx(wa,{title:N,host:s,subdomain:p,api:oe(X({},w),{openExternal:k=>{var F;Ma(C),(F=w.openExternal)==null||F.call(w,k)},sendInstrument:k=>{Ca(k,C)},streamCompletion:function(k){return Fe(this,null,function*(){yield*it(va(k,ft(d),o))})},callCompletion:async function(k){return await ka(k,ft(d),o)}}),iframeRef:n,ref:Fn(T,e),locale:L})},Aa=s=>{var e,n;return s?{isTrusted:!0,connectDomains:(e=s.connect_domains)!=null?e:[],resourceDomains:(n=s.resource_domains)!=null?n:[]}:null},Ia=s=>{if(!s)return null;try{return new URL(s).hostname.replaceAll(".","-")}catch(e){return null}},La=(s,e)=>{var o,r,i,l,d,g,c,p,h;const n=(r=(o=e==null?void 0:e.domain)!=null?o:s.metadata.widget_domain)!=null?r:null,a=Ia(n);return{domain:n,subdomain:a,name:(i=e==null?void 0:e.name)!=null?i:null,html:(d=(l=e==null?void 0:e.html)!=null?l:s.metadata.rendered_template)!=null?d:null,logoUrl:(g=e==null?void 0:e.logo_url)!=null?g:null,csp:Aa((c=e==null?void 0:e.csp)!=null?c:null),prefersBorder:(h=(p=e==null?void 0:e.prefers_border)!=null?p:s.metadata.prefers_border)!=null?h:!1}},Fa=s=>{"use forget";const e=le.c(18),{path:n}=s,{html_asset_pointer:a,resolved_pineapple_uri:o}=s.metadata;let r;e[0]!==a?(r=["htmlAsset",a],e[0]=a,e[1]=r):r=e[1];let i;e[2]!==a||e[3]!==n||e[4]!==o?(i=()=>en.safeGet("/ecosystem/widget",{parameters:{query:{uri:o!=null?o:"",html_asset_pointer:a!=null?a:"",template_pointer:a!=null?a:"",resource_path:n!=null?n:"",pineapple_uri:o!=null?o:""}}}),e[2]=a,e[3]=n,e[4]=o,e[5]=i):i=e[5];const l=!!a&&!!n&&!!o;let d;e[6]!==r||e[7]!==i||e[8]!==l?(d={queryKey:r,queryFn:i,enabled:l},e[6]=r,e[7]=i,e[8]=l,e[9]=d):d=e[9];const{isLoading:g,isError:c,data:p,refetch:h}=Fs(d),x=p!=null?p:null;let m;e[10]!==s||e[11]!==x?(m=La(s,x),e[10]=s,e[11]=x,e[12]=m):m=e[12];let u;return e[13]!==c||e[14]!==g||e[15]!==h||e[16]!==m?(u=X({refetch:h,isLoading:g,isError:c},m),e[13]=c,e[14]=g,e[15]=h,e[16]=m,e[17]=u):u=e[17],u},Oa=s=>{"use forget";var g;const e=le.c(7),{clientThreadId:n,messages:a,isLastMessageInTurn:o,rememberForThisConversation:r,onRequestCompletion:i}=s;let l,d;if(e[0]!==n||e[1]!==o||e[2]!==a||e[3]!==i||e[4]!==r){d=Symbol.for("react.early_return_sentinel");e:{const{jitPluginData:c}=bt(a,o);if(!(c!=null&&c.from_server)||((g=c.from_server)==null?void 0:g.type)==="denied_by_user"){d=null;break e}const{from_server:p}=c,{body:h}=p,{domain:x,actions:m}=h;l=m.map((u,f)=>t.jsx(hs,{clientThreadId:n,messages:a,onRequestCompletion:i,action:u,domain:x,handleUserAction:ve,rememberAnswer:r},f))}e[0]=n,e[1]=o,e[2]=a,e[3]=i,e[4]=r,e[5]=l,e[6]=d}else l=e[5],d=e[6];return d!==Symbol.for("react.early_return_sentinel")?d:l};function Ba(s){"use forget";var T,$;const e=le.c(55),{messages:n,isLastMessageInTurn:a,clientThreadId:o,onRequestCompletion:r}=s,[i,l]=M.useState(!1);let d;e[0]===Symbol.for("react.memo_cache_sentinel")?(d=t.jsx(O,{id:"WidgetOverlay.alwaysAsk",defaultMessage:"Always ask"}),e[0]=d):d=e[0];const g=d;let c;e[1]===Symbol.for("react.memo_cache_sentinel")?(c=t.jsx(O,{id:"WidgetOverlay.allowThisConversation",defaultMessage:"Allow for this conversation"}),e[1]=c):c=e[1];const p=c,h=fs(),x=yt();let m;e[2]!==a||e[3]!==n?(m=bt(n,a),e[2]=a,e[3]=n,e[4]=m):m=e[4];const{uiState:u}=m;let f;e[5]!==a||e[6]!==n?(f=ys(n,a),e[5]=a,e[6]=n,e[7]=f):f=e[7];const y=f;let N,w,L,B;if(e[8]!==o||e[9]!==x||e[10]!==a||e[11]!==h.connectorLinks||e[12]!==n||e[13]!==y||e[14]!==r||e[15]!==i||e[16]!==u){const R=bs(n,a),[G,C,V]=(T=R==null?void 0:R.path.split("/").filter(Boolean))!=null?T:[];let k;if(e[21]!==x||e[22]!==C||e[23]!==h.connectorLinks){let q;e[25]!==C?(q=te=>te.id===C,e[25]=C,e[26]=q):q=e[26];const z=[...h.connectorLinks.values()].flat().find(q);k=z&&x.platformConnectors.get(z.connector_id),e[21]=x,e[22]=C,e[23]=h.connectorLinks,e[24]=k}else k=e[24];const F=k;N=u===b.UserConfirmation,w="bg-token-bg-primary text-token-text-primary shadow-long pointer-events-auto grid w-[min(90%,40rem)] max-w-[min(100%,600px)] gap-4 rounded-2xl p-4 sm:rounded-3xl";const D=($=F==null?void 0:F.logo_url)!=null?$:null;let W;e[27]!==G||e[28]!==D?(W=t.jsx(xt,{connector:{name:G,logo_url:D},size:"medium",className:"bg-primary shadow-xxs max-h-fit rounded-2xl border bg-clip-padding p-2"}),e[27]=G,e[28]=D,e[29]=W):W=e[29];let U;e[30]!==G?(U=t.jsx("div",{className:"text-token-text-primary ms-3 font-medium",children:t.jsx(O,{id:"VHhzt6",defaultMessage:"{connectorName} wants to perform an action",values:{connectorName:G}})}),e[30]=G,e[31]=U):U=e[31];let J;e[32]!==y||e[33]!==i?(J=y?t.jsx("div",{className:"-mt-0.5 flex justify-start text-sm",children:t.jsx(tn,{size:"small",triggerButton:t.jsxs("button",{className:"bg-token-bg-primary hover:bg-token-bg-tertiary text-token-text-primary inline-flex items-center gap-1 rounded-lg px-2 py-1 ps-3 transition-colors",children:[i?p:g,t.jsx(nt,{strokeWidth:1,className:"icon-sm opacity-30","aria-hidden":!0})]}),children:t.jsxs(lt.RadioGroup,{value:i?"allow":"ask",onValueChange:q=>l(q==="allow"),children:[t.jsx(lt.RadioItem,{value:"ask",children:g}),t.jsx(lt.RadioItem,{value:"allow",children:p})]})})}):null,e[32]=y,e[33]=i,e[34]=J):J=e[34];let H;e[35]!==U||e[36]!==J?(H=t.jsxs("div",{className:"flex flex-1 flex-col",children:[U,J]}),e[35]=U,e[36]=J,e[37]=H):H=e[37];let P;e[38]!==o||e[39]!==a||e[40]!==n||e[41]!==r||e[42]!==i?(P=t.jsx("div",{className:"flex items-center justify-center gap-2",children:t.jsx(Oa,{clientThreadId:o,messages:n,isLastMessageInTurn:a,rememberForThisConversation:i,onRequestCompletion:r})}),e[38]=o,e[39]=a,e[40]=n,e[41]=r,e[42]=i,e[43]=P):P=e[43],e[44]!==W||e[45]!==H||e[46]!==P?(L=t.jsxs("div",{className:"flex items-center gap-1",children:[W,H,P]}),e[44]=W,e[45]=H,e[46]=P,e[47]=L):L=e[47],B=R!=null&&t.jsx($e,{name:V,afterName:N&&t.jsx("div",{className:"border-token-text-quartenary text-token-text-secondary dark:border-token-border-heavy dark:text-token-text-tertiary items-center rounded-full border px-1 py-0.5 text-[8px] leading-3 font-semibold uppercase",children:t.jsx(O,{id:"APIToolCallCard.write",defaultMessage:"Write"})}),params:typeof R.args=="object"?R.args:JSON.parse(R.args)}),e[8]=o,e[9]=x,e[10]=a,e[11]=h.connectorLinks,e[12]=n,e[13]=y,e[14]=r,e[15]=i,e[16]=u,e[17]=N,e[18]=w,e[19]=L,e[20]=B}else N=e[17],w=e[18],L=e[19],B=e[20];let A;e[48]!==N?(A=N&&t.jsxs("div",{className:"text-token-text-secondary text-xs",children:[t.jsx(mt,{className:"icon-sm me-2 mb-0.5 inline-block"}),t.jsx(O,{id:"APIToolCallCard.writeWarning",defaultMessage:"Write actions come with risks. <link>Learn more</link>",values:{link:Pa}})]}),e[48]=N,e[49]=A):A=e[49];let I;return e[50]!==w||e[51]!==L||e[52]!==B||e[53]!==A?(I=t.jsxs("div",{className:w,children:[L,B,A]}),e[50]=w,e[51]=L,e[52]=B,e[53]=A,e[54]=I):I=e[54],I}function Pa(s){return t.jsx("a",{href:"https://platform.openai.com/docs/mcp#risks-and-safety",className:"underline underline-offset-2",target:"_blank",rel:"noopener noreferrer",children:s},"link")}function $a(s){"use forget";const e=le.c(31),{onClose:n,url:a,name:o}=s;let r="",i=a,l="";try{let f;e[0]!==a?(i=new URL(a).hostname,f=a.indexOf(i),e[0]=a,e[1]=f,e[2]=i):(f=e[1],i=e[2]);const y=f;if(y!==-1){let N;e[3]!==y||e[4]!==a?(N=a.substring(0,y),e[3]=y,e[4]=a,e[5]=N):N=e[5],r=N;let w;e[6]!==i||e[7]!==y||e[8]!==a?(w=a.substring(y+i.length),e[6]=i,e[7]=y,e[8]=a,e[9]=w):w=e[9],l=w}}catch(f){}let d;e[10]!==o?(d=t.jsx("div",{className:"flex items-center gap-2",children:o?t.jsx(O,{id:"+13Bz2",defaultMessage:"Open in {name}",values:{name:o}}):t.jsx(O,{id:"dQkhva",defaultMessage:"Open external link"})}),e[10]=o,e[11]=d):d=e[11];let g;e[12]===Symbol.for("react.memo_cache_sentinel")?(g=t.jsx(O,{id:"XSj3EP",defaultMessage:"Open link"}),e[12]=g):g=e[12];let c;e[13]!==n||e[14]!==a?(c=t.jsx(_e,{color:"primary",onClick:n,as:"link",openNewTab:!0,rel:"noopener noreferrer",to:a,children:g}),e[13]=n,e[14]=a,e[15]=c):c=e[15];let p;e[16]!==r?(p=t.jsx("span",{className:"text-token-text-secondary",children:r}),e[16]=r,e[17]=p):p=e[17];let h;e[18]!==i?(h=t.jsx("span",{className:"text-token-text-primary font-medium",children:i}),e[18]=i,e[19]=h):h=e[19];let x;e[20]!==l?(x=t.jsx("span",{className:"text-token-text-secondary",children:l}),e[20]=l,e[21]=x):x=e[21];let m;e[22]!==p||e[23]!==h||e[24]!==x?(m=t.jsxs("div",{className:"mb-2 text-sm break-all",children:[p,h,x]}),e[22]=p,e[23]=h,e[24]=x,e[25]=m):m=e[25];let u;return e[26]!==n||e[27]!==d||e[28]!==c||e[29]!==m?(u=t.jsx(sn,{testId:"modal-safe-link-warning",isOpen:!0,hideSeparator:!0,onClose:n,showCloseButton:!0,type:"warning",title:d,primaryButton:c,children:m}),e[26]=n,e[27]=d,e[28]=c,e[29]=m,e[30]=u):u=e[30],u}const Ra=({chatSDK:s,clientThreadId:e,onRequestCompletion:n,isLastMessageInTurn:a})=>{"use forget";var Te,Ae;const o=nn(),{locale:r}=an(o),i=Yt(o,e),l=Bn(i),d=Pn(),[g,c]=M.useState(null),{refetch:p,isLoading:h,isError:x,html:m,domain:u,subdomain:f,name:y,logoUrl:N,csp:w,prefersBorder:L}=Fa(s),{widgetParent:B,widgetType:A,metadata:I}=s,[T,$]=M.useState(null),R=M.useRef(null),G=M.useRef(null),C=on.useStore(),V=_=>{const S=ma(oe(X({},_),{chatSDK:s,persistedSystemHintsStore:C,clientThreadId:e}));S!=null&&n(S)},k=re(()=>l.title$()),F=re(()=>l.isPinned$(s)),D=re(()=>l.isPinOrigin$(s)),W=re(()=>l.isPinOrigin$(s)?l.displayMode$():"inline"),U=W==="fullscreen",J=W==="pip",H=re(()=>l.maxWidgetHeight$()),P=re(()=>l.transitioningId$()===s.widgetId),q=(_,S)=>_===W?{mode:_}:(_==="fullscreen"&&(cn.setSidebarOpen(!1),C.setActiveSystemHint(null,{locked:!1})),D?l.transitioningId$.set(Me):l.transitioningId$.set(s.widgetId),_!=="inline"&&l.subscribeToNewMessages$(s,c),Un({forceFlushSync:!0,className:_==="inline"?[Be["pinned-widget"],Be["becoming-inline"]]:W==="inline"?[Be["pinned-widget"],Be["becoming-pinned"]]:Be["pinned-widget"],update:()=>{var Ie,Le;(Ie=G.current)==null||Ie.focus(),_==="inline"?(Le=R.current)==null||Le.navigate({popToRoot:!0}):l.setPinnedWidgetHeight(T!=null?T:0),c(null),l.setDisplayMode$(s,_,S)}}).finished.then(()=>{l.transitioningId$.set(null)}),{mode:_}),z=re(()=>l.getLatestChatSDK$(s)),te=g!=null?g:s,{toolInput:at,toolOutput:se,widgetState:ce,toolResponseMetadata:we}=M.useMemo(()=>l.getWidgetStateAndProps(te),[l,te]),Ce=z.messages,Me=te.widgetId,We=(Te=I==null?void 0:I.attribution_id)!=null?Te:B,[ze,ne]=M.useState(0),[ot,xe]=M.useState(!1),[De,Ge]=M.useState(!1),[Ve,rt]=M.useState(!1),[ge,Z]=M.useState(!1),pe=rn(),He=()=>{p(),xe(!1),Ge(!1),ne(ze+1)},qe=()=>{xe(!0),q("inline")},{height$:Je,marginBottom$:Qe}=$n(Yt(o,e)),Se=re(()=>{var _,S;return U&&D?((_=Je())!=null?_:0)+((S=Qe())!=null?S:0):0}),Ye=M.useMemo(()=>({insets:{top:0,bottom:Se,left:0,right:0}}),[Se]);if(d)return t.jsx(pa,{title:y,logoUrl:N});if(F&&!D&&!P)return null;const Xe=U?void 0:T?"".concat(Math.min(T,H!=null?H:1/0),"px"):"auto",he=vs(Ce,a||D)&&t.jsx(Ba,{messages:Ce,isLastMessageInTurn:a||D,clientThreadId:e,onRequestCompletion:n}),Ee=h||!De,Ke=t.jsxs("div",{className:fe("no-scrollbar",P&&"[view-transition-name:pinned-kanzi-widget]",!D&&"relative mb-2",W==="inline"&&fe("thread-sm:w-full",!F&&"mx-0 max-sm:-mx-(--thread-content-margin) max-sm:w-[100cqw] max-sm:overflow-hidden",L&&!F&&!U&&"max-sm:overflow-visible max-sm:px-4"),J&&"thread-xl:top-4 fixed start-4 end-4 top-4 z-50 mx-auto max-w-(--thread-content-max-width) sm:start-0 sm:end-0 sm:top-(--header-height) sm:w-full",U?"fixed start-0 end-0 top-0 bottom-0 z-50 mx-auto flex w-auto flex-col overflow-hidden":"overflow-visible"),style:{maxHeight:H},children:[F&&!U&&t.jsx("button",{className:"absolute -start-2 -top-1.5 z-10 rounded-full bg-[#3a3a3a] p-1.25 text-white shadow-[0px_0px_0px_1px_var(--border-heavy),0px_4px_12px_rgba(0,0,0,0.12)] hover:bg-[#6a6a6a] md:-start-6",onClick:()=>q("inline"),children:t.jsx(xs,{className:"h-4.5 w-4.5"})}),U&&t.jsx(ya,{setDisplayMode:q,logo:N,onClickBack:()=>{var _;return(_=R.current)==null?void 0:_.navigate({delta:-1})},onClickForward:()=>{var _;return(_=R.current)==null?void 0:_.navigate({delta:1})},canGoBack:Ve,canGoForward:ge,title:(Ae=k!=null?k:y)!=null?Ae:"",widgetDisplayName:y!=null?y:"",widgetDomain:u!=null?u:null,onClickOpenInApp:()=>{var _;(_=R.current)==null||_.getCurrentPath().then(S=>{S==null||!u||window.open(new URL(S.replace(/^\/+/,""),u),"_blank")})}}),t.jsxs("div",{className:fe("relative overflow-hidden",U?"flex-1":"h-full",!F&&L&&"border-token-border-light shadow-short rounded-2xl sm:rounded-3xl",!U&&(L||J)&&"rounded-2xl sm:rounded-3xl",J&&"shadow-[0px_0px_0px_1px_var(--border-heavy),0px_6px_20px_rgba(0,0,0,0.1)] md:-mx-4"),style:{height:Ee?406:Xe},children:[t.jsx(Os,{initial:!1,children:Ee&&t.jsx(Jt.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},className:"loading-results-shimmer absolute inset-0 sm:rounded-3xl"},"loading-results-shimmer")}),t.jsx(Ta,{iframeRef:G,ref:R,host:"chatgpt",title:A,locale:r,html:m,csp:w,subdomain:f,attributionId:We,widgetId:Me,widgetType:A,widgetParent:B,widgetState:ce,toolInput:at,toolOutput:se,toolResponseMetadata:we,maxHeight:H,theme:pe!=null?pe:"light",displayMode:W!=null?W:"inline",safeArea:Ye,onReady:()=>Ge(!0),onError:qe,api:{openExternal(_){const S=_.href;if(S){if(fa(S,w)){gs()||ln()?Xt(o,$a,{url:S,name:y}):window.open(S,"_blank","noopener,noreferrer");return}Xt(o,Rn,{urls:S})}},notifyNavigation:({canGoBack:_,canGoForward:S})=>{rt(_),Z(S)},notifyIntrinsicHeight:$,sendFollowUpMessage:V,updateWidgetState:(_,S)=>l.setWidgetState$(_,S),requestDisplayMode:({mode:_,title:S})=>q(_,S),callTool:(_,S)=>l.callTool$(B,_,S)}},ze),!!he&&t.jsx("div",{className:"bg-token-bg-secondary/50 pointer-events-auto absolute inset-0 z-0 flex items-center justify-center rounded-none sm:rounded-3xl"})]}),De&&he&&t.jsx(Jt.div,{className:fe("pointer-events-none absolute inset-0 z-10 flex justify-center",U?"top-(--header-height) items-center":"items-start pt-10"),initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{type:"spring",bounce:.1,duration:.24},children:he})]}),Ze=x||ot;return t.jsxs(t.Fragment,{children:[U&&t.jsx("div",{className:"bg-token-bg-primary fixed start-0 end-0 top-0 bottom-0 z-10"}),!F&&!x&&t.jsx("div",{className:"mt-2 sm:mt-4",children:t.jsx(xa,{onClick:u?()=>window.open(u,"_blank","noopener,noreferrer"):void 0,after:!1,hideDivider:L,isLoading:h,logoUrl:N,name:y})}),Ze?t.jsx("div",{className:fe(x&&"mt-2"),children:t.jsx(ha,{onClickRetry:He})}):Ke]})},Ua=s=>{"use forget";const e=le.c(7),{messages:n,clientThreadId:a,onRequestCompletion:o,isLastMessageInTurn:r}=s;let i;e[0]!==n?(i=On(n),e[0]=n,e[1]=i):i=e[1];const l=i;if(l.isError)return null;let d;return e[2]!==l||e[3]!==a||e[4]!==r||e[5]!==o?(d=t.jsx(Ra,{clientThreadId:a,onRequestCompletion:o,isLastMessageInTurn:r,chatSDK:l}),e[2]=l,e[3]=a,e[4]=r,e[5]=o,e[6]=d):d=e[6],d};function Wa({messageMetadata:s}){const[e,n]=M.useState(!1);return t.jsxs("div",{className:"my-2 flex flex-col text-sm",children:[t.jsxs("div",{className:"flex flex-row items-center hover:cursor-pointer",onClick:()=>{n(!e)},children:[e?t.jsx(nt,{className:"icon-sm"}):t.jsx(dn,{className:"icon-sm"}),t.jsx("div",{className:"font-semibold",children:s.display_message})]}),e&&t.jsx("pre",{children:JSON.stringify(s.data,null,2)})]})}function za({debugMessages:s}){return s.length===0?null:t.jsx("div",{children:s.map((e,n)=>{var o,r;const a=(r=(o=e.metadata)==null?void 0:o.jit_plugin_data)==null?void 0:r.from_server;return a&&a.type==="debug"?t.jsx(Wa,{messageMetadata:a.body},n):null})})}const js="openaiFileIdRefs",Da=["send_email","batch_modify_email","create_event","update_event","delete_event"];function Ga({name:s,params:e,result:n,privacyPolicyUrl:a,isPromptingForPermission:o}){var l;const i=((l=e==null?void 0:e[js])!=null?l:[]).map((d,g)=>{const c=d.name.startsWith("dalle-");let p=d.name;return c&&(p="".concat(p,".webp")),t.jsx(ps,{file:p,fileId:d.id},g)});return t.jsxs("div",{className:"divide-token-border-default border-token-border-default mt-1 mb-4 divide-y overflow-hidden rounded-xl border",children:[s&&t.jsx("div",{className:"bg-token-bg-tertiary text-token-text-secondary px-4 py-2 text-sm",children:t.jsx(O,{id:"JITPluginMessage.params.toolCall",defaultMessage:"Tool call: {name}",values:{name:t.jsx("span",{className:"text-token-text-primary",children:s})}})}),e&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"bg-token-bg-tertiary text-token-text-secondary flex justify-between px-4 py-2 text-sm",children:[o?t.jsx(O,{id:"JITPluginMessage.params.sharing.present",defaultMessage:"The following will be shared:"}):t.jsx(O,{id:"JITPluginMessage.params.sharing.past",defaultMessage:"The following was shared:"}),a&&t.jsx("a",{href:mn(a),className:"text-token-text-primary",target:"_blank",rel:"noreferrer",children:t.jsx(O,X({},ee.privacyPolicyLink))})]}),t.jsx("div",{className:"px-4 py-2",children:t.jsx(gt,{value:e})}),i.length>0&&t.jsx("div",{className:"px-4 py-2",children:i})]}),n&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"bg-token-bg-tertiary text-token-text-secondary flex justify-between px-4 py-2 text-sm",children:t.jsx(O,{id:"JITPluginMessage.params.result",defaultMessage:"Result:"})}),t.jsx("div",{className:"px-4 py-2",children:t.jsx(gt,{value:n})})]})]})}var ds;const Va=Ne.div(ds||(ds=de(["h-px bg-token-border-default"])));var ms;const rs=Ne.div(ms||(ms=de(["text-sm font-medium py-3 leading-6"])));var us;const Ha=Ne.div(us||(us=de(["my-4 p-5 w-full rounded-2xl popover bg-token-main-surface-primary shadow-lg border border-token-border-default"]))),qa=":",Ja=({functionName:s,parameters:e,onClick:n,isDraft:a=!0,isCanceled:o=!1})=>{const r=je(),i=Object.entries(e).filter(([l,d])=>!d||l==="timezone_str"&&d===Intl.DateTimeFormat().resolvedOptions().timeZone?!1:d.length>0);return t.jsxs(Ha,{children:[t.jsx("div",{className:"mb-4 flex items-center font-semibold",children:t.jsx("div",{children:a?pt(s):Qa(s,r)})}),i.map(([l,d])=>t.jsxs("div",{children:[t.jsx(Va,{}),t.jsxs("div",{className:"flex",children:[t.jsxs(rs,{className:"text-token-text-tertiary me-1",children:[pt(l),qa]}),t.jsx(rs,{className:"whitespace-pre-line",children:Ns(d,r)})]})]},l)),a&&!o&&t.jsx("div",{className:"mt-2 flex justify-end gap-4",children:t.jsx(_e,{color:"primary",className:"py-2",onClick:n,children:r.formatMessage(st.approveButton)})}),o&&t.jsx("div",{className:"mt-2 flex justify-end gap-4",children:t.jsx(_e,{color:"primary",className:"py-2",disabled:!0,children:r.formatMessage(st.canceledButton)})})]})},Qa=(s,e)=>{switch(s){case"create_event":return"Created Event ✅";default:return"".concat(pt(s)," ").concat(e.formatMessage(st.completedAction)," ✅")}},pt=s=>{switch(s){case"timezone_str":return"Timezone";default:return s.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" ")}},Ns=(s,e)=>{if(Array.isArray(s))return s.map(o=>Ns(o,e)).join(e.formatMessage(st.valueSeparator));if(typeof s=="object")return JSON.stringify(s);if(s.match(/^\s*\d{4}-\d{2}-\d{2}/)==null)return s;const a=new Date(s);return Number.isNaN(a.getTime())?s:e.formatDate(a,{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"numeric"})},st=ht({approveButton:{id:"ParametersView.approveButton",defaultMessage:"Approve"},completedAction:{id:"ParametersView.completedAction",defaultMessage:"Completed"},canceledButton:{id:"ParametersView.canceledButton",defaultMessage:"Canceled"},valueSeparator:{id:"ParametersView.valueSeparator",defaultMessage:","}}),ws="api_tool.list_resources",Cs="api_tool.search_tools",Ya=new Set([ws,Cs]),Xa=s=>Ya.has(s);function Ka(s,e,n,a,o,r=null){const i=Za(e,a,o,r);return i?typeof i=="string"?i:s.formatMessage(i,n):null}function Za(s,e,n,a=null){if(![b.Finished,b.Running,b.Stopped].includes(n)||!e)return s;switch(e){case"ecosystem_demo.daw":case"ecosystem_demo.daw_drums":return n===b.Finished||n===b.Stopped?K({id:"BYgUCC",defaultMessage:"Composed track"}):K({id:"9n1xDI",defaultMessage:"Composing track"});case"ecosystem_demo.flashcards":return n===b.Finished||n===b.Stopped?K({id:"szZeVr",defaultMessage:"Created flashcards"}):K({id:"NYOjya",defaultMessage:"Creating flashcards"});case ws:{const o=a==null?void 0:a[n];return o!=null?o:n===b.Finished||n===b.Stopped?K({id:"OdEouq",defaultMessage:"Looked for available tools"}):K({id:"hSyoq0",defaultMessage:"Looking for available tools"})}case Cs:{const o=a==null?void 0:a[n];return o!=null?o:n===b.Finished||n===b.Stopped?K({id:"4et5qC",defaultMessage:"Searched tools"}):K({id:"V0IDh0",defaultMessage:"Searching tools"})}case"api_tool.call_tool":{const o=a==null?void 0:a[n];return o!=null?o:n===b.Finished||n===b.Stopped?K({id:"NTASw4",defaultMessage:"Called tool"}):K({id:"gc64KQ",defaultMessage:"Calling tool"})}}return s}function lo({messages:s,nextMessage:e,clientThreadId:n,isLastMessageInTurn:a,isLastTurnInConversation:o,connectorFixture:r,allowInspectingArguments:i,onRequestCompletion:l}){var pe,He,qe,Je,Qe,Se,Ye,Xe,he,Ee,Ke,Ze,Te,Ae,_,S,Ie,Le,kt,_t,jt,Nt,wt,Ct,Mt,St,Et,Tt,At,It,Lt,Ft,Ot,Bt,Pt,$t;const[d,g]=Bs(),{assistantMessage:c,toolMessages:p,debugMessages:h}=Kn(s),x=un(),{addSource:m}=Wn(n),{uiState:u,jitPluginData:f,fileAttachments:y,invokedPlugin:N,lastConfirmActionJitPluginData:w}=bt(s,a),L=je(),B=fn(),[A,I]=xn(n,j=>{var v,Y;const E=(Y=(v=c.metadata)==null?void 0:v.gizmo_id)!=null?Y:j?ut.getGizmoId(j):B;return[E,qn(j==null?void 0:j.mode,E)]}),T=zn(I)&&I.gizmo_id===A,$=(pe=gn(A,T))==null?void 0:pe.data,[R,G]=M.useState(!1),C=Kt(c.recipient);let V;if((C==null?void 0:C.functionName)!=null&&($==null?void 0:$.tools)!=null){for(const j of $.tools)if(Zn(j,C.functionName)){V=j;break}}const k=(He=Kt(e==null?void 0:e.recipient))==null?void 0:He.namespace,{connectorId:F,connectorToolStatus:D,connectorStatusMessage:W,showConnectorConnect:U}=ea(C==null?void 0:C.namespace,k,p,o),J=pn(),H=yt(!0,hn.JIT_PLUGIN),P=r!=null?r:H.platformConnectors.get(F!=null?F:""),q=yn();let z=((qe=f==null?void 0:f.from_server)==null?void 0:qe.type)!=="denied_by_user"?(Je=f==null?void 0:f.from_server)==null?void 0:Je.body.domain:(Qe=V==null?void 0:V.metadata)==null?void 0:Qe.domain,te=null;if(!z&&(C!=null&&C.functionName)&&C.namespace==="kanzi_app"){const[j,E]=C.functionName.split("/");z=j.replace(/_/g," "),te=t.jsx(wn,{openNewTab:!0,className:"text-token-text-secondary pt-1 opacity-0 transition-opacity duration-200 group-hover/tool-message:opacity-100",href:"/kanzi/studio/c/".concat(E),children:t.jsx(Hn,{})})}z?z.endsWith("__jit_plugin")&&(z=z.slice(0,-12)):z="connector";const at=(Se=V==null?void 0:V.metadata)==null?void 0:Se.privacy_policy_url;M.useEffect(()=>{var v,Y;if(((v=ta(f==null?void 0:f.from_client))==null?void 0:v.type)==="oauth_success")return;const j=d.get("oauth_success"),E=d.get("system_hint");if(((Y=f==null?void 0:f.from_server)==null?void 0:Y.type)==="oauth_required"&&j){g(Q=>(Q.delete("oauth_success"),Q.delete("system_hint"),Q),{replace:!0});for(const Q of f.from_server.body.actions)if(Q.type==="oauth_redirect"){const ae="jit_oauth_success:".concat(Q.oauth_redirect.target_message_id);if(sessionStorage.getItem(ae))return;sessionStorage.setItem(ae,"1"),ve({eventSource:"url",assistantMessage:c,onRequestCompletion:l,actionData:{type:"oauth_success",target_message_id:Q.oauth_redirect.target_message_id},clientThreadId:n,activeSystemHint:E||null});return}}},[I,c,s,n,l,f,o,d,g,x,m]),M.useEffect(()=>{var E;if(d.get("link_success")&&((E=f==null?void 0:f.from_server)==null?void 0:E.type)==="link_required"){g(v=>(v.delete("link_success"),v),{replace:!0});for(const v of f.from_server.body.actions)if(v.type==="link_created"){ve({eventSource:"url",assistantMessage:c,onRequestCompletion:l,actionData:{type:"link_success",target_message_id:v.link_created.target_message_id},clientThreadId:n,activeSystemHint:x!=null?x:null});return}}},[d,g,c,n,l,f,x]);let se=be.Running,ce=z?ee.running:ee.starting,we={domain:z};if(u===b.Hidden)return null;if(u===b.OauthLogin||u===b.UserConfirmation||u===b.NoAuthLink){se=be.Paused,ce=ee.confirmingSimple;const j={gizmoName:(Ye=$==null?void 0:$.gizmo.display.name)!=null?Ye:"ChatGPT",domain:z};we=oe(X({},j),{title:E=>t.jsxs("div",{className:"inline-flex items-center gap-1 text-sm",children:[E,t.jsx(nt,{className:"icon-sm"})]}),subtitle:E=>t.jsx("div",{className:"text-xs",children:E})})}else u===b.Finished?(se=be.Finished,ce=ee.finished,we={domain:z}):u===b.Error?(se=be.Error,ce=ee.error):(u===b.Stopped||u===b.Denied)&&(se=be.Stopped,ce=u===b.Denied?ee.declined:ee.stopped);const Ce=((Xe=f==null?void 0:f.from_server)==null?void 0:Xe.type)!=="denied_by_user"?(he=f==null?void 0:f.from_server)==null?void 0:he.body.actions.map((j,E)=>t.jsx(hs,{clientThreadId:n,messages:s,onRequestCompletion:l,action:j,domain:z,handleUserAction:ve,rememberAnswer:R},E)):null;let Me=null;((Ee=c.metadata)!=null&&Ee.tool_invoking_message||(Ke=c.metadata)!=null&&Ke.tool_invoked_message||(Te=(Ze=c.metadata)==null?void 0:Ze.chatgpt_sdk)!=null&&Te.tool_invoking_message||(_=(Ae=c.metadata)==null?void 0:Ae.chatgpt_sdk)!=null&&_.tool_invoked_message)&&(Me={[b.Running]:(_t=(kt=(Ie=(S=c.metadata)==null?void 0:S.chatgpt_sdk)==null?void 0:Ie.tool_invoking_message)!=null?kt:(Le=c.metadata)==null?void 0:Le.tool_invoking_message)!=null?_t:void 0,[b.Finished]:(Mt=(Ct=(Nt=(jt=c.metadata)==null?void 0:jt.chatgpt_sdk)==null?void 0:Nt.tool_invoked_message)!=null?Ct:(wt=c.metadata)==null?void 0:wt.tool_invoked_message)!=null?Mt:void 0,[b.Stopped]:(It=(At=(Et=(St=c.metadata)==null?void 0:St.chatgpt_sdk)==null?void 0:Et.tool_invoked_message)!=null?At:(Tt=c.metadata)==null?void 0:Tt.tool_invoked_message)!=null?It:void 0});const We=(Lt=c.recipient)!=null?Lt:"",ze=Ka(L,ce,we,We,u,Me);if(Xa(We)&&!a&&!J)return null;const ne=bs(s,a),ot=sa(s,a),xe=na(s),De=(Ft=ne==null?void 0:ne[js])!=null?Ft:[],Ge=!!i&&(!!ne||!!xe||De.length>0),Ve=vs(s,a),rt=ys(s,a);let ge=t.jsx(t.Fragment,{});const Z=aa(s,a);if(Da.includes(Z)&&(u===b.UserConfirmation||u===b.Finished||u===b.Stopped||u===b.Denied)){const j=u!==b.Finished,E=(u===b.Stopped||u===b.Denied)&&!o,v=(Ot=ss(f,N))!=null?Ot:ss(w,void 0),Y=Q=>{var ae,et,Rt,Ut,Wt,zt,Dt;((ae=f==null?void 0:f.from_server)==null?void 0:ae.type)==="confirm_action"&&((Ut=(Rt=(et=f==null?void 0:f.from_server)==null?void 0:et.body)==null?void 0:Rt.actions)==null?void 0:Ut[0].type)==="allow"&&(ve({clientThreadId:n,assistantMessage:c,onRequestCompletion:l,sourceEvent:Q,actionData:oe(X({type:"allow"},(Dt=(zt=(Wt=f==null?void 0:f.from_server)==null?void 0:Wt.body)==null?void 0:zt.actions)==null?void 0:Dt[0].allow),{remember_answer:R}),activeSystemHint:x}),Nn(n,Ms=>{Ms.scrollToMessageId=n}))};switch(Z){case"send_email":ge=t.jsx(la,{to:v==null?void 0:v.to,cc:v==null?void 0:v.cc,bcc:v==null?void 0:v.bcc,subject:v==null?void 0:v.subject,body:v==null?void 0:v.body,onClick:u===b.UserConfirmation?Y:()=>{},isDraft:j,isCanceled:E});break;default:ge=t.jsx(Ja,{functionName:Z!=null?Z:"",parameters:v!=null?v:{},onClick:u===b.UserConfirmation?Y:()=>{},isDraft:j,isCanceled:E});break}}else(u===b.UserConfirmation||u===b.NoAuthLink||u===b.OauthLogin)&&Ce&&(ge=t.jsx(t.Fragment,{children:t.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[Ce,((Bt=f==null?void 0:f.from_server)==null?void 0:Bt.type)==="confirm_action"&&rt?t.jsx("div",{className:"flex gap-2 text-sm",children:t.jsx(Dn,{id:"dont-ask-again",label:t.jsx(O,X({},ee.rememberForThisConversation)),checked:R,onChange:j=>G(j.target.checked)})}):null]})}));return F?t.jsxs(t.Fragment,{children:[W&&t.jsx(Zt,{highlightedCommand:P?L.formatMessage(W,{domain:P.name}):t.jsx("br",{}),status:D,showWorkUserSetting:!1}),U&&P&&t.jsx("div",{className:"mb-2 flex gap-2",children:t.jsx(oa,{connector:P,onConnect:()=>{var v;const j=bn(n),E=j?new URL(vn(j),window.location.origin):new URL(window.location.href);E.searchParams.set("oauth_success","true"),x&&E.searchParams.set("system_hint",x),q({connectorId:P.id,redirectAfter:((v=f==null?void 0:f.from_server)==null?void 0:v.type)!=="link_required"?E.toString():void 0,referrer:kn.JitPluginMessage})},onProceedWithoutConnecting:j=>{var v,Y,Q;const E=(v=f==null?void 0:f.from_server)==null?void 0:v.type;if(E==="oauth_required"||E==="link_required"){for(const ae of(Q=(Y=f==null?void 0:f.from_server)==null?void 0:Y.body.actions)!=null?Q:[])if(ae.type==="deny"){const et=ae.deny.target_message_id;ve({eventSource:Gn(j),assistantMessage:c,onRequestCompletion:l,actionData:{type:"deny",target_message_id:et},clientThreadId:n,activeSystemHint:x});return}}}})})]}):t.jsxs(t.Fragment,{children:[t.jsx(za,{debugMessages:h}),t.jsx("span",{className:"group/tool-message",children:t.jsx(Zt,{highlightedCommand:ze,status:se,showWorkUserSetting:!1,accessory:te,forceExpanded:u===b.UserConfirmation,children:Ge?(C==null?void 0:C.namespace)==="api_tool"?Ve?null:t.jsx(ca,{isWrite:u===b.UserConfirmation,functionName:(Pt=c.recipient)!=null?Pt:Z,params:ne,result:xe,toolCallSafetySummary:ot}):t.jsx(Ga,{privacyPolicyUrl:at,name:($t=c.recipient)!=null?$t:Z,params:ne,result:xe,isPromptingForPermission:se===be.Paused}):null})}),t.jsx("div",{className:"mt-1 flex flex-wrap gap-2 empty:hidden",children:y==null?void 0:y.map(j=>t.jsx(ps,{file:j.name,fileId:j.id,width:"wide",alwaysShowData:!0,showDownloadButton:!0,downloadLink:j.download_url,contextConnectorInfo:_n(j.context_connector_info)},j.id))}),Vn(s)&&t.jsx(jn,{name:"ChatSDKContent",children:t.jsx(Ua,{clientThreadId:n,messages:s,isLastMessageInTurn:a,onRequestCompletion:l})}),!Ve&&ge]})}export{lo as JITPluginMessage};
//# sourceMappingURL=ey2o7kf4cxaotumu.js.map
