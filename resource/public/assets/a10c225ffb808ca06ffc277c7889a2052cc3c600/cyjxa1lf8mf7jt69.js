var h=Object.defineProperty,C=Object.defineProperties;var E=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var R=(e,r,t)=>r in e?h(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,p=(e,r)=>{for(var t in r||(r={}))I.call(r,t)&&R(e,t,r[t]);if(y)for(var t of y(r))q.call(r,t)&&R(e,t,r[t]);return e},f=(e,r)=>C(e,E(r));import{f as D,b as M,aE as P}from"./lef5ym39glv4981l.js";import{W as Q}from"./ef92qx749w9klz4o.js";import{u as A,b as F,a as K}from"./jj85rqzpbnvv3emr.js";function U(e){return!!e&&typeof e=="object"&&"pages"in e}const b=(e,r,t,a)=>{const u=f(p({},e),{review_preference:r.review_preference,updated_at:new Date().toISOString(),last_updated_user_email:t});return r.global_review_preference!==void 0&&(u.global_review_preference=r.global_review_preference,u.global_review_account_id=a),u},W=e=>{var r,t;return(t=(r=e==null?void 0:e.getWorkspaceId())!=null?r:e==null?void 0:e.normalizedAccountUserId)!=null?t:null};function B(){const e=A(),r=F(),t=D(),a=M(),u=P();return K({mutationFn:o=>Q.updateCodeReviewRepositories(o),onMutate:async o=>{await e.cancelQueries({queryKey:["wham","codeReviewRepositories"]});const c=e.getQueriesData({queryKey:["wham","codeReviewRepositories"]});return e.setQueriesData({queryKey:["wham","codeReviewRepositories"]},s=>{var g,l;if(!s)return s;const _=new Map(((g=o==null?void 0:o.repo_review_settings)!=null?g:[]).map(i=>[i.repository,i])),w=(l=a==null?void 0:a.email)!=null?l:null,v=W(u);if(U(s))return f(p({},s),{pages:s.pages.map(i=>f(p({},i),{repo_review_settings:i.repo_review_settings.map(n=>{const d=_.get(n.repository.id);return d===void 0?n:b(n,d,w,v)})}))});const m=s;return f(p({},m),{repo_review_settings:m.repo_review_settings.map(i=>{const n=_.get(i.repository.id);return n===void 0?i:b(i,n,w,v)})})}),{previous:c}},onError:(o,c,s)=>{s!=null&&s.previous&&s.previous.forEach(([_,w])=>{e.setQueryData(_,w)}),t.danger(r.formatMessage({id:"wham.codeReviewPage.teamAutomations.toast.onError",defaultMessage:"Error updating code review preferences"}),{duration:2,hasCloseButton:!0})}})}export{W as o,B as u};
//# sourceMappingURL=cyjxa1lf8mf7jt69.js.map
