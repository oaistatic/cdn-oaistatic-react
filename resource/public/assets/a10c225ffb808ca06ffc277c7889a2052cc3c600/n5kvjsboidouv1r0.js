var je=Object.defineProperty,ye=Object.defineProperties;var Ce=Object.getOwnPropertyDescriptors;var H=Object.getOwnPropertySymbols;var Me=Object.prototype.hasOwnProperty,be=Object.prototype.propertyIsEnumerable;var ee=(s,t,o)=>t in s?je(s,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[t]=o,T=(s,t)=>{for(var o in t||(t={}))Me.call(t,o)&&ee(s,o,t[o]);if(H)for(var o of H(t))be.call(t,o)&&ee(s,o,t[o]);return s},O=(s,t)=>ye(s,Ce(t));import{r as d,j as e,h as Se,b as we,m as ne,A as oe}from"./jj85rqzpbnvv3emr.js";import{mX as ke,mY as Ne,gm as _e,dp as De,m3 as _,mZ as Ee,bO as Ie,m_ as ae,m0 as $e,m$ as z,bV as U,n0 as Te,n1 as Oe,n2 as P}from"./mclphevd122040jw.js";import{S as Ve}from"./bcqyuj3uj1pnpyhi.js";import{x as Ae,fW as q,bI as Y,bJ as G,fw as Fe,E as ie,C as re,eE as Le,e as ce,cf as Be}from"./lef5ym39glv4981l.js";import{u as We,g as Pe}from"./fteqd6f5240seduu.js";import{u as Re,g as ze}from"./ld4419374p482u7j.js";import{r as Ue}from"./hhs3uwxj7uii5eg7.js";import"./nuz80uov2gm1dlm5.js";import"./w705jdvl4grquz0l.js";import"./hrd3zywe5ql748qg.js";import"./n9bxuhi2abjjjs86.js";import"./iiok29s29bpdre61.js";function Qe(s,t){const o={},r=(n,c="")=>{Object.entries(n).forEach(([p,g])=>{const u=c?"".concat(c,".").concat(p):p;g&&typeof g=="object"&&!Array.isArray(g)?r(g,u):g&&(typeof g=="number"||typeof g=="string"||g==null)&&(o[u]=g)})};r(s);const a={},l=n=>a[n]||(a[n]={}),m=n=>{if(n!=null){if(typeof n=="number")return n;if(typeof n=="string")return new Date(n).getTime()}};Object.keys(o).forEach(n=>{const c=o[n];if(c==null)return;const p=n.split(".").pop(),g=[[/^(.*)_start_time$/,"start",u=>u[1]],[/^(.*)_end_time$/,"end",u=>u[1]],[/^(.*)_sent_time$/,"start",u=>u[1]],[/^(.*)_success_time$/,"end",u=>u[1]],[/^(.*)_time$/,"start",u=>u[1]]];for(const[u,S,C]of g){const M=p.match(u);if(M){const j=C(M),E=l(j);E[S]=m(c);break}}});const x=[];Object.entries(a).forEach(([n,{start:c,end:p}])=>{c!==void 0&&p!==void 0?x.push({name:n,start:c,end:p,duration:p-c}):c!==void 0&&x.push({name:n,start:c,end:c,duration:0,noEnd:!0})});let f=x;if(t&&t.length){const n=new Set(t);f=f.filter(c=>n.has(c.name))}return f.sort((n,c)=>n.start-c.start||n.name.localeCompare(c.name)),f}const te=["text-blue-400","text-green-400","text-purple-400","text-orange-400","text-red-400","text-pink-400","text-yellow-400","text-gray-500","text-blue-300","text-green-300"],qe=({json:s,focusNames:t,width:o,barHeight:r=18,rowGap:a=6,paddingX:l=50,paddingTop:m=20})=>{const x=d.useRef(null),[f,n]=d.useState(o||600);Ae(()=>{if(!o){const i=()=>{if(x.current){const h=x.current.clientWidth;n(Math.max(300,h))}};return i(),window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)}},[o]);const c=d.useMemo(()=>Qe(s,t),[s,t]),[p,g]=d.useState({}),u=d.useCallback(i=>p[i]!==!1,[p]),S=d.useCallback(i=>g(h=>O(T({},h),{[i]:h[i]===!1})),[]),C=d.useMemo(()=>c.filter(i=>u(i.name)),[c,u]),M=C.length>0,j=M?Math.min(...C.map(i=>i.start)):0,E=M?Math.max(...C.map(i=>i.end)):1,k=Math.max(E-j,1),w=m+c.length*(r+a)+a+32,de=(c.length?Math.max(...c.map(i=>i.name.length)):0)*7+16+16,V=Math.max(l,de),ue=l,B=(f-V-ue)/k,[me,J]=d.useState(null),[A,X]=d.useState({visible:!1,x:0,y:0,lines:[]}),Z=(i,h)=>{if(!x.current)return;const v=x.current.getBoundingClientRect(),y=h.clientX-v.left,F=h.clientY-v.top,I=(i.start-j).toFixed(2),$=i.noEnd?void 0:(i.end-j).toFixed(2),W=$?["start: ".concat(I," ms"),"end: ".concat($," ms"),"dur: ".concat(i.duration.toFixed(2)," ms")]:["start: ".concat(I," ms")];X({visible:!0,x:y+10,y:F+10,lines:W})},xe=()=>X(i=>O(T({},i),{visible:!1})),fe=d.useMemo(()=>{if(!M)return[0,k];const i=new Set;C.forEach(v=>{i.add(v.start-j),i.add(v.end-j)});const h=Array.from(i).sort((v,y)=>v-y);return h[0]!==0&&h.unshift(0),h[h.length-1]!==k&&h.push(k),h},[C,j,k,M]);return e.jsxs("div",{ref:x,className:"relative w-full",style:o?{width:"".concat(o,"px")}:void 0,children:[e.jsxs("svg",{width:f,height:w,className:"font-sans",children:[c.map((i,h)=>{const v=m+h*(r+a),y=u(i.name)?V+(i.start-j)*B:0,F=u(i.name)?Math.max(i.duration*B,1):0,I=te[h%te.length],$=me===h?"opacity-80":"opacity-100",W=i.duration===0,K=!!i.noEnd,he=N=>{u(i.name)&&(J(h),Z(i,N))},pe=N=>{u(i.name)&&Z(i,N)},ge=()=>{J(null),xe()};return e.jsxs("g",{onMouseEnter:he,onMouseMove:pe,onMouseLeave:ge,children:[e.jsx("foreignObject",{x:0,y:v,width:V-8,height:r,requiredExtensions:"http://www.w3.org/1999/xhtml",children:e.jsx("div",{className:"pointer-events-auto box-border flex h-full items-center justify-end gap-1 pe-1 text-[12px] text-neutral-900 select-none",children:e.jsxs("label",{className:"flex cursor-default items-center gap-1",children:[e.jsx("input",{type:"checkbox",checked:u(i.name),onChange:()=>S(i.name),className:"cursor-pointer"}),e.jsx("span",{children:i.name})]})})}),u(i.name)&&(K?(()=>{const N=v+r/2,L=r*.6/2,ve=["".concat(y,",").concat(N-L),"".concat(y+L,",").concat(N),"".concat(y,",").concat(N+L),"".concat(y-L,",").concat(N)].join(" ");return e.jsx("polygon",{points:ve,fill:"currentColor",className:"".concat(I," ").concat($)})})():W?e.jsx("line",{x1:y,x2:y,y1:v,y2:v+r,stroke:"currentColor",strokeWidth:2,className:I}):e.jsx("rect",{x:y,y:v,width:F,height:r,fill:"currentColor",className:"".concat(I," ").concat($)})),u(i.name)&&e.jsxs("text",{x:y+(K?r*.6:F)+4,y:v+r/2+4,fill:"currentColor",className:"text-xs text-neutral-700",children:[i.duration.toFixed(2)," ms"]})]},i.name)}),fe.map(i=>{const h=V+i*B;return e.jsx("line",{x1:h,x2:h,y1:m-3,y2:w-32,stroke:"currentColor",strokeWidth:1,className:"text-gray-200"},i)}),e.jsx("text",{x:f/2,y:w-6,textAnchor:"middle",fill:"currentColor",className:"text-xs text-neutral-600",children:"Time since first event (ms)"})]}),A.visible&&e.jsx("div",{className:"pointer-events-none absolute z-10 rounded bg-black/90 px-1.5 py-1 font-mono text-xs whitespace-nowrap text-white",style:{left:A.x,top:A.y},children:A.lines.map((i,h)=>e.jsx("div",{children:i},h))})]})};var R,se;function Ye(){if(se)return R;se=1;var s=Ue(),t=ke(),o=s(function(r,a,l){return r+(l?" ":"")+t(a)});return R=o,R}var Ge=Ye();const Je=Se(Ge);function Xe({conversationId:s}){var l;const t=q(s),o=(l=Y.getCurrentNode(G(s)))==null?void 0:l.id,r=Ne();return _e()?e.jsx(D,{conversationId:t!=null?t:s,parentMessageId:o,status:r}):null}function D(s){var n;const t=(n=s==null?void 0:s.status)==null?void 0:n.modes,[o,r]=d.useState(!1),[a,l]=d.useState(),m=d.useCallback(c=>{l(c),r(!0)},[]),x=we(),f=d.useCallback(()=>r(!1),[]);return e.jsxs(e.Fragment,{children:[e.jsx(Fe,{contentAlign:"center",triggerButton:e.jsx(D.Trigger,{}),children:t?t.map(c=>d.createElement(D.Item,O(T({},s),{key:c.display_name,voiceStatusMode:c,onShowModal:m}))):e.jsx("div",{role:"progressbar","aria-valuetext":x.formatMessage({defaultMessage:"Loading voice modes",id:"voiceModeButton.loadingModes"}),"aria-busy":"true","aria-live":"assertive","aria-valuemin":0,"aria-valuemax":100,children:e.jsx(ie,{"aria-hidden":"true",className:"my-4 min-w-full"})})}),e.jsx(D.Modal,{conversationId:s.conversationId,disabledModeMetadata:a,isOpen:o,onClose:f})]})}D.Modal=function(t){var l,m,x,f;const o=(m=(l=t.disabledModeMetadata)==null?void 0:l.buttons)!=null?m:[],r=Re({buttons:o,conversationId:t.conversationId,onClick:t.onClose}),a=e.jsx(De,{children:(x=t.disabledModeMetadata)==null?void 0:x.description_markdown});return e.jsx(re,{testId:"modal-voice-mode",title:(f=t.disabledModeMetadata)==null?void 0:f.title,description:a,isOpen:t.isOpen,onClose:t.onClose,type:"success",primaryButton:r.primary,secondaryButton:r.secondary})};D.Trigger=d.forwardRef(function(t,o){var a;const r=_(l=>l.voiceMode);return e.jsxs(Ee,O(T({ref:o},t),{children:[(a=Je(r))!=null?a:e.jsx(ie,{}),e.jsx(Ie,{className:"icon text-token-text-tertiary"})]}))});D.Item=function({conversationId:t,parentMessageId:o,voiceStatusMode:r,onShowModal:a}){const{disabled_mode_metadata:l,mode:m}=r,{startVoiceMode:x}=We(),f=q(t),n=d.useCallback(async()=>{l?a(l.disabled_message):x(Pe({serverThreadId:f,parentMessageId:o,isAdvancedMode:m==="advanced"&&!l,eventSource:"voice_mode_picker",clientThreadId:t,gizmoId:Y.getGizmoId(G(t)),skipCacheReason:"debug-button-clicked"}))},[t,l,m,a,o,f,x]);return e.jsx(Le.Item,{onClick:n,children:e.jsxs("div",{children:[r.display_name,e.jsx("div",{className:"text-token-text-tertiary text-xs",children:r.description})]})})};function jt({conversationId:s}){const t=_(a=>a.voiceSessionId),o=_(a=>{const{sessionCreateTime:l,sessionConnectedTime:m}=a.metrics;return l&&m?m.getTime()-l.getTime():null}),r=d.useCallback(a=>a>=1e3?"".concat((a/1e3).toFixed(2),"s"):"".concat(a.toFixed(0),"ms"),[]);return e.jsx("div",{className:"relative h-full",children:e.jsx(ne.div,{className:"border-s-token-sidebar-surface-secondary bg-token-main-surface-secondary absolute hidden h-full max-w-[500px] overflow-y-auto rounded-xl border-s pt-4 shadow-inner md:block",initial:{opacity:0,x:520,width:"0px"},animate:{opacity:1,x:0,width:"500px",left:"-520px"},exit:{opacity:0,x:520,width:"0px",left:"0px"},transition:{type:"tween"},children:e.jsx(oe,{children:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex w-full items-center justify-center",children:e.jsx(Xe,{conversationId:s})}),e.jsxs("div",{className:"p-4 py-2 text-sm",children:[e.jsx(b,{name:"Voice Session ID",text:t!=null?t:"n/a"}),e.jsx(Ze,{conversationId:s}),e.jsx(b,{name:"Connect Latency",text:o!==null?r(o):"n/a"}),e.jsx(Ke,{})]}),e.jsxs("div",{className:"flex h-full w-full flex-col flex-nowrap gap-4",children:[e.jsx("div",{className:"px-4",children:e.jsxs("div",{className:"flex flex-col flex-nowrap gap-4",children:[e.jsx(He,{}),e.jsx(et,{})]})}),!1]})]})})})})}function Ze({conversationId:s}){var c,p,g;const t=q(s),o=t&&G(t),r=Y.getTree(o),a=_(u=>u.server.messages.findLast(S=>S.type===ae.ConversationUpdate)),l=a==null?void 0:a.payload.parent_message_id,m=l?r.findNode(u=>u.message.author.role==="assistant"&&Be.isMultimodalTextMessage(u.message),l):void 0,{model_definition_slug:x,model_definition_virtual_model_id:f}=(p=(c=m==null?void 0:m.message.metadata)==null?void 0:c.__internal)!=null?p:{},n=(g=[x,f].filter(Boolean).join(", "))!=null?g:"pending model response";return e.jsx(b,{name:"Model ID",text:n,allowWrap:!0})}function Ke(){const[s,t]=d.useState(!1),[o,r]=d.useState({}),a=$e(),l=d.useCallback(()=>{t(m=>!m)},[]);return d.useEffect(()=>{s&&ze(a).then(r)},[s,a]),e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"cursor-pointer font-semibold text-blue-500 hover:underline",onClick:l,children:s?"Hide Client Metrics Chart":"Show Client Metrics Chart"}),e.jsxs(re,{testId:"modal-client-metrics",title:"Client Metrics",isOpen:s,onClose:()=>t(!1),size:"fullscreen",showCloseButton:!0,children:[e.jsx(qe,{json:o}),e.jsx("pre",{className:"bg-token-bg-tertiary text-token-text-secondary m-4 overflow-x-auto rounded-md p-2 text-[10px] font-semibold",children:JSON.stringify(o,null,2)})]})]})}function He(){const[s,t]=d.useState("timestamp"),[o,r]=d.useState("asc"),a=_(n=>n.server.messages.filter(c=>c.type===ae.Performance)),l=a[a.length-1],m=d.useCallback(n=>n>=1e3?"".concat((n/1e3).toFixed(2),"s"):"".concat(n.toFixed(1),"ms"),[]),x=d.useMemo(()=>l?[...l.payload.metrics].sort((n,c)=>{const p=s==="name"?n.name.localeCompare(c.name):n.ms-c.ms;return o==="asc"?p:-p}):[],[l,s,o]);if(!l)return null;const f=n=>{n===s?r(o==="asc"?"desc":"asc"):(t(n),r("asc"))};return e.jsx(le,{title:"Performance",children:e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsxs("div",{className:"flex flex-row items-center",children:[e.jsx(Q,{text:"Metric"}),s==="name"?o==="asc"?e.jsx(z,{}):e.jsx(U,{}):null]}),e.jsxs("div",{className:"flex cursor-pointer flex-row items-center",onClick:()=>f("timestamp"),children:[e.jsx(Q,{text:"Timestamp"}),s==="timestamp"?o==="asc"?e.jsx(z,{}):e.jsx(U,{}):null]}),x.map(n=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm",children:n.name},n.name),e.jsx("span",{className:"bg-token-main-surface-tertiary line-clamp-1 rounded-lg p-0.5 px-1 font-mono text-xs",children:m(n.ms)},n.name+n.ms)]}))]})})}function et(){var x,f;const s=_(n=>n.server.connectionState),t=_(n=>n.dev.room),[o,r]=d.useState("Unknown"),a=t==null?void 0:t.localParticipant,l=(x=t==null?void 0:t.numParticipants)!=null?x:"Unknown",m=(f=t==null?void 0:t.activeSpeakers)!=null?f:[];return d.useEffect(()=>{if(a){const n=c=>{r(c)};return a.on("connectionQualityChanged",n),()=>{a.off("connectionQualityChanged",n)}}},[a]),e.jsxs(le,{title:"Room",open:!1,children:[e.jsx(b,{name:"Connection Quality",text:String(o)}),e.jsx(b,{name:"Connection State",text:String(s)}),e.jsx(b,{name:"Participants",text:l}),e.jsx(b,{name:"Speakers",text:m.length}),e.jsx(tt,{})]})}function tt(){const s=_(c=>c.dev.room),[t,o]=d.useState(null),[r,a]=d.useState(null),[l,m]=d.useState(null),x=s==null?void 0:s.getActiveDevice("audioinput"),f=s==null?void 0:s.getActiveDevice("audiooutput"),n=s==null?void 0:s.getActiveDevice("videoinput");return d.useEffect(()=>{async function c(){var j,E,k;const p=await P.getLocalDevices("audioinput"),g=await P.getLocalDevices("audiooutput"),u=await P.getLocalDevices("videoinput"),S=p.find(w=>w.deviceId===x),C=g.find(w=>w.deviceId===f),M=u.find(w=>w.deviceId===n);o((j=S==null?void 0:S.label)!=null?j:"Unknown"),a((E=C==null?void 0:C.label)!=null?E:"Unknown"),m((k=M==null?void 0:M.label)!=null?k:null)}c()},[x,f,n]),e.jsxs(e.Fragment,{children:[e.jsx(Q,{text:"Devices"}),l?e.jsx(b,{icon:Te,name:"Video Input",text:l}):null,e.jsx(b,{icon:Oe,name:"Audio Input",text:t!=null?t:"Unknown"}),e.jsx(b,{icon:Ve,name:"Audio Output",text:r!=null?r:"Unknown"})]})}function le({title:s,titleClassName:t,children:o,open:r}){const[a,l]=d.useState(r!=null?r:!0);return e.jsxs("div",{children:[e.jsxs("h3",{className:ce("text-token-text-secondary flex cursor-pointer items-center py-2 text-lg font-semibold",t),onClick:()=>l(!a),children:[e.jsx("span",{children:s}),e.jsx("span",{className:"ms-2",children:a?e.jsx(U,{className:"icon-sm"}):e.jsx(z,{className:"icon-sm"})})]}),e.jsx(oe,{initial:!1,children:a&&e.jsx(ne.div,{initial:"collapsed",animate:"open",exit:"collapsed",variants:{open:{height:"auto",opacity:1},collapsed:{height:0,opacity:0}},transition:{duration:.3,ease:"easeInOut"},layout:!0,children:o},"content")})]})}function Q({text:s}){return e.jsx("h4",{className:"py-2 text-sm font-semibold",children:s})}function b(s){var t;return e.jsxs("div",{className:"flex flex-row flex-nowrap items-center gap-2",children:[e.jsx("span",{className:"opacity-85",children:s.icon?e.jsx(s.icon,{className:"h-[0.75rem] w-[0.75rem]"}):e.jsxs("span",{className:"text-sm",children:[s.name,":"]})}),(t=s.content)!=null?t:e.jsx("span",{className:ce(["bg-token-main-surface-tertiary rounded-lg p-0.5 px-1 font-mono text-xs",!s.allowWrap&&"line-clamp-1"]),children:s.text})]})}export{jt as VoiceModeDevPanel};
//# sourceMappingURL=n5kvjsboidouv1r0.js.map
