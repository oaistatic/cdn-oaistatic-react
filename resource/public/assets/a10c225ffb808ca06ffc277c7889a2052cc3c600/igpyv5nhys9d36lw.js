import{ad as R,j as s,ak as T,b as U,g as B,u as D,a as E,M as v,G as I}from"./jj85rqzpbnvv3emr.js";import{oM as O,f as L,E as $}from"./lef5ym39glv4981l.js";import{dQ as q}from"./mclphevd122040jw.js";import{W as Q}from"./i5w9a1ap4yrxpqjj.js";import{R as z,I as d,S as b}from"./i2fx1o9afvn04cvf.js";import{E as G,R as H,g as J}from"./mt471i5hma6miudr.js";import{u as K}from"./iv7wsx4h3mnmu7bd.js";import{d as X,W as Y,a as Z,e as V}from"./ef92qx749w9klz4o.js";import"./hqbuxjfjvu1puiaw.js";import"./jxokrjy8ycftw0wv.js";import"./jk4cx3iywxazx01l.js";import"./hc8beflnn681x6ow.js";import"./mw2u7timj0qnsnvj.js";import"./dvqe6kc43fkjsavv.js";import"./nk7ydxm8ptxusvbt.js";import"./k059n59kmbyb9lsl.js";import"./ojb4d4bxj44fs0l8.js";import"./oz589d7sqtxcbljf.js";import"./ghevfdrvws126g4g.js";import"./jza9spsuu2f7ynxb.js";import"./gd5k9khi2ma4fx2d.js";import"./lptwpbjabrvjmhsj.js";import"./otrobs7izu0hlfln.js";import"./hxd0yong6zdu9u3r.js";import"./ogcl7v93rii15rrg.js";import"./w705jdvl4grquz0l.js";import"./lbaueofbjv8jfqwm.js";import"./kxedrjbxv2qblujd.js";function ee(){const{environmentId:a}=R(),{eligible:r}=q();return r?s.jsx(T,{to:"/codex"}):a?s.jsx(te,{environmentId:a}):s.jsx(O,{})}function te({environmentId:a}){var u,l,h,_,f,g,S;const r=U(),c=L(),M=B(),m=D(),{data:e,isLoading:k,isError:C}=X(a),p=(u=e==null?void 0:e.secrets)!=null?u:{},N=K()?"workspace":"private",{mutate:x,isPending:A}=E({mutationFn:t=>Y.updateEnvironment(a,t),onSuccess:async t=>{await Z(m,a),V(m,a,t),c.success(r.formatMessage({id:"wham.editEnvironment.environmentUpdatedSuccessfully",defaultMessage:"Environment updated successfully"})),M("/codex/settings/environment/".concat(a))},onError:()=>{c.danger({id:"wham.editEnvironment.failedToUpdateEnvironment",defaultMessage:"Failed to update environment",description:"Toast to show when an environment is updated unsuccessfully"},{toastId:"wham_edit_environment_failed_to_update_environment"})}});function F(t){var j,w;const n=J(t.secrets,p),W=t.envVars.reduce((o,y)=>(o[y.key]=y.value,o),{}),i=(w=(j=t.share_targets)==null?void 0:j.map(o=>o.trim()))==null?void 0:w.filter(Boolean),P=t.share_settings==="private"?[]:i==null?void 0:i.map(o=>({email:o,permission:"editor",type:"user"}));x({etag:e==null?void 0:e.etag,label:t.label,repos:[t.repositoryId],machine_id:t.machine,setup:t.setupCommands,maintenance_setup:t.maintenanceSetupCommands,workspace_dir:t.workspaceDirectory,agent_network_access:t.agentNetworkAccess,description:t.description,share_settings:t.share_settings,share_targets:P,secrets:n,env_vars:W,auto_setup_settings:t.autoSetupSettings,cache_settings:t.cacheSettings})}return s.jsx(Q,{flex:!0,hideBorder:!0,showSidebar:!1,maxWidth:"w-full",children:k?s.jsx("div",{className:"flex h-full items-center justify-center",children:s.jsx($,{})}):C?s.jsx("div",{className:"flex h-full items-center justify-center",children:s.jsx(v,{id:"wham.editEnvironment.errorLoadingEnvironment",defaultMessage:"Error loading environment"})}):e?s.jsxs(s.Fragment,{children:[s.jsxs(z,{className:"sticky top-0 px-4",children:[s.jsx(d,{label:r.formatMessage({id:"wham.editEnvironment.environments",defaultMessage:"Environments"}),url:"/codex/settings/environments",className:"text-token-text-tertiary"}),s.jsx(b,{}),s.jsx(d,{label:e.label,url:"/codex/settings/environment/".concat(a),className:"font-medium"}),s.jsx(b,{}),s.jsx(d,{label:r.formatMessage({id:"wham.editEnvironment.edit",defaultMessage:"edit"}),className:"text-token-text-tertiary"})]}),s.jsx(G,{initialEnvironmentId:a,existingEnvironment:e,initialValues:{label:e==null?void 0:e.label,description:(l=e==null?void 0:e.description)!=null?l:"",share_settings:(h=e==null?void 0:e.share_settings)!=null?h:N,share_targets:(f=(_=e==null?void 0:e.share_targets)==null?void 0:_.map(t=>t.email))!=null?f:[],machine:e==null?void 0:e.machine_id,repositoryId:e==null?void 0:e.repos[0],workspaceDirectory:(g=e==null?void 0:e.workspace_dir)!=null?g:"",agentNetworkAccess:e==null?void 0:e.agent_network_access,setupCommands:e!=null&&e.setup?Array.isArray(e==null?void 0:e.setup)?e.setup.join("\n"):e.setup:"",maintenanceSetupCommands:e!=null&&e.maintenance_setup?Array.isArray(e==null?void 0:e.maintenance_setup)?e.maintenance_setup.join("\n"):e.maintenance_setup:"",envVars:Object.entries((S=e==null?void 0:e.env_vars)!=null?S:{}).map(([t,n])=>({key:t,value:n})),secrets:Object.keys(p).map(t=>({key:t,value:H,isEditing:!1})),autoSetupSettings:e==null?void 0:e.auto_setup_settings,cacheSettings:e==null?void 0:e.cache_settings},primaryButtonText:r.formatMessage({id:"wham.editEnvironment.saveEnvironment",defaultMessage:"Save environment"}),onSubmit:F,isPending:A})]}):s.jsx("div",{className:"flex h-full items-center justify-center",children:s.jsx(v,{id:"wham.editEnvironment.environmentNotFound",defaultMessage:"Environment not found"})})})}const We=()=>[{title:"Codex"}],Pe=I(function(){return s.jsx(ee,{})});export{Pe as default,We as meta};
//# sourceMappingURL=igpyv5nhys9d36lw.js.map
