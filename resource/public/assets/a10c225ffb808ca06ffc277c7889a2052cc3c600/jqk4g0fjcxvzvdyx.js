var be=Object.freeze,we=Object.defineProperty,Ve=Object.defineProperties;var Ye=Object.getOwnPropertyDescriptors;var re=Object.getOwnPropertySymbols;var je=Object.prototype.hasOwnProperty,_e=Object.prototype.propertyIsEnumerable;var ke=(t,a,s)=>a in t?we(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,c=(t,a)=>{for(var s in a||(a={}))je.call(a,s)&&ke(t,s,a[s]);if(re)for(var s of re(a))_e.call(a,s)&&ke(t,s,a[s]);return t},K=(t,a)=>Ve(t,Ye(a));var he=(t,a)=>{var s={};for(var o in t)je.call(t,o)&&a.indexOf(o)<0&&(s[o]=t[o]);if(t!=null&&re)for(var o of re(t))a.indexOf(o)<0&&_e.call(t,o)&&(s[o]=t[o]);return s};var Ue=(t,a)=>be(we(t,"raw",{value:be(a||t.slice())}));import{j as e,m as Oe,b as ee,r as m,M as u,d as B,f as Z,h as Ze,G as Je}from"./jj85rqzpbnvv3emr.js";import{sH as F,sI as ze,e as T,B as P,lb as C,c6 as ne,qg as Xe,sJ as et,sK as ye,sF as V,ji as Y,d as tt,sL as qe,C as at,sM as R,sN as ce,sO as ue,P as x,R as z,sP as ve,qh as ge,sQ as Te,sR as st,sS as ot,sT as We,T as rt,fv as nt,be as it,I as lt,aA as dt,E as fe,k7 as ct,nh as ut,sU as gt,i as mt,j as pt,F as ht,iI as xt}from"./lef5ym39glv4981l.js";import{d7 as ft,dq as yt,bL as vt,nU as E,hm as Pe,bV as Mt,uZ as Re,gt as Be,jU as bt}from"./mclphevd122040jw.js";import{r as kt}from"./k6u2cn52t3dhqz8s.js";import{S as wt}from"./gd5k9khi2ma4fx2d.js";import{d as jt,V as _t,u as Ut,O as ie}from"./gnu79wd8bxnkjimp.js";import{g as D}from"./ck1161dhvnx32o2f.js";import{L as Tt}from"./b2skq2o9dgw287ng.js";import{S as Lt}from"./392jyrzapv8u4xa7.js";import{S as St}from"./byc485nmh825ib1a.js";import{T as X}from"./i5991cad8s41d2db.js";import{u as Ct}from"./nq5i976pifkrt40a.js";import{c as Dt,a as Nt,u as Et,h as At}from"./fya3qb1e1s8z4llj.js";import"./fnnulb9pmlo3cgid.js";import"./c631j8z7keqfibnl.js";import"./galyil7vygq0i5a6.js";import"./f8qcx5r3ombc6w5p.js";import"./l5n8sav08y32nia1.js";import"./efsl2tpd3w39q64v.js";import"./n82i9qkvs5r9bggc.js";import"./9z485wf4plyfoo73.js";import"./cncd8uuk5eicbkeu.js";import"./dta5t6ifyam55mk9.js";import"./cdk0cmbgnafohb1q.js";import"./gyvvad7btmtz1x9o.js";import"./n6vmm5pyahusdy8e.js";import"./l041el2tch1t3nkf.js";import"./easgat082167v0i8.js";import"./dvqe6kc43fkjsavv.js";import"./mw2u7timj0qnsnvj.js";import"./hnotrmacgvnfyexv.js";import"./mej2ctt6swvc1m1z.js";import"./go9515ghq3pauvs4.js";import"./d9serb02oz4r1lgw.js";import"./n5wrqpcxv1sjah44.js";const G=F(ze(new Date,1)),W=new Date;function me({onLeft:t,leftDisabled:a,onRight:s,rightDisabled:o,children:n,className:i,borderLess:r=!1,surpressChildrenWrapper:l=!1}){return e.jsxs("div",{className:T("flex items-stretch",i),children:[e.jsx(P,{className:T("disabled:text-token-text-quaternary pe-1",!r&&"border-token-border-medium rounded-e-none border-e-0 disabled:opacity-100"),color:r?"ghost":"secondary",size:"small",onClick:t,disabled:a,icon:ft}),l?n:e.jsx("span",{className:T("flex grow items-center justify-center px-1 text-sm",!r&&"border-token-border-medium border-t border-b"),children:n}),e.jsx(P,{className:T("disabled:text-token-text-quaternary ps-1",!r&&"border-token-border-medium rounded-s-none border-s-0 disabled:opacity-100"),color:r?"ghost":"secondary",size:"small",onClick:s,disabled:o,icon:yt})]})}const It=kt(12);function Fe({referenceDate:t,setReferenceDate:a,earliestValidDate:s,latestValidDate:o,motionLayoutId:n}){return e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"mb-2 w-full",borderLess:!0,onLeft:()=>a(ze(t,1),"subYear"),onRight:()=>a(Xe(t,1),"addYear"),leftDisabled:ne(new Date)>=ne(t)+1,rightDisabled:ne(new Date)<=ne(t),children:C(t,"y")}),e.jsx("div",{className:"grid grid-cols-3 gap-1",children:It.map(i=>{const r=F(et(t,i)),l=ye(r,t),d=V(r,s)||Y(r,o);return e.jsxs("button",{disabled:d,onClick:()=>a(r,"select"),className:T("relative h-8 w-full rounded-md",!d&&"hover:bg-token-surface-hover"),children:[l&&e.jsx(Oe.div,{layoutId:n,className:"bg-token-main-surface-primary-inverse absolute inset-0 rounded-md",transition:{duration:.15}}),e.jsx("span",{className:T("relative z-10 transition-colors duration-75",l&&"text-token-main-surface-primary delay-75",!l&&"text-token-text-primary delay-0",d&&"text-token-text-quaternary"),children:C(r,"MMM")})]},i)})})]})}function Gt({currentWorkspaceId:t,currentTab:a,onClose:s}){var N;const o=ee(),[n,i]=m.useState(!1),[r,l]=m.useState(a==="gptsTab"?"gpt":"user"),[d,p]=m.useState("thisMonth"),[g,j]=m.useState(),v=(N=tt(b=>{var _;return(_=b.currentWorkspace)==null?void 0:_.name}))!=null?N:t,M=new Date,f=qe(new Date,1);return e.jsxs(at,{testId:"modal-export",isOpen:!0,onClose:()=>{s(),x.logEvent("Workspace Usage: Export Modal Closed Without Generation")},type:"success",title:e.jsx(u,c({},y.title)),showCloseButton:!0,primaryButton:e.jsx(P,{loading:n,onClick:async()=>{var b,_;i(!0);try{const L=d==="customRange"?{period:(b=g==null?void 0:g.period)!=null?b:se.period,period_start:D((_=g==null?void 0:g.referenceDate)!=null?_:se.referenceDate)}:qt(d);x.logEvent("Workspace Usage: Export Generate CSV Clicked",{reportType:r,dateRangeType:d,period:L.period,periodStart:L.period_start});const J=await z.safeGet("/accounts/{account_id}/reporting",{parameters:{path:{account_id:t},query:K(c({},L),{report_type:r})}});jt({data:J.csv_content,mimeType:"text/csv",filename:o.formatMessage(y.filename,{workspaceName:v,period:L.period,reportType:r,date:L.period_start})})}finally{i(!1)}s()},children:e.jsx(u,c({},y.generateCsvButton))}),children:[e.jsxs(Tt,{className:"font-medium",children:[e.jsx(u,c({},y.dataTypeDropdownLabel)),e.jsx(vt,{triggerClassName:"flex mt-2 border border-token-border-default text-base focus-visible:border-token-border-default w-full justify-between",value:r,onValueChange:b=>l(b),options:[{label:o.formatMessage(y.dataTypeDropdownUsers),value:"user"},{label:o.formatMessage(y.dataTypeDropdownGpts),value:"gpt"}]})]}),e.jsx("div",{className:"mt-6 mb-2 font-medium",children:e.jsx(u,c({},y.dateRangeLabel))}),e.jsxs(E.Root,{className:"flex flex-col gap-3",value:d,onValueChange:b=>{p(b),x.logEvent("Workspace Usage: Export Date Range Type Changed",{dateRangeType:b})},children:[e.jsx(E.Item,{value:"thisMonth",label:e.jsx(u,K(c({},y.thisMonthLabel),{values:{date:C(M,"MMMM y")}})),children:e.jsx(E.Indicator,{})}),e.jsx(E.Item,{value:"lastMonth",label:e.jsx(u,K(c({},y.lastMonthLabel),{values:{date:C(R(M,1),"MMMM y")}})),children:e.jsx(E.Indicator,{})}),e.jsx(E.Item,{value:"thisWeek",label:e.jsx(u,K(c({},y.thisWeekLabel),{values:{date:"".concat(C(ce(M),"MMM d")," – ").concat(C(ue(M),"MMM d"))}})),children:e.jsx(E.Indicator,{})}),e.jsx(E.Item,{value:"lastWeek",label:e.jsx(u,K(c({},y.lastWeekLabel),{values:{date:"".concat(C(ce(f),"MMM d")," – ").concat(C(ue(f),"MMM d"))}})),children:e.jsx(E.Indicator,{})}),e.jsx(E.Item,{value:"customRange",label:e.jsx(Ot,{customRange:g,setCustomRange:j,onClick:()=>p("customRange")}),children:e.jsx(E.Indicator,{})})]})]})}const se={period:"monthly",referenceDate:new Date};function Ot({customRange:t,setCustomRange:a,onClick:s}){const o=ee(),n=(t!=null?t:se).period,i=(t!=null?t:se).referenceDate,r=n==="monthly"?ve(i):ue(i),l=({period:d,referenceDate:p})=>a((g=se)=>{const j=d!=null?d:g.period,v=p!=null?p:g.referenceDate,M=j==="monthly"?F:ce,f=Y(v,W)?W:V(v,G)?G:v;return{period:j,referenceDate:M(f)}});return e.jsx(Pe,{className:"z-50",alignAgainstAnchor:"start",triggerButton:e.jsxs(P,{size:"small",color:"secondary",contentsFullWidth:!0,onClick:s,children:[t?e.jsx(u,K(c({},y.customRangeDisplay),{values:{start:Te(t.referenceDate),end:Te(r)}})):e.jsx(u,c({},y.chooseMonthOrWeekButton)),e.jsx("div",{className:"grow"}),e.jsx(Mt,{})]}),children:e.jsxs("div",{className:"w-[210px] p-1 text-xs",children:[e.jsx(wt,{className:"mb-4 rounded-md",value:n,onChange:d=>{l({period:d}),x.logEvent("Workspace Usage: Export Custom Period Changed",{period:d})},ariaLabel:o.formatMessage(y.customRangePeriodToggleAria),leftItem:{className:"rounded-md",ariaLabel:o.formatMessage(y.chooseDateMonthlyLabel),label:o.formatMessage(y.chooseDateMonthlyLabel),value:"monthly"},rightItem:{className:"rounded-md",ariaLabel:o.formatMessage(y.chooseDateWeeklyLabel),label:o.formatMessage(y.chooseDateWeeklyLabel),value:"weekly"}}),n==="monthly"?e.jsx(Fe,{referenceDate:i,setReferenceDate:(d,p)=>{l({referenceDate:d}),x.logEvent("Workspace Usage: Export Custom Reference Date Changed",{period:"monthly",change:p})},earliestValidDate:G,latestValidDate:W,motionLayoutId:"workspaceUsage.exportModal.customRange.monthHighlight"}):e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"mb-2 w-full",borderLess:!0,onLeft:()=>{l({referenceDate:R(i,1)}),x.logEvent("Workspace Usage: Export Custom Reference Date Changed",{period:"weekly",change:"subMonth"})},onRight:()=>{l({referenceDate:ge(i,1)}),x.logEvent("Workspace Usage: Export Custom Reference Date Changed",{period:"weekly",change:"addMonth"})},leftDisabled:V(R(i,1),G),rightDisabled:Y(ge(i,1),W),children:C(i,"MMMM y")}),e.jsx(zt,{referenceDate:i,setReferenceDate:d=>l({referenceDate:d})})]})]})})}const zt=({referenceDate:t,setReferenceDate:a})=>{const s=F(t),o=st({start:s,end:ve(t)});return e.jsx("div",{className:"flex flex-col gap-1",children:o.map(n=>{const i=ot(n,t),r=V(n,G)||Y(n,new Date);return e.jsxs("button",{disabled:r,onClick:()=>{a(n),x.logEvent("Workspace Usage: Export Custom Reference Date Changed",{period:"weekly",change:"select"})},className:T("relative h-8 w-full rounded-full",!r&&"hover:bg-token-surface-hover"),children:[i&&e.jsx(Oe.div,{layoutId:"workspaceUsage.exportModal.customRange.weekHighlight.".concat(s.toISOString()),className:"bg-token-main-surface-primary-inverse absolute inset-0 rounded-full",transition:{duration:.15}}),e.jsx("div",{className:T("relative z-10 flex w-full justify-around transition-colors duration-75",i&&"text-token-main-surface-primary delay-75",!i&&"text-token-text-primary delay-0"),children:We({start:n,end:ue(n)}).map(l=>e.jsx("div",{className:T("w-0 grow",{"text-token-text-quaternary":!ye(l,t)||Y(l,new Date)||V(l,G)}),children:C(l,"d")},l.toISOString()))})]},n.toISOString())})})};function qt(t){const a=new Date;return t==="thisWeek"||t==="lastWeek"?{period:"weekly",period_start:D(ce(t==="thisWeek"?a:qe(a,1)))}:{period:"monthly",period_start:D(F(t==="thisMonth"?a:R(a,1)))}}const y=B({title:{id:"workspaceUsage.exportModal.title",defaultMessage:"Export data"},dataTypeDropdownLabel:{id:"workspaceUsage.exportModal.dataTypeDropdownLabel",defaultMessage:"Data type"},dataTypeDropdownUsers:{id:"workspaceUsage.exportModal.dataTypeDropdownUsers",defaultMessage:"Users"},dataTypeDropdownGpts:{id:"workspaceUsage.exportModal.dataTypeDropdownGpts",defaultMessage:"GPTs"},dateRangeLabel:{id:"workspaceUsage.exportModal.dateRangeLabel",defaultMessage:"Date range"},thisMonthLabel:{id:"workspaceUsage.exportModal.thisMonthLabel",defaultMessage:"This month ({date})"},lastMonthLabel:{id:"workspaceUsage.exportModal.lastMonthLabel",defaultMessage:"Last month ({date})"},thisWeekLabel:{id:"workspaceUsage.exportModal.thisWeekLabel",defaultMessage:"This week ({date})"},lastWeekLabel:{id:"workspaceUsage.exportModal.lastWeekLabel",defaultMessage:"Last week ({date})"},chooseMonthOrWeekButton:{id:"workspaceUsage.exportModal.chooseMonthOrWeekButton",defaultMessage:"Choose month or week"},customRangeDisplay:{id:"workspaceUsage.exportModal.customRangeDisplay",defaultMessage:"{start} – {end}"},generateCsvButton:{id:"workspaceUsage.exportModal.generateCsvButton",defaultMessage:"Generate CSV"},customRangePeriodToggleAria:{id:"workspaceUsage.exportModal.customRangePeriodToggleAria",defaultMessage:"Date range period choice"},chooseDateMonthlyLabel:{id:"workspaceUsage.exportModal.chooseDateMonthlyLabel",defaultMessage:"Monthly"},chooseDateWeeklyLabel:{id:"workspaceUsage.exportModal.chooseDateWeeklyLabel",defaultMessage:"Weekly"},filename:{id:"workspaceUsage.exportModal.filename",defaultMessage:"{workspaceName} {period} {reportType} report {date}.csv"}});function He({startDate:t,statsSpec:a,data:s,previousData:o}){return e.jsx("div",{className:"border-token-border-default my-6 flex min-h-[80px] w-full rounded-lg border px-2 py-4",children:a.map(({dataKey:n,label:i,helpText:r})=>{const l=s==null?"loading":s[n],d=o==null?"loading":o[n];return e.jsxs("div",{className:"border-token-border-default flex w-0 grow flex-col justify-between border-e px-4 last:me-0 last:border-e-0",children:[e.jsxs("div",{className:"text-token-text-secondary text-sm",children:[e.jsx(u,c({},i)),e.jsx(Re,{}),r&&e.jsx(rt,{label:e.jsx("span",{className:"text-token-main-surface-primary font-normal",children:e.jsx(u,c({},r))}),side:"top",customBackgroundColorClassName:"bg-token-main-surface-primary-inverse",children:e.jsx(nt,{className:"icon-sm inline"})})]}),e.jsx(_t,{value:l,previousValue:d,hideTrend:ye(t,new Date),className:"h-[28px]"})]},n)})})}function Ke({handleSearch:t,clientEventSource:a,className:s}){const n=ee().formatMessage(Wt.filterListInputLabel),i=m.useCallback(it(r=>{t(r),x.logEvent("Workspace Usage: Filter Searched",{queryLength:r.length,trigger:"debouncedTyping",source:a})},250),[]);return e.jsx(lt,{className:T("max-w-[300px]",s),ariaLabel:n,placeholder:n,type:"text",name:"search",icon:dt,iconPosition:"left",saveOnBlur:!0,value:"",onChange:r=>i(r.target.value.trim()),onPressEnter:r=>{var d;const l=(d=r==null?void 0:r.trim())!=null?d:"";t(l),x.logEvent("Workspace Usage: Filter Searched",{queryLength:l.length,trigger:"enterKey",source:a})}})}const Wt=B({filterListInputLabel:{id:"workspaceUsage.filterListInputLabel",defaultMessage:"Search"}}),Le=20,Se=[{cursor:void 0,queryId:void 0}];function $e({getQueryKey:t,loader:a,initialSortDirection:s,spec:o,getData:n,clientEventSource:i}){var te,ae;const[r,l]=m.useState(s),[d,p]=m.useState(Se),[g,j]=m.useState(0),[v,M]=m.useState(),f=Z({queryKey:t({order_by_field:r.metric,order_by_direction:r.direction,cursor:(te=d[g])==null?void 0:te.cursor,query_id:(ae=d[g])==null?void 0:ae.queryId,page_size:Le}),queryFn:({queryKey:h})=>a(h)}),N=f.data?n(f.data):"loading",b=Ct(N),_=N==="loading"&&b.current!=="loading",L=_?b.current:N;m.useEffect(()=>{var h,k;(h=f.data)!=null&&h.next_cursor&&((k=f.data)!=null&&k.query_id)&&d.length===g+1&&p(O=>{var A,S;return[...O,{cursor:(A=f.data)==null?void 0:A.next_cursor,queryId:(S=f.data)==null?void 0:S.query_id}]})},[f.data,d,g]),m.useEffect(()=>{v==null&&f.data&&(f.data.total_count!=null?M(Math.ceil(f.data.total_count/Le)):M(1))},[f.data,d,v]);const J=r.direction==="ASC"?St:Lt;return e.jsxs("div",{className:"mt-4",children:[e.jsxs(X.Root,{className:"border-token-border-medium mb-4 border-b-[0.5px]",children:[e.jsx(X.Header,{children:o.map(({metric:h,label:k,defaultSortDirection:O="ASC"})=>e.jsxs(X.HeaderCell,{className:"text-[13px] font-medium text-nowrap",onClick:()=>{j(0),p(Se),l(A=>{let S;return h===A.metric?S=A.direction==="ASC"?"DESC":"ASC":S=O,x.logEvent("Workspace Usage: Table Sort Clicked",{metric:h,direction:S,source:i}),{direction:S,metric:h}})},children:[k,r.metric===h&&e.jsx(J,{className:"icon text-token-icon-secondary ms-1 inline"})]},h))}),e.jsx(X.Body,{children:L&&L!=="loading"&&L.map((h,k)=>e.jsx(X.Row,{children:o.map(({metric:O,render:A},S)=>e.jsx(X.Cell,{className:T(_&&"pt-0 pb-0 [&]:border-0"),divClassName:T("items-center",S>0&&"text-token-text-secondary",!_&&"min-h-[40px]",_&&"h-0 overflow-hidden"),children:A(h[O],h)},O))},k))})]}),N==="loading"&&e.jsx("div",{className:"flex h-[860px] items-center justify-center",children:e.jsx(fe,{})}),N!=="loading"&&N.length===0&&e.jsx("div",{className:"flex h-[100px] items-center justify-center",children:e.jsx(u,c({},Pt.zeroStateMessage))}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(me,{onLeft:()=>{j(h=>{const k=h-1;return x.logEvent("Workspace Usage: Pagination Clicked",{direction:"left",pageIndex:k,source:i}),k})},leftDisabled:g<=0,onRight:()=>{j(h=>{const k=h+1;return x.logEvent("Workspace Usage: Pagination Clicked",{direction:"right",pageIndex:k,source:i}),k})},rightDisabled:d[g+1]==null,children:[g+1,"/",v!=null?v:e.jsx(fe,{})]})})]})}const Pt=B({zeroStateMessage:{id:"workspaceUsage.table.zeroStateMessage",defaultMessage:"No results found"}}),H=(t,{toastId:a="chatgpt.usageAnalytics.defaultErrorToastId",message:s}={})=>Ut(t,{toastId:a,message:s});function Ce(t,a){return Z({queryKey:["workspace-analytics-gizmo-stats",{workspaceId:t,startDate:a}],queryFn:H(({queryKey:[s,o]})=>z.safeGet("/accounts/{account_id}/analytics/gizmo_stats",{parameters:{query:{start_date:o.startDate},path:{account_id:o.workspaceId}}}))})}async function Rt(o){var[t,n]=o,i=n,{workspaceId:a}=i,s=he(i,["workspaceId"]);return z.safeGet("/accounts/{account_id}/analytics/gizmo_list",{parameters:{path:{account_id:a},query:s}})}const Bt={direction:"DESC",metric:"active_users"};function Ft({currentWorkspaceId:t,startDate:a}){const[s,o]=m.useState(""),n=D(a),i=m.useCallback(g=>["workspace-analytics-gizmos-list",c({workspaceId:t,start_date:n,filter_query:s},g)],[n,s,t]),r=Ce(t,n),l=D(R(a,1)),d=Ce(t,l),p=H(Rt);return e.jsxs("div",{className:"mb-8",children:[e.jsx(He,{startDate:a,data:r.data,previousData:d.data,statsSpec:Ht}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(Ke,{className:"grow",handleSearch:o,clientEventSource:"gizmoList"}),e.jsx(P,{as:"link",to:"/admin/gpts",size:"small",color:"secondary",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(u,c({},I.manageGPTs)),e.jsx(Be,{className:"icon-sm"})]})})]}),e.jsx($e,{getQueryKey:i,loader:p,getData:g=>g.gizmos,spec:$t,initialSortDirection:Bt,clientEventSource:"gizmoList"},"".concat(t,".").concat(n,".").concat(s))]})}const I=B({totalGpts:{id:"workspaceUsage.gizmoList.stats.totalGpts",defaultMessage:"Total GPTs"},gptsCreatedThisMonth:{id:"workspaceUsage.gizmoList.stats.gptsCreatedThisMonth",defaultMessage:"GPTs Created This Month"},gptsActive:{id:"workspaceUsage.gizmoList.stats.gptsActive",defaultMessage:"GPTs active"},gptsActiveHelpText:{id:"workspaceUsage.gizmoList.stats.gptsActiveHelpText",defaultMessage:"GPTs that have sent at lease one message during this month"},nameColumnLabel:{id:"workspaceUsage.gizmoList.tableHeader.name",defaultMessage:"Name"},messagesColumnLabel:{id:"workspaceUsage.gizmoList.tableHeader.messages",defaultMessage:"Total Messages"},creatorNameColumnLabel:{id:"workspaceUsage.gizmoList.tableHeader.creatorName",defaultMessage:"Creator Name"},activeUsersColumnLabel:{id:"workspaceUsage.gizmoList.tableHeader.activeUsersColumnLabel",defaultMessage:"Active Users"},draftFlag:{id:"workspaceUsage.gizmoList.draftFlag",defaultMessage:"Draft"},manageGPTs:{id:"workspaceUsage.gizmoList.manageGPTs",defaultMessage:"Manage GPTs"}}),Ht=[{dataKey:"total_gpt_count",label:I.totalGpts},{dataKey:"gpt_created",label:I.gptsCreatedThisMonth},{dataKey:"active_gpt_count",label:I.gptsActive,helpText:I.gptsActiveHelpText}],Kt=new Intl.NumberFormat(void 0,{notation:"compact",maximumSignificantDigits:3});function De(t){return typeof t=="number"?Kt.format(t):null}const $t=[{metric:"gpt_name",label:e.jsx(u,c({},I.nameColumnLabel)),render:(t,{config_type:a})=>e.jsxs("div",{className:"flex grow items-center justify-between",children:[e.jsx("span",{children:t}),a==="draft"&&e.jsx("span",{className:"text-token-text-secondary text-xs",children:e.jsx(u,c({},I.draftFlag))})]})},{label:e.jsx(u,c({},I.creatorNameColumnLabel)),metric:"creator_name",render:t=>t},{metric:"messages",label:e.jsx(u,c({},I.messagesColumnLabel)),render:De,defaultSortDirection:"DESC"},{metric:"active_users",label:e.jsx(u,c({},I.activeUsersColumnLabel)),render:De,defaultSortDirection:"DESC"}];function Qt({startDate:t,setStartDate:a}){return e.jsx(me,{onLeft:()=>{a(s=>{const o=R(s,1);return x.logEvent("Workspace Usage: Month Changed",{direction:"left",startDate:D(o)}),o})},leftDisabled:V(R(t,1),G),onRight:()=>{a(s=>{const o=ge(s,1);return x.logEvent("Workspace Usage: Month Changed",{direction:"right",startDate:D(o)}),o})},rightDisabled:Y(ge(t,1),W),surpressChildrenWrapper:!0,children:e.jsx(Vt,{startDate:t,setStartDate:a})})}function Vt({startDate:t,setStartDate:a}){return e.jsx(Pe,{triggerButton:e.jsx(P,{size:"small",color:"secondary",className:"rounded-none border-x-0 border-e-0 px-1",children:C(t,"MMM y")}),children:e.jsx("div",{className:"w-[210px] p-1 text-xs",children:e.jsx(Fe,{referenceDate:t,setReferenceDate:(s,o)=>{const n=F(Y(s,W)?W:V(s,G)?G:s);a(n),x.logEvent("Workspace Usage: Month Changed",{direction:o,startDate:D(n)})},earliestValidDate:G,latestValidDate:W,motionLayoutId:"workspaceUsage.monthSelector.monthHighlight"})})})}var xe,Ne;function Yt(){if(Ne)return xe;Ne=1;var t=ct(),a=ut(),s=a(function(o,n,i){t(o,i,n)});return xe=s,xe}var Zt=Yt();const Jt=Ze(Zt);async function Xt({queryKey:[t,{workspaceId:a,startDate:s}]}){return z.safeGet("/accounts/{account_id}/analytics/overview",{parameters:{path:{account_id:a},query:{start_date:s}}})}function ea(t,a){return Z({queryKey:["workspace-analytics-overview",{workspaceId:t,startDate:a}],queryFn:H(Xt)})}async function ta({queryKey:[t,{workspaceId:a,startDate:s}]}){return z.safeGet("/accounts/{account_id}/analytics/gizmo_overview",{parameters:{path:{account_id:a},query:{start_date:s}}})}function aa(t,a){return Z({queryKey:["workspace-analytics-gizmo-overview",{workspaceId:t,startDate:a}],queryFn:H(ta)})}function sa(t,a){return Z({queryKey:["workspace-analytics-tool-overview",{workspaceId:t,startDate:a}],queryFn:H(({queryKey:[s,o]})=>z.safeGet("/accounts/{account_id}/analytics/tool_overview",{parameters:{query:{start_date:o.startDate},path:{account_id:o.workspaceId}}}))})}function le(t,a,s){return m.useMemo(()=>{if(!a)return;const o=Jt(a,"date");return We({start:t,end:ve(t)}).map(n=>{var l;const i=D(n),r=o[i];return r&&r.total>0?{date:r.date,total:r.total,values:(l=r[s])!=null?l:{}}:{date:i,blank:0}})},[t,a,s])}function oa(t,a){var b,_,L,J,te,ae,h,k,O,A,S,Me;const s=D(a),o=ea(t,s),n=m.useMemo(()=>{var w,q;return(q=(w=o.data)==null?void 0:w.active_user_data)==null?void 0:q.daily_data.map(({date:pe,active_users:oe})=>({date:pe,total:oe,values:{active_users:oe}}))},[(_=(b=o.data)==null?void 0:b.active_user_data)==null?void 0:_.daily_data]),i=le(a,n,"values"),r=le(a,(J=(L=o.data)==null?void 0:L.messages_data)==null?void 0:J.daily_data,"messages_by_model"),l=aa(t,s),d=le(a,(te=l.data)==null?void 0:te.daily_gizmo_messages_data,"messages_by_gpt"),p=sa(t,s),g=le(a,(ae=p.data)==null?void 0:ae.daily_tool_messages_data,"messages_by_tool"),j=ee(),v=m.useMemo(()=>{var w;return i&&((w=o.data)!=null&&w.active_user_data)?{data:i,metrics:{active_users:{displayName:j.formatMessage(ra.activeUsers)}},monthOverMonth:o.data.active_user_data.month_to_month_data}:"loading"},[i,j,(h=o.data)==null?void 0:h.active_user_data]),M=m.useMemo(()=>{var w;return r&&((w=o.data)!=null&&w.messages_data)?{data:r,metrics:Ee(o.data.messages_data.models),monthOverMonth:o.data.messages_data.month_to_month_data}:"loading"},[r,(k=o.data)==null?void 0:k.messages_data]),f=m.useMemo(()=>{var w,q;return d&&((w=l.data)!=null&&w.metrics)&&((q=l.data)!=null&&q.month_to_month_data)?{data:d,metrics:Object.fromEntries(Object.entries(l.data.metrics).map(([pe,oe])=>[pe,{displayName:oe}])),monthOverMonth:l.data.month_to_month_data}:"loading"},[d,(O=l.data)==null?void 0:O.metrics,(A=l.data)==null?void 0:A.month_to_month_data]),N=m.useMemo(()=>{var w,q;return g&&((w=p.data)!=null&&w.tool_list)&&((q=p.data)!=null&&q.month_to_month_data)?{data:g,metrics:Ee(p.data.tool_list),monthOverMonth:p.data.month_to_month_data}:"loading"},[g,(S=p.data)==null?void 0:S.month_to_month_data,(Me=p.data)==null?void 0:Me.tool_list]);return{dailyActiveUsers:v,dailyMessages:M,dailyGizmoMessages:f,dailyToolMessages:N}}function Ee(t){return Object.entries(t).sort(([,a],[,s])=>a-s).reduce((a,[s,o])=>(o>0&&(a[s]={displayName:s,total:o}),a),{})}const ra=B({activeUsers:{id:"workspaceUsage.activeUsersMetric",defaultMessage:"Active users"}});function na({currentWorkspaceId:t,startDate:a}){const s=ee(),o=oa(t,a),n=!gt(a,F(new Date));return e.jsxs("div",{className:"mt-10",children:[e.jsx(ie,{title:$.activeUsersChartTitle,data:o.dailyActiveUsers,displayMoM:n,clientEventSource:"activeUsers",hideLegend:!0}),e.jsx(ie,{title:$.messagesChartTitle,data:o.dailyMessages,otherGroupLabel:s.formatMessage($.otherModels),displayMoM:n,clientEventSource:"totalMessages"}),e.jsx(ie,{title:$.gptMessagesChartTitle,data:o.dailyGizmoMessages,otherGroupLabel:s.formatMessage($.otherGizmos),displayMoM:n,clientEventSource:"gizmoMessages"}),e.jsx(ie,{title:$.toolMessagesChartTitle,data:o.dailyToolMessages,otherGroupLabel:s.formatMessage($.otherTools),displayMoM:n,clientEventSource:"toolMessages"})]})}const $=B({activeUsersChartTitle:{id:"workspaceUsage.overview.activeUsersChartTitle",defaultMessage:"Unique active users"},messagesChartTitle:{id:"workspaceUsage.overview.messagesChartTitle",defaultMessage:"Total messages sent"},gptMessagesChartTitle:{id:"workspaceUsage.overview.gptMessagesChartTitle",defaultMessage:"GPT messages sent"},toolMessagesChartTitle:{id:"workspaceUsage.overview.toolMessagesChartTitle",defaultMessage:"Tool messages received"},otherModels:{id:"workspaceUsage.overview.otherModels",defaultMessage:"Other models"},otherGizmos:{id:"workspaceUsage.overview.otherGizmos",defaultMessage:"Other GPTs"},otherTools:{id:"workspaceUsage.overview.otherTools",defaultMessage:"Other Tools"}});function Ae(t,a){return Z({queryKey:["workspace-analytics-user-stats",{workspaceId:t,startDate:a}],queryFn:H(({queryKey:[s,o]})=>z.safeGet("/accounts/{account_id}/analytics/user_stats",{parameters:{query:{start_date:o.startDate},path:{account_id:o.workspaceId}}}))})}async function ia(o){var[t,n]=o,i=n,{workspaceId:a}=i,s=he(i,["workspaceId"]);return z.safeGet("/accounts/{account_id}/analytics/user_list",{parameters:{path:{account_id:a},query:s}})}const la={direction:"DESC",metric:"messages"};function da({currentWorkspaceId:t,startDate:a}){const[s,o]=m.useState(""),n=mt(),i=pt(n,"2861925050"),r=m.useMemo(()=>i?[...Ie,{label:e.jsx(u,c({},U.creditsUsedColumnLabel)),metric:"credits_used",render:de,defaultSortDirection:"DESC"}]:Ie,[i]),l=D(a),d=m.useCallback(M=>["workspace-analytics-users-list",c({workspaceId:t,start_date:l,filter_query:s},M)],[l,s,t]),p=Ae(t,l),g=D(R(a,1)),j=Ae(t,g),v=H(ia);return e.jsxs("div",{className:"mb-8",children:[e.jsx(He,{startDate:a,data:p.data,previousData:j.data,statsSpec:ca}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(Ke,{className:"grow",handleSearch:o,clientEventSource:"userList"}),e.jsx(P,{as:"link",to:"/admin",size:"small",color:"secondary",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(u,c({},U.manageUsersLink)),e.jsx(Be,{className:"icon-sm"})]})})]}),e.jsx($e,{getQueryKey:d,loader:v,getData:M=>M.users,spec:r,initialSortDirection:la,clientEventSource:"userList"},"".concat(t,".").concat(l,".").concat(s))]})}const U=B({purchasedSeats:{id:"workspaceUsage.userList.stats.purchasedSeats",defaultMessage:"Seats purchased"},claimedSeats:{id:"workspaceUsage.userList.stats.claimedSeats",defaultMessage:"Seats enabled"},claimedSeatsHelpText:{id:"workspaceUsage.userList.stats.claimedSeatsHelpText",defaultMessage:"Users who have accepted their invite and logged in"},activeUsers:{id:"workspaceUsage.userList.stats.activeUsers",defaultMessage:"Active users"},activeUsersHelpText:{id:"workspaceUsage.userList.stats.activeUsersHelpText",defaultMessage:"Users who have sent at least one message during this time period"},pendingInvites:{id:"workspaceUsage.userList.stats.pendingInvites",defaultMessage:"Pending invites"},nameColumnLabel:{id:"workspaceUsage.userList.tableHeader.name",defaultMessage:"Name"},emailColumnLabel:{id:"workspaceUsage.userList.tableHeader.email",defaultMessage:"Email"},messagesColumnLabel:{id:"workspaceUsage.userList.tableHeader.messages",defaultMessage:"Total Messages"},gptMessagesColumnLabel:{id:"workspaceUsage.userList.tableHeader.gptMessages",defaultMessage:"GPT Messages"},toolMessagesColumnLabel:{id:"workspaceUsage.userList.tableHeader.toolMessages",defaultMessage:"Tool Messages"},creditsUsedColumnLabel:{id:"workspaceUsage.userList.tableHeader.creditsUsed",defaultMessage:"Credits Used"},manageUsersLink:{id:"workspaceUsage.userList.tableHeader.manageUsersLink",defaultMessage:"Manage users"}}),ca=[{dataKey:"purchased_seats",label:U.purchasedSeats},{dataKey:"claimed_seat",label:U.claimedSeats,helpText:U.claimedSeatsHelpText},{dataKey:"active_users",label:U.activeUsers,helpText:U.activeUsersHelpText},{dataKey:"pending_invites",label:U.pendingInvites}],ua=new Intl.NumberFormat(void 0,{notation:"compact",maximumSignificantDigits:3});function de(t){return typeof t=="number"?ua.format(t):null}const Ie=[{metric:"name",label:e.jsx(u,c({},U.nameColumnLabel)),render:t=>t},{metric:"email",label:e.jsx(u,c({},U.emailColumnLabel)),render:t=>t},{metric:"messages",label:e.jsx(u,c({},U.messagesColumnLabel)),render:de,defaultSortDirection:"DESC"},{label:e.jsx(u,c({},U.gptMessagesColumnLabel)),metric:"gpt_messages",render:de,defaultSortDirection:"DESC"},{label:e.jsx(u,c({},U.toolMessagesColumnLabel)),metric:"tool_messages",render:de,defaultSortDirection:"DESC"}];function ga(t){return Object.keys(t)}var Ge;const ma=ht.div(Ge||(Ge=Ue(["flex space-x-4"]))),Qe={overviewTab:na,usersTab:da,gptsTab:Ft};function pa(t){return Z({queryKey:["workspace-analytics-last-updated",{workspaceId:t}],queryFn:H(({queryKey:[a,s]})=>z.safeGet("/accounts/{account_id}/analytics/last_updated_time",{parameters:{path:{account_id:s.workspaceId}}}))})}const ha=ga(Qe);function xa({currentWorkspaceId:t,startDate:a,setStartDate:s,currentTab:o,setTab:n}){const i=pa(t),[r,l]=m.useState(!1);return e.jsx(Nt,{title:e.jsx(u,c({},Q.title)),actions:e.jsxs(e.Fragment,{children:[e.jsx(Qt,{startDate:a,setStartDate:s}),e.jsx(P,{className:"ms-2",color:"secondary",size:"small",onClick:()=>{l(!0),x.logEvent("Workspace Usage: Export Modal Opened")},children:e.jsx(u,c({},Q.exportButton))}),r&&e.jsx(Gt,{currentWorkspaceId:t,currentTab:o,onClose:()=>l(!1)})]}),tabsHeader:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ma,{children:ha.map(d=>e.jsx("a",{className:T("pb-2",o===d?"border-token-text-secondary text-token-text-primary border-b font-medium":"text-token-text-tertiary cursor-pointer font-normal"),onClick:()=>{n(d),x.logEvent("Workspace Usage: Tab Clicked",{tab:d})},children:e.jsx(u,c({},Q[d]))},d))}),e.jsxs("div",{className:"text-token-text-tertiary flex items-center gap-1 text-xs",children:[i.data?e.jsxs("span",{children:[e.jsx(u,c({},Q.dataLastUpdatedLabel)),e.jsx(Re,{}),i.data.last_updated_time?C(new Date(i.data.last_updated_time),"MMM d, yyyy"):e.jsx(u,c({},Q.dataLastUpdatedUnknown))]}):e.jsx(fe,{}),"·",e.jsx(xt,{href:"https://help.openai.com/en/articles/10875114-user-analytics-for-chatgpt-enterprise",className:"hover:text-token-link-hover underline",children:e.jsx(u,c({},Q.helpCenterLinkText))})]})]})})}function fa({currentWorkspaceId:t}){const a=ee(),[s,o]=m.useState("overviewTab"),[n,i]=m.useState(F(new Date)),r=Qe[s];return m.useEffect(()=>{x.logPageView(),x.logEvent("Workspace Usage: Page Viewed")},[]),e.jsxs(e.Fragment,{children:[e.jsx(bt,{children:e.jsx("title",{children:a.formatMessage(Q.title)})}),e.jsx(xa,{currentWorkspaceId:t,startDate:n,setStartDate:i,currentTab:s,setTab:o}),e.jsx(Dt,{children:e.jsx(r,{currentWorkspaceId:t,startDate:n})})]})}const Q=B({title:{id:"workspaceUsage.title",defaultMessage:"User Analytics"},overviewTab:{id:"workspaceUsage.overviewTab",defaultMessage:"Overview"},usersTab:{id:"workspaceUsage.usersTab",defaultMessage:"Users"},gptsTab:{id:"workspaceUsage.gptsTab",defaultMessage:"GPTs"},creditsTab:{id:"workspaceUsage.creditsTab",defaultMessage:"Credits"},exportButton:{id:"workspaceUsage.exportButton",defaultMessage:"Export..."},dataLastUpdatedLabel:{id:"workspaceUsage.dataLastUpdatedLabel",defaultMessage:"Data updated"},dataLastUpdatedUnknown:{id:"workspaceUsage.dataLastUpdatedUnknown",defaultMessage:"Unknown"},helpCenterLinkText:{id:"workspaceUsage.helpCenterLinkText",defaultMessage:"Learn more about analytics"}}),es=Je(function(){const a=Et();return At(),e.jsx(fa,c({},a))});export{es as default};
//# sourceMappingURL=jqk4g0fjcxvzvdyx.js.map
