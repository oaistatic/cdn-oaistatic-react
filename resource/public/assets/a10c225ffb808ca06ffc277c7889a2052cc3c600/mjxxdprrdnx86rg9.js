var _=Object.freeze,U=Object.defineProperty;var D=(t,o)=>_(U(t,"raw",{value:_(o||t.slice())}));import{b as q,u as B,r as j,f as O,j as e,M as u,a as W}from"./jj85rqzpbnvv3emr.js";import{bQ as K,bR as H,bS as V,bT as A,be as Z,bU as J,bV as X,bW as Y}from"./mclphevd122040jw.js";import{i as $,r as z,P as T,C as ee,B as se,F as re,f as te,R as I,T as ae,eE as p}from"./lef5ym39glv4981l.js";import{M as ne,R as oe,t as ie}from"./blsgly9vru5i7r8m.js";import{T as f}from"./i5991cad8s41d2db.js";function le({gizmo:t,memory:o}){var M;const a=q(),m=te(),c=B(),{mutate:s,isPending:l}=W({mutationFn:async y=>{const{success:d}=await I.safeDelete("/memories/{memory_id}",{parameters:{path:{memory_id:y}},requestBody:{gizmo_id:t==null?void 0:t.id}});if(!d)throw new Error("An error occurred while deleting the memory")},onSettled:()=>{c.invalidateQueries({queryKey:A(t==null?void 0:t.id)})},onError:()=>{m.danger({id:"MemoriesModal.deleteFailed",defaultMessage:"Failed to forget memory",description:"Toast message when deleting memory fails"},{id:"memoryDeleteFailed",toastId:"memory_delete_failed"})}}),[b,n]=j.useState(!1),x=a.formatMessage({id:"N0czuB",defaultMessage:"Remove"});return e.jsxs(e.Fragment,{children:[e.jsxs(f.Row,{disabled:l,children:[e.jsx(f.Cell,{children:e.jsx("div",{className:"py-2 whitespace-pre-wrap",children:o.content})}),e.jsx(f.Cell,{textAlign:"right",children:e.jsx(f.Actions,{children:e.jsx("button",{onClick:()=>{T.logEvent("Memory Manage Modal Memory Delete Clicked"),n(!0)},"aria-label":x,className:"text-token-text-tertiary hover:text-token-text-secondary",children:e.jsx(ae,{className:"leading-none",label:x,side:"top",children:e.jsx(Z,{className:"icon-sm"})})})})})]}),b&&e.jsx(J,{isOpen:!0,primaryButtonColor:"danger",title:x,confirmText:a.formatMessage({id:"fCn0ar",defaultMessage:"Forget"}),onConfirm:()=>{T.logEvent("Memory Manage Modal Memory Delete Confirmed"),s(o.id),n(!1)},onClose:()=>{n(!1)},children:e.jsx(u,{id:"j2cZHW",defaultMessage:'Remove "{title}" from {name}’s saved memories. This can’t be undone. <link>Learn more</link>',values:{name:(M=t==null?void 0:t.name)!=null?M:"ChatGPT",title:e.jsx("strong",{children:ie(o.content,{length:130,omission:"..."})}),link:y=>e.jsx("a",{href:"https://help.openai.com/en/articles/8590148-memory-faq",target:"_blank",className:"underline",rel:"noreferrer",children:y})}})})]})}function de({selectedGizmoId:t,onSelect:o,items:a}){const m=a.find(s=>s.id===t);function c(s){var l;return e.jsx(Y,{isFirstParty:s.id===void 0,src:(l=s.iconUrl)!=null?l:null,className:"icon"})}return e.jsx("div",{className:"border-token-border-medium mb-2 inline-flex rounded-md border",children:e.jsxs(p.Root,{children:[e.jsx(p.Trigger,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[m?e.jsxs(e.Fragment,{children:[c(m),e.jsx("span",{className:"text-token-text-primary",children:m.name})]}):e.jsx(u,{id:"MemoriesModal.unknownGizmo",defaultMessage:"Unknown GPT"}),e.jsx(X,{className:"icon-sm text-token-text-tertiary"})]})}),e.jsx(p.Portal,{children:e.jsx(p.Content,{children:a.map(s=>e.jsxs(p.Item,{className:"flex items-center gap-3",onClick:()=>{o(s.id)},children:[c(s),s.name]},s.id))})})]})})}var L;const N=re.div(L||(L=D(["flex h-full items-center justify-center pb-8 text-sm text-token-text-tertiary rounded-lg border border-token-border-default"])));function Me({onClose:t,initialGizmoId:o}){var F,S,E,R;const a=q(),m=B(),c=K(),[s,l]=j.useState(o),b=$(),n=z(b),x=n==null?void 0:n.hasPlusFeatures(),M=H(),y=(F=n==null?void 0:n.hasPaidFeatures())!=null?F:!1;j.useEffect(()=>{T.logEvent("Memory Modal Shown")},[]);const{data:d,isLoading:v,isError:k,refetch:P}=V(s,!0,c),h=d==null?void 0:d.memories,{data:w,refetch:Q}=O({queryKey:["memory_gizmos"],queryFn:()=>I.safeGet("/memories/gizmos"),refetchOnMount:"always"}),C=[{id:void 0,name:"ChatGPT",iconUrl:null},...(S=w==null?void 0:w.items.map(({gizmo:r})=>{var G;return{id:r.id,name:r.display.name,iconUrl:(G=r.display.profile_picture_url)!=null?G:null}}))!=null?S:[]],i=C.find(r=>r.id===s);j.useEffect(()=>{!v&&!k&&s!==void 0&&(!h||h.length===0)&&l(void 0)},[v,k,h,s]);let g;return v?g=e.jsx(N,{children:e.jsx(u,{id:"MemoriesModal.loading",defaultMessage:"Loading..."})}):k?g=e.jsx(N,{children:e.jsxs("div",{className:"max-w-sm text-center",children:[e.jsx("div",{className:"mb-4 text-red-500",children:e.jsx(u,{id:"MemoriesModal.somethingWentWrong",defaultMessage:"Something went wrong..."})}),e.jsx("div",{children:e.jsx(se,{color:"secondary",onClick:()=>{P()},children:e.jsx(u,{id:"MemoriesModal.retry",defaultMessage:"Retry"})})})]})}):!h||h.length===0?g=e.jsx(N,{children:e.jsx("div",{className:"max-w-sm text-center",children:c?e.jsx(u,{id:"MemoriesModal.noMemories.1",defaultMessage:"As you chat with {name}, the details and preferences it saves will be shown here.",values:{name:(E=i==null?void 0:i.name)!=null?E:"ChatGPT"}}):e.jsx(u,{id:"MemoriesModal.noMemoriesAndDisabled",defaultMessage:"Memory is disabled. ChatGPT won't use or save memories."})})}):g=e.jsx(f.Root,{className:"h-full",size:"compact",bordered:!0,children:e.jsx(f.Body,{children:h.map(r=>e.jsx(le,{gizmo:i?{id:i.id,name:i.name}:void 0,memory:r},r.id))})}),e.jsxs(ee,{testId:"modal-memories",isOpen:!0,onClose:t,size:"custom",className:"max-w-5xl",type:"success",title:a.formatMessage({id:"MemoriesModal.title",defaultMessage:"Saved memories"}),description:e.jsx("div",{className:"text-token-text-secondary",children:M&&y?a.formatMessage({id:"MemoriesModal.description",defaultMessage:"ChatGPT tries to remember most of your chats, but it may forget things over time. Saved memories are never forgotten. <link>Learn more</link>"},{link:r=>e.jsx("a",{href:"https://help.openai.com/en/articles/8983136-what-is-memory",target:"_blank",rel:"noopener noreferrer",className:"underline",children:r})}):M?a.formatMessage({id:"MemoriesModal.description.freeMoonshine",defaultMessage:"ChatGPT tries to remember your recent chats, but it may forget things over time. Saved memories are never forgotten. <link>Learn more</link>"},{link:r=>e.jsx("a",{href:"https://help.openai.com/en/articles/8983136-what-is-memory",target:"_blank",rel:"noopener noreferrer",className:"underline",children:r})}):a.formatMessage({id:"MemoriesModalFree.description",defaultMessage:"ChatGPT remembers useful details about you and your preferences so it can be more helpful. <link>Learn more</link>"},{link:r=>e.jsx("a",{href:"https://help.openai.com/en/articles/8983136-what-is-memory",target:"_blank",rel:"noopener noreferrer",className:"underline",children:r})})}),showCloseButton:!0,children:[x&&C.length>1&&e.jsx("div",{className:"mb-4",children:e.jsx(de,{selectedGizmoId:s,items:C,onSelect:r=>{m.invalidateQueries({queryKey:A(r)}),l(r)}})}),e.jsx(ne,{memoryFullPct:d==null?void 0:d.memoryFullPct,className:"mb-5"}),e.jsx("div",{className:"h-[24rem]",children:g}),e.jsx("div",{className:"mt-5 flex justify-end",children:e.jsx(oe,{onReset:()=>{P(),Q(),s&&l(void 0)},gizmoId:s,memoryName:(R=i==null?void 0:i.name)!=null?R:"ChatGPT"})})]})}export{Me as default};
//# sourceMappingURL=mjxxdprrdnx86rg9.js.map
