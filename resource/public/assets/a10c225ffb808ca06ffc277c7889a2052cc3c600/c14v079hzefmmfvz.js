import{b as D,u as ae,g as I,a as L,j as e,M as n,ad as te,ak as se,r as F,x as ne,G as ie}from"./jj85rqzpbnvv3emr.js";import{f as $,C as z,bw as M,e as re,oM as oe,b as le,aE as me,i as de,j as p,E as ce,T as E,B as x,kK as ue}from"./lef5ym39glv4981l.js";import{dQ as ge,F as he}from"./mclphevd122040jw.js";import{W as fe}from"./i5w9a1ap4yrxpqjj.js";import{m as v,W as V,r as pe,i as xe,d as ve,c as Me}from"./ef92qx749w9klz4o.js";import{R as we,I as W,S as je}from"./i2fx1o9afvn04cvf.js";import{u as be}from"./iv7wsx4h3mnmu7bd.js";import{E as Ee}from"./iie09zeu4q9g9ba8.js";import{P as De,a as Pe}from"./lptwpbjabrvjmhsj.js";import"./hqbuxjfjvu1puiaw.js";import"./jxokrjy8ycftw0wv.js";import"./jk4cx3iywxazx01l.js";import"./hc8beflnn681x6ow.js";import"./mw2u7timj0qnsnvj.js";import"./dvqe6kc43fkjsavv.js";import"./nk7ydxm8ptxusvbt.js";import"./k059n59kmbyb9lsl.js";import"./ojb4d4bxj44fs0l8.js";import"./oz589d7sqtxcbljf.js";import"./kxedrjbxv2qblujd.js";import"./hxd0yong6zdu9u3r.js";function _e({environmentId:s,onClose:t}){const i=D(),m=$(),d=ae(),c=I(),g=v(u=>u.setEnvironmentId),w=v(u=>u.setBranch),{mutate:a,isPending:j}=L({mutationFn:()=>V.deleteEnvironment(s),onSuccess:async()=>{pe(d,s),await xe(d),v.getState().environmentId===s&&(g(null),w(null)),m.success(i.formatMessage({id:"wham.deleteEnvironmentModal.environmentDeletedSuccessfully",defaultMessage:"Environment deleted successfully"})),t(),c("/codex/settings/environments")},onError:()=>{m.danger(i.formatMessage({id:"wham.deleteEnvironmentModal.failedToDeleteEnvironment",defaultMessage:"Failed to delete environment"}))}});return e.jsx(z,{testId:"modal-wham-delete-environment",isOpen:!0,type:"danger",title:e.jsx(n,{id:"wham.deleteEnvironmentModal.title",defaultMessage:"Delete environment"}),onClose:t,primaryButton:e.jsx(M.Button,{title:i.formatMessage({id:"wham.deleteEnvironmentModal.delete",defaultMessage:"Delete"}),color:"danger",loading:j,onClick:()=>{a()}}),secondaryButton:e.jsx(M.Button,{title:i.formatMessage({id:"wham.deleteEnvironmentModal.cancel",defaultMessage:"Cancel"}),color:"secondary",onClick:t}),children:e.jsx("div",{className:"text-sm",children:e.jsx(n,{id:"wham.deleteEnvironmentModal.message",defaultMessage:"Tasks that use it will remain, but users wonâ€™t be able to create follow-up tasks."})})})}function r({label:s,children:t,className:i}){return e.jsxs("div",{className:re("flex flex-col gap-1",i),children:[e.jsx("dt",{className:"text-token-text-primary text-sm font-medium",children:s}),e.jsx("dd",{className:"text-token-text-primary text-sm font-normal",children:t})]})}function Ne({environmentId:s,onClose:t}){const i=D(),m=$(),{mutate:d,isPending:c}=L({mutationFn:()=>V.invalidateEnvironmentCache(s),onSuccess:()=>{m.success(i.formatMessage({id:"wham.resetCacheModal.cacheResetSuccessfully",defaultMessage:"Cache reset successfully"})),t()},onError:()=>{m.danger(i.formatMessage({id:"wham.resetCacheModal.failedToResetCache",defaultMessage:"Failed to reset cache"}))}});return e.jsx(z,{testId:"modal-wham-delete-environment",isOpen:!0,type:"danger",title:e.jsx(n,{id:"wham.resetEnvironmentCacheModal.title",defaultMessage:"Reset cache"}),onClose:t,primaryButton:e.jsx(M.Button,{title:i.formatMessage({id:"wham.resetEnvironmentCacheModal.delete",defaultMessage:"Reset"}),color:"danger",loading:c,onClick:()=>{d()}}),secondaryButton:e.jsx(M.Button,{title:i.formatMessage({id:"wham.resetEnvironmentCacheModal.cancel",defaultMessage:"Cancel"}),color:"secondary",onClick:t}),children:e.jsx("div",{className:"text-sm",children:e.jsx(n,{id:"wham.resetEnvironmentCacheModal.message",defaultMessage:"All currently cached containers will be invalidated. The cache will be cleared for all users."})})})}function ye(){const{environmentId:s}=te(),{eligible:t}=ge();return t?e.jsx(se,{to:"/codex"}):s?e.jsx(Ce,{environmentId:s}):e.jsx(oe,{})}function Se(s){return s==null||s.setup==null?!1:Array.isArray(s.setup)?s.setup.length>0&&s.setup.every(t=>t!==""):s.setup!==""}function Ce({environmentId:s}){var _,N,y,S,C,k,A,O,B,R;const t=D(),i=I(),[m,d]=F.useState(!1),[c,g]=F.useState(!1),w=v(l=>l.setEnvironmentId),{data:a,isLoading:j,isError:u}=ve(s),P=le(),o=me(),h=de(),q=!!(P&&a&&a.creator.email===P.email),G=!!(o!=null&&o.isOwnerOfAccount())||!!(o!=null&&o.isAdminOfAccount()),f=q||G,Q=be(),b=o==null?void 0:o.name,U=b!=null?b:t.formatMessage({id:"wham.environmentDetailsPage.workspace",defaultMessage:"Workspace"}),X=p(h,"2134057841"),H=p(h,"1535847699"),K=p(h,"3899518838"),Z=p(h,"838019241"),J=!Se(a)&&(a==null?void 0:a.auto_setup_settings)==null,Y=(N=(_=a==null?void 0:a.auto_setup_settings)==null?void 0:_.use_auto_setup)!=null?N:J;return e.jsxs(fe,{topPadding:!0,showSidebar:!1,children:[e.jsx("div",{className:"flex flex-col px-8 md:px-16",children:j?e.jsx("div",{className:"flex h-full items-center justify-center",children:e.jsx(ce,{})}):u?e.jsx(Ee,{title:t.formatMessage({id:"wham.environmentDetailsPage.errorLoadingEnvironment",defaultMessage:"Error loading environment"}),description:t.formatMessage({id:"wham.environmentDetailsPage.errorLoadingEnvironmentDescription",defaultMessage:"Error loading environment description"})}):a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-token-border-default flex flex-col justify-between gap-2 border-b pb-4",children:e.jsxs("div",{className:"flex flex-row items-center justify-between",children:[e.jsxs(we,{children:[e.jsx(W,{label:t.formatMessage({id:"wham.environmentDetailsPage.environments",defaultMessage:"Environments"}),url:"/codex/settings/environments",className:"text-token-text-tertiary"}),e.jsx(je,{}),e.jsx(W,{label:a.label,url:"/codex/settings/environment/".concat(s),className:"text-token-text-primary font-medium"})]}),e.jsxs("div",{className:"flex flex-row gap-2",children:[e.jsx(E,{label:f?void 0:t.formatMessage({id:"wham.environmentDetailsPage.deleteEnvironmentTooltip",defaultMessage:"Only the creator of the environment or an admin can delete an environment"}),children:e.jsx(x,{color:"danger-outline",onClick:()=>d(!0),disabled:!f,"aria-label":t.formatMessage({id:"wham.environmentDetailsPage.deleteEnvironmentAriaLabel",defaultMessage:"Button to delete {environmentName}"},{environmentName:a.label}),children:e.jsx(n,{id:"wham.environmentDetailsPage.deleteEnvironment",defaultMessage:"Delete"})})}),e.jsx(E,{label:f?void 0:t.formatMessage({id:"wham.environmentDetailsPage.editEnvironmentTooltip",defaultMessage:"Only the creator of the environment or an admin can edit an environment"}),children:e.jsx(x,{icon:he,onClick:()=>{i("/codex/settings/environment/".concat(s,"/edit"))},color:"secondary",disabled:!f,"aria-label":t.formatMessage({id:"wham.environmentDetailsPage.editEnvironmentAriaLabel",defaultMessage:"Button to edit {environmentName}"},{environmentName:a.label}),children:e.jsx(n,{id:"wham.environmentDetailsPage.editEnvironment",defaultMessage:"Edit"})})}),e.jsx(x,{size:"small",color:"secondary",onClick:()=>{w(s),Me.recordClickEnv(),i("/codex")},"aria-label":t.formatMessage({id:"wham.environmentDetailsPage.useEnvironmentAriaLabel",defaultMessage:"Button to use environment {environmentName} in a codex task"},{environmentName:a.label}),children:e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx(n,{id:"wham.turnInfoRow.useEnvironment",defaultMessage:"Use this"}),e.jsx(ue,{className:"icon-sm"})]})})]})]})}),e.jsx("div",{className:"text-token-text-primary py-8 text-xl",children:a.label}),e.jsxs("div",{className:"grid gap-x-12 gap-y-6 md:grid-cols-2",children:[e.jsx(r,{label:t.formatMessage({id:"wham.environmentDetailsPage.creator",defaultMessage:"Creator"}),children:a.creator.email}),e.jsx(r,{label:t.formatMessage({id:"wham.environmentDetailsPage.image",defaultMessage:"Image"}),children:a.machine.label||e.jsx(n,{id:"wham.environmentDetailsPage.noImage",defaultMessage:"No image"})}),e.jsx(r,{label:t.formatMessage({id:"wham.environmentDetailsPage.description",defaultMessage:"Description"}),children:(y=a.description)!=null?y:e.jsx(n,{id:"wham.environmentDetailsPage.noDescription",defaultMessage:"N/A"})}),X&&e.jsx(r,{label:t.formatMessage({id:"wham.environmentDetailsPage.agentNetworkAccess",defaultMessage:"Agent internet access"}),children:((S=a.agent_network_access)==null?void 0:S.mode)==="on"?a.agent_network_access.preset_allowlist===De?e.jsx(n,{id:"wham.environmentDetailsPage.agentNetworkAccess.unrestricted",defaultMessage:"On: unrestricted"}):a.agent_network_access.preset_allowlist===Pe?e.jsx(n,{id:"wham.environmentDetailsPage.agentNetworkAccess.codex",defaultMessage:"On: common dependencies"}):e.jsx(n,{id:"wham.environmentDetailsPage.agentNetworkAccess.custom",defaultMessage:"On: custom domains"}):a.agent_network_access==null||a.agent_network_access.mode==="off"?e.jsx(n,{id:"wham.environmentDetailsPage.agentNetworkAccess.off",defaultMessage:"Off"}):null}),K&&e.jsxs(e.Fragment,{children:[e.jsx(r,{label:t.formatMessage({id:"wham.environmentDetailsPage.postSetupCaching",defaultMessage:"Post setup caching"}),children:e.jsxs("div",{className:"flex items-center gap-2",children:[((C=a.cache_settings)==null?void 0:C.post_setup_cache_enabled)===!0?e.jsx(n,{id:"wham.environmentDetailsPage.postSetupCaching.on",defaultMessage:"On"}):e.jsx(n,{id:"wham.environmentDetailsPage.postSetupCaching.off",defaultMessage:"Off"}),((k=a.cache_settings)==null?void 0:k.post_setup_cache_enabled)&&e.jsx(E,{label:t.formatMessage({id:"wham.environmentDetailsPage.resetCacheTooltip",defaultMessage:"Invalidate any currently cached containers"}),children:e.jsx(x,{size:"small",onClick:()=>g(!0),color:"secondary","aria-label":t.formatMessage({id:"wham.environmentDetailsPage.resetCacheAriaLabel",defaultMessage:"Button to invalidate cache for {environmentName}"},{environmentName:a.label}),children:e.jsx(n,{id:"wham.environmentDetailsPage.resetCache",defaultMessage:"Reset cache"})})})]})}),((A=a.cache_settings)==null?void 0:A.post_setup_cache_enabled)&&e.jsx(r,{label:t.formatMessage({id:"wham.environmentDetailsPage.maintenanceSetupScript",defaultMessage:"Maintenance setup script"}),children:e.jsx("pre",{className:"mono text-xs leading-5 break-all whitespace-pre-wrap",children:(Array.isArray(a.maintenance_setup)?a.maintenance_setup:[a.maintenance_setup]).filter(Boolean).join("\n")})})]}),e.jsx(r,{label:t.formatMessage({id:"wham.environmentDetailsPage.environmentVariables",defaultMessage:"Environment variables"}),children:e.jsx("pre",{className:"mono text-xs leading-5 break-all whitespace-pre-wrap",children:Object.keys((O=a.env_vars)!=null?O:{}).filter(l=>!l.startsWith("CODEX_ENV_")).join("\n")})}),e.jsx(r,{label:t.formatMessage({id:"wham.environmentDetailsPage.secrets",defaultMessage:"Secrets"}),children:e.jsx("pre",{className:"mono text-xs leading-5 break-all whitespace-pre-wrap",children:Object.keys((B=a.secrets)!=null?B:{}).join("\n")})}),e.jsx(r,{label:t.formatMessage({id:"wham.environmentDetailsPage.createdAt",defaultMessage:"Created at"}),children:a.created_at?e.jsx(ne,{value:new Date(a.created_at*1e3),year:"numeric",month:"long",day:"numeric"}):e.jsx(n,{id:"wham.environmentDetailsPage.noCreationDate",defaultMessage:"No creation date"})}),e.jsx(r,{label:t.formatMessage({id:"wham.environmentDetailsPage.setupScript",defaultMessage:"Setup script"}),children:H&&Y?e.jsx(n,{id:"wham.environmentDetailsPage.autoSetup.automatic",defaultMessage:"Automatic"}):e.jsx("pre",{className:"mono text-xs leading-5 break-all whitespace-pre-wrap",children:(Array.isArray(a.setup)?a.setup:[a.setup]).filter(Boolean).join("\n")})}),e.jsx(r,{label:t.formatMessage({id:"wham.environmentDetailsPage.repository",defaultMessage:"Repository"}),children:a.repo_map?Object.values(a.repo_map).map(l=>l.repository_full_name):e.jsx(n,{id:"wham.environmentDetailsPage.noRepository",defaultMessage:"No repository"})}),e.jsx(r,{label:t.formatMessage({id:"wham.environmentDetailsPage.numTasks",defaultMessage:"No. of tasks"}),children:(R=a.task_count)!=null?R:0}),Q&&e.jsxs(e.Fragment,{children:[e.jsx(r,{label:t.formatMessage({id:"94ZVks",defaultMessage:"Share"}),children:a.share_settings==="workspace"?t.formatMessage({id:"wham.environmentDetailsPage.sharedWithWorkspace",defaultMessage:"Shared with {workspaceName}"},{workspaceName:U}):t.formatMessage({id:"wham.environmentDetailsPage.private",defaultMessage:"Private"})}),Z&&e.jsx(r,{label:t.formatMessage({id:"wham.environmentDetailsPage.shareTargets",defaultMessage:"Additional editors"}),children:a.share_targets&&a.share_targets.length>0?e.jsx("div",{className:"flex flex-col gap-1",children:a.share_targets.map((l,ee)=>{var T;return e.jsx("span",{children:l.email},"".concat((T=l.type)!=null?T:"user","-").concat(l.email,"-").concat(ee))})}):e.jsx(n,{id:"wham.environmentDetailsPage.shareTargetsNone",defaultMessage:"None"})})]})]})]}):e.jsx("div",{className:"flex h-full items-center justify-center",children:e.jsx(n,{id:"wham.environmentDetailsPage.environmentNotFound",defaultMessage:"Environment not found"})})}),m&&e.jsx(_e,{environmentId:s,onClose:()=>d(!1)}),c&&e.jsx(Ne,{environmentId:s,onClose:()=>g(!1)})]})}const Je=()=>[{title:"Codex"}],Ye=ie(function(){return e.jsx(ye,{})});export{Ye as default,Je as meta};
//# sourceMappingURL=c14v079hzefmmfvz.js.map
