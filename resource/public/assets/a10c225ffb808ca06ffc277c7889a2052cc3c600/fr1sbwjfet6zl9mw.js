var I=Object.defineProperty,y=Object.defineProperties;var C=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var f=(t,e,o)=>e in t?I(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,S=(t,e)=>{for(var o in e||(e={}))O.call(e,o)&&f(t,o,e[o]);if(L)for(var o of L(e))P.call(e,o)&&f(t,o,e[o]);return t},m=(t,e)=>y(t,C(e));import{r as d,f as N}from"./jj85rqzpbnvv3emr.js";import{ar as c,as as r,og as A,N as T,U as v}from"./lef5ym39glv4981l.js";import{u as w}from"./oewf3dcf71lssqyb.js";import{bP as _}from"./mclphevd122040jw.js";const u="last_checked_loc",p=24*60*60*1e3,l="last_denied_loc",k=60*60*1e3,b=A.Accepted,h=A.Pending;function U(){return c.getCookie(r.DeviceId)}function x(t,e){var n;if(!t||!e)return null;const o=(n=t.devices)==null?void 0:n[e];return!o||o.status===h?null:o.status===b}function H(){const[t,e]=w(),o=U(),{data:n}=T(v.PreciseLocationDeviceSettings),a=x(n,o);d.useEffect(()=>{a!=null&&t.useLocation!==a&&e(s=>m(S({},s),{useLocation:a}))},[a,e,t.useLocation]);const{data:i}=N({queryKey:["userLocation",t.useLocation],queryFn:({queryKey:[s,E]})=>D({enabled:E}),initialData:K(t.useLocation),networkMode:"always",refetchOnMount:"always",refetchOnWindowFocus:"always",staleTime:0});return i}function K(t){if(t){const e=c.getCookie(r.LastLocation);if(e)try{return JSON.parse(e)}catch(o){return g(),null}}return null}async function D({enabled:t}){var o;if(!t)return g();if(((o=await M())==null?void 0:o.state)!=="granted"){const n=localStorage.getItem(u);if(n){const a=Number(n),i=c.getCookie(r.LastLocation);if(i&&Date.now()-p<a)try{return JSON.parse(i)}catch(s){}}}const e=localStorage.getItem(l);if(e){const n=Number(e);if(Date.now()-k<n)return null}return await new Promise(n=>{navigator.geolocation.getCurrentPosition(a=>{const i={latitude:a.coords.latitude,longitude:a.coords.longitude,locationAccuracy:a.coords.accuracy};c.setCookie(r.LastLocation,JSON.stringify(i),{maxAge:_}),localStorage.setItem(u,Date.now().toString()),n(i)},()=>{localStorage.setItem(l,Date.now().toString()),n(g())},{enableHighAccuracy:!0,maximumAge:0})})}function Q(){return D({enabled:!0})}async function M(){return navigator!=null&&navigator.permissions?await navigator.permissions.query({name:"geolocation"}):null}const R={latitude:null,longitude:null,locationAccuracy:null};function g(){return c.setCookie(r.LastLocation,JSON.stringify(R),{maxAge:_}),localStorage.removeItem(u),localStorage.removeItem(l),null}d.createContext(null);export{g as c,x as i,Q as r,H as u};
//# sourceMappingURL=fr1sbwjfet6zl9mw.js.map
