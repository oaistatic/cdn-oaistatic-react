import{r as A,b as $,j as o,d as q}from"./jj85rqzpbnvv3emr.js";import{i as B,aF as V,a6 as Y,iE as J,ik as K,gH as Q,gl as X,iB as Z,e as I,E as D,hj as ee,hS as R}from"./lef5ym39glv4981l.js";import{ha as G,hb as se,S as ae,cY as te,hc as ne,gY as oe,hd as re,he as ie}from"./mclphevd122040jw.js";function le({asset:s,contextConnectorSourceUrl:r,disableExpandable:d=!1,isSingle:c,isUserTurn:u,className:i}){var y,E;const n=B(),l=V(n).flags,[f,e]=A.useState(!1),{isUnauthenticated:t}=Y(),m=l==null?void 0:l.includes(J.NoAuthEnableFileUploads),h=K(s.asset_pointer),a=G.useState(W=>G.selectFile(W,h)),M=se((y=a==null?void 0:a.file)!=null?y:null,a==null?void 0:a.file.name,(E=a==null?void 0:a.fileId)!=null?E:void 0,a==null?void 0:a.gizmoId,a==null?void 0:a.contextConnectorInfo,!0),U=t&&a&&m,{gizmoEditorData:x}=Q(),v=X(),N=A.useContext(ae),_=(N==null?void 0:N.serverSharedThreadId)&&u,z=Z(),{isOpen:H}=te(),S=$(),{data:T,isLoading:P,error:k}=ne({asset:s,gizmoId:x==null?void 0:x.id,getServerUrl:!U}),{url:j,width:w,height:C}=M&&m?{width:s.width,height:s.height,url:M}:T!=null?T:{},b=P||!f,p=w&&C?{Landscape:w>C,Portrait:w<C}:void 0,g=["overflow-hidden rounded-lg"];if(c&&(g.push("w-full h-full"),p!=null&&p.Landscape?g.push("max-w-96 max-h-64"):p!=null&&p.Portrait?g.push("max-h-96 max-w-64"):g.push("max-w-64 max-h-64")),i&&g.unshift(i),_&&z())return null;let L;return j!=null&&(L=o.jsx(oe,{alt:S.formatMessage(F.imageAltText),className:I(H?"max-w-[88px]":"max-w-full",!c&&"aspect-square","object-cover object-center",g),src:j,width:w,height:C,onLoad:()=>e(!0)}),!v&&!d&&(L=o.jsx(re,{src:j,alt:S.formatMessage(F.imageAltText),contextConnectorSourceUrl:r,className:I(g),children:L}))),o.jsx("div",{className:I(g),children:o.jsx("div",{className:I("bg-token-main-surface-secondary text-token-text-tertiary relative flex h-auto w-full max-w-lg items-center justify-center overflow-hidden",!c&&"aspect-square"),children:j!=null?L:o.jsx("div",{className:"flex items-center justify-center",style:{aspectRatio:"".concat(w," / ").concat(C),width:w},title:b?S.formatMessage(F.loadingImage):S.formatMessage(F.errorLoadingImage),children:b?o.jsx(D,{}):k?o.jsx(ee,{className:"icon-sm"}):null})})})}const F=q({loadingImage:{id:"textMessage.loadingImage",defaultMessage:"Loading..."},errorLoadingImage:{id:"textMessage.errorLoadingImage",defaultMessage:"Could not load image"},imageAltText:{id:"textMessage.imageAltText",defaultMessage:"Uploaded image"},targetedReply:{id:"textMessage.targetedReply",defaultMessage:"Replying to:"}});function O({assets:s,attachments:r,isUserTurn:d=!0,clientThreadId:c}){const u=s.length===1,{containerClassname:i,imageClassnames:n}=O.computeClassnames(s.length);let l=R.ATTACHMENT;return s&&!(r&&r.length>0)&&(l=R.IMAGE),o.jsxs("div",{className:"flex w-[var(--user-chat-width,70%)] flex-col items-end",children:[o.jsx("div",{className:I("flex flex-row items-center justify-end gap-1",i),children:s.map((f,e)=>{var m;const t=r==null?void 0:r.find(h=>h.id&&f.asset_pointer.includes(h.id));return o.jsx(le,{asset:f,isSingle:u,isUserTurn:d,contextConnectorSourceUrl:(m=t==null?void 0:t.context_connector_info)==null?void 0:m.source_url,className:n[e]},e)})}),o.jsx(ie,{featureType:l,isUserTurn:d,clientThreadId:c})]})}O.computeClassnames=s=>{if(s<2)return{containerClassname:null,imageClassnames:[]};let r=s>=4?"flex-wrap":"";const d=Array(s),c=e=>{d.fill(e)},u=e=>{r+=" ".concat(e)},i=(e,t)=>{d[e]=I(d[e],t)},n=s<=4&&s%2===0?2:3,l=Math.ceil(s/n),f=s%n!==0;n===2?(c("h-32 w-32"),u("max-w-72")):l<=2?(c("h-24 w-24 sm:h-32 sm:w-32"),u("max-w-80 sm:max-w-100")):(c("h-16 w-16"),u("max-w-52"));for(let e=0;e<s;e++){const t=Math.floor(e/n),m=e%n,h=Math.min(s-t*n,n),a=t===0,M=t===l-1,U=t===l-2,x=m===0,v=m===h-1;a&&x&&i(e,"rounded-ss-2xl"),a&&v&&i(e,"rounded-se-2xl"),M&&x&&i(e,"rounded-es-2xl"),M&&v&&i(e,"rounded-ee-sm"),f&&x&&U&&i(e,"rounded-es-2xl")}return{containerClassname:r,imageClassnames:d}};export{O as TextMessageImageGroup};
//# sourceMappingURL=n2rvdi7pzj8nh2rw.js.map
