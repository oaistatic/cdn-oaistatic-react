var Ne=Object.defineProperty,Se=Object.defineProperties;var Pe=Object.getOwnPropertyDescriptors;var oe=Object.getOwnPropertySymbols;var we=Object.prototype.hasOwnProperty,ke=Object.prototype.propertyIsEnumerable;var ne=(s,a,t)=>a in s?Ne(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t,k=(s,a)=>{for(var t in a||(a={}))we.call(a,t)&&ne(s,t,a[t]);if(oe)for(var t of oe(a))ke.call(a,t)&&ne(s,t,a[t]);return s},y=(s,a)=>Se(s,Pe(a));import{b as L,r as u,j as e,d as W,M as E,g as me,x as Ae,i as ye,G as Fe,ad as Ee}from"./jj85rqzpbnvv3emr.js";import{a as Te,b as Le,c as _e,u as De}from"./fya3qb1e1s8z4llj.js";import{e as Ge,M as ie}from"./cxka3f16uwxr0o9b.js";import{u as ue,a as Oe,b as ge,c as Be,d as Ie,e as We,f as Ue,g as He,h as Qe}from"./jprx81py211obz0t.js";import{C as pe,fv as qe,qa as Z,e as fe,E as $,B as T,f as xe,eE as R,fx as ze,aE as Ve,i9 as Ze,i as $e,j as z,m as Xe,qE as Je,qF as Ye,pk as F,qG as V,qH as Ke,s as es,n as ss,bw as re}from"./lef5ym39glv4981l.js";import{lR as ts,c7 as as,be as he,nF as os,nG as ns,nH as le,bO as is,gO as rs,jU as ls}from"./mclphevd122040jw.js";import{S as je}from"./gxhsars2vrugs5ht.js";import{T as l}from"./i5991cad8s41d2db.js";import{G as Ce}from"./j8iq8tz9iwf8tfnb.js";import{u as cs,E as ds,C as ms,R as us,P as gs,i as ce,U as ps}from"./dkg3g1u21u0d8m8u.js";import{W as fs}from"./nw87b28zzjde4xnt.js";import{T as xs,a as hs}from"./ghs0b9qiouvv0rxl.js";import{d as de}from"./l1ka89a9nbqv3utj.js";import"./n82i9qkvs5r9bggc.js";import"./9z485wf4plyfoo73.js";import"./cncd8uuk5eicbkeu.js";import"./dta5t6ifyam55mk9.js";import"./cdk0cmbgnafohb1q.js";import"./gyvvad7btmtz1x9o.js";import"./n6vmm5pyahusdy8e.js";import"./l041el2tch1t3nkf.js";import"./easgat082167v0i8.js";import"./dvqe6kc43fkjsavv.js";import"./mw2u7timj0qnsnvj.js";import"./hnotrmacgvnfyexv.js";import"./mej2ctt6swvc1m1z.js";import"./go9515ghq3pauvs4.js";import"./d9serb02oz4r1lgw.js";import"./n5wrqpcxv1sjah44.js";import"./iggidwj20lqhrnfm.js";const js=({onClose:s,workspaceId:a,roleId:t})=>{const n=L(),[d,i]=u.useState(""),[x,g]=u.useState(0),{groups:c,isLoading:M,isPlaceholderData:r}=Ge({workspaceId:a,currPage:x,groupFilter:d}),{data:C}=ue({workspaceId:a,roleId:t}),{assignGroup:h}=Oe({workspaceId:a,roleId:t}),{unassignGroup:P}=ge({workspaceId:a,roleId:t});return e.jsxs(pe,{testId:"modal-role-assignment-modal",isOpen:!0,onClose:s,showCloseButton:!0,size:"large",type:"success",title:n.formatMessage(j.title),primaryButton:e.jsx(T,{onClick:()=>s(),children:n.formatMessage(j.done)}),secondaryButton:e.jsx(T,{color:"secondary",onClick:()=>s(),children:n.formatMessage(j.cancel)}),children:[e.jsxs("div",{className:"bg-token-bg-tertiary text-token-text-primary flex w-full flex-row items-center gap-4 rounded-xl p-4",children:[e.jsx(qe,{className:"icon-lg"}),e.jsx("div",{className:"text-token-text-secondary text-sm font-medium",children:n.formatMessage(j.information)})]}),e.jsx(Z,{className:"mt-6 mb-6",inputClassName:"w-full",placeholder:n.formatMessage(j.searchPlaceholder),value:d,onChange:p=>i(p.target.value)}),e.jsxs("div",{className:"min-h-[18rem]",children:[e.jsxs(l.Root,{className:"min-w-full",children:[e.jsxs("colgroup",{children:[e.jsx("col",{className:"w-[80%]"}),e.jsx("col",{className:"w-[20%]"})]}),e.jsx(l.Body,{className:fe((M||r)&&"opacity-50"),children:c==null?e.jsx(l.Row,{children:e.jsx(l.Cell,{colSpan:5,textAlign:"center",children:e.jsx($,{})})}):c.items.length===0?e.jsx(l.Row,{children:e.jsx(l.Cell,{colSpan:5,textAlign:"center",children:d===""?n.formatMessage(j.noGroupFound):n.formatMessage(j.noGroupFoundWithFilter)})}):c.items.filter(({system_use_case:p})=>!p).map(p=>e.jsx(Cs,{group:p,assignedGroups:C||[],onAssign:()=>h(p),onUnassign:()=>P(p.id)},p.id))})]}),c&&e.jsx("div",{className:"text-center",children:e.jsx(ts,{length:Math.ceil(c.total/ie),currentPage:Math.min(x,Math.ceil(c.total/ie)),onChangeIndex:p=>g(p)})})]})]})},Cs=({group:s,assignedGroups:a,onAssign:t,onUnassign:n})=>{const[d,i]=u.useState(!1),x=xe(),g=L(),c=async()=>{i(!0);try{await t(),x.success(g.formatMessage(j.addSuccess),{duration:2})}catch(r){x.danger(j.addFailure,{duration:2,toastId:"role_assignment_modal"})}finally{i(!1)}},M=async()=>{i(!0);try{await n(),x.success(g.formatMessage(j.removedSuccess),{duration:2})}catch(r){x.danger(j.removeFailure,{duration:2,toastId:"role_assignment_modal"})}finally{i(!1)}};return e.jsxs(l.Row,{className:"[&>td]:py-2",children:[e.jsxs(l.Cell,{children:[e.jsx(Ce,{group:s}),e.jsxs("div",{children:[e.jsx("div",{children:s.name}),e.jsx("div",{className:"text-token-text-secondary text-xs",children:e.jsx(E,{id:"15cHOa",defaultMessage:"{count} members",values:{count:s.num_members}})})]})]}),e.jsx(l.Cell,{className:"flex items-center justify-end",children:a.some(r=>r.id===s.id)?e.jsx(T,{color:"primary",icon:as,onClick:M,loading:d,children:g.formatMessage(j.added)}):e.jsx(T,{color:"secondary",icon:je,onClick:c,loading:d,children:g.formatMessage(j.add)})})]})},j=W({add:{id:"yso/RZ",defaultMessage:"Add"},added:{id:"O2kZcD",defaultMessage:"Added"},addSuccess:{id:"lQy6C+",defaultMessage:"Role has been successfully assigned to group."},removedSuccess:{id:"lINrRq",defaultMessage:"Role has been successfully removed from group."},addFailure:{id:"VoUYt8",defaultMessage:"Failed to assign role to group."},removeFailure:{id:"Q+GN8A",defaultMessage:"Failed to remove role from group."},noGroupFound:{id:"dE7Tu5",defaultMessage:"No groups found."},noGroupFoundWithFilter:{id:"OA7F5f",defaultMessage:"No groups found. Try changing the search query."},searchPlaceholder:{id:"sUDB3M",defaultMessage:"Search by name"},title:{id:"Rj8nZG",defaultMessage:"Assign groups to role"},information:{id:"J92l5s",defaultMessage:"Custom role permissions will override default permissions."},cancel:{id:"QykMkt",defaultMessage:"Cancel"},done:{id:"Zsm046",defaultMessage:"Done"}}),Ms=({workspaceId:s,roleId:a})=>{const t=L(),[n,d]=u.useState(""),{data:i,isLoading:x,isPlaceholderData:g}=ue({workspaceId:s,roleId:a}),c=i==null?void 0:i.filter(h=>h.name.toLowerCase().includes(n.toLowerCase())),[M,r]=u.useState(!1),{unassignGroup:C}=ge({workspaceId:s,roleId:a});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-6 mb-3 flex flex-row justify-between gap-2",children:[e.jsx(Z,{inputClassName:"w-[250px] rounded-full! text-sm",value:n,onChange:h=>{d(h.target.value)},placeholder:t.formatMessage({id:"workspaceSettings.groups.search",defaultMessage:"Search group name"})}),e.jsx(T,{onClick:()=>r(!0),icon:je,children:t.formatMessage(q.add)})]}),e.jsx("div",{children:e.jsxs(l.Root,{className:"min-w-full",children:[e.jsxs("colgroup",{children:[e.jsx("col",{className:"w-[80%]"}),e.jsx("col",{className:"w-[20%]"})]}),e.jsxs(l.Header,{children:[e.jsx(l.HeaderCell,{children:t.formatMessage(q.name)}),e.jsx(l.HeaderCell,{children:t.formatMessage(q.dateAdded)})]}),e.jsx(l.Body,{className:fe((x||g)&&"opacity-50"),children:c==null?e.jsx(l.Row,{children:e.jsx(l.Cell,{colSpan:5,textAlign:"center",children:e.jsx($,{})})}):c.length===0?e.jsx(l.Row,{children:e.jsx(l.Cell,{colSpan:5,textAlign:"center",children:n===""?e.jsx(E,{id:"workspaceSettings.groups.noGroups",defaultMessage:"No groups found."}):e.jsx(E,{id:"workspaceSettings.groups.noGroupsWithFIlter",defaultMessage:"No groups found. Try changing the search query."})})}):c.map(h=>e.jsx(bs,{group:h,onRemoveAssignment:P=>C(P)},h.id))})]})}),M&&e.jsx(js,{onClose:()=>r(!1),workspaceId:s,roleId:a})]})},bs=({group:s,onRemoveAssignment:a})=>{const t=me();return e.jsx(e.Fragment,{children:e.jsxs(l.Row,{className:"[&>td]:py-2",onClick:()=>t("/admin/groups/".concat(s.id)),children:[e.jsxs(l.Cell,{children:[e.jsx(Ce,{group:s}),e.jsxs("div",{children:[e.jsx("div",{children:s.name}),e.jsx("div",{className:"text-token-text-secondary text-xs",children:e.jsx(E,{id:"15cHOa",defaultMessage:"{count} members",values:{count:s.num_members}})})]})]}),e.jsx(l.Cell,{children:s.created_time&&e.jsx(Ae,{value:s.created_time,year:"numeric",month:"short",day:"numeric"})}),e.jsx(l.Cell,{className:"text-end",children:e.jsxs(R.Root,{children:[e.jsx(R.Trigger,{className:"-my-2",children:e.jsx(ze,{className:"icon-sm"})}),e.jsx(R.Portal,{children:e.jsx(R.Content,{size:"small",children:e.jsx(R.Item,{onClick:()=>{a(s.id)},icon:e.jsx(he,{className:"text-token-text-status-error"}),className:"text-token-text-status-error",children:e.jsx(E,k({},q.removeLabel))})})})]})})]})})},q=W({add:{id:"floy3N",defaultMessage:"Add"},name:{id:"IP/+l1",defaultMessage:"Name"},dateAdded:{id:"6BJG0j",defaultMessage:"Date Added"},removeLabel:{id:"uut7wd",defaultMessage:"Remove group from role"}}),vs="https://help.openai.com/en/articles/11750701-rbac",Rs=({role:s,onSave:a})=>{var J,Y,K,ee,se,te,ae;const t=L(),n=Ve(),d=(J=n==null?void 0:n.getWorkspaceId())!=null?J:"",i=Ze(),x=cs(),g=$e(),c=z(g,"2913573978"),M=z(g,"820985683"),{data:r}=Xe((()=>{if(n==null)throw new Error("Account must not be null");const o=n.getWorkspaceId();if(o==null)throw new Error("Workspace ID must not be null");return o})()),C=Je(),{permissionsBySection:h,totalPermissionsCount:P}=u.useMemo(()=>{var w,I;const o=z(g,"2968710568"),b=Ye(y(k({isCanvasEnabled:!0,isSearchEnabled:s.permissions.includes(F.SearchAccess),isEnterprisey:(w=n==null?void 0:n.isEnterprisey())!=null?w:!1},x),{isQuorum:i,legacyModelsEnabled:(I=r==null?void 0:r.beta_settings.legacy_models)!=null?I:!1,includeConnectorPermissions:C,isCodexEnabledInRBACRole:s.permissions.includes(F.AllowCodexAccess),showProjectSharing:M,isRoleSpecificPage:!0,showDeviceCodeAuthToggle:o,gpt5ThinkingEnabled:s.permissions.includes(F.GPT5ThinkingAccess)})).map(S=>y(k({},S),{entries:S.entries.filter(Re=>Re.rbac)})).filter(S=>S.entries.length>0),N=b.flatMap(S=>S.entries).length;return{permissionsBySection:b,totalPermissionsCount:N}},[n,x,s.permissions,r==null?void 0:r.beta_settings,C,i,M,g]),[p,_]=u.useState(""),D=h.map(o=>y(k({},o),{entries:o.entries.filter(m=>{const b=typeof m.title=="string"?m.title:t.formatMessage(m.title),N=m.description?typeof m.description=="string"?m.description:t.formatMessage(m.description,m.descriptionValues):"";return m.rbac&&([b,N].join(" ").toLowerCase().includes(p.toLowerCase())||m.permissionName.toLowerCase().includes(p.toLowerCase()))})})).filter(o=>o.entries.length>0),{toggleAllConnectorsPermissionForRole:G,isPending:O}=Be({workspaceId:(Y=n==null?void 0:n.getWorkspaceId())!=null?Y:""}),{connectorsWithPermission:U,isLoading:H}=Ie({accountId:(K=n==null?void 0:n.id)!=null?K:"",workspaceId:(ee=n==null?void 0:n.getWorkspaceId())!=null?ee:"",roleId:s.id,enabled:C}),B=Array.from((se=U.values())!=null?se:[]).filter(o=>o.connector.status!=="DISABLED_BY_ADMIN"),Q=u.useMemo(()=>[V.CONTEXT_CONNECTOR_GDRIVE,V.CONTEXT_CONNECTOR_O365_PERSONAL,V.CONTEXT_CONNECTOR_O365_BUSINESS].filter(o=>!!(r!=null&&r.beta_settings[o])),[r==null?void 0:r.beta_settings]),f=We({workspaceId:(te=n==null?void 0:n.getWorkspaceId())!=null?te:"",roleId:s.id,connectorIds:Q,enabled:C}),A=u.useMemo(()=>{var N,w;const m=Array.from((N=B.values())!=null?N:[]).filter(I=>I.permissions.includes(F.UseConnector)),b=Object.entries((w=f.results)!=null?w:{}).filter(([I,S])=>S.includes(F.UseConnector));return[...m,...b]},[B,f.results]),[Me,X]=u.useState(!1),be=Ke(i,c&&!M),ve=o=>{const m=o.permissionName,b=typeof o.title=="string"?o.title:t.formatMessage(o.title);if(o.permissionName===F.UseConnector){const N=A.length>0;return e.jsxs(e.Fragment,{children:[Me&&e.jsx(us,{platformConnectorsWithPermission:U,contextConnectorsWithPermission:f.results,workspaceId:d,roleId:s.id,onClose:()=>X(!1)}),e.jsx(le,{children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-md",children:b}),o.description&&e.jsx("span",{className:"text-token-text-tertiary text-sm",children:typeof o.description=="string"?o.description:t.formatMessage(o.description,o.descriptionValues)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[(H||O)&&e.jsx($,{}),o.nestedKey&&(Q.length>0||B.length>0)&&e.jsx("div",{className:"text-token-text-tertiary text-sm",children:e.jsx(T,{color:"primary-inverse",onClick:()=>X(!0),children:e.jsx(E,{id:"workspaceSettings.roles.selectNestedPermission",defaultMessage:"Select..."})})}),e.jsx(ss,{size:"normal","aria-label":b,checked:N,onCheckedChange:w=>G({id:s.id,state:w}),disabled:O||H})]})]})},m)]})}return e.jsx(le,{children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-md",children:b}),o.description&&e.jsx("span",{className:"text-token-text-tertiary text-sm",children:typeof o.description=="string"?o.description:t.formatMessage(o.description,o.descriptionValues)})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(gs,{ariaLabel:b,role:s,permissionName:o.permissionName,handleSaveRole:a,disabled:o.disabled,disabledReason:o.disabledReason})})]})},m)};return e.jsxs(os,{children:[e.jsx("div",{className:"text-token-text-secondary text-sm",children:t.formatMessage(Ns.customRoleDescription,{link:o=>e.jsx(es,{className:"underline",target:"_blank",rel:"noreferrer",href:vs,children:o})})}),e.jsx("div",{className:"flex flex-row items-center justify-between",children:e.jsx(Z,{inputClassName:"w-[250px] rounded-full! text-sm",value:p,onChange:o=>{_(o.target.value)},placeholder:t.formatMessage({id:"hRuTvi",defaultMessage:"Search {count} permissions"},{count:P})})}),r&&e.jsx(ds,{preReleases:be,workspaceId:(ae=n==null?void 0:n.getWorkspaceId())!=null?ae:"",data:r,handleSaveRole:a,role:s,isCustomRole:!1}),d&&e.jsx(ms,{workspaceId:d,roleId:s.id}),D.map(o=>e.jsx(fs,{title:o.title,description:o.description,descriptionValues:o.descriptionValues,shouldDisableForQuorum:!o.availableForQuorum,children:e.jsx(ns,{children:o.entries.map(m=>ve(m))})},String(o.title.defaultMessage)))]})},Ns=W({customRoleDescription:{id:"I9hJih",defaultMessage:"Custom role permissions override workplace-level settings. A user’s effective permissions are the sum of all their assigned custom roles. Not all settings are available as role-based permissions. <link>Learn more</link>"},save:{id:"LE9GJk",defaultMessage:"Save"},searchPlaceholder:{id:"EaN6oB",defaultMessage:"Search permissions"}}),Ss=W({permissionPageTitle:{id:"1Qw6mG",defaultMessage:"Roles & permissions"}}),Ps=s=>s==="permissions"||s==="assignments";function ws({currentWorkspaceId:s,roleId:a}){const t=L(),[n,d]=u.useState(!1),{data:i,refetch:x}=Ue({roleId:a!=null?a:"",workspaceId:s}),g=xe(),c=me(),[M]=ye(),[r,C]=u.useState(!1),{deleteRole:h}=He({workspaceId:s}),P=u.useCallback(async()=>{try{await h(a!=null?a:""),C(!1),g.success(t.formatMessage(v.removeSuccessMessage)),c("/admin/settings?tab=roles",{replace:!0})}catch(f){g.danger(t.formatMessage(v.removeErrorMessage))}},[h,t,a,g,c]),{updateRole:p}=Qe({workspaceId:s}),_=u.useCallback(async f=>{const A=await p(f);A.id!==a&&c({pathname:"/admin/permissions/roles/".concat(A.id)},{replace:!0}),x()},[c,x,a,p]),D=u.useMemo(()=>{const f=[{key:"permissions",label:t.formatMessage(v.rolePermissionsLabel),children:e.jsx(Rs,{role:i,onSave:_})}];return i&&!ce(i)&&f.push({key:"assignments",label:t.formatMessage(v.roleAssignmentsLabel),children:e.jsx(Ms,{workspaceId:s,roleId:a!=null?a:""})}),f},[s,t,i,_,a]),G=M.get("tab"),[O,U]=u.useState(G&&Ps(G)?G:D[0].key),H=f=>{U(f),c({pathname:window.location.pathname,search:new URLSearchParams({tab:f}).toString()})},B=u.useMemo(()=>{var f;return[{label:t.formatMessage(Ss.permissionPageTitle),href:"/admin/settings?tab=roles"},{label:(f=i==null?void 0:i.name)!=null?f:""}]},[t,i==null?void 0:i.name]),Q=e.jsxs(R.Root,{children:[e.jsx(R.Trigger,{asChild:!0,className:"border-token-border-default! border!",children:e.jsxs("div",{children:[t.formatMessage(v.manageLabel),e.jsx(is,{className:"icon-sm ms-0.5"})]})}),e.jsx(R.Portal,{children:e.jsxs(R.Content,{children:[e.jsx(R.Item,{onClick:()=>de(d)(!0),icon:rs,label:t.formatMessage(v.editRoleLabel)}),e.jsx(R.Item,{onClick:()=>de(C)(!0),icon:he,label:t.formatMessage(v.deleteRoleLabel),color:"danger"})]})})]});return i?e.jsxs(e.Fragment,{children:[e.jsx(ls,{children:e.jsx("title",{children:i.name})}),e.jsx(Te,{navigation:e.jsx(Le,{items:B}),title:i.name,subtitle:i.description,actions:i&&!ce(i)?Q:void 0,tabsHeader:e.jsx(xs,{items:D,activeTab:O,onTabChange:H})}),e.jsx(_e,{showSpinner:!1,children:e.jsx(hs,{items:D,activeTab:O})}),n&&e.jsx(ps,{onSave:({name:f,description:A})=>_(y(k({},i),{name:f,description:A})),onClose:()=>d(!1),isCreate:!1,defaultData:{name:i.name,description:i.description}}),r&&e.jsx(ks,{onClose:()=>C(!1),onDeleteConfirm:()=>P()})]}):null}const ks=({onDeleteConfirm:s,onClose:a})=>{const t=L(),[n,d]=u.useState(!1);return e.jsx(pe,{testId:"modal-remove-member",isOpen:!0,title:t.formatMessage(v.deleteRoleLabel),onClose:a,type:"success",primaryButton:e.jsx(re.Button,{title:t.formatMessage(v.confirm),color:"danger",onClick:async()=>{try{d(!0),await s()}finally{d(!1)}},loading:n}),secondaryButton:e.jsx(re.Button,{title:t.formatMessage(v.cancel),color:"secondary",onClick:a,loading:n}),children:e.jsx("div",{className:"flex flex-col items-center gap-2",children:e.jsx("div",{className:"text-token-text-tertiary",children:t.formatMessage(v.deleteConfirmationText)})})})},v=W({rolePermissionsLabel:{id:"PXsC8s",defaultMessage:"Role permissions"},manageLabel:{id:"zPUmjl",defaultMessage:"Manage"},editRoleLabel:{id:"6pHT9d",defaultMessage:"Edit role"},deleteRoleLabel:{id:"XfDjrE",defaultMessage:"Delete role"},confirm:{id:"mQb6kI",defaultMessage:"Confirm"},cancel:{id:"uNmzc2",defaultMessage:"Cancel"},deleteConfirmationText:{id:"tZZlFY",defaultMessage:"Are you sure you want to delete this role? This action cannot be undone."},removeSuccessMessage:{id:"aBZC2C",defaultMessage:"Role removed successfully."},removeErrorMessage:{id:"KthOn1",defaultMessage:"Failed to remove role."},roleAssignmentsLabel:{id:"sBMwFp",defaultMessage:"Role assignments"}}),it=Fe(function(){const a=De(),{roleId:t}=Ee();return e.jsx(ws,y(k({},a),{roleId:t}))});export{it as default};
//# sourceMappingURL=jjwsu5q6gjazhs8a.js.map
