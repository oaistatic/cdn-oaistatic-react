var tn=Object.defineProperty,sn=Object.defineProperties;var nn=Object.getOwnPropertyDescriptors;var Jt=Object.getOwnPropertySymbols;var an=Object.prototype.hasOwnProperty,on=Object.prototype.propertyIsEnumerable;var Xt=(t,n,s)=>n in t?tn(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s,he=(t,n)=>{for(var s in n||(n={}))an.call(n,s)&&Xt(t,s,n[s]);if(Jt)for(var s of Jt(n))on.call(n,s)&&Xt(t,s,n[s]);return t},pe=(t,n)=>sn(t,nn(n));import{b as U,j as e,M as Ct,e as g,r as d,m as B,aw as rn,as as cn,K as ln,A as _e,d as ys,u as st,a as Re,f as bs,p as un}from"./jj85rqzpbnvv3emr.js";import{x as Z,i as et,B as dn,D as mn,e as fn,u as gn,F as hn,C as pn,d as xn,H as vn,T as Cn,k as $t,G as yn}from"./erm6n5lmbxodgs50.js";import{fk as bn,gz as wn,xp as nt,nX as q,nY as te,n_ as tt,xq as ws,xr as Sn,vS as Tn,u$ as Mn,xs as En,xt as kn,hj as jn,fA as An,xu as In,gx as Dn,vw as at,bg as Rn,h2 as _n,xv as yt,iK as Nn,xw as Pn,xx as Vt,wu as Ln,vq as On,xy as Bn,xz as Hn,xA as Fn,xB as Un,gO as Gn,wc as qn,bV as Kn,N as Ue,dK as es,cA as zn,w as ts,k1 as Wn,uY as Qn,j$ as Yn,k0 as Zn,xC as Ve,a4 as Jn,av as Xn,aU as $n,o0 as Vn,xD as ea,eV as ta,eJ as Be,xE as sa,xF as Ss,xG as na,xH as aa,xI as bt,xJ as oa,sE as ia,xK as ra,of as He,xL as ca,xM as la,m9 as ua,xN as da,c as ma,xO as fa,c$ as ga,xP as ha,xQ as pa,xR as xa,eF as va,eG as Ca,eH as ya,n3 as ss,eI as ns,xS as ba,xT as wa,b as Sa,xU as Ta,h1 as Ma,xV as Ea,ax as ka,xW as as,kJ as os,xX as pt,xY as is,xZ as Je,x_ as Xe,x$ as rs}from"./mclphevd122040jw.js";import{gL as Ts,C as ja,J as Aa,bw as cs,dl as Ia,B as ls,tv as Da,iD as ot,e as ae,T as Ne,_ as Ra,dI as wt,lW as _a,ai as Na,cj as St,bI as Ms,ch as us,ax as Es,R as xe,fW as ks,t2 as js,eE as H,n9 as ds,aE as Pa,eN as La,i as As,j as Is,fx as Oa,i5 as Ba,be as Ha,e$ as Fa,hB as Ua,gG as Ga,gz as qa,m1 as Ka,P as za}from"./lef5ym39glv4981l.js";import{O as Ds,b as Ee,u as Wa,c as Qa,j as Ya,g as Za,A as Ja,a as Xa,f as ms,C as Ie,D as $a}from"./kq1ir6pxp9hst9p9.js";import{a as Va,b as eo,c as to,d as so,e as no,f as ao,S as oo,g as io,h as ro}from"./gwaaxp36jr4o1a8o.js";import{i as co,d as lo,e as uo,a as mo,b as fo,g as go}from"./g9xi6m5yzu4rtfn2.js";import{S as ho}from"./l66h8h301eaq59ck.js";import{Z as po,N as xo}from"./nfygy4vif6crzpny.js";import{E as vo}from"./iqw8c7pica2coyb9.js";import{i as Co}from"./hzcock7l6ec8fnr2.js";import{C as yo}from"./ng0sx063g0r0whhb.js";import{g as xt,S as bo}from"./irqko7c1s7qpl41n.js";import{s as vt,B as wo}from"./bx2wdn43543b9ysc.js";import{S as So}from"./kkl7694f44ns8yp6.js";import{L as To}from"./mw2u7timj0qnsnvj.js";import{u as fs}from"./nq5i976pifkrt40a.js";import{i as gs}from"./fnnulb9pmlo3cgid.js";import{g as Mo}from"./g2yrrlnprx92uhjb.js";var Rs=(t=>(t.Close="close",t.Loaded="loaded",t.Streaming="streaming",t.Download="download",t))(Rs||{});const Eo=({isOpen:t,dismissModal:n,closeTextdocEditor:s,textdocVersion:a,clientThreadId:r})=>{const i=U(),o=bn(r),c=wn(r),l=Ts(),u=nt(a==null?void 0:a.textdocId),f=async b=>{q.logButtonClick(te.SAVE_TO_CHAT_ON_EDITOR_CLOSE),!((a==null?void 0:a.versionInt)==null||l)&&(c({sourceEvent:b,promptMessage:Ia("",{canvas:{user_created_textdocs:a!=null&&a.status===ws.ATTACHED_PENDING&&u!=null?[{user_created_temp_textdoc_id:a.textdocId,type:a.type,title:a.title,content:a.content,create_source:u.create_source}]:void 0},open_in_canvas_view:{type:"canvas_textdoc",id:a.textdocId}}),completionMetadata:o?{conversationMode:o}:void 0}),u&&tt.markAsSent(u.tempTextdocId),n(),s())};return e.jsx(ja,{testId:"modal-confirm-close-editor",isOpen:t,size:"custom",className:"max-w-xl",onClose:n,type:"warning",hideSeparator:!0,title:e.jsx("span",{className:"text-xl",children:e.jsx(Ct,{id:"jgd5rD",defaultMessage:"Are you sure you want to close?"})}),primaryButton:e.jsx(cs.Button,{title:i.formatMessage({id:"XE+GiU",defaultMessage:"Save to chat"}),color:"primary",onClick:f}),secondaryButton:e.jsx(cs.Button,{title:i.formatMessage({id:"MbWco5",defaultMessage:"Don’t save and close"}),color:"secondary",onClick:()=>{q.logButtonClick(te.CLOSE_WITHOUT_SAVING),u&&tt.removeTempTextdoc(u.tempTextdocId),n(),s()}}),showCloseButton:!0,closeButton:e.jsx(Aa,{onClick:n}),children:e.jsx("div",{className:"text-md text-token-text-secondary -mt-6 pb-2",children:e.jsx(Ct,{id:"q9rJ+Y",defaultMessage:"Changes will not be saved unless you save this canvas to your chat."})})})},ko=[{id:"review",title:g({id:"upv1Y0",defaultMessage:"Code review"}),icon:Sn,prompt:g({id:"t/Ghj2",defaultMessage:"Search for bugs and opportunities to improve the code—for example, ways that performance or code structure could be improved. Leave as few comments as possible, but add more comments if the text is long. DO NOT leave more than 5 comments. You may reply that you reviewed the code and left suggestions to improve the coding quality, but do not mention the prompt."}),action:Z.COMMENT},{id:"comments",title:g({id:"sTWMBR",defaultMessage:"Add comments"}),icon:Tn,prompt:g({id:"yE/5uO",defaultMessage:"Add inline code comments to explain the code, especially parts that are more complex. Make sure to rewrite all the code. You may reply that you added inline comments, but do not mention the prompt."}),action:Z.EDIT},{id:"logs",title:g({id:"+00vDz",defaultMessage:"Add logs"}),icon:Va,prompt:g({id:"rrAJ7R",defaultMessage:"Insert logs/print statements in the code that will help debug its behavior. Do not make any other changes to the code."}),action:Z.EDIT},{id:"bugs",title:g({id:"Uw2B/L",defaultMessage:"Fix bugs"}),icon:Mn,prompt:g({id:"8JI5Am",defaultMessage:"Find any bugs and rewrite all the code to fix the bugs. Do not add any new comments. If there are no bugs, reply that you reviewed the code and found no bugs."}),action:Z.EDIT},{id:"port",title:g({id:"BotcNe",defaultMessage:"Port to a language"}),icon:En,action:Z.CREATE_TEXTDOC,menu:[{prompt:g({id:"LGUTjb",defaultMessage:"Create a new document that rewrites the code in PHP"}),title:g({id:"oR7PqF",defaultMessage:"PHP"})},{prompt:g({id:"t6K8xn",defaultMessage:"Create a new document that rewrites the code in C++"}),title:g({id:"QbnHp2",defaultMessage:"C++"})},{prompt:g({id:"hmI7x6",defaultMessage:"Create a new document that rewrites the code in Python"}),title:g({id:"viPy6U",defaultMessage:"Python"})},{prompt:g({id:"oY48Xk",defaultMessage:"Create a new document that rewrites the code in JavaScript"}),title:g({id:"Mnbu7B",defaultMessage:"JavaScript"})},{prompt:g({id:"7H04sz",defaultMessage:"Create a new document that rewrites the code in TypeScript"}),title:g({id:"pot/GV",defaultMessage:"TypeScript"})},{prompt:g({id:"IFRMM/",defaultMessage:"Create a new document that rewrites the code in Java"}),title:g({id:"78tNyh",defaultMessage:"Java"})}]}];function _s(t){const n=kn();if(!t)return{isCodePreviewable:!1,isCodeExecutable:!1,hasCanvasCodeExecution:n};const s=co(t==null?void 0:t.type,t==null?void 0:t.content),a=lo(t.type);return{isCodePreviewable:s,isCodeExecutable:a,hasCanvasCodeExecution:n}}const jo=({isTextdocStreaming:t,isRequestActive:n,value:s,comments:a})=>{const[r,i]=d.useState(!1);return d.useEffect(()=>{t&&r&&(i(!1),et.reset())},[s,a]),d.useEffect(()=>{n||(i(!1),et.reset())},[n]),[r,i]};function Ao({onClickRestore:t,onClickResetLatest:n}){const s=U();return e.jsx(B.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},transition:{bounce:0,duration:.24},className:"bg-token-main-surface-primary z-30",children:e.jsx(B.div,{className:"bg-token-main-surface-primary dark:border-token-border-xlight @container w-full items-center border-t border-gray-100 p-6 shadow-[0_-4px_32px_rgba(0,0,0,0.08)] lg:border-s dark:shadow-[0_-4px_32px_rgba(0,0,0,0.12)]",children:e.jsxs("div",{className:"mx-auto flex max-w-[48rem] flex-col flex-wrap justify-center gap-5 @2xl:flex-row @2xl:justify-between",children:[e.jsxs("div",{className:"flex flex-col px-2 text-center @2xl:text-start",children:[e.jsx("span",{className:"text-md text-token-text-primary font-semibold text-wrap",children:s.formatMessage({id:"gt23pb",defaultMessage:"You are viewing a previous version"})}),e.jsx("span",{className:"text-token-text-secondary text-sm text-wrap",children:s.formatMessage({id:"sAlUJn",defaultMessage:"Restore this version to make edits"})})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-4",children:[e.jsx(ls,{as:"button",color:"primary",onClick:t,children:s.formatMessage({id:"+cddAb",defaultMessage:"Restore this version"})}),e.jsx(ls,{as:"button",color:"secondary",onClick:n,children:s.formatMessage({id:"qCD3eu",defaultMessage:"Back to latest version"})})]})]})})})}const Io=[{id:"suggest",title:g({id:"DJBCXv",defaultMessage:"Suggest edits"}),icon:jn,prompt:g({id:"BfBd/I",defaultMessage:"Suggest edits that would improve this text, like content to add or remove, places to rephrase so that the text flows more smoothly, or ways to reorganize the ideas to be more effective. Leave as few comments as possible, but add a few more comments if the text is long. DO NOT leave more than 5 comments. You can reply that you added comments and suggestions to help improve the writing quality, but do not mention the prompt."}),action:Z.COMMENT},{id:"emoji",title:g({id:"nH2MaB",defaultMessage:"Add emojis"}),icon:ho,action:Z.EDIT,grid:[{prompt:g({id:"JTAWur",defaultMessage:"Replace as many words as possible with emojis."}),icon:eo,title:g({id:"rADAL1",defaultMessage:"Words"})},{prompt:g({id:"AvWBKJ",defaultMessage:"Add three emojis at the start or end of every major section or paragraph to give subtle decoration. Do not change the structure of the original text. Do not add emojis to lists."}),icon:to,title:g({id:"qoHmnu",defaultMessage:"Sections"})},{prompt:g({id:"Rzca6Y",defaultMessage:"Add emojis to lists for visual flair. Do not change the structure of the original text."}),icon:so,title:g({id:"/iBeX+",defaultMessage:"Lists"})},{prompt:g({id:"YOtrrm",defaultMessage:"Remove emojis"}),icon:no,title:g({id:"Ex7XkT",defaultMessage:"Remove"})}]},{id:"polish",title:g({id:"q/wllh",defaultMessage:"Add final polish"}),icon:ao,prompt:g({id:"qTOQqX",defaultMessage:"Add some final polish to the text. If relevant, add a large title or any section titles. Check grammar and mechanics, make sure everything is consistent and reads well. You can reply that you added some final polish and checked for grammar, but do not mention the prompt."}),action:Z.EDIT},{id:"reading-level",title:g({id:"e1CNWE",defaultMessage:"Reading level"}),icon:An,action:Z.EDIT,scrub:[{prompt:g({id:"98kB8D",defaultMessage:"Rewrite this text at the reading level of a doctoral writer in this subject. You may reply that you adjusted the text to reflect a graduate school reading level, but do not mention the prompt."}),title:g({id:"zIN5xc",defaultMessage:"Graduate School"})},{prompt:g({id:"XfveZa",defaultMessage:"Rewrite this text at the reading level of a college student majoring in this subject"}),title:g({id:"lZ5ttG",defaultMessage:"College"})},{prompt:g({id:"ed5yE6",defaultMessage:"Rewrite this text at the reading level of a high school student who has taken a couple of classes in this subject."}),title:g({id:"KeBm6Z",defaultMessage:"High School"})},{title:g({id:"tO5EOl",defaultMessage:"Keep current reading level"}),isCancel:!0},{prompt:g({id:"YIIyU/",defaultMessage:"Rewrite this text at the reading level of a middle schooler."}),title:g({id:"FlwtZ0",defaultMessage:"Middle School"})},{prompt:g({id:"TQ0+4A",defaultMessage:"Rewrite this text at the reading level of a kindergartener."}),title:g({id:"4hQpWn",defaultMessage:"Kindergarten"})}]},{id:"length",title:g({id:"D+HIXi",defaultMessage:"Adjust the length"}),icon:In,action:Z.EDIT,scrub:[{prompt:g({id:"CPELTR",defaultMessage:"Make this text 75% longer."}),title:g({id:"UMJQry",defaultMessage:"Longest"})},{prompt:g({id:"GfSrP9",defaultMessage:"Make this text 50% longer."}),title:g({id:"n3jwqb",defaultMessage:"Longer"})},{title:g({id:"+Vn3dN",defaultMessage:"Keep current length"}),isCancel:!0},{prompt:g({id:"oQnJVV",defaultMessage:"Make this text 50% shorter."}),title:g({id:"OP0SP3",defaultMessage:"Shorter"})},{prompt:g({id:"k5SZ0S",defaultMessage:"Make this text 75% shorter."}),title:g({id:"bMef50",defaultMessage:"Shortest"})}]}],qi=[{id:"none",title:g({id:"XqUjk5",defaultMessage:"Plain text"}),icon:oo,prompt:g({id:"H2OFQy",defaultMessage:"Transform this into plain text. Remove any formatting."}),action:Z.EDIT},{id:"bullets",title:g({id:"+qR+tC",defaultMessage:"Bulleted list"}),icon:io,prompt:g({id:"8Anlmq",defaultMessage:"Transform this into a bulleted list."}),action:Z.EDIT},{id:"list",title:g({id:"Rm67Xw",defaultMessage:"Numbered list"}),icon:ro,prompt:g({id:"0pEdK3",defaultMessage:"Transform this into a numbered list."}),action:Z.EDIT},{id:"table",title:g({id:"zUJNQu",defaultMessage:"Table"}),icon:Dn,prompt:g({id:"BX96Lh",defaultMessage:"Transform this into a table. Add any appropriate labels to the columns or rows headers."}),action:Z.EDIT}];function Do(t){const{doc:n,selection:s}=t,{$from:a,$to:r}=s,{pos:i}=a,{pos:o}=r,c=n.textBetween(i,o);try{const l=dn(n,a),u=mn(n,r);return{sourceFrom:l,sourceTo:u,from:i,to:o,selectedText:c}}catch(l){q.logError("Getting source selection",l)}return{selectedText:c,from:i,to:o}}const Me={type:"spring",bounce:.2,duration:.5};function Ro(t){return t instanceof Da}function Ki(t){return t instanceof vo}function _o(){const t=fn(),n=gn();return d.useMemo(()=>()=>{var s;return(s=t())!=null?s:n()},[t,n])}const Ns=({title:t,icon:n,size:s,opacity:a,initialHeight:r=s,initialScale:i=1,onClick:o,isConfirming:c,isSmall:l,onSubmit:u})=>{const f=U(),b=rn(),[S,m]=d.useState(!1),w=ot(),j=()=>{m(!0)},k=()=>{m(!1)},h=e.jsx(B.div,{initial:{scale:i,opacity:0},animate:{scale:1,opacity:1,transition:{type:"spring",bounce:.24,duration:.52}},exit:{scale:.5,opacity:0,transition:{type:"spring",bounce:.24,duration:.52,opacity:{duration:.1}}},whileHover:{scale:1.15},transition:Me,children:e.jsx(B.div,{className:"flex cursor-pointer items-start overflow-hidden",initial:{width:s,height:s},animate:{width:s,height:s},transition:Me,onMouseEnter:j,onMouseLeave:k,children:c?e.jsx(B.button,{className:"m-auto flex h-8 w-8 items-center justify-center rounded-full bg-black text-center dark:bg-white",initial:{opacity:0,scale:.64},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.64},transition:{type:"spring",duration:.32,bounce:.14},onClick:u,children:e.jsx(at,{className:ae("animate-pulsing text-white dark:text-black",l?"icon":"icon-lg")})}):n})});return e.jsx(B.div,{role:"button",onClick:o,initial:{height:r},animate:{height:s,opacity:c?1:a!=null?a:.52},exit:{height:0},whileHover:{opacity:1},transition:Me,children:w?e.jsx(Ne,{open:b?!!(c||S):!1,label:f.formatMessage(t),side:"left",contentClassName:"pointer-events-none",children:h}):h})};function hs({accelerator:t,size:n,opacity:s,onClick:a,onSubmit:r,disableHeightAnimation:i=!1,disableLabel:o=!1,isCancelledScrubber:c=!1,isSmall:l=!1,isConfirming:u}){const{title:f,icon:b}=t,S=ot(),m=U();return e.jsxs("div",{className:"relative",children:[!S&&!o&&e.jsx(B.div,{className:"text-token-text-secondary absolute end-full top-1/2 w-[160px] -translate-y-1/2 transform pe-4 text-end text-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:m.formatMessage(f)}),e.jsx(Ns,{size:n,onClick:a,opacity:s,initialHeight:c||i?"auto":0,initialScale:c?.88:.5,title:f,isSmall:l,isConfirming:u,onSubmit:r,icon:e.jsx(b,{className:ae("text-token-primary m-auto",l?"icon":"icon-lg")})})]})}function No({title:t,onSubmit:n,icon:s}){const a=U(),r=s;return e.jsxs(B.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:n,className:"text-token-text-secondary hover:text-token-text-primary flex aspect-square w-20 max-w-20 min-w-20 cursor-pointer flex-col items-center rounded-2xl p-3 transition-colors hover:bg-gray-100/75 dark:hover:bg-gray-700",children:[e.jsx(r,{className:"icon-2xl m-auto"}),e.jsx("div",{className:"line-clamp-1 w-16 max-w-16 overflow-hidden text-center text-xs",children:a.formatMessage(t)})]})}function Po({grid:t,onSubmit:n,title:s}){const a=U();return e.jsxs("div",{className:"flex h-full flex-col content-center gap-y-4 overflow-x-hidden px-3 py-4",children:[e.jsx("div",{className:"text-token-primary mt-1 text-center font-medium",children:s}),e.jsx("div",{className:"flex-auto",children:e.jsx("div",{className:"grid grid-cols-2 gap-1",children:t.map((r,i)=>e.jsx(No,{title:r.title,icon:r.icon,onSubmit:o=>{const c=t[i];"prompt"in c&&(n==null||n(o,a.formatMessage(c.prompt)))}},i))})})]})}function Lo({title:t,onClick:n,isConfirming:s,onSubmit:a,isAnyItemConfirmed:r}){const i=U();return e.jsxs(B.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:n,className:ae("flex-item my-1 flex min-w-40 cursor-pointer items-center overflow-hidden rounded-2xl py-2 ps-4 pe-2 font-medium text-clip whitespace-nowrap transition-colors hover:bg-gray-100/75 dark:hover:bg-gray-700",{"bg-gray-100/50 dark:bg-gray-700/50":s,"text-token-text-secondary hover:text-token-text-primary":!s&&r}),children:[e.jsx("div",{className:"flex-auto",children:i.formatMessage(t)}),e.jsx(B.button,{className:ae("ms-3 h-6 w-6 rounded-full bg-black text-center dark:bg-white",{"pointer-events-none invisible":!s}),initial:{opacity:0,scale:.64},animate:{opacity:s?1:0,scale:s?1:.64},transition:{type:"spring",duration:.32,bounce:.14},onClick:a,children:e.jsx(at,{className:"icon-lg text-white dark:text-black"})})]})}function Oo({menu:t,onConfirm:n,onSubmit:s}){const[a,r]=d.useState(!1),i=U();return e.jsx("div",{className:"h-full flex-col content-center overflow-x-hidden px-3",children:t.map((o,c)=>e.jsx(Lo,{title:o.title,isConfirming:a===c,isAnyItemConfirmed:a!==!1,onClick:()=>{r(c),n==null||n()},onSubmit:l=>{const u=t[c];"prompt"in u&&(s==null||s(l,i.formatMessage(u.prompt)))}},"menu-item-".concat(o.title)))})}const Bo=t=>"isCancel"in t&&t.isCancel,ps=280;function Ho(t,n,s){if(s===n)return 1;const a=(t-n)/(s-n);return Rn(a,0,1)}function Fo({size:t,acceleratorScrubber:n,onConfirm:s,onCancel:a,onSubmit:r,onDragStart:i,isConfirming:o}){const{icon:c}=n,l="scrub"in n?n.scrub:[],u=6,f=t-u*2,b=U(),S=d.useRef(null),m=d.useRef(null),[w,j]=d.useState(l?Math.floor(l.length/2):0),k=Math.round(w),h=d.useRef(w),p=l?b.formatMessage(l[k].title):null,T=cn(0);ln(T,"change",C=>{const _=-137+f/2,I=(ps-u)/2-f/2,L=Ho(C,_,I)*(l?l.length-1:0);h.current=L,j(L)});const x=()=>{if(!l||Bo(l[k])||o)return a==null?void 0:a();l&&(s==null||s())},P=C=>{C.preventDefault(),!(!l||!o||!("prompt"in l[k]))&&(r==null||r(C,b.formatMessage(l[k].prompt)))};return e.jsx(B.div,{ref:S,className:"start-items relative z-20 flex w-full",style:{top:u,height:ps-u*2},children:e.jsx(B.div,{drag:"y",ref:m,dragConstraints:S,dragMomentum:!1,dragElastic:0,className:ae("border-token-border-default m-auto rounded-full border shadow-md transition-colors",o?"cursor-pointer bg-black dark:bg-white":"bg-token-main-surface-primary cursor-grab"),style:{y:T,width:f,height:f},onDragStart:i,onDragEnd:x,children:e.jsx(Ne,{open:!0,label:p,side:"right",children:e.jsx("div",{className:"flex h-full w-full items-center justify-center overflow-hidden",children:o?e.jsx(at,{onClick:P,className:"icon-xl animate-pulsing text-white dark:text-black"}):e.jsx(c,{className:"text-token-primary icon-lg m-auto"})})})})})}const $e=280,Uo=235,xs=1250,Go=56,qo=32,Ko=28;function zo({top:t}){return e.jsx(B.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute start-1/2 m-auto h-1 w-1 -translate-x-1/2 rounded-full bg-gray-300",style:{top:t}})}function Wo({bottom:t=20,right:n=20,isEmbeddedInPromptArea:s=!1,disableHint:a=!1,disableOverlay:r=!1,onCancel:i,onExpandedChange:o,onSubmit:c,isRequestActive:l=!1,isVisuallyHidden:u=!1,actions:f}){const[b,S]=d.useState(!1),[m,w]=d.useState(!a&&!l),[j,k]=d.useState(!0),[h,p]=d.useState(null),[T,x]=d.useState(!1),[P,C]=d.useState(!1),[_,I]=d.useState(!1),[N,L]=d.useState(null),[F,X]=d.useState(null),[se,K]=d.useState(null),z=!j,oe=Ra(),W=s&&!m,M=W?qo:Go,be=U(),ke=ot(),Pe=_o(),Q=d.useRef(null),O=l||b,J=l&&!m&&j;d.useEffect(()=>{m&&!P&&C(!0),o==null||o(m)},[m,P]),d.useEffect(()=>{T&&!O&&!N&&(Q.current!=null&&clearTimeout(Q.current),w(!0)),!T&&!O&&!N&&(Q.current!=null&&clearTimeout(Q.current),Q.current=window.setTimeout(()=>{w(!1),p(null),I(!1)},xs))},[T,O,N,m]),d.useEffect(()=>{if(l){p(null);return}S(!1),!P&&!a&&(C(!0),w(!0),Q.current!=null&&clearTimeout(Q.current),Q.current=window.setTimeout(()=>{w(!1),p(null),I(!1),C(!0)},xs))},[l,a,P]);const ce=E=>{p(E)},le=(E,D,R)=>{x(!1),S(!0),w(!1),p(null),I(!1),L(null),X(null),K(null);const Te=Pe(),qe=(me,ye)=>{q.logButtonClick(te.ACCELERATOR,{action:{action:R.action,id:R.id,title:R.title},prompt:D,sourceFrom:me,sourceTo:ye})};if(Te&&Ro(Te)){const{state:me}=Te,{sourceFrom:ye,sourceTo:ne}=Do(me);if(qe(ye,ne),ye==null||ne==null){c==null||c(E,null,D,R);return}c==null||c(E,{start:ye,end:ne},D,R);const Le=me.tr.setSelection(_a.create(me.doc,me.selection.anchor));Te.dispatch(Le);return}qe(),c==null||c(E,null,D,R)},ue=f[0],je=f.slice(1),de=!!N&&f.find(({id:E})=>E===N),$=!!F&&f.find(({id:E})=>E===F),G=!!se&&f.find(({id:E})=>E===se),we=(E,D)=>{if(z)return;if(!T){x(!0);return}const{id:R}=D;if("scrub"in D)return L(R);if("menu"in D)return X(R);if("grid"in D)return K(R);ce(R)},Ge=(E,D)=>{z||"prompt"in D&&le(E,be.formatMessage(D.prompt),D)},it=je.map(E=>{if(!m)return null;const{id:D}=E;return e.jsx(hs,{accelerator:E,isConfirming:D===h,isCancelledScrubber:_,size:M,onClick:R=>we(R,E),onSubmit:R=>Ge(R,E)},D)}),ve=d.useRef(null);d.useEffect(()=>{const{current:E}=ve;if(E)return wt(document,{mousedown:({target:D})=>{D instanceof HTMLElement&&!E.contains(D)&&(w(!1),p(null),I(!1),x(!1),L(null),X(null),K(null))}})},[N,F,se]);const v=Math.round($e/M)*2,V=[];let Ce=0;for(let E=0;E<v-1;E++)Ce+=$e/v,V.push(e.jsx(zo,{top:Ce}));const Se=e.jsx(B.div,{ref:ve,initial:{opacity:0,scale:.85,borderRadius:M/2},exit:{opacity:0,borderRadius:M/2},className:ae("border-token-border-default absolute overflow-visible border transition-colors select-none",po.accelerators,{"pointer-events-none":u,"bg-token-main-surface-primary shadow-xl":m&&!N&&!l,"bg-token-main-surface-primary shadow-lg":!m&&!N&&!l&&!s,"bg-token-main-surface-primary border-transparent shadow-sm":!m&&!N&&!l&&s,"bg-token-main-surface-secondary border-transparent":N&&!l,"bg-token-main-surface-primary":l&&!J,"bg-black! text-white!":!oe&&J,"bg-white! text-black!":oe&&J}),style:{right:n,bottom:t},animate:{scale:O||J||b?.85:1,opacity:u?0:1,borderRadius:F&&$&&!O||se&&G&&!O?Ko:M/2},onHoverStart:()=>{Q.current!=null&&clearTimeout(Q.current),x(!0)},onHoverEnd:()=>x(!1),children:e.jsx(_e,{children:F&&$&&"menu"in $&&!O?e.jsx(B.div,{initial:{height:M,width:M},transition:Me,animate:{height:$e,width:"auto"},exit:{height:M,width:M},children:e.jsx(Oo,{isConfirming:h===$.id,onConfirm:()=>ce($.id),onSubmit:(E,D)=>le(E,D,$),menu:$.menu})}):se&&G&&"grid"in G&&!O?e.jsx(B.div,{initial:{height:M,width:M},transition:Me,animate:{height:Uo,width:"auto"},exit:{height:M,width:M},children:e.jsx(Po,{title:be.formatMessage(G.title),onSubmit:(E,D)=>le(E,D,G),grid:G.grid})}):N&&de&&!O?e.jsxs(B.div,{initial:{height:M,width:M},transition:Me,animate:{height:$e,width:M},exit:{height:M,width:M},onClick:()=>{p(null)},children:[e.jsx(Fo,{onDragStart:()=>p(null),isConfirming:h===de.id,onConfirm:()=>ce(de.id),onSubmit:(E,D)=>le(E,D,de),onCancel:()=>{L(null),I(!0)},size:M,acceleratorScrubber:de}),V]}):e.jsxs(B.div,{className:"flex flex-col",initial:s?!1:{height:M,width:M},transition:Me,animate:{height:m?M*f.length:M,width:M},exit:{height:M,width:M},onAnimationComplete:()=>k(!0),onAnimationStart:()=>k(!1),children:[e.jsx(_e,{children:it}),e.jsx("div",{className:"flex items-center",style:{width:M,height:M},children:O?J?e.jsx(Ns,{title:Qo.cancel,icon:e.jsx(_n,{className:ae("animate-pulsing m-auto shrink-0",W?"h-6 w-6":"h-10 w-10")}),isSmall:W,opacity:1,size:M,onClick:()=>{p(null),i==null||i()}}):e.jsx(yt,{size:20,className:"text-token-text-secondary m-auto"}):e.jsx(hs,{disableHeightAnimation:s,disableLabel:ke||!m,isCancelledScrubber:_,accelerator:ue,isConfirming:h===ue.id,opacity:m?void 0:1,isSmall:W,size:M,onSubmit:E=>Ge(E,ue),onClick:E=>we(E,ue)})})]})})});return r||ke?Se:e.jsxs(e.Fragment,{children:[m&&e.jsx(Ds,{zIndexKey:"acceleratorsOverlay",className:"bg-white/95 dark:bg-black/85"}),Se]})}const Qo=ys({cancel:{id:"Hov840",defaultMessage:"Cancel"}}),Yo={type:"spring",bounce:.2,duration:.56},Zo=({clientThreadId:t,turn:n})=>{const s=Nn();return e.jsxs(B.div,{className:"absolute start-0 end-0 top-0 z-10 -translate-y-full",children:[e.jsx(B.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"bg-vert-light-gradient dark:from-token-main-surface-primary absolute inset-0 -top-5 dark:bg-linear-to-t dark:to-transparent"}),e.jsx(B.div,{className:"flex items-center py-2",initial:{opacity:.75,translateX:-50,translateY:"100%"},animate:{opacity:1,translateX:0,translateY:"0"},exit:{opacity:0,filter:"blur(8px)",transition:{delay:.4,duration:.72}},transition:Yo,children:e.jsx(yo,{clientThreadId:t,onRequestCompletion:Na,groupedMessagesToRender:n.messageGroups,allGroupedMessages:n.messageGroups,allMessages:n.messages,isUserTurn:!0,isFinalUserTurn:!1,isFinalAssistantTurn:!1,turnIndex:0,isCompletionRequestInProgress:!1,isFeedbackEnabled:!1,isFinalTurn:!1,hasActiveRequest:s})})]},"user-message")},Jo=({clientThreadId:t})=>{const{lastUserTurn:n,lastAssistantTurn:s}=St(t,r=>{const i=Ms.getConversationTurns(r);let o=null,c=null;for(let l=i.length-1;l>0;l--){const u=i[l];if(!o&&u.role===us.User?o=u:!c&&u.role===us.Assistant&&(c=u),o&&c)break}return{lastUserTurn:o,lastAssistantTurn:c}}),a=n&&!(s!=null&&s.messages.some(r=>{var i;return(i=r.recipient)==null?void 0:i.startsWith(Pn)}));return e.jsx(_e,{initial:!1,children:a&&e.jsx(Zo,{turn:n,clientThreadId:t})})},Xo=({isRequestActive:t=!1,clientThreadId:n,readonlyReason:s,onCancel:a,onSubmit:r,onSubmitAccelerator:i,acceleratorActions:o=[]})=>{var T;const[c,l]=d.useState(!1),[u,f]=d.useState(""),[b,S]=d.useState(!0),m=U(),[w,j]=d.useState(!1),k=ot(),h=x=>{r==null||r(x,u),f("")},p=x=>{if(x.nativeEvent.isComposing)return;const{metaKey:P,shiftKey:C,key:_}=x;_==="Enter"&&u.trim()&&!(C||P)&&(h(x),x.preventDefault())};return e.jsxs(e.Fragment,{children:[c&&!k&&e.jsx(Ds,{zIndexKey:"acceleratorsOverlay",className:"bg-white/95 dark:bg-black/85"}),e.jsx("div",{className:"relative mb-3 flex items-end justify-center",children:e.jsxs("div",{className:"relative mx-6 max-w-2xl flex-1",children:[e.jsx(Jo,{clientThreadId:n}),e.jsx("div",{className:"flex flex-auto items-start",children:e.jsx("div",{className:ae("dark:bg-token-main-surface-secondary flex min-h-12 flex-auto items-center bg-[#f4f4f4] py-1 ps-6 pe-2",{"rounded-full":b,"rounded-2xl":!b,"bg-transparent":w}),children:e.jsxs("div",{className:"relative flex flex-auto items-center self-stretch",children:[e.jsx(Co,{placeholder:m.formatMessage({id:"zrUbTJ",defaultMessage:"Ask ChatGPT to edit"}),disabled:t,value:u,className:ae("text-token-text-primary placeholder:text-token-text-secondary w-full resize-none border-0 bg-transparent p-0 outline-0 focus:ring-0 focus-visible:ring-0",{"opacity-0":w}),maxRows:4,onChange:({target:{value:x}})=>f(x),onKeyDown:p,onHeightChange:(x,{rowHeight:P})=>S(Math.floor(x/P)<=1)}),u?e.jsx(B.button,{className:ae("dark bg-token-main-surface-primary h-8 w-8 rounded-full text-center disabled:bg-[#D7D7D7]",{"self-end":!b}),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.1},onMouseDown:h,children:e.jsx(at,{className:"text-token-text-primary h-8 w-8"})}):((T=o==null?void 0:o.length)!=null?T:0)>0&&e.jsx(Wo,{disableHint:!0,isVisuallyHidden:(s==null?void 0:s.isReadonly)&&!s.isStreaming,disableOverlay:!0,isEmbeddedInPromptArea:!0,isRequestActive:t,actions:o,onCancel:a,onExpandedChange:x=>{k||j(x),l(x)},onSubmit:i,right:0,bottom:4})]})})})]})})]})};function $o(t,n){const s=new Set(t.map(c=>c.id)),a=new Set(n.map(c=>c.id)),r=t.filter(c=>!a.has(c.id)).map(c=>pe(he({},c),{diffStatus:Vt.REMOVED})),i=n.filter(c=>!s.has(c.id)).map(c=>pe(he({},c),{diffStatus:Vt.ADDED})),o=t.filter(c=>a.has(c.id));return r.concat(i,o)}const Vo=t=>{const{textdocId:n}=t,s=Ln(a=>{var r;return(r=a==null?void 0:a.resolveTempTextdocId[n])!=null?r:n});return d.useMemo(()=>pe(he({},t),{textdocId:s}),[s,t])};async function ei({textdocId:t,newTitle:n}){n!=null&&await xe.safePost("/textdoc/{textdoc_id}/rename",{parameters:{path:{textdoc_id:t}},requestBody:{title:n}}).catch(s=>{Es.addError("renameCanvasTitle Error:",s)})}const ti=({serverThreadId:t,textdocVersion:n,initialTitle:s="Untitled Document",isEditingTitle:a,setIsEditingTitle:r})=>{const i=st(),{mutateAsync:o}=Re({mutationKey:[t,"textdocs"],mutationFn:ei,onMutate:async({textdocId:h,newTitle:p})=>{await i.cancelQueries({queryKey:[t,"textdocs"]});const T=i.getQueryData([t,"textdocs"]);return i.setQueryData([t,"textdocs"],x=>{if(!x)return x;const P=new Map(x.persistedTextdocVersionById),C=P.get(h);if(C){const L=pe(he({},C),{title:p!=null?p:""});P.set(h,L)}const _=x.persistedTextdocVersions.map(L=>L.textdocId===h?pe(he({},L),{title:p!=null?p:""}):L),I=new Map(x.persistedTextdocById),N=I.get(h);if(N){const L=pe(he({},N),{title:p!=null?p:""});I.set(h,L)}return pe(he({},x),{persistedTextdocVersionById:P,persistedTextdocVersions:_,persistedTextdocById:I})}),{previousTextDocData:T}},retry:2,onError:(h,p,T)=>{T!=null&&T.previousTextDocData&&i.setQueryData([t,"textdocs"],T.previousTextDocData),Es.addError("Error updating title:",h)},onSettled:()=>{i.invalidateQueries({queryKey:[t,"textdocs"]})}}),c=async h=>{var p;n&&await o({textdocId:(p=n.textdocId)!=null?p:"",newTitle:h})},[l,u]=d.useState(s),f=d.useRef(null),b=d.useRef(l),S=d.useRef(!1);d.useEffect(()=>{a&&f.current&&(f.current.focus(),f.current.select())},[a]);const m=h=>{u(h.target.value)},w=()=>{b.current=l},j=async()=>{S.current||await c(l),S.current=!1,r(!1)},k=h=>{(h.key==="Enter"||h.key==="Escape")&&h.preventDefault(),h.key==="Enter"?h.currentTarget.blur():h.key==="Escape"&&(u(b.current),S.current=!0,h.currentTarget.blur())};return e.jsx("input",{className:"w-[300px] rounded-lg border-none px-3 py-2 outline-hidden focus:ring-0",ref:f,value:l,onChange:m,onFocus:w,onBlur:j,onKeyDown:k,style:{fontSize:"1.125rem",boxSizing:"border-box",backgroundColor:"var(--global-states-light-element-hover, rgba(0, 0, 0, 0.05))"}})};function si(t){const{voiceName:n}=On(),s=t?()=>ni(t.textdocId,n,Hn()):null,a="".concat(t==null?void 0:t.textdocId,".").concat(t==null?void 0:t.versionInt,".").concat(n);return Bn(s,a)}function ni(t,n,s){return xe.safeGet("/textdoc/{textdoc_id}/synthesize",{parameters:{path:{textdoc_id:t},query:{voice:n,format:s}},skipJsonTransform:!0})}const ai=({textdocVersion:t,isPersisting:n=!1,isTextdocAttachedPending:s,isTextdocStreaming:a,hasDebug:r,shouldShowPlayButton:i=!1,hideRenameButton:o=!1,toggleDebugView:c,isDebugVisible:l,toggleConsoleVisibility:u,isConsoleOpen:f,clientThreadId:b})=>{var L,F;const S=U();Fn(),si(t);const[m,w]=d.useState(!1),j=(L=t==null?void 0:t.title)!=null?L:"",k=(F=ks(b))!=null?F:"",h=nt(t==null?void 0:t.textdocId),p=!j||(h==null?void 0:h.status)===Un.INFERRING,T=()=>{w(!0)},[x,P]=d.useState(!1),{container:C,triggerRef:_}=js({isOpen:x,onClose:()=>P(!1)}),I=[!h&&!o&&!a?e.jsx(H.Item,{icon:Gn,onClick:T,children:S.formatMessage({id:"z/PT9T",defaultMessage:"Rename"})},"rename"):null,null,i?e.jsx(H.Item,{icon:qn,onClick:u,children:f?S.formatMessage({id:"owGHqE",defaultMessage:"Close console"}):S.formatMessage({id:"GPb4WX",defaultMessage:"Open console"})},"console"):null,null].filter(Boolean);if(I.length===0)return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex h-6 grow items-center overflow-hidden",children:e.jsx(Ee.Title,{className:"@[0px]:hidden @[150px]:block",children:p?e.jsx("div",{className:"w-52",children:e.jsx(ds,{lines:1,size:"base",width:100,widthVariance:0})}):j})}),n&&e.jsx(yt,{size:12,className:"text-token-text-tertiary ps-1"})]});const N=t&&e.jsx(H.Portal,{container:C,children:e.jsx(H.Content,{onCloseAutoFocus:X=>X.preventDefault(),children:I})});return e.jsx(e.Fragment,{children:m?e.jsx(ti,{serverThreadId:k,textdocVersion:t,initialTitle:j,isEditingTitle:m,setIsEditingTitle:w}):e.jsxs(e.Fragment,{children:[!1,e.jsxs(H.Root,{open:x,onOpenChange:P,children:[e.jsxs(H.Trigger,{ref:_,className:"hover:bg-token-surface-hover grid grid-cols-[1fr_auto] border-none bg-transparent! pe-2",children:[e.jsx(Ee.Title,{className:"max-w-[270px] truncate overflow-hidden",children:p?e.jsx("div",{className:"w-52",children:e.jsx(ds,{lines:1,size:"base",width:100,widthVariance:0})}):j}),e.jsx("div",{className:"flex items-center ps-1",children:n?e.jsx(yt,{size:12,className:"text-token-text-tertiary"}):e.jsx(Kn,{className:"icon-sm text-token-text-tertiary"})})]}),N]})]})})};function oi({textdocVersion:t,clientThreadId:n,color:s}){const{handleCopy:a,Icon:r,copyLabel:i}=Wa({textdocVersion:t,clientThreadId:n});return e.jsx(Ne,{label:i,children:e.jsx(Ue,{icon:r,onClick:a,color:s})})}function ii({textdocVersion:t,disabled:n,clientThreadId:s}){const a=U(),{handleFileDownload:r,handleBlobDownload:i,isLoading:o,downloadCopyLabel:c,isDocument:l}=Qa({textdocVersion:t,clientThreadId:s});return l?e.jsxs(H.Sub,{children:[e.jsx(H.SubMenuTrigger,{icon:es,label:c,disabled:o||n}),e.jsx(H.Portal,{children:e.jsxs(H.SubContent,{align:"end",children:[e.jsx(H.Item,{onClick:u=>{u.preventDefault(),r("pdf")},children:a.formatMessage({id:"canvas.download-pdf-button.menu",defaultMessage:"PDF Document (.pdf)"})}),e.jsx(H.Item,{onClick:u=>{u.preventDefault(),r("docx")},children:a.formatMessage({id:"canvas.download-docx-button.menu",defaultMessage:"Microsoft Word Document (.docx)"})}),e.jsx(H.Item,{onClick:u=>{u.preventDefault(),r("md")},children:a.formatMessage({id:"canvas.download-md-button.menu",defaultMessage:"Markdown Document (.md)"})})]})})]}):e.jsx(H.Item,{label:c,icon:es,disabled:o||n,onClick:i})}function ri(t){for(const n of ci){const s=t.match(n);if(s)return s[0]}return null}const ci=[/AKIA[0-9A-Z]{16}/,/AIza[0-9A-Za-z_-]{35}/,/^(?:ghp_[A-Za-z0-9]{36}|github_pat_[A-Za-z0-9]{22}_[A-Za-z0-9]{59}|gho_[A-Za-z0-9]{36}|ghu_[A-Za-z0-9]{36}|ghs_[A-Za-z0-9]{36}|ghr_[A-Za-z0-9]{36})$/,/xox[baprs]-[0-9A-Za-z-]+/,/sk-[A-Za-z0-9]{48}/,/SK[0-9a-fA-F]{32}/,/(sk_live_[0-9a-zA-Z]{24})|(sk_test_[0-9a-zA-Z]{24})/,/-----BEGIN PRIVATE KEY-----/],li="".concat(bo,"...");function De(t){return["canvas","textdoc","share",t]}function ui({isLoading:t,isPublishedVersionLatest:n,sharedTextdoc:s,textdocVersion:a,title:r}){const{textdocId:i}=a,[o,c]=d.useState(!1),l=ri(a.content),u=(C,_)=>{C&&Jn(C,void 0,_).then(()=>{c(!0),setTimeout(()=>{c(!1)},1500)}).catch(()=>{})},f=st(),{mutate:b,isPending:S}=Re({scope:{id:i},mutationFn:C=>xe.safePost("/textdoc/{textdoc_id}/share",{parameters:{path:{textdoc_id:C}}}).then(_=>Ve(_.shared_textdoc)),onSuccess:C=>{f.setQueryData(De(i),C),u(xt(C.sharedTextdocId))}}),{mutate:m,isSuccess:w}=Re({scope:{id:i},mutationFn:C=>xe.safePost("/textdoc/shared/{shared_textdoc_id}/update_to_latest",{parameters:{path:{shared_textdoc_id:C}}}).then(_=>Ve(_.shared_textdoc)),onSuccess:C=>{f.setQueryData(De(i),C)}}),{mutate:j}=Re({scope:{id:i},mutationFn:({sharedTextdocId:C,access:_})=>xe.safePost("/textdoc/shared/{shared_textdoc_id}/update_access",{parameters:{path:{shared_textdoc_id:C}},requestBody:{shared_textdoc_access:_}}).then(I=>Ve(I.shared_textdoc)),onMutate:({access:C})=>{const _=De(i),I=f.getQueryData(_);return f.setQueryData(_,I&&pe(he({},I),{access:C})),{previousAccess:I==null?void 0:I.access}},onSuccess:C=>{f.setQueryData(De(i),C)},onError:(C,_,I)=>{const N=De(i),L=f.getQueryData(N);f.setQueryData(N,L&&pe(he({},L),{access:I==null?void 0:I.previousAccess}))}}),k=d.useRef(null),h=C=>{var _;(_=k.current)==null||_.focus(),s?(q.logButtonClick(te.COPY_SHARE_LINK,Fe(a)),u(xt(s.sharedTextdocId),C)):(q.logButtonClick(te.CREATE_SHARE_LINK,Fe(a)),b(i))},p=C=>{s&&(q.logButtonClick(C===Xn.PUBLIC?te.UPDATE_SHARE_LINK_PUBLIC:te.UPDATE_SHARE_LINK_PRIVATE,Fe(a)),j({sharedTextdocId:s.sharedTextdocId,access:C}))},T=s?xt(s.sharedTextdocId):void 0,x=()=>{s&&(q.logButtonClick(te.UPDATE_SHARE_LINK_TO_LATEST,Fe(a)),m(s.sharedTextdocId))},P=l||(s==null?void 0:s.isAnonifyApiKeyDetected);return e.jsx(wo,{inputRef:k,isLoading:t,isPublishedVersionLatest:n,sharedObject:s&&{id:s.sharedTextdocId,title:r,access:s.access,versionInt:s.versionInt,isModerationBlocked:s.isModerationBlocked,isAnonifyApiKeyDetected:s.isAnonifyApiKeyDetected},title:r,shareTextPlaceholder:li,shareUrl:T,isCopySuccessful:o,didPublishUpdates:w,isCreateLinkRequestInProgress:S,handleUpdateLatestSharedVersion:x,handlePrivacyChange:p,handlePrimaryButtonClick:h,maybeRenderWarndingContent:()=>e.jsx(e.Fragment,{children:P&&e.jsx(mi,{})})})}function Fe(t){return{textdocType:t.type,textdocId:t.textdocId}}function di({textdocVersion:t,isDisabled:n,title:s}){const a=Pa(),r=U(),i=t==null?void 0:t.textdocId,{data:o,isLoading:c}=bs({enabled:!!i&&!n,queryKey:De(i),queryFn:()=>!i||i.startsWith(Vn)?Promise.resolve(null):xe.safeGet("/textdoc/{textdoc_id}/share",{parameters:{path:{textdoc_id:i}}}).then(k=>k.shared_textdoc&&Ve(k.shared_textdoc))}),[l,u]=d.useState(!1),{triggerRef:f,container:b}=js({isOpen:l,onClose:()=>u(!1)}),S=(a==null?void 0:a.isWorkspaceAccount())&&!(a!=null&&a.features.includes(zn.WorkspaceShareLinks));if(n||S||!t)return e.jsx(Ne,{label:S?r.formatMessage(vt.workspaceSharingDisabled):r.formatMessage(vt.share),children:e.jsx(Ue,{disabled:!0,icon:ts})});const m=()=>{q.logButtonClick(te.OPEN_SHARE_MENU,Fe(t))},w=(o==null?void 0:o.versionInt)===t.versionInt&&(o==null?void 0:o.title)===t.title,j=({className:k})=>e.jsxs("div",{className:"relative h-fit w-fit",children:[e.jsx(ts,{className:k}),!w&&o&&e.jsx("div",{className:"absolute end-0 top-[1px] flex items-center gap-1.5",children:e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-blue-400"})})]});return e.jsxs(Wn,{open:l,onOpenChange:u,children:[e.jsx(Ne,{label:r.formatMessage(vt.share),children:e.jsx(Qn,{ref:f,asChild:!0,children:e.jsx(Ue,{icon:j,onClick:m})})}),e.jsx(_e,{children:l&&e.jsx(Yn,{forceMount:!0,container:b,children:e.jsx(Zn,{align:"end",className:"z-50",sideOffset:8,collisionPadding:8,children:e.jsx(ui,{title:s,sharedTextdoc:o,isLoading:c,isPublishedVersionLatest:w,textdocVersion:t})})})})]})}function mi(){return e.jsx($n,{type:"danger",className:"w-auto md:p-3",children:e.jsx(Ct,{id:"8NG6sN",defaultMessage:"There may be an API key in your canvas. If you share the canvas, anyone with the link can see its contents."})})}function fi({disabled:t=!1,isShowingChanges:n,onMouseEnter:s,onClick:a,onEsc:r}){const i=U(),o=d.useRef(null);return d.useEffect(()=>{if(n){const c=l=>{l.key==="Escape"&&(r==null||r(),o.current&&o.current===document.activeElement&&o.current.blur())};return window.document.addEventListener("keydown",c),()=>{window.document.removeEventListener("keydown",c)}}},[n,r]),e.jsx(Ne,{label:!t&&i.formatMessage(n?vs.hideChanges:vs.showChanges),children:e.jsx(Ue,{icon:So,ref:o,disabled:t,onClick:a,onMouseEnter:s,className:ae("transition-colors enabled:hover:bg-black/5 dark:enabled:hover:bg-white/10",n&&xo)})})}const vs=ys({showChanges:{id:"3jMGNS",defaultMessage:"Show changes"},hideChanges:{id:"HWiQSk",defaultMessage:"Hide changes"}}),gi=({clientThreadId:t,isHistoricalVersion:n,textdocVersion:s,readonlyReason:a,hasDebug:r,isEmbedded:i,isPersisting:o,isShowingChanges:c,hideRunCode:l=!1,hideHistoryActions:u=!1,hideRenameButton:f=!1,onHoverPrevious:b,onHoverShowChanges:S,onToggleShowChanges:m,onClickPrevious:w,onClickNext:j,onClickCodePreview:k,onClose:h,toggleDebugView:p,toggleConsoleVisibility:T,isCodeRunning:x,isTextdocAttachedPending:P,isTextdocStreaming:C,isConsoleOpen:_,isDebugVisible:I})=>{var $,G;const N=U(),L=La(),F=nt(s==null?void 0:s.textdocId),X=($=s==null?void 0:s.title)!=null?$:"",{isCodePreviewable:se,isCodeExecutable:K,hasCanvasCodeExecution:z}=_s(s),oe=(G=s==null?void 0:s.metadata)==null?void 0:G.hive_id,W=As(),M=oe!=null&&Is(W,"292227286"),{mutate:be,isPending:ke}=Re({scope:{id:oe!=null?oe:""},mutationFn:we=>xe.safePost("/hive/{hive_id}/send_summary_to_slack",{parameters:{path:{hive_id:we}}})}),Pe=()=>{oe&&be(oe)},Q=!l&&(se||K),O=s==null?void 0:s.versionInt,J=O!=null&&O>1,ce=n,le=!u,ue=se&&x,je=s==null||F!=null||n||a.isStreaming,de=s==null||a.isStreaming;return e.jsxs(Ee.Header,{className:ae("@container",se&&x&&"bg-transparent!"),children:[e.jsx(Ee.CloseButton,{onClick:h}),e.jsx("div",{className:"@container flex flex-1 basis-0 items-center truncate leading-[0]",children:e.jsx(ai,{hasDebug:r,isConsoleOpen:_,isDebugVisible:I,toggleConsoleVisibility:T,toggleDebugView:p,isPersisting:o,textdocVersion:s,isTextdocAttachedPending:P,isTextdocStreaming:C,shouldShowPlayButton:Q,hideRenameButton:f,clientThreadId:t})}),e.jsxs("div",{className:"flex min-w-0 basis-auto items-center leading-[0] select-none",children:[e.jsx(oi,{clientThreadId:t,textdocVersion:s}),e.jsx(di,{isDisabled:je,textdocVersion:s,title:X}),le&&e.jsx(_e,{children:e.jsx(B.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,width:0},transition:{type:"spring",bounce:.24,duration:.4},children:e.jsx(fi,{disabled:ue||a.isStreaming||!J,isShowingChanges:c,onMouseEnter:S,onClick:m,onEsc:m})})}),e.jsxs(H.Root,{children:[e.jsx(H.BasicTrigger,{children:e.jsx(Ue,{icon:Oa})}),e.jsx(H.Portal,{children:e.jsxs(H.Content,{align:"end",children:[e.jsx(H.Item,{icon:ea,disabled:!J,onClick:w,onMouseOver:b,label:N.formatMessage({id:"PoD5+8",defaultMessage:"Previous version"})}),e.jsx(H.Item,{icon:ta,disabled:!ce,onClick:j,label:N.formatMessage({id:"PJ8YVJ",defaultMessage:"Next version"})}),e.jsxs(H.Group,{children:[s&&s.type!==Be.LOADING&&F==null&&e.jsx(ii,{disabled:de,textdocVersion:s,clientThreadId:t}),M&&e.jsx(H.Item,{icon:Ba,disabled:ke,onClick:Pe,label:N.formatMessage({id:"CRHbjv",defaultMessage:"Send to Slack"})})]})]})})]}),Q&&e.jsx(uo,{clientThreadId:t,isCodePreviewable:se,isDisabled:!z||a.isTextdocStreaming&&!x,disabledTooltip:z?void 0:N.formatMessage({id:"NTZRWe",defaultMessage:"Code execution for canvas is disabled for your workspace. Contact your admin to enable."}),onClick:k,isCodeRunning:x}),!i&&!L&&e.jsx(To,{clientThreadId:t})]})]})};function hi(t){const n=/\[([^\]]+)\]\((https?:\/\/[^\s)]+|www\.[^\s)]+)\)/gi,s=new Set,a=t.matchAll(n);for(const r of a){const i=r[2];try{let o=i;o.startsWith("www.")&&(o="http://"+i),new URL(o),s.add(i)}catch(o){}}return s}const pi=async({lastVersion:t,textdocId:n,content:s,comments:a})=>{const r=sa(a,s);return(await xe.safePost("/textdoc/{textdoc_id}",{parameters:{path:{textdoc_id:n}},requestBody:{version:t,content:s,comments:r}})).version},xi=()=>{const t=d.useRef([]),n=d.useRef(null),{mutateAsync:s,isPending:a}=Re({mutationKey:["canvas","textdoc","persist"],mutationFn:pi});return[d.useCallback(async(i,o,c)=>{const l=new AbortController,f=(async()=>{var j,k;const[w]=t.current;try{await(w==null?void 0:w.promise)}catch(h){q.logError("Saving document",h)}if(!l.signal.aborted)try{const h=Math.max((j=n.current)!=null?j:0,(k=i.versionInt)!=null?k:Ss);let p="";try{gs(o)?p=o():p=o}catch(C){q.logError("Serializing document",C)}let T=[];try{gs(c)?T=c():T=c}catch(C){q.logError("Adjusting comments",C)}const{textdocId:x}=i;na({textdocId:x,basedOnVersionInt:h,content:p,comments:T});const P=await s({textdocId:x,lastVersion:h,content:p,comments:T});aa({textdocId:x,basedOnVersionInt:h,newVersion:P}),n.current=P}catch(h){q.logError("Error saving document",h)}finally{t.current.shift()}})(),b={abort:()=>l.abort(),promise:f},[S,m]=t.current;return m&&(m.abort(),t.current=S?[S]:[]),t.current=S?[S,b]:[b],f},[s]),t,a]},vi=3e3,Ci=t=>{const[n,s,a]=xi(),r=U(),i=d.useRef(null),o=d.useCallback(Ha(async(u,f,b)=>{if(!bt(u))return n(u,f,b);tt.replaceTempTextdocContent(u.textdocId,typeof f=="string"?f:f())},vi,{leading:!1}),[n]),c=oa(t);return d.useEffect(()=>{if(!c)return;const u=wt(window,{pagehide:()=>o.flush(),beforeunload:b=>{o.flush(),b.returnValue=r.formatMessage({id:"QZrKwi",defaultMessage:"You have a canvas save in progress."})}}),f=wt(document,{visibilitychange:()=>o.flush(),keydown:()=>{i.current="keyboard"},mousemove:()=>{i.current!=="mouse"&&o.flush(),i.current="mouse"}});return()=>{i.current=null,f(),u()}},[r,c,o]),d.useEffect(()=>()=>{o.flush()},[t,o]),ia(async()=>{var u,f;await o.flush(),await Promise.allSettled((f=(u=s.current)==null?void 0:u.map(({promise:b})=>b))!=null?f:[])}),[d.useCallback((u,f,b)=>{const{textdocId:S}=u;return bt(u)||ra(S),o(u,f,b)},[o]),o.flush,a||c]};function yi(t,n,s){const a=st(),r=s!=null&&n!=null,{data:i,error:o,fetchNextPage:c,hasNextPage:l,isFetching:u}=un(Cs(t,n,r)),f=d.useCallback(async()=>{const j=n!=null;await a.prefetchInfiniteQuery(Cs(t,n,j))},[a,t,n]);d.useEffect(()=>{const j=n;return()=>{a.removeQueries({queryKey:Ps(t,j),exact:!0})}},[a,t,n]);const[b,S,m,w]=d.useMemo(()=>{var k;if(i&&s){const h=i.pages.flatMap(T=>T),p=h.findIndex(T=>{var x;return"beforeVersion"in s?((x=T.versionInt)!=null?x:Ss)<s.beforeVersion:T.versionInt===s.version});if(p!==-1)return[p===h.length-1,h[p],p>0?h[p-1]:null,p<h.length-1?h[p+1]:null]}const j=(k=i==null?void 0:i.pages.flatMap(h=>h))!=null?k:[];return[!0,null,null,j.length===0?null:j[0]]},[i,s]);return d.useEffect(()=>{!u&&r&&l&&b&&c()},[u,r,l,b,c]),d.useEffect(()=>{!S&&o&&He(t)},[S,o,t]),{historicalTextdocVersion:S,nextHistoricalTextdocVersion:m,prefetchHistoricalTextdocVersion:f,previousHistoricalTextdocVersion:w}}function Ps(t,n=null){return["textdocHistory",t,n]}function Cs(t,n,s=!0){return{queryKey:Ps(t,n),queryFn:({pageParam:a})=>bi(t,a),initialPageParam:n!=null?n:void 0,getNextPageParam:a=>{var i;const r=(i=Fa(a))==null?void 0:i.versionInt;if(r&&r>1)return r},enabled:s,staleTime:1/0,retry:2}}async function bi(t,n){return n===void 0||n<=1?[]:(await xe.safeGet("/textdoc/{textdoc_id}/history",{parameters:{path:{textdoc_id:t},query:{before_version:n}}})).previous_doc_states.map(({id:a,version:r,textdoc_type:i,title:o,content:c,updated_at:l,comments:u,metadata:f})=>({textdocId:a,versionInt:r,messageId:null,title:o,type:la(i),content:c,status:ws.COMPLETE,createdAt:Ua(l),comments:ca(u,c),metadata:{content_references:f==null?void 0:f.content_references,hive_id:f==null?void 0:f.hive_id}}))}const zi=({isFullScreen:t=!1,isEmbedded:n=!1,hideHeader:s=!1,hideRunCode:a=!1,isReadonlyFromQueryParam:r=!1,hideRenameButton:i=!1,clientThreadId:o,focusedTextdoc:c,onClose:l,isAnimating:u=!1,width:f,hideBottomComposer:b=!1})=>{"use no forget";var Wt,Qt,Yt,Zt;const S=As(),{textdocId:m,history:w,showChangesAtVersion:j=null,shouldRunCodeOnOpen:k=!1}=Vo(c),h=U(),[p,T,x]=Ci(m),{targetedContent:P}=ua(),C=da(),[_,I]=d.useState(!1),[N,L]=d.useState(!1),F=ma(m),X=fa(),se=St(o,Ms.getRequestId),K=ga(se),{data:z,isLoading:oe}=bs(pt(m,j)),[W,M]=d.useState(!1),[be,ke]=d.useState(null),Pe=ha(o),Q=d.useRef(null),O=(Wt=F==null?void 0:F.versions)!=null?Wt:[],J=(Qt=O[0])==null?void 0:Qt.versionInt,{historicalTextdocVersion:ce,nextHistoricalTextdocVersion:le,previousHistoricalTextdocVersion:ue,prefetchHistoricalTextdocVersion:je}=yi(m,J,w),de=st();d.useEffect(()=>{et.reset()},[m]);const $=O.length>0?O[O.length-1]:null,G=O.length>1?O[O.length-2]:null,we=ks(o),{restoreHistoricalTextdocVersion:Ge,optimisticRestoredTextdocVersion:it}=pa(we,$,ce),ve=w!=null,v=ve?ce:$,V=j!=null,Ce=hn(o,v),Se=u?null:z,D=(()=>{if(u||v==null)return[];const y=ms(v.comments);return!V&&ce!=null?ce.comments:!V||z==null?y:z.contentBefore!==z.contentAfter?[]:$o(z.commentsBefore,z.commentsAfter)})(),R=(Yt=v==null?void 0:v.type)!=null?Yt:Be.LOADING,Te=Ya({textdocVersion:v,clientThreadId:o}),qe=d.useCallback(()=>{var A,Y;const y=(Y=(A=window.getSelection())==null?void 0:A.toString())!=null?Y:"";Te({source:"keyboard",selectedText:y,productLogOnly:!0})},[Te]),me=xa(),ye=bt(v),ne=va(v),Le=Ca(v),Tt=ya(v),Ls=Tt&&!n,Os=fs(X),Bs=fs(K);d.useEffect(()=>{!ye&&O.length===0&&me!==ss.NATIVE&&(!X&&Os.current||!K&&Bs.current||!X&&!K)&&(l==null||l())},[O.length,X,K]);const{content:ee,currentlyStreamingLineIndex:Ke}=(z==null?void 0:z.contentBefore)!=null&&!ns(R)?{content:z.contentBefore,currentlyStreamingLineIndex:null}:Za(v,G),Hs=ba(we,Array.from(hi(ee))),[ze,rt]=jo({value:ee,isRequestActive:K,isTextdocStreaming:ne,comments:D}),Mt=wa(v),Et=me===ss.LAST_TURN||ze||x;d.useEffect(()=>{Sa().sendMessage({type:Rs.Streaming,streaming:Et})},[Et]);const Fs=({getSerializedDocument:y,getAdjustedComments:A})=>{v&&p(v,y,A)},Us=y=>{var Y;if(!v)return;const A=y.doc.toString();p(v,A,(Y=y.field(yn,!1))!=null?Y:[])},kt=(y,A,Y,ge,Ae)=>{rt(!0),Ce({sourceEvent:y,action:Y,content:A,userMessageType:Je.ASK_CHATGPT,sourceRange:ge,selectionMetadata:{selection_type:Ae,selection_position_range:ge}})},jt=({id:y})=>{Mt(y,is.DISMISS),et.reset()},At=async(y,A)=>{rt(!0);const{id:Y,at:ge,content:Ae}=A;if(await Mt(Y,is.ACCEPT)===!1)return rt(!1);Ce({sourceEvent:y,content:Ae,userMessageType:Je.ACCEPT_COMMENT,sourceRange:ge,action:Z.EDIT,selectionMetadata:{selection_type:$t.SELECTION,selection_position_range:ge}})},ct=(y,A,Y,ge)=>{const{action:Ae}=ge;Ce({sourceEvent:y,action:Ae,content:Y,sourceRange:A,userMessageType:Je.ACCELERATOR,acceleratorMetadata:{action:Ae,id:ge.id,prompt:Y},selectionMetadata:A!=null?{selection_type:$t.SELECTION,selection_position_range:A}:void 0})},Gs=(y,A)=>{Ce({sourceEvent:y,action:Z.EDIT,content:A,userMessageType:Je.FULL_SCREEN_SUBMIT})},lt=Ta(),It=y=>{var A;return(A=lt==null?void 0:lt[y])!=null?A:y},ut=()=>Ma(o,void 0,{clientInitiated:!0,reason:"textdoc_canvas_cancel"}),qs=()=>{w?Xe(m,w):He(m)},ie=mo({streamingSource:me,isRestoring:it!=null,isRequestActive:K,isTextdocStreaming:ne,isReadonlyFromQueryParam:r,isHistoricalVersion:ve,isShowingChanges:V});let We=null;const Dt=u||ie.isReadonly||ze,Qe=Ts()||Pe||r||ye,Rt=()=>u&&D.length>0?Ie.ALL_HIDDEN:Qe?Ie.COMMENTS_READONLY:ie.isReadonly?ie.isStreaming?Ie.ENABLED:ie.isReadonlyFromQueryParam||ie.isShowingChanges||ie.isHistoricalVersion?Ie.COMMENTS_READONLY:Ie.ALL_HIDDEN:Ie.ENABLED,Ks=d.useCallback(async y=>{const{suggestion:A}=await xe.safePost("/textdoc/{textdoc_id}/autocomplete",{parameters:{path:{textdoc_id:m}},requestBody:{content:y}});return A},[m]),_t=t||u||r;let dt=[];switch(R){case Be.LOADING:We=e.jsx($a,{});break;case Be.DOCUMENT:We=e.jsx(Xa,{value:ee,comments:D,previousValue:G==null?void 0:G.content,getAutocompleteSuggestion:Ks,previousComments:ms(G==null?void 0:G.comments),isRewriting:Le,isAnimatingFromPreview:u,isSendDisabled:Qe,getStableCommentId:It,diff:Se,isRequestActive:K,isDisabled:ie.isReadonly||X,isWaitingForCommentResponse:ze,hideAccelerators:_t,hideToolbar:Dt,hideEditOverlay:u,commentsMode:Rt(),readonlyReason:ie,onBlur:T,onSave:T,onChange:Fs,onCancelRequest:ut,targetedContent:P,onAddComment:kt,onAcceptComment:At,onDismissComment:jt,onSubmitAccelerator:ct,onExitShowChanges:qs,safeUrls:Hs,width:f,modelCursor:Tt||ne&&!Le?v==null?void 0:v.modelCursor:void 0,shouldResetSelection:(v==null?void 0:v.versionInt)===1,metadata:F==null?void 0:F.metadata}),dt=Io;break;default:ns(R)&&(We=e.jsx(Ja,{id:"codemirror",getStableCommentId:It,language:fo(R),value:ee,comments:D,hideAccelerators:_t,commentsMode:Rt(),hideToolbar:Dt,onSubmitAccelerator:ct,currentlyStreamingLineIndex:Ke!=null?Ke:null,readonlyReason:ie,isRequestActive:K,isSendDisabled:Qe,isWaitingForCommentResponse:ze,onChange:Us,onCancelRequest:ut,onAddComment:kt,onBlur:T,onSave:T,codemirrorRef:Q,onDismissComment:jt,onAcceptComment:At,textdocDiff:Se!=null?Se:void 0,modelCursor:ne&&Ke==null?v==null?void 0:v.modelCursor:void 0}),dt=ko)}const Oe=d.useRef(null),mt=d.useRef(null),{hasCanvasCodeExecution:ft,isCodeExecutable:Nt,isCodePreviewable:fe}=_s(v),Pt=ft&&fe,Lt=ft&&Nt,zs=Ea(),Ot=d.useCallback(()=>{var y,A;!W&&(Pt||Lt)?(M(!0),(y=Oe.current)==null||y.runCode(R,ee)):((A=Oe.current)==null||A.stopCode(),M(!1))},[Pt,Lt,W,ee,R]),Bt=ka(()=>{Ot()});d.useEffect(()=>{k&&Bt()},[k,Bt]);const re=v==null?void 0:v.versionInt,Ws=re!=null&&re>1,Qs=ve,Ye=ue==null?void 0:ue.versionInt,gt=le==null?void 0:le.versionInt,Ys=()=>{V?w?Xe(m,w):He(m):(q.logButtonClick(te.SHOW_CHANGES,{textdocType:R,textdocId:m,versionInt:re,latestVersionInt:J}),re&&rs(m,re,w))},Zs=()=>{q.logButtonClick(te.HISTORY_PREVIOUS,{textdocType:R,textdocId:m,versionInt:re,latestVersionInt:J,isShowingChanges:V}),m&&re&&Ws&&Xe(m,{beforeVersion:re},V&&Ye!=null?Ye:void 0)},Js=()=>{q.logButtonClick(te.HISTORY_NEXT,{textdocType:R,textdocId:m,versionInt:re,latestVersionInt:J,isShowingChanges:V}),Qs&&(gt?Xe(m,{version:gt},V?gt:void 0):V&&J?rs(m,J,null):He(m))},Xs=Is(S,"1804926979"),Ht=St(o,Mo(m)),$s=Ga(),Ft=nt(v==null?void 0:v.textdocId),Vs=!s&&e.jsx(gi,{hideRunCode:a,clientThreadId:o,isHistoricalVersion:ve,textdocVersion:v,readonlyReason:ie,hasDebug:C,isEmbedded:n,isPersisting:x,isShowingChanges:V,isConsoleOpen:N,isDebugVisible:_,hideHistoryActions:r,hideRenameButton:i,onHoverPrevious:()=>{je(),Ye&&de.prefetchQuery(pt(m,Ye))},onHoverShowChanges:()=>{je(),re&&de.prefetchQuery(pt(m,re))},onToggleShowChanges:Ys,onClickPrevious:Zs,onClickNext:Js,toggleDebugView:()=>I(y=>!y),toggleConsoleVisibility:()=>{N||za.logEvent("Canvas Open Console Clicked"),L(y=>!y)},onClose:()=>{if(q.logButtonClick(te.CLOSE_TEXTDOC,{textdocType:v==null?void 0:v.type}),Ft&&!t){const{create_source:y,hasUserEdits:A,tempTextdocId:Y}=Ft;if(A&&y!==os.USER_CREATED_COMPOSER){qt(!0);return}if(tt.removeTempTextdoc(Y),y===os.USER_CREATED_COMPOSER){const ge=qa($s);Ka(ge,ee)}}l==null||l()},onClickCodePreview:Ot,isCodeRunning:W,isTextdocStreaming:ne,isTextdocAttachedPending:as(v)});let Ut=null;const Ze=!a&&ft&&(Nt||fe),ht=go(R,ee);d.useEffect(()=>{var y;Ze&&ht&&((y=mt.current)==null||y.prepareEnvironment(ee,ht))},[Ze,ht]),d.useEffect(()=>{var y;fe&&W&&!ne&&((y=Oe.current)==null||y.runCode(R,ee))},[fe,ne,ee,R]);const Gt=(Zt=v==null?void 0:v.title)!=null?Zt:"";Ze&&(Ut=e.jsx(pn,{id:m,title:Gt,onChangeBackgroundColor:ke,onCodeRunComplete:()=>M(!1),visuallyHidden:!fe||!W,disableNetworkRequests:!zs,networkAccessDeniedMessage:h.formatMessage({id:"GE4AJf",defaultMessage:"Network requests in canvas are disabled for your workspace. Contact your admin to enable this feature."}),enableTransition:fe&&R!==Be.CODE_HTML,isCodeUpdating:ne,ref:mt,onRetryCodeRun:()=>{var y;return(y=Oe.current)==null?void 0:y.runCode(R,ee)}}));const[en,qt]=d.useState(!1),Kt=e.jsx(Eo,{isOpen:en,dismissModal:()=>qt(!1),closeTextdocEditor:()=>{l==null||l()},textdocVersion:v,clientThreadId:o}),zt=e.jsxs(e.Fragment,{children:[Vs,e.jsx(Ee.Content,{scrollToBottomMode:Ls?"bottom":"top",shouldScrollToTop:Le,isLoading:oe,hideChildren:fe&&W,overlay:Ut,onCopy:qe,children:We}),Ze&&e.jsx(xn,{ref:Oe,sandboxRef:mt,textdocId:m,textdocTitle:Gt,textdocContent:ee,isTextdocAttachedPending:as(v),highlightLine:y=>{var A;return(A=Q.current)==null?void 0:A.highlightLine(y)},isRequestActive:K,createTextdocTurn:Ce,isOpen:N,onOpenChange:L}),e.jsx(_e,{children:ve&&!r&&e.jsx(Ao,{onClickRestore:Ge,onClickResetLatest:()=>He(m)})}),t&&!ve&&!b&&!(W&&fe)&&!Qe&&e.jsx(Xo,{isRequestActive:K,clientThreadId:o,onSubmitAccelerator:ct,onSubmit:Gs,onCancel:ut,readonlyReason:ie,acceleratorActions:dt})]});if(Xs&&Ht&&v){const A=new URLSearchParams(window.location.search).get(vn),Y=A==null?void 0:parseInt(A);return e.jsxs(e.Fragment,{children:[Kt,e.jsx(Ee,{previewBackgroundColor:be,isPreviewingCode:fe&&W,children:e.jsxs("div",{className:"flex h-full",children:[e.jsx("div",{className:"relative flex h-full min-h-0 flex-auto grow flex-col",children:zt}),e.jsx(Cn,{hiveId:Ht,clientThreadId:o,textdocVersion:v,ts:Y})]})})]})}return e.jsxs(e.Fragment,{children:[Kt,e.jsx(Ee,{previewBackgroundColor:be,isPreviewingCode:fe&&W,children:zt})]})};export{Rs as C,Wo as D,zi as T,ko as a,qi as b,Io as c,Ki as d,Do as g,Ro as i,_o as u};
//# sourceMappingURL=m1gt25yur8ncekq0.js.map
