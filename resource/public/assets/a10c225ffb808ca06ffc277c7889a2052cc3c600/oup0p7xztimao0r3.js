var z=Object.freeze,V=Object.defineProperty,ae=Object.defineProperties;var se=Object.getOwnPropertyDescriptors;var X=Object.getOwnPropertySymbols;var te=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var Y=(a,s,t)=>s in a?V(a,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[s]=t,l=(a,s)=>{for(var t in s||(s={}))te.call(s,t)&&Y(a,t,s[t]);if(X)for(var t of X(s))oe.call(s,t)&&Y(a,t,s[t]);return a},M=(a,s)=>ae(a,se(s));var $=(a,s)=>z(V(a,"raw",{value:z(s||a.slice())}));import{b as R,d as ne,j as e,M as f,x as E,r as L,u as re}from"./jj85rqzpbnvv3emr.js";import{lT as b,ai as de,lU as le,lV as F,g2 as ie,lW as ue,d5 as H,lX as ce,ga as U,bg as me,g7 as fe,gd as ge,gb as pe,gc as Me}from"./mclphevd122040jw.js";import{aE as xe,i as he,j as Se,f as Pe,C as ye,E as je,ez as A,F as Ne}from"./lef5ym39glv4981l.js";import{B as Te}from"./bm60ocel3j0ixm99.js";const C=30;function G(a){if(!D(a))return null;const s=a==null?void 0:a.redemption;return s!=null&&s.redeemed_by_workspace?s:null}function D(a){return(a==null?void 0:a.coupon)===b}function W(a){var i,u;const s=G(a);if(!s)return null;const t=(u=(i=s.redeemed_at)!=null?i:s.workspace_redeemed_at)!=null?u:s.user_redeemed_at;if(!t)return null;const n=new Date(t);return Number.isNaN(n.getTime())?null:n}function B(a){const s=be(a);return s?Date.now()<s.getTime():!1}function be(a){var r;const s=G(a);if(!s)return null;const t=s.expires_at;if(t){const g=new Date(t);return Number.isNaN(g.getTime())?null:g}const n=W(a);if(!n)return null;const i=(r=s.promotion_length_days)!=null?r:C,u=new Date(n.getTime()+i*24*60*60*1e3);return Number.isNaN(u.getTime())?null:u}function De(a){if(!D(a))return null;const s=a==null?void 0:a.redemption,t=s==null?void 0:s.promotion_length_days;return typeof t=="number"&&Number.isFinite(t)?t:C}function ve({seatsEntitled:a}){var S;const{data:s}=de(),t=xe(),n=he(),i=Se(n,"3954884439",{disableExposureLog:!1}),{eligible:u,seatThresholdGap:r,promoEligibility:g}=le(a),c=((S=t==null?void 0:t.isTeam())!=null?S:!1)&&!!(s!=null&&s.will_renew)&&i,d=c&&u&&(r!=null?r:0)>0,o=d&&r!=null?{type:"seatsPromo",seatThresholdGap:r,discountPercent:F}:void 0,p=B(g),h=c&&!d&&p,x=c&&o&&D(g)?o:void 0;return{promoEligibility:g,seatThresholdGap:r,shouldShowFreeSeatsCta:d,shouldShowSeatsPromoRedemptionNotice:h,seatsPromoContext:x}}const _=ne({seatsPromoRedemptionSummary:{id:"teamsManageSeatsModal.seatsPromoRedemptionSummary",defaultMessage:"Promotional {promoName} redeemed{hasDate, select, true { on {date}} other {}}."},seatsPromoRedemptionDiscountInfo:{id:"teamsManageSeatsModal.seatsPromoRedemptionDiscountInfo",defaultMessage:"Promotional discount is active for {promotionDurationIsMonth, select, true {1 month} other {{promotionDuration, plural, one {# day} other {# days}}}}."},seatsPromoRedemptionDefaultName:{id:"teamsManageSeatsModal.seatsPromoRedemptionDefaultName",defaultMessage:"promotion"},seatPromotionDiscountName25Percent:{id:"teamsManageSeatsModal.seatPromotionDiscountName25Percent",defaultMessage:"{discountPercent}% discount on plan"}});function J({promoEligibility:a,discountPercent:s=F}){var d,o;const t=R();if(!D(a))return null;const n=G(a);if(!a||!(n!=null&&n.redeemed_by_workspace))return null;const i=(d=W(a))!=null?d:void 0,u=!!i,r=(o=n.promotion_length_days)!=null?o:C,g=r===30;let c=a.coupon?a.coupon.split("_").map(p=>p.charAt(0).toUpperCase()+p.slice(1)).join(" "):t.formatMessage(_.seatsPromoRedemptionDefaultName);return a.coupon===b&&(c=t.formatMessage(_.seatPromotionDiscountName25Percent,{discountPercent:s})),e.jsxs("div",{className:"mb-3 rounded-lg bg-[#E0FFE7] px-4 py-3 text-sm text-[#24622B]",children:[e.jsx("div",{className:"font-medium",children:e.jsx(f,M(l({},_.seatsPromoRedemptionSummary),{values:{promoName:c,hasDate:u?"true":"false",date:u?e.jsx(E,{value:i,year:"numeric",month:"long",day:"numeric"}):void 0}}))}),e.jsx("div",{className:"mt-1 text-xs",children:e.jsx(f,M(l({},_.seatsPromoRedemptionDiscountInfo),{values:{promotionDuration:r,promotionDurationIsMonth:g?"true":"false"}}))})]})}var K;const we=Ne.p(K||(K=$(["text-base font-semibold mb-3 mt-3"]))),_e=({onClose:a,initialTeamBillingType:s,initialSeats:t,accountId:n,renewalDate:i,billingDetails:u})=>{const r=R(),g=Pe(),[c,d]=L.useState(t),[o,p]=L.useState(!1),[h,x]=L.useState(!1),S=re(),{flexibleBillingPlan:k,annualBillingPlan:v}=ie(u.currency),j=s===H.FLEXIBLE?k:v,I=ue(n),N=async({promoCampaign:Q}={})=>{x(!0);try{await I.mutateAsync({accountId:n,updatedPriceInterval:void 0,updatedSeats:c,updatedPromoCampaign:Q}),Q===b&&await S.invalidateQueries({queryKey:["promoCampaignEligibility",b]}),x(!1),g.success(r.formatMessage({id:"teamBilling.successfullyUpdatedSubscription",defaultMessage:"Your subscription was updated successfully"}),{hasCloseButton:!0}),p(!1),a()}catch(Fe){g.warning(r.formatMessage({id:"teamBilling.errorUpdatingSubscription",defaultMessage:"There was a problem updating your subscription"}),{hasCloseButton:!0})}finally{x(!1)}},T=()=>{p(!1),d(t),a()},{promoEligibility:P,seatsPromoContext:y}=ve({seatsEntitled:t}),O=Math.max(0,c-t),w=(y==null?void 0:y.type)==="seatsPromo"&&O>=y.seatThresholdGap,q=s===H.FLEXIBLE,Z=q&&B(P),ee=q&&D(P)&&(w||Z);return e.jsx(ye,{testId:"modal-teams-manage-seats",type:"success",isOpen:!0,onClose:T,size:"custom",noPadding:!0,className:"max-w-2xl",showCloseButton:!0,title:o?r.formatMessage({id:"teamsManageSeatsModal.title",defaultMessage:"Manage seats"}):r.formatMessage({id:"teamsManageSeatsModalConfirmPage.title",defaultMessage:"Review"}),children:o?e.jsx(Re,{numSeats:c,initialSeats:t,handleUpdate:N,isUpdating:h,renewalDate:i,accountId:n,selectedPlanBillingInfo:j,onClose:T,promoEligibility:P}):e.jsx(Ae,{selectedPlan:s,selectedPlanBillingInfo:j,numSeats:c,initialSeats:t,setNumSeats:d,renewalDate:i,setConfirmPage:p,billingDetails:u,promoContext:y,handleUpdate:N,isUpdating:h,promoEligibility:P,seatsPromoDiscountActive:ee})})};function Ae({selectedPlan:a,selectedPlanBillingInfo:s,numSeats:t,initialSeats:n,setNumSeats:i,setConfirmPage:u,billingDetails:r,handleUpdate:g,isUpdating:c,renewalDate:d,promoContext:o,promoEligibility:p,seatsPromoDiscountActive:h}){var w;const x=R(),S=me(isNaN(t)?0:t,n,fe),k=Math.max(0,t-n),v=(o==null?void 0:o.type)==="seatsPromo"?Math.max(o.seatThresholdGap-k,0):0,j=(o==null?void 0:o.type)==="seatsPromo"&&typeof o.discountPercent=="number"?o.discountPercent:F,I=h?Number((S*s.discountedMonthlyCost*(j/100)).toFixed(2)):void 0,N=(o==null?void 0:o.type)==="seatsPromo"&&o.seatThresholdGap>0,T=N&&v===0,P=(w=De(p))!=null?w:C,y=P===30,O=B(p);return e.jsxs("div",{className:"grid grid-flow-row grid-cols-2",children:[e.jsxs("div",{className:"flex flex-col gap-4 p-5",children:[N&&e.jsx("div",{className:"rounded-lg border border-[#C5CEFF] bg-[#ECF0FF] px-4 py-3 text-sm text-[#262B72]",children:T?e.jsx(f,M(l({},m.seatsPromoQualified),{values:{seatCount:o.seatThresholdGap,promotionDuration:P,promotionDurationIsMonth:y?"true":"false",discountPercent:j}})):e.jsx(f,M(l({},m.seatsPromoReminder),{values:{remainingSeats:v,promotionDuration:P,promotionDurationIsMonth:y?"true":"false",discountPercent:j}}))}),e.jsx(ge,{numSeats:t,minSeats:n,setNumSeats:i}),e.jsx(pe,{className:"col-span-2 grid md:col-span-1 md:grid-cols-1",defaultValue:a,children:e.jsx(Me,M(l({billingType:a},s),{selectedValue:a}))})]}),e.jsxs("div",{className:"border-token-bg-tertiary bg-token-bg-elevated-secondary col-span-3 flex h-full flex-col overflow-hidden border-s p-6 md:col-span-1",children:[e.jsx(we,{children:e.jsx(f,l({},U.summaryTitle))}),e.jsx(Te,{numSeats:S,selectedPlan:a,billingDetails:r,totalLabel:U.allPlansTotal,billDate:e.jsx(E,{value:d,year:"numeric",month:"long",day:"numeric"}),extraDiscountAmount:I,footerNote:h?e.jsx(f,l({},m.promoTaxesFeesDisclaimer)):void 0}),O&&e.jsx("div",{className:"mt-3",children:e.jsx(J,{promoEligibility:p,discountPercent:j})}),T?e.jsx(A,{title:x.formatMessage(m.addSeats),disabled:S===n,onClick:()=>g({promoCampaign:b}),loading:c,className:"w-full rounded-xl",color:"primary"}):e.jsx(A,{title:x.formatMessage(m.continue),disabled:S===n,onClick:()=>u(!0),className:"w-full rounded-xl",color:"primary"})]})]})}function Re({numSeats:a,initialSeats:s,renewalDate:t,handleUpdate:n,isUpdating:i,accountId:u,selectedPlanBillingInfo:r,onClose:g,promoEligibility:c}){const d=R(),{data:o,isError:p,isLoading:h}=ce(u,a),x=B(c);if(h)return e.jsx("div",{className:"flex items-center justify-center py-32",children:e.jsx(je,{})});if(!(p||!o))return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:e.jsx(f,M(l({},m.additionalSeats),{values:{additionalSeats:a-s}}))}),e.jsx("span",{className:"font-semibold",children:e.jsx(f,M(l({},m.additionalSeatsTotal),{values:{currencySign:d.formatMessage(r.currencySign),totalCost:(o.total_amount/100).toFixed(2)}}))})]}),e.jsx("span",{className:"text-token-text-secondary text-sm",children:e.jsx(f,l({},m.proratedAmountMessage))}),e.jsx("span",{className:"bg-token-bg-secondary text-token-text-secondary mt-4 flex flex-col rounded-2xl p-4 text-sm",children:e.jsx(f,M(l({},m.chargeMessage),{values:{numSeats:a,date:e.jsx(E,{value:t,year:"numeric",month:"long",day:"numeric"})}}))}),x&&e.jsx("div",{className:"mt-4",children:e.jsx(J,{promoEligibility:c,discountPercent:F})}),e.jsx("hr",{className:"mt-4"}),e.jsxs("div",{className:"mt-4 flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:e.jsx(f,l({},m.subtotal))}),e.jsx("span",{children:e.jsx(f,M(l({},m.subtotalPrice),{values:{currencySign:d.formatMessage(r.currencySign),totalCost:(o.amount_excluding_tax/100).toFixed(2)}}))})]}),e.jsxs("div",{className:"mt-2 flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:e.jsx(f,l({},m.tax))}),e.jsx("span",{children:e.jsx(f,M(l({},m.taxAmount),{values:{currencySign:d.formatMessage(r.currencySign),tax:(o.tax_amount/100).toFixed(2)}}))})]}),e.jsxs("div",{className:"mt-2 flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:e.jsx(f,l({},m.totalDueToday))}),e.jsx("span",{className:"font-semibold",children:e.jsx(f,M(l({},m.totalDueTodayAmount),{values:{currencySign:d.formatMessage(r.currencySign),totalCost:(o.total_amount/100).toFixed(2)}}))})]}),e.jsx("hr",{className:"mt-4"}),e.jsxs("div",{className:"mt-6 flex justify-end gap-2",children:[e.jsx(A,{title:d.formatMessage(U.cancel),color:"secondary",onClick:g,disabled:i}),e.jsx(A,{title:d.formatMessage(m.addSeats),color:"primary",onClick:n,loading:i})]})]})}const m={continue:{id:"teamsManageSeatsModal.continue",defaultMessage:"Continue",description:"Continue button for manage seats modal"},addSeats:{id:"teamsManageSeatsModal.addSeats",defaultMessage:"Add seats",description:"Team manage seats modal add seats button"},tax:{id:"teamsManageSeatsModal.tax",defaultMessage:"Tax",description:"Tax label"},subtotal:{id:"teamsManageSeatsModal.subTotal",defaultMessage:"Subtotal",description:"Subtotal label"},proratedAmountMessage:{id:"teamsManageSeatsModal.proratedAmountMessage",defaultMessage:"Prorated amount until next billing cycle",description:"Informing user that they will be charged a prorated amount today"},chargeMessage:{id:"teamsManageSeatsModal.chargeMessage",defaultMessage:"You will be charged for {numSeats} total seats at your next renewal on {date}",description:"Number of additional seats being purchased"},additionalSeats:{id:"teamsManageSeatsModal.additionalSeats",defaultMessage:"{additionalSeats} additional {additionalSeats, plural, one {seat} other {seats}}",description:"Number of additional seats being purchased"},additionalSeatsTotal:{id:"teamsManageSeatsModal.additionalSeatsTotal",defaultMessage:"{currencySign}{totalCost}",description:"Summary total of selected plan"},subtotalPrice:{id:"teamsManageSeatsModal.subtotalPrice",defaultMessage:"{currencySign}{totalCost}",description:"Subtotal price for selected plan"},taxAmount:{id:"teamsManageSeatsModal.taxAmount",defaultMessage:"{currencySign}{tax}",description:"Tax amount"},totalDueToday:{id:"teamsManageSeatsModal.totalDueToday",defaultMessage:"Total due today",description:"Total due today label"},totalDueTodayAmount:{id:"teamsManageSeatsModal.totalDueTodayAmount",defaultMessage:"{currencySign}{totalCost}",description:"Total due today"},seatsPromoReminder:{id:"teamsManageSeatsModal.seatsPromoReminder",defaultMessage:"Add {remainingSeats, plural, one {# more seat} other {# more seats}} to get {discountPercent}% off your plan for {promotionDurationIsMonth, select, true {1 month} other {{promotionDuration, plural, one {# day} other {# days}}}}.",description:"Promo banner reminder while additional seats are still required"},seatsPromoQualified:{id:"teamsManageSeatsModal.seatsPromoQualified",defaultMessage:"You're all set! Purchasing {seatCount, plural, one {# seat} other {# seats}} gets you {discountPercent}% off your plan for {promotionDurationIsMonth, select, true {1 month} other {{promotionDuration, plural, one {# day} other {# days}}}}.",description:"Promo banner shown after the user selects enough seats"},promoTaxesFeesDisclaimer:{id:"teamsManageSeatsModal.promoTaxesFeesDisclaimer",defaultMessage:"Plus any applicable taxes and fees.",description:"Disclaimer shown when the promo-qualified flow skips the tax breakdown"}},Le=Object.freeze(Object.defineProperty({__proto__:null,TeamManageSeatsModal:_e},Symbol.toStringTag,{value:"Module"}));export{J as T,_e as a,Le as t,ve as u};
//# sourceMappingURL=oup0p7xztimao0r3.js.map
