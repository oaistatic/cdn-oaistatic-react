var B=Object.defineProperty;var R=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var k=(s,t,n)=>t in s?B(s,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[t]=n,I=(s,t)=>{for(var n in t||(t={}))q.call(t,n)&&k(s,n,t[n]);if(R)for(var n of R(t))z.call(t,n)&&k(s,n,t[n]);return s};import{j as e,M as r,r as o,b as U,u as H}from"./jj85rqzpbnvv3emr.js";import{i6 as E,g_ as D,B as _,lC as Q,fz as F,py as Y,aE as V,fM as $,fN as J,eq as w,es as A,pz as K,v as W,C as X,pq as O,nM as Z,I as ee,aA as se,z as te}from"./lef5ym39glv4981l.js";import{gt as P,hf as p,c3 as ne,hg as ae}from"./mclphevd122040jw.js";import{G as oe}from"./ob2j26h01aw8qfch.js";function ie({onClose:s}){const t=Q("installations/select_target");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-0 mb-4 flex justify-center",children:e.jsx("div",{className:"bg-tertiary border-token-border-subtle rounded-lg border p-3",children:e.jsx(E,{className:"h-10 w-10"})})}),e.jsx("h2",{className:"mb-6 text-center text-xl font-semibold",children:e.jsx(r,{id:"e7S220",defaultMessage:"One last step"})}),e.jsxs("div",{className:"bg-tertiary border-token-border-subtle mb-6 flex items-start gap-3 rounded-lg border p-4",children:[e.jsx(D,{className:"icon mt-0.5"}),e.jsxs("div",{className:"flex flex-grow flex-col gap-1",children:[e.jsx("span",{className:"font-medium",children:e.jsx(r,{id:"MQhj3s",defaultMessage:"Configure your repositories"})}),e.jsx("span",{className:"text-token-text-tertiary text-sm",children:e.jsx(r,{id:"ZvosJF",defaultMessage:"You still need to choose the repositories ChatGPT can access."})})]})]}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs(_,{className:"w-full",size:"large",onClick:()=>{window.open(t,"_blank"),s(!1)},children:[e.jsx(r,{id:"o1jiyf",defaultMessage:"Configure Repositories on GitHub"}),e.jsx(P,{className:"icon-sm ms-2 inline-block"})]})})]})}const re=({connectorLink:s,isLoading:t,onClose:n,onContinue:l})=>{var b;const x=U(),c=H(),[d,M]=o.useState(""),[m,G]=o.useState(new Map),g=ne(d,500),{data:h,isLoading:T,isFetchingNextPage:v,hasNextPage:C,fetchNextPage:y}=ae({enabled:!!s,debouncedSearchTerm:g,linkId:(b=s==null?void 0:s.id)!=null?b:""}),{mutateAsync:j,isPending:S}=Z(),f=o.useCallback(async()=>{if(s)try{await j({link:s,user_extension:{type:"GithubUserApiExtension",opted_in_repository_ids:Array.from(m.keys())}}),c.invalidateQueries({queryKey:["user_connection_sync_configuration"]}),l({reposToIndex:Array.from(m.values()).filter(a=>!a.is_code_search_indexed).map(a=>a.repository_full_name)})}catch(a){}},[s,j,m,c,l]),u=o.useMemo(()=>{var a;return(a=h==null?void 0:h.pages.flatMap(L=>L.repos))!=null?a:[]},[h]),i=u.length>5||!!g,N=T||t;return e.jsxs(e.Fragment,{children:[e.jsx(O,{title:e.jsx(r,{id:"BhSDq8",defaultMessage:"Which repositories do you use?"}),connectorIcon:e.jsx("div",{className:"rounded-xl border-[0.5px] p-2 shadow-sm",children:e.jsx(E,{className:"icon-2xl"})}),onClose:()=>n(!1)}),e.jsx("div",{className:"text-token-text-secondary mt-2 mb-6 text-center text-sm",children:i?e.jsx(r,{id:"o+DCDE",defaultMessage:"Choose up to 5. These repositories will sync with ChatGPT for improved speed and quality. Not seeing a repository? <link>Learn more</link>",values:{link:a=>e.jsx("a",{href:"https://help.openai.com/en/articles/11145903-chatgpt-connectors",target:"_blank",rel:"noopener noreferrer",className:"underline",children:a})}}):e.jsx(r,{id:"8FVBwU",defaultMessage:"These repositories will sync with ChatGPT for improved speed and quality. Not seeing a repository? <link>Learn more</link>",values:{link:a=>e.jsx("a",{href:"https://help.openai.com/en/articles/11145903-chatgpt-connectors",target:"_blank",rel:"noopener noreferrer",className:"underline",children:a})}})}),i&&e.jsx(ee,{ariaLabel:x.formatMessage({id:"D2Xhv1",defaultMessage:"Search repositories"}),autoComplete:"off",className:"mb-2",icon:se,iconPosition:"left",name:"search-repos",onChange:a=>{M(a.target.value)},placeholder:x.formatMessage({id:"jYgjAb",defaultMessage:"Search repositories"})}),e.jsx(oe,{allRepos:u,fetchNextPage:y,hasNextPage:C,isFetchingNextPage:v,isLoading:N,onChange:G,searchTerm:g,selectedRepos:m}),e.jsx(_,{className:"mt-2 w-full",disabled:N,loading:S,onClick:()=>{m.size===0?l({reposToIndex:[]}):f()},size:"large",children:e.jsx(r,I({},te.continueButtonText))})]})},le=({isLoading:s,onClose:t,reposToIndex:n})=>e.jsxs(e.Fragment,{children:[e.jsx(O,{title:e.jsx(r,{id:"hxqAFz",defaultMessage:"Complete setup"}),connectorIcon:e.jsx("div",{className:"rounded-xl border-[0.5px] p-2 shadow-sm",children:e.jsx(E,{className:"icon-2xl"})}),onClose:()=>t(!1)}),e.jsx("div",{className:"text-token-text-secondary mt-2 mb-6 text-center text-sm",children:e.jsx(r,{id:"IQqMC0",defaultMessage:"Your repositories must be indexed by GitHub before they can be accessed by ChatGPT. GitHub will open in a new tab, and automatically close. Indexing should complete in 5-10 minutes."})}),e.jsxs(_,{className:"mt-2 w-full",loading:s,onClick:()=>{window.open("https://github.com/search?q=".concat(n.map(l=>"repo:".concat(l)).join("+"),"&type=code"),"_blank"),t(!1)},size:"large",children:[e.jsx(r,{id:"CfvY9y",defaultMessage:"Start indexing on GitHub"}),e.jsx(P,{className:"icon-sm ms-2 inline-block"})]})]});function xe({initialState:s=p.ConfigureRepos,onClose:t,onFinishFlow:n}){var b;const l=F(),x=Y(),c=V(),[d,M]=o.useState(s),[m,G]=o.useState([]),{platformConnectors:g,isLoading:h}=$(!0),{connectorLinks:T,isLoading:v}=J({fetchValidLinksOnly:!0}),C=g.get(w[A.GITHUB_CONNECTOR]),y=(b=T.get(w[A.GITHUB_CONNECTOR]))==null?void 0:b[0],{isLoading:j,isEnabled:S}=K(),f=h||v||j,u=o.useCallback(a=>{t(a)},[t]),i=o.useCallback(()=>{u(!1),n==null||n()},[u,n]),N=o.useMemo(()=>{switch(d){case p.ConfigureRepos:return e.jsx(ie,{onClose:()=>u(!1)});case p.SyncRepos:return l&&!x&&e.jsx(re,{connector:C,connectorLink:y,isLoading:f,onContinue:({reposToIndex:a})=>{a.length>0?(G(a),M(p.IndexRepos)):i()},onClose:i});case p.IndexRepos:return e.jsx(le,{isLoading:f,onClose:i,reposToIndex:m})}},[d,m,u,C,y,f,l,x,i]);return o.useEffect(()=>{!l&&d===p.SyncRepos&&u(!1)},[l,d,u]),o.useEffect(()=>{x&&d===p.SyncRepos&&i()},[x,d,i]),o.useEffect(()=>{!(c!=null&&c.isPersonalAccount())&&(c==null?void 0:c.planType)!==W.SELF_SERVE_BUSINESS&&!S&&i()},[c,i,S]),e.jsx(X,{className:"max-w-[400px] px-2",hideSeparator:!0,isOpen:!0,onClose:()=>u(!1),showCloseButton:d===p.ConfigureRepos,title:d===p.ConfigureRepos?e.jsx("span",{}):void 0,testId:"modal-github-onboarding",type:"success",children:N})}export{xe as GithubOnboardingModal};
//# sourceMappingURL=oxo0r33hqmhdtptf.js.map
