var ie=Object.defineProperty,le=Object.defineProperties;var ce=Object.getOwnPropertyDescriptors;var pt=Object.getOwnPropertySymbols;var de=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var gt=(t,o,s)=>o in t?ie(t,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[o]=s,ht=(t,o)=>{for(var s in o||(o={}))de.call(o,s)&&gt(t,s,o[s]);if(pt)for(var s of pt(o))ue.call(o,s)&&gt(t,s,o[s]);return t},bt=(t,o)=>le(t,ce(o));import{r as E,j as e,as as Et,at as me,au as xt,J as fe,K as Tt,m as D,b as kt,d as Bt,A as $,M as pe}from"./jj85rqzpbnvv3emr.js";import{c as ge,a as he,s as be,g as Ee,b as xe,d as Te,P as tt,T as vt}from"./j5a15g8dl19lg071.js";import{dI as ve,_ as Ae,e as H,x as Ie,hB as Ne,cX as Dt,qu as Ht,lW as Oe,ax as Me,i as Vt,aj as Ce,O as At,rf as _e,rg as It}from"./lef5ym39glv4981l.js";import{b as Se,g as Pe,u as Wt,D as Re,c as we}from"./m1gt25yur8ncekq0.js";import{b as ye,T as Le,a as je,c as B,A as Nt,u as ke,i as Be,C as De,g as Ot}from"./iwpn1avuswb5fupo.js";import{c as He}from"./g9xi6m5yzu4rtfn2.js";import{M as Ve,S as We,d as Xe,e as Fe,h as Mt,i as Ge,C as et}from"./kq1ir6pxp9hst9p9.js";import{e as nt,g as ze,f as Xt,c as U}from"./erm6n5lmbxodgs50.js";import{T as Ct,Z as Ue,C as Ye}from"./nfygy4vif6crzpny.js";import{bb as Ft,eE as Gt,nX as C,oI as $e,b as Je,nY as L,hj as Ze,dr as qe,ca as Ke,eD as zt,l$ as Qe}from"./mclphevd122040jw.js";import{u as Ut}from"./lbaueofbjv8jfqwm.js";import{a as _t}from"./dbde1xv38cr6eaxy.js";import{t as to,B as eo,I as oo}from"./fvu3mi2kgug0sbba.js";import{H as so,P as no}from"./em4qf21fn7t7dhqg.js";import{S as ao,a as ro}from"./e7x7d5n09czu7psh.js";import{S as io}from"./gwaaxp36jr4o1a8o.js";import"./gvtmvkg8brwofs4l.js";import"./iqw8c7pica2coyb9.js";import"./g2yrrlnprx92uhjb.js";import"./c5142ccw2kqju3lk.js";import"./moqemqor8gto0ynb.js";import"./lep2wptoy14cfe2w.js";import"./l66h8h301eaq59ck.js";import"./hzcock7l6ec8fnr2.js";import"./fue7kd61xxcv74sk.js";import"./ng0sx063g0r0whhb.js";import"./fvmxudg74tbhlabl.js";import"./hnotrmacgvnfyexv.js";import"./irqko7c1s7qpl41n.js";import"./bx2wdn43543b9ysc.js";import"./n5wrqpcxv1sjah44.js";import"./kkl7694f44ns8yp6.js";import"./mw2u7timj0qnsnvj.js";import"./dvqe6kc43fkjsavv.js";import"./nq5i976pifkrt40a.js";import"./fnnulb9pmlo3cgid.js";import"./bw8gyicptzfjwyk2.js";import"./ns51nblw8ziscsgd.js";import"./f3wj76d1ulqyss85.js";import"./b2bzebhpy3vjflr5.js";import"./kl7c6054usfnqmd4.js";import"./k97n0y6ba9c9h39c.js";import"./hhs3uwxj7uii5eg7.js";import"./zta1pq4ds1hak11y.js";import"./dl9z2ehd50icy9od.js";import"./doljxy43e4xie9bi.js";function lo(t,o){E.useEffect(()=>{const s=t==null?void 0:t.current;if(s!=null)return ve(s,{mousedown:u=>{var m;((m=o.current)==null?void 0:m.maybeFocusOnEditor(u))===!0&&u.preventDefault()}})},[o,t])}const co=({wrapperClassName:t,value:o="",width:s,comments:u,paddingBottom:m})=>{const c=E.useRef(null),r=E.useRef(null),d=Ae();return E.useEffect(()=>{const{current:f}=c;if(f)return r.current=ge({mount:f,comments:u,value:o,isDarkMode:d}),()=>{var i;(i=r.current)==null||i.destroy()}},[]),E.useEffect(()=>{var i;const f=he(o,u);(i=r.current)==null||i.updateState(f)},[o,u]),e.jsx("div",{className:t,children:e.jsx("div",{ref:Ft(c),className:H(be.main,"markdown prose dark:prose-invert focus:outline-hidden"),style:{width:s,paddingBottom:m}})})},Yt=t=>!t||"docView"in t&&t.docView==null||ye(t.state.doc),Y=100,uo={type:"spring",duration:1.5,bounce:.1},mo={type:"spring",duration:.5,bounce:0},St={type:"spring",duration:.2},Pt={type:"spring",duration:1,delay:.1},fo={type:"spring",duration:1},po={type:"spring",duration:.5,bounce:0},go=({isRewriting:t=!1,value:o,previousValue:s,previousComments:u,documentWidth:m,paddingBottom:c,onStart:r})=>{const d=nt(),f=Et(0),i=Et(-Y),T=E.useRef(!1),[v,l]=me(),[{height:A},a]=Ut(),g=Gt();Ie(()=>{const n=d();return n&&(n.dom.style.clipPath="inset(0 0 100% 0)"),()=>{const b=d();b&&(b.dom.style.clipPath="")}},[]),E.useEffect(()=>{var b;const n=d();if(!n||Yt(n))return v||l==null?void 0:l();try{const x=(b=ze(n.state.doc))==null?void 0:b.end;if(x==null||x>o.length)return;const{top:O}=n.coordsAtPos(0),{top:P,bottom:M}=n.coordsAtPos(Math.max(n.state.doc.content.size-1,0),-1),I=M-O,_=P-O;if(f.set(I-_),!v){xt(i,I+2*f.get(),mo).then(()=>l==null?void 0:l());return}xt(i,I,uo)}catch(x){C.logError("Failed to set rewrite animation position",x),l==null||l()}},[v,o]);const h=fe(i,n=>Ne(n)-Y+2);return Tt(i,"change",n=>{const b=d();!b||!n||!T.current||(b.dom.style.clipPath="inset(0 0 calc(100% - ".concat(n,"px) 0)"))}),Tt(i,"animationStart",()=>{t&&(r==null||r())}),e.jsxs(e.Fragment,{children:[g&&e.jsx(D.div,{style:{visibility:"hidden",pointerEvents:"none",height:A},initial:!1,exit:{height:0},transition:{delay:.1,duration:.8,ease:"easeOut"}}),e.jsx(D.div,{className:"absolute top-0 z-10 w-full origin-bottom bg-linear-to-t from-[var(--canvas-bg,var(--bg-primary))] from-10% to-transparent",style:{translateY:h,height:Y},initial:{opacity:0},animate:{opacity:1,transition:St},exit:{opacity:0,transition:Pt},onAnimationComplete:()=>T.current=!0},"wash-top"),e.jsx(D.div,{className:"absolute top-0 z-10 w-full bg-linear-to-b from-[var(--canvas-bg,var(--bg-primary))] to-transparent",style:{translateY:i,height:Y},initial:{opacity:0},animate:{opacity:1,transition:St},exit:{opacity:0,transition:Pt}},"wash-bottom"),e.jsx(D.div,{ref:a,className:"pointer-events-none absolute z-0 max-w-full min-w-0",initial:{opacity:1},animate:{opacity:.3,transition:fo},exit:{opacity:0,transition:po},children:e.jsx(co,{value:s,width:m,comments:u,wrapperClassName:"h-fit flex",paddingBottom:c})},"previousValue")]})};function Rt(t,o){if(t==null)return!1;const s=t.state.schema.marks[o];return s==null?!1:to(t.state,t.dispatch,s)}function ot(t,o){if(t==null)return!1;const{state:s,dispatch:u}=t,m=Dt(s.schema.nodes[so.proseMirrorNodeName()]);return Ht(m,{level:o})(s,u)}function ho(t){if(t==null)return!1;const{state:o,dispatch:s}=t,u=Dt(o.schema.nodes[no.proseMirrorNodeName()]);return Ht(u)(o,s)}const bo=({availableWidth:t,onAddComment:o,isSendDisabled:s=!1,isWaitingForCommentResponse:u=!1,onSubmitAccelerator:m})=>{const c=kt(),r=nt(),d=Xt(),f=$e(),i=E.useCallback(a=>{const{width:g,height:h}=a,n=r();if(!d||!n||Yt(n))return null;const{to:b,empty:x,head:O}=d.selection,{platform:P}=Je(),M=P==="web"?O:b,I=M===b;if(x||!_t(n.state.doc,M))return null;const{right:_,left:R,top:W}=n.coordsAtPos(0);let w=M,j=n.state.doc.nodeAt(w);const X=I?-1:1;for(;!(j!=null&&j.isText)&&_t(n.state.doc,w+X);)w+=X,j=n.state.doc.nodeAt(w);const{left:V,bottom:F,top:J}=n.coordsAtPos(w,I?-1:1),k=_-R;function Z(){if(I)return Math.max(V-R-g,0);let N=V-R;return N+g>k&&(N=-(g-k)),N}function at(){const N=window.innerHeight-F>h*2;return I&&N?{top:F-W+8,aboveOrBelow:Nt.BELOW}:{top:J-W-h-8,aboveOrBelow:Nt.ABOVE}}const y=at();return{left:Z(),top:y.top,aboveOrBelow:y.aboveOrBelow,toolbarSize:a}},[d,r]),T=E.useCallback(()=>{var a,g;return(g=(a=r())==null?void 0:a.dom)!=null?g:null},[r]),v=[{label:c.formatMessage(S.heading1),className:"text-5xl font-semibold",onClick:()=>{C.logButtonClick(L.TOOLBAR_FORMAT_HEADER1),ot(r(),1)}},{label:c.formatMessage(S.heading2),className:"text-3xl font-semibold",onClick:()=>{C.logButtonClick(L.TOOLBAR_FORMAT_HEADER2),ot(r(),2)}},{label:c.formatMessage(S.heading3),className:"text-2xl font-semibold",onClick:()=>{C.logButtonClick(L.TOOLBAR_FORMAT_HEADER3),ot(r(),3)}},{label:c.formatMessage(S.body),className:"text-base",onClick:()=>{C.logButtonClick(L.TOOLBAR_FORMAT_PARAGRAPH),ho(r())}}],l=()=>{const a=r();if(!a)return null;const{state:g}=a,{from:h,to:n,sourceFrom:b,sourceTo:x}=Pe(g);return h==null||n==null||b==null||x==null?(C.logError("Prosemirror getSelectionRange has null values",null,{from:h,to:n,sourceFrom:b,sourceTo:x}),null):{from:h,to:n,sourceFrom:b,sourceTo:x}},A=(a,g,h)=>{const n=r(),b=l();if(b==null)return;const{sourceFrom:x,sourceTo:O}=b,P={start:x,end:O};if(d&&n){const M=d.tr.setSelection(Oe.create(d.doc,d.selection.anchor));n.dispatch(M)}C.logButtonClick(L.TOOLBAR_FORMAT_STYLE,{action:{action:h.action,id:h.id,title:h.title},prompt:g,sourceFrom:x,sourceTo:O}),m==null||m(a,P,c.formatMessage(g),h)};return e.jsxs(Le,{isWaitingForCommentResponse:u,isSendDisabled:s,onAddComment:o,toolbarType:je.WRITING,getToolbarPosition:i,getEditorDom:T,getSelectionRange:l,children:[f&&e.jsxs(e.Fragment,{children:[e.jsx(B.Separator,{}),e.jsx(B.Popover,{label:c.formatMessage(S.format),hideLabel:t<=400,icon:Ze,align:"center",children:e.jsx("div",{className:H("border-token-border-default bg-token-main-surface-primary flex w-48 flex-col items-stretch rounded-xl border p-1",Ct),children:Se.map(a=>{const{title:g,icon:h}=a;return e.jsxs("button",{onClick:n=>{"prompt"in a&&A(n,a.prompt,a)},className:"bg-token-main-surface-primary dark:hover:bg-token-main-surface-secondary flex flex-row items-center gap-x-2 rounded-md p-3 hover:bg-[#f5f5f5]",children:[e.jsx("div",{className:"flex",children:e.jsx(h,{className:"icon"})}),e.jsx("div",{className:"line-clamp-1 flex-auto text-start text-sm",children:c.formatMessage(g)})]},a.id)})})})]}),e.jsx(B.Separator,{}),e.jsx(B.Action,{label:c.formatMessage(S.bold),hideLabel:!0,icon:ao,onClick:()=>{C.logButtonClick(L.TOOLBAR_FORMAT_BOLD),Rt(r(),eo.proseMirrorMarkName())},onMouseDown:a=>a.preventDefault()}),e.jsx(B.Action,{label:c.formatMessage(S.italic),hideLabel:!0,icon:ro,onClick:()=>{C.logButtonClick(L.TOOLBAR_FORMAT_ITALIC),Rt(r(),oo.proseMirrorMarkName())},onMouseDown:a=>a.preventDefault()}),e.jsx(B.Popover,{label:c.formatMessage(S.format),hideLabel:!0,icon:io,children:e.jsx("div",{className:H("border-token-border-default bg-token-main-surface-primary flex flex-col items-stretch rounded-xl border p-1",Ct),children:v.map(({label:a,className:g,onClick:h})=>e.jsx("button",{onClick:h,className:"hover:bg-token-main-surface-secondary w-full rounded-xl p-4 text-start",children:e.jsx("div",{className:g,children:a})},a))})})]})},S=Bt({bold:{id:"qqbk91",defaultMessage:"Bold"},italic:{id:"5oh4LV",defaultMessage:"Italic"},format:{id:"z8IGv0",defaultMessage:"Transform"},heading1:{id:"AR5o30",defaultMessage:"Heading 1"},heading2:{id:"zb/wrc",defaultMessage:"Heading 2"},heading3:{id:"xZJvLM",defaultMessage:"Heading 3"},body:{id:"Hi6z3L",defaultMessage:"Body"},caption:{id:"VXpL7v",defaultMessage:"Caption"},bullets:{id:"2vznKX",defaultMessage:"Bullets"},outline:{id:"Xmbt6r",defaultMessage:"Outline"},table:{id:"0UjL6P",defaultMessage:"Table"}});function wt({position:t,numEdits:o,closestEditId:s}){const u=Wt(),m=kt(),c=t==="top"?qe:Ke,r=()=>{const f=u();if(!f||!s)return;const i=Ee(f,s);if(i.length===0){Me.addError("Edit could not be found while attempting to scroll",{closestEditId:s});return}i[t==="top"?0:i.length-1].scrollIntoView({behavior:"smooth",block:"center"})},d=t==="top"?-4:4;return e.jsx($,{children:o>0&&e.jsx(D.div,{className:H("absolute start-1/2 z-20 select-none",{"bottom-[20px]":t==="bottom","top-[20px]":t==="top"}),initial:{scale:.95,translateY:d,translateX:"-50%",opacity:0},animate:{scale:1,translateY:0,translateX:"-50%",opacity:1},exit:{scale:.95,translateY:d,translateX:"-50%",opacity:0},transition:{type:"spring",duration:.3},children:e.jsxs("div",{className:H("flex items-center justify-center rounded-full border px-4 py-2","border-token-main-surface-tertiary bg-token-main-surface-primary hover:bg-token-main-surface-secondary shadow-md"),"aria-label":m.formatMessage(yt.ariaLabel),role:"button",onClick:r,children:[e.jsx(pe,bt(ht({},yt.label),{values:{count:o}})),e.jsx(c,{className:"icon-sm ms-2"})]})})})}const yt=Bt({label:{id:"Pf30w4",defaultMessage:"{count, plural, one {1 more edit} other {{count} more edits}}"},ariaLabel:{id:"qTJjzl",defaultMessage:"Button to scroll the next edit into view."}});function Eo({diff:t=null}){var f;const o=Vt(),s=Wt(),[u,m]=E.useState([]),[c,r]=E.useState([]),d=E.useCallback(()=>{const i=s();if(!i||!t)return;const T=[],v=[];for(const l of t.edits){const A=xe(i,l.id);if(A.length>0){const a=Te(A);a.bottom<0?T.push([l.id,a]):a.top>zt(o).height&&v.push([l.id,a])}}T.sort(([,l],[,A])=>l.bottom-A.bottom),v.sort(([,l],[,A])=>l.top-A.top),m(T.map(([l])=>l)),r(v.map(([l])=>l))},[o,t,s]);return ke((f=t==null?void 0:t.edits)!=null?f:[],d),E.useEffect(()=>{const i=setTimeout(d,500);return()=>{clearTimeout(i)}},[d]),e.jsxs(e.Fragment,{children:[e.jsx(wt,{position:"top",numEdits:u.length,closestEditId:u[u.length-1]}),e.jsx(wt,{position:"bottom",numEdits:c.length,closestEditId:c[0]})]})}const st=Ce(()=>({rejectedEdits:new Set,hoveredEditId:null})),{setState:Es}=st,xo=({pos:t})=>{var n;const o=nt()(),s=Xt();if(!o||!s||t==null)return null;const{doc:u}=s,{top:m,left:c}=o.coordsAtPos(0),{top:r,left:d}=o.coordsAtPos(t),f=u.nodeAt(t),i=t+((n=f==null?void 0:f.nodeSize)!=null?n:0)-1,{top:T}=o.coordsAtPos(t+1),{top:v,bottom:l,right:A}=o.coordsAtPos(i),g=(T>=v?A:o.dom.getBoundingClientRect().right)-d,h=l-r+4;return e.jsx(D.div,{style:{top:r-m,left:d-c,height:h,width:g},className:H("absolute after:absolute after:inset-x-[-4px] after:inset-y-0 after:z-0 after:rounded-md after:bg-[Highlight] after:content-[''] dark:after:bg-[Highlight]",Ue.blockCommentHover),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0}})},To=({pos:t})=>e.jsx($,{children:t!=null&&e.jsx(xo,{pos:t})}),Lt=24,vo=16,Ao=0,Io=8,jt=4,xs=({comments:t,diff:o,readonlyReason:s,isDisabled:u=!1,isRewriting:m=!1,isSendDisabled:c=!1,previousComments:r,previousValue:d,isPreview:f=!1,isRequestActive:i=!1,isWaitingForCommentResponse:T=!1,targetedContent:v=null,onAcceleratorsExpandedChange:l,getAutocompleteSuggestion:A,getStableCommentId:a=Qe,onBlur:g,onCancelRequest:h,onChange:n,onSave:b,onAddComment:x,onSubmitAccelerator:O,onAcceptComment:P,onDismissComment:M,onExitShowChanges:I,value:_,commentsMode:R=et.ENABLED,hideAccelerators:W=!1,hideToolbar:w=!1,hideEditOverlay:j=!1,safeUrls:X,width:V,modelCursor:F,shouldResetSelection:J,metadata:k})=>{var ut,mt;const Z=Vt(),y=Gt()&&f,N=E.useRef(null),rt=E.useRef(null);lo(rt,N);const[{width:$t},Jt]=Ut(),it=E.useRef(null),[q,lt]=E.useState(!1),Zt=it.current,qt=(ut=Be(Zt))!=null?ut:!1,ct=At(()=>y?_e()?Ve:We:It()?Xe:Fe),G=(()=>{if(V==null){const p=qt?0:Ot();return $t-p}return V-ct*2-Ot()})(),K=y?G:G>=Mt+He?Mt:Ge,Kt=G-K,Qt=U(({commentingOn:p})=>p),te=U(({hoveredCommentId:p})=>p),ee=U(({focusedCommentId:p})=>p),oe=U(({hoveredBlockCommentLauncherPos:p})=>p),se=st(p=>p.hoveredEditId),ne=st(p=>p.rejectedEdits);E.useEffect(()=>{var p;v==null&&((p=N.current)==null||p.revertChanges())},[v]),E.useEffect(()=>{var p,z;(p=N.current)==null||p.flushChanges(),(z=N.current)==null||z.UNSAFE_setValue(_)},[_]);const ae=At(()=>{if(y)return jt;if(!It())return f?Ao:vo;if(f)return Lt;const p=Io/100*zt(Z).height;return Math.max(Lt,p)}),re=({currentTarget:p,nativeEvent:z})=>{const ft=z.composedPath();for(const Q of ft.slice(0,ft.indexOf(p)))if(Q instanceof HTMLElement&&(Q.id===vt.PROSEMIRROR_EDITOR_CONTAINER||Q.id===vt.PROSEMIRROR_CONTEXT_CHILDREN))return;I==null||I()},dt=y?jt:f?"1rem":"max(3rem,24vh)";return e.jsx("div",{className:"h-full w-full",ref:rt,onClick:re,children:e.jsx("div",{className:Ye.document,style:{margin:"0 ".concat(ct,"px"),paddingTop:ae},children:e.jsx("div",{ref:Ft(Jt,it),className:"z-0 flex w-full flex-col items-center",children:e.jsxs(tt,{comments:t,diff:o,editorRef:N,hoveredCommentId:te,focusedCommentId:ee,hoveredEditId:se,rejectedEdits:ne,value:m&&!q?"":_,commentingOn:Qt,isDisabled:u||m||q,onBlur:g,onChange:n,onSave:b,width:K,safeUrls:X,wrapperClassName:"relative z-10 flex max-w-full h-fit",paddingBottom:dt,modelCursor:F,shouldResetSelection:J,transparentBackground:!q,contentReferences:(mt=k==null?void 0:k.contentReferences)!=null?mt:[],getAutocompleteSuggestion:A,children:[e.jsxs(tt.EditorChildren,{children:[e.jsx($,{onExitComplete:()=>lt(!1),children:m&&e.jsx(go,{isRewriting:m,documentWidth:K,previousValue:d,previousComments:r,value:_,paddingBottom:dt,onStart:()=>lt(!0)})}),!w&&e.jsx(bo,{availableWidth:G,isWaitingForCommentResponse:T,isSendDisabled:c,onAddComment:x,onSubmitAccelerator:O}),R===et.ENABLED&&e.jsx(To,{pos:oe}),e.jsx($,{children:R!==et.ALL_HIDDEN&&e.jsx(De,{availableWidth:Kt,comments:t,commentsMode:R,isRequestActive:i,onAddComment:x,onAcceptComment:P,onDismissComment:M,isWaitingForCommentResponse:T,disableBlockComments:i,getStableCommentId:a})})]}),e.jsxs(tt.ContextChildren,{children:[!j&&o&&e.jsx(Eo,{diff:o}),!W&&e.jsx(Re,{isRequestActive:i,onSubmit:O,isVisuallyHidden:c||!!(s!=null&&s.isStreamingFromNative)||(s==null?void 0:s.isReadonly)&&!s.isStreaming,actions:we,onCancel:h,onExpandedChange:l})]})]})})})})};export{xs as DocumentComposer};
//# sourceMappingURL=m2ei5i7hj49iv3lt.js.map
