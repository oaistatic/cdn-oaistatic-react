var b=Object.defineProperty;var u=s=>{throw TypeError(s)};var P=(s,e,t)=>e in s?b(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var h=(s,e,t)=>P(s,typeof e!="symbol"?e+"":e,t),T=(s,e,t)=>e.has(s)||u("Cannot "+t);var d=(s,e,t)=>e.has(s)?u("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t);var p=(s,e,t)=>(T(s,e,"access private method"),t);var o,y,f,F;class A extends AudioWorkletProcessor{constructor(){super();d(this,o);h(this,"channelCount");h(this,"sampleRate");h(this,"paused");h(this,"buffer");h(this,"capacityFrames");h(this,"totalFrames");h(this,"playheadFrame");h(this,"lastPositionPostTime");this.channelCount=1,this.sampleRate=24e3,this.paused=!0,this.capacityFrames=this.sampleRate*60,this.totalFrames=0,this.playheadFrame=0,this.buffer=new Float32Array(this.capacityFrames*this.channelCount),this.lastPositionPostTime=currentTime,this.port.onmessage=t=>{var r;switch(t.data.type){case"init":{t.data.payload&&"channels"in t.data.payload&&(this.channelCount=t.data.payload.channels);break}case"play":{this.paused=!1;break}case"pause":{this.paused=!0;break}case"seek":{if(t.data.payload&&"seconds"in t.data.payload){const i=t.data.payload.seconds,a=Math.round(i*this.sampleRate);this.playheadFrame=Math.max(0,Math.min(this.playheadFrame+a,this.totalFrames))}break}case"reset":{this.playheadFrame=0,this.paused=!0;break}case"push":{const i=(r=t.data.payload)==null?void 0:r.chunk;if(!i)break;const a=i instanceof Uint8Array?i:new Uint8Array(i),l=new Int16Array(a.buffer,a.byteOffset,a.byteLength/2);p(this,o,f).call(this,p(this,o,y).call(this,l));break}}}}process(t,r,i){const a=r[0],l=a[0].length;if(this.paused)for(let n=0;n<a.length;n++)a[n].fill(0);else for(let n=0;n<l;n++)if(this.playheadFrame<this.totalFrames){const c=this.playheadFrame*this.channelCount;for(let m=0;m<a.length;m++)a[m][n]=this.buffer[c+m]||0;this.playheadFrame++}else for(let c=0;c<a.length;c++)a[c][n]=0;return currentTime-this.lastPositionPostTime>=.05&&(p(this,o,F).call(this,this.playheadFrame/this.sampleRate,this.totalFrames/this.sampleRate),this.lastPositionPostTime=currentTime),!0}}o=new WeakSet,y=function(t){const r=new Float32Array(t.length);for(let i=0;i<t.length;i++)r[i]=Math.max(-1,Math.min(1,t[i]/32768));return r},f=function(t){const r=t.length/this.channelCount;if(this.totalFrames+r>this.capacityFrames){let a=this.capacityFrames;for(;this.totalFrames+r>a;)a*=2;const l=new Float32Array(a*this.channelCount);l.set(this.buffer.subarray(0,this.totalFrames*this.channelCount)),this.buffer=l,this.capacityFrames=a}const i=this.totalFrames*this.channelCount;this.buffer.set(t,i),this.totalFrames+=r},F=function(t,r){this.port.postMessage({type:"timeupdate",payload:{seconds:t,totalSeconds:r}})};registerProcessor("pcm-player",A);
//# sourceMappingURL=pcm-player-processor-Bnki682T.js.map
