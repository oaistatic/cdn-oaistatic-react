var M=Object.defineProperty,I=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var _=Object.getOwnPropertySymbols;var v=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var h=(e,t,a)=>t in e?M(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,n=(e,t)=>{for(var a in t||(t={}))v.call(t,a)&&h(e,a,t[a]);if(_)for(var a of _(t))P.call(t,a)&&h(e,a,t[a]);return e},m=(e,t)=>I(e,O(t));import{dO as R,i as x,bg as g,bh as w,bu as C,bv as N,o0 as D,o1 as y}from"./lef5ym39glv4981l.js";import{ba as H}from"./mclphevd122040jw.js";import{g as W,r as d,k as p}from"./jj85rqzpbnvv3emr.js";const F=new Set(["google-oauth2","windowslive","apple"]),$="password",j=4*60;function A(e,t){return t!=null&&t.idp&&F.has(t.idp)?n({connection:t.idp},t.email&&{login_hint:t.email}):(t==null?void 0:t.idp)==="auth0"?n({connection:$},t.email?{login_hint:t.email}:{[D]:"true"}):t!=null&&t.email?n({},t.email&&{login_hint:t.email}):{}}function T(e){if(!e)throw new Error("No session found, cannot enable MFA");if(e.authProvider==="mocked")throw new Error("Mock users can't enable MFA! Please setup Auth0 following the instructions in the README")}function E(e){try{return H(e)}catch(t){throw new Error("Unable to decode access token")}}function q(e){return e.pwd_auth_time}function S(e){const t=q(e);if(!t)return!0;const a=t/1e3;return Date.now()/1e3-a>j}function G(e){var t;return((t=e[y])==null?void 0:t.required)==="yes"}function Q(e){var f,s;const{session:t}=R(),a=W(),[u,l]=d.useState(!1),U=((f=t==null?void 0:t.user)==null?void 0:f.idp)==="auth0",b=!!((s=t==null?void 0:t.user)!=null&&s.mfa),r=x(),k=d.useCallback(async()=>{T(t),l(!0);const i=new URL(e.redirectUrl?"/auth/enroll_mfa?redirect_path=".concat(encodeURIComponent(e.redirectUrl)):"/auth/enroll_mfa",window.location.origin).toString();let o=!0;if(t!=null&&t.accessToken){const c=E(t.accessToken);o=S(c)}if(o){p.signIn(t==null?void 0:t.authProvider,{callbackUrl:i},n(n({max_age:"0"},g(w())),A(r,t==null?void 0:t.user)));return}window.location.href=i,l(!1)},[r,t,e.redirectUrl]),L=d.useCallback(async()=>{T(t);const i=new URL("/auth/disable_mfa",window.location.origin).toString();let o=!0;if(t!=null&&t.accessToken){const c=E(t.accessToken);o=S(c)||!G(c)}if(o){p.signIn(t==null?void 0:t.authProvider,{callbackUrl:i},n(n({max_age:"0"},A(r,t==null?void 0:t.user)),g(w())));return}a(m(n({},C(N.Security)),{pathname:"/",search:"disable_mfa=true"}))},[r,t,a]);return{setupMfa:k,isUsernamePassword:U,isLoggedInWithMfa:b,removeMfa:L,isLoadingRedirect:u}}export{Q as u};
//# sourceMappingURL=ht7of10t76s6p5h9.js.map
