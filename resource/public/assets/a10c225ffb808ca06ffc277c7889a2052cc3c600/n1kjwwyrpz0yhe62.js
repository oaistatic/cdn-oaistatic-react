var Ce=Object.defineProperty,ve=Object.defineProperties;var Ae=Object.getOwnPropertyDescriptors;var U=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var X=(e,t,r)=>t in e?Ce(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,A=(e,t)=>{for(var r in t||(t={}))G.call(t,r)&&X(e,r,t[r]);if(U)for(var r of U(t))Y.call(t,r)&&X(e,r,t[r]);return e},$=(e,t)=>ve(e,Ae(t));var K=(e,t)=>{var r={};for(var n in e)G.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&U)for(var n of U(e))t.indexOf(n)<0&&Y.call(e,n)&&(r[n]=e[n]);return r};function Te(e,t){return e[13]=1,e[14]=t>>8,e[15]=t&255,e[16]=t>>8,e[17]=t&255,e}const oe=112,se=72,ae=89,ie=115;let q;function Ne(){const e=new Int32Array(256);for(let t=0;t<256;t++){let r=t;for(let n=0;n<8;n++)r=r&1?3988292384^r>>>1:r>>>1;e[t]=r}return e}function Ie(e){let t=-1;q||(q=Ne());for(let r=0;r<e.length;r++)t=q[(t^e[r])&255]^t>>>8;return t^-1}function ke(e){const t=e.length-1;for(let r=t;r>=4;r--)if(e[r-4]===9&&e[r-3]===oe&&e[r-2]===se&&e[r-1]===ae&&e[r]===ie)return r-3;return 0}function Re(e,t,r=!1){const n=new Uint8Array(13);t*=39.3701,n[0]=oe,n[1]=se,n[2]=ae,n[3]=ie,n[4]=t>>>24,n[5]=t>>>16,n[6]=t>>>8,n[7]=t&255,n[8]=n[4],n[9]=n[5],n[10]=n[6],n[11]=n[7],n[12]=1;const i=Ie(n),s=new Uint8Array(4);if(s[0]=i>>>24,s[1]=i>>>16,s[2]=i>>>8,s[3]=i&255,r){const a=ke(e);return e.set(n,a),e.set(s,a+13),e}else{const a=new Uint8Array(4);a[0]=0,a[1]=0,a[2]=0,a[3]=9;const o=new Uint8Array(54);return o.set(e,0),o.set(a,33),o.set(n,37),o.set(s,50),o}}const Pe="AAlwSFlz",_e="AAAJcEhZ",De="AAAACXBI";function Fe(e){let t=e.indexOf(Pe);return t===-1&&(t=e.indexOf(_e)),t===-1&&(t=e.indexOf(De)),t}const le="[modern-screenshot]",T=typeof window<"u",Ue=T&&"Worker"in window,$e=T&&"atob"in window,xe=T&&"btoa"in window;var ne;const j=T?(ne=window.navigator)==null?void 0:ne.userAgent:"",ce=j.includes("Chrome"),x=j.includes("AppleWebKit")&&!ce,V=j.includes("Firefox"),Le=e=>e&&"__CONTEXT__"in e,Me=e=>e.constructor.name==="CSSFontFaceRule",Oe=e=>e.constructor.name==="CSSImportRule",v=e=>e.nodeType===1,F=e=>typeof e.className=="object",ue=e=>e.tagName==="image",Be=e=>e.tagName==="use",P=e=>v(e)&&typeof e.style<"u"&&!F(e),qe=e=>e.nodeType===8,We=e=>e.nodeType===3,R=e=>e.tagName==="IMG",L=e=>e.tagName==="VIDEO",je=e=>e.tagName==="CANVAS",Ve=e=>e.tagName==="TEXTAREA",He=e=>e.tagName==="INPUT",ze=e=>e.tagName==="STYLE",Xe=e=>e.tagName==="SCRIPT",Ge=e=>e.tagName==="SELECT",Ye=e=>e.tagName==="SLOT",Ke=e=>e.tagName==="IFRAME",Je=(...e)=>console.warn(le,...e);function Qe(e){var r;const t=(r=e==null?void 0:e.createElement)==null?void 0:r.call(e,"canvas");return t&&(t.height=t.width=1),!!t&&"toDataURL"in t&&!!t.toDataURL("image/webp").includes("image/webp")}const W=e=>e.startsWith("data:");function fe(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(T&&e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i)||!T)return e;const r=M().implementation.createHTMLDocument(),n=r.createElement("base"),i=r.createElement("a");return r.head.appendChild(n),r.body.appendChild(i),t&&(n.href=t),i.href=e,i.href}function M(e){var t;return(t=e&&v(e)?e==null?void 0:e.ownerDocument:e)!=null?t:window.document}const O="http://www.w3.org/2000/svg";function Ze(e,t,r){const n=M(r).createElementNS(O,"svg");return n.setAttributeNS(null,"width",e.toString()),n.setAttributeNS(null,"height",t.toString()),n.setAttributeNS(null,"viewBox","0 0 ".concat(e," ").concat(t)),n}function et(e,t){let r=new XMLSerializer().serializeToString(e);return t&&(r=r.replace(new RegExp("[\\u0000-\\u0008\\v\\f\\u000E-\\u001F\\uD800-\\uDFFF\\uFFFE\\uFFFF]","gu"),"")),"data:image/svg+xml;charset=utf-8,".concat(encodeURIComponent(r))}function tt(e,t){return new Promise((r,n)=>{const i=new FileReader;i.onload=()=>r(i.result),i.onerror=()=>n(i.error),i.onabort=()=>n(new Error("Failed read blob to ".concat(t))),i.readAsDataURL(e)})}const rt=e=>tt(e,"dataUrl");function k(e,t){const r=M(t).createElement("img");return r.decoding="sync",r.loading="eager",r.src=e,r}function _(e,t){return new Promise(r=>{const{timeout:n,ownerDocument:i,onError:s,onWarn:a}=t!=null?t:{},o=typeof e=="string"?k(e,M(i)):e;let c=null,f=null;function l(){r(o),c&&clearTimeout(c),f==null||f()}if(n&&(c=setTimeout(l,n)),L(o)){const u=o.currentSrc||o.src;if(!u)return o.poster?_(o.poster,t).then(r):l();if(o.readyState>=2)return l();const g=l,d=p=>{a==null||a("Failed video load",u,p),s==null||s(p),l()};f=()=>{o.removeEventListener("loadeddata",g),o.removeEventListener("error",d)},o.addEventListener("loadeddata",g,{once:!0}),o.addEventListener("error",d,{once:!0})}else{const u=ue(o)?o.href.baseVal:o.currentSrc||o.src;if(!u)return l();const g=async()=>{if(R(o)&&"decode"in o)try{await o.decode()}catch(p){a==null||a("Failed to decode image, trying to render anyway",o.dataset.originalSrc||u,p)}l()},d=p=>{a==null||a("Failed image load",o.dataset.originalSrc||u,p),l()};if(R(o)&&o.complete)return g();f=()=>{o.removeEventListener("load",g),o.removeEventListener("error",d)},o.addEventListener("load",g,{once:!0}),o.addEventListener("error",d,{once:!0})}})}async function nt(e,t){P(e)&&(R(e)||L(e)?await _(e,t):await Promise.all(["img","video"].flatMap(r=>Array.from(e.querySelectorAll(r)).map(n=>_(n,t)))))}const ge=function(){let t=0;const r=()=>"0000".concat((Math.random()*36**4<<0).toString(36)).slice(-4);return()=>(t+=1,"u".concat(r()).concat(t))}();function de(e){return e==null?void 0:e.split(",").map(t=>t.trim().replace(/"|'/g,"").toLowerCase()).filter(Boolean)}let J=0;function ot(e){const t="".concat(le,"[#").concat(J,"]");return J++,{time:r=>e&&console.time("".concat(t," ").concat(r)),timeEnd:r=>e&&console.timeEnd("".concat(t," ").concat(r)),warn:(...r)=>e&&Je(...r)}}function st(e){return{cache:e?"no-cache":"force-cache"}}async function B(e,t){return Le(e)?e:at(e,$(A({},t),{autoDestruct:!0}))}async function at(e,t){var d,p,h,w,y;const{scale:r=1,workerUrl:n,workerNumber:i=1}=t||{},s=!!(t!=null&&t.debug),a=(d=t==null?void 0:t.features)!=null?d:!0,o=(p=e.ownerDocument)!=null?p:T?window.document:void 0,c=(w=(h=e.ownerDocument)==null?void 0:h.defaultView)!=null?w:T?window:void 0,f=new Map,l=$(A({width:0,height:0,quality:1,type:"image/png",scale:r,backgroundColor:null,style:null,filter:null,maximumCanvasSize:0,timeout:3e4,progress:null,debug:s,fetch:A({requestInit:st((y=t==null?void 0:t.fetch)==null?void 0:y.bypassingCache),placeholderImage:"data:image/png;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",bypassingCache:!1},t==null?void 0:t.fetch),fetchFn:null,font:{},drawImageInterval:100,workerUrl:null,workerNumber:i,onCloneEachNode:null,onCloneNode:null,onEmbedNode:null,onCreateForeignObjectSvg:null,includeStyleProperties:null,autoDestruct:!1},t),{__CONTEXT__:!0,log:ot(s),node:e,ownerDocument:o,ownerWindow:c,dpi:r===1?null:96*r,svgStyleElement:me(o),svgDefsElement:o==null?void 0:o.createElementNS(O,"defs"),svgStyles:new Map,defaultComputedStyles:new Map,workers:[...Array.from({length:Ue&&n&&i?i:0})].map(()=>{try{const b=new Worker(n);return b.onmessage=async m=>{var C,N,I,z;const{url:S,result:E}=m.data;E?(N=(C=f.get(S))==null?void 0:C.resolve)==null||N.call(C,E):(z=(I=f.get(S))==null?void 0:I.reject)==null||z.call(I,new Error("Error receiving message from worker: ".concat(S)))},b.onmessageerror=m=>{var E,C;const{url:S}=m.data;(C=(E=f.get(S))==null?void 0:E.reject)==null||C.call(E,new Error("Error receiving message from worker: ".concat(S)))},b}catch(b){return l.log.warn("Failed to new Worker",b),null}}).filter(Boolean),fontFamilies:new Map,fontCssTexts:new Map,acceptOfImage:"".concat([Qe(o)&&"image/webp","image/svg+xml","image/*","*/*"].filter(Boolean).join(","),";q=0.8"),requests:f,drawImageCount:0,tasks:[],features:a,isEnable:b=>{var m,S;return b==="restoreScrollPosition"?typeof a=="boolean"?!1:(m=a[b])!=null?m:!1:typeof a=="boolean"?a:(S=a[b])!=null?S:!0},shadowRoots:[]});l.log.time("wait until load"),await nt(e,{timeout:l.timeout,onWarn:l.log.warn}),l.log.timeEnd("wait until load");const{width:u,height:g}=it(e,l);return l.width=u,l.height=g,l}function me(e){if(!e)return;const t=e.createElement("style"),r=t.ownerDocument.createTextNode("\n.______background-clip--text {\n  background-clip: text;\n  -webkit-background-clip: text;\n}\n");return t.appendChild(r),t}function it(e,t){let{width:r,height:n}=t;if(v(e)&&(!r||!n)){const i=e.getBoundingClientRect();r=r||i.width||Number(e.getAttribute("width"))||0,n=n||i.height||Number(e.getAttribute("height"))||0}return{width:r,height:n}}async function lt(e,t){const{log:r,timeout:n,drawImageCount:i,drawImageInterval:s}=t;r.time("image to canvas");const a=await _(e,{timeout:n,onWarn:t.log.warn}),{canvas:o,context2d:c}=ct(e.ownerDocument,t),f=()=>{try{c==null||c.drawImage(a,0,0,o.width,o.height)}catch(l){t.log.warn("Failed to drawImage",l)}};if(f(),t.isEnable("fixSvgXmlDecode"))for(let l=0;l<i;l++)await new Promise(u=>{setTimeout(()=>{f(),u()},l+s)});return t.drawImageCount=0,r.timeEnd("image to canvas"),o}function ct(e,t){const{width:r,height:n,scale:i,backgroundColor:s,maximumCanvasSize:a}=t,o=e.createElement("canvas");o.width=Math.floor(r*i),o.height=Math.floor(n*i),o.style.width="".concat(r,"px"),o.style.height="".concat(n,"px"),a&&(o.width>a||o.height>a)&&(o.width>a&&o.height>a?o.width>o.height?(o.height*=a/o.width,o.width=a):(o.width*=a/o.height,o.height=a):o.width>a?(o.height*=a/o.width,o.width=a):(o.width*=a/o.height,o.height=a));const c=o.getContext("2d");return c&&s&&(c.fillStyle=s,c.fillRect(0,0,o.width,o.height)),{canvas:o,context2d:c}}function he(e,t){if(e.ownerDocument)try{const s=e.toDataURL();if(s!=="data:,")return k(s,e.ownerDocument)}catch(s){t.log.warn("Failed to clone canvas",s)}const r=e.cloneNode(!1),n=e.getContext("2d"),i=r.getContext("2d");try{return n&&i&&i.putImageData(n.getImageData(0,0,e.width,e.height),0,0),r}catch(s){t.log.warn("Failed to clone canvas",s)}return r}function ut(e,t){var r;try{if((r=e==null?void 0:e.contentDocument)!=null&&r.body)return H(e.contentDocument.body,t)}catch(n){t.log.warn("Failed to clone iframe",n)}return e.cloneNode(!1)}function ft(e){const t=e.cloneNode(!1);return e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc,t.srcset=""),t.loading==="lazy"&&(t.loading="eager"),t}async function gt(e,t){if(e.ownerDocument&&!e.currentSrc&&e.poster)return k(e.poster,e.ownerDocument);const r=e.cloneNode(!1);r.crossOrigin="anonymous",e.currentSrc&&e.currentSrc!==e.src&&(r.src=e.currentSrc);const n=r.ownerDocument;if(n){let i=!0;if(await _(r,{onError:()=>i=!1,onWarn:t.log.warn}),!i)return e.poster?k(e.poster,e.ownerDocument):r;r.currentTime=e.currentTime,await new Promise(a=>{r.addEventListener("seeked",a,{once:!0})});const s=n.createElement("canvas");s.width=e.offsetWidth,s.height=e.offsetHeight;try{const a=s.getContext("2d");a&&a.drawImage(r,0,0,s.width,s.height)}catch(a){return t.log.warn("Failed to clone video",a),e.poster?k(e.poster,e.ownerDocument):r}return he(s,t)}return r}function dt(e,t){return je(e)?he(e,t):Ke(e)?ut(e,t):R(e)?ft(e):L(e)?gt(e,t):e.cloneNode(!1)}function mt(e){let t=e.sandbox;if(!t){const{ownerDocument:r}=e;try{r&&(t=r.createElement("iframe"),t.id="__SANDBOX__".concat(ge()),t.width="0",t.height="0",t.style.visibility="hidden",t.style.position="fixed",r.body.appendChild(t),t.srcdoc='<!DOCTYPE html><meta charset="UTF-8"><title></title><body>',e.sandbox=t)}catch(n){e.log.warn("Failed to getSandBox",n)}}return t}const ht=["width","height","-webkit-text-fill-color"],wt=["stroke","fill"];function we(e,t,r){const{defaultComputedStyles:n}=r,i=e.nodeName.toLowerCase(),s=F(e)&&i!=="svg",a=s?wt.map(h=>[h,e.getAttribute(h)]).filter(([,h])=>h!==null):[],o=[s&&"svg",i,a.map((h,w)=>"".concat(h,"=").concat(w)).join(","),t].filter(Boolean).join(":");if(n.has(o))return n.get(o);const c=mt(r),f=c==null?void 0:c.contentWindow;if(!f)return new Map;const l=f==null?void 0:f.document;let u,g;s?(u=l.createElementNS(O,"svg"),g=u.ownerDocument.createElementNS(u.namespaceURI,i),a.forEach(([h,w])=>{g.setAttributeNS(null,h,w)}),u.appendChild(g)):u=g=l.createElement(i),g.textContent=" ",l.body.appendChild(u);const d=f.getComputedStyle(g,t),p=new Map;for(let h=d.length,w=0;w<h;w++){const y=d.item(w);ht.includes(y)||p.set(y,d.getPropertyValue(y))}return l.body.removeChild(u),n.set(o,p),p}function pe(e,t,r){var o;const n=new Map,i=[],s=new Map;if(r)for(const c of r)a(c);else for(let c=e.length,f=0;f<c;f++){const l=e.item(f);a(l)}for(let c=i.length,f=0;f<c;f++)(o=s.get(i[f]))==null||o.forEach((l,u)=>n.set(u,l));function a(c){const f=e.getPropertyValue(c),l=e.getPropertyPriority(c),u=c.lastIndexOf("-"),g=u>-1?c.substring(0,u):void 0;if(g){let d=s.get(g);d||(d=new Map,s.set(g,d)),d.set(c,[f,l])}t.get(c)===f&&!l||(g?i.push(g):n.set(c,[f,l]))}return n}function pt(e,t,r,n){var u,g,d,p;const{ownerWindow:i,includeStyleProperties:s,currentParentNodeStyle:a}=n,o=t.style,c=i.getComputedStyle(e),f=we(e,null,n);a==null||a.forEach((h,w)=>{f.delete(w)});const l=pe(c,f,s);l.delete("transition-property"),l.delete("all"),l.delete("d"),l.delete("content"),r&&(l.delete("margin-top"),l.delete("margin-right"),l.delete("margin-bottom"),l.delete("margin-left"),l.delete("margin-block-start"),l.delete("margin-block-end"),l.delete("margin-inline-start"),l.delete("margin-inline-end"),l.set("box-sizing",["border-box",""])),((u=l.get("background-clip"))==null?void 0:u[0])==="text"&&t.classList.add("______background-clip--text"),ce&&(l.has("font-kerning")||l.set("font-kerning",["normal",""]),(((g=l.get("overflow-x"))==null?void 0:g[0])==="hidden"||((d=l.get("overflow-y"))==null?void 0:d[0])==="hidden")&&((p=l.get("text-overflow"))==null?void 0:p[0])==="ellipsis"&&e.scrollWidth===e.clientWidth&&l.set("text-overflow",["clip",""]));for(let h=o.length,w=0;w<h;w++)o.removeProperty(o.item(w));return l.forEach(([h,w],y)=>{o.setProperty(y,h,w)}),l}function yt(e,t){(Ve(e)||He(e)||Ge(e))&&t.setAttribute("value",e.value)}const bt=[":before",":after"],St=[":-webkit-scrollbar",":-webkit-scrollbar-button",":-webkit-scrollbar-thumb",":-webkit-scrollbar-track",":-webkit-scrollbar-track-piece",":-webkit-scrollbar-corner",":-webkit-resizer"];function Et(e,t,r,n,i){const{ownerWindow:s,svgStyleElement:a,svgStyles:o,currentNodeStyle:c}=n;if(!a||!s)return;function f(l){var m;const u=s.getComputedStyle(e,l);let g=u.getPropertyValue("content");if(!g||g==="none")return;i==null||i(g),g=g.replace(/(')|(")|(counter\(.+\))/g,"");const d=[ge()],p=we(e,l,n);c==null||c.forEach((S,E)=>{p.delete(E)});const h=pe(u,p,n.includeStyleProperties);h.delete("content"),h.delete("-webkit-locale"),((m=h.get("background-clip"))==null?void 0:m[0])==="text"&&t.classList.add("______background-clip--text");const w=["content: '".concat(g,"';")];if(h.forEach(([S,E],C)=>{w.push("".concat(C,": ").concat(S).concat(E?" !important":"",";"))}),w.length===1)return;try{t.className=[t.className,...d].join(" ")}catch(S){n.log.warn("Failed to copyPseudoClass",S);return}const y=w.join("\n  ");let b=o.get(y);b||(b=[],o.set(y,b)),b.push(".".concat(d[0],":").concat(l))}bt.forEach(f),r&&St.forEach(f)}const Q=new Set(["symbol"]);async function Z(e,t,r,n,i){if(v(r)&&(ze(r)||Xe(r))||n.filter&&!n.filter(r))return;Q.has(t.nodeName)||Q.has(r.nodeName)?n.currentParentNodeStyle=void 0:n.currentParentNodeStyle=n.currentNodeStyle;const s=await H(r,n,!1,i);n.isEnable("restoreScrollPosition")&&Ct(e,s),t.appendChild(s)}async function ee(e,t,r,n){var s;let i=e.firstChild;v(e)&&e.shadowRoot&&(i=(s=e.shadowRoot)==null?void 0:s.firstChild,r.shadowRoots.push(e.shadowRoot));for(let a=i;a;a=a.nextSibling)if(!qe(a))if(v(a)&&Ye(a)&&typeof a.assignedNodes=="function"){const o=a.assignedNodes();for(let c=0;c<o.length;c++)await Z(e,t,o[c],r,n)}else await Z(e,t,a,r,n)}function Ct(e,t){if(!P(e)||!P(t))return;const{scrollTop:r,scrollLeft:n}=e;if(!r&&!n)return;const{transform:i}=t.style,s=new DOMMatrix(i),{a,b:o,c,d:f}=s;s.a=1,s.b=0,s.c=0,s.d=1,s.translateSelf(-n,-r),s.a=a,s.b=o,s.c=c,s.d=f,t.style.transform=s.toString()}function vt(e,t){const{backgroundColor:r,width:n,height:i,style:s}=t,a=e.style;if(r&&a.setProperty("background-color",r,"important"),n&&a.setProperty("width","".concat(n,"px"),"important"),i&&a.setProperty("height","".concat(i,"px"),"important"),s)for(const o in s)a[o]=s[o]}const At=/^[\w-:]+$/;async function H(e,t,r=!1,n){var f,l,u,g;const{ownerDocument:i,ownerWindow:s,fontFamilies:a,onCloneEachNode:o}=t;if(i&&We(e))return n&&/\S/.test(e.data)&&n(e.data),i.createTextNode(e.data);if(i&&s&&v(e)&&(P(e)||F(e))){const d=await dt(e,t);if(t.isEnable("removeAbnormalAttributes")){const m=d.getAttributeNames();for(let S=m.length,E=0;E<S;E++){const C=m[E];At.test(C)||d.removeAttribute(C)}}const p=t.currentNodeStyle=pt(e,d,r,t);r&&vt(d,t);let h=!1;if(t.isEnable("copyScrollbar")){const m=[(f=p.get("overflow-x"))==null?void 0:f[0],(l=p.get("overflow-y"))==null?void 0:l[0]];h=m.includes("scroll")||(m.includes("auto")||m.includes("overlay"))&&(e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth)}const w=(u=p.get("text-transform"))==null?void 0:u[0],y=de((g=p.get("font-family"))==null?void 0:g[0]),b=y?m=>{w==="uppercase"?m=m.toUpperCase():w==="lowercase"?m=m.toLowerCase():w==="capitalize"&&(m=m[0].toUpperCase()+m.substring(1)),y.forEach(S=>{let E=a.get(S);E||a.set(S,E=new Set),m.split("").forEach(C=>E.add(C))})}:void 0;return Et(e,d,h,t,b),yt(e,d),L(e)||await ee(e,d,t,b),await(o==null?void 0:o(d)),d}const c=e.cloneNode(!1);return await ee(e,c,t),await(o==null?void 0:o(c)),c}function Tt(e){if(e.ownerDocument=void 0,e.ownerWindow=void 0,e.svgStyleElement=void 0,e.svgDefsElement=void 0,e.svgStyles.clear(),e.defaultComputedStyles.clear(),e.sandbox){try{e.sandbox.remove()}catch(t){e.log.warn("Failed to destroyContext",t)}e.sandbox=void 0}e.workers=[],e.fontFamilies.clear(),e.fontCssTexts.clear(),e.requests.clear(),e.tasks=[],e.shadowRoots=[]}function Nt(e){const o=e,{url:t,timeout:r,responseType:n}=o,i=K(o,["url","timeout","responseType"]),s=new AbortController,a=r?setTimeout(()=>s.abort(),r):void 0;return fetch(t,A({signal:s.signal},i)).then(c=>{if(!c.ok)throw new Error("Failed fetch, not 2xx response",{cause:c});switch(n){case"arrayBuffer":return c.arrayBuffer();case"dataUrl":return c.blob().then(rt);case"text":default:return c.text()}}).finally(()=>clearTimeout(a))}function D(e,t){const{url:r,requestType:n="text",responseType:i="text",imageDom:s}=t;let a=r;const{timeout:o,acceptOfImage:c,requests:f,fetchFn:l,fetch:{requestInit:u,bypassingCache:g,placeholderImage:d},font:p,workers:h,fontFamilies:w}=e;n==="image"&&(x||V)&&e.drawImageCount++;let y=f.get(r);if(!y){g&&g instanceof RegExp&&g.test(a)&&(a+=(/\?/.test(a)?"&":"?")+new Date().getTime());const b=n.startsWith("font")&&p&&p.minify,m=new Set;b&&n.split(";")[1].split(",").forEach(N=>{w.has(N)&&w.get(N).forEach(I=>m.add(I))});const S=b&&m.size,E=A({url:a,timeout:o,responseType:S?"arrayBuffer":i,headers:n==="image"?{accept:c}:void 0},u);y={type:n,resolve:void 0,reject:void 0,response:null},y.response=(async()=>{if(l&&n==="image"){const C=await l(r);if(C)return C}return!x&&r.startsWith("http")&&h.length?new Promise((C,N)=>{h[f.size&h.length-1].postMessage(A({rawUrl:r},E)),y.resolve=C,y.reject=N}):Nt(E)})().catch(C=>{if(f.delete(r),n==="image"&&d)return e.log.warn("Failed to fetch image base64, trying to use placeholder image",a),typeof d=="string"?d:d(s);throw C}),f.set(r,y)}return y.response}async function ye(e,t,r,n){if(!be(e))return e;for(const[i,s]of It(e,t))try{const a=await D(r,{url:s,requestType:n?"image":"text",responseType:"dataUrl"});e=e.replace(kt(i),"$1".concat(a,"$3"))}catch(a){r.log.warn("Failed to fetch css data url",i,a)}return e}function be(e){return/url\((['"]?)([^'"]+?)\1\)/.test(e)}const Se=/url\((['"]?)([^'"]+?)\1\)/g;function It(e,t){const r=[];return e.replace(Se,(n,i,s)=>(r.push([s,fe(s,t)]),n)),r.filter(([n])=>!W(n))}function kt(e){const t=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp("(url\\(['\"]?)(".concat(t,")(['\"]?\\))"),"g")}const Rt=["background-image","border-image-source","-webkit-border-image","-webkit-mask-image","list-style-image"];function Pt(e,t){return Rt.map(r=>{const n=e.getPropertyValue(r);return!n||n==="none"?null:((x||V)&&t.drawImageCount++,ye(n,null,t,!0).then(i=>{!i||n===i||e.setProperty(r,i,e.getPropertyPriority(r))}))}).filter(Boolean)}function _t(e,t){if(R(e)){const r=e.currentSrc||e.src;if(!W(r))return[D(t,{url:r,imageDom:e,requestType:"image",responseType:"dataUrl"}).then(n=>{n&&(e.srcset="",e.dataset.originalSrc=r,e.src=n||"")})];(x||V)&&t.drawImageCount++}else if(F(e)&&!W(e.href.baseVal)){const r=e.href.baseVal;return[D(t,{url:r,imageDom:e,requestType:"image",responseType:"dataUrl"}).then(n=>{n&&(e.dataset.originalSrc=r,e.href.baseVal=n||"")})]}return[]}function Dt(e,t){var o;const{ownerDocument:r,svgDefsElement:n}=t,i=(o=e.getAttribute("href"))!=null?o:e.getAttribute("xlink:href");if(!i)return[];const[s,a]=i.split("#");if(a){const c="#".concat(a),f=t.shadowRoots.reduce((l,u)=>l!=null?l:u.querySelector("svg ".concat(c)),r==null?void 0:r.querySelector("svg ".concat(c)));if(s&&e.setAttribute("href",c),n!=null&&n.querySelector(c))return[];if(f)return n==null||n.appendChild(f.cloneNode(!0)),[];if(s)return[D(t,{url:s,responseType:"text"}).then(l=>{n==null||n.insertAdjacentHTML("beforeend",l)})]}return[]}function Ee(e,t){const{tasks:r}=t;v(e)&&((R(e)||ue(e))&&r.push(..._t(e,t)),Be(e)&&r.push(...Dt(e,t))),P(e)&&r.push(...Pt(e.style,t)),e.childNodes.forEach(n=>{Ee(n,t)})}async function Ft(e,t){const{ownerDocument:r,svgStyleElement:n,fontFamilies:i,fontCssTexts:s,tasks:a,font:o}=t;if(!(!r||!n||!i.size))if(o&&o.cssText){const c=re(o.cssText,t);n.appendChild(r.createTextNode("".concat(c,"\n")))}else{const c=Array.from(r.styleSheets).filter(l=>{try{return"cssRules"in l&&!!l.cssRules.length}catch(u){return t.log.warn("Error while reading CSS rules from ".concat(l.href),u),!1}});await Promise.all(c.flatMap(l=>Array.from(l.cssRules).map(async(u,g)=>{if(Oe(u)){let d=g+1;const p=u.href;let h="";try{h=await D(t,{url:p,requestType:"text",responseType:"text"})}catch(y){t.log.warn("Error fetch remote css import from ".concat(p),y)}const w=h.replace(Se,(y,b,m)=>y.replace(m,fe(m,p)));for(const y of $t(w))try{l.insertRule(y,y.startsWith("@import")?d+=1:l.cssRules.length)}catch(b){t.log.warn("Error inserting rule from remote css import",{rule:y,error:b})}}}))),c.flatMap(l=>Array.from(l.cssRules)).filter(l=>{var u;return Me(l)&&be(l.style.getPropertyValue("src"))&&((u=de(l.style.getPropertyValue("font-family")))==null?void 0:u.some(g=>i.has(g)))}).forEach(l=>{const u=l,g=s.get(u.cssText);g?n.appendChild(r.createTextNode("".concat(g,"\n"))):a.push(ye(u.cssText,u.parentStyleSheet?u.parentStyleSheet.href:null,t).then(d=>{d=re(d,t),s.set(u.cssText,d),n.appendChild(r.createTextNode("".concat(d,"\n")))}))})}}const Ut=/(\/\*[\s\S]*?\*\/)/g,te=/((@.*?keyframes [\s\S]*?){([\s\S]*?}\s*?)})/gi;function $t(e){if(e==null)return[];const t=[];let r=e.replace(Ut,"");for(;;){const s=te.exec(r);if(!s)break;t.push(s[0])}r=r.replace(te,"");const n=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,i=new RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");for(;;){let s=n.exec(r);if(s)i.lastIndex=n.lastIndex;else if(s=i.exec(r),s)n.lastIndex=i.lastIndex;else break;t.push(s[0])}return t}const xt=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,Lt=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function re(e,t){const{font:r}=t,n=r?r==null?void 0:r.preferredFormat:void 0;return n?e.replace(Lt,i=>{for(;;){const[s,,a]=xt.exec(i)||[];if(!a)return"";if(a===n)return"src: ".concat(s,";")}}):e}async function Mt(e,t){const r=await B(e,t);if(v(r.node)&&F(r.node))return r.node;const{ownerDocument:n,log:i,tasks:s,svgStyleElement:a,svgDefsElement:o,svgStyles:c,font:f,progress:l,autoDestruct:u,onCloneNode:g,onEmbedNode:d,onCreateForeignObjectSvg:p}=r;i.time("clone node");const h=await H(r.node,r,!0);if(a&&n){let S="";c.forEach((E,C)=>{S+="".concat(E.join(",\n")," {\n  ").concat(C,"\n}\n")}),a.appendChild(n.createTextNode(S))}i.timeEnd("clone node"),await(g==null?void 0:g(h)),f!==!1&&v(h)&&(i.time("embed web font"),await Ft(h,r),i.timeEnd("embed web font")),i.time("embed node"),Ee(h,r);const w=s.length;let y=0;const b=async()=>{for(;;){const S=s.pop();if(!S)break;try{await S}catch(E){r.log.warn("Failed to run task",E)}l==null||l(++y,w)}};l==null||l(y,w),await Promise.all([...Array.from({length:4})].map(b)),i.timeEnd("embed node"),await(d==null?void 0:d(h));const m=Ot(h,r);return o&&m.insertBefore(o,m.children[0]),a&&m.insertBefore(a,m.children[0]),u&&Tt(r),await(p==null?void 0:p(m)),m}function Ot(e,t){const{width:r,height:n}=t,i=Ze(r,n,e.ownerDocument),s=i.ownerDocument.createElementNS(i.namespaceURI,"foreignObject");return s.setAttributeNS(null,"x","0%"),s.setAttributeNS(null,"y","0%"),s.setAttributeNS(null,"width","100%"),s.setAttributeNS(null,"height","100%"),s.append(e),i.appendChild(s),i}async function Bt(e,t){var a;const r=await B(e,t),n=await Mt(r),i=et(n,r.isEnable("removeControlCharacter"));r.autoDestruct||(r.svgStyleElement=me(r.ownerDocument),r.svgDefsElement=(a=r.ownerDocument)==null?void 0:a.createElementNS(O,"defs"),r.svgStyles.clear());const s=k(i,n.ownerDocument);return await lt(s,r)}async function qt(e,t){const r=await B(e,t),{log:n,quality:i,type:s,dpi:a}=r,o=await Bt(r);n.time("canvas to data url");let c=o.toDataURL(s,i);if(["image/png","image/jpeg"].includes(s)&&a&&$e&&xe){const[f,l]=c.split(",");let u=0,g=!1;if(s==="image/png"){const m=Fe(l);m>=0?(u=Math.ceil((m+28)/3)*4,g=!0):u=33/3*4}else s==="image/jpeg"&&(u=18/3*4);const d=l.substring(0,u),p=l.substring(u),h=window.atob(d),w=new Uint8Array(h.length);for(let m=0;m<w.length;m++)w[m]=h.charCodeAt(m);const y=s==="image/png"?Re(w,a,g):Te(w,a),b=window.btoa(String.fromCharCode(...y));c=[f,",",b,p].join("")}return n.timeEnd("canvas to data url"),c}async function jt(e,t){return qt(await B(e,$(A({},t),{type:"image/png"})))}export{at as createContext,Tt as destroyContext,Bt as domToCanvas,qt as domToDataUrl,Mt as domToForeignObjectSvg,jt as domToPng,_ as loadMedia,nt as waitUntilLoad};
//# sourceMappingURL=n1kjwwyrpz0yhe62.js.map
