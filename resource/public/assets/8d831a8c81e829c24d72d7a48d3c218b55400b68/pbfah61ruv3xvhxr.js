import{r as u,a_ as K,f as X,c as $,j as i,au as f,aw as Q}from"./n1tvutderx19k1zs.js";import{hQ as J,hR as Z,hS as ee,C as g,hT as te,h1 as se,hU as ae,hV as oe,hW as ne,hX as ie,hY as re,dx as ce,cC as N,hZ as de,h_ as le,h$ as ue,i0 as M,i1 as P,dv as he,A as W,i2 as me,i3 as pe,i4 as fe,u as ge,i5 as D,U as F,i6 as j}from"./c87uv1mutc86tiqk.js";import{gH as y,L as O,K as xe,s as k,an as ve,ew as Ce,q as we,gI as Se,eQ as Te,d$ as U,g3 as be,d as ye,gJ as Ie}from"./efuue3ezs0mj4ucx.js";import{L as Ee}from"./ks79pfkjilmvsi5m.js";import{u as Ae}from"./bxe8lsbbwu66fmec.js";import{T as _e}from"./k9xm49otsb4eors5.js";import{g as Re}from"./btagl6w1gub4aw61.js";import"./kifwyvxkhdk7syb7.js";import"./c1vsiyure2yziq8u.js";import"./gr8do7n6orkpzwtb.js";import"./b197edpr4dhgtcvc.js";import"./gy64pge8qevmvg7e.js";import"./o97za21c5v9glw28.js";import"./bh0nczk7jf5nipy7.js";import"./d995zjnlydagrugw.js";import"./m3i9t52w2bjqxoks.js";import"./fmtdc70w9bxe7ngz.js";import"./ishe91rr928a0b40.js";import"./ir7h5xb5yr2dttye.js";import"./fzrn137102spawew.js";import"./pevkepdko1ob7sgk.js";import"./ecs2ptmt646v6gvn.js";import"./gb5z15gr4uo6e2ww.js";import"./jy24clh9s5sbm6a3.js";import"./n2mw1xqoowews9pe.js";import"./gohrg29ji6orhvga.js";import"./lvedelvd2wa5y0ah.js";import"./oy248fbbcvutqmly.js";import"./bk8slwxjkdlmxjxm.js";import"./gffup1245353c03l.js";const L="oai/apps/canmoreSidebarWidth",Ne=.25,Me=400,H=400;function V(e){return e-Me}function T(e,s){return K(H,V(e),s??Ne*e)}function We(){const e=y.useState(y.selectWindowWidth),s=T(e,J(O.DANGER_SECRET_FOLDERS_ONLY_getItem(L))),a=z(),[t,c]=u.useState(s);u.useEffect(()=>{(t<H||t>V(e))&&c(T(e,t))},[e]);function o(m){c(x=>T(e,x+=m.delta.x))}function n(m){c(m),O.DANGER_SECRET_FOLDERS_ONLY_setItem(L,m)}function d(){const m=T(e,void 0);n(m)}const r=`calc(100vw - ${t}px)`;return a?{chatWidth:t,canvasWidth:e-t,canvasWidthCalc:r,viewportWidth:e,handleDrag:o,handleDoubleClick:d,persist:n}:{chatWidth:0,canvasWidth:e,canvasWidthCalc:"100vw",viewportWidth:e,handleDrag:()=>{},handleDoubleClick:()=>{},persist:()=>{}}}function z(e){const s=y.useState(y.selectWindowWidth);return(e??s)>1e3}const _="sharedCanvas";function De(){const[e,s]=X(),a=e.get(_),t=$();u.useEffect(()=>{const c=a&&Z.createRemixTempTextdoc(a,t);if(!c)return;requestAnimationFrame(()=>{ee(c)});const o=new URLSearchParams(e);o.delete(_),s(o);const n=new URL(window.location.href);n.searchParams.delete(_),history.replaceState(null,"",n)},[a,e,s,t])}function Fe(e,s){let a;return s?.type===g.Textdoc&&(s.textdocId.startsWith(te)||(a={type:"canvas_textdoc",id:s.textdocId})),{...e,messageMetadata:{...e.messageMetadata,open_in_canvas_view:a}}}const G=({isFullScreen:e=!1,clientThreadId:s,focusedObject:a,onClose:t,isAnimating:c=!1,width:o})=>{const{setTargetedContent:n}=se(),d=u.useRef(!1);if(u.useEffect(()=>(d.current&&n(void 0),d.current=!0,()=>{d.current=!1}),[a]),a==null)return null;switch(a.type){case g.Textdoc:return i.jsx(_e,{isFullScreen:e,onClose:t,clientThreadId:s,focusedTextdoc:a,isAnimating:c,width:o});case g.ADAVisualization:return null;case g.Sonic:return!1}},je=300,Oe=e=>{switch(e?.type){case g.Textdoc:return e.textdocId;case g.Sonic:return e.messageId;default:return null}};function ke(e,s){const[a,t]=xe(e,p=>[k.getRequestId(p),k.isMessageTurnEnded(p)]),c=ve(a),o=Ce(e),n=ae(),[d,r]=u.useMemo(()=>{if(o&&oe(o))return[void 0,null];if(s===!0)return[void 0,null];let p;return!t&&o&&(p=we(ne(o.messages))),Le({clientThreadId:e,isRequestActive:c,latestTextdocId:n,groupedMessage:p})},[t,o,c,n,s,e]),m=r!=null,x=Oe(r),w=ie("canvas");u.useEffect(()=>{if(r&&d&&!Se()&&(w(),re(r,d),r.type===g.Textdoc)){const{textdocId:p}=r,I=Re(p);ce(document.getElementById(I))}},[m,x])}function Le({clientThreadId:e,isRequestActive:s,latestTextdocId:a,groupedMessage:t}){switch(t?.type){case N.Canmore:{const[c,o]=t.messages;if(!de(c?.message))break;const n=le(s,c.message,o?.message??null),d=n.textdocId??a;if(d&&(n.function===ue.CreateTextdoc?(n.content??"").length>je||n.status===M.WAITING:n.status===M.STREAMING))return[n.messageId,{type:g.Textdoc,textdocId:d}];break}case N.SonicCanvas:break}return[void 0,null]}const Pe=260,b={type:"spring",bounce:.12,duration:.64},Ue={type:"spring",bounce:0,duration:.58},He=({clientThreadId:e,focusedObject:s,onClose:a})=>{const{chatWidth:t,canvasWidthCalc:c,handleDrag:o,handleDoubleClick:n,persist:d}=We(),r=U(),[m,x]=u.useState(!0),[w,p]=u.useState(!1),I=W(l=>l.activeSidebar),E=me(({rect:l})=>l),{windowHeight:v,windowWidth:C}=be(l=>l,{windowWidth:0,windowHeight:0});let h=E??{top:0,left:t,width:C-t,height:v},R=!1;if(E&&(h.top<0||h.top+h.height>v)){R=!0;const l={width:(C-t)*.75,height:v*.75};h={top:v/2-l.height/2,left:(C-t-l.width)/2+t,width:l.width,height:l.height}}if(r){const l=C-h.width-h.left;h={...h,left:-l}}const S=E?.borderRadius,A=pe(),B=A?.history!=null||A?.showChangesAtVersion!=null,q=W(l=>l.isDesktopNavCollapsed);return i.jsxs(i.Fragment,{children:[B&&i.jsx(Ee,{onClick:()=>fe(A.textdocId),zIndexKey:"chatOverlay"}),i.jsxs(f.div,{initial:!r&&{marginRight:q?0:-Pe},animate:!r&&{marginRight:0},transition:Ue,children:[i.jsx(f.div,{initial:{opacity:1},animate:{opacity:0},exit:{opacity:[1,0]},transition:{...b,delay:.22},className:"pointer-events-none absolute left-0 top-0 z-20 h-full w-full bg-token-main-surface-primary"}),!r&&i.jsx(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"pointer-events-none absolute left-0 top-0 z-10 h-full w-full bg-black/[0.025] dark:bg-transparent"}),i.jsx(f.div,{className:"relative z-20 h-full",style:{width:c},exit:{width:0},transition:{type:"spring",bounce:0,duration:.1}})]}),i.jsx(f.div,{className:ye("absolute z-20 h-full transition-shadow",r&&"right-0 max-h-[100cqh] max-w-[var(--available-details-width)] overflow-y-auto overflow-x-clip",!r&&"overflow-hidden",!r&&(I==="debug"?"md:left-[-250px] lg:left-[-300px] xl:left-[-350px] 2xl:left-[-400px]":"left-0")),initial:{borderRadius:S,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)",opacity:R?0:1,x:h.left,y:h.top,height:h.height,width:h.width},animate:{opacity:1,x:r?0:t,y:0,width:c,height:v,borderRadius:0,boxShadow:"0px 0px 18px rgba(0,0,0,0.075)"},exit:{scale:.64,opacity:0,filter:"blur(12px)",transition:{opacity:{duration:.14,bounce:.1}},borderRadius:S,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)"},transition:w?{duration:0}:b,onAnimationComplete:()=>x(!1),children:i.jsx(f.div,{className:"h-full overflow-hidden border-l border-gray-100 dark:border-token-border-medium",initial:{borderRadius:S},animate:{borderRadius:0},exit:{borderRadius:S},transition:b,children:i.jsxs("div",{className:"h-full",children:[i.jsx(f.div,{drag:"x",className:"absolute left-[-2px] z-10 h-full w-[4px] cursor-ew-resize bg-token-text-quaternary opacity-0",whileHover:{opacity:.5},whileDrag:{opacity:.75,width:"8px",left:"-4px"},transition:{type:"tween",duration:.1},style:{x:0,y:0,transform:"translateX(0px)"},dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:{left:0,right:0,top:0,bottom:0},onPointerDown:()=>p(!0),onPointerUp:()=>p(!1),onDrag:(l,Y)=>o(Y),onDragEnd:()=>{p(!1),d(t)},onDoubleClick:()=>n()}),w&&i.jsx("div",{className:"absolute inset-0 z-10"}),i.jsx(G,{onClose:a,clientThreadId:e,isAnimating:m,focusedObject:s,width:C-t})]})})})]})},Ve=u.memo(He),ze=({clientThreadId:e,focusedObject:s,onClose:a})=>i.jsx(Ie,{children:i.jsx(f.div,{className:"fixed inset-0 z-40 overflow-hidden shadow-xl md:border-gray-100 md:dark:border-gray-700",initial:{scale:.98},animate:{scale:1},transition:b,children:i.jsx(G,{isFullScreen:!0,clientThreadId:e,focusedObject:s,onClose:a})})}),Ge=({clientThreadId:e,overrideWidth:s,isAutoFocusDisabled:a=!1})=>{const t=z(s),c=Ae(e);ke(e,a),De();const o=ge();u.useEffect(()=>{P()},[e]);const n=o&&(t?i.jsx(Ve,{clientThreadId:e,onClose:j,focusedObject:o},"canvas-sidebar"):i.jsx(ze,{clientThreadId:e,onClose:j,focusedObject:o},"canvas-modal"));u.useEffect(()=>{if(o)return D(x=>Fe(x,o)),()=>D(null)},[o]);const d=U(),r=n!=null;return u.useEffect(()=>{if(!d)return F.setActiveStageSidebar(r),()=>{r&&F.setActiveStageSidebar(!1)}},[r,d]),c!==e?null:i.jsx(Q,{children:n})},St=e=>{const s=u.useRef(null);return i.jsx(Te,{ref:s,onError:(a,t)=>{P(),setTimeout(()=>{s.current?.resetErrorBoundary()}),he.logError("Error boundary hit",a,{componentStack:t})},name:"canmore-focused-view",children:i.jsx(Ge,{...e})})};export{St as CanvasFocusedViewManager};
//# sourceMappingURL=pbfah61ruv3xvhxr.js.map
