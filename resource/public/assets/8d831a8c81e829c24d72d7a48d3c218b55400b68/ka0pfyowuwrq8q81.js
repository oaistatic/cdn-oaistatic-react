const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/sanaqr6ytj58h5fc.js","assets/efuue3ezs0mj4ucx.js","assets/n1tvutderx19k1zs.js","assets/root-gmm606mb.css","assets/c87uv1mutc86tiqk.js","assets/conversation-small-nranh1cg.css","assets/fgx3tmmxgzj6epwy.js","assets/jsdcyj9n8sisyj26.js","assets/jpczowt57zzw912l.js","assets/bzaypvhehxbw5ucz.js","assets/d995zjnlydagrugw.js","assets/bc1e5dba03ekpmbp.js","assets/fudxsr1s5wqk63ki.js","assets/m3i9t52w2bjqxoks.js","assets/duvx3jmzsju7uw87.js","assets/iciw5hmv4qfc606n.js","assets/dnxtg4alg3s338gf.js","assets/lvedelvd2wa5y0ah.js","assets/jy24clh9s5sbm6a3.js","assets/bh0nczk7jf5nipy7.js","assets/ishe91rr928a0b40.js","assets/c1vsiyure2yziq8u.js","assets/ecs2ptmt646v6gvn.js","assets/gb5z15gr4uo6e2ww.js","assets/nm44lc6ye1cgdoqc.js","assets/bdjf60ajn8nmi3dh.js","assets/k081xtl7qxstenxt.js","assets/e0swan93qq28piri.js","assets/bei4zk14rknuqpj2.js","assets/kykf41pnxj3u2jkm.js","assets/pfhwziyza0777l0a.js","assets/abqqg32xty1y9c6f.js","assets/gpfnin52ickzsm2c.js","assets/nvkogakwzn6oww8b.js","assets/ibswgel9g2v9wlet.js","assets/oq09nie6yqvskddc.js","assets/npeqg3baimzobwf1.js","assets/njjifkipn1jlpz6u.js","assets/lbjorj0hkx1651pc.js","assets/10r444qw3w8sm7cg.js","assets/kzmahix4jeiri6hm.js","assets/ic63j46lwxfxhdlj.js","assets/d8mx7valoy6724sp.js","assets/jnjq4wt6v0sb6ord.js","assets/miss4pu1cz5qgbd7.js","assets/nbcn0hgfv7ahtijc.js","assets/jqzilhinf9ixym20.js","assets/gygy8wqvfvqbj4sk.js","assets/oqu6s9fqa0pl50wo.js","assets/m89x2zftpo6hrypr.js","assets/bjgwx71k1q27hq9q.js","assets/ec5wryw36r285g8f.js","assets/eap5trf7aabfzcb3.js","assets/gohrg29ji6orhvga.js","assets/h1cvdr02rrgnl0ia.js","assets/oszw1knsi7z008c4.js","assets/n2mw1xqoowews9pe.js","assets/gy64pge8qevmvg7e.js","assets/kfjh1usbem0itguo.js","assets/eevtyek0i3lh43t8.js","assets/kbwlsq1s2fesccmj.js","assets/or10jeufowa9j1t9.js","assets/miws4tkw2vsomlr4.js","assets/fzrn137102spawew.js","assets/e9lafxuzyeh4418f.js","assets/pevkepdko1ob7sgk.js","assets/o97za21c5v9glw28.js","assets/btt51di9wnsicd1p.js"])))=>i.map(i=>d[i]);
import{K as ce,ah as dt,ak as Dt,ae as Fe,s as J,bo as je,d$ as Xe,aG as yi,bG as ji,dq as qn,P as W,a as G,bW as Q,dm as Ci,bs as ze,bt as Ge,bg as Qe,J as ut,hG as Fo,X as Vs,H as Ta,t as Ye,b9 as $e,aw as ct,hH as wi,d as R,hI as Mi,S as ye,j as Ze,c5 as Ds,a7 as is,ai as Vn,cd as Oo,bJ as Ft,au as Oe,bq as $s,bY as Ot,an as yt,hJ as ka,aM as Uo,f as Ti,l as ki,C as Bt,L as jn,d_ as An,av as Ve,bK as $n,dv as Ls,r as Be,n as Je,bm as _i,eI as Kn,er as ls,c2 as zo,cy as Ai,cw as Ni,bX as Ei,dp as _a,a3 as Fs,eF as Aa,gu as Ii,as as Ri,I as Pi,B as Na,aE as Ea,dl as Di,eM as Bi,hK as Hi,gv as Yn,eo as Li,cm as Go,go as Fi,gp as Oi,bC as Ui,Y as Os,gI as zi,hL as Gi,c6 as Jn,hM as Wi,cV as qi,D as Nn,fa as Vi,bE as $i,a0 as Wo,Z as Ki,$ as Yi,fZ as Ji,fY as Xn,gF as Qn,c3 as ns,af as Ia,aK as qo,fz as Xi,ac as cs,eG as Ra,aq as Pt,dd as Pa,a1 as Qi,bj as Zi,hN as el,cf as tl,ed as En,fI as sl,q as as,aL as nl,ee as Us,be as Ts,al as Da,M as Ba,a2 as Ha,am as ol,b_ as al,u as La,f6 as rl,f1 as il,bI as ll,bZ as cl,dW as dl,br as Fa,gA as ul,hO as ml,bD as hl}from"./efuue3ezs0mj4ucx.js";import{c as fe,r as i,j as e,L as In,M as E,e as Ks,R as Zn,f as Oa,au as ne,b6 as gl,aw as ds,a as Ua,z as pl,v as fl,b7 as xl,b3 as Sl,b0 as Vo}from"./n1tvutderx19k1zs.js";import{a7 as Ys,cF as eo,hb as Bs,e0 as Ut,oe as to,l as jt,jj as vl,jk as bl,bT as Rn,an as yl,m as $o,ab as jl,at as Cl,ft as wl,au as Ml,aF as so,ch as Js,iT as no,ge as Tl,gW as kl,o as _l,of as lt,bC as Al,bK as za,og as Ga,oh as Pn,oi as Cn,oj as Nl,ok as ks,ol as El,gJ as Il,eO as Ue,eM as Rl,eN as Wa,m1 as Pl,lR as Ko,gI as Dl,dT as Bl,om as Hl,is as _s,on as Ll,A as Xs,d2 as Fl,u as Ol,oo as Ul,fJ as zl,cA as oo,y as Gl,op as Wl,hB as ql,oq as Vl,or as $l,e9 as se,os as qa,ot as Kl,af as Ke,ae as st,hL as ao,c4 as Yl,ou as ro,eY as Ht,ov as Va,ow as $a,eT as _e,ox as Le,gM as Ka,oy as Jl,kF as Ya,kI as Ja,gg as Xl,B as io,fU as Ql,kE as Zl,oz as Xa,mP as ec,oA as tc,oB as Lt,jQ as Qa,oC as $,oD as Za,oE as er,oF as sc,oG as nc,oH as oc,oI as ac,oJ as rc,oK as ic,gd as lc,oL as cc,oM as dc,oN as uc,oO as mc,oP as hc,oQ as gc,oR as pc,oS as fc,oT as xc,oU as Sc,oV as vc,oW as bc,oX as yc,oY as jc,oZ as Cc,o_ as wc,o$ as Mc,p0 as lo,a5 as zs,p1 as tr,gU as sr,gV as Tc,kj as nr,E as kc,O as _c,fL as Ac,f6 as Nc,p2 as Ec,p3 as Ic,dX as rs,kW as Dn,p4 as Rc,p5 as Pc,p6 as or,nr as Dc,p7 as Bc,nl as Hc,p8 as Lc,p9 as ar,pa as Fc,J as Oc,dD as rr,j1 as Uc,ah as zc,pb as Gc,cf as co,cg as ir,dy as Wc,dz as lr,pc as qc,pd as Yo,pe as Vc,pf as $c,cm as Jo,cj as Kc,j2 as Yc,pg as Jc,ph as Xc,pi as Qc,h0 as cr,pj as Zc,pk as ed,a6 as dr,gZ as Xo,h1 as ur,iP as uo,e2 as td,ci as sd,pl as nd,iy as od,l0 as ad,iz as rd,iA as id,mO as ld,ck as Hs,hR as cd,pm as dd,pn as ud,po as md,pp as hd,U as Gs,dR as gd,dn as pd,pq as fd,pr as xd,iM as Sd,gN as vd,mr as bd,ps as yd,gP as jd,gQ as Cd,pt as wd,pu as Md,pv as Td,pw as kd,px as _d,py as Ad,dj as Nd,iC as Ed,gC as Id,pz as Rd,na as Pd,pA as Dd,pB as Bd,f$ as Hd,pC as Ld,pD as Bn,pE as Fd,cp as Od,pF as Ud,eW as mr,pG as zd,pH as Gd,pI as hr,je as mo,eZ as Ws,pJ as Wd,pK as qd,pL as Vd,pM as Hn,d as gr,pN as Qo,pO as $d,nV as Kd,eU as Yd,pP as Jd,kM as pr,eV as Xd,pQ as Qd,pR as Zd,fF as eu,o7 as tu,pS as su,pT as nu,pU as ou,pV as au,l2 as ru,pW as iu,pX as As,dO as fr,pY as lu,gL as cu,dW as du,pZ as xr,p_ as uu,hW as qs,p$ as Ln,q0 as mu,q1 as hu,q2 as Ns,cC as Zo,q3 as gu,cG as pu,cH as fu,bJ as Sr,cV as vr,gu as br,gw as yr,d9 as xu,q4 as Su,hv as vu,mN as bu,q5 as yu,q6 as ju,q7 as jr,q8 as Cu,q9 as wu,qa as Mu,qb as Tu,ce as ku,di as _u,hV as Au,cD as Nu,qc as Eu,qd as Iu,gc as wn,gt as Ru,gv as Pu,ho as Du,qe as Bu,qf as Hu,qg as Lu,qh as Fu,qi as Ou,qj as Uu,qk as zu,ql as Gu,qm as Wu,dm as qu,qn as Vu,qo as $u,qp as Ku,kR as Yu,kS as Ju,kQ as Xu,qq as Qu,hN as Zu,h2 as em,h4 as tm,H as sm,gr as nm,iI as om,iJ as am,nu as rm,hg as im,h3 as lm,g_ as cm,qr as dm,qs as um,cX as mm,cW as hm,cZ as gm,qt as pm,h5 as ea,fK as fm,cK as xm,cL as Sm,im as vm,mp as bm,h8 as ym,qu as jm,ag as Cm}from"./c87uv1mutc86tiqk.js";import{e as Cr,f as wr,b as Qs,a as Mr,g as wm,s as Tr,t as Fn,c as kr,h as Zs,u as ho,i as go,T as Mm,j as Tm,k as ta,l as km,m as _m,n as Am,P as Nm}from"./d995zjnlydagrugw.js";import{S as Em,u as en,G as Im,L as Rm,a as Pm}from"./dnxtg4alg3s338gf.js";import{u as Dm,k as Bm,j as Hm,S as Lm,l as Fm,m as Om,n as Um,o as po,s as zm,p as Gm,q as Es,r as Wm,t as qm,v as tn,C as _r,c as Vm}from"./jy24clh9s5sbm6a3.js";import{B as $m}from"./c1vsiyure2yziq8u.js";import{C as On,g as Km}from"./ecs2ptmt646v6gvn.js";function Ar(t){const{currentModelId:s}=Dm(),a=Ys(t),[o,n]=ce(t,m=>[J.hasUserMessage(m),J.getGizmoId(m)]),r=dt(),l=eo(s),c=Dt(t)&&!o&&(Bs(a)||a?.kind===Fe.GizmoTest),d=Ut(n);return{showEmptyState:c,canUseNewHomepage:c&&d||c&&!n&&!l&&!r}}const sa=je.button`max-w-28 xs:max-w-40 sm:max-w-60 md:max-w-none group flex cursor-pointer items-center gap-1 rounded-lg py-1.5 ${({$shimmer:t})=>t?"loading-shimmer":""} ${({$isScreenArch:t})=>t?"text-md px-1":"px-1 text-lg"} hover:bg-token-main-surface-secondary radix-state-open:bg-token-main-surface-secondary font-semibold text-token-text-secondary overflow-hidden whitespace-nowrap`;function Ym({conversation:t,gizmoResource:s,elementRef:a}){const n=ce(t.id,r=>r?.title??null)??t.title;return e.jsx(In,{to:Cl(t.id,s),children:e.jsx(Q.Item,{onSelect:()=>{W.logEvent(G.projectsBreadcrumbPickerPickConversation)},icon:wl,children:e.jsx("div",{ref:a,children:n})},t.id)})}function Jm({gizmoId:t,clientThreadId:s,inMobileHeader:a,modelLabel:o,modelPickerContent:n}){const r=fe(),c=!to(t),{data:d}=jt(t),{items:p,hasNextPage:u,fetchNextPage:m,isLoading:h,isFetchingNextPage:x}=vl(t),g=i.useRef(null),b=i.useCallback(C=>{h||C==null||(g.current?.disconnect(),g.current=new IntersectionObserver(f=>{f[0].isIntersecting&&u&&m()}),g.current.observe(C))},[h,u,m]);i.useEffect(()=>()=>{g.current?.disconnect()},[]);const[T,S,v]=ce(s,C=>[C?.isLoading,C?.title??null,J.getThreadTitleSource(C)]),w=Xe(),{showEmptyState:_}=Ar(s),A=bl(),B=r.formatMessage(Rn.newChatTitle),{resolvedTitle:j,isTypingEffect:M}=yl(s,S,!0);if(!d||_)return null;const k=j==null&&(Dt(s)||v===yi.NewChat),I=T?e.jsx(e.Fragment,{}):e.jsxs(sa,{$isScreenArch:w,$shimmer:k,children:[e.jsxs("div",{className:"truncate",children:[M?e.jsx(Ml,{text:j??""}):j??B,c&&e.jsx("span",{className:"relative bottom-[1px] mx-1 inline-block rounded-md bg-token-main-surface-secondary px-1 text-xs leading-4 text-token-text-secondary",children:o})]}),e.jsx(so,{className:"icon-md text-token-text-tertiary"})]}),F=A&&d.gizmo.display.emoji?e.jsxs(e.Fragment,{children:[d.gizmo.display.emoji," ",d.gizmo.display.name]}):d.gizmo.display.name;return e.jsxs("div",{className:"flex items-center gap-0 overflow-hidden whitespace-nowrap px-2 py-1.5",children:[e.jsx(sa,{$isScreenArch:w,children:e.jsx(In,{className:"truncate",to:$o(d),children:F})}),e.jsxs(e.Fragment,{children:[e.jsx(ji,{className:"icon-md text-token-text-tertiary"}),e.jsxs(qn,{contentAlign:a?"center":"start",size:"small",onOpenChange:C=>{C&&W.logEvent(G.projectsBreadcrumbPickerOpen)},triggerButton:I,contentClassName:"max-h-[50dvh] overflow-y-scroll",children:[c&&e.jsxs(Q.Sub,{onOpenChange:C=>{C&&W.logEvent(G.projectsBreadcrumbPickerModelPickerOpen)},children:[e.jsx(Q.SubMenuTrigger,{children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-1",children:[e.jsx(E,{id:"ilkdMh",defaultMessage:"Model"}),e.jsx("span",{className:"text-xs font-medium text-token-text-secondary",children:o})]})}),e.jsx(Q.Portal,{children:e.jsx(Q.SubContent,{onClick:()=>{W.logEvent(G.projectsBreadcrumbPickerModelPickerSelect)},children:n})})]}),e.jsx(In,{to:$o(d),children:e.jsx(Q.Item,{onSelect:()=>{W.logEvent(G.projectsBreadcrumbPickerPickNewChat)},icon:jl,children:e.jsx(E,{...Rn.newChatProjectDropdownItem,values:{name:`"${d.gizmo.display.name}"`}})},"new-chat")}),p.filter(C=>C.id!==s).map((C,f)=>{const P=u&&f===p.length-4?b:void 0;return e.jsx(Ym,{elementRef:P,conversation:C,gizmoResource:d},C.id)}),x&&e.jsx("div",{className:"m-4 mb-5 flex justify-center",children:e.jsx(Ci,{})})]})]})]})}const Xm=ze(()=>Ge(()=>import("./sanaqr6ytj58h5fc.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(t=>t.ThreadHeaderGizmoDropdown)),Qm=ze(()=>Ge(()=>import("./jsdcyj9n8sisyj26.js"),__vite__mapDeps([7,2,4,1,3,5,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23])).then(t=>t.ConversationHeaderMenuItems));function Zm({clientThreadId:t}){const s=fe(),a=dt(),o=ce(t,J.getIsNewConversation),n=Ks(),[,r]=Oa(),l=()=>{!o&&!a?n({pathname:"/",search:new URLSearchParams({[_s]:"true"}).toString()}):r(c=>(c.get(_s)==="true"?c.delete(_s):c.set(_s,"true"),c),{replace:o,state:Ll()})};return e.jsx(Q.Item,{size:"large",className:"!pr-3",onClick:l,icon:El,children:e.jsxs("div",{className:"flex grow items-center justify-between gap-2",children:[e.jsx("div",{className:"flex flex-1 items-center gap-3",children:e.jsx(E,{...vo.temporaryChat})}),e.jsx(Il,{enabled:a,label:s.formatMessage({defaultMessage:"Temporary",id:"temporaryChatToggleLabel"}),testId:"temporary-chat-toggle"})]})})}function eh(t){return t.title?t.title:t.shortLabel}function fo(t,s){let a=t;if(t===Fo.AUTO){const r=s?.categories.filter(({defaultModel:l})=>l!==Fo.AUTO);r?.length===1&&(a=r[0].defaultModel)}const o=s?.categories.find(({defaultModel:r})=>r===a);if(o){const{categoryId:r}=o,l=eh(o);return{selectedCategory:r,modelLabel:l,omitPrefix:!!o.title}}const n=s?.groups.find(({modelIds:r})=>r.includes(a));if(n){const{group:r,shortLabel:l}=n;return{selectedCategory:r,modelLabel:l}}return{selectedCategory:null,modelLabel:null}}function th({modelLabel:t}){return e.jsx("span",{className:"overflow-x-clip text-ellipsis text-token-text-secondary",children:t})}function sh({clientThreadId:t,inMobileHeader:s}){const{isLoading:a,data:o}=ut(),n=Mi(),l=Js(t).id,c=no();Ue.markStart("ThreadModelSelector");const{modelLabel:d,omitPrefix:p}=fo(l,o),u=xo(t,c),m=fe(),{isUnauthenticated:h}=$e(),x=!h&&!n;d&&Ue.markRendered("ThreadModelSelector"),i.useEffect(()=>{a||Rl({namespace:Wa.ChatPageLoad})?.logTiming("render_model_switcher")},[a]);const g=Xe(),b=e.jsxs("div",{className:R(g?"overflow-x-hidden text-ellipsis":"text-token-text-secondary"),children:[p?null:`${Pl} `,x?e.jsx("span",{className:"text-token-text-secondary",children:d}):h&&d?e.jsx(th,{modelLabel:d}):null]});return u.length?a?null:e.jsx(qn,{sideOffset:8,size:"large",triggerButton:e.jsxs(Ko,{$isScreenArch:g,style:{viewTransitionName:"var(--vt-thread-model-switcher)"},"aria-label":d?m.formatMessage({id:"JrtGPQ",defaultMessage:"Model selector, current model is {modelLabel}"},{modelLabel:d}):"",children:[b,g?e.jsx(Dl,{className:"icon-md text-token-text-tertiary"}):e.jsx(so,{className:"icon-md text-token-text-tertiary"})]}),onOpenChange:T=>{W.logEvent(G.toggleModelSwitcher,{isOpen:T}),ye.logEvent("toggle_model_switcher",null,{isOpen:String(T)})},contentAlign:s?"center":"start",testId:"model-switcher-dropdown",children:e.jsx(So,{sections:u})}):e.jsx(Ko,{className:"cursor-default",children:b})}function nh({category:t,modelSwitcherDenialsBySlug:s,currentGizmoId:a,currentModelId:o,testId:n}){const{defaultModel:r,label:l,description:c,isBeta:d,isAlpha:p}=t,u=Bl(a??"");return e.jsx(Pn,{value:r,currentModelId:o,modelSwitcherDenialsBySlug:s,renderName:m=>e.jsx(Un,{name:l,description:c,isDisabled:m,isBeta:d,isAlpha:p}),isSelected:(!a||u)&&o===r,testId:n},r)}function xo(t,s,a=!1){const o=Js(t),n=o.id,r=Qe(t),{data:l}=ut(),{data:c}=Vs(),d=Tl(r),p=c&&Ta(c),u=Ye(t),m=kl({clientThreadId:t}),h=fe(),x=!u,{isUnauthenticated:g}=$e(),b=_l(),{layer:T}=ct("2723963139"),S=T.get("is_dynamic_model_enabled",!1),v=s.find(({categoryId:U})=>U===lt.ALPHA),w=s.find(({categoryId:U})=>U===lt.DATA_CAMPAIGNS),_=s.find(({categoryId:U})=>U===lt.EXPERIMENTS),A=s.find(({categoryId:U})=>U===lt.MAINLINE),B=!!v?.options?.length,j=!!w?.options?.length,M=!!_?.options?.length,k=!!A?.options?.length,I=Ks(),F=i.useCallback(()=>{W.logEvent(G.accountPayOpenPaymentFromModelPicker,{content:"gizmo-button"}),Al(I,"Thread header dropdown")},[I]),C=()=>{ye.logEvent("chatgpt_model_switcher_plus_upgrade_button_clicked"),W.logEvent(G.modelSwitcherPlusUpgradeButtonClicked),g?b({shouldOpenPaymentModalOnAuth:!0,callback:U=>{W.logSignUpButtonClicked({location:"Model switcher GPT-4 upsell",provider:U})}}):F()},f=[],[P,H]=i.useState(!1),V=e.jsxs(e.Fragment,{children:[a&&e.jsx(wi,{setIsScrolledToEdge:H}),e.jsxs("div",{className:R("mb-1 flex items-center justify-between px-5 pt-2",{"sticky top-0 z-10 bg-token-main-surface-primary py-2":a},{"[box-shadow:--sharp-edge-top-shadow]":a&&P},{"[box-shadow:--sharp-edge-top-shadow-placeholder]":a&&!P}),children:[e.jsx("span",{className:"text-sm text-token-text-tertiary",children:e.jsx(E,{id:"ilkdMh",defaultMessage:"Model"})}),e.jsx("a",{href:S?"https://help.openai.com/en/articles/9155758-what-is-the-chatgpt-plus-model-selector":"https://help.openai.com/en/articles/7102672-how-can-i-access-gpt-4",target:"_blank",rel:"noreferrer",children:e.jsx(za,{className:"icon-md h-5 w-5 pl-0.5 text-token-text-tertiary"})})]},"header")]});if(g){const U={id:"modelSection",content:[]};U.content.push(e.jsx(Ga,{statsig_login_event:"chatgpt_modelswitcher_login_button_clicked",statsig_signup_event:"chatgpt_modelswitcher_signup_button_clicked"},"noAuthUpsell")),f.push(U)}else if(!p&&!r){const U={id:"modelSection",content:[]};U.content.push(e.jsx(Pn,{value:"",currentModelId:n,onClick:C,modelSwitcherDenialsBySlug:m,isUpgradeUpsell:!0,renderName:D=>e.jsx(Un,{icon:Hl,isDisabled:D,name:h.formatMessage({id:"mzDzkX",defaultMessage:"ChatGPT Plus"}),description:h.formatMessage({id:"bqTHri",defaultMessage:"Our smartest model & more"})}),isSelected:!1,showNewChatHint:!1},"plusUpgrade")),U.content.push(e.jsx(Pn,{value:Cn.AUTO,currentModelId:n,modelSwitcherDenialsBySlug:m,renderName:D=>e.jsx(Un,{icon:Nl,name:h.formatMessage({id:"U9E7Rx",defaultMessage:"ChatGPT"}),description:h.formatMessage({id:"n96qML",defaultMessage:"Great for everyday tasks"}),isDisabled:D}),isSelected:!r&&n===Cn.AUTO,showNewChatHint:!0},Cn.AUTO)),f.push(U)}else{const U={id:"modelSection",content:[]};l?.categories.length&&U.content.push(V);const D=new Map;l?.categories.forEach(K=>{const Y=e.jsx(nh,{category:K,currentGizmoId:r,currentModelId:n,modelSwitcherDenialsBySlug:m,testId:`model-switcher-${K.defaultModel}`},K.categoryId);K.subcategory?(D.has(K.subcategory)||D.set(K.subcategory,[]),D.get(K.subcategory)?.push(Y)):U.content.push(Y)}),D.forEach((K,Y)=>{const de=l?.categories.find(ge=>ge.subcategory===Y&&ge.defaultModel===o.id);U.content.push(e.jsxs(Q.Sub,{children:[e.jsx(Q.SubMenuTrigger,{"data-testid":Y==="More models"?"more-models-submenu":void 0,children:e.jsxs("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:[Y,!!de&&e.jsx("div",{className:"truncate text-token-text-tertiary",children:de.label})]})}),e.jsx(Q.Portal,{children:e.jsx(Q.SubContent,{className:"min-w-72",children:K})})]},Y))}),f.push(U)}const q={id:"otherOptionsSection",content:[]},{selectedCategory:N}=fo(n,l);return x&&(B&&q.content.push(e.jsx(ks,{isSelected:N===lt.ALPHA,currentModel:o,option:v,modelSwitcherDenialsBySlug:m,displayInFull_INTERNAL_USE_ONLY:!0},v.value)),j&&q.content.push(e.jsx(ks,{isSelected:N===lt.DATA_CAMPAIGNS,currentModel:o,option:w,modelSwitcherDenialsBySlug:m,displayInFull_INTERNAL_USE_ONLY:!0},w.value)),M&&q.content.push(e.jsx(ks,{currentModel:o,isSelected:N===lt.EXPERIMENTS,option:_,modelSwitcherDenialsBySlug:m,displayInFull_INTERNAL_USE_ONLY:!0},_.value)),k&&q.content.push(e.jsx(ks,{isSelected:N===lt.MAINLINE,currentModel:o,option:A,modelSwitcherDenialsBySlug:m,displayInFull_INTERNAL_USE_ONLY:!0},A.value))),q.content.length&&f.push(q),!g&&!r&&!d&&f.push({id:"temporaryChatSection",content:[e.jsx(Zm,{clientThreadId:t},"tempChat")]}),f}function oh(){const t=fe();return e.jsx("div",{className:"border-token-text-quartenary items-center rounded-full border px-1 py-0.5 text-[8px] font-semibold uppercase leading-3 text-token-text-secondary dark:border-token-border-heavy dark:text-token-text-tertiary",children:t.formatMessage(vo.beta)})}function ah(){const t=fe();return e.jsx("div",{className:"border-token-text-quartenary items-center rounded-full border px-1 py-0.5 text-[8px] font-semibold uppercase leading-3 text-token-text-secondary dark:border-token-border-heavy dark:text-token-text-tertiary",children:t.formatMessage(vo.alpha)})}function Un({isDisabled:t,name:s,icon:a,description:o,extra:n,isBeta:r=!1,isAlpha:l=!1}){let c=s;return r&&(c=e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s}),e.jsx(oh,{})]})),l&&(c=e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s}),e.jsx(ah,{})]})),e.jsxs("div",{className:"flex items-center gap-3",children:[a&&e.jsx("span",{className:"flex h-7 w-7 flex-shrink-0 items-center justify-center rounded-full bg-token-main-surface-secondary",children:e.jsx(a,{className:"h-4 w-4 text-token-text-primary"})}),e.jsxs("div",{children:[c,e.jsxs("div",{className:R(!t&&"text-token-text-secondary","text-xs"),children:[o,n]})]})]})}function So({sections:t}){return e.jsx(e.Fragment,{children:t.map((s,a)=>e.jsxs(Zn.Fragment,{children:[a!==0?e.jsx(Q.Separator,{}):null,s.content]},s.id))})}function rh({clientThreadId:t,inMobileHeader:s=!1}){const a=Qe(t),o=Ut(a),n=to(a),{showEmptyState:r}=Ar(t),{data:l}=jt(a),{data:c}=ut(),p=Js(t).id,{modelLabel:u}=fo(p,c),m=no(),h=xo(t,m,n),x=e.jsx(sh,{clientThreadId:t,inMobileHeader:s});return a==null?n?e.jsx(Qm,{clientThreadId:t}):x:o?r&&l&&!n?x:e.jsx(Jm,{modelLabel:u??"",modelPickerContent:e.jsx(So,{sections:h}),gizmoId:a,clientThreadId:t,inMobileHeader:s}):e.jsx(Xm,{clientThreadId:t,gizmoId:a,inMobileHeader:s})}const vo=Ze({alpha:{id:"o5FsPB",defaultMessage:"Alpha"},beta:{id:"XZwFET",defaultMessage:"Beta"},gpt35ShortExplainer:{defaultMessage:"Great for everyday tasks",id:"ModelSwitcher.gpt35ShortExplainer"},modelTunerSmartSelectionTitle:{id:"czjW8I",defaultMessage:"Dynamic"},modelTunerSmartSelectionExplainer:{id:"gp/YH1",defaultMessage:"Optimized for speed and intelligence"},gpt4ShortExplainer:{defaultMessage:"With DALL·E, browsing and analysis",id:"ModelSwitcher.gpt4ShortExplainer"},gpt4ShortExplainerWithoutBrowse:{defaultMessage:"With DALL·E and analysis",id:"ModelSwitcher.gpt4ShortExplainerWithoutBrowse"},gpt4UpsellExplainer:{id:"ModelSwitcher.gpt4Upsell",defaultMessage:"Our smartest and most capable model. Includes DALL·E, browsing and more."},userUpgrade:{id:"ModelSwithcer.upgradeButton",defaultMessage:"Upgrade to Plus"},userUpgradeSignup:{id:"ModelSwitcher.signupUpgradeButton",defaultMessage:"Sign up for ChatGPT Plus"},temporaryChat:{id:"ModelSwitcher.temporaryChat",defaultMessage:"Temporary chat"},shareChat:{id:"ModelSwitcher.shareChat",defaultMessage:"Share chat"}}),ih=ze(()=>Ge(()=>import("./nm44lc6ye1cgdoqc.js"),__vite__mapDeps([24,2,1,3,25,26,4,5,27,28,29,30,31,18,10,19,20,32,33,34,9,35,36,37,38,16,6,39,15,17,40])).then(t=>t.GizmoUsingAsOwnerNotice)),lh=({clientThreadId:t})=>{const s=Xs(h=>h.activeStageSidebar),a=Ye(t),o=Fl(Ds.WorkspaceShareLinks),{isUnauthenticated:n}=$e(),r=dt(),l=Qe(t),c=Ut(l),d=Ol(),p=o&&a&&!n&&!r&&!c&&!d,u=Xe(),m=!s&&!(!n&&u);return e.jsx("div",{className:R(!u&&"gap-2",u&&"@lg/screen-composer:gap-1","flex items-center pr-1 leading-[0]"),children:e.jsx(Bm,{showShareButton:p,showProfileDropdown:m,clientThreadId:t})})};function ch({clientThreadId:t,gizmoId:s}){const a=Ul(),{data:o}=jt(s),n=is();return e.jsxs(e.Fragment,{children:[e.jsxs(zl,{className:"max-md:hidden",children:[e.jsxs("div",{className:"absolute start-1/2 ltr:-translate-x-1/2 rtl:translate-x-1/2",children:[o!=null&&n?.isWorkspaceAccount()&&o.gizmo.tags?.includes(oo.WorkspaceDisabled)&&e.jsx(ih,{gizmo:o}),e.jsx(Gl,{gizmoId:s,clientThreadId:t})]}),e.jsxs("div",{className:"flex items-center gap-0 overflow-hidden",children:[e.jsx(Hm,{clientThreadId:t}),e.jsx(rh,{clientThreadId:t})]}),e.jsx(lh,{clientThreadId:t})]}),a&&e.jsx(Wl,{})]})}function Nr({clientThreadId:t}){const s=Qe(t),a=Vn(),o=Xe();return a||o?null:e.jsx(ch,{gizmoId:s,clientThreadId:t})}const na=je.div`m-8 flex flex-col items-center`;function oa(t){return e.jsx(ne.div,{initial:{opacity:0,translateY:20},animate:{opacity:1,translateY:0,transition:{duration:.5,ease:"easeIn"}},...t})}function dh({clientThreadId:t}){const a=ce(t,n=>n?.promptGptRating)?.gizmoId,{data:o}=jt(a);return a==null||o==null||!ql(o)?null:e.jsx(uh,{gizmoId:a})}function uh({gizmoId:t}){const[s,a]=i.useState(!1),[o,n]=i.useState(!1),r=Vl(t),l=async d=>{a(!0),setTimeout(()=>{n(!0)},5e3),W.logEvent(G.submitInlineRating,{gizmo_id:t,rating:d}),await r.mutateAsync({rating:d})},c=async()=>{n(!0),W.logEvent(G.dismissInlineRating,{gizmo_id:t}),await r.mutateAsync({})};return i.useEffect(()=>{o||W.logEvent(G.showInlineRating,{gizmo_id:t})},[o,t]),o?null:s?e.jsx(na,{children:e.jsxs(oa,{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"rounded-lg border border-token-border-heavy p-4",children:e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(E,{id:"gizmo.inlineReview.reviewLeft",defaultMessage:"Feedback sent"}),e.jsx(Oo,{onClick:()=>{n(!0)}})]})}),e.jsx("div",{className:"text-xs text-token-text-tertiary",children:e.jsx(E,{id:"gizmo.inlineReview.reviewLeftSubtext",defaultMessage:'To update your rating, click "Send Feedback" in the GPT Menu'})})]})}):e.jsx(na,{children:e.jsxs(oa,{className:"flex flex-col items-center gap-4 rounded-lg border border-token-border-heavy p-4",children:[e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(E,{id:"gizmo.inlineReview.prompt",defaultMessage:"How would you rate this GPT so far?"}),e.jsx(Oo,{onClick:c})]}),e.jsx($l,{rating:void 0,onRating:l})]})})}const Er=new Map([[se.Think,{hover:[G.composerThinkButtonHovered,"composer_think_button_hovered"],enable:[G.composerThinkButtonEnabled,"composer_think_button_enabled"],disable:[G.composerThinkButtonDisabled,"composer_think_button_disabled"]}]]);function Ir({systemHint:t,logo:s,highlightTooltip:a,isPinnedActive:o,isDisabled:n,composerController:r,analyticsMetadata:l,onClick:c,showLabel:d=!1}){const{name:p,systemHint:u}=t,m=u,{setThreadSystemHintMode:h,clearAllSystemHintModeTriggers:x}=Qs(),g=Cr(m),b=!!t.composerBarButtonInfo?.upsell,T=wr.useStore(),[S,v]=i.useState(!1),{value:w}=Oe("2454940646"),{value:_}=Oe("2800342425"),A=gl(),B=n||o,j=Mr();i.useEffect(()=>{n&&j.has(m)&&h(m,!1,l)},[n,m,l,h,j]);const M=!n&&(g||a),k=e.jsxs("button",{className:R("flex h-9 min-w-8 items-center justify-center rounded-full border border-token-border-light p-2 text-[13px] font-semibold radix-state-open:bg-black/10 can-hover:hover:bg-token-main-surface-secondary dark:can-hover:hover:bg-gray-700",{"transition-all duration-150":S},{"text-token-text-secondary":!g&&!a&&!o},{"bg-blue-250 text-blue-1000 dark:bg-[#2A4A6D] dark:text-[#48AAFF]":M||o,"can-hover:hover:bg-[#BDDCF4] dark:hover:bg-[#1A416A]":M&&!o},{"focus-visible:outline-black can-hover:hover:bg-black/10 dark:focus-visible:outline-white":!B},{"opacity-30":n&&!o,"opacity-50":o}),"aria-pressed":g,"aria-label":p,disabled:B,onTransitionEnd:()=>v(!1),onClick:I=>{if(I.stopPropagation(),I.preventDefault(),b)return;v(!0);let F=!0;const C=[se.Search,se.Think].includes(m);w&&C&&(T.getState().persistedSystemHints.has(se.Search)||T.getState().persistedSystemHints.has(se.Think))&&(F=!1),F&&(wm(),x()),h(m,!g,l),_&&C&&Tr(m,!g),g||(r.removeSystemHints(),r.focus());const{enable:f,disable:P}=Er.get(m)??{},[H,V]=(g?P:f)??[];H&&V&&W.logEventWithStatsig(H,V,l),c?.(I)},children:[s,d&&e.jsx("div",{className:"whitespace-nowrap pl-1 pr-1 [display:--force-hide-label]",children:p}),e.jsx(ds,{children:!d&&g&&e.jsx(ne.span,{initial:{x:-10,width:0,opacity:0},animate:{x:0,width:"fit-content",opacity:1},exit:{x:-10,width:0,opacity:0},transition:{ease:"easeOut",duration:A?0:.15},children:e.jsx("div",{className:"whitespace-nowrap pl-1 pr-2 [display:--force-hide-label]",children:p})})})]});return b?e.jsx(qn,{triggerButton:k,sideOffset:0,alignOffset:0,children:e.jsx(Ga,{statsig_login_event:"chatgpt_composer_upsell_login_button_clicked",statsig_signup_event:"chatgpt_composer_upsell_signup_button_clicked"})}):k}function mh({composerController:t,systemHint:s,highlightTooltip:a,composerBarButtonInfo:o,isDisabled:n,clientThreadId:r,showLabel:l,isPinnedActive:c,currentModelName:d}){const p=Cr(s.systemHint),u={clientThreadId:r};return e.jsx(ph,{composerBarButtonInfo:o,highlightTooltip:a,isThreadInSystemHintMode:p,isDisabled:n,isPinnedActive:c,analyticsMetadata:u,systemHint:s.systemHint,currentModelName:d,children:e.jsx(Ir,{highlightTooltip:a,isDisabled:n,isPinnedActive:c,systemHint:s,logo:e.jsx(qa,{svgString:s.logo,className:"h-[18px] w-[18px]"}),composerController:t,analyticsMetadata:u,showLabel:l})})}function hh(t){const s=ro(),a=st(t);return!a.isLoading&&a.eligible&&!s}const gh={p:t=>{const{node:s,children:a,...o}=t;return e.jsx("p",{...o,className:"text-start !text-sm !leading-6 text-white",children:a})},a:t=>{const{node:s,children:a,...o}=t;return e.jsx("a",{...o,className:"!text-sm !leading-6 !text-white !underline",children:a})}};function ph({children:t,highlightTooltip:s,isThreadInSystemHintMode:a,isDisabled:o,isPinnedActive:n,systemHint:r,composerBarButtonInfo:l,analyticsMetadata:c,currentModelName:d}){const p=Kl();let u=hh(l.announcementKey)&&!p;const m=l.announcementKey===Ke.hasSeenNewCoTSummarizerNUX;m||(u&&=!a);const h=wr.useStore();i.useEffect(()=>{u&&m&&h.addPersistedSystemHint(se.Think,{})},[m,u,h]);const x=st(l.announcementKey),g=fe();return u?e.jsx(ao,{announcementKey:l.announcementKey,side:"bottom",show:!0,theme:"bright",dismissOnOutsideClick:!0,badge:"new",title:l.nuxTitle,onDismiss:x.markAsViewed,sideOffset:0,className:"!max-w-2xs xs:!max-w-sm",description:e.jsx(Yl,{componentOverrides:gh,children:l.nuxDescription}),children:e.jsx("div",{children:t})}):e.jsx("div",{children:e.jsx(Ft,{sideOffset:0,label:o?l.disabledText:n?g.formatMessage({id:"gFCsls",defaultMessage:"You've selected a thinking model {modelName}"},{modelName:`(${d})`}):l.tooltipText,side:"right",open:s||void 0,onOpenChange:b=>{if(b){const{hover:T}=Er.get(r)??{},[S,v]=T??[];S&&v&&W.logEventWithStatsig(S,v,c)}},children:t})})}const Is={initial:{opacity:0,y:20,scale:.9},animate:{opacity:1,y:0,scale:1},transition:{delay:.1},exit:{opacity:0,scale:.5,transition:{duration:.2}}},fh=({suggestions:t,onSelectingSuggestedReply:s})=>e.jsx("div",{className:"absolute bottom-full flex w-full max-w-[100vw] grow gap-2 overflow-auto px-1 pb-1 contain-inline-size sm:mb-0 sm:justify-start sm:px-2 sm:pb-0 md:static md:mb-2 md:max-w-none md:justify-center md:overflow-visible",children:t.slice(0,2).map((a,o)=>e.jsx(ne.div,{initial:Is.initial,animate:Is.animate,transition:{delay:(o-1)*Is.transition.delay},exit:Is.exit,children:e.jsx(Ot,{as:"button",color:"secondary",size:"small",onClick:()=>{s(a,t,o)},className:"group whitespace-nowrap md:whitespace-normal",children:e.jsx(Sh,{suggestion:a})},o)},o))});function xh({suggestions:t,onSelectingSuggestedReply:s,clientThreadId:a}){const o=t?.length>0;i.useEffect(()=>{o&&Ht(t,a)},[o,a]);const{isUnauthenticated:n}=$e();return o?t.every(Va)?e.jsxs(ne.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:"flex flex-col items-center",children:[n&&e.jsx($s,{className:"mb-6 h-12 w-12 sm:hidden"}),e.jsx(Em,{starterPrompts:t,onSelectStarterPrompt:s})]}):t.every($a)?e.jsx(fh,{suggestions:t,onSelectingSuggestedReply:s}):null:null}function Sh({suggestion:t}){return $a(t)?e.jsx(e.Fragment,{children:t.text}):Va(t)?e.jsxs("div",{className:"flex flex-col overflow-hidden",children:[t.title&&e.jsx("div",{className:"truncate font-semibold",children:t.title}),e.jsx("div",{className:R("truncate font-normal",t.title?"opacity-50":""),children:t.body})]}):null}function vh(){const{store:t}=_e(),s=t.useSharedProps();return s?e.jsx(bh,{...s}):null}function bh({clientThreadId:t,suggestions:s}){const a=en();return s===void 0||s.length===0?null:e.jsx("div",{children:e.jsx(yh,{children:e.jsx("div",{className:"grow",children:s!==void 0&&e.jsx(xh,{suggestions:s,onSelectingSuggestedReply:a,clientThreadId:t})})})})}const yh=je.div`h-full flex ml-1 md:w-full md:m-auto gap-0 md:gap-2 justify-center`,Rr=({className:t,children:s})=>e.jsx(ne.div,{className:t,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,transition:{duration:.1,delay:0}},transition:{type:"tween",duration:.3,delay:.2},children:s});function jh({currentLeafId:t,canContinue:s,onContinueGenerating:a}){const o=i.useCallback(()=>{a(t),Fn()},[a,t]);let n=null;return s&&(n=e.jsx(wh,{onHandleContinueGenerating:o})),n&&e.jsx("div",{className:"flex h-full w-full items-center justify-end gap-0 py-4 md:gap-2",children:n})}function Ch({className:t}){return e.jsx(Ka,{className:R("-rotate-180",t)})}const wh=({onHandleContinueGenerating:t})=>e.jsx(Rr,{children:e.jsx(Ot,{as:"button",color:"secondary",onClick:t,className:"whitespace-nowrap py-2",icon:Ch,size:"small",children:e.jsx(E,{...Le.continueGenerating})})}),Mh=({clientThreadId:t})=>{const s=ka(),a=ce(t,J.getRequestId),o=yt(a);i.useEffect(()=>{o&&Uo.dismissBanner()},[o]);const n=s?.is_dismissible?()=>Uo.dismissBanner():void 0;return e.jsx(ds,{children:s&&e.jsx(ne.div,{transition:{type:"tween",ease:"easeInOut",duration:.1},initial:{opacity:0,transform:"translateY(8px)"},animate:{opacity:1,transform:"translateY(0px)"},exit:{opacity:0,transform:"translateY(8px)"},children:e.jsx(Jl,{clientThreadId:t,rateLimitInfo:s,onDismiss:n})})})};function Th(t){const s=ce(t,J.getRequestId),a=yt(s),o=ka();return!a&&o!=null}const zn=window.sessionStorage,Gn=Ti(ki(()=>({memoryFullBannerDismissed:!!zn?.getItem(Bt.MemoryFullBannerDismissed)}))),Pr={dismissBanner(){Gn.setState(t=>{t.memoryFullBannerDismissed=!0}),zn?.setItem(Bt.MemoryFullBannerDismissed,"true")},clearDismissedBanner(){Gn.setState(t=>{t.memoryFullBannerDismissed=!1}),zn?.removeItem(Bt.MemoryFullBannerDismissed)}};function kh(t){const s=Qe(t),a=Ya(),{data:o}=Ja(s,!1,a),n=o!=null,r=n&&o.memoryFullPct>=100,[l,c]=i.useState(!1);i.useEffect(()=>{!r&&n&&(c(!0),Pr.clearDismissedBanner())},[r,n]);const d=Gn(p=>p.memoryFullBannerDismissed);return r&&l&&!d}function _h(){const t=fe(),{openSettings:s}=Xl();return e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},children:e.jsx(io,{title:t.formatMessage(Rs.memoryFullTitle),content:t.formatMessage(Rs.memoryFullTooltip,Rs.memoryFullTooltip.values),primaryCtaText:t.formatMessage(Rs.memoryManageButton),onPrimaryCtaClick:()=>s(Ql.Personalization),onDismiss:()=>Pr.dismissBanner()})})}const Rs=Ze({memoryFullTitle:{id:"yRGU2/",defaultMessage:"Memory is full."},memoryManageButton:{id:"a5A88o",defaultMessage:"Manage"},memoryFullTooltip:{id:"neUc+N",defaultMessage:"New memories won’t be created until you make space. <a>Learn more</a>",values:{a:t=>e.jsx("a",{href:Zl,target:"_blank",rel:"noopener noreferrer",className:"underline",children:t})}}}),bo=Ke.hasSeenMemoryInSearch;function Ah(){const t=Ks();i.useEffect(()=>{W.logEventWithStatsig(G.chatgptMemoryInSearchAnnouncementShown,"chatgpt_memory_in_search_announcement_shown")},[]);const{markAsViewed:s}=st(bo),a=i.useCallback(()=>{W.logEventWithStatsig(G.chatgptMemoryInSearchAnnouncementClosed,"chatgpt_memory_in_search_announcement_closed"),s()},[s]),o=i.useCallback(()=>{W.logEventWithStatsig(G.chatgptMemoryInSearchAnnouncementCTAClicked,"chatgpt_memory_in_search_announcement_cta_clicked"),t("#settings/Personalization"),s()},[s,t]);return e.jsx(io,{onPrimaryCtaClick:o,primaryCtaText:e.jsx(E,{id:"8MwdJw",defaultMessage:"Settings"}),onDismiss:a,content:e.jsxs("div",{className:"flex-grow",children:[e.jsx("div",{className:"mb-0.5 font-semibold",children:e.jsx(E,{id:"Sdp8JT",defaultMessage:"Search, now with memory"})}),e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(E,{id:"a4czFu",defaultMessage:"ChatGPT can now use memories to shape searches it sends to search providers, to give you more relevant answers. You can turn this off at any time in settings. {learnMoreLink}",values:{learnMoreLink:e.jsx("a",{href:"https://help.openai.com/en/articles/9237897-chatgpt-search",target:"_blank",rel:"noopener noreferrer",className:"underline",children:e.jsx(E,{id:"JMsjZT",defaultMessage:"Learn more"})},"learn-more-link")}})})]})})}function Dr(){const t=st(bo),{userIsInSearchHoldoutWithWebDisabled:s}=kr();return t.eligible&&!t.isLoading&&!s}function Nh(){const{markAsViewed:t,eligible:s}=st(bo);return s?t:void 0}const Eh=()=>{const{shouldShowSkipButton:t}=Xa();return t?e.jsx(Rr,{className:"flex justify-center",children:e.jsx(Ot,{as:"button",color:"secondary",onClick:()=>ec.skipParagen(),children:e.jsx(E,{...Ih.skip})})}):null},Ih=Ze({skip:{id:"dvcUbp",defaultMessage:"Skip"}}),Rh=ze(()=>Ge(()=>import("./ic63j46lwxfxhdlj.js"),__vite__mapDeps([41,2,4,1,3,5,42,43,44])).then(t=>t.JawboneNotificationsBanner)),Br=i.memo(function({className:s}){const{store:a}=_e(),o=a.useIsHeaderContentAreaPopulated();return e.jsx("div",{className:R(s??"absolute bottom-full left-0 right-0",er.PromptTextareaHeader),children:e.jsx(tc,{shouldRender:o,contentArea:Lt.Header,children:e.jsxs("div",{className:"mb-2 flex flex-col gap-3.5 pt-2",children:[e.jsx(Hr,{}),e.jsx(Lr,{})]})})})});function Hr(){const{store:t}=_e(),s=t.useSharedProps(r=>r?.clientThreadId),a=t.useContentAreaId(Lt.HeaderTop),o=Qa();let n;switch(a){case $.ProjectConversationTaskNoFileAccess:n=e.jsx(Hh,{});break;case $.AdvancedVoiceOnMobileAnnouncement:n=e.jsx(ic,{clientThreadId:s});break;case $.S09KM1:n=null;break;case $.ParagenControls:n=e.jsx(Eh,{});break;case $.ItemActions:n=e.jsx(vh,{});break;case $.BannerSignup:n=e.jsx(Bh,{});break;case $.BannerTermsDisclaimer:n=e.jsx(Lh,{});break;case $.PromptTextareaAction:n=e.jsx(Fh,{});break;case $.BannersRateLimit:n=e.jsx(Oh,{});break;case $.BannerSidekickAnnouncement:n=e.jsx(rc,{});break;case $.SearchBrowserExtensionAnnouncement:n=e.jsx(Fm,{});break;case $.MemoryInSearchAnnouncement:n=e.jsx(Ah,{});break;case $.MoonshineAnnouncement:n=e.jsx(ac,{});break;case $.SearchBrowserExtensionReactiveAnnouncement:n=e.jsx(Lm,{});break;case $.BannerMemoryFull:n=e.jsx(_h,{});break;case $.Box:n=e.jsxs("div",{className:"flex h-20 w-full items-center justify-center gap-2 bg-red-500 p-2",children:["box",e.jsxs("div",{className:"flex h-full w-full items-center justify-center gap-2 bg-blue-500 p-2",children:["inner",e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-yellow-400 text-center",children:"actual content"})]})]});break;case $.JawboneAnnouncement:o?n=e.jsx(Rh,{}):n=null;break;case $.JawboneMaxActiveAnnouncement:o?n=e.jsx(oc,{}):n=null;break;case $.PromoRedemptionAnnouncement:n=e.jsx(nc,{});break;case $.OperatorAnnouncement:n=e.jsx(sc,{});break;default:n=null;break}return n}function Lr(){const{store:t}=_e(),s=t.useContentAreaId(Lt.HeaderBottom);let a;switch(s){case Za.DallePromptControls:a=e.jsx(Dh,{});break;default:a=null;break}return a}const Ph=ze(()=>Ge(()=>import("./nbcn0hgfv7ahtijc.js"),__vite__mapDeps([45,2,1,3,4,5,10,46])).then(t=>t.default));function Dh(){const{store:t}=_e(),s=t.useSharedProps(a=>a?.composerController);return s?e.jsx(Ph,{composerController:s}):null}function Bh(){const{store:t}=_e(),s=t.useSharedProps(n=>n?.clientThreadId),a=lc(),o=cc();return s?a?e.jsx(dc,{threadId:s,showSignUp:o}):e.jsx(uc,{threadId:s,showLogin:o}):null}function Hh(){return i.useEffect(()=>()=>{jn.getItem(Bt.TasksHasSeenProjectDisclaimerBanner)||jn.setItem(Bt.TasksHasSeenProjectDisclaimerBanner,!0)},[]),e.jsx(io,{icon:e.jsx(za,{}),title:e.jsx(E,{id:"ibX3g7",defaultMessage:"Tasks can’t access project files"}),content:e.jsx(E,{id:"fm94Tm",defaultMessage:"There’s a task in this conversation — just FYI, it won’t be able to access project files."}),onDismiss:()=>{jn.setItem(Bt.TasksHasSeenProjectDisclaimerBanner,!0)}})}function Lh(){const{store:t}=_e(),s=t.useSharedProps(a=>a?.clientThreadId);return s?e.jsx(mc,{threadId:s}):null}function Fh(){const{store:t}=_e(),s=t.useSharedProps();return s?e.jsx(jh,{...s}):null}function Oh(){const{store:t}=_e(),s=t.useSharedProps(a=>a?.clientThreadId);return s?e.jsx(Mh,{clientThreadId:s}):null}const Uh=5,zh=i.memo(function(s){return Gh(s),Wh(s),qh(),null});function Gh(t){const{store:s}=_e(),a=s.useSetSharedProps();An(()=>{a(t)},[t,a])}function Wh(t){const{clientThreadId:s,canContinue:a}=t,{store:o}=_e(),n=i.useRef({top:o.useContentAreaApi(Lt.HeaderTop),bottom:o.useContentAreaApi(Lt.HeaderBottom)}).current,r=Kh(t),l=hc(s),{shouldShowBannerSignup:c,shouldShowBannerTermsDisclaimer:d}=Yh(s),p=Th(s),u=gc(t),m=Om(t),h=Dr(),x=ro(),g=Um(t),b=kh(s),T=pc(),S=fc(t),v=xc(s),w=Sc(s),_=vc(s),A=bc(),B=yc(),j=ce(s,k=>k?.modelId),M=Ys(s);An(()=>{j&&M?.kind===Fe.GizmoInteraction&&M.gizmo&&Mc(j,M.gizmo)?n.top.set($.ProjectConversationTaskNoFileAccess):S.eligible?n.top.set($.AdvancedVoiceOnMobileAnnouncement):T?n.top.set($.ParagenControls):d?n.top.set($.BannerTermsDisclaimer):p?n.top.set($.BannersRateLimit):w?n.top.set($.JawboneAnnouncement):_?n.top.set($.JawboneMaxActiveAnnouncement):u.eligible?n.top.set($.BannerSidekickAnnouncement):h?n.top.set($.MemoryInSearchAnnouncement):x?n.top.set($.MoonshineAnnouncement):m?n.top.set($.SearchBrowserExtensionAnnouncement):g?n.top.set($.SearchBrowserExtensionReactiveAnnouncement):A?n.top.set($.PromoRedemptionAnnouncement):B()?n.top.set($.OperatorAnnouncement):r?n.top.set($.ItemActions):a?n.top.set($.PromptTextareaAction):c?n.top.set($.BannerSignup):b?n.top.set($.BannerMemoryFull):v?n.top.set("CaterpillarDoneAnnouncement"):n.top.set(null)},[n,r,a,d,c,p,u,b,T,S]),An(()=>{l&&n.bottom.set(Za.DallePromptControls)},[n,l])}function qh(){const{store:t}=_e();i.useEffect(()=>()=>{t.reset()},[t])}function Vh(t){const s=lo(),a=$n(t),o=J.getTree(Be(t)).getLastValidNode(a)?.message?.id;return s?.messageId===o?s.suggestions:[]}function $h(t){return Vh(t).length>0}function Kh(t){const{value:s}=Ve("1887864177"),a=jc(t.clientThreadId),o=$h(t.clientThreadId);return t.isDisabled||s?!1:t.isNewThread||a||o}function Yh(t){const{isUnauthenticated:s}=$e(),a=$n(t),{layer:o}=Ls("3637408529"),{layer:n}=ct("3637408529"),r=n.get("no_auth_banner_signup_rate_limit",Uh),l=o.get("should_show_no_auth_signup_banner",!0),c=Cc(g=>g.bannerDisclaimerClientThreadId),d=wc(),p={shouldShowBannerTermsDisclaimer:!1,shouldShowBannerSignup:!1};if(!t)return p;const u=J.getTree(Be(t)),m=u.countMessagesByAuthor(Je.User),h=u.getNodeByIdOrMessageId(a),x=h?.message?.author.role===Je.Assistant&&_i(h.message);return p.shouldShowBannerTermsDisclaimer=x&&s&&m===1&&!d&&(c==null||c===t),p.shouldShowBannerSignup=l&&x&&s&&m>0&&m%r===0,p}const Jh=({disabled:t,clientThreadId:s})=>{Ue.markStart("ComposerModelSelectorButton",Ue.NS_COMPOSER);const a={clientThreadId:s},o=no(),n=xo(s,o,!0),{isLoading:r,data:l}=ut(),c=ce(s,x=>x?.modelId),d=zs(l?.models,c);if(r||!d)return null;const u=l?.categories.find(x=>x.defaultModel===d.id)?.shortLabel??d.title;Ue.markRendered("ComposerModelSelectorButton",Ue.NS_COMPOSER);function m(){W.logEventWithStatsig(G.composerSystemHintButtonHovered,"composer_model_selector_button_hovered",a)}function h(){W.logEventWithStatsig(G.composerSystemHintButtonClicked,"composer_model_selector_button_clicked",a)}return e.jsx(Xh,{disabled:t,modelLabel:u,onHover:m,onOpen:h,children:e.jsx(So,{sections:n})})},Xh=({disabled:t,children:s,modelLabel:a,onHover:o,onOpen:n})=>{const r=fe(),[l,c]=i.useState(!1);return e.jsxs(Q.Root,{open:l,onOpenChange:d=>{c(d),d&&n?.()},children:[e.jsx(Qh,{disabled:!!t,children:e.jsx(Kn,{className:R(tr.toolsButton,"flex h-8 min-w-8 items-center justify-center gap-1 rounded-lg p-1 px-2 text-sm font-semibold text-token-text-secondary hover:bg-black/10 focus-visible:outline-black disabled:opacity-30 radix-state-open:bg-black/10 dark:focus-visible:outline-white"),"aria-label":r.formatMessage({id:"njhg2P",defaultMessage:"Choose a model"}),disabled:t,onPointerOver:o,onClick:d=>{d.preventDefault()},onFocusCapture:d=>{d.stopPropagation()},children:a})}),e.jsx(Q.Portal,{children:e.jsx(Q.Content,{alignOffset:-16,onCloseAutoFocus:d=>{d.preventDefault()},className:"[--radix-popper-available-height:40dvh]",removeVerticalPadding:!0,addBottomGradient:!0,children:e.jsx("div",{className:"flex flex-col",children:s})})})]})},Qh=({disabled:t,children:s})=>e.jsx(Ft,{side:"right",sideOffset:0,label:t?e.jsx(E,{id:"WU1XH1",defaultMessage:"Model selector unavailable"}):e.jsx(E,{id:"7bVJwH",defaultMessage:"Choose a model"}),children:s});function Zh({composerController:t,isDisabled:s,highlightTooltip:a,isPinnedActive:o,clientThreadId:n,showLabel:r}){const l=Zs(),c=fe(),d=i.useMemo(()=>({clientThreadId:n}),[n]),p=i.useCallback(()=>{W.logEventWithStatsig(G.composerSearchButtonClicked,"composer_search_button_clicked",d),l&&t.trimLeadingText(/^search\b/i)},[d,t,l]),u=sr();s=s&&!u;const m=i.useMemo(()=>{const h={systemHint:se.Search,description:c.formatMessage({id:"m/oaZE",defaultMessage:"Find on the web"}),logo:"",requiredFeatures:["search"],requiredModels:[],requiredConversationModes:[Fe.PrimaryAssistant],name:c.formatMessage({id:"TbHx8d",defaultMessage:"Search"})};if(u){const x=Tc(c)[1];h.composerBarButtonInfo=x.composerBarButtonInfo}return h},[c,u]);return e.jsx(tg,{highlightTooltip:a,analyticsMetadata:d,isThreadUsingSearchMode:l,isDisabled:s||o,children:e.jsx(Ir,{highlightTooltip:a,isDisabled:s||o,isPinnedActive:o,systemHint:m,logo:e.jsx(nr,{className:"h-[18px] w-[18px]"}),composerController:t,analyticsMetadata:d,onClick:p,showLabel:r})})}function eg(){const t=Dr(),s=ro(),a=st(Ke.hasSeenComposerSearchButtonTooltip);return!a.isLoading&&a.eligible&&!t&&!s}function tg({children:t,highlightTooltip:s,analyticsMetadata:a,isThreadUsingSearchMode:o,isDisabled:n}){const r=eg()&&!o,l=st(Ke.hasSeenComposerSearchButtonTooltip);return r?e.jsx(ao,{announcementKey:Ke.hasSeenComposerSearchButtonTooltip,side:"right",show:!0,theme:"bright",dismissOnOutsideClick:!0,badge:"new",title:e.jsx(E,{id:"Yjduqi",defaultMessage:"Search the web"}),onDismiss:l.markAsViewed,sideOffset:0,className:"!max-w-2xs xs:!max-w-sm",description:e.jsx(E,{id:"W51Aei",defaultMessage:"Get fast answers with trusted sources. {learnMore}",values:{learnMore:e.jsx(kc,{href:"https://openai.com/index/introducing-chatgpt-search",className:"underline",children:e.jsx(E,{id:"stA7F4",defaultMessage:"Learn more"})})}}),children:e.jsx("div",{children:t})}):e.jsx("div",{children:e.jsx(Ft,{sideOffset:0,label:n?e.jsx(E,{id:"GpDAWD",defaultMessage:"Search is unavailable"}):e.jsx(E,{id:"c+4o2s",defaultMessage:"Search the web"}),side:"right",open:s||void 0,onOpenChange:c=>{c&&W.logEventWithStatsig(G.composerSearchButtonHovered,"composer_search_button_hovered",a)},children:t})})}function sg({composerController:t,clientThreadId:s}){const a=ls(s),o=ho(),{setThreadSystemHintMode:n,clearAllSystemHintModeTriggers:r}=Qs(),{value:l}=Oe("2800342425"),c=go(s).filter(j=>j.systemHint!==se.Think),[d,p]=i.useState([]),[u,m]=i.useState(void 0),[h,x]=i.useState(0);i.useEffect(()=>{p(u?c.filter(j=>j.name.toLocaleLowerCase().startsWith(u.text.toLocaleLowerCase())||j.systemHint.toLocaleLowerCase().startsWith(u.text.toLocaleLowerCase())):[])},[u]),i.useEffect(()=>{t.view.dispatch(zm(t.view.state.tr,{onHintMatch(j){m(M=>_a(M,j)?M:j)}}))},[t]);const g=!c.length||!d.length||!u;i.useEffect(()=>{g&&x(0)},[g]);const b=d.length,T=i.useCallback(j=>{x(M=>(j(M)%b+b)%b)},[b]),S=d[h],v=({hintToSave:j=S,expectPerfectMatch:M})=>{if(!u||!S||M&&j.name.toLowerCase()!==u.text.toLowerCase())return!1;W.logEvent(G.systemHintSelected,{system_hint:j.systemHint,conversation_id:a??zo});const k=u.range.from===1?j.name:u.text+j.name.slice(u.text.length),I={clientThreadId:s};return Es(t.view),o.size>0&&r(),j.systemHint===se.Search?(l&&Tr(se.Search,!0),n(se.Search,!0,I,Fs.CONVERSATION_COMPOSER_SLASH_SEARCH),u.range&&t.delete(u.range.from,u.range.to),t.removeSystemHints(),!0):c.filter(C=>C.composerBarButtonInfo).some(C=>C.systemHint===j.systemHint)?(n(j.systemHint,!0,I),u.range&&t.delete(u.range.from,u.range.to),t.removeSystemHints(),!0):(t.addSystemHint(j.systemHint,k,u.range.from,u.range.to),!0)},w=i.useRef(v);w.current=v;const _=i.useRef(T);_.current=T;const A=i.useRef(u);A.current=u;const B=t.view;return i.useEffect(()=>(g||Gm(B,j=>{if(j==="up")_.current(M=>M-1);else if(j==="down")_.current(M=>M+1);else if(j==="cancel")Es(B),Wm(B);else{if(j==="submit")return Es(B),w.current({expectPerfectMatch:!1});if(j==="checkMatch")return w.current({expectPerfectMatch:!0})}}),()=>Es(B)),[g,B]),i.useEffect(()=>{g||W.logEvent(G.systemHintListOpened,{conversation_id:a??zo})},[g]),g?null:e.jsx(Ai,{className:"max-w-60",onMouseDown:j=>{j.preventDefault()},children:d.map((j,M)=>e.jsx("div",{onMouseOver:()=>x(M),onClick:()=>{v({hintToSave:j,expectPerfectMatch:!1}),t.focus()},children:e.jsx(Ni,{autoFocus:!1,className:"rounded-lg px-1 py-2",$spoofHovered:M===h,children:e.jsx(Fr,{title:j.name,description:j.description,logo:j.logo})})},j.systemHint))})}function Fr({title:t,description:s,logo:a,checked:o}){return e.jsxs("div",{className:"group inline-flex w-full items-center justify-start gap-2 pl-1.5 pr-3",children:[e.jsx("div",{className:"flex h-7 w-7 items-center justify-center gap-2.5",children:e.jsx(qa,{svgString:a,className:"icon-lg text-token-text-secondary"})}),e.jsxs("div",{className:"shrink grow basis-0",children:[e.jsx("p",{className:"text-sm font-normal leading-tight text-token-text-primary",children:t}),!!s&&e.jsx("p",{className:"text-[13px] font-normal leading-[18px] text-token-text-secondary",children:s})]}),o&&e.jsx(Ei,{className:R("icon-md text-token-text-primary",{"group-hover:hidden":!o})})]})}function ng({composerController:t,clientThreadId:s}){return t instanceof po?e.jsx(sg,{composerController:t,clientThreadId:s}):null}function og({children:t,className:s,showBackground:a}){return e.jsxs("div",{className:"relative",children:[t,a&&e.jsx(ne.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:R("pointer-events-none absolute bottom-0 top-0 h-8 w-8 rounded-full",s)})]})}function ag({clientThreadId:t,uploadType:s,modelAcceptedMimeTypes:a,modelSupportedImageMimeTypes:o,attachmentsProductFeature:n,getInputProps:r,openFileDialog:l,onOauthRedirect:c,historyDisabled:d,isDisabled:p,highlightTooltip:u}){const m=_c(),{gdriveStatus:h,o365Status:x}=Ac(),g="h-[18px] w-[18px]",b=d?"text-white":u?"text-brand-blue-800":"",T=e.jsx(Nc,{ariaLabel:"",className:R(g,b)}),S=h!=="false"||x!=="false"||m;return e.jsx("div",{className:"relative",children:e.jsx(og,{showBackground:u,className:"bg-brand-blue-800/20",children:S?e.jsx(Ec,{clientThreadId:t,icon:T,modelAcceptedMimeTypes:a,modelSupportedImageMimeTypes:o,attachmentsProductFeature:n,onOauthRedirect:c,uploadType:s,openFileDialog:l,getInputProps:r,isDisabled:p,highlightTooltip:u}):e.jsx(Ic,{clientThreadId:t,uploadType:s,openFileDialog:l,getInputProps:r,icon:T,isDisabled:p,highlightTooltip:u})})})}function rg({suggestions:t,composerController:s,onSelect:a,onChange:o}){const n=en(),r=i.useCallback((u,m,h)=>{a?.(u,m,h),n(u,m,h)},[a,n]),[l,c]=i.useState(-1),[d,p]=i.useState(!1);return i.useEffect(()=>{const u=m=>{if(m.key==="ArrowDown"){const h=l===t.length-1?0:l+1;c(h),o?.(h,!0,t[h])}else if(m.key==="ArrowUp"){m.preventDefault();const h=l<=0?t.length-1:l-1;c(h),o?.(h,!0,t[h])}else m.key==="Enter"&&!m.shiftKey&&t[l]&&r(t[l],t,l)};return s.subscribe("keydown",u)},[t,l,o,r,s]),i.useEffect(()=>s.subscribe("blur",()=>{c(-1),o?.(-1,!1)}),[s,o]),i.useEffect(()=>{if(!d){const u=()=>{p(!0),window.removeEventListener("mousemove",u)};return window.addEventListener("mousemove",u),()=>{window.removeEventListener("mousemove",u)}}},[d]),i.useEffect(()=>{c(-1),o?.(-1,!1),p(!1)},[t,o]),e.jsx(ne.ul,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"hidden w-full flex-col p-2.5 group-focus-within:flex group-focus-within:max-lg:flex-col-reverse",children:t.map((u,m)=>e.jsxs(ne.li,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:m*.03},exit:{opacity:0,translateY:4},className:"w-full",children:[m>0&&e.jsx("div",{className:R("h-[1px] opacity-60 max-lg:hidden",l===m||l===m-1?"mx-2 bg-token-main-surface-secondary":"bg-token-border-light")}),e.jsxs("button",{className:R("flex w-full cursor-pointer items-center justify-start whitespace-pre-wrap rounded-lg px-2.5 py-3 text-start",l===m?"bg-token-main-surface-secondary":"bg-token-main-surface-primary"),onClick:h=>{h.preventDefault(),r(u,t,m)},onMouseDown:h=>{h.preventDefault()},onMouseEnter:()=>{d&&(c(m),o?.(m,!1,u))},onMouseLeave:()=>{c(-1),o?.(-1,!1,u)},children:[u.icon?e.jsx("span",{className:"mr-4 h-6 w-6 text-token-text-secondary",children:u.icon}):null,e.jsx("span",{className:"whitespace-pre-wrap",children:u.autocompletionChunks&&u.autocompletionChunks.length>0?e.jsx(e.Fragment,{children:u.autocompletionChunks.map((h,x)=>e.jsx("span",{className:R(h.isMatched?"text-token-text-tertiary":"text-token-text-primary"),children:h.text},x))}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:R(u.type===rs.Starter||u.type===rs.Trending?"text-token-text-secondary":"text-token-text-tertiary"),children:u.title}),e.jsx("span",{className:"text-token-text-primary",children:u.body})]})})]}),m>0&&e.jsx("div",{className:R("h-[1px] opacity-60 lg:hidden",l===m||l===m-1?"mx-2 bg-token-main-surface-secondary":"bg-token-border-light")})]},u.id??m))})}function ig(t,s){t=t.toLocaleLowerCase();const a=s;s=s.toLocaleLowerCase();const o=[];let n=0;for(let c=0;c<s.length&&(n<t.length&&t[n]===s[c]&&(o.push(c),n++),n!==t.length);c++);const r=[];let l=0;if(o.forEach(c=>{if(c>l){const d=a.slice(l,c);d&&r.push({text:d,isMatched:!1})}r.push({text:a[c],isMatched:!0}),l=c+1}),l<s.length){const c=a.slice(l);c&&r.push({text:c,isMatched:!1})}return lg(r)}function lg(t){if(t.length===0)return t;let s=[t[0]];for(let o=1;o<t.length;o++){const n=s[s.length-1],r=t[o];n.isMatched===r.isMatched?n.text+=r.text:s.push(r)}const a=s.filter(o=>o.isMatched).reduce((o,n)=>o+n.text.trim().length,0);return s.length<=4&&a>=2?s:[{text:s.map(o=>o.text).join(""),isMatched:!1}]}function cg(t){const{isUnauthenticated:s}=$e(),o=Dn(v=>v.files).length>0,n=t.composerController.useState(v=>!v.isEmpty()),r=!o&&!n,{browseMode:l}=Xs(),c=Aa(),d=Zs(),p=Ut(t.gizmoId),u=Dc(),m=dt(),{value:h}=Ve("2360528850"),x=m&&!h,{layer:g}=ct("415386882"),b=g.get("is_voice_mode_entry_point_enabled",!1);if(t.inputState==="disabled")return null;const T=!s||s&&b,S=e.jsx(dg,{state:t.state,onSubmit:t.onSubmit,disableReason:t.disableReason,isSearchMode:d,useProduceImpl:t.useProduceImpl});return T&&!c&&!p&&r&&t.state==="disabled"&&t.clientThreadId&&l!=="gizmo-editor"&&!x?e.jsx("div",{className:"min-w-8",children:u?e.jsx(Rc,{fallback:S}):e.jsx(Pc,{clientThreadId:t.clientThreadId,fallback:S})}):S}function dg({state:t,onSubmit:s,disableReason:a,isSearchMode:o,useProduceImpl:n}){const r=t==="streaming"?Bc:Hc,l=fe(),c=or(),d=a==="async_task_pending",p=e.jsx("button",{onClick:s,disabled:t==="disabled"||d,"aria-label":t==="streaming"?l.formatMessage(Rt.stopStreamingLabel):l.formatMessage(Rt.sendPromptLabel),"data-testid":t==="streaming"?"stop-button":"send-button",className:R("flex h-9 w-9 items-center justify-center rounded-full transition-colors hover:opacity-70 focus-visible:outline-none focus-visible:outline-black disabled:text-[#f4f4f4] disabled:hover:opacity-100 dark:focus-visible:outline-white disabled:dark:bg-token-text-quaternary dark:disabled:text-token-main-surface-secondary",n?"bg-green-600 text-white disabled:bg-green-600 disabled:bg-opacity-15 dark:bg-green-600 dark:text-white disabled:dark:bg-green-600 disabled:dark:bg-opacity-15":o?"bg-blue-1000 text-white dark:bg-blue-1000 dark:text-white":"bg-black text-white dark:bg-white dark:text-black",c&&"disabled:bg-black disabled:bg-opacity-[0.27]",!c&&"disabled:bg-[#D7D7D7]"),children:e.jsx(r,{className:R(t==="streaming"?"icon-lg":"icon-2xl")})});return a&&t==="disabled"||d?e.jsx(ug,{label:a==="file_upload_pending"?l.formatMessage(Rt.fileUploadPendingLabel):a==="empty_text_content"?l.formatMessage(Rt.emptyTextContentLabel):a==="async_task_pending"?l.formatMessage(Rt.asyncTaskInProgressLabel):l.formatMessage(Rt.textContentTooLongLabel),children:p}):p}function ug({label:t,children:s}){return e.jsx(Ft,{sideOffset:14,label:t,side:"top",children:s})}const Rt=Ze({stopStreamingLabel:{id:"+yfm/p",defaultMessage:"Stop streaming"},sendPromptLabel:{id:"xfIykB",defaultMessage:"Send prompt"},emptyTextContentLabel:{id:"LCVL2q",defaultMessage:"Message is empty"},textContentTooLongLabel:{id:"kDrqDJ",defaultMessage:"Message is too long"},fileUploadPendingLabel:{id:"Qv7jQN",defaultMessage:"File upload pending"},asyncTaskInProgressLabel:{id:"a959Km",defaultMessage:"Disabled"}}),mg=i.forwardRef(function({type:s,placeholder:a,replyRegions:o,state:n,renderFiles:r,leftSideActions:l,topRightAction:c,onSubmit:d,setIsComposerOverflowing:p,inputState:u,currentLeafId:m,composerController:h,clientThreadId:x,gizmoId:g,disableReason:b},T){const S=Xe(),v=Lc(),[w,_]=i.useState(void 0);let A=null;const{isLoading:B}=v;B||(A=v.modelId);const j=i.useRef(null),[M,k]=i.useState(300);i.useEffect(()=>{j.current&&k(j.current.offsetWidth)},[]),i.useEffect(()=>{B||Ii()||h.focus()},[A,h,B]);const{value:I}=Oe("3780975974"),F=C=>{Sg({target:C.target,rootId:"composer-background",additonalInteractiveIds:["reply-regions"]})||h.focus()};return e.jsxs("div",{id:"composer-background",ref:T,className:R("flex w-full cursor-text flex-col rounded-3xl border border-token-border-light px-3 py-1 shadow-[0_9px_9px_0px_rgba(0,0,0,0.01),_0_2px_5px_0px_rgba(0,0,0,0.06)] transition-colors contain-inline-size dark:border-none dark:shadow-none",S&&"backdrop-blur-2xl no-transparency:backdrop-blur-none",S&&s!=="temporary"&&"bg-token-composer-surface",!S&&s!=="temporary"&&"bg-main-surface-primary dark:bg-[#303030]",s==="temporary"&&"dark bg-black"),onClick:F,style:{viewTransitionName:"var(--vt-composer)"},children:[e.jsx(ds,{initial:!1,children:o.length>0&&e.jsx(ne.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0,transition:{duration:.06}},transition:{ease:"easeOut",duration:.1},id:"reply-regions",children:e.jsx(gg,{replyRegions:o})})}),e.jsxs(e.Fragment,{children:[r,e.jsxs("div",{className:"flex min-h-[44px] items-start pl-1",children:[e.jsxs("div",{className:"min-w-0 max-w-full flex-1",ref:j,children:[!1,e.jsx("div",{className:w?"hidden":"",children:h instanceof ar?e.jsx(hg,{composerController:h,currentLeafId:m,placeholder:a,inputState:u}):e.jsx(qm,{composerController:h,placeholder:a})})]}),e.jsx("div",{className:"w-[32px] pt-1",children:c})]}),e.jsxs("div",{className:"mb-2 mt-1 flex items-center justify-between sm:mt-5",ref:C=>{if(!I||!("ResizeObserver"in window))return;let f=new AbortController,P=window.innerWidth;const H=Fc({axis:"width",debounce:!0,target:C,onChange:()=>{if(!C)return;C.scrollWidth>C.clientWidth?p?.(!0):Math.abs(P-window.innerWidth)>40&&(p?.(!1),P=window.innerWidth)}});return()=>{H?.(),f.abort()}},children:[e.jsx("div",{className:"flex gap-x-1.5 text-token-text-primary",children:l}),e.jsxs("div",{className:"flex gap-x-1.5",children:[!1,e.jsx("div",{children:e.jsx(cg,{inputState:u,state:n,onSubmit:d,composerController:h,clientThreadId:x,gizmoId:g,disableReason:b})})]})]})]})]})});function hg({composerController:t,currentLeafId:s,placeholder:a,inputState:o}){const n=i.useContext(Ri);return e.jsxs(e.Fragment,{children:[e.jsx(Oc,{id:Mm,autoFocus:!0,tabIndex:0,"data-id":s,dir:"auto",ref:r=>{if(!(t instanceof ar))throw new Error("Expected TextAreaComposerController");r!=null&&(t.textArea=r,t.logPageMount())},rows:1,placeholder:a,disabled:o!=="default",className:R("m-0 resize-none border-0 bg-transparent px-0 text-token-text-primary focus:ring-0 focus-visible:ring-0",o==="disabled"&&"text-center",["max-h-[25dvh]","max-h-52"])}),e.jsx("script",{nonce:n.cspScriptNonce,suppressHydrationWarning:!0,children:"requestAnimationFrame((function(){window.__oai_logTTI?window.__oai_logTTI():window.__oai_SSR_TTI=window.__oai_SSR_TTI??Date.now()}))"})]})}function gg({replyRegions:t}){return e.jsx("div",{className:"flex cursor-auto flex-col divide-y divide-token-border-light overflow-hidden rounded-b-lg rounded-t-[20px] bg-token-main-surface-primary",children:t.map((s,a)=>{switch(s.type){case"text":return e.jsx(pg,{value:s.value,onRemoveRegion:s.onRemoveRegion},a);case"object":return e.jsx(fg,{value:s.value,onRemoveRegion:s.onRemoveRegion},a);case"mention":case"system_hint":return e.jsx(xg,{value:s.value,icon:s.icon,onRemoveRegion:s.onRemoveRegion},a)}})})}function pg({value:t,onRemoveRegion:s}){return e.jsxs(jo,{className:"text-token-text-secondary",children:[e.jsx(Co,{children:e.jsx(rr,{className:"icon-lg-heavy"})}),e.jsx(wo,{children:`“${t}”`}),e.jsx(yo,{onClick:s})]})}function fg({value:t,onRemoveRegion:s}){return e.jsxs(jo,{className:"text-blue-selection",children:[e.jsx(Co,{children:e.jsx(rr,{className:"icon-lg-heavy"})}),e.jsx(wo,{className:"font-semibold",children:t}),e.jsx(yo,{onClick:s})]})}function xg({value:t,icon:s,onRemoveRegion:a}){return e.jsxs(jo,{children:[e.jsx(Co,{className:"mt-0",children:s}),e.jsx(wo,{className:"font-semibold text-token-text-primary",children:t}),e.jsx(yo,{onClick:a})]})}function yo({onClick:t}){return e.jsx("button",{onClick:t,type:"button",className:"flex-shrink-0 text-token-text-secondary",children:e.jsx(Uc,{className:"icon-lg"})})}const jo=je.div`flex items-start py-2.5 gap-3 pl-3 pr-1.5 text-sm`,Co=je.span`flex-shrink-0 mt-0.5 w-7 h-6 flex justify-center items-center`,wo=je.span`flex-1 line-clamp-3 py-0.5`;function Sg({target:t,rootId:s,additonalInteractiveIds:a}){let o=t;for(;o&&o!=null;){if(o.tagName==="BUTTON"||o.tagName==="INPUT"||o.tagName==="TEXTAREA"||o.isContentEditable||a.includes(o.id))return!0;if(o.id===s)return!1;o=o.parentElement}return!1}const vg=({composerController:t,disabled:s,clientThreadId:a})=>{const o=Zs(),n=ho(),{setThreadSystemHintMode:r,clearAllSystemHintModeTriggers:l}=Qs(),c=go(a).filter(v=>!v.composerBarButtonInfo&&v.systemHint!==se.Search),d=t.useState(v=>v.getSystemHints()[0]),p=o?se.Search:n.size===1?n.values().next().value:d,{value:u}=Oe("3780975974"),[m,h]=i.useState(!1);if(i.useEffect(()=>{const v=Math.random(),w=setInterval(()=>{const _=new Date,A=_.getHours()+_.getMinutes()/60+_.getSeconds()/3600,B=Math.abs((6+A)%12-6)/6;h(Math.pow(B,15)>v)},1e3);return()=>clearInterval(w)},[]),!(t instanceof po)||c.length===0)return null;const x=t,g={clientThreadId:a};function b(){W.logEventWithStatsig(G.composerSystemHintButtonHovered,"composer_system_hint_button_hovered",g)}function T(){W.logEventWithStatsig(G.composerSystemHintButtonClicked,"composer_system_hint_button_clicked",g)}function S(v,w){if(l(),v.systemHint===se.Search){r(se.Search,w,g,Fs.CONVERSATION_COMPOSER_TOOL_MENU),x.removeSystemHints(),setTimeout(()=>{x.focus()},0);return}const _=c.filter(A=>A.composerBarButtonInfo);if(_.some(A=>A.systemHint===v.systemHint)){r(v.systemHint,w,g),x.removeSystemHints(),setTimeout(()=>{x.focus()},0);return}w?(o&&r(se.Search,!1,g,Fs.CONVERSATION_COMPOSER_TOOL_MENU),n.forEach(A=>{_.some(B=>B.systemHint===A)&&r(A,!1,g)}),x.addSystemHint(v.systemHint,v.name),setTimeout(()=>{x.focus()},0)):x.removeSystemHints()}return e.jsx(bg,{systemHints:c,selectedHint:p,showJack:u?!1:m,disabled:s,onHover:b,onOpen:T,onSelect:S})},bg=({systemHints:t,selectedHint:s,showJack:a,disabled:o,onHover:n,onOpen:r,onSelect:l})=>{const c=fe(),[d,p]=i.useState(!1),u=t.find(h=>h.systemHint==="contextual_answers")?.name,{value:m}=Oe("3780975974");return e.jsxs(Q.Root,{open:d,onOpenChange:h=>{p(h),h&&r?.()},children:[e.jsx(yg,{disabled:!!o,contextualAnswersHintNameIfPresent:u,children:e.jsx(Kn,{className:R(tr.toolsButton,"flex h-9 min-w-9 items-center justify-center rounded-full border border-token-border-light p-1 text-xs font-semibold text-token-text-secondary focus-visible:outline-black disabled:opacity-30 radix-state-open:bg-black/10 can-hover:hover:bg-token-main-surface-secondary dark:focus-visible:outline-white dark:can-hover:hover:bg-gray-700"),"data-opened":aa(d),"data-jack":aa(!!a),"aria-label":c.formatMessage({id:"oDAnGy",defaultMessage:"Use a tool"}),disabled:o,onPointerOver:n,onClick:h=>{h.preventDefault()},onFocusCapture:h=>{h.stopPropagation()},children:m?e.jsx(zc,{className:"pointer-events-none h-5 w-5"}):e.jsx(Gc,{className:"pointer-events-none h-5 w-5"})})}),e.jsx(Q.Portal,{children:e.jsx(Q.Content,{alignOffset:-16,onCloseAutoFocus:h=>{h.preventDefault()},children:t.map(h=>e.jsx(Q.Item,{className:"px-1 py-2",onClick:()=>l?.(h,h.systemHint!==s),children:e.jsx(Fr,{title:h.name,description:h.description,logo:h.logo,checked:h.systemHint===s})},h.systemHint))})})]})},yg=({disabled:t,children:s,contextualAnswersHintNameIfPresent:a})=>{const o=st(Ke.hasSeenComposerSystemHintButtonTooltip),n=st(Ke.hasSeenCaSystemHint),r=!t&&!o.isLoading&&o.eligible,l=!t&&!o.isLoading&&a&&!n.isLoading&&n.eligible,c=r?{announcementKey:Ke.hasSeenComposerSystemHintButtonTooltip,title:e.jsx(E,{id:"tTydhk",defaultMessage:"All your tools, in one handy place"}),onDismiss:o.markAsViewed,description:e.jsx(E,{id:"S+BFNe",defaultMessage:"Create a canvas, generate a picture, and more."})}:l?{announcementKey:Ke.hasSeenCaSystemHint,title:e.jsx(E,{id:"uaC1JM",defaultMessage:"Not finding internal information?"}),onDismiss:n.markAsViewed,description:e.jsx(E,{id:"TL/S+W",defaultMessage:"If ChatGPT didn't search your files automatically, type {hintName} or select it from the menu.",values:{hintName:e.jsx("span",{className:"whitespace-nowrap font-bold",children:'"/'+a+'"'})}})}:void 0;return c?e.jsx(ao,{show:!0,side:"bottom",theme:"bright",dismissOnOutsideClick:!0,badge:"new",sideOffset:0,className:"!max-w-2xs xs:!max-w-sm",...c,children:s}):e.jsx(Ft,{side:"right",sideOffset:0,label:t?e.jsx(E,{id:"uw9x80",defaultMessage:"Tools unavailable"}):e.jsx(E,{id:"mrYNGk",defaultMessage:"View tools"}),children:s})};function aa(t){return t?"":null}const jg=1,Cg=3e3;function wg({files:t,className:s}){const a=Jn(),o=ir(),n=_d();return e.jsxs("div",{className:s,children:[n.map(r=>e.jsx(Ad,{textdocId:r.tempTextdocId,userCreatedTextdoc:r},r.tempTextdocId)),t.map(r=>e.jsx(Nd,{borderRadius:"2xl",useV2Style:!0,width:a?"normal":"wide",onRemoveFileClick:()=>Hs.remove(o,r.tempId,"none"),file:r.file,fileId:r.fileId??void 0,contextConnectorInfo:r.contextConnectorInfo,loadingPercentage:r.status===Ed.Uploading?r.progress:void 0},r.tempId))]})}function Mg({onAbortCompletion:t,onCreateNewCompletion:s,onContinueGenerating:a,currentModelId:o,clientThreadId:n,isNewThread:r,isCompletionInProgress:l,className:c,disabled:d=!1,disabledReason:p,canPause:u=!1,canContinue:m=!1,suggestions:h,isInteractableSharedThread:x,composerContainerRef:g,autocompletions:b,requiresFileUpload:T,onComposerInput:S,onComposerChange:v,onAutocompleteSelect:w,headerClassName:_,hideHeader:A,setComposerBarElement:B,onTaggingDropdownOpen:j,onTaggingDropdownClose:M}){Ue.markStart("PromptTextarea"),Ue.markRendered("PromptTextarea");const k=i.useRef(null),I=Id(k,B),{data:F}=Vs(),{data:C}=ut(),f=tn(),P=co(),H=Pi(F),V=H?.isFree(),{isUnauthenticated:q}=$e(),N=fe(),U=Na(),D=ir(),[K,Y,de]=ce(n,y=>[J.getCurrentLeafId(y),J.getRequestId(y),y?.overrideModelId]),[ge]=Oa(),Z=Ks(),{gizmoEditorData:Ae,mode:Ne,getGizmoId:Ee}=Wc(),Ce=Ea(),we=Di(),O=dt(),L=lr(),X=ls(n),ue=!!Bi(),re=!!Hi(),ie=!!Yn(),[Ie,Re]=i.useState({}),{setThreadSystemHintMode:He,clearSystemHintModeTrigger:me,getSystemHintModeTrigger:oe}=Qs(),he=Mr(),xe=he.has(se.Search),[Me,Ct]=i.useState(!1),[nt,ot]=i.useState(!1),wt=Xe(),ve=i.useRef(!1),le=null,ae=zs(C?.models,o);let ee=Ys(n),et=ee&&"gizmo"in ee?ee.gizmo:void 0;const zt=Ut(et?.gizmo.id),sn=Nh(),us=qc(),ms=to(et?.gizmo.id),[Te,pe]=i.useState(null);Te!==null&&(ee={gizmo:Te,gizmo_id:Te.gizmo.id,kind:Fe.GizmoInteraction},et=Te);const Mt=Yo(ae,ee);let Tt=!1;Vc(ee)&&et?.gizmo.id===$c&&(Tt=!0);const Gt=Li(),hs=!d&&!Tt&&Mt!==Jo.None&&!q,at=Kc(ae,ee),mt=Yc(ae,ee);let Pe=Dn(y=>y.files);const[Wt]=i.useState(()=>Jc());Ne==="magic"?Pe=Pe.filter(y=>y.gizmoId!=null):Pe=Pe.filter(y=>y.gizmoId==null);const gs=Xc(),ht=Pe.length>0||gs,qt=Dn(Rd.hasUploadInProgress),nn=Qc(n),Vt=f.useState(y=>{const te=Tm(y);return typeof ae?.maxTokens=="number"&&te>ae.maxTokens}),$t=f.useState(y=>!y.isEmpty()),kt=!Vt&&!qt&&($t||ht);cr(Pe.length>0||qt||$t);const ps=(Mt===Jo.Multimodal?Zc:ed)-Pe.length,fs=ps<=0,We=kt&&!d&&!l&&!ie,[Kt,on]=i.useState(!1),gt=o??dr(F,C).id,Yt=zs(C?.models,gt),_t=Xo(Yt,Go.Search),{userIsInSearchHoldoutWithWebDisabled:Jt}=kr(),rt=!d&&!et&&Ce?.includes(Ds.SearchTool)&&!Ce?.includes(Ds.SearchToolHoldout)&&!Jt&&(Ce?.includes(Ds.BrowsingAvailable)||!H?.isEnterprisey()),pt=rt&&_t,{targetedContent:xs,setTargetedContent:At}=ur(),De=xs?.isFocusedViewContent&&!L?void 0:xs,{rebaseSystemMessageContent:Xt}=uo(),ft=go(n),an=ft.length>0,Qt=ee?.kind===Fe.PrimaryAssistant||ee?.kind===Fe.GizmoInteraction&&zt,rn=ft.find(y=>y.systemHint===se.Think),ln=sr(),{value:cn}=Oe("3780975974"),{value:dn}=Oe("759329447"),un=cn&&rn&&le==null&&ee?.kind===Fe.PrimaryAssistant&&dn,xt=an&&Qt,[Ss,mn]=i.useState(!1),hn=!V&&xt;i.useEffect(()=>{if(!P?.id)return;const y=ta.getAndReset(P?.id,X);y&&f.setText(y.inputText)},[P?.id,X,f]),i.useEffect(()=>{const y=ge.get("prompt")??"";f.getCurrentText().length===0&&y.length>0&&f.setText(y)},[f,ge]),i.useEffect(()=>{Kt!==We&&(on(We),We&&Fi(!0).then(y=>{td.startEnforcement(y),Oi.startEnforcement(y)}))},[We,Kt,ee?.kind,Ce]);const Zt=sd(ae,ee),{handleFileAccepted:gn}=nd(N,Yo(ae,ee),at,"mouse",Ee,Zt?.attachments),{getInputProps:pn,open:z}=od({disabled:d||!hs||fs,noClick:!0,onDropAccepted:gn,onDropRejected:y=>ad(y,N,U,Mt),multiple:!0,maxSize:rd,maxFiles:ps,...id(mt)}),Se=Ui(Wt),{value:St}=Oe("1988730211"),Nt=i.useCallback(()=>{f.eraseContent(),Se.clearMessages(),f.resize(jg),f.usedDictation=!1,Os(n,y=>{y.overrideModelId=void 0}),ld();for(const y of Pe)Hs.remove(D,y.tempId,"none");cd.markAllAsSent()},[f,Se,Pe,D,n]),vs=async(y,te)=>{if(y?.preventDefault(),d||!kt&&!te||!ee||Be(n)?.isLoading!==!1)return;Ct(!0),sn?.(),us?.();const be=f.getContentToSend(),ke=_m(be.content),qe=new Pd(Wa.CompletionRequest,{expectedTimingLogs:[{name:"prompt_submitted",expectedInMs:3e3}]}),{content:vn,attachments:ws}=Dd(D,ke,ae,ee),Do=[],bn=[];Xt&&bn.push(Wi(Xt));const yn={...ee};"gizmo"in yn&&delete yn.gizmo;let Ms=f.getSystemHints();he.size>0&&(Ms=Array.from(he));const Bo=oe(se.Search),Si=xe?Bo??Fs.CONVERSATION_COMPOSER_WEB_ICON:void 0,Ho=Bd(),Lo=Hd(),vi=f.usedDictation;let tt={content:vn,eventMetadata:{eventSource:y?"mouse":"keyboard"},completionMetadata:{suggestions:h,conversationMode:yn,systemHints:Ms,searchSource:Si},messageMetadata:{...ws.length>0&&{attachments:ws},...Te&&{gizmo_id:Te?.gizmo.id},...Ie,...Ms.length>0&&{system_hints:Ms},...!!be.metadata&&{serialization_metadata:be.metadata},...Ho.length>0&&{canvas:{user_created_textdocs:Ho.map(it=>({user_created_temp_textdoc_id:it.tempTextdocId,type:it.type,title:it.title,content:it.content,create_source:it.create_source}))}},...Object.keys(Lo).length>0&&{__internal:{search_settings:Lo}},dictation:vi},prependMessages:Do.length>0?Do:void 0,appendMessages:bn.length>0?bn:void 0,profiler:qe,requestedModelId:de};if(tt=Ld(tt),St&&tt.completionMetadata.systemHints){let it=!1;tt.completionMetadata.systemHints=tt.completionMetadata.systemHints.filter(bi=>bi===se.Search?(it=!0,!1):!0),it&&(tt.extraStreamParams={forceUseSearch:!0})}De?.createNewCompletionParams&&(tt=await De.createNewCompletionParams(tt)),qe.logTiming("request_params_ready"),await s(tt),De?.onCreateCompletion?.({serverThreadId:X,currentLeafId:K}),De?.shouldPersistAcrossMessages!==!0&&At(void 0),Gs.hideThreadHeader(),Nt(),Ct(!1),qe.logTiming("prompt_submitted"),h!==void 0&&(ye.logEvent("chatgpt_prompt_ignore_suggestions"),W.logEvent(G.promptIgnoreSuggestions)),xe&&Bo&&me(se.Search)},qr=i.useRef(vs);i.useEffect(()=>{qr.current=vs});const Vr=y=>{At(y.targetedReply),y.targetedReply&&(f.focus(),W.logEvent(G.targetedReplyButtonClicked,{conversationId:X,sourceMessageId:y.messageId}))},To=i.useCallback(()=>{De?.onCleared?.({serverThreadId:X,currentLeafId:K}),At(void 0),f.focus()},[K,X,De,At,f]),ko={Enter:{validator:y=>{const te=y.isComposing||y.keyCode===229;return!(nt&&ve.current)&&(y.metaKey||(we||qi)&&!y.shiftKey&&!te)},handler:y=>{if(!We){Vt&&U.danger("The message you submitted was too long, please submit something shorter.",{hasCloseButton:!0});return}y.preventDefault(),vs()}},Escape:{validator:y=>!y.isComposing,handler:y=>{u&&l&&(t("",Y),W.logEvent(G.pauseCompletion,{threadId:Ye(n),currentLeafId:J.getMessageId(Be(n)),eventSource:"keyboard"})),y.target.value===""&&To()}}},es=i.useRef(ko);es.current=ko;const bs=dd(Yt?.tags,ee?.kind),[fn,ys]=i.useState(!1),[xn,_o]=i.useState(!1),ts=bs&&fn&&!zt,Ao=f.isReady();i.useEffect(()=>f.subscribe("keydown",y=>{f.acceptLegacyKeydown()&&es.current[y.key]?.validator(y)&&es.current[y.key].handler(y);const be=f.getCurrentText();if(y.key==="@"){const ke=f.getSelectionStart(),qe=be.substring(0,ke);(!qe||/\s$/.test(qe)||ke===0)&&setTimeout(()=>ys(!0),10)}else fn&&ys(!1);if(y.key==="Escape"&&(pe(null),ot(!1)),pt&&!xe){let ke;y.key==="Backspace"?ke=be.substring(0,be.length-1):ke=be+y.key,/^search\s?$/i.test(ke)?_o(!0):xn&&_o(!1)}xe&&y.key==="Escape"&&He(se.Search,!1,{clientThreadId:n})}),[f,Ao,fn,xn,pt,he,xe,He,n]),i.useEffect(()=>{const y=Object.fromEntries(Object.keys(es.current).map(te=>[te,ke=>{const qe=es.current[te];if(!qe||f.acceptLegacyKeydown())return!1;const{validator:vn,handler:ws}=qe;return vn(ke)?(ws(ke),!0):!1}]));f.registerKeyHandlers(y)},[f,Ao]),i.useEffect(()=>f.subscribe("paste",y=>{ud({filePickerStore:D,event:y,intl:N,toaster:U,clientThreadId:n,conversationMode:ee,currentModelConfig:ae,getEditorGizmoId:Ee,modelSupportedImageMimeTypes:at})}),[N,n,ee,ae,Ee,at,f,U,D]);const $r=y=>{ue||pe(y),f.trimLeadingText("@"),Fn(),ys(!1)},Kr=md(n,Wt,at,Zt?.attachments),Yr=i.useCallback(y=>{y?.preventDefault(),t("",Y),W.logEvent(G.pauseCompletion,{threadId:Ye(n),currentLeafId:J.getMessageId(Be(n)),eventSource:"mouse"}),Fn()},[t,n,Y]),No=i.useCallback(()=>{ta.set(P?.id,X,f.getCurrentText())},[X,P?.id,f]);i.useEffect(()=>{Ae||!Me&&!zi()&&f.focus()},[Me,f]),i.useEffect(()=>{if(at.length>0)for(const te of Pe)km(te.fileSpec?.mimeType,mt)||Hs.remove(D,te.tempId,"none");else Hs.reset(D)},[o,D]),i.useEffect(()=>{(!bs&&Te||ue)&&pe(null)},[bs,Te,ue]);const{layer:Jr}=ct("4031588851"),{layer:Eo}=ct("3637408529"),Xr=Eo.get("is_in_composer_text_exp",!1),Qr=Eo.get("composer_text","MESSAGE_CHATGPT"),Zr=Jr.get("composer_text","MESSAGE_CHATGPT"),ei=Xr?Qr:Zr,[js,ti]=(()=>{switch(p){case"workspaceDisallowsGizmo":return[Le.disallowedByWorkspacePlaceholder,!0];case"feedbackRequired":return[Le.disabledFeedbackPlaceholder,!0];case"noModelsAvailable":return[Le.noModelsAvailablePlaceholder,!0];case"requiresPluginsToBeInstalled":return[Le.requiresPluginsToBeInstalled,!0];case"loadingPlugins":return[Le.loading,!0];case"noTestGizmoId":return[Le.noTestGizmoId,!0];default:{if(x)return[Le.placeholderWithName,!1];if(De?.placeholderTextOverride!=null)return[De.placeholderTextOverride,!1];switch(ei){case"BLANK":return[null,!1];case"ASK_ANYTHING":return[Le.placeholderAskAnythingVariant,!1];case"ASK_CHATGPT_ANYTHING":return[Le.placeholderAskNameAnythingVariant,!1];default:return[Le.placeholderWithName,!1]}}}})(),si=zt?r?N.formatMessage(Rn.newChatInProject):js?N.formatMessage(js,{name:"ChatGPT"}):"​":js?N.formatMessage(js,{name:Ae!=null?Ne==="magic"?hd:Ae.name||"GPT":et?.gizmo.display.name??"ChatGPT"}):"​";i.useEffect(()=>f.subscribe("input",()=>{Xs.getState().isThreadHeaderVisible&&Gs.hideThreadHeader(),ot(!0)}),[f]),i.useEffect(()=>{if(S)return f.subscribe("input",()=>{S?.()})},[f,S]),i.useEffect(()=>{if(v)return f.subscribe("change",()=>{v?.()})},[f,v]),i.useEffect(()=>f.subscribe("focus",()=>{ot(!0)}),[f]);const Io=(cn||ln)&&!Ss,ni={clientThreadId:n,uploadType:Mt,modelAcceptedMimeTypes:mt,modelSupportedImageMimeTypes:at,attachmentsProductFeature:Zt?.attachments,getInputProps:pn,openFileDialog:z,historyDisabled:O,onOauthRedirect:No,highlightTooltip:T&&!ht},Et=[],oi=!d&&!fs&&(hs||Gt!=null)&&!xe;Et.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-attach-file-action)"},children:e.jsx(ag,{...ni,isDisabled:!oi})},"file-upload-button")),rt&&Et.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-search-action)"},children:e.jsx(Zh,{composerController:f,highlightTooltip:xn,clientThreadId:n,isDisabled:!pt||ht,showLabel:Io})},"search-button")),ft.forEach(y=>{const te=y.systemHint===se.Think;if(te&&!un||y.systemHint===se.Search&&rt)return;const ke=te&&re;if(y.composerBarButtonInfo){const qe=ae?.tags.includes("reasoning")||ae?.id.includes("o1")||ae?.id.includes("o3");Et.push(e.jsx("div",{style:{viewTransitionName:`var(--vt-composer-${y.systemHint}-action)`},children:e.jsx(mh,{composerController:f,systemHint:y,composerBarButtonInfo:y.composerBarButtonInfo,clientThreadId:n,isDisabled:!xt||ke,isPinnedActive:qe&&te,showLabel:Io,currentModelName:ae?.title??""})},`system-hint-${y.systemHint}`))}}),ms&&Et.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-system-model-selector)"},children:e.jsx(Jh,{clientThreadId:n})},"model-selector-button")),hn&&!ln&&Et.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-system-hint-action)"},children:e.jsx(vg,{composerController:f,clientThreadId:n,disabled:!xt})},"system-hint-button"));const ai=ht&&e.jsxs(e.Fragment,{children:[Ne==="magic"&&e.jsx("div",{className:"m-2 mb-0 rounded-lg bg-token-main-surface-secondary p-2 text-xs text-token-text-secondary",children:e.jsx(E,{...Le.gizmoKnowledgeWarning})}),e.jsx(wg,{files:Pe,className:"flex flex-nowrap gap-2 overflow-x-auto p-1.5"})]}),ri=ti?"disabled":"default",ii=l&&u,li=Gi(),ci=!We||Me||li,di=Am(qt,$t,Vt,nn),Cs=ii?"streaming":ci?"disabled":"idle",ss=i.useRef(null),It=i.useRef(null),ui=o&&(o.startsWith("o1")||o.startsWith("o3"));i.useEffect(()=>{const y=()=>{ss.current!=null&&Nn.addAction("composer_state_disabled",{threadId:Ye(n),disabledReason:ss.current})};if(kt&&Cs==="disabled"){let te="unknown";d?te=p??"component_disabled_unknown":l?te="completion_in_progress":ie?te="thread_hard_blocked":Me&&(te="starting_new_completion_request"),ss.current!==te&&(It.current&&clearTimeout(It.current),It.current=setTimeout(y,Cg)),ss.current=te}else ss.current=null;return()=>{It.current&&(clearTimeout(It.current),It.current=null)}},[n,kt,Cs,d,p,l,ie,Me]);const Sn=[];if(De?.label&&Sn.push({type:De.type,value:De.label,onRemoveRegion:To}),Te!==null){const y=!!Te.gizmo.tags?.includes(oo.FirstParty);Sn.push({type:"mention",value:Te.gizmo.display.name,icon:e.jsx(gd,{isFirstParty:y,src:Te.gizmo.display.profile_picture_url,className:"icon-md"}),onRemoveRegion:()=>{pe(null),f.focus()}})}i.useEffect(()=>{(!b||b.length===0||!nt)&&(ve.current=!1)},[b,nt]);const mi=(y,te,be)=>{ve.current=y>=0,te&&f.setText(be?`${be.title}${be.body}`:"")},Ro=nt&&b&&b.length>0&&!ts&&!f.hasMultipleLines()&&f.canShowAutocompletion();i.useEffect(()=>{ts?j?.():M?.()},[ts,j,M]);const Po=Cs==="streaming"?Yr:vs,hi=Xo(Yt,Go.Canvas),{value:gi}=Oe("61299031"),pi=Jn(),fi=pd(),xi=hi&&gi&&!fi&&!gs&&!pi;return i.useEffect(()=>{},[le,f]),e.jsxs(fd.Provider,{value:Wt,children:[e.jsx(xd,{onOauthRedirect:No,children:e.jsx("form",{className:c,onSubmit:Po,children:e.jsxs("div",{className:"relative flex h-full max-w-full flex-1 flex-col",children:[!A&&!wt&&e.jsx(Br,{className:_}),e.jsxs("div",{ref:g,className:"group relative flex w-full items-center",style:{"--force-hide-label":Ss?"none":"block"},children:[r&&ge.has("from_template_row")&&e.jsx("button",{type:"button",onClick:()=>{Z("/")},className:"mr-2 flex h-8 w-8 items-center justify-center text-token-text-tertiary hover:text-token-text-secondary",children:e.jsx(Sd,{className:"icon-lg"})}),e.jsxs(vd,{open:ts||xt||ms,children:[e.jsx(bd,{className:"w-full",children:e.jsx(mg,{type:O?"temporary":"default",ref:I,replyRegions:Sn,placeholder:si,inputState:ri,setIsComposerOverflowing:mn,composerController:f,leftSideActions:Et,topRightAction:xi&&e.jsx(yd,{composerRef:k,composerController:f,clientThreadId:n}),state:Cs,onSubmit:Po,renderFiles:ai,currentLeafId:K,clientThreadId:n,gizmoId:et?.gizmo.id,disableReason:di,modelId:gt})}),e.jsx(jd,{children:e.jsxs(Cd,{side:"bottom",align:"start",sideOffset:12,children:[ts&&e.jsx(wd,{onClick:y=>$r(y),onClose:()=>{ys(!1),f.focus()}}),xt&&e.jsx(ng,{composerController:f,clientThreadId:n})]})})]}),Ro&&e.jsx("div",{className:"absolute left-0 z-10 box-border w-full bg-token-main-surface-primary pl-0 max-lg:bottom-full lg:top-full",children:e.jsx(rg,{suggestions:b,composerController:f,onSelect:w,onChange:mi})})]}),e.jsx(Md,{composerController:f,parsedDocumentHandler:Kr})]})})}),e.jsx(zh,{canUseInlineTagging:bs,isDisabled:d,clientThreadId:n,currentLeafId:K,currentRequestId:Y,canContinue:m,composerController:f,setPromptInputMetadata:Re,suggestions:h,isNewThread:r,onCreateNewCompletion:s,onContinueGenerating:a,onResetState:Nt,conversationMode:ee,isShowingAutocomplete:!!Ro}),ee!=null&&!ui&&Td.includes(ee.kind)&&e.jsx(kd,{clientThreadId:n,onTargetedReply:Vr})]})}function Tg(t,s){const a=s==null&&t.message?.author.role===Je.User&&t.message.status==="in_progress",o=t.metadata?.err!=null&&t.metadata?.errCode!==qo.ContentPolicy,n=t.metadata?.errCode===qo.ModelIncompatibility;return t.metadata?.canRetry===!1||n?!1:a||o}function kg(t){return e.jsx(_r,{clientThreadId:t.clientThreadId,children:e.jsx(_g,{...t})})}function _g({clientThreadId:t,isNewThread:s,currentModelId:a,showPromptStarters:o,noWrap:n,onRequestCompletion:r,composerContainerRef:l}){const d=tn(),p=Vn(),u=Qn(),m=ce(t,x=>Tg(J.getCurrentNode(x),null));if(hr(d),!u&&m)return e.jsx(Ag,{clientThreadId:t});const h=e.jsx(e.Fragment,{children:e.jsx(Or,{composerContainerRef:l,clientThreadId:t,currentModelId:a,isNewThread:s,showPromptStarters:o,onRequestCompletion:r})});return n?h:e.jsxs(e.Fragment,{children:[e.jsx(dh,{clientThreadId:t}),e.jsx(mo,{clientThreadId:t,isStaticSharedThread:p,verticalPadding:"none",horizontalPadding:"standard",children:e.jsx(Ws,{children:h})})]})}function Ag({clientThreadId:t}){const s=Wd(t),a=ce(t,r=>J.getCurrentNode(r).metadata?.errCode===qd),o=Vd(r=>r.isoDate),n=$n(t);return a&&o!=null&&o!==""?null:e.jsxs("div",{children:[e.jsx("div",{className:"mb-3 text-center text-xs","data-has-thread-error":!0,children:e.jsx(E,{...ra.errorGeneratingResponse})}),e.jsx("div",{className:"flex items-center md:mb-4",children:e.jsx(Ot,{as:"button",color:"primary",onClick:()=>{ye.logEvent("chatgpt_regenerate_due_to_error_button_clicked",void 0,ns({clientThreadId:t})),s({id:n,eventMetadata:{eventSource:"mouse"},conversationMode:Be(t)?.mode})},className:"m-auto",icon:Ka,"data-testid":"regenerate-thread-error-button",children:e.jsx(E,{...ra.regenerateResponse})})})]})}function Or({clientThreadId:t,currentModelId:s,isNewThread:a,onRequestCompletion:o,showPromptStarters:n,composerContainerRef:r,autocompletions:l,requiresFileUpload:c,onComposerInput:d,onComposerChange:p,onAutocompleteSelect:u,headerClassName:m,hideHeader:h,onTaggingDropdownClose:x,onTaggingDropdownOpen:g}){const{data:b}=ut(),[T,S,v,w,_,A,B,j,M]=ce(t,oe=>{const he=J.getCurrentLeafId(oe);return[he,J.getRequestId(oe),oe?.isLoading,oe?.async_status===Ia.STREAMING,J.isMessageTurnEnded(oe),oe?.tree.getHasErrorFromNode(he)??!1,oe?.tree.isMessageIncomplete(he)??!1,oe?.mode,oe?.continuingFromSharedConversationId!=null]}),k=is(),I=Bn(),{isUnauthenticated:F}=$e(),C=yt(S),f=Vi({clientThreadId:t}),P=!F,H=$i(),{isOpen:V,onClose:q}=Fd({type:"just-hit-rate-limit"}),{value:N}=Oe("1988730211"),U=ho(),D=i.useCallback(oe=>{W.logEvent(G.continueCompletion);const he=Array.from(U),{systemHints:xe,extraStreamParams:Me}=N?Od(he):{systemHints:he,extraStreamParams:{}};o({type:Wo.Continue,promptId:oe,extraStreamParams:Me,eventMetadata:{eventSource:"mouse"},cancelActiveRequests:!1,completionMetadata:{conversationMode:Be(t)?.mode,systemHints:xe}})},[U,N,o,t]),K=Ua(),Y=i.useCallback(async(oe,he)=>Ud({clientThreadId:t,currentRequestId:he,isHistoryAndTrainingDisabled:H,queryClient:K}),[t,H,K]),ge=i.useCallback(async({content:oe,eventMetadata:he,extraStreamParams:xe,completionMetadata:Me,messageMetadata:Ct,prependMessages:nt,appendMessages:ot,profiler:wt,requestedModelId:ve})=>{let le;Os(t,ae=>{Ki.appendMessage(ae,Yi(oe,Ct,le))}),await o({type:Wo.Next,promptId:J.getCurrentLeafId(Be(t)),eventMetadata:he,cancelActiveRequests:!0,completionMetadata:Me,extraStreamParams:xe,prependMessages:nt,appendMessages:ot,profiler:wt,...ve?{requestedModelId:ve}:{}})},[t,o,null,k?.normalizedAccountUserId]),Z=!_&&(C||w),Ae=i.useMemo(()=>Z?!1:!A&&B,[A,B,Z]),Ne=Z,Ee=Qe(t),Ce=jt(Ee).data,{promptStarters:we,isSuccess:O}=mr(a&&!v,t,4),L=lo(),X=(()=>{if(L?.messageId===J.getTree(Be(t)).getLastValidNode(T)?.message?.id)return L?.suggestions;if(n&&!v&&O&&!P)return we})(),ue=Ji(),re=Ce?.gizmo.tags?.includes(oo.WorkspaceDisabled)&&!ue?"workspaceDisallowsGizmo":b?.models.size===0?"noModelsAvailable":I.displayingSideBySideFeedback&&I.unskippable?"feedbackRequired":j?.kind===Fe.GizmoTest&&j.gizmo_id==null?"noTestGizmoId":null,ie=Oe("15117983")?.value,Ie=pl(),Re=Xn(),He=Ie.action==="moderate",{value:me}=Ve("1860647109");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-center",children:Re&&He&&me?e.jsx(zd,{}):null}),V?e.jsx(Gd,{onClose:q}):null,ie&&j&&j.kind===Fe.PrimaryAssistant&&j.plugin_ids&&j.plugin_ids.length>0?e.jsx(Ng,{}):e.jsx(Mg,{composerContainerRef:r,clientThreadId:t,onCreateNewCompletion:ge,onAbortCompletion:Y,onContinueGenerating:D,currentModelId:s,isNewThread:a,isCompletionInProgress:f,className:"w-full",canContinue:Ae,suggestions:X??[],disabled:!!re,disabledReason:re??void 0,canPause:Ne,isInteractableSharedThread:M,autocompletions:l,requiresFileUpload:c,onComposerInput:d,onComposerChange:p,onAutocompleteSelect:u,headerClassName:m,hideHeader:h,onTaggingDropdownClose:x,onTaggingDropdownOpen:g},t)]})}function Ng(){return e.jsxs("div",{className:"mx-auto flex max-w-md flex-col items-center justify-center gap-2 rounded-xl border border-token-border-light bg-token-main-surface-primary p-6 shadow-lg",children:[e.jsx("span",{className:"text-token-text-primary",children:e.jsx(E,{id:"PluginsDecrepatedNotice.pluginsDeprecationTitle",defaultMessage:"Conversations with plugins are archived"})}),e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(E,{id:"PluginsDecrepatedNotice.pluginsDeprecationSubtitle",defaultMessage:"Explore GPT Store to find a replacement"})}),e.jsxs("a",{href:"https://chat.openai.com/gpts",className:"text-green-500 hover:cursor-pointer dark:text-green-400",children:[e.jsx(E,{id:"PluginsDecrepatedNotice.pluginsDeprecationGptStoreLink",defaultMessage:"Explore GPTs"}),e.jsx("span",{className:"ml-2",children:e.jsx(E,{id:"PluginsDecrepatedNotice.pluginsDeprecationGptStoreLinkArrow",defaultMessage:"→"})})]})]})}const ra=Ze({errorGeneratingResponse:{id:"PromptTextarea.errorGeneratingResponse",defaultMessage:"There was an error generating a response"},regenerateResponse:{id:"PromptTextarea.regenerateResponse",defaultMessage:"Regenerate"}}),Ur=i.memo(function(){return e.jsxs("div",{className:`mb-2 flex flex-col gap-2 empty:hidden ${er.PromptTextareaHeader}`,children:[e.jsx(Hr,{}),e.jsx(Lr,{})]})}),Ip=Object.freeze(Object.defineProperty({__proto__:null,ChatScreenComposerAlerts:Ur},Symbol.toStringTag,{value:"Module"})),ia=ze(()=>Ge(()=>import("./gygy8wqvfvqbj4sk.js"),__vite__mapDeps([47,2,4,1,3,5,34,9,10,43,48,49,16,18,19,20,21,22,23])).then(t=>t.SnorlaxSplashScreen)),Mn=4;function Eg(){const{layer:t}=Ls("4031588851"),s=t.get("autocomplete_qualified_start_date","2099-09-13T00:00:00Z"),a=co();return!!a&&a.created*1e3>=new Date(s).getTime()}const Tn=t=>`${t.title}${t.body}`.toLocaleLowerCase();function Ig(t){const s=Qe(t.clientThreadId),a=Ut(s);return e.jsx(_r,{clientThreadId:t.clientThreadId,children:a&&s&&ia?e.jsx(ia,{clientThreadId:t.clientThreadId,gizmoId:s,currentModelId:t.currentModelId,onRequestCompletion:t.onRequestCompletion}):e.jsx(Bg,{...t})})}function Rg({children:t}){const{store:s}=_e(),[a,o]=i.useState(!1),n=tn();i.useEffect(()=>n.subscribe("focus",()=>{o(!0)}),[n]),i.useEffect(()=>n.subscribe("blur",()=>{o(!1)}),[n]);const l=!!s.useSharedProps()?.isShowingAutocomplete;return t(l&&a)}function Pg({isSendBlocked:t,clientThreadId:s,headlineOption:a,shouldShowStarterPrompts:o,promptChips:n,onSelectStarterPrompt:r,starterPromptExpanded:l,setStarterPromptExpanded:c}){const d=Ra();return e.jsx(Rg,{children:p=>e.jsxs(ne.div,{initial:{opacity:0},animate:{opacity:p?0:1},exit:{opacity:0},transition:{duration:.1},className:R("justify-center",p?"pointer-events-none":"","mt-[var(--screen-optical-compact-offset-amount)] h-full flex-shrink flex-col items-center overflow-hidden text-token-text-primary [display:var(--display-hidden-until-loaded,flex)]",d?"@lg/thread:hidden":"lg:hidden"),children:[a==="CHATGPT_LOGO"?e.jsx($s,{className:"inline-block h-12 w-12"}):e.jsx(zr,{headlineOption:a}),e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:R(!l&&"h-[116px]"),children:o&&e.jsx(Gr,{starterPrompts:n,onSelectStarterPrompt:r,disabled:t,clientThreadId:s,onExpand:()=>c(!0),mobileLayout:!0})})]})})}function Dg(t){const s=Ve("1468311859").value,a=Ve("3664702598").value,{layer:o}=ct("4031588851"),n=Eg(),r=s,l=a&&n;let c="HARDCODED";if(t){const d=o.get("search_autocomplete_mode","");r&&d&&(c=d)}else l&&(c=o.get("autocomplete_mode","HARDCODED"));return c}function Bg({clientThreadId:t,currentModelId:s,isModelLoaded:a,onRequestCompletion:o,chatgptHomepageDisclaimer:n}){const r=tn(),l=Dt(t),c=ce(t,O=>O?.isLoading),d=Yn(),[p,u]=i.useState([]),m=i.useCallback(O=>{u(L=>{const X=typeof O=="function"?O(L):O;return _a(X,L)?L:X})},[]),{trendingSuggestions:h,fetchTrendingSuggestions:x}=Og(Mn),g=i.useRef(!1),{isUnauthenticated:b}=$e(),T=Xi(),[S,v]=i.useState(!1),w=Zs(),_=Xe();hr(r);const A=Ve("589604007").value,{layer:B}=Ls("4031588851"),{layer:j}=Ls("3533083032"),{promptStarters:M,isSuccess:k}=mr(l&&!c&&a,t,8,A,!0,s??void 0),I=T&&!!p.find(O=>!!O.requires_file_upload),F=i.useCallback(O=>{const L=r.getCurrentText();return L&&Tn(O).startsWith(L.toLocaleLowerCase())},[r]),C=i.useCallback(O=>{const L=r.getCurrentText(),X=O.title+O.body;return F(O)?{...O,title:L,body:X.slice(L.length)}:{...O,title:X,body:""}},[r,F]),f=i.useCallback((O=!1)=>{m(L=>!L.some(F)&&L.length>0?[]:O?L:L.map(C))},[F,C,m]),P=(O,L,X)=>{const ue=O.title;m([]),r.focus(),r.setText(ue),requestAnimationFrame(()=>{const re=(M?.filter(ie=>ie.theme===O.theme)??[]).map(ie=>{const Ie=Pt(ie.oneliner),Re=Ie.startsWith(ie.title);return{...ie,title:Re?`${ie.title} `:"",body:Re?ie.body:Ie,autocompletionChunks:ig(ue,Ie),type:rs.Autocomplete}});m(re),re.length>0&&Ht(re,t),Yd(O,X,t)})};i.useEffect(()=>{const O=p.some(L=>L.theme===Hn.Search);w&&r.getCurrentText()===""?h.length>0?m(h):x():O&&!w&&m(L=>L.filter(X=>X.theme!==Hn.Search))},[p,w,h,x,r,m]),i.useEffect(()=>{w&&r.getCurrentText()===""&&h.length>0&&Ht(h,t)},[w,r,h,t]);const H=M?.reduce((O,L)=>(L.theme&&!O[L.theme]&&(O[L.theme]=L),O),{}),V=[];if(H)for(const O in H)V.push(H[O]);const q=V&&V.length>0,N=!!(k&&q&&a);Ue.markStart("StarterPromptChips",Ue.NS_COMPOSER),N&&Ue.markRendered("StarterPromptChips",Ue.NS_COMPOSER);const U=Mn-p.filter(F).length,D=Dg(w),K=b?j.get("headline_option","HELP_WITH"):B.get("headline_option","HELP_WITH"),Y=B.get("autocomplete_min_char",4),de=B.get("autocomplete_fetch_interval",200),ge=i.useRef(null),Z=i.useCallback(gr(async O=>{const L=r.getCurrentText();if(!L||L.length<Y||L.length>80||r.hasMultipleLines()){m([]);return}if(!g.current&&!(ge.current&&ge.current.length>Y&&L.startsWith(ge.current)))try{const X=await cs.generateAutocompletions(L,O,w);if(X.completions.length===0){ge.current=L;return}const ue=X.completions.map(re=>({id:fl(),type:rs.Autocomplete,title:re.slice(0,L.length),body:re.slice(L.length),oneliner:re,prompt:re,source:D})).filter(F).map(C);m(re=>{const ie=re.filter(F),Ie=ue.filter(Re=>{const He=Tn(Re);return!ie.some(me=>{const oe=Tn(me);if(He===oe)return!0;const he=/[\p{P}\p{S}]$/u,xe=He.replace(he,""),Me=oe.replace(he,"");return xe===oe||He===Me||xe===Me})}).slice(0,Mn-ie.length);return[...ie,...Ie]}),ue.length>0&&Ht(ue,t)}catch{}},D==="BING"?150:de),[r,D,C,de]),Ae=i.useCallback(()=>{f(),U>0&&Z(U)},[Z,f,U]);i.useEffect(()=>{g.current&&m([])},[g,m]);const Ne=i.useMemo(()=>D==="HARDCODED"?f:Ae,[D,Ae,f]),Ee=i.useCallback(()=>{r instanceof po&&f(!0),r.getCurrentText().indexOf(`
`)>0&&m([])},[r,m,f]),Ce=i.useCallback((O,L,X)=>{L.forEach(ue=>{ue.id===O.id&&(ue.userInput=r.getCurrentText())}),m([L[X]])},[r,m]),we=Ra();return e.jsx(e.Fragment,{children:e.jsx(ds,{children:e.jsx("div",{className:R("h-full w-full",we?"@lg/thread:py-[18px]":"lg:py-[18px]"),children:e.jsx(mo,{isStaticSharedThread:!1,verticalPadding:"none",horizontalPadding:"standard",clientThreadId:t,fullHeight:!0,children:e.jsxs(Qo,{className:"relative",children:[e.jsx("div",{className:R("mb-7 hidden text-center",we?"@lg/thread:block":"lg:block"),children:K==="CHATGPT_LOGO"?e.jsx($s,{className:"inline-block h-12 w-12"}):e.jsx(zr,{headlineOption:K})}),e.jsx(Pg,{headlineOption:K,shouldShowStarterPrompts:N,promptChips:V,onSelectStarterPrompt:P,starterPromptExpanded:S,setStarterPromptExpanded:v,isSendBlocked:d,clientThreadId:t}),e.jsx("div",{className:R(we?"@lg/thread:absolute @lg/thread:bottom-8 @lg/thread:left-0 @lg/thread:w-full":"[display:var(--display-hidden-until-loaded,block)] lg:absolute lg:bottom-8 lg:left-0 lg:w-full"),children:e.jsx(Qo,{className:"relative @lg/thread:pb-0",children:_?e.jsx(Ur,{}):e.jsx(Br,{className:"block"})})}),e.jsx("div",{className:"w-full",children:e.jsx(Or,{clientThreadId:t,isNewThread:l,currentModelId:s,onRequestCompletion:o,showPromptStarters:!1,autocompletions:p,requiresFileUpload:I,onComposerInput:Ne,onComposerChange:Ee,onAutocompleteSelect:Ce,onTaggingDropdownClose:()=>{g.current=!1},onTaggingDropdownOpen:()=>{g.current=!0},hideHeader:!0})}),e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:R("hidden",we?"@lg/thread:block":"lg:block",n&&b&&S?"":"h-[70px]"),children:N&&e.jsx(Gr,{starterPrompts:V,onSelectStarterPrompt:P,disabled:d,clientThreadId:t,onExpand:()=>v(!0)})}),n&&e.jsx("div",{className:R("w-full px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden md:px-[60px]",we?"@lg/thread:absolute @lg/thread:bottom-0 @lg/thread:left-0":"lg:absolute lg:bottom-0 lg:left-0"),children:e.jsx("div",{className:R("min-h-4"),children:n})})]})})})})})}function zr({headlineOption:t}){const a=fe().formatMessage(Ug[t]||os.whatCanIHelpWith);return e.jsx("div",{className:"relative inline-flex justify-center text-center text-2xl font-semibold leading-9",children:e.jsx("h1",{style:{viewTransitionName:"var(--vt-splash-screen-headline)"},children:a})})}function Hg({starterPrompt:t,starterPrompts:s,index:a,disabled:o,onSelectStarterPrompt:n}){const r=t.theme??t.title,l=en(),{mutate:c}=Jd(),d=t.category==="onboarding"?()=>{c({key:Ke.hasUsedConversationalOnboardingStarterPrompt}),l(t,s,a)}:()=>n(t,s,a);return e.jsx(pr,{disabled:o,onClick:d,icon:e.jsx(Xd,{category:t.category,useV2Colors:!0}),label:r})}function la({clientThreadId:t,onClick:s}){i.useEffect(()=>{Qd(t)},[t]);const a=fe();return e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},className:"inline-block",children:e.jsx(pr,{onClick:()=>{Zd(t),s()},label:a.formatMessage(os.moreStarterPrompts)})})}const Lg=5,Fg=3;function Gr({starterPrompts:t,onSelectStarterPrompt:s,disabled:a,clientThreadId:o,onExpand:n,mobileLayout:r=!1}){const l=r?Fg:Lg,[c,d]=i.useState(l),[p,u]=i.useState(!1),m=i.useRef(null),h=t.length<=c;i.useEffect(()=>{Ht(t.slice(0,l),o)},[o]),i.useEffect(()=>{if(!p&&!h&&m.current){const g=m.current,b=g.getBoundingClientRect(),T=b.width,S=Array.from(g.children);let v=0;for(let w=0;w<S.length&&S[w].getBoundingClientRect().right-b.left<=T;w++)v++;d(v),u(!0)}},[t,h,p]);const x=()=>{const g=t.slice(c,t.length).map(b=>({...b,isAdditional:!0}));g.length>0&&Ht(g,o),d(t.length),n()};return e.jsxs("div",{className:R("mt-5 flex items-center justify-center gap-x-2 transition-opacity xl:gap-x-2.5",p&&t.length>0?"opacity-100":"opacity-[0.01]",r?"flex-wrap":"flex-nowrap"),children:[e.jsxs("ul",{className:R("relative flex items-stretch gap-x-2 gap-y-4 overflow-hidden py-2 sm:gap-y-2 xl:gap-x-2.5 xl:gap-y-2.5",h||r?"flex-wrap justify-center":"flex-nowrap justify-start"),ref:m,children:[t.slice(0,c).map((g,b)=>e.jsx(ne.li,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},children:e.jsx(Hg,{starterPrompt:g,starterPrompts:t,index:b,disabled:a,onSelectStarterPrompt:s})},g.id??b)),r&&t.length>c&&e.jsx(la,{clientThreadId:o,onClick:x})]}),!r&&t.length>c&&e.jsx(la,{clientThreadId:o,onClick:x})]})}const Og=t=>{const[s,a]=i.useState([]),o=i.useCallback(async()=>{const r=(await cs.generateTrendingSuggestions(t)).suggestions.map((l,c)=>({type:rs.Trending,title:ca(l),body:"",icon:e.jsx($d,{}),prompt:ca(l),id:`search-trending-${c}`,theme:Hn.Search}));a(r)},[t]);return{trendingSuggestions:s,fetchTrendingSuggestions:o}};function ca(t){return t.split(" ").map(Kd).join(" ")}const os=Ze({whatCanIHelpWith:{id:"SplashScreenV2.whatCanIHelpWith",defaultMessage:"What can I help with?"},whereShouldWeStart:{id:"SplashScreenV2.whereShouldWeStart",defaultMessage:"Where should we start?"},askChatgptAnything:{id:"SplashScreenV2.askChatgptAnything",defaultMessage:"Ask ChatGPT anything"},moreStarterPrompts:{id:"SplashScreenV2.moreStarterPrompts",defaultMessage:"More"}}),Ug={HELP_WITH:os.whatCanIHelpWith,WHERE_TO_START:os.whereShouldWeStart,ASK_CHATGPT:os.askChatgptAnything};function zg({clientThreadId:t,currentModelId:s,isModelLoaded:a,onRequestCompletion:o,showChatgptHomepage:n,chatgptHomepageDisclaimer:r}){const l=dt();let c=e.jsx(Rm,{}),d;return l?(d=e.jsx(Gg,{}),c=e.jsx($s,{className:"mb-6 h-12 w-12 brand:hidden"})):t!=null?(d=n?e.jsx(Ig,{clientThreadId:t,currentModelId:s,isModelLoaded:a,onRequestCompletion:o,chatgptHomepageDisclaimer:r}):e.jsx(Pm,{clientThreadId:t}),c=null):d=e.jsx(Wg,{}),e.jsxs("div",{className:"flex h-full flex-col items-center justify-center text-token-text-primary",children:[c,d]})}function Gg({gizmo:t}){const s=tu(),a=t?su(t.tools):!1,o=is();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-5 text-2xl font-semibold","data-testid":"temporary-chat-label",children:[e.jsx(nu,{id:"temporary-chat-checkbox",name:"temporary-chat-checkbox",checked:!0}),e.jsx(E,{...bt.temporaryChat})]}),e.jsxs("div",{className:"max-w-sm text-center text-sm font-normal text-token-text-tertiary",children:[e.jsx(E,{...o?.isWorkspaceAccount()?s?bt.temporaryChatBizMemoryAvailable:bt.temporaryChatBizMemoryUnavailable:s?bt.temporaryChatDescriptionMemoryAvailable:bt.temporaryChatDescriptionMemoryUnavailable}),a&&e.jsx("div",{className:"mt-3",children:e.jsx(E,{...bt.temporaryChatDescriptionGptActions,values:{link:n=>e.jsx("a",{href:"https://help.openai.com/en/articles/8914046-temporary-chat-faq",target:"_blank",className:"underline",rel:"noreferrer",children:n})}})})]})]})}function Wg(){return e.jsx("div",{className:"mb-5 text-2xl font-semibold",children:e.jsx(E,{...bt.howCanIHelpYouToday})})}function qg({clientThreadId:t,currentModelId:s,isModelLoaded:a,onRequestCompletion:o,showChatgptHomepage:n,chatgptHomepageDisclaimer:r}){const l=Qe(t),c=Pa(),d=Yn(),{data:p}=jt(l),u=eu(),m=Qi(()=>navigator.windowControlsOverlay);return(c!=null||l!=null)&&p==null?null:e.jsxs("div",{className:"relative h-full",children:[e.jsx("div",{className:m?.visible?R("absolute right-[calc(100dvw-env(titlebar-area-width,100dvw)-env(titlebar-area-x,0))]",u?"left-[env(titlebar-area-x,0)]":"left-0"):"absolute left-0 right-0",children:e.jsx(Nr,{clientThreadId:t})}),p!=null?e.jsx(Im,{gizmo:p,showStarterPrompts:!0,disableStarterPrompts:d}):e.jsx(zg,{clientThreadId:t,currentModelId:s,isModelLoaded:a,onRequestCompletion:o,showChatgptHomepage:n,chatgptHomepageDisclaimer:r})]})}const bt=Ze({temporaryChat:{id:"GizmoLanding.temporaryChat",defaultMessage:"Temporary Chat"},temporaryChatBizMemoryAvailable:{id:"g1opBW",defaultMessage:"This chat won't appear in your history and won't use or create memories."},temporaryChatBizMemoryUnavailable:{id:"fQmbtG",defaultMessage:"This chat won't appear your conversation history."},temporaryChatDescriptionMemoryAvailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryAvailable",defaultMessage:"This chat won't appear in history, use or create memories, or be used to train our models. For safety purposes, we may keep a copy for up to 30 days."},temporaryChatDescriptionMemoryUnavailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryUnavailable",defaultMessage:"This chat won't appear in history or be used to train our models. For safety purposes, we may keep a copy of this chat for up to 30 days."},temporaryChatDescriptionGptActions:{id:"GizmoLanding.temporaryChatDescriptionGptActions",defaultMessage:"Any data shared with a third party through GPT actions are subject to the third party's privacy policy. <link>Learn more</link>"},howCanIHelpYouToday:{id:"GizmoLanding.howCanIHelpYouToday",defaultMessage:"How can I help you today?"}});function Vg({modelSlug:t,animateModelLabelOnRender:s,isDropdownOpen:a,isRegenerateEnabled:o,isHovered:n,animateShortLabel:r}){const{data:l}=ut(),[c,d]=i.useState("initial");i.useEffect(()=>{if(s){const h=setTimeout(()=>d("show"),500),x=setTimeout(()=>d("initial"),2e3);return()=>{clearTimeout(h),clearTimeout(x)}}d("initial")},[s]);const{shorterLabel:p}=l?.categories.find(({defaultModel:h})=>h===t)??{},u={initial:{opacity:0,paddingLeft:0,width:"0"},show:{opacity:1,paddingLeft:2,width:"100%"},visible:{opacity:1,paddingLeft:2,width:"100%",transition:{delay:0,duration:0}}},m=a?"visible":n?"show":c;return e.jsxs(ne.div,{initial:"initial",animate:m,className:"flex items-center pb-0",children:[e.jsx(fr,{className:"icon-md"}),(o||r)&&e.jsx(ne.span,{className:"overflow-hidden text-clip whitespace-nowrap text-sm",variants:u,transition:{type:"tween",duration:.18},children:p}),o&&e.jsx(so,{className:"icon-sm"})]})}function Wn(t,s){const{modelSwitcherDeny:a,subscriptionLevel:o}=t;return!!a&&a.reason===Zi.RATE_LIMIT&&o===el.PLUS&&!s}const Ps="rounded-lg radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed";function $g({className:t,clientThreadId:s,message:a,onModelSelect:o,onDropdownChange:n,canRegenerateResponse:r}){const[l,c]=i.useState(null),[d,p]=i.useState(!1),[u,m]=i.useState(!1),h=Qe(s),x=ou({clientThreadId:s,message:a}),g=a.message.metadata?.model_slug,b=a.message.id,{modelOptions:T,modelSlug:S,animateModelLabelOnRender:v,messageModelEnabledTools:w}=x,_=au(a.message),A=w.includes(se.Search),B=i.useMemo(()=>T.find(f=>f.value===g),[T,g]),j=i.useRef(null),{data:M=null}=Vs(),k=M&&Ta(M),I=f=>{f||setTimeout(()=>{j.current&&j.current.blur()},10)};if(i.useEffect(()=>{I(d)},[d]),ce(s,lu))return null;const C=r&&T.some(f=>Wn(f,k));return h?null:e.jsxs(Q.Root,{onOpenChange:f=>{r&&(p(f),n(f),I(f)),f&&W.logEvent(G.conversationOpenMessageModelSelector,{has_get_plus_button:C,is_new_regen_dropdown:!0})},children:[r?e.jsx(Yg,{label:e.jsx(E,{id:"wDs5sz",defaultMessage:"Switch model"}),children:e.jsx(Kn,{ref:j,className:R("cursor-pointer",t),onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),children:e.jsx(Vg,{modelSlug:S,animateModelLabelOnRender:v,isDropdownOpen:d,isRegenerateEnabled:r,isHovered:u})})}):null,r&&e.jsx(Q.Portal,{children:e.jsxs(Q.Content,{className:"z-30 min-w-fit origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[e.jsx(Q.Item,{disabled:!0,className:"pb-0 pt-2",children:e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(E,{id:"bFLh5u",defaultMessage:"Switch model"})})}),e.jsx(Kg,{clientThreadId:s,messageId:b,onModelSelect:o,messageModelSlug:g,modelOptions:T,setHoveredOption:c,hoveredOption:l,retryOption:B,lastResponseUsedSearch:_,modelSupportsSearch:A,doesUserHaveAnyAccountsWithPlusFeatures:k})]})})]})}function Kg({clientThreadId:t,messageId:s,modelOptions:a,messageModelSlug:o,onModelSelect:n,setHoveredOption:r,hoveredOption:l,retryOption:c,lastResponseUsedSearch:d,modelSupportsSearch:p,doesUserHaveAnyAccountsWithPlusFeatures:u}){const m=fe(),[h,x]=i.useMemo(()=>ru(a,S=>S.subcategory),[a]),g=i.useMemo(()=>{const S=new Map;return h.forEach(v=>{const w=v.subcategory;w&&(S.has(w)||S.set(w,[]),S.get(w)?.push(v))}),S},[h]),b=R("icon-sm","order-10 ml-auto text-token-text-tertiary icon-md"),T=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:m.formatMessage(kn.search),icon:e.jsx(nr,{className:b}),condition:p&&!d,eventName:"chatgpt_regenerate_with_search_button_clicked"},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:m.formatMessage(kn.nosearch),icon:e.jsx(iu,{className:b}),condition:p&&d,eventName:"chatgpt_regenerate_without_search_button_clicked"}];return e.jsxs(e.Fragment,{children:[x.map(S=>{const{value:v,...w}=S;return e.jsx(As,{value:v,onSelect:()=>{ye.logEvent("chatgpt_regenerate_switch_model_button_clicked",v,{requestedModelId:v,...ns({clientThreadId:t,messageId:s})}),n({requestedModelId:v})},includeRegenerate:!1,onMouseEnter:()=>r(v),onMouseLeave:()=>r(null),isHovered:l===v,messageModelSlug:o,includeCheck:!1,shouldShowUpsell:Wn(S,u),className:Ps,...w,icon:e.jsx("span",{className:b})},v)}),[...g.entries()].map(([S,v])=>e.jsxs(Q.Sub,{children:[e.jsx(Q.SubMenuTrigger,{children:e.jsx("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:S})}),e.jsx(Q.Portal,{children:e.jsx(Q.SubContent,{className:"min-w-fit",children:v.map(w=>{const{value:_,...A}=w;return e.jsx(As,{value:_,onSelect:()=>{ye.logEvent("chatgpt_regenerate_switch_model_button_clicked",_,{requestedModelId:_,...ns({clientThreadId:t,messageId:s})}),n({requestedModelId:_})},includeRegenerate:!1,onMouseEnter:()=>r(_),onMouseLeave:()=>r(null),isHovered:l===_,messageModelSlug:o,includeCheck:!1,className:Ps,...A,icon:null,shouldShowUpsell:Wn(w,u)},S+"-"+_)})})})]},S)),!!c&&e.jsxs(e.Fragment,{children:[e.jsx(Q.Separator,{}),e.jsx(As,{onSelect:()=>{ye.logEvent("chatgpt_regenerate_try_again_button_clicked",c.value,{requestedModelId:c.value,...ns({clientThreadId:t,messageId:s})}),n({requestedModelId:c.value})},includeRegenerate:!0,onMouseEnter:()=>r(c.value),onMouseLeave:()=>r(null),messageModelSlug:o,includeCheck:!1,className:Ps,...c,label:m.formatMessage(kn.tryAgain),subtitle:c.label,icon:e.jsx(fr,{className:b})},c.value),T.filter(S=>S.condition).map(S=>e.jsx(As,{onSelect:()=>{ye.logEvent(S.eventName,c.value,{requestedModelId:c.value,...ns({clientThreadId:t,messageId:s})}),n({requestedModelId:c.value,extraStreamParams:S.extraStreamParams})},includeRegenerate:!1,onMouseEnter:()=>r(S.key),onMouseLeave:()=>r(null),isHovered:l===S.key,messageModelSlug:o,includeCheck:!1,className:Ps,...c,label:S.label,subtitle:"",icon:S.icon},S.key))]})]})}function Yg({children:t,label:s}){return e.jsx(Ft,{label:s,sideOffset:0,children:t})}const kn=Ze({tryAgain:{id:"VbsBGW",defaultMessage:"Try again"},search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),Jg=i.memo($g);function Xg({followups:t}){const s=en();return e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 font-semibold",children:e.jsx(E,{id:"3UFIQc",defaultMessage:"Follow up"})}),e.jsx("div",{children:t.slice(0,4).map((a,o)=>e.jsx(ne.div,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:o*.03},exit:{opacity:0,translateY:4},children:e.jsx(Qg,{followUp:a,onSelectingSuggestedReply:s})},o))})]})}function Qg({followUp:t,onSelectingSuggestedReply:s}){return e.jsxs("button",{className:"-ml-3 flex w-full items-start gap-1 rounded-lg py-2.5 hover:bg-token-main-surface-secondary",onClick:()=>s(t,[],0),children:[e.jsx("div",{className:"pl-2 opacity-30",children:e.jsx(cu,{className:"h-6 w-6"})}),e.jsx("div",{className:"gap-0.5 pr-2 text-left",children:du(t)})]})}const da=ze(()=>Ge(()=>import("./c87uv1mutc86tiqk.js").then(t=>t.s6),__vite__mapDeps([4,1,2,3,5])).then(t=>t.MemoryActionResult));function ua(t,s,a){Da.updateTree(t,o=>{o.updateNodeMetadata(s,{inlineComparisonRating:a})})}const ma=({messages:t})=>{for(const{message:{metadata:s}}of t){const{augmented_paragen_prompt_label:a}=s??{};if(a)return a}};function Zg(t){const s=i.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),a=i.useRef({left:null,right:null});return t.stubSideBySideFeedback?e.jsx(Wr,{setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:s,firstVisibleTokenTimestampsRef:a,...t}):e.jsx(ep,{...t,visibilityStateRef:s,firstVisibleTokenTimestampsRef:a})}function ep(t){const{clientThreadId:s,variantIds:a,variantsInStreamInfo:o,turnIndex:n,firstVisibleTokenTimestampsRef:r}=t;if(a.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const l=Mo(),c=Qn(),d=tl(),[p,u]=i.useMemo(()=>xr(a.join(""))()<.5?[0,1]:[1,0],[a[0],a[1]]),m=p<u?"left":"right",h=m==="left"?"right":"left",x=a[p],g=a[u],[b,T]=ce(s,k=>[Pt(k).tree.getLeafFromNode(x).id,Pt(k).tree.getLeafFromNode(g).id]),S=Pt(En(s,n,b)),v=Pt(En(s,n,T)),w=m==="left"?S:v,_=m==="left"?v:S,A=o.display_treatment==="unskippable",B=l?"skippable_parallel_2_in_stream:a:2.0":"skippable_parallel_2_in_stream:a:1.5";i.useEffect(()=>(Bn.setState({displayingSideBySideFeedback:!0,unskippable:A}),()=>{Bn.setState({displayingSideBySideFeedback:!1,unskippable:!1})}),[A]),uu();const j=i.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null});i.useEffect(()=>sl(nl,{requestCompletion:()=>{const k=Ye(s),F=J.getTree(Be(s)).getParentPromptNode(b),C=[S,v].map((H,V)=>({messageId:H.messages[H.messages.length-1].message.id,loadFirstTokenTime:V===0?r.current.left:r.current.right,loadEndTime:as(H.messages)?.completionSampleFinishTime})),f={},P=F.metadata?.variantsInStreamInfo==null&&F.message.metadata?.paragen_variants_info!=null;for(const H of C)f[H.messageId]=P?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:H.loadFirstTokenTime,load_end_time:H.loadEndTime};Sa({params:{conversation_id:k,displayed_message_ids:C.map(H=>H.messageId),message_metadatas:f,rating:"skipped",selected_message_id:null,source_timestamp:Date.now(),ui_variant:l?2:1,user_prompt_message_id:F.message.id}})}}),[S,v,b,s,t.conversationTurnMountTime,B,h,w?.messages,_?.messages,d,l,r]);const M=k=>{const I=J.getTree(Be(s)),F=I.getLeafFromNode(k);Da.setThreadCurrentLeafId(s,F.id);const C=k===x,f=C===(m==="left");w.messages.length>0&&ua(s,w.messages[w.messages.length-1].nodeId,f?"original":"new"),_.messages.length>0&&ua(s,_.messages[_.messages.length-1].nodeId,f?"original":"new");const P=Ye(s),H=[S,v].map((D,K)=>({messageId:D.messages[D.messages.length-1].message.id,loadFirstTokenTime:K===0?r.current.left:r.current.right,loadEndTime:as(D.messages)?.completionSampleFinishTime})),V=C?H[0].messageId:H[1].messageId,q=I.getParentPromptNode(b),N={},U=q.metadata?.variantsInStreamInfo==null&&q.message.metadata?.paragen_variants_info!=null;for(const D of H)N[D.messageId]=U?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:D.loadFirstTokenTime,load_end_time:D.loadEndTime};Sa({params:{conversation_id:P,displayed_message_ids:H.map(D=>D.messageId),message_metadatas:N,rating:"selected",selected_message_id:V,source_timestamp:Date.now(),ui_variant:l?2:1,user_prompt_message_id:q.message.id}})};return e.jsx(Wr,{...t,setPreferredFeedback:M,leftVariantId:x,rightVariantId:g,leftTurn:S,rightTurn:v,hasActiveRequest:c,originalTurn:w,visibilityStateRef:j})}function tp(t){if(!t.length)return!1;const s=t.filter(a=>a.type===Zo.Text||a.type===Zo.MultiText).filter(a=>a.message.message.status!=="finished_successfully"&&a.message.message.metadata?.snorkle_status!==void 0);return s.length>0&&s.every(a=>{const o=a.message.message.content;return o?.content_type===Ba.Text&&o.parts.join("")===""})}function Wr({setPreferredFeedback:t,leftVariantId:s,rightVariantId:a,leftTurn:o,rightTurn:n,hasActiveRequest:r,originalTurn:l,visibilityStateRef:c,...d}){const{defaultParagenLabel:p,shouldShowParagenLabels:u=!1}=Xa(),m=o&&ma(o)||p,h=n&&ma(n)||p,x=i.useMemo(()=>o?.messages??[],[o?.messages]),g=i.useMemo(()=>n?.messages??[],[n?.messages]),{avatarClassName:b,firstVisibleTokenTimestampsRef:T}=d,S=i.useMemo(()=>qs(x),[x]),v=i.useMemo(()=>qs(g),[g]),w=Ya(),[_,A]=i.useMemo(()=>[S,v].map(U=>tp(U)),[S,v]),B=yt(o?Us.getRequestIdFromConversationTurn(o):"")||_,j=yt(n?Us.getRequestIdFromConversationTurn(n):"")||A,M=o?.role===Je.User,k=n?.role===Je.User,I=i.useRef(null),F=i.useRef(null),C=i.useRef(null),f=d.stubSideBySideFeedback||_,P=d.stubSideBySideFeedback||A;!f&&T.current.left==null&&(T.current.left=Date.now()),!P&&T.current.right==null&&(T.current.right=Date.now()),i.useEffect(()=>{if(I.current&&F.current&&C.current){const U=Array(11).fill(0).map((K,Y)=>Y/10),D=new IntersectionObserver(K=>K.forEach(Y=>{Y.target===F.current?(c.current.left_visibility_initial==null&&(c.current.left_visibility_initial=Y.intersectionRatio),c.current.left_visibility_max=Math.max(c.current.left_visibility_max??0,Y.intersectionRatio)):Y.target===C.current&&(c.current.right_visibility_initial==null&&(c.current.right_visibility_initial=Y.intersectionRatio),c.current.right_visibility_max=Math.max(c.current.right_visibility_max??0,Y.intersectionRatio))}),{root:I.current,threshold:U});return D.observe(F.current),D.observe(C.current),()=>D.disconnect()}},[c]);const{data:H}=Ja(void 0,!1,w),V=Mo(),q=e.jsx("div",{className:"text-pretty px-6 pb-5 pt-1 text-center text-sm text-token-text-secondary",children:e.jsx(E,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})}),N=Xe();return e.jsxs("div",{className:"relative flex flex-col",children:[e.jsxs("div",{className:R("sticky z-[1] text-pretty bg-token-main-surface-primary px-6 text-center text-lg",N&&"top-[var(--thread-leading-height)] pt-3",!N&&"top-[-1px]",V&&!N?"md:top-header-height":N?"":"md:static"),"data-testid":"paragen-feedback-title",children:[e.jsx(E,{id:"JgCHDY",defaultMessage:"You’re giving feedback on a new version of ChatGPT."}),V?q:null]}),V?null:q,e.jsx("div",{className:"relative -mb-2 snap-x snap-mandatory overflow-x-auto px-3 pb-4 md:px-5 lg:px-10",ref:I,children:e.jsx("div",{className:R(!N&&"min-w-fit"),children:e.jsxs("div",{className:R("mx-auto flex max-w-6xl items-start",V&&!N&&"divide-x divide-token-border-medium dark:divide-token-border-heavy",!V&&!N&&"gap-4 sm:gap-6",V&&N&&"divide-x divide-token-border-medium dark:divide-token-border-heavy",N&&!V&&"gap-4 sm:gap-6"),children:[e.jsxs(ha,{horizontalScrollContainerRef:I,rootElementRef:F,onClick:()=>{t(s)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:f,children:[e.jsxs(fa,{children:[e.jsx(Ln,{messages:x,isUserTurn:M,avatarClassName:b}),e.jsx(pa,{children:u?e.jsx("span",{className:"font-bold text-token-text-primary",children:m}):e.jsx(E,{...va.responseNumber,values:{responseIndex:1}})})]}),V&&f?e.jsx(ga,{}):e.jsxs(e.Fragment,{children:[H!=null&&!M&&e.jsx(da,{clientThreadId:d.clientThreadId,messages:x,isParagen:!0}),e.jsx(On,{...d,groupedMessagesToRender:S,allGroupedMessages:S,isEditing:!1,isUserTurn:M,isCompletionRequestInProgress:B,hasActiveRequest:r,handleEnterEdit:Ts,handleExitEdit:Ts,shouldGrowContainer:!1}),e.jsx(xa,{clientThreadId:d.clientThreadId,conversationTurnMountTime:d.conversationTurnMountTime,turn:o,originalTurn:l})]})]}),e.jsxs(ha,{horizontalScrollContainerRef:I,rootElementRef:C,onClick:()=>{t(a)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:P,children:[e.jsxs(fa,{children:[e.jsx(Ln,{messages:g,isUserTurn:k,avatarClassName:b}),e.jsx(pa,{children:u?e.jsx("span",{className:"font-bold text-token-text-primary",children:h}):e.jsx(E,{...va.responseNumber,values:{responseIndex:2}})})]}),V&&P?e.jsx(ga,{}):e.jsxs(e.Fragment,{children:[H!=null&&!k&&e.jsx(da,{clientThreadId:d.clientThreadId,messages:g,isParagen:!0}),e.jsx(On,{...d,groupedMessagesToRender:v,allGroupedMessages:v,isEditing:!1,isUserTurn:k,isCompletionRequestInProgress:j,hasActiveRequest:r,handleEnterEdit:Ts,handleExitEdit:Ts,shouldGrowContainer:!1}),e.jsx(xa,{clientThreadId:d.clientThreadId,conversationTurnMountTime:d.conversationTurnMountTime,turn:n,originalTurn:l})]})]})]})})})]})}function ha({horizontalScrollContainerRef:t,rootElementRef:s,onClick:a,children:o,hasActiveRequest:n,isWaitingOnFirstUserVisibleToken:r}){const l=Mo(),c=Xe(),{scrollX:d}=xl({layoutEffect:!1,container:t,target:s}),p=mu(),u=hu(),m=i.useRef(null),h=i.useRef(null),x=i.useRef(null),[g,b]=i.useState(!1),[T,S]=i.useState(!1),[v,w]=i.useState(!1),[_,A]=i.useState(0);i.useEffect(()=>{if(!l)return;const C=new IntersectionObserver(f=>{for(const P of f)P.target===m.current?b(P.isIntersecting):P.target===x.current?w(P.isIntersecting):P.target===h.current&&S(P.isIntersecting)},{root:p?.current,rootMargin:c?`0px 0px -${_}px 0px`:void 0});return m.current&&h.current&&x.current&&(C.observe(m.current),C.observe(h.current),C.observe(x.current)),()=>{C.disconnect()}},[_,l,c,p]);const B=!v&&(T||g),j=Sl(d,C=>B?-1*C:0),M=Vo(0);i.useEffect(()=>{if(!l)return;const C=new ResizeObserver(f=>{Ns(f.length===1,"entryList.length === 1");const P=f[0];Ns(P.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),M.set(P.contentBoxSize[0].inlineSize)});return s.current&&C.observe(s.current),()=>{C.disconnect()}},[l,M,s]);const k=Vo(0);i.useEffect(()=>{if(!l)return;const C=new ResizeObserver(f=>{Ns(f.length===1,"entryList.length === 1");const P=f[0];Ns(P.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),k.set(P.contentBoxSize[0].blockSize+16),A(P.contentBoxSize[0].blockSize)});return u.current&&C.observe(u.current),()=>{C.disconnect()}},[l,k,u]);const I=e.jsx(Ot,{className:l?"px-5":"mt-4 self-start",onClick:a,"data-testid":"paragen-prefer-response-button",children:e.jsx(E,{id:"U2EAH6",defaultMessage:"I prefer this response"})}),F=r;return e.jsxs("div",{"data-paragen-root":!0,className:R("relative flex w-full min-w-[min(450px,80vw)] snap-center flex-col gap-1 text-left",c&&l&&"pl-3 pr-5 sm:w-[calc(100cqw-62px)] sm:pl-3 sm:pr-5 md:px-10",!c&&l&&"px-10",l?"min-h-60 py-4":"rounded-2xl border border-token-main-surface-tertiary bg-white p-5 dark:bg-gray-700"),ref:s,children:[e.jsx("div",{className:R("absolute left-0 right-0 top-48 h-px","invisible"),ref:m}),e.jsx("div",{className:R("absolute bottom-0 left-0 right-0 top-48","invisible"),ref:h}),e.jsx("div",{className:R("absolute bottom-0 left-0 right-0 h-px","invisible"),ref:x}),o,l?e.jsx("div",{className:"flex-1"}):null,l?e.jsx("div",{className:"mt-4 min-h-10",children:F?null:e.jsx(ne.div,{style:{translateX:j,width:M,bottom:k},animate:{opacity:100},initial:{opacity:0},transition:{ease:"easeOut",duration:.2,delay:.5},className:R({fixed:B,"z-20 flex w-full justify-center":!0}),children:I})}):n?null:I]})}function ga(){return e.jsxs("div",{className:"flex w-full flex-col gap-4 pb-5 pt-3",children:[e.jsx(vt,{className:"h-4 w-[75%]"}),e.jsx(vt,{className:"h-4 w-[50%]"}),e.jsx(vt,{className:"h-4 w-[80%]"}),e.jsx(vt,{className:"h-4 w-[55%]"}),e.jsx(vt,{className:"h-4 w-[66%]"}),e.jsx(vt,{className:"h-4 w-[64%]"}),e.jsx(vt,{className:"h-4 w-[48%]"})]})}function Mo(){const{layer:t}=ct("3119715334");return t.get("should-enable-hojicha",!1)}const pa=je.div`text-sm text-token-text-secondary font-semibold`,fa=je.div`flex gap-4 items-center mb-1`,vt=je.div`animate-pulse rounded-[4px] bg-token-main-surface-tertiary`;function xa({clientThreadId:t,conversationTurnMountTime:s,turn:a,originalTurn:o}){const n=uo();if(!n.showParagenMetadata||!n.showDebugConversationTurns&&!n.forceParagen||a==null)return null;let r=a===o?"ORIGINAL":"NEW";const l=a.messages[a.messages.length-1],c=l?.message?.metadata?.__internal;if(c){const{model_id:m,model_definition_slug:h,model_definition_virtual_model_id:x,alternative_model_selection_rule:g,augmented_paragen_prompt_group_id:b,augmented_paragen_prompt_id:T,augmented_paragen_prompt:S}=c;m&&(r+=`
Model ID: ${m}`),h&&(r+=`
Model Slug: ${h}`),x&&(r+=`
Virtual Model ID: ${x}`),g&&(r+=`
Alternative Model Rule: ${g}`),b&&(r+=`
Prompt Group ID: ${b}`),T&&(r+=`
Prompt ID: ${T}`),S&&(r+=`
Prompt: ${S}`)}r+=`
Message ID: ${l.message.id}`;const p=J.getTree(Be(t)).getParentPromptNode(a.variantIds[0]),u=p.metadata?.variantsInStreamInfo==null&&p.message.metadata?.paragen_variants_info!=null;return r+=`
User prompt message ID: ${p.message.id}`,r+=`
Is Persisted Paragen? ${u}`,r+=`
Completion Sample Finish Time: ${u?`${s} (persisted)`:as(a.messages)?.completionSampleFinishTime}`,e.jsx("div",{className:"whitespace-pre-wrap text-sm text-red-500",children:r})}async function Sa({params:t}){await cs.submitParagenSelectionV2(t)}const va=Ze({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}"}});function sp({handleShowRetrievalResults:t,clientThreadId:s,turnIndex:a,responseComplete:o=!1}){const[n,r]=ce(s,u=>[J.getTurnContentReferences(u,a),Ha(u?.conversationTurns[a]?.messages??[])]),l=i.useMemo(()=>({turnIndex:a,clientThreadId:s,responseComplete:o}),[s,o,a]),c=i.useRef(!1);i.useEffect(()=>{c.current||(c.current=!0,W.logEvent(G.fileSourcesFooterShown,l))},[l]);const d=i.useCallback(()=>{W.logEvent(G.fileSourcesFooterClicked,l),t()},[t,l]),p=i.useMemo(()=>{const u=new Set,m=[];function h(g){!g||u.has(g)||(u.add(g),m.push(g))}if(n.forEach(g=>{g.type==="file"?h(g.cloud_doc_url??g.extra?.cloud_doc_url):g.type==="file_navlist"&&g.items.forEach(b=>{h(b.cloud_doc_url)})}),o){for(const g of r)if(gu(g.message)){const b=pu(g.message.content.result),T=g.message.metadata?.cloud_doc_urls??[],S=b.chunks;for(let v=0;v<S.length;v++){const w=S[v];if(!w.documentId)continue;if(v<T.length){h(T[v]);continue}const _=w.documentId.endsWith("--google")?w.documentId.split("--")[1]:void 0,A=w.metadata.cloud_doc_url??(_?`https://drive.google.com/file/d/${_}`:void 0);h(A?.toString())}break}}const x=[];for(let g=0;g<m.length;g++){const b=m[g],T=fu(b);if(T&&x.push(T.Icon),x.length>=3)break}return x},[r,n,o]);return e.jsxs(e.Fragment,{children:[e.jsx(ne.div,{className:"absolute h-[60px]",initial:{opacity:0},animate:{opacity:1},children:e.jsxs("button",{className:R("not-prose group/footnote mb-2 mt-3 flex w-fit items-center gap-1.5 rounded-xl border border-token-border-light bg-token-main-surface-primary py-2 hover:bg-token-main-surface-secondary","pl-3 pr-2.5"),onClick:d,children:[e.jsx("div",{className:"flex items-center gap-0.5 text-sm font-medium",children:e.jsx(E,{id:"/48IOP",defaultMessage:"Sources"})}),p.length>0&&e.jsx("div",{className:"flex flex-row-reverse gap-1",children:p.reverse().map((u,m)=>e.jsx(ne.div,{className:R("flex items-center overflow-hidden rounded-full border-token-main-surface-primary bg-token-main-surface-primary","group-hover/footnote:border-token-main-surface-secondary","relative"),initial:{opacity:0},animate:{opacity:1},children:e.jsx(u,{className:"icon-md"})},m))})]})}),e.jsx("div",{className:"h-[60px]"})]})}const ba=[1,2,3,4,10,20,30],np=.5;function op({clientThreadId:t,conversationLeafId:s}){const a=Sr(vr.isBusinessWorkspace),o=i.useRef(!1),n=ls(t),r=ce(t,k=>k?.mode),{isUnauthenticated:l}=$e(),c=i.useMemo(()=>{if(!n)return-1;const k=xr(n);return k()>np?-1:ba[Math.floor(k()*ba.length)]},[n]),d=ol(t,s),p=d[d.length-1],u=i.useMemo(()=>Us.getRequestIdFromConversationTurn(p),[p]),m=yt(u),[h,x]=i.useState(null),[g,b]=i.useState(!1),[T,S]=i.useState(!1),[v,w]=i.useState(!1),_=k=>{const I=as(d)?.messages[0]?.message.id;x(k),j(I,k)},A=d.filter(k=>k.role===Je.Assistant).length,B=p?.role===Je.Assistant,j=i.useMemo(()=>gr((k,I)=>{n&&k&&cs.submitConversationRating({conversation_id:n,message_id:k,rating:I,shown_at_assistant_turn:c}),W.logEvent(G.conversationRatingSubmitted,{rating:I,showAtAssistantTurn:c,conversationId:n}),b(!0),setTimeout(()=>{S(!0)},1500)},2e3),[n,c]),M=A!==c||m||!B||!!a||r?.kind!==Fe.PrimaryAssistant||v||l;return i.useEffect(()=>{!M&&!o.current&&(W.logEvent(G.conversationRatingShown,{showAtAssistantTurn:c,conversationId:n}),o.current=!0)},[M]),v||M?null:e.jsxs("div",{className:"mx-auto",children:[e.jsx(ds,{children:g&&!T&&e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(ya,{$padded:!0,children:e.jsx("span",{className:"text-sm text-token-text-tertiary",children:e.jsx(E,{id:"rating.thanks",defaultMessage:"Thanks for your feedback!"})})})},"submitted")}),!g&&e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},children:e.jsxs(ya,{$padded:!1,children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 px-4 py-3 text-sm text-token-text-secondary",children:[e.jsx(E,{id:"rating.instructions",defaultMessage:"Is this conversation helpful so far?"}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx(_n,{$selected:h==="thumbsUp",onClick:()=>_("thumbsUp"),children:e.jsx(br,{className:"icon-md"})}),e.jsx(_n,{$selected:h==="thumbsDown",onClick:()=>_("thumbsDown"),children:e.jsx(yr,{className:"icon-md"})})]})]}),e.jsx("div",{className:"w-px flex-1 self-stretch bg-token-main-surface-tertiary"}),e.jsx(_n,{className:"p-3",$selected:!1,onClick:()=>w(!0),children:e.jsx(al,{className:"icon-md text-token-text-secondary hover:text-token-text-primary"})})]})},"rating")]})}const _n=je.button`
  ${t=>t.$selected?"text-token-text-primary":"text-token-text-secondary"}
  hover:text-token-text-primary
`,ya=je.div`inline-flex rounded-xl border border-gray-100 dark:border-gray-700
${t=>t.$padded&&"py-3 px-4"}
`,ap=ze(()=>Ge(()=>import("./bjgwx71k1q27hq9q.js"),__vite__mapDeps([50,2,1,3,4,5,51])));function rp({clientThreadId:t,conversationLeafId:s,canShowInlineMessageFeedback:a,messageForRating:o,allGroupedMessages:n,currentModelId:r}){let l=null;const c=La(h=>{const x=J.getConversationTurns(Be(t,h),s);let g=0;for(let b=x.length-1;b>=0;b--){const T=x[b];if(T.messages.some(S=>S.message.metadata?.is_indepth_feedback))return!0;if(T.messages.some(S=>S.message.author.role===Je.Assistant)&&g++,g>=3)break}return!1}),d=ls(t),p=Xs(h=>h.voiceFeedbackThread),u=d===p,{voiceName:m}=xu();return c?null:(u&&d?(rl.feedbackShown.success({voice:m}),l=e.jsx("div",{className:"text-center",children:e.jsx(Su,{serverThreadId:d})})):o.rating&&a?l=e.jsx(ap,{clientThreadId:t,conversationMessage:o,allGroupedMessages:n,currentModelId:r}):l=e.jsx("div",{className:"text-center",children:e.jsx(op,{clientThreadId:t,conversationLeafId:s})}),e.jsx("div",{className:"mt-3 w-full empty:hidden",children:l}))}const ip=ze(()=>Ge(()=>import("./eap5trf7aabfzcb3.js"),__vite__mapDeps([52,2,1,3,53,54,4,5,55,56,57])).then(t=>t.VoicePlayButton)),lp=ze(()=>Ge(()=>import("./kfjh1usbem0itguo.js"),__vite__mapDeps([58,2,4,1,3,5,59,60])).then(t=>t.AutomationSourceHeader)),ja=80,cp=16,Ca={minHeight:`calc(100dvh - ${jr}px - ${Wu}px - 100px)`};function dp(t){const{turnIndex:s,conversationLeafId:a,isFinalTurn:o,clientThreadId:n,onChangeItemInView:r,onChangeRating:l,currentModelId:c,avatarClassName:d,showAvatar:p,scrollToMessageId:u,dateHeaderType:m}=t,h=fe(),x=co();is()?.normalizedAccountUserId;const g=!!x&&il(x),b=Vn(),T=Sr(vr.isBusinessWorkspace),S=Na(),{value:v}=Ve("2848981774"),{value:w}=Ve("1456513860"),_=p??!w,A=null,{value:B}=Ve("1887864177"),j=Ye(n),M=Pt(En(n,s,a)),{messages:k,variantIds:I,variantsInStreamInfo:F}=M,C=qs(k),f=vu(),P=as(k);let H=P;for(const z of C){const Se=Km(z);if(Se.some(St=>f.has(St.message.id))){H=Se[Se.length-1];break}}const V=P!==H,q=k.slice(0,H?k.indexOf(H)+1:0),N=!1,U=Jn(),[D,K]=i.useState(!1),[Y,de]=i.useState(!1),ge=I.findIndex(z=>q.some(Se=>Se.nodeId===z)),Z=M.role===Je.User,Ae=dt(),Ne=Qe(n),Ee=jt(M.gizmoId??Ne)?.data,Ce=eo(c),we=bu(c),O=Xe(),[L,X,ue,re,ie,Ie]=ce(n,z=>{const Se=z?.tree!=null&&I.some(St=>{const Nt=z.tree.getLeafFromNode(St);return z.tree.getHasErrorFromNode(Nt.id)});return[z?.async_status===Ia.STREAMING,J.isMessageTurnEnded(z,a),Se,qu(Ha(z?.mode),Ee?.gizmo.id),z?.continuingFromSharedConversationId!=null,null]});let Re="default";const He=!1,me=q.some(z=>z.message.content.content_type===Ba.MultimodalText),{layer:oe}=ct("1547743984"),he=j&&U&&oe.get("show_share_button_inline",!1),{isUnauthenticated:xe}=$e(),[Me,Ct]=i.useState(!1),[nt,ot]=i.useState(!1),wt=M.messages.map(z=>z.message.id),ve=i.useRef(null),le=k[k.length-1],ae=le.rating,ee=(u?.length??0)>2&&u!=="finalAgentTurn"&&o&&v,et=()=>{q.length===1&&(W.logEvent(G.editPrompt,{id:q[0].message.id,threadId:Ye(n)}),ye.logEvent("chatgpt_edit_prompt"),K(!0))},zt=i.useCallback(()=>{K(!1)},[]),sn=i.useCallback(z=>{yu(n,s,S,z)},[n,s,S]),us=z=>{l({nodeId:le.nodeId,messageId:le.message.id,rating:z}),W.logEvent(z==="thumbsDown"?G.messageFeedbackThumbsDownClicked:G.messageFeedbackThumbsUpClicked,{id:le.message.id,threadId:Ye(n),model:c,rating:z}),de(!0)},[ms]=i.useState(()=>Date.now()),Te=i.useMemo(()=>Us.getRequestIdFromConversationTurn(M),[M]),pe=yt(Te)&&!X,Mt=Qn(),Tt=lo();let Gt=[];o&&!pe&&Tt?.messageId&&wt.includes(Tt?.messageId)&&(Gt=Tt.suggestions);const hs=B&&Gt.length>0,at=qs(q),mt=i.useRef(!1),Pe=ju(n,P);i.useEffect(()=>{if(mt.current||u===void 0||!v||!ve.current){u==="finalAgentTurn"&&o&&mt.current&&Os(n,z=>{z.scrollToMessageId=void 0});return}(wt.includes(u)||u==="finalAgentTurn"&&o)&&(mt.current=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(ve.current)if(u==="finalAgentTurn"&&o)ve.current.scrollIntoView({behavior:"instant",block:"end"}),Os(n,z=>{z.scrollToMessageId=void 0});else{const z=ve.current.offsetHeight;let Se;z>ja?Se=ja-z:Se=0,ve.current.style.scrollMarginTop=`${Se+cp+jr}px`,ve.current.scrollIntoView({behavior:"smooth"})}})}))},[u,ve.current]);const{showDebugConversationTurns:Wt}=uo(),gs=Cu(n,P),ht=wu({clientThreadId:n,conversationMode:re}),qt=i.useCallback(({requestedModelId:z,systemMessage:Se,juice:St,extraStreamParams:Nt})=>{ht({id:le.nodeId,eventMetadata:{eventSource:"mouse"},requestedModelId:z,systemMessage:Se,juice:St,extraStreamParams:Nt})},[le,ht]),nn=He,Vt=!b&&!ie&&!Ae&&!Z,$t=Mu(),kt=H?.message.author.role===Je.Assistant?H.message:null;Tu({isCompletionRequestInProgress:pe,isUserTurn:Z,message:kt});const{isOpen:ps}=ku(),fs=Qa(),We=_u(re),Kt=!$t&&!We&&Vt&&o&&F?.num_variants_in_stream===2&&!le.inlineComparisonRating&&!ue,on=Au(M),gt=Kt,Yt=Kt&&!on,_t=!V&&!Z&&!b&&!ie&&!We&&!L&&!pe&&!ps&&A==null,Jt=_t&&(!T||nn||we||g)&&!We&&!xe&&!Ae&&!P?.message.metadata?.b1de6e2_s,rt=!b&&!((pe||L)&&o)&&I.length>1&&!D&&!gt&&A==null;let pt=!1;if(Z&&q.length===1){const{shouldHideContent:z}=Nu(q[0]);z&&(pt=!0)}const xs=Z&&!We&&!b&&!me&&q.length===1&&!pt&&!D&&!xe&&A==null,At=z=>{r(I[z]),W.logEvent(G.changeNode,{intent:"toggle_between"})},De=Eu(M,q,Wt),{toggleThreadSidebar:Xt}=ll(),ft=i.useMemo(()=>M.messages.length?M.messages[M.messages.length-1].nodeId:void 0,[M.messages]),an=i.useCallback(()=>{ft&&Xt({type:"retrievalResults",clientThreadId:n,turnIndex:s,messageId:ft})},[ft,Xt,n,s]),{value:Qt}=Ve("2912660649"),rn=i.useMemo(()=>Qt&&Iu(M,Ce,!!Ne),[Qt,Ce,Ne,M]);if(!De&&!gt)return ee?e.jsx("div",{style:Ca}):null;const dn=q.some(({message:z})=>cl.getAssetPointers(z).length>0)?null:e.jsx(Jg,{className:"h-[30px] rounded-md px-1 text-token-text-secondary hover:bg-token-main-surface-secondary",clientThreadId:n,message:le,onModelSelect:qt,onDropdownChange:Ct,canRegenerateResponse:gs}),un=!Z&&!pt&&(!o||!pe)?e.jsx(Vu,{onClick:sn}):null,xt=!Z&&(!o||!pe)&&(le.disclaimers??[]).length===0&&le.nodeId?e.jsx(ip,{conversationId:n,message:le,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-xs text-token-text-tertiary hover:text-token-text-primary"}):null,Ss=!Z&&le&&(!o||!pe)?e.jsx($u,{message:le,isFinalTurn:o,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-token-text-tertiary hover:text-token-text-primary"}):null,mn=Pe&&e.jsx(Ku,{turn:M}),hn=Jt&&!pe?e.jsxs("div",{className:"flex",children:[ae!=="thumbsDown"&&e.jsx(wn,{onClick:()=>us("thumbsUp"),disabled:ae==="thumbsUp",icon:ae==="thumbsUp"?Ru:br,label:h.formatMessage({id:"ConversationTurn.goodResponseTooltip",defaultMessage:"Good response"}),testId:"good-response-turn-action-button"},`thumbsUp:${le.nodeId}`),ae!=="thumbsUp"&&e.jsx(wn,{onClick:()=>us("thumbsDown"),disabled:ae==="thumbsDown",icon:ae==="thumbsDown"?Pu:yr,label:h.formatMessage({id:"ConversationTurn.badResponseTooltip",defaultMessage:"Bad response"}),testId:"bad-response-turn-action-button"},`thumbsDown:${le.nodeId}`)]}):null,Zt=he&&e.jsx(wn,{onClick:()=>{Gs.openSharingModal(j)},label:h.formatMessage({id:"ConversationTurn.shareButtonTooltip",defaultMessage:"Share conversation"}),className:"sm:hidden",icon:Du});function gn(z){return O?z:e.jsx(mo,{clientThreadId:n,isStaticSharedThread:b,verticalPadding:Re,horizontalPadding:gt?"none":_?"standard":"expanded",children:z})}function pn(z){return O?z:e.jsx(Ws,{children:z})}return e.jsxs(e.Fragment,{children:[e.jsx(Bu,{dateHeaderType:m,turn:M}),e.jsxs("article",{className:R("w-full text-token-text-primary focus-visible:outline-2 focus-visible:outline-offset-[-4px]",u==="finalAgentTurn"&&v?"opacity-0":""),style:ee?Ca:void 0,ref:ve,dir:"auto","data-testid":`conversation-turn-${s}`,"data-scroll-anchor":o,onMouseEnter:()=>ot(!0),onMouseLeave:()=>ot(!1),children:[e.jsx(Hu,{role:M.role}),gn(e.jsx(e.Fragment,{children:gt?e.jsx(Zg,{isFeedbackEnabled:Jt,variantIds:I,variantsInStreamInfo:F,conversationTurnMountTime:ms,stubSideBySideFeedback:Yt,...t}):pn(e.jsxs(e.Fragment,{children:[N,!Z&&!N&&_&&e.jsx(mp,{children:e.jsx(Ln,{messages:q,isUserTurn:Z,avatarClassName:d,gizmo:Ee})}),e.jsx("div",{className:R("group/conversation-turn relative flex w-full min-w-0 flex-col",!Z&&Lu),children:e.jsx("div",{className:"flex-col gap-1 md:gap-3",children:e.jsxs(e.Fragment,{children:[null,!Z&&!b&&e.jsx(Fu,{messages:q,clientThreadId:n,gizmoId:Ee?.gizmo.id}),fs&&!Z&&e.jsx(lp,{clientThreadId:n,messages:q}),e.jsx(On,{groupedMessagesToRender:at,allGroupedMessages:C,...t,isEditing:D,isUserTurn:Z,isCompletionRequestInProgress:pe,isFeedbackEnabled:Jt,isFinalTurn:o,hasActiveRequest:Mt,showEditButton:xs,handleEnterEdit:et,handleExitEdit:zt}),Ce&&!Qt&&e.jsx("div",{className:"mb-4",children:e.jsx(Ou,{messages:q})}),rn&&e.jsx(sp,{handleShowRetrievalResults:an,clientThreadId:n,turnIndex:s,responseComplete:!(pe||L)}),(_t||rt)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:R("mb-2 flex gap-3 empty:hidden",Z?"mr-1 flex-row-reverse":"-ml-2"),children:e.jsx(Uu,{alwaysShow:o,showInline:o||rt,isHovered:nt||Me,pagination:rt&&e.jsx(zu,{showInline:o||rt,currentPage:ge,onChangeIndex:At,length:I.length,className:R("self-center",I.length>1?"visible":"!invisible")}),actions:_t&&e.jsxs(e.Fragment,{children:[xt,un,hn,mn,Ss,Zt,dn]})})}),_t&&!pe?e.jsx("div",{className:"pr-2 lg:pr-0",children:e.jsx(Gu,{message:le,isFinalTurn:o})}):null,o&&!pe&&e.jsxs(e.Fragment,{children:[e.jsx(rp,{canShowInlineMessageFeedback:Y,clientThreadId:n,conversationLeafId:a,messageForRating:le,allGroupedMessages:C,currentModelId:c}),hs&&e.jsx(Xg,{followups:Gt})]})]})]})})})]}))}))]})]})}const up=Zn.memo(dp),mp=je.div`flex-shrink-0 flex flex-col relative items-end`;function hp({onChangeItemInView:t,onRequestMoreCompletions:s,onChangeRating:a,onRequestCompletion:o,clientThreadId:n,conversationLeafId:r,hideHeader:l}){const[c,d,p,u,m]=ce(n,N=>[N?.mode,J.getConversationTurns(N,r).length,J.getThreadData(N).isArchived,N?.conversationOrigin===dl.APPLE,N?.scrollToMessageId]),h=_e(),x=Xn(),g=Yu(),[b]=Ju(),T=Xu(),[S]=Qu(),v=is(),w=Js(n),_=h.store.useContentAreaDimensions(Lt.Header,N=>N?.height?N.height:void 0),A=h.store.useIsHeaderContentAreaPopulated(),B=Zu(w.id),j=c?.kind===Fe.GizmoMagicCreate?"bg-token-main-surface-primary text-token-text-primary":B,M=or(),[k,I]=i.useState(0),[F,C]=i.useState(!1);i.useEffect(()=>{x&&(k===0?I(d):!F&&d>k&&(C(!0),ye.logEvent("chatgpt_continue_conversation_first_message_sent"),W.logEvent(G.continueConversationFirstMessageSent)))},[d,k,F,x]),i.useEffect(()=>{x&&(ye.logEvent("chatgpt_continue_conversation_page_loaded"),W.logEvent(G.continueConversationPageLoaded),ye.logEvent("chatgpt_conversation_share_page_loaded"),W.logEvent(G.sharedConversationPageLoaded))},[x]);const f=i.useCallback(()=>{g({behavior:"smooth"})},[g]),P=em(n),H=M&&!p,V=tm(n,r),q=(N,U,D,K)=>[...new Array(U-N).keys()].map(Y=>{const de=Y+N;return e.jsx(up,{isFinalTurn:D(de),turnIndex:de,clientThreadId:n,conversationLeafId:r,onChangeItemInView:t,onChangeRating:a,onRequestMoreCompletions:s,onRequestCompletion:o,currentModelId:w.id,avatarClassName:j,scrollToBottom:f,scrollToMessageId:K,dateHeaderType:V(de)},de)});return e.jsxs("div",{onCopy:P,className:R("flex flex-col text-sm",H&&"pb-[120px]",_||H?null:"md:pb-9"),style:{paddingBottom:H?void 0:_},children:[!l&&v?.data&&e.jsx(Nr,{clientThreadId:n}),x&&e.jsxs(e.Fragment,{children:[e.jsx(Ws,{children:e.jsx("p",{className:"text-xs text-gray-500",children:e.jsx(E,{id:"threadLayout.sharedConversationCopyDisclaimer",defaultMessage:"This is a copy of a conversation between ChatGPT & Anonymous."})})}),d-k===0&&e.jsx("div",{className:"text-center text-xs font-semibold text-token-text-primary",children:e.jsx("button",{onClick:()=>{Gs.openModal(sm.ReportConversation),ye.logEvent("chatgpt_conversation_share_report_content_clicked",null,{location:"Static Shared Thread Page"}),W.logEvent(G.sharedConversationReportContentClicked,{location:"Dynamic Shared Thread Page"})},children:e.jsx(E,{id:"thread.reportSharedConversation",defaultMessage:"Report content"})})}),q(0,k,N=>N===k-1,m),e.jsx(Ws,{children:e.jsxs("p",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(nm,{className:"icon-xs mr-2"}),e.jsx(E,{id:"threadLayout.sharedConversationPrivateDisclaimer",defaultMessage:"Messages beyond this point are only visible to you"})]})}),q(k,d,N=>N===d-1,m)]}),!x&&q(0,d,N=>N===d-1,m),u&&b&&!S&&e.jsx(wa,{className:R("translate-y-[10px] md:translate-y-[30px]"),onClick:()=>{ye.logEvent("chatgpt_thread_scroll_to_top"),T({behavior:"smooth"})},children:e.jsx(om,{className:"icon-md text-token-text-primary"})}),!b&&e.jsx(wa,{className:R(_?null:"bottom-5",H?A?"translate-y-[-50px]":"translate-y-[-10px]":""),style:{bottom:M?"calc(var(--composer-bar_footer-current-height) + var(--composer-bar_current-height))":_},onClick:()=>{ye.logEvent("chatgpt_thread_scroll_to_bottom"),g({behavior:"smooth"})},children:e.jsx(am,{className:"icon-md text-token-text-primary"})})]})}const wa=je.button`cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-token-text-secondary border-token-border-light right-1/2 translate-x-1/2 bg-token-main-surface-primary w-8 h-8 flex items-center justify-center`,gp=60,pp=({children:t,scrollViewClassName:s,scrollAnchorTopOffset:a=0})=>{const o=i.useRef(null);return e.jsx("div",{className:"h-full",ref:o,children:e.jsx(Fa,{children:e.jsx($m,{className:"h-full",followButtonClassName:"hidden",initialScrollBehavior:"auto",scrollViewClassName:s,scroller:()=>fp(o,a)?0:1/0,children:t})})})},fp=(t,s)=>{const a=xp(t.current);if(a==null)return!1;const o=a>s,n=a<s-gp;return!o&&!n};function xp(t){if(!t)return null;const s=t.querySelector('[data-scroll-anchor="true"]');if(!s)return null;const a=s.getBoundingClientRect().top,o=t.getBoundingClientRect().top;return a-o}const Sp=ze(()=>Ge(()=>import("./or10jeufowa9j1t9.js"),__vite__mapDeps([61,1,2,3,4,5,14,62,63,64,65,55,66])).then(t=>t.OpenDebugSidebarButton)),vp=ze(()=>Ge(()=>import("./btt51di9wnsicd1p.js"),__vite__mapDeps([67,2,4,1,3,5]))),Ma=Ze({doNotShareSensitive:{id:"thread.modal.onboarding.title",defaultMessage:"Do not share sensitive materials with this application"},somethingWentWrong:{id:"thread.modal.unrecoverableError.title",defaultMessage:"Something went wrong"},tryAgainLater:{id:"thread.modal.unrecoverableError.description",defaultMessage:"We're sorry, but something went wrong. Please try again later."},resetThread:{id:"thread.modal.unrecoverableError.resetThread",defaultMessage:"Reset thread"},sharedConversationReportConversation:{id:"thread.sharedConversation.report",defaultMessage:"Report conversation"},latencyButton:{id:"thread.latencyButton",defaultMessage:"Latency"},archivedConversationDescription:{id:"thread.archivedConversationDescription",defaultMessage:"This conversation is archived. To continue, please unarchive it first."},unarchiveButton:{id:"thread.unarchiveButton",defaultMessage:"Unarchive"}});function bp({clientThreadId:t}){const s=Ua(),a=ls(t),o=ce(t,J.getGizmoId),n=async()=>{a&&(await cs.patchConversation(a,{is_archived:!1}),s.invalidateQueries({queryKey:["conversation",t]}),La.setState(r=>{const l=r.threads[a];l!=null&&(l.initialThreadData.isArchived=!1)}),Cm(s,o))};return e.jsxs("div",{className:"my-6 flex flex-col items-center justify-center gap-4",children:[e.jsx("div",{className:"px-3 text-center text-sm text-token-text-secondary",children:e.jsx(E,{...Ma.archivedConversationDescription})}),e.jsx("div",{children:e.jsx(Ot,{disabled:!a,onClick:n,icon:bm,children:e.jsx(E,{...Ma.unarchiveButton})})})]})}const yp=function({clientThreadId:t,onCreate:s,preRequestCompletion:a,hideHeader:o,hideMessages:n,hideFooter:r,hideToolsOverlay:l,messagesVerticalAlign:c="top",prependThreadChildren:d,renderEmptyState:p,prefetchSearch:u}){const m=Ea(),{data:h}=Vs(),{data:x}=ut(),g=Ys(t),b=Pa(),[T,S,v,w,_,A,B]=ce(t,me=>[me?.isLoading,J.getCurrentLeafId(me),J.hasUserMessage(me),me?.conversationTurns.length??0,J.getThreadData(me).isArchived,me?.modelId,me?J.getGizmoId(me):b]);ul(t),i.useEffect(()=>{T||(Dt(t)?Nn.addTiming("chatgpt.web.chatPage.renderNewConversation"):Nn.addTiming("chatgpt.web.chatPage.renderExistingConversation"))},[t,T]);const{setTargetedContent:j}=ur(),M=m?.includes(ml),{value:k}=Ve("2848981774"),I=rm(),F=w>=2;cr(F);const C=Dt(t)&&!F&&Bs(g),f=Dt(t)&&!v&&(Bs(g)||g?.kind===Fe.GizmoTest),H=dr(h,x).id,V=A??H,q=!!A,N=eo(V),U=zs(x?.models,V),D=im(t,g),K=lr();lm(w,t),i.useEffect(()=>{K||j(void 0)},[t,j,K,S]);const{caModal:Y,onRequestCompletion:de,onChangeItemInView:ge,onChangeRating:Z,onRequestMoreCompletions:Ae}=Vm({clientThreadId:t,currentModelId:V,defaultModelId:H,onThreadCreated:s,preRequestCompletion:a}),Ne=cm({clientThreadId:t,handleRequestCompletion:de,prefetchSearchPromise:u}),Ee=me=>k?e.jsx(Fa,{children:e.jsxs(i.Suspense,{fallback:null,children:[e.jsx(ym,{}),e.jsx("div",{className:"flex h-full flex-col overflow-y-auto",children:me})]})}):e.jsx(pp,{scrollAnchorTopOffset:o?0:jm,children:c==="bottom"?e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"flex-1"}),me]}):me});i.useEffect(()=>{document.title=D??"ChatGPT"},[D]);const Ce=dt(),we=Aa(),O=f&&!we&&!p&&!B&&!N&&!Ce,L=Xn(),X=dm(),{reset:ue,streamingContext:re,StreamingProvider:ie}=um();i.useEffect(()=>{X&&(re.setOnResetContext=()=>{ue()})},[X,ue,re]);const Ie=i.useRef(null),Re=i.useRef(null),He=i.useMemo(()=>({threadContentScrollContainerElementRef:Ie,footerRootContainerElementRef:Re}),[]);return e.jsx(Nm,{clientThreadId:t,children:e.jsxs(ie,{value:re,children:[M&&e.jsx(vp,{}),e.jsx(mm,{children:D!=null&&e.jsx("title",{children:D})}),e.jsx(hl.Provider,{value:de,children:e.jsxs(hm,{children:[e.jsxs(gm,{noKeyboard:!0,clientThreadId:t,currentModelConfig:U,className:"composer-parent flex h-full flex-col focus-visible:outline-0",children:[!n&&e.jsx(pm,{value:He,children:e.jsx(jp,{ref:Ie,children:!T&&!Ne?f?p??e.jsx(qg,{clientThreadId:t,currentModelId:V,isModelLoaded:q,onRequestCompletion:de,showChatgptHomepage:O,chatgptHomepageDisclaimer:O&&e.jsx(ea,{clientThreadId:t})}):F?Ee(e.jsxs(e.Fragment,{children:[d,e.jsx(hp,{onChangeItemInView:ge,onRequestMoreCompletions:Ae,onChangeRating:Z,onRequestCompletion:de,clientThreadId:t,conversationLeafId:S,hideHeader:o},t)]})):null:null})}),e.jsx(Cp,{ref:Re,children:_?e.jsx(bp,{clientThreadId:t}):e.jsxs("div",{children:[!O&&e.jsx(kg,{clientThreadId:t,isNewThread:C,showPromptStarters:C||!v,currentModelId:V,onRequestCompletion:de}),!r&&e.jsx("div",{className:"relative w-full px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden md:px-[60px]",children:Bs(g)&&!O&&e.jsx("div",{className:"min-h-4",children:e.jsx(ea,{clientThreadId:t})})})]})})]}),!l&&e.jsxs("div",{className:"group absolute bottom-2 end-2 z-20 flex flex-col gap-1 md:flex lg:bottom-3 lg:end-3",children:[I?e.jsxs(e.Fragment,{children:[e.jsx(Sp,{}),!1]}):null,e.jsx(fm,{})]}),Y,e.jsx(xm,{clientThreadId:t,isStaticSharedThread:!1,isDynamicSharedThread:L}),e.jsx(Sm,{}),e.jsx(vm,{conversationId:t,isActiveWindow:!we})]})})]})})},Rp=Zn.memo(yp),jp=je.div`grow flex-1 overflow-hidden @container/thread`,Cp=je.div`md:pt-0 dark:border-white/20 md:border-transparent md:dark:border-transparent w-full`;export{up as C,qg as E,Rp as M,Or as P,Ig as S,rh as T,pp as W,Nr as a,kg as b,lh as c,Ip as d,Ar as u};
//# sourceMappingURL=ka0pfyowuwrq8q81.js.map
