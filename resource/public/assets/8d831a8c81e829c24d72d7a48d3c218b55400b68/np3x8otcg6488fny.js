import{j as r,r as d,au as N,aw as R,M as F,g as ee,c as te}from"./n1tvutderx19k1zs.js";import{d as b,d_ as se,bG as ne,p as oe,g as ae,L as H,C as O,q as _,o as re,gW as ie}from"./efuue3ezs0mj4ucx.js";import{FormattedText as le}from"./jtuse4p9muknklsg.js";import{gB as ce,k4 as ue,k5 as fe,jG as Y}from"./c87uv1mutc86tiqk.js";import{g as pe}from"./gioq1d8xhsi51m2p.js";import"./b4a5otpy41fdr5l3.js";import"./gffup1245353c03l.js";import"./d995zjnlydagrugw.js";import"./bh0nczk7jf5nipy7.js";import"./bdh1ots4hr6db7w1.js";import"./krj910mzqcd0aq73.js";import"./nj0cdl0bjojh2xn6.js";import"./o97za21c5v9glw28.js";import"./bei4zk14rknuqpj2.js";import"./euijvuwb3rp9htgu.js";import"./gr8do7n6orkpzwtb.js";import"./n24ph5vohl8fszcu.js";import"./gb5z15gr4uo6e2ww.js";import"./jnjq4wt6v0sb6ord.js";import"./ou38yrswq97w1ctq.js";const S=24,z=8,de="_fadeIn_17mok_10",me="_fade_17mok_10",he="_markdown_17mok_15",I={fadeIn:de,fade:me,markdown:he},W=t=>Array.from(t.match(/\s*\S+(?:\s+|$)/g)??[]),D=20,L=t=>({"--delay":`${t}ms`}),G=({children:t,delay:s,onComplete:o})=>{const a=W(t);return r.jsx(r.Fragment,{children:a.map((e,n)=>r.jsx("span",{className:b(I.fadeIn,"whitespace-prewrap"),style:L(s+n*D),onAnimationEnd:n===a.length-1?o:void 0,children:e},n))})},A=({tag:t,className:s,isDisabled:o=!1,onComplete:a,children:e})=>{if(o)return r.jsx(t,{className:s,children:e});let n=0;return r.jsx(t,{children:typeof e=="string"?r.jsx(G,{delay:n,onComplete:a,children:e}):Array.isArray(e)?e.map((i,u)=>{const l=n;return typeof i=="string"?n+=W(i).length*D:n+=D,typeof i=="string"?r.jsx(G,{delay:l,onComplete:u===e.length-1?a:void 0,children:i},u):r.jsx("span",{className:I.fadeIn,style:L(n),onAnimationEnd:a,children:i},u)}):r.jsx("span",{className:I.fadeIn,style:L(n),onAnimationEnd:a,children:e})})},ge=({children:t,onMeasure:s})=>{const[{height:o},a]=ce();return se(()=>{o&&s?.(o)},[o]),r.jsx("div",{className:"flex",ref:a,children:t})};var $=(t=>(t.STATIC="static",t.ENTER="enter",t.STAGE="stage",t))($||{});const xe=({showStreamPreviewWhenCollapsed:t=!1,isAnimationComplete:s=!1,isExpanded:o=!1,isLast:a=!1,index:e,content:n,onMeasure:i,onAnimationComplete:u})=>{const l=a||o;let f="static",g="static";a&&!s?(f="enter",g="stage"):g="static";const E=d.useRef(null);E.current=()=>{u?.("enter")};const C=d.useCallback(()=>{E.current?.()},[]),y=f==="static",T=d.useMemo(()=>({pre:({children:m})=>r.jsx(A,{tag:"pre",isDisabled:y,onComplete:C,children:m}),li:({children:m})=>r.jsx(A,{tag:"li",isDisabled:y,onComplete:C,children:m}),p:({children:m})=>r.jsx(A,{tag:"p",isDisabled:y,onComplete:C,children:m})}),[y,C]);return r.jsx(N.div,{variants:{static:{opacity:1,scale:1,position:"static",translateY:0},enter:{position:"static",translateY:0,scale:1,opacity:1},stage:{position:"absolute",translateY:-S,scale:.95,opacity:0}},initial:g,animate:f,exit:t&&!o?{opacity:0,pointerEvents:"none",position:"absolute",translateY:S,filter:"blur(8px)"}:void 0,style:{zIndex:e},transition:s||f==="static"?{duration:0}:{type:"spring",bounce:.05},className:b("top-0 origin-left text-token-text-secondary",!l&&"pointer-events-none"),onAnimationComplete:m=>m!=="enter"&&u(m),children:r.jsx(ge,{onMeasure:m=>{i(m*(g==="stage"?1/.95:1))},children:r.jsx(le,{className:b(I.markdown,"text-token-text-secondary"),componentOverrides:T,children:n})})})},Ce=({isExpanded:t=!1,isExpandDisabled:s=!1,isComplete:o=!1,activeHeadline:a,finishedText:e,onToggleExpanded:n})=>r.jsxs("button",{disabled:s,onClick:n,className:"relative flex w-full items-center",children:[r.jsx(R,{mode:"popLayout",children:r.jsx(N.span,{className:"text-start",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,overflow:"hidden",whiteSpace:"nowrap"},transition:{duration:.3},children:r.jsx("span",{className:b(!o&&"loading-shimmer"),children:o?e||r.jsx(F,{id:"/4+t6i",defaultMessage:"Reasoned"}):!t&&a?a:r.jsx(F,{id:"Guu3mD",defaultMessage:"Reasoning"})})},a)}),!s&&r.jsx("span",{children:r.jsx(ne,{className:b("icon-sm text-token-text-tertiary transition-transform",t&&"rotate-90")})})]});var v=(t=>(t.HEADLINE="headline",t.COT="CoT",t))(v||{});const j=t=>({key:t,type:"CoT",content:"",isComplete:!0}),B=(t,s=!1)=>{const o=[],a=t.split(/( {2}\n)|(\n\n)/).filter(i=>i!=null&&i.trim());if(!s&&a.length<2)return o;let e=j(o.length),n=!1;for(let i=0;i<a.length;i++){const l=a[i].trim();if(l.toLowerCase()==="none")continue;const f=l.match(/^\*\*(.*)\*\*$/);if(f)e.content.trim()&&(e.isComplete=!0,o.push(e),e=j(o.length)),o.push({key:o.length,type:"headline",content:f[1]??"",isComplete:!0}),e=j(o.length);else if(l){if(l.startsWith("```"))if(!n)e.isComplete=!0,o.push(e),e=j(o.length),n=!0;else{e.content+=e.content?`
${l}`:l,e.isComplete=!0,o.push(e),e=j(o.length),n=!1;continue}e.content.trim()&&!l.startsWith("\\[")&&!l.startsWith("\\(")&&!n&&(e.isComplete=!0,o.push(e),e=j(o.length)),e.content+=e.content?`
${l}`:l,e.isComplete=!1}}return e.content.trim()&&(e.isComplete=s,o.push(e)),o};class ye{setChunks;buffers=[];rawChunks=[];bufferedCoT=[];constructor(s){this.setChunks=s}update(s,o,a){const e=this.bufferedCoT;this.bufferedCoT=oe(e,n=>{const{key:i,type:u,content:l}=this.rawChunks[s];n[s]??={key:i,type:u,content:"",isComplete:a},n[s].key=i,n[s].type=u,n[s].content=l.slice(0,o),n[s].isComplete=a}),this.bufferedCoT!==e&&this.setChunks(this.bufferedCoT)}setText(s,o){this.rawChunks=B(s);for(let a=0;a<this.rawChunks.length;a++){const e=this.rawChunks[a],n=this.buffers[a-1],i=this.buffers[a],u=o&&a===this.rawChunks.length-1,l=e.content.length;i?i.setTargetLength(l,u):this.buffers[a]=new ue(l,u,n,(f,g)=>this.update(a,f,g))}}isComplete(){return this.buffers.every(s=>s.isComplete())}destroy(){for(const s of this.buffers)s.destroy()}}const ke=(t,s)=>{const[o,a]=d.useState(()=>B(t,!s)),e=d.useRef(null);e.current==null&&(e.current=new ye(a)),d.useEffect(()=>()=>{e.current!=null&&(e.current.destroy(),e.current=null)},[]),d.useEffect(()=>{e.current?.setText(t,s)},[t,s]);const n=!s&&e.current.isComplete();return{chunks:o,isComplete:n}};var je=fe,Te=ae;function be(t){return t&&t.length?je(t,Te):0}var Ee=be;const ve=ee(Ee),Ne={duration:.3,ease:"easeInOut"},Ie=({isStreaming:t,showStreamPreviewWhenCollapsed:s=!1,finishedText:o,summaryText:a,onAnimationComplete:e})=>{const{chunks:n,isComplete:i}=ke(a,t),[u,l]=d.useState(!t),[f,g]=d.useState(()=>{const c=H.getItem(O.ExpandSummarizedCoT);return c==null?!s:t?!!c:!1}),E=()=>{const c=!f;g(c),t&&H.setItem(O.ExpandSummarizedCoT,c)},[C,y]=d.useState(()=>new Map),[T,m]=d.useState(()=>t?null:_(n)?.key??null),K=d.useMemo(()=>{const c=[];for(let p=0;p<n.length;p++){const h=n[p];h.content&&h.type===v.COT&&h.isComplete&&c.push(p)}return c.find((p,h)=>T!=null&&p>T||h===c.length-1?p:!1)??-1},[n,T]),q=(c,p)=>{y(h=>{const k=new Map(h);return k.set(c,p),k})},M=Array.from(C.values()),P=_(M),w=n.slice(0,K+1),U=w.findLast(c=>c.type===v.HEADLINE&&c.isComplete)?.content;let x=w.filter(c=>c.type===v.COT);s&&!f&&(x=x.slice(-1));const X=(c,p)=>{p===$.ENTER&&(m(c),c===_(x)?.key&&(l(i),i&&e?.()))};d.useEffect(()=>{i&&(!x.length||!f&&!s)&&e?.()},[i,x]);const J=!u&&s||f,Q=ve(M)+(M.length-1)*z,V=u?"auto":f?Q:s?P:0,Z=s&&w.length<2;return r.jsxs(N.div,{className:"flex flex-col",children:[r.jsx(Ce,{activeHeadline:U,finishedText:o,onToggleExpanded:E,isExpanded:f,isExpandDisabled:Z,isComplete:i}),r.jsx(R,{children:J&&r.jsxs(N.div,{className:"relative z-0 whitespace-pre-wrap pl-4",initial:u?{opacity:0,height:0,overflowY:"hidden"}:!1,animate:{opacity:1,height:V},exit:{height:0,opacity:0,pointerEvents:"none",overflowY:"hidden",translateY:-S},transition:Ne,children:[r.jsx("div",{className:"absolute bottom-0 left-0 top-2 w-[1px] rounded-full bg-token-border-light"}),r.jsx("div",{className:"relative mt-2 flex h-full flex-col",style:{gap:z},children:r.jsx(R,{children:x.map(({content:c,key:p},h)=>r.jsx(xe,{index:p,content:c,isLast:x.length-1===h,onAnimationComplete:k=>X(p,k),onMeasure:k=>q(p,k),isAnimationComplete:u,isExpanded:f,showStreamPreviewWhenCollapsed:s},p))})})]})})]})},Ue=({messages:t,isStreaming:s})=>{const o=te(),a=t.map(({message:n})=>re(n)).join(`

`);d.useEffect(()=>{if(s)for(const{message:n}of t)Y.addDelayedRenderingMessage(n.id)},[s,t]);const e=()=>{for(const{message:n}of t)Y.removeDelayedRenderingMessage(n.id)};return r.jsx(Ie,{showStreamPreviewWhenCollapsed:ie("3625329303"),finishedText:pe(o,t),summaryText:a,isStreaming:s,onAnimationComplete:e})};export{Ie as CoT,Ue as CoTMessage};
//# sourceMappingURL=np3x8otcg6488fny.js.map
