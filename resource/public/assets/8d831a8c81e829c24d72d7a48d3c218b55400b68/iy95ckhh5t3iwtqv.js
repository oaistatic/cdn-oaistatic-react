const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/or10jeufowa9j1t9.js","assets/efuue3ezs0mj4ucx.js","assets/n1tvutderx19k1zs.js","assets/root-gmm606mb.css","assets/c87uv1mutc86tiqk.js","assets/conversation-small-nranh1cg.css","assets/duvx3jmzsju7uw87.js","assets/miws4tkw2vsomlr4.js","assets/fzrn137102spawew.js","assets/e9lafxuzyeh4418f.js","assets/pevkepdko1ob7sgk.js","assets/oszw1knsi7z008c4.js","assets/o97za21c5v9glw28.js","assets/m75rx4rq59lcbwba.js","assets/d0o40xyie6fu93kf.js","assets/mzkxlhrlmxhntkvn.js","assets/oqu6s9fqa0pl50wo.js","assets/nlnd08umjle7ujfz.js","assets/lvedelvd2wa5y0ah.js","assets/kykf41pnxj3u2jkm.js","assets/jy24clh9s5sbm6a3.js","assets/d995zjnlydagrugw.js","assets/bh0nczk7jf5nipy7.js","assets/ishe91rr928a0b40.js","assets/kzmahix4jeiri6hm.js","assets/m89x2zftpo6hrypr.js","assets/bzaypvhehxbw5ucz.js","assets/ka0pfyowuwrq8q81.js","assets/dnxtg4alg3s338gf.js","assets/c1vsiyure2yziq8u.js","assets/ecs2ptmt646v6gvn.js","assets/gb5z15gr4uo6e2ww.js","assets/ege6d8muw87nvcfp.js","assets/npeqg3baimzobwf1.js","assets/abqqg32xty1y9c6f.js","assets/hrbqrkniwjlirj93.js","assets/k9xm49otsb4eors5.js","assets/b197edpr4dhgtcvc.js","assets/kifwyvxkhdk7syb7.js","assets/gy64pge8qevmvg7e.js","assets/ks79pfkjilmvsi5m.js","assets/gr8do7n6orkpzwtb.js","assets/m3i9t52w2bjqxoks.js","assets/fmtdc70w9bxe7ngz.js","assets/ir7h5xb5yr2dttye.js","assets/n2mw1xqoowews9pe.js","assets/gohrg29ji6orhvga.js","assets/oy248fbbcvutqmly.js","assets/bk8slwxjkdlmxjxm.js","assets/gffup1245353c03l.js","assets/bxe8lsbbwu66fmec.js","assets/njjifkipn1jlpz6u.js","assets/coj1pqvvjvheacvo.js","assets/igju9slnzvk7li29.js","assets/oqdx4hpmwxvfh9gy.js","assets/oq09nie6yqvskddc.js","assets/pbfah61ruv3xvhxr.js","assets/btagl6w1gub4aw61.js"])))=>i.map(i=>d[i]);
import{dp as We,ee as ue,n as Z,al as H,s as re,r as oe,ac as He,bw as $e,D as Ee,W as at,ae as ie,X as it,J as hs,K as nt,bZ as rt,Y as fe,Z as qe,h5 as ot,a0 as xs,bs as Ve,bt as Qe,bU as Ke,d$ as vs,B as ne,bH as W,aE as Ye,au as Pe,bd as Xe,bY as ve,ep as js,j as ce,ef as lt,bX as ct,bo as ys,d as le,h4 as dt,a7 as Se,dq as bs,bW as V,dm as Ze,by as Ms,bu as _e,P as ws,a as Ps,c5 as je,b_ as ut,bJ as Ss,b as mt,e0 as Ts,fB as ft,de as ye,t as gt,fI as ks,$ as pt,gR as ht,F as xt,aL as vt,L as is,C as ns,gH as jt,m as yt,G as bt,eX as Mt,fw as wt,g1 as Pt,go as St,gp as Tt}from"./efuue3ezs0mj4ucx.js";import{v as Te,R as Cs,r as m,j as e,c as $,a as Is,M as g,e as ge,aw as kt,au as Ns,z as Ct,f as It}from"./n1tvutderx19k1zs.js";import{a6 as Nt,bP as _t,kW as Gt,ja as _s,kX as Gs,A as As,kY as Ls,U as me,iC as O,b as zs,bJ as we,cV as Rs,gn as Je,fl as At,fa as Lt,da as zt,dh as Fe,bI as A,fb as ke,fc as te,fn as be,fj as Me,fe as es,jq as Us,kZ as Rt,jr as Es,js as Ut,k_ as Et,dQ as ae,fd as Ft,k$ as Oe,ah as Ot,dO as Bt,f4 as Dt,dR as Fs,fs as Wt,fr as Ht,gr as $t,iy as Os,l0 as qt,cm as Vt,iz as Bs,iA as Ds,iD as Qt,l1 as Kt,hu as Yt,f6 as Xt,iE as Zt,cl as Be,iF as Jt,j2 as ea,l2 as rs,j8 as Ge,j9 as sa,dj as os,d2 as Ws,l3 as ta,l4 as aa,j5 as ia,d3 as na,fN as ra,l5 as ls,bK as oa,T as la,gM as ca,l6 as da,dS as ua,l7 as ma,cf as fa,gm as ga,iH as cs,l as pa,l8 as ha,l9 as xa,d as va,la as ja,lb as ds,lc as us,ld as ya,e2 as ba,dT as ms,d0 as Ma}from"./c87uv1mutc86tiqk.js";import{i as wa,M as Hs,A as de,G as Pa,a as Sa,b as fs,s as Ta,S as ka,c as Ca,g as Ia,d as Na}from"./nlnd08umjle7ujfz.js";import{f as _a}from"./m89x2zftpo6hrypr.js";import{u as Ga}from"./bzaypvhehxbw5ucz.js";import{M as $s}from"./ka0pfyowuwrq8q81.js";import{a as qs}from"./jy24clh9s5sbm6a3.js";import{C as Vs}from"./ege6d8muw87nvcfp.js";import{u as Qs}from"./bh0nczk7jf5nipy7.js";import{i as De}from"./hrbqrkniwjlirj93.js";import{d as Aa}from"./k9xm49otsb4eors5.js";import{S as Ks}from"./lvedelvd2wa5y0ah.js";import{S as La}from"./duvx3jmzsju7uw87.js";import{G as za}from"./njjifkipn1jlpz6u.js";import{S as Ra}from"./coj1pqvvjvheacvo.js";import{F as Y,a as X,b as Ae,c as Ua,G as Ea}from"./oqu6s9fqa0pl50wo.js";import{G as Fa}from"./igju9slnzvk7li29.js";import{S as Oa}from"./oqdx4hpmwxvfh9gy.js";import{CanvasFocusedViewManager as Ba}from"./pbfah61ruv3xvhxr.js";import{G as Da}from"./dnxtg4alg3s338gf.js";function Wa(s,t){const a=H.getThreadCurrentLeafId(s),n=re.getTree(oe(s)),i=[];let r=n.getNodeByIdOrMessageId(a);for(;r!=null&&(t==null||r.id!==t);)i.unshift(r.message),r=r.parentId!==""?n.getNodeByIdOrMessageId(r.parentId):void 0;return i}function Ha(s){return s.filter(n=>n.recipient==="gizmo_editor.update_behavior").flatMap(n=>n.content.content_type==="text"?n.content.parts:n.content.content_type==="code"?[n.content.text]:[]).map(n=>JSON.parse(n)).reduce((n,i)=>({...n,...i}),{})}async function $a(s){let t;for(const a of s)if(a.author.name==="gizmo_editor.generate_profile_pic"){const n=rt.getImageAssetPointers(a);n.length>0&&(t=n.at(-1))}if(t!=null){const a=_t(t.asset_pointer),n=await He.getFileDownloadLink(a);if(n.status===$e.Success)return{id:a,permalink:n.download_url}}}async function qa(s,t,a,n){const i=Wa(t,n),r=Ha(i);let o=await $a(i);if(De(r)&&o==null)return;const{name:c,context:f,description:l,profile_pic_file_id:M,prompt_starters:w}=r;if(M!=null)try{const u=await He.getFileDownloadLink(M,s.id);u.status===$e.Success&&(o={id:M,permalink:u.download_url})}catch(u){Ee.addError(new Error("Error while retrieving profile pic in update",{cause:u})),a.warning("Something went wrong updating your GPT's profile picture.",{duration:3})}const d={name:typeof c=="string"?c:void 0,description:typeof l=="string"?l:void 0,instructions:typeof f=="string"?f:void 0,promptStarters:Array.isArray(w)?w:void 0,profilePictureId:o?.id,profilePictureUrl:o?.permalink};return at(d,u=>u!=null)}function Va(s){const t=new Set;for(const f of s.tools)t.add(f.type);const a=s.name??"",n=s.description??"",i=s.instructions??"",r=Array.from(t).join(","),o=a===""&&n===""&&i==="",c=s.profilePictureUrl!=null;return o?`The GPT you are about to has the following abilities: ${r}.`:`This is the GPT's current set of fields:

name: ${a}

description: ${n}

context: ${i}

abilities: ${r}

${c?"The GPT has a profile picture.":"This GPT does not have a profile picture. You must generate a profile picture when you next update your behavior."}
`}const Qa=10;function Ys(s,t,a,n){const i=a.current,r=n.current;if(We(i,r))return;const o={};i.name!==r?.name&&(o.name=i.name),(i.description??"")!==(r?.description??"")&&(o.description=i.description??""),i.instructions!==(r?.instructions??"")&&(o.context=i.instructions??"");const c=new Set(r?.files?.map(d=>d.file_id)??[]),f=new Set(i.files?.map(d=>d.file_id)??[]),l=(i.files??[]).filter(d=>!c.has(d.file_id)),M=(r?.files??[]).filter(d=>!f.has(d.file_id));if(De(o)&&l.length===0&&M.length===0)return;const w=[];if(!De(o)){const d=`Explicitly update the GPT's behavior to the following exact fields:

    ${JSON.stringify(o,null,2)}

    "Do not call update_behavior yet. Instead, use these updated fields as the GPT's current behavior, and in the next call to update_behavior, incorporate these changes."
    `;w.push(ue.getTextAsMessage(d,Z.System))}if(M.length>0&&w.push(ue.getTextAsMessage(`The user has removed the following files from the GPT. You can no longer reference these files: ${M.map(d=>d.file_id).join(", ")}`,Z.System)),l.length>0){const d=l.slice(0,Qa);w.push(ue.getTextAsMessage(`The user is adding these files to the GPT. The GPT may reference these files. The file IDs are: ${d.map(u=>u.file_id).join(", ")}`,Z.System,{attachments:d.map(u=>({id:u.file_id,name:u.name,size:u.size}))}))}w.length>0&&H.updateTree(s,d=>{let u=d.getNodeByIdOrMessageId(t).parentId;for(const j of w){const h=Te();d.insertNodeBefore(t,{id:h,children:[],parentId:u,message:j,metadata:{isClientCreatedSystemMessage:!0}}),u=h}})}function Ka(s,t,a){if(a.length===0)return;const n=Te(),i=`The user is uploading files in their next message. If you need to reference these in calls to update_behavior, you will use the following File ID(s), in order: ${a.map(r=>`"${r.fileId}"`).join(", ")}`;H.updateTree(s,r=>{const o=r.getNodeByIdOrMessageId(t).parentId;r.insertNodeBefore(t,{id:n,children:[],parentId:o,message:ue.getTextAsMessage(i,Z.System),metadata:{isClientCreatedSystemMessage:!0}})})}function Ya(s,t){const a="Remember, you should be calling either update_behavior or generate_profile_pic after most messages from the user. Your personality should be neutral and separate from the GPT you are creating.",n=H.getThreadCurrentLeafId(s),i=re.getTree(oe(s));let r=i.getNodeByIdOrMessageId(n);for(;r!=null&&r.message.author.role!==Z.User;){if(r.message.content.content_type==="text"&&r.message.content.parts[0]===a)return;r=r.parentId!==""?i.getNodeByIdOrMessageId(r.parentId):void 0}H.updateTree(s,o=>{const c=o.getNodeByIdOrMessageId(t).parentId;o.insertNodeBefore(t,{id:Te(),children:[],parentId:c,message:ue.getTextAsMessage(a,Z.System,{exclude_after_next_user_message:!0}),metadata:{isClientCreatedSystemMessage:!0}})})}function Xa(s,t){H.initThread(s,{kind:ie.GizmoMagicCreate,gizmo_id:void 0,behavior_overrides:t});const{data:a}=it(),{data:n}=hs(),i=nt(s,c=>c?.modelId)??Nt(a,n).id,r=Qs({clientThreadId:s});return async(c,f,l)=>{if(l.length===0)return;fe(s,w=>{qe.updateTree(w,(d,u)=>{for(const j of l)u=d.addMessageNode(u,ot(j),{isClientCreatedSystemMessage:!0}).id;return u})}),Ys(s,re.getCurrentLeafId(oe(s)),c,f);const M={conversationMode:{kind:ie.GizmoMagicCreate,gizmo_id:c.current.id,behavior_overrides:t}};r({model:i,completionType:xs.Next,parentNodeId:re.getCurrentLeafId(oe(s)),metadata:{},completionMetadata:M})}}const Za="Generate a new profile picture for this GPT using gizmo_editor generate_profile_pic. Do not prompt the user for any clarification. Do not send extra text outside of the tool function call. DO NOT CALL update_behavior or otherwise update GPT behavior in your response.",Ja=Ve(()=>Qe(()=>import("./or10jeufowa9j1t9.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12])).then(s=>s.DebugConversationSidebar));function ei(s,t){m.useEffect(()=>{const a=re.getTree(oe(s));if(a.findNode(o=>o.message.author.role===Z.User||o.metadata?.isClientCreatedSystemMessage===!0)||(fe(s,o=>{qe.deleteNodesByFilter(o,c=>c.metadata?.isPlaceholderTemplateAssistantWelcomeMessage===!0)}),t==null||t.length===0))return;const i=H.getThreadCurrentLeafId(s);if(!a.hasNodeOrMessageId(i))return;const r=Te();H.updateTree(s,o=>{o.addNode(r,t,i,Z.Assistant,{isPlaceholderTemplateAssistantWelcomeMessage:!0})}),H.setThreadCurrentLeafId(s,r)},[s,t])}function si(s,t,a){zs(s,{kind:ie.GizmoMagicCreate,gizmo_id:t.id,behavior_overrides:a}),m.useEffect(()=>{fe(s,i=>{i.mode={kind:ie.GizmoMagicCreate,gizmo_id:t.id,behavior_overrides:a}})},[s,t.id,a]);const[n]=m.useState(()=>{const i=t.id==null,r=t.id!=null&&t.name!==""&&t.description!=null&&t.instructions!==""&&t.profilePictureUrl!=null;return i?`Hi! I'll help you build a new GPT. You can say something like, "make a creative who helps generate visuals for new products" or "make a software engineer who helps format my code."

What would you like to make?`:r?`Welcome back! Is there anything ${t.name} should be doing better? Anything you'd like to change?`:"You're back! Let's continue where we left off..."});ei(s,n)}function ti({gizmoEditorData:s,updateGizmo:t,clientThreadId:a,gizmoEditorDataRef:n,magicMakerBehaviorOverrides:i,magicMakerConversationGizmoEditorDataRef:r,requireGizmoId:o}){const c=m.useMemo(()=>({gizmoEditorData:s,gizmoId:s.id,mode:"magic",behaviorOverrides:i,getGizmoId:o}),[o,s,i]),f=Gt(d=>d.files.filter(u=>u.status===O.Ready&&u.gizmoId!=null)),l=m.useCallback((d,u)=>{Ka(d,u,f),Ys(d,u,n,r),Ya(d,u),t(j=>({...j,files:[...j.files??[],...Ke(f.map(h=>h.fileId!=null&&{file_id:h.fileId,name:h.file.name,size:h.file.size,type:_s(h.file),last_modified:h.file.lastModified,file_size_tokens:h.fileSpec?.fileTokenSize}))]})),r.current=Gs(n.current)},[f,n,r,t]),M=As(d=>d.activeSidebar),w=vs();return e.jsx(Ls.Provider,{value:c,children:e.jsxs("div",{className:"relative flex h-full grow overflow-auto",children:[e.jsx("div",{className:"grow",children:w?e.jsx("div",{className:"contents",style:{"--screen-height-override":"100%"},children:e.jsx(qs,{clientThreadId:a,preRequestCompletion:l,children:e.jsx(Vs,{hideHeader:!0,embedded:!0})})}):e.jsx($s,{clientThreadId:a,preRequestCompletion:l,hideHeader:!0,prependThreadChildren:e.jsx("div",{className:"h-8"})})}),M==="debug"&&e.jsx(Ja,{clientThreadId:a,slideOver:!1,onClose:()=>me.toggleActiveSidebar("debug"),isOpen:!0})]})})}const ai=Cs.memo(ti);function ii({gizmo:s,updateGizmo:t,publishedGizmo:a,promoteGizmo:n,appealGizmo:i,setAppealState:r,showActionsModal:o,shareOnly:c,onClose:f}){const[l,M]=m.useState({type:"privacy"});return l.type==="privacy"?e.jsx(ri,{gizmo:s,updateGizmo:t,publishedGizmo:a,promoteGizmo:n,appealGizmo:i,setAppealState:r,setStep:M,showActionsModal:o,shareOnly:c,onClose:f}):e.jsx(oi,{publishedGizmo:l.publishedGizmo,onClose:f})}function ni(s){return s?A.Workspace:A.Link}function ri({gizmo:s,publishedGizmo:t,updateGizmo:a,promoteGizmo:n,appealGizmo:i,setAppealState:r,setStep:o,showActionsModal:c,shareOnly:f,onClose:l}){const[M,w]=m.useState(!1),d=we(Rs.isBusinessWorkspace),u=$(),j=ne(),[h,P]=m.useState(Je(s)?ni(!!d):s.sharingRecipient),k=Is(),T=wa(h,s.sharingTargets),{data:b,isLoading:L}=At(),x=Lt(),[p,C]=m.useState(t!=null&&t.gizmo.display.categories.length>0?x.data?.categories.find(y=>y.id===t.gizmo.display.categories[0])?.id:void 0);m.useEffect(()=>{C(t?.gizmo.display.categories[0])},[t?.gizmo.display.categories]);const[I,U]=m.useState(void 0),G=m.useRef(zt((y,N)=>Fe.generateCategory(y,N),1e3)),E=b?.is_verified?void 0:u.formatMessage({id:"qUMu4e",defaultMessage:"To publish your GPTs to the Explore GPTs page, set up your builder profile in the user settings page."});h===A.Marketplace&&E!=null&&!L&&P(A.Link);const B=d&&!s.sharingTargets?.some(y=>y.recipient===A.Link),z=ke(s,h,p),F=z.includes(te.MissingPublicActionPrivacyPolicyURL),Q=s.tools.find(y=>y.type===W.JIT_PLUGIN&&!y.metadata.privacy_policy_url),q=we(y=>y.currentWorkspace),K=Ye();m.useEffect(()=>{let y=!0;return(async()=>{try{if(p!=null)return;const N=await G.current(s.name,s.instructions);y&&p==null&&(N?C(N.id):U(!0))}catch{y&&p==null&&U(!0)}})(),()=>{y=!1}},[s.instructions,s.name,K,p]);const{value:pe}=Pe("4226692983");return e.jsx(Xe,{type:"success",isOpen:!0,onClose:l,title:e.jsx(g,{id:"9viumf",defaultMessage:"Share GPT"}),showCloseButton:!0,primaryButton:T?e.jsx(ve,{color:"primary",disabled:z.length>0,loading:M,onClick:async()=>{try{if(w(!0),f){if(!t?.gizmo.id){j.danger(u.formatMessage({id:"QYVEx8",defaultMessage:"Error sharing GPT"}));return}const y=await Fe.shareGizmo(t.gizmo.id,p?{sharing:be(h,[],Me),categories:[p]}:{sharing:be(h,[],Me)});y.error?(j.warning(u.formatMessage({id:"tmIKmp",defaultMessage:"Unable to share GPT"})),a({sharingTargets:y.sharing_targets}),r({gizmoId:t.gizmo.id,sharingRecipient:h,categories:t.gizmo.display.categories,moderationType:Hs.PublishBlocked,sharingTargets:y.sharing_targets,showModal:de.AppealAvailable})):(k.setQueryData(["gizmo",{gizmoId:t.gizmo.id},{draft:!1}],N=>y.resource),a(N=>({...N,sharingRecipient:h})),j.success(u.formatMessage({id:"SWSzcY",defaultMessage:"Sharing settings updated"})),l())}else{const y=await n({recipient:h,subjects:be(h,[],Me)},p);y?(o({type:"published",publishedGizmo:y}),a(N=>({...N,id:y.gizmo.id,sharingRecipient:h})),y.gizmo.live_version!=null&&a({liveVersion:y.gizmo.live_version}),j.success(u.formatMessage({id:"R5zko1",defaultMessage:"GPT published"}),{testId:"gpt-published-toast"})):(j.warning(u.formatMessage({id:"uf7WYw",defaultMessage:"Unable to publish GPT"})),l())}}finally{w(!1)}},"data-testid":"save-gizmo-button",children:e.jsx(g,{id:"SW4DG4",defaultMessage:"Save"})}):pe?e.jsx(e.Fragment,{children:e.jsx(ve,{color:"primary",onClick:async()=>{await i(h,p)},children:e.jsx(g,{id:"bBmLUr",defaultMessage:"Appeal"})})}):null,secondaryButton:t?e.jsx(ve,{color:"secondary",onClick:y=>es(t,j,y,u.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"})),children:e.jsx(g,{id:"wvL15a",defaultMessage:"Copy link"})}):null,children:e.jsxs("div",{className:"mx-[-16px] flex flex-col gap-3 text-sm",children:[e.jsx("div",{className:"space-y-1.5",children:e.jsxs(Us,{value:h,onValueChange:y=>P(y),children:[s.sharingTargets&&s.sharingTargets.map((y,N)=>e.jsx(Le,{value:y.recipient,disabled:y.recipient===A.Marketplace&&E!=null,tooltipText:y.recipient===A.Marketplace?E??u.formatMessage({id:"0Rcb4e",defaultMessage:"Your GPT will appear in the Explore GPTs page"}):void 0,shareLevel:y.recipient},N)),B&&e.jsxs(e.Fragment,{children:[e.jsx(Le,{value:A.Link,disabled:!0,tooltipText:u.formatMessage(gs.workspaceDisabledHint),shareLevel:A.Link,workspaceName:q?.name}),e.jsx(Le,{value:A.Link,disabled:!0,tooltipText:u.formatMessage(gs.workspaceDisabledHint),shareLevel:A.Marketplace,workspaceName:q?.name})]})]})}),F&&e.jsx("div",{className:"text-xs text-red-500",children:e.jsx(g,{id:"/iw1Iv",defaultMessage:"Public actions require valid privacy policy URLs. Click <fixlink>here</fixlink> to update.",values:{fixlink:y=>e.jsx("button",{onClick:()=>{c(Q?.metadata.action_id)},className:"underline",children:y})}})}),h!==A.Private&&e.jsx(Pa,{gizmo:s,category:p,categories:h===A.Marketplace?x.data?.categories??[]:void 0,onCategoryChange:h===A.Marketplace?y=>C(y.id):void 0}),h===A.Marketplace&&(I?e.jsx("div",{className:"text-xs text-red-500",children:e.jsx(g,{id:"tpC3ui",defaultMessage:"There was an error updating the list of categories"})}):null),!T&&pe&&e.jsx("div",{className:"flex items-center justify-between text-sm text-token-text-secondary",children:e.jsx(g,{id:"jLCMMV",defaultMessage:"Because this GPT previously may have violated our policies, you will have to submit an appeal to make it available at this level."})})]})})}function oi({publishedGizmo:s,onClose:t}){const a=Rt(s),n=$(),i=ne();return e.jsx(Xe,{type:"success",isOpen:!0,onClose:t,title:e.jsx(g,{id:"rCRRmx",defaultMessage:"Settings Saved"}),showCloseButton:!0,primaryButton:e.jsx(ve,{color:"primary",as:"link",to:a,children:e.jsx(g,{id:"lyZz44",defaultMessage:"View GPT"})}),children:e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"flex gap-1 rounded bg-token-main-surface-secondary px-2 py-1",children:[e.jsx("div",{className:"line-clamp-1 text-ellipsis break-all",children:a}),e.jsx("button",{onClick:r=>{es(s,i,r,n.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"}))},className:"text-token-text-secondary transition hover:text-token-text-primary","data-testid":"copy-saved-gpt-url-button",children:e.jsx(js,{className:"icon-sm"})})]})})})}const gs=ce({workspaceDisabledHint:{id:"gizmo.workspaceDisabledHint",defaultMessage:"Your workspace administrator has disabled this setting"}});function Le({shareLevel:s,workspaceName:t,value:a,disabled:n=!1,tooltipText:i}){const r=m.useId();return e.jsx(lt,{disabled:i==null,label:i,side:"top",children:e.jsxs(Es,{id:r,value:a,disabled:n,className:"flex h-14 w-full cursor-pointer flex-row items-center justify-between gap-2 rounded-md px-3 py-4 font-semibold hover:bg-token-main-surface-secondary",children:[e.jsx("label",{htmlFor:r,className:"flex cursor-pointer items-center gap-1",children:e.jsx(Sa,{shareLevel:s,workspaceName:t??"",hasInviteSharing:!1})}),e.jsx(Ut,{children:e.jsx(ct,{className:"icon-lg mr-1"})})]})})}function Xs(s){window.history.length>1?s(-1):s(Et())}function li({gizmo:s,publishedGizmo:t,isUpsertLoading:a,isPromoteLoading:n,isUploadingProfilePic:i,isGeneratingProfilePic:r,updateGizmo:o,promoteGizmo:c,appealGizmo:f,setAppealState:l,showActionsModal:M}){const w=Se(),d=s!=null?ke(s):[];(s==null||n||a)&&d.push(te.Loading),i&&d.push(te.UploadingProfilePic),r&&d.push(te.GeneratingProfilePic);const u=Je(s),[j,h]=m.useState(!1),[P,k]=m.useState(!1),T=s.sharingRecipient?fs[s.sharingRecipient]:fs.private,b=n||a;return e.jsxs(e.Fragment,{children:[u?e.jsx(ae,{color:"primary",onClick:()=>h("promote"),loading:a,disabled:b||s.id===void 0||d.length>0,tooltip:d.length>0?d.map(Oe).join(`
`):void 0,testId:"gizmo-editor-create-gpt-button",children:e.jsx(g,{id:"svUGIb",defaultMessage:"Create"})}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{color:"secondary",loading:n||!t,disabled:b,icon:T,onClick:()=>h("share"),children:e.jsx(g,{id:"aXKW4G",defaultMessage:"Share"})}),e.jsx(ae,{color:"primary",onClick:async()=>{let L=s.sharing.subjects.map(Ta);const x=Ft(s.sharing.subjects);L=be(s.sharing.recipient,L,x?.capabilities??Me),await c({recipient:s.sharing.recipient,subjects:L},t?.gizmo.display.categories[0])&&k(!0)},loading:a||!t,disabled:b||d.length>0,tooltip:d.length>0?d.map(Oe).join(`
`):void 0,children:e.jsx(g,{id:"84QVoj",defaultMessage:"Update"})})]}),j&&(w?.getWorkspaceId()==null?e.jsx(ii,{gizmo:s,publishedGizmo:t,promoteGizmo:c,appealGizmo:f,setAppealState:l,showActionsModal:M,updateGizmo:o,shareOnly:j==="share",onClose:()=>h(!1)}):e.jsx(ka,{gizmo:s,publishedGizmo:t,promoteGizmo:c,appealGizmo:f,setAppealState:l,showActionsModal:M,updateGizmo:o,onClose:()=>h(!1),shareOnly:j==="share"})),P&&e.jsx(Ca,{publishedGizmo:t,sharing:t.gizmo.sharing,onClose:()=>k(!1),workspaceName:w?.data.name??""})]})}function ci({gizmoEditorData:s,publishedGizmo:t,revertDraft:a}){const n=$(),i=ne(),r=ge(),[o,c]=m.useState(!1),f=Ye(),{value:l}=Pe("3645668434");return!f?.includes("debug")&&s?.id==null?null:e.jsxs(e.Fragment,{children:[e.jsxs(bs,{side:"top",contentAlign:"end",sideOffset:8,triggerButton:e.jsx(ae,{color:"ghost",icon:Ot}),children:[t!=null&&e.jsxs(V.Item,{onClick:M=>{es(t,i,M)},children:[e.jsx(Ks,{className:"icon-sm"}),e.jsx(g,{...J.copyLink})]}),a!=null&&e.jsxs(V.Item,{onClick:()=>{window.confirm(n.formatMessage(J.revertConfirm))&&a()},children:[e.jsx(Bt,{className:"icon-sm"}),e.jsx(g,{id:"W2blnV",defaultMessage:"Revert..."})]}),s?.id!=null&&l&&s.liveVersion>0&&e.jsxs(e.Fragment,{children:[e.jsxs(V.Item,{onClick:()=>{r(`/g/${s.id}/view`)},children:[e.jsx(Aa,{className:"icon-sm"}),e.jsx(g,{id:"gizmo.versionHistory",defaultMessage:"Version History"})]}),e.jsxs(V.Item,{onClick:async()=>{const M=await Fe.copyGizmo({gizmoId:s.id});M.gizmo.id&&r(`/gpts/editor/${M.gizmo.id}`)},children:[e.jsx(js,{className:"icon-sm"}),e.jsx(g,{id:"GizmoInformation.copyGizmoLabel",defaultMessage:"Duplicate GPT"})]})]}),s?.id!=null&&e.jsxs(V.Item,{color:"danger",onClick:()=>{c(!0)},children:[e.jsx(Dt,{className:"icon-sm"}),e.jsx(g,{id:"tNrOLG",defaultMessage:"Delete GPT"})]}),f?.includes("debug")&&e.jsxs(e.Fragment,{children:[e.jsx(V.Separator,{}),e.jsxs(V.Item,{onClick:()=>{me.toggleActiveSidebar("debug")},children:[e.jsx(La,{className:"icon-sm"}),"Debug (Internal only)"]})]})]}),o&&e.jsx(za,{gizmoId:s.id,onSuccess:()=>Xs(r),onClose:()=>{c(!1)}})]})}const xe=ys.div`flex items-center gap-1`;function di({gizmoEditorData:s}){const t=we(a=>a.currentWorkspace?.name);switch(s.sharingRecipient){case A.Private:return e.jsxs(xe,{children:[e.jsx($t,{className:"icon-xs"}),e.jsx(g,{...J.onlyMe})]});case A.Link:return e.jsxs(xe,{children:[e.jsx(Ks,{className:"icon-xs"}),e.jsx(g,{...J.anyoneWithLink})]});case A.Workspace:return e.jsxs(xe,{children:[e.jsx(Ht,{className:"icon-xs"}),t]});case A.Marketplace:return e.jsxs(xe,{children:[e.jsx(Wt,{className:"icon-xs"}),e.jsx(g,{...J.public})]});default:return e.jsx("div",{})}}function ui({gizmoEditorData:s}){return e.jsxs("div",{className:"flex items-center gap-2",children:[s.profilePictureUrl!=null?e.jsx(Fs,{isFirstParty:!1,src:s.profilePictureUrl,className:"h-8 w-8"}):e.jsx("div",{className:"h-8 w-8 rounded-full border-2 border-dashed border-token-border-medium"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:s.name||e.jsx(g,{...J.newGPT})}),e.jsx("div",{className:"text-xs text-token-text-secondary",children:Je(s)?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-token-text-tertiary"}),e.jsx(g,{...J.draft})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-brand-green"}),s.sharingRecipient===A.Marketplace?e.jsx(g,{...J.published}):e.jsx(g,{id:"gizmoEditorHeader.live",defaultMessage:"Live"})," · ",e.jsx(di,{gizmoEditorData:s})]})})]})]})}function mi({gizmoEditorData:s,isUpsertLoading:t,isPromoteLoading:a,isUploadingProfilePic:n,isGeneratingProfilePic:i,publishedGizmo:r,updateGizmo:o,promoteGizmo:c,appealGizmo:f,setAppealState:l,revertDraft:M,draftMessage:w,className:d,hasUnpublishedChanges:u,showActionsModal:j}){const h=ge();return e.jsxs("div",{className:le("relative flex h-14 w-full items-center justify-between gap-2 border-b border-token-border-medium px-3",d),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{className:"cursor-pointer text-token-text-primary",onClick:()=>Xs(h),children:e.jsx(dt,{className:"icon-lg"})}),e.jsx(ui,{gizmoEditorData:s})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[w,e.jsx(ci,{gizmoEditorData:s,publishedGizmo:r,revertDraft:M}),e.jsx(li,{gizmo:s,publishedGizmo:r,isUpsertLoading:t,isPromoteLoading:a,isUploadingProfilePic:n,isGeneratingProfilePic:i,updateGizmo:o,promoteGizmo:c,appealGizmo:f,setAppealState:l,hasUnpublishedChanges:u,showActionsModal:j})]})]})}const J=ce({onlyMe:{id:"gizmo.onlyMe",defaultMessage:"Only me"},anyoneWithLink:{id:"gizmo.anyoneWithLink",defaultMessage:"Anyone with a link"},public:{id:"gizmo.public",defaultMessage:"Everyone"},newGPT:{id:"gizmo.newGPT",defaultMessage:"New GPT"},draft:{id:"gizmo.draft",defaultMessage:"Draft"},published:{id:"gizmo.published",defaultMessage:"Published"},revertConfirm:{id:"gizmo.revertConfirm",defaultMessage:"Are you sure you want to revert to the last saved version?"},copyLink:{id:"gizmo.copyLink",defaultMessage:"Copy link"}}),fi=512;function gi(){return e.jsx("div",{className:"relative flex h-full w-full items-center justify-center rounded-full border-2 border-dashed border-token-border-medium",children:e.jsx(Ze,{className:"h-1/4 w-1/4"})})}function pi({gizmoEditorData:s,onFileChange:t,generateProfilePic:a,isGeneratingProfilePic:n,setIsGeneratingProfilePic:i}){const r=$(),o=ne(),[c,f]=m.useState(void 0),l=m.useRef(t);m.useEffect(()=>{l.current=t});async function M(u){if(u.length>0){i(!1);const j=await Zt(u[0],fi),h=Be(j);f({tempId:h,file:j,status:O.Uploading,progress:1,fileId:null,cdnUrl:null}),l.current("uploading"),Jt(h,j,r,o,Ms.ProfilePicture,{onFileCreated(P,k,T){f(b=>b!=="initial"&&b?.tempId===P&&b.status===O.Uploading?{...b,progress:10,fileId:k,cdnUrl:T}:b)},onFileUploadProgress(P,k){f(T=>T!=="initial"&&T?.tempId===P&&T.status===O.Uploading?{...T,progress:k}:T)},onFileUploaded(P,k,T){f(b=>b!=="initial"&&b?.tempId===P?(l.current(b),{...b,status:O.Ready,progress:100,fileSpec:{name:b.file.name,id:b.fileId,size:b.file.size,...T??{}}}):b)},onError(P){f(k=>{if(k!=="initial"&&k?.tempId===P){l.current(void 0);return}return k})}})}}const{open:w,getInputProps:d}=Os({disabled:!1,noClick:!0,onDropAccepted:M,onDropRejected:u=>qt(u,r,o,Vt.ProfilePicture),multiple:!0,maxSize:Bs,...Ds(Qt)});return e.jsxs("div",{className:"flex w-full items-center justify-center gap-4",children:[e.jsxs(bs,{sideOffset:8,triggerButton:e.jsx("button",{className:"h-20 w-20",children:n?e.jsx(gi,{}):c!=null&&c!="initial"&&c.status!=O.Ready?e.jsxs("div",{className:"relative h-full w-full overflow-hidden rounded-full",children:[e.jsx(Kt,{file:c.file}),c.status===O.Uploading&&c.progress<90?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/5 text-white",children:e.jsx(Yt,{percentage:c.progress,className:"h-6 w-6"})}):null]}):s?.profilePictureUrl!=null&&s?.profilePictureUrl!==""?e.jsx(Fs,{isFirstParty:!1,src:s.profilePictureUrl}):e.jsx("div",{className:"flex h-full w-full items-center justify-center rounded-full border-2 border-dashed border-token-border-medium",children:e.jsx(Xt,{className:"text-4xl"})})}),children:[e.jsx(V.Item,{onClick:w,children:e.jsx(g,{id:"ERQwXg",defaultMessage:"Upload Photo"})}),e.jsx(V.Item,{onClick:a,children:e.jsx(g,{id:"NXAog/",defaultMessage:"Use DALL·E"})})]}),e.jsx("input",{...d()})]})}function hi({gizmoEditorData:s,requireGizmoId:t,currentModelConfig:a,updateGizmo:n}){const i=$(),r=ne(),[o,c]=m.useState(0),f=m.useRef(new Map),l=ea(a,void 0),M=async p=>{ws.logEvent(Ps.uploadFile,{client:"web",eventSource:"mouse",intent:"gizmo"});const C=await t();p.length>0&&await Promise.all(p.map(I=>{const U=Be(I);f.current.set(U,{tempId:U,gizmoId:C,file:I,status:O.Uploading,progress:1,fileId:null,cdnUrl:null}),sa(Be(I),I,i,r,{kind:Ms.Gizmo,gizmoId:C},{onFileUploaded:(G,E,B,z)=>{const F=f.current.get(G);F==null||F.fileId==null||(n(Q=>({...Q,files:[...Q.files??[],{file_id:F.fileId,name:F.file.name,size:F.file.size,type:z?.mimeType??_s(I),last_modified:F.file.lastModified,file_size_tokens:z?.fileTokenSize}]})),f.current.delete(G),c(Q=>Q+1))},onFileCreated:(G,E,B)=>{f.current.set(G,{tempId:G,gizmoId:C,file:I,status:O.Uploading,progress:1,...f.current.get(G),fileId:E,cdnUrl:B}),c(z=>z+1)},onFileUploadProgress:(G,E)=>{const B=f.current.get(G);B?.status===O.Uploading&&f.current.set(G,{...B,progress:E}),c(z=>z+1)},onError:G=>{f.current.delete(G)}},{usesRetrievalIndex:a!=null&&Ge(a,I.type,I.name)===_e.Retrieval})}))},{getInputProps:w,open:d}=Os({disabled:!1,noClick:!0,onDropAccepted:M,multiple:!0,maxSize:Bs,maxFiles:10,...Ds(l)}),u=s?.files??[];function j(p){return e.jsx(os,{onRemoveFileClick:()=>{f.current.delete(p.tempId),c(C=>C+1)},file:p.file,loadingPercentage:p.status===O.Uploading?p.progress:void 0},p.tempId)}function h(p){return e.jsx(os,{file:p.name,fileId:p.file_id,onRemoveFileClick:()=>n(C=>({...C,files:C?.files?.filter(I=>I.file_id!==p.file_id)})),gizmoId:s?.id},p.file_id)}const P=Array.from(f.current.values()).filter(p=>u.every(C=>C.file_id!==p.fileId)),[k,T]=rs(P,p=>a!=null&&Ge(a,p.file.type,p.file.name)===_e.CodeInterpreter),[b,L]=rs(u,p=>a!=null&&p.type!=null&&Ge(a,p.type,p.name)===_e.CodeInterpreter),x=m.useRef(b.length);return m.useEffect(()=>{b.length>x.current&&n(p=>p.tools?.some(C=>C.type===W.PYTHON)?p:{...p,tools:[...p.tools??[],{type:W.PYTHON}]}),x.current=b.length},[b.length]),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"rounded-lg text-token-text-tertiary",children:e.jsx(g,{...xi.knowledgeWarning})}),T.length>0||L.length>0?e.jsxs("div",{className:"flex flex-wrap gap-2",children:[T.map(j),L.map(h)]}):null,k.length>0||b.length>0?e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 text-xs text-token-text-tertiary",children:e.jsx(g,{id:"i/QurZ",defaultMessage:"The following files are only available for Code Interpreter:"})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[k.map(j),b.map(h)]})]}):null,e.jsx("div",{children:e.jsxs(ae,{onClick:d,children:[e.jsx("input",{...w()}),e.jsx(g,{id:"sr8Qp/",defaultMessage:"Upload files"})]})})]})}const xi=ce({knowledgeWarning:{id:"gizmo.knowledgeWarning",defaultMessage:"If you upload files under Knowledge, conversations with your GPT may include file contents. Files can be downloaded when Code Interpreter is enabled"}});function vi({placeholder:s,text:t,onChange:a,onClose:n}){return e.jsx(Xe,{className:"!max-h-[100vh] !max-w-[80vw]",type:"success",isOpen:!0,onClose:n,primaryButton:e.jsx(ae,{onClick:n,children:e.jsx(g,{id:"FeFVdS",defaultMessage:"Close"})}),children:e.jsx("textarea",{className:"h-[70vh] w-full resize-none rounded-lg bg-token-main-surface-primary dark:border-gray-700",value:t,onChange:i=>{a(i.target.value)},placeholder:s})})}const ze=ys.div`text-sm text-red-500`;function ji({children:s,collapsed:t,initial:a}){return e.jsx(kt,{initial:a,children:!t&&e.jsx(Ns.div,{initial:"collapsed",animate:"open",exit:"collapsed",variants:{open:{opacity:1,height:"auto"},collapsed:{opacity:0,height:0}},children:s})})}function yi({gizmo:s,onShowActionsEditor:t,isDisabled:a}){const n=$(),i=ne(),r=e.jsxs("div",{className:"space-y-1",children:[s?.tools?.map((o,c)=>o.type!==W.JIT_PLUGIN?null:e.jsxs("div",{children:[e.jsx(Ea,{isDisabled:a,actionTool:o,onShowActionsEditor:()=>t(o.metadata.domain)}),o.metadata.auth?.type==="oauth"&&e.jsx(ra,{label:n.formatMessage(R.callbackUrlLabel),value:`https://chat.openai.com/aip/${o.metadata.action_id}/oauth/callback`,onCopied:()=>{i.success("Copied to clipboard",{duration:3})}})]},c)),(s?.tools?.filter(o=>o.type===W.JIT_PLUGIN)??[]).length>=ls?e.jsx("div",{children:n.formatMessage(R.maxActionsReached,{number:ls})}):e.jsx(ae,{disabled:a,onClick:()=>{t("Unknown domain")},className:"mt-2",children:e.jsx(g,{...R.createActionLabel})})]});return a?e.jsx(Ss,{side:"top",label:n.formatMessage(R.disabledCustomActionsTooltip),children:r}):r}function bi(s){return(s.files?.length??0)>0||s?.tools?.some(t=>t.type===W.JIT_PLUGIN)}const Mi=12;function wi({gizmoEditorData:s,updateGizmo:t,currentModelConfig:a,generateProfilePic:n,setIsUploadingProfilePic:i,isGeneratingProfilePic:r,setIsGeneratingProfilePic:o,requireGizmoId:c,onShowActionsEditor:f}){const l=s?.tools??[],[M,w]=m.useState(!1),[d,u]=m.useState(!0),j=s?.promptStarters??[],h=[...j,...j.length<Mi?[""]:[]],P=ke(s),T=Se()?.isWorkspaceAccount(),b=Ws(je.WorkspaceGPTCustomActions),L=$();return e.jsxs("div",{className:"flex h-full grow flex-col overflow-y-auto px-2 pt-6 text-sm",children:[e.jsxs("div",{className:"grow",children:[e.jsxs(Y,{children:[e.jsx(pi,{gizmoEditorData:s,generateProfilePic:n,isGeneratingProfilePic:r,setIsGeneratingProfilePic:o,onFileChange:async x=>{if(x!=null&&x!=="uploading"&&x.fileId!=null){const p=await He.getFileDownloadLink(x.fileId);p.status===$e.Success&&t({profilePictureId:x.fileId!=null?x.fileId:void 0,profilePictureUrl:p.download_url})}else t({profilePictureId:void 0,profilePictureUrl:void 0});i(x==="uploading")}}),e.jsx(X,{label:e.jsx(g,{id:"M4dZms",defaultMessage:"Name"}),description:e.jsx(g,{id:"+Gkni2",defaultMessage:"The name of your GPT"})}),e.jsx(Ae,{type:"text",placeholder:L.formatMessage(R.gptNamePlaceholder),value:s?.name??"",onChange:x=>{t({name:x.target.value})},onBlurCapture:()=>t(x=>({...x,name:x.name.trim()})),"data-testid":"gizmo-name-input"}),P.includes(te.GizmoNameTooLong)?e.jsx(ze,{className:"mt-1",children:e.jsx(g,{...R.nameTooLong,values:{length:ta}})}):null]}),e.jsxs(Y,{className:"mt-4",children:[e.jsx(X,{label:e.jsx(g,{id:"YDzNvf",defaultMessage:"Description"}),description:e.jsx(g,{id:"dpxCw8",defaultMessage:"Short description of what this GPT does"})}),e.jsx(Ae,{type:"text",placeholder:L.formatMessage(R.descriptionPlaceholder),value:s?.description??"",onChange:x=>t({description:x.target.value}),onBlurCapture:()=>t(x=>({...x,description:x.description?.trim()??""})),"data-testid":"gizmo-description-input"}),P.includes(te.GizmoDescriptionTooLong)?e.jsx(ze,{className:"mt-1",children:e.jsx(g,{...R.descriptionTooLong,values:{length:aa}})}):null]}),e.jsxs(Y,{children:[e.jsx(X,{label:e.jsx(g,{id:"2SO0RJ",defaultMessage:"Instructions"}),description:L.formatMessage(R.instructionsSubtitle)}),e.jsxs("div",{className:"relative",children:[e.jsx(Ua,{className:"resize-none",rows:8,value:s?.instructions,onChange:x=>t({instructions:x.target.value}),onBlurCapture:()=>t(x=>({...x,instructions:x.instructions.trim()})),placeholder:L.formatMessage(R.instructionsSubtitle),"data-testid":"gizmo-instructions-input"}),e.jsx("button",{className:"absolute bottom-3 right-2 text-token-text-tertiary",onClick:()=>w(!0),children:e.jsx(Ra,{className:"icon-sm"})})]}),P.includes(te.GizmoInstructionsTooLong)?e.jsx(ze,{className:"mt-1",children:e.jsx(g,{...R.instructionsTooLong,values:{length:ia}})}):null]}),e.jsxs(Y,{children:[e.jsx(X,{label:e.jsx(g,{id:"6rfYOX",defaultMessage:"Conversation starters"}),description:e.jsx(g,{id:"OSOIpd",defaultMessage:"Examples for the user to start the conversation"})}),e.jsx("div",{className:"flex flex-col gap-1",children:h.map((x,p)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ae,{className:"rounded-r-none",value:x,type:"text",onChange:C=>{const I=C.target.value;t(U=>({...U,promptStarters:Ke(p>=(j.length??0)?[...j??[],I]:j.map((G,E)=>E===p?I===""?void 0:I:G))}))}}),e.jsx("button",{className:"flex h-9 w-9 items-center justify-center rounded-lg rounded-l-none border border-l-0 border-token-border-medium",onClick:()=>t(C=>({...C,promptStarters:j.filter((I,U)=>U!==p)})),children:e.jsx(ut,{className:"icon-sm"})})]},p))})]}),e.jsxs(Y,{children:[e.jsx(X,{label:e.jsx(g,{id:"bwXSkU",defaultMessage:"Knowledge"}),description:L.formatMessage(R.knowledgeExplanation)}),e.jsx(hi,{gizmoEditorData:s,requireGizmoId:c,currentModelConfig:a,updateGizmo:t})]}),e.jsxs(Y,{children:[e.jsx(X,{label:e.jsx(g,{id:"mcAwDU",defaultMessage:"Capabilities"}),description:e.jsx(g,{id:"2exQT6",defaultMessage:"Functionality this GPT can use"})}),e.jsx(Fa,{enabledTools:l,onEnabledToolsChange:x=>t({tools:x})})]}),e.jsxs(Y,{children:[e.jsx(X,{label:e.jsx(g,{id:"7r7v+u",defaultMessage:"Actions"}),description:e.jsx(g,{id:"fBln7I",defaultMessage:"APIs this GPT can use"})}),e.jsx(yi,{isDisabled:!!(T&&!b),gizmo:s,onShowActionsEditor:f})]}),!T&&bi(s)&&e.jsxs(Y,{children:[e.jsx(X,{label:e.jsx(g,{id:"R3KeU7",defaultMessage:"Additional Settings"}),collapsed:!!d,onClick:()=>{u(x=>!x)}}),e.jsx(ji,{collapsed:d,initial:!1,children:e.jsx(na,{className:"mx-3 my-1",labelClassName:"w-full cursor-pointer",label:e.jsx(g,{id:"tZgwFW",defaultMessage:"Use conversation data in your GPT to improve our models"}),id:"improve-chatgpt",checked:!s.trainingDisabled,onChange:()=>{t({trainingDisabled:!s.trainingDisabled})}})})]})]}),M&&e.jsx(vi,{text:s.instructions??"",onChange:x=>{t({instructions:x})},onClose:()=>w(!1),placeholder:L.formatMessage(R.instructionsSubtitle)})]})}const R=ce({nameTooLong:{id:"gizmo.nameTooLong",defaultMessage:"GPT names cannot be longer than {length} characters."},knowledgeExplanation:{id:"gizmo.knowledgeExplanation",defaultMessage:"Additional files for this GPT to reference."},descriptionTooLong:{id:"gizmo.descriptionTooLong",defaultMessage:"GPT descriptions cannot be longer than {length} characters."},instructionsTooLong:{id:"gizmo.instructionsTooLong",defaultMessage:"GPT instructions cannot be longer than {length} characters."},disabledCustomActionsTooltip:{id:"gizmo.disabledCustomActionsTooltip",defaultMessage:"Custom actions are disabled for your workspace. Contact your admin to enable them."},createActionLabel:{id:"gizmo.createActionLabel",defaultMessage:"Create new action"},maxActionsReached:{id:"gizmo.maxActionsReached",defaultMessage:"GPTs can have a maximum of {number} actions"},descriptionPlaceholder:{id:"gizmo.descriptionPlaceholder",defaultMessage:"Add a short description about what this GPT does"},instructionsSubtitle:{id:"gizmo.instructionsSubtitle",defaultMessage:"What does this GPT do? How does it behave? What should it avoid doing?"},gptNamePlaceholder:{id:"gizmo.gptNamePlaceholder",defaultMessage:"Name your GPT"},callbackUrlLabel:{id:"gizmo.callbackUrlLabel",defaultMessage:"Callback URL"}});function Pi(s,t){const a=Ts(s);if(!Array.isArray(s.detail))return a;const n=Ke(s.detail.map(i=>{if(i.type==="value_error.any_str.max_length")switch(i.loc[1]){case"display":{switch(i.loc[2]){case"name":return t.formatMessage(R.nameTooLong,{length:i.ctx.limit_value});case"description":return t.formatMessage(R.descriptionTooLong,{length:i.ctx.limit_value})}break}case"instructions":return t.formatMessage(R.instructionsTooLong,{length:i.ctx.limit_value})}if(typeof i.msg=="string")return i.msg}));return n.length>0?n.join(`
`):a}function Si({upsertDraftError:s}){const t=$(),a=Pi(s,t);return e.jsxs("div",{className:"flex items-center gap-2 text-red-500",children:[e.jsx("div",{children:e.jsx(g,{...Zs.errorSavingDraft})}),a!=null&&e.jsx(Ss,{label:a,children:e.jsx(oa,{className:"icon-sm"})})]})}function Ti({isPublished:s,isSavingDraft:t,hasUnpublishedChanges:a,upsertDraftError:n,className:i}){return n instanceof mt?e.jsx(Si,{upsertDraftError:n}):a?e.jsxs("div",{className:le("flex items-center gap-2",i),children:[e.jsx("span",{className:"text-token-text-secondary",children:s?e.jsx(g,{id:"gizmoEditor.draftUnpublished",defaultMessage:"Unpublished changes"}):e.jsx(g,{id:"gizmoEditor.draftPending",defaultMessage:"Updates pending"})}),e.jsx("div",{className:"w-4 text-token-text-tertiary",children:t&&e.jsx(Ze,{})})]}):null}const Zs=ce({errorSavingDraft:{id:"gizmo.errorSavingDraft",defaultMessage:"Error saving draft"}}),ki=Ve(()=>Qe(()=>import("./or10jeufowa9j1t9.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12])).then(s=>s.DebugConversationSidebar));var Ci=(s=>(s.TestGizmoAction="test_gizmo_action",s))(Ci||{});const Ii=new ft;function Ni({gizmoEditorData:s,isSavingDraft:t,currentModelConfig:a,showTitle:n=!0}){const[i,r]=m.useState(()=>ye());zs(i,{kind:ie.GizmoTest,gizmo_id:s.id}),m.useEffect(()=>{fe(i,P=>{P.mode={kind:ie.GizmoTest,gizmo_id:s.id}})},[i,s.id]);const o=s.files?.map(P=>P.file_id).join();m.useEffect(()=>{gt(i)!=null&&r(ye())},[s.id,s.instructions,s.tools,o,i]);const c=As(P=>P.activeSidebar),f=m.useMemo(()=>({gizmoEditorData:s,mode:"test"}),[s]),[l,M]=m.useState(0),w=()=>{M(P=>P-360)},d=s.id,u=_i(i,a);m.useEffect(()=>ks(Ii,{test_gizmo_action:({rootDomain:P,operationName:k})=>{d&&u(d,P,k)}}),[u,d]);const j=vs(),h=m.useCallback(()=>e.jsx("div",{className:"h-full w-full",children:e.jsx(Da,{gizmo:s,hideOwner:!0,showStarterPrompts:!0})}),[s]);return e.jsx(Ls.Provider,{value:f,children:e.jsx(la,{clientThreadId:i,children:e.jsxs("div",{className:le("flex h-full w-full",t&&"cursor-wait opacity-80 transition"),children:[e.jsxs("div",{className:"flex grow flex-col",children:[e.jsx("div",{className:"relative mb-2 flex-shrink-0",children:e.jsx("div",{className:"flex justify-center py-1",children:n&&e.jsxs("div",{className:"group flex items-center gap-2 text-lg font-semibold",children:[e.jsx("div",{className:"icon-md"}),e.jsxs("button",{onClick:()=>{w(),r(ye())},className:"flex items-center gap-2",children:[e.jsx(g,{id:"2u/6Ja",defaultMessage:"Preview"}),e.jsx(Ns.div,{className:"text-token-text-primary",animate:{rotate:l},transition:{duration:.3},children:e.jsx(ca,{className:"icon-md invisible group-hover:visible"})})]})]})})}),e.jsxs("div",{className:le("relative grow overflow-auto px-2",t&&"pointer-events-none"),children:[j?e.jsx("div",{className:"contents",style:{"--screen-height-override":"100%","--chat-screen-thread-parent-background":"var(--main-surface-secondary)"},children:e.jsx(qs,{clientThreadId:i,children:e.jsx(Vs,{hideHeader:!0,embedded:!0,renderEmptyState:h})})}):e.jsx($s,{clientThreadId:i,hideHeader:!0,renderEmptyState:h()}),e.jsx(Oa.Sidebars,{children:e.jsx(Ba,{clientThreadId:i,overrideWidth:0,isAutoFocusDisabled:!0})})]})]}),c==="debug"&&e.jsx(ki,{clientThreadId:i,slideOver:!1,onClose:()=>me.toggleActiveSidebar("debug"),isOpen:!0})]})})})}const ps=Cs.memo(Ni);function _i(s,t){const a=Qs({clientThreadId:s});return m.useCallback(async(i,r,o)=>{if(!t)return;fe(s,f=>{qe.appendMessage(f,pt(`Call the ${r} API with the ${o} operation`,{jit_plugin_data:{from_client:{type:"test",operation:o,tool_name:da(r)}}}))});const c={conversationMode:{kind:ie.GizmoTest,gizmo_id:i}};a({model:t.id,completionType:xs.Next,parentNodeId:re.getCurrentLeafId(oe(s)),metadata:{},completionMetadata:c})},[s,a,t])}const Gi=Ve(()=>Qe(()=>import("./m75rx4rq59lcbwba.js"),__vite__mapDeps([13,2,1,3,14,4,5,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,12,40,41,42,43,44,8,10,45,46,47,48,49,50,6,51,52,53,54,55,56,57])).then(s=>s.GizmoActionsEditor));var Js=(s=>(s.MAGIC_MAKER="magic",s.ADVANCED="advanced",s.PREVIEW="preview",s))(Js||{});function Re({value:s,label:t,testId:a}){return e.jsx(Es,{value:s,className:"text-md w-1/3 flex-grow rounded-lg border-token-border-light p-1.5 font-semibold text-token-text-tertiary transition hover:text-token-text-primary radix-state-checked:border radix-state-checked:bg-token-main-surface-primary radix-state-checked:text-token-text-primary radix-state-checked:shadow-[0_0_2px_rgba(0,0,0,.03)] md:w-1/2","data-testid":a,children:t})}function Ai({className:s,editorTab:t,setEditorTab:a}){const n=$(),{value:i}=Pe("1393076427");return e.jsxs(Us,{className:le("flex w-full overflow-hidden rounded-xl bg-token-main-surface-secondary p-1.5 md:w-1/2",s),value:t,onValueChange:r=>{a(r)},children:[i&&e.jsx(Re,{value:"magic",label:n.formatMessage(Ue.magicMakerLabel)}),e.jsx(Re,{value:"advanced",label:n.formatMessage(Ue.configureLabel),testId:"gizmo-editor-configure-button"}),e.jsx("div",{className:"flex w-1/3 md:hidden",children:e.jsx(Re,{value:"preview",label:n.formatMessage(Ue.previewLabel)})})]})}function Li(s,t){return s.length!==t.length?!1:s.every(a=>t.some(n=>n.type===a.type))}function zi(s,t){return s.name===t.gizmo.display.name&&s.description===t.gizmo.display.description&&s.instructions===t.gizmo.instructions&&Li(s.tools,t.tools)&&We(s.files?.map(a=>a.file_id)??[],t.files?.map(a=>a.file_id)??[])&&s.profilePictureUrl==t.gizmo.display.profile_picture_url&&s.profilePictureId==t.gizmo.display.profile_pic_id}const et=({gizmo:s,onNewGizmoId:t})=>{const a=Is(),n=Ye(),i=Ws(je.BrowsingAvailable),r=n?.includes(je.GizmoCanvasToggle)&&n?.includes(je.Canvas),o=$(),c=ne(),f=()=>{const v=[];return i&&v.push({type:W.BROWSER}),r&&v.push({type:W.CANVAS}),{...us,tools:[...us.tools,...v]}},l=m.useRef(s!=null?cs(s):f()),M=m.useRef(s),w=m.useRef(l.current),[d,u]=m.useState(()=>l.current),[j,h]=m.useState(()=>ye()),[P]=m.useState(()=>({context_message:Va(l.current),model_slug:"unused",enabled_tools:[{tool_id:s!=null?"gizmo_editor":"gizmo_creator"}]}));si(j,w.current,P);const{data:k}=hs(),T=k?.models.get(ht)??(k&&_a(k.models.values(),v=>v.tags.includes(xt.GPT_4o))),{data:b}=pa(l.current.id),L=ha(),{isPending:x,error:p}=L,C=xa(),I=m.useMemo(()=>b!=null&&!zi(d,b),[d,b]),U=async()=>{const v=l.current;try{const S=await L.mutateAsync({editorData:v,gizmoId:v.id});if(M.current=S,l.current.id==null){const _=S.gizmo.id;l.current={...l.current,id:_,sharingTargets:S.gizmo.sharing_targets},u(l.current),t?.(_)}for(const _ of S.tools.filter(D=>D.type===W.JIT_PLUGIN)){const D=l.current.tools.find(ee=>ee.type===W.JIT_PLUGIN&&ee.metadata.domain===_.metadata.domain);D&&D.metadata.action_id!==_.metadata.action_id&&(D.metadata={...D.metadata,action_id:_.metadata.action_id},u(l.current))}return S}catch(S){const _=Ts(S)??o.formatMessage(Zs.errorSavingDraft);throw c.warning(_,{duration:2}),S}},G=m.useRef(void 0),E=async()=>l.current.id!=null?l.current.id:(G.current==null&&(G.current=U().then(v=>v.gizmo.id).catch(v=>{throw G.current=void 0,v})),G.current),[B]=m.useState(()=>va(()=>U(),2e3,{trailing:!0})),z=m.useCallback((v,S=!0)=>{const _=typeof v=="function"?v(l.current):ja(l.current,v);We(_,l.current)||(l.current=_,u(l.current),S&&B())},[B]),F=m.useRef(void 0);m.useEffect(()=>ks(vt,{completionFinished:async v=>{const S=v.serverThreadId;if(S==null){he(!1);return}try{const _=await qa(l.current,S,c,F.current);_!=null&&(z(_),w.current=Gs(l.current))}catch(_){Ee.addError(_),c.warning("Something went wrong generating your GPT",{duration:3})}finally{F.current=H.getThreadCurrentLeafId(S),he(!1)}}}),[c,z]);const Q=Xa(j,P),[q,K]=m.useState(void 0);m.useEffect(()=>{K(Ia(s))},[s?.gizmo.id]);const pe=async(v,S)=>{const _=ke(l.current,v.recipient,S);if(_.length>0){c.warning(`Could not save GPT:

${_.map(se=>`- ${Oe(se)}`).join(`
`)}`,{duration:3});return}const D=await U(),ee=D.gizmo.id;try{return ws.logEvent(Ps.promoteGizmo,{gizmo_id:D.gizmo.id,sharing_recipient:v.recipient,editor_tab:N}),await C.mutateAsync({gizmoId:D.gizmo.id,data:{sharingSubjects:v.subjects,sharingRecipient:v.recipient,categories:S==null?void 0:[S]}},{onSuccess(Ne){a.setQueryData(ds(a,ee).queryKey,Ne),a.invalidateQueries({queryKey:["gizmos"]}),a.invalidateQueries({queryKey:["gizmo",{gizmoId:ee}]}),a.invalidateQueries({queryKey:["gizmo","userActionSettings",{gizmoId:ee}]})}})}catch(se){if(se instanceof ya)K({gizmoId:ee,sharingRecipient:v.recipient,moderationType:Hs.PublishBlocked,sharingTargets:se.response?.sharing_targets,showModal:de.AppealAvailable});else{Ee.addError(se);const Ne=se.detail??"An unknown error occurred";c.warning("Error saving GPT - "+Ne,{duration:6})}}},{value:y}=Pe("1393076427"),[N,ss]=m.useState(()=>{if(!y)return"advanced";const v=is.getItem(ns.GizmoEditorTab);return Object.values(Js).includes(v)?v:"magic"}),Ce=jt.useState(({windowWidth:v})=>v);m.useEffect(()=>{Ce!=null&&Ce>=768&&N==="preview"&&ss("magic")},[Ce,N]);const[st,tt]=m.useState(!1),[ts,he]=m.useState(!1),[as,Ie]=m.useState(void 0);return e.jsxs("div",{className:"flex h-screen w-full flex-col items-center",children:[e.jsx(mi,{gizmoEditorData:d,isUpsertLoading:L.isPending,isPromoteLoading:C.isPending,hasUnpublishedChanges:I,isUploadingProfilePic:st,isGeneratingProfilePic:ts,publishedGizmo:b,updateGizmo:z,promoteGizmo:async(v,S)=>{const _=await pe(v,S);return l.current={...l.current,sharingRecipient:v.recipient},u(l.current),is.setItem(ns.GizmoEditorTab,N),_},appealGizmo:async(v,S)=>{q!=null&&K({...q,sharingRecipient:v,categories:S==null?void 0:[S],showModal:de.AppealAvailable})},setAppealState:K,revertDraft:b!=null&&I?()=>{const v=a.getQueryData(ds(a,l.current.id).queryKey);if(v!=null){const S=cs(v);l.current=S,u(S),U()}}:void 0,draftMessage:e.jsx(Ti,{isPublished:b!=null&&(b.gizmo.share_recipient==="marketplace"||b.gizmo.share_recipient==="workspace"),hasUnpublishedChanges:I,isSavingDraft:x,upsertDraftError:p,className:"text-sm"}),showActionsModal:v=>{Ie(v)},className:"flex-shrink-0"}),q&&e.jsx(Na,{appealState:q,onAppealClose:()=>K({...q,showModal:de.None}),onAppealSubmitted:()=>K({...q,showModal:de.AppealSent})}),e.jsxs("div",{className:"relative flex w-full grow overflow-hidden",children:[e.jsx("div",{className:"flex w-full justify-center md:w-1/2",children:e.jsx("div",{className:"h-full grow overflow-hidden",children:as!==void 0?e.jsx(Gi,{currentlyEditingActionDomain:as,gizmoEditorData:d,updateGizmo:z,onClose:()=>{Ie(void 0)}}):e.jsxs("div",{className:"flex h-full flex-col px-2 pt-2",children:[e.jsx("div",{className:"flex w-full flex-row justify-center",children:e.jsx(Ai,{editorTab:N,setEditorTab:ss,className:"mb-2 flex-shrink-0 self-center"})}),e.jsx("div",{className:"grow overflow-hidden",children:N==="magic"?e.jsx("div",{className:"h-full w-full pb-5",children:e.jsx(ai,{gizmoEditorData:d,updateGizmo:z,clientThreadId:j,gizmoEditorDataRef:l,magicMakerBehaviorOverrides:P,magicMakerConversationGizmoEditorDataRef:w,requireGizmoId:E},j)}):N==="advanced"?e.jsx(wi,{gizmoEditorData:d,updateGizmo:z,currentModelConfig:T,generateProfilePic:()=>{he(!0),Q(l,w,[Za])},setIsUploadingProfilePic:tt,isGeneratingProfilePic:ts,setIsGeneratingProfilePic:he,requireGizmoId:E,onShowActionsEditor:v=>{Ie(v)}}):e.jsx(ps,{gizmoEditorData:d,currentModelConfig:T,isSavingDraft:x,showTitle:!1})})]})})}),e.jsx("div",{className:le("hidden w-1/2 justify-center border-l border-token-border-medium bg-token-main-surface-secondary pt-4",N!=="preview"&&"md:flex"),children:e.jsx("div",{className:"flex-grow pb-5 screen-arch:pb-0 screen-arch:[--embedded-screen-padding-bottom:20px]",children:e.jsx("div",{className:"h-full",children:e.jsx(ps,{gizmoEditorData:d,currentModelConfig:T,isSavingDraft:x})})})})]})]})};function Ri({gizmoId:s,version:t}){const{data:a}=ma({gizmoId:s,draft:!0,version:t}),n=we(Rs.accountUserId),r=fa()?.id,o=a!=null&&n!=null&&r!=null&&ga(a);return a==null||!o?null:e.jsx(et,{gizmo:a})}function Ui({onNewGizmoId:s}){return e.jsx(et,{onNewGizmoId:s})}const Ei=({gizmoId:s,remixSourceId:t,version:a})=>{const n=ge(),i=Se(),r=m.useRef(void 0);m.useEffect(()=>(me.enterGizmoEditor(),()=>{me.exitGizmoEditor()}),[]);let o=s;return s!=null&&r.current===s&&(o=void 0),Ga({resetThreadAction:()=>{n("/")}}),i?.data?o!==void 0?e.jsx(Ri,{gizmoId:o,version:a},o):e.jsx(Ui,{remixSourceId:t,onNewGizmoId:c=>{r.current=c,window.history.replaceState(window.history.state,"",ua(c))}}):e.jsx("div",{className:"flex min-h-screen items-center justify-center",children:e.jsx(Ze,{})})},Ue=ce({magicMakerLabel:{id:"gizmo.magicMakerLabel",defaultMessage:"Create"},configureLabel:{id:"gizmo.advancedLabel",defaultMessage:"Configure"},previewLabel:{id:"gizmo.previewLabel",defaultMessage:"Preview"}});function Fi(s){const t=ge();m.useEffect(()=>{s||t(yt(bt.NO_ACCESS))},[s,t])}const ln=()=>(wt(),null),cn=Mt(function(){const t=Se();Fi(t==null||t.canCreateGPTs());const a=Ct(),[n]=It(),i=ge(),r=a.slug,o=n.get("version"),c=r?Pt(r):void 0,f=n.get("remixFrom");return m.useEffect(()=>{St(!0).then(l=>{ba.initializeAndGatherData(l),Tt.initializeAndGatherData(l)})},[]),m.useEffect(()=>{t!=null&&!t.canCreateGPTs()&&i("/")},[t,i]),m.useEffect(()=>{c&&ms(c)&&i(`/g/${r}/project`)},[c,i,r]),!t?.canCreateGPTs()||c&&ms(c)?null:e.jsx(Ma,{children:e.jsx(Ei,{gizmoId:c,remixSourceId:f??void 0,version:o!=null?Number(o):void 0})})});export{Ii as G,Ci as a,ln as c,cn as g};
//# sourceMappingURL=iy95ckhh5t3iwtqv.js.map
