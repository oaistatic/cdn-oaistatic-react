import{r as p,j as e,c as O,M as f,v as re,L as we}from"./n1tvutderx19k1zs.js";import{hH as Fe,fo as A,bT as c,iV as Pe,iW as U,iX as Te,iY as ae,iZ as Me,i_ as L,i$ as ie,j0 as le,iC as D,j1 as Ee,iB as ce,iH as De,fb as _e,j2 as Oe,iA as Ae,j3 as Ue,iy as Le,iz as Be,j4 as te,fc as Re,j5 as G,j6 as z,j7 as Ge,j8 as H,cl as ze,j9 as He,ja as Xe,jb as Z,jc as Ze,l as Ye,jd as $e,eJ as Je,eI as Ke,je as Qe,jf as Ve,jg as de,jh as We,ji as qe,jj as et,ft as ue,jk as tt,jl as st,dp as nt,at as ot,av as rt,jm as at,d as it,jn as se,jo as lt,jp as ct}from"./c87uv1mutc86tiqk.js";import{G as dt}from"./ibswgel9g2v9wlet.js";import{d as S,dm as me,bo as B,J as ut,gR as mt,B as Y,bf as _,bd as xe,bu as X,F as xt,P as $,a as J,by as ft,e0 as fe,cG as ht,bY as pt,cI as gt,cd as jt,K as vt,fI as yt}from"./efuue3ezs0mj4ucx.js";import{S as bt}from"./jnjq4wt6v0sb6ord.js";import{F as St}from"./oqu6s9fqa0pl50wo.js";import{f as Ct}from"./m89x2zftpo6hrypr.js";import{P as Nt}from"./ka0pfyowuwrq8q81.js";import{G as kt}from"./bzaypvhehxbw5ucz.js";import"./d995zjnlydagrugw.js";import"./dnxtg4alg3s338gf.js";import"./jy24clh9s5sbm6a3.js";import"./bh0nczk7jf5nipy7.js";import"./ishe91rr928a0b40.js";import"./c1vsiyure2yziq8u.js";import"./ecs2ptmt646v6gvn.js";import"./gb5z15gr4uo6e2ww.js";const It=[null,"#F14D42","#E36E30","#B98618","#DB9F1E","#3DCB40","#30A633","#27C0A6","#16B7DB","#6490F0","#0088FF","#1D53BF","#512AEB","#875BE1","#EE4D83","#E659C2"];function wt({color:t,active:s,onClick:n}){const o=O();return e.jsx("button",{onClick:()=>n(t),className:"flex h-10 w-10 items-center justify-center rounded-full bg-token-text-primary can-hover:hover:scale-110 can-hover:active:scale-100","aria-label":t??o.formatMessage(c.defaultColor),style:{backgroundColor:t??void 0},children:s&&e.jsx(Pe,{className:"h-6 w-6 text-token-main-surface-primary"})})}function Ft({currentTheme:t,onSelect:s}){return e.jsx("div",{className:"m-4 grid grid-cols-4 gap-4",children:It.map(n=>e.jsx(wt,{active:n===t,color:n,onClick:o=>{s(o)}},n))})}const Pt=({currentTheme:t,isPopoverOpen:s,disabled:n,...o},a)=>e.jsxs("button",{ref:a,disabled:n,...o,className:S("group relative flex h-[60px] w-[60px] items-center justify-center",n&&"pointer-events-none"),children:[e.jsx("div",{className:S("absolute flex h-full w-full items-center justify-center rounded-full",t&&"opacity-10",!t&&"bg-token-main-surface-secondary"),style:{backgroundColor:t??void 0}}),e.jsx("div",{className:"relative flex h-full w-full items-center justify-center",children:e.jsx(Fe,{className:S("icon-lg duration-200 ease-out can-hover:group-hover:scale-110",n&&"text-token-text-tertiary"),style:{color:t}})}),e.jsx("div",{className:S("absolute bottom-0 right-0 flex h-6 w-6 scale-0 items-center justify-center rounded-full border border-token-border-light bg-token-main-surface-primary text-token-text-secondary opacity-0 drop-shadow-sm duration-200 ease-out group-hover:scale-100 group-hover:opacity-100",s&&"scale-100"),children:e.jsx(A,{className:"h-[18px] w-[18px] rounded-full text-token-text-secondary"})})]}),he=p.forwardRef(Pt);function K({file:t,fileName:s,fileId:n,gizmoId:o}){const a=U(s)&&n!=null,r=Te(t&&ae(t)?t:null,s,n,o,void 0);return a?e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-[#129FBF] bg-cover bg-center text-white",style:{backgroundImage:`url(${r})`},children:!r&&e.jsx(Me,{className:"icon-lg"})}):null}function Tt({gizmoId:t,gizmoName:s,pendingFiles:n,files:o,modelCapacityUsed:a,interpreterOnlyFileIds:r,onAddFiles:d,removePendingFile:l,pendingFileUpsertMutationsRef:i}){return n.length===0&&o.length===0?e.jsx("div",{className:"h-full pb-6",children:e.jsx(_t,{gizmoName:s,onAddFiles:d})}):e.jsx("div",{className:"pb-6",children:e.jsx(Mt,{gizmoId:t,modelCapacityUsed:a,files:o,pendingFiles:n,interpreterOnlyFileIds:r,removePendingFile:l,pendingFileUpsertMutationsRef:i})})}function Mt({gizmoId:t,modelCapacityUsed:s,files:n,pendingFiles:o,interpreterOnlyFileIds:a,removePendingFile:r,pendingFileUpsertMutationsRef:d}){const l=L();return n.length===0&&o.length===0?null:e.jsxs("div",{className:"overflow-hidden rounded-lg border border-token-border-light",children:[s&&s>1?e.jsxs("div",{className:"border-b border-token-border-light bg-gray-50 px-4 py-3 text-xs text-token-text-secondary dark:bg-gray-750",children:[e.jsx("div",{className:"font-medium",children:e.jsx(f,{...c.tooManyFilesTitle})}),e.jsx("div",{children:e.jsx(f,{...c.tooManyFilesDescription})})]}):null,n.map(i=>e.jsx(Dt,{gizmoId:t,gizmoFile:i,interpreterOnly:a.includes(i.file_id),onDelete:async()=>{const m=new Promise(h=>{d.current.push({id:t,mutationId:re(),update:j=>{const x=j.files.filter(v=>v.file_id!==i.file_id);return{...j,files:x}},onSuccess:h})});return ie(t)({gizmoId:t,upsertProjectMutation:l,pendingFileUpsertMutationsRef:d}),m}},i.file_id)),o.map(i=>e.jsx(Et,{interpreterOnly:a.includes(i.tempId),pendingFile:i,onDelete:async()=>r(i.tempId)},i.tempId))]})}function pe(){return e.jsx("div",{className:"truncate",children:e.jsx(f,{...c.interpreterOnlyLabel})})}function Et({pendingFile:t,onDelete:s,interpreterOnly:n}){const o=t.file.name,r=(ae(t.file)&&t.file?.type.startsWith("image/")||U(o))&&e.jsx(K,{file:t.file,fileName:o,fileId:t.fileId??void 0,gizmoId:t.gizmoId??void 0});return e.jsx(ge,{interpreterOnly:n,onDelete:s,children:e.jsx(le,{icon:r,fileName:t.file.name,loadingPercentage:t.status===D.Uploading?t.progress:void 0,customFileDescription:n?e.jsx(pe,{}):void 0})})}function Dt({gizmoFile:t,gizmoId:s,interpreterOnly:n,onDelete:o}){const a=t.name,d=U(a)&&t.file_id!=null&&e.jsx(K,{fileName:a,fileId:t.file_id,gizmoId:s});return e.jsx(ge,{interpreterOnly:n,onDelete:o,children:e.jsx(le,{icon:d,fileName:t.name,customFileDescription:n?e.jsx(pe,{}):void 0})})}function ge({children:t,onDelete:s,interpreterOnly:n}){const[o,a]=p.useState(!1);return e.jsxs("div",{className:S("group flex w-full justify-between border-b border-token-border-light p-3 text-sm last:border-b-0",n&&"grayscale"),children:[e.jsx("div",{className:"w-10/12 can-hover:w-full can-hover:group-hover:w-11/12",children:t}),e.jsx("div",{className:S("flex shrink-0 grow-0 bg-token-main-surface-primary pl-1 can-hover:group-hover:flex",!o&&"can-hover:hidden"),children:o?e.jsx("div",{className:"flex h-full w-6 items-center justify-center",children:e.jsx(me,{})}):e.jsx("button",{onClick:async()=>{s&&(a(!0),await s(),a(!1))},children:e.jsx(Ee,{className:"text-token-secondary rounded-full hover:bg-token-main-surface-secondary dark:hover:bg-token-main-surface-tertiary"})})})]})}function _t({gizmoName:t,onAddFiles:s}){return e.jsx("div",{className:"flex h-full cursor-pointer items-center justify-center rounded-lg border border-token-border-light px-4 py-3 pb-6 active:bg-token-main-surface-tertiary",onClick:s,children:e.jsxs("div",{className:"flex flex-col items-center gap-2 py-4 text-sm text-token-text-secondary",children:[e.jsx(ce,{}),e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"max-w-100 text-token-text-secondary",children:e.jsx(f,{...c.emptyFileInstructions,values:{gizmoNameText:e.jsx("span",{className:"font-bold",children:e.jsx(f,{...c.emptyFileGizmoName,values:{gizmoName:t}})},"gizmoNameText")}})})})]})})}const je=B.div`text-sm text-red-500`,Ot=B.textarea`w-full overflow-y-auto overflow-x-clip rounded-lg border px-3 py-2 focus:ring-2 focus:ring-token-text-primary border-token-border-medium bg-token-main-surface-primary`,E=20;function ve({onClose:t,gizmo:s}){const n=O(),[o,a]=p.useState(s?.gizmo?.instructions||""),r=L(),d=Y(),l=[];o?.length>G&&l.push(n.formatMessage(c.instructionsTooLong,{length:G}));const i=x=>{a(x.target.value)},m=()=>{t()},u=async()=>{try{await r.mutateAsync({update:{instructions:o??""},id:s.gizmo.id}),t()}catch(x){const v=fe(x);d.danger(v??"Error",{duration:2})}},h=e.jsx(_.Button,{title:n.formatMessage(c.save),color:"primary",onClick:u,loading:r.isPending,disabled:l.length>0}),j=e.jsx(_.Button,{title:n.formatMessage(c.cancel),color:"secondary",onClick:m,disabled:r.isPending});return e.jsx(xe,{className:"min-h-[50dvh] max-w-[820px]",isOpen:!0,showCloseButton:!r.isPending,hideSeparator:!0,noPadding:!0,size:"custom",type:"success",title:e.jsx("div",{className:"h-8",children:n.formatMessage(c.editCustomInstructionsTitle)}),onClose:()=>{r.isPending||t()},children:e.jsxs("div",{className:"flex h-full flex-col px-6 pb-7 pt-0",children:[e.jsx("div",{className:"text-sm font-medium",children:n.formatMessage(c.editCustomInstructionsSubtitle)}),e.jsx("div",{className:"text-sm text-token-text-secondary",children:n.formatMessage(c.editCustomInstructionsDescription)}),e.jsx(Ot,{autoFocus:!0,placeholder:n.formatMessage(c.projectInstructionsPlaceholder),className:"mb-1 mt-4 min-h-24 w-full flex-grow resize-none rounded-md bg-token-main-surface-primary",onChange:i,value:o,disabled:r.isPending}),l.map(x=>e.jsx(je,{className:"mt-1",children:x},x)),e.jsx(_.Actions,{primaryButton:h,secondaryButton:j})]})})}function At({gizmoId:t,gizmoName:s,gizmoEditorData:n,openFileDialog:o,pendingFiles:a,setVersion:r,pendingFileUpsertMutationsRef:d,currentModelConfig:l}){const i=n?.files?.reduce((g,N)=>g+(N.file_size_tokens??0),0)??0,m=n?.contextStuffingBudget;let u;m&&(u=i/m,i>0&&u<.01&&(u=.01));const h=n?.files??[],j=Array.from(a.current.values()).filter(g=>h.every(N=>N.file_id!==g.fileId)),x=j.filter(g=>l!=null&&H(l,g.file.type,g.file.name)===X.CodeInterpreter),v=h.filter(g=>l!=null&&g.type!=null&&H(l,g.type,g.name)===X.CodeInterpreter),y=[...x.map(g=>g.tempId),...v.map(g=>g.file_id)];return e.jsx(Tt,{gizmoId:t,gizmoName:s,pendingFiles:j,pendingFileUpsertMutationsRef:d,files:h,modelCapacityUsed:u,interpreterOnlyFileIds:y,onAddFiles:o,removePendingFile:g=>{a.current.delete(g),r(N=>N+1)}})}const Ut=p.forwardRef(function({gizmo:s,showInstructions:n=!0},o){const a=O(),[r,d]=p.useState(!1),l=L(),i=De(s),m=_e(i),{data:u}=ut(),h=u?.models.get(mt)??(u&&Ct(u.models.values(),I=>I.tags.includes(xt.GPT_4o))),j=Y(),[x,v]=p.useState(0),y=p.useRef(new Map),g=p.useRef([]),N=Oe(h,void 0),ye=I=>{I.some(({errors:w})=>w.length!==1||w[0]?.code!==te.TooManyFiles)?j.danger(a.formatMessage(c.unknownError),{duration:2}):j.danger(a.formatMessage(c.dragTooManyFilesError,{MAX_FILES_PER_PROJECT:E}),{duration:2})},be=async I=>{$.logEvent(J.uploadFile,{client:"web",eventSource:"mouse",intent:"gizmo"});const w=i.id;I.length>0&&await Promise.all(I.map(F=>{const R=ze(F);y.current.set(R,{tempId:R,gizmoId:w,file:F,status:D.Uploading,progress:1,fileId:null,cdnUrl:null}),He(R,F,a,j,{kind:ft.Gizmo,gizmoId:w},{onFileUploaded:async(b,k,T,P)=>{const C=y.current.get(b);C?.fileId&&C?.fileId&&(g.current.push({id:s.gizmo.id,mutationId:re(),update:M=>{if(!C.fileId)return M;const Ie=[...M.files??[],{file_id:C.fileId,name:C.file.name,size:C.file.size,type:P?.mimeType??Xe(C.file),last_modified:C.file.lastModified,file_size_tokens:P?.fileTokenSize}];return{...M,files:Ie}},onSuccess:()=>{y.current.delete(b),v(M=>M+1)}}),ie(s.gizmo.id)({gizmoId:s.gizmo.id,upsertProjectMutation:l,pendingFileUpsertMutationsRef:g}))},onFileCreated:(b,k,T)=>{y.current.set(b,{tempId:b,gizmoId:w,file:F,status:D.Uploading,progress:1,...y.current.get(b),fileId:k,cdnUrl:T}),v(P=>P+1)},onFileUploadProgress:(b,k)=>{const T=y.current.get(b);T?.status===D.Uploading&&y.current.set(b,{...T,progress:k>95?95:k}),v(P=>P+1)},onError:b=>{y.current.delete(b),v(k=>k+1)}},{usesRetrievalIndex:h!=null&&H(h,F.type,F.name)===X.Retrieval})}))},V=Ae(N),W=Ue(V),q=y.current.size+i.files.length,{open:ee,getInputProps:Se,getRootProps:Ce,isDragAccept:Ne,isDragReject:ke}=Le({noClick:!0,noDragEventsBubbling:!0,onDropAccepted:be,onDropRejected:ye,multiple:!0,maxSize:Be,maxFiles:E-q,validator:()=>q>=E?{code:te.TooManyFiles,message:"Too many files"}:null,...V});return p.useImperativeHandle(o,()=>({openFileDialog:ee})),e.jsxs("div",{...Ce({className:"h-full px-6"}),children:[e.jsx("input",{...Se()}),n&&e.jsxs(St,{children:[e.jsx("button",{className:"w-full",onClick:()=>d(!0),children:e.jsx("div",{className:"w-full rounded-lg border border-token-border-light text-left text-sm",children:i?.instructions?.length?e.jsx("div",{className:"mx-4 my-3 line-clamp-4",children:i.instructions}):e.jsxs("div",{className:"flex h-full w-full items-center px-4 py-3 text-token-text-secondary",children:[e.jsx("div",{className:"flex-1",children:e.jsx(f,{...c.addCustomInstructions})}),e.jsx(A,{className:"icon-sm"})]})})}),m.includes(Re.GizmoInstructionsTooLong)?e.jsx(je,{className:"mt-1",children:e.jsx(f,{...c.instructionsTooLong,values:{length:G}})}):null]}),r&&e.jsx(ve,{gizmo:s,onClose:()=>{d(!1)}}),e.jsx(At,{gizmoId:s.gizmo.id,gizmoName:s.gizmo.display.name,gizmoEditorData:i,openFileDialog:ee,pendingFiles:y,pendingFileUpsertMutationsRef:g,setVersion:v,currentModelConfig:h}),Ne&&e.jsxs(z,{children:[e.jsx(Ge,{}),e.jsx("h3",{children:e.jsx(f,{...c.dragInstructions})}),e.jsx("h4",{className:"w-2/3 text-center",children:W.length>0?W.join(", "):e.jsx(f,{...c.dragAllAccepted})})]}),ke&&e.jsxs(z,{children:[e.jsx(bt,{className:"icon-2xl"}),e.jsx("h3",{children:e.jsx(f,{...c.dragTooManyFiles})}),e.jsx("h4",{className:"w-2/3 text-center",children:e.jsx(f,{...c.dragTooManyFilesDescription,values:{MAX_FILES_PER_PROJECT:E}})})]})]})});function Lt({gizmo:t,onClose:s}){const n=p.useRef(null),o=p.useCallback(()=>{n.current?.openFileDialog()},[n]);return e.jsx(e.Fragment,{children:e.jsx(xe,{className:"min-h-72 max-w-[820px]",isOpen:!0,showCloseButton:!0,hideSeparator:!0,noPadding:!0,size:"custom",type:"success",onClose:()=>{s()},children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx(_.TitleBar,{$hasSeparator:!1,children:e.jsxs("div",{className:"flex w-full items-center gap-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx(ht,{className:"text-lg font-semibold leading-6 text-token-text-primary",children:e.jsx(f,{...c.projectFilesModalTitle})})}),e.jsx(pt,{color:"secondary",onClick:o,children:e.jsx(f,{...c.addFilesButtonLabel})}),e.jsx(gt,{asChild:!0,className:"sm:mt-0",children:e.jsx(jt,{onClick:s})})]})}),e.jsx("div",{className:"h-[50dvh] flex-grow overflow-y-auto pt-0",children:e.jsx(Ut,{ref:n,gizmo:t,showInstructions:!1})})]})})})}function Bt({gizmo:t}){return e.jsx("div",{className:"mt-6 grid grid-cols-1 items-start gap-5 xs:grid-cols-2",children:t?e.jsxs(e.Fragment,{children:[e.jsx(Rt,{gizmo:t}),e.jsx(zt,{gizmo:t})]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{}),e.jsx(ne,{})]})})}function Q({header:t,context:s,contextClassName:n="",icon:o,modal:a,onClick:r,disabled:d=!1,isModalOpen:l=!1}){return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:r,className:S("group/snorlax-control-tile relative h-full rounded-2xl border border-token-border-xlight bg-token-main-surface-primary shadow-xxs hover:bg-token-main-surface-secondary active:bg-token-main-surface-tertiary active:drop-shadow-none",d&&"pointer-events-none"),children:e.jsxs("div",{className:"relative mx-5 my-4 flex items-center justify-between gap-3 overflow-hidden",children:[e.jsxs("div",{className:"w-full grow text-left",children:[e.jsx("div",{className:"text-sm font-medium",children:t}),e.jsx("div",{className:S("text-xs text-token-text-secondary",n),children:s})]}),o]})}),l&&a]})}function ne(){return e.jsx(Q,{disabled:!0,header:e.jsx("div",{className:"my-2 h-2 w-48 rounded-full bg-token-main-surface-secondary"}),context:e.jsx("div",{className:"my-2 h-2 w-32 rounded-full bg-token-main-surface-secondary"})})}function Rt({gizmo:t}){const{files:s}=t,n=!s.length,o=Z(t),[a,r]=p.useState(!1),d=a&&e.jsx(Lt,{gizmo:t,onClose:()=>{r(!1)}}),l=()=>r(!0);let i,m,u;if(n)i=e.jsx(f,{...c.addFilesButtonLabel}),m=e.jsx(f,{...c.filesControlDescription}),u=e.jsxs("div",{className:"relative flex h-10 w-10 shrink-0 items-center justify-center rounded-full",children:[e.jsx("div",{className:"absolute h-full w-full rounded-full bg-token-main-surface-secondary opacity-5",style:{backgroundColor:o??void 0}}),e.jsx(ce,{className:"icon-md h-5 w-5",style:{color:o}})]});else{const j=s.slice(0,3);i=e.jsx(f,{...c.projectFilesModalTitle}),m=e.jsx(f,{...c.filesCount,values:{count:s.length}}),u=e.jsx("div",{className:"relative flex h-10 w-20 shrink-0 items-center justify-center rounded-full",children:j.toReversed().map((x,v)=>e.jsx(Gt,{file:x,index:v,gizmoId:t.gizmo.id},x.id))})}return e.jsx(Q,{isModalOpen:a,modal:d,onClick:l,header:i,context:m,icon:u})}function Gt({file:t,index:s,gizmoId:n}){const o=t.name,r=U(o)&&t.file_id!=null&&e.jsx(K,{fileName:o,fileId:t.file_id,gizmoId:n});return e.jsx("div",{className:"absolute right-0 top-0 h-10 w-10 overflow-hidden rounded-xl border-2 border-token-main-surface-primary group-hover/snorlax-control-tile:border-token-main-surface-secondary",style:{transform:`translateX(${s*-20}px)`},children:r||e.jsx(Ze,{className:"h-9 w-9 flex-shrink-0",filename:t.name,contextConnectorInfo:void 0})})}function zt({gizmo:t}){const{instructions:s}=t.gizmo,n=!s.length,o=Z(t),[a,r]=p.useState(!1),d=a&&e.jsx(ve,{gizmo:t,onClose:()=>{r(!1)}}),l=()=>r(!0);let i,m,u,h;return n?(i=e.jsx(f,{...c.customInstructionsTitle}),m=e.jsx(f,{...c.customInstructionsDescription}),u=e.jsxs("div",{className:"relative flex h-10 w-10 shrink-0 items-center justify-center rounded-full",children:[e.jsx("div",{className:"absolute h-full w-full rounded-full bg-token-main-surface-secondary opacity-5",style:{backgroundColor:o??void 0}}),e.jsx(A,{className:"icon-md h-5 w-5",style:{color:o}})]})):(i=e.jsx(f,{...c.editCustomInstructionsTitle}),h="overflow-hidden text-ellipsis whitespace-nowrap",m=s),e.jsx(Q,{isModalOpen:a,modal:d,onClick:l,header:i,context:m,icon:u,contextClassName:h})}const Ht=B.h3`p4 overflow-hidden text-ellipsis break-all py-3 px-4 text-xs font-semibold text-token-text-secondary`,Xt=B.div`h-24 w-full rounded-3xl bg-token-main-surface-secondary`,Zt=()=>e.jsx("div",{className:"ml-1 mt-3 h-10",children:e.jsx("div",{className:"my-[15px] h-[10px] w-48 rounded-full bg-token-main-surface-secondary"})}),oe=new Map;function Yt(t){const s=oe.get(t);if(s)return s;const n=it($t,2e3,{trailing:!0});return oe.set(t,n),n}async function $t({gizmoId:t,upsertProjectMutation:s,toaster:n}){const o=ct,a=se(o.getState(),"theme",t);try{a!==void 0&&await s.mutateAsync({id:t,update:{theme:a??void 0}}),se(o.getState(),"theme",t)===a&&lt(t,"theme")}catch(r){const d=fe(r);n.warning(d??"Error",{duration:2})}}function Jt({gizmoId:t,theme:s,upsertProjectMutation:n,toaster:o}){at(t,"theme",s),Yt(t)({gizmoId:t,upsertProjectMutation:n,toaster:o})}function Kt({gizmo:t}){const s=t.gizmo.display.emoji,n=Z(t),o=tt(),a=L(),[r,d]=p.useState(!1),l=Y();if(o&&s)return e.jsx(st,{emoji:s,className:"icon-lg text-2xl"});const i=m=>{m!==n&&($.logEvent(J.projectsThemeChange,{theme:m??"default"}),Jt({gizmoId:t.gizmo.id,theme:m,upsertProjectMutation:a,toaster:l}))};return e.jsx(nt,{open:r,sideOffset:4,alignOffset:7,side:"bottom",alignAgainstAnchor:"start",size:"none",modal:!0,onOpenChange:m=>d(m),triggerButton:e.jsx(he,{currentTheme:n,isPopoverOpen:r}),children:e.jsx(Ft,{currentTheme:n,onSelect:i})})}function Qt({gizmo:t}){return e.jsxs("div",{className:"mb-6 flex w-full flex-col px-4",children:[t?e.jsx(Kt,{gizmo:t}):e.jsx(he,{disabled:!0,currentTheme:null,isPopoverOpen:!1}),t?e.jsxs("button",{className:"group ml-1 mt-3 self-start text-balance text-left text-4xl font-semibold hover:text-token-text-secondary",onClick:()=>{de.setShowProjectSettingsModal(!0)},children:[t.gizmo.display.name,e.jsx(A,{className:"icon-lg ml-2.5 inline-block text-token-text-secondary opacity-0 can-hover:group-hover:opacity-100 motion-safe:transition-opacity motion-safe:duration-100"})]}):e.jsx(Zt,{})]})}function Vt({children:t}){return e.jsx("div",{className:"group relative flex flex-col gap-1 p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(ue,{className:"icon-md text-token-sidebar-icon"}),t]})})}function Wt({conversation:t,gizmo:s}){const n=vt(t.id,l=>l?.title)??t.title,[o,a]=p.useState(!1);p.useEffect(()=>yt(kt,{editTitleInMainScreen:({serverThreadId:l})=>{l===t.id&&a(!0)}}),[t.id]);const{snippet:r}=t,d=e.jsxs(Vt,{children:[e.jsxs("div",{className:"flex-grow overflow-hidden can-hover:group-hover:mr-5",children:[o?e.jsx(rt,{conversation:t,onClose:()=>{a(!1)}}):e.jsx("div",{className:"text-sm font-medium",children:n}),r&&e.jsx("div",{className:"truncate text-sm text-token-text-secondary",children:r})]}),!o&&e.jsx(qt,{conversation:t})]});return o?d:e.jsx(we,{to:ot(t.id,s),draggable:!1,children:d})}function qt({conversation:t}){const[s,n]=p.useState(!1);return e.jsx("div",{className:S("absolute bottom-0 top-0 items-center gap-1.5 pr-4 ltr:right-0 rtl:left-0",s?"flex":"hidden can-hover:group-hover:flex"),onClick:o=>{o.preventDefault()},children:e.jsx(dt,{conversation:t,conversationTitle:t.title,onOpenChange:o=>{n(o),o&&$.logEvent(J.conversationHistoryItemOpenMenu,{conversationId:t.id})},inMainScreen:!0})})}function es({gizmo:t}){qe(t.gizmo.id);const{items:s,hasNextPage:n,fetchNextPage:o,isLoading:a,isFetching:r,isFetchingNextPage:d}=et(t.gizmo.id),l=p.useRef(null),i=p.useCallback(u=>{a||u==null||(l.current?.disconnect(),l.current=new IntersectionObserver(h=>{h[0].isIntersecting&&n&&!r&&o()}),l.current.observe(u))},[a,n,o,r]);p.useEffect(()=>()=>{l.current?.disconnect()},[]);const m=s.length;return e.jsxs("div",{className:"mb-14 mt-6",children:[m||a?e.jsx(ss,{gizmo:t,items:s??[],hasNextPage:n,infiniteScrollTriggerElementRef:i}):e.jsx(ts,{}),d&&e.jsx("div",{className:"m-4 mb-5 flex justify-center",children:e.jsx(me,{})})]})}function ts(){return e.jsxs("div",{className:"mt-20 flex flex-col items-center font-medium",children:[e.jsx(ue,{className:"icon-lg mb-2 text-token-icon-secondary"}),e.jsx("div",{className:"text-sm text-token-text-secondary",children:e.jsx(f,{...c.emptyChatsInProjectTitle})})]})}function ss({gizmo:t,items:s,hasNextPage:n,infiniteScrollTriggerElementRef:o}){const a=s.length;return e.jsxs(e.Fragment,{children:[e.jsx(Ht,{children:e.jsx(f,{...c.chatsInProjectTitle})}),e.jsx("ol",{children:s.map((r,d)=>{const l=n&&d===s.length-3?o:void 0;return e.jsx("li",{ref:l,className:S("first:rounded-t-lg last:rounded-b-lg hover:bg-token-main-surface-secondary",d!==a-1&&"border-b border-token-border-xlight"),children:e.jsx(Wt,{conversation:r,gizmo:t})},r.id)})})]})}function bs({clientThreadId:t,gizmoId:s,currentModelId:n,onRequestCompletion:o}){const a=O(),{data:r}=Ye(s),d=$e(x=>x.showProjectSettingsModal),[l,i]=p.useState(!1),m=Je(),u=Ke(),h=u!=null&&u.kind==="conversation"&&(u.gizmoId==null||u.gizmoId!==s),j=p.useRef(0);return e.jsx("div",{onDragOver:x=>{x.preventDefault(),h&&i(!0)},onDrop:x=>{x.preventDefault(),h&&(j.current=0,i(!1),m({newGizmoId:s,conversation:u.conversation,previousGizmoId:u.gizmoId??null}))},onDragEnter:x=>{x.preventDefault(),h&&(j.current+=1)},onDragLeave:x=>{x.preventDefault(),h&&(j.current-=1,j.current===0&&i(!1))},children:e.jsxs(Qe,{isStaticSharedThread:!1,verticalPadding:"none",horizontalPadding:"standard",clientThreadId:t,fullHeight:!0,children:[e.jsx(Qt,{gizmo:r}),r?e.jsx(Nt,{clientThreadId:t,isNewThread:!0,currentModelId:n,onRequestCompletion:o,hideHeader:!0,showPromptStarters:!1}):e.jsx(Xt,{}),e.jsx(Bt,{gizmo:r}),r&&e.jsx(es,{gizmo:r}),d&&e.jsx(Ve,{submitButtonTitle:a.formatMessage(c.projectSettingsSubmitButton),gizmo:r,onClose:()=>{de.setShowProjectSettingsModal(!1)}},s),l&&e.jsxs(z,{children:[e.jsx(We,{className:"h-12 w-12",style:{color:"#3C46FF"}}),e.jsx("h3",{className:"text-center",children:e.jsx(f,{...c.addConversationToNamedSnorlax,values:{projectName:r?.gizmo.display.name??"project"}})}),e.jsx("h4",{className:"text-center",children:e.jsx(f,{...c.moveConversation})})]})]})})}export{bs as SnorlaxSplashScreen};
//# sourceMappingURL=gygy8wqvfvqbj4sk.js.map
