import{e1 as f,cc as p,b as _,p as c,aM as m,ao as w,fi as h,_ as g,aE as l,aH as u,af as y,ag as S}from"./n9zp7vm10xoipejo.js";import{cH as b,cI as F,cJ as V,e as E}from"./l4oo5ijw01fyrjzs.js";import{u as d,r as i}from"./lip667d8t42poxum.js";import{i as x}from"./jpfsl7zlesohw8kt.js";function D(){const a=E(),e=w();return e&&a&&!h(a)&&e.isEnterprisey()}function R(){return f(p.ChartSerialization)}function k(a,e){const t=a==="chart"?l.HasSeenAdaInteractiveChart:l.HasSeenAdaInteractiveTable,[s,o]=i.useState(u.getItem(t,{userId:e})??!1),n=i.useCallback(()=>{o(!0),u.setItem(t,!0,{userId:e})},[t,e]);return[s,n]}function L(a){const[e,t]=i.useState([]),s=y(a,S.getBranch);return i.useEffect(()=>{const o=z(s);o.length!==e.length&&t(o)},[e.length,a,s]),e}function I(a){const e=a.metadata?.aggregate_result?.messages.filter(x)??[];let t=0;const s=(a.metadata?.ada_visualizations??[]).map(n=>{let r=n;return n.type=="chart"&&(r={...n,fallback_image:e[t++]}),r}),o=(a.metadata?.attachments??[]).filter(n=>b(n.name)).map(n=>({type:"table",file_id:n.id??"",title:F(n),file_name:n.name,context_connector_info:n.context_connector_info}));return[...s,...o]}function z(a){return a.filter(t=>t.message?.author.role==="tool"&&t.message?.author.name==="python"||(t.message?.metadata?.attachments??[]).length>0).flatMap(t=>I(t.message))}async function T(a,e,t){const s=await a.text(),{parse:o}=await g(async()=>{const{parse:r}=await import("./oeujip5i1ptrxie5.js");return{parse:r}},[]),n=o(s);return{content:{columnNames:n.shift(),columnTypes:n[0].map(()=>"string"),rows:n},file_name:e,download_url:t}}function A(a){const e=a[0].values.length,t=[];for(let s=0;s<e;s++){const o=a.map(n=>n.values[s]);t.push(o)}return t}function M(a){return d({queryKey:["ada-visualization","chart",a.file_id],queryFn:async()=>{const e=await c.getFileDownloadLink(a.file_id);if(e.status===m.Success){const s=await(await fetch(e.download_url)).json();return{content:{chart_type:s.type,title:s.title,labels:s.labels,datasets:s.datasets,x_label:s.x_label,y_label:s.y_label},file_name:e.file_name??"",download_url:e.download_url}}else throw new Error("Failed to download chart json from interpreter")}})}function N(a){return d({queryKey:["ada-visualization","table",a.file_id],queryFn:async()=>{if(a.file_name&&V(a.file_name)){const e=await _.safeGet("/ada/parse_xls/{file_id}",{parameters:{path:{file_id:a.file_id}}});return{content:e.sheets.map(t=>({name:t.name,columnNames:t.columns.map(s=>s.name),columnTypes:t.columns.map(()=>"string"),rows:A(t.columns)})),download_url:e.download_url,file_name:a.file_name}}else{const e=await c.getFileDownloadLink(a.file_id);if(e.status===m.Success){const t=await fetch(e.download_url);return T(t,e.file_name??"",e.download_url)}else throw new Error("Failed to download from interpreter")}},throwOnError:!1})}export{L as a,N as b,M as c,D as d,k as e,I as g,R as u};
//# sourceMappingURL=e877fc11doq1u008.js.map
