import{r as w,j as n}from"./lip667d8t42poxum.js";import{C as G}from"./gjiz1x2c93bpopnz.js";import{D as F,a as q}from"./l93ryxq3tn95q8jd.js";import{T as J,a as K,A as k,u as Q,i as X,C as Y,g as Z}from"./jabowwh76eo1vv7l.js";import{C as $,c as z}from"./ih9k1uv73hv8ykht.js";import{C as V}from"./18qxc8hgbxoxyv64.js";import{u as tt,b as ot,c as et,d as P}from"./knkf8s9jgm6dk4eu.js";import{C as rt}from"./jy1u8exw8iz2slve.js";import{g as nt,jv as it,jw as M,jx as st}from"./l4oo5ijw01fyrjzs.js";import{y as lt}from"./n9zp7vm10xoipejo.js";import"./m8nue0mm3lfcgljv.js";import"./bl5o9qxisdgzsskx.js";import"./krf7zg7fy4qqowqq.js";import"./j385t288u9l3nf6j.js";import"./ezoyp421dng92ve4.js";import"./d5srgqurg48kxugz.js";import"./j8vdq5u0dah3tad5.js";import"./eef33l65z4kyipsv.js";import"./ju8q15l0hqy6ti9z.js";import"./ef49rx2y546x1g51.js";import"./joi56n2i6g6stgfp.js";import"./gy64pge8qevmvg7e.js";import"./d7qhj0hizrl5q10d.js";import"./bk8slwxjkdlmxjxm.js";import"./h6u5tn9ugd2tunyc.js";import"./pb0xfopp3f7joxj4.js";import"./n4y4yo9zuw99bnsn.js";import"./cbaql59zac1mfnmh.js";import"./op1xowyjquc2dnq7.js";import"./nmzcjggnos81a3wt.js";import"./oour34cwuwf9tyoh.js";import"./czpmep8a1gn2yxp9.js";import"./g1x7jf9g2b4osi6b.js";import"./kdkl0k5zipatley9.js";import"./gydkbc6xtfcf9567.js";import"./fcb0ae0r80625132.js";import"./kweqtgafphozzl00.js";import"./bir4gwnbq17hkvt3.js";import"./fgib8os5mzfls06e.js";function ct(t,o){const l=t.doc.lineAt(o.from);return o.from===l.from&&o.to-1===l.to}function mt(t){const o=t.dom.querySelector(".cm-gutters");return o?o.offsetWidth:0}const at=({onAddComment:t,isSendDisabled:o=!1,isWaitingForCommentResponse:l=!1})=>{const e=tt(),u=ot(),c=et(),v=w.useCallback(i=>{const{height:m,width:a}=i,r=e();if(!u||!r)return null;const d=u.selection.asSingle();if(d.ranges.length===0)return null;const s=d.ranges[0],{empty:D,to:L}=s;let{head:f}=s;const{platform:H}=nt();f=H==="web"?f:L;const g=f===L;let h=f;if(g&&ct(u,s)&&(h-=1),D)return null;const{left:O,top:x,bottom:R}=r.contentDOM.getBoundingClientRect(),{left:j,top:I,bottom:C}=lt(r.coordsAtPos(h,g?-1:1)),E=mt(r);function N(){if(g)return Math.max(j-O+E-a,E);let p=j-O+E;return p+a>c&&(p=-(a-c)),p}function A(p){const T=m*2,_=p.contentHeight-(C-R)>T&&window.innerHeight-C>T,y=C-x+8,W=I-x-m-8;return g&&_||W<0?{top:y,aboveOrBelow:k.BELOW}:{top:W,aboveOrBelow:k.ABOVE}}const b=A(r);return{left:N(),top:b.top,aboveOrBelow:b.aboveOrBelow,toolbarSize:i}},[u,e,c]),B=w.useCallback(()=>e()?.dom??null,[e]);return n.jsx(J,{onAddComment:t,isWaitingForCommentResponse:l,isSendDisabled:o,toolbarType:K.CODE,getToolbarPosition:v,getEditorDom:B,getSelectionRange:()=>{const i=e();if(!i)return null;const{state:m}=i,a=m.selection.asSingle();if(a.ranges.length===0)return null;const r=a.ranges[0],{from:d,to:s}=r;return d==null||s==null?null:{from:d,to:s,sourceFrom:d,sourceTo:s}}})};function dt({diff:t}){return Q(t?.edits??[]),null}function ut(t,o,l){const e=l?Z():0;return t<=1e3-e?t-(o?$:0):t-(o?z:0)}const $t=({comments:t,currentlyStreamingLineIndex:o,isPreview:l=!1,isWaitingForCommentResponse:e=!1,isSendDisabled:u=!1,readonlyReason:c,isRequestActive:v=!1,language:B,value:i,textdocDiff:m,onAcceleratorsExpandedChange:a,onAddComment:r,onAcceptComment:d,onDismissComment:s,onBlur:D,onSave:L,onChange:f,onCancelRequest:H,getStableCommentId:g=st,commentsMode:h=V.ENABLED,hideToolbar:O,hideAccelerators:x=!1,onSubmitAccelerator:R,modelCursor:j,codemirrorRef:I})=>{const C=w.useRef(null),[{width:E},N]=it(),A=w.useRef(null),b=t.length>0,p=A.current,T=ut(E,b,X(p)??!1),_=P(({commentingOn:S})=>S),y=P(({hoveredCommentId:S})=>S),W=P(({focusedCommentId:S})=>S);w.useEffect(()=>{C.current?.UNSAFE_setValue(i||"")},[i]);const U=E-T;return n.jsx("div",{className:rt.code,ref:M(N,A),children:n.jsxs(G,{id:"codemirror",comments:h===V.ALL_HIDDEN?void 0:t,commentingOn:_,currentlyStreamingLineIndex:o,hoveredCommentId:y,focusedCommentId:W,language:B,readonlyReason:c,onChange:f,value:i,textdocDiff:m,editorRef:M(C,I),width:T,modelCursor:j,isPreview:l,onBlur:D,onSave:L,children:[n.jsxs(G.EditorChildren,{children:[!O&&n.jsx(at,{onAddComment:r,isSendDisabled:u,isWaitingForCommentResponse:e}),h!==V.ALL_HIDDEN&&n.jsx("div",{className:b?"me-4":"",children:n.jsx(Y,{getStableCommentId:g,availableWidth:U,comments:t,commentsMode:h,onAddComment:r,onAcceptComment:d,onDismissComment:s,isWaitingForCommentResponse:e,isRequestActive:v,disableBlockComments:!0})})]}),n.jsxs(G.ContextChildren,{children:[m&&n.jsx(dt,{diff:m}),!x&&n.jsx(F,{isRequestActive:v,isVisuallyHidden:u||!!c?.isStreamingFromNative||c?.isReadonly&&!c.isStreaming,onSubmit:R,onCancel:H,actions:q,onExpandedChange:a})]})]})})};export{$t as CodeComposer};
//# sourceMappingURL=hb961hqxvj08huuv.js.map
