import{m as b,E as j,cb as v,eo as R}from"./n9zp7vm10xoipejo.js";import{a as A,f as q,r as e,j as n,a9 as F,d as L,h as M,D as N}from"./lip667d8t42poxum.js";import{u as Q}from"./czggc31pvriqx4wb.js";import{e as U,f as K,c as O,W as $,d as B}from"./ojvadmnty96xvqkr.js";import{b as G,c as H}from"./nmzcjggnos81a3wt.js";import{P as Z}from"./ezoyp421dng92ve4.js";import{fZ as z}from"./l4oo5ijw01fyrjzs.js";import{u as J,W as V}from"./8jh1d59j0bidwcwx.js";import{i as X}from"./fw89hpm6ehbsygz7.js";import"./krf7zg7fy4qqowqq.js";import"./j385t288u9l3nf6j.js";import"./gssjqrozvzmyjg6o.js";import"./d7qhj0hizrl5q10d.js";import"./j1bb88glgmel43br.js";import"./n7emuv1efbtdnxb9.js";import"./ef49rx2y546x1g51.js";import"./d61ttkht2554hc14.js";import"./iguubsmy82ykz2l9.js";import"./ex0w8u6azfclal10.js";import"./xbx5ij165jfnp313.js";import"./oc4rktd8eofx28ec.js";import"./h6u5tn9ugd2tunyc.js";import"./pb0xfopp3f7joxj4.js";import"./fcfjbsbarhrilkf6.js";import"./ocylzx9oqlg8ycwm.js";import"./jilfkjkciycvhk2x.js";import"./f64hg6fdq8ojkhjz.js";import"./ju8q15l0hqy6ti9z.js";import"./gydkbc6xtfcf9567.js";import"./btgi4ch9w5xby7vu.js";import"./es0z9v8doc0hgjd4.js";import"./jpfsl7zlesohw8kt.js";import"./ctz8d92lx4gyhixb.js";import"./cg71y7d9v77500qa.js";import"./m27zu1gl0gszchhw.js";import"./s0vortm3fnmb5s99.js";import"./bz6kdye13oi6n32b.js";import"./b2byc8rvxtjtrqes.js";import"./bir4gwnbq17hkvt3.js";import"./ls58p44u0ovqzhvw.js";import"./oe646f7iouawgq3e.js";function Y({taskId:s,onClose:a}){const o=A(),m=b(),i=q(),{data:t,error:x}=U(s);K(s);const g=O(({getTurnsForTask:r})=>r(s)),u=j(),c=e.useMemo(()=>u?new Z(G()):new z,[u]),p=e.useSyncExternalStore(r=>c.subscribe("change",r),()=>!c.isEmpty(),()=>!1),[f,l]=e.useState([]),[P,d]=e.useState(!1),{focusedAssistantTurn:_,setFocusedAssistantTurnId:D}=J({taskId:s,task:t?.task,currentDiffTaskTurn:t?.current_diff_task_turn??null,currentUserTurn:t?.current_user_turn??null,currentAssistantTurn:t?.current_assistant_turn??null}),C=!!t?.task.has_unread_turn&&t?.task?.current_turn_id===t.current_assistant_turn?.id,k=t?.current_assistant_turn?.turn_status==="completed";e.useEffect(()=>{if(!u)return;const r=t?.task?.title;if(r){const y=document.title;return document.title=r,()=>{document.title=y}}},[u,t?.task?.title]),e.useEffect(()=>{C&&k&&$.markTurnAsRead(s).then(()=>{o.invalidateQueries({queryKey:["wham","tasks"]}),o.invalidateQueries({queryKey:["wham","task",s]})})},[C,k,s,o]);const h=f.length>0,T=e.useCallback(({force:r=!1}={})=>{if(r||!h&&!p){l([]),a();return}d(!0)},[a,h,p]),E=t?.current_assistant_turn?X(t?.current_assistant_turn.turn_status):!1,S=t?.current_diff_task_turn?.id===_?.id,W=!t?.current_diff_task_turn,w=E&&(S||W);return x?(m.danger(i.formatMessage({id:"wham.task-details.error",defaultMessage:"Error loading task"}),{id:`wham-task-details-error-${s}`,hasCloseButton:!0,duration:3}),n.jsx(F,{to:"/codex"})):n.jsx(H.Provider,{value:c,children:n.jsx(V,{permissions:"write",onEscape:T,taskId:s,turnId:t?.current_assistant_turn?.id??"",lastTurnWithDiffId:t?.current_diff_task_turn?.id??"",confirmClose:P,setConfirmClose:d,task:t?.task,focusedAssistantTurn:_,pastTurns:g,clearComments:()=>l([]),setComments:l,comments:f,canFollowUp:w,handleClose:T,setFocusedAssistantTurnId:D})})}function I(){const s=L(),a=M(),{taskId:o}=N();Q(),B();const m=a.state??{},{backgroundLocation:i}=m,t=e.useCallback(()=>{s(i?-1:"/codex")},[i,s]);return o?n.jsx(v,{children:n.jsx(Y,{taskId:o,onClose:t})}):null}const Kt=()=>[{title:"Codex"}],Ot=R(function(){return n.jsx(I,{})});export{Ot as default,Kt as meta};
//# sourceMappingURL=yc6z6h3jxikpnw83.js.map
