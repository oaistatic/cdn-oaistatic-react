const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/de73pvgvm912man2.js","assets/n9zp7vm10xoipejo.js","assets/lip667d8t42poxum.js","assets/root-ivmjnum3.css","assets/l4oo5ijw01fyrjzs.js","assets/conversation-small-k5k9c71c.css","assets/g1k10sykivgpvvsx.js","assets/irn30nlj5bjf7c0s.js","assets/klihi3sbpg7j86o3.js","assets/kweqtgafphozzl00.js","assets/lt5u077njj9ud9u7.js","assets/joi56n2i6g6stgfp.js","assets/gy64pge8qevmvg7e.js","assets/j5o8dq8sjlm4tiu2.js","assets/h2xyil3hz732ienl.js","assets/jxc5nv9h2vsyvrs7.js","assets/cjoinavnvuwlgfi7.js","assets/ckbz75q6i800q4u0.js","assets/opsxtezzixxn17wf.js"])))=>i.map(i=>d[i]);
import{j as e,r as l,M as B,g as ot,ap as Vn,an as zn,ak as Ls,a5 as H,d as Wn,a6 as xe,f as Ae,R as $n,p as Yn}from"./lip667d8t42poxum.js";import{e as rt,fp as Xn,l2 as $e,et as Kn,jo as Qn,jr as Jn,ql as Zn,v as it,qm as Ds,qn as ea,qo as sa,qp as Me,qq as ta,az as lt,qr as na,hW as aa,hX as oa,a0 as pe,fA as ct,W as ra,c0 as ia,kR as dt,qs as la,qt as ca,dH as da,qu as ut,fT as ua,fU as ma,fX as ga,fV as ha,qv as pa,a$ as mt,X as gt,qw as ht,eJ as fa,ew as K,aF as xa,qx as va,an as ba,qy as ya,qz as _a,oi as ns,bI as pt,qA as Sa,qB as Ta,nd as ja,qC as Ca,qD as Ma,qE as ka,qF as ke,kK as wa,qG as Ia,qH as ft,bo as Ea,db as Na,qI as Ra,i1 as fe,by as xt,U as vt,bt as Aa,ax as bt,bu as Fa,aw as yt,qJ as Pa,qK as La,i3 as Da,hM as Ua,n1 as Ba,qL as qa,bd as _t,be as St,cV as Tt,d as Oa,qM as Ga,my as Ha,c_ as Va,y as jt,d_ as za,qN as Wa,pf as Ct,e6 as $a,hG as Ya,mQ as Xa,O as Ka,dd as Mt,qO as Qa,hV as Ja,qP as Za,cX as eo,qQ as so,iO as to,aG as no,qR as ao,qS as oo,qT as ro,n0 as io,jB as lo,cZ as co,qU as uo,qV as mo,qW as go,mR as ho,qX as po,qY as fo,nB as Ye,qZ as xo,nC as Ee,q_ as Xe,q$ as vo,r0 as bo,r1 as yo,cA as _o,jD as So,n5 as To,mZ as jo,r2 as Co,r3 as Mo,r4 as ko,ik as wo,R as Io,pl as Eo,r5 as No,r6 as Ro,r7 as Ao,r8 as Fo,r9 as Po,ra as Lo,rb as Do,rc as Uo,c1 as Bo,H as qo,pD as Oo,mf as Go,mg as Ho}from"./l4oo5ijw01fyrjzs.js";import{c as D,X as ue,_ as ge,F as oe,aX as Ne,bL as A,dQ as as,ag as L,aa as z,gM as kt,ec as Vo,af as te,aY as de,cA as os,b9 as me,fX as zo,ce as wt,aI as Wo,b as It,d as Et,B as Nt,y as Us,at as Ke,aj as q,c0 as Q,ao as rs,aJ as ae,fr as Rt,ae as Re,ga as $o,bQ as Yo,dh as Xo,di as Ko,aO as se,bX as Qo,he as Jo,g as is,m as At,dH as Zo,dO as er,d$ as Ft,cP as sr,bC as Pt,hf as tr,v as Qe,W as nr,dj as ls,as as Lt,aL as Je,d9 as ar,eA as or,fi as rr,s as Oe,g9 as Ge,ci as ir,dg as lr,cv as cr,f9 as dr,bb as He,gS as ur,gT as mr,dX as gr,e6 as Bs,dY as hr,gG as pr,ah as fr,eJ as xr,dR as vr}from"./n9zp7vm10xoipejo.js";import"./bir4gwnbq17hkvt3.js";import{M as br,O as yr}from"./flqsbet8wo14mte0.js";import{d as _r,b as qs}from"./g1wxldf6nb3zk37x.js";import{a as Sr,G as Tr}from"./oour34cwuwf9tyoh.js";import{C as Ze,F as jr}from"./ju8q15l0hqy6ti9z.js";import{b as Dt}from"./ef49rx2y546x1g51.js";import{u as Ut}from"./czpmep8a1gn2yxp9.js";import{u as Cr}from"./kdkl0k5zipatley9.js";import{a as Bt}from"./op1xowyjquc2dnq7.js";const Mr="bg-token-main-surface-primary text-token-text-primary",kr="openai",Os=["bg-blue-300 text-white"];function wr(t){return Os[(t?.charCodeAt(0)??0)%Os.length]}const we=({children:t})=>e.jsx("div",{className:"pt-0",children:e.jsx("div",{className:D(l.isValidElement(t)&&t.type===$e?"gizmo-bot-avatar":"gizmo-shadow-stroke","flex h-8 w-8 items-center justify-center overflow-hidden rounded-full"),children:t})});function es(t){const{messages:n,isUserTurn:a,avatarClassName:s,gizmo:o}=t,r="medium",d=n[0]?.metadata?.shared_conversation_id,i=d!=null,g=rt(),{gizmoEditorData:u,mode:x}=Xn();let p=e.jsx(we,{children:e.jsx($e,{className:s??Mr,iconName:kr,size:r})});return o?p=e.jsx(we,{children:e.jsx(Sr,{gizmoId:o.gizmo.id,className:"h-full w-full"})}):u!=null&&x==="test"&&(p=e.jsx(Tr,{isFirstParty:!1,src:u.profilePictureUrl,className:"h-8 w-8 first:pt-[3px]"})),e.jsx("div",{className:void 0,children:a?i?e.jsx(we,{children:e.jsx($e,{className:wr(d),iconName:"user",size:r})}):e.jsx(we,{children:e.jsx(Kn,{user:g,size:r})}):p})}const Gs=ue(()=>ge(()=>import("./de73pvgvm912man2.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(t=>t.MemoryActionResult));function Hs(t,n,a){de(t,s=>{os.updateTree(s,o=>{o.updateNodeMetadata(n,{inlineComparisonRating:a})})})}const Vs=({messages:t})=>{for(const{metadata:n}of t){const{paragen_display_label:a}=n??{};if(a)return a;const{augmented_paragen_prompt_label:s}=n??{};if(s)return s}};function Ir(t){const n=l.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),a=l.useRef({left:null,right:null});return t.variantIds.length<2?e.jsx(qt,{setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:n,firstVisibleTokenTimestampsRef:a,...t}):e.jsx(Er,{...t,visibilityStateRef:n,firstVisibleTokenTimestampsRef:a})}function Er(t){const{clientThreadId:n,variantIds:a,turnIndex:s,firstVisibleTokenTimestampsRef:o}=t;if(a.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const r=cs(),c=kt(),d=Vo(),[i,g]=a,u=l.useMemo(()=>it(i+g)()>=.5,[i,g]),[x,p]=u?[g,i]:[i,g],[y,m,T]=te(n,f=>{const E=Us(f).tree.getLeafFromNode(x).id,j=Us(f).tree.getLeafFromNode(p).id,S=L.getConversationTurns(f,E),_=L.getConversationTurns(f,j),F=s<S.length?S[s]:null,w=s<_.length?_[s]:null;return F||Ke.addError(`Paragen Left turn index ${s} out of bounds`,{turnIndex:s,turnCount:S.length,lastTurnRole:A(S)?.role,lastMessageAuthor:A(A(S)?.messages)?.author,lastMessageContentType:A(A(S)?.messages)?.content.content_type,lastMessageMetadata:A(A(S)?.messages)?.metadata,altTurnCount:_.length,altLastTurnRole:A(_)?.role,altLastMessageRole:A(A(_)?.messages)?.author.role}),w||Ke.addError(`Paragen Right turn index ${s} out of bounds`,{turnIndex:s,turnCount:_.length,lastTurnRole:A(_)?.role,lastMessageAuthor:A(A(_)?.messages)?.author,lastMessageContentType:A(A(_)?.messages)?.content.content_type,lastMessageMetadata:A(A(_)?.messages)?.metadata,altTurnCount:S.length,altLastTurnRole:A(S)?.role,altLastMessageRole:A(A(S)?.messages)?.author.role}),[E,F,w]}),[M,k]=u?[T,m]:[m,T],N=r?"skippable_parallel_2_in_stream:a:2.0":"skippable_parallel_2_in_stream:a:1.5";l.useEffect(()=>(Ds.setState({displayingSideBySideFeedback:!0}),()=>{Ds.setState({displayingSideBySideFeedback:!1})}),[]);const P=l.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),v=l.useCallback((f,{shouldSubmitParagenFeedback:E=!0}={})=>{if(!m||!T||!M||!k)throw new Error("Expected both turns to exist");de(n,I=>{os.setCurrentBranch(I,f)});const j=f===x,S=f===i;M.messages.length>0&&Hs(n,M.messages[M.messages.length-1].id,S?"original":"new"),k.messages.length>0&&Hs(n,k.messages[k.messages.length-1].id,S?"original":"new");const _=me(n),F=[m,T].map((I,U)=>({messageId:I.messages[I.messages.length-1].id,loadFirstTokenTime:U===0?o.current.left:o.current.right,loadEndTime:A(I.messages)?.clientMetadata?.completionSampleFinishTime})),w=j?F[0].messageId:F[1].messageId,h=L.getParentPromptNode(Ne(n),y);if(!h)throw new Error("Expected prompt for side by side feedback");const C={},R=h.message.clientMetadata?.variantsInStreamInfo==null&&h.message.metadata?.paragen_variants_info!=null;for(const I of F)C[I.messageId]=R?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:I.loadFirstTokenTime,load_end_time:I.loadEndTime};E&&Ks({params:{conversation_id:_,displayed_message_ids:F.map(I=>I.messageId),message_metadatas:C,rating:"selected",selected_message_id:w,source_timestamp:Date.now(),ui_variant:r?2:1,user_prompt_message_id:h.message.id}})},[n,x,i,M,k,m,T,y,o,t.conversationTurnMountTime,r]);return l.useEffect(()=>zo(wt,{requestCompletion:f=>{const E=me(n),j=L.getParentPromptNode(Ne(n),y);if(!j)throw new Error("Expected prompt for side by side feedback");if(!m||!T)throw new Error("Expected both turns to exist");const S=[m,T].map((h,C)=>({messageId:h.messages[h.messages.length-1].id,loadFirstTokenTime:C===0?o.current.left:o.current.right,loadEndTime:A(h.messages)?.clientMetadata?.completionSampleFinishTime})),_={},F=j.message.clientMetadata?.variantsInStreamInfo==null&&j.message.metadata?.paragen_variants_info!=null;for(const h of S)_[h.messageId]=F?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:h.loadFirstTokenTime,load_end_time:h.loadEndTime};const w=f.isForSkippingParagen;Ks({params:{conversation_id:E,displayed_message_ids:S.map(h=>h.messageId),message_metadatas:_,rating:w?"explicit_skipped":"skipped",selected_message_id:null,source_timestamp:Date.now(),ui_variant:w?3:r?2:1,user_prompt_message_id:j.message.id}}),w&&v(x,{shouldSubmitParagenFeedback:!1})}}),[m,T,y,n,t.conversationTurnMountTime,N,M?.messages,k?.messages,d,r,o,v,x]),e.jsx(qt,{...t,setPreferredFeedback:v,leftVariantId:x,rightVariantId:p,leftTurn:m,rightTurn:T,hasActiveRequest:c,originalTurn:M,visibilityStateRef:P})}function qt({setPreferredFeedback:t,leftVariantId:n,rightVariantId:a,leftTurn:s,rightTurn:o,hasActiveRequest:r,originalTurn:c,visibilityStateRef:d,...i}){const g=(s&&Vs(s))??null,u=(o&&Vs(o))??null,x=l.useMemo(()=>s?.messages??[],[s?.messages]),p=l.useMemo(()=>o?.messages??[],[o?.messages]),{avatarClassName:y,firstVisibleTokenTimestampsRef:m}=i,T=l.useMemo(()=>s?.messageGroups??[],[s?.messageGroups]),M=l.useMemo(()=>o?.messageGroups??[],[o?.messageGroups]),k=Qn(),N=Ne(i.clientThreadId),P=A(s?.messages),v=A(o?.messages),f=as(L.getRequestId(N,P?.id??v?.id)),E=f&&!P?.end_turn,j=f&&!v?.end_turn,S=s?.role===z.User,_=o?.role===z.User,F=l.useRef(null),w=l.useRef(null),h=l.useRef(null),C=s!=null,R=o!=null;!C&&m.current.left==null&&(m.current.left=Date.now()),!R&&m.current.right==null&&(m.current.right=Date.now()),l.useEffect(()=>{if(F.current&&w.current&&h.current){const Y=Array(11).fill(0).map((ve,J)=>J/10),X=new IntersectionObserver(ve=>ve.forEach(J=>{J.target===w.current?(d.current.left_visibility_initial==null&&(d.current.left_visibility_initial=J.intersectionRatio),d.current.left_visibility_max=Math.max(d.current.left_visibility_max??0,J.intersectionRatio)):J.target===h.current&&(d.current.right_visibility_initial==null&&(d.current.right_visibility_initial=J.intersectionRatio),d.current.right_visibility_max=Math.max(d.current.right_visibility_max??0,J.intersectionRatio))}),{root:F.current,threshold:Y});return X.observe(w.current),X.observe(h.current),()=>X.disconnect()}},[d]);const{data:I}=Jn(void 0,!1,k),U=cs(),ne=e.jsx("div",{className:"text-token-text-secondary px-(--thread-content-margin) pt-1 pb-5 text-center text-sm text-pretty",children:e.jsx(B,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})});return e.jsxs("div",{className:"relative flex flex-col",children:[e.jsxs("div",{className:D("bg-token-main-surface-primary sticky top-[-1px] z-1 px-(--thread-content-margin) text-center text-lg text-pretty",U?"md:top-header-height":"md:static"),"data-testid":"paragen-feedback-title",children:[e.jsx(B,{id:"KKeSJV",defaultMessage:"You're giving feedback on a new version of ChatGPT."}),U?ne:null]}),U?null:ne,e.jsx("div",{className:D(Zn,"horzScrollShadows relative -mb-2 snap-x snap-mandatory overflow-x-auto overflow-y-clip pb-4"),ref:F,children:e.jsxs("div",{className:D("mx-auto box-content max-w-[calc(2*var(--thread-content-max-width))] min-w-min px-(--thread-content-margin)","flex items-start",U&&"divide-token-border-medium dark:divide-token-border-heavy divide-x",!U&&"gap-4 sm:gap-6"),children:[e.jsxs(zs,{horizontalScrollContainerRef:F,rootElementRef:w,onClick:()=>{t(n)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:C,children:[e.jsxs(Ys,{children:[e.jsx(es,{messages:x,isUserTurn:S,avatarClassName:y}),e.jsx($s,{children:e.jsx(B,{...Qs.responseNumber,values:{responseIndex:1,display_label:g}})})]}),U&&C?e.jsx(Ws,{}):e.jsxs(e.Fragment,{children:[I!=null&&!S&&e.jsx(Gs,{clientThreadId:i.clientThreadId,messages:x,isParagen:!0}),e.jsx(Ze,{...i,allMessages:x,groupedMessagesToRender:T,allGroupedMessages:T,isUserTurn:S,isFinalUserTurn:!1,isCompletionRequestInProgress:E,hasActiveRequest:r,shouldGrowContainer:!1,isParagen:!0}),e.jsx(Xs,{clientThreadId:i.clientThreadId,conversationTurnMountTime:i.conversationTurnMountTime,turn:s,originalTurn:c})]})]}),e.jsxs(zs,{horizontalScrollContainerRef:F,rootElementRef:h,onClick:()=>{t(a)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:R,children:[e.jsxs(Ys,{children:[e.jsx(es,{messages:p,isUserTurn:_,avatarClassName:y}),e.jsx($s,{children:e.jsx(B,{...Qs.responseNumber,values:{responseIndex:2,display_label:u}})})]}),U&&R?e.jsx(Ws,{}):e.jsxs(e.Fragment,{children:[I!=null&&!_&&e.jsx(Gs,{clientThreadId:i.clientThreadId,messages:p,isParagen:!0}),e.jsx(Ze,{...i,allMessages:p,groupedMessagesToRender:M,allGroupedMessages:M,isFinalUserTurn:!1,isUserTurn:_,isCompletionRequestInProgress:j,hasActiveRequest:r,shouldGrowContainer:!1,isParagen:!0}),e.jsx(Xs,{clientThreadId:i.clientThreadId,conversationTurnMountTime:i.conversationTurnMountTime,turn:o,originalTurn:c})]})]})]})})]})}function zs({horizontalScrollContainerRef:t,rootElementRef:n,onClick:a,children:s,hasActiveRequest:o,isWaitingOnFirstUserVisibleToken:r}){const c=cs(),{scrollX:d}=Vn({layoutEffect:!1,container:t,target:n}),i=ea(),g=sa(),u=l.useRef(null),x=l.useRef(null),p=l.useRef(null),[y,m]=l.useState(!1),[T,M]=l.useState(!1),[k,N]=l.useState(!1),[P,v]=l.useState(0);l.useEffect(()=>{if(!c)return;const w=new IntersectionObserver(h=>{for(const C of h)C.target===u.current?m(C.isIntersecting):C.target===p.current?N(C.isIntersecting):C.target===x.current&&M(C.isIntersecting)},{root:i?.current});return u.current&&x.current&&p.current&&(w.observe(u.current),w.observe(x.current),w.observe(p.current)),()=>{w.disconnect()}},[P,c,i]);const f=!k&&(T||y),E=zn(d,w=>f?-1*w:0),j=Ls(0);l.useEffect(()=>{if(!c)return;const w=new ResizeObserver(h=>{Me(h.length===1,"entryList.length === 1");const C=h[0];Me(C.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),j.set(C.contentBoxSize[0].inlineSize)});return n.current&&w.observe(n.current),()=>{w.disconnect()}},[c,j,n]);const S=Ls(0);l.useEffect(()=>{if(!c)return;const w=new ResizeObserver(h=>{Me(h.length===1,"entryList.length === 1");const C=h[0];Me(C.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),S.set(C.contentBoxSize[0].blockSize+16),v(C.contentBoxSize[0].blockSize)});return g.current&&w.observe(g.current),()=>{w.disconnect()}},[c,S,g]);const _=e.jsx(Nt,{className:c?"px-5":"mt-4 self-start",onClick:a,"data-testid":"paragen-prefer-response-button",children:e.jsx(B,{id:"U2EAH6",defaultMessage:"I prefer this response"})}),F=r;return e.jsx("div",{"data-paragen-root":!0,className:D("@container relative flex min-w-[min(450px,80cqw,80vw)] flex-1 snap-center flex-col gap-1 text-start",c?"min-h-60":"border-token-border-tertiary rounded-xl border shadow-lg shadow-black/3"),ref:n,children:e.jsxs("div",{className:D(ta,"px-(--thread-content-margin) py-4"),children:[e.jsx("div",{className:D("absolute top-48 right-0! left-0! h-px","invisible"),ref:u}),e.jsx("div",{className:D("absolute top-48 right-0! bottom-0 left-0!","invisible"),ref:x}),e.jsx("div",{className:D("absolute right-0! bottom-0 left-0! h-px","invisible"),ref:p}),s,c?e.jsx("div",{className:"flex-1"}):null,c?e.jsx("div",{className:"mt-4 min-h-10",children:F?null:e.jsx(H.div,{style:{translateX:E,width:j,bottom:S},animate:{opacity:100},initial:{opacity:0},transition:{ease:"easeOut",duration:.2,delay:.5},className:D({fixed:f,"z-20 flex w-full justify-center":!0}),children:_})}):o?null:_]})})}function Ws(){return e.jsxs("div",{className:"flex w-full flex-col gap-4 pt-3 pb-5",children:[e.jsx(ce,{className:"h-4 w-[75%]"}),e.jsx(ce,{className:"h-4 w-[50%]"}),e.jsx(ce,{className:"h-4 w-[80%]"}),e.jsx(ce,{className:"h-4 w-[55%]"}),e.jsx(ce,{className:"h-4 w-[66%]"}),e.jsx(ce,{className:"h-4 w-[64%]"}),e.jsx(ce,{className:"h-4 w-[48%]"})]})}function cs(){const{layer:t}=Wo("3119715334");return t.get("should-enable-hojicha",!1)}const $s=oe.div`text-sm text-token-text-secondary font-semibold`,Ys=oe.div`flex gap-4 items-center mb-1`,ce=oe.div`animate-pulse rounded-[4px] bg-token-main-surface-tertiary`;function Xs({clientThreadId:t,conversationTurnMountTime:n,turn:a,originalTurn:s}){const o=lt();if(!o.showParagenMetadata||!o.showDebugConversationTurns&&!o.forceParagen||a==null)return null;let r=a===s?"ORIGINAL":"NEW";const c=a.messages[a.messages.length-1],d=c?.metadata?.__internal,i=c?.metadata?.paragen_display_label;if(d){const{model_id:x,model_definition_slug:p,model_definition_virtual_model_id:y,alternative_model_selection_rule:m,augmented_paragen_prompt_group_id:T,augmented_paragen_prompt_id:M,augmented_paragen_prompt:k}=d;x&&(r+=`
Model ID: ${x}`),p&&(r+=`
Model Slug: ${p}`),y&&(r+=`
Virtual Model ID: ${y}`),m&&(r+=`
Alternative Model Rule: ${m}`),T&&(r+=`
Prompt Group ID: ${T}`),M&&(r+=`
Prompt ID: ${M}`),k&&(r+=`
Prompt: ${k}`),i&&(r+=`
Display Label: ${i}`)}r+=`
Message ID: ${c.id}`;const g=L.getParentPromptNode(Ne(t),a.messages[0].id);if(!g)throw new Error("Expected prompt for side by side feedback");const u=g.message.clientMetadata?.variantsInStreamInfo==null&&g.message.metadata?.paragen_variants_info!=null;return r+=`
User prompt message ID: ${g.message.id}`,r+=`
Is Persisted Paragen? ${u}`,r+=`
Completion Sample Finish Time: ${u?`${n} (persisted)`:A(a.messages)?.clientMetadata?.completionSampleFinishTime}`,e.jsx("div",{className:"text-sm whitespace-pre-wrap text-red-500",children:r})}async function Ks({params:t}){await It.safePost("/paragen_submission",{requestBody:t,authOption:Et.SendIfAvailable})}const Qs=ot({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}{display_label}"}});function Nr({handleShowRetrievalResults:t,clientThreadId:n,turnIndex:a,responseComplete:s=!1}){const[o,r]=te(n,u=>[L.getTurnContentReferences(u,a),L.getConversationTurnAtIndex(u,a).messages]),c=l.useMemo(()=>({turnIndex:a,clientThreadId:n,responseComplete:s}),[n,s,a]),d=l.useRef(!1);l.useEffect(()=>{d.current||(d.current=!0,q.logEvent("File Sources Footer Shown",c))},[c]);const i=l.useCallback(()=>{q.logEvent("File Sources Footer Clicked",c),t()},[t,c]),g=l.useMemo(()=>{const u=new Set,x=[];function p(m){!m||u.has(m)||(u.add(m),x.push(m))}if(o.forEach(m=>{m.type==="file"?p(m.cloud_doc_url??m.extra?.cloud_doc_url):m.type==="file_navlist"&&m.items.forEach(T=>{p(T.cloud_doc_url)})}),s){for(const m of r)if(na(m)){const T=aa(m.content.result),M=m.metadata?.cloud_doc_urls??[],k=T.chunks;for(let N=0;N<k.length;N++){const P=k[N];if(!P.documentId)continue;if(N<M.length){p(M[N]);continue}const v=P.documentId.endsWith("--google")?P.documentId.split("--")[1]:void 0,f=P.metadata.cloud_doc_url??(v?`https://drive.google.com/file/d/${v}`:void 0);p(f?.toString())}break}}const y=[];for(let m=0;m<x.length;m++){const T=x[m],M=oa(T);if(M&&y.push(M.Icon),y.length>=3)break}return y},[r,o,s]);return e.jsxs(e.Fragment,{children:[e.jsx(H.div,{className:"absolute h-[60px]",initial:{opacity:0},animate:{opacity:1},children:e.jsxs("button",{className:D("not-prose group/footnote border-token-border-default bg-token-main-surface-primary hover:bg-token-main-surface-secondary mt-3 mb-2 flex w-fit items-center gap-1.5 rounded-xl border py-2","ps-3 pe-2.5"),onClick:i,children:[g.length>0&&e.jsx("div",{className:"flex flex-row-reverse gap-1",children:g.reverse().map((u,x)=>e.jsx(H.div,{className:D("border-token-main-surface-primary bg-token-main-surface-primary flex items-center overflow-hidden","group-hover/footnote:border-token-main-surface-secondary","relative"),initial:{opacity:0},animate:{opacity:1},children:e.jsx(u,{className:"icon-sm"})},x))}),e.jsx("div",{className:"text-token-text-secondary flex items-center gap-0.5 text-xs font-semibold",children:e.jsx(B,{id:"/48IOP",defaultMessage:"Sources"})})]})}),e.jsx("div",{className:"h-[60px]"})]})}function Ot({followups:t,analyticsMetadata:n,isV2Enabled:a=!1}){const[s,o]=l.useState(-1),r=l.useRef(!1),c=Ut();return l.useEffect(()=>{r.current||(r.current=!0,t.forEach((d,i)=>{q.logEventWithStatsig("chatgpt_message_followup_action","chatgpt_message_followup_action",{...Q(n),action:"show",position:(i+1).toString(),followup_text:pe(d)})}))},[t,n]),e.jsx(H.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex w-full flex-col",children:t.slice(0,4).map((d,i)=>e.jsxs(H.div,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:i*.03},exit:{opacity:0,translateY:4},onMouseEnter:()=>o(i),onMouseLeave:()=>o(-1),children:[i>0&&!a&&e.jsx(Gt,{$isSelected:s===i||s===i-1}),e.jsx(Rr,{followUp:d,onSelectingSuggestedReply:c,analyticsMetadata:n,position:i,isV2Enabled:a})]},i))})}const Gt=oe.div`
  h-[1px] opacity-45
  ${({$isSelected:t})=>t?"mx-2 bg-token-main-surface-secondary":"bg-token-border-default"}
`;function Rr({followUp:t,onSelectingSuggestedReply:n,analyticsMetadata:a,position:s,isV2Enabled:o}){return e.jsxs(H.button,{whileHover:"hover",className:D("bg-token-main-surface-primary hover:bg-token-main-surface-secondary flex w-full cursor-pointer items-start justify-start gap-2 rounded-lg py-3 text-start",o?"px-0":"px-2"),onClick:r=>{n(r,t,[],0),q.logEventWithStatsig("chatgpt_message_followup_action","chatgpt_message_followup_action",{...Q(a),action:"click",position:(s+1).toString(),followup_text:pe(t)})},onMouseEnter:()=>{q.logEventWithStatsig("chatgpt_message_followup_action","chatgpt_message_followup_action",{...Q(a),action:"hover",position:(s+1).toString(),followup_text:pe(t)})},children:[e.jsx(H.div,{className:"flex items-center justify-center pt-0.25 opacity-70",variants:{hover:{x:4}},initial:{x:0},transition:{duration:.1},children:e.jsx(ct,{className:"text-token-text-secondary h-[20px] w-[20px]"})}),e.jsx("div",{className:"text-token-text-secondary pe-2 text-start text-sm",children:pe(t)})]})}const Ar=()=>e.jsx(Dt,{size:"lg",lines:3,width:35,widthVariance:10,className:"w-full"}),Fr=t=>({[ae.Search]:"Web Search",[ae.Research]:"Research",[ae.PictureV2]:"Draw Image",[ae.Think]:"Think Harder"})[t]??"Title",ss=(t,n,a,s,o)=>{q.logEventWithStatsig("Capabilities Suggestion Action","chatgpt_capabilities_suggestion_action",{...Q(a),categoryId:n.categoryId,suggestionId:n.id,position:s,action:t,numSuggestions:String(o)})},Pr=(t,n)=>{const a=l.useRef(!1);l.useEffect(()=>{a.current||(a.current=!0,t.forEach((s,o)=>{ss("show",s,n,o+1,t.length)}))},[t,n])},Ht=({clientThreadId:t,suggestions:n,analyticsMetadata:a,style:s="default"})=>{const o=Ut();return Pr(n,a),e.jsx(e.Fragment,{children:n.map((r,c)=>e.jsxs(H.div,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},exit:{opacity:0,translateY:4},transition:{delay:c*.03},className:D("w-full flex-1",s==="compact"&&"flex-col"),children:[s==="compact"&&c>0&&e.jsx(Gt,{$isSelected:!1}),e.jsx(Lr,{clientThreadId:t,suggestion:r,onSelectingSuggestedReply:o,position:c+1,numSuggestions:n.length,analyticsMetadata:a,style:s})]},r.prompt))})},Lr=({clientThreadId:t,suggestion:n,onSelectingSuggestedReply:a,analyticsMetadata:s,position:o,numSuggestions:r,style:c="default"})=>{const{setThreadSystemHintMode:d}=ra(),i=rs(),g=Wn();return e.jsx(H.button,{onClick:u=>{if(ss("click",n,s,o,r),n.categoryId===ae.Research)if(i?.isFree()){ia(g,"Suggested Capabilities Upsell");return}else d(n.categoryId,!0,s);a(u,n,[],0)},onMouseEnter:()=>{ss("hover",n,s,o,r)},className:D("hover:bg-token-main-surface-secondary flex w-full flex-1 items-start rounded-xl text-start transition-colors duration-300 ease-in-out",c==="default"&&"gap-4 p-2"),children:c==="compact"?e.jsx(Dr,{clientThreadId:t,suggestion:n}):e.jsx(Ur,{clientThreadId:t,suggestion:n})})},Dr=({suggestion:t,clientThreadId:n})=>{const{categoryId:a}=t,{systemHints:s}=dt(n),o=s.find(r=>r.systemHint===a);return e.jsxs("div",{className:"bg-primary hover:bg-tertiary group flex w-full cursor-pointer items-center justify-start gap-2 rounded-lg px-2 py-3 text-start transition-colors duration-300 ease-in-out",children:[e.jsx("div",{className:"flex items-center justify-center opacity-70 transition-all duration-100 ease-in-out group-hover:scale-[1.02] group-hover:rotate-[-5deg] group-hover:opacity-100",children:a==="ask"?e.jsx(ct,{className:"text-token-text-secondary group-hover:text-token-text-primary h-[18px] w-[18px]"}):e.jsx(Rt,{svgString:o?.logo??"",className:"text-token-text-secondary icon-md group-hover:text-token-interactive-label-accent-default h-[18px] w-[18px]"})}),e.jsx("div",{className:"text-token-text-secondary group-hover:text-token-text-primary flex items-center pe-2 text-start text-sm",children:pe(t)})]})},Ur=({clientThreadId:t,suggestion:n})=>{const{categoryId:a,imageUrl:s,description:o,title:r,ctaLabel:c,prompt:d}=n,{systemHints:i}=dt(t),g=i.find(u=>u.systemHint===a);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-token-border-default bg-primary relative h-16 w-14 flex-shrink-0 rounded-lg border drop-shadow-xs transition-all duration-100 ease-in-out group-hover:scale-[1.02] group-hover:rotate-[-2deg]",children:[a===ae.PictureV2?e.jsx("div",{className:"flex h-full w-full items-center justify-center rounded-lg bg-cover",style:{backgroundImage:`url(${s})`},children:e.jsx(la,{className:"icon-xl mb-2 text-white"})}):e.jsxs("div",{className:"flex flex-col gap-1.5 p-2",children:[e.jsx("div",{className:"text-token-text-primary text-[5px] leading-tight font-semibold tracking-tighter",children:r??Fr(a)}),e.jsx("div",{className:"flex flex-col gap-0.5",children:Array.from({length:10}).map((u,x)=>e.jsx("div",{className:"bg-token-border-heavy h-[1px] w-full rounded-full"},x))})]}),e.jsx("div",{className:"absolute -end-2 -bottom-2",children:e.jsx(ca,{isBadge:!0,className:"opacity-100",logo:e.jsx(Rt,{svgString:g?.logo??"",className:"icon-md"})})})]}),e.jsxs("div",{className:"flex flex-col gap-2 text-sm",children:[e.jsx("div",{className:"text-token-text-primary flex-grow",children:o??d}),c&&e.jsxs("div",{className:"text-token-text-secondary flex items-center font-medium",children:[c,e.jsx(H.div,{variants:{hover:{x:2}},initial:{x:0},transition:{duration:.1},children:e.jsx(da,{})})]})]})]})},ts=(t,n,a,s)=>{q.logEventWithStatsig("Capabilities Tab Action","chatgpt_capabilities_tab_action",{...Q(a),tabId:n,position:s,action:t})},Br=(t,n)=>{const a=l.useRef(!1);l.useEffect(()=>{a.current||(a.current=!0,t.forEach((s,o)=>{ts("show",s.value,n,o+1)}))},[t,n])},qr=({clientThreadId:t,categorySuggestions:n,lastMessageId:a,analyticsMetadata:s,style:o="default"})=>{const r=n.map(({category_id:i,title:g,suggestions:u})=>({value:i,message:g,suggestions:u?.map(ut)??[]})),[c,d]=l.useState(r[0].value);return Br(r,s),e.jsxs(ua,{value:c,onValueChange:d,orientation:"horizontal",className:"flex w-full flex-col",children:[e.jsx(ma,{className:"border-token-border-default relative flex w-full flex-row gap-6 border-b",children:r.map((i,g)=>e.jsx(Gr,{value:i.value,message:i.message,isActive:c===i.value,analyticsMetadata:s,position:g+1},i.value))}),r.map(i=>e.jsx(ga,{value:i.value,children:e.jsx(Or,{initialSuggestions:i.suggestions,clientThreadId:t,categoryId:i.value,isActive:c===i.value,lastMessageId:a,analyticsMetadata:s,style:o})},i.value))]})},Or=({initialSuggestions:t,clientThreadId:n,categoryId:a,isActive:s,lastMessageId:o,analyticsMetadata:r,style:c="default"})=>{const d=me(n),i=s&&t.length===0,{suggestions:g,isLoading:u}=pa({categoryId:a,shouldFetch:i,serverThreadId:d,lastMessageId:o}),x=i?g:t;return a==="ask"?u?e.jsx(Ar,{}):e.jsx(Ot,{followups:x.map(p=>({type:mt.Reply,text:p.prompt})),analyticsMetadata:r}):e.jsx("div",{className:"flex w-full flex-col gap-y-4 py-3 md:flex-row md:gap-x-4",children:u?e.jsxs(e.Fragment,{children:[e.jsx(Js,{}),e.jsx(Js,{})]}):e.jsx(Ht,{clientThreadId:n,suggestions:x,analyticsMetadata:r,style:c})})},Gr=({value:t,message:n,isActive:a,analyticsMetadata:s,position:o})=>e.jsxs(ha,{className:"text-token-text-tertiary hover:text-token-text-secondary radix-state-active:text-token-text-primary relative flex min-w-10 justify-center py-4 text-sm font-medium",value:t,onClick:()=>{ts("click",t,s,o)},onMouseEnter:()=>{ts("hover",t,s,o)},children:[e.jsx("div",{className:"truncate",children:n}),e.jsx(xe,{children:a&&e.jsx(H.div,{layoutId:"tab-underline",className:"bg-token-text-primary absolute start-0 end-0 bottom-0 h-0.5",transition:{type:"spring",stiffness:500,damping:30}})})]}),Js=()=>e.jsxs("div",{className:"flex flex-1 items-center gap-4 rounded-xl p-2",children:[e.jsx("div",{className:"bg-token-sidebar-surface-secondary dark:bg-token-border-default h-16 w-14 flex-shrink-0 rounded-lg"}),e.jsx("div",{className:"w-full flex-grow",children:e.jsx(Dt,{lines:3,size:"sm"})})]}),Hr=({clientThreadId:t,categorySuggestions:n,lastMessageId:a,analyticsMetadata:s})=>{if(!n||n.length===0)return null;const o=n.length===1,r=n[0],c=r.suggestions.length>0?r.suggestions:void 0;return o&&c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-1 text-sm font-semibold",children:e.jsx(B,{id:"3UFIQc",defaultMessage:"Follow up"})}),e.jsx(Ht,{clientThreadId:t,suggestions:c.map(ut),analyticsMetadata:s,style:r.style})]}):e.jsx(qr,{clientThreadId:t,categorySuggestions:n??[],lastMessageId:a,analyticsMetadata:s})};function Vr({clientThreadId:t,followups:n,categorySuggestions:a,lastMessageId:s,analyticsMetadata:o}){const[r,c]=l.useState(null),d=gt.useIsEnabled(t),{capabilitySuggestionsEnabled:i}=ht(),g=a&&a.length>0;return e.jsxs(e.Fragment,{children:[e.jsx($r,{visible:r==="conversation"}),e.jsx(Yr,{visible:r==="global"}),d&&(i?g&&e.jsx(Hr,{clientThreadId:t,lastMessageId:s,categorySuggestions:a,analyticsMetadata:o}):n.length>0&&e.jsx(zr,{clientThreadId:t,followups:n,analyticsMetadata:o,setDisableMessage:c}))]})}function zr({clientThreadId:t,followups:n,setDisableMessage:a,analyticsMetadata:s}){const{value:o}=Re("2281969373"),{value:r}=Re("2076592918");return e.jsxs("div",{className:"group",children:[r?e.jsx("hr",{className:"bg-token-bg-tertiary mt-5 mb-5 opacity-70"}):e.jsxs("div",{className:"mb-1 flex items-center text-sm font-semibold",children:[e.jsx(B,{id:"3UFIQc",defaultMessage:"Follow up"}),!o&&e.jsx(Wr,{clientThreadId:t,setDisableMessage:a,analyticsMetadata:s})]}),e.jsx(Ot,{followups:n,analyticsMetadata:s,isV2Enabled:r})]})}function Wr({clientThreadId:t,setDisableMessage:n,analyticsMetadata:a}){const s=gt.useStore(),[o,r]=l.useState(!1);return e.jsxs(fa,{size:"small",onOpenChange:c=>r(c),contentClassName:"min-w-[200px]",triggerButton:e.jsx("button",{className:"text-token-text-tertiary hover:bg-token-main-surface-tertiary ms-2 flex h-6 w-6 items-center justify-center rounded-md focus:ring-0 focus:outline-hidden",children:e.jsx(xa,{className:D("h-4 w-4 opacity-0 group-hover:opacity-100",o&&"opacity-100")})}),children:[e.jsx(K.Item,{onClick:()=>{s.setDisabledConversation(t,!0),n("conversation"),setTimeout(()=>n(null),3e3),q.logEventWithStatsig("chatgpt_message_followup_setting","chatgpt_message_followup_setting",{...Q(a),action:"disable_conversation"})},className:"text-token-text-primary",children:e.jsx(B,{id:"GZYofd",defaultMessage:"Hide for this chat"})}),e.jsx(K.Item,{onClick:()=>{s.setDisabledGlobally(!0),n("global"),setTimeout(()=>n(null),5e3),q.logEventWithStatsig("chatgpt_message_followup_setting","chatgpt_message_followup_setting",{...Q(a),action:"disable_globally"})},className:"text-token-text-primary",children:e.jsx(B,{id:"dtAOq4",defaultMessage:"Hide everywhere"})})]})}const Vt={initial:{opacity:1},animate:{opacity:1},exit:{opacity:0,transition:{duration:.2}}};function $r({visible:t}){return e.jsx(xe,{children:t&&e.jsx(H.div,{...Vt,className:"text-token-text-tertiary flex justify-center py-6 text-sm",children:e.jsx(B,{id:"ckTD9g",defaultMessage:"Follow ups are turned off for this conversation"})})})}function Yr({visible:t}){return e.jsx(xe,{children:t&&e.jsxs(H.div,{id:"disableForAllConvos",...Vt,className:"flex flex-col items-center py-3 text-sm",children:[e.jsx("div",{children:e.jsx(B,{id:"5GDIBQ",defaultMessage:"Follow up have been turned off"})}),e.jsx("div",{className:"text-token-text-tertiary pt-1",children:e.jsx(B,{id:"LYaBNe",defaultMessage:"You can re-enable them in settings"})})]})})}function Xr({modelSlug:t,animateModelLabelOnRender:n,isDropdownOpen:a,isRegenerateEnabled:s,isHovered:o,animateShortLabel:r}){const{data:c}=Yo(),[d,i]=l.useState("initial");l.useEffect(()=>{if(n){const p=setTimeout(()=>i("show"),500),y=setTimeout(()=>i("initial"),2e3);return()=>{clearTimeout(p),clearTimeout(y)}}i("initial")},[n]);const{shorterLabel:g}=c?.categories.find(({defaultModel:p})=>p===t)??{},u={initial:{opacity:0,paddingLeft:0,width:"0"},show:{opacity:1,paddingLeft:2,width:"100%"},visible:{opacity:1,paddingLeft:2,width:"100%",transition:{delay:0,duration:0}}},x=a?"visible":o?"show":d;return e.jsxs(H.div,{initial:"initial",animate:x,className:"flex items-center pb-0",children:[e.jsx(ns,{className:"icon-md"}),(s||r)&&e.jsx(H.span,{className:"overflow-hidden text-sm text-clip whitespace-nowrap",variants:u,transition:{type:"tween",duration:.18},children:g}),s&&e.jsx(pt,{className:"icon-sm"})]})}function Ve(t,n){const{modelSwitcherDeny:a,subscriptionLevel:s}=t;return!!a&&a.reason===Qo.RATE_LIMIT&&s===Jo.PLUS&&!n}const Ie="rounded-lg radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed";function Kr({className:t,clientThreadId:n,message:a,onModelSelect:s,canRegenerateResponse:o,withModelSelectorLabel:r=!0}){const[c,d]=l.useState(null),[i,g]=l.useState(!1),[u,x]=l.useState(!1),p=a.metadata?.model_slug,y=a.id,m=l.useRef(null),T=j=>{j||setTimeout(()=>{m.current&&m.current.blur()},10)};l.useEffect(()=>{T(i)},[i]);const M=te(n,wa),k=$o({clientThreadId:n}),N=l.useRef(k);l.useEffect(()=>{N.current=k},[k]);const P=l.useCallback(j=>{N.current?de(n,S=>{S.conduitToken=null,S.prepareState=null}):de(n,S=>{S.conduitToken=j,S.prepareState="success"})},[n]);if(M)return null;const v=va(n,a.id),f=a.metadata?.model_slug,E=_a(v,f);return e.jsxs(K.Root,{onOpenChange:j=>{o&&(f&&Sa(n,f,[],P),g(j),T(j))},children:[o?e.jsx(ba,{label:r?e.jsx(B,{id:"wDs5sz",defaultMessage:"Switch model "}):e.jsx(B,{id:"/a4cqQ",defaultMessage:"Switch model ({modelSlug})",values:{modelSlug:f}}),children:e.jsx(ya,{ref:m,className:D("cursor-pointer",t),onMouseEnter:()=>x(!0),onMouseLeave:()=>x(!1),children:r?e.jsx(Xr,{modelSlug:f,animateModelLabelOnRender:E,isDropdownOpen:i,isRegenerateEnabled:o,isHovered:u}):e.jsxs("div",{className:"flex items-center",children:[e.jsx(ns,{className:"icon-md"}),e.jsx(pt,{className:"icon-sm"})]})})}):null,o&&e.jsx(K.Portal,{children:e.jsxs(K.Content,{className:"text-token-text-primary z-30 min-w-fit origin-top-right",side:"bottom",align:"start",children:[e.jsx(K.Label,{children:e.jsx(B,{id:"bFLh5u",defaultMessage:"Switch model"})}),e.jsx(Qr,{clientThreadId:n,messageId:y,message:a,onModelSelect:s,messageModelSlug:p,setHoveredOption:d,hoveredOption:c})]})})]})}function Qr({clientThreadId:t,message:n,messageId:a,messageModelSlug:s,onModelSelect:o,setHoveredOption:r,hoveredOption:c}){const d=Ae(),{data:i=null}=Xo(),g=i&&Ko(i),{modelOptions:u,messageModelEnabledTools:x}=Ta({clientThreadId:t,message:n}),p=x.includes(ae.Search),y=l.useMemo(()=>u.find(v=>v.value===s),[u,s]),[m,T]=l.useMemo(()=>ja(u,v=>v.subcategory),[u]),M=Ca(n);l.useEffect(()=>{const v=u.some(f=>Ve(f,g));q.logEvent("Conversation Open Message Model Selector",{has_get_plus_button:v,is_new_regen_dropdown:!0})},[]);const k=l.useMemo(()=>{const v=new Map;return m.forEach(f=>{const E=f.subcategory;E&&(v.has(E)||v.set(E,[]),v.get(E)?.push(f))}),v},[m]),N=D("icon-sm","order-10 ms-auto text-token-text-tertiary icon-md"),P=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:d.formatMessage(ze.search),icon:e.jsx(Ma,{className:N}),condition:p&&!M,eventName:"chatgpt_regenerate_with_search_button_clicked"},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:d.formatMessage(ze.nosearch),icon:e.jsx(ka,{className:N}),condition:p&&M,eventName:"chatgpt_regenerate_without_search_button_clicked"}];return e.jsxs(e.Fragment,{children:[T.map(v=>{const{value:f,...E}=v;return e.jsx(ke,{value:f,onSelect:j=>{se.logEvent("chatgpt_regenerate_switch_model_button_clicked",f,{requestedModelId:f,...Q({clientThreadId:t,messageId:a})}),o({sourceEvent:j,requestedModelId:f})},includeRegenerate:!1,onMouseEnter:()=>r(f),onMouseLeave:()=>r(null),isHovered:c===f,messageModelSlug:s,includeCheck:!1,shouldShowUpsell:Ve(v,g),className:Ie,...E,icon:e.jsx("span",{className:N}),clientThreadId:t},f)}),[...k.entries()].map(([v,f])=>e.jsxs(K.Sub,{children:[e.jsx(K.SubMenuTrigger,{children:e.jsx("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:v})}),e.jsx(K.Portal,{children:e.jsx(K.SubContent,{className:"min-w-fit",children:f.map(E=>{const{value:j,...S}=E;return e.jsx(ke,{value:j,onSelect:_=>{se.logEvent("chatgpt_regenerate_switch_model_button_clicked",j,{requestedModelId:j,...Q({clientThreadId:t,messageId:a})}),o({sourceEvent:_,requestedModelId:j})},includeRegenerate:!1,onMouseEnter:()=>r(j),onMouseLeave:()=>r(null),isHovered:c===j,messageModelSlug:s,includeCheck:!1,className:Ie,...S,icon:null,shouldShowUpsell:Ve(E,g),clientThreadId:t},v+"-"+j)})})})]},v)),!!y&&e.jsxs(e.Fragment,{children:[e.jsx(K.Separator,{}),e.jsx(ke,{onSelect:v=>{se.logEvent("chatgpt_regenerate_try_again_button_clicked",y.value,{requestedModelId:y.value,...Q({clientThreadId:t,messageId:a})}),o({sourceEvent:v,requestedModelId:y.value})},includeRegenerate:!0,onMouseEnter:()=>r(y.value),onMouseLeave:()=>r(null),messageModelSlug:s,includeCheck:!1,className:Ie,...y,label:d.formatMessage(ze.tryAgain),subtitle:y.label,icon:e.jsx(ns,{className:N}),clientThreadId:t},y.value),P.filter(v=>v.condition).map(v=>e.jsx(ke,{onSelect:f=>{se.logEvent(v.eventName,y.value,{requestedModelId:y.value,...Q({clientThreadId:t,messageId:a})}),o({sourceEvent:f,requestedModelId:y.value,extraStreamParams:v.extraStreamParams})},includeRegenerate:!1,onMouseEnter:()=>r(v.key),onMouseLeave:()=>r(null),isHovered:c===v.key,messageModelSlug:s,includeCheck:!1,className:Ie,...y,label:v.label,subtitle:"",icon:v.icon,clientThreadId:t},v.key))]})]})}const ze=ot({tryAgain:{id:"VbsBGW",defaultMessage:"Try again"},search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),Jr=l.memo(Kr),Zr=null,ei=ue(()=>ge(()=>import("./klihi3sbpg7j86o3.js"),__vite__mapDeps([8,2,1,3,9,10,4,5,11,12])).then(t=>t.VoicePlayButton)),si=ue(async()=>Promise.resolve(()=>null)),ti=({alwaysShow:t,isUserTurn:n,children:a})=>{const s=l.useRef(null);return l.useEffect(()=>{const o=s.current;o&&(t?requestAnimationFrame(()=>{o&&(o.style.maskPosition=t?"0% 0%":"")}):o.style.maskPosition="")},[t]),e.jsx("div",{className:D("flex",!t&&"absolute start-0 end-0 flex",n?"justify-end":"justify-start"),children:e.jsx("div",{ref:s,className:D("touch:-me-2 touch:-ms-3.5 -ms-2.5 -me-1 flex items-center p-1 select-none",!n&&"-mt-1",t&&"duration-[1.5s]","focus-within:transition-none hover:transition-none",!(t||n)&&"duration-500 group-hover/turn-messages:delay-300",!n&&["pointer-events-none [mask-image:linear-gradient(to_right,black_33%,transparent_66%)] [mask-size:300%_100%] [mask-position:100%_0%] motion-safe:transition-[mask-position]","group-hover/turn-messages:pointer-events-auto group-hover/turn-messages:[mask-position:0_0]","group-focus-within/turn-messages:pointer-events-auto group-focus-within/turn-messages:[mask-position:0_0]","has-data-[state=open]:pointer-events-auto has-data-[state=open]:[mask-position:0_0]"],n&&["duration-300 group-hover/turn-messages:delay-300","pointer-events-none opacity-0 motion-safe:transition-opacity","group-hover/turn-messages:pointer-events-auto group-hover/turn-messages:opacity-100","group-focus-within/turn-messages:pointer-events-auto group-focus-within/turn-messages:opacity-100","has-data-[state=open]:pointer-events-auto has-data-[state=open]:opacity-100"]),children:a})})},ni=({activeVariantIndex:t,clientThreadId:n,conversationMode:a,lastMessage:s,messages:o,numVariants:r,onChangeIndex:c,onRate:d,showCanvasButton:i,showCopyButton:g,showPagination:u,showPlayButton:x,showRatingButtons:p,showRegenerateButton:y,isJam:m,turn:T,turnIndex:M})=>{const k=is(),N=Ae(),P=At(),{value:v}=Re("4061070236"),f=s?.clientMetadata?.rating;s?.clientMetadata?.requestId;const E=Zo(o,Y=>{const[X]=Y.author.name?.split(".")??[];return X===er.T2UAY3K&&Ft.getImageAssetPointers(Y).length>0}),j=o.filter(sr).filter(Y=>Y.recipient==="all"),S=!!E,_=Pt(),F=Ea(),w=Na(),h=me(n),C=S&&j.length===0&&tr(E),R=!m&&h!=null,I=!_&&E&&F(),U=!_&&!E&&Ra(k);let ne=null;return R&&(I||U?ne=e.jsx(ri,{clientThreadId:n,imageGenMessageId:E?.id,messageSliceIds:o.map(Y=>Y.id)}):w&&Qe(k,"1547743984").get("show_share_button_inline",!1)&&(ne=e.jsx(fe,{onClick:()=>{h&&vt.openSharingModal(h)},label:N.formatMessage({id:"ConversationTurn.shareButtonTooltip",defaultMessage:"Share conversation"}),className:"sm:hidden",icon:xt}))),e.jsxs(e.Fragment,{children:[u&&e.jsx(ft,{currentPage:t,onChangeIndex:c,length:r}),!1,g&&!C&&e.jsx(zt,{onClick:Y=>{Bt(k,n,M,P,Y)}}),!S&&p&&e.jsxs(e.Fragment,{children:[f!=="thumbsDown"&&e.jsx(fe,{onClick:()=>d("thumbsUp"),disabled:f==="thumbsUp",icon:f==="thumbsUp"?Aa:bt,label:N.formatMessage({id:"ConversationTurn.goodResponseTooltip",defaultMessage:"Good response"}),testId:"good-response-turn-action-button"}),f!=="thumbsUp"&&e.jsx(fe,{onClick:()=>d("thumbsDown"),disabled:f==="thumbsDown",icon:f==="thumbsDown"?Fa:yt,label:N.formatMessage({id:"ConversationTurn.badResponseTooltip",defaultMessage:"Bad response"}),testId:"bad-response-turn-action-button"})]}),x&&s&&j.length>0&&e.jsx(ei,{conversationId:n,message:s,iconClassName:"icon-md",className:"text-token-text-tertiary hover:text-token-text-primary gap-1.5 rounded-md p-1 text-xs"}),!S&&i&&e.jsx(Pa,{turn:T}),!1,s&&Zr,y&&s&&e.jsx(oi,{clientThreadId:n,conversationMode:a,lastMessage:s,messages:o,hasImageGenMessage:S,withModelSelectorLabel:!v}),ne]})},ai=({activeVariantIndex:t,clientThreadId:n,numVariants:a,onAnticipateEdit:s,onChangeIndex:o,onEnterEdit:r,showCopyButton:c,showEditMessageButton:d,showPagination:i,turnIndex:g})=>{const u=is(),x=At();return e.jsxs(e.Fragment,{children:[c&&e.jsx(zt,{onClick:p=>{Bt(u,n,g,x,p)}}),d&&e.jsx(Ia,{onAnticipateEdit:s,onEnterEdit:r}),i&&e.jsx(ft,{currentPage:t,onChangeIndex:o,length:a})]})},oi=({clientThreadId:t,conversationMode:n,messages:a,hasImageGenMessage:s,lastMessage:o,withModelSelectorLabel:r})=>{const c=Ba({clientThreadId:t,conversationMode:n}),d=qa(t,o),i=l.useCallback(({sourceEvent:g,requestedModelId:u,appendMessages:x,extraStreamParams:p})=>{o&&c({sourceEvent:g,nodeId:o.id,requestedModelId:u,appendMessages:x,extraStreamParams:p})},[o,c]);return s?e.jsx(si,{messages:a,onModelSelect:i}):e.jsx(Jr,{className:"text-token-text-secondary hover:bg-token-main-surface-secondary touch:px-2.5 h-[30px] rounded-md px-1.5",clientThreadId:t,message:o,onModelSelect:i,canRegenerateResponse:d,withModelSelectorLabel:r})},zt=({onClick:t})=>{const[n,a]=l.useState(!1),s=La(),o=Ae(),r=l.useCallback(c=>{c.stopPropagation(),q.logEvent("ChatGPT Turn Action Copy Clicked"),t(c),a(!0),setTimeout(()=>{s()&&a(!1)},2e3),se.logEvent("chatgpt_turn_action_copy")},[s,t]);return e.jsx(fe,{icon:n?Da:Ua,onClick:r,label:o.formatMessage({id:"CopyButton.copyTooltip",defaultMessage:"Copy"}),testId:"copy-turn-action-button"})};function ri({clientThreadId:t,imageGenMessageId:n,messageSliceIds:a}){const[s,o]=l.useState(!1),r=Ae(),c=Cr({clientThreadId:t,imageGenMessageId:n,messageSliceIds:a});return l.useEffect(()=>{q.logEventWithStatsig("Share Post: Share Button Shown","chatgpt_post_share_button_shown",{source:"turn_action"})},[]),e.jsx(fe,{onClick:async()=>{o(!0);try{await c()}finally{o(!1)}q.logEventWithStatsig("Share Post: Share Button Clicked","chatgpt_post_share_button_clicked",{source:"turn_action"})},label:r.formatMessage({id:"ConversationTurn.sharePostButtonTooltip",defaultMessage:"Share"}),icon:s?nr:xt,disabled:s})}const Zs=[1,2,3,4,10,20,30],ii=1,li=["g-67e595af0a408191b84ee532fca12cd1","g-67ec3b78892481918c89067962526695","g-67ec3b4988f8819184c5454e18f5e84b","g-67ec3ad40750819181ccffa6a6f050d5","g-67edaaa3d3a081918205d0c470f00a32","g-67edab030ac881918ce8fa5c75a8e1b3","g-67edab2fc0f48191881a20ac98fedf6f","g-67edab4a24fc8191b975acaa8da2dcef"];function ci({clientThreadId:t}){const n=_t(St.isBusinessWorkspace),a=Tt(),s=l.useRef(!1),o=ls(t),[r,c,d,i]=te(t,h=>[h?.mode,L.getRequestId(h),L.getConversationLastTurn(h),L.getConversationTurns(h).filter(C=>C.role===z.Assistant).length]),{isUnauthenticated:g}=Lt(),u=l.useMemo(()=>{if(!o)return-1;const h=it(o);return h()>ii?-1:Zs[Math.floor(h()*Zs.length)]},[o]),x=as(c),p=function(){return Math.random()<.5?"default":"personality_v1"},[y,m]=l.useState(null),[T,M]=l.useState(!1),[k,N]=l.useState(!1),[P,v]=l.useState(!1),[f,E]=l.useState(p),j=(h,C)=>{const R=d?.messages[0]?.id;m(h),E(C),_(R,h,C)},S=d?.role===z.Assistant,_=l.useMemo(()=>Oa((h,C,R)=>{o&&h&&(n&&a?Ga({rating:Va(C),shown_at_assistant_turn:u,prompt:R},o,h):n||It.safePost("/conversation/{conversation_id}/rating",{parameters:{path:{conversation_id:o}},requestBody:{message_id:h,rating:C,shown_at_assistant_turn:u,prompt:R},authOption:Et.SendIfAvailable})),q.logEvent("Conversation Rating Submitted",{rating:C,showAtAssistantTurn:u,conversationId:o,prompt:R}),M(!0),setTimeout(()=>{N(!0)},1500)},2e3),[n,a,o,u]),F=i!==u||x||!S||!!n&&!a||r?.kind!==Je.PrimaryAssistant&&r?.kind!==Je.FlyingCircusCustomization&&r?.gizmo_id!==void 0&&!li.includes(r?.gizmo_id)||P||g;l.useEffect(()=>{!F&&!s.current&&(q.logEvent("Conversation Rating Shown",{showAtAssistantTurn:u,conversationId:o}),s.current=!0)},[F]);const w=Ha();return P||!w.forceShowConvoRating&&F?null:e.jsxs("div",{className:"mx-auto",children:[e.jsx(xe,{children:T&&!k&&e.jsx(H.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(et,{$padded:!0,children:e.jsx("span",{className:"text-token-text-tertiary text-sm",children:e.jsx(B,{id:"rating.thanks",defaultMessage:"Thanks for your feedback!"})})})},"submitted")}),!T&&e.jsx(H.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},children:e.jsxs(et,{$padded:!1,children:[e.jsxs("div",{className:"text-token-text-secondary flex items-center justify-center gap-4 px-4 py-3 text-sm",children:[f==="personality_v1"?e.jsx(B,{id:"rating.instructions.personality_v1",defaultMessage:"Do you like this personality?"}):e.jsx(B,{id:"rating.instructions.default",defaultMessage:"Is this conversation helpful so far?"}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx(We,{$selected:y==="thumbsUp",onClick:()=>j("thumbsUp",f),children:e.jsx(bt,{className:"icon-md"})}),e.jsx(We,{$selected:y==="thumbsDown",onClick:()=>j("thumbsDown",f),children:e.jsx(yt,{className:"icon-md"})})]})]}),e.jsx("div",{className:"bg-token-main-surface-tertiary w-px flex-1 self-stretch"}),e.jsx(We,{className:"p-3",$selected:!1,onClick:()=>v(!0),children:e.jsx(ar,{className:"icon-md text-token-text-secondary hover:text-token-text-primary"})})]})},"rating")]})}const We=oe.button`
  ${t=>t.$selected?"text-token-text-primary":"text-token-text-secondary"}
  hover:text-token-text-primary
`,et=oe.div`inline-flex rounded-xl border border-gray-100 dark:border-gray-700
${t=>t.$padded&&"py-3 px-4"}
`,di=ue(()=>ge(()=>import("./j5o8dq8sjlm4tiu2.js"),__vite__mapDeps([13,2,1,3,4,5,14])));function ui({clientThreadId:t,canShowInlineMessageFeedback:n,messageForRating:a,allGroupedMessages:s,currentModelId:o}){const r=rs()?.isWorkspacePlan()??!1;let c=null;const d=te(t,p=>{const y=L.getConversationTurns(p);let m=0;for(let T=y.length-1;T>=0;T--){const M=y[T];if(M.messages.some(k=>k.metadata?.is_indepth_feedback))return!0;if(M.messages.some(k=>k.author.role===z.Assistant)&&m++,m>=3)break}return!1}),i=ls(t),g=jt(p=>p.voiceFeedbackThread),u=i===g,{voiceName:x}=za();return d?null:(u&&i&&!r?(or.feedbackShown.success({voice:x}),c=e.jsx("div",{className:"text-center",children:e.jsx(Wa,{serverThreadId:i})})):a.clientMetadata?.rating&&n?c=e.jsx(di,{clientThreadId:t,conversationMessage:a,allGroupedMessages:s,currentModelId:o}):c=e.jsx("div",{className:"text-center",children:e.jsx(ci,{clientThreadId:t})}),e.jsx("div",{className:"mt-3 w-full empty:hidden",children:c}))}const mi=ue(()=>ge(()=>import("./de73pvgvm912man2.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(t=>t.MemoryActionResult)),gi=ue(()=>ge(()=>import("./jxc5nv9h2vsyvrs7.js"),__vite__mapDeps([15,2,4,1,3,5,16,17])).then(t=>t.AutomationSourceHeader)),st=ue(()=>ge(()=>import("./opsxtezzixxn17wf.js"),__vite__mapDeps([18,2,1,3,4,5])).then(t=>t.TextMessageEditor)),tt=80,hi=16,nt={minHeight:`calc(100dvh - ${go}px - 120px)`};function pi(t){const{turnIndex:n,isFinalTurn:a,clientThreadId:s,onRequestCompletion:o,currentModelId:r,avatarClassName:c,showAvatar:d,scrollToMessageId:i,dateHeaderType:g}=t,{isNewScrollEnabled:u}=Ct(),x=rt();rs()?.normalizedAccountUserId;const p=is(),y=!!x&&rr(x),m=$a(),T=_t(St.isBusinessWorkspace),M=yo(),k=Oe(p,"1760640904"),N=Oe(p,"4061070236"),P=!!d,f=null!=null,E=Oe(p,"1887864177"),{capabilitySuggestionsEnabled:j}=ht(),S=_r(),[_,F]=te(s,b=>{const G=L.getConversationTurnAtIndex(b,n),$=n>0?L.getConversationTurnAtIndex(b,n-1):null,O=$?.role===z.User&&$.messages.some(V=>V.metadata?.visually_hide_response_from_conversation);return[G,O]}),{messages:w,messageGroups:h}=_,C=Ya(),R=w[0],I=A(w),{messages:U,visibleMessages:ne,messageGroups:Y,lastMessageToRender:X,doesTurnHaveDelayedMessages:ve}=l.useMemo(()=>{const b=C.size===0?-1:h.findIndex(V=>V.type===Ge?V.groups.some(ie=>ie.messages.some(Be=>C.has(Be?.id))):V.messages.some(ie=>C.has(ie?.id))),G=b!==-1&&b+1<h.length,$=G?h.slice(0,b+1):h,O=G?$.flatMap(V=>V.type===Ge?V.groups.flatMap(ie=>ie.messages):V.messages):w;return{messages:O,visibleMessages:O.filter(ir),messageGroups:$,lastMessageToRender:A(O),doesTurnHaveDelayedMessages:b!==-1}},[w,h,C]),J=l.useMemo(()=>({clientThreadId:s,turnIndex:n,messageId:I?.id}),[s,n,I?.id]),Wt=!1,[ds,us]=l.useState(!1),[$t,Yt]=l.useState(!1),Xt=l.useContext(Xa)!=null,W=_.role===z.User,ms=Pt(),be=lr(s),Fe=Ka(_.gizmoId??be).data,Pe=Mt(s),Kt=Qa(s),gs=Ja(Pe),Qt=Za(Pe,Kt),hs=Tt(),[ye,Jt,Zt,ps,Le,Si,en,sn,tn,fs,nn,re,xs]=te(s,b=>{const G=L.getParentPromptNode(b,R.id),$=G?.message.clientMetadata?.variantsInStreamInfo??(G?.message.metadata?.paragen_variant_choice?void 0:G?.message.metadata?.paragen_variants_info),O=L.getVariantIds(b,R.id),V=L.getCurrentVariantId(b,R.id),ie=L.getIsDoNotRemember(b),Be=V?O.indexOf(V):0,Hn=$&&b?.tree!=null&&O.some(le=>{const{errType:Ps}=b.tree.getLeafFromNode(le).message.clientMetadata??{};return Ps!=null&&Ps!=="info"}),qe=L.getConversationTurns(b);return[b?.async_status===He.STREAMING,L.isMessageTurnEnded(b,I?.id),Hn,So(b?.mode,Fe?.gizmo.id),b?.continuingFromSharedConversationId!=null,null,qe.findIndex(le=>le.role===z.User)===n,To(qe,le=>le.role===z.User)===n,qe.findIndex(le=>le.role===z.Assistant)===n,L.getRequestId(b,I?.id),$,O,Be,ie]});let an="default";const on=U.some(b=>b.content.content_type===cr.MultimodalText),rn=Qe(p,"3119715334").get("should-enable-skip",!1),{isUnauthenticated:vs}=Lt(),bs=_.messages.map(b=>b.id),Z=l.useRef(null),ys=!u&&(i?.length??0)>2&&i!=="finalAgentTurn"&&a&&M,_e=W?A(ne):void 0,De=_e?.id,ln=l.useCallback(()=>{De&&(q.logEvent("Edit Prompt",{id:De,threadId:me(s)}),dr(p,"chatgpt_edit_prompt"),us(!0))},[De,s,p]),cn=l.useCallback(()=>{us(!1)},[]),_s=eo()??!1,{onChangeRating:dn}=so({clientThreadId:s,currentModelConfig:Pe}),un=b=>{if(!I)return;dn({nodeId:I.id,messageId:I.id,rating:b});const G=_s&&h.some($=>$.type!==Ge&&$.messages?.some(_o));q.logEventWithStatsig(b==="thumbsDown"?"Message Feedback Thumbs Down Clicked":"Message Feedback Thumbs Up Clicked","chatgpt_thumb_feedback",{id:I.id,threadId:me(s),model:r,rating:b,..._s?{isCATriggered:G}:{}}),Yt(!0)},[mn]=l.useState(()=>Date.now()),gn=to(s),hn=Qe(p,"109457",{disableExposureLog:!0}),Ss=te(s,b=>gn&&L.getConversationTurns(b).filter(G=>G.role===z.Assistant).length<=hn.get("onboarding_inject_cards_position",3)),pn=ls(s),Ts=no(s)?.value,fn=Ts===He.STREAMING,xn=Ts===He.REALTIME,js=fs!=null,vn=as(fs),ee=!Jt&&vn||ve||xn,Cs=kt(),[bn,Ms]=l.useState(js),ks=l.useRef(!1),yn=ao(s,I),[,_n]=Yn(),{isOpen:ws}=qs();l.useEffect(()=>{const G=new URLSearchParams(window.location.search).get("message");!(G!=null&&bs.includes(G))||!Z.current||(Z.current.scrollIntoView({behavior:"instant"}),_n(O=>(O.delete("message"),O),{replace:!0,preventScrollReset:!0}))},[]),l.useEffect(()=>{if(u)return;const $=new URLSearchParams(window.location.search).get("message")!=null;if(ks.current||$||i===void 0||!Z.current){i==="finalAgentTurn"&&a&&de(s,O=>{O.scrollToMessageId=void 0});return}(bs.includes(i)||i==="finalAgentTurn"&&a)&&(ks.current=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(Z.current)if(i==="finalAgentTurn"&&a)Z.current.scrollIntoView({behavior:"instant",block:"end"}),de(s,O=>{O.scrollToMessageId=void 0});else{const O=Z.current.offsetHeight;let V;O>tt&&!ws?V=tt-O:V=0,Z.current.style.scrollMarginTop=`${V+hi}px`,Z.current.scrollIntoView({behavior:"smooth"})}})}))},[i,Z.current,ws]);const{showDebugConversationTurns:Sn}=lt(),Tn=oo(),jn=!m&&!Le&&!ms&&!W,Cn=X?.author.role===z.Assistant?X:null,Mn=X?.metadata?.system_hints?.includes(ae.Research);ro({isCompletionRequestInProgress:ee,isUserTurn:W,message:Cn});const{isOpen:kn}=qs(),wn=io(),Se=lo(ps),Te=!Se&&jn&&a&&nn?.num_variants_in_stream===2&&re.length<=2&&!I?.clientMetadata?.inlineComparisonRating&&!Zt,In=jt(b=>b.voiceFeedbackThread),he=a&&(js||pn===In),Is=ye||ee||fn,En=!ds&&!m&&!Le&&!Se&&!kn&&!Ss&&_.role!==z.Developer&&(N?!he||!Is:(bn||he)&&!Is),Nn=U.some(b=>ur(b)===mr.l1239dk1),Rn=he&&!ee&&!Le&&!m&&!Nn&&(E||S||j),je=I!=null&&!0&&(!T||Qt||y||hs)&&!Se&&!vs&&!ms&&!I.metadata?.b1de6e2_s,An=(!T||hs)&&je&&he&&!ye&&!ee,Es=!m&&!((ee||ye)&&a)&&re.length>1&&!Te&&!0&&!Ss,Ns=W&&U.some(b=>co(b)?.shouldHideContent),Fn=W&&_e!=null&&!Se&&!m&&!on&&!Ns&&!vs&&!0&&!Mn,Pn=I!=null&&(I.clientMetadata?.disclaimers??[]).length===0,Rs=l.useCallback(b=>{de(s,G=>{os.setCurrentBranch(G,re[b])}),q.logEvent("Change Active Node",{intent:"toggle_between"})},[s,re]),Ln=uo(_,U,Sn),{toggleThreadSidebar:As}=gr(),Ce=I?.id,Dn=l.useCallback(()=>{Ce&&As({type:"retrievalResults",clientThreadId:s,turnIndex:n,messageId:Ce})},[Ce,As,s,n]),Un=l.useMemo(()=>mo(_,gs,!!be),[gs,be,_]);if(!Ln&&!Te)return ys?e.jsx("div",{style:nt}):null;if(F)return null;const Bn=X?.metadata?.followup_prompts?X.metadata.followup_prompts.map(b=>({text:b,type:mt.Reply})):[],qn=X?.metadata?.category_suggestions,On=!U.some(b=>Ft.getAudioAssetPointers(b).length>0)&&!0&&!be,Gn=!ee&&U.some(b=>b.author.role===z.Assistant&&b.metadata?.onboarding?.main_usages),Ue=U.find(b=>!!b.metadata?.onboarding?.examples)?.metadata?.onboarding?.examples,Fs=!Ns&&(!W||k)&&(!a||!ee);return Tn&&!a&&ne.length===0?null:e.jsxs(ho.Provider,{value:tn,children:[e.jsx(po,{dateHeaderType:g,turn:_}),e.jsxs("article",{className:D("text-token-text-primary w-full",!u&&i==="finalAgentTurn"&&M?"opacity-0":"",{hidden:Xt&&en}),style:ys?nt:void 0,ref:Z,dir:"auto","data-testid":`conversation-turn-${n}`,"data-scroll-anchor":!u&&a,children:[e.jsx(fo,{role:_.role}),e.jsxs(Ye,{verticalPadding:an,horizontalPadding:Te?"none":"standard",children:[Te?e.jsxs(e.Fragment,{children:[e.jsx(Ir,{isFeedbackEnabled:je,variantIds:re,conversationTurnMountTime:mn,...t}),rn&&e.jsx("div",{className:"mt-4 flex w-full justify-center",children:e.jsxs(Nt,{color:"secondary",className:"text-token-text-primary","data-testid":"paragen-skip-button",onClick:()=>{wt.publish({kind:"requestCompletion",isForSkippingParagen:!0})},children:[e.jsx(xo,{className:"text-token-text-secondary me-1"}),e.jsx(B,{id:"IuTr+b",defaultMessage:"Skip"})]})})]}):e.jsx(Ee,{tabIndex:-1,className:"group/turn-messages focus-visible:outline-hidden",onFocus:()=>Ms(!0),onPointerEnter:()=>Ms(!0),children:e.jsxs(e.Fragment,{children:[Wt,!W&&!0&&P&&e.jsx(xi,{children:e.jsx(es,{messages:U,isUserTurn:W,avatarClassName:c,gizmo:Fe})}),e.jsx("div",{className:Xe({isUserTurn:W}),children:e.jsx("div",{className:"relative flex-col gap-1 md:gap-3",children:e.jsxs(e.Fragment,{children:[null,!W&&!m&&e.jsx(mi,{messages:U,clientThreadId:s,gizmoId:Fe?.gizmo.id}),wn&&!W&&e.jsx(gi,{clientThreadId:s,messages:U}),ds&&_e?e.jsx(st,{message:_e,clientThreadId:s,onRequestCompletion:o,onExitEdit:cn,disabled:Cs}):e.jsx(Ze,{allMessages:w,groupedMessagesToRender:Y,allGroupedMessages:h,...t,isUserTurn:W,isFinalUserTurn:sn,isCompletionRequestInProgress:ee,isFeedbackEnabled:je,isFinalTurn:a,hasActiveRequest:Cs}),Un&&e.jsx(Nr,{handleShowRetrievalResults:Dn,clientThreadId:s,turnIndex:n,responseComplete:!(ee||ye)}),Gn&&e.jsx(br,{clientThreadId:s}),Ue&&Ue.length>0&&!ee&&e.jsx(yr,{clientThreadId:s,examples:Ue}),En&&e.jsx(ti,{isUserTurn:W,alwaysShow:he||N,children:W?e.jsx(ai,{activeVariantIndex:xs,clientThreadId:s,numVariants:re.length,onAnticipateEdit:st.prefetch,onChangeIndex:Rs,onEnterEdit:ln,showCopyButton:Fs,showEditMessageButton:Fn,showPagination:Es,turnIndex:n}):e.jsxs(e.Fragment,{children:[e.jsx(ni,{activeVariantIndex:xs,clientThreadId:s,conversationMode:ps,lastMessage:I,messages:U,numVariants:re.length,onChangeIndex:Rs,onRate:un,showCanvasButton:yn&&!0,showCopyButton:Fs,showPagination:Es,showPlayButton:Pn,showRatingButtons:je,showRegenerateButton:On,isJam:f,turn:_,turnIndex:n}),N&&e.jsx(vo,{clientThreadId:s,message:I,turnIndex:n})]})}),An&&e.jsx(ui,{canShowInlineMessageFeedback:$t,clientThreadId:s,messageForRating:I,allGroupedMessages:h,currentModelId:r}),Rn&&e.jsx(Vr,{followups:Bn,categorySuggestions:qn,clientThreadId:s,lastMessageId:Ce,analyticsMetadata:J})]})})})]})}),e.jsx(bo,{clientThreadId:s,turn:_,isFinalTurn:a})]})]})]})}const fi=$n.memo(pi),xi=oe.div`shrink-0 flex flex-col relative items-end`;function vi(t){const n=L.getConversationTurns(t),a=n.findIndex(o=>o.role===z.Assistant);if(a===-1)return;const s=n[a];for(let o=0;o<s.messageGroups.length;o++)if(s.messageGroups[o].type===Bs.SearchGPTQuery){const c=s.messageGroups.slice(o+1).find(({type:i})=>i===Bs.Text);if(c==null)return;const d=hr(c.messages[0]);if(d?.[0]?.type==="navigation")return{turnIndex:a,navigationCitation:d[0],message:c.messages[0]}}}function bi(t,n){if(n==null||t==null)return t;const a=new Set(t.domains.map(s=>s.url));return{...t,domains:[...t.domains,...n.domains.filter(s=>!a.has(s.url))],safe_urls:[...t.safe_urls??[],...n.safe_urls??[]]}}function yi({clientThreadId:t,prefetchNavlink:n,setPrefetchNavlink:a}){const s=l.use(n),{value:o}=Re("1032814809");l.useEffect(()=>{window.__oai_SSR_NAVLINK&&jo.logEvent("Search Tool Page Load Time To Fast Nav SSR",{server_timing:s?.timing},window.__oai_SSR_NAVLINK)},[]),l.useEffect(()=>{s==null&&a(void 0)},[s,a]);const r=l.useMemo(()=>s==null?null:{...s.navlink,domains:s.navlink.domains.map(i=>({...i,subtitle:i.subtitle??i.domain}))},[s]),c=te(t,vi),d=l.useMemo(()=>bi(r,c?.navigationCitation),[c,r]);return s==null||d==null?null:e.jsxs("div",{children:[e.jsx(Ye,{horizontalPadding:"standard",children:e.jsx(Ee,{children:e.jsx("div",{className:Xe({isUserTurn:!0}),children:e.jsx("div",{className:Co(!0),children:e.jsx(Mo,{containsImagesOrAttachments:!1,isUserTurn:!0,children:e.jsx(ko,{text:s.query})})})})})}),e.jsx("div",{className:"-mb-10",children:e.jsx(Ye,{horizontalPadding:"standard",children:e.jsx(Ee,{children:e.jsxs("div",{className:Xe({isUserTurn:!1}),children:[e.jsx(jr,{clientThreadId:t,turnIndex:c?.turnIndex??2,nextMessage:c?.message,navigationCitation:d}),o?e.jsxs("div",{className:"text-token-text-secondary relative -top-2 flex justify-end gap-2 font-mono text-xs",children:[e.jsxs("div",{elementtiming:"navlink",children:["server: ",s.timing,"ms"]}),e.jsx(_i,{})]}):null]})})})}),e.jsx(wo,{scriptSrc:"requestAnimationFrame(()=>window.__oai_SSR_NAVLINK=window.__oai_SSR_NAVLINK||performance.now());"})]})}function _i(){const[t,n]=l.useState(null);return l.useEffect(()=>{const a=new PerformanceObserver(s=>{s.getEntries().forEach(o=>{if(o.identifier==="navlink"){const r=o.renderTime;n(c=>c??r)}})});return a.observe({type:"element",buffered:!0}),()=>a.disconnect()},[]),t==null?null:e.jsxs("span",{children:["render: ",t,"ms"]})}function Bi({onRequestCompletion:t,clientThreadId:n,scrollContainerRef:a,prefetchNavlink:s,setPrefetchNavlink:o}){const[r,c,d,i]=te(n,R=>[R?.mode,L.getConversationTurnIds(R),R?.conversationOrigin===pr.APPLE,R?.scrollToMessageId]),{isNewScrollEnabled:g}=Ct(),u=Io(),x=Eo(),p=No(),[y]=Ro(),m=Ao(),[T]=Fo(),M=Mt(n),k=u.store.useContentAreaDimensions(Po.Header,R=>R?.height?R.height:void 0),N=Lo(M.id),P=r?.kind===Je.GizmoMagicCreate?"bg-token-main-surface-primary text-token-text-primary":N;l.useEffect(()=>{x&&(se.logEvent("chatgpt_continue_conversation_page_loaded"),q.logEvent("Continue Conversation: Page Loaded"),se.logEvent("chatgpt_conversation_share_page_loaded"),q.logEvent("Share Public Chat: Shared Conversation Loaded"))},[x]);const v=l.useCallback(()=>{g||p({behavior:"smooth"})},[g,p]),f=l.useContext(fr),E=xr(f),[j,S]=l.useState(!1),_=(j||!1)&&!E,F=Do(n),w=l.useRef(null),h=Uo(n),C=Bo();return e.jsxs("div",{onCopy:F,className:D("@thread-xl/thread:pt-header-height mt-1.5 flex flex-col text-sm",C&&"keyboard-open:pb-[calc(var(--composer-height,100px)+var(--screen-keyboard-height,0))]",k?null:!g&&"pb-25"),style:{paddingBottom:k},children:[s?e.jsx(vr,{name:"prefetch-navlink",onError:R=>{Ke.addError("Error with prefetch navlink",{error:R}),o(void 0)},children:e.jsx(l.Suspense,{fallback:null,children:e.jsx(yi,{clientThreadId:n,prefetchNavlink:s,setPrefetchNavlink:o})})}):null,x&&e.jsxs(e.Fragment,{children:[e.jsx(Ee,{children:e.jsx("p",{className:"text-xs text-gray-500",children:e.jsx(B,{id:"threadLayout.sharedConversationCopyDisclaimer",defaultMessage:"This is a copy of a conversation between ChatGPT & Anonymous."})})}),e.jsx("div",{className:"text-token-text-primary text-center text-xs font-semibold",children:e.jsx("button",{onClick:()=>{vt.openModal(qo.ReportConversation),se.logEvent("chatgpt_conversation_share_report_content_clicked",null,{location:"Static Shared Thread Page"}),q.logEvent("Share Public Chat: Report Content Clicked",{location:"Dynamic Shared Thread Page"})},children:e.jsx(B,{id:"thread.reportSharedConversation",defaultMessage:"Report content"})})})]}),c.map((R,I)=>e.jsx(fi,{isFinalTurn:I===c.length-1,turnIndex:I,clientThreadId:n,onRequestCompletion:t,currentModelId:M.id,avatarClassName:P,scrollToBottom:g?void 0:v,scrollToMessageId:g?void 0:i,dateHeaderType:h(I),showAvatar:void 0},R)),!g&&e.jsxs(e.Fragment,{children:[a?.current&&e.jsx(Oo,{setIsScrolledToEdge:R=>{S(R)},options:{root:a.current,threshold:0,rootMargin:"0%"}},"threadBottomEdgeScrollObserver"),e.jsx("div",{ref:w}),d&&y&&!T&&e.jsx(at,{className:D("translate-y-[10px] md:translate-y-[30px]"),onClick:()=>{se.logEvent("chatgpt_thread_scroll_to_top"),m({behavior:"smooth"})},children:e.jsx(Go,{className:"icon-md text-token-text-primary"})}),e.jsx(xe,{children:_&&e.jsx(H.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15,ease:"easeInOut"},children:e.jsx(at,{className:D(k?null:"bottom-8"),style:{bottom:k},onClick:()=>{se.logEvent("chatgpt_thread_scroll_to_bottom"),w.current?.scrollIntoView({behavior:"smooth",block:"end"})},children:e.jsx(Ho,{className:"icon-md text-token-text-primary"})})})})]})]})}const at=oe.button`cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-token-text-secondary border-token-border-default end-1/2 translate-x-1/2 bg-token-main-surface-primary w-8 h-8 flex items-center justify-center`;export{Bi as T};
//# sourceMappingURL=hdusgp6ndfp1vzue.js.map
