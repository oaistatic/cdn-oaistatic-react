import{r as u,f as E,j as e,M as m}from"./lip667d8t42poxum.js";import{eJ as O,ew as _,lv as T,aF as z,fz as A,an as I}from"./l4oo5ijw01fyrjzs.js";import{c as h,B as C,ec as R,m as W}from"./n9zp7vm10xoipejo.js";import{C as H,S as U,i as K,g as $,D as J,f as q}from"./8jh1d59j0bidwcwx.js";import{i as G}from"./j8vdq5u0dah3tad5.js";import{F as Q}from"./d16bp83dnd0g4dve.js";import{W as X}from"./fw89hpm6ehbsygz7.js";import"./ojvadmnty96xvqkr.js";import"./gssjqrozvzmyjg6o.js";import"./nmzcjggnos81a3wt.js";import"./ezoyp421dng92ve4.js";import"./krf7zg7fy4qqowqq.js";import"./j385t288u9l3nf6j.js";import"./d7qhj0hizrl5q10d.js";import"./j1bb88glgmel43br.js";import"./n7emuv1efbtdnxb9.js";import"./ef49rx2y546x1g51.js";import"./d61ttkht2554hc14.js";import"./iguubsmy82ykz2l9.js";import"./ex0w8u6azfclal10.js";import"./xbx5ij165jfnp313.js";import"./oc4rktd8eofx28ec.js";import"./h6u5tn9ugd2tunyc.js";import"./pb0xfopp3f7joxj4.js";import"./fcfjbsbarhrilkf6.js";import"./ocylzx9oqlg8ycwm.js";import"./jilfkjkciycvhk2x.js";import"./f64hg6fdq8ojkhjz.js";import"./ju8q15l0hqy6ti9z.js";import"./gydkbc6xtfcf9567.js";import"./btgi4ch9w5xby7vu.js";import"./es0z9v8doc0hgjd4.js";import"./jpfsl7zlesohw8kt.js";import"./ctz8d92lx4gyhixb.js";import"./cg71y7d9v77500qa.js";import"./m27zu1gl0gszchhw.js";import"./s0vortm3fnmb5s99.js";import"./bz6kdye13oi6n32b.js";import"./b2byc8rvxtjtrqes.js";import"./bir4gwnbq17hkvt3.js";import"./ls58p44u0ovqzhvw.js";import"./eef33l65z4kyipsv.js";import"./oe646f7iouawgq3e.js";function B({filePath:t,side:f,lineNumber:x,onSubmit:a,onDelete:s,onClose:r,initialComment:i}){const g=i?D(i):"",[o,l]=u.useState(i?D(i):""),[b,w]=u.useState(!i),[j,v]=u.useState(!1),y=u.useRef(null),k=E(),F=()=>{if(!o)return;const d=i?{...i,content:[{content_type:"text",text:o}]}:{id:crypto.randomUUID(),type:"comment",content:[{content_type:"text",text:o}],position:{side:f===U.old?"left":"right",path:t,line:x}};a?.(d),w(!1),y.current?.blur(),r?.()};return u.useEffect(()=>{!j&&i&&o===g&&setTimeout(()=>{w(!1)},100),j&&(w(!0),y.current?.focus())},[j,i,o,g]),e.jsx("div",{className:"gap-2 bg-gray-100/50 p-4 font-sans dark:bg-gray-900",id:i?.id,children:e.jsxs("div",{className:h("flex flex-col gap-2",H),children:[e.jsx(G,{ref:y,className:"border-token-border-medium bg-token-main-surface-primary text-token-text-primary border-1.5 w-full resize-none rounded-lg p-4 text-sm ring-0 focus:border-black focus:outline-hidden dark:focus:border-white",onFocus:()=>v(!0),onBlur:()=>v(!1),placeholder:k.formatMessage({id:"code.diff.addComment",defaultMessage:"Add a comment"}),minRows:1,maxRows:10,autoFocus:!i,onSubmit:()=>{},value:o,onChange:d=>l(d.target.value),onKeyDown:d=>{d.key==="Enter"&&d.metaKey&&(d.preventDefault(),F()),d.key==="Escape"&&(d.preventDefault(),r?.())}}),b&&e.jsxs("div",{className:h("mt-2 flex items-center justify-between gap-2",!s&&"justify-end"),children:[s&&e.jsx(C,{color:"danger",onClick:()=>s?.(),children:e.jsx(m,{id:"code.diffComment.delete",defaultMessage:"Delete"})}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(C,{color:"secondary",onClick:()=>{r?.(),w(!1),i&&l(D(i))},children:e.jsx(m,{id:"code.diffComment.cancel",defaultMessage:"Cancel"})}),e.jsx(C,{color:"primary",disabled:!o,onClick:F,children:i?e.jsx(m,{id:"code.diffComment.save",defaultMessage:"Save"}):e.jsx(m,{id:"code.diffComment.comment",defaultMessage:"Comment"})})]})]})]})})}function D(t){return t.content.map(f=>f.content_type==="text"?f.text:"").join("")}function Y({copyDiffToClipboard:t,copyPatchToClipboard:f}){const[x,a]=u.useState(!1),s=r=>i=>{i.preventDefault(),i.stopPropagation(),r==="diff"?t():f()};return e.jsxs(O,{open:x,onOpenChange:a,contentAlign:"end",sideOffset:8,triggerButton:e.jsx("button",{type:"button",onClick:r=>{r.preventDefault(),r.stopPropagation(),a(!0)},className:"hover:bg-token-border-light rounded p-1",children:e.jsx(z,{className:"icon-md"})}),children:[e.jsx(_.Item,{icon:T,onClick:s("diff"),children:e.jsx(m,{id:"wham.copyFile.apply",defaultMessage:"Copy git apply"})}),e.jsx(_.Item,{icon:T,onClick:s("patch"),children:e.jsx(m,{id:"wham.copyFile.patch",defaultMessage:"Copy patch"})})]})}const Z="_diffView_avtz7_1",ee={diffView:Z};function te({diff:t,viewType:f,stickyHeader:x,enableComments:a=!1,comments:s,onCommentCreate:r,onCommentDelete:i,onCommentUpdate:g}){const o=R(),l=E(),[b,w]=u.useState(()=>!K(t.diffFile)),[j,v]=u.useState(!1),y=W();u.useEffect(()=>{t.diffFile.initTheme(o?"dark":"light")},[t.diffFile,o]);const k=(s??[]).reduce((n,c)=>{const p=c.position.path,M=c.position.side,N=c.position.line;n[p]||(n[p]={oldFile:{},newFile:{}});const S=M==="left"?n[p].oldFile:n[p].newFile;return S&&(S[N]={data:c}),n},{}),F=$(t.diffFile),d=()=>{navigator.clipboard.writeText(t.diffFile._newFileName),v(!0),setTimeout(()=>{v(!1)},1e3)},V=async()=>{t.hunksText&&(await navigator.clipboard.writeText(` (cd "$(git rev-parse --show-toplevel)" && git apply --3way <<'EOF' 
${t.hunksText} 
EOF
)`),y.success(l.formatMessage({id:"wham.message.modal.footer.copiedToClipboard",defaultMessage:"Copied git apply command to clipboard"}),{duration:3,hasCloseButton:!0}))},P=async()=>{t.hunksText&&(await navigator.clipboard.writeText(t.hunksText),y.success(l.formatMessage({id:"wham.codeDiff.copiedPatchToClipboard",defaultMessage:"Copied patch to clipboard"}),{duration:3,hasCloseButton:!0}))},L=!t.diffFile.unifiedLineLength&&!t.diffFile.splitLineLength;return e.jsxs("div",{"data-diff-header":F,className:h("flex flex-col pt-1",ee.diffView),children:[e.jsx("div",{role:"button",onClick:()=>w(!b),className:h("focus-visible:outline-none",x&&"sticky top-0 z-1"),children:e.jsxs("div",{className:h("bg-token-bg-primary border-token-border-default relative flex items-center rounded-t-2xl border px-4 py-3 text-sm font-medium before:absolute before:inset-x-[-1px] before:top-[-1px] before:bottom-0 before:z-[-1] before:bg-[var(--right-bg)] before:content-['']",!b&&"rounded-b-2xl"),children:[e.jsx(A,{className:h("icon-md me-3 transition-transform duration-200",b&&"rotate-90")}),e.jsx("span",{className:"me-1 truncate text-start select-text",title:F,children:F}),e.jsx(Q,{diffFile:t.diffFile}),e.jsx(I,{label:l.formatMessage({id:"wham.codeDiff.copiedFileName",defaultMessage:"Copied File Name"}),open:j,children:e.jsx("div",{role:"button",onClick:n=>{n.preventDefault(),n.stopPropagation(),d()},className:"hover:bg-token-border-light rounded p-1",children:e.jsx(T,{className:"icon-xs"})})}),e.jsxs("div",{className:"ms-auto flex items-center gap-1 ps-1",children:[e.jsx(X,{linesAdded:t.diffFile.additionLength,linesRemoved:t.diffFile.deletionLength}),!t.isBinary&&e.jsx(Y,{copyDiffToClipboard:V,copyPatchToClipboard:P})]})]})}),b&&(L||t.isBinary?e.jsx("div",{className:"text-token-text-secondary bg-token-bg-secondary flex h-full justify-center rounded-b-2xl py-4 text-sm font-medium",children:t.isBinary?e.jsx(m,{id:"wham.diff.binaryFile",defaultMessage:"Binary file not shown"}):e.jsx(m,{id:"wham.diff.noContent",defaultMessage:"No content"})}):e.jsx(J,{className:h("relative overflow-clip rounded-b-2xl transition-opacity duration-300","after:border-token-border-default after:pointer-events-none after:absolute after:inset-0 after:rounded-b-2xl after:border-s after:border-e after:border-b after:content-['']"),diffViewFontSize:12,diffFile:t.diffFile,diffViewTheme:o?"dark":"light",diffViewHighlight:!0,diffViewMode:f==="split"&&!q(t.diffFile)?3:4,diffViewWrap:!0,diffViewAddWidget:a,extendData:k[t.diffFile._newFileName],renderExtendLine:({lineNumber:n,side:c,data:p})=>!a||!(c===1?k[t.diffFile._newFileName]?.oldFile:k[t.diffFile._newFileName]?.newFile)?null:e.jsx(B,{initialComment:p,onSubmit:N=>g?.(N),onDelete:()=>i?.(p),filePath:t.diffFile._newFileName,side:c,lineNumber:n}),renderWidgetLine:({onClose:n,lineNumber:c,side:p})=>!a||!r?null:e.jsx(B,{onSubmit:r,onClose:n,filePath:t.diffFile._newFileName,side:p,lineNumber:c})}))]})}function Ke({diffFiles:t,unifiedDiff:f,enableComments:x,comments:a,setComments:s}){if(!t.length)return e.jsx("div",{className:"flex h-full w-full flex-1 items-center justify-center",children:e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(m,{id:"wham.whamTaskPageCodeDiffContent.noDiffAvailable",defaultMessage:"No diff available"})})});function r(o){!s||!a||s([...a,o])}function i(o){!s||!a||s(a.filter(l=>l.id!==o.id))}function g(o){!s||!a||s(a.map(l=>l.id===o.id?o:l))}return e.jsx("div",{className:"relative h-full w-full pt-6",children:e.jsx("div",{className:"flex h-full w-full flex-col gap-6 overflow-y-auto px-6 pb-6",children:t.map(o=>e.jsx(te,{diff:o,stickyHeader:!0,viewType:f?"unified":"split",enableComments:x,comments:x?a:[],onCommentCreate:r,onCommentDelete:i,onCommentUpdate:g},o.diffFile._newFileName))})})}export{Ke as WhamTaskPageCodeDiffContent};
//# sourceMappingURL=ecbmrv5en2be97yj.js.map
