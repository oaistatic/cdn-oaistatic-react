const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jn0qh9qt9c24rvds.js","assets/n9zp7vm10xoipejo.js","assets/lip667d8t42poxum.js","assets/root-ivmjnum3.css","assets/ezoyp421dng92ve4.js","assets/l4oo5ijw01fyrjzs.js","assets/conversation-small-k5k9c71c.css","assets/krf7zg7fy4qqowqq.js","assets/j385t288u9l3nf6j.js","assets/nmzcjggnos81a3wt.js","assets/m5nmfgkx7kb16kea.js","assets/frsgt7dup0f3mfs8.js","assets/jrbfupmnwi0b2in6.js","assets/czpmep8a1gn2yxp9.js","assets/g1x7jf9g2b4osi6b.js","assets/kdkl0k5zipatley9.js","assets/oour34cwuwf9tyoh.js","assets/n7emuv1efbtdnxb9.js","assets/ef49rx2y546x1g51.js","assets/h5ge3c3mruoe76ro.js","assets/flqsbet8wo14mte0.js","assets/g1wxldf6nb3zk37x.js","assets/cbaql59zac1mfnmh.js","assets/op1xowyjquc2dnq7.js","assets/dih8dferf1paqxo1.js","assets/d61ttkht2554hc14.js","assets/fcstnnugjba7r74i.js","assets/n0pa7j0wpnznnwf7.js","assets/h2xyil3hz732ienl.js"])))=>i.map(i=>d[i]);
import{c as L,dO as Z,ae as ue,eq as Ie,bC as je,aj as ie,W as Ce,F as ke,ec as Ee,as as Se,at as oe,cv as z,d$ as Re,aa as Ge,dj as Ne,hf as Ae,k as Te,X as De,_ as Pe}from"./n9zp7vm10xoipejo.js";import{j as a,a5 as ee,f as U,r as n,g as Oe,M as Le,a as Fe,p as Ue}from"./lip667d8t42poxum.js";import{I as ae,D as He,a as ge,u as ze}from"./nn3zup2d799glqdm.js";import{bj as me,fq as Be,hJ as We,dq as $e,bm as se,bn as D,hK as Ve,an as J,bt as Ke,ax as fe,bu as qe,aw as he,hB as Xe,bx as pe,bw as Ye,bo as Qe,by as Je,rd as Ze,re as et,bl as tt,i0 as at,jK as xe,jM as nt}from"./l4oo5ijw01fyrjzs.js";import{b as st}from"./nes6faz3el60eb3o.js";import{u as it}from"./kdkl0k5zipatley9.js";import{I as ot}from"./n0pa7j0wpnznnwf7.js";import{C as rt}from"./oe646f7iouawgq3e.js";import"./ompbofktfjr0ksz2.js";import"./ju8q15l0hqy6ti9z.js";import"./ezoyp421dng92ve4.js";import"./krf7zg7fy4qqowqq.js";import"./j385t288u9l3nf6j.js";import"./h2xyil3hz732ienl.js";function lt({title:e,description:t,shimmer:s}){return!e&&!t?null:a.jsxs("div",{className:"border-token-border-default my-2 max-w-[480px] min-w-72 rounded-2xl border p-6",children:[!!e&&a.jsx("p",{className:L("text-lg font-medium",s&&"loading-shimmer-pure-text-inverted",!!t&&"mb-1"),children:e}),!!t&&a.jsx("p",{children:t})]})}const be=({children:e,isDimensionsUnknown:t})=>a.jsxs(ee.div,{className:L(["relative max-w-[480px] rounded-2xl",t&&"aspect-square overflow-hidden"]),children:[a.jsx("div",{className:"bg-token-main-surface-secondary pointer-events-none absolute inset-0"}),a.jsx("div",{className:"relative h-full",children:e})]});var b=(e=>(e.Unavailable="unavailable",e.Thinking="thinking",e.Generating="generating",e.AsyncGenerating="async_generating",e.AsyncHanging="async_hanging",e.Complete="complete",e.Errored="errored",e.Empty="empty",e))(b||{});const ct="sj1i4kz",$=`${Z.T2UAY3K}.${ct}`,dt=({cotMessages:e,visualPercentComplete:t,isInterrupted:s=!1,state:i})=>{const u=U().formatMessage({id:"imagegen.thinkingHeader.interrupted",defaultMessage:"Stopped creating image"}),r=i===b.Complete||t===1,h=n.useMemo(()=>{if(s)return u;if(!e)return;if(r)return e.complete;if(t){const m=Object.keys(e.generating);for(let f=0;f<m.length;f+=1){const d=parseFloat(m[f]);if(t<d)return e.generating[m[f]]}}else return e.thinking;return e.complete},[e,u,s,r,t]);return h&&a.jsx(st,{latestHeadline:h,isComplete:r||s,isExpandDisabled:!0})},ut="ChatGPT Image";function re({rightAlign:e=!1,bottomAlign:t=!1,fullWidth:s=!1,justifyBetween:i=!1,alwaysVisible:o=!1,children:u}){return a.jsxs("div",{className:L("absolute z-2 transition-opacity duration-300",o?"opacity-100":"opacity-0 group-hover/imagegen-image:opacity-100 group-focus/imagegen-image:opacity-100 focus-within:opacity-100",e?"end-0":"start-0",t?"bottom-0":"top-0",s&&"w-full"),children:[a.jsx("div",{className:L(t?"bg-linear-to-b":"bg-linear-to-t","from-transparent to-black/30","h-20 w-full")}),a.jsx("div",{className:L("absolute inset-0 flex",t?"items-end py-4":"items-start py-4",e?"justify-end px-4":"justify-start px-4",i&&"justify-between"),children:u})]})}function B({icon:e,children:t,selected:s,disabled:i,onClick:o,ariaLabel:u}){return a.jsxs("button",{className:L("hover:bg-white/15 hover:backdrop-blur-md focus:bg-white/15 focus:backdrop-blur-md","z-11 flex h-10 items-center justify-center gap-1 rounded-xl font-semibold text-white",t==null?"w-10":"px-2"),onClick:o,disabled:i??s,"aria-label":u,children:[a.jsx(e,{style:{filter:"drop-shadow(0px 2px 4px rgba(0, 0, 0, 0.15))"},className:L("icon-lg",s?"fill-current":"fill-transparent")}),t]})}function X(e){return t=>{t.stopPropagation(),e()}}const gt=({image:e,imageUrl:t,onEditorClick:s,isEditorAvailable:i,messageId:o,clientThreadId:u,serverThreadId:r,shouldShowOverflow:h=!1})=>{const{value:m}=ue("706943082"),{config:f}=Ie("2248456840"),d=f.get("enabled",!1),c=U(),[p,l]=n.useState(!1),[x,y]=n.useState(null),M=me(),g=S=>{x==null&&(D.imageRated({liked:S,analyticsContext:M}),y(S),S||l(!0))},G=n.useCallback(()=>{const S=new Date,I=c.formatDate(S,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"});return`${ut} ${I}.png`},[c]),N=Be(),P=We(),v=P?.type===$e.Image&&P.image.asset_pointer===e?.asset_pointer,[w,E]=n.useState(!1),A=n.useCallback(()=>{e?.asset_pointer&&(se({url:e?.asset_pointer,fileName:G()}),D.download({analyticsContext:M}))},[e,G,M]);return a.jsxs(a.Fragment,{children:[N?!v&&a.jsx(re,{rightAlign:!0,fullWidth:!0,children:a.jsx(B,{icon:Ve,ariaLabel:c.formatMessage(W.expand)})}):a.jsx(a.Fragment,{children:a.jsx(re,{bottomAlign:!0,rightAlign:!0,fullWidth:!0,alwaysVisible:w,children:a.jsxs("div",{className:"flex w-full items-center justify-between",children:[a.jsxs("div",{className:"flex ps-1",children:[x!==!1&&a.jsx(J,{label:c.formatMessage({id:"U99PVw",defaultMessage:"Like"}),delayDuration:300,children:a.jsx(B,{icon:x===!0?Ke:fe,onClick:X(()=>g(!0)),ariaLabel:c.formatMessage(W.thumbsUp)})}),x!==!0&&a.jsx(J,{label:c.formatMessage({id:"ncGqTt",defaultMessage:"Dislike"}),delayDuration:300,children:a.jsx(B,{icon:x===!1?qe:he,onClick:X(()=>g(!1)),ariaLabel:c.formatMessage(W.thumbsDown)})}),i&&!m&&a.jsx(J,{label:c.formatMessage({id:"UH0Ly0",defaultMessage:"Edit image"}),children:a.jsx(B,{icon:Xe,ariaLabel:c.formatMessage(W.inpaint),onClick:X(()=>{s?.(),D.inpaintStarted({analyticsContext:M})})})}),t&&a.jsx(J,{label:c.formatMessage({id:"0EYire",defaultMessage:"Download"}),children:a.jsx(B,{icon:pe,ariaLabel:c.formatMessage(W.download),onClick:X(()=>{se({url:t,fileName:G()}),D.download({analyticsContext:M})})})}),d&&h&&a.jsx(Ye,{onOpenChange:E,onDownload:A,triggerClassName:"z-11 flex h-10 w-10 items-center justify-center rounded-xl bg-transparent hover:bg-token-icon-surface/10 focus:bg-token-icon-surface/10 focus-visible:bg-token-icon-surface/10",iconClassName:"icon-lg fill-transparent text-white",dropdownClassName:"z-11 min-w-fit origin-top-right text-token-text-primary"})]}),a.jsx("div",{className:"flex",children:a.jsx(mt,{clientThreadId:u,messageId:o})})]})})}),p&&a.jsx(ot,{messageId:o??"",serverThreadId:r??"",rating:x,onClose:()=>l(!1)})]})};function mt({clientThreadId:e,messageId:t}){const[s,i]=n.useState(!1),o=U(),u=je(),r=Qe(),h=!u&&r(),m=it({clientThreadId:e,imageGenMessageId:t});return n.useEffect(()=>{h&&ie.logEventWithStatsig("Share Post: Share Button Shown","chatgpt_post_share_button_shown",{source:"image_gen_action_overlay"})},[h]),h?a.jsx(B,{icon:s?Ce:Je,disabled:s,onClick:X(async()=>{i(!0);try{await m()}finally{i(!1)}ie.logEventWithStatsig("Share Post: Share Button Clicked","chatgpt_post_share_button_clicked",{source:"image_gen_action_overlay"})}),ariaLabel:o.formatMessage(W.share),children:a.jsx(Le,{id:"imageGenActionOverlay.shareButton",defaultMessage:"Share"})}):null}const W=Oe({thumbsUp:{id:"imageGenActionOverlay.thumbsUp",defaultMessage:"Like this image"},thumbsDown:{id:"imageGenActionOverlay.thumbsDown",defaultMessage:"Dislike this image"},inpaint:{id:"imageGenActionOverlay.inpaint",defaultMessage:"Enter inpainting mode"},download:{id:"imageGenActionOverlay.download",defaultMessage:"Download this image"},expand:{id:"imageGenActionOverlay.expand",defaultMessage:"Expand this image"},share:{id:"imageGenActionOverlay.share",defaultMessage:"Share this image"}}),le=ke.div`invisible absolute top-3 flex gap-1 group-hover/paragen-image:visible z-2
  ${({$rightAlign:e})=>e?"end-3":"start-3"}
  ${({$alwaysVisible:e})=>e?"visible":""}`,ft=({imageUrl:e})=>{const[t,s]=n.useState(void 0),i=U(),o=me(),u=n.useCallback(()=>{const r=new Date;return`${i.formatDate(r,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}.png`},[i]);return a.jsxs("div",{className:"group/paragen-image absolute inset-0 z-3",children:[a.jsxs(le,{$alwaysVisible:!0,children:[t!==!1&&a.jsx(ae,{icon:fe,selected:t===!0,variant:"large",onClick:r=>{r.stopPropagation(),D.paragenImageRated({liked:!0,analyticsContext:o}),s(!0)}}),t!==!0&&a.jsx(ae,{icon:he,selected:t===!1,variant:"large",onClick:r=>{r.stopPropagation(),D.paragenImageRated({liked:!1,analyticsContext:o}),s(!1)}})]}),a.jsx(le,{$alwaysVisible:!0,$rightAlign:!0,children:a.jsx(ae,{icon:pe,variant:"large",onClick:r=>{r.stopPropagation(),D.paragenDownload({analyticsContext:o}),se({url:e,fileName:u()})}})})]})};function Me({withLottie:e}){const s=U().formatMessage({id:"imagegen.progressIndicator.ariaLabel",defaultMessage:"Generating image..."});return a.jsx("div",{className:"absolute start-0 top-0 flex h-full w-full items-center justify-center rounded-full","aria-label":s,children:a.jsx(rt,{size:40,arcPercentage:.2,children:a.jsx(He,{animate:e,matchTextColor:!0,className:"h-6 w-6"})})})}const ye=300,ht=1.3,ce=.05,pt=/blur\(([\d.]+)px\)/,xt={duration:ye/1e3,ease:"linear"};function ne(e,t,s){e.sort((r,h)=>r.lastSrcReceivedTime-h.lastSrcReceivedTime);const i=new Array(e.length).fill(0);for(let r=0;r<=e.length;r+=1){const h=r-1,m=r,f=e[h]?.availablePercentComplete??0,d=e[m]?.availablePercentComplete??1;if(t>=f&&t<=d&&f!==d){const c=(t-f)/(d-f);i[h]=1-c,i[m]=c}}const o=i[i.length-1],u=i[i.length-2];return o===1&&u===0&&(i[i.length-2]=.01),s&&t<=e[0]?.availablePercentComplete&&(i[0]=1),i}const bt=({alt:e,src:t,availablePercentComplete:s,onAnimationUpdate:i,ignoreFirstChunk:o=!1,isTransparent:u=!1,dimensions:r,onError:h,unconstrainedWidth:m=!1})=>{const f=Ee(),d=n.useMemo(()=>`url(${f?Ze:et})`,[f]),[c,p]=n.useState(!1),[l,x]=n.useState(1e3),[y,M]=n.useState(s??0),[g,G]=n.useState(0),N=n.useRef(performance.now()),P=n.useRef(0),v=n.useRef([]),[w,E]=n.useState([0]),[A,S]=n.useState(!1),I=n.useRef(!1),R=n.useRef(null),F=y===1,j=s===1&&A,O=r?r.width/r.height:1;n.useEffect(()=>{!c&&s&&(p(!0),P.current=performance.now())},[c,s]),n.useEffect(()=>{const _=v.current[v.current.length-1]?.src;if(t&&t!==_){const T=v.current.findIndex(q=>q.availablePercentComplete===s);T!==-1?v.current[T]={src:t,availablePercentComplete:s??0,lastSrcReceivedTime:performance.now()}:v.current.push({src:t,availablePercentComplete:s??0,lastSrcReceivedTime:performance.now()}),E(ne(v.current,y,o))}},[t,y,o,s]);const V=n.useCallback(()=>{R.current&&s&&(x(j?ye:(performance.now()-N.current)*ht),(!o||I.current||s>=ce)&&s!==1&&G(s),I.current=!0,N.current=performance.now())},[s,j,o]),H=n.useCallback(_=>{const T=parseFloat(_.height)/100;i?.(T),M(T),E(ne(v.current,parseFloat(_.height)/100,o))},[i,o]),C=n.useCallback(_=>{const T=_.filter.toString().match(pt)?.[1]??"0",Q=(16-parseFloat(T))/16,we=1-g,te=g+we*Q;i?.(te),M(te),E(ne(v.current,te,o))},[o,g,i]);if(!c)return a.jsx(be,{isDimensionsUnknown:!0,children:a.jsx(Me,{withLottie:!0})});const K={duration:l/1e3,ease:"linear"},k=s!==1||!u;return a.jsxs("div",{className:L("relative z-0 cursor-pointer overflow-hidden",O<1?"max-w-[400px]":"max-w-[480px]",!F&&"pointer-events-none",!I.current&&"bg-token-main-surface-secondary",m&&"max-w-full"),"aria-label":e,style:{aspectRatio:O},children:[s&&s<ce&&a.jsx("div",{className:"absolute inset-0 z-3 w-full overflow-hidden",children:a.jsx("div",{className:"absolute start-[-150%] top-[-150%] h-[400%] w-[400%]",children:a.jsx("div",{className:"diagonal-sweep-gradient h-full w-full"})})}),a.jsxs(ee.div,{className:"absolute start-0 end-0 top-0 z-2 w-full overflow-hidden transition-[mask] ease-linear",initial:j?!1:{height:"0%"},animate:F?{height:"100%"}:{height:`${g*100}%`},onUpdate:j?void 0:H,transition:j?{duration:0,ease:"linear"}:K,style:F?void 0:{mask:"linear-gradient(rgb(0,0,0) 0%, rgb(0,0,0) calc(100% - 24px), rgba(0,0,0,0) 100%)"},children:[t&&a.jsx("img",{ref:R,src:t,onLoad:V,onError:h,alt:e,className:"absolute top-0 z-1 w-full",style:{aspectRatio:O}}),u&&a.jsx("div",{className:"absolute inset-0 z-0 w-full overflow-hidden opacity-0 transition-opacity duration-300 group-hover/imagegen-image:opacity-100 group-focus/imagegen-image:opacity-100",children:a.jsx("div",{className:"absolute inset-0 bg-repeat",style:{backgroundImage:d,backgroundSize:"auto"}})})]}),a.jsx(ee.div,{className:"relative z-1 w-full overflow-hidden",initial:{filter:"blur(16px)"},animate:j?{filter:"blur(0px)"}:void 0,transition:j?xt:void 0,onUpdate:j?C:void 0,style:{aspectRatio:O},children:v.current.map((_,T)=>{const q=w[T],Q=_.availablePercentComplete===1;return q!==0||Q?a.jsx("img",{src:_.src,alt:e,style:{opacity:q,willChange:"opacity",aspectRatio:O},className:"absolute top-0 w-full",onLoad:Q?()=>S(!0):void 0},_.src):null})}),a.jsx(ee.div,{className:"absolute inset-0 z-0 scale-110 overflow-hidden blur-2xl",style:{aspectRatio:O},children:k&&v.current.filter((_,T)=>w[T]!==0).map(_=>a.jsx("img",{src:_.src,alt:e,className:"absolute top-0 w-full"},_.src))})]})},de=2,ve=({pointer:e,altLabel:t,isEditorAvailable:s,onPercentageRendered:i,messageId:o,clientThreadId:u,serverThreadId:r,isMultiGen:h,onEditorClick:m})=>{const f=Fe(),[d,c]=n.useState(void 0),p=n.useRef(void 0),l=e.metadata?.generation?.gen_id,x=e.metadata?.generation?.height??void 0,y=e.height,M=(x??0)/y,g=n.useRef({}),[G]=Ue(),{isUnauthenticated:N}=Se(),[P,v]=n.useState(!1),w=n.useContext(ge),E=e.width/e.height,A=tt({imageAssetPointer:e,serverThreadId:r}),I=n.useCallback((k=!1)=>{!k&&p.current===e.asset_pointer||(p.current=e.asset_pointer,at.fetch(f,{asset:e,conversationId:r,force:k,isUnauthenticated:N}).then(_=>{c(_)}).finally(()=>{p.current=void 0}))},[e,f,r,N,null]);n.useEffect(()=>{const k=e.asset_pointer!==d?.asset_pointer;(!d||k)&&I()},[d,e.asset_pointer,I]);const R=n.useMemo(()=>xe({pointer:d,conversationId:r,messageId:o,source:w?"paragen":"chat"}),[d,r,o,w]),F=n.useRef(M);n.useEffect(()=>{M===1&&F.current<1&&D.renderingComplete({analyticsContext:R})},[M,R]);const j=n.useCallback(()=>{d&&m?.({image:d,messageId:o,analyticsContext:R})},[d,o,m,R]),O=n.useMemo(()=>({width:e.width,height:e.height}),[e]),V=n.useCallback(()=>{const k=(g.current[e.asset_pointer]??0)+1;if(g.current[e.asset_pointer]=k,g.current[e.asset_pointer]>de)return oe.addAction("image-gen-asset-error",{name:"retries-exhausted",conversation_id:r,asset_pointer:e.asset_pointer,max_retries:de});oe.addAction("image-gen-asset-retry",{name:"retry-attempted",conversation_id:r,asset_pointer:e.asset_pointer,current_retry:k}),g.current[e.asset_pointer]=k,I(!0)},[e.asset_pointer,I,r]),H=n.useCallback(k=>{k===1&&v(!0),i?.(k)},[i]),C=d?.url,Y=h?"rounded-lg":"rounded-2xl",K=A??C;return a.jsx(nt.Provider,{value:R,children:a.jsxs("div",{className:L("group/imagegen-image relative overflow-hidden",E<1?"max-w-[400px]":"max-w-[480px]",Y,w&&"max-w-full",o===G.get("image")&&"[view-transition-name:var(--vt-active-image)]"),id:`image-${o}`,style:{aspectRatio:E},onClick:s?j:void 0,tabIndex:0,children:[A&&a.jsx("img",{alt:t,className:"absolute inset-0 z-1 opacity-0",src:A}),a.jsx(bt,{alt:t,src:C,availablePercentComplete:M,onAnimationUpdate:H,isEditorAvailable:s,ignoreFirstChunk:!0,isTransparent:e.metadata?.generation?.transparent_background,dimensions:O,onError:V,unconstrainedWidth:w},l),P&&(w?a.jsx(ft,{imageUrl:C??""}):a.jsx(gt,{image:C?{asset_pointer:C,alt:t,fileId:R.fileId}:void 0,imageUrl:K,onEditorClick:j,isEditorAvailable:s,messageId:o,clientThreadId:u,serverThreadId:r,shouldShowOverflow:A!==void 0}))]},l)})},Mt=({pointersToRender:e,altLabel:t,isEditorAvailable:s,updatePercentageRendered:i,messageIds:o,clientThreadId:u,serverThreadId:r,handleEditorClick:h})=>{const m=n.useRef({}),f=n.useCallback(d=>c=>{m.current[d]=c;const p=Object.keys(m.current).length,l=Object.values(m.current).reduce((x,y)=>x+y,0);i?.(l/p)},[i]);return e.map((d,c)=>{const p=d.metadata?.generation?.gen_id;return a.jsx(ve,{pointer:d,altLabel:t,isEditorAvailable:s,onPercentageRendered:p?f(p):void 0,messageId:o[c],clientThreadId:u,serverThreadId:r,isMultiGen:!0,onEditorClick:h},p)})};function yt(e){const t=e.find(r=>r.author.role==="tool"&&r.author.name===$&&r.content.content_type==="text"),[s,...i]=t?.content.content_type==="text"?t.content.parts:[],o=i.pop(),u=i.length;return s&&o&&i.length>0?{thinking:s,complete:o,generating:i.reduce((r,h,m)=>{const f=(m+1)/u;return r[f.toFixed(2)]=h,r},{})}:void 0}function _e(e){const t=e.filter(o=>o.author.role==="tool"&&o.author.name===$&&o.content.content_type===z.MultimodalText),s=t.flatMap(o=>Re.getImageAssetPointers(o)),i=t.map(o=>o.id);return{imageAssetPointers:s,messageIds:i}}const vt=(e,t)=>{const s=e.find(l=>l.author.role===Ge.Tool&&[z.Error,z.SystemError].includes(l.content.content_type)||l.metadata?.is_error),{imageAssetPointers:i}=_e(e),o=e.some(l=>{const x=l.author.name===$,y=l.content.content_type===z.MultimodalText,M=!!l.metadata?.is_visually_hidden_from_conversation;return x&&y&&M}),u=e.some(l=>{if(l.metadata?.image_gen_async)return!1;const x=l.author.name===Z.IMAGE_GEN_HALLUCINATED||l.author.name===$,y=l.content.content_type===z.Text,M=!!l.metadata?.is_visually_hidden_from_conversation;return x&&y&&M}),r=e.length>0&&!!e[e.length-1]?.metadata?.image_gen_async,m=!e.some(l=>[$,Z.IMAGE_GEN_HALLUCINATED].includes(l.author.name??"")&&l.content.content_type===z.MultimodalText)&&e.some(l=>{const x=[$,Z.IMAGE_GEN_HALLUCINATED].includes(l.author.name??""),y=l.recipient==="assistant";return x&&y});let f=0;for(const l of i){const x=l.height,y=l.metadata?.generation?.height??void 0;f+=x!==void 0&&y!==void 0?y/x:0}const d=i.length>0?f/i.length:0,c=s!==void 0,p=t?b.AsyncGenerating:b.AsyncHanging;if(o||u||m)return b.Empty;if(c)return b.Errored;if(d){if(d<1)return r?p:b.Generating;if(d===1)return b.Complete}else return r?p:b.Thinking;return b.Unavailable},_t=e=>{const t=U(),{size:s="image",count:i=1}=e||{};return i>1?{thinking:t.formatMessage({id:"cdnmKo",defaultMessage:"Getting started"}),generating:{"0.33":t.formatMessage({id:"aTbInH",defaultMessage:"Creating images. May take a moment."}),"0.67":t.formatMessage({id:"WRM3Yw",defaultMessage:"Creating images. May take a moment."}),"1.00":t.formatMessage({id:"8ZydRG",defaultMessage:"Creating images. May take a moment."})},complete:t.formatMessage({id:"XQ81dl",defaultMessage:"Images created"})}:s==="xlimage"?{thinking:t.formatMessage({id:"y7op2E",defaultMessage:"Getting started"}),generating:{"0.33":t.formatMessage({id:"cdrDJH",defaultMessage:"Creating image. May take a moment."}),"0.67":t.formatMessage({id:"RP4bRn",defaultMessage:"Adding details"}),"1.00":t.formatMessage({id:"o36MSQ",defaultMessage:"Finishing touches"})},complete:t.formatMessage({id:"QsnnBN",defaultMessage:"Image created"})}:{thinking:t.formatMessage({id:"6c7+kN",defaultMessage:"Getting started"}),generating:{"0.33":t.formatMessage({id:"DP6/8y",defaultMessage:"Creating image"}),"0.67":t.formatMessage({id:"k9y1TT",defaultMessage:"Creating image"}),"1.00":t.formatMessage({id:"GpR7v3",defaultMessage:"Creating image"})},complete:t.formatMessage({id:"l2Izz4",defaultMessage:"Image created"})}},wt=De(async()=>Pe(()=>import("./jn0qh9qt9c24rvds.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28])).then(e=>e.ImageGenNewEditor)),It=[b.Empty,b.Errored],Ft=({messages:e,clientThreadId:t,isLastTurnInConversation:s,disableClickThru:i=!1})=>{const o=Ne(t),u=U(),r=u.formatMessage({id:"imagegen.message.altLabel",defaultMessage:"Generated image"}),[h,m]=n.useState(!1),[f,d]=n.useState(null),{messageIds:c,imageAssetPointers:p}=n.useMemo(()=>_e(e),[e]),l=p?.[0]?.metadata?.generation?.gen_size,x=_t({size:l??"image",count:p?.length??1}),y=n.useMemo(()=>yt(e)??x,[e,x]),M=e.find(C=>C.metadata?.image_gen_async),g=n.useMemo(()=>vt(e,s),[e,s]),G=n.useRef(!1),N=n.useRef(!1),P=n.useRef(null),v=n.useMemo(()=>xe({pointer:p[0],conversationId:o,messageId:c[0],source:i?"paragen":"chat"}),[p,c,o,i]);n.useEffect(()=>{if(!G.current&&(g===b.Thinking||g===b.Generating))G.current=!0,P.current=performance.now();else if(G.current&&!N.current)if(g===b.Complete){const C=P.current?performance.now()-P.current:void 0;D.generationSuccess({analyticsContext:v,durationMs:C}),N.current=!0}else g===b.Errored&&(D.generationFailure({analyticsContext:v,errorReason:"assistant_error"}),N.current=!0)},[g,v]);const w=e[e.length-1],E=n.useMemo(()=>w&&Ae(w),[w]),{value:A}=ue("3058498100"),S=n.useMemo(()=>A?p:p.slice(0,1),[A,p]),I=S.length>1,R=ze({clientThreadId:t})&&g===b.Complete,[F,j]=n.useState(0),[O,V]=n.useState(null),H=n.useCallback(({image:C,messageId:Y,analyticsContext:K})=>{d(C),V(Y),m(!0),D.editorClick({sourceOperation:C.metadata?.dalle?.edit_op??"none",analyticsContext:K})},[]);return It.includes(g)?null:a.jsxs(ge.Provider,{value:i,children:[a.jsxs("div",{className:"flex flex-col",children:[g!==b.Unavailable&&g!==b.AsyncGenerating&&g!==b.AsyncHanging&&a.jsx("div",{className:"pb-3",children:a.jsx(dt,{cotMessages:y,visualPercentComplete:F,isInterrupted:E,state:g})}),g===b.Thinking&&!E&&a.jsx(be,{isDimensionsUnknown:!0,children:a.jsx(Me,{withLottie:!0})}),g===b.AsyncGenerating&&!M?.metadata?.is_visually_hidden_from_conversation&&a.jsx(lt,{shimmer:!0,title:M?.metadata?.ui_card_title,description:M?.metadata?.ui_card_description}),(g===b.Generating||g===b.Complete)&&!E&&a.jsx("div",{className:L("grid pb-2",{"grid-cols-2 gap-2":I,"grid-cols-1":!I}),children:I?a.jsx(Mt,{pointersToRender:S,altLabel:r,isEditorAvailable:R,updatePercentageRendered:j,messageIds:c,clientThreadId:t,serverThreadId:o,handleEditorClick:H}):a.jsx(ve,{pointer:S[0],altLabel:r,isEditorAvailable:R,onPercentageRendered:j,messageId:c[0],clientThreadId:t,serverThreadId:o,onEditorClick:H})})]}),a.jsx(Te,{testId:"modal-image-gen-content",type:"success",size:"fullscreen",isOpen:h,onClose:()=>m(!1),title:u.formatMessage({id:"imagegen.message.contentModalTitle",defaultMessage:"Edit image"}),visuallyHiddenHeader:!0,className:"dark:bg-(--gray-800)",children:f&&a.jsx(wt,{image:f,isLoadingNewImage:!1,clientThreadId:t,onClose:()=>m(!1),messageId:O??""})})]})};export{Ft as ImageGenMessage};
//# sourceMappingURL=jrl8yxrvh2who49a.js.map
