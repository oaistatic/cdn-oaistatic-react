import{c4 as M,c5 as C,g as I,B as k,s as W,b1 as B,c as O,W as D,eo as q}from"./n9zp7vm10xoipejo.js";import{f as E,r as u,j as e,M as x,o as z,d as V,a9 as Y}from"./lip667d8t42poxum.js";import{c6 as P,I as H,S as _,db as G,an as X,L as U,f as K,dE as Q}from"./l4oo5ijw01fyrjzs.js";import{g as y}from"./iguubsmy82ykz2l9.js";import{h as Z,A as J}from"./cr6qy90q6ci3j3kc.js";import{F as $}from"./dgaabmwb6kfq92a0.js";import{R as ee}from"./kpbk6w80ptlqj4v4.js";import{C as F}from"./lctpawncriaqsrtc.js";import{u as te}from"./iivro419s58km0s3.js";import{h as ne,j as L,c as S,W as se}from"./ojvadmnty96xvqkr.js";import{u as ae}from"./g2w1djl0igdytz37.js";import{I as oe}from"./ex0w8u6azfclal10.js";import{T as ie}from"./gssjqrozvzmyjg6o.js";import{W as re}from"./bja6mzdohoajlk46.js";import"./n7emuv1efbtdnxb9.js";import"./ef49rx2y546x1g51.js";import"./n4y4yo9zuw99bnsn.js";import"./cbaql59zac1mfnmh.js";import"./op1xowyjquc2dnq7.js";import"./nmzcjggnos81a3wt.js";import"./ezoyp421dng92ve4.js";import"./krf7zg7fy4qqowqq.js";import"./j385t288u9l3nf6j.js";import"./oour34cwuwf9tyoh.js";import"./czpmep8a1gn2yxp9.js";import"./g1x7jf9g2b4osi6b.js";import"./kdkl0k5zipatley9.js";import"./fw89hpm6ehbsygz7.js";import"./oe646f7iouawgq3e.js";import"./ls58p44u0ovqzhvw.js";function le({handleGoBack:n,handleSelectEnvironment:s,goToDataCheckPage:a,lockPageView:r}){const o=E();return u.useEffect(()=>{M.count(C.CODEX,"onboarding.environments.view")},[]),e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsx(F,{title:o.formatMessage({id:"wham.codexOnboardingEnvironments.createYourFirstEnvironment",defaultMessage:"Create your starting environment"}),description:o.formatMessage({id:"wham.codexOnboardingEnvironments.createYourFirstEnvironment.description",defaultMessage:"Pick a repo to set up the basics. You can customize your environment later."})}),e.jsx(A,{handleGoBack:n,handleSelectEnvironment:s,goToDataCheckPage:a,lockPageView:r})]})}function A({handleGoBack:n,handleSelectEnvironment:s,goToDataCheckPage:a,lockPageView:r,shouldDisableRow:o,disablePill:f}){const m=E(),g=I(),[d,h]=u.useState(""),[w,c]=u.useState(null),{mutate:v,isPending:l}=te({onSuccess:i=>{M.count(C.CODEX,"onboarding.environments.create_success"),s(i.id,y(i)),a()}}),{data:p,isLoading:t}=ne(),b=ae({defaultValues:{repositoryId:""},validators:{onSubmit:({value:i})=>{const N={};return(!i.repositoryId||i.repositoryId==="")&&(N.repositoryId=m.formatMessage({id:"wham.codexOnboardingEnvironments.repositoryIsRequired",defaultMessage:"Repository is required"})),{fields:N}}},onSubmit:({value:i})=>{M.count(C.CODEX,"onboarding.environments.submit"),r(),v({...i,label:d,description:"",machine:"wham-public/wham-universal",workspaceDirectory:"/workspace",share_settings:"workspace",setupCommands:"",envVars:[],secrets:[]})}}),R=i=>{i.preventDefault(),i.stopPropagation(),b.handleSubmit()};return u.useEffect(()=>{t||p?.installations.length===0&&Z()},[t,p,g]),e.jsx("form",{onSubmit:R,className:"flex flex-col gap-6",children:e.jsxs("div",{className:"flex w-full flex-col gap-4",children:[e.jsx(J,{selectedInstallationId:w,setSelectedInstallationId:c}),e.jsx(b.Field,{name:"repositoryId",children:i=>e.jsxs("div",{className:"flex w-full flex-col gap-4",children:[e.jsx(ee,{installationId:w,selectedRepository:i.state.value,onSelect:(N,T)=>{i.handleChange(N),h(T)},shouldDisableRow:o,disablePill:f}),e.jsx($,{field:i})]})}),e.jsx("div",{className:"pb-2",children:e.jsxs("div",{className:"bg-token-bg-tertiary text-token-text-secondary flex w-full items-center justify-between rounded-xl px-5 py-4 text-sm",children:[e.jsx("div",{className:"relative h-4 w-4 pe-8",children:e.jsx(P,{className:"icon-md"})}),e.jsx("div",{className:"w-full justify-start",children:e.jsx(x,{id:"wham.codexOnboardingEnvironments.createEnvironment.description",defaultMessage:"We’ll create a <b>basic environment</b> for your repo. To enable Codex to run linters and tests, install the required dependencies in environment settings.",values:{b:i=>e.jsx("span",{className:"font-semibold",children:i})}})})]})}),e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx(k,{color:"secondary",size:"medium",type:"button",onClick:n,children:e.jsx(x,{id:"wham.codexOnboardingEnvironments.back",defaultMessage:"Back"})}),e.jsx(k,{color:"primary",size:"medium",loading:l,disabled:!d,onClick:()=>b.handleSubmit(),children:e.jsx(x,{id:"wham.codexOnboardingEnvironments.createEnvironment",defaultMessage:"Create environment"})})]})]})})}function ce({selectedTab:n,onChange:s}){const a=E(),r=I(),o=W(r,"2665240312"),f=u.useCallback(m=>{s(m)},[s]);return e.jsx("div",{className:"border-token-border-primary flex w-full items-center border-b align-middle",children:o&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(ie,{currentTab:n,onChange:f,withUnderline:!0,tabs:[{label:a.formatMessage({id:"wham.selectEnvironmentHeader.create",defaultMessage:"Existing environments"}),key:"select"},{label:a.formatMessage({id:"wham.selectEnvironmentHeader.select",defaultMessage:"New environment"}),key:"create"}]})})})}function de({environment:n,isSelected:s,className:a}){return e.jsxs("div",{className:O("flex items-center justify-between gap-2",a),children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-token-text-primary text-start text-sm font-medium",children:n.label}),n.creator.email&&e.jsx("p",{className:"text-token-text-tertiary text-start text-xs leading-tight font-normal",children:e.jsx(x,{id:"wham.createEnvironments.environmentSection.createdBy",defaultMessage:"{email}",values:{email:n.creator.name}})})]}),e.jsx("div",{className:"text-token-text-secondary text-start text-sm leading-tight font-normal",children:n.description})]}),s?e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(K,{className:"h-5 w-5"})}):e.jsx("div",{className:"w-4"})]})}function me({environment:n,isSelected:s,onClick:a}){return e.jsx("button",{className:O("group flex w-full items-center justify-between gap-2 py-4","hover:bg-token-bg-tertiary cursor-pointer p-2"),onClick:a,type:"button",children:e.jsx(de,{environment:n,isSelected:s,className:"w-full"})})}function j(){return e.jsx("div",{className:"flex w-full items-center justify-between gap-2 rounded-md",children:e.jsx(U,{className:"h-14 w-full"})})}const xe=10;function ue({handleGoBack:n,handleSelectEnvironment:s,goToDataCheckPage:a}){const r=E(),[o,f]=u.useState(""),{data:m,isLoading:g,fetchNextPage:d,hasNextPage:h,isFetchingNextPage:w}=z({queryKey:["wham","environments","with-creators"],initialPageParam:null,queryFn:({pageParam:t})=>se.getEnvironmentWithCreators(xe,t),getNextPageParam:t=>t.cursor??null}),c=u.useMemo(()=>m?.pages.flatMap(t=>t.items??[])??[],[m]),v=c.filter(t=>t.label.toLowerCase().includes(o.toLowerCase())),l=S(t=>t.environmentId),p=S(t=>t.setEnvironmentId);return u.useEffect(()=>{if(l){const t=c.find(b=>b.id===l);t?s(t.id,y(t)):p(null)}else c.length===1&&(p(c[0].id),s(c[0].id,y(c[0])))},[l,c,s,p]),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex justify-between",children:e.jsx(H,{color:"search",iconPosition:"left",icon:_,className:"text-token-text-tertiary flex h-10 w-full items-center rounded-lg! p-3!",inputClassName:"text-token-text-primary w-full",containerInputClassName:"w-full",name:"search-envs",type:"text",value:o,onChange:t=>f(t.target.value),placeholder:r.formatMessage({id:"wham.environmentSection.searchPlaceholder",defaultMessage:"Search"}),ariaLabel:r.formatMessage({id:"wham.environmentSection.searchAria",defaultMessage:"Search"})})}),e.jsx("div",{className:"border-token-border-heavy flex flex-col gap-2 rounded-lg border p-2",children:e.jsx("div",{className:"flex h-96 flex-col overflow-y-auto",children:g?e.jsxs("div",{className:"flex h-full flex-col gap-2",children:[e.jsx(j,{}),e.jsx(j,{}),e.jsx(j,{}),e.jsx(j,{}),e.jsx(j,{}),e.jsx(j,{}),e.jsx(j,{})]}):e.jsxs(e.Fragment,{children:[v.length===0&&!h?e.jsxs("div",{className:"flex h-full flex-col items-center justify-center",children:[e.jsx("p",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(x,{id:"wham.codexOnboardingEnvironments.noEnvironments",defaultMessage:"No environments found"})}),e.jsx("p",{className:"text-token-text-secondary text-xs",children:e.jsx(x,{id:"wham.codexOnboardingEnvironments.noEnvironmentsDescription",defaultMessage:"You will be able to create more environments in settings later"})})]}):v.map((t,b)=>e.jsxs("div",{children:[e.jsx(me,{environment:t,isSelected:l===t.id,onClick:()=>s(t.id,y(t))}),b!==v.length-1&&e.jsx("div",{className:"border-token-border-light border-t"})]},t.id)),e.jsx(oe,{isFetchingNextPage:w,hasNextPage:h??!1,fetchNextPage:d,bgColor:"dark:bg-token-bg-secondary"})]})})}),e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx(k,{color:"secondary",size:"medium",type:"button",onClick:n,children:e.jsx(x,{id:"wham.codexOnboardingEnvironments.back",defaultMessage:"Back"})}),e.jsx(k,{color:"primary",size:"medium",disabled:!l,onClick:a,children:e.jsx(x,{id:"wham.codexOnboardingEnvironments.useEnvironment",defaultMessage:"Use environment"})})]})]})}function fe(){const n=E(),s=G(),o=B()?.name??n.formatMessage({id:"wham.codexOnboardingEnvironments.workspaceName",defaultMessage:"Workspace"});return e.jsx(X,{label:n.formatMessage({id:"wham.codexOnboardingEnvironments.environmentExistsTooltip",defaultMessage:"An environment has already been created for {workspaceName}. You’ll be able to create a new environment later for this repo in settings."},{workspaceName:o}),children:e.jsxs("div",{className:"bg-token-bg-tertiary text-token-text-tertiary inline-flex items-center justify-center gap-1 rounded-3xl py-1.5 ps-1.5 pe-1.5",children:[e.jsx(P,{className:"icon-sm"}),!s&&e.jsx("div",{className:"justify-start pe-1 text-xs leading-3 font-medium",children:e.jsx(x,{id:"wham.codexOnboardingEnvironments.environmentExists",defaultMessage:"Environment already exists"})})]})})}function ge({handleGoBack:n,handleSelectEnvironment:s,goToDataCheckPage:a}){const r=E(),[o,f]=u.useState("select"),{data:m}=L(),g=d=>m?.some(h=>h.repos.includes(d.id))??!1;return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(F,{title:r.formatMessage({id:"wham.codexOnboardingEnvironments.selectEnvironment",defaultMessage:"Select an environment"}),description:r.formatMessage({id:"wham.codexOnboardingEnvironments.selectEnvironment.description",defaultMessage:"Environments configure the container for the agent to run. Not seeing your repo? You can create new environments in settings later."})}),e.jsx("div",{className:"pb-4",children:e.jsx(ce,{selectedTab:o,onChange:d=>{f(d)}})}),o==="select"?e.jsx(ue,{handleGoBack:n,handleSelectEnvironment:s,goToDataCheckPage:a}):e.jsx(A,{lockPageView:()=>{},handleGoBack:n,handleSelectEnvironment:s,goToDataCheckPage:a,shouldDisableRow:g,disablePill:e.jsx(fe,{})})]})}function he(){return e.jsx("div",{className:"mx-auto flex h-full max-w-4xl flex-col p-8 md:p-24",children:e.jsxs("div",{className:"flex h-full w-full flex-col items-center justify-center gap-2",children:[e.jsx(x,{id:"wham.codexOnboardingEnvironments.loading",defaultMessage:"Almost there…"}),e.jsx(D,{})]})})}function pe(){const{eligible:n,isLoading:s}=Q(),{data:a,isLoading:r}=L({retry:3}),o=V(),[f,m]=u.useState(!1),g=()=>{o("/codex/onboarding/connections")},d=()=>{o("/codex/onboarding/data-check")},h=S(l=>l.setEnvironmentId),w=S(l=>l.setBranch),c=(l,p)=>{h(l),w(p)};if(s||r)return e.jsx(he,{});if(!n)return e.jsx(Y,{to:"/codex"});const v=!f&&a&&a.length>0&&!0;return e.jsx(re,{showSidebar:!1,canShowAlert:!1,hideExtraHeaderInfo:!0,children:e.jsx("div",{className:"mx-auto flex max-w-3xl flex-col gap-2 p-12",children:v?e.jsx(ge,{handleGoBack:g,handleSelectEnvironment:c,goToDataCheckPage:d}):e.jsx(le,{handleGoBack:g,handleSelectEnvironment:c,goToDataCheckPage:d,lockPageView:()=>m(!0)})})})}const Ue=()=>[{title:"Codex"}],Ke=q(function(){return e.jsx(pe,{})});export{Ke as default,Ue as meta};
//# sourceMappingURL=hyjspigl6gcp8k3d.js.map
