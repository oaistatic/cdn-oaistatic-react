import{r as c,j as t,ak as pt,al as $t,am as gt,an as Jt,ao as ht,a5 as _,f as Nt,g as St,a6 as z,M as qt}from"./lip667d8t42poxum.js";import{c as Kt,a as Qt,s as te,g as ee,b as oe,d as se,P as tt,T as bt}from"./exyssizzsubb13g9.js";import{b7 as ne,ec as ae,c as B,u as re,y as It,at as ie,gV as at,aC as le}from"./n9zp7vm10xoipejo.js";import{b as ce,S as de,g as ue,u as yt,D as me,c as fe}from"./l93ryxq3tn95q8jd.js";import{b as pe,T as ge,a as he,c as L,A as xt,u as be,i as xe,C as Ee,g as Et}from"./jabowwh76eo1vv7l.js";import{c as Te}from"./ih9k1uv73hv8ykht.js";import{u as Ce,M as ve,e as Ae,h as Tt,i as Re,C as et}from"./18qxc8hgbxoxyv64.js";import{f as it,g as we,h as Pt,d as X}from"./knkf8s9jgm6dk4eu.js";import{T as Ct,Z as Oe,C as Me}from"./jy1u8exw8iz2slve.js";import{jw as jt,jv as _t,jF as w,lN as Ne,pM as Se,g as Ie,jG as j,hC as ye,mf as Pe,mg as je,db as _e,jx as ke}from"./l4oo5ijw01fyrjzs.js";import{u as vt}from"./m8nue0mm3lfcgljv.js";import{t as Le,B as Be,I as He}from"./hbuxagy9dax2b5vs.js";import{H as De,P as Ve}from"./bl5o9qxisdgzsskx.js";import{s as kt,T as We}from"./krf7zg7fy4qqowqq.js";import"./es0z9v8doc0hgjd4.js";import"./ezoyp421dng92ve4.js";import"./d5srgqurg48kxugz.js";import"./j8vdq5u0dah3tad5.js";import"./eef33l65z4kyipsv.js";import"./ju8q15l0hqy6ti9z.js";import"./ef49rx2y546x1g51.js";import"./joi56n2i6g6stgfp.js";import"./gy64pge8qevmvg7e.js";import"./d7qhj0hizrl5q10d.js";import"./bk8slwxjkdlmxjxm.js";import"./h6u5tn9ugd2tunyc.js";import"./pb0xfopp3f7joxj4.js";import"./n4y4yo9zuw99bnsn.js";import"./cbaql59zac1mfnmh.js";import"./op1xowyjquc2dnq7.js";import"./nmzcjggnos81a3wt.js";import"./oour34cwuwf9tyoh.js";import"./czpmep8a1gn2yxp9.js";import"./g1x7jf9g2b4osi6b.js";import"./kdkl0k5zipatley9.js";import"./gydkbc6xtfcf9567.js";import"./fcb0ae0r80625132.js";import"./kweqtgafphozzl00.js";import"./bir4gwnbq17hkvt3.js";import"./fgib8os5mzfls06e.js";import"./j385t288u9l3nf6j.js";function Fe(e,o){c.useEffect(()=>{const n=e?.current;if(n!=null)return ne(n,{mousedown:d=>{o.current?.maybeFocusOnEditor(d)===!0&&d.preventDefault()}})},[o,e])}const Ge=({wrapperClassName:e,value:o="",width:n,comments:d,paddingBottom:h})=>{const l=c.useRef(null),a=c.useRef(null),r=ae();return c.useEffect(()=>{const{current:p}=l;if(p)return a.current=Kt({mount:p,comments:d,value:o,isDarkMode:r}),()=>{a.current?.destroy()}},[]),c.useEffect(()=>{const p=Qt(o,d);a.current?.updateState(p)},[o,d]),t.jsx("div",{className:e,children:t.jsx("div",{ref:jt(l),className:B(te.main,"markdown prose dark:prose-invert focus:outline-hidden"),style:{width:n,paddingBottom:h}})})},Lt=e=>!e||"docView"in e&&e.docView==null||pe(e.state.doc),ot=100,Xe={type:"spring",duration:1.5,bounce:.1},ze={type:"spring",duration:.5,bounce:0},At={type:"spring",duration:.2},Rt={type:"spring",duration:1,delay:.1},Ue={type:"spring",duration:1},Ze={type:"spring",duration:.5,bounce:0},Ye=({isRewriting:e=!1,value:o,previousValue:n,previousComments:d,documentWidth:h,paddingBottom:l,onStart:a})=>{const r=it(),p=pt(0),u=pt(-100),T=c.useRef(!1),[m,b]=$t(),[{height:v},i]=_t(),x=Ce();re(()=>{const s=r();return s&&(s.dom.style.clipPath="inset(0 0 100% 0)"),()=>{const f=r();f&&(f.dom.style.clipPath="")}},[]),c.useEffect(()=>{const s=r();if(!s||Lt(s))return m?void 0:b?.();try{const f=we(s.state.doc)?.end;if(f==null||f>o.length)return;const{top:C}=s.coordsAtPos(0),{top:R,bottom:O}=s.coordsAtPos(Math.max(s.state.doc.content.size-1,0),-1),A=O-C,M=R-C;if(p.set(A-M),!m){gt(u,A+2*p.get(),ze).then(()=>b?.());return}gt(u,A,Xe)}catch(f){w.logError("Failed to set rewrite animation position",f),b?.()}},[m,o]);const g=Jt(u,s=>Ne(s)-ot+2);return ht(u,"change",s=>{const f=r();!f||!s||!T.current||(f.dom.style.clipPath=`inset(0 0 calc(100% - ${s}px) 0)`)}),ht(u,"animationStart",()=>{e&&a?.()}),t.jsxs(t.Fragment,{children:[x&&t.jsx(_.div,{style:{visibility:"hidden",pointerEvents:"none",height:v},initial:!1,exit:{height:0},transition:{delay:.1,duration:.8,ease:"easeOut"}}),t.jsx(_.div,{className:"from-token-main-surface-primary absolute top-0 z-10 w-full origin-bottom bg-linear-to-t from-10% to-transparent",style:{translateY:g,height:ot},initial:{opacity:0},animate:{opacity:1,transition:At},exit:{opacity:0,transition:Rt},onAnimationComplete:()=>T.current=!0},"wash-top"),t.jsx(_.div,{className:"from-token-main-surface-primary absolute top-0 z-10 w-full bg-linear-to-b to-transparent",style:{translateY:u,height:ot},initial:{opacity:0},animate:{opacity:1,transition:At},exit:{opacity:0,transition:Rt}},"wash-bottom"),t.jsx(_.div,{ref:i,className:"pointer-events-none absolute z-0 max-w-full min-w-0",initial:{opacity:1},animate:{opacity:.3,transition:Ue},exit:{opacity:0,transition:Ze},children:t.jsx(Ge,{value:n,width:h,comments:d,wrapperClassName:"h-fit flex",paddingBottom:l})},"previousValue")]})},$e=e=>c.createElement("svg",{width:16,height:17,viewBox:"0 0 16 17",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},c.createElement("path",{d:"M5.11619 13.8334C4.41395 13.8334 4 13.4047 4 12.6655V4.32729C4 3.59548 4.41395 3.16675 5.11619 3.16675H8.64218C10.6454 3.16675 11.9021 4.19424 11.9021 5.82787C11.9021 6.99581 11.0298 7.97155 9.89882 8.14157V8.20071C11.3477 8.31158 12.4121 9.36864 12.4121 10.7805C12.4121 12.6581 11.0002 13.8334 8.72349 13.8334H5.11619ZM6.23239 7.60195H7.83645C9.02657 7.60195 9.70663 7.07712 9.70663 6.1753C9.70663 5.31782 9.10788 4.82995 8.0656 4.82995H6.23239V7.60195ZM6.23239 12.1702H8.15431C9.44052 12.1702 10.1354 11.6232 10.1354 10.6031C10.1354 9.60519 9.41834 9.07296 8.10256 9.07296H6.23239V12.1702Z",fill:"currentColor"})),Je=e=>c.createElement("svg",{width:16,height:17,viewBox:"0 0 16 17",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},c.createElement("path",{d:"M9.94587 13.3511C9.89814 13.6297 9.6566 13.8334 9.37393 13.8334H4.95078C4.59259 13.8334 4.31994 13.5121 4.37824 13.1587C4.42447 12.8785 4.66675 12.6729 4.95077 12.6729H6.60855L8.09599 4.32729H6.62967C6.27148 4.32729 5.99883 4.00598 6.05714 3.65257C6.10337 3.37234 6.34565 3.16675 6.62967 3.16675H11.054C11.4108 3.16675 11.683 3.4856 11.6271 3.83793C11.5824 4.11979 11.3394 4.32729 11.054 4.32729H9.39198L7.90454 12.6729H9.37393C9.73357 12.6729 10.0066 12.9967 9.94587 13.3511Z",fill:"currentColor"}));function wt(e,o){if(e==null)return!1;const n=e.state.schema.marks[o];return n==null?!1:Le(e.state,e.dispatch,n)}function st(e,o){if(e==null)return!1;const{state:n,dispatch:d}=e,h=It(n.schema.nodes[De.proseMirrorNodeName()]);return kt(h,{level:o})(n,d)}function qe(e){if(e==null)return!1;const{state:o,dispatch:n}=e,d=It(o.schema.nodes[Ve.proseMirrorNodeName()]);return kt(d)(o,n)}const Ke=({availableWidth:e,onAddComment:o,isSendDisabled:n=!1,isWaitingForCommentResponse:d=!1,onSubmitAccelerator:h})=>{const l=Nt(),a=it(),r=Pt(),p=Se(),u=c.useCallback(i=>{const{width:x,height:g}=i,s=a();if(!r||!s||Lt(s))return null;const{to:f,empty:C,head:R}=r.selection,{platform:O}=Ie(),A=O==="web"?R:f,M=A===f;if(C||!vt(s.state.doc,A))return null;const{right:U,left:N,top:k}=s.coordsAtPos(0);let I=A,V=s.state.doc.nodeAt(I);const W=M?-1:1;for(;!V?.isText&&vt(s.state.doc,I+W);)I+=W,V=s.state.doc.nodeAt(I);const{left:F,bottom:H,top:Z}=s.coordsAtPos(I,M?-1:1),G=U-N;function Y(){if(M)return Math.max(F-N-x,0);let P=F-N;return P+x>G&&(P=-(x-G)),P}function y(){const P=window.innerHeight-H>g*2;return M&&P?{top:H-k+8,aboveOrBelow:xt.BELOW}:{top:Z-k-g-8,aboveOrBelow:xt.ABOVE}}const D=y();return{left:Y(),top:D.top,aboveOrBelow:D.aboveOrBelow,toolbarSize:i}},[r,a]),T=c.useCallback(()=>a()?.dom??null,[a]),m=[{label:l.formatMessage(S.heading1),className:"text-5xl font-semibold",onClick:()=>{w.logButtonClick(j.TOOLBAR_FORMAT_HEADER1),st(a(),1)}},{label:l.formatMessage(S.heading2),className:"text-3xl font-semibold",onClick:()=>{w.logButtonClick(j.TOOLBAR_FORMAT_HEADER2),st(a(),2)}},{label:l.formatMessage(S.heading3),className:"text-2xl font-semibold",onClick:()=>{w.logButtonClick(j.TOOLBAR_FORMAT_HEADER3),st(a(),3)}},{label:l.formatMessage(S.body),className:"text-base",onClick:()=>{w.logButtonClick(j.TOOLBAR_FORMAT_PARAGRAPH),qe(a())}}],b=()=>{const i=a();if(!i)return null;const{state:x}=i,{from:g,to:s,sourceFrom:f,sourceTo:C}=ue(x);return g==null||s==null||f==null||C==null?(w.logError("Prosemirror getSelectionRange has null values",null,{from:g,to:s,sourceFrom:f,sourceTo:C}),null):{from:g,to:s,sourceFrom:f,sourceTo:C}},v=(i,x,g)=>{const s=a(),f=b();if(f==null)return;const{sourceFrom:C,sourceTo:R}=f,O={start:C,end:R};if(r&&s){const A=r.tr.setSelection(We.create(r.doc,r.selection.anchor));s.dispatch(A)}w.logButtonClick(j.TOOLBAR_FORMAT_STYLE,{action:{action:g.action,id:g.id,title:g.title},prompt:x,sourceFrom:C,sourceTo:R}),h?.(i,O,l.formatMessage(x),g)};return t.jsxs(ge,{isWaitingForCommentResponse:d,isSendDisabled:n,onAddComment:o,toolbarType:he.WRITING,getToolbarPosition:u,getEditorDom:T,getSelectionRange:b,children:[p&&t.jsxs(t.Fragment,{children:[t.jsx(L.Separator,{}),t.jsx(L.Popover,{label:l.formatMessage(S.format),hideLabel:e<=400,icon:ye,align:"center",children:t.jsx("div",{className:B("border-token-border-default bg-token-main-surface-primary flex w-48 flex-col items-stretch rounded-xl border p-1",Ct),children:ce.map(i=>{const{title:x,icon:g}=i;return t.jsxs("button",{onClick:s=>{"prompt"in i&&v(s,i.prompt,i)},className:"bg-token-main-surface-primary dark:hover:bg-token-main-surface-secondary flex flex-row items-center gap-x-2 rounded-md p-3 hover:bg-[#f5f5f5]",children:[t.jsx("div",{className:"flex",children:t.jsx(g,{className:"icon-md"})}),t.jsx("div",{className:"line-clamp-1 flex-auto text-start text-sm",children:l.formatMessage(x)})]},i.id)})})})]}),t.jsx(L.Separator,{}),t.jsx(L.Action,{label:l.formatMessage(S.bold),hideLabel:!0,icon:$e,onClick:()=>{w.logButtonClick(j.TOOLBAR_FORMAT_BOLD),wt(a(),Be.proseMirrorMarkName())},onMouseDown:i=>i.preventDefault()}),t.jsx(L.Action,{label:l.formatMessage(S.italic),hideLabel:!0,icon:Je,onClick:()=>{w.logButtonClick(j.TOOLBAR_FORMAT_ITALIC),wt(a(),He.proseMirrorMarkName())},onMouseDown:i=>i.preventDefault()}),t.jsx(L.Popover,{label:l.formatMessage(S.format),hideLabel:!0,icon:de,children:t.jsx("div",{className:B("border-token-border-default bg-token-main-surface-primary flex flex-col items-stretch rounded-xl border p-1",Ct),children:m.map(({label:i,className:x,onClick:g})=>t.jsx("button",{onClick:g,className:"hover:bg-token-main-surface-secondary w-full rounded-xl p-4 text-start",children:t.jsx("div",{className:x,children:i})},i))})})]})},S=St({bold:{id:"qqbk91",defaultMessage:"Bold"},italic:{id:"5oh4LV",defaultMessage:"Italic"},format:{id:"z8IGv0",defaultMessage:"Transform"},heading1:{id:"AR5o30",defaultMessage:"Heading 1"},heading2:{id:"zb/wrc",defaultMessage:"Heading 2"},heading3:{id:"xZJvLM",defaultMessage:"Heading 3"},body:{id:"Hi6z3L",defaultMessage:"Body"},caption:{id:"VXpL7v",defaultMessage:"Caption"},bullets:{id:"2vznKX",defaultMessage:"Bullets"},outline:{id:"Xmbt6r",defaultMessage:"Outline"},table:{id:"0UjL6P",defaultMessage:"Table"}});function Ot({position:e,numEdits:o,closestEditId:n}){const d=yt(),h=Nt(),l=e==="top"?Pe:je,a=()=>{const p=d();if(!p||!n)return;const u=ee(p,n);if(u.length===0){ie.addError("Edit could not be found while attempting to scroll",{closestEditId:n});return}u[e==="top"?0:u.length-1].scrollIntoView({behavior:"smooth",block:"center"})},r=e==="top"?-4:4;return t.jsx(z,{children:o>0&&t.jsx(_.div,{className:B("absolute start-1/2 z-20 select-none",{"bottom-[20px]":e==="bottom","top-[20px]":e==="top"}),initial:{scale:.95,translateY:r,translateX:"-50%",opacity:0},animate:{scale:1,translateY:0,translateX:"-50%",opacity:1},exit:{scale:.95,translateY:r,translateX:"-50%",opacity:0},transition:{type:"spring",duration:.3},children:t.jsxs("div",{className:B("flex items-center justify-center rounded-full border px-4 py-2","border-token-main-surface-tertiary bg-token-main-surface-primary hover:bg-token-main-surface-secondary shadow-md"),"aria-label":h.formatMessage(Mt.ariaLabel),role:"button",onClick:a,children:[t.jsx(qt,{...Mt.label,values:{count:o}}),t.jsx(l,{className:"icon-sm ms-2"})]})})})}const Mt=St({label:{id:"Pf30w4",defaultMessage:"{count, plural, one {1 more edit} other {{count} more edits}}"},ariaLabel:{id:"qTJjzl",defaultMessage:"Button to scroll the next edit into view."}});function Qe({diff:e=null}){const o=yt(),[n,d]=c.useState([]),[h,l]=c.useState([]),a=at.useState(at.selectWindowHeight),r=c.useCallback(()=>{const p=o();if(!p||!e)return;const u=[],T=[];for(const m of e.edits){const b=oe(p,m.id);if(b.length>0){const v=se(b);v.bottom<0?u.push([m.id,v]):v.top>a&&T.push([m.id,v])}}u.sort(([,m],[,b])=>m.bottom-b.bottom),T.sort(([,m],[,b])=>m.top-b.top),d(u.map(([m])=>m)),l(T.map(([m])=>m))},[e,a,o]);return be(e?.edits??[],r),c.useEffect(()=>{const p=setTimeout(r,500);return()=>{clearTimeout(p)}},[r]),t.jsxs(t.Fragment,{children:[t.jsx(Ot,{position:"top",numEdits:n.length,closestEditId:n[n.length-1]}),t.jsx(Ot,{position:"bottom",numEdits:h.length,closestEditId:h[0]})]})}const rt=le(()=>({rejectedEdits:new Set,hoveredEditId:null})),{setState:$o}=rt,to=({pos:e})=>{const o=it()(),n=Pt();if(!o||!n||e==null)return null;const{doc:d}=n,{top:h,left:l}=o.coordsAtPos(0),{top:a,left:r}=o.coordsAtPos(e),p=d.nodeAt(e),u=e+(p?.nodeSize??0)-1,{top:T}=o.coordsAtPos(e+1),{top:m,bottom:b,right:v}=o.coordsAtPos(u),x=(T>=m?v:o.dom.getBoundingClientRect().right)-r,g=b-a+4;return t.jsx(_.div,{style:{top:a-h,left:r-l,height:g,width:x},className:B("absolute after:absolute after:inset-x-[-4px] after:inset-y-0 after:z-0 after:rounded-md after:bg-[Highlight] after:content-[''] dark:after:bg-[Highlight]",Oe.blockCommentHover),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0}})},eo=({pos:e})=>t.jsx(z,{children:e!=null&&t.jsx(to,{pos:e})}),oo={type:"spring",bounce:.12,duration:.64},nt=24,so=16,no=0,ao=8,Jo=({comments:e,diff:o,readonlyReason:n,isDisabled:d=!1,isRewriting:h=!1,isAnimatingFromPreview:l=!1,isSendDisabled:a=!1,previousComments:r,previousValue:p,isPreview:u=!1,isRequestActive:T=!1,isWaitingForCommentResponse:m=!1,targetedContent:b=null,onAcceleratorsExpandedChange:v,getAutocompleteSuggestion:i,getStableCommentId:x=ke,onBlur:g,onCancelRequest:s,onChange:f,onSave:C,onAddComment:R,onSubmitAccelerator:O,onAcceptComment:A,onDismissComment:M,onExitShowChanges:U,value:N,commentsMode:k=et.ENABLED,hideAccelerators:I=!1,hideToolbar:V=!1,hideEditOverlay:W=!1,safeUrls:F,width:H,modelCursor:Z,shouldResetSelection:G,metadata:Y})=>{const y=c.useRef(null),D=c.useRef(null);Fe(D,y);const[{width:P},Bt]=_t(),lt=_e(),ct=c.useRef(null),[$,dt]=c.useState(!1),Ht=ct.current,Dt=xe(Ht)??!1,ut=lt?ve:Ae,J=(()=>{if(H==null){const E=Dt?0:Et();return P-E}return H-ut*2-Et()})(),q=J>=Tt+Te?Tt:Re,Vt=J-q,Wt=X(({commentingOn:E})=>E),Ft=X(({hoveredCommentId:E})=>E),Gt=X(({focusedCommentId:E})=>E),Xt=X(({hoveredBlockCommentLauncherPos:E})=>E),zt=rt(E=>E.hoveredEditId),Ut=rt(E=>E.rejectedEdits);c.useEffect(()=>{b==null&&y.current?.revertChanges()},[b]),c.useEffect(()=>{y.current?.flushChanges(),y.current?.UNSAFE_setValue(N)},[N]);const Zt=at.useState(({windowHeight:E})=>{if(lt)return u?no:so;if(u)return nt;const K=ao/100*E;return Math.max(nt,K)}),Yt=({currentTarget:E,nativeEvent:K})=>{const ft=K.composedPath();for(const Q of ft.slice(0,ft.indexOf(E)))if(Q instanceof HTMLElement&&(Q.id===bt.PROSEMIRROR_EDITOR_CONTAINER||Q.id===bt.PROSEMIRROR_CONTEXT_CHILDREN))return;U?.()},mt=u?"1rem":"max(3rem,24vh)";return t.jsx("div",{className:"h-full w-full",ref:D,onClick:Yt,children:t.jsx(_.div,{className:Me.document,style:{margin:`0 ${ut}px`},initial:l?{paddingTop:nt}:!1,animate:{paddingTop:Zt},transition:oo,children:t.jsx("div",{ref:jt(Bt,ct),className:"z-0 flex w-full flex-col items-center",children:t.jsxs(tt,{comments:e,diff:o,editorRef:y,hoveredCommentId:Ft,focusedCommentId:Gt,hoveredEditId:zt,rejectedEdits:Ut,value:h&&!$?"":N,commentingOn:Wt,isDisabled:d||h||$,onBlur:g,onChange:f,onSave:C,width:q,safeUrls:F,wrapperClassName:"relative z-10 flex max-w-full h-fit",paddingBottom:mt,modelCursor:Z,shouldResetSelection:G,transparentBackground:!$,contentRefereces:Y?.contentReferences??[],getAutocompleteSuggestion:i,children:[t.jsxs(tt.EditorChildren,{children:[t.jsx(z,{onExitComplete:()=>dt(!1),children:h&&t.jsx(Ye,{isRewriting:h,documentWidth:q,previousValue:p,previousComments:r,value:N,paddingBottom:mt,onStart:()=>dt(!0)})}),!V&&t.jsx(Ke,{availableWidth:J,isWaitingForCommentResponse:m,isSendDisabled:a,onAddComment:R,onSubmitAccelerator:O}),k===et.ENABLED&&t.jsx(eo,{pos:Xt}),t.jsx(z,{children:k!==et.ALL_HIDDEN&&t.jsx(Ee,{availableWidth:Vt,comments:e,commentsMode:k,isRequestActive:T,onAddComment:R,onAcceptComment:A,onDismissComment:M,isWaitingForCommentResponse:m,disableBlockComments:T,getStableCommentId:x})})]}),t.jsxs(tt.ContextChildren,{children:[!W&&o&&t.jsx(Qe,{diff:o}),!I&&t.jsx(me,{isRequestActive:T,onSubmit:O,isVisuallyHidden:a||!!n?.isStreamingFromNative||n?.isReadonly&&!n.isStreaming,actions:fe,onCancel:s,onExpandedChange:v})]})]})})})})};export{Jo as DocumentComposer};
//# sourceMappingURL=ewf55d4ltuppkyrs.js.map
