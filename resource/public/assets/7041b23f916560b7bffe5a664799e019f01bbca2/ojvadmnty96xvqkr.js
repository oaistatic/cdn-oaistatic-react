import{k as x,o as G,u as m,r as f,j as _,a6 as B,a5 as D}from"./lip667d8t42poxum.js";import{bI as F,aC as A,aH as c,aE as h,aR as M,b as i,gm as k,at as v,cO as T,b6 as w,c as q}from"./n9zp7vm10xoipejo.js";import{mc as I,g0 as S,lC as Q,eS as K,ia as C,iq as b}from"./l4oo5ijw01fyrjzs.js";var y,R;function L(){if(R)return y;R=1;var s=F(),e=I();function t(a,r){return a&&a.length?e(a,s(r,2)):0}return y=t,y}var H=L();const l=x(H);function X(s){const e=E(s?.output_items);return{filesModified:l(e,t=>t.files_modified??0),linesAdded:l(e,t=>t.lines_added??0),linesRemoved:l(e,t=>t.lines_removed??0)}}function E(s){return s?s.map(e=>{switch(e.type){case"output_diff":return e;case"pr":return e.output_diff;default:return null}}).filter(e=>e!=null):[]}const P=A()((s,e)=>({environmentId:c.getItem(h.LastEnvironment),branch:null,manuallyAddedBranches:[],promptDraft:c.getItem(h.PromptDraft)??"",tasksFilter:"current",taskTurnMap:{},showReactQueryDevtools:!1,pendingTaskIds:{},lastViewedTaskId:null,setShowReactQueryDevtools:t=>{c.setItem(h.ReactQueryDevtoolsVisible,t),s({showReactQueryDevtools:t})},setPromptDraft:t=>{c.setItem(h.PromptDraft,t),s({promptDraft:t})},setEnvironmentId:t=>{t==null?c.removeItem(h.LastEnvironment):c.setItem(h.LastEnvironment,t),s({environmentId:t})},setBranch:t=>s({branch:t}),addManuallyAddedBranch:t=>s(a=>a.manuallyAddedBranches.includes(t)?{}:{manuallyAddedBranches:[t,...a.manuallyAddedBranches]}),setTasksFilter:t=>s({tasksFilter:t}),setLastViewedTaskId:t=>s({lastViewedTaskId:t}),addTurnToTaskMap:(t,a)=>{s(r=>{const n=r.taskTurnMap[t],u=n?{...n}:{};return u[a.id]=a,{taskTurnMap:{...r.taskTurnMap,[t]:u}}})},getTurnsForTask:t=>{const a=e().taskTurnMap[t]??[];return Object.values(a).sort((r,n)=>r.created_at-n.created_at)},addPendingTaskId:t=>{const a={...e().pendingTaskIds};a[t]=t,s({pendingTaskIds:a})},removePendingTaskId:t=>{const a={...e().pendingTaskIds};delete a[t],s({pendingTaskIds:a})},removePendingTaskByTaskId:t=>{const a=e().pendingTaskIds,[r]=Object.entries(a).find(([n,u])=>u===t)??[];if(r){const n={...a};delete n[r],s({pendingTaskIds:n})}},assignPendingTaskToFinalTask:(t,a)=>s(r=>({pendingTaskIds:{...r.pendingTaskIds,[t]:a}}))}));function Y(s,e,t,a){switch(s.type){case"repo_not_accessible":a.danger(t.formatMessage({id:"wham.whamComposer.repoNotAccessible",defaultMessage:"Canâ€™t access GitHub repository. Verify your repository access on GitHub, or reconnect your GitHub account in Codex Settings."}),{id:e,duration:10,hasCloseButton:!0});return;case"missing_github_connector_link":a.danger(t.formatMessage({id:"wham.whamComposer.missingGithubConnectorLink",defaultMessage:"No GitHub connection. Please reconnect your GitHub account in Codex Settings."}),{id:e,duration:10,hasCloseButton:!0});return;case"non_terminal_turn":a.danger(t.formatMessage({id:"wham.whamComposer.nonTerminalTurn",defaultMessage:"Task already has a running turn"}),{id:e,duration:10,hasCloseButton:!0});return;case"repo_not_initialized":a.danger(t.formatMessage({id:"wham.whamComposer.repoNotInitialized",defaultMessage:"GitHub Repository must be initialized to be used within Codex"}),{id:e,duration:10,hasCloseButton:!0});return;case"branch_creation_not_allowed":a.danger(t.formatMessage({id:"wham.whamComposer.branchCreationNotAllowed",defaultMessage:"Branch creation unauthorized for this repository. Please check your GitHub permissions."}));return;case"pull_request_not_allowed":a.danger(t.formatMessage({id:"wham.whamComposer.pullRequestNotAllowed",defaultMessage:"Repository does not allow pull requests from Codex. Please check your GitHub permissions."}));return;case"verified_commits_required":a.danger(t.formatMessage({id:"wham.whamComposer.verifiedCommitsRequired",defaultMessage:"Codex does not currently support PRs in repositories that require verified commits"}));return;case"binary_files_not_supported":a.danger(t.formatMessage({id:"wham.whamComposer.binaryFilesNotSupported",defaultMessage:"Binary files are not supported"}),{id:e,duration:10,hasCloseButton:!0});return;default:return null}}class N extends M{type;payload;constructor(e,t,a){super(e.message,t,a),this.type=e.type,this.payload=e}}function U(s){const e=s.detail;if(e&&typeof e.type=="string"&&typeof e.message=="string"){const t={type:e.type,message:e.message};throw new N(t,s.status,{})}throw s}class o{static async _wrapWhamRequest(e){try{return await e()}catch(t){throw t instanceof M&&U(t),t}}static getTasks(e=10,t=null,a="current"){return this._wrapWhamRequest(()=>i.safeGet("/wham/tasks",{parameters:{query:{limit:e,cursor:t,task_filter:a}}}))}static getTasksForList(e=10,t=null,a="current"){return this._wrapWhamRequest(()=>i.safeGet("/wham/tasks/list",{parameters:{query:{limit:e,cursor:t,task_filter:a}}}))}static getTaskDetails(e){return this._wrapWhamRequest(()=>i.safeGet("/wham/tasks/{task_id}",{parameters:{path:{task_id:e}}}))}static getTaskTurnPR(e,t){return this._wrapWhamRequest(()=>i.safeGet("/wham/tasks/{task_id}/turns/{turn_id}/pr",{parameters:{path:{task_id:e,turn_id:t}}}))}static getUserHandle(){return this._wrapWhamRequest(()=>i.safeGet("/wham/task_suggestions/github/user_handle",{}))}static getTaskTurn(e,t){return this._wrapWhamRequest(()=>i.safeGet("/wham/tasks/{task_id}/turns/{turn_id}",{parameters:{path:{task_id:e,turn_id:t}}}))}static getGithubInstallations(){return this._wrapWhamRequest(()=>i.safeGet("/wham/github/installations",{}))}static feedback({thumbRating:e,text:t,taskId:a,turnId:r,shareUrl:n,pullRequestUrl:u,category:d}){return this._wrapWhamRequest(()=>i.safePost("/wham/feedback",{requestBody:{thumb_rating:e,text:t,conversation_id:null,message_id:null,task_id:a,turn_id:r,share_url:n,pull_request_url:u,category:d}}))}static archiveTask(e){return this._wrapWhamRequest(()=>i.safePost("/wham/tasks/{task_id}/archive",{parameters:{path:{task_id:e}}}))}static recoverTask(e){return this._wrapWhamRequest(()=>i.safePost("/wham/tasks/{task_id}/recover",{parameters:{path:{task_id:e}}}))}static createPr(e,t,a,r,n){return this._wrapWhamRequest(()=>i.safePost("/wham/tasks/{task_id}/turns/{task_turn_id}/pr",{parameters:{path:{task_id:e,task_turn_id:t}},requestBody:{mode:a,add_codex_tag:r,hide_pr_title_and_body:n}}))}static getRepositoriesByInstallationId(e,t,a){return this._wrapWhamRequest(()=>i.safeGet("/wham/github/repositories/v2/{installation_id}",{parameters:{path:{installation_id:e},query:{page:t,per_page:a}}}))}static getRepository(e){return this._wrapWhamRequest(()=>i.safeGet("/wham/github/repositories/{repo_id}",{parameters:{path:{repo_id:e}}}))}static searchBranchesByRepository(e,t,a=10,r=null){return this._wrapWhamRequest(()=>i.safeGet("/wham/github/branches/{repo_id}/search",{parameters:{path:{repo_id:e},query:{query:t,page_size:a,cursor:r}}}))}static getEnvironment(e){return this._wrapWhamRequest(()=>i.safeGet("/wham/environments/{environment_id}",{parameters:{path:{environment_id:e}}}))}static getEnvironmentWithCreatorAndMachine(e){return this._wrapWhamRequest(()=>i.safeGet("/wham/environments/{environment_id}/with-creator-and-machine",{parameters:{path:{environment_id:e}}}))}static getEnvironmentWithCreators(e=10,t=null){return this._wrapWhamRequest(()=>i.safeGet("/wham/environments/with-creators",{parameters:{query:{limit:e,cursor:t}}}))}static updateEnvironment(e,t){return this._wrapWhamRequest(()=>i.safePatch("/wham/environments/{environment_id}",{parameters:{path:{environment_id:e}},requestBody:t}))}static deleteEnvironment(e){return this._wrapWhamRequest(()=>i.safeDelete("/wham/environments/{environment_id}",{parameters:{path:{environment_id:e}}}))}static getEnvironments(){return this._wrapWhamRequest(()=>i.safeGet("/wham/environments",{}))}static getMachines(){return this._wrapWhamRequest(()=>i.safeGet("/wham/machines",{}))}static createEnvironment(e){const t=e.envVars.reduce((r,n)=>(r[n.key]=n.value,r),{}),a=e.secrets.reduce((r,n)=>(r[n.key]=n.value,r),{});return this._wrapWhamRequest(()=>i.safePost("/wham/environments",{requestBody:{label:e.label,machine_id:e.machine,repos:[e.repositoryId],description:e.description,setup:e.setupCommands,workspace_dir:e.workspaceDirectory,share_settings:e.share_settings,env_vars:t,secrets:a}}))}static runEnvironmentTestCommand(e){return this._wrapWhamRequest(()=>i.safePost("/wham/environments/test/{test_session_id}/command",{parameters:{path:{test_session_id:e.testSessionId}},requestBody:{command:e.command}}))}static getUserPreferences(){return this._wrapWhamRequest(()=>i.safeGet("/wham/settings/user",{}))}static getUserPreferencesConfig(){return this._wrapWhamRequest(()=>i.safeGet("/wham/settings/configs/user-preferences",{}))}static updateUserPreferences(e){return this._wrapWhamRequest(()=>i.safePatch("/wham/settings/user",{requestBody:{branch_format:e.branchFormat,git_diff_mode:e.diffView,custom_instructions:e.customInstructions}}))}static getTurns(e){return this._wrapWhamRequest(()=>i.safeGet("/wham/tasks/{task_id}/turns",{parameters:{path:{task_id:e}}}))}static getTurnLogs(e,t){return this._wrapWhamRequest(()=>i.safeGet("/wham/tasks/{task_id}/turns/{turn_id}/logs",{parameters:{path:{task_id:e,turn_id:t}}}))}static async createNewTask(e,t,a,r=!1){const n=await k("codex_create_task_turn").catch(d=>{v.addError(d)}),u=T(null,null,null,n);return this._wrapWhamRequest(()=>i.safePost("/wham/tasks",{requestBody:{new_task:{environment_id:e,branch:t,run_environment_in_qa_mode:r},input_items:[{type:"message",role:"user",content:[{content_type:"text",text:a}]}]},additionalHeaders:u}))}static async createNewTaskWithEditedPrompt(e,t,a,r,n=!1){const u=await o.createNewTask(t,a,r,n);return o.archiveTask(e).catch(()=>{}),u}static async createFollowUpTask(e,t,a,r,n=!1){const u=[{type:"message",role:"user",content:[{content_type:"text",text:a}]}];r.forEach(p=>{u.push({type:"comment",position:p.position,content:p.content})});const d=await k("codex_create_task_turn").catch(p=>{v.addError(p)}),g=T(null,null,null,d);return this._wrapWhamRequest(()=>i.safePost("/wham/tasks",{requestBody:{follow_up:{task_id:e,turn_id:t,run_environment_in_qa_mode:n},input_items:u},additionalHeaders:g}))}static markTurnAsRead(e){return this._wrapWhamRequest(()=>i.safePost("/wham/tasks/{task_id}/mark_read",{parameters:{path:{task_id:e}}}))}static awaitTitle(e){return i.safeGet("/wham/tasks/{task_id}/await_title",{parameters:{path:{task_id:e}}})}}const $=(s,e,t,a)=>({queryKey:["wham","task",s,e],staleTime:0,enabled:!!s&&!!e,queryFn:async()=>(t.invalidateQueries({queryKey:["wham","tasks"]}),await o.getTaskTurn(s??"",e??"").then(r=>(t.setQueryData(["wham","tasks"],n=>z(n,r)),r))),...a||{}}),j=s=>({queryKey:["wham","task",s],staleTime:0,enabled:!!s,queryFn:async()=>await o.getTaskDetails(s??"")}),ee=s=>{const e=j(s);return m(e)},O=19;function te({enabled:s=!0,refetchOnMount:e=!1}={}){const t=P(({tasksFilter:a})=>a);return G({queryKey:["wham","tasks",t],queryFn:async({pageParam:a})=>await o.getTasksForList(O,a??null,t),initialPageParam:null,getNextPageParam:({cursor:a})=>a,enabled:s,refetchOnMount:e})}const W=s=>{const e=E(s.turn.output_items);return{id:s.task.id,title:s.task.title,has_generated_title:s.task.has_generated_title??null,updated_at:s.turn.created_at,task_status_display:{environment_label:s.turn.environment?.label,latest_turn_status_display:{turn_id:s.turn.id,turn_status:s.turn.turn_status,diff_stats:{files_modified:l(e,t=>t.files_modified??0),lines_added:l(e,t=>t.lines_added??0),lines_removed:l(e,t=>t.lines_removed??0)}}},archived:s.task.archived,has_unread_turn:!!s.task.has_unread_turn}};function z(s,e){const t=e.task.id;return e.task.current_turn_id!==e.turn.id?s:s?w(s,a=>{let r=!1;for(const n of a.pages){const u=n.items.findIndex(d=>d.id===t);if(u!==-1){n.items[u]=W(e),r=!0;break}}r||a.pages[0].items.push(W(e))}):{pageParams:[null],pages:[{items:[{task:e.task,turn:e.turn}]}]}}function ae({retry:s=0}={}){return m({queryKey:["wham","environments"],queryFn:()=>o.getEnvironments(),retry:s})}function se(){return m({queryKey:["wham","githubInstallations"],queryFn:()=>o.getGithubInstallations(),staleTime:0,refetchOnWindowFocus:!0,refetchOnMount:!0})}function re(s,e,t){s.setQueryData(["wham","environments"],a=>a?[e,...a]:[e]),s.setQueryData(["wham","environments","with-creators"],a=>{if(!a)return a;const r={...e,creator:t};return w(a,n=>{n.pages.length>0&&n.pages[0].items.unshift(r)})})}function ne(s,e){s.setQueryData(["wham","environments"],t=>t?.filter(a=>a.id!==e)),s.setQueryData(["wham","environments","with-creators"],t=>t&&w(t,a=>{a.pages[0].items=a.pages[0].items.filter(r=>r.id!==e)}))}function ie(s,e,t){s.setQueryData(["wham","environments"],a=>a?.map(r=>r.id===e?t:r)),s.setQueryData(["wham","environments","with-creators"],a=>a&&w(a,r=>{r.pages[0].items=r.pages[0].items.map(n=>n.id===e?{...n,...t}:n)})),s.setQueryData(["environments",e,"withCreatorAndMachine"],a=>a?{...a,...t}:void 0)}function ue(s){return m({queryKey:["environments",s,"withCreatorAndMachine"],queryFn:()=>o.getEnvironmentWithCreatorAndMachine(s)})}function oe(){return m({queryKey:["wham","userPreferences"],queryFn:()=>o.getUserPreferences()})}function de(){return m({queryKey:["wham","userPreferencesConfig"],queryFn:()=>o.getUserPreferencesConfig()})}function me(s,e){return Promise.all([s.invalidateQueries({queryKey:["wham","environments","with-creators"]}),s.invalidateQueries({queryKey:["wham","environments"]}),e&&s.invalidateQueries({queryKey:["environments",e]}),e&&s.invalidateQueries({queryKey:["environments",e,"withCreatorAndMachine"]})])}function ce(s){return s.invalidateQueries({queryKey:["wham","userPreferences"]})}function he(s){const e=P(t=>t.addTurnToTaskMap);return m({queryKey:["wham","task",s,"turns"],queryFn:async()=>{const t=await o.getTurns(s??"");return Object.values(t.turn_mapping).forEach(a=>{e(s??"",a.turn)}),t},enabled:!!s})}function le(s,e){return m({queryKey:["wham","task",s,"turns",e,"logs"],queryFn:()=>o.getTurnLogs(s??"",e??""),enabled:!!s&&!!e})}function pe(s,{enabled:e=!0}={}){return m({enabled:!!s&&e,queryKey:["wham","task",s,"await_title"],queryFn:()=>o.awaitTitle(s??"")})}const _e=({children:s,sideOffset:e=-35,isOpen:t,closePopover:a,popoverContentRef:r,...n})=>{const u=S();return f.useEffect(()=>{if(t)return Q(a,r)},[t,r,a]),f.useEffect(()=>{if(!t)return;const d=g=>{g.key==="Escape"&&a()};return document.addEventListener("keydown",d,{capture:!0,passive:!0}),()=>document.removeEventListener("keydown",d,{capture:!0})},[t,a]),_.jsx(K,{forceMount:!0,asChild:!0,align:"center",sideOffset:e,onOpenAutoFocus:d=>{d.preventDefault()},...n,children:_.jsx("div",{ref:r,className:q(!t&&"pointer-events-none","z-20"),children:_.jsx(B,{mode:"sync",children:t&&_.jsx(D.div,{className:q("border-token-border-light origin-radix-popover dark:bg-token-main-surface-secondary flex overflow-clip rounded-2xl border bg-white shadow-2xl dark:border-white/5 dark:shadow-[0px_24px_64px_rgba(0,0,0,0.32)]"),variants:{open:{scale:[.7,1],opacity:1,transition:u?C:b},closed:{opacity:0,scale:.8,transition:u?C:{...b,duration:.2}}},initial:"closed",animate:"open",exit:"closed",children:s})})})})},fe=s=>f.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},f.createElement("path",{d:"M17.5 3C19.1569 3 20.5 4.34315 20.5 6C20.5 7.30574 19.6645 8.413 18.5 8.8252V9C18.5 11.2091 16.7091 13 14.5 13H9.5C8.39543 13 7.5 13.8954 7.5 15V15.1738C8.66468 15.5859 9.5 16.6941 9.5 18C9.5 19.6569 8.15685 21 6.5 21C4.84315 21 3.5 19.6569 3.5 18C3.5 16.6941 4.33532 15.5859 5.5 15.1738V8.8252C4.33548 8.413 3.5 7.30574 3.5 6C3.5 4.34315 4.84315 3 6.5 3C8.15685 3 9.5 4.34315 9.5 6C9.5 7.30574 8.66452 8.413 7.5 8.8252V11.5361C8.08845 11.1956 8.77125 11 9.5 11H14.5C15.6046 11 16.5 10.1046 16.5 9V8.8252C15.3355 8.413 14.5 7.30574 14.5 6C14.5 4.34315 15.8431 3 17.5 3ZM6.5 17C5.94772 17 5.5 17.4477 5.5 18C5.5 18.5523 5.94772 19 6.5 19C7.05228 19 7.5 18.5523 7.5 18C7.5 17.4477 7.05228 17 6.5 17ZM6.5 5C5.94772 5 5.5 5.44772 5.5 6C5.5 6.55228 5.94772 7 6.5 7C7.05228 7 7.5 6.55228 7.5 6C7.5 5.44772 7.05228 5 6.5 5ZM17.5 5C16.9477 5 16.5 5.44772 16.5 6C16.5 6.55228 16.9477 7 17.5 7C18.0523 7 18.5 6.55228 18.5 6C18.5 5.44772 18.0523 5 17.5 5Z",fill:"currentColor"}));export{_e as C,fe as S,o as W,ie as a,N as b,P as c,te as d,ee as e,he as f,$ as g,se as h,me as i,ae as j,oe as k,de as l,ce as m,pe as n,X as o,re as p,E as q,ne as r,l as s,le as t,ue as u,Y as w};
//# sourceMappingURL=ojvadmnty96xvqkr.js.map
