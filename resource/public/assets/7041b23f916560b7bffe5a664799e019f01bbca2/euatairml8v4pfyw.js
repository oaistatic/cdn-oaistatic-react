const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/hx2boopigxjxjzyi.js","assets/lip667d8t42poxum.js","assets/n9zp7vm10xoipejo.js","assets/root-ivmjnum3.css","assets/l4oo5ijw01fyrjzs.js","assets/conversation-small-k5k9c71c.css","assets/h43r6ob2pmpzfm4z.js","assets/joa8jajuiu4xqpzn.js"])))=>i.map(i=>d[i]);
import{J as Ie,Q as ke,N as M,L as F,H as V,I as Pe,V as Me,b9 as Re,c as $,d9 as Te,F as ae,aO as J,aj as ee,m as ie,B as Ne,af as Ae,gT as B,gS as te,cv as Oe,d$ as Ve,at as Be,X as Le,_ as Fe,ag as Ke}from"./n9zp7vm10xoipejo.js";import{r as u,j as t,f as K,a5 as le,M as O,a as He,l as ze}from"./lip667d8t42poxum.js";import{F as Ue}from"./fu7jz6k4fpow8yui.js";import{m6 as We,m7 as ce,m8 as Ge,bp as de,br as Xe,bs as Ye,hL as $e,bx as qe,hI as ue,c6 as me,dp as L,an as Qe,b8 as Ze,aZ as ne,m9 as Je,dO as oe,a_ as et,fy as tt,hM as nt,G as ot,lx as rt,fz as st,cz as at,dP as it,dq as fe,lT as lt,ma as ct,mb as dt,fk as ut}from"./l4oo5ijw01fyrjzs.js";import"./g1wxldf6nb3zk37x.js";import"./ezoyp421dng92ve4.js";import"./krf7zg7fy4qqowqq.js";import"./j385t288u9l3nf6j.js";import"./iw1z7t3hfai34563.js";import"./ef49rx2y546x1g51.js";import"./g1x7jf9g2b4osi6b.js";import"./nmzcjggnos81a3wt.js";import"./kdkl0k5zipatley9.js";import"./czpmep8a1gn2yxp9.js";import"./n4y4yo9zuw99bnsn.js";import"./cbaql59zac1mfnmh.js";import"./op1xowyjquc2dnq7.js";import"./oour34cwuwf9tyoh.js";import"./fcstnnugjba7r74i.js";import"./n0pa7j0wpnznnwf7.js";import"./h2xyil3hz732ienl.js";import"./n8h67w4b99r4iqjn.js";import"./nexm4ijmv6vpe660.js";import"./o0md5hhsc34wyah3.js";import"./mcbptdo34ig6awmf.js";import"./es0z9v8doc0hgjd4.js";import"./btgi4ch9w5xby7vu.js";import"./k1r8zdqpavwsddzj.js";import"./m5nmfgkx7kb16kea.js";import"./frsgt7dup0f3mfs8.js";import"./jrbfupmnwi0b2in6.js";import"./n7emuv1efbtdnxb9.js";import"./h5ge3c3mruoe76ro.js";import"./flqsbet8wo14mte0.js";import"./dih8dferf1paqxo1.js";import"./d61ttkht2554hc14.js";import"./hdusgp6ndfp1vzue.js";import"./bir4gwnbq17hkvt3.js";import"./ju8q15l0hqy6ti9z.js";import"./fn4w95puq6zt7u0n.js";function mt(){const[e,n]=u.useState({undoStack:[],currentIndex:-1});function o(s){n(l=>({undoStack:[...l.undoStack.slice(0,l.currentIndex+1),s],currentIndex:l.currentIndex+1}))}function r(){n(s=>({undoStack:s.undoStack,currentIndex:Math.max(s.currentIndex-1,-1)}))}function a(){n(s=>({undoStack:s.undoStack,currentIndex:Math.min(s.currentIndex+1,s.undoStack.length-1)}))}function i(){n({undoStack:[],currentIndex:-1})}return{currentDrawnShape:e.undoStack.length>0?e.undoStack[e.currentIndex]:null,onNewDrawnShape:o,canUndoDrawing:e.currentIndex>=0,undoDrawing:r,canRedoDrawing:e.currentIndex<e.undoStack.length-1,redoDrawing:a,clearAllDrawings:i}}var pe=["PageUp","PageDown"],ge=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],he={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},R="Slider",[G,ft,pt]=We(R),[xe,kn]=ke(R,[pt]),[gt,H]=xe(R),Se=u.forwardRef((e,n)=>{const{name:o,min:r=0,max:a=100,step:i=1,orientation:s="horizontal",disabled:l=!1,minStepsBetweenThumbs:c=0,defaultValue:f=[r],value:m,onValueChange:d=()=>{},onValueCommit:p=()=>{},inverted:g=!1,form:y,...x}=e,S=u.useRef(new Set),h=u.useRef(0),v=s==="horizontal"?ht:xt,[w=[],b]=Ie({prop:m,defaultProp:f,onChange:j=>{[...S.current][h.current]?.focus(),d(j)}}),_=u.useRef(w);function T(j){const I=yt(w,j);N(j,I)}function z(j){N(j,h.current)}function _e(){const j=_.current[h.current];w[h.current]!==j&&p(w)}function N(j,I,{commit:U}={commit:!1}){const Q=Dt(i),W=_t(Math.round((j-r)/i)*i+r,Q),A=ce(W,[r,a]);b((P=[])=>{const k=wt(P,A,I);if(Et(k,c*i)){h.current=k.indexOf(A);const Z=String(k)!==String(P);return Z&&U&&p(k),Z?k:P}else return P})}return t.jsx(gt,{scope:e.__scopeSlider,name:o,disabled:l,min:r,max:a,valueIndexToChangeRef:h,thumbs:S.current,values:w,orientation:s,form:y,children:t.jsx(G.Provider,{scope:e.__scopeSlider,children:t.jsx(G.Slot,{scope:e.__scopeSlider,children:t.jsx(v,{"aria-disabled":l,"data-disabled":l?"":void 0,...x,ref:n,onPointerDown:M(x.onPointerDown,()=>{l||(_.current=w)}),min:r,max:a,inverted:g,onSlideStart:l?void 0:T,onSlideMove:l?void 0:z,onSlideEnd:l?void 0:_e,onHomeKeyDown:()=>!l&&N(r,0,{commit:!0}),onEndKeyDown:()=>!l&&N(a,w.length-1,{commit:!0}),onStepKeyDown:({event:j,direction:I})=>{if(!l){const W=pe.includes(j.key)||j.shiftKey&&ge.includes(j.key)?10:1,A=h.current,P=w[A],k=i*W*I;N(P+k,A,{commit:!0})}}})})})})});Se.displayName=R;var[ve,we]=xe(R,{startEdge:"left",endEdge:"right",size:"width",direction:1}),ht=u.forwardRef((e,n)=>{const{min:o,max:r,dir:a,inverted:i,onSlideStart:s,onSlideMove:l,onSlideEnd:c,onStepKeyDown:f,...m}=e,[d,p]=u.useState(null),g=V(n,v=>p(v)),y=u.useRef(),x=Pe(a),S=x==="ltr",h=S&&!i||!S&&i;function E(v){const w=y.current||d.getBoundingClientRect(),b=[0,w.width],T=q(b,h?[o,r]:[r,o]);return y.current=w,T(v-w.left)}return t.jsx(ve,{scope:e.__scopeSlider,startEdge:h?"left":"right",endEdge:h?"right":"left",direction:h?1:-1,size:"width",children:t.jsx(be,{dir:x,"data-orientation":"horizontal",...m,ref:g,style:{...m.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:v=>{const w=E(v.clientX);s?.(w)},onSlideMove:v=>{const w=E(v.clientX);l?.(w)},onSlideEnd:()=>{y.current=void 0,c?.()},onStepKeyDown:v=>{const b=he[h?"from-left":"from-right"].includes(v.key);f?.({event:v,direction:b?-1:1})}})})}),xt=u.forwardRef((e,n)=>{const{min:o,max:r,inverted:a,onSlideStart:i,onSlideMove:s,onSlideEnd:l,onStepKeyDown:c,...f}=e,m=u.useRef(null),d=V(n,m),p=u.useRef(),g=!a;function y(x){const S=p.current||m.current.getBoundingClientRect(),h=[0,S.height],v=q(h,g?[r,o]:[o,r]);return p.current=S,v(x-S.top)}return t.jsx(ve,{scope:e.__scopeSlider,startEdge:g?"bottom":"top",endEdge:g?"top":"bottom",size:"height",direction:g?1:-1,children:t.jsx(be,{"data-orientation":"vertical",...f,ref:d,style:{...f.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:x=>{const S=y(x.clientY);i?.(S)},onSlideMove:x=>{const S=y(x.clientY);s?.(S)},onSlideEnd:()=>{p.current=void 0,l?.()},onStepKeyDown:x=>{const h=he[g?"from-bottom":"from-top"].includes(x.key);c?.({event:x,direction:h?-1:1})}})})}),be=u.forwardRef((e,n)=>{const{__scopeSlider:o,onSlideStart:r,onSlideMove:a,onSlideEnd:i,onHomeKeyDown:s,onEndKeyDown:l,onStepKeyDown:c,...f}=e,m=H(R,o);return t.jsx(F.span,{...f,ref:n,onKeyDown:M(e.onKeyDown,d=>{d.key==="Home"?(s(d),d.preventDefault()):d.key==="End"?(l(d),d.preventDefault()):pe.concat(ge).includes(d.key)&&(c(d),d.preventDefault())}),onPointerDown:M(e.onPointerDown,d=>{const p=d.target;p.setPointerCapture(d.pointerId),d.preventDefault(),m.thumbs.has(p)?p.focus():r(d)}),onPointerMove:M(e.onPointerMove,d=>{d.target.hasPointerCapture(d.pointerId)&&a(d)}),onPointerUp:M(e.onPointerUp,d=>{const p=d.target;p.hasPointerCapture(d.pointerId)&&(p.releasePointerCapture(d.pointerId),i(d))})})}),ye="SliderTrack",je=u.forwardRef((e,n)=>{const{__scopeSlider:o,...r}=e,a=H(ye,o);return t.jsx(F.span,{"data-disabled":a.disabled?"":void 0,"data-orientation":a.orientation,...r,ref:n})});je.displayName=ye;var X="SliderRange",Ce=u.forwardRef((e,n)=>{const{__scopeSlider:o,...r}=e,a=H(X,o),i=we(X,o),s=u.useRef(null),l=V(n,s),c=a.values.length,f=a.values.map(p=>De(p,a.min,a.max)),m=c>1?Math.min(...f):0,d=100-Math.max(...f);return t.jsx(F.span,{"data-orientation":a.orientation,"data-disabled":a.disabled?"":void 0,...r,ref:l,style:{...e.style,[i.startEdge]:m+"%",[i.endEdge]:d+"%"}})});Ce.displayName=X;var Y="SliderThumb",Ee=u.forwardRef((e,n)=>{const o=ft(e.__scopeSlider),[r,a]=u.useState(null),i=V(n,l=>a(l)),s=u.useMemo(()=>r?o().findIndex(l=>l.ref.current===r):-1,[o,r]);return t.jsx(St,{...e,ref:i,index:s})}),St=u.forwardRef((e,n)=>{const{__scopeSlider:o,index:r,name:a,...i}=e,s=H(Y,o),l=we(Y,o),[c,f]=u.useState(null),m=V(n,E=>f(E)),d=c?s.form||!!c.closest("form"):!0,p=Me(c),g=s.values[r],y=g===void 0?0:De(g,s.min,s.max),x=bt(r,s.values.length),S=p?.[l.size],h=S?jt(S,y,l.direction):0;return u.useEffect(()=>{if(c)return s.thumbs.add(c),()=>{s.thumbs.delete(c)}},[c,s.thumbs]),t.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[l.startEdge]:`calc(${y}% + ${h}px)`},children:[t.jsx(G.ItemSlot,{scope:e.__scopeSlider,children:t.jsx(F.span,{role:"slider","aria-label":e["aria-label"]||x,"aria-valuemin":s.min,"aria-valuenow":g,"aria-valuemax":s.max,"aria-orientation":s.orientation,"data-orientation":s.orientation,"data-disabled":s.disabled?"":void 0,tabIndex:s.disabled?void 0:0,...i,ref:m,style:g===void 0?{display:"none"}:e.style,onFocus:M(e.onFocus,()=>{s.valueIndexToChangeRef.current=r})})}),d&&t.jsx(vt,{name:a??(s.name?s.name+(s.values.length>1?"[]":""):void 0),form:s.form,value:g},r)]})});Ee.displayName=Y;var vt=e=>{const{value:n,...o}=e,r=u.useRef(null),a=Ge(n);return u.useEffect(()=>{const i=r.current,s=window.HTMLInputElement.prototype,c=Object.getOwnPropertyDescriptor(s,"value").set;if(a!==n&&c){const f=new Event("input",{bubbles:!0});c.call(i,n),i.dispatchEvent(f)}},[a,n]),t.jsx("input",{style:{display:"none"},...o,ref:r,defaultValue:n})};function wt(e=[],n,o){const r=[...e];return r[o]=n,r.sort((a,i)=>a-i)}function De(e,n,o){const i=100/(o-n)*(e-n);return ce(i,[0,100])}function bt(e,n){return n>2?`Value ${e+1} of ${n}`:n===2?["Minimum","Maximum"][e]:void 0}function yt(e,n){if(e.length===1)return 0;const o=e.map(a=>Math.abs(a-n)),r=Math.min(...o);return o.indexOf(r)}function jt(e,n,o){const r=e/2,i=q([0,50],[0,r]);return(r-i(n)*o)*o}function Ct(e){return e.slice(0,-1).map((n,o)=>e[o+1]-n)}function Et(e,n){if(n>0){const o=Ct(e);return Math.min(...o)>=n}return!0}function q(e,n){return o=>{if(e[0]===e[1]||n[0]===n[1])return n[0];const r=(n[1]-n[0])/(e[1]-e[0]);return n[0]+r*(o-e[0])}}function Dt(e){return(String(e).split(".")[1]||"").length}function _t(e,n){const o=Math.pow(10,n);return Math.round(e*o)/o}var It=Se,kt=je,Pt=Ce,Mt=Ee,C=(e=>(e[e.Default=0]="Default",e[e.Inpaint=1]="Inpaint",e))(C||{});function Rt({imageAsset:e,mode:n,setMode:o,clientThreadId:r,messageId:a,cursorWidth:i,setCursorWidth:s,inpaintingDrawingState:l,isLoadingNewImage:c}){const f=Re(r),{canUndoDrawing:m,undoDrawing:d,canRedoDrawing:p,redoDrawing:g,clearAllDrawings:y}=l,x=K();return t.jsxs(le.div,{className:"flex h-16 w-full justify-between px-4",...de,children:[t.jsx("div",{className:"flex items-center",children:n===C.Inpaint&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:$("flex items-center gap-3",c&&"opacity-50"),children:[t.jsx(se,{className:"h-[11px] w-[11px]"}),t.jsxs(It,{className:"relative flex w-[90px] items-center",min:32,max:240,step:.01,value:[i],onValueChange:S=>s(S[0]),disabled:c,children:[t.jsx(kt,{className:"bg-token-text-quaternary relative h-[2px] grow",children:t.jsx(Pt,{className:"bg-token-text-secondary absolute h-full"})}),t.jsx(Mt,{className:"bg-token-text-secondary block h-[11px] w-[11px] rounded-full"})]}),t.jsx(se,{className:"h-6 w-6"})]}),t.jsx(re,{}),t.jsx(D,{disabled:!m||c,onClick:d,children:t.jsx(Xe,{})}),t.jsx(D,{disabled:!p||c,onClick:g,children:t.jsx(Ye,{})}),t.jsx(re,{}),t.jsx(D,{disabled:!m||c,onClick:y,children:t.jsx(O,{id:"imageEditorControls.clearSelectionButtonLabel",defaultMessage:"Clear selection"})})]})}),t.jsx("div",{className:"flex items-center",children:n===C.Inpaint?t.jsx(D,{onClick:()=>o(C.Default),disabled:c,children:t.jsx(O,{id:"imageEditorControls.cancelButtonLabel",defaultMessage:"Cancel"})}):t.jsxs(t.Fragment,{children:[t.jsx(Nt,{imageAsset:e,setMode:o,messageId:a,serverThreadId:f}),t.jsx(D,{tooltip:x.formatMessage({id:"imageEditorControls.downloadButtonTooltip",defaultMessage:"Save"}),onClick:()=>$e(e,f,a),children:t.jsx(qe,{})}),t.jsx(Tt,{prompt:ue(e),children:t.jsx(D,{tooltip:x.formatMessage({id:"imageEditorControls.promptButtonTooltip",defaultMessage:"Prompt"}),children:t.jsx(me,{})})}),t.jsx(D,{tooltip:x.formatMessage({id:"imageEditorControls.closeButtonTooltip",defaultMessage:"Close"}),onClick:L.close,children:t.jsx(Te,{className:"icon-lg"})})]})})]})}function Tt({prompt:e,children:n}){const[o,r]=u.useState(!1),a=K(),i=ie();return t.jsx(tt,{sideOffset:4,alignAgainstAnchor:"end",triggerButton:t.jsx("div",{className:"group",children:n}),className:"z-10",size:"none",children:t.jsxs("div",{className:"flex max-w-sm flex-col gap-3 p-4",children:[t.jsx("div",{className:"text-token-text-secondary",children:t.jsx(O,{id:"imageEditorControls.promptPopoverLabel",defaultMessage:"Prompt"})}),t.jsx("div",{children:e}),t.jsx("div",{children:t.jsx(Ne,{color:"secondary",disabled:o,onClick:s=>{r(!0),ot(e,i,s),setTimeout(()=>r(!1),2e3)},icon:nt,children:o?a.formatMessage({id:"imageEditorControls.copiedButtonLabel",defaultMessage:"Copied!"}):a.formatMessage({id:"imageEditorControls.copyButtonLabel",defaultMessage:"Copy"})})})]})})}function D({children:e,tooltip:n,disabled:o,onClick:r}){const a=t.jsx("button",{className:$("hover:bg-token-main-surface-tertiary group-radix-state-open:bg-token-main-surface-tertiary rounded-sm p-2 font-semibold",o?"text-token-text-quaternary":"text-token-text-secondary"),disabled:o,onClick:r,children:e});return n!=null?t.jsx(Qe,{label:n,children:a}):a}function Nt({imageAsset:e,setMode:n,messageId:o,serverThreadId:r,disabled:a}){const i=K(),s=Ze(ne.DalleEditingOnboarding),l=s.eligible&&!s.isLoading,c=t.jsx(D,{tooltip:l?void 0:i.formatMessage({id:"imageEditorControls.inpaintButtonTooltip",defaultMessage:"Select"}),onClick:()=>{n(C.Inpaint),J.logEvent("chatgpt_dalle_inpaint_click",null,{sourceOperation:e.metadata?.dalle?.edit_op??"none",hasParent:e.metadata?.dalle?.parent_gen_id!=null?"true":"false",model:"dalle"}),ee.logEvent("chatgpt_dalle_inpaint_click",{conversationId:r,messageId:o,generationId:e.metadata?.dalle?.gen_id,fileId:oe(e.asset_pointer),parentGenerationId:e.metadata?.dalle?.parent_gen_id,sourceOperation:e.metadata?.dalle?.edit_op,model:"dalle"}),J.logEvent("chatgpt_image_inpaint_click",null,{sourceOperation:e.metadata?.dalle?.edit_op??"none",hasParent:e.metadata?.dalle?.parent_gen_id!=null?"true":"false",model:"dalle"}),ee.logEvent("chatgpt_image_inpaint_click",{conversationId:r,messageId:o,generationId:e.metadata?.dalle?.gen_id,fileId:oe(e.asset_pointer),parentGenerationId:e.metadata?.dalle?.parent_gen_id,sourceOperation:e.metadata?.dalle?.edit_op,model:"dalle"})},disabled:a,children:t.jsx(Je,{})});return l?t.jsx(et,{announcementKey:ne.DalleEditingOnboarding,show:!0,side:"bottom",sideOffset:0,title:i.formatMessage({id:"imageEditorNUX.title",defaultMessage:"Select area of the image to edit"}),description:i.formatMessage({id:"imageEditorNUX.description",defaultMessage:"Highlight the area and describe changes in chat."}),onDismiss:s.markAsViewed,children:t.jsx("div",{children:c})}):c}const re=ae.div`mx-3 w-[1px] h-6 bg-token-border-default`,se=ae.div`rounded-full border-2 border-token-text-secondary`;function At({mode:e,imageIndex:n,allImages:o,onSwitchImage:r,isLoadingNewImage:a}){const i=n>0,s=u.useCallback(()=>{i&&r(o[n-1])},[i,o,n,r]),l=n<o.length-1,c=u.useCallback(()=>{l&&r(o[n+1])},[l,o,n,r]);return u.useEffect(()=>{function f(m){m.target instanceof HTMLTextAreaElement||e===C.Default&&(m.key==="ArrowLeft"?s():m.key==="ArrowRight"&&c())}return document.addEventListener("keydown",f),()=>{document.removeEventListener("keydown",f)}},[e,s,c]),t.jsx("div",{className:"text-token-text-secondary flex h-16 w-full items-center justify-center gap-3 font-semibold",children:e===C.Inpaint?!a&&t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx(O,{id:"imageEditor.selectArea",defaultMessage:"Select an area to edit"}),t.jsx("a",{href:"https://help.openai.com/en/articles/9055440",target:"_blank",rel:"noreferrer",children:t.jsx(me,{className:"icon-md"})})]}):o.length>1?t.jsxs(t.Fragment,{children:[t.jsx("button",{disabled:!i,className:"disabled:text-token-text-tertiary",onClick:s,children:t.jsx(rt,{className:"icon-lg"})}),t.jsx("div",{children:t.jsx(O,{id:"imageEditor.imageNumber",defaultMessage:"Image {num} of {numImages}",values:{num:n+1,numImages:o.length}})}),t.jsx("button",{disabled:!l,className:"disabled:text-token-text-tertiary",onClick:c,children:t.jsx(st,{className:"icon-lg"})})]}):null})}const Ot=0,Vt=64;function Bt({imageAsset:e,children:n,containerDimensions:o,isLoadingNewImage:r}){return t.jsxs(le.div,{className:"absolute",style:Lt(e,o),...de,children:[n,t.jsx("div",{className:$("bg-token-main-surface-primary absolute inset-0 flex items-center justify-center transition-opacity duration-1000",r?"pointer-events-auto opacity-60":"pointer-events-none opacity-0")})]})}function Lt(e,n){const{width:o,height:r}=e,{width:a,height:i}=n,s=a-2*Ot,l=i-2*Vt,c=o/r,f=s/l,m=c>f,d=m?s:l*c,p=m?s/c:l,g=(i-p)/2,y=(a-d)/2;return{top:g,left:y,width:d,height:p}}const Ft=Le(()=>Fe(()=>import("./hx2boopigxjxjzyi.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(e=>e.DynamicDrawingCanvas));function Pn({clientThreadId:e,messageId:n,image:o,allImages:r}){const a=Ae(e,Ke.getCurrentNode),i=[B.Dalle,B.t2uay3k].includes(te(a.message))&&!at(a.message),s=He();return u.useEffect(()=>{async function l(c,f){try{const m=await it(s,c);L.setFocusedObject({type:fe.Image,image:m[0],allImages:m,messageId:f})}catch(m){Be.addError(new Error("Failed to load newly created images:",{cause:m}))}}if(a!=null&&[B.Dalle,B.t2uay3k].includes(te(a.message))&&a.message.content.content_type===Oe.MultimodalText){const c=Ve.getImageAssetPointers(a.message);l(c,a.id)}},[s,a]),t.jsx(Kt,{image:o,allImages:r,isLoadingNewImage:i,clientThreadId:e,messageId:n})}function Kt({image:e,allImages:n,isLoadingNewImage:o,clientThreadId:r,messageId:a}){const[i,s]=u.useState(C.Default),[l,c]=u.useState({width:window.innerWidth-Ue,height:window.innerHeight}),f=u.useRef(null),[m,d]=u.useState(136),p=mt(),{currentDrawnShape:g,onNewDrawnShape:y,clearAllDrawings:x}=p,S=u.useRef(null),h=K(),E=ie(),{setTargetedContent:v}=lt();u.useEffect(()=>{const b=new ResizeObserver(_=>{const{width:T,height:z}=_[0].contentRect;c({width:T,height:z})});return f.current&&b.observe(f.current),()=>{b.disconnect()}},[]),u.useEffect(()=>{function b(_){_.key==="Escape"&&(i===C.Inpaint?s(C.Default):L.close())}return document.addEventListener("keydown",b),()=>{document.removeEventListener("keydown",b)}},[i]),u.useEffect(()=>(g==null?v({type:"object",placeholderTextOverride:ze({id:"imageEditor.transformationTextareaPlaceholder",defaultMessage:"Edit image…"}),shouldPersistAcrossMessages:!0,isFocusedViewContent:!0,createNewCompletionParams:b=>ct(b,e)}):v({type:"object",label:h.formatMessage({id:"imageEditor.inpaintingTargetedContentLabel",defaultMessage:"Edit selection"}),isFocusedViewContent:!0,createNewCompletionParams:async b=>await dt(b,e,S.current?.getImageData(),h,E),onCleared:()=>s(C.Default)}),()=>{v(void 0)}),[e,h,v,g,E]),u.useEffect(()=>{i!==C.Inpaint&&x()},[i]),u.useEffect(()=>{s(C.Default)},[e]);const w=n.findIndex(b=>b.asset_pointer===e.asset_pointer);return t.jsxs("div",{ref:f,className:"flex h-full w-full flex-col justify-between",children:[t.jsx(Rt,{imageAsset:e,mode:i,setMode:s,clientThreadId:r,messageId:a,cursorWidth:m,setCursorWidth:d,inpaintingDrawingState:p,isLoadingNewImage:o}),t.jsx(At,{mode:i,imageIndex:w,allImages:n,onSwitchImage:b=>{L.setFocusedObject({type:fe.Image,image:b,allImages:n,messageId:a})},isLoadingNewImage:o}),t.jsxs(Bt,{imageAsset:e,containerDimensions:l,isLoadingNewImage:o,children:[t.jsx(ut,{className:"h-full w-full",alt:ue(e),src:e.url,width:e.width,height:e.height,fadeIn:!1}),i===C.Inpaint&&t.jsx("div",{className:"absolute inset-0",children:t.jsx(Ft,{drawingCanvasRef:S,color:"rgba(0, 122, 255, 0.5)",dashedOutlineColor:"rgba(255, 255, 255, 0.65)",cursorWidth:m,canvasWidth:e.width,canvasHeight:e.height,currentDrawnShape:g,onNewDrawnShape:y})})]})]})}export{Pn as ImageEditor};
//# sourceMappingURL=euatairml8v4pfyw.js.map
