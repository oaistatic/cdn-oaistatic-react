import{j as a,f as R,ag as je,u as Te,r,a5 as y,M as b,c as be,a6 as te}from"./lip667d8t42poxum.js";import{c as k,as as ke,aM as Se,g as ue,s as L,aj as A,c4 as X,c5 as G,u as _e,e6 as T,aa as se,at as Ne,bL as H,dH as Re}from"./n9zp7vm10xoipejo.js";import{u as Ie}from"./gydkbc6xtfcf9567.js";import{ea as Ae,dO as Ee,oo as de,S as Oe,am as Fe,al as Be,op as qe,aq as ze,ir as De,as as He,n5 as Ue,oq as Pe}from"./l4oo5ijw01fyrjzs.js";import{C as c,a as Le,b as Xe}from"./nes6faz3el60eb3o.js";import{CA_SOURCE_TO_TEXT_MAP as Ge,getCASources as Ye}from"./ompbofktfjr0ksz2.js";import{F as me,l as We}from"./fcfjbsbarhrilkf6.js";import{g as Qe,a as Ve,b as Je,i as Ke,c as Ze,C as $e,h as et}from"./jpfsl7zlesohw8kt.js";import"./ju8q15l0hqy6ti9z.js";import"./ezoyp421dng92ve4.js";import"./krf7zg7fy4qqowqq.js";import"./j385t288u9l3nf6j.js";import"./nmzcjggnos81a3wt.js";import"./ocylzx9oqlg8ycwm.js";import"./j1bb88glgmel43br.js";import"./n7emuv1efbtdnxb9.js";import"./ef49rx2y546x1g51.js";import"./d61ttkht2554hc14.js";import"./ojvadmnty96xvqkr.js";import"./iguubsmy82ykz2l9.js";import"./ex0w8u6azfclal10.js";import"./jilfkjkciycvhk2x.js";import"./f64hg6fdq8ojkhjz.js";import"./btgi4ch9w5xby7vu.js";import"./es0z9v8doc0hgjd4.js";import"./ctz8d92lx4gyhixb.js";import"./cg71y7d9v77500qa.js";const tt=24,ae=12,U=4,st=5e3;function E(t,e,s){switch(e.type){case c.Thought:return e.thought.summary;case c.Recap:return e.content;case c.Browsing:return he({contextualAnswerSources:e.sources,intl:t});case c.Search:return s?t.formatMessage({id:"+a5J9x",defaultMessage:"Searched the web"}):t.formatMessage({id:"GamH3R",defaultMessage:"Searching the web"});case c.CodeAnalysis:return s?t.formatMessage({id:"SGdXPO",defaultMessage:"Analyzed"}):t.formatMessage({id:"rEhiFx",defaultMessage:"Analyzing"});case c.ImageAnalysis:return s?t.formatMessage({id:"fjqIXj",defaultMessage:"Analyzed image"}):t.formatMessage({id:"D//PTx",defaultMessage:"Analyzing image"});case c.ComputerOutput:return}}const he=({contextualAnswerSources:t,intl:e})=>{if(t.length===0)return e.formatMessage({id:"browsingMessage.startingRetrieval",defaultMessage:"Reading documents"});const s=t.map(o=>Ge[o]).filter(Boolean);return t.length===1?e.formatMessage({id:"Jzt2om",defaultMessage:"Reading {source}"},{source:s[0]}):t.length===2?e.formatMessage({id:"wTM7gR",defaultMessage:"Reading {source1} and {source2}"},{source1:s[0],source2:s[1]}):e.formatMessage({id:"xnwjH1",defaultMessage:"Reading {source1}, {source2} and more"},{source1:s[0],source2:s[1]})};function at(t){const e=new Set,s=new Set;for(const o of t)if(o.type===c.Search){for(const n of o.queries)e.add(n.q);for(const n of o.sources)s.add(n.domain)}return{queries:e.size,sources:s.size}}const nt="_markdown_1frq2_10",ot={markdown:nt},ne=({content:t})=>a.jsx(me,{className:k(ot.markdown,"text-token-text-secondary text-sm"),componentOverrides:{code:e=>a.jsx(Ae,{...e,wrapperClassName:"",showActionBar:!1})},children:t}),rt=({chunk:t,isExpanded:e,isComplete:s})=>{const o=R(),[n,i]=t.messages,f=Qe(n)!=null;return a.jsxs("div",{className:"flex w-full flex-col gap-2 text-sm",children:[e&&E(o,t,s),f&&a.jsxs("div",{children:[a.jsx(Ve,{message:n,forceDarkMode:!0,FormattedText:me,showActionBar:!1,codeRendererClassName:k("rounded-md max-h-[calc(clamp(20px,1/4*var(--thread-safe-area-height,100lvh),400px))] overflow-auto",i&&"rounded-b-none"),codeContainerClassName:"overflow-visible!"}),i&&a.jsx(Je,{forceDarkMode:!0,wrapperClassName:"max-h-[calc(clamp(20px,1/8*var(--thread-safe-area-height,100lvh),200px))] w-full overflow-auto dark rounded-b-md",codeContainerClassName:"whitespace-pre-wrap",message:i,showLabel:!1})]})]})},it=({chunk:t,isExpanded:e,isComplete:s})=>{const o=R(),n=t.messages[1],i=je(),{isUnauthenticated:f}=ke(),p=n.metadata?.aggregate_result?.messages.find(Ke),l=p?.image_url&&Ee(p.image_url),{data:v}=Te(l?Ze(l,f):{enabled:!1,queryKey:[]}),x=v?.status===Se.Success?v.download_url:void 0,{isSuccess:d}=de(x),[w]=r.useState(d);return a.jsxs("div",{className:"flex w-full flex-col gap-2 text-sm",children:[e&&E(o,t,s),a.jsxs("div",{className:"bg-token-bg-secondary relative flex h-[calc(clamp(150px,1/4*var(--thread-safe-area-height,100lvh),400px))] justify-center overflow-hidden rounded-md p-2",children:[x&&a.jsx(y.div,{initial:{opacity:w?.5:0,scale:1.1},animate:{opacity:d?.5:0,scale:s||i?1.1:[1.1,1.25,1.1]},transition:{opacity:{ease:"easeInOut"},scale:s?{type:"spring",stiffness:300,damping:20}:{duration:2.5,repeat:1/0,ease:"easeInOut"}},className:"absolute inset-0 bg-cover bg-center bg-no-repeat opacity-40 blur-lg filter",style:{backgroundImage:`url(${JSON.stringify(x)})`}}),a.jsx(y.div,{initial:{opacity:w?1:0},animate:{opacity:d?1:0},className:"relative *:m-0 *:h-full *:w-full *:rounded-md *:object-center *:shadow-lg",children:a.jsx($e,{isCoT:!0,message:n})})]})]})},ct=4,lt=3,ut=3,dt={hidden:{opacity:0},visible:{opacity:1}},oe={hidden:{opacity:0,x:-5},visible:{opacity:1,x:0}},mt=({chunk:t,isExpanded:e,isComplete:s})=>{const{queries:o,sources:n}=t,i=R(),[f,p]=r.useState(s);return a.jsxs("div",{className:"flex min-w-0 flex-col gap-2 text-sm",children:[e&&E(i,t,s),a.jsxs("div",{className:"flex min-w-0 flex-col gap-1",children:[a.jsx(re,{isComplete:s,items:o,max:ut,getKey:l=>l.q,Item:ht,ShowMoreButton:pt,onAnimationComplete:()=>p(!0)}),a.jsx(re,{isComplete:s,items:f?n:[],max:ct,getKey:l=>l.entries[0].url,Item:ft,ShowMoreButton:gt})]})]})},re=({isComplete:t,items:e,max:s,getKey:o,Item:n,ShowMoreButton:i,onAnimationComplete:f})=>{const[p,l]=r.useState(!1),[v,x]=e.length>s?[e.slice(0,s-1),e.slice(s-1)]:[e];return a.jsxs(y.div,{className:"flex flex-wrap items-center gap-1",initial:t?"visible":"hidden",animate:"visible",transition:{duration:.25,staggerChildren:.1,delayChildren:.3},onAnimationComplete:f,children:[v.map(d=>a.jsx(y.div,{variants:dt,className:"flex max-w-full items-center",children:a.jsx(n,{item:d,isComplete:t})},o(d))),p&&a.jsx(y.div,{className:"contents",initial:"hidden",animate:"visible",transition:{duration:.2,staggerChildren:.02},children:x?.map(d=>a.jsx(y.div,{variants:oe,className:"flex max-w-full items-center",children:a.jsx(n,{item:d,isComplete:t})},o(d)))}),x&&a.jsx(y.div,{variants:oe,className:"flex items-center",children:a.jsx(i,{moreItems:x,isShowingMore:p,onClick:()=>l(d=>!d)})},"more")]})},ht=({item:t})=>a.jsxs(O,{componentType:"span",children:[a.jsx(Oe,{className:"-ms-1 h-3 w-3 shrink-0"}),a.jsx("span",{className:"overflow-hidden text-ellipsis whitespace-nowrap",children:t.q})]}),ft=({item:t,isComplete:e})=>{const s=ue(),o=L(s,"3507026387"),n=t.entries[0],i=r.useMemo(()=>({url:n.url,title:n.title}),[n.url,n.title]);r.useEffect(()=>{A.logEventWithStatsig("link_action","link_action",{...i,action:"show"})},[i]);const f=()=>{A.logEventWithStatsig("link_action","link_action",{...i,action:"click"})};return a.jsxs(O,{componentType:Be,href:n.url,onClick:f,animateScan:o&&!e,children:[a.jsx(fe,{url:n.url}),n.attribution??Fe(n.url)]})},fe=({url:t,withBorder:e=!1})=>{const{isSuccess:s,isError:o}=de(qe(t,32)),[n]=r.useState(s);return o?null:a.jsx(y.div,{initial:{opacity:n?1:0},animate:{opacity:s?1:0},className:k("bg-token-main-surface-primary -ms-3 box-content h-3 w-3 shrink-0 overflow-hidden rounded-full first:-ms-1",e&&"border-token-main-surface-secondary group-hover:border-token-text-primary dark:group-hover:border-token-text-primary border"),children:a.jsx(ze,{url:t,size:32,minSize:16,className:"m-0"})})},gt=({moreItems:t,isShowingMore:e,onClick:s})=>a.jsx(O,{onClick:s,children:e?a.jsx(b,{id:"19fGXl",defaultMessage:"Show less"}):a.jsxs(a.Fragment,{children:[t.slice(0,lt).map((o,n)=>a.jsx(fe,{url:o.entries[0].url,withBorder:!0},n)),a.jsx(b,{id:"5ob5C8",defaultMessage:"{count} more",values:{count:t.length}})]})}),pt=({moreItems:t,isShowingMore:e,onClick:s})=>a.jsx(O,{onClick:s,children:e?a.jsx(b,{id:"0SWns2",defaultMessage:"Show less"}):a.jsx(b,{id:"PpZw7t",defaultMessage:"{count} more",values:{count:t.length}})}),xt=1500,O=t=>{"use forget";const e=be.c(24);let s,o,n,i,f;e[0]!==t?({className:n,componentType:f,children:o,animateScan:s,...i}=t,e[0]=t,e[1]=s,e[2]=o,e[3]=n,e[4]=i,e[5]=f):(s=e[1],o=e[2],n=e[3],i=e[4],f=e[5]);const p=f===void 0?"button":f,[l,v]=r.useState(!1),x=Math.random()*xt;let d,w;e[6]!==s?(d=()=>{s&&(v(!1),requestAnimationFrame(()=>v(!0)))},w=[s,x],e[6]=s,e[7]=d,e[8]=w):(d=e[7],w=e[8]),r.useEffect(d,w);const u=s&&"dark:border-token-main-surface-secondary border border-[#f4f4f4] bg-transparent dark:bg-transparent",M=(i.href!=null||i.onClick!=null)&&"hover:bg-token-main-surface-primary-inverse hover:text-token-text-inverted dark:hover:bg-token-text-primary";let m;e[9]!==n||e[10]!==u||e[11]!==M?(m=k(We,"group relative max-w-full overflow-hidden",u,M,n),e[9]=n,e[10]=u,e[11]=M,e[12]=m):m=e[12];let j;e[13]!==s||e[14]!==l?(j=s&&a.jsx("span",{className:k("dark:bg-token-main-surface-secondary absolute start-0 top-0 z-[-1] h-full rounded-se-full rounded-ee-full bg-[#f4f4f4] transition-[width] ease-in-out",l?"w-full":"w-0"),style:{transitionDuration:`${x}ms`}}),e[13]=s,e[14]=l,e[15]=j):j=e[15];let g;e[16]!==o?(g=a.jsx("div",{className:"z-1 inline-flex items-center gap-1",children:o}),e[16]=o,e[17]=g):g=e[17];let S;return e[18]!==p||e[19]!==i||e[20]!==m||e[21]!==j||e[22]!==g?(S=a.jsxs(p,{className:m,...i,children:[j,g]}),e[18]=p,e[19]=i,e[20]=m,e[21]=j,e[22]=g,e[23]=S):S=e[23],S},ie=null;var ge=(t=>(t.STATIC="static",t.ENTER="enter",t.STAGE="stage",t))(ge||{});const yt=({isAnimationComplete:t=!1,isExpanded:e=!1,isLast:s=!1,index:o,chunk:n,onClick:i,onMeasure:f,onAnimationComplete:p,showBullet:l=!1,isStreaming:v=!1})=>{const x=s||e,d=!s||t,w=d?"static":"stage",u=d?"static":"enter",M=r.useRef(null);M.current=()=>{p?.(o,"enter")},r.useEffect(()=>{if(u!=="enter")return;const g=setTimeout(()=>{X.count(G.COT_SUMMARIZER,"cot_chunk_timeout"),M.current?.()},st);return()=>clearTimeout(g)},[u]);const m=u==="static",j=r.useRef(null);return _e(()=>De({axis:"height",target:j.current,onChange:({height:g})=>f(o,g)}),[]),a.jsx(y.div,{role:e?void 0:"button",variants:{static:{opacity:1,scale:1,position:"static",translateY:0},enter:{position:"static",translateY:0,scale:1,opacity:1},stage:{position:"absolute",translateY:-24,scale:.95,opacity:0}},initial:w,animate:u,exit:e?void 0:{opacity:0,pointerEvents:"none",position:"absolute",translateY:tt,filter:"blur(8px)"},style:{zIndex:o},transition:t||u==="static"?{duration:0}:{type:"spring",bounce:.05},className:k("text-token-text-secondary start-0 end-0 top-0 flex origin-left",!x&&"pointer-events-none"),onAnimationComplete:g=>g!=="enter"&&p(o,g),onClick:i,ref:j,children:a.jsx(He,{onComplete:M.current,isDisabled:m,defaultDelayPerSegmentMs:20,children:l?a.jsxs("div",{className:k("relative flex w-full items-start gap-2 overflow-clip",ie),children:[ie,a.jsxs("div",{className:"flex h-full w-4 shrink-0 flex-col items-center gap-2",children:[a.jsx("div",{className:"flex h-5 shrink-0 items-center justify-center",children:a.jsx(Le,{chunk:n,size:"small"})}),!s&&a.jsx(y.div,{initial:{translateY:-24,opacity:0},animate:{translateY:0,opacity:1},className:"bg-token-border-medium h-full w-[1px] rounded-full"})]}),a.jsx(ce,{chunk:n,isExpanded:e,isComplete:d,isStreaming:v,isLast:s})]}):a.jsx(ce,{chunk:n,isExpanded:e,isComplete:d,isStreaming:v,isLast:s})})})},Ct=r.memo(yt),ce=({chunk:t,isExpanded:e,isComplete:s,isStreaming:o,isLast:n})=>{const i=R();switch(t.type){case c.Thought:return a.jsx(ne,{content:t.thought.content});case c.Recap:return a.jsx("div",{className:"text-token-text-secondary text-sm",children:a.jsx(b,{id:"Eo2n2s",defaultMessage:"Done"})});case c.Search:return a.jsx(mt,{chunk:t,isExpanded:e,isComplete:s});case c.CodeAnalysis:return a.jsx(rt,{chunk:t,isExpanded:e,isComplete:s});case c.Browsing:return e&&a.jsx(ne,{content:he({contextualAnswerSources:t.sources,intl:i})});case c.ImageAnalysis:return a.jsx(it,{chunk:t,isExpanded:e,isComplete:s});case c.ComputerOutput:return null}},le=new WeakMap;function vt(t){const e=[];for(const s of t){let o=le.get(s);o||(o=wt(s),o&&le.set(s,o)),o&&e.push(...o)}return e}function wt(t){switch(t.type){case T.ReasoningRecap:{const e=t.messages[t.messages.length-1].content.content;return[{type:c.Recap,content:e}]}case T.Browsing:case T.RetrievalBrowsing:{const e=Ye({messages:t.messages});return[{type:c.Browsing,sources:e,isRetrieval:t.type===T.RetrievalBrowsing}]}case T.StructuredThoughts:{const e=[];for(const s of t.messages){const{thoughts:o}=s.content;for(const n of o)!n.content&&!n.summary||e.push({type:c.Thought,thought:n})}return e}case T.CodeInterpreter:{const[e,s]=t.messages;if(e.author.role!==se.Assistant||s&&s.author.role!==se.Tool){Ne.addError(new Error("[cot] out of order code tool messages"));break}return[{type:s!=null&&et(s)?c.ImageAnalysis:c.CodeAnalysis,messages:t.messages}]}case T.CoTSearchTool:{const e={type:c.Search,queries:[],sources:[]};for(const s of t.messages)if(s.metadata?.search_queries?.length&&(e.queries=s.metadata.search_queries),s.metadata?.search_result_groups?.length)for(const o of s.metadata.search_result_groups)e?.sources?.some(n=>n.domain===o.domain)||e.sources?.push(o);return[e]}case T.n7jupd:return;case T.n7jupd_x:return}}const Mt={duration:.3,ease:"easeInOut"},P=.2,ts=({isStreaming:t,messageGroups:e,isAutoswitch:s,handleSimplerResponseClick:o})=>{const n=r.useMemo(()=>vt(e),[e]);return a.jsx(jt,{isStreaming:t,chunks:n,isAutoswitch:s,handleSimplerResponseClick:o})},jt=({isStreaming:t,chunks:e,isAutoswitch:s,handleSimplerResponseClick:o})=>{const n=R(),i=ue(),f=L(i,"3133027893"),p=L(i,"1993060160"),[l,v]=r.useState(!1),[x,d]=r.useState([]),w=r.useMemo(()=>at(e),[e]),u=!t,M=Ue(e,h=>h.type!==c.Recap&&(f||!(t&&h===H(e)))),[m,j]=r.useState(t?-1:e.length),g=m===-1?void 0:e[m],S=m<M||m===M&&!t,Y=t?M:e.length,I=bt(g),[W,Q]=r.useState(!t||m<0),V=r.useRef(performance.now()),J=r.useRef(performance.now());r.useEffect(()=>{V.current=performance.now()},[m]),r.useEffect(()=>{J.current=performance.now()},[g]);const[K]=r.useState(t);r.useEffect(()=>{if(K&&S&&W){const h=performance.now(),C=Math.max(0,Tt(g)-(h-V.current),I-(h-J.current));setTimeout(()=>{j(Y),Q(!1)},C)}},[K,S,W,I,g,Y]);const _=u?e:e.slice(0,m+1),F=r.useMemo(()=>{const h=H(_);return u?h?.type===c.Recap?h:void 0:h?.type===c.Thought?Re(_,C=>C.type===c.Thought&&C.thought.summary!=null&&C.thought.summary.length>0):h},[u,_]),Z=[..._.entries()],$=l?Z:Z.slice(-1);kt(m,u);const N=_.length>0&&e[0].type!==c.Recap,pe=H(_)?.type===c.Browsing&&!l,xe=N&&(!u||l)&&!pe,B=N&&!u&&!l,ye=Pe(x)+(x.length-1)*ae+2*U,Ce=u?"auto":l?ye:(x[m]??0)+2*U,q=_.length<2,ve=r.useCallback((h,C)=>{h===m&&C===ge.ENTER&&setTimeout(()=>{Q(!0)},I)},[m,I]),z=r.useCallback((h,C)=>{v(h),X.count(G.COT_SUMMARIZER,h?"expand":"collapse",[{key:"is_streaming",value:String(t)},{key:"source",value:C}]),A.logEventWithStatsig(h?"CoT Expanded":"CoT Collapsed",h?"chatgpt_cot_expanded":"chatgpt_cot_collapsed",{is_streaming:String(t),source:C})},[t]),we=r.useCallback(()=>{q||z(!0,"chunk")},[z,q]),Me=r.useCallback((h,C)=>{d(D=>{const ee=[...D];return ee[h]=C,ee})},[]);return r.useEffect(()=>{u||m<0||A.logEventWithStatsig(l?"Streamed CoT Chunk Viewed":"Streamed CoT Chunk Ignored",l?"chatgpt_streamed_cot_chunk_viewed":"chatgpt_streamed_cot_chunk_ignored")},[m,u,l,t]),u&&!N?null:a.jsxs(a.Fragment,{children:[a.jsx(St,{}),p&&s&&t&&(!N||B)&&a.jsxs(y.div,{className:"mx-[calc(--spacing(-2)-1px)] mb-6",initial:t&&{translateX:-8,opacity:0},animate:{translateX:0,opacity:1},transition:{ease:"easeInOut",duration:P},children:[a.jsx("div",{className:"text-token-text-primary mb-1",children:a.jsx(b,{id:"xxV+0O",defaultMessage:"I'm working on a well thought out answer for you."})}),a.jsx("button",{className:"text-token-text-tertiary text-sm underline decoration-dotted","aria-label":n.formatMessage({id:"1NrLcB",defaultMessage:"Get a faster, simpler response"}),onClick:o,children:a.jsx(b,{id:"j8Fwy+",defaultMessage:"Get a faster, simpler response"})})]}),a.jsxs("div",{className:"relative my-1 min-h-6",children:[t&&(!N||B)&&a.jsx(y.div,{className:"loading-shimmer text-token-text-secondary absolute top-0 mx-[calc(--spacing(-2)-1px)] select-none",initial:t&&{translateX:-8,opacity:0},animate:{translateX:0,opacity:1},transition:{ease:"easeInOut",duration:P},children:a.jsx(b,{id:"hgnsat",defaultMessage:"Thinking"})}),N&&a.jsxs(y.div,{className:k("relative flex max-w-[calc(0.8*var(--thread-content-max-width,40rem))] origin-top-left flex-col gap-2 overflow-x-clip",B&&"bg-token-main-surface-primary border-token-border-default mx-[calc(--spacing(-2)-1px)] -my-[1px] box-content rounded-2xl border bg-clip-padding px-5 py-4 @max-3xl:-top-2 @3xl:-start-3 @3xl:-top-4"),initial:t&&{opacity:0,scale:.85},animate:{opacity:1,scale:1},transition:{ease:"easeOut",duration:P},children:[a.jsx(Xe,{latestHeadline:F&&E(n,F,u),latestChunk:F,counters:w,onToggleExpanded:()=>z(!l,"header"),isExpanded:l,isExpandDisabled:q,isComplete:u}),a.jsx(te,{children:xe&&a.jsx(y.div,{className:"relative z-0",initial:u?{opacity:0,height:0,overflowY:"hidden"}:!1,animate:{opacity:1,height:Ce},exit:{height:0,opacity:0,pointerEvents:"none",overflowY:"hidden",filter:u?"blur(8px)":void 0,translateY:-24},transition:Mt,children:a.jsx("div",{className:"relative flex h-full flex-col",style:{gap:ae,margin:`${U}px 0`},children:a.jsx(te,{children:$.map(([h,C],D)=>a.jsx(Ct,{index:h,chunk:C,isLast:$.length-1===D,onClick:we,onAnimationComplete:ve,onMeasure:Me,isAnimationComplete:u,isExpanded:l,showBullet:l,isStreaming:t},h))})})})})]})]})]})};function Tt(t){return t?.type===c.Thought?Math.min(3e3,1e3+t.thought.content.length*3.5):1200}function bt(t){return t?.type===c.Thought?500:0}function kt(t,e){const s=r.useRef(null),o=Ie(t),n=r.useCallback(()=>{if(s.current!=null){const i=performance.now()-s.current;X.hist(G.COT_SUMMARIZER,"cot_chunk_display_time",void 0,i)}},[o]);r.useEffect(()=>{if(e){n();return}t!==-1&&(n(),s.current=performance.now())},[t,e,n])}function St(){return a.jsx(y.div,{className:"absolute flex h-8 w-3 origin-center items-center justify-center",initial:{scale:1,opacity:1},animate:{scale:0,opacity:0},transition:{ease:"easeInOut",duration:.2},children:a.jsx("div",{className:"bg-token-text-primary h-3 w-3 rounded-full"})})}export{ts as CoT,jt as CoTChunks};
//# sourceMappingURL=c3bqkytm1o2en7qm.js.map
