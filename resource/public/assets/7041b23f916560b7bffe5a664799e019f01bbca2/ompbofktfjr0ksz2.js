import{f as x,j as n,a6 as E,a5 as T}from"./lip667d8t42poxum.js";import{cv as w,ab as a,aa as v,F as A,c as b,g7 as N,bN as Q}from"./n9zp7vm10xoipejo.js";import{ct as B,cu as F,ad as L,cv as q,cw as D,cx as k,cy as O,cz as P,cA as R,cB as U,cC as I,am as $,aq as H,S as K,cD as W}from"./l4oo5ijw01fyrjzs.js";import{T as h,a as V}from"./ju8q15l0hqy6ti9z.js";import"./ezoyp421dng92ve4.js";import"./krf7zg7fy4qqowqq.js";import"./j385t288u9l3nf6j.js";function Se({messages:e,isRequestActive:t,isLastMessageInTurn:s,isRetrieval:r,isUsingGizmo:l,isUsingSnorlax:o}){const c=le({messages:e}),d=G(e),u=d.filter(m=>se(m,!1)&&!re(m)),f=u[u.length-1]??void 0,i=x();if(ne(e).some(({content:m})=>m.content_type===w.SystemError))return null;let g=h.Running;const j=u.filter(m=>m.type===a.Search).length,M={count:u.length-j,domain:f?k(S(f)??""):void 0,query:f?_(f):void 0};let p=r?l?o?i.formatMessage(O.searchingProjectFiles):i.formatMessage({id:"browsingMessage.searchingKnowledge",defaultMessage:"Searching my knowledge"}):i.formatMessage({id:"browsingMessage.startingRetrieval",defaultMessage:"Reading documents"}):i.formatMessage({id:"message.tools.browse.running",defaultMessage:"Searching the web"});return e.some(P)?(g=h.Stopped,p=r?l?i.formatMessage({id:"browsingMessage.searchingKnowledgeStopped",defaultMessage:"Stopped searching knowledge"}):i.formatMessage({id:"browsingMessage.retrievalStopped",defaultMessage:"Stopped reading documents"}):i.formatMessage({id:"message.tools.browse.stopped",defaultMessage:"Search stopped"})):!s||!t?d.length>0&&d.every(m=>m.didError)?(g=h.Error,p=r?l?i.formatMessage({id:"browsingMessage.searchingKnowledgeFailed",defaultMessage:"Error searching knowledge"}):i.formatMessage({id:"browsingMessage.retrievalFailed",defaultMessage:"Error reading documents"}):i.formatMessage({id:"message.tools.browse.failed",defaultMessage:"Search failed"})):(g=h.Finished,p=r?null:M.count===0?i.formatMessage({id:"message.tools.browse.started",defaultMessage:"Searching the web..."}):i.formatMessage({id:"message.tools.browse.finished",defaultMessage:"Searched {count, plural, =0 {0 sites} one {# site} other {# sites}}"},M)):c.length>0?p=ce({contextualAnswerSources:c,intl:i}):u.length>0&&(p=te(i,M,r,l,u[u.length-1])),(u.length>0||r&&s)&&g!==h.Error?n.jsx(V,{highlightedCommand:p,showWorkUserSetting:!1,status:g,children:u.length===0?null:n.jsx(J,{commands:u})}):n.jsx(oe,{$isError:g===h.Error,children:p})}function y(e){return e.metadata?.command==="quote"||e.metadata?.command==="quote_full"||e.metadata?.command==="quote_lines"}function G(e){return e.map((t,s)=>{if(t.author.role!==v.Tool||s>0&&y(t)&&y(e[s-1]))return null;const r=t.metadata;if(!r)return null;const{command:l,status:o}=r;return l?{type:l,status:o,didError:t.content.content_type===w.SystemError,message:t}:null}).filter(I)}function J({commands:e}){const t=x();return n.jsx("div",{className:"divide-token-border-default border-token-border-default mb-4 divide-y rounded-xl border text-sm",children:n.jsx(E,{initial:!1,children:e.map((s,r)=>{const l=Z(s);if(l==null)return null;const{icon:o,url:c,title:d,externalLink:u}=l,f=c?k(c):void 0,i=d?typeof d=="string"?d:t.formatMessage(d):null,g=c&&$(c);return n.jsx(T.div,{initial:"collapsed",animate:"open",variants:{open:{opacity:1,height:"auto"},collapsed:{opacity:0,height:0}},children:n.jsxs(X,{url:u??c,className:b("flex items-start gap-3 px-4 py-3",d?"text-token-text-secondary":"text-token-text-primary",r===0&&"rounded-t-xl",r===e.length-1&&"rounded-b-xl"),children:[o?n.jsx(o,{className:"icon-sm text-token-text-secondary mt-0.5 shrink-0"}):c?n.jsx(H,{url:c,className:"mt-1"}):null,n.jsxs("div",{children:[i&&n.jsxs("div",{className:"text-token-text-primary line-clamp-1",children:[g&&`${g} — `,i]}),n.jsx("div",{children:f})]})]})},r)})})})}function X({url:e,children:t,className:s}){return e?n.jsxs("a",{href:e,target:"_blank",className:b(s,"group hover:bg-token-main-surface-secondary relative"),rel:"noreferrer",children:[t,n.jsx("div",{className:"from-token-main-surface-secondary invisible absolute end-3 bg-linear-to-l to-transparent ps-4 group-hover:visible",children:n.jsx(W,{className:"icon-md text-token-text-secondary"})})]}):n.jsx("div",{className:s,children:t})}function Y(e){const t=e.message.metadata?._cite_metadata?.metadata_list[0];return t!=null&&t.type!=="file"?t.title:null}function _(e){return e.message.metadata?.args?.[0]}function Z(e){switch(e.type){case a.Search:{const t=e.message.metadata?.search_engine;if(t&&t!==N.Bing)return null;const s=_(e);return{icon:K,url:e.message.metadata?.message_source==="apple"?null:"bing.com",externalLink:ee(e),title:s?`“${s}”`:{id:"message.tools.browse.querying",defaultMessage:"Querying",description:"Status message when issuing a query"}}}case a.Click:case a.MultiClick:case a.Lookup:case a.OpenUrl:case a.Open:case a.Quote:case a.QuoteFull:case a.QuoteLines:case a.Scroll:return{url:S(e),title:Y(e)??void 0};case a.Spinner:case a.Back:return null}}function z(e){const t=new URLSearchParams({query:e.query});return`${Q}/bing/redirect?${t.toString()}`}function ee(e){const t=e.message.metadata?.args?.[0];return t===void 0?null:z({query:t})}function te(e,t,s,r,l){switch(l?.type){case a.Click:case a.MultiClick:case a.Lookup:case a.OpenUrl:case a.Quote:case a.QuoteFull:case a.QuoteLines:case a.Scroll:case a.Open:case a.Back:return e.formatMessage({id:"message.tools.browse.reading",defaultMessage:"Browsing {domain}"},t);case a.Search:case void 0:return s?r?e.formatMessage({id:"browsingMessage.searchingKnowledge",defaultMessage:"Searching my knowledge"}):e.formatMessage({id:"browsingMessage.startingRetrieval",defaultMessage:"Reading documents"}):e.formatMessage({id:"message.tools.browse.searching",defaultMessage:'Searching "{query}"'},t);case a.Spinner:return null}}function ae(e){const t=e.message.metadata?._cite_metadata?.metadata_list[0];return t!=null&&t.type==="file"?t.name:null}function se(e,t){switch(e.type){case a.Search:return!0;case a.Click:case a.Lookup:case a.MultiClick:case a.OpenUrl:case a.Quote:case a.QuoteFull:case a.QuoteLines:return t?ae(e)!=null:S(e)!=null;case a.Open:case a.Back:case a.Scroll:case a.Spinner:return!1}}function re(e){return e.message.metadata?.message_source==="apple"}function S(e){const t=e.message.metadata?._cite_metadata?.metadata_list[0];return t!=null&&t.type!=="file"?t.url:null}function ne(e){return e.filter(t=>t.author.role===v.Tool)}const oe=A.p`first:mt-0 my-1.5 h-8 flex items-center ltr:me-auto rtl:ms-auto empty:hidden
${({$isError:e})=>e?"text-token-text-error":"text-token-text-secondary"}`,C={google_drive:"Google Drive",slack:"Slack",github:"GitHub",slurm_sharepoint:"SharePoint",slurm_linear:"Linear"},ie={google_drive:D,slack:q,github:L,slurm_sharepoint:F,slurm_linear:B},le=({messages:e})=>[...e.filter(R).reduce((r,l)=>(l.metadata?.retrieval_search_sources?.forEach(o=>{(o.product_type==="contextual_answers"||o.product_type==="slurm")&&o.source_name in C&&r.add(o.source_name)}),r),new Set)],ce=({contextualAnswerSources:e,intl:t})=>{const s=e.map(o=>C[o]??o).filter(Boolean),r=e.map(o=>{const c=ie[o]??U;return n.jsx(c,{className:"icon-sm"},o)}).filter(Boolean),l=e.length===1?t.formatMessage({id:"Jzt2om",defaultMessage:"Reading {source}"},{source:s[0]}):e.length===2?t.formatMessage({id:"wTM7gR",defaultMessage:"Reading {source1} and {source2}"},{source1:s[0],source2:s[1]}):t.formatMessage({id:"xnwjH1",defaultMessage:"Reading {source1}, {source2} and more"},{source1:s[0],source2:s[1]});return e.length>0?n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"flex items-center gap-1",children:r}),l]}):void 0};export{Se as BrowsingMessage,ie as CA_SOURCE_TO_ICON_MAP,C as CA_SOURCE_TO_TEXT_MAP,le as getCASources,ce as getContextualAnswerDisplayText,S as getVisitedUrl};
//# sourceMappingURL=ompbofktfjr0ksz2.js.map
