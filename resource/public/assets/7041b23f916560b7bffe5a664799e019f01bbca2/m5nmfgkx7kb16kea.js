const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/onp1l9h8khb0d7bu.js","assets/lip667d8t42poxum.js","assets/l4oo5ijw01fyrjzs.js","assets/n9zp7vm10xoipejo.js","assets/root-ivmjnum3.css","assets/conversation-small-k5k9c71c.css","assets/je7skc27bd88wsxc.js","assets/kh2oujy0lnfc0doj.js","assets/l8tekopyvbe78zjf.js","assets/d61ttkht2554hc14.js","assets/nmzcjggnos81a3wt.js","assets/ezoyp421dng92ve4.js","assets/krf7zg7fy4qqowqq.js","assets/j385t288u9l3nf6j.js","assets/kdkl0k5zipatley9.js"])))=>i.map(i=>d[i]);
import{r as f,d as xn,j as e,g as Fe,f as K,L as ml,M as E,a5 as Z,o as pl,ag as fl,a6 as mt,p as gl,D as hl}from"./lip667d8t42poxum.js";import{d as Mt}from"./nmzcjggnos81a3wt.js";import{ok as At,W as fe,bL as Ua,kJ as Sn,eV as Ga,gZ as ys,n1 as za,t5 as bn,tZ as Wa,c0 as lt,hp as xl,dz as Sl,Q as vs,ho as bl,t_ as Cl,bi as yl,ff as vl,eX as wl,t$ as zt,u0 as Ye,V as Wt,u1 as Cn,u2 as Se,u3 as _l,u4 as jl,an as Vt,u5 as ct,u6 as kl,fG as yn,ew as H,i3 as ra,c6 as qt,u7 as Va,u8 as Rl,d8 as ut,d as on,u9 as vn,ua as ws,ub as qa,fA as Al,eT as wn,eQ as Ya,eR as _n,eS as jn,is as kn,uc as Ka,g8 as $a,fQ as Ml,cm as Rn,ro as El,ud as Pl,ue as Qa,rw as Tl,g6 as Xa,uf as Nl,ge as Bl,ug as la,uh as Il,ui as Ol,uj as Dl,hD as Ll,uk as Fl,ul as Hl,um as Ul,k1 as _s,de as js,M as An,un as Gl,uo as ps,p8 as zl,qD as Wl,b8 as Le,aZ as pe,a_ as Mn,al as Vl,up as Ja,pj as ql,uq as Yl,ur as Kl,us as $l,im as De,bI as Ht,d7 as En,ut as Ql,uu as Xl,uv as Jl,iq as fs,lx as Za,uw as Zl,ux as ec,uy as tc,fz as sc,uz as ei,ph as ks,ip as nc,uA as oc,mp as be,uB as ac,uC as ic,uD as rc,uE as lc,uF as _t,uG as ti,uH as cc,uI as uc,uJ as dc,E as an,i8 as ee,fP as mc,dd as pc,uK as fc,uL as gc,uM as hc,uN as xc,uO as Sc,kv as Qs,uP as ca,uQ as bc,uR as Cc,uS as yc,uT as vc,uU as wc,uV as _c,s_ as Xs,B as Pn,bA as si,bB as ni,pJ as jc,jo as kc,jr as Rc,uW as Ac,f5 as Mc,uX as Ec,R as Ce,uY as Pc,r9 as Ut,uZ as Tc,n0 as Nc,u_ as Bc,u$ as B,v0 as oi,v1 as Ic,v2 as Oc,v3 as Dc,v4 as Lc,v5 as Fc,v6 as Hc,v7 as Uc,v8 as Gc,v9 as zc,va as Wc,vb as Vc,vc as qc,vd as Yc,ve as Kc,vf as $c,vg as Qc,vh as Xc,vi as Jc,vj as Zc,vk as eu,vl as tu,hH as su,vm as nu,vn as ou,vo as au,vp as iu,vq as ru,vr as lu,vs as cu,vt as uu,vu as du,vv as mu,vw as pu,vx as fu,vy as gu,vz as hu,vA as xu,vB as Su,vC as bu,vD as Cu,hZ as ai,vE as yu,vF as vu,vG as wu,lz as _u,lA as ii,ly as jt,eJ as ju,ns as ua,dc as Tn,o_ as ri,dh as ms,di as ku,vH as Nn,vI as Bn,vJ as Ru,dj as it,vK as gs,pb as rn,fp as In,df as On,dg as Dn,eb as Ln,nr as Fn,ec as Hn,nt as Au,jO as Mu,pn as li,io as He,vL as Eu,vM as Pu,qa as Tu,f as Nu,g0 as Un,ia as Gt,vN as Bu,vO as Iu,vP as hs,jg as Ou,vQ as ci,vR as ui,vS as di,vT as mi,vU as Lt,lB as Du,vV as Lu,nd as xs,nc as pi,vW as Fu,vX as Hu,vY as Uu,vZ as Gu,v_ as zu,v$ as Wu,db as Gn,A as zn,jd as fi,w0 as ln,w1 as Vu,fE as qu,a2 as Yu,w2 as Ss,fF as gi,w3 as hi,fH as Ku,w4 as xi,fI as $u,ir as Qu,kR as Wn,kT as Vn,kQ as Xu,qy as Si,w5 as cn,w6 as Ju,eM as bi,aF as Zu,w7 as ed,w8 as da,g5 as td,oT as qn,w9 as Ci,wa as yi,fO as sd,kS as nd,wb as od,wc as ad,wd as id,we as ma,wf as rd,wg as vi,wh as ld,wi as cd,wj as ud,gY as wi,wk as _i,wl as ji,wm as dd,pa as md,wn as un,wo as pd,j9 as pa,e as fd,fn as gd,fq as hd,X as xd,cW as Sd,wp as bd,wq as Cd,qS as yd,wr as vd,ws as wd,wt as _d,wu as jd,wv as kd,lT as Rd,ww as fa,le as Ad,lO as Md,wx as Js,wy as Ed,mu as Pd,wz as Td,wA as Nd,wB as Bd,lW as Id,wC as Od,wD as Dd,cy as Ld,wE as Fd,y as Hd,U as ga,fN as Ud,mF as Gd,mK as zd,aG as Wd,wF as Vd,wG as qd,wH as Yd,wI as Kd,wJ as $d,fD as Qd,wK as ha,wL as xa,wM as Sa,mC as Xd,wN as Jd,wO as Zd,wP as em,wQ as tm,wR as sm,wS as nm,ee as om,oY as am,kY as ba,wT as im,ol as ki,k7 as rm,wU as lm,wV as cm,O as Ri,ke as um,wW as dm,wX as mm,iE as pm,pl as fm,wY as gm,wZ as hm,iT as xm,oX as Sm,jQ as bm,nB as Zs,nC as en,jP as Cm}from"./l4oo5ijw01fyrjzs.js";import{ao as Et,hv as Ai,af as le,g as Ue,s as dt,as as Te,cV as kt,aI as Ke,aj as T,gU as te,ag as se,aX as Pe,hc as Mi,cj as Ei,aJ as A,ae,hw as Pi,gs as dn,W as Yt,c as q,F as Yn,fr as Kt,hx as Kn,dZ as Ti,m as $e,b as Ca,q as J,r as ya,aY as ym,fs as $n,c1 as Ni,aL as Oe,fh as vm,e4 as bs,cc as wm,d9 as Bi,bQ as $t,fX as _m,aO as jm,B as km,bV as Rm,dQ as Ii,hy as Oi,aV as rt,hz as Am,cz as va,b1 as Mm,fj as Di,dg as Li,aC as Em,aE as Rt,b8 as Pm,X as Qn,_ as Xn,aH as tn,u as mn,aa as Fi,cl as Tm,hA as Rs,e3 as Hi,dj as Ui,ca as Nm,hB as Bm,b3 as Im,n as wa,am as qe,hC as _a,f7 as Jn,x as Om,E as Dm,b2 as Lm,ah as Gi,eJ as Fm,c2 as Hm,e as Um,bC as Gm,gE as Zn,bU as zm,gR as Wm,eC as Vm,b9 as Ft,bb as ja,hD as qm,hE as Ym,hF as Km,dJ as $m,dK as Qm,at as Xm,c4 as Jm,c5 as Zm,cU as ka,ga as ep,gb as tp,eU as sp,hG as np}from"./n9zp7vm10xoipejo.js";import{P as op,u as ap}from"./frsgt7dup0f3mfs8.js";import{u as ip}from"./jrbfupmnwi0b2in6.js";import{u as rp}from"./czpmep8a1gn2yxp9.js";import{C as As,c as lp,A as cp,d as zi}from"./g1x7jf9g2b4osi6b.js";import{G as Wi}from"./oour34cwuwf9tyoh.js";import{e as Vi,c as qi,b as eo,f as up}from"./n7emuv1efbtdnxb9.js";import{b as Yi}from"./ef49rx2y546x1g51.js";import{P as to,B as Ki,C as so,F as $i,g as dp,V as mp,a as pp,b as no,T as fp}from"./h5ge3c3mruoe76ro.js";import{G as gp}from"./cbaql59zac1mfnmh.js";import{e as hp,f as xp,h as us,i as Sp,P as bp,j as Cp}from"./ezoyp421dng92ve4.js";import{u as oo}from"./dih8dferf1paqxo1.js";import{u as Qi,a as yp,I as vp,R as wp,b as Ra,C as _p,H as Aa,B as jp,F as Ma,c as kp,T as Rp,S as Ap,d as Ea,e as Mp}from"./d61ttkht2554hc14.js";import"./g1wxldf6nb3zk37x.js";const Ep=({clientThreadId:t,rateLimitInfo:s,onDismiss:n,onInteract:o,onMount:a})=>{const{name:r,title:i,call_to_action:u,description:l}=s,d=Et(),m=At(!0),{updateSystemHint:c}=fe(),p=Mt(),S=At(!1),h=Ai(),g=le(t,se.getIsNewConversation),x=d?.planType??"unknown",v=Ue(),y=dt(v,"3809605125"),_=h&&"block_reason"in h?h.block_reason:null,P="banner_description",R=f.useMemo(()=>({type:r||"unknown",location:P,plan_type:x,is_new_conversation:g,is_hard_block:!!h,hard_block_reason:_??"",call_to_action:u}),[r,P,x,g,h,_,u]),M=xn(),w=Ua(),{isUnauthenticated:j}=Te(),N=Sn(),D=Ga(kt.signUpButtonText),L=ys(),z=za({clientThreadId:t}),{layer:b}=Ke("1368081792"),I=Y=>{switch(Y){case te.AUTHENTICATE:return{text:N?kt.logInButtonText:D,onClick:()=>{w({authType:N?"login":"signup",callback:F=>{N?T.logLogInButtonClicked({location:`Rate limit banner - ${r}`,provider:F}):T.logSignUpButtonClicked({location:`Rate limit banner - ${r}`,provider:F})}})}};case te.AUTHENTICATE_SECONDARY:return{text:N?D:kt.logInButtonText,onClick:()=>{w({authType:N?"signup":"login",callback:F=>{N?T.logSignUpButtonClicked({location:`Rate limit banner - ${r}`,provider:F}):T.logLogInButtonClicked({location:`Rate limit banner - ${r}`,provider:F})}})}};case te.GET_PLUS:return{text:at.getPlusButton,onClick:()=>{T.logRateLimitGetPlusButtonClicked(R),j?w({authType:N?"login":"signup",shouldOpenPaymentModalOnAuth:!0,callback:F=>{N?T.logLogInButtonClicked({location:"Rate limit banner Get Plus upsell",provider:F}):T.logSignUpButtonClicked({location:"Rate limit banner Get Plus upsell",provider:F})}}):lt(M,"Prompt textarea rate limit banner")}};case te.NEW_CHAT:return{text:at.newChatButton,onClick:()=>{m({modelId:"",location:P})}};case te.PAID_USER_O3_MINI_HIGH:{const F=se.getCurrentLeafId(Pe(t)),Q=()=>{T.logEventWithStatsig("In Context Upsell Banner O3 Mini High CTA Clicked","chatgpt_in_context_upsell_banner_o3_mini_high_cta_clicked",{location:b.get("should_change_model_picker",!0)?"In-context upsell o3-mini-high for Plus banner - Try it button":"In-context upsell o3-mini-high for Plus (no model switch) banner - Try it button",eventProperties:R}),b.get("should_change_model_picker",!0)&&S(y?{modelId:"o4-mini-high",location:"In-context upsell o4-mini-high for Plus banner - Try it button"}:{modelId:"o3-mini-high",location:"In-context upsell o3-mini-high for Plus banner - Try it button"}),z(y?{sourceEvent:new Event("click"),nodeId:F,requestedModelId:"o4-mini-high"}:{sourceEvent:new Event("click"),nodeId:F,requestedModelId:"o3-mini-high"})};return{text:at.tryItButton,onClick:Q}}case te.FREE_USER_O3_MINI_HIGH:return{text:at.getPlusButton,onClick:()=>{T.logEventWithStatsig("In Context Upsell Banner O3 Mini High CTA Clicked","chatgpt_in_context_upsell_banner_o3_mini_high_cta_clicked",{location:"In-context upsell o3-mini-high for Free banner - Get Plus button",eventProperties:R}),lt(M,"Prompt textarea in-context upsell banner")}};case te.DEEP_RESEARCH_IN_CONTEXT_UPSELL:{const F=se.findNode(Pe(t),ie=>Mi(ie.message)),Q=F?Ei(F.message):void 0;return{text:at.tryItButton,onClick:()=>{T.logEventWithStatsig("In Context Upsell Banner Deep Research CTA Clicked","chatgpt_in_context_upsell_banner_deep_research_cta_clicked",{location:"In-context upsell deep research - Try it button",eventProperties:R}),c(A.Research,{clientThreadId:t}),p.focus(),p.setText(Q??"")}}}case"get_pro":return{text:at.getProButton,onClick:()=>{T.logRateLimitUpgradePlanButtonClicked({...R,upgrade_plan_tye:"pro"}),j?w({authType:N?"login":"signup",shouldOpenPaymentModalOnAuth:!0,callback:F=>{N?T.logLogInButtonClicked({location:"Rate limit banner Get Pro upsell",provider:F}):T.logSignUpButtonClicked({location:"Rate limit banner Get Pro upsell",provider:F})}}):lt(M,"Prompt textarea rate limit banner")}};case te.TRY_CODEX:return{text:at.tryCodexButton,onClick:()=>{T.logEventWithStatsig("In Context Upsell Banner Codex CTA Clicked","chatgpt_in_context_upsell_banner_codex_cta_clicked",{location:"In-context upsell codex - Try Codex button",eventProperties:R}),M("/codex")}}}};bn(()=>{!b.get("should_change_model_picker",!0)&&R.type==="o3-mini-high-in-context-upsell-plus"&&(R.type="o3-mini-high-in-context-upsell-plus-no-model-switch"),T.logRateLimitBannerShown(R),a?.()});const[G,W]=u??[];let k=W;G===te.AUTHENTICATE&&L&&(k=te.AUTHENTICATE_SECONDARY);const U={primaryAction:I(G),secondaryAction:I(k)};return e.jsx(Wa,{onDismiss:n,title:i,description:l,actions:U,onInteract:o})},at=Fe({getPlusButton:{id:"TeyLcp",defaultMessage:"Get Plus"},getProButton:{id:"Pl8/Vk",defaultMessage:"Get Pro"},newChatButton:{id:"7OvnJ5",defaultMessage:"New chat"},tryItButton:{id:"zPDzun",defaultMessage:"Try it"},tryCodexButton:{id:"KcWniZ",defaultMessage:"Try Codex"}}),Pp=({clientThreadId:t,rateLimitInfo:s,onDismiss:n,onInteract:o,onMount:a})=>{const{name:r,title:i,call_to_action:u,description:l}=s,d=Et(),m=At(!0),{updateSystemHint:c}=fe(),p=Mt(),S=At(!1),h=Ai(),g=le(t,se.getIsNewConversation),x=d?.planType??"unknown",v=ys(),y=Ue(),_=dt(y,"3809605125"),P=h&&"block_reason"in h?h.block_reason:null,R="banner_description",M=f.useMemo(()=>({type:r||"unknown",location:R,plan_type:x,is_new_conversation:g,is_hard_block:!!h,hard_block_reason:P??"",call_to_action:u}),[r,R,x,g,h,P,u]),w=xn(),j=Ua(),{isUnauthenticated:N}=Te(),D=Sn(),L=Ga(kt.signUpButtonText),z=za({clientThreadId:t}),{layer:b}=Ke("1368081792"),I=Y=>{switch(Y){case te.AUTHENTICATE:return{text:D?kt.logInButtonText:L,onClick:()=>{j({authType:D?"login":"signup",callback:F=>{D?T.logLogInButtonClicked({location:`Rate limit banner - ${r}`,provider:F}):T.logSignUpButtonClicked({location:`Rate limit banner - ${r}`,provider:F})}})}};case te.AUTHENTICATE_SECONDARY:return{text:D?L:kt.logInButtonText,onClick:()=>{j({authType:D?"signup":"login",callback:F=>{D?T.logSignUpButtonClicked({location:`Rate limit banner - ${r}`,provider:F}):T.logLogInButtonClicked({location:`Rate limit banner - ${r}`,provider:F})}})}};case te.GET_PLUS:return{text:wt.getPlusButton,onClick:()=>{T.logRateLimitGetPlusButtonClicked(M),N?j({authType:D?"login":"signup",shouldOpenPaymentModalOnAuth:!0,callback:F=>{D?T.logLogInButtonClicked({location:"Rate limit banner Get Plus upsell",provider:F}):T.logSignUpButtonClicked({location:"Rate limit banner Get Plus upsell",provider:F})}}):lt(w,"Prompt textarea rate limit banner")}};case te.NEW_CHAT:return{text:wt.newChatButton,onClick:()=>{m({modelId:"",location:R})}};case te.PAID_USER_O3_MINI_HIGH:{const F=se.getCurrentLeafId(Pe(t)),Q=()=>{T.logEventWithStatsig("In Context Upsell Banner O3 Mini High CTA Clicked","chatgpt_in_context_upsell_banner_o3_mini_high_cta_clicked",{location:b.get("should_change_model_picker",!0)?"In-context upsell o3-mini-high for Plus banner - Try it button":"In-context upsell o3-mini-high for Plus (no model switch) banner - Try it button",eventProperties:M}),b.get("should_change_model_picker",!0)&&S(_?{modelId:"o4-mini-high",location:"In-context upsell o4-mini-high for Plus banner - Try it button"}:{modelId:"o3-mini-high",location:"In-context upsell o3-mini-high for Plus banner - Try it button"}),z(_?{sourceEvent:new Event("click"),nodeId:F,requestedModelId:"o4-mini-high"}:{sourceEvent:new Event("click"),nodeId:F,requestedModelId:"o3-mini-high"})};return{text:wt.tryItButton,onClick:Q}}case te.FREE_USER_O3_MINI_HIGH:return{text:wt.getPlusButton,onClick:()=>{T.logEventWithStatsig("In Context Upsell Banner O3 Mini High CTA Clicked","chatgpt_in_context_upsell_banner_o3_mini_high_cta_clicked",{location:"In-context upsell o3-mini-high for Free banner - Get Plus button",eventProperties:M}),lt(w,"Prompt textarea in-context upsell banner")}};case te.DEEP_RESEARCH_IN_CONTEXT_UPSELL:{const F=se.findNode(Pe(t),ie=>Mi(ie.message)),Q=F?Ei(F.message):void 0;return{text:wt.tryItButton,onClick:()=>{T.logEventWithStatsig("In Context Upsell Banner Deep Research CTA Clicked","chatgpt_in_context_upsell_banner_deep_research_cta_clicked",{location:"In-context upsell deep research - Try it button",eventProperties:M}),c(A.Research,{clientThreadId:t}),p.focus(),p.setText(Q??"")}}}case te.TRY_CODEX:return{text:wt.tryCodexButton,onClick:()=>{T.logEventWithStatsig("In Context Upsell Banner Codex CTA Clicked","chatgpt_in_context_upsell_banner_codex_cta_clicked",{location:"In-context upsell codex - Try Codex button",eventProperties:M}),w("/codex")}}}};bn(()=>{!b.get("should_change_model_picker",!0)&&M.type==="o3-mini-high-in-context-upsell-plus"&&(M.type="o3-mini-high-in-context-upsell-plus-no-model-switch"),T.logRateLimitBannerShown(M),a?.()}),f.useEffect(()=>()=>{T.logEventWithStatsig("Rate Limit: Dismiss Banner","chatgpt_rate_limit_banner_dismissed",M)},[M]);const[G,W]=u??[];let k=W;G===te.AUTHENTICATE&&v&&(k=te.AUTHENTICATE_SECONDARY);const U={primaryAction:I(G),secondaryAction:I(k)};return e.jsx(Wa,{onDismiss:n,title:i,description:l,actions:U,onInteract:o})},wt=Fe({getPlusButton:{id:"TeyLcp",defaultMessage:"Get Plus"},newChatButton:{id:"7OvnJ5",defaultMessage:"New chat"},tryItButton:{id:"zPDzun",defaultMessage:"Try it"},tryCodexButton:{id:"KcWniZ",defaultMessage:"Try Codex"}}),Xi=t=>{const{value:s}=ae("1028682714");return s?e.jsx(Ep,{...t}):e.jsx(Pp,{...t})},Ji=Yn.div`group flex h-10 items-center gap-2 rounded-lg px-2 hover:bg-token-main-surface-secondary text-sm text-token-text-primary`;function Tp(){const{data:t,isLoading:s}=bl({cutId:"recent",limit:8}),{data:n,isLoading:o}=Cl();return{isLoading:s||o,recent:t,pinned:n}}function Np({query:t,onSelectGizmo:s,selectedIdx:n},o){const a=xl(),r=f.useRef([]),{isLoading:i,recent:u,pinned:l}=Tp();f.useImperativeHandle(o,()=>({handleEnterOnIndex:c=>{if(!m[c])return c<d.length?d[c].resource:"create"},getResultsLength:()=>d.length+1,scrollToItem:c=>{const p=r.current[c];p&&p.scrollIntoView({behavior:"instant",block:"nearest"})}}));let d=[];if(i)return e.jsx("div",{className:"absolute end-4 top-0 flex h-full items-center justify-center",children:e.jsx(Yt,{})});u&&d.push(...u.pages.flatMap(c=>c.list.items).map(c=>({resource:c.resource,from:"recent"}))),l&&d.push(...l.items.map(c=>({resource:c,from:"pinned"}))),d=Sl(d,c=>c.resource.gizmo.id);const m=d.map(c=>c.resource.gizmo.tags?.includes(vs.WorkspaceDisabled));return t&&t!==""&&(d=d.filter(c=>(c.resource.gizmo.display.name.toLowerCase()+c.resource.gizmo.display.description?.toLowerCase()+c.resource.gizmo.author.display_name?.toLowerCase()).includes(t?.toLowerCase()))),e.jsxs("div",{className:"max-h-40 overflow-y-auto",children:[d.map((c,p)=>e.jsx("div",{ref:S=>{r.current[p]=S},tabIndex:p,onClick:()=>{m[p]||s(c.resource)},children:e.jsx(Dp,{gizmoResource:c.resource,from:c.from,showDescription:a,isSelected:n===p,grayedOut:m[p]})},c.resource.gizmo.id)),e.jsx("div",{ref:c=>{r.current[d.length]=c},tabIndex:d.length,onClick:()=>{s("create")},children:e.jsx(Ip,{isSelected:n===d.length})},"create")]})}const Bp=f.forwardRef(Np),Ip=({isSelected:t})=>e.jsx(Ji,{className:t?"bg-token-main-surface-secondary":"",children:e.jsxs(ml,{to:"/gpts/editor",target:"_blank",className:"flex flex-row space-x-2 font-semibold",children:[e.jsx("span",{className:"self-center",children:e.jsx(wl,{className:"icon-sm"})}),e.jsx("span",{children:e.jsx(E,{...Zi.dropdownCreateLabel})})]})}),Op=({onClick:t,onClose:s})=>{const[n,o]=f.useState(null),a=f.useRef(null),r=f.useRef(null),[i,u]=f.useState(0),l=K(),d=m=>{T.logEvent("Mentions Click Gizmo",{gizmo_id:m==="create"?"create":m.gizmo.id}),m!=="create"&&t(m)};return e.jsxs(e.Fragment,{children:[e.jsx("input",{autoFocus:!0,placeholder:l.formatMessage(Zi.searchPlaceholder),ref:a,onKeyDown:m=>{if(m.nativeEvent.isComposing)return;const c=r.current?.getResultsLength()??0;if((m.key==="Escape"||m.key==="Backspace"&&!n)&&(m.preventDefault(),s()),m.key==="Enter"||m.key==="Tab"){m.preventDefault();const p=r.current?.handleEnterOnIndex(i);if(!p)return;p==="create"?(window.open("/gpts/editor","_blank"),s()):d(p)}if(m.key==="ArrowDown"&&i<c-1){m.preventDefault();const p=i+1;r.current?.scrollToItem(p),u(p)}if(m.key==="ArrowUp"&&i>0){m.preventDefault();const p=i-1;r.current?.scrollToItem(p),u(p)}},onChange:m=>{o(m.target.value),u(0)},className:"bg-token-main-surface-primary w-full border-0 p-2 text-sm focus:outline-hidden"}),e.jsx(Bp,{ref:r,query:n,selectedIdx:i,onSelectGizmo:d})]})},Pa=({onClick:t,onClose:s})=>{const n=Pi(),o=!!n;return bn(()=>{T.logEvent("Mentions Opened",{gizmo_selector_disabled:o})}),o?e.jsx(Xi,{clientThreadId:dn,rateLimitInfo:n}):e.jsx("div",{onBlur:a=>{a.currentTarget.contains(a.relatedTarget)||s()},className:"popover border-token-border-default bg-token-main-surface-primary rounded-2xl border p-2 shadow-lg",children:e.jsx(Op,{onClick:t,onClose:s})})};function Dp({gizmoResource:t,from:s,showDescription:n,isSelected:o,grayedOut:a}){const r=!!t.gizmo.tags?.includes(vs.FirstParty);return e.jsxs(Ji,{className:q(o?"bg-token-main-surface-secondary":"",a&&"opacity-50"),children:[e.jsx(Wi,{isFirstParty:r,src:t.gizmo.display.profile_picture_url,className:q("icon-xl h-7 w-7 shrink-0",a&&"grayscale group-hover:grayscale-0")}),e.jsxs("div",{className:"flex h-fit grow flex-row justify-between space-x-2 overflow-hidden text-ellipsis whitespace-nowrap",children:[e.jsxs("div",{className:"flex flex-row space-x-2",children:[e.jsx("span",{className:"shrink-0 truncate font-semibold",children:t.gizmo.display.name}),n&&e.jsx("span",{className:"text-token-text-tertiary grow truncate text-sm sm:max-w-xs lg:max-w-md",children:t.gizmo.display.description})]}),e.jsx("span",{className:"shrink-0 self-center",children:s==="recent"?e.jsx(yl,{className:"icon-sm"}):e.jsx(vl,{className:"icon-sm"})})]})]})}const Zi=Fe({talkingTo:{id:"TaggingDropdown.talkingTo",defaultMessage:"Talking to"},dropdownCreateLabel:{id:"TaggingDropdown.dropdownCreateLabel",defaultMessage:"Create a GPT"},searchPlaceholder:{id:"TaggingDropdown.searchPlaceholder",defaultMessage:"Search recent and pinned GPTs"}});function Lp({systemHint:t,label:s,logo:n,isDisabled:o=!1,composerController:a,analyticsMetadata:r,onClick:i,showLabel:u=!1,splitButtonDropdownContent:l,showSplitButton:d,dropdownContent:m,dataTestid:c,tooltip:p,as:S}){const{name:h,systemHint:g}=t,x=g,{setThreadSystemHintMode:v,clearAllSystemHintModeTriggers:y}=fe(),_=zt(x),P=!!t.composerBarButtonInfo?.upsell,R=Ye.useStore(),{value:M}=ae("2454940646"),w=Wt(),j=[A.Search,A.Think].includes(x);f.useEffect(()=>{o&&w.has(x)&&v(x,!1,r)},[o,x,r,v,w,j]);const N=f.useCallback(z=>{z.stopPropagation(),z.preventDefault();let b=!0;M&&j&&(R.getState().persistedSystemHints.has(A.Search)||R.getState().persistedSystemHints.has(A.Think))&&(b=!1),b&&y(),v(x,!_,r),_||(a.removeSystemHints(),a.focus()),Cn(x,_?Se.Disable:Se.Enable,r.clientThreadId),i?.(z)},[r,M,y,a,x,j,_,i,v,R]),D=P?e.jsx("div",{className:"py-2",children:e.jsx(yn,{location:x,statsig_login_event:"chatgpt_composer_upsell_login_button_clicked",statsig_signup_event:"chatgpt_composer_upsell_signup_button_clicked",containerNoPadding:!0})}):null;return e.jsx(As,{pressed:_,disabled:o,icon:n,label:s,ariaLabel:h,animatedLabel:!u,showLabel:u||_,onClick:N,dropdownContent:m??D,splitButtonDropdownContent:l,showSplitButton:d,dataTestid:c,tooltip:p,as:S})}function Fp({composerController:t,systemHint:s,composerBarButtonInfo:n,isDisabled:o,clientThreadId:a,showLabel:r,labelOverride:i,disabledReason:u,rateLimitProgress:l,dropdownContent:d,splitButtonDropdownContent:m,showSplitButton:c,logoOverride:p,dataTestid:S,tooltipPosition:h,disableNuxMarkdown:g,as:x}){const v={clientThreadId:a},y=_=>e.jsx(Hp,{composerBarButtonInfo:n,isDisabled:o,analyticsMetadata:v,systemHint:s.systemHint,disabledReason:u,rateLimitProgress:l,tooltipPosition:h,disableNuxMarkdown:g,children:_});return e.jsx(Lp,{isDisabled:o,systemHint:s,label:i??s.name,logo:p??e.jsx(Kt,{svgString:s.logo,className:"h-[18px] w-[18px]"}),composerController:t,analyticsMetadata:v,showLabel:r,dropdownContent:d,splitButtonDropdownContent:m,showSplitButton:c,dataTestid:S,tooltip:y,as:x})}function Hp({children:t,isDisabled:s,systemHint:n,composerBarButtonInfo:o,analyticsMetadata:a,disabledReason:r,rateLimitProgress:i,tooltipPosition:u="bottom",disableNuxMarkdown:l}){const d=_l(o.announcementKey,n),m=jl({composerBarButtonInfo:o,children:t,disableMarkDown:l}),c=K();let p=null;return i&&i.remaining?p=e.jsx(er,{remaining:i.remaining,reset_date:i.reset_after,text:o.tooltipText}):o.tooltipText&&(p=e.jsx(ao,{text:o.tooltipText})),d?m:e.jsx("div",{children:e.jsx(Vt,{label:s?r===ct.HasAttachedFiles?c.formatMessage({id:"hhxO6y",defaultMessage:"Reason disabled for attachments"}):r===ct.DeepResearchHighLoad?c.formatMessage({id:"UrDtrS",defaultMessage:"Deep research is temporarily unavailable"}):r===ct.RateLimitReached?o.rateLimitReachedText:o.disabledText:p,side:u,onOpenChange:S=>{S&&Cn(n,Se.Hover,a.clientThreadId)},children:t})})}const ao=({text:t})=>e.jsx("span",{children:t}),er=({remaining:t,reset_date:s,text:n})=>{const{locale:o}=K(),a=kl(s,o);return e.jsxs("div",{className:"text-start",children:[e.jsx("span",{className:"text-token-text-tertiary block text-xs font-semibold",children:e.jsx(E,{id:"PromptTextarea.systemHintTooltip.remaining",defaultMessage:"{remaining} available until {resetDate}",values:{remaining:t,resetDate:a}})}),e.jsx(ao,{text:n})]})};function Up({children:t,isDisabled:s,disabledReason:n,logEvent:o}){const a=K(),r=Kn(),i=Ti(m=>m.bySystemHint(A.Research)),u=a.formatMessage({id:"SpX/tG",defaultMessage:"Get a detailed report"});let l=null;i&&i.remaining?l=e.jsx(er,{remaining:i.remaining,reset_date:i.reset_after,text:u}):l=e.jsx(ao,{text:u});const d=n===ct.DeepResearchHighLoad?a.formatMessage({id:"UrDtrS",defaultMessage:"Deep research is temporarily unavailable"}):n===ct.RateLimitReached&&r?a.formatMessage({id:"T3aUKM",defaultMessage:"More available {time}"},{time:r.resets_after_text}):void 0;return e.jsx(Vt,{className:"inline-block",label:s?d:l,side:"bottom",onOpenChange:m=>{m&&o(Se.Hover)},children:t})}const Gp=({items:t,searchTerm:s,setSearchTerm:n,selectedItems:o,searchPlaceholder:a,handleSelectItem:r,showSelectAllRepos:i,loading:u,endReposRef:l})=>{const d=Rl(),m=i&&o?.includes("$all_accessible_repos");return e.jsx(Z.div,{variants:d,initial:"initial",animate:"animate",exit:"exit",className:"relative",children:e.jsxs("div",{className:"border-token-border-default bg-token-main-surface-primary flex max-h-60 w-full flex-col gap-2 overflow-y-auto rounded-lg border p-4",children:[e.jsx("input",{type:"text",value:s,onChange:c=>n(c.target.value),placeholder:a,className:"text-token-text-primary bg-token-main-surface-primary border-token-border-default w-full rounded-sm border-1 px-2 py-1 text-sm focus:ring-0 focus:ring-offset-0 focus:outline-hidden"}),t?.map(c=>{const p=o?.includes(c.name);return e.jsx(ut,{onClick:()=>{r(c)},isSelected:p,label:c.name,subtitle:c.description??void 0,className:"mx-0! w-full",selectedIconClassName:"color:black dark:color-gray"},c.name)}),u&&e.jsxs("div",{className:"text-token-text-secondary flex items-center justify-center gap-2 text-xs",children:[e.jsx(Yt,{}),e.jsx(E,{id:"M1WgQ2",defaultMessage:"Searching..."})]}),i&&e.jsx(ut,{onClick:()=>{r({name:"$all_accessible_repos"})},className:"mx-0! w-full",isSelected:m,label:e.jsx(E,{id:"pJnTxe",defaultMessage:"All Repositories"}),subtitle:e.jsx(E,{id:"EhTGqu",defaultMessage:"Select all repositories accessible to ChatGPT"}),selectedIconClassName:"color:black"},"select-all-repos"),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-token-border-primary border-token-border-default mt-2 mb-2 border-b"}),e.jsx(ut,{onClick:()=>{window.open(Va,"_blank")},isSelected:!1,isActive:!1,label:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(E,{id:"ICVOEb",defaultMessage:"Configure Repositories"})}),subtitle:e.jsx(E,{id:"GXUcp/",defaultMessage:"Configure which repositories ChatGPT can access"}),className:"mx-0! w-full",infoIcon:e.jsx(qt,{className:"icon-sm"}),infoLink:"https://help.openai.com/en/articles/11145903-chatgpt-connectors "},"configure-repos")]}),e.jsx("div",{className:"border-token-border-default my-2 border-t",ref:l}),e.jsx("div",{className:"text-token-text-secondary justify-center text-center text-xs",children:e.jsx(E,{id:"5A9QzP",defaultMessage:"Not seeing your repositories? {helpLink}.",values:{helpLink:e.jsx(e.Fragment,{children:e.jsx("a",{href:"https://help.openai.com/en/articles/11145903-chatgpt-connectors",target:"_blank",rel:"noopener noreferrer",className:"underline",children:e.jsx(E,{id:"sVuhcw",defaultMessage:"Learn more"})})})}})})]})})},zp=({items:t,searchTerm:s,setSearchTerm:n,selectedItems:o,searchPlaceholder:a,handleSelectItem:r,showSelectAllRepos:i,loading:u,endReposRef:l})=>{const d=f.useRef(null),m=i&&o?.includes("$all_accessible_repos");return f.useEffect(()=>{requestAnimationFrame(()=>{d.current?.focus(),d.current?.select()})},[]),e.jsxs(e.Fragment,{children:[e.jsx(H.Item,{className:"mx-1.5 mb-1 p-0!",onClick:c=>{c.preventDefault(),d.current?.focus()},onFocus:()=>d.current?.focus(),tabIndex:-1,children:e.jsx("input",{type:"text",value:s,onChange:c=>n(c.target.value),placeholder:a,className:"text-token-text-primary bg-token-bg-primary border-token-border-default m-[-1px] w-full rounded-[10px] border-1 px-2.5 py-2 text-sm focus:ring-0 focus:ring-offset-0 focus:outline-hidden",ref:d,onKeyDown:c=>{if(sn(c,"ArrowDown"))c.preventDefault(),nn(c.currentTarget);else{if((sn(c,"ArrowLeft")||sn(c,"ArrowRight"))&&c.currentTarget.selectionStart===0)return;c.stopPropagation()}}})}),t?.map(c=>{const p=o?.includes(c.name);return e.jsx(H.Item,{onClick:S=>{S.preventDefault(),r(c),p&&!s&&nn(S.currentTarget)},secondary:c.description,trailing:p&&ra,children:c.name},c.name)}),u&&e.jsx("div",{className:"text-token-text-tertiary mx-1.5 px-2 py-2.5 text-sm",role:"alert","aria-busy":"true",children:e.jsx(E,{id:"M1WgQ2",defaultMessage:"Searching..."})}),i&&e.jsx(H.Item,{onClick:c=>{c.preventDefault(),r({name:"$all_accessible_repos"}),m&&!s&&nn(c.currentTarget)},secondary:e.jsx(E,{id:"EhTGqu",defaultMessage:"Select all repositories accessible to ChatGPT"}),trailing:m&&ra,children:e.jsx(E,{id:"pJnTxe",defaultMessage:"All Repositories"})}),(i||t.length>0)&&e.jsx(H.Separator,{}),e.jsx(H.Item,{onClick:()=>{window.open(Va,"_blank")},secondary:e.jsx(E,{id:"GXUcp/",defaultMessage:"Configure which repositories ChatGPT can access"}),trailing:e.jsx(qt,{className:"icon-sm"}),children:e.jsx(E,{id:"ICVOEb",defaultMessage:"Configure Repositories"})}),e.jsx("div",{className:"text-token-text-tertiary mx-1.5 justify-center px-2.5 py-2 text-center text-xs",ref:l,children:e.jsx(E,{id:"4Z21ID",defaultMessage:"Not seeing a repository? {helpLink}",values:{helpLink:e.jsx(e.Fragment,{children:e.jsx("a",{href:"https://help.openai.com/en/articles/11145903-chatgpt-connectors",target:"_blank",rel:"noopener noreferrer",className:"underline",children:e.jsx(E,{id:"sVuhcw",defaultMessage:"Learn more"})})})}})})]})};function sn(t,s){return t.key===s&&!t.nativeEvent.isComposing&&!t.ctrlKey&&!t.altKey&&!t.shiftKey&&!t.metaKey}function nn(t){const s=t.closest("[role=menuitem]");if(!s)return;let n=s.nextElementSibling;for(;n&&n.getAttribute("role")!=="menuitem";)n=n.nextElementSibling;if(!n)for(n=s.previousElementSibling;n&&n.getAttribute("role")!=="menuitem";)n=n.previousElementSibling;n instanceof HTMLElement&&n.focus()}function Wp(t,s){const[n,o]=f.useState(t),a=f.useRef(on(r=>o(r),s));return f.useEffect(()=>(a.current=on(r=>{o(r)},s),()=>{a.current?.cancel()}),[s]),f.useEffect(()=>{a.current?.(t)},[t]),n}const Ta=({searchTerm:t,setSearchTerm:s,selectedRepos:n,handleSelectRepo:o,linkId:a,asSubmenu:r})=>{const i=$e(),u=K(),l=Ue(),d=Wp(t,300),{data:m,isFetching:c,isFetchingNextPage:p,isError:S,fetchNextPage:h,hasNextPage:g}=pl({queryKey:["github-repos",d,a],queryFn:async({pageParam:w=null})=>d.length===0?{repos:[],next_token:null}:dt(l,"1524828339")?await Ca.safePost("/aip/connectors/github/search_repos",{requestBody:{query:d,limit:20,next_token:w,link_id:a}}):await Ca.safePost("/aip/connectors/github/search_repos_v2",{requestBody:{query:d,limit:2,next_token:w,link_id:a}}),getNextPageParam:w=>w.next_token??void 0,initialPageParam:null,retry:1}),x=f.useRef(null),v=1,y=f.useRef(0);f.useEffect(()=>{if(!g||p)return;const w=x.current,j=new IntersectionObserver(N=>{N[0].isIntersecting&&y.current<v&&h()},{threshold:1});return w&&j.observe(w),()=>{w&&j.unobserve(w)}},[g,p,h]),f.useEffect(()=>{y.current=0},[d]),f.useEffect(()=>{S?(y.current+=1,y.current===1&&i.danger("Request error fetching Github repositories. Try disconnecting and connecting GitHub again.")):!p&&!S&&(y.current=0)},[S,p,i]);let _=m&&d?m.pages.flatMap(w=>w.repos).flatMap(w=>w.repository_full_name):[];_=Array.from(new Set([..._,...n.selectedRepos??[]]));const P=w=>{o(w.name)},R=r?zp:Gp,M=e.jsx(R,{items:_?.map(w=>({name:w}))??[],searchTerm:t,setSearchTerm:s,selectedItems:[...n.selectedRepos??[],...n.selectedAllRepos?["$all_accessible_repos"]:[]],searchPlaceholder:u.formatMessage({id:"lEa/MK",defaultMessage:"Add a repository…"}),handleSelectItem:P,showSelectAllRepos:!1,loading:c||p,endReposRef:x});return r?M:e.jsx("div",{children:M})};function Vp({clientThreadId:t,repoSelectorOpen:s,linkId:n,triggerButton:o,setRepoSelectorOpen:a,asSubmenu:r}){const{selectedRepos:i,setSelectedRepos:u}=vn(t),{deleteSource:l,addSource:d}=ws(t),[m,c]=f.useState(""),p=f.useRef(null),S=h=>{let g=[],x=!1;h==="$all_accessible_repos"?(x=!i?.selectedAllRepos,u({selectedRepos:[],selectedAllRepos:x})):i?.selectedRepos?.includes(h)?(g=i.selectedRepos?.filter(v=>v!==h),u({selectedRepos:g,selectedAllRepos:!1})):(g=[...i?.selectedRepos??[],h],u({selectedRepos:g,selectedAllRepos:!1})),x||g.length>0?d(J.GITHUB_CONNECTOR):r||l(J.GITHUB_CONNECTOR)};if(r){if(!n)return null;const h=qa(i);return e.jsxs(H.Sub,{open:h?s:!0,onOpenChange:g=>{h&&a(g)},children:[e.jsx(H.SubMenuTrigger,{className:"ps-4",icon:Al,children:o}),e.jsx(H.Portal,{children:e.jsx(H.SubContent,{children:e.jsx(Ta,{asSubmenu:r,searchTerm:m,setSearchTerm:c,selectedRepos:{selectedRepos:i.selectedRepos?[...i.selectedRepos]:[],selectedAllRepos:i.selectedAllRepos},handleSelectRepo:S,linkId:n})})})]})}return e.jsx(wn,{open:s,onOpenChange:h=>{a(h),h||c("")},children:e.jsxs(Ya,{children:[o,n&&e.jsx(_n,{children:e.jsx(jn,{side:"bottom",align:"start",ref:p,children:e.jsx(Ta,{asSubmenu:r,searchTerm:m,setSearchTerm:c,selectedRepos:{selectedRepos:i.selectedRepos?[...i.selectedRepos]:[],selectedAllRepos:i.selectedAllRepos},handleSelectRepo:S,linkId:n})})})]})})}const qp=30,Yp=25,Ms=({clientThreadId:t,enabledConnectors:s,includeWebSearch:n=!0,includeSyncConnectors:o=!1})=>{"use forget";const a=K(),{selectedSources:r,toggleSource:i}=ws(t),{connectorLinks:u,isLoading:l}=Vi(),{connectionInstanceData:d,refetch:m,isLoading:c}=kn({skip:!o}),p=f.useMemo(()=>[...d?.connection_statuses??[]].sort(Ka),[d]),{connectedRows:S,disconnectedRows:h}=f.useMemo(()=>{const g=[];o&&p.forEach(y=>{g.push({connected:y.user_connection_details.auth_status!=="not_connected"&&y.user_connection_details.activation_status!=="inactive",element:e.jsx(Qp,{connection:y,location:"user_dropdown",refetch:m},y.user_connection_details.connection_instance_id)})}),r&&s.forEach(y=>{const P=!!u.get($a[y])?.[0];g.push({connected:P,element:e.jsx($p,{connectorType:y,connectorLinks:u,selectedSources:r,toggleSource:i,clientThreadId:t})})});const[x,v]=g.reduce(([y,_],P)=>P.connected?[[...y,P],_]:[y,[..._,P]],[[],[]]);return{connectedRows:x,disconnectedRows:v}},[t,u,s,o,m,r,p,i]);return!t||!r?null:c||l?e.jsx("div",{className:"w-50 px-4",children:e.jsx(Yi,{lines:5,size:"lg",widthVariance:0,width:100})}):e.jsxs("div",{className:"w-70",children:[e.jsx(H.Label,{children:e.jsx(E,{id:"bXIRlR",defaultMessage:"Sources"})}),n&&e.jsx(H.CheckboxItem,{icon:Ml,checked:r.has(ya.Web),onCheckedChange:()=>{i(ya.Web)},children:a.formatMessage(pn.webSearch)}),S.map(({element:g})=>e.jsx(e.Fragment,{children:g})),h.map(({element:g})=>e.jsx(e.Fragment,{children:g})),e.jsx(H.Item,{icon:Rn,onSelect:()=>{window.location.hash="#settings/ConnectorSettings"},children:a.formatMessage(pn.connectApps)})]})},Kp=({clientThreadId:t,enabledConnectors:s,trigger:n,includeWebSearch:o})=>{const{deleteSource:a}=ws(t);return e.jsxs(H.Root,{"data-testid":"sources-pill",onOpenChange:r=>{r||(qa(Ol(Pe(t)))||a(J.GITHUB_CONNECTOR),Pe(t)?.selectedSources?.size===0&&ym(t,l=>{l.selectedSources=void 0}))},children:[n,e.jsx(H.Portal,{children:e.jsx(H.Content,{alignOffset:-8,size:"auto",children:e.jsx(Ms,{clientThreadId:t,enabledConnectors:s,includeWebSearch:o})})})]})},$p=({connectorType:t,connectorLinks:s,selectedSources:n,clientThreadId:o,toggleSource:a})=>{const r=K(),i=Ue(),{selectedRepos:u}=vn(o),l=Bl(),[d,m]=f.useState(!1),c=s.get($a[t])?.[0],p=!!c,S=n.has(t)&&p,h=f.useMemo(()=>{if(u?.selectedRepos?.length&&u?.selectedRepos?.length>=1){const g=u.selectedRepos;let x=g[0];if(x.length>qp){const y=(Yp-3)/2;x=x.slice(0,Math.floor(y))+"..."+x.slice(Math.floor(-11))}const v=g.length-1;return v>0?`${x} +${v}`:x}},[u.selectedRepos]);switch(t){case J.GITHUB_CONNECTOR:case J.GDRIVE_ACTION_CONNECTOR:case J.DROPBOX_CONNECTOR:case J.HUBSPOT_CONNECTOR:case J.LINEAR_CONNECTOR:case J.SHAREPOINT_CONNECTOR:case J.OUTLOOK_EMAIL_CONNECTOR:case J.GCAL_CONNECTOR:case J.GMAIL_CONNECTOR:case J.GOOGLE_CONTACTS_CONNECTOR:case J.OUTLOOK_CALENDAR_CONNECTOR:case J.TEAMS_CONNECTOR:case J.BOX_CONNECTOR:case J.INTERCOM_CONNECTOR:{const g=t===J.GITHUB_CONNECTOR&&p&&S,x=r.formatMessage(la[t].title),v=la[t].icon,y=e.jsx(v,{className:"icon-md"});return e.jsxs(e.Fragment,{children:[p?e.jsx(H.CheckboxItem,{icon:y,checked:S,onCheckedChange:()=>{a(t)},children:x}):e.jsx(H.Item,{onSelect:()=>{Il(t,i,void 0,l)},icon:y,trailing:e.jsx("div",{className:"text-token-text-tertiary",children:r.formatMessage(pn.connect)}),children:x}),g&&e.jsx(Vp,{asSubmenu:!0,clientThreadId:o,setRepoSelectorOpen:m,repoSelectorOpen:d,linkId:c?.id,triggerButton:h??r.formatMessage({id:"sDCihQ",defaultMessage:"Repositories"})},t)]})}default:return}},Qp=({connection:t,refetch:s,location:n})=>{const o=K(),[a,r]=f.useState(!1),[i,u]=f.useState(),l=t.user_connection_details.connection_instance_id,d=$e(),m=El(),c=t.user_connection_details.knowledge_connector_type,p=c==="google_drive_oauth",S=f.useCallback(async()=>{try{r(!0),await Pl({connectorType:c,connectionId:l,location:n,intl:o})}catch(P){P instanceof Error?d.danger(P.message):d.danger(o.formatMessage({id:"FNXFnS",defaultMessage:"Encountered an error connecting your account. Please try again later."}))}finally{r(!1),s?.()}},[l,c,o,n,s,d]),[h,g]=f.useState(!1),x=()=>p?g(!0):S(),v=t.user_connection_details.activation_status==="inactive"&&t.user_connection_details.auth_status==="not_connected",y=["activating","partially_activated"].includes(t.user_connection_details.activation_status),_=v&&!m||y;return e.jsxs(e.Fragment,{children:[i&&e.jsx(Qa,{connection:i,onClose:()=>u(void 0)}),h&&e.jsx(Tl,{isAdminFlow:!1,onClose:()=>g(!1),connectionId:l,location:n,onSuccess:s}),e.jsx(H.Item,{style:{cursor:_?void 0:"default"},onSelect:P=>{if(P.stopPropagation(),P.preventDefault(),v){x();return}if(y){u(t);return}},icon:e.jsx("img",{src:t.connection_display_info.icon_url??"",alt:t.connection_display_info.display_name,className:"icon-md"}),trailing:a?e.jsx(Yt,{className:"icon-md"}):e.jsx(Xa,{connection:t,location:"user_dropdown",inactiveButtonOverride:e.jsx("div",{className:"text-token-text-tertiary",children:e.jsx(Nl,{connection:t,refetch:s,location:"user_dropdown"})})}),children:t.connection_display_info.display_name},t.connection_display_info.display_name)]})},pn=Fe({allRepositories:{id:"EzHFPp",defaultMessage:"All Repositories"},connect:{id:"OODbh3",defaultMessage:"Connect"},sourcesEnabled:{id:"aEIPI+",defaultMessage:"On"},webSearch:{id:"XoUbAe",defaultMessage:"Web search"},sourcesDisabled:{id:"j32+iI",defaultMessage:"Off"},connectApps:{id:"QJdTTY",defaultMessage:"Connect apps"}});function Xp({clientThreadId:t,gizmoId:s,showLabel:n=!1,isDisabled:o}){const a=Dl(t,s),r=Mt(),i=zt(A.Research),{setThreadSystemHintMode:u,clearAllSystemHintModeTriggers:l}=fe(),d=!!Kn(),{value:m}=ae("1416952492"),c=m?ct.DeepResearchHighLoad:d?ct.RateLimitReached:void 0;return a?e.jsx("div",{"data-testid":"system-hint-research",style:{viewTransitionName:`var(--vt-composer-${A.Research}-action)`},children:e.jsx(Jp,{composerController:r,isThreadInSystemHintMode:i,setThreadSystemHintMode:u,clearAllSystemHintModeTriggers:l,clientThreadId:t,showLabel:n,isDisabled:o||!!c,disabledReason:c})},`system-hint-${A.Research}`):null}function Jp({composerController:t,isThreadInSystemHintMode:s,setThreadSystemHintMode:n,clearAllSystemHintModeTriggers:o,clientThreadId:a,showLabel:r=!1,isDisabled:i=!1,disabledReason:u}){const l=K(),d={clientThreadId:a},m=l.formatMessage({id:"ORxecl",defaultMessage:"Deep research"}),c=y=>{y===Se.Hover?T.logEventWithStatsig("Composer Research Button Hovered","composer_research_button_hovered",d):y===Se.Enable?T.logEventWithStatsig("Composer Research Button Enabled","composer_research_button_enabled",d):y===Se.Disable&&T.logEventWithStatsig("Composer Research Button Disabled","composer_research_button_disabled",d)},p=y=>{y.stopPropagation(),y.preventDefault(),o(),n(A.Research,!s,d),s||(t.removeSystemHints(),t.focus()),c(s?Se.Disable:Se.Enable)},S=ae("3544641259")?.value,h=qi(),{enabled:g}=eo(),x=f.useMemo(()=>Object.entries(h).reduce((y,[_,P])=>(P&&(_!==J.GITHUB_CONNECTOR||g)&&y.push(_),y),[]),[h,g]),v=y=>e.jsx(Up,{disabledReason:u,isDisabled:i,logEvent:c,children:y});return e.jsx(As,{pressed:s,disabled:i,icon:e.jsx(Ll,{className:"h-[18px] w-[18px]"}),label:m,animatedLabel:!r,showLabel:r||s,onClick:p,ariaLabel:m,dataTestid:"composer-button-deep-research",splitButtonDropdownContent:S?e.jsx(Ms,{clientThreadId:a,enabledConnectors:x,includeSyncConnectors:!1,includeWebSearch:!0}):void 0,showSplitButton:s&&S,tooltip:v,as:S?"dropdown":"popover"})}function Zp({clientThreadId:t,gizmoId:s,composerController:n,isDisabled:o}){return Fl({clientThreadId:t,gizmoId:s})?e.jsx("div",{"data-testid":"system-hint-reason",style:{viewTransitionName:`var(--vt-composer-${A.Think}-action)`},children:e.jsx(ef,{clientThreadId:t,composerController:n,isDisabled:o})},`system-hint-${A.Think}`):null}function ef({clientThreadId:t,composerController:s,isDisabled:n}){const o=K(),a=!!$n();n=n||a;const r=o.formatMessage({id:"T+qu+0",defaultMessage:"Reason"}),{setThreadSystemHintMode:i,clearAllSystemHintModeTriggers:u}=fe(),l=zt(A.Think),d=Ye.useStore(),m=Wt(),{isUnauthenticated:c}=Te();f.useEffect(()=>{n&&m.has(A.Think)&&i(A.Think,!1,{clientThreadId:t})},[n,m,i,t]);const p=g=>{if(g.stopPropagation(),g.preventDefault(),c)return;let x=!0;d.getState().persistedSystemHints.has(A.Search)&&(x=!1),x&&u(),i(A.Think,!l,{clientThreadId:t}),l||(s.removeSystemHints(),s.focus()),l?T.logEventWithStatsig("Composer Think Button Disabled","composer_think_button_disabled",{clientThreadId:t}):T.logEventWithStatsig("Composer Think Button Enabled","composer_think_button_enabled",{clientThreadId:t})},S=c?e.jsx(yn,{location:A.Think,statsig_login_event:"chatgpt_composer_upsell_login_button_clicked",statsig_signup_event:"chatgpt_composer_upsell_signup_button_clicked",containerNoPadding:!0}):void 0,h=e.jsx(As,{pressed:l,disabled:n,icon:e.jsx(Ul,{className:"h-[18px] w-[18px]"}),label:r,ariaLabel:r,animatedLabel:!0,showLabel:!0,onClick:p,dropdownContent:S,dataTestid:"composer-button-reason"});return e.jsx(Hl,{isDisabled:n,clientThreadId:t,children:h})}const tf=["o1","o1-pro","gpt-4"];function sf({account:t,clientBootstrapFlags:s,features:n,clientThreadId:o,currentModelConfig:a,composerController:r,isDisabled:i,gizmoId:u,hasFiles:l}){const{prospectiveModelId:d}=_s(o),m=js(o),c=An(u),{userIsInSearchHoldoutWithWebDisabled:p}=Gl(),S=a?.enabledTools?.includes(Ni.Search),h=m==null||m?.kind===Oe.PrimaryAssistant||m?.kind===Oe.GizmoInteraction&&c,{isUnauthenticated:g}=Te(),x=vm(A.Search);return S===!1||g&&s?.includes(bs.AnonSearchHoldout)||!g&&(t==null||t.isFree())&&(s?.includes(bs.FreeSearchHoldout)||p)||!x||!g&&(t==null||t.isEnterprisey())&&!n?.includes(wm.BrowsingAvailable)||!h?null:e.jsx("div",{"data-testid":"system-hint-search",style:{viewTransitionName:`var(--vt-composer-${A.Search}-action)`},children:e.jsx(nf,{clientThreadId:o,composerController:r,modelSupportsSearch:S??(g||t?.isFree()||!!d&&!tf.includes(d)),isDisabled:i,disabledReason:S?l?ps.HasAttachedFiles:void 0:ps.ModelNotSupported,currentModelName:a?.title??""})},`system-hint-${A.Search}`)}function nf({clientThreadId:t,composerController:s,isDisabled:n,disabledReason:o,currentModelName:a,modelSupportsSearch:r}){const i=K(),u=zl(),l=i.formatMessage({id:"TbHx8d",defaultMessage:"Search"}),{setThreadSystemHintMode:d,clearAllSystemHintModeTriggers:m}=fe(),c=Ye.useStore(),p=Wt();n=n||!r,f.useEffect(()=>{n&&p.has(A.Search)&&d(A.Search,!1,{clientThreadId:t})},[n,p,d,t]);const S=h=>{h.stopPropagation(),h.preventDefault();let g=!0;c.getState().persistedSystemHints.has(A.Think)&&(g=!1),g&&m(),d(A.Search,!u,{clientThreadId:t}),u||(s.removeSystemHints(),s.focus()),T.logEventWithStatsig("Composer Search Button Clicked","composer_search_button_clicked",{clientThreadId:t}),u&&s.trimLeadingText(/^search\b/i)};return e.jsx(af,{analyticsMetadata:{clientThreadId:t},isThreadUsingSearchMode:u,isDisabled:n,disabledReason:o,currentModelName:a,children:e.jsx(As,{pressed:u,disabled:n??!1,icon:e.jsx(Wl,{className:"h-[18px] w-[18px]"}),label:l,ariaLabel:l,animatedLabel:!0,showLabel:!0,onClick:S,dataTestid:"composer-button-search"})})}function of(){const t=Ja(),s=Le(pe.hasSeenComposerSearchButtonTooltip);return!s.isLoading&&s.eligible&&!t}function af({children:t,analyticsMetadata:s,isThreadUsingSearchMode:n,isDisabled:o,disabledReason:a,currentModelName:r}){const i=of()&&!n,u=Le(pe.hasSeenComposerSearchButtonTooltip);return i?e.jsx(Mn,{announcementKey:pe.hasSeenComposerSearchButtonTooltip,side:"right",show:!0,theme:"bright",dismissOnOutsideClick:!0,badge:"new",title:e.jsx(E,{id:"Yjduqi",defaultMessage:"Search the web"}),onDismiss:u.markAsViewed,sideOffset:0,className:"xs:max-w-sm! max-w-2xs!",description:e.jsx(E,{id:"W51Aei",defaultMessage:"Get fast answers with trusted sources. {learnMore}",values:{learnMore:e.jsx(Vl,{href:"https://openai.com/index/introducing-chatgpt-search",className:"underline",children:e.jsx(E,{id:"stA7F4",defaultMessage:"Learn more"})})}}),children:e.jsx("div",{children:t})}):e.jsx("div",{children:e.jsx(Vt,{className:"inline-block",label:o?a===ps.ModelNotSupported?e.jsx(E,{id:"GZemJe",defaultMessage:"Search disabled for {modelName}",values:{modelName:`${r}`}}):a===ps.HasAttachedFiles?e.jsx(E,{id:"Wd1fc2",defaultMessage:"Search disabled for attachments"}):e.jsx(E,{id:"GpDAWD",defaultMessage:"Search is unavailable"}):e.jsx(E,{id:"c+4o2s",defaultMessage:"Search the web"}),side:"bottom",onOpenChange:l=>{l&&T.logEventWithStatsig("Composer Search Button Hovered","composer_search_button_hovered",s)},children:t})})}const rf=1;function lf({value:t=rf,size:s,onStateChange:n}){return e.jsx("div",{className:"relative flex h-full w-full flex-col items-center justify-center",children:e.jsxs(Z.div,{animate:{translateY:t>1&&s==="small"?-1:0},onAnimationStart:()=>n?.("animating"),onAnimationComplete:()=>n?.("idle"),className:q("relative",s==="small"?"h-5 w-5":"h-8 w-8"),children:[e.jsx(Z.div,{style:{transformOrigin:"50% 100%",translateY:s==="large"?3:0},animate:{scale:t>1&&s==="small"?.85:1},className:"absolute start-0 top-0",children:e.jsx(ql,{"aria-label":"",className:q(s==="small"?"h-5 w-5":"h-8 w-8")})}),e.jsx(Z.div,{initial:{scale:s==="small"?.9:1.1,opacity:0},animate:{scale:s==="large"?1.1:t>1?1:.9,opacity:t>1?1:0},style:{translateY:s==="large"?-1:0},className:"absolute start-0 top-0",children:e.jsx(Yl,{"aria-label":"",className:q(s==="small"?"h-5 w-5":"h-8 w-8")})}),e.jsx(Z.div,{initial:{scale:s==="small"?.9:1.1,opacity:0},animate:{scale:s==="large"?1.1:t>2?1:.9,opacity:t>2?1:0},style:{translateY:s==="large"?-1:0},className:"absolute start-0 top-0",children:e.jsx(Kl,{"aria-label":"",className:q(s==="small"?"h-5 w-5":"h-8 w-8")})})]})})}function cf(t){const{reasoningLevelTypes:s,reasoningLevelType:n}=t,{ReasoningLevels:o}=s;let a=1;return n===o.medium.type?a=2:n===o.high.type&&(a=3),e.jsx("div",{className:q("relative flex h-5 w-5 items-center justify-center"),children:e.jsx(lf,{size:"small",value:a})})}const uf=({isManualModelSelection:t,animatedLabel:s,reasoningLevelTypes:n,reasoningLevelType:o,modelName:a,onResetReasoningLevel:r,onReasoningLevelChanged:i,type:u})=>{const[l,d]=f.useState(!1),m=fl(),{reasoningLevel:c}=$l({reasoningLevelTypes:n,reasoningLevelType:o}),p=o!=="low"||t||!1,S=De(g=>g.isVisuallyOverflowing),h=S;return e.jsxs("div",{className:q("radix-state-open:bg-black/10 inline-flex h-9 rounded-full border text-[13px] font-medium",p?"text-token-interactive-label-accent-default can-hover:hover:bg-[#BDDCF4] dark:can-hover:hover:bg-[#1A416A] bg-token-composer-blue-bg border-transparent dark:bg-[#2A4A6D] dark:text-[#48AAFF]":"border-token-border-default text-token-text-secondary can-hover:hover:bg-token-main-surface-secondary focus-visible:outline-black dark:focus-visible:outline-white",l&&"duration-75 motion-safe:transition-all"),children:[e.jsxs("div",{className:"flex h-full min-w-8 items-center justify-center p-2","aria-pressed":p,onTransitionEnd:()=>d(!1),onClick:g=>{u==="think"&&!t&&!S&&(g.stopPropagation(),g.preventDefault(),i(o==="low"?"medium":"low"))},children:[e.jsx(cf,{reasoningLevelTypes:n,reasoningLevelType:o}),s&&e.jsx(mt,{initial:!1,children:e.jsx(Z.span,{initial:{x:-10,width:0,opacity:0},animate:{x:0,width:"fit-content",opacity:1},exit:{x:-10,width:0,opacity:0},transition:{ease:"easeOut",duration:m?0:.15},children:e.jsx("div",{className:q("ps-1 pe-1 whitespace-nowrap",h&&!t&&"hidden"),children:t?a:c?.shortLabel})})}),!t&&u==="auto"&&!p&&!h&&e.jsx(Ht,{"aria-label":"",className:"h-[18px] w-[18px] opacity-50"})]}),p&&!S&&(t||u!=="think")?e.jsx("div",{className:"border-token-border-default mt-[1px] border-s p-2",style:{borderColor:p?"#0285FF28":void 0},onClick:g=>{g.stopPropagation(),g.preventDefault(),r()},children:e.jsx(Bi,{"aria-label":"",className:"h-[16px] w-[16px]"})}):u==="think"?e.jsx("div",{className:q("border-token-border-default border-s p-2",h&&"hidden"),style:{borderColor:p?"#0285FF28":void 0},children:e.jsx(Ht,{className:"h-[18px] w-[18px]"})}):null]})},df=({clientThreadId:t,currentModelId:s,onModelSelection:n,closePopover:o,setIsModelPickerOpen:a,ref:r})=>{const i=K(),{data:u}=$t(),{mode:l}=En(),d=Ql({clientThreadId:t}),{hasInternalModels:m}=Xl(),S=Jl(h=>h.query).toLowerCase().trim().length>0;return e.jsxs(Z.div,{initial:{clipPath:"inset(0 100% 0 0)",opacity:0},animate:{clipPath:"inset(0 0% 0 0)",opacity:1},exit:{clipPath:"inset(0 100% 0 0)",opacity:0},transition:fs,className:"flex flex-col",ref:r,children:[l!=="model-picker-only"&&e.jsxs("div",{className:"border-token-border-xlight bg-token-main-surface-primary dark:bg-token-main-surface-secondary sticky start-0 top-0 z-10 flex w-full flex-row items-center justify-center overflow-clip border-b p-3",children:[e.jsx("button",{onClick:()=>{a(!1)},id:"reasoning-level-popover-model-list-back-button",className:"hover:bg-token-main-surface-tertiary flex items-center rounded-md p-1",children:e.jsx(Za,{className:"text-token-text-secondary h-5 w-5"})}),e.jsx("div",{className:"flex-auto text-center text-sm font-medium",children:i.formatMessage({id:"j6WEI7",defaultMessage:"Choose a model"})}),e.jsx("div",{className:"w-5"})]}),e.jsx("div",{className:q("flex w-full flex-col pb-2"),children:S?e.jsx(Zl,{currentModelId:s,onModelSelection:n,closePopover:o,rootRef:r}):e.jsxs(e.Fragment,{children:[u?.categories?.map(h=>{const g=h?.defaultModel;return e.jsx(ec,{model:h,modelSwitcherDenialsBySlug:d,isSelected:g===s,onClick:()=>{n(g),o()}},g)}),m&&e.jsxs(e.Fragment,{children:[e.jsx(tc,{modelsData:u,clientThreadId:t,triggerButton:e.jsx(ut,{className:"relative mt-1 border-transparent",children:e.jsxs("div",{className:"mb-1 flex items-center px-1",children:[e.jsx("div",{className:"text-sm",children:i.formatMessage({id:"ZDpo4I",defaultMessage:"Internal Models"})}),e.jsx(sc,{className:"icon-md text-token-text-tertiary absolute end-1 w-7"})]})}),onModelItemClick:h=>{h&&(n(h),o())}}),e.jsx(ei,{})]})]})})]})},mf={modelPickerOpen:{maxHeight:375,width:320},modelPickerClosed:{maxHeight:245,width:320},vanguardModelPickerClosed:{maxHeight:320,width:264}},pf=({clientThreadId:t,reasoningLevelTypes:s,reasoningLevelType:n,onReasoningLevelChanged:o,isManualModelSelection:a,currentModelId:r,onModelSelection:i,resetReasoningLevel:u})=>{const{layoutMode:l,closePopover:d,mode:m}=En(),c=!ks(),[p,S]=f.useState(!!(a||m==="model-picker-only")),h=f.useRef(null),g=f.useRef(null);return f.useEffect(()=>{p?(h.current?.scrollTo({top:-1e3,behavior:"instant"}),document.getElementById("reasoning-level-popover-model-list-back-button")?.focus()):document.getElementById("reasoning-level-popover-juice-list-model-picker-button")?.focus()},[a,p]),e.jsxs(Z.div,{className:q("max-h-[max(calc(var(--radix-popover-content-available-height)-64px), 245px)] flex flex-1 origin-center snap-y snap-proximity scroll-pt-[30px] overflow-y-auto overscroll-contain scroll-smooth [scrollbar-gutter:stable]",c&&!p&&"pt-4",l==="bottom"&&"flex-col-reverse"),animate:p?"modelPickerOpen":"modelPickerClosed",transition:nc,variants:mf,ref:h,children:[!p&&m!=="model-picker-only"&&e.jsx(oc,{clientThreadId:t,reasoningLevelTypes:s,reasoningLevelType:n,onReasoningLevelChanged:o,resetReasoningLevel:u,shouldShowModelPicker:c,setIsModelPickerOpen:S,isModelPickerOpen:p,showAccountPaymentModal:lt}),e.jsx(mt,{children:p&&c&&e.jsx(df,{clientThreadId:t,setIsModelPickerOpen:S,ref:g,currentModelId:r,onModelSelection:i,closePopover:d})})]})},ff=({clientThreadId:t,layoutMode:s,currentModel:n,category:o,type:a,...r})=>{const{data:i}=$t(),l=De(j=>j.threads[t]?.modelSelection)?.type===be.SPECIFIC,d=De(j=>j.setThreadModelSelection),m=ks(),c=xn(),p=f.useMemo(()=>{const j=n?.id??"";return ac(j)?"low":ic(j)?"medium":rc(j)?"high":"low"},[n?.id]),S=lc(),h=At(),g=f.useCallback(j=>{_t(t,d,{type:be.EFFORT_MODE,effortMode:ti[j]}),requestAnimationFrame(()=>{requestAnimationFrame(()=>{const N=cc(j,i?.categories.map(D=>D.defaultModel)??[]);N&&(m&&j==="high"?lt(c,"Model picker upsell"):h({location:"PromptTextarea",modelId:N}))})})},[t,h,c,m,i,d]),x=j=>{const N=n?.id??"";j&&(T.logEvent("Model Switcher Model Changed",{from:N,to:j,source:"popover"}),jm.logEvent("chatgpt_model_switcher_model_changed",j,{from:N,to:j,source:"popover"}),h({modelId:j,location:"Model switcher menu item"}),dc({type:be.SPECIFIC,modelSlug:j}),_t(t,d,{type:be.SPECIFIC,modelSlug:j}))},v=!uc(n?.id??""),y=l||v,P=(o?.label&&o?.label?.length<10?o?.label:o?.shortLabel)??n?.title??"",R=n?.id??"",M=()=>{g("low")},w=f.useCallback(()=>{const{reasoningLevelList:j}=S,D=(j.findIndex(L=>L.type===p)+1)%j.length;g(j[D].type)},[g,p,S]);return f.useEffect(()=>_m(gp,{cycleReasoningLevel:w}),[w]),e.jsxs(to,{layoutMode:s,...r,children:[e.jsx(Ki,{children:e.jsx(uf,{isManualModelSelection:y,modelName:P,animatedLabel:!0,reasoningLevelTypes:S,reasoningLevelType:p,onResetReasoningLevel:M,onReasoningLevelChanged:g,type:a})}),e.jsx(so,{align:"start",children:e.jsx(pf,{clientThreadId:t,reasoningLevelTypes:S,reasoningLevelType:p,onReasoningLevelChanged:g,modelName:P,isManualModelSelection:y,currentModelId:R,onModelSelection:x,resetReasoningLevel:M})})]})},gf=({className:t,children:s})=>e.jsx(Z.div,{className:t,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,transition:{duration:.1,delay:0}},transition:{type:"tween",duration:.3,delay:.2},children:s});function hf({canContinue:t,onContinueGenerating:s}){const n=f.useCallback(a=>{s(a),an()},[s]);let o=null;return t&&(o=e.jsx(Sf,{onHandleContinueGenerating:n})),o&&e.jsx("div",{className:"flex h-full w-full items-center justify-end gap-0 py-4 md:gap-2",children:o})}function xf({className:t}){return e.jsx(mc,{className:q("-rotate-180",t)})}const Sf=({onHandleContinueGenerating:t})=>e.jsx(gf,{children:e.jsx(km,{as:"button",color:"secondary",onClick:t,className:"py-2 whitespace-nowrap",icon:xf,size:"small",children:e.jsx(E,{...ee.continueGenerating})})}),bf=({clientThreadId:t,composerController:s})=>{const n=Oi(),o=rt(s.store,h=>h.rateLimitBannerFeature),a=Am(),r=n??Cf(o,a),i=le(t,se.getRequestId),u=le(t,se.getCurrentLeafId),l=Ii(i),{layer:d}=Ke("1368081792"),m=r?.name?()=>{switch(r.name){case"o3-mini-high-in-context-upsell-free":case"o3-mini-high-in-context-upsell-plus":case"deep-research-in-context-upsell":case"codex-in-context-upsell":yc(u);break}}:void 0,{value:c}=ae("3612584454");f.useEffect(()=>{l&&!(r?.name==="gpt-4l"&&c)&&(va.dismissBanner(),s.setRateLimitBannerFeature(null))},[l,r?.name,c,s]);const p=r?.is_dismissible?()=>{T.logEventWithStatsig("Rate Limit: Dismiss Banner","chatgpt_rate_limit_banner_dismissed",{type:!d.get("should_change_model_picker",!0)&&r?.name==="o3-mini-high-in-context-upsell-plus"?"o3-mini-high-in-context-upsell-plus-no-model-switch":r?.name}),va.dismissBanner(),s.setRateLimitBannerFeature(null)}:void 0,S=()=>{switch(r?.name){case"o3-mini-high-in-context-upsell-free":case"o3-mini-high-in-context-upsell-plus":case"deep-research-in-context-upsell":case"codex-in-context-upsell":vc({interactedInPeriod:!0});break}};return e.jsx(mt,{children:r&&e.jsx(Z.div,{transition:{type:"tween",ease:"easeInOut",duration:.1},initial:{opacity:0,transform:"translateY(8px)"},animate:{opacity:1,transform:"translateY(0px)"},exit:{opacity:0,transform:"translateY(8px)"},children:e.jsx(Xi,{clientThreadId:t,rateLimitInfo:r,onDismiss:p,onInteract:S,onMount:m})})})};function Cf(t,s){const n=s.find(o=>o.name===t);return n?{name:n.name,title:n.title,description:n.description,is_dismissible:!0,call_to_action:n.call_to_action,resets_after:n.resets_after}:null}function yf(t,s,n,o,a,r,i,u,l,d,m){if(l||(t.name==="o3-mini-high-in-context-upsell-free"||t.name==="o3-mini-high-in-context-upsell-plus")&&(s.some(y=>y.model_slug==="o3-mini-high")||n.id==="o3-mini-high")||u&&i&&Qs(Date.now(),i)<ca)return!1;const p=o==null||Qs(Date.now(),o)>=bc,S=a===d,h=i==null||r==null||Qs(Date.now(),i)>=ca||r<Cc;if(!(p&&h||S))return!1;switch(t.name){case"deep-research-in-context-upsell":return m("should_show_deep_research_upsell_banner",!1);case"o3-mini-high-in-context-upsell-free":return m("should_show_o3_mini_high_upsell_banner_free_user_to_plus",!1);case"o3-mini-high-in-context-upsell-plus":return m("should_show_o3_mini_high_upsell_banner_plus_user",!1);case"codex-in-context-upsell":return m("should_show_codex_upsell_banner",!1);default:return!1}}function vf(t,s){const n=Rm(),o=pc(t),a=le(t,se.getRequestId),r=le(t,se.getCurrentLeafId),i=Ii(a),u=Oi(),l=fc(x=>x.lastSeenInContextUpsellBannerAt),d=gc(x=>x.inContextUpsellBannerPeriodExposureCount),m=hc(x=>x.inContextUpsellBannerPeriodStartAt),c=xc(x=>x.inContextUpsellBannerLastSeenId),p=Sc(x=>x.inContextUpsellBannerInteractedInPeriod),{layer:S}=Ke("1368081792"),h=rt(s.store,x=>x.rateLimitBannerFeature);let g=!1;switch(u?.name){case null:case void 0:g=h!=null;break;case"o3-mini-high-in-context-upsell-free":case"o3-mini-high-in-context-upsell-plus":case"deep-research-in-context-upsell":case"codex-in-context-upsell":g=yf(u,n,o,l,c,d,m,p,i,r,S.get);break;default:g=!0}return!i&&g}const Cs="month",tr="year";function wf(){const t=Mm(),s=K(),n=$e(),{markAsViewed:o}=Le(wc),{initialBillingDetails:a}=ip(t,!0),r=f.useMemo(()=>({...t?.subscriptionAnalyticsParams,referrer:document.referrer}),[t]);async function i(){try{await jc(t?.features??[],s,n,a,r)}catch{}}const{shouldShowBanner:u,discountValue:l,discountDuration:d}=_c();if(f.useEffect(()=>{u&&l&&d&&Xs.logShowReferrerRedemptionBanner()},[u,l,d]),!u||!l||!d)return null;const m=_f(s,a,l,d),c=jf(s,a,l,d),p=e.jsxs("div",{className:"grow",children:[e.jsx("div",{className:"mb-0.5 font-semibold",children:m}),e.jsx("span",{className:"text-token-text-secondary",children:c})]});return e.jsx(Pn,{onPrimaryCtaClick:()=>{o(),Xs.logClickReferrerRedeemButton(),i()},primaryCtaText:e.jsx(E,{id:"referrerRedemptionBannerPrimaryCta",defaultMessage:"Get Plus"}),onDismiss:()=>{o(),Xs.logCloseReferrerRedemptionBanner()},content:p})}function _f(t,s,n,o){const{currencySymbol:a}=si(ni(),s.currency),r=o?o.period:Cs,i=o?o.num_periods:1,u=a.code.defaultMessage?.toString()??Di,l=t.formatNumber(n.value,{style:"currency",currency:u,minimumFractionDigits:0,maximumFractionDigits:2});let d;return r===Cs?d=i===1?e.jsx(E,{id:"referrerRedemptionBannerTitleForSingleMonth",defaultMessage:"Your {discount} credit is ready",values:{discount:l}}):e.jsx(E,{id:"referrerRedemptionBannerTitleForPluralMonths",defaultMessage:"Redeem your {discount} referral reward",values:{discount:l}}):r===tr&&(d=i===1?e.jsx(E,{id:"referrerRedemptionBannerTitleForSingleYear",defaultMessage:"Redeem your {discount} referral reward",values:{discount:l}}):e.jsx(E,{id:"referrerRedemptionBannerTitleForPluralYears",defaultMessage:"Redeem your {discount} referral reward",values:{discount:l}})),d}function jf(t,s,n,o){const{currencySymbol:a}=si(ni(),s.currency),r=o?o.period:Cs,i=o?o.num_periods:1,u=a.code.defaultMessage?.toString()??Di,l=t.formatNumber(n.value,{style:"currency",currency:u,minimumFractionDigits:0,maximumFractionDigits:2});let d;return r===Cs?d=i===1?e.jsx(E,{id:"referrerRedemptionBannerContentForSingleMonth",defaultMessage:"Your referral link was used — claim your free month of Plus."}):e.jsx(E,{id:"referrerRedemptionBannerContentForPluralMonths",defaultMessage:"Your referral link earned you {discount} off {num_months} months of Plus.",values:{discount:l,num_months:i}}):r===tr&&(d=i===1?e.jsx(E,{id:"referrerRedemptionBannerContentForSingleYear",defaultMessage:"Your referral link earned you {discount} off a year of Plus.",values:{discount:l}}):e.jsx(E,{id:"referrerRedemptionBannerContentForPluralYears",defaultMessage:"Your referral link earned you {discount} off {num_years} years of Plus.",values:{discount:l,num_years:i}})),d}const fn=window.sessionStorage,gn=Em(Pm(()=>({memoryFullBannerDismissed:!!fn?.getItem(Rt.MemoryFullBannerDismissed)}))),sr={dismissBanner(){gn.setState(t=>{t.memoryFullBannerDismissed=!0}),fn?.setItem(Rt.MemoryFullBannerDismissed,"true")},clearDismissedBanner(){gn.setState(t=>{t.memoryFullBannerDismissed=!1}),fn?.removeItem(Rt.MemoryFullBannerDismissed)}};function kf(t){const s=Li(t),n=kc(),{data:o}=Rc(s,!1,n),a=o!=null,r=a&&o.memoryFullPct>=100,[i,u]=f.useState(!1);f.useEffect(()=>{!r&&a&&(u(!0),sr.clearDismissedBanner())},[r,a]);const l=gn(d=>d.memoryFullBannerDismissed);return r&&i&&!l}function Rf(){const t=K(),{openSettings:s}=Ac();return e.jsx(Z.div,{initial:{opacity:0},animate:{opacity:1},children:e.jsx(Pn,{title:t.formatMessage(ds.memoryFullTitle),content:t.formatMessage(ds.memoryFullTooltip,ds.memoryFullTooltip.values),primaryCtaText:t.formatMessage(ds.memoryManageButton),onPrimaryCtaClick:()=>s(Mc.Personalization),onDismiss:()=>sr.dismissBanner()})})}const ds=Fe({memoryFullTitle:{id:"i1hV1R",defaultMessage:"ChatGPT's out of space for saved memories"},memoryManageButton:{id:"a5A88o",defaultMessage:"Manage"},memoryFullTooltip:{id:"Rs+Att",defaultMessage:"New memories won’t be added until you make space. <a>Learn more</a>",values:{a:t=>e.jsx("a",{href:Ec,target:"_blank",rel:"noopener noreferrer",className:"underline",children:t})}}}),Af=Qn(()=>Xn(()=>import("./onp1l9h8khb0d7bu.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(t=>t.JawboneNotificationsBanner)),nr=f.memo(function({className:s}){const{store:n}=Ce(),o=n.useIsHeaderContentAreaPopulated();return e.jsx("div",{className:q(s??"absolute start-0 end-0 bottom-full",Tc.PromptTextareaHeader),children:e.jsx(Pc,{shouldRender:o,contentArea:Ut.Header,children:e.jsxs("div",{className:"mb-2 flex flex-col gap-3.5 pt-2",children:[e.jsx(Mf,{}),e.jsx(Ef,{})]})})})});function Mf(){const{store:t}=Ce(),s=t.useSharedProps(u=>u?.clientThreadId),n=t.useContentAreaId(Ut.HeaderTop),o=Nc(),a=le(s,u=>u?.modelId),r=Bc.useStore();let i;switch(n){case B.ProjectConversationTaskNoFileAccess:i=e.jsx(Bf,{});break;case B.AdvancedVoiceOnMobileAnnouncement:i=e.jsx(Xc,{clientThreadId:s});break;case B.S09KM1:i=null;break;case B.TeamsCreditRequest:i=null;break;case B.BannerSignup:i=e.jsx(Nf,{});break;case B.BannerTermsDisclaimer:i=e.jsx(If,{});break;case B.PromptTextareaAction:i=e.jsx(Of,{});break;case B.BannersRateLimit:i=e.jsx(Df,{});break;case B.BannerSidekickAnnouncement:i=e.jsx(Qc,{});break;case B.SearchBrowserExtensionAnnouncement:i=e.jsx($c,{});break;case B.MoonshineAnnouncement:i=e.jsx(Kc,{});break;case B.CustomizeChatGPTAnnouncement:i=e.jsx(Yc,{});break;case B.SearchBrowserExtensionReactiveAnnouncement:i=e.jsx(qc,{});break;case B.BannerMemoryFull:i=e.jsx(Rf,{});break;case B.Box:i=e.jsxs("div",{id:"Box",className:"flex h-20 w-full items-center justify-center gap-2 bg-red-500 p-2",children:["box",e.jsxs("div",{className:"flex h-full w-full items-center justify-center gap-2 bg-blue-500 p-2",children:["inner",e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-yellow-400 text-center",children:"actual content"})]})]});break;case B.JawboneAnnouncement:o?i=e.jsx(Af,{}):i=null;break;case B.JawboneMaxActiveAnnouncement:o?i=e.jsx(Vc,{}):i=null;break;case B.PromoRedemptionAnnouncement:i=e.jsx(op,{});break;case B.OperatorAnnouncement:i=e.jsx(Wc,{});break;case B.BannerPlusUpsell:i=e.jsx(zc,{});break;case B.ContextualAnswersAdminUpsell:i=e.jsx(Gc,{});break;case B.ContextualAnswersUserUpsell:i=e.jsx(Uc,{});break;case B.ReferrerRedemptionAvailableAnnouncement:i=e.jsx(wf,{});break;case B.RefereeRedemptionAvailableAnnouncement:i=e.jsx(Hc,{});break;case B.ReferralProgramUpsellAnnouncement:i=e.jsx(Fc,{});break;case B.StudentsUpsellAnnouncement:i=e.jsx(Lc,{});break;case B.ModelDeprecationBanner:i=Dc(a);break;case B.TeamsContextualAnswersUpsell:i=e.jsx(Oc,{});break;case B.KanziConfig:i=!1;break;case B.LanguageUpsellBanner:i=e.jsx(Ic,{onDismissSideEffect:()=>{T.logEventWithStatsig("Language Upsell Banner Dismissed","chatgpt_web_language_upsell_banner_dismissed"),r.closeBanner()},onPrimaryCtaClickSideEffect:()=>{T.logEventWithStatsig("Language Upsell Banner Primary CTA Clicked","chatgpt_web_language_upsell_banner_primary_cta_clicked"),r.closeBanner()}});break;default:i=null;break}return i}function Ef(){const{store:t}=Ce(),s=t.useContentAreaId(Ut.HeaderBottom);let n;switch(s){case oi.DallePromptControls:n=e.jsx(Tf,{});break;default:n=null;break}return n}const Pf=Qn(()=>Xn(()=>import("./kh2oujy0lnfc0doj.js"),__vite__mapDeps([7,1,2,3,4,5])).then(t=>t.default));function Tf(){const{store:t}=Ce(),s=t.useSharedProps(n=>n?.composerController);return s?e.jsx(Pf,{composerController:s}):null}function Nf(){const{store:t}=Ce(),s=t.useSharedProps(a=>a?.clientThreadId),n=Sn(),o=Jc();return s?n?e.jsx(Zc,{threadId:s,showSignUp:o}):e.jsx(eu,{threadId:s,showLogin:o}):null}function Bf(){return f.useEffect(()=>()=>{tn.getItem(Rt.TasksHasSeenProjectDisclaimerBanner)||tn.setItem(Rt.TasksHasSeenProjectDisclaimerBanner,!0)},[]),e.jsx(Pn,{icon:e.jsx(qt,{}),title:e.jsx(E,{id:"ibX3g7",defaultMessage:"Tasks can’t access project files"}),content:e.jsx(E,{id:"fm94Tm",defaultMessage:"There’s a task in this conversation — just FYI, it won’t be able to access project files."}),onDismiss:()=>{tn.setItem(Rt.TasksHasSeenProjectDisclaimerBanner,!0)}})}function If(){const{store:t}=Ce(),s=t.useSharedProps(n=>n?.clientThreadId);return s?e.jsx(tu,{threadId:s}):null}function Of(){const{store:t}=Ce(),s=t.useSharedProps();return s?e.jsx(hf,{...s}):null}function Df(){const{store:t}=Ce(),s=t.useSharedProps(o=>o?.clientThreadId),n=t.useSharedProps(o=>o?.composerController);return!s||!n?null:e.jsx(bf,{clientThreadId:s,composerController:n})}const Lf=5,Ff=f.memo(function(s){return Hf(s),Uf(s),Gf(),null});function Hf(t){const{store:s}=Ce(),n=s.useSetSharedProps();mn(()=>{n(t)},[t,n])}function Uf(t){const{clientThreadId:s,canContinue:n}=t,{store:o}=Ce(),a=f.useRef({top:o.useContentAreaApi(Ut.HeaderTop),bottom:o.useContentAreaApi(Ut.HeaderBottom)}).current,r=su(s),{shouldShowBannerSignup:i,shouldShowBannerTermsDisclaimer:u}=zf(s),l=vf(s,t.composerController),d=nu(t),m=ou(t),c=Ja(),p=au(),S=iu(t),h=kf(s),g=ru(t),x=lu(s),v=cu(s),y=ap(),{eligible:_}=Le(uu),P=du(),R=mu(),M=pu(),w=fu(),j=gu(s),N=hu(s),D=xu(),L=Su(s),z=bu(s),b=Cu(s),I=le(s,k=>k?.modelId),G=js(s),W=ai();mn(()=>{I&&G?.kind===Oe.GizmoInteraction&&G.gizmo&&yu(I,G.gizmo)?a.top.set(B.ProjectConversationTaskNoFileAccess):g.eligible?a.top.set(B.AdvancedVoiceOnMobileAnnouncement):u?a.top.set(B.BannerTermsDisclaimer):l?a.top.set(B.BannersRateLimit):D?a.top.set(B.BannerPlusUpsell):L?a.top.set(B.ContextualAnswersAdminUpsell):z?a.top.set(B.ContextualAnswersUserUpsell):x?a.top.set(B.JawboneAnnouncement):v?a.top.set(B.JawboneMaxActiveAnnouncement):d.eligible?a.top.set(B.BannerSidekickAnnouncement):c?a.top.set(B.MoonshineAnnouncement):p?a.top.set(B.CustomizeChatGPTAnnouncement):m?a.top.set(B.SearchBrowserExtensionAnnouncement):S?a.top.set(B.SearchBrowserExtensionReactiveAnnouncement):y?a.top.set(B.PromoRedemptionAnnouncement):_?a.top.set(B.OperatorAnnouncement):M?a.top.set(B.ReferralProgramUpsellAnnouncement):n?a.top.set(B.PromptTextareaAction):i?a.top.set(B.BannerSignup):h?a.top.set(B.BannerMemoryFull):P?a.top.set(B.ReferrerRedemptionAvailableAnnouncement):R?a.top.set(B.RefereeRedemptionAvailableAnnouncement):w?a.top.set(B.StudentsUpsellAnnouncement):j?a.top.set(B.ModelDeprecationBanner):N?a.top.set(B.TeamsContextualAnswersUpsell):b?a.top.set(B.LanguageUpsellBanner):a.top.set(null)},[a,W,n,u,i,l,d,h,g]),mn(()=>{r&&a.bottom.set(oi.DallePromptControls)},[a,r])}function Gf(){const{store:t}=Ce();f.useEffect(()=>()=>{t.reset()},[t])}function zf(t){const{isUnauthenticated:s}=Te(),{layer:n}=Ke("3637408529",{shouldLogExposure:!1}),{layer:o}=Ke("3637408529"),a=o.get("no_auth_banner_signup_rate_limit",Lf),r=n.get("should_show_no_auth_signup_banner",!0),i=vu(c=>c.bannerDisclaimerClientThreadId),u=wu(),l={shouldShowBannerTermsDisclaimer:!1,shouldShowBannerSignup:!1},[d,m]=le(t,c=>[se.getConversationTurns(c).filter(p=>p.role===Fi.User).length,Wf(se.getCurrentNode(c)?.message)]);return t&&(l.shouldShowBannerTermsDisclaimer=m&&s&&d===1&&!u&&(i==null||i===t),l.shouldShowBannerSignup=r&&m&&s&&d>0&&d%a===0),l}function Wf(t){return t?.author.role===Fi.Assistant&&Tm(t)}function or({clientThreadId:t,getInputProps:s,openFileDialog:n,uploadType:o,icon:a,isDisabled:r=!1,isSmall:i=!1,showLabel:u=!1,showUpsell:l=!1,hideBorder:d=!1,highlightTooltip:m=!1,disabledReason:c,currentModelName:p,visualTreatment:S}){const h=K(),g=Rs();r=(r||!!g)&&!l;const x=e.jsxs(_u,{disabled:r,$showLabel:u,$hideBorder:d,$isSmall:i,$visualTreatment:S,onClick:_=>{if(_.preventDefault(),l){T.logNoAuthAttachButtonClicked({location:"No auth upsell"});return}T.logEvent("Open File Viewer",{intent:o.toString()}),n()},"aria-label":r?c===jt.ModelNotSupported?h.formatMessage({id:"pEB4vw",defaultMessage:"Attachments disabled for {modelName}"},{modelName:`${p}`}):c===jt.ThinkModeInUse?h.formatMessage({id:"NRk4QL",defaultMessage:"Attachments disabled for Reason mode"}):c===jt.SearchModeInUse?h.formatMessage({id:"YlO80p",defaultMessage:"Attachments disabled for Search mode"}):h.formatMessage({id:"PromptFilePicker.attachFilesUnavailable",defaultMessage:"Attach files is unavailable"}):h.formatMessage({id:"PromptFilePicker.attachFiles",defaultMessage:"Upload files and more"}),children:[a,u&&e.jsx(ii,{})]}),v=e.jsx("input",{disabled:r,...s({className:"hidden"})}),y=e.jsxs("div",{className:"flex",children:[x,v]});return l?e.jsx(Vt,{label:e.jsx(E,{id:"wkpQmi",defaultMessage:"Upload files and more"}),side:"bottom",open:m||void 0,children:e.jsx(ju,{triggerButton:y,sideOffset:0,alignOffset:0,children:e.jsx(yn,{location:"attach",statsig_login_event:"chatgpt_composer_upsell_login_button_clicked",statsig_signup_event:"chatgpt_composer_upsell_signup_button_clicked"})})}):e.jsx($i,{disabled:r,clientThreadId:t,rateLimitPopup:g,highlightTooltip:m,children:y})}function Vf({code:t,message:s}){switch(t){case ua.FileTooLarge:return Na.errorFileTooLarge;case ua.TooManyFiles:return T.logEvent("Uploaded Max Files Error"),Na.errorTooManyFiles;default:return s}}const Na=Fe({attachImages:{id:"PromptFilePicker.attachImages",defaultMessage:"Attach images"},attachFiles:{id:"PromptFilePicker.attachFiles",defaultMessage:"Upload files and more"},errorFileTooLarge:{id:"PromptFilePicker.errorFileTooLarge",defaultMessage:"Your file is too large. The maximum file size is {size}MB."},errorTooManyFiles:{id:"PromptFilePicker.errorTooManyFiles",defaultMessage:"You may only upload {maxNum} files at a time."},defaultFileUploadRateLimited:{id:"U5qAWP",defaultMessage:"You've reached your daily upload limit. Get ChatGPT Plus to unlock more."},getPlusButton:{id:"TeyLcp",defaultMessage:"Get Plus"}}),Ba=Fe({dragInstructions:{id:"FileDropZone.dragInstructions",defaultMessage:"Add anything"},dragAllAccepted:{id:"FileDropZone.dragAllAccepted",defaultMessage:"Drop any file here to add it to the conversation"}});function qf(t){if(!t.accept||Object.keys(t.accept).length===0)return[];const s=[];return Object.values(t.accept).forEach(n=>s.push(...n)),s.sort()}function th(t){const{className:s,children:n,clientThreadId:o,currentModelConfig:a,noKeyboard:r}=t,i=K(),u=$e(),l=js(o),d=Wt(),m=gs(a,l,d),c=m!==it.None,p=rn(M=>M.files),S=(m===it.Multimodal?Nn:Bn)-p.length,h=S<=0,{getGizmoId:g}=In(),{handleFileAccepted:x}=ro(i,m,Dn(a,l),"drag",g,On(a,l)?.attachments),v=Rs(),y=Ln(Fn(a,l)),{getRootProps:_,isDragActive:P}=oo({maxFiles:S,disabled:!c||h||v!=null,noClick:!0,noKeyboard:r,onDropAccepted:x,onDropRejected:M=>io(M,i,u,m),multiple:!0,maxSize:Hn,...y}),R=qf(y);return e.jsxs("div",{..._({className:s}),children:[n,P&&e.jsxs(Yf,{children:[e.jsx(Au,{}),e.jsx("h3",{children:e.jsx(E,{...Ba.dragInstructions})}),e.jsx("h4",{className:"w-2/3 text-center",children:R.length>0?R.join(", "):e.jsx(E,{...Ba.dragAllAccepted})})]})]})}function io(t,s,n,o){const{errors:a}=t[0];a.forEach(r=>{const i=Vf(r);typeof i=="string"?n.danger(i,{hasCloseButton:!0}):n.danger(s.formatMessage(i,{size:Ru,maxNum:o===it.Multimodal?Nn:Bn}),{hasCloseButton:!0})})}function ro(t,s,n,o,a,r){const i=Ue(),u=Hi(i).flags,l=$e(),d=Tn(),m=ri(),{isUnauthenticated:c}=Te(),p=u?.includes(bs.NoAuthEnableFileUploads);return{handleFileAccepted:f.useCallback(async(h,g)=>{T.logEvent("Upload File",{client:"web",eventSource:o,intent:s.toString()}),m.fileUploadAccepted();const x=a!=null?await a():void 0;h.length>0&&h.forEach(v=>{ms.uploadFile(d,ku(v),v,s,n,t,l,{gizmoId:x,...p&&{isUnauthenticated:c}},r)})},[o,s,a,d,m,n,t,l,r,p,c])}}const Yf=Yn.div`absolute z-50 inset-0 flex gap-2 flex-col justify-center items-center after:contents-[""] after:absolute after:opacity-80 after:z-[-1] after:bg-token-main-surface-primary after:inset-0`,ar=t=>{const s=[];s.push({category:null,systemHints:t.filter(n=>!n.category)});for(const n of Bm)s.push({category:n,systemHints:t.filter(o=>o.category===n)});return s};function ir({composerController:t,clientThreadId:s,onHintSelected:n}){const o=Ui(s),[a]=le(s,I=>[I?.modelId]),{data:r}=$t(),i=a??Mu(void 0).id,u=li(r?.models,i),{configurationMenuType:l}=He(),{setThreadSystemHintMode:d,clearAllSystemHintModeTriggers:m}=fe(),{viewableSystemHints:c,persistedSystemHints:p}=Ye.useState(({availableHints:I,persistedSystemHints:G})=>({viewableSystemHints:I,persistedSystemHints:G})),[S,h]=f.useState([]),[g,x]=f.useState(void 0),[v,y]=f.useState(0);f.useEffect(()=>{if(!g)h([]);else{const I=g.text.toLocaleLowerCase(),G=c.filter(k=>{const U=k.name.toLocaleLowerCase().startsWith(I),Y=k.systemHint.toLocaleLowerCase().startsWith(I);let F=!1;return k.regexMatches&&k.regexMatches.length>0&&(F=k.regexMatches.some(Q=>Q.replace(/[\^\$\(\)]/g,"").toLocaleLowerCase().startsWith(I))),U||Y||F}).filter(k=>k.requiredFeatures.every(U=>u?.enabledTools?.includes(U))),W=ar(G).map(k=>k.systemHints).flat();h(W)}},[g]),f.useEffect(()=>{t.view.dispatch(hp(t.view.state.tr,{onHintMatch(I){x(G=>Nm(G,I)?G:I)}}))},[t]);const _=!c.length||!S.length||!g;f.useEffect(()=>{y(0)},[_]);const P=S.length,R=f.useCallback(I=>{y(G=>(I(G)%P+P)%P)},[P]),M=f.useCallback(()=>{y(-1)},[]),w=S[v],j=f.useCallback(()=>{g?.range&&t.delete(g.range.from,g.range.to)},[g,t]),N=({hintToSave:I=w,expectPerfectMatch:G})=>{if(!g||!w||G&&I.name.toLowerCase()!==g.text.toLowerCase())return!1;T.logEvent("System Hint Selected",{system_hint:I.systemHint,conversation_id:o??dn});const W=g.range.from===1?I.name:g.text+I.name.slice(g.text.length),k={clientThreadId:s};us(t.view),p.size>0&&m();const U=!!I.composerBarButtonInfo,Y=I.systemHint===A.Search;return U||Y||l!=="none"?(d(I.systemHint,!0,k,Y?Eu.CONVERSATION_COMPOSER_SLASH_SEARCH:void 0),j(),t.removeSystemHints(),!0):(t.addSystemHint(I.systemHint,W,g.range.from,g.range.to),!0)},D=f.useRef(N);D.current=N;const L=f.useRef(R);L.current=R;const z=f.useRef(g);z.current=g;const b=t.view;return f.useEffect(()=>(_||xp(b,I=>{if(I==="up")L.current(G=>G-1);else if(I==="down")L.current(G=>G+1);else if(I==="cancel")us(b),Sp(b);else if(I==="submit")if(n)j(),n(w.systemHint);else return us(b),D.current({expectPerfectMatch:!1});else if(I==="checkMatch")return D.current({expectPerfectMatch:!0})}),()=>us(b)),[_,b,w,n,j]),f.useEffect(()=>{_||T.logEvent("System Hint List Opened",{conversation_id:o??dn})},[_]),{suggestorClosed:_,systemHintSuggestions:S,hintMatch:g,selectedIndex:v,resetSelectedIndex:M,setSelectedIndex:y,saveHint:N}}function Kf({composerController:t,clientThreadId:s}){const{selectedIndex:n,systemHintSuggestions:o,suggestorClosed:a,setSelectedIndex:r,saveHint:i}=ir({composerController:t,clientThreadId:s});return a?null:e.jsx(Pu,{className:"max-w-60",onMouseDown:u=>{u.preventDefault()},children:o.map((u,l)=>e.jsx("div",{onMouseOver:()=>r(l),onClick:()=>{i({hintToSave:u,expectPerfectMatch:!1}),t.focus()},children:e.jsx(Tu,{autoFocus:!1,className:"rounded-lg px-1 py-2",highlighted:l===n,children:e.jsx(rr,{title:u.name,description:u.description,logo:u.logo})})},u.systemHint))})}function rr({title:t,description:s,logo:n,checked:o,badge:a}){const r=K();return e.jsxs("div",{className:"group inline-flex w-full items-center justify-start gap-2 ps-1.5 pe-3",children:[e.jsx("div",{className:"flex h-7 w-7 items-center justify-center gap-2.5",children:e.jsx(Kt,{svgString:n,className:"icon-lg text-token-text-secondary"})}),e.jsxs("div",{className:"shrink grow basis-0",children:[e.jsxs("p",{className:"text-token-text-primary text-sm leading-tight font-normal",children:[t,a&&e.jsx("span",{className:"ms-2 rounded-full bg-blue-400 px-2 py-0.5 text-xs text-white","aria-label":r.formatMessage({id:"I75WNJ",defaultMessage:"Create image updated"}),children:e.jsx(E,{id:"uUmZQi",defaultMessage:"Updated"})})]}),!!s&&e.jsx("p",{className:"text-token-text-secondary text-[13px] leading-[18px] font-normal",children:s})]}),o&&e.jsx(Nu,{className:q("icon-md text-token-text-primary",{"group-hover:hidden":!o})})]})}function Ia({composerController:t,clientThreadId:s}){return t instanceof bp?e.jsx(Kf,{composerController:t,clientThreadId:s}):null}function lr({children:t,className:s,showBackground:n,showGlowingBorder:o}){return e.jsxs("div",{className:q("relative",o&&"overflow-clip rounded-full p-0.5"),children:[t,o&&e.jsx("div",{className:"border-glowing-gradient"}),n&&e.jsx(Z.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:q("pointer-events-none absolute inset-0 rounded-full",s)})]})}const $f=({showUnconnectedInSubmenu:t,unconnectedConnectors:s,handleOauthRedirect:n,handleConnectorClick:o,showOneDriveInSubmenu:a,isConnectorConfigLoading:r,connectedConnectors:i,desktopConnectors:u,modelSupportedImageMimeTypes:l,showMenuForNoAuth:d,handleLocalFileUploadClick:m,unconnectedOneDriveConnectors:c})=>{const[p,S]=f.useState("main"),h=p!=="main",g=K(),x=f.useRef(null),v=Un();return f.useEffect(()=>{h?document.getElementById("vanguard-file-picker-popover-submenu-back-button")?.focus():x.current&&x.current.focus()},[h]),e.jsx("div",{className:q("max-h-[max(calc(var(--radix-popover-content-available-height)-64px), 215px)] flex flex-1 snap-y snap-proximity flex-col overflow-y-auto scroll-smooth py-2 [scrollbar-gutter:stable] focus-visible:rounded-[inherit] focus-visible:-outline-offset-1"),ref:x,tabIndex:0,children:e.jsxs(mt,{mode:"wait",children:[e.jsx(Z.div,{className:"flex flex-col",transition:v?Gt:fs,children:p==="main"&&e.jsx(Qf,{showUnconnectedInSubmenu:t,unconnectedConnectors:s,setActiveMenu:S,handleConnectorClick:o,showOneDriveInSubmenu:a,isConnectorConfigLoading:r,connectedConnectors:i,desktopConnectors:u,modelSupportedImageMimeTypes:l,showMenuForNoAuth:d,handleLocalFileUploadClick:m})},"main"),h&&e.jsxs(Z.div,{initial:{clipPath:"inset(0 100% 0 0)",opacity:0},animate:{clipPath:"inset(0 0% 0 0)",opacity:1},transition:v?Gt:fs,className:"flex flex-col",children:[e.jsxs("div",{className:"border-token-border-xlight bg-token-main-surface-primary dark:bg-token-main-surface-secondary sticky start-0 top-0 z-10 flex w-full flex-row items-center justify-center overflow-clip border-b px-3 py-3",children:[e.jsx("button",{onClick:()=>S("main"),id:"vanguard-file-picker-popover-submenu-back-button",className:"hover:bg-token-main-surface-tertiary flex items-center rounded-md p-1",children:e.jsx(Za,{className:"text-token-text-secondary h-5 w-5","aria-label":""})}),e.jsx("div",{className:"flex-auto text-center text-sm font-medium",children:g.formatMessage({id:"LlLQYj",defaultMessage:"Back"})}),e.jsx("div",{className:"w-5"})]}),e.jsxs("div",{className:"flex w-full flex-col py-2",children:[p==="connect-apps"&&e.jsx(Bu,{connectorEntries:s,onOauthRedirect:n}),p==="one-drive"&&e.jsx(Iu,{connectorEntries:c,onOauthRedirect:n})]})]},p)]})})};function Qf({showUnconnectedInSubmenu:t,unconnectedConnectors:s,showOneDriveInSubmenu:n,setActiveMenu:o,handleConnectorClick:a,isConnectorConfigLoading:r,connectedConnectors:i,desktopConnectors:u,modelSupportedImageMimeTypes:l,showMenuForNoAuth:d,handleLocalFileUploadClick:m}){const c=K();return e.jsxs(e.Fragment,{children:[t&&s.length>0&&e.jsx(ut,{label:c.formatMessage(Oa.connectApps),icon:Rn,isSubMenuTrigger:!0,onClick:()=>o("connect-apps")},"connect-apps-submenu-trigger"),!t&&s.map(p=>e.jsx(hs,{entry:p,onClick:()=>a(p),visualTreatment:"vanguard"},p.id)),n&&e.jsx(ut,{label:c.formatMessage(Oa.oneDriveSubmenuName),icon:Ou,isSubMenuTrigger:!0,onClick:()=>o("one-drive")},"one-drive-submenu-trigger"),r&&e.jsx(ut,{icon:e.jsx(Yt,{className:"text-token-text-secondary"})}),(s.length>0||r)&&e.jsx(ei,{}),i.map(p=>e.jsx(hs,{entry:p,onClick:()=>a(p),visualTreatment:"vanguard"},p.id)),u.map(p=>e.jsx(ci,{entry:p,visualTreatment:"vanguard"},p.key)),e.jsx(ui,{modelSupportedImageMimeTypes:l}),e.jsx(di,{handleLocalFileUploadClick:m,showMenuForNoAuth:d})]})}const Oa=Fe({connectApps:{id:"ContextConnectorPicker.connectApps",defaultMessage:"Connect apps"},oneDriveSubmenuName:{id:"ContextConnectorPickerOneDriveSubmenu.oneDriveSubmenuName",defaultMessage:"Connect to Microsoft OneDrive"}}),Xf=({layoutMode:t,triggerButton:s,restoreFocus:n,...o})=>e.jsxs(to,{layoutMode:t,restoreFocus:n,children:[s,e.jsx(so,{align:"start",children:e.jsx($f,{...o})})]});function Jf(){const{connectorConfig:t}=mi(),s=Gn(),n=zn(),[o,a]=xs(pi([...t.values()],m=>!!m.access_token),m=>!!m.access_token),[r,i]=xs(a,m=>m.type===qe.O365_PERSONAL||m.type===qe.O365_BUSINESS),u=!s&&!n&&o.length>0,l=!s&&!n&&!u&&r.length>1;return{unconnectedConnectors:n?[]:l?i:a,showUnconnectedInSubmenu:u,showOneDriveInSubmenu:l}}function cr({clientThreadId:t,icon:s,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:o,attachmentsProductFeature:a,onOauthRedirect:r,uploadType:i,getInputProps:u,openFileDialog:l,isDisabled:d=!1,highlightTooltip:m=!1,showLabel:c,isSmall:p=!1,hideBorder:S=!1,disabledReason:h,currentModelName:g,visualTreatment:x="vanguard",showMenuForNoAuth:v=!1,showGlowingBorder:y=!1,layoutMode:_="centered",restoreFocus:P}){const R=Im().locale,M=K(),w=$e(),j=Tn(),N=Rs(),{connectorConfig:D,isLoading:L}=mi(),z=Le(pe.ContextConnectors),{getGizmoId:b}=In(),{value:I}=ae("58345806"),{configurationMenuType:G}=He(),W=G!=="none",k=I&&x==="vanguard",[U,Y]=f.useState();f.useEffect(()=>{b?b().then(O=>Y(O)):Y(void 0)},[b]);const F=f.useRef(null),[Q,ie]=f.useState(!1),ye=f.useRef(!1),Ge=f.useCallback(()=>{const O=F.current?.files;Array.from(O??[]).forEach(de=>Lt.uploadFile(j,de,o,M,w,a))},[j,o,M,w,a]),[pt,Ne]=f.useState(null),Qe=f.useCallback(()=>Ne(null),[Ne]),Xe=f.useCallback((O,de)=>Lt.uploadPickedFile(j,O,de,o,n,a,U,M,w),[j,o,n,a,U,M,w]),{openMenu:ve,confirmMenuOpened:we}=Du();f.useEffect(()=>{ve&&(ie(!0),we())},[ve,we,ie]);const _e=f.useCallback(O=>{Lt.doContextConnectorOauthRedirect(location.pathname+location.search+location.hash,O,r,wa.Picker),r()},[r]),Je=f.useCallback(O=>{Lt.uploadPickedFile(j,O,qe.GDRIVE,o,n,a,U,M,w)},[j,o,n,a,U,M,w]),ge=f.useCallback(async O=>{const{access_token:de}=O;if(!de){_e(O);return}switch(Lt.logAttemptIfAccessTokenIsExpired(O,wa.Picker),O.type){case qe.GDRIVE:Lu(R,O.type,de,ht=>ht.forEach(Je));break;case qe.O365_PERSONAL:case qe.O365_BUSINESS:Ne(O.type);break}},[Je,_e,Ne,R]),Be=()=>{T.logEvent("Open File Viewer",{intent:i.toString()}),l()},oe=O=>{if(!O&&ye.current&&!L)Be();else if(O&&Ae&&!L&&!v){Be();return}ie(O),O&&(z.eligible&&z.markAsViewed(),T.logEventWithStatsig("Composer: Open Context Connector Picker","chatgpt_composer_open_context_connector_picker"),ye.current=!0,setTimeout(()=>{ye.current=!1},250))},[je,ft]=xs(pi([...D.values()],O=>!!O.access_token),O=>!!O.access_token);Zf(je,ge);const[Ze]=xs(ft,O=>O.type===qe.O365_PERSONAL||O.type===qe.O365_BUSINESS),{unconnectedConnectors:ce,showUnconnectedInSubmenu:ke,showOneDriveInSubmenu:ne}=Jf(),{desktopConnectors:Re}=Fu(o),Ae=!je.length&&!ce.length&&!Re.length,Pt=e.jsxs(e.Fragment,{children:[ke&&ce.length>0&&e.jsx(Hu,{connectorEntries:ce,onOauthRedirect:O=>_e(O)}),!ke&&ce.map(O=>e.jsx(hs,{entry:O,onClick:()=>ge(O)},O.id)),ne&&e.jsx(Uu,{connectors:Ze,onOauthRedirect:_e}),L&&e.jsx(H.Item,{icon:e.jsx(Yt,{className:"text-token-text-secondary"})}),(ce.length>0||L)&&e.jsx(H.Separator,{}),je.map(O=>e.jsx(hs,{entry:O,onClick:()=>ge(O)},O.id)),Re.map(O=>e.jsx(ci,{entry:O},O.key)),e.jsx(ui,{modelSupportedImageMimeTypes:o}),e.jsx(di,{handleLocalFileUploadClick:Be,showMenuForNoAuth:v})]}),ue=d||N!=null,gt=f.useRef(!1);let Me;W?Me=e.jsx($i,{clientThreadId:t,rateLimitPopup:N,highlightTooltip:m,disabled:ue,disabledReason:h,currentModelName:g,children:e.jsxs(H.BasicTrigger,{className:"composer-btn",disabled:ue,id:"upload-file-btn","aria-label":dp(M,ue,h,g),children:[s,c&&e.jsx(ii,{})]})}):k?Me=e.jsx(mp,{clientThreadId:t,icon:s,isDisabled:ue,highlightTooltip:m,showLabel:c,hideBorder:S,isSmall:p,disabledReason:h,currentModelName:g,visualTreatment:x,isLoading:L,handleLocalFileUploadClick:Be,noAvailableConnectors:Ae,showMenuForNoAuth:v,announcement:z,rateLimit:N}):Me=e.jsx(pp,{clientThreadId:t,icon:s,setOpen:oe,open:Q,isDisabled:ue,highlightTooltip:m,showLabel:c,hideBorder:S,isSmall:p,disabledReason:h,currentModelName:g,visualTreatment:x,showGlowingBorder:y,rateLimit:N});const et=k?e.jsx(Xf,{layoutMode:_,triggerButton:Me,showUnconnectedInSubmenu:ke,unconnectedConnectors:ce,handleOauthRedirect:_e,handleConnectorClick:ge,showOneDriveInSubmenu:ne,isConnectorConfigLoading:L,connectedConnectors:je,desktopConnectors:Re,modelSupportedImageMimeTypes:o,showMenuForNoAuth:v,handleLocalFileUploadClick:Be,unconnectedOneDriveConnectors:Ze,restoreFocus:P}):e.jsxs(H.Root,{open:Q,onOpenChange:oe,children:[Me,e.jsx(H.Portal,{children:e.jsx(H.Content,{alignOffset:-8,onEscapeKeyDown:()=>{gt.current=!0},side:W?"bottom":"top",size:"small",onCloseAutoFocus:O=>{gt.current||O.preventDefault()},className:"radix-side-bottom:flex-col-reverse flex flex-col",children:Pt})})]});return e.jsxs("div",{className:"flex flex-col",children:[e.jsx(Gu,{type:pt,onClose:Qe,uploadPickedFile:Xe}),e.jsx("input",{onChange:Ge,...u({className:"hidden"})}),et,e.jsx(zu,{hasConnectors:!L&&!Ae})]})}function Zf(t,s){const{connector:n,clearParam:o}=Wu(),a=t.find(r=>r.type===n&&!!r.access_token);f.useEffect(()=>{a&&(s(a),o())},[a,s,o])}function eg({clientThreadId:t,uploadType:s,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:o,attachmentsProductFeature:a,getInputProps:r,openFileDialog:i,onOauthRedirect:u,historyDisabled:l,isDisabled:d,highlightTooltip:m,disabledReason:c,currentModelName:p,showLabel:S,showUpsell:h,hideBorder:g,isSmall:x,showMenuForNoAuth:v,visualTreatment:y,showGlowingBorder:_}){const P=zn(),{gdriveStatus:R,o365Status:M}=fi(),{isUnauthenticated:w}=Te(),j=l?"text-white":m?"text-brand-blue-800":"",N=!h&&(v||R!=="false"||M!=="false"||P),D=w?ln:Vu,L=e.jsx(D,{"aria-label":"",className:q("icon-md",j)}),z=N?e.jsx(cr,{showGlowingBorder:_,hideBorder:g,isSmall:x,clientThreadId:t,icon:L,showLabel:w&&S,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:o,attachmentsProductFeature:a,onOauthRedirect:u,uploadType:s,openFileDialog:i,getInputProps:r,isDisabled:d,highlightTooltip:m,disabledReason:c,currentModelName:p,showMenuForNoAuth:v,visualTreatment:y}):e.jsx(or,{isSmall:x,hideBorder:g,clientThreadId:t,uploadType:s,openFileDialog:i,getInputProps:r,showLabel:S,showUpsell:h,icon:L,isDisabled:d,highlightTooltip:m,disabledReason:c,currentModelName:p,visualTreatment:y});return e.jsx(lr,{showBackground:m,showGlowingBorder:_,className:"bg-brand-blue-800/20",children:z})}const tg=f.forwardRef(function({type:s,placeholder:n,replyRegions:o,state:a,renderFiles:r,leftSideActions:i,topRightAction:u,onSubmit:l,setIsComposerOverflowing:d,inputState:m,composerController:c,clientThreadId:p,gizmoId:S,disableReason:h,matchaData:g},x){const v=qu();let y=null;const{isLoading:_}=v;_||(y=v.modelId),f.useEffect(()=>{_||Yu()||c.focus()},[y,c,_]);const{value:P}=ae("3780975974"),{state:R,shouldShowResearchText:M}=Ss(p),w=f.useCallback(()=>e.jsx(gi,{useStartButtonText:R==="clarify"||!1,inputState:m,state:a,onSubmit:l,composerController:c,clientThreadId:p,gizmoId:S,disableReason:h}),[m,a,l,c,p,S,h,g,R]),{whisperControls:j,waveContainerRef:N}=Qi({composerController:c,renderInComposer:w,composerType:"legacy"}),{controlsDisabled:D,waveformData:L,waveWidth:z}=rt(c.store),{getShowUpsellReason:b}=hi(),I=P||b(),G=W=>{sg({target:W.target,rootId:"composer-background",additonalInteractiveIds:["reply-regions"]})||c.focus()};return e.jsx(Ku,{id:"composer-background",ref:x,className:q("border-token-border-default flex w-full cursor-text flex-col overflow-clip rounded-t-3xl border-t duration-150 ease-in-out contain-inline-size motion-safe:transition-[color,background-color,border-color,text-decoration-color,fill,stroke,box-shadow,bottom] dark:border-none dark:shadow-none",s!=="temporary"&&"shadow-[0_9px_9px_0px_rgba(0,0,0,0.01),_0_2px_5px_0px_rgba(0,0,0,0.06)] has-focus:shadow-[0_2px_12px_0px_rgba(0,0,0,0.04),0_9px_9px_0px_rgba(0,0,0,0.01),0_2px_5px_0px_rgba(0,0,0,0.06)]",s!=="temporary"&&"bg-token-main-surface-primary dark:bg-[#303030]",s==="temporary"&&"dark bg-[#303030]","rounded-b-3xl border-b"),onClick:G,style:{viewTransitionName:"var(--vt-composer)"},children:e.jsxs("div",{className:"px-3 py-1",children:[e.jsx(mt,{initial:!1,children:o.length>0&&e.jsx(Z.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0,transition:{duration:.06}},transition:{ease:"easeOut",duration:.1},id:"reply-regions",children:e.jsx("div",{className:"-mx-2",children:e.jsx(xi,{replyRegions:o})})})}),e.jsxs(e.Fragment,{children:[r,e.jsx(mt,{initial:!1,children:e.jsx(yp,{enabled:M,composerController:c,visualTreatment:"legacy",children:e.jsxs("div",{id:"composer-waveform-container",className:"flex min-h-[44px] items-start ps-1",ref:N,children:[e.jsx("div",{className:"max-w-full min-w-0 flex-1",children:D?L?e.jsx($u,{waveform:L,containerWidth:z,scaleFactor:10,initialValue:vp}):null:e.jsx(wp,{composerController:c,placeholder:n})}),e.jsx("div",{className:"w-[32px] pt-1",children:u})]})})}),e.jsxs("div",{className:"mt-1 mb-2 flex items-center justify-between sm:mt-5",ref:W=>{if(!I||!("ResizeObserver"in window))return;const k=new AbortController;let U=window.innerWidth;const Y=Qu({axis:"width",debounce:!0,target:W,onChange:()=>{if(!W)return;W.scrollWidth>W.clientWidth?d?.(!0):Math.abs(U-window.innerWidth)>40&&(d?.(!1),U=window.innerWidth)}});return()=>{Y?.(),k.abort()}},children:[e.jsx("div",{className:"text-token-text-primary flex gap-x-1.5",id:"composer-left-actions",children:i}),e.jsx("div",{className:"flex gap-x-1.5",id:"composer-voice-controls",children:j})]})]})]})})});function sg({target:t,rootId:s,additonalInteractiveIds:n}){let o=t;for(;o&&o!=null;){if(o.tagName==="BUTTON"||o.tagName==="INPUT"||o.tagName==="TEXTAREA"||o.isContentEditable||n.includes(o.id))return!0;if(o.id===s)return!1;o=o.parentElement}return!1}const ng=["o3-mini","o3-mini-high","o1-pro"],og=[A.Search,A.Research],ag=5,ig=({composerController:t,clientThreadId:s,hideThinkButton:n,disableIfNoAccess:o,disabled:a})=>{const{prospectiveModelId:r}=_s(s),{systemHints:i,activeSystemHints:u,isLoading:l}=Wn(s),d=ae("2868048419"),m=Ti(k=>k.bySystemHint(A.Research)),c=$n(),p=Kn(),{value:S}=ae("1416952492"),h=De(k=>k.isVisuallyOverflowing),{showLegacyReasoningSlider:g,hideSearchInSystemHintOverflow:x,hideReasonInSystemHintOverflow:v,configurationMenuType:y}=He(),_=Et()?.isFree(),P=y!=="none",R=u.filter(k=>P&&(_||k.systemHint!==A.Think)||x&&k.systemHint===A.Search||v&&k.systemHint===A.Think?!0:h&&g?k.systemHint!==A.Think&&!k.composerBarButtonInfo&&!og.includes(k.systemHint):!k.composerBarButtonInfo&&k.systemHint!==A.Search&&(!d||k.systemHint!==A.PictureV2)&&(!n||k.systemHint!==A.Think));if(P&&_&&!R.find(k=>k.systemHint===A.Think)){const k=i.find(U=>U.systemHint===A.Think);k&&R.push(k)}const M=Vn(t),w=Xu(t,s),{clearAllSystemHintModeTriggers:j}=fe(),N=r&&ng.includes(r),D=R.length===0&&!l||N;if(!o&&D)return null;const L={clientThreadId:s};function z(){T.logEventWithStatsig("Composer System Hint Button Hovered","composer_system_hint_button_hovered",L)}function b(){T.logEventWithStatsig("Composer System Hint Button Clicked","composer_system_hint_button_clicked",L)}const I=k=>{switch(k){case A.Research:return!!p;case A.Think:return!!c;default:return!1}},G=()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{t.focus()})})},W=P?lg:rg;return e.jsx(W,{systemHints:R,selectedHint:M??void 0,disabled:a,onHover:z,onOpen:b,onSelect:w,clientThreadId:s,isDeepResearchHighLoad:S,getFeatureRateLimitIndicator:k=>{switch(k){case A.Research:return cg(m);case A.Think:return c?e.jsx(qt,{"aria-label":"",className:"icon-md text-token-text-secondary h-5 w-5"}):null;default:return null}},hasFeatureRateLimit:I,setRateLimitBannerFeature:k=>{switch(k){case A.Research:case A.Think:I(k)?(j(),t.setRateLimitBannerFeature(k===A.Research?_a.DEEP_RESEARCH:_a.REASON)):t.setRateLimitBannerFeature(null);break;default:t.setRateLimitBannerFeature(null);break}},restoreFocus:G})},rg=({systemHints:t,selectedHint:s,disabled:n,onHover:o,onOpen:a,onSelect:r,isDeepResearchHighLoad:i,hasFeatureRateLimit:u,restoreFocus:l})=>{const d=K(),[m,c]=f.useState(!1),p=t.find(x=>x.systemHint==="contextual_answers")?.name,S=f.useRef(!1);f.useEffect(()=>{if(!m)return()=>{requestAnimationFrame(()=>{S.current=!1})}},[m]);const h=f.useRef(!1),g=t.length===0?e.jsxs("div",{className:"mx-2 flex min-h-[40px] flex-col justify-center gap-2",children:[e.jsx("div",{className:"loading-results-shimmer bg-token-bg-tertiary h-9 w-[180px] rounded-md"}),e.jsx("div",{className:"loading-results-shimmer bg-token-bg-tertiary h-9 w-[180px] rounded-md"})]}):e.jsx(e.Fragment,{children:t.map(x=>e.jsx(H.Item,{className:"px-1 py-2",onClick:()=>{const v=x.systemHint!==s;u(x.systemHint)||(S.current=!0,r?.({hint:x,enable:v}))},disabled:x.systemHint===A.Research?i:void 0,children:e.jsx(rr,{title:x.name,description:x.description,logo:x.logo,checked:x.systemHint===s,badge:x.systemHint===A.PictureV2})},x.systemHint))});return e.jsxs(H.Root,{open:m,onOpenChange:x=>{c(x),x?a?.():requestAnimationFrame(()=>{requestAnimationFrame(()=>{S.current&&l()})})},children:[e.jsx(ur,{disabled:!!n,contextualAnswersHintNameIfPresent:p,children:e.jsx(Si,{className:"border-token-border-default text-token-text-secondary radix-state-open:bg-black/10 can-hover:hover:bg-tertiary flex h-9 min-w-9 items-center justify-center rounded-full border p-1 text-xs font-semibold focus-visible:outline-black disabled:opacity-30 dark:focus-visible:outline-white","data-opened":cn(m),"aria-label":d.formatMessage({id:"oDAnGy",defaultMessage:"Use a tool"}),id:"system-hint-button",disabled:n,onPointerOver:o,onClick:x=>{x.preventDefault()},onFocusCapture:x=>{x.stopPropagation()},children:e.jsx(Zu,{className:"pointer-events-none h-5 w-5"})})}),e.jsx(H.Portal,{children:e.jsx(H.Content,{size:"auto",alignOffset:-16,onEscapeKeyDown:()=>{h.current=!0},onCloseAutoFocus:x=>{if(!h.current||S.current){x.preventDefault();return}document.querySelector("#system-hint-button")?.focus()},children:g})})]})},lg=({systemHints:t,selectedHint:s,disabled:n,onHover:o,onOpen:a,onSelect:r,clientThreadId:i,getFeatureRateLimitIndicator:u,isDeepResearchHighLoad:l,hasFeatureRateLimit:d,setRateLimitBannerFeature:m,restoreFocus:c})=>{const p=K(),[S,h]=f.useState(!1),g=t.find(w=>w.systemHint==="contextual_answers")?.name,{configurationMenuType:x}=He(),v=x==="config_icon"||x==="skills_icon",_=(x==="settings_icon"||x==="skills_icon")&&s==null,P=v?Ju:bi,R=f.useRef(!1);f.useEffect(()=>{if(!S)return()=>{requestAnimationFrame(()=>{R.current=!1})}},[S]);const M=f.useRef(!1);return e.jsxs(H.Root,{open:S,onOpenChange:w=>{h(w),w?a?.():requestAnimationFrame(()=>{requestAnimationFrame(()=>{R.current&&c()})})},children:[e.jsx(ur,{disabled:!!n,contextualAnswersHintNameIfPresent:g,newToolsConfigMenu:x,skip:_,children:e.jsxs(Si,{className:"composer-btn","data-opened":cn(S),"data-pill":cn(_),"aria-label":v?p.formatMessage({id:"RiMXTh",defaultMessage:"Use a skill"}):p.formatMessage({id:"mJYhKI",defaultMessage:"Choose tool"}),id:"system-hint-button",disabled:n,onPointerOver:o,onClick:w=>{w.preventDefault()},onFocusCapture:w=>{w.stopPropagation()},children:[e.jsx(P,{"aria-label":"",className:"icon-md"}),_&&e.jsx("span",{className:"ms-1.5 me-0.5",children:v?e.jsx(E,{id:"5+Ls1e",defaultMessage:"Skills"}):e.jsx(E,{id:"mNL7WC",defaultMessage:"Tools"})})]})}),e.jsx(H.Portal,{children:e.jsx(H.Content,{size:"auto",alignOffset:-8,onEscapeKeyDown:()=>{M.current=!0},onCloseAutoFocus:w=>{if(!M.current||R.current){w.preventDefault();return}document.querySelector("#system-hint-button")?.focus()},children:e.jsxs(H.RadioGroup,{value:s,onValueChange:w=>{const j=t.find(N=>N.systemHint===w);j&&(Cn(j.systemHint,j.systemHint===s?Se.Disable:Se.Enable,i),s===w?r?.({hint:j,enable:!1}):d(j.systemHint)||(R.current=!0,r?.({hint:j,enable:!0}),m(j.systemHint)))},children:[!_&&e.jsx(H.Label,{children:v?e.jsx(E,{id:"m/042P",defaultMessage:"Skills"}):e.jsx(E,{id:"KSn3Jr",defaultMessage:"Tools"})}),t.length===0?e.jsxs(e.Fragment,{children:[e.jsx(H.Shimmer,{}),e.jsx(H.Shimmer,{}),e.jsx(H.Shimmer,{})]}):e.jsx(e.Fragment,{children:t.map(w=>{const j=w.actionLabel??w.name,N=u(w.systemHint),D=w.systemHint===A.Research&&l,L=w.systemHint===s;return e.jsx(H.RadioItem,{value:w.systemHint,disabled:D,color:L?"selected":"default",icon:e.jsx(Kt,{svgString:w.logo,"aria-label":"",className:"icon-md"}),trailing:!D&&!L&&N?e.jsx("span",{className:"text-token-text-secondary",children:N}):e.jsx(H.RadioItemCheck,{}),children:D?e.jsxs("div",{className:"flex flex-col",children:[j,D&&e.jsx("span",{className:"text-xs",children:e.jsx(E,{id:"composer.skills.unavailable",defaultMessage:"Temporarily unavailable"})})]}):j},w.systemHint)})})]})})})]})},ur=({disabled:t,children:s,contextualAnswersHintNameIfPresent:n,newToolsConfigMenu:o,skip:a})=>{const r=o!=null,i=o==="config_icon"||o==="skills_icon",u=Le(pe.hasSeenComposerSystemHintButtonTooltip),l=Le(pe.hasSeenCaSystemHint),d=!t&&!u.isLoading&&u.eligible,m=!t&&!u.isLoading&&n&&!l.isLoading&&l.eligible,c=d?{announcementKey:pe.hasSeenComposerSystemHintButtonTooltip,title:r&&i?e.jsx(E,{id:"H819Oo",defaultMessage:"ChatGPT skills, all in one place"}):e.jsx(E,{id:"tTydhk",defaultMessage:"All your tools, in one handy place"}),onDismiss:u.markAsViewed,description:e.jsx(E,{id:"Kgb5fv",defaultMessage:"Create an image, research report, and more."})}:m?{announcementKey:pe.hasSeenCaSystemHint,title:e.jsx(E,{id:"uaC1JM",defaultMessage:"Not finding internal information?"}),onDismiss:l.markAsViewed,description:e.jsx(E,{id:"TL/S+W",defaultMessage:"If ChatGPT didn't search your files automatically, type {hintName} or select it from the menu.",values:{hintName:e.jsx("span",{className:"font-bold whitespace-nowrap",children:'"/'+n+'"'})}})}:void 0;if(a)return s;if(c)return e.jsx(Mn,{show:!0,side:"bottom",theme:"bright",dismissOnOutsideClick:!0,badge:"new",sideOffset:0,className:"xs:max-w-sm! max-w-2xs!",...c,children:s});let p;return t?p=i?e.jsx(E,{id:"R3rcdg",defaultMessage:"Skills unavailable"}):e.jsx(E,{id:"uw9x80",defaultMessage:"Tools unavailable"}):r?p=i?e.jsx(E,{id:"SiU5Ib",defaultMessage:"Choose skill"}):e.jsx(E,{id:"Yr1zf1",defaultMessage:"Choose tool"}):p=e.jsx(E,{id:"mrYNGk",defaultMessage:"View tools"}),e.jsx(Vt,{side:"bottom",label:p,children:s})};function cg(t){return!t||t.remaining>ag?null:t.remaining===0?e.jsx(qt,{"aria-label":"",className:"icon-md text-token-text-secondary h-5 w-5"}):e.jsx(E,{id:"m6JsYD",defaultMessage:"{remaining} left",values:{remaining:t.remaining}})}const dr=({clientThreadId:t})=>{const s=Om(),{setThreadSystemHintMode:n}=fe(),o=s?.location.search;f.useEffect(()=>{if(new URLSearchParams(window.location.search).get("enable-internal-knowledge")==="true"&&document){n(A.ContextualAnswers,!0,{clientThreadId:t});const r=new URLSearchParams(window.location.search);r.delete("enable-internal-knowledge");const i=r.toString();window.history.replaceState({},document.title,`${window.location.pathname}${i?`?${i}`:""}`)}},[o,t,n])},ug=({composerController:t,systemHint:s,clientThreadId:n,connectionStatuses:o})=>{const a=ys(),r=s.systemHint,i=zt(r);dr({clientThreadId:n});const u=Ue();if(!s.composerBarButtonInfo)return null;const l=o.some(p=>p.user_connection_details.activation_status==="partially_activated"||p.user_connection_details.activation_status==="activated"),d=Jn(u,"463092697")?.value,m=d?.enabled??!1,c=d?.enabledConnectors??[];return e.jsx(Fp,{composerController:t,systemHint:s,composerBarButtonInfo:s.composerBarButtonInfo,clientThreadId:n,isDisabled:!1,showLabel:a,dropdownContent:!l&&!m?e.jsx(hn,{}):void 0,splitButtonDropdownContent:m?e.jsx(Ms,{clientThreadId:n,enabledConnectors:c,includeSyncConnectors:!0,includeWebSearch:!1}):l&&i?e.jsx(hn,{}):void 0,dataTestid:ed,tooltipPosition:"top",disableNuxMarkdown:!0,as:m?"dropdown":"popover"})},hn=()=>{const[t,s]=f.useState(),{connectionInstanceData:n,isLoading:o}=kn(),a=f.useMemo(()=>[...n?.connection_statuses??[]].sort(Ka),[n]),r=a.some(i=>i.user_connection_details.activation_status==="activating"||i.user_connection_details.activation_status==="partially_activated"||i.user_connection_details.activation_status==="inactive"&&i.user_connection_details.auth_status==="user_connected");return f.useEffect(()=>{T.logEventWithStatsig("Contextual Answers User Composer Dropdown Shown","chatgpt_contextual_answers_user_composer_dropdown_shown")},[]),o?e.jsx("div",{className:"w-full max-w-[calc(100vw-1.5rem)] min-w-[calc(100vw-1.5rem)] p-3 md:min-w-[22rem]",children:e.jsx(Yi,{lines:4,size:"lg"})}):e.jsxs(mt,{children:[t&&e.jsx(Qa,{connection:t,onClose:()=>s(void 0)}),e.jsxs("div",{className:"w-full max-w-[calc(100vw-1.5rem)] min-w-[calc(100vw-1.5rem)] px-1 py-3 md:min-w-[22rem]",children:[a.map(i=>{const u=i.user_connection_details.activation_status,l=u==="partially_activated"||u==="activating";return e.jsx(da,{className:q(i.user_connection_details.activation_status==="activating"?"grayscale":void 0,l?"":"cursor-default"),onClick:d=>{l&&s(i),d.stopPropagation()},children:e.jsx(td,{title:i.connection_display_info.display_name,icon:e.jsx("img",{src:i.connection_display_info.icon_url??"",alt:i.connection_display_info.display_name,className:"icon-md"}),statusIndicator:e.jsx(Xa,{connection:i,location:"user_dropdown"})})},i.user_connection_details.connection_instance_id)}),e.jsx(da,{onClick:i=>{window.location.hash="#settings/ConnectorSettings",i.stopPropagation()},children:e.jsxs("div",{className:"flex w-full flex-row items-center justify-start gap-4 text-start",children:[e.jsx(Rn,{className:"icon-md"}),e.jsx("p",{className:"text-token-text-primary flex-1 text-sm font-medium",children:r?e.jsx(E,{id:"EqgQdy",defaultMessage:"See syncing state"}):e.jsx(E,{id:"05N3nu",defaultMessage:"Manage connectors"})})]})})]})]})};function dg({systemHints:t,composerController:s,clientThreadId:n}){const{configurationMenuType:o}=He(),a=o!=="none",r=Vn(s),i=t.find(({systemHint:d})=>d===r),{isUnauthenticated:u}=Te(),{setThreadSystemHintMode:l}=fe();return f.useEffect(()=>{o!=="none"&&r&&!t.some(({systemHint:d})=>d===r)&&!u&&l(r,!1,{clientThreadId:n})},[n,l,r,t,u,o]),i?e.jsxs("div",{"data-testid":"active-system-hint-pill",className:qn("[view-transition-name:var(--vt-composer-active-system-hint-pill)",a&&"flex items-center gap-1.5 ps-0.5"),children:[e.jsx("div",{"data-separator":!0,className:"bg-token-border-default h-3 w-px"}),e.jsx(mg,{activeSystemHint:i,onClick:()=>{l(i.systemHint,!1,{clientThreadId:n})}})]},"active-hint-tag"):null}function mg({activeSystemHint:t,onClick:s}){const n=K(),{configurationMenuType:o}=He(),a=o!=="none";return e.jsxs(no,{as:a?"button":"div",role:a?void 0:"button",tabIndex:a?void 0:0,onClick:s,spacing:"compact",isSelected:!0,isLegacyStyle:!0,borderVisible:!0,children:[e.jsx(Kt,{svgString:t.logo,className:a?"icon-md":"icon-md text-token-interactive-label-accent-default flex-1","aria-label":""}),e.jsx("span",{"data-label":!0,className:"mx-1.5",children:t.shortLabel??t.name}),a&&e.jsx(Bi,{"aria-label":"",className:"icon-smaller -ms-0.5 mt-px @max-[521px]/thread:ms-1"}),!a&&e.jsx(Ci,{"data-remove-think-button":!0,className:"-me-1","aria-label":n.formatMessage({id:"HW9RTL",defaultMessage:"Disable {systemHintName}"},{systemHintName:t.name})})]})}function pg({systemHints:t,composerController:s,clientThreadId:n,connectionStatuses:o}){dr({clientThreadId:n});const a=Ue(),{configurationMenuType:r}=He(),i=r!=="none",u=Vn(s),l=t.find(({systemHint:v})=>v===u),d=qi(),{enabled:m}=eo(),c=f.useMemo(()=>Object.entries(d).reduce((v,[y,_])=>(_&&(y!==J.GITHUB_CONNECTOR||m)&&v.push(y),v),[]),[d,m]);if(!i||!l)return null;if(u===A.Research||!1)return e.jsx(Kp,{clientThreadId:n,enabledConnectors:c,trigger:e.jsx(H.BasicTrigger,{asChild:!0,children:e.jsxs(no,{as:"button",spacing:"compact",children:[e.jsx(yi,{className:"icon-md","aria-label":""}),e.jsx("span",{"data-label":!0,className:"mx-1.5",children:e.jsx(E,{id:"DhW8Wx",defaultMessage:"Sources"})}),e.jsx(Ht,{className:"icon-sm -ms-0.5 @max-[521px]/thread:ms-1"})]})})});const h=Jn(a,"463092697")?.value,g=h?.enabled??!1,x=h?.enabledConnectors??[];return u===A.ContextualAnswers&&(o&&o.length>0||g)?e.jsx("div",{"data-testid":"sources-pill",className:qn("[view-transition-name:var(--vt-composer-sources-pill)",i&&"flex items-center gap-1.5 ps-0.5"),children:e.jsx(fg,{dropdownContent:g?e.jsx(Ms,{clientThreadId:n,enabledConnectors:x,includeSyncConnectors:!0,includeWebSearch:!1}):e.jsx(hn,{}),as:g?"dropdown":"popover"})},"sources-tag"):null}function fg({dropdownContent:t,as:s}){const n=e.jsxs(no,{as:"button",spacing:"compact",children:[e.jsx(yi,{className:"icon-md mx-1","aria-label":""}),e.jsx("span",{"data-label":!0,children:e.jsx(E,{id:"DhW8Wx",defaultMessage:"Sources"})}),e.jsx("div",{className:"me-0.5 flex items-center",children:e.jsx(Ht,{className:"pointer-events-auto! h-4 w-4"})})]}),o=s==="popover"?e.jsx(_n,{children:e.jsx(nd,{className:"p-0",$as:jn,side:"bottom",align:"start",collisionPadding:10,sideOffset:8,children:t})}):e.jsx(H.Portal,{children:e.jsx(H.Content,{children:t})});return s==="popover"?e.jsxs(wn,{children:[e.jsx(sd,{asChild:!0,children:n}),o]}):e.jsxs(H.Root,{children:[e.jsx(H.Trigger,{asChild:!0,children:n}),o]})}function gg({clientThreadId:t,uploadType:s,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:o,attachmentsProductFeature:a,getInputProps:r,openFileDialog:i,onOauthRedirect:u,historyDisabled:l,isDisabled:d,highlightTooltip:m,disabledReason:c,currentModelName:p,showLabel:S,showUpsell:h,hideBorder:g,isSmall:x,visualTreatment:v,layoutMode:y,restoreFocus:_}){const P=zn(),{gdriveStatus:R,o365Status:M}=fi(),w="h-[20px] w-[20px]",j=l?"text-white":m?"text-brand-blue-800":"",N=h?e.jsx(ln,{"aria-label":"",className:q(w,j)}):e.jsx(ln,{"aria-label":"",className:q(w,j)}),D=(R!=="false"||M!=="false"||P||v==="vanguard")&&!h,L=Dm(),z=v==="vanguard"&&!L,b=D?e.jsx(cr,{hideBorder:g,isSmall:x,clientThreadId:t,icon:N,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:o,attachmentsProductFeature:a,onOauthRedirect:u,uploadType:s,openFileDialog:i,getInputProps:r,isDisabled:z?!1:d,highlightTooltip:m,disabledReason:c,currentModelName:p,visualTreatment:v,layoutMode:y,restoreFocus:_}):e.jsx(or,{isSmall:x,hideBorder:g,clientThreadId:t,uploadType:s,openFileDialog:i,getInputProps:r,showLabel:S,showUpsell:h,icon:N,isDisabled:d,highlightTooltip:m,disabledReason:c,currentModelName:p});return e.jsx("div",{className:"relative",children:e.jsx(lr,{showBackground:m,className:"bg-brand-blue-800/20",children:b})})}const hg=({clientThreadId:t,currentModel:s,uploadType:n,modelSupportedImageMimeTypes:o,modelAcceptedMimeTypes:a,modelProductFeatures:r,getEditorGizmoId:i,onOauthRedirect:u,disabledReason:l,isTemporaryChat:d,isDisabled:m,highlightTooltip:c,showLabel:p,showUpsell:S,numRemainingFiles:h,visualTreatment:g,layoutMode:x,restoreFocus:v})=>{const y=K(),_=$e(),{handleFileAccepted:P}=ro(y,n,o,"mouse",i,r?.attachments),{getInputProps:R,open:M}=oo({disabled:m,noClick:!0,onDropAccepted:P,onDropRejected:w=>io(w,y,_,n),multiple:!0,maxSize:Hn,maxFiles:h,...Ln(a)});return e.jsx(gg,{isSmall:!0,hideBorder:!0,isDisabled:m,highlightTooltip:c,onOauthRedirect:u,visualTreatment:g,attachmentsProductFeature:r?.attachments,clientThreadId:t,uploadType:n,modelAcceptedMimeTypes:a,modelSupportedImageMimeTypes:o,getInputProps:R,openFileDialog:M,historyDisabled:d,showLabel:p,showUpsell:S,disabledReason:l,currentModelName:s?.title??"",layoutMode:x,restoreFocus:v})};function xg(){const s=ai().has(A.Research),n=!1,o=Ue(),a=dt(o,"3544641259");return(s||n)&&a}function Sg(){const t=Un(),o={initial:{opacity:0,y:"-28px",rotate:45},animate:{opacity:1,y:0,rotate:45,transition:t?Gt:{opacity:{delay:.4},default:Ra}},exit:{opacity:0,y:"-28px",rotate:45,transition:t?Gt:{opacity:{delay:0},default:Ra}}};return e.jsx(Z.div,{variants:o,initial:"initial",animate:"animate",exit:"exit",className:"border-token-border-xlight bg-token-main-surface-primary absolute start-1/2 top-full mt-[11px] h-2 w-2 -translate-x-1/2 transform rounded-se-[1px] rounded-es-[1px] border-s border-t dark:bg-[#303030]"})}const bg=({activeSystemHint:t,showHints:s,showContextChevron:n,onRemoveHint:o,lockSystemHint:a})=>{const r=K(),{popoverTriggerRef:i}=En(),u=()=>{requestAnimationFrame(()=>{i.current?.focus()})};if(t){const{logo:l,name:d}=t;return e.jsxs("div",{className:q("relative flex items-center justify-center",!a&&"-me-1"),children:[e.jsx(Kt,{className:"icon-md text-token-interactive-label-accent-default flex-1",svgString:l}),!a&&e.jsx(Ci,{"data-remove-hint-button":!0,onClick:m=>{m.stopPropagation(),m.preventDefault(),o(),u()},"aria-label":r.formatMessage({id:"YQ7uOV",defaultMessage:"Remove {tool} from selection"},{tool:d})}),n&&e.jsx(Sg,{})]})}return s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-token-border-default ms-0.5 h-[16px] w-[1px]"}),e.jsx("div",{className:"text-token-text-tertiary hover:text-token-text-primary me-0.5 flex items-center",children:e.jsx(Ht,{className:"text-token-text-tertiary hover:text-token-text-primary pointer-events-auto! h-4 w-4"})})]}):e.jsx(bi,{"aria-label":r.formatMessage({id:"xosz07",defaultMessage:"View all tools"}),className:"text-token-text-secondary h-5 w-5"})},Cg={source:{id:"SystemHintCategory.Sources",defaultMessage:"Sources",description:"Label on system hint menu for hints that act as data sources"},tool:{id:"SystemHintCategory.Tools",defaultMessage:"Tools",description:"Label on system hint menu for hints that act as tools"}},yg=({children:t,clientThreadId:s,layoutMode:n,lockSystemHint:o,composerController:a,onChangeSystemHint:r,systemHints:i,activeSystemHintType:u,recentSystemHintTypes:l,showHints:d,reasonItem:m=!1,gizmoId:c,isInReasonMode:p,type:S,...h})=>{const g=xg(),x=Un(),v=K(),y=i.find(({systemHint:k})=>u===k),_=Et(),P=l.map(k=>k===A.PictureV2&&!i.find(({systemHint:U})=>k===U)?i.find(({systemHint:U})=>U===A.Picture):i.find(({systemHint:U})=>k===U)).filter(k=>!!k),[R,M]=f.useState(null),w=(k,U)=>{U?M(k):r(k)},{selectedIndex:j,systemHintSuggestions:N,suggestorClosed:D,resetSelectedIndex:L}=ir({composerController:a,clientThreadId:s,onHintSelected:r}),z=D?i:N,b=[],I=ar(z);let G=0;for(const k of I){const U=k.systemHints;U.length!==0&&(b.push({...k.category?{message:Cg[k.category]}:{},systemHints:U,indexOffset:G}),G=U.length)}const W=()=>{a.setReasonMode(!p),p?T.logEventWithStatsig("Composer Think Button Disabled","composer_think_button_disabled",{clientThreadId:s}):T.logEventWithStatsig("Composer Think Button Enabled","composer_think_button_enabled",{clientThreadId:s})};return e.jsxs("div",{className:q("flex items-center rounded-full",d&&"me-1 border",u!==void 0?"border-transparent":S==="toolpile_icon"?"border-token-border-default":"border-token-border-xlight"),children:[!y&&d&&e.jsx(od,{onChangeSystemHint:w,systemHints:P}),e.jsxs(to,{layoutMode:n,forceOpen:!D,...h,children:[t?e.jsx(Ki,{children:t}):e.jsx(fp,{transition:x?Gt:fs,shape:u?"rectangle":"round",spacing:"compact",isSelected:u!==void 0,"aria-label":v.formatMessage({id:"NLd5mV",defaultMessage:"Open tool menu"}),className:q(d&&"-mx-0.5",o&&"cursor-default!",S==="config_icon"&&"min-w-9",S==="toolpile_icon"&&"min-h-9"),onClick:k=>{if(o){k.stopPropagation(),k.preventDefault();return}},tooltipLabel:!u&&v.formatMessage({id:"xgQfBi",defaultMessage:"View all tools"}),disableHover:d&&!y||o,isLegacyStyle:S==="config_icon"||S==="toolpile_icon"&&!!u,borderVisible:S==="config_icon"||S==="toolpile_icon"&&!!u,children:e.jsx(bg,{activeSystemHint:y,showHints:d,showContextChevron:g||!1,onRemoveHint:()=>r(null),lockSystemHint:o})}),e.jsx(so,{onMouseDown:k=>{k.preventDefault()},align:"end",children:e.jsx(ad,{onChangeSystemHint:w,systemHintCategories:b,activeSystemHint:u,activeIndex:j,resetActiveIndex:L,reasonItem:m,gizmoId:c,clientThreadId:s,handleToggleReasonItem:W,isInReasonMode:p})})]}),!_||_.planType===Lm.FREE&&e.jsx(id,{open:!!R,onOpenChange:()=>M(null),systemHint:R})]})},Da="gpt-4o",vg=({clientThreadId:t,composerController:s,pendingFiles:n,isUploadDisabled:o,highlightUploadTooltip:a,hasFiles:r,conversationMode:i,placeholder:u,isTemporaryChat:l,layoutMode:d,state:m,inputState:c,disableReason:p,gizmoId:S,currentModel:h,replyRegions:g,uploadButtonDisabledReason:x,keepExpanded:v=!1,getEditorGizmoId:y,onOauthRedirect:_,onSubmit:P,visualTreatment:R,legacyFooterActions:M,legacySuggestionsPopoverContent:w,isNewThread:j=!1,isInReasonMode:N,modelSupportedSystemHints:D,contextualAnswerUserConnectionData:L})=>{const{data:z}=$t(),[b,I]=ma(!1),{updateSystemHint:G}=fe(),{configurationMenuType:W}=He(),k=W!=="none";ks();const U=Ye.useState(({persistedSystemHints:$})=>$);rd(t,R==="vanguard");const Y=Array.from(U)[0],F=Ye.useState(({recentHints:$})=>$),{state:Q}=Ss(t),ie=At(!1),ye=De($=>$.threads[t]?.modelSelection),Ge=ye?.type===be.SPECIFIC,pt=De($=>$.setThreadModelSelection),Ne=R==="vanguard"&&h?.id!==Da&&!Ge&&!b();vi(f.useCallback(()=>{Ne&&(ie({location:"PromptTextarea",modelId:Da}),_t(t,pt,{type:be.EFFORT_MODE,effortMode:ti.low}))},[Ne,ie,t,pt]));const{setIsOpen:Qe}=ld(),Xe=$=>{I(!0),G($,{clientThreadId:t}),$===A.Research?Qe(!0):Qe(!1),$&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{s.focus()})})},ve=!1,we=Q==="clarify"||ve,_e=f.useCallback(($,xt)=>e.jsx(gi,{...xt,isSmall:R==="vanguard",inputState:c,state:m,onSubmit:P,composerController:s,clientThreadId:t,gizmoId:S,disableReason:p,useStartButtonText:we,disableTooltip:$}),[c,m,P,s,t,S,p,we,R]),Je=$=>{b()&&($.preventDefault(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{s.focus()})}))},ge=cd({inputState:c,state:m,composerController:s,clientThreadId:t}),{whisperControls:Be}=Qi({composerController:s,renderInComposer:_e,composerType:R,composerRightButtonType:ge,layoutMode:d}),[oe=null,je,ft]=f.useMemo(()=>[On(h,i),Dn(h,i),Fn(h,i)],[h,i]);Wn(t);const Ze=Ye.useState(({availableHints:$})=>$),ce=Ye.useState(({locked:$})=>$),ke=f.useMemo(()=>ye?.type===be.EFFORT_MODE?ud[ye.effortMode]:"low",[ye]),[ne,Re]=ma(ke);f.useEffect(()=>{Re(ke)},[ke,Re]),Le(pe.ModelPickerMoved);const Ae=An(S);Q!=="disabled"||ve||(i?.kind,Oe.GizmoInteraction);const{pageType:Pt}=wi(),ue=_i($=>$.selectedApps),gt=ji()&&ue.length>0,Me=r||gt,et=v||!!Y||g&&g.length>0||Me||Ze.length<3;gs(h,i,U);const O=zt(A.ContextualAnswers)&&!!j,{shouldShowResearchText:de}=Ss(t),ht=dd(),tt=md({exposed:O})==="bigbox",Es=ht&&de||tt&&O;return e.jsxs(_p,{isBigBoxModeActive:Es,isTemporaryChat:l,placeholder:u,visualTreatment:R,composerController:s,isExpandedByDefault:et,onSubmit:P,children:[g&&g.length>0&&e.jsx(Aa,{children:e.jsx(xi,{replyRegions:g})}),Me&&e.jsx(Aa,{children:e.jsx(un,{files:n,fullBleed:!0,selectedApps:ue,className:qn("no-scrollbar -ms-1.5 flex flex-nowrap gap-2 overflow-x-auto",R==="composer-btn"?"horizontal-scroll-fade-mask py-1.5 ps-2 pe-4 [--edge-fade-distance:1rem]":"p-1.5")})}),[M?.map(($,xt)=>e.jsx(jp,{children:$},`legacy-footer-action-${xt}`))??[],(k&&e.jsx(Ma,{children:e.jsx(dg,{clientThreadId:t,composerController:s,systemHints:D})},"active-hint-tag"))??[],e.jsx(Ma,{children:e.jsx(pg,{clientThreadId:t,composerController:s,systemHints:D,connectionStatuses:L?.connection_statuses})},"sources-tag"),e.jsx(kp,{children:w},"legacy-suggestions-popover")],R==="vanguard"&&e.jsx(Rp,{children:e.jsx(yg,{activeSystemHintType:Y,lockSystemHint:Pt.type==="landing-page"||ce,systemHints:Ze,clientThreadId:t,composerController:s,onChangeSystemHint:Xe,layoutMode:d,recentSystemHintTypes:F,showHints:!j,isInReasonMode:N,restoreFocus:Je})},"system-hint-popover"),e.jsx(Ap,{children:Be}),ht&&de?e.jsx(Ea,{children:e.jsx(Mp,{composerController:s,visualTreatment:"vanguard"})}):tt&&O?e.jsx(Ea,{children:e.jsx(pd,{composerController:s,visualTreatment:"vanguard"})}):null]})},wg=Qn(()=>Xn(()=>import("./l8tekopyvbe78zjf.js"),__vite__mapDeps([8,1,2,3,4,5,9,10,11,12,13,14])).then(t=>t.ImageGenComposer)),_g=1,jg=3e3,kg=()=>null;function Rg({onCreateNewCompletion:t,onContinueGenerating:s,account:n,currentModelId:o,currentModelConfig:a,disableDraftPersistence:r=!1,modelCategories:i,areModelsLoading:u,clientThreadId:l,isNewThread:d,isCompletionInProgress:m,className:c,disabled:p=!1,disabledReason:S,canPause:h=!1,canContinue:g=!1,isInteractableSharedThread:x,onComposerInput:v,onComposerChange:y,onAutocompleteSelect:_,headerClassName:P,hideHeader:R,onTaggingDropdownOpen:M,onTaggingDropdownClose:w,onlyAllowImageUploads:j}){pa.markStart("PromptTextarea"),pa.markRendered("PromptTextarea");const N=f.useContext(Gi),D=Fm(N),L=Ue(),z=f.useRef(null),b=Mt(),I=ri(),G=Hm(I.showUploadSuggestion$),W=fd(),k=n?.isTeam(),{isUnauthenticated:U}=Te(),Y=K(),F=$e(),Q=Tn(),ie=ks(),ye=gd.useStore(),[Ge,pt,Ne]=le(l,C=>[se.getCurrentLeafId(C),se.getRequestId(C),se.findNode(C,V=>!!V.message.metadata?.b1de6e2_s)]),[Qe]=gl(),{gizmoEditorData:Xe,mode:ve,getGizmoId:we}=In(),_e=Um(),Je=ys(),ge=Gm(),Be=hd(),oe=Ui(l),je=!!Pi(),ft=!!$n(),Ze=xd.useIsEnabled(l),ce=!!Zn(),{setThreadSystemHintMode:ke}=fe(),ne=Wt(),{state:Re}=Ss(l),Ae=ne.has(A.Search),Pt=ne.has(A.Think),ue=Le(pe.ModelPickerMoved),gt=ne.has(A.Research),{enabled:Me}=eo(),{activeSystemHints:et}=Wn(l),O=et.length>0,de=et.find(C=>C.systemHint===A.ContextualAnswers),ht=Sd(),{connectionInstanceData:tt,isLoading:Es}=kn({skip:!ht}),{selectedSources:$}=ws(l),xt=bd(L);Vi({skip:!xt}),up({skip:!xt});const Ps=f.useRef(0),Ts=f.useRef(!1),pr=i?.find(C=>C.defaultModel===o),fr=kg();let X=js(l),Ns=X&&"gizmo"in X?X.gizmo:void 0;const gr=zm(),st=Ns?.gizmo.id??gr,Tt=An(st),hr=Cd(),lo=yd(),[he,Qt]=f.useState(null);he!==null&&(X={gizmo:he,gizmo_id:he.gizmo.id,kind:Oe.GizmoInteraction},Ns=he);const Nt=gs(a,X,ne),xr=Rs(),co=Hi(L).flags,Xt=co?.includes(bs.NoAuthEnableFileUploads),{showLegacyReasoningSlider:nt,showReasoningSliderNux:Sr,reasoningSliderType:br,hideReasonInSystemHintOverflow:Cr,hideSearchInSystemHintOverflow:yr,configurationMenuType:uo}=He(),mo=uo!=="none",Jt=De(C=>C.setThreadModelSelection),po=De(C=>C.threads[l]?.modelSelection),fo=po?.type===be.EFFORT_MODE?po.effortMode:null,go=!!fo&&fo!=="default";vi(f.useCallback(()=>{go&&_t(l,Jt,{type:be.EFFORT_MODE,effortMode:"default"})},[go,l,Jt])),Cp({serverThreadId:oe,clientThreadId:l,composerController:b,currentModelId:o,account:n,getIsDisabled:f.useCallback(()=>!1,[]),onReset:()=>{_t(l,Jt,{type:be.EFFORT_MODE,effortMode:"default"})},onInfer:C=>{_t(l,Jt,{type:be.EFFORT_MODE,effortMode:C})},isInferEnabledForModel:a?.enableInfer});const ho=!p&&(Nt!==it.None||u)&&(!U||Xt),ze=Dn(a,X),Bs=Fn(a,X);let re=rn(C=>C.files);const[Zt]=f.useState(()=>vd());ve==="magic"?re=re.filter(C=>C.gizmoId!=null):re=re.filter(C=>C.gizmoId==null);const xo=wd(),We=re.length>0||xo,So=rn(tm.hasUploadInProgress),Is=_i(C=>C.selectedApps),bo=ji()&&Is.length>0,vr=We||bo,wr=_d(l),Os=b.useState(C=>{const V=jd(C);return typeof a?.maxTokens=="number"&&V>a.maxTokens}),Co=b.useState(C=>!C.isEmpty()),es=!Os&&!So&&(Co||We),yo=(Nt===it.Multimodal?Nn:Bn)-re.length,vo=yo<=0,_r=kd(),jr=ae("3544641259")?.value,{selectedRepos:Ds}=vn(l),wo=_r&&jr&&$?.size===0,St=es&&!p&&!ce&&(!m||lo)&&!wo,[_o,kr]=f.useState(!1),{value:Rr}=ae("3780975974"),{targetedContent:jo,setTargetedContent:ts}=Rd(),Ee=jo?.isFocusedViewContent&&!Be?void 0:jo;f.useEffect(()=>{requestAnimationFrame(()=>requestAnimationFrame(()=>b.focus()))},[Ee]);const ko=X==null||X?.kind===Oe.PrimaryAssistant||X?.kind===Oe.GizmoInteraction&&Tt,{getUpsellLabelType:Ar,getUpsellShowsAttach:Mr,getShowUpsellReason:Er}=hi(),Ls=O&&ko,[Pr,Tr]=f.useState(!1),Nr=!U&&ko&&(!k||!Es),bt=rt(b.store,C=>C.controlsDisabled);f.useEffect(()=>{if(!W?.id)return;const C=fa.getAndReset(W.id,oe);C&&b.setText(C.inputText)},[W?.id,oe,b]),f.useEffect(()=>{const C=Qe.get("prompt")??"";b.getCurrentText().length===0&&C.length>0&&b.setText(C)},[b,Qe]),f.useEffect(()=>{_o!==St&&(kr(St),St&&Wm(!0).then(C=>{Ad.startEnforcement(C),Vm.startEnforcement(C)}))},[St,_o,X?.kind,_e]);const ss=On(a,X),{handleFileAccepted:Ro}=ro(Y,gs(a,X,ne),ze,"mouse",we,ss?.attachments),Br=f.useCallback((C,V)=>(requestAnimationFrame(()=>{requestAnimationFrame(()=>{b.focus()})}),Ro(C,V)),[b,Ro]),{getInputProps:Ir,open:Fs,inputRef:Ao}=oo({disabled:p||!ho||vo,noClick:!0,onDropAccepted:Br,onDropRejected:C=>io(C,Y,F,Nt),multiple:!0,maxSize:Hn,maxFiles:yo,...Ln(U||j?ze:Bs)}),Mo=rt(Zt),Eo=f.useCallback(()=>{b.eraseContent(),Mo.clearMessages(),b.resize(_g),b.usedDictation=!1,b.dictationEdited=!1;for(const C of re)ms.remove(Q,C.tempId,"none");Md.markAllAsSent()},[b,Mo,re,Q]),Bt=rt(b.store,C=>C.isInReasonMode),Po=f.useMemo(()=>Js(Bt,b,ne)[0],[Bt,b,ne]),To=async(C,V)=>{if(C.preventDefault(),p||!es||!X)return;const me=b.getContentToSend(),xe=sm(me.content),ot=Js(Bt,b,ne),{content:Ks,attachments:$s}=nm(Q,xe,a,X,ne);hr(),t({sourceEvent:C,attachments:$s,content:Ks,contentToSend:me,conversationMode:X,hasSelectedApps:bo,isMessageFollowupsEnabled:Ze,selectedApps:Is,selectedGizmoTag:he,selectedRepos:{selectedAllRepos:Ds.selectedAllRepos,selectedRepos:Ds.selectedRepos?[...Ds.selectedRepos]:null},selectedSources:$,systemHints:ot,usedDictation:b.usedDictation,dictationEdited:b.dictationEdited}),Ee?.onCreateCompletion?.({serverThreadId:oe,currentLeafId:Ge}),Ee?.shouldPersistAcrossMessages!==!0&&ts(void 0),ga.hideThreadHeader();for(const ia of re)ia.status===om.Ready&&ye.addFile(ia);Eo()},Or=C=>{ts(C.targetedReply),C.targetedReply&&T.logEventWithStatsig("Targeted Reply Button Clicked","chatgpt_targeted_reply_button_clicked",{conversationId:oe,sourceMessageId:C.messageId})},{maybeSetWaitingForRealtimeOnAbort:No,isWatingForRealtimeStatusChange:Dr}=Ed(l),Hs=f.useCallback(C=>{No(),Pd(C)},[No]),Bo=f.useCallback(()=>{Ee?.onCleared?.({serverThreadId:oe,currentLeafId:Ge}),ts(void 0),b.focus()},[Ge,oe,Ee,ts,b]),Io={Enter:{validator:C=>{const V=C.isComposing||C.keyCode===229;return!(os&&Ts.current)&&(C.metaKey||(Je||$m||Qm())&&!C.shiftKey&&!V)},handler:C=>{if(!St){Os&&F.danger("The message you submitted was too long, please submit something shorter.",{hasCloseButton:!0});return}C.preventDefault(),To(C)}},Escape:{validator:C=>!C.isComposing,handler:C=>{h&&m&&(Hs(l),T.logEventWithStatsig("Pause Completion","chatgpt_pause_completion",{threadId:Ft(l),currentLeafId:se.getCurrentNode(Pe(l)).message.id,eventSource:"keyboard"})),C.target.value===""&&Bo()}}},It=f.useRef(Io);It.current=Io;const ns=Td(a?.tags,X?.kind),{showTaggingDropdown:Us,isFocused:Lr,autocompletions:Ve,matchaData:Fr}=rt(b.store),os=Lr&&Ve.length>0,Ct=ns&&Us&&!Tt,Oo=b.isReady();f.useEffect(()=>b.subscribe("keydown",C=>{b.acceptLegacyKeydown()&&It.current[C.key].validator(C)&&It.current[C.key].handler(C);const me=b.getCurrentText();if(C.key==="@"){const xe=b.getSelectionStart(),ot=me.substring(0,xe);(!ot||/\s$/.test(ot)||xe===0)&&setTimeout(()=>b.setShowTaggingDropdown(!0),10)}else Us&&b.setShowTaggingDropdown(!1);C.key==="Escape"&&(Qt(null),b.setAutocompletions([])),Ae&&C.key==="Escape"&&ke(A.Search,!1,{clientThreadId:l})}),[b,Oo,Us,ne,Ae,ke,l]),f.useEffect(()=>{const C=Object.fromEntries(Object.keys(It.current).map(V=>[V,xe=>{const ot=It.current[V];if(!ot||b.acceptLegacyKeydown())return!1;const{validator:Ks,handler:$s}=ot;return Ks(xe)?($s(xe),!0):!1}]));b.registerKeyHandlers(C),b.registerFileInput({openFileDialog:Fs,inputRef:Ao})},[b,Fs,Ao,Oo]),f.useEffect(()=>b.subscribe("paste",C=>{Nd({filePickerStore:Q,event:C,intl:Y,toaster:F,clientThreadId:l,conversationMode:X,currentModelConfig:a,getEditorGizmoId:we,modelSupportedImageMimeTypes:ze,persistedSystemHints:ne})}),[Y,l,X,a,we,ze,b,F,Q,ne]);const Do=C=>{je||Qt(C),b.trimLeadingText("@"),an(),b.setShowTaggingDropdown(!1)},Hr=Bd(l,Zt,ze,ss?.attachments),Ur=f.useCallback(C=>{C.preventDefault(),Hs(l),T.logEventWithStatsig("Pause Completion","chatgpt_pause_completion",{threadId:Ft(l),currentLeafId:se.getCurrentNode(Pe(l)).message.id,eventSource:"mouse"}),an()},[l,Hs]),as=f.useCallback(()=>{fa.set(W?.id,oe,b.getCurrentText())},[oe,W?.id,b]);f.useEffect(()=>{Xe||Id()||b.focus()},[b]),f.useEffect(()=>{if(ze.length>0)for(const V of re)Od(V.fileSpec?.mimeType,Bs)||ms.remove(Q,V.tempId,"none");else ms.reset(Q)},[o,Q]),f.useEffect(()=>{(!ns&&he||je)&&Qt(null)},[ns,he,je]),f.useEffect(()=>{ft&&b.setReasonMode(!1)},[ft,b]);const{layer:Gr}=Ke("4031588851"),{layer:Lo}=Ke("3637408529"),zr=Lo.get("is_in_composer_text_exp",!1),Wr=Lo.get("composer_text","MESSAGE_CHATGPT"),Vr=Gr.get("composer_text","MESSAGE_CHATGPT"),qr=zr?Wr:Vr,[is,Yr]=(()=>{switch(S){case"workspaceDisallowsGizmo":return[ee.disallowedByWorkspacePlaceholder,!0];case"noModelsAvailable":return[ee.noModelsAvailablePlaceholder,!0];case"requiresPluginsToBeInstalled":return[ee.requiresPluginsToBeInstalled,!0];case"loadingPlugins":return[ee.loading,!0];case"noTestGizmoId":return[ee.noTestGizmoId,!0];default:{if(x)return[ee.placeholderWithName,!1];if(Ee?.placeholderTextOverride!=null)return[Ee.placeholderTextOverride,!1];if(Re==="initial"||Re==="recurrent")return[ee.deepResearchPlaceholder,!1];if(Re==="clarify")return[ee.researchSuggestionInitial,!1];if(Po)switch(Po){case A.Search:return[ee.searchPlaceholder,!1];case A.Think:return[ee.thinkPlaceholder,!1];case A.Research:return[ee.researchPlaceholder,!1];case A.Canvas:return[ee.canvasPlaceholder,!1];case A.Picture:return[ee.picturePlaceholder,!1];case A.PictureV2:return[ee.pictureV2Placeholder,!1];case A.ContextualAnswers:return[Dd.caSuggestionInitial,!1]}switch(qr){case"BLANK":return[null,!1];case"ASK_ANYTHING":return[ee.placeholderAskAnythingVariant,!1];case"ASK_CHATGPT_ANYTHING":return[ee.placeholderAskNameAnythingVariant,!1];default:return[ee.placeholderWithName,!1]}}}})(),Gs=Tt?d?Y.formatMessage(Ld.newChatInProject):is?Y.formatMessage(is,{name:"ChatGPT"}):"​":is?Y.formatMessage(is,{name:Xe!=null?ve==="magic"?Fd:Xe.name||"GPT":Ns?.gizmo.display.name??"ChatGPT"}):"​";f.useEffect(()=>b.subscribe("input",()=>{Hd.getState().isThreadHeaderVisible&&ga.hideThreadHeader()}),[b]),f.useEffect(()=>b.subscribe("input",()=>{Ps.current=performance.now(),v?.()}),[b,v]),f.useEffect(()=>{if(y)return b.subscribe("change",()=>{y()})},[b,y]);const Kr=Rr||Er(),Fo=Ud()&&!!Ve.find(C=>!!C.requires_file_upload),$r={clientThreadId:l,uploadType:Nt,modelAcceptedMimeTypes:Bs,modelSupportedImageMimeTypes:ze,attachmentsProductFeature:ss?.attachments,getInputProps:Ir,openFileDialog:Fs,historyDisabled:ge,onOauthRedirect:as,highlightTooltip:Fo&&!We},Ot=[],Ho=[],Uo=!p&&!vo&&(ho||xr!=null)&&!Ae,Go=Mr(),Qr=!U||Go||Xt,zo=Nt===it.None?jt.ModelNotSupported:Pt?jt.ThinkModeInUse:Ae?jt.SearchModeInUse:void 0;if(Qr){const C=e.jsx("div",{"data-testid":"composer-action-file-upload",style:{viewTransitionName:"var(--vt-composer-attach-file-action)"},children:e.jsx(eg,{...$r,showGlowingBorder:G,showLabel:Ar()==="all",showUpsell:Go&&!Xt,showMenuForNoAuth:Xt,isDisabled:!Uo||bt,disabledReason:zo,currentModelName:a?.title??"",visualTreatment:mo?"composer-btn":"legacy"})},"file-upload-button");Ot.push(C),Ho.push(C)}const Ie=[],Wo=Gn(),Vo=De(C=>C.isVisuallyOverflowing)&&nt;let rs="bottom";Wo?rs="bottom":d&&(rs="centered"),nt&&(X?.kind!==Oe.GizmoInteraction||Tt)&&Ie.push(e.jsx("div",{"data-testid":"composer-action-reasoning-level",className:"flex [--pill-color:var(--text-secondary)] [--pill-font-size:13px]",onPointerDown:C=>C.stopPropagation(),children:e.jsx(Mn,{announcementKey:pe.ModelPickerMoved,side:"bottom",show:ie&&Sr&&!ue.isLoading&&ue.eligible,onDismiss:ue.markAsViewed,theme:"bright",badge:"none",dismissOnOutsideClick:!0,sideOffset:0,title:e.jsx(E,{id:"NGN4SW",defaultMessage:"Set how long ChatGPT should think or pick a different model"}),children:e.jsx(ff,{clientThreadId:l,layoutMode:rs,currentModel:a,category:pr,type:br,mode:Tt?"model-picker-only":"default"})})},"reasoning-level")),yr||Ie.push(e.jsx(sf,{account:n,clientBootstrapFlags:co,features:_e,currentModelConfig:a,hasFiles:We,isDisabled:bt||We,clientThreadId:l,composerController:b,gizmoId:st},"search"));const{value:Xr}=ae("1830177352");!nt&&!Cr&&Ie.push(e.jsx(Zp,{clientThreadId:l,gizmoId:st,composerController:b,isDisabled:bt},"reason")),Xr&&Ie.push(e.jsx(Xp,{clientThreadId:l,gizmoId:st,showLabel:Kr,isDisabled:bt},"deep-research")),Vo||Ie.push(e.jsx(lp,{clientThreadId:l,composerController:b,isDisabled:bt,currentModelConfig:a,currentModelConfigLoading:u,disableIfNoAccess:nt},"shiba")),dt(L,"3240576626");const qo=Jn(L,"463092697")?.value,Jr=qo?.enabled??!1;if((qo?.enabledConnectors??[]).filter(C=>C!==J.GITHUB_CONNECTOR||Me),de&&!Vo&&(tt&&tt.connection_statuses.length>0||Jr)&&Ie.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-search-action)"},"data-testid":"composer-action-contextual-answers",children:e.jsx(ug,{composerController:b,systemHint:de,clientThreadId:l,connectionStatuses:tt?.connection_statuses??[]})},"contextual-answers")),Nr&&Ie.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-system-hint-action)"},"data-testid":"composer-action-system-hint-button",children:e.jsx(ig,{composerController:b,clientThreadId:l,disabled:bt,hideThinkButton:nt,disableIfNoAccess:nt})},"system-hint-button")),uo==="none"){const C=Ie.filter(V=>D?V.key==="search":!0);Ot.push(...C)}else{const C=Ie.find(V=>V.key==="system-hint-button");C&&Ot.push(C)}const zs=dt(L,"2007855518"),Yo=Ne?.message.metadata?.async_task_id,Ws=Gd(C=>Yo?C.tasks[Yo]:null),[Zr,Ko]=f.useState(!1),Vs=Ws?.status===zd.RUNNING,qs=Yr||Dr?"disabled":"default",$o=Wd(Ft(l)||l)?.value,el=$o===ja.STREAMING,tl=$o===ja.REALTIME,Qo=m&&h||el||tl||Vs&&zs,sl=qm(),nl=!St||sl,Ys=Jd(So,Co,Os,wr,!wo,Vs,zs),yt=Qo?"streaming":nl?"disabled":"idle",Dt=f.useRef(null),vt=f.useRef(null),{value:ol}=ae("222560275"),al=ol||o&&!o.startsWith("o1")&&!o.startsWith("o3");f.useEffect(()=>{const C=()=>{Dt.current!=null&&Xm.addAction("composer_state_disabled",{threadId:Ft(l),disabledReason:Dt.current})};if(es&&yt==="disabled"){let V="unknown";p?V=S??"component_disabled_unknown":m?V="completion_in_progress":ce&&(V="thread_hard_blocked"),Dt.current!==V&&(vt.current&&clearTimeout(vt.current),vt.current=setTimeout(C,jg)),Dt.current=V}else Dt.current=null;return()=>{vt.current&&(clearTimeout(vt.current),vt.current=null)}},[l,es,yt,p,S,m,ce]);const ls=[];if(Ee?.label&&ls.push({type:Ee.type,value:Ee.label,onRemoveRegion:Bo}),he!==null){const C=!!he.gizmo.tags?.includes(vs.FirstParty);ls.push({type:"mention",value:he.gizmo.display.name,icon:e.jsx(Wi,{isFirstParty:C,src:he.gizmo.display.profile_picture_url,className:"icon-md"}),onRemoveRegion:()=>{Qt(null),b.focus()}})}f.useEffect(()=>{(!Ve||Ve.length===0||!os)&&(Ts.current=!1)},[Ve,os]);const il=f.useCallback((C,V,me)=>{Ts.current=C>=0,V&&b.setText(me?`${me.title}${me.body}`:"")},[b]),Xo=os&&Ve&&Ve.length>0&&!Ct&&!gt&&!b.hasMultipleLines()&&b.canShowAutocompletion();f.useEffect(()=>{Ct?M?.():w?.()},[Ct,M,w]);const cs=C=>{if(C.preventDefault(),C.stopPropagation(),Ps.current>0){const V=performance.now()-Ps.current;Jm.hist(Zm.DEFAULT,"final_user_input_to_submit_ms",[],V)}yt==="streaming"&&(!lo||b.isEmpty())?Vs&&zs?Ko(!0):Ur(C):To(C)},rl=Vd(a,Ni.Canvas),{value:ll}=ae("61299031"),cl=qd(),ul=rl&&ll&&!cl&&!xo&&!Wo;f.useEffect(()=>{},[fr,b]),f.useEffect(()=>{const C=Ft(l),V=n?.normalizedAccountUserId;if(!V||r)return;const me=on(()=>{const xe=b.getContentToSend().content;xe===""?Ym(C):Km(C,xe,V)},1e3);return b.subscribe("change",me)},[n,l,b,r,oe]);const Jo=e.jsx(Ff,{canUseInlineTagging:ns,isDisabled:p,clientThreadId:l,currentLeafId:Ge,currentRequestId:pt,canContinue:g,composerController:b,isNewThread:d,onContinueGenerating:C=>s({event:C,conversationMode:Pe(l)?.mode,systemHints:Js(Bt,b,ne)}),onResetState:Eo,conversationMode:X,isShowingAutocomplete:!!Xo}),Zo=!Qo&&X!=null&&al&&Yd.includes(X.kind)&&e.jsx(Kd,{clientThreadId:l,onTargetedReply:Or}),ea=Xo&&e.jsx("div",{className:"bg-token-main-surface-primary absolute start-0 z-[-1] box-border w-full ps-0 max-lg:bottom-full lg:top-full",children:e.jsx(cp,{suggestions:Ve,composerController:b,onSelect:_,onChange:il})}),ta=e.jsx(em,{composerController:b,parsedDocumentHandler:Hr}),sa=!R&&e.jsx(nr,{className:P}),na=e.jsx($d,{modelSupportedImageMimeTypes:ze,uploadType:it.Multimodal,attachmentsProductFeature:ss?.attachments}),dl=e.jsxs(e.Fragment,{children:[Ct&&e.jsx(Pa,{onClick:C=>Do(C),onClose:()=>{b.setShowTaggingDropdown(!1),b.focus()}}),Ls&&e.jsx(Ia,{composerController:b,clientThreadId:l})]}),{isImageGenEditor:oa}=Qd(),aa=dt(L,"3760395675");return oa?e.jsxs(ha.Provider,{value:Zt,children:[e.jsx(Sa,{onOauthRedirect:as,children:e.jsx(xa,{defaultOpen:aa,children:e.jsx("form",{id:"prompt",className:c,onSubmit:cs,children:e.jsxs("div",{className:"relative z-1 flex h-full max-w-full flex-1 flex-col",children:[sa,e.jsxs("div",{className:"group relative z-1 flex w-full items-center",style:{"--force-hide-label":Pr?"none":"block"},children:[e.jsxs(wn,{open:Ct||Ls,children:[e.jsx(Ya,{className:"w-full",children:oa?e.jsx(wg,{type:ge?"temporary":"default",ref:z,placeholder:Gs,inputState:qs,composerController:b,leftSideActions:Ho,state:yt,onSubmit:cs,renderFiles:We&&e.jsxs(e.Fragment,{children:[ve==="magic"&&e.jsx("div",{className:"bg-token-main-surface-secondary text-token-text-secondary m-2 mb-0 rounded-lg p-2 text-xs",children:e.jsx(E,{...ee.gizmoKnowledgeWarning})}),e.jsx(un,{files:re,className:"-ms-1.5 flex flex-nowrap gap-2 overflow-x-auto p-1.5"})]}),clientThreadId:l,gizmoId:st,disableReason:Ys,modelId:o}):e.jsx(tg,{type:ge?"temporary":"default",ref:z,replyRegions:ls,placeholder:Gs,inputState:qs,setIsComposerOverflowing:Tr,composerController:b,matchaData:Fr,leftSideActions:Ot,topRightAction:ul&&e.jsx(Zd,{composerRef:z,composerController:b,clientThreadId:l}),state:yt,onSubmit:cs,renderFiles:vr&&e.jsxs(e.Fragment,{children:[ve==="magic"&&e.jsx("div",{className:"bg-token-main-surface-secondary text-token-text-secondary m-2 mb-0 rounded-lg p-2 text-xs",children:e.jsx(E,{...ee.gizmoKnowledgeWarning})}),e.jsx(un,{files:re,selectedApps:Is,className:"-ms-1.5 flex flex-nowrap gap-2 overflow-x-auto p-1.5"})]}),clientThreadId:l,gizmoId:st,disableReason:Ys,modelId:o})}),e.jsx(_n,{children:e.jsxs(jn,{side:"bottom",align:"start",sideOffset:12,onOpenAutoFocus:C=>C.preventDefault(),children:[Ct&&e.jsx(Pa,{onClick:C=>Do(C),onClose:()=>{b.setShowTaggingDropdown(!1),b.focus()}}),Ls&&e.jsx(Ia,{composerController:b,clientThreadId:l})]})})]}),ea]}),ta,na]})})})}),Jo,Zo]}):e.jsx(ha.Provider,{value:Zt,children:e.jsxs(xa,{defaultOpen:aa,children:[e.jsx(Sa,{onOauthRedirect:as,children:e.jsxs("div",{className:q("max-xs:[--force-hide-label:none] relative z-1 flex h-full max-w-full flex-1 flex-col",nt&&!ie&&"[--force-hide-label:none]"),children:[sa,Ws&&Zr&&e.jsx(Xd,{taskId:Ws.taskId,clientThreadId:l,onClose:()=>Ko(!1)}),e.jsx(vg,{visualTreatment:mo?"composer-btn":"legacy",hasFiles:We,pendingFiles:re,isUploadDisabled:!Uo,isNewThread:d,clientThreadId:l,getEditorGizmoId:we,highlightUploadTooltip:Fo&&!We,disableReason:Ys,uploadButtonDisabledReason:zo,currentModel:a,layoutMode:rs,conversationMode:X,onOauthRedirect:as,state:yt,inputState:qs,gizmoId:st,isTemporaryChat:ge,placeholder:Gs,composerController:b,onSubmit:cs,replyRegions:ls,keepExpanded:!0,legacyFooterActions:Ot,legacySuggestionsPopoverContent:dl,isInReasonMode:Bt,modelSupportedSystemHints:et,contextualAnswerUserConnectionData:tt}),ea]})}),ta,Jo,Zo,na]})})}function La({clientThreadId:t,onClick:s}){f.useEffect(()=>{lm(t)},[t]);const n=K();return e.jsx(Z.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},className:"inline-block",children:e.jsx(ki,{onClick:()=>{cm(t),s()},label:n.formatMessage(Tg.moreStarterPrompts)})})}function Ag({starterPrompt:t,starterPrompts:s,index:n,disabled:o,onSelectStarterPrompt:a}){const r=t.theme??t.title,i=rp(),{mutate:u}=im(),l=t.category==="onboarding"?d=>{u({key:pe.hasUsedConversationalOnboardingStarterPrompt}),i(d,t,s,n)}:d=>a?.(d,t,s,n);return e.jsx(ki,{disabled:o,onClick:l,icon:e.jsx(rm,{category:t.category,useV2Colors:!0}),label:r})}const Mg=5,Eg=3;function mr({starterPrompts:t,onSelectStarterPrompt:s,disabled:n,clientThreadId:o,onExpand:a,mobileLayout:r=!1}){const i=r?Eg:Mg,[u,l]=f.useState(i),[d,m]=f.useState(!1),c=f.useRef(null),p=t.length<=u;f.useEffect(()=>{ba(t.slice(0,i),o)},[o]),f.useEffect(()=>{if(!d&&!p&&c.current){const h=c.current,g=h.getBoundingClientRect(),x=g.width,v=Array.from(h.children);let y=0;for(let _=0;_<v.length&&v[_].getBoundingClientRect().right-g.left<=x;_++)y++;l(y),m(!0)}},[t,p,d]);const S=()=>{const h=t.slice(u,t.length).map(g=>({...g,isAdditional:!0}));h.length>0&&ba(h,o),l(t.length),a()};return e.jsxs("div",{"data-testid":"starter-prompt-chips",className:q("mt-5 flex items-center justify-center gap-x-2 transition-opacity xl:gap-x-2.5",d&&t.length>0?"opacity-100":"opacity-[0.01]",r?"flex-wrap":"flex-nowrap"),children:[e.jsxs("ul",{className:q("relative flex items-stretch gap-x-2 gap-y-4 overflow-hidden py-2 sm:gap-y-2 xl:gap-x-2.5 xl:gap-y-2.5",p||r?"flex-wrap justify-center":"flex-nowrap justify-start"),ref:c,children:[t.slice(0,u).map((h,g)=>e.jsx(Z.li,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},children:e.jsx(Ag,{starterPrompt:h,starterPrompts:t,index:g,disabled:n,onSelectStarterPrompt:s})},h.id??g)),r&&t.length>u&&e.jsx(La,{clientThreadId:o,onClick:S})]}),!r&&t.length>u&&e.jsx(La,{clientThreadId:o,onClick:S})]})}const sh=({clientThreadId:t,currentModelId:s,isModelLoaded:n})=>{const[o,a]=f.useState(!1),r=Zn(),{prospectiveModelId:i}=_s(t),u=n?s:i??"auto",{promptStarters:l,shouldShowStarterPrompts:d,onSelectStarterPrompt:m}=zi({isModelLoaded:n,shouldBeEnabledForDefaultAssistant:!0,clientThreadId:t,limit:8,modelSlug:u});return e.jsx(Z.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:q(!o&&"h-[116px]"),children:d&&l&&e.jsx(mr,{starterPrompts:l,onSelectStarterPrompt:m,disabled:r,clientThreadId:t,onExpand:()=>a(!0),mobileLayout:!0})})},Pg=({currentModelId:t,clientThreadId:s,isModelLoaded:n})=>{const{isUnauthenticated:o}=Te(),[a,r]=f.useState(!1),i=am(),u=Zn(),{prospectiveModelId:l}=_s(s),d=n?t:l??"auto",{promptStarters:m,shouldShowStarterPrompts:c,onSelectStarterPrompt:p}=zi({isModelLoaded:n,shouldBeEnabledForDefaultAssistant:!0,clientThreadId:s,limit:8,modelSlug:d});return e.jsx(Z.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:q("hidden min-h-[108px] max-w-full",i?"@lg/thread:block":"lg:block",o&&a?"":"h-[70px]"),children:c&&m&&e.jsx(mr,{starterPrompts:m,onSelectStarterPrompt:p,disabled:u,clientThreadId:s,onExpand:()=>r(!0)})})},Tg=Fe({moreStarterPrompts:{id:"SplashScreenV2.moreStarterPrompts",defaultMessage:"More"}}),Fa=Yn.div`m-8 flex flex-col items-center`;function Ha(t){return e.jsx(Z.div,{initial:{opacity:0,translateY:20},animate:{opacity:1,translateY:0,transition:{duration:.5,ease:"easeIn"}},...t})}function Ng({clientThreadId:t}){const n=le(t,a=>a?.promptGptRating)?.gizmoId,{data:o}=Ri(n);return n==null||o==null||!um(o)?null:e.jsx(Bg,{gizmoId:n})}function Bg({gizmoId:t}){const[s,n]=f.useState(!1),[o,a]=f.useState(!1),r=dm(t),i=async l=>{n(!0),setTimeout(()=>{a(!0)},5e3),T.logEvent("Submit Inline Rating",{gizmo_id:t,rating:l}),await r.mutateAsync({rating:l})},u=async()=>{a(!0),T.logEvent("Dismiss Inline Rating",{gizmo_id:t}),await r.mutateAsync({})};return f.useEffect(()=>{o||T.logEvent("Show Inline Rating",{gizmo_id:t})},[o,t]),o?null:s?e.jsx(Fa,{children:e.jsxs(Ha,{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"border-token-border-heavy rounded-lg border p-4",children:e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(E,{id:"gizmo.inlineReview.reviewLeft",defaultMessage:"Feedback sent"}),e.jsx(ka,{onClick:()=>{a(!0)}})]})}),e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(E,{id:"gizmo.inlineReview.reviewLeftSubtext",defaultMessage:'To update your rating, click "Send Feedback" in the GPT Menu'})})]})}):e.jsx(Fa,{children:e.jsxs(Ha,{className:"border-token-border-heavy flex flex-col items-center gap-4 rounded-lg border p-4",children:[e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(E,{id:"gizmo.inlineReview.prompt",defaultMessage:"How would you rate this GPT so far?"}),e.jsx(ka,{onClick:u})]}),e.jsx(mm,{rating:void 0,onRating:i})]})})}const nh=({clientThreadId:t,isNewThread:s,isGizmoThread:n,isProjectThread:o,isModelLoaded:a,currentModelId:r,onRequestCompletion:i,shouldUseUnifiedComposer:u,onlyAllowImageUploads:l})=>{const d=Mt(),{pageType:m}=wi(),c=m?.type==="landing-page",p=f.useContext(Gi),S=sp(p),h=Gn();Et(),Sm(d);const g=async _=>{if(Pe(t)?.isLoading!==!1)return;const P=await Cm(_);i(P)},x=f.useCallback(_=>{T.logEvent("Continue Completion"),i(bm(_))},[i]),v=e.jsxs(e.Fragment,{children:[e.jsx(Ng,{clientThreadId:t}),e.jsx(Zs,{verticalMargin:"none",verticalPadding:S?"last-standard":"none",horizontalPadding:"standard",children:e.jsx(en,{children:e.jsx(Ig,{clientThreadId:t,currentModelId:r,isNewThread:s,hideHeader:s,onRequestCompletion:g,onContinueGenerating:x,onAutocompleteSelect:d.onAutocompleteSelect,onlyAllowImageUploads:l})})})]}),y=s&&e.jsx("div",{className:q("[display:var(--display-hidden-until-loaded,block)] md:absolute md:start-0 md:bottom-6 md:w-full"),children:e.jsx(Zs,{verticalMargin:"none",verticalPadding:"none",horizontalPadding:"standard",children:e.jsx(en,{children:e.jsx(nr,{className:"block flex-1"})})})});return u?e.jsxs(e.Fragment,{children:[h&&y,e.jsx("div",{id:"thread-bottom",children:v}),!h&&y,s&&!c&&!n&&!o&&e.jsx(Zs,{verticalMargin:"none",verticalPadding:"none",horizontalPadding:"standard",children:e.jsx(en,{children:e.jsx(Pg,{clientThreadId:t,currentModelId:r,isModelLoaded:a})})})]}):v};function Ig({clientThreadId:t,currentModelId:s,disableDraftPersistence:n=!1,isNewThread:o,onRequestCompletion:a,onContinueGenerating:r,onComposerInput:i,onComposerChange:u,onAutocompleteSelect:l,headerClassName:d,hideHeader:m,onTaggingDropdownClose:c,onTaggingDropdownOpen:p,onlyAllowImageUploads:S}){const{data:h,isLoading:g}=$t(),[x,v,y,_]=le(t,Y=>{const F=se.getCurrentNode(Y);return[F.message.clientMetadata?.errType!=null&&F.message.clientMetadata.errType!=="info",np(se.getCurrentNode(Y).message),Y?.mode,Y?.continuingFromSharedConversationId!=null]}),P=Et(),R=Mt(),M=ep({clientThreadId:t}),{isOpen:w,onClose:j}=pm({type:"just-hit-rate-limit"}),N=f.useMemo(()=>M?!1:!x&&v,[x,v,M]),D=M,L=Li(t),z=Ri(L).data,b=tp(),I=z?.gizmo.tags?.includes(vs.WorkspaceDisabled)&&!b?"workspaceDisallowsGizmo":h?.models.size===0?"noModelsAvailable":y?.kind===Oe.GizmoTest&&y.gizmo_id==null?"noTestGizmoId":null,G=hl(),W=fm(),k=G.action==="moderate",{value:U}=ae("1860647109");return e.jsxs(e.Fragment,{children:[e.jsx(gm,{composerController:R,clientThreadId:t,currentModelId:s,isCompletionInProgress:M}),e.jsx("div",{className:"flex justify-center empty:hidden",children:W&&k&&U?e.jsx(hm,{}):null}),w?e.jsx(xm,{onClose:j}):null,e.jsx(Rg,{clientThreadId:t,disableDraftPersistence:n,onCreateNewCompletion:a,onContinueGenerating:r,currentModelId:s,account:P,modelCategories:h?.categories,currentModelConfig:li(h?.models,s),areModelsLoading:g,isNewThread:o,isCompletionInProgress:M,className:"w-full",canContinue:N,disabled:!!I,disabledReason:I??void 0,canPause:D,isInteractableSharedThread:_,onComposerInput:i,onComposerChange:u,onAutocompleteSelect:l,headerClassName:d,hideHeader:m,onTaggingDropdownClose:c,onTaggingDropdownOpen:p,onlyAllowImageUploads:S},t)]})}export{Yf as D,th as F,wg as I,sh as M,Ig as P,nh as T,qf as g,io as h};
//# sourceMappingURL=m5nmfgkx7kb16kea.js.map
