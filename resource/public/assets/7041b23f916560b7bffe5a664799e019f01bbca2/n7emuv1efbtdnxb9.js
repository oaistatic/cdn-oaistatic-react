import{r as f,j as r,M as h,u as E,h as Q,d as V,f as m,a as W,c as X,b as Y}from"./lip667d8t42poxum.js";import{aj as Z,q as i,am as $,b as p,ao as I,m as _,ac as J,g as v,s as ee}from"./n9zp7vm10xoipejo.js";import{f7 as U,cB as te,g2 as ne,al as se,g3 as oe,g4 as P,g5 as ae,g6 as re,g7 as ce,k as ie,g8 as R,cW as le,g9 as ue,ga as de,gb as ge,gc as q,gd as G,ge as fe,gf as Ce,gg as he}from"./l4oo5ijw01fyrjzs.js";import{b as me}from"./ef49rx2y546x1g51.js";const pe=({date:t})=>{const[e,n]=f.useState(Date.now());f.useEffect(()=>{const s=setInterval(()=>{n(Date.now())},6e4);return()=>clearInterval(s)},[]);const o=()=>{const s=new Date(t).getTime(),a=Math.floor((e-s)/1e3);return a<60?r.jsx(h,{id:"3Is9g3",defaultMessage:"Last updated a few seconds ago"}):a<3600?r.jsx(h,{id:"hXLIc6",defaultMessage:"Last updated a few minutes ago"}):r.jsx(h,{id:"ZV7Qx7",defaultMessage:"Last updated a few hours ago"})};return r.jsx("span",{children:o()})},F=()=>E({queryKey:["user_connection_status"],queryFn:ie.user_connection_status});function Me(){const{data:t,isLoading:e,refetch:n,dataUpdatedAt:o}=F();return f.useEffect(()=>{Z.logEventWithStatsig("Contextual Answers User Settings Modal Shown","chatgpt_contextual_answers_user_settings_modal_shown")},[]),r.jsxs("div",{children:[r.jsxs(U,{children:[r.jsxs("div",{className:"text-md text-token-text-primary mb-1 flex items-center gap-2 font-medium",children:[r.jsx(te,{class:"icon-md"}),r.jsx("div",{children:r.jsx(h,{id:"YxAwHl",defaultMessage:"Internal knowledge"})}),r.jsx(ne,{})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-token-text-secondary",children:r.jsx(h,{id:"b5cZ0X",defaultMessage:"Connect these data sources so ChatGPT can surface relevant, personalized information — based on what you’re authorized to view. {learnMore}",values:{learnMore:r.jsx(se,{href:P,className:"underline",onClick:()=>oe({link:P,location:"user_settings"}),children:r.jsx(h,{id:"N1i4rw",defaultMessage:"Learn more"})})}})}),r.jsx("p",{className:"text-token-text-secondary font-medium",children:r.jsx(pe,{date:new Date(o)})})]})]}),r.jsx("div",{className:"border-b",children:e?r.jsx("div",{className:"p-2",children:r.jsx(me,{lines:4})}):t?.connection_statuses.length?r.jsx("div",{children:t.connection_statuses.map(s=>r.jsx(U,{children:r.jsx("div",{className:"pt-3 pb-1",children:r.jsx(ae,{icon:r.jsx("img",{src:s.connection_display_info.icon_url??"",alt:s.connection_display_info.display_name,className:"icon-lg"}),title:s.connection_display_info.display_name,statusIndicator:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(re,{connection:s,location:"user_settings"}),r.jsx(ce,{connection:s,refetch:n})]})})})},s.user_connection_details.connection_instance_id))}):r.jsx("p",{className:"text-token-text-secondary my-2",children:r.jsx(h,{id:"nzXh59",defaultMessage:"No connections found."})})})]})}const ke=R[i.GDRIVE_ACTION_CONNECTOR],Ae=[i.GDRIVE_ACTION_CONNECTOR,i.GCAL_CONNECTOR,i.GMAIL_CONNECTOR].map(t=>R[t]),be=()=>{const t=V();return e=>{const n=window.location.hash,[o,s]=n.split("?"),a=new URLSearchParams(s);e?a.set("connector",e):a.delete("connector");const c=a.toString()?`${o}?${a.toString()}`:o;t(c,{replace:!0})}},je=()=>{const{hash:t}=Q(),e=t.indexOf("?");if(e===-1)return null;const n=t.substring(e+1);return new URLSearchParams(n).get("connector")},_e=t=>t.supported_auth.some(e=>e.type==="OAUTH")?"OAUTH":"NONE",Oe=t=>p.safePost("/aip/connectors/links/noauth",{requestBody:{connector_id:t.id,name:t.name,action_names:t.actions.map(e=>e.name)}}),Ne=async(t,e)=>{const n=de[t.id],o={connectorId:t.id,name:t.name,actionNames:t.actions.map(s=>s.name),oauthClientId:ge(n,e),oauthClientScopes:null};await q(G,o,`#settings/ConnectorSettings?connector=${t.id}`)},Ee=async(t,e)=>{switch(_e(t)){case"OAUTH":return await Ne(t,e),null;case"NONE":return await Oe(t)}},De=()=>{const t=le(),e=F(),n=f.useMemo(()=>e.data?.connection_statuses.filter(l=>["google_drive_oauth","google_drive_dwd"].includes(l.user_connection_details.knowledge_connector_type)),[e.data]),o=t&&!!n?.length,s=ue(),a=s.connectorConfig.get($.GDRIVE),c=s.isGdriveEnabled&&!!a;return{isLoading:e.isLoading||s.isLoading,fileUploadConfig:c?a:null,internalKnowledgeConfigs:o?n:null}};function Se(){const t=J("3747383021").config,e=v(),n=ee(e,"3544641259");return{[i.GITHUB_CONNECTOR]:n&&t.get("github",!1),[i.GDRIVE_ACTION_CONNECTOR]:n&&t.get("google_drive",!1),[i.DROPBOX_CONNECTOR]:n&&t.get("dropbox",!1),[i.LINEAR_CONNECTOR]:n&&t.get("linear",!1),[i.HUBSPOT_CONNECTOR]:n&&t.get("hubspot",!1),[i.SHAREPOINT_CONNECTOR]:n&&t.get("sharepoint",!1),[i.GCAL_CONNECTOR]:n&&t.get("google_calendar",!1),[i.GMAIL_CONNECTOR]:n&&t.get("gmail",!1),[i.GOOGLE_CONTACTS_CONNECTOR]:n&&t.get("google_contacts",!1),[i.TEAMS_CONNECTOR]:n&&t.get("teams",!1),[i.OUTLOOK_EMAIL_CONNECTOR]:n&&t.get("outlook_email",!1),[i.OUTLOOK_CALENDAR_CONNECTOR]:n&&t.get("outlook_calendar",!1),[i.BOX_CONNECTOR]:n&&t.get("box",!1),[i.INTERCOM_CONNECTOR]:n&&t.get("intercom",!1)}}function ye(t){const e=m(),o=I()?.getWorkspaceId(),s=_(),{data:a,isLoading:c,error:l,refetch:u}=E({queryKey:["fetchConnectorWorkspacePermissions",o,t],queryFn:async()=>{if(!o)return!0;try{const{enabled:d}=await p.safeGet("/accounts/{account_id}/connectors/{connector_id}/workspace_permissions",{parameters:{path:{account_id:o,connector_id:t}}});return d}catch(d){throw s.danger(e.formatMessage({id:"GZxiZ3",defaultMessage:"Error fetching connector workspace permissions"})),d}}});return{enabled:a,isLoading:c,error:l,refetch:u}}function Ue(){return ye(R[i.GITHUB_CONNECTOR])}function B({skip:t=!1}={}){const e=m(),n=I(),o=_(),{data:s,isLoading:a,isFetching:c,error:l,refetch:u}=E({queryKey:["fetchPlatformConnectorData",n?.normalizedAccountUserId],queryFn:async()=>{if(!n||!n.normalizedAccountUserId)return[];try{return(await p.safePost("/aip/connectors/list_accessible",{requestBody:{principals:[{type:"USER",id:n.normalizedAccountUserId}]}})).connectors}catch(g){throw o.danger(e.formatMessage({id:"F+mY2E",defaultMessage:"Error fetching connectors"}),{id:"fetch-connectors-error",duration:3,hasCloseButton:!0}),g}},enabled:!t&&!!n});return{platformConnectors:f.useMemo(()=>new Map(s?.map(g=>[g.id,g])),[s]),isLoading:a,isFetching:c,error:l,refetch:u}}function Pe(t=!0){const e=m(),n=_(),{data:o,isLoading:s,isFetching:a,error:c,refetch:l}=E({queryKey:["fetchFirstPartyConnectors"],queryFn:async()=>{try{return(await p.safeGet("/aip/connectors/first_party")).connectors}catch{return n.danger(e.formatMessage({id:"F+mY2E",defaultMessage:"Error fetching connectors"}),{id:"fetch-first-party-connectors-error",duration:3,hasCloseButton:!0}),[]}},enabled:t});return{connectors:o??[],isLoading:s||a,error:c,refetch:l}}function z({skip:t=!1}={}){const e=m(),n=I(),o=_(),{data:s,isFetching:a,error:c,refetch:l}=E({queryKey:["fetchConnectorLinkData",n?.normalizedAccountUserId],enabled:!t,placeholderData:()=>new Map,queryFn:async()=>{if(!n||!n.normalizedAccountUserId)return new Map;try{const d=await p.safePost("/aip/connectors/links/list_accessible",{requestBody:{principals:[{type:"USER",id:n.normalizedAccountUserId}]}});return Map.groupBy(d.links,({connector_id:g})=>g)}catch(d){throw o.danger(e.formatMessage({id:"EgrzHa",defaultMessage:"Error fetching connectors connections"}),{id:"fetch-connector-links-error",duration:3,hasCloseButton:!0}),d}}});return{connectorLinks:f.useMemo(()=>s??new Map,[s]),isLoading:a,error:c,refetch:l}}function xe(t,e){const n=m(),o=_(),{data:s,isLoading:a,error:c,refetch:l}=E({queryKey:["connector-client-data",t],queryFn:async()=>{const u=await p.safeGet("/aip/connectors/oauth_clients",{parameters:{query:{service:e}}});return u.oauth_clients?u.oauth_clients:(o.danger(n.formatMessage({id:"OfpT7B",defaultMessage:"Request error fetching oauth clients"}),{id:"fetch-oauth-clients-error",duration:3,hasCloseButton:!0}),[])}});return{oAuthClients:s,isLoading:a,error:c,refetch:l}}function ve(t,e,n="/",o,s){const a=fe(),{platformConnectors:c,isLoading:l,error:u,refetch:d}=B(),{connectorLinks:g,isLoading:O,error:y,refetch:C}=z(),{oAuthClients:N,isLoading:K,error:H,refetch:k}=xe(t,e),A=Le(),L=f.useCallback(()=>{d(),C(),k()},[d,C,k]),x=R[t],T=c.get(x),b=g.has(x),M=g.get(x)?.[0]?.id,j=f.useCallback(()=>{M&&A(M,()=>{L()})},[A,L,M]),D=u??y??H,w=l||O||K,S=f.useCallback(()=>{if(!w){if(!T){o?.();return}if(!N?.length){s?.();return}q(G,{oauthClientId:N[0].id,oauthClientScopes:N[0].scopes,name:T.name,actionNames:Ce[t],connectorId:x},n,a)}},[w,T,N,t,x,n,a,o,s]);return f.useMemo(()=>({isLoading:w,isConnected:b,connect:S,error:D,refetch:L,handleDisconnect:j}),[w,b,S,D,L,j])}function qe(t){"use forget";const e=X.c(15),{onSuccess:n}=t,o=m(),s=v(),a=_(),{refetch:c}=B(),{refetch:l}=z();let u;e[0]!==s?(u=async y=>{const{connector:C}=await p.safePost("/aip/connectors/mcp",{requestBody:{...y,auth_request:{supported_auth:[],oauth_client_params:null}}}),N=await Ee(C,s);return{connector:C,link:N}},e[0]=s,e[1]=u):u=e[1];let d;e[2]!==o||e[3]!==n||e[4]!==c||e[5]!==l||e[6]!==a?(d=y=>{const{connector:C}=y;a.success(o.formatMessage({id:"lQ8QJw",defaultMessage:"{connectorName} is now connected"},{connectorName:C.name})),c(),l(),n?.()},e[2]=o,e[3]=n,e[4]=c,e[5]=l,e[6]=a,e[7]=d):d=e[7];let g;e[8]!==o||e[9]!==a?(g=()=>{a.danger(o.formatMessage({id:"rftuYU",defaultMessage:"Error creating custom connector"}))},e[8]=o,e[9]=a,e[10]=g):g=e[10];let O;return e[11]!==u||e[12]!==d||e[13]!==g?(O={mutationFn:u,onSuccess:d,onError:g},e[11]=u,e[12]=d,e[13]=g,e[14]=O):O=e[14],Y(O)}function Le(){const t=m(),e=_(),n=I(),o=W();return async(a,c)=>{try{await he(a),o.invalidateQueries({queryKey:["fetchConnectorLinkData",n?.normalizedAccountUserId]}),c?.()}catch{e.danger(t.formatMessage({id:"Gmong7",defaultMessage:"Error disconnecting connector"}))}}}export{Me as C,Ae as G,ve as a,Ue as b,Se as c,Pe as d,z as e,B as f,ke as g,be as h,Le as i,De as j,F as k,Oe as l,je as m,Ne as n,qe as o,_e as p,ye as u};
//# sourceMappingURL=n7emuv1efbtdnxb9.js.map
