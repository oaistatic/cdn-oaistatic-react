import{r as f,v as N,f as A,j as s,g as I,a6 as D,M as v}from"./lip667d8t42poxum.js";import{gE as U,fd as $,cv as E,aa as F,B,af as z,aj as P,c as S,ag as C}from"./n9zp7vm10xoipejo.js";import{de as G,ew as h,fA as T,hU as O,dd as R,hV as W,hW as L,hX as V,hY as q,cT as Y}from"./l4oo5ijw01fyrjzs.js";import{u as Z}from"./ezoyp421dng92ve4.js";import{AnimatedContainer as k}from"./k1r4vom7dvt4durd.js";import"./krf7zg7fy4qqowqq.js";import"./j385t288u9l3nf6j.js";import"./g6xbnr889jd3q0af.js";const H=(t,e,o,i)=>{const d=G(t),u=Z(t),p=U();return f.useCallback((c,g)=>{if(p)return;const a=`
        The user would like you to focus on a file from an earlier search result as you respond to their prompt: "${o.replaceAll('"',"")}". The file's ID is "${e.replaceAll('"',"")}".
        When you respond, try to acknowledge that you're focusing on the file if it's not clear from the context. For example, if you mclick the file, you could mention that you've looked at the file.
        `,n=X(a,{exclude_after_next_user_message:!0});u({sourceEvent:c,promptMessage:$(g,{retrieval_hint_file_data:{id:e,name:o,url:i}}),completionMetadata:d?{conversationMode:d}:void 0,appendMessages:[n]})},[p,o,e,u,d,i])};function X(t,e){return{id:N(),author:{role:F.System},content:{content_type:E.Text,parts:Array.isArray(t)?t:[t]},metadata:e}}function J({isFollowupMenuOpen:t,setIsFollowupMenuOpen:e,clientThreadId:o,fileId:i,fileName:d,fileCloudDocUrl:u,className:p}){const c=H(o,i,d,u),g=A(),[a,l]=f.useState(""),n=f.useCallback((r,x)=>{x.length&&(c(r,x),l(""),e(!1))},[c,e]);return s.jsxs(h.Root,{open:t,onOpenChange:e,children:[s.jsx(h.Trigger,{className:p,children:s.jsx(T,{className:"icon-md"})}),s.jsx(h.Portal,{children:s.jsxs(h.Content,{size:"medium",children:[Object.values(Q).map(r=>s.jsx(K,{sendReply:n,suggestedText:g.formatMessage(r)},r.defaultMessage)),s.jsx("div",{className:"mx-2 flex cursor-pointer flex-row items-center gap-2 p-2.5 px-3 py-2.5 text-sm",children:s.jsxs("form",{onSubmit:r=>{r.preventDefault(),n(r,a)},className:"border-token-border-default flex items-center gap-2 rounded-full border border-solid px-4 py-2",children:[s.jsx("input",{type:"text",onChange:r=>l(r.target.value),className:"w-full flex-1 border-none bg-transparent p-0 ring-0 focus:border-none focus:shadow-none focus:ring-0",placeholder:g.formatMessage({id:"NpZ9+f",defaultMessage:"Ask about this file…"}),value:a}),s.jsx(B,{className:"flex-0",icon:O,color:"primary",size:"small",type:"submit"})]})})]})})]})}function K({suggestedText:t,sendReply:e}){return s.jsx(h.Item,{icon:T,onSelect:o=>e(o,t),textValue:"",children:t})}const Q=I({fileFollowupSuggestionTellMeMore:{id:"skmNc0",defaultMessage:"Tell me more about this."},fileFollowupSuggestionSummarize:{id:"BiNEEG",defaultMessage:"Summarize this."}});function y(t,e){const o=new RegExp(`<\\s*${e}\\s*>([\\s\\S]*?)<\\s*/\\s*${e}\\s*>`,"i"),i=t.match(o);return i&&i[1]?i[1].trim():t}function ee(t){if(t===void 0)return;const e="Content Snippet:",o=t.indexOf(e);return o===-1?t:t.substring(o+e.length).trim()}function te(t,e){e.text=ee(t.contents),t.documentId?.includes("ks--slack")?(e.text=void 0,e.name=`#${e.name}`):e.cloud_doc_url?.startsWith("https://docs.google.com/spreadsheets/")&&e.text!==void 0?e.text=y(e.text,"sheet_summary"):e.cloud_doc_url?.match(/^https:\/\/github\.com\/[^/]+\/[^/]+\/commit\//)&&e.text!==void 0?e.text=y(e.text,"git_summary"):e.cloud_doc_url?.match(/^https:\/\/github\.com\/[^/]+\/[^/]+\/blob\//)&&e.text!==void 0&&(e.text=y(e.text,"code_summary")),e.text&&(e.text=e.text.slice(0,250))}function me({turnIndex:t,clientThreadId:e}){const[o,i]=z(e,a=>[C.getTurnContentReferences(a,t),C.getConversationTurnAtIndex(a,t).messages]),d=R(e),u=f.useMemo(()=>({turnIndex:t,clientThreadId:e}),[e,t]),p=f.useMemo(()=>{const a=[],l=new Set;return o.forEach(n=>{n.type==="file"&&!l.has(n.id)?(a.push({id:n.id,name:n.name,cloud_doc_url:n.cloud_doc_url??n.extra?.cloud_doc_url,text:n.text}),l.add(n.id)):n.type==="file_navlist"&&n.items.forEach(r=>{l.has(r.id)||(a.push({name:r.name,cloud_doc_url:r.cloud_doc_url,text:r.description,id:r.id,lastModifiedTime:r.last_modified_time}),l.add(r.id))})}),a},[o]),c=W(d),g=f.useMemo(()=>{if(!c)return[];const a=[],l=new Set;for(const n of i)if(n.author.role===F.Tool&&n.author.name==="file_search"&&n.content.content_type===E.TetherBrowsingDisplay){const r=L(n.content.result),x=n.metadata?.cloud_doc_urls??[];r.chunks.forEach((m,b)=>{if(!m.documentId||l.has(m.documentId))return;l.add(m.documentId);let _;m.metadata.cloud_doc_url?_=m.metadata.cloud_doc_url.toString():b<x.length?_=x[b]:m.documentId.endsWith("--google")&&(_=`https://drive.google.com/file/d/${m.documentId.split("--")[1]}`);const M=m.metadata["File last modified at"]??m.metadata["File created at"],j={id:m.documentId,name:m.title,cloud_doc_url:_,text:m.contents,lastModifiedTime:M?M.toString():void 0};te(m,j),a.push(j)})}return a},[c,i]);return s.jsx(D,{children:s.jsxs("div",{className:"bg-token-main-surface-primary mt-[calc(var(--threadFlyOut-leading-height,57px)*-1)] flex w-full flex-col",children:[s.jsx(w,{title:s.jsx(v,{id:"dlVlo6",defaultMessage:"Citations"}),items:p,clientThreadId:e,sectionId:"citations",analyticsMetadata:u}),s.jsx(w,{title:s.jsx(v,{id:"njZblE",defaultMessage:"Search Results"}),items:g,clientThreadId:e,sectionId:"search-results",analyticsMetadata:u})]})})}function w({title:t,items:e,scrollToHeader:o,shouldAnimateScroll:i,clientThreadId:d,analyticsMetadata:u,sectionId:p}){const c=f.useRef(null),g=f.useMemo(()=>u?{...u,sectionId:p,numResultsInSection:e.length}:void 0,[u,e.length,p]);return f.useEffect(()=>{c.current&&o&&setTimeout(()=>{c.current&&c.current.scrollIntoView({behavior:i?"smooth":"instant"})},300)},[o,i]),!e||e.length===0?null:s.jsxs("div",{ref:c,children:[s.jsx(k,{className:"border-token-border-sharp bg-token-main-surface-primary text-token-text-primary sticky top-0 z-1 flex h-[calc(var(--header-height,3.5rem)+1px)] items-center border-b px-6 pt-4 pb-4 text-sm font-medium",children:t}),s.jsx("div",{className:"flex flex-col px-3 py-2",children:e.map((a,l)=>s.jsx(k,{index:l,children:s.jsx(se,{positionInSection:l,item:a,analyticsMetadata:g,clientThreadId:d},l)},`${t}-${l}`))})]})}function se({item:t,analyticsMetadata:e,positionInSection:o,clientThreadId:i}){const d=V(t.cloud_doc_url??""),u=d?.type??s.jsx(v,{id:"bqY3sN",defaultMessage:"File"}),p=d?.Icon??q,[c,g]=f.useState(!1),a=f.useCallback(()=>{e&&P.logEventWithStatsig("File Sources Sidebar Item Clicked","file_sources_sidebar_link_clicked",{...e,positionInSection:o,sourceType:d?.type,hasUrl:!!t.cloud_doc_url})},[e,t.cloud_doc_url,d?.type,o]);return s.jsx(s.Fragment,{children:s.jsxs("a",{href:t.cloud_doc_url,target:"_blank",rel:"noreferrer",onClick:a,className:S("group relative flex flex-col gap-0.5 rounded-xl px-3 py-2.5","hover:bg-token-main-surface-secondary",c&&"bg-token-main-surface-secondary"),children:[s.jsxs("div",{className:"line-clamp-1 flex h-6 items-center gap-2 text-xs",children:[p&&s.jsx(p,{className:"icon-sm bg-token-main-surface-primary rounded-full object-cover"}),u]}),s.jsx("div",{className:"line-clamp-2 text-sm font-semibold",children:t.name}),(t.text??t.lastModifiedTime)&&s.jsxs("div",{className:"text-token-text-secondary line-clamp-2 text-sm leading-snug font-normal",children:[t.lastModifiedTime&&s.jsxs("span",{children:[s.jsx(Y,{date:new Date(t.lastModifiedTime)}),t.text&&" — "]}),t.text]}),s.jsx(J,{className:S("absolute end-2 top-2 flex items-center justify-center rounded-sm p-1 transition","text-token-text-secondary group-hover:text-token-text-primary","invisible group-hover:visible","bg-token-main-surface-secondary hover:bg-token-main-surface-tertiary",c&&"bg-token-main-surface-tertiary text-token-text-primary visible"),clientThreadId:i,fileId:t.id,fileName:t.name,fileCloudDocUrl:t.cloud_doc_url,isFollowupMenuOpen:c,setIsFollowupMenuOpen:g})]})})}export{me as ChatScreenRetrievalResultsFlyoutContent,w as SourcesListGroup};
//# sourceMappingURL=gfp02260vw55ykp9.js.map
