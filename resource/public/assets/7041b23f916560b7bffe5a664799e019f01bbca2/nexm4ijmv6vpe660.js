const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/nsfzley2ztevyijw.js","assets/j1ssnrvz9lmkwy2f.js","assets/n9zp7vm10xoipejo.js","assets/lip667d8t42poxum.js","assets/root-ivmjnum3.css","assets/l4oo5ijw01fyrjzs.js","assets/conversation-small-k5k9c71c.css","assets/cbaql59zac1mfnmh.js","assets/op1xowyjquc2dnq7.js","assets/nmzcjggnos81a3wt.js","assets/ezoyp421dng92ve4.js","assets/krf7zg7fy4qqowqq.js","assets/j385t288u9l3nf6j.js","assets/ks210hfj07ihanwi.js","assets/k67sl0lg9wwjvh4l.js"])))=>i.map(i=>d[i]);
import{R as ue,c as R,a as Mt,r as h,j as t,M as w,g as Me,d as qe,f as G,L as Tt,a6 as ne,a5 as D}from"./lip667d8t42poxum.js";import{nA as Xe,km as Ke,rD as Et,j9 as _,j_ as Ot,kr as Lt,rM as zt,rN as Ft,an as V,rO as Pt,ky as Te,S as Ee,rP as Rt,rQ as Oe,rR as Bt,rS as At,rT as Dt,rU as ve,rV as Ye,rW as Je,pi as Ze,rX as je,b_ as et,cy as me,kn as Gt,rY as Ce,Q as Ht,nH as Ut,M as Wt,nx as $t,e$ as Vt,rZ as Qt,r_ as qt,r$ as de,eE as Xt,y as ye,s0 as Kt,kt as Yt,s1 as be,U as Q,aF as tt,bJ as Jt,bI as Zt,s2 as es,q as st,s3 as ts,s4 as ss,s5 as at,hO as as,z as nt,s6 as ns,s7 as Se,eJ as is,ko as rs,kl as os,s8 as _e,s9 as ls,sa as cs,sb as ds,sc as us,kH as ms,kI as fs,sd as xs,ls as it,se as hs,sf as gs,sg as ps,f$ as js,sh as bs,si as Ss,kJ as vs,kC as ys,bL as rt,eV as Ns,sj as ws,sk as oe,sl as ks,hY as Is,qD as Cs,sm as _s,sn as Le,so as Ms,sp as Ts,sq as Es,sr as Os,ss as Ls,st as zs,su as Ae,sv as Fs,sw as Ps,sx as ot,I as Rs,B as lt,f as Bs,mF as As,sy as Ds,mA as Gs,mG as Hs,sz as ct,sA as Us,sB as Ws,m_ as $s,dr as Vs,ds as Qs,sC as qs,c6 as dt,ar as Xs,fK as Ks,fB as Ys,aq as Js,ay as Zs,dy as ea,sD as ut,sE as ta,sF as sa,sG as aa,sH as na,hw as ia,sI as ra,sJ as oa,oh as la}from"./l4oo5ijw01fyrjzs.js";import{F as ca,gA as da,ao as xe,c as E,B as ie,ce as mt,cb as W,W as De,at as ft,_ as fe,g as B,ap as ua,ae as ma,t as xt,X as fa,dj as ht,b1 as xa,v as gt,aj as re,cT as ha,d9 as ga,dg as pt,bC as pa,dR as ja,dm as ba,dn as Sa,dp as va,dr as ya,dM as Na,dt as wa,du as ka,as as ze,af as Fe,E as Ia,cV as Ca,ag as jt,ai as bt,e1 as _a,dX as St,s as Ma,c0 as Ta,ew as Ea,k as Oa,cU as La,fA as vt,gu as $,ev as za}from"./n9zp7vm10xoipejo.js";import{e as yt,h as Fa,i as Pa,j as Pe}from"./n4y4yo9zuw99bnsn.js";import{u as Ra,H as Ba,a as Aa}from"./o0md5hhsc34wyah3.js";import{i as Da}from"./cbaql59zac1mfnmh.js";import{G as Nt}from"./oour34cwuwf9tyoh.js";import{u as Ga}from"./nmzcjggnos81a3wt.js";import{W as Ge}from"./es0z9v8doc0hgjd4.js";import{P as Ha}from"./btgi4ch9w5xby7vu.js";const He=Me({unableToLoadHistory:{id:"history.unableToLoad",defaultMessage:"Unable to load history"},retryButton:{id:"history.retryButton",defaultMessage:"Retry"}});function Ua(s){const e=JSON.stringify(s.map(n=>[n.id,n.title,n.update_time]));return h.useMemo(()=>s,[e])}function Wa(s){"use forget";const e=R.c(57),{activeId:a,hideOverflowMenu:n}=s,i=Mt(),[r,c]=h.useState(!1),[l,m]=h.useState(0),d=da(),[u,f]=h.useState(!1),o=Xe(),x=Ke();let g;e[0]===Symbol.for("react.memo_cache_sentinel")?(g={},e[0]=g):g=e[0];const{conversations:v,hasNextPage:p,fetchNextPage:S,isLoading:j,isFetchingNextPage:N,isError:y}=Et(g),k=Ua(v),C=h.useRef(null);let b;e[1]!==p||e[2]!==j||e[3]!==S?(b=z=>{j||z==null||(C.current?.disconnect(),C.current=new IntersectionObserver(_t=>{_t[0].isIntersecting&&p&&S()}),C.current.observe(z))},e[1]=p,e[2]=j,e[3]=S,e[4]=b):b=e[4];const T=b;let I,O;e[5]===Symbol.for("react.memo_cache_sentinel")?(I=()=>()=>{C.current?.disconnect()},O=[],e[5]=I,e[6]=O):(I=e[5],O=e[6]),h.useEffect(I,O);let M,H;e[7]!==k?(M=()=>{mt.publish({kind:"refreshHistory",conversations:k})},H=[k],e[7]=k,e[8]=M,e[9]=H):(M=e[8],H=e[9]),h.useEffect(M,H);const L=k;let A,he;e[10]!==l||e[11]!==d?(A=()=>{const z=zt(Ft(),Date.now());d(()=>{m(l+1)},z+1e3)},he=[l,d],e[10]=l,e[11]=d,e[12]=A,e[13]=he):(A=e[12],he=e[13]),h.useEffect(A,he);const F=L.length===0;_.markStart("History",_.NS_SIDEBAR),xe()!=null&&!j&&_.markRendered("History",_.NS_SIDEBAR);const we=Ra(L,l);let ge;e[14]!==o?(ge=o!=null&&o.kind==="conversation"&&o.gizmoId!=null&&Ot(o.gizmoId),e[14]=o,e[15]=ge):ge=e[15];const P=ge,q=h.useRef(0),ke=j||y||F;let X;e[16]!==P?(X=z=>{z.preventDefault(),P&&f(!0)},e[16]=P,e[17]=X):X=e[17];let K;e[18]!==P||e[19]!==o||e[20]!==x?(K=z=>{z.preventDefault(),P&&(q.current=0,f(!1),x({newGizmoId:null,conversation:o.conversation,previousGizmoId:o.gizmoId??null}))},e[18]=P,e[19]=o,e[20]=x,e[21]=K):K=e[21];let Y,J;e[22]!==P?(Y=z=>{z.preventDefault(),P&&(q.current=q.current+1)},J=z=>{z.preventDefault(),P&&(q.current=q.current-1,q.current===0&&f(!1))},e[22]=P,e[23]=Y,e[24]=J):(Y=e[23],J=e[24]);const Ie=u&&"opacity-50";let Z;e[25]!==Ie?(Z=E(Ie),e[25]=Ie,e[26]=Z):Z=e[26];let ee;e[27]!==F||e[28]!==j?(ee=F&&j&&t.jsx(W,{children:t.jsx(De,{className:"m-auto"})}),e[27]=F,e[28]=j,e[29]=ee):ee=e[29];let te;e[30]!==r||e[31]!==F||e[32]!==y||e[33]!==i?(te=F&&y&&t.jsxs("div",{className:"text-token-text-tertiary p-3 text-center italic",children:[t.jsx(w,{...He.unableToLoadHistory}),!r&&t.jsx("div",{className:"mt-1",children:t.jsx(ie,{as:"button",color:"primary",size:"small",className:"m-auto mt-2",onClick:()=>{c(!0),Lt(i)},children:t.jsx(w,{...He.retryButton})})})]}),e[30]=r,e[31]=F,e[32]=y,e[33]=i,e[34]=te):te=e[34];let se;e[35]!==a||e[36]!==we||e[37]!==p||e[38]!==n||e[39]!==T||e[40]!==F||e[41]!==j||e[42]!==L?(se=!j&&!F&&t.jsx("div",{children:t.jsx(Ba,{activeId:a,bucketedItems:we,hasNextPage:p,items:L,infiniteScrollTriggerElementRef:T,hideOverflowMenu:n})}),e[35]=a,e[36]=we,e[37]=p,e[38]=n,e[39]=T,e[40]=F,e[41]=j,e[42]=L,e[43]=se):se=e[43];let ae;e[44]!==N?(ae=N&&t.jsx("div",{className:"m-4 mb-5 flex justify-center",children:t.jsx(De,{})}),e[44]=N,e[45]=ae):ae=e[45];let pe;return e[46]!==ke||e[47]!==X||e[48]!==K||e[49]!==Y||e[50]!==J||e[51]!==Z||e[52]!==ee||e[53]!==te||e[54]!==se||e[55]!==ae?(pe=t.jsxs(Va,{id:"history",$centered:ke,onDragOver:X,onDrop:K,onDragEnter:Y,onDragLeave:J,className:Z,children:[ee,te,se,ae]}),e[46]=ke,e[47]=X,e[48]=K,e[49]=Y,e[50]=J,e[51]=Z,e[52]=ee,e[53]=te,e[54]=se,e[55]=ae,e[56]=pe):pe=e[56],pe}const $a=ue.memo(Wa),Va=ca.div`flex flex-col gap-2 text-token-text-primary text-sm mt-5 first:mt-0
${({$centered:s})=>[s&&"h-full justify-center items-center empty:hidden"]}`;function Re(){return(Da()?"âŒ˜":"Ctrl")+" K"}function Qa({children:s,className:e}){return _.markStart("FannyPackSearchTooltip",_.NS_SIDEBAR),_.markRendered("FannyPackSearchTooltip",_.NS_SIDEBAR),t.jsx(V,{className:e,label:t.jsx(Pt,{children:t.jsx(w,{id:"jmd8WH",defaultMessage:"Search chats"}),keyboardShortcut:Re()}),children:s})}function qa({className:s}){return h.useEffect(()=>{ft.addAction("fannypack.web.action_seen"),fe(()=>import("./nsfzley2ztevyijw.js").then(e=>e.d),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))},[]),t.jsx(Qa,{className:E("flex",s),children:t.jsx(Te,{"aria-label":Re(),onClick:()=>{fe(()=>import("./nsfzley2ztevyijw.js").then(e=>e.d),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12])).then(e=>e.openFannyPackSearch())},icon:Ee})})}function Xa({isNewConversation:s}){const e=B(),a=xe(),{data:n}=ua(a?.id),i=a?.isEnterprisey()?n?.beta_settings.wham_access??!1:!0,r=Rt(),{value:c}=ma("2113934735"),l=a?.isQuorum(),m=Oe(e);return _.markStart("OperatorSidebarListItem",_.NS_SIDEBAR),c?c&&_.markRendered("OperatorSidebarListItem",_.NS_SIDEBAR):_.cancelRender("OperatorSidebarListItem",_.NS_SIDEBAR),t.jsxs(t.Fragment,{children:[!m&&t.jsx(Ka,{account:a,isNewConversation:s}),!l&&t.jsxs(t.Fragment,{children:[null,i?t.jsx(Bt,{}):null,c?t.jsx(At,{}):null,r?t.jsx(Dt,{}):null,null]})]})}const Ka=({account:s,isNewConversation:e})=>{const a=B(),n=qe(),i=G();let r;return s==null?null:(r=Ze,t.jsx("div",{className:"bg-token-bg-elevated-secondary pt-0",children:t.jsx(V,{side:"right",label:i.formatMessage(Je.newChat),className:"flex w-full items-center",children:t.jsx(ve,{className:"group w-full duration-100 not-only-of-type:flex-1 active:scale-[0.98] motion-safe:transition-transform",loggingGizmoId:"primary",href:"/",onClick:c=>{!xt(a)&&!e?(c.preventDefault(),Ye(n)):mt.publish({kind:"newChatRequested"})},icon:t.jsx(Nt,{isFirstParty:!0,className:"h-6 w-6","aria-label":""}),isMenuOpen:!1,label:r,hoverRightIcon:null})})}))};function Ya({gizmoResource:s,serverThreadId:e,isOnProjectPage:a,conversations:n,hasNextPage:i=!1}){const r=B(),c=n??[],l=c.findIndex(u=>u.id===e),m=c.slice(0,je);l!=null&&l>=je&&(m[je-1]=c[l]);const d=i||c.length>je;return t.jsxs("div",{className:"screen-arch:gap-0.5 flex flex-col",children:[m.map(u=>t.jsx(Aa,{className:"ms-7 ps-1",item:u,isActive:u.id===e},u.id)),d&&!a&&t.jsx(Tt,{to:et(r,s),className:"group tracking-condensed text-token-text-primary hover:bg-token-sidebar-surface-secondary ms-7 flex h-9 items-center gap-2.5 rounded-lg ps-3 pe-2 text-sm",children:t.jsx("span",{className:"text-start",children:t.jsx(w,{...me.seeAllChats})})})]})}const Ja=fa(()=>fe(()=>import("./ks210hfj07ihanwi.js"),__vite__mapDeps([13,3,2,4,14])).then(s=>s.SnorlaxFolderAnimation),{loading:({color:s})=>t.jsx(wt,{color:s})}),Za={open:{opacity:1,y:0,transition:{duration:.15,ease:"easeOut"}},closed:{opacity:0,y:-5,transition:{duration:.15,ease:"easeIn"}}};function en({color:s,folderState:e,gizmoId:a,sidebarSnorlaxFolderStore:n}){const i=G(),[r,c]=h.useState(!1);return t.jsx(V,{side:"top",delayDuration:600,label:e==="open"?i.formatMessage(me.hideChatsForProjectTooltip):i.formatMessage(me.showChatsForProjectTooltip),children:t.jsx("button",{onClick:l=>{l.preventDefault(),e==="open"?n.collapseProject(a):n.expandProject(a)},className:"text-token-text-secondary hover:bg-token-sidebar-surface-tertiary -m-0.5 flex rounded-xl p-0.5",onMouseEnter:()=>{c(!0)},onMouseLeave:()=>{c(!1)},children:t.jsx("div",{className:"h-6 w-6",children:t.jsx("div",{className:"text-token-text-primary relative flex h-full items-center justify-center",children:t.jsx(Ja,{isOpen:e==="open",isHovered:r,color:s})})})})})}function wt({color:s}){return t.jsx("div",{className:"text-token-text-primary flex h-6 w-6 shrink-0 items-center justify-center",children:t.jsx(Gt,{className:"h-3/4 w-3/4",style:{color:s}})})}function Ne({gizmo:s,historyDisabled:e,section:a,onClick:n,isActive:i,hideOverflowMenu:r=!1,elementRef:c}){const l=B(),{clientThreadId:m}=Ga(),d=ht(m),u=G(),[f,o]=h.useState(!1),x=s.gizmo.id,g=Ce.useStore(),v=Ce.useState(M=>Ce.selectFolderState(M,x)),p=xa(),S=!!s.gizmo.tags?.includes(Ht.FirstParty),j=Xe(),N=Ke(),{items:y=[],hasNextPage:k}=Ut(s.gizmo.id),C=Wt(x),b=$t(s);let T=!1;i&&C&&!(v==="open"&&d)&&(T=!0),h.useEffect(()=>{v!=="open"&&i&&d&&g.expandProject(x)},[i,d,g,x]);let I;if(s!=null)I=s.gizmo.display.name||Vt;else{if(p==null)return null;e?I=u.formatMessage(Je.clearChat):I=Ze}const O=j!=null&&j.kind==="conversation"&&(j.gizmoId==null||j.gizmoId!=x);return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"relative z-0 focus-within:z-20",onDrop:M=>{M.preventDefault(),O&&N({newGizmoId:x,conversation:j.conversation,previousGizmoId:j.gizmoId??null})},onDragOver:M=>{M.preventDefault()},children:t.jsx(ve,{loggingGizmoId:s?.gizmo.id??"primary",href:et(l,s),onClick:n,showActiveIndicator:T,icon:C&&y.length>0?t.jsx(en,{color:b,folderState:v,gizmoId:x,sidebarSnorlaxFolderStore:g}):C?t.jsx(wt,{color:b}):t.jsx(Nt,{isFirstParty:S,src:s?.gizmo.display.profile_picture_url,className:"h-6 w-6 shrink-0"}),isMenuOpen:f,label:I,rightIcon:a===de.Workspace&&t.jsx(V,{side:"right",label:u.formatMessage(Ue.workspaceRecommended,{workspace_name:p?.name??"Your Workspace"}),children:t.jsx(Xt,{className:"icon-md text-token-text-secondary",alt:u.formatMessage(Ue.workspaceRecommended,{workspace_name:p?.name??"Your Workspace"})})}),hoverRightIcon:t.jsx("div",{className:"flex gap-2",children:!r&&(C?t.jsx("div",{className:E("text-token-text-tertiary can-hover:opacity-0 group-focus-within:opacity-100 group-hover:opacity-100 group-focus:opacity-100 focus-within:opacity-100",f&&"opacity-100!"),onClick:M=>{M.preventDefault()},children:t.jsx(Qt,{gizmo:s,isOpen:f,setIsOpen:o})}):t.jsx("div",{className:E("text-token-text-tertiary can-hover:opacity-0 group-focus-within:opacity-100 group-hover:opacity-100 group-focus:opacity-100 focus-within:opacity-100",f&&"opacity-100!"),onClick:M=>{M.preventDefault()},children:t.jsx(qt,{gizmo:s,isOpen:f,setIsOpen:o,section:a})}))}),elementRef:c})}),t.jsx(ne,{initial:!1,children:C&&v==="open"&&y.length>0&&t.jsx(D.div,{initial:"closed",animate:"open",exit:"closed",variants:Za,className:"overflow-hidden",children:t.jsx(Ya,{gizmoResource:s,serverThreadId:d,isOnProjectPage:T,conversations:y,hasNextPage:k})},"nested-conversations")})]})}const Ue=Me({workspaceRecommended:{id:"gizmo.workspaceRecommended",defaultMessage:"Recommended at {workspace_name}"}}),tn=2;function sn({gizmos:s,maxToShowOnLoad:e=4,showAllSidebarItems:a}){const n=Yt(s,o=>o.flair.kind),i=[...(n[be.Workspace]?.map(({resource:o})=>({gizmo:o,section:de.Workspace}))??[]).slice(0,3),...n[be.FirstParty]?.map(({resource:o})=>({gizmo:o,section:de.Keep}))??[],...n[be.SidebarKeep]?.map(({resource:o})=>({gizmo:o,section:de.Keep}))??[]],r=n[be.Recent]??[],l=(a?r:r.slice(0,tn)).map(({resource:o})=>({gizmo:o,section:de.Recents})),m=i.length;let d=[];d=[...i,...l],a||(d.length>e&&m>e?d=d.slice(0,m):d.length>e&&(d=d.slice(0,e)));const f=s.length>d.length;return{listItems:d,itemsLeft:s.length-d.length,needsToCollapseItems:f,total:s.length}}function an(s){"use forget";const e=R.c(19),{gizmo:a,currentGizmoId:n,maxToShowOnLoad:i,hideOverflowMenu:r}=s,c=r===void 0?!1:r,l=ye(nn);let m,d,u;if(e[0]!==n||e[1]!==a||e[2]!==c||e[3]!==i||e[4]!==l){const{listItems:g,needsToCollapseItems:v,itemsLeft:p}=sn({gizmos:a,maxToShowOnLoad:i,showAllSidebarItems:l});d=v,m=p;let S;e[8]!==n||e[9]!==c?(S=function(y,k){return t.jsx(Ne,{gizmo:y,isActive:y.gizmo.id===n,section:k,hideOverflowMenu:c},y.gizmo.id)},e[8]=n,e[9]=c,e[10]=S):S=e[10];const j=S;u=g.map((N,y)=>{const{gizmo:k,section:C}=N;return t.jsxs(h.Fragment,{children:[y>1&&C!==g[y-1].section&&t.jsx("div",{className:"bg-token-border-default my-2 ms-2 h-px w-7"}),j(k,C)]},y)}),e[0]=n,e[1]=a,e[2]=c,e[3]=i,e[4]=l,e[5]=m,e[6]=d,e[7]=u}else m=e[5],d=e[6],u=e[7];let f;e[11]!==m||e[12]!==d||e[13]!==l?(f=d?t.jsxs("button",{onClick:Q.toggleGptListCollapsed,className:"text-token-text-primary hover:bg-token-sidebar-surface-secondary flex h-10 w-full items-center gap-2 rounded-lg px-2 text-sm",children:[t.jsx("div",{className:"flex h-6 w-6 shrink-0 items-center justify-center",children:t.jsx(tt,{className:"icon-md text-token-text-primary"})}),t.jsx("div",{className:"flex grow items-center gap-1",children:l?t.jsxs(t.Fragment,{children:[t.jsx(w,{id:"GizmoSidebarList.showLess",defaultMessage:"See less"}),t.jsx(Jt,{className:"icon-xs"})]}):t.jsxs(t.Fragment,{children:[t.jsx(w,{id:"GizmoSidebarList.showMoreItems",defaultMessage:"{numMore} more",values:{numMore:m}}),t.jsx(Zt,{className:"icon-xs"})]})})]}):null,e[11]=m,e[12]=d,e[13]=l,e[14]=f):f=e[14];let o;e[15]===Symbol.for("react.memo_cache_sentinel")?(o=t.jsx(es,{}),e[15]=o):o=e[15];let x;return e[16]!==u||e[17]!==f?(x=t.jsxs(t.Fragment,{children:[u,f,o]}),e[16]=u,e[17]=f,e[18]=x):x=e[18],x}function nn(s){return!Kt.isGptListCollapsed(s)}function We(){"use forget";const s=R.c(1);if(!xe())return null;let a;return s[0]===Symbol.for("react.memo_cache_sentinel")?(a=t.jsx(cn,{}),s[0]=a):a=s[0],a}function rn(s){"use forget";const e=R.c(2),{currentGizmoId:a}=s;if(!xe())return null;let i;return e[0]!==a?(i=t.jsx(on,{currentGizmoId:a}),e[0]=a,e[1]=i):i=e[1],i}function on(s){"use forget";const e=R.c(13),{currentGizmoId:a}=s,n=B();let i;e[0]!==n?(i=gt(n,"2152104812").get("hide_gpts_if_none",!1),e[0]=n,e[1]=i):i=e[1];const r=i,c=st(),{data:l}=ts();let m;e[2]!==l?(m=l===void 0?{}:l,e[2]=l,e[3]=m):m=e[3];const{gizmos:d}=m;let u;e[4]!==d?(u=d??[],e[4]=d,e[5]=u):u=e[5];let f=u;if(c){let x;e[6]!==f?(x=f.filter(ln)??[],e[6]=f,e[7]=x):x=e[7],f=x}let o;return e[8]!==a||e[9]!==f||e[10]!==d?.length||e[11]!==r?(o=(!r||d?.length!==0)&&t.jsx(an,{gizmo:f,currentGizmoId:a,maxToShowOnLoad:7}),e[8]=a,e[9]=f,e[10]=d?.length,e[11]=r,e[12]=o):o=e[12],o}function ln(s){return!ss(s.resource)}function cn(){"use forget";const s=R.c(4),e=B();let a;s[0]!==e?(a=gt(e,"2152104812").get("hide_default_gpts",!1),s[0]=e,s[1]=a):a=s[1];const n=a;let i;return s[2]!==n?(i=!n&&t.jsx(Xa,{isNewConversation:!0}),s[2]=n,s[3]=i):i=s[3],i}const dn=({onNewThread:s})=>t.jsxs(t.Fragment,{children:[t.jsx(mn,{onNewThread:s}),t.jsx(fn,{}),t.jsx(at,{}),t.jsx(un,{})]}),un=()=>t.jsx("div",{className:"h-8"}),mn=({onNewThread:s})=>{const e=G(),a=n=>{Q.setPopoverSidebarOpen(!1),n.metaKey||n.ctrlKey?re.logEventWithStatsig("New Chat Opened In New Tab","chatgpt_new_chat_opened_in_new_tab"):(n.preventDefault(),s())};return t.jsx(ve,{loggingGizmoId:"primary",testId:"create-new-chat-button",href:"/",onClick:a,icon:t.jsx(as,{className:"icon-md","aria-label":""}),isMenuOpen:!1,label:e.formatMessage({id:"6Abeg/",defaultMessage:"New chat"}),hoverRightIcon:null})},fn=()=>{const s=G(),{isFannyPackEnabled:e}=nt();return h.useEffect(()=>{e&&(ft.addAction("fannypack.web.action_seen"),fe(()=>import("./nsfzley2ztevyijw.js").then(a=>a.d),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12])))},[e]),e?t.jsx(ve,{href:"#",onClick:a=>{a.preventDefault(),Q.setPopoverSidebarOpen(!1),fe(()=>import("./nsfzley2ztevyijw.js").then(n=>n.d),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12])).then(n=>n.openFannyPackSearch())},icon:t.jsx(Ee,{className:"icon-md","aria-label":""}),isMenuOpen:!1,label:s.formatMessage({id:"bDEsvT",defaultMessage:"Search chats"}),hoverRightIcon:t.jsx("div",{className:"text-token-text-tertiary pe-1 not-group-hover:not-group-focus-visible:hidden",children:Re()})}):null};function xn({currentGizmoId:s,onClick:e}){const{isSidebarFlyoutOpen:a,onSidebarFlyoutOpenChange:n}=ns(),i=a(Se.Snorlax);return t.jsx("div",{className:"group flex w-full items-center justify-start",children:t.jsx(is,{onOpenChange:r=>n(Se.Snorlax,r),side:"right",sideOffset:4,open:i,contentAlign:"end",triggerButton:t.jsxs("button",{className:E("tracking-condensed text-token-text-secondary hover:bg-token-sidebar-surface-secondary screen-arch:py-[7px] screen-arch:text-body can-hover:hover:screen-arch:bg-token-main-surface-secondary flex flex-1 items-center gap-2.5 rounded-lg px-2 py-1.5 text-sm ease-[var(--spring-bounce)] select-none focus:ring-0 motion-safe:active:scale-[98%] motion-safe:active:transition-transform",i&&"bg-token-main-surface-secondary"),onClick:e,children:[t.jsx("div",{className:"h-6 w-6",children:t.jsx("div",{className:"text-token-text-primary relative flex h-full items-center justify-center",children:t.jsx(tt,{className:"icon-md text-token-sidebar-icon font-semibold"})})}),t.jsx("span",{className:"text-start",children:t.jsx(w,{...me.seeMoreProjectItems})})]}),size:"auto",children:t.jsx("div",{className:"max-h-[50dvh] w-80 overflow-x-auto px-2 [scrollbar-gutter:stable]",children:t.jsx(W,{children:t.jsx(rs,{currentGizmoId:s,inSidebarFlyout:!0,customListItem:Ne})})})})})}function hn({snorlaxes:s,currentGizmoId:e}){return t.jsx(t.Fragment,{children:s.map(a=>t.jsx(Ne,{gizmo:a.gizmo,isActive:a.gizmo.gizmo.id===e},a.gizmo.gizmo.id))})}function gn({currentGizmoId:s,includeRevisedSidebarIa:e}){const a=G(),{snorlaxes:n,data:i,isLoading:r,isError:c,refetch:l,hasNextPage:m}=os(),d=n.slice(0,_e),u=h.useRef(!1),[f,o]=h.useState(!0),x=h.useCallback(function(k){k&&o(!1),l()},[l,o]),g=(n??[]).length===0,v=c||i===void 0&&!r&&u.current;_.markStart("SnorlaxSidebarList",_.NS_SIDEBAR),i!=null&&!r&&_.markRendered("SnorlaxSidebarList",_.NS_SIDEBAR),i===void 0&&!r&&!u.current&&(u.current=!0,x(!1));const S=n?.find(y=>y.gizmo.gizmo.id===s),j=d.some(y=>y.gizmo.gizmo.id===s),N=n&&(n?.length>(!s||j?_e:_e+1)||m);return t.jsxs(t.Fragment,{children:[v&&t.jsx(ls,{showRetry:f,refetch:x}),!v&&t.jsx(cs,{id:"snorlax-heading",condensed:e,header:t.jsxs(W,{children:[a.formatMessage(me.projectsHeading),!g&&t.jsx(us,{})]}),isLastInGroup:!0,ulClassName:"screen-arch:mb-3",children:!r&&t.jsxs(t.Fragment,{children:[t.jsx(hn,{snorlaxes:d,currentGizmoId:s}),S&&!j&&t.jsx(Ne,{gizmo:S.gizmo,isActive:!0}),N&&t.jsx(xn,{currentGizmoId:s}),!r&&g&&t.jsx(ds,{})]})})]})}function pn(s){"use forget";const e=R.c(13),{clientThreadId:a,onNewThread:n}=s,i=ht(a),r=pt(a),c=pa(),l=st(),[m,d]=h.useState(!1);let u;e[0]!==m?(u=j=>j===Se.Snorlax?m:!1,e[0]=m,e[1]=u):u=e[1];const f=u;let o;e[2]===Symbol.for("react.memo_cache_sentinel")?(o=(j,N)=>{j===Se.Snorlax&&d(N)},e[2]=o):o=e[2];const x=o;let g;e[3]!==f?(g={isSidebarFlyoutOpen:f,onSidebarFlyoutOpenChange:x},e[3]=f,e[4]=g):g=e[4];const v=c?void 0:i;let p;e[5]!==r||e[6]!==l||e[7]!==n||e[8]!==v?(p=t.jsx("div",{id:"sidebar",className:"group/sidebar",children:t.jsx(jn,{currentGizmoId:r,activeId:v,isSnorlaxEnabled:l,onNewThread:n})}),e[5]=r,e[6]=l,e[7]=n,e[8]=v,e[9]=p):p=e[9];let S;return e[10]!==g||e[11]!==p?(S=t.jsx(hs,{value:g,children:p}),e[10]=g,e[11]=p,e[12]=S):S=e[12],S}function jn(s){"use forget";const e=R.c(23),{currentGizmoId:a,activeId:n,isSnorlaxEnabled:i,onNewThread:r}=s,c=B();let l;e[0]!==c?(l=Oe(c),e[0]=c,e[1]=l):l=e[1];const m=l,d=xe();let u;e[2]!==d?(u=d?.isQuorum(),e[2]=d,e[3]=u):u=e[3];const f=u;let o;e[4]!==m||e[5]!==r?(o=m&&t.jsx(dn,{onNewThread:r}),e[4]=m,e[5]=r,e[6]=o):o=e[6];let x;e[7]!==m?(x=!m&&t.jsx(We,{}),e[7]=m,e[8]=x):x=e[8];let g;e[9]!==m?(g=!m&&t.jsx(at,{}),e[9]=m,e[10]=g):g=e[10];let v;e[11]===Symbol.for("react.memo_cache_sentinel")?(v=null,e[11]=v):v=e[11];let p;e[12]!==n||e[13]!==a||e[14]!==f||e[15]!==i||e[16]!==m?(p=t.jsx(W,{fallback:null,children:t.jsx(gs,{fallback:null,simulateOnce:!1,children:j=>{const{didSuspend:N}=j;return t.jsxs("div",{className:E(N&&ps.revealDown),id:"late-load-sidebar-items",children:[t.jsx(ja,{name:"GizmoSidebarList",children:t.jsx(rn,{currentGizmoId:a})}),m&&t.jsx(We,{}),!f&&i&&t.jsx(gn,{currentGizmoId:a}),null,t.jsx($a,{activeId:n})]})}})}),e[12]=n,e[13]=a,e[14]=f,e[15]=i,e[16]=m,e[17]=p):p=e[17];let S;return e[18]!==o||e[19]!==x||e[20]!==g||e[21]!==p?(S=t.jsxs(t.Fragment,{children:[o,x,g,v,p]}),e[18]=o,e[19]=x,e[20]=g,e[21]=p,e[22]=S):S=e[22],S}function li(s){"use forget";const e=R.c(4),{clientThreadId:a,onNewThread:n}=s,i=B();let r;return e[0]!==a||e[1]!==i||e[2]!==n?(r=xt(i)?t.jsx(pn,{clientThreadId:a,onNewThread:n}):null,e[0]=a,e[1]=i,e[2]=n,e[3]=r):r=e[3],r}function bn(s){"use forget";const e=R.c(37),{className:a,onNewThread:n}=s,i=B(),r=Oe(i),c=G(),l=ha(vn),{isFannyPackEnabled:m}=nt(),d=yt(fs,ms,!0,!0),u=Fa();let f;e[0]!==c?(f=c.formatMessage({id:"Q6nsOM",defaultMessage:"Close sidebar"}),e[0]=c,e[1]=f):f=e[1];const o=f,x=V,g=Te,v=E("no-draggable",r&&"text-token-text-tertiary"),p=r?"icon-lg-heavy":void 0,S=r?xs:d,j=r?ga:it;let N;e[2]!==g||e[3]!==o||e[4]!==v||e[5]!==p||e[6]!==S||e[7]!==j?(N=t.jsx(g,{className:v,iconClassName:p,"aria-label":o,onClick:Sn,icon:S,mobileIcon:j,"data-testid":"close-sidebar-button"}),e[2]=g,e[3]=o,e[4]=v,e[5]=p,e[6]=S,e[7]=j,e[8]=N):N=e[8];let y;e[9]!==x||e[10]!==o||e[11]!==N?(y=t.jsx(x,{label:o,children:N}),e[9]=x,e[10]=o,e[11]=N,e[12]=y):y=e[12];const k=y,C=l?.visible&&l.getTitlebarAreaRect().left>0?"justify-end":"justify-between";let b;e[13]!==a||e[14]!==C?(b=E("flex",C,a),e[13]=a,e[14]=C,e[15]=b):b=e[15];let T;e[16]!==r||e[17]!==n||e[18]!==k?(T=r?t.jsx(yn,{onNewThread:n}):k,e[16]=r,e[17]=n,e[18]=k,e[19]=T):T=e[19];let I;e[20]!==u?(I=u&&t.jsx(Pa,{}),e[20]=u,e[21]=I):I=e[21];let O;e[22]!==m||e[23]!==r?(O=!r&&m&&t.jsx(qa,{}),e[22]=m,e[23]=r,e[24]=O):O=e[24];let M;e[25]!==r||e[26]!==n?(M=!r&&t.jsx(Pe,{onClick:n,testId:"create-new-chat-button"}),e[25]=r,e[26]=n,e[27]=M):M=e[27];const H=r&&k;let L;e[28]!==I||e[29]!==O||e[30]!==M||e[31]!==H?(L=t.jsxs("div",{className:"flex",children:[I,O,M,H]}),e[28]=I,e[29]=O,e[30]=M,e[31]=H,e[32]=L):L=e[32];let A;return e[33]!==T||e[34]!==L||e[35]!==b?(A=t.jsxs("div",{id:"sidebar-header",className:b,children:[T,L]}),e[33]=T,e[34]=L,e[35]=b,e[36]=A):A=e[36],A}function Sn(){Q.setSidebarOpen(!1)}function vn(){return navigator.windowControlsOverlay}function yn({onNewThread:s,testId:e}){const a=()=>{Q.setPopoverSidebarOpen(!1),s()};return t.jsx(Te,{onClick:a,icon:js,"aria-label":"","data-testid":e,as:"link"})}const Nn=()=>{const s=qe();return t.jsxs("div",{className:"flex h-full flex-col gap-2 p-3",children:[t.jsx(bn,{className:"h-header-height flex items-center",onNewThread:()=>{Ye(s)}}),t.jsx(wn,{}),t.jsx("div",{className:"flex items-center justify-center",children:t.jsx(bs,{})})]})},kt="border border-token-border-xlight bg-token-sidebar-surface-secondary";function U({className:s,width:e}){return t.jsx("div",{className:E("h-2.5 grow rounded-sm",kt,s),style:{maxWidth:e+"px"}})}function wn(){const s=t.jsx("div",{className:E("h-4 w-4 shrink-0 grow-0 rounded-full",kt)});return t.jsxs("div",{className:"mt-2 flex w-full grow flex-col gap-4 overflow-hidden px-2",style:{maskImage:"linear-gradient(to bottom, black 50%, transparent 100%)",WebkitMaskImage:"linear-gradient(to bottom, black 50%, transparent 100%)"},children:[t.jsxs("div",{className:"flex flex-row items-center justify-start gap-3",children:[s,t.jsx(U,{width:80})]}),t.jsxs("div",{className:"flex flex-row items-center justify-start gap-3",children:[s,t.jsx(U,{width:120})]}),t.jsxs("div",{className:"flex flex-row items-center justify-start gap-3",children:[s,t.jsx(U,{width:100})]}),t.jsx("div",{className:"mt-5 flex flex-row items-center justify-start gap-3",children:t.jsx(U,{width:150})}),t.jsxs("div",{className:"flex flex-row items-center justify-start gap-3",children:[s,t.jsx(U,{width:50})]}),t.jsxs("div",{className:"flex flex-row items-center justify-start gap-3",children:[s,t.jsx(U,{width:100})]}),t.jsxs("div",{className:"mb-5 flex flex-row items-center justify-start gap-3",children:[s,t.jsx(U,{width:80})]}),[120,180,160,100,90,190,140,120,180,170,100,120,180,150].map((e,a)=>t.jsx("div",{className:"flex flex-row items-center justify-start py-1",children:t.jsx(U,{width:e})},a))]})}function ci({onClick:s,className:e,...a}){return t.jsx(ws,{onClick:s,className:E(e,"grow overflow-hidden"),...a})}function di({onNewChatButtonClick:s}){const{isUnauthenticated:e,isLoading:a}=ze();return a||!e?null:t.jsx(Pe,{className:"me-3",onClick:()=>{re.logNewChatButtonClicked({location:"Mobile header"}),s()}})}function ui({onNewChatButtonClick:s,clientThreadId:e}){const{isUnauthenticated:a,isLoading:n}=ze(),i=vs(),r=pt(e),c=Fe(e,jt.getIsNewConversation),l=Ia(),m=c&&l&&!a&&!r;if(n)return null;if(a)return i?t.jsx(In,{}):t.jsx(kn,{});const d=t.jsx(Pe,{onClick:()=>{re.logNewChatButtonClicked({location:"Mobile header"}),s()}});return m?t.jsx(ys,{layout:"compact",clientThreadId:e}):d}function kn(){const s=rt(),e=Ns(Be.signUpButtonText);return t.jsx(ie,{as:"button",size:"small",color:"primary",onClick:()=>{s({authType:"signup",callback:a=>{re.logSignUpButtonClicked({location:"Mobile Chat Stage Header",provider:a})}})},children:t.jsx(w,{...e})})}function In(){const s=rt();return t.jsx(ie,{as:"button",size:"small",color:"primary",onClick:()=>{s({authType:"login",callback:e=>{re.logLogInButtonClicked({location:"Mobile Chat Stage Header",provider:e})}})},"data-testid":"mobile-login-button",children:t.jsx(w,{...Ca.logInButtonText})})}function Cn({onClick:s}){const e=yt(Ss,it,!0,!0);return t.jsxs("button",{type:"button",className:"hover:text-token-text-primary inline-flex rounded-md focus:ring-2 focus:ring-white focus:outline-hidden focus:ring-inset active:opacity-50",onClick:s,"data-testid":"open-sidebar-button",children:[t.jsx("span",{className:"sr-only",children:t.jsx(w,{...Be.openSidebar})}),t.jsx(e,{className:"icon-lg text-token-text-secondary mx-2"})]})}const _n=({rightContentExpanded:s,onOpenSidebar:e,children:a,showNavSidebar:n,leftContent:i,rightContent:r,bottomContent:c})=>{const l=ye(m=>m.isConversationScrolledFromTop);return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:E("draggable h-header-height bg-token-main-surface-primary sticky top-0 z-10 flex items-center justify-center border-transparent ps-0 md:hidden",l?"[box-shadow:var(--sharp-edge-top-shadow)]":"[box-shadow:var(--sharp-edge-top-shadow-placeholder)]"),children:[(n||i)&&t.jsxs("div",{className:"no-draggable absolute start-0 top-0 bottom-0 ms-3 inline-flex items-center justify-center",children:[n&&t.jsx(Cn,{onClick:e}),i]}),t.jsx("div",{className:"no-draggable",children:a}),r&&t.jsx("div",{className:E("no-draggable absolute end-0 top-0 bottom-0 me-3 inline-flex items-center justify-center",s&&"start-10"),children:r})]}),c&&t.jsx("div",{className:"no-draggable bg-token-main-surface-primary flex w-full items-center justify-center md:hidden",children:c})]})};function Mn({isPopover:s=!1,children:e}){return _.markStart("StageNavigationSidebar"),_.markRendered("StageNavigationSidebar"),s?t.jsx(En,{children:e}):t.jsx(Tn,{children:e})}const It={type:"spring",bounce:.12,duration:.64},$e={...It,duration:.4},Tn=({style:s,children:e})=>(_.trackNamespace(_.NS_SIDEBAR),t.jsx(D.div,{className:E("bg-token-sidebar-surface-primary z-21 shrink-0 overflow-x-hidden [view-transition-name:var(--sidebar-slideover)]"),initial:{width:0},transition:It,animate:{width:260},exit:{width:0},style:s,children:t.jsx("div",{className:"h-full w-[var(--sidebar-width)]",children:t.jsx("div",{className:"flex h-full min-h-0 flex-col",children:e})})})),En=({children:s})=>{const e=ye(a=>a.isPopoverSidebarOpen);return t.jsx(ba,{open:e,onOpenChange:a=>{Q.setPopoverSidebarOpen(a)},children:t.jsx(Sa,{forceMount:!0,children:t.jsxs(ne,{children:[e&&t.jsx(va,{asChild:!0,children:t.jsx(D.div,{className:"fixed inset-0 z-10 bg-gray-50/50 dark:bg-black/50",transition:$e,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,transition:{duration:.12}}})}),e&&t.jsx(ya,{asChild:!0,onOpenAutoFocus:a=>{a.preventDefault()},children:t.jsxs(D.div,{className:"bg-token-sidebar-surface-primary top-banner-visible:bottom-0 top-banner-visible:top-(--top-banner-height,0px) top-banner-visible:h-auto fixed start-0 top-0 z-50 h-full w-[var(--sidebar-width)] max-w-xs border-e border-gray-200 shadow-[0_0_64px_0_rgba(0,0,0,0.07)] [view-transition-name:var(--sidebar-popover)] focus:outline-hidden dark:border-gray-800",transition:$e,initial:{translateX:"-100%"},animate:{translateX:"0"},exit:{translateX:"-100%",transition:{duration:.12}},children:[t.jsx(Na,{asChild:!0,children:t.jsxs(wa,{children:[t.jsx(w,{...Be.sidebarTitle}),t.jsx(ka,{})]})}),s]})})]})})})},Be=Me({sidebarTitle:{id:"navigation.sidebarTitle",defaultMessage:"Sidebar"},closeSidebar:{id:"navigation.closeSidebar",defaultMessage:"Close sidebar"},openSidebar:{id:"navigation.openSidebar",defaultMessage:"Open sidebar"},signUpButtonText:{id:"navigation.signUpButtonText",defaultMessage:"Sign up"}});function On({children:s}){return t.jsx("div",{className:"bg-token-main-surface-primary h-full w-full px-[22px] py-4",children:s})}function Ln(){return t.jsxs("div",{className:"flex w-full gap-2",children:[t.jsx("div",{className:"h-6 w-6",children:t.jsx(oe,{className:"h-full w-full rounded-full!"})}),t.jsxs("div",{className:"flex w-full flex-col gap-2",children:[t.jsx(oe,{}),t.jsx(oe,{}),t.jsx(oe,{}),t.jsx(oe,{})]})]})}function le({icon:s,message:e,iconClassName:a}){return t.jsx("div",{className:"loading-shimmer-pure-text flex h-8 gap-1 overflow-hidden",children:t.jsx(Le,{fillIcon:!1,icon:s,className:a,children:t.jsx("div",{className:"mt-[.5px] flex h-10",children:e})})})}const zn=({finalRow:s})=>{const e=G(),a=s.type==="fileOpen"?ks[s.iconType]??Is:null;return t.jsx(ne,{children:t.jsx(D.div,{layout:!0,transition:{type:"spring",stiffness:300,damping:30},className:"flex flex-col items-start justify-start gap-4",children:s.type==="search"?t.jsx(le,{icon:t.jsx(Ee,{className:"text-token-text-primary relative h-5 w-5 opacity-50"}),message:e.formatMessage({id:"f9wsyE",defaultMessage:"Searchingâ€¦"})}):s.type==="websiteOpen"?t.jsx(le,{icon:t.jsx(Cs,{className:"inline-flex h-5 w-5 items-center justify-center opacity-50"}),message:e.formatMessage({id:"8L6BBp",defaultMessage:"Readingâ€¦"})}):s.type==="fileOpen"?t.jsx(le,{icon:t.jsx(a,{className:"inline-flex h-5 w-5 items-center justify-center opacity-50"}),message:e.formatMessage({id:"h5M4/O",defaultMessage:"Reading fileâ€¦"})}):s.type==="pythonAnalysis"?t.jsx(le,{icon:t.jsx(_s,{className:"inline-flex h-5 w-5 items-center justify-center opacity-50"}),message:e.formatMessage({id:"jZ7gNw",defaultMessage:"Analyzingâ€¦"})}):t.jsx(le,{icon:t.jsx(bt,{className:"inline-flex h-5 w-5 items-center justify-center opacity-50"}),message:e.formatMessage({id:"bSPYmC",defaultMessage:"Thinkingâ€¦"})})})})};function ce({children:s}){return t.jsx(D.div,{className:"w-full",initial:{opacity:0},animate:{opacity:1},transition:{duration:1},children:s})}const Fn=({previousRow:s,currentRow:e})=>t.jsx("div",{className:"flex flex-col items-start justify-start gap-4",children:e.type==="search"?t.jsx(ce,{children:t.jsx(Ms,{row:e,showIcon:!s||s.type!=="search"})},`search_${e.id}`):e.type==="summary"?t.jsx(ce,{children:t.jsx(Ts,{row:e,showIcon:!s||s.type!=="summary"})},`summary_${e.id}`):e.type==="websiteOpen"?t.jsx(ce,{children:t.jsx(Es,{website:e})},`website_${e.id}`):e.type==="fileOpen"?t.jsx(ce,{children:t.jsx(Os,{row:e})},`file_${e.id}`):e.type==="pythonAnalysis"?t.jsx(ce,{children:t.jsx(Ls,{row:e})},`python_${e.id}`):null}),Pn=120,Rn=1e3*60*2;function Ve(s){s?.scrollIntoView({block:"center",behavior:"smooth"})}function Bn({caterpillarStatusMessageTexts:s}){return t.jsx("div",{className:"p-4",children:t.jsx(lt,{type:"error",title:s.failureMessage,content:s.failureBannerContentMessage})})}function An({caterpillarStatusMessageTexts:s}){return t.jsx("div",{className:"p-4",children:t.jsx(lt,{title:s.cancelledMessage,content:""})})}function Dn({interruptPrompt:s,setInterruptPrompt:e,handleInterruptCaterpillar:a}){const n=G();return t.jsxs("div",{className:"flex w-full flex-col justify-center gap-4 p-4",children:[t.jsx(Rs,{ariaLabel:n.formatMessage({id:"aYWRtV",defaultMessage:"Press enter to interrupt task"}),name:"interrupt-caterpillar-prompt",value:s,onChange:i=>e(i.target.value),color:"search",onPressEnter:a}),t.jsx(ie,{onClick:a,children:t.jsx(w,{id:"h73FdF",defaultMessage:"Interrupt task"})})]})}function Gn({sourcesCount:s,taskInfo:e}){const a=Fe(e.originalConversationId,i=>jt.findNode(i,r=>r.message.metadata?.b1de6e2_s===!0&&r.message.metadata?.async_task_id===e.taskId)?.message.metadata?.async_task_status_messages),n=h.useMemo(()=>a?.completed_no_time?t.jsxs(t.Fragment,{children:[a?.completed_with_time??a?.completed_no_time,t.jsx(w,{id:"zxfmo/",defaultMessage:" Â· {sourcesCount} sources",values:{sourcesCount:s}})]}):t.jsx(w,{id:"YG7a0T",defaultMessage:"Completed Â· {sourcesCount} sources",values:{sourcesCount:s}}),[s,a]);return!e.updatedAt&&!a?.completed?null:t.jsx(Le,{icon:t.jsx(Bs,{className:"text-token-text-secondary"}),fillIcon:!1,children:t.jsx("div",{className:"text-token-text-tertiary",children:n})})}function Hn({taskInfo:s,caterpillarStatusMessageTexts:e,sourcesCount:a,caterpillarHeaderRef:n}){const[i,r]=h.useState(""),[c,l]=h.useState(!1),m=_a("caterpillar-interrupts"),d=h.useRef(!1),u=h.useRef(null),f=h.useMemo(()=>(d.current=!!u.current&&zs(u.current,Pn),s.rows??[]),[s.rows]);h.useEffect(()=>{if(f.length===0){const p=new Date(s.createdAt).getTime(),S=Date.now()-p,j=Rn-S;if(j>0){const N=setTimeout(()=>{l(!0)},j);return()=>clearTimeout(N)}else l(!0)}else l(!1)},[f,s.createdAt]),h.useEffect(()=>{d.current&&Ve(u.current)},[f]),h.useEffect(()=>{Ae(s)||setTimeout(()=>{u.current&&Ve(u.current)},100)},[]);const o=Fs({taskId:s.taskId,prompt:i}),x=Ae(s)||Ps(s),g=h.useCallback(async()=>{await o.mutateAsync(),r("")},[o,r]),v=h.useMemo(()=>f.length?x?f:f.slice(0,f.length-1):f,[f,x]);return t.jsxs("div",{className:"flex flex-col",children:[t.jsx("div",{ref:n},"task-header"),t.jsxs("div",{className:"flex w-full flex-col gap-4",children:[t.jsx("div",{className:"text-base font-medium",children:s.title}),f.length?t.jsxs(ne,{initial:!1,children:[v.map((p,S)=>t.jsx(Fn,{previousRow:S>0?f[S-1]:null,currentRow:p},p.id)),!x&&t.jsx(zn,{finalRow:f[f.length-1]})]}):c?t.jsx(Le,{fillIcon:!1,icon:t.jsx(bt,{className:"text-token-text-primary inline-flex h-5 w-5 items-center justify-center"}),children:e.waitingInQueueMessage}):t.jsx(Ln,{}),ot(s)&&m&&t.jsx(Dn,{interruptPrompt:i,setInterruptPrompt:r,handleInterruptCaterpillar:g}),s.status==="failed"?t.jsx(Bn,{caterpillarStatusMessageTexts:e}):s.status==="cancelled"?t.jsx(An,{caterpillarStatusMessageTexts:e}):s.status==="completed"?t.jsx(Gn,{caterpillarStatusMessageTexts:e,taskInfo:s,sourcesCount:a}):null]}),t.jsx("div",{ref:u},"task-footer")]})}function Un({taskId:s,setWidth:e=void 0,initialTab:a}){const n=As(o=>Ds.getTask(s,o)),{closeThreadSidebar:i}=St(),[r,c]=h.useState(a),l=Gs(),m=h.useRef(null),d=!1;h.useEffect(()=>{c(a)},[a]),h.useEffect(()=>{},[n?.taskId,n?.status,d]),h.useEffect(()=>{},[n?.taskId,n?.status,r]),h.useEffect(()=>{},[e,n,d]);const{uniqueSources:u,totalSources:f}=h.useMemo(()=>{if(!n?.rows)return{uniqueSources:[],totalSources:0};const o=Hs(n.rows),x=o.reduce((g,v)=>g+v.count,0);return{uniqueSources:o,totalSources:x}},[n?.rows]);return t.jsx(ct,{handleClose:i,leading:t.jsx("div",{className:"flex w-full justify-center",children:t.jsx(Ws,{activeTab:r,setActiveTab:c,showAuxTab:d,sourcesCount:f,caterpillarHeaderRef:m})}),children:n&&t.jsxs(On,{children:[!1,r==="activity"&&t.jsx(Hn,{taskInfo:n,caterpillarStatusMessageTexts:l,sourcesCount:f,caterpillarHeaderRef:m}),r==="sources"&&t.jsx(Us,{taskIsPending:ot(n),finalMessage:n.finalMessage,sources:u,caterpillarHeaderRef:m})]})})}const Qe=3;function Wn({product:s,descriptionCitation:e,clientThreadId:a,messageId:n,contentReferenceStartIndex:i,productIndex:r,analyticsMetadata:c,offsetTopMargin:l=!1}){const m=B(),d=Ma(m,"3381490948"),[u,f]=h.useState(void 0),o=h.useRef([]),x=h.useRef([]),g=u?.product.offers??s.offers??[];for(const b of g)o.current.some(T=>T.merchant_name===b.merchant_name)||o.current.push(b);const v=u?.product.image_urls??s.image_urls??[];for(const b of v)x.current.includes(b)||x.current.push(b);const[p,S]=h.useState(!1);h.useEffect(()=>S(!1),[s]);const j=$s(c),N=Vs.useStore(),{numReviews:y,rating:k,ratingGroupedCitation:C}=h.useMemo(()=>{const b=u?.product??s;return{numReviews:b.num_reviews,rating:b.rating,ratingGroupedCitation:b.rating_grouped_citation}},[s,u]);return t.jsxs("div",{className:E("bg-token-bg-primary flex w-full flex-col",l?"mt-[calc(var(--threadFlyOut-leading-height,57px)*-1)] min-h-screen":"mt-0"),children:[t.jsx($n,{imageUrls:x.current,title:s.title,onImageClick:b=>{N.setCurrentImage({image:{url:b,content_url:b,thumbnail_url:b,title:s.title,content_size:{width:0,height:0},thumbnail_size:{width:0,height:0}},source:Qs.ProductDetails,analyticsMetadata:c,contentReferenceStartIndex:i,productIndex:r})}}),t.jsxs("div",{className:"border-token-border-light flex flex-col border-t px-6 py-4",children:[t.jsx("div",{className:"text-token-text-primary text-xl font-semibold",children:s.title}),y&&y>0&&t.jsxs("div",{className:"flex flex-col gap-1 pt-1",children:[t.jsxs("div",{className:"text-token-text-secondary flex flex-row items-center gap-1 text-sm text-nowrap text-ellipsis",children:[t.jsx(qs,{rating:k??0}),t.jsx(w,{id:"Tj10jZ",defaultMessage:"{rating} ({num_reviews})",values:{rating:(k??0).toFixed(1),num_reviews:new Intl.NumberFormat().format(y)}}),t.jsx(V,{label:t.jsx(w,{id:"zngDZ6",defaultMessage:"Ratings and pricing are sourced from third parties which may update over time"}),children:t.jsx(dt,{className:"h-4 w-4"})})]}),C&&t.jsx(Ge,{webpageItem:C,trackContentReferenceEvent:j,analyticsMetadata:{...c,section:"products",section_location:"sidebar"},isLastHovered:!0,noMarginStart:!0})]}),s.description&&t.jsxs("div",{className:"pt-3 text-sm",children:[s.description,e&&t.jsx(Ge,{webpageItem:e,trackContentReferenceEvent:j,analyticsMetadata:{section:"products",section_location:"sidebar"}})]})]}),t.jsx(Xs,{title:t.jsx(w,{id:"ITQW8G",defaultMessage:"Purchasing Options"}),children:t.jsxs("div",{className:"-mx-3 flex flex-col",children:[o.current.slice(0,p?o.current.length:Qe).map((b,T)=>t.jsx(D.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:t.jsx(Vn,{offer:b,onClick:()=>{re.logEventWithStatsig("Product Offer Clicked","product_offer_clicked",{...Ta(c),content_reference_start_index:i,product_index:r,offer_index:T,product_id:s.id,offer_url:b.url,checkout_url:b.checkout_url,offers_count:o.current.length}),window.open(b.checkout_url||b.url,"_blank")}},b.url)},b.url)),o.current.length>Qe&&t.jsxs(ie,{className:"w-fit px-3",size:"small",color:"ghost",onClick:()=>S(!p),children:[p?t.jsx(w,{id:"Gl3oLS",defaultMessage:"See less"}):t.jsx(w,{id:"f9tOaY",defaultMessage:"See more"}),p?t.jsx(Ks,{}):t.jsx(Ys,{})]})]})}),d&&t.jsx(Ha,{clientThreadId:a,messageId:n,product:s,trackContentReferenceEvent:j,onProductEntityUpdated:b=>{f(b)}})]})}function $n({imageUrls:s,title:e,onImageClick:a}){const[n,i]=h.useState(0),r=h.useRef(null);return s?t.jsxs("div",{className:"flex flex-col",children:[s[n]&&t.jsx(D.div,{className:"bg-token-main-surface-secondary dark:bg-token-main-surface-primary-inverse",drag:"x",dragConstraints:{left:0,right:0},dragElastic:0,onDragEnd:(c,{offset:l,velocity:m})=>{const d=Math.abs(l.x)*m.x;d<-1e3?n<s.length-1&&i(n+1):d>1e3&&n>0&&i(n-1)},onClick:()=>a(s[n]),children:t.jsx("img",{className:"m-0 aspect-square w-full object-contain mix-blend-darken",src:s[n],alt:e,draggable:!1})}),s.length>1&&t.jsx("div",{ref:r,className:"no-scrollbar flex flex-row gap-2.5 overflow-x-scroll px-6 py-3",children:s.map((c,l)=>t.jsx("div",{className:E("flex-none cursor-pointer overflow-hidden rounded-md border-2 p-0.5",n===l?"border-token-text-primary":"border-transparent"),onMouseEnter:()=>i(l),onClick:()=>a(c),children:t.jsx("div",{className:"bg-token-main-surface-secondary dark:bg-token-main-surface-primary-inverse",children:t.jsx("img",{className:"h-10 w-10 rounded-xs object-cover mix-blend-darken",src:c,alt:e})})},`${l}-${c}`))})]}):null}function Vn({offer:s,onClick:e}){const a=s.price_details,n=a?.base&&(a.shipping??a.tax)&&a.total,i=a?.display_price==="total_price"||n,r=a?.display_price==="total_price";let c=null;n&&a?c=t.jsxs("div",{className:"space-y-1 text-sm",children:[t.jsx("div",{children:t.jsx(w,{id:"offer.breakdown.base",defaultMessage:"Base price: {amount}",values:{amount:a.base}})}),a.shipping&&t.jsx("div",{children:t.jsx(w,{id:"offer.breakdown.shipping",defaultMessage:"Shipping: {amount}",values:{amount:a.shipping}})}),a.tax&&t.jsx("div",{children:t.jsx(w,{id:"offer.breakdown.tax",defaultMessage:"Tax: {amount}",values:{amount:a.tax}})})]}):r&&(c=t.jsx(w,{id:"ur3//V",defaultMessage:"Prices shown include estimated tax and shipping."}));const l=!!s.checkout_url;return t.jsxs("div",{className:E("flex cursor-pointer flex-col rounded-xl p-3","hover:bg-token-bg-tertiary"),onClick:e,children:[t.jsxs("div",{className:"flex flex-row items-center gap-2 text-sm font-semibold",children:[t.jsx(Js,{className:"h-5 w-5 rounded-full",url:s.url,size:128,minSize:16,fallback:t.jsx(Zs,{className:"text-token-text-tertiary"})}),t.jsx("div",{className:"min-w-0 flex-1 truncate",children:s.merchant_name}),i&&c?t.jsx(V,{label:c,children:t.jsxs("span",{className:"flex items-baseline",children:[t.jsx(dt,{className:"text-token-text-secondary h-3 w-3"}),t.jsx("span",{children:s.price})]})}):t.jsx("span",{children:s.price}),t.jsx(ie,{className:"w-fit min-w-20 truncate",size:"small",color:l?"primary":"secondary",children:l?t.jsx(w,{id:"LlDx51",defaultMessage:"Buy now"}):t.jsx(w,{id:"sTpOJt",defaultMessage:"Buy"})})]}),t.jsx("div",{className:"text-token-text-secondary pt-2.5 text-xs",children:s.product_name}),t.jsx("div",{className:"text-token-text-secondary text-xs",children:s.details})]})}function Qn({clientThreadId:s,type:e="sidebar"}){const{closeThreadSidebar:a}=St(),{clientThreadId:n,messageId:i,turnIndex:r,contentReferenceStartIndex:c,productIndex:l}=Ea("product")??{},m=Fe(n,g=>g),d=h.useMemo(()=>({clientThreadId:s,messageId:i,turnIndex:r}),[s,i,r]);if(n!==s||c===void 0||l===void 0||!i)return null;const{product:u,descriptionCitation:f}=ea({thread:m,messageId:i,contentReferenceStartIndex:c,productIndex:l});if(!u)return null;const o=`${i}-${c}-${l}`,x=t.jsx(Wn,{product:u,descriptionCitation:f,clientThreadId:s,messageId:i,contentReferenceStartIndex:c,productIndex:l,analyticsMetadata:d,offsetTopMargin:e==="sidebar"});switch(e){case"sidebar":return t.jsx(ct,{handleClose:a,children:x},o);case"modal":return t.jsxs(Oa,{testId:"modal-chat-screen-product-flyout",className:"relative max-w-md",size:"custom",type:"success",noPadding:!0,title:u.title,visuallyHiddenHeader:!0,isOpen:!0,onClose:a,children:[x,t.jsx(La,{className:"absolute end-2.5 top-2.5 z-10",onClick:a})]},o)}}function qn({isExpanded:s,children:e}){const a=h.useRef(null),[n,i]=h.useState("400px"),r=ue.isValidElement(e)?ue.cloneElement(e,{setWidth:i}):e;return t.jsx(ne,{children:t.jsx(D.div,{className:"bg-token-sidebar-surface-primary relative z-1 shrink-0 overflow-x-hidden max-lg:w-0!",ref:a,initial:!1,animate:{width:s?n:0,transition:{type:"spring",bounce:.12,duration:.3}},onAnimationStart:()=>{a.current&&(a.current.style.visibility="visible")},onAnimationComplete:()=>{a.current&&(s||(a.current.style.visibility="hidden"))},children:t.jsx("div",{className:E("absolute h-full",!s&&"pointer-events-none"),style:{width:n},children:t.jsx("div",{className:"flex h-full flex-col",children:r})})})})}const mi=({setWidth:s,clientThreadId:e})=>{const a=vt(),n=ut();return a?t.jsxs(t.Fragment,{children:[$(a,"searchSources")&&t.jsx(ta,{clientThreadId:e}),$(a,"retrievalResults")&&t.jsx(sa,{clientThreadId:e}),n&&$(a,"summarizer")&&t.jsx(aa,{clientThreadId:e}),$(a,"caterpillar")&&t.jsx(Un,{taskId:a.caterpillarId,initialTab:a.initialTab,setWidth:s}),$(a,"product")&&t.jsx(Qn,{clientThreadId:e})]}):null};function Ct({children:s,hideNavigation:e=!1,mobileHeaderContent:a,mobileHeaderRightContentExpanded:n,mobileHeaderLeftContent:i,mobileHeaderRightContent:r,mobileHeaderBottomContent:c,renderNavSidebar:l,threadFlyout:m,forceOpenDesktopSidebar:d=!1}){const{isUnauthenticated:u}=ze(),f=ye(I=>I.activeSidebar),o=za(),x=na(),g=vt(),v=ia(),p=[];let S=null;ue.Children.forEach(s,I=>{ue.isValidElement(I)&&(I.type===Ct.Sidebars?S=I:p.push(I))});const j=!u&&!e&&l!=null,N=!e&&(j||u),y=ut(),k=g?$(g,"summarizer")&&y:!1,C=g?!$(g,"summarizer"):!1,b=o&&(k||C),T=j&&(x||d||v);return t.jsxs("div",{className:"flex h-full w-full flex-col",children:[t.jsx(W,{children:t.jsx(ra,{})}),t.jsxs("div",{className:E("relative flex h-full w-full flex-1 transition-colors",f!=="popover-nav"&&"z-0"),children:[t.jsxs("div",{className:"relative flex h-full w-full flex-row",children:[t.jsx(ne,{initial:!1,children:T&&t.jsx(Mn,{isPopover:x,children:u?t.jsx(Nn,{}):l?.()})}),t.jsxs("div",{className:"relative flex h-full max-w-full flex-1 flex-col",children:[N&&t.jsxs(W,{children:[t.jsx(oa,{}),t.jsx(_n,{rightContentExpanded:n,onOpenSidebar:()=>Q.setSidebarOpen(!0),showNavSidebar:j,leftContent:i,rightContent:r,bottomContent:c,children:a})]}),t.jsx("main",{className:"transition-width relative h-full w-full flex-1 overflow-auto",id:"main","z-index":"-1",children:p})]})]}),t.jsx(W,{children:t.jsx(qn,{isExpanded:b,children:m})}),S]}),t.jsx(W,{children:t.jsx(la,{useManuallyControlledVisibility:!0})})]})}function Xn({children:s}){return t.jsx(t.Fragment,{children:s})}Ct.Sidebars=Xn;export{li as C,mi as F,jn as S,bn as a,Ct as b,ui as c,di as d,ci as e};
//# sourceMappingURL=nexm4ijmv6vpe660.js.map
