var We=Object.defineProperty,Xe=Object.defineProperties;var Ye=Object.getOwnPropertyDescriptors;var Ae=Object.getOwnPropertySymbols;var Ze=Object.prototype.hasOwnProperty,ze=Object.prototype.propertyIsEnumerable;var ye=(r,e,t)=>e in r?We(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,fe=(r,e)=>{for(var t in e||(e={}))Ze.call(e,t)&&ye(r,t,e[t]);if(Ae)for(var t of Ae(e))ze.call(e,t)&&ye(r,t,e[t]);return r},_e=(r,e)=>Xe(r,Ye(e));import{c as Pe,h as Qe,r as M,e as et,v as Te,j as g}from"./bubexfvksfr7893o.js";import{u as tt,g as st,b9 as nt,d as Ce,M as at,B as ve,aB as we,O as Ne,V as Re,a4 as Ee,a6 as ge,aw as ee,ay as O,bS as rt,n as ot,bk as it,l as lt,aR as ct,bM as ut,ck as dt}from"./ncw8zw682jinppua.js";import{lX as ft,lY as gt,dd as ke,lZ as Se,fi as pt,fj as mt,l_ as ht,l$ as St,cc as Mt,m0 as xt,m1 as pe,m2 as bt,m3 as me,c0 as he,m4 as At,c1 as yt}from"./lm3g1zm00rp6al39.js";import{g as _t}from"./hzasobp3hhjtq47p.js";function Tt(r){"use forget";const e=Pe.c(66),{prompt:t,isComplete:p,clientThreadId:i,parentMessageId:m}=r,f=tt();let n;e[0]!==i||e[1]!==f?(n=st(f,i),e[0]=i,e[1]=f,e[2]=n):n=e[2];const a=n,c=Qe(),[l,B]=M.useState(!1),D=nt();let T;e[3]!==a?(T=()=>it(a).id,e[3]=a,e[4]=T):T=e[4];const x=Ce(T);let u;e[5]!==t?(u=()=>pt(t?[t]:[]),e[5]=t,e[6]=u):u=e[6];const[d,H]=M.useState(u),b=M.useRef(null),A=at(i,vt),U=Ce(ve.agentSafeModeHasSeenNux$),s=et({startDefault:{id:"auraAgentSuggestion.startDefault",defaultMessage:"Continue"},cancel:{id:"auraAgentSuggestion.cancel",defaultMessage:"No thanks"},accepted:{id:"auraAgentSuggestion.accepted",defaultMessage:"The user has asked for agent to complete their task."}}),$=M.useRef(!1);let S,y;e[7]===Symbol.for("react.memo_cache_sentinel")?(S=()=>(b.current||(b.current=new mt([],o=>{H(o)},!0)),()=>{var o;(o=b.current)==null||o.destroy(),b.current=null}),y=[],e[7]=S,e[8]=y):(S=e[7],y=e[8]),M.useEffect(S,y);let C,G;e[9]!==p||e[10]!==t?(C=()=>{var h;const o=t?[t]:[];o.length===0&&H([]),(h=b.current)==null||h.onMessagePartsUpdated(o,!p)},G=[t,p],e[9]=p,e[10]=t,e[11]=C,e[12]=G):(C=e[11],G=e[12]),M.useEffect(C,G);const[Fe,je]=M.useState(!1);let q;e[13]===Symbol.for("react.memo_cache_sentinel")?(q=()=>{var o,h;je((h=(o=b.current)==null?void 0:o.isComplete())!=null?h:!1)},e[13]=q):q=e[13];let K;e[14]!==d?(K=[d],e[14]=d,e[15]=K):K=e[15],M.useEffect(q,K);let V,J;e[16]!==i||e[17]!==x||e[18]!==A?(V=()=>{if($.current||!x||A)return;$.current=!0;const o=h=>{lt(i,_=>{_.conduitToken=h,_.prepareState="success"})};ht(i,x,[ge.Agent],o,{isRegen:!1,isOnboardingConversation:!1,delayAfterCompletion:!1})},J=[i,x,A],e[16]=i,e[17]=x,e[18]=A,e[19]=V,e[20]=J):(V=e[19],J=e[20]),M.useEffect(V,J);const te=U===!1,Ie=Ct,Le=()=>c.formatMessage(s.accepted);let W;e[21]!==te?(W=()=>{te&&St(!0)},e[21]=te,e[22]=W):W=e[22];const X=W;let Y;e[23]===Symbol.for("react.memo_cache_sentinel")?(Y={isAgentHintActive:!0},e[23]=Y):Y=e[23];const{agentSessionModeNuxModal:se,ensureAgentSessionModeNux:Oe,isAgentSessionModeNuxOpen:Be}=ft(Y),Me=async o=>{var be;if(l||!t)return;X();const h=Ne(i),_=h?Re.lastUserMessage(h):null;if(!_){Ee.error("AuraAgentSuggestion: Unable to find last user message",{clientThreadId:i,parentMessageId:m});return}B(!0),D(ge.Agent);const xe=o?Ie(o):void 0,qe={id:Te(),author:{role:O.Tool,name:Se},create_time:Date.now()/1e3,content:{content_type:ee.Text,parts:[Le()]},recipient:"all",status:"finished_successfully",weight:0},Ke=fe(_e(fe({},(be=_.metadata)!=null?be:{}),{is_visually_hidden_from_conversation:!0}),xe!==void 0&&{n7jupd_local_safe_mode:xe}),Ve=rt("",Ke),Je={systemHints:[ge.Agent],conversationMode:{kind:ot.PrimaryAssistant}};await ke({conversation:a,promptMessage:Ve,eventSource:"mouse",prependMessages:[qe],completionMetadata:Je})};let Z;e[24]!==X||e[25]!==a||e[26]!==l?(Z=async()=>{if(l)return;X(),B(!0);const o={id:Te(),author:{role:O.Tool,name:Se},create_time:Date.now()/1e3,content:{content_type:ee.Text,parts:["The user has declined to use Agent, answer their question directly"]},recipient:"all",status:"finished_successfully",weight:0};await ke({conversation:a,promptMessage:o,eventSource:"mouse"})},e[24]=X,e[25]=a,e[26]=l,e[27]=Z):Z=e[27];const ne=Z;if(!t)return null;let z;e[28]!==d?(z=gt(d),e[28]=d,e[29]=z):z=e[29];const ae=z,re=c.formatMessage(s.startDefault),oe=()=>{const o=ve.agentSessionMode$();Oe(_=>{Me(_)})||Me(o)},ie=U===!0&&!Be;let v;e[30]===Symbol.for("react.memo_cache_sentinel")?(v=_t(!1),e[30]=v):v=e[30];const Ue="text-token-text-primary mb-2 flex max-w-full flex-col gap-6",le=!p;let w;e[31]!==ae||e[32]!==le?(w=g.jsx(Mt,{className:"text-token-text-primary text-base leading-6 break-words",isActivelyStreaming:le,children:ae}),e[31]=ae,e[32]=le,e[33]=w):w=e[33];const De="flex flex-col gap-3 transition-opacity duration-200",ce=Fe?1:0;let k;e[34]!==ce?(k={opacity:ce},e[34]=ce,e[35]=k):k=e[35];const He="flex flex-col gap-2 min-[420px]:flex-row min-[420px]:items-center min-[420px]:justify-end min-[420px]:gap-3",$e="flex flex-col-reverse gap-2 min-[420px]:flex-row min-[420px]:flex-wrap min-[420px]:gap-2",ue=we,Ge="secondary",de=c.formatMessage(s.cancel);let P;e[36]!==ue||e[37]!==ne||e[38]!==l||e[39]!==de?(P=g.jsx(ue,{color:Ge,onClick:ne,disabled:l,children:de}),e[36]=ue,e[37]=ne,e[38]=l,e[39]=de,e[40]=P):P=e[40];let N;e[41]!==oe||e[42]!==l||e[43]!==re?(N=g.jsx(we,{color:"primary",onClick:oe,disabled:l,children:re}),e[41]=oe,e[42]=l,e[43]=re,e[44]=N):N=e[44];let R;e[45]!==P||e[46]!==N?(R=g.jsxs("div",{className:$e,children:[P,N]}),e[45]=P,e[46]=N,e[47]=R):R=e[47];let E;e[48]!==l||e[49]!==ie?(E=ie?g.jsx(xt,{disabled:l,showLeadingDivider:!0}):null,e[48]=l,e[49]=ie,e[50]=E):E=e[50];let F;e[51]!==R||e[52]!==E?(F=g.jsxs("div",{className:He,children:[R,E]}),e[51]=R,e[52]=E,e[53]=F):F=e[53];let j;e[54]!==k||e[55]!==F?(j=g.jsx("div",{className:De,style:k,children:F}),e[54]=k,e[55]=F,e[56]=j):j=e[56];let I;e[57]!==w||e[58]!==j?(I=g.jsxs("div",{className:Ue,children:[w,j]}),e[57]=w,e[58]=j,e[59]=I):I=e[59];let L;e[60]!==v||e[61]!==I?(L=g.jsx("div",{className:v,children:I}),e[60]=v,e[61]=I,e[62]=L):L=e[62];let Q;return e[63]!==se||e[64]!==L?(Q=g.jsxs(g.Fragment,{children:[L,se]}),e[63]=se,e[64]=L,e[65]=Q):Q=e[65],Q}function Ct(r){return r==="incognito"}function vt(r){var e;return(e=r==null?void 0:r.prepareRequestBlocked)!=null?e:!1}const wt={close_tabs:{inProgress:"Closing tabs",finished:"Closed tabs",error:"Failed to close tabs"},open_tabs:{inProgress:"Opening tabs",finished:"Opened tabs",error:"Failed to open tabs"},list_tabs:{inProgress:"Listing tabs",finished:"Listed tabs",error:"Failed to list tabs"},focus_tab:{inProgress:"Focusing tab",finished:"Focused tab",error:"Failed to focus tab"},navigate_current_tab:{inProgress:"Navigating current tab",finished:"Navigated current tab",error:"Failed to navigate current tab"},set_tab_pinned_state:{inProgress:"Updating tab pin state",finished:"Updated tab pin state",error:"Failed to update tab pin state"},set_preference:{inProgress:"Setting preference",finished:"Updated preference",error:"Failed to set preference"},add_bookmark:{inProgress:"Adding bookmark",finished:"Added bookmark",error:"Failed to add bookmark"},reorder_tabs:{inProgress:"Reordering tabs",finished:"Reordered tabs",error:"Failed to reorder tabs"},search_browsing_history:{inProgress:"Searching browser memories",finished:"Searching browser memories",error:"Failed to search browser memories"}},kt=Object.fromEntries(Object.entries(wt).map(([r,e])=>["".concat(ct,".").concat(r),e])),Pt={inProgress:"Running tool",finished:"Finished running tool",error:"Error running tool"};function Nt(r,e){const t=kt[r];return t?t[e]:Pt[e]}function Rt({messages:r,isRequestActive:e,isLastMessageInTurn:t,clientThreadId:p}){"use no forget";var A,U;const i=r.filter(s=>s.author.role===O.Assistant&&s.recipient&&pe(s.recipient)),m=Ne(p),f=m?Re.getConversationTurns(m).flatMap(s=>s.messages):[],n=f.findLastIndex(s=>s.author.role===O.Assistant&&s.recipient&&pe(s.recipient)),a=n>=0?f[n]:void 0,c=a&&a.recipient,l=n>=0?f.slice(n+1).filter(s=>s.author.role===O.Tool&&s.author.name===c):[],B=n>=0?f.slice(n+1).find(s=>s.author.role===O.Assistant&&(!s.recipient||!pe(s.recipient))):void 0,D=B!=null&&ut(B),T=l.length>0,x=a==null?void 0:a.id,u=bt(s=>x?s.getToolState(p,x):void 0);let d=null;T||(u==null?void 0:u.status)===me.Finished?d={key:"finished",status:he.Finished}:(u==null?void 0:u.status)===me.Error?d={key:"error",status:he.Error}:((u==null?void 0:u.status)===me.Running||e&&t&&!u)&&(d={key:"inProgress",status:he.Running});const H=M.useMemo(()=>!c||!d?null:Nt(c,d.key),[c,d]);if(i.length===0||!c||!i.some(s=>s.id===(a==null?void 0:a.id)))return null;if(c===Se){if(!a||l.length>0||D)return null;let s="";a.content.content_type===ee.Text?s=(U=(A=a.content.parts)==null?void 0:A[0])!=null?U:"":a.content.content_type===ee.Code&&(s=a.content.text);const $=a.status==="finished_successfully",[S]=At(s,C=>dt(C));!S&&s.trim().length>0&&Ee.error("BrowserToolMessage: failed to parse SuggestAgent arguments",{args:s});let y="";return typeof(S==null?void 0:S.prompt)=="string"&&(y=S.prompt),{type:"suggestion",prompt:y,isComplete:$,parentMessageId:a.id}}return D||!d?null:{type:"message",message:H,display:d}}function Ot(r){"use forget";const e=Pe.c(13),{messages:t,isRequestActive:p,isLastMessageInTurn:i,clientThreadId:m}=r;let f;e[0]!==m||e[1]!==i||e[2]!==p||e[3]!==t?(f={messages:t,isRequestActive:p,isLastMessageInTurn:i,clientThreadId:m},e[0]=m,e[1]=i,e[2]=p,e[3]=t,e[4]=f):f=e[4];const n=Rt(f);if(!n)return null;if(n.type==="suggestion"){let c;return e[5]!==m||e[6]!==n.isComplete||e[7]!==n.parentMessageId||e[8]!==n.prompt?(c=g.jsx(Tt,{prompt:n.prompt,isComplete:n.isComplete,clientThreadId:m,parentMessageId:n.parentMessageId}),e[5]=m,e[6]=n.isComplete,e[7]=n.parentMessageId,e[8]=n.prompt,e[9]=c):c=e[9],c}let a;return e[10]!==n.display.status||e[11]!==n.message?(a=g.jsx(yt,{highlightedCommand:n.message,showWorkUserSetting:!1,status:n.display.status,children:null}),e[10]=n.display.status,e[11]=n.message,e[12]=a):a=e[12],a}export{Ot as BrowserToolMessage};
//# sourceMappingURL=luovwir6adk374h4.js.map
