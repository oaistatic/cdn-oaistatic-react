var H=Object.defineProperty,D=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var U=(e,o,n)=>o in e?H(e,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[o]=n,w=(e,o)=>{for(var n in o||(o={}))W.call(o,n)&&U(e,n,o[n]);if(C)for(var n of C(o))z.call(o,n)&&U(e,n,o[n]);return e},B=(e,o)=>D(e,G(o));var Q=(e,o)=>{var n={};for(var r in e)W.call(e,r)&&o.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&C)for(var r of C(e))o.indexOf(r)<0&&z.call(e,r)&&(n[r]=e[r]);return n};import{j as v,o as I,h as J,r as ee,e as te,v as ne}from"./bubexfvksfr7893o.js";import{ay as L,oS as Y,fx as oe,i3 as se,ks as ie,c8 as re,n as T,fy as ae,ku as ce,P as de,as as ue,dY as le,oT as fe,aw as q}from"./ncw8zw682jinppua.js";import{c7 as me,c8 as ge,c1 as pe,c9 as _e,c0 as y,ca as he}from"./lm3g1zm00rp6al39.js";import{C as ye}from"./b6setehb9ivy4393.js";import"./i420bybxmtbqtbfk.js";function Ne({messages:e,nextMessage:o,clientThreadId:n,isLastTurnInConversation:r,isLastMessageInTurn:d,onRequestCompletion:a}){var l,f,u,m,g;const t=e.find(c=>c.author.role===L.Tool&&c.recipient==="assistant"||c.author.role===L.Assistant&&c.recipient==="user");if(!t)return null;const i=(f=(l=t.metadata)==null?void 0:l.elicitation_metadata)==null?void 0:f.tool_call_message;if(!i)return null;const s=(m=(u=t.metadata)==null?void 0:u.elicitation_metadata)==null?void 0:m.plugin_data;return!s||!s.from_server||!("body"in((g=s.from_server)!=null?g:{}))?null:v.jsx(Se,{messages:e,nextMessage:o,clientThreadId:n,isLastTurnInConversation:r,isLastMessageInTurn:d,onRequestCompletion:a,serverActionMessage:s.from_server,toolCallMessage:i})}function Se({messages:e,nextMessage:o,clientThreadId:n,isLastTurnInConversation:r,isLastMessageInTurn:d,onRequestCompletion:a,serverActionMessage:t,toolCallMessage:i}){var s;if(!("body"in t))return null;if(t.type=="oauth_required"){const f=((s=t.body.actions)!=null?s:[]).find(ve);return f?v.jsx(Me,{messages:e,nextMessage:o,clientThreadId:n,isLastTurnInConversation:r,isLastMessageInTurn:d,onRequestCompletion:a,toolCallMessage:i,oauthTargetMessageId:f.oauth_redirect.target_message_id}):null}}function Me({messages:e,nextMessage:o,clientThreadId:n,isLastTurnInConversation:r,isLastMessageInTurn:d,onRequestCompletion:a,toolCallMessage:t,oauthTargetMessageId:i}){var O;const[s,l]=I(),f=J(),u=e.find(S=>{var _,M,k;return(k=(M=(_=S.metadata)==null?void 0:_.elicitation_metadata)==null?void 0:M.plugin_data)==null?void 0:k.from_client}),m=Y(t==null?void 0:t.recipient),g=(O=Y(o==null?void 0:o.recipient))==null?void 0:O.namespace,{connectorId:c,connectorToolStatus:A,connectorStatusMessage:j}=Pe(m==null?void 0:m.namespace,g,e,r),h=oe(!0,se.JIT_PLUGIN).platformConnectors.get(c!=null?c:""),b=!!(c&&h&&!u&&d),K=ie(),p=re();ee.useEffect(()=>{var _,M,k,F;if(((F=(k=(M=(_=u==null?void 0:u.metadata)==null?void 0:_.elicitation_metadata)==null?void 0:M.plugin_data)==null?void 0:k.from_client)==null?void 0:F.type)==="oauth_success")return;s.get("oauth_success")&&(l(V=>(V.delete("oauth_success"),V),{replace:!0}),E({eventSource:"url",assistantMessage:t,onRequestCompletion:a,actionData:{type:"oauth_success",target_message_id:i},conversationMode:{kind:T.PrimaryAssistant},activeSystemHint:p!=null?p:void 0,messageTextContent:"Login successful."}))},[t,e,n,a,r,s,l,p,i,u]);const X=ae({skip:!1,fetchValidLinksOnly:!0,productSku:"n7jupd"}),Z=Array.from(X.connectorLinks.values()).some(S=>S.some(_=>_.connector_id===c)),{addSource:$,selectedSources:R}=me(n),{selectedRepos:x}=ge(n);return v.jsxs(v.Fragment,{children:[j&&v.jsx(pe,{highlightedCommand:h?f.formatMessage(j,{domain:h.name}):v.jsx("br",{}),status:A,showWorkUserSetting:!1}),b&&h&&v.jsx("div",{className:"mb-2 flex gap-2",children:v.jsx(ye,{connector:h,hasWidget:_e(e),onConnect:S=>{if(Z){$(ce[c!=null?c:""]),E({sourceEvent:S,assistantMessage:t,onRequestCompletion:a,actionData:{type:"oauth_success",target_message_id:i},conversationMode:{kind:T.PrimaryAssistant},activeSystemHint:p!=null?p:void 0,messageTextContent:"Login successful.",selectedSources:R,selectedRepos:x});return}const _=de(n),M=_?new URL(ue(_),window.location.origin):new URL(window.location.href);M.searchParams.set("oauth_success","true"),K({connectorId:h.id,redirectAfter:M.toString(),referrer:le.JitPluginMessage})},onProceedWithoutConnecting:S=>{E({sourceEvent:S,assistantMessage:t,onRequestCompletion:a,actionData:{type:"deny",target_message_id:i},messageTextContent:"Login declined.",conversationMode:{kind:T.PrimaryAssistant},activeSystemHint:p!=null?p:void 0,selectedSources:R,selectedRepos:x})}})})]})}function ve(e){var o;return(e==null?void 0:e.type)==="oauth_redirect"&&typeof((o=e==null?void 0:e.oauth_redirect)==null?void 0:o.target_message_id)=="string"}function Pe(e,o,n,r){var f,u,m,g,c,A,j,N,h;var d=(f=fe(e))!=null?f:void 0;const a=n[n.length-1],t=(u=a==null?void 0:a.metadata)==null?void 0:u.jit_plugin_data;if(!d&&((m=t==null?void 0:t.from_server)==null?void 0:m.type)==="oauth_required"&&(d=(g=t==null?void 0:t.from_server)==null?void 0:g.body.connector_id),!d)return{connectorId:void 0,connectorToolStatus:null,connectorStatusMessage:null,showConnectorConnect:!1};if(o===e)return{connectorId:d,connectorToolStatus:null,connectorStatusMessage:null,showConnectorConnect:!1};var i=y.Running,s=null,l=!1;return n.some(b=>b.content.content_type===q.SystemError)?(i=y.Error,s=P.error):a?((c=t==null?void 0:t.from_server)==null?void 0:c.type)==="oauth_required"&&r?(i=y.Paused,s=null,l=!0):((A=t==null?void 0:t.from_server)==null?void 0:A.type)==="oauth_required"&&!r?(i=y.Stopped,s=P.connectorDeclined):((j=t==null?void 0:t.from_client)==null?void 0:j.type)==="deny"?(i=y.Stopped,s=P.connectorDeclined):((N=t==null?void 0:t.from_client)==null?void 0:N.type)==="oauth_success"?(i=y.Stopped,s=P.connectorAccepted):(h=a==null?void 0:a.metadata)!=null&&h.invoked_plugin?(i=y.Finished,s=P.finished):(i=y.Stopped,s=P.stopped):(i=y.Running,s=P.running),{connectorId:d,connectorToolStatus:i,connectorStatusMessage:s,showConnectorConnect:l}}function E(f){var u=f,{actionData:e,assistantMessage:o,turnGizmo:n,onRequestCompletion:r,conversationMode:d,activeSystemHint:a,messageTextContent:t,selectedSources:i,selectedRepos:s}=u,l=Q(u,["actionData","assistantMessage","turnGizmo","onRequestCompletion","conversationMode","activeSystemHint","messageTextContent","selectedSources","selectedRepos"]);var g;const m={id:ne(),author:{role:L.Tool,name:o.recipient},content:{content_type:q.Text,parts:[t!=null?t:""]},recipient:"all",metadata:w(w({jit_plugin_data:{from_client:e},gizmo_id:n==null?void 0:n.gizmo.id,elicitation_metadata:{plugin_data:{from_client:e}}},i&&{selected_sources:he(i)}),s&&{selected_github_repos:[...(g=s.selectedRepos)!=null?g:[]],selected_all_github_repos:s.selectedAllRepos}),clientMetadata:{completionSampleFinishTime:Date.now()}};r(B(w({},l),{promptMessage:m,completionMetadata:{conversationMode:d!=null?d:{kind:T.PrimaryAssistant},systemHints:a?[a]:void 0}}))}const P=te({starting:{id:"jitPluginMessage.starting",defaultMessage:"Starting action"},confirmingSimple:{id:"jitPluginMessage.confirming.simple",defaultMessage:"{gizmoName} wants to talk to {domain}"},confirmingSubtitle:{id:"jitPluginMessage.confirming.subtitle",defaultMessage:"Only allow sites you trust."},running:{id:"jitPluginMessage.runningV4",defaultMessage:"Talking to {domain}"},finished:{id:"jitPluginMessage.finishedV4",defaultMessage:"Talked to {domain}"},stopped:{id:"jitPluginMessage.stoppedV4",defaultMessage:"Stopped talking to {domain}"},error:{id:"jitPluginMessage.errorV5",defaultMessage:"Error talking to {domain}"},declined:{id:"jitPluginMessage.declined",defaultMessage:"You declined this action"},ranTest:{id:"jitPluginMessage.ranTest",defaultMessage:"Tested {operationName}"},confirmParamsTitle:{id:"jitPluginMessage.confirmParamsTitleV3",defaultMessage:"{gizmoName} wants to share this info with {domain}"},sentParamsTitle:{id:"jitPluginMessage.sentParamsTitleV2",defaultMessage:"{gizmoName} sent this info to {domain}"},privacyPolicyLink:{id:"jitPluginMessage.privacyPolicyLinkV2",defaultMessage:"Privacy policy"},connectorAccepted:{id:"jitPluginMessage.connectorAccepted",defaultMessage:"Accepted using {domain}"},connectorDeclined:{id:"jitPluginMessage.connectorDeclined",defaultMessage:"Declined connection to {domain}"},rememberForThisConversation:{id:"jitPluginMessage.rememberForThisConversation",defaultMessage:"Remember for this conversation"}});export{Ne as APIToolElicitationMessage};
//# sourceMappingURL=dy8akl8esraby0ox.js.map
