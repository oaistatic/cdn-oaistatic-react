var ot=Object.defineProperty,at=Object.defineProperties;var it=Object.getOwnPropertyDescriptors;var We=Object.getOwnPropertySymbols;var rt=Object.prototype.hasOwnProperty,lt=Object.prototype.propertyIsEnumerable;var He=(t,e,s)=>e in t?ot(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Oe=(t,e)=>{for(var s in e||(e={}))rt.call(e,s)&&He(t,s,e[s]);if(We)for(var s of We(e))lt.call(e,s)&&He(t,s,e[s]);return t},Ue=(t,e)=>at(t,it(e));import{r as p,o as ct,h as dt,j as u,c as Ye}from"./bubexfvksfr7893o.js";import{u as Z,d as Pe,h$ as ut,aP as Ge,sw as mt,M as Ke,V as J,hO as ft,fH as ht,i5 as pt,ce as xt,i7 as Xe,fb as Ct,ca as ze,d$ as gt,sx as Tt,dS as I,lS as bt}from"./ncw8zw682jinppua.js";import{bG as Le,n9 as vt,na as Je,e5 as _t,C as y,nb as St,nc as It,mc as yt,nd as wt,ne as Et,nf as At,ng as Rt,n8 as Nt,nh as Dt,ni as Ft,nj as Ot,nk as Ve,nl as Qe,mD as jt,u as Pt,fc as ke,nm as qe,nn as $e,no as Lt,np as kt,nq as Mt}from"./lm3g1zm00rp6al39.js";import{L as Wt}from"./eii6zxu7kogjx11x.js";import{T as Ht}from"./dktrrnr6sah4uda0.js";import{g as Ut}from"./bj1ejin6tzi0v3v8.js";import"./ce3hgmw4iyyhicud.js";import"./mstl8wgfzorpgdoe.js";import"./e9acc0j1u83xdcvx.js";import"./kfdkis1zwf4ccfgg.js";import"./ol9d5wxhynx9q2is.js";import"./mbmcx8v24u1ao1ke.js";import"./orkdsokm67upvzbu.js";import"./fuwv2o9dqpty536z.js";import"./m214aojas5i8u5ss.js";import"./deakbbf27g8e7ba0.js";import"./cdu988xkidlznefj.js";import"./kl7c6054usfnqmd4.js";import"./k97n0y6ba9c9h39c.js";import"./eg96d9s49vx4uh5w.js";import"./gk9c5stronfar8qx.js";import"./o4w8zbrq7mg3p422.js";import"./ns51nblw8ziscsgd.js";import"./drmwaklva7v056il.js";import"./imbbtedzs51am1ck.js";import"./mj32z5vcfl3ugvj5.js";import"./ebn7bwt2w9d4cap9.js";import"./nxg251y5bix8gl53.js";import"./o66elomacusdy99v.js";import"./ecforv0kxuh5qyzb.js";import"./oumcmu9jw5n6nb3o.js";import"./n8xi1u5k4xaewewd.js";import"./bo0p7vuujjmng48f.js";import"./l4pcm542yc2tenou.js";import"./ffvjxtmoqooghm1t.js";import"./eqqsnl6kprwt6kvn.js";import"./b3zmi7k0e1dvao0m.js";import"./ekj7v0hd90m9gfgd.js";import"./hzasobp3hhjtq47p.js";import"./irqko7c1s7qpl41n.js";import"./knfzy5vszhnec9ql.js";import"./bc00p2ldn9cv9q32.js";import"./8ix1du5tuckfsvqq.js";import"./fwn4bwvyx3h4ty5g.js";import"./l1teaxoievyk0rz1.js";import"./nbm98bu0q3774lnr.js";import"./i9ddjt6oaiw4vo4g.js";import"./ke3w2t9x8i7kgfhv.js";const Be="oai/apps/canmoreSidebarWidth",Gt=.25,zt=400,Ze=400;function et(t){return t-zt}function Te(t,e){return mt(Ze,et(t),e!=null?e:Gt*t)}function Vt(){const t=Z(),e=Pe(()=>Le(t).width),s=Te(e,ut(Ge.DANGER_SECRET_FOLDERS_ONLY_getItem(Be))),r=tt(),[n,i]=p.useState(s);p.useEffect(()=>{(n<Ze||n>et(e))&&i(Te(e,n))},[e]);function o(d){i(f=>Te(e,f+=d.delta.x))}function a(d){i(d),Ge.DANGER_SECRET_FOLDERS_ONLY_setItem(Be,d)}function l(){const d=Te(e,void 0);a(d)}const c="calc(100vw - ".concat(n,"px)");return r?{chatWidth:n,canvasWidth:e-n,canvasWidthCalc:c,viewportWidth:e,handleDrag:o,handleDoubleClick:l,persist:a}:{chatWidth:0,canvasWidth:e,canvasWidthCalc:"100vw",viewportWidth:e,handleDrag:()=>{},handleDoubleClick:()=>{},persist:()=>{}}}function tt(t){const e=Z();return Pe(()=>(t!=null?t:Le(e).width)>1e3)}const je="sharedCanvas";function qt(){const[t,e]=ct(),s=t.get(je),r=dt();p.useEffect(()=>{const n=s&&vt.createRemixTempTextdoc(s,r);if(!n)return;requestAnimationFrame(()=>{Je(n)});const i=new URLSearchParams(t);i.delete(je),e(i);const o=new URL(window.location.href);o.searchParams.delete(je),history.replaceState(null,"",o)},[s,t,e,r])}const $t="textdocId",Bt=t=>{const s=new URLSearchParams(window.location.search).get($t),r=Ke(t,n=>{var i,o,a;return(a=(o=(i=J.findNode(n,({message:l})=>{var d;const c=(d=l.metadata)==null?void 0:d.canvas;return(c==null?void 0:c.create_source)===_t.HIVE&&(s?(c==null?void 0:c.textdoc_id)===s:!0)}))==null?void 0:i.message.metadata)==null?void 0:o.canvas)==null?void 0:a.textdoc_id});p.useEffect(()=>{r&&requestAnimationFrame(()=>{Je(r)})},[r])};function Yt(t,e){let s;return(e==null?void 0:e.type)===y.Textdoc&&(e.textdocId.startsWith(St)||(s={type:"canvas_textdoc",id:e.textdocId})),It(t,{promptMessage:{metadata:{open_in_canvas_view:s}}})}const st=({isFullScreen:t=!1,clientThreadId:e,focusedObject:s,onClose:r,isAnimating:n=!1,width:i})=>{const{setTargetedContent:o}=yt(),a=p.useRef(!1);if(p.useEffect(()=>(a.current&&o(void 0),a.current=!0,()=>{a.current=!1}),[s]),s==null)return null;switch(s.type){case y.Textdoc:return u.jsx(Ht,{isFullScreen:t,onClose:r,clientThreadId:e,focusedTextdoc:s,isAnimating:n,width:i});case y.ADAVisualization:return null}},Kt=300,Xt=t=>{switch(t==null?void 0:t.type){case y.Textdoc:return t.textdocId;default:return null}};function Jt({clientThreadId:t,isDisabled:e,disabledTypes:s}){const[r,n,i,o,a]=Ke(t,x=>[J.getRequestId(x),J.getConversationLastTurn(x),J.isMessageTurnEnded(x),J.getVariantIds(x).length>1,J.lastUserMessage(x)],{disablePerfDetector:!0}),l=ft(r),c=wt(),[d,f]=p.useMemo(()=>{if(n&&o)return[void 0,null];if(e===!0)return[void 0,null];if(a!=null){const g=Et(a);if(g)return[a.id,{type:y.Textdoc,textdocId:g}]}let x;return!i&&n&&(x=ht(n.messageGroups,g=>g.type!==pt)),Qt({groupedMessage:x,isRequestActive:l,latestTextdocId:c,disabledTypes:s})},[i,n,o,e,l,c,s,a]),m=f!=null,ve=Xt(f),_e=At("canvas");p.useEffect(()=>{if(f&&d&&!xt()&&(_e(),Rt(f,d),f.type===y.Textdoc)){const{textdocId:x}=f,g=Ut(x);Nt(document.getElementById(g))}},[m,ve])}function Qt({groupedMessage:t,isRequestActive:e,latestTextdocId:s,disabledTypes:r}){var n,i;if(t!=null&&t.type&&r.includes(t.type))return[void 0,null];switch(t==null?void 0:t.type){case Xe.Canmore:{const[o,a]=t.messages;if(!Dt(o))break;const l=Ft(e,o,a!=null?a:null),c=(n=l.textdocId)!=null?n:s;if(c&&(l.function===Ot.CreateTextdoc?((i=l.content)!=null?i:"").length>Kt||l.status===Ve.WAITING:l.status===Ve.STREAMING))return[l.messageId,{type:y.Textdoc,textdocId:c}];break}}return[void 0,null]}const be={bounce:.12,duration:.64},Zt={bounce:0,duration:.58},S={duration:0},es=t=>{"use forget";const e=Ye.c(112),{clientThreadId:s,focusedObject:r,onClose:n}=t,i=Z(),{chatWidth:o,canvasWidthCalc:a,handleDrag:l,handleDoubleClick:c,persist:d}=Vt();let f;e[0]!==i?(f=ke(i),e[0]=i,e[1]=f):f=e[1];const m=f,[ve,_e]=p.useState(!m),[x,g]=p.useState(!1),Se=m?S:be,Ie=m?S:Zt,T=Lt(os);let ee;e[2]!==i?(ee=()=>Le(i),e[2]=i,e[3]=ee):ee=e[3];const{height:b,width:w}=Pe(ee);let te;e[4]!==o||e[5]!==b||e[6]!==T||e[7]!==w?(te=T!=null?T:{top:0,left:o,width:w-o,height:b},e[4]=o,e[5]=b,e[6]=T,e[7]=w,e[8]=te):te=e[8];let h=te,Me=!1;if(T&&(h.top<0||h.top+h.height>b)){Me=!0;const xe=(w-o)*.75,Q=b*.75;let Ce;e[9]!==xe||e[10]!==Q?(Ce={width:xe,height:Q},e[9]=xe,e[10]=Q,e[11]=Ce):Ce=e[11];const _=Ce,De=b/2-_.height/2,Fe=(w-o-_.width)/2+o;let ge;e[12]!==_.height||e[13]!==_.width||e[14]!==De||e[15]!==Fe?(ge={top:De,left:Fe,width:_.width,height:_.height},e[12]=_.height,e[13]=_.width,e[14]=De,e[15]=Fe,e[16]=ge):ge=e[16],h=ge}const C=T==null?void 0:T.borderRadius,v=kt(),ye=(v==null?void 0:v.history)!=null||(v==null?void 0:v.showChangesAtVersion)!=null,nt=bt();let E;e[17]!==v||e[18]!==ye?(E=ye&&u.jsx(Wt,{onClick:()=>Mt(v.textdocId),zIndexKey:"chatOverlay"}),e[17]=v,e[18]=ye,e[19]=E):E=e[19];const we=nt?-260:0;let A;e[20]!==we?(A={marginInlineEnd:we},e[20]=we,e[21]=A):A=e[21];let se;e[22]===Symbol.for("react.memo_cache_sentinel")?(se={marginInlineEnd:0},e[22]=se):se=e[22];let ne,oe,ae;e[23]===Symbol.for("react.memo_cache_sentinel")?(oe={opacity:1},ae={opacity:0},ne={opacity:[1,0]},e[23]=ne,e[24]=oe,e[25]=ae):(ne=e[23],oe=e[24],ae=e[25]);let R;e[26]!==m?(R=m?S:Ue(Oe({},be),{delay:.22}),e[26]=m,e[27]=R):R=e[27];let N;e[28]!==R?(N=u.jsx(I.div,{initial:oe,animate:ae,exit:ne,transition:R,className:"bg-token-main-surface-primary pointer-events-none absolute start-0 top-0 z-20 h-full w-full"}),e[28]=R,e[29]=N):N=e[29];let D;e[30]!==a?(D={width:a},e[30]=a,e[31]=D):D=e[31];let ie;e[32]===Symbol.for("react.memo_cache_sentinel")?(ie={width:0},e[32]=ie):ie=e[32];let F;e[33]!==m?(F=m?S:{bounce:0,duration:.1},e[33]=m,e[34]=F):F=e[34];let O;e[35]!==D||e[36]!==F?(O=u.jsx(I.div,{className:"relative z-20 h-full",style:D,exit:ie,transition:F}),e[35]=D,e[36]=F,e[37]=O):O=e[37];let j;e[38]!==Ie||e[39]!==N||e[40]!==O||e[41]!==A?(j=u.jsxs(I.div,{initial:A,animate:se,transition:Ie,children:[N,O]}),e[38]=Ie,e[39]=N,e[40]=O,e[41]=A,e[42]=j):j=e[42];const Ee=Me?0:1;let P;e[43]!==C||e[44]!==h.height||e[45]!==h.left||e[46]!==h.top||e[47]!==h.width||e[48]!==Ee?(P={borderRadius:C,opacity:Ee,x:h.left,y:h.top,height:h.height,width:h.width},e[43]=C,e[44]=h.height,e[45]=h.left,e[46]=h.top,e[47]=h.width,e[48]=Ee,e[49]=P):P=e[49];let L;e[50]!==a||e[51]!==o||e[52]!==b?(L={opacity:1,x:o,y:0,width:a,height:b,borderRadius:0},e[50]=a,e[51]=o,e[52]=b,e[53]=L):L=e[53];let k;e[54]!==m?(k=m?S:{opacity:{duration:.14,bounce:.1}},e[54]=m,e[55]=k):k=e[55];let M;e[56]!==C||e[57]!==k?(M={scale:.64,opacity:0,filter:"blur(12px)",transition:k,borderRadius:C},e[56]=C,e[57]=k,e[58]=M):M=e[58];const Ae=x||m?S:be;let re;e[59]===Symbol.for("react.memo_cache_sentinel")?(re=()=>_e(!1),e[59]=re):re=e[59];let W;e[60]!==C?(W={borderRadius:C},e[60]=C,e[61]=W):W=e[61];let le;e[62]===Symbol.for("react.memo_cache_sentinel")?(le={borderRadius:0},e[62]=le):le=e[62];let H;e[63]!==C?(H={borderRadius:C},e[63]=C,e[64]=H):H=e[64];let ce,de;e[65]===Symbol.for("react.memo_cache_sentinel")?(ce={opacity:.5},de={opacity:.75,width:"8px",left:"-4px"},e[65]=ce,e[66]=de):(ce=e[65],de=e[66]);let U;e[67]!==m?(U=m?S:{type:"tween",duration:.1},e[67]=m,e[68]=U):U=e[68];let ue;e[69]===Symbol.for("react.memo_cache_sentinel")?(ue={x:0,y:0,transform:"translateX(0px)"},e[69]=ue):ue=e[69];let me,fe,he;e[70]===Symbol.for("react.memo_cache_sentinel")?(me={left:0,right:0,top:0,bottom:0},fe=()=>g(!0),he=()=>g(!1),e[70]=me,e[71]=fe,e[72]=he):(me=e[70],fe=e[71],he=e[72]);let G;e[73]!==l?(G=(xe,Q)=>l(Q),e[73]=l,e[74]=G):G=e[74];let z;e[75]!==o||e[76]!==d?(z=()=>{g(!1),d(o)},e[75]=o,e[76]=d,e[77]=z):z=e[77];let V;e[78]!==c?(V=()=>c(),e[78]=c,e[79]=V):V=e[79];let q;e[80]!==U||e[81]!==G||e[82]!==z||e[83]!==V?(q=u.jsx(I.div,{drag:"x",className:"bg-token-text-quaternary absolute start-[-2px] z-10 h-full w-[4px] cursor-ew-resize opacity-0",whileHover:ce,whileDrag:de,transition:U,style:ue,dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:me,onPointerDown:fe,onPointerUp:he,onDrag:G,onDragEnd:z,onDoubleClick:V}),e[80]=U,e[81]=G,e[82]=z,e[83]=V,e[84]=q):q=e[84];let $;e[85]!==x?($=x&&u.jsx("div",{className:"absolute inset-0 z-10"}),e[85]=x,e[86]=$):$=e[86];const Re=!m&&ve,Ne=w-o;let B;e[87]!==s||e[88]!==r||e[89]!==n||e[90]!==Re||e[91]!==Ne?(B=u.jsx(st,{onClose:n,clientThreadId:s,isAnimating:Re,focusedObject:r,width:Ne}),e[87]=s,e[88]=r,e[89]=n,e[90]=Re,e[91]=Ne,e[92]=B):B=e[92];let Y;e[93]!==q||e[94]!==$||e[95]!==B?(Y=u.jsxs("div",{className:"h-full",children:[q,$,B]}),e[93]=q,e[94]=$,e[95]=B,e[96]=Y):Y=e[96];let K;e[97]!==W||e[98]!==H||e[99]!==Y||e[100]!==Se?(K=u.jsx(I.div,{className:"dark:border-token-border-light border-token-border-medium h-full overflow-hidden border-s",initial:W,animate:le,exit:H,transition:Se,children:Y}),e[97]=W,e[98]=H,e[99]=Y,e[100]=Se,e[101]=K):K=e[101];let X;e[102]!==P||e[103]!==L||e[104]!==M||e[105]!==Ae||e[106]!==K?(X=u.jsx(I.div,{className:"bg-token-bg-primary absolute start-0 z-20 h-full overflow-hidden shadow-[0_0_18px_rgba(0,0,0,0.12)] dark:shadow-[0_0_18px_rgba(0,0,0,0.48)]",initial:P,animate:L,exit:M,transition:Ae,onAnimationComplete:re,children:K}),e[102]=P,e[103]=L,e[104]=M,e[105]=Ae,e[106]=K,e[107]=X):X=e[107];let pe;return e[108]!==j||e[109]!==E||e[110]!==X?(pe=u.jsxs(u.Fragment,{children:[E,j,X]}),e[108]=j,e[109]=E,e[110]=X,e[111]=pe):pe=e[111],pe},ts=p.memo(es),ss=t=>{"use forget";const e=Ye.c(9),{clientThreadId:s,focusedObject:r,onClose:n}=t,i=Z(),o=ke(i);let a,l;e[0]===Symbol.for("react.memo_cache_sentinel")?(a={scale:.98},l={scale:1},e[0]=a,e[1]=l):(a=e[0],l=e[1]);const c=o?S:be;let d;e[2]!==s||e[3]!==r||e[4]!==n?(d=u.jsx(st,{isFullScreen:!0,clientThreadId:s,focusedObject:r,onClose:n}),e[2]=s,e[3]=r,e[4]=n,e[5]=d):d=e[5];let f;return e[6]!==c||e[7]!==d?(f=u.jsx(Tt,{open:!0,className:"fixed inset-0 z-50 h-full w-full",children:u.jsx(I.div,{className:"z-40 h-full w-full overflow-hidden shadow-xl md:border-gray-100 md:dark:border-gray-700",initial:a,animate:l,transition:c,children:d})}),e[6]=c,e[7]=d,e[8]=f):f=e[8],f},ns=({clientThreadId:t,overrideWidth:e,isAutoFocusDisabled:s=!1})=>{const r=Z(),n=Pt(),i=tt(e),o=ke(r);Jt({clientThreadId:t,isDisabled:s,disabledTypes:o?[Xe.Canmore]:[]}),qt(),Bt(t);const a=p.useRef(!1);p.useEffect(()=>{a.current?Qe():a.current=!0},[t]);const l=n&&(i?u.jsx(ts,{clientThreadId:t,onClose:$e,focusedObject:n},"canvas-sidebar"):u.jsx(ss,{clientThreadId:t,onClose:$e,focusedObject:n},"canvas-modal"));p.useEffect(()=>{if(n)return qe(d=>Yt(d,n)),()=>qe(null)},[n]);const c=l!=null;return p.useEffect(()=>(ze.setActiveStageSidebar(c),()=>{c&&ze.setActiveStageSidebar(!1)}),[c]),o?l:u.jsx(gt,{children:l},t)},en=t=>{const e=p.useRef(null);return u.jsx(Ct,{ref:e,onError:(s,r)=>{Qe(),setTimeout(()=>{var n;(n=e.current)==null||n.resetErrorBoundary()}),jt.logError("Error boundary hit",s,{componentStack:r})},name:"canmore-focused-view",children:u.jsx(ns,Oe({},t))})};function os(t){const{rect:e}=t;return e}export{en as CanvasFocusedViewManager};
//# sourceMappingURL=mspnxrdz24xb25t6.js.map
