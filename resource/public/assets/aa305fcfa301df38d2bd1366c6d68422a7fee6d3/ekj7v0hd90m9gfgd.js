var S=Object.defineProperty,E=Object.defineProperties;var b=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var C=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var p=(e,s,t)=>s in e?S(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t,T=(e,s)=>{for(var t in s||(s={}))C.call(s,t)&&p(e,t,s[t]);if(x)for(var t of x(s))D.call(s,t)&&p(e,t,s[t]);return e},v=(e,s)=>E(e,b(s));var B=(e,s)=>{var t={};for(var a in e)C.call(e,a)&&s.indexOf(a)<0&&(t[a]=e[a]);if(e!=null&&x)for(var a of x(e))s.indexOf(a)<0&&D.call(e,a)&&(t[a]=e[a]);return t};import{r as u,j as m,R as k}from"./bubexfvksfr7893o.js";import{fi as w,fj as I,fk as U,fl as F,fm as h,fn as _,ab as L,fo as V}from"./lm3g1zm00rp6al39.js";import{jb as q,aa as O,V as X,O as $,M as z}from"./ncw8zw682jinppua.js";import{T as j}from"./hzasobp3hhjtq47p.js";function G(e){var M;const y=e,{bufferType:s,isActivelyStreaming:t,messages:a,parts:n}=y,g=B(y,["bufferType","isActivelyStreaming","messages","parts"]),c=a[a.length-1].id,[f,d]=u.useState(w(n)),r=u.useRef(void 0),l=q(),i=u.useMemo(()=>l?n.flatMap(o=>{if(typeof o=="string")return o;if(o.content_type==="audio_transcription")return o.text}).filter(o=>o!==void 0):n,[n,l]);if(r.current===void 0)switch(s){case"Adaptive":r.current=new F(i,d,t);break;case"ChunkedCatchup":r.current=new U(i,d,t);break;case"Punctuation":r.current=new I(i,d,t);break}return u.useEffect(()=>{r.current!=null&&(r.current.onMessagePartsUpdated(i,t),r.current.isBuffering()&&h.addDelayedRenderingMessage(c))},[i,c,t]),u.useEffect(()=>{r.current!=null&&r.current.removeDelayedRender()&&h.removeDelayedRenderingMessage(c)},[f,c]),u.useEffect(()=>()=>h.removeDelayedRenderingMessage(c),[c]),u.useEffect(()=>()=>{var o;(o=r.current)==null||o.destroy(),r.current=void 0},[]),m.jsx(j,v(T({},g),{messages:a,parts:n,displayParts:f,isActivelyStreaming:t||!!((M=r.current)!=null&&M.isBuffering())}))}function H({message:e,isCompletionInProgress:s,hasActiveRequest:t,conversation:a,className:n,isUserTurn:g,isFinalUserTurn:c,isWithinFirstAssistantTurns:f,turnIndex:d,isFeedbackEnabled:r,prevGroupedMessageType:l,prevGroupedMessages:i,citableMessages:y,superWidgetContent:M}){var P,A,R;const o=u.useMemo(()=>"parts"in e.content?e.content.parts:[O(e)],[e]);return m.jsxs(m.Fragment,{children:[m.jsx(J,{parts:o,messages:[e],hasActiveRequest:t,isCompletionInProgress:s,className:n,citations:(P=e.metadata)==null?void 0:P.citations,contentReferences:(A=e.metadata)==null?void 0:A.content_references,attachments:(R=e.metadata)==null?void 0:R.attachments,isUserTurn:g,isFinalUserTurn:c,isWithinFirstAssistantTurns:f,turnIndex:d,id:e.id,isFeedbackEnabled:r,conversation:a,prevGroupedMessageType:l,prevGroupedMessages:i,citableMessages:y,superWidgetContent:M}),!1]})}const Z=k.memo(H);function J(e){const s=e.messages.length>1,t=X.isLastActorMessage($(e.conversation.id),e.messages[0].id),a=z(e.conversation.id,i=>!!(i!=null&&i.sharedConversationMetadata)),n=s?void 0:_(e.messages[0],t,e.isCompletionInProgress||e.hasActiveRequest,a),g=(n==null?void 0:n.flagSeverity)!=="danger"&&e.isCompletionInProgress,c=!e.parts.some(i=>i!==""),{bufferType:f,wordFadeType:d}=L(),[r,l]=u.useState(()=>d!=="indexed"&&f!=="none"&&!e.isUserTurn&&(e.isCompletionInProgress||c&&!n));return n&&r&&l(!1),r?m.jsx(G,v(T({},e),{bufferType:f,isActivelyStreaming:g,errorState:n})):m.jsx(j,v(T({},e),{displayParts:V({isUserTurn:e.isUserTurn,parts:e.parts}),isActivelyStreaming:g,errorState:n}))}export{Z as T,J as a};
//# sourceMappingURL=ekj7v0hd90m9gfgd.js.map
