const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/lm3g1zm00rp6al39.js","assets/bubexfvksfr7893o.js","assets/ncw8zw682jinppua.js","assets/root-ookb7xuw.css","assets/conversation-small-lq38g8zw.css","assets/d0fvtivu8wtjjx2a.js","assets/czfk2xng6iz6p6m1.js","assets/e68769z3zqptou6p.js","assets/md2l6f10v5dz6n2x.js","assets/kinq8ogeluwcfocr.js","assets/iiiqhumf0mlwee70.js","assets/d7rf00yyrkajwypi.js","assets/bfa9q91ghkspe9kl.js","assets/jr0cukcida2c2i9p.js","assets/owxeao8xeacovj6t.js","assets/ocdola9tzyjuwbxy.js","assets/impv9cw906sxjwad.js","assets/l90ske1z87mx6a7v.js","assets/h6662v3to5g8p21c.js","assets/jxyz1kdkcze5jtww.js","assets/g1dbzw9xahth2rh2.js"])))=>i.map(i=>d[i]);
var Xe=Object.defineProperty,Ye=Object.defineProperties;var Ke=Object.getOwnPropertyDescriptors;var Ee=Object.getOwnPropertySymbols;var Je=Object.prototype.hasOwnProperty,Qe=Object.prototype.propertyIsEnumerable;var Ce=(t,a)=>(a=Symbol[t])?a:Symbol.for("Symbol."+t);var _e=(t,a,s)=>a in t?Xe(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,U=(t,a)=>{for(var s in a||(a={}))Je.call(a,s)&&_e(t,s,a[s]);if(Ee)for(var s of Ee(a))Qe.call(a,s)&&_e(t,s,a[s]);return t},$=(t,a)=>Ye(t,Ke(a));var pe=(t,a,s)=>(a=t[Ce("asyncIterator")])?a.call(t):(t=t[Ce("iterator")](),a={},s=(n,r)=>(r=t[n])&&(a[n]=o=>new Promise((i,m,f)=>(o=r.call(t,o),f=o.done,Promise.resolve(o.value).then(h=>i({value:h,done:f}),m)))),s("next"),s("return"),a);import{h as N,j as e,M as u,r as c,_ as E,b as Ze,e as Ie,a as et,l as tt}from"./bubexfvksfr7893o.js";import{az as C,aB as q,aA as _,dU as st,aC as Le,cz as Fe,cr as ie,k2 as Oe,aZ as at,D as nt,b7 as De,dS as rt,dC as ot,du as it,dv as lt,p as ct,cn as mt,dl as dt,fk as ut}from"./ncw8zw682jinppua.js";import{R as ft,u as ht,A as pt,a as gt,N as xt,I as vt,b as bt}from"./baz0q256ww4uq6xs.js";import{u as wt}from"./opgbrqj637eoxt1g.js";import{x as ae,J as S,n3 as jt,lQ as yt,e0 as Pe,aY as St,d_ as Ae}from"./lm3g1zm00rp6al39.js";import{F as W}from"./nxpg01wwuofkn1k1.js";import{W as We,h as Mt}from"./o0dw43fppqvaf7ws.js";import{S as Be}from"./boj7ctg8ggfk4dia.js";import{A as ve}from"./ha3yj3u2f1w16goy.js";import{i as qe}from"./e5q3f3k67x71csb7.js";import{u as kt}from"./m214aojas5i8u5ss.js";import{u as Nt}from"./cwx3lrtca3zesjiz.js";import{b as Et}from"./lptwpbjabrvjmhsj.js";import{u as Ct}from"./gtzjihtnvt59spmg.js";import{u as _t,a as At,b as F}from"./drp7x5ntnuk0iqtu.js";function Vt({onChange:t,value:a}){const s=N();return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("p",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(u,{id:"wham.createEnvironments.descriptionSection.label",defaultMessage:"Description"})}),e.jsx("textarea",{name:"description","aria-label":s.formatMessage({id:"wham.environment.descriptionSection.description",defaultMessage:"Environment Description"}),placeholder:s.formatMessage({id:"wham.environment.descriptionSection.descriptionPlaceholder",defaultMessage:"1-2 sentence description"}),className:"border-token-border-heavy focus-within:border-token-border-heavy focus-within:ring-token-text-secondary bg-token-bg-primary h-16 max-h-48 w-full resize-none rounded-md border px-3 py-2 text-sm shadow-none focus-within:ring-1",value:a,onChange:n=>t(n.target.value)})]})}function Tt({repositoryId:t,existingEnvironment:a,setRepositoryName:s}){var r;const n=(r=a.repo_map)==null?void 0:r[t];return c.useEffect(()=>{n&&s(n.name)},[n,s]),n?e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("p",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(u,{id:"wham.createEnvironments.repositorySection.label",defaultMessage:"Repository"})}),e.jsx("div",{className:"border-token-border-heavy bg-token-bg-primary pointer-events-none rounded-lg border p-3",children:e.jsx(ft,{repository:n,className:"pointer-events-none p-1",isSelected:!0})})]}):e.jsx("div",{className:"text-token-text-secondary flex h-full items-center text-sm",children:e.jsx(u,{id:"wham.createEnvironments.repositorySection.unavailable",defaultMessage:"Repository unavailable"})})}function ze(t,a,s,n,r){const o=t.clipboardData.getData("text/plain"),i=Lt(o);if(i.length!==0){t.preventDefault(),s(a,r(i[0]));for(const m of i.slice(1))n(r(m))}}function Rt(t,a,s,n){ze(t,a,s,n,r=>r)}function It(t,a,s,n){ze(t,a,s,n,r=>$(U({},r),{isEditing:!1}))}function Lt(t){const a=[];for(let s of t.split(/\r?\n/)){if(s=s.trim(),!s||s.startsWith("#")||s.startsWith(";"))continue;s.startsWith("export ")&&(s=s.slice(7).trim());let n=!1,r=!1,o=!1,i=-1;for(let g=0;g<s.length;g++){const d=s[g];if(o){o=!1;continue}if(d==="\\"){o=!0;continue}if(d==="'"&&!r){n=!n;continue}if(d==='"'&&!n){r=!r;continue}if(d==="#"&&!n&&!r){i=g;break}}if(i!==-1&&(s=s.slice(0,i).trim()),!s)continue;n=r=o=!1;let m=-1;for(let g=0;g<s.length;g++){const d=s[g];if(o){o=!1;continue}if(d==="\\"){o=!0;continue}if(d==="'"&&!r){n=!n;continue}if(d==='"'&&!n){r=!r;continue}if(d==="="&&!n&&!r){m=g;break}}if(m===-1)continue;const f=s.slice(0,m).trim();if(!f)continue;let h=s.slice(m+1).trim();(h.startsWith('"')&&h.endsWith('"')||h.startsWith("'")&&h.endsWith("'"))&&(h=h.slice(1,-1)),a.push({key:f,value:h})}return a}const Ft=C(()=>E(()=>import("./lm3g1zm00rp6al39.js").then(t=>t.zp),__vite__mapDeps([0,1,2,3,4])),{loading:t=>_(t)});function Ot({pushValue:t,removeValue:a,changeValue:s,values:n}){const r=N();return e.jsxs("div",{className:"mb-2 flex flex-col",children:[e.jsx("p",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(u,{id:"wham.createEnvironments.envVarsSection.label",defaultMessage:"Environment variables"})}),n.map((o,i)=>o.key.startsWith("CODEX_ENV_")?null:e.jsx("div",{className:"flex gap-2 pt-4",children:e.jsx("div",{className:"flex w-full flex-1 flex-col gap-2",children:e.jsxs("div",{className:"flex w-full items-center gap-2",children:[e.jsx(ae,{name:"envVars[".concat(i,"].key"),color:"search",containerInputClassName:"w-full",className:"text-token-text-primary flex h-8 w-full items-center rounded-md!",value:o.key,onPaste:m=>Rt(m,i,s,t),onChange:m=>{s(i,$(U({},o),{key:m.target.value}))},placeholder:r.formatMessage({id:"wham.envVarsSection.keyPlaceholder",defaultMessage:"Key"}),ariaLabel:r.formatMessage({id:"wham.envVarsSection.keyAria",defaultMessage:"Environment variable key"})}),e.jsx(ae,{name:"envVars[".concat(i,"].value"),className:"text-token-text-primary flex h-8 w-full items-center rounded-md!",containerInputClassName:"w-full",color:"search",value:o.value,onChange:m=>{s(i,$(U({},o),{value:m.target.value}))},placeholder:r.formatMessage({id:"wham.envVarsSection.value",defaultMessage:"Value"}),ariaLabel:r.formatMessage({id:"wham.envVarsSection.environmentVariableValue",defaultMessage:"Environment variable value"})}),e.jsx(q,{type:"button",size:"small",color:"secondary",onClick:()=>a(i),"aria-label":r.formatMessage({id:"wham.createEnvironments.envVarsSection.deleteAriaLabel",defaultMessage:"Button to remove environment variable"}),children:e.jsx(u,{id:"wham.createEnvironments.envVarsSection.delete",defaultMessage:"Delete"})})]})})},i)),e.jsx("div",{className:"pt-2",children:e.jsx(q,{color:"secondary",size:"small",onClick:()=>{t({key:"",value:""})},type:"button",className:"w-fit","aria-label":r.formatMessage({id:"wham.createEnvironments.envVarsSection.addAriaLabel",defaultMessage:"Button to add another environment variable"}),children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(u,{id:"wham.createEnvironments.envVarsSection.add",defaultMessage:"Add"}),e.jsx(Ft,{className:"icon-sm"})]})})})]})}const Dt=c.memo(Ot);function Pt({value:t=[],onChange:a,onBlur:s,disabled:n}){const r=N(),o=c.useMemo(()=>t==null?void 0:t.join("\n"),[t]);return e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("p",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(u,{id:"wham.createEnvironment.shareTargets.label",defaultMessage:"Add additional editors"})}),e.jsx("p",{className:"text-token-text-tertiary text-xs",children:e.jsx(u,{id:"wham.createEnvironment.shareTargets.helper",defaultMessage:"Add one email per line. Users will be able to edit or delete this environment, or add and remove editors. The environment creator, and ChatGPT Workspace Admins, always have edit access."})})]}),e.jsx("textarea",{name:"shareTargets","aria-label":r.formatMessage({id:"wham.createEnvironment.shareTargets.ariaLabel",defaultMessage:"Environment share target emails"}),placeholder:r.formatMessage({id:"wham.createEnvironment.shareTargets.placeholder",defaultMessage:"user@example.com"}),className:"border-token-border-heavy focus-within:border-token-border-heavy focus-within:ring-token-text-secondary bg-token-bg-primary h-20 resize-y rounded-md border px-3 py-2 text-sm shadow-none focus-within:ring-1",value:o,onChange:i=>{a(i.target.value.split(/\r?\n/))},onBlur:s,disabled:n})]})}const Wt=C(()=>E(()=>import("./d0fvtivu8wtjjx2a.js"),__vite__mapDeps([5,1])),{loading:t=>_(t)}),Bt=C(()=>E(()=>import("./czfk2xng6iz6p6m1.js"),__vite__mapDeps([6,1])),{loading:t=>_(t)});function qt({value:t,onChange:a}){const s=N(),n=st(),r=n==null?void 0:n.name,o=r!=null?r:s.formatMessage({id:"wham.createEnvironment.workspaceName",defaultMessage:"Workspace"});return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("p",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(u,{id:"wham.createEnvironment.environmentVisibility",defaultMessage:"Sharing"})}),e.jsxs(S.Root,{value:t,onValueChange:a,children:[e.jsx(S.Trigger,{className:"border-token-border-heavy bg-token-bg-primary flex w-fit rounded-md border","aria-label":s.formatMessage({id:"wham.createEnvironment.openVisibilityMenu",defaultMessage:"Open sharing menu"}),children:e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx("div",{className:"flex items-center",children:e.jsx(S.Value,{placeholder:s.formatMessage({id:"wham.createEnvironment.selectVisibility",defaultMessage:"Select visibility"})})}),e.jsx(S.Icon,{})]})}),e.jsx(S.Portal,{children:e.jsxs(S.Content,{align:"start",children:[e.jsx(S.Item,{value:"private",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Wt,{"aria-hidden":!0,className:"icon-sm me-1.5"}),e.jsx(u,{id:"wham.createEnvironment.private",defaultMessage:"Only you"})]})}),e.jsx(S.Item,{value:"workspace",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Bt,{"aria-hidden":!0,className:"icon-sm me-1.5"}),e.jsx(u,{id:"wham.createEnvironment.sharedWithWorkspace",defaultMessage:"Shared with {workspaceName}",values:{workspaceName:o}})]})})]})})]}),t==="workspace"&&e.jsx("p",{className:"text-token-text-tertiary text-xs",children:e.jsx(u,{id:"wham.createEnvironments.workspace.onlyYouCanEdit",defaultMessage:"Workspace members can launch tasks with this environment. Only you, ChatGPT Workspace Admins, and any additional editors can make changes."})})]})}const zt=c.memo(qt);function Ht({onChange:t,value:a}){const s=N();return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("p",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(u,{id:"wham.createEnvironments.label",defaultMessage:"Name"})}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx(ae,{name:"label",ariaLabel:s.formatMessage({id:"wham.labelSection.envAria",defaultMessage:"Environment name"}),placeholder:s.formatMessage({id:"wham.labelSection.namePlaceholder",defaultMessage:"Name"}),containerInputClassName:"w-full",className:"flex h-8 w-full items-center rounded-md!",inputClassName:"w-full text-sm",color:"search",value:a,onChange:n=>t(n.target.value)})})]})}const Ut=c.memo(Ht),$t=C(()=>E(()=>import("./e68769z3zqptou6p.js"),__vite__mapDeps([7,1])),{loading:t=>_(t)}),Gt=C(()=>E(()=>import("./md2l6f10v5dz6n2x.js"),__vite__mapDeps([8,1])),{loading:t=>_(t)}),Xt=C(()=>E(()=>import("./kinq8ogeluwcfocr.js"),__vite__mapDeps([9,1])),{loading:t=>_(t)}),Yt=C(()=>E(()=>import("./iiiqhumf0mlwee70.js"),__vite__mapDeps([10,1])),{loading:t=>_(t)}),Kt=C(()=>E(()=>import("./d7rf00yyrkajwypi.js"),__vite__mapDeps([11,1])),{loading:t=>_(t)}),Jt=C(()=>E(()=>import("./bfa9q91ghkspe9kl.js"),__vite__mapDeps([12,1])),{loading:t=>_(t)}),Qt=C(()=>E(()=>import("./jr0cukcida2c2i9p.js"),__vite__mapDeps([13,1])),{loading:t=>_(t)}),Zt=C(()=>E(()=>import("./owxeao8xeacovj6t.js"),__vite__mapDeps([14,1])),{loading:t=>_(t)}),es=C(()=>E(()=>import("./ocdola9tzyjuwbxy.js"),__vite__mapDeps([15,1])),{loading:t=>_(t)}),He=[{key:"python",icon:Yt,label:"Python",envVar:"CODEX_ENV_PYTHON_VERSION",versions:["3.14","3.13","3.12","3.11","3.10"],defaultVersion:"3.12"},{key:"nodejs",icon:Jt,label:"Node.js",envVar:"CODEX_ENV_NODE_VERSION",versions:["22","20","18"],defaultVersion:"20"},{key:"ruby",icon:Xt,label:"Ruby",envVar:"CODEX_ENV_RUBY_VERSION",versions:["3.2.3","3.3.8","3.4.4"],defaultVersion:"3.4.4"},{key:"rust",icon:Gt,label:"Rust",envVar:"CODEX_ENV_RUST_VERSION",versions:["1.89.0","1.88.0","1.87.0","1.86.0","1.85.1","1.84.1","1.83.0"],defaultVersion:"1.89.0"},{key:"go",icon:Zt,label:"Go",envVar:"CODEX_ENV_GO_VERSION",versions:["1.25.1","1.24.3","1.23.8","1.22.12"],defaultVersion:"1.24.3"},{key:"bun",icon:es,label:"Bun",envVar:"CODEX_ENV_BUN_VERSION",versions:["1.2.14"],defaultVersion:"1.2.14"},{key:"php",icon:Kt,label:"PHP",envVar:"CODEX_ENV_PHP_VERSION",versions:["8.4","8.3","8.2"],defaultVersion:"8.4"},{key:"java",icon:Qt,label:"Java",envVar:"CODEX_ENV_JAVA_VERSION",versions:["21"],defaultVersion:"21"},{key:"swift",icon:$t,label:"Swift",envVar:"CODEX_ENV_SWIFT_VERSION",versions:["6.2","6.1","5.10"],defaultVersion:"6.1"}],ea=He.map(t=>({key:t.envVar,value:t.defaultVersion}));function ts({selectedVersion:t,setSelectedVersion:a,versions:s,defaultVersion:n}){const r=N();return e.jsxs(S.Root,{value:t!=null?t:"",onValueChange:a,children:[e.jsx(S.Trigger,{className:"border-token-border-default bg-token-bg-primary! w-48 rounded-md! border","aria-label":r.formatMessage({id:"wham.createEnvironments.languageSelector.openVersionMenu",defaultMessage:"Open version menu"}),children:e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx(S.Value,{placeholder:r.formatMessage({id:"wham.createEnvironments.languageSelector.selectVersion",defaultMessage:"Select version"})}),e.jsx(S.Icon,{})]})}),e.jsx(S.Portal,{children:e.jsxs(S.Content,{align:"start",children:[s.map(o=>e.jsx(S.Item,{value:o,children:e.jsx("p",{className:Fe("text-token-text-primary text-sm",o===n?"font-semibold":"font-normal"),children:o})},o)),s.length===1&&e.jsx("div",{className:"flex w-full items-center justify-center p-4",children:e.jsx("p",{className:"text-token-text-primary text-sm",children:r.formatMessage({id:"wham.createEnvironments.languageSelector.noVersions",defaultMessage:"No other versions available"})})})]})})]})}function ss({icon:t,language:a,versions:s,defaultVersion:n,selectedVersion:r,setSelectedVersion:o}){return e.jsxs("div",{className:"flex items-center justify-between gap-2 pe-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t,{className:"icon"}),e.jsx("p",{className:"text-token-text-primary text-sm font-medium",children:a})]}),e.jsx(ts,{defaultVersion:n,selectedVersion:r,setSelectedVersion:o,versions:s})]})}function as(t,a){var r,o;const s=t.split(".").map(Number),n=a.split(".").map(Number);for(let i=0;i<Math.max(s.length,n.length);i++){const m=(r=s[i])!=null?r:0,f=(o=n[i])!=null?o:0;if(m!==f)return f-m}return 0}function ns({onClose:t,envVars:a,pushValue:s,replaceValue:n}){const r=o=>i=>{const m=a.findIndex(f=>f.key===o);m!==-1?n(m,$(U({},a[m]),{value:i})):s({key:o,value:i})};return e.jsx(Le,{isOpen:!0,onClose:t,type:"success",testId:"modal-language-selector-modal",showCloseButton:!0,className:"max-w-screen-xs",title:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(u,{id:"wham.languageModal.languageSelector.title",defaultMessage:"Preinstalled packages"}),e.jsx("p",{className:"text-token-text-secondary text-sm font-normal",children:e.jsx(u,{id:"wham.languageModal.languageSelector.description",defaultMessage:"Configure your own packages in the setup script."})})]}),children:e.jsx("div",{className:"flex flex-col gap-4",children:He.map(o=>{var f;const i=[...o.versions],m=(f=a.find(h=>h.key===o.envVar))==null?void 0:f.value;return m&&!i.includes(m)&&i.push(m),i.sort(as),e.jsx(ss,{icon:o.icon,language:o.label,versions:i,selectedVersion:m!=null?m:o.defaultVersion,defaultVersion:o.defaultVersion,setSelectedVersion:h=>r(o.envVar)(h)},o.envVar)})})})}const oe=64,ge=512,rs="<REDACTED>",Ve=[{id:"wham-public/wham-universal",label:"universal"}];function os({selectedMachineId:t,setSelectedMachineId:a}){const s=N(),{data:n}=Ze({queryKey:["wham","machines"],queryFn:()=>We.getMachines()}),r=c.useMemo(()=>{const i=Array.isArray(n)?n:[],m=new Set(Ve.map(h=>h.id));return[...i.filter(h=>!m.has(h.id)),...Ve]},[n]);c.useEffect(()=>{!t&&r.length&&a(r[0].id)},[t,a,r]);const o=i=>{a(i)};return e.jsxs(S.Root,{value:t!=null?t:"",onValueChange:o,children:[e.jsx(S.Trigger,{className:"border-token-border-default! bg-token-bg-primary! w-48 rounded-md! border","aria-label":s.formatMessage({id:"wham.machineSelectorPopover.openMachineMenu",defaultMessage:"Open machine menu"}),children:e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx(S.Value,{placeholder:s.formatMessage({id:"wham.machineSelectorPopover.selectMachine",defaultMessage:"Select machine"})}),e.jsx(S.Icon,{})]})}),e.jsx(S.Portal,{children:e.jsx(S.Content,{align:"start",className:"bg-token-bg-primary",children:e.jsx(is,{machines:r})})})]})}function is({machines:t}){return e.jsxs("div",{className:"bg-token-bg-primary flex max-h-[400px] w-full flex-col gap-2 overflow-y-auto rounded-lg p-2",children:[t.length>0?t.map(a=>e.jsx(S.Item,{value:a.id,children:a.label},a.id)):e.jsx("div",{className:"p-2 text-center",children:e.jsx("p",{className:"text-token-text-secondary text-sm",children:e.jsx(u,{id:"wham.createEnvironments.machineSelector.noMatchesFound",defaultMessage:"No matches found"})})}),t.length===1&&e.jsx("div",{className:"p-2 text-start",children:e.jsx("p",{className:"text-token-text-tertiary ps-2 text-xs",children:e.jsx(u,{id:"wham.createEnvironments.machineSelector.noMachinesFound",defaultMessage:"Custom images coming soon"})})})]})}const ls=C(()=>E(()=>import("./impv9cw906sxjwad.js"),__vite__mapDeps([16,1])),{loading:t=>_(t)});function cs({selectedMachineId:t,setSelectedMachineId:a,envVars:s,pushValue:n,replaceValue:r}){const o=N(),[i,m]=c.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("p",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(u,{id:"wham.createEnvironments.machineSelector",defaultMessage:"Container image"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(os,{selectedMachineId:t,setSelectedMachineId:a}),e.jsx(q,{color:"secondary",size:"medium",type:"button",icon:ls,onClick:()=>{m(!0)},"aria-label":o.formatMessage({id:"wham.createEnvironments.languageSelector.titleAriaLabel",defaultMessage:"Button to open preinstalled packages modal"}),className:"w-fit",children:e.jsx("p",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(u,{id:"wham.createEnvironments.languageSelector.title",defaultMessage:"Preinstalled packages"})})})]})]}),i&&e.jsx(ns,{onClose:()=>m(!1),envVars:s,pushValue:n,replaceValue:r})]})}const ms=c.memo(cs),me=Ie({toggleOffLabel:{id:"wham.postSetupCaching.off",defaultMessage:"Off"},toggleOnLabel:{id:"wham.postSetupCaching.on",defaultMessage:"On"},toggleOffAriaLabel:{id:"wham.postSetupCaching.offAriaLabel",defaultMessage:"Toggle to turn off post setup caching"},toggleOnAriaLabel:{id:"wham.postSetupCaching.onAriaLabel",defaultMessage:"Toggle to turn on post setup caching"}});function ds({cacheSettings:t,onChange:a}){const s=N();return e.jsxs("div",{className:"mb-2 flex flex-col gap-2",children:[e.jsx("p",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(u,{id:"wham.postSetupCaching.title",defaultMessage:"Container Caching"})}),e.jsx("p",{className:"text-token-text-tertiary mb-1 text-xs",children:e.jsx(u,{id:"wham.postSetupCaching.description",defaultMessage:"Speed up container start by caching state after running the setup script. Maintenance scripts are run before every task."})}),e.jsx(Be,{className:"max-w-32",ariaLabel:s.formatMessage({id:"wham.postSetupCachingToggle.label",defaultMessage:"Container Caching"}),value:t!=null&&t.post_setup_cache_enabled?"on":"off",onChange:n=>a({post_setup_cache_enabled:n==="on"}),leftItem:{ariaLabel:s.formatMessage(me.toggleOffAriaLabel),label:s.formatMessage(me.toggleOffLabel),value:"off"},rightItem:{ariaLabel:s.formatMessage(me.toggleOnAriaLabel),label:s.formatMessage(me.toggleOnLabel),value:"on"}})]})}const us=c.memo(ds),fs=C(()=>E(()=>import("./lm3g1zm00rp6al39.js").then(t=>t.zp),__vite__mapDeps([0,1,2,3,4])),{loading:t=>_(t)});function hs({value:t,index:a,pushValue:s,changeValue:n,removeValue:r}){const o=N();return e.jsx("div",{className:"flex gap-2 pt-4",children:e.jsx("div",{className:"flex w-full flex-1 flex-col gap-2",children:e.jsxs("div",{className:"flex w-full items-center gap-2",children:[e.jsx(ae,{name:"secrets[".concat(a,"].key"),color:"search",containerInputClassName:"w-full",className:"text-token-text-primary flex h-8 w-full items-center rounded-md!",value:t.key,onPaste:i=>It(i,a,n,s),onChange:i=>{n(a,$(U({},t),{key:i.target.value}))},placeholder:o.formatMessage({id:"wham.secretsSection.keyPlaceholder",defaultMessage:"Key"}),ariaLabel:o.formatMessage({id:"wham.secretsSection.keyAria",defaultMessage:"Secret Key"})}),e.jsx(ae,{name:"secrets[".concat(a,"].value"),className:"text-token-text-primary flex h-8 w-full items-center rounded-md!",containerInputClassName:"w-full",color:"search",type:"password",value:t.value,onChange:i=>{n(a,$(U({},t),{value:i.target.value}))},placeholder:o.formatMessage({id:"wham.secretsSection.value",defaultMessage:"Value"}),ariaLabel:o.formatMessage({id:"wham.secretsSection.secretValue",defaultMessage:"Secret Value"})}),e.jsx(q,{type:"button",size:"small",color:"secondary",onClick:()=>r(a),"aria-label":o.formatMessage({id:"wham.createEnvironments.secretsSection.deleteAriaLabel",defaultMessage:"Button to remove secret"}),children:e.jsx(u,{id:"wham.createEnvironments.secretsSection.delete",defaultMessage:"Delete"})})]})})})}function ps({pushValue:t,removeValue:a,changeValue:s,values:n}){const r=N();return e.jsxs("div",{className:"mb-2 flex flex-col",children:[e.jsx("p",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(u,{id:"wham.createEnvironments.secretsSection",defaultMessage:"Secrets"})}),n.map((o,i)=>e.jsx(hs,{value:o,index:i,pushValue:t,changeValue:s,removeValue:a},i)),e.jsx("div",{className:"pt-2",children:e.jsx(q,{color:"secondary",size:"small",onClick:()=>{t({key:"",value:"",isEditing:!1})},type:"button",className:"w-fit","aria-label":r.formatMessage({id:"wham.createEnvironments.secretsSection.addAriaLabel",defaultMessage:"Button to add another secret"}),children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(u,{id:"wham.createEnvironments.secretsSection.add",defaultMessage:"Add"}),e.jsx(fs,{className:"icon-sm"})]})})})]})}const gs=c.memo(ps),xs="# e.g.\npip install -r requirements.txt\nnpm install\n./run/maintenance_setup.sh\n";function vs({script:t,onChange:a}){const s=N(),n=Math.min(10,Math.max(4,t.split("\n").length));return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("p",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(u,{id:"wham.createEnvironments.maintenanceSetupCommandsSection",defaultMessage:"Maintenance script"})})}),e.jsx("div",{className:"flex items-center gap-2 pt-2",children:e.jsx("textarea",{name:"setupCommands",className:"border-token-border-default focus-within:border-token-border-heavy focus-within:ring-token-text-secondary bg-token-bg-primary min-h-32 w-full resize-y rounded-md border px-3 py-2 font-mono text-xs shadow-none focus-within:ring-1",value:t,rows:n,onChange:r=>{a(r.target.value)},placeholder:xs,"aria-label":s.formatMessage({id:"wham.maintenanceSetupCommandsSection.maintenanceSetupCommand",defaultMessage:"Maintenance Setup Command"})})}),e.jsx("p",{className:"text-token-text-tertiary pt-2 text-xs",children:e.jsx(u,{id:"wham.createEnvironments.maintenanceSetupCommandsSection.description",defaultMessage:"The maintenance script is run in containers that were resumed from the cache, after checking out the branch.{br}<strong>Network access is always enabled for this step.</strong>",values:{br:e.jsx("br",{}),strong:r=>e.jsx("span",{className:"font-semibold",children:r})}})})]})}const bs=c.memo(vs),Te=C(()=>E(()=>import("./lm3g1zm00rp6al39.js").then(t=>t.zp),__vite__mapDeps([0,1,2,3,4])),{loading:t=>_(t)}),ws="# e.g.\npip install -r requirements.txt\nnpm install\n./run/setup.sh\n",de=Ie({toggleAutomaticLabel:{id:"wham.autoSetup.automatic",defaultMessage:"Automatic"},toggleManualLabel:{id:"wham.autoSetup.manual",defaultMessage:"Manual"},toggleAutomaticAriaLabel:{id:"wham.autoSetup.automaticAriaLabel",defaultMessage:"Toggle to turn on automatic setup"},toggleManualAriaLabel:{id:"wham.autoSetup.manualAriaLabel",defaultMessage:"Toggle to turn on auto setup"}});function js({value:t,onChangeAutoSetupSettings:a}){const s=N();return e.jsx(Be,{className:"max-w-64",ariaLabel:s.formatMessage({id:"wham.autoSetup.label",defaultMessage:"Auto setup"}),value:t?"on":"off",onChange:n=>{a(n==="off"?{use_auto_setup:!0}:{use_auto_setup:!1})},leftItem:{ariaLabel:s.formatMessage(de.toggleAutomaticAriaLabel),label:s.formatMessage(de.toggleAutomaticLabel),value:"off"},rightItem:{ariaLabel:s.formatMessage(de.toggleManualAriaLabel),label:s.formatMessage(de.toggleManualLabel),value:"on"}})}function ys({setupScript:t,maintenanceScript:a,onSetupScriptChange:s,onMaintenanceScriptChange:n,setupScriptChildren:r,maintenanceScriptChildren:o,onClickAppendReplHistory:i,inputRef:m,replCommandHistory:f,suggestedCommand:h,onClickAcceptSuggestedCommand:g,autoSetupSettings:d,onChangeAutoSetupSettings:M,postSetupCacheEnabled:V}){var w;const v=N(),O=t===""&&d==null,I=(w=d==null?void 0:d.use_auto_setup)!=null?w:O;return e.jsxs("div",{className:"mb-2 flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(u,{id:"wham.createEnvironments.setupCommandsSection",defaultMessage:"Setup script"})}),!I&&e.jsx(e.Fragment,{children:h?e.jsx(ie,{className:"-my-2.5 block",label:v.formatMessage({id:"wham.createEnv.terminal.addCommandSuggestion",defaultMessage:"Add suggestion to setup script"}),children:e.jsx(q,{type:"button",color:"secondary",size:"small",onClick:g,icon:Te,children:e.jsx("span",{className:"max-w-[200px] truncate font-mono text-xs",children:h.trimEnd().replace("\n","; ")})})}):f.length>0?e.jsx(ie,{className:"-my-2.5 block",label:v.formatMessage({id:"wham.createEnv.terminal.addCommands",defaultMessage:"Add commands you've run to the setup script"}),children:e.jsx(q,{type:"button",color:"secondary",size:"small",onClick:i,icon:Te,children:e.jsx(u,{id:"wham.createEnvironments.terminalSection.addToSetupScript",defaultMessage:"New commands ({count})",values:{count:f.length}})})}):null})]}),e.jsx(js,{value:!I,onChangeAutoSetupSettings:M}),I&&e.jsx("p",{className:"text-token-text-tertiary mb-1 text-xs",children:e.jsx(u,{id:"wham.autoSetup.description",defaultMessage:"Runs the install commands like npm install for common package managers. <docs>Learn more.</docs>",values:{docs:y=>e.jsx("a",{href:"https://platform.openai.com/docs/codex/overview#setup-scripts",target:"_blank",rel:"noopener noreferrer",className:"underline",children:y})}})}),!I&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center gap-2 pt-2",children:e.jsx("textarea",{ref:m,name:"setupCommands",className:"border-token-border-default focus-within:border-token-border-heavy focus-within:ring-token-text-secondary bg-token-bg-primary min-h-32 w-full resize-y rounded-md border px-3 py-2 font-mono text-xs shadow-none focus-within:ring-1",value:t,rows:Math.min(10,Math.max(4,t.split("\n").length)),onChange:y=>{s(y.target.value)},placeholder:ws,"aria-label":v.formatMessage({id:"wham.setupCommandsSection.setupCommand",defaultMessage:"Setup Command"})})}),e.jsx("p",{className:"text-token-text-tertiary pt-2 text-xs",children:V?e.jsx(u,{id:"wham.createEnvironments.setupCommandsSection.withCachingDescription",defaultMessage:"The setup script is run after creating new containers, after the repo is cloned.{br}<strong>Network access is always enabled for this step.</strong>",values:{br:e.jsx("br",{}),strong:y=>e.jsx("span",{className:"font-semibold",children:y})}}):e.jsx(u,{id:"wham.createEnvironments.setupCommandsSection.description",defaultMessage:"The setup script is run at the start of every task, after the repo is cloned.{br}<strong>Network access is always enabled for this step.</strong>",values:{br:e.jsx("br",{}),strong:y=>e.jsx("span",{className:"font-semibold",children:y})}})}),r]}),V&&!I&&e.jsxs(e.Fragment,{children:[e.jsx(bs,{script:a,onChange:n}),o]})]})}const Ss=c.memo(ys);function Ms(t,a){const s={};for(const{key:n,value:r}of t){const o=a[n];o===void 0?r!==""&&(s[n]=r):r!==rs&&r!==o&&(s[n]=r)}for(const n of Object.keys(a))t.some(r=>r.key===n)||(s[n]=null);return s}function ks({onSuggestCommand:t}){const a=N(),[s,n]=c.useState([]),[r,o]=c.useState(null),[i,m]=c.useState(!1),[f,h]=c.useState(null),g=c.useRef(null),d=c.useCallback(async v=>{try{try{for(var O=pe(v),I,w,y;I=!(w=await O.next()).done;I=!1){const T=w.value;const j=Ue(T);if(!j)continue;const x=j.type;switch(x){case"client_error":case"server_error":o(j.message);break;case"log":{if(j.key==="heartbeat")break;if(j.key==="suggest_command")t(j.line);else if(j.key.startsWith("userscript_")){const[,A]=j.key.split("_"),R=Number(A);if(!Number.isFinite(R))return;j.line.startsWith("+ ")?n(k=>[...k,{messageType:"user",line:j.line.slice(2),scriptIndex:R}]):n(k=>[...k,{messageType:"output",line:j.line,scriptIndex:R}])}else j.line.startsWith("+ ")?n(A=>[...A,{messageType:"server",line:j.line.slice(2)}]):n(A=>[...A,{messageType:"output",line:j.line}]);break}case"test_session_started":h(j.test_session_id);break;default:Oe(x)}}}catch(w){y=[w]}finally{try{I&&(w=O.return)&&await w.call(O)}finally{if(y)throw y[0]}}}catch(T){if(qe(T))return;if(T instanceof at&&T.status===429){o(a.formatMessage({id:"wham.useStreamTestEnv.errorRateLimited",defaultMessage:"Too many requests: Your environment didn't start because we're at capacity. Try again soon."}));return}o(a.formatMessage({id:"wham.useStreamTestEnv.errorConnecting",defaultMessage:"Error connecting to the test environment"}))}finally{m(!1)}},[a,t]),M=async(v,O,I={})=>{g.current=new AbortController,n([]),m(!0),o(null),h(null);const y="".concat(window.location.origin+"/backend-api","/wham/environments/test"),T=Ms(v.secrets,I),j=v.envVars.reduce((k,D)=>(k[D.key]=D.value,k),{}),x=await jt("codex_environment_test").catch(k=>{nt.addError(k)}),A=U($(U({},De({isAuthOptional:!1})),{"Content-Type":"application/json"}),yt(null,null,null,x)),R=Pe(y,{method:"POST",body:{environment_id:O,machine_id:v.machine,repos:[v.repositoryId],setup:[v.setupCommands],maintenance_setup:[v.maintenanceSetupCommands],workspace_dir:v.workspaceDirectory,agent_network_access:v.agentNetworkAccess,secrets:T,env_vars:j,auto_setup_settings:v.autoSetupSettings},signal:g.current.signal,headers:A,observer:{onClose:(k,D)=>{m(!1),k==="error"&&D instanceof Error&&o(D.message)}}});(async()=>await d(R))()},V=c.useCallback(()=>{var v;(v=g.current)==null||v.abort(),n(O=>[...O,{messageType:"output",line:"Test cancelled"}])},[]);return c.useEffect(()=>()=>{var v;(v=g.current)==null||v.abort()},[]),{messages:s,error:r,setError:o,isStreaming:i,startTestEnvironment:M,abortTestEnvironment:V,testSessionId:f,setTestSessionId:h}}function Ue(t){return!("data"in t)||!t.data?null:t.data}function Ns({testSessionId:t,replOutput:a,inputRef:s,setReplOutput:n,setError:r,onSetConnected:o,onSubmitCommand:i}){const m=N(),[f,h]=c.useState(""),g=c.useCallback(({command:w})=>{t&&We.runEnvironmentTestCommand({command:w,testSessionId:t})},[t]),d=c.useCallback(async w=>{try{try{for(var y=pe(w),T,j,x;T=!(j=await y.next()).done;T=!1){const A=j.value;const R=Ue(A);if(!R)continue;const k=R.type;switch(k){case"client_error":case"server_error":r(R.message);break;case"log":{const G=As(R.line).replace(/\x1b\].*?\x07/g,"").replace(/\x1b\[\?2004[hl]/g,"");n(ee=>[...ee,G]);break}case"test_session_started":break;default:Oe(k)}}}catch(j){x=[j]}finally{try{T&&(j=y.return)&&await j.call(y)}finally{if(x)throw x[0]}}}catch(A){if(qe(A))return;r(m.formatMessage({id:"wham.envTestRepl.error",defaultMessage:"Error connecting to the test environment"}))}},[m,r,n]),{connected:M}=Cs({testSessionId:t,processStream:d,setError:r});c.useEffect(()=>{o(M)},[M,o,n]),c.useEffect(()=>{t||n([])},[t,n]);const V=c.useRef(null),v=a.map((w,y)=>e.jsx(ve,{children:w.replace(/\x1b\].*?\x07/g,"")},y)),[O,I]=c.useState(!1);return t?e.jsxs("div",{className:"flex w-full flex-col whitespace-pre",children:[v,e.jsxs("div",{className:"relative w-full p-0 text-[12px] leading-4 focus:ring-0",children:[e.jsxs("span",{"aria-hidden":!0,className:"flex min-h-4 min-w-2",children:[f,e.jsx("span",{className:"inline-block h-auto w-2",children:O?e.jsx("div",{className:"bg-token-text-primary h-full w-full"}):e.jsx(rt.div,{className:"bg-token-text-primary h-full w-full",animate:{opacity:[0,1,0]},transition:{type:"tween",ease:"easeInOut",duration:2,repeat:1/0}})})]}),e.jsx("input",{type:"text",className:"absolute h-[1px] w-[1px] opacity-0",disabled:!M,onChange:w=>h(w.target.value),onFocus:()=>I(!0),onBlur:()=>I(!1),onKeyDown:w=>{const y=Es(w);if(y){w.preventDefault(),h(""),g({command:y});return}if(w.key==="Enter"){w.preventDefault(),h("");const T=f+"\n";i(T),g({command:T})}},value:f,ref:St(s,V)})]})]}):null}function Es(t){return t.ctrlKey?t.key==="c"?"":t.key==="d"?"":null:null}function Cs({testSessionId:t,processStream:a,setError:s}){const[n,r]=c.useState(!1),o=c.useCallback(i=>{const f="".concat(window.location.origin+"/backend-api","/wham/environments/test/").concat(t,"/stream"),h=Pe(f,{method:"POST",signal:i.signal,headers:$(U({},De({isAuthOptional:!1})),{"Content-Type":"application/json"}),observer:{onOpen:()=>{r(!0)},onClose:(g,d)=>{r(!1),g==="error"&&d instanceof Error&&s(d.message)}}});(async()=>await a(h))()},[t,a,s]);return c.useEffect(()=>{if(!t)return;const i=new AbortController;return o(i),()=>{i.abort()}},[t,o]),{connected:n}}const _s=new TextDecoder("utf-8");function As(t){const a=atob(t),s=a.length,n=new Uint8Array(s);for(let r=0;r<s;r+=1)n[r]=a.charCodeAt(r);return _s.decode(n)}const Vs=C(()=>E(()=>import("./l90ske1z87mx6a7v.js"),__vite__mapDeps([17,1])),{loading:t=>_(t)}),Ts=C(()=>E(()=>import("./h6662v3to5g8p21c.js"),__vite__mapDeps([18,1])),{loading:t=>_(t)}),Rs=C(()=>E(()=>import("./jxyz1kdkcze5jtww.js"),__vite__mapDeps([19,1])),{loading:t=>_(t)});function Is({formValues:t,initialSecrets:a,environmentId:s,onConnectedChange:n,onSubmitCommand:r,onSuggestCommand:o}){const i=N(),{messages:m,error:f,setError:h,abortTestEnvironment:g,isStreaming:d,startTestEnvironment:M,testSessionId:V,setTestSessionId:v}=ks({onSuggestCommand:o}),[O,I]=c.useState([]),w=c.useRef(null),y=c.useRef(null),[T,j]=c.useState(!1);c.useEffect(()=>{j(!0)},[t]);const[x,A]=c.useState(!0);c.useEffect(()=>{if(w.current&&y.current&&x){const b=w.current,L=y.current;L.scrollTop=b.offsetTop-L.offsetTop-L.clientHeight/2+b.clientHeight/2}},[m,O,x]);const R=()=>{const b=y.current;if(!b)return;const L=Math.abs(b.scrollTop+b.clientHeight-b.scrollHeight)<2;A(L)},[k,D]=c.useState(!1),[G,ee]=c.useState(!1),le=()=>{D(!0),j(!1),v(null),M(t,s,a)},ue=b=>{ee(b),n(b)};c.useEffect(()=>()=>n(!1),[]);const X=c.useRef(null),J=!G&&!d,z=!J&&T,Q=J&&!k||z,Z=!t.repositoryId,[Y,ne]=c.useState(!1),te=e.jsx("div",{className:"absolute inset-0 z-10 flex flex-col items-center justify-center bg-white/20 dark:bg-white/5",onMouseUp:b=>b.stopPropagation(),onClick:async()=>{z&&(j(!1),ne(!0),await new Promise(b=>setTimeout(b,3e3)),ne(!1))},children:e.jsx(ie,{open:Z||z?void 0:!1,label:Z?i.formatMessage({id:"wham.createEnv.terminal.selectRepo",defaultMessage:"Please select a repository"}):z?i.formatMessage({id:"wham.createEnv.terminal.restartTooltip",defaultMessage:"Changes will only be reflected after a restart."}):void 0,children:e.jsx(q,{onClick:le,disabled:!t.repositoryId,type:"button",color:"primary-inverse",icon:Rs,children:z?e.jsx(u,{id:"wham.createEnvironments.terminalSection.reRunSetupScript",defaultMessage:"Re-run setup script"}):e.jsx(u,{id:"wham.createEnvironments.terminalSection.runSetupScript",defaultMessage:"Connect interactive terminal"})})})}),[{height:se},H]=kt();return e.jsxs("div",{onMouseUp:b=>{var L,K;(L=document.getSelection())!=null&&L.toString()||((K=X.current)==null||K.focus(),b.preventDefault())},className:"dark focus-within:ring-primary relative flex h-full w-full flex-col overflow-hidden rounded-xl ring-offset-2 focus-within:ring-2",children:[e.jsxs("div",{ref:H,className:"bg-token-bg-tertiary flex shrink-0 flex-row justify-between p-4",children:[e.jsx("div",{className:"text-sm font-semibold text-white",children:e.jsx(u,{id:"wham.createEnvironments.terminalSection",defaultMessage:"Terminal"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[(G||!!f||k&&!d)&&e.jsx(ie,{className:"flex",open:Y?!0:void 0,label:i.formatMessage({id:"wham.createEnvironments.terminalSection.restartSessionTooltip",defaultMessage:"Restart terminal session"}),children:e.jsx(Ae,{icon:e.jsx(Ts,{className:"icon-sm"}),className:"-m-1 h-6! w-6!",onClick:le,onMouseEnter:()=>ne(!1),label:i.formatMessage({id:"wham.createEnvironments.terminalSection.restartSession",defaultMessage:"Restart session"})})}),d&&e.jsx(ie,{className:"flex",open:Y?!0:void 0,label:i.formatMessage({id:"wham.createEnvironments.terminalSection.cancelSessionTooltip",defaultMessage:"Cancel terminal session"}),children:e.jsx(Ae,{icon:e.jsx(Vs,{className:"icon-sm"}),className:"-m-1 h-6! w-6!",onClick:g,label:i.formatMessage({id:"wham.createEnvironments.terminalSection.cancelSession",defaultMessage:"Cancel session"})})}),G?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-white",children:e.jsx(u,{id:"wham.createEnvironments.terminalSection.connected",defaultMessage:"Connected"})}),e.jsx(xe,{color:"#52EA00"})]}):d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-white",children:e.jsx(u,{id:"wham.createEnvironments.terminalSection.initializing",defaultMessage:"Initializing"})}),e.jsx(xe,{color:"#FF9800"})]}):k?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-white",children:e.jsx(u,{id:"wham.createEnvironments.terminalSection.disconnected",defaultMessage:"Disconnected"})}),e.jsx(xe,{color:"#FF0000"})]}):null]})]}),f&&e.jsxs("div",{style:{top:se},className:"bg-token-bg-status-error text-token-text-status-error absolute start-0 end-0 top-0 z-20 flex flex-col gap-2 px-4 py-3 text-sm",children:[e.jsx("p",{className:"font-medium",children:e.jsx(u,{id:"wham.createEnvironments.terminalSection.error",defaultMessage:"Terminal errored"})}),e.jsx("p",{className:"font-mono text-xs",children:f})]}),Q&&te,e.jsxs("div",{className:"bg-token-bg-secondary relative flex flex-1 flex-col overflow-y-auto p-4 font-mono text-xs text-white",onScroll:R,ref:y,children:[m.length===0&&!d&&e.jsx("p",{className:"text-token-text-tertiary",children:"".concat(t.workspaceDirectory," $")}),m.map((b,L)=>b.messageType==="user"?e.jsx(ve,{className:"text-token-text-tertiary",children:"â†’ "+b.line},L):b.messageType==="server"?e.jsx("p",{className:"text-token-text-tertiary",children:b.line}):e.jsx(ve,{children:b.line},L)),e.jsx(Ns,{inputRef:X,testSessionId:V,replOutput:O,setReplOutput:I,setError:h,onSetConnected:ue,onSubmitCommand:r}),e.jsx("div",{ref:w})]})]})}function xe({color:t}){return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"6",height:"6",viewBox:"0 0 6 6",fill:"none",className:"animate-pulse",children:e.jsx("circle",{cx:"3",cy:"3",r:"3",fill:t})})}function Ls({workspaceDirectory:t,repositoryName:a,onChange:s,onClose:n,errors:r}){const o=N(),[i,m]=c.useState(t),[f]=c.useState(t!=null?t:"/workspace"),h=o.formatMessage({id:"wham.createEnvironments.workspaceEditorModal.defaultRepositoryName",defaultMessage:"repository"}),g=o.formatMessage({id:"wham.editWorkspace.modal.title",defaultMessage:"Edit workspace"}),d=({forceClear:M}={})=>{(r.length>0||M)&&s(f),n()};return e.jsxs(Le,{isOpen:!0,onClose:()=>d(),type:"success",testId:"modal-workspace-editor-modal",children:[e.jsxs(ot,{children:[e.jsx(it,{children:g}),e.jsx(lt,{children:g})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"text-token-text-primary text-xl font-medium",children:e.jsx(u,{id:"wham.createEnvironments.workspaceEditorModal.title",defaultMessage:"Edit workspace directory"})}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx(ae,{name:"workspaceDirectory",value:i,onChange:M=>{m(M.target.value),s(M.target.value)},inputClassName:"w-full",containerInputClassName:"w-full",color:"quaternary",ariaLabel:o.formatMessage({id:"wham.createEnvironments.workspaceEditorModal.inputAriaLabel",defaultMessage:"Workspace directory"})})}),r.length>0&&e.jsx("div",{className:"flex flex-col gap-2",children:r.map(M=>e.jsx("div",{className:"text-token-text-status-error text-xs",children:M},M))}),e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(u,{id:"wham.createEnvironments.workspaceEditorModal.description",defaultMessage:"The repository will be cloned to {workspaceDirectory}/{repositoryName}. You only need to adjust this if your code requires an absolute install path.",values:{repositoryName:a!=null?a:h,workspaceDirectory:t!=null?t:f}})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(q,{color:"secondary",onClick:()=>d({forceClear:!0}),children:e.jsx(u,{id:"wham.createEnvironments.workspaceEditorModal.cancelButton",defaultMessage:"Cancel"})}),e.jsx(q,{onClick:()=>n(),disabled:r.length>0,children:e.jsx(u,{id:"wham.createEnvironments.workspaceEditorModal.saveButton",defaultMessage:"Save"})})]})]})]})}const Fs=c.memo(Ls),Os=C(()=>E(()=>import("./g1dbzw9xahth2rh2.js"),__vite__mapDeps([20,1])),{loading:t=>_(t)});function Re({current:t,max:a,className:s}){return e.jsx("span",{className:"text-xs ".concat(t>a?"text-token-text-status-error":"text-token-text-tertiary"," ").concat(s!=null?s:"").trim(),children:e.jsx(u,{id:"wham.characterCount.display",defaultMessage:"{current}/{max}",values:{current:t,max:a}})})}function ta({initialEnvironmentId:t,initialValues:a,primaryButtonText:s,onSubmit:n,isPending:r,existingEnvironment:o}){var we,je,ye,Se,Me,ke,Ne;const[i,m]=c.useState(null),[f,h]=c.useState(null),{data:g}=Mt(),d=N(),M=ct(),V=c.useRef(null),[v,O]=c.useState(!1),I=wt(),w=Nt(),[y,T]=c.useState(null),j=et(),x=_t({defaultValues:a,validators:{onSubmit:({value:l})=>{var B,re;l.machine||(l.machine=a.machine);const p={};if(l.label.trim()||(p.label=d.formatMessage({id:"wham.environmentsForm.labelIsRequired",defaultMessage:"Label is required"})),l.label.length>oe&&(p.label=d.formatMessage({id:"wham.environmentsForm.labelMaxChars",defaultMessage:"Label must be at most {max} characters"},{max:oe})),g!=null&&g.find(P=>P.label===l.label&&P.id!==t)&&(p.label=d.formatMessage({id:"wham.environmentsForm.labelAlreadyExistsInYourAccountPleaseChooseAnotherName",defaultMessage:"An environment with this name already exists. Try choosing another name."})),l.repositoryId.trim()||(p.repositoryId=d.formatMessage({id:"wham.environmentsForm.repositoryRequired",defaultMessage:"Repository is required"})),l.machine.trim()||(p.machine=d.formatMessage({id:"wham.environmentsForm.machineRequired",defaultMessage:"Machine is required"})),l.description&&l.description.length>ge&&(p.description=d.formatMessage({id:"wham.environmentsForm.descriptionMaxChars",defaultMessage:"Description must be at most {max} characters"},{max:ge})),l.secrets.some(P=>P.value===""||P.key==="")&&(p.secrets=d.formatMessage({id:"wham.environmentsForm.secretRequired",defaultMessage:"Secret value is required"})),w){const P=((B=l.share_targets)!=null?B:[]).map(Ge=>Ge.trim()).filter(Boolean);l.share_targets=P,P.length>0&&l.share_settings==="private"&&(p.share_targets=d.formatMessage({id:"wham.environmentsForm.shareTargetsRequiresVisibility",defaultMessage:"Share targets require workspace or public visibility."}))}else delete l.share_targets;return l.envVars.some(P=>P.key===""||P.value==="")&&(p.envVars=d.formatMessage({id:"wham.environmentsForm.valueRequired",defaultMessage:"Environment variable value is required"})),l.secrets.some(P=>P.isEditing)&&(p.secrets=d.formatMessage({id:"wham.environmentsForm.editingSecrets",defaultMessage:"Secrets are being edited"})),((re=l.agentNetworkAccess)==null?void 0:re.mode)==="on"&&l.agentNetworkAccess.preset_allowlist===Et&&(!l.agentNetworkAccess.allowlist_domains||l.agentNetworkAccess.allowlist_domains.length===0)&&(p.agentNetworkAccess=d.formatMessage({id:"wham.environmentsForm.agentNetworkAccessAllowlistRequired",defaultMessage:"At least one domain is required"})),Object.keys(p).length>0&&M.danger(tt({id:"wham.environmentsForm.validationError",defaultMessage:"Please address the validation issues in the form."}),{toastId:"wham_environments_form_validation_error"}),{fields:p}}},onSubmit:({value:l})=>{n(l)}}),A=At(x.store,l=>l.isDirty),[R,k]=c.useState(!1),[D,G]=c.useState([]),ee=c.useRef(null),le=Ct(ee);c.useEffect(()=>!A&&!R&&!D.length?void 0:mt(window,{beforeunload:p=>{p.preventDefault(),p.returnValue=d.formatMessage({id:"wham.environmentsForm.unsavedChanges",defaultMessage:"You have unsaved changes to your environment. Are you sure you want to leave?"})}}),[d,A,R,D]),c.useEffect(()=>{j.hash==="#setup-script"&&setTimeout(()=>{V.current&&(V.current.scrollIntoView({behavior:"smooth",block:"center"}),V.current.focus())},0)},[j.hash]);const ue=l=>{l.preventDefault(),l.stopPropagation(),x.handleSubmit()},X=F({name:"label",form:x,validators:{onChange:({value:l})=>{if(l.length>oe)return d.formatMessage({id:"wham.environmentsForm.labelMaxChars",defaultMessage:"Label must be at most {max} characters"},{max:oe});if(g!=null&&g.find(p=>p.label===l&&p.id!==t))return d.formatMessage({id:"wham.environmentsForm.labelAlreadyExistsInYourAccountPleaseChooseAnotherName",defaultMessage:"An environment with this name already exists. Try choosing another name."})}}}),J=F({name:"repositoryId",form:x}),z=F({name:"description",form:x}),Q=F({name:"secrets",form:x,mode:"array"}),Z=F({name:"share_settings",form:x}),Y=F({name:"share_targets",form:x,mode:"array"}),ne=l=>{Z.handleChange(l),w&&l==="private"&&Y.handleChange([])},te=F({name:"agentNetworkAccess",form:x}),se=F({name:"cacheSettings",form:x}),H=F({name:"envVars",form:x,mode:"array"}),b=F({name:"machine",form:x}),L=F({name:"autoSetupSettings",form:x}),K=F({name:"setupCommands",form:x,mode:"array"}),fe=F({name:"maintenanceSetupCommands",form:x,mode:"array"}),ce=F({name:"workspaceDirectory",form:x,validators:{onChange:({value:l})=>{if(l)if(l.includes("/")){if(l==="/")return d.formatMessage({id:"wham.environmentsForm.workspaceDirectoryCannotBeRoot",defaultMessage:"Workspace directory cannot be root"})}else return d.formatMessage({id:"wham.environmentsForm.workspaceDirectoryMustContainASlash",defaultMessage:"Workspace directory must contain a slash"});else return d.formatMessage({id:"wham.environmentsForm.workspaceDirectoryRequired",defaultMessage:"Workspace directory is required"})}}}),be=dt(),$e=!!be&&ut(be),he=ht();return e.jsx("form",{ref:ee,onSubmit:ue,className:Fe("mx-auto flex min-h-0 w-full grow flex-col items-center overflow-y-auto px-8",le&&"border-t"),children:e.jsxs("div",{className:"flex w-full max-w-screen-2xl flex-col",children:[e.jsxs("div",{className:"flex flex-col overflow-clip rounded-xl border bg-[#F7F7F7] dark:bg-[#1E1E1E]",children:[e.jsx("div",{className:"bg-token-bg-primary w-full border-b p-4 text-xl font-medium",children:e.jsx(u,{id:"wham.environmentsForm.basic",defaultMessage:"Basic"})}),e.jsxs("div",{className:"flex w-full flex-col p-4 md:max-w-[50%]",children:[!o&&e.jsx(pt,{className:"mb-4",selectedInstallationId:(we=i==null?void 0:i.id)!=null?we:null,setSelectedInstallation:m}),o?e.jsx(Tt,{repositoryId:J.state.value,existingEnvironment:o,setRepositoryName:h}):e.jsx(gt,{selectedRepository:J.state.value,onSelect:(l,p,B)=>{J.handleChange(l),X.handleChange(p),h(B)},installationId:(je=i==null?void 0:i.id)!=null?je:null,installationAccountLogin:(ye=i==null?void 0:i.account_login)!=null?ye:null,installationAccountType:(Se=i==null?void 0:i.account_type)!=null?Se:null}),e.jsx(W,{className:"mb-4",field:J}),e.jsx(Ut,{onChange:X.handleChange,value:X.state.value}),e.jsxs("div",{className:"flex flex-row justify-between pt-1",children:[e.jsx(W,{field:X}),e.jsx(Re,{current:X.state.value.length,max:oe})]}),e.jsx(Vt,{onChange:z.handleChange,value:z.state.value}),e.jsxs("div",{className:"flex flex-row justify-between pt-1",children:[I&&e.jsx("p",{className:"text-token-text-tertiary text-xs",children:e.jsx(u,{id:"wham.createEnvironments.descriptionSection.description",defaultMessage:"Explain to members of your organization what this environment is for."})}),e.jsx(Re,{current:z.state.value.length,max:ge})]}),e.jsx(W,{className:"mb-4",field:z}),w&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx(zt,{value:Z.state.value,onChange:ne}),e.jsx(W,{field:Z}),Z.state.value!=="private"&&e.jsxs(e.Fragment,{children:[e.jsx(Pt,{value:Y.state.value,onChange:Y.handleChange,onBlur:Y.handleBlur}),e.jsx(W,{className:"mb-4",field:Y})]})]})]}),e.jsxs("div",{className:"bg-token-bg-primary flex w-full items-baseline justify-between gap-1.5 border-y p-4",children:[e.jsxs("div",{className:"flex items-baseline gap-1.5",children:[e.jsx("span",{className:"shrink-0 text-xl font-medium",children:e.jsx(u,{id:"wham.environmentsForm.advanced",defaultMessage:"Code execution"})}),e.jsx("span",{className:"text-token-text-tertiary text-xs",children:e.jsx(u,{id:"wham.environmentsForm.advancedSubtitle",defaultMessage:"Set up dependencies, lint, and tests."})})]}),e.jsx("a",{href:"https://platform.openai.com/docs/codex/overview#environment-configuration",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 py-2 ps-2 hover:underline","aria-label":d.formatMessage({id:"wham.environmentsForm.learnMoreAriaLabel",defaultMessage:"Link to learn more about code execution"}),children:e.jsxs("div",{className:"text-token-text-tertiary flex items-center gap-1 text-xs",children:[e.jsx(Os,{className:"icon-sm"}),e.jsx(u,{id:"wham.environmentsForm.learnMore",defaultMessage:"Learn more"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2",children:[e.jsxs("div",{className:"flex flex-col p-4",children:[e.jsx(ms,{selectedMachineId:b.state.value,setSelectedMachineId:l=>b.handleChange(l),envVars:H.state.value,pushValue:H.pushValue,replaceValue:H.replaceValue}),e.jsx(W,{className:"mb-1",field:b}),e.jsxs("p",{className:"text-token-text-tertiary mb-4 text-xs",children:[e.jsx(u,{id:"wham.createEnvironments.machineSelector.description",defaultMessage:"Universal is an image based on Ubuntu 24.04 - see <dockerfile>openai/codex-universal</dockerfile> to learn more. {br} The repository will be cloned to {workspaceDirectory}/{repo_name}. <EditWorkspace>Edit workspace directory.</EditWorkspace>",values:{br:e.jsx("br",{}),repo_name:f!=null?f:"",workspaceDirectory:(Me=ce.state.value)!=null?Me:"/workspace",dockerfile:l=>e.jsx("a",{href:"https://github.com/openai/codex-universal",target:"_blank",rel:"noopener noreferrer",className:"underline",children:l}),EditWorkspace:l=>e.jsx("button",{className:"underline",type:"button",onClick:()=>{O(!0)},children:l})}}),v&&e.jsx(Fs,{onChange:l=>ce.handleChange(l),repositoryName:f,workspaceDirectory:ce.state.value,errors:ce.state.meta.errors.filter(l=>!!l),onClose:()=>O(!1)})]}),e.jsx(Dt,{pushValue:H.pushValue,removeValue:H.removeValue,changeValue:H.replaceValue,values:H.state.value}),e.jsx(W,{className:"mb-4",field:H}),e.jsx(gs,{pushValue:Q.pushValue,removeValue:Q.removeValue,changeValue:Q.replaceValue,values:Q.state.value}),e.jsx(W,{className:"mb-4",field:Q}),e.jsx(us,{cacheSettings:se.state.value,onChange:se.handleChange}),e.jsx(W,{className:"mb-4",field:se}),e.jsx(Ss,{onClickAppendReplHistory:()=>{const l=d.formatMessage({id:"wham.createEnv.terminal.recentCommands",defaultMessage:"Recent commands"}),p=K.state.value,B="".concat(p?"\n\n":"","# ").concat(l,":\n")+D.join("");x.setFieldValue("setupCommands",p+B),G([]),setTimeout(()=>{if(V.current){const re=V.current;re.scrollTop=re.scrollHeight}},1)},replCommandHistory:D,suggestedCommand:y,onClickAcceptSuggestedCommand:()=>{y&&x.setFieldValue("setupCommands",K.state.value+y),T(null)},setupScript:K.state.value,onSetupScriptChange:K.handleChange,maintenanceScript:fe.state.value,onMaintenanceScriptChange:fe.handleChange,setupScriptChildren:e.jsx(W,{className:"mb-4",field:K}),maintenanceScriptChildren:e.jsx(W,{className:"mb-4",field:fe}),inputRef:V,autoSetupSettings:L.state.value,onChangeAutoSetupSettings:L.handleChange,postSetupCacheEnabled:!!((ke=se.state.value)!=null&&ke.post_setup_cache_enabled)}),he!=null&&e.jsxs(e.Fragment,{children:[e.jsx(xt,{disabledByWorkspaceSettings:he,agentNetworkAccess:te.state.value,onChange:te.handleChange}),e.jsx(W,{className:"mb-4",field:te}),$e&&e.jsx(vt,{className:"mb-4"}),!he&&((Ne=te.state.value)==null?void 0:Ne.mode)==="on"&&e.jsx(bt,{className:"mb-4"})]})]}),e.jsx("div",{className:"flex h-[650px] p-3",children:e.jsx(x.Subscribe,{selector:l=>l.values,children:l=>e.jsx(Is,{formValues:l,environmentId:t,onConnectedChange:k,initialSecrets:a.secrets.reduce((p,B)=>(p[B.key]=B.value,p),{}),onSuggestCommand:p=>{T(p)},onSubmitCommand:p=>{p.trim()&&G(B=>[...B,p])}})})})]})]}),e.jsx("div",{className:"mb-12 flex w-full items-end pt-4",children:e.jsx(x.Subscribe,{selector:l=>l.values,children:l=>e.jsx(q,{color:"primary",size:"medium",type:"button",className:"ms-auto",loading:r,disabled:!l.repositoryId,onClick:p=>{p.preventDefault(),p.stopPropagation(),x.handleSubmit()},children:s})})})]})})}export{ea as D,ta as E,Ve as P,rs as R,Ms as g};
//# sourceMappingURL=div6rw9ctuec3dis.js.map
