const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/paev76b70tpkjsm5.js","assets/bubexfvksfr7893o.js"])))=>i.map(i=>d[i]);
var V=Object.defineProperty,Y=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var B=(e,n,r)=>n in e?V(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r,l=(e,n)=>{for(var r in n||(n={}))L.call(n,r)&&B(e,r,n[r]);if(x)for(var r of x(n))R.call(n,r)&&B(e,r,n[r]);return e},k=(e,n)=>Y(e,J(n));var h=(e,n)=>{var r={};for(var c in e)L.call(e,c)&&n.indexOf(c)<0&&(r[c]=e[c]);if(e!=null&&x)for(var c of x(e))n.indexOf(c)<0&&R.call(e,c)&&(r[c]=e[c]);return r};import{h as F,r as p,j as t,M as u,_ as X,b as E,u as j,i as D}from"./bubexfvksfr7893o.js";import{bz as Z,nr as $,a_ as f,bn as H,mk as G,bl as ee,bm as te}from"./lm3g1zm00rp6al39.js";import{aB as v,R as m,p as ne,az as re,aA as se,aC as ce,cz as ae,e7 as ie}from"./ncw8zw682jinppua.js";import{m as i}from"./kahypn4d3cgul321.js";function oe({setEnabled:e,isLoading:n,isEnabled:r}){const c=F(),[a,s]=p.useState(!1),d=()=>{s(!0)},o=y=>{s(!1),y&&e(!1)};return t.jsx("div",{className:"pt-1.5",children:r?t.jsxs(t.Fragment,{children:[t.jsx(v,{disabled:n,color:"danger",onClick:()=>{n||d()},children:t.jsx(u,l({},i.deleteDirectorySyncConnectionButton))}),t.jsx(Z,{title:c.formatMessage(i.deleteDirectorySyncConnectionModalHeader),description:c.formatMessage(i.deleteDirectorySyncConnectionModalExplanation),confirmText:c.formatMessage(i.deleteDirectorySyncConnectionModalConfirmButton),cancelText:c.formatMessage(i.deleteDirectorySyncConnectionModalCancelButton),isOpen:a,primaryButtonColor:"danger",onClose:()=>o(!1),onConfirm:()=>o(!0)})]}):t.jsx(t.Fragment,{children:t.jsx(v,{disabled:n,color:"primary",onClick:()=>{n||e(!0)},children:t.jsx(u,l({},i.enableDirectorySyncButton))})})})}class S{static async getWorkspaceDirectorySyncSettings(n){return m.safeGet("/accounts/{account_id}/scim",{parameters:{path:{account_id:n}}})}static async setWorkspaceDirectorySyncEnabled(n,r){return m.safePost("/accounts/{account_id}/scim/set_enabled",{parameters:{path:{account_id:n}},requestBody:{enabled:r}})}static async setWorkspaceDirectorySyncEmailInvitesEnabled(n,r){return m.safePost("/accounts/{account_id}/scim/set_email_invites_enabled",{parameters:{path:{account_id:n}},requestBody:{enabled:r}})}static async getWorkspaceDirectorySyncPortalUrl(n){return m.safeGet("/accounts/{account_id}/scim/portal_link",{parameters:{path:{account_id:n}}})}static async getWorkspaceDirectorySyncFailedEvents(n){return m.safeGet("/accounts/{account_id}/scim/failed_events",{parameters:{path:{account_id:n}}})}static async retryWorkspaceDirectorySyncFailedEvent(n,r){return m.safePost("/accounts/{account_id}/scim/failed_events/{event_id}/retry",{parameters:{path:{account_id:n,event_id:r}}})}static async retryAllWorkspaceDirectorySyncFailedEvents(n){return m.safePost("/accounts/{account_id}/scim/failed_events/retry_all",{parameters:{path:{account_id:n}}})}static async discardWorkspaceDirectorySyncFailedEvent(n,r){return m.safeDelete("/accounts/{account_id}/scim/failed_events/{event_id}",{parameters:{path:{account_id:n,event_id:r}}})}static async getWorkspaceDirectorySyncProgressUsers(n){return m.safeGet("/accounts/{account_id}/scim/sync_progress_users",{parameters:{path:{account_id:n}}})}static async getWorkspaceDirectorySyncProgressGroups(n){return m.safeGet("/accounts/{account_id}/scim/sync_progress_groups",{parameters:{path:{account_id:n}}})}}const le=re(()=>X(()=>import("./paev76b70tpkjsm5.js"),__vite__mapDeps([0,1])),{loading:e=>se(e)});function de({isLoading:e,workspaceId:n,isDirectoryConnectionConfigured:r}){const[c,a]=p.useState(!1),s=ne(),d=F(),o=async()=>{try{a(!0);const y=await S.getWorkspaceDirectorySyncPortalUrl(n);a(!1),y!=null&&y.portal_link?window.open(y.portal_link,"_blank"):s.danger(d.formatMessage({id:"directorySync.portalLinkNotFound",defaultMessage:"Portal link not found."}),{toastId:"directory_sync_management_portal_button",loggingTitle:"Portal link not found.",loggingDescription:"Error message shown when directory sync portal link is missing"})}catch(y){y instanceof Error?s.danger(y.message,{toastId:"directory_sync_management_portal_button",loggingTitle:y.message,loggingDescription:"Generic error message for unexpected failures when opening the directory sync portal"}):s.danger(d.formatMessage({id:"directorySync.unexpectedError",defaultMessage:"An unexpected error occurred."}),{toastId:"directory_sync_management_portal_button",loggingTitle:"An unexpected error occurred.",loggingDescription:"Generic error message for unexpected failures when opening the directory sync portal"})}};return t.jsxs(v,{disabled:e||c,color:"secondary",className:"mt-3",onClick:o,children:[r?t.jsx(u,l({},i.launchDirectorySyncManagementPortalText)):t.jsx(u,l({},i.launchDirectorySyncSetupPortalText)),t.jsx(le,{className:"icon-sm ms-1"})]})}function U(e){switch(e){case"dsync.user.created":return i.directorySyncEventTypeUserCreated;case"dsync.user.updated":return i.directorySyncEventTypeUserUpdated;case"dsync.user.deleted":return i.directorySyncEventTypeUserDeleted;case"dsync.group.created":return i.directorySyncEventTypeGroupCreated;case"dsync.group.updated":return i.directorySyncEventTypeGroupUpdated;case"dsync.group.deleted":return i.directorySyncEventTypeGroupDeleted;case"dsync.group.user_added":return i.directorySyncEventTypeGroupUserAdded;case"dsync.group.user_removed":return i.directorySyncEventTypeGroupUserRemoved;case"dsync.activated":return i.directorySyncEventTypeActivated;case"dsync.deleted":return i.directorySyncEventTypeDeleted;case"dsync.deactivated":return i.directorySyncEventTypeDeleted}}function ue({isLoading:e,failedEvents:n,retryEventWithId:r,retryAllFailedEvents:c,discardFailedEventWithId:a}){const[s,d]=p.useState(!1),[o,y]=p.useState(),C=F();return t.jsxs(t.Fragment,{children:[o&&t.jsx(ce,{testId:"modal-directory-sync-failed-events",isOpen:s,onClose:d,title:C.formatMessage(U(o.event.event)),description:o.failure_reason,type:"success",showCloseButton:!0,isScrollable:!0,children:t.jsx("pre",{children:JSON.stringify(o.event,null,2)})}),n.length>0&&t.jsxs(t.Fragment,{children:[t.jsxs($,{className:"flex items-center space-x-4",children:[t.jsx(u,l({},i.failedDirectorySyncEventsTableHeader)),t.jsx(v,{disabled:e,color:"secondary",size:"small",className:"ms-auto",onClick:()=>{c()},children:t.jsx(u,l({},i.retryAllFailedDirectorySyncEventsButton))})]}),t.jsxs(f.Root,{className:"w-full table-auto",children:[t.jsxs(f.Header,{children:[t.jsx(f.HeaderCell,{className:"bg-token-main-surface-primary",children:t.jsx(u,l({},i.directorySyncEventsTableFailureEventTypeColumnHeader))}),t.jsx(f.HeaderCell,{className:"bg-token-main-surface-primary",children:t.jsx(u,l({},i.directorySyncEventsTableFailureReasonColumnHeader))}),t.jsx(f.HeaderCell,{className:"bg-token-main-surface-primary",children:t.jsx(u,l({},i.directorySyncEventsTableActionsColumnHeader))})]}),t.jsx(f.Body,{children:n.map((g,M)=>t.jsxs("tr",{children:[t.jsx(f.Cell,{children:t.jsx(u,l({},U(g.event.event)))}),t.jsx(f.Cell,{children:g.failure_reason}),t.jsxs(f.Cell,{children:[t.jsx("div",{children:t.jsx(v,{disabled:e,color:"secondary",size:"small",onClick:()=>{y(g),d(!0)},children:t.jsx(u,l({},i.showEventDirectorySyncEventButton))})}),t.jsx("div",{className:"ms-2",children:t.jsx(v,{disabled:e,color:"secondary",size:"small",onClick:()=>{r(g.event.id)},children:t.jsx(u,l({},i.retryDirectorySyncEventButton))})}),t.jsx("div",{className:"ms-2",children:a&&t.jsx(v,{disabled:e,color:"secondary",size:"small",onClick:()=>{a(g.event.id)},children:t.jsx(u,l({},i.discardDirectorySyncEventButton))})})]})]},g.event.id))})]})]})]})}function ye({isLoading:e,numUsersSynced:n,numUsersInDirectory:r,numGroupsSynced:c,numGroupsInDirectory:a,failedEvents:s,retryEventWithId:d,retryAllFailedEvents:o,discardFailedEventWithId:y}){return t.jsxs(t.Fragment,{children:[t.jsxs(H,{className:"my-2",children:[t.jsxs("div",{children:[t.jsx(u,k(l({},i.directorySyncUserSyncStatus),{values:{numUsersSynced:n,numUsersInDirectory:r}})),t.jsx(G,{percentage:n/(r||1)*100})]}),t.jsxs("div",{className:"mt-4",children:[t.jsx("div",{className:"flex items-center space-x-4",children:t.jsx(u,k(l({},i.directorySyncGroupSyncStatus),{values:{numGroupsSynced:c,numGroupsInDirectory:a}}))}),t.jsx(G,{percentage:c/(a||1)*100})]})]}),t.jsx("div",{className:"mt-4",children:t.jsx(ue,{isLoading:e,failedEvents:s,retryEventWithId:d,retryAllFailedEvents:o,discardFailedEventWithId:y})})]})}const b=2e3;function T(e,n){const[r,c]=p.useState(!1),d=E({queryKey:["workspace/directorySync",e],queryFn:async()=>{if(e!==void 0)return await S.getWorkspaceDirectorySyncSettings(e)},enabled:!!e,refetchInterval:r?b:!1}),{data:a}=d,s=h(d,["data"]);return p.useEffect(()=>{a!=null&&a.enabled&&(a==null?void 0:a.directory_connection)==null?c(!0):c(!1)},[a]),l({data:a},s)}function w(e,n){const[r,c]=p.useState(!1),{data:a}=T(e),o=E({queryKey:["workspace/directorySyncStatus/progressUsers","workspace/directorySync",e],queryFn:async()=>{if(e!==void 0)return await S.getWorkspaceDirectorySyncProgressUsers(e)},enabled:!!e&&!!(a!=null&&a.directory_connection),refetchInterval:r?b:!1}),{data:s}=o,d=h(o,["data"]);return p.useEffect(()=>{(s==null?void 0:s.synced_scim_users)===0||(s==null?void 0:s.synced_scim_users)!==(s==null?void 0:s.total_scim_users)?c(!0):c(!1)},[s,a==null?void 0:a.directory_connection]),l({isLoadingUsers:r,data:s},d)}function me(e,n){const[r,c]=p.useState(!1),{data:a}=T(e),o=E({queryKey:["workspace/directorySyncStatus/progressGroups","workspace/directorySync",e],queryFn:async()=>{if(e!==void 0)return await S.getWorkspaceDirectorySyncProgressGroups(e)},enabled:!!e&&!!(a!=null&&a.directory_connection),refetchInterval:r?b:!1}),{data:s}=o,d=h(o,["data"]);return p.useEffect(()=>{(s==null?void 0:s.synced_scim_groups)===0||(s==null?void 0:s.synced_scim_groups)!==(s==null?void 0:s.total_scim_groups)?c(!0):c(!1)},[s,a==null?void 0:a.directory_connection]),l({isLoadingGroups:r,data:s},d)}function pe(e,n){const{isLoadingUsers:r}=w(e);return E({queryKey:["workspace/directorySyncStatus/failedEvents","workspace/directorySync",e],queryFn:async()=>{if(e!==void 0)return await S.getWorkspaceDirectorySyncFailedEvents(e)},enabled:!!e,refetchInterval:r?b:!1})}function fe(e){const n=j();return D({mutationFn:r=>S.retryWorkspaceDirectorySyncFailedEvent(e,r),onSuccess:()=>{n.refetchQueries({queryKey:["workspace/directorySyncStatus/failedEvents","workspace/directorySyncStatus/progressUsers","workspace/directorySyncStatus/progressGroups"]})}})}function Se(e){const n=j();return D({mutationFn:()=>S.retryAllWorkspaceDirectorySyncFailedEvents(e),onSuccess:()=>{n.refetchQueries({queryKey:["workspace/directorySyncStatus/failedEvents","workspace/directorySyncStatus/progressUsers","workspace/directorySyncStatus/progressGroups"]})}})}function ge(e){const n=j();return D({mutationFn:r=>S.discardWorkspaceDirectorySyncFailedEvent(e,r),onSuccess:()=>{n.refetchQueries({queryKey:["workspace/directorySyncStatus/failedEvents"]})}})}function ve(e){const n=j();return D({mutationFn:r=>S.setWorkspaceDirectorySyncEnabled(e,r),onSuccess:()=>{n.refetchQueries({queryKey:["workspace/directorySync",e]})}})}function De({workspaceId:e}){var W,A,N,q,P;const{data:n,isLoading:r}=T(e),{data:c,isLoading:a}=w(e),{data:s,isLoading:d}=me(e),{data:o,isLoading:y}=pe(e),{mutateAsync:C,status:g}=ve(e),{mutateAsync:M,status:z}=fe(e),{mutateAsync:O,status:K}=Se(e),{mutateAsync:Q,status:I}=ge(e),_=g==="pending"||z==="pending"||K==="pending"||I==="pending"||r||a||d||y;return t.jsxs(ee,{className:ae("ps-6",_&&"text-token-text-secondary"),children:[t.jsx(te,{children:t.jsxs("div",{className:"flex flex-row",children:[t.jsx("div",{children:t.jsx(u,l({},i.directorySyncTitle))}),t.jsx("div",{className:"ms-2 mt-1",children:_&&t.jsx(ie,{})})]})}),t.jsx(H,{children:t.jsx(u,l({},i.directorySyncInfoText))}),(n==null?void 0:n.directory_connection)&&t.jsx("div",{children:t.jsx(ye,{isLoading:_,numUsersSynced:(W=c==null?void 0:c.synced_scim_users)!=null?W:0,numUsersInDirectory:(A=c==null?void 0:c.total_scim_users)!=null?A:0,numGroupsSynced:(N=s==null?void 0:s.synced_scim_groups)!=null?N:0,numGroupsInDirectory:(q=s==null?void 0:s.total_scim_groups)!=null?q:0,failedEvents:o!=null?o:[],retryEventWithId:M,retryAllFailedEvents:O,discardFailedEventWithId:Q})}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx(oe,{setEnabled:C,isLoading:_,isEnabled:(P=n==null?void 0:n.enabled)!=null?P:!0}),(n==null?void 0:n.enabled)&&t.jsx(t.Fragment,{children:t.jsx(de,{isLoading:_,workspaceId:e,isDirectoryConnectionConfigured:!!(n!=null&&n.directory_connection)})})]})]})}export{De as DirectorySyncSection};
//# sourceMappingURL=eghtz00f70xklob6.js.map
