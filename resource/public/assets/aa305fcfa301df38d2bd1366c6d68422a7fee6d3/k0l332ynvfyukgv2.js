var B=Object.defineProperty,K=Object.defineProperties;var $=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var y=(o,t,n)=>t in o?B(o,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[t]=n,I=(o,t)=>{for(var n in t||(t={}))W.call(t,n)&&y(o,n,t[n]);if(R)for(var n of R(t))Z.call(t,n)&&y(o,n,t[n]);return o},k=(o,t)=>K(o,$(t));import{y as z,h as J,d as Q,r as w,u as X,j as M,ad as P,e as Y}from"./bubexfvksfr7893o.js";import{h_ as r,u as V,nI as ee,p as te,nJ as ne,l7 as se,R as N,hZ as _,dZ as oe,d_ as ce,dK as re,dN as d,ku as ae,dM as ie,nK as b,_ as L,dX as U,nL as H,nM as ue,aZ as le}from"./ncw8zw682jinppua.js";import{g as _e}from"./c3ebvgxcix5v6glh.js";import{C as de}from"./owg1t5lbjzwpi0hd.js";const he={OAUTH_SCOPES_MISMATCH:r.OAUTH_FAILED_SCOPE_MISMATCH,EMAIL_DOMAIN_CLAIMED_BY_ANOTHER_WORKSPACE:r.OAUTH_FAILED_EMAIL_DOMAIN_ENFORCEMENT},D=Y({genericSuccess:{id:"connectorPlatformOauthRedirect.genericSuccess",defaultMessage:"{connector} is now connected"},slackAiAppSuccess:{id:"connectorPlatformOauthRedirect.slackAiAppSuccess",defaultMessage:"AI App for Slack is now installed"}}),Te=z(function(){const t=J(),n=V(),a=Q(),h=se("installations/select_target"),p=ee(),x=te(),g=w.useRef(!1),{mutateAsync:F}=ne(),f=X();return w.useEffect(()=>{if(g.current===!0)return;g.current=!0;async function G(){var A,O,T,E,m;const C=_e()==="popup"||p,q=window.location.href;try{const e=await N.safePost("/aip/connectors/links/oauth/callback",{requestBody:{full_redirect_url:q}});if(await f.invalidateQueries({refetchType:"all",queryKey:["fetchConnectorLinkData"]}),!(e!=null&&e.post_auth_url)){a(_(r.OAUTH_FAILED_GENERIC));return}const s=new URL(e.post_auth_url,location.origin),i=((A=e==null?void 0:e.link)==null?void 0:A.connector_id)===oe[ce.GITHUB_CONNECTOR],u=s.searchParams.get("github_onboarding")==="sync-repos";if(i&&u){const c=await N.safePost("/aip/connectors/github/search_repos",{requestBody:{query:"",limit:20,next_token:null,link_id:e.link.id}});if(!c||c.repos.length===0){window.open("".concat(h,"?state=").concat(encodeURIComponent(JSON.stringify({client_redirect_to:"".concat(window.location.origin,"/?github_onboarding=sync-repos")}))),"_self");return}}const S=re(s.hash)===d.Connectors;if(!S){const c=ae[e.link.connector_id];c&&s.searchParams.set("add_source",c)}let l;if(S){const c=new URLSearchParams;c.set("connector",e.link.connector_id),i&&!u&&c.set("github_onboarding","configure-repos");const j=k(I({},s),{search:"",hash:ie(d.Connectors).hash+"?".concat(c.toString())});l=P(j)}else i&&!u&&s.searchParams.set("github_onboarding","configure-repos"),l=P({pathname:s.pathname,search:s.search,hash:s.hash});if(C){b({success:!0,connectorId:e.link.connector_id,linkId:e.link.id}),window.close();return}L.logEventWithStatsig("Connector OAuth Connect","chatgpt_connectors_oauth_connect_success",{success:!0,type:e.link.connector_id}),U.logOAuthCompleted({connector_id_metadata:U.createIdMetadataFromId(e.link.connector_id,(O=H())!=null?O:"unknown_referrer"),referrer:(T=H())!=null?T:"unknown_referrer",authType:"OAUTH",scopes:null,success:!0});const v=e.link.connector_id===ue?t.formatMessage(D.slackAiAppSuccess):t.formatMessage(D.genericSuccess,{connector:e.link.name});a(_(r.CUSTOM_MSG,l,v))}catch(e){const s=e instanceof le?(m=he[(E=e.detail)==null?void 0:E.error_code])!=null?m:r.OAUTH_FAILED_GENERIC:r.OAUTH_FAILED_GENERIC;if(C){b({success:!1,connectorId:"",errorType:s}),window.close();return}L.logEventWithStatsig("Connector OAuth Connect","chatgpt_connectors_oauth_connect_error",{errorType:s,success:!1,type:"unknown"}),a(_(s,"#settings/".concat(d.Connectors)))}}G()},[n,p,h,t,a,x,F,f]),M.jsx("div",{className:"flex h-screen w-screen items-center justify-center",children:M.jsx(de,{size:36})})});export{Te as default};
//# sourceMappingURL=k0l332ynvfyukgv2.js.map
