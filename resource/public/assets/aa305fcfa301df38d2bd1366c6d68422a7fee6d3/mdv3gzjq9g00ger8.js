const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jjcc0i8g6768wslh.js","assets/bubexfvksfr7893o.js","assets/n7k7e9q5z1v4upvy.js","assets/k1cl8bhg0vqi0zvs.js","assets/nnaau44w7pxfjjn3.js","assets/ncw8zw682jinppua.js","assets/root-ookb7xuw.css","assets/lv98i5lrm8g24nlg.js","assets/ffjw65gjnc6j0nz8.js","assets/lm3g1zm00rp6al39.js","assets/conversation-small-lq38g8zw.css"])))=>i.map(i=>d[i]);
var Z=Object.freeze,se=Object.defineProperty,fe=Object.defineProperties;var he=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var ne=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var ee=(s,n,t)=>n in s?se(s,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[n]=t,oe=(s,n)=>{for(var t in n||(n={}))ne.call(n,t)&&ee(s,t,n[t]);if(k)for(var t of k(n))te.call(n,t)&&ee(s,t,n[t]);return s},le=(s,n)=>fe(s,he(n));var ae=(s,n)=>{var t={};for(var l in s)ne.call(s,l)&&n.indexOf(l)<0&&(t[l]=s[l]);if(s!=null&&k)for(var l of k(s))n.indexOf(l)<0&&te.call(s,l)&&(t[l]=s[l]);return t};var re=(s,n)=>Z(se(s,"raw",{value:Z(n||s.slice())}));import{j as e,r as _,_ as L}from"./bubexfvksfr7893o.js";import{aC as je,mG as _e,mH as ge,mJ as C,aB as ve,az as S,dR as be,mI as N,cz as A,cw as we,p as Ce,u as Ne,d as ce,fy as ye,aA as F,ld as ke,fm as Le}from"./ncw8zw682jinppua.js";import{e3 as Se,al as Ee,ak as Oe}from"./lm3g1zm00rp6al39.js";import{u as Pe,D as De}from"./cqds1sc7nm0o4af1.js";import{u as Me,U as Ae,a as ie}from"./yp6xblbn4tr1qh0n.js";import{s as Fe}from"./lv98i5lrm8g24nlg.js";import"./e9acc0j1u83xdcvx.js";import"./kfdkis1zwf4ccfgg.js";import"./ol9d5wxhynx9q2is.js";import"./mbmcx8v24u1ao1ke.js";import"./izjhrefsvxrmr1ks.js";import"./mf0m4r73wo03szkn.js";import"./orkdsokm67upvzbu.js";const P=S(()=>L(()=>import("./jjcc0i8g6768wslh.js"),__vite__mapDeps([0,1])),{loading:s=>F(s)}),D=S(()=>L(()=>import("./n7k7e9q5z1v4upvy.js"),__vite__mapDeps([2,1])),{loading:s=>F(s)}),Re=S(()=>L(()=>import("./k1cl8bhg0vqi0zvs.js"),__vite__mapDeps([3,1])),{loading:s=>F(s)}),Te=S(()=>L(()=>import("./nnaau44w7pxfjjn3.js"),__vite__mapDeps([4,1,5,6,7,8,9,10])).then(s=>s.JsonViewer));function ts({threadId:s,threadUserId:n}){return Me(Ae.isDebugModalOpen)&&e.jsx(je,{testId:"modal-sonic-debug",isOpen:!0,onClose:()=>ie.toggleDebugModalOpen(),type:"success",size:"fullscreen",noPadding:!0,rootClassName:"z-50",children:e.jsx(Ie,{threadId:s,threadUserId:n!=null?n:void 0,onClose:()=>ie.toggleDebugModalOpen()})})}const ze=(s,n)=>{const t=JSON.stringify(n,null,2),l=new Blob([t],{type:"application/json"}),a=window.URL.createObjectURL(l),c=document.createElement("a");c.href=a,c.download=s,c.click(),window.URL.revokeObjectURL(a)},de="<|im_start|>",me="<|im_sep|>",xe="<|im_end|>",$e="<|fim_suffix|>",Ve="<|meta_sep|>";function ue({prompt:s}){const[n,t]=_.useState({}),l=[],a=[];let c=0;for(;;){const r=s.indexOf(de,c);if(r===-1)break;const i=s.indexOf(me,r);if(i===-1)break;let o=s.indexOf(xe,i);const m=s.indexOf($e,i);if(m!==-1&&(o===-1||m<o)&&(o=m),o===-1)break;const d=s.substring(r+de.length,i).replace(Ve," channel="),p=s.substring(i+me.length,o);a.push(r);const y=n[r];l.push(e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>t(g=>le(oe({},g),{[r]:!g[r]})),children:y?e.jsx(P,{size:14}):e.jsx(D,{size:14})}),e.jsxs("span",{className:"font-semibold",children:["[",d,"]"]})]}),e.jsx("div",{className:A("whitespace-pre-wrap",y&&"line-clamp-2 truncate"),children:p})]},r)),c=o+xe.length}function u(r){const i={};for(const o of a)i[o]=r;t(i)}return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"absolute end-0 top-0 flex items-center gap-2 text-xs font-semibold",children:[e.jsxs("button",{className:"flex items-center gap-1 underline",onClick:()=>u(!0),children:[e.jsx(D,{size:14})," Collapse All"]}),"/",e.jsxs("button",{className:"flex items-center gap-1 underline",onClick:()=>u(!1),children:[e.jsx(P,{size:14})," Expand All"]})]}),e.jsx("div",{className:"flex flex-col gap-3",children:l})]})}var pe;const j=we.div(pe||(pe=re(["mb-[-5px] pb-0.5 font-semibold uppercase border-b-2 ",""])),({$isSelected:s})=>s?"border-black dark:border-white":"border-transparent");function Ie({threadId:s,threadUserId:n,message:t,onClose:l}){var T,z,$,V,I,J,B,U,K,G,H;const[a,c]=_.useState(t?"message":"json"),{data:u,isLoading:r,refetch:i}=Pe({threadId:s,threadUserId:n,refetchOnMount:"always"}),o=u==null?void 0:u.thread;if(_.useEffect(()=>{c(t?"message":o!=null&&o.turns.length?"turn".concat((o==null?void 0:o.turns.length)-1):"thread")},[o==null?void 0:o.turns.length,t]),!r&&!o&&!t)return e.jsxs(De,{onClickRetry:()=>i(),children:["Failed to load."," "]});if(r)return e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:"Loading..."});const m=o==null?void 0:o.turns,d=o==null?void 0:o.turns[o.turns.length-1],p=(z=(T=d==null?void 0:d.artifacts__)==null?void 0:T.model_snapshots)==null?void 0:z.default_id,y=(J=(I=(V=($=d==null?void 0:d.artifacts__)==null?void 0:$.settings)==null?void 0:V.model_response)==null?void 0:I.completion_model)==null?void 0:J.model,g=p!=null?p:y,E=(B=d==null?void 0:d.artifacts__)==null?void 0:B.eval_preset,R=n&&s?Se(n,s):null,v=(G=(K=(U=t==null?void 0:t.metadata)==null?void 0:U.__internal)==null?void 0:K.debug)==null?void 0:G.render_for_completion_result_decoded;return e.jsx("div",{className:"flex flex-col gap-2 font-mono text-xs break-words",children:e.jsxs(_e,{orientation:"vertical",value:a,onValueChange:f=>c(f),children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs(ge,{className:"flex items-center justify-start gap-3 p-2",children:[t&&e.jsx(C,{value:"message",children:e.jsx(j,{$isSelected:a==="message",children:"Message"})},"message"),v&&e.jsx(C,{value:"render_for_completion",children:e.jsx(j,{$isSelected:a==="render_for_completion",children:"Prompt"})},"render_for_completion"),o&&e.jsx(C,{value:"thread",children:e.jsx(j,{$isSelected:a==="thread",children:"Thread"})},"thread"),e.jsx(C,{value:"connectors",children:e.jsx(j,{$isSelected:a==="connectors",children:"Connectors"})},"connectors"),m==null?void 0:m.map((f,x)=>{var h,b;return e.jsxs(_.Fragment,{children:[e.jsx(C,{value:"turn".concat(x),children:e.jsxs(j,{$isSelected:a==="turn".concat(x),children:["Turn[",x,"]"]})},x),(b=(h=f.artifacts__)==null?void 0:h.debug_ddtrace_urls)==null?void 0:b.map(w=>e.jsx(j,{$isSelected:!1,children:e.jsxs("a",{target:"_blank",href:w,className:"text-nowrap",rel:"noreferrer",children:["Trace[",x,"] â†—"]})},w))]},x)})]}),e.jsxs("div",{className:"flex items-center justify-end",children:[o&&e.jsxs(ve,{size:"small",color:"secondary",onClick:()=>ze("thread.json",o),children:[e.jsx(Re,{className:"icon-sm"})," thread.json"]}),e.jsx(be,{onClick:l})]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-2",children:[g&&e.jsxs(e.Fragment,{children:[e.jsx(O,{name:"Model",id:g,className:"shrink-0"})," ",e.jsx("span",{className:"text-gray-500 dark:text-white",children:"|"})]}),E&&E!=="production"&&e.jsxs(e.Fragment,{children:[e.jsx(O,{name:"Eval Preset",id:E,className:"shrink-0"}),e.jsx("span",{className:"text-gray-500 dark:text-white",children:"|"})]}),R&&e.jsx(e.Fragment,{children:e.jsx(O,{name:"Permalink",id:R,className:"flex-shrink-1"})})]}),m==null?void 0:m.map((f,x)=>{var b,w,Q,W,X,q,Y;const h=(b=f.model_response)==null?void 0:b.text;return e.jsxs(N,{value:"turn".concat(x),className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth",children:[e.jsxs("div",{className:A("flex flex-col gap-2 p-2",((w=f.index)!=null?w:0)%2===1&&"bg-token-main-surface-secondary"),children:[e.jsx(ue,{prompt:(q=(X=(W=(Q=f.artifacts__)==null?void 0:Q.debug_info)==null?void 0:W.main_model_response)==null?void 0:X.prompt_string)!=null?q:""}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"[assistant]"}),e.jsx("div",{"data-testid":"assistant-response",className:"whitespace-pre-wrap",children:(Y=Fe(h!=null?h:""))!=null?Y:h})]})]})," "]},x)}),o&&e.jsx(N,{value:"thread",className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth p-2",children:e.jsx(M,{data:o,collapsed:4,jsonFiltersKey:"thread"})}),t&&e.jsx(N,{value:"message",className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth p-2",children:e.jsx(M,{data:t,collapsed:4,jsonFiltersKey:"message"})}),v&&e.jsx(N,{value:"render_for_completion",className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth p-2",children:e.jsx(ue,{prompt:v!=null?v:""})}),e.jsx(N,{value:"connectors",className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth p-2",children:e.jsx(Je,{})})]},(H=o==null?void 0:o.turns.length)!=null?H:"message")})}function M({data:s,collapsed:n,jsonFiltersKey:t}){const[l,a]=_.useState(n!=null?n:!0);return e.jsxs("div",{className:"flex flex-col items-start gap-1",children:[e.jsx("button",{onClick:()=>a(!l),className:"flex items-center gap-1",children:l?e.jsxs(e.Fragment,{children:[e.jsx(P,{size:14})," Expand all"]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{size:14})," Collapse all"]})}),e.jsx("div",{className:"w-full",children:e.jsx(Te,{jsonFiltersKey:t,json:s,jsonViewProps:{collapsed:l,shortenTextAfterLength:0}},String(l))})]})}function Je(){const s=Ne(),n=ce(()=>ke(s)),t=n===void 0,{data:l,isLoading:a}=ce(()=>Le(s)),{connectorLinks:c,isLoading:u}=ye({fetchValidLinksOnly:!0});if(t||a||u)return e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:"Loading connectors..."});const r=n.map(i=>{const p=i,{logo_url:o,logo_url_dark:m}=p;return ae(p,["logo_url","logo_url_dark"])});return e.jsx(M,{data:{availableConnectors:r,syncConnectors:l,accessConnectors:c},collapsed:2,jsonFiltersKey:"connectors"})}function O({name:s,id:n,className:t}){const l=Ce(),a=_.useCallback(c=>{Ee(n,l,c)},[n,l]);return e.jsxs("div",{className:A("flex items-center gap-2 truncate",t),children:[e.jsxs("span",{className:"font-semibold text-nowrap",children:[s,":"]}),e.jsx("span",{title:n,className:"truncate text-gray-500 dark:text-white",children:n}),e.jsx(Oe,{onCopy:a})]})}export{M as DebugJsonViewer,ts as DebugModal,Ie as DebugModalContents};
//# sourceMappingURL=mdv3gzjq9g00ger8.js.map
