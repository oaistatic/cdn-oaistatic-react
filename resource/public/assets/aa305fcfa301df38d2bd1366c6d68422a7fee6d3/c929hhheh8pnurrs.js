const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/edrexdo8qnubrh9i.js","assets/bubexfvksfr7893o.js","assets/ncw8zw682jinppua.js","assets/root-ookb7xuw.css","assets/lm3g1zm00rp6al39.js","assets/conversation-small-lq38g8zw.css","assets/hmf9tq54zhr2dacw.js","assets/luk8bxmt063r9itm.js","assets/cgybd4eitkpj631b.js","assets/ff4ielulei1st3go.js","assets/dg0o9grwdadbr6h8.js","assets/lowvfqga59ouknrz.js","assets/k0d9broc5wqvhhma.js","assets/gtcvhpyyxjlawokm.js","assets/fk5dn736y6oc9os0.js","assets/exx0m5g11hnp3j3d.js","assets/d9ec94om23qfz1v2.js","assets/luif5kl8klbqcpjy.js","assets/bo8mdhc1oc1583ww.js"])))=>i.map(i=>d[i]);
var dn=Object.freeze,cn=Object.defineProperty,So=Object.defineProperties;var To=Object.getOwnPropertyDescriptors;var ss=Object.getOwnPropertySymbols;var un=Object.prototype.hasOwnProperty,gn=Object.prototype.propertyIsEnumerable;var ln=(o,n,a)=>n in o?cn(o,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[n]=a,X=(o,n)=>{for(var a in n||(n={}))un.call(n,a)&&ln(o,a,n[a]);if(ss)for(var a of ss(n))gn.call(n,a)&&ln(o,a,n[a]);return o},be=(o,n)=>So(o,To(n));var mn=(o,n)=>{var a={};for(var s in o)un.call(o,s)&&n.indexOf(s)<0&&(a[s]=o[s]);if(o!=null&&ss)for(var s of ss(o))n.indexOf(s)<0&&gn.call(o,s)&&(a[s]=o[s]);return a};var ys=(o,n)=>dn(cn(o,"raw",{value:dn(n||o.slice())}));import{_ as Ee,r as l,j as e,M as xe,e as Co,R as qn,o as yo}from"./bubexfvksfr7893o.js";import{i6 as Mo,hZ as hn,bw as Ao,i7 as pn,i8 as Eo,i9 as fn,ia as wo,ib as $n,cA as jo,cB as Po,cC as ko,ic as Ro,aN as Fo,aA as No,id as Do,ie as Oo,ig as Ho,cE as Vo,ih as Lo,cK as zn,ii as Bo,gL as Uo,ij as bn,ah as Go,ik as Wo,cZ as js,il as qo,hI as $o,im as zo,M as Ko,io as Qo,ip as Jo,iq as Xo,ir as Zo,is as Yo,it as vn,iu as ei,aj as xn,iv as si,iw as ti,ix as ni,iy as ai,iz as oi,iA as ii,c9 as ri,iB as di,iC as li,iD as ci,iE as ui,iF as gi,iG as mi,iH as hi,az as Kn,ay as Ps,iI as pi,iJ as fi,iK as bi,iL as vi,iM as _n,iN as xi,iO as _i,iP as Ii,iQ as Si,iR as In,iS as Ti,iT as Ci,iU as yi,iV as Mi,iW as Ai,iX as Ei,iY as wi,iZ as ji,i_ as Pi,i$ as ki,e6 as Ri,j0 as Fi,j1 as Ni,j2 as Di,j3 as Oi,g_ as Qn,ew as Hi,j4 as Vi,j5 as Li,j6 as Bi,j7 as Ui,j8 as Gi,j9 as Wi,ja as qi,jb as $i,gN as zi,jc as Ki,jd as Qi,je as Ji,jf as Xi,jg as Zi,jh as Yi,ji as er,fq as Sn,jj as sr,jk as tr}from"./lm3g1zm00rp6al39.js";import{az as we,cw as Jn,O as as,e$ as C,hO as Xn,V as L,ay as z,cz as ge,qr as Zn,dQ as nr,mY as ar,M as ve,l as _e,ab as Fs,P as Ge,jl as or,ao as Yn,aB as ea,ic as sa,R as ir,A as rr,bl as Tn,D as ks,u as Ns,dl as dr,jb as lr,x as cr,bp as ur,fk as gr,d5 as mr,d6 as hr,i7 as pr,fH as fr,d as ne,i5 as Ms,a9 as br,J as Ne,a6 as Be,eq as vr,w as xr,ke as _r,H as Ir,i as Sr,mZ as Tr,mX as Cr,aw as yr,ak as Mr,N as Ar,_ as De,aT as Ue,cp as Er,a2 as ts,qs as wr,e4 as ta,kt as jr,aa as As,qt as Cn,eB as Pr,qu as kr,av as yn,qv as Rr,bJ as Fr,bK as Nr,dV as Dr,dk as Mn,jW as ns,ax as An,bx as Or,jO as Hr,d$ as Vr,Q as Lr,p9 as Br,mA as Ur,aA as Gr,z as Ds,bk as na,fc as En,qw as Wr,b as qr,aV as $r,aW as zr,n4 as Kr,eR as Qr,fb as Jr,fO as Xr,i8 as Zr,br as Yr,lZ as wn,aN as ed}from"./ncw8zw682jinppua.js";import{C as Rs}from"./b3zmi7k0e1dvao0m.js";import{T as sd,U as td,A as nd}from"./i0yczuhbjrdxz6ve.js";import{S as ad}from"./dpidockywf8envd2.js";import{b as od,c as id}from"./bc00p2ldn9cv9q32.js";const jn=we(()=>Ee(()=>import("./edrexdo8qnubrh9i.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(o=>o.MemoryActionResult));function Pn(o,n,a){_e(o,s=>{Fs.updateTree(s,d=>{d.updateNodeMetadata(n,{inlineComparisonRating:a})})})}const kn=({messages:o})=>{for(const{metadata:n}of o){const{paragen_display_label:a}=n!=null?n:{};if(a)return a;const{augmented_paragen_prompt_label:s}=n!=null?n:{};if(s)return s}};function Rn({displayedMessages:o,message:n,conversationTurnMountTime:a,visibilityState:s}){var g,p;const d={},b=((g=n.clientMetadata)==null?void 0:g.variantsInStreamInfo)==null&&((p=n.metadata)==null?void 0:p.paragen_variants_info)!=null;return o.forEach((v,O)=>{const H=b?{load_first_token_time:a,load_end_time:a}:{load_first_token_time:v.loadFirstTokenTime,load_end_time:v.loadEndTime},u=O===0?{rendered_height:s.left_rendered_height}:{rendered_height:s.right_rendered_height};d[v.messageId]=X(X({},H),u)}),d}function rd(o){const n=l.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null,left_rendered_height:null,right_rendered_height:null}),a=l.useRef({left:null,right:null});return o.variantIds.length<2?e.jsx(aa,X({setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:n,firstVisibleTokenTimestampsRef:a},o)):e.jsx(dd,be(X({},o),{visibilityStateRef:n,firstVisibleTokenTimestampsRef:a}))}function dd(o){const{conversation:n,variantIds:a,turnIndex:s,firstVisibleTokenTimestampsRef:d}=o;if(a.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const b=Zn(),g=nr(),[p,v]=a,O=l.useMemo(()=>ar(p+v)()>=.5,[p,v]),[H,u]=O?[v,p]:[p,v],[B,R,j]=ve(n.id,U=>{var S,D,k,G,i,K,T,le,I,se,ce,Ie,M,E,Z,f,Q,ae,W,Se;const P=Tn(U).tree.getLeafFromNode(H).id,F=Tn(U).tree.getLeafFromNode(u).id,A=L.getConversationTurns(U,P),c=L.getConversationTurns(U,F),$=s<A.length?A[s]:null,N=s<c.length?c[s]:null;return $||ks.addError("Paragen Left turn index ".concat(s," out of bounds"),{turnIndex:s,turnCount:A.length,lastTurnRole:(S=C(A))==null?void 0:S.role,lastMessageAuthor:(k=C((D=C(A))==null?void 0:D.messages))==null?void 0:k.author,lastMessageContentType:(i=C((G=C(A))==null?void 0:G.messages))==null?void 0:i.content.content_type,lastMessageMetadata:(T=C((K=C(A))==null?void 0:K.messages))==null?void 0:T.metadata,altTurnCount:c.length,altLastTurnRole:(le=C(c))==null?void 0:le.role,altLastMessageRole:(se=C((I=C(c))==null?void 0:I.messages))==null?void 0:se.author.role}),N||ks.addError("Paragen Right turn index ".concat(s," out of bounds"),{turnIndex:s,turnCount:c.length,lastTurnRole:(ce=C(c))==null?void 0:ce.role,lastMessageAuthor:(M=C((Ie=C(c))==null?void 0:Ie.messages))==null?void 0:M.author,lastMessageContentType:(Z=C((E=C(c))==null?void 0:E.messages))==null?void 0:Z.content.content_type,lastMessageMetadata:(Q=C((f=C(c))==null?void 0:f.messages))==null?void 0:Q.metadata,altTurnCount:A.length,altLastTurnRole:(ae=C(A))==null?void 0:ae.role,altLastMessageRole:(Se=C((W=C(A))==null?void 0:W.messages))==null?void 0:Se.author.role}),[P,$,N]}),[x,_]=O?[j,R]:[R,j],J="skippable_parallel_2_in_stream:a:1.5";l.useEffect(()=>(fn.setState({displayingSideBySideFeedback:!0}),()=>{fn.setState({displayingSideBySideFeedback:!1})}),[]);const y=l.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null,left_rendered_height:null,right_rendered_height:null}),ee=l.useCallback((U,{shouldSubmitParagenFeedback:P=!0}={})=>{if(!R||!j||!x||!_)throw new Error("Expected both turns to exist");_e(n.id,k=>{Fs.setCurrentBranch(k,U)});const F=U===H,A=U===p;x.messages.length>0&&Pn(n.id,x.messages[x.messages.length-1].id,A?"original":"new"),_.messages.length>0&&Pn(n.id,_.messages[_.messages.length-1].id,A?"original":"new");const c=Ge(n.id),$=[R,j].map((k,G)=>{var i,K,T;return{messageId:k.messages[k.messages.length-1].id,loadFirstTokenTime:G===0?d.current.left:d.current.right,loadEndTime:(T=(K=(i=C(k.messages))==null?void 0:i.clientMetadata)==null?void 0:K.completionSampleFinishTime)!=null?T:null}}),N=F?$[0].messageId:$[1].messageId,S=L.getParentPromptNode(as(n.id),B);if(!S)throw new Error("Expected prompt for side by side feedback");const D=Rn({displayedMessages:$,message:S.message,conversationTurnMountTime:o.conversationTurnMountTime,visibilityState:y.current});P&&Hn({params:{conversation_id:c,displayed_message_ids:$.map(k=>k.messageId),message_metadatas:D,rating:"selected",selected_message_id:N,source_timestamp:Date.now(),ui_variant:1,user_prompt_message_id:S.message.id}})},[n.id,H,p,x,_,R,j,B,d,o.conversationTurnMountTime,y]);return l.useEffect(()=>or(Yn,{requestCompletion:U=>{const P=Ge(n.id),F=L.getParentPromptNode(as(n.id),B);if(!F)throw new Error("Expected prompt for side by side feedback");if(!R||!j)throw new Error("Expected both turns to exist");const A=[R,j].map((N,S)=>{var D,k,G;return{messageId:N.messages[N.messages.length-1].id,loadFirstTokenTime:S===0?d.current.left:d.current.right,loadEndTime:(G=(k=(D=C(N.messages))==null?void 0:D.clientMetadata)==null?void 0:k.completionSampleFinishTime)!=null?G:null}}),c=Rn({displayedMessages:A,message:F.message,conversationTurnMountTime:o.conversationTurnMountTime,visibilityState:y.current}),$=U.isForSkippingParagen;Hn({params:{conversation_id:P,displayed_message_ids:A.map(N=>N.messageId),message_metadatas:c,rating:$?"explicit_skipped":"skipped",selected_message_id:null,source_timestamp:Date.now(),ui_variant:$?3:1,user_prompt_message_id:F.message.id}}),$&&ee(H,{shouldSubmitParagenFeedback:!1})}}),[R,j,B,n.id,o.conversationTurnMountTime,J,x==null?void 0:x.messages,_==null?void 0:_.messages,g,d,ee,H,y]),e.jsx(aa,be(X({},o),{setPreferredFeedback:ee,leftVariantId:H,rightVariantId:u,leftTurn:R,rightTurn:j,hasActiveRequest:b,originalTurn:x,visibilityStateRef:y}))}function aa(O){var H=O,{setPreferredFeedback:o,leftVariantId:n,rightVariantId:a,leftTurn:s,rightTurn:d,hasActiveRequest:b,originalTurn:g,visibilityStateRef:p}=H,v=mn(H,["setPreferredFeedback","leftVariantId","rightVariantId","leftTurn","rightTurn","hasActiveRequest","originalTurn","visibilityStateRef"]);var ce,Ie,M;const u=(ce=s&&kn(s))!=null?ce:null,B=(Ie=d&&kn(d))!=null?Ie:null,R=l.useMemo(()=>{var E;return(E=s==null?void 0:s.messages)!=null?E:[]},[s==null?void 0:s.messages]),j=l.useMemo(()=>{var E;return(E=d==null?void 0:d.messages)!=null?E:[]},[d==null?void 0:d.messages]),{avatarClassName:x,firstVisibleTokenTimestampsRef:_}=v,J=l.useMemo(()=>{var E;return(E=s==null?void 0:s.messageGroups)!=null?E:[]},[s==null?void 0:s.messageGroups]),y=l.useMemo(()=>{var E;return(E=d==null?void 0:d.messageGroups)!=null?E:[]},[d==null?void 0:d.messageGroups]),ee=Mo(),U=as(v.conversation.id),P=C(s==null?void 0:s.messages),F=C(d==null?void 0:d.messages),A=Xn(L.getRequestId(U,(M=P==null?void 0:P.id)!=null?M:F==null?void 0:F.id)),c=A&&!(P!=null&&P.end_turn),$=A&&!(F!=null&&F.end_turn),N=P!=null&&hn(P),S=F!=null&&hn(F),D=N!=null?N:S,k=(s==null?void 0:s.role)===z.User,G=(d==null?void 0:d.role)===z.User,i=l.useRef(null),K=l.useRef(null),T=l.useRef(null),le=s!=null,I=d!=null;!le&&_.current.left==null&&(_.current.left=Date.now()),!I&&_.current.right==null&&(_.current.right=Date.now()),l.useEffect(()=>{if(i.current&&K.current&&T.current){const E=Array(11).fill(0).map((f,Q)=>Q/10),Z=new IntersectionObserver(f=>f.forEach(Q=>{var ae,W,Se,je,We,Oe;Q.target===K.current?((W=(ae=p.current).left_visibility_initial)!=null||(ae.left_visibility_initial=Q.intersectionRatio),p.current.left_visibility_max=Math.max((Se=p.current.left_visibility_max)!=null?Se:0,Q.intersectionRatio)):Q.target===T.current&&((We=(je=p.current).right_visibility_initial)!=null||(je.right_visibility_initial=Q.intersectionRatio),p.current.right_visibility_max=Math.max((Oe=p.current.right_visibility_max)!=null?Oe:0,Q.intersectionRatio))}),{root:i.current,threshold:E});return Z.observe(K.current),Z.observe(T.current),()=>Z.disconnect()}},[p]),l.useEffect(()=>{const E=K.current,Z=T.current;if(!E||!Z)return;let f=null;const Q=()=>{f!=null&&cancelAnimationFrame(f),f=requestAnimationFrame(()=>{if(E.isConnected){const W=Math.round(E.getBoundingClientRect().height);p.current.left_rendered_height=W}if(Z.isConnected){const W=Math.round(Z.getBoundingClientRect().height);p.current.right_rendered_height=W}})},ae=new ResizeObserver(Q);return ae.observe(E),ae.observe(Z),Q(),()=>{f!=null&&cancelAnimationFrame(f),ae.disconnect()}},[p]);const{data:se}=Ao(void 0,!1,ee);return e.jsxs("div",{className:"relative flex flex-col",children:[e.jsx("div",{className:"bg-token-main-surface-primary sticky top-[-1px] z-1 px-(--thread-content-margin) text-center text-lg text-pretty md:static","data-testid":"paragen-feedback-title",children:e.jsx(xe,{id:"KKeSJV",defaultMessage:"You're giving feedback on a new version of ChatGPT."})}),e.jsx("div",{className:"text-token-text-secondary px-(--thread-content-margin) pt-1 pb-5 text-center text-sm text-pretty",children:e.jsx(xe,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})}),e.jsx("div",{className:ge(Eo("default"),"horzScrollShadows relative -mb-2 snap-x snap-mandatory overflow-x-auto overflow-y-clip pb-4"),ref:i,children:e.jsxs("div",{className:ge("mx-auto box-content max-w-[calc(2*var(--thread-content-max-width))] min-w-min px-(--thread-content-margin)","flex items-start gap-4 sm:gap-6"),children:[e.jsxs(Fn,{rootElementRef:K,onClick:()=>{o(n)},hasActiveRequest:b,isImageGenInProgress:D,children:[e.jsxs(Dn,{children:[e.jsx(pn,{messages:R,isUserTurn:k,avatarClassName:x}),e.jsx(Nn,{children:e.jsx(xe,be(X({},Vn.responseNumber),{values:{responseIndex:1,display_label:u?" ".concat(u):""}}))})]}),e.jsxs(e.Fragment,{children:[se!=null&&!k&&e.jsx(jn,{clientThreadId:v.conversation.id,messages:R,isParagen:!0}),e.jsx(Rs,be(X({},v),{allMessages:R,groupedMessagesToRender:J,allGroupedMessages:J,isUserTurn:k,isFinalUserTurn:!1,isFinalAssistantTurn:!1,isCompletionRequestInProgress:c,hasActiveRequest:b,shouldGrowContainer:!1,isParagen:!0})),e.jsx(On,{clientThreadId:v.conversation.id,conversationTurnMountTime:v.conversationTurnMountTime,turn:s,originalTurn:g})]})]}),e.jsxs(Fn,{rootElementRef:T,onClick:()=>{o(a)},hasActiveRequest:b,isImageGenInProgress:D,children:[e.jsxs(Dn,{children:[e.jsx(pn,{messages:j,isUserTurn:G,avatarClassName:x}),e.jsx(Nn,{children:e.jsx(xe,be(X({},Vn.responseNumber),{values:{responseIndex:2,display_label:B?" ".concat(B):""}}))})]}),e.jsxs(e.Fragment,{children:[se!=null&&!G&&e.jsx(jn,{clientThreadId:v.conversation.id,messages:j,isParagen:!0}),e.jsx(Rs,be(X({},v),{allMessages:j,groupedMessagesToRender:y,allGroupedMessages:y,isFinalUserTurn:!1,isFinalAssistantTurn:!1,isUserTurn:G,isCompletionRequestInProgress:$,hasActiveRequest:b,shouldGrowContainer:!1,isParagen:!0})),e.jsx(On,{clientThreadId:v.conversation.id,conversationTurnMountTime:v.conversationTurnMountTime,turn:d,originalTurn:g})]})]})]})})]})}function Fn({rootElementRef:o,onClick:n,children:a,hasActiveRequest:s,isImageGenInProgress:d}){const b=l.useRef(null),g=l.useRef(null),p=l.useRef(null);return e.jsx("div",{"data-paragen-root":!0,className:"border-token-border-tertiary @container relative flex min-w-[min(450px,80cqw,80vw)] flex-1 snap-center flex-col gap-1 rounded-xl border text-start shadow-lg shadow-black/3",ref:o,children:e.jsxs("div",{className:ge(wo,"px-(--thread-content-margin) py-4"),children:[e.jsx("div",{className:ge("absolute top-48 right-0! left-0! h-px","invisible"),ref:b}),e.jsx("div",{className:ge("absolute top-48 right-0! bottom-0 left-0!","invisible"),ref:g}),e.jsx("div",{className:ge("absolute right-0! bottom-0 left-0! h-px","invisible"),ref:p}),a,s||d?null:e.jsx(ea,{className:"mt-4 self-start",onClick:n,"data-testid":"paragen-prefer-response-button",children:e.jsx(xe,{id:"U2EAH6",defaultMessage:"I prefer this response"})})]})})}var Gn;const Nn=Jn.div(Gn||(Gn=ys(["text-sm text-token-text-secondary font-semibold"])));var Wn;const Dn=Jn.div(Wn||(Wn=ys(["flex gap-4 items-center mb-1"])));function On({clientThreadId:o,conversationTurnMountTime:n,turn:a,originalTurn:s}){var u,B,R,j,x,_;const d=sa();if(!d.showParagenMetadata||!d.showDebugConversationTurns&&!d.forceParagen||a==null)return null;let b=a===s?"ORIGINAL":"NEW";const g=a.messages[a.messages.length-1],p=(u=g==null?void 0:g.metadata)==null?void 0:u.__internal,v=(B=g==null?void 0:g.metadata)==null?void 0:B.paragen_display_label;if(p){const{model_id:J,model_definition_slug:y,model_definition_virtual_model_id:ee,alternative_model_selection_rule:U,augmented_paragen_prompt_group_id:P,augmented_paragen_prompt_id:F,augmented_paragen_prompt:A}=p;J&&(b+="\nModel ID: ".concat(J)),y&&(b+="\nModel Slug: ".concat(y)),ee&&(b+="\nVirtual Model ID: ".concat(ee)),U&&(b+="\nAlternative Model Rule: ".concat(U)),P&&(b+="\nPrompt Group ID: ".concat(P)),F&&(b+="\nPrompt ID: ".concat(F)),A&&(b+="\nPrompt: ".concat(A)),v&&(b+="\nDisplay Label: ".concat(v))}b+="\nMessage ID: ".concat(g.id);const O=L.getParentPromptNode(as(o),a.messages[0].id);if(!O)throw new Error("Expected prompt for side by side feedback");const H=((R=O.message.clientMetadata)==null?void 0:R.variantsInStreamInfo)==null&&((j=O.message.metadata)==null?void 0:j.paragen_variants_info)!=null;return b+="\nUser prompt message ID: ".concat(O.message.id),b+="\nIs Persisted Paragen? ".concat(H),b+="\nCompletion Sample Finish Time: ".concat(H?"".concat(n," (persisted)"):(_=(x=C(a.messages))==null?void 0:x.clientMetadata)==null?void 0:_.completionSampleFinishTime),e.jsx("div",{className:"text-sm whitespace-pre-wrap text-red-500",children:b})}async function Hn({params:o}){await ir.safePost("/paragen_submission",{requestBody:o,authOption:rr.SendIfAvailable})}const Vn=Co({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}{display_label}"}}),ld=we(()=>Ee(()=>import("./luk8bxmt063r9itm.js"),__vite__mapDeps([7,1])),{loading:o=>Gr(o)}),cd=we(()=>Ee(()=>import("./edrexdo8qnubrh9i.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(o=>o.MemoryActionResult)),ud=we(()=>Ee(()=>import("./cgybd4eitkpj631b.js"),__vite__mapDeps([8,1,2,3,4,5,9])).then(o=>o.AutomationSourceHeader)),Ln=we(()=>Ee(()=>import("./dg0o9grwdadbr6h8.js"),__vite__mapDeps([10,1,2,3,11,4,5])).then(o=>o.TextMessageEditor)),gd=we(()=>Ee(()=>import("./k0d9broc5wqvhhma.js"),__vite__mapDeps([12,1,2,3,4,5,13,14,15,16,17])).then(o=>o.ChatScreenRetrievalResultsFlyoutContent)),Bn=80,Es=16;function ws(){return{minHeight:"calc(100dvh - ".concat(Oi,"px - 120px)")}}function md(o){"use no forget";var pt,ft,bt,vt,xt,_t,It,St,Tt,Ct,yt,Mt,At,Et,wt,jt,Pt,kt,Rt,Ft,Nt,Dt,Ot,Ht,Vt,Lt,Bt,Ut,Gt,Wt,qt,$t,zt,Kt,Qt,Jt,Xt,Zt,Yt;const{turnIndex:n,isFinalTurn:a,conversation:s,onRequestCompletion:d,currentModelId:b,scrollToMessageId:g,scrollToMessageIsAssistant:p,dateHeaderType:v,hideUserActions:O,disableHorizontalPadding:H}=o,u=Ns(),B=$n(u),R=dr(),j=lr(),x=cr(t=>Ds(t)),_=ur(u),J=!!R&&gr(R),y=mr(hr.isBusinessWorkspace),ee=jo(),U=Po(u)||ee,P=ko(u),F=Ro(u),{eligible:A}=Fo(No.hasSeenAudioParagenPrompt),[c,$,N]=ve(s.id,t=>{const r=L.getConversationTurnAtIndex(t,n),m=n>0?L.getConversationTurnAtIndex(t,n-1):null,h=(m==null?void 0:m.role)===z.User&&m.messages.some(q=>{var Y;return(Y=q.metadata)==null?void 0:Y.visually_hide_response_from_conversation});return[r,h,m]},{disablePerfDetector:a}),{messages:S,messageGroups:D}=c,k=Do(t=>t.size===0?-1:D.findIndex(r=>r.type===Ms?r.groups.some(m=>m.messages.some(h=>t.has(h==null?void 0:h.id))):r.messages.some(m=>t.has(m==null?void 0:m.id)))),G=S[0],i=C(S),K=l.useMemo(()=>D.some(t=>t.type===pr.SearchGPTQuery),[D]),T=l.useMemo(()=>S.some(t=>{var r;return(r=t.metadata)==null?void 0:r.n7jupd_message}),[S]),le=l.useMemo(()=>{var t,r;return(r=(t=C(S))==null?void 0:t.metadata)==null?void 0:r.chatgpt_sdk_suppressed_response},[S]),I=l.useMemo(()=>T?fr(S,t=>t.author.name==="n7jupd.metadata"):null,[S,T]),se=!!((pt=I==null?void 0:I.metadata)!=null&&pt.kaur1br5_mode),ce=ve(s.id,t=>!!(t!=null&&t.pulseCardId)),Ie=ne(()=>Qn(u).isFeedbackModalOpen$()||ce&&n===1),{messages:M,visibleMessages:E,messageGroups:Z,lastMessageToRender:f}=l.useMemo(()=>{const t=k!==-1&&k+1<D.length,r=t?D.slice(0,k+1):D,m=t?r.flatMap(h=>h.type===Ms?h.groups.flatMap(q=>q.messages):h.messages):S;return{messages:m,visibleMessages:m.filter(br),messageGroups:r,lastMessageToRender:C(m)}},[S,D,k]),Q=k!==-1,ae=Ne(u,"1887864177"),W=ve(s.id,t=>L.getLastMessageSystemHints(t)),Se=ve(s.id,t=>{var r;return(r=t==null?void 0:t.hasIKConvo)!=null?r:!1}),je=(W==null?void 0:W.includes(Be.Tatertot))&&Ne(u,"28816792")&&vr(u),{capabilitySuggestionsEnabled:We}=Oo(je),Oe=l.useMemo(()=>({clientThreadId:s.id,turnIndex:n,messageId:i==null?void 0:i.id}),[s.id,n,i==null?void 0:i.id]),[Os,Hs]=l.useState(!1),[Vs,oa]=l.useState(!1),ia=l.useContext(Ho)!=null,V=c.role===z.User,os=xr(),Te=_r(s.id),is=(ft=c.gizmoId)!=null?ft:Te,Ce=Ir(is).data,rs=is&&!Sr(is)?Ce:void 0,ra=rs&&c.gizmoId!=null&&c.gizmoId!==Te&&Ne(u,"1418300125"),ds=ne(()=>na(s)),da=Tr(s.id),qe=Vo(ds),la=Lo(ds,da),ls=Cr(u),[ue,ca,ua,Ls,cs,ga,$e,Bs,ma,Us,us,me,ze,Ke,ha,Pe,w,pa]=ve(s.id,t=>{var en,sn,tn,nn,an;const r=L.getParentPromptNode(t,G.id),m=(nn=(en=r==null?void 0:r.message.clientMetadata)==null?void 0:en.variantsInStreamInfo)!=null?nn:(sn=r==null?void 0:r.message.metadata)!=null&&sn.paragen_variant_choice||(tn=r==null?void 0:r.message.metadata)==null?void 0:tn.paragen_variants_info,h=L.getVariantIds(t,G.id),q=L.getCurrentVariantId(t,G.id),Y=q?h.indexOf(q):0,Fe=m&&(t==null?void 0:t.tree)!=null&&h.some(de=>{var rn;const{errType:on}=(rn=t.tree.getLeafFromNode(de).message.clientMetadata)!=null?rn:{};return on!=null&&on!=="info"}),re=L.getConversationTurns(t),fe=re.findIndex(de=>de.role===z.Assistant),_o=En(re,de=>de.role===z.Assistant),Io=re.slice(fe,n+1).every(de=>de.role===z.Assistant);return[r,i!=null&&!Wr(i.id)&&L.isMessageTurnEnded(t,i.id),Fe,Hi(t==null?void 0:t.mode,Ce==null?void 0:Ce.gizmo.id),re.findIndex(de=>de.role===z.User)===n,En(re,de=>de.role===z.User)===n,fe===n,_o===n,Io,L.getRequestId(t,i==null?void 0:i.id),m,h,Y,!!(t!=null&&t.continuingFromSharedPostId),t==null?void 0:t.currentLeafId,L.getSuperWidgetMessages(t,n)[0],L.lastUserMessage(t),(an=t==null?void 0:t.continuingFromSharedProjectConversationId)!=null?an:null]},{disablePerfDetector:a}),ye=zn(),Qe=ne(()=>{const t=qr(s);return(t==null?void 0:t.value)===ts.STREAMING||(t==null?void 0:t.value)===ts.REALTIME}),fa=M.some(t=>t.content.content_type===yr.MultimodalText),ba=Mr(u,"3119715334").get("should-enable-skip",!1),Gs=!Ar(u),Ws=c.messages.map(t=>t.id),oe=l.useRef(null);hd({clientThreadId:s.id,turn:c,turnIndex:n,conversationTurnWrapperRef:oe});const gs=!B&&((bt=g==null?void 0:g.length)!=null?bt:0)>2&&g!=="finalAgentTurn"&&a,te=V?C(E):void 0,ms=te==null?void 0:te.id,va=l.useCallback(()=>{ms&&(De.logEvent("Edit Prompt",{id:ms,threadId:Ge(s.id)}),Ue(u,"chatgpt_edit_prompt"),Hs(!0))},[u,ms,s.id]),xa=l.useCallback(()=>{Hs(!1)},[]),{onChangeRating:_a}=Bo({clientThreadId:s.id,currentModelConfig:ds}),Ia=t=>{var q;if(!i)return;const r=(q=i.clientMetadata)==null?void 0:q.rating,h=(r==="thumbs_up"?"thumbsUp":r==="thumbs_down"?"thumbsDown":r)===t?null:t;if(_a({nodeId:i.id,messageId:i.id,rating:h}),h){const Y=Lr(()=>Br(u)),Fe=Y&&D.some(re=>{var fe;return re.type!==Ms&&((fe=re.messages)==null?void 0:fe.some(Ur))});De.logEventWithStatsig(h==="thumbsDown"?"Message Feedback Thumbs Down Clicked":"Message Feedback Thumbs Up Clicked","chatgpt_thumb_feedback",X(X({id:i.id,threadId:Ge(s.id),model:b,rating:h},Y?{isCATriggered:Fe}:{}),x?{isSidebar:!0}:{}))}oa(h==="thumbsDown")},[Sa]=l.useState(()=>Date.now()),Me=Er(s.id),qs=(xt=Me!=null?Me:pa)!=null?xt:ye&&(vt=s.sharedConversationId)!=null?vt:null,$s=(_t=Uo(s.id))==null?void 0:_t.value,zs=$s===ts.STREAMING,Ta=$s===ts.REALTIME,Ca=Us!=null,ya=Xn(Us),Ma=bn.useState(t=>bn.isReplayInProgress(t,ha)),ie=!ca&&ya||Q||zs||Ta||Ma&&a||S.some(t=>Go(t)),Ks=Zn(),hs=l.useRef(!1),Qs=l.useRef(void 0),Aa=wr({clientThreadId:s.id}),Ea=Wo(s.id,i)&&!Aa&&!!Me,[,wa]=yo(),{isOpen:Je}=js(),Js=ta(),ke=C(N==null?void 0:N.messages.filter(jr)),Xs=ne(()=>$r(u,zr.AtlasAdultSearchAllowed)),Xe=qo({conversation:s,threadContent:(It=Pe==null?void 0:Pe.content)!=null?It:null,query:ke?As(ke):null,triggeredSearch:K,messageGroups:Z,allMessages:S,isAdultSearchEnabled:Xs}),{isClassifiedAdult:Zs,isSafeSearchOff:ja}=Xe,[Pa,ps]=ne(()=>[Kr(u)&&$e&&(!W||W.length===0||W.includes(Be.Search))&&!Zs,Qr(u)&&_&&c.role===z.Assistant&&Zs&&ja&&Xs]),he=(Pa||ps)&&Xe.showNavlinksWidget,fs=M.filter(Cn),ka=he&&fs.length===0&&!T,Ys=((St=w==null?void 0:w.author.metadata)==null?void 0:St.real_author)==="onboarding",et=_&&$e&&he&&Xe.showLongList;l.useEffect(()=>{const r=new URLSearchParams(window.location.search).get("message");!(r!=null&&Ws.includes(r))||!oe.current||(oe.current.scrollIntoView({behavior:"instant"}),wa(h=>(h.delete("message"),h),{replace:!0,preventScrollReset:!0}))},[]),l.useEffect(()=>{g!==Qs.current&&(hs.current=!1,Qs.current=g)},[g]),l.useEffect(()=>{if(B)return;const m=new URLSearchParams(window.location.search).get("message")!=null;if(hs.current||m||g===void 0||!oe.current||Js||Ys||et){g==="finalAgentTurn"&&a&&_e(s.id,h=>{h.scrollToMessageId=void 0});return}(Ws.includes(g)||g==="finalAgentTurn"&&a)&&(hs.current=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(oe.current)if(g==="finalAgentTurn"&&a)oe.current.scrollIntoView({behavior:"instant",block:"end"}),_e(s.id,h=>{h.scrollToMessageId=void 0});else{const h=oe.current.offsetHeight;let q=0;Je?q=-8:_?q=-1*Es:p?q=-8:h>Bn&&(q=Bn-h);const Y=$o(s).pinnedWidgetHeight$();Y!=null&&(q+=Y+Es),oe.current.style.scrollMarginTop="".concat(q+Es,"px"),oe.current.scrollIntoView({behavior:"smooth"})}})}))},[g,p,oe.current,Je,Js,Ys,et]);const{showDebugConversationTurns:Ra}=sa(),Fa=!ye&&!Ke&&!os&&!V,Na=(f==null?void 0:f.author.role)===z.Assistant?f:null,Da=(Ct=(Tt=f==null?void 0:f.metadata)==null?void 0:Tt.system_hints)==null?void 0:Ct.includes(Be.Research),Oa=(Mt=(yt=f==null?void 0:f.metadata)==null?void 0:yt.system_hints)==null?void 0:Mt.includes(Be.Agent);zo({isCompletionRequestInProgress:ie,isUserTurn:V,message:Na});const{isOpen:Ha}=js(),Va=Ko(u),Ze=Qo(Ls),La=Pr(t=>t.voiceFeedbackThread),st=Me===La,Ba=(At=i==null?void 0:i.metadata)==null?void 0:At.async_source,Ye=a&&Ca,pe=Qe||ie||zs,Ua=E.length===0&&M.some(kr),Ga=((Et=Jo(E))==null?void 0:Et.author.name)===yn.A8KM123&&Xo(E,t=>t.author.name===yn.A8KM123||t.channel==="commentary"||t.author.role===z.Developer),Wa=Zo.useIsMultigenParagenVotingActive(),bs=!Os&&!M.every(Rr)&&!ye&&!Ke&&!Ze&&!Ha&&c.role!==z.Developer&&!(c.role===z.User&&O)&&!(a&&st&&pe)&&!(Ye&&pe)&&!(a&&Qe&&Ba)&&!(pe&&T)&&!(Ga&&!a)&&!((wt=i==null?void 0:i.metadata)!=null&&wt.is_auto_proceed_message)&&!((jt=i==null?void 0:i.metadata)!=null&&jt.is_takeover_ended_message)&&!((Pt=i==null?void 0:i.metadata)!=null&&Pt.disable_turn_actions)&&!ka&&!c.userContinuationSuccessorTurnId&&!le&&!Wa,qa=!bs&&!(Ye&&pe)&&(ye||Ke)&&!x,$a=M.some(t=>Fr(t)===Nr.l1239dk1),vs=ve(s.id,t=>{var h,q;const r=new Set,m=L.getParentPromptNode(t,G.id);return(q=(h=m==null?void 0:m.message.metadata)==null?void 0:h.attachments)==null||q.forEach(Y=>{var Fe,re,fe;(Fe=Y.mime_type)!=null&&Fe.startsWith("image/")||r.add((fe=(re=Y.context_connector_info)==null?void 0:re.context_connector)!=null?fe:"file")}),r}),xs=Dr(),_s=Mn(u,"110789670");let Ae;xs.isLoading?Ae=void 0:xs.canUpgradeGDrive&&vs.has(ns.GDRIVE)&&_s.get("enabled",!1)?Ae=ns.GDRIVE:xs.canUpgradeSharepoint&&vs.has(ns.O365_BUSINESS)&&_s.get("enabled",!1)?Ae=ns.O365_BUSINESS:vs.has("file")&&_s.get("enabled",!1)&&(Ae="general");const za=(f==null?void 0:f.author.role)===z.Assistant&&((Ft=(Rt=(kt=f==null?void 0:f.metadata)==null?void 0:kt.content_references)==null?void 0:Rt.length)!=null?Ft:0)>0||Se,Ka=Ye&&!ie&&!x&&!ye&&!Ke&&!$a&&(ae||Yo(u)||We||je||!!Ae),He=i!=null&&(!y||la||J||ls)&&!Ze&&!Gs&&!os&&!((Nt=i.metadata)!=null&&Nt.b1de6e2_s),tt=Qe||ie,[Qa,Ja]=l.useState(!1),Xa=!!((Dt=w==null?void 0:w.metadata)!=null&&Dt.dictation&&((Ot=w==null?void 0:w.metadata)!=null&&Ot.dictation_asset_pointer)&&!((Ht=w==null?void 0:w.metadata)!=null&&Ht.dictation_edited)),Za=!!(!A||Qa||(Vt=w==null?void 0:w.metadata)!=null&&Vt.audio_paragen_result||vn(w==null?void 0:w.id)),nt=Xa&&!Za,at=nt&&(!y||ls)&&He&&!tt&&!x&&!Je&&w!=null&&$e&&Ne(u,"51772912"),Ya=ei(w==null?void 0:w.id,at),ot=at&&Ya,Ve=!Ze&&Fa&&a&&(us==null?void 0:us.num_variants_in_stream)===2&&me.length<=2&&!((Lt=i==null?void 0:i.clientMetadata)!=null&&Lt.inlineComparisonRating)&&!ua&&!nt&&!vn(w==null?void 0:w.id),it=!ot&&(!y||ls)&&He&&(Ye||a&&st)&&!tt&&!x&&!Je&&!T&&!le,rt=!((ie||Qe)&&a)&&me.length>1&&!Ve,dt=V&&M.some(t=>{var r;return(r=xn(t))==null?void 0:r.shouldHideContent}),eo=V&&te!=null&&!((Bt=te==null?void 0:te.metadata)!=null&&Bt.async_task_id)&&Me!=null&&!Ze&&!fa&&!dt&&!Gs&&!Da&&!Oa&&!x,so=i!=null&&An.getAudioAssetPointers(i).length>0,to=i!=null&&((Gt=(Ut=i.clientMetadata)==null?void 0:Ut.disclaimers)!=null?Gt:[]).length===0&&!x&&(!os||so)&&!j,lt=l.useCallback(t=>{var r;_e(s.id,m=>{Fs.setCurrentBranch(m,me[t])}),De.logEvent("Change Active Node",{intent:"toggle_between"}),Ne(u,"4126691920")&&si({parent_prompt_id:(r=ue==null?void 0:ue.id)!=null?r:"",prev_branch_id:me[ze],next_branch_id:me[t]},Ge(s.id))},[s.id,me,ze,ue==null?void 0:ue.id,u]),ct=ti(c,M,Ra),ut=T&&ni(M,a),es=i==null?void 0:i.id,Is=l.useCallback(()=>{es&&ai(s,{type:"retrievalResults",turnIndex:n,messageId:es})},[s,es,n]),Re=M.some(t=>{var r,m,h;return((r=t==null?void 0:t.metadata)==null?void 0:r.api_tool_type)==="glaux"||Or({id:(h=(m=t==null?void 0:t.metadata)==null?void 0:m.model_slug)!=null?h:""},u)}),Ss=l.useMemo(()=>oi(c,qe,!!Te),[c,qe,Te]),no=l.useMemo(()=>Ss&&!Re,[Ss,Re]),ao=l.useMemo(()=>ii(c,!!Te,P),[P,Te,c]),gt=Ne(u,"2137702454"),oo=l.useMemo(()=>c.role!==z.User&&qe&&gt&&!Re,[c,qe,gt,Re]),io=Hr()&&CSS.supports("content-visibility: auto")&&!V&&Mn(u,"1011775750").get("enabled",!1)&&!ri(M),ro=l.useMemo(()=>M.some(t=>{var r;return((r=xn(t))==null?void 0:r.canRetry)===!1}),[M]),lo=(Wt=i==null?void 0:i.metadata)==null?void 0:Wt.n7jupd_button_type,co=T&&i!=null&&i.id!=null&&!lo,uo=T&&a&&pe,go=T&&a;if(!ct&&!Ve&&!he)return gs?e.jsx("div",{style:ws()}):null;if(ut||$)return null;const mo=(qt=f==null?void 0:f.metadata)!=null&&qt.followup_prompts?f.metadata.followup_prompts.map(t=>({text:t,type:di.Reply})):[],ho=($t=f==null?void 0:f.metadata)==null?void 0:$t.category_suggestions,po=(zt=f==null?void 0:f.metadata)==null?void 0:zt.action_suggestions,fo=!M.some(t=>An.getAudioAssetPointers(t).length>0)&&!Te&&!ro&&!j&&!Ie&&!!Me,bo=!ie&&M.some(t=>{var r,m;return t.author.role===z.Assistant&&((m=(r=t.metadata)==null?void 0:r.onboarding)==null?void 0:m.main_usages)});ue==null||ue.message.id;const Ts=M.find(t=>{var r,m;return!!((m=(r=t.metadata)==null?void 0:r.onboarding)!=null&&m.examples)}),Cs=(Qt=(Kt=Ts==null?void 0:Ts.metadata)==null?void 0:Kt.onboarding)==null?void 0:Qt.examples,mt=!dt&&(!a||!ie);if(!a&&fs.length===0&&!T&&!he)return null;let Le="none";V&&cs&&(Le="first");const vo=N==null?void 0:N.messages.some(Cn);if(V&&!cs&&(vo?Le="large":Le="none"),a&&(Le="last"),!ct&&!Ve&&!he)return gs?e.jsx("div",{style:ws()}):null;if(ut||$)return null;const ht=_?li(S):void 0;if(!a&&fs.length===0&&!T&&!he)return null;const xo=(()=>{if(c.userContinuationSuccessorTurnId)return"mb-1";if(V&&!bs&&!x)return"mb-10";if(!V&&x&&a)return"pb-[40px]"})();return e.jsx(ci.Provider,{value:$e,children:e.jsxs(ui,{children:[e.jsx(gi,{dateHeaderType:v,turn:c}),e.jsxs("article",{className:ge("text-token-text-primary w-full focus:outline-none","[--shadow-height:45px] has-data-writing-block:pointer-events-none has-data-writing-block:-mt-(--shadow-height) has-data-writing-block:pt-(--shadow-height) [&:has([data-writing-block])>*]:pointer-events-auto",io&&"[content-visibility:auto] supports-[content-visibility:auto]:[contain-intrinsic-size:auto_100lvh]",!B&&g==="finalAgentTurn"?"opacity-0":"",{hidden:ia&&cs},V?"scroll-mt-(--header-height)":"scroll-mt-[calc(var(--header-height)+min(200px,max(70px,20svh)))]"),tabIndex:-1,style:gs?ws():void 0,ref:oe,dir:"auto","data-turn-id":c.id,"data-testid":"conversation-turn-".concat(n),"data-scroll-anchor":!B&&a,"data-turn":V?"user":"assistant",children:[e.jsx(mi,{role:c.role,gizmo:rs}),e.jsx(hi,{role:c.role,children:e.jsxs(Kn,{horizontalPadding:Ve||H?"none":"standard",verticalPadding:Le,children:[Ve?e.jsxs(e.Fragment,{children:[e.jsx(rd,X({isFeedbackEnabled:He,variantIds:me,conversationTurnMountTime:Sa},o)),ba&&e.jsx("div",{className:"mt-4 flex w-full justify-center",children:e.jsxs(ea,{color:"secondary",className:"text-token-text-primary","data-testid":"paragen-skip-button",onClick:()=>{Yn.publish({kind:"requestCompletion",isForSkippingParagen:!0})},children:[e.jsx(ld,{className:"text-token-text-secondary me-1"}),e.jsx(xe,{id:"IuTr+b",defaultMessage:"Skip"})]})})]}):e.jsxs(Ps,{tabIndex:-1,className:ge("group/turn-messages focus-visible:outline-hidden",he&&"super-widget-visible",xo,Ri({isUserTurn:V})),children:[ra&&e.jsx(pi,{gizmo:rs}),he&&e.jsx(fi,{clientThreadId:s.id,query:ke?As(ke):null,state:Xe,isAssistantResponseSuppressed:!!ps}),oo&&e.jsx(bi,{handleShowRetrievalResults:Is,clientThreadId:s.id,turnIndex:n,responseComplete:!pe,className:"mb-6"}),!V&&e.jsx(cd,{messages:M,clientThreadId:s.id,gizmoId:Ce==null?void 0:Ce.gizmo.id}),M.some(t=>{var r,m,h;return(h=(r=t.metadata)==null?void 0:r.async_completion_id)!=null?h:V&&((m=t.metadata)==null?void 0:m.async_task_title)})&&e.jsx(vi,{message:M.find(t=>{var r,m,h;return(h=(r=t.metadata)==null?void 0:r.async_completion_id)!=null?h:V&&t.author.role===z.User&&((m=t.metadata)==null?void 0:m.async_task_title)}),clientThreadId:s.id,isUserTurn:V}),Va&&V&&e.jsx(ud,{clientThreadId:s.id,messages:M}),Os&&te?e.jsx(Ln,{message:te,clientThreadId:s.id,onRequestCompletion:d,onExitEdit:xa,disabled:Ks}):!ps&&e.jsx(Rs,be(X({allMessages:S,groupedMessagesToRender:Z,allGroupedMessages:D},o),{isUserTurn:V,isFinalUserTurn:ga,isFinalAssistantTurn:Bs,isWithinFirstAssistantTurns:ma,isCompletionRequestInProgress:ie,isFeedbackEnabled:He,isFinalTurn:a,isGlauxTurn:Re,hasActiveRequest:Ks,isAgentTurn:T,isKAUR1BR5:se,query:ke?As(ke):null,wasInterrupted:Ua,superWidgetContent:(Jt=Pe==null?void 0:Pe.content)!=null?Jt:null,lastAgentMetadataNode:I,hasSearchSystemHint:(Xt=W==null?void 0:W.includes(Be.Search))!=null?Xt:!1})),no&&(U&&ao?e.jsx(gd,{turnIndex:n,clientThreadId:s.id,variant:"bottom"}):e.jsx(_n,{handleShowRetrievalResults:Is,clientThreadId:s.id,turnIndex:n,responseComplete:!pe})),co&&e.jsx(xi,{message:i,clientThreadId:s.id,turnIndex:n,referenceMessageId:i.id,responseComplete:!a||!ie}),bo&&e.jsx(_i,{clientThreadId:s.id}),Cs&&Cs.length>0&&!ie&&e.jsx(Ii,{clientThreadId:s.id,examples:Cs}),ht&&e.jsx(Si,{message:ht,className:"mt-4"}),bs&&e.jsx(sd,{isUserTurn:V,alwaysShow:!0,children:V?x?null:e.jsx(td,{activeVariantIndex:ze,clientThreadId:s.id,numVariants:me.length,onAnticipateEdit:Ln.prefetch,onChangeIndex:lt,onEnterEdit:va,showCopyButton:mt,showEditMessageButton:eo,showPagination:rt,turnIndex:n,reportableMessageId:(Zt=te==null?void 0:te.id)!=null?Zt:null,isSharedConversation:ye,serverThreadIdForReporting:qs}):e.jsxs(e.Fragment,{children:[e.jsx(nd,{activeVariantIndex:ze,clientThreadId:s.id,conversationMode:Ls,lastMessage:i,messages:M,numVariants:me.length,onChangeIndex:lt,onRate:Ia,showCanvasButton:Ea,showCopyButton:mt,showPagination:rt,showPlayButton:to,showRatingButtons:He,showRegenerateButton:fo,turn:c,turnIndex:n,parentPrompt:ue,isAgentTurn:T,isKAUR1BR5:se,reportableMessageId:(Yt=i==null?void 0:i.id)!=null?Yt:null,isSharedConversation:ye,serverThreadIdForReporting:qs}),Re&&Ss?e.jsx(_n,{handleShowRetrievalResults:Is,clientThreadId:s.id,turnIndex:n,responseComplete:!pe}):e.jsx(e.Fragment,{children:!F&&e.jsx(In,{clientThreadId:s.id,message:i,turnIndex:n,isAgentTurn:T})}),it&&e.jsx(Ti,{canShowInlineMessageFeedback:Vs,clientThreadId:s.id,messageForRating:i}),!1]})}),Bs&&S.some(Ci)&&!S.some(yi)&&e.jsx(Mi,{isCompletionRequestInProgress:ie,conversation:s,messages:S}),uo&&e.jsx(Ai,{clientThreadId:s.id}),go&&e.jsx(Ei,{clientThreadId:s.id,messages:M}),qa&&e.jsx(In,{clientThreadId:s.id,message:i,turnIndex:n,isAgentTurn:T}),!1,it&&e.jsx(wi,{canShowInlineMessageFeedback:Vs,clientThreadId:s.id,messageForRating:i,allGroupedMessages:D,currentModelId:b}),e.jsx(Vr,{mode:"wait",children:ot&&e.jsx(ji,{lastUserMessageId:w.id,setIsDismissed:Ja})}),Ka&&(Ae?e.jsx(Pi,{clientThreadId:s.id,connectorToUpsell:Ae,analyticsMetadata:Oe}):e.jsx(ki,{followups:mo,actionSuggestions:po,categorySuggestions:ho,clientThreadId:s.id,lastMessageId:es,analyticsMetadata:Oe,isTatertotFollowupsEnabled:je,shouldHideFollowups:za}))]}),e.jsx(Fi,{clientThreadId:s.id,turn:c,isFinalTurn:a}),e.jsx(Ni,{clientThreadId:s.id,turn:c})]})})]})]})})}const hd=({clientThreadId:o,turn:n,turnIndex:a,conversationTurnWrapperRef:s})=>{const d=Di();l.useEffect(()=>{if(!d)return;const b=new IntersectionObserver(g=>{g.forEach(p=>{p.isIntersecting?_e(o,v=>{var O;v.turnIdsInViewpoint=[...(O=v.turnIdsInViewpoint)!=null?O:[],{turnId:n.id,turnIndex:a,role:n.role}]}):_e(o,v=>{var O;v.turnIdsInViewpoint=(O=v.turnIdsInViewpoint)==null?void 0:O.filter(({turnId:H})=>H!==n.id)})})},{root:null,threshold:.1});return s.current&&b.observe(s.current),()=>{_e(o,g=>{var p;g.turnIdsInViewpoint=(p=g.turnIdsInViewpoint)==null?void 0:p.filter(({turnId:v})=>v!==n.id)}),b.disconnect()}},[o,s,d,n.id,n.role,a])},pd=qn.memo(md),Un=we(()=>Ee(()=>import("./bo8mdhc1oc1583ww.js"),__vite__mapDeps([18,1,2,3,4,5])).then(o=>o.ThreadReportConversationModal));function wd(o){const{prefetchNavlink:n,clearPrefetchNavlink:a,conversation:s,pageLoadSearchQuery:d}=o,b=Ns(),g=$n(b),p=Vi(s.id),v=Li(),O=Bi(),[H,u]=ne(()=>[ed(b),Ds(b)]),[B]=Ui(),{isOpen:R}=js(),j=O.store.useContentAreaDimensions(Gi.Header,y=>y!=null&&y.height?y.height:void 0);let x=null;j||(x=!g&&R?"max-sm:pb-25":"pb-25",H?x=B===Wi.Chat?"pb-12":"pb-13":u&&(x="pb-0"));let _=e.jsx(fd,X({isNewScrollEnabled:g},o));const J=qi();return J&&(_=e.jsx($i,{clientThreadId:s.id,children:_})),_=e.jsx(zi,{clientThreadId:s.id,children:_}),e.jsxs("div",{onCopy:p,className:ge("flex flex-col text-sm",J?"pt-4":u?"thread-xl:pt-0 pt-0":"thread-xl:pt-header-height",v&&"keyboard-open:pb-[calc(var(--composer-height,100px)+var(--screen-keyboard-height,0))]",x),style:{paddingBottom:j},children:[d&&e.jsx("div",{children:e.jsx(od,{query:d})}),n?e.jsx(Jr,{name:"prefetch-navlink",onError:y=>{ks.addError("Error with prefetch navlink",{error:y}),a()},children:e.jsx(l.Suspense,{fallback:null,children:e.jsx(id,{clientThreadId:s.id,prefetchNavlink:n,clearPrefetchNavlink:a})})}):null,e.jsx(Xr,{children:_})]})}function fd({onRequestCompletion:o,conversation:n,scrollContainerRef:a,isNewScrollEnabled:s}){var G,i,K,T,le;const d=Ns(),b=ne(()=>Ds(d)),[g,p,v,O,H,u]=ve(n.id,I=>[L.getConversationTurnIds(I),I==null?void 0:I.pulseCardId,I==null?void 0:I.scrollToMessageId,I==null?void 0:I.scrollToMessageIsAssistant,L.hasUserMessage(I),L.isMessageTurnEnded(I)]),B=Qn(d),R=ne(()=>Sn(d)&&B.isCardModalOpen$()),j=ne(()=>Sn(d)&&B.isFeedbackModalOpen$()),x=ne(()=>sr(d)),{data:_}=Ki(p),J=p&&!H,y=zn(),ee=ta(),U=Zr(),P=ne(()=>na(n));Qi({isSharedConversation:y,clientThreadId:n.id}),l.useEffect(()=>{y&&(Ue(d,"chatgpt_continue_conversation_page_loaded"),De.logEvent("Continue Conversation: Page Loaded"),Ue(d,"chatgpt_conversation_share_page_loaded"),De.logEvent("Share Public Chat: Shared Conversation Loaded"))},[d,y]);const F=ne(()=>n.id?tr(n).activeSystemHintSuggestionChips$():[]),[A,c]=l.useState(!1),[$,N]=l.useState(!1),S=l.useRef(null),D=Ji(n.id),k=ee&&!U;return e.jsxs(e.Fragment,{children:[j&&e.jsx(Xi,{}),k&&e.jsx(ad,{}),y&&e.jsxs(e.Fragment,{children:[e.jsx(Ps,{children:e.jsx("p",{className:"text-xs text-gray-500",children:e.jsx(xe,{id:"threadLayout.sharedConversationCopyDisclaimer",defaultMessage:"This is a copy of a conversation between ChatGPT & Anonymous."})})}),e.jsx("div",{className:"text-token-text-primary mb-5 text-center text-xs font-semibold",children:e.jsx("button",{onPointerOver:()=>Un.prefetch(),onClick:()=>{Yr(d,Un,{clientThreadId:n.id,serverThreadId:n.sharedConversationId,isSharedConversation:!0,isStaticSharedThread:!1}),Ue(d,"chatgpt_conversation_share_report_content_clicked",void 0,{location:"Static Shared Thread Page"}),De.logEvent("Share Public Chat: Report Content Clicked",{location:"Dynamic Shared Thread Page"})},children:e.jsx(xe,{id:"thread.reportSharedConversation",defaultMessage:"Report conversation"})})})]}),_&&e.jsx(Kn,{horizontalPadding:"standard",horizontalMargin:"none",children:e.jsx(Ps,{children:e.jsx(Zi,{imageSrc:(i=(G=_.image)==null?void 0:G.url)!=null?i:"",fallbackSrc:(T=(K=_.image)==null?void 0:K.fallback_url)!=null?T:"",title:(le=_.title)!=null?le:"",cardId:p})})}),g.map((I,se)=>{var ce;return e.jsx(qn.Fragment,{children:e.jsx(pd,{isFinalTurn:se===g.length-1,turnIndex:se,conversation:n,onRequestCompletion:o,currentModelId:(ce=P==null?void 0:P.id)!=null?ce:null,scrollToMessageId:s||J?void 0:v,scrollToMessageIsAssistant:s||J?void 0:O,dateHeaderType:D(se)},I)},I)}),!s&&e.jsxs(e.Fragment,{children:[(a==null?void 0:a.current)&&e.jsx(wn,{setIsScrolledToEdge:I=>{c(I)},options:{root:a.current,threshold:0,rootMargin:"0%"}},"threadBottomEdgeScrollObserver"),e.jsx("div",{ref:S}),R&&(a==null?void 0:a.current)&&e.jsx(wn,{setIsScrolledToEdge:I=>{N(!I)},options:{root:a.current,threshold:0,rootMargin:"-30px 0px"}},"pulseCardModalEdgeScrollObserver"),R&&e.jsx(Yi,{show:$&&u}),e.jsx(er,{show:A&&!F.length&&!b&&!j&&!x,className:ge("bottom-[calc(var(--composer-overlap-px)+--spacing(6))]"),onClick:()=>{var I;Ue(d,"chatgpt_thread_scroll_to_bottom"),(I=S.current)==null||I.scrollIntoView({behavior:"smooth",block:"end"})}})]})]})}export{pd as C,wd as T};
//# sourceMappingURL=c929hhheh8pnurrs.js.map
