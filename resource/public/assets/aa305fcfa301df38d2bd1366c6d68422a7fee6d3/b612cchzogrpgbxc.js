const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/d9d46aun6hvzsagm.js","assets/bubexfvksfr7893o.js","assets/9paxni9f8n7suc5d.js","assets/lm3g1zm00rp6al39.js","assets/ncw8zw682jinppua.js","assets/root-ookb7xuw.css","assets/conversation-small-lq38g8zw.css","assets/kivvchsexr54fuso.js","assets/hbcnisqpfdzhue92.js","assets/hp4kvwk57p1zvpfr.js","assets/paev76b70tpkjsm5.js","assets/irmkfkn816hri3f1.js"])))=>i.map(i=>d[i]);
var at=Object.freeze,rt=Object.defineProperty,It=Object.defineProperties;var qt=Object.getOwnPropertyDescriptors;var ve=Object.getOwnPropertySymbols;var nt=Object.prototype.hasOwnProperty,it=Object.prototype.propertyIsEnumerable;var ot=(t,s,a)=>s in t?rt(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,d=(t,s)=>{for(var a in s||(s={}))nt.call(s,a)&&ot(t,a,s[a]);if(ve)for(var a of ve(s))it.call(s,a)&&ot(t,a,s[a]);return t},I=(t,s)=>It(t,qt(s));var ie=(t,s)=>{var a={};for(var o in t)nt.call(t,o)&&s.indexOf(o)<0&&(a[o]=t[o]);if(t!=null&&ve)for(var o of ve(t))s.indexOf(o)<0&&it.call(t,o)&&(a[o]=t[o]);return a};var lt=(t,s)=>at(rt(t,"raw",{value:at(s||t.slice())}));import{_ as Y,j as e,h as ae,r as g,M as m,e as ee,b as te,L as Wt,g as Rt,y as Bt}from"./bubexfvksfr7893o.js";import{ve as oe,vf as Mt,az as Z,cz as A,aB as R,aA as J,kG as z,rc as Me,r8 as Ft,vg as Ht,vh as Te,vb as de,jg as ue,dS as yt,d5 as Kt,vi as _t,aC as bt,vj as X,vk as xe,vl as _e,_ as b,R as K,vm as ke,r9 as be,vn as ct,vo as jt,vp as $t,vq as wt,cr as kt,L as Vt,e7 as je,g_ as Qt,mS as Yt,u as Le,bd as Ct,kq as Zt,vr as Jt,J as Xt,cw as es,hK as ts}from"./ncw8zw682jinppua.js";import{r as ss}from"./bnh7zkn4xutjm6i9.js";import{bo as as,h4 as V,gJ as Ut,uK as St,x as os,nt as rs,a_ as ge,bZ as ns,bt as is,lF as ls,aZ as cs}from"./lm3g1zm00rp6al39.js";import{S as ds}from"./boj7ctg8ggfk4dia.js";import{d as us}from"./o4m46p2hmbpmbw32.js";import{v as P,p as Tt}from"./dhsa2d3zcy4je6ke.js";import{L as ms}from"./75duwk5egbi68snc.js";import{V as gs,u as ps,O as le}from"./i15sh5jedxkffgwt.js";import{G as hs}from"./ovq272825mnnvd9p.js";import{e as fs,M as Ue}from"./m4j0s403ebgyfqdl.js";import{c as xs,a as vs}from"./edtxqudzw0vjv8nu.js";import{u as Ms,b as ys}from"./n6y3adntgummmkiw.js";import"./ke3w2t9x8i7kgfhv.js";import"./ffjw65gjnc6j0nz8.js";import"./galyil7vygq0i5a6.js";import"./kf7tqzde2yk57qjr.js";import"./d9ec94om23qfz1v2.js";import"./luif5kl8klbqcpjy.js";import"./ng29wvm3o2y0a25k.js";import"./krengkwf9us2g646.js";import"./ip2dsbq9712r5wna.js";import"./o45zl9yl00508gad.js";import"./mxzk2kf77c8eueuw.js";import"./bc00p2ldn9cv9q32.js";import"./8ix1du5tuckfsvqq.js";import"./fwn4bwvyx3h4ty5g.js";import"./l1teaxoievyk0rz1.js";import"./nbm98bu0q3774lnr.js";import"./i9ddjt6oaiw4vo4g.js";import"./hzasobp3hhjtq47p.js";import"./jro698t78r3v26vt.js";import"./fum95d46v8d5jv8u.js";import"./n2u3q2i5341kdx8j.js";import"./j703u6xl4odnuo39.js";import"./me0ap2djy50z6upd.js";const Q=oe(Mt(new Date,1)),se=new Date,_s=Z(()=>Y(()=>import("./d9d46aun6hvzsagm.js"),__vite__mapDeps([0,1])),{loading:t=>J(t)}),bs=Z(()=>Y(()=>import("./9paxni9f8n7suc5d.js"),__vite__mapDeps([2,1])),{loading:t=>J(t)});function Ce({onLeft:t,leftDisabled:s,onRight:a,rightDisabled:o,children:r,className:n,borderLess:i=!1,surpressChildrenWrapper:u=!1}){return e.jsxs("div",{className:A("flex items-stretch",n),children:[e.jsx(R,{className:A("disabled:text-token-text-quaternary pe-1",!i&&"border-token-border-medium rounded-e-none border-e-0 disabled:opacity-100"),color:i?"ghost":"secondary",size:"small",onClick:t,disabled:s,icon:bs}),u?r:e.jsx("span",{className:A("flex grow items-center justify-center px-1 text-sm",!i&&"border-token-border-medium border-t border-b"),children:r}),e.jsx(R,{className:A("disabled:text-token-text-quaternary ps-1",!i&&"border-token-border-medium rounded-s-none border-s-0 disabled:opacity-100"),color:i?"ghost":"secondary",size:"small",onClick:a,disabled:o,icon:_s})]})}const js=ss(12);function Lt({referenceDate:t,setReferenceDate:s,earliestValidDate:a,latestValidDate:o,motionLayoutId:r}){return e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"mb-2 w-full",borderLess:!0,onLeft:()=>s(Mt(t,1),"subYear"),onRight:()=>s(Ft(t,1),"addYear"),leftDisabled:Me(new Date)>=Me(t)+1,rightDisabled:Me(new Date)<=Me(t),children:z(t,"y")}),e.jsx("div",{className:"grid grid-cols-3 gap-1",children:js.map(n=>{const i=oe(Ht(t,n)),u=Te(i,t),l=de(i,a)||ue(i,o);return e.jsxs("button",{disabled:l,onClick:()=>s(i,"select"),className:A("relative h-8 w-full rounded-md",!l&&"hover:bg-token-surface-hover"),children:[u&&e.jsx(yt.div,{layoutId:r,className:"bg-token-main-surface-primary-inverse absolute inset-0 rounded-md",transition:{duration:.15}}),e.jsx("span",{className:A("relative z-10 transition-colors duration-75",u&&"text-token-main-surface-primary delay-75",!u&&"text-token-text-primary delay-0",l&&"text-token-text-quaternary"),children:z(i,"MMM")})]},n)})})]})}const ws=Z(()=>Y(()=>import("./lm3g1zm00rp6al39.js").then(t=>t.zv),__vite__mapDeps([3,1,4,5,6])),{loading:t=>J(t)});function ks({currentWorkspaceId:t,currentTab:s,onClose:a}){var y;const o=ae(),[r,n]=g.useState(!1),[i,u]=g.useState(s==="gptsTab"?"gpt":"user"),[l,p]=g.useState("thisMonth"),[c,C]=g.useState(),f=(y=Kt(w=>{var v;return(v=w.currentWorkspace)==null?void 0:v.name}))!=null?y:t,U=new Date,x=_t(new Date,1);return e.jsxs(bt,{testId:"modal-export",isOpen:!0,onClose:()=>{a(),b.logEvent("Workspace Usage: Export Modal Closed Without Generation")},type:"success",title:e.jsx(m,d({},D.title)),showCloseButton:!0,primaryButton:e.jsx(R,{loading:r,onClick:async()=>{var w,v;n(!0);try{const h=l==="customRange"?{period:(w=c==null?void 0:c.period)!=null?w:fe.period,period_start:P((v=c==null?void 0:c.referenceDate)!=null?v:fe.referenceDate)}:Ss(l);b.logEvent("Workspace Usage: Export Generate CSV Clicked",{reportType:i,dateRangeType:l,period:h.period,periodStart:h.period_start});const M=await K.safeGet("/accounts/{account_id}/reporting",{parameters:{path:{account_id:t},query:I(d({},h),{report_type:i})}});us({data:M.csv_content,mimeType:"text/csv",filename:o.formatMessage(D.filename,{workspaceName:f,period:h.period,reportType:i,date:h.period_start})})}finally{n(!1)}a()},children:e.jsx(m,d({},D.generateCsvButton))}),children:[e.jsxs(ms,{className:"font-medium",children:[e.jsx(m,d({},D.dataTypeDropdownLabel)),e.jsx(as,{triggerClassName:"flex mt-2 border border-token-border-default text-base focus-visible:border-token-border-default w-full justify-between",value:i,onValueChange:w=>u(w),options:[{label:o.formatMessage(D.dataTypeDropdownUsers),value:"user"},{label:o.formatMessage(D.dataTypeDropdownGpts),value:"gpt"}]})]}),e.jsx("div",{className:"mt-6 mb-2 font-medium",children:e.jsx(m,d({},D.dateRangeLabel))}),e.jsxs(V.Root,{className:"flex flex-col gap-3",value:l,onValueChange:w=>{p(w),b.logEvent("Workspace Usage: Export Date Range Type Changed",{dateRangeType:w})},children:[e.jsx(V.Item,{value:"thisMonth",label:e.jsx(m,I(d({},D.thisMonthLabel),{values:{date:z(U,"MMMM y")}})),children:e.jsx(V.Indicator,{})}),e.jsx(V.Item,{value:"lastMonth",label:e.jsx(m,I(d({},D.lastMonthLabel),{values:{date:z(X(U,1),"MMMM y")}})),children:e.jsx(V.Indicator,{})}),e.jsx(V.Item,{value:"thisWeek",label:e.jsx(m,I(d({},D.thisWeekLabel),{values:{date:"".concat(z(xe(U),"MMM d")," – ").concat(z(_e(U),"MMM d"))}})),children:e.jsx(V.Indicator,{})}),e.jsx(V.Item,{value:"lastWeek",label:e.jsx(m,I(d({},D.lastWeekLabel),{values:{date:"".concat(z(xe(x),"MMM d")," – ").concat(z(_e(x),"MMM d"))}})),children:e.jsx(V.Indicator,{})}),e.jsx(V.Item,{value:"customRange",label:e.jsx(Cs,{customRange:c,setCustomRange:C,onClick:()=>p("customRange")}),children:e.jsx(V.Indicator,{})})]})]})}const fe={period:"monthly",referenceDate:new Date};function Cs({customRange:t,setCustomRange:s,onClick:a}){const o=ae(),r=(t!=null?t:fe).period,n=(t!=null?t:fe).referenceDate,i=r==="monthly"?ke(n):_e(n),u=({period:l,referenceDate:p})=>s((c=fe)=>{const C=l!=null?l:c.period,f=p!=null?p:c.referenceDate,U=C==="monthly"?oe:xe,x=ue(f,se)?se:de(f,Q)?Q:f;return{period:C,referenceDate:U(x)}});return e.jsx(Ut,{className:"z-50",alignAgainstAnchor:"start",triggerButton:e.jsxs(R,{size:"small",color:"secondary",contentsFullWidth:!0,onClick:a,children:[t?e.jsx(m,I(d({},D.customRangeDisplay),{values:{start:ct(t.referenceDate),end:ct(i)}})):e.jsx(m,d({},D.chooseMonthOrWeekButton)),e.jsx("div",{className:"grow"}),e.jsx(ws,{})]}),children:e.jsxs("div",{className:"w-[210px] p-1 text-xs",children:[e.jsx(ds,{className:"mb-4 rounded-md",value:r,onChange:l=>{u({period:l}),b.logEvent("Workspace Usage: Export Custom Period Changed",{period:l})},ariaLabel:o.formatMessage(D.customRangePeriodToggleAria),leftItem:{className:"rounded-md",ariaLabel:o.formatMessage(D.chooseDateMonthlyLabel),label:o.formatMessage(D.chooseDateMonthlyLabel),value:"monthly"},rightItem:{className:"rounded-md",ariaLabel:o.formatMessage(D.chooseDateWeeklyLabel),label:o.formatMessage(D.chooseDateWeeklyLabel),value:"weekly"}}),r==="monthly"?e.jsx(Lt,{referenceDate:n,setReferenceDate:(l,p)=>{u({referenceDate:l}),b.logEvent("Workspace Usage: Export Custom Reference Date Changed",{period:"monthly",change:p})},earliestValidDate:Q,latestValidDate:se,motionLayoutId:"workspaceUsage.exportModal.customRange.monthHighlight"}):e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"mb-2 w-full",borderLess:!0,onLeft:()=>{u({referenceDate:X(n,1)}),b.logEvent("Workspace Usage: Export Custom Reference Date Changed",{period:"weekly",change:"subMonth"})},onRight:()=>{u({referenceDate:be(n,1)}),b.logEvent("Workspace Usage: Export Custom Reference Date Changed",{period:"weekly",change:"addMonth"})},leftDisabled:de(X(n,1),Q),rightDisabled:ue(be(n,1),se),children:z(n,"MMMM y")}),e.jsx(Us,{referenceDate:n,setReferenceDate:l=>u({referenceDate:l})})]})]})})}const Us=({referenceDate:t,setReferenceDate:s})=>{const a=oe(t),o=jt({start:a,end:ke(t)});return e.jsx("div",{className:"flex flex-col gap-1",children:o.map(r=>{const n=$t(r,t),i=de(r,Q)||ue(r,new Date);return e.jsxs("button",{disabled:i,onClick:()=>{s(r),b.logEvent("Workspace Usage: Export Custom Reference Date Changed",{period:"weekly",change:"select"})},className:A("relative h-8 w-full rounded-full",!i&&"hover:bg-token-surface-hover"),children:[n&&e.jsx(yt.div,{layoutId:"workspaceUsage.exportModal.customRange.weekHighlight.".concat(a.toISOString()),className:"bg-token-main-surface-primary-inverse absolute inset-0 rounded-full",transition:{duration:.15}}),e.jsx("div",{className:A("relative z-10 flex w-full justify-around transition-colors duration-75",n&&"text-token-main-surface-primary delay-75",!n&&"text-token-text-primary delay-0"),children:wt({start:r,end:_e(r)}).map(u=>e.jsx("div",{className:A("w-0 grow",{"text-token-text-quaternary":!Te(u,t)||ue(u,new Date)||de(u,Q)}),children:z(u,"d")},u.toISOString()))})]},r.toISOString())})})};function Ss(t){const s=new Date;return t==="thisWeek"||t==="lastWeek"?{period:"weekly",period_start:P(xe(t==="thisWeek"?s:_t(s,1)))}:{period:"monthly",period_start:P(oe(t==="thisMonth"?s:X(s,1)))}}const D=ee({title:{id:"workspaceUsage.exportModal.title",defaultMessage:"Export data"},dataTypeDropdownLabel:{id:"workspaceUsage.exportModal.dataTypeDropdownLabel",defaultMessage:"Data type"},dataTypeDropdownUsers:{id:"workspaceUsage.exportModal.dataTypeDropdownUsers",defaultMessage:"Users"},dataTypeDropdownGpts:{id:"workspaceUsage.exportModal.dataTypeDropdownGpts",defaultMessage:"GPTs"},dateRangeLabel:{id:"workspaceUsage.exportModal.dateRangeLabel",defaultMessage:"Date range"},thisMonthLabel:{id:"workspaceUsage.exportModal.thisMonthLabel",defaultMessage:"This month ({date})"},lastMonthLabel:{id:"workspaceUsage.exportModal.lastMonthLabel",defaultMessage:"Last month ({date})"},thisWeekLabel:{id:"workspaceUsage.exportModal.thisWeekLabel",defaultMessage:"This week ({date})"},lastWeekLabel:{id:"workspaceUsage.exportModal.lastWeekLabel",defaultMessage:"Last week ({date})"},chooseMonthOrWeekButton:{id:"workspaceUsage.exportModal.chooseMonthOrWeekButton",defaultMessage:"Choose month or week"},customRangeDisplay:{id:"workspaceUsage.exportModal.customRangeDisplay",defaultMessage:"{start} – {end}"},generateCsvButton:{id:"workspaceUsage.exportModal.generateCsvButton",defaultMessage:"Generate CSV"},customRangePeriodToggleAria:{id:"workspaceUsage.exportModal.customRangePeriodToggleAria",defaultMessage:"Date range period choice"},chooseDateMonthlyLabel:{id:"workspaceUsage.exportModal.chooseDateMonthlyLabel",defaultMessage:"Monthly"},chooseDateWeeklyLabel:{id:"workspaceUsage.exportModal.chooseDateWeeklyLabel",defaultMessage:"Weekly"},filename:{id:"workspaceUsage.exportModal.filename",defaultMessage:"{workspaceName} {period} {reportType} report {date}.csv"}}),Ts=Z(()=>Y(()=>import("./kivvchsexr54fuso.js"),__vite__mapDeps([7,1])),{loading:t=>J(t)});function De({startDate:t,statsSpec:s,data:a,previousData:o}){return e.jsx("div",{className:"border-token-border-default my-6 flex min-h-[80px] w-full rounded-lg border px-2 py-4",children:s.map(({dataKey:r,label:n,helpText:i})=>{const u=a==null?"loading":a[r],l=o==null?"loading":o[r];return e.jsxs("div",{className:"border-token-border-default flex w-0 grow flex-col justify-between border-e px-4 last:me-0 last:border-e-0",children:[e.jsxs("div",{className:"text-token-text-secondary text-sm",children:[e.jsx(m,d({},n)),e.jsx(St,{}),i&&e.jsx(kt,{label:e.jsx("span",{className:"text-token-main-surface-primary font-normal",children:e.jsx(m,d({},i))}),side:"top",customBackgroundColorClassName:"bg-token-main-surface-primary-inverse",children:e.jsx(Ts,{className:"icon-sm inline"})})]}),e.jsx(gs,{value:u,previousValue:l,hideTrend:Te(t,new Date),className:"h-[28px]"})]},r)})})}const Ls=Z(()=>Y(()=>import("./lm3g1zm00rp6al39.js").then(t=>t.zl),__vite__mapDeps([3,1,4,5,6])),{loading:t=>J(t)});function Ee({handleSearch:t,clientEventSource:s,className:a}){const r=ae().formatMessage(Ds.filterListInputLabel),n=g.useCallback(Vt(i=>{t(i),b.logEvent("Workspace Usage: Filter Searched",{queryLength:i.length,trigger:"debouncedTyping",source:s})},250),[]);return e.jsx(os,{className:A("max-w-[300px]",a),ariaLabel:r,placeholder:r,type:"text",name:"search",icon:Ls,iconPosition:"left",saveOnBlur:!0,value:"",onChange:i=>n(i.target.value.trim()),onPressEnter:i=>{var l;const u=(l=i==null?void 0:i.trim())!=null?l:"";t(u),b.logEvent("Workspace Usage: Filter Searched",{queryLength:u.length,trigger:"enterKey",source:s})}})}const Ds=ee({filterListInputLabel:{id:"workspaceUsage.filterListInputLabel",defaultMessage:"Search"}}),Es=Z(()=>Y(()=>import("./hbcnisqpfdzhue92.js"),__vite__mapDeps([8,1])),{loading:t=>J(t)}),Ns=Z(()=>Y(()=>import("./hp4kvwk57p1zvpfr.js"),__vite__mapDeps([9,1])),{loading:t=>J(t)}),dt=20,ut=[{cursor:void 0,queryId:void 0}];function Ne({getQueryKey:t,loader:s,initialSortDirection:a,spec:o,getData:r,clientEventSource:n}){var S,G;const[i,u]=g.useState(a),[l,p]=g.useState(ut),[c,C]=g.useState(0),[f,U]=g.useState(),x=te({queryKey:t({order_by_field:i.metric,order_by_direction:i.direction,cursor:(S=l[c])==null?void 0:S.cursor,query_id:(G=l[c])==null?void 0:G.queryId,page_size:dt}),queryFn:({queryKey:j})=>s(j)}),y=x.data?r(x.data):"loading",w=rs(y),v=y==="loading"&&w.current!=="loading",h=v?w.current:y;g.useEffect(()=>{var j,L;(j=x.data)!=null&&j.next_cursor&&((L=x.data)!=null&&L.query_id)&&l.length===c+1&&p(B=>{var k,E;return[...B,{cursor:(k=x.data)==null?void 0:k.next_cursor,queryId:(E=x.data)==null?void 0:E.query_id}]})},[x.data,l,c]),g.useEffect(()=>{f==null&&x.data&&(x.data.total_count!=null?U(Math.ceil(x.data.total_count/dt)):U(1))},[x.data,l,f]);const M=i.direction==="ASC"?Es:Ns;return e.jsxs("div",{className:"mt-4",children:[e.jsxs(ge.Root,{className:"border-token-border-medium mb-4 border-b-[0.5px]",children:[e.jsx(ge.Header,{children:o.map(({metric:j,label:L,defaultSortDirection:B="ASC"})=>e.jsxs(ge.HeaderCell,{className:"text-[13px] font-medium text-nowrap",onClick:()=>{C(0),p(ut),u(k=>{let E;return j===k.metric?E=k.direction==="ASC"?"DESC":"ASC":E=B,b.logEvent("Workspace Usage: Table Sort Clicked",{metric:j,direction:E,source:n}),{direction:E,metric:j}})},children:[L,i.metric===j&&e.jsx(M,{className:"icon text-token-icon-secondary ms-1 inline"})]},j))}),e.jsx(ge.Body,{children:h&&h!=="loading"&&h.map((j,L)=>e.jsx(ge.Row,{children:o.map(({metric:B,render:k},E)=>e.jsx(ge.Cell,{className:A(v&&"pt-0 pb-0 [&]:border-0"),divClassName:A("items-center",E>0&&"text-token-text-secondary",!v&&"min-h-[40px]",v&&"h-0 overflow-hidden"),children:k(j[B],j)},B))},L))})]}),y==="loading"&&e.jsx("div",{className:"flex h-[860px] items-center justify-center",children:e.jsx(je,{})}),y!=="loading"&&y.length===0&&e.jsx("div",{className:"flex h-[100px] items-center justify-center",children:e.jsx(m,d({},As.zeroStateMessage))}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(Ce,{onLeft:()=>{C(j=>{const L=j-1;return b.logEvent("Workspace Usage: Pagination Clicked",{direction:"left",pageIndex:L,source:n}),L})},leftDisabled:c<=0,onRight:()=>{C(j=>{const L=j+1;return b.logEvent("Workspace Usage: Pagination Clicked",{direction:"right",pageIndex:L,source:n}),L})},rightDisabled:l[c+1]==null,children:[c+1,"/",f!=null?f:e.jsx(je,{})]})})]})}const As=ee({zeroStateMessage:{id:"workspaceUsage.table.zeroStateMessage",defaultMessage:"No results found"}}),H=(t,{toastId:s="chatgpt.usageAnalytics.defaultErrorToastId",message:a}={})=>ps(t,{toastId:s,message:a}),Ps=Z(()=>Y(()=>import("./paev76b70tpkjsm5.js"),__vite__mapDeps([10,1])),{loading:t=>J(t)});function we(t,s,a){return te({queryKey:["workspace-analytics-gizmo-stats",{workspaceId:t,startDate:s,gizmoType:a!=null?a:null}],queryFn:H(({queryKey:[o,r]})=>{const n={start_date:r.startDate};return r.gizmoType&&(n.gizmo_type=r.gizmoType),K.safeGet("/accounts/{account_id}/analytics/gizmo_stats",{parameters:{query:n,path:{account_id:r.workspaceId}}})})})}async function Dt(o){var[t,r]=o,n=r,{workspaceId:s}=n,a=ie(n,["workspaceId"]);return K.safeGet("/accounts/{account_id}/analytics/gizmo_list",{parameters:{path:{account_id:s},query:a}})}const Et={direction:"DESC",metric:"active_users"};function Os({currentWorkspaceId:t,startDate:s}){const[a,o]=g.useState(""),r=P(s),n=g.useCallback(c=>["workspace-analytics-gizmos-list",d({workspaceId:t,start_date:r,filter_query:a,gizmo_type:"gpt"},c)],[r,a,t]),i=we(t,r,"gpt"),u=P(X(s,1)),l=we(t,u,"gpt"),p=H(Dt);return e.jsxs("div",{className:"mb-8",children:[e.jsx(De,{startDate:s,data:i.data,previousData:l.data,statsSpec:Gs}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(Ee,{className:"grow",handleSearch:o,clientEventSource:"gizmoList"}),e.jsx(R,{as:"link",to:"/admin/gpts",size:"small",color:"secondary",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(m,d({},W.manageGPTs)),e.jsx(Ps,{className:"icon-sm"})]})})]}),e.jsx(Ne,{getQueryKey:n,loader:p,getData:c=>c.gizmos,spec:Nt,initialSortDirection:Et,clientEventSource:"gizmoList"},"".concat(t,".gpt.").concat(r,".").concat(a))]})}function zs({currentWorkspaceId:t,startDate:s}){const[a,o]=g.useState(""),r=P(s),n=g.useCallback(c=>["workspace-analytics-gizmos-list",d({workspaceId:t,start_date:r,filter_query:a,gizmo_type:"project"},c)],[r,a,t]),i=we(t,r,"project"),u=P(X(s,1)),l=we(t,u,"project"),p=H(Dt);return e.jsxs("div",{className:"mb-8",children:[e.jsx(De,{startDate:s,data:i.data,previousData:l.data,statsSpec:Is}),e.jsx("div",{className:"flex justify-between",children:e.jsx(Ee,{className:"grow",handleSearch:o,clientEventSource:"projectList"})}),e.jsx(Ne,{getQueryKey:n,loader:p,getData:c=>c.gizmos,spec:Nt,initialSortDirection:Et,clientEventSource:"projectList"},"".concat(t,".project.").concat(r,".").concat(a))]})}const W=ee({totalGpts:{id:"workspaceUsage.gizmoList.stats.totalGpts",defaultMessage:"Total GPTs"},gptsCreatedThisMonth:{id:"workspaceUsage.gizmoList.stats.gptsCreatedThisMonth",defaultMessage:"GPTs Created This Month"},gptsActive:{id:"workspaceUsage.gizmoList.stats.gptsActive",defaultMessage:"GPTs active"},gptsActiveHelpText:{id:"workspaceUsage.gizmoList.stats.gptsActiveHelpText",defaultMessage:"GPTs that have sent at lease one message during this month"},nameColumnLabel:{id:"workspaceUsage.gizmoList.tableHeader.name",defaultMessage:"Name"},messagesColumnLabel:{id:"workspaceUsage.gizmoList.tableHeader.messages",defaultMessage:"Total Messages"},creatorNameColumnLabel:{id:"workspaceUsage.gizmoList.tableHeader.creatorName",defaultMessage:"Creator Name"},activeUsersColumnLabel:{id:"workspaceUsage.gizmoList.tableHeader.activeUsersColumnLabel",defaultMessage:"Active Users"},draftFlag:{id:"workspaceUsage.gizmoList.draftFlag",defaultMessage:"Draft"},manageGPTs:{id:"workspaceUsage.gizmoList.manageGPTs",defaultMessage:"Manage GPTs"},totalProjects:{id:"workspaceUsage.gizmoList.stats.totalProjects",defaultMessage:"Total Projects"},projectsCreatedThisMonth:{id:"workspaceUsage.gizmoList.stats.projectsCreatedThisMonth",defaultMessage:"Projects Created This Month"},projectsActive:{id:"workspaceUsage.gizmoList.stats.projectsActive",defaultMessage:"Projects active"},projectsActiveHelpText:{id:"workspaceUsage.gizmoList.stats.projectsActiveHelpText",defaultMessage:"Projects with at least one message during this month"}}),Gs=[{dataKey:"total_gpt_count",label:W.totalGpts},{dataKey:"gpt_created",label:W.gptsCreatedThisMonth},{dataKey:"active_gpt_count",label:W.gptsActive,helpText:W.gptsActiveHelpText}],Is=[{dataKey:"total_gpt_count",label:W.totalProjects},{dataKey:"gpt_created",label:W.projectsCreatedThisMonth},{dataKey:"active_gpt_count",label:W.projectsActive,helpText:W.projectsActiveHelpText}],qs=new Intl.NumberFormat(void 0,{notation:"compact",maximumSignificantDigits:3});function mt(t){return typeof t=="number"?qs.format(t):null}const Nt=[{metric:"gpt_name",label:e.jsx(m,d({},W.nameColumnLabel)),render:(t,{config_type:s})=>e.jsxs("div",{className:"flex grow items-center justify-between",children:[e.jsx("span",{children:t}),s==="draft"&&e.jsx("span",{className:"text-token-text-secondary text-xs",children:e.jsx(m,d({},W.draftFlag))})]})},{label:e.jsx(m,d({},W.creatorNameColumnLabel)),metric:"creator_name",render:t=>t},{metric:"messages",label:e.jsx(m,d({},W.messagesColumnLabel)),render:mt,defaultSortDirection:"DESC"},{metric:"active_users",label:e.jsx(m,d({},W.activeUsersColumnLabel)),render:mt,defaultSortDirection:"DESC"}];function Ws({startDate:t,setStartDate:s}){return e.jsx(Ce,{onLeft:()=>{s(a=>{const o=X(a,1);return b.logEvent("Workspace Usage: Month Changed",{direction:"left",startDate:P(o)}),o})},leftDisabled:de(X(t,1),Q),onRight:()=>{s(a=>{const o=be(a,1);return b.logEvent("Workspace Usage: Month Changed",{direction:"right",startDate:P(o)}),o})},rightDisabled:ue(be(t,1),se),surpressChildrenWrapper:!0,children:e.jsx(Rs,{startDate:t,setStartDate:s})})}function Rs({startDate:t,setStartDate:s}){return e.jsx(Ut,{triggerButton:e.jsx(R,{size:"small",color:"secondary",className:"rounded-none border-x-0 border-e-0 px-1",children:z(t,"MMM y")}),children:e.jsx("div",{className:"w-[210px] p-1 text-xs",children:e.jsx(Lt,{referenceDate:t,setReferenceDate:(a,o)=>{const r=oe(ue(a,se)?se:de(a,Q)?Q:a);s(r),b.logEvent("Workspace Usage: Month Changed",{direction:o,startDate:P(r)})},earliestValidDate:Q,latestValidDate:se,motionLayoutId:"workspaceUsage.monthSelector.monthHighlight"})})})}function Bs({currentWorkspaceId:t,selectedGroup:s,onSelect:a,onClose:o}){var v;const r=ae(),[n,i]=g.useState(""),u=ns(n,300),[l,p]=g.useState(0),{groups:c,isLoading:C,isPlaceholderData:f}=fs({workspaceId:t,currPage:l,groupFilter:u}),U=((v=c==null?void 0:c.items)!=null?v:[]).filter(h=>!h.system_use_case),x=c&&c.total>0?Math.ceil(c.total/Ue):1;g.useEffect(()=>{if(!c)return;const h=c.total>0?Math.ceil(c.total/Ue):1,M=Math.max(h-1,0);p(S=>S>M?M:S)},[c]);const y=h=>{var M;a(h),b.logEvent("Workspace Usage: Group Modal Selection",{groupId:(M=h==null?void 0:h.id)!=null?M:null})},w=C&&!c;return e.jsx(bt,{testId:"modal-group-selection",isOpen:!0,onClose:()=>o(),showCloseButton:!0,title:e.jsx(m,d({},F.title)),description:e.jsx(m,I(d({},F.description),{values:{br:e.jsx("br",{})}})),footerContent:e.jsxs("div",{className:"mt-4 flex w-full flex-col gap-3 sm:mt-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx(R,{as:"link",to:"/admin/groups",color:"secondary",size:"small",className:"self-start sm:self-auto",onClick:()=>{b.logEvent("Workspace Usage: Group Modal Manage Groups Clicked"),o()},children:e.jsx(m,d({},F.manageGroupsCta))}),e.jsxs("div",{className:"flex items-center gap-2",children:[s&&e.jsx(R,{color:"ghost",size:"small",onClick:()=>y(null),children:e.jsx(m,d({},F.clearSelection))}),e.jsx(R,{color:"secondary",size:"small",onClick:()=>o(),children:e.jsx(m,d({},F.closeButton))})]})]}),children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(is,{value:n,onChange:h=>{const M=h.target.value;i(M),p(0),b.logEvent("Workspace Usage: Group Modal Search Updated",{queryLength:M.length})},placeholder:r.formatMessage(F.searchPlaceholder),inputClassName:"w-full rounded-full! text-sm"}),e.jsx("div",{className:A("border-token-border-subtle max-h-[360px] min-h-[180px] overflow-y-auto rounded-lg border"),children:w?e.jsx("div",{className:"flex h-full items-center justify-center p-6",children:e.jsx(je,{})}):U.length===0?e.jsxs("div",{className:"flex h-full flex-col items-center justify-center gap-2 p-6 text-center",children:[e.jsx("span",{className:"text-token-text-secondary text-sm font-medium",children:e.jsx(m,d({},F.emptyStateTitle))}),e.jsx("span",{className:"text-token-text-tertiary text-xs",children:e.jsx(m,d({},F.emptyStateSubtitle))})]}):e.jsx("ul",{className:A("divide-token-border-subtle divide-y",f&&"opacity-50"),children:U.map(h=>{var j;const M=(s==null?void 0:s.id)===h.id,S=Number((j=h.num_members)!=null?j:0),G=Number.isFinite(S)?S:0;return e.jsxs("li",{className:A("flex flex-col gap-3 p-4 sm:flex-row sm:items-center sm:justify-between",M&&"bg-token-main-surface-secondary"),children:[e.jsxs("div",{className:"flex flex-1 items-start gap-3",children:[e.jsx(hs,{group:h}),e.jsxs("div",{children:[e.jsx(Wt,{to:"/admin/groups/".concat(h.id),className:"text-token-text-primary text-sm font-medium hover:underline focus:outline-none focus-visible:underline",onClick:()=>{b.logEvent("Workspace Usage: Group Modal View Group Clicked",{groupId:h.id})},children:h.name}),e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(m,I(d({},F.memberCount),{values:{count:G}}))})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(R,{color:M?"primary":"secondary",size:"small",onClick:()=>y({id:h.id,name:h.name}),children:M?e.jsx(m,d({},F.selectedLabel)):e.jsx(m,d({},F.selectLabel))})})]},h.id)})})}),c&&c.total>Ue&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(m,I(d({},F.paginationSummary),{values:{page:l+1,totalPages:x}}))}),e.jsx(ls,{currentPage:l,onChangeIndex:h=>p(h),length:x})]})]})})}const F=ee({title:{id:"workspaceUsage.groupModal.title",defaultMessage:"Select a group"},description:{id:"workspaceUsage.groupModal.description",defaultMessage:"Filter analytics for members within a workspace group."},searchPlaceholder:{id:"workspaceUsage.groupModal.searchPlaceholder",defaultMessage:"Search groups"},emptyStateTitle:{id:"workspaceUsage.groupModal.emptyStateTitle",defaultMessage:"No groups found"},emptyStateSubtitle:{id:"workspaceUsage.groupModal.emptyStateSubtitle",defaultMessage:"Try a different search or create a new group from settings."},memberCount:{id:"workspaceUsage.groupModal.memberCount",defaultMessage:"{count, plural, one {# member} other {# members}}"},selectLabel:{id:"workspaceUsage.groupModal.selectLabel",defaultMessage:"Select"},selectedLabel:{id:"workspaceUsage.groupModal.selectedLabel",defaultMessage:"Selected"},paginationSummary:{id:"workspaceUsage.groupModal.paginationSummary",defaultMessage:"Page {page} of {totalPages}"},manageGroupsCta:{id:"workspaceUsage.groupModal.manageGroupsCta",defaultMessage:"Manage groups"},clearSelection:{id:"workspaceUsage.groupModal.clearSelection",defaultMessage:"Clear selection"},closeButton:{id:"workspaceUsage.groupModal.closeButton",defaultMessage:"Close"}});var Se,gt;function Fs(){if(gt)return Se;gt=1;var t=Qt(),s=Yt(),a=s(function(o,r,n){t(o,n,r)});return Se=a,Se}var Hs=Fs();const Ks=Rt(Hs);async function $s({queryKey:[t,{workspaceId:s,startDate:a,groupId:o}]}){return K.safeGet("/accounts/{account_id}/analytics/overview",{parameters:{path:{account_id:s},query:{start_date:a,group_id:o!=null?o:void 0}}})}function Vs(t,s,a){return te({queryKey:["workspace-analytics-overview",{workspaceId:t,startDate:s,groupId:a}],queryFn:H($s)})}async function Qs({queryKey:[t,{workspaceId:s,startDate:a,groupId:o}]}){return K.safeGet("/accounts/{account_id}/analytics/gizmo_overview",{parameters:{path:{account_id:s},query:{start_date:a,group_id:o!=null?o:void 0}}})}function Ys(t,s,a){return te({queryKey:["workspace-analytics-gizmo-overview",{workspaceId:t,startDate:s,groupId:a}],queryFn:H(Qs)})}async function Zs({queryKey:[t,{workspaceId:s,startDate:a,groupId:o}]}){return K.safeGet("/accounts/{account_id}/analytics/tool_overview",{parameters:{path:{account_id:s},query:{start_date:a,group_id:o!=null?o:void 0}}})}function Js(t,s,a){return te({queryKey:["workspace-analytics-tool-overview",{workspaceId:t,startDate:s,groupId:a}],queryFn:H(Zs)})}async function Xs({queryKey:[t,{workspaceId:s,startDate:a,groupId:o}]}){return K.safeGet("/accounts/{account_id}/analytics/project_overview",{parameters:{query:{start_date:a,group_id:o!=null?o:void 0},path:{account_id:s}}})}function ea(t,s,a){return te({queryKey:["workspace-analytics-project-overview",{workspaceId:t,startDate:s,groupId:a}],queryFn:H(Xs)})}async function ta({queryKey:[t,{workspaceId:s,startDate:a,groupId:o}]}){return K.safeGet("/accounts/{account_id}/analytics/connector_overview",{parameters:{path:{account_id:s},query:{start_date:a,group_id:o!=null?o:void 0}}})}function sa(t,s,a){return te({queryKey:["workspace-analytics-connector-overview",{workspaceId:t,startDate:s,groupId:a}],queryFn:H(ta)})}function pe(t,s,a){return g.useMemo(()=>{if(!s)return;const o=Ks(s,"date");return wt({start:t,end:ke(t)}).map(r=>{var u;const n=P(r),i=o[n];return i&&i.total>0?{date:i.date,total:i.total,values:(u=i[a])!=null?u:{}}:{date:n,blank:0}})},[t,s,a])}function aa(t,s,a){var $,Ae,Pe,Oe,ze,Ge,Ie,qe,We,Re,Be,Fe,He,Ke,$e,Ve,Qe,Ye,Ze,Je,Xe,et;const o=P(s),r=Vs(t,o,a),n=g.useMemo(()=>{var _,T;return(T=(_=r.data)==null?void 0:_.active_user_data)==null?void 0:T.daily_data.map(({date:me,active_users:re})=>({date:me,total:re,values:{active_users:re}}))},[(Ae=($=r.data)==null?void 0:$.active_user_data)==null?void 0:Ae.daily_data]),i=pe(s,n,"values"),u=pe(s,(Oe=(Pe=r.data)==null?void 0:Pe.messages_data)==null?void 0:Oe.daily_data,"messages_by_model"),l=Ys(t,o,a),p=pe(s,(ze=l.data)==null?void 0:ze.daily_gizmo_messages_data,"messages_by_gpt"),c=Js(t,o,a),C=pe(s,(Ge=c.data)==null?void 0:Ge.daily_tool_messages_data,"messages_by_tool"),f=ea(t,o,a),U=g.useMemo(()=>{var _,T;return(T=(_=f.data)==null?void 0:_.project_names)!=null?T:null},[f.data]),x=pe(s,(Ie=f.data)==null?void 0:Ie.daily_project_messages_data,"messages_by_project"),y=sa(t,o,a),w=pe(s,(qe=y.data)==null?void 0:qe.daily_connector_messages_data,"messages_by_connector"),v=ae(),h=g.useMemo(()=>{var _;return i&&((_=r.data)!=null&&_.active_user_data)?{data:i,metrics:{active_users:{displayName:v.formatMessage(pt.activeUsers)}},monthOverMonth:r.data.active_user_data.month_to_month_data}:"loading"},[i,v,(We=r.data)==null?void 0:We.active_user_data]),M=g.useMemo(()=>{var _;return u&&((_=r.data)!=null&&_.messages_data)?{data:u,metrics:ye(r.data.messages_data.models),monthOverMonth:r.data.messages_data.month_to_month_data}:"loading"},[u,(Re=r.data)==null?void 0:Re.messages_data]),S=g.useMemo(()=>{var tt,st;const _=(st=(tt=r.data)==null?void 0:tt.active_user_data)==null?void 0:st.weekly_data;if(!_)return;const T=new Map,me=(()=>{if(_.length>0){const O=Tt(_[0].period_start_date).getDay();if(O>=0&&O<=6)return O}return 0})(),re=jt({start:xe(s,{weekStartsOn:me}),end:ke(s)},{weekStartsOn:me}),Gt=new Set(re.map(O=>P(O)));return re.forEach(O=>{const ne=P(O);T.set(ne,{date:ne,blank:0})}),_.forEach(({period_start_date:O,active_users:ne})=>{Gt.has(O)&&T.set(O,{date:O,total:ne,values:{active_users:ne}})}),Array.from(T.entries()).sort(([O],[ne])=>O.localeCompare(ne)).map(([,O])=>O)},[(Fe=(Be=r.data)==null?void 0:Be.active_user_data)==null?void 0:Fe.weekly_data,s]),G=(Ke=(He=r.data)==null?void 0:He.active_user_data)==null?void 0:Ke.month_to_month_data,j=g.useMemo(()=>S&&G?{data:S,metrics:{active_users:{displayName:v.formatMessage(pt.weeklyActiveUsers)}},monthOverMonth:G}:"loading",[v,S,G]),L=g.useMemo(()=>{var _,T;return p&&((_=l.data)!=null&&_.metrics)&&((T=l.data)!=null&&T.month_to_month_data)?{data:p,metrics:Object.fromEntries(Object.entries(l.data.metrics).map(([me,re])=>[me,{displayName:re}])),monthOverMonth:l.data.month_to_month_data}:"loading"},[p,($e=l.data)==null?void 0:$e.metrics,(Ve=l.data)==null?void 0:Ve.month_to_month_data]),B=g.useMemo(()=>{var _,T;return x&&((_=f.data)!=null&&_.project_list)&&((T=f.data)!=null&&T.month_to_month_data)?{data:x,metrics:ye(f.data.project_list,U),monthOverMonth:f.data.month_to_month_data}:"loading"},[x,(Qe=f.data)==null?void 0:Qe.month_to_month_data,(Ye=f.data)==null?void 0:Ye.project_list,U]),k=g.useMemo(()=>{var _,T;return C&&((_=c.data)!=null&&_.tool_list)&&((T=c.data)!=null&&T.month_to_month_data)?{data:C,metrics:ye(c.data.tool_list),monthOverMonth:c.data.month_to_month_data}:"loading"},[C,(Ze=c.data)==null?void 0:Ze.month_to_month_data,(Je=c.data)==null?void 0:Je.tool_list]),E=g.useMemo(()=>{var _,T;return w&&((_=y.data)!=null&&_.connector_list)&&((T=y.data)!=null&&T.month_to_month_data)?{data:w,metrics:ye(y.data.connector_list),monthOverMonth:y.data.month_to_month_data}:"loading"},[w,(Xe=y.data)==null?void 0:Xe.connector_list,(et=y.data)==null?void 0:et.month_to_month_data]);return{dailyActiveUsers:h,weeklyActiveUsers:j,dailyMessages:M,dailyProjectMessages:B,dailyGizmoMessages:L,dailyConnectorMessages:E,dailyToolMessages:k}}function ye(t,s){return Object.entries(t).sort(([,a],[,o])=>a-o).reduce((a,[o,r])=>{var n;return r>0&&(a[o]={displayName:(n=s==null?void 0:s[o])!=null?n:o,total:r}),a},{})}const pt=ee({activeUsers:{id:"workspaceUsage.activeUsersMetric",defaultMessage:"Daily unique active users"},weeklyActiveUsers:{id:"workspaceUsage.weeklyActiveUsersMetric",defaultMessage:"Weekly unique active users"}}),oa=3;function ra(t,s){const a=t.trim().split(/\s+/);return a.length<=s?t:"".concat(a.slice(0,s).join(" "),"...")}function At({currentWorkspaceId:t,startDate:s,selectedGroup:a,setSelectedGroup:o,showGroupFilter:r}){var h;const n=ae(),i=Le(),[u,l]=g.useState(!1),p=(h=a==null?void 0:a.id)!=null?h:null,c=aa(t,s,p),C=(a==null?void 0:a.name)&&ra(a.name,oa);g.useEffect(()=>{r||l(!1)},[r]);const f=Ct(i,"3528236309"),U=f.get("show_weekly_active_users_chart",!1),x=f.get("show_connector_overview_chart",!1),y=f.get("show_project_overview_chart",!1),w=g.useCallback(M=>{const S=Tt(M),G=Zt(S,6),j=S.getMonth()===G.getMonth(),L=z(S,"MMM d"),B=j?z(G,"d"):z(G,"MMM d");return"".concat(L," – ").concat(B)},[]),v=!Jt(s,oe(new Date));return e.jsxs("div",{className:"mt-5",children:[r&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsx(R,{className:A(a&&"max-w-[240px]"),color:"secondary",size:"small",title:a==null?void 0:a.name,onClick:()=>{l(!0),b.logEvent("Workspace Usage: Group Modal Opened")},children:a?e.jsx("span",{className:"truncate",children:e.jsx(m,I(d({},q.groupButtonSelected),{values:{groupName:C}}))}):e.jsx(m,d({},q.groupButton))})}),u&&e.jsx(Bs,{currentWorkspaceId:t,selectedGroup:a,onSelect:M=>{var S;o(M),l(!1),b.logEvent("Workspace Usage: Group Selected",{groupId:(S=M==null?void 0:M.id)!=null?S:null})},onClose:()=>{l(!1),b.logEvent("Workspace Usage: Group Modal Closed")}})]}),e.jsx(le,{title:q.activeUsersChartTitle,data:c.dailyActiveUsers,displayMoM:v,clientEventSource:"activeUsers",hideLegend:!0}),U&&e.jsx(le,{title:q.weeklyActiveUsersChartTitle,data:c.weeklyActiveUsers,displayMoM:!1,clientEventSource:"weeklyActiveUsers",hideLegend:!0,hideTopValue:!0,tooltipLabelFormatter:w}),e.jsx(le,{title:q.messagesChartTitle,data:c.dailyMessages,otherGroupLabel:n.formatMessage(q.otherModels),displayMoM:v,clientEventSource:"totalMessages"}),e.jsx(le,{title:q.gptMessagesChartTitle,data:c.dailyGizmoMessages,otherGroupLabel:n.formatMessage(q.otherGizmos),displayMoM:v,clientEventSource:"gizmoMessages"}),e.jsx(le,{title:q.toolMessagesChartTitle,data:c.dailyToolMessages,otherGroupLabel:n.formatMessage(q.otherTools),displayMoM:v,clientEventSource:"toolMessages"}),y&&e.jsx(le,{title:q.projectMessagesChartTitle,data:c.dailyProjectMessages,otherGroupLabel:n.formatMessage(q.otherProjects),displayMoM:v,clientEventSource:"projectMessages"}),x&&e.jsx(le,{title:q.connectorMessagesChartTitle,data:c.dailyConnectorMessages,otherGroupLabel:n.formatMessage(q.otherConnectors),displayMoM:v,clientEventSource:"connectorMessages"})]})}const q=ee({activeUsersChartTitle:{id:"workspaceUsage.overview.activeUsersChartTitle",defaultMessage:"Daily unique active users"},weeklyActiveUsersChartTitle:{id:"workspaceUsage.overview.weeklyActiveUsersChartTitle",defaultMessage:"Weekly unique active users"},messagesChartTitle:{id:"workspaceUsage.overview.messagesChartTitle",defaultMessage:"Total messages sent"},gptMessagesChartTitle:{id:"workspaceUsage.overview.gptMessagesChartTitle",defaultMessage:"GPT messages sent"},projectMessagesChartTitle:{id:"workspaceUsage.overview.projectMessagesChartTitle",defaultMessage:"Project messages sent"},connectorMessagesChartTitle:{id:"workspaceUsage.overview.connectorMessagesChartTitle",defaultMessage:"Connector messages received"},toolMessagesChartTitle:{id:"workspaceUsage.overview.toolMessagesChartTitle",defaultMessage:"Tool messages received"},otherModels:{id:"workspaceUsage.overview.otherModels",defaultMessage:"Other models"},otherGizmos:{id:"workspaceUsage.overview.otherGizmos",defaultMessage:"Other GPTs"},otherProjects:{id:"workspaceUsage.overview.otherProjects",defaultMessage:"Other Projects"},otherConnectors:{id:"workspaceUsage.overview.otherConnectors",defaultMessage:"Other Connectors"},otherTools:{id:"workspaceUsage.overview.otherTools",defaultMessage:"Other Tools"},groupButton:{id:"workspaceUsage.groupButton",defaultMessage:"Filter by Group"},groupButtonSelected:{id:"workspaceUsage.groupButtonSelected",defaultMessage:"Group: {groupName}"}}),na=Z(()=>Y(()=>import("./paev76b70tpkjsm5.js"),__vite__mapDeps([10,1])),{loading:t=>J(t)}),Pt=Z(()=>Y(()=>import("./irmkfkn816hri3f1.js"),__vite__mapDeps([11,1])),{loading:t=>J(t)});function ia(a){var o=a,{className:t}=o,s=ie(o,["className"]);return e.jsx(Pt,I(d({},s),{className:t}))}function ht(t,s){return te({queryKey:["workspace-analytics-user-stats",{workspaceId:t,startDate:s}],queryFn:H(({queryKey:[a,o]})=>K.safeGet("/accounts/{account_id}/analytics/user_stats",{parameters:{query:{start_date:o.startDate},path:{account_id:o.workspaceId}}}))})}async function la(o){var[t,r]=o,n=r,{workspaceId:s}=n,a=ie(n,["workspaceId"]);const p=a,{view_mode:i,limit:u}=p,l=ie(p,["view_mode","limit"]);return K.safeGet("/accounts/{account_id}/analytics/user_list",{parameters:{path:{account_id:s},query:l}})}const ca={direction:"DESC",metric:"messages"};async function da(o){var[t,r]=o,n=r,{workspaceId:s}=n,a=ie(n,["workspaceId"]);const f=a,{page_size:i,cursor:u,query_id:l,limit:p,view_mode:c}=f,C=ie(f,["page_size","cursor","query_id","limit","view_mode"]);return K.safeGet("/accounts/{account_id}/analytics/user_list/power_users",{parameters:{path:{account_id:s},query:d({},C)}})}function Ot({currentWorkspaceId:t,startDate:s,showAiChampionsButton:a,showConnectorProjectColumns:o}){const r=ae(),[n,i]=g.useState(""),[u,l]=g.useState(!1),p=a&&u;g.useEffect(()=>{!a&&u&&l(!1)},[a,u]);const c=Le(),C=Xt(c,"2861925050"),f=g.useCallback((k,E)=>{const $=k!=null?k:E.email;return e.jsxs("div",{className:"group flex items-center gap-2",children:[p&&e.jsx(Pt,{className:"icon-sm"}),e.jsx("span",{children:$})]})},[p]),U=g.useMemo(()=>{const k=C?[...ft,{label:e.jsx(m,d({},N.creditsUsedColumnLabel)),metric:"credits_used",render:he,defaultSortDirection:"DESC"}]:ft;return(o?k:k.filter($=>$.metric!=="project_messages"&&$.metric!=="connector_messages")).map($=>$.metric==="name"?I(d({},$),{render:f}):$)},[C,f,o]),x=P(s),y=g.useCallback(k=>["workspace-analytics-users-list",I(d({workspaceId:t,start_date:x,filter_query:n},k),{view_mode:p?"power":"default"})],[x,n,t,p]),w=ht(t,x),v=P(X(s,1)),h=ht(t,v),M=H(la),S=H(da),G=g.useCallback(k=>p?S(k):M(k),[p,M,S]),j=g.useCallback(()=>{a&&l(k=>{const E=!k;return b.logEvent("Workspace Usage: AI Champions Clicked",{source:"userList",state:E?"enabled":"disabled"}),E})},[a]),L=g.useMemo(()=>"".concat(t,".").concat(x,".").concat(n,".").concat(p?"champions":"default"),[p,t,n,x]),B=p?ga:ca;return e.jsxs("div",{className:"mb-8",children:[e.jsx(De,{startDate:s,data:w.data,previousData:h.data,statsSpec:ua}),e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[e.jsx(Ee,{className:"grow md:max-w-xs",handleSearch:i,clientEventSource:"userList"}),e.jsxs("div",{className:"flex items-center gap-2",children:[a&&e.jsx(kt,{label:r.formatMessage(N.aiChampionsButtonTooltip),side:"top",children:e.jsx(R,{size:"small",color:u?"primary":"secondary",icon:ia,onClick:j,"aria-pressed":u,className:"group transition-colors",iconClassName:"icon-sm",children:e.jsx(m,d({},N.aiChampionsButtonLabel))})}),e.jsx(R,{as:"link",to:"/admin/members",size:"small",color:"secondary",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(m,d({},N.manageUsersLink)),e.jsx(na,{className:"icon-sm"})]})})]})]}),e.jsx(Ne,{getQueryKey:y,loader:G,getData:k=>k.users,spec:U,initialSortDirection:B,clientEventSource:"userList"},L)]})}const N=ee({purchasedSeats:{id:"workspaceUsage.userList.stats.purchasedSeats",defaultMessage:"Seats purchased"},claimedSeats:{id:"workspaceUsage.userList.stats.claimedSeats",defaultMessage:"Seats enabled"},claimedSeatsHelpText:{id:"workspaceUsage.userList.stats.claimedSeatsHelpText",defaultMessage:"Users who have accepted their invite and logged in"},activeUsers:{id:"workspaceUsage.userList.stats.activeUsers",defaultMessage:"Active users"},activeUsersHelpText:{id:"workspaceUsage.userList.stats.activeUsersHelpText",defaultMessage:"Users who have sent at least one message during this time period"},pendingInvites:{id:"workspaceUsage.userList.stats.pendingInvites",defaultMessage:"Pending invites"},nameColumnLabel:{id:"workspaceUsage.userList.tableHeader.name",defaultMessage:"Name"},emailColumnLabel:{id:"workspaceUsage.userList.tableHeader.email",defaultMessage:"Email"},messagesColumnLabel:{id:"workspaceUsage.userList.tableHeader.messages",defaultMessage:"Total Messages"},gptMessagesColumnLabel:{id:"workspaceUsage.userList.tableHeader.gptMessages",defaultMessage:"GPT Messages"},toolMessagesColumnLabel:{id:"workspaceUsage.userList.tableHeader.toolMessages",defaultMessage:"Tool Messages"},projectMessagesColumnLabel:{id:"workspaceUsage.userList.tableHeader.projectMessages",defaultMessage:"Project Messages"},connectorMessagesColumnLabel:{id:"workspaceUsage.userList.tableHeader.connectorMessages",defaultMessage:"Connector Messages"},creditsUsedColumnLabel:{id:"workspaceUsage.userList.tableHeader.creditsUsed",defaultMessage:"Credits Used"},manageUsersLink:{id:"workspaceUsage.userList.tableHeader.manageUsersLink",defaultMessage:"Manage users"},aiChampionsButtonLabel:{id:"workspaceUsage.userList.aiChampions.buttonLabel",defaultMessage:"Show AI power users"},aiChampionsButtonTooltip:{id:"workspaceUsage.userList.aiChampions.buttonTooltip",defaultMessage:"Your most engaged users: top 20% message senders with 75+ messages per week and 3+ different tools used per month."}}),ua=[{dataKey:"purchased_seats",label:N.purchasedSeats},{dataKey:"claimed_seat",label:N.claimedSeats,helpText:N.claimedSeatsHelpText},{dataKey:"active_users",label:N.activeUsers,helpText:N.activeUsersHelpText},{dataKey:"pending_invites",label:N.pendingInvites}],ma=new Intl.NumberFormat(void 0,{notation:"compact",maximumSignificantDigits:3});function he(t){return typeof t=="number"?ma.format(t):null}const ft=[{metric:"name",label:e.jsx(m,d({},N.nameColumnLabel)),render:t=>t},{metric:"email",label:e.jsx(m,d({},N.emailColumnLabel)),render:t=>t},{metric:"messages",label:e.jsx(m,d({},N.messagesColumnLabel)),render:he,defaultSortDirection:"DESC"},{label:e.jsx(m,d({},N.gptMessagesColumnLabel)),metric:"gpt_messages",render:he,defaultSortDirection:"DESC"},{label:e.jsx(m,d({},N.toolMessagesColumnLabel)),metric:"tool_messages",render:he,defaultSortDirection:"DESC"},{label:e.jsx(m,d({},N.projectMessagesColumnLabel)),metric:"project_messages",render:he,defaultSortDirection:"DESC"},{label:e.jsx(m,d({},N.connectorMessagesColumnLabel)),metric:"connector_messages",render:he,defaultSortDirection:"DESC"}],ga={direction:"DESC",metric:"messages"};function pa(t){return Object.keys(t)}var vt;const ha=es.div(vt||(vt=lt(["flex space-x-4"]))),zt={overviewTab:At,usersTab:Ot,gptsTab:Os,projectsTab:zs};function fa(t){return te({queryKey:["workspace-analytics-last-updated",{workspaceId:t}],queryFn:H(({queryKey:[s,a]})=>K.safeGet("/accounts/{account_id}/analytics/last_updated_time",{parameters:{path:{account_id:a.workspaceId}}}))})}const xt=pa(zt);function xa({currentWorkspaceId:t,startDate:s,setStartDate:a,currentTab:o,setTab:r,tabs:n}){const i=fa(t),[u,l]=g.useState(!1);return e.jsx(vs,{title:e.jsx(m,d({},ce.title)),actions:e.jsxs(e.Fragment,{children:[e.jsx(Ws,{startDate:s,setStartDate:a}),e.jsx(R,{className:"ms-2",color:"secondary",size:"small",onClick:()=>{l(!0),b.logEvent("Workspace Usage: Export Modal Opened")},children:e.jsx(m,d({},ce.exportButton))}),u&&e.jsx(ks,{currentWorkspaceId:t,currentTab:o,onClose:()=>l(!1)})]}),tabsHeader:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ha,{children:n.map(p=>e.jsx("a",{className:A("pb-2",o===p?"border-token-text-secondary text-token-text-primary border-b font-medium":"text-token-text-tertiary cursor-pointer font-normal"),onClick:()=>{r(p),b.logEvent("Workspace Usage: Tab Clicked",{tab:p})},children:e.jsx(m,d({},ce[p]))},p))}),e.jsxs("div",{className:"text-token-text-tertiary flex items-center gap-1 text-xs",children:[i.data?e.jsxs("span",{children:[e.jsx(m,d({},ce.dataLastUpdatedLabel)),e.jsx(St,{}),i.data.last_updated_time?z(new Date(i.data.last_updated_time),"MMM d, yyyy"):e.jsx(m,d({},ce.dataLastUpdatedUnknown))]}):e.jsx(je,{}),"·",e.jsx(ts,{href:"https://help.openai.com/en/articles/10875114-user-analytics-for-chatgpt-enterprise",className:"hover:text-token-link-hover underline",children:e.jsx(m,d({},ce.helpCenterLinkText))})]})]})})}function va({currentWorkspaceId:t}){const s=ae(),a=Le(),o=Ct(a,"3528236309"),r=o.get("show_group_filter",!1),n=o.get("show_project_tab",!1),i=o.get("show_ai_champions_button",!1),u=o.get("show_connector_project_cols",!1),[l,p]=g.useState("overviewTab"),[c,C]=g.useState(oe(new Date)),[f,U]=g.useState(null),x=g.useMemo(()=>n?xt:xt.filter(M=>M!=="projectsTab"),[n]),y=x.includes(l)?l:"overviewTab";g.useEffect(()=>{r||U(null)},[r]);const w=r?f:null;let v=null;const h=zt[y];return y==="overviewTab"?v=e.jsx(At,{currentWorkspaceId:t,startDate:c,selectedGroup:w,setSelectedGroup:U,showGroupFilter:r}):y==="usersTab"?v=e.jsx(Ot,{currentWorkspaceId:t,startDate:c,showAiChampionsButton:i,showConnectorProjectColumns:u}):v=e.jsx(h,{currentWorkspaceId:t,startDate:c,showAiChampionsButton:!1,selectedGroup:w,setSelectedGroup:U,showGroupFilter:!1,showConnectorProjectColumns:!1}),g.useEffect(()=>{b.logPageView(),b.logEvent("Workspace Usage: Page Viewed")},[]),e.jsxs(e.Fragment,{children:[e.jsx(cs,{children:e.jsx("title",{children:s.formatMessage(ce.title)})}),e.jsx(xa,{currentWorkspaceId:t,startDate:c,setStartDate:C,currentTab:y,setTab:p,tabs:x}),e.jsx(xs,{children:v})]})}const ce=ee({title:{id:"workspaceUsage.title",defaultMessage:"User Analytics"},overviewTab:{id:"workspaceUsage.overviewTab",defaultMessage:"Overview"},usersTab:{id:"workspaceUsage.usersTab",defaultMessage:"Users"},gptsTab:{id:"workspaceUsage.gptsTab",defaultMessage:"GPTs"},projectsTab:{id:"workspaceUsage.projectsTab",defaultMessage:"Projects"},creditsTab:{id:"workspaceUsage.creditsTab",defaultMessage:"Credits"},exportButton:{id:"workspaceUsage.exportButton",defaultMessage:"Export..."},dataLastUpdatedLabel:{id:"workspaceUsage.dataLastUpdatedLabel",defaultMessage:"Data updated"},dataLastUpdatedUnknown:{id:"workspaceUsage.dataLastUpdatedUnknown",defaultMessage:"Unknown"},helpCenterLinkText:{id:"workspaceUsage.helpCenterLinkText",defaultMessage:"Learn more about analytics"}}),so=Bt(function(){const s=Ms();return ys(),e.jsx(va,d({},s))});export{so as default};
//# sourceMappingURL=b612cchzogrpgbxc.js.map
