const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/g83306ugnaenca1o.js","assets/bubexfvksfr7893o.js","assets/d9d46aun6hvzsagm.js"])))=>i.map(i=>d[i]);
var Tt=Object.defineProperty;var at=Object.getOwnPropertySymbols;var Pt=Object.prototype.hasOwnProperty,Et=Object.prototype.propertyIsEnumerable;var it=(e,s,a)=>s in e?Tt(e,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[s]=a,D=(e,s)=>{for(var a in s||(s={}))Pt.call(s,a)&&it(e,a,s[a]);if(at)for(var a of at(s))Et.call(s,a)&&it(e,a,s[a]);return e};import{j as t,_ as ut,h as pt,M as rt,r as h}from"./bubexfvksfr7893o.js";import{u as O,J as w,x as vt,cz as j,az as xt,aA as ft,aN as Ct,aB as It,d as At,a2 as zt,P as $t,e$ as Dt,aa as Ot,p as Bt,ib as Lt,f3 as Ft,f7 as Wt,gn as nt,_ as R,l as st,ab as ot,R as Rt,V as Gt,O as Ht,M as Kt,f4 as Vt,gl as Jt}from"./ncw8zw682jinppua.js";import{jB as ht,jC as kt,mk as bt,gL as qt,ml as Qt,jJ as Xt,iy as lt,mm as Yt,jN as Zt,mn as Ut,fn as Mt,jK as te}from"./lm3g1zm00rp6al39.js";import{CoT as ee}from"./eg060qqd4x8bzpxd.js";import{M as dt}from"./hzasobp3hhjtq47p.js";import"./kldvd03dc86uawjw.js";import"./od50gemg82u3x7jt.js";import"./lowm54usy4rzuo31.js";import"./fwwkwalw87hti22b.js";import"./fk5dn736y6oc9os0.js";import"./dgs0l83heankdts0.js";import"./l8gfdbxyfhb5crrj.js";import"./of2lqa4u24wak95x.js";import"./gwwqbtk9yto9dekb.js";import"./i6hdqng3ufj5kq75.js";import"./ecforv0kxuh5qyzb.js";import"./pbl95wx6493wq92j.js";import"./owg1t5lbjzwpi0hd.js";import"./a4n81fjtfjy1tyjw.js";import"./oc4lr1ricjtltb4h.js";function ct({message:e,isCircular:s=!1}){var m,f,k;const a=5.333333333333334;let r=(f=(m=e==null?void 0:e.metadata)==null?void 0:m.pro_progress)!=null?f:0;const p=((k=e==null?void 0:e.metadata)==null?void 0:k.model_slug)==="o1-pro"?480*1e3:1200*1e3,l=e!=null&&e.create_time?e.create_time*1e3:Date.now(),u=ht(l,p);r=Math.max(u,r);const n=O(),c=w(n,"3208967109");return c&&(r=Math.max(r,a)),s?t.jsx(kt,{percentage:r,className:"me-4 w-full!",sizeOverride:20,thickness:1/8,transitionDuration:"".concat((100-r)/100*5,"s"),transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)"}):t.jsx(bt,{percentage:r,className:"me-4 w-full!",backgroundClassName:"bg-token-sidebar-surface-secondary dark:bg-token-border-default rounded-full",barClassName:"bg-token-text-secondary rounded-full",transitionDuration:"".concat((100-r)/100*5,"s"),transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)",height:c?4:8})}function mt({message:e,simulatedDuration:s=480*1e3,maxFill:a=100,isCircular:r=!1}){var c;((c=e==null?void 0:e.metadata)==null?void 0:c.model_slug)!=="o1-pro"&&(s=1200*1e3);const p=e!=null&&e.create_time?new Date(e.create_time*1e3):Date.now(),l=ht(+p,s),u=O(),n=w(u,"3208967109");return r?t.jsx(kt,{percentage:l,className:"me-4 w-full!",transitionDuration:"".concat((100-l)/100*5,"s"),transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)"}):t.jsx(bt,{percentage:Math.min(l,a),className:"me-4 w-full!",backgroundClassName:"bg-token-sidebar-surface-secondary rounded-full",barClassName:"bg-token-text-secondary rounded-full",transitionDuration:"".concat((100-l)/100*.2,"s"),transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)",height:n?4:8})}const ae=xt(()=>ut(()=>import("./g83306ugnaenca1o.js"),__vite__mapDeps([0,1])),{loading:e=>ft(e)});function ie({title:e,content:s,buttons:a,time:r,icon:p,size:l="default",progressBar:u,disabled:n=!1,onClick:c}){const m=l==="small"?"w-full flex max-w-[calc(0.8*var(--thread-content-max-width,40rem))] ps-[20px] pt-[13px] pb-[10px] ".concat(n?"":"gap-4"):"w-full gap-4 px-[22px] pb-[22px] pt-[18px]",f=c?"cursor-pointer":"",k=l==="small"?"text-[15px]":"",b=vt(Ct);return t.jsxs("div",{className:j("relative inline-flex flex-col items-start justify-start rounded-2xl border","bg-token-bg-primary border-token-border-default box-content rounded-2xl border bg-clip-padding px-5 py-4",!b&&"mx-[calc(--spacing(-2)-1px)] -my-[1px] @max-3xl:-top-2 @3xl:-start-3 @3xl:-top-4",m,f,k),onClick:c,children:[t.jsxs("div",{className:j("flex flex-col items-start justify-start self-stretch",l!=="small"&&"gap-1.5"),children:[t.jsxs("div",{className:j("inline-flex items-start justify-start self-stretch",l!=="small"&&"gap-2"),children:[t.jsx("div",{className:j("shrink grow basis-0 leading-normal font-medium","text-token-text-secondary hover:text-token-text-primary"),children:e}),t.jsx("div",{className:"relative h-6 w-6"}),!n&&(p||t.jsx(ae,{className:"relative h-6 w-6"}))]}),t.jsx("div",{className:j("flex w-full flex-col items-start justify-start",l==="small"&&"mt-[-2px]"),children:t.jsx("div",{className:j("inline-flex w-full items-start justify-start self-stretch rounded-sm",l==="small"?"gap-1":"gap-2.5 py-1"),children:t.jsx("div",{className:j("w-full leading-relaxed font-normal",n?"text-token-text-tertiary":"text-token-text-secondary"),children:s})})})]}),u?t.jsxs("div",{className:j("mb-2 inline-flex items-center justify-between self-stretch",(a==null?void 0:a.length)&&"mt-[-10px]"),children:[u,a]}):t.jsxs("div",{className:"inline-flex items-center justify-end self-stretch",children:[r&&t.jsx("div",{className:"text-token-text-tertiary shrink grow basis-0 text-[15px] leading-normal font-normal",children:r}),t.jsx("div",{className:"flex gap-2",children:a})]})]})}const re=xt(()=>ut(()=>import("./d9d46aun6hvzsagm.js"),__vite__mapDeps([2,1])),{loading:e=>ft(e)});function ne({errorNotice:e,onOpenSidebarSummarizer:s,isReceivingUpdates:a,lastMessage:r,latestTitle:p,summarizationHeadline:l,handleSkipClick:u}){var T,P,g,I,A,i,E;const n=O(),c=pt(),m=w(n,"4094234945"),f=w(n,"3208967109"),k=w(n,"3327816228"),b=m?ct:mt,y=a&&k&&((T=r==null?void 0:r.metadata)==null?void 0:T.pro_progress),B=(((P=r==null?void 0:r.metadata)==null?void 0:P.pro_skipped)||((g=r==null?void 0:r.clientMetadata)==null?void 0:g.proSkipPending))&&a;if(f){if(B)return t.jsx("span",{className:"result-streaming pulse relative pt-1",children:t.jsx("span",{})});const _=(A=a?p:(I=r==null?void 0:r.metadata)==null?void 0:I.finished_text)!=null?A:c.formatMessage({id:"hgnsat",defaultMessage:"Thinking"});return t.jsxs("div",{className:"flex items-start gap-3 pb-2",children:[t.jsxs("div",{className:"flex w-full flex-col",children:[t.jsxs("div",{className:"flex w-full items-center justify-between",children:[t.jsx("button",{type:"button",onClick:s,className:"group inline-flex max-w-full items-center rounded-md focus:outline-none",children:t.jsxs("span",{className:a?"loading-shimmer text-token-text-secondary inline-flex max-w-full items-center gap-0.5 truncate text-base leading-5 font-medium md:text-base":"text-token-text-tertiary hover:text-token-text-primary inline-flex max-w-full items-center gap-0.5 truncate text-base leading-5 font-medium md:text-base",children:[_,t.jsx(re,{className:"icon-xs text-token-text-tertiary group-hover:text-token-text-primary"})]})}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:u,className:"text-token-text-tertiary hover:text-token-text-primary whitespace-nowrap transition-opacity duration-1000 ease-out ".concat(y?"pointer-events-auto opacity-100":"pointer-events-none opacity-0"),"aria-hidden":!y,tabIndex:y?0:-1,children:t.jsx("span",{className:"flex items-center gap-0.5 underline decoration-dotted decoration-[8%]",children:t.jsx(rt,{id:"xMM6dg",defaultMessage:"Answer now"})})}),a&&t.jsx("div",{className:"ms-1 shrink-0 self-start md:hidden",children:t.jsx(b,{message:r,isCircular:!0})})]})]}),a&&t.jsx("div",{className:"mt-[22px] mb-2 hidden self-stretch md:inline-flex",children:t.jsx("div",{className:"w-full max-w-[150px]",children:t.jsx(b,{message:r,isCircular:!1})})})]}),e]})}return t.jsxs("div",{className:"flex pb-2",children:[t.jsx(ie,{buttons:a?[t.jsx(It,{onClick:_=>{_.stopPropagation(),s()},color:"secondary",className:"text-token-text-secondary h-[38px]! text-[15px] font-normal",children:t.jsx("div",{className:"px-1",children:t.jsx(rt,{id:"wQcuK8",defaultMessage:"Details"})})},"Details")]:[],time:null,title:l,icon:a?t.jsx("div",{className:""}):null,content:a?"".concat(p,"..."):(E=(i=r==null?void 0:r.metadata)==null?void 0:i.finished_text)!=null?E:"",size:"small",disabled:!a,onClick:s,progressBar:a?m?t.jsx(ct,{message:r}):t.jsx(mt,{message:r}):null}),e]})}const se=/\*\*(.*?)(?:\*\*|\n|$)/g,oe=e=>{let s=null,a;for(;(a=se.exec(e))!=null;)s=a[1].trim();return s};function ve({messages:e,isStreaming:s,isCompletionRequestInProgress:a,hasActiveRequest:r,isLastMessage:p,isFinalTurn:l,isFeedbackEnabled:u,conversation:n,currentGroupedMessageIndex:c,turnIndex:m}){var V,J,q,Q,X,Y,Z,U,M,tt,et;const f=O(),[k,b]=h.useState(""),[y,B]=h.useState(!1),[T,P]=h.useState(!1),g=At(n.serverId$),I=((V=qt(n.id))==null?void 0:V.value)===zt.STREAMING,A=Qt($t(n.id)),i=Dt(e),E=i==null?void 0:i.id,_=(J=i==null?void 0:i.metadata)==null?void 0:J.initial_text,z=(q=i==null?void 0:i.metadata)==null?void 0:q.summarization_headline,$=e.map(d=>Ot(d)).join("\n\n"),L=pt(),F=Bt(),x=(Q=i==null?void 0:i.metadata)==null?void 0:Q.async_task_id;Xt(x,i,n.id),Lt(x);const o=Ft(d=>Wt.getTask(x!=null?x:"",d)),G=h.useCallback(()=>{x?lt(n,{type:"cot",turnIndex:m,reasoningGroupIndex:c}):lt(n,{type:"summarizer",currentGroupedMessageIndex:c,turnIndex:m})},[n,c,m,x]),jt=Yt(f),gt=(X=o==null?void 0:o.taskId)==null?void 0:X.startsWith("thinking"),H=jt&&o&&nt(o)&&!gt;h.useEffect(()=>{if(!H){P(!1);return}T||(Zt(n,{type:"cot",turnIndex:m,reasoningGroupIndex:c}),P(!0))},[n,H,G,T,c,m]);const _t=h.useCallback(()=>{if(!g||!(i!=null&&i.id))return;R.logEventWithStatsig("chatgpt_web_pro_skip_clicked","chatgpt_web_pro_skip_clicked",{conversationId:g,messageId:i.id});const d=i.id,S=i.clientMetadata?D({},i.clientMetadata):void 0,v=i.metadata?D({},i.metadata):void 0;st(n.id,W=>{ot.updateTree(W,C=>{C.updateNodeMetadata(d,{proSkipPending:!0}),C.updateNodeMessageMetadata(d,{pro_skipped:!0})})}),Rt.safePost("/pro_mode/{conversation_id}/skip",{parameters:{path:{conversation_id:g}}}).catch(()=>{F.danger(L.formatMessage({id:"summmarizer.skip.toast",defaultMessage:"Failed to answer now. Please try again."}),{hasCloseButton:!0,toastId:"summarizer_skip_failed"}),st(n.id,W=>{ot.updateTree(W,C=>{C.updateNodeMetadata(d,{proSkipPending:S==null?void 0:S.proSkipPending}),C.updateNodeMessageMetadata(d,{pro_skipped:v==null?void 0:v.pro_skipped})})})})},[n.id,g,L,i,F]),K=w(f,"3208967109"),yt=Ut({taskId:o==null?void 0:o.taskId,intl:L,toaster:F});h.useEffect(()=>{const d=oe($);if(d){b(d);return}if(K&&z!=null){b(z);return}_!=null&&b(_)},[$,z,K,_]),h.useEffect(()=>{$.length>0&&B(!0)},[$]),h.useEffect(()=>{y&&R.logEvent("Tool: Received a8km123 message",{client_thread_id:n.id,message_id:E,conversationId:n.serverId$()})},[y]);const Nt=l&&p&&(I||s),St=Gt.isLastActorMessage(Ht(n.id),e[0].id),wt=!!Kt(n.id,d=>d==null?void 0:d.sharedConversationMetadata),N=Mt(e[0],St,a||r,wt);if(x){const d=o?nt(o):!1,S=(x.startsWith("thinking")||x.startsWith("pro"))&&d&&(o==null?void 0:o.status)!==Vt.SKIPPING,v=()=>{R.logEventWithStatsig("chatgpt_web_pro_skip_clicked","chatgpt_web_pro_skip_clicked",{conversationId:n.id,messageId:E}),yt.mutate()};return t.jsx(ee,{isStreaming:d,isFinalAssistantTurn:l,isAgentTurn:!1,taskType:o?Jt(o):void 0,activeTask:o,messageGroups:te((Y=o==null?void 0:o.rows)!=null?Y:[]).groups,conversation:n,turnIndex:m,currentGroupedMessageIndex:c,latestError:N?D({messageId:e[0].id,conversation:n},N):void 0,isAutoswitchOptOutEnabled:S,handleSkipClick:S?v:void 0})}return!A&&((U=(Z=i==null?void 0:i.metadata)==null?void 0:Z.finish_details)==null?void 0:U.type)==="interrupted"&&((tt=(M=i==null?void 0:i.metadata)==null?void 0:M.finish_details)==null?void 0:tt.reason)!=="server_timeout"||(et=i==null?void 0:i.clientMetadata)!=null&&et.err?t.jsx("div",{children:N&&t.jsx(dt,{errorState:N,nodeId:e[0].id,isFeedbackEnabled:u,conversation:n,isUserTurn:!1})}):t.jsx(ne,{errorNotice:N&&t.jsx(dt,{errorState:N,nodeId:e[0].id,isFeedbackEnabled:u,conversation:n,isUserTurn:!1}),onOpenSidebarSummarizer:G,isReceivingUpdates:Nt,lastMessage:i,latestTitle:k,summarizationHeadline:z,handleSkipClick:_t})}export{ve as default};
//# sourceMappingURL=oa16lvcadyt25kvo.js.map
