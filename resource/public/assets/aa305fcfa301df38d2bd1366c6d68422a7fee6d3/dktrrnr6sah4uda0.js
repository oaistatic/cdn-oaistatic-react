const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/lm3g1zm00rp6al39.js","assets/bubexfvksfr7893o.js","assets/ncw8zw682jinppua.js","assets/root-ookb7xuw.css","assets/conversation-small-lq38g8zw.css","assets/mlll5kvj3qdj7fj8.js","assets/ei2rr3u86wwo8xvm.js","assets/k1cl8bhg0vqi0zvs.js","assets/hyub38ofpwemwztz.js","assets/gsyjy3cn2edhhxqr.js","assets/jaztged0ed1qpm4w.js","assets/kn8qwq1mz5gcoykc.js","assets/coua0c0g0n9zwyhc.js"])))=>i.map(i=>d[i]);
var Qs=Object.defineProperty,Ws=Object.defineProperties;var Zs=Object.getOwnPropertyDescriptors;var qt=Object.getOwnPropertySymbols;var Ys=Object.prototype.hasOwnProperty,Xs=Object.prototype.propertyIsEnumerable;var zt=(e,n,s)=>n in e?Qs(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s,V=(e,n)=>{for(var s in n||(n={}))Ys.call(n,s)&&zt(e,s,n[s]);if(qt)for(var s of qt(n))Xs.call(n,s)&&zt(e,s,n[s]);return e},ee=(e,n)=>Ws(e,Zs(n));import{h as se,j as t,M as dt,r as m,_ as G,u as Ge,i as ge,b as ms,e as $s,t as Js}from"./bubexfvksfr7893o.js";import{u as Vs,C as en,a as tn,H as sn,T as nn}from"./gk9c5stronfar8qx.js";import{fN as on,fW as an,vQ as Qe,mD as M,mE as U,n9 as qe,vR as fs,vS as rn,vT as cn,n5 as Kt,uG as ln,oQ as un,oS as dn,oR as mn,vU as fn,vV as gn,ep as Gt,de as we,h9 as hn,ha as pn,B as Cn,E as xn,vW as Ue,al as vn,K as yn,ai as _n,nb as bn,fh as be,vX as Tn,vY as gs,vZ as Sn,v_ as En,v$ as mt,w0 as wn,nV as An,w1 as In,nq as Te,w2 as kn,w3 as jn,mc as Rn,w4 as Pn,c as Dn,w5 as Mn,w6 as Nn,w7 as On,w8 as Ln,fd as Bn,fe as Hn,ff as Fn,nt as Qt,mh as Wt,fg as Zt,w9 as Un,wa as qn,b as zn,wb as Kn,gm as Gn,mi as Qn,N as Wn,wc as Yt,e5 as Xt,wd as ct,we as $t,wf as He,wg as Fe,wh as Jt}from"./lm3g1zm00rp6al39.js";import{mg as hs,aC as Zn,dR as Yn,dc as Vt,bS as Xn,dS as ie,aB as es,qr as $n,db as Jn,M as ft,d$ as We,V as ps,ay as ts,az as Q,u as Ze,g as Vn,d as eo,cz as Ee,aA as W,hB as to,D as Cs,R as te,cp as xs,vO as vs,eH as k,mF as ss,cr as ze,dU as so,cv as no,ct as oo,J as ys,L as ao,cn as ns,e$ as ro,h$ as io,hO as co,kj as lo,jC as uo,lx as mo,_ as fo}from"./ncw8zw682jinppua.js";import{O as go,b as ce,u as ho,c as po,j as Co,g as xo,A as vo,a as yo,f as os,C as me,D as _o}from"./eii6zxu7kogjx11x.js";import{e as bo}from"./o66elomacusdy99v.js";import{C as To}from"./oumcmu9jw5n6nb3o.js";import{i as So,c as Eo,d as wo,b as Ao,a as Io,g as ko}from"./o4w8zbrq7mg3p422.js";import{C as Ke,e as as,S as rs}from"./imbbtedzs51am1ck.js";import{a as jo}from"./n8xi1u5k4xaewewd.js";import{D as Ro}from"./bo0p7vuujjmng48f.js";import{i as Po}from"./ffvjxtmoqooghm1t.js";import{C as Do}from"./b3zmi7k0e1dvao0m.js";import{g as lt,S as Mo}from"./irqko7c1s7qpl41n.js";import{s as ut,B as No}from"./knfzy5vszhnec9ql.js";import{N as Oo}from"./ce3hgmw4iyyhicud.js";import{L as Lo}from"./bc00p2ldn9cv9q32.js";import{i as is}from"./ke3w2t9x8i7kgfhv.js";import{g as Bo}from"./nxg251y5bix8gl53.js";var _s=(e=>(e.Close="close",e.Loaded="loaded",e.Streaming="streaming",e.Download="download",e))(_s||{});const Ho=({isOpen:e,dismissModal:n,closeTextdocEditor:s,textdocVersion:o,clientThreadId:i})=>{const r=se(),a=on(i),l=an(i),h=hs(),c=Qe(o==null?void 0:o.textdocId),u=async v=>{M.logButtonClick(U.SAVE_TO_CHAT_ON_EDITOR_CLOSE),!((o==null?void 0:o.versionInt)==null||h)&&(l({sourceEvent:v,promptMessage:Xn("",{canvas:{user_created_textdocs:o!=null&&o.status===fs.ATTACHED_PENDING&&c!=null?[{user_created_temp_textdoc_id:o.textdocId,type:o.type,title:o.title,content:o.content,create_source:c.create_source}]:void 0},open_in_canvas_view:{type:"canvas_textdoc",id:o.textdocId}}),completionMetadata:a?{conversationMode:a}:void 0}),c&&qe.markAsSent(c.tempTextdocId),n(),s())};return t.jsx(Zn,{testId:"modal-confirm-close-editor",isOpen:e,size:"custom",className:"max-w-xl",onClose:n,type:"warning",hideSeparator:!0,title:t.jsx("span",{className:"text-xl",children:t.jsx(dt,{id:"jgd5rD",defaultMessage:"Are you sure you want to close?"})}),primaryButton:t.jsx(Vt.Button,{title:r.formatMessage({id:"XE+GiU",defaultMessage:"Save to chat"}),color:"primary",onClick:u}),secondaryButton:t.jsx(Vt.Button,{title:r.formatMessage({id:"MbWco5",defaultMessage:"Donâ€™t save and close"}),color:"secondary",onClick:()=>{M.logButtonClick(U.CLOSE_WITHOUT_SAVING),c&&qe.removeTempTextdoc(c.tempTextdocId),n(),s()}}),showCloseButton:!0,closeButton:t.jsx(Yn,{onClick:n}),children:t.jsx("div",{className:"text-md text-token-text-secondary -mt-6 pb-2",children:t.jsx(dt,{id:"q9rJ+Y",defaultMessage:"Changes will not be saved unless you save this canvas to your chat."})})})};function bs(e){const n=rn();if(!e)return{isCodePreviewable:!1,isCodeExecutable:!1,hasCanvasCodeExecution:n};const s=So(e==null?void 0:e.type,e==null?void 0:e.content),o=Eo(e.type);return{isCodePreviewable:s,isCodeExecutable:o,hasCanvasCodeExecution:n}}const Fo=({isTextdocStreaming:e,isRequestActive:n,value:s,comments:o})=>{const[i,r]=m.useState(!1);return m.useEffect(()=>{e&&i&&(r(!1),Ke.reset())},[s,o]),m.useEffect(()=>{n||(r(!1),Ke.reset())},[n]),[i,r]};function Uo({onClickRestore:e,onClickResetLatest:n}){const s=se();return t.jsx(ie.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},transition:{bounce:0,duration:.24},className:"bg-token-main-surface-primary z-30",children:t.jsx(ie.div,{className:"bg-token-main-surface-primary dark:border-token-border-xlight @container w-full items-center border-t border-gray-100 p-6 shadow-[0_-4px_32px_rgba(0,0,0,0.08)] lg:border-s dark:shadow-[0_-4px_32px_rgba(0,0,0,0.12)]",children:t.jsxs("div",{className:"mx-auto flex max-w-[48rem] flex-col flex-wrap justify-center gap-5 @2xl:flex-row @2xl:justify-between",children:[t.jsxs("div",{className:"flex flex-col px-2 text-center @2xl:text-start",children:[t.jsx("span",{className:"text-md text-token-text-primary font-semibold text-wrap",children:s.formatMessage({id:"gt23pb",defaultMessage:"You are viewing a previous version"})}),t.jsx("span",{className:"text-token-text-secondary text-sm text-wrap",children:s.formatMessage({id:"sAlUJn",defaultMessage:"Restore this version to make edits"})})]}),t.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-4",children:[t.jsx(es,{as:"button",color:"primary",onClick:e,children:s.formatMessage({id:"+cddAb",defaultMessage:"Restore this version"})}),t.jsx(es,{as:"button",color:"secondary",onClick:n,children:s.formatMessage({id:"qCD3eu",defaultMessage:"Back to latest version"})})]})]})})})}const qo={type:"spring",bounce:.2,duration:.56},zo=({conversation:e,turn:n})=>{const s=$n();return t.jsxs(ie.div,{className:"absolute start-0 end-0 top-0 z-10 -translate-y-full",children:[t.jsx(ie.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"bg-vert-light-gradient dark:from-token-main-surface-primary absolute inset-0 -top-5 dark:bg-linear-to-t dark:to-transparent"}),t.jsx(ie.div,{className:"flex items-center py-2",initial:{opacity:.75,translateX:-50,translateY:"100%"},animate:{opacity:1,translateX:0,translateY:"0"},exit:{opacity:0,filter:"blur(8px)",transition:{delay:.4,duration:.72}},transition:qo,children:t.jsx(Do,{conversation:e,onRequestCompletion:Jn,groupedMessagesToRender:n.messageGroups,allGroupedMessages:n.messageGroups,allMessages:n.messages,isUserTurn:!0,isFinalUserTurn:!1,isFinalAssistantTurn:!1,turnIndex:0,isCompletionRequestInProgress:!1,isFeedbackEnabled:!1,isFinalTurn:!1,hasActiveRequest:s})})]},"user-message")},Ko=({conversation:e})=>{const n=e.id,{lastUserTurn:s,lastAssistantTurn:o}=ft(n,r=>{const a=ps.getConversationTurns(r);let l=null,h=null;for(let c=a.length-1;c>0;c--){const u=a[c];if(!l&&u.role===ts.User?l=u:!h&&u.role===ts.Assistant&&(h=u),l&&h)break}return{lastUserTurn:l,lastAssistantTurn:h}}),i=s&&!(o!=null&&o.messages.some(r=>{var a;return(a=r.recipient)==null?void 0:a.startsWith(cn)}));return t.jsx(We,{initial:!1,children:i&&t.jsx(zo,{turn:s,conversation:e})})},Go=Q(()=>G(()=>import("./lm3g1zm00rp6al39.js").then(e=>e.zx),__vite__mapDeps([0,1,2,3,4])),{loading:e=>W(e)}),Qo=({isRequestActive:e=!1,clientThreadId:n,readonlyReason:s,onCancel:o,onSubmit:i,onSubmitAccelerator:r,acceleratorActions:a=[]})=>{var R;const l=Ze(),h=Vn(l,n),[c,u]=m.useState(!1),[v,b]=m.useState(""),[f,S]=m.useState(!0),A=se(),[T,g]=m.useState(!1),x=eo(to),_=d=>{i==null||i(d,v),b("")},E=d=>{if(d.nativeEvent.isComposing)return;const{metaKey:w,shiftKey:I,key:j}=d;j==="Enter"&&v.trim()&&!(I||w)&&(_(d),d.preventDefault())};return t.jsxs(t.Fragment,{children:[c&&!x&&t.jsx(go,{zIndexKey:"acceleratorsOverlay",className:"bg-white/95 dark:bg-black/85"}),t.jsx("div",{className:"relative mb-3 flex items-end justify-center",children:t.jsxs("div",{className:"relative mx-6 max-w-2xl flex-1",children:[t.jsx(Ko,{conversation:h}),t.jsx("div",{className:"flex flex-auto items-start",children:t.jsx("div",{className:Ee("dark:bg-token-main-surface-secondary flex min-h-12 flex-auto items-center bg-[#f4f4f4] py-1 ps-6 pe-2",{"rounded-full":f,"rounded-2xl":!f,"bg-transparent":T}),children:t.jsxs("div",{className:"relative flex flex-auto items-center self-stretch",children:[t.jsx(Po,{placeholder:A.formatMessage({id:"zrUbTJ",defaultMessage:"Ask ChatGPT to edit"}),disabled:e,value:v,className:Ee("text-token-text-primary placeholder:text-token-text-secondary w-full resize-none border-0 bg-transparent p-0 outline-0 focus:ring-0 focus-visible:ring-0",{"opacity-0":T}),maxRows:4,onChange:({target:{value:d}})=>b(d),onKeyDown:E,onHeightChange:(d,{rowHeight:w})=>S(Math.floor(d/w)<=1)}),v?t.jsx(ie.button,{className:Ee("dark bg-token-main-surface-primary h-8 w-8 rounded-full text-center disabled:bg-[#D7D7D7]",{"self-end":!f}),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.1},onMouseDown:_,children:t.jsx(Go,{className:"text-token-text-primary h-8 w-8"})}):((R=a==null?void 0:a.length)!=null?R:0)>0&&t.jsx(Ro,{disableHint:!0,isVisuallyHidden:(s==null?void 0:s.isReadonly)&&!s.isStreaming,disableOverlay:!0,isEmbeddedInPromptArea:!0,isRequestActive:e,actions:a,onCancel:o,onExpandedChange:d=>{x||g(d),u(d)},onSubmit:r,right:0,bottom:4})]})})})]})})]})};function Wo(e,n){const s=new Set(e.map(l=>l.id)),o=new Set(n.map(l=>l.id)),i=e.filter(l=>!o.has(l.id)).map(l=>ee(V({},l),{diffStatus:Kt.REMOVED})),r=n.filter(l=>!s.has(l.id)).map(l=>ee(V({},l),{diffStatus:Kt.ADDED})),a=e.filter(l=>o.has(l.id));return i.concat(r,a)}const Zo=e=>{const{textdocId:n}=e,s=ln(o=>{var i;return(i=o==null?void 0:o.resolveTempTextdocId[n])!=null?i:n});return m.useMemo(()=>ee(V({},e),{textdocId:s}),[s,e])};async function Yo({textdocId:e,newTitle:n}){n!=null&&await te.safePost("/textdoc/{textdoc_id}/rename",{parameters:{path:{textdoc_id:e}},requestBody:{title:n}}).catch(s=>{Cs.addError("renameCanvasTitle Error:",s)})}const Xo=({serverThreadId:e,textdocVersion:n,initialTitle:s="Untitled Document",isEditingTitle:o,setIsEditingTitle:i})=>{const r=Ge(),{mutateAsync:a}=ge({mutationKey:[e,"textdocs"],mutationFn:Yo,onMutate:async({textdocId:g,newTitle:x})=>{await r.cancelQueries({queryKey:[e,"textdocs"]});const _=r.getQueryData([e,"textdocs"]);return r.setQueryData([e,"textdocs"],E=>{if(!E)return E;const R=new Map(E.persistedTextdocVersionById),d=R.get(g);if(d){const P=ee(V({},d),{title:x!=null?x:""});R.set(g,P)}const w=E.persistedTextdocVersions.map(P=>P.textdocId===g?ee(V({},P),{title:x!=null?x:""}):P),I=new Map(E.persistedTextdocById),j=I.get(g);if(j){const P=ee(V({},j),{title:x!=null?x:""});I.set(g,P)}return ee(V({},E),{persistedTextdocVersionById:R,persistedTextdocVersions:w,persistedTextdocById:I})}),{previousTextDocData:_}},retry:2,onError:(g,x,_)=>{_!=null&&_.previousTextDocData&&r.setQueryData([e,"textdocs"],_.previousTextDocData),Cs.addError("Error updating title:",g)},onSettled:()=>{r.invalidateQueries({queryKey:[e,"textdocs"]})}}),l=async g=>{var x;n&&await a({textdocId:(x=n.textdocId)!=null?x:"",newTitle:g})},[h,c]=m.useState(s),u=m.useRef(null),v=m.useRef(h),b=m.useRef(!1);m.useEffect(()=>{o&&u.current&&(u.current.focus(),u.current.select())},[o]);const f=g=>{c(g.target.value)},S=()=>{v.current=h},A=async()=>{b.current||await l(h),b.current=!1,i(!1)},T=g=>{(g.key==="Enter"||g.key==="Escape")&&g.preventDefault(),g.key==="Enter"?g.currentTarget.blur():g.key==="Escape"&&(c(v.current),b.current=!0,g.currentTarget.blur())};return t.jsx("input",{className:"w-[300px] rounded-lg border-none px-3 py-2 outline-hidden focus:ring-0",ref:u,value:h,onChange:f,onFocus:S,onBlur:A,onKeyDown:T,style:{fontSize:"1.125rem",boxSizing:"border-box",backgroundColor:"var(--global-states-light-element-hover, rgba(0, 0, 0, 0.05))"}})};function $o(e){const{voiceName:n}=un(),s=e?()=>Jo(e.textdocId,n,mn()):null,o="".concat(e==null?void 0:e.textdocId,".").concat(e==null?void 0:e.versionInt,".").concat(n);return dn(s,o)}function Jo(e,n,s){return te.safeGet("/textdoc/{textdoc_id}/synthesize",{parameters:{path:{textdoc_id:e},query:{voice:n,format:s}},skipJsonTransform:!0})}const Vo=Q(()=>G(()=>import("./mlll5kvj3qdj7fj8.js"),__vite__mapDeps([5,1])),{loading:e=>W(e)}),ea=Q(()=>G(()=>import("./ei2rr3u86wwo8xvm.js"),__vite__mapDeps([6,1])),{loading:e=>W(e)}),ta=Q(()=>G(()=>import("./lm3g1zm00rp6al39.js").then(e=>e.zv),__vite__mapDeps([0,1,2,3,4])),{loading:e=>W(e)}),sa=({textdocVersion:e,isPersisting:n=!1,isTextdocAttachedPending:s,isTextdocStreaming:o,hasDebug:i,shouldShowPlayButton:r=!1,hideRenameButton:a=!1,toggleDebugView:l,isDebugVisible:h,toggleConsoleVisibility:c,isConsoleOpen:u,clientThreadId:v})=>{var B,Z;const b=Ze(),f=se();fn(b),$o(e);const[S,A]=m.useState(!1),T=(B=e==null?void 0:e.title)!=null?B:"",g=(Z=xs(v))!=null?Z:"",x=Qe(e==null?void 0:e.textdocId),_=!T||(x==null?void 0:x.status)===gn.INFERRING,E=()=>{A(!0)},[R,d]=m.useState(!1),{container:w,triggerRef:I}=vs({isOpen:R,onClose:()=>d(!1)}),j=[!x&&!a&&!o?t.jsx(k.Item,{icon:ea,onClick:E,children:f.formatMessage({id:"z/PT9T",defaultMessage:"Rename"})},"rename"):null,null,r?t.jsx(k.Item,{icon:Vo,onClick:c,children:u?f.formatMessage({id:"owGHqE",defaultMessage:"Close console"}):f.formatMessage({id:"GPb4WX",defaultMessage:"Open console"})},"console"):null,null].filter(Boolean);if(j.length===0)return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"flex h-6 grow items-center overflow-hidden",children:t.jsx(ce.Title,{className:"@[0px]:hidden @[150px]:block",children:_?t.jsx("div",{className:"w-52",children:t.jsx(ss,{lines:1,size:"base",width:100,widthVariance:0})}):T})}),n&&t.jsx(Gt,{size:12,className:"text-token-text-tertiary ps-1"})]});const P=e&&t.jsx(k.Portal,{container:w,children:t.jsx(k.Content,{onCloseAutoFocus:oe=>oe.preventDefault(),children:j})});return t.jsx(t.Fragment,{children:S?t.jsx(Xo,{serverThreadId:g,textdocVersion:e,initialTitle:T,isEditingTitle:S,setIsEditingTitle:A}):t.jsxs(t.Fragment,{children:[!1,t.jsxs(k.Root,{open:R,onOpenChange:d,children:[t.jsxs(k.Trigger,{ref:I,className:"hover:bg-token-surface-hover grid grid-cols-[1fr_auto] border-none bg-transparent! pe-2",children:[t.jsx(ce.Title,{className:"max-w-[270px] truncate overflow-hidden",children:_?t.jsx("div",{className:"w-52",children:t.jsx(ss,{lines:1,size:"base",width:100,widthVariance:0})}):T}),t.jsx("div",{className:"flex items-center ps-1",children:n?t.jsx(Gt,{size:12,className:"text-token-text-tertiary"}):t.jsx(ta,{className:"icon-sm text-token-text-tertiary"})})]}),P]})]})})};function na({textdocVersion:e,clientThreadId:n,color:s}){const{handleCopy:o,Icon:i,copyLabel:r}=ho({textdocVersion:e,clientThreadId:n});return t.jsx(ze,{label:r,children:t.jsx(we,{icon:i,onClick:o,color:s})})}const cs=Q(()=>G(()=>import("./k1cl8bhg0vqi0zvs.js"),__vite__mapDeps([7,1])),{loading:e=>W(e)});function oa({textdocVersion:e,disabled:n,clientThreadId:s}){const o=se(),{handleFileDownload:i,handleBlobDownload:r,isLoading:a,downloadCopyLabel:l,isDocument:h}=po({textdocVersion:e,clientThreadId:s});return h?t.jsxs(k.Sub,{children:[t.jsx(k.SubMenuTrigger,{icon:cs,label:l,disabled:a||n}),t.jsx(k.Portal,{children:t.jsxs(k.SubContent,{align:"end",children:[t.jsx(k.Item,{onClick:c=>{c.preventDefault(),i("pdf")},children:o.formatMessage({id:"canvas.download-pdf-button.menu",defaultMessage:"PDF Document (.pdf)"})}),t.jsx(k.Item,{onClick:c=>{c.preventDefault(),i("docx")},children:o.formatMessage({id:"canvas.download-docx-button.menu",defaultMessage:"Microsoft Word Document (.docx)"})}),t.jsx(k.Item,{onClick:c=>{c.preventDefault(),i("md")},children:o.formatMessage({id:"canvas.download-md-button.menu",defaultMessage:"Markdown Document (.md)"})})]})})]}):t.jsx(k.Item,{label:l,icon:cs,disabled:a||n,onClick:r})}function aa(e){for(const n of ra){const s=e.match(n);if(s)return s[0]}return null}const ra=[/AKIA[0-9A-Z]{16}/,/AIza[0-9A-Za-z_-]{35}/,/^(?:ghp_[A-Za-z0-9]{36}|github_pat_[A-Za-z0-9]{22}_[A-Za-z0-9]{59}|gho_[A-Za-z0-9]{36}|ghu_[A-Za-z0-9]{36}|ghs_[A-Za-z0-9]{36}|ghr_[A-Za-z0-9]{36})$/,/xox[baprs]-[0-9A-Za-z-]+/,/sk-[A-Za-z0-9]{48}/,/SK[0-9a-fA-F]{32}/,/(sk_live_[0-9a-zA-Z]{24})|(sk_test_[0-9a-zA-Z]{24})/,/-----BEGIN PRIVATE KEY-----/],ls=Q(()=>G(()=>import("./lm3g1zm00rp6al39.js").then(e=>e.z9),__vite__mapDeps([0,1,2,3,4])),{loading:e=>W(e)}),ia="".concat(Mo,"...");function fe(e){return["canvas","textdoc","share",e]}function ca({isLoading:e,isPublishedVersionLatest:n,sharedTextdoc:s,textdocVersion:o,title:i}){const{textdocId:r}=o,[a,l]=m.useState(!1),h=aa(o.content),c=(d,w)=>{d&&vn(d,void 0,w).then(()=>{l(!0),setTimeout(()=>{l(!1)},1500)}).catch(()=>{})},u=Ge(),{mutate:v,isPending:b}=ge({scope:{id:r},mutationFn:d=>te.safePost("/textdoc/{textdoc_id}/share",{parameters:{path:{textdoc_id:d}}}).then(w=>Ue(w.shared_textdoc)),onSuccess:d=>{u.setQueryData(fe(r),d),c(lt(d.sharedTextdocId))}}),{mutate:f,isSuccess:S}=ge({scope:{id:r},mutationFn:d=>te.safePost("/textdoc/shared/{shared_textdoc_id}/update_to_latest",{parameters:{path:{shared_textdoc_id:d}}}).then(w=>Ue(w.shared_textdoc)),onSuccess:d=>{u.setQueryData(fe(r),d)}}),{mutate:A}=ge({scope:{id:r},mutationFn:({sharedTextdocId:d,access:w})=>te.safePost("/textdoc/shared/{shared_textdoc_id}/update_access",{parameters:{path:{shared_textdoc_id:d}},requestBody:{shared_textdoc_access:w}}).then(I=>Ue(I.shared_textdoc)),onMutate:({access:d})=>{const w=fe(r),I=u.getQueryData(w);return u.setQueryData(w,I&&ee(V({},I),{access:d})),{previousAccess:I==null?void 0:I.access}},onSuccess:d=>{u.setQueryData(fe(r),d)},onError:(d,w,I)=>{const j=fe(r),P=u.getQueryData(j);u.setQueryData(j,P&&ee(V({},P),{access:I==null?void 0:I.previousAccess}))}}),T=m.useRef(null),g=d=>{var w;(w=T.current)==null||w.focus(),s?(M.logButtonClick(U.COPY_SHARE_LINK,Se(o)),c(lt(s.sharedTextdocId),d)):(M.logButtonClick(U.CREATE_SHARE_LINK,Se(o)),v(r))},x=d=>{s&&(M.logButtonClick(d===yn.PUBLIC?U.UPDATE_SHARE_LINK_PUBLIC:U.UPDATE_SHARE_LINK_PRIVATE,Se(o)),A({sharedTextdocId:s.sharedTextdocId,access:d}))},_=s?lt(s.sharedTextdocId):void 0,E=()=>{s&&(M.logButtonClick(U.UPDATE_SHARE_LINK_TO_LATEST,Se(o)),f(s.sharedTextdocId))},R=h||(s==null?void 0:s.isAnonifyApiKeyDetected);return t.jsx(No,{inputRef:T,isLoading:e,isPublishedVersionLatest:n,sharedObject:s&&{id:s.sharedTextdocId,title:i,access:s.access,versionInt:s.versionInt,isModerationBlocked:s.isModerationBlocked,isAnonifyApiKeyDetected:s.isAnonifyApiKeyDetected},title:i,shareTextPlaceholder:ia,shareUrl:_,isCopySuccessful:a,didPublishUpdates:S,isCreateLinkRequestInProgress:b,handleUpdateLatestSharedVersion:E,handlePrivacyChange:x,handlePrimaryButtonClick:g,maybeRenderWarndingContent:()=>t.jsx(t.Fragment,{children:R&&t.jsx(ua,{})})})}function Se(e){return{textdocType:e.type,textdocId:e.textdocId}}function la({textdocVersion:e,isDisabled:n,title:s}){const o=so(),i=se(),r=e==null?void 0:e.textdocId,{data:a,isLoading:l}=ms({enabled:!!r&&!n,queryKey:fe(r),queryFn:()=>!r||r.startsWith(bn)?Promise.resolve(null):te.safeGet("/textdoc/{textdoc_id}/share",{parameters:{path:{textdoc_id:r}}}).then(T=>T.shared_textdoc&&Ue(T.shared_textdoc))}),[h,c]=m.useState(!1),{triggerRef:u,container:v}=vs({isOpen:h,onClose:()=>c(!1)}),b=(o==null?void 0:o.isWorkspaceAccount())&&!(o!=null&&o.features.includes(no.WorkspaceShareLinks));if(n||b||!e)return t.jsx(ze,{label:b?i.formatMessage(ut.workspaceSharingDisabled):i.formatMessage(ut.share),children:t.jsx(we,{disabled:!0,icon:ls})});const f=()=>{M.logButtonClick(U.OPEN_SHARE_MENU,Se(e))},S=(a==null?void 0:a.versionInt)===e.versionInt&&(a==null?void 0:a.title)===e.title,A=({className:T})=>t.jsxs("div",{className:"relative h-fit w-fit",children:[t.jsx(ls,{className:T}),!S&&a&&t.jsx("div",{className:"absolute end-0 top-[1px] flex items-center gap-1.5",children:t.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-blue-400"})})]});return t.jsxs(hn,{open:h,onOpenChange:c,children:[t.jsx(ze,{label:i.formatMessage(ut.share),children:t.jsx(pn,{ref:u,asChild:!0,children:t.jsx(we,{icon:A,onClick:f})})}),t.jsx(We,{children:h&&t.jsx(Cn,{forceMount:!0,container:v,children:t.jsx(xn,{align:"end",className:"z-50",sideOffset:8,collisionPadding:8,children:t.jsx(ca,{title:s,sharedTextdoc:a,isLoading:l,isPublishedVersionLatest:S,textdocVersion:e})})})})]})}function ua(){return t.jsx(_n,{type:"danger",className:"w-auto md:p-3",children:t.jsx(dt,{id:"8NG6sN",defaultMessage:"There may be an API key in your canvas. If you share the canvas, anyone with the link can see its contents."})})}const da=Q(()=>G(()=>import("./hyub38ofpwemwztz.js"),__vite__mapDeps([8,1])),{loading:e=>W(e)});function ma({disabled:e=!1,isShowingChanges:n,onMouseEnter:s,onClick:o,onEsc:i}){const r=se(),a=m.useRef(null);return m.useEffect(()=>{if(n){const l=h=>{h.key==="Escape"&&(i==null||i(),a.current&&a.current===document.activeElement&&a.current.blur())};return window.document.addEventListener("keydown",l),()=>{window.document.removeEventListener("keydown",l)}}},[n,i]),t.jsx(ze,{label:!e&&r.formatMessage(n?us.hideChanges:us.showChanges),children:t.jsx(we,{icon:da,ref:a,disabled:e,onClick:o,onMouseEnter:s,className:Ee("transition-colors enabled:hover:bg-black/5 dark:enabled:hover:bg-white/10",n&&Oo)})})}const us=$s({showChanges:{id:"3jMGNS",defaultMessage:"Show changes"},hideChanges:{id:"HWiQSk",defaultMessage:"Hide changes"}}),fa=Q(()=>G(()=>import("./gsyjy3cn2edhhxqr.js"),__vite__mapDeps([9,1])),{loading:e=>W(e)}),ga=Q(()=>G(()=>import("./jaztged0ed1qpm4w.js"),__vite__mapDeps([10,1])),{loading:e=>W(e)}),ha=Q(()=>G(()=>import("./kn8qwq1mz5gcoykc.js"),__vite__mapDeps([11,1])),{loading:e=>W(e)}),pa=Q(()=>G(()=>import("./coua0c0g0n9zwyhc.js"),__vite__mapDeps([12,1])),{loading:e=>W(e)}),Ca=({clientThreadId:e,isHistoricalVersion:n,textdocVersion:s,readonlyReason:o,hasDebug:i,isEmbedded:r,isPersisting:a,isShowingChanges:l,hideRunCode:h=!1,hideHistoryActions:c=!1,hideRenameButton:u=!1,onHoverPrevious:v,onHoverShowChanges:b,onToggleShowChanges:f,onClickPrevious:S,onClickNext:A,onClickCodePreview:T,onClose:g,toggleDebugView:x,toggleConsoleVisibility:_,isCodeRunning:E,isTextdocAttachedPending:R,isTextdocStreaming:d,isConsoleOpen:w,isDebugVisible:I})=>{var ve,Y;const j=se(),P=oo(),B=Qe(s==null?void 0:s.textdocId),Z=(ve=s==null?void 0:s.title)!=null?ve:"",{isCodePreviewable:oe,isCodeExecutable:H,hasCanvasCodeExecution:O}=bs(s),ae=(Y=s==null?void 0:s.metadata)==null?void 0:Y.hive_id,q=Ze(),he=ae!=null&&ys(q,"292227286"),{mutate:Ae,isPending:Ye}=ge({scope:{id:ae!=null?ae:""},mutationFn:je=>te.safePost("/hive/{hive_id}/send_summary_to_slack",{parameters:{path:{hive_id:je}}})}),Xe=()=>{ae&&Ae(ae)},pe=!h&&(oe||H),F=s==null?void 0:s.versionInt,ne=F!=null&&F>1,le=n,Ce=!c,xe=oe&&E,Ie=s==null||B!=null||n||o.isStreaming,ke=s==null||o.isStreaming;return t.jsxs(ce.Header,{className:Ee("@container",oe&&E&&"bg-transparent!"),children:[t.jsx(ce.CloseButton,{onClick:g}),t.jsx("div",{className:"@container flex flex-1 basis-0 items-center truncate leading-[0]",children:t.jsx(sa,{hasDebug:i,isConsoleOpen:w,isDebugVisible:I,toggleConsoleVisibility:_,toggleDebugView:x,isPersisting:a,textdocVersion:s,isTextdocAttachedPending:R,isTextdocStreaming:d,shouldShowPlayButton:pe,hideRenameButton:u,clientThreadId:e})}),t.jsxs("div",{className:"flex min-w-0 basis-auto items-center leading-[0] select-none",children:[t.jsx(na,{clientThreadId:e,textdocVersion:s}),t.jsx(la,{isDisabled:Ie,textdocVersion:s,title:Z}),Ce&&t.jsx(We,{children:t.jsx(ie.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,width:0},transition:{type:"spring",bounce:.24,duration:.4},children:t.jsx(ma,{disabled:xe||o.isStreaming||!ne,isShowingChanges:l,onMouseEnter:b,onClick:f,onEsc:f})})}),t.jsxs(k.Root,{children:[t.jsx(k.BasicTrigger,{children:t.jsx(we,{icon:ga})}),t.jsx(k.Portal,{children:t.jsxs(k.Content,{align:"end",children:[t.jsx(k.Item,{icon:pa,disabled:!ne,onClick:S,onMouseOver:v,label:j.formatMessage({id:"PoD5+8",defaultMessage:"Previous version"})}),t.jsx(k.Item,{icon:ha,disabled:!le,onClick:A,label:j.formatMessage({id:"PJ8YVJ",defaultMessage:"Next version"})}),t.jsxs(k.Group,{children:[s&&s.type!==be.LOADING&&B==null&&t.jsx(oa,{disabled:ke,textdocVersion:s,clientThreadId:e}),he&&t.jsx(k.Item,{icon:fa,disabled:Ye,onClick:Xe,label:j.formatMessage({id:"CRHbjv",defaultMessage:"Send to Slack"})})]})]})})]}),pe&&t.jsx(wo,{clientThreadId:e,isCodePreviewable:oe,isDisabled:!O||o.isTextdocStreaming&&!E,disabledTooltip:O?void 0:j.formatMessage({id:"NTZRWe",defaultMessage:"Code execution for canvas is disabled for your workspace. Contact your admin to enable."}),onClick:T,isCodeRunning:E}),!r&&!P&&t.jsx(Lo,{clientThreadId:e})]})]})};function xa(e){const n=/\[([^\]]+)\]\((https?:\/\/[^\s)]+|www\.[^\s)]+)\)/gi,s=new Set,o=e.matchAll(n);for(const i of o){const r=i[2];try{let a=r;a.startsWith("www.")&&(a="http://"+r),new URL(a),s.add(r)}catch(a){}}return s}const va=async({lastVersion:e,textdocId:n,content:s,comments:o})=>{const i=Tn(o,s);return(await te.safePost("/textdoc/{textdoc_id}",{parameters:{path:{textdoc_id:n}},requestBody:{version:e,content:s,comments:i}})).version},ya=()=>{const e=m.useRef([]),n=m.useRef(null),{mutateAsync:s,isPending:o}=ge({mutationKey:["canvas","textdoc","persist"],mutationFn:va});return[m.useCallback(async(r,a,l)=>{const h=new AbortController,u=(async()=>{var A,T;const[S]=e.current;try{await(S==null?void 0:S.promise)}catch(g){M.logError("Saving document",g)}if(!h.signal.aborted)try{const g=Math.max((A=n.current)!=null?A:0,(T=r.versionInt)!=null?T:gs);let x="";try{is(a)?x=a():x=a}catch(d){M.logError("Serializing document",d)}let _=[];try{is(l)?_=l():_=l}catch(d){M.logError("Adjusting comments",d)}const{textdocId:E}=r;Sn({textdocId:E,basedOnVersionInt:g,content:x,comments:_});const R=await s({textdocId:E,lastVersion:g,content:x,comments:_});En({textdocId:E,basedOnVersionInt:g,newVersion:R}),n.current=R}catch(g){M.logError("Error saving document",g)}finally{e.current.shift()}})(),v={abort:()=>h.abort(),promise:u},[b,f]=e.current;return f&&(f.abort(),e.current=b?[b]:[]),e.current=b?[b,v]:[v],u},[s]),e,o]},_a=3e3,ba=e=>{const[n,s,o]=ya(),i=se(),r=m.useRef(null),a=m.useCallback(ao(async(c,u,v)=>{if(!mt(c))return n(c,u,v);qe.replaceTempTextdocContent(c.textdocId,typeof u=="string"?u:u())},_a,{leading:!1}),[n]),l=wn(e);return m.useEffect(()=>{if(!l)return;const c=ns(window,{pagehide:()=>a.flush(),beforeunload:v=>{a.flush(),v.returnValue=i.formatMessage({id:"QZrKwi",defaultMessage:"You have a canvas save in progress."})}}),u=ns(document,{visibilitychange:()=>a.flush(),keydown:()=>{r.current="keyboard"},mousemove:()=>{r.current!=="mouse"&&a.flush(),r.current="mouse"}});return()=>{r.current=null,u(),c()}},[i,l,a]),m.useEffect(()=>()=>{a.flush()},[e,a]),An(async()=>{var c,u;await a.flush(),await Promise.allSettled((u=(c=s.current)==null?void 0:c.map(({promise:v})=>v))!=null?u:[])}),[m.useCallback((c,u,v)=>{const{textdocId:b}=c;return mt(c)||In(b),a(c,u,v)},[a]),a.flush,o||l]};function Ta(e,n,s){const o=Ge(),i=s!=null&&n!=null,{data:r,error:a,fetchNextPage:l,hasNextPage:h,isFetching:c}=Js(ds(e,n,i)),u=m.useCallback(async()=>{const A=n!=null;await o.prefetchInfiniteQuery(ds(e,n,A))},[o,e,n]);m.useEffect(()=>{const A=n;return()=>{o.removeQueries({queryKey:Ts(e,A),exact:!0})}},[o,e,n]);const[v,b,f,S]=m.useMemo(()=>{var T;if(r&&s){const g=r.pages.flatMap(_=>_),x=g.findIndex(_=>{var E;return"beforeVersion"in s?((E=_.versionInt)!=null?E:gs)<s.beforeVersion:_.versionInt===s.version});if(x!==-1)return[x===g.length-1,g[x],x>0?g[x-1]:null,x<g.length-1?g[x+1]:null]}const A=(T=r==null?void 0:r.pages.flatMap(g=>g))!=null?T:[];return[!0,null,null,A.length===0?null:A[0]]},[r,s]);return m.useEffect(()=>{!c&&i&&h&&v&&l()},[c,i,h,v,l]),m.useEffect(()=>{!b&&a&&Te(e)},[b,a,e]),{historicalTextdocVersion:b,nextHistoricalTextdocVersion:f,prefetchHistoricalTextdocVersion:u,previousHistoricalTextdocVersion:S}}function Ts(e,n=null){return["textdocHistory",e,n]}function ds(e,n,s=!0){return{queryKey:Ts(e,n),queryFn:({pageParam:o})=>Sa(e,o),initialPageParam:n!=null?n:void 0,getNextPageParam:o=>{var r;const i=(r=ro(o))==null?void 0:r.versionInt;if(i&&i>1)return i},enabled:s,staleTime:1/0,retry:2}}async function Sa(e,n){return n===void 0||n<=1?[]:(await te.safeGet("/textdoc/{textdoc_id}/history",{parameters:{path:{textdoc_id:e},query:{before_version:n}}})).previous_doc_states.map(({id:o,version:i,textdoc_type:r,title:a,content:l,updated_at:h,comments:c,metadata:u})=>({textdocId:o,versionInt:i,messageId:null,title:a,type:jn(r),content:l,status:fs.COMPLETE,createdAt:io(h),comments:kn(c,l),metadata:{content_references:u==null?void 0:u.content_references,hive_id:u==null?void 0:u.hive_id}}))}const Wa=({isFullScreen:e=!1,isEmbedded:n=!1,hideHeader:s=!1,hideRunCode:o=!1,isReadonlyFromQueryParam:i=!1,hideRenameButton:r=!1,clientThreadId:a,focusedTextdoc:l,onClose:h,isAnimating:c=!1,width:u,hideBottomComposer:v=!1})=>{"use no forget";var Bt,Ht,Ft,Ut;const b=Ze(),{textdocId:f,history:S,showChangesAtVersion:A=null,shouldRunCodeOnOpen:T=!1}=Zo(l),g=se(),[x,_,E]=ba(f),{targetedContent:R}=Rn(),d=Pn(b),[w,I]=m.useState(!1),[j,P]=m.useState(!1),B=Dn(f),Z=Mn(),oe=ft(a,ps.getRequestId),H=co(oe),{data:O,isLoading:ae}=ms(ct(f,A)),[q,he]=m.useState(!1),[Ae,Ye]=m.useState(null),Xe=Nn(a),pe=m.useRef(null),F=(Bt=B==null?void 0:B.versions)!=null?Bt:[],ne=(Ht=F[0])==null?void 0:Ht.versionInt,{historicalTextdocVersion:le,nextHistoricalTextdocVersion:Ce,previousHistoricalTextdocVersion:xe,prefetchHistoricalTextdocVersion:Ie}=Ta(f,ne,S),ke=Ge();m.useEffect(()=>{Ke.reset()},[f]);const ve=F.length>0?F[F.length-1]:null,Y=F.length>1?F[F.length-2]:null,je=xs(a),{restoreHistoricalTextdocVersion:Ss,optimisticRestoredTextdocVersion:Es}=On(je,ve,le),ue=S!=null,p=ue?le:ve,X=A!=null,ye=Vs(a,p),Re=c?null:O,Pe=(()=>{if(c||p==null)return[];const C=os(p.comments);return!X&&le!=null?le.comments:!X||O==null?C:O.contentBefore!==O.contentAfter?[]:Wo(O.commentsBefore,O.commentsAfter)})(),N=(Ft=p==null?void 0:p.type)!=null?Ft:be.LOADING,gt=Co({textdocVersion:p,clientThreadId:a}),ws=m.useCallback(()=>{var y,D;const C=(D=(y=window.getSelection())==null?void 0:y.toString())!=null?D:"";gt({source:"keyboard",selectedText:C,productLogOnly:!0})},[gt]),$e=Ln(),ht=mt(p),re=Bn(p),Je=Hn(p),pt=Fn(p),As=pt&&!n,Is=Qt(Z),ks=Qt(H);m.useEffect(()=>{!ht&&F.length===0&&$e!==Wt.NATIVE&&(!Z&&Is.current||!H&&ks.current||!Z&&!H)&&(h==null||h())},[F.length,Z,H]);const{content:L,currentlyStreamingLineIndex:De}=(O==null?void 0:O.contentBefore)!=null&&!Zt(N)?{content:O.contentBefore,currentlyStreamingLineIndex:null}:xo(p,Y),js=Un(je,Array.from(xa(L))),[Me,Ve]=Fo({value:L,isRequestActive:H,isTextdocStreaming:re,comments:Pe}),Ct=qn(p),xt=$e===Wt.LAST_TURN||Me||E;m.useEffect(()=>{zn().sendMessage({type:_s.Streaming,streaming:xt})},[xt]);const Rs=({getSerializedDocument:C,getAdjustedComments:y})=>{p&&x(p,C,y)},Ps=C=>{var D;if(!p)return;const y=C.doc.toString();x(p,y,(D=C.field(bo,!1))!=null?D:[])},vt=(C,y,D,J,de)=>{Ve(!0),ye({sourceEvent:C,action:D,content:y,userMessageType:He.ASK_CHATGPT,sourceRange:J,selectionMetadata:{selection_type:de,selection_position_range:J}})},yt=({id:C})=>{Ct(C,$t.DISMISS),Ke.reset()},_t=async(C,y)=>{Ve(!0);const{id:D,at:J,content:de}=y;if(await Ct(D,$t.ACCEPT)===!1)return Ve(!1);ye({sourceEvent:C,content:de,userMessageType:He.ACCEPT_COMMENT,sourceRange:J,action:rs.EDIT,selectionMetadata:{selection_type:as.SELECTION,selection_position_range:J}})},et=(C,y,D,J)=>{const{action:de}=J;ye({sourceEvent:C,action:de,content:D,sourceRange:y,userMessageType:He.ACCELERATOR,acceleratorMetadata:{action:de,id:J.id,prompt:D},selectionMetadata:y!=null?{selection_type:as.SELECTION,selection_position_range:y}:void 0})},Ds=(C,y)=>{ye({sourceEvent:C,action:rs.EDIT,content:y,userMessageType:He.FULL_SCREEN_SUBMIT})},tt=Kn(),bt=C=>{var y;return(y=tt==null?void 0:tt[C])!=null?y:C},st=()=>Gn(a,void 0,{clientInitiated:!0,reason:"textdoc_canvas_cancel"}),Ms=()=>{S?Fe(f,S):Te(f)},z=Ao({streamingSource:$e,isRestoring:Es!=null,isRequestActive:H,isTextdocStreaming:re,isReadonlyFromQueryParam:i,isHistoricalVersion:ue,isShowingChanges:X});let Ne=null;const Tt=c||z.isReadonly||Me,Oe=hs()||Xe||i||ht,St=()=>c&&Pe.length>0?me.ALL_HIDDEN:Oe?me.COMMENTS_READONLY:z.isReadonly?z.isStreaming?me.ENABLED:z.isReadonlyFromQueryParam||z.isShowingChanges||z.isHistoricalVersion?me.COMMENTS_READONLY:me.ALL_HIDDEN:me.ENABLED,Ns=m.useCallback(async C=>{const{suggestion:y}=await te.safePost("/textdoc/{textdoc_id}/autocomplete",{parameters:{path:{textdoc_id:f}},requestBody:{content:C}});return y},[f]),Et=e||c||i;let nt=[];switch(N){case be.LOADING:Ne=t.jsx(_o,{});break;case be.DOCUMENT:Ne=t.jsx(yo,{value:L,comments:Pe,previousValue:Y==null?void 0:Y.content,getAutocompleteSuggestion:Ns,previousComments:os(Y==null?void 0:Y.comments),isRewriting:Je,isAnimatingFromPreview:c,isSendDisabled:Oe,getStableCommentId:bt,diff:Re,isRequestActive:H,isDisabled:z.isReadonly||Z,isWaitingForCommentResponse:Me,hideAccelerators:Et,hideToolbar:Tt,hideEditOverlay:c,commentsMode:St(),readonlyReason:z,onBlur:_,onSave:_,onChange:Rs,onCancelRequest:st,targetedContent:R,onAddComment:vt,onAcceptComment:_t,onDismissComment:yt,onSubmitAccelerator:et,onExitShowChanges:Ms,safeUrls:js,width:u,modelCursor:pt||re&&!Je?p==null?void 0:p.modelCursor:void 0,shouldResetSelection:(p==null?void 0:p.versionInt)===1,metadata:B==null?void 0:B.metadata}),nt=jo;break;default:Zt(N)&&(Ne=t.jsx(vo,{id:"codemirror",getStableCommentId:bt,language:Io(N),value:L,comments:Pe,hideAccelerators:Et,commentsMode:St(),hideToolbar:Tt,onSubmitAccelerator:et,currentlyStreamingLineIndex:De!=null?De:null,readonlyReason:z,isRequestActive:H,isSendDisabled:Oe,isWaitingForCommentResponse:Me,onChange:Ps,onCancelRequest:st,onAddComment:vt,onBlur:_,onSave:_,codemirrorRef:pe,onDismissComment:yt,onAcceptComment:_t,textdocDiff:Re!=null?Re:void 0,modelCursor:re&&De==null?p==null?void 0:p.modelCursor:void 0}),nt=To)}const _e=m.useRef(null),ot=m.useRef(null),{hasCanvasCodeExecution:at,isCodeExecutable:wt,isCodePreviewable:$}=bs(p),At=at&&$,It=at&&wt,Os=Qn(),kt=m.useCallback(()=>{var C,y;!q&&(At||It)?(he(!0),(C=_e.current)==null||C.runCode(N,L)):((y=_e.current)==null||y.stopCode(),he(!1))},[At,It,q,L,N]),jt=Wn(()=>{kt()});m.useEffect(()=>{T&&jt()},[T,jt]);const K=p==null?void 0:p.versionInt,Ls=K!=null&&K>1,Bs=ue,Le=xe==null?void 0:xe.versionInt,rt=Ce==null?void 0:Ce.versionInt,Hs=()=>{X?S?Fe(f,S):Te(f):(M.logButtonClick(U.SHOW_CHANGES,{textdocType:N,textdocId:f,versionInt:K,latestVersionInt:ne}),K&&Jt(f,K,S))},Fs=()=>{M.logButtonClick(U.HISTORY_PREVIOUS,{textdocType:N,textdocId:f,versionInt:K,latestVersionInt:ne,isShowingChanges:X}),f&&K&&Ls&&Fe(f,{beforeVersion:K},X&&Le!=null?Le:void 0)},Us=()=>{M.logButtonClick(U.HISTORY_NEXT,{textdocType:N,textdocId:f,versionInt:K,latestVersionInt:ne,isShowingChanges:X}),Bs&&(rt?Fe(f,{version:rt},X?rt:void 0):X&&ne?Jt(f,ne,null):Te(f))},qs=ys(b,"1804926979"),Rt=ft(a,Bo(f)),zs=lo(),Pt=Qe(p==null?void 0:p.textdocId),Ks=!s&&t.jsx(Ca,{hideRunCode:o,clientThreadId:a,isHistoricalVersion:ue,textdocVersion:p,readonlyReason:z,hasDebug:d,isEmbedded:n,isPersisting:E,isShowingChanges:X,isConsoleOpen:j,isDebugVisible:w,hideHistoryActions:i,hideRenameButton:r,onHoverPrevious:()=>{Ie(),Le&&ke.prefetchQuery(ct(f,Le))},onHoverShowChanges:()=>{Ie(),K&&ke.prefetchQuery(ct(f,K))},onToggleShowChanges:Hs,onClickPrevious:Fs,onClickNext:Us,toggleDebugView:()=>I(C=>!C),toggleConsoleVisibility:()=>{j||fo.logEvent("Canvas Open Console Clicked"),P(C=>!C)},onClose:()=>{if(M.logButtonClick(U.CLOSE_TEXTDOC,{textdocType:p==null?void 0:p.type}),Pt&&!e){const{create_source:C,hasUserEdits:y,tempTextdocId:D}=Pt;if(y&&C!==Xt.USER_CREATED_COMPOSER){Nt(!0);return}if(qe.removeTempTextdoc(D),C===Xt.USER_CREATED_COMPOSER){const J=uo(zs);mo(J,L)}}h==null||h()},onClickCodePreview:kt,isCodeRunning:q,isTextdocStreaming:re,isTextdocAttachedPending:Yt(p)});let Dt=null;const Be=!o&&at&&(wt||$),it=ko(N,L);m.useEffect(()=>{var C;Be&&it&&((C=ot.current)==null||C.prepareEnvironment(L,it))},[Be,it]),m.useEffect(()=>{var C;$&&q&&!re&&((C=_e.current)==null||C.runCode(N,L))},[$,re,L,N]);const Mt=(Ut=p==null?void 0:p.title)!=null?Ut:"";Be&&(Dt=t.jsx(en,{id:f,title:Mt,onChangeBackgroundColor:Ye,onCodeRunComplete:()=>he(!1),visuallyHidden:!$||!q,disableNetworkRequests:!Os,networkAccessDeniedMessage:g.formatMessage({id:"GE4AJf",defaultMessage:"Network requests in canvas are disabled for your workspace. Contact your admin to enable this feature."}),enableTransition:$&&N!==be.CODE_HTML,isCodeUpdating:re,ref:ot,onRetryCodeRun:()=>{var C;return(C=_e.current)==null?void 0:C.runCode(N,L)}}));const[Gs,Nt]=m.useState(!1),Ot=t.jsx(Ho,{isOpen:Gs,dismissModal:()=>Nt(!1),closeTextdocEditor:()=>{h==null||h()},textdocVersion:p,clientThreadId:a}),Lt=t.jsxs(t.Fragment,{children:[Ks,t.jsx(ce.Content,{scrollToBottomMode:As?"bottom":"top",shouldScrollToTop:Je,isLoading:ae,hideChildren:$&&q,overlay:Dt,onCopy:ws,children:Ne}),Be&&t.jsx(tn,{ref:_e,sandboxRef:ot,textdocId:f,textdocTitle:Mt,textdocContent:L,isTextdocAttachedPending:Yt(p),highlightLine:C=>{var y;return(y=pe.current)==null?void 0:y.highlightLine(C)},isRequestActive:H,createTextdocTurn:ye,isOpen:j,onOpenChange:P}),t.jsx(We,{children:ue&&!i&&t.jsx(Uo,{onClickRestore:Ss,onClickResetLatest:()=>Te(f)})}),e&&!ue&&!v&&!(q&&$)&&!Oe&&t.jsx(Qo,{isRequestActive:H,clientThreadId:a,onSubmitAccelerator:et,onSubmit:Ds,onCancel:st,readonlyReason:z,acceleratorActions:nt})]});if(qs&&Rt&&p){const y=new URLSearchParams(window.location.search).get(sn),D=y==null?void 0:parseInt(y);return t.jsxs(t.Fragment,{children:[Ot,t.jsx(ce,{previewBackgroundColor:Ae,isPreviewingCode:$&&q,children:t.jsxs("div",{className:"flex h-full",children:[t.jsx("div",{className:"relative flex h-full min-h-0 flex-auto grow flex-col",children:Lt}),t.jsx(nn,{hiveId:Rt,clientThreadId:a,textdocVersion:p,ts:D})]})})]})}return t.jsxs(t.Fragment,{children:[Ot,t.jsx(ce,{previewBackgroundColor:Ae,isPreviewingCode:$&&q,children:Lt})]})};export{_s as C,Wa as T};
//# sourceMappingURL=dktrrnr6sah4uda0.js.map
