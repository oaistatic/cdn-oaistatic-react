var F=Object.defineProperty,q=Object.defineProperties;var $=Object.getOwnPropertyDescriptors;var b=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var A=(r,e,t)=>e in r?F(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,n=(r,e)=>{for(var t in e||(e={}))j.call(e,t)&&A(r,t,e[t]);if(b)for(var t of b(e))B.call(e,t)&&A(r,t,e[t]);return r},L=(r,e)=>q(r,$(e));import{u as G,I as J,n_ as k,lh as P,dM as D,dN as x,d7 as K,n$ as z,o0 as Q}from"./ncw8zw682jinppua.js";import{d as V,r as g,J as R}from"./bubexfvksfr7893o.js";const X=new Set(["google-oauth2","windowslive","apple"]),Y="password";function p(){var e;return typeof window<"u"&&!!((e=window.location)!=null&&e.origin)?window.location.origin:window.location.origin}const Z=240;function M(r,e){return e!=null&&e.idp&&X.has(e.idp)?n({connection:e.idp},e.email&&{login_hint:e.email}):(e==null?void 0:e.idp)==="auth0"?n({connection:Y},e.email?{login_hint:e.email}:{[Q]:"true"}):e!=null&&e.email?n({},e.email&&{login_hint:e.email}):{}}function _(r){if(!r)throw new Error("No session found, cannot enable MFA");if(r.authProvider==="mocked")throw new Error("Mock users can't enable MFA! Please setup Auth0 following the instructions in the README")}function v(r){try{return K(r)}catch(e){throw new Error("Unable to decode access token")}}function tt(r){return r.pwd_auth_time}function I(r){const e=tt(r);if(!e)return!0;const t=e/1e3;return Date.now()/1e3-t>Z}function O(r){var e;return((e=r[z])==null?void 0:e.required)==="yes"}var et=(r=>(r.PushAuth="push_auth",r.Totp="totp",r.Sms="sms",r))(et||{}),rt=(r=>(r.Enable="enable",r.Disable="disable",r))(rt||{});function y(){const r=p(),e=new URL("/",r),t=D(x.Security).hash;return e.hash=t||"settings",e}function w(r){const e=y(),t=new URLSearchParams;return t.set("action","enable"),t.set("factor",r),e.search=t.toString(),e.toString()}function at(r){const e=y(),t=new URLSearchParams;return t.set("action","disable"),t.set("factor_id",r),e.search=t.toString(),e.toString()}function st(r){var U,S;const e=G(),{session:t}=J(e),m=V(),[T,i]=g.useState(!1),N=((U=t==null?void 0:t.user)==null?void 0:U.idp)==="auth0",C=!!((S=t==null?void 0:t.user)!=null&&S.mfa),o=g.useCallback(async(a,c=!1)=>{_(t);let u=!0;if(t!=null&&t.accessToken){const l=v(t.accessToken);u=I(l)||c&&!O(l)}return u?(i(!0),R.signIn(t==null?void 0:t.authProvider,{callbackUrl:a},n(n({max_age:"0"},k(P())),M(e,t==null?void 0:t.user))),!0):!1},[e,t]),H=g.useCallback(async(a="totp",c)=>{_(t),i(!0);const u=p();if(a==="totp"){if(!(c!=null&&c.native_modal)){const f=new URL("/auth/enroll_mfa",u);f.searchParams.set("factor",a),r.redirectUrl&&f.searchParams.set("redirect_path",r.redirectUrl);const E=f.toString();return await o(E)?!0:(window.location.href=E,i(!1),!1)}const s=w("totp");return await o(s)?!0:(i(!1),!1)}if(a==="passkey"){const s=new URL("/auth/enroll_mfa",u);s.searchParams.set("factor",a),r.redirectUrl&&s.searchParams.set("redirect_path",r.redirectUrl);const h=s.toString();return await o(h)?!0:(window.location.href=h,i(!1),!1)}if(a==="push_auth"){const s=w("push_auth");return await o(s)?!0:(i(!1),!1)}const l=w("sms");return await o(l)?!0:(i(!1),!1)},[t,r.redirectUrl,o]),W=g.useCallback(async(a="totp",c="")=>{if(_(t),a==="push_auth"||a==="sms"||a==="totp"){if(!c)throw new Error("Factor ID is required for MFA factor removal");const d=at(c);return await o(d,!0)?!0:(i(!1),!1)}const u=new URL("/auth/disable_mfa",p()).toString();let l=!0;if(t!=null&&t.accessToken){const d=v(t.accessToken);l=I(d)||!O(d)}return l?(R.signIn(t==null?void 0:t.authProvider,{callbackUrl:u},n(n({max_age:"0"},M(e,t==null?void 0:t.user)),k(P()))),!0):(m(L(n({},D(x.Security)),{pathname:"/",search:"disable_mfa=true"})),!1)},[e,t,m,o]);return{setupMfa:H,isUsernamePassword:N,isLoggedInWithMfa:C,removeMfa:W,isLoadingRedirect:T}}export{rt as M,et as a,st as u};
//# sourceMappingURL=n8w61inav9kre7iu.js.map
