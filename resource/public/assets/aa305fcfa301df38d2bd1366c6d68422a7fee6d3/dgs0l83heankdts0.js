var I=Object.defineProperty,S=Object.defineProperties;var D=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var w=(e,t,n)=>t in e?I(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,C=(e,t)=>{for(var n in t||(t={}))L.call(t,n)&&w(e,n,t[n]);if(j)for(var n of j(t))R.call(t,n)&&w(e,n,t[n]);return e},T=(e,t)=>S(e,D(t));import{h as y,j as r,e as U,b as A,r as h,q}from"./bubexfvksfr7893o.js";import{hD as P,u as J,N as $,hq as m,eZ as H,hp as K,q3 as Q,aw as f,D as p,ay as X,bb as V,dQ as N,cz as g}from"./ncw8zw682jinppua.js";import{g9 as W,ga as z}from"./lm3g1zm00rp6al39.js";function v({jupyterMessage:e}){const t=y(),{width:n,height:a}=e;if(e.image_payload!=null)return r.jsx("img",{className:"my-1 max-h-full max-w-full object-contain",src:"data:image/png;base64,".concat(e.image_payload),alt:t.formatMessage(k.altText),width:n,height:a});if(e.image_url!=null){const o=P(e.image_url);return r.jsx(B,{fileId:o,width:n,height:a})}return null}const G=30*1e3,O=100,_=1.5,Z=Math.log(1-G*(1-_)/O)/Math.log(_);function Y(e,t){return q({queryKey:["getFileDownloadLink",e],queryFn:()=>K(e,void 0,t),staleTime:H,refetchInterval:n=>{var u;const a=n.state.dataUpdateCount;return((u=n.state.data)==null?void 0:u.status)===m.Success||a>Z||n.state.status===m.Error?!1:Math.pow(_,a)*O}})}function B({fileId:e,width:t,height:n}){const a=y(),o=J(),u=!$(o),{data:s,isLoading:c,refetch:i}=A(Y(e,u));return h.useEffect(()=>{if((s==null?void 0:s.status)===m.Success){const l=new URL(s.download_url,location.toString()).searchParams.get("se");l!=null&&!c&&new Date>new Date(l)&&i()}},[s,c,i]),(s==null?void 0:s.status)!==m.Success?null:r.jsx("img",{src:s.download_url,className:"my-1 max-h-64 max-w-full object-contain sm:max-h-80",alt:a.formatMessage(k.altText),width:t,height:n})}const k=U({altText:{id:"CodeExecutionOutputImage.altText",defaultMessage:"Output image"}});function ue({FormattedText:e,message:t,codeRendererClassName:n,forceDarkMode:a,removeTopBorderRadius:o,showActionBar:u,codeContainerClassName:s}){const c=N()||a,i=ee(t),d=h.useCallback(x=>r.jsx(W,T(C({},x),{wrapperClassName:n,codeContainerClassName:s,removeTopBorderRadius:o,showActionBar:u})),[n,s,o,u]),l=h.useMemo(()=>({code:d}),[d]);return i==null?null:r.jsx(z.Provider,{value:{isWithinDataAnalysisToolMessage:!0},children:r.jsx(e,{className:g("markdown prose dark:prose-invert w-full break-words",c?"dark":"light"),forceDarkMode:a,componentOverrides:l,children:i})})}function ee(e){var n,a,o,u,s,c,i,d;function t(l,x){return"```".concat(x,"\n").concat(l,"\n```")}if(e.author.name==="python"&&e.content.content_type===f.ExecutionOutput)return(a=(n=e.metadata)==null?void 0:n.aggregate_result)!=null&&a.code?t((u=(o=e.metadata)==null?void 0:o.aggregate_result)==null?void 0:u.code,"python"):null;if(e.author.name==="container.exec"&&e.author.role===X.Tool)return(c=(s=e.metadata)==null?void 0:s.container_citation)!=null&&c.source_cmd?t((d=(i=e.metadata)==null?void 0:i.container_citation)==null?void 0:d.source_cmd,"bash"):null;if(e.content.content_type==="code")return t(e.content.text,"python");if(e.recipient==="python"){if(e.content.content_type!=="text")return p.addError("Unexpected content type for code message"),null;const l=e.content.parts;return l.length!==1||typeof l[0]!="string"?(p.addError("Unexpected parts for code message"),null):t(l[0],"python")}return V(3179801956,e.author.name)&&e.content.content_type===f.ExecutionOutput?t(e.content.text,"python"):(p.addAction("Unexpected code message format"),null)}function le({message:e,showLabel:t=!0,wrapperClassName:n,codeContainerClassName:a,forceDarkMode:o}){var x;const u=y();if(e.content.content_type!==f.ExecutionOutput)return null;const s=(x=e.metadata)==null?void 0:x.aggregate_result;if(!s)return p.addError("Corrupt code execution result message"),null;const c=s.messages.filter(ne),i=c.length>0,d=s.final_expression_output!=null,l=s.in_kernel_exception!=null;return r.jsxs(r.Fragment,{children:[i&&r.jsx(M,{forceDarkMode:o,label:t?"STDOUT/STDERR":null,wrapperClassName:n,output:c.map((b,F)=>r.jsx("span",{className:b.stream_name==="stderr"?"text-red-500":"",children:b.text},"".concat(F)))}),d&&r.jsx(M,{forceDarkMode:o,wrapperClassName:n,codeContainerClassName:a,label:t?u.formatMessage({id:"codeInterpreterMessage.resultLabel",defaultMessage:"Result"}):null,output:s.final_expression_output}),l&&r.jsx(te,{traceback:s.in_kernel_exception.traceback.join("")})]})}function M({wrapperClassName:e,label:t,output:n,codeContainerClassName:a,forceDarkMode:o}){const u=N()||o;return r.jsxs("div",{className:g("bg-token-sidebar-surface-primary p-4 text-xs","overflow-x-auto",e),children:[t&&r.jsx("div",{className:"mb-1 text-gray-400",children:t}),r.jsx("div",{className:g("prose flex flex-col-reverse",u?"text-white":"text-black"),children:r.jsx("pre",{className:g("shrink-0 overflow-auto",a),children:n})})]})}function te({traceback:e}){return r.jsx("div",{className:"overflow-auto border-t border-gray-500 bg-black text-white",children:r.jsx("div",{className:"border-s-4 border-red-500 p-2 text-xs",children:r.jsx("div",{className:"scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-700 flex max-h-64 flex-col-reverse",children:r.jsx("pre",{className:"shrink-0",children:e})})})})}function ce({message:e,isCoT:t=!1}){var a;if(e.content.content_type!==f.ExecutionOutput)return null;const n=(a=e.metadata)==null?void 0:a.aggregate_result;return n?t?n.messages.filter(E).map((o,u)=>r.jsx(v,{jupyterMessage:o},u)):r.jsx("div",{className:"flex flex-wrap gap-2",children:n.messages.filter(E).map((o,u)=>r.jsx("div",{className:"max-h-64 items-start justify-start sm:max-h-80",children:r.jsx(v,{jupyterMessage:o})},u))}):(p.addError("Corrupt code execution result message"),null)}function ne(e){return e.message_type==="stream"}function E(e){return e.message_type==="image"||"image_url"in e&&Q(e.image_url+"")}function ie(e){var t,n,a;return(a=(n=(t=e.metadata)==null?void 0:t.aggregate_result)==null?void 0:n.messages.some(E))!=null?a:!1}export{ce as C,ue as a,le as b,M as c,B as d,Y as e,v as f,ee as g,ie as h,E as i};
//# sourceMappingURL=dgs0l83heankdts0.js.map
