const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ncw8zw682jinppua.js","assets/bubexfvksfr7893o.js","assets/root-ookb7xuw.css","assets/d9d46aun6hvzsagm.js","assets/9paxni9f8n7suc5d.js","assets/lm3g1zm00rp6al39.js","assets/conversation-small-lq38g8zw.css"])))=>i.map(i=>d[i]);
var le=Object.defineProperty,ce=Object.defineProperties;var ue=Object.getOwnPropertyDescriptors;var H=Object.getOwnPropertySymbols;var me=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable;var B=(e,t,n)=>t in e?le(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,E=(e,t)=>{for(var n in t||(t={}))me.call(t,n)&&B(e,n,t[n]);if(H)for(var n of H(t))de.call(t,n)&&B(e,n,t[n]);return e},R=(e,t)=>ce(e,ue(t));import{r as m,h as fe,j as a,_ as M,w as he}from"./bubexfvksfr7893o.js";import{aF as z,u as K,eF as J,ct as X,d as V,jr as xe,ea as Z,m_ as ge,h$ as pe,aT as we,a as ve,dc as be,az as T,aB as G,aA as A,O as _e,fd as Q,gZ as U,_ as C,hK as Ie,cz as Y,V as D,gC as ye,dS as je,ch as ke,aN as Ee}from"./ncw8zw682jinppua.js";import{db as Re,de as Se,cw as F,lT as S,cs as Le,c6 as Ne,mw as Ce}from"./lm3g1zm00rp6al39.js";import{g as Me}from"./i8xmfgagd89lcp7k.js";import{g as Te,u as Ae,a as Pe,b as $}from"./izjhrefsvxrmr1ks.js";import{g as qe}from"./ckeauhcg4pu33xfw.js";const ee=m.createContext({imageList:[],activeIndex:null,isInFocusMode$:z(!1),isZoomed$:z(!1)}),P=()=>m.useContext(ee);function O(){for(var e,t=0,n="",s=arguments.length;t<s;t++)(e=arguments[t])&&typeof e=="string"&&(n+=(n&&" ")+e);return n}const ze="_lightbox_1ruyj_1",Oe={lightbox:ze},Ve=T(()=>M(()=>import("./ncw8zw682jinppua.js").then(e=>e.yq),__vite__mapDeps([0,1,2])),{loading:e=>A(e)}),De=T(()=>M(()=>import("./d9d46aun6hvzsagm.js"),__vite__mapDeps([3,1])),{loading:e=>A(e)}),Fe=T(()=>M(()=>import("./9paxni9f8n7suc5d.js"),__vite__mapDeps([4,1])),{loading:e=>A(e)});function We({imageList:e,forceDarkMode:t=!1,initialIndex:n,isInFocusMode$:s,onClose:i,onScrollToEnd:c,children:d}){var W;const x=K(),p=fe(),g=m.useRef(null),_=Re(x),[u,b]=m.useState(n),j=J(),I=X(),[r]=m.useState(()=>{var o,l;return z(((l=(o=window.visualViewport)==null?void 0:o.scale)!=null?l:1)!==1)}),h=V(()=>r());m.useEffect(()=>{_.signalTransitionReady()},[_]),m.useEffect(()=>{if(h)return xe(()=>{r()||requestAnimationFrame(()=>{var l,f;(f=(l=g.current)==null?void 0:l.querySelector('[data-position="'.concat(u,'"]')))==null||f.scrollIntoView({behavior:"smooth",inline:"center",block:"center"})})})},[h,u,r]),m.useEffect(()=>{var l;const o=()=>{var f,y;return r.set(((y=(f=window.visualViewport)==null?void 0:f.scale)!=null?y:1)!==1)};return(l=window.visualViewport)==null||l.addEventListener("resize",o),()=>{var f;return(f=window.visualViewport)==null?void 0:f.removeEventListener("resize",o)}},[r]),Z(()=>{var o,l;(l=(o=g.current)==null?void 0:o.querySelector('[data-position="'.concat(n,'"]')))==null||l.scrollIntoView({behavior:"instant",inline:"center",block:"center"})},[n]);const w=m.useCallback(o=>{b(o),requestAnimationFrame(()=>{var f;const l=(f=e[o])==null?void 0:f.title;l&&ge.setLiveRegionPolite(l)}),o===e.length-1&&(c==null||c())},[e,c]);Z(()=>{const o=g.current;if(!o)return;const l=new IntersectionObserver(f=>{const y=f.reduce((N,q)=>q.isIntersecting&&(!N||q.intersectionRatio>N.intersectionRatio)?q:N,null);y&&y.target instanceof HTMLElement&&w(pe(y.target.dataset.position))},{root:o,rootMargin:"0px -50% 0px -50%",threshold:0});for(const f of o.querySelectorAll(":scope > li"))l.observe(f);return()=>{l.disconnect()}},[e,w]);const v=e.length-1,k=m.useCallback(o=>{const l=Math.min(Math.max(u+o,0),v);w(l),requestAnimationFrame(()=>{var f,y;(y=(f=g.current)==null?void 0:f.querySelector('[data-position="'.concat(l,'"]')))==null||y.scrollIntoView({behavior:j?"instant":"smooth",block:"center",inline:"center"})})},[u,v,j,w]);m.useEffect(()=>{requestAnimationFrame(()=>{const o=document.querySelector("[data-lightbox-close-button]");o instanceof HTMLElement&&o.focus()})},[]),m.useEffect(()=>{const o=l=>{if(s!=null&&s()){l.key==="Escape"&&s.set(!1);return}l.key==="ArrowLeft"?u>0&&(l.preventDefault(),k(-1)):l.key==="ArrowRight"?u<v&&(l.preventDefault(),k(1)):l.key==="Escape"&&i(u)};return window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)}},[u,v,k,i,s]),m.useEffect(()=>{we(ve(),"chatgpt_web_image_library_lightbox_image_viewed")},[u]);const{footer:ae,items:oe,title:re,headerActions:ie}=qe(d,{title:te,items:ne,footer:se,headerActions:He});return a.jsx(ee.Provider,{value:{imageList:e,activeIndex:u,isInFocusMode$:s,isZoomed$:r},children:a.jsxs(be.Root,{testId:"modal-image-gen-lightbox",isOpen:!0,onClose:()=>i(u),shouldIgnoreClickOutside:I,className:O(I||t?"dark bg-black":"bg-token-bg-primary","flex h-dvh max-h-full w-dvw max-w-full flex-col place-content-center",Oe.lightbox),children:[a.jsxs("section",{className:"grid grid-cols-[auto_1fr_auto] items-start px-1 pt-1 [view-transition-name:var(--vt-page-title)] max-md:absolute max-md:start-0 max-md:end-0 max-md:top-0 max-md:items-center md:grid-cols-[1fr_auto_1fr] md:px-2 md:pt-2",children:[a.jsx("div",{className:"w-fit",children:a.jsx(Se,{icon:Ve,"data-lightbox-close-button":!0,onClick:()=>i(u),"aria-label":p.formatMessage({id:"f08aLO",defaultMessage:"Close"})})}),!h&&re,(W=!h&&ie)!=null?W:a.jsx("div",{className:"w-8 shrink-0 basis-auto"})]}),a.jsxs("div",{className:"no-scrollbar flex h-full snap-y snap-mandatory flex-col overflow-y-scroll scroll-smooth",onScroll:o=>{o.target.scrollTop===0&&!r()&&i(u)},children:[a.jsx("div",{className:"h-[15dvh] flex-shrink-0"}),a.jsxs("ol",{ref:g,className:O("flex max-h-full min-h-0 flex-shrink-0 grow basis-full gap-[min(10dvw,_200px)] overflow-x-auto scroll-smooth [anchor-name:--carousel] [view-transition-name:var(--vt-image-carousel)] max-md:gap-0",I&&"no-scrollbar",!h&&"snap-x snap-mandatory snap-center snap-always py-15"),onClick:o=>{(o.target instanceof HTMLOListElement||o.target instanceof HTMLLIElement)&&(o.preventDefault(),i(u))},children:[a.jsx("li",{className:"w-[50vw] flex-shrink-0"}),oe,a.jsx("li",{className:"w-[50vw] flex-shrink-0"})]}),a.jsx("div",{className:"h-[15dvh] flex-shrink-0"})]}),!h&&a.jsxs("div",{className:"pointer-events-none absolute inset-5 z-20 flex items-center justify-between [view-transition-name:var(--vt-scroll-buttons)] max-md:hidden",children:[a.jsx(G,{className:"pointer-events-auto aspect-square",disabled:u===0,color:"secondary",icon:Fe,onClick:()=>k(-1),"aria-label":p.formatMessage({id:"iQsFWe",defaultMessage:"Previous image"})}),a.jsx(G,{className:"pointer-events-auto aspect-square",color:"secondary",disabled:u===v,icon:De,onClick:()=>k(1),"aria-label":p.formatMessage({id:"W7vnD4",defaultMessage:"Next image"})})]}),!h&&ae]})})}function te({children:e}){const{imageList:t,activeIndex:n}=P();if(n==null)return null;const s=t[n];return s?e(s):null}function ne({children:e}){const{imageList:t,isZoomed$:n,activeIndex:s}=P(),i=X(),c=J(),d=V(()=>n==null?void 0:n());return t.map((x,p)=>{var I;const{width:g,height:_}=x,u=g!=null&&_!=null&&g===_;let b=null;s!=null&&(p===s?b="current":p+1===s?b="before":p-1===s&&(b="after"));const j=!i&&b!=="current";return a.jsx("li",{role:j?"button":void 0,className:O("flex max-h-full max-w-[70dvw] flex-shrink-0 snap-center items-center justify-center transition-opacity duration-0 motion-safe:duration-300 max-md:w-[100dvw] max-md:max-w-[100dvw] max-md:snap-always max-md:opacity-100",u&&"aspect-square",b==="current"||d?"opacity-100":"opacity-40"),"data-position":p,onClick:j?({currentTarget:r})=>r.scrollIntoView({behavior:c?"instant":"smooth",block:"center",inline:"center"}):void 0,children:e(R(E({},x),{index:p,position:b}))},(I=x.id)!=null?I:x.url)})}function se({children:e}){const{imageList:t,activeIndex:n}=P();if(n==null)return null;const s=t[n];return s?a.jsx("footer",{className:"absolute bottom-0 z-10 flex w-full items-center justify-center px-5 pb-3 [view-transition-name:var(--vt-page-footer)] max-md:pb-6",children:e(s)}):null}function He({children:e}){const t=[];return m.Children.forEach(e,n=>{m.isValidElement(n)&&n.type===Be&&t.push(n)}),a.jsx("div",{className:"flex items-center justify-end gap-2",children:t.map((n,s)=>a.jsx(m.Fragment,{children:n},s))})}function Be({children:e}){const{imageList:t,activeIndex:n}=P();return n==null||t[n]==null?null:e(t[n])}const Ze=T(()=>M(()=>import("./lm3g1zm00rp6al39.js").then(e=>e.zC),__vite__mapDeps([5,1,0,2,6])),{loading:e=>A(e)});function Ge(e,t,n=!1){const s=D.getTurnContentReferences(e,t),i=Ce(s),c=Qe(e,t),d=i.concat(c);if(n){const x=Ue(e,t);d.push(...x)}return ye(d,"content_url")}function Qe(e,t){const n=D.getConversationTurnAtIndex(e,t).messages;return n?ke(n.flatMap(s=>{var i,c;return(c=(i=s.metadata)==null?void 0:i.image_results)!=null?c:[]})).map(s=>R(E({},s),{thumbnail_url:s.thumbnail_url.replace(/^http:\/\//,"https://"),content_url:s.content_url.replace(/^http:\/\//,"https://")})):[]}function Ue(e,t){return D.getSuperWidgetMessages(e,t).flatMap(s=>s.content.widgets.images)}function $e(e,t,n,s){const{product:i}=Me({thread:e,messageId:t,contentReferenceStartIndex:n,productIndex:s});return!i||!i.image_urls?[]:i.image_urls.map(c=>({url:c,content_url:c,thumbnail_url:c,title:i.title,content_size:{width:0,height:0},thumbnail_size:{width:0,height:0}}))}function rt({clientThreadId:e}){const t=K(),n=V(()=>Ee(t)),s=F.useCurrentImage();if(!s)return null;const{image:i,source:c,analyticsMetadata:d,contentReferenceStartIndex:x,productIndex:p}=s;if(c==null||e==null||(d==null?void 0:d.turnIndex)==null)return a.jsx(L,{image:i,analyticsMetadata:{}});const g=_e(e),_=(function(){switch(c){case S.ProductDetails:return $e(g,d.messageId,x,p);case S.SuperWidget:case S.ImageGroup:return s.imageResults;default:return Ge(g,d.turnIndex,n)}})();return a.jsx(L,{image:i,group:_,analyticsMetadata:d})}function it(){const e=F.useCurrentImage();if(!e)return null;const{image:t,source:n}=e;if(n==null)return a.jsx(L,{image:t,analyticsMetadata:{}});switch(n){case S.ImagesTab:return a.jsx(Ke,{image:t});case S.Turn:return a.jsx(Je,{image:t});default:return null}}function Ke({image:e}){const{imageResults:t}=Pe();return a.jsx(L,{image:e,group:t,analyticsMetadata:{}})}function Je({image:e}){const{imageResults:t}=Ae();return a.jsx(L,{image:e,group:t,analyticsMetadata:{}})}function L({image:e,group:t,analyticsMetadata:n}){var j,I;const s=m.useRef(null),i=F.useStore();m.useEffect(()=>{var h,w;(w=(h=window==null?void 0:window.history)==null?void 0:h.state)!=null&&w.imageModalOpen||window.history.pushState({imageModalOpen:!0},"",window.location.href);const r=()=>{var v,k;(k=(v=window==null?void 0:window.history)==null?void 0:v.state)!=null&&k.imageModalOpen||i.setCurrentImage(void 0)};return window.addEventListener("popstate",r),()=>window.removeEventListener("popstate",r)},[i]);const c=e.content_url.replace(/^http:\/\//,"https://"),d=(j=t==null?void 0:t.findIndex(r=>Q(e,r)))!=null?j:0,x=(I=t==null?void 0:t.length)!=null?I:1,p=d!=null&&x>1,g=R(E({},U(n)),{url:e.url,link_type:"text",section:"image",section_location:"response",section_index:(d+1).toString()});m.useEffect(()=>{s.current!==e.url&&(s.current=e.url,C.logEventWithStatsig("Search Content Reference Shown","search_content_reference_shown",R(E({},U(n)),{type:"full_screen_image",url:e.url,image_url:c})),C.logEvent("link_action",R(E({},g),{action:"show"})))},[c]);const _=()=>{window.history.go(-1),i.setCurrentImage(void 0)},u=t!=null?t:[];he({queries:u.map(r=>Te(r.thumbnail_url,"ImageResultModal"))});const b=m.useMemo(()=>t!=null?t:[e],[t,e]);return a.jsxs(We,{forceDarkMode:!0,imageList:b,initialIndex:d,onClose:_,children:[p&&a.jsx(te,{children:r=>{var h;return a.jsxs("div",{className:"text-token-text-tertiary -mt-0.25 shrink-0 px-4 md:mt-0 md:py-2",children:[((h=t==null?void 0:t.findIndex(w=>Q(r,w)))!=null?h:0)+1," /"," ",x]})}}),a.jsx(ne,{children:r=>a.jsx(Xe,{image:r,isNewLightbox:!0})}),a.jsx(se,{children:r=>{var w,v;const h=(w=r.show_url)!=null?w:!0;return a.jsx("div",{className:"flex w-full justify-start",children:a.jsx("div",{className:"w-fit rounded-xl backdrop-blur-xl",children:a.jsx(Ie,{onClick:()=>{C.logEvent("link_action",R(E({},g),{action:"click"}))},onMouseEnter:()=>{C.logEvent("link_action",R(E({},g),{action:"hover"}))},href:r.is_proxied_image?r.content_url:r.url,className:Y("flex w-fit shrink-0 items-center gap-8 px-4 py-2 text-sm hover:opacity-70",h?"min-h-20":"min-h-16"),children:a.jsxs("div",{className:"flex grow flex-col gap-0.5 overflow-hidden pe-2",children:[h&&a.jsxs("div",{className:"text-token-text-tertiary flex items-center gap-2 truncate",children:[a.jsx(Ne,{url:r.content_url,className:"rounded-sm",size:16}),(v=r.attribution)!=null?v:Le(r.url)]}),a.jsx("div",{className:"truncate font-semibold text-white",children:r.title})]})})})})}})]})}function Xe({image:e,isNewLightbox:t=!1}){const n=e.content_url.replace(/^http:\/\//,"https://"),s=e.thumbnail_url.replace(/^http:\/\//,"https://"),i=e.content_size.width/e.content_size.height,{isError:c}=$(n,"ModalImage_main"),{isError:d}=$(s,"ModalImage_thumbnail"),x=e.is_proxied_image?e.url:c?s:n;return!d||!c||e.is_proxied_image?a.jsx(je.img,{src:x,alt:e.title,style:{backgroundImage:s?"url(".concat(s,")"):void 0,backgroundSize:"contain",aspectRatio:i,backgroundPosition:"center",backgroundRepeat:"no-repeat"},initial:{opacity:0},animate:{opacity:1},className:Y(t?"h-full max-w-full object-contain":"h-full max-w-[100vw] object-contain sm:max-w-[calc(100vw-10rem)]")}):a.jsx("div",{className:"flex h-full grow items-center justify-center",children:a.jsx("div",{className:"flex h-96 w-96 items-center justify-center bg-white/10",children:a.jsx(Ze,{className:"text-token-text-tertiary h-12 w-12"})})})}export{rt as ImageLightbox,it as ImageLightboxSearchGPT};
//# sourceMappingURL=hbhzncdz8wdw5ysr.js.map
