const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/fx4tif7av4x5mmpn.js","assets/bubexfvksfr7893o.js"])))=>i.map(i=>d[i]);
var ue=Object.defineProperty,de=Object.defineProperties;var pe=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var _e=Object.prototype.hasOwnProperty,fe=Object.prototype.propertyIsEnumerable;var ee=(e,t,n)=>t in e?ue(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,U=(e,t)=>{for(var n in t||(t={}))_e.call(t,n)&&ee(e,n,t[n]);if(D)for(var n of D(t))fe.call(t,n)&&ee(e,n,t[n]);return e},L=(e,t)=>de(e,pe(t));import{r as w,j as o,M as W,_ as me}from"./bubexfvksfr7893o.js";import{u as Y,M as xe,d as te,J as he,ay as Q,aw as V,d$ as ge,cz as C,_ as oe,az as ye,bp as ve,aA as be,V as se,bk as je,g as Se,ld as Fe}from"./ncw8zw682jinppua.js";import{cA as Ee,cB as ae,cC as Ie,cD as ke,cE as we,c2 as $,cF as K,cG as Me,cH as Te,cI as Ae,cJ as Ne,b$ as ne,cK as Re,cL as Oe,cM as X,cx as qe,c6 as Pe}from"./lm3g1zm00rp6al39.js";import{F as Ue}from"./gtcvhpyyxjlawokm.js";import{GlauxSearchQueryWithIcon as re,GlauxSearchQueryOverflow as Le}from"./fk5dn736y6oc9os0.js";import{A as le}from"./exx0m5g11hnp3j3d.js";import"./d9ec94om23qfz1v2.js";import"./luif5kl8klbqcpjy.js";const $e=ye(()=>me(()=>import("./fx4tif7av4x5mmpn.js"),__vite__mapDeps([0,1])),{loading:e=>be(e)});function H(e,t){const n=new RegExp("<\\s*".concat(t,"\\s*>([\\s\\S]*?)<\\s*/\\s*").concat(t,"\\s*>"),"i"),d=e.match(n);return d&&d[1]?d[1].trim():e}function Ce(e){if(e===void 0)return;const t="Content Snippet:",n=e.indexOf(t);return n===-1?e:e.substring(n+t.length).trim()}function Ge(e,t){var n,d,M,S,h;t.text=Ce(e.contents),(n=e.documentId)!=null&&n.includes("ks--slack")||(d=t.cloud_doc_url)!=null&&d.match(/^https:\/\/github\.com\/[^/]+\/[^/]+\/(issues|pull)\/\d+/)?(t.text=void 0,t.name="#".concat(t.name)):(M=t.cloud_doc_url)!=null&&M.startsWith("https://docs.google.com/spreadsheets/")&&t.text!==void 0?t.text=H(t.text,"sheet_summary"):(S=t.cloud_doc_url)!=null&&S.match(/^https:\/\/github\.com\/[^/]+\/[^/]+\/commit\//)&&t.text!==void 0?t.text=H(t.text,"git_summary"):(h=t.cloud_doc_url)!=null&&h.match(/^https:\/\/github\.com\/[^/]+\/[^/]+\/blob\//)&&t.text!==void 0&&(t.text=H(t.text,"code_summary")),t.text&&(t.text=t.text.slice(0,250))}function Ye({turnIndex:e,clientThreadId:t,variant:n="sidebar"}){const d=Y(),M=Ee(),S=ae(d)||M,h=Ie(d),T=ke(d),[O,i]=xe(t,u=>[se.getTurnContentReferences(u,e),se.getConversationTurnAtIndex(u,e).messages]),A=te(()=>je(Se(d,t))),F=we(A),q=te(()=>{if(F)return Fe(d,{skipLogos:!1})}),E=i.some(u=>{var p;return((p=u==null?void 0:u.metadata)==null?void 0:p.api_tool_type)==="glaux"}),P=E||he(d,"2137702454"),G=w.useMemo(()=>({turnIndex:e,clientThreadId:t}),[t,e]),z=w.useMemo(()=>{const u=[],p=new Set,_=new Map;if(T.forEach(s=>{_.set(s,[])}),O.forEach(s=>{var a,r,f,l,y,m,I,x,g,v;if(s.type==="file"&&!p.has(s.id)){const c=$((a=s.cloud_doc_url)!=null?a:""),b={id:s.id,name:(r=c==null?void 0:c.type)!=null?r:s.name,subtitle:c!=null&&c.type?s.name:void 0,cloud_doc_url:(l=s.cloud_doc_url)!=null?l:(f=s.extra)==null?void 0:f.cloud_doc_url,text:P?s.snippet:void 0,authors:(y=s.medical_file_reference)==null?void 0:y.authors_display,publication_year:(m=s.medical_file_reference)==null?void 0:m.publication_year,journal_name:(I=s.medical_file_reference)==null?void 0:I.journal_name,doi:(x=s.medical_file_reference)==null?void 0:x.doi,journal_homepage_url:(g=s.medical_file_reference)==null?void 0:g.journal_homepage_url};if(!!!b.cloud_doc_url&&!K(b.id))return;u.push(b),_.has(s.type)&&((v=_.get(s.type))==null||v.push(b)),p.add(s.id)}else s.type==="file_navlist"?s.items.forEach(c=>{var b,k,N;if(!p.has(c.id)){const R=$((b=c.cloud_doc_url)!=null?b:""),j={name:(k=R==null?void 0:R.type)!=null?k:c.name,subtitle:R!=null&&R.type?c.name:void 0,cloud_doc_url:c.cloud_doc_url,text:P?c.description:void 0,id:c.id,lastModifiedTime:c.last_modified_time};if(!!!j.cloud_doc_url&&!K(j.id))return;u.push(j),_.has(s.type)&&((N=_.get(s.type))==null||N.push(j)),p.add(c.id)}}):s.type==="grouped_webpages"&&h&&s.items.forEach(c=>{var b,k,N,R;if(!p.has(c.url)){const j=$((b=c.url)!=null?b:""),J={name:(k=j==null?void 0:j.type)!=null?k:c.title,subtitle:j!=null&&j.type?c.title:void 0,cloud_doc_url:c.url,text:P&&(N=c.snippet)!=null?N:void 0,journal_name:c.attribution,id:c.url};u.push(J),_.has(s.type)&&((R=_.get(s.type))==null||R.push(J)),p.add(c.url)}})}),T.length>0){const s=[];return T.forEach(a=>{var r;_.has(a)&&s.push(...(r=_.get(a))!=null?r:[])}),s}return u},[T,O,P,h]),Z=w.useMemo(()=>{var _,s;if(!F||n==="bottom")return[];const u=[],p=new Set;for(const a of i)if(a.author.role===Q.Tool&&a.author.name==="file_search"&&a.content.content_type===V.TetherBrowsingDisplay){const r=Me(a.content.result),f=(s=(_=a.metadata)==null?void 0:_.cloud_doc_urls)!=null?s:[];r.chunks.forEach((l,y)=>{var v,c;if(!l.documentId||p.has(l.documentId))return;let m;if(l.metadata.cloud_doc_url)m=l.metadata.cloud_doc_url.toString();else if(y<f.length)m=f[y];else if(l.documentId.endsWith("--google")){const b=l.documentId.split("--")[1];m="https://drive.google.com/file/d/".concat(b)}if(!m)return;p.add(l.documentId);const I=(v=l.metadata["File last modified at"])!=null?v:l.metadata["File created at"],x=$(m!=null?m:""),g={id:l.documentId,name:(c=x==null?void 0:x.type)!=null?c:l.title,subtitle:x!=null&&x.type?l.title:void 0,cloud_doc_url:m,text:l.contents,lastModifiedTime:I?I.toString():void 0};Ge(l,g),u.push(g)})}return u},[F,i,n]),B=w.useMemo(()=>{var p,_,s;if(n==="bottom"||!E)return[];const u=[];for(const a of i)if(a.author.role===Q.Tool&&a.author.name==="api_tool.call_tool"&&a.content.content_type===V.MultimodalText){const r=(p=a.metadata)==null?void 0:p.citation_metadata,f=r==null?void 0:r.id;if(!r||!f||!r.url)continue;const m=a.content.parts[1].toString().split("\n").flatMap(g=>{const v=Te.exec(g);return v?[v[1]]:[]}).flatMap(g=>{const v=Ae.exec(g);return v?/^\s*[^()]+?\s*\(\s*display_name:\s*([^;]+);\s*real_name:\s*([^;]+);\s*username:\s*[^)]+\)\s*:/i.exec(v[2])?[v[2].trim().replace(/^\s*[^()]+?\s*\(\s*display_name:\s*([^;]+);\s*real_name:\s*([^;]+);\s*username:\s*[^)]+\)\s*:/i,(b,k,N)=>"".concat((N==null?void 0:N.trim())||(k==null?void 0:k.trim()),":")).replace(/\r/g,"")]:[v[2].trim()]:[]}),{Icon:I,appName:x}=Ne({connectorId:r.__connector_id,cloud_doc_url:r.url,availableConnectors:q});u.push(o.jsx(ie,{clientThreadId:t,item:{id:f,name:x||r.title,subtitle:x?r.title:void 0,cloud_doc_url:r.url,text:m.slice(0,3).join("\n"),lastModifiedTime:r.last_modified_at,Icon:I}},"".concat(a.id,"-").concat(f)))}else if(a.author.role===Q.Assistant&&a.recipient==="api_tool.call_tool"&&a.content.content_type===V.Code&&a.content.language==="json"){let r={};try{if(r=JSON.parse(a.content.text),typeof r.args=="string")try{r.args=JSON.parse(r.args)}catch(l){continue}}catch(l){continue}if(!r.path)continue;const f=[];if(r.path==="mixer://search"&&typeof((_=r.args)==null?void 0:_.sources)=="object"){const l=r.args.sources;for(const y in l){const m=l[y],I=ne(y);if(I){const x=new Set;m.forEach(g=>{g.query&&!x.has(g.query)&&(f.push(L(U({},I),{query:g.query})),x.add(g.query))})}}}else if((s=r.args)!=null&&s.query){const l=ne(r.path);l&&f.push(L(U({},l),{query:r.args.query}))}if(!f.length)continue;u.push(o.jsx("div",{className:"flex flex-row flex-wrap items-center gap-2 px-3 py-2.5",children:f.length<=3?f.map((l,y)=>o.jsx(re,{query:l.query},a.id+y)):o.jsxs(o.Fragment,{children:[f.slice(0,3).map((l,y)=>o.jsx(re,{query:l.query},a.id+y)),o.jsx(Le,{maxResults:3,queries:f},a.id+"query-overflow")]})},a.id))}return u},[t,i,n,E,q]);return o.jsx(ge,{children:o.jsxs("div",{className:C("bg-token-main-surface-primary flex w-full flex-col",n==="sidebar"&&"mt-[calc(var(--threadFlyOut-leading-height,57px)*-1)]"),children:[o.jsx(ce,{title:o.jsx(W,{id:"dlVlo6",defaultMessage:"Citations"}),items:z,clientThreadId:t,sectionId:"citations",analyticsMetadata:G}),!S&&o.jsx(ce,{title:o.jsx(W,{id:"njZblE",defaultMessage:"Search Results"}),items:Z,clientThreadId:t,sectionId:"search-results",analyticsMetadata:G,unstructuredResults:B})]})})}function ce({title:e,items:t,scrollToHeader:n,shouldAnimateScroll:d,clientThreadId:M,analyticsMetadata:S,sectionId:h,unstructuredResults:T=[]}){const O=Y(),i=ve(O),A=w.useRef(null),F=w.useMemo(()=>S?L(U({},S),{sectionId:h,numResultsInSection:t.length}):void 0,[S,t.length,h]);return w.useEffect(()=>{A.current&&n&&setTimeout(()=>{A.current&&A.current.scrollIntoView({behavior:d?"smooth":"instant"})},300)},[n,d]),T.length===0&&(!t||t.length===0)?null:o.jsxs("div",{ref:A,children:[o.jsx(le,{className:C("bg-token-main-surface-primary text-token-text-primary sticky top-0 z-1 flex items-center px-6 pt-4 pb-4 text-sm font-medium",i?"border-b-thin h-[var(--header-height,3.5rem)] border-(--bento-border-color)":"border-token-border-sharp h-[calc(var(--header-height,3.5rem)+1px)] border-b"),children:e}),o.jsxs("div",{className:"flex list-none flex-col px-3 py-2",children:[t.map((q,E)=>o.jsx(le,{index:E,children:o.jsx(ie,{positionInSection:E,item:q,analyticsMetadata:F,clientThreadId:M},E)},"".concat(e,"-").concat(E))),T]})]})}function ie({item:e,analyticsMetadata:t,positionInSection:n,clientThreadId:d}){var B,u,p;const M=Y(),S=Re(),h=ae(M),T=Oe(M),O=h&&e.journal_name!=null?e.journal_name:e.name,i=$((B=e.cloud_doc_url)!=null?B:"");let A=O!=null?O:o.jsx(W,{id:"bqY3sN",defaultMessage:"File"}),F=e.Icon?()=>e.Icon:(u=i==null?void 0:i.Icon)!=null?u:e.cloud_doc_url?X:$e;!e.cloud_doc_url&&!K(e.id)&&(A=o.jsx(W,{id:"hGgoxF",defaultMessage:"Source"}),F=X);const[q,E]=w.useState(!1);let P=e.cloud_doc_url?e.cloud_doc_url:"";T&&e.journal_homepage_url&&(P=e.journal_homepage_url),h&&P.length>0&&(F=({className:_})=>o.jsx(Pe,{url:P,className:C(_,"object-cover"),size:32,fallback:o.jsx(X,{className:_})}));const G=w.useCallback(()=>{t&&oe.logEventWithStatsig("File Sources Sidebar Item Clicked","file_sources_sidebar_link_clicked",L(U({},t),{positionInSection:n,sourceType:i==null?void 0:i.type,hasUrl:!!e.cloud_doc_url}))},[t,e.cloud_doc_url,i==null?void 0:i.type,n]),z=w.useCallback(()=>{t&&oe.logEventWithStatsig("File Source Sidebar Item Followup Clicked","file_sources_sidebar_item_followup_clicked",L(U({},t),{positionInSection:n,sourceType:i==null?void 0:i.type,hasUrl:!!e.cloud_doc_url}))},[t,e.cloud_doc_url,i==null?void 0:i.type,n]);return o.jsx(o.Fragment,{children:o.jsxs("a",{href:e.cloud_doc_url,target:"_blank",rel:"noreferrer",onClick:G,className:C("group relative flex flex-col gap-0.5 rounded-xl px-3 py-2.5","hover:bg-token-main-surface-secondary",q&&"bg-token-main-surface-secondary"),children:[o.jsxs("div",{className:"ellipses flex h-6 items-center gap-2 text-xs",children:[F&&o.jsx(F,{className:"icon-sm bg-primary flex-none rounded-full object-cover"}),o.jsx("p",{className:"text-token-text-secondary flex-auto truncate overflow-ellipsis",children:A})]}),h&&e.name!=null&&o.jsx("div",{className:"line-clamp-2 text-sm font-bold break-words",children:e.name}),h&&e.authors!=null&&e.publication_year!=null&&o.jsxs("div",{className:"line-clamp-2 text-sm break-words",children:[o.jsx("span",{className:"italic",children:e.authors}),o.jsx("span",{className:"ms-1 not-italic",children:e.publication_year})]}),h&&e.doi!=null&&o.jsx("div",{className:"line-clamp-2 text-sm break-words",children:e.doi}),e.subtitle&&o.jsx("div",{className:"text-token-text-primary line-clamp-1 text-sm font-semibold",children:e.subtitle}),((p=e.text)!=null?p:e.lastModifiedTime)&&o.jsxs("div",{className:"text-token-text-secondary line-clamp-2 text-sm leading-snug font-normal",children:[e.lastModifiedTime&&o.jsxs("span",{children:[o.jsx(qe,{date:new Date(e.lastModifiedTime.trim())}),e.text&&" â€” "]}),e.text]}),S?null:o.jsx(Ue,{className:C("absolute end-2 top-2 flex h-7 w-7 items-center justify-center rounded-sm p-1 transition","text-token-text-secondary group-hover:text-token-text-primary","invisible group-hover:visible","bg-token-main-surface-secondary hover:bg-token-main-surface-tertiary",q&&"bg-token-main-surface-tertiary text-token-text-primary visible"),clientThreadId:d,fileId:e.id,fileName:e.name,fileCloudDocUrl:e.cloud_doc_url,isFollowupMenuOpen:q,setIsFollowupMenuOpen:E,trackFileSourceFollowup:z})]})})}export{Ye as ChatScreenRetrievalResultsFlyoutContent,ce as SourcesListGroup,Ge as __hacky_maybe_enhance_ref};
//# sourceMappingURL=k0d9broc5wqvhhma.js.map
