const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/otp3t1xuqwydluup.js","assets/bubexfvksfr7893o.js","assets/mhxldy24u8s8wkd1.js","assets/on6zjr1bjw5z2d08.js","assets/h92h86hvcd28nyzy.js","assets/lm3g1zm00rp6al39.js","assets/ncw8zw682jinppua.js","assets/root-ookb7xuw.css","assets/conversation-small-lq38g8zw.css","assets/l90ske1z87mx6a7v.js","assets/bm7hpxtjelbikyyh.js","assets/gj9zfs1jmyx6jegb.js","assets/qrcm3utllwqs3zx5.js","assets/kaw18xu9jo85v1g9.js","assets/ab1lw28e5v4cdfgd.js","assets/mvmwqt2pbedq2unu.js","assets/mgui3xyp27o5nkyv.js","assets/jjcc0i8g6768wslh.js","assets/8yatsd42k1ox8n2w.js"])))=>i.map(i=>d[i]);
var yo=Object.defineProperty,Mo=Object.defineProperties;var Eo=Object.getOwnPropertyDescriptors;var rs=Object.getOwnPropertySymbols;var ko=Object.prototype.hasOwnProperty,_o=Object.prototype.propertyIsEnumerable;var wn=(t,e,n)=>e in t?yo(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,pe=(t,e)=>{for(var n in e||(e={}))ko.call(e,n)&&wn(t,n,e[n]);if(rs)for(var n of rs(e))_o.call(e,n)&&wn(t,n,e[n]);return t},Be=(t,e)=>Mo(t,Eo(e));var is=(t,e,n)=>wn(t,typeof e!="symbol"?e+"":e,n);import{_ as ye,c as xe,h as We,j as f,M as _e,r as x,i as As,e as bn,d as So}from"./bubexfvksfr7893o.js";import{markdownToPlaintext as Io,remarkRemoveDirectives as To}from"./bjkxn2ge6s764t7e.js";import{az as Me,aA as Ee,ee as Bs,cz as he,_ as Pt,gZ as yn,$ as Ls,a0 as js,eH as Ke,ff as wo,cr as Ct,R as jn,A as Fs,l as Ro,ab as Po,cx as No,eg as Ws,M as Co,V as vo,eU as zs,aF as Le,rF as Je,lq as Nt,sW as at,t3 as Ue,t4 as xt,o$ as Qe,vT as fe,v$ as Do,a as Oo,wk as Ao,o_ as wt,wB as Bo,u as Et,p as Mn,eX as Gs,wC as Lo,rJ as Rn,fX as jo,iT as $s,iV as Hs,iU as Ks,iS as Us,i_ as qs,ea as Fo,l9 as Wo,m7 as zo,wD as Go,hs as $o,cv as Ho,J as bt,sZ as Ko,sX as Uo,vE as qo,pm as Vo,dw as Yo,lN as Xo,P as Zo,D as Vs,dx as Qo,n2 as Jo,d as er,aB as tr,B as nr,z as sr}from"./ncw8zw682jinppua.js";import{c as Fn}from"./h4jnqd77fz22arvf.js";import{cK as or,xs as mn,h9 as rr,ha as ir,B as ar,E as lr,xt as vn,xu as cr,xv as dr,xw as ur,fs as Ys,xx as Xs,aW as as,aV as fr,xy as gr,xz as mr,uH as pr,al as hr,ak as xr,xA as br,mD as yr,mE as Mr,n8 as Er,fh as kr,e5 as _r,aN as Sr,aA as ls,aI as Ir}from"./lm3g1zm00rp6al39.js";import{P as Tr,S as wr,a as Rr,h as Pr,r as cs,u as Nr}from"./d5mh1yk0rnxpkd9n.js";import{l as Zs,c as Cr,d as vr,B as Dn,e as Dr,b as Or,H as Ar,f as Br,I as On,L as Lr,g as Qs,O as Wn,U as zn,S as jr,T as Fr,h as Wr,i as zr,C as Gr,s as $r,j as Hr,w as ds,t as Kr}from"./gobx7791fcp89y6h.js";import{N as Js,E as Ur,f as qr}from"./imbbtedzs51am1ck.js";import{P as eo,H as Gn,R as Vr,T as Yr}from"./eewckg9c92mnp2ec.js";import{f as Xr}from"./fuwv2o9dqpty536z.js";import{r as Zr,a as Qr,b as Jr,m as ei}from"./g78s6ea1fdv7ipue.js";import{r as ti}from"./kbj1b07s2z6vxqkg.js";import{r as ni}from"./owbget26s04j6ot0.js";import{r as si}from"./bitmj64bbwfuil93.js";import{A as oi,T as ri}from"./kzvpseqfc0j2fpii.js";import{a as je,T as $n}from"./cifdjmblsrwrxxb4.js";import{Z as En,T as to}from"./ce3hgmw4iyyhicud.js";import{u as ii}from"./m214aojas5i8u5ss.js";import{s as ai}from"./cdu988xkidlznefj.js";import{C as us}from"./owg1t5lbjzwpi0hd.js";import{d as li}from"./kl7c6054usfnqmd4.js";import{g as ci}from"./k97n0y6ba9c9h39c.js";var Hn=(t=>(t.STANDARD="standard",t.EMAIL="email",t.CREATIVE="creative",t.CHAT_MESSAGE="chat_message",t.SOCIAL_POST="social_post",t.UNKNOWN="unknown",t))(Hn||{});function rc(t){return Object.values(Hn).includes(t)?t:"unknown"}const ic=["group my-4 w-full overflow-visible rounded-3xl","bg-token-bg-primary","dark:bg-[#2a2a2a]","shadow-[inset_0px_0px_0px_1px_rgba(0,0,0,0.1),0px_4px_80px_rgba(0,0,0,0.03)]","dark:shadow-[inset_0px_0px_0px_1px_rgba(255,255,255,0.04),0px_2px_6px_rgba(0,0,0,0.1)]"].join(" "),di="bg-token-bg-primary/90 dark:bg-[#2a2a2a]/90 group-hover:bg-token-bg-primary/90 dark:group-hover:bg-[#2a2a2a]/90 group-focus-within:bg-token-bg-primary/90 dark:group-focus-within:bg-[#2a2a2a]/90 group-hover:group-focus-within:bg-token-bg-primary/90 dark:group-hover:group-focus-within:bg-[#2a2a2a]/90",fs="placeholder:text-token-text-tertiary min-w-0 flex-1 shrink-0 truncate border-none bg-transparent focus:border-transparent focus:ring-0 focus:outline-hidden",Kn="text-sm font-medium",vt=0,ac="bg-token-bg-primary fixed inset-0 z-30 cursor-zoom-out",lc="bg-token-bg-primary dark:bg-[#2a2a2a] fixed inset-y-0 start-1/2 z-30 flex w-full max-w-[52rem] -translate-x-1/2 cursor-auto flex-col outline-none dark:shadow-[inset_0px_0px_1px_rgba(255,255,255,0.24)] shadow-[inset_0px_0px_0px_1px_rgba(0,0,0,0.1),0px_8px_480px_rgba(0,0,0,0.04)]",ui=Me(()=>ye(()=>import("./otp3t1xuqwydluup.js"),__vite__mapDeps([0,1])),{loading:t=>Ee(t)}),fi=Me(()=>ye(()=>import("./mhxldy24u8s8wkd1.js"),__vite__mapDeps([2,1])),{loading:t=>Ee(t)}),gi=Me(()=>ye(()=>import("./on6zjr1bjw5z2d08.js"),__vite__mapDeps([3,1])),{loading:t=>Ee(t)}),Pn=Me(()=>ye(()=>import("./h92h86hvcd28nyzy.js"),__vite__mapDeps([4,1])),{loading:t=>Ee(t)});function mi(t){"use forget";const e=xe.c(59),{onClick:n,clientThreadId:o,messageId:s}=t,r=We();let i;e[0]!==r?(i=r.formatMessage({id:"EmailSendButton.tooltip",defaultMessage:"Open in email"}),e[0]=r,e[1]=i):i=e[1];const a=i;let l;e[2]!==o||e[3]!==s||e[4]!==n?(l=X=>{Pt.logEventWithStatsig("ChatGPT Writing Block Email Send Button Clicked","chatgpt_writing_block_email_send_button_clicked",Be(pe({},yn({clientThreadId:o,messageId:s})),{provider:X})),Ls.count(js.WRITING_BLOCKS,"chatgpt_writing_block_email_send_button_clicked"),n(X)},e[2]=o,e[3]=s,e[4]=n,e[5]=l):l=e[5];const c=l,g=!Bs();let d;e[6]!==r?(d=r.formatMessage({id:"BnHAsh",defaultMessage:"Open email in app"}),e[6]=r,e[7]=d):d=e[7];let m;e[8]===Symbol.for("react.memo_cache_sentinel")?(m=f.jsx(Pn,{}),e[8]=m):m=e[8];let u;e[9]!==d?(u=f.jsx("button",{className:"text-token-text-secondary dark:text-token-text-tertiary dark:hover:text-token-text-primary hover:text-token-text-primary flex items-center gap-1 px-2 py-2 text-sm select-none","aria-label":d,children:m}),e[9]=d,e[10]=u):u=e[10];let h;e[11]!==c?(h=()=>c("gmail"),e[11]=c,e[12]=h):h=e[12];let b;e[13]===Symbol.for("react.memo_cache_sentinel")?(b=f.jsx(gi,{}),e[13]=b):b=e[13];let D;e[14]!==r?(D=r.formatMessage({id:"2cYA6Z",defaultMessage:"Open email using Gmail"}),e[14]=r,e[15]=D):D=e[15];let S;e[16]===Symbol.for("react.memo_cache_sentinel")?(S=f.jsx(_e,{id:"N+/ksm",defaultMessage:"Gmail"}),e[16]=S):S=e[16];let B;e[17]!==h||e[18]!==D?(B=f.jsx(Ke.Item,{onSelect:h,icon:b,"aria-label":D,label:S}),e[17]=h,e[18]=D,e[19]=B):B=e[19];let E;e[20]!==c?(E=()=>c("outlook"),e[20]=c,e[21]=E):E=e[21];let y;e[22]===Symbol.for("react.memo_cache_sentinel")?(y=f.jsx(ui,{}),e[22]=y):y=e[22];let k;e[23]!==r?(k=r.formatMessage({id:"puDMOA",defaultMessage:"Open email using Outlook"}),e[23]=r,e[24]=k):k=e[24];let I;e[25]===Symbol.for("react.memo_cache_sentinel")?(I=f.jsx(_e,{id:"0Laq6P",defaultMessage:"Outlook"}),e[25]=I):I=e[25];let M;e[26]!==E||e[27]!==k?(M=f.jsx(Ke.Item,{onSelect:E,icon:y,"aria-label":k,label:I}),e[26]=E,e[27]=k,e[28]=M):M=e[28];let v;e[29]!==c?(v=()=>c("default"),e[29]=c,e[30]=v):v=e[30];let _;e[31]===Symbol.for("react.memo_cache_sentinel")?(_=f.jsx(fi,{}),e[31]=_):_=e[31];let C;e[32]!==r?(C=r.formatMessage({id:"aW6dXc",defaultMessage:"Open email using default email app"}),e[32]=r,e[33]=C):C=e[33];let F;e[34]===Symbol.for("react.memo_cache_sentinel")?(F=f.jsx(_e,{id:"DcalRY",defaultMessage:"Default email app"}),e[34]=F):F=e[34];let O;e[35]!==v||e[36]!==C?(O=f.jsx(Ke.Item,{onSelect:v,icon:_,"aria-label":C,label:F}),e[35]=v,e[36]=C,e[37]=O):O=e[37];let L;e[38]!==a||e[39]!==B||e[40]!==M||e[41]!==O||e[42]!==u?(L=f.jsx("div",{className:"hidden md:block",children:f.jsxs(wo,{alignOffset:-8,size:"small",tooltip:a,tooltipSideOffset:vt,triggerButton:u,children:[B,M,O]})}),e[38]=a,e[39]=B,e[40]=M,e[41]=O,e[42]=u,e[43]=L):L=e[43];let p;e[44]===Symbol.for("react.memo_cache_sentinel")?(p=he("text-token-text-secondary dark:text-token-text-tertiary dark:hover:text-token-text-primary hover:text-token-text-primary px-2 py-2",Kn),e[44]=p):p=e[44];let T;e[45]!==r?(T=r.formatMessage({id:"5fZEc+",defaultMessage:"Open in email"}),e[45]=r,e[46]=T):T=e[46];let R;e[47]!==c?(R=()=>c("default"),e[47]=c,e[48]=R):R=e[48];let A;e[49]!==a||e[50]!==g?(A=g?f.jsx(Ct,{label:a,children:f.jsx(Pn,{})}):f.jsx("div",{className:"flex items-center gap-1",children:f.jsx(Pn,{})}),e[49]=a,e[50]=g,e[51]=A):A=e[51];let W;e[52]!==T||e[53]!==R||e[54]!==A?(W=f.jsx("div",{className:"block md:hidden",children:f.jsx("button",{className:p,"aria-label":T,onClick:R,children:A})}),e[52]=T,e[53]=R,e[54]=A,e[55]=W):W=e[55];let H;return e[56]!==L||e[57]!==W?(H=f.jsxs(f.Fragment,{children:[L,W]}),e[56]=L,e[57]=W,e[58]=H):H=e[58],H}const gs="mx-4 my-0! border-0 border-t !border-token-border-light";function cc(t){"use forget";var ce,re,w;const e=xe.c(56),{writingBlock:n,clientThreadId:o,messageId:s,onChange:r,setDirty:i,flushPendingChanges:a,isStreaming:l,streamingTitle:c,streamingRecipient:g,isInlineWritingBlockEditEnabled:d}=t,m=We(),[u,h]=x.useState((ce=n.title)!=null?ce:""),[b,D]=x.useState(String((w=(re=n.metadata)==null?void 0:re.recipient)!=null?w:"")),S=Fn(r,300);let B;e[0]!==S||e[1]!==i?(B=j=>{i(!0),h(j.target.value),S({title:j.target.value})},e[0]=S,e[1]=i,e[2]=B):B=e[2];const E=B;let y;e[3]!==S||e[4]!==i?(y=j=>{i(!0),D(j.target.value),S({metadata:{recipient:j.target.value}})},e[3]=S,e[4]=i,e[5]=y):y=e[5];const k=y;let I;e[6]!==S||e[7]!==a||e[8]!==i?(I=j=>{i(!0),S({title:j.target.value}),S.flush(),a==null||a()},e[6]=S,e[7]=a,e[8]=i,e[9]=I):I=e[9];const M=I;let v;e[10]!==S||e[11]!==a||e[12]!==i?(v=j=>{i(!0),S({metadata:{recipient:j.target.value}}),S.flush(),a==null||a()},e[10]=S,e[11]=a,e[12]=i,e[13]=v):v=e[13];const _=v;let C;e[14]!==b||e[15]!==u||e[16]!==n.content?(C=j=>{const $=encodeURIComponent(Io(n.content)),Y=encodeURIComponent(b),te=encodeURIComponent(u);switch(j){case"gmail":return"https://mail.google.com/mail/u/0/?tf=cm&to=".concat(Y,"&su=").concat(te,"&body=").concat($);case"outlook":return"https://outlook.office.com/mail/deeplink/compose?to=".concat(Y,"&subject=").concat(te,"&body=").concat($);case"default":return"mailto:".concat(b,"?subject=").concat(te,"&body=").concat($)}},e[14]=b,e[15]=u,e[16]=n.content,e[17]=C):C=e[17];const F=C;let O;e[18]===Symbol.for("react.memo_cache_sentinel")?(O=f.jsx(_e,{id:"PrFQxx",defaultMessage:"Email"}),e[18]=O):O=e[18];const L=O;let p;e[19]!==F?(p=j=>window.open(F(j),"_blank"),e[19]=F,e[20]=p):p=e[20];let T;e[21]!==o||e[22]!==s||e[23]!==p?(T=f.jsx(mi,{clientThreadId:o,messageId:s,onClick:p}),e[21]=o,e[22]=s,e[23]=p,e[24]=T):T=e[24];const R=T;let A;e[25]===Symbol.for("react.memo_cache_sentinel")?(A=f.jsx("div",{className:"font-medium",children:f.jsx(_e,{id:"NPvnYL",defaultMessage:"To"})}),e[25]=A):A=e[25];const W=l||!d;let H;e[26]!==m?(H=m.formatMessage({id:"12HHUV",defaultMessage:"name@email.com"}),e[26]=m,e[27]=H):H=e[27];const X=l?g!=null?g:"":b;let Z;e[28]!==_||e[29]!==k||e[30]!==W||e[31]!==H||e[32]!==X?(Z=f.jsxs("div",{className:"flex w-full min-w-0 items-center px-4 py-1 font-sans sm:px-5",children:[A,f.jsx("input",{disabled:W,className:fs,maxLength:240,placeholder:H,value:X,onChange:k,onBlur:_,onCopy:hi})]}),e[28]=_,e[29]=k,e[30]=W,e[31]=H,e[32]=X,e[33]=Z):Z=e[33];const ne=Z;let K;e[34]===Symbol.for("react.memo_cache_sentinel")?(K=f.jsx("div",{className:"font-medium",children:f.jsx(_e,{id:"eQGtfX",defaultMessage:"Subject"})}),e[34]=K):K=e[34];const U=l||!d,Q=l?c!=null?c:"":u;let G;e[35]!==M||e[36]!==E||e[37]!==U||e[38]!==Q?(G=f.jsxs("div",{className:"flex w-full min-w-0 items-center px-4 py-1 font-sans sm:px-5",children:[K,f.jsx("input",{disabled:U,className:fs,value:Q,maxLength:240,onChange:E,onBlur:M,onCopy:pi})]}),e[35]=M,e[36]=E,e[37]=U,e[38]=Q,e[39]=G):G=e[39];const J=G;let P;e[40]===Symbol.for("react.memo_cache_sentinel")?(P=f.jsx("hr",{className:gs}),e[40]=P):P=e[40];let q;e[41]===Symbol.for("react.memo_cache_sentinel")?(q=f.jsx("hr",{className:gs}),e[41]=q):q=e[41];let V;e[42]!==J||e[43]!==ne?(V=f.jsxs("div",{className:"px-1",children:[ne,P,J,q]}),e[42]=J,e[43]=ne,e[44]=V):V=e[44];const oe=V;let le;return e[45]!==R||e[46]!==oe||e[47]!==_||e[48]!==k||e[49]!==M||e[50]!==E||e[51]!==b||e[52]!==J||e[53]!==u||e[54]!==ne?(le={headerLabel:L,emailSendButton:R,toField:ne,subjectField:J,fullScreenEmailHeader:oe,titleState:u,recipientState:b,handleOnTitleChange:E,handleOnTitleBlur:M,handleOnRecipientChange:k,handleOnRecipientBlur:_},e[45]=R,e[46]=oe,e[47]=_,e[48]=k,e[49]=M,e[50]=E,e[51]=b,e[52]=J,e[53]=u,e[54]=ne,e[55]=le):le=e[55],le}function pi(t){return t.stopPropagation()}function hi(t){return t.stopPropagation()}function xi({serverThreadId:t,index:e,messageId:n,writingBlock:o,dirty:s,setDirty:r,delay:i=2e3}){const[a,l]=x.useState(!1),[c,g]=x.useState(null),[d,m]=x.useState(null),[u,h]=x.useState(!1),[b,D]=x.useState(!1),S=x.useRef(0),B=x.useRef(o.content),E=x.useRef(o.title),y=x.useRef(o.metadata),k=x.useRef(!1),I=x.useRef(!1),M=x.useRef(0),v=x.useRef(null),{mutate:_}=As({mutationFn:async({content:p,title:T,metadata:R})=>{S.current+=1,S.current>1&&D(!0),!(!t||!n)&&await jn.safePost("/conversation/message/writing-blocks",{requestBody:{message_id:n,conversation_id:t,index:String(e),id:o.id,writing_block:{content:p,index:String(e),variant:o.variant.toString(),metadata:R,title:T,id:o.id},updated_at:new Date().toISOString()},authOption:Fs.SendIfAvailable})},onSuccess:(p,T,R)=>{v.current===(R==null?void 0:R.myVersion)&&(r(!1),m(new Date))},onMutate:()=>{S.current=0,D(!1);const p=++M.current;return v.current=p,l(!0),g(null),{myVersion:p}},onError:(p,T,R)=>{g(p.message),r(!0)},onSettled:(p,T,R,A)=>{S.current=0,D(!1),v.current===(A==null?void 0:A.myVersion)&&(l(!1),v.current=null,k.current&&C.flush())},retry:1,retryDelay:3e3}),C=Fn(({content:p,title:T,metadata:R})=>{k.current=!1,h(!1),_({content:p,title:T,metadata:R})},i);x.useEffect(()=>{var p;if(o.content===B.current&&o.title===E.current&&o.metadata===y.current){I.current=!1;return}B.current=o.content,E.current=o.title,y.current=o.metadata,k.current=!0,h(!0),C({content:o.content,title:o.title,metadata:(p=o.metadata)!=null?p:{}}),I.current&&(Promise.resolve().then(()=>{C.flush()}),I.current=!1)},[o.content,o.title,o.metadata,C]),x.useEffect(()=>()=>{C.cancel(),I.current=!1,h(!1)},[C]);const F=x.useCallback(()=>{if(!s&&!k.current){I.current=!1,h(!1);return}I.current=!0,k.current&&(C.flush(),I.current=!1,h(!1))},[s,C]),O=x.useMemo(()=>!!d&&!s&&!a,[d,s,a]);return{status:x.useMemo(()=>b?"retrying":a?"saving":c?"error":u?"queued":s?"dirty":O?"saved":"idle",[b,a,c,u,s,O]),savedAt:d,error:c,flushPendingChanges:F}}const bi=()=>({editWritingBlock:x.useCallback(({content:e,clientThreadId:n,message:o,index:s,variant:r,metadata:i,title:a,id:l})=>{var c,g;(g=(c=o.metadata)==null?void 0:c.writing_blocks)!=null&&g[l]||Pt.logEventWithStatsig("ChatGPT Writing Block First Edit","chatgpt_writing_block_first_edit",pe({},yn({clientThreadId:n,messageId:o.id}))),Ro(n,d=>Po.updateTree(d,m=>{var u,h;return m.updateNodeMessageMetadata(o.id,{writing_blocks:Be(pe({},(h=(u=o.metadata)==null?void 0:u.writing_blocks)!=null?h:{}),{[l]:{id:l,index:s,content:e,variant:r,title:a,metadata:i}})})}))},[])});function dc({conversation:t,messageId:e,id:n,originalContent:o,index:s,variant:r,title:i,recipient:a}){var O,L;const l=No(),c=t!=null?t:l,[g,d]=x.useState(!1),m=Ws(()=>c==null?void 0:c.serverId$()),u=Co(c==null?void 0:c.id,p=>{if(!e||!p)return;const R=vo.getTree(p).getNodeIfExists(e);return R==null?void 0:R.message},{disablePerfDetector:!0}),h=(L=(O=u==null?void 0:u.metadata)==null?void 0:O.writing_blocks)==null?void 0:L[n],b=x.useMemo(()=>{var p;return(p=h==null?void 0:h.metadata)!=null?p:{recipient:a!=null?a:null}},[a,h==null?void 0:h.metadata]),D=!!h,{editWritingBlock:S}=bi(),B=or(),E=m!=null&&!B,y=x.useMemo(()=>{var p,T,R;return(R=(T=(p=u==null?void 0:u.metadata)==null?void 0:p.writing_blocks)==null?void 0:T[n])!=null?R:{id:n,content:o,index:s,variant:r,title:i,metadata:b}},[u,n,o,s,r,i,b]),k=x.useMemo(()=>{var p,T;return(T=(p=u==null?void 0:u.metadata)==null?void 0:p.content_references)!=null?T:[]},[u]),{status:I,flushPendingChanges:M}=xi({serverThreadId:m,index:s,messageId:e,dirty:g,setDirty:d,writingBlock:y}),v=x.useCallback(({content:p,title:T,metadata:R})=>{!(c!=null&&c.id)||!u||!u.id||S({content:p!=null?p:y.content,clientThreadId:c==null?void 0:c.id,message:u,index:s,variant:r,metadata:Object.assign({},b,R),title:T!=null?T:y.title,id:n})},[c==null?void 0:c.id,u,s,r,S,n,y,b]),_=x.useRef(null),C=x.useRef(null),F=x.useMemo(()=>{var p;return{serverThreadId:m,messageId:e,blockId:(p=y.id)!=null?p:String(y.index)}},[m,e,y.id,y.index]);return{serverThreadId:m,conversation:c,writingBlock:y,contentReferences:k,autosaveStatus:I,flushPendingChanges:M,handleOnChange:v,messageRef:_,editorViewRef:C,analyticsMetadata:F,hasBeenEdited:D,isWritingBlockEditingAllowed:E,setDirty:d,dirty:g}}const yi=zs(()=>({currentAIOperation$:Le(null)})),Mi=t=>yi(t).currentAIOperation$,Ei=(t,e)=>{Mi(t).set(e)},ki=new Set(["list","ordered_list"]);function _i(t){var n;const e=t.nodes.regular_list_item;if(e)return e;for(const o of Object.values(t.nodes))if(((n=o.spec.group)!=null?n:"").split(/\s+/).filter(Boolean).includes("list_item"))return o;return null}function no(t){const{selection:e}=t;return e.empty&&e.$from.parent.isTextblock&&e.$from.parentOffset===0}function Si(t){return t?ki.has(t.type.name):!1}function Ii(t,e,n){if(!no(t))return!1;const{$from:o}=t.selection;for(let s=o.depth;s>0;s-=1)if(o.node(s).type===n)return Zs(n)(t,e);return!1}function ms(t,e,n){let o=t+1;for(let s=0;s<n;s+=1)o+=e.child(s).nodeSize;return o}function Ti(t,e){const{selection:n,schema:o}=t;if(!no(t))return!1;const s=o.nodes.paragraph;if(!s)return!1;const{$from:r}=n;if(r.parent.type!==s||r.depth!==1)return!1;const i=r.before(1),a=r.after(1),l=t.doc.childBefore(i);if(!l.node||!Si(l.node))return!1;const c=l.node;if(c.childCount===0)return!1;const g=c.childCount-1,d=c.child(g);if(d.childCount===0)return!1;const m=d.childCount-1,u=d.child(m);if(!u.type.isTextblock)return!1;const h=i-c.nodeSize,b=ms(h,c,g),S=ms(b,d,m)+u.nodeSize-1,B=r.parent,E=t.tr;E.delete(i,a);const y=E.mapping.map(S,-1);return B.content.size===0?(e&&(E.setSelection(Nt.create(E.doc,y)),e(E.scrollIntoView())),!0):(E.insert(y,B.content),e&&(E.setSelection(Nt.create(E.doc,y)),e(E.scrollIntoView())),!0)}const wi=(t,e)=>{const n=_i(t.schema);return n?Ii(t,e,n)||Ti(t,e):!1};function Ri(){return new Je({props:{handleKeyDown(t,e){return e.defaultPrevented||e.key!=="Backspace"||e.metaKey||e.ctrlKey||e.altKey?!1:wi(t.state,t.dispatch)}}})}const so="data-writing-block-empty-placeholder",oo="paragraph",it=new at("writingBlockEmptyNodePlaceholder");function Pi(t,e){return new Je({key:it,state:{init(o,s){return{decorations:ps(s.doc,s.selection,t,e,!0),isDisabled:t,placeholderText:e,isEditorFocused:!0}},apply(o,s){var c,g,d,m,u,h;const r=o.getMeta(it),i=(g=(c=Nn(r)?r.isDisabled:void 0)!=null?c:s.isDisabled)!=null?g:t,a=(m=(d=Nn(r)?r.placeholderText:void 0)!=null?d:s.placeholderText)!=null?m:e,l=(h=(u=Nn(r)?r.isEditorFocused:void 0)!=null?u:s.isEditorFocused)!=null?h:!0;return!o.docChanged&&!o.selectionSet&&i===s.isDisabled&&a===s.placeholderText&&l===s.isEditorFocused?s:{decorations:ps(o.doc,o.selection,i,a,l),isDisabled:i,placeholderText:a,isEditorFocused:l}}},props:{decorations(o){var s,r;return(r=(s=it.getState(o))==null?void 0:s.decorations)!=null?r:null},handleDOMEvents:{blur(o){const s=it.getState(o.state);if(!s||!s.isEditorFocused)return!1;const r=An(o.state.tr,{isEditorFocused:!1});return o.dispatch(r),!1},focus(o){const s=it.getState(o.state);if(!s||s.isEditorFocused)return!1;const r=An(o.state.tr,{isEditorFocused:!0});return o.dispatch(r),!1}}}})}function An(t,e){return t.setMeta(it,e)}function Nn(t){return typeof t=="object"&&t!=null&&(Object.prototype.hasOwnProperty.call(t,"isDisabled")||Object.prototype.hasOwnProperty.call(t,"placeholderText")||Object.prototype.hasOwnProperty.call(t,"isEditorFocused"))}function ps(t,e,n,o,s){if(n)return Ue.empty;if(s&&!e.empty)return Ue.empty;const r=s?Ni(e,o):Ci(t,o);return r?Ue.create(t,[r]):Ue.empty}function Ni(t,e){const n=t.$from.parent;if(!n.isTextblock||n.type.name!==oo||n.content.size>0)return null;const o=t.$from.before();if(typeof o!="number")return null;const s=o+n.nodeSize;return xt.node(o,s,{[so]:e})}function Ci(t,e){if(t.childCount===0)return null;let n=t.content.size;for(let o=t.childCount-1;o>=0;o-=1){const s=t.child(o);if(n-=s.nodeSize,s.type.name!==oo||s.content.size>0||!s.type.isTextblock)break;return xt.node(n,n+s.nodeSize,{[so]:e})}return null}const pn="generateSuggestionId";class Un extends Js{static proseMirrorNodeName(){return"generate_suggestion"}unistNodeName(){return Un.proseMirrorNodeName()}unistToProseMirrorTest(){return!1}unistNodeToProseMirrorNodes(e){return[null]}proseMirrorNodeSpec(){return{inline:!0,group:"inline",selectable:!0,isolating:!0,marks:"",allowGapCursor:!1,content:"text*",attrs:{[pn]:{default:null}},parseDOM:[],toDOM(e){var r;const n=(r=e.attrs)==null?void 0:r[pn];return["span",{class:"writing-block-generate-suggestion","data-generate-suggestion":typeof n=="string"?n:""},0]}}}proseMirrorNodeToUnistNodes(){return[]}}const Se=new at("writingBlockGenerate"),Tt=Ue.empty,vi={input:null,suggestion:null,decorations:Tt,lastResolvedSuggestionId:null,lastResolvedReason:null},qn=t=>typeof t=="object"&&t!=null,Di=t=>qn(t)&&typeof t.anchorPos=="number"&&typeof t.caretPos=="number"&&typeof t.blockFrom=="number"&&typeof t.blockTo=="number"&&typeof t.triggerPos=="number"&&typeof t.directiveText=="string",Oi=t=>qn(t)&&typeof t.id=="string"&&typeof t.from=="number"&&typeof t.to=="number",Ai=t=>t==="accept"||t==="reject"||t==="cancel",Bi=t=>{if(!qn(t)||typeof t.type!="string")return!1;switch(t.type){case"set-suggestion":return Oi(t.suggestion);case"clear-suggestion":return Ai(t.reason)&&(t.suggestionId==null||typeof t.suggestionId=="string");case"open-input":return Di(t.input);case"close-input":return!0;default:return!1}},Li=(t,e,n)=>{if(!e)return null;const o=t.map(e.anchorPos,1),s=t.map(e.caretPos,1),r=t.map(e.blockFrom,-1),i=t.map(e.blockTo,1),a=t.map(e.triggerPos,-1),l=typeof e.directiveText=="string"?e.directiveText:"";return r<0||r>=n.content.size||i<r?null:{anchorPos:o,caretPos:s,blockFrom:r,blockTo:i,triggerPos:a,directiveText:l}},ji=(t,e,n)=>{var a;if(!e)return null;const o=(a=n.type.schema.nodes.generate_suggestion)!=null?a:null;if(!o)return null;const s=t.map(e.from,-1);if(s<0||s>=n.content.size)return null;const r=n.nodeAt(s);if(!r||r.type!==o)return null;const i=s+r.nodeSize;return i<=s?null:{id:e.id,from:s,to:i}},hs=t=>{var o;const e=(o=t.type.schema.nodes.generate_suggestion)!=null?o:null;if(!e)return null;let n=null;return t.descendants((s,r)=>{var a;if(n)return!1;if(s.type!==e)return!0;const i=(a=s.attrs)==null?void 0:a[pn];return typeof i!="string"||i.length===0||(n={id:i,from:r,to:r+s.nodeSize}),!1}),n},Fi=()=>new Je({key:Se,state:{init:(t,e)=>{const n=hs(e.doc);return Be(pe({},vi),{suggestion:n})},apply(t,e){let n=e.decorations.map(t.mapping,t.doc),o=Li(t.mapping,e.input,t.doc),s=ji(t.mapping,e.suggestion,t.doc),r=e.lastResolvedSuggestionId,i=e.lastResolvedReason;t.docChanged&&e.suggestion&&!s&&(r=e.suggestion.id,i="reject");const a=t.getMeta(Se),l=Bi(a)?a:null;t.docChanged&&(l==null?void 0:l.type)!=="set-suggestion"&&o&&(o=null),(l==null?void 0:l.type)==="open-input"&&(o=l.input,r=null,i=null),(l==null?void 0:l.type)==="close-input"&&(o=null),(l==null?void 0:l.type)==="set-suggestion"&&(s=l.suggestion,n=Tt,o=null,r=null,i=null),(l==null?void 0:l.type)==="clear-suggestion"&&(s?(r=s.id,i=l.reason):l.suggestionId&&(r=l.suggestionId,i=l.reason),s=null,n=Tt);const c=hs(t.doc);return c?(s=c,(l==null?void 0:l.type)!=="set-suggestion"&&(r=null,i=null)):(l==null?void 0:l.type)!=="set-suggestion"&&(l==null?void 0:l.type)!=="clear-suggestion"&&(s=null),!s&&n!==Tt&&(n=Tt),{input:o,suggestion:s,decorations:n,lastResolvedSuggestionId:r,lastResolvedReason:i}}},props:{decorations(t){var e;return(e=Se.getState(t))==null?void 0:e.decorations}}}),Wi=(t,e)=>{const n={type:"open-input",input:e},o=t.state.tr.setMeta(Se,n);t.dispatch(o)},xs=t=>{var r,i;const e=Se.getState(t.state);let n=t.state.tr;const o=(r=e==null?void 0:e.input)!=null?r:null;if(o){const a=n.doc,l=a.content.size,c=Math.max(0,Math.min(o.caretPos,l)),g=a.resolve(c),d=(i=fe.findFrom(g,1,!0))!=null?i:fe.near(g,1);n.selection.eq(d)||(n=n.setSelection(d))}const s={type:"close-input"};n=n.setMeta(Se,s),t.dispatch(n),t.hasFocus()||t.focus()},zi=({view:t,suggestionId:e,text:n})=>{var y,k;const o=Se.getState(t.state);if(!(o!=null&&o.input))return!1;const s=(y=t.state.schema.nodes.generate_suggestion)!=null?y:null;if(!s)return!1;const{caretPos:r,blockFrom:i,blockTo:a,triggerPos:l,anchorPos:c}=o.input;if(r<i||r>a)return!1;const g=(n!=null?n:"").replace(/\r?\n/g," "),d=Math.max(c,r);let m=t.state.tr;l<d&&(m=m.delete(l,d));const u=m.mapping.map(r,-1),h=g?t.state.schema.text(g):null,b=s.create({[pn]:e},h?Qe.from(h):Qe.empty);m=m.insert(u,Qe.from(b));const D=u,S=u+b.nodeSize,B=(k=fe.findFrom(m.doc.resolve(S),1,!0))!=null?k:fe.near(m.doc.resolve(S),1);m=m.setSelection(B),m.setMeta(mn,!0);const E={type:"set-suggestion",suggestion:{id:e,from:D,to:S}};return m.setMeta(Se,E),t.dispatch(m),!0},Gi=(t,e)=>{var g,d,m;const n=Se.getState(t.state);if(!(n!=null&&n.suggestion)||n.suggestion.id!==e)return!1;const{from:o,to:s}=n.suggestion,r=(g=t.state.schema.nodes.generate_suggestion)!=null?g:null,i=t.state.doc.nodeAt(o);let a=t.state.tr,l=null;if(r&&(i==null?void 0:i.type)===r){const u=(d=i.textContent)!=null?d:"";if(u){const h=t.state.schema.text(u);a=a.replaceRangeWith(o,s,h),l=o+h.nodeSize}else a=a.delete(o,s),l=o}if(l!=null){const u=Math.max(0,Math.min(l,a.doc.content.size)),h=a.doc.resolve(u),b=(m=fe.findFrom(h,1,!0))!=null?m:fe.near(h,1);a=a.setSelection(b)}const c={type:"clear-suggestion",reason:"accept",suggestionId:e};return a=a.setMeta(Se,c),a=a.scrollIntoView(),t.dispatch(a),!0},$i=(t,e)=>{const n=Se.getState(t.state);if(!(n!=null&&n.suggestion)||n.suggestion.id!==e)return!1;const{from:o,to:s}=n.suggestion;let r=t.state.tr.delete(o,s);const i={type:"clear-suggestion",reason:"reject",suggestionId:e};return r=r.setMeta(Se,i),t.dispatch(r),!0},Mt="magicEditId",hn="magicEditHighlightFrom",xn="magicEditHighlightTo";class ro extends Js{unistToProseMirrorTest(){return!1}unistNodeToProseMirrorNodes(e){return[null]}createNodeSpec({role:e,contentEditable:n}){return{attrs:{[Mt]:{default:null},[hn]:{default:null},[xn]:{default:null}},group:"block",content:"block+",isolating:!0,defining:!0,selectable:!1,allowGapCursor:!1,parseDOM:[],toDOM(o){var a;const s=(a=o.attrs)==null?void 0:a[Mt],i={"data-me-role":e,"data-me-id":typeof s=="string"?s:"","data-magic-edit-block":"true"};return n||(i.contenteditable="false",i["aria-readonly"]="true"),["div",i,0]}}}}class Vn extends ro{static proseMirrorNodeName(){return"magic_edit_original_block"}unistNodeName(){return Vn.proseMirrorNodeName()}proseMirrorNodeSpec(){return this.createNodeSpec({role:"orig",contentEditable:!1})}proseMirrorNodeToUnistNodes(e,n){return n}}class Yn extends ro{static proseMirrorNodeName(){return"magic_edit_suggested_block"}unistNodeName(){return Yn.proseMirrorNodeName()}proseMirrorNodeSpec(){return this.createNodeSpec({role:"sugg",contentEditable:!0})}proseMirrorNodeToUnistNodes(){return[]}}class Hi extends Ur{constructor(n={}){super();is(this,"options");this.options=n}dependencies(){let n=!1;try{n=Do(Oo())}catch(o){}return[new Cr,new eo,new vr,new Dn,new Dr,new Or,new Gn,new Ar,new Br,new On,new Lr,new Qs,new Wn,new Vr,new Yr,new zn,new jr,new qr,new Fr,new Wr,new zr,new Vn,new Yn,new Un,...n?[new Gr]:[]]}unifiedInitializationHook(n){var s;const o=(s=this.options.contentReferences)!=null?s:[];return n.use(ti).use(Zr).use(ni,{singleTilde:!1}).use(si).use([[Qr,o]]).use(To).use(Xr).use(Jr).use($r).use(Hr)}}const bs=new Map;function Ki(t={}){var s,r;const e={shouldStripDirectives:(s=t.shouldStripDirectives)!=null?s:!1,contentReferences:(r=t.contentReferences)!=null?r:[]},n=JSON.stringify(e);let o=bs.get(n);if(o==null){const i=[new Hi({contentReferences:e.contentReferences})];t.shouldStripDirectives&&i.push(new wr),o=new Tr(i),bs.set(n,o)}return o}function Ui(t){return typeof t=="object"&&t!=null&&Object.prototype.hasOwnProperty.call(t,"maxLength")}const pt=new at("writingBlockInputConstraints");function qi(t){return new Je({key:pt,state:{init(){return{maxLength:t}},apply(e,n){const o=e.getMeta(pt);return Ui(o)?{maxLength:typeof o.maxLength=="number"?o.maxLength:null}:n}},props:{handleTextInput(e,n,o,s){var c;const r=pt.getState(e.state),i=(c=r==null?void 0:r.maxLength)!=null?c:null;if(i==null)return!1;const a=ys(e.state,i,n,o);if(a<=0)return!0;if(s.length<=a)return!1;const l=s.slice(0,a);return l.length>0&&e.dispatch(e.state.tr.insertText(l,n,o)),!0},handlePaste(e,n){var m,u,h;const o=pt.getState(e.state),s=(m=o==null?void 0:o.maxLength)!=null?m:null;if(s==null)return!1;const r=n.clipboardData;if(!r)return!1;const i=r.getData("text/html"),a=(u=r.getData("text/plain"))!=null?u:"",{from:l,to:c}=e.state.selection,g=ys(e.state,s,l,c);if(i){if(n.preventDefault(),g<=0)return!0;const b=new window.DOMParser().parseFromString(i,"text/html");Zi(b.body);const D=(h=b.body.innerText)!=null?h:"";D.length>g&&(b.body.innerHTML="",b.body.append(document.createTextNode(D.slice(0,g))));const S=e.state.schema,B=Ao.fromSchema(S).parseSlice(b.body,{preserveWhitespace:!0});return e.dispatch(e.state.tr.replaceSelection(B)),!0}if(a.length===0)return!1;if(g<=0)return n.preventDefault(),!0;if(a.length<=g)return!1;n.preventDefault();const d=a.slice(0,g);return e.dispatch(e.state.tr.insertText(d,l,c)),!0}}})}function Vi(t,e){return t.setMeta(pt,{maxLength:typeof e=="number"?e:null})}function ys(t,e,n,o){const s=Yi(t.doc),r=Xi(t,n,o);return e-(s-r)}function Yi(t){return t.textBetween(0,t.content.size,"\n","\n").length}function Xi(t,e,n){return e===n?0:t.doc.textBetween(e,n,"\n","\n").length}function Zi(t){const e=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT),n=[];for(;e.nextNode();){const o=e.currentNode;if(!(o instanceof HTMLElement))continue;const s=o;s.style&&(s.style.color="",s.style.backgroundColor="",s.style.fontFamily="",s.style.fontSize="",s.style.lineHeight="",s.style.textDecoration="",s.style.textShadow=""),(s.tagName==="SPAN"||s.tagName==="FONT")&&!s.hasAttributes()&&n.push(s)}for(const o of n.reverse()){const s=o.parentNode;if(s){for(;o.firstChild;)s.insertBefore(o.firstChild,o);s.removeChild(o)}}}const Qi="_keyBindingTight_19h6r_76",Xn={"magic-edit-selection":"_magic-edit-selection_19h6r_1",keyBindingTight:Qi},Fe=new at("writingBlockMagicEdit");function Ms(t){return typeof t=="object"&&t!=null}function Ji(t){if(t===void 0)return!0;if(!Ms(t))return!1;const{setPinnedRange:e,removeEntryId:n}=t,o=e==null||Ms(e)&&typeof e.from=="number"&&typeof e.to=="number",s=n==null||typeof n=="string";return o&&s}function io(t,e){if(!e)return null;const n=t.map(e.from,-1),o=t.map(e.to,1);return{from:n,to:o}}function Es(t,e){if(!e)return null;const n=io(t,e);return!n||n.to<=n.from?null:n}function ao(t){var o,s;const e=(o=t.nodes.magic_edit_original_block)!=null?o:null,n=(s=t.nodes.magic_edit_suggested_block)!=null?s:null;return!e||!n?null:{originalType:e,suggestedType:n}}function ks(t){if(typeof t=="number")return Number.isFinite(t)?t:null;if(typeof t=="string"&&t.trim()!==""){const e=Number(t);return Number.isFinite(e)?e:null}return null}function ea(t,e){var i,a;const n=ks((i=t.attrs)==null?void 0:i[hn]),o=ks((a=t.attrs)==null?void 0:a[xn]);if(n==null||o==null)return null;const s=e+1+Math.max(0,n),r=e+1+Math.max(0,o);return r<=s?null:{from:s,to:r}}function Bn(t,e){if(!t)return null;const n=e.pos+1,o=e.pos+e.nodeSize-1,s=Math.max(n,t.from),r=Math.min(o,t.to);return r<=s?null:{from:s,to:r}}function _s(t){const e=ao(t.type.schema);if(!e)return new Map;const n=new Map;t.descendants((s,r)=>{var i;if(s.type===e.originalType||s.type===e.suggestedType){const a=(i=s.attrs)==null?void 0:i[Mt];if(!a)return!1;let l=n.get(a);l||(l={},n.set(a,l));const c={pos:r,nodeSize:s.nodeSize},g=Bn(ea(s,r),c),d={position:c,highlight:g};return s.type===e.originalType?l.original=d:l.suggested=d,!1}return!0});const o=new Map;return n.forEach((s,r)=>{if(!s.original||!s.suggested)return;const i=Math.min(s.original.position.pos,s.suggested.position.pos),a=Math.max(s.original.position.pos+s.original.position.nodeSize,s.suggested.position.pos+s.suggested.position.nodeSize);o.set(r,{id:r,from:i,to:a,original:s.original.position,suggested:s.suggested.position,originalHighlight:s.original.highlight,suggestedHighlight:s.suggested.highlight})}),o}function Ss(t,e,n){const o=[];return e&&o.push(xt.inline(e.from,e.to,{class:"magic-edit-selection ".concat(Xn["magic-edit-selection"])})),n.forEach(s=>{s.originalHighlight&&o.push(xt.inline(s.originalHighlight.from,s.originalHighlight.to,{nodeName:"span","data-me-change":"delta"})),s.suggestedHighlight&&o.push(xt.inline(s.suggestedHighlight.from,s.suggestedHighlight.to,{nodeName:"span","data-me-change":"delta"}))}),o.length===0?Ue.empty:Ue.create(t,o)}function ta(){return new Je({key:Fe,state:{init:(t,e)=>{const n=_s(e.doc);return{pinnedRange:null,entries:n,decorations:Ss(e.doc,null,n)}},apply(t,e,n,o){let s=io(t.mapping,e.pinnedRange);const r=new Map;e.entries.forEach((d,m)=>{r.set(m,{originalHighlight:Es(t.mapping,d.originalHighlight),suggestedHighlight:Es(t.mapping,d.suggestedHighlight)})});const i=t.getMeta(Fe),a=Ji(i)?i:void 0;a&&a.setPinnedRange!==void 0&&(s=a.setPinnedRange),a!=null&&a.removeEntryId&&r.delete(a.removeEntryId);const l=_s(o.doc),c=new Map;l.forEach((d,m)=>{var D,S;if(a!=null&&a.removeEntryId&&a.removeEntryId===m)return;const u=r.get(m),h=Bn((D=u==null?void 0:u.originalHighlight)!=null?D:d.originalHighlight,d.original),b=Bn((S=u==null?void 0:u.suggestedHighlight)!=null?S:d.suggestedHighlight,d.suggested);c.set(m,{id:d.id,from:d.from,to:d.to,original:d.original,suggested:d.suggested,originalHighlight:h,suggestedHighlight:b})});const g=Ss(o.doc,s,c);return{pinnedRange:s,entries:c,decorations:g}}},props:{decorations(t){var e,n;return(n=(e=Fe.getState(t))==null?void 0:e.decorations)!=null?n:Ue.empty}}})}function na(t){const{from:e,to:n}=t.state.selection;if(e===n)return!1;const o=t.state.tr;return o.setMeta(Fe,{setPinnedRange:{from:e,to:n}}),t.dispatch(o),!0}function sa(t){const e=t.state.tr;e.setMeta(Fe,{setPinnedRange:null}),t.dispatch(e)}function oa({view:t,pmu:e,range:n,magicEditId:o,replacement:s}){var ne;const{state:r}=t,i=ao(r.schema);if(!i)return!1;const a=r.doc.resolve(n.from),l=r.doc.resolve(n.to),c=r.doc.slice(n.from,n.to),g=(K,U,Q)=>Math.max(U,Math.min(Q,K)),d=()=>{if(a.parent.isTextblock&&l.parent.isTextblock){const U=a.before(),Q=l.after(),G=r.doc.slice(U,Q),J=r.schema.topNodeType.createAndFill({},G.content);if(J){const P="⟦MAGICSTART⟧",q="⟦MAGICEND⟧",V=n.from-U,oe=n.to-U,le=$=>new wt(Qe.from(r.schema.text($)),0,0),ce=J.replace(oe,oe,le(q)).replace(V,V,le(P)),re=e.serialize(ce),w=re.indexOf(P),j=re.indexOf(q);if(w!==-1&&j!==-1&&w<=j){const $=re.slice(0,w)+(s!=null?s:"")+re.slice(j+q.length),Y=e.parse($);return{deletionFrom:U,deletionTo:Q,anchorPos:U,originalSliceForNode:G,selectionRelStart:V,selectionRelEnd:oe,suggestionSlice:new wt(Y.content,0,0)}}}}const K=e.parse(s!=null?s:"");return{deletionFrom:n.from,deletionTo:n.to,anchorPos:n.from,originalSliceForNode:c,selectionRelStart:0,selectionRelEnd:c.content.size,suggestionSlice:K.slice(0,K.content.size)}},{deletionFrom:m,deletionTo:u,anchorPos:h,originalSliceForNode:b,selectionRelStart:D,selectionRelEnd:S,suggestionSlice:B}=d(),E=b.content.size,y=B.content.size,k=g(D,0,E),I=g(S,k,E),M=k,v=I,_=y-E,C=g(k,0,y),F=g(k+Math.max(0,I-k+_),C,y),O=v>M,L=F>C,p=i.originalType.create({[Mt]:o,[hn]:O?Math.floor(M):null,[xn]:O?Math.floor(v):null},b.content),T=i.suggestedType.create({[Mt]:o,[hn]:L?Math.floor(C):null,[xn]:L?Math.floor(F):null},B.content),R=new wt(Qe.fromArray([p,T]),0,0),A=r.tr.replaceRange(m,u,R);A.setMeta(mn,!0),A.setMeta(Fe,{setPinnedRange:null});const H=A.mapping.map(h,-1)+p.nodeSize,X=Math.min(A.doc.content.size,H+1),Z=(ne=fe.findFrom(A.doc.resolve(X),1,!0))!=null?ne:fe.near(A.doc.resolve(X),1);return A.setSelection(Z).scrollIntoView(),t.dispatch(A),!0}function ra(t,e,n){var b;const o=Fe.getState(t.state);if(!o)return;const s=o.entries.get(e);if(!s)return;const r=t.state.doc,i=r.nodeAt(s.original.pos),a=r.nodeAt(s.suggested.pos);if(!i||!a)return;const l=Math.min(s.original.pos,s.suggested.pos),c=Math.max(s.original.pos+i.nodeSize,s.suggested.pos+a.nodeSize),g=n==="keep"?i.content:a.content,d=new wt(g,0,0),m=t.state.tr.replaceRange(l,c,d);m.setMeta(Fe,{setPinnedRange:null,removeEntryId:e});const u=Math.min(m.doc.content.size,l+d.size),h=(b=fe.findFrom(m.doc.resolve(u),-1,!0))!=null?b:fe.near(m.doc.resolve(u),-1);m.setSelection(h),m.scrollIntoView(),t.dispatch(m)}function lo(t){const e=Fe.getState(t.state);if(!e)return!1;const{from:n,to:o}=t.state.selection;if(n===o)return!1;for(const s of e.entries.values())if(n>=s.from&&o<=s.to)return!0;return!1}function Is(t){var e,n;return(n=(e=Fe.getState(t.state))==null?void 0:e.pinnedRange)!=null?n:null}function Ts(t){var r,i;const e=new Map,{nodes:n}=t.type.schema,o=(r=n.magic_edit_original_block)!=null?r:null,s=(i=n.magic_edit_suggested_block)!=null?i:null;return!o||!s||t.descendants((a,l)=>{var d,m;if(a.type!==o&&a.type!==s)return!0;const c=(d=a.attrs)==null?void 0:d[Mt];if(!c)return!1;const g=(m=e.get(c))!=null?m:{hasOriginal:!1,hasSuggested:!1};return a.type===o?g.hasOriginal=!0:g.hasSuggested=!0,e.set(c,g),!1}),e}function ia(t){if(!t)return new Set;const e=t,n=new Set;return typeof e.removeEntryId=="string"&&n.add(e.removeEntryId),n}const aa=new at("writingBlockMagicEditGuard");function la(){return new Je({key:aa,filterTransaction(t,e){if(!t.docChanged||t.getMeta(Rr))return!0;const n=ia(t.getMeta(Fe)),o=Ts(e.doc),s=Ts(t.doc);for(const[r,i]of o){const a=s.get(r),l=n.has(r);if(!a){if(!l)return!1;continue}if(i.hasOriginal&&!a.hasOriginal&&!l||i.hasSuggested&&!a.hasSuggested&&!l)return!1}return!0}})}const ca="\\[[^\\[\\]]+\\]";function da(t){var s;const e=new RegExp(ca,"g"),n=[];let o=e.exec(t);for(;o;){const r=(s=o.index)!=null?s:-1;r>=0&&n.push({start:r,end:r+o[0].length,text:o[0]}),o=e.exec(t)}return n}const ua={class:"text-token-text-primary cursor-text","data-placeholder-token":"true",style:"background-color: color-mix(in srgb, var(--selection) 20%, transparent); padding-top: 4px; padding-bottom: 4px;"};function fa(t){return typeof t=="object"&&t!=null&&Object.prototype.hasOwnProperty.call(t,"isDisabled")}const ht=new at("writingBlockPlaceholder");function ga(t){return new Je({key:ht,state:{init(e,n){return{decorations:ws(n.doc,t),isDisabled:t}},apply(e,n){var r,i;const o=e.getMeta(ht),s=(i=(r=fa(o)?o.isDisabled:void 0)!=null?r:n.isDisabled)!=null?i:t;return!e.docChanged&&s===n.isDisabled?n:{isDisabled:s,decorations:ws(e.doc,s)}}},props:{decorations(e){var n,o;return(o=(n=ht.getState(e))==null?void 0:n.decorations)!=null?o:null},handleDOMEvents:{mousedown(e,n){const o=n.target;if(!(o instanceof HTMLElement))return!1;const s=o.closest("[data-placeholder-token]");if(!(s instanceof HTMLElement))return!1;const r=ht.getState(e.state);if(r!=null&&r.isDisabled)return!1;n.preventDefault(),e.hasFocus()||e.focus();const i=e.posAtDOM(s,0),a=e.posAtDOM(s,s.childNodes.length),l=Nt.create(e.state.doc,i,a);return e.dispatch(e.state.tr.setSelection(l)),!0}}}})}function ma(t,e){return t.setMeta(ht,{isDisabled:e})}function ws(t,e){if(e)return Ue.empty;const n=[];return t.descendants((o,s)=>{if(!o.type.isText||!o.text)return;const r=da(o.text);for(const i of r){const a=s+i.start,l=s+i.end;n.push(xt.inline(a,l,ua))}}),Ue.create(t,n)}const Zn=[{id:"paragraph",command:"text paragraph normal",messageKey:"text"},{id:"heading1",command:"heading1 h1 heading 1",messageKey:"heading1"},{id:"heading2",command:"heading2 h2 heading 2",messageKey:"heading2"},{id:"heading3",command:"heading3 h3 heading 3",messageKey:"heading3"},{id:"orderedList",command:"ordered list numbered",messageKey:"orderedList"},{id:"unorderedList",command:"unordered list bulleted",messageKey:"unorderedList"}];new Map(Zn.map(t=>[t.id,t]));const pa=Zn.map(t=>t.id),ha=()=>Zn,xa=t=>({id:t.id,command:t.command,disabled:!1,messageKey:t.messageKey,kind:"text-style"}),ba=ha().map(xa),Qn=[{id:"generate",command:"magic text generate",disabled:!1,messageKey:"generate",kind:"generate"},{id:"divider",command:"divider hr horizontal rule",disabled:!1,messageKey:"divider",kind:"divider"},...ba],co=new Map(Qn.map(t=>[t.id,t])),ya=["generate","divider",...pa],uo=t=>{var e;return(e=t==null?void 0:t.includeMagicTextOption)!=null?e:!0},fo=(t,e)=>uo(e)?t:t.filter(n=>n.id!=="generate"),Ma=(t,e)=>uo(e)?[...t]:t.filter(n=>n!=="generate"),Ea=t=>fo(Qn,t),ka=t=>{var e;return(e=co.get(t))!=null?e:null},_a=t=>{var e,n;return(n=(e=co.get(t))==null?void 0:e.disabled)!=null?n:!0},Sa=t=>{const e=t.trim().toLowerCase();return e.startsWith("/")?e.slice(1):e},Ia=(t,e)=>t===""?Ma(ya,e):fo(Qn,e).filter(n=>n.command.includes(t)).map(n=>n.id),we=new at("writingBlockSlashMenu"),Ta=t=>typeof t=="object"&&t!=null&&"type"in t,yt={triggerPos:null,anchorPos:null,query:"",normalizedQuery:"",visibleOptionIds:[],highlightedOptionId:null},Ge=t=>(t==null?void 0:t.triggerPos)!=null&&(t==null?void 0:t.anchorPos)!=null,wa=(t,e)=>{const n=t.selection;if(!n.empty||n.from<e||t.doc.textBetween(e,e+1,"\0","\0")!=="/")return!1;const s=t.doc.resolve(e),r=t.selection.$from;return s.parent===r.parent},Rs=(t,e,n)=>{var S,B,E,y,k,I;const o=t.doc,s=o.content.size,r=Math.min(e+1,s),i=(S=n==null?void 0:n.previousState)!=null?S:null,a=(E=(B=n==null?void 0:n.anchorOverride)!=null?B:i==null?void 0:i.anchorPos)!=null?E:null,l=a!=null?a:r,c=t.selection.from,g=c>=r?c:l,d=Math.min(Math.max(g,r),s),m=d<=r?"":o.textBetween(r,d,"\0","\0"),u=Sa(m),h=Ia(u,{includeMagicTextOption:n==null?void 0:n.includeMagicTextOption}),b=(y=i==null?void 0:i.highlightedOptionId)!=null?y:null,D=b&&h.length>0?h.includes(b)?b:(k=h[0])!=null?k:null:(I=h[0])!=null?I:null;return{triggerPos:e,anchorPos:d,query:m,normalizedQuery:u,visibleOptionIds:h,highlightedOptionId:D}},Ra=t=>new Je({key:we,state:{init:()=>yt,apply(e,n,o,s){var c,g;const r=e.getMeta(we),i=Ta(r)?r:void 0;if((i==null?void 0:i.type)==="open")return Rs(s,i.triggerPos,{previousState:n,anchorOverride:i.anchorPos,includeMagicTextOption:t==null?void 0:t.includeMagicTextOption});if((i==null?void 0:i.type)==="close")return yt;if((i==null?void 0:i.type)==="highlight"){if(!Ge(n))return n;const d=i.commandId;return d==null?Be(pe({},n),{highlightedOptionId:(c=n.visibleOptionIds[0])!=null?c:null}):n.visibleOptionIds.includes(d)?n.highlightedOptionId===d?n:Be(pe({},n),{highlightedOptionId:d}):n}if((i==null?void 0:i.type)==="navigate"){if(!Ge(n))return n;const d=n.visibleOptionIds;if(d.length===0)return n.highlightedOptionId==null?n:Be(pe({},n),{highlightedOptionId:null});const m=i.direction==="previous"?-1:1,u=n.highlightedOptionId?d.indexOf(n.highlightedOptionId):-1,b=((u>=0?u:0)+m+d.length)%d.length;return d[b]===n.highlightedOptionId?n:Be(pe({},n),{highlightedOptionId:(g=d[b])!=null?g:null})}if((i==null?void 0:i.type)==="execute"||!Ge(n))return n;const a=n.triggerPos!=null?e.mapping.map(n.triggerPos,-1):null,l=n.anchorPos!=null?e.mapping.map(n.anchorPos,1):null;return a==null||l==null||!wa(s,a)?yt:Rs(s,a,{previousState:Be(pe({},n),{triggerPos:a,anchorPos:l}),includeMagicTextOption:t==null?void 0:t.includeMagicTextOption})}},props:{handleTextInput(e,n,o,s){const r=s.lastIndexOf("/");if(r===-1)return!1;const i=e.state.tr;i.insertText(s,n,o);const a=n+r,l=n+s.length;return e.dispatch(i.setMeta(we,{type:"open",triggerPos:a,anchorPos:l})),!0},handleKeyDown(e,n){const o=we.getState(e.state);if(n.key==="Escape"&&Ge(o)){n.preventDefault(),n.stopPropagation();const s=e.state.tr.setMeta(we,{type:"close"});return e.dispatch(s),!0}if(!o||!Ge(o))return!1;if((n.key==="ArrowUp"||n.key==="ArrowDown")&&o.visibleOptionIds.length>0){n.preventDefault(),n.stopPropagation();const s=e.state.tr.setMeta(we,{type:"navigate",direction:n.key==="ArrowUp"?"previous":"next"});return e.dispatch(s),!0}if(n.key==="Enter"){n.preventDefault(),n.stopPropagation();const s=o.highlightedOptionId;if(!s||_a(s))return!0;const r=e.state.tr.setMeta(we,{type:"execute",commandId:s});return e.dispatch(r),!0}return!1}}}),Rt=t=>{const e=we.getState(t.state);if(!Ge(e))return;const n=t.state.tr.setMeta(we,{type:"close"});t.dispatch(n)},Pa=Me(()=>ye(()=>import("./lm3g1zm00rp6al39.js").then(t=>t.zv),__vite__mapDeps([5,1,6,7,8])),{loading:t=>Ee(t)});function Na({buttonText:t,triggerLabel:e,options:n,selectedOptionId:o,isOpen:s,onOpenChange:r,onSelect:i,preserveSelection:a,editorRef:l}){"use no forget";const c=x.useRef(null),[g,d]=x.useState(null);x.useEffect(()=>{const u=c.current;!u||typeof document>"u"||d(u.closest('[aria-hidden="true"]')!=null)},[]);const m=f.jsxs(f.Fragment,{children:[f.jsx("span",{className:"text-sm",children:t}),f.jsx(Pa,{"aria-hidden":!0,className:"icon-sm text-current"})]});return g!==!1?f.jsx("div",{ref:c,"data-toolbar-surface":"true",className:"h-full",children:f.jsx(je.Button,{type:"button","aria-label":e,"aria-haspopup":"menu","aria-expanded":s,tabIndex:-1,"data-state":s?"open":"closed",className:he("text-token-text-primary flex h-full items-center gap-1 rounded-lg px-2.5","dark:hover:bg-token-interactive-bg-secondary-hover hover:bg-black/5",s&&"bg-token-interactive-bg-secondary-selected"),children:m})}):f.jsx("div",{ref:c,"data-toolbar-surface":"true",className:"h-full",children:f.jsxs(rr,{open:s,onOpenChange:u=>{u&&a(),r(u)},children:[f.jsx(ir,{asChild:!0,children:f.jsx(je.Button,{type:"button","aria-label":e,"aria-haspopup":"menu","aria-expanded":s,className:he("text-token-text-primary flex h-full items-center gap-1 rounded-lg px-2.5","dark:hover:bg-token-interactive-bg-secondary-hover hover:bg-black/5","data-[state=open]:bg-token-interactive-bg-secondary-selected"),onMouseDown:u=>u.preventDefault(),onPointerDownCapture:a,onKeyDownCapture:u=>{(u.key===" "||u.key==="Enter")&&a()},children:m})}),f.jsx(ar,{children:f.jsx(lr,{align:"start",sideOffset:8,className:he(En.toolbar,"popover","bg-token-main-surface-primary w-fit rounded-2xl p-1.5",to),"data-toolbar-surface":"true",onOpenAutoFocus:u=>u.preventDefault(),onCloseAutoFocus:u=>{var h;u.preventDefault(),(h=l.current)==null||h.focus({preventScroll:!0})},children:f.jsx("div",{className:"flex flex-col gap-0.5",role:"menu",children:n.map(u=>{const h=u.id===o;return f.jsx("button",{type:"button",role:"menuitemradio","aria-checked":h,"data-selected":h?"true":void 0,className:he("text-token-text-primary dark:hover:bg-token-main-surface-secondary rounded-[10px] px-3 py-1.5 text-start text-sm hover:bg-[#f5f5f5]",h&&"dark:bg-token-main-surface-secondary bg-[#f5f5f5] font-medium"),onPointerDown:b=>b.preventDefault(),onClick:()=>i(u.id),children:f.jsx("span",{className:"flex items-center gap-2",children:f.jsx("span",{children:u.label})})},u.id)})})})})]})})}function go({onDismiss:t,editorView:e,toolbarContentRef:n,isToolbarOpen:o,dismissOnPointerDown:s=!0}){const r=x.useCallback(l=>{if(!(l instanceof Node))return!1;const c=n.current;return c&&c.contains(l)?!0:l instanceof Element?l.closest('[data-toolbar-surface="true"]')!=null:!1},[n]),i=x.useCallback(l=>{if(l.key!=="Escape"||!o)return;t();const c=e.dom;c&&c.focus({preventScroll:!0})},[e,o,t]),a=x.useCallback(l=>{r(l.target)||!o||t()},[r,o,t]);return x.useEffect(()=>{var c,g;const l=(g=(c=e.dom)==null?void 0:c.ownerDocument)!=null?g:typeof document<"u"?document:null;if(l)return l.addEventListener("keydown",i),s&&l.addEventListener("pointerdown",a,{capture:!0}),()=>{l.removeEventListener("keydown",i),s&&l.removeEventListener("pointerdown",a,!0)}},[s,e,i,a]),{handleKeyDown:i}}function Jn(t,e){return Ca(t)(e)}const Ca=zs(()=>Bo(t=>{const e=Le(t),n=Le(null),o=Le(null),s=Le(null),r=Le(null),i=Le(null),a=Le(null),l=Le(null),c=Le([]),g=Le("pending"),d=Le(null);return{magicEditId$:e,domAnchor$:n,textAnchor$:o,baseBlockVersion$:s,freeformFeedback$:r,fullBlockBodyMarkdown$:i,startIndex$:a,endIndex$:l,replacements$:c,status$:g,modelSlug$:d}}));function va(t,e){var i;const o=((i=t.dom.ownerDocument)!=null?i:document).createRange(),s=t.domAtPos(e.from),r=t.domAtPos(e.to);return o.setStart(s.node,s.offset),o.setEnd(r.node,r.offset),o}function Da(t,e,n){const o=t.resolve(e);if(o.parent.inlineContent)return e;const s=fe.findFrom(o,n,!0);return s?n<0?s.to:s.from:null}function Ps(t,e,n,o,s){const r=Da(t,o,s);if(r==null)throw new Error("Unable to place selection marker.");const i=new wt(Qe.from(t.type.schema.text(n)),0,0),a=t.replace(r,r,i),c=e.serialize(a).indexOf(n);if(c===-1)throw new Error("Failed to locate selection marker in markdown.");return c}function mo({view:t,pmu:e,range:n}){const{state:o}=t,s=o.doc,r=s.content.size,i=e.serialize(s),a=n.from<=0,l=n.to>=r,c=a?0:Ps(s,e,"⟦MAGICSTART⟧",n.from,1),g=l?i.length:Ps(s,e,"⟦MAGICEND⟧",n.to,-1);if(c>g)throw new Error("Failed to locate selection markers in markdown.");return{fullMarkdown:i,startIndex:c,endIndex:g}}function po(){"use forget";const t=xe.c(1);let e;return t[0]===Symbol.for("react.memo_cache_sentinel")?(e={mutationFn:Oa},t[0]=e):e=t[0],As(e)}async function Oa(t){const{payload:e}=t;return await jn.safePost("/conversation/message/writing-blocks/magic-edit",{requestBody:e,authOption:Fs.SendIfAvailable})}async function Aa({view:t,pmu:e,ctx:n,range:o,instruction:s,numVariations:r,magicEditId:i}){let a;try{a=mo({view:t,pmu:e,range:o})}catch(u){throw new Error("Unable to serialize the current selection for magic edit.")}const l=va(t,o),c=cr(t.dom,l),g=dr(a.fullMarkdown,a.startIndex,a.endIndex),d=await ur(a.fullMarkdown),m=Jn(n,i);return m.domAnchor$.set(c),m.textAnchor$.set(g),m.baseBlockVersion$.set(d),m.freeformFeedback$.set(s),m.fullBlockBodyMarkdown$.set(a.fullMarkdown),m.startIndex$.set(a.startIndex),m.endIndex$.set(a.endIndex),{payload:{full_block_body_markdown:a.fullMarkdown,start_index:a.startIndex,end_index:a.endIndex,instruction:s,num_variations:r},snapshot:{domAnchor:c,textAnchor:g,baseBlockVersion:d}}}function Ba(t){"use forget";const e=xe.c(23),{view:n,pmu:o}=t,s=Et(),r=Mn(),i=We(),a=x.useRef(null),l=x.useRef(null),c=x.useRef(null),{mutateAsync:g,isPending:d}=po();let m;e[0]!==s||e[1]!==g?(m=async(M,v)=>{const _=await g({payload:M}),C=_.choices,F=Jn(s,v);return F.replacements$.set(C),F.modelSlug$.set(_.model_slug),F.status$.set("ready"),{replacements:C,magicEditId:v}},e[0]=s,e[1]=g,e[2]=m):m=e[2];const u=m;let h;e[3]!==s||e[4]!==u||e[5]!==i||e[6]!==o||e[7]!==r||e[8]!==n?(h=async M=>{var O;const{instruction:v,numVariations:_}=M,C=_===void 0?1:_,F=Is(n);if(!F){const L=i.formatMessage({id:"zpmbDf",defaultMessage:"Highlight text in the block to use magic edit."});return r.danger(L,{duration:2}),null}try{const L=crypto.randomUUID();c.current=L;const{payload:p,snapshot:T}=await Aa({view:n,pmu:o,ctx:s,range:F,instruction:v,numVariations:C,magicEditId:L});a.current=T,l.current=p;const R=await u(p,L);return vn("ChatGPT Writing Block Magic Edit Submitted","chatgpt_writing_block_magic_edit_submitted",{magicEditId:L}),R}catch(L){const p=L,T=(O=Gs(p))!=null?O:i.formatMessage({id:"oSt4Kz",defaultMessage:"An error occured during magic edit."});return r.danger(T,{duration:2}),vn("ChatGPT Writing Block Magic Edit Failed","chatgpt_writing_block_magic_edit_failed",Be(pe({},c.current?{magicEditId:c.current}:{}),{error:p instanceof Error?p.message:"Unknown error"})),null}},e[3]=s,e[4]=u,e[5]=i,e[6]=o,e[7]=r,e[8]=n,e[9]=h):h=e[9];const b=h;let D;e[10]!==u?(D=()=>!l.current||!c.current?Promise.resolve(null):u(l.current,c.current),e[10]=u,e[11]=D):D=e[11];const S=D;let B;e[12]!==o||e[13]!==n?(B=M=>{const{magicEditId:v,replacement:_}=M;if(!a.current)return!1;const F=Is(n);if(!F)return!1;const O=oa({view:n,pmu:o,range:F,magicEditId:v,replacement:_});return O&&(a.current=null),O},e[12]=o,e[13]=n,e[14]=B):B=e[14];const E=B;let y;e[15]!==n?(y=()=>lo(n),e[15]=n,e[16]=y):y=e[16];const k=y;let I;return e[17]!==E||e[18]!==d||e[19]!==S||e[20]!==k||e[21]!==b?(I={isLoading:d,submitMagicEdit:b,applyMagicEditResult:E,isSelectionInsideMagicEdit:k,retry:S},e[17]=E,e[18]=d,e[19]=S,e[20]=k,e[21]=b,e[22]=I):I=e[22],I}const La=Me(()=>ye(()=>import("./l90ske1z87mx6a7v.js"),__vite__mapDeps([9,1])),{loading:t=>Ee(t)}),ja=Me(()=>ye(()=>import("./lm3g1zm00rp6al39.js").then(t=>t.zx),__vite__mapDeps([5,1,6,7,8])),{loading:t=>Ee(t)});function ho(t){"use forget";const e=xe.c(43),{value:n,onChange:o,placeholder:s,onSubmit:r,onCancel:i,isLoading:a,submitAriaLabel:l,cancelAriaLabel:c,name:g,autoFocus:d,disabled:m,selectAllOnFocus:u,inputRef:h,inputClassName:b,onKeyDownCapture:D,isSubmitDisabled:S}=t,B=u===void 0?!1:u;let E;e[0]!==a||e[1]!==S||e[2]!==n?(E=!a&&(S!=null?S:n.trim()===""),e[0]=a,e[1]=S,e[2]=n,e[3]=E):E=e[3];const y=E;let k;e[4]!==o?(k=W=>o(W.target.value),e[4]=o,e[5]=k):k=e[5];let I;e[6]!==a||e[7]!==i||e[8]!==r?(I=()=>{if(a){i();return}r()},e[6]=a,e[7]=i,e[8]=r,e[9]=I):I=e[9];let M;e[10]!==b?(M=he("mx-0! min-w-[300px]! ps-2.5! pe-9!",b),e[10]=b,e[11]=M):M=e[11];const v=m!=null?m:a;let _;e[12]!==D?(_=W=>{D==null||D(W)},e[12]=D,e[13]=_):_=e[13];let C;e[14]!==d||e[15]!==h||e[16]!==g||e[17]!==s||e[18]!==B||e[19]!==k||e[20]!==I||e[21]!==M||e[22]!==v||e[23]!==_||e[24]!==n?(C=f.jsx(Lo,{ref:h,value:n,onChange:k,placeholder:s,onSubmit:I,border:!1,className:M,name:g,autoFocus:d,disabled:v,selectAllOnFocus:B,onKeyDownCapture:_}),e[14]=d,e[15]=h,e[16]=g,e[17]=s,e[18]=B,e[19]=k,e[20]=I,e[21]=M,e[22]=v,e[23]=_,e[24]=n,e[25]=C):C=e[25];const F=a?"menu-item-input-stop-btn":"composer-submit-btn";let O;e[26]!==F?(O=he("icon",F),e[26]=F,e[27]=O):O=e[27];let L;e[28]!==a||e[29]!==i||e[30]!==r?(L=()=>{a?i():r()},e[28]=a,e[29]=i,e[30]=r,e[31]=L):L=e[31];const p=a?c:l;let T;e[32]!==a?(T=a?f.jsx(La,{className:"icon"}):f.jsx(ja,{className:"icon-xs"}),e[32]=a,e[33]=T):T=e[33];let R;e[34]!==y||e[35]!==O||e[36]!==L||e[37]!==p||e[38]!==T?(R=f.jsx("div",{className:"absolute end-1.5 top-1/2 flex -translate-y-1/2 items-center justify-center",children:f.jsx("button",{className:O,onClick:L,disabled:y,"aria-label":p,"data-in-menu":!0,children:T})}),e[34]=y,e[35]=O,e[36]=L,e[37]=p,e[38]=T,e[39]=R):R=e[39];let A;return e[40]!==R||e[41]!==C?(A=f.jsxs("div",{className:"relative",children:[C,R]}),e[40]=R,e[41]=C,e[42]=A):A=e[42],A}function Fa(t){"use forget";const e=xe.c(40),{editorView:n,pmu:o,intl:s,isMagicEditOpen:r,toggleMagicEdit:i,isMagicEditDisabled:a,handleKeyDown:l}=t,[c,g]=x.useState(""),d=x.useRef(null),m=x.useRef(!1);let u;e[0]!==n||e[1]!==o?(u={view:n,pmu:o},e[0]=n,e[1]=o,e[2]=u):u=e[2];const{isLoading:h,submitMagicEdit:b,applyMagicEditResult:D}=Ba(u);let S;e[3]!==D||e[4]!==c||e[5]!==b||e[6]!==i?(S=async p=>{var H;m.current=!1,p==null||p.preventDefault(),p==null||p.stopPropagation();const T=c.trim();if(!T)return;const R=await b({instruction:T});if(!R||m.current)return;const A=(H=R.replacements[0])!=null?H:"";D({magicEditId:R.magicEditId,replacement:A})&&(g(""),i(!1))},e[3]=D,e[4]=c,e[5]=b,e[6]=i,e[7]=S):S=e[7];const B=S;let E;e[8]!==i?(E=()=>{m.current=!0,i(!1)},e[8]=i,e[9]=E):E=e[9];const y=E;let k;e[10]!==s?(k=s.formatMessage({id:"hZs4Yo",defaultMessage:"Describe the edit"}),e[10]=s,e[11]=k):k=e[11];const I=k;let M;e[12]!==s?(M=s.formatMessage({defaultMessage:"Submit",id:"aria.submit"}),e[12]=s,e[13]=M):M=e[13];const v=M;let _;e[14]!==s?(_=s.formatMessage({defaultMessage:"Cancel",id:"aria.cancel"}),e[14]=s,e[15]=_):_=e[15];const C=_;if(!r){let p;e[16]!==s?(p=s.formatMessage({id:"fO+eDT",defaultMessage:"Magic edit"}),e[16]=s,e[17]=p):p=e[17];let T;e[18]===Symbol.for("react.memo_cache_sentinel")?(T=f.jsx("span",{className:Xn.keyBindingTight,children:f.jsx(Ys,{binding:Xs})}),e[18]=T):T=e[18];let R;e[19]!==i?(R=()=>i(!0),e[19]=i,e[20]=R):R=e[20];let A;e[21]!==a||e[22]!==p||e[23]!==R?(A=f.jsx(je.Action,{label:p,subLabel:T,onClick:R,onMouseDown:Wa,isDisabled:a}),e[21]=a,e[22]=p,e[23]=R,e[24]=A):A=e[24];let W;e[25]===Symbol.for("react.memo_cache_sentinel")?(W=f.jsx(je.Separator,{}),e[25]=W):W=e[25];let H;return e[26]!==A?(H=f.jsxs(f.Fragment,{children:[A,W]}),e[26]=A,e[27]=H):H=e[27],H}let F;e[28]!==c?(F=c.trim(),e[28]=c,e[29]=F):F=e[29];const O=F==="";let L;return e[30]!==C||e[31]!==l||e[32]!==y||e[33]!==B||e[34]!==h||e[35]!==c||e[36]!==I||e[37]!==v||e[38]!==O?(L=f.jsx(ho,{inputRef:d,value:c,onChange:g,placeholder:I,onSubmit:B,onCancel:y,isLoading:h,submitAriaLabel:v,cancelAriaLabel:C,name:"writing-block-magic-edit-instruction",autoFocus:!0,disabled:h,selectAllOnFocus:!1,onKeyDownCapture:l,isSubmitDisabled:O}),e[30]=C,e[31]=l,e[32]=y,e[33]=B,e[34]=h,e[35]=c,e[36]=I,e[37]=v,e[38]=O,e[39]=L):L=e[39],L}function Wa(t){return t.preventDefault()}const Ze=(t,e)=>{if(!e)return!1;const{$from:n}=t.state.selection;for(let o=n.depth;o>=0;o--)if(n.node(o).type===e)return!0;return!1},za=(t,e,n)=>{const{$from:o}=t.state.selection;for(let s=o.depth;s>=0;s--){const r=o.node(s).type;if(r===e||r===n)return!0}return!1},rt=(t,e,n,o)=>{if(!e)return;let s=t.state.selection.$from.depth;for(;s-- >0&&za(t,n,o)&&Zs(e)(t.state,t.dispatch););},Ln=(t,e)=>{const{state:n,dispatch:o}=t,s=n.schema,r=s.nodes[eo.proseMirrorNodeName()],i=s.nodes[Gn.proseMirrorNodeName()],a=s.nodes[Wn.proseMirrorNodeName()],l=s.nodes[zn.proseMirrorNodeName()],c=s.nodes[Qs.proseMirrorNodeName()],g=()=>{r&&Rn(r)(n,o)};switch(e){case"paragraph":{(Ze(t,a)||Ze(t,l))&&rt(t,c,a,l),r&&Rn(r)(n,o);break}case"heading1":case"heading2":case"heading3":{const d=e==="heading1"?1:e==="heading2"?2:3;(Ze(t,a)||Ze(t,l))&&rt(t,c,a,l),i&&Rn(i,{level:d})(n,o);break}case"orderedList":{Ze(t,a)?rt(t,c,a,l):(Ze(t,l)&&rt(t,c,a,l),g(),a&&ds(a)(t.state,t.dispatch));break}case"unorderedList":{Ze(t,l)?rt(t,c,a,l):(Ze(t,a)&&rt(t,c,a,l),g(),l&&ds(l)(t.state,t.dispatch));break}}},Ga=(t,e)=>{var c,g;const n=we.getState(t.state),o=(c=n==null?void 0:n.triggerPos)!=null?c:null,s=(g=n==null?void 0:n.anchorPos)!=null?g:null;if(o==null){Ln(t,e),Rt(t);return}const r=Math.max(o+1,s!=null?s:o+1);let i=t.state.tr.delete(o,r);const a=Math.max(Math.min(o,i.doc.content.size),0),l=Nt.create(i.doc,a);i=i.setSelection(l),t.dispatch(i),Ln(t,e),Rt(t)},$a=Me(()=>ye(()=>import("./bm7hpxtjelbikyyh.js"),__vite__mapDeps([10,1])),{loading:t=>Ee(t)}),Ha=Me(()=>ye(()=>import("./gj9zfs1jmyx6jegb.js"),__vite__mapDeps([11,1])),{loading:t=>Ee(t)}),un=t=>({left:t.left,top:t.top,width:t.width,height:t.height}),fn=.5,gn=(t,e)=>Math.abs(t.left-e.left)<fn&&Math.abs(t.top-e.top)<fn&&Math.abs(t.width-e.width)<fn&&Math.abs(t.height-e.height)<fn,Ka=(t,e)=>t==null&&e==null?!0:t==null||e==null?!1:gn(t,e),He=bn({bold:{id:"Z0FJiE",defaultMessage:"Bold"},italic:{id:"Ros0Mw",defaultMessage:"Italic"},textStylesTrigger:{id:"hngz+P",defaultMessage:"Text styles"},text:{id:"fGeL2E",defaultMessage:"Text"},heading1:{id:"Z1ugOp",defaultMessage:"Heading 1"},heading2:{id:"lVfGMg",defaultMessage:"Heading 2"},heading3:{id:"c55YcX",defaultMessage:"Heading 3"},heading1Glyph:{id:"QzkS3/",defaultMessage:"H1"},heading2Glyph:{id:"F2BLPp",defaultMessage:"H2"},heading3Glyph:{id:"SVuVmp",defaultMessage:"H3"},numberedList:{id:"IGi1BS",defaultMessage:"Numbered list"},bulletedList:{id:"EkLnA6",defaultMessage:"Bulleted list"}}),Ua=({editorView:t,intl:e,isMagicEditEnabled:n,hasActiveMagicEditEntry:o,pmu:s})=>{"use no forget";const r=Et(),i=x.useRef(null),[a,l]=x.useState(!1),[c,g]=x.useState(!1),[d,m]=x.useState(!1),u=o||d,[h,b]=x.useState(!1),D=x.useRef(null),S=x.useCallback(()=>t.dom,[t]),B=x.useRef(null),E=x.useRef(null),[y,k]=x.useState(0),I=x.useRef(!1),M=x.useRef(null),[v,_]=x.useState(!1),[C,F]=x.useState(!1),[O,L]=x.useState("paragraph"),p=x.useCallback(w=>{const j=B.current;j==null&&w==null||j!=null&&w!=null&&gn(j.selectionRect,w.selectionRect)&&gn(j.editorRect,w.editorRect)&&gn(j.containerRect,w.containerRect)&&Ka(j.caretRect,w.caretRect)&&j.isFocusAtEnd===w.isFocusAtEnd||(B.current=w,k(Y=>Y+1))},[]),T=x.useCallback(()=>{var Re,ve,be,De,et;const w=t.state,{from:j,to:$,empty:Y,$from:te}=w.selection,Ie=w.schema.marks[Dn.proseMirrorMarkName()],ge=w.schema.marks[On.proseMirrorMarkName()];if(Y){const ue=(Re=w.storedMarks)!=null?Re:te.marks(),Pe=!!Ie&&!!(ue!=null&&ue.find($e=>$e.type===Ie)),ze=!!ge&&!!(ue!=null&&ue.find($e=>$e.type===ge));_(Pe),F(ze)}else{const ue=w.doc.textBetween(j,$,"\n","\n"),Pe=(be=(ve=ue.match(/^\s*/))==null?void 0:ve[0].length)!=null?be:0,ze=(et=(De=ue.match(/\s*$/))==null?void 0:De[0].length)!=null?et:0,$e=j+Pe,tt=$-ze;if($e>=tt)_(!1),F(!1);else{let nt=!1,Ve=!0,st=!0;w.doc.nodesBetween($e,tt,qe=>{var lt;if(qe.isText){if(!((lt=qe.text)!=null?lt:"").trim())return!0;nt=!0;const Ye=!!Ie&&qe.marks.some(ot=>ot.type===Ie),ct=!!ge&&qe.marks.some(ot=>ot.type===ge);if(Ye||(Ve=!1),ct||(st=!1),!Ve&&!st)return!1}return!0}),_(nt&&Ve),F(nt&&st)}}let ae="paragraph";const de=w.schema.nodes[Gn.proseMirrorNodeName()],ie=w.schema.nodes[Wn.proseMirrorNodeName()],Ne=w.schema.nodes[zn.proseMirrorNodeName()];for(let ue=te.depth;ue>=0;ue--){const Pe=te.node(ue);if(Pe.type===ie){ae="orderedList";break}if(Pe.type===Ne){ae="unorderedList";break}if(Pe.type===de){const ze=Number(Pe.attrs.level);ze===1?ae="heading1":ze===2?ae="heading2":ae="heading3";break}}L(ae)},[t]),R=x.useCallback(()=>{if(typeof window>"u")return;E.current!=null&&window.cancelAnimationFrame(E.current);const w=I.current;E.current=window.requestAnimationFrame(()=>{var ve;if(E.current=null,w)return;const j=t.dom;if(!j){p(null);return}m(lo(t));const $=window.getSelection();if(!$||$.rangeCount===0||$.isCollapsed){T(),p(null);return}const Y=$.getRangeAt(0);if(!Y||!j.contains(Y.commonAncestorContainer)){T(),p(null);return}T();const te=Y.getBoundingClientRect();if(!te||te.width===0&&te.height===0){p(null);return}const Ie=j.getBoundingClientRect(),ae=((ve=j.offsetParent instanceof HTMLElement?j.offsetParent:j.parentElement)!=null?ve:j).getBoundingClientRect();let de=null,ie=!1;const{focusNode:Ne,focusOffset:Re}=$;if(Ne!=null){try{const be=document.createRange();be.setStart(Ne,Re),be.setEnd(Ne,Re);const De=be.getBoundingClientRect();De&&(de=un(De))}catch(be){de=null}try{ie=Ne===Y.endContainer&&Re===Y.endOffset}catch(be){ie=!1}}p({selectionRect:un(te),caretRect:de,editorRect:un(Ie),containerRect:un(ae),isFocusAtEnd:ie})})},[p,t,T]);x.useEffect(()=>{if(typeof document>"u"||typeof window>"u")return;const w=()=>{R()},j=()=>{R()};return document.addEventListener("selectionchange",w),window.addEventListener("resize",j),window.addEventListener("scroll",j,!0),R(),()=>{document.removeEventListener("selectionchange",w),window.removeEventListener("resize",j),window.removeEventListener("scroll",j,!0),E.current!=null&&(window.cancelAnimationFrame(E.current),E.current=null)}},[R]);const A=x.useCallback(w=>{const j=B.current;if(!j)return null;const{selectionRect:$,editorRect:Y,containerRect:te}=j,Ie=8,ge=$.left-Y.left,ae=$.width>0?$.width:w.width,de=Y.width,ie=Y.left-te.left,Ne=ge+ae/2-w.width/2,ve=Math.min(Math.max(Ne,0),Math.max(de-w.width,0))+ie,be=$.top-Y.top,De=Y.top-te.top,ue=be-w.height-Ie+De,Pe=oi.ABOVE;return{left:ve,top:ue,aboveOrBelow:Pe,toolbarSize:w}},[t,y]),W=x.useCallback(()=>{const{state:w,dispatch:j}=t,{selection:$}=w;if($.empty)return;const Y=Math.min($.to,w.doc.content.size),te=w.doc.resolve(Y),Ie=fe.near(te,-1);Ie.eq($)||j(w.tr.setSelection(Ie))},[t]),H=x.useCallback(()=>{var $,Y,te;const w=(Y=($=t.dom)==null?void 0:$.ownerDocument)!=null?Y:typeof document<"u"?document:null,j=(te=w==null?void 0:w.getSelection)==null?void 0:te.call(w);j&&j.removeAllRanges()},[t]),X=x.useCallback(()=>{W(),H()},[W,H]),Z=x.useCallback(w=>{w?(na(t),b(!0),g(!0)):(sa(t),b(!1),g(!1))},[t]),ne=x.useCallback(()=>{Z(!1),X()},[Z,X]),{handleKeyDown:K}=go({editorView:t,toolbarContentRef:i,isToolbarOpen:a,onDismiss:ne}),U=x.useCallback((w,j)=>{const $=t.dom;if(!$)return;const Y=(j==null?void 0:j.maintainToolbarPosition)===!0;I.current=!0,typeof window<"u"&&M.current&&(window.clearTimeout(M.current),M.current=null),$.focus({preventScroll:!0});try{w(),T()}finally{typeof window<"u"?M.current=window.setTimeout(()=>{I.current=!1,M.current=null,Y||R()},0):I.current=!1}},[t,R,T]),Q=x.useCallback(w=>{U(()=>{const{state:j,dispatch:$}=t,Y=j.schema.marks[w];Y&&Kr(j,$,Y)},{maintainToolbarPosition:!0})},[t,U]);x.useEffect(()=>()=>{typeof window<"u"&&M.current!=null&&(window.clearTimeout(M.current),M.current=null)},[]),x.useEffect(()=>{if(!n)return;const w=()=>{D.current&&(D.current.action(),D.current.limitToGroups(),D.current=null)};if(a&&!u){const{addAction:j,limitActionGroups:$}=jo(r);D.current={action:j({key:"magicEdit",action:()=>Z(!0),actionMessageDescriptor:e.formatMessage({id:"MWHvyw",defaultMessage:"Toggle magic edit"}),group:as.Chat,keyboardBinding:Xs}),limitToGroups:$([as.Chat])}}else w();return()=>{w()}},[r,e,n,a,u,Z]);const G=x.useCallback(w=>{U(()=>{Ln(t,w)})},[t,U]),J=x.useMemo(()=>[{id:"paragraph",label:e.formatMessage(He.text)},{id:"heading1",label:e.formatMessage(He.heading1)},{id:"heading2",label:e.formatMessage(He.heading2)},{id:"heading3",label:e.formatMessage(He.heading3)},{id:"orderedList",label:e.formatMessage(He.numberedList)},{id:"unorderedList",label:e.formatMessage(He.bulletedList)}],[e]),P=e.formatMessage(He.textStylesTrigger),[q,V]=x.useState(!1),oe=x.useRef(null),le=x.useCallback(()=>{if(typeof window>"u"){oe.current=null;return}const w=window.getSelection();if(!w||w.rangeCount===0){oe.current=null;return}oe.current=w.getRangeAt(0).cloneRange()},[]),ce=x.useCallback(()=>{if(typeof window>"u")return;const w=oe.current;if(!w)return;const j=window.getSelection();j&&(j.removeAllRanges(),j.addRange(w))},[]);x.useEffect(()=>{q||(oe.current=null)},[q]);const re=x.useMemo(()=>{const w=J.find(j=>j.id===O);return w?w.label:e.formatMessage(He.text)},[O,e,J]);return f.jsxs(ri,{showAskChatGPT:!1,toolbarType:$n.WRITING,getEditorDom:S,getSelectionRange:()=>null,getToolbarPosition:A,savedSelection:h,toolbarContentRef:i,setIsToolbarOpen:l,isSendDisabled:!0,children:[n&&f.jsx(Fa,{editorView:t,pmu:s,intl:e,isMagicEditOpen:c,toggleMagicEdit:Z,isMagicEditDisabled:u,handleKeyDown:K}),!c&&f.jsxs(f.Fragment,{children:[f.jsx(je.Action,{label:e.formatMessage(He.bold),hideLabel:!0,icon:Ha,onClick:()=>Q(Dn.proseMirrorMarkName()),onMouseDown:w=>w.preventDefault(),isActive:v}),f.jsx(je.Action,{label:e.formatMessage(He.italic),hideLabel:!0,icon:$a,onClick:()=>Q(On.proseMirrorMarkName()),onMouseDown:w=>w.preventDefault(),isActive:C}),f.jsx(je.Separator,{}),f.jsx(Na,{buttonText:re,editorRef:{current:t.dom},selectedOptionId:O,isOpen:q,onOpenChange:w=>{w?le():oe.current=null,V(w)},onSelect:w=>{ce(),G(w),V(!1),ne()},options:J,preserveSelection:le,triggerLabel:P})]})]})},qa="calc(300px + 1rem)",Cn=bn({placeholder:{id:"0bHFVY",defaultMessage:"Describe what to generate"},cancelLabel:{id:"dFfo1P",defaultMessage:"Cancel"},submitLabel:{id:"4jyv9s",defaultMessage:"Submit"}});function Va(t){"use forget";const e=xe.c(47),{value:n,onChange:o,onSubmit:s,onCancel:r,isLoading:i,anchorPos:a,editorView:l,editorRootRef:c}=t,g=We(),d=x.useRef(null),m=x.useRef(null);let u;e[0]!==c?(u=(K,U,Q)=>{var G;return qs((G=c.current)!=null?G:K,U,Q,{ancestorResize:!0,ancestorScroll:!0})},e[0]=c,e[1]=u):u=e[1];const h=u;let b;e[2]===Symbol.for("react.memo_cache_sentinel")?(b=[$s(8),Hs({fallbackPlacements:["top-start"]}),Ks({padding:8})],e[2]=b):b=e[2];let D;e[3]!==h?(D={placement:"bottom-start",middleware:b,whileElementsMounted:h},e[3]=h,e[4]=D):D=e[4];const{refs:S,floatingStyles:B,update:E}=Us(D),y=S.setReference,k=S.setFloating;let I,M;e[5]!==a||e[6]!==c||e[7]!==l||e[8]!==y||e[9]!==E?(I=()=>{var U;if(!l||a==null){y(null);return}const K={contextElement:(U=c.current)!=null?U:void 0,getBoundingClientRect:()=>{try{const Q=l.coordsAtPos(a);return new DOMRect(Q.left,Q.bottom,0,0)}catch(Q){return new DOMRect}}};return y(K),E(),()=>{y(null)}},M=[a,c,l,y,E],e[5]=a,e[6]=c,e[7]=l,e[8]=y,e[9]=E,e[10]=I,e[11]=M):(I=e[10],M=e[11]),x.useEffect(I,M);let v,_;e[12]!==r?(v=()=>{const K=Q=>{const G=d.current;G&&(Q.target instanceof Node&&G.contains(Q.target)||r())},U=Q=>{const G=d.current;if(!G){r();return}Q.target instanceof Node&&G.contains(Q.target)||r()};return document.addEventListener("pointerdown",K,!0),document.addEventListener("focusin",U,!0),()=>{document.removeEventListener("pointerdown",K,!0),document.removeEventListener("focusin",U,!0)}},_=[r],e[12]=r,e[13]=v,e[14]=_):(v=e[13],_=e[14]),x.useEffect(v,_);let C,F;e[15]===Symbol.for("react.memo_cache_sentinel")?(C=()=>{var K;(K=m.current)==null||K.focus()},F=[],e[15]=C,e[16]=F):(C=e[15],F=e[16]),x.useEffect(C,F);let O;e[17]!==k?(O=K=>{d.current=K,k(K)},e[17]=k,e[18]=O):O=e[18];let L;e[19]===Symbol.for("react.memo_cache_sentinel")?(L=he(En.toolbar,"absolute"),e[19]=L):L=e[19];let p;e[20]!==B?(p=Be(pe({},B),{width:"max-content",minWidth:qa}),e[20]=B,e[21]=p):p=e[21];let T;e[22]!==g?(T=g.formatMessage(Cn.placeholder),e[22]=g,e[23]=T):T=e[23];let R;e[24]!==g?(R=g.formatMessage(Cn.submitLabel),e[24]=g,e[25]=R):R=e[25];let A;e[26]!==g?(A=g.formatMessage(Cn.cancelLabel),e[26]=g,e[27]=A):A=e[27];let W;e[28]!==r?(W=K=>{K.key==="Escape"&&(K.preventDefault(),r())},e[28]=r,e[29]=W):W=e[29];let H;e[30]!==n?(H=n.trim(),e[30]=n,e[31]=H):H=e[31];const X=H==="";let Z;e[32]!==i||e[33]!==r||e[34]!==o||e[35]!==s||e[36]!==T||e[37]!==R||e[38]!==A||e[39]!==W||e[40]!==X||e[41]!==n?(Z=f.jsx(je,{toolbarType:$n.WRITING,children:f.jsx("div",{className:"flex min-w-0 flex-1",children:f.jsx(ho,{inputRef:m,value:n,onChange:o,placeholder:T,onSubmit:s,onCancel:r,isLoading:i,submitAriaLabel:R,cancelAriaLabel:A,autoFocus:!0,disabled:i,selectAllOnFocus:!1,onKeyDownCapture:W,isSubmitDisabled:X,inputClassName:"w-full"})})}),e[32]=i,e[33]=r,e[34]=o,e[35]=s,e[36]=T,e[37]=R,e[38]=A,e[39]=W,e[40]=X,e[41]=n,e[42]=Z):Z=e[42];let ne;return e[43]!==O||e[44]!==p||e[45]!==Z?(ne=f.jsx("div",{ref:O,className:L,style:p,children:Z}),e[43]=O,e[44]=p,e[45]=Z,e[46]=ne):ne=e[46],ne}const Ns=bn({accept:{id:"9u4W5n",defaultMessage:"Accept"},reject:{id:"ClnYCK",defaultMessage:"Undo"}}),Ya=8,Xa=[fr.Mod,"Enter"];function Cs(t){"use forget";const e=xe.c(58),{editorView:n,editorRootRef:o,activeEntryId:s,onAccept:r,onReject:i,findSuggestionElement:a}=t,l=We(),[c,g]=ii(),{width:d}=c,m=x.useRef(null),[u,h]=x.useState(null),b=Et();let D;e[0]===Symbol.for("react.memo_cache_sentinel")?(D=G=>{h(J=>{const P=J==null,q=G==null;return P&&q||!P&&!q&&J.left===G.left&&J.top===G.top?J:G})},e[0]=D):D=e[0];const S=D;let B;e[1]!==s||e[2]!==a||e[3]!==o?(B=()=>{if(a)return a(o.current,s);const G=o.current;if(!G||!s)return null;const J=G.querySelectorAll("[data-me-role='sugg']");for(const P of J)if(P.dataset.meId===s)return P;return null},e[1]=s,e[2]=a,e[3]=o,e[4]=B):B=e[4];const E=B;let y;e[5]!==s||e[6]!==o||e[7]!==E||e[8]!==d?(y=()=>{var ce,re;if(!s){S(null);return}const G=o.current,J=E();if(!G||!J){S(null);return}const P=G.getBoundingClientRect(),q=J.getBoundingClientRect(),V=(re=d!=null?d:(ce=m.current)==null?void 0:ce.offsetWidth)!=null?re:q.width,oe=Math.max(0,(P.width-V)/2),le=q.bottom-P.top+Ya;S({left:oe,top:le})},e[5]=s,e[6]=o,e[7]=E,e[8]=d,e[9]=y):y=e[9];const k=y;let I,M;e[10]!==k?(I=()=>{k()},M=[k],e[10]=k,e[11]=I,e[12]=M):(I=e[11],M=e[12]),Fo(I,M);let v,_;e[13]!==s||e[14]!==k?(v=()=>{if(!s)return;const G=()=>{k()};return window.addEventListener("resize",G),window.addEventListener("scroll",G,!0),()=>{window.removeEventListener("resize",G),window.removeEventListener("scroll",G,!0)}},_=[s,k],e[13]=s,e[14]=k,e[15]=v,e[16]=_):(v=e[15],_=e[16]),x.useEffect(v,_);const C=s!=null&&u!=null;let F;e[17]!==n||e[18]!==C||e[19]!==i?(F={editorView:n,toolbarContentRef:m,isToolbarOpen:C,onDismiss:i,dismissOnPointerDown:!1},e[17]=n,e[18]=C,e[19]=i,e[20]=F):F=e[20],go(F);let O;e[21]!==s||e[22]!==o||e[23]!==r?(O=()=>{var P,q;if(!s)return;const G=(q=(P=o.current)==null?void 0:P.ownerDocument)!=null?q:document,J=V=>{Wo(V)||zo(V)!==Go()||V.key!=="Enter"||(V.preventDefault(),r())};return G.addEventListener("keydown",J,!0),()=>{G.removeEventListener("keydown",J,!0)}},e[21]=s,e[22]=o,e[23]=r,e[24]=O):O=e[24];let L;e[25]!==s||e[26]!==b||e[27]!==o||e[28]!==l||e[29]!==r?(L=[s,o,r,b,l],e[25]=s,e[26]=b,e[27]=o,e[28]=l,e[29]=r,e[30]=L):L=e[30],x.useEffect(O,L);let p;e[31]!==l?(p=l.formatMessage(Ns.reject),e[31]=l,e[32]=p):p=e[32];let T;e[33]===Symbol.for("react.memo_cache_sentinel")?(T=f.jsx("span",{className:"text-token-text-tertiary ms-1.5 text-sm font-medium",children:f.jsx(_e,{id:"R6HH9/",defaultMessage:"ESC"})}),e[33]=T):T=e[33];let R;e[34]!==i||e[35]!==p?(R=f.jsx(je.Action,{label:p,onClick:i,labelClassName:"font-semibold text-black! dark:text-gray-400!",iconClassName:"text-black! dark:text-gray-400!",subLabel:T}),e[34]=i,e[35]=p,e[36]=R):R=e[36];let A;e[37]===Symbol.for("react.memo_cache_sentinel")?(A=f.jsx(je.Separator,{}),e[37]=A):A=e[37];let W;e[38]!==l?(W=l.formatMessage(Ns.accept),e[38]=l,e[39]=W):W=e[39];let H;e[40]===Symbol.for("react.memo_cache_sentinel")?(H=f.jsx("span",{className:he(Xn.keyBindingTight,"ms-1.5"),children:f.jsx(Ys,{binding:Xa})}),e[40]=H):H=e[40];let X;e[41]!==r||e[42]!==W?(X=f.jsx(je.Action,{label:W,onClick:r,labelClassName:"font-semibold text-blue-400!",iconClassName:"text-blue-400!",subLabel:H}),e[41]=r,e[42]=W,e[43]=X):X=e[43];let Z;e[44]!==R||e[45]!==X?(Z=f.jsxs(je,{toolbarType:$n.WRITING,children:[R,A,X]}),e[44]=R,e[45]=X,e[46]=Z):Z=e[46];const ne=Z;if(!C)return null;let K;e[47]!==s||e[48]!==g||e[49]!==ne?(K=s&&f.jsx("div",{"aria-hidden":"true",className:"pointer-events-none invisible fixed start-0 top-0 h-0 overflow-clip",children:f.jsx("div",{ref:g,children:ne})}),e[47]=s,e[48]=g,e[49]=ne,e[50]=K):K=e[50];let U;e[51]!==C||e[52]!==u||e[53]!==ne?(U=C&&f.jsx("div",{ref:G=>{m.current=G},style:{left:u?u.left:0,top:u?u.top:0},className:he("absolute",En.toolbar),children:ne}),e[51]=C,e[52]=u,e[53]=ne,e[54]=U):U=e[54];let Q;return e[55]!==K||e[56]!==U?(Q=f.jsxs(f.Fragment,{children:[K,U]}),e[55]=K,e[56]=U,e[57]=Q):Q=e[57],Q}const vs=bn({text:{id:"+lD8Gj",defaultMessage:"Text"},heading1:{id:"rIYI87",defaultMessage:"Heading 1"},heading2:{id:"TDeCdX",defaultMessage:"Heading 2"},heading3:{id:"g1V+cN",defaultMessage:"Heading 3"},orderedList:{id:"rCWWta",defaultMessage:"Numbered list"},unorderedList:{id:"TxDV7n",defaultMessage:"Bulleted list"},divider:{id:"5lM+d4",defaultMessage:"Divider"},generate:{id:"/qteYH",defaultMessage:"Magic text"},menuLabel:{id:"ZmuIH8",defaultMessage:"Insert options"}}),Za="text-token-text-primary hover:text-token-text-primary dark:hover:bg-token-main-surface-secondary rounded-[10px] px-2.5 py-1.5 text-left text-sm hover:bg-[#f5f5f5] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-token-border-strong";function xo(t){"use forget";var Q,G,J;const e=xe.c(46),{state:n,style:o,floatingRef:s,dispatchSlashMenuMeta:r,disabledOptionIds:i}=t,a=We(),l=x.useRef(null);let c;e[0]!==n?(c=Ge(n),e[0]=n,e[1]=c):c=e[1];const g=c;n==null||n.visibleOptionIds;let d;e[2]!==(n==null?void 0:n.visibleOptionIds)?(d=(Q=n==null?void 0:n.visibleOptionIds)!=null?Q:[],e[2]=n==null?void 0:n.visibleOptionIds,e[3]=d):d=e[3];const m=d,u=(G=n==null?void 0:n.highlightedOptionId)!=null?G:null;let h;e[4]!==r?(h=()=>{r({type:"close"})},e[4]=r,e[5]=h):h=e[5];const b=h;let D;e[6]!==r?(D=P=>{r({type:"highlight",commandId:P})},e[6]=r,e[7]=D):D=e[7];const S=D;let B;e[8]!==r?(B=P=>{r({type:"execute",commandId:P})},e[8]=r,e[9]=B):B=e[9];const E=B;let y;e[10]!==i||e[11]!==E?(y=new Map,Ea().forEach(P=>{var V;const q=P.disabled||((V=i==null?void 0:i.includes(P.id))!=null?V:!1);y.set(P.id,{id:P.id,messageKey:P.messageKey,disabled:q,onSelect:()=>{E(P.id)}})}),e[10]=i,e[11]=E,e[12]=y):y=e[12];const k=y;let I;if(e[13]!==k||e[14]!==m){let P;e[16]!==k?(P=q=>{var V;return(V=k.get(q))!=null?V:null},e[16]=k,e[17]=P):P=e[17],I=m.map(P).filter(el),e[13]=k,e[14]=m,e[15]=I}else I=e[15];const M=I;let v;e[18]!==S||e[19]!==u||e[20]!==M.length?(v=P=>{const q=P.id===u;return f.jsx("button",{type:"button",role:"menuitem","data-highlighted":q?"true":void 0,className:he(Za,P.disabled&&"cursor-not-allowed opacity-50",q&&"dark:bg-token-main-surface-secondary bg-[#f5f5f5]"),disabled:P.disabled,"aria-disabled":P.disabled?"true":void 0,onClick:()=>{P.disabled||(S(P.id),P.onSelect())},onPointerDown:V=>{V.preventDefault(),V.stopPropagation(),P.disabled||(S(P.id),P.onSelect())},onMouseEnter:()=>{M.length>0&&S(P.id)},onFocus:()=>{M.length>0&&S(P.id)},children:f.jsx(_e,pe({},vs[P.messageKey]))},P.id)},e[18]=S,e[19]=u,e[20]=M.length,e[21]=v):v=e[21];const _=v,C=(J=M.find(Ja))!=null?J:null,F=M.filter(Qa);let O,L;e[22]!==b||e[23]!==g||e[24]!==M.length?(O=()=>{g&&(M.length>0||b())},L=[g,b,M.length],e[22]=b,e[23]=g,e[24]=M.length,e[25]=O,e[26]=L):(O=e[25],L=e[26]),x.useEffect(O,L);let p,T;e[27]!==b||e[28]!==g?(p=()=>{if(!g)return;const P=q=>{l.current&&(q.target instanceof Node&&l.current.contains(q.target)||b())};return document.addEventListener("pointerdown",P,!0),()=>{document.removeEventListener("pointerdown",P,!0)}},T=[g,b],e[27]=b,e[28]=g,e[29]=p,e[30]=T):(p=e[29],T=e[30]),x.useEffect(p,T);let R,A;if(e[31]!==b||e[32]!==g?(R=()=>{if(!g)return;const P=V=>{if(!l.current){b();return}V.target instanceof Node&&l.current.contains(V.target)||b()},q=()=>{b()};return window.addEventListener("blur",q),document.addEventListener("focusin",P,!0),()=>{window.removeEventListener("blur",q),document.removeEventListener("focusin",P,!0)}},A=[g,b],e[31]=b,e[32]=g,e[33]=R,e[34]=A):(R=e[33],A=e[34]),x.useEffect(R,A),!g)return null;let W;e[35]!==s?(W=P=>{l.current=P,s==null||s(P)},e[35]=s,e[36]=W):W=e[36];const H="menu";let X;e[37]!==a?(X=a.formatMessage(vs.menuLabel),e[37]=a,e[38]=X):X=e[38];let Z;e[39]===Symbol.for("react.memo_cache_sentinel")?(Z=he(En.toolbar,to,"writing-block-slash-menu popover bg-token-main-surface-primary absolute w-fit rounded-2xl p-1.5","flex flex-col gap-1"),e[39]=Z):Z=e[39];const ne=-1,K=M.length===0?null:f.jsxs(f.Fragment,{children:[C?_(C):null,C&&F.length>0?f.jsx("div",{"aria-hidden":"true",role:"separator",className:"border-token-border-subtle w-full border-t opacity-100"}):null,F.map(P=>_(P))]});let U;return e[40]!==o||e[41]!==W||e[42]!==X||e[43]!==Z||e[44]!==K?(U=f.jsx("div",{ref:W,role:H,"aria-label":X,className:Z,style:o,tabIndex:ne,children:K}),e[40]=o,e[41]=W,e[42]=X,e[43]=Z,e[44]=K,e[45]=U):U=e[45],U}function Qa(t){return t.id!=="generate"}function Ja(t){return t.id==="generate"}function el(t){return t!=null}xo.displayName="WritingBlockSlashMenu";const tl=({view:t,pmu:e,prompt:n,input:o})=>{const{anchorPos:s,caretPos:r,triggerPos:i,directiveText:a}=o,l={from:Math.min(i,s,r),to:Math.max(s,r)},c=mo({view:t,pmu:e,range:l}),g=c.endIndex-c.startIndex,d=a!=null?a:"";let m=c.fullMarkdown;const u=c.startIndex;let h=c.endIndex;return d.length>0&&(m=m.slice(0,u)+d+m.slice(u),h=u+d.length+g),{full_block_body_markdown:m,start_index:u,end_index:h,instruction:n,num_variations:1}};function nl(t){"use forget";const e=xe.c(10),{view:n,pmu:o}=t,s=Mn(),r=We(),i=x.useRef(!1),{mutateAsync:a,isPending:l}=po();let c;e[0]!==a||e[1]!==r||e[2]!==o||e[3]!==s||e[4]!==n?(c=async h=>{var B;if(!n||!o)return!1;i.current=!1;const b=h.trim();if(b==="")return!1;const D=Se.getState(n.state);if(!(D!=null&&D.input))return!1;let S;try{S=tl({view:n,pmu:o,prompt:b,input:D.input})}catch(E){const y=r.formatMessage({id:"afsmrO",defaultMessage:"Unable to prepare generate request."});return s.danger(y,{duration:2}),!1}try{const E=await a({payload:S});if(i.current)return!1;let y="";const k=E.choices;if(Array.isArray(k)){const v=k[0];if(typeof v=="string")y=v;else if(v!=null){if(typeof v=="object"){const _=v;if("text"in _){const C=_.text;typeof C=="string"&&(y=C)}}}}const I=crypto.randomUUID();if(!zi({view:n,suggestionId:I,text:y})){const v=r.formatMessage({id:"FckTpR",defaultMessage:"Unable to insert generated text."});return s.danger(v,{duration:2}),!1}return!0}catch(E){const y=E;if(!i.current){const k=(B=Gs(y))!=null?B:r.formatMessage({id:"6QyguR",defaultMessage:"An error occurred while generating text."});s.danger(k,{duration:2})}return!1}},e[0]=a,e[1]=r,e[2]=o,e[3]=s,e[4]=n,e[5]=c):c=e[5];const g=c;let d;e[6]===Symbol.for("react.memo_cache_sentinel")?(d=()=>{i.current=!0},e[6]=d):d=e[6];const m=d;let u;return e[7]!==l||e[8]!==g?(u={isLoading:l,submitGenerate:g,cancelGenerate:m},e[7]=l,e[8]=g,e[9]=u):u=e[9],u}const sl=(t,e)=>{if(t===e)return!0;if(!t||!e)return t===e;const n=t.input,o=e.input,s=!n&&!o||n!=null&&o!=null&&n.anchorPos===o.anchorPos&&n.caretPos===o.caretPos&&n.blockFrom===o.blockFrom&&n.blockTo===o.blockTo&&n.triggerPos===o.triggerPos,r=t.suggestion,i=e.suggestion,a=!r&&!i||r!=null&&i!=null&&r.id===i.id&&r.from===i.from&&r.to===i.to;return s&&a&&t.lastResolvedSuggestionId===e.lastResolvedSuggestionId&&t.lastResolvedReason===e.lastResolvedReason},ol=(t,e)=>t===e?!0:t.triggerPos!==e.triggerPos||t.anchorPos!==e.anchorPos||t.query!==e.query||t.normalizedQuery!==e.normalizedQuery||t.highlightedOptionId!==e.highlightedOptionId||t.visibleOptionIds.length!==e.visibleOptionIds.length?!1:t.visibleOptionIds.every((n,o)=>n===e.visibleOptionIds[o]),rl=t=>{var e;return!t||t.entries.size===0?null:(e=t.entries.keys().next().value)!=null?e:null},il={editorView:null,slashMenuState:yt,generatePluginState:null,activeMagicEditEntryId:null},al=(t,e)=>t.editorView===e.editorView&&ol(t.slashMenuState,e.slashMenuState)&&sl(t.generatePluginState,e.generatePluginState)&&t.activeMagicEditEntryId===e.activeMagicEditEntryId,ll=()=>{let t=il;const e=new Set,n=()=>{e.forEach(s=>s())},o=s=>{const r=pe(pe({},t),s);al(t,r)||(t=r,n())};return{getSnapshot:()=>t,subscribe:s=>(e.add(s),()=>{e.delete(s)}),setView:s=>{if(!s){o({editorView:null,slashMenuState:yt,generatePluginState:null,activeMagicEditEntryId:null});return}o({editorView:s})},syncFromState:(s,r)=>{var g,d;const i=(g=we.getState(s))!=null?g:yt,a=(d=Se.getState(s))!=null?d:null,l=r.isMagicEditEnabled?Fe.getState(s):null,c=r.isMagicEditEnabled?rl(l):null;o({slashMenuState:i,generatePluginState:a,activeMagicEditEntryId:c})}}},cl=t=>{"use forget";return x.useSyncExternalStore(t.subscribe,t.getSnapshot,t.getSnapshot)},dl=t=>typeof t=="object"&&t!=null,ul=t=>{if(!dl(t)||typeof t.type!="string")return!1;switch(t.type){case"open":return typeof t.triggerPos=="number"&&typeof t.anchorPos=="number";case"close":return!0;case"navigate":return t.direction==="previous"||t.direction==="next";case"highlight":return typeof t.commandId=="string"||t.commandId==null;case"execute":return typeof t.commandId=="string";default:return!1}},fl={accept:{applyAction:"use",eventName:"ChatGPT Writing Block Magic Edit Accepted",eventType:"chatgpt_writing_block_magic_edit_accepted"},reject:{applyAction:"keep",eventName:"ChatGPT Writing Block Magic Edit Rejected",eventType:"chatgpt_writing_block_magic_edit_rejected"}};function gl(t,e,n){var o,s;return{writing_block_id:e.blockId,magic_edit_id:n,freeform_feedback:t.freeformFeedback$(),full_block_body_markdown:t.fullBlockBodyMarkdown$(),start_index:(o=t.startIndex$())!=null?o:-1,end_index:(s=t.endIndex$())!=null?s:-1,suggested_content:t.replacements$()[0]}}function ml(t,e,n){var B,E,y;const{schema:o}=t.state,s=o.nodes.horizontal_rule,r=o.nodes.paragraph;if(!s)return!1;let i=t.state.tr;const a=Math.max(n!=null?n:e+1,e+1);i=i.delete(e,a);const l=i.mapping.map(e,-1),c=i.doc.childBefore(l+1),g=c.node,d=c.offset;if(r&&(g==null?void 0:g.type)===r&&g.isTextblock&&(g==null?void 0:g.content.size)===0){const k=s.create(),I=d+g.nodeSize;i=i.replaceRangeWith(d,I,k);const M=d+k.nodeSize;let v=M;if(r){const C=r.create(),F=C.nodeSize;i=i.insert(M,Qe.from(C)),v=M+1;const O=M+F,L=i.doc.nodeAt(O);(L==null?void 0:L.type)===r&&L.content.size===0&&(i=i.delete(O,O+L.nodeSize))}const _=(B=fe.findFrom(i.doc.resolve(v),1,!0))!=null?B:fe.near(i.doc.resolve(v),1);return t.dispatch(i.setSelection(_).scrollIntoView()),!0}const u=s.create(),h=r?r.create():null,b=h?[u,h]:[u];i=i.insert(l,Qe.from(b));const D=l+u.nodeSize;if(h&&r){const k=l+u.nodeSize,I=h.nodeSize,M=k+I,v=i.doc.nodeAt(M);v&&v.type===r&&v.content.size===0&&(i=i.delete(M,M+v.nodeSize));const _=(E=fe.findFrom(i.doc.resolve(k+1),1,!0))!=null?E:fe.near(i.doc.resolve(k+1),1);return t.dispatch(i.setSelection(_).scrollIntoView()),!0}const S=(y=fe.findFrom(i.doc.resolve(D),1,!0))!=null?y:fe.near(i.doc.resolve(D),1);return t.dispatch(i.setSelection(S).scrollIntoView()),!0}function pl(t){"use forget";const e=xe.c(2);let n;return e[0]!==t?(n=Ki({shouldStripDirectives:!0,contentReferences:t}),e[0]=t,e[1]=n):n=e[1],n}const hl=t=>{"use forget";var es,ts,ns,ss;const e=xe.c(156),{analyticsMetadata:n,markdown:o,onChange:s,isDisabled:r,className:i,maxLength:a,contentReferences:l,setDirty:c,flushPendingChanges:g,editorViewRef:d}=t,m=Et(),u=We();let h;e[0]!==u?(h=u.formatMessage({id:"IohtFB",defaultMessage:"Write or type ‘/’ for commands..."}),e[0]=u,e[1]=h):h=e[1];const b=h,D=x.useRef(b),S=$o(Ho.MagicEditEnabled);let B;e[2]!==m?(B=bt(m,"2459982630"),e[2]=m,e[3]=B):B=e[3];const y=S||B;let k;e[4]!==m?(k=bt(m,"3539089402"),e[4]=m,e[5]=k):k=e[5];const I=k;let M;e[6]!==m?(M=bt(m,"1629932585"),e[6]=m,e[7]=M):M=e[7];const v=!1,_=pl(l),C=x.useRef(null),F=x.useRef(null);let O;e[8]===Symbol.for("react.memo_cache_sentinel")?(O=ll(),e[8]=O):O=e[8];const L=O,{editorView:p,slashMenuState:T,generatePluginState:R,activeMagicEditEntryId:A}=cl(L),[W,H]=x.useState(""),X=Fn(s,300),Z=x.useRef(X),ne=x.useRef(c),K=x.useRef(g);let U;e[9]===Symbol.for("react.memo_cache_sentinel")?(U={placement:"bottom-start",middleware:[$s(8),Hs({fallbackPlacements:["top-start"]}),Ks({padding:8})],whileElementsMounted:(N,z,ee)=>{var se;return qs((se=C.current)!=null?se:N,z,ee,{ancestorResize:!0,ancestorScroll:!0})}},e[9]=U):U=e[9];const{refs:Q,floatingStyles:G,update:J}=Us(U),P=Q.setReference,q=Q.setFloating,V=x.useRef(null);let oe;e[10]!==d||e[11]!==P||e[12]!==J?(oe=(N,z)=>{var ke;const ee=d.current;if(!ee||N==null){z.current=null,P(null);return}const se={contextElement:(ke=C.current)!=null?ke:void 0,getBoundingClientRect:()=>{try{const me=ee.coordsAtPos(N);return new DOMRect(me.left,me.bottom,0,0)}catch(me){return new DOMRect}}};z.current=se,P(se),J()},e[10]=d,e[11]=P,e[12]=J,e[13]=oe):oe=e[13];const le=oe;let ce;e[14]!==i?(ce=he("markdown","prose","dark:prose-invert","w-full","min-h-6","break-words","focus:outline-none",i),e[14]=i,e[15]=ce):ce=e[15];const re=ce;let w;e[16]!==re||e[17]!==r||e[18]!==o||e[19]!==a?(w={markdown:o,maxLength:a,isDisabled:r,editorClassName:re},e[16]=re,e[17]=r,e[18]=o,e[19]=a,e[20]=w):w=e[20];const j=x.useRef(w),$=x.useRef(o);let Y;e[21]!==p||e[22]!==_?(Y={view:p,pmu:_},e[21]=p,e[22]=_,e[23]=Y):Y=e[23];const{isLoading:te,submitGenerate:Ie,cancelGenerate:ge}=nl(Y),ae=(es=R==null?void 0:R.input)!=null?es:null,de=ae!=null,ie=(ns=(ts=R==null?void 0:R.suggestion)==null?void 0:ts.id)!=null?ns:null;let Ne;e[24]!==d?(Ne=N=>{const z=d.current;if(!z)return;const ee=z.state.tr.setMeta(we,N);z.dispatch(ee)},e[24]=d,e[25]=Ne):Ne=e[25];const Re=Ne;let ve;e[26]!==Re?(ve=()=>{Re({type:"close"})},e[26]=Re,e[27]=ve):ve=e[27];const be=ve;let De;e[28]!==d||e[29]!==be?(De=()=>{const N=d.current;if(!N)return;const z=we.getState(N.state);if(!Ge(z))return;const{triggerPos:ee,anchorPos:se}=z;if(!ml(N,ee,se)){be();return}Rt(N)},e[28]=d,e[29]=be,e[30]=De):De=e[30];const et=De;let ue;e[31]!==d?(ue=()=>{var dn,mt;const N=d.current;if(!N)return;const z=(dn=Se.getState(N.state))!=null?dn:null;if(z!=null&&z.input||z!=null&&z.suggestion)return;const ee=we.getState(N.state);if(!Ge(ee))return;const se=ee.triggerPos;if(se==null)return;const ke=(mt=ee.anchorPos)!=null?mt:se+1,me=Math.max(se+1,ke),Ce=N.state.doc.textBetween(se,me,"\0","\0");let Te=N.state.tr.delete(se,me);const Oe=Math.max(Math.min(se,Te.doc.content.size),0);Te=Te.setSelection(Nt.create(Te.doc,Oe)),N.dispatch(Te);const Xe=N.state,Ae=Xe.selection.to,It=Xe.doc.resolve(Ae),gt=It.start(),cn=It.end();Wi(N,{anchorPos:Ae,caretPos:Ae,blockFrom:gt,blockTo:cn,triggerPos:Ae,directiveText:Ce}),H(""),Rt(N)},e[31]=d,e[32]=ue):ue=e[32];const Pe=ue;let ze;e[33]!==ge||e[34]!==d?(ze=()=>{var se,ke,me;ge(),H("");const N=d.current;if(!N)return;const z=Se.getState(N.state),ee=(ke=(se=z==null?void 0:z.input)==null?void 0:se.triggerPos)!=null?ke:null;if(xs(N),ee!=null){const Ce=N.state.doc,Te=Math.max(0,Math.min(ee,Ce.content.size)),Oe=Ce.resolve(Te),Xe=(me=fe.findFrom(Oe,1,!0))!=null?me:fe.near(Oe,1);if(!N.state.selection.eq(Xe)){const St=N.state.tr.setSelection(Xe);N.dispatch(St)}}N.hasFocus()||N.focus()},e[33]=ge,e[34]=d,e[35]=ze):ze=e[35];const $e=ze;let tt;e[36]!==W||e[37]!==Ie?(tt=async()=>{await Ie(W)&&H("")},e[36]=W,e[37]=Ie,e[38]=tt):tt=e[38];const nt=tt;let Ve;e[39]!==ie||e[40]!==d?(Ve=()=>{if(!ie)return;const N=d.current;N&&(Gi(N,ie),N.hasFocus()||N.focus())},e[39]=ie,e[40]=d,e[41]=Ve):Ve=e[41];const st=Ve;let qe;e[42]!==ie||e[43]!==d?(qe=()=>{if(!ie)return;const N=d.current;N&&($i(N,ie),N.hasFocus()||N.focus())},e[42]=ie,e[43]=d,e[44]=qe):qe=e[44];const lt=qe;let kt;e[45]!==A||e[46]!==n||e[47]!==m||e[48]!==p?(kt=N=>{if(!A||!p)return;p.focus();const z=Jn(m,A),ee=z.modelSlug$(),se=gl(z,n,A),{applyAction:ke,eventName:me,eventType:Ce}=fl[N];ra(p,A,ke),gr(N,se,n.serverThreadId,n.messageId,ee,m),vn(me,Ce,pe({magicEditId:A},ee?{modelSlug:ee}:{}))},e[45]=A,e[46]=n,e[47]=m,e[48]=p,e[49]=kt):kt=e[49];const Ye=kt;let ct;e[50]!==Ye?(ct=()=>Ye("accept"),e[50]=Ye,e[51]=ct):ct=e[51];const ot=ct;let Dt;e[52]!==Ye?(Dt=()=>Ye("reject"),e[52]=Ye,e[53]=Dt):Dt=e[53];const kn=Dt;let Ot;e[54]!==d||e[55]!==Pe||e[56]!==et?(Ot=N=>{if(N==="divider"){et();return}if(N==="generate"){Pe();return}const z=ka(N);if((z==null?void 0:z.kind)==="text-style"){const ee=d.current;if(!ee)return;ee.focus(),Ga(ee,z.id)}},e[54]=d,e[55]=Pe,e[56]=et,e[57]=Ot):Ot=e[57];const At=Ot;let Bt,Lt;e[58]!==X?(Bt=()=>{Z.current=X},Lt=[X],e[58]=X,e[59]=Bt,e[60]=Lt):(Bt=e[59],Lt=e[60]),x.useEffect(Bt,Lt);let jt,Ft;e[61]!==c?(jt=()=>{ne.current=c},Ft=[c],e[61]=c,e[62]=jt,e[63]=Ft):(jt=e[62],Ft=e[63]),x.useEffect(jt,Ft);let Wt,zt;e[64]!==g?(Wt=()=>{K.current=g},zt=[g],e[64]=g,e[65]=Wt,e[66]=zt):(Wt=e[65],zt=e[66]),x.useEffect(Wt,zt);let Gt,$t;e[67]!==ge||e[68]!==d||e[69]!==At||e[70]!==be||e[71]!==y||e[72]!==I||e[73]!==_||e[74]!==P||e[75]!==v?(Gt=()=>{const N=F.current;if(!N)return;const{markdown:z,maxLength:ee,isDisabled:se,editorClassName:ke}=j.current,me=_.parse(z!=null?z:"");$.current=z;const Ce=[Pr(),_.inputRulesPlugin(),...I?[Ra({includeMagicTextOption:y})]:[],...I?[Fi()]:[],Ri(),_.keymapPlugin(),Ko(Be(pe({},Uo),{"Mod-z":Nr,"Mod-shift-z":cs,"Mod-y":cs})),ga(se),Pi(se,D.current),qi(typeof ee=="number"?ee:null)];y&&(Ce.push(ta()),Ce.push(la()));const Te=qo.create({doc:me,schema:_.schema(),plugins:Ce}),Oe=new Vo({mount:N},{state:Te,editable:()=>!se,attributes:{class:he("ProseMirror",ke),"aria-disabled":String(se)},dispatchTransaction(Ae){const It=Ae.getMeta(we),gt=ul(It)?It:null,cn=(gt==null?void 0:gt.type)==="execute"?gt.commandId:null,dn=Ae.getMeta(mn)===!0,mt=Oe.state.apply(Ae);if(Oe.updateState(mt),L.syncFromState(mt,{isMagicEditEnabled:y}),cn&&At(cn),!Ae.docChanged||dn)return;const os=_.serialize(mt.doc);$.current=os,ne.current(!0),Z.current({content:os})}});d.current=Oe,L.setView(Oe),L.syncFromState(Oe.state,{isMagicEditEnabled:y});const Xe=Oe.dom,St=()=>{var Ae;Z.current.flush(),(Ae=K.current)==null||Ae.call(K),be()};return Xe.addEventListener("blur",St,!0),()=>{Xe.removeEventListener("blur",St,!0),Z.current.flush(),Oe.destroy(),d.current=null,L.setView(null),V.current=null,P(null),ge(),H("")}},$t=[_,be,P,y,I,v,At,ge,L,d],e[67]=ge,e[68]=d,e[69]=At,e[70]=be,e[71]=y,e[72]=I,e[73]=_,e[74]=P,e[75]=v,e[76]=Gt,e[77]=$t):(Gt=e[76],$t=e[77]),x.useEffect(Gt,$t);let Ht,Kt;e[78]!==re||e[79]!==d||e[80]!==b||e[81]!==de||e[82]!==r?(Ht=()=>{const N=d.current;if(!N)return;N.setProps({editable:()=>!r,attributes:{class:he("ProseMirror",re),"aria-disabled":String(r)}});const z=ht.getState(N.state),ee=it.getState(N.state),se=(z==null?void 0:z.isDisabled)!==r,ke=r||de,me=(ee==null?void 0:ee.isDisabled)!==ke,Ce=(ee==null?void 0:ee.placeholderText)!==b;if(se||me||Ce){let Te=N.state.tr;se&&(Te=ma(Te,r)),(me||Ce)&&(Te=An(Te,{isDisabled:ke,placeholderText:b})),N.dispatch(Te)}},Kt=[re,b,de,r,d],e[78]=re,e[79]=d,e[80]=b,e[81]=de,e[82]=r,e[83]=Ht,e[84]=Kt):(Ht=e[83],Kt=e[84]),x.useEffect(Ht,Kt);let Ut,qt;e[85]!==d||e[86]!==y?(Ut=()=>{const N=d.current;N&&L.syncFromState(N.state,{isMagicEditEnabled:y})},qt=[y,L,d],e[85]=d,e[86]=y,e[87]=Ut,e[88]=qt):(Ut=e[87],qt=e[88]),x.useEffect(Ut,qt);let Vt,Yt;e[89]!==ae||e[90]!==P||e[91]!==T||e[92]!==le?(Vt=()=>{if(ae){V.current=null,P(null);return}if(Ge(T)){le(T.anchorPos,V);return}V.current=null,P(null)},Yt=[ae,T,P,le],e[89]=ae,e[90]=P,e[91]=T,e[92]=le,e[93]=Vt,e[94]=Yt):(Vt=e[93],Yt=e[94]),x.useEffect(Vt,Yt);let Xt,Zt;e[95]!==ge||e[96]!==d||e[97]!==r?(Xt=()=>{if(!r)return;const N=d.current;N&&(Rt(N),xs(N)),ge()},Zt=[ge,r,d],e[95]=ge,e[96]=d,e[97]=r,e[98]=Xt,e[99]=Zt):(Xt=e[98],Zt=e[99]),x.useEffect(Xt,Zt);let Qt,Jt;e[100]!==ie||e[101]!==A||e[102]!==m?(Qt=()=>{Ei(m,A?{type:"magic-edit",id:A}:ie?{type:"generate",id:ie}:null)},Jt=[ie,A,m],e[100]=ie,e[101]=A,e[102]=m,e[103]=Qt,e[104]=Jt):(Qt=e[103],Jt=e[104]),x.useEffect(Qt,Jt);let en,tn;e[105]!==d||e[106]!==a?(en=()=>{var me;const N=d.current;if(!N)return;const z=pt.getState(N.state),ee=(me=z==null?void 0:z.maxLength)!=null?me:null,se=typeof a=="number"?a:null;if(ee===se)return;const ke=Vi(N.state.tr,se);N.dispatch(ke)},tn=[a,d],e[105]=d,e[106]=a,e[107]=en,e[108]=tn):(en=e[107],tn=e[108]),x.useEffect(en,tn);let nn,sn;e[109]!==d||e[110]!==o||e[111]!==_?(nn=()=>{const N=d.current;if(!N||o===$.current)return;$.current=o;const z=_.parse(o!=null?o:""),ee=N.state.tr.replaceWith(0,N.state.doc.content.size,z.content);ee.setMeta(mn,!0),N.dispatch(ee)},sn=[o,_,d],e[109]=d,e[110]=o,e[111]=_,e[112]=nn,e[113]=sn):(nn=e[112],sn=e[113]),x.useEffect(nn,sn);const bo=Ge(T),on=de||A!=null||ie!=null,_n=on||te;let rn;e[114]!==_n?(rn=_n?["generate"]:void 0,e[114]=_n,e[115]=rn):rn=e[115];const Sn=rn,In=!de&&bo?G:void 0;let _t;e:{if(!p){_t=null;break e}if(y&&A){let N;e[116]!==A||e[117]!==p||e[118]!==ot||e[119]!==kn?(N=f.jsx(Cs,{editorView:p,editorRootRef:C,activeEntryId:A,onAccept:ot,onReject:kn}),e[116]=A,e[117]=p,e[118]=ot,e[119]=kn,e[120]=N):N=e[120],_t=N;break e}if(ie){const N=xl;let z;e[121]!==ie||e[122]!==p||e[123]!==st||e[124]!==lt?(z=f.jsx(Cs,{editorView:p,editorRootRef:C,activeEntryId:ie,onAccept:st,onReject:lt,findSuggestionElement:N}),e[121]=ie,e[122]=p,e[123]=st,e[124]=lt,e[125]=z):z=e[125],_t=z;break e}_t=null}const Tn=_t;let an;e[126]===Symbol.for("react.memo_cache_sentinel")?(an=f.jsx("div",{ref:F}),e[126]=an):an=e[126];let dt;e[127]!==Sn||e[128]!==Re||e[129]!==de||e[130]!==I||e[131]!==q||e[132]!==T||e[133]!==In?(dt=I&&!de&&f.jsx(xo,{state:T,floatingRef:q,style:In,dispatchSlashMenuMeta:Re,disabledOptionIds:Sn}),e[127]=Sn,e[128]=Re,e[129]=de,e[130]=I,e[131]=q,e[132]=T,e[133]=In,e[134]=dt):dt=e[134];let ut;e[135]!==p||e[136]!==de||e[137]!==(ae==null?void 0:ae.anchorPos)||e[138]!==W||e[139]!==$e||e[140]!==nt||e[141]!==te?(ut=de&&p&&f.jsx(Va,{value:W,onChange:H,onSubmit:()=>{nt()},onCancel:$e,isLoading:te,anchorPos:(ss=ae==null?void 0:ae.anchorPos)!=null?ss:null,editorView:p,editorRootRef:C}),e[135]=p,e[136]=de,e[137]=ae==null?void 0:ae.anchorPos,e[138]=W,e[139]=$e,e[140]=nt,e[141]=te,e[142]=ut):ut=e[142];let ft;e[143]!==p||e[144]!==on||e[145]!==u||e[146]!==r||e[147]!==te||e[148]!==y||e[149]!==_?(ft=!r&&p&&f.jsx(Ua,{editorView:p,intl:u,isMagicEditEnabled:y,hasActiveMagicEditEntry:on||te,pmu:_}),e[143]=p,e[144]=on,e[145]=u,e[146]=r,e[147]=te,e[148]=y,e[149]=_,e[150]=ft):ft=e[150];let ln;return e[151]!==Tn||e[152]!==dt||e[153]!==ut||e[154]!==ft?(ln=f.jsxs("div",{ref:C,className:"writing-block-editor markdown-new-styling relative px-4 sm:px-5",children:[an,dt,ut,Tn,ft]}),e[151]=Tn,e[152]=dt,e[153]=ut,e[154]=ft,e[155]=ln):ln=e[155],ln};function xl(t,e){var n;return!t||!e?null:(n=t.querySelector("[data-generate-suggestion='".concat(e,"']")))!=null?n:null}const bl=2e4,yl=t=>{"use forget";const e=xe.c(9),{editorViewRef:n,analyticsMetadata:o,isInlineWritingBlockEditEnabled:s,writingBlock:r,onChange:i,isStreaming:a,setDirty:l,flushPendingChanges:c,contentReferences:g}=t,d=a||!s;let m;return e[0]!==o||e[1]!==g||e[2]!==n||e[3]!==c||e[4]!==i||e[5]!==l||e[6]!==d||e[7]!==r.content?(m=f.jsx(hl,{editorViewRef:n,setDirty:l,analyticsMetadata:o,markdown:r.content,onChange:i,isDisabled:d,maxLength:bl,flushPendingChanges:c,contentReferences:g}),e[0]=o,e[1]=g,e[2]=n,e[3]=c,e[4]=i,e[5]=l,e[6]=d,e[7]=r.content,e[8]=m):m=e[8],m},Ds=Me(()=>ye(()=>import("./ncw8zw682jinppua.js").then(t=>t.yq),__vite__mapDeps([6,1,7])),{loading:t=>Ee(t)});function Ml(t){"use forget";const e=xe.c(6),{clientThreadId:n,permalink:o,isStreaming:s}=t,r=So();let i;e[0]===Symbol.for("react.memo_cache_sentinel")?(i=f.jsx(_e,{id:"WritingBlockCloseButton.closeTooltip",defaultMessage:"Close"}),e[0]=i):i=e[0];let a;return e[1]!==n||e[2]!==s||e[3]!==r||e[4]!==o?(a=f.jsx(Ct,{sideOffset:vt,label:i,children:o?f.jsx("button",{onClick:()=>r("/c/".concat(n)),className:"flex items-center px-2 py-2 select-none",children:f.jsx(Ds,{})}):f.jsx(Yo,{asChild:!0,children:f.jsx("button",{className:"flex items-center px-2 py-2 select-none",disabled:s,children:f.jsx(Ds,{})})})}),e[1]=n,e[2]=s,e[3]=r,e[4]=o,e[5]=a):a=e[5],a}const El=Me(()=>ye(()=>import("./qrcm3utllwqs3zx5.js"),__vite__mapDeps([12,1])),{loading:t=>Ee(t)}),kl=Me(()=>ye(()=>import("./kaw18xu9jo85v1g9.js"),__vite__mapDeps([13,1])),{loading:t=>Ee(t)});function _l({content:t,clientThreadId:e,messageId:n,contentReferences:o}){const s=Et(),r=We(),i=Mn(),[a,l]=x.useState(!1),c=Xo();return{handleCopy:async d=>{if(a)return;Pt.logEventWithStatsig("ChatGPT Writing Block Copy Button Clicked","chatgpt_writing_block_copy_button_clicked",pe({},yn({clientThreadId:e,messageId:n}))),Ls.count(js.WRITING_BLOCKS,"chatgpt_writing_block_copy_button_clicked");const m=await ai(t,{preserveContentReferences:!0}),u=Zo(e);t!=null&&u!=null&&n!=null&&(Pt.logStructuredEvent(mr,{conversationId:u,messageId:n}),pr(s,{type:"copy",source:"mouse",location:"writing-block",selectedText:m,messageId:n,serverThreadId:u,contentType:"text"}));let h={"text/plain":m};try{h=ei(m,o)}catch(b){Vs.addError(b)}hr(h,i,d),l(!0),c(()=>l(!1),2e3)},Icon:a?kl:El,copyLabel:r.formatMessage({id:"D5UU6P",defaultMessage:"Copy"})}}function Sl(t){"use forget";const e=xe.c(8),{clientThreadId:n,messageId:o,content:s,contentReferences:r}=t;let i;e[0]!==n||e[1]!==s||e[2]!==r||e[3]!==o?(i={clientThreadId:n,messageId:o,content:s,contentReferences:r},e[0]=n,e[1]=s,e[2]=r,e[3]=o,e[4]=i):i=e[4];const{handleCopy:a}=_l(i);let l;e[5]===Symbol.for("react.memo_cache_sentinel")?(l=he(Kn,"font-normal","px-2 py-2"),e[5]=l):l=e[5];let c;return e[6]!==a?(c=f.jsx(xr,{onCopy:a,iconClassName:"icon-md",className:l,iconOnly:!0,tooltipSideOffset:vt}),e[6]=a,e[7]=c):c=e[7],c}const Il=Me(()=>ye(()=>import("./ab1lw28e5v4cdfgd.js"),__vite__mapDeps([14,1])),{loading:t=>Ee(t)}),Tl=Me(()=>ye(()=>import("./mvmwqt2pbedq2unu.js"),__vite__mapDeps([15,1])),{loading:t=>Ee(t)}),Os=Me(()=>ye(()=>import("./mgui3xyp27o5nkyv.js"),__vite__mapDeps([16,1])),{loading:t=>Ee(t)});function wl({serverThreadId:t,messageId:e,index:n,title:o}){const s=Mn(),r=We(),[i,a]=x.useState(!1),l=!Bs();if(!t)return null;const c=r.formatMessage({id:"writingblock.downloadFileError",defaultMessage:"Download failed. Please try again."});async function g(d){var m;a(!0);try{const u=await jn.safePost("/export_doc/writing_block",{requestBody:{conversation_id:t,message_id:e,index:n,export_type:d},skipJsonTransform:!0});u.ok||s.danger(c);const h=await u.blob(),b=u.headers.get("Content-Disposition"),D=(m=ci(b))!=null?m:"".concat((o!=null?o:"Export").replaceAll("/","-"),".").concat(d);li(h,D)}catch(u){Vs.addError(u,{tags:["type:writing_block_download_button","export_type:".concat(d)]}),s.danger(c)}finally{a(!1)}}return f.jsxs(Ke.Root,{children:[f.jsx(Ct,{sideOffset:vt,label:f.jsx(_e,{id:"WritingBlockDownloadButton.downloadTooltip",defaultMessage:"Download"}),children:f.jsx(Ke.BasicTrigger,{asChild:!0,children:f.jsx("button",{className:"flex items-center gap-1 px-2 py-2 select-none",disabled:i,children:l?i?f.jsx(us,{size:16}):f.jsx(Os,{className:"block"}):f.jsx("div",{className:he("flex items-center gap-1",Kn,"font-normal"),children:i?f.jsx(us,{size:20}):f.jsx(Os,{className:"block"})})})})}),f.jsx(Ke.Portal,{children:f.jsxs(Ke.Content,{align:"end",children:[f.jsx(Ke.Label,{children:f.jsx(_e,{id:"WritingBlockDownloadButton.menuTitle",defaultMessage:"Download"})}),f.jsx(Ke.Item,{onSelect:()=>{g("pdf")},icon:Il,label:r.formatMessage({id:"WritingBlockDownloadButton.downloadPdf.label",defaultMessage:"PDF document"}),trailing:f.jsx("span",{children:r.formatMessage({id:"WritingBlockDownloadButton.downloadPdf.ext",defaultMessage:".pdf"})})}),f.jsx(Ke.Item,{onSelect:()=>{g("docx")},icon:Tl,label:r.formatMessage({id:"WritingBlockDownloadButton.downloadDocx.label",defaultMessage:"Microsoft Word"}),trailing:f.jsx("span",{children:r.formatMessage({id:"WritingBlockDownloadButton.downloadDocx.ext",defaultMessage:".docx"})})})]})})]})}const Rl=Me(()=>ye(()=>import("./jjcc0i8g6768wslh.js"),__vite__mapDeps([17,1])),{loading:t=>Ee(t)});function Pl(t){"use forget";const e=xe.c(4),{isStreaming:n}=t;let o;e[0]===Symbol.for("react.memo_cache_sentinel")?(o=f.jsx(_e,{id:"WritingBlockExpandButton.expandTooltip",defaultMessage:"Expand"}),e[0]=o):o=e[0];let s;e[1]===Symbol.for("react.memo_cache_sentinel")?(s=f.jsx(Rl,{}),e[1]=s):s=e[1];let r;return e[2]!==n?(r=f.jsx(Ct,{sideOffset:vt,label:o,children:f.jsx(Qo,{asChild:!0,children:f.jsx("button",{className:"flex items-center px-2 py-2 select-none",disabled:n,children:s})})}),e[2]=n,e[3]=r):r=e[3],r}function Nl(t){"use forget";var h;const e=xe.c(11),{content:n}=t,o=Jo(),s=er(Cl),r=s==null?void 0:s.selectionIsEditable;let i;e[0]!==(s==null?void 0:s.selection)?(i=(h=s==null?void 0:s.selection)==null?void 0:h.trim(),e[0]=s==null?void 0:s.selection,e[1]=i):i=e[1];const a=!!i,l=!!r;let c;e[2]!==n||e[3]!==o?(c=()=>{o&&o.insertTextFromWebContent(n)},e[2]=n,e[3]=o,e[4]=c):c=e[4];const g=c;if(!o||r===null)return null;const d=!l;let m;e[5]!==a?(m=a?f.jsx(_e,{id:"SjFYnK",defaultMessage:"Update"}):f.jsx(_e,{id:"8SKT1J",defaultMessage:"Insert"}),e[5]=a,e[6]=m):m=e[6];let u;return e[7]!==g||e[8]!==d||e[9]!==m?(u=f.jsx(tr,{color:"secondary",type:"button",onClick:g,disabled:d,children:m}),e[7]=g,e[8]=d,e[9]=m,e[10]=u):u=e[10],u}function Cl(){return nr.context$()}const vl=Me(()=>ye(()=>import("./8yatsd42k1ox8n2w.js"),__vite__mapDeps([18,1])),{loading:t=>Ee(t)});function Dl({content:t,clientThreadId:e,title:n,messageId:o,messageRef:s}){const r=We(),i=br(e);function a(){yr.logButtonClick(Mr.OPEN_IN_CANVAS_WRITING_BLOCK),s.current&&Er(s.current);const l=kr.DOCUMENT;Pt.logEventWithStatsig("ChatGPT Writing Block Edit in Canvas Button Clicked","chatgpt_writing_block_edit_in_canvas_button_clicked",pe({},yn({clientThreadId:e,messageId:o}))),i({title:n!=null?n:r.formatMessage({id:"2V9CtJ",defaultMessage:"New document"}),textdocType:l,content:t,createSource:_r.MESSAGE_WRITING_BLOCK})}return f.jsx("button",{className:"flex items-center px-1.5 py-1 select-none",onClick:a,children:f.jsx(Ct,{label:f.jsx(_e,{id:"WritingBlockOpenCanvasButton.openTooltip",defaultMessage:"Edit in Canvas"}),children:f.jsx(vl,{className:"icon-md block"})})})}const Ol=Me(()=>ye(()=>import("./ncw8zw682jinppua.js").then(t=>t.yq),__vite__mapDeps([6,1,7])),{loading:t=>Ee(t)}),Al=t=>{"use forget";const e=xe.c(72),{primaryLabel:n,primaryAction:o,writingBlock:s,clientThreadId:r,messageId:i,isInlineWritingBlockExportEnabled:a,isWritingBlockFocusedModeEnabled:l,serverThreadId:c,shouldShowWritingBlockCanvasEdit:g,title:d,index:m,messageRef:u,autosaveStatus:h,hideDownloadButton:b,isInlineWritingBlockEditEnabled:D,contentReferences:S,focusMode:B,isStreaming:E,permalink:y}=t,k=b===void 0?!1:b,I=B===void 0?!1:B,M=Et(),v=We();let _;e[0]!==M?(_=()=>sr(M),e[0]=M,e[1]=_):_=e[1];const C=Ws(_),{eligible:F}=Sr(ls.hasSeenWritingInlineEditNux);let O;e[2]!==M?(O=bt(M,"2862575767"),e[2]=M,e[3]=O):O=e[3];const p=D&&F&&O;let T;e[4]!==M?(T=()=>{Ir(M,ls.hasSeenWritingInlineEditNux)},e[4]=M,e[5]=T):T=e[5];const R=T;let A;e[6]!==M?(A=bt(M,"1600402835"),e[6]=M,e[7]=A):A=e[7];let W;e[8]!==M?(W=bt(M,"3877999974"),e[8]=M,e[9]=W):W=e[9];const H=W,X=!1,Z="idle";let ne;e:{ne="text-token-text-primary/35";break e}const K=ne;let U;e[10]!==I||e[11]!==H||e[12]!==C||e[13]!==s?(U=!I&&C&&s.content.trim().length>0&&H,e[10]=I,e[11]=H,e[12]=C,e[13]=s,e[14]=U):U=e[14];const Q=U,G=I?"rounded-none":"rounded-t-[22px]",J=Q?"py-1.5 ps-3.5 pe-1.5":I?"py-2.5 ps-4.5 pe-3.5 sm:ps-5.5 sm:pe-3":"px-3.5 py-1.5 sm:ps-4.5 sm:pe-3.5";let P;e[15]!==G||e[16]!==J?(P=he(di,"flex w-full items-center justify-between gap-3 font-sans",G,J),e[15]=G,e[16]=J,e[17]=P):P=e[17];let q;e[18]!==R||e[19]!==v||e[20]!==p?(q=p&&f.jsx("div",{className:"absolute start-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:f.jsxs("div",{className:"flex items-center gap-2 rounded-lg bg-[#007AFF] px-2 py-1 text-xs font-semibold text-white shadow-[0_6px_16px_rgba(0,122,255,0.25)]","data-testid":"writing-inline-edit-nux",children:[f.jsx(_e,{id:"Ems9q5",defaultMessage:"Try editing your writing inline"}),f.jsx("button",{type:"button",onClick:R,className:"text-white transition hover:text-white/80 focus-visible:ring-2 focus-visible:ring-white/60 focus-visible:outline-none","aria-label":v.formatMessage({id:"VYV/z5",defaultMessage:"Dismiss inline edit tip"}),children:f.jsx(Ol,{className:"h-3.5 w-3.5","aria-hidden":!0})})]})}),e[18]=R,e[19]=v,e[20]=p,e[21]=q):q=e[21];let V;e[22]!==n?(V=n!=null?n:f.jsx(_e,{id:"Ui6xge",defaultMessage:"Writing"}),e[22]=n,e[23]=V):V=e[23];let oe;e[24]!==K||e[25]!==Z||e[26]!==X?(oe=X,e[24]=K,e[25]=Z,e[26]=X,e[27]=oe):oe=e[27];let le;e[28]!==V||e[29]!==oe?(le=f.jsxs("div",{className:"text-token-text-secondary dark:text-token-text-tertiary text-token-text-primary flex max-w-[75%] flex-grow cursor-default items-center gap-2 text-sm",children:[V,oe]}),e[28]=V,e[29]=oe,e[30]=le):le=e[30];let ce;e[31]!==r||e[32]!==S||e[33]!==i||e[34]!==s?(ce=r&&i&&f.jsx("div",{className:"text-token-text-secondary dark:text-token-text-tertiary dark:hover:text-token-text-primary hover:text-token-text-primary",children:f.jsx(Sl,{content:s.content,clientThreadId:r,messageId:i,contentReferences:S})}),e[31]=r,e[32]=S,e[33]=i,e[34]=s,e[35]=ce):ce=e[35];let re;e[36]!==k||e[37]!==m||e[38]!==a||e[39]!==i||e[40]!==c||e[41]!==d?(re=!k&&a&&c&&i&&f.jsx("div",{className:"text-token-text-secondary dark:text-token-text-tertiary dark:hover:text-token-text-primary hover:text-token-text-primary",children:f.jsx(wl,{serverThreadId:c,messageId:i,title:d,index:m})}),e[36]=k,e[37]=m,e[38]=a,e[39]=i,e[40]=c,e[41]=d,e[42]=re):re=e[42];let w;e[43]!==r||e[44]!==i||e[45]!==u||e[46]!==g||e[47]!==d||e[48]!==s?(w=r&&i&&g&&f.jsx("div",{className:"text-token-text-secondary dark:text-token-text-tertiary dark:hover:text-token-text-primary hover:text-token-text-primary",children:f.jsx(Dl,{content:s.content,clientThreadId:r,messageId:i,title:d,messageRef:u})}),e[43]=r,e[44]=i,e[45]=u,e[46]=g,e[47]=d,e[48]=s,e[49]=w):w=e[49];let j;e[50]!==Q||e[51]!==s?(j=Q&&f.jsx("div",{className:"text-token-text-secondary dark:text-token-text-tertiary dark:hover:text-token-text-primary hover:text-token-text-primary ps-2",children:f.jsx(Nl,{content:s.content})}),e[50]=Q,e[51]=s,e[52]=j):j=e[52];let $;e[53]!==r||e[54]!==I||e[55]!==E||e[56]!==l||e[57]!==i||e[58]!==y?($=r&&i&&l&&f.jsx("div",{className:he("text-token-text-secondary dark:text-token-text-tertiary",E&&"pointer-events-none",!E&&"dark:hover:text-token-text-primary hover:text-token-text-primary"),children:I?f.jsx(Ml,{clientThreadId:r,permalink:y,isStreaming:E}):f.jsx(Pl,{isStreaming:E})}),e[53]=r,e[54]=I,e[55]=E,e[56]=l,e[57]=i,e[58]=y,e[59]=$):$=e[59];let Y;e[60]!==o||e[61]!==ce||e[62]!==re||e[63]!==w||e[64]!==j||e[65]!==$?(Y=f.jsxs("div",{className:"flex items-center justify-between",children:[ce,re,w,o,j,$]}),e[60]=o,e[61]=ce,e[62]=re,e[63]=w,e[64]=j,e[65]=$,e[66]=Y):Y=e[66];let te;return e[67]!==P||e[68]!==q||e[69]!==le||e[70]!==Y?(te=f.jsx("div",{className:"thread-xl:-top-[var(--header-height)] sticky top-0 z-1 mx-[1px] rounded-t-[22px] rounded-b-lg backdrop-blur-md",children:f.jsxs("div",{className:P,children:[q,le,Y]})}),e[67]=P,e[68]=q,e[69]=le,e[70]=Y,e[71]=te):te=e[71],te};function uc(t){"use forget";const e=xe.c(33),{analyticsMetadata:n,primaryLabel:o,primaryAction:s,subHeader:r,showHeader:i,hasBeenEdited:a,autosaveStatus:l,clientThreadId:c,messageId:g,isInlineWritingBlockExportEnabled:d,isWritingBlockFocusedModeEnabled:m,serverThreadId:u,shouldShowWritingBlockCanvasEdit:h,title:b,index:D,messageRef:S,editorViewRef:B,isInlineWritingBlockEditEnabled:E,writingBlock:y,onChange:k,isStreaming:I,setDirty:M,flushPendingChanges:v,contentReferences:_,permalink:C}=t,F=i===void 0?!0:i;let O;e[0]!==l||e[1]!==c||e[2]!==_||e[3]!==a||e[4]!==D||e[5]!==E||e[6]!==d||e[7]!==m||e[8]!==g||e[9]!==S||e[10]!==C||e[11]!==s||e[12]!==o||e[13]!==u||e[14]!==h||e[15]!==F||e[16]!==b||e[17]!==y?(O=F&&f.jsx(Al,{primaryLabel:o,primaryAction:s,hasBeenEdited:a,autosaveStatus:l,writingBlock:y,clientThreadId:c,messageId:g,isInlineWritingBlockExportEnabled:d,isInlineWritingBlockEditEnabled:E,isWritingBlockFocusedModeEnabled:m,serverThreadId:u,shouldShowWritingBlockCanvasEdit:h,title:b,index:D,messageRef:S,contentReferences:_,focusMode:!0,hideDownloadButton:y.variant===Hn.EMAIL,permalink:C}),e[0]=l,e[1]=c,e[2]=_,e[3]=a,e[4]=D,e[5]=E,e[6]=d,e[7]=m,e[8]=g,e[9]=S,e[10]=C,e[11]=s,e[12]=o,e[13]=u,e[14]=h,e[15]=F,e[16]=b,e[17]=y,e[18]=O):O=e[18];let L;e[19]!==n||e[20]!==_||e[21]!==B||e[22]!==v||e[23]!==E||e[24]!==I||e[25]!==k||e[26]!==M||e[27]!==y?(L=f.jsx("div",{className:"flex-1 overflow-y-auto p-4 sm:p-10",children:f.jsx(yl,{editorViewRef:B,analyticsMetadata:n,setDirty:M,isInlineWritingBlockEditEnabled:E,writingBlock:y,onChange:k,isStreaming:I,flushPendingChanges:v,contentReferences:_})}),e[19]=n,e[20]=_,e[21]=B,e[22]=v,e[23]=E,e[24]=I,e[25]=k,e[26]=M,e[27]=y,e[28]=L):L=e[28];let p;return e[29]!==r||e[30]!==O||e[31]!==L?(p=f.jsxs("div",{className:"flex flex-1 flex-col overflow-y-auto",children:[O,r,L]}),e[29]=r,e[30]=O,e[31]=L,e[32]=p):p=e[32],p}export{gs as E,Hn as W,cc as a,lc as b,uc as c,Al as d,yl as e,ac as f,ic as g,rc as p,dc as u};
//# sourceMappingURL=mamq4h01m06sylys.js.map
