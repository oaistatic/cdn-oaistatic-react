const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/lm3g1zm00rp6al39.js","assets/bubexfvksfr7893o.js","assets/ncw8zw682jinppua.js","assets/root-ookb7xuw.css","assets/conversation-small-lq38g8zw.css","assets/cq2lsm09o48g3u0y.js","assets/fx4tif7av4x5mmpn.js","assets/dqr2pnjzr8j7emm5.js","assets/jx5pd8qsxc77tbjo.js"])))=>i.map(i=>d[i]);
var Z=Object.defineProperty,J=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var R=(e,s,n)=>s in e?Z(e,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[s]=n,_=(e,s)=>{for(var n in s||(s={}))L.call(s,n)&&R(e,n,s[n]);if(I)for(var n of I(s))F.call(s,n)&&R(e,n,s[n]);return e},N=(e,s)=>J(e,X(s));var b=(e,s)=>{var n={};for(var a in e)L.call(e,a)&&s.indexOf(a)<0&&(n[a]=e[a]);if(e!=null&&I)for(var a of I(e))s.indexOf(a)<0&&F.call(e,a)&&(n[a]=e[a]);return n};import{h as C,j as t,r as l,_ as x,M as P}from"./bubexfvksfr7893o.js";import{p3 as ee,cc as q,jq as te,c6 as se,p4 as ne,p5 as re,p6 as B,aH as $,Q as ae,p7 as ie,jL as le,p8 as oe,cq as ce,p9 as de}from"./lm3g1zm00rp6al39.js";import{C as ue,a as me,S as xe}from"./ovw8x8ulp3acd1l3.js";import{cz as w,d$ as U,dS as W,az as f,kP as T,aA as p,cr as fe,u as G,sS as D,jc as pe,M as he,V as ge,f3 as je,f7 as ye,p as _e,gn as V,f4 as Ne,l as be}from"./ncw8zw682jinppua.js";import"./fwwkwalw87hti22b.js";import"./fk5dn736y6oc9os0.js";import"./dgs0l83heankdts0.js";import"./od50gemg82u3x7jt.js";import"./lowm54usy4rzuo31.js";import"./l8gfdbxyfhb5crrj.js";import"./gwwqbtk9yto9dekb.js";import"./exx0m5g11hnp3j3d.js";import"./d9ec94om23qfz1v2.js";import"./luif5kl8klbqcpjy.js";function Me({label:e,tab:s,activeTab:n,setActiveTab:a,caterpillarHeaderRef:r}){const c=l.useCallback(()=>{a(s),r.current&&r.current.scrollIntoView({behavior:"instant",block:"center"})},[a,s,r]),o=n===s;return t.jsx("button",{onClick:c,className:w("btn text-token-text-primary min-h-[36px]! min-w-[100px] rounded-full px-2 py-1 select-none",o?"bg-token-main-surface-primary shadow-sm":"bg-token-main-surface-tertiary!"),children:e})}function Se({activeTab:e,setActiveTab:s,sourcesCount:n,showAuxTab:a=!1,caterpillarHeaderRef:r}){const c=C(),o=[{tab:"activity",label:c.formatMessage({id:"9lnBJU",defaultMessage:"Activity"})},{tab:"sources",label:n>1?c.formatMessage({id:"/Ucokx",defaultMessage:"{sourcesCount} Sources"},{sourcesCount:n}):n===1?c.formatMessage({id:"CCF0z+",defaultMessage:"1 Source"}):c.formatMessage({id:"twjHy3",defaultMessage:"Sources"})}];return a&&o.unshift({tab:"report",label:c.formatMessage({id:"zF7Fu5",defaultMessage:"Report"})}),t.jsx("div",{className:w("border-token-main-surface-tertiary bg-token-main-surface-tertiary flex items-center rounded-full border-[4px] transition-all"),children:o.map(({tab:u,label:d})=>t.jsx(Me,{activeTab:e,tab:u,setActiveTab:s,label:d,caterpillarHeaderRef:r},u))})}const E=({children:e,icon:s,fillIcon:n,className:a})=>t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx("div",{className:w("mt-[3px] inline-flex h-5 w-5 shrink-0 items-center justify-center gap-2.5 rounded-[30px]",n&&"border border-black/10 bg-white",a),children:s}),e]}),we=f(()=>x(()=>import("./lm3g1zm00rp6al39.js").then(e=>e.zl),__vite__mapDeps([0,1,2,3,4])),{loading:e=>p(e)}),ve=f(()=>x(()=>import("./cq2lsm09o48g3u0y.js"),__vite__mapDeps([5,1])),{loading:e=>p(e)}),Ie=f(()=>x(()=>import("./lm3g1zm00rp6al39.js").then(e=>e.zq),__vite__mapDeps([0,1,2,3,4])),{loading:e=>p(e)}),Ee=f(()=>x(()=>import("./fx4tif7av4x5mmpn.js"),__vite__mapDeps([6,1])),{loading:e=>p(e)});function M({icon:e,message:s,iconClassName:n}){return t.jsx("div",{className:"loading-shimmer-pure-text flex h-8 gap-1 overflow-hidden",children:t.jsx(E,{fillIcon:!1,icon:e,className:n,children:t.jsx("div",{className:"mt-[.5px] flex h-10",children:s})})})}const ke=({finalRow:e})=>{var a;const s=C(),n=e.type==="fileOpen"?(a=ee[e.iconType])!=null?a:Ee:null;return t.jsx(U,{children:t.jsx(W.div,{layout:!0,transition:{type:"spring",stiffness:300,damping:30},className:"flex flex-col items-start justify-start gap-4",children:e.type==="search"?t.jsx(M,{icon:t.jsx(we,{className:"text-token-text-primary relative h-5 w-5 opacity-50"}),message:s.formatMessage({id:"f9wsyE",defaultMessage:"Searching…"})}):e.type==="websiteOpen"?t.jsx(M,{icon:t.jsx(Ie,{className:"inline-flex h-5 w-5 items-center justify-center opacity-50"}),message:s.formatMessage({id:"8L6BBp",defaultMessage:"Reading…"})}):e.type==="fileOpen"?t.jsx(M,{icon:t.jsx(n,{className:"inline-flex h-5 w-5 items-center justify-center opacity-50"}),message:s.formatMessage({id:"h5M4/O",defaultMessage:"Reading file…"})}):e.type==="pythonAnalysis"?t.jsx(M,{icon:t.jsx(ve,{className:"inline-flex h-5 w-5 items-center justify-center opacity-50"}),message:s.formatMessage({id:"jZ7gNw",defaultMessage:"Analyzing…"})}):t.jsx(M,{icon:t.jsx(T,{className:"inline-flex h-5 w-5 items-center justify-center opacity-50"}),message:s.formatMessage({id:"bSPYmC",defaultMessage:"Thinking…"})})})})},Ae=f(()=>x(()=>import("./cq2lsm09o48g3u0y.js"),__vite__mapDeps([5,1])),{loading:e=>p(e)}),Ce=({children:e})=>t.jsxs("div",{className:"flex items-start gap-2 text-start text-wrap",children:[t.jsx("div",{className:"mt-[1px] inline-flex h-5 w-5 shrink-0 items-center justify-end gap-2.5 pt-[3px]",children:t.jsx(Ae,{className:"text-token-text-primary relative h-5 w-5"})}),e]}),Te=({row:e})=>t.jsx(Ce,{children:t.jsx("div",{className:"text-token-text-primary flex text-base",children:e.analysisSummary})}),Oe=f(()=>x(()=>import("./lm3g1zm00rp6al39.js").then(e=>e.zl),__vite__mapDeps([0,1,2,3,4])),{loading:e=>p(e)}),Re=({children:e,showIcon:s})=>t.jsxs("div",{className:"flex items-start gap-2 text-start text-wrap",children:[t.jsx("div",{className:"mt-[1px] inline-flex h-5 w-5 shrink-0 items-center justify-end gap-2.5 pt-[3px]",children:s&&t.jsx(Oe,{className:"text-token-text-primary relative h-5 w-5"})}),e]}),Le=({row:e,showIcon:s})=>{const n=e.query;return n?t.jsx(Re,{showIcon:s,children:t.jsx("div",{className:"text-token-text-primary flex text-base",children:n})}):null};function Fe({children:e,showIcon:s=!0}){return t.jsx(E,{fillIcon:!1,icon:s?t.jsx(T,{className:"text-token-text-primary inline-flex h-5 w-5 items-center justify-center"}):null,children:e})}const Pe={strong:e=>{const r=e,{node:s,children:n}=r,a=b(r,["node","children"]);return t.jsx("strong",N(_({},a),{className:w(a.className,"text-token-text-primary font-semibold"),children:n}))},p:e=>{const r=e,{node:s,children:n}=r,a=b(r,["node","children"]);return t.jsx("p",N(_({},a),{className:w(a.className,"mb-0! text-base"),children:n}))}};function De(e){return e.replace(/^#+\s*.*$/gm,"").replace(/^\*\*.*\*\*$/gm,"").trim()}function Ve({row:e,showIcon:s=!0}){const n=e.summary;if(!n)return null;const a=De(n);return a.length===0?null:t.jsx(Fe,{showIcon:s,children:t.jsx(q,{componentOverrides:Pe,className:"w-0! flex-1 leading-6",children:a})})}const ze=f(()=>x(()=>import("./dqr2pnjzr8j7emm5.js"),__vite__mapDeps([7,1])),{loading:e=>p(e)});function qe(e){try{const{hostname:s}=new URL(e);return s}catch(s){return null}}const Be={p:e=>{const r=e,{node:s,children:n}=r,a=b(r,["node","children"]);return t.jsx("p",N(_({},a),{className:"text-token-text-primary text-start text-base",children:n}))},a:e=>{const r=e,{node:s,children:n}=r,a=b(r,["node","children"]);return t.jsx("a",N(_({},a),{className:"text-blue! text-base leading-6",children:n}))}},$e=({website:e})=>{const s=qe(e.url);return s?t.jsxs("div",{className:"flex items-start justify-start gap-2",children:[t.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",children:t.jsx(fe,{label:s,className:"bg-token-main-surface-primary mt-[3px] flex h-5 w-5 shrink-0 cursor-pointer items-center justify-center",children:t.jsx(te,{url:e.url,size:"xsmall",className:"h-5 w-5",fallback:t.jsx(se,{url:e.url,className:"h-5 w-5 rounded-2xl border-[.5px] border-black/25",fallback:t.jsx(ze,{className:"icon-sm text-token-text-quaternary"})})})})}),t.jsx("div",{className:"text-token-text-primary mt-[1px] flex flex-col text-base",children:t.jsx(q,{componentOverrides:Be,children:e.rowText})})]}):null};function S({children:e}){return t.jsx(W.div,{className:"w-full",initial:{opacity:0},animate:{opacity:1},transition:{duration:1},children:e})}const Ue=({previousRow:e,currentRow:s})=>t.jsx("div",{className:"flex flex-col items-start justify-start gap-4",children:s.type==="search"?t.jsx(S,{children:t.jsx(Le,{row:s,showIcon:!e||e.type!=="search"})},"search_".concat(s.id)):s.type==="summary"?t.jsx(S,{children:t.jsx(Ve,{row:s,showIcon:!e||e.type!=="summary"})},"summary_".concat(s.id)):s.type==="websiteOpen"?t.jsx(S,{children:t.jsx($e,{website:s})},"website_".concat(s.id)):s.type==="fileOpen"?t.jsx(S,{children:t.jsx(ne,{row:s})},"file_".concat(s.id)):s.type==="pythonAnalysis"?t.jsx(S,{children:t.jsx(Te,{row:s})},"python_".concat(s.id)):null}),We=f(()=>x(()=>import("./jx5pd8qsxc77tbjo.js"),__vite__mapDeps([8,1])),{loading:e=>p(e)}),Ge=120,He=1e3*60*2;function z(e){e==null||e.scrollIntoView({block:"center",behavior:"smooth"})}function Ye({caterpillarStatusMessageTexts:e}){return t.jsx("div",{className:"p-4",children:t.jsx($,{type:"error",title:e.failureMessage,content:e.failureBannerContentMessage})})}function Ke({caterpillarStatusMessageTexts:e}){return t.jsx("div",{className:"p-4",children:t.jsx($,{title:e.cancelledMessage,content:""})})}function Qe({sourcesCount:e,taskInfo:s}){const n=he(s.originalConversationId,r=>{var c,o;return(o=(c=ge.findNode(r,u=>{var d,i;return((d=u.message.metadata)==null?void 0:d.b1de6e2_s)===!0&&((i=u.message.metadata)==null?void 0:i.async_task_id)===s.taskId}))==null?void 0:c.message.metadata)==null?void 0:o.async_task_status_messages}),a=l.useMemo(()=>{var r;return n!=null&&n.completed_no_time?t.jsxs(t.Fragment,{children:[(r=n==null?void 0:n.completed_with_time)!=null?r:n==null?void 0:n.completed_no_time,t.jsx(P,{id:"zxfmo/",defaultMessage:" · {sourcesCount} sources",values:{sourcesCount:e}})]}):t.jsx(P,{id:"YG7a0T",defaultMessage:"Completed · {sourcesCount} sources",values:{sourcesCount:e}})},[e,n]);return!s.updatedAt&&!(n!=null&&n.completed)?null:t.jsx(E,{icon:t.jsx(We,{className:"text-token-text-secondary"}),fillIcon:!1,children:t.jsx("div",{className:"text-token-text-tertiary",children:a})})}function Ze({taskInfo:e,caterpillarStatusMessageTexts:s,sourcesCount:n,caterpillarHeaderRef:a}){const r=G(),[c,o]=l.useState(!1),u=l.useRef(!1),d=l.useRef(null),i=l.useMemo(()=>{var m;return u.current=!!d.current&&re(d.current,Ge),(m=e.rows)!=null?m:[]},[e.rows]);l.useEffect(()=>{if(i.length===0){const m=new Date(e.createdAt).getTime(),g=Date.now()-m,v=He-g;if(v>0){const A=setTimeout(()=>{o(!0)},v);return()=>clearTimeout(A)}else o(!0)}else o(!1)},[i,e.createdAt]),l.useEffect(()=>{u.current&&z(d.current)},[i]),l.useEffect(()=>{D(e)||setTimeout(()=>{d.current&&z(d.current)},100)},[]);const h=D(e)||pe(e),y=B(r),k=l.useMemo(()=>i.length&&!h&&!y?i.slice(0,i.length-1):i,[i,h,y]);return t.jsxs("div",{className:"flex flex-col",children:[t.jsx("div",{ref:a},"task-header"),t.jsxs("div",{className:"flex w-full flex-col gap-4",children:[t.jsx("div",{className:"text-base font-medium",children:e.title}),i.length?t.jsxs(U,{initial:!1,children:[k.map((m,g)=>t.jsx(Ue,{previousRow:g>0?i[g-1]:null,currentRow:m},m.id)),!h&&t.jsx(ke,{finalRow:i[i.length-1]})]}):c?t.jsx(E,{fillIcon:!1,icon:t.jsx(T,{className:"text-token-text-primary inline-flex h-5 w-5 items-center justify-center"}),children:s.waitingInQueueMessage}):t.jsx(ue,{}),e.status==="failed"?t.jsx(Ye,{caterpillarStatusMessageTexts:s}):e.status==="cancelled"?t.jsx(Ke,{caterpillarStatusMessageTexts:s}):e.status==="completed"?t.jsx(Qe,{caterpillarStatusMessageTexts:s,taskInfo:e,sourcesCount:n}):null]}),t.jsx("div",{ref:d},"task-footer")]})}function xt({taskId:e,setWidth:s=void 0,initialTab:n}){const a=G(),r=je(j=>ye.getTask(e,j)),{closeThreadSidebar:c}=ae(),[o,u]=l.useState(n),d=ie(),i=l.useRef(null),h=!1;l.useEffect(()=>{u(n)},[n]),l.useEffect(()=>{},[r==null?void 0:r.taskId,r==null?void 0:r.status,h]),l.useEffect(()=>{},[r==null?void 0:r.taskId,r==null?void 0:r.status,o]),l.useEffect(()=>{},[s,r,h]);const y=C(),k=_e(),m=B(a),g=le({taskId:r==null?void 0:r.taskId,intl:y,toaster:k}),v=()=>g.mutate(),A=()=>{r&&be(r.originalConversationId,j=>{j.steeringAsyncTaskId=r.taskId})},{uniqueSources:H,totalSources:O}=l.useMemo(()=>{if(!(r!=null&&r.rows))return{uniqueSources:[],totalSources:0};const j=oe(r.rows),Y=j.reduce((K,Q)=>K+Q.count,0);return{uniqueSources:j,totalSources:Y}},[r==null?void 0:r.rows]);return t.jsx(ce,{ariaLabel:y.formatMessage({id:"region.sidebar.caterpillar",defaultMessage:"Tasks"}),handleClose:c,trailing:r&&m&&V(r)&&t.jsx(xe,{onAddContext:A,onStopTask:v,taskIsFinalizing:r.status===Ne.FINALIZING}),leading:t.jsx("div",{className:"flex w-full justify-center",children:t.jsx(Se,{activeTab:o,setActiveTab:u,showAuxTab:h,sourcesCount:O,caterpillarHeaderRef:i})}),children:r&&t.jsxs(me,{children:[!1,o==="activity"&&t.jsx(Ze,{taskInfo:r,caterpillarStatusMessageTexts:d,sourcesCount:O,caterpillarHeaderRef:i}),o==="sources"&&t.jsx(de,{taskIsPending:V(r),finalMessage:r.finalMessage,sources:H,caterpillarHeaderRef:i})]})})}export{xt as CaterpillarSidebar};
//# sourceMappingURL=zu3269wspbb4ktty.js.map
