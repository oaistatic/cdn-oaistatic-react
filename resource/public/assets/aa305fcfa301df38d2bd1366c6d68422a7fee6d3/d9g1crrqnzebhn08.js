const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ik745cxla2tb9irm.js","assets/bubexfvksfr7893o.js"])))=>i.map(i=>d[i]);
import{c as b,_ as $,j as s,h as R,r as M,i as I}from"./bubexfvksfr7893o.js";import{bT as A,bO as F,x as _}from"./lm3g1zm00rp6al39.js";import{az as T,u as z,eX as k,aC as O,e7 as B,dc as D,aA as L,bf as Y,W as q}from"./ncw8zw682jinppua.js";const K=T(()=>$(()=>import("./ik745cxla2tb9irm.js"),__vite__mapDeps([0,1])),{loading:o=>L(o)});function W({accountUserId:o,onClose:e}){"use no forget";var v,P,j,C;const i=z(),t=A(o),r=F(i),n=R(),p=M.useRef(null),l=Z(),a=H({accountUserId:o,calpicoState:r,onClose:e}),[u,g]=M.useState((v=t==null?void 0:t.name)!=null?v:""),[f,y]=M.useState((P=t==null?void 0:t.username)!=null?P:"");if(t==null)return null;const m=l.isPending,d=()=>{m||a.isPending||(a.error!=null&&a.reset(),a.mutate({currentDisplayName:t.name,currentUsername:t.username,nextDisplayName:u,nextUsername:f}))},E=a.error?(j=k(a.error))!=null?j:n.formatMessage({id:"HTYGke",defaultMessage:"We couldn't save your changes. Please try again."}):null,x=l.error?(C=k(l.error))!=null?C:n.formatMessage({id:"PrR4bZ",defaultMessage:"We couldn't update your profile photo. Please try again."}):null,N=x!=null?x:E;return s.jsx(O,{testId:"modal-edit-profile",isOpen:!0,onClose:()=>e(),type:"success",title:n.formatMessage({id:"sKwZJs",defaultMessage:"Edit profile"}),primaryButton:s.jsx(D.Button,{title:n.formatMessage({id:"I3Re7M",defaultMessage:"Save"}),color:"primary",disabled:u.length===0||f.length===0||a.isPending||m,onClick:()=>{d()},"data-testid":"save-profile-button"}),secondaryButton:s.jsx(D.Button,{title:n.formatMessage({id:"Q0/l4j",defaultMessage:"Cancel"}),color:"secondary",onClick:()=>e()}),children:s.jsxs("form",{className:"flex flex-col",onSubmit:c=>{c.preventDefault(),d()},children:[s.jsxs("div",{className:"flex flex-col items-center py-6",children:[s.jsx("div",{className:"mb-1",children:s.jsxs("button",{type:"button",className:"hover:bg-tertiary relative -m-1 rounded-full p-1",disabled:m,"aria-label":n.formatMessage({id:"oMMvTw",defaultMessage:"Update profile photo"}),"aria-busy":m,onClick:()=>{var c;(c=p.current)==null||c.click()},children:[s.jsx("img",{src:t.avatarUrl,alt:t.name,className:"gizmo-shadow-stroke h-32 w-32 rounded-full object-cover"}),s.jsx("div",{className:"absolute end-0 bottom-0 -translate-x-1/3 -translate-y-1/3",children:s.jsx("div",{className:"bg-token-interactive-bg-tertiary-default gizmo-shadow-stroke flex h-7 w-7 items-center justify-center rounded-full",children:m?s.jsx(B,{className:"icon-sm"}):s.jsx(K,{className:"text-token-text-secondary h-4.5 w-4.5"})})})]})}),s.jsx("input",{ref:p,type:"file",className:"sr-only",accept:"image/png,image/jpeg,image/webp,image/gif",onChange:async c=>{var U;const h=c.currentTarget,w=(U=h.files)==null?void 0:U[0];if(w==null){h.value="";return}l.error!=null&&l.reset();try{await l.mutateAsync({imageFile:w,updateProfileMutator:async({profileAssetPointer:S})=>{await r.updateSelfProfile$({profile_asset_pointer:S})}})}catch(S){}finally{h.value=""}}})]}),s.jsx(_,{displayName:n.formatMessage({id:"50qkqk",defaultMessage:"Display name"}),className:"my-1 px-3 py-2",inputClassName:"bg-token-bg-primary!",displayNameLabelClassName:"font-normal!",name:"display-name",type:"text",value:u,placeholder:t.name,autoComplete:"off","data-1p-ignore":!0,onChange:c=>{g(c.currentTarget.value),a.error!=null&&a.reset()}}),s.jsx(_,{displayName:n.formatMessage({id:"+hY83m",defaultMessage:"Username"}),className:"my-1 px-3 py-2",inputClassName:"bg-token-bg-primary!",displayNameLabelClassName:"font-normal!",name:"username",type:"text",value:f,placeholder:t.username,autoComplete:"off","data-1p-ignore":!0,onChange:c=>{y(c.currentTarget.value),a.error!=null&&a.reset()}}),N?s.jsx("p",{className:"text-interactive-label-warning-secondary mt-2 text-center text-xs",children:N}):null,s.jsx("p",{className:"text-token-text-tertiary mt-2 text-center text-xs",children:n.formatMessage({id:"4mADOv",defaultMessage:"Your profile helps people recognize you. Your name and username are also used in the Sora app."})})]})})}function H(o){"use forget";const e=b.c(11),{accountUserId:i,calpicoState:t,onClose:r}=o;let n;e[0]!==t?(n=async g=>{const{currentDisplayName:f,currentUsername:y,nextDisplayName:m,nextUsername:d}=g;d!==y&&await t.updateSelfUsername$({username:d}),m!==f&&await t.updateSelfProfile$({display_name:m})},e[0]=t,e[1]=n):n=e[1];const p=n;let l;e[2]!==i?(l=["calpico","profile","update",i],e[2]=i,e[3]=l):l=e[3];let a;e[4]!==t||e[5]!==r?(a=()=>{t.setUserOnboardingCompletion$(),r()},e[4]=t,e[5]=r,e[6]=a):a=e[6];let u;return e[7]!==p||e[8]!==l||e[9]!==a?(u={mutationKey:l,mutationFn:p,onSuccess:a},e[7]=p,e[8]=l,e[9]=a,e[10]=u):u=e[10],I(u)}function Z(){"use forget";const o=b.c(1);let e;return o[0]===Symbol.for("react.memo_cache_sentinel")?(e={mutationKey:["calpico","profile-photo-upload"],mutationFn:G},o[0]=e):e=o[0],I(e)}async function G(o){const{imageFile:e,updateProfileMutator:i}=o,t=new FormData;t.append("file",e,e.name);const r=await Y.post("".concat(q,"/calpico/chatgpt/profile_files"),t);if(r==null)return;const{asset_pointer:n}=r;await i({profileAssetPointer:n})}function X(o){"use forget";const e=b.c(3),{accountUserId:i,onClose:t}=o;let r;return e[0]!==i||e[1]!==t?(r=s.jsx(W,{accountUserId:i,onClose:t}),e[0]=i,e[1]=t,e[2]=r):r=e[2],r}export{X as CalpicoEditProfileModal};
//# sourceMappingURL=d9g1crrqnzebhn08.js.map
