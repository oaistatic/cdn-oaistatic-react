import{r as L,j as l}from"./bubexfvksfr7893o.js";import{C as U}from"./e2mpe7c8xvk51w5d.js";import{D as Q}from"./bo0p7vuujjmng48f.js";import{u as X,i as Z,C as $,g as y}from"./ba1u0o49onpmd3kx.js";import{C as z,T as tt}from"./fuwv2o9dqpty536z.js";import{C as k}from"./eii6zxu7kogjx11x.js";import{a as ot,b as et,c as rt,d as M}from"./imbbtedzs51am1ck.js";import{C as nt}from"./ce3hgmw4iyyhicud.js";import{T as it,A as P}from"./kzvpseqfc0j2fpii.js";import{T as st}from"./cifdjmblsrwrxxb4.js";import{b as lt,fc as ct,aY as R,lU as mt}from"./lm3g1zm00rp6al39.js";import{bl as at,u as ut}from"./ncw8zw682jinppua.js";import{u as dt}from"./m214aojas5i8u5ss.js";import{C as pt}from"./oumcmu9jw5n6nb3o.js";import"./ecforv0kxuh5qyzb.js";import"./o66elomacusdy99v.js";import"./mj32z5vcfl3ugvj5.js";import"./o4w8zbrq7mg3p422.js";import"./ns51nblw8ziscsgd.js";import"./i6hdqng3ufj5kq75.js";import"./cx20kzi1ifz7iwh5.js";import"./eewckg9c92mnp2ec.js";import"./l4pcm542yc2tenou.js";import"./mstl8wgfzorpgdoe.js";import"./e9acc0j1u83xdcvx.js";import"./kfdkis1zwf4ccfgg.js";import"./ol9d5wxhynx9q2is.js";import"./mbmcx8v24u1ao1ke.js";import"./orkdsokm67upvzbu.js";import"./deakbbf27g8e7ba0.js";import"./cdu988xkidlznefj.js";import"./kl7c6054usfnqmd4.js";import"./k97n0y6ba9c9h39c.js";import"./eg96d9s49vx4uh5w.js";import"./ffvjxtmoqooghm1t.js";import"./eqqsnl6kprwt6kvn.js";function ft(t,o){const s=t.doc.lineAt(o.from);return o.from===s.from&&o.to-1===s.to}function Ct(t){const o=t.dom.querySelector(".cm-gutters");return o?o.offsetWidth:0}const gt=({onAddComment:t,isSendDisabled:o=!1,isWaitingForCommentResponse:s=!1})=>{const n=ot(),p=et(),e=rt(),O=L.useCallback(r=>{const{height:i,width:u}=r,c=n();if(!p||!c)return null;const m=p.selection.asSingle();if(m.ranges.length===0)return null;const a=m.ranges[0],{empty:H,to:v}=a;let{head:C}=a;const{platform:I}=lt();C=I==="web"?C:v;const g=C===v;let w=C;if(g&&ft(p,a)&&(w-=1),H)return null;const{left:h,top:A,bottom:N}=c.contentDOM.getBoundingClientRect(),{left:W,top:_,bottom:b}=at(c.coordsAtPos(w,g?-1:1)),E=Ct(c);function G(){if(g)return Math.max(W-h+E-u,E);let f=W-h+E;return f+u>e&&(f=-(u-e)),f}function j(f){const S=i*2,B=f.contentHeight-(b-N)>S&&window.innerHeight-b>S,V=b-A+8,x=_-A-i-8;return g&&B||x<0?{top:V,aboveOrBelow:P.BELOW}:{top:x,aboveOrBelow:P.ABOVE}}const T=j(c);return{left:G(),top:T.top,aboveOrBelow:T.aboveOrBelow,toolbarSize:r}},[p,n,e]),D=L.useCallback(()=>{var r,i;return(i=(r=n())==null?void 0:r.dom)!=null?i:null},[n]);return l.jsx(it,{onAddComment:t,isWaitingForCommentResponse:s,isSendDisabled:o,toolbarType:st.CODE,getToolbarPosition:O,getEditorDom:D,getSelectionRange:()=>{const r=n();if(!r)return null;const{state:i}=r,u=i.selection.asSingle();if(u.ranges.length===0)return null;const c=u.ranges[0],{from:m,to:a}=c;return m==null||a==null?null:{from:m,to:a,sourceFrom:m,sourceTo:a}}})};function ht({diff:t}){var o;return X((o=t==null?void 0:t.edits)!=null?o:[]),null}function Et(t,o,s){const n=s?y():0;return t<=1e3-n?t-(o?z:0):t-(o?tt:0)}const oo=({comments:t,currentlyStreamingLineIndex:o,isPreview:s=!1,isWaitingForCommentResponse:n=!1,isSendDisabled:p=!1,readonlyReason:e,isRequestActive:O=!1,language:D,value:r,textdocDiff:i,maxLength:u,onAcceleratorsExpandedChange:c,onAddComment:m,onAcceptComment:a,onDismissComment:H,onBlur:v,onSave:C,onChange:I,onCancelRequest:g,getStableCommentId:w=mt,commentsMode:h=k.ENABLED,hideToolbar:A,hideAccelerators:N=!1,onSubmitAccelerator:W,modelCursor:_,codemirrorRef:b})=>{var F;const E=L.useRef(null),G=ut(),j=ct(G),[{width:T},f]=dt(),S=L.useRef(null),B=t.length>0,V=S.current,x=Et(T,B,(F=Z(V))!=null?F:!1),Y=M(({commentingOn:d})=>d),q=M(({hoveredCommentId:d})=>d),J=M(({focusedCommentId:d})=>d);L.useEffect(()=>{var d;(d=E.current)==null||d.UNSAFE_setValue(r||"")},[r]);const K=T-x;return l.jsx("div",{className:nt.code,ref:R(f,S),style:j&&s?{margin:"0 16px"}:{},children:l.jsxs(U,{id:"codemirror",comments:h===k.ALL_HIDDEN?void 0:t,commentingOn:Y,currentlyStreamingLineIndex:o,hoveredCommentId:q,focusedCommentId:J,language:D,readonlyReason:e,onChange:I,maxLength:u,value:r,textdocDiff:i,editorRef:R(E,b),width:x,modelCursor:_,isPreview:s,hideLineNumbers:j&&s,onBlur:v,onSave:C,children:[l.jsxs(U.EditorChildren,{children:[!A&&l.jsx(gt,{onAddComment:m,isSendDisabled:p,isWaitingForCommentResponse:n}),h!==k.ALL_HIDDEN&&l.jsx("div",{className:B?"me-4":"",children:l.jsx($,{getStableCommentId:w,availableWidth:K,comments:t,commentsMode:h,onAddComment:m,onAcceptComment:a,onDismissComment:H,isWaitingForCommentResponse:n,isRequestActive:O,disableBlockComments:!0})})]}),l.jsxs(U.ContextChildren,{children:[i&&l.jsx(ht,{diff:i}),!N&&l.jsx(Q,{isRequestActive:O,isVisuallyHidden:p||!!(e!=null&&e.isStreamingFromNative)||(e==null?void 0:e.isReadonly)&&!e.isStreaming,onSubmit:W,onCancel:g,actions:pt,onExpandedChange:c})]})]})})};export{oo as CodeComposer};
//# sourceMappingURL=d1smcjt0gndyvbhy.js.map
