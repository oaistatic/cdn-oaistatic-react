var ee=Object.defineProperty,te=Object.defineProperties;var ne=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var K=(e,t,n)=>t in e?ee(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,C=(e,t)=>{for(var n in t||(t={}))L.call(t,n)&&K(e,n,t[n]);if(O)for(var n of O(t))Q.call(t,n)&&K(e,n,t[n]);return e},X=(e,t)=>te(e,ne(t));var Z=(e,t)=>{var n={};for(var i in e)L.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&O)for(var i of O(e))t.indexOf(i)<0&&Q.call(e,i)&&(n[i]=e[i]);return n};import{aw as N,j as ie,oT as oe,O as re,n as se,ay as U,aa as ae}from"./ncw8zw682jinppua.js";import{c3 as de,c0 as p,c9 as ce}from"./lm3g1zm00rp6al39.js";import{e as ue,v as fe}from"./bubexfvksfr7893o.js";const h=ue({starting:{id:"jitPluginMessage.starting",defaultMessage:"Starting action"},confirmingSimple:{id:"jitPluginMessage.confirming.simple",defaultMessage:"{gizmoName} wants to talk to {domain}"},confirmingSubtitle:{id:"jitPluginMessage.confirming.subtitle",defaultMessage:"Only allow sites you trust."},running:{id:"jitPluginMessage.runningV4",defaultMessage:"Talking to {domain}"},finished:{id:"jitPluginMessage.finishedV4",defaultMessage:"Talked to {domain}"},stopped:{id:"jitPluginMessage.stoppedV4",defaultMessage:"Stopped talking to {domain}"},error:{id:"jitPluginMessage.errorV5",defaultMessage:"Error talking to {domain}"},declined:{id:"jitPluginMessage.declined",defaultMessage:"You declined this action"},allowed:{id:"jitPluginMessage.allowed",defaultMessage:"You allowed this action"},ranTest:{id:"jitPluginMessage.ranTest",defaultMessage:"Tested {operationName}"},confirmParamsTitle:{id:"jitPluginMessage.confirmParamsTitleV3",defaultMessage:"{gizmoName} wants to share this info with {domain}"},sentParamsTitle:{id:"jitPluginMessage.sentParamsTitleV2",defaultMessage:"{gizmoName} sent this info to {domain}"},privacyPolicyLink:{id:"jitPluginMessage.privacyPolicyLinkV2",defaultMessage:"Privacy policy"},connectorDeclined:{id:"jitPluginMessage.connectorDeclined",defaultMessage:"Declined connection to {domain}"},rememberForThisConversation:{id:"jitPluginMessage.rememberForThisConversation",defaultMessage:"Remember for this conversation"},allow:{id:"jitPluginMessage.allow",defaultMessage:"Allow"},allowing:{id:"jitPluginMessage.allowing",defaultMessage:"Allowingâ€¦"}});var f=(e=>(e[e.Running=0]="Running",e[e.Finished=1]="Finished",e[e.Error=2]="Error",e[e.Stopped=3]="Stopped",e[e.OauthLogin=4]="OauthLogin",e[e.NoAuthLink=5]="NoAuthLink",e[e.UserConfirmation=6]="UserConfirmation",e[e.Denied=7]="Denied",e[e.Hidden=8]="Hidden",e[e.Allowed=9]="Allowed",e))(f||{});const le=e=>{const[t,...n]=e,i=n.filter(m=>m.author.role===U.Tool),o=i.filter(m=>{var d,s,_;return((_=(s=(d=m.metadata)==null?void 0:d.jit_plugin_data)==null?void 0:s.from_server)==null?void 0:_.type)==="debug"}),r=i.filter(m=>!["debug","send_test"].some(d=>{var s,_,v;return d===((v=(_=(s=m.metadata)==null?void 0:s.jit_plugin_data)==null?void 0:_.from_server)==null?void 0:v.type)})),a=i[i.length-1];return{assistantMessage:t,toolMessages:i,debugMessages:o,actionableMessages:r,lastToolMessage:a}},$=new WeakMap,z=e=>{const t=$.get(e);if(t)return t;const n=le(e);return $.set(e,n),n};function me(e){if(e&&"user_action"in e){const t=e.user_action;e=C(C({},e),t.data),"target_message_id"in e&&t.target_message_id&&(e.target_message_id=t.target_message_id)}return e}function F(e,t){var n,i,o,r;return((n=e==null?void 0:e.from_server)==null?void 0:n.type)==="confirm_action"?(o=(i=e==null?void 0:e.from_server)==null?void 0:i.body)==null?void 0:o.operation:(r=t==null?void 0:t.parsed_function_call)==null?void 0:r.name}function we(e,t){var r,a;const{jitPluginData:n,invokedPlugin:i,lastConfirmActionJitPluginData:o}=E(e,t);return(a=(r=F(n,i))!=null?r:F(o,void 0))!=null?a:""}function je(e,t){var n,i,o,r;return((n=e==null?void 0:e.from_server)==null?void 0:n.type)==="confirm_action"?(o=(i=e==null?void 0:e.from_server)==null?void 0:i.body)==null?void 0:o.params:(r=t==null?void 0:t.parsed_function_call)==null?void 0:r.kwargs}function E(e,t){var r,a,m,d,s,_,v,y,A,k,w,j,S,b,M,R,V,q,x,H,W;const{assistantMessage:n,actionableMessages:i}=z(e);let o;for(let g=i.length-1;g>=0;g--){const c=(r=i[g].metadata)==null?void 0:r.jit_plugin_data;if(((a=c==null?void 0:c.from_server)==null?void 0:a.type)==="confirm_action"){o=c;break}}if(((s=(d=(m=n.metadata)==null?void 0:m.jit_plugin_data)==null?void 0:d.from_server)==null?void 0:s.type)==="send_test")return{uiState:f.Hidden,lastConfirmActionJitPluginData:o,jitPluginData:void 0,invokedPlugin:void 0,fileAttachments:void 0};if(i.some(g=>g.content.content_type===N.SystemError))return{uiState:f.Error,lastConfirmActionJitPluginData:o,jitPluginData:void 0,invokedPlugin:void 0,fileAttachments:void 0};if(de(n))return{uiState:f.Stopped,lastConfirmActionJitPluginData:o,jitPluginData:void 0,invokedPlugin:void 0,fileAttachments:void 0};for(let g=i.length-1;g>=0;g--){const c=i[g];if((_=c.metadata)!=null&&_.invoked_plugin){const G=[];return i.forEach(J=>{var Y,B;const P=(B=(Y=J.metadata)==null?void 0:Y.attachments)==null?void 0:B.filter(I=>I.display_files_from_actions_ext);P&&G.push(...P)}),{uiState:f.Finished,lastConfirmActionJitPluginData:o,jitPluginData:c.metadata.jit_plugin_data,invokedPlugin:c.metadata.invoked_plugin,fileAttachments:G}}const l=me((y=(v=c.metadata)==null?void 0:v.jit_plugin_data)==null?void 0:y.from_client);if(l!=null){if((l==null?void 0:l.type)==="contact_gizmo")return{uiState:f.Finished,lastConfirmActionJitPluginData:o,jitPluginData:(k=(A=i[g-1])==null?void 0:A.metadata)==null?void 0:k.jit_plugin_data,invokedPlugin:void 0,fileAttachments:void 0};if((l==null?void 0:l.type)==="deny")return{uiState:f.Denied,lastConfirmActionJitPluginData:o,jitPluginData:void 0,invokedPlugin:void 0,fileAttachments:void 0};if((l==null?void 0:l.type)==="oauth_success")return{uiState:f.Running,lastConfirmActionJitPluginData:o,jitPluginData:(w=c.metadata)==null?void 0:w.jit_plugin_data,invokedPlugin:void 0,fileAttachments:void 0};if((l==null?void 0:l.type)==="link_success")return{uiState:f.Running,lastConfirmActionJitPluginData:o,jitPluginData:(j=c.metadata)==null?void 0:j.jit_plugin_data,invokedPlugin:void 0,fileAttachments:void 0};if((l==null?void 0:l.type)==="allow")return{uiState:f.Allowed,lastConfirmActionJitPluginData:o,jitPluginData:(S=c.metadata)==null?void 0:S.jit_plugin_data,invokedPlugin:void 0,fileAttachments:void 0};break}const u=(M=(b=c.metadata)==null?void 0:b.jit_plugin_data)==null?void 0:M.from_server;if((u==null?void 0:u.type)==="preview"&&t)return{uiState:f.Running,lastConfirmActionJitPluginData:o,jitPluginData:(R=c.metadata)==null?void 0:R.jit_plugin_data,invokedPlugin:void 0,fileAttachments:void 0};if((u==null?void 0:u.type)==="confirm_action"&&t)return{uiState:f.UserConfirmation,lastConfirmActionJitPluginData:o,jitPluginData:(V=c.metadata)==null?void 0:V.jit_plugin_data,invokedPlugin:void 0,fileAttachments:void 0};if((u==null?void 0:u.type)==="activate_scope"&&t)return{uiState:f.UserConfirmation,lastConfirmActionJitPluginData:o,jitPluginData:(q=c.metadata)==null?void 0:q.jit_plugin_data,invokedPlugin:void 0,fileAttachments:void 0};if((u==null?void 0:u.type)==="approve_tool_in_scope"&&t)return{uiState:f.UserConfirmation,lastConfirmActionJitPluginData:o,jitPluginData:(x=c.metadata)==null?void 0:x.jit_plugin_data,invokedPlugin:void 0,fileAttachments:void 0};if((u==null?void 0:u.type)==="oauth_required"&&t)return{uiState:f.OauthLogin,lastConfirmActionJitPluginData:o,jitPluginData:(H=c.metadata)==null?void 0:H.jit_plugin_data,invokedPlugin:void 0,fileAttachments:void 0};if((u==null?void 0:u.type)==="link_required"&&t)return{uiState:f.NoAuthLink,lastConfirmActionJitPluginData:o,jitPluginData:(W=c.metadata)==null?void 0:W.jit_plugin_data,invokedPlugin:void 0,fileAttachments:void 0}}return{uiState:t?f.Running:f.Stopped,lastConfirmActionJitPluginData:o,jitPluginData:void 0,invokedPlugin:void 0,fileAttachments:void 0}}function Se(e,t,n,i){var _,v,y,A,k,w,j,S,b,M;const o=(_=oe(e,n))!=null?_:void 0;if(!o)return{connectorId:void 0,connectorToolStatus:null,connectorStatusMessage:null,showConnectorConnect:!1};if(t===e)return{connectorId:o,connectorToolStatus:null,connectorStatusMessage:null,showConnectorConnect:!1};let r=p.Running,a=null,m=!1;const d=n[n.length-1],s=(v=d==null?void 0:d.metadata)==null?void 0:v.jit_plugin_data;return n.some(R=>R.content.content_type===N.SystemError)?(r=p.Error,a=h.error):d?((y=s==null?void 0:s.from_server)==null?void 0:y.type)==="oauth_required"&&i?(r=p.Paused,a=null,m=!0):((A=s==null?void 0:s.from_server)==null?void 0:A.type)==="link_required"&&i?(r=p.Paused,a=null,m=!0):(((k=s==null?void 0:s.from_server)==null?void 0:k.type)==="oauth_required"||((w=s==null?void 0:s.from_server)==null?void 0:w.type)==="link_required")&&!i?(r=p.Stopped,a=h.connectorDeclined):((j=s==null?void 0:s.from_client)==null?void 0:j.type)==="deny"?(r=p.Stopped,a=h.connectorDeclined):((S=s==null?void 0:s.from_client)==null?void 0:S.type)==="oauth_success"?(r=p.Stopped,a=null):((b=s==null?void 0:s.from_client)==null?void 0:b.type)==="link_success"?(r=p.Stopped,a=null):(M=d==null?void 0:d.metadata)!=null&&M.invoked_plugin?(r=p.Finished,a=h.finished):(r=p.Stopped,a=h.stopped):(r=p.Running,a=h.running),{connectorId:o,connectorToolStatus:r,connectorStatusMessage:a,showConnectorConnect:m}}function _e({recipient:e,actionData:t,gizmoId:n,messageTextContent:i}){return{id:fe(),author:{role:U.Tool,name:e},content:{content_type:N.Text,parts:[i!=null?i:""]},recipient:"all",metadata:{jit_plugin_data:{from_client:t},gizmo_id:n},clientMetadata:{completionSampleFinishTime:Date.now()}}}function be(a){var m=a,{clientThreadId:e,actionData:t,assistantMessage:n,onRequestCompletion:i,messageTextContent:o}=m,r=Z(m,["clientThreadId","actionData","assistantMessage","onRequestCompletion","messageTextContent"]);var s;const d=(s=re(e))==null?void 0:s.mode;i(X(C({},r),{promptMessage:_e({recipient:n.recipient,actionData:t,gizmoId:d&&"gizmo_id"in d?d.gizmo_id:void 0,messageTextContent:o}),completionMetadata:{conversationMode:d!=null?d:{kind:se.PrimaryAssistant}}}))}function Me(e,t){if(e.type!==ie.JIT_PLUGIN||!e.metadata.json_schema)return!1;let n=!1;function i(o){for(const r in o)r==="operationId"&&o[r]===t&&(n=!0),o[r]&&typeof o[r]=="object"&&i(o[r])}return i(e.metadata.json_schema),n}function T(e){var t,n,i;if(e&&(((t=e.from_server)==null?void 0:t.type)==="confirm_action"||((n=e.from_server)==null?void 0:n.type)==="oauth_required"||((i=e.from_server)==null?void 0:i.type)==="preview"))return e.from_server.body.params}function D(e){var t,n,i;if(e&&(((t=e.from_server)==null?void 0:t.type)==="confirm_action"||((n=e.from_server)==null?void 0:n.type)==="preview"))return(i=e.from_server.body.tool_call_safety_summary)!=null?i:void 0}function pe(e){const t=ae(e);if(t)try{return JSON.parse(t)}catch(n){return{text:t}}}function Ne(e,t){var r,a;const{assistantMessage:n}=z(e),{jitPluginData:i,lastConfirmActionJitPluginData:o}=E(e,t);return(a=(r=T(i))!=null?r:T(o))!=null?a:pe(n)}function Ee(e,t){var o,r;const{jitPluginData:n,lastConfirmActionJitPluginData:i}=E(e,t);return(r=(o=D(n))!=null?o:D(i))!=null?r:void 0}function ge(e){if(!e)return;const t=e.content.content_type===N.Text?e.content.parts[0]:e.content.content_type===N.Code?e.content.text:void 0;if(t)try{return JSON.parse(t)}catch(n){return t}}const Re=e=>{const{lastToolMessage:t}=z(e);return ge(t)},Oe=(e,t)=>{var i,o,r,a;const{jitPluginData:n}=E(e,t);return((i=n==null?void 0:n.from_server)==null?void 0:i.type)==="confirm_action"?(a=(r=(o=n==null?void 0:n.from_server)==null?void 0:o.body)==null?void 0:r.offer_remember_answer)!=null?a:!0:!1},ve=(e,t)=>{var i,o;const{jitPluginData:n}=E(e,t);return((i=n==null?void 0:n.from_server)==null?void 0:i.type)!=="denied_by_user"&&!!((o=n==null?void 0:n.from_server)!=null&&o.body.actions.length)},Ce=(e,t)=>ce(e)&&ve(e,t);export{f as J,Oe as a,Ne as b,Ce as c,Me as d,Se as e,me as f,E as g,be as h,h as i,Ee as j,Re as k,we as l,je as m,z as p};
//# sourceMappingURL=i420bybxmtbqtbfk.js.map
