const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/g683sukvvwb09shg.js","assets/bubexfvksfr7893o.js","assets/bh3ogo5ra3ryh1rz.js","assets/jp1bsz3poves5oxv.js","assets/k1cl8bhg0vqi0zvs.js","assets/ncw8zw682jinppua.js","assets/root-ookb7xuw.css","assets/jaztged0ed1qpm4w.js"])))=>i.map(i=>d[i]);
var te=Object.defineProperty,se=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var z=Object.getOwnPropertySymbols;var ne=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var G=(e,s,a)=>s in e?te(e,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[s]=a,C=(e,s)=>{for(var a in s||(s={}))ne.call(s,a)&&G(e,a,s[a]);if(z)for(var a of z(s))oe.call(s,a)&&G(e,a,s[a]);return e},k=(e,s)=>se(e,ae(s));import{_ as M,h as O,d as H,r,l as re,j as t,M as U}from"./bubexfvksfr7893o.js";import{az as v,p as B,R as Z,dc as q,aA as j,ih as J,ff as ie,eH as le,u as W,oc as $,g as de,c6 as X,bE as Y,c9 as ce,d as K,j9 as ue,j8 as Q,c5 as pe,lp as me,N as fe,aw as V,D as ge,dS as he,bk as xe}from"./ncw8zw682jinppua.js";import{dT as _e,dX as Me,df as ve,de as _,dU as je,dV as Ie,fQ as we,d_ as be,b9 as Re,ba as ye,bb as Pe,dd as Ce,fR as ke,fS as De,fT as Ee,fU as Ne,fV as Se}from"./lm3g1zm00rp6al39.js";import{I as Fe}from"./fvq06q6sopd9r6rx.js";const Te=v(()=>M(()=>import("./g683sukvvwb09shg.js"),__vite__mapDeps([0,1])),{loading:e=>j(e)}),Oe=v(()=>M(()=>import("./bh3ogo5ra3ryh1rz.js"),__vite__mapDeps([2,1])),{loading:e=>j(e)}),Ae=v(()=>M(()=>import("./jp1bsz3poves5oxv.js"),__vite__mapDeps([3,1])),{loading:e=>j(e)}),Le=v(()=>M(()=>import("./k1cl8bhg0vqi0zvs.js"),__vite__mapDeps([4,1])),{loading:e=>j(e)}),qe=v(()=>M(()=>import("./ncw8zw682jinppua.js").then(e=>e.yq),__vite__mapDeps([5,1,6])),{loading:e=>j(e)}),Ve=({image:e,onClose:s,onRequestCompletion:a,clientThreadId:n,currentModelId:o,post:c,canDelete:x,onOpenReport:g})=>{var P;const i=O(),f=B(),p=H(),[h,b]=r.useState("default"),d=_e(),D=r.useRef(null),I=r.useRef(d);r.useEffect(()=>{I.current=d},[d]);const w=r.useCallback(()=>Me(i),[i]),E=r.useCallback(()=>{e&&b("inpaint")},[e]),R=r.useCallback(()=>{b("default"),I.current.clearAllDrawings()},[]),A=r.useCallback(()=>{e&&ve({url:e.url,fileName:w()})},[e,w]),N=r.useCallback(()=>{var l;return(l=D.current)==null?void 0:l.getImageData()},[]),L=r.useCallback(async()=>{if(window.confirm(i.formatMessage({id:"postReceiverModal.deletePostConfirmation",defaultMessage:"Are you sure you want to delete this post?"})))try{await Z.safeDelete("/share/post/{post_id}",{parameters:{path:{post_id:c.id}}}),p("/",{replace:!0})}catch(l){f.danger(re({id:"postReceiverModal.deletePostError",defaultMessage:"Failed to delete the post"}),{toastId:"post_receiver_modal.delete_post_error"})}},[c.id,i,f,p]),S=h==="inpaint"?i.formatMessage({id:"TjVqYb",defaultMessage:"Edit Selection"}):(P=c.text)!=null?P:i.formatMessage({id:"htGxHc",defaultMessage:"Image"}),y=r.useCallback(l=>{l.key==="Escape"&&(s(),l.preventDefault())},[s]);return r.useEffect(()=>(document.addEventListener("keydown",y),()=>document.removeEventListener("keydown",y)),[y]),t.jsx(q.Root,{isOpen:!0,onClose:s,testId:"modal-lightbox-post-share",shouldIgnoreClickOutside:h==="inpaint",children:t.jsx(q.Overlay,{children:t.jsxs(q.Content,{size:"fullscreen",removePopoverStyling:!0,className:"grid min-h-0 grid-rows-[auto_minmax(0,1fr)] overflow-hidden",children:[t.jsxs("header",{className:"flex h-14 w-full items-center justify-between gap-2 px-2 md:px-4",children:[t.jsxs("div",{className:"flex min-w-0 items-center gap-2",children:[t.jsx(_,{icon:qe,onClick:s,"aria-label":i.formatMessage({id:"EYLKSm",defaultMessage:"Close"})}),t.jsx("h2",{className:"line-clamp-1 text-base font-medium",children:S})]}),t.jsx("div",{className:"flex items-center gap-2",children:h==="inpaint"?t.jsxs(t.Fragment,{children:[t.jsx(_,{className:"aspect-square",icon:je,onClick:d.undoDrawing,disabled:!d.canUndoDrawing,"aria-label":i.formatMessage({id:"OmaTPx",defaultMessage:"Undo"})}),t.jsx(_,{className:"aspect-square",icon:Ie,onClick:d.redoDrawing,disabled:!d.canRedoDrawing,"aria-label":i.formatMessage({id:"ZUr4oh",defaultMessage:"Redo"})}),t.jsx(_,{className:"w-auto px-3",onClick:R,children:i.formatMessage({id:"D9xvar",defaultMessage:"Cancel"})})]}):t.jsxs(t.Fragment,{children:[t.jsx(_,{className:"aspect-square",icon:Oe,onClick:E,"aria-label":i.formatMessage({id:"pRGwlp",defaultMessage:"Edit image"})}),t.jsx(_,{className:"aspect-square",icon:Le,onClick:A,"aria-label":i.formatMessage({id:"9DNHka",defaultMessage:"Download image"})}),t.jsx(_,{className:"aspect-square",icon:Ae,onClick:g,"aria-label":i.formatMessage({id:"2gNXdX",defaultMessage:"Report content"})}),x&&t.jsx(_,{className:"aspect-square",icon:Te,onClick:L,"aria-label":i.formatMessage({id:"rzlDpj",defaultMessage:"Delete post"})})]})})]}),t.jsxs("div",{className:"grid h-full w-full grid-rows-[1fr_auto] items-center overflow-y-auto overscroll-contain",children:[t.jsx("div",{className:"flex h-full w-full items-center justify-center px-4 pb-4",children:e&&t.jsxs("div",{className:"relative inline-block max-h-full rounded bg-neutral-100",children:[t.jsx("img",{src:e.url,alt:S,className:"h-full max-h-[70vh] w-auto max-w-full rounded object-contain",fetchPriority:"high"}),h==="inpaint"&&t.jsx(we,{image:e,drawingState:d,drawingCanvasRef:D})]})}),t.jsx("div",{className:"flex w-full justify-center px-4 pb-8",children:t.jsx("div",{className:"w-full max-w-[768px]",children:t.jsx(Fe,{clientThreadId:n,currentModelId:o,onRequestCompletion:a,onClose:s,activeImage:e,currentDrawnShape:d.currentDrawnShape,getImageData:N,onCancelInpaint:R})})})]})]})})})},Ue=v(()=>M(()=>import("./g683sukvvwb09shg.js"),__vite__mapDeps([0,1])),{loading:e=>j(e)}),He=v(()=>M(()=>import("./jp1bsz3poves5oxv.js"),__vite__mapDeps([3,1])),{loading:e=>j(e)}),Be=v(()=>M(()=>import("./jaztged0ed1qpm4w.js"),__vite__mapDeps([7,1])),{loading:e=>j(e)});function Je({postWithProfile:e,clientThreadId:s,onClose:a}){var n,o;return((n=e.post.attachments[0])==null?void 0:n.kind)==="media_generation"?t.jsx(ze,{postWithProfile:e,clientThreadId:s,onClose:a}):((o=e.post.attachments[0])==null?void 0:o.kind)==="message_slice"?t.jsx(Ge,{postWithProfile:e,onClose:a}):null}function ze({postWithProfile:e,clientThreadId:s,onClose:a}){var P;const n=W(),o=de(n,s),c=r.useRef(null),[x,g]=r.useState(!1),i=H(),{post:f}=e,p=f.attachments[f.attachments.length-1],h={url:p.url,content_type:Y.ImageAssetPointer,asset_pointer:(P=p.asset_pointer)!=null?P:X(p.id),width:p.width,height:p.height},b=O(),d=ce(),D=K(o.serverId$),I=B(),w=r.useCallback(l=>d.getState().files.find(m=>m.tempId===l),[d]),E=p.url,R=r.useCallback(async l=>{if(c.current){const m=await c.current,u=m?w(m==null?void 0:m.tempId):null;if(u)return u}return c.current=fetch(l).then(m=>m.blob()).then(m=>{const u=new File([m],"image.png",{type:"image/png"}),F=ue(u);return Q.uploadFile(d,F,u,pe.Multimodal,[u.type],b,I).then(()=>{const T=w(F);return T&&T.status===me.Ready&&T.fileId?T:null})}),c.current},[d,b,I,w]),A=K(()=>xe(o).id),N=!fe(n),L=r.useCallback(async l=>{var m;if(!(!l.promptMessage||N))try{const u=await R(E);if(!u||!u.fileId||!u.fileSpec)return;const F=[{content_type:Y.ImageAssetPointer,asset_pointer:X(u.fileId),size_bytes:u.fileSpec.size,width:p.width,height:p.height},...l.promptMessage.content.content_type===V.MultimodalText||l.promptMessage.content.content_type===V.Text?l.promptMessage.content.parts:[]];Ce(k(C({conversation:o},l),{promptMessage:k(C({},l.promptMessage),{content:{content_type:V.MultimodalText,parts:F}}),extraStreamParams:k(C({},(m=l.extraStreamParams)!=null?m:{}),{continueFromSharedPostId:f.id})})),Q.reset(d)}catch(u){ge.addError(new Error("post_receiver_handle_request_failed",{cause:u})),I.danger({id:"postReceiverModal.editImageError",defaultMessage:"Failed to edit the image",description:"Error message for editing an image"},{toastId:"post_receiver_modal.edit_image_error"})}},[o,p.height,p.width,R,d,E,N,I,f.id]),S={id:f.id,archived:!1,transformationId:null,url:h.url,assetPointer:h.asset_pointer,thumbnail:null,width:h.width,height:h.height,title:null,conversationId:D,messageId:f.id},y=r.useCallback(()=>{a(),i("/",{replace:!0})},[a,i]);return t.jsxs(t.Fragment,{children:[t.jsx(Ve,{image:S,onClose:y,onRequestCompletion:L,clientThreadId:o.id,currentModelId:A,post:f,canDelete:!!f.permissions.can_delete,onOpenReport:()=>g(!0)}),x&&t.jsx(ee,{post:f,onClose:()=>g(!1)})]})}function Ge({postWithProfile:e,onClose:s}){const[a,n]=r.useState(!1),{post:o}=e;return t.jsxs("div",{className:"bg-token-bg-primary absolute start-0 end-0 top-0 bottom-0 h-full w-full",children:[t.jsx($e,{post:o,setIsReportModalOpen:n,onClose:s}),t.jsx(ke,{attachments:o.attachments,variant:"fullscreen"}),a&&t.jsx(ee,{post:o,onClose:()=>n(!1)})]})}function $e({post:e,setIsReportModalOpen:s,onClose:a,additionalButtons:n}){const o=H(),c=O(),x=B(),g=r.useCallback(async()=>{if(window.confirm(c.formatMessage({id:"postReceiverModal.deletePostConfirmation",defaultMessage:"Are you sure you want to delete this post?"})))try{await Z.safeDelete("/share/post/{post_id}",{parameters:{path:{post_id:e.id}}}),o("/",{replace:!0})}catch(i){x.danger({id:"postReceiverModal.deletePostError",defaultMessage:"Failed to delete the post",description:"Error message for deleting a post"},{toastId:"post_receiver_modal.delete_post_error"})}},[e.id,c,x,o]);return t.jsx(t.Fragment,{children:t.jsxs(he.div,k(C({className:"flex h-16 w-full px-2 sm:px-4"},De),{children:[t.jsx("div",{className:"flex items-center justify-self-start text-start",children:t.jsx(Ee,{onClose:()=>{a(),o("/",{replace:!0})}})}),t.jsx("div",{className:"flex w-full flex-1 flex-col items-center justify-center justify-self-stretch",children:t.jsx(Ne,{areButtonsFullWidth:!0,post:e,setIsReportModalOpen:s})}),t.jsxs("div",{className:"flex items-center justify-self-end text-end",children:[e.permissions.can_delete&&t.jsx(Se,{tooltip:c.formatMessage({id:"postReceiverModal.deletePost",defaultMessage:"Delete"}),onClick:g,children:t.jsx(Ue,{})}),n]})]}))})}function ee({post:e,onClose:s}){var g;const a=W(),{data:n}=Re(a,$.Post),o=O(),c=ye(a,o,e.id,$.Post);if(n==null)return null;const x="Report ".concat((g=e.text)!=null?g:"Post");return t.jsx(Pe,{reasons:n.reasons,submitReport:c,title:x,onClose:s,header:n.header,subHeader:n.header_explanation})}function We(){var n;const e=r.useContext(J),s=(n=e==null?void 0:e.postWithProfile)==null?void 0:n.post,a=e==null?void 0:e.setIsReportModalOpen;return!s||!a?null:t.jsxs("div",{className:"outline-token-border-default mx-4 flex items-center justify-between gap-2.5 rounded-2xl py-1 ps-4 pe-0.5 outline-1 outline-offset-[-1px]",children:[t.jsx("span",{className:"text-token-text-secondary justify-center text-sm leading-tight",children:t.jsx(U,{id:"e2L5bY",defaultMessage:"Content created using ChatGPT"})}),t.jsx(ie,{size:"default",contentAlign:"end",sideOffset:4,triggerButton:t.jsx(be,{className:"rounded-full",label:"",icon:t.jsx(Be,{className:"icon-sm"})}),children:t.jsx(le.Item,{icon:He,onClick:()=>a(!0),children:t.jsx(U,{id:"jHHbcM",defaultMessage:"Flag content as unsafe"})})})]})}function et(){var n;const e=r.useContext(J),s=(n=e==null?void 0:e.postWithProfile)==null?void 0:n.post,a=e==null?void 0:e.setIsReportModalOpen;return!s||!a?null:t.jsx("div",{className:"text-token-text-secondary text-sm",children:t.jsx(U,{id:"iRpGVT",defaultMessage:"Content created using ChatGPT. <reportButton>Report</reportButton> if unsafe.",values:{reportButton:o=>t.jsx("button",{className:"text-token-text-primary decoration-token-text-primary underline",onClick:()=>{a(!0)},children:o})}})})}export{Je as P,We as S,et as a,ee as b};
//# sourceMappingURL=dpidockywf8envd2.js.map
