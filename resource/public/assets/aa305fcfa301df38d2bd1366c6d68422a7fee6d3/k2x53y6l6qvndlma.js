var E=Object.defineProperty,k=Object.defineProperties;var T=Object.getOwnPropertyDescriptors;var g=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,w=Object.prototype.propertyIsEnumerable;var m=(e,t,a)=>t in e?E(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,R=(e,t)=>{for(var a in t||(t={}))U.call(t,a)&&m(e,a,t[a]);if(g)for(var a of g(t))w.call(t,a)&&m(e,a,t[a]);return e},S=(e,t)=>k(e,T(t));import{y as $,ac as y,d as L,r as c}from"./bubexfvksfr7893o.js";import{p as A,hZ as p,h_ as f,R as P}from"./ncw8zw682jinppua.js";import{a as G}from"./ci57adu98ddr6ebh.js";async function I(e,t,a,o){const n=await P.safeGet("/connectors/{id}/oauth/callback",{parameters:{path:{id:e},query:{code:t,redirect_uri:a,state:o}}});return S(R({},n),{redirect_path:G(n.redirect_path).toString()})}const H=$(function(){const{pluginId:t}=y(),a=L(),o=c.useRef(!1),[n,C]=c.useState(""),{code:i,error:u,error_description:r,state:h}=Object.fromEntries(new URLSearchParams(n.substring(1)).entries());c.useEffect(()=>{C(window.location.hash)},[]),c.useEffect(()=>{if(o.current)return;if(t&&i&&h)o.current=!0;else{a("/");return}async function O(){var _;const b=window.location.origin+"/ccc/".concat(t,"/oauth/callback");if(!(!t||!i||!h))try{const s=await I(t,i,b,h);if(s.success){const l=new URL(p(f.OAUTH_SUCCESS,s.redirect_path),location.origin);l.searchParams.set("oauth_success","true"),a(l.pathname+l.search+l.hash)}else a(p(f.CUSTOM_ERROR,s.redirect_path,(_=s.error)!=null?_:s.message))}catch(s){a(p(f.CUSTOM_ERROR))}}O()},[t,i,h,a]);const d=A();return c.useEffect(()=>{u&&d.danger("".concat(u).concat(r?": ".concat(r):""),{duration:5,toastId:"oauth_callback: CCCOauth",loggingTitle:u,loggingDescription:r!=null?r:""})},[u,r,d]),null});export{H as default};
//# sourceMappingURL=k2x53y6l6qvndlma.js.map
