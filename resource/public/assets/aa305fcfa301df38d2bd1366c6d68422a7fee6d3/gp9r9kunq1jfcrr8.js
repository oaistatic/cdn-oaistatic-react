const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jasggtze31dxpnzc.js","assets/bubexfvksfr7893o.js","assets/g683sukvvwb09shg.js","assets/nq6tg09w6idos054.js","assets/hdyydyw9h51echxp.js","assets/ncw8zw682jinppua.js","assets/root-ookb7xuw.css","assets/ei2rr3u86wwo8xvm.js","assets/hahiy9dm7k71twz4.js","assets/cmff6ny7qwtuxu45.js"])))=>i.map(i=>d[i]);
var Ce=Object.defineProperty,Ee=Object.defineProperties;var Le=Object.getOwnPropertyDescriptors;var oe=Object.getOwnPropertySymbols;var Re=Object.prototype.hasOwnProperty,Ae=Object.prototype.propertyIsEnumerable;var ie=(s,n,t)=>n in s?Ce(s,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[n]=t,l=(s,n)=>{for(var t in n||(n={}))Re.call(n,t)&&ie(s,t,n[t]);if(oe)for(var t of oe(n))Ae.call(n,t)&&ie(s,t,n[t]);return s},I=(s,n)=>Ee(s,Le(n));import{j as e,M as f,d as Se,v as de,_ as C,r as N,h as ue,u as De}from"./bubexfvksfr7893o.js";import{u as U,az as E,f9 as d,al as me,qL as Oe,am as z,qM as A,aB as pe,oN as xe,qN as fe,hw as ge,lp as B,cz as le,e7 as ze,br as Ue,fN as Ge,aA as S,pd as qe,d as he,qO as Be,p as Ve,px as He,py as Qe,gO as je,pz as Ze,pe as Ke,oP as Xe,oO as $e,_ as We,j9 as Je,qP as R,kH as Ye,qQ as H,qR as Q,kb as es,kI as ss,gc as ts,ge as ns,H as os,fa as is,aC as ls,cr as rs}from"./ncw8zw682jinppua.js";import{g as as,D as re}from"./fum95d46v8d5jv8u.js";import{b6 as cs,jO as ye,jP as ve,jQ as ds,jR as us,fG as ae,fO as ms}from"./lm3g1zm00rp6al39.js";import{F as ps}from"./6sb0te5xkk0og38q.js";import{f as xs}from"./m89x2zftpo6hrypr.js";import{u as fs}from"./n2u3q2i5341kdx8j.js";import{CustomInstructionsModal as gs}from"./nvsf5y439ozyeg9o.js";const hs=E(()=>C(()=>import("./jasggtze31dxpnzc.js"),__vite__mapDeps([0,1])),{loading:s=>S(s)}),js=E(()=>C(()=>import("./g683sukvvwb09shg.js"),__vite__mapDeps([2,1])),{loading:s=>S(s)}),ys=E(()=>C(()=>import("./nq6tg09w6idos054.js"),__vite__mapDeps([3,1])),{loading:s=>S(s)}),ce=E(()=>C(()=>import("./hdyydyw9h51echxp.js"),__vite__mapDeps([4,1,5,6])).then(s=>s.FilePreviewModal));function vs({gizmoResource:s,canEdit:n,pendingFiles:t,files:r,interpreterOnlyFileIds:o,onAddFiles:u,removePendingFile:p,pendingFileUpsertMutationsRef:m}){U();const a=s.gizmo.id,i=s.gizmo.display.name;return t.length===0&&r.length===0?e.jsx("div",{className:"h-full pb-4",children:e.jsx(Ns,{gizmoName:i,onAddFiles:u,canEdit:n})}):e.jsxs("div",{className:"pb-6",children:[e.jsx(_s,{numFiles:r.length+t.length}),e.jsx(bs,{canEdit:n,projectId:a,files:r,pendingFiles:t,interpreterOnlyFileIds:o,removePendingFile:p,pendingFileUpsertMutationsRef:m,className:"border-token-border-light overflow-hidden rounded-lg border"})]})}function _s({numFiles:s}){const n=U(),t=me(n),r=Se();if(!Oe({accountPlanType:t==null?void 0:t.planType,numFiles:s}))return null;let o;return(t==null?void 0:t.planType)===z.FREE?o=e.jsx(f,I(l({},d.projectFileRateLimitBannerPlusDescription),{values:{freeFileLimit:A(z.FREE),paidFileLimit:A(z.PLUS)}})):o=e.jsx(f,I(l({},d.projectFileRateLimitBannerProDescription),{values:{paidFileLimit:A(z.PLUS),proFileLimit:A(z.PRO),planType:t==null?void 0:t.planType.valueOf()}})),e.jsxs("div",{className:"bg-token-bg-tertiary mb-3 flex flex-row items-center justify-between gap-3 rounded-xl p-3 text-sm",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-token-text-primary",children:e.jsx(f,l({},d.projectFileRateLimitBannerTitle))}),e.jsx("span",{className:"text-token-text-secondary",children:o})]}),e.jsx(pe,{color:"secondary",className:"bg-token-bg-tertiary",onClick:()=>{cs(r,"projects file upsell banner")},children:e.jsx(f,l({},d.upgradeToPlus))})]})}function bs({projectId:s,files:n,pendingFiles:t,interpreterOnlyFileIds:r,removePendingFile:o,pendingFileUpsertMutationsRef:u,canEdit:p,className:m}){const a=xe();return n.length===0&&t.length===0?null:e.jsxs("div",{className:m,children:[n.map(i=>e.jsx(Fs,{gizmoId:s,gizmoFile:i,interpreterOnly:r.includes(i.file_id),canEdit:p,onDelete:()=>{const x=new Promise(w=>{u.current.push({id:s,mutationId:de(),update:g=>{const _=g.files.filter(P=>P.file_id!==i.file_id);return I(l({},g),{files:_})},onSuccess:w})});return fe(s)({projectId:s,upsertProjectMutation:a,pendingFileUpsertMutationsRef:u}),x}},i.file_id)),t.map(i=>e.jsx(Is,{canEdit:p,interpreterOnly:r.includes(i.tempId),pendingFile:i,onDelete:async()=>o(i.tempId)},i.tempId))]})}function _e(){return e.jsx("div",{className:"truncate",children:e.jsx(f,l({},d.interpreterOnlyLabel))})}function Is({pendingFile:s,onDelete:n,interpreterOnly:t,canEdit:r}){var m,a,i;const o=s.file.name,p=(ds(s.file)&&((m=s.file)==null?void 0:m.type.startsWith("image/"))||ge(o))&&e.jsx(ye,{file:s.file,fileName:o,fileId:(a=s.fileId)!=null?a:void 0,gizmoId:(i=s.gizmoId)!=null?i:void 0});return e.jsx(be,{interpreterOnly:t,onDelete:n,canEdit:r,children:e.jsx(ve,{icon:p,fileName:s.file.name,loadingPercentage:s.status===B.Uploading?s.progress:void 0,customFileDescription:t?e.jsx(_e,{}):void 0})})}function Fs({gizmoFile:s,gizmoId:n,interpreterOnly:t,onDelete:r,canEdit:o}){const u=s.name,m=ge(u)&&s.file_id!=null&&e.jsx(ye,{fileName:u,fileId:s.file_id,gizmoId:n}),a=U(),i=()=>{const x=s.file_id;x&&Ue(a,ce,{gizmoId:n,fileId:x,fileName:s.name,onClose:()=>Ge(a,ce)})};return e.jsx(be,{interpreterOnly:t,onDelete:r,canEdit:o,children:e.jsx("div",{className:"cursor-pointer",onClick:i,children:e.jsx(ve,{icon:m,fileName:s.name,customFileDescription:t?e.jsx(_e,{}):void 0})})})}function be({children:s,onDelete:n,canEdit:t,interpreterOnly:r}){const[o,u]=N.useState(!1);return e.jsxs("div",{className:le("group/file-row border-token-border-light flex w-full items-center justify-between border-b p-3 text-sm last:border-b-0",t?"hover:bg-token-interactive-bg-primary-selected/5":"hover:bg-transparent",r),children:[e.jsx("div",{className:"can-hover:w-full w-10/12 group-hover:w-11/12",children:s}),t&&e.jsx("button",{onClick:async()=>{n&&(u(!0),await n(),u(!1))},className:le("group/file-layout -m-2 flex aspect-square shrink-0 grow-0 items-center justify-center bg-transparent p-2",!o&&"can-hover:opacity-0 group-hover/file-row:opacity-100 focus-visible:opacity-100"),children:e.jsx("div",{className:"group-hover/file-layout:bg-token-interactive-bg-primary-selected/5 group-active/file-layout:bg-token-interactive-bg-primary-selected/15 rounded-md p-[5px]",children:o?e.jsx("div",{className:"flex h-full w-6 items-center justify-center",children:e.jsx(ze,{})}):e.jsx(js,{className:"icon-sm text-token-secondary"})})})]})}function Ns({gizmoName:s,onAddFiles:n,canEdit:t}){return e.jsx("div",{className:"border-token-border-default active:bg-token-bg-tertiary flex h-full cursor-pointer items-center justify-center rounded-lg border px-4 py-3 pb-6",onClick:n,children:e.jsxs("div",{className:"text-token-text-secondary flex flex-col items-center gap-2 py-4 text-sm",children:[t?e.jsx(hs,{}):e.jsx(ys,{}),e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-token-text-secondary max-w-100",children:e.jsx(f,I(l({},d.emptyFileInstructions),{values:{gizmoNameText:e.jsx("span",{className:"font-bold",children:e.jsx(f,I(l({},d.emptyFileGizmoName),{values:{gizmoName:s}}))},"gizmoNameText")}}))})})]})})}const Ps=E(()=>C(()=>import("./ei2rr3u86wwo8xvm.js"),__vite__mapDeps([7,1])),{loading:s=>S(s)}),Ts=E(()=>C(()=>import("./hahiy9dm7k71twz4.js"),__vite__mapDeps([8,1])),{loading:s=>S(s)});function ws({ctx:s,gizmoResource:n,canEdit:t,gizmoEditorData:r,openFileDialog:o,pendingFiles:u,setVersion:p,pendingFileUpsertMutationsRef:m,currentModelConfig:a}){var P;const i=n.gizmo.id,x=(P=r==null?void 0:r.files)!=null?P:[],j=Array.from(u.current.values()).filter(c=>x.every(G=>G.file_id!==c.fileId)),w=j.filter(c=>a!=null&&H(a,c.file.type,c.file.name)===Q.CodeInterpreter),g=x.filter(c=>a!=null&&c.type!=null&&H(a,c.type,c.name)===Q.CodeInterpreter),_=[...w.map(c=>c.tempId),...g.map(c=>c.file_id)];return e.jsx(vs,{gizmoResource:n,canEdit:t,pendingFiles:j,pendingFileUpsertMutationsRef:m,files:x,interpreterOnlyFileIds:_,onAddFiles:o,removePendingFile:c=>{u.current.delete(c),R({ctx:s,id:i,pendingFiles:{key:c,value:null}}),p(G=>G+1)}})}const Ms=N.forwardRef(function({gizmo:n,accountPlanType:t,showInstructions:r=!0,onPendingFilesChange:o},u){var Y,ee;const p=A(t),m=ue(),[a,i]=N.useState(!1),x=xe(),j=us(n),w=qe(j),g=U(),_=he(()=>ns(g,{isGizmo:!1})),P=(Y=_.models.get(Be))!=null?Y:_&&xs(_.models.values(),L=>L.tags.includes(ts.GPT_4o)),c=Ve(),[G,D]=N.useState(0),b=N.useRef(new Map),V=N.useRef([]),Ie=He(P,void 0),Z=b.current.size>0;N.useEffect(()=>{o==null||o(Z)},[Z,o]);const Fe=L=>{L.some(({errors:F})=>{var T;return F.length!==1||((T=F[0])==null?void 0:T.code)!==ae.TooManyFiles})?c.danger(d.unknownError,{duration:2,toastId:"snorlax_handle_file_rejected"}):c.danger(m.formatMessage(d.dragTooManyFilesError,{maxFileLimit:p}),{duration:2,toastId:"snorlax_handle_file_rejected",loggingTitle:"drag_too_many_files_error"})},Ne=async L=>{We.logEvent("Upload File",{client:"web",eventSource:"mouse",intent:"gizmo"});const F=j.id;L.length>0&&await Promise.all(L.map(T=>{const q=Je(T),se={tempId:q,gizmoId:F,file:T,status:B.Uploading,progress:1,fileId:null,cdnUrl:null};b.current.set(q,se),R({ctx:g,id:F,pendingFiles:{key:q,value:se}}),Ye(q,T,m,c,{kind:ss.Gizmo,gizmoId:F},{onFileUploaded:async(h,M,k,y)=>{const v=b.current.get(h);v!=null&&v.fileId&&v!=null&&v.fileId&&(V.current.push({id:n.gizmo.id,mutationId:de(),update:O=>{var te,ne;if(!v.fileId)return O;const ke=[...(te=O.files)!=null?te:[],{file_id:v.fileId,name:v.file.name,size:v.file.size,type:(ne=y==null?void 0:y.mimeType)!=null?ne:es(v.file),last_modified:v.file.lastModified,file_size_tokens:y==null?void 0:y.fileTokenSize}];return I(l({},O),{files:ke})},onSuccess:()=>{b.current.delete(h),R({ctx:g,id:F,pendingFiles:{key:h,value:null}}),D(O=>O+1)}}),fe(n.gizmo.id)({projectId:n.gizmo.id,upsertProjectMutation:x,pendingFileUpsertMutationsRef:V}))},onFileCreated:(h,M,k)=>{const y=I(l({tempId:h,gizmoId:F,file:T,status:B.Uploading,progress:1},b.current.get(h)),{fileId:M,cdnUrl:k});b.current.set(h,y),R({ctx:g,id:F,pendingFiles:{key:h,value:y}}),D(v=>v+1)},onFileUploadProgress:(h,M)=>{const k=b.current.get(h);if((k==null?void 0:k.status)===B.Uploading){const y=I(l({},k),{progress:M>95?95:M});b.current.set(h,y),R({ctx:g,id:F,pendingFiles:{key:h,value:y}})}D(y=>y+1)},onError:h=>{b.current.delete(h),R({ctx:g,id:F,pendingFiles:{key:h,value:null}}),D(M=>M+1)}},{usesRetrievalIndex:P!=null&&H(P,T.type,T.name)===Q.Retrieval})}))},K=Qe(Ie),X=as(K),$=b.current.size+j.files.length,{canEdit:W}=je(n),{open:J,getInputProps:Pe,getRootProps:Te,isDragAccept:we,isDragReject:Me}=fs(l({noClick:!0,noKeyboard:!0,noDragEventsBubbling:!0,onDropAccepted:Ne,onDropRejected:Fe,multiple:!0,maxSize:Ze,maxFiles:p-$,validator:()=>$>=p?{code:ae.TooManyFiles,message:"Too many files"}:null,disabled:!W},K));return N.useImperativeHandle(u,()=>({openFileDialog:J,hasPendingFiles:()=>b.current.size>0})),e.jsxs("div",I(l({},Te({className:"h-full px-4 min-w-0"})),{children:[e.jsx("input",l({},Pe())),r&&e.jsxs(ps,{children:[e.jsx("button",{className:"w-full",onClick:()=>i(!0),children:e.jsx("div",{className:"border-token-border-default w-full rounded-lg border text-start text-sm",children:(ee=j==null?void 0:j.instructions)!=null&&ee.length?e.jsx("div",{className:"mx-4 my-3 line-clamp-4",children:j.instructions}):e.jsxs("div",{className:"text-token-text-secondary flex h-full w-full items-center px-4 py-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx(f,l({},d.addCustomInstructions))}),e.jsx(Ps,{className:"icon-sm"})]})})}),w.includes(Ke.GizmoInstructionsTooLong)?e.jsx(Xe,{className:"mt-1",children:e.jsx(f,I(l({},d.instructionsTooLong),{values:{length:$e}}))}):null]}),a&&e.jsx(gs,{gizmo:n,onClose:()=>{i(!1)}}),e.jsx(ws,{ctx:g,gizmoResource:n,canEdit:W,gizmoEditorData:j,openFileDialog:J,pendingFiles:b,pendingFileUpsertMutationsRef:V,setVersion:D,currentModelConfig:P}),we&&e.jsxs(re,{children:[e.jsx(ms,{}),e.jsx("h3",{children:e.jsx(f,l({},d.dragInstructions))}),e.jsx("h4",{className:"w-2/3 text-center",children:X.length>0?X.join(", "):e.jsx(f,l({},d.dragAllAccepted))})]}),Me&&e.jsxs(re,{children:[e.jsx(Ts,{className:"icon-2xl"}),e.jsx("h3",{children:e.jsx(f,l({},d.dragTooManyFiles))}),e.jsx("h4",{className:"w-2/3 text-center",children:e.jsx(f,I(l({},d.dragTooManyFilesDescription),{values:{maxFileLimit:p}}))})]})]}))}),ks=E(()=>C(()=>import("./cmff6ny7qwtuxu45.js"),__vite__mapDeps([9,1])),{loading:s=>S(s)});function qs({gizmo:s,onClose:n,project:t}){var g;const r=ue(),o=N.useRef(null),u=N.useCallback(()=>{var _;(_=o.current)==null||_.openFileDialog()},[o]),p=U(),m=me(p),a=De(),{data:i}=os(s.gizmo.id),x=i!=null?i:s,{canEdit:j}=je(x),w=he(()=>{var _;return(_=t==null?void 0:t.filesCount$())!=null?_:0});return N.useEffect(()=>{a.invalidateQueries({queryKey:is(a,x.gizmo.id).queryKey})},[x.gizmo.id,a]),e.jsx(e.Fragment,{children:e.jsx(ls,{testId:"modal-project-files",className:"min-h-72 max-w-[820px]",isOpen:!0,showCloseButton:!0,hideSeparator:!0,noPadding:!0,size:"custom",type:"success",headerAccessory:j?e.jsx(pe,{color:"secondary",onClick:u,disabled:(g=m&&w>=A(m.planType))!=null?g:!1,children:e.jsx(f,l({},d.addFilesButtonLabel))}):e.jsx(rs,{label:r.formatMessage(d.viewOnlyCustomInstructionsModalHeaderTooltip),side:"left",align:"center",children:e.jsxs("div",{className:"text-token-text-tertiary flex flex-row items-center gap-1.5 text-sm",children:[e.jsx(ks,{className:"icon"}),e.jsx(f,l({},d.viewOnlyCustomInstructionsModalHeaderLabel))]})}),title:e.jsx(f,l({},d.projectFilesModalTitle)),onClose:()=>{n()},children:e.jsx("div",{className:"grid min-h-[50dvh] grow overflow-y-auto pt-0",children:m&&e.jsx(Ms,{ref:o,gizmo:x,showInstructions:!1,accountPlanType:m.planType})})})})}export{qs as SnorlaxFileModal};
//# sourceMappingURL=gp9r9kunq1jfcrr8.js.map
