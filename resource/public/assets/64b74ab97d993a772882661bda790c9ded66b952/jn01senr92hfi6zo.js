import{r as p,i as V,j as e,M as u}from"./ci5tkrccytan34lo.js";import{eL as P,dg as v,md as E,m4 as z,fL as U,ai as W}from"./fztttvm3qzdvif1h.js";import{c as w,B as S,ag as H,ac as K}from"./ccccre6vnqbb7l94.js";import{C as $,S as G,i as q,g as J,D as Q,f as X}from"./l6qea03icve18kcf.js";import{i as Y}from"./o18ouakn8cm15oum.js";import{a as Z,S as ee}from"./ibg3tdc73s1o7kfh.js";import{F as te}from"./d5ddqeckz7ncujms.js";import{W as ie}from"./j4mjggthdqynoz2x.js";import"./t7vnx1cc2uzzkq81.js";import"./ip3ne85ldg7fv7rs.js";import"./grqqoygx78z5w4fx.js";import"./hapan2fx2czn21gi.js";import"./kzhevji8i57j71hk.js";import"./h2gd34k3oh53zw7p.js";import"./ouhw3r04e64ny5cd.js";import"./i4c1gncd98zmt3g7.js";import"./o6tnov12l4y47p1a.js";import"./k4lih7nb4umlxxxc.js";import"./m3p85h1r7wwh3ar4.js";import"./hnwyihljdxrug66f.js";import"./ew5cyvt4eewrp7bl.js";import"./n8xzbxiejwlahre8.js";import"./p1uclklbtvr1kdj7.js";import"./kydr9ghab5t92b8t.js";import"./grb7n11yz9748g22.js";import"./ggy463e7z3oap1z2.js";import"./i3g2qaat3974kagr.js";import"./mncmjhre2pa3zjgy.js";import"./ekl1xxb2hl6h9vpu.js";import"./pc2givv05uuq8g6l.js";import"./dpavouct31i6z8p1.js";import"./ivaufcylsc183gln.js";import"./pbe38tec7dql0sh5.js";import"./ci2m3wbqqcn0abts.js";import"./oqppwvh4icbsp0jr.js";import"./n1daj33n3xqfllpk.js";import"./pcjr7askdf0x3oga.js";import"./ddgfe1sz0ssgqmwj.js";import"./ebbe56r21p4nhezb.js";import"./fk846ir6i1xkpllk.js";import"./jq1xbz38gn4vzp5i.js";import"./npnw55p1aubemod0.js";import"./dnxknpho0o9oqwh9.js";import"./o4bwxynaykkvfft8.js";import"./newlw2rxdofwj7y4.js";import"./nyeubqfi5ppvzgdr.js";import"./obtq7sfq52r3quc0.js";import"./ka28zal7zgew9liz.js";import"./kwkjmzn9zjnazhqf.js";import"./j6dzpp4h0n6rdhxr.js";function L({filePath:t,side:o,lineNumber:h,onSubmit:m,onDelete:r,onClose:a,initialComment:i}){const d=i?T(i):"",[n,s]=p.useState(i?T(i):""),[x,g]=p.useState(!i),[j,F]=p.useState(!1),y=p.useRef(null),N=V(),k=()=>{if(!n)return;const f=i?{...i,content:[{content_type:"text",text:n}]}:{id:crypto.randomUUID(),type:"comment",content:[{content_type:"text",text:n}],position:{side:o===G.old?"left":"right",path:t,line:h}};m?.(f),g(!1),y.current?.blur(),a?.()};return p.useEffect(()=>{!j&&i&&n===d&&setTimeout(()=>{g(!1)},100),j&&(g(!0),y.current?.focus())},[j,i,n,d]),e.jsx("div",{className:"gap-2 bg-gray-100/50 p-4 font-sans dark:bg-gray-900",id:i?.id,children:e.jsxs("div",{className:w("flex flex-col gap-2",$),children:[e.jsx(Y,{ref:y,className:"border-token-border-medium bg-token-main-surface-primary text-token-text-primary border-1.5 w-full resize-none rounded-lg p-4 text-sm ring-0 focus:border-black focus:outline-hidden dark:focus:border-white",onFocus:()=>F(!0),onBlur:()=>F(!1),placeholder:N.formatMessage({id:"code.diff.addComment",defaultMessage:"Add a comment"}),minRows:1,maxRows:10,autoFocus:!i,onSubmit:()=>{},value:n,onChange:f=>s(f.target.value),onKeyDown:f=>{f.key==="Enter"&&f.metaKey&&(f.preventDefault(),k()),f.key==="Escape"&&(f.preventDefault(),a?.())}}),x&&e.jsxs("div",{className:w("mt-2 flex items-center justify-between gap-2",!r&&"justify-end"),children:[r&&e.jsx(S,{color:"danger",onClick:()=>r?.(),children:e.jsx(u,{id:"code.diffComment.delete",defaultMessage:"Delete"})}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(S,{color:"secondary",onClick:()=>{a?.(),g(!1),i&&s(T(i))},children:e.jsx(u,{id:"code.diffComment.cancel",defaultMessage:"Cancel"})}),e.jsx(S,{color:"primary",disabled:!n,onClick:k,children:i?e.jsx(u,{id:"code.diffComment.save",defaultMessage:"Save"}):e.jsx(u,{id:"code.diffComment.comment",defaultMessage:"Comment"})})]})]})]})})}function T(t){return t.content.map(o=>o.content_type==="text"?o.text:"").join("")}function oe({copyDiffToClipboard:t,copyPatchToClipboard:o,unifiedDiff:h,setUnifiedDiff:m}){const[r,a]=p.useState(!1),i=d=>n=>{n.preventDefault(),n.stopPropagation(),d==="diff"?t():o()};return e.jsxs(P,{open:r,onOpenChange:a,contentAlign:"end",sideOffset:8,triggerButton:e.jsx("button",{type:"button",onClick:d=>{d.preventDefault(),d.stopPropagation(),a(!0)},className:"hover:bg-token-border-light rounded p-1",children:e.jsx(z,{className:"icon-md"})}),children:[e.jsx(v.Item,{icon:E,onClick:i("diff"),children:e.jsx(u,{id:"wham.copyFile.apply",defaultMessage:"Copy git apply"})}),e.jsx(v.Item,{icon:E,onClick:i("patch"),children:e.jsx(u,{id:"wham.copyFile.patch",defaultMessage:"Copy patch"})}),e.jsx(v.Separator,{}),e.jsxs(v.RadioGroup,{value:h?"unified":"split",onValueChange:d=>m(d==="unified"),children:[e.jsx(v.RadioItem,{value:"split",children:e.jsxs("div",{className:"text-token-text-primary flex items-center gap-3",children:[e.jsx(Z,{className:"icon-md"}),e.jsx(u,{id:"wham.message.modal.footer.splitDiff",defaultMessage:"Split diff"})]})}),e.jsx(v.RadioItem,{value:"unified",children:e.jsxs("div",{className:"text-token-text-primary flex items-center gap-3",children:[e.jsx(ee,{className:"icon-md"}),e.jsx(u,{id:"wham.message.modal.footer.unifiedDiff",defaultMessage:"Unified diff"})]})})]})]})}const ae="_diffView_avtz7_1",se={diffView:ae},M="wham-toggle-all-diffs";function re(t){return p.useEffect(()=>{function o(h){t(h.detail.open)}return window.addEventListener(M,o),()=>{window.removeEventListener(M,o)}},[t]),p.useCallback(o=>{window.dispatchEvent(new CustomEvent(M,{detail:{open:o}}))},[])}function ne({diff:t,viewType:o,stickyHeader:h,enableComments:m=!1,comments:r,onCommentCreate:a,onCommentDelete:i,onCommentUpdate:d,setUnifiedDiff:n}){const s=H(),x=V(),[g,j]=p.useState(()=>!q(t.diffFile)),[F,y]=p.useState(!1),N=K(),k=re(j);p.useEffect(()=>{t.diffFile.initTheme(s?"dark":"light")},[t.diffFile,s]);const f=(r??[]).reduce((l,c)=>{const b=c.position.path,_=c.position.side,D=c.position.line;l[b]||(l[b]={oldFile:{},newFile:{}});const B=_==="left"?l[b].oldFile:l[b].newFile;return B&&(B[D]={data:c}),l},{}),C=J(t.diffFile),R=()=>{navigator.clipboard.writeText(t.diffFile._newFileName),y(!0),setTimeout(()=>{y(!1)},1e3)},A=async()=>{t.hunksText&&(await navigator.clipboard.writeText(` (cd "$(git rev-parse --show-toplevel)" && git apply --3way <<'EOF' 
${t.hunksText} 
EOF
)`),N.success(x.formatMessage({id:"wham.message.modal.footer.copiedToClipboard",defaultMessage:"Copied git apply command to clipboard"}),{duration:3,hasCloseButton:!0}))},I=async()=>{t.hunksText&&(await navigator.clipboard.writeText(t.hunksText),N.success(x.formatMessage({id:"wham.codeDiff.copiedPatchToClipboard",defaultMessage:"Copied patch to clipboard"}),{duration:3,hasCloseButton:!0}))},O=!t.diffFile.unifiedLineLength&&!t.diffFile.splitLineLength;return e.jsxs("div",{"data-diff-header":C,className:w("flex flex-col pt-1",se.diffView),children:[e.jsx("div",{role:"button",onClick:l=>{const c=!g;l.altKey?k(c):j(c)},className:w("focus-visible:outline-none",h&&"sticky top-0 z-1"),children:e.jsxs("div",{className:w("bg-token-bg-primary border-token-border-default relative flex items-center rounded-t-2xl border px-4 py-3 text-sm font-medium before:absolute before:inset-x-[-1px] before:top-[-1px] before:bottom-0 before:z-[-1] before:bg-[var(--right-bg)] before:content-['']",!g&&"rounded-b-2xl"),children:[e.jsx(U,{className:w("icon-md me-3 transition-transform duration-200",g&&"rotate-90")}),e.jsx("span",{className:"me-1 truncate text-start select-text",title:C,children:C}),e.jsx(te,{diffFile:t.diffFile}),e.jsx(W,{label:x.formatMessage({id:"wham.codeDiff.copiedFileName",defaultMessage:"Copied File Name"}),open:F,children:e.jsx("div",{role:"button",onClick:l=>{l.preventDefault(),l.stopPropagation(),R()},className:"hover:bg-token-border-light rounded p-1",children:e.jsx(E,{className:"icon-xs"})})}),e.jsxs("div",{className:"ms-auto flex items-center gap-1 ps-1",children:[e.jsx(ie,{linesAdded:t.diffFile.additionLength,linesRemoved:t.diffFile.deletionLength}),!t.isBinary&&e.jsx(oe,{copyDiffToClipboard:A,copyPatchToClipboard:I,unifiedDiff:o==="unified",setUnifiedDiff:n})]})]})}),g&&(O||t.isBinary?e.jsx("div",{className:"text-token-text-secondary bg-token-bg-secondary flex h-full justify-center rounded-b-2xl py-4 text-sm font-medium",children:t.isBinary?e.jsx(u,{id:"wham.diff.binaryFile",defaultMessage:"Binary file not shown"}):e.jsx(u,{id:"wham.diff.noContent",defaultMessage:"No content"})}):e.jsx(Q,{className:w("relative overflow-clip rounded-b-2xl transition-opacity duration-300","after:border-token-border-default after:pointer-events-none after:absolute after:inset-0 after:rounded-b-2xl after:border-s after:border-e after:border-b after:content-['']"),diffViewFontSize:12,diffFile:t.diffFile,diffViewTheme:s?"dark":"light",diffViewHighlight:!0,diffViewMode:o==="split"&&!X(t.diffFile)?3:4,diffViewWrap:!0,diffViewAddWidget:m,extendData:f[t.diffFile._newFileName],renderExtendLine:({lineNumber:l,side:c,data:b})=>!m||!(c===1?f[t.diffFile._newFileName]?.oldFile:f[t.diffFile._newFileName]?.newFile)?null:e.jsx(L,{initialComment:b,onSubmit:D=>d?.(D),onDelete:()=>i?.(b),filePath:t.diffFile._newFileName,side:c,lineNumber:l}),renderWidgetLine:({onClose:l,lineNumber:c,side:b})=>!m||!a?null:e.jsx(L,{onSubmit:a,onClose:l,filePath:t.diffFile._newFileName,side:b,lineNumber:c})}))]})}function at({diffFiles:t,unifiedDiff:o,setUnifiedDiff:h,enableComments:m,comments:r,setComments:a}){if(!t.length)return e.jsx("div",{className:"flex h-full w-full flex-1 items-center justify-center",children:e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(u,{id:"wham.whamTaskPageCodeDiffContent.noDiffAvailable",defaultMessage:"No diff available"})})});function i(s){!a||!r||a([...r,s])}function d(s){!a||!r||a(r.filter(x=>x.id!==s.id))}function n(s){!a||!r||a(r.map(x=>x.id===s.id?s:x))}return e.jsx("div",{className:"relative h-full w-full pt-6",children:e.jsx("div",{className:"flex h-full w-full flex-col gap-6 overflow-y-auto px-6 pb-6",children:t.map(s=>e.jsx(ne,{diff:s,stickyHeader:!0,viewType:o?"unified":"split",setUnifiedDiff:h,enableComments:m,comments:m?r:[],onCommentCreate:i,onCommentDelete:d,onCommentUpdate:n},s.diffFile._newFileName))})})}export{at as WhamTaskPageCodeDiffContent};
//# sourceMappingURL=jn01senr92hfi6zo.js.map
