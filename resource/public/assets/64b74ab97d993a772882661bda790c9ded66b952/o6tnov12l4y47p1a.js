import{e as $,k as L,f as x,r as g,i as R,u as F,a as Q,c as J,b as Y}from"./ci5tkrccytan34lo.js";import{an as d,b as C,gx as j,gB as z,gC as V,gD as W,gE as X,ah as G,ac as y,ap as Z,ai as ee,I as ne,b5 as te,aT as oe}from"./ccccre6vnqbb7l94.js";import{u as se}from"./k4lih7nb4umlxxxc.js";import{gb as ae,gc as re,gd as b,ge as ce,q as ie,gf as D,gg as A,gh as I,gi as ue,gj as le}from"./fztttvm3qzdvif1h.js";const B=()=>{const e=ae(),{connectorConfig:n,isLoading:t,error:o,refetch:a}=re(),s=n.has(d.CONFLUENCE)&&!e,r=n.has(d.GDRIVE)&&!e,c=n.has(d.JIRA)&&!e,i=n.has(d.NOTION_OPEN_CONNECTOR)&&!e,u=(n.has(d.O365_PERSONAL)||n.has(d.O365_BUSINESS))&&!e,l=n.has(d.SLACK_OPEN_CONNECTOR)&&!e;return{isConfluenceEnabled:s,isGdriveEnabled:r,isJiraEnabled:c,isNotionOpenConnectorEnabled:i,isO365Enabled:u,isSlackOpenConnectorEnabled:l,connectorConfig:n,isLoading:t,hasContextConnectorEnabled:s||r||c||i||u||l,error:o,refetch:a}},Re=()=>{const e=x();return n=>{const t=window.location.hash,[o,a]=t.split("?"),s=new URLSearchParams(a);n?s.set(b,"true"):s.delete(b);const r=s.toString()?`${o}?${s.toString()}`:o;e(r,{replace:!0})}},ye=()=>{const{hash:e}=L(),n=e.indexOf("?");return n===-1?!1:new URLSearchParams(e.substring(n+1)).get(b)==="true"},Ae=()=>{const{hash:e}=L(),n=e.indexOf("?");return n===-1?!1:new URLSearchParams(e.substring(n+1)).get(ce)==="true"},Ie=()=>{const e=x();return n=>{const t=window.location.hash,[o,a]=t.split("?"),s=new URLSearchParams(a);n?s.set("connector",n):s.delete("connector");const r=s.toString()?`${o}?${s.toString()}`:o;e(r,{replace:!0})}},P=e=>{const{hash:n}=L();return g.useMemo(()=>{const t=n.indexOf("?");return t===-1?void 0:new URLSearchParams(n.slice(t+1)).get(e)??void 0},[n,e])},Pe=()=>P("redirectAfter"),ke=()=>P("productSku"),we=()=>P("connector"),de=e=>e.supported_auth.some(n=>n.type==="OAUTH")?"OAUTH":"NONE",fe=e=>C.safePost("/aip/connectors/links/noauth",{requestBody:{connector_id:e.id,name:e.name,action_names:e.actions.map(n=>n.name)}}),Ce=async(e,n,t,o=!1,a)=>{const s=j[e.id],r={connectorId:e.id,name:e.name,actionNames:e.connector_type==="MCP"||e.connector_type==="OPEN_API"?e.actions.map(c=>c.name):V[s],oauthClientId:z(s),oauthClientScopes:null};await W(X,r,t||(o?`${D}?connector=${e.id}`:D),void 0,a)},he=async(e,n,t=!1)=>{switch(de(e)){case"OAUTH":return await Ce(e,n,void 0,t),null;case"NONE":return await fe(e)}},Se=(e,n)=>C.safePost("/accounts/{account_id}/connectors/{connector_id}/publish",{parameters:{path:{account_id:n,connector_id:e}}}),Te=()=>{const e=ie(),n=se(),t=g.useMemo(()=>n.data?.connection_statuses.filter(r=>["google_drive_oauth","google_drive_dwd"].includes(r.user_connection_details.knowledge_connector_type)),[n.data]),o=B(),a=o.connectorConfig.get(d.GDRIVE),s=o.isGdriveEnabled&&!!a;return{isLoading:n.isLoading||o.isLoading,fileUploadConfig:s?a:null,internalKnowledgeEnabled:e,internalKnowledgeConfigs:e&&t?.length?t:null}},Me=()=>{const e=B(),n=e.connectorConfig.get(d.O365_PERSONAL),t=e.connectorConfig.get(d.O365_BUSINESS);return{isLoading:e.isLoading,personalConfig:e.isO365Enabled&&n?.access_token?n:null,businessConfig:e.isO365Enabled&&t?.access_token?t:null}};async function ve(e){return(await C.safeGet("/aip/connectors/mcp/oauth_config",{parameters:{query:{mcp_url:e}}})).oauth_config}function Ue(e){return C.safePost("/aip/connectors/mcp/refresh_actions",{requestBody:{link_id:e}})}function H(e){return C.safeGet("/aip/connectors/{connector_id}/conformance",{parameters:{path:{connector_id:e}}})}function ge(e){return C.safeDelete("/aip/connectors/{connector_id}",{parameters:{path:{connector_id:e}}})}const me=$({gdriveBrandName:{id:"81dp6y",defaultMessage:"Google Drive"}}),qe=(e,n)=>e==="gdrive_action_connector"?n.formatMessage(me.gdriveBrandName):e;function pe(e){const{isLoading:n,error:t,refetch:o,platformConnectors:a}=A(),s=a.get(e);return{enabled:!!s&&s.status!=="DISABLED_BY_ADMIN",isLoading:n,error:t,refetch:o}}function De(){return pe(G[ee.GITHUB_CONNECTOR])}function _e(e,n,t){const o=ue(),a=R(),s=y(),{data:r,isLoading:c,error:i,refetch:u}=F({queryKey:["connector-client-data",e],queryFn:async()=>{const l=await C.safeGet("/aip/connectors/oauth_clients",{parameters:{query:{service:n}},additionalHeaders:{[te]:t}});return l.oauth_clients?l.oauth_clients:(s.danger(a.formatMessage({id:"OfpT7B",defaultMessage:"Request error fetching oauth clients"}),{id:"fetch-oauth-clients-error",duration:3,hasCloseButton:!0}),[])},enabled:o});return{oAuthClients:r,isLoading:c,error:i,refetch:u}}function xe(e,n,t="/",o,a,s){const{platformConnectors:r,isLoading:c,error:i,refetch:u}=A(!0,o),{connectorLinks:l,isLoading:h,error:O,refetch:f}=I({productSku:o}),{oAuthClients:p,isLoading:k,error:K,refetch:w}=_e(e,n,o),S=Ee(),_=g.useCallback(()=>{u(),f(),w()},[u,f,w]),m=G[e],T=r.get(m),M=l.has(m),N=l.get(m)?.[0]?.id,v=g.useCallback(()=>{N&&S(N,()=>{_()},o)},[S,_,N,o]),U=i??O??K,E=c||h||k,q=g.useCallback(()=>{if(!E){if(!T){a?.();return}if(!p?.length){s?.();return}window.location.hash=`#settings/ConnectorSettings?connector=${m}&add-connector-link=true&redirectAfter=${t}&productSku=${o}`}},[E,T,p,m,a,s,t,o]);return g.useMemo(()=>({isLoading:E,isConnected:M,openGithubModal:q,error:U,refetch:_,handleDisconnect:v}),[E,M,q,U,_,v])}function Fe(){"use forget";const e=J.c(12),n=R(),t=y(),o=ne(),{refetch:a}=A(),{refetch:s}=I();let r;e[0]!==o?(r=async l=>{const{supported_auth:h,...O}=l,{connector:f}=await C.safePost("/aip/connectors/mcp",{requestBody:{...O,auth_request:{supported_auth:h,oauth_client_params:null}}});if(f.supported_auth.length===0&&!(await H(f.id)).implements_retrievable)return await ge(f.id),{connector:null,link:null,implementsRetrievable:!1};const p=await he(f,o,!0);return{connector:f,link:p,implementsRetrievable:!0}},e[0]=o,e[1]=r):r=e[1];let c;e[2]!==n||e[3]!==t?(c=l=>{const h=l instanceof oe&&l.status===409?n.formatMessage({id:"Tedt6I",defaultMessage:"Connector name already exists"}):n.formatMessage({id:"9J7rOY",defaultMessage:"Error creating connector"});t.danger(h)},e[2]=n,e[3]=t,e[4]=c):c=e[4];let i;e[5]!==a||e[6]!==s?(i=()=>{a(),s()},e[5]=a,e[6]=s,e[7]=i):i=e[7];let u;return e[8]!==r||e[9]!==c||e[10]!==i?(u={mutationFn:r,onError:c,onSettled:i},e[8]=r,e[9]=c,e[10]=i,e[11]=u):u=e[11],Y(u)}function Ee(){const e=R(),n=y(),t=Z(),o=I(),a=Q();return async(r,c,i)=>{try{await le(r,i),a.invalidateQueries({queryKey:["fetchConnectorLinkData",t?.normalizedAccountUserId]}),await o.refetch(),c?.()}catch{n.danger(e.formatMessage({id:"Gmong7",defaultMessage:"Error disconnecting connector"}))}}}function Ge(e,n=!0){return F({queryKey:["checkConnectorConformance",e],queryFn:async()=>(await H(e)).implements_retrievable,enabled:n})}export{De as a,xe as b,B as c,Ie as d,Ee as e,Te as f,Me as g,ge as h,de as i,fe as j,Ge as k,qe as l,we as m,Ce as n,Pe as o,Se as p,ke as q,Ue as r,Fe as s,ve as t,pe as u,ye as v,Ae as w,Re as x};
//# sourceMappingURL=o6tnov12l4y47p1a.js.map
