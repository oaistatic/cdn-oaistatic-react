import{ac as j,q as R,fd as K,fe as q}from"./ccccre6vnqbb7l94.js";import{a as B,i as F,f as y,r as e,j as n,a9 as L,k as N,D as Q}from"./ci5tkrccytan34lo.js";import{e as U,f as O,c as $,W as G,d as z}from"./t7vnx1cc2uzzkq81.js";import{b as H,c as J}from"./grqqoygx78z5w4fx.js";import{P as V}from"./hapan2fx2czn21gi.js";import{g7 as X,bc as d,bd as x}from"./fztttvm3qzdvif1h.js";import{u as Y,W as Z}from"./l6qea03icve18kcf.js";import{u as I}from"./ew5cyvt4eewrp7bl.js";import{u as tt}from"./i97948bily1a57ta.js";import{i as st}from"./j4mjggthdqynoz2x.js";import"./kzhevji8i57j71hk.js";import"./h2gd34k3oh53zw7p.js";import"./ip3ne85ldg7fv7rs.js";import"./ouhw3r04e64ny5cd.js";import"./i4c1gncd98zmt3g7.js";import"./o6tnov12l4y47p1a.js";import"./k4lih7nb4umlxxxc.js";import"./m3p85h1r7wwh3ar4.js";import"./hnwyihljdxrug66f.js";import"./p1uclklbtvr1kdj7.js";import"./kydr9ghab5t92b8t.js";import"./grb7n11yz9748g22.js";import"./ggy463e7z3oap1z2.js";import"./i3g2qaat3974kagr.js";import"./mncmjhre2pa3zjgy.js";import"./ekl1xxb2hl6h9vpu.js";import"./pc2givv05uuq8g6l.js";import"./dpavouct31i6z8p1.js";import"./ivaufcylsc183gln.js";import"./pbe38tec7dql0sh5.js";import"./ci2m3wbqqcn0abts.js";import"./oqppwvh4icbsp0jr.js";import"./n1daj33n3xqfllpk.js";import"./pcjr7askdf0x3oga.js";import"./ddgfe1sz0ssgqmwj.js";import"./ebbe56r21p4nhezb.js";import"./fk846ir6i1xkpllk.js";import"./jq1xbz38gn4vzp5i.js";import"./npnw55p1aubemod0.js";import"./dnxknpho0o9oqwh9.js";import"./o4bwxynaykkvfft8.js";import"./newlw2rxdofwj7y4.js";import"./nyeubqfi5ppvzgdr.js";import"./obtq7sfq52r3quc0.js";import"./n8xzbxiejwlahre8.js";import"./kwkjmzn9zjnazhqf.js";import"./j6dzpp4h0n6rdhxr.js";function rt({taskId:s,onClose:i}){const o=B(),c=j(),a=F(),u=y(),{data:t,error:b}=U(s);O(s);const w=$(({getTurnsForTask:r})=>r(s)),m=R(),l=e.useMemo(()=>m?new V(H()):new X,[m]),f=e.useSyncExternalStore(r=>l.subscribe("change",r),()=>!l.isEmpty(),()=>!1),[k,p]=e.useState([]),[D,_]=e.useState(!1),{focusedAssistantTurn:C,setFocusedAssistantTurnId:M}=Y({taskId:s,task:t?.task,currentDiffTaskTurn:t?.current_diff_task_turn??null,currentUserTurn:t?.current_user_turn??null,currentAssistantTurn:t?.current_assistant_turn??null}),h=!!t?.task.has_unread_turn&&t?.task?.current_turn_id===t.current_assistant_turn?.id,g=t?.current_assistant_turn?.turn_status==="completed";e.useEffect(()=>{if(!m)return;const r=t?.task?.title;if(r){const E=document.title;return document.title=r,()=>{document.title=E}}},[m,t?.task?.title]),e.useEffect(()=>{h&&g&&G.markTurnAsRead(s).then(()=>{o.invalidateQueries({queryKey:["wham","tasks"]}),o.invalidateQueries({queryKey:["wham","task",s]})})},[h,g,s,o]),tt(),I([{key:"newTask",action:()=>u("/codex",{state:{focusComposer:!0}}),actionMessageDescriptor:a.formatMessage({id:"wham.keyboardActions.newTask",defaultMessage:"New task"}),group:x.Chat,keyboardBinding:[d.Mod,d.Shift,"o"]},{key:"closeTask",action:()=>u("/codex"),actionMessageDescriptor:a.formatMessage({id:"wham.keyboardActions.closeTask",defaultMessage:"Close task"}),group:x.Chat,keyboardBinding:[d.Escape]}]);const T=k.length>0,P=e.useCallback(({force:r=!1}={})=>{if(r||!T&&!f){p([]),i();return}_(!0)},[i,T,f]),S=t?.current_assistant_turn?st(t?.current_assistant_turn.turn_status):!1,W=t?.current_diff_task_turn?.id===C?.id,A=!t?.current_diff_task_turn,v=S&&(W||A);return b?(c.danger(a.formatMessage({id:"wham.task-details.error",defaultMessage:"Error loading task"}),{id:`wham-task-details-error-${s}`,hasCloseButton:!0,duration:3}),n.jsx(L,{to:"/codex"})):n.jsx(J.Provider,{value:l,children:n.jsx(Z,{permissions:"write",taskId:s,turnId:t?.current_assistant_turn?.id??"",lastTurnWithDiffId:t?.current_diff_task_turn?.id??"",confirmClose:D,setConfirmClose:_,task:t?.task,focusedAssistantTurn:C,pastTurns:w,clearComments:()=>p([]),setComments:p,comments:k,canFollowUp:v,handleClose:P,setFocusedAssistantTurnId:M})})}function et(){const s=y(),i=N(),{taskId:o}=Q();z();const c=i.state??{},{backgroundLocation:a}=c,u=e.useCallback(()=>{s(a?-1:"/codex")},[a,s]);return o?n.jsx(K,{children:n.jsx(rt,{taskId:o,onClose:u})}):null}const Yt=()=>[{title:"Codex"}],Zt=q(function(){return n.jsx(et,{})});export{Zt as default,Yt as meta};
//# sourceMappingURL=e66leloccoabx2o4.js.map
