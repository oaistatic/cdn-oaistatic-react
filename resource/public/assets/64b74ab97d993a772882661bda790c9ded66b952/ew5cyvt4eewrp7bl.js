import{j as t,i as E,r as i,o as F,M as T}from"./ci5tkrccytan34lo.js";import{fT as _,ai as I,fM as q,cN as W,fL as L,dA as V,d0 as G,ku as H,bc as O,bd as U,kv as Y,dy as z,b5 as Z,kw as $}from"./fztttvm3qzdvif1h.js";import{c as J,S as Q,C as X,W as ee}from"./t7vnx1cc2uzzkq81.js";import{c as v,aC as te,aj as se}from"./ccccre6vnqbb7l94.js";import{I as re}from"./n8xzbxiejwlahre8.js";function ae({triggerText:e,toolTip:r,ariaLabel:s,Icon:a,truncate:o=!0}){return t.jsx(_,{className:"border-token-border-default text-token-text-primary bg-token-bg-primary hover:bg-token-bg-tertiary rounded-full border px-2 py-1","aria-label":s,children:t.jsx(I,{label:r,className:"text-sm font-medium",children:t.jsxs("div",{className:"flex max-w-full items-center gap-1.5 ps-2",children:[a,t.jsx("span",{className:v("hidden sm:block",o?"max-w-[8rem] truncate md:max-w-[10rem]":"w-fit"),children:e}),t.jsx(q,{"aria-hidden":!0,className:"icon-sm"})]})})})}function ne({children:e,className:r,onClick:s,isSelected:a,isActive:o,isVirtualHover:d=!1,label:f,isDisabled:c,tooltipLabel:l,isSubMenuTrigger:u,noDefaultHoverState:m,as:y="button",truncateLabel:p,infoIcon:x,infoLink:M,icon:g,...w}){const k=E();let h=t.jsx(t.Fragment,{});e?h=t.jsx("div",{className:"flex flex-1 items-center gap-4",children:e}):f&&(h=t.jsxs("div",{className:v("flex items-center gap-3",p?"w-0 flex-1":"w-full"),children:[g&&(i.isValidElement(g)?g:t.jsx(oe,{icon:g})),f&&t.jsx("div",{className:v("flex flex-col items-start px-1 py-1",c&&"text-token-text-quaternary pointer-events-none",p&&"w-full"),children:t.jsx("div",{className:v("flex items-center gap-2 text-start text-sm",p&&"w-full"),children:f})})]}),l&&(h=t.jsx(I,{sideOffset:-10,label:l,className:"w-full",children:h})));const N=t.jsxs("div",{className:"min-w-[18px] items-center justify-center",children:[a&&t.jsx(W,{className:v("icon-md","color:var(--tint-color,#0285FF)"),"aria-label":k.formatMessage({id:"wham.codexMenuRow.selected",defaultMessage:"Selected"})}),x&&M&&t.jsx("a",{href:M,target:"_blank",rel:"noopener noreferrer",children:x}),u&&t.jsx(L,{className:"icon-md text-token-text-tertiary w-7","aria-label":k.formatMessage({id:"wham.codexMenuRow.openSubmenu",defaultMessage:"Open submenu"})})]}),C=v("flex cursor-pointer items-center gap-4 rounded-lg px-2 py-1.5 pe-3",o&&"bg-black/5 dark:bg-white/5",!m&&"hover:bg-black/5 dark:hover:bg-white/5",d&&"bg-black/5 dark:bg-white/5",r);if(y==="div"){const b=w;return t.jsxs("div",{...b,className:C,children:[h,N]})}const B=w;return t.jsxs("button",{type:"button",...B,onClick:b=>{b.persist(),requestAnimationFrame(()=>{s?.(b)})},className:C,children:[h,N]})}function oe({icon:e}){const r=e;return t.jsx("div",{className:"text-token-text-secondary flex h-5 w-5 items-center justify-center",children:t.jsx(r,{className:"h-5 w-5 shrink-0","aria-label":""})})}const A="wham-environment-popover-event";function ce(e,r,s){i.useEffect(()=>{function o(d){d.detail.popover!==e&&s()}return window.addEventListener(A,o),()=>{window.removeEventListener(A,o)}},[e,s]);const a=i.useCallback(o=>{window.dispatchEvent(new CustomEvent(A,{detail:{popover:o}}))},[]);i.useEffect(()=>{r&&a(e)},[r,a,e])}const ie=({items:e,onSelect:r,keyExtractor:s})=>{const[a,o]=i.useState(null),[d]=i.useState(new Map);return{hoveredId:a,setHoveredId:o,getItemRef:c=>l=>{const u=s(c);return l&&d.set(u,l),()=>{d.delete(u)}},itemRefs:d,onKeyDown:c=>{const l=c.key==="ArrowDown"||c.key==="n"&&c.ctrlKey,u=c.key==="ArrowUp"||c.key==="p"&&c.ctrlKey;if(!(l||u||c.key==="Enter"))return;if(c.preventDefault(),c.key==="Enter"){a&&r(a);return}const m=e.findIndex(x=>s(x)===a),y=V(m-(u?1:-1),0,e.length-1),p=s(e[y]);d.get(p)?.scrollIntoView({behavior:"instant",block:"nearest"}),o(p)}}},S=te(e=>({actions:[],addActionsActions:r=>e(s=>({actions:G([...s.actions,...r],a=>a.key)})),removeActionsActions:r=>{const s=r.map(a=>a.key);return e(a=>({actions:a.actions.filter(o=>!s.includes(o.key))}))}})),le=e=>H(e,r=>{se.addAction("wham_keyboard_shortcut",{keyboardActionKey:r.key})},{enabled:!0});function ge(){return S(e=>e.actions)}function ue(e=[]){const r=S(a=>a.addActionsActions),s=S(a=>a.removeActionsActions);i.useEffect(()=>(r(e),()=>s(e)),[e,r,s]),le(e)}function P(e){return e.length>18?`â€¦${e.slice(-18)}`:e}function we({environment:e}){const r=E(),{branch:s,setBranch:a}=J(),[o,d]=i.useState(""),[f,c]=i.useState(!1),l=i.useRef(null),u=()=>c(!1),m=i.useRef(e.repos[0]??null);return i.useEffect(()=>{(m.current!==e.repos[0]||!s)&&(m.current=e.repos[0],a(R(e)))},[s,a,e]),ce("branch",f,()=>c(!1)),ue([{key:"whamBranches",action:()=>c(!0),actionMessageDescriptor:r.formatMessage({id:"wham.keyboardActions.whamBranches",defaultMessage:"Branches"}),group:U.Chat,keyboardBinding:[O.Mod,"b"]}]),t.jsx("div",{className:"items-center rounded-full",children:t.jsxs(Y,{open:f,onOpenChange:c,children:[t.jsx(ae,{triggerText:P(s??"")??r.formatMessage({id:"wham.codexBranchPopover.selectABranch",defaultMessage:"Select a Branch"}),toolTip:P(s??"")===s||f?"":s?.length?s:r.formatMessage({id:"wham.codexBranchPopover.searchForYourBranchTooltip",defaultMessage:"Search for your branch"}),ariaLabel:r.formatMessage({id:"wham.codexBranchPopover.searchForYourBranchAria",defaultMessage:"Search for your branch"}),Icon:t.jsx(Q,{"aria-hidden":!0,className:"icon-sm"}),truncate:!1}),t.jsx(X,{align:"start",sideOffset:12,isOpen:f,closePopover:u,popoverContentRef:l,children:t.jsx(de,{environment:e,repoId:m,searchQuery:o,setSearchQuery:d,setBranch:a,selectedBranch:s??"",closePopover:u})})]})})}function de({environment:e,repoId:r,setBranch:s,selectedBranch:a,searchQuery:o,setSearchQuery:d,closePopover:f}){const c=E(),l=i.useRef(null),u=z(o,300),{data:m,isLoading:y,fetchNextPage:p,hasNextPage:x,isFetchingNextPage:M,error:g}=F({queryKey:["searchBranches",r.current,u],enabled:!!r.current,initialPageParam:null,queryFn:({pageParam:n})=>ee.searchBranchesByRepository(r.current??"",u,$,n??null),getNextPageParam:n=>n?.cursor??null}),w=i.useMemo(()=>{const n=m?.pages?.flat().map(K=>K.items.flatMap(D=>D.branch))?.flat()??[],j=R(e);return j&&!n.includes(j)&&n.unshift(j),n},[m,e]),k=n=>{s(n),f()},h=i.useMemo(()=>o?.trim()?w.filter(n=>n.toLowerCase().includes(o.toLowerCase())):w??[],[o,w]),{hoveredId:N,setHoveredId:C,onKeyDown:B,getItemRef:b}=ie({items:h,keyExtractor:n=>n,onSelect:k});return i.useEffect(()=>{l.current&&l.current.focus()},[]),t.jsxs("div",{className:"bg-token-bg-primary flex max-h-[400px] w-72 flex-col gap-2 rounded-lg p-2",onClick:n=>{n.stopPropagation()},children:[t.jsx(Z,{ref:l,className:"w-full rounded-sm border-none px-2 py-1 text-sm focus:ring-0 focus:ring-offset-0 focus:outline-hidden",type:"text",autoComplete:"off",name:"search-branch",value:o,onKeyDown:B,onChange:n=>d(n.target.value),placeholder:c.formatMessage({id:"wham.codexBranchPopover.branch",defaultMessage:"Enter a branch"}),ariaLabel:c.formatMessage({id:"wham.codexBranchPopover.createBranchAria",defaultMessage:"Create a new branch"})}),t.jsxs("div",{className:"min-h-18 w-full overflow-y-auto",children:[h?.map(n=>{const j=n===a;return t.jsx(ne,{className:"w-full",as:"button",onMouseEnter:()=>C(n),isVirtualHover:N===n,ref:b(n),onClick:()=>{k(n)},isSelected:j,label:n},n)}),g?t.jsx("div",{className:"flex items-center justify-center",children:t.jsx(T,{id:"wham.branchPopover.error",defaultMessage:"Error loading branches"})}):null,t.jsx(re,{hasNextPage:x,fetchNextPage:p,isFetchingNextPage:M||y})]})]})}function R(e){for(const r of e.repos){const s=e.repo_map?.[r];if(s?.default_branch)return s.default_branch}return"main"}export{ae as C,ge as a,ce as b,we as c,ie as d,ne as e,R as g,ue as u};
//# sourceMappingURL=ew5cyvt4eewrp7bl.js.map
