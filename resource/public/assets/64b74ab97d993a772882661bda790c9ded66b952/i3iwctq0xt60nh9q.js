import{i as B,j as s,M as G,c as ys,e as We,a5 as Z,r as m,a6 as Ie,a as ht,b as Se,d as cn,u as gt,o as dn,ao as un}from"./ci5tkrccytan34lo.js";import{C as fn,a as mn}from"./ripbggolk2hb9coi.js";import{dZ as vs,uw as ze,iB as L,iC as $,mf as qe,ux as Es,a2 as Ct,O as $e,dT as pe,E as pn,d5 as xn,uy as hn,dP as gn,pU as Xt,rd as Cn,dW as bn,uz as yn,uA as vn,uB as Ts,dg as ye,eN as bt,fZ as En,nB as Zt,bQ as Tn,ai as fe,mI as ae,dU as T,b2 as Sn,pP as Jt,fS as wn,fT as _n,fV as An,fW as Mn,Q as Dn,uC as Fe,g3 as kn,ac as jn,ek as In,mh as Nn,cL as Ss,u6 as R,uD as On,uE as ws,uF as Pn,uG as Rn,d as Ln,uH as ut,uI as Hn,uJ as Bn,uK as Un,mv as Ae,uL as Fn,me as qn,uM as $n,dp as Gn,kM as Kn,uN as Wn,c as zn,uO as Vn,uP as Qn,uQ as Yn,uR as Xn,uS as Zn,uT as Jn,dQ as eo,dR as to,dS as so,o5 as es,uU as no,uV as oo,g as ao,uW as ro,n0 as io,uX as lo,iY as co,uY as ts,dV as ss,uZ as ns,u_ as Ue,u$ as os}from"./fztttvm3qzdvif1h.js";import{u as _s}from"./hapan2fx2czn21gi.js";import{gv as yt,aa as uo,a6 as fo,ab as ft,ds as As,n as mo,dL as po,dM as xo,dx as ho,dz as go,B as Ge,g$ as Co,d7 as bo,L as mt,M as Ms,E as as,c as ne,aj as vt,b as F,dG as Ds,ac as yo,e as pt,z as vo,cX as Eo,I as Ve,b0 as Qe,eT as To,bg as rs,bR as So,F as he,u as wo,dk as _o,de as Ao,o as Mo}from"./ccccre6vnqbb7l94.js";import{O as Do,b as xe,d as ko,c as ks,g as jo,A as Io,a as No,f as is,C as ve,D as Oo}from"./n3no0wqojk419ibl.js";import{e as Po}from"./fry4relkhm829fbi.js";import{C as Ro}from"./brm2ak4qsea0c84s.js";import{e as Lo,a as Ho,b as Bo,g as Uo}from"./jm451ka9dh0zq0oh.js";import{C as Ke,e as me,U as ls}from"./ehn8yucug7pv4ztd.js";import{a as Fo}from"./c576qrs41b9t65x5.js";import{S as qo,D as $o}from"./k6feznao7t0jcslv.js";import{i as Go}from"./o18ouakn8cm15oum.js";import{C as Ko}from"./ci2m3wbqqcn0abts.js";import{P as cs}from"./m3p85h1r7wwh3ar4.js";import{a as Wo,g as zo}from"./fleacu6r5buu7d0q.js";import{u as Vo,g as Qo,a as lt,S as Yo}from"./o44s14nukx2dxzhr.js";import{r as Xo}from"./jppil0z87oklini1.js";import{N as Zo}from"./jy1u8exw8iz2slve.js";import{S as Jo}from"./ouhw3r04e64ny5cd.js";import{s as ct,B as ea}from"./kydr9ghab5t92b8t.js";import{L as ta}from"./h1rqozkinxrlxfws.js";import{d as sa}from"./grqqoygx78z5w4fx.js";import{u as ds}from"./oqppwvh4icbsp0jr.js";import{i as us}from"./eek6z6v9ww7qwx26.js";import{u as xt,f as na,n as oa,g as aa}from"./gu8jz4865kkdzo16.js";var js=(t=>(t.Close="close",t.Loaded="loaded",t.Streaming="streaming",t.Download="download",t))(js||{});const ra=({isOpen:t,dismissModal:e,closeTextdocEditor:n,textdocVersion:o,clientThreadId:a})=>{const r=B(),i=vs(a),l=_s(a),h=yt(),c=ze(o?.textdocId),u=async p=>{L.logButtonClick($.SAVE_TO_CHAT_ON_EDITOR_CLOSE),!(o?.versionInt==null||h)&&(l({sourceEvent:p,promptMessage:As("",{canvas:{user_created_textdocs:o!=null&&o.status===Es.ATTACHED_PENDING&&c!=null?[{user_created_temp_textdoc_id:o.textdocId,type:o.type,title:o.title,content:o.content,create_source:c.create_source}]:void 0},open_in_canvas_view:{type:"canvas_textdoc",id:o.textdocId}}),completionMetadata:i?{conversationMode:i}:void 0}),c&&qe.markAsSent(c.tempTextdocId),e(),n())};return s.jsx(uo,{testId:"modal-confirm-close-editor",isOpen:t,size:"custom",className:"max-w-xl",onClose:e,type:"warning",hideSeparator:!0,title:s.jsx("span",{className:"text-xl",children:s.jsx(G,{id:"jgd5rD",defaultMessage:"Are you sure you want to close?"})}),primaryButton:s.jsx(ft.Button,{title:r.formatMessage({id:"XE+GiU",defaultMessage:"Save to chat"}),color:"primary",onClick:u}),secondaryButton:s.jsx(ft.Button,{title:r.formatMessage({id:"MbWco5",defaultMessage:"Donâ€™t save and close"}),color:"secondary",onClick:()=>{L.logButtonClick($.CLOSE_WITHOUT_SAVING),c&&qe.removeTempTextdoc(c.tempTextdocId),e(),n()}}),showCloseButton:!0,closeButton:s.jsx(fo,{onClick:e}),children:s.jsx("div",{className:"text-md text-token-text-secondary -mt-6 pb-2",children:s.jsx(G,{id:"q9rJ+Y",defaultMessage:"Changes will not be saved unless you save this canvas to your chat."})})})},Ye="https://persistent.oaistatic.com/canvas/nux-videos/",ia=`${Ye}canvas_writing.mp4`,la=`${Ye}canvas_coding.mp4`,ca=`${Ye}canvas_writing_hero.jpg`,da=`${Ye}canvas_coding_hero.jpg`,ua="https://help.openai.com/en/articles/9930697-what-is-the-canvas-feature-in-chatgpt-and-how-do-i-use-it",fa=t=>{"use forget";const e=ys.c(27),{onClose:n,title:o,description:a,asset:r,size:i}=t,l=B(),h=r===0,c=i===1?252:218;let u;e[0]!==c?(u={height:c},e[0]=c,e[1]=u):u=e[1];const p=h?ca:da,C=h?ia:la;let d;e[2]!==p||e[3]!==C?(d=s.jsx("video",{muted:!0,loop:!0,autoPlay:!0,playsInline:!0,className:"h-full max-w-none",poster:p,src:C}),e[2]=p,e[3]=C,e[4]=d):d=e[4];let v;e[5]!==u||e[6]!==d?(v=s.jsx("div",{className:"border-token-border-default bg-token-main-surface-secondary text-token-text-secondary relative flex w-full items-center justify-center overflow-hidden border-b",style:u,children:d}),e[5]=u,e[6]=d,e[7]=v):v=e[7];let x;e[8]!==o?(x=s.jsx(po,{className:"text-center text-xl leading-6 font-semibold",children:s.jsx(G,{...o})}),e[8]=o,e[9]=x):x=e[9];let y;e[10]!==a?(y=s.jsx(xo,{className:"text-token-text-secondary text-center text-sm",children:s.jsx(G,{...a})}),e[10]=a,e[11]=y):y=e[11];let f;e[12]!==x||e[13]!==y?(f=s.jsxs("div",{className:"flex flex-col gap-2",children:[x,y]}),e[12]=x,e[13]=y,e[14]=f):f=e[14];let b;e[15]!==l?(b=l.formatMessage(Te.button),e[15]=l,e[16]=b):b=e[16];let g;e[17]!==n||e[18]!==b?(g=s.jsx(ft.Button,{onClick:n,title:b,color:"primary"}),e[17]=n,e[18]=b,e[19]=g):g=e[19];let S;e[20]===Symbol.for("react.memo_cache_sentinel")?(S=s.jsxs(pn,{href:ua,className:"flex items-center gap-1 font-medium",children:[s.jsx(G,{...Te.learnMore}),s.jsx(xn,{className:"icon-sm"})]}),e[20]=S):S=e[20];let _;e[21]!==g||e[22]!==f?(_=s.jsxs("div",{className:"flex flex-col items-center gap-4 px-10 py-8",children:[f,g,S]}),e[21]=g,e[22]=f,e[23]=_):_=e[23];let E;return e[24]!==_||e[25]!==v?(E=s.jsxs("div",{className:"flex flex-col items-center focus:outline-hidden",children:[v,_]}),e[24]=_,e[25]=v,e[26]=E):E=e[26],E},ma=t=>{"use forget";const e=ys.c(11),{textdocType:n}=t,{markAsViewed:o}=Ct($e.hasDismissedCanvasContextualOnboarding),a=mo()?.document.body;let r,i,l;e[0]===Symbol.for("react.memo_cache_sentinel")?(r={opacity:.75,scale:.9},i={opacity:1,scale:1},l={type:"spring",bounce:.2,duration:.56},e[0]=r,e[1]=i,e[2]=l):(r=e[0],i=e[1],l=e[2]);const h=pe(n)?1:0,c=pe(n)?Te.contextualModalTitleCoding:Te.contextualModalTitleWriting,u=pe(n)?Te.contextualModalDescriptionCoding:Te.contextualModalDescriptionWriting;let p;e[3]!==o||e[4]!==h||e[5]!==c||e[6]!==u?(p=s.jsx(Z.div,{initial:r,animate:i,transition:l,className:"popover border-token-border-default bg-token-main-surface-primary fixed end-4 bottom-4 z-50 max-w-sm overflow-hidden rounded-2xl border shadow-xl",children:s.jsx(fa,{onClose:o,asset:h,size:0,title:c,description:u})}),e[3]=o,e[4]=h,e[5]=c,e[6]=u,e[7]=p):p=e[7];let C;return e[8]!==a||e[9]!==p?(C=s.jsx(ho,{open:!0,defaultOpen:!0,modal:!1,children:s.jsx(go,{container:a,children:p})}),e[8]=a,e[9]=p,e[10]=C):C=e[10],C},Te=We({contextualModalTitleWriting:{id:"Pi+0RT",defaultMessage:"Draft and refine on the spot"},contextualModalDescriptionWriting:{id:"Jv0f02",defaultMessage:"Make it shorter. Add an emoji. Translate to kindergartener. ChatGPT can do it all, right on the canvas."},contextualModalTitleCoding:{id:"Zi5Ty0",defaultMessage:"Refine and debug on the spot"},contextualModalDescriptionCoding:{id:"XnaO2x",defaultMessage:"Refactor code. Translate to Python. Check for bugs. ChatGPT can do it all, right on the canvas."},button:{id:"7bNl4/",defaultMessage:"Got it"},learnMore:{id:"vs1lx2",defaultMessage:"Learn more about canvas"}}),pa=({isTextdocStreaming:t,isRequestActive:e,value:n,comments:o})=>{const[a,r]=m.useState(!1);return m.useEffect(()=>{t&&a&&(r(!1),Ke.reset())},[n,o]),m.useEffect(()=>{e||(r(!1),Ke.reset())},[e]),[a,r]};function xa({onClickRestore:t,onClickResetLatest:e}){const n=B();return s.jsx(Z.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},transition:{bounce:0,duration:.24},className:"bg-token-main-surface-primary z-30",children:s.jsx(Z.div,{className:"bg-token-main-surface-primary dark:border-token-border-xlight @container w-full items-center border-t border-gray-100 p-6 shadow-[0_-4px_32px_rgba(0,0,0,0.08)] lg:border-s dark:shadow-[0_-4px_32px_rgba(0,0,0,0.12)]",children:s.jsxs("div",{className:"mx-auto flex max-w-[48rem] flex-col flex-wrap justify-center gap-5 @2xl:flex-row @2xl:justify-between",children:[s.jsxs("div",{className:"flex flex-col px-2 text-center @2xl:text-start",children:[s.jsx("span",{className:"text-md text-token-text-primary font-semibold text-wrap",children:n.formatMessage({id:"gt23pb",defaultMessage:"You are viewing a previous version"})}),s.jsx("span",{className:"text-token-text-secondary text-sm text-wrap",children:n.formatMessage({id:"sAlUJn",defaultMessage:"Restore this version to make edits"})})]}),s.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-4",children:[s.jsx(Ge,{as:"button",color:"primary",onClick:t,children:n.formatMessage({id:"+cddAb",defaultMessage:"Restore this version"})}),s.jsx(Ge,{as:"button",color:"secondary",onClick:e,children:n.formatMessage({id:"qCD3eu",defaultMessage:"Back to latest version"})})]})]})})})}const ha={type:"spring",bounce:.2,duration:.56},ga=({clientThreadId:t,turn:e})=>{const n=Co();return s.jsxs(Z.div,{className:"absolute start-0 end-0 top-0 z-10 -translate-y-full",children:[s.jsx(Z.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"bg-vert-light-gradient dark:from-token-main-surface-primary absolute inset-0 -top-5 dark:bg-linear-to-t dark:to-transparent"}),s.jsx(Z.div,{className:"flex items-center py-2",initial:{opacity:.75,translateX:-50,translateY:"100%"},animate:{opacity:1,translateX:0,translateY:"0"},exit:{opacity:0,filter:"blur(8px)",transition:{delay:.4,duration:.72}},transition:ha,children:s.jsx(Ko,{clientThreadId:t,onRequestCompletion:bo,groupedMessagesToRender:e.messageGroups,allGroupedMessages:e.messageGroups,allMessages:e.messages,isUserTurn:!0,isFinalUserTurn:!1,turnIndex:0,isCompletionRequestInProgress:!1,isFeedbackEnabled:!1,isFinalTurn:!1,hasActiveRequest:n})})]},"user-message")},Ca=({clientThreadId:t})=>{const{lastUserTurn:e,lastAssistantTurn:n}=mt(t,a=>{const r=Ms.getConversationTurns(a);let i=null,l=null;for(let h=r.length-1;h>0;h--){const c=r[h];if(!i&&c.role===as.User?i=c:!l&&c.role===as.Assistant&&(l=c),i&&l)break}return{lastUserTurn:i,lastAssistantTurn:l}}),o=e&&!n?.messages.some(a=>a.recipient?.startsWith(hn));return s.jsx(Ie,{initial:!1,children:o&&s.jsx(ga,{turn:e,clientThreadId:t})})},ba=({isRequestActive:t=!1,clientThreadId:e,readonlyReason:n,onCancel:o,onSubmit:a,onSubmitAccelerator:r,acceleratorActions:i=[]})=>{const[l,h]=m.useState(!1),[c,u]=m.useState(""),[p,C]=m.useState(!0),d=B(),[v,x]=m.useState(!1),y=gn(),f=g=>{a?.(g,c),u("")},b=g=>{if(g.nativeEvent.isComposing)return;const{metaKey:S,shiftKey:_,key:E}=g;E==="Enter"&&c.trim()&&!(_||S)&&(f(g),g.preventDefault())};return s.jsxs(s.Fragment,{children:[l&&!y&&s.jsx(Do,{zIndexKey:"acceleratorsOverlay",className:"bg-white/95 dark:bg-black/85"}),s.jsx("div",{className:"relative mb-3 flex items-end justify-center",children:s.jsxs("div",{className:"relative mx-6 max-w-2xl flex-1",children:[s.jsx(Ca,{clientThreadId:e}),s.jsx("div",{className:"flex flex-auto items-start",children:s.jsx("div",{className:ne("dark:bg-token-main-surface-secondary flex min-h-12 flex-auto items-center bg-[#f4f4f4] py-1 ps-6 pe-2",{"rounded-full":p,"rounded-2xl":!p,"bg-transparent":v}),children:s.jsxs("div",{className:"relative flex flex-auto items-center self-stretch",children:[s.jsx(Go,{placeholder:d.formatMessage({id:"zrUbTJ",defaultMessage:"Ask ChatGPT to edit"}),disabled:t,value:c,className:ne("text-token-text-primary placeholder:text-token-text-secondary w-full resize-none border-0 bg-transparent p-0 outline-0 focus:ring-0 focus-visible:ring-0",{"opacity-0":v}),maxRows:4,onChange:({target:{value:g}})=>u(g),onKeyDown:b,onHeightChange:(g,{rowHeight:S})=>C(Math.floor(g/S)<=1)}),c?s.jsx(Z.button,{className:ne("dark bg-token-main-surface-primary h-8 w-8 rounded-full text-center disabled:bg-[#D7D7D7]",{"self-end":!p}),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.1},onMouseDown:f,children:s.jsx(qo,{className:"text-token-text-primary h-8 w-8"})}):(i?.length??0)>0&&s.jsx($o,{disableHint:!0,isVisuallyHidden:n?.isReadonly&&!n.isStreaming,disableOverlay:!0,isEmbeddedInPromptArea:!0,isRequestActive:t,actions:i,onCancel:o,onExpandedChange:g=>{y||x(g),h(g)},onSubmit:r,right:0,bottom:4})]})})})]})})]})};function ya(t,e){const n=new Set(t.map(l=>l.id)),o=new Set(e.map(l=>l.id)),a=t.filter(l=>!o.has(l.id)).map(l=>({...l,diffStatus:Xt.REMOVED})),r=e.filter(l=>!n.has(l.id)).map(l=>({...l,diffStatus:Xt.ADDED})),i=t.filter(l=>o.has(l.id));return a.concat(r,i)}const va=t=>{const{textdocId:e}=t,n=Cn(o=>o?.resolveTempTextdocId[e]??e);return m.useMemo(()=>({...t,textdocId:n}),[n,t])};async function Ea({textdocId:t,newTitle:e}){e!=null&&await F.safePost("/textdoc/{textdoc_id}/rename",{parameters:{path:{textdoc_id:t}},requestBody:{title:e}}).catch(n=>{vt.addError("renameCanvasTitle Error:",n)})}const Ta=({serverThreadId:t,textdocVersion:e,initialTitle:n="Untitled Document",isEditingTitle:o,setIsEditingTitle:a})=>{const r=ht(),{mutateAsync:i}=Se({mutationKey:[t,"textdocs"],mutationFn:Ea,onMutate:async({textdocId:f,newTitle:b})=>{await r.cancelQueries({queryKey:[t,"textdocs"]});const g=r.getQueryData([t,"textdocs"]);return r.setQueryData([t,"textdocs"],S=>{if(!S)return S;const _=new Map(S.persistedTextdocVersionById),E=_.get(f);if(E){const N={...E,title:b??""};_.set(f,N)}const D=S.persistedTextdocVersions.map(N=>N.textdocId===f?{...N,title:b??""}:N),j=new Map(S.persistedTextdocById),P=j.get(f);if(P){const N={...P,title:b??""};j.set(f,N)}return{...S,persistedTextdocVersionById:_,persistedTextdocVersions:D,persistedTextdocById:j}}),{previousTextDocData:g}},retry:2,onError:(f,b,g)=>{g?.previousTextDocData&&r.setQueryData([t,"textdocs"],g.previousTextDocData),vt.addError("Error updating title:",f)},onSettled:()=>{r.invalidateQueries({queryKey:[t,"textdocs"]})}}),l=async f=>{e&&await i({textdocId:e.textdocId??"",newTitle:f})},[h,c]=m.useState(n),u=m.useRef(null),p=m.useRef(h),C=m.useRef(!1);m.useEffect(()=>{o&&u.current&&(u.current.focus(),u.current.select())},[o]);const d=f=>{c(f.target.value)},v=()=>{p.current=h},x=async()=>{C.current||await l(h),C.current=!1,a(!1)},y=f=>{(f.key==="Enter"||f.key==="Escape")&&f.preventDefault(),f.key==="Enter"?f.currentTarget.blur():f.key==="Escape"&&(c(p.current),C.current=!0,f.currentTarget.blur())};return s.jsx("input",{className:"w-[300px] rounded-lg border-none px-3 py-2 outline-hidden",ref:u,value:h,onChange:d,onFocus:v,onBlur:x,onKeyDown:y,style:{fontSize:"1.125rem",fontWeight:"bold",boxSizing:"border-box",backgroundColor:"var(--global-states-light-element-hover, rgba(0, 0, 0, 0.05))"}})};function Sa(t){const{voiceName:e}=bn(),n=t?()=>wa(t.textdocId,e,zo()):null,o=`${t?.textdocId}.${t?.versionInt}.${e}`;return Wo(n,o)}function wa(t,e,n){return F.safeGet("/textdoc/{textdoc_id}/synthesize",{parameters:{path:{textdoc_id:t},query:{voice:e,format:n}},skipJsonTransform:!0})}const _a=({textdocVersion:t,isPersisting:e=!1,isTextdocAttachedPending:n,isTextdocStreaming:o,hasDebug:a,shouldShowPlayButton:r=!1,hideRenameButton:i=!1,toggleDebugView:l,isDebugVisible:h,toggleConsoleVisibility:c,isConsoleOpen:u,clientThreadId:p})=>{const C=B();yn(),Sa(t);const[d,v]=m.useState(!1),x=t?.title??"",y=Ds(p)??"",f=ze(t?.textdocId),b=!x||f?.status===vn.INFERRING,g=()=>{v(!0)},[S,_]=m.useState(!1),{container:E,triggerRef:D}=Ts({isOpen:S,onClose:()=>_(!1)}),j=[!f&&!i&&!o?s.jsx(ye.Item,{icon:bt,onClick:g,children:C.formatMessage({id:"z/PT9T",defaultMessage:"Rename"})},"rename"):null,null,r?s.jsx(ye.Item,{icon:En,onClick:c,children:u?C.formatMessage({id:"owGHqE",defaultMessage:"Close console"}):C.formatMessage({id:"GPb4WX",defaultMessage:"Open console"})},"console"):null,null].filter(Boolean);if(j.length===0)return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"flex h-6 grow items-center overflow-hidden",children:s.jsx(xe.Title,{className:"@[0px]:hidden @[150px]:block",children:b?s.jsx("div",{className:"w-52",children:s.jsx(cs,{lines:1,size:"base",width:100,widthVariance:0})}):x})}),e&&s.jsx(Zt,{size:12,className:"text-token-text-tertiary ps-1"})]});const P=t&&s.jsx(ye.Portal,{container:E,children:s.jsx(ye.Content,{onCloseAutoFocus:N=>N.preventDefault(),children:j})});return s.jsx(s.Fragment,{children:d?s.jsx(Ta,{serverThreadId:y,textdocVersion:t,initialTitle:x,isEditingTitle:d,setIsEditingTitle:v}):s.jsxs(s.Fragment,{children:[!1,s.jsxs(ye.Root,{open:S,onOpenChange:_,children:[s.jsxs(ye.Trigger,{ref:D,className:"hover:bg-token-surface-hover grid grid-cols-[1fr_auto] bg-transparent! pe-2",children:[s.jsx(xe.Title,{className:"max-w-[270px] truncate overflow-hidden",children:b?s.jsx("div",{className:"w-52",children:s.jsx(cs,{lines:1,size:"base",width:100,widthVariance:0})}):x}),s.jsx("div",{className:"flex items-center",children:e?s.jsx(Zt,{size:12,className:"text-token-text-tertiary ps-1"}):s.jsx(Tn,{className:"icon-md text-token-text-tertiary"},"chevron")})]}),P]})]})})};function Aa({textdocVersion:t,clientThreadId:e}){const{handleCopy:n,Icon:o,copyLabel:a}=ko({textdocVersion:t,clientThreadId:e});return s.jsx(fe,{label:a,children:s.jsx(ae,{icon:o,onClick:n})})}const Ma={[T.CODE_BASH]:{filenameExtension:"sh",blobType:"text/x-shellscript"},[T.CODE_ZSH]:{filenameExtension:"zsh",blobType:"text/x-shellscript"},[T.CODE_JAVASCRIPT]:{filenameExtension:"js",blobType:"application/javascript"},[T.CODE_TYPESCRIPT]:{filenameExtension:"ts",blobType:"application/typescript"},[T.CODE_HTML]:{filenameExtension:"html",blobType:"text/html"},[T.CODE_CSS]:{filenameExtension:"css",blobType:"text/css"},[T.CODE_PYTHON]:{filenameExtension:"py",blobType:"text/x-python"},[T.CODE_JSON]:{filenameExtension:"json",blobType:"application/json"},[T.CODE_SQL]:{filenameExtension:"sql",blobType:"application/sql"},[T.CODE_GO]:{filenameExtension:"go",blobType:"text/x-go"},[T.CODE_YAML]:{filenameExtension:"yaml",blobType:"application/x-yaml"},[T.CODE_JAVA]:{filenameExtension:"java",blobType:"text/x-java-source"},[T.CODE_RUST]:{filenameExtension:"rs",blobType:"text/rust"},[T.CODE_CPP]:{filenameExtension:"cpp",blobType:"text/x-c++src"},[T.CODE_SWIFT]:{filenameExtension:"swift",blobType:"text/swift"},[T.CODE_PHP]:{filenameExtension:"php",blobType:"application/x-httpd-php"},[T.CODE_XML]:{filenameExtension:"xml",blobType:"application/xml"},[T.CODE_RUBY]:{filenameExtension:"rb",blobType:"text/x-ruby"},[T.CODE_HASKELL]:{filenameExtension:"hs",blobType:"text/x-haskell"},[T.CODE_KOTLIN]:{filenameExtension:"kt",blobType:"text/x-kotlin"},[T.CODE_CSHARP]:{filenameExtension:"cs",blobType:"text/x-csharp"},[T.CODE_C]:{filenameExtension:"c",blobType:"text/x-csrc"},[T.CODE_OBJECTIVEC]:{filenameExtension:"m",blobType:"text/x-objectivec"},[T.CODE_R]:{filenameExtension:"r",blobType:"text/plain"},[T.CODE_LUA]:{filenameExtension:"lua",blobType:"text/x-lua"},[T.CODE_DART]:{filenameExtension:"dart",blobType:"text/x-dart"},[T.CODE_SCALA]:{filenameExtension:"scala",blobType:"text/x-scala"},[T.CODE_PERL]:{filenameExtension:"pl",blobType:"text/x-perl"},[T.CODE_COMMONLISP]:{filenameExtension:"lisp",blobType:"text/x-common-lisp"},[T.CODE_CLOJURE]:{filenameExtension:"clj",blobType:"text/x-clojure"},[T.CODE_OCAML]:{filenameExtension:"ml",blobType:"text/x-ocaml"},[T.CODE_POWERSHELL]:{filenameExtension:"ps1",blobType:"text/x-powershell"},[T.CODE_VERILOG]:{filenameExtension:"v",blobType:"text/x-verilog"},[T.CODE_DOCKERFILE]:{filenameExtension:"Dockerfile",blobType:"text/x-dockerfile"},[T.CODE_VUE]:{filenameExtension:"vue",blobType:"text/x-vue"},[T.CODE_REACT]:{filenameExtension:"jsx",blobType:"application/javascript"},[T.CODE_OTHER]:{filenameExtension:"txt",blobType:"text/plain"},[T.DOCUMENT]:{filenameExtension:"md",blobType:"text/markdown"},[T.LOADING]:{filenameExtension:"txt",blobType:"text/plain"}};var dt,fs;function Da(){if(fs)return dt;fs=1;var t=Xo(),e=t(function(n,o,a){return n+(a?"_":"")+o.toLowerCase()});return dt=e,dt}var ka=Da();const ja=cn(ka);function Ia({textdocVersion:t,disabled:e}){const{filenameExtension:n,blobType:o}=Ma[t.type],a=B(),r=t.type===T.DOCUMENT?a.formatMessage({id:"canvas.download-pdf-button",defaultMessage:"Download PDF"}):a.formatMessage({id:"canvas.download-button",defaultMessage:"Download"}),i=Vo(),l=yo(),h=a.formatMessage({id:"canvas.downloadPDFError",defaultMessage:"Failed to download PDF. Please try again later."}),{mutate:c,isPending:u}=Se({mutationFn:async C=>{const d=await F.safePost("/export_doc/canvas",{requestBody:{textdoc_id:C},skipJsonTransform:!0});if(!d.ok)throw new Error("Failed to download PDF");return d},onSuccess:async C=>{const d=await C.blob(),v=C.headers.get("Content-Disposition"),x=Qo(v)??"ChatGPT Canvas.pdf";i(d,x)},onError:C=>{l.danger(h),vt.addError(C)}}),p=()=>{if(t.type!==T.LOADING)if(t.type===T.DOCUMENT)pt.logEventWithStatsig("ChatGPT Canvas PDF Download","chatgpt_canvas_pdf_download"),c(t.textdocId);else{pt.logEventWithStatsig("ChatGPT Canvas Code Download","chatgpt_canvas_code_download",{blobType:o});const C=t.content,d=new Blob([C],{type:o});i(d,`${ja(t.title)}.${n}`)}};return s.jsx(fe,{label:r,children:s.jsx(ae,{icon:Sn,disabled:u||e,onClick:p})})}const Na=t=>m.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},m.createElement("path",{d:"M21 13.6647C21 14.9442 20.7333 16.0559 20.1996 17C19.666 17.9503 18.8997 18.6863 17.9008 19.208C16.908 19.736 15.7198 20 14.3361 20H12.0372C11.696 20 11.4137 19.8851 11.1902 19.6553C10.9669 19.4317 10.8553 19.1584 10.8553 18.8354C10.8553 18.5124 10.9669 18.2391 11.1902 18.0155C11.4137 17.792 11.696 17.6801 12.0372 17.6801H14.2245C15.18 17.6801 15.9897 17.5032 16.6535 17.1491C17.3237 16.795 17.8325 16.3136 18.1799 15.7049C18.5336 15.0901 18.7105 14.3851 18.7105 13.5901C18.7105 12.8075 18.5336 12.1118 18.1799 11.5031C17.8325 10.8944 17.3237 10.4193 16.6535 10.0776C15.9897 9.73607 15.18 9.56516 14.2245 9.56516H8.64014L5.3268 9.41619L5.70838 8.80125L8.05379 10.7577L10.2316 12.8819C10.331 12.9876 10.4116 13.1056 10.4737 13.236C10.5419 13.3664 10.5761 13.5187 10.5761 13.6926C10.5761 14.0155 10.4705 14.2826 10.2596 14.4938C10.0549 14.705 9.78176 14.8106 9.44056 14.8106C9.13032 14.8106 8.85421 14.6894 8.61223 14.4472L3.36299 9.25782C3.2451 9.1522 3.15513 9.0249 3.09307 8.8758C3.03103 8.72056 3 8.56519 3 8.40995C3 8.24845 3.03103 8.09321 3.09307 7.94411C3.15513 7.78888 3.2451 7.65531 3.36299 7.54342L8.61223 2.35404C8.85421 2.11801 9.13032 2 9.44056 2C9.78176 2 10.0549 2.1056 10.2596 2.31678C10.4705 2.52175 10.5761 2.78572 10.5761 3.1087C10.5761 3.28261 10.5419 3.4379 10.4737 3.57454C10.4116 3.70497 10.331 3.82299 10.2316 3.92857L8.05379 6.0528L5.70838 8.00926L5.3268 7.39445L8.64014 7.24535H14.2245C15.6267 7.24535 16.8335 7.51548 17.8449 8.05587C18.8624 8.59626 19.6412 9.35091 20.1811 10.3199C20.727 11.2826 21 12.3976 21 13.6647Z",fill:"currentColor"})),Oa=t=>m.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},m.createElement("path",{d:"M3 13.6647C3 12.3976 3.26992 11.2826 3.80973 10.3199C4.35574 9.35091 5.13444 8.59626 6.14582 8.05587C7.16341 7.51548 8.37334 7.24535 9.77563 7.24535H15.3506L18.6732 7.39445L18.2917 8.00926L15.937 6.0528L13.7684 3.92857C13.6629 3.82299 13.576 3.70497 13.5078 3.57454C13.4457 3.4379 13.4147 3.28261 13.4147 3.1087C13.4147 2.78572 13.517 2.52175 13.7218 2.31678C13.9328 2.1056 14.209 2 14.5501 2C14.8666 2 15.1427 2.11801 15.3785 2.35404L20.637 7.54342C20.7549 7.65531 20.8449 7.78888 20.907 7.94411C20.969 8.09321 21 8.24845 21 8.40995C21 8.56519 20.969 8.72056 20.907 8.8758C20.8449 9.0249 20.7549 9.1522 20.637 9.25782L15.3785 14.4472C15.1427 14.6894 14.8666 14.8106 14.5501 14.8106C14.209 14.8106 13.9328 14.705 13.7218 14.4938C13.517 14.2826 13.4147 14.0155 13.4147 13.6926C13.4147 13.5187 13.4457 13.3664 13.5078 13.236C13.576 13.1056 13.6629 12.9876 13.7684 12.8819L15.937 10.7577L18.2917 8.80125L18.6732 9.41619L15.3506 9.56516H9.77563C8.82007 9.56516 8.00726 9.73607 7.33714 10.0776C6.66702 10.4193 6.15513 10.8944 5.80146 11.5031C5.45399 12.1118 5.28026 12.8075 5.28026 13.5901C5.28026 14.3851 5.45399 15.0901 5.80146 15.7049C6.15513 16.3136 6.66702 16.795 7.33714 17.1491C8.00726 17.5032 8.82007 17.6801 9.77563 17.6801H11.9627C12.3041 17.6801 12.5833 17.792 12.8005 18.0155C13.0238 18.2391 13.1355 18.5124 13.1355 18.8354C13.1355 19.1584 13.0238 19.4317 12.8005 19.6553C12.5833 19.8851 12.3041 20 11.9627 20H9.66399C8.28026 20 7.08895 19.736 6.08999 19.208C5.09722 18.6863 4.33403 17.9503 3.80043 17C3.26681 16.0559 3 14.9442 3 13.6647Z",fill:"currentColor"}));function Pa({disabled:t=!1,isShowingChanges:e,onMouseEnter:n,onClick:o,onEsc:a}){const r=B(),i=m.useRef(null);return m.useEffect(()=>{if(e){const l=h=>{h.key==="Escape"&&(a?.(),i.current&&i.current===document.activeElement&&i.current.blur())};return window.document.addEventListener("keydown",l),()=>{window.document.removeEventListener("keydown",l)}}},[e,a]),s.jsx(fe,{label:!t&&r.formatMessage(e?ms.hideChanges:ms.showChanges),children:s.jsx(ae,{icon:Jo,ref:i,disabled:t,onClick:o,onMouseEnter:n,className:ne("transition-colors enabled:hover:bg-black/5 dark:enabled:hover:bg-white/10",e&&Zo)})})}const ms=We({showChanges:{id:"3jMGNS",defaultMessage:"Show changes"},hideChanges:{id:"HWiQSk",defaultMessage:"Hide changes"}});function Ra({disabled:t=!1,hasPreviousVersion:e,hasNextVersion:n,hideShowChanges:o,isShowingChanges:a,onHoverPrevious:r,onHoverShowChanges:i,onToggleShowChanges:l,onClickPrevious:h,onClickNext:c}){const u=B();return s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx(Ie,{children:!o&&s.jsx(Z.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"spring",bounce:.24,duration:.4},children:s.jsx(Pa,{disabled:t||!e,isShowingChanges:a,onMouseEnter:i,onClick:l,onEsc:l})})}),s.jsx(fe,{label:e&&u.formatMessage({id:"PoD5+8",defaultMessage:"Previous version"}),children:s.jsx(ae,{disabled:t||!e,icon:Na,onMouseOver:r,onClick:h})}),s.jsx(fe,{label:n&&u.formatMessage({id:"PJ8YVJ",defaultMessage:"Next version"}),children:s.jsx(ae,{disabled:t||!n,icon:Oa,onClick:c})})]})}function La(t){for(const e of Ha){const n=t.match(e);if(n)return n[0]}return null}const Ha=[/AKIA[0-9A-Z]{16}/,/AIza[0-9A-Za-z_-]{35}/,/^(?:ghp_[A-Za-z0-9]{36}|github_pat_[A-Za-z0-9]{22}_[A-Za-z0-9]{59}|gho_[A-Za-z0-9]{36}|ghu_[A-Za-z0-9]{36}|ghs_[A-Za-z0-9]{36}|ghr_[A-Za-z0-9]{36})$/,/xox[baprs]-[0-9A-Za-z-]+/,/sk-[A-Za-z0-9]{48}/,/SK[0-9a-fA-F]{32}/,/(sk_live_[0-9a-zA-Z]{24})|(sk_test_[0-9a-zA-Z]{24})/,/-----BEGIN PRIVATE KEY-----/],Ba=`${Yo}...`;function Ee(t){return["canvas","textdoc","share",t]}function Ua({isLoading:t,isPublishedVersionLatest:e,sharedTextdoc:n,textdocVersion:o,title:a}){const{textdocId:r}=o,[i,l]=m.useState(!1),h=La(o.content),c=(E,D)=>{E&&kn(E,void 0,D).then(()=>{l(!0),setTimeout(()=>{l(!1)},1500)}).catch(()=>{})},u=ht(),{mutate:p,isPending:C}=Se({scope:{id:r},mutationFn:E=>F.safePost("/textdoc/{textdoc_id}/share",{parameters:{path:{textdoc_id:E}}}).then(D=>Fe(D.shared_textdoc)),onSuccess:E=>{u.setQueryData(Ee(r),E),c(lt(E.sharedTextdocId))}}),{mutate:d,isSuccess:v}=Se({scope:{id:r},mutationFn:E=>F.safePost("/textdoc/shared/{shared_textdoc_id}/update_to_latest",{parameters:{path:{shared_textdoc_id:E}}}).then(D=>Fe(D.shared_textdoc)),onSuccess:E=>{u.setQueryData(Ee(r),E)}}),{mutate:x}=Se({scope:{id:r},mutationFn:({sharedTextdocId:E,access:D})=>F.safePost("/textdoc/shared/{shared_textdoc_id}/update_access",{parameters:{path:{shared_textdoc_id:E}},requestBody:{shared_textdoc_access:D}}).then(j=>Fe(j.shared_textdoc)),onMutate:({access:E})=>{const D=Ee(r),j=u.getQueryData(D);return u.setQueryData(D,j&&{...j,access:E}),{previousAccess:j?.access}},onSuccess:E=>{u.setQueryData(Ee(r),E)},onError:(E,D,j)=>{const P=Ee(r),N=u.getQueryData(P);u.setQueryData(P,N&&{...N,access:j?.previousAccess})}}),y=m.useRef(null),f=E=>{y.current?.focus(),n?(L.logButtonClick($.COPY_SHARE_LINK,Me(o)),c(lt(n.sharedTextdocId),E)):(L.logButtonClick($.CREATE_SHARE_LINK,Me(o)),p(r))},b=E=>{n&&(L.logButtonClick(E===jn.PUBLIC?$.UPDATE_SHARE_LINK_PUBLIC:$.UPDATE_SHARE_LINK_PRIVATE,Me(o)),x({sharedTextdocId:n.sharedTextdocId,access:E}))},g=n?lt(n.sharedTextdocId):void 0,S=()=>{n&&(L.logButtonClick($.UPDATE_SHARE_LINK_TO_LATEST,Me(o)),d(n.sharedTextdocId))},_=h||n?.isAnonifyApiKeyDetected;return s.jsx(ea,{inputRef:y,isLoading:t,isPublishedVersionLatest:e,sharedObject:n&&{id:n.sharedTextdocId,title:a,access:n.access,versionInt:n.versionInt,isModerationBlocked:n.isModerationBlocked,isAnonifyApiKeyDetected:n.isAnonifyApiKeyDetected},title:a,shareTextPlaceholder:Ba,shareUrl:g,isCopySuccessful:i,didPublishUpdates:v,isCreateLinkRequestInProgress:C,handleUpdateLatestSharedVersion:S,handlePrivacyChange:b,handlePrimaryButtonClick:f,maybeRenderWarndingContent:()=>s.jsx(s.Fragment,{children:_&&s.jsx(qa,{})})})}function Me(t){return{textdocType:t.type,textdocId:t.textdocId}}function Fa({textdocVersion:t,isDisabled:e,title:n}){const o=vo(),a=B(),r=t?.textdocId,i=Ct($e.hasSeenCanvasShareButtonNux),{data:l,isLoading:h}=gt({enabled:!!r&&!e,queryKey:Ee(r),queryFn:()=>!r||r.startsWith(Nn)?Promise.resolve(null):F.safeGet("/textdoc/{textdoc_id}/share",{parameters:{path:{textdoc_id:r}}}).then(b=>b.shared_textdoc&&Fe(b.shared_textdoc))}),[c,u]=m.useState(!1),{triggerRef:p,container:C}=Ts({isOpen:c,onClose:()=>u(!1)}),d=o?.isWorkspaceAccount()&&!o?.features.includes(Eo.WorkspaceShareLinks);if(e||d||!t)return s.jsx(fe,{label:d?a.formatMessage(ct.workspaceSharingDisabled):a.formatMessage(ct.share),children:s.jsx(ae,{disabled:!0,icon:Jt})});const v=()=>{L.logButtonClick($.OPEN_SHARE_MENU,Me(t))},x=l?.versionInt===t.versionInt&&l?.title===t.title,y=({className:b})=>s.jsxs("div",{className:"relative h-fit w-fit",children:[s.jsx(Jt,{className:b}),!x&&l&&s.jsx("div",{className:"absolute end-0 top-[1px] flex items-center gap-1.5",children:s.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-blue-400"})})]}),f=s.jsxs(wn,{open:c,onOpenChange:u,children:[s.jsx(fe,{label:a.formatMessage(ct.share),children:s.jsx(_n,{ref:p,asChild:!0,children:s.jsx(ae,{icon:y,onClick:v})})}),s.jsx(Ie,{children:c&&s.jsx(An,{forceMount:!0,container:C,children:s.jsx(Mn,{align:"end",className:"z-50",sideOffset:8,collisionPadding:8,children:s.jsx(Ua,{title:n,sharedTextdoc:l,isLoading:h,isPublishedVersionLatest:x,textdocVersion:t})})})})]});return!i.isLoading&&i.eligible?s.jsx(Dn,{announcementKey:$e.hasSeenCanvasShareButtonNux,show:!0,side:"bottom",align:"end",theme:"bright",dismissOnOutsideClick:!0,badge:"none",title:s.jsx(G,{id:"oHutKI",defaultMessage:"Share {title}",values:{title:n}}),description:s.jsx(G,{id:"oQuH7b",defaultMessage:"Easily share your content with others â€” your chat stays private."}),onDismiss:i.markAsViewed,sideOffset:0,children:f}):f}function qa(){return s.jsx(In,{type:"danger",className:"w-auto md:p-3",children:s.jsx(G,{id:"8NG6sN",defaultMessage:"There may be an API key in your canvas. If you share the canvas, anyone with the link can see its contents."})})}const $a=({clientThreadId:t,isHistoricalVersion:e,textdocVersion:n,readonlyReason:o,hasDebug:a,isEmbedded:r,isPersisting:i,isShowingChanges:l,hideRunCode:h=!1,hideHistoryActions:c=!1,hideRenameButton:u=!1,onHoverPrevious:p,onHoverShowChanges:C,onToggleShowChanges:d,onClickPrevious:v,onClickNext:x,onClickCodePreview:y,onClose:f,toggleDebugView:b,toggleConsoleVisibility:g,isCodeRunning:S,isTextdocAttachedPending:_,isTextdocStreaming:E,isConsoleOpen:D,isDebugVisible:j})=>{const P=B(),N=Ss(),K=ze(n?.textdocId),U=n?.title??"",{isCodePreviewable:W,isCodeExecutable:I,hasCanvasCodeExecution:k}=ks(n),re=!h&&(W||I),A=n?.versionInt,H=A!=null&&A>1,z=e,ie=!c,J=W&&S,V=n==null||K!=null||e||o.isStreaming,Q=n==null||o.isStreaming,le=Ve(),ge=Qe(le,"452089807");return s.jsxs(xe.Header,{className:ne("@container",W&&S&&"bg-transparent!"),children:[s.jsx(xe.CloseButton,{onClick:f}),s.jsx("div",{className:"@container flex flex-1 basis-0 items-center gap-1 truncate leading-[0]",children:s.jsx(_a,{hasDebug:a,isConsoleOpen:D,isDebugVisible:j,toggleConsoleVisibility:g,toggleDebugView:b,isPersisting:i,textdocVersion:n,isTextdocAttachedPending:_,isTextdocStreaming:E,shouldShowPlayButton:re,hideRenameButton:u,clientThreadId:t})}),s.jsxs("div",{className:"flex min-w-0 basis-auto items-center gap-1.5 leading-[0] select-none",children:[ie&&s.jsx(Ra,{hideShowChanges:J,disabled:o.isStreaming,hasNextVersion:z,hasPreviousVersion:H,isShowingChanges:l,onHoverPrevious:p,onHoverShowChanges:C,onToggleShowChanges:d,onClickPrevious:v,onClickNext:x}),s.jsx(Aa,{clientThreadId:t,textdocVersion:n}),ge&&n&&n.type!==T.LOADING&&K==null&&s.jsx(Ia,{disabled:Q,textdocVersion:n}),s.jsx(Fa,{isDisabled:V,textdocVersion:n,title:U}),re&&s.jsx(Lo,{clientThreadId:t,isCodePreviewable:W,isDisabled:!k||o.isTextdocStreaming&&!S,disabledTooltip:k?void 0:P.formatMessage({id:"NTZRWe",defaultMessage:"Code execution for canvas is disabled for your workspace. Contact your admin to enable."}),onClick:y,isCodeRunning:S,textdocType:n?.type}),!r&&!N&&s.jsx(ta,{})]})]})},Ga=/\s/,Ka=30;function ps(t,e){const n=t.indexOf(e);return n===-1?!1:t.indexOf(e,n+e.length)===-1}function ue(t,e){return Ga.test(t[e])}function xs(t,e,n=!1){if(e===0||n&&ue(t,e-1))return e;for(;e>0&&ue(t,e-1);)e--;for(;e>0&&!ue(t,e-1);)e--;return ue(t,e)&&e++,e}function hs(t,e,n=!1){if(e===t.length||n&&ue(t,e))return e;for(;e<t.length&&ue(t,e);)e++;for(;e<t.length&&!ue(t,e);)e++;return ue(t,e-1)&&e--,e}function Wa(t,e,n=!0,o=Ka){if(t.start<0||t.end>e.length||t.start>t.end)throw new Error("Invalid commentSourceRange provided.");const a=e.substring(t.start,t.end);let r=t.start,i=t.end;n&&(r=xs(e,r,!0),i=hs(e,i,!0));let l=e.substring(r,t.start),h=e.substring(t.end,i),c=`${l}${a}${h}`;if(ps(e,c)&&(o==null||c.length>=o))return{before:l,after:h,allSurrounding:c};let u=r,p=i,C=!0;for(;C&&(o==null||c.length<o);){let d=!1;const v=u>0?xs(e,u):u;v<u&&(u=v,d=!0);const x=p<e.length?hs(e,p):p;if(x>p&&(p=x,d=!0),d){const y=e.substring(u,t.start),f=e.substring(t.end,p),b=`${y}${a}${f}`;if(ps(e,b)&&(o==null||b.length>=o))return{before:y,after:f,allSurrounding:b};l=y,h=f,c=b}else C=!1}return{before:l,after:h,allSurrounding:c}}const De="# Context",ke="# Instructions";function je(t,e,n){if(e==null||n==null)return`The user is referring to the entire text of "${t}".`;const o=`
## Selected Text
The user has selected this text in "${t}" in particular:
${e}
`.trim();return n.allSurrounding===e?o:`
${o}

## Surrounding Context
Here is the surrounding context:
${n.allSurrounding}
`.trim()}function Is(t,e){return t==null||e==null?"entire document":t===e.allSurrounding?"selected text":"surrounding context"}function Ns(t){return`For the update pattern, create a regex which exactly matches the ${t}. Edit just this string in order to fullfill the user's request. NEVER rewrite the entire document. Instead, ALWAYS edit ONLY the ${t}. The only exception to this rule is if the ${t} includes markdown lists or tables. In that case, fully rewrite the document using ".*" as the regex update pattern.`.trim()}function za(t,e,n,o){if(!pe(e)&&n&&o){const a=Is(n,o);return`
${De}
The user requests that you directly edit the document.

${je(t,n,o)}

${ke}
Use the update_textdoc tool to make this edit. ${Ns(a)}`.trim()}return`
${De}
The user requests that you directly edit the document.

${je(t,n,o)}

${ke}
Use the update_textdoc tool to make this edit. You MUST fully rewrite the entire document by using ".*" as the update regex pattern.`.trim()}function Va(t,e,n){return`
${De}
The user requests that you add comments about some text.

${je(t,e,n)}

${ke}
Do not respond to the user's question directly, just leave comments.`.trim()}function Qa(t,e){return pe(t)?e==="entire document"?` If you choose to update the ${e}, you MUST fully rewrite the ${e} by using ".*" as the update regex pattern.`:` If you choose to update the ${e}, you MUST fully rewrite the entire document by using ".*" as the update regex pattern. When you do so, ONLY modify the ${e} and rewrite other sections exactly as is, except for parts that must change based on this update`:e==="entire document"?"":` If you choose to update the ${e}, follow these instructions: ${Ns(e)}`}function Ya(t,e,n,o){const a=Is(n,o),r=Qa(e,a);return`
${De}
${je(t,n,o)}

${ke}
The user would like you perform one of the following actions:
- Update the ${a} via the \`update_textdoc\` tool.${r}
- Explain the selected text via chat, or answer a general question about the selected text (no tool call required).
- Comment on the ${a} with feedback via the \`comment_textdoc\` tool. This should only be used if the user very explicitly asks for feedback, critique, or comments.

Based on the user's request, choose the appropriate action.
`.trim()}function Xa(t,e,n){return`
${De}
${je(t,e,n)}

${ke}
The user would like you to create a new textdoc.
`.trim()}function Za(t,e,n,o=null,a=null){switch(n){case me.ASK:return Ya(t,e,o,a);case me.CREATE_TEXTDOC:return Xa(t,o,a);case me.EDIT:return za(t,e,o,a);case me.COMMENT:return Va(t,o,a)}}function Ja(t){switch(t){case R.ACCELERATOR:case R.CONSOLE:case R.ACCEPT_COMMENT:case R.HIVE_SPEAKER_EDIT:return!0;case R.ASK_CHATGPT:case R.FULL_SCREEN_SUBMIT:return!1}}function er(t,e){switch(e){case R.ASK_CHATGPT:case R.ACCEPT_COMMENT:case R.FULL_SCREEN_SUBMIT:return t.formatMessage(tr.askChatGPT);case R.ACCELERATOR:case R.CONSOLE:case R.HIVE_SPEAKER_EDIT:return}}const Os=(t,e)=>{const n=B(),o=vs(t),a=_s(t),r=yt();return m.useCallback(async({content:i,sourceRange:l,action:h,userMessageType:c,acceleratorMetadata:u,selectionMetadata:p,sourceEvent:C})=>{if(e?.versionInt==null||r)return;const{textdocId:d,type:v,versionInt:x,content:y}=e;let f,b=null;l&&l.start!==l.end&&(f=y.slice(l.start,l.end),b=Wa(l,y));const g=Za(d,v,h,f,b),_=To(g,{exclude_after_next_user_message:!0});a({sourceEvent:C,promptMessage:As(i,{canvas:{textdoc_id:d,textdoc_type:v,version:x,textdoc_content_length:y.length,user_message_type:c,accelerator_metadata:u,selection_metadata:p},is_visually_hidden_from_conversation:Ja(c),targeted_reply:f,targeted_reply_label:er(n,c),open_in_canvas_view:{type:"canvas_textdoc",id:d}}),completionMetadata:o?{conversationMode:o}:void 0,appendMessages:[_]})},[e,r,a,o,n])},tr=We({askChatGPT:{id:"h5ANdM",defaultMessage:"Asked ChatGPT"}}),sr=t=>{const e=Ve(),n=Qe(e,"80186230"),o=Ss(),{eligible:a,isLoading:r,markAsViewed:i}=Ct(t);return{markAsViewed:i,eligible:!o&&a&&n,isLoading:r}};function nr(){return sr($e.hasDismissedCanvasContextualOnboarding)}function or(t){const e=/\[([^\]]+)\]\((https?:\/\/[^\s)]+|www\.[^\s)]+)\)/gi,n=new Set,o=t.matchAll(e);for(const a of o){const r=a[2];try{let i=r;i.startsWith("www.")&&(i="http://"+r),new URL(i),n.add(r)}catch{}}return n}const ar=async({lastVersion:t,textdocId:e,content:n,comments:o})=>{const a=On(o,n);return(await F.safePost("/textdoc/{textdoc_id}",{parameters:{path:{textdoc_id:e}},requestBody:{version:t,content:n,comments:a}})).version},rr=()=>{const t=m.useRef([]),e=m.useRef(null),{mutateAsync:n,isPending:o}=Se({mutationKey:["canvas","textdoc","persist"],mutationFn:ar});return[m.useCallback(async(r,i,l)=>{const h=new AbortController,u=(async()=>{const[v]=t.current;try{await v?.promise}catch(x){L.logError("Saving document",x)}if(!h.signal.aborted)try{const x=Math.max(e.current??0,r.versionInt??ws);let y="";try{us(i)?y=i():y=i}catch(S){L.logError("Serializing document",S)}let f=[];try{us(l)?f=l():f=l}catch(S){L.logError("Adjusting comments",S)}const{textdocId:b}=r;Pn({textdocId:b,basedOnVersionInt:x,content:y,comments:f});const g=await n({textdocId:b,lastVersion:x,content:y,comments:f});Rn({textdocId:b,basedOnVersionInt:x,newVersion:g}),e.current=g}catch(x){L.logError("Error saving document",x)}finally{t.current.shift()}})(),p={abort:()=>h.abort(),promise:u},[C,d]=t.current;return d&&(d.abort(),t.current=C?[C]:[]),t.current=C?[C,p]:[p],u},[n]),t,o]},ir=3e3,lr=t=>{const[e,n,o]=rr(),a=B(),r=m.useRef(null),i=m.useCallback(Ln(async(c,u,p)=>{if(!ut(c))return e(c,u,p);qe.replaceTempTextdocContent(c.textdocId,typeof u=="string"?u:u())},ir,{leading:!1}),[e]),l=Hn(t);return m.useEffect(()=>{if(!l)return;const c=rs(window,{pagehide:()=>i.flush(),beforeunload:p=>{i.flush(),p.returnValue=a.formatMessage({id:"QZrKwi",defaultMessage:"You have a canvas save in progress."})}}),u=rs(document,{visibilitychange:()=>i.flush(),keydown:()=>{r.current="keyboard"},mousemove:()=>{r.current!=="mouse"&&i.flush(),r.current="mouse"}});return()=>{r.current=null,u(),c()}},[a,l,i]),m.useEffect(()=>()=>{i.flush()},[t,i]),Bn(async()=>{await i.flush(),await Promise.allSettled(n.current?.map(({promise:c})=>c)??[])}),[m.useCallback((c,u,p)=>{const{textdocId:C}=c;return ut(c)||Un(C),i(c,u,p)},[i]),i.flush,o||l]};function cr(t,e,n){const o=ht(),a=n!=null&&e!=null,{data:r,error:i,fetchNextPage:l,hasNextPage:h,isFetching:c}=dn(gs(t,e,a)),u=m.useCallback(async()=>{const x=e!=null;await o.prefetchInfiniteQuery(gs(t,e,x))},[o,t,e]);m.useEffect(()=>{const x=e;return()=>{o.removeQueries({queryKey:Ps(t,x),exact:!0})}},[o,t,e]);const[p,C,d,v]=m.useMemo(()=>{if(r&&n){const y=r.pages.flatMap(b=>b),f=y.findIndex(b=>"beforeVersion"in n?(b.versionInt??ws)<n.beforeVersion:b.versionInt===n.version);if(f!==-1)return[f===y.length-1,y[f],f>0?y[f-1]:null,f<y.length-1?y[f+1]:null]}const x=r?.pages.flatMap(y=>y)??[];return[!0,null,null,x.length===0?null:x[0]]},[r,n]);return m.useEffect(()=>{!c&&a&&h&&p&&l()},[c,a,h,p,l]),m.useEffect(()=>{!C&&i&&Ae(t)},[C,i,t]),{historicalTextdocVersion:C,nextHistoricalTextdocVersion:d,prefetchHistoricalTextdocVersion:u,previousHistoricalTextdocVersion:v}}function Ps(t,e=null){return["textdocHistory",t,e]}function gs(t,e,n=!0){return{queryKey:Ps(t,e),queryFn:({pageParam:o})=>dr(t,o),initialPageParam:e??void 0,getNextPageParam:o=>{const a=So(o)?.versionInt;if(a&&a>1)return a},enabled:n,staleTime:1/0,retry:2}}async function dr(t,e){return e===void 0||e<=1?[]:(await F.safeGet("/textdoc/{textdoc_id}/history",{parameters:{path:{textdoc_id:t},query:{before_version:e}}})).previous_doc_states.map(({id:o,version:a,textdoc_type:r,title:i,content:l,updated_at:h,comments:c,metadata:u})=>({textdocId:o,versionInt:a,messageId:null,title:i,type:$n(r),content:l,status:Es.COMPLETE,createdAt:qn(h),comments:Fn(c,l),metadata:{content_references:u?.content_references}}))}const ur=(t,e,n=1)=>{un(t.scrollTop,e,{duration:n,ease:"easeInOut",onUpdate:o=>{t.scrollTop=o}})},fr=he.div`flex w-full grow flex-col gap-1 rounded-xl p-2 pe-5 text-sm`,mr=he.input`ms-[-2px] w-auto rounded-none border-none bg-[#E5F3FF] p-0 px-0.5 text-sm font-semibold outline-none focus:outline-none`,pr=he(Z.span)`start border-token-text-tertiary absolute -bottom-0.5 w-full origin-left border-b border-solid`,xr=he(Z.span)`start border-token-text-tertiary absolute -bottom-0.5 w-full border-b border-dashed`,hr={initial:{scaleX:0,opacity:1},animate:{scaleX:1,opacity:0,transition:{scaleX:{duration:.85,ease:[.65,0,.35,1]},opacity:{delay:.85,duration:.1}}}},gr={initial:{opacity:0},animate:{opacity:1,transition:{delay:.85,duration:.1}}};he.div`ms-2 rounded-full px-2 py-0.5 text-xs font-medium`;const Cr=({speakerId:t,content:e,range:n,filterDecision:o,isEditing:a,isSaving:r,containerRef:i,measuredTextContainerRef:l,isEditingEnabled:h})=>{const c=m.useRef(null),{setSpeakers:u,setEditingSpeaker:p,hoveringSpeakerId:C,setHoveringSpeakerId:d,speakers:v,editingSpeaker:x,enableDebugger:y}=xt.getState(),f=xt(k=>k.currentTime),b=n.max==null?f===n.min:f>=n.min&&f<=n.max;m.useEffect(()=>{if(b&&c.current&&i.current){const k=i.current,re=c.current,A=k.getBoundingClientRect().top,z=re.getBoundingClientRect().top-A+k.scrollTop-20;ur(k,z,.3)}},[n.min,n.max,b,i]);const g=v.get(t),S=!!g?.storedName&&g.storedName!==g?.placeholderName||(g?.isEdited??!1),_=g?.name??g?.storedName??g?.placeholderName??"Unidentified Speaker",E=m.useRef(null),D=t===x?.id,j=t===C,[P,N]=m.useState(!1),[K,U]=m.useState(!1);m.useEffect(()=>{E.current&&(!D||!K||(E.current?.focus(),S&&(E.current.value=_)))},[S,D,K,_]),wo(()=>{if(l.current&&E.current){const k=l.current.offsetWidth;E.current.style.width=`${k}px`}},[x?.name]);const W=m.useCallback(()=>{if(!x||!g)return;p(null),U(!1),N(!1),d(null);const k=v.set(t,{...g,name:x.name?x.name:g.placeholderName,isEdited:!!x.name});u(k)},[x,g,p,d,v,t,u]),I=!a||r;return s.jsxs(fr,{ref:c,className:ne(b&&"animate-[hive-log-fadeout_0.3s_1.5s_forwards] bg-blue-500/10",!1,!1),children:[!1,s.jsxs("div",{className:"mb-[1px] flex w-full items-center justify-between",children:[h&&(D?s.jsx(mr,{ref:E,disabled:!K,onBlur:W,className:ne(!D&&"hidden w-0"),placeholder:g?.isEdited?void 0:g?.placeholderName,value:x?.name,onKeyDown:k=>{k.key==="Enter"&&W()},onChange:k=>p({id:t,name:k.target.value})}):s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsxs("div",{onClick:()=>{I||(p({id:t,name:S?_:""}),U(!0))},onMouseEnter:()=>{I||(d(t),N(!0))},onMouseLeave:()=>{I||(d(null),N(!1))},className:ne("relative flex font-semibold transition-colors",{"text-blue-400!":j&&!I},{"cursor-pointer":!I},{"text-token-text-tertiary":!I&&!S}),children:[_,!I&&!S&&s.jsxs(s.Fragment,{children:[s.jsx(pr,{...hr}),s.jsx(xr,{...gr,className:ne(j&&!I&&"border-blue-400!")})]})]}),P&&!I&&s.jsx(bt,{className:"h-4 w-4 text-blue-400"}),!1]})),s.jsx("div",{className:"text-xs text-[#5D5D5D]",children:na(n.min)})]}),s.jsx("div",{className:"flex",children:e})]})},br=t=>gt({queryKey:["hiveLog",t],queryFn:()=>F.safeGet("/hive/{hive_id}/transcript",{parameters:{path:{hive_id:t}}}),enabled:!!t,select:oa}),yr=()=>gt({queryKey:["hiveLogPrompts"],queryFn:()=>F.safeGet("/hive/prompts"),enabled:!0}),vr=(t,e)=>F.safePost("/hive/{hive_id}/speakers",{parameters:{path:{hive_id:t}},requestBody:{speakers:e}}),Er=he.div`invisible absolute start-0 top-0 rounded-md border px-0.5 text-sm font-semibold whitespace-pre`,Tr=(t,e)=>!e||!t?"":e.isEdited||t.name&&t.name!==e.placeholderName?t.name:e.placeholderName,Cs=he(Z.div)`flex items-center gap-2`,bs={initial:{opacity:0,y:-4},animate:{opacity:1,y:0,transition:{duration:.2}},exit:{opacity:0,y:-4,transition:{duration:.2}}},Sr="ts",wr=({hiveId:t,clientThreadId:e,ts:n,textdocVersion:o})=>{const a=br(t),r=yr(),i=B(),[l,h]=m.useState(!1),c=m.useRef(null),u=Ve(),p=Qe(u,"2986567482"),{isOpen:C,closeSidebar:d,openSidebar:v,setCurrentTime:x,speakers:y,setSpeakers:f,editingSpeaker:b,enableDebugger:g,setEnableDebugger:S,selectedFilters:_,setSelectedFilters:E}=xt();m.useEffect(()=>{n!==void 0&&(v(),x(n))},[n,v,x]);const D=m.useRef(null),[j,P]=m.useState(!1),N=Os(e,o);if(a.isLoading||r.isLoading||a.isError||r.isError||!a.data||!r.data)return null;const K=b?y.get(b.id):null,U=Array.from(y.values()).some(({isEdited:A})=>A),W=()=>{const A=new Map(Array.from(y.entries()).map(([H,z])=>[H,{...z,name:void 0,isEdited:!1}]));f(A),h(!1)},I=A=>{if(!r.data.speaker_edits)return;const H=r.data.speaker_edits.replace("{speakers}",JSON.stringify(Array.from(y.entries())));return N({sourceEvent:A,action:me.EDIT,content:H,userMessageType:R.HIVE_SPEAKER_EDIT,selectionMetadata:void 0})},k=async A=>{if(U){P(!0);try{const H=[];Array.from(y.entries()).forEach(([J,V])=>{!V.isEdited||!V.name||H.push({id:J,updated_name:V.name})});const z=await vr(t,H);if(!z)throw new Error("Failed to update hive content");const ie=new Map(y);for(const J of z.updated_speakers){if(!ie.has(J.id))continue;const V=ie.get(J.id);V&&ie.set(J.id,{...V,storedName:J.updated_name,isEdited:!1})}await I(A),f(ie),h(!1)}catch{}finally{P(!1)}}},re=a.data.filter(({filterDecision:A})=>!A||_?.includes(A));return s.jsxs("div",{className:ne("flex h-full w-full max-w-[360px] min-w-[240px] flex-col border-s border-gray-200",C?"visible":"invisible hidden"),children:[s.jsxs("div",{className:"flex h-14 w-full items-center justify-between border-b border-gray-200 p-4",children:[s.jsxs("div",{className:"text-token-text-secondary group/debug flex items-center gap-1.5 py-2 text-base font-medium",children:[s.jsx(G,{..._e[l?"edit":"transcript"]}),s.jsx(Gn,{children:s.jsx(G,{..._e.researchPreview})}),!1]}),s.jsx("div",{className:"flex h-10 items-center gap-2",children:s.jsx(Ie,{mode:"wait",children:l?s.jsxs(Cs,{...bs,children:[s.jsx(Ge,{onClick:W,color:"secondary",disabled:j,children:s.jsx(G,{..._e.cancelButton})}),s.jsx(Ge,{color:"primary",onClick:k,disabled:!U,loading:j,children:s.jsx(G,{..._e.saveButton})})]},"edit-buttons"):s.jsxs(Cs,{...bs,children:[p&&s.jsx(fe,{className:"h-10",label:i.formatMessage(_e.editButtonTooltip),children:s.jsx(ae,{icon:bt,onClick:()=>h(!0)})}),s.jsx(ae,{icon:_o,onClick:()=>d()})]},"non-edit-buttons")})})]}),!1,s.jsxs("div",{ref:c,className:"flex w-full flex-col gap-2 overflow-y-scroll p-2",children:[p&&b&&s.jsx(Er,{ref:D,children:Tr(b,K)}),re.map(A=>s.jsx(Cr,{isEditingEnabled:p,measuredTextContainerRef:D,containerRef:c,isEditing:l,isSaving:j,...A},_r(A)))]})]})},_r=t=>{const{speakerId:e,content:n,range:o}=t;return`${e}-${o.min}-${o.max}-${n.slice(0,2)}`},_e=We({researchPreview:{id:"HiveLogSidebar.researchPreview",defaultMessage:"Research Preview"},edit:{id:"HiveLogSidebar.edit",defaultMessage:"Edit"},transcript:{id:"HiveLogSidebar.transcript",defaultMessage:"Transcript"},editButtonTooltip:{id:"HiveLogSidebar.editButtonTooltip",defaultMessage:"Edit speakers"},cancelButton:{id:"HiveLogSidebar.cancelButton",defaultMessage:"Cancel"},saveButton:{id:"HiveLogSidebar.saveButton",defaultMessage:"Save"}}),ti=({isFullScreen:t=!1,isEmbedded:e=!1,hideHeader:n=!1,hideRunCode:o=!1,isReadonlyFromQueryParam:a=!1,hideRenameButton:r=!1,clientThreadId:i,focusedTextdoc:l,onClose:h,isAnimating:c=!1,width:u,hideBottomComposer:p=!1})=>{const C=Ve(),{textdocId:d,history:v,showChangesAtVersion:x=null,shouldRunCodeOnOpen:y=!1}=va(l),f=B(),[b,g,S]=lr(d),{targetedContent:_}=Kn(),E=Wn(),[D,j]=m.useState(!1),[P,N]=m.useState(!1),K=zn(d),U=Vn(),W=mt(i,Ms.getRequestId),I=Ao(W),{data:k,isLoading:re}=Qn(d,x),[A,H]=m.useState(!1),[z,ie]=m.useState(null),J=Yn(i),V=m.useRef(null),Q=K?.versions??[],le=Q[0]?.versionInt,{historicalTextdocVersion:ge,nextHistoricalTextdocVersion:Rs,previousHistoricalTextdocVersion:Ls,prefetchHistoricalTextdocVersion:Et}=cr(d,le,v),Tt=Xn();m.useEffect(()=>{Ke.reset()},[d]);const St=Q.length>0?Q[Q.length-1]:null,Xe=Q.length>1?Q[Q.length-2]:null,wt=Ds(i),{restoreHistoricalTextdocVersion:Hs,optimisticRestoredTextdocVersion:Bs}=Zn(wt,St,ge),Ce=v!=null,M=Ce?ge:St,ee=x!=null,we=Os(i,M),_t=c?null:k,Ne=(()=>{if(c||M==null)return[];const w=is(M.comments);return!ee&&ge!=null?ge.comments:!ee||k==null?w:k.contentBefore!==k.contentAfter?[]:ya(k.commentsBefore,k.commentsAfter)})(),q=M?.type??T.LOADING,Ze=Jn(),At=ut(M),ce=eo(M),Je=to(M),Mt=so(M),Us=Mt&&!e,Fs=ds(U),qs=ds(I);m.useEffect(()=>{!At&&Q.length===0&&Ze!==es.NATIVE&&(!U&&Fs.current||!I&&qs.current||!U&&!I)&&h?.()},[Q.length,U,I]);const{content:te,currentlyStreamingLineIndex:Dt}=k?.contentBefore!=null&&!pe(q)?{content:k.contentBefore,currentlyStreamingLineIndex:null}:jo(M,Xe),$s=no(wt,Array.from(or(te))),[Oe,et]=pa({value:te,isRequestActive:I,isTextdocStreaming:ce,comments:Ne}),kt=oo(M),jt=Ze===es.LAST_TURN||Oe||S;m.useEffect(()=>{ao().sendMessage({type:js.Streaming,streaming:jt})},[jt]);const Gs=({getSerializedDocument:w,getAdjustedComments:O})=>{M&&b(M,w,O)},Ks=w=>{if(!M)return;const O=w.doc.toString();b(M,O,w.field(Po,!1)??[])},It=(w,O,se,de,be)=>{et(!0),we({sourceEvent:w,action:se,content:O,userMessageType:R.ASK_CHATGPT,sourceRange:de,selectionMetadata:{selection_type:be,selection_position_range:de}})},Nt=({id:w})=>{kt(w,ns.DISMISS),Ke.reset()},Ot=async(w,O)=>{et(!0);const{id:se,at:de,content:be}=O;if(await kt(se,ns.ACCEPT)===!1)return et(!1);we({sourceEvent:w,content:be,userMessageType:R.ACCEPT_COMMENT,sourceRange:de,action:me.EDIT,selectionMetadata:{selection_type:ls.SELECTION,selection_position_range:de}})},tt=(w,O,se,de)=>{const{action:be}=de;we({sourceEvent:w,action:be,content:se,sourceRange:O,userMessageType:R.ACCELERATOR,acceleratorMetadata:{action:be,id:de.id,prompt:se},selectionMetadata:O!=null?{selection_type:ls.SELECTION,selection_position_range:O}:void 0})},Ws=(w,O)=>{we({sourceEvent:w,action:me.EDIT,content:O,userMessageType:R.FULL_SCREEN_SUBMIT})},zs=ro(),Pt=w=>zs?.[w]??w,st=()=>io(i),Vs=()=>{v?Ue(d,v):Ae(d)},Y=Ho({streamingSource:Ze,isRestoring:Bs!=null,isRequestActive:I,isTextdocStreaming:ce,isReadonlyFromQueryParam:a,isHistoricalVersion:Ce,isShowingChanges:ee});let Pe=null;const Rt=c||Y.isReadonly||Oe,Re=yt()||J||a||At,Lt=()=>c&&Ne.length>0?ve.ALL_HIDDEN:Re?ve.COMMENTS_READONLY:Y.isReadonly?Y.isStreaming?ve.ENABLED:Y.isReadonlyFromQueryParam||Y.isShowingChanges||Y.isHistoricalVersion?ve.COMMENTS_READONLY:ve.ALL_HIDDEN:ve.ENABLED,Qs=m.useCallback(async w=>{const{suggestion:O}=await F.safePost("/textdoc/{textdoc_id}/autocomplete",{parameters:{path:{textdoc_id:d}},requestBody:{content:w}});return O},[d]),Ht=t||c||a;let nt=[];switch(q){case T.LOADING:Pe=s.jsx(Oo,{});break;case T.DOCUMENT:Pe=s.jsx(No,{value:te,comments:Ne,previousValue:Xe?.content,getAutocompleteSuggestion:Qs,previousComments:is(Xe?.comments),isRewriting:Je,isAnimatingFromPreview:c,isSendDisabled:Re,getStableCommentId:Pt,diff:_t,isRequestActive:I,isDisabled:Y.isReadonly||U,isWaitingForCommentResponse:Oe,hideAccelerators:Ht,hideToolbar:Rt,hideEditOverlay:c,commentsMode:Lt(),readonlyReason:Y,onBlur:g,onSave:g,onChange:Gs,onCancelRequest:st,targetedContent:_,onAddComment:It,onAcceptComment:Ot,onDismissComment:Nt,onSubmitAccelerator:tt,onExitShowChanges:Vs,safeUrls:$s,width:u,modelCursor:Mt||ce&&!Je?M?.modelCursor:void 0,shouldResetSelection:M?.versionInt===1,metadata:K?.metadata}),nt=Fo;break;default:pe(q)&&(Pe=s.jsx(Io,{id:"codemirror",getStableCommentId:Pt,language:Bo(q),value:te,comments:Ne,hideAccelerators:Ht,commentsMode:Lt(),hideToolbar:Rt,onSubmitAccelerator:tt,currentlyStreamingLineIndex:Dt??null,readonlyReason:Y,isRequestActive:I,isSendDisabled:Re,isWaitingForCommentResponse:Oe,onChange:Ks,onCancelRequest:st,onAddComment:It,onBlur:g,onSave:g,codemirrorRef:V,onDismissComment:Nt,onAcceptComment:Ot,textdocDiff:_t??void 0,modelCursor:ce&&Dt==null?M?.modelCursor:void 0}),nt=Ro)}const ot=m.useRef(null),Le=m.useRef(null),{hasCanvasCodeExecution:at,isCodeExecutable:Bt,isCodePreviewable:oe}=ks(M),Ut=at&&oe,Ft=at&&Bt,Ys=lo(),qt=m.useCallback(()=>{!A&&(Ut||Ft)?(H(!0),ot.current?.runCode(q,te).finally(()=>H(!1))):(ot.current?.stopCode(),H(!1))},[Ut,Ft,A,te,q]),$t=co(()=>{qt()});m.useEffect(()=>{y&&$t()},[y,$t]);const{eligible:Xs,markAsViewed:Zs}=nr(),X=M?.versionInt,Js=X!=null&&X>1,en=Ce,He=Ls?.versionInt,rt=Rs?.versionInt,tn=()=>{ee?v?Ue(d,v):Ae(d):(L.logButtonClick($.SHOW_CHANGES,{textdocType:q,textdocId:d,versionInt:X,latestVersionInt:le}),X&&os(d,X,v))},sn=()=>{L.logButtonClick($.HISTORY_PREVIOUS,{textdocType:q,textdocId:d,versionInt:X,latestVersionInt:le,isShowingChanges:ee}),d&&X&&Js&&Ue(d,{beforeVersion:X},ee&&He!=null?He:void 0)},nn=()=>{L.logButtonClick($.HISTORY_NEXT,{textdocType:q,textdocId:d,versionInt:X,latestVersionInt:le,isShowingChanges:ee}),en&&(rt?Ue(d,{version:rt},ee?rt:void 0):ee&&le?os(d,le,null):Ae(d))},on=Qe(C,"1804926979"),Gt=mt(i,aa(d)),an=sa(),Kt=ze(M?.textdocId),rn=!n&&s.jsx($a,{hideRunCode:o,clientThreadId:i,isHistoricalVersion:Ce,textdocVersion:M,readonlyReason:Y,hasDebug:E,isEmbedded:e,isPersisting:S,isShowingChanges:ee,isConsoleOpen:P,isDebugVisible:D,hideHistoryActions:a,hideRenameButton:r,onHoverPrevious:()=>{Et(),He&&Tt(d,He)},onHoverShowChanges:()=>{Et(),X&&Tt(d,X)},onToggleShowChanges:tn,onClickPrevious:sn,onClickNext:nn,toggleDebugView:()=>j(w=>!w),toggleConsoleVisibility:()=>{P||pt.logEvent("Canvas Open Console Clicked"),N(w=>!w)},onClose:()=>{if(L.logButtonClick($.CLOSE_TEXTDOC,{textdocType:M?.type}),Zs(),Kt&&!t){const{create_source:w,hasUserEdits:O,tempTextdocId:se}=Kt;if(O&&w!==ss.USER_CREATED_COMPOSER){Vt(!0);return}qe.removeTempTextdoc(se),w===ss.USER_CREATED_COMPOSER&&an.appendText(te)}h?.()},onClickCodePreview:qt,isCodeRunning:A,isTextdocStreaming:ce,isTextdocAttachedPending:ts(M)});let Wt=null;const Be=!o&&at&&(Bt||oe),it=Uo(q,te);m.useEffect(()=>{Be&&(it&&Le.current?.prepareEnvironment(it),oe&&A&&!ce&&Mo(Le.current)?.updateCode(te))},[Be,it,ce]);const zt=M?.title??"";Be&&(Wt=s.jsx(fn,{title:zt,onChangeBackgroundColor:ie,visuallyHidden:!oe||!A,disableNetworkRequests:!Ys,networkAccessDeniedMessage:f.formatMessage({id:"GE4AJf",defaultMessage:"Network requests in canvas are disabled for your workspace. Contact your admin to enable this feature."}),enableTransition:oe&&q!==T.CODE_HTML,isCodeUpdating:ce,ref:Le}));const[ln,Vt]=m.useState(!1),Qt=s.jsx(ra,{isOpen:ln,dismissModal:()=>Vt(!1),closeTextdocEditor:()=>{h?.()},textdocVersion:M,clientThreadId:i}),Yt=s.jsxs(s.Fragment,{children:[rn,s.jsx(xe.Content,{scrollToBottomMode:Us?"bottom":"top",shouldScrollToTop:Je,isLoading:re,hideChildren:oe&&A,overlay:Wt,children:Pe}),Be&&s.jsx(mn,{ref:ot,sandboxRef:Le,textdocId:d,textdocTitle:zt,textdocContent:te,isTextdocAttachedPending:ts(M),highlightLine:w=>V.current?.highlightLine(w),isRequestActive:I,createTextdocTurn:we,isOpen:P,onOpenChange:N}),s.jsx(Ie,{children:Ce&&!a&&s.jsx(xa,{onClickRestore:Hs,onClickResetLatest:()=>Ae(d)})}),t&&!Ce&&!p&&!(A&&oe)&&!Re&&s.jsx(ba,{isRequestActive:I,clientThreadId:i,onSubmitAccelerator:tt,onSubmit:Ws,onCancel:st,readonlyReason:Y,acceleratorActions:nt}),!c&&!e&&Xs&&s.jsx(ma,{textdocType:q})]});if(on&&Gt&&M){const O=new URLSearchParams(window.location.search).get(Sr),se=O==null?void 0:parseInt(O);return s.jsxs(s.Fragment,{children:[Qt,s.jsx(xe,{previewBackgroundColor:z,isPreviewingCode:oe&&A,children:s.jsxs("div",{className:"flex h-full",children:[s.jsx("div",{className:"relative flex h-full min-h-0 flex-auto grow flex-col",children:Yt}),s.jsx(wr,{hiveId:Gt,clientThreadId:i,textdocVersion:M,ts:se})]})})]})}return s.jsxs(s.Fragment,{children:[Qt,s.jsx(xe,{previewBackgroundColor:z,isPreviewingCode:oe&&A,children:Yt})]})};export{js as C,ti as T};
//# sourceMappingURL=i3iwctq0xt60nh9q.js.map
