import{j as e,r as m,M as L}from"./ci5tkrccytan34lo.js";import{c as o,bk as D,bi as C,bR as B,ck as U,eU as $,e as z,M as F,aZ as G,L as H,B as K}from"./ccccre6vnqbb7l94.js";import{ft as O,fu as Q,fv as Z,fw as k,fx as q,fy as J}from"./fztttvm3qzdvif1h.js";import{S as V}from"./j9uxoymlvskfdsfq.js";function W({title:s,content:r,buttons:a,time:c,icon:d,size:n="default",progressBar:x,disabled:t=!1,onClick:u}){const p="bg-token-main-surface-primary border-token-border-default mx-[calc(--spacing(-2)-1px)] -my-[1px] box-content rounded-2xl border bg-clip-padding px-5 py-4 @max-3xl:-top-2 @3xl:-start-3 @3xl:-top-4",y=n==="small"?`w-full flex max-w-[calc(0.8*var(--thread-content-max-width,40rem))] ps-[20px] pt-[13px] pb-[10px] ${t?"":"gap-4"}`:"w-full gap-4 px-[22px] pb-[22px] pt-[18px]",g=u?"cursor-pointer":"",h=n==="small"?"text-[15px]":"";return e.jsxs("div",{className:o("relative inline-flex flex-col items-start justify-start rounded-2xl border",p,y,g,h),onClick:u,children:[e.jsxs("div",{className:o("flex flex-col items-start justify-start self-stretch",n!=="small"&&"gap-1.5"),children:[e.jsxs("div",{className:o("inline-flex items-start justify-start self-stretch",n!=="small"&&"gap-2"),children:[e.jsx("div",{className:o("shrink grow basis-0 leading-normal font-medium","text-token-text-secondary hover:text-token-text-primary"),children:s}),e.jsx("div",{className:"relative h-6 w-6"}),!t&&(d||e.jsx(V,{className:"relative h-6 w-6"}))]}),e.jsx("div",{className:o("flex w-full flex-col items-start justify-start",n==="small"&&"mt-[-2px]"),children:e.jsx("div",{className:o("inline-flex w-full items-start justify-start self-stretch rounded-sm",n==="small"?"gap-1":"gap-2.5 py-1"),children:e.jsx("div",{className:o("w-full leading-relaxed font-normal",t?"text-token-text-tertiary":"text-token-text-secondary"),children:r})})})]}),x?e.jsxs("div",{className:o("mb-2 inline-flex items-center justify-between self-stretch",a?.length&&"mt-[-10px]"),children:[x,a]}):e.jsxs("div",{className:"inline-flex items-center justify-end self-stretch",children:[c&&e.jsx("div",{className:"text-token-text-tertiary shrink grow basis-0 text-[15px] leading-normal font-normal",children:c}),e.jsx("div",{className:"flex gap-2",children:a})]})]})}const X=/\*\*(.*?)(?:\*\*|\n|$)/g,Y=s=>{let r=null,a;for(;(a=X.exec(s))!=null;)r=a[1].trim();return r},I=()=>null;function ee({message:s,simulatedDuration:r=8*60*1e3,maxFill:a=100}){s?.metadata?.model_slug!=="o1-pro"&&(r=20*60*1e3);const c=s?.create_time?new Date(s.create_time*1e3):Date.now(),d=q(+c,r);return e.jsx(J,{percentage:Math.min(d,a),className:"me-4 w-full!",backgroundClassName:"bg-token-sidebar-surface-secondary rounded-full",barClassName:"bg-token-text-secondary rounded-full",transitionDuration:`${(100-d)/100*.2}s`,transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)",height:8})}function ne({messages:s,isStreaming:r,isCompletionRequestInProgress:a,hasActiveRequest:c,isLastMessage:d,isFinalTurn:n,isFeedbackEnabled:x,clientThreadId:t,currentGroupedMessageIndex:u,turnIndex:p}){const[y,g]=m.useState(""),[h,w]=m.useState(!1),M=O(t)?.value===D.STREAMING,T=Q(C(t)),l=B(s),E=l?.id,b=l?.metadata?.initial_text,_=l?.metadata?.summarization_headline,v=s.map(i=>U(i)).join(`

`),{toggleThreadSidebar:N}=$(),S=m.useCallback(()=>{N({type:"summarizer",clientThreadId:t,currentGroupedMessageIndex:u,turnIndex:p})},[N,t,u,p]);m.useEffect(()=>{const i=Y(v);i?g(i):b!=null&&g(b)},[v,b]),m.useEffect(()=>{v.length>0&&w(!0)},[v]),m.useEffect(()=>{h&&z.logEvent("Tool: Received a8km123 message",{client_thread_id:t,message_id:E,conversationId:C(t)})},[h]);const f=n&&d&&(M||r),P=I()!=null,R=F.isLastActorMessage(G(t),s[0].id),A=!!H(t,i=>i?.sharedConversationMetadata),j=Z(s[0],R,P,a||c,A);return!T&&l?.metadata?.finish_details?.type==="interrupted"&&l?.metadata?.finish_details?.reason!=="server_timeout"||l?.clientMetadata?.err?e.jsx("div",{children:j&&e.jsx(k,{errorState:j,nodeId:s[0].id,isFeedbackEnabled:x,clientThreadId:t,isUserTurn:!1})}):e.jsxs("div",{className:"pb-2",children:[e.jsx(W,{buttons:f?[e.jsx(K,{onClick:i=>{i.stopPropagation(),S()},color:"secondary",className:"text-token-text-secondary h-[38px]! text-[15px] font-normal",children:e.jsx("div",{className:"px-1",children:e.jsx(L,{id:"wQcuK8",defaultMessage:"Details"})})},"Details")]:[],time:null,title:_,icon:f?e.jsx("div",{className:""}):null,content:f?`${y}...`:l?.metadata?.finished_text??"",size:"small",disabled:!f,onClick:S,progressBar:f?e.jsx(ee,{message:l}):null}),j&&e.jsx(k,{errorState:j,nodeId:s[0].id,isFeedbackEnabled:x,clientThreadId:t,isUserTurn:!1})]})}export{ee as ProduceProgressBar,ne as default};
//# sourceMappingURL=ir4ojboznsu3uf4r.js.map
