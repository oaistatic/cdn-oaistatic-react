const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/f7dj9sc1jb4agf6x.js","assets/ci5tkrccytan34lo.js","assets/fztttvm3qzdvif1h.js","assets/ccccre6vnqbb7l94.js","assets/root-ggl0dfwq.css","assets/conversation-small-dfayqh3x.css","assets/hapan2fx2czn21gi.js","assets/kzhevji8i57j71hk.js","assets/okos94f2q18o6tqs.js","assets/yhmeor7tu9os2tty.js","assets/fith45tpjuu9xlf3.js","assets/davw8s4opx9bontx.js","assets/nrf92sfp0a98zayu.js","assets/d6qfcfpf3ythcmx2.js","assets/hqmq4n3v5xc9wydo.js","assets/cfn5ikk5ru4oac7u.js","assets/hp7xs1ygys4kmfnn.js","assets/iw5jl8v2yszml7o9.js","assets/o5dcel4w1cacawdo.js","assets/csx7nt71oz1r0z6y.js","assets/khkh5m0f7cvgfw6e.js","assets/kwkjmzn9zjnazhqf.js","assets/h7in3t111gdmjy8i.js","assets/nu1tqyh587pbxlyd.js","assets/dsi34f97eewvdk20.js","assets/gdtp5x2aauek0m4i.js","assets/bgg66h46ig9w8a6y.js","assets/ddgfe1sz0ssgqmwj.js","assets/ir4ojboznsu3uf4r.js","assets/j9uxoymlvskfdsfq.js","assets/lhfoa3792b1lyp44.js","assets/o48z9mtuhaskw34o.js","assets/oqppwvh4icbsp0jr.js","assets/ggy463e7z3oap1z2.js","assets/i3g2qaat3974kagr.js","assets/grqqoygx78z5w4fx.js","assets/h2gd34k3oh53zw7p.js","assets/mncmjhre2pa3zjgy.js","assets/ekl1xxb2hl6h9vpu.js","assets/pc2givv05uuq8g6l.js","assets/i4c1gncd98zmt3g7.js","assets/o6tnov12l4y47p1a.js","assets/k4lih7nb4umlxxxc.js","assets/m3p85h1r7wwh3ar4.js","assets/hnwyihljdxrug66f.js","assets/t7vnx1cc2uzzkq81.js","assets/ew5cyvt4eewrp7bl.js","assets/n8xzbxiejwlahre8.js","assets/dpavouct31i6z8p1.js","assets/ansi-1f6vhsjh.css","assets/ivaufcylsc183gln.js","assets/pbe38tec7dql0sh5.js","assets/n1daj33n3xqfllpk.js","assets/pcjr7askdf0x3oga.js","assets/ebbe56r21p4nhezb.js","assets/fk846ir6i1xkpllk.js","assets/jq1xbz38gn4vzp5i.js","assets/FormattedText-kb0ehjj7.css","assets/cot-message-lf3q5fj1.css","assets/jji0tgdil6wdx1s4.js","assets/ffsp1o78v8949lnz.js","assets/7ek1xya4a58vgvu1.js","assets/ka0et6663iazot39.js","assets/l9vpjmbivd4kh2pb.js"])))=>i.map(i=>d[i]);
import{I as te,b0 as ae,c as A,a_ as Ne,bk as He,eU as X,cu as Je,L as Y,gh as Qe,E as we,B as q,aI as W,ds as We,e as ke,c6 as Ke,M as De,F as Me,h5 as se,eV as Xe,as as Ye,fj as pe,fi as $e,aj as Ze,eZ as qe,d_ as Ge,e_ as g,s as es,N as ss,bR as ts,gg as K,O as v,aZ as as,fQ as xe,u as ns,eQ as os,_ as T,cv as rs}from"./ccccre6vnqbb7l94.js";import{i as ne,r as x,j as s,M as R,a6 as V,a5 as L,a as is}from"./ci5tkrccytan34lo.js";import{l0 as ls,fR as Re,l1 as cs,l2 as ms,fx as he,aq as G,fy as us,l3 as ds,l4 as gs,l5 as fs,l6 as ps,l7 as xs,l8 as hs,l9 as ys,la as ye,lb as Q,lc as _e,ld as _s,kU as Ss,a7 as Se,le as js,lf as bs,lg as vs,lh as je,li as Oe,ei as Es,lj as Cs,lk as Ts,ll as As,lm as Ns,ln as ws,bQ as ks,lo as Ds,lp as Ms,am as Rs,lq as Os,lr as Ls,ls as Is,lt as Ps,av as Fs,cw as Us,lu as Vs,iY as Bs,lv as zs,it as Hs,lw as Js,lx as Qs,ly as Ws,lz as Le,dr as Ks,lA as Xs,lB as Ys,lC as be,ao as $s,lD as Zs,lE as qs,lF as Gs,ek as et}from"./fztttvm3qzdvif1h.js";import{u as st}from"./hapan2fx2czn21gi.js";const ee={div:e=>{const{node:n,children:t,...a}=e;return s.jsx("div",{...a,className:"text-red-500",children:t})},p:e=>{const{node:n,children:t,...a}=e;return s.jsx("p",{...a,className:"text-token-text-primary text-start leading-6",children:t})},a:e=>{const{node:n,children:t,...a}=e;return s.jsx("a",{...a,className:"font-sm text-token-text-primary! leading-6",children:t})}},tt=1e3*60*2,at=30;function Ie({taskId:e,clientThreadId:n,onClick:t,statusMessage:a,showSources:o,includeMargin:r,sources:c,progressBar:i}){const l=Re(),[u,d]=x.useState(!1),p=te(),f=ae(p,"2007855518");return s.jsxs(s.Fragment,{children:[e&&u&&s.jsx(cs,{taskId:e,clientThreadId:n,onClose:()=>d(!1)}),s.jsxs("div",{className:"relative flex w-4/5 max-w-[416px]",children:[e&&f&&s.jsx("button",{onClick:()=>d(!0),disabled:!e,className:"hover:bg-token-bg-elevated-secondary bg-token-bg-elevated-primary absolute end-4 bottom-4 flex items-center justify-center rounded-full border border-black/10 p-0.5 dark:border-white/10",children:s.jsx(ms,{className:"icon-lg"})}),s.jsx("button",{onClick:()=>l&&t(),className:A("bg-token-main-surface-primary mt-4 flex w-full items-start justify-start gap-[18px] rounded-2xl border border-black/10 px-5 py-4 shadow-sm dark:border-white/10",l?"hover:bg-token-main-surface-secondary cursor-pointer":"cursor-auto"),children:s.jsxs("div",{className:"flex w-full flex-col gap-3",children:[s.jsxs("div",{className:A("flex flex-col items-start justify-start self-stretch md:h-7 md:flex-row md:items-center md:justify-between",o?"h-12":"h-6"),children:[s.jsx("div",{className:A("font-sm text-token-text-primary w-full flex-1 truncate text-start leading-7 md:w-0",r&&"me-[30px]"),children:a}),o&&c]}),s.jsx("div",{className:A("flex w-full items-center justify-start gap-4 self-stretch pb-2",e&&f&&"pe-10"),children:i})]})})]})]})}function oe({taskId:e,clientThreadId:n,toggleSidebar:t,openSidebar:a,startTime:o,progressBar:r}){const c=ne(),[i,l]=x.useState(!1),u=ls();return x.useEffect(()=>{if(!o)return;const d=Date.now()-o,p=tt-d;if(p>0){const f=setTimeout(()=>{l(!0),a()},p);return()=>clearTimeout(f)}else l(!0),a()},[o,a]),r||(r=s.jsx(ds,{className:"h-2 w-full"})),s.jsx(Ie,{taskId:e,clientThreadId:n,onClick:t,statusMessage:i?c.formatMessage({id:"T2SbxC",defaultMessage:"Waiting…"}):s.jsx("div",{className:"text-token-text-primary text-sm font-medium text-pretty",children:u.startingMessage}),progressBar:r,showSources:!1})}function nt(e,n,t){const a=e.formatMessage({id:"Bs+OcV",defaultMessage:"Thinking…"});if(n.length<2)return t?.initial??a;const o=n[n.length-2];return o.type==="summary"?o.title:o.type==="search"?o.query:o?.type==="websiteOpen"?s.jsx(G,{componentOverrides:ee,children:o.activeRowText}):o.type==="fileOpen"?s.jsx(G,{componentOverrides:ee,children:o.activeRowText}):o.type==="pythonAnalysis"?s.jsx(G,{componentOverrides:ee,children:o.analysisSummary}):a}function ot({task:e,clientThreadId:n,caterpillarRows:t,messageWithTaskMetadata:a,totalSources:o,handleToggleCaterpillarSidebar:r}){const c=ne(),i=Re(),l=nt(c,t,a.metadata?.async_task_status_messages),u=(e?.expectedDurationMinutes??at)*60*1e3,d=te(),p=ae(d,"3550239432"),f=t[1]?.created_at?t[1].created_at*1e3:0,y=he(f||Date.now(),u),C=a?.create_time?a.create_time*1e3:0,_=Math.min(he(C||Date.now(),u),4),b=p?Math.max(y,_):y;let N;const E=s.jsx("div",{className:"bg-token-main-surface-tertiary flex h-2 shrink grow basis-0 items-start justify-start gap-2.5 overflow-hidden rounded-[10px]",children:s.jsx(us,{percentage:b,barClassName:"bg-token-text-primary",backgroundClassName:"bg-token-main-surface-tertiary"})});p&&(N=E),x.useEffect(()=>{Ne(n,D=>{D.async_status=He.STREAMING})},[n]);const{openThreadSidebar:w}=X();x.useEffect(()=>{t.length===2&&i&&w({type:"caterpillar",caterpillarId:e.taskId,initialTab:"activity",clientThreadId:n})},[t.length,w,e.taskId,n,i]);const S=x.useCallback(()=>{w({type:"caterpillar",caterpillarId:e.taskId,initialTab:"activity",clientThreadId:n})},[w,e.taskId,n]);return t.length<=1?s.jsx(oe,{taskId:e.taskId,clientThreadId:n,toggleSidebar:()=>r("activity"),openSidebar:S,startTime:new Date(e.createdAt).getTime(),progressBar:N}):s.jsx(Ie,{taskId:e.taskId,clientThreadId:n,onClick:()=>r("activity"),statusMessage:l,showSources:!0,includeMargin:o>0,sources:o===0?s.jsx("div",{className:"text-token-text-tertiary text-sm text-pretty",children:s.jsx(R,{id:"zfwUjs",defaultMessage:"Looking for sources…"})}):s.jsxs("button",{onClick:D=>{D.stopPropagation(),r("sources")},className:A("flex shrink-0 gap-1 text-[13px] leading-[18px] text-[#0285ff]",i?"cursor-pointer hover:text-[#0285ff]/80":"cursor-auto"),children:[s.jsx("div",{className:"relative",children:s.jsx(V,{initial:!1,children:s.jsx(L.span,{initial:{opacity:0,rotateX:-90,translateY:20},animate:{opacity:1,rotateX:0,translateY:0},exit:{opacity:0,rotateX:90,translateY:-20},transition:{duration:.35},className:"absolute start-0 md:end-0",children:o},o)})}),s.jsx("div",{className:A("md:pe-0",o>0&&"ps-2",o>9&&"ps-[14px]",o>99&&"ps-[22px]"),children:o>1?s.jsx(R,{id:"zN+MuO",defaultMessage:" sources"}):s.jsx(R,{id:"dMowmJ",defaultMessage:" source"})})]}),progressBar:E})}function rt({messages:e,clientThreadId:n}){const t=e.find(u=>u.metadata?.b1de6e2_s&&u.metadata?.async_task_id),a=t?.metadata?.async_task_id,o=e.find(u=>u.recipient===Je.START_RESEARCH_TASK),r=Y(n,u=>_s(u,o?.id)),c=Qe({clientThreadId:n}),[i,l]=x.useState(c);return x.useEffect(()=>{const u=setTimeout(()=>{l(r&&c)},3e3);return()=>clearTimeout(u)},[c,r]),!t||!a?i?s.jsx(oe,{taskId:a,clientThreadId:n,toggleSidebar:()=>{},openSidebar:()=>{},startTime:new Date().getTime()}):null:s.jsx(it,{clientThreadId:n,payloadTaskId:a,messageWithTaskMetadata:t})}function it({payloadTaskId:e,messageWithTaskMetadata:n,clientThreadId:t}){gs(e,n,t);const a=fs(f=>e?f.tasks[e]:null),o=ne(),r=a?.status,c=x.useMemo(()=>a?.rows?a.rows:[],[a?.rows]),{toggleThreadSidebar:i}=X(),{totalSources:l,totalSearches:u}=x.useMemo(()=>{if(!c)return{uniqueSources:[],totalSources:0,totalSearches:0};const f=ps(c),y=f.reduce((_,b)=>_+b.count,0),C=xs(c);return{uniqueSources:f,totalSources:y,totalSearches:C}},[c]),d=hs("caterpillar"),p=x.useCallback(f=>{e&&i({type:"caterpillar",caterpillarId:e,initialTab:f,clientThreadId:t},d)},[i,e,d,t]);return ys(e),n.metadata?.async_task_status_messages?.completed_with_time?s.jsx(ye,{task:a,clientThreadId:t,messageWithTaskMetadata:n,totalSources:l,totalSearches:u,handleToggleCaterpillarSidebar:p}):!a||!r||r===Q.UNDETERMINED?s.jsx(oe,{taskId:e,clientThreadId:t,toggleSidebar:()=>{},openSidebar:()=>{},startTime:new Date().getTime()}):a.status===Q.COMPLETED?s.jsx(ye,{task:a,clientThreadId:t,messageWithTaskMetadata:n,totalSources:l,totalSearches:u,handleToggleCaterpillarSidebar:p}):a.status===Q.FAILED?s.jsx(_e,{message:n.metadata?.async_task_status_messages?.error??o.formatMessage({id:"at6zk8",defaultMessage:"Failed to think"}),handleToggleCaterpillarSidebar:()=>p("activity")}):a.status===Q.CANCELLED?s.jsx(_e,{message:n.metadata?.async_task_status_messages?.cancelled??o.formatMessage({id:"u1rIr5",defaultMessage:"Task Cancelled"}),handleToggleCaterpillarSidebar:()=>p("activity")}):s.jsx(ot,{task:a,clientThreadId:t,caterpillarRows:c,messageWithTaskMetadata:n,totalSources:l,handleToggleCaterpillarSidebar:p})}function lt(e,n,t){const a=n.elements.length;if(a===0)return;const o=Object.entries(e).reduce((r,[c,i])=>Array.isArray(i)?i.length>0?r+1:r:i!==""?r+1:r,0);ke.logEventWithStatsig("dynamic-form-submission","chatgpt_dyanmic_form_submission",{...Ke({clientThreadId:t}),totalItems:a.toString(),completedItems:o.toString(),ratio:(o/a).toString()})}function ct(e,n){let t="";return n.elements.forEach(a=>{const o=a.scope.split("/").pop(),r=o&&e[o],c=r?Array.isArray(r)?r.join(", "):r:"Any",i=a.label??o;t+=`${i}: ${c}
`}),t}function mt({messages:e,clientThreadId:n,isLastMessage:t}){const a=e.find(S=>S.author.role===we.Assistant),o=e.find(S=>S.metadata?.json_form),r=o?.metadata?.json_form,[c,i]=x.useState({}),[l,u]=x.useState(),[d,p]=x.useState(),f=Ss(),y=st(n);x.useEffect(()=>{r&&(u(r.json_form_ui),p(r.json_form_data))},[r]);const C=x.useCallback(()=>{if(i({}),l){const S={...l,elements:l.elements.filter(D=>D.scope!=="#/properties/AdditionalInfo")};u(S)}d&&(delete d.properties.AdditionalInfo,p(d))},[i,u,p,l,d]),_=x.useCallback(()=>{if(l){const S={...l,elements:[...l.elements,{type:"Control",scope:"#/properties/AdditionalInfo",label:"Additional Info",placeholder:"Any other details..."}]};u(S)}if(d){const S={...d.properties,AdditionalInfo:{type:"string"}};p({...d,properties:S})}},[u,p,l,d]),b=l?.elements.some(S=>S.scope.endsWith("#/properties/AdditionalInfo")),N=Y(n,De.getCurrentLeafId),E=o?.id!==N;if(!o||!d||!l)return a?.status==="in_progress"&&t?s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx(Se,{className:"h-[26px] w-full"}),s.jsx(Se,{className:"h-[26px] w-3/4"}),s.jsx(js,{})]}):null;if(E)return null;const w=async S=>{const D=ct(c,l);lt(c,l,n),y({sourceEvent:S,promptMessage:We(D),completionMetadata:{systemHints:[...f],conversationMode:{kind:W.PrimaryAssistant}}})};return s.jsxs(bs,{children:[s.jsx(ut,{formData:c,dataSchema:d,uiSchema:l,setData:i,readOnly:E}),s.jsxs("div",{className:"flex w-full justify-between",children:[b?s.jsx("div",{}):s.jsx(q,{disabled:E,onClick:_,color:"secondary",className:"text-token-text-secondary",children:s.jsx(R,{id:"Sen69P",defaultMessage:"Add a detail"})}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(q,{disabled:E,onClick:C,color:"secondary",className:"text-token-text-secondary",children:s.jsx(R,{id:"Uqo7UD",defaultMessage:"Reset"})}),s.jsx(q,{disabled:E,onClick:w,children:s.jsx(R,{id:"FVou++",defaultMessage:"Start"})})]})]})]})}function ut({dataSchema:e,uiSchema:n,setData:t,readOnly:a,formData:o}){return s.jsx("div",{children:s.jsx(vs,{formData:o,readOnly:a,schema:e,uiSchema:n,onChange:r=>t(r)})})}const dt=2e3,Pe=.4,gt=.45,ft=.2,pt=.1,xt=.25;var P=(e=>(e[e.Running=0]="Running",e[e.Finished=1]="Finished",e[e.Error=2]="Error",e[e.Stopped=3]="Stopped",e[e.Paused=4]="Paused",e))(P||{});function $t({conversationMessages:e,icon:n,status:t,text:a,estimatedToolDurationMs:o,animationLoopDurationMs:r=dt,shouldPersistAfterFinished:c=!1}){const[i,l]=x.useState(t===0?0:t===1&&!c?7:1),[u,d]=x.useState(0);x.useEffect(()=>{t===2?l(8):t===3?l(9):t===4?l(10):t===1?l(i===2?3:7):t===0&&i===10&&(l(2),d(f=>f+1))},[t]);const p=_t(i);return x.useEffect(()=>{const f=e[0].id;if(p)return je.addDelayedRenderingMessage(f),()=>{je.removeDelayedRenderingMessage(f)}},[p]),Oe(()=>{F(i)&&d(f=>f+1)},r),i===7&&!c?null:s.jsxs("div",{className:"my-2.5 flex items-center gap-2.5",children:[s.jsx(ht,{icon:n,status:t,uiState:i,estimatedToolDurationMs:o,animationLoopCounter:u,shouldPersistAfterFinished:c,onFillProgressBarAnimationComplete:()=>l(4),onFinishAnimationComplete:()=>{l(5),setTimeout(()=>{l(c?7:6)},pt*1e3)},onHideAnimationComplete:()=>l(7)}),s.jsx(yt,{text:a,uiState:i,animationLoopCounter:u,onEnterAnimationComplete:()=>l(2)})]})}const ve=50;function ht({icon:e,status:n,uiState:t,estimatedToolDurationMs:a,animationLoopCounter:o,shouldPersistAfterFinished:r,onFillProgressBarAnimationComplete:c,onFinishAnimationComplete:i,onHideAnimationComplete:l}){const[u,d]=x.useState(0);Oe(()=>{F(t)?d(E=>E+ve):t===10&&d(0)},ve);let p,f,y;F(t)||t===10?(p="running",f=s.jsx(e,{animationLoopCounter:o}),y="bg-transparent"):t===4||t===5||t===7&&r?(p="finished",f=s.jsx(Ts,{}),y="bg-brand-purple"):n===2?(p="error",f=s.jsx(As,{}),y="bg-orange-500"):n===3&&(p="stopped",f=s.jsx(Ns,{}),y="bg-gray-300");let C={opacity:0,scale:0,rotate:-180,x:0},_={type:"spring",bounce:.3,duration:gt},b={opacity:0,scale:.6,rotate:0,x:0};t===0?(C={opacity:0,scale:.5,rotate:-180,x:-8},_={type:"spring",bounce:.3,duration:Pe}):t===1?C=!1:t===5&&(b={opacity:0,scale:0,rotate:0,x:0},_={type:"spring",bounce:.3,duration:xt});const N=Cs(u,a);return s.jsx("div",{className:"relative h-5 w-5 shrink-0",children:s.jsx(V,{onExitComplete:()=>{t===6&&l()},children:p!=null&&s.jsxs(L.div,{className:A("absolute start-0 top-0 flex h-full w-full items-center justify-center rounded-full text-white",y),initial:C,animate:{opacity:1,scale:1,rotate:0,x:0},exit:b,transition:_,onAnimationComplete:()=>{t===4&&i()},children:[f,(F(t)||t===10)&&s.jsx(Es,{percentage:t===3?100:N,thickness:1.5/23,className:"text-brand-purple absolute start-1/2 top-1/2 h-[23px] w-[23px] -translate-x-1/2 -translate-y-1/2",backgroundStrokeClassName:"stroke-brand-purple/25 dark:stroke-brand-purple/50",transitionDuration:t===3?`${(100-N)/100*ft}s`:void 0,transitionTimingFunction:t===3?"cubic-bezier(0.55, 0, 1, 1)":void 0,onTransitionEnd:()=>{t===3&&c()}})]},p)})})}function yt({text:e,uiState:n,animationLoopCounter:t,onEnterAnimationComplete:a}){const[o,r]=x.useState(e);x.useEffect(()=>{n===2&&r(e)},[t]),x.useEffect(()=>{F(n)||r(e)},[n,e]);let c={opacity:0,x:0,y:15},i={type:"spring",bounce:.3,opacity:{duration:.15},y:{duration:.3}};n===0?(c={opacity:0,x:-8,y:0},i={type:"spring",bounce:.3,duration:Pe,delay:.15}):n===1&&(c=!1);const l=o??void 0;return s.jsx("div",{className:A("relative h-5 w-full leading-5",n===8||n===9?"text-token-text-tertiary":"text-token-text-secondary"),children:s.jsx(V,{children:l!=null&&s.jsx(L.div,{className:"absolute start-0 top-0 line-clamp-1 overflow-visible",initial:c,animate:{opacity:1,x:0,y:0},exit:{opacity:0,x:0,y:-15},transition:i,onAnimationComplete:()=>{n===0&&a()},children:l},l.toString())})})}function F(e){return e===0||e===2||e===3}function _t(e){return F(e)||e===4||e===5||e===6||e===10}const Ee=Me.div`group start-0 top-0 me-1.5 overflow-hidden mt-1 text-start`,St=({highlightedCommand:e,status:n,children:t,showWorkUserSetting:a=!1,hideOnlyIfNotInteractedWith:o=!1,defaultExpanded:r=!1,onOpenAnalytics:c,onClick:i,...l},u)=>{const d=t!=null||i!=null,[p]=x.useState(a),[f,y]=x.useState(a||r),[C,_]=x.useState(!1),b=n===P.Finished||n===P.Error,N=o?p?!1:!C:!1,E=n===P.Running&&"loading-shimmer";return b&&N?null:d?s.jsxs(s.Fragment,{children:[s.jsx(Ce,{ref:u,$canShowWork:!0,...l,children:s.jsx(V,{children:s.jsx(Ee,{children:s.jsx(L.button,{onClick:w=>{f||c?.(),y(S=>!S),_(!0),i?.(w)},initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:A(E),children:s.jsxs("div",{className:"flex items-center justify-start gap-1",children:[s.jsx("span",{className:"text-start",children:e}),!i&&(f?s.jsx(ws,{className:"icon-md"}):s.jsx(ks,{className:"icon-md"}))]})},e?.toString())})})}),s.jsx(V,{children:f&&t&&s.jsx(L.div,{initial:"collapsed",animate:"reveal",exit:"collapsed",variants:{collapsed:{translateY:-20,opacity:0,height:0},reveal:{translateY:0,opacity:1,height:"auto"}},transition:{duration:.3,ease:"easeInOut"},className:"overflow-hidden",children:t})})]}):s.jsx(Ce,{ref:u,$canShowWork:!1,...l,children:s.jsx(Ee,{className:A(E),children:e})})},Ce=Me.span`block first:mt-0 relative
${({$canShowWork:e})=>e?"text-token-text-secondary hover:text-token-text-primary my-1.5":"text-token-text-secondary"}`,jt=x.forwardRef(St),bt=3,vt=.1,Te=[0,.26,.4];function Et({nextMessage:e,isLastMessage:n,isRequestActive:t,isLastTurnInConversation:a,clientThreadId:o,turnIndex:r,searchResultGroups:c}){const i=n||!e||e&&!se(e),l=x.useRef(!1),u=is(),d=Y(o,De.getGizmoId);x.useEffect(()=>{e&&se(e)&&!l.current&&(l.current=!0,Ds(u,d))},[e,u,d]);const p=Xe(e);e?.id&&Ms(e?.id);const f=[];if(p?.[0]?.type==="navigation"&&e&&f.push(s.jsx(Ct,{clientThreadId:o,turnIndex:r,nextMessage:e,isRequestActive:t,isLastTurnInConversation:a,navigationCitation:p[0]},"fast-nav")),i){const y=Ye(c.slice(0,bt).map(_=>_.entries[0].url)),C=t?s.jsxs("div",{className:"flex items-center gap-1",children:[y.map((_,b)=>s.jsx(L.div,{className:A("-ms-1.5 first:ms-0 last:me-1.5","relative"),initial:{width:b===0?0:6,opacity:0},animate:{width:20,opacity:1},transition:{duration:vt,delay:Te[Math.min(b,Te.length-1)]},children:s.jsx("div",{className:A("flex h-[22px] w-[22px] items-center overflow-hidden rounded-full","border-token-bg-primary bg-token-bg-primary border-2"),children:s.jsx(Rs,{url:_,size:32,minSize:16,className:"icon-md rounded-full"})})},_)),s.jsx(R,{id:"jjx8Qg",defaultMessage:"Searching the web"})]}):s.jsx(R,{id:"fssXGM",defaultMessage:"Error while searching"});f.push(s.jsx(jt,{highlightedCommand:C,status:t?P.Running:P.Error},"search-gpt-query"))}return f.length?s.jsx(s.Fragment,{children:f}):null}const Ct=({clientThreadId:e,turnIndex:n,nextMessage:t,isRequestActive:a,isLastTurnInConversation:o,navigationCitation:r})=>{const{scrollToHeader:c}=pe("searchSources")??{},i=$e(),l=pe("searchSources"),{openThreadSidebar:u}=X();return x.useEffect(()=>{Ze.addFirstTiming("render.fastNavigation")},[]),x.useEffect(()=>{i&&l&&u({type:"searchSources",scrollToHeader:c,clientThreadId:e,turnIndex:n,messageId:t?.id??""})},[]),x.useEffect(()=>{const d=t,p=d.metadata?.search_source,f=r.domains.map(y=>y.url);Os.logEvent("Search Tool Request Time To Fast Nav",e,d.id,{search_source:p,urls:f},()=>{p===qe.InstantQuery&&Ls.logEvent("Search Tool Page Load Time To Fast Nav",{message_id:d.id,urls:f,search_source:p})})},[e,t,r]),a&&o?s.jsx(L.div,{initial:{opacity:a?0:1,height:a?0:"auto"},animate:{opacity:1,height:"auto"},children:s.jsx(Ae,{clientThreadId:e,turnIndex:n,nextMessage:t,navigationCitation:r})}):s.jsx(Ae,{clientThreadId:e,turnIndex:n,nextMessage:t,navigationCitation:r})},Ae=({clientThreadId:e,turnIndex:n,nextMessage:t,navigationCitation:a})=>{const{toggleThreadSidebar:o}=X(),r=x.useMemo(()=>({clientThreadId:e,turnIndex:n,messageId:t?.id}),[e,n,t?.id]),c=x.useCallback((l,u)=>{o({type:"searchSources",scrollToHeader:u,clientThreadId:e,turnIndex:n,messageId:t?.id??""})},[o,e,n,t?.id]),i=Is(r);return s.jsx(Ps,{navigation:a,onShowSearchResults:c,trackContentReferenceEvent:i})},Tt=v(()=>T(()=>import("./f7dj9sc1jb4agf6x.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),At=v(()=>T(()=>import("./okos94f2q18o6tqs.js"),__vite__mapDeps([8,1,3,4,9]))),Nt=v(()=>T(()=>import("./fith45tpjuu9xlf3.js"),__vite__mapDeps([10,1,3,4,2,5]))),wt=v(()=>T(()=>import("./davw8s4opx9bontx.js"),__vite__mapDeps([11,1,3,4,2,5,12,13,6,7]))),kt=v(async()=>()=>null);v(async()=>()=>null);const Dt=v(async()=>(await T(()=>import("./hqmq4n3v5xc9wydo.js"),__vite__mapDeps([14,3,1,4,12,2,5,15,16,6,7,17,18,19,20,21]))).ImageGenMessage),Mt=v(()=>T(()=>import("./h7in3t111gdmjy8i.js"),__vite__mapDeps([22,1,3,4,2,5,6,7]))),Rt=v(()=>T(()=>import("./hp7xs1ygys4kmfnn.js"),__vite__mapDeps([16,1,3,4,2,5,6,7])).then(e=>e.BrowsingMessage)),Ot=v(()=>T(()=>import("./nu1tqyh587pbxlyd.js"),__vite__mapDeps([23,1,3,4,2,5])).then(e=>e.SearchResultMessage)),Lt=v(()=>T(()=>import("./dsi34f97eewvdk20.js"),__vite__mapDeps([24,1,3,4,2,5,6,7])).then(e=>e.JITPluginMessage)),It=v(()=>T(()=>import("./gdtp5x2aauek0m4i.js"),__vite__mapDeps([25,3,1,4,26,2,5,27,6,7])).then(e=>e.DataAnalysisMessage)),Pt=v(()=>T(()=>import("./ir4ojboznsu3uf4r.js"),__vite__mapDeps([28,1,3,4,2,5,29]))),Ft=v(()=>T(()=>import("./lhfoa3792b1lyp44.js"),__vite__mapDeps([30,1,3,4,31,32,2,5,15,16,6,7,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,27,54,55,56,57,58])).then(e=>e.LegacyCoTMessage)),Ut=v(()=>T(()=>import("./o48z9mtuhaskw34o.js"),__vite__mapDeps([31,1,3,4,32,2,5,15,16,6,7,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,27,54,55,56,57,58])).then(e=>e.CoT)),Vt=v(()=>T(()=>import("./jji0tgdil6wdx1s4.js"),__vite__mapDeps([59,1,2,3,4,5,60,61,62,63])).then(e=>e.JawboneMessage)),Bt=v(async()=>()=>null);function zt(e){if(e.some(n=>n.type===g.SearchGPTQuery)){const t=e.filter(c=>c.type===K).flatMap(c=>c.groups),a=t.filter(c=>c.type===g.StructuredThoughts),o=t.filter(c=>c.type===g.CoTSearchTool),r=(()=>{function c(l){return l.type===g.StructuredThoughts&&l.messages.flatMap(u=>u.content).some(u=>u.content_type===rs.StructuredThoughts&&u.thoughts.length>0)}let i=!1;for(const l of t)if(l.type===g.CoTSearchTool)i=!0;else if(c(l)&&i)return!0;return!1})();return a.length>1||o.length>1||r}return!0}function Zt({groupedMessagesToRender:e,allMessages:n,allGroupedMessages:t,clientThreadId:a,isUserTurn:o,isCompletionRequestInProgress:r,isFeedbackEnabled:c,isFinalTurn:i,isFinalUserTurn:l,turnIndex:u,hasActiveRequest:d,onRequestCompletion:p,shouldGrowContainer:f=!0,isParagen:y=!1,renderingView:C="chat"}){const{showDebugConversationTurns:_}=Fs(),[b]=Y(a,m=>[m?.mode]),N=te();ae(N,"733205176");const E=Us(a),w=Ge(a),S=Vs(),D=t.some(m=>m.type===g.Browsing||m.type===g.RetrievalBrowsing||m.type===g.SearchGPTQuery||!1),Fe=Bs(()=>es.count(ss.DEFAULT,"conversation_turn_grouped_messages.attempted_render_missing_type_f959b8c")),$=ts(n),re=zs({clientThreadId:a,conversationMode:b}),Ue=x.useCallback(({sourceEvent:m,requestedModelId:h,appendMessages:j,extraStreamParams:M})=>{$&&re({sourceEvent:m,nodeId:$.id,requestedModelId:h,appendMessages:j,extraStreamParams:M})},[$,re]),Z=e.map((m,h)=>{const j=h===t.length-1,M=zt(e);if(m.type===K)return M?s.jsx(Ut,{isStreaming:i&&j&&r,isFinalTurn:i,messageGroups:m.groups,isAutoswitch:E?.enableInfer,isAutoswitchOptOutEnabled:E?.enableInferOptOut,handleSkipClick:k=>{ke.logEventWithStatsig("chatgpt_web_autoswitch_reasoning_skip_clicked","chatgpt_web_autoswitch_reasoning_skip_clicked",{conversationId:a,messageId:m.groups[0].messages[0].id}),Ue({sourceEvent:k,requestedModelId:"gpt-4o"})},markAutoswitchPreambleAsSeen:()=>{Ne(a,k=>{k.hasSeenAutoswitchPreamble=!0})},hasSeenAutoswitchPreamble:as(a)?.hasSeenAutoswitchPreamble},"cot-"+m.groups[0].messages[0].id):null;const ue=h===0?void 0:e[h-1],de=ue?.type!==K?ue:void 0,ge=de?.type,fe=de?.messages,Be=m&&!se(m.messages[0]),ze=D&&Be,H=[];switch(ze||H.push(s.jsx(Hs,{className:"min-h-8",message:m.messages[0],isFeedbackEnabled:c,isFinalUserTurn:l,isCompletionInProgress:j&&r,hasActiveRequest:d,turnIndex:u,clientThreadId:a,isUserTurn:o,prevGroupedMessageType:ge,prevGroupedMessages:fe},"text-message-"+m.messages[0].id)),_&&H.push(s.jsx(Bt,{clientThreadId:a,message:m.messages[0]},"message-debug-"+m.messages[0].id)),m.type){case g.Text:case g.MultiText:return m.type===g.Text?s.jsxs(x.Fragment,{children:[H,!1,s.jsx(Xs,{isUserTurn:o,message:m.messages[0]})]},"group-"+m.messages[0].id):m.type===g.MultiText?s.jsx(Nt,{clientThreadId:a,messages:m.messages,isCompletionInProgress:j&&r,isFeedbackEnabled:c,hasActiveRequest:d,prevGroupedMessageType:ge,prevGroupedMessages:fe},"multitext-"+(m.messages[0]?.id??h)):m.type;case g.Browsing:case g.RetrievalBrowsing:{const k=b!=null&&[W.GizmoInteraction,W.GizmoMagicCreate,W.GizmoTest].includes(b.kind),O=w?Ks(w):!1;return s.jsx(Rt,{messages:m.messages,isRequestActive:d,isLastMessageInTurn:j,isUsingGizmo:k,isUsingSnorlax:O,isRetrieval:m.type===g.RetrievalBrowsing},"browsing-"+(m.messages[0]?.id??h))}case g.SearchGPTQuery:{if(e.some(I=>I.type===K)&&M)return null;const O=e.slice(h+1).findLast(I=>I.type===g.Text||I.type===g.CoTSearchTool),J=n.findLast(I=>xe(I).length>0);return s.jsx(Et,{clientThreadId:a,turnIndex:u,isRequestActive:d,isLastMessage:j,isLastTurnInConversation:i,nextMessage:O?.messages[0],searchResultGroups:xe(J)},"searchquery-"+(m.messages[0]?.id??h))}case g.StructuredThoughts:return null;case g.ReasoningRecap:return null;case g.CoTSearchTool:return null;case g.n7jupd:return null;case g.n7jupd_i:case g.n7jupd_x:return null;case g.a8km123:{if(!m.messages.every(O=>!O.metadata?.reasoning_status)){const O=Le(n,J=>J.author.role===we.Assistant&&J.recipient==="all");return s.jsx(Ft,{clientThreadId:a,turnIndex:u,isStreaming:(j||O<h)&&r,isFinalTurn:i,messages:m.messages},"sum-"+(m.messages[0]?.id??h))}return s.jsx(Pt,{messages:m.messages,isStreaming:j&&r,isCompletionRequestInProgress:r,hasActiveRequest:d,isLastMessage:j,isFinalTurn:i,isFeedbackEnabled:c,clientThreadId:a,currentGroupedMessageIndex:h,turnIndex:u},"sum-"+(m.messages[0]?.id??h))}case g.f959b8c:return Fe(),null;case g.is_loading_message:return j&&r?s.jsx(Ws,{},"loading-message-"+h):null;case g.c12k321:return null;case g.l1p9k3u:return null;case g.b1de6e2_c:return s.jsx(mt,{messages:m.messages,clientThreadId:a,isLastMessage:j},"b1de6e2-"+(m.messages[0]?.id??h));case g.b1de6e2_s:return s.jsx(rt,{messages:m.messages,clientThreadId:a},"b1de6e2_s-"+(m.messages[0]?.id??h));case g.b1de6e2_d:return null;case g.b1de6e2_rm:return s.jsx(Qs,{messages:m.messages,clientThreadId:a,renderingView:C,children:H},"b1de6e2_rm-"+(m.messages[0]?.id??h));case g.de1d73e:if(S){const k=h+1<t.length?t[h+1]:void 0;return s.jsx(Vt,{clientThreadId:a,currentGroupedMessage:m,nextMessage:k&&k.type===g.Text?k.messages[0]:void 0,isLastMessage:j,isRequestActive:d},"jawbone-"+(m.messages[0]?.id??h))}else return null;case g.ParallelBrowsing:return s.jsx(Mt,{messages:m.messages},"parallel-"+(m.messages[0]?.id??h));case g.CodeInterpreter:return s.jsx(It,{messages:m.messages,isRequestActive:d,clientThreadId:a},"ada-"+(m.messages[0]?.id??h));case g.JITPlugin:return s.jsx(Lt,{messages:m.messages,clientThreadId:a,isLastTurnInConversation:i,onRequestCompletion:p},"jit-"+(m.messages[0]?.id??h));case g.t2uay3k:return s.jsx(Dt,{messages:m.messages,clientThreadId:a,disableClickThru:y,isLastTurnInConversation:i},"t2uay3k-"+(m.messages[0]?.id??h));case g.Dalle:return s.jsx(wt,{messages:m.messages,clientThreadId:a,disableClickThru:y},"dalle-"+(m.messages[0]?.id??h));case g.GizmoEditor:return s.jsx(Tt,{messages:m.messages},"gizmo-editor-"+(m.messages[0]?.id??h));case g.oiw209h:return s.jsx(kt,{messages:m.messages,clientThreadId:a},"oiw209h-"+(m.messages[0]?.id??h));case g.Canmore:return s.jsx(Js,{messages:m.messages,allTurnMessages:n,isFinalTurn:i,isRequestActive:d,clientThreadId:a,isUserTurn:o},"canmore-"+(m.messages[0]?.id??h));case g.Container:case g.Oboe:return null;case g.Debug:return _?s.jsx(At,{message:m.messages[0]},"debug-"+m.messages[0].id):null;case g.SearchResult:return s.jsx(Ot,{messages:m.messages},"search-result-"+(m.messages[0]?.id??h));case g.kanzi:return null;case g.Mochi:return null}}),Ve=Gs(),{wordFadeType:U,animationDurationMs:ie}=Ys(),B=x.useRef([]),le=x.useRef(void 0),ce=x.useRef(null),z=!o&&i&&r,me=n[0]?.id;return ns(()=>{if(U!=="indexed"||!z)return;const m=ce.current;if(!m)return;le.current!==me&&(le.current=me,B.current=[]);const h=m.getAnimations({subtree:!0}).filter(j=>j.animationName===be["fade-in"]);if(h.length!==0){const j=Qt({now:performance.now(),previousStartTimes:B.current,groupCount:h.length});B.current=j;for(let M=0;M<h.length;M++)h[M].startTime=j[M]}else B.current=[]},[Z,U,z]),s.jsx("div",{className:A({"flex max-w-full flex-col":!0,[be.root]:U==="indexed"&&z,grow:f}),style:U==="indexed"?{"--duration":`${ie}ms`}:void 0,ref:ce,children:s.jsx(os,{name:"GroupedMessages",fallback:Ht,children:o?Z:s.jsxs($s,{isDisabled:!z||U!=="delay",defaultAnimationDurationPerSegmentMs:ie,children:[Zs(N)&&i&&s.jsx(qs,{isStreaming:r,debug:Ve}),Z]},n[0]?.id)})})}function Ht({error:e}){return s.jsxs(et,{type:"danger",children:[s.jsx(R,{id:"5eGo3w",defaultMessage:"Unable to display this message due to an error."}),!1]})}function Jt(e,n,t){if(e.length<2||n<=0)return 0;const a=n/Math.log(2);e=[...e].sort((c,i)=>c-i);let o=0,r=0;for(let c=e.length-1;c>0;--c){const i=Math.exp(-(t-e[c])/a);if(o>0&&i/o<.01)break;const l=e[c]-e[c-1];o+=i,r+=i*l}return o===0?0:o/r}function Qt({now:e,previousStartTimes:n,groupCount:t,initialRate:a=50,halfLife:o=1}){const r=n.slice(0,Le(n,d=>d<=e)+1),c=r.length<2?a/1e3:Math.max(.01,Jt(r,o*1e3,e)),i=t-r.length;let l=r[r.length-1]??0,u=1;for(let d=0;d<i;d++){const p=c*1e3*u;i<p?u*=.8:i>p&&(u*=1.5);const f=1/(c*u),y=Math.max(e,l+f);r.push(y),l=y}return r}export{Zt as C,Ae as F,P as T,jt as a,$t as b};
//# sourceMappingURL=ci2m3wbqqcn0abts.js.map
