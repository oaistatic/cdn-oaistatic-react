import{r as u,ag as q,p as K,i as Y,j as r,a6 as X,a5 as x}from"./ci5tkrccytan34lo.js";import{me as Q,mf as $,mg as j,dV as J,C as p,mh as Z,mi as tt,kM as et,mj as st,l8 as at,mk as ot,ml as nt,iD as it,mm as rt,mn as ct,mo as dt,mp as R,mq as O,iB as ut,u as lt,mr as M,U as N,ms as k,mt,mu as pt,hc as ht,mv as gt}from"./fztttvm3qzdvif1h.js";import{h7 as S,aH as D,L as z,M as w,de as ft,e9 as xt,gg as vt,e_ as F,eQ as Ct,gV as Tt,gn as wt}from"./ccccre6vnqbb7l94.js";import{u as It,L as bt}from"./n3no0wqojk419ibl.js";import{T as yt}from"./i3iwctq0xt60nh9q.js";import{g as St}from"./btagl6w1gub4aw61.js";import"./jy1u8exw8iz2slve.js";import"./obtq7sfq52r3quc0.js";import"./m3p85h1r7wwh3ar4.js";import"./jm451ka9dh0zq0oh.js";import"./k09abscj5rdhtj24.js";import"./ripbggolk2hb9coi.js";import"./ehn8yucug7pv4ztd.js";import"./48ooml6yvtknt927.js";import"./f76gy0b8ieo4s693.js";import"./gy64pge8qevmvg7e.js";import"./hapan2fx2czn21gi.js";import"./kzhevji8i57j71hk.js";import"./fry4relkhm829fbi.js";import"./brm2ak4qsea0c84s.js";import"./c576qrs41b9t65x5.js";import"./klnfiyrj7k551tnx.js";import"./k6feznao7t0jcslv.js";import"./o18ouakn8cm15oum.js";import"./ka28zal7zgew9liz.js";import"./ci2m3wbqqcn0abts.js";import"./fleacu6r5buu7d0q.js";import"./o44s14nukx2dxzhr.js";import"./jppil0z87oklini1.js";import"./ouhw3r04e64ny5cd.js";import"./kydr9ghab5t92b8t.js";import"./grb7n11yz9748g22.js";import"./h1rqozkinxrlxfws.js";import"./j3zg44ruze86crbd.js";import"./grqqoygx78z5w4fx.js";import"./h2gd34k3oh53zw7p.js";import"./a1fl09gjys8m3drr.js";import"./k4lih7nb4umlxxxc.js";import"./bgu7mt464bd85qmz.js";import"./ln3t6yic0tgf7gor.js";import"./bb4l02lm4p1hlo2s.js";import"./o5dcel4w1cacawdo.js";import"./eykh2s3cx0s4wv4b.js";import"./nplnc7nfjbqgwb50.js";import"./d6qfcfpf3ythcmx2.js";import"./hnwyihljdxrug66f.js";import"./musjw8fjkljbblfz.js";import"./oqppwvh4icbsp0jr.js";import"./eek6z6v9ww7qwx26.js";import"./gu8jz4865kkdzo16.js";const W="oai/apps/canmoreSidebarWidth",Et=.25,_t=400,L=400;function P(t){return t-_t}function b(t,s){return q(L,P(t),s??Et*t)}function At(){const t=S.useState(S.selectWindowWidth),s=b(t,Q(D.DANGER_SECRET_FOLDERS_ONLY_getItem(W))),a=H(),[e,i]=u.useState(s);u.useEffect(()=>{(e<L||e>P(t))&&i(b(t,e))},[t]);function o(c){i(v=>b(t,v+=c.delta.x))}function n(c){i(c),D.DANGER_SECRET_FOLDERS_ONLY_setItem(W,c)}function l(){const c=b(t,void 0);n(c)}const h=`calc(100vw - ${e}px)`;return a?{chatWidth:e,canvasWidth:t-e,canvasWidthCalc:h,viewportWidth:t,handleDrag:o,handleDoubleClick:l,persist:n}:{chatWidth:0,canvasWidth:t,canvasWidthCalc:"100vw",viewportWidth:t,handleDrag:()=>{},handleDoubleClick:()=>{},persist:()=>{}}}function H(t){const s=S.useState(S.selectWindowWidth);return(t??s)>1e3}const _="sharedCanvas";function Rt(){const[t,s]=K(),a=t.get(_),e=Y();u.useEffect(()=>{const i=a&&$.createRemixTempTextdoc(a,e);if(!i)return;requestAnimationFrame(()=>{j(i)});const o=new URLSearchParams(t);o.delete(_),s(o);const n=new URL(window.location.href);n.searchParams.delete(_),history.replaceState(null,"",n)},[a,t,s,e])}const Mt="textdocId",Nt=t=>{const a=new URLSearchParams(window.location.search).get(Mt),e=z(t,i=>w.findNode(i,({message:o})=>{const n=o.metadata?.canvas;return n?.create_source===J.HIVE&&(a?n?.textdoc_id===a:!0)})?.message.metadata?.canvas?.textdoc_id);u.useEffect(()=>{e&&requestAnimationFrame(()=>{j(e)})},[e])};function kt(t,s){let a;return s?.type===p.Textdoc?s.textdocId.startsWith(Z)||(a={type:"canvas_textdoc",id:s.textdocId}):s?.type===p.Kanzi&&(a={type:"canvas_kanzi",id:s.kanziTurnId}),tt(t,{promptMessage:{metadata:{open_in_canvas_view:a}}})}const V=({isFullScreen:t=!1,clientThreadId:s,focusedObject:a,onClose:e,isAnimating:i=!1,width:o})=>{const{setTargetedContent:n}=et(),l=u.useRef(!1);if(u.useEffect(()=>(l.current&&n(void 0),l.current=!0,()=>{l.current=!1}),[a]),a==null)return null;switch(a.type){case p.Textdoc:return r.jsx(yt,{isFullScreen:t,onClose:e,clientThreadId:s,focusedTextdoc:a,isAnimating:i,width:o});case p.Kanzi:break;case p.ADAVisualization:return null}},Dt=300,Ft=t=>{switch(t?.type){case p.Textdoc:return t.textdocId;default:return null}};function Wt(t,s){const[a,e,i,o]=z(t,d=>[w.getRequestId(d),w.getConversationLastTurn(d),w.isMessageTurnEnded(d),w.getVariantIds(d).length>1]),n=ft(a),l=st(),[h,c]=u.useMemo(()=>{if(e&&o)return[void 0,null];if(s===!0)return[void 0,null];let d;return!i&&e&&(d=xt(e.messageGroups,g=>g.type!==vt)),jt({groupedMessage:d,isRequestActive:n,latestTextdocId:l})},[i,e,o,s,n,l]),v=c!=null,C=Ft(c),T=at("canvas");u.useEffect(()=>{if(c&&h&&!ot()&&(T(),nt(c,h),c.type===p.Textdoc)){const{textdocId:d}=c,g=St(d);it(document.getElementById(g))}},[v,C])}function jt({groupedMessage:t,isRequestActive:s,latestTextdocId:a}){switch(t?.type){case F.Canmore:{const[e,i]=t.messages;if(!rt(e))break;const o=ct(s,e,i??null),n=o.textdocId??a;if(n&&(o.function===dt.CreateTextdoc?(o.content??"").length>Dt||o.status===R.WAITING:o.status===R.STREAMING))return[o.messageId,{type:p.Textdoc,textdocId:n}];break}case F.kanzi:{const[,e]=t.messages,i=e?.metadata?.kanzi,o=i?.task_id,n=i?.turn_id;if(o&&n)return[e.id,{type:p.Kanzi,kanziId:o,kanziTurnId:n,isKickoff:!0,defaultDebug:!0}];break}}return[void 0,null]}const y={type:"spring",bounce:.12,duration:.64},Ot={type:"spring",bounce:0,duration:.58},zt=({clientThreadId:t,focusedObject:s,onClose:a})=>{const{chatWidth:e,canvasWidthCalc:i,handleDrag:o,handleDoubleClick:n,persist:l}=At(),[h,c]=u.useState(!0),[v,C]=u.useState(!1),T=mt(({rect:m})=>m),{windowHeight:d,windowWidth:g}=wt(m=>m,{windowWidth:0,windowHeight:0});let f=T??{top:0,left:e,width:g-e,height:d},A=!1;if(T&&(f.top<0||f.top+f.height>d)){A=!0;const m={width:(g-e)*.75,height:d*.75};f={top:d/2-m.height/2,left:(g-e-m.width)/2+e,width:m.width,height:m.height}}const I=T?.borderRadius,E=pt(),U=E?.history!=null||E?.showChangesAtVersion!=null,G=ht();return r.jsxs(r.Fragment,{children:[U&&r.jsx(bt,{onClick:()=>gt(E.textdocId),zIndexKey:"chatOverlay"}),r.jsxs(x.div,{initial:{marginRight:G?-260:0},animate:{marginRight:0},transition:Ot,children:[r.jsx(x.div,{initial:{opacity:1},animate:{opacity:0},exit:{opacity:[1,0]},transition:{...y,delay:.22},className:"bg-token-main-surface-primary pointer-events-none absolute start-0 top-0 z-20 h-full w-full"}),r.jsx(x.div,{className:"relative z-20 h-full",style:{width:i},exit:{width:0},transition:{type:"spring",bounce:0,duration:.1}})]}),r.jsx(x.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"pointer-events-none absolute start-0 top-0 z-10 h-full w-full bg-black/[0.025] dark:bg-transparent"}),r.jsx(x.div,{className:"absolute start-0 z-20 h-full overflow-hidden transition-shadow",initial:{borderRadius:I,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)",opacity:A?0:1,x:f.left,y:f.top,height:f.height,width:f.width},animate:{opacity:1,x:e,y:0,width:i,height:d,borderRadius:0,boxShadow:"0px 0px 18px rgba(0,0,0,0.075)"},exit:{scale:.64,opacity:0,filter:"blur(12px)",transition:{opacity:{duration:.14,bounce:.1}},borderRadius:I,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)"},transition:v?{duration:0}:y,onAnimationComplete:()=>c(!1),children:r.jsx(x.div,{className:"dark:border-token-border-medium h-full overflow-hidden border-s border-gray-100",initial:{borderRadius:I},animate:{borderRadius:0},exit:{borderRadius:I},transition:y,children:r.jsxs("div",{className:"h-full",children:[r.jsx(x.div,{drag:"x",className:"bg-token-text-quaternary absolute start-[-2px] z-10 h-full w-[4px] cursor-ew-resize opacity-0",whileHover:{opacity:.5},whileDrag:{opacity:.75,width:"8px",left:"-4px"},transition:{type:"tween",duration:.1},style:{x:0,y:0,transform:"translateX(0px)"},dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:{left:0,right:0,top:0,bottom:0},onPointerDown:()=>C(!0),onPointerUp:()=>C(!1),onDrag:(m,B)=>o(B),onDragEnd:()=>{C(!1),l(e)},onDoubleClick:()=>n()}),v&&r.jsx("div",{className:"absolute inset-0 z-10"}),r.jsx(V,{onClose:a,clientThreadId:t,isAnimating:h,focusedObject:s,width:g-e})]})})})]})},Lt=u.memo(zt),Pt=({clientThreadId:t,focusedObject:s,onClose:a})=>r.jsx(Tt,{children:r.jsx(x.div,{className:"fixed inset-0 z-40 overflow-hidden shadow-xl md:border-gray-100 md:dark:border-gray-700",initial:{scale:.98},animate:{scale:1},transition:y,children:r.jsx(V,{isFullScreen:!0,clientThreadId:t,focusedObject:s,onClose:a})})}),Ht=({clientThreadId:t,overrideWidth:s,isAutoFocusDisabled:a=!1})=>{const e=H(s),i=It();Wt(t,a||i),Rt(),Nt(t);const o=lt();u.useEffect(()=>{O()},[t]);const n=o&&(e?r.jsx(Lt,{clientThreadId:t,onClose:k,focusedObject:o},"canvas-sidebar"):r.jsx(Pt,{clientThreadId:t,onClose:k,focusedObject:o},"canvas-modal"));u.useEffect(()=>{if(o)return M(h=>kt(h,o)),()=>M(null)},[o]);const l=n!=null;return u.useEffect(()=>(N.setActiveStageSidebar(l),()=>{l&&N.setActiveStageSidebar(!1)}),[l]),r.jsx(X,{children:n},t)},ze=t=>{const s=u.useRef(null);return r.jsx(Ct,{ref:s,onError:(a,e)=>{O(),setTimeout(()=>{s.current?.resetErrorBoundary()}),ut.logError("Error boundary hit",a,{componentStack:e})},name:"canmore-focused-view",children:r.jsx(Ht,{...t})})};export{ze as CanvasFocusedViewManager};
//# sourceMappingURL=kz0s7ojc7mrmc7u4.js.map
