import{y as I,ac as D,aq as ne,ar as P,b as O,ap as H,ah as es,ai as ss,B as y,aa as B,am as ve,e as Q,c as W,F as ts,cv as as,I as ns,b0 as os,fe as is}from"./ccccre6vnqbb7l94.js";import{j as e,M as r,e as oe,i as b,r as x,a as Z,b as q,u as z,a5 as ye,a6 as we}from"./ci5tkrccytan34lo.js";import{bm as ls,gg as rs,kz as cs,c3 as ke,h_ as Me,bM as ds,rV as us,rW as Ne,rX as ms,dg as w,m4 as ie,eb as Y,iG as Se,aa as Te,fQ as De,ai as Ae,bL as Fe,jp as Oe,rY as xs,j as T,mN as te,rZ as Ee,cN as fs,jo as V,r_ as X,jr as gs,fL as ps,hH as Pe,E as le,y as re,z as R,r$ as hs,re as _s,ip as js,at as bs,as as xe,a_ as Cs,s0 as fe,s1 as vs,s2 as ys,s3 as ws,s4 as ks,ea as N,cH as Ms,mF as Ns,x as Ss,cI as Ts,d7 as Ds}from"./fztttvm3qzdvif1h.js";import{f as As,a as Fs,b as Os}from"./cwqss6rjf37yjveo.js";import{c as ce,d as de,A as Es,b as J,f as ge,g as E,e as Ps}from"./je8s4flsbdmtns70.js";import{u as Rs,l as Re,p as Is}from"./o6tnov12l4y47p1a.js";import{l as Us,u as Ls,S as Ie}from"./ec53lf1t0iwe49th.js";import{e as Gs}from"./bgu7mt464bd85qmz.js";import{c as Bs}from"./fg371799b5cdpp9i.js";import{C as Ue,S as Ws,u as Le,R as Ge,A as Be,g as We,a as qs,b as zs,c as Vs,d as Ks,e as Hs,M as Qs,D as ae,G as Zs,f as Ys}from"./bcgmpdnrh9l0rta8.js";import{P as ue,c as Xs}from"./m3p85h1r7wwh3ar4.js";import{A as Js}from"./i73vt1v0yzzeic9n.js";import{a as $s,g as pe}from"./fyhxout75hqspf6y.js";import{c as qe}from"./jq1xbz38gn4vzp5i.js";import"./j35k0ib6x4x2st6f.js";import"./h1rqozkinxrlxfws.js";import"./j3zg44ruze86crbd.js";import"./grqqoygx78z5w4fx.js";import"./hapan2fx2czn21gi.js";import"./kzhevji8i57j71hk.js";import"./h2gd34k3oh53zw7p.js";import"./a1fl09gjys8m3drr.js";import"./k4lih7nb4umlxxxc.js";import"./bb4l02lm4p1hlo2s.js";import"./ln3t6yic0tgf7gor.js";import"./o5dcel4w1cacawdo.js";import"./eykh2s3cx0s4wv4b.js";import"./nplnc7nfjbqgwb50.js";import"./d6qfcfpf3ythcmx2.js";import"./hnwyihljdxrug66f.js";import"./musjw8fjkljbblfz.js";import"./pcjr7askdf0x3oga.js";import"./n1daj33n3xqfllpk.js";import"./ktm37gljdz6cbczg.js";import"./bj6lj4ia2dzck3r4.js";import"./na990nyshzxxvwtf.js";import"./grb7n11yz9748g22.js";import"./hugyrgh2z3kam9pv.js";import"./iybu6wr75jy7k3g9.js";import"./fmqpx3wqey84zgy2.js";import"./cn3ovrj62d7r0re6.js";import"./ifp7qsxw68apsygx.js";import"./i2u6xi5n8vz1uw3v.js";import"./khkh5m0f7cvgfw6e.js";const et=qe("Search16Regular","16",["M9.3 10.02a4.5 4.5 0 1 1 .7-.7l3.85 3.83a.5.5 0 0 1-.7.7L9.3 10.02ZM10 6.5a3.5 3.5 0 1 0-7 0 3.5 3.5 0 0 0 7 0Z"]),st=qe("SettingsCogMultiple20Filled","20",["M8 2c-.37 0-.73.04-1.08.1a.5.5 0 0 0-.4.4l-.26 1.36c-.05.25-.3.4-.54.31l-1.3-.45a.5.5 0 0 0-.55.14A5.5 5.5 0 0 0 2.8 5.74c-.07.2-.01.4.14.54l1.05.9c.19.17.19.47 0 .63l-1.05.91a.5.5 0 0 0-.14.54c.23.7.6 1.34 1.08 1.88.14.15.35.2.54.14l1.3-.45c.25-.08.5.06.55.31l.27 1.36c.03.2.19.35.39.4a5.52 5.52 0 0 0 2.17 0 .5.5 0 0 0 .4-.4l.25-1.36c.05-.25.3-.4.55-.31l1.3.45c.19.06.4 0 .54-.14a5.5 5.5 0 0 0 1.08-1.89.5.5 0 0 0-.14-.53l-1.04-.9a.42.42 0 0 1 0-.63l1.04-.9a.5.5 0 0 0 .14-.54 5.5 5.5 0 0 0-1.08-1.89.5.5 0 0 0-.54-.14l-1.3.45a.42.42 0 0 1-.55-.31L9.48 2.5a.5.5 0 0 0-.4-.4C8.75 2.05 8.39 2 8 2ZM6.5 7.5a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Zm4.66 4.95a.46.46 0 0 1 .53-.15l.8.27c.26.1.54-.07.6-.34l.15-.83c.04-.2.2-.36.4-.38a3.55 3.55 0 0 1 .72 0c.2.02.35.18.4.38l.15.83c.06.27.34.43.6.34l.8-.27c.19-.07.4-.02.52.15.14.2.27.4.36.62.09.19.03.4-.13.53l-.64.56c-.2.18-.2.5 0 .68l.64.56c.16.13.22.34.13.53-.1.22-.22.43-.36.62a.46.46 0 0 1-.52.15l-.8-.27a.45.45 0 0 0-.6.34l-.16.83c-.04.2-.19.36-.4.38a3.55 3.55 0 0 1-.71 0 .46.46 0 0 1-.4-.38l-.16-.83a.45.45 0 0 0-.6-.34l-.8.27c-.18.07-.4.02-.52-.15a3.5 3.5 0 0 1-.36-.62.46.46 0 0 1 .13-.53l.64-.56c.21-.18.21-.5 0-.68l-.64-.56a.46.46 0 0 1-.13-.53c.1-.22.22-.43.36-.62ZM15 14.5a1 1 0 1 0-2 0 1 1 0 0 0 2 0Z"]),ze=({worksWith:s})=>{const t=b();return e.jsx("span",{className:"bg-token-bg-tertiary text-token-text-secondary mx-1.5 rounded-md px-1.5 py-0.5 text-xs",children:Us(s,t)})},tt=()=>e.jsx("span",{className:"text-token-text-secondary mx-1.5 rounded-full border px-1.5 py-0.5 text-[9px] uppercase",children:e.jsx(r,{..._.customConnectorBadge})}),me=({icon:s,label:t,isCustom:o,worksWith:a,description:n,trailingContent:i,infoText:l})=>e.jsxs(Es,{className:"border-token-border-default items-center border-b last:border-b-0",children:[s,e.jsxs("div",{className:"flex-1 overflow-hidden",children:[e.jsxs("div",{className:"text-token-text-primary text-md flex items-center font-medium",children:[t,o?e.jsx(tt,{}):a?.map(c=>e.jsx(ze,{worksWith:c},c))]}),e.jsxs("div",{className:"text-token-text-secondary mt-0.5 flex items-center gap-1 truncate text-sm",children:[n&&e.jsx("span",{className:"truncate",children:n}),l&&e.jsx(Ae,{label:l,children:e.jsx(Fe,{className:"h-4 w-4"})})]})]}),i]}),$=({icon:s,label:t,worksWith:o,description:a,infoText:n,enabled:i,onChange:l,isLoading:c,isCustom:m,onDelete:u})=>{const f=u?e.jsxs(w.Root,{children:[e.jsx(w.BasicTrigger,{asChild:!0,children:e.jsx(y,{color:"secondary",size:"medium",children:e.jsx(r,{..._.manageConnector})})}),e.jsx(w.Portal,{children:e.jsx(w.Content,{size:"small",align:"end",children:e.jsxs(w.Item,{onClick:u,color:"danger",children:[e.jsx(Y,{className:"icon-md"}),e.jsx(r,{..._.deleteConnector})]})})})]}):null;return e.jsx(me,{icon:s,label:t,worksWith:o,description:a,infoText:n,isCustom:m,trailingContent:c?e.jsx(I,{}):e.jsxs("div",{className:"flex items-center gap-5",children:[f,e.jsx(De,{checked:i,onCheckedChange:l,"aria-label":t,size:"normal"})]})})},Ve=(s,t)=>{const o=s.owners[0]?"your workspace's admin":null;return o&&s.description?t.formatMessage(_.customConnectorDescription,{description:s.description,owner:o}):o?t.formatMessage(_.createdBy,{owner:o}):s.description},Ke=(s,t)=>s.created_at&&s.base_url?`${s.base_url}
${t.formatMessage(_.createdAt,{createdAt:new Date(s.created_at).toLocaleString(t.locale,{dateStyle:"medium",timeStyle:"short"})})}`:s.created_at?t.formatMessage(_.createdAt,{createdAt:new Date(s.created_at).toLocaleString(t.locale,{dateStyle:"medium",timeStyle:"short"})}):s.base_url,at=({connector:s,onPublish:t,onDelete:o,isPublished:a})=>{const n=D(),i=b(),[l,c]=x.useState(!1),m=async()=>{c(!0);try{await t()}catch{n.danger(i.formatMessage(_.publishConnectorFailed))}finally{c(!1)}},u=e.jsxs(w.Root,{children:[e.jsx(w.BasicTrigger,{children:e.jsx(ie,{})}),e.jsx(w.Portal,{children:e.jsx(w.Content,{size:"small",align:"end",children:e.jsxs(w.Item,{onClick:o,color:"danger",children:[e.jsx(Y,{className:"icon-md"}),e.jsx(r,{..._.deleteConnector})]})})})]});return e.jsx(me,{icon:e.jsx(Ne,{connector:s,size:"small",className:"h-fit rounded-xl border-[0.5px] p-2 shadow-sm"}),label:Re(s.name,i),description:Ve(s,i),infoText:Ke(s,i),trailingContent:e.jsxs(e.Fragment,{children:[l||!a?e.jsx(y,{color:"secondary",size:"small",onClick:m,loading:l,children:e.jsx(r,{..._.publishConnector})}):e.jsxs(y,{color:"secondary",size:"small",disabled:!0,children:[e.jsx(Se,{className:"me-1 h-4 w-4"}),e.jsx(r,{..._.publishedConnector})]}),u]})})},nt=({onCreate:s})=>{const t=b();return e.jsx("button",{onClick:s,children:e.jsx(me,{icon:e.jsx("span",{className:"border-token-border-heavy h-fit rounded-xl border border-dashed p-2",children:e.jsx(Te,{className:"icon-lg"})}),label:t.formatMessage(_.createConnector),description:t.formatMessage(_.createConnectorDescription)})})},ot=({connector:s,workspaceId:t,onDelete:o})=>{const a=b(),n=D(),i=Z(),l=H(),{enabled:c,isLoading:m}=Rs(s.id),u=Ls(s),f=s.owners.length>0,{variables:g,mutate:p}=q({mutationFn:h=>O.safePost("/accounts/{account_id}/connectors/{connector_id}/workspace_permissions",{parameters:{path:{account_id:t,connector_id:s.id}},requestBody:{enabled:h}}),onSettled:()=>{i.invalidateQueries({queryKey:ds(l?.normalizedAccountUserId)});const h=es[ss.GITHUB_CONNECTOR];s.id===h&&!g&&i.invalidateQueries({queryKey:["workspace-settings",t]})},onError:()=>{n.danger(a.formatMessage(_.featureSettingsUpdateFailed))}});return e.jsx($,{icon:e.jsx(Ne,{connector:s,size:"small",className:"h-fit rounded-xl border-[0.5px] p-2 shadow-sm"}),label:Re(s.name,a),description:Ve(s,a),infoText:f?Ke(s,a):void 0,worksWith:s.id===us?u:void 0,enabled:g??!!c,onChange:p,isLoading:m,isCustom:f,onDelete:f?o:void 0})},it=({workspaceId:s})=>{const t=b(),o=D(),a=Z(),{data:n,isLoading:i}=ne(s),l=!!n?.beta_settings[P.CONTEXT_CONNECTOR_GDRIVE],{variables:c,mutate:m}=q({mutationFn:u=>O.safePost("/accounts/{account_id}/beta_features",{parameters:{path:{account_id:s}},requestBody:{feature:P.CONTEXT_CONNECTOR_GDRIVE,value:u}}),onSettled:()=>{a.invalidateQueries({queryKey:["workspace-settings"]})},onError:()=>{o.danger(t.formatMessage(_.featureSettingsUpdateFailed))}});return e.jsx($,{icon:e.jsx("span",{className:"h-fit rounded-xl border-[0.5px] p-2 shadow-sm",children:e.jsx(ke,{className:"h-6 w-6"})}),label:t.formatMessage(_.gdriveFileUploadLabel),worksWith:["fileUploads"],description:t.formatMessage(_.gdriveFileUploadDescription),enabled:c??!!l,onChange:m,isLoading:i})},lt=({workspaceId:s})=>{const t=b(),o=D(),a=Z(),{data:n,isLoading:i}=ne(s),l=!!n?.beta_settings[P.CONTEXT_CONNECTOR_O365_BUSINESS],{variables:c,mutate:m}=q({mutationFn:u=>O.safePost("/accounts/{account_id}/beta_features",{parameters:{path:{account_id:s}},requestBody:{feature:P.CONTEXT_CONNECTOR_O365_BUSINESS,value:u}}),onSettled:()=>{a.invalidateQueries({queryKey:["workspace-settings"]})},onError:()=>{o.danger(t.formatMessage(_.featureSettingsUpdateFailed))}});return e.jsx($,{icon:e.jsx("span",{className:"h-fit rounded-xl border-[0.5px] p-2 shadow-sm",children:e.jsx(Me,{className:"h-6 w-6"})}),label:t.formatMessage(_.sharepointFileUploadLabel),worksWith:["fileUploads"],description:t.formatMessage(_.sharepointFileUploadDescription),enabled:c??!!l,onChange:m,isLoading:i})},rt=({workspaceId:s})=>{const t=b(),o=D(),a=Z(),{data:n,isLoading:i}=ne(s),l=!!n?.beta_settings[P.CONTEXT_CONNECTOR_O365_PERSONAL],{variables:c,mutate:m}=q({mutationFn:u=>O.safePost("/accounts/{account_id}/beta_features",{parameters:{path:{account_id:s}},requestBody:{feature:P.CONTEXT_CONNECTOR_O365_PERSONAL,value:u}}),onSettled:()=>{a.invalidateQueries({queryKey:["workspace-settings"]})},onError:()=>{o.danger(t.formatMessage(_.featureSettingsUpdateFailed))}});return e.jsx($,{icon:e.jsx("span",{className:"h-fit rounded-xl border-[0.5px] p-2 shadow-sm",children:e.jsx(Me,{className:"h-6 w-6"})}),label:t.formatMessage(_.onedrivePersonalFileUploadLabel),worksWith:["fileUploads"],description:t.formatMessage(_.onedrivePersonalFileUploadDescription),enabled:c??!!l,onChange:m,isLoading:i})},He=()=>e.jsx(r,{..._.connectorsSubtitle,values:{link:s=>e.jsx(ls,{href:"https://help.openai.com/en/collections/12923329-connected-apps",openNewTab:!0,children:s},"allowed-connectors-subtitle-link")}}),ct=()=>e.jsxs("div",{children:[e.jsx(ce,{children:e.jsx(r,{..._.connectorsTitle})}),e.jsx(de,{className:"text-token-text-secondary",children:e.jsx(He,{})})]});function dt({workspaceId:s}){const t=b(),{enabled:o,availableConnectors:a}=Gs(),{platformConnectors:n,isLoading:i,refetch:l}=rs(),{showWorkspaceSettings:c}=cs(),m=x.useMemo(()=>Array.from(n.values()).filter(d=>d.connector_type==="MCP"||a.some(C=>C.id===d.id)),[n,a]),u=x.useMemo(()=>{const d=m.filter(M=>M.connector_type!=="MCP"||M.status!=="ONLY_ME").map(M=>({type:"platform",ownerCount:M.owners.length,name:M.name,connector:M})),C={type:"gdrive_file_upload",ownerCount:0,name:t.formatMessage(_.gdriveFileUploadLabel)},S={type:"sharepoint_file_upload",ownerCount:0,name:t.formatMessage(_.sharepointFileUploadLabel)},A={type:"onedrive_personal_file_upload",ownerCount:0,name:t.formatMessage(_.onedrivePersonalFileUploadLabel)};return[...d,...c?[C,S,A]:[]].sort((M,L)=>L.ownerCount-M.ownerCount||M.name.localeCompare(L.name))},[m,t,c]),[f,g]=x.useState([]),p=x.useMemo(()=>m.filter(d=>d.connector_type==="MCP"&&(d.status==="ONLY_ME"||f.includes(d.id))),[m,f]),h=async d=>{g(C=>[...C,d]),await Is(d,s),await l()},j=o&&!!u.length;if(i)return e.jsx(I,{});if(!o)return null;const v=async d=>{await ms(d),l()};return e.jsx(Bs,{items:[...j?[{key:"workspace",label:t.formatMessage(_.workspaceTabLabel),children:e.jsx(e.Fragment,{children:u.map(d=>d.type==="gdrive_file_upload"?e.jsx(it,{workspaceId:s},d.type):d.type==="sharepoint_file_upload"?e.jsx(lt,{workspaceId:s},d.type):d.type==="onedrive_personal_file_upload"?e.jsx(rt,{workspaceId:s},d.type):e.jsx(ot,{connector:d.connector,workspaceId:s,onDelete:()=>v(d.connector.id)},d.connector.id))})}]:[],{key:"my",label:t.formatMessage(_.myTabLabel),children:e.jsxs(e.Fragment,{children:[p.map(d=>e.jsx(at,{connector:d,onPublish:()=>h(d.id),onDelete:()=>v(d.id),isPublished:f.includes(d.id)},d.id)),e.jsx(nt,{onCreate:()=>{window.location.hash="#settings/ConnectorSettings?create-connector=true"}})]})}]})}const _=oe({connectorsTitle:{id:"8ZP+KV",defaultMessage:"Connectors"},connectorsSubtitle:{id:"8WR/V3",defaultMessage:"Manage which apps users in this workspace can connect to. <link>Learn more</link>"},featureSettingsUpdateFailed:{id:"allowedConnectorsSection.adminPermissionsUpdateFailed",defaultMessage:"Failed to update permissions for connector"},gdriveFileUploadLabel:{id:"allowedConnectorsSection.gdriveFileUploadLabel",defaultMessage:"Google Drive"},gdriveFileUploadDescription:{id:"allowedConnectorsSection.gdriveFileUploadDescription",defaultMessage:"Upload Google Drive files in messages sent to ChatGPT."},sharepointFileUploadLabel:{id:"allowedConnectorsSection.sharepointFileUploadLabel",defaultMessage:"Microsoft OneDrive (work/school)"},sharepointFileUploadDescription:{id:"allowedConnectorsSection.sharepointFileUploadDescription",defaultMessage:"Upload SharePoint and OneDrive for Business files in messages sent to ChatGPT."},onedrivePersonalFileUploadLabel:{id:"allowedConnectorsSection.onedrivePersonalFileUploadLabel",defaultMessage:"Microsoft OneDrive (personal)"},onedrivePersonalFileUploadDescription:{id:"allowedConnectorsSection.onedrivePersonalFileUploadDescription",defaultMessage:"Upload personal OneDrive files in messages sent to ChatGPT."},workspaceTabLabel:{id:"b8IYtR",defaultMessage:"Workspace"},myTabLabel:{id:"C2YTBV",defaultMessage:"My connectors"},customConnectorDescription:{id:"/fxqnH",defaultMessage:"{description} • Created by {owner}"},createdBy:{id:"xqRlBb",defaultMessage:"Created by {owner}"},customConnectorBadge:{id:"q4oGB6",defaultMessage:"Custom"},publishedConnector:{id:"5gTvjk",defaultMessage:"Published"},publishConnector:{id:"HtDEy8",defaultMessage:"Publish to workspace"},publishConnectorFailed:{id:"iTXiK2",defaultMessage:"Failed to publish connector"},deleteConnector:{id:"DJDhnI",defaultMessage:"Delete"},createdAt:{id:"vQx/QC",defaultMessage:"Created {createdAt}"},manageConnector:{id:"ejE2jG",defaultMessage:"Manage"},createConnector:{id:"nrxInz",defaultMessage:"Create a connector"},createConnectorDescription:{id:"+sWVSA",defaultMessage:"Connect ChatGPT to your favorite tools"}}),F=oe({fileSingular:{id:"TKyiaj",defaultMessage:"file"},filesPlural:{id:"krAMi5",defaultMessage:"files"},domainSingular:{id:"ExZP9r",defaultMessage:"domain"},domainsPlural:{id:"PmkQD7",defaultMessage:"domains"}});function he(s,t){return s==="google_drive_dwd"||s==="google_drive_oauth"?{objectTypeSingular:t.formatMessage(F.fileSingular),objectTypePlural:t.formatMessage(F.filesPlural),externalLinkableUnitSingular:t.formatMessage(F.domainSingular),externalLinkableUnitPlural:t.formatMessage(F.domainsPlural)}:s==="slack"?{objectTypeSingular:t.formatMessage({id:"Y22i2G",defaultMessage:"channel"}),objectTypePlural:t.formatMessage({id:"UXSOIk",defaultMessage:"channels"}),externalLinkableUnitSingular:t.formatMessage({id:"yyIyWp",defaultMessage:"workspace"}),externalLinkableUnitPlural:t.formatMessage({id:"LuznzN",defaultMessage:"workspaces"})}:{objectTypeSingular:t.formatMessage(F.fileSingular),objectTypePlural:t.formatMessage(F.filesPlural),externalLinkableUnitSingular:t.formatMessage(F.domainSingular),externalLinkableUnitPlural:t.formatMessage(F.domainsPlural)}}function G({label:s,value:t}){return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-token-border-medium w-full border-t"}),e.jsxs("div",{className:"flex w-full flex-row justify-between py-2",children:[e.jsx("span",{className:"text-token-text-primary",children:s}),e.jsx("span",{className:"text-token-text-secondary",children:t})]})]})}function ut({connection:s,adminUserConnectionState:t}){const o=t&&t.user_connection_details.activation_status!=="inactive"&&t.user_connection_details.auth_status!=="not_connected";switch(s.connection_config.knowledge_connector_type){case"google_drive_oauth":return e.jsx(mt,{connectionConfig:s.connection_config,connectionStatus:s.connection_status,isAdminConnected:o});case"slack":return e.jsx(ft,{connectionConfig:s.connection_config,connectionStatus:s.connection_status,isAdminConnected:o});case"github":case"notion":case"merge_file_storage":case"google_drive_dwd":return e.jsx(xt,{});case void 0:return null}}function mt({connectionConfig:s,connectionStatus:t,isAdminConnected:o}){const a=b(),n=t==="activating"||t==="partially_activated"||t==="active";return e.jsxs("div",{className:"px-4",children:[n&&o!=null&&!o&&e.jsx(Qe,{connectionConfig:s}),e.jsx(G,{label:a.formatMessage({id:"bVi1Vt",defaultMessage:"Connection type"}),value:a.formatMessage({id:"DSWj22",defaultMessage:"Self-service"})}),!!s.domain_name&&e.jsx(G,{label:a.formatMessage({id:"DtrjbM",defaultMessage:"Domain name"}),value:s.domain_name})]})}function xt(){const s=b();return e.jsx("div",{className:"px-4",children:e.jsx(G,{label:s.formatMessage({id:"bVi1Vt",defaultMessage:"Connection type"}),value:s.formatMessage({id:"voo3FC",defaultMessage:"Admin-managed"})})})}function ft({connectionConfig:s,connectionStatus:t,isAdminConnected:o}){const a=b();return e.jsxs("div",{className:"px-4",children:[t==="activating"&&o!=null&&!o&&e.jsx(Qe,{connectionConfig:s}),e.jsx(G,{label:a.formatMessage({id:"JXKtnI",defaultMessage:"Slack domain"}),value:s.team_domain}),e.jsx(G,{label:a.formatMessage({id:"a1Cjhf",defaultMessage:"Team ID"}),value:s.team_id})]})}function Qe({connectionConfig:s}){const{data:t,isLoading:o,refetch:a}=z({queryKey:["user_connection_status"],queryFn:T.user_connection_status}),{refetch:n}=Oe({skip:!0}),i=()=>{a(),n()},l=t?.connection_statuses.some(m=>m.user_connection_details.connection_instance_id===s.connection_config_id&&m.user_connection_details.auth_status==="user_connected");if(o||l)return null;const c=({isLoading:m,disabled:u,onClick:f})=>e.jsx(y,{color:"primary",loading:m,disabled:u,onClick:f,children:e.jsx(r,{id:"9ZiK24",defaultMessage:"Connect"})});return e.jsxs(ye.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{delay:.2,duration:.5},className:"bg-token-hint-bg dark:bg-token-main-surface-tertiary mb-2 flex flex-col gap-2 rounded-xl p-4",children:[e.jsxs("div",{className:"flex flex-row items-start gap-4",children:[e.jsx(Fe,{className:"icon-lg"}),e.jsx("span",{className:"text-sm",children:e.jsx(r,{id:"gdALIj",defaultMessage:"This connection will not finish activating until a user connects."})})]}),e.jsx(xs,{connectionId:s.connection_config_id,connectorType:s.knowledge_connector_type,renderButton:c,location:"admin_settings",refetch:i})]})}function Ze({isOpen:s,onClose:t,connectionId:o,accountId:a,isPostActivation:n,footerContent:i,primaryButton:l,secondaryButton:c}){const m=b(),{data:u,isLoading:f,error:g,refetch:p}=z({queryKey:["slack_channel_type_scopes",o],queryFn:()=>T.admin_connection_list_item_scopes(a,o,"channel_type")});let h,j;return u?.object_selections.forEach(({object_handle:v,selection:d})=>{v==="public"?h=d==="include":v==="private"&&(j=d==="include")}),e.jsxs(B,{testId:"modal-slack-channel-scope",...Ue,isOpen:s,onClose:t,children:[e.jsxs("div",{className:"flex flex-col gap-4 px-6 pt-4 pb-10",children:[e.jsx("p",{className:"text-token-text-primary",children:e.jsx(r,{id:"Ot9UkQ",defaultMessage:"Control which types of channels should be synced."})}),!n&&e.jsxs("div",{className:"bg-token-main-surface-secondary text-token-text-primary flex w-full flex-row items-center gap-4 rounded-xl p-4",children:[e.jsx(ve,{className:"icon-lg"}),e.jsx("span",{className:"text-sm",children:e.jsx(r,{id:"qByMz2",defaultMessage:"You will not be able to modify the sync policy once the connection starts syncing data."})})]}),g&&e.jsxs("div",{className:"my-2 flex flex-row items-center gap-2 rounded-lg bg-red-500 p-2 text-white",children:[e.jsx(te,{className:"icon-md inline"}),e.jsx(r,{id:"F9HsRh",defaultMessage:"Something went wrong."}),e.jsx("button",{onClick:()=>p(),className:"underline",children:e.jsx(r,{id:"y/IEAC",defaultMessage:"Try again"})})]}),f?e.jsx(ue,{lines:4}):e.jsxs(e.Fragment,{children:[h!=null&&e.jsx(_e,{connectionId:o,accountId:a,slackChannelScope:"public",title:m.formatMessage({id:"CXSVXf",defaultMessage:"Public channels"}),refetch:p,value:h,isPostActivation:n}),j!=null&&e.jsx(_e,{connectionId:o,accountId:a,slackChannelScope:"private",title:m.formatMessage({id:"5XrboJ",defaultMessage:"Private channels"}),refetch:p,value:j,isPostActivation:n})]})]}),e.jsx(Ee,{footerContent:i,primaryButton:l,secondaryButton:c})]})}function _e({connectionId:s,accountId:t,slackChannelScope:o,title:a,refetch:n,value:i,isPostActivation:l}){const c=D(),m=b(),[u,f]=x.useState(!1),g=async p=>{if(!u){f(!0);try{p?await T.admin_connection_unblock_items(t,s,"channel_type",[o]):await T.admin_connection_block_items(t,s,"channel_type",[o]),n()}catch{c.danger(m.formatMessage({id:"7QF5n6",defaultMessage:"Failed to update policy. Please try again later."}))}finally{f(!1)}}};return l?e.jsxs("div",{className:"group border-token-border-medium flex w-full flex-row items-center gap-4 rounded-xl border px-8 py-4",children:[i?e.jsx(fs,{className:"icon-lg"}):e.jsx(Ws,{className:"icon-lg"}),e.jsx("p",{className:"flex-1",children:a})]}):e.jsxs("div",{className:"group border-token-border-medium flex w-full flex-row items-center gap-4 rounded-xl border px-8 py-4",children:[e.jsx(De,{checked:i,disabled:u,"aria-label":a,onCheckedChange:g}),e.jsx("p",{children:a}),u&&e.jsx(I,{})]})}const Ye=s=>x.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},x.createElement("path",{d:"M8.7587 3H15.2413C16.0463 2.99999 16.7106 2.99998 17.2518 3.04419C17.8139 3.09012 18.3306 3.18868 18.816 3.43597C19.5686 3.81947 20.1805 4.43139 20.564 5.18404C20.8113 5.66937 20.9099 6.18608 20.9558 6.74817C21 7.28936 21 7.95372 21 8.75868V15.2413C21 16.0463 21 16.7106 20.9558 17.2518C20.9099 17.8139 20.8113 18.3306 20.564 18.816C20.1805 19.5686 19.5686 20.1805 18.816 20.564C18.3306 20.8113 17.8139 20.9099 17.2518 20.9558C16.7106 21 16.0463 21 15.2413 21H8.75868C7.95372 21 7.28936 21 6.74817 20.9558C6.18608 20.9099 5.66937 20.8113 5.18404 20.564C4.43139 20.1805 3.81947 19.5686 3.43597 18.816C3.18868 18.3306 3.09012 17.8139 3.04419 17.2518C2.99998 16.7106 2.99999 16.0463 3 15.2413V8.7587C2.99999 7.95373 2.99998 7.28937 3.04419 6.74817C3.09012 6.18608 3.18868 5.66937 3.43597 5.18404C3.81947 4.43139 4.43139 3.81947 5.18404 3.43597C5.66937 3.18868 6.18608 3.09012 6.74817 3.04419C7.28937 2.99998 7.95373 2.99999 8.7587 3ZM6.91104 5.03755C6.47262 5.07337 6.24842 5.1383 6.09202 5.21799C5.7157 5.40973 5.40973 5.7157 5.21799 6.09202C5.1383 6.24842 5.07337 6.47262 5.03755 6.91104C5.00078 7.36113 5 7.94342 5 8.8V15.2C5 16.0566 5.00078 16.6389 5.03755 17.089C5.07337 17.5274 5.1383 17.7516 5.21799 17.908C5.40973 18.2843 5.7157 18.5903 6.09202 18.782C6.24842 18.8617 6.47262 18.9266 6.91104 18.9624C7.36113 18.9992 7.94342 19 8.8 19H15.2C16.0566 19 16.6389 18.9992 17.089 18.9624C17.5274 18.9266 17.7516 18.8617 17.908 18.782C18.2843 18.5903 18.5903 18.2843 18.782 17.908C18.8617 17.7516 18.9266 17.5274 18.9624 17.089C18.9992 16.6389 19 16.0566 19 15.2V8.8C19 7.94342 18.9992 7.36113 18.9624 6.91104C18.9266 6.47262 18.8617 6.24842 18.782 6.09202C18.5903 5.7157 18.2843 5.40973 17.908 5.21799C17.7516 5.1383 17.5274 5.07337 17.089 5.03755C16.6389 5.00078 16.0566 5 15.2 5H8.8C7.94342 5 7.36113 5.00078 6.91104 5.03755ZM16.3255 7.93219C16.7772 8.25003 16.8856 8.87383 16.5678 9.32549L11.8178 16.0755C11.6431 16.3237 11.3652 16.4792 11.0623 16.4981C10.7593 16.517 10.4642 16.3973 10.2601 16.1727L7.76006 13.4227C7.38855 13.014 7.41867 12.3816 7.82733 12.0101C8.23599 11.6386 8.86843 11.6687 9.23994 12.0773L10.9004 13.9039L14.9322 8.17451C15.25 7.72285 15.8738 7.61436 16.3255 7.93219Z",fill:"currentColor"}));function U({label:s,onClick:t}){return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full px-4",children:e.jsx("div",{className:"border-token-border-medium w-full border-t"})}),e.jsxs("div",{className:"flew-row flex cursor-pointer items-center gap-4 px-4 py-2",onClick:t,children:[e.jsx("p",{className:"flex-1",children:s}),t&&e.jsx(ps,{className:"icon-md text-token-text-secondary shrink-0"})]})]})}function gt({accountId:s,connectionId:t,refetch:o}){const[a,n]=x.useState(!1),i=V(),[l,c]=x.useState(!1),{triggerLocation:m}=Le(),u=e.jsx(y,{color:"primary",disabled:i,icon:Ye,onClick:()=>n(!0),loading:l,children:e.jsx(r,{id:"S6paZh",defaultMessage:"Finish connecting"})}),f=async()=>{c(!0),await T.admin_activate_connection_instance(s,t),Q.logEventWithStatsig("Contextual Answers Admin Connection Activated","chatgpt_contextual_answers_admin_connection_activated",{triggerLocation:m,connectorType:"google_drive_oauth",connectionId:t,adminQuickstart:!0}),o(),c(!1)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full px-4",children:e.jsx("div",{className:"border-token-border-medium w-full border-t"})}),e.jsx("div",{className:"flex w-full flex-col gap-2 p-4",children:i?e.jsx(X,{children:u}):u}),a&&e.jsx(gs,{connectionId:t,location:"admin_connection_quickstart_row",isAdminFlow:!0,isAdminQuickstartFlow:!0,onClose:()=>n(!1),onSuccess:f,accountId:s})]})}function pt({accountId:s,connectionId:t,refetch:o}){const[a,n]=x.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(U,{onClick:()=>n(!0),label:e.jsx(r,{id:"wM9lvD",defaultMessage:"Configure credentials"})}),a&&e.jsx(qs,{onClose:()=>n(!1),onNext:()=>{o(),n(!1)},accountId:s,connectionId:t})]})}function ht({accountId:s,connectionId:t,isPostActivation:o}){const[a,n]=x.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(U,{onClick:()=>n(!0),label:e.jsx(r,{id:"lTeSGb",defaultMessage:"Sync policy"})}),a&&e.jsx(Ze,{isOpen:!0,onClose:()=>n(!1),accountId:s,connectionId:t,isPostActivation:o})]})}function _t({accountId:s,connectionId:t,isPostActivation:o}){const[a,n]=x.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(U,{onClick:()=>n(!0),label:e.jsx(r,{id:"AgDWHl",defaultMessage:"User drives"})}),a&&e.jsx(zs,{isOpen:!0,isPostActivation:o,onClose:()=>n(!1),accountId:s,connectionId:t})]})}function jt({accountId:s,connectionId:t}){const[o,a]=x.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(U,{onClick:()=>a(!0),label:e.jsx(r,{id:"gsRcYT",defaultMessage:"Shared drives"})}),o&&e.jsx(Vs,{isOpen:!0,onClose:()=>a(!1),accountId:s,connectionId:t})]})}function bt({accountId:s,connectionId:t,objectType:o}){const[a,n]=x.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(U,{onClick:()=>n(!0),label:e.jsx(r,{id:"tisZLQ",defaultMessage:"Block items"})}),a&&e.jsx(Ks,{isOpen:!0,onClose:()=>n(!1),accountId:s,connectionId:t,objectType:o})]})}function Ct({accountId:s,connection:t}){const[o,a]=x.useState(!1);return t.connection_config.knowledge_connector_type?e.jsxs(e.Fragment,{children:[e.jsx(U,{onClick:()=>a(!0),label:e.jsx(r,{id:"9iRaQo",defaultMessage:"User access"})}),o&&e.jsx(Be,{connectorType:t.connection_config.knowledge_connector_type,fallbackEstimatedMaxNumUsers:We(t.connection_config),onClose:()=>a(!1),accountId:s,connectionId:t.connection_config.connection_config_id})]}):null}function vt({accountId:s,connectionId:t,connectorType:o,connectionDisplayInfo:a,onActivate:n,activationBlockingError:i}){const[l,c]=x.useState(!1),m=V(),u=e.jsx(y,{color:i?"secondary":"primary",disabled:!!i||m,icon:Ye,onClick:()=>c(!0),children:e.jsx(r,{id:"tVDCWM",defaultMessage:"Review and finish setup"})});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full px-4",children:e.jsx("div",{className:"border-token-border-medium w-full border-t"})}),e.jsxs("div",{className:"flex w-full flex-col gap-2 p-4",children:[i&&e.jsx("p",{className:"text-token-text-secondary text-sm",children:i}),m?e.jsx(X,{children:u}):u]}),l&&e.jsx(Ge,{isOpen:!0,onClose:()=>c(!1),accountId:s,connectionId:t,connectionDisplayInfo:a,onActivate:n,connectorType:o})]})}const yt=({open:s,onOpenChange:t,deleteConnection:o,isDeleting:a,connectionDisplayInfo:n})=>{const i=b();return e.jsx(B,{testId:"modal-delete-connection",isOpen:s,onClose:()=>t(!1),shouldIgnoreClickOutside:!0,title:i.formatMessage({id:"oXdl2Z",defaultMessage:"Confirm deletion"}),type:"danger",icon:ve,primaryButton:e.jsx(y,{color:"danger",onClick:o,disabled:a,loading:a,children:e.jsx(r,{id:"knS5PY",defaultMessage:"Delete"})}),secondaryButton:e.jsx(y,{color:"secondary",disabled:a,onClick:()=>{t(!1)},children:e.jsx(r,{id:"KnPHlG",defaultMessage:"Cancel"})}),children:e.jsxs("ul",{className:"px-4",children:[e.jsx("li",{className:"mb-2 list-disc ps-2",children:e.jsx(r,{id:"BvnNwE",defaultMessage:"You are about to delete the connection {connection_name}.",values:{connection_name:e.jsx(Hs,{connectionDisplayInfo:n})}})}),e.jsx("li",{className:"mb-2 list-disc ps-2",children:e.jsx(r,{id:"0m+fk7",defaultMessage:"Deleting this connection will stop syncing and delete synced data."})}),e.jsx("li",{className:"mb-2 list-disc ps-2 font-bold",children:e.jsx(r,{id:"a86dO+",defaultMessage:"This action cannot be undone."})})]})})},wt=({open:s,onOpenChange:t,defaultName:o,accountId:a,connectionId:n,refetch:i})=>{const l=b(),[c,m]=x.useState(o),[u,f]=x.useState(!1),g=x.useId(),p=D(),h=x.useCallback(()=>{f(!0),T.admin_edit_name_connection_instance(a,n,{name:c}).then(()=>{p.success(l.formatMessage({id:"pepxEP",defaultMessage:"Connection updated successfully."})),i(),t(!1)}).catch(()=>{p.danger(l.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}))}).finally(()=>{f(!1)})},[a,n,l,c,t,i,p]);return e.jsx(B,{testId:"modal-rename",isOpen:s,onClose:()=>t(!1),shouldIgnoreClickOutside:!0,title:l.formatMessage({id:"mmCJWI",defaultMessage:"Rename"}),type:"success",icon:Pe,primaryButton:e.jsx(y,{onClick:()=>h(),loading:u,children:e.jsx(r,{id:"LebexD",defaultMessage:"Rename"})}),secondaryButton:e.jsx(y,{color:"secondary",onClick:()=>{t(!1)},children:e.jsx(r,{id:"KnPHlG",defaultMessage:"Cancel"})}),children:e.jsxs("form",{onSubmit:j=>{j.preventDefault(),h()},className:"flex flex-col gap-2",children:[e.jsx("label",{htmlFor:g,className:"text-token-text-secondary text-base font-medium",children:e.jsx(r,{id:"Gk2g3Q",defaultMessage:"Connection name"})}),e.jsx("input",{type:"text",value:c,onChange:j=>m(j.target.value),id:g,className:"border-token-border-default bg-token-main-surface-primary text-token-text-primary rounded-lg border border-solid"}),e.jsx("button",{type:"submit",className:"display-none"})]})})};function Xe({accountId:s,adminUserConnectionState:t,connectedKnowledgeSource:o,connection:a,connectorName:n,onCreateAnotherInstance:i,refetchConnectionInstances:l,showIcon:c=!1}){const[m,u]=x.useState(!1),f=b();let g;switch(a.connection_config.knowledge_connector_type){case void 0:break;case"github":case"notion":case"merge_file_storage":case"google_drive_oauth":case"google_drive_dwd":g="synced_object";break;case"slack":g="synced_channel";break}if(!a.connection_config.knowledge_connector_type)return null;let p;return a.connection_status!=="draft"||(a.connection_config.knowledge_connector_type==="google_drive_oauth"&&!a.connection_config.domain_name?p=e.jsx(gt,{accountId:s,connectionId:a.connection_config.connection_config_id,refetch:l}):p=e.jsx(vt,{connectorType:a.connection_config.knowledge_connector_type,connectionId:a.connection_config.connection_config_id,accountId:s,connectionDisplayInfo:a.display_info,onActivate:l,activationBlockingError:Nt(a,f)})),e.jsxs(ye.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.5},className:"group bg-token-main-surface-secondary w-full rounded-xl pb-2",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 p-4 pb-6",children:[c&&a.display_info.icon_url&&e.jsx("div",{className:"bg-token-bg-primary h-fit rounded-xl border-[0.5px] p-2 shadow-sm",children:e.jsx("div",{className:"h-[28px] w-[28px]",children:e.jsx("img",{src:a.display_info.icon_url??"",alt:"",className:"icon-xl self-center"})})}),e.jsxs("div",{className:"w-full shrink overflow-hidden",children:[e.jsx("div",{className:"text-token-text-primary overflow-hidden font-medium text-ellipsis whitespace-nowrap",children:e.jsx(Ae,{label:n??a.display_info.display_name,side:"top",align:"center",children:n??a.display_info.display_name})}),e.jsx("div",{children:e.jsx(kt,{connectionDisplayName:a.display_info.display_name,connectionStatus:a.connection_status})})]}),e.jsx(Mt,{accountId:s,className:W("hover:bg-token-main-surface-secondary-selected h-8 w-8",m?"bg-token-main-surface-secondary-selected":"bg-transparent"),connectedKnowledgeSource:o,connectionDisplayInfo:a.display_info,connectionId:a.connection_config.connection_config_id,isOpen:m,onCreateAnotherInstance:i,refetch:l,setIsOpen:u})]}),e.jsx(ut,{connection:a,adminUserConnectionState:t}),e.jsx(Ct,{connection:a,accountId:s}),a.connection_config.knowledge_connector_type==="google_drive_dwd"&&e.jsxs(e.Fragment,{children:[e.jsx(pt,{connectionId:a.connection_config.connection_config_id,accountId:s,refetch:l}),e.jsx(_t,{connectionId:a.connection_config.connection_config_id,accountId:s,isPostActivation:a.connection_status!=="draft"}),e.jsx(jt,{connectionId:a.connection_config.connection_config_id,accountId:s})]}),a.connection_config.knowledge_connector_type==="slack"&&e.jsx(ht,{connectionId:a.connection_config.connection_config_id,accountId:s,isPostActivation:a.connection_status!=="draft"}),g!=null&&e.jsx(bt,{connectionId:a.connection_config.connection_config_id,accountId:s,objectType:g}),p]})}const kt=({connectionDisplayName:s,connectionStatus:t})=>{switch(t){case"active":case"partially_activated":case"activating":return e.jsxs("div",{className:"flex items-center",children:[e.jsx(Se,{className:"icon-sm text-token-text-secondary"}),e.jsx("span",{className:"text-token-text-secondary ms-0.5 text-sm",children:e.jsx(r,{id:"3aMZRu",defaultMessage:"Configured • {connectionDisplayName}",values:{connectionDisplayName:s}})})]});case"draft":return e.jsxs("div",{className:"flex items-center",children:[e.jsx(ie,{className:"icon-sm text-token-text-secondary"}),e.jsx("span",{className:"text-token-text-secondary ms-0.5 text-sm",children:e.jsx(r,{id:"rEztVG",defaultMessage:"Draft • {connectionDisplayName}",values:{connectionDisplayName:s}})})]});case"deleting":case"deleted":return null}};function Mt({accountId:s,className:t,connectionDisplayInfo:o,connectionId:a,connectedKnowledgeSource:n,isOpen:i,onCreateAnotherInstance:l,refetch:c,setIsOpen:m}){const u=V(),f=D(),g=b(),[p,h]=x.useState(!1),[j,v]=x.useState(!1),[d,C]=x.useState(!1),S=async()=>{if(!d){C(!0);try{await T.admin_delete_connection_instance(s,a),f.success(g.formatMessage({id:"zM0Z9u",defaultMessage:"Connection deleted."}))}catch{f.danger(g.formatMessage({id:"3lBGk2",defaultMessage:"Failed to delete this connection. Please try again later."}))}finally{c(),C(!1),v(!1)}}},A=e.jsx(w.Item,{icon:Te,onSelect:()=>l?.(),disabled:!l,children:e.jsx(r,{id:"NLydA/",defaultMessage:"Connect another {connectedKnowledgeSource}",values:{connectedKnowledgeSource:n}})});return e.jsxs(e.Fragment,{children:[e.jsxs(w.Root,{open:i,onOpenChange:m,children:[e.jsx(w.Trigger,{className:t,children:e.jsx(ie,{className:"icon-lg"})}),e.jsx(w.Portal,{children:e.jsxs(w.Content,{size:"medium",children:[e.jsx(w.Item,{icon:Pe,onSelect:()=>h(!0),disabled:d||j,children:e.jsx(r,{id:"XSQcFy",defaultMessage:"Rename connection"})}),l?A:u?e.jsx(X,{children:A}):null,e.jsx(w.Item,{icon:d||j?I:Y,onSelect:()=>v(!0),color:"danger",disabled:d||j,children:e.jsx(r,{id:"EAIYOb",defaultMessage:"Delete connection"})}),!1]})})]}),e.jsx(wt,{open:p,onOpenChange:h,defaultName:o.display_name,connectionId:a,accountId:s,refetch:c}),e.jsx(yt,{open:j,onOpenChange:v,deleteConnection:S,isDeleting:d,connectionDisplayInfo:o})]})}function Nt(s,t){if(s.connection_config.knowledge_connector_type==="google_drive_dwd"){if(!s.connection_config.admin_email_address||!s.connection_config.service_account_credential_id)return t.formatMessage({id:"BfNdzb",defaultMessage:"Credential configuration is incomplete"})}else if(s.connection_config.knowledge_connector_type==="google_drive_oauth"&&!s.connection_config.domain_name)return t.formatMessage({id:"PxrodU",defaultMessage:"Google Workspace domain must be set"})}function St({onClose:s}){const[t,o]=x.useState(),a=H();return a?t?e.jsx(Dt,{accountId:a.id,connection:t,onClose:s}):e.jsx(Tt,{accountId:a.id,onClose:s,setConnection:o}):null}function Tt({onClose:s,setConnection:t,accountId:o}){const a=b(),n=D(),{triggerLocation:i}=Le(),[l,c]=x.useState({teamDomain:"app"});x.useEffect(()=>{Q.logEventWithStatsig("Contextual Answers Admin Create Connection Step","chatgpt_contextual_answers_admin_create_connection_step",{connectorType:"slack",stepName:"basic_info",triggerLocation:i})},[i]);const[m,u]=x.useState(!1),f=x.useCallback(()=>{!(l.teamDomain&&l.teamId)||!o||(u(!0),T.admin_create_connection_instance(o,{connection_config_id:"--fake-local-id",knowledge_connector_type:"slack",team_id:l.teamId,team_domain:l.teamDomain},l.connectionName).then(d=>{t(d)}).catch(()=>{n.danger(a.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}))}).finally(()=>{u(!1)}))},[o,l.connectionName,l.teamDomain,l.teamId,a,t,n]),g=!!l.connectionName?.length&&l.connectionName.length>128,p=!!(l.teamDomain&&l.teamId&&!g),h=x.useId(),j=x.useId(),v=x.useId();return e.jsxs(B,{...Ue,onClose:s,testId:"modal-slack-basic-info",children:[e.jsxs("form",{onSubmit:d=>{d.preventDefault(),p&&f()},className:"flex flex-col gap-4 px-6 pt-4 pb-6",children:[e.jsxs("div",{className:"mb-2 flex flex-col gap-2",children:[e.jsx("label",{htmlFor:h,className:"text-token-text-secondary text-base font-medium",children:e.jsx(r,{id:"e2yF8/",defaultMessage:"Connection display name"})}),e.jsx("input",{type:"text",value:l.connectionName??"",onChange:d=>c(C=>({...C,connectionName:d.target.value})),placeholder:a.formatMessage({id:"0gZ+BA",defaultMessage:"(optional)"}),id:h,className:"border-token-border-default bg-token-main-surface-primary text-token-text-primary rounded-lg border border-solid"}),g?e.jsx("p",{className:"text-red-500",children:e.jsx(r,{id:"vT7EGU",defaultMessage:"Name is too long."})}):null]}),e.jsxs("div",{className:"mb-2 flex flex-col gap-2",children:[e.jsx("label",{htmlFor:j,className:"text-token-text-secondary text-base font-medium",children:e.jsx(r,{id:"hEnKIS",defaultMessage:"Slack workspace domain"})}),e.jsxs("p",{children:[e.jsx("input",{type:"text",value:l.teamDomain??"",onChange:d=>c(C=>({...C,teamDomain:d.target.value})),id:j,className:"border-token-border-default bg-token-main-surface-primary text-token-text-primary rounded-lg border border-solid"}),e.jsx("span",{className:"text-token-text-secondary ms-1 font-medium",children:".slack.com"})]})]}),e.jsxs("div",{className:"mb-2 flex flex-col gap-2",children:[e.jsx("label",{htmlFor:v,className:"text-token-text-secondary text-base font-medium",children:e.jsx(r,{id:"azUOrk",defaultMessage:"Slack workspace ID"})}),e.jsx("input",{type:"text",value:l.teamId??"",onChange:d=>c(C=>({...C,teamId:d.target.value})),placeholder:a.formatMessage({id:"vUK9Kc",defaultMessage:"T0000000000"}),id:v,className:"border-token-border-default bg-token-main-surface-primary text-token-text-primary rounded-lg border border-solid"})]}),e.jsx("button",{type:"submit",className:"display-none"})]}),e.jsx(Ee,{primaryButton:e.jsx(y,{color:"primary",disabled:!p,onClick:f,loading:m,children:e.jsx(r,{id:"lZthRm",defaultMessage:"Save Draft and Continue"})})})]})}function Dt({connection:s,accountId:t,onClose:o}){return e.jsx(Qs,{onClose:o,steps:[{connectorType:"slack",name:"allowed_users",fn:({goForward:a,close:n,stepNumber:i,totalSteps:l})=>e.jsx(Be,{fallbackEstimatedMaxNumUsers:We(s.connection_config),onClose:()=>n?.(),accountId:t,connectionId:s.connection_config.connection_config_id,connectorType:"slack",primaryButton:a&&e.jsx(y,{color:"primary",onClick:a,children:e.jsx(r,{id:"z5fExR",defaultMessage:"Next"})}),footerContent:e.jsx("span",{className:"text-token-text-secondary flex-1 align-middle font-medium",children:e.jsx(r,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:i+1,totalSteps:l}})})})},{connectorType:"slack",name:"slack_channel_scope",fn:({goForward:a,goBackward:n,close:i,stepNumber:l,totalSteps:c})=>e.jsx(Ze,{isOpen:!0,isPostActivation:!1,onClose:()=>i?.(),accountId:t,connectionId:s.connection_config.connection_config_id,primaryButton:a&&e.jsx(y,{color:"primary",onClick:a,children:e.jsx(r,{id:"z5fExR",defaultMessage:"Next"})}),secondaryButton:n&&e.jsx(y,{color:"secondary",onClick:n,children:e.jsx(r,{id:"xJnONr",defaultMessage:"Back"})}),footerContent:e.jsx("span",{className:"text-token-text-secondary flex-1 align-middle font-medium",children:e.jsx(r,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:l+1,totalSteps:c}})})})},{connectorType:"slack",name:"review_and_activate",fn:({goBackward:a,close:n,stepNumber:i,totalSteps:l})=>e.jsx(Ge,{isOpen:!0,onClose:()=>n?.(),accountId:t,connectorType:"slack",connectionId:s.connection_config.connection_config_id,connectionDisplayInfo:s.display_info,secondaryButton:a&&e.jsx(y,{color:"secondary",onClick:a,children:e.jsx(r,{id:"xJnONr",defaultMessage:"Back"})}),footerContent:e.jsx("span",{className:"text-token-text-secondary flex-1 align-middle font-medium",children:e.jsx(r,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:i+1,totalSteps:l}})})})}]})}const At=ts.div`w-full border-b-1 border-token-border-light`;async function Ft(s){const[t,o]=await Promise.all([T.admin_list_knowledge_connectors(s),T.admin_list_connection_instances(s)]),a=new Map;return t.knowledge_conectors.forEach(n=>a.set(n.connector_details.knowledge_connector_type,{displayInfo:n.display_info,availability:n.connector_details.availability,connections:[],limits:n.connector_details.limits??{max_instances:3}})),o.connection_instances.forEach(n=>{if(!n.connection_config.knowledge_connector_type)return;const i=a.get(n.connection_config.knowledge_connector_type)?.connections;i!=null?i.push(n):a.set(n.connection_config.knowledge_connector_type,{displayInfo:n.display_info,availability:"unavailable",limits:ae,connections:[n]})}),a}function se(s){return!(s.connection_status==="deleted"||s.connection_status==="deleting")}function Ot(){const s=b(),t=H(),[o,a]=x.useState(!1),[n,i]=x.useState(!1);x.useEffect(()=>{Q.logEventWithStatsig("Contextual Answers Admin Page Visited","chatgpt_contextual_answers_admin_page_visited")},[]);const{data:l,isLoading:c,error:m,refetch:u}=z({queryKey:["admin:knowledge_connectors_with_connections",t?.id],queryFn:async()=>{if(!t)throw new Error("No current account");return await Ft(t.id)},enabled:!!t}),{refetch:f,connectionInstanceData:g}=Oe(),p=()=>{u(),f()},h=l?.get("google_drive_oauth")?.availability==="available"||l?.get("google_drive_dwd")?.availability==="available",{combinedGoogleDriveConnections:j,slackConnections:v,otherConnections:d}=x.useMemo(()=>{const A=[],M=[],L=[];return l?.forEach((K,ee)=>{if(K.availability!=="available"){L.push(...K.connections.filter(se));return}ee==="google_drive_dwd"||ee==="google_drive_oauth"?A.push(...K.connections.filter(se)):ee==="slack"&&M.push(...K.connections.filter(se))}),{combinedGoogleDriveConnections:A,slackConnections:M,otherConnections:L}},[l]),C=l?.get("slack")?.availability==="available",S=V();return t?.id?e.jsxs(J,{className:"gap-4",children:[e.jsx(Je,{showDescription:j.length>0}),m&&e.jsxs("div",{className:"my-2 flex flex-row items-center gap-2 rounded-lg bg-red-500 p-2 text-white",children:[e.jsx(te,{className:"icon-md inline"}),e.jsx(r,{id:"zNCx93",defaultMessage:"Failed to get connection instances. Please refresh to try again."})]}),S&&e.jsxs("div",{className:"my-2 flex flex-row items-center gap-2 rounded-lg bg-red-500 p-2 text-white",children:[e.jsx(te,{className:"icon-md inline"}),e.jsx(r,{id:"hnTY+Z",defaultMessage:"Our systems are experiencing high load. Some operations may be temporarily unavailable."})]}),c&&e.jsx(I,{}),e.jsxs("div",{children:[h&&e.jsxs("div",{className:"bg-token-interactive-bg-accent-inactive rounded-xl",children:[c||j.length>0?null:e.jsx("div",{className:"px-4 py-3 text-[13px] text-[#007AFF]",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ie,{className:"icon-md"}),e.jsx(r,{id:"woNVMz",defaultMessage:"Syncing is required to use Google Drive in chat. {learnMore}",values:{learnMore:e.jsx(le,{href:R,className:"underline",onClick:()=>re({link:R,location:"admin_settings_header"}),children:e.jsx(r,{id:"WGpoE2",defaultMessage:"Learn more"})},"learnMore")}})]})}),e.jsx(je,{adminUserConnectionStatus:g?.connection_statuses,accountId:t.id,badge:e.jsx(ze,{worksWith:"chat"}),className:C?"rounded-b-none":"",connectionInstancesLoading:c,connectionInstances:j,connectorName:s.formatMessage({id:"oDI3Mt",defaultMessage:"Google Drive"}),connectorType:"google_drive",description:s.formatMessage({id:"xlgXB9",defaultMessage:"Sync Docs, Sheets, Slides and other files"}),Icon:ke,limits:l?.get("google_drive_oauth")?.limits??l?.get("google_drive_dwd")?.limits??ae,onClickConnect:()=>a(!0),refetchConnectionInstances:p,singularNounConnectedObjectName:he("google_drive_oauth",s).externalLinkableUnitSingular})]}),C&&e.jsx(je,{accountId:t.id,className:h&&j.length===0?"rounded-t-none border-t-0":"mt-4",connectorType:"slack",connectorName:s.formatMessage({id:"pUDRLC",defaultMessage:"Slack"}),limits:l?.get("slack")?.limits??ae,description:s.formatMessage({id:"p1qvhM",defaultMessage:"Connect messages and channels."}),Icon:hs,onClickConnect:()=>i(!0),connectionInstancesLoading:c,connectionInstances:v,adminUserConnectionStatus:g?.connection_statuses,refetchConnectionInstances:p,singularNounConnectedObjectName:he("slack",s).externalLinkableUnitSingular})]}),d.length>0&&e.jsx(Et,{accountId:t.id,connectionInstancesLoading:c,connectionInstances:d,refetchConnectionInstances:p}),o&&e.jsx(Zs,{isDwdEnabled:l?.get("google_drive_dwd")?.availability==="available",onClose:()=>{a(!1),p()},triggerLocation:"admin_settings"}),n&&e.jsx(St,{onClose:()=>{i(!1),p()}})]}):null}function je({accountId:s,adminUserConnectionStatus:t,badge:o,className:a,connectionInstances:n,connectionInstancesLoading:i,connectorName:l,connectorType:c,description:m,Icon:u,limits:f,onClickConnect:g,refetchConnectionInstances:p,singularNounConnectedObjectName:h}){const j=V(),v=n!=null&&!j&&(f.max_instances===Ys||n.length<f.max_instances),d=()=>{Q.logEventWithStatsig("Contextual Answers Admin Create Connection Button Clicked","chatgpt_contextual_answers_admin_create_connection_button_clicked",{connectorType:c}),g?.()},C=e.jsx(y,{className:"text-nowrap",color:"secondary",onClick:d,disabled:!v,children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ie,{className:"icon-md text-[#007AFF]"}),e.jsx(r,{id:"FSQUDq",defaultMessage:"Enable Sync"})]})});return e.jsxs("div",{className:W("bg-token-bg-primary flex w-full flex-col gap-4",n?.length===0?"border-token-border-light rounded-xl border-[1px] p-5":"mt-2",a),children:[n?.length===0&&e.jsxs("div",{className:"flex w-full flex-row flex-wrap items-center gap-4",children:[e.jsx("div",{className:"h-fit rounded-xl border-[0.5px] p-2 shadow-sm",children:e.jsx(u,{className:"icon-lg shrink-0"})}),e.jsxs("div",{className:"flex min-w-[240px] flex-1 flex-col gap-0.5",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("p",{className:"text-primary",children:l}),o]}),e.jsx("p",{className:"text-token-text-secondary text-sm",children:m})]}),e.jsx("div",{className:"flex shrink-0 items-center",children:v?C:j?e.jsx(X,{children:C}):null})]}),i?e.jsx(ue,{lines:2}):n?.length?e.jsx(we,{children:e.jsxs("div",{className:"grid w-full gap-4",style:{gridTemplateColumns:"repeat(auto-fit, minmax(360px, 1fr))"},children:[n.filter(S=>!["deleted","deleting"].includes(S.connection_status)).map(S=>e.jsx(Xe,{accountId:s,adminUserConnectionState:t?.find(A=>A.user_connection_details.connection_instance_id===S.connection_config.connection_config_id),connectedKnowledgeSource:h,connection:S,connectorName:l,onCreateAnotherInstance:v?d:void 0,refetchConnectionInstances:p,showIcon:!0},S.connection_config.connection_config_id)),n.length===1&&e.jsx("div",{},"grid-spacer")]})}):null]})}function Et({accountId:s,connectionInstances:t,connectionInstancesLoading:o,refetchConnectionInstances:a}){return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex w-full flex-col gap-4",children:o?e.jsx(ue,{lines:2}):t?.length?e.jsx(we,{children:e.jsxs("div",{className:"grid w-full gap-4",style:{gridTemplateColumns:"repeat(auto-fit, minmax(360px, 1fr))"},children:[t.map(n=>e.jsx(Xe,{connection:n,showIcon:!0,accountId:s,refetchConnectionInstances:a},n.connection_config.connection_config_id)),t.length===1&&e.jsx("div",{},"grid-spacer")]})}):null}),e.jsx(At,{})]})}function Je({badge:s,showDescription:t=!0}){const o=b();return e.jsxs("div",{children:[e.jsxs(ce,{className:"flex flex-row items-center gap-2",children:[e.jsx("span",{children:o.formatMessage({id:"PzngEC",defaultMessage:"Synced connectors"})}),s]}),t&&e.jsx(de,{className:"text-token-text-secondary",children:e.jsx(r,{id:"XWG8hZ",defaultMessage:"ChatGPT syncs your organization’s content for higher quality, up-to-date answers. {learnMore}",values:{learnMore:e.jsx(le,{href:R,className:"underline",onClick:()=>re({link:R,location:"admin_settings_header"}),children:e.jsx(r,{id:"WGpoE2",defaultMessage:"Learn more"})},"learnMore")}})})]})}function Pt({feedbackMetadata:s,currentWorkspaceId:t,onClose:o,onFeedbackActionTaken:a}){const n=b(),{data:i,refetch:l,isLoading:c}=z({queryKey:["adminGetCaMessageFeedback",t,s.feedback_id],queryFn:()=>O.safeGet("/ca/admin/feedback/{feedback_id}",{parameters:{path:{feedback_id:s.feedback_id},query:{account_id:t}}})}),m=D(),u=q({mutationFn:g=>g.operation==="delete"?O.safeDelete("/ca/admin/feedback/{feedback_id}",{parameters:{path:{feedback_id:g.feedbackId},query:{account_id:g.workspaceId}}}):O.safePost("/ca/admin/feedback/{feedback_id}/approve",{parameters:{path:{feedback_id:g.feedbackId},query:{account_id:g.workspaceId,with_sources:g.withSources}}}),onSuccess:(g,p)=>{a(),o(),m.success(p.operation==="approve"?n.formatMessage(k.feedbackApproved):n.formatMessage(k.feedbackDeleted))},onError:(g,p)=>{l(),m.warning(p.operation==="approve"?n.formatMessage(k.errorApprovingFeedback):n.formatMessage(k.errorDeletingFeedback))}}),f=x.useMemo(()=>{const g=s.review_status==="unreviewed",p=s.review_status==="unreviewed";let h;switch(s.review_status){case"approved_with_sources":case"approved_without_sources_data_expired":{h=n.formatMessage(k.actionMessageNoActionsAvailable);break}case"approved_without_sources_data_available":{h=n.formatMessage(k.actionMessageApprovedWithoutSources);break}case"deleted":{h=n.formatMessage(k.actionMessageFeedbackDeleted);break}}const j={workspaceId:t,feedbackId:s.feedback_id,withSources:!0};return e.jsxs("div",{className:"bg-token-main-surface-secondary sticky bottom-0 flex w-full flex-col gap-2 rounded-lg p-4",children:[!!h&&e.jsx("div",{children:e.jsx("p",{children:h})}),e.jsxs("div",{className:"flex flex-row gap-2",children:[g&&e.jsx(y,{color:"primary",icon:_s,onClick:()=>u.mutate({...j,operation:"approve"}),loading:u.isPending,children:e.jsx(r,{id:"Zq8YOH",defaultMessage:"Approve Feedback"})}),p&&e.jsx(y,{color:"danger-outline",icon:Y,onClick:()=>u.mutate({...j,operation:"delete"}),loading:u.isPending,children:e.jsx(r,{id:"qeIjD9",defaultMessage:"Delete Feedback"})})]})]})},[s.review_status,s.feedback_id,u,t,n]);return e.jsx(Rt,{actionBar:f,onClose:o,isLoading:c,feedbackData:i,feedbackMetadata:s})}function Rt({actionBar:s=null,onClose:t=()=>{},isLoading:o=!1,isDebugView:a=!1,feedbackData:n,feedbackMetadata:i}){const l=b();return e.jsx(B,{testId:"modal-admin-feedback",size:"custom",className:"max-w-lg overflow-y-auto text-base",isOpen:!0,icon:js,onClose:t,showCloseButton:!0,type:"success",title:l.formatMessage(k.modalTitle),children:e.jsx("div",{className:"flex flex-col",children:n&&!o?e.jsxs(e.Fragment,{children:[e.jsx(It,{feedbackData:n,feedbackMetadata:i,isDebugView:a}),e.jsx(ge,{className:"my-4"}),e.jsx(Lt,{fileRefs:n.file_references}),e.jsx(ge,{className:"my-4"}),e.jsx(Gt,{retrievalMessages:n.retrieval_messages,userDisplayName:i.submitter_display_name??i.submitter_email,isDebugView:a}),s]}):e.jsx(Xs,{lines:8})})})}function It({feedbackMetadata:s,feedbackData:t,isDebugView:o=!1}){const a=b(),n=s.submitter_display_name&&s.submitter_email?a.formatMessage(k.userDisplayName,{displayName:s.submitter_display_name,email:s.submitter_email}):s.submitter_id,i=x.useMemo(()=>t.sources_feedback?Object.entries(t.sources_feedback).map(([l,c])=>{if(!c.rating&&!(c.tags&&c.tags.length>0))return null;const m=t.file_references.find(f=>f.document_id===l)?.title,u=c.tags&&c.tags.length===1&&c.tags[0]===$s;return e.jsxs("li",{className:"flex flex-col p-1 text-sm break-words",children:[e.jsxs("div",{className:"mb-1 flex flex-row items-center gap-2",children:[c.rating==="thumbsUp"?e.jsx(bs,{className:"icon-sm"}):c.rating==="thumbsDown"?e.jsx(xe,{className:"icon-sm"}):null,e.jsx("a",{href:c.url??void 0,className:"text-sm font-semibold",children:m??c.url??l})]}),e.jsx("div",{className:"flex flex-row flex-wrap gap-1",children:u?e.jsx("span",{className:"italic",children:e.jsx(r,{id:"yNGc6H",defaultMessage:"This source should have been used."})}):c.tags?.map(f=>e.jsx("div",{className:"border-token-border-default text-token-text-secondary rounded-lg border px-3 py-1 text-xs",children:pe(f,a)},f))})]},l)}).filter(l=>!!l):[],[t.file_references,t.sources_feedback,a]);return e.jsxs("div",{children:[!o&&e.jsx("div",{className:"mb-2",children:e.jsx($e,{reviewStatus:s.review_status})}),e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[t.rating==="thumbsUp"?e.jsx(Cs,{className:"icon-xl m-2"}):e.jsx(xe,{className:"icon-xl m-2"}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("p",{children:n}),s.submitted_at&&e.jsx("p",{className:"text-token-text-secondary text-xs",children:new Date(s.submitted_at).toLocaleString()})]})]}),t.tags&&t.tags.length>0&&e.jsx("div",{className:"mb-2 flex flex-wrap gap-1",children:t.tags?.map(l=>e.jsx("div",{className:"border-token-border-default text-token-text-secondary rounded-lg border px-3 py-1 text-sm",children:pe(l,a)},l))}),e.jsxs("div",{className:"mb-2",children:[e.jsx(E,{className:"mb-1",children:e.jsx(r,{id:"VrPx6x",defaultMessage:"Feedback"})}),e.jsx("p",{className:"rounded-sm border p-2 text-sm break-words",children:t.text?t.text:e.jsx("span",{className:"italic",children:e.jsx(r,{id:"pEEJ/8",defaultMessage:"No written feedback was provided."})})})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx(E,{className:"mb-1",children:e.jsx(r,{id:"LUg6Vl",defaultMessage:"Additional Sources"})}),e.jsx("p",{className:"rounded-sm border p-2 text-sm break-words",children:t.additional_sources?t.additional_sources:e.jsx("span",{className:"italic",children:e.jsx(r,{id:"u24Zo5",defaultMessage:"No additional sources were provided."})})})]}),i.length>0&&e.jsxs("div",{className:"mb-2",children:[e.jsx(E,{className:"mb-1",children:e.jsx(r,{id:"lNSdNZ",defaultMessage:"Sources Feedback"})}),e.jsx("ul",{className:"flex flex-col gap-1",children:i})]})]})}const Ut=["citation","context_stuff","search_result"];function be(s){return Array.from(s.map(t=>vs({id:t.document_id,cloud_doc_url:t.external_url??void 0,name:t.title??"",extra:{cloud_doc_url:t.external_url??void 0}})).filter(t=>!!t))}function Lt({fileRefs:s}){const[t,o]=x.useMemo(()=>{const a=new Map,n=new Map;return s.forEach(i=>{Ut.includes(i.reference_source)&&i.external_url&&!a.has(i.document_id)?a.set(i.document_id,i):i.reference_source==="user_feedback"&&i.external_url&&!n.has(i.document_id)&&n.set(i.document_id,i)}),[be(Array.from(a.values())),be(Array.from(n.values()))]},[s]);return e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx(E,{className:"mb-2",children:e.jsx(r,{id:"FB4YIA",defaultMessage:"Sources In Conversation"})}),t.length>0?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-token-text-secondary mb-2 text-xs",children:e.jsx(r,{id:"iTNNoN",defaultMessage:"These sources were considered or cited in the conversation. Snapshots of these sources will be included with the feedback if you choose to approve the feedback."})}),e.jsx("div",{className:"flex flex-col gap-1",children:t.map(a=>e.jsx(fe,{compact:!0,citationMetadata:a},a.url))})]}):e.jsx("p",{className:"text-token-text-secondary text-xs",children:e.jsx(r,{id:"Q+DKpB",defaultMessage:"No synced sources were considered or cited in the conversation, however there may be other sources present such as user uploaded files. If you choose to approve this feedback, only the snippets of those files that ChatGPT looked at will be shared with this feedback."})})]}),o.length>0&&e.jsxs("div",{className:"mt-8",children:[e.jsx(E,{className:"mb-2",children:e.jsx(r,{id:"SCwQnr",defaultMessage:"Sources From Feedback"})}),e.jsx("p",{className:"text-token-text-secondary mb-2 text-xs",children:e.jsx(r,{id:"Rr+4KZ",defaultMessage:"The feedback submitter mentioned these documents in their feedback. Snapshots of these documents will be included with the feedback if you choose to approve the feedback with sources and the user had access to them."})}),e.jsx("div",{className:"flex flex-col gap-1",children:o.map(a=>e.jsx(fe,{compact:!0,citationMetadata:a},a.url))})]})]})}function Gt({retrievalMessages:s,userDisplayName:t,isDebugView:o=!1}){return e.jsxs("div",{className:"mb-8",children:[e.jsx(E,{className:"mb-4",children:e.jsx(r,{id:"pOb00r",defaultMessage:"Conversation"})}),s.map(a=>e.jsx(Bt,{message:a,userDisplayName:t,isDebugView:o},a.id))]})}function Bt({message:s,userDisplayName:t,isDebugView:o=!1}){const a=b();switch(s.type){case"visible_text":{if(s.author==="unknown")return null;const n={id:s.id,author:{role:s.author},clientMetadata:{canRetry:!1},metadata:{citations:s.citations??[],attachments:s.attachments??[],content_references:s.content_refs?s.content_refs:(s.citations??[]).map(i=>i.metadata?.type!=="file"?null:{start_idx:i.start_ix,end_idx:i.end_ix,refs:[],matched_text:s.text.slice(i.start_ix,i.end_ix),type:"file",source:i.metadata.source,name:i.metadata.name,id:i.metadata.id,cloud_doc_url:i.metadata.cloud_doc_url??i.metadata.extra?.cloud_doc_url}).filter(i=>!!i)},content:{content_type:as.Text,parts:[s.text]}};return e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:W("text-token-text-secondary mb-1 text-xs",s.author==="user"?"pe-4 text-end":"text-start"),children:s.author==="assistant"?a.formatMessage(k.authorChatGPT):s.author==="user"?t??a.formatMessage(k.authorUser):s.author}),e.jsx(ws,{id:s.id,messages:[n],attachments:n.metadata?.attachments,citations:n.metadata?.citations,contentReferences:n.metadata?.content_references,parts:[s.text],displayParts:ks({isUserTurn:s.author==="user",parts:[s.text]}),isActivelyStreaming:!1,isCompletionInProgress:!1,isFinalUserTurn:!1,hasActiveRequest:!1,clientThreadId:"--fake-thread-id--",isUserTurn:s.author==="user",turnIndex:0,isFeedbackEnabled:!1})]})}case"query":return e.jsxs("div",{className:"text-token-text-primary my-2 text-xs",children:[e.jsx(et,{className:"me-2"}),o?e.jsx(r,{id:"AVzRit",defaultMessage:"ChatGPT performed a search: {query}",values:{query:s.query}}):e.jsx(r,{id:"bJ9BXd",defaultMessage:"ChatGPT performed a search."})]});case"result":return o?e.jsx(Wt,{message:s}):null;case"fetch":return o?e.jsxs("div",{className:"text-token-text-primary my-2 text-xs",children:[e.jsx(ys,{className:"me-2"}),e.jsx(r,{id:"uH5X47",defaultMessage:"Read file: {fileName}",values:{fileName:s.content.content_type==="tether_quote"?s.content.title:"unknown"}})]}):null;case"generic_file_search_tool":return o?e.jsxs("div",{className:"text-token-text-primary my-2 text-xs",children:[e.jsx(st,{className:"me-2"}),e.jsx(r,{id:"pJmg4S",defaultMessage:"Tool message with command: {command}.",values:{command:s.command}})]}):null;case"system":case void 0:return null}}function Wt({message:s}){const[t,o]=x.useState(!1);return s.type!=="result"?null:e.jsxs("div",{className:"text-token-text-primary mt-2 mb-4 text-xs",children:[e.jsxs("div",{onClick:()=>o(a=>!a),className:"flex flex-row",children:[e.jsx(Js,{checked:t,className:"flex-0"}),e.jsx("div",{className:"flex-1",children:e.jsx(r,{id:"94EEkt",defaultMessage:"Found {numResults} results.",values:{numResults:s.result.chunks.length}})})]}),t&&e.jsxs("div",{className:"mt-2",children:[s.result.chunks.map(a=>e.jsxs("div",{className:"mb-2",children:[e.jsx("h4",{className:"text-token-text-primary mb-1 text-sm font-bold",children:e.jsx(r,{id:"zyGUoc",defaultMessage:"Result {number}: {title}",values:{number:a.result_num,title:a.title}})}),e.jsx("h4",{className:"text-token-text-secondary mb-1 text-xs",children:a.document_id}),e.jsx("pre",{className:"max-h-[200px] max-w-full overflow-auto p-2 text-wrap",children:a.contents})]},a.result_num)),e.jsxs("div",{className:"p-2 text-center",onClick:()=>o(!1),children:[e.jsx("p",{className:"text-token-text-secondary mb-1 font-bold",children:e.jsx(r,{id:"8UUzYt",defaultMessage:"Collapse Results"})}),e.jsx("hr",{className:""})]})]})]})}function $e({reviewStatus:s,onClick:t,disabled:o}){let a;const n=b();switch(s){case"unreviewed":a=n.formatMessage(k.reviewStatusUnreviewed);break;case"approved_with_sources":a=n.formatMessage(k.reviewStatusApprovedWithSouces);break;case"approved_without_sources_data_available":case"approved_without_sources_data_expired":a=n.formatMessage(k.reviewStatusApprovedWithoutSources);break;case"deleted":a=n.formatMessage(k.reviewStatusDeleted);break}return e.jsx("button",{className:W("text-token-text-primary rounded-2xl px-3 py-1 text-sm",s==="unreviewed"&&"bg-[#e2c541] dark:bg-[#EA8444]"),onClick:t,disabled:!!o||!t,children:a})}const k=oe({modalTitle:{id:"zufVun",defaultMessage:"Review Feedback"},feedbackApproved:{id:"DS+YGt",defaultMessage:"Feedback approved."},feedbackDeleted:{id:"Rz/tmW",defaultMessage:"Feedback deleted."},errorApprovingFeedback:{id:"UVsTlf",defaultMessage:"Encountered an error approving this feedback. Please refresh and try again."},errorDeletingFeedback:{id:"cI6gt9",defaultMessage:"Encountered an error deleting this feedback. Please refresh and try again."},actionMessageFeedbackCreating:{id:"urBely",defaultMessage:"You can't take actions on this feedback yet because it's still being processed. Once it's done processing, it will be available for review."},actionMessageNoActionsAvailable:{id:"JGNhjT",defaultMessage:"This feedback has been reviewed."},actionMessageApprovedWithoutSources:{id:"68PAfK",defaultMessage:"This feedback has already been approved without sources, but you can re-approve it with sources."},actionMessageFeedbackDeleted:{id:"Kel9lE",defaultMessage:"This feedback has been deleted."},labelIncludeSources:{id:"8UlZM0",defaultMessage:"Include Sources"},authorChatGPT:{id:"7Fo5p2",defaultMessage:"ChatGPT"},authorUser:{id:"TpT0hg",defaultMessage:"User"},userDisplayName:{id:"3OKTcX",defaultMessage:"{displayName} ({email})"},reviewStatusUnreviewed:{id:"FEHKZj",defaultMessage:"Needs Review"},reviewStatusCreating:{id:"7lVVU7",defaultMessage:"Preparing for Review"},reviewStatusApprovedWithSouces:{id:"kpZ41g",defaultMessage:"Approved With Sources"},reviewStatusApprovedWithoutSources:{id:"Y0lc+p",defaultMessage:"Approved Without Sources"},reviewStatusDeleted:{id:"gKoYhr",defaultMessage:"Deleted"}});function qt({currentWorkspaceId:s}){const{data:t,refetch:o,isLoading:a}=z({queryKey:["adminListCaMessageFeedback",s],queryFn:()=>O.safeGet("/ca/admin/feedback",{parameters:{query:{account_id:s}}})}),[n,i]=x.useState();return e.jsxs(J,{className:"mb-8",children:[e.jsx(ce,{children:e.jsx(r,{id:"r4Y3mj",defaultMessage:"Review Feedback"})}),e.jsx(de,{className:"text-token-text-secondary",children:e.jsx(r,{id:"mqh7NS",defaultMessage:"Review feedback your workspace users have submitted. Feedback is not shared with OpenAI until you approve it."})}),t&&!a?e.jsx(zt,{feedbackList:t.feedback,setSelectedFeedback:i}):e.jsx(I,{}),n&&e.jsx(Pt,{feedbackMetadata:n,currentWorkspaceId:s,onClose:()=>i(void 0),onFeedbackActionTaken:()=>o()})]})}function Ce(s){switch(s){case"unreviewed":return 1;case"approved_with_sources":return 2;case"approved_without_sources_data_available":return 3;case"approved_without_sources_data_expired":return 4;case"deleted":return 5}}function zt({feedbackList:s,setSelectedFeedback:t}){const o=x.useMemo(()=>[...s].sort((a,n)=>{const i=Ce(a.review_status)-Ce(n.review_status);return i!==0?i:a.submitted_at>n.submitted_at?-1:a.submitted_at<n.submitted_at?1:0}),[s]);return e.jsxs(N.Root,{size:"normal",children:[e.jsxs(N.Header,{children:[e.jsx(N.HeaderCell,{className:"bg-token-main-surface-primary",children:e.jsx(r,{id:"KcGNl2",defaultMessage:"Review Status"})}),e.jsx(N.HeaderCell,{className:"bg-token-main-surface-primary w-40",children:e.jsx(r,{id:"joba0B",defaultMessage:"Submitted By"})}),e.jsx(N.HeaderCell,{className:"bg-token-main-surface-primary w-40",children:e.jsx(r,{id:"yl1cCR",defaultMessage:"Submitted At"})})]}),e.jsx(N.Body,{children:o.length===0?e.jsx(N.Row,{children:e.jsx(N.Cell,{children:e.jsx(r,{id:"AYwCJD",defaultMessage:"No feedback yet."})})}):o.map(a=>{const n=a.review_status==="deleted",i=n?void 0:()=>t(a);return e.jsxs(N.Row,{className:W("my-2",n?"bg-token-main-surface-tertiary":"hover:bg-token-main-surface-secondary hover:cursor-pointer"),onClick:i,children:[e.jsx(N.Cell,{className:"truncate",children:e.jsx($e,{reviewStatus:a.review_status,onClick:i,disabled:n})}),e.jsx(N.Cell,{className:"truncate",children:e.jsx("span",{children:a.submitter_display_name&&a.submitter_email?e.jsx(r,{id:"3OKTcX",defaultMessage:"{displayName} ({email})",values:{displayName:a.submitter_display_name,email:a.submitter_email}}):e.jsx("code",{children:a.submitter_id.split("__")[0]})})}),e.jsx(N.Cell,{className:"truncate",children:e.jsx("span",{children:new Date(a.submitted_at).toLocaleString()})})]},a.feedback_id)})})]})}function Vt(){const s=b(),t=H(),o=Ms(),a=As(),n=ns(),i=os(n,"2509278897"),{isComingSoon:l}=Ns(),c=a||l;return e.jsxs(e.Fragment,{children:[e.jsx(Fs,{title:s.formatMessage({id:"q9azuh",defaultMessage:"Connectors"}),subtitle:c?void 0:e.jsx(He,{}),badge:e.jsx(Ss,{})}),e.jsx(Os,{skipLegacyWorkspaceCheck:!0,children:e.jsxs(Ps,{className:"mt-6 gap-12",children:[a?e.jsxs(e.Fragment,{children:[e.jsx(Ot,{}),t!=null&&o===Ts.ALPHA&&e.jsx(qt,{currentWorkspaceId:t.id})]}):l?e.jsx(Kt,{}):null,t!=null&&i&&e.jsxs(J,{children:[c&&e.jsx(ct,{}),e.jsx(dt,{workspaceId:t.id})]})]})})]})}function Kt(){return e.jsxs(e.Fragment,{children:[e.jsx(J,{children:e.jsx(Je,{badge:e.jsx("div",{children:e.jsx("span",{className:"text-token-text-secondary rounded-xl border px-2 py-1 text-[8px] font-bold uppercase",children:e.jsx(r,{id:"IrfQIu",defaultMessage:"Coming soon"})})})})}),e.jsxs("div",{className:"bg-token-main-surface-tertiary text-token-text-secondary flex flex-row gap-2 rounded-xl p-4",children:[e.jsx(Ds,{className:"icon-md"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-xs font-bold",children:e.jsx(r,{id:"ES5xU+",defaultMessage:"When will this feature be available?"})}),e.jsxs("p",{className:"text-xs",children:[e.jsx(r,{id:"9w5rs5",defaultMessage:"Internal knowledge will be rolled out incrementally to ChatGPT Team workspaces over the next few weeks. We will notify you in ChatGPT when your workspace is eligible."})," ",e.jsx(le,{href:R,className:"underline",onClick:()=>re({link:R,location:"admin_settings_coming_soon_widget"}),children:e.jsx(r,{id:"WGpoE2",defaultMessage:"Learn more"})})]})]})]})]})}const Ia=is(function(){return e.jsx(Vt,{})});export{Ia as default};
//# sourceMappingURL=ba5rzc042k78phgz.js.map
