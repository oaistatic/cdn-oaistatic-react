import{r,j as s,M as b}from"./ci5tkrccytan34lo.js";import{c as A,K as F,aZ as H,M as I,ds as R,e as f,a_ as z,cA as B,bi as G,B as w,F as K,ck as U}from"./ccccre6vnqbb7l94.js";import{cL as L,hN as O,hO as V,hP as D,hQ as J,hR as Q}from"./fztttvm3qzdvif1h.js";const W=r.forwardRef(function(t,c){const{className:i,...d}=t;return s.jsxs("div",{className:"grid",children:[s.jsx("textarea",{className:A("col-start-1 col-end-2 row-start-1 row-end-2 w-full resize-none overflow-hidden p-0",i),ref:c,...d}),s.jsxs("span",{className:"invisible col-start-1 col-end-2 row-start-1 row-end-2 p-0 break-all whitespace-pre-wrap",children:[t.value," "]})]})});function Z({initialText:o,clientThreadId:t,currentLeaf:c,onExitEdit:i,onRequestCompletion:d,disabled:y,attachments:l}){const[u,C]=r.useState(o??""),g=r.useRef(null),M=L(),p=O(),m=u.trim()==="",{value:v}=F("1988730211"),N=r.useCallback(e=>{C(e.currentTarget.value)},[]),x=r.useCallback(e=>{if(m)return;const a={},n=V();l&&(a.attachments=l),n&&(a.__internal={search_settings:n});const S=Array.from(p),{systemHints:T,extraStreamParams:P}=v?D(S):{systemHints:S,extraStreamParams:{}},j=H(t),_=I.getParentNode(j,c).message.id;d({sourceEvent:e,parentMessageId:_,promptMessage:R(u,Object.keys(a).length>0?a:void 0),extraStreamParams:P,completionMetadata:{conversationMode:j?.mode,systemHints:T}}),i(),f.logEvent("Change Active Node",{intent:"edit_save"})},[m,l,t,p,v,d,i,c,u]),h=r.useCallback(()=>{z(t,e=>{B.setCurrentBranch(e,c)}),f.logEvent("Change Active Node",{intent:"edit_cancel"}),i(),f.logEvent("Cancel Edit Prompt",{threadId:G(t)})},[c,i,t]);r.useEffect(()=>{const e=g.current;if(e){e.focus();const a=e.value.length;e.setSelectionRange(a,a)}},[]),r.useEffect(()=>{const e=g.current,a=n=>{n.isComposing||(n.key==="Enter"&&n.metaKey?x(n):n.key==="Escape"&&h())};return e&&e.addEventListener("keydown",a),()=>{e&&e.removeEventListener("keydown",a)}},[h,x]);const E=l&&l.length>0&&s.jsx(X,{children:l.map(e=>s.jsx(J,{width:M?"normal":"wide",file:e.name,contextConnectorInfo:Q(e.context_connector_info)},e.id))}),k=s.jsx("div",{className:"m-2 max-h-[25dvh] overflow-auto",children:s.jsx(W,{ref:g,value:u,onChange:N,className:"m-0 w-full resize-none border-0 bg-transparent focus:ring-0 focus-visible:ring-0"})});return s.jsxs("div",{className:"bg-token-main-surface-tertiary rounded-3xl px-3 py-3",children:[E,k,s.jsxs("div",{className:"flex justify-end gap-2",children:[s.jsx(w,{as:"button",color:"secondary",onClick:h,children:s.jsx(b,{id:"D9gbPp",defaultMessage:"Cancel"})}),s.jsx(w,{as:"button",onClick:x,disabled:y||m,children:s.jsx(b,{id:"KGxIJG",defaultMessage:"Send"})})]})]})}const X=K.div`flex gap-2 flex-wrap`;function te({message:o,...t}){return s.jsx(Z,{currentLeaf:o.id,initialText:U(o),attachments:o.metadata?.attachments,...t})}export{te as TextMessageEditor};
//# sourceMappingURL=c5d382hgq7lq9dvu.js.map
