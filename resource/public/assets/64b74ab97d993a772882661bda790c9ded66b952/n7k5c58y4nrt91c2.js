import{r as m,j as o,a6 as w,M as h}from"./ci5tkrccytan34lo.js";import{L as I,E,cv as T,e as C,c as F,M as S}from"./ccccre6vnqbb7l94.js";import{cw as D,cx as N,cy as $,cz as A,cA as U,cB as O,cu as W}from"./fztttvm3qzdvif1h.js";import{F as z}from"./ebbe56r21p4nhezb.js";import{AnimatedContainer as k}from"./md3szw2njgfh06wp.js";import"./hapan2fx2czn21gi.js";import"./kzhevji8i57j71hk.js";import"./f7jif0lf4ny3x7b9.js";function g(t,e){const l=new RegExp(`<\\s*${e}\\s*>([\\s\\S]*?)<\\s*/\\s*${e}\\s*>`,"i"),a=t.match(l);return a&&a[1]?a[1].trim():t}function B(t){if(t===void 0)return;const e="Content Snippet:",l=t.indexOf(e);return l===-1?t:t.substring(l+e.length).trim()}function L(t,e){e.text=B(t.contents),t.documentId?.includes("ks--slack")?(e.text=void 0,e.name=`#${e.name}`):e.cloud_doc_url?.startsWith("https://docs.google.com/spreadsheets/")&&e.text!==void 0?e.text=g(e.text,"sheet_summary"):e.cloud_doc_url?.match(/^https:\/\/github\.com\/[^/]+\/[^/]+\/commit\//)&&e.text!==void 0?e.text=g(e.text,"git_summary"):e.cloud_doc_url?.match(/^https:\/\/github\.com\/[^/]+\/[^/]+\/blob\//)&&e.text!==void 0&&(e.text=g(e.text,"code_summary")),e.text&&(e.text=e.text.slice(0,250))}function X({turnIndex:t,clientThreadId:e}){const[l,a]=I(e,i=>[S.getTurnContentReferences(i,t),S.getConversationTurnAtIndex(i,t).messages]),f=D(e),n=m.useMemo(()=>({turnIndex:t,clientThreadId:e}),[e,t]),p=m.useMemo(()=>{const i=[],r=new Set;return l.forEach(s=>{s.type==="file"&&!r.has(s.id)?(i.push({id:s.id,name:s.name,cloud_doc_url:s.cloud_doc_url??s.extra?.cloud_doc_url,text:s.text}),r.add(s.id)):s.type==="file_navlist"&&s.items.forEach(u=>{r.has(u.id)||(i.push({name:u.name,cloud_doc_url:u.cloud_doc_url,text:u.description,id:u.id,lastModifiedTime:u.last_modified_time}),r.add(u.id))})}),i},[l]),d=N(f),x=m.useMemo(()=>{if(!d)return[];const i=[],r=new Set;for(const s of a)if(s.author.role===E.Tool&&s.author.name==="file_search"&&s.content.content_type===T.TetherBrowsingDisplay){const u=$(s.content.result),b=s.metadata?.cloud_doc_urls??[];u.chunks.forEach((c,v)=>{if(!c.documentId||r.has(c.documentId))return;r.add(c.documentId);let _;c.metadata.cloud_doc_url?_=c.metadata.cloud_doc_url.toString():v<b.length?_=b[v]:c.documentId.endsWith("--google")&&(_=`https://drive.google.com/file/d/${c.documentId.split("--")[1]}`);const y=c.metadata["File last modified at"]??c.metadata["File created at"],j={id:c.documentId,name:c.title,cloud_doc_url:_,text:c.contents,lastModifiedTime:y?y.toString():void 0};L(c,j),i.push(j)})}return i},[d,a]);return o.jsx(w,{children:o.jsxs("div",{className:"bg-token-main-surface-primary mt-[calc(var(--threadFlyOut-leading-height,57px)*-1)] flex w-full flex-col",children:[o.jsx(M,{title:o.jsx(h,{id:"dlVlo6",defaultMessage:"Citations"}),items:p,clientThreadId:e,sectionId:"citations",analyticsMetadata:n}),o.jsx(M,{title:o.jsx(h,{id:"njZblE",defaultMessage:"Search Results"}),items:x,clientThreadId:e,sectionId:"search-results",analyticsMetadata:n})]})})}function M({title:t,items:e,scrollToHeader:l,shouldAnimateScroll:a,clientThreadId:f,analyticsMetadata:n,sectionId:p}){const d=m.useRef(null),x=m.useMemo(()=>n?{...n,sectionId:p,numResultsInSection:e.length}:void 0,[n,e.length,p]);return m.useEffect(()=>{d.current&&l&&setTimeout(()=>{d.current&&d.current.scrollIntoView({behavior:a?"smooth":"instant"})},300)},[l,a]),!e||e.length===0?null:o.jsxs("div",{ref:d,children:[o.jsx(k,{className:"border-token-border-sharp bg-token-main-surface-primary text-token-text-primary sticky top-0 z-1 flex h-[calc(var(--header-height,3.5rem)+1px)] items-center border-b px-6 pt-4 pb-4 text-sm font-medium",children:t}),o.jsx("div",{className:"flex flex-col px-3 py-2",children:e.map((i,r)=>o.jsx(k,{index:r,children:o.jsx(P,{positionInSection:r,item:i,analyticsMetadata:x,clientThreadId:f},r)},`${t}-${r}`))})]})}function P({item:t,analyticsMetadata:e,positionInSection:l,clientThreadId:a}){const f=A(),n=U(t.cloud_doc_url??""),p=n?.type??o.jsx(h,{id:"bqY3sN",defaultMessage:"File"}),d=n?.Icon??O,[x,i]=m.useState(!1),r=m.useCallback(()=>{e&&C.logEventWithStatsig("File Sources Sidebar Item Clicked","file_sources_sidebar_link_clicked",{...e,positionInSection:l,sourceType:n?.type,hasUrl:!!t.cloud_doc_url})},[e,t.cloud_doc_url,n?.type,l]),s=m.useCallback(()=>{e&&C.logEventWithStatsig("File Source Sidebar Item Followup Clicked","file_sources_sidebar_item_followup_clicked",{...e,positionInSection:l,sourceType:n?.type,hasUrl:!!t.cloud_doc_url})},[e,t.cloud_doc_url,n?.type,l]);return o.jsx(o.Fragment,{children:o.jsxs("a",{href:t.cloud_doc_url,target:"_blank",rel:"noreferrer",onClick:r,className:F("group relative flex flex-col gap-0.5 rounded-xl px-3 py-2.5","hover:bg-token-main-surface-secondary",x&&"bg-token-main-surface-secondary"),children:[o.jsxs("div",{className:"line-clamp-1 flex h-6 items-center gap-2 text-xs",children:[d&&o.jsx(d,{className:"icon-sm bg-token-main-surface-primary rounded-full object-cover"}),p]}),o.jsx("div",{className:"line-clamp-2 text-sm font-semibold break-words",children:t.name}),(t.text??t.lastModifiedTime)&&o.jsxs("div",{className:"text-token-text-secondary line-clamp-2 text-sm leading-snug font-normal",children:[t.lastModifiedTime&&o.jsxs("span",{children:[o.jsx(W,{date:new Date(t.lastModifiedTime)}),t.text&&" â€” "]}),t.text]}),f?null:o.jsx(z,{className:F("absolute end-2 top-2 flex h-7 w-7 items-center justify-center rounded-sm p-1 transition","text-token-text-secondary group-hover:text-token-text-primary","invisible group-hover:visible","bg-token-main-surface-secondary hover:bg-token-main-surface-tertiary",x&&"bg-token-main-surface-tertiary text-token-text-primary visible"),clientThreadId:a,fileId:t.id,fileName:t.name,fileCloudDocUrl:t.cloud_doc_url,isFollowupMenuOpen:x,setIsFollowupMenuOpen:i,trackFileSourceFollowup:s})]})})}export{X as ChatScreenRetrievalResultsFlyoutContent,M as SourcesListGroup};
//# sourceMappingURL=n7k5c58y4nrt91c2.js.map
