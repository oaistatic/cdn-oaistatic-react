const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/mqq8wh7vlbjssba0.js","assets/ci5tkrccytan34lo.js","assets/fztttvm3qzdvif1h.js","assets/ccccre6vnqbb7l94.js","assets/root-ggl0dfwq.css","assets/conversation-small-dfayqh3x.css","assets/l9vpjmbivd4kh2pb.js","assets/j52n6j7c5egw4qys.js","assets/mbayu552ymsflarc.js","assets/hnwyihljdxrug66f.js","assets/grqqoygx78z5w4fx.js","assets/hapan2fx2czn21gi.js","assets/kzhevji8i57j71hk.js","assets/h2gd34k3oh53zw7p.js","assets/o5dcel4w1cacawdo.js"])))=>i.map(i=>d[i]);
import{i as $,j as e,f as Zs,M as L,e as Pe,r as u,a5 as ne,a6 as nt,u as Pi,q as Ei,L as Ni,am as Ti,c as Bi,p as Li,D as Di}from"./ci5tkrccytan34lo.js";import{d as We,e as Zo}from"./grqqoygx78z5w4fx.js";import{jn as en,vc as tn,ai as ot,vd as xe,bo as sn,pR as es,hi as nn,bF as Vt,oK as _o,ve as Ii,vf as ea,eL as Fi,dj as ta,cQ as on,q7 as sa,cR as Kt,em as Oi,vg as an,vh as rn,vi as Ui,oe as Oe,dZ as ts,kU as ss,vj as Gs,o6 as zs,fB as ns,vk as na,vl as oa,ee as aa,og as ra,ef as ia,oI as Hi,ss as os,hN as bt,vm as Gi,kV as ge,mW as zi,sB as Wi,d as ca,k_ as Ws,i6 as X,fX as Vi,nI as ko,lv as Ki,tR as la,vn as qi,vo as $i,vp as Yi,cw as Qi,vq as Xi,vr as Ji,vs as Zi,vt as ec,vu as tc,pG as Ts,vv as Mo,vw as sc,vx as nc,a2 as Ee,vy as oc,vz as ac,tL as Bs,B as cn,i1 as ua,i2 as da,nT as rc,r1 as ic,f3 as cc,vA as lc,iv as uc,ix as dc,kT as de,vB as mc,t9 as yt,vC as pc,lu as fc,vD as gc,vE as N,vF as ma,vG as hc,vH as xc,vI as Sc,vJ as yc,vK as bc,vL as Cc,vM as vc,vN as wc,vO as _c,vP as kc,vQ as Mc,vR as jc,vS as Ac,vT as Rc,vU as Pc,vV as Ec,vW as Nc,vX as Tc,vY as Bc,vZ as Lc,v_ as Dc,bL as Ic,jl as Fc,v$ as Oc,w0 as Uc,w1 as Hc,w2 as Gc,qi as Ut,R as fe,O as Ce,w3 as zc,pn as Wc,M as ln,w4 as Vc,k0 as st,e as pa,w5 as Kc,w6 as qc,qn as Vs,kZ as $c,q5 as Yc,kg as un,w7 as Qc,nJ as fa,nL as Xc,w8 as Jc,w9 as Zc,pv as el,wa as tl,wb as sl,jm as nl,d0 as ol,N as as,hr as al,wc as rl,bg as il,fd as cl,dD as ga,wd as ha,fT as Ks,i8 as ll,dg as W,fS as dn,im as xa,ln as ul,bQ as mn,fV as pn,fW as fn,we as dl,wf as $t,wg as tt,wh as gn,wi as Sa,d_ as ml,wj as pl,wk as fl,jp as rs,fY as ya,rW as hn,wl as ba,gh as gl,wm as hl,wn as Ca,jo as xl,wo as Sl,wp as va,jr as yl,x as bl,wq as Cl,wr as vl,ws as wl,fQ as _l,wt as kl,wu as xn,fo as Ml,wv as jl,ww as He,wx as Al,wy as Rl,J as wa,wz as Pl,wA as Yt,qh as El,rx as Nl,Q as _a,E as Tl,wB as ka,hC as Bl,wC as Ll,wD as Dl,wE as Il,wF as Fl,wG as Ol,wH as Ul,wI as Hl,wJ as Gl,wK as zl,wL as Wl,wM as Vl,wN as Kl,wO as ql,wP as $l,wQ as Yl,wR as Ql,wS as Xl,wT as Jl,wU as Zl,wV as eu,wW as tu,iW as su,qC as Ma,wX as nu,wY as ou,rj as au,cN as ru,wZ as ja,w_ as gt,w$ as iu,x0 as cu,n8 as Aa,n7 as Ra,x1 as lu,x2 as uu,x3 as du,x4 as mu,x5 as pu,x6 as fu,x7 as gu,x8 as hu,x9 as xu,gb as Pa,kz as Su,xa as yu,fg as bu,fh as Cu,xb as Qt,fi as Ea,fj as vu,xc as Na,fk as wu,il as _u,xd as ku,A as Mu,G as ju,xe as Au,xf as Ta,xg as Ba,xh as Ru,qm as Pu,xi as qs,xj as Eu,fz as Nu,bi as Tu,kW as Bu,q as Lu,xk as Du,gg as Iu,c9 as Fu,xl as Ou,sU as Uu,ii as jo,mX as Ht,xm as Hu,xn as Ls,xo as Gu,xp as zu,xq as Wu,xr as Vu,xs as Ku,kM as qu,xt as $u,xu as Ao,jb as Yu,mf as Qu,xv as Ds,xw as Xu,n0 as Ju,xx as Zu,xy as ed,xz as td,mk as sd,xA as nd,xB as od,cb as ad,cc as rd,xC as id,a3 as cd,U as Ro,fR as ld,cL as La,xD as ud,l5 as dd,lb as md,ft as pd,xE as fd,xF as gd,xG as hd,xH as xd,xI as Sd,ff as yd,xJ as Po,xK as Eo,xL as No,l1 as bd,xM as Cd,xN as vd,xO as wd,xP as _d,xQ as kd,xR as Md,xS as jd,eh as Ad,jA as Rd,cz as Pd,xT as Ed,jM as Nd,hh as Td,q4 as Bd,hg as Ld,sS as Dd,oY as Is,oZ as Fs,xU as Id,hf as Fd}from"./fztttvm3qzdvif1h.js";import{L as Z,ap as Ve,d3 as Se,R as Od,T as Ud,P as Hd,C as Gd,e as R,hI as te,B as ye,M as se,hJ as is,F as Sn,I as he,dD as Da,ac as at,at as ve,dE as Xt,aL as T,ak as cs,gQ as Jt,a as zd,b0 as Ge,a_ as ke,hK as Os,hL as Us,hM as To,aZ as be,q as Wd,c as K,hN as Vd,aR as yn,cf as Ia,aj as bn,hl as Kd,ck as qd,hO as Fa,aX as Ue,eG as Oa,de as Ua,aK as Re,K as ze,cG as Bo,b$ as $d,z as Yd,dT as Ha,aC as Qd,bh as Xd,aE as je,d_ as Ga,O as Cn,_ as vn,aH as qt,aa as za,a6 as $s,D as Jd,d7 as Zd,ae as Wa,aI as Ae,bd as em,o as tm,b as sm,d as nm,gv as wn,hP as Va,gM as Ys,y as _n,eI as Ka,dk as om,eE as qa,eq as am,ai as Me,ah as Lo,eD as $a,c7 as Ya,en as rm,cX as im,u as Qs,E as Qa,cm,dG as Xa,bW as Ja,ce as lm,hQ as um,bb as dm,an as ht,a$ as Do,n as mm,a5 as Za,c_ as er,c8 as pm,bK as fm,b_ as gm,gY as hm,ew as xm,c$ as Sm,J as ym,bi as xt,bk as Io,hR as bm,hS as Cm,hT as vm,d6 as wm,e7 as _m,s as km,N as Mm,gh as jm,gi as Am,fA as Rm,fn as Pm}from"./ccccre6vnqbb7l94.js";import{u as tr}from"./k4lih7nb4umlxxxc.js";import{f as sr,g as nr,P as Em,h as Nm,p as Tm,i as Bm,u as or,j as Lm,c as Dm,b as Im}from"./bgu7mt464bd85qmz.js";import{g as Fm,A as Om,C as Um}from"./bb4l02lm4p1hlo2s.js";import{u as Hm}from"./ln3t6yic0tgf7gor.js";import{b as Gm}from"./o5dcel4w1cacawdo.js";import{G as ar}from"./j3zg44ruze86crbd.js";import{P as rr}from"./m3p85h1r7wwh3ar4.js";import{e as zm,f as Wm,h as Gt,i as Vm,P as Km,j as qm}from"./hapan2fx2czn21gi.js";import{u as ir}from"./eykh2s3cx0s4wv4b.js";import{F as $m}from"./nplnc7nfjbqgwb50.js";import{u as Ym}from"./d6qfcfpf3ythcmx2.js";import{u as cr,a as Qm,I as Xm,R as Jm,C as Zm,H as Fo,B as Oo,F as ep,b as tp,S as sp,c as Uo,d as np}from"./hnwyihljdxrug66f.js";const lr=({clientThreadId:t,rateLimitPopup:s,children:o,disabled:n,highlightTooltip:r=!1,disabledReason:a,currentModelName:c})=>{const i=$(),l=Z(t,se.getIsNewConversation),d=Ve(),m=g=>{s!=null&&g&&R.logPopoverHover({type:"rate_limit",location:"file_upload",plan_type:d?.planType??"unknown"})},f=en(Se.signUpButtonText),{isEligible:p}=Ym(t),x=!!s;return e.jsx(e.Fragment,{children:x?e.jsx("div",{className:"h-8",children:e.jsxs(Od,{delayDuration:150,onOpenChange:m,children:[e.jsx(Ud,{asChild:!0,children:o}),e.jsx(Hd,{children:e.jsx(tn,{$as:Gd,side:"left",sideOffset:0,align:"start",alignOffset:-12,className:"max-w-[320px]",children:e.jsx(op,{isNewConversation:l,rateLimitPopup:s,signUpButtonText:f})})})]})}):!n&&p?e.jsx($m,{clientThreadId:t,children:o}):e.jsx(ot,{label:ur(i,n,a,c),className:"flex",open:r?!0:void 0,side:"bottom",children:o})})};function ur(t,s,o,n){if(!s)return t.formatMessage({id:"composer.add.label",defaultMessage:"Add photos and files"});switch(o){case xe.ModelNotSupported:if(!n)break;return t.formatMessage({id:"xPEzDr",defaultMessage:"Add files disabled for {modelName}"},{modelName:n??"model"});case xe.ThinkModeInUse:return t.formatMessage({id:"s8j69s",defaultMessage:"Add files disabled in Reason mode"});case xe.SearchModeInUse:return t.formatMessage({id:"EQF2Gd",defaultMessage:"Add files disabled in Search mode"})}return t.formatMessage({id:"MeW0HZ",defaultMessage:"Add files is unavailable"})}const op=({isNewConversation:t=!1,rateLimitPopup:s,signUpButtonText:o})=>{const n=Ve(),r=Zs(),a=sn(),c=es(),i=nn();if(s==null)return null;const{call_to_action:l,description:d}=s,m=d||e.jsx(L,{...Ho.defaultDescription}),f=l?.includes(te.GET_PLUS),p=l?.includes(te.AUTHENTICATE),x=p&&i;return e.jsxs("div",{className:"text-token-text-primary p-2 text-sm",children:[e.jsx("div",{className:"mb-3",children:m}),f?e.jsx(ye,{size:"small",color:"secondary",onClick:()=>{Vt(r,"Rate limited file upload popover"),R.logRateLimitGetPlusButtonClicked({type:"file_upload",location:"popover",plan_type:n?.planType??"unknown",is_hard_block:!1,is_new_conversation:t,hard_block_reason:""})},children:e.jsx(L,{...Ho.getPlus})}):null,p?e.jsx(ye,{size:"small",color:"primary",onClick:()=>{a({authType:c?"login":"signup",callback:g=>{c?R.logLogInButtonClicked({location:"File picker rate limit tooltip",provider:g}):R.logSignUpButtonClicked({location:"File picker rate limit tooltip",provider:g})}})},children:c?e.jsx(L,{...Se.logInButtonText}):e.jsx(L,{...o})}):null,x?e.jsx(ye,{size:"small",color:"secondary",className:"ms-2",onClick:()=>{a({authType:c?"signup":"login",callback:g=>{c?R.logSignUpButtonClicked({location:"File picker rate limit tooltip",provider:g}):R.logLogInButtonClicked({location:"File picker rate limit tooltip",provider:g})}})},children:c?e.jsx(L,{...o}):e.jsx(L,{...Se.logInButtonText})}):null]})},Ho=Pe({defaultDescription:{id:"U5qAWP",defaultMessage:"You've reached your daily upload limit. Get ChatGPT Plus to unlock more."},getPlus:{id:"TeyLcp",defaultMessage:"Get Plus"}});function ap({clientThreadId:t,getInputProps:s,openFileDialog:o,uploadType:n,icon:r,isDisabled:a=!1,isSmall:c=!1,showLabel:i=!1,showUpsell:l=!1,hideBorder:d=!1,highlightTooltip:m=!1,disabledReason:f,currentModelName:p,visualTreatment:x}){const g=$(),y=is();a=(a||!!y)&&!l;const w=e.jsxs(Ii,{disabled:a,$showLabel:i,$hideBorder:d,$isSmall:c,$visualTreatment:x,onClick:S=>{if(S.preventDefault(),l){R.logNoAuthAttachButtonClicked({location:"No auth upsell"});return}R.logEvent("Open File Viewer",{intent:n.toString()}),o()},"aria-label":a?f===xe.ModelNotSupported?g.formatMessage({id:"pEB4vw",defaultMessage:"Attachments disabled for {modelName}"},{modelName:`${p}`}):f===xe.ThinkModeInUse?g.formatMessage({id:"NRk4QL",defaultMessage:"Attachments disabled for Reason mode"}):f===xe.SearchModeInUse?g.formatMessage({id:"YlO80p",defaultMessage:"Attachments disabled for Search mode"}):g.formatMessage({id:"PromptFilePicker.attachFilesUnavailable",defaultMessage:"Attach files is unavailable"}):g.formatMessage({id:"PromptFilePicker.attachFiles",defaultMessage:"Upload files and more"}),children:[r,i&&e.jsx(ea,{})]}),k=e.jsx("input",{disabled:a,...s({className:"hidden"})}),b=e.jsxs("div",{className:"flex",children:[w,k]});return l?e.jsx(ot,{label:e.jsx(L,{id:"wkpQmi",defaultMessage:"Upload files and more"}),side:"bottom",open:m||void 0,children:e.jsx(Fi,{triggerButton:b,sideOffset:0,alignOffset:0,children:e.jsx(ta,{location:"attach",statsig_login_event:"chatgpt_composer_upsell_login_button_clicked",statsig_signup_event:"chatgpt_composer_upsell_signup_button_clicked"})})}):e.jsx(lr,{disabled:a,clientThreadId:t,rateLimitPopup:y,highlightTooltip:m,children:b})}function rp({code:t,message:s}){switch(t){case _o.FileTooLarge:return Go.errorFileTooLarge;case _o.TooManyFiles:return R.logEvent("Uploaded Max Files Error"),Go.errorTooManyFiles;default:return s}}const Go=Pe({attachImages:{id:"PromptFilePicker.attachImages",defaultMessage:"Attach images"},attachFiles:{id:"PromptFilePicker.attachFiles",defaultMessage:"Upload files and more"},errorFileTooLarge:{id:"PromptFilePicker.errorFileTooLarge",defaultMessage:"Your file is too large. The maximum file size is {size}MB."},errorTooManyFiles:{id:"PromptFilePicker.errorTooManyFiles",defaultMessage:"You may only upload {maxNum} files at a time."},defaultFileUploadRateLimited:{id:"U5qAWP",defaultMessage:"You've reached your daily upload limit. Get ChatGPT Plus to unlock more."},getPlusButton:{id:"TeyLcp",defaultMessage:"Get Plus"}}),zo=Pe({dragInstructions:{id:"FileDropZone.dragInstructions",defaultMessage:"Add anything"},dragAllAccepted:{id:"FileDropZone.dragAllAccepted",defaultMessage:"Drop any file here to add it to the conversation"}});function ip(t){if(!t.accept||Object.keys(t.accept).length===0)return[];const s=[];return Object.values(t.accept).forEach(o=>s.push(...o)),s.sort()}function kg(t){const{className:s,children:o,clientThreadId:n,currentModelConfig:r,noKeyboard:a}=t,c=$(),i=at(),l=ts(n),d=ss(),m=Gs(r,l,d),f=m!==Oe.None,p=zs(A=>A.files),x=(m===Oe.Multimodal?an:rn)-p.length,g=x<=0,{getGizmoId:y}=ns(),{handleFileAccepted:w}=mr(c,m,oa(r,l),"drag",y,na(r,l)?.attachments),k=is(),b=aa(ra(r,l)),{getRootProps:S,isDragActive:v}=ir({maxFiles:x,disabled:!f||g||k!=null,noClick:!0,noKeyboard:a,onDropAccepted:w,onDropRejected:A=>dr(A,c,i,m),multiple:!0,maxSize:ia,...b}),_=ip(b);return e.jsxs("div",{...S({className:s}),children:[o,v&&e.jsxs(cp,{children:[e.jsx(Hi,{}),e.jsx("h3",{children:e.jsx(L,{...zo.dragInstructions})}),e.jsx("h4",{className:"w-2/3 text-center",children:_.length>0?_.join(", "):e.jsx(L,{...zo.dragAllAccepted})})]})]})}function dr(t,s,o,n){const{errors:r}=t[0];r.forEach(a=>{const c=rp(a);typeof c=="string"?o.danger(c,{hasCloseButton:!0}):o.danger(s.formatMessage(c,{size:Ui,maxNum:n===Oe.Multimodal?an:rn}),{hasCloseButton:!0})})}function mr(t,s,o,n,r,a){const c=he(),i=Da(c).flags,l=at(),d=on(),m=sa(),{isUnauthenticated:f}=ve(),p=i?.includes(Xt.NoAuthEnableFileUploads);return{handleFileAccepted:u.useCallback(async(g,y)=>{R.logEvent("Upload File",{client:"web",eventSource:n,intent:s.toString()}),m.fileUploadAccepted();const w=r!=null?await r():void 0;g.length>0&&g.forEach(k=>{Kt.uploadFile(d,Oi(k),k,s,o,t,l,{gizmoId:w,...p&&{isUnauthenticated:f}},a)})},[n,s,r,d,m,o,t,l,a,p,f])}}const cp=Sn.div`absolute z-50 inset-0 flex gap-2 flex-col justify-center items-center after:contents-[""] after:absolute after:opacity-80 after:z-[-1] after:bg-token-main-surface-primary after:inset-0`,lp=({clientThreadId:t})=>{"use forget";const s=he(),{activeSystemHints:o}=os(t),n=bt(),r=o.some(g=>g.systemHint===T.Slurm)&&(n.size===0||n.has(T.Slurm)||n.has(T.Research)),a=cs(s,"463092697").value,i=!!a?.softmentionEnabled&&r,{connectedTypes:l}=sr({enabled:i}),{connectedTypes:d}=nr({enabled:i}),{data:m}=tr(),{filteredKeywords:f,connectorToKeywordsMap:p,keywordsConnectorMap:x}=u.useMemo(()=>{let g=l;n.has(T.Research)?g=d:n.has(T.Slurm)&&(g=l);const y=a?.connectorConfig||{},w=m?.connection_statuses.reduce((v,_)=>(["activated","partially_activated"].includes(_.user_connection_details.activation_status)&&v.add(_.user_connection_details.connection_type),v),new Set)??new Set,{keywordSet:k,connectorToKeywordsMap:b,keywordsConnectorMap:S}=Object.entries(y).reduce((v,[_,A])=>{if(g.has(_)||w.has(_)){const P=(A?.keywords||[]).map(B=>B.toLowerCase());v.connectorToKeywordsMap[_]=P,P.forEach(B=>{v.keywordSet.add(B),v.keywordsConnectorMap[B]=_})}return v},{keywordSet:new Set,connectorToKeywordsMap:{},keywordsConnectorMap:{}});return{filteredKeywords:i?Array.from(k):[],connectorToKeywordsMap:i?b:{},keywordsConnectorMap:i?S:{}}},[a?.connectorConfig,d,i,n,l,m?.connection_statuses]);return{enabled:i,keywords:f,connectorToKeywordsMap:p,keywordsConnectorMap:x}},up=({clientThreadId:t})=>{"use forget";const{connectedTypes:s,isLoading:o}=sr(),{connectorConfigMap:n}=pr({clientThreadId:t}),{connectedTypes:r,isLoading:a}=nr(),{data:c,isLoading:i}=tr(),l=o||a||i;return{availableConnectorTypes:u.useMemo(()=>{const m=[...s].filter(g=>g!==Jt.MCP_CONNECTOR&&(!n.has(g)||!n.get(g)?.disabled)),f=[...[...r].filter(g=>g!==Jt.MCP_CONNECTOR),"web"],p=c?.connection_statuses.filter(g=>["partially_activated","activated"].includes(g.user_connection_details.activation_status)).map(g=>g.user_connection_details.connection_type)??[];return new Map([[T.Research,new Set(f)],[T.Slurm,new Set([...m,...p])],[void 0,new Set(p)]])},[r,s,n,c?.connection_statuses]),isLoading:l}},pr=({clientThreadId:t})=>{"use forget";const s=he(),o=Gi(t),n=$(),r=cs(s,"463092697").value;return{connectorConfigMap:u.useMemo(()=>{const c=r?.connectorConfig||{};return Object.entries(c).reduce((i,[l,d])=>{const m=l,f=d.enabledModels&&o?!d.enabledModels.includes(o.id):!1;return i.set(m,{disabled:f,disabledText:f?n.formatMessage({id:"Fk33UU",defaultMessage:"Switch to {model} model to use beta connectors"},{model:d.enabledModels.join(", ")}):void 0,hasBetaTag:d.beta}),i},new Map)},[o,n,r?.connectorConfig])}},fr=t=>Ge(t,"3544641259")||!!cs(t,"463092697")?.value?.enabled,dp=(t,s)=>[...t].filter(o=>s.includes(o)),et=t=>{R.logEventWithStatsig("chatgpt_connectors_toggled_sources","chatgpt_connectors_toggled_sources",t)};function rt(t){const s=he(),{session:o}=zd(),n=Ge(s,"4059945251"),r=fr(s),a=[...bt()][0],{availableConnectorTypes:c}=up({clientThreadId:t}),i=Z(t,b=>b?.selectedSources?.get(a)??[]),l=Z(t,b=>[...b?.mentionedSources??[]]),d=Z(t,b=>new Set(b?.mentionedSources??[])),m=u.useMemo(()=>new Set([...dp([...i],[...c.get(a)??[]]),...l]),[c,l,a,i]),f=Z(t,b=>b?.selectedMCPSources?.get(a)??new Set),p=u.useMemo(()=>new Set(f),[f]),x=u.useCallback(b=>{t&&ke(t,S=>{const v=S.selectedSources?.get(a)??new Set,_=new Set([...S.selectedSources?.get(a)??[],...S.mentionedSources??[]]),A=S.mentionedSources??new Set;let P,B;if(!Os(b))B="platform",_.has(b)?(P="remove",v.delete(b),A.has(b)&&(et({source:"mentions",action:P,type:B,systemHint:a,selectedSource:b,extra:"removed_by_toggle_source"}),A.delete(b))):(P="add",v.add(b),!n&&b!=="web"&&v.has("web")&&!S.hasRemovedWebSource&&(v.delete("web"),S.hasRemovedWebSource=!0));else{B="mcp";const M=S.selectedMCPSources?.get(a)??new Set;M.has(b)?(P="remove",M.delete(b)):(P="add",M.add(b)),!n&&v.has("web")&&!S.hasRemovedWebSource&&(v.delete("web"),S.hasRemovedWebSource=!0),S.selectedMCPSources??=new Map,S.selectedMCPSources.set(a,M)}S.selectedSources??=new Map,S.selectedSources.set(a,v),S.mentionedSources=A,et({source:"toggle",action:P,type:B,systemHint:a,selectedSource:b}),Us({selectedSourcesMap:S.selectedSources,selectedMCPSourcesMap:S.selectedMCPSources,scope:{userId:o?.user?.id,workspaceId:o?.account?.id}})})},[t,a,o?.user?.id,o?.account?.id,n]),g=u.useCallback(b=>{t&&ke(t,S=>{let v;if(Os(b)){v="mcp";const _=S.selectedMCPSources?.get(a)??new Set;_.add(b),S.selectedMCPSources??=new Map,S.selectedMCPSources.set(a,_)}else{v="platform";const _=S.selectedSources?.get(a)??new Set;_.add(b),S.selectedSources??=new Map,S.selectedSources.set(a,_)}et({source:"toggle",action:"add",type:v,systemHint:a,selectedSource:b}),Us({selectedSourcesMap:S.selectedSources,selectedMCPSourcesMap:S.selectedMCPSources,scope:{userId:o?.user?.id,workspaceId:o?.account?.id}})})},[t,a,o?.account?.id,o?.user?.id]),y=u.useCallback(b=>{t&&ke(t,S=>{const v=S.mentionedSources??new Set;v.add(b),S.mentionedSources=v,et({source:"mentions",action:"add",type:"platform",systemHint:a,selectedSource:b})})},[t,a]),w=u.useCallback(b=>{t&&ke(t,S=>{const v=S.mentionedSources??new Set;v.delete(b),S.mentionedSources=v,et({source:"mentions",action:"remove",type:"platform",systemHint:a,selectedSource:b})})},[t,a]),k=u.useCallback(b=>{t&&ke(t,S=>{let v;if(Os(b)){v="mcp";const _=S.selectedMCPSources?.get(a)??new Set;_.delete(b),S.selectedMCPSources??=new Map,S.selectedMCPSources.set(a,_)}else{v="platform";const _=S.selectedSources?.get(a)??new Set;_.delete(b),S.selectedSources??=new Map,S.selectedSources.set(a,_);const A=S.mentionedSources??new Set;A.has(b)&&A.delete(b),S.mentionedSources=A}et({source:"toggle",action:"add",type:v,systemHint:a,selectedSource:b}),Us({selectedSourcesMap:S.selectedSources,selectedMCPSourcesMap:S.selectedMCPSources,scope:{userId:o?.user?.id,workspaceId:o?.account?.id}})})},[t,a,o?.account?.id,o?.user?.id]);return r?{selectedSources:m,selectedMCPSources:p,mentionedSources:d,toggleSource:x,addSource:g,deleteSource:k,addMentionedSource:y,deleteMentionedSource:w}:{selectedSources:void 0,selectedMCPSources:void 0,mentionedSources:void 0,toggleSource:()=>{},addSource:()=>{},deleteSource:()=>{},addMentionedSource:()=>{},deleteMentionedSource:()=>{}}}const mp=({clientThreadId:t,composerController:s})=>{const{mentionedSources:o,addMentionedSource:n,deleteMentionedSource:r}=rt(t),a=bt(),{setThreadSystemHintMode:c}=ge(),{keywords:i,connectorToKeywordsMap:l,keywordsConnectorMap:d}=lp({clientThreadId:t});u.useEffect(()=>{s.resetTrackingKeywords(i)},[s,i]);const m=u.useRef(a);u.useEffect(()=>{const x=m.current;m.current=a,(x.has(T.Slurm)||x.has(T.Research))&&a.size===0&&s.removeKeywordDecorations(s.getKeywords())},[a,s]);const f=u.useRef(o);u.useEffect(()=>{const x=f.current;if(f.current=o,!x)return;const g=Array.from(x).filter(w=>!(o??new Set).has(w)),y=[];g.forEach(w=>{y.push(...l[w]??[])}),s.removeKeywordDecorations(y)},[s,l,o]);const p=u.useRef([]);u.useEffect(()=>{const x=y=>{if(p.current.length===0&&y.length>0&&a.size===0){const b={clientThreadId:t};c(T.Slurm,!0,b)}const w=y.filter(b=>!p.current.includes(b)),k=p.current.filter(b=>!y.includes(b));w.forEach(b=>n(b)),k.forEach(b=>r(b)),p.current=y},g=()=>s.getKeywords().map(y=>d[y.toLowerCase()]);return x(To(g())),s.subscribe("change",()=>{x(To(g()))})},[n,t,s,r,d,a.size,c])},pp=({clientThreadId:t,currentModelId:s,isCompletionInProgress:o,composerController:n})=>{const r=zi(),a=bt(),c=n.useState(w=>w.getSystemHint()),i=be(t);mp({clientThreadId:t,composerController:n});const l=u.useMemo(()=>a.size>0?Array.from(a):c?[c]:[],[c,a]),d=u.useRef(o);u.useEffect(()=>{d.current=o},[o]);const m=u.useCallback(w=>{d.current?ke(t,k=>{k.conduitToken=null,k.prepareState=null}):ke(t,k=>{k.conduitToken=w,k.prepareState="success"})},[t]),f=u.useRef(null);f.current=()=>Wi(t,s,l,m);const p=u.useCallback(()=>f.current?.(),[]),x=u.useCallback(ca(()=>p(),5e3,{leading:!0,trailing:!0}),[]),g=u.useRef(!1),y=Wd();return u.useEffect(()=>{if(y){if(!g.current){g.current=!0;return}p()}},[y,t,s,l,i?.effortMode]),u.useEffect(()=>{x.cancel()},[o,x]),u.useEffect(()=>n.subscribe("change",()=>{o||r&&x()}),[o,n,x,r]),null},fp=({className:t,children:s})=>e.jsx(ne.div,{className:t,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,transition:{duration:.1,delay:0}},transition:{type:"tween",duration:.3,delay:.2},children:s});function gp({canContinue:t,onContinueGenerating:s}){const o=u.useCallback(r=>{s(r),Ws()},[s]);let n=null;return t&&(n=e.jsx(xp,{onHandleContinueGenerating:o})),n&&e.jsx("div",{className:"flex h-full w-full items-center justify-end gap-0 py-4 md:gap-2",children:n})}function hp({className:t}){return e.jsx(Vi,{className:K("-rotate-180",t)})}const xp=({onHandleContinueGenerating:t})=>e.jsx(fp,{children:e.jsx(ye,{as:"button",color:"secondary",onClick:t,className:"py-2 whitespace-nowrap",icon:hp,size:"small",children:e.jsx(L,{...X.continueGenerating})})}),gr=({clientThreadId:t,rateLimitInfo:s,onDismiss:o,onInteract:n,onMount:r})=>{const{name:a,title:c,call_to_action:i,description:l}=s,d=Ve(),m=ko(!0),{updateSystemHint:f}=ge(),p=We(),x=ko(!1),g=Vd(),y=Z(t,se.getIsNewConversation),w=d?.planType??"unknown",k=nn(),b=g&&"block_reason"in g?g.block_reason:null,S="banner_description",v=u.useMemo(()=>({type:a||"unknown",location:S,plan_type:w,is_new_conversation:y,is_hard_block:!!g,hard_block_reason:b??"",call_to_action:i}),[a,S,w,y,g,b,i]),_=Zs(),A=sn(),P=he(),B=!yn(P),M=es(),D=en(Se.signUpButtonText),I=Ki({clientThreadId:t}),F=Ia(P,"1368081792"),h=Q=>{switch(Q){case te.AUTHENTICATE:return{text:M?Se.logInButtonText:D,onClick:()=>{A({authType:M?"login":"signup",callback:V=>{M?R.logLogInButtonClicked({location:`Rate limit banner - ${a}`,provider:V}):R.logSignUpButtonClicked({location:`Rate limit banner - ${a}`,provider:V})}})}};case te.AUTHENTICATE_SECONDARY:return{text:M?D:Se.logInButtonText,onClick:()=>{A({authType:M?"signup":"login",callback:V=>{M?R.logSignUpButtonClicked({location:`Rate limit banner - ${a}`,provider:V}):R.logLogInButtonClicked({location:`Rate limit banner - ${a}`,provider:V})}})}};case te.GET_PLUS:return{text:Fe.getPlusButton,onClick:()=>{R.logRateLimitGetPlusButtonClicked(v),B?A({authType:M?"login":"signup",shouldOpenPaymentModalOnAuth:!0,callback:V=>{M?R.logLogInButtonClicked({location:"Rate limit banner Get Plus upsell",provider:V}):R.logSignUpButtonClicked({location:"Rate limit banner Get Plus upsell",provider:V})}}):Vt(_,"Prompt textarea rate limit banner")}};case te.NEW_CHAT:return{text:Fe.newChatButton,onClick:()=>{m({modelId:"",location:S})}};case te.PAID_USER_O3_MINI_HIGH:{const V=se.getCurrentLeafId(be(t)),U=()=>{R.logEventWithStatsig("In Context Upsell Banner O3 Mini High CTA Clicked","chatgpt_in_context_upsell_banner_o3_mini_high_cta_clicked",{location:F.get("should_change_model_picker",!0)?"In-context upsell o3-mini-high for Plus banner - Try it button":"In-context upsell o3-mini-high for Plus (no model switch) banner - Try it button",eventProperties:v}),F.get("should_change_model_picker",!0)&&x({modelId:"o4-mini-high",location:"In-context upsell o4-mini-high for Plus banner - Try it button"}),I({sourceEvent:new Event("click"),nodeId:V,requestedModelId:"o4-mini-high"})};return{text:Fe.tryItButton,onClick:U}}case te.FREE_USER_O3_MINI_HIGH:return{text:Fe.getPlusButton,onClick:()=>{R.logEventWithStatsig("In Context Upsell Banner O3 Mini High CTA Clicked","chatgpt_in_context_upsell_banner_o3_mini_high_cta_clicked",{location:"In-context upsell o3-mini-high for Free banner - Get Plus button",eventProperties:v}),Vt(_,"Prompt textarea in-context upsell banner")}};case te.DEEP_RESEARCH_IN_CONTEXT_UPSELL:{const V=se.findNode(be(t),ae=>Kd(ae.message)),U=V?qd(V.message):void 0;return{text:Fe.tryItButton,onClick:()=>{R.logEventWithStatsig("In Context Upsell Banner Deep Research CTA Clicked","chatgpt_in_context_upsell_banner_deep_research_cta_clicked",{location:"In-context upsell deep research - Try it button",eventProperties:v}),f(T.Research,{clientThreadId:t}),p.focus(),p.setText(U??"")}}}case te.GET_PRO:return{text:Fe.getProButton,onClick:()=>{R.logRateLimitUpgradePlanButtonClicked({...v,upgrade_plan_tye:"pro"}),B?A({authType:M?"login":"signup",shouldOpenPaymentModalOnAuth:!0,callback:V=>{M?R.logLogInButtonClicked({location:"Rate limit banner Get Pro upsell",provider:V}):R.logSignUpButtonClicked({location:"Rate limit banner Get Pro upsell",provider:V})}}):Vt(_,"Prompt textarea rate limit banner")}};case te.TRY_CODEX:return{text:Fe.tryCodexButton,onClick:()=>{R.logEventWithStatsig("In Context Upsell Banner Codex CTA Clicked","chatgpt_in_context_upsell_banner_codex_cta_clicked",{location:"In-context upsell codex - Try Codex button",eventProperties:v}),_("/codex")}};default:return}};la(()=>{!F.get("should_change_model_picker",!0)&&v.type==="o3-mini-high-in-context-upsell-plus"&&(v.type="o3-mini-high-in-context-upsell-plus-no-model-switch"),R.logRateLimitBannerShown(v),r?.()});const[j,E]=i??[];let O=E;j===te.AUTHENTICATE&&k&&(O=te.AUTHENTICATE_SECONDARY);const G=Ge(P,"2861925050");let Y={};if(G&&(j===te.NOTIFY_ADMIN_FOR_CREDITS||j===te.ADD_CREDITS))if(j===te.ADD_CREDITS)Y={customActions:e.jsx(Om,{trigger:"prompt-textarea-rate-limit-banner"})},R.logEventWithStatsig("ChatGPT Credits: Rate Limit Banner Shown - Add Credits","chatgpt_credits_rate_limit_banner_shown_add_credits",{location:S,type:a,plan_type:w,is_new_conversation:y.toString()});else{const Q=Fm(a);Q?j===te.NOTIFY_ADMIN_FOR_CREDITS&&(Y={customActions:e.jsx(Um,{creditConsumingProduct:Q,trigger:"prompt-textarea-rate-limit-banner"})},R.logEventWithStatsig("ChatGPT Credits: Rate Limit Banner Shown - Notify Admin","chatgpt_credits_rate_limit_banner_shown_notify_admin",{location:S,type:a,plan_type:w,is_new_conversation:y.toString()})):bn.addError("RateLimitBanner: notify admin action is not available for this rate limit banner")}else Y={primaryAction:h(j),secondaryAction:h(O)};return e.jsx(qi,{onDismiss:o,title:c,description:l,actions:Y,onInteract:n})},Fe=Pe({getPlusButton:{id:"TeyLcp",defaultMessage:"Get Plus"},getProButton:{id:"Pl8/Vk",defaultMessage:"Get Pro"},newChatButton:{id:"7OvnJ5",defaultMessage:"New chat"},tryItButton:{id:"zPDzun",defaultMessage:"Try it"},tryCodexButton:{id:"KcWniZ",defaultMessage:"Try Codex"}}),Sp=({clientThreadId:t,composerController:s})=>{const o=Fa(),n=Ue(s.store,g=>g.rateLimitBannerFeature),r=Oa(),a=o??hr(n,r),c=Z(t,se.getRequestId),i=Z(t,se.getCurrentLeafId),l=Ua(c),{layer:d}=Re("1368081792"),m=a?.name?()=>{switch(a.name){case"o3-mini-high-in-context-upsell-free":case"o3-mini-high-in-context-upsell-plus":case"deep-research-in-context-upsell":case"deep-research-in-context-upsell-free":case"codex-in-context-upsell":$i(i);break}}:void 0,{value:f}=ze("3612584454");u.useEffect(()=>{l&&!(a?.name==="gpt-4l"&&f)&&(Bo.dismissBanner(),s.setRateLimitBannerFeature(null))},[l,a?.name,f,s]);const p=a?.is_dismissible?()=>{R.logEventWithStatsig("Rate Limit: Dismiss Banner","chatgpt_rate_limit_banner_dismissed",{type:!d.get("should_change_model_picker",!0)&&a?.name==="o3-mini-high-in-context-upsell-plus"?"o3-mini-high-in-context-upsell-plus-no-model-switch":a?.name}),Bo.dismissBanner(),s.setRateLimitBannerFeature(null)}:void 0,x=()=>{switch(a?.name){case"o3-mini-high-in-context-upsell-free":case"o3-mini-high-in-context-upsell-plus":case"deep-research-in-context-upsell":case"deep-research-in-context-upsell-free":case"codex-in-context-upsell":Yi({interactedInPeriod:!0});break}};return e.jsx(nt,{children:a&&e.jsx(ne.div,{transition:{type:"tween",ease:"easeInOut",duration:.1},initial:{opacity:0,transform:"translateY(8px)"},animate:{opacity:1,transform:"translateY(0px)"},exit:{opacity:0,transform:"translateY(8px)"},children:e.jsx(gr,{clientThreadId:t,rateLimitInfo:a,onDismiss:p,onInteract:x,onMount:m})})})};function hr(t,s){const o=s.find(n=>n.name===t);return o?{name:o.name,title:o.title,description:o.description,is_dismissible:!0,call_to_action:o.call_to_action,resets_after:o.resets_after}:null}function yp(t,s,o,n,r,a,c,i,l,d,m,f){if(l||(t.name==="o3-mini-high-in-context-upsell-free"||t.name==="o3-mini-high-in-context-upsell-plus")&&(s.some(S=>S.model_slug==="o3-mini-high")||o.id==="o3-mini-high")||i&&c&&Ts(Date.now(),c)<Mo)return!1;const x=n==null||Ts(Date.now(),n)>=sc,g=r===d,y=c==null||a==null||Ts(Date.now(),c)>=Mo||a<nc;if(!(x&&y||g))return!1;switch(t.name){case"deep-research-in-context-upsell":return m("should_show_deep_research_upsell_banner",!1);case"deep-research-in-context-upsell-free":return m("should_show_deep_research_upsell_banner_free",!1);case"o3-mini-high-in-context-upsell-free":return m("should_show_o3_mini_high_upsell_banner_free_user_to_plus",!1);case"o3-mini-high-in-context-upsell-plus":return m("should_show_o3_mini_high_upsell_banner_plus_user",!1);case"codex-in-context-upsell":return f("should_show_codex_upsell_banner",!1);default:return!1}}function bp(t,s){const o=$d(),n=Qi(t),r=Z(t,se.getRequestId),a=Z(t,se.getCurrentLeafId),c=Ua(r),i=Xi(_=>_.lastSeenInContextUpsellBannerAt),l=Ji(_=>_.inContextUpsellBannerPeriodExposureCount),d=Zi(_=>_.inContextUpsellBannerPeriodStartAt),m=ec(_=>_.inContextUpsellBannerLastSeenId),f=tc(_=>_.inContextUpsellBannerInteractedInPeriod),{layer:p}=Re("1368081792"),{layer:x}=Re("1738106734"),g=Ue(s.store,_=>_.rateLimitBannerFeature),y=he(),w=Ge(y,"2861925050"),k=Fa(),b=Oa(),S=w?k:k??hr(g,b);let v=!1;switch(S?.name){case null:case void 0:v=g!=null;break;case"o3-mini-high-in-context-upsell-free":case"o3-mini-high-in-context-upsell-plus":case"deep-research-in-context-upsell":case"deep-research-in-context-upsell-free":case"codex-in-context-upsell":v=yp(S,o,n,i,m,l,d,f,c,a,p.get,x.get);break;default:v=!0}return!c&&v}const Zt="month",xr="year";function Cp(){const t=Yd(),s=$(),o=at(),{markAsViewed:n}=Ee(oc),{initialBillingDetails:r}=Hm(t,!0),a=u.useMemo(()=>({...t?.subscriptionAnalyticsParams,referrer:document.referrer}),[t]);async function c(){try{await rc(t?.features??[],s,o,r,a)}catch{}}const{shouldShowBanner:i,discountValue:l,discountDuration:d}=ac();if(u.useEffect(()=>{i&&l&&d&&Bs.logShowReferrerRedemptionBanner()},[i,l,d]),!i||!l||!d)return null;const m=vp(s,r,l,d),f=wp(s,r,l,d),p=e.jsxs("div",{className:"grow",children:[e.jsx("div",{className:"mb-0.5 font-semibold",children:m}),e.jsx("span",{className:"text-token-text-secondary",children:f})]});return e.jsx(cn,{onPrimaryCtaClick:()=>{n(),Bs.logClickReferrerRedeemButton(),c()},primaryCtaText:e.jsx(L,{id:"referrerRedemptionBannerPrimaryCta",defaultMessage:"Get Plus"}),onDismiss:()=>{n(),Bs.logCloseReferrerRedemptionBanner()},content:p})}function vp(t,s,o,n){const{currencySymbol:r}=ua(da(),s.currency),a=n?n.period:Zt,c=n?n.num_periods:1,i=r.code.defaultMessage?.toString()??Ha,l=t.formatNumber(o.value,{style:"currency",currency:i,minimumFractionDigits:0,maximumFractionDigits:2});let d;return a===Zt?d=c===1?e.jsx(L,{id:"referrerRedemptionBannerTitleForSingleMonth",defaultMessage:"Your {discount} credit is ready",values:{discount:l}}):e.jsx(L,{id:"referrerRedemptionBannerTitleForPluralMonths",defaultMessage:"Redeem your {discount} referral reward",values:{discount:l}}):a===xr&&(d=c===1?e.jsx(L,{id:"referrerRedemptionBannerTitleForSingleYear",defaultMessage:"Redeem your {discount} referral reward",values:{discount:l}}):e.jsx(L,{id:"referrerRedemptionBannerTitleForPluralYears",defaultMessage:"Redeem your {discount} referral reward",values:{discount:l}})),d}function wp(t,s,o,n){const{currencySymbol:r}=ua(da(),s.currency),a=n?n.period:Zt,c=n?n.num_periods:1,i=r.code.defaultMessage?.toString()??Ha,l=t.formatNumber(o.value,{style:"currency",currency:i,minimumFractionDigits:0,maximumFractionDigits:2});let d;return a===Zt?d=c===1?e.jsx(L,{id:"referrerRedemptionBannerContentForSingleMonth",defaultMessage:"Your referral link was used — claim your free month of Plus."}):e.jsx(L,{id:"referrerRedemptionBannerContentForPluralMonths",defaultMessage:"Your referral link earned you {discount} off {num_months} months of Plus.",values:{discount:l,num_months:c}}):a===xr&&(d=c===1?e.jsx(L,{id:"referrerRedemptionBannerContentForSingleYear",defaultMessage:"Your referral link earned you {discount} off a year of Plus.",values:{discount:l}}):e.jsx(L,{id:"referrerRedemptionBannerContentForPluralYears",defaultMessage:"Your referral link earned you {discount} off {num_years} years of Plus.",values:{discount:l,num_years:c}})),d}const Xs=window.sessionStorage,Js=Qd(Xd(()=>({memoryFullBannerDismissed:!!Xs?.getItem(je.MemoryFullBannerDismissed)}))),Sr={dismissBanner(){Js.setState(t=>{t.memoryFullBannerDismissed=!0}),Xs?.setItem(je.MemoryFullBannerDismissed,"true")},clearDismissedBanner(){Js.setState(t=>{t.memoryFullBannerDismissed=!1}),Xs?.removeItem(je.MemoryFullBannerDismissed)}};function _p(t){const s=Ga(t),o=uc(),{data:n}=dc(s,!1,o),r=n!=null,a=r&&n.memoryFullPct>=100,[c,i]=u.useState(!1);u.useEffect(()=>{!a&&r&&(i(!0),Sr.clearDismissedBanner())},[a,r]);const l=Js(d=>d.memoryFullBannerDismissed);return a&&c&&!l}function kp(){const t=$(),{openSettings:s}=ic();return e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},children:e.jsx(cn,{title:t.formatMessage(zt.memoryFullTitle),content:t.formatMessage(zt.memoryFullTooltip,zt.memoryFullTooltip.values),primaryCtaText:t.formatMessage(zt.memoryManageButton),onPrimaryCtaClick:()=>s(cc.Personalization),onDismiss:()=>Sr.dismissBanner()})})}const zt=Pe({memoryFullTitle:{id:"i1hV1R",defaultMessage:"ChatGPT's out of space for saved memories"},memoryManageButton:{id:"a5A88o",defaultMessage:"Manage"},memoryFullTooltip:{id:"Rs+Att",defaultMessage:"New memories won’t be added until you make space. <a>Learn more</a>",values:{a:t=>e.jsx("a",{href:lc,target:"_blank",rel:"noopener noreferrer",className:"underline",children:t})}}}),Mp=Cn(()=>vn(()=>import("./mqq8wh7vlbjssba0.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(t=>t.JawboneNotificationsBanner)),yr=u.memo(function({className:s}){const{store:o}=de(),n=o.useIsHeaderContentAreaPopulated();return e.jsx("div",{className:K(s??"absolute start-0 end-0 bottom-full",pc.PromptTextareaHeader),children:e.jsx(mc,{shouldRender:n,contentArea:yt.Header,children:e.jsxs("div",{className:"mb-2 flex flex-col gap-3.5 pt-2",children:[e.jsx(jp,{}),e.jsx(Ap,{})]})})})});function jp(){const{store:t}=de(),s=t.useSharedProps(i=>i?.clientThreadId),o=t.useContentAreaId(yt.HeaderTop),n=fc(),r=Z(s,i=>i?.modelId),a=gc.useStore();let c;switch(o){case N.ProjectConversationTaskNoFileAccess:c=e.jsx(Np,{});break;case N.AdvancedVoiceOnMobileAnnouncement:c=e.jsx(Nc,{clientThreadId:s});break;case N.S09KM1:c=null;break;case N.BannerSignup:c=e.jsx(Ep,{});break;case N.BannerTermsDisclaimer:c=e.jsx(Tp,{});break;case N.PromptTextareaAction:c=e.jsx(Bp,{});break;case N.BannersRateLimit:c=e.jsx(Lp,{});break;case N.BannerSidekickAnnouncement:c=e.jsx(Ec,{});break;case N.SearchBrowserExtensionAnnouncement:c=e.jsx(Pc,{});break;case N.MoonshineAnnouncement:c=e.jsx(Rc,{});break;case N.CustomizeChatGPTAnnouncement:c=e.jsx(Ac,{});break;case N.SearchBrowserExtensionReactiveAnnouncement:c=e.jsx(jc,{});break;case N.BannerMemoryFull:c=e.jsx(kp,{});break;case N.Box:c=e.jsxs("div",{id:"Box",className:"flex h-20 w-full items-center justify-center gap-2 bg-red-500 p-2",children:["box",e.jsxs("div",{className:"flex h-full w-full items-center justify-center gap-2 bg-blue-500 p-2",children:["inner",e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-yellow-400 text-center",children:"actual content"})]})]});break;case N.JawboneAnnouncement:n?c=e.jsx(Mp,{}):c=null;break;case N.JawboneMaxActiveAnnouncement:n?c=e.jsx(Mc,{}):c=null;break;case N.PromoRedemptionAnnouncement:c=e.jsx(Em,{});break;case N.OperatorAnnouncement:c=e.jsx(kc,{});break;case N.BannerPlusUpsell:c=e.jsx(_c,{});break;case N.ContextualAnswersAdminUpsell:c=e.jsx(wc,{});break;case N.ContextualAnswersUserUpsell:c=e.jsx(vc,{});break;case N.ReferrerRedemptionAvailableAnnouncement:c=e.jsx(Cp,{});break;case N.RefereeRedemptionAvailableAnnouncement:c=e.jsx(Cc,{});break;case N.ReferralProgramUpsellAnnouncement:c=e.jsx(bc,{});break;case N.TatertotIntakeFormAnnouncement:c=!1;break;case N.StudentsUpsellAnnouncement:c=e.jsx(yc,{});break;case N.ModelDeprecationBanner:c=Sc(r);break;case N.TeamsContextualAnswersUpsell:c=e.jsx(xc,{});break;case N.KanziConfig:c=!1;break;case N.LanguageUpsellBanner:c=e.jsx(hc,{onDismissSideEffect:()=>{R.logEventWithStatsig("Language Upsell Banner Dismissed","chatgpt_web_language_upsell_banner_dismissed"),a.closeBanner()},onPrimaryCtaClickSideEffect:()=>{R.logEventWithStatsig("Language Upsell Banner Primary CTA Clicked","chatgpt_web_language_upsell_banner_primary_cta_clicked"),a.closeBanner()}});break;default:c=null;break}return c}function Ap(){const{store:t}=de(),s=t.useContentAreaId(yt.HeaderBottom);let o;switch(s){case ma.DallePromptControls:o=e.jsx(Pp,{});break;default:o=null;break}return o}const Rp=Cn(()=>vn(()=>import("./j52n6j7c5egw4qys.js"),__vite__mapDeps([7,1,2,3,4,5])).then(t=>t.default));function Pp(){const{store:t}=de(),s=t.useSharedProps(o=>o?.composerController);return s?e.jsx(Rp,{composerController:s}):null}function Ep(){const{store:t}=de(),s=t.useSharedProps(r=>r?.clientThreadId),o=es(),n=Bc();return s?o?e.jsx(Lc,{threadId:s,showSignUp:n}):e.jsx(Dc,{threadId:s,showLogin:n}):null}function Np(){return u.useEffect(()=>()=>{qt.getItem(je.TasksHasSeenProjectDisclaimerBanner)||qt.setItem(je.TasksHasSeenProjectDisclaimerBanner,!0)},[]),e.jsx(cn,{icon:e.jsx(Ic,{}),title:e.jsx(L,{id:"ibX3g7",defaultMessage:"Tasks can’t access project files"}),content:e.jsx(L,{id:"fm94Tm",defaultMessage:"There’s a task in this conversation — just FYI, it won’t be able to access project files."}),onDismiss:()=>{qt.setItem(je.TasksHasSeenProjectDisclaimerBanner,!0)}})}function Tp(){const{store:t}=de(),s=t.useSharedProps(o=>o?.clientThreadId);return s?e.jsx(Tc,{threadId:s}):null}function Bp(){const{store:t}=de(),s=t.useSharedProps();return s?e.jsx(gp,{...s}):null}function Lp(){const{store:t}=de(),s=t.useSharedProps(n=>n?.clientThreadId),o=t.useSharedProps(n=>n?.composerController);return!s||!o?null:e.jsx(Sp,{clientThreadId:s,composerController:o})}const Dp="https://persistent.oaistatic.com/image-gen/nux.222e584e.mp4",kn=()=>Hc(je.HasSeenNoAuthImagegenNux,!1,Gc),Mg=()=>{const{isUnauthenticated:t}=ve(),s=Fc(),[o]=kn(),n=Gm(),r=he(),a=Ia(r,"2118136551");return!t||s||o||n?"hide":a.get("should_show_imagegen_nux",!1)?"show":"hide"},jg=({onClose:t})=>{const o=Oc()?"bottom":"center",n=sn(),[r,a]=u.useState(!1),c=he(),i=cs(c,"2604379743").value,l=typeof i.nux_video_url=="string"?i.nux_video_url:Dp,d=typeof i.nux_image_url=="string"?i.nux_image_url:"",[,m]=kn(),f=()=>{m(!0),qt.setItem(je.HasSeenNoAuthImagegenNux,!0)},p=es(),{layer:x}=Re("2118136551"),g=x.get("sign_up_button_has_the_word_free",!0),y=en(g?Uc.signUpForFreeCta:Se.signUpButtonText),w=e.jsx(ye,{as:"button",size:"large",color:p?"secondary":"primary",onClick:()=>{f(),n({authType:"signup",callback:S=>{R.logSignUpButtonClicked({provider:S,location:"No Auth Imagegen Nux Modal"})}})},fullWidth:!0,children:e.jsx(L,{...y})}),k=e.jsx(ye,{as:"button",size:"large",color:p?"primary":"secondary",fullWidth:!0,onClick:()=>{f(),n({authType:"login",callback:S=>{R.logLogInButtonClicked({provider:S,location:"No Auth Imagegen Nux Modal"})}})},children:e.jsx(L,{...Se.logInButtonText})}),b=()=>{t(),f(),R.logEventWithStatsig("chatgpt_no_auth_imagegen_nux_modal_dismissed","chatgpt_no_auth_imagegen_nux_modal_dismissed")};return u.useEffect(()=>{R.logEventWithStatsig("chatgpt_no_auth_imagegen_nux_modal_shown","chatgpt_no_auth_imagegen_nux_modal_shown")},[]),e.jsxs(za,{testId:"modal-no-auth-imagegen-nux",isOpen:!0,noPadding:!0,onClose:b,showCloseButton:!1,size:"custom",type:"success",className:"max-w-lg",position:o,children:[e.jsxs("div",{className:"relative aspect-3/2 w-full",children:[!r&&e.jsx("img",{src:d,alt:"",className:"absolute inset-0 h-full w-full object-cover object-bottom transition-opacity duration-300"}),e.jsx("video",{src:l,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"h-full w-full object-cover object-bottom",onLoadedData:()=>a(!0)}),e.jsx("div",{className:"absolute end-4 top-4",children:e.jsx($s,{onClick:b})})]}),e.jsxs("div",{className:"flex flex-col gap-2 px-8 pt-6 pb-8 text-center",children:[e.jsx("div",{className:"text-xl font-medium",children:e.jsx(L,{id:"OxVK72",defaultMessage:"Bring your ideas to life with images"})}),e.jsx("div",{className:"text-token-text-secondary w-full",children:e.jsx(L,{id:"bVWvdX",defaultMessage:"Create a free account to make illustrations, charts, comics, and more."})}),e.jsx("div",{className:"mt-4 mb-2 flex w-full flex-col gap-3",children:p?[k,w]:[w,k]}),e.jsx(ye,{color:"ghost",className:"text-token-text-secondary font-semibold underline hover:bg-transparent",onClick:b,children:e.jsx(L,{...Se.stayLoggedOut})})]})]})},Ip="https://persistent.oaistatic.com/image-gen/nux.222e584e.mp4",Fp="https://help.openai.com/en/articles/8932459",Ag=()=>{const{isLoading:t,eligible:s}=Ee(Ce.hasSeenShibaHomeNux),{isUnauthenticated:o}=ve(),[n]=kn(),a=Ve()?.isQuorum(),{value:c}=ze("2781425969");return o||!c||n||a?"hide":t?"loading":s?"show":"hide"};function br(t){return[{title:t.formatMessage({id:"er580q",defaultMessage:"Create an image of a magazine cover of cute animals with headlines and text"}),body:"",type:fe.Autocomplete,prompt:t.formatMessage({id:"SKZKBN",defaultMessage:"Create an image of a photorealistic magazine cover for 'CUTE ANIMALS,' featuring three impossibly cute and stylishly accessorized pets, with realistic, catchy headlines and teaser text"}),theme:Ut.Image},{title:t.formatMessage({id:"ukPFbH",defaultMessage:"Create an image for a garden-themed birthday party invitation"}),body:"",type:fe.Autocomplete,prompt:t.formatMessage({id:"uYg5kL",defaultMessage:"Create an image of a colorful invitation for a garden-themed birthday party, including whimsical typography"}),theme:Ut.Image},{title:t.formatMessage({id:"mMiJxP",defaultMessage:"Create an image of an astronaut with an inflatable duck on Mars"}),body:"",type:fe.Autocomplete,prompt:t.formatMessage({id:"5nFWh4",defaultMessage:"Create a photorealistic image of an international astronaut on Mars, wearing a giant duck inflatable toy around its waist"}),theme:Ut.Image},{title:t.formatMessage({id:"+T7POI",defaultMessage:"Create an image of a tutorial for cooking pasta"}),body:"",type:fe.Autocomplete,prompt:t.formatMessage({id:"9N2bJ0",defaultMessage:"Create an image of a comic-book style tutorial for cooking pasta"}),theme:Ut.Image}]}const Rg=({onClose:t,clientThreadId:s})=>{const{markAsViewed:o}=Ee(Ce.hasSeenShibaHomeNux),n=We(),r=Zs(),a=Jd("2604379743").config.value,c=typeof a.nux_video_url=="string"?a.nux_video_url:Ip,i=typeof a.nux_image_url=="string"?a.nux_image_url:"",[l,d]=u.useState(!1),m=zc(n,s),{activeSystemHints:f}=os(s),p=f.find(k=>k.systemHint===T.PictureV2);u.useEffect(()=>{R.logEventWithStatsig("chatgpt_imagegen_nux_modal_shown","chatgpt_imagegen_nux_modal_shown")},[]);const x=$(),g=br(x),y=()=>{o(),t(),R.logEventWithStatsig("chatgpt_imagegen_nux_modal_dismissed","chatgpt_imagegen_nux_modal_dismissed")},w=()=>{o(),t(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{p&&m({hint:p,enable:!0}),n.focus()})}),n.setAutocompletions(g)};return e.jsx(e.Fragment,{children:e.jsxs(za,{testId:"modal-imagegen-nux",isOpen:!0,noPadding:!0,onClose:Zd,shouldIgnoreClickOutside:!0,showCloseButton:!1,size:"custom",type:"success",className:"max-w-lg",children:[e.jsxs("div",{className:"relative aspect-3/2 w-full",children:[!l&&e.jsx("img",{src:i,alt:"",className:"absolute inset-0 h-full w-full object-cover object-bottom transition-opacity duration-300"}),e.jsx("video",{src:c,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"h-full w-full object-cover object-bottom",onLoadedData:()=>d(!0)})]}),e.jsxs("div",{className:"flex flex-col gap-2 px-8 pt-6 pb-6 text-center",children:[e.jsx("div",{className:"text-xl font-medium",children:e.jsx(L,{id:"KgZP2O",defaultMessage:"Image creation just got better"})}),e.jsx("div",{className:"text-token-text-secondary w-full",children:e.jsx(L,{id:"/oguus",defaultMessage:"ChatGPT now thinks a little longer to make more accurate and detailed images. <link>Learn more</link>",values:{link:k=>e.jsx("a",{href:Fp,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 no-underline",children:k})}})}),e.jsx("div",{className:"mt-2 w-full text-xs text-[#8F8F8F] dark:text-[#C4C4C4]",children:e.jsx(L,{id:"6pIXUv",defaultMessage:"You must have permission to edit images you upload, including consent from any people in them."})}),e.jsxs("div",{className:"mt-4 flex w-full gap-3",children:[e.jsx(ye,{color:"secondary",onClick:y,className:"flex-1",children:e.jsx(L,{id:"6nf9tD",defaultMessage:"Not now"})}),e.jsx(ye,{color:"primary",onClick:()=>{w(),r("/?model=gpt-4o"),R.logEventWithStatsig("chatgpt_imagegen_nux_modal_continued","chatgpt_imagegen_nux_modal_continued")},className:"flex-1",children:e.jsx(L,{id:"ms5BU0",defaultMessage:"Try it"})})]})]})]})})};function Op({suggestions:t,composerController:s,onSelect:o,onChange:n}){const r=Zo(),a=u.useCallback((p,x,g,y)=>{o?.(x,g,y),r(p,x,g,y)},[o,r]),[c,i]=u.useState(()=>t.length>0),[l,d]=u.useState(-1),[m,f]=u.useState(!1);return u.useEffect(()=>{const p=x=>{if(!x.isComposing)if(x.key==="ArrowDown"){const g=l===t.length-1?0:l+1;d(g),n?.(g,!0,t[g])}else if(x.key==="ArrowUp"){x.preventDefault();const g=l<=0?t.length-1:l-1;d(g),n?.(g,!0,t[g])}else x.key==="Enter"&&!x.shiftKey&&t[l]&&a(x,t[l],t,l)};return s.subscribe("keydown",p)},[t,l,n,a,s]),u.useEffect(()=>s.subscribe("blur",()=>{d(-1),i(!1),n?.(-1,!1)}),[s,n]),u.useEffect(()=>s.subscribe("focus",()=>i(!0)),[s]),u.useEffect(()=>{if(!m){const p=()=>{f(!0),window.removeEventListener("mousemove",p)};return window.addEventListener("mousemove",p),()=>{window.removeEventListener("mousemove",p)}}},[m]),u.useEffect(()=>{d(-1),n?.(-1,!1),f(!1)},[t,n]),e.jsx(ne.ul,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:K("w-full flex-col p-2.5 max-lg:flex-col-reverse",c?"flex":"hidden"),children:t.map((p,x)=>e.jsxs(ne.li,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:x*.03},exit:{opacity:0,translateY:4},className:"w-full",children:[x>0&&e.jsx("div",{className:K("h-[1px] opacity-60 max-lg:hidden",l===x||l===x-1?"bg-token-main-surface-secondary mx-2":"bg-token-border-default")}),e.jsxs("button",{className:K("flex w-full cursor-pointer items-center justify-start rounded-lg px-2.5 py-3 text-start whitespace-pre-wrap",l===x?"bg-token-main-surface-secondary":"bg-token-main-surface-primary"),onClick:g=>{g.preventDefault(),a(g,p,t,x)},onMouseDown:g=>{g.preventDefault()},onMouseEnter:()=>{m&&(d(x),n?.(x,!1,p))},onMouseLeave:()=>{d(-1),n?.(-1,!1,p)},children:[p.icon?e.jsx("span",{className:"text-token-text-secondary me-2 h-[18px] w-[18px] flex-none",children:p.icon}):null,e.jsx("span",{className:"text-sm whitespace-pre-wrap",children:p.autocompletionChunks&&p.autocompletionChunks.length>0?e.jsx(e.Fragment,{children:p.autocompletionChunks.map((g,y)=>e.jsx("span",{className:K(g.className??(g.isMatched?"text-token-text-tertiary":"text-token-text-primary")),children:g.text},y))}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:K(p.type===fe.Starter||p.type===fe.Trending?"text-token-text-secondary":"text-token-text-tertiary"),children:p.title}),e.jsx("span",{className:"text-token-text-primary",children:p.body})]})})]}),x>0&&e.jsx("div",{className:K("h-[1px] opacity-60 lg:hidden",l===x||l===x-1?"bg-token-main-surface-secondary mx-2":"bg-token-border-default")})]},p.id??x))})}function Up(t,s){t=t.toLocaleLowerCase();const o=s;s=s.toLocaleLowerCase();const n=[];let r=0;for(let i=0;i<s.length&&(r<t.length&&t[r]===s[i]&&(n.push(i),r++),r!==t.length);i++);const a=[];let c=0;if(n.forEach(i=>{if(i>c){const l=o.slice(c,i);l&&a.push({text:l,isMatched:!1})}a.push({text:o[i],isMatched:!0}),c=i+1}),c<s.length){const i=o.slice(c);i&&a.push({text:i,isMatched:!1})}return Hp(a)}function Hp(t){if(t.length===0)return t;const s=[t[0]];for(let n=1;n<t.length;n++){const r=s[s.length-1],a=t[n];r.isMatched===a.isMatched?r.text+=a.text:s.push(a)}const o=s.filter(n=>n.isMatched).reduce((n,r)=>n+r.text.trim().length,0);return s.length<=4&&o>=2?s:[{text:s.map(n=>n.text).join(""),isMatched:!1}]}async function Gp(t=8,s=null){const o=await sm.safeGet("/prompt_library/",{parameters:{query:{limit:t,use_v2:!0,model_slug:s}},authOption:nm.SendIfAvailable});return bn.addFirstTiming("load.promptStarters"),o}function zp(t=8,s=null){return Ei({queryKey:["promptStarters",t,s],queryFn:()=>Gp(t,s)})}function Wo(t){return(Wc(t)?t.promptStarters:t.gizmo.display.prompt_starters)?.map(s=>({type:fe.Starter,title:"",body:s,prompt:s}))}const Wp=()=>{const t=he(),s=em(t),o=pa(),n=Kc(qc),r=yn(t),a=r?s.getLayer("4031588851"):s.getLayer("3533083032"),c=r?s.getLayer("4031588851",{disableExposureLog:!0}):s.getLayer("3533083032",{disableExposureLog:!0});return r?o==null?!1:Date.now()/1e3-o.created<c.get("new-user-age-seconds",14*24*60*60)&&a.get("web-enable-for-new-users",!1):n<c.get("new-user-message-count",20)&&a.get("web-enable-for-new-users",!1)},Cr=({clientThreadId:t,limit:s,shouldBeEnabledForDefaultAssistant:o,isModelLoaded:n,modelSlug:r})=>{const a=We(),c=Wa(),i=$(),{clearAllSystemHintModeTriggers:l}=ge(),d=Z(t,M=>M?.mode),m=ln(d?.kind===Ae.GizmoInteraction?d.gizmo_id:void 0).data,{gizmoEditorData:f,mode:p}=ns(),x=Wp(),g=Vc(d),y=Ve(),w=x&&o&&!g&&!y?.isEnterprisey(),{data:k,isSuccess:b}=Pi({...zp(s,r),enabled:w});if(c==null)return{promptStarters:[],isLoading:!0,isSuccess:!1};if(p==="test"&&f)return{promptStarters:Wo(f)??[],isLoading:!1,isSuccess:!0};if(m!=null)return{promptStarters:Wo(m),isLoading:!1,isSuccess:!0};if(!w)return{promptStarters:[],isLoading:!1,isSuccess:!0};const S=k?.items.map(M=>({type:fe.Starter,id:M.id,title:M.title,body:M.description,prompt:M.prompt,category:M.category,oneliner:M.oneliner,theme:M.theme,requires_file_upload:M.requires_file_upload}))??[],v=(M,D,I,F)=>{if(D.type===fe.Starter&&D.category==="dalle"){requestAnimationFrame(()=>{l(),a.addSystemHint(T.PictureV2,i.formatMessage({id:"rh3NHv",defaultMessage:"Create image"})),a.focus()}),a.setAutocompletions(br(i));return}const h=D.title;a.setAutocompletions([]),a.focus(),a.setText(h),requestAnimationFrame(()=>{const j=S.filter(E=>E.theme===D.theme).map(E=>{const O=tm(E.oneliner),G=O.startsWith(E.title);return{...E,title:G?`${E.title} `:"",body:G?E.body:O,autocompletionChunks:Up(h,O),type:fe.Autocomplete}});a.setAutocompletions(j),j.length>0&&Vs(j,t),$c(D,F,t)})},_=S?.reduce((M,D)=>(D.theme&&!M[D.theme]&&(M[D.theme]=D),M),{}),A=[];if(_)for(const M in _)M!=="For you"&&A.push(_[M]);const P=A.length>0,B=!!(b&&P&&n);return st.markStart("StarterPromptChips",st.NS_COMPOSER),B&&st.markRendered("StarterPromptChips",st.NS_COMPOSER),{onSelectStarterPrompt:v,shouldShowStarterPrompts:B,promptStarters:A}};function Vo({clientThreadId:t,onClick:s}){u.useEffect(()=>{Jc(t)},[t]);const o=$();return e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},className:"inline-block",children:e.jsx(fa,{onClick:()=>{Zc(t),s()},label:o.formatMessage(Yp.moreStarterPrompts)})})}function Vp({starterPrompt:t,starterPrompts:s,index:o,disabled:n,onSelectStarterPrompt:r}){const a=t.theme??t.title,c=Zo(),{mutate:i}=Qc(),l=t.category==="onboarding"?d=>{i({key:Ce.hasUsedConversationalOnboardingStarterPrompt}),c(d,t,s,o)}:d=>r?.(d,t,s,o);return e.jsx(fa,{disabled:n,onClick:l,icon:e.jsx(Xc,{category:t.category,useV2Colors:!0}),label:a})}const Kp=5,qp=3;function vr({starterPrompts:t,onSelectStarterPrompt:s,disabled:o,clientThreadId:n,onExpand:r,mobileLayout:a=!1}){const c=a?qp:Kp,[i,l]=u.useState(c),[d,m]=u.useState(!1),f=u.useRef(null),p=t.length<=i;u.useEffect(()=>{Vs(t.slice(0,c),n)},[n]),u.useEffect(()=>{if(!d&&!p&&f.current){const g=f.current,y=g.getBoundingClientRect(),w=y.width,k=Array.from(g.children);let b=0;for(let S=0;S<k.length&&k[S].getBoundingClientRect().right-y.left<=w;S++)b++;l(b),m(!0)}},[t,p,d]);const x=()=>{const g=t.slice(i,t.length).map(y=>({...y,isAdditional:!0}));g.length>0&&Vs(g,n),l(t.length),r()};return e.jsxs("div",{"data-testid":"starter-prompt-chips",className:K("mt-5 flex items-center justify-center gap-x-2 transition-opacity xl:gap-x-2.5",d&&t.length>0?"opacity-100":"opacity-[0.01]",a?"flex-wrap":"flex-nowrap"),children:[e.jsxs("ul",{className:K("relative flex items-stretch gap-x-2 gap-y-4 overflow-hidden py-2 sm:gap-y-2 xl:gap-x-2.5 xl:gap-y-2.5",p||a?"flex-wrap justify-center":"flex-nowrap justify-start"),ref:f,children:[t.slice(0,i).map((g,y)=>e.jsx(ne.li,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},children:e.jsx(Vp,{starterPrompt:g,starterPrompts:t,index:y,disabled:o,onSelectStarterPrompt:s})},g.id??y)),a&&t.length>i&&e.jsx(Vo,{clientThreadId:n,onClick:x})]}),!a&&t.length>i&&e.jsx(Vo,{clientThreadId:n,onClick:x})]})}const Pg=({clientThreadId:t,currentModelId:s,isModelLoaded:o})=>{const[n,r]=u.useState(!1),a=wn(),{prospectiveModelId:c}=un(t),i=o?s:c??"auto",{promptStarters:l,shouldShowStarterPrompts:d,onSelectStarterPrompt:m}=Cr({isModelLoaded:o,shouldBeEnabledForDefaultAssistant:!0,clientThreadId:t,limit:8,modelSlug:i});return e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:K(!n&&"h-[116px]"),children:d&&l&&e.jsx(vr,{starterPrompts:l,onSelectStarterPrompt:m,disabled:a,clientThreadId:t,onExpand:()=>r(!0),mobileLayout:!0})})},$p=({currentModelId:t,clientThreadId:s,isModelLoaded:o})=>{const{isUnauthenticated:n}=ve(),[r,a]=u.useState(!1),c=Yc(),i=wn(),{prospectiveModelId:l}=un(s),d=o?t:l??"auto",{promptStarters:m,shouldShowStarterPrompts:f,onSelectStarterPrompt:p}=Cr({isModelLoaded:o,shouldBeEnabledForDefaultAssistant:!0,clientThreadId:s,limit:8,modelSlug:d});return e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:K("hidden min-h-[108px] max-w-full",c?"@lg/thread:block":"lg:block",n&&r?"":"h-[70px]"),children:f&&m&&e.jsx(vr,{starterPrompts:m,onSelectStarterPrompt:p,disabled:i,clientThreadId:s,onExpand:()=>a(!0)})})},Yp=Pe({moreStarterPrompts:{id:"SplashScreenV2.moreStarterPrompts",defaultMessage:"More"}}),Ko=Sn.div`m-8 flex flex-col items-center`;function qo(t){return e.jsx(ne.div,{initial:{opacity:0,translateY:20},animate:{opacity:1,translateY:0,transition:{duration:.5,ease:"easeIn"}},...t})}function Qp({clientThreadId:t}){const o=Z(t,r=>r?.promptGptRating)?.gizmoId,{data:n}=ln(o);return o==null||n==null||!el(n)?null:e.jsx(Xp,{gizmoId:o})}function Xp({gizmoId:t}){const[s,o]=u.useState(!1),[n,r]=u.useState(!1),a=tl(t),c=async l=>{o(!0),setTimeout(()=>{r(!0)},5e3),R.logEvent("Submit Inline Rating",{gizmo_id:t,rating:l}),await a.mutateAsync({rating:l})},i=async()=>{r(!0),R.logEvent("Dismiss Inline Rating",{gizmo_id:t}),await a.mutateAsync({})};return u.useEffect(()=>{n||R.logEvent("Show Inline Rating",{gizmo_id:t})},[n,t]),n?null:s?e.jsx(Ko,{children:e.jsxs(qo,{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"border-token-border-heavy rounded-lg border p-4",children:e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(L,{id:"gizmo.inlineReview.reviewLeft",defaultMessage:"Feedback sent"}),e.jsx($s,{onClick:()=>{r(!0)}})]})}),e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(L,{id:"gizmo.inlineReview.reviewLeftSubtext",defaultMessage:'To update your rating, click "Send Feedback" in the GPT Menu'})})]})}):e.jsx(Ko,{children:e.jsxs(qo,{className:"border-token-border-heavy flex flex-col items-center gap-4 rounded-lg border p-4",children:[e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(L,{id:"gizmo.inlineReview.prompt",defaultMessage:"How would you rate this GPT so far?"}),e.jsx($s,{onClick:i})]}),e.jsx(sl,{rating:void 0,onRating:c})]})})}const wr=Sn.div`group flex h-10 items-center gap-2 rounded-lg px-2 hover:bg-token-main-surface-secondary text-sm text-token-text-primary`;function Jp(){const{data:t,isLoading:s}=al({cutId:"recent",limit:8}),{data:o,isLoading:n}=rl();return{isLoading:s||n,recent:t,pinned:o}}function Zp({query:t,onSelectGizmo:s,selectedIdx:o},n){const r=nl(),a=u.useRef([]),{isLoading:c,recent:i,pinned:l}=Jp();u.useImperativeHandle(n,()=>({handleEnterOnIndex:f=>{if(!m[f])return f<d.length?d[f].resource:"create"},getResultsLength:()=>d.length+1,scrollToItem:f=>{const p=a.current[f];p&&p.scrollIntoView({behavior:"instant",block:"nearest"})}}));let d=[];if(c)return e.jsx("div",{className:"absolute end-4 top-0 flex h-full items-center justify-center",children:e.jsx(_n,{})});i&&d.push(...i.pages.flatMap(f=>f.list.items).map(f=>({resource:f.resource,from:"recent"}))),l&&d.push(...l.items.map(f=>({resource:f,from:"pinned"}))),d=ol(d,f=>f.resource.gizmo.id);const m=d.map(f=>f.resource.gizmo.tags?.includes(as.WorkspaceDisabled));return t&&t!==""&&(d=d.filter(f=>(f.resource.gizmo.display.name.toLowerCase()+f.resource.gizmo.display.description?.toLowerCase()+f.resource.gizmo.author.display_name?.toLowerCase()).includes(t?.toLowerCase()))),e.jsxs("div",{className:"max-h-40 overflow-y-auto",children:[d.map((f,p)=>e.jsx("div",{ref:x=>{a.current[p]=x},tabIndex:p,onClick:()=>{m[p]||s(f.resource)},children:e.jsx(nf,{gizmoResource:f.resource,from:f.from,showDescription:r,isSelected:o===p,grayedOut:m[p]})},f.resource.gizmo.id)),e.jsx("div",{ref:f=>{a.current[d.length]=f},tabIndex:d.length,onClick:()=>{s("create")},children:e.jsx(tf,{isSelected:o===d.length})},"create")]})}const ef=u.forwardRef(Zp),tf=({isSelected:t})=>e.jsx(wr,{className:t?"bg-token-main-surface-secondary":"",children:e.jsxs(Ni,{to:"/gpts/editor",target:"_blank",className:"flex flex-row space-x-2 font-semibold",children:[e.jsx("span",{className:"self-center",children:e.jsx(ga,{className:"icon-sm"})}),e.jsx("span",{children:e.jsx(L,{..._r.dropdownCreateLabel})})]})}),sf=({onClick:t,onClose:s})=>{const[o,n]=u.useState(null),r=u.useRef(null),a=u.useRef(null),[c,i]=u.useState(0),l=$(),d=m=>{R.logEvent("Mentions Click Gizmo",{gizmo_id:m==="create"?"create":m.gizmo.id}),m!=="create"&&t(m)};return e.jsxs(e.Fragment,{children:[e.jsx("input",{autoFocus:!0,placeholder:l.formatMessage(_r.searchPlaceholder),ref:r,onKeyDown:m=>{if(m.nativeEvent.isComposing)return;const f=a.current?.getResultsLength()??0;if((m.key==="Escape"||m.key==="Backspace"&&!o)&&(m.preventDefault(),s()),m.key==="Enter"||m.key==="Tab"){m.preventDefault();const p=a.current?.handleEnterOnIndex(c);if(!p)return;p==="create"?(window.open("/gpts/editor","_blank"),s()):d(p)}if(m.key==="ArrowDown"&&c<f-1){m.preventDefault();const p=c+1;a.current?.scrollToItem(p),i(p)}if(m.key==="ArrowUp"&&c>0){m.preventDefault();const p=c-1;a.current?.scrollToItem(p),i(p)}},onChange:m=>{n(m.target.value),i(0)},className:"bg-token-main-surface-primary w-full border-0 p-2 text-sm focus:outline-hidden"}),e.jsx(ef,{ref:a,query:o,selectedIdx:c,onSelectGizmo:d})]})},$o=({onClick:t,onClose:s})=>{const o=Va(),n=!!o;return la(()=>{R.logEvent("Mentions Opened",{gizmo_selector_disabled:n})}),n?e.jsx(gr,{clientThreadId:Ys,rateLimitInfo:o}):e.jsx("div",{onBlur:r=>{r.currentTarget.contains(r.relatedTarget)||s()},className:"popover border-token-border-default bg-token-main-surface-primary rounded-2xl border p-2 shadow-lg",children:e.jsx(sf,{onClick:t,onClose:s})})};function nf({gizmoResource:t,from:s,showDescription:o,isSelected:n,grayedOut:r}){const a=!!t.gizmo.tags?.includes(as.FirstParty);return e.jsxs(wr,{className:K(n?"bg-token-main-surface-secondary":"",r&&"opacity-50"),children:[e.jsx(ar,{isFirstParty:a,src:t.gizmo.display.profile_picture_url,className:K("icon-xl h-7 w-7 shrink-0",r&&"grayscale group-hover:grayscale-0")}),e.jsxs("div",{className:"flex h-fit grow flex-row justify-between space-x-2 overflow-hidden text-ellipsis whitespace-nowrap",children:[e.jsxs("div",{className:"flex flex-row space-x-2",children:[e.jsx("span",{className:"shrink-0 truncate font-semibold",children:t.gizmo.display.name}),o&&e.jsx("span",{className:"text-token-text-tertiary grow truncate text-sm sm:max-w-xs lg:max-w-md",children:t.gizmo.display.description})]}),e.jsx("span",{className:"shrink-0 self-center",children:s==="recent"?e.jsx(il,{className:"icon-sm"}):e.jsx(cl,{className:"icon-sm"})})]})]})}const _r=Pe({talkingTo:{id:"TaggingDropdown.talkingTo",defaultMessage:"Talking to"},dropdownCreateLabel:{id:"TaggingDropdown.dropdownCreateLabel",defaultMessage:"Create a GPT"},searchPlaceholder:{id:"TaggingDropdown.searchPlaceholder",defaultMessage:"Search recent and pinned GPTs"}}),Mn=({as:t="div",children:s,isSelected:o=!1,...n})=>{const r=t==="div"?ne.div:ne.button;return e.jsx(r,{"data-is-selected":o||void 0,"data-pill":!0,className:"composer-btn",...n,children:s})};function of({systemHints:t,composerController:s,clientThreadId:o}){const n=ha(s),r=t.find(({systemHint:i})=>i===n),{isUnauthenticated:a}=ve(),{setThreadSystemHintMode:c}=ge();return u.useEffect(()=>{n&&!t.some(({systemHint:i})=>i===n)&&!a&&c(n,!1,{clientThreadId:o})},[o,c,n,t,a]),r?e.jsxs("div",{"data-testid":"active-system-hint-pill",className:"[view-transition-name:var(--vt-composer-active-system-hint-pill) flex items-center gap-1.5 ps-0.5",children:[e.jsx("div",{"data-separator":!0,className:"bg-token-border-default h-[13px] w-px"}),e.jsx(af,{activeSystemHint:r,onClick:()=>{c(r.systemHint,!1,{clientThreadId:o})}})]},"active-hint-tag"):null}const af=({activeSystemHint:t,onClick:s})=>e.jsx(kr,{systemHint:t,onClick:s,showCloseButton:!0,isSelected:!0});function kr({systemHint:t,onClick:s,showCloseButton:o=!0,isSelected:n=!1}){const r=$();return e.jsxs(Mn,{as:"button",onClick:s,spacing:"compact",isSelected:n,isLegacyStyle:!0,borderVisible:!0,children:[e.jsx(Ka,{svgString:t.logo,className:"icon-md","aria-label":""}),e.jsx("span",{"data-label":!0,className:"mx-1.5",children:t.shortLabel??t.name}),o&&e.jsx(om,{className:"icon-smaller -ms-0.5 mt-px @max-[521px]/thread:ms-1","aria-label":r.formatMessage({id:"HW9RTL",defaultMessage:"Disable {systemHintName}"},{systemHintName:t.shortLabel??t.name})})]})}const jn=({pressed:t,disabled:s,icon:o,label:n,ariaLabel:r,animatedLabel:a,showLabel:c,onClick:i,splitButtonDropdownContent:l,showSplitButton:d=!0,dropdownContent:m,dataTestid:f,splitSecondaryButton:p,tooltip:x,as:g="popover"})=>{const[y,w]=u.useState(!1),[k,b]=u.useState(!1),S=Ti(),v=!s&&t,_=n&&e.jsx("div",{className:K("[display:var(--force-hide-label)] ps-1 pe-1 whitespace-nowrap"),children:n}),A=e.jsxs("button",{className:K("flex h-full min-w-8 items-center justify-center p-2",{"pe-1.5":!!l}),"data-testid":f,"aria-pressed":t,"aria-label":r,disabled:s,onTransitionEnd:()=>b(!1),onClick:E=>{m||(b(!0),i(E))},children:[o,!a&&c?_:null,a&&e.jsx(nt,{initial:!1,children:c&&e.jsx(ne.span,{initial:{x:-10,width:0,opacity:0},animate:{x:0,width:"fit-content",opacity:1},exit:{x:-10,width:0,opacity:0},transition:{ease:"easeOut",duration:S?0:.15},children:_})})]}),P=x?x(A):A,B=y?e.jsx(ul,{className:"h-[18px] w-[18px]"}):e.jsx(mn,{className:"h-[18px] w-[18px]"}),D=S?ll:{opacity:{delay:.1},default:{type:"tween",duration:.15,ease:"easeInOut"}},I=l||m?g==="popover"?e.jsx(pn,{children:e.jsx(tn,{className:"p-0",$as:fn,side:"bottom",align:"start",collisionPadding:10,sideOffset:8,children:m??l})}):e.jsx(W.Portal,{children:e.jsx(W.Content,{children:m??l})}):null,F=g==="popover"?e.jsx(Ks,{asChild:!0,children:P}):e.jsx(W.Trigger,{asChild:!0,children:P}),h=g==="popover"?e.jsx(Ks,{asChild:!0,children:e.jsx("button",{className:"border-token-border-default border-s p-2",style:{borderColor:v?"#0285FF0D":void 0},disabled:s,children:B})}):e.jsx(ne.div,{initial:{width:0,opacity:0,padding:0},animate:{width:"auto",opacity:1,padding:"0.5rem"},exit:{width:0,opacity:0,padding:0,borderLeft:"unset"},transition:D,style:{overflow:"hidden",border:"unset",borderLeft:"solid 1px",borderColor:v?"#0285FF0D":"var(--border-default)"},children:e.jsx(W.Trigger,{asChild:!0,children:e.jsx("button",{style:{padding:0,backgroundColor:"transparent",height:"100%",borderRadius:"unset",color:v?"var(--interactive-label-accent-default)":void 0},disabled:s,children:B})})}),j=e.jsxs("div",{className:K("radix-state-open:bg-black/10 inline-flex h-9 rounded-full border text-[13px] font-medium",{"duration-75 motion-safe:transition-all":k,"text-token-text-secondary":!t,"text-token-interactive-label-accent-default can-hover:hover:bg-[#BDDCF4] dark:can-hover:hover:bg-[#1A416A] bg-token-composer-blue-bg border-transparent dark:bg-[#2A4A6D] dark:text-[#48AAFF]":!!v,"border-token-border-default can-hover:hover:bg-token-main-surface-secondary focus-visible:outline-black dark:focus-visible:outline-white":!v,"opacity-30":s}),children:[m?F:P,e.jsx(nt,{children:!m&&l&&d?h:null}),p]});return l||m?g==="popover"?e.jsxs(dn,{onOpenChange:E=>w(E),children:[e.jsx(xa,{asChild:!0,children:j}),I]}):e.jsxs(W.Root,{onOpenChange:E=>w(E),children:[j,I]}):j},Mr=({text:t})=>e.jsx("span",{children:t}),rf=({remaining:t,reset_date:s,text:o})=>{const{locale:n}=$(),r=dl(s,n);return e.jsxs("div",{className:"text-start",children:[e.jsx("span",{className:"text-token-text-tertiary block text-xs font-semibold",children:e.jsx(L,{id:"PromptTextarea.systemHintTooltip.remaining",defaultMessage:"{remaining} available until {resetDate}",values:{remaining:t,resetDate:r}})}),e.jsx(Mr,{text:o})]})};function Yo({children:t,isDisabled:s,disabledReason:o,logEvent:n}){const r=$(),a=qa(),c=am(m=>m.bySystemHint(T.Research)),i=r.formatMessage({id:"SpX/tG",defaultMessage:"Get a detailed report"});let l=null;c&&c.remaining?l=e.jsx(rf,{remaining:c.remaining,reset_date:c.reset_after,text:i}):l=e.jsx(Mr,{text:i});const d=o===$t.DeepResearchHighLoad?r.formatMessage({id:"UrDtrS",defaultMessage:"Deep research is temporarily unavailable"}):o===$t.RateLimitReached&&a?r.formatMessage({id:"T3aUKM",defaultMessage:"More available {time}"},{time:a.resets_after_text}):void 0;return e.jsx(ot,{className:"inline-block",label:s?d:l,side:"bottom",onOpenChange:m=>{m&&n(tt.Hover)},children:t})}function cf({clientThreadId:t,repoSelectorOpen:s,linkId:o,triggerButton:n,setRepoSelectorOpen:r}){const{selectedRepos:a,setSelectedRepos:c}=gn(t),{addSource:i}=rt(t),[l,d]=u.useState(""),m=p=>{let x=[],g=!1;p==="$all_accessible_repos"?(g=!a?.selectedAllRepos,c({selectedRepos:[],selectedAllRepos:g})):a?.selectedRepos?.includes(p)?(x=a.selectedRepos?.filter(y=>y!==p),c({selectedRepos:x,selectedAllRepos:!1})):(x=[...a?.selectedRepos??[],p],c({selectedRepos:x,selectedAllRepos:!1})),(g||x.length>0)&&i(Me.GITHUB_CONNECTOR)};if(!o)return null;const f=Sa(a);return e.jsxs(W.Sub,{open:f?s:!0,onOpenChange:p=>{f&&r(p)},children:[e.jsx(W.SubMenuTrigger,{className:"ps-4",icon:ml,children:n}),e.jsx(W.Portal,{children:e.jsx(W.SubContent,{children:e.jsx(pl,{searchTerm:l,setSearchTerm:d,selectedRepos:{selectedRepos:a.selectedRepos?[...a.selectedRepos]:[],selectedAllRepos:a.selectedAllRepos},handleSelectRepo:m,linkId:o})})})]})}const lf=30,uf=25,Hs=6,df=t=>{const o=t.some(n=>!n.disabled)?t.filter(n=>!n.disabled):[...t];return o.sort((n,r)=>n.connected&&!r.connected?-1:!n.connected&&r.connected?1:n.type==="web"&&r.type!=="web"?-1:n.type!=="web"&&r.type==="web"?1:n.name.localeCompare(r.name)),o},jr=t=>pf[t.user_connection_details.connection_type]??t.connection_display_info.display_name,Ar=t=>`${jr(t)} || ${t.connection_display_info.display_name}`,Rr=({isLoading:t=!1,clientThreadId:s,enabledConnectors:o,includeWebSearch:n=!0,includeSyncConnectors:r=!1,connectorConfigMap:a,fetchValidLinksOnly:c})=>{"use forget";const i=$(),{selectedSources:l,selectedMCPSources:d,toggleSource:m}=rt(s),{connectorLinks:f,isLoading:p}=gl({fetchValidLinksOnly:c}),{connectionInstanceData:x,refetch:g,isLoading:y}=rs({skip:!r}),w=u.useMemo(()=>x?.connection_statuses??[],[x]),k=u.useMemo(()=>new Set(w.map(M=>M.user_connection_details.connection_type).filter((M,D,I)=>I.indexOf(M)!==D)),[w]),{enabledConnectors:b,connectorConfigMap:S,connectorLinks:v}=u.useMemo(()=>{if(!r)return{enabledConnectors:o,connectorConfigMap:a,connectorLinks:f};const M=Lo[Me.GDRIVE_ACTION_CONNECTOR],D=f.has(M),I=w.some(E=>E.user_connection_details.connection_type==="gdrive_sync_connector"),F=[...o],h=new Map(a),j=new Map(f);return D&&!F.some(E=>E.type===Me.GDRIVE_ACTION_CONNECTOR)&&!I&&(F.push({id:Lo[Me.GDRIVE_ACTION_CONNECTOR],type:Me.GDRIVE_ACTION_CONNECTOR,name:"Google Drive",description:"",logo_url:hl,connector_type:"SERVICE",service:"",base_url:null,actions:[],supported_auth:[],owners:[],access_list:[]}),h.set(Me.GDRIVE_ACTION_CONNECTOR,{disabled:!0,disabledText:i.formatMessage(St.contactAdmin),hasBetaTag:!1}),j.delete(M)),{enabledConnectors:F,connectorConfigMap:h,connectorLinks:j}},[r,f,w,o,a,i]),{connectedRows:_,disconnectedRows:A}=u.useMemo(()=>{const M=[];n&&M.push({connected:!0,type:"web",name:"web",element:e.jsx(W.CheckboxItem,{icon:ya,checked:l?.has("web"),onCheckedChange:()=>{m("web")},children:i.formatMessage(St.webSearch)})}),r&&w.forEach(h=>{M.push({connected:h.user_connection_details.auth_status!=="not_connected"&&h.user_connection_details.activation_status!=="inactive",type:"sync",name:Ar(h),element:e.jsx(gf,{connection:h,isSelectedInSource:l?.has(h.user_connection_details.connection_type)??!1,toggleSource:m,location:"user_dropdown",refetch:g,showDetails:k.has(h.user_connection_details.connection_type),disabled:S?.get("sync_connector")?.disabled,disabledText:S?.get("sync_connector")?.disabledText},h.user_connection_details.connection_instance_id)})}),l&&b.forEach(h=>{const E=!!v.get(h.id)?.[0];if(h.type===Jt.MCP_CONNECTOR)M.push({connected:E,type:"access",name:h.name,element:e.jsx(ff,{connector:h,connectorLinks:v,selectedMCPSources:d,toggleSource:m})});else{let O=S?.get(h.type)?.disabled,G=S?.get(h.type)?.disabledText;h.status==="DISABLED_BY_ADMIN"&&(O=!0,G=i.formatMessage(Tm.disabledByAdmin)),M.push({connected:E,disabled:O,type:"access",name:h.name,element:e.jsx(mf,{connector:h,connectorLink:v.get(h.id)?.[0],isSelectedInSource:l.has(h.type)??!1,toggleSource:m,clientThreadId:s,disabled:O,disabledText:G,hasBetaTag:S?.get(h.type)?.hasBetaTag})})}});const D=df(M),[I,F]=D.reduce(([h,j],E)=>E.connected?[[...h,E],j]:[h,[...j,E]],[[],[]]);return{connectedRows:I,disconnectedRows:F}},[n,r,l,i,m,w,g,k,S,b,v,d,s]);if(!s||!l)return null;if(y||p||t)return e.jsx("div",{className:"w-50 px-4",children:e.jsx(rr,{lines:5,size:"lg",widthVariance:0,width:100})});const P=Hs-_.length,B=_.length>Hs;return e.jsxs("div",{className:"w-70",children:[e.jsx("div",{className:K(B&&"border-token-border-secondary mb-1.5 border-b","overflow-y-auto"),style:B?{maxHeight:`calc(2.25rem * ${Hs+.5})`}:void 0,children:_.map(({element:M})=>e.jsx(e.Fragment,{children:M}))}),A.length>0&&P>0&&e.jsx(e.Fragment,{children:A.slice(0,P).map(({element:M})=>e.jsx(e.Fragment,{children:M}))}),e.jsx(W.Item,{icon:Ca,onSelect:()=>{R.logEventWithStatsig("chatgpt_connectors_dropdown_connect_more_clicked","chatgpt_connectors_dropdown_connect_more_clicked"),window.location.hash="#settings/ConnectorSettings"},children:i.formatMessage(St.connectApps)})]})},Qo=({isLoading:t=!1,clientThreadId:s,enabledConnectors:o,trigger:n,includeWebSearch:r,includeSyncConnectors:a=!1,connectorConfigMap:c,fetchValidLinksOnly:i})=>{const{deleteSource:l}=rt(s);return e.jsxs(W.Root,{"data-testid":"sources-pill",onOpenChange:d=>{d||(Sa(fl(be(s)))||l(Me.GITHUB_CONNECTOR),be(s)?.selectedSources?.size===0&&ke(s,p=>{p.selectedSources=void 0}))},children:[n,e.jsx(W.Portal,{children:e.jsx(W.Content,{alignOffset:-8,size:"auto",children:e.jsx(Rr,{isLoading:t,clientThreadId:s,enabledConnectors:o,includeWebSearch:r,includeSyncConnectors:a,connectorConfigMap:c,fetchValidLinksOnly:i})})})]})},Wt=3,Xo=t=>{"use forget";const s=Bi.c(30),{clientThreadId:o,includeSyncConnectors:n,includeWebSearch:r}=t,{selectedSources:a}=rt(o),{availableConnectors:c}=Nm(),i=!n;let l;s[0]!==i?(l={skip:i},s[0]=i,s[1]=l):l=s[1];const{connectionInstanceData:d}=rs(l);let m;s[2]!==r||s[3]!==a?(m=r&&a?.has("web")?e.jsx(ya,{className:"icon-md"}):void 0,s[2]=r,s[3]=a,s[4]=m):m=s[4];const f=m;let p;s[5]!==a?(p=a??[],s[5]=a,s[6]=p):p=s[6];let x;if(s[7]!==c||s[8]!==d?.connection_statuses||s[9]!==n||s[10]!==a||s[11]!==p){const B=[...p].filter(hf).map(D=>{const I=c.find(F=>F.type===D);return I?{name:I.name,icon:e.jsx(hn,{connector:I,size:"xsmall"})}:null}).filter(xf),M=n?Array.from(new Map((d?.connection_statuses??[]).filter(D=>["activated","partially_activated"].includes(D.user_connection_details.activation_status)&&a?.has(D.user_connection_details.connection_type)).map(Sf)).values()):[];x=[...B,...M],x.sort(yf),s[7]=c,s[8]=d?.connection_statuses,s[9]=n,s[10]=a,s[11]=p,s[12]=x}else x=s[12];let g;s[13]!==f?(g=f?[f]:[],s[13]=f,s[14]=g):g=s[14];let y;s[15]!==x?(y=x.map(bf),s[15]=x,s[16]=y):y=s[16];let w;s[17]!==g||s[18]!==y?(w=[...g,...y],s[17]=g,s[18]=y,s[19]=w):w=s[19];const k=w;let b;s[20]!==k?(b=k.length>Wt?[...k.slice(0,Wt-1),e.jsx("span",{className:"text-token-text-secondary bg-token-bg-secondary text-caption-regular flex h-4.5 w-4.5 items-center justify-center rounded-full",children:k.length-Wt+1},"more")]:k,s[20]=k,s[21]=b):b=s[21];const S=b;let v;s[22]!==S?(v=S.length>0?e.jsx("div",{className:"flex items-center gap-1",children:S.map(Cf)}):e.jsx(ba,{className:"icon-md"}),s[22]=S,s[23]=v):v=s[23];let _;s[24]!==S.length?(_=S.length<Wt&&e.jsx("span",{"data-label":!0,className:"ms-1.5",children:S.length===0?e.jsx(L,{id:"UjEzZf",defaultMessage:"Add sources"}):e.jsx(L,{id:"DhW8Wx",defaultMessage:"Sources"})}),s[24]=S.length,s[25]=_):_=s[25];let A;s[26]===Symbol.for("react.memo_cache_sentinel")?(A=e.jsx(mn,{className:"icon-sm ms-1.5 @max-[521px]/thread:ms-1"}),s[26]=A):A=s[26];let P;return s[27]!==_||s[28]!==v?(P=e.jsx(W.BasicTrigger,{asChild:!0,children:e.jsxs(Mn,{as:"button",spacing:"compact",children:[v,_,A]})}),s[27]=_,s[28]=v,s[29]=P):P=s[29],P},mf=({connector:t,clientThreadId:s,connectorLink:o,isSelectedInSource:n,toggleSource:r,disabled:a=!1,disabledText:c="",hasBetaTag:i=!1})=>{const l=$(),{selectedRepos:d}=gn(s),[m,f]=u.useState(!1),p=u.useMemo(()=>{if(d?.selectedRepos?.length&&d?.selectedRepos?.length>=1){const _=d.selectedRepos;let A=_[0];if(A.length>lf){const B=(uf-3)/2;A=A.slice(0,Math.floor(B))+"..."+A.slice(Math.floor(-11))}const P=_.length-1;return P>0?`${A} +${P}`:A}},[d.selectedRepos]);if(t.type===Jt.MCP_CONNECTOR)return null;const x=!!o,g=n&&x,y=t.type===Me.GITHUB_CONNECTOR&&x&&g,w=Bm[t.type]?.title,k=w?l.formatMessage(w):t.name,b=e.jsx(hn,{connector:t,size:"xsmall"}),S=e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"truncate",children:k}),i&&e.jsx(bl,{})]}),v=x?e.jsx(W.CheckboxItem,{disabled:a,label:S,icon:b,checked:g,onCheckedChange:()=>{r(t.type)}}):e.jsx(W.Item,{disabled:a,onSelect:()=>{window.location.hash=`#settings/ConnectorSettings?connector=${t.id}&add-connector-link=true`},label:S,icon:b,trailing:a?void 0:e.jsx("div",{className:"text-token-text-tertiary",children:l.formatMessage(St.connect)})});return e.jsxs(e.Fragment,{children:[a&&c?e.jsx(ot,{label:c,side:"right",align:"center",contentClassName:"w-50",children:v}):v,y&&e.jsx(cf,{clientThreadId:s,setRepoSelectorOpen:f,repoSelectorOpen:m,linkId:o?.id,triggerButton:p??l.formatMessage({id:"sDCihQ",defaultMessage:"Repositories"})},t.type)]})},pf={github_sync_connector:"GitHub",gdrive_sync_connector:"Google Drive",notion_sync_connector:"Notion",slack_sync_connector:"Slack",merge_file_storage_sync_connector:"Merge File Storage"},ff=({connector:t,connectorLinks:s,selectedMCPSources:o,toggleSource:n})=>{const r=$(),c=!!s.get(t.id)?.[0],i=o.has(t.id)&&c,l=t.name,d=e.jsx(hn,{connector:t,size:"xsmall"});return e.jsx(e.Fragment,{children:c?e.jsx(W.CheckboxItem,{icon:d,checked:i,label:l,onCheckedChange:()=>{n(t.id)}}):e.jsx(W.Item,{onSelect:()=>{window.location.hash=`#settings/ConnectorSettings?connector=${t.id}&add-connector-link=true`},icon:d,label:l,trailing:e.jsx("div",{className:"text-token-text-tertiary",children:r.formatMessage(St.connect)})})})},gf=({connection:t,refetch:s,location:o,isSelectedInSource:n,toggleSource:r,showDetails:a,disabled:c=!1,disabledText:i=""})=>{const l=$(),[d,m]=u.useState(!1),[f,p]=u.useState(),x=()=>{r(t.user_connection_details.connection_type)},g=t.user_connection_details.connection_instance_id,y=at(),w=xl(),k=t.user_connection_details.knowledge_connector_type,b=k==="google_drive_oauth",S=u.useCallback(async()=>{try{m(!0),await Sl({connectorType:k,connectionId:g,location:o,intl:l})}catch(j){j instanceof Error?y.danger(j.message):y.danger(l.formatMessage({id:"FNXFnS",defaultMessage:"Encountered an error connecting your account. Please try again later."}))}finally{m(!1),s?.()}},[g,k,l,o,s,y]),[v,_]=u.useState(!1),A=()=>b?_(!0):S(),P=t.user_connection_details.activation_status==="inactive"&&t.user_connection_details.auth_status==="not_connected",B=["activating","partially_activated"].includes(t.user_connection_details.activation_status),M=P&&!w||B,D=e.jsx("img",{src:t.connection_display_info.icon_url??"",alt:t.connection_display_info.display_name,className:"icon-md"}),I=j=>{if(j.stopPropagation(),j.preventDefault(),P){A();return}if(B){p(t);return}},F={key:t.connection_display_info.display_name,disabled:c,icon:D,contentClassName:"flex-1 overflow-hidden",label:jr(t),secondary:a?e.jsx("div",{className:"truncate",children:t.connection_display_info.display_name}):void 0};let h=null;switch(t.user_connection_details.activation_status){case"activated":h=e.jsx(W.CheckboxItem,{...F,checked:n,onCheckedChange:x});break;case"partially_activated":h=e.jsx(W.CheckboxItem,{...F,checked:n,onCheckedChange:x,trailing:e.jsxs("div",{className:"group-radix-disabled:opacity-50 flex items-center gap-1.5",children:[e.jsx(wl,{connection:t,ignoreLabel:!0}),e.jsx(_l,{checked:n,"aria-hidden":!0,size:"small"})]})});break;case"activating":h=e.jsx(W.Item,{...F,style:{cursor:M?void 0:"default"},onSelect:I,trailing:e.jsx("div",{className:"group-radix-disabled:opacity-50",children:e.jsx(vl,{connection:t})})});break;case"inactive":h=e.jsx(W.Item,{...F,style:{cursor:M?void 0:"default"},onSelect:I,trailing:e.jsx("div",{className:"group-radix-disabled:opacity-50",children:d?e.jsx(_n,{className:"icon-md"}):e.jsx(Cl,{connection:t,refetch:s,location:"user_dropdown"})})});break}return e.jsxs(e.Fragment,{children:[f&&e.jsx(va,{connection:f,onClose:()=>p(void 0)}),v&&e.jsx(yl,{isAdminFlow:!1,onClose:()=>_(!1),connectionId:g,location:o,onSuccess:s}),c&&i?e.jsx(ot,{label:i,side:"right",align:"center",contentClassName:"w-50",children:h}):h]})},St=Pe({contactAdmin:{id:"JGCH/x",defaultMessage:"Contact your admin to enable Google Drive for chat"},allRepositories:{id:"EzHFPp",defaultMessage:"All Repositories"},connect:{id:"OODbh3",defaultMessage:"Connect"},sourcesEnabled:{id:"aEIPI+",defaultMessage:"On"},webSearch:{id:"XoUbAe",defaultMessage:"Web search"},sourcesDisabled:{id:"j32+iI",defaultMessage:"Off"},connectApps:{id:"wwlf43",defaultMessage:"Connect more"}});function hf(t){return t!=="web"}function xf(t){return!!t}function Sf(t){return[t.user_connection_details.connection_type,{name:Ar(t),icon:e.jsx("img",{src:t.connection_display_info.icon_url??"",alt:t.connection_display_info.display_name,className:"icon-md"})}]}function yf(t,s){return t.name.localeCompare(s.name)}function bf(t){return t.icon}function Cf(t,s){return e.jsx("div",{className:"flex h-[18px] w-[18px] shrink-0 items-center justify-center",children:t},s)}function vf({clientThreadId:t,gizmoId:s,showLabel:o=!1,isDisabled:n,renderAsPill:r=!1}){const a=kl(t,s),c=We(),i=xn(T.Research),{setThreadSystemHintMode:l,clearAllSystemHintModeTriggers:d}=ge(),m=!!qa(),{value:f}=ze("1416952492"),p=f?$t.DeepResearchHighLoad:m?$t.RateLimitReached:void 0;return a?e.jsx("div",{"data-testid":"system-hint-research",style:{viewTransitionName:`var(--vt-composer-${T.Research}-action)`},children:e.jsx(wf,{composerController:c,isThreadInSystemHintMode:i,setThreadSystemHintMode:l,clearAllSystemHintModeTriggers:d,clientThreadId:t,showLabel:o,isDisabled:n||!!p,disabledReason:p,renderAsPill:r})},`system-hint-${T.Research}`):null}function wf({composerController:t,isThreadInSystemHintMode:s,setThreadSystemHintMode:o,clearAllSystemHintModeTriggers:n,clientThreadId:r,showLabel:a=!1,isDisabled:c=!1,disabledReason:i,renderAsPill:l=!1}){const d=$(),m={clientThreadId:r},{systemHints:f}=os(r),p=f.filter(v=>v.systemHint==="research"),x=d.formatMessage({id:"ORxecl",defaultMessage:"Deep research"}),g=v=>{v===tt.Hover?R.logEventWithStatsig("Composer Research Button Hovered","composer_research_button_hovered",m):v===tt.Enable?R.logEventWithStatsig("Composer Research Button Enabled","composer_research_button_enabled",m):v===tt.Disable&&R.logEventWithStatsig("Composer Research Button Disabled","composer_research_button_disabled",m)},y=()=>{n(),o(T.Research,!s,m),s||(t.removeSystemHints(),t.focus()),g(s?tt.Disable:tt.Enable)},w=ze("3544641259")?.value,{availableConnectors:k,isLoading:b}=or(),S=v=>e.jsx(Yo,{disabledReason:i,isDisabled:c,logEvent:g,children:v});return l&&p.length===0?null:l&&p.length>0?e.jsx(Yo,{disabledReason:void 0,isDisabled:!1,logEvent:g,children:e.jsx(kr,{systemHint:p[0],onClick:y,showCloseButton:!1,isSelected:!1})}):e.jsx(jn,{pressed:s,disabled:c,icon:e.jsx(Ml,{className:"h-[18px] w-[18px]"}),label:x,animatedLabel:!a,showLabel:a||s,onClick:y,ariaLabel:x,dataTestid:"composer-button-deep-research",splitButtonDropdownContent:w?e.jsx(Rr,{isLoading:b,clientThreadId:r,enabledConnectors:k,includeSyncConnectors:!1,includeWebSearch:!0,fetchValidLinksOnly:!0}):void 0,showSplitButton:s&&w,tooltip:S,as:w?"dropdown":"popover"})}function _f({clientThreadId:t,gizmoId:s,composerController:o,isDisabled:n}){return jl({clientThreadId:t,gizmoId:s})?e.jsx("div",{"data-testid":"system-hint-reason",style:{viewTransitionName:`var(--vt-composer-${T.Think}-action)`},children:e.jsx(kf,{clientThreadId:t,composerController:o,isDisabled:n})},`system-hint-${T.Think}`):null}function kf({clientThreadId:t,composerController:s,isDisabled:o}){const n=$(),r=!!$a();o=o||r;const a=n.formatMessage({id:"T+qu+0",defaultMessage:"Reason"}),{setThreadSystemHintMode:c,clearAllSystemHintModeTriggers:i}=ge(),l=xn(T.Think),d=He.useStore(),m=ss(),{isUnauthenticated:f}=ve();u.useEffect(()=>{o&&m.has(T.Think)&&c(T.Think,!1,{clientThreadId:t})},[o,m,c,t]);const p=y=>{if(y.stopPropagation(),y.preventDefault(),f)return;let w=!0;d.getState().persistedSystemHints.has(T.Search)&&(w=!1),w&&i(),c(T.Think,!l,{clientThreadId:t}),l||(s.removeSystemHints(),s.focus()),l?R.logEventWithStatsig("Composer Think Button Disabled","composer_think_button_disabled",{clientThreadId:t}):R.logEventWithStatsig("Composer Think Button Enabled","composer_think_button_enabled",{clientThreadId:t})},x=f?e.jsx(ta,{location:T.Think,statsig_login_event:"chatgpt_composer_upsell_login_button_clicked",statsig_signup_event:"chatgpt_composer_upsell_signup_button_clicked",containerNoPadding:!0}):void 0,g=e.jsx(jn,{pressed:l,disabled:o,icon:e.jsx(Rl,{className:"h-[18px] w-[18px]"}),label:a,ariaLabel:a,animatedLabel:!0,showLabel:!0,onClick:p,dropdownContent:x,dataTestid:"composer-button-reason"});return e.jsx(Al,{isDisabled:o,clientThreadId:t,children:g})}const Mf=["o1","o1-pro","gpt-4"];function jf({account:t,clientBootstrapFlags:s,features:o,clientThreadId:n,currentModelConfig:r,composerController:a,isDisabled:c,gizmoId:i,hasFiles:l}){const{prospectiveModelId:d}=un(n),m=ts(n),f=wa(i),{userIsInSearchHoldoutWithWebDisabled:p}=Pl(),x=r?.enabledTools?.includes(Ya.Search),g=m==null||m?.kind===Ae.PrimaryAssistant||m?.kind===Ae.GizmoInteraction&&f,{isUnauthenticated:y}=ve(),w=rm(T.Search);return x===!1||y&&s?.includes(Xt.AnonSearchHoldout)||!y&&(t==null||t.isFree())&&(s?.includes(Xt.FreeSearchHoldout)||p)||!w||!y&&(t==null||t.isEnterprisey())&&!o?.includes(im.BrowsingAvailable)||!g?null:e.jsx("div",{"data-testid":"system-hint-search",style:{viewTransitionName:`var(--vt-composer-${T.Search}-action)`},children:e.jsx(Af,{clientThreadId:n,composerController:a,modelSupportsSearch:x??(y||t?.isFree()||!!d&&!Mf.includes(d)),isDisabled:c,disabledReason:x?l?Yt.HasAttachedFiles:void 0:Yt.ModelNotSupported,currentModelName:r?.title??""})},`system-hint-${T.Search}`)}function Af({clientThreadId:t,composerController:s,isDisabled:o,disabledReason:n,currentModelName:r,modelSupportsSearch:a}){const c=$(),i=El(),l=c.formatMessage({id:"TbHx8d",defaultMessage:"Search"}),{setThreadSystemHintMode:d,clearAllSystemHintModeTriggers:m}=ge(),f=He.useStore(),p=ss();o=o||!a,u.useEffect(()=>{o&&p.has(T.Search)&&d(T.Search,!1,{clientThreadId:t})},[o,p,d,t]);const x=g=>{g.stopPropagation(),g.preventDefault();let y=!0;f.getState().persistedSystemHints.has(T.Think)&&(y=!1),y&&m(),d(T.Search,!i,{clientThreadId:t}),i||(s.removeSystemHints(),s.focus()),R.logEventWithStatsig("Composer Search Button Clicked","composer_search_button_clicked",{clientThreadId:t}),i&&s.trimLeadingText(/^search\b/i)};return e.jsx(Pf,{analyticsMetadata:{clientThreadId:t},isThreadUsingSearchMode:i,isDisabled:o,disabledReason:n,currentModelName:r,children:e.jsx(jn,{pressed:i,disabled:o??!1,icon:e.jsx(Nl,{className:"h-[18px] w-[18px]"}),label:l,ariaLabel:l,animatedLabel:!0,showLabel:!0,onClick:x,dataTestid:"composer-button-search"})})}function Rf(){const t=ka(),s=Ee(Ce.hasSeenComposerSearchButtonTooltip);return!s.isLoading&&s.eligible&&!t}function Pf({children:t,analyticsMetadata:s,isThreadUsingSearchMode:o,isDisabled:n,disabledReason:r,currentModelName:a}){const c=Rf()&&!o,i=Ee(Ce.hasSeenComposerSearchButtonTooltip);return c?e.jsx(_a,{announcementKey:Ce.hasSeenComposerSearchButtonTooltip,side:"right",show:!0,theme:"bright",dismissOnOutsideClick:!0,badge:"new",title:e.jsx(L,{id:"Yjduqi",defaultMessage:"Search the web"}),onDismiss:i.markAsViewed,sideOffset:0,className:"xs:max-w-sm! max-w-2xs!",description:e.jsx(L,{id:"W51Aei",defaultMessage:"Get fast answers with trusted sources. {learnMore}",values:{learnMore:e.jsx(Tl,{href:"https://openai.com/index/introducing-chatgpt-search",className:"underline",children:e.jsx(L,{id:"stA7F4",defaultMessage:"Learn more"})})}}),children:e.jsx("div",{children:t})}):e.jsx("div",{children:e.jsx(ot,{className:"inline-block",label:n?r===Yt.ModelNotSupported?e.jsx(L,{id:"GZemJe",defaultMessage:"Search disabled for {modelName}",values:{modelName:`${a}`}}):r===Yt.HasAttachedFiles?e.jsx(L,{id:"ssHAbn",defaultMessage:"Remove attachments to search"}):e.jsx(L,{id:"GpDAWD",defaultMessage:"Search is unavailable"}):e.jsx(L,{id:"c+4o2s",defaultMessage:"Search the web"}),side:"bottom",onOpenChange:l=>{l&&R.logEventWithStatsig("Composer Search Button Hovered","composer_search_button_hovered",s)},children:t})})}const Ef=5,Nf=u.memo(function(s){return Tf(s),Bf(s),Lf(),null});function Tf(t){const{store:s}=de(),o=s.useSetSharedProps();Qs(()=>{o(t)},[t,o])}function Bf(t){const{clientThreadId:s,canContinue:o}=t,{store:n}=de(),r=u.useRef({top:n.useContentAreaApi(yt.HeaderTop),bottom:n.useContentAreaApi(yt.HeaderBottom)}).current,a=Bl(s),{shouldShowBannerSignup:c,shouldShowBannerTermsDisclaimer:i}=Df(s),l=bp(s,t.composerController),d=Ll(t),m=Dl(t),f=ka(),p=Il(),x=Fl(t),g=_p(s),y=Ol(t),w=Ul(s),k=Hl(s),b=Lm(),{eligible:S}=Ee(Gl),v=zl(),_=Wl(),A=Vl(),P=Kl(),B=ql(s),M=$l(s),D=Yl(),I=Ql(s),F=Xl(s),h=Jl(s),j=Z(s,G=>G?.modelId),E=ts(s),O=bt();Qs(()=>{j&&E?.kind===Ae.GizmoInteraction&&E.gizmo&&Zl(j,E.gizmo)?r.top.set(N.ProjectConversationTaskNoFileAccess):y.eligible?r.top.set(N.AdvancedVoiceOnMobileAnnouncement):i?r.top.set(N.BannerTermsDisclaimer):l?r.top.set(N.BannersRateLimit):D?r.top.set(N.BannerPlusUpsell):I?r.top.set(N.ContextualAnswersAdminUpsell):F?r.top.set(N.ContextualAnswersUserUpsell):w?r.top.set(N.JawboneAnnouncement):k?r.top.set(N.JawboneMaxActiveAnnouncement):d.eligible?r.top.set(N.BannerSidekickAnnouncement):f?r.top.set(N.MoonshineAnnouncement):p?r.top.set(N.CustomizeChatGPTAnnouncement):m?r.top.set(N.SearchBrowserExtensionAnnouncement):x?r.top.set(N.SearchBrowserExtensionReactiveAnnouncement):b?r.top.set(N.PromoRedemptionAnnouncement):S?r.top.set(N.OperatorAnnouncement):A?r.top.set(N.ReferralProgramUpsellAnnouncement):o?r.top.set(N.PromptTextareaAction):c?r.top.set(N.BannerSignup):g?r.top.set(N.BannerMemoryFull):v?r.top.set(N.ReferrerRedemptionAvailableAnnouncement):_?r.top.set(N.RefereeRedemptionAvailableAnnouncement):P?r.top.set(N.StudentsUpsellAnnouncement):B?r.top.set(N.ModelDeprecationBanner):M?r.top.set(N.TeamsContextualAnswersUpsell):h?r.top.set(N.LanguageUpsellBanner):r.top.set(null)},[r,O,o,i,c,l,d,g,y]),Qs(()=>{a&&r.bottom.set(ma.DallePromptControls)},[r,a])}function Lf(){const{store:t}=de();u.useEffect(()=>()=>{t.reset()},[t])}function Df(t){const{isUnauthenticated:s}=ve(),{layer:o}=Re("3637408529",{shouldLogExposure:!1}),{layer:n}=Re("3637408529"),r=n.get("no_auth_banner_signup_rate_limit",Ef),a=o.get("should_show_no_auth_signup_banner",!0),c=eu(f=>f.bannerDisclaimerClientThreadId),i=tu(),l={shouldShowBannerTermsDisclaimer:!1,shouldShowBannerSignup:!1},[d,m]=Z(t,f=>[se.getConversationTurns(f).filter(p=>p.role===Qa.User).length,If(se.getCurrentNode(f)?.message)]);return t&&(l.shouldShowBannerTermsDisclaimer=m&&s&&d===1&&!i&&(c==null||c===t),l.shouldShowBannerSignup=a&&m&&s&&d>0&&d%r===0),l}function If(t){return t?.author.role===Qa.Assistant&&cm(t)}const Ff=t=>{const s=[];s.push({category:null,systemHints:t.filter(o=>!o.category)});for(const o of um)s.push({category:o,systemHints:t.filter(n=>n.category===o)});return s};function Of({composerController:t,clientThreadId:s,onHintSelected:o}){const n=Xa(s),[r]=Z(s,j=>[j?.modelId]),{data:a}=Ja(),c=r??su(void 0).id,i=Ma(a?.models,c),{setThreadSystemHintMode:l,clearAllSystemHintModeTriggers:d}=ge(),{viewableSystemHints:m,persistedSystemHints:f,locked:p}=He.useState(({availableHints:j,persistedSystemHints:E,locked:O})=>({viewableSystemHints:j,persistedSystemHints:E,locked:O})),[x,g]=u.useState([]),[y,w]=u.useState(void 0),[k,b]=u.useState(0);u.useEffect(()=>{if(!y)g([]);else{const j=y.text.toLocaleLowerCase(),E=m.filter(G=>{const Y=G.name.toLocaleLowerCase().startsWith(j),Q=G.systemHint.toLocaleLowerCase().startsWith(j);let V=!1;return G.regexMatches&&G.regexMatches.length>0&&(V=G.regexMatches.some(U=>U.replace(/[\^\$\(\)]/g,"").toLocaleLowerCase().startsWith(j))),Y||Q||V}).filter(G=>G.requiredFeatures.every(Y=>i?.enabledTools?.includes(Y))),O=Ff(E).map(G=>G.systemHints).flat();g(O)}},[y]),u.useEffect(()=>{t.view.dispatch(zm(t.view.state.tr,{onHintMatch(j){w(E=>lm(E,j)?E:j)}}))},[t]);const S=!m.length||!x.length||p||!y;u.useEffect(()=>{b(0)},[S]);const v=x.length,_=u.useCallback(j=>{b(E=>(j(E)%v+v)%v)},[v]),A=u.useCallback(()=>{b(-1)},[]),P=x[k],B=u.useCallback(()=>{y?.range&&t.delete(y.range.from,y.range.to)},[y,t]),M=({hintToSave:j=P,expectPerfectMatch:E})=>{if(!y||!P||E&&j.name.toLowerCase()!==y.text.toLowerCase())return!1;R.logEvent("System Hint Selected",{system_hint:j.systemHint,conversation_id:n??Ys});const O={clientThreadId:s};Gt(t.view),f.size>0&&d();const G=j.systemHint===T.Search;return l(j.systemHint,!0,O,G?nu.CONVERSATION_COMPOSER_SLASH_SEARCH:void 0),B(),t.removeSystemHints(),!0},D=u.useRef(M);D.current=M;const I=u.useRef(_);I.current=_;const F=u.useRef(y);F.current=y;const h=t.view;return u.useEffect(()=>(S||Wm(h,j=>{if(j==="up")I.current(E=>E-1);else if(j==="down")I.current(E=>E+1);else if(j==="cancel")Gt(h),Vm(h);else if(j==="submit")if(o)B(),o(P.systemHint);else return Gt(h),D.current({expectPerfectMatch:!1});else if(j==="checkMatch")return D.current({expectPerfectMatch:!0})}),()=>Gt(h)),[S,h,P,o,B]),u.useEffect(()=>{S||R.logEvent("System Hint List Opened",{conversation_id:n??Ys})},[S]),{suggestorClosed:S,systemHintSuggestions:x,hintMatch:y,selectedIndex:k,resetSelectedIndex:A,setSelectedIndex:b,saveHint:M}}function Uf({composerController:t,clientThreadId:s}){const{selectedIndex:o,systemHintSuggestions:n,suggestorClosed:r,setSelectedIndex:a,saveHint:c}=Of({composerController:t,clientThreadId:s});return r?null:e.jsx(ou,{className:"max-w-60",onMouseDown:i=>{i.preventDefault()},children:n.map((i,l)=>e.jsx(au,{as:"div",autoFocus:!1,className:"rounded-lg px-1 py-2",highlighted:l===o,onMouseOver:()=>a(l),onClick:()=>{c({hintToSave:i,expectPerfectMatch:!1}),t.focus()},children:e.jsx(Hf,{title:i.name,description:i.description,logo:i.logo})},i.systemHint))})}function Hf({title:t,description:s,logo:o,checked:n,badge:r}){const a=$();return e.jsxs("div",{className:"group inline-flex w-full items-center justify-start gap-2 ps-1.5 pe-3",children:[e.jsx("div",{className:"flex h-7 w-7 items-center justify-center gap-2.5",children:e.jsx(Ka,{svgString:o,className:"icon-lg text-token-text-secondary"})}),e.jsxs("div",{className:"shrink grow basis-0",children:[e.jsxs("p",{className:"text-token-text-primary text-sm leading-tight font-normal",children:[t,r&&e.jsx("span",{className:"ms-2 rounded-full bg-blue-400 px-2 py-0.5 text-xs text-white","aria-label":a.formatMessage({id:"I75WNJ",defaultMessage:"Create image updated"}),children:e.jsx(L,{id:"uUmZQi",defaultMessage:"Updated"})})]}),!!s&&e.jsx("p",{className:"text-token-text-secondary text-[13px] leading-[18px] font-normal",children:s})]}),n&&e.jsx(ru,{className:K("icon-md text-token-text-primary",{"group-hover:hidden":!n})})]})}function Jo({composerController:t,clientThreadId:s}){return t instanceof Km?e.jsx(Uf,{composerController:t,clientThreadId:s}):null}function Gf({children:t,className:s,showBackground:o,showGlowingBorder:n}){return e.jsxs("div",{className:K("relative",n&&"overflow-clip rounded-full p-0.5"),children:[t,n&&e.jsx("div",{className:"border-glowing-gradient"}),o&&e.jsx(ne.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:K("pointer-events-none absolute inset-0 rounded-full",s)})]})}function zf(){const{connectorConfig:t}=ja(),s=Pa(),[,o]=Aa(Ra([...t.values()],r=>!!r.access_token),r=>!!r.access_token);return{unconnectedConnectors:s?[]:o}}function Wf({clientThreadId:t,icon:s,modelAcceptedMimeTypes:o,modelSupportedImageMimeTypes:n,attachmentsProductFeature:r,onOauthRedirect:a,uploadType:c,getInputProps:i,openFileDialog:l,isDisabled:d=!1,highlightTooltip:m=!1,showLabel:f,disabledReason:p,currentModelName:x,showMenuForNoAuth:g=!1}){const y=dm().locale,w=$(),k=at(),b=on(),S=is(),{connectorConfig:v,isLoading:_}=ja(),A=Ee(Ce.ContextConnectors),{getGizmoId:P}=ns(),B=Dm()?.enabled??!1,[M,D]=u.useState();u.useEffect(()=>{P?P().then(z=>D(z)):D(void 0)},[P]);const I=u.useRef(null),[F,h]=u.useState(!1),j=u.useRef(!1),E=u.useCallback(()=>{const z=I.current?.files;Array.from(z??[]).forEach(me=>gt.uploadFile(b,me,n,w,k,r))},[b,n,w,k,r]),[O,G]=u.useState(null),Y=u.useCallback(()=>G(null),[G]),Q=u.useCallback((z,me)=>gt.uploadPickedFile(b,z,me,n,o,r,M,w,k),[b,n,o,r,M,w,k]),{openMenu:V,confirmMenuOpened:U}=iu();u.useEffect(()=>{V&&(h(!0),U())},[V,U,h]);const[ae,Ne]=u.useState(),Ke=u.useCallback(z=>{if(z.type===ht.GDRIVE&&B&&!ae){Ne(z);return}gt.doContextConnectorOauthRedirect(location.pathname+location.search+location.hash,z,a,Do.Picker),a()},[B,ae,a]),Ct=u.useCallback(z=>{gt.uploadPickedFile(b,z,ht.GDRIVE,n,o,r,M,w,k)},[b,n,o,r,M,w,k]),Te=u.useCallback(async z=>{const{access_token:me}=z;if(!me){Ke(z);return}switch(gt.logAttemptIfAccessTokenIsExpired(z,Do.Picker),z.type){case ht.GDRIVE:cu(y,z.type,me,wt=>wt.forEach(Ct));break;case ht.O365_PERSONAL:case ht.O365_BUSINESS:G(z.type);break}},[Ct,Ke,G,y]),qe=()=>{R.logEvent("Open File Viewer",{intent:c.toString()}),l()},it=z=>{if(!z&&j.current&&!_)qe();else if(z&&Le&&!_&&!g){qe();return}h(z),z&&(A.eligible&&A.markAsViewed(),R.logEventWithStatsig("Composer: Open Context Connector Picker","chatgpt_composer_open_context_connector_picker"),j.current=!0,setTimeout(()=>{j.current=!1},250))},[Be]=Aa(Ra([...v.values()],z=>!!z.access_token),z=>!!z.access_token);Vf(Be,Te);const{unconnectedConnectors:ct}=zf(),{desktopConnectors:lt}=lu(n),ut=[...Be,...ct],Le=!ut.length&&!lt.length,ls=e.jsxs(e.Fragment,{children:[ut.length>0&&e.jsx(uu,{connectorEntries:ut,onConnectorClick:Te,onOauthRedirect:Ke}),_&&e.jsx(W.Item,{icon:e.jsx(_n,{className:"text-token-text-secondary"})}),lt.map(z=>e.jsx(du,{entry:z},z.key)),e.jsx(mu,{modelSupportedImageMimeTypes:n}),e.jsx(pu,{handleLocalFileUploadClick:qe,showMenuForNoAuth:g})]}),re=d||S!=null,$e=u.useRef(!1),vt=e.jsxs(W.Root,{open:F,onOpenChange:it,children:[e.jsx(lr,{clientThreadId:t,rateLimitPopup:S,highlightTooltip:m,disabled:re,disabledReason:p,currentModelName:x,children:e.jsxs(W.BasicTrigger,{className:"composer-btn",disabled:re,id:"upload-file-btn","aria-label":ur(w,re,p,x),children:[s,f&&e.jsx(ea,{})]})}),e.jsx(W.Portal,{children:e.jsx(W.Content,{alignOffset:-8,onEscapeKeyDown:()=>{$e.current=!0},side:"bottom",size:"small",onCloseAutoFocus:z=>{$e.current||z.preventDefault()},className:"radix-side-bottom:flex-col-reverse flex flex-col",children:ls})})]});return e.jsxs("div",{className:"flex flex-col",children:[e.jsx(fu,{type:O,onClose:Y,uploadPickedFile:Q}),e.jsx("input",{onChange:E,...i({className:"hidden"})}),vt,e.jsx(gu,{hasConnectors:!_&&!Le}),ae&&e.jsx(hu,{onClose:()=>Ne(void 0),onContinue:()=>Ke(ae)})]})}function Vf(t,s){const{connector:o,clearParam:n}=xu(),r=t.find(a=>a.type===o&&!!a.access_token);u.useEffect(()=>{r&&(s(r),n())},[r,s,n])}function Kf({clientThreadId:t,uploadType:s,modelAcceptedMimeTypes:o,modelSupportedImageMimeTypes:n,attachmentsProductFeature:r,getInputProps:a,openFileDialog:c,onOauthRedirect:i,historyDisabled:l,isDisabled:d,highlightTooltip:m,disabledReason:f,currentModelName:p,showLabel:x,showUpsell:g,hideBorder:y,isSmall:w,showMenuForNoAuth:k,visualTreatment:b,showGlowingBorder:S}){const v=Pa(),{gdriveStatus:_,o365Status:A}=Su(),{isUnauthenticated:P}=ve(),B=l?"text-white":m?"text-brand-blue-800":"",M=!g&&(k||_!=="false"||A!=="false"||v),D=P?yu:ga,I=e.jsx(D,{"aria-label":"",className:K("icon-md",B)}),F=M?e.jsx(Wf,{clientThreadId:t,icon:I,showLabel:P&&x,modelAcceptedMimeTypes:o,modelSupportedImageMimeTypes:n,attachmentsProductFeature:r,onOauthRedirect:i,uploadType:s,openFileDialog:c,getInputProps:a,isDisabled:d,highlightTooltip:m,disabledReason:f,currentModelName:p,showMenuForNoAuth:k}):e.jsx(ap,{isSmall:w,hideBorder:y,clientThreadId:t,uploadType:s,openFileDialog:c,getInputProps:a,showLabel:x,showUpsell:g,icon:I,isDisabled:d,highlightTooltip:m,disabledReason:f,currentModelName:p,visualTreatment:b});return e.jsx(Gf,{showBackground:m,showGlowingBorder:S,className:"bg-brand-blue-800/20",children:F})}const qf=u.forwardRef(function({type:s,placeholder:o,replyRegions:n,state:r,renderFiles:a,leftSideActions:c,topRightAction:i,onSubmit:l,setIsComposerOverflowing:d,inputState:m,composerController:f,clientThreadId:p,gizmoId:x,disableReason:g,matchaData:y},w){const k=bu();let b=null;const{isLoading:S}=k;S||(b=k.modelId),u.useEffect(()=>{S||Cu()||f.focus()},[b,f,S]);const{state:v,shouldShowResearchText:_}=Qt(p),A=u.useCallback(()=>e.jsx(Ea,{useStartButtonText:v==="clarify"||!1,inputState:m,state:r,onSubmit:l,composerController:f,clientThreadId:p,gizmoId:x,disableReason:g}),[m,r,l,f,p,x,g,y,v]),{whisperControls:P,waveContainerRef:B}=cr({composerController:f,renderInComposer:A,composerType:"legacy"}),{controlsDisabled:M,waveformData:D,waveWidth:I}=Ue(f.store),F=h=>{$f({target:h.target,rootId:"composer-background",additonalInteractiveIds:["reply-regions"]})||f.focus()};return e.jsx(vu,{id:"composer-background",ref:w,className:K("border-token-border-default flex w-full cursor-text flex-col overflow-clip rounded-t-3xl border-t duration-150 ease-in-out contain-inline-size motion-safe:transition-[color,background-color,border-color,text-decoration-color,fill,stroke,box-shadow,bottom] dark:border-none dark:shadow-none",s!=="temporary"&&"shadow-[0_9px_9px_0px_rgba(0,0,0,0.01),_0_2px_5px_0px_rgba(0,0,0,0.06)] has-focus:shadow-[0_2px_12px_0px_rgba(0,0,0,0.04),0_9px_9px_0px_rgba(0,0,0,0.01),0_2px_5px_0px_rgba(0,0,0,0.06)]",s!=="temporary"&&"bg-token-main-surface-primary dark:bg-[#303030]",s==="temporary"&&"dark bg-[#303030]","rounded-b-3xl border-b"),onClick:F,style:{viewTransitionName:"var(--vt-composer)"},children:e.jsxs("div",{className:"px-3 py-1",children:[e.jsx(nt,{initial:!1,children:n.length>0&&e.jsx(ne.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0,transition:{duration:.06}},transition:{ease:"easeOut",duration:.1},id:"reply-regions",children:e.jsx("div",{className:"-mx-2",children:e.jsx(Na,{replyRegions:n})})})}),e.jsxs(e.Fragment,{children:[a,e.jsx(nt,{initial:!1,children:e.jsx(Qm,{enabled:_,composerController:f,children:e.jsxs("div",{id:"composer-waveform-container",className:"flex min-h-[44px] items-start ps-1",ref:B,children:[e.jsx("div",{className:"max-w-full min-w-0 flex-1",children:M?D?e.jsx(wu,{waveform:D,containerWidth:I,scaleFactor:10,initialValue:Xm}):null:e.jsx(Jm,{composerController:f,placeholder:o})}),e.jsx("div",{className:"w-[32px] pt-1",children:i})]})})}),e.jsxs("div",{className:"mt-1 mb-2 flex items-center justify-between sm:mt-5",ref:h=>{if(!("ResizeObserver"in window))return;const j=new AbortController;let E=window.innerWidth;const O=_u({axis:"width",debounce:!0,target:h,onChange:()=>{if(!h)return;h.scrollWidth>h.clientWidth?d?.(!0):Math.abs(E-window.innerWidth)>40&&(d?.(!1),E=window.innerWidth)}});return()=>{O?.(),j.abort()}},children:[e.jsx("div",{className:"text-token-text-primary flex gap-x-1.5",id:"composer-left-actions",children:c}),e.jsx("div",{className:"flex gap-x-1.5",id:"composer-voice-controls",children:P})]})]})]})})});function $f({target:t,rootId:s,additonalInteractiveIds:o}){let n=t;for(;n&&n!=null;){if(n.tagName==="BUTTON"||n.tagName==="INPUT"||n.tagName==="TEXTAREA"||n.isContentEditable||o.includes(n.id))return!0;if(n.id===s)return!1;n=n.parentElement}return!1}const Yf=({clientThreadId:t})=>{const s=mm(),{setThreadSystemHintMode:o}=ge(),n=s?.location.search;u.useEffect(()=>{if(new URLSearchParams(window.location.search).get("enable-internal-knowledge")==="true"&&document){o(T.ContextualAnswers,!0,{clientThreadId:t});const a=new URLSearchParams(window.location.search);a.delete("enable-internal-knowledge");const c=a.toString();window.history.replaceState({},document.title,`${window.location.pathname}${c?`?${c}`:""}`)}},[n,t,o])},Qf=()=>{const[t,s]=u.useState(),{connectionInstanceData:o,isLoading:n}=rs(),r=u.useMemo(()=>[...o?.connection_statuses??[]].sort(ku),[o]),a=r.some(c=>c.user_connection_details.activation_status==="activating"||c.user_connection_details.activation_status==="partially_activated"||c.user_connection_details.activation_status==="inactive"&&c.user_connection_details.auth_status==="user_connected");return u.useEffect(()=>{R.logEventWithStatsig("Contextual Answers User Composer Dropdown Shown","chatgpt_contextual_answers_user_composer_dropdown_shown")},[]),n?e.jsx("div",{className:"w-full max-w-[calc(100vw-1.5rem)] min-w-[calc(100vw-1.5rem)] p-3 md:min-w-[22rem]",children:e.jsx(rr,{lines:4,size:"lg"})}):e.jsxs(nt,{children:[t&&e.jsx(va,{connection:t,onClose:()=>s(void 0)}),e.jsxs("div",{className:"w-full max-w-[calc(100vw-1.5rem)] min-w-[calc(100vw-1.5rem)] px-1 py-3 md:min-w-[22rem]",children:[r.map(c=>{const i=c.user_connection_details.activation_status,l=i==="partially_activated"||i==="activating";return e.jsx("div",{className:K("__menu-item",c.user_connection_details.activation_status==="activating"?"grayscale":void 0,l?"":"cursor-default"),onClick:d=>{l&&s(c),d.stopPropagation()},children:e.jsx(Mu,{title:c.connection_display_info.display_name,icon:e.jsx("img",{src:c.connection_display_info.icon_url??"",alt:c.connection_display_info.display_name,className:"icon-md"}),statusIndicator:e.jsx(ju,{connection:c,location:"user_dropdown"})})},c.user_connection_details.connection_instance_id)}),e.jsx("div",{className:"__menu-item",onClick:c=>{window.location.hash="#settings/ConnectorSettings",c.stopPropagation()},children:e.jsxs("div",{className:"flex w-full flex-row items-center justify-start gap-4 text-start",children:[e.jsx(Ca,{className:"icon-md"}),e.jsx("p",{className:"text-token-text-primary flex-1 text-sm font-medium",children:a?e.jsx(L,{id:"EqgQdy",defaultMessage:"See syncing state"}):e.jsx(L,{id:"05N3nu",defaultMessage:"Manage connectors"})})]})})]})]})};function Xf({systemHints:t,composerController:s,clientThreadId:o,connectionStatuses:n}){Yf({clientThreadId:o});const r=ha(s),a=t.find(({systemHint:y})=>y===r),{availableConnectors:c,isLoading:i,enabled:l}=or(),{availableConnectors:d,enabled:m,isLoading:f}=Im({includeDisabledByAdmin:!0}),{connectorConfigMap:p}=pr({clientThreadId:o});if(!a)return null;const x=r===T.Research,g=!1;return l&&(x||g)?e.jsx(Qo,{isLoading:i,clientThreadId:o,enabledConnectors:c,fetchValidLinksOnly:x||g,trigger:e.jsx(Xo,{clientThreadId:o,includeSyncConnectors:!1,includeWebSearch:!0})}):r===T.Slurm&&(n&&n.length>0||m&&d.length>0)?e.jsx(Qo,{clientThreadId:o,isLoading:f,enabledConnectors:d,includeWebSearch:!1,includeSyncConnectors:!0,connectorConfigMap:p,trigger:e.jsx(Zf,{children:e.jsx(Xo,{clientThreadId:o,includeSyncConnectors:!0,includeWebSearch:!1})})}):r===T.ContextualAnswers?e.jsx("div",{"data-testid":"sources-pill",className:"flex items-center gap-1.5 ps-0.5 [view-transition-name:var(--vt-composer-sources-pill)]",children:e.jsx(Jf,{dropdownContent:e.jsx(Qf,{}),as:"popover"})},"sources-tag"):null}function Jf({dropdownContent:t,as:s}){const o=e.jsxs(Mn,{as:"button",spacing:"compact",children:[e.jsx(ba,{className:"icon-md mx-1","aria-label":""}),e.jsx("span",{"data-label":!0,children:e.jsx(L,{id:"DhW8Wx",defaultMessage:"Sources"})}),e.jsx("div",{className:"me-0.5 flex items-center",children:e.jsx(mn,{className:"pointer-events-auto! h-4 w-4"})})]}),n=s==="popover"?e.jsx(pn,{children:e.jsx(tn,{className:"p-0",$as:fn,side:"bottom",align:"start",collisionPadding:10,sideOffset:8,children:t})}):e.jsx(W.Portal,{children:e.jsx(W.Content,{children:t})});return s==="popover"?e.jsxs(dn,{children:[e.jsx(Ks,{asChild:!0,children:o}),n]}):e.jsxs(W.Root,{children:[e.jsx(W.Trigger,{asChild:!0,children:o}),n]})}function Zf({children:t}){const{eligible:s,markAsViewed:o}=Ee(Ce.hasSeenConnectorsSourcesPillTooltip);return e.jsx(_a,{announcementKey:Ce.hasSeenConnectorsSourcesPillTooltip,badge:"new",className:"xs:max-w-sm! max-w-2xs!",description:e.jsx(L,{id:"bJE6uS",defaultMessage:"Get insights across Google Drive, SharePoint, Dropbox, and more."}),dismissOnOutsideClick:!0,onDismiss:o,show:s,side:"bottom",sideOffset:0,theme:"bright",title:e.jsx(L,{id:"O73vya",defaultMessage:"Connect your apps for smarter chats"}),children:t})}const eg=({clientThreadId:t,composerController:s,pendingFiles:o,hasFiles:n,placeholder:r,isTemporaryChat:a,state:c,inputState:i,disableReason:l,gizmoId:d,replyRegions:m,keepExpanded:f=!1,onSubmit:p,legacyFooterActions:x,legacySuggestionsPopoverContent:g,isNewThread:y=!1,modelSupportedSystemHints:w,contextualAnswerUserConnectionData:k,shouldUseBigComposer:b})=>{const S=He.useState(({persistedSystemHints:U})=>U);Au(t);const v=Array.from(S)[0],_=He.useState(({locked:U})=>U),{state:A}=Qt(t),B=A==="clarify"||!1,M=u.useCallback(U=>e.jsx(Ea,{inputState:i,state:c,onSubmit:p,composerController:s,clientThreadId:t,gizmoId:d,disableReason:l,useStartButtonText:B,disableTooltip:U}),[i,c,p,s,t,d,l,B]),{whisperControls:D}=cr({composerController:s,renderInComposer:M,composerType:"composer-btn"}),I=He.useState(({availableHints:U})=>U),F=Ta(U=>U.selectedApps),h=Ba()&&F.length>0,j=n||h,E=f||!!v||m&&m.length>0||j||I.length<3,O=xn(T.ContextualAnswers)&&!!y,{shouldShowResearchText:G}=Qt(t),Y=Ru(),Q=Pu({exposed:O})==="bigbox",V=Y&&G||Q&&O;return e.jsxs(Zm,{isBigBoxModeActive:V,isTemporaryChat:a,placeholder:r,composerController:s,isExpandedByDefault:E,onSubmit:p,shouldUseBigComposer:b,children:[m&&m.length>0&&e.jsx(Fo,{children:e.jsx(Na,{replyRegions:m})}),j&&e.jsx(Fo,{children:e.jsx(qs,{files:o,fullBleed:!0,selectedApps:F,className:"no-scrollbar horizontal-scroll-fade-mask -ms-1.5 flex flex-nowrap gap-2 overflow-x-auto py-1.5 ps-2 pe-4 [--edge-fade-distance:1rem]"})}),x?.map((U,ae)=>e.jsx(Oo,{children:U},`legacy-footer-action-${ae}`)),!_&&e.jsx(ep,{children:e.jsx(of,{clientThreadId:t,composerController:s,systemHints:w})},"active-hint-tag"),e.jsx(Oo,{children:e.jsx(Xf,{clientThreadId:t,composerController:s,systemHints:w,connectionStatuses:k?.connection_statuses})},"sources-tag"),e.jsx(tp,{children:g},"legacy-suggestions-popover"),e.jsx(sp,{children:D}),Y&&G?e.jsx(Uo,{children:e.jsx(np,{composerController:s})}):Q&&O?e.jsx(Uo,{children:e.jsx(Eu,{composerController:s})}):null]})},tg=Cn(()=>vn(()=>import("./mbayu552ymsflarc.js"),__vite__mapDeps([8,1,2,3,4,5,9,10,11,12,13,14])).then(t=>t.ImageGenComposer)),sg=1,ng=3e3,og=()=>null;function ag({onCreateNewCompletion:t,onContinueGenerating:s,account:o,currentModelId:n,currentModelConfig:r,disableDraftPersistence:a=!1,areModelsLoading:c,clientThreadId:i,isNewThread:l,isCompletionInProgress:d,className:m,disabled:f=!1,disabledReason:p,canPause:x=!1,canContinue:g=!1,isInteractableSharedThread:y,onComposerInput:w,onComposerChange:k,onAutocompleteSelect:b,headerClassName:S,hideHeader:v,onTaggingDropdownOpen:_,onTaggingDropdownClose:A,onlyAllowImageUploads:P,shouldUseBigComposer:B}){st.markStart("PromptTextarea"),st.markRendered("PromptTextarea");const M=u.useContext(Za),D=er(M),I=he(),F=u.useRef(null),h=We(),j=sa(),E=pm(j.showUploadSuggestion$),O=pa(),G=o?.isTeam(),Y=yn(I),Q=$(),V=at(),U=on(),ae=Nu.useStore(),[Ne,Ke,Ct]=Z(i,C=>[se.getCurrentLeafId(C),se.getRequestId(C),se.findNode(C,H=>!!H.message.metadata?.b1de6e2_s)]),[Te,qe]=Li(),{gizmoEditorData:it,mode:Be,getGizmoId:ct}=ns(),lt=Wa(),ut=nn(),Le=fm(),ls=Tu(),re=Xa(i),$e=!!Va(),vt=!!$a(),z=Bu.useIsEnabled(i),me=!!wn(),{clearAllSystemHintModeTriggers:wt,setThreadSystemHintMode:Ye}=ge(),ee=ss(),{state:us}=Qt(i),ds=ee.has(T.Search),Pr=ee.has(T.Think),Er=ee.has(T.Research),{activeSystemHints:_t}=os(i),Nr=He.useState(({locked:C})=>C),Tr=_t.length>0,Br=Lu(),{connectionInstanceData:Lr,isLoading:Dr}=rs({skip:!Br}),{selectedSources:An,selectedMCPSources:kt}=rt(i),Rn=fr(I);Du({skip:!Rn});const{platformConnectors:Pn}=Iu(Rn&&(kt?.size??0)>0),Ir=u.useMemo(()=>Array.from(kt??[]).map(C=>Pn.get(C)).filter(C=>C!==void 0),[Pn,kt]),ms=u.useRef(0),ps=u.useRef(!1),Fr=og();let q=ts(i),Mt=q&&"gizmo"in q?q.gizmo:void 0;const Or=gm(),De=Mt?.gizmo.id??Or,fs=wa(De),{name:Ur}=Fu(),Hr=Ur?ad:rd,Gr=Ou(),En=Uu(),[le,jt]=u.useState(null);le!==null&&(q={gizmo:le,gizmo_id:le.gizmo.id,kind:Ae.GizmoInteraction},Mt=le);const dt=Gs(r,q,ee),zr=is(),Nn=Da(I).flags,At=Nn?.includes(Xt.NoAuthEnableFileUploads),Rt=jo(C=>C.setThreadModelSelection),Tn=jo(C=>C.threads[i]?.modelSelection),Bn=Tn?.type===Ht.EFFORT_MODE?Tn.effortMode:null,Ln=!!Bn&&Bn!=="default";Hu(u.useCallback(()=>{Ln&&Ls(i,Rt,{type:Ht.EFFORT_MODE,effortMode:"default"})},[Ln,i,Rt])),qm({serverThreadId:re,clientThreadId:i,composerController:h,currentModelId:n,account:o,getIsDisabled:u.useCallback(()=>!1,[]),onReset:()=>{Ls(i,Rt,{type:Ht.EFFORT_MODE,effortMode:"default"})},onInfer:C=>{Ls(i,Rt,{type:Ht.EFFORT_MODE,effortMode:C})},isInferEnabledForModel:r?.enableInfer});const Dn=!f&&(dt!==Oe.None||c)&&(Y||At),we=oa(r,q),gs=ra(r,q);let ie=zs(C=>C.files);const[Pt]=u.useState(()=>Gu());Be==="magic"?ie=ie.filter(C=>C.gizmoId!=null):ie=ie.filter(C=>C.gizmoId==null);const In=zu(),ue=ie.length>0||In,Fn=zs(kd.hasUploadInProgress),hs=Ta(C=>C.selectedApps),On=Ba()&&hs.length>0,Wr=ue||On,Vr=Wu(i),xs=h.useState(C=>{const H=Vu(C);return typeof r?.maxTokens=="number"&&H>r.maxTokens}),Un=h.useState(C=>!C.isEmpty()),Et=!xs&&!Fn&&(Un||ue),Hn=(dt===Oe.Multimodal?an:rn)-ie.length,Gn=Hn<=0,Kr=Ku(),qr=ze("3544641259")?.value,{selectedRepos:Ss}=gn(i),zn=Kr&&qr&&An?.size===0&&kt?.size===0,Qe=Et&&!f&&!me&&(!d||En)&&!zn,[Wn,$r]=u.useState(!1),{targetedContent:Vn,setTargetedContent:Nt}=qu(),pe=Vn?.isFocusedViewContent&&!ls?void 0:Vn;u.useEffect(()=>{requestAnimationFrame(()=>requestAnimationFrame(()=>h.focus()))},[pe]);const Kn=q==null||q?.kind===Ae.PrimaryAssistant||q?.kind===Ae.GizmoInteraction&&fs,{getUpsellLabelType:Yr,getUpsellShowsAttach:Qr}=$u(),ys=Tr&&Kn,[Xr,Jr]=u.useState(!1),Zr=Y&&Kn&&!Nr&&(!G||!Dr),mt=Ue(h.store,C=>C.controlsDisabled);u.useEffect(()=>{if(!O?.id)return;const C=Ao.getAndReset(O.id,re);C&&h.setText(C.inputText)},[O?.id,re,h]),u.useEffect(()=>{const C=Te.get("prompt")??"";h.getCurrentText().length===0&&C.length>0&&h.setText(C)},[h,Te]),u.useEffect(()=>{if(ee.size)return;const C=Te.getAll("system_hints");if(!C.length)return;const H=_t.map(J=>J.systemHint);C.filter(J=>H.includes(J)).forEach(J=>Ye(J,!0,{clientThreadId:i})),qe(J=>{const ce=new URLSearchParams(J);return ce.delete("system_hints"),ce})},[h,Te,i,_t,ee,Ye,qe]),u.useEffect(()=>{Wn!==Qe&&($r(Qe),Qe&&hm(!0).then(C=>{Yu.startEnforcement(C),xm.startEnforcement(C)}))},[Qe,Wn,q?.kind,lt]);const Tt=na(r,q),{handleFileAccepted:qn}=mr(Q,Gs(r,q,ee),we,"mouse",ct,Tt?.attachments),ei=u.useCallback((C,H)=>(requestAnimationFrame(()=>{requestAnimationFrame(()=>{h.focus()})}),qn(C,H)),[h,qn]),{getInputProps:ti,open:bs,inputRef:$n}=ir({disabled:f||!Dn||Gn,noClick:!0,onDropAccepted:ei,onDropRejected:C=>dr(C,Q,V,dt),multiple:!0,maxSize:ia,maxFiles:Hn,...aa(!Y||P?we:gs)}),Yn=Ue(Pt),Qn=u.useCallback(()=>{h.eraseContent(),Yn.clearMessages(),h.resize(sg),h.usedDictation=!1,h.dictationEdited=!1,h.dictationAssetPointer=null,h.dictationAssetTTL=null;for(const H of ie)Kt.remove(U,H.tempId,"none");if(Qu.markAllAsSent(),Sm(I)){const H=ym(I,"269676899"),oe=H.get("skip_search",!1);if(H.get("clear_all",!1)){const ce=[T.Slurm,T.Tatertot];oe&&ce.push(T.Search),wt({skip:ce})}}},[h,Yn,wt,I,ie,U]),Bt=Ue(h.store,C=>C.isInReasonMode),Cs=u.useMemo(()=>Ds(Bt,h,ee)[0],[Bt,h,ee]),Xn=async(C,H)=>{if(C.preventDefault(),f||!Et||!q)return;const oe=h.getContentToSend(),J=Md(oe.content),ce=Ds(Bt,h,ee),{content:Es,attachments:Ns}=jd(U,J,r,q,ee);Gr(),t({sourceEvent:C,attachments:Ns,content:Es,contentToSend:oe,conversationMode:q,hasSelectedApps:On,isAuraSidebar:D,isMessageFollowupsEnabled:z,selectedApps:hs,selectedGizmoTag:le,selectedRepos:{selectedAllRepos:Ss.selectedAllRepos,selectedRepos:Ss.selectedRepos?[...Ss.selectedRepos]:null},selectedSources:An,selectedMCPConnectors:Ir,systemHints:ce,usedDictation:h.usedDictation,dictationEdited:h.dictationEdited,dictationAssetPointer:h.dictationAssetPointer,dictationAssetTTL:h.dictationAssetTTL}),pe?.onCreateCompletion?.({serverThreadId:re,currentLeafId:Ne}),pe?.shouldPersistAcrossMessages!==!0&&Nt(void 0),Ro.hideThreadHeader();for(const wo of ie)wo.status===Ad.Ready&&ae.addFile(wo);Qn()},si=C=>{Nt(C.targetedReply),C.targetedReply&&R.logEventWithStatsig("Targeted Reply Button Clicked","chatgpt_targeted_reply_button_clicked",{conversationId:re,sourceMessageId:C.messageId})},{maybeSetWaitingForRealtimeOnAbort:Jn,isWatingForRealtimeStatusChange:ni}=Xu(i),vs=u.useCallback(C=>{Jn(),Ju(C)},[Jn]),Zn=u.useCallback(()=>{pe?.onCleared?.({serverThreadId:re,currentLeafId:Ne}),Nt(void 0),h.focus()},[Ne,re,pe,Nt,h]),eo={Enter:{validator:C=>{const H=C.isComposing||C.keyCode===229;return!(Dt&&ps.current)&&(C.metaKey||(ut||wm||_m())&&!C.shiftKey&&!H)},handler:C=>{if(!Qe){xs&&V.danger("The message you submitted was too long, please submit something shorter.",{hasCloseButton:!0});return}C.preventDefault(),Xn(C)}},Escape:{validator:C=>!C.isComposing,handler:C=>{x&&d&&(vs(i),R.logEventWithStatsig("Pause Completion","chatgpt_pause_completion",{threadId:xt(i),currentLeafId:se.getCurrentNode(be(i)).message.id,eventSource:"keyboard"})),C.target.value===""&&Zn()}}},pt=u.useRef(eo);pt.current=eo;const Lt=Zu(r?.tags,q?.kind),{showTaggingDropdown:ws,isFocused:oi,autocompletions:_e,matchaData:ai}=Ue(h.store),Dt=oi&&_e.length>0,Xe=Lt&&ws&&!fs,to=h.isReady();u.useEffect(()=>h.subscribe("keydown",C=>{h.acceptLegacyKeydown()&&pt.current[C.key].validator(C)&&pt.current[C.key].handler(C);const oe=h.getCurrentText();if(C.key==="@"){const J=h.getSelectionStart(),ce=oe.substring(0,J);(!ce||/\s$/.test(ce)||J===0)&&setTimeout(()=>h.setShowTaggingDropdown(!0),10)}else ws&&h.setShowTaggingDropdown(!1);C.key==="Escape"&&(jt(null),h.setAutocompletions([])),ds&&C.key==="Escape"&&Ye(T.Search,!1,{clientThreadId:i})}),[h,to,ws,ee,ds,Ye,i]),u.useEffect(()=>{const C=Object.fromEntries(Object.keys(pt.current).map(H=>[H,J=>{const ce=pt.current[H];if(!ce||h.acceptLegacyKeydown())return!1;const{validator:Es,handler:Ns}=ce;return Es(J)?(Ns(J),!0):!1}]));h.registerKeyHandlers(C),h.registerFileInput({openFileDialog:bs,inputRef:$n})},[h,bs,$n,to]),u.useEffect(()=>h.subscribe("paste",C=>{ed({filePickerStore:U,event:C,intl:Q,toaster:V,clientThreadId:i,conversationMode:q,currentModelConfig:r,getEditorGizmoId:ct,modelSupportedImageMimeTypes:we,persistedSystemHints:ee})}),[Q,i,q,r,ct,we,h,V,U,ee]);const so=C=>{$e||jt(C),h.trimLeadingText("@"),Ws(),h.setShowTaggingDropdown(!1)},ri=td(i,Pt,we,Tt?.attachments),ii=u.useCallback(C=>{C.preventDefault(),vs(i),R.logEventWithStatsig("Pause Completion","chatgpt_pause_completion",{threadId:xt(i),currentLeafId:se.getCurrentNode(be(i)).message.id,eventSource:"mouse"}),Ws()},[i,vs]),_s=u.useCallback(()=>{Ao.set(O?.id,re,h.getCurrentText())},[re,O?.id,h]);u.useEffect(()=>{it||sd()||h.focus()},[h]),u.useEffect(()=>{if(we.length>0)for(const H of ie)nd(H.fileSpec?.mimeType,gs)||Kt.remove(U,H.tempId,"none");else Kt.reset(U)},[n,U]),u.useEffect(()=>{(!Lt&&le||$e)&&jt(null)},[Lt,le,$e]),u.useEffect(()=>{vt&&h.setReasonMode(!1)},[vt,h]),u.useEffect(()=>{ue&&ee.has(T.Search)&&Ye(T.Search,!1,{clientThreadId:i})},[ue,i,Ye,ee]);const{layer:ci}=Re("4031588851"),{layer:no}=Re("3637408529"),li=no.get("is_in_composer_text_exp",!1),ui=no.get("composer_text","MESSAGE_CHATGPT"),di=ci.get("composer_text","MESSAGE_CHATGPT"),mi=li?ui:di,[It,pi]=(()=>{switch(p){case"workspaceDisallowsGizmo":return[X.disallowedByWorkspacePlaceholder,!0];case"noModelsAvailable":return[X.noModelsAvailablePlaceholder,!0];case"requiresPluginsToBeInstalled":return[X.requiresPluginsToBeInstalled,!0];case"loadingPlugins":return[X.loading,!0];case"noTestGizmoId":return[X.noTestGizmoId,!0];default:{if(y)return[X.placeholderWithName,!1];if(pe?.placeholderTextOverride!=null)return[pe.placeholderTextOverride,!1];if(us==="initial"||us==="recurrent")return[X.deepResearchPlaceholder,!1];if(us==="clarify")return[X.researchSuggestionInitial,!1];if(Cs)switch(Cs){case T.Search:return[X.searchPlaceholder,!1];case T.Think:return[X.thinkPlaceholder,!1];case T.Slurm:return[X.connectorPlaceholder,!1];case T.Research:return[X.researchPlaceholder,!1];case T.Canvas:return[X.canvasPlaceholder,!1];case T.Picture:return[X.picturePlaceholder,!1];case T.PictureV2:return[X.pictureV2Placeholder,!1];case T.ContextualAnswers:return[od.caSuggestionInitial,!1]}switch(mi){case"BLANK":return[null,!1];case"ASK_ANYTHING":return[X.placeholderAskAnythingVariant,!1];case"ASK_CHATGPT_ANYTHING":return[X.placeholderAskNameAnythingVariant,!1];default:return[X.placeholderWithName,!1]}}}})(),ks=fs?l?Q.formatMessage(Hr.newChatInProject,{projectName:Mt?.gizmo.display.name??"this project"}):It?Q.formatMessage(It,{name:"ChatGPT"}):"​":It?Q.formatMessage(It,{name:it!=null?Be==="magic"?id:it.name||"GPT":Mt?.gizmo.display.name??"ChatGPT"}):"​";u.useEffect(()=>h.subscribe("input",()=>{cd.getState().isThreadHeaderVisible&&Ro.hideThreadHeader()}),[h]),u.useEffect(()=>h.subscribe("input",()=>{ms.current=performance.now(),w?.()}),[h,w]),u.useEffect(()=>{if(k)return h.subscribe("change",()=>{k()})},[h,k]);const oo=ld()&&!!_e.find(C=>!!C.requires_file_upload),fi={clientThreadId:i,uploadType:dt,modelAcceptedMimeTypes:gs,modelSupportedImageMimeTypes:we,attachmentsProductFeature:Tt?.attachments,getInputProps:ti,openFileDialog:bs,historyDisabled:Le,onOauthRedirect:_s,highlightTooltip:oo&&!ue},Ie=[],ao=[],ro=!f&&!Gn&&(Dn||zr!=null),io=Qr(),gi=Y||io||At,co=dt===Oe.None?xe.ModelNotSupported:Pr?xe.ThinkModeInUse:ds?xe.SearchModeInUse:void 0;if(gi){const C=e.jsx("div",{"data-testid":"composer-action-file-upload",style:{viewTransitionName:"var(--vt-composer-attach-file-action)"},children:e.jsx(Kf,{...fi,showGlowingBorder:E,showLabel:Yr()==="all",showUpsell:io&&!At,showMenuForNoAuth:At,isDisabled:!ro||mt,disabledReason:co,currentModelName:r?.title??"",visualTreatment:Y?"composer-btn":"legacy"})},"file-upload-button");Ie.push(C),ao.push(C)}const hi=La(),xi=Ge(I,"2861925050");if(Y?Zr&&Ie.push(e.jsx(wd,{composerController:h,clientThreadId:i,disabled:mt,hasFiles:ue,isFinchEnabled:xi})):(Ie.push(e.jsx(jf,{account:o,clientBootstrapFlags:Nn,features:lt,currentModelConfig:r,hasFiles:ue,isDisabled:!!mt||ue,clientThreadId:i,composerController:h,gizmoId:De})),D||Ie.push(e.jsx(_f,{clientThreadId:i,gizmoId:De,composerController:h,isDisabled:mt}))),ud()&&Cs==null){const C=e.jsxs("div",{className:"[view-transition-name:var(--vt-composer-active-system-hint-pill) flex items-center gap-1.5 ps-0.5",children:[e.jsx("div",{"data-separator":"true",className:"bg-token-border-default h-[13px] w-px"}),e.jsx(vf,{clientThreadId:i,gizmoId:De,showLabel:!0,isDisabled:mt,renderAsPill:!0},"deep-research")]});Ie.push(C)}const Ms=Ge(I,"2007855518"),lo=Ct?.message.metadata?.async_task_id,js=dd(C=>lo?C.tasks[lo]:null),[Si,uo]=u.useState(!1),As=js?.status===md.RUNNING,Rs=pi||ni?"disabled":"default",mo=pd(xt(i)||i)?.value,yi=mo===Io.STREAMING,bi=mo===Io.REALTIME,po=d&&x||yi||bi||As&&Ms,Ci=bm(),vi=!Qe||Ci,Ps=Cd(Fn,Un,xs,Vr,!zn,As,Ms),Je=po?"streaming":vi?"disabled":"idle",ft=u.useRef(null),Ze=u.useRef(null),{value:wi}=ze("222560275"),_i=wi||n&&!n.startsWith("o1")&&!n.startsWith("o3");u.useEffect(()=>{const C=()=>{ft.current!=null&&bn.addAction("composer_state_disabled",{threadId:xt(i),disabledReason:ft.current})};if(Et&&Je==="disabled"){let H="unknown";f?H=p??"component_disabled_unknown":d?H="completion_in_progress":me&&(H="thread_hard_blocked"),ft.current!==H&&(Ze.current&&clearTimeout(Ze.current),Ze.current=setTimeout(C,ng)),ft.current=H}else ft.current=null;return()=>{Ze.current&&(clearTimeout(Ze.current),Ze.current=null)}},[i,Et,Je,f,p,d,me]);const Ft=[];if(pe?.label&&Ft.push({type:pe.type,value:pe.label,onRemoveRegion:Zn}),le!==null){const C=!!le.gizmo.tags?.includes(as.FirstParty);Ft.push({type:"mention",value:le.gizmo.display.name,icon:e.jsx(ar,{isFirstParty:C,src:le.gizmo.display.profile_picture_url,className:"icon-md"}),onRemoveRegion:()=>{jt(null),h.focus()}})}u.useEffect(()=>{(!_e||_e.length===0||!Dt)&&(ps.current=!1)},[_e,Dt]);const ki=u.useCallback((C,H,oe)=>{ps.current=C>=0,H&&h.setText(oe?`${oe.title}${oe.body}`:"")},[h]),fo=Dt&&_e&&_e.length>0&&!Xe&&!Er&&!h.hasMultipleLines()&&h.canShowAutocompletion();u.useEffect(()=>{Xe?_?.():A?.()},[Xe,_,A]);const Ot=C=>{if(C.preventDefault(),C.stopPropagation(),ms.current>0){const H=performance.now()-ms.current;km.hist(Mm.DEFAULT,"final_user_input_to_submit_ms",[],H)}Je==="streaming"&&(!En||h.isEmpty())?As&&Ms?uo(!0):ii(C):Xn(C)},Mi=fd(r,Ya.Canvas),ji=gd(),Ai=Mi&&!ji&&!In&&!hi;u.useEffect(()=>{},[Fr,h]),u.useEffect(()=>{const C=xt(i),H=o?.normalizedAccountUserId;if(!H||a)return;const oe=ca(()=>{const J=h.getContentToSend().content;J===""?Cm(C):vm(C,J,H)},1e3);return h.subscribe("change",oe)},[o,i,h,a,re]);const go=e.jsx(Nf,{canUseInlineTagging:Lt,isDisabled:f,clientThreadId:i,currentLeafId:Ne,currentRequestId:Ke,canContinue:g,composerController:h,isNewThread:l,onContinueGenerating:C=>s({event:C,conversationMode:be(i)?.mode,systemHints:Ds(Bt,h,ee)}),onResetState:Qn,conversationMode:q,isShowingAutocomplete:!!fo,shouldUseBigComposer:B}),ho=!po&&q!=null&&_i&&hd.includes(q.kind)&&e.jsx(xd,{clientThreadId:i,onTargetedReply:si}),xo=fo&&e.jsx("div",{className:"bg-token-main-surface-primary absolute start-0 z-[-1] box-border w-full ps-0 max-lg:bottom-full lg:top-full",children:e.jsx(Op,{suggestions:_e,composerController:h,onSelect:b,onChange:ki})}),So=e.jsx(_d,{composerController:h,parsedDocumentHandler:ri}),yo=!v&&e.jsx(yr,{className:S}),bo=e.jsx(Sd,{modelSupportedImageMimeTypes:we,uploadType:Oe.Multimodal,attachmentsProductFeature:Tt?.attachments}),Ri=e.jsxs(e.Fragment,{children:[Xe&&e.jsx($o,{onClick:C=>so(C),onClose:()=>{h.setShowTaggingDropdown(!1),h.focus()}}),ys&&e.jsx(Jo,{composerController:h,clientThreadId:i})]}),{isImageGenEditor:Co}=yd(),vo=Ge(I,"3760395675");return Co?e.jsxs(Po.Provider,{value:Pt,children:[e.jsx(No,{onOauthRedirect:_s,children:e.jsx(Eo,{defaultOpen:vo,children:e.jsx("form",{id:"prompt",className:m,onSubmit:Ot,children:e.jsxs("div",{className:"relative z-1 flex h-full max-w-full flex-1 flex-col",children:[yo,e.jsxs("div",{className:"group relative z-1 flex w-full items-center",style:{"--force-hide-label":Xr?"none":"block"},children:[e.jsxs(dn,{open:Xe||ys,children:[e.jsx(xa,{className:"w-full",children:Co?e.jsx(tg,{type:Le?"temporary":"default",ref:F,placeholder:ks,inputState:Rs,composerController:h,leftSideActions:ao,state:Je,onSubmit:Ot,renderFiles:ue&&e.jsxs(e.Fragment,{children:[Be==="magic"&&e.jsx("div",{className:"bg-token-main-surface-secondary text-token-text-secondary m-2 mb-0 rounded-lg p-2 text-xs",children:e.jsx(L,{...X.gizmoKnowledgeWarning})}),e.jsx(qs,{files:ie,className:"-ms-1.5 flex flex-nowrap gap-2 overflow-x-auto p-1.5"})]}),clientThreadId:i,gizmoId:De,disableReason:Ps,modelId:n}):e.jsx(qf,{type:Le?"temporary":"default",ref:F,replyRegions:Ft,placeholder:ks,inputState:Rs,setIsComposerOverflowing:Jr,composerController:h,matchaData:ai,leftSideActions:Ie,topRightAction:Ai&&e.jsx(vd,{composerRef:F,composerController:h,clientThreadId:i}),state:Je,onSubmit:Ot,renderFiles:Wr&&e.jsxs(e.Fragment,{children:[Be==="magic"&&e.jsx("div",{className:"bg-token-main-surface-secondary text-token-text-secondary m-2 mb-0 rounded-lg p-2 text-xs",children:e.jsx(L,{...X.gizmoKnowledgeWarning})}),e.jsx(qs,{files:ie,selectedApps:hs,className:"-ms-1.5 flex flex-nowrap gap-2 overflow-x-auto p-1.5"})]}),clientThreadId:i,gizmoId:De,disableReason:Ps,modelId:n})}),e.jsx(pn,{children:e.jsxs(fn,{side:"bottom",align:"start",sideOffset:12,onOpenAutoFocus:C=>C.preventDefault(),children:[Xe&&e.jsx($o,{onClick:C=>so(C),onClose:()=>{h.setShowTaggingDropdown(!1),h.focus()}}),ys&&e.jsx(Jo,{composerController:h,clientThreadId:i})]})})]}),xo]}),So,bo]})})})}),go,ho]}):e.jsx(Po.Provider,{value:Pt,children:e.jsxs(Eo,{defaultOpen:vo,children:[e.jsx(No,{onOauthRedirect:_s,children:e.jsxs("div",{className:"max-xs:[--force-hide-label:none] relative z-1 flex h-full max-w-full flex-1 flex-col",children:[yo,js&&Si&&e.jsx(bd,{taskId:js.taskId,clientThreadId:i,onClose:()=>uo(!1)}),e.jsx(eg,{hasFiles:ue,pendingFiles:ie,isUploadDisabled:!ro,isNewThread:l,clientThreadId:i,highlightUploadTooltip:oo&&!ue,disableReason:Ps,uploadButtonDisabledReason:co,currentModel:r,conversationMode:q,state:Je,inputState:Rs,gizmoId:De,isTemporaryChat:Le,placeholder:ks,composerController:h,onSubmit:Ot,replyRegions:Ft,keepExpanded:!0,legacyFooterActions:Ie,legacySuggestionsPopoverContent:Ri,modelSupportedSystemHints:_t,contextualAnswerUserConnectionData:Lr,shouldUseBigComposer:B}),xo]})}),So,go,ho,bo]})})}const Eg=({clientThreadId:t,isNewThread:s,isGizmoThread:o,isProjectThread:n,isModelLoaded:r,currentModelId:a,onRequestCompletion:c,shouldUseUnifiedComposer:i,shouldUseBigComposer:l,onlyAllowImageUploads:d})=>{const m=We(),{pageType:f}=Td(),p=f?.type==="landing-page",x=u.useContext(Za),g=Rm(x),y=La();Ve(),Bd(m);const w=async A=>{if(be(t)?.isLoading!==!1)return;const P=await Fd(A);c(P)},k=u.useCallback(A=>{R.logEvent("Continue Completion"),c(Ld(A))},[c]),b=Dd.useState(A=>A.isReplayEnabled),S=er(x),v=e.jsxs(e.Fragment,{children:[e.jsx(Qp,{clientThreadId:t}),e.jsx(Is,{verticalMargin:"none",verticalPadding:g?"last-standard":"none",horizontalPadding:S?"none":"standard",children:e.jsx(Fs,{children:b?e.jsx(Id,{clientThreadId:t},t):e.jsx(rg,{clientThreadId:t,currentModelId:a,isNewThread:s,hideHeader:s,onRequestCompletion:w,onContinueGenerating:k,onAutocompleteSelect:m.onAutocompleteSelect,onlyAllowImageUploads:d,shouldUseBigComposer:l})})})]}),_=s&&e.jsx("div",{className:K("[display:var(--display-hidden-until-loaded,block)] md:absolute md:start-0 md:bottom-6 md:w-full"),children:e.jsx(Is,{verticalMargin:"none",verticalPadding:"none",horizontalPadding:"standard",children:e.jsx(Fs,{children:e.jsx(yr,{className:"block flex-1"})})})});return i?e.jsxs(e.Fragment,{children:[y&&_,e.jsx("div",{id:"thread-bottom",children:v}),!y&&_,s&&!p&&!o&&!0&&!n&&e.jsx(Is,{verticalMargin:"none",verticalPadding:"none",horizontalPadding:"standard",children:e.jsx(Fs,{children:e.jsx($p,{clientThreadId:t,currentModelId:a,isModelLoaded:r})})})]}):v};function rg({clientThreadId:t,currentModelId:s,disableDraftPersistence:o=!1,isNewThread:n,onRequestCompletion:r,onContinueGenerating:a,onComposerInput:c,onComposerChange:i,onAutocompleteSelect:l,headerClassName:d,hideHeader:m,onTaggingDropdownClose:f,onTaggingDropdownOpen:p,onlyAllowImageUploads:x,shouldUseBigComposer:g}){const{data:y,isLoading:w}=Ja(),[k,b,S,v,_]=Z(t,U=>{const ae=se.getCurrentNode(U);return[ae.message.clientMetadata?.errType!=null&&ae.message.clientMetadata.errType!=="info",Pm(se.getCurrentNode(U).message),U?.mode,U?.continuingFromSharedConversationId!=null,!!U?.continuingFromSharedPostId]}),A=Ve(),P=We(),B=jm({clientThreadId:t}),{isOpen:M,onClose:D}=Rd({type:"just-hit-rate-limit"}),I=u.useMemo(()=>B?!1:!k&&b,[k,b,B]),F=B,h=Ga(t),j=ln(h).data,E=Am(),O=j?.gizmo.tags?.includes(as.WorkspaceDisabled)&&!E?"workspaceDisallowsGizmo":y?.models.size===0?"noModelsAvailable":S?.kind===Ae.GizmoTest&&S.gizmo_id==null?"noTestGizmoId":null,G=Di(),Y=Pd(),Q=G.action==="moderate",{value:V}=ze("1860647109");return e.jsxs(e.Fragment,{children:[e.jsx(pp,{composerController:P,clientThreadId:t,currentModelId:s,isCompletionInProgress:B}),e.jsx("div",{className:"flex justify-center empty:hidden",children:Y&&Q&&V?e.jsx(Ed,{}):null}),M?e.jsx(Nd,{onClose:D}):null,e.jsx(ag,{clientThreadId:t,disableDraftPersistence:o,onCreateNewCompletion:r,onContinueGenerating:a,currentModelId:s,account:A,currentModelConfig:Ma(y?.models,s),areModelsLoading:w,isNewThread:n,isCompletionInProgress:B,className:"w-full",canContinue:I,disabled:!!O,disabledReason:O??void 0,canPause:F,isInteractableSharedThread:v||_,onComposerInput:c,onComposerChange:i,onAutocompleteSelect:l,headerClassName:d,hideHeader:m,onTaggingDropdownClose:f,onTaggingDropdownOpen:p,onlyAllowImageUploads:x,shouldUseBigComposer:g},t)]})}export{cp as D,kg as F,Rg as I,Pg as M,jg as N,rg as P,Eg as T,Mg as a,Wo as b,tg as c,br as d,ip as g,dr as h,Ag as u};
//# sourceMappingURL=a1fl09gjys8m3drr.js.map
