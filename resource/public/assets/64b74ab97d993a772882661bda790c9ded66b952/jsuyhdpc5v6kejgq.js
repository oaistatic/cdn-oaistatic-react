const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/m77rxbeaf85a301h.js","assets/ci5tkrccytan34lo.js","assets/ccccre6vnqbb7l94.js","assets/root-ggl0dfwq.css","assets/fztttvm3qzdvif1h.js","assets/conversation-small-dfayqh3x.css","assets/ijsfiw2h1rxkwhv5.js","assets/joa8jajuiu4xqpzn.js"])))=>i.map(i=>d[i]);
import{c as b,dG as z,L as U,O as q,bj as K,_ as Y}from"./ccccre6vnqbb7l94.js";import{r as t,j as n,a5 as M}from"./ci5tkrccytan34lo.js";import{P as Z,u as $}from"./hapan2fx2czn21gi.js";import{b as B,c as X}from"./grqqoygx78z5w4fx.js";import{aW as J,aX as c,iR as Q,iS as ee,i9 as te,iT as ne,aS as re,aU as y,iU as oe,hD as k,fs as se,iV as ae,iW as ie,hf as ce,hg as ue}from"./fztttvm3qzdvif1h.js";import{P as le}from"./a1fl09gjys8m3drr.js";import{I as de}from"./b6j7l37g2ond00ny.js";import"./kzhevji8i57j71hk.js";import"./h2gd34k3oh53zw7p.js";import"./k4lih7nb4umlxxxc.js";import"./m3p85h1r7wwh3ar4.js";import"./bgu7mt464bd85qmz.js";import"./ln3t6yic0tgf7gor.js";import"./bb4l02lm4p1hlo2s.js";import"./o5dcel4w1cacawdo.js";import"./j3zg44ruze86crbd.js";import"./eykh2s3cx0s4wv4b.js";import"./nplnc7nfjbqgwb50.js";import"./d6qfcfpf3ythcmx2.js";import"./hnwyihljdxrug66f.js";import"./csx7nt71oz1r0z6y.js";import"./khkh5m0f7cvgfw6e.js";function me(){const[e,r]=t.useState({undoStack:[],currentIndex:-1});function o(s){r(h=>({undoStack:[...h.undoStack.slice(0,h.currentIndex+1),s],currentIndex:h.currentIndex+1}))}function a(){r(s=>({undoStack:s.undoStack,currentIndex:Math.max(s.currentIndex-1,-1)}))}function d(){r(s=>({undoStack:s.undoStack,currentIndex:Math.min(s.currentIndex+1,s.undoStack.length-1)}))}function m(){r({undoStack:[],currentIndex:-1})}return{currentDrawnShape:e.undoStack.length>0?e.undoStack[e.currentIndex]:null,onNewDrawnShape:o,canUndoDrawing:e.currentIndex>=0,undoDrawing:a,canRedoDrawing:e.currentIndex<e.undoStack.length-1,redoDrawing:d,clearAllDrawings:m}}const he=0,fe=48;function ge({imageAsset:e,children:r,containerDimensions:o,isLoadingNewImage:a}){return n.jsxs(M.div,{className:"absolute",style:pe(e,o),...J,children:[r,n.jsx("div",{className:b("bg-token-main-surface-primary absolute inset-0 flex items-center justify-center transition-opacity duration-1000",a?"pointer-events-auto opacity-60":"pointer-events-none opacity-0")})]})}function pe(e,r){const{width:o,height:a}=e,{width:d,height:m}=r,s=d-2*he,h=m-2*fe,f=o/a,u=s/h,l=f>u,x=l?s:h*f,I=l?s/f:h;return{top:"50%",left:"50%",width:x,height:I,transform:"translate(-50%, -50%)"}}const xe=({onEscape:e})=>{t.useEffect(()=>{function r(o){o.key==="Escape"&&e()}return document.addEventListener("keydown",r),()=>{document.removeEventListener("keydown",r)}},[e])},Ie=q(()=>Y(()=>import("./m77rxbeaf85a301h.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(e=>e.DynamicDrawingCanvas)),N=126,we=63,Se=136,Ce=50;function De({width:e,height:r,delay:o=Ce}){const[a,d]=t.useState(!1);return t.useEffect(()=>{const m=setTimeout(()=>{d(!0)},o);return()=>{clearTimeout(m)}},[o]),a?n.jsx("div",{className:"flex max-h-full max-w-full items-center justify-center",style:{width:e,height:r,aspectRatio:`${e} / ${r}`},children:n.jsx("div",{className:"bg-token-border-default h-full w-full animate-pulse"})}):null}function qe({image:e,isLoadingNewImage:r,clientThreadId:o,onClose:a,messageId:d,onRequestCompletion:m,editorControls:s,footer:h}){const f=z(o),[u,l]=t.useState(c.Default),[x,I]=t.useState({width:window.innerWidth,height:window.innerHeight-N}),P=Q(),[_,T]=t.useState(!1),S=me(),{currentDrawnShape:w,onNewDrawnShape:L,clearAllDrawings:G}=S,C=t.useRef(null),O=t.useMemo(()=>new Z(B()),[]),D=t.useRef(void 0),g=t.useMemo(()=>ee({pointer:e,conversationId:f,messageId:d,source:"editor"}),[e,d,f]),W=te(i=>{const{width:p,height:R}=i.contentRect;I({width:p,height:P?R-we:R-N})});xe(t.useMemo(()=>({onEscape:()=>{u===c.Selecting?l(c.Default):a()}}),[u,a])),ne(t.useMemo(()=>({image:e,currentDrawnShape:w,onCleared:()=>l(c.Default),getImageData:()=>C.current?.getImageData()}),[e,w])),t.useEffect(()=>{u!==c.Selecting&&G()},[u]),t.useEffect(()=>{l(c.Default)},[e]);const v=$(o),E=t.useCallback(i=>{l(c.Default),v(i),a()},[v,a]),A=t.useMemo(()=>m||E,[m,E]),[H]=U(o,i=>[i?.modelId]),j=re({imageAssetPointer:e,serverThreadId:f}),F=t.useCallback(()=>{l(c.Selecting),y.inpaintClick({analyticsContext:g})},[g]),V=t.useCallback(i=>{const p=i.deltaY<0?"in":"out";i.ctrlKey&&D.current!==p&&(y.zoom({zoomType:p,analyticsContext:g}),D.current=p)},[g]);return n.jsx(oe.Provider,{value:g,children:n.jsxs("div",{ref:W,className:"flex h-full w-full flex-col items-center justify-between",onWheel:V,children:[s??n.jsx(de,{clientThreadId:o,imageAsset:e,mode:u,setMode:l,inpaintingDrawingState:S,isLoadingNewImage:r,onClose:a,onInpaintClick:F,messageId:d,serverThreadId:f}),n.jsx("div",{className:"relative flex w-full grow items-center justify-center",children:n.jsxs(ge,{imageAsset:e,containerDimensions:x,isLoadingNewImage:r,children:[j&&u!==c.Selecting&&n.jsx("img",{alt:k(e),className:"absolute inset-0 z-1 opacity-0",src:j}),!_&&n.jsx(De,{width:e.width,height:e.height}),n.jsx(se,{className:"h-full w-full",alt:k(e),onLoad:()=>{T(!0)},src:e.url,width:e.width,height:e.height,fadeIn:!1}),n.jsx("div",{className:b("absolute inset-0",u===c.Selecting?"":"hidden"),children:n.jsx(Ie,{drawingCanvasRef:C,color:"rgba(0, 122, 255, 0.5)",dashedOutlineColor:"rgba(255, 255, 255, 0.65)",cursorWidth:Se,canvasWidth:e.width,canvasHeight:e.height,currentDrawnShape:w,onNewDrawnShape:L})})]})}),n.jsx("div",{className:"flex min-h-[132px] w-full flex-col items-center justify-end max-sm:min-h-[84px]",children:n.jsx(M.div,{className:"mb-6 flex w-[90%] items-center justify-center lg:w-[53%]",layout:!0,transition:{duration:.2,ease:"easeInOut"},children:h??n.jsx(ae,{value:{isImageGenEditor:!0,isInpainting:u===c.Selecting,onCancelInpaint:()=>l(c.Default)},children:n.jsx(X.Provider,{value:O,children:n.jsx(le,{clientThreadId:o,isNewThread:K(o),currentModelId:H??ie(void 0).id,onContinueGenerating:i=>A(ue(i)),onRequestCompletion:async i=>A(await ce(i)),hideHeader:!0})})})})})]})})}export{qe as ImageGenNewEditor,De as ShimmerLoader};
//# sourceMappingURL=jsuyhdpc5v6kejgq.js.map
