import{i as v,j as n,a6 as F,a5 as B}from"./ci5tkrccytan34lo.js";import{cv as _,H as s,E as w,F as L,c as k,ge as Q,bT as D}from"./ccccre6vnqbb7l94.js";import{c3 as y,c4 as N,c5 as O,c6 as P,c7 as q,a9 as R,c8 as U,c9 as H,ca as C,cb as I,cc as $,cd as K,ce as W,w as G,cf as V,ah as J,am as X,cg as Y,ch as Z}from"./fztttvm3qzdvif1h.js";import{T as h,a as z}from"./ci2m3wbqqcn0abts.js";import"./hapan2fx2czn21gi.js";import"./kzhevji8i57j71hk.js";function _e({messages:e,isRequestActive:t,isLastMessageInTurn:a,isRetrieval:r,isUsingGizmo:i,isUsingSnorlax:o}){const c=pe({messages:e}),g=ee(e),u=g.filter(d=>ce(d,!1)&&!ue(d)),p=u[u.length-1]??void 0,l=v(),{name:M}=H(),T=M?I:$;if(ge(e).some(({content:d})=>d.content_type===_.SystemError))return null;let f=h.Running;const A=u.filter(d=>d.type===s.Search).length,x={count:u.length-A,domain:p?C(S(p)??""):void 0,query:p?j(p):void 0};let m=r?i?o?l.formatMessage(T.searchingProjectFiles):l.formatMessage({id:"browsingMessage.searchingKnowledge",defaultMessage:"Searching my knowledge"}):l.formatMessage({id:"browsingMessage.startingRetrieval",defaultMessage:"Reading documents"}):l.formatMessage({id:"message.tools.browse.running",defaultMessage:"Searching the web"});return e.some(K)?(f=h.Stopped,m=r?i?l.formatMessage({id:"browsingMessage.searchingKnowledgeStopped",defaultMessage:"Stopped searching knowledge"}):l.formatMessage({id:"browsingMessage.retrievalStopped",defaultMessage:"Stopped reading documents"}):l.formatMessage({id:"message.tools.browse.stopped",defaultMessage:"Search stopped"})):!a||!t?g.length>0&&g.every(d=>d.didError)?(f=h.Error,m=r?i?l.formatMessage({id:"browsingMessage.searchingKnowledgeFailed",defaultMessage:"Error searching knowledge"}):l.formatMessage({id:"browsingMessage.retrievalFailed",defaultMessage:"Error reading documents"}):l.formatMessage({id:"message.tools.browse.failed",defaultMessage:"Search failed"})):(f=h.Finished,m=r?null:x.count===0?l.formatMessage({id:"message.tools.browse.started",defaultMessage:"Searching the web..."}):l.formatMessage({id:"message.tools.browse.finished",defaultMessage:"Searched {count, plural, =0 {0 sites} one {# site} other {# sites}}"},x)):c.length>0?m=fe({contextualAnswerSources:c,intl:l}):u.length>0&&(m=le(l,x,r,i,u[u.length-1])),(u.length>0||r&&a)&&f!==h.Error?n.jsx(z,{highlightedCommand:m,showWorkUserSetting:!1,status:f,children:u.length===0?null:n.jsx(te,{commands:u})}):n.jsx(de,{$isError:f===h.Error,children:m})}function b(e){return e.metadata?.command==="quote"||e.metadata?.command==="quote_full"||e.metadata?.command==="quote_lines"}function ee(e){return e.map((t,a)=>{if(t.author.role!==w.Tool||a>0&&b(t)&&b(e[a-1]))return null;const r=t.metadata;if(!r)return null;const{command:i,status:o}=r;return i?{type:i,status:o,didError:t.content.content_type===_.SystemError,message:t}:null}).filter(V)}function te({commands:e}){const t=v();return n.jsx("div",{className:"divide-token-border-default border-token-border-default mb-4 divide-y rounded-xl border text-sm",children:n.jsx(F,{initial:!1,children:e.map((a,r)=>{const i=re(a);if(i==null)return null;const{icon:o,url:c,title:g,externalLink:u}=i,p=c?C(c):void 0,l=g?typeof g=="string"?g:t.formatMessage(g):null,M=c&&J(c);return n.jsx(B.div,{initial:"collapsed",animate:"open",variants:{open:{opacity:1,height:"auto"},collapsed:{opacity:0,height:0}},children:n.jsxs(se,{url:u??c,className:k("flex items-start gap-3 px-4 py-3",g?"text-token-text-secondary":"text-token-text-primary",r===0&&"rounded-t-xl",r===e.length-1&&"rounded-b-xl"),children:[o?n.jsx(o,{className:"icon-sm text-token-text-secondary mt-0.5 shrink-0"}):c?n.jsx(X,{url:c,className:"mt-1"}):null,n.jsxs("div",{children:[l&&n.jsxs("div",{className:"text-token-text-primary line-clamp-1",children:[M&&`${M} — `,l]}),n.jsx("div",{children:p})]})]})},r)})})})}function se({url:e,children:t,className:a}){return e?n.jsxs("a",{href:e,target:"_blank",className:k(a,"group hover:bg-token-main-surface-secondary relative"),rel:"noreferrer",children:[t,n.jsx("div",{className:"from-token-main-surface-secondary invisible absolute end-3 bg-linear-to-l to-transparent ps-4 group-hover:visible",children:n.jsx(Z,{className:"icon-md text-token-text-secondary"})})]}):n.jsx("div",{className:a,children:t})}function ae(e){const t=e.message.metadata?._cite_metadata?.metadata_list[0];return t!=null&&t.type!=="file"?t.title:null}function j(e){return e.message.metadata?.args?.[0]}function re(e){switch(e.type){case s.Search:{const t=e.message.metadata?.search_engine;if(t&&t!==Q.Bing)return null;const a=j(e);return{icon:Y,url:e.message.metadata?.message_source==="apple"?null:"bing.com",externalLink:oe(e),title:a?`“${a}”`:{id:"message.tools.browse.querying",defaultMessage:"Querying",description:"Status message when issuing a query"}}}case s.Click:case s.MultiClick:case s.Lookup:case s.OpenUrl:case s.Open:case s.Quote:case s.QuoteFull:case s.QuoteLines:case s.Scroll:return{url:S(e),title:ae(e)??void 0};case s.Spinner:case s.Back:return null}}function ne(e){const t=new URLSearchParams({query:e.query});return`${D}/bing/redirect?${t.toString()}`}function oe(e){const t=e.message.metadata?.args?.[0];return t===void 0?null:ne({query:t})}function le(e,t,a,r,i){switch(i?.type){case s.Click:case s.MultiClick:case s.Lookup:case s.OpenUrl:case s.Quote:case s.QuoteFull:case s.QuoteLines:case s.Scroll:case s.Open:case s.Back:return e.formatMessage({id:"message.tools.browse.reading",defaultMessage:"Browsing {domain}"},t);case s.Search:case void 0:return a?r?e.formatMessage({id:"browsingMessage.searchingKnowledge",defaultMessage:"Searching my knowledge"}):e.formatMessage({id:"browsingMessage.startingRetrieval",defaultMessage:"Reading documents"}):e.formatMessage({id:"message.tools.browse.searching",defaultMessage:'Searching "{query}"'},t);case s.Spinner:return null}}function ie(e){const t=e.message.metadata?._cite_metadata?.metadata_list[0];return t!=null&&t.type==="file"?t.name:null}function ce(e,t){switch(e.type){case s.Search:return!0;case s.Click:case s.Lookup:case s.MultiClick:case s.OpenUrl:case s.Quote:case s.QuoteFull:case s.QuoteLines:return t?ie(e)!=null:S(e)!=null;case s.Open:case s.Back:case s.Scroll:case s.Spinner:return!1}}function ue(e){return e.message.metadata?.message_source==="apple"}function S(e){const t=e.message.metadata?._cite_metadata?.metadata_list[0];return t!=null&&t.type!=="file"?t.url:null}function ge(e){return e.filter(t=>t.author.role===w.Tool)}const de=L.p`first:mt-0 my-1.5 h-8 flex items-center ltr:me-auto rtl:ms-auto empty:hidden
${({$isError:e})=>e?"text-token-text-error":"text-token-text-secondary"}`,E={google_drive:"Google Drive",slack:"Slack",github:"GitHub",slurm_sharepoint:"SharePoint",slurm_linear:"Linear",slurm_box:"Box",slurm_dropbox:"Dropbox",slurm_google_drive:"Google Drive"},me={google_drive:y,slack:U,github:R,slurm_sharepoint:q,slurm_linear:P,slurm_box:O,slurm_dropbox:N,slurm_google_drive:y},pe=({messages:e})=>[...e.filter(W).reduce((r,i)=>(i.metadata?.retrieval_search_sources?.forEach(o=>{(o.product_type==="contextual_answers"||o.product_type==="slurm")&&o.source_name in E&&r.add(o.source_name)}),r),new Set)],fe=({contextualAnswerSources:e,intl:t})=>{const a=e.map(o=>E[o]??o).filter(Boolean),r=e.map(o=>{const c=me[o]??G;return n.jsx(c,{className:"icon-sm"},o)}).filter(Boolean),i=e.length===1?t.formatMessage({id:"Jzt2om",defaultMessage:"Reading {source}"},{source:a[0]}):e.length===2?t.formatMessage({id:"wTM7gR",defaultMessage:"Reading {source1} and {source2}"},{source1:a[0],source2:a[1]}):t.formatMessage({id:"xnwjH1",defaultMessage:"Reading {source1}, {source2} and more"},{source1:a[0],source2:a[1]});return e.length>0?n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"flex items-center gap-1",children:r}),i]}):void 0};export{_e as BrowsingMessage,me as CA_SOURCE_TO_ICON_MAP,E as CA_SOURCE_TO_TEXT_MAP,pe as getCASources,fe as getContextualAnswerDisplayText,S as getVisitedUrl};
//# sourceMappingURL=hp7xs1ygys4kmfnn.js.map
