import{ac as j,B as y,fe as k}from"./ccccre6vnqbb7l94.js";import{i as P,f as v,a as C,D as _,r as c,u as M,j as e,M as i}from"./ci5tkrccytan34lo.js";import{d3 as N,d4 as b,a9 as q}from"./fztttvm3qzdvif1h.js";import{S as p}from"./fmqpx3wqey84zgy2.js";import{b as I}from"./j35k0ib6x4x2st6f.js";import{M as R}from"./bmtvnfjxiss7l267.js";import{g as S,W as T,b as E,w as W}from"./t7vnx1cc2uzzkq81.js";import{a as B}from"./g8e8o1dzfmoj72zp.js";import"./h1rqozkinxrlxfws.js";import"./j3zg44ruze86crbd.js";import"./grqqoygx78z5w4fx.js";import"./hapan2fx2czn21gi.js";import"./kzhevji8i57j71hk.js";import"./h2gd34k3oh53zw7p.js";import"./a1fl09gjys8m3drr.js";import"./k4lih7nb4umlxxxc.js";import"./m3p85h1r7wwh3ar4.js";import"./bgu7mt464bd85qmz.js";import"./ln3t6yic0tgf7gor.js";import"./bb4l02lm4p1hlo2s.js";import"./o5dcel4w1cacawdo.js";import"./eykh2s3cx0s4wv4b.js";import"./nplnc7nfjbqgwb50.js";import"./d6qfcfpf3ythcmx2.js";import"./hnwyihljdxrug66f.js";import"./musjw8fjkljbblfz.js";import"./pcjr7askdf0x3oga.js";import"./n1daj33n3xqfllpk.js";import"./o6tnov12l4y47p1a.js";import"./j4mjggthdqynoz2x.js";import"./kwkjmzn9zjnazhqf.js";import"./j6dzpp4h0n6rdhxr.js";function F(){const a=P(),o=v(),n=C(),{taskId:s,turnId:r}=_(),[f,m]=c.useState(!1),x=c.useMemo(()=>S(s,r,n,{refetchInterval:t=>{const d=t.state?.data?.turn?.pull_request_status;switch(d){case null:case void 0:case"not_created":case"creating":return 2e3;case"failed":case"created":case"updated":return!1;default:N(d)}}}),[s,r,n]),{data:u}=M(x),g=j(),h=async()=>{if(!(!s||!r))try{m(!0),await T.createPr(s,r,Q()),await n.invalidateQueries({queryKey:["wham","task"]})}catch(t){t instanceof E&&W(t,r,a,g)}finally{m(!1)}},l=u?.turn?.pull_request_data?.url;c.useEffect(()=>{l&&(window.location.href=l)},[l]);const w=u?.turn?.pull_request_status==="failed";return e.jsx(R,{children:e.jsx(I,{mobileHeaderRightContent:null,children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx(B,{className:"absolute start-0 end-0 top-0",children:e.jsx("div",{className:"flex w-full justify-end",children:e.jsx(b,{onClick:()=>{window.opener?(window.opener.focus(),window.close()):o(`/codex/tasks/${s}`)},icon:e.jsx(p,{}),label:a.formatMessage({id:"wham.task.pr.header.title",defaultMessage:"Back to task"})})})}),e.jsx("div",{className:"flex grow items-center justify-center p-4",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(q,{className:"mb-4 h-15 w-15"}),w?e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"text-token-text-error flex items-center gap-1",children:e.jsx(i,{id:"wham.task.pr.inProgress.error.description",defaultMessage:"Failed to create pull request. Please try again."})}),e.jsx(y,{color:"secondary",size:"small",icon:p,loading:f,onClick:t=>{t.preventDefault(),t.stopPropagation(),h()},children:e.jsx(i,{id:"wham.task.pr.inProgress.error.button",defaultMessage:"Retry"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"loading-shimmer-pure-text text-lg font-semibold",children:e.jsx(i,{id:"wham.task.pr.inProgress.title",defaultMessage:"Creating pull requestâ€¦"})}),e.jsx("p",{className:"text-token-text-secondary text-sm",children:e.jsx(i,{id:"wham.task.pr.inProgress.description",defaultMessage:"Pull request will automatically open once it has been created."})})]})]})})]})})})}function Q(){const o=new URLSearchParams(location.search).get("mode");if(o==="draft")return"draft";if(o==="auto_merge")return"auto_merge"}const he=()=>[{title:"Codex"}],we=k(function(){return e.jsx(F,{})});export{we as default,he as meta};
//# sourceMappingURL=i7vt7puzbrd28d1i.js.map
