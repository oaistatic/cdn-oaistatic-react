import{r as l,j as e,M as j,a5 as T}from"./ci5tkrccytan34lo.js";import{W as v}from"./pcjr7askdf0x3oga.js";import{an as b,ao as S,ap as L,aq as D,ar as y,as as R,at as E,am as z,au as F,av as A,aw as H,ax as U,ay as W,az as q,aA as O}from"./fztttvm3qzdvif1h.js";import{a as p,b as k}from"./m3p85h1r7wwh3ar4.js";import{bi as V,bS as X,bT as J}from"./ccccre6vnqbb7l94.js";const K={positive:E,negative:R,neutral:y,mixed:y},Q={positive:"Positive",negative:"Negative",neutral:"Mixed",mixed:"Mixed"};function ie({clientThreadId:t,messageId:i,product:n,trackContentReferenceEvent:a,onProductEntityUpdated:o}){const{productInfo:r,isLoading:s,isCached:f}=Y({clientThreadId:t,messageId:i,product:n}),[d]=l.useState(f),c=l.useRef(!1);l.useEffect(()=>{o&&r.productEntity&&o(r.productEntity),r.productEntity&&!c.current&&(c.current=!0,a("Product Sidebar Entity Loaded","product_sidebar_entity_loaded","product_entity"))},[r.productEntity,o,a]);const{showDebugConversationTurns:h}=A();return e.jsx("div",{children:s?e.jsxs("div",{className:"flex flex-col gap-4 px-6 pb-6",children:[e.jsx(p,{index:0,width:50,heightSize:"sm"}),e.jsxs(k,{children:[e.jsx(p,{index:1,width:100,heightSize:"sm"}),e.jsx(p,{index:2,width:100,heightSize:"sm"}),e.jsx(p,{index:3,width:30,heightSize:"sm"})]})]}):e.jsxs("div",{className:"bg-token-bg-primary flex flex-col",children:[e.jsx(Z,{contentReference:r.productRationale,trackContentReferenceEvent:a,disableAnimation:d}),e.jsx($,{contentReference:r.productReviews,trackContentReferenceEvent:a,disableAnimation:d}),!1]})})}function Z({contentReference:t,trackContentReferenceEvent:i,disableAnimation:n}){const a=l.useRef(!1);return l.useEffect(()=>{t&&!a.current&&(a.current=!0,i("Product Sidebar Rationale Loaded","product_sidebar_rationale_loaded","product_rationale"))},[t,i]),t?e.jsx(b,{title:e.jsx(j,{id:"XgsZPF",defaultMessage:"Why you might like this"}),children:e.jsx("div",{className:"text-sm",children:e.jsx(S,{isDisabled:n,children:e.jsxs(L,{tag:"p","data-start":0,"data-end":t.rationale.length,children:[e.jsx("span",{className:"me-1",children:t.rationale}),t.grouped_citation&&e.jsx(v,{webpageItem:t.grouped_citation,trackContentReferenceEvent:i,analyticsMetadata:{section:"product_rationale",section_location:"sidebar"},isLastHovered:!0,noMarginStart:!0})]})})})}):null}function $({contentReference:t,trackContentReferenceEvent:i,disableAnimation:n}){const a=l.useRef(!1);l.useEffect(()=>{t&&!a.current&&(a.current=!0,i("Product Sidebar Reviews Loaded","product_sidebar_reviews_loaded","product_reviews"))},[t,i]);function o(s){return new URL(s).hostname.replace(/^www\./,"")}function r(s){return t?s.cite?t.cite_map[s.cite]?.url:s.cite_url:null}return t?e.jsx(b,{title:e.jsx(j,{id:"p8XHcJ",defaultMessage:"What people are saying"}),children:e.jsxs("div",{className:"flex flex-col gap-6",children:[t.summary&&e.jsx(S,{isDisabled:n,children:e.jsx(D,{className:"-mb-2 text-sm",children:t.summary})}),t.reviews.map((s,f)=>{const d=K[s.sentiment??"neutral"],c=r(s);return e.jsxs(T.div,{className:"relative flex flex-col gap-2",...!n&&{initial:{opacity:0},animate:{opacity:1},transition:{duration:.4}},children:[e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[e.jsx(z,{url:c??"",className:"h-8 w-8 rounded-full",size:128,minSize:16,fallback:e.jsx(F,{className:"text-token-text-tertiary"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"text-sm font-semibold",children:s.source}),e.jsxs("div",{className:"text-token-text-secondary flex flex-row gap-1 text-xs",children:[e.jsx("div",{children:c?o(c):""}),s.sentiment&&e.jsxs(e.Fragment,{children:["Â·",e.jsx(d,{className:"icon-sm text-token-text-secondary"}),Q[s.sentiment]]})]})]})]}),e.jsxs("div",{className:"text-sm",children:[s.theme&&e.jsx("div",{className:"font-semibold",children:s.theme}),e.jsx("span",{className:"me-1",children:s.summary}),e.jsx(B,{cite:s.cite,contentReference:t,trackContentReferenceEvent:i})]})]},f)})]})}):null}function B({cite:t,contentReference:i,trackContentReferenceEvent:n,analyticsMetadata:a}){const{cite_map:o}=i,r=t?o[t]:null;return r?e.jsx(v,{webpageItem:r,trackContentReferenceEvent:n,analyticsMetadata:{...a,section:"product_reviews",section_location:"sidebar"},isLastHovered:!0,noMarginStart:!0}):null}async function*G({conversationId:t,messageId:i,productQuery:n,productLookupData:a,evalPreset:o},r){const s=W(`${J}/search/product_info`,{method:"POST",headers:{...X({isAuthOptional:!0}),"Content-Type":"application/json"},body:{conversation_id:t,message_id:i,eval_preset:o,product_query:n,supported_encodings:[q.V1],...a?{product_lookup_data:a}:{}},signal:r}),f=O(s);for await(const d of f)"data"in d&&(yield d.data)}const g=new Map;function Y({clientThreadId:t,messageId:i,product:n}){const a=V(t)??t,o=[a,i,n.title].join(":"),[r,s]=l.useState(g.get(o)??{productReviews:void 0,productRationale:void 0,productEntity:void 0,__debug:void 0}),[f,d]=l.useState(!1),c=l.useRef(!1);return l.useEffect(()=>{async function h({conversationId:_,messageId:P,productQuery:w,productLookupData:N}){if(c.current)return;const x=H({namespace:U.ProductSidebar});try{c.current=!0,d(!0);const I=new URLSearchParams(window.location.search).get("product_reviews_eval_preset"),M=G({conversationId:_,messageId:P,productQuery:w,productLookupData:N,evalPreset:I});let u={productReviews:void 0,productRationale:void 0,productEntity:void 0,__debug:void 0};for await(const m of M)m.type==="product_reviews"?(u={...u,productReviews:m},x.logTiming("time_to_first_review")):m.type==="product_rationale"?(u={...u,productRationale:m},x.logTiming("time_to_rationale")):m.type==="product_entity"?(u={...u,productEntity:m},x.logTiming("time_to_product_entity")):m.type==="__debug"&&(u={...u,__debug:m}),["product_reviews","product_rationale"].includes(m.type)&&d(!1),s(u);g.set(o,u)}finally{c.current=!1,d(!1),x.logTiming("sidebar_loaded")}}(async function(){g.has(o)||a&&i&&await h({conversationId:a,messageId:i,productQuery:n.title,productLookupData:n.product_lookup_data})})()},[i,n.title,n.product_lookup_data,o,a]),{productInfo:r,isLoading:f,isCached:g.has(o)}}export{ie as P,Z as a,$ as b};
//# sourceMappingURL=n1daj33n3xqfllpk.js.map
