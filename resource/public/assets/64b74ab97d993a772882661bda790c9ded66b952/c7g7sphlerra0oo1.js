import{r as g,u as m}from"./ci5tkrccytan34lo.js";import{ca as i,cb as r}from"./ccccre6vnqbb7l94.js";import{u as L}from"./ivaufcylsc183gln.js";import{cJ as u}from"./fztttvm3qzdvif1h.js";const c="last_checked_loc",f=24*60*60*1e3,s="last_denied_loc",d=60*60*1e3;function C(){const[o]=L(),{data:e}=m({queryKey:["userLocation",o.useLocation],queryFn:({queryKey:[t,a]})=>S({enabled:a}),initialData:y(o.useLocation),networkMode:"always",refetchOnMount:"always",refetchOnWindowFocus:"always",staleTime:0});return e}function y(o){if(o){const e=i.getCookie(r.LastLocation);if(e)try{return JSON.parse(e)}catch{return l(),null}}return null}async function S({enabled:o}){if(!o)return l();if((await A())?.state!=="granted"){const t=localStorage.getItem(c);if(t){const a=Number(t),n=i.getCookie(r.LastLocation);if(n&&Date.now()-f<a)try{return JSON.parse(n)}catch{}}}const e=localStorage.getItem(s);if(e){const t=Number(e);if(Date.now()-d<t)return null}return await new Promise(t=>{navigator.geolocation.getCurrentPosition(a=>{const n={latitude:a.coords.latitude,longitude:a.coords.longitude,locationAccuracy:a.coords.accuracy};i.setCookie(r.LastLocation,JSON.stringify(n),{maxAge:u}),localStorage.setItem(c,Date.now().toString()),t(n)},()=>{localStorage.setItem(s,Date.now().toString()),t(l())},{enableHighAccuracy:!0,maximumAge:0})})}async function A(){return navigator?.permissions?await navigator.permissions.query({name:"geolocation"}):null}const _={latitude:null,longitude:null,locationAccuracy:null};function l(){return i.setCookie(r.LastLocation,JSON.stringify(_),{maxAge:u}),localStorage.removeItem(c),localStorage.removeItem(s),null}g.createContext(null);export{C as u};
//# sourceMappingURL=c7g7sphlerra0oo1.js.map
