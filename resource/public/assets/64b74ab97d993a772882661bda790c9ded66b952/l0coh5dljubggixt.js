import{j as e,i as F,k as A,f as B,r,M as N,a6 as D,a5 as O,L as U,a9 as C}from"./ci5tkrccytan34lo.js";import{B as z}from"./91eskp17oms2am6q.js";import{b as V,c as q}from"./grqqoygx78z5w4fx.js";import{P as G}from"./hapan2fx2czn21gi.js";import{kx as _,cL as $,g9 as K,cN as Q,d5 as X,ky as J,b7 as Y,b8 as Z,d2 as ee,ga as se,g7 as te,ii as R}from"./fztttvm3qzdvif1h.js";import{I as E,b0 as M,y as ae,B as ne,c as re,fd as oe,q as ie,aX as ce,u as W}from"./ccccre6vnqbb7l94.js";import{b as le}from"./j35k0ib6x4x2st6f.js";import{W as de}from"./i4c1gncd98zmt3g7.js";import{b as me,a as ue,c as xe,h as fe}from"./g8e8o1dzfmoj72zp.js";import{W as he}from"./p1uclklbtvr1kdj7.js";import{T as pe}from"./ip3ne85ldg7fv7rs.js";import{c as f,d as ge,j as H,l as ke}from"./t7vnx1cc2uzzkq81.js";import{S as ve}from"./fmqpx3wqey84zgy2.js";import{I as be}from"./n8xzbxiejwlahre8.js";import{a as je,b as we}from"./j4mjggthdqynoz2x.js";import{u as Se}from"./i97948bily1a57ta.js";function Ne({disabled:c,children:o}){return c?e.jsx("div",{className:"pointer-events-none opacity-50 select-none","aria-hidden":"true",tabIndex:-1,inert:!0,children:o}):o}function Te(){const c=F(),o=f(({tasksFilter:d})=>d),h=f(({setTasksFilter:d})=>d),p=E(),m=A(),n=B(),v=M(p,"2665240312"),u=r.useCallback(d=>{h(d);const j=new URLSearchParams(m.search);j.set("tab",d==="archived"?"archived":"all"),n({pathname:m.pathname,search:j.toString()},{replace:!0})},[h,m,n]);return e.jsx("div",{className:"border-token-border-primary mt-4 flex w-full items-center border-b align-middle md:mt-6",children:v&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(pe,{currentTab:o,onChange:u,withUnderline:!0,tabs:[{label:c.formatMessage({id:"wham.whamTasksHeader.all",defaultMessage:"Tasks"}),key:"current"},{label:c.formatMessage({id:"wham.whamTasksHeader.archived",defaultMessage:"Archive"}),key:"archived"}]})})})}function ye(){const c=F(),o=f(({tasksFilter:i})=>i),{data:h,isLoading:p,error:m,fetchNextPage:n,hasNextPage:v,isFetchingNextPage:u,refetch:d,isPending:j}=ge({refetchOnMount:!0,refetchOnWindowFocus:!0}),g=h?.pages.flatMap(i=>i.items??[])??[],T=f(i=>i.pendingTaskIds),w=g.length>0,[l,y]=r.useState(null),t=o==="archived"?[]:Array.from(Object.entries(T)).filter(([i,b])=>!g.some(k=>k.id===b)).map(([i])=>i).reverse(),a=g.length===0&&t.length===0;return e.jsx("div",{className:"flex flex-col justify-center",children:p&&!w?e.jsx("div",{className:"mt-4 flex h-full w-full items-center justify-center",children:e.jsx(ae,{})}):e.jsxs(e.Fragment,{children:[a&&e.jsx(e.Fragment,{children:m?e.jsxs("div",{className:"mt-6 flex w-full flex-col items-center justify-center gap-2 text-sm",children:[e.jsx("div",{className:"text-token-text-error",children:e.jsx(N,{id:"wham.whamTasksSection.errorLoadingTasks",defaultMessage:"Error loading tasks"})}),e.jsx(ne,{color:"secondary",onClick:()=>d(),children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(N,{id:"wham.whamTasksSection.retry",defaultMessage:"Retry"}),e.jsx(ve,{className:"icon-xs"})]})})]}):e.jsx("div",{className:"mt-6 flex h-full w-full items-center justify-center",children:e.jsx("div",{className:"text-token-text-secondary text-sm",children:o==="current"?c.formatMessage({id:"wham.whamTasksSection.noActiveTasks",defaultMessage:"No active tasks"}):c.formatMessage({id:"wham.whamTasksSection.noArchivedTasks",defaultMessage:"No archived tasks"})})})}),o!=="archived"&&t.map(i=>e.jsx(je,{},i)),g.map((i,b)=>e.jsx(we,{index:b,taskListItem:i,hoveredIndex:l,onMouseEnter:()=>{y(b)},onMouseLeave:()=>y(null)},i.id)),e.jsx(be,{isFetchingNextPage:u||j,hasNextPage:v??!1,fetchNextPage:n})]})})}const Ce=r.memo(ye);function Ee(){const c=E();return M(c,"3984934927")}function Me(){const{eligible:c,markAsViewed:o}=_(),h=f().environmentId,{data:p,isLoading:m}=H(),n=p?.find(t=>t.id===h),v=p?.some(t=>t.setup.length>0)??!1,{data:u,isLoading:d}=ke(),j=u??!1,g=$(),T=K(),w=r.useMemo(()=>[{id:"step-1",link:"/codex/settings/environment/create",checked:!0,label:e.jsx(N,{id:"codex.onboarding.step-1",defaultMessage:"Set up your first environment"})},{id:"step-2",checked:j,label:e.jsx(N,{id:"codex.onboarding.step-2",defaultMessage:"Create your first task"})},{id:"step-3",checked:v,link:`/codex/settings/environment/${n?.id}/edit#setup-script`,label:e.jsx(N,{id:"codex.onboarding.step-3",defaultMessage:"Install dependencies for the ‘{environmentName}’ environment",values:{environmentName:n?.label}})}],[v,n,j]),l=w.every(t=>t.checked);r.useEffect(()=>{l&&o()},[l,o]);const y=g||!c||m||d||!n||l;return e.jsx(D,{children:y?null:e.jsx(O.div,{className:"fixed end-6 bottom-6 z-50",initial:{opacity:0},animate:{opacity:1},transition:{duration:T?1e-5:.5},children:e.jsxs("div",{className:"bg-token-bg-primary border-token-border-default flex w-[272px] flex-col gap-4 rounded-xl border p-4 shadow-xl",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(N,{id:"k3HHpd",defaultMessage:"Finish setting up Codex"})})}),e.jsx("div",{className:"flex flex-col gap-3",children:w.map((t,a)=>{const i=!t.checked&&w.filter(k=>!k.checked).length===1&&w.findIndex(k=>!k.checked)===a,b=e.jsxs("div",{className:"flex items-start gap-3 select-none",children:[e.jsx("div",{className:"mt-0.5",children:t.checked?e.jsx(Q,{className:"icon-md text-token-text-tertiary"}):e.jsx("span",{className:"icon-md border-token-text-secondary inline-block h-4 w-4 rounded-full border bg-transparent"})}),e.jsx("span",{className:re("text-sm",t.checked?"text-token-text-tertiary line-through":"text-token-text-primary"),children:t.label}),t.link&&!t.checked&&e.jsx(X,{className:"icon-md text-token-text-primary"})]},t.id);return t.link&&!t.checked?e.jsx(U,{to:t.link,onClick:()=>{i&&o()},children:b},t.id):b})})]})})})}function $e(){const c=E(),o=J(),h=Ee(),p=Y(Z.workspaceId),{eligible:m}=ee(),n=se();Se();const v=M(c,"547652119");return f(u=>u.showReactQueryDevtools),o?v?e.jsx(C,{to:"/codex/failwhale"}):n==="DISABLED"?e.jsx(C,{to:"/",replace:!0}):m?e.jsx(C,{to:"/codex/onboarding"}):e.jsxs(e.Fragment,{children:[e.jsx(z,{page:"codex"},p),!1,e.jsx(le,{mobileHeaderRightContent:null,children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx(ue,{children:e.jsx(xe,{hideNotificationBell:!0})}),e.jsx(oe,{children:e.jsx(Pe,{})})]})})]}):h?e.jsx(me,{}):e.jsx(C,{to:"/"})}const Pe=()=>{const c=f(({setPromptDraft:s})=>s),o=f(({setTasksFilter:s})=>s),h=f(s=>s.setEnvironmentId),p=f(s=>s.setBranch),{data:m}=H(),n=A(),v=f(s=>s.lastViewedTaskId),[u]=r.useState(!!v),[d,j]=r.useState(!1),g=r.useRef(u),T=r.useRef(null),w=E(),l=M(w,"1406552515"),y=f(({promptDraft:s})=>s),t=ie(),a=r.useMemo(()=>t?new G(V()):new te,[t]),i=r.useRef(!1);r.useEffect(()=>{n.state?.focusComposer&&!i.current&&!l&&(a.focus(),i.current=!0)},[n.state?.focusComposer,a,l]),r.useEffect(()=>{a.setText(l?"":y)},[a,l]);const b=r.useRef(null),k=R(({setIsExpanded:s})=>s),P=R(s=>s.isExpanded),I=ce(a.store,({isFocused:s})=>s);return W(()=>{u&&k(!1)},[u]),W(()=>{const s=T.current;if(!s)return;const x=()=>{const S=s.scrollTop>0;if(j(S),g.current)return;const L=a.isEmpty()&&!a.store.getState().controlsDisabled&&!I&&P&&S;g.current=L,k(!L)};return s.addEventListener("scroll",x),()=>s.removeEventListener("scroll",x)},[P,I,k,a]),r.useEffect(()=>a.subscribe("focus",()=>{g.current=!1}),[a]),r.useEffect(()=>a.subscribe("blur",s=>{s.relatedTarget instanceof HTMLElement&&b.current?.contains(s.relatedTarget)||d&&(g.current=!0,k(!1))}),[a,d,k]),r.useEffect(()=>a.subscribe("change",()=>{c(a.getContentToSend().content)}),[a,c]),r.useEffect(()=>{const s=new URLSearchParams(n.search),x=s.get("prompt");x&&a.setText(x);const S=s.get("tab");S==="archived"?o("archived"):S==="all"&&o("current")},[n.search,a,o]),r.useEffect(()=>{const x=new URLSearchParams(n.search).get("environment");x&&m?.some(S=>S.id===x)&&h(x)},[n.search,m,h]),r.useEffect(()=>{const x=new URLSearchParams(n.search).get("branch");x&&p(x)},[n.search,p]),e.jsxs(q.Provider,{value:a,children:[e.jsx("div",{className:"h-full w-full overflow-y-auto",ref:T,style:{scrollbarGutter:"stable"},children:e.jsxs("div",{className:"z-0 mx-auto flex w-full flex-col md:w-3xl",children:[e.jsx(he,{}),e.jsxs("div",{className:"bg-token-bg-primary sticky top-0 z-50 flex flex-col items-center",children:[e.jsx("h1",{className:"mb-4 pt-4 text-2xl 2xl:mb-8 2xl:pt-8 2xl:text-3xl [@media(max-height:550px)]:hidden",children:e.jsx(N,{id:"wham.home.title",defaultMessage:"What are we coding next?"})}),e.jsx("div",{ref:b,className:"w-full pt-px max-md:px-3",children:e.jsx(Ne,{disabled:l,children:e.jsx(de,{disableAutoFocus:u||l,isExpandedByDefault:!l,isBigBoxMode:!l,onSubmit:()=>{a.eraseContent(),c("")},onSuccess:()=>{fe.set(s=>s+1)}})})}),e.jsx(Te,{})]}),e.jsx(Ce,{})]})}),e.jsx(Me,{})]})};export{$e as W};
//# sourceMappingURL=l0coh5dljubggixt.js.map
