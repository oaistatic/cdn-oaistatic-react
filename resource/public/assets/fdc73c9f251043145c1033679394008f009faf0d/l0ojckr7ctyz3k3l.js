const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/m9r6bslnizp4yzzq.js","assets/juy90og0wtbp77qa.js","assets/kax7wcp9i7f7jtvz.js","assets/or7jf62i5kvok6pm.js","assets/root-ms9lll5g.css","assets/conversation-small-j9iamy23.css","assets/nibdn1iw4es3b0m5.js","assets/ggtk113j3r951058.js","assets/f0gmec2gcomy6v1t.js","assets/ibqg5gvcvb5336z5.js","assets/enyyaj5d41xdxtkn.js","assets/l46kwutoeleonnsb.js","assets/gbryk52yvym6pvzs.js","assets/ocpfit0g1gfti5z4.js","assets/mj9z9iuqobsziv2h.js","assets/eil9fh4jcipwzcgy.js","assets/jbze7lwlszm657iq.js","assets/g1mzshmp15rgsy0r.js","assets/mh6p4y5np464yd8j.js","assets/gu6gv8q29qfpkqrc.js","assets/cthaea829w6zpbcu.js","assets/m2ly71nz794qjc4q.js","assets/klzyif2r6c67lyfu.js","assets/pc2givv05uuq8g6l.js","assets/hdclltxvbgzx8xl8.js","assets/bp3e26benx61nzb4.js","assets/b6vbevykvjt8za99.js","assets/osl7p7pfd29pg5qh.js","assets/k5i6k2fuua7ns3ui.js","assets/jkeqh2oc20lfiqt3.js","assets/c7gakqazt7kcs0em.js","assets/jxnsuo98r1og4iiw.js","assets/nkla6b4gzqql98da.js","assets/j3ptsph527b7fin3.js","assets/ic8gpkx0j8obwbeo.js","assets/k8fa7t11vj7nuoga.js","assets/fgr4oob1xomy14p8.js","assets/cfoynes168s239fl.js","assets/krjedegvrg2pxhs7.js","assets/pbl95wx6493wq92j.js","assets/nvghkpv0zy449sx8.js","assets/cot-message-n4x930jt.css","assets/myrk3dv8ooaeadmb.js","assets/jkb95oca86on65yk.js","assets/abmsi963f0mr8jzr.js"])))=>i.map(i=>d[i]);
import{bX as de,c8 as ze,ak as Y,B as H,$ as J,eQ as ae,P as Me,ib as Ue,b2 as oe,bW as Q,bV as He,dL as Z,ar as ne,c as Je,g4 as $e,e as ge,b0 as qe,cw as Ie,fi as Ne,aS as We,R as Ke,g7 as Qe,C as Ye,g as Ze,by as ve,f as Xe,iq as m,eO as Ge,bj as es,fL as ss,s as ts,N as ns,b3 as as,S as os,ko as U,as as v,iT as rs,lE as Ce,bC as is,j8 as Se,af as ls,eb as cs,hF as us,at as k}from"./or7jf62i5kvok6pm.js";import{r as x,j as e,M as T,A as ms,m as ds,h as fe,f as gs}from"./juy90og0wtbp77qa.js";import{L as ke,m0 as fs,m1 as hs,m2 as ps,m3 as xs,hO as w,m4 as ys,m5 as _s,n as js,A as bs,m6 as vs,U as Cs,lx as Ss,m7 as ks,eO as Ts,m8 as ws,m9 as Ms,ma as Is,e_ as Ns,e$ as As,hr as Es,jh as Os,bp as Ps,mb as ue,iM as Rs,mc as Ds,md as Bs,me as Ls,mf as Vs,mg as Fs,mh as zs,eQ as Us,mi as Hs,mj as Js,mk as $s,ml as qs,mm as Ws,mn as Ks,mo as Qs,mp as Ys,mq as Te,dN as Zs,bs as Xs}from"./kax7wcp9i7f7jtvz.js";import{u as Ae,r as Ee}from"./mj9z9iuqobsziv2h.js";import{g as me,F as Oe,u as Gs}from"./cthaea829w6zpbcu.js";import{i as et,C as st}from"./osl7p7pfd29pg5qh.js";import{b as tt}from"./g1mzshmp15rgsy0r.js";function nt(s,n,r){const t=n.elements.length;if(t===0)return;const o=Object.entries(s).reduce((a,[g,u])=>Array.isArray(u)?u.length>0?a+1:a:u!==""?a+1:a,0);Me.logEventWithStatsig("dynamic-form-submission","chatgpt_dyanmic_form_submission",{...Ue({clientThreadId:r}),totalItems:t.toString(),completedItems:o.toString(),ratio:(o/t).toString()})}function at(s,n){let r="";return n.elements.forEach(t=>{const o=t.scope.split("/").pop(),a=o&&s[o],g=a?Array.isArray(a)?a.join(", "):a:"Any",u=t.label??o;r+=`${u}: ${g}
`}),r}function ot({messages:s,clientThreadId:n,isLastMessage:r}){const t=s.find(y=>y.author.role===de.Assistant),o=s.find(y=>y.metadata?.json_form),a=o?.metadata?.json_form,[g,u]=x.useState({}),[d,f]=x.useState(),[l,c]=x.useState(),p=ze.useStore(),j=Ae(n);x.useEffect(()=>{a&&(f(a.json_form_ui),c(a.json_form_data))},[a]);const C=x.useCallback(()=>{if(u({}),d){const y={...d,elements:d.elements.filter(P=>P.scope!=="#/properties/AdditionalInfo")};f(y)}l&&(delete l.properties.AdditionalInfo,c(l))},[u,f,c,d,l]),I=x.useCallback(()=>{if(d){const y={...d,elements:[...d.elements,{type:"Control",scope:"#/properties/AdditionalInfo",label:"Additional Info",placeholder:"Any other details..."}]};f(y)}if(l){const y={...l.properties,AdditionalInfo:{type:"string"}};c({...l,properties:y})}},[f,c,d,l]),E=d?.elements.some(y=>y.scope.endsWith("#/properties/AdditionalInfo")),N=Y(n,oe.getCurrentLeafId),S=o?.id!==N;if(!o||!l||!d)return t?.status==="in_progress"&&r?e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(ke,{className:"h-[26px] w-full"}),e.jsx(ke,{className:"h-[26px] w-3/4"}),e.jsx(fs,{})]}):null;if(S)return null;const R=async y=>{const P=p.getActiveSystemHintType(),X=at(g,d);nt(g,d,n),j({sourceEvent:y,promptMessage:ae(X),completionMetadata:{systemHints:P?[P]:[],conversationMode:{kind:J.PrimaryAssistant}}})};return e.jsxs(hs,{children:[e.jsx(rt,{formData:g,dataSchema:l,uiSchema:d,setData:u,readOnly:S}),e.jsxs("div",{className:"flex w-full justify-between",children:[E?e.jsx("div",{}):e.jsx(H,{disabled:S,onClick:I,color:"secondary",className:"text-token-text-secondary",children:e.jsx(T,{id:"Sen69P",defaultMessage:"Add a detail"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(H,{disabled:S,onClick:C,color:"secondary",className:"text-token-text-secondary",children:e.jsx(T,{id:"Uqo7UD",defaultMessage:"Reset"})}),e.jsx(H,{disabled:S,onClick:R,children:e.jsx(T,{id:"FVou++",defaultMessage:"Start"})})]})]})]})}function rt({dataSchema:s,uiSchema:n,setData:r,readOnly:t,formData:o}){return e.jsx("div",{children:e.jsx(ps,{formData:o,readOnly:t,schema:s,uiSchema:n,onChange:a=>r(a)})})}const it=(s,n)=>{const r=[],t=[],o=[],a=[],g="";if(s.every(l=>l.author.name===He.n7jupd_m)){if(!n)return;const l=Z(s);return[{type:w.N7jupdLoading,needs_startup:l?.metadata?.needs_startup??!1}]}for(const l of s){if(l.content.content_type===Q.ComputerOutput){const c={...l.content.screenshot,vmMetadata:l.metadata?.n7jupd_v,messageId:l.id};r.push(c)}if(l.content.content_type===Q.Text&&l.recipient?.includes("computer")&&t.push({type:l.recipient,parts:l.content.parts.join("")}),l.content.content_type===Q.StructuredThoughts)for(const c of l.content.thoughts)c.summary&&(o.push(c.summary),a.push(c.content))}const u=!1,d=[],f=Math.min(r.length,a.length);for(let l=0;l<f;l++){const c=r[l],{domain:p}=me(c),j={type:w.ComputerOutput,screenshots:[c],text:g,messages:s,thoughts:[o[l]],fullThoughts:[a[l]],actions:t,isBlank:!p};d.push(j)}if(r.length>f){const l=r.slice(f);if(d.length===0)d.push({type:w.ComputerOutput,screenshots:l,text:g,messages:s,thoughts:[],fullThoughts:[],actions:t,isBlank:u});else{const c=d[d.length-1];c.screenshots.push(...l),c.isBlank&&(c.isBlank=l.every(p=>!me(p).domain)&&c.isBlank)}}if(a.length>f)for(let l=f;l<a.length;l++)d.push({type:w.ComputerOutput,screenshots:[],text:g,messages:s,thoughts:[o[l]],fullThoughts:[a[l]],actions:t,isBlank:!0});return!d.length&&(r.length||a.length)?[{type:w.ComputerOutput,screenshots:r,text:g,messages:s,thoughts:o,fullThoughts:a,actions:t,isBlank:u}]:d},Xt=s=>{const n=s.messages[0];let r;switch(n.author.name){case"browser.search":{const t=n.metadata?.n7jupd_title??"Searched",o=n.metadata?.n7jupd_urls??[];r={type:w.Search,queries:[{type:"search",q:t}],sources:o.map(a=>({type:"search_result_group",domain:a,entries:[{type:"search_result",url:a,title:"",snippet:"",ref_id:null,content_type:null,pub_date:null}]}))};break}}if(!(!r||!r.sources.length))return[r]},we=/connector_[0-9a-f]{32}/i,Gt=s=>{const n=xs();if(!n)return;const r=s.messages[0];if(!r)return;const t=r.metadata?.n7jupd_subtool;if(t?.subtool?.includes("search"))return[{type:w.N7jupdAPI,action:"n7jupd_as"}];if(t?.subtool?.includes("api_doc"))return[{type:w.N7jupdAPI,action:"n7jupd_ag"}];let a=r.metadata?.n7jupd_subtool?.generic_api_func?.match(we)?.[0]??void 0;a||(a=r.metadata?.n7jupd_url?.match(we)?.[0]??void 0);const g=n?.get(a??"");if(!a||!g)return[{type:w.N7jupdAPI,action:"n7jupd_cf"}];if(s.messages.length>1&&s.messages[1].metadata?.connector_source&&s.messages[1].content.content_type===Q.TetherBrowsingDisplay){if(s.messages[1].metadata?.display_url&&s.messages[1].metadata?.display_title)return[{type:w.N7jupdAPI,action:"n7jupd_cf",source:g,fetchResult:{url:s.messages[1].metadata?.display_url,title:s.messages[1].metadata?.display_title}}];const u=lt(s.messages[1].content.result);if(u.length)return[{type:w.N7jupdAPI,action:"n7jupd_cs",source:g,searchResults:u.map(([d,f])=>({url:d,title:f}))}]}return[{type:w.N7jupdAPI,action:"n7jupd_cf",source:g}]};function lt(s){const n=s.replace(/^\s*L\d+:\s*/gm,""),r=[],t=[];for(let c=0;c<n.length;c++){const p=n[c];if(p==="{")t.push(c);else if(p==="}"){if(t.length===0)continue;const j=t.pop();r.push({start:j,end:c})}}const o=["display_url","web_link","url","web_url"],a=["display_title","title","name","path","subject","summary"],g=c=>c.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),u=(c,p)=>{const j=[];for(const C of c){const I=new RegExp(`"${g(C)}"\\s*:\\s*"([^"]+)"`,"g");for(const E of p.matchAll(I))j.push(E[1].replace(/\n/g,""))}return j},d=[];for(const{start:c,end:p}of r){const j=n.slice(c,p+1),C=u(o,j),I=u(a,j),E=Math.min(C.length,I.length);for(let N=0;N<E;N++)d.push([C[N],I[N]])}const f=new Map;for(const[c,p]of d)f.set(`${c}|||${p}`,[c,p]);return Array.from(f.values())}const ct=({content:s})=>e.jsx(Oe,{className:ne(_s.markdown,"text-token-text-secondary text-sm"),componentOverrides:{code:n=>e.jsx(ys,{...n,wrapperClassName:"",showActionBar:!1})},children:s}),ut="I took control of the virtual browser. If you're unsure what changed, ask for more context. If the task is complete, just acknowledge and wrap it up. Otherwise, please proceed.",M=Je(()=>({token:null,clientThreadId:null,isOpen:!1,isResuming:!1,chunk:null,parentMessageId:null,vmId:null})),en=(s,n)=>{M.setState(r=>({...r,clientThreadId:s,token:n}))},mt=()=>{const s=ge(),n=js(bs.hasSeenOdysseyTakeoverModal),r=async o=>{const a=We(o);if(a)return await Ke.safePost("/conversation/{conversation_id}/agent/resume",{parameters:{path:{conversation_id:a}}})},t=async()=>{const{clientThreadId:o}=M.getState();if(!o){Ie.info("VNC modal opened without a client thread id");return}M.setState({isResuming:!0}),M.setState({isOpen:!0}),Cs.setSidebarOpen(!1);const a=await r(o);M.setState({isResuming:!1,vmId:a?.vm_id});const g=await Ss(o);M.setState({parentMessageId:g?.last_message_id})};return async()=>{if(n.eligible){qe(s,vs,{onConfirm:async()=>{n.markAsViewed(),await t()}});return}await t()}},dt=async(s,{startNewTurn:n})=>{M.setState({isOpen:!1});const{clientThreadId:r}=M.getState();if(!r){Ie.info("VNC modal closed without a client thread id");return}if(!n)return;const t=gt();await Ee({ctx:s,clientThreadId:r,eventSource:"mouse",promptMessage:ae(ut,{is_takeover_ended_message:!0}),parentMessageIdPromise:t,completionMetadata:{systemHints:[Ne],conversationMode:{kind:J.PrimaryAssistant}}})},gt=(s=5e3)=>new Promise(n=>{const{parentMessageId:r}=M.getState();if(r)return n(r);const t=setTimeout(()=>{o(),n(void 0)},s),o=M.subscribe(a=>{a.parentMessageId&&(n(a.parentMessageId),clearTimeout(t),o())})}),sn=()=>{M.setState({token:null,clientThreadId:null,isOpen:!1})},ft=s=>{M.setState(n=>({...n,chunk:s}))},Pe=()=>{const s=mt(),n=M(o=>({token:o.token,clientThreadId:o.clientThreadId,isOpen:o.isOpen,isResuming:o.isResuming,vmId:o.vmId,open:s,close:dt,setChunk:ft})),t=!$e();return x.useMemo(()=>({...n,isVNCEnabled:t}),[n,t])},ht=({chunk:s,isStreaming:n,isExpanded:r,isLast:t,isLastComputerUse:o,firstScreenshotIndex:a,isAgentVisualCoT:g=!1})=>{const{open:u,isOpen:d,isVNCEnabled:f}=Pe(),l=x.useRef(null),c=x.useRef(null),[p,j]=x.useState(a??null),C=s.screenshots.at(p??-1),I=s.fullThoughts?.at(-1),E=s.thoughts?.at(-1),N=I??E,S=s.actions?.at(-1),R=Gs(C,void 0),[y,P]=x.useState(null),[X,G]=x.useState(!1),{origin:ee,domain:$}=x.useMemo(()=>me(C),[C]);x.useEffect(()=>{if(!R)return;let B=!1;const W=new Image;return G(!1),W.src=R,W.onload=()=>{!B&&P(R)},W.onerror=()=>{!B&&P(null),!B&&G(!0)},()=>{B=!0}},[R]),S?.type==="computer.click"&&ks(S.parts);function D(){u()}const q=!ee||!$;return g?e.jsxs("div",{className:"flex w-full flex-col items-center justify-center gap-4 sm:flex-row sm:items-start",children:[N&&e.jsx("div",{className:"text-token-text-secondary flex-1 text-sm",children:N}),C&&e.jsx("div",{ref:c,className:"border-token-border-heavy mt-1 flex aspect-[1024/764] w-40 items-center justify-center overflow-hidden rounded-lg border",children:y&&e.jsx(Ts,{src:y,alt:"screenshot",className:"flex aspect-[1024/764] w-40 items-center justify-center overflow-hidden",children:e.jsx("img",{src:y,alt:"screenshot",loading:"lazy",className:"h-full w-full object-cover object-bottom"},y)})})]}):C?e.jsx(ms,{mode:"wait",children:e.jsxs(ds.div,{className:"flex flex-1 cursor-default flex-col gap-2",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.4,ease:"easeInOut"},children:[r&&e.jsx("div",{className:ne("text-token-text-secondary text-sm",t&&"loading-shimmer"),children:C?n&&t?e.jsx(T,{id:"odyssey.using-browser",defaultMessage:"Using the browser"}):e.jsx(T,{id:"odyssey.used-browser",defaultMessage:"Used the browser"}):n&&t?e.jsx(T,{id:"odyssey.setting-up",defaultMessage:"Setting up environment"}):e.jsx(T,{id:"odyssey.setup-complete",defaultMessage:"Environment setup complete"})}),e.jsxs("div",{className:"border-token-border-heavy group bg-token-bg-tertiary relative flex w-full flex-col overflow-hidden rounded-2xl border",ref:l,children:[e.jsx("div",{className:"align-start flex flex-row gap-1 px-1 pt-1 text-sm",children:e.jsx(ws,{tabs:[{icon:ee??"",label:$??""}],activeTab:$,setActiveTab:()=>{},initializing:q})}),e.jsxs("div",{className:"relative w-full rounded-b-2xl",children:[e.jsxs("div",{className:"bg-token-bg-primary relative aspect-[1024/698] w-full overflow-hidden rounded-b-2xl",children:[y&&e.jsx("img",{src:y,alt:"screenshot",className:"absolute inset-0 h-full w-full object-cover object-bottom"},y),!y&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:q||R?e.jsx("div",{className:"flex items-center justify-center gap-2",children:e.jsx("div",{className:"border-token-border-heavy h-4 w-4 animate-spin rounded-full border-2 border-t-transparent"})}):e.jsx("span",{className:"text-token-text-secondary text-sm",children:e.jsx(T,{id:"odyssey.no-preview",defaultMessage:"Preview unavailable"})})})]}),(t||p!=null)&&!d&&e.jsx(Ms,{chunk:s,containerRef:l,cropAmountPx:68,currentScreenshotIdx:p})]}),n&&f&&o&&e.jsx("div",{className:"absolute inset-0 z-100 flex h-full w-full items-center justify-center bg-black/50 opacity-0 transition-opacity group-hover:opacity-100",children:e.jsx(H,{color:"primary-inverse",onClick:D,children:e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("div",{children:e.jsx(T,{id:"odyssey.take-over",defaultMessage:"Take over"})})})})}),(!n||!o)&&e.jsx(Is,{numEntries:s.screenshots.length,currentIndex:p??s.screenshots.length-1,onChange:j})]})]},"card")}):I?e.jsx(ct,{content:I}):null},pt=({clientThreadId:s,messageId:n,renderClosestScreenshot:r})=>{const t=Y(s,g=>{const d=oe.getConversationTurns(g).find(c=>c.messages.some(p=>p.id===n));return d?it([...d.messages],!1)?.find(c=>c.type===w.ComputerOutput):null}),o=x.useMemo(()=>{if(!t)return null;if(r){const f=t.screenshots.findIndex(l=>l.messageId===n);return f===-1?null:f}const g={};t.screenshots.forEach((f,l)=>{g[f.messageId]=l});const u=t.messages.findIndex(f=>f.id===n),d=t.messages.slice(u).find(f=>g[f.id]);return d?g[d.id]:null},[t,n,r]),a=o??(t?t.screenshots.length-1:0);return r&&o===null||!t||!t.screenshots.length?null:e.jsx("div",{children:e.jsx("div",{className:"relative flex flex-1 cursor-default flex-col gap-2",children:e.jsx(ht,{chunk:t,firstScreenshotIndex:a,isExpanded:!1,isComplete:!0,isStreaming:!1,isLast:!1})})})};function xt(s,n,r){const t=fe(),o=Ae(s);return x.useCallback(async()=>await o({promptMessage:ae(t.formatMessage({id:"3qSZZF",defaultMessage:"I understand the risks. Please continue"}),{user_acknowledges_pim:!0,system_hints:n}),completionMetadata:{systemHints:n,conversationMode:r},eventSource:"mouse"}),[o,r,n,t])}const yt=({onMarkSafe:s,justification:n,clientThreadId:r,flaggedMessageId:t})=>{const[o,a]=x.useState(!1),g=fe(),u=x.useCallback(()=>a(!1),[]);return e.jsxs(e.Fragment,{children:[e.jsx(Ye,{testId:"modal-confirm-close-editor",isOpen:o,size:"custom",className:"max-w-xl",onClose:u,type:"warning",hideSeparator:!1,title:e.jsx("span",{className:"text-xl",children:e.jsx(T,{id:"lzy3Zg",defaultMessage:"Potentially Malicious Content Detected"})}),primaryButton:e.jsx(ve.Button,{title:g.formatMessage({id:"E82qxN",defaultMessage:"Mark safe and continue"}),color:"danger",onClick:s}),secondaryButton:e.jsx(ve.Button,{title:g.formatMessage({id:"byfawg",defaultMessage:"Don't mark safe"}),color:"secondary",onClick:u}),showCloseButton:!0,closeButton:e.jsx(Ze,{onClick:u}),children:e.jsxs("div",{children:[e.jsx("div",{className:"text-md text-token-text-secondary pb-2",children:n?e.jsx(Oe,{children:n}):e.jsx(T,{id:"KKOtp0",defaultMessage:"This webpage contained hidden instructions that may be attempting to extract sensitive information. You should only continue if you're sure this content is safe."})}),!!t&&e.jsx(pt,{clientThreadId:r,messageId:t,renderClosestScreenshot:!0})]})}),e.jsx(H,{color:"danger",onClick:()=>a(!0),children:e.jsx(T,{id:"5L93Tx",defaultMessage:"Continue"})})]})};function _t({children:s,isFinalTurn:n,hasActiveRequest:r,conversationMode:t,clientThreadId:o,justification:a,flaggedMessageId:g}){const u=Y(o,l=>oe.findNode(l,c=>c.message.author.role===de.User)?.message),d=x.useMemo(()=>u?.metadata?.system_hints,[u]),f=xt(o,d,t);return e.jsxs("div",{children:[e.jsxs("div",{className:"bg-token-main-surface-secondary mt-1 flex gap-2 rounded-2xl px-3 py-2",children:[e.jsx(Qe,{className:"icon-xl mt-2"}),e.jsx("div",{children:s})]}),n&&!r&&e.jsx("div",{className:"mt-2",children:e.jsx(jt,{onMarkSafe:f,justification:a,flaggedMessageId:g,clientThreadId:o})})]})}function jt({onMarkSafe:s,justification:n,clientThreadId:r,flaggedMessageId:t}){return e.jsx("div",{children:e.jsx(yt,{onMarkSafe:s,justification:n,clientThreadId:r,flaggedMessageId:t})})}const bt=({currentGroupedMessage:s,isLastMessage:n,isLastTurnInConversation:r,clientThreadId:t,turnIndex:o})=>{const a=Z(s?.messages),g=a&&et(a)&&!a.metadata?.auto_proceed_cancelled&&r;return e.jsxs("div",{className:"flex flex-col",children:[g&&e.jsx(st,{clientThreadId:t,lastMessage:a,turnIndex:o}),r&&n&&e.jsx(Ns,{children:({isScheduled:u,isScheduledRun:d})=>u&&!d&&e.jsx(As,{})}),e.jsx(vt,{currentGroupedMessage:s,isLastMessage:n,isLastTurnInConversation:r})]})},vt=({currentGroupedMessage:s,isLastMessage:n,isLastTurnInConversation:r})=>{const{formatMessage:t}=fe(),{open:o,isVNCEnabled:a}=Pe(),{clientThreadId:g}=tt(),u=ge(),d=Xe(u,"733205176"),f=x.useMemo(()=>!a||!d||!n||!r||s.type!==m.Text?null:s.messages[0],[s,n,r,d,a]);if(!f)return null;const l=f.metadata?.n7jupd_button_type;if(!l||l==="confirmation")return null;const c=async()=>{await Ee({ctx:u,clientThreadId:g,eventSource:"mouse",promptMessage:ae("Yes, please proceed"),parentMessageId:f.id,completionMetadata:{systemHints:[Ne],conversationMode:{kind:J.PrimaryAssistant}}})},p=j=>{switch(j){case"takeover":return o();case"login":return o();case"confirmation":return c()}};return e.jsx("div",{className:"my-2 flex",children:e.jsx(H,{onClick:()=>p(l),children:t(Ct[l])})})},Ct=gs({takeover:{id:"odyssey-message-indicator.takeover",defaultMessage:"Take over"},login:{id:"odyssey-message-indicator.login",defaultMessage:"Log in"},confirmation:{id:"odyssey-message-indicator.confirm",defaultMessage:"Confirm"}}),St=v(()=>k(()=>import("./m9r6bslnizp4yzzq.js"),__vite__mapDeps([0,1,2,3,4,5]))),kt=v(()=>k(()=>import("./nibdn1iw4es3b0m5.js"),__vite__mapDeps([6,1,3,4]))),Tt=v(()=>k(()=>import("./ggtk113j3r951058.js"),__vite__mapDeps([7,1,3,4,2,5]))),wt=v(()=>k(()=>import("./f0gmec2gcomy6v1t.js"),__vite__mapDeps([8,1,3,4,9,10,2,5,11,12,13,14]))),Mt=v(async()=>()=>null);v(async()=>()=>null);const It=v(async()=>(await k(()=>import("./eil9fh4jcipwzcgy.js"),__vite__mapDeps([15,3,1,4,11,2,5,12,16,17,14,18,19,20,21,22,23,24,25,26,27]))).ImageGenMessage),Nt=v(()=>k(()=>import("./k5i6k2fuua7ns3ui.js"),__vite__mapDeps([28,1,3,4,2,5]))),At=v(()=>k(()=>import("./gu6gv8q29qfpkqrc.js"),__vite__mapDeps([19,1,3,4,2,5])).then(s=>s.BrowsingMessage)),Et=v(()=>k(()=>import("./jkeqh2oc20lfiqt3.js"),__vite__mapDeps([29,1,3,4,2,5])).then(s=>s.SearchResultMessage)),Ot=v(()=>k(()=>import("./c7gakqazt7kcs0em.js"),__vite__mapDeps([30,1,3,4,31,2,5])).then(s=>s.JITPluginMessage)),Pt=v(()=>k(()=>import("./nkla6b4gzqql98da.js"),__vite__mapDeps([32,3,1,4,33,2,5])).then(s=>s.DataAnalysisMessage)),Rt=v(()=>k(()=>import("./ic8gpkx0j8obwbeo.js"),__vite__mapDeps([34,1,3,4,2,5]))),Dt=v(()=>k(()=>import("./k8fa7t11vj7nuoga.js"),__vite__mapDeps([35,1,3,4,36,18,2,5,12,19,17,14,20,21,22,23,24,25,26,37,38,39,40,27,41])).then(s=>s.LegacyCoTMessage)),Bt=v(()=>k(()=>import("./fgr4oob1xomy14p8.js"),__vite__mapDeps([36,1,3,4,18,2,5,12,19,17,14,20,21,22,23,24,25,26,37,38,39,40,27,41])).then(s=>s.CoT)),Lt=v(()=>k(()=>import("./myrk3dv8ooaeadmb.js"),__vite__mapDeps([42,1,3,4,2,5,43,44])).then(s=>s.JawboneMessage)),Vt=v(async()=>()=>null);function Ft(s){if(s.some(n=>n.type===m.SearchGPTQuery)){const r=s.filter(o=>o.type===U).flatMap(o=>o.groups),t=r.flatMap(o=>o.messages.map(a=>a.metadata?.search_turns_count)).findLast(o=>o!=null);return t!=null?t>1:function(){const a=r.filter(d=>d.type===m.StructuredThoughts),g=r.filter(d=>d.type===m.CoTSearchTool),u=(()=>{function d(l){return l.type===m.StructuredThoughts&&l.messages.flatMap(c=>c.content).some(c=>c.content_type===Q.StructuredThoughts&&c.thoughts.length>0)}let f=!1;for(const l of r)if(l.type===m.CoTSearchTool)f=!0;else if(d(l)&&f)return!0;return!1})();return a.length>1||g.length>1||u}()}return!0}function zt(s,n){return s.type===U?Z(s.groups)?.messages[0].metadata?.is_visually_hidden_reasoning_group&&n===0:!1}function tn({groupedMessagesToRender:s,allMessages:n,allGroupedMessages:r,clientThreadId:t,isUserTurn:o,isCompletionRequestInProgress:a,isFeedbackEnabled:g,isFinalTurn:u,isFinalUserTurn:d,isFinalAssistantTurn:f,turnIndex:l,hasActiveRequest:c,onRequestCompletion:p,shouldGrowContainer:j=!0,isParagen:C=!1,renderingView:I="chat",hasN7JUPD:E=!1}){const{showDebugConversationTurns:N}=Ge(),[S]=Y(t,i=>[i?.mode]),R=ge(),y=es(t),P=ss(t),X=Es(),G=r.some(i=>i.type===m.Browsing||i.type===m.RetrievalBrowsing||i.type===m.SearchGPTQuery||i.type===m.n7jupd),ee=Y(t,i=>{for(let h=n.length-1;h>=0;h--){const _=n[h],A=i?.tree.getNodeIfExists(_.id)?.message,L=A?Xs(A):void 0;if(L)return Object.assign({clientThreadId:t,messageId:n[h].id},L)}}),$=Os(()=>ts.count(ns.DEFAULT,"conversation_turn_grouped_messages.attempted_render_missing_type_f959b8c")),D=Z(n),q=Ps({clientThreadId:t,conversationMode:S}),B=x.useCallback(({sourceEvent:i,requestedModelId:h,appendMessages:_,extraStreamParams:A,isReasoningSkipped:L})=>{D&&q({sourceEvent:i,nodeId:D.id,requestedModelId:h,appendMessages:_,extraStreamParams:A,isReasoningSkipped:L})},[D,q]),W=as(t);let re=y?.enableInferOptOut;if(D){const h=oe.getParentPromptNode(W,D?.id)?.message?.metadata?.system_hints??[];re=re&&!h.includes(os.Think)}const Re=ue(s,i=>i.type!==m.Debug),ie=s.map((i,h)=>{const _=E?h===Re:h===r.length-1,A=Ft(s),L=zt(i,h),le=h===r.length-1?void 0:r[h+1],Be=le?.type===U?le.groups[-1]:le,_e=h===0?void 0:s[h-1],ce=_e?.type!==U?_e:void 0,je=ce?.type,be=ce?.messages,Le=n?.filter(b=>b.metadata?.python_citation||b.metadata?.container_citation);if(i.type===U)return!A||L?null:e.jsx(Bt,{isStreaming:u&&_&&a,latestError:ee,isFinalAssistantTurn:f,messageGroups:i.groups,nextMessageGroup:Be,prevMessageGroup:ce,isAutoswitchOptOutEnabled:re,handleSkipClick:b=>{Me.logEventWithStatsig("chatgpt_web_autoswitch_reasoning_skip_clicked","chatgpt_web_autoswitch_reasoning_skip_clicked",{conversationId:t,messageId:i.groups[0].messages[0].id}),B({sourceEvent:b,requestedModelId:y?.id,isReasoningSkipped:!0})},hasN7JUPD:E},"cot-"+i.groups[0].messages[0].id);const Ve=i&&!rs(i.messages[0]),Fe=G&&Ve,V=[];if(Fe||V.push(e.jsx(Rs,{className:"min-h-8",message:i.messages[0],isFeedbackEnabled:g,isFinalUserTurn:d,isCompletionInProgress:_&&a,hasActiveRequest:c,turnIndex:l,clientThreadId:t,isUserTurn:o,prevGroupedMessageType:je,prevGroupedMessages:be,citableMessages:Le},"text-message-"+i.messages[0].id)),N&&V.push(e.jsx(Vt,{clientThreadId:t,message:i.messages[0]},"message-debug-"+i.messages[0].id)),i.type===m.Text&&i.messages[0].metadata?.[Ce]?.attached_context){const{url:b,title:O,base64_favicon:F}=i.messages[0].metadata[Ce].attached_context;return e.jsxs(x.Fragment,{children:[e.jsx(Ds,{url:b,title:O,base64Favicon:F,className:ne(Bs(!0),"mb-1","block")}),V]},"group-"+i.messages[0].id)}switch(i.type){case m.Text:case m.MultiText:return i.type===m.Text?e.jsxs(x.Fragment,{children:[V,E&&e.jsx(bt,{currentGroupedMessage:i,isLastMessage:_,isLastTurnInConversation:u,clientThreadId:t,turnIndex:l}),e.jsx($s,{isUserTurn:o,message:i.messages[0]})]},"group-"+i.messages[0].id):i.type===m.MultiText?e.jsx(Tt,{clientThreadId:t,messages:i.messages,isCompletionInProgress:_&&a,isFeedbackEnabled:g,hasActiveRequest:c,prevGroupedMessageType:je,prevGroupedMessages:be},"multitext-"+(i.messages[0]?.id??h)):i.type;case m.PIMBlock:{const b=Z(n);return S&&b?e.jsx(_t,{isFinalTurn:u,hasActiveRequest:c,conversationMode:S,clientThreadId:t,justification:b.metadata?.pim_justification,flaggedMessageId:b.metadata?.pim_message_id,children:V}):null}case m.n7jupd_n:return e.jsx(Js,{});case m.Browsing:case m.RetrievalBrowsing:{const b=S!=null&&[J.GizmoInteraction,J.GizmoMagicCreate,J.GizmoTest].includes(S.kind),O=P?ls(P):!1;return e.jsx(At,{messages:i.messages,isRequestActive:c,isLastMessageInTurn:_,isUsingGizmo:b,isUsingSnorlax:O,isRetrieval:i.type===m.RetrievalBrowsing},"browsing-"+(i.messages[0]?.id??h))}case m.SearchGPTQuery:{if(s.some(z=>z.type===U)&&A)return null;const O=s.slice(h+1).findLast(z=>z.type===m.Text||z.type===m.CoTSearchTool),F=n.findLast(z=>Se(z).length>0);return e.jsx(Hs,{clientThreadId:t,turnIndex:l,isRequestActive:c,isLastMessage:_,isLastTurnInConversation:u,nextMessage:O?.messages[0],searchResultGroups:Se(F)},"searchquery-"+(i.messages[0]?.id??h))}case m.StructuredThoughts:return null;case m.ReasoningRecap:return null;case m.CoTSearchTool:return null;case m.n7jupd:return null;case m.n7jupd_i:case m.n7jupd_a:case m.n7jupd_x:return null;case m.a8km123:{if(!i.messages.every(O=>!O.metadata?.reasoning_status)){const O=ue(n,F=>F.author.role===de.Assistant&&F.recipient==="all");return e.jsx(Dt,{clientThreadId:t,turnIndex:l,isStreaming:(_||O<h)&&a,isFinalAssistantTurn:f,messages:i.messages},"sum-"+(i.messages[0]?.id??h))}return e.jsx(Rt,{messages:i.messages,isStreaming:_&&a,isCompletionRequestInProgress:a,hasActiveRequest:c,isLastMessage:_,isFinalTurn:u,isFeedbackEnabled:g,clientThreadId:t,currentGroupedMessageIndex:h,turnIndex:l},"sum-"+(i.messages[0]?.id??h))}case m.f959b8c:return $(),null;case m.is_loading_message:if(_&&a){const b=i.messages[0],O=is(b);return e.jsx(Us,{text:O},"loading-message-"+h)}else return null;case m.c12k321:return null;case m.l1p9k3u:return null;case m.b1de6e2_c:return e.jsx(ot,{messages:i.messages,clientThreadId:t,isLastMessage:_},"b1de6e2-"+(i.messages[0]?.id??h));case m.b1de6e2_s:return e.jsx(zs,{messages:i.messages,clientThreadId:t},"b1de6e2_s-"+(i.messages[0]?.id??h));case m.b1de6e2_d:return null;case m.b1de6e2_rm:return e.jsx(Fs,{messages:i.messages,clientThreadId:t,renderingView:I,children:V},"b1de6e2_rm-"+(i.messages[0]?.id??h));case m.de1d73e:if(X){const b=h+1<r.length?r[h+1]:void 0;return e.jsx(Lt,{clientThreadId:t,currentGroupedMessage:i,nextMessage:b&&b.type===m.Text?b.messages[0]:void 0,isLastMessage:_,isRequestActive:c},"jawbone-"+(i.messages[0]?.id??h))}else return null;case m.ParallelBrowsing:return e.jsx(Nt,{messages:i.messages},"parallel-"+(i.messages[0]?.id??h));case m.CodeInterpreter:return e.jsx(Pt,{messages:i.messages,isRequestActive:c,clientThreadId:t},"ada-"+(i.messages[0]?.id??h));case m.JITPlugin:return e.jsx(Ot,{messages:i.messages,clientThreadId:t,isLastTurnInConversation:u,onRequestCompletion:p},"jit-"+(i.messages[0]?.id??h));case m.t2uay3k:return e.jsx(It,{messages:i.messages,clientThreadId:t,disableClickThru:C,isLastTurnInConversation:u},"t2uay3k-"+(i.messages[0]?.id??h));case m.Dalle:return e.jsx(wt,{messages:i.messages,clientThreadId:t,disableClickThru:C},"dalle-"+(i.messages[0]?.id??h));case m.GizmoEditor:return e.jsx(St,{messages:i.messages},"gizmo-editor-"+(i.messages[0]?.id??h));case m.oiw209h:return e.jsx(Mt,{messages:i.messages,clientThreadId:t},"oiw209h-"+(i.messages[0]?.id??h));case m.n7jupd_p:return e.jsx(Vs,{});case m.Canmore:return e.jsx(Ls,{messages:i.messages,allTurnMessages:n,isFinalTurn:u,isRequestActive:c,clientThreadId:t,isUserTurn:o},"canmore-"+(i.messages[0]?.id??h));case m.Container:case m.Oboe:return null;case m.Debug:return N?e.jsx(kt,{message:i.messages[0]},"debug-"+i.messages[0].id):null;case m.SearchResult:return e.jsx(Et,{messages:i.messages},"search-result-"+(i.messages[0]?.id??h));case m.kanzi:return null;case m.Mochi:return null;case m.SuperWidget:return null}}),De=Ys(),{wordFadeType:K,animationDurationMs:he}=qs(),se=x.useRef([]),pe=x.useRef(void 0),xe=x.useRef(null),te=!o&&u&&a,ye=n[0]?.id;return cs(()=>{if(K!=="indexed"||!te)return;const i=xe.current;if(!i)return;pe.current!==ye&&(pe.current=ye,se.current=[]);const h=i.getAnimations({subtree:!0}).filter(_=>_.animationName===Te["fade-in"]);if(h.length!==0){const _=Jt({now:performance.now(),previousStartTimes:se.current,groupCount:h.length});se.current=_;for(let A=0;A<h.length;A++)h[A].startTime=_[A]}else se.current=[]},[ie,K,te]),e.jsx("div",{className:ne({"flex max-w-full flex-col":!0,[Te.root]:K==="indexed"&&te,grow:j}),style:K==="indexed"?{"--duration":`${he}ms`}:void 0,ref:xe,children:e.jsx(us,{name:"GroupedMessages",fallback:Ut,children:o?ie:e.jsxs(Ws,{isDisabled:!te||K!=="delay",defaultAnimationDurationPerSegmentMs:he,children:[Ks(R)&&u&&e.jsx(Qs,{isStreaming:a,debug:De}),ie]},n[0]?.id)})})}function Ut({error:s}){return e.jsxs(Zs,{type:"danger",children:[e.jsx(T,{id:"5eGo3w",defaultMessage:"Unable to display this message due to an error."}),!1]})}function Ht(s,n,r){if(s.length<2||n<=0)return 0;const t=n/Math.log(2);s=[...s].sort((g,u)=>g-u);let o=0,a=0;for(let g=s.length-1;g>0;--g){const u=Math.exp(-(r-s[g])/t);if(o>0&&u/o<.01)break;const d=s[g]-s[g-1];o+=u,a+=u*d}return o===0?0:o/a}function Jt({now:s,previousStartTimes:n,groupCount:r,initialRate:t=50,halfLife:o=1}){const a=n.slice(0,ue(n,l=>l<=s)+1),g=a.length<2?t/1e3:Math.max(.01,Ht(a,o*1e3,s)),u=r-a.length;let d=a[a.length-1]??0,f=1;for(let l=0;l<u;l++){const c=g*1e3*f;u<c?f*=.8:u>c&&(f*=1.5);const p=1/(g*f),j=Math.max(s,d+p);a.push(j),d=j}return a}export{tn as C,ct as a,ht as b,dt as c,Xt as d,we as e,lt as f,it as o,Gt as p,sn as r,en as s,Pe as u};
//# sourceMappingURL=l0ojckr7ctyz3k3l.js.map
