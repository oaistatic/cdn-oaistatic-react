import{r as m,h as L,j as e,M as f}from"./juy90og0wtbp77qa.js";import{lz as _,eV as U}from"./kax7wcp9i7f7jtvz.js";import{ar as v,B as S,hH as W,aF as x,em as K,ay as G,ag as $,dF as q}from"./or7jf62i5kvok6pm.js";import{C as J,S as Q,i as X,g as Y,D as Z,N as ee}from"./ijrieqdsn05t7zlp.js";import{i as te}from"./kcsd6vktfrkucv9s.js";import{a as ie,S as ae}from"./czq32gcy6bg1i3pf.js";import{F as oe}from"./k7dnwni45dct4rn4.js";import{W as se}from"./gtarz7mxj2xze66f.js";import"./e823k7iso04i0ozj.js";import"./hesgehv7nq0kfowp.js";import"./fzrn137102spawew.js";import"./fy5hpi3mruy96a69.js";import"./k7mo5cksz9ju4mai.js";import"./g1mzshmp15rgsy0r.js";import"./mj9z9iuqobsziv2h.js";import"./mq5kqcvga15eqze5.js";import"./hdclltxvbgzx8xl8.js";import"./klzyif2r6c67lyfu.js";import"./oz61hhgglf8a0a5f.js";import"./ibqg5gvcvb5336z5.js";import"./ifj9ijd0co13aaf7.js";import"./m36qabefvxegdn1g.js";import"./cthaea829w6zpbcu.js";import"./m2ly71nz794qjc4q.js";import"./pc2givv05uuq8g6l.js";import"./bp3e26benx61nzb4.js";import"./b6vbevykvjt8za99.js";import"./enyyaj5d41xdxtkn.js";import"./njn7nqfn68bjqa30.js";import"./lptwpbjabrvjmhsj.js";import"./eaamdtv1grunriod.js";import"./fzjh1zjd0g21dis4.js";import"./f5uxfkqdhg7743lt.js";import"./nc631yunytu8n0fx.js";import"./jbze7lwlszm657iq.js";import"./k3j7nk2mqimsnpi6.js";function R({filePath:t,side:s,lineNumber:h,onSubmit:F,onDelete:g,onClose:d,initialComment:i}){const r=i?T(i):"",[l,w]=m.useState(i?T(i):""),[a,o]=m.useState(!i),[c,y]=m.useState(!1),j=m.useRef(null),N=L(),C=()=>{if(!l)return;const p=i?{...i,content:[{content_type:"text",text:l}]}:{id:crypto.randomUUID(),type:"comment",content:[{content_type:"text",text:l}],position:{side:s===Q.old?"left":"right",path:t,line:h}};F?.(p),o(!1),j.current?.blur(),d?.()};return m.useEffect(()=>{!c&&i&&l===r&&setTimeout(()=>{o(!1)},100),c&&(o(!0),j.current?.focus())},[c,i,l,r]),e.jsx("div",{className:"gap-2 bg-gray-100/50 p-4 font-sans dark:bg-gray-900",id:i?.id,children:e.jsxs("div",{className:v("flex flex-col gap-2",J),children:[e.jsx(te,{ref:j,className:"border-token-border-medium bg-token-main-surface-primary text-token-text-primary border-1.5 w-full resize-none rounded-lg p-4 text-sm ring-0 focus:border-black focus:outline-hidden dark:focus:border-white","data-wham-comment-textarea":!0,onFocus:()=>y(!0),onBlur:()=>y(!1),placeholder:N.formatMessage({id:"code.diff.addComment",defaultMessage:"Add a comment"}),minRows:1,maxRows:10,autoFocus:!i,onSubmit:()=>{},value:l,onChange:p=>w(p.target.value),onKeyDown:p=>{p.key==="Enter"&&p.metaKey&&(p.preventDefault(),C()),p.key==="Escape"&&(p.preventDefault(),d?.())}}),a&&e.jsxs("div",{className:v("mt-2 flex items-center justify-between gap-2",!g&&"justify-end"),children:[g&&e.jsx(S,{color:"danger",onClick:()=>g?.(),children:e.jsx(f,{id:"code.diffComment.delete",defaultMessage:"Delete"})}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(S,{color:"secondary",onClick:()=>{d?.(),o(!1),i&&w(T(i))},children:e.jsx(f,{id:"code.diffComment.cancel",defaultMessage:"Cancel"})}),e.jsx(S,{color:"primary",disabled:!l,onClick:C,children:i?e.jsx(f,{id:"code.diffComment.save",defaultMessage:"Save"}):e.jsx(f,{id:"code.diffComment.comment",defaultMessage:"Comment"})})]})]})]})})}function T(t){return t.content.map(s=>s.content_type==="text"?s.text:"").join("")}function ne({copyDiffToClipboard:t,copyPatchToClipboard:s,unifiedDiff:h,setUnifiedDiff:F,showFullDiff:g=!1,setShowFullDiff:d}){const[i,r]=m.useState(!1),l=L(),w=a=>o=>{o.preventDefault(),o.stopPropagation(),a==="diff"?t():s()};return e.jsxs(W,{open:i,onOpenChange:r,contentAlign:"end",sideOffset:8,triggerButton:e.jsx("button",{type:"button",onClick:a=>{a.preventDefault(),a.stopPropagation(),r(!0)},className:"hover:bg-token-border-light rounded p-1","aria-label":l.formatMessage({id:"wham.copyFileActionDropdown.openMenu",defaultMessage:"Open diff actions menu"}),children:e.jsx(K,{className:"icon"})}),children:[e.jsx(x.Item,{icon:_,onClick:w("diff"),children:e.jsx(f,{id:"wham.copyFile.apply",defaultMessage:"Copy git apply"})}),e.jsx(x.Item,{icon:_,onClick:w("patch"),children:e.jsx(f,{id:"wham.copyFile.patch",defaultMessage:"Copy patch"})}),e.jsx(x.Separator,{}),e.jsxs(x.RadioGroup,{value:h?"unified":"split",onValueChange:a=>F(a==="unified"),onClick:a=>a.stopPropagation(),children:[e.jsx(x.RadioItem,{value:"split",onClick:a=>a.stopPropagation(),children:e.jsxs("div",{className:"text-token-text-primary flex items-center gap-3",children:[e.jsx(ie,{className:"icon"}),e.jsx(f,{id:"wham.message.modal.footer.splitDiff",defaultMessage:"Split diff"})]})}),e.jsx(x.RadioItem,{value:"unified",onClick:a=>a.stopPropagation(),children:e.jsxs("div",{className:"text-token-text-primary flex items-center gap-3",children:[e.jsx(ae,{className:"icon"}),e.jsx(f,{id:"wham.message.modal.footer.unifiedDiff",defaultMessage:"Unified diff"})]})})]}),d&&e.jsxs(e.Fragment,{children:[e.jsx(x.Separator,{}),e.jsxs(x.RadioGroup,{value:g?"full":"latest",onValueChange:a=>d(a==="full"),onClick:a=>{a.stopPropagation()},children:[e.jsx(x.RadioItem,{value:"full",children:e.jsx(f,{id:"wham.copyFile.showFullDiff",defaultMessage:"Full diff"})}),e.jsx(x.RadioItem,{value:"latest",children:e.jsx(f,{id:"wham.copyFile.showLatestCommit",defaultMessage:"Incremental diff"})})]})]})]})}const re="_diffView_avtz7_1",le={diffView:re},E="wham-toggle-all-diffs";function de(t){return m.useEffect(()=>{function s(h){t(h.detail.open)}return window.addEventListener(E,s),()=>{window.removeEventListener(E,s)}},[t]),m.useCallback(s=>{window.dispatchEvent(new CustomEvent(E,{detail:{open:s}}))},[])}function fe({diff:t,viewType:s,stickyHeader:h,showFullDiff:F=!1,setShowFullDiff:g,enableComments:d=!1,comments:i,buttonClassName:r,onCommentCreate:l,onCommentDelete:w,onCommentUpdate:a,setUnifiedDiff:o}){const c=G(),y=L(),[j,N]=m.useState(()=>!X(t.diffFile)),[C,p]=m.useState(!1),V=$(),B=de(N);m.useEffect(()=>{t.diffFile.initTheme(c?"dark":"light")},[t.diffFile,c]);const k=(i??[]).reduce((n,u)=>{const b=u.position.path,I=u.position.side,M=u.position.line;n[b]||(n[b]={oldFile:{},newFile:{}});const P=I==="left"?n[b].oldFile:n[b].newFile;return P&&(P[M]={data:u}),n},{}),D=Y(t.diffFile),A=()=>{const n=t.diffFile._newFileName===ee?t.diffFile._oldFileName:t.diffFile._newFileName;navigator.clipboard.writeText(n),p(!0),setTimeout(()=>{p(!1)},1e3)},O=async()=>{t.hunksText&&(await navigator.clipboard.writeText(` (cd "$(git rev-parse --show-toplevel)" && git apply --3way <<'EOF' 
${t.hunksText} 
EOF
)`),V.success(y.formatMessage({id:"wham.message.modal.footer.copiedToClipboard",defaultMessage:"Copied git apply command to clipboard"}),{duration:3,hasCloseButton:!0}))},z=async()=>{t.hunksText&&(await navigator.clipboard.writeText(t.hunksText),V.success(y.formatMessage({id:"wham.codeDiff.copiedPatchToClipboard",defaultMessage:"Copied patch to clipboard"}),{duration:3,hasCloseButton:!0}))},H=!t.diffFile.unifiedLineLength&&!t.diffFile.splitLineLength;return e.jsxs("div",{"data-diff-header":D,className:v("flex flex-col pt-1",le.diffView),children:[e.jsx("div",{role:"button",onClick:n=>{const u=!j;n.altKey?B(u):N(u)},className:v("focus-visible:outline-none",h&&"sticky top-0 z-1",r),children:e.jsxs("div",{className:v("bg-token-bg-primary border-token-border-default relative flex items-center rounded-t-2xl border px-4 py-3 text-sm font-medium before:absolute before:inset-x-[-1px] before:top-[-1px] before:bottom-0 before:z-[-1] before:bg-[var(--right-bg)] before:content-['']",!j&&"rounded-b-2xl"),children:[e.jsx(U,{className:v("icon me-3 transition-transform duration-200",j&&"rotate-90")}),e.jsx("span",{className:"me-1 truncate text-start select-text",title:D,children:D}),e.jsx(oe,{diffFile:t.diffFile}),e.jsx(q,{label:y.formatMessage({id:"wham.codeDiff.copiedFileName",defaultMessage:"Copied File Name"}),open:C,children:e.jsx("div",{role:"button",onClick:n=>{n.preventDefault(),n.stopPropagation(),A()},className:"hover:bg-token-border-light rounded p-1","aria-label":y.formatMessage({id:"wham.codeDiff.copyFileName",defaultMessage:"Copy file name"}),children:e.jsx(_,{className:"icon-xs"})})}),e.jsxs("div",{className:"ms-auto flex items-center gap-1 ps-1",children:[e.jsx(se,{linesAdded:t.diffFile.additionLength,linesRemoved:t.diffFile.deletionLength}),!t.isBinary&&e.jsx(ne,{copyDiffToClipboard:O,copyPatchToClipboard:z,unifiedDiff:s==="unified",setUnifiedDiff:o,showFullDiff:F,setShowFullDiff:g})]})]})}),j&&(H||t.isBinary?e.jsx("div",{className:"text-token-text-secondary bg-token-bg-secondary flex h-full justify-center rounded-b-2xl py-4 text-sm font-medium",children:t.isBinary?e.jsx(f,{id:"wham.diff.binaryFile",defaultMessage:"Binary file not shown"}):e.jsx(f,{id:"wham.diff.noContent",defaultMessage:"No content"})}):e.jsx(Z,{className:v("relative overflow-clip rounded-b-2xl transition-opacity duration-300","after:border-token-border-default after:pointer-events-none after:absolute after:inset-0 after:rounded-b-2xl after:border-s after:border-e after:border-b after:content-['']"),diffViewFontSize:12,diffFile:t.diffFile,diffViewTheme:c?"dark":"light",diffViewHighlight:!0,diffViewMode:s==="split"?3:4,diffViewWrap:!0,diffViewAddWidget:d,extendData:k[t.diffFile._newFileName],renderExtendLine:({lineNumber:n,side:u,data:b})=>!d||!(u===1?k[t.diffFile._newFileName]?.oldFile:k[t.diffFile._newFileName]?.newFile)?null:e.jsx(R,{initialComment:b,onSubmit:M=>a?.(M),onDelete:()=>w?.(b),filePath:t.diffFile._newFileName,side:u,lineNumber:n}),renderWidgetLine:({onClose:n,lineNumber:u,side:b})=>!d||!l?null:e.jsx(R,{onSubmit:l,onClose:n,filePath:t.diffFile._newFileName,side:b,lineNumber:u})}))]})}function $e({diffFiles:t,unifiedDiff:s,setUnifiedDiff:h,showFullDiff:F=!1,setShowFullDiff:g,enableComments:d,comments:i,setComments:r}){if(!t.length)return e.jsx("div",{className:"flex h-full w-full flex-1 items-center justify-center",children:e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(f,{id:"wham.whamTaskPageCodeDiffContent.noDiffAvailable",defaultMessage:"No diff available"})})});function l(o){!r||!i||r([...i,o])}function w(o){!r||!i||r(i.filter(c=>c.id!==o.id))}function a(o){!r||!i||r(i.map(c=>c.id===o.id?o:c))}return e.jsx("div",{className:"relative h-full w-full pt-6",children:e.jsx("div",{className:"flex h-full w-full flex-col gap-6 overflow-y-auto px-6 pb-6",children:t.map(o=>e.jsx(fe,{diff:o,stickyHeader:!0,viewType:s?"unified":"split",setUnifiedDiff:h,showFullDiff:F,setShowFullDiff:g,enableComments:d,comments:d?i:[],onCommentCreate:l,onCommentDelete:w,onCommentUpdate:a},o.diffFile._newFileName))})})}export{$e as WhamTaskPageCodeDiffContent};
//# sourceMappingURL=cgj4r9oivcouf875.js.map
