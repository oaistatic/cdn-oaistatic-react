const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/o899j6tq6eofkz5m.js","assets/or7jf62i5kvok6pm.js","assets/juy90og0wtbp77qa.js","assets/root-ms9lll5g.css","assets/mj9z9iuqobsziv2h.js","assets/kax7wcp9i7f7jtvz.js","assets/conversation-small-j9iamy23.css","assets/g1mzshmp15rgsy0r.js","assets/g0j29k77kzjbz76f.js","assets/ocpfit0g1gfti5z4.js","assets/kwrsfo4prmlqgo0w.js","assets/6l5wykugon65myc6.js","assets/fgnsrp7wj3i83g7e.js","assets/klzyif2r6c67lyfu.js","assets/osl7p7pfd29pg5qh.js","assets/khey9wv8trxtr5w5.js","assets/fzazeczfeeq2yus7.js","assets/nds67ntn5u3du51f.js","assets/kvlw7edoapaiqmyl.js","assets/nwtv5yp9e1z4edju.js","assets/gjsedudfjvyfngnj.js","assets/l3n51a2tb9b2qxpl.js","assets/mia7txooqhkpbw7w.js","assets/m4hnvgp7gphpktn6.js","assets/gy64pge8qevmvg7e.js","assets/hbsgsme608z3xhlj.js","assets/jkb95oca86on65yk.js","assets/ekilws0edo0o2kpo.js","assets/oxfy7bv5q29a4s25.js"])))=>i.map(i=>d[i]);
import{r as l,j as e,M as H,h as Q,e as bt,m as z,f as ks,H as Ta,I as Sa,aq as Jt,A as ws,u as Rs,R as ja,p as _a}from"./juy90og0wtbp77qa.js";import{i4 as Es,al as Ca,am as Ia,an as Ma,a3 as ka,q5 as wa,q6 as Ra,hP as Ea,q7 as Pa,q8 as Aa,q9 as Na,a6 as Fa,fx as Ba,bX as qa,qa as Da,iB as Qt,c_ as Ps,qb as Ua,mC as Xe,lT as Oa,qc as Ha,qd as La,qe as Ga,qf as Va,qg as As,hy as Wa,fc as Ns,qh as gt,hA as za,qi as Zt,qj as $a,jW as Fs,qk as es,ql as Ya,qm as Ka,qn as Ve,qo as Xa,fV as _e,dB as ve,fS as Ja,ls as Qa,qp as Za,qq as Bs,qr as eo,kg as qs,lu as to,fT as so,qs as Ds,f6 as no,lR as ao,f8 as le,ej as oo,k5 as ro,k6 as io,lA as ts,dx as lo,lB as co,e_ as Us,Z as Os,fp as uo,qt as mo,qu as go,qv as Hs,qw as po,pu as ho,d2 as Ls,U as Gs,bL as fo,bM as xo,bN as vo,bO as bo,qx as yo,hN as To,qy as So,bp as jo,qz as _o,qA as Co,mM as Vs,e as Io,V as Mo,X as ko,hH as wo,m$ as Ro,ak as Eo,qB as Po,eX as Ao,qC as ss,qD as No,er as Ws,qE as Fo,qF as Bo,hr as qo,jx as Do,o as Uo,bs as ns,qG as Oo,qH as Ho,qI as Lo,qJ as Go,qK as Vo,qL as Wo,qM as zo,qN as $o,mB as Yo,qO as Ko,qP as Xo,qQ as Jo,qR as Qo,qS as as,qT as Zo,qU as er,qV as tr,qW as sr,qX as nr,qY as ar,qZ as or,jy as rr,mb as os,q_ as ir,as as lr,fR as cr,q$ as dr,r0 as ur,r1 as mr,eZ as gr,r2 as pr,r3 as hr,r4 as fr,r5 as xr,r6 as vr,ae as br,dA as yr,j9 as Tr}from"./kax7wcp9i7f7jtvz.js";import{as as ce,at as pe,e as re,jD as rs,gO as is,gP as ls,eF as Sr,aS as se,ag as Qe,ap as jr,eH as cs,eG as _r,f9 as Cr,bd as zs,bW as Ce,aG as $s,R as Ys,hH as Ks,aF as Ir,em as yt,aC as Te,i as ke,j as Tt,e1 as St,aV as Ke,ak as ge,b2 as U,cx as Xs,c8 as Mr,c7 as Js,mj as Qs,ar as O,S as oe,mk as Ze,ml as kr,C as wr,aq as Rr,B as Je,$ as Er,eQ as Pr,fi as Ar,b3 as Me,dL as R,bX as L,ay as Nr,jp as Fr,bA as Ie,bD as jt,ej as Br,bT as Zs,k as _t,eO as en,A as qr,cl as ds,D as pt,P as V,ib as ye,h5 as tn,a5 as Dr,fP as Ur,bi as sn,h1 as nn,fJ as Or,dN as Hr,dO as Lr,kU as Gr,dP as Vr,bC as et,mm as Wr,b4 as an,f as be,ir as zr,ca as $r,a$ as Yr,ae as Kr,lW as us,al as xe,cD as Xr,kk as Jr,ko as mt,iq as Qr,bB as Zr,mn as ei,aY as ti,fL as si,bj as on,jh as ni,jF as ai,ji as oi,jo as ri,fn as ii,kq as li,dW as ci,aU as We,mo as di,cj as ui,ck as mi,dq as gi,eI as pi,gk as ze,fZ as hi,hW as fi,kp as xi,hF as vi,iZ as bi,kv as yi,g4 as Ti,i4 as Si,lI as ji}from"./or7jf62i5kvok6pm.js";import{c as _i,u as ht}from"./ocpfit0g1gfti5z4.js";import{b as Ci,u as Ii}from"./g1mzshmp15rgsy0r.js";import{b as Mi,c as ki}from"./on0kcnmks7o53xta.js";import"./fzjh1zjd0g21dis4.js";import{r as wi}from"./mj9z9iuqobsziv2h.js";import{a as Ri}from"./cthaea829w6zpbcu.js";import{c as Ei,O as Pi}from"./g0j29k77kzjbz76f.js";import{C as ft}from"./l0ojckr7ctyz3k3l.js";import{a as rn}from"./klzyif2r6c67lyfu.js";import{m as Ai}from"./m2ly71nz794qjc4q.js";const Ni=ce(async()=>pe(()=>import("./o899j6tq6eofkz5m.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16])).then(t=>t.ImageGenNewEditor));function zl({postWithProfile:t,clientThreadId:n,onClose:a}){return t.post.attachments[0]?.kind==="media_generation"?e.jsx(Fi,{postWithProfile:t,clientThreadId:n,onClose:a}):t.post.attachments[0]?.kind==="message_slice"?e.jsx(Bi,{postWithProfile:t,onClose:a}):null}function Fi({postWithProfile:t,clientThreadId:n,onClose:a}){const s=l.useRef(null),[o,r]=l.useState(!1),[d,i]=l.useState(!1),c=bt(),{post:u}=t,p=u.attachments[u.attachments.length-1],x={url:p.url,content_type:ls.ImageAssetPointer,asset_pointer:p.asset_pointer??is(p.id),size_bytes:0,width:p.width,height:p.height},v=Q(),b=Sr(),T=se(n),j=Qe(),E=l.useCallback(m=>b.getState().files.find(h=>h.tempId===m),[b]),_=p.url,q=l.useCallback(async m=>{if(s.current){const h=await s.current,y=h?E(h?.tempId):null;if(y)return y}return s.current=fetch(m).then(h=>h.blob()).then(h=>{const y=new File([h],"image.png",{type:"image/png"}),f=jr(y);return cs.uploadFile(b,f,y,_r.Multimodal,[y.type],v,j).then(()=>{const F=E(f);return F&&F.status===Cr.Ready&&F.fileId?F:null})}),s.current},[b,v,j,E]),{onRequestCompletion:I}=Ci(),{isUnauthenticated:N}=zs(),M=l.useCallback(async m=>{if(!(!m.promptMessage||N)){i(!0);try{const h=await q(_);if(!h||!h.fileId||!h.fileSpec)return;const y=[{content_type:ls.ImageAssetPointer,asset_pointer:is(h.fileId),size_bytes:h.fileSpec.size,width:p.width,height:p.height},...m.promptMessage.content.content_type===Ce.MultimodalText||m.promptMessage.content.content_type===Ce.Text?m.promptMessage.content.parts:[]],f={...m,promptMessage:{...m.promptMessage,content:{content_type:Ce.MultimodalText,parts:y}},extraStreamParams:{...m.extraStreamParams??{},continueFromSharedPostId:u.id}};I(f),a(),cs.reset(b)}catch{j.danger({id:"postReceiverModal.editImageError",defaultMessage:"Failed to edit the image",description:"Error message for editing an image"},{toastId:"post_receiver_modal.edit_image_error"})}finally{i(!1)}}},[p.height,p.width,q,I,b,_,a,N,j,u.id]),k=e.jsx(ln,{post:u,setIsReportModalOpen:r,onClose:a,additionalButtons:e.jsx(Ra,{imageAsset:x,serverThreadId:T})});return e.jsxs("div",{className:"bg-token-main-surface-primary absolute start-0 end-0 top-0 bottom-0 h-full w-full",children:[e.jsx(ka,{children:e.jsx(Ni,{image:x,isLoadingNewImage:!1,clientThreadId:n,onClose:()=>{a(),c("/",{replace:!0})},onRequestCompletion:M,editorControls:k,messageId:u.id,footer:d?e.jsx(qi,{}):null})}),o&&e.jsx(cn,{post:u,onClose:()=>r(!1)})]})}function Bi({postWithProfile:t,onClose:n}){const[a,s]=l.useState(!1),{post:o}=t;return e.jsxs("div",{className:"bg-token-main-surface-primary absolute start-0 end-0 top-0 bottom-0 h-full w-full",children:[e.jsx(ln,{post:o,setIsReportModalOpen:s,onClose:n}),e.jsx(wa,{attachments:o.attachments,variant:"fullscreen"}),a&&e.jsx(cn,{post:o,onClose:()=>s(!1)})]})}function ln({post:t,setIsReportModalOpen:n,onClose:a,additionalButtons:s}){const o=bt(),r=Q(),d=Qe(),i=l.useCallback(async()=>{if(window.confirm(r.formatMessage({id:"postReceiverModal.deletePostConfirmation",defaultMessage:"Are you sure you want to delete this post?"})))try{await Ys.safeDelete("/share/post/{post_id}",{parameters:{path:{post_id:t.id}}}),o("/",{replace:!0})}catch{d.danger({id:"postReceiverModal.deletePostError",defaultMessage:"Failed to delete the post",description:"Error message for deleting a post"},{toastId:"post_receiver_modal.delete_post_error"})}},[t.id,r,d,o]);return e.jsx(e.Fragment,{children:e.jsxs(z.div,{className:"flex h-16 w-full px-2 sm:px-4",...Ea,children:[e.jsx("div",{className:"flex items-center justify-self-start text-start",children:e.jsx(Pa,{onClose:()=>{a(),o("/",{replace:!0})}})}),e.jsx("div",{className:"flex w-full flex-1 flex-col items-center justify-center justify-self-stretch",children:e.jsx(Aa,{areButtonsFullWidth:!0,post:t,setIsReportModalOpen:n})}),e.jsxs("div",{className:"flex items-center justify-self-end text-end",children:[t.permissions.can_delete&&e.jsx(Na,{tooltip:r.formatMessage({id:"postReceiverModal.deletePost",defaultMessage:"Delete"}),onClick:i,children:e.jsx(Fa,{})}),s]})]})})}function qi(){const t=Q();return e.jsxs(z.div,{className:"shadow-token-border-default pointer-events-none inline-flex items-center justify-center gap-1.5 self-center rounded-[16px] px-3.5 py-2 text-sm shadow-lg",transition:{duration:.3,ease:"easeInOut"},initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[e.jsx($s,{}),e.jsx("span",{children:t.formatMessage({id:"postReceiverModal.preparingImage",defaultMessage:"Preparing image..."})})]})}function cn({post:t,onClose:n}){const a=re(),{data:s}=Ca(a,rs.Post),o=Q(),r=Ia(a,o,t.id,rs.Post);if(s==null)return null;const d=`Report ${t.text??"Post"}`;return e.jsx(Ma,{reasons:s.reasons,submitReport:r,title:d,onClose:n,header:s.header,subHeader:s.header_explanation})}function Di(){const t=l.useContext(Es),n=t?.postWithProfile?.post,a=t?.setIsReportModalOpen;return!n||!a?null:e.jsxs("div",{className:"outline-token-border-default mx-4 flex items-center justify-between gap-2.5 rounded-2xl py-1 ps-4 pe-0.5 outline-1 outline-offset-[-1px]",children:[e.jsx("span",{className:"text-token-text-secondary justify-center text-sm leading-tight",children:e.jsx(H,{id:"e2L5bY",defaultMessage:"Content created using ChatGPT"})}),e.jsx(Ks,{size:"default",contentAlign:"end",sideOffset:4,triggerButton:e.jsx(qa,{className:"rounded-full",label:"",icon:e.jsx(yt,{className:"icon-sm"})}),children:e.jsx(Ir.Item,{icon:Ba,onClick:()=>a(!0),children:e.jsx(H,{id:"jHHbcM",defaultMessage:"Flag content as unsafe"})})})]})}function $l(){const t=l.useContext(Es),n=t?.postWithProfile?.post,a=t?.setIsReportModalOpen;return!n||!a?null:e.jsx("div",{className:"text-token-text-secondary text-sm",children:e.jsx(H,{id:"iRpGVT",defaultMessage:"Content created using ChatGPT. <reportButton>Report</reportButton> if unsafe.",values:{reportButton:s=>e.jsx("button",{className:"text-token-text-primary decoration-token-text-primary underline",onClick:()=>{a(!0)},children:s})}})})}function Ui(){return{minHeight:`calc(100dvh - ${As}px - 120px - ${Ze()}px)`}}function Oi(){const[t,n]=ke(s=>[Tt(s),St(s)]),a=Da();return t&&!n&&!a}function Hi({clientThreadId:t,children:n}){const a=re(),s=Q(),o=Ke(()=>Qt()),[r,d,i,c,u]=ge(t,m=>[U.getUserMessages(m),U.getSuperWidgetMessages(m),m?.scrollToMessageId,m?.title,m?.is_do_not_remember]),p=l.useContext(Xs),x=Ps(a,t),v=Ke(()=>x.asyncStatus$()?.value),b=l.useMemo(()=>Mi({clientThreadId:t,conversationTitle:c,conversationAsyncStatus:v,isDoNotRemember:u}),[t,c,v,u]),T=Ke(()=>Ua()),j=Mr.useStore(),E=Js(),_=l.useRef({answer:null,web:null,images:null,videos:null}),q=l.useRef(null);if(!Qs(p))return n;function I(m){return e.jsxs("div",{className:"pt-[var(--mini-tab-height)]",children:[e.jsx("div",{className:o==="answer"?"block":"hidden",children:n}),e.jsx(Xe,{children:o!=="answer"&&e.jsx(Gi,{userMessages:r,superWidgetMessageContents:m,tab:o,scrollToMessageId:i},o)})]})}function N({disabled:m}){return e.jsx("button",{className:"text-token-text-tertiary hover:text-token-text-primary flex items-center justify-center transition-colors","aria-label":s.formatMessage({id:"idEcXk",defaultMessage:"Open conversation options"}),disabled:m,children:e.jsx(yt,{className:"icon"})})}function M(m){if(Qt.set(m),m!=="answer"){const h=j.getActiveSystemHintType();h&&h!==oe.Search&&E(null)}}const k=()=>{const m=q.current,h=_.current[o];if(!m||!h)return{left:0,width:0};const y=m.getBoundingClientRect(),f=h.getBoundingClientRect();return{left:f.left-y.left,width:f.width}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-token-bg-primary fixed start-0 end-0 top-0 z-10",style:{width:`calc(100% - ${T}px)`},children:e.jsx(Xe,{className:"flex h-[var(--mini-tab-height)] flex-col justify-end",children:e.jsxs("div",{className:O("relative flex gap-6","mx-2 w-[calc(100%-1rem)] md:mx-0 md:w-full","border-token-border-default border-b-[0.5px]"),ref:q,children:[e.jsx($e,{ref:m=>{_.current.answer=m},$selected:o==="answer",onClick:()=>M("answer"),children:e.jsx(H,{...Ye.chatTab})}),e.jsx($e,{ref:m=>{_.current.web=m},$selected:o==="web",onClick:()=>M("web"),children:e.jsx(H,{...Ye.linksTab})}),e.jsx($e,{ref:m=>{_.current.images=m},$selected:o==="images",onClick:()=>M("images"),children:e.jsx(H,{...Ye.imagesTab})}),e.jsx($e,{ref:m=>{_.current.videos=m},$selected:o==="videos",onClick:()=>M("videos"),children:e.jsx(H,{...Ye.videosTab})}),e.jsx(z.div,{className:"absolute bottom-0 -mb-[0.5px] h-0.5 bg-black dark:bg-white",initial:!1,animate:k(),transition:{type:"spring",duration:.3,bounce:.12}}),e.jsx("div",{className:"ms-auto",children:b?e.jsx(ki,{conversation:b,inMainScreen:!0,isActiveConversation:!0,inChatWindow:!1,inOrla:!0,children:N({disabled:!1})}):N({disabled:!0})})]})})}),I(d.map(m=>m.content))]})}const $e=Te.button`
  px-1 pb-2 text-sm -mb-[0.5px]
  ${({$selected:t})=>t?"text-token-text-primary":"text-token-text-tertiary hover:text-token-text-secondary"}
`,Li={answer:()=>null,web:Ga,images:La,videos:()=>e.jsx(Va,{children:"Work in Progress"})};function Gi({userMessages:t,superWidgetMessageContents:n,tab:a,scrollToMessageId:s}){const o=l.useRef({});function r(i,c="smooth"){const u=o.current[i];u&&(u.style.scrollMarginTop=`${Ze()+40}px`,u.scrollIntoView({behavior:c,block:"start"}))}l.useEffect(()=>{requestAnimationFrame(()=>{if(t.length>0){const i=t[t.length-1];i&&r(i.id,"instant")}})},[]),l.useEffect(()=>{setTimeout(()=>{s&&r(s)},50)},[s]);const d=Li[a];return e.jsx("div",{className:"flex w-full flex-col gap-12",children:Oa(t.length,i=>e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"flex justify-end py-[var(--mini-thread-turn-vertical-spacing)] text-sm",children:e.jsxs(Ha,{containsImagesOrAttachments:!1,isUserTurn:!0,children:[e.jsx("div",{ref:c=>{o.current[t[i].id]=c}}),t[i]?.content.content_type===Ce.Text?t[i].content.parts[0]:""]})}),n[i]?e.jsx(d,{content:n[i],turnIndex:i}):e.jsx("div",{style:Ui(),children:e.jsx("div",{className:"result-streaming pulse",children:e.jsx("span",{})})})]},i))})}const Ye=ks({chatTab:{id:"CSsJbp",defaultMessage:"Chat"},linksTab:{id:"U43uU/",defaultMessage:"Links"},imagesTab:{id:"ZY9oIP",defaultMessage:"Images"},videosTab:{id:"C8mH8+",defaultMessage:"Videos"}}),Vi="Continue",Wi=({clientThreadId:t,messages:n})=>{const a=re(),s=l.useMemo(()=>n.some(i=>i.metadata?.stop_reason===kr.RiskyDomainNotWatching),[n]),o=Ri(t),[r,d]=l.useState(!1);return e.jsx(wr,{testId:"modal-watch-mode-stopped",isOpen:s&&!r,type:"success",size:"normal",onClose:Rr,className:"p-1",title:e.jsx("div",{className:"font-semibold",children:e.jsx(H,{id:"8FmSDC",defaultMessage:"Task paused while you were away"})}),primaryButton:e.jsx(Je,{onClick:()=>{wi({ctx:a,clientThreadId:t,eventSource:"mouse",promptMessage:Pr(Vi,{}),completionMetadata:{systemHints:[Ar],conversationMode:{kind:Er.PrimaryAssistant}}})},children:e.jsx(H,{id:"4rrYz9",defaultMessage:"Resume"})}),secondaryButton:e.jsx(Je,{color:"secondary",onClick:()=>d(!0),children:e.jsx(H,{id:"yg+V5e",defaultMessage:"Stay paused"})}),children:e.jsx(H,{id:"Wdb/cy",defaultMessage:"ChatGPT is working with {riskyDomain}, which contains sensitive data. To resume, keep your browser's tab open and monitor actions.",values:{riskyDomain:e.jsx("span",{className:"font-medium",children:o})}})})},ms=ce(()=>pe(()=>import("./nds67ntn5u3du51f.js"),__vite__mapDeps([17,1,2,3,5,6,18,19])).then(t=>t.MemoryActionResult));function gs(t,n,a){Ie(t,s=>{jt.updateTree(s,o=>{o.updateNodeMetadata(n,{inlineComparisonRating:a})})})}const ps=({messages:t})=>{for(const{metadata:n}of t){const{paragen_display_label:a}=n??{};if(a)return a;const{augmented_paragen_prompt_label:s}=n??{};if(s)return s}};function zi(t){const n=l.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),a=l.useRef({left:null,right:null});return t.variantIds.length<2?e.jsx(dn,{setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:n,firstVisibleTokenTimestampsRef:a,...t}):e.jsx($i,{...t,visibilityStateRef:n,firstVisibleTokenTimestampsRef:a})}function $i(t){const{clientThreadId:n,variantIds:a,turnIndex:s,firstVisibleTokenTimestampsRef:o}=t;if(a.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const r=Ct(),d=Fs(),i=Nr(),[c,u]=a,p=l.useMemo(()=>Fr(c+u)()>=.5,[c,u]),[x,v]=p?[u,c]:[c,u],[b,T,j]=ge(n,M=>{const k=ds(M).tree.getLeafFromNode(x).id,m=ds(M).tree.getLeafFromNode(v).id,h=U.getConversationTurns(M,k),y=U.getConversationTurns(M,m),f=s<h.length?h[s]:null,F=s<y.length?y[s]:null;return f||pt.addError(`Paragen Left turn index ${s} out of bounds`,{turnIndex:s,turnCount:h.length,lastTurnRole:R(h)?.role,lastMessageAuthor:R(R(h)?.messages)?.author,lastMessageContentType:R(R(h)?.messages)?.content.content_type,lastMessageMetadata:R(R(h)?.messages)?.metadata,altTurnCount:y.length,altLastTurnRole:R(y)?.role,altLastMessageRole:R(R(y)?.messages)?.author.role}),F||pt.addError(`Paragen Right turn index ${s} out of bounds`,{turnIndex:s,turnCount:y.length,lastTurnRole:R(y)?.role,lastMessageAuthor:R(R(y)?.messages)?.author,lastMessageContentType:R(R(y)?.messages)?.content.content_type,lastMessageMetadata:R(R(y)?.messages)?.metadata,altTurnCount:h.length,altLastTurnRole:R(h)?.role,altLastMessageRole:R(R(h)?.messages)?.author.role}),[k,f,F]}),[E,_]=p?[j,T]:[T,j],q=r?"skippable_parallel_2_in_stream:a:2.0":"skippable_parallel_2_in_stream:a:1.5";l.useEffect(()=>(es.setState({displayingSideBySideFeedback:!0}),()=>{es.setState({displayingSideBySideFeedback:!1})}),[]);const I=l.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),N=l.useCallback((M,{shouldSubmitParagenFeedback:k=!0}={})=>{if(!T||!j||!E||!_)throw new Error("Expected both turns to exist");Ie(n,C=>{jt.setCurrentBranch(C,M)});const m=M===x,h=M===c;E.messages.length>0&&gs(n,E.messages[E.messages.length-1].id,h?"original":"new"),_.messages.length>0&&gs(n,_.messages[_.messages.length-1].id,h?"original":"new");const y=se(n),f=[T,j].map((C,$)=>({messageId:C.messages[C.messages.length-1].id,loadFirstTokenTime:$===0?o.current.left:o.current.right,loadEndTime:R(C.messages)?.clientMetadata?.completionSampleFinishTime})),F=m?f[0].messageId:f[1].messageId,S=U.getParentPromptNode(Me(n),b);if(!S)throw new Error("Expected prompt for side by side feedback");const B={},w=S.message.clientMetadata?.variantsInStreamInfo==null&&S.message.metadata?.paragen_variants_info!=null;for(const C of f)B[C.messageId]=w?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:C.loadFirstTokenTime,load_end_time:C.loadEndTime};k&&ys({params:{conversation_id:y,displayed_message_ids:f.map(C=>C.messageId),message_metadatas:B,rating:"selected",selected_message_id:F,source_timestamp:Date.now(),ui_variant:r?2:1,user_prompt_message_id:S.message.id}})},[n,x,c,E,_,T,j,b,o,t.conversationTurnMountTime,r]);return l.useEffect(()=>Br(Zs,{requestCompletion:M=>{const k=se(n),m=U.getParentPromptNode(Me(n),b);if(!m)throw new Error("Expected prompt for side by side feedback");if(!T||!j)throw new Error("Expected both turns to exist");const h=[T,j].map((S,B)=>({messageId:S.messages[S.messages.length-1].id,loadFirstTokenTime:B===0?o.current.left:o.current.right,loadEndTime:R(S.messages)?.clientMetadata?.completionSampleFinishTime})),y={},f=m.message.clientMetadata?.variantsInStreamInfo==null&&m.message.metadata?.paragen_variants_info!=null;for(const S of h)y[S.messageId]=f?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:S.loadFirstTokenTime,load_end_time:S.loadEndTime};const F=M.isForSkippingParagen;ys({params:{conversation_id:k,displayed_message_ids:h.map(S=>S.messageId),message_metadatas:y,rating:F?"explicit_skipped":"skipped",selected_message_id:null,source_timestamp:Date.now(),ui_variant:F?3:r?2:1,user_prompt_message_id:m.message.id}}),F&&N(x,{shouldSubmitParagenFeedback:!1})}}),[T,j,b,n,t.conversationTurnMountTime,q,E?.messages,_?.messages,i,r,o,N,x]),e.jsx(dn,{...t,setPreferredFeedback:N,leftVariantId:x,rightVariantId:v,leftTurn:T,rightTurn:j,hasActiveRequest:d,originalTurn:E,visibilityStateRef:I})}function dn({setPreferredFeedback:t,leftVariantId:n,rightVariantId:a,leftTurn:s,rightTurn:o,hasActiveRequest:r,originalTurn:d,visibilityStateRef:i,...c}){const u=(s&&ps(s))??null,p=(o&&ps(o))??null,x=l.useMemo(()=>s?.messages??[],[s?.messages]),v=l.useMemo(()=>o?.messages??[],[o?.messages]),{avatarClassName:b,firstVisibleTokenTimestampsRef:T}=c,j=l.useMemo(()=>s?.messageGroups??[],[s?.messageGroups]),E=l.useMemo(()=>o?.messageGroups??[],[o?.messageGroups]),_=Wa(),q=Me(c.clientThreadId),I=R(s?.messages),N=R(o?.messages),M=Ns(U.getRequestId(q,I?.id??N?.id)),k=M&&!I?.end_turn,m=M&&!N?.end_turn,h=I!=null&&gt(I),y=N!=null&&gt(N),f=h??y,F=s?.role===L.User,S=o?.role===L.User,B=l.useRef(null),w=l.useRef(null),C=l.useRef(null),$=s!=null,K=o!=null;!$&&T.current.left==null&&(T.current.left=Date.now()),!K&&T.current.right==null&&(T.current.right=Date.now()),l.useEffect(()=>{if(B.current&&w.current&&C.current){const Se=Array(11).fill(0).map((he,G)=>G/10),de=new IntersectionObserver(he=>he.forEach(G=>{G.target===w.current?(i.current.left_visibility_initial==null&&(i.current.left_visibility_initial=G.intersectionRatio),i.current.left_visibility_max=Math.max(i.current.left_visibility_max??0,G.intersectionRatio)):G.target===C.current&&(i.current.right_visibility_initial==null&&(i.current.right_visibility_initial=G.intersectionRatio),i.current.right_visibility_max=Math.max(i.current.right_visibility_max??0,G.intersectionRatio))}),{root:B.current,threshold:Se});return de.observe(w.current),de.observe(C.current),()=>de.disconnect()}},[i]);const{data:Y}=za(void 0,!1,_),X=Ct(),ie=e.jsx("div",{className:"text-token-text-secondary px-(--thread-content-margin) pt-1 pb-5 text-center text-sm text-pretty",children:e.jsx(H,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})});return e.jsxs("div",{className:"relative flex flex-col",children:[e.jsxs("div",{className:O("bg-token-main-surface-primary sticky top-[-1px] z-1 px-(--thread-content-margin) text-center text-lg text-pretty",X?"md:top-header-height":"md:static"),"data-testid":"paragen-feedback-title",children:[e.jsx(H,{id:"KKeSJV",defaultMessage:"You're giving feedback on a new version of ChatGPT."}),X?ie:null]}),X?null:ie,e.jsx("div",{className:O($a,"horzScrollShadows relative -mb-2 snap-x snap-mandatory overflow-x-auto overflow-y-clip pb-4"),ref:B,children:e.jsxs("div",{className:O("mx-auto box-content max-w-[calc(2*var(--thread-content-max-width))] min-w-min px-(--thread-content-margin)","flex items-start",X&&"divide-token-border-medium dark:divide-token-border-heavy divide-x",!X&&"gap-4 sm:gap-6"),children:[e.jsxs(hs,{horizontalScrollContainerRef:B,rootElementRef:w,onClick:()=>{t(n)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:$,isImageGenInProgress:f,children:[e.jsxs(vs,{children:[e.jsx(Zt,{messages:x,isUserTurn:F,avatarClassName:b}),e.jsx(xs,{children:e.jsx(H,{...Ts.responseNumber,values:{responseIndex:1,display_label:u}})})]}),X&&$?e.jsx(fs,{}):e.jsxs(e.Fragment,{children:[Y!=null&&!F&&e.jsx(ms,{clientThreadId:c.clientThreadId,messages:x,isParagen:!0}),e.jsx(ft,{...c,allMessages:x,groupedMessagesToRender:j,allGroupedMessages:j,isUserTurn:F,isFinalUserTurn:!1,isFinalAssistantTurn:!1,isCompletionRequestInProgress:k,hasActiveRequest:r,shouldGrowContainer:!1,isParagen:!0}),e.jsx(bs,{clientThreadId:c.clientThreadId,conversationTurnMountTime:c.conversationTurnMountTime,turn:s,originalTurn:d})]})]}),e.jsxs(hs,{horizontalScrollContainerRef:B,rootElementRef:C,onClick:()=>{t(a)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:K,isImageGenInProgress:f,children:[e.jsxs(vs,{children:[e.jsx(Zt,{messages:v,isUserTurn:S,avatarClassName:b}),e.jsx(xs,{children:e.jsx(H,{...Ts.responseNumber,values:{responseIndex:2,display_label:p}})})]}),X&&K?e.jsx(fs,{}):e.jsxs(e.Fragment,{children:[Y!=null&&!S&&e.jsx(ms,{clientThreadId:c.clientThreadId,messages:v,isParagen:!0}),e.jsx(ft,{...c,allMessages:v,groupedMessagesToRender:E,allGroupedMessages:E,isFinalUserTurn:!1,isFinalAssistantTurn:!1,isUserTurn:S,isCompletionRequestInProgress:m,hasActiveRequest:r,shouldGrowContainer:!1,isParagen:!0}),e.jsx(bs,{clientThreadId:c.clientThreadId,conversationTurnMountTime:c.conversationTurnMountTime,turn:o,originalTurn:d})]})]})]})})]})}function hs({horizontalScrollContainerRef:t,rootElementRef:n,onClick:a,children:s,hasActiveRequest:o,isWaitingOnFirstUserVisibleToken:r,isImageGenInProgress:d}){const i=Ct(),{scrollX:c}=Ta({layoutEffect:!1,container:t,target:n}),u=Ya(),p=Ka(),x=l.useRef(null),v=l.useRef(null),b=l.useRef(null),[T,j]=l.useState(!1),[E,_]=l.useState(!1),[q,I]=l.useState(!1),[N,M]=l.useState(0);l.useEffect(()=>{if(!i)return;const S=new IntersectionObserver(B=>{for(const w of B)w.target===x.current?j(w.isIntersecting):w.target===b.current?I(w.isIntersecting):w.target===v.current&&_(w.isIntersecting)},{root:u?.current});return x.current&&v.current&&b.current&&(S.observe(x.current),S.observe(v.current),S.observe(b.current)),()=>{S.disconnect()}},[N,i,u]);const k=!q&&(E||T),m=Sa(c,S=>k?-1*S:0),h=Jt(0);l.useEffect(()=>{if(!i)return;const S=new ResizeObserver(B=>{Ve(B.length===1,"entryList.length === 1");const w=B[0];Ve(w.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),h.set(w.contentBoxSize[0].inlineSize)});return n.current&&S.observe(n.current),()=>{S.disconnect()}},[i,h,n]);const y=Jt(0);l.useEffect(()=>{if(!i)return;const S=new ResizeObserver(B=>{Ve(B.length===1,"entryList.length === 1");const w=B[0];Ve(w.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),y.set(w.contentBoxSize[0].blockSize+16),M(w.contentBoxSize[0].blockSize)});return p.current&&S.observe(p.current),()=>{S.disconnect()}},[i,y,p]);const f=e.jsx(Je,{className:i?"px-5":"mt-4 self-start",onClick:a,"data-testid":"paragen-prefer-response-button",children:e.jsx(H,{id:"U2EAH6",defaultMessage:"I prefer this response"})}),F=r||d;return e.jsx("div",{"data-paragen-root":!0,className:O("@container relative flex min-w-[min(450px,80cqw,80vw)] flex-1 snap-center flex-col gap-1 text-start",i?"min-h-60":"border-token-border-tertiary rounded-xl border shadow-lg shadow-black/3"),ref:n,children:e.jsxs("div",{className:O(Xa,"px-(--thread-content-margin) py-4"),children:[e.jsx("div",{className:O("absolute top-48 right-0! left-0! h-px","invisible"),ref:x}),e.jsx("div",{className:O("absolute top-48 right-0! bottom-0 left-0!","invisible"),ref:v}),e.jsx("div",{className:O("absolute right-0! bottom-0 left-0! h-px","invisible"),ref:b}),s,i?e.jsx("div",{className:"flex-1"}):null,i?e.jsx("div",{className:"mt-4 min-h-10",children:F?null:e.jsx(z.div,{style:{translateX:m,width:h,bottom:y},animate:{opacity:100},initial:{opacity:0},transition:{ease:"easeOut",duration:.2,delay:.5},className:O({fixed:k,"z-20 flex w-full justify-center":!0}),children:f})}):o||d?null:f]})})}function fs(){return e.jsxs("div",{className:"flex w-full flex-col gap-4 pt-3 pb-5",children:[e.jsx(me,{className:"h-4 w-[75%]"}),e.jsx(me,{className:"h-4 w-[50%]"}),e.jsx(me,{className:"h-4 w-[80%]"}),e.jsx(me,{className:"h-4 w-[55%]"}),e.jsx(me,{className:"h-4 w-[66%]"}),e.jsx(me,{className:"h-4 w-[64%]"}),e.jsx(me,{className:"h-4 w-[48%]"})]})}function Ct(){const t=re();return _t(t,"3119715334").get("should-enable-hojicha",!1)}const xs=Te.div`text-sm text-token-text-secondary font-semibold`,vs=Te.div`flex gap-4 items-center mb-1`,me=Te.div`animate-pulse rounded-[4px] bg-token-main-surface-tertiary`;function bs({clientThreadId:t,conversationTurnMountTime:n,turn:a,originalTurn:s}){const o=en();if(!o.showParagenMetadata||!o.showDebugConversationTurns&&!o.forceParagen||a==null)return null;let r=a===s?"ORIGINAL":"NEW";const d=a.messages[a.messages.length-1],i=d?.metadata?.__internal,c=d?.metadata?.paragen_display_label;if(i){const{model_id:x,model_definition_slug:v,model_definition_virtual_model_id:b,alternative_model_selection_rule:T,augmented_paragen_prompt_group_id:j,augmented_paragen_prompt_id:E,augmented_paragen_prompt:_}=i;x&&(r+=`
Model ID: ${x}`),v&&(r+=`
Model Slug: ${v}`),b&&(r+=`
Virtual Model ID: ${b}`),T&&(r+=`
Alternative Model Rule: ${T}`),j&&(r+=`
Prompt Group ID: ${j}`),E&&(r+=`
Prompt ID: ${E}`),_&&(r+=`
Prompt: ${_}`),c&&(r+=`
Display Label: ${c}`)}r+=`
Message ID: ${d.id}`;const u=U.getParentPromptNode(Me(t),a.messages[0].id);if(!u)throw new Error("Expected prompt for side by side feedback");const p=u.message.clientMetadata?.variantsInStreamInfo==null&&u.message.metadata?.paragen_variants_info!=null;return r+=`
User prompt message ID: ${u.message.id}`,r+=`
Is Persisted Paragen? ${p}`,r+=`
Completion Sample Finish Time: ${p?`${n} (persisted)`:R(a.messages)?.clientMetadata?.completionSampleFinishTime}`,e.jsx("div",{className:"text-sm whitespace-pre-wrap text-red-500",children:r})}async function ys({params:t}){await Ys.safePost("/paragen_submission",{requestBody:t,authOption:qr.SendIfAvailable})}const Ts=ks({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}{display_label}"}});function un({followups:t,analyticsMetadata:n}){const a=l.useRef(!1),s=rn();return l.useEffect(()=>{a.current||(a.current=!0,t.forEach((o,r)=>{V.logEventWithStatsig("chatgpt_message_followup_action","chatgpt_message_followup_action",{...ye(n),action:"show",position:(r+1).toString(),followup_text:_e(o)})}))},[t,n]),e.jsx(z.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex w-full flex-col",children:t.slice(0,4).map((o,r)=>e.jsx(z.div,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:r*.03},exit:{opacity:0,translateY:4},children:e.jsx(Yi,{followUp:o,onSelectingSuggestedReply:s,analyticsMetadata:n,position:r})},r))})}const mn=Te.div`
  h-[1px] opacity-45
  ${({$isSelected:t})=>t?"mx-2 bg-token-main-surface-secondary":"bg-token-border-default"}
`;function Yi({followUp:t,onSelectingSuggestedReply:n,analyticsMetadata:a,position:s}){return e.jsxs(z.button,{whileHover:"hover",className:O("bg-token-main-surface-primary hover:bg-token-main-surface-secondary flex w-full cursor-pointer items-start justify-start gap-2 rounded-lg px-0 py-3 text-start"),onClick:o=>{n(o,t,[],0),V.logEventWithStatsig("chatgpt_message_followup_action","chatgpt_message_followup_action",{...ye(a),action:"click",position:(s+1).toString(),followup_text:_e(t)})},onMouseEnter:()=>{V.logEventWithStatsig("chatgpt_message_followup_action","chatgpt_message_followup_action",{...ye(a),action:"hover",position:(s+1).toString(),followup_text:_e(t)})},children:[e.jsx(z.div,{className:"flex items-center justify-center pt-0.25 opacity-70",variants:{hover:{x:4}},initial:{x:0},transition:{duration:.1},children:e.jsx(ve,{className:"text-token-text-secondary icon"})}),e.jsx("div",{className:"text-token-text-secondary pe-2 text-start text-sm",children:_e(t)})]})}const Ki=()=>e.jsx(tn,{size:"lg",lines:3,width:35,widthVariance:10,className:"w-full"}),Xi=t=>({[oe.Search]:"Web Search",[oe.Research]:"Research",[oe.PictureV2]:"Draw Image",[oe.Think]:"Think Harder"})[t]??"Title",xt=(t,n,a,s,o)=>{V.logEventWithStatsig("Capabilities Suggestion Action","chatgpt_capabilities_suggestion_action",{...ye(a),categoryId:n.categoryId,suggestionId:n.id,position:s,action:t,numSuggestions:String(o)})},Ji=(t,n)=>{const a=l.useRef(!1);l.useEffect(()=>{a.current||(a.current=!0,t.forEach((s,o)=>{xt("show",s,n,o+1,t.length)}))},[t,n])},gn=({suggestions:t,analyticsMetadata:n,style:a="default"})=>{const s=rn();return Ji(t,n),e.jsx(e.Fragment,{children:t.map((o,r)=>e.jsxs(z.div,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},exit:{opacity:0,translateY:4},transition:{delay:r*.03},className:O("w-full flex-1",a==="compact"&&"flex-col"),children:[a==="compact"&&r>0&&e.jsx(mn,{$isSelected:!1}),e.jsx(Qi,{suggestion:o,onSelectingSuggestedReply:s,position:r+1,numSuggestions:t.length,analyticsMetadata:n,style:a})]},o.prompt))})},Qi=({suggestion:t,onSelectingSuggestedReply:n,analyticsMetadata:a,position:s,numSuggestions:o,style:r="default"})=>{const{setThreadSystemHintMode:d}=Ja(),i=Dr(),c=bt();return e.jsx(z.button,{onClick:u=>{if(xt("click",t,a,s,o),t.categoryId===oe.Research)if(i?.isFree()){Ur(c,"Suggested Capabilities Upsell");return}else d(t.categoryId,!0,a);n(u,t,[],0)},onMouseEnter:()=>{xt("hover",t,a,s,o)},className:O("hover:bg-token-main-surface-secondary flex w-full flex-1 items-start rounded-xl text-start transition-colors duration-300 ease-in-out",r==="default"&&"gap-4 p-2"),children:r==="compact"?e.jsx(Zi,{suggestion:t}):e.jsx(el,{suggestion:t})})},Zi=({suggestion:t})=>{const{systemHints:n}=sn(),a=l.useMemo(()=>t.categoryId==="ask"?void 0:n?.find(s=>s.systemHint===t.categoryId),[n,t.categoryId]);return e.jsxs("div",{className:"bg-primary hover:bg-tertiary group flex w-full cursor-pointer items-center justify-start gap-2 rounded-lg px-2 py-3 text-start transition-colors duration-300 ease-in-out",children:[e.jsx("div",{className:"flex items-center justify-center opacity-70 transition-all duration-100 ease-in-out group-hover:scale-[1.02] group-hover:rotate-[-5deg] group-hover:opacity-100",children:t.categoryId==="ask"?e.jsx(ve,{className:"text-token-text-secondary group-hover:text-token-text-primary icon"}):e.jsx(nn,{svgString:a?.logo??"",className:"text-token-text-secondary icon group-hover:text-token-interactive-label-accent-default"})}),e.jsx("div",{className:"text-token-text-secondary group-hover:text-token-text-primary flex items-center pe-2 text-start text-sm",children:_e(t)})]})},el=({suggestion:{categoryId:t,imageUrl:n,description:a,title:s,ctaLabel:o,prompt:r}})=>{const{systemHints:d}=sn(),i=l.useMemo(()=>t==="ask"?void 0:d?.find(c=>c.systemHint===t),[d,t]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-token-border-default bg-primary relative h-16 w-14 flex-shrink-0 rounded-lg border drop-shadow-xs transition-all duration-100 ease-in-out group-hover:scale-[1.02] group-hover:rotate-[-2deg]",children:[t===oe.PictureV2?e.jsx("div",{className:"flex h-full w-full items-center justify-center rounded-lg bg-cover",style:{backgroundImage:`url(${n})`},children:e.jsx(Qa,{className:"icon-xl mb-2 text-white"})}):e.jsxs("div",{className:"flex flex-col gap-1.5 p-2",children:[e.jsx("div",{className:"text-token-text-primary text-[5px] leading-tight font-semibold tracking-tighter",children:s??Xi(t)}),e.jsx("div",{className:"flex flex-col gap-0.5",children:Array.from({length:10}).map((c,u)=>e.jsx("div",{className:"bg-token-border-heavy h-[1px] w-full rounded-full"},u))})]}),e.jsx("div",{className:"absolute -end-2 -bottom-2",children:e.jsx(Za,{isBadge:!0,className:"opacity-100",logo:e.jsx(nn,{svgString:i?.logo??"",className:"icon"})})})]}),e.jsxs("div",{className:"flex flex-col gap-2 text-sm",children:[e.jsx("div",{className:"text-token-text-primary flex-grow",children:a??r}),o&&e.jsxs("div",{className:"text-token-text-secondary flex items-center font-medium",children:[o,e.jsx(z.div,{variants:{hover:{x:2}},initial:{x:0},transition:{duration:.1},children:e.jsx(Or,{className:"icon-sm"})})]})]})]})},vt=(t,n,a,s)=>{V.logEventWithStatsig("Capabilities Tab Action","chatgpt_capabilities_tab_action",{...ye(a),tabId:n,position:s,action:t})},tl=(t,n)=>{const a=l.useRef(!1);l.useEffect(()=>{a.current||(a.current=!0,t.forEach((s,o)=>{vt("show",s.value,n,o+1)}))},[t,n])},sl=({clientThreadId:t,categorySuggestions:n,lastMessageId:a,analyticsMetadata:s,style:o="default"})=>{const r=n.map(({category_id:c,title:u,suggestions:p})=>({value:c,message:u,suggestions:p?.map(Bs)??[]})),[d,i]=l.useState(r[0].value);return tl(r,s),e.jsxs(Hr,{value:d,onValueChange:i,orientation:"horizontal",className:"flex w-full flex-col",children:[e.jsx(Lr,{className:"border-token-border-default relative flex w-full flex-row gap-6 border-b",children:r.map((c,u)=>e.jsx(al,{value:c.value,message:c.message,isActive:d===c.value,analyticsMetadata:s,position:u+1},c.value))}),r.map(c=>e.jsx(Gr,{value:c.value,children:e.jsx(nl,{initialSuggestions:c.suggestions,clientThreadId:t,categoryId:c.value,isActive:d===c.value,lastMessageId:a,analyticsMetadata:s,style:o})},c.value))]})},nl=({initialSuggestions:t,clientThreadId:n,categoryId:a,isActive:s,lastMessageId:o,analyticsMetadata:r,style:d="default"})=>{const i=se(n),c=s&&t.length===0,{suggestions:u,isLoading:p}=eo({categoryId:a,shouldFetch:c,serverThreadId:i,lastMessageId:o}),x=c?u:t;return a==="ask"?p?e.jsx(Ki,{}):e.jsx(un,{followups:x.map(v=>({type:qs.Reply,text:v.prompt})),analyticsMetadata:r}):e.jsx("div",{className:"flex w-full flex-col gap-y-4 py-3 md:flex-row md:gap-x-4",children:p?e.jsxs(e.Fragment,{children:[e.jsx(Ss,{}),e.jsx(Ss,{})]}):e.jsx(gn,{suggestions:x,analyticsMetadata:r,style:d})})},al=({value:t,message:n,isActive:a,analyticsMetadata:s,position:o})=>e.jsxs(Vr,{className:"text-token-text-tertiary hover:text-token-text-secondary radix-state-active:text-token-text-primary relative flex min-w-10 justify-center py-4 text-sm font-medium",value:t,onClick:()=>{vt("click",t,s,o)},onMouseEnter:()=>{vt("hover",t,s,o)},children:[e.jsx("div",{className:"truncate",children:n}),e.jsx(ws,{children:a&&e.jsx(z.div,{layoutId:"tab-underline",className:"bg-token-text-primary absolute start-0 end-0 bottom-0 h-0.5",transition:{type:"spring",stiffness:500,damping:30}})})]}),Ss=()=>e.jsxs("div",{className:"flex flex-1 items-center gap-4 rounded-xl p-2",children:[e.jsx("div",{className:"bg-token-sidebar-surface-secondary dark:bg-token-border-default h-16 w-14 flex-shrink-0 rounded-lg"}),e.jsx("div",{className:"w-full flex-grow",children:e.jsx(tn,{lines:3,size:"sm"})})]}),ol=({clientThreadId:t,categorySuggestions:n,lastMessageId:a,analyticsMetadata:s})=>{if(!n||n.length===0)return null;const o=n.length===1,r=n[0],d=r.suggestions.length>0?r.suggestions:void 0;return o&&d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-1 text-sm font-semibold",children:e.jsx(H,{id:"3UFIQc",defaultMessage:"Follow up"})}),e.jsx(gn,{suggestions:d.map(Bs),analyticsMetadata:s,style:r.style})]}):e.jsx(sl,{clientThreadId:t,categorySuggestions:n??[],lastMessageId:a,analyticsMetadata:s})},rl=(t,n,a,s,o)=>{V.logEventWithStatsig("Agent Suggestion Action","chatgpt_agent_suggestion_action",{...ye(a),capability:n.capability,position:s,action:t,numSuggestions:o})},il=(t,n)=>{const a=l.useRef(!1);l.useEffect(()=>{a.current||(a.current=!0,t.forEach((s,o)=>{rl("show",s,n,o+1,t.length)}))},[t,n])},ll=({agentSuggestions:t,analyticsMetadata:n})=>(il(t,n),e.jsx(e.Fragment,{children:t.map((a,s)=>e.jsxs(z.div,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},exit:{opacity:0,translateY:4},transition:{delay:s*.03},className:O("w-full flex-1","flex-col"),children:[s>0&&e.jsx(mn,{$isSelected:!1}),e.jsx(cl,{agentSuggestion:a,analyticsMetadata:n})]},a.prompt))})),cl=({agentSuggestion:t})=>{const n=Ii(),a=dl(t.capability),s=Js(),o=()=>{n.setText(t.prompt),s("agent"),n.focus()};return e.jsxs("div",{onClick:o,className:"bg-primary hover:bg-tertiary group flex w-full cursor-pointer items-center justify-start gap-2 rounded-lg px-2 py-3 text-start transition-colors duration-300 ease-in-out",children:[e.jsx("div",{className:"flex items-center justify-center opacity-70 transition-all duration-100 ease-in-out group-hover:scale-[1.02] group-hover:opacity-100",children:e.jsx(a,{className:"text-token-text-secondary group-hover:text-token-text-primary icon"})}),e.jsx("div",{className:"text-token-text-secondary group-hover:text-token-text-primary flex items-center pe-2 text-start text-sm",children:t.title})]})},js={action:to,research:ve,spreadsheet:ve,presentation:ve,default:ve},dl=t=>js[t]??js.default;function ul({clientThreadId:t,followups:n,categorySuggestions:a,actionSuggestions:s,lastMessageId:o,analyticsMetadata:r,isTatertotFollowupsEnabled:d}){const i=ke(Tt),c=so.useIsEnabled(t)&&!i,{capabilitySuggestionsEnabled:u}=Ds(d),p=a&&a.length>0;return s&&s.length>0?e.jsx(ll,{agentSuggestions:s,analyticsMetadata:r}):e.jsx(e.Fragment,{children:c&&(u?p&&e.jsx(ol,{clientThreadId:t,lastMessageId:o,categorySuggestions:a,analyticsMetadata:r}):n.length>0&&e.jsx(ml,{followups:n,analyticsMetadata:r}))})}function ml({followups:t,analyticsMetadata:n}){return e.jsxs("div",{className:"group",children:[e.jsx("hr",{className:"bg-token-bg-tertiary mt-5 mb-5 opacity-70"}),e.jsx(un,{followups:t,analyticsMetadata:n})]})}async function gl(t,n,a,{unprocessed:s=!1}={}){const o=[],r=[],d={};for(const i of t.messages){if(pn(i)){const c=i.metadata?.content_references,u=et(i);if(s)o.push(u);else{const p=Ai(u,c);p["text/plain"]&&o.push(p["text/plain"]),p["text/html"]&&r.push(p["text/html"])}}if(Wr(i)){const c=an.getImageAssetPointers(i);if(c.length>0){const u=c[0];try{const p=se(a),{url:x}=await no.fetch(n,{asset:u,conversationId:p??void 0}),b=await(await fetch(x)).blob();["image/png","image/jpeg","image/webp"].includes(b.type)&&(d[b.type]=b)}catch{return Promise.reject()}}}}return o.length>0&&(d["text/plain"]=o.join(`

`)),r.length>0&&(d["text/html"]=r.join(`

`)),d}function pn(t){return!t.clientMetadata?.err&&(t.author.role===L.Assistant||t.author.role===L.User)&&(t.author.role===L.User||t.recipient==="all")&&!t.metadata?.reasoning_status}const hn=({turn:t})=>{const n=ao(),a=Q(),s=re(),o=be(s,"1894790777");function r(){ro.logButtonClick(io.EDIT_IN_CANVAS_MESSAGE);const d=pl(t);n&&ts.removeTempTextdoc(n.textdocId);const i=ts.createTempTextdoc(d,a.formatMessage({id:"9e0Zzr",defaultMessage:"New document"}),lo.MESSAGE);requestAnimationFrame(()=>{co(i)})}return e.jsx(le,{icon:oo,onClick:r,label:a.formatMessage({id:"EditInCanvas.tooltip",defaultMessage:"Edit in canvas"}),asMenuItem:o})};function pl(t){return t.messages.filter(n=>pn(n)&&n.author.role===L.Assistant).map(n=>et(n,{shouldGetTextFromContentReferences:!0,shouldGetVisibleText:!1})).filter(Boolean).join(`

`)}const fn=ce(()=>pe(()=>import("./gjsedudfjvyfngnj.js"),__vite__mapDeps([20,2,1,3,21,22,5,6,23,24])).then(t=>t.VoicePlayButton));function hl({showPlayButton:t,showCanvasButton:n,showJujutsuButton:a,clientThreadId:s,messages:o,lastMessage:r,imageGenMessageId:d,turn:i,turnIndex:c,requestId:u}){const x=Q().formatMessage({id:"e/27r7",defaultMessage:"More actions"});return e.jsx(Ks,{triggerButton:e.jsx("button",{className:"text-token-text-secondary hover:bg-token-bg-secondary touch:w-10 flex h-8 w-8 items-center justify-center rounded-lg",onMouseOver:()=>{fn.prefetch()},"aria-label":x,children:e.jsx(yt,{className:"icon"})}),size:"auto",contentAlign:"start",alignOffset:-7,side:"top",sideOffset:4,tooltip:x,children:e.jsx(fl,{showPlayButton:t,showCanvasButton:n,showJujutsuButton:a,clientThreadId:s,messages:o,lastMessage:r,imageGenMessageId:d,turn:i,turnIndex:c,requestId:u})})}function fl({showPlayButton:t,showCanvasButton:n,showJujutsuButton:a,clientThreadId:s,messages:o,lastMessage:r,imageGenMessageId:d,turn:i,requestId:c}){const u=Q();return e.jsxs(e.Fragment,{children:[t&&r&&e.jsx(fn,{conversationId:s,message:r}),n&&e.jsx(hn,{turn:i}),!1,e.jsx(Us,{children:({openScheduleModal:p,isScheduled:x,isSchedulable:v})=>!x&&v?e.jsx(le,{icon:Os,label:u.formatMessage({id:"l12ujd",defaultMessage:"Schedule"}),onClick:p,trailing:e.jsx(H,{id:"Vn8LDj",defaultMessage:"Internal"}),asMenuItem:!0}):null}),!1,!1,!1]})}const xn=async(t,n,a,s,o,r="mouse",d)=>{const c=U.getConversationTurns(Me(n))[a];if(!c)return Promise.reject();const{messages:u}=c,p=o,x=u[0]?.author.role===L.User,v=p.metaKey||p.altKey,b=await gl(c,d,n,{unprocessed:v||x});await uo(b,s,o);const T=se(n);T&&mo(t,{messageId:u[0].id,type:"copy",serverThreadId:T,selectedText:et(u[0]),source:r,location:"message"})},xl=ce(()=>pe(()=>import("./gjsedudfjvyfngnj.js"),__vite__mapDeps([20,2,1,3,21,22,5,6,23,24])).then(t=>t.VoicePlayButton)),vl=ce(async()=>()=>null),bl=({alwaysShow:t,isUserTurn:n,children:a})=>{const s=l.useRef(null);return l.useEffect(()=>{const o=s.current;o&&(t?requestAnimationFrame(()=>{o&&(o.style.maskPosition=t?"0% 0%":"")}):o.style.maskPosition="")},[t]),e.jsx("div",{className:O("flex",!t&&"absolute start-0 end-0 flex",n?"justify-end":"min-h-[46px] justify-start"),children:e.jsx("div",{ref:s,className:O("touch:-me-2 touch:-ms-3.5 -ms-2.5 -me-1 flex flex-wrap items-center gap-y-4 p-1 select-none",!n&&"touch:w-[calc(100%+--spacing(3.5))] -mt-1 w-[calc(100%+--spacing(2.5))]",t&&!n&&"duration-[1.5s]","focus-within:transition-none hover:transition-none",!(t||n)&&"duration-500 group-hover/turn-messages:delay-300",!n&&["pointer-events-none [mask-image:linear-gradient(to_right,black_33%,transparent_66%)] [mask-size:300%_100%] [mask-position:100%_0%] motion-safe:transition-[mask-position]","group-hover/turn-messages:pointer-events-auto group-hover/turn-messages:[mask-position:0_0]","group-focus-within/turn-messages:pointer-events-auto group-focus-within/turn-messages:[mask-position:0_0]","has-data-[state=open]:pointer-events-auto has-data-[state=open]:[mask-position:0_0]"],n&&["duration-300 group-hover/turn-messages:delay-300","pointer-events-none opacity-0 motion-safe:transition-opacity","group-hover/turn-messages:pointer-events-auto group-hover/turn-messages:opacity-100","group-focus-within/turn-messages:pointer-events-auto group-focus-within/turn-messages:opacity-100","has-data-[state=open]:pointer-events-auto has-data-[state=open]:opacity-100"]),children:a})})},yl=({activeVariantIndex:t,clientThreadId:n,conversationMode:a,lastMessage:s,messages:o,numVariants:r,onChangeIndex:d,onRate:i,showCanvasButton:c,showCopyButton:u,showPagination:p,showPlayButton:x,showRatingButtons:v,showRegenerateButton:b,turn:T,turnIndex:j,parentPrompt:E})=>{const _=re(),q=Q(),I=Qe(),N=Rs(),M=ke(zr),k=be(_,"1894790777"),m=s?.clientMetadata?.rating,h=s?.clientMetadata?.requestId,{imageGenMessages:y,canvasMessage:f,enableImageGenPostSharing:F,enableMessageSliceSharing:S,hasErrorInTurn:B,isIncomplete:w}=po(o),C=ho.useSelectedIndex(),$=o.filter($r).filter(Z=>Z.recipient==="all"),K=y.length>0,Y=f!=null,X=Yr(),ie=se(n),Se=Kr(_),de=K&&$.length===0&&y.some(us),he=o.some(Z=>Z.metadata?.n7jupd_message),G=ie!=null&&!B&&!w&&!he&&Se;let je=null;return G&&(F||S?je=e.jsx(jl,{clientThreadId:n,imageGenMessageId:y[C]?.id,messages:o}):X&&_t(_,"1547743984").get("show_share_button_inline",!1)&&(je=e.jsx(le,{onClick:()=>{ie&&Gs.openSharingModal(ie)},label:q.formatMessage({id:"ConversationTurn.shareButtonTooltip",defaultMessage:"Share conversation"}),className:"sm:hidden",icon:Ls}))),s&&gt(s)&&!us(s)?null:e.jsxs(e.Fragment,{children:[p&&e.jsx(Hs,{currentPage:t,onChangeIndex:d,length:r}),u&&!de&&!M&&e.jsx(vn,{onClick:Z=>{xn(_,n,j,I,Z,"mouse",N)}}),v&&!K&&e.jsxs(e.Fragment,{children:[m!=="thumbsDown"&&e.jsx(le,{onClick:()=>i("thumbsUp"),disabled:m==="thumbsUp",icon:m==="thumbsUp"?fo:xo,label:q.formatMessage({id:"ConversationTurn.goodResponseTooltip",defaultMessage:"Good response"}),testId:"good-response-turn-action-button"}),m!=="thumbsUp"&&e.jsx(le,{onClick:()=>i("thumbsDown"),disabled:m==="thumbsDown",icon:m==="thumbsDown"?vo:bo,label:q.formatMessage({id:"ConversationTurn.badResponseTooltip",defaultMessage:"Bad response"}),testId:"bad-response-turn-action-button"})]}),x&&s&&$.length>0&&!k&&e.jsx(xl,{conversationId:n,message:s,iconClassName:"icon",className:"text-token-text-tertiary hover:text-token-text-primary gap-1.5 rounded-md p-1 text-xs"}),c&&!K&&!Y&&!k&&!M&&e.jsx(hn,{turn:T}),je,!1,b&&s&&!M&&e.jsx(Sl,{clientThreadId:n,conversationMode:a,lastMessage:s,messages:o,hasImageGenMessage:K,parentPrompt:E}),k&&!M&&e.jsx(hl,{showPlayButton:!!(x&&s&&$.length>0),showCanvasButton:!K&&c,showJujutsuButton:G&&be(_,"3096078201"),turnIndex:j,clientThreadId:n,messages:o,imageGenMessageId:y[C]?.id,lastMessage:s,turn:T,requestId:h}),!k&&e.jsx(Us,{children:({openScheduleModal:Z,isScheduled:we,isSchedulable:Re})=>!we&&Re?e.jsx(le,{icon:Os,label:q.formatMessage({id:"l12ujd",defaultMessage:"Schedule"}),onClick:Z}):null}),!1,!1,null]})},Tl=({activeVariantIndex:t,clientThreadId:n,numVariants:a,onAnticipateEdit:s,onChangeIndex:o,onEnterEdit:r,showCopyButton:d,showEditMessageButton:i,showPagination:c,turnIndex:u})=>{const p=re(),x=Qe(),v=Rs();return e.jsxs(e.Fragment,{children:[d&&e.jsx(vn,{onClick:b=>{xn(p,n,u,x,b,"mouse",v)}}),i&&e.jsx(go,{onAnticipateEdit:s,onEnterEdit:r}),c&&e.jsx(Hs,{currentPage:t,onChangeIndex:o,length:a})]})},Sl=({clientThreadId:t,conversationMode:n,messages:a,hasImageGenMessage:s,lastMessage:o,parentPrompt:r})=>{const d=jo({clientThreadId:t,conversationMode:n}),i=_o(t,o),c=l.useCallback(({sourceEvent:u,requestedModelId:p,appendMessages:x,extraStreamParams:v})=>{o&&d({sourceEvent:u,nodeId:o.id,requestedModelId:p,appendMessages:x,extraStreamParams:v})},[o,d]);return s?e.jsx(vl,{messages:a,onModelSelect:c}):e.jsx(Co,{className:"text-token-text-secondary hover:bg-token-bg-secondary touch:px-2.5 h-[30px] rounded-md px-1.5",clientThreadId:t,message:o,onModelSelect:c,canRegenerateResponse:i,parentPrompt:r})},vn=({onClick:t})=>{const[n,a]=l.useState(!1),s=yo(),o=Q(),r=l.useCallback(d=>{d.stopPropagation(),V.logEvent("ChatGPT Turn Action Copy Clicked"),t(d),a(!0),setTimeout(()=>{s()&&a(!1)},2e3),xe.logEvent("chatgpt_turn_action_copy")},[s,t]);return e.jsx(le,{icon:n?Xr:To,onClick:r,label:o.formatMessage({id:"CopyButton.copyTooltip",defaultMessage:"Copy"}),testId:"copy-turn-action-button"})};function jl({clientThreadId:t,imageGenMessageId:n,messages:a}){const[s,o]=l.useState(!1),r=Q(),d=l.useMemo(()=>n?"media_generation":"message_slice",[n]),i=a?.map(u=>u.id)??void 0,c=So({clientThreadId:t,imageGenMessageId:n,messageSliceIds:i});return l.useEffect(()=>{V.logEventWithStatsig("Share Post: Share Button Shown","chatgpt_post_share_button_shown",{source:"turn_action",attachment_type:d})},[d]),e.jsx(le,{onClick:async()=>{o(!0);try{await c()}finally{o(!1)}V.logEventWithStatsig("Share Post: Share Button Clicked","chatgpt_post_share_button_clicked",{source:"turn_action",attachment_type:d})},label:r.formatMessage({id:"ConversationTurn.sharePostButtonTooltip",defaultMessage:"Share"}),icon:s?$s:Ls,disabled:s})}const _l=ce(()=>pe(()=>import("./nds67ntn5u3du51f.js"),__vite__mapDeps([17,1,2,3,5,6,18,19])).then(t=>t.MemoryActionResult)),Cl=ce(()=>pe(()=>import("./hbsgsme608z3xhlj.js"),__vite__mapDeps([25,2,1,3,5,6,26])).then(t=>t.AutomationSourceHeader)),_s=ce(()=>pe(()=>import("./ekilws0edo0o2kpo.js"),__vite__mapDeps([27,2,1,3,5,6,28])).then(t=>t.TextMessageEditor)),Cs=80,Il=16;function Is(){return{minHeight:`calc(100dvh - ${As}px - 120px - ${Ze()}px)`}}function Ml(t){const{turnIndex:n,isFinalTurn:a,clientThreadId:s,onRequestCompletion:o,currentModelId:r,scrollToMessageId:d,dateHeaderType:i,hideUserActions:c}=t,u=re(),p=Ps(u,s),x=Vs(u),v=Io(),b=l.useContext(Xs),[T,j]=ke(g=>[Tt(g),St(g)]),E=!!v&&Jr(v),_=Mo(ko.isBusinessWorkspace),q=or(),[I,N,M]=ge(s,g=>{const P=U.getConversationTurnAtIndex(g,n),D=n>0?U.getConversationTurnAtIndex(g,n-1):null,A=D?.role===L.User&&D.messages.some(J=>J.metadata?.visually_hide_response_from_conversation);return[P,A,D]}),{messages:k,messageGroups:m}=I,h=wo(g=>g.size===0?-1:m.findIndex(P=>P.type===mt?P.groups.some(D=>D.messages.some(A=>g.has(A?.id))):P.messages.some(D=>g.has(D?.id)))),y=k[0],f=R(k),F=m.some(g=>g.type===Qr.SearchGPTQuery),[S,B]=l.useState(!1),w=l.useMemo(()=>k.some(g=>g.metadata?.n7jupd_message),[k]),{messages:C,visibleMessages:$,messageGroups:K,lastMessageToRender:Y}=l.useMemo(()=>{const g=h!==-1&&h+1<m.length,P=g?m.slice(0,h+1):m,D=g?P.flatMap(A=>A.type===mt?A.groups.flatMap(J=>J.messages):A.messages):k;return{messages:D,visibleMessages:D.filter(Zr),messageGroups:P,lastMessageToRender:R(D)}},[k,m,h]),X=h!==-1,ie=be(u,"1887864177"),Se=_i(),de=ge(s,g=>U.getLastMessageSystemHints(g)),he=ei(),G=de?.includes(oe.Tatertot)&&be(u,"28816792")&&he,{capabilitySuggestionsEnabled:je}=Ds(G),Z=l.useMemo(()=>({clientThreadId:s,turnIndex:n,messageId:f?.id}),[s,n,f?.id]),[we,Re]=l.useState(!1),[It,bn]=l.useState(!1),yn=l.useContext(Ro)!=null,W=I.role===L.User,Mt=ti(),Ee=si(s),kt=Eo(I.gizmoId??Ee).data,tt=on(s),Tn=ni(s),wt=ai(tt),Sn=oi(tt,Tn),Rt=ri(),[st,jn,_n,Et,Pe,nt,Cn,Pt,In,At,Mn,ne,Ae,Ne,kn,wn]=ge(s,g=>{const P=U.getParentPromptNode(g,y.id),D=P?.message.clientMetadata?.variantsInStreamInfo??(P?.message.metadata?.paragen_variant_choice?void 0:P?.message.metadata?.paragen_variants_info),A=U.getVariantIds(g,y.id),J=U.getCurrentVariantId(g,y.id),ut=J?A.indexOf(J):0,ya=D&&g?.tree!=null&&A.some(ae=>{const{errType:Xt}=g.tree.getLeafFromNode(ae).message.clientMetadata??{};return Xt!=null&&Xt!=="info"}),Ge=U.getConversationTurns(g);return[P,U.isMessageTurnEnded(g,f?.id),ya,rr(g?.mode,kt?.gizmo.id),g?.continuingFromSharedConversationId!=null,Ge.findIndex(ae=>ae.role===L.User)===n,os(Ge,ae=>ae.role===L.User)===n,Ge.findIndex(ae=>ae.role===L.Assistant)===n,os(Ge,ae=>ae.role===L.Assistant)===n,U.getRequestId(g,f?.id),D,A,ut,!!g?.continuingFromSharedPostId,g?.currentLeafId,U.getSuperWidgetMessages(g,n)[0]]}),Fe=Ke(()=>{const g=p.asyncStatus$();return g?.value===We.STREAMING||g?.value===We.REALTIME}),Rn=C.some(g=>g.content.content_type===Ce.MultimodalText),En=_t(u,"3119715334").get("should-enable-skip",!1),{isUnauthenticated:Nt}=zs(),Ft=I.messages.map(g=>g.id),ee=l.useRef(null),Bt=!x&&(d?.length??0)>2&&d!=="finalAgentTurn"&&a&&q,Be=W?R($):void 0,at=Be?.id,Pn=l.useCallback(()=>{at&&(V.logEvent("Edit Prompt",{id:at,threadId:se(s)}),ii(u,"chatgpt_edit_prompt"),Re(!0))},[u,at,s]),An=l.useCallback(()=>{Re(!1)},[]),qt=li()??!1,{onChangeRating:Nn}=Po({clientThreadId:s,currentModelConfig:tt}),Fn=g=>{if(!f)return;Nn({nodeId:f.id,messageId:f.id,rating:g});const P=qt&&m.some(D=>D.type!==mt&&D.messages?.some(xi));V.logEventWithStatsig(g==="thumbsDown"?"Message Feedback Thumbs Down Clicked":"Message Feedback Thumbs Up Clicked","chatgpt_thumb_feedback",{id:f.id,threadId:se(s),model:r,rating:g,...qt?{isCATriggered:P}:{}}),bn(!0)},[Bn]=l.useState(()=>Date.now()),qn=ci(s),Dt=Ao(s)?.value,Dn=Dt===We.STREAMING,Un=Dt===We.REALTIME,On=At!=null,Hn=Ns(At),Ln=ss.useState(g=>ss.isReplayInProgress(g,kn)),te=!jn&&Hn||X||Un||Ln&&a,Ut=Fs(),Ot=l.useRef(!1),Gn=di({clientThreadId:s}),Vn=No(s,f)&&!Gn,[,Wn]=_a(),{isOpen:ot}=ht(),Ht=Ws();l.useEffect(()=>{const P=new URLSearchParams(window.location.search).get("message");!(P!=null&&Ft.includes(P))||!ee.current||(ee.current.scrollIntoView({behavior:"instant"}),Wn(A=>(A.delete("message"),A),{replace:!0,preventScrollReset:!0}))},[]),l.useEffect(()=>{if(x)return;const D=new URLSearchParams(window.location.search).get("message")!=null;if(Ot.current||D||d===void 0||!ee.current||Ht){d==="finalAgentTurn"&&a&&Ie(s,A=>{A.scrollToMessageId=void 0});return}(Ft.includes(d)||d==="finalAgentTurn"&&a)&&(Ot.current=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(ee.current)if(d==="finalAgentTurn"&&a)ee.current.scrollIntoView({behavior:"instant",block:"end"}),Ie(s,A=>{A.scrollToMessageId=void 0});else{const A=ee.current.offsetHeight;let J=0;ot?J=-8:T?J=0:A>Cs&&(J=Cs-A);const ut=T?Ze():Il;ee.current.style.scrollMarginTop=`${J+ut}px`,ee.current.scrollIntoView({behavior:"smooth"})}})}))},[d,ee.current,ot,Ht]);const{showDebugConversationTurns:zn}=en(),$n=Fo(s),Yn=!Pe&&!Ne&&!Mt&&!W,Kn=Y?.author.role===L.Assistant?Y:null,Xn=Y?.metadata?.system_hints?.includes(oe.Research);Bo({isCompletionRequestInProgress:te,isUserTurn:W,message:Kn});const{isOpen:Jn}=ht(),Qn=qo(),qe=Do(Et),De=!qe&&Yn&&a&&Mn?.num_variants_in_stream===2&&ne.length<=2&&!f?.clientMetadata?.inlineComparisonRating&&!_n,Zn=Uo(g=>g.voiceFeedbackThread),Lt=qn===Zn,ea=f?.metadata?.async_source,Ue=a&&On,fe=Fe||te||Dn,rt=!we&&!Pe&&!Ne&&!qe&&!Jn&&!j&&I.role!==L.Developer&&!(I.role===L.User&&c)&&!(a&&Lt&&fe)&&!(Ue&&fe)&&!(a&&Fe&&ea)&&!(fe&&w)&&!f?.metadata?.is_auto_proceed_message&&!f?.metadata?.is_takeover_ended_message,ta=!rt&&!(Ue&&fe)&&(Pe||Ne),sa=C.some(g=>ui(g)===mi.l1239dk1),it=ge(s,g=>{const P=new Set;return U.getParentPromptNode(g,y.id)?.message.metadata?.attachments?.forEach(A=>{A.mime_type?.startsWith("image/")||P.add(A.context_connector_info?.context_connector??"file")}),P}),lt=gi(),ct=pi(u,"110789670");let ue;lt.isLoading?ue=void 0:lt.canUpgradeGDrive&&it.has(ze.GDRIVE)&&ct.get("enabled",!1)?ue=ze.GDRIVE:lt.canUpgradeSharepoint&&it.has(ze.O365_BUSINESS)&&ct.get("enabled",!1)?ue=ze.O365_BUSINESS:it.has("file")&&ct.get("enabled",!1)&&(ue="general");const na=Ue&&!te&&!j&&!Pe&&!Ne&&!sa&&(ie||Se||je||G||!!ue),Oe=f!=null&&(!_||Sn||E||Rt)&&!qe&&!Nt&&!Mt&&!f.metadata?.b1de6e2_s,Gt=(!_||Rt)&&Oe&&(Ue||a&&Lt)&&!Fe&&!te&&!j&&!ot&&!w,Vt=!((te||Fe)&&a)&&ne.length>1&&!De,Wt=W&&C.some(g=>ns(g)?.shouldHideContent),aa=W&&Be!=null&&!qe&&!Rn&&!Wt&&!Nt&&!Xn,oa=f!=null&&(f.clientMetadata?.disclaimers??[]).length===0,zt=R(M?.messages.filter(hi)),ra=Qs(b)&&Pt,$t=l.useCallback(g=>{Ie(s,P=>{jt.setCurrentBranch(P,ne[g])}),V.logEvent("Change Active Node",{intent:"toggle_between"}),be(u,"4126691920")&&Oo({parent_prompt_id:st?.id??"",prev_branch_id:ne[Ae],next_branch_id:ne[g]},se(s))},[s,ne,Ae,st?.id,u]),ia=Ho(I,C,zn),{toggleThreadSidebar:Yt}=fi(),He=f?.id,la=l.useCallback(()=>{He&&Yt({type:"retrievalResults",clientThreadId:s,turnIndex:n,messageId:He})},[He,Yt,s,n]),ca=l.useMemo(()=>Lo(I,wt,!!Ee),[wt,Ee,I]),da=l.useMemo(()=>C.some(g=>ns(g)?.canRetry===!1),[C]),ua=f?.metadata?.n7jupd_button_type,ma=w&&f!=null&&f.id!=null&&!ua,ga=w&&a&&fe,pa=w&&a;if(!ia&&!De)return Bt?e.jsx("div",{style:Is()}):null;if(N)return null;const ha=Y?.metadata?.followup_prompts?Y.metadata.followup_prompts.map(g=>({text:g,type:qs.Reply})):[],fa=Y?.metadata?.category_suggestions,xa=Y?.metadata?.action_suggestions,va=!C.some(g=>an.getAudioAssetPointers(g).length>0)&&!Ee&&!da,ba=!te&&C.some(g=>g.author.role===L.Assistant&&g.metadata?.onboarding?.main_usages),dt=C.find(g=>!!g.metadata?.onboarding?.examples)?.metadata?.onboarding?.examples,Kt=!Wt&&(!a||!te);if($n&&!a&&$.length===0&&!w)return null;let Le="none";return W&&nt&&(Le="first"),W&&!nt&&(Le="large"),a&&(Le="last"),e.jsx(Go.Provider,{value:Pt,children:e.jsxs(Vo,{children:[e.jsx(Wo,{dateHeaderType:i,turn:I}),e.jsxs("article",{className:O("text-token-text-primary w-full",!x&&d==="finalAgentTurn"&&q?"opacity-0":"",{hidden:yn&&nt}),style:Bt?Is():void 0,ref:ee,dir:"auto","data-testid":`conversation-turn-${n}`,"data-scroll-anchor":!x&&a,children:[e.jsx(zo,{role:I.role}),e.jsx($o,{role:I.role,children:e.jsxs(Yo,{horizontalPadding:De?"none":"standard",verticalPadding:Le,children:[De?e.jsxs(e.Fragment,{children:[e.jsx(zi,{isFeedbackEnabled:Oe,variantIds:ne,conversationTurnMountTime:Bn,...t}),En&&e.jsx("div",{className:"mt-4 flex w-full justify-center",children:e.jsxs(Je,{color:"secondary",className:"text-token-text-primary","data-testid":"paragen-skip-button",onClick:()=>{Zs.publish({kind:"requestCompletion",isForSkippingParagen:!0})},children:[e.jsx(Ko,{className:"text-token-text-secondary me-1"}),e.jsx(H,{id:"IuTr+b",defaultMessage:"Skip"})]})})]}):e.jsxs(Xe,{tabIndex:-1,className:O("group/turn-messages focus-visible:outline-hidden",S&&"super-widget-visible",W&&!rt&&!j&&"mb-10",nr({isUserTurn:W})),children:[ra&&e.jsx(Xo,{clientThreadId:s,threadContent:wn?.content??null,query:zt?et(zt):null,triggeredSearch:F,onNavLinksWidgetDidShow:g=>{g&&B(!0)}}),!W&&e.jsx(_l,{messages:C,clientThreadId:s,gizmoId:kt?.gizmo.id}),Qn&&W&&e.jsx(Cl,{clientThreadId:s,messages:C}),we&&Be?e.jsx(_s,{message:Be,clientThreadId:s,onRequestCompletion:o,onExitEdit:An,disabled:Ut}):e.jsx(ft,{allMessages:k,groupedMessagesToRender:K,allGroupedMessages:m,...t,isUserTurn:W,isFinalUserTurn:Cn,isFinalAssistantTurn:In,isCompletionRequestInProgress:te,isFeedbackEnabled:Oe,isFinalTurn:a,hasActiveRequest:Ut,hasN7JUPD:w}),ca&&e.jsx(Jo,{handleShowRetrievalResults:la,clientThreadId:s,turnIndex:n,responseComplete:!fe}),ma&&e.jsx(Qo,{message:f,clientThreadId:s,turnIndex:n,referenceMessageId:f.id,responseComplete:!a||!te}),ba&&e.jsx(Ei,{clientThreadId:s}),dt&&dt.length>0&&!te&&e.jsx(Pi,{clientThreadId:s,examples:dt}),rt&&e.jsx("div",{className:"mx-[var(--mini-thread-content-inset)]",children:e.jsx(bl,{isUserTurn:W,alwaysShow:!0,children:W?T?null:e.jsx(Tl,{activeVariantIndex:Ae,clientThreadId:s,numVariants:ne.length,onAnticipateEdit:_s.prefetch,onChangeIndex:$t,onEnterEdit:Pn,showCopyButton:Kt,showEditMessageButton:aa,showPagination:Vt,turnIndex:n}):e.jsxs(e.Fragment,{children:[e.jsx(yl,{activeVariantIndex:Ae,clientThreadId:s,conversationMode:Et,lastMessage:f,messages:C,numVariants:ne.length,onChangeIndex:$t,onRate:Fn,showCanvasButton:Vn,showCopyButton:Kt,showPagination:Vt,showPlayButton:oa,showRatingButtons:Oe,showRegenerateButton:va,turn:I,turnIndex:n,parentPrompt:st}),e.jsx(as,{clientThreadId:s,message:f,turnIndex:n}),Gt&&e.jsx(Zo,{canShowInlineMessageFeedback:It,clientThreadId:s,messageForRating:f})]})})}),ga&&e.jsx(er,{clientThreadId:s}),pa&&e.jsx(Wi,{clientThreadId:s,messages:C}),ta&&e.jsx(as,{clientThreadId:s,message:f,turnIndex:n}),Gt&&e.jsx(tr,{canShowInlineMessageFeedback:It,clientThreadId:s,messageForRating:f,allGroupedMessages:m,currentModelId:r}),na&&(ue?e.jsx(sr,{clientThreadId:s,connectorToUpsell:ue,analyticsMetadata:Z}):e.jsx(ul,{followups:ha,actionSuggestions:xa,categorySuggestions:fa,clientThreadId:s,lastMessageId:He,analyticsMetadata:Z,isTatertotFollowupsEnabled:G}))]}),e.jsx(ar,{clientThreadId:s,turn:I,isFinalTurn:a})]})})]})]})})}const kl=ja.memo(Ml);function Yl(t){const{prefetchNavlink:n,clearPrefetchNavlink:a,clientThreadId:s,pageLoadSearchQuery:o}=t,r=re(),d=Vs(r),i=ir(s),c=lr(),u=cr(),{isOpen:p}=ht(),x=u.store.useContentAreaDimensions(dr.Header,b=>b?.height?b.height:void 0);let v=e.jsx(wl,{isNewScrollEnabled:d,...t});return Oi()&&(v=e.jsx(Hi,{clientThreadId:s,children:v})),v=e.jsx(gr,{clientThreadId:s,children:v}),e.jsxs("div",{onCopy:i,className:O("@thread-xl/thread:pt-header-height flex flex-col text-sm",c&&"keyboard-open:pb-[calc(var(--composer-height,100px)+var(--screen-keyboard-height,0))]",x?null:!d&&(p?"max-sm:pb-25":"pb-25")),style:{paddingBottom:x},children:[o&&e.jsx("div",{children:e.jsx(ur,{query:o})}),n?e.jsx(vi,{name:"prefetch-navlink",onError:b=>{pt.addError("Error with prefetch navlink",{error:b}),a()},children:e.jsx(l.Suspense,{fallback:null,children:e.jsx(mr,{clientThreadId:s,prefetchNavlink:n,clearPrefetchNavlink:a})})}):null,e.jsx(bi,{children:v})]})}function wl({onRequestCompletion:t,clientThreadId:n,scrollContainerRef:a,isNewScrollEnabled:s}){const[o,r,d]=ge(n,m=>[U.getConversationTurnIds(m),m?.conversationOrigin===yi.APPLE,m?.scrollToMessageId]),i=Ti(),c=Ws(),u=Si(),p=pr(),[x]=hr(),v=fr(),[b]=xr(),T=on(n);l.useEffect(()=>{i&&(xe.logEvent("chatgpt_continue_conversation_page_loaded"),V.logEvent("Continue Conversation: Page Loaded"),xe.logEvent("chatgpt_conversation_share_page_loaded"),V.logEvent("Share Public Chat: Shared Conversation Loaded"))},[i]);const j=l.useCallback(()=>{s||p({behavior:"smooth"})},[s,p]),E=ke(St),[_,q]=l.useState(!1),I=(_||!1)&&!E,N=l.useRef(null),M=vr(n),k=c&&!u;return e.jsxs(e.Fragment,{children:[k&&e.jsx(Di,{}),i&&e.jsxs(e.Fragment,{children:[e.jsx(Xe,{children:e.jsx("p",{className:"text-xs text-gray-500",children:e.jsx(H,{id:"threadLayout.sharedConversationCopyDisclaimer",defaultMessage:"This is a copy of a conversation between ChatGPT & Anonymous."})})}),e.jsx("div",{className:"text-token-text-primary mb-5 text-center text-xs font-semibold",children:e.jsx("button",{onClick:()=>{Gs.openModal(br.ReportConversation),xe.logEvent("chatgpt_conversation_share_report_content_clicked",null,{location:"Static Shared Thread Page"}),V.logEvent("Share Public Chat: Report Content Clicked",{location:"Dynamic Shared Thread Page"})},children:e.jsx(H,{id:"thread.reportSharedConversation",defaultMessage:"Report conversation"})})})]}),o.map((m,h)=>e.jsx(kl,{isFinalTurn:h===o.length-1,turnIndex:h,clientThreadId:n,onRequestCompletion:t,currentModelId:T.id,scrollToBottom:s?void 0:j,scrollToMessageId:s?void 0:d,dateHeaderType:M(h),hideUserActions:E},m)),!s&&e.jsxs(e.Fragment,{children:[a?.current&&e.jsx(ji,{setIsScrolledToEdge:m=>{q(m)},options:{root:a.current,threshold:0,rootMargin:"0%"}},"threadBottomEdgeScrollObserver"),e.jsx("div",{ref:N}),r&&x&&!b&&e.jsx(Ms,{className:O("translate-y-[10px] md:translate-y-[30px]"),onClick:()=>{xe.logEvent("chatgpt_thread_scroll_to_top"),v({behavior:"smooth"})},children:e.jsx(yr,{className:"icon text-token-text-primary"})}),e.jsx(ws,{children:I&&e.jsx(z.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15,ease:"easeInOut"},children:e.jsx(Ms,{className:O("bottom-[calc(var(--composer-overlap-px)+--spacing(6))]"),onClick:()=>{xe.logEvent("chatgpt_thread_scroll_to_bottom"),N.current?.scrollIntoView({behavior:"smooth",block:"end"})},children:e.jsx(Tr,{className:"icon text-token-text-primary"})})})})]})]})}const Ms=Te.button`cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-token-text-secondary border-token-border-default end-1/2 translate-x-1/2 bg-token-main-surface-primary w-8 h-8 flex items-center justify-center`;export{zl as P,$l as S,Yl as T,cn as a};
//# sourceMappingURL=lc0ql189cwpzn88w.js.map
