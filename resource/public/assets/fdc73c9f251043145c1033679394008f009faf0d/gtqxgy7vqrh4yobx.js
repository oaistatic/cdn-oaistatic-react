import{ag as K,hw as B,aV as F,iZ as O,j4 as q}from"./or7jf62i5kvok6pm.js";import{u as L,h as N,e as y,r,j as a,ah as $,n as Q,P as U}from"./juy90og0wtbp77qa.js";import{fs as I,ft as G,b_ as V,fu as Z,W as z,w as H,x as p,y as x,fv as J,b$ as X}from"./kax7wcp9i7f7jtvz.js";import{c as Y,d as tt}from"./g1mzshmp15rgsy0r.js";import{P as st}from"./mj9z9iuqobsziv2h.js";import{u as et,W as rt}from"./ijrieqdsn05t7zlp.js";import{u as ot}from"./n74iabl73l4zjty8.js";import"./e823k7iso04i0ozj.js";import"./hesgehv7nq0kfowp.js";import"./fzrn137102spawew.js";import"./fy5hpi3mruy96a69.js";import"./k7mo5cksz9ju4mai.js";import"./mq5kqcvga15eqze5.js";import"./hdclltxvbgzx8xl8.js";import"./klzyif2r6c67lyfu.js";import"./oz61hhgglf8a0a5f.js";import"./ibqg5gvcvb5336z5.js";import"./gtarz7mxj2xze66f.js";import"./jbze7lwlszm657iq.js";import"./k3j7nk2mqimsnpi6.js";import"./ifj9ijd0co13aaf7.js";import"./m36qabefvxegdn1g.js";import"./cthaea829w6zpbcu.js";import"./m2ly71nz794qjc4q.js";import"./pc2givv05uuq8g6l.js";import"./bp3e26benx61nzb4.js";import"./b6vbevykvjt8za99.js";import"./enyyaj5d41xdxtkn.js";import"./njn7nqfn68bjqa30.js";import"./lptwpbjabrvjmhsj.js";import"./eaamdtv1grunriod.js";import"./fzjh1zjd0g21dis4.js";import"./f5uxfkqdhg7743lt.js";function nt({taskId:s,onClose:u}){const o=L(),l=K(),i=N(),c=y(),{data:t,error:b}=I(s);G(s);const w=V(({getTurnsForTask:n})=>n(s)),m=B(),f=r.useMemo(()=>m?new st(Y()):new Z,[m]),_=F(f.isEmpty$),[k,d]=r.useState([]),[P,C]=r.useState(!1),{focusedAssistantTurn:e,setFocusedAssistantTurnId:S}=et({taskId:s,task:t?.task,currentDiffTaskTurn:t?.current_diff_task_turn??null,currentUserTurn:t?.current_user_turn??null,currentAssistantTurn:t?.current_assistant_turn??null}),W=t?.task?.current_turn_id,g=!!t?.task.has_unread_turn&&W===t.current_assistant_turn?.id,h=t?.current_assistant_turn?.turn_status==="completed";r.useEffect(()=>{if(!m)return;const n=t?.task?.title;if(n){const R=document.title;return document.title=n,()=>{document.title=R}}},[m,t?.task?.title]),r.useEffect(()=>{g&&h&&z.markTurnAsRead(s).then(()=>{o.invalidateQueries({queryKey:["wham","tasks"]}),o.invalidateQueries({queryKey:["wham","task",s]})})},[g,h,s,o]),ot(),H([{key:"newTask",action:()=>c("/codex",{state:{focusComposer:!0}}),actionMessageDescriptor:i.formatMessage({id:"wham.keyboardActions.newTask",defaultMessage:"New task"}),group:x.Chat,keyboardBinding:[p.Mod,p.Shift,"o"]},{key:"closeTask",action:()=>c("/codex"),actionMessageDescriptor:i.formatMessage({id:"wham.keyboardActions.closeTask",defaultMessage:"Close task"}),group:x.Chat,keyboardBinding:[p.Escape]}]);const T=k.length>0,v=r.useCallback(({force:n=!1}={})=>{if(n||!T&&_){d([]),u();return}C(!0)},[u,T,_]),D=e?J(e.turn_status):!1,M=e?.sibling_turn_ids?.includes(t?.current_assistant_turn?.id??"")||e?.id===t?.current_assistant_turn?.id,A=t?.current_diff_task_turn?.id===e?.id||e?.sibling_turn_ids?.includes(t?.current_diff_task_turn?.id??""),E=!t?.current_diff_task_turn,j=D&&M&&(A||E);return b?(l.danger({id:"wham.task-details.error",defaultMessage:"Error loading task",description:"Error message for failed to load task details"},{id:`wham-task-details-error-${s}`,hasCloseButton:!0,duration:3,toastId:"wham_task_page_content_error"}),a.jsx($,{to:"/codex"})):a.jsx(tt.Provider,{value:f,children:a.jsx(rt,{permissions:"write",taskId:s,turnId:t?.current_assistant_turn?.id??"",lastTurnWithDiffId:t?.current_diff_task_turn?.id??"",confirmClose:P,setConfirmClose:C,task:t?.task,focusedAssistantTurn:e,pastTurns:w,clearComments:()=>d([]),setComments:d,comments:k,canFollowUp:j,handleClose:v,setFocusedAssistantTurnId:S})})}function at(){const s=y(),u=Q(),{taskId:o}=U();X();const l=u.state??{},{backgroundLocation:i}=l,c=r.useCallback(()=>{s(i?-1:"/codex")},[i,s]);return o?a.jsx(O,{children:a.jsx(nt,{taskId:o,onClose:c})}):null}const Lt=()=>[{title:"Codex"}],Nt=q(function(){return a.jsx(at,{})});export{Nt as default,Lt as meta};
//# sourceMappingURL=gtqxgy7vqrh4yobx.js.map
