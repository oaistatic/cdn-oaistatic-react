import{ag as B,a5 as G,p as Q,iB as q,h8 as V,dv as z,aG as Z,eV as K,B as X,l3 as Y,dF as $,ar as L,j4 as J}from"./or7jf62i5kvok6pm.js";import{j as e,M as o,e as ee,p as ne,u as se,h as te,r as ae,b as re,a as ie,ak as oe,ah as le}from"./juy90og0wtbp77qa.js";import{W as y,i as me,M as ce,a5 as s,i2 as de,i3 as ue,eo as he,bT as pe}from"./kax7wcp9i7f7jtvz.js";import{u as fe}from"./drm1kuaj57rg9y1m.js";import{E as v}from"./jtc7ne2a6scrj9t5.js";import{W as xe}from"./lbbexno5kh833hk3.js";import"./dn063lnxb0kec6my.js";import"./g0j29k77kzjbz76f.js";import"./g1mzshmp15rgsy0r.js";import"./mj9z9iuqobsziv2h.js";import"./ocpfit0g1gfti5z4.js";import"./kwrsfo4prmlqgo0w.js";import"./6l5wykugon65myc6.js";import"./fgnsrp7wj3i83g7e.js";import"./klzyif2r6c67lyfu.js";import"./osl7p7pfd29pg5qh.js";import"./khey9wv8trxtr5w5.js";import"./gbryk52yvym6pvzs.js";import"./beq9ghaom4x8xa0j.js";import"./on0kcnmks7o53xta.js";import"./ndqdq30cq8lae3qb.js";import"./mevzpwnt01gt592f.js";import"./n74iabl73l4zjty8.js";import"./gtarz7mxj2xze66f.js";import"./jbze7lwlszm657iq.js";import"./k3j7nk2mqimsnpi6.js";function ge(){return e.jsx("div",{className:"border-token-border-heavy flex items-center border-b",children:e.jsx("div",{className:"py-2 text-xl leading-7 font-medium",children:e.jsx(o,{id:"wham.environmentsHeader.message",defaultMessage:"Environments"})})})}const ve=25,je=100;function we({isPinned:t,onToggle:c,intl:u,isCreator:l}){return e.jsx(s.Cell,{className:"content-center pe-1!",children:e.jsx($,{side:"bottom",align:"center",className:"block w-full",alignOffset:0,label:l?t?e.jsx(o,{id:"wham.environmentsList.unpin",defaultMessage:"Unpin environment for everyone in your workspace"}):e.jsx(o,{id:"wham.environmentsList.pin",defaultMessage:"Pin environment to the top for everyone in your workspace"}):e.jsx(o,{id:"wham.environmentsList.pin.notCreator",defaultMessage:"You can only pin and unpin environments you created."}),children:e.jsxs("button",{disabled:!l,onClick:c,className:L("group/cell relative flex h-10 w-full items-center px-4 group-hover/row:opacity-100",!t&&"opacity-0",t&&!l&&"opacity-50"),"aria-label":t?u.formatMessage({id:"wham.environmentsList.unpinEnvironment",defaultMessage:"Unpin environment"}):u.formatMessage({id:"wham.environmentsList.pinEnvironment",defaultMessage:"Pin environment"}),children:[t&&e.jsx(ue,{className:"icon absolute opacity-0 group-hover/cell:opacity-100"}),e.jsx(he,{className:L("icon absolute",t&&"opacity-100 group-hover/cell:opacity-0")})]})})})}function Ce(){const t=ee(),[c,u]=ne(),l=se(),r=te(),S=B(),p=G(),j=!!p?.isWorkspaceAccount(),w=fe(),[f,P]=ae.useState(c.get("search")??""),{data:k,isLoading:_,error:T,fetchNextPage:H,hasNextPage:C,isFetchingNextPage:I}=re({queryKey:["wham","environments","with-creators"],initialPageParam:null,queryFn:({pageParam:n})=>y.getEnvironmentWithCreators(n?je:ve,n),getNextPageParam:n=>n.cursor??null}),{mutate:D}=ie({mutationFn:({environmentId:n,isPinned:a})=>(l.setQueryData(["wham","environments","with-creators"],i=>i&&Q(i,m=>{for(const g of m.pages)for(const d of g.items)if(d.id===n){d.is_pinned=!d.is_pinned;break}})),l.setQueryData(["wham","environments"],i=>i&&i.map(m=>m.id===n?{...m,is_pinned:a}:m)),y.updateEnvironment(n,{is_pinned:a})),onSettled:()=>{me(l)},onError:()=>{S.danger(r.formatMessage({id:"wham.environmentsList.failedToPinEnvironment",defaultMessage:"Failed to pin environment"}))}}),{isConnected:F,isLoading:A}=q(z.GITHUB_CONNECTOR,"github","/codex/settings/environments",V.CODEX);if(_)return e.jsx("div",{className:"flex h-full items-center justify-center pt-5",children:e.jsx(Z,{})});const M=k?.pages.flatMap(n=>n.items)??[],x=f.trim().toLowerCase(),W=M.filter(n=>n.label.toLowerCase().includes(x)),N=n=>{const a=n.toLowerCase();return a===x?0:a.startsWith(x)?1:2},b=W.slice().sort((n,a)=>{if(n.is_pinned!==a.is_pinned)return n.is_pinned?-1:1;const i=N(n.label)-N(a.label);return i!==0?i:n.label.localeCompare(a.label)});return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex flex-row justify-between pb-4",children:[e.jsx("div",{className:"flex flex-row gap-2",children:e.jsx(K,{name:"search-environments",color:"search",containerInputClassName:"w-full",className:"text-token-text-primary flex h-8 w-full items-center rounded-md!",value:f,onChange:n=>{const a=n.target.value;P(a),a?u({search:a},{replace:!0}):u({},{replace:!0})},placeholder:r.formatMessage({id:"wham.environmentsList.searchEnvironmentsPlaceholder",defaultMessage:"Search environments"}),ariaLabel:r.formatMessage({id:"wham.environmentsList.searchEnvironmentsAria",defaultMessage:"Search environments"})})}),e.jsx(X,{onClick:()=>t("/codex/settings/environment/create"),disabled:A||!F,color:"primary",icon:ce,className:"h-8","aria-label":r.formatMessage({id:"wham.environmentsList.createEnvironmentAriaLabel",defaultMessage:"Link to create a new environment"}),children:e.jsx("span",{className:"hidden md:inline",children:e.jsx(o,{id:"wham.environmentsList.createEnvironment",defaultMessage:"Create environment"})})})]}),T?e.jsx(v,{title:r.formatMessage({id:"wham.environmentsList.error",defaultMessage:"Failed to load environments"}),description:r.formatMessage({id:"wham.environmentsList.errorDescription",defaultMessage:"Please try refreshing the page, if that does not work, please contact support."})}):M.length===0?e.jsx(v,{title:r.formatMessage({id:"wham.environmentsList.noEnvironments",defaultMessage:"No environments"}),description:r.formatMessage({id:"wham.environmentsList.noEnvironmentsDescription",defaultMessage:"Create an environment for Codex to work in"})}):e.jsxs(e.Fragment,{children:[e.jsxs(s.Root,{className:"overflow-x-auto overflow-y-clip",disableScroll:!0,children:[e.jsxs(s.Header,{children:[e.jsx(s.HeaderCell,{className:"ps-2 text-sm",children:e.jsx(o,{id:"wham.environmentsList.name",defaultMessage:"Name"})}),e.jsx(s.HeaderCell,{className:"text-sm",children:e.jsx(o,{id:"wham.environmentsList.repo",defaultMessage:"Repo"})}),e.jsx(s.HeaderCell,{className:"text-sm",children:e.jsx(o,{id:"wham.environmentsList.numberOfTasks",defaultMessage:"Number of tasks"})}),w&&e.jsx(s.HeaderCell,{className:"text-sm",children:e.jsx(o,{id:"wham.environmentsList.sharing",defaultMessage:"Sharing"})}),e.jsx(s.HeaderCell,{className:"text-sm",children:e.jsx(o,{id:"wham.environmentsList.creator",defaultMessage:"Creator"})}),e.jsx(s.HeaderCell,{className:"text-sm",children:e.jsx(o,{id:"wham.environmentsList.createdAt",defaultMessage:"Created at"})}),j&&e.jsx(s.HeaderCell,{}),e.jsx(s.HeaderCell,{})]}),e.jsx(s.Body,{children:b.length===0&&!C?e.jsx(s.Row,{children:e.jsx(s.Cell,{colSpan:100,children:e.jsx(v,{title:r.formatMessage({id:"wham.environmentsList.search.noEnvironments",defaultMessage:"No matches for {search}"},{search:f}),description:r.formatMessage({id:"wham.environmentsList.search.noEnvironmentsDescription",defaultMessage:"Create an environment for Codex to work in"})})})}):b.map(({id:n,label:a,is_pinned:i,repos:m,repo_map:g,creator:d,created_at:E,task_count:R,share_settings:U})=>{const O=!!p?.authUserId&&d.id.includes(p?.authUserId);return e.jsxs(s.Row,{role:"row",className:"group/row hover:bg-token-bg-tertiary h-14 px-2 text-sm hover:cursor-pointer",onClick:()=>t(`/codex/settings/environment/${n}`),tabIndex:0,"aria-label":r.formatMessage({id:"wham.environmentsList.environmentAriaLabel",defaultMessage:"View environment {label}"},{label:a}),children:[e.jsx(s.Cell,{divClassName:"flex h-14 items-center group-hover/row:underline ps-2",children:a}),e.jsx(s.Cell,{divClassName:"flex h-14 items-center",children:m.map(h=>e.jsx("div",{children:g?.[h]?.repository_full_name??h},h))}),e.jsx(s.Cell,{divClassName:"flex h-14 items-center",children:R}),w&&e.jsx(s.Cell,{divClassName:"flex h-14 items-center",children:Me(r,U)}),e.jsx(s.Cell,{divClassName:"flex h-14 items-center",children:d.email}),e.jsx(s.Cell,{divClassName:"flex h-14 items-center",children:E?e.jsx(oe,{value:new Date(E*1e3),year:"numeric",month:"long",day:"numeric"}):e.jsx(o,{id:"wham.environmentsList.na",defaultMessage:"N/A"})}),j&&e.jsx(we,{isPinned:i,isCreator:O,onToggle:h=>{h.stopPropagation(),D({environmentId:n,isPinned:!!i})},intl:r})]},n)})})]}),e.jsx(de,{isFetchingNextPage:I,hasNextPage:C??!1,fetchNextPage:H})]})]})})}function Me(t,c){switch(c){case"public":return t.formatMessage({id:"wham.environmentsList.public",defaultMessage:"Public"});case"private":return t.formatMessage({id:"wham.environmentsList.private",defaultMessage:"Private"});case"workspace":return t.formatMessage({id:"wham.environmentsList.workspace",defaultMessage:"Workspace"});default:Y.assertNever(c)}}function Ne(){const{eligible:t}=pe();return t?e.jsx(le,{to:"/codex/onboarding"}):e.jsx(xe,{topPadding:!0,children:e.jsxs("div",{className:"mx-auto flex h-full max-w-screen-xl flex-1 flex-col gap-4 ps-4 pe-4 md:pe-12",children:[e.jsx(ge,{}),e.jsx(Ce,{})]})})}const Xe=()=>[{title:"Codex"}],Ye=J(function(){return e.jsx(Ne,{})});export{Ye as default,Xe as meta};
//# sourceMappingURL=ow1ula32s0or238o.js.map
