import{a as w,ag as y,gi as k,B as P,j4 as v}from"./or7jf62i5kvok6pm.js";import{h as C,e as _,u as b,P as M,r as c,d as N,j as e,M as i}from"./juy90og0wtbp77qa.js";import{S as p}from"./nvghkpv0zy449sx8.js";import{bW as q,bX as I,W as R,bY as S,bZ as T}from"./kax7wcp9i7f7jtvz.js";import{b as E}from"./nyp3d57wjtx31u6o.js";import{M as W}from"./fillcepyhp0h11t1.js";import{a as B}from"./lbbexno5kh833hk3.js";import"./on0kcnmks7o53xta.js";import"./g1mzshmp15rgsy0r.js";import"./mj9z9iuqobsziv2h.js";import"./g0j29k77kzjbz76f.js";import"./ocpfit0g1gfti5z4.js";import"./kwrsfo4prmlqgo0w.js";import"./6l5wykugon65myc6.js";import"./fgnsrp7wj3i83g7e.js";import"./klzyif2r6c67lyfu.js";import"./osl7p7pfd29pg5qh.js";import"./khey9wv8trxtr5w5.js";import"./ndqdq30cq8lae3qb.js";import"./beq9ghaom4x8xa0j.js";import"./mevzpwnt01gt592f.js";import"./dn063lnxb0kec6my.js";import"./gbryk52yvym6pvzs.js";import"./n74iabl73l4zjty8.js";import"./gtarz7mxj2xze66f.js";import"./jbze7lwlszm657iq.js";import"./k3j7nk2mqimsnpi6.js";function F(){const a=C(),o=_(),n=b(),{taskId:s,turnId:r}=M(),[f,m]=c.useState(!1),x=c.useMemo(()=>q(s,r,n,{refetchInterval:t=>{const d=t.state?.data?.turn?.pull_request_status;switch(d){case null:case void 0:case"not_created":case"creating":return 2e3;case"failed":case"created":case"updated":return!1;default:w(d)}}}),[s,r,n]),{data:u}=N(x),g=y(),h=async()=>{if(!(!s||!r))try{m(!0),await R.createPr(s,r,Q()),await n.invalidateQueries({queryKey:["wham","task"]})}catch(t){t instanceof S&&T(t,r,a,g)}finally{m(!1)}},l=u?.turn?.pull_request_data?.url;c.useEffect(()=>{l&&(window.location.href=l)},[l]);const j=u?.turn?.pull_request_status==="failed";return e.jsx(W,{children:e.jsx(E,{mobileHeaderRightContent:null,children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx(B,{className:"absolute start-0 end-0 top-0",children:e.jsx("div",{className:"flex w-full justify-end",children:e.jsx(I,{onClick:()=>{window.opener?(window.opener.focus(),window.close()):o(`/codex/tasks/${s}`)},icon:e.jsx(p,{}),label:a.formatMessage({id:"wham.task.pr.header.title",defaultMessage:"Back to task"})})})}),e.jsx("div",{className:"flex grow items-center justify-center p-4",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(k,{className:"mb-4 h-15 w-15"}),j?e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"text-token-text-error flex items-center gap-1",children:e.jsx(i,{id:"wham.task.pr.inProgress.error.description",defaultMessage:"Failed to create pull request. Please try again."})}),e.jsx(P,{color:"secondary",size:"small",icon:p,loading:f,onClick:t=>{t.preventDefault(),t.stopPropagation(),h()},children:e.jsx(i,{id:"wham.task.pr.inProgress.error.button",defaultMessage:"Retry"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"loading-shimmer-pure-text text-lg font-semibold",children:e.jsx(i,{id:"wham.task.pr.inProgress.title",defaultMessage:"Creating pull requestâ€¦"})}),e.jsx("p",{className:"text-token-text-secondary text-sm",children:e.jsx(i,{id:"wham.task.pr.inProgress.description",defaultMessage:"Pull request will automatically open once it has been created."})})]})]})})]})})})}function Q(){const o=new URLSearchParams(location.search).get("mode");if(o==="draft")return"draft";if(o==="auto_merge")return"auto_merge"}const de=()=>[{title:"Codex"}],pe=v(function(){return e.jsx(F,{})});export{pe as default,de as meta};
//# sourceMappingURL=g5yvh8xlo0vuei6u.js.map
