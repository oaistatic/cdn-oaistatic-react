import{r as g,j as p,h as T}from"./juy90og0wtbp77qa.js";import{dL as M,s as l,N as d,e as C,f as x,bC as k}from"./or7jf62i5kvok6pm.js";import{CoTChunks as _}from"./fgr4oob1xomy14p8.js";import{hO as h}from"./kax7wcp9i7f7jtvz.js";import"./mh6p4y5np464yd8j.js";import"./gbryk52yvym6pvzs.js";import"./gu6gv8q29qfpkqrc.js";import"./l0ojckr7ctyz3k3l.js";import"./mj9z9iuqobsziv2h.js";import"./cthaea829w6zpbcu.js";import"./m2ly71nz794qjc4q.js";import"./g1mzshmp15rgsy0r.js";import"./klzyif2r6c67lyfu.js";import"./pc2givv05uuq8g6l.js";import"./hdclltxvbgzx8xl8.js";import"./bp3e26benx61nzb4.js";import"./b6vbevykvjt8za99.js";import"./osl7p7pfd29pg5qh.js";import"./cfoynes168s239fl.js";import"./krjedegvrg2pxhs7.js";import"./pbl95wx6493wq92j.js";import"./nvghkpv0zy449sx8.js";const y=(e,t)=>{if(t<=1)return e.formatMessage({id:"ZxhUq1",defaultMessage:"a second"});if(t<3)return e.formatMessage({id:"4GD7tD",defaultMessage:"a couple of seconds"});if(t<4)return e.formatMessage({id:"jx5V1u",defaultMessage:"a few seconds"});if(t>=60){const n=Math.floor(t/60),o=t%60;return`${n}m ${o}s`}return e.formatMessage({id:"p4/pTg",defaultMessage:"{seconds} seconds"},{seconds:t})},E=e=>{let t=0;for(const n of e)t+=n.metadata?.finished_duration_sec??0;return t},R=(e,t,n)=>t.length>1?e.formatMessage({id:"sdDgmZ",defaultMessage:"Thought for {timing}"},{timing:y(e,n)}):M(t)?.metadata?.finished_text??"",I=(e,t,n=!1)=>{const o=[];let s={type:h.Thought,thought:{summary:"",content:""}};const a=()=>{s.thought.content.trim()&&(o.push(s),s={type:h.Thought,thought:{summary:s.thought.summary,content:""}})},u=e.split(/( {2}\n)|(\n\n)/).filter(c=>c!=null&&c.trim());if(!n&&u.length<2)return o;let i=!1;for(let c=0;c<u.length;c++){const r=u[c].trim();if(r.toLowerCase()==="none"){l.count(d.COT_SUMMARIZER,"num_none_chunks");continue}const f=r.match(/^\*\*(.*)\*\*$/);if(f)a(),s.thought.summary=f[1]??"";else if(r){if(r.startsWith("```")){if(i){s.thought.content+=s.thought.content?`
${r}`:r,a(),i=!1;continue}a(),i=!0}s.thought.content.trim()&&!r.startsWith("\\[")&&!r.startsWith("\\(")&&!i&&a(),s.thought.content+=s.thought.content?`
${r}`:r}}return s?.thought.content.trim()&&o.push(s),n&&t&&o.push({type:h.Recap,content:t}),o},N=(e,t,n)=>{const o=!n,s=g.useMemo(()=>I(e,t,o),[e,t,o]);return g.useEffect(()=>{o&&l.hist(d.COT_SUMMARIZER,"num_cot_chunks",void 0,s.length)},[o]),s},O=({isStreaming:e,finishedText:t,summaryText:n,isFinalAssistantTurn:o})=>{const s=N(n,t,e);return p.jsx(_,{isStreaming:e,isFinalAssistantTurn:o,chunks:s})},S=8,j=`

`,Y=({messages:e,isStreaming:t,isFinalAssistantTurn:n})=>{const o=T(),s=C(),a=x(s,"1214379119"),u=E(e);let i="";return e.forEach(c=>{const m=k(c);i+=i?j+m:m}),a&&!t&&!i&&u<S?null:p.jsx(O,{finishedText:R(o,e,u),summaryText:i,isStreaming:t,isFinalAssistantTurn:n})};export{O as LegacyCoT,Y as LegacyCoTMessage};
//# sourceMappingURL=k8fa7t11vj7nuoga.js.map
