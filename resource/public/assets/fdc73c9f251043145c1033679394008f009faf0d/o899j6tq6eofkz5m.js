const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/czbgeg3y842o3thx.js","assets/juy90og0wtbp77qa.js","assets/or7jf62i5kvok6pm.js","assets/root-ms9lll5g.css","assets/kax7wcp9i7f7jtvz.js","assets/conversation-small-j9iamy23.css","assets/hdj4jg3qlpv2q2g0.js","assets/joa8jajuiu4xqpzn.js"])))=>i.map(i=>d[i]);
import{ar as P,dW as z,bv as V,ak as q,as as Y,im as K,aQ as Q,at as Z}from"./or7jf62i5kvok6pm.js";import{j as t,m as S,r as n}from"./juy90og0wtbp77qa.js";import{P as $,u as B}from"./mj9z9iuqobsziv2h.js";import{c as J,d as U}from"./g1mzshmp15rgsy0r.js";import{hP as X,bF as ee,fY as te,a0 as ne,hQ as se,bE as D,hR as ae,hS as oe,hJ as N,ez as re,a4 as ie,a2 as ce,a1 as le}from"./kax7wcp9i7f7jtvz.js";import{P as me}from"./g0j29k77kzjbz76f.js";import{u as ue}from"./fzazeczfeeq2yus7.js";import"./ocpfit0g1gfti5z4.js";import"./kwrsfo4prmlqgo0w.js";import"./6l5wykugon65myc6.js";import"./fgnsrp7wj3i83g7e.js";import"./klzyif2r6c67lyfu.js";import"./osl7p7pfd29pg5qh.js";import"./khey9wv8trxtr5w5.js";const de=0,he=48;function fe({imageAsset:e,children:a,containerDimensions:s,isLoadingNewImage:r}){return t.jsxs(S.div,{className:"absolute",style:pe(e,s),...X,children:[a,t.jsx("div",{className:P("bg-token-main-surface-primary absolute inset-0 flex items-center justify-center transition-opacity duration-1000",r?"pointer-events-auto opacity-60":"pointer-events-none opacity-0")})]})}function pe(e,a){const{width:s,height:r}=e,{width:m,height:u}=a,d=m-2*de,h=u-2*he,l=s/r,i=d/h,c=l>i,g=c?d:h*l,x=c?d/l:h;return{top:"50%",left:"50%",width:g,height:x,transform:"translate(-50%, -50%)"}}const ge=({onEscape:e})=>{n.useEffect(()=>{function a(s){s.key==="Escape"&&e()}return document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)}},[e])},xe=Y(()=>Z(()=>import("./czbgeg3y842o3thx.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(e=>e.DynamicDrawingCanvas)),b=126,we=63,Ie=136,ve=50;function Ce({width:e,height:a,delay:s=ve}){const[r,m]=n.useState(!1);return n.useEffect(()=>{const u=setTimeout(()=>{m(!0)},s);return()=>{clearTimeout(u)}},[s]),r?t.jsx("div",{className:"flex max-h-full max-w-full items-center justify-center",style:{width:e,height:a,aspectRatio:`${e} / ${a}`},children:t.jsx("div",{className:"bg-token-border-default h-full w-full animate-pulse"})}):null}function ke({image:e,isLoadingNewImage:a,clientThreadId:s,onClose:r,messageId:m,onRequestCompletion:u,editorControls:d,footer:h}){const l=z(s),[i,c]=n.useState("default"),[g,x]=n.useState({width:window.innerWidth,height:window.innerHeight-b}),M=V(),[_,L]=n.useState(!1),I=ue(),{currentDrawnShape:w,onNewDrawnShape:T,clearAllDrawings:k}=I,v=n.useRef(null),G=n.useMemo(()=>new $(J()),[]),C=n.useRef(void 0),f=n.useMemo(()=>ee({pointer:e,conversationId:l,messageId:m,source:"editor"}),[e,m,l]),W=te(o=>{const{width:p,height:R}=o.contentRect;x({width:p,height:M?R-b:R-we})});ge(n.useMemo(()=>({onEscape:()=>{i==="inpaint"?c("default"):r()}}),[i,r])),ne(n.useMemo(()=>({image:e,currentDrawnShape:w,onCleared:()=>c("default"),getImageData:()=>v.current?.getImageData()}),[e,w])),n.useEffect(()=>{i!=="inpaint"&&k()},[i]),n.useEffect(()=>{c("default")},[e]);const E=B(s),A=n.useCallback(o=>{c("default"),E(o),r()},[E,r]),j=n.useMemo(()=>u||A,[u,A]),[O]=q(s,o=>[o?.modelId]),y=se({imageAssetPointer:e,serverThreadId:l}),H=n.useCallback(()=>{c("inpaint"),D.inpaintClick({analyticsContext:f})},[f]),F=n.useCallback(o=>{const p=o.deltaY<0?"in":"out";o.ctrlKey&&C.current!==p&&(D.zoom({zoomType:p,analyticsContext:f}),C.current=p)},[f]);return t.jsx(ae.Provider,{value:f,children:t.jsxs("div",{ref:W,className:"flex h-full w-full flex-col items-center justify-between",onWheel:F,children:[d??t.jsx(oe,{clientThreadId:s,imageAsset:e,mode:i,setMode:c,inpaintingDrawingState:I,isLoadingNewImage:a,onClose:r,onInpaintClick:H,messageId:m,serverThreadId:l}),t.jsx("div",{className:"relative flex w-full grow items-center justify-center",children:t.jsxs(fe,{imageAsset:e,containerDimensions:g,isLoadingNewImage:a,children:[y&&i!=="inpaint"&&t.jsx("img",{alt:N(e),className:"absolute inset-0 z-1 opacity-0",src:y}),!_&&t.jsx(Ce,{width:e.width,height:e.height}),t.jsx(re,{className:"h-full w-full",alt:N(e),onLoad:()=>{L(!0)},src:e.url,width:e.width,height:e.height,fadeIn:!1}),t.jsx("div",{className:P("absolute inset-0",i==="inpaint"?"":"hidden"),children:t.jsx(xe,{drawingCanvasRef:v,color:"rgba(0, 122, 255, 0.5)",dashedOutlineColor:"rgba(255, 255, 255, 0.65)",cursorWidth:Ie,canvasWidth:e.width,canvasHeight:e.height,currentDrawnShape:w,onNewDrawnShape:T})})]})}),t.jsx("div",{className:"flex min-h-[132px] w-full flex-col items-center justify-end max-sm:min-h-[84px]",children:t.jsx(S.div,{className:"mb-6 flex w-[90%] items-center justify-center lg:w-[53%]",layout:!0,transition:{duration:.2,ease:"easeInOut"},children:h??t.jsx(ie,{value:{isImageGenEditor:!0,isInpainting:i==="inpaint",onCancelInpaint:()=>c("default")},children:t.jsx(U.Provider,{value:G,children:t.jsx(me,{clientThreadId:s,isNewThread:Q(s),currentModelId:O??K(void 0).id,onContinueGenerating:o=>j(le(o)),onRequestCompletion:async o=>j(await ce(o)),hideHeader:!0})})})})})]})})}export{ke as ImageGenNewEditor,Ce as ShimmerLoader};
//# sourceMappingURL=o899j6tq6eofkz5m.js.map
