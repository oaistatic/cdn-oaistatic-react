import{r as l,ao as $,p as Z,h as tt,j as n,A as et,m as v}from"./juy90og0wtbp77qa.js";import{jJ as st,lA as at,lB as H,dx as ot,C as g,lC as nt,lD as it,jF as rt,fc as ct,lE as dt,u as U,lF as lt,lG as ut,k7 as mt,lH as pt,lI as ht,lJ as ft,lK as j,lL as V,k5 as gt,lM as xt,lN as vt,dr as M,lO as D,U as W,lP as k,lQ as Ct,lR as Tt,cV as bt,lS as wt}from"./kax7wcp9i7f7jtvz.js";import{iO as _,L,ak as G,b2 as w,b5 as It,ko as St,gS as yt,iq as P,hF as Et,lA as At,ky as _t}from"./or7jf62i5kvok6pm.js";import{L as Nt}from"./mdssvkl8pmfzfzqu.js";import{T as Rt}from"./m1bl3buhy9pj3b6o.js";import{g as Ft}from"./btagl6w1gub4aw61.js";import"./jy1u8exw8iz2slve.js";import"./fzjh1zjd0g21dis4.js";import"./m25k63thq2ae6gnq.js";import"./f5uxfkqdhg7743lt.js";import"./fycipmzaujh6mznx.js";import"./j04dc36aebpkc785.js";import"./jxnsuo98r1og4iiw.js";import"./o2ytnx73j53uwl1g.js";import"./f76gy0b8ieo4s693.js";import"./gy64pge8qevmvg7e.js";import"./mia7txooqhkpbw7w.js";import"./mj9z9iuqobsziv2h.js";import"./gsxaafvs8bixhf19.js";import"./okgy2jcnkx7iko44.js";import"./krjedegvrg2pxhs7.js";import"./e4rec4ry83perprj.js";import"./lrxmyjytlt96vz0w.js";import"./ejiu40t686c7js51.js";import"./tris1w87g35jhk1n.js";import"./kcsd6vktfrkucv9s.js";import"./nc631yunytu8n0fx.js";import"./l0ojckr7ctyz3k3l.js";import"./cthaea829w6zpbcu.js";import"./m2ly71nz794qjc4q.js";import"./g1mzshmp15rgsy0r.js";import"./klzyif2r6c67lyfu.js";import"./pc2givv05uuq8g6l.js";import"./hdclltxvbgzx8xl8.js";import"./bp3e26benx61nzb4.js";import"./b6vbevykvjt8za99.js";import"./osl7p7pfd29pg5qh.js";import"./m4hnvgp7gphpktn6.js";import"./mq5kqcvga15eqze5.js";import"./bk8slwxjkdlmxjxm.js";import"./ifj9ijd0co13aaf7.js";import"./m36qabefvxegdn1g.js";import"./beq9ghaom4x8xa0j.js";import"./on0kcnmks7o53xta.js";import"./g0j29k77kzjbz76f.js";import"./ocpfit0g1gfti5z4.js";import"./kwrsfo4prmlqgo0w.js";import"./6l5wykugon65myc6.js";import"./fgnsrp7wj3i83g7e.js";import"./khey9wv8trxtr5w5.js";import"./ndqdq30cq8lae3qb.js";import"./mevzpwnt01gt592f.js";import"./eyf4rqe5yc1g1un1.js";const z="oai/apps/canmoreSidebarWidth",Mt=.25,Ot=400,B=400;function q(t){return t-Ot}function E(t,s){return $(B,q(t),s??Mt*t)}function jt(){const t=_.useState(_.selectWindowWidth),s=E(t,st(L.DANGER_SECRET_FOLDERS_ONLY_getItem(z))),a=K(),[e,i]=l.useState(s);l.useEffect(()=>{(e<B||e>q(t))&&i(E(t,e))},[t]);function r(u){i(p=>E(t,p+=u.delta.x))}function o(u){i(u),L.DANGER_SECRET_FOLDERS_ONLY_setItem(z,u)}function c(){const u=E(t,void 0);o(u)}const d=`calc(100vw - ${e}px)`;return a?{chatWidth:e,canvasWidth:t-e,canvasWidthCalc:d,viewportWidth:t,handleDrag:r,handleDoubleClick:c,persist:o}:{chatWidth:0,canvasWidth:t,canvasWidthCalc:"100vw",viewportWidth:t,handleDrag:()=>{},handleDoubleClick:()=>{},persist:()=>{}}}function K(t){const s=_.useState(_.selectWindowWidth);return(t??s)>1e3}const F="sharedCanvas";function Dt(){const[t,s]=Z(),a=t.get(F),e=tt();l.useEffect(()=>{const i=a&&at.createRemixTempTextdoc(a,e);if(!i)return;requestAnimationFrame(()=>{H(i)});const r=new URLSearchParams(t);r.delete(F),s(r);const o=new URL(window.location.href);o.searchParams.delete(F),history.replaceState(null,"",o)},[a,t,s,e])}const Wt="textdocId",kt=t=>{const a=new URLSearchParams(window.location.search).get(Wt),e=G(t,i=>w.findNode(i,({message:r})=>{const o=r.metadata?.canvas;return o?.create_source===ot.HIVE&&(a?o?.textdoc_id===a:!0)})?.message.metadata?.canvas?.textdoc_id);l.useEffect(()=>{e&&requestAnimationFrame(()=>{H(e)})},[e])};function Lt(t,s){let a;return s?.type===g.Textdoc?s.textdocId.startsWith(nt)||(a={type:"canvas_textdoc",id:s.textdocId}):s?.type===g.Kanzi&&(a={type:"canvas_kanzi",id:s.kanziTurnId}),it(t,{promptMessage:{metadata:{open_in_canvas_view:a}}})}const Y=({isFullScreen:t=!1,clientThreadId:s,focusedObject:a,onClose:e,isAnimating:i=!1,width:r})=>{const{setTargetedContent:o}=rt(),c=l.useRef(!1);if(l.useEffect(()=>(c.current&&o(void 0),c.current=!0,()=>{c.current=!1}),[a]),a==null)return null;switch(a.type){case g.Textdoc:return n.jsx(Rt,{isFullScreen:t,onClose:e,clientThreadId:s,focusedTextdoc:a,isAnimating:i,width:r});case g.Kanzi:break;case g.ADAVisualization:return null}},Pt=300,zt=t=>{switch(t?.type){case g.Textdoc:return t.textdocId;case g.Kanzi:return null;default:return null}};function Ht(t,s){const[a,e,i,r]=G(t,m=>[w.getRequestId(m),w.getConversationLastTurn(m),w.isMessageTurnEnded(m),w.getVariantIds(m).length>1]),o=ct(a),c=dt(),d=U(),[u,p]=l.useMemo(()=>{if(e&&r)return[void 0,null];if(s===!0)return[void 0,null];let m;return!i&&e&&(m=It(e.messageGroups,C=>C.type!==St)),Ut({groupedMessage:m,currentlyFocusedObject:d,isRequestActive:o,latestTextdocId:c})},[i,e,r,d,s,o,c]),I=p!=null,T=zt(p),N=lt("canvas");l.useEffect(()=>{if(p&&u&&!yt()&&(N(),ut(p,u),p.type===g.Textdoc)){const{textdocId:m}=p,C=Ft(m);mt(document.getElementById(C))}},[I,T])}function Ut({groupedMessage:t,currentlyFocusedObject:s,isRequestActive:a,latestTextdocId:e}){switch(t?.type){case P.Canmore:{const[i,r]=t.messages;if(!pt(i))break;const o=ht(a,i,r??null),c=o.textdocId??e;if(c&&(o.function===ft.CreateTextdoc?(o.content??"").length>Pt||o.status===j.WAITING:o.status===j.STREAMING))return[o.messageId,{type:g.Textdoc,textdocId:c}];break}case P.kanzi:break}return[void 0,null]}const A={type:"spring",bounce:.12,duration:.64},Vt={type:"spring",bounce:0,duration:.58},f={duration:0},Gt=({clientThreadId:t,focusedObject:s,onClose:a})=>{const{chatWidth:e,canvasWidthCalc:i,handleDrag:r,handleDoubleClick:o,persist:c}=jt(),d=M(),[u,p]=l.useState(!d),[I,T]=l.useState(!1),N=d?f:A,m=d?f:Vt,C=Ct(({rect:h})=>h),{windowHeight:b,windowWidth:S}=_t(h=>h,{windowWidth:0,windowHeight:0});let x=C??{top:0,left:e,width:S-e,height:b},O=!1;if(C&&(x.top<0||x.top+x.height>b)){O=!0;const h={width:(S-e)*.75,height:b*.75};x={top:b/2-h.height/2,left:(S-e-h.width)/2+e,width:h.width,height:h.height}}const y=C?.borderRadius,R=Tt(),X=R?.history!=null||R?.showChangesAtVersion!=null,J=bt();return n.jsxs(n.Fragment,{children:[X&&n.jsx(Nt,{onClick:()=>wt(R.textdocId),zIndexKey:"chatOverlay"}),n.jsxs(v.div,{initial:{marginInlineEnd:J?-260:0},animate:{marginInlineEnd:0},transition:m,children:[n.jsx(v.div,{initial:{opacity:1},animate:{opacity:0},exit:{opacity:[1,0]},transition:d?f:{...A,delay:.22},className:"bg-token-main-surface-primary pointer-events-none absolute start-0 top-0 z-20 h-full w-full"}),n.jsx(v.div,{className:"relative z-20 h-full",style:{width:i},exit:{width:0},transition:d?f:{type:"spring",bounce:0,duration:.1}})]}),n.jsx(v.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:d?f:void 0,className:"pointer-events-none absolute start-0 top-0 z-10 h-full w-full bg-black/[0.025] dark:bg-transparent"}),n.jsx(v.div,{className:"bg-token-bg-primary absolute start-0 z-20 h-full overflow-hidden transition-shadow",initial:{borderRadius:y,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)",opacity:O?0:1,x:x.left,y:x.top,height:x.height,width:x.width},animate:{opacity:1,x:e,y:0,width:i,height:b,borderRadius:0,boxShadow:"0px 0px 18px rgba(0,0,0,0.075)"},exit:{scale:.64,opacity:0,filter:"blur(12px)",transition:d?f:{opacity:{duration:.14,bounce:.1}},borderRadius:y,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)"},transition:I||d?f:A,onAnimationComplete:()=>p(!1),children:n.jsx(v.div,{className:"dark:border-token-border-medium h-full overflow-hidden border-s border-gray-100",initial:{borderRadius:y},animate:{borderRadius:0},exit:{borderRadius:y},transition:N,children:n.jsxs("div",{className:"h-full",children:[n.jsx(v.div,{drag:"x",className:"bg-token-text-quaternary absolute start-[-2px] z-10 h-full w-[4px] cursor-ew-resize opacity-0",whileHover:{opacity:.5},whileDrag:{opacity:.75,width:"8px",left:"-4px"},transition:d?f:{type:"tween",duration:.1},style:{x:0,y:0,transform:"translateX(0px)"},dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:{left:0,right:0,top:0,bottom:0},onPointerDown:()=>T(!0),onPointerUp:()=>T(!1),onDrag:(h,Q)=>r(Q),onDragEnd:()=>{T(!1),c(e)},onDoubleClick:()=>o()}),I&&n.jsx("div",{className:"absolute inset-0 z-10"}),n.jsx(Y,{onClose:a,clientThreadId:t,isAnimating:!d&&u,focusedObject:s,width:S-e})]})})})]})},Bt=l.memo(Gt),qt=({clientThreadId:t,focusedObject:s,onClose:a})=>{const e=M();return n.jsx(At,{open:!0,className:"fixed inset-0 z-50 h-full w-full",children:n.jsx(v.div,{className:"z-40 h-full w-full overflow-hidden shadow-xl md:border-gray-100 md:dark:border-gray-700",initial:{scale:.98},animate:{scale:1},transition:e?f:A,children:n.jsx(Y,{isFullScreen:!0,clientThreadId:t,focusedObject:s,onClose:a})})})},Kt=({clientThreadId:t,overrideWidth:s,isAutoFocusDisabled:a=!1})=>{const e=U(),i=K(s)&&!xt(vt,e?.type),r=M();Ht(t,a||r),Dt(),kt(t),l.useEffect(()=>{V()},[t]);const o=e&&(i?n.jsx(Bt,{clientThreadId:t,onClose:k,focusedObject:e},"canvas-sidebar"):n.jsx(qt,{clientThreadId:t,onClose:k,focusedObject:e},"canvas-modal"));l.useEffect(()=>{if(e)return D(d=>Lt(d,e)),()=>D(null)},[e]);const c=o!=null;return l.useEffect(()=>(W.setActiveStageSidebar(c),()=>{c&&W.setActiveStageSidebar(!1)}),[c]),r?n.jsx("div",{children:o},t):n.jsx(et,{children:o},t)},Ke=t=>{const s=l.useRef(null);return n.jsx(Et,{ref:s,onError:(a,e)=>{V(),setTimeout(()=>{s.current?.resetErrorBoundary()}),gt.logError("Error boundary hit",a,{componentStack:e})},name:"canmore-focused-view",children:n.jsx(Kt,{...t})})};export{Ke as CanvasFocusedViewManager};
//# sourceMappingURL=iya1g4codu8nt7l6.js.map
