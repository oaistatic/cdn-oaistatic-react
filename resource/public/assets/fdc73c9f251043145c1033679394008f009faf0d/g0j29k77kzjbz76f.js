const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/mrl6054ij46mdqia.js","assets/juy90og0wtbp77qa.js","assets/kax7wcp9i7f7jtvz.js","assets/or7jf62i5kvok6pm.js","assets/root-ms9lll5g.css","assets/conversation-small-j9iamy23.css","assets/abmsi963f0mr8jzr.js","assets/n5lc3jkxxguzay6r.js","assets/nbdb3tjxtvfmkqtk.js","assets/klzyif2r6c67lyfu.js","assets/g1mzshmp15rgsy0r.js","assets/mj9z9iuqobsziv2h.js"])))=>i.map(i=>d[i]);
import{e as mt,r as p,h as oe,j as e,M as N,A as qt,m as fe,f as Le,d as Ir,q as Br,L as Nr,c as Lr,p as Fr,P as Dr}from"./juy90og0wtbp77qa.js";import{e as te,bd as pt,dz as Ur,i as Qe,e1 as Ze,f as ye,bf as wo,c7 as jo,S as F,P as M,C as Or,aq as Hr,B as lt,al as Ht,ak as J,a5 as et,bg as $e,m_ as zr,m$ as Gr,n0 as Wr,eD as Vr,n1 as io,eA as qr,dF as Os,bv as Hs,n2 as X,fP as Ne,b2 as W,bK as To,fp as Yr,hy as Eo,aF as ae,n3 as Yt,b6 as zs,ag as $t,eF as Gs,f8 as Ws,eH as ct,ap as $r,aC as Ro,n4 as Vs,n5 as qs,n6 as Io,eG as Be,ae as tt,fc as ft,gM as Rs,ht as Is,gJ as Ys,gQ as Bo,gN as Bs,kI as No,lK as Lo,kJ as Fo,b3 as Te,bL as Kr,bA as je,hw as Xr,n7 as we,dU as lo,n8 as Jr,k as Ce,fZ as Qr,bC as Zr,dY as ei,bj as Do,l as Ke,n9 as Uo,gX as Oo,na as Ho,fN as ks,e5 as co,a7 as ti,fC as zo,ar as ee,hi as si,as as $s,at as Ks,L as Ps,b as vs,g7 as ni,bk as Go,$ as Xe,cf as oi,cl as ai,R as ri,A as ii,D as Wo,lF as li,kE as Xs,nb as Vo,lo as Ns,be as ci,aG as ui,a$ as di,f9 as qo,f3 as mi,eb as Ls,nc as pi,fi as zt,bX as Yo,cm as fi,aZ as $o,dW as Ko,fF as gi,cW as Xo,dR as hi,gq as xi,b0 as Jo,aY as Si,c8 as bi,di as yi,dl as Ci,nd as Ai,h8 as uo,hj as Qo,dX as _i,bi as ki,aV as ut,aS as Ft,aU as mo,kV as Pi,fa as po,ne as vi,eI as Mi,gb as Gt,nf as wi,fb as ji,i4 as Ti,ng as Ei,nh as Ri,j3 as Ii,ni as Bi,nj as Ni,fe as Li,kk as Fi,g9 as Di,s as Ui,N as Oi,dV as Zo,gL as Hi,fL as zi,kr as Gi,g4 as ea,fU as Wi,nk as Vi,cx as qi,cy as Yi,mo as $i,du as Ki,fm as Xi,jz as Ji,nl as Qi,je as Zi}from"./or7jf62i5kvok6pm.js";import{u as Fe,b as el,s as tl,e as sl}from"./g1mzshmp15rgsy0r.js";import{mH as Dt,kg as ce,n as Ee,A as _e,s7 as nl,c4 as ol,U as Fs,e5 as al,s8 as rl,s9 as il,sa as ll,k4 as cl,fh as ul,fi as dl,lZ as ml,sb as pl,d8 as ta,sc as Ae,ag as Kt,d7 as Js,sd as fl,se as gl,j$ as Qs,sf as hl,lw as xl,sg as sa,sh as Ds,ab as Sl,si as bl,sj as na,dc as yl,ni as fo,dz as Zs,nk as Cl,sk as Al,sl as _l,bB as kl,rz as Pl,bp as oa,ot as en,sm as aa,fc as Xt,sn as ra,so as vl,sp as Ml,sq as wl,rI as Ut,fS as Jt,sr as jl,ss as Tl,st as El,su as Rl,sv as Il,sw as go,sx as Bl,sy as Nl,sz as Ll,sA as Fl,sB as Dl,sC as Ul,pG as Ms,B as ia,F as la,G as ca,p1 as Ol,fR as ue,q$ as Je,sD as A,sE as Hl,sF as zl,hr as Gl,sG as Wl,sH as Vl,sI as ql,sJ as Yl,sK as $l,sL as Kl,sM as Xl,sN as Jl,sO as Ql,sP as Zl,sQ as ec,sR as tc,sS as sc,sT as nc,sU as oc,sV as ac,sW as rc,sX as ic,sY as lc,sZ as ua,s_ as cc,s$ as uc,t0 as dc,t1 as mc,t2 as pc,nU as fc,ak as da,t3 as gc,cN as Ye,e as ma,t4 as hc,t5 as xc,mJ as Us,fW as Sc,iQ as pa,t6 as bc,hp as fa,hq as yc,t7 as Cc,t8 as Ac,jP as _c,by as Qt,hf as kc,t9 as Pc,o1 as vc,e8 as ga,Z as Mc,eo as wc,M as ha,eK as xa,ta as jc,tb as Tc,tc as Ec,f5 as Rc,td as Ic,hI as Bc,te as Nc,tf as Lc,tg as Fc,th as Dc,ti as Uc,tj as Oc,tk as Hc,tl as zc,tm as Gc,tn as Wc,to as Vc,tp as qc,tq as Yc,tr as $c,ts as Kc,tt as Xc,tu as Jc,tv as Qc,tw as Zc,tx as Sa,ty as eu,tz as tu,tA as ba,tB as su,tC as ya,tD as Ca,tE as nu,tF as ou,tG as Aa,tH as au,tI as ru,es as iu,tJ as _a,tK as ka,g$ as lu,h0 as cu,eu as uu,tL as du,h2 as ws,tM as mu,tN as pu,tO as fu,tP as js,h4 as gu,tQ as hu,tR as xu,tS as Su,tT as bu,h7 as yu,tU as Cu,tV as Au,tW as _u,eM as ku,fT as Pu,tX as vu,tY as Mu,c$ as wu,tZ as ju,qE as Tu,t_ as Eu,t$ as Ru,u0 as Iu,u1 as Bu,u2 as Nu,u3 as Lu,u4 as Fu,u5 as Du,u6 as Uu,u7 as Ou,eX as Hu,jF as zu,u8 as Gu,u9 as ho,ie as Wu,ig as Vu,dK as qu,lA as Yu,ua as $u,lx as Ku,ub as Xu,uc as Ju,ud as Qu,fX as xo,ue as Zu,uf as ed,ug as Z,eC as td,uh as sd,o as nd,ui as od,uj as ad,uk as rd,ul as id,um as ld,d as cd,un as ud,uo as dd,up as md,eq as pd,uq as So,ur as bo,us as yo,ut as fd,uu as gd,hV as hd,uv as xd,hY as Sd,hZ as bd,uw as yd,ux as Cd,uy as Ad,uz as _d,uA as kd,uB as Pd,uC as vd,eR as Md,cb as wd,uD as jd,ct as Td,kP as Ed,eW as Rd,mE as Id,er as Bd,uE as Nd,a1 as Ld,qC as Fd,uF as Dd,uG as Ud,mB as Ts,mC as Es,uH as Od,a2 as Hd,uI as zd}from"./kax7wcp9i7f7jtvz.js";import{d as Pa,m as dt,a as va,u as Gd}from"./ocpfit0g1gfti5z4.js";import{P as Wd,u as Vd}from"./kwrsfo4prmlqgo0w.js";import{A as qd,C as Yd,g as $d}from"./fgnsrp7wj3i83g7e.js";import{u as Kd}from"./6l5wykugon65myc6.js";import{a as Ma,u as Xd,I as Jd,R as Qd}from"./klzyif2r6c67lyfu.js";import{P as Zd,v as em,w as Ot,x as tm}from"./mj9z9iuqobsziv2h.js";import{u as sm,c as nm}from"./osl7p7pfd29pg5qh.js";import{u as wa}from"./khey9wv8trxtr5w5.js";const om="https://persistent.oaistatic.com/image-gen/nux.222e584e.mp4",am="https://help.openai.com/en/articles/8932459",Bp=()=>{const t=te(),{isLoading:s,eligible:n}=Ee(_e.hasSeenShibaHomeNux),{isUnauthenticated:o}=pt(),[r]=nl(),i=Ur(t),c=Qe(Ze),a=ye(t,"2781425969");return o||!a||r||i||c?"hide":s?"loading":n?"show":"hide"};function ja(t){return[{title:t.formatMessage({id:"er580q",defaultMessage:"Create an image of a magazine cover of cute animals with headlines and text"}),body:"",type:ce.Autocomplete,prompt:t.formatMessage({id:"SKZKBN",defaultMessage:"Create an image of a photorealistic magazine cover for 'CUTE ANIMALS,' featuring three impossibly cute and stylishly accessorized pets, with realistic, catchy headlines and teaser text"}),theme:Dt.Image},{title:t.formatMessage({id:"ukPFbH",defaultMessage:"Create an image for a garden-themed birthday party invitation"}),body:"",type:ce.Autocomplete,prompt:t.formatMessage({id:"uYg5kL",defaultMessage:"Create an image of a colorful invitation for a garden-themed birthday party, including whimsical typography"}),theme:Dt.Image},{title:t.formatMessage({id:"mMiJxP",defaultMessage:"Create an image of an astronaut with an inflatable duck on Mars"}),body:"",type:ce.Autocomplete,prompt:t.formatMessage({id:"5nFWh4",defaultMessage:"Create a photorealistic image of an international astronaut on Mars, wearing a giant duck inflatable toy around its waist"}),theme:Dt.Image},{title:t.formatMessage({id:"+T7POI",defaultMessage:"Create an image of a tutorial for cooking pasta"}),body:"",type:ce.Autocomplete,prompt:t.formatMessage({id:"9N2bJ0",defaultMessage:"Create an image of a comic-book style tutorial for cooking pasta"}),theme:Dt.Image}]}const Np=({onClose:t,clientThreadId:s})=>{const{markAsViewed:n}=Ee(_e.hasSeenShibaHomeNux),o=Fe(),r=mt(),i=te(),c=wo(i,"2604379743").value,a=typeof c.nux_video_url=="string"?c.nux_video_url:om,l=typeof c.nux_image_url=="string"?c.nux_image_url:"",[d,h]=p.useState(!1),g=jo(),u=ol(F.PictureV2,s);p.useEffect(()=>{M.logEventWithStatsig("chatgpt_imagegen_nux_modal_shown","chatgpt_imagegen_nux_modal_shown")},[]);const f=oe(),S=ja(f),C=()=>{n(),t(),M.logEventWithStatsig("chatgpt_imagegen_nux_modal_dismissed","chatgpt_imagegen_nux_modal_dismissed")},k=()=>{n(),t(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{u&&g(F.PictureV2,{analyticsMetadata:{clientThreadId:s}}),o.focus()})}),o.setAutocompletions(S)};return e.jsx(e.Fragment,{children:e.jsxs(Or,{testId:"modal-imagegen-nux",isOpen:!0,noPadding:!0,onClose:Hr,shouldIgnoreClickOutside:!0,showCloseButton:!1,size:"custom",type:"success",className:"max-w-lg",children:[e.jsxs("div",{className:"relative aspect-3/2 w-full",children:[!d&&e.jsx("img",{src:l,alt:"",className:"absolute inset-0 h-full w-full object-cover object-bottom transition-opacity duration-300"}),e.jsx("video",{src:a,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"h-full w-full object-cover object-bottom",onLoadedData:()=>h(!0)})]}),e.jsxs("div",{className:"flex flex-col gap-2 px-8 pt-6 pb-6 text-center",children:[e.jsx("div",{className:"text-xl font-medium",children:e.jsx(N,{id:"KgZP2O",defaultMessage:"Image creation just got better"})}),e.jsx("div",{className:"text-token-text-secondary w-full",children:e.jsx(N,{id:"/oguus",defaultMessage:"ChatGPT now thinks a little longer to make more accurate and detailed images. <link>Learn more</link>",values:{link:_=>e.jsx("a",{href:am,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 no-underline",children:_})}})}),e.jsx("div",{className:"mt-2 w-full text-xs text-[#8F8F8F] dark:text-[#C4C4C4]",children:e.jsx(N,{id:"6pIXUv",defaultMessage:"You must have permission to edit images you upload, including consent from any people in them."})}),e.jsxs("div",{className:"mt-4 flex w-full gap-3",children:[e.jsx(lt,{color:"secondary",onClick:C,className:"flex-1",children:e.jsx(N,{id:"6nf9tD",defaultMessage:"Not now"})}),e.jsx(lt,{color:"primary",onClick:()=>{k(),r("/?model=gpt-4o"),M.logEventWithStatsig("chatgpt_imagegen_nux_modal_continued","chatgpt_imagegen_nux_modal_continued")},className:"flex-1",children:e.jsx(N,{id:"ms5BU0",defaultMessage:"Try it"})})]})]})]})})};function rm({usage:t}){const s={work:{icon:pl,color:"#35AE47"},school:{icon:ml,color:"#E937D1"},personalTasks:{icon:dl,color:"#EA8444"},funAndEntertainment:{icon:ul,color:"#6C71FF"},justCurious:{icon:cl,color:"#FFCC00"}},n=s[t].icon,o=s[t].color;return e.jsx(n,{className:"icon",style:{color:o}})}function Lp({clientThreadId:t}){const s=oe(),n=va({clientThreadId:t});return p.useEffect(()=>{Ht.logEvent("chatgpt_convo_onboarding_usage_chips_shown")},[]),e.jsx(qt,{mode:"wait",children:e.jsx(fe.div,{className:"-mx-6 mt-2 flex flex-wrap gap-2 px-6",initial:{opacity:0},animate:{opacity:1,transition:{delay:.2,ease:"easeInOut"}},exit:{opacity:0,transition:{ease:"easeInOut"}},children:["school","work","personalTasks","funAndEntertainment","justCurious"].map(o=>e.jsxs("button",{className:"border-token-border-default bg-token-main-surface-primary hover:bg-token-main-surface-secondary inline-flex h-[42px] items-center justify-start gap-2 rounded-[25px] border px-4 py-3",onClick:r=>{n({sourceEvent:r,stepPrompt:s.formatMessage(dt[`${o}Prompt`]),messageMetadata:{onboarding:{main_usages:[{usage:o}]},is_starter_prompt:!0,suggestion_type:ce.Starter}}),Ht.logEvent("chatgpt_convo_onboarding_usage_chip_clicked",null,{usage:o})},children:[e.jsx("div",{"data-svg-wrapper":!0,className:"relative",children:e.jsx(rm,{usage:o})}),e.jsx("div",{className:"font-['SF Pro'] text-token-text-primary text-[13px] leading-[18px] font-normal opacity-90",children:s.formatMessage(dt[o])})]},o))})})}function Fp({clientThreadId:t,examples:s}){const n=va({clientThreadId:t}),o=[rl,il,ll],r=oe();return p.useEffect(()=>{Ht.logEvent("chatgpt_convo_onboarding_examples_shown")},[]),e.jsx(qt,{mode:"wait",children:e.jsxs("div",{children:[e.jsx(fe.p,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3,ease:"easeInOut"},className:"text-token-text-primary text-base",children:r.formatMessage(dt.tryAnExample)}),e.jsx("ul",{className:"-mx-6 flex list-none flex-nowrap gap-6 overflow-auto px-6 py-4",children:s.map((i,c)=>e.jsx(fe.li,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:(c+1)*.2,duration:.3},children:e.jsxs("button",{className:"bg-token-main-surface-primary outline-token-border-xlight hover:shadow-token-border-default inline-flex h-60 w-[222px] flex-col items-center justify-start overflow-hidden rounded-2xl outline transition-all duration-300 hover:shadow-lg",onClick:a=>{n({sourceEvent:a,stepPrompt:i.example,messageMetadata:{onboarding:{triggered_tools:[i.feature]},is_starter_prompt:!0,suggestion_type:ce.Starter}}),Ht.logEvent("chatgpt_convo_onboarding_example_clicked",null,{tool:i.feature})},children:[e.jsx("img",{src:o[c%o.length].src,className:"h-[160px] w-full object-cover",alt:r.formatMessage({id:"chatgpt.new-onboarding.example-prompt",defaultMessage:"Example prompt"})}),e.jsx("div",{className:"inline-flex h-20 w-full gap-1 p-4",children:e.jsx("div",{className:"text-token-text-primary line-clamp-2 shrink grow basis-0 text-start text-base leading-normal",title:i.title,children:i.title})})]})},i.feature))})]})})}function im({clientThreadId:t,children:s}){const{isEligible:n,markAsViewed:o}=Pa(t),r=oe();return p.useEffect(()=>{n&&Fs.showAnnouncementTooltipExclusively(_e.hasSeenFilePickerNuxTooltip,!0)},[n]),n?e.jsx(al,{announcementKey:_e.hasSeenFilePickerNuxTooltip,show:!0,side:"top",align:"start",theme:"bright",dismissOnOutsideClick:!0,badge:"none",title:r.formatMessage(dt.tryUploadingAFile),description:r.formatMessage(dt.uploadFileExample),onDismiss:o,sideOffset:0,children:s}):s}const Wt=({clientThreadId:t,rateLimitPopup:s,children:n,disabled:o,highlightTooltip:r=!1,disabledReason:i,currentModelName:c,label:a,secondaryLabel:l})=>{const d=oe(),h=J(t,W.getIsNewConversation),g=et(),u=k=>{s!=null&&k&&M.logPopoverHover({type:"rate_limit",location:"file_upload",plan_type:g?.planType??"unknown"})},f=ta($e.signUpButtonText),{isEligible:S}=Pa(t),C=!!s;return e.jsx(e.Fragment,{children:C?e.jsxs(zr,{delayDuration:150,onOpenChange:u,children:[e.jsx(Gr,{asChild:!0,children:n}),e.jsx(Wr,{children:e.jsx(Vr,{children:e.jsx(io,{children:e.jsx(qr,{$as:io,side:"left",sideOffset:0,align:"start",alignOffset:-12,className:"max-w-[320px]",children:e.jsx(lm,{isNewConversation:h,rateLimitPopup:s,signUpButtonText:f})})})})})]}):!o&&S?e.jsx(im,{clientThreadId:t,children:n}):e.jsx(Os,{label:!o&&a?a:Zt(d,o,i,c),secondaryLabel:l,labelOrientation:"horizontal",className:"flex",contentClassName:r?void 0:"touch:hidden",open:r?!0:void 0,side:"bottom",children:n})})};function Zt(t,s,n,o){return s?n===Ae.ModelNotSupported&&o!=null?t.formatMessage({id:"xPEzDr",defaultMessage:"Add files disabled for {modelName}"},{modelName:o}):n===Ae.HasReachedMaxFiles?t.formatMessage({id:"TEBczg",defaultMessage:"Cannot add more files"}):n===Ae.RateLimitReached?t.formatMessage({id:"DpMzvo",defaultMessage:"Reached daily upload limit"}):t.formatMessage({id:"MeW0HZ",defaultMessage:"Add files is unavailable"}):t.formatMessage({id:"composer.add.label",defaultMessage:"Add photos & files"})}const lm=({isNewConversation:t=!1,rateLimitPopup:s,signUpButtonText:n})=>{const o=et(),r=mt(),i=Kt(),c=Js(),a=Hs();if(s==null)return null;const{call_to_action:l,description:d}=s,h=d||e.jsx(N,{...Co.defaultDescription}),g=l?.includes(X.GET_PLUS),u=l?.includes(X.AUTHENTICATE),f=u&&a;return e.jsxs("div",{className:"text-token-text-primary p-2 text-sm",children:[e.jsx("div",{className:"mb-3",children:h}),g?e.jsx(lt,{size:"small",color:"secondary",onClick:()=>{Ne(r,"Rate limited file upload popover"),M.logRateLimitGetPlusButtonClicked({type:"file_upload",location:"popover",plan_type:o?.planType??"unknown",is_hard_block:!1,is_new_conversation:t,hard_block_reason:""})},children:e.jsx(N,{...Co.getPlus})}):null,u?e.jsx(lt,{size:"small",color:"primary",onClick:()=>{i({authType:c?"login":"signup",callback:S=>{c?M.logLogInButtonClicked({location:"File picker rate limit tooltip",provider:S}):M.logSignUpButtonClicked({location:"File picker rate limit tooltip",provider:S})}})},children:c?e.jsx(N,{...$e.logInButtonText}):e.jsx(N,{...n})}):null,f?e.jsx(lt,{size:"small",color:"secondary",className:"ms-2",onClick:()=>{i({authType:c?"signup":"login",callback:S=>{c?M.logSignUpButtonClicked({location:"File picker rate limit tooltip",provider:S}):M.logLogInButtonClicked({location:"File picker rate limit tooltip",provider:S})}})},children:c?e.jsx(N,{...n}):e.jsx(N,{...$e.logInButtonText})}):null]})},Co=Le({defaultDescription:{id:"U5qAWP",defaultMessage:"You've reached your daily upload limit. Get ChatGPT Plus to unlock more."},getPlus:{id:"TeyLcp",defaultMessage:"Get Plus"}}),Ta=({modelSupportsImages:t,isDisabled:s})=>{const n=t&&!s&&Eo(),{addFileIcon:o}=Qs(),r=cm(o,n);return e.jsx(r,{"aria-label":"",className:"icon"})};function tn({openFileDialog:t,showMenuForNoAuth:s,modelSupportsImages:n,isDisabled:o,disabledReason:r,currentModelName:i}){const c=te(),a=oe(),l=Kt(),d=mt(),h=To(c),g=n&&!o&&Yr(),u=n&&!o&&Eo();return s?e.jsx(um,{onClickUploadImages:t,redirectToAuth:()=>l({authType:"login"})}):e.jsxs(e.Fragment,{children:[u&&e.jsx(fl,{}),g&&e.jsx(gl,{}),e.jsx(ae.Item,{onClick:r===Ae.RateLimitReached?()=>{Ne(d,"Rate limited file upload menu-item"),M.logRateLimitGetPlusButtonClicked({type:"file_upload",location:"menu-item",plan_type:h?.planType??"unknown",is_hard_block:!1,hard_block_reason:""})}:t,icon:e.jsx(Ta,{modelSupportsImages:n,isDisabled:o}),disabled:o&&r!==Ae.RateLimitReached,label:u?a.formatMessage({id:"LocalFileDropdownItem.uploadFilesOnly",defaultMessage:"Add files"}):Zt(a,o,r,i),secondary:r===Ae.RateLimitReached&&a.formatMessage({id:"kYTJoS",defaultMessage:"Get ChatGPT Plus to unlock more"})},"upload")]})}function cm(t,s){return t==="photo"?s?Ds:sa:t==="paperclip"?Ds:Sl}function um({onClickUploadImages:t,redirectToAuth:s}){return e.jsxs(e.Fragment,{children:[e.jsx(ae.Item,{icon:hl,onClick:s,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx(N,{...it.connectApps}),e.jsx("span",{className:"text-token-text-secondary text-[13px]",children:e.jsx(N,{...it.loginRequired})})]})},"connect-apps-no-auth"),e.jsx(ae.Item,{icon:xl,onClick:s,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx(N,{...it.uploadDocuments}),e.jsx("span",{className:"text-token-text-secondary text-[13px]",children:e.jsx(N,{...it.loginRequired})})]})},"upload-documents-no-auth"),e.jsx(ae.Item,{icon:sa,onClick:t,children:e.jsx(N,{...it.uploadImages})},"upload-images-no-auth")]})}const it=Le({connectApps:{id:"Rna6u2",defaultMessage:"Connect apps"},uploadDocuments:{id:"0BxpM7",defaultMessage:"Documents"},uploadImages:{id:"rdMuNJ",defaultMessage:"Images"},loginRequired:{id:"/1XNys",defaultMessage:"Login required"}});function dm({clientThreadId:t,openFileDialog:s,icon:n,isDisabled:o=!1,isSmall:r=!1,showLabel:i=!1,showUpsell:c=!1,hideBorder:a=!1,highlightTooltip:l=!1,disabledReason:d,currentModelName:h,visualTreatment:g,showMenuForNoAuth:u,modelSupportsImages:f}){const S=oe(),C=Yt();o=(o||!!C)&&!c;const k=e.jsxs(bl,{disabled:o,$showLabel:i,$hideBorder:a,$isSmall:r,$visualTreatment:g,onClick:I=>{if(I.preventDefault(),u||c){M.logNoAuthAttachButtonClicked({location:u?"No auth file upload":"No auth upsell"});return}s()},"aria-label":Zt(S,o,d,h),children:[n,i&&e.jsx(na,{})]}),_=e.jsx("div",{className:"flex",children:k});if(u||c){const I=u?e.jsx(tn,{openFileDialog:s,showMenuForNoAuth:!0,modelSupportsImages:f}):e.jsx(yl,{location:"attach",statsig_login_event:"chatgpt_composer_upsell_login_button_clicked",statsig_signup_event:"chatgpt_composer_upsell_signup_button_clicked"}),E=e.jsx(ae.BasicTrigger,{asChild:!0,children:_});return e.jsxs(ae.Root,{children:[u?e.jsx(Wt,{clientThreadId:t,rateLimitPopup:C,highlightTooltip:l,disabled:o,children:E}):e.jsx(Os,{label:e.jsx(N,{id:"wkpQmi",defaultMessage:"Upload files and more"}),side:"bottom",open:l||void 0,children:E}),e.jsx(ae.Portal,{children:e.jsx(ae.Content,{alignOffset:-8,side:"bottom",size:"small",className:"radix-side-bottom:flex-col-reverse flex flex-col",children:I})})]})}return e.jsx(Wt,{disabled:o,clientThreadId:t,rateLimitPopup:C,highlightTooltip:l,children:_})}function mm({code:t,message:s}){switch(t){case fo.FileTooLarge:return Ao.errorFileTooLarge;case fo.TooManyFiles:return M.logEvent("Uploaded Max Files Error"),Ao.errorTooManyFiles;default:return s}}const Ao=Le({attachImages:{id:"PromptFilePicker.attachImages",defaultMessage:"Attach images"},attachFiles:{id:"PromptFilePicker.attachFiles",defaultMessage:"Upload files and more"},errorFileTooLarge:{id:"PromptFilePicker.errorFileTooLarge",defaultMessage:"Your file is too large. The maximum file size is {size}MB."},errorTooManyFiles:{id:"PromptFilePicker.errorTooManyFiles",defaultMessage:"You may only upload {maxNum} files at a time."},defaultFileUploadRateLimited:{id:"U5qAWP",defaultMessage:"You've reached your daily upload limit. Get ChatGPT Plus to unlock more."},getPlusButton:{id:"TeyLcp",defaultMessage:"Get Plus"}}),_o=Le({dragInstructions:{id:"FileDropZone.dragInstructions",defaultMessage:"Add anything"},dragAllAccepted:{id:"FileDropZone.dragAllAccepted",defaultMessage:"Drop any file here to add it to the conversation"}});function pm(t){if(!t.accept||Object.keys(t.accept).length===0)return[];const s=[];return Object.values(t.accept).forEach(n=>s.push(...n)),s.sort()}function Dp(t){const{className:s,children:n,clientThreadId:o,currentModelConfig:r,noKeyboard:i}=t,c=oe(),a=$t(),l=te(),d=tt(l),g=zs(l).flags?.includes(Ws.NoAuthEnableFileUploads),u=Zs(o),f=ft(),S=Rs(r,u,f),C=S!==Be.None,k=Is(y=>y.files),_=(S===Be.Multimodal?Vs:qs)-k.length,I=_<=0,{getGizmoId:E}=Ys(),{handleFileAccepted:R}=Ra(c,S,Bs(r,u),"drag",E,Bo(r,u)?.attachments),v=Yt(),P=No(!d&&g?Bs(r,u):Lo(r,u)),{getRootProps:b,isDragActive:w}=wa({maxFiles:_,disabled:!C||I||v!=null,noClick:!0,noKeyboard:i,onDropAccepted:R,onDropRejected:y=>Ea(y,c,a,S),multiple:!0,maxSize:Fo,...P}),j=pm(P);return e.jsxs("div",{...b({className:s}),children:[n,w&&e.jsxs(fm,{children:[e.jsx(Cl,{}),e.jsx("h3",{children:e.jsx(N,{..._o.dragInstructions})}),e.jsx("h4",{className:"w-2/3 text-center",children:j.length>0?j.join(", "):e.jsx(N,{..._o.dragAllAccepted})})]})]})}function Ea(t,s,n,o){const{errors:r}=t[0];r.forEach(i=>{const c=mm(i);typeof c=="string"?n.danger(c,{hasCloseButton:!0,loggingTitle:"File upload error",loggingDescription:c,toastId:"file_upload_error"}):n.danger(s.formatMessage(c,{size:Io,maxNum:o===Be.Multimodal?Vs:qs}),{hasCloseButton:!0,loggingTitle:c.defaultMessage||"File upload error",loggingDescription:c.defaultMessage||"File upload error",toastId:"file_upload_error"})})}function Ra(t,s,n,o,r,i){const c=te(),a=zs(c).flags,l=$t(),d=Gs(),{isUnauthenticated:h}=pt(),g=a?.includes(Ws.NoAuthEnableFileUploads);return{handleFileAccepted:p.useCallback(async(f,S)=>{M.logEvent("Upload File",{client:"web",eventSource:o,intent:s.toString()});const C=r!=null?await r():void 0;f.length>0&&f.forEach(k=>{ct.uploadFile(d,$r(k),k,s,n,t,l,{gizmoId:C,...g&&{isUnauthenticated:h}},i)})},[o,s,r,d,n,t,l,i,g,h])}}const fm=Ro.div`absolute z-50 inset-0 flex gap-2 flex-col justify-center items-center after:contents-[""] after:absolute after:opacity-80 after:z-[-1] after:bg-token-main-surface-primary after:inset-0`,gm=({clientThreadId:t,currentModelId:s,isCompletionInProgress:n,composerController:o})=>{const r=te(),i=ft(),c=Te(t),a=Kr(k=>k.threads[t]?.prepareRequestBlocked??!1),{isOpen:l}=Gd();Al({clientThreadId:t,composerController:o});const d=p.useRef(n);p.useEffect(()=>{d.current=n},[n]);const h=p.useCallback(k=>{d.current?je(t,_=>{_.conduitToken=null,_.prepareState=null}):je(t,_=>{_.conduitToken=k,_.prepareState="success"})},[t]),g=p.useRef(null);g.current=()=>_l(t,s,i?[i]:void 0,h,!1,l);const u=p.useCallback(()=>g.current?.(),[]),f=p.useCallback(kl(()=>u(),5e3,{leading:!0,trailing:!0}),[]),S=p.useRef(!1),C=Xr();return p.useEffect(()=>{if(C){if(!S.current){S.current=!0;return}d.current||a||u()}},[C,t,s,i,c?.effortMode,a]),p.useEffect(()=>{f.cancel()},[n,f]),p.useEffect(()=>o.subscribe("change",()=>{n||Pl(r,!0)&&f()}),[n,o,f,r]),null},hm=({clientThreadId:t,beaconInfo:s,onPrimaryCTAClick:n,onSecondaryCTAClick:o,onDismiss:r,onMount:i})=>{const{title:c,description:a,action_items:l,composer_text:d}=s,h="Prompt TextareaBeacons Banner",g=oa({clientThreadId:t}),u=Fe(),f=Kt(),S=te(),C=!tt(S),k=mt(),_=v=>{switch(v?.action){case we.REGENERATE_MESSAGE_GPT45:{const P=W.getCurrentLeafId(Te(t)),b=()=>{g({sourceEvent:new Event("beacon CTA click"),nodeId:P,requestedModelId:"gpt-4-5"})};return{text:v.action_copy,onClick:b}}case we.FILE_UPLOAD:{const P=()=>{u.openFileDialog(),d&&(u.focus(),u.setText(d))};return{text:v.action_copy,onClick:P}}case we.AUTHENTICATE_LOGIN:{const P=()=>{f({authType:"login"})};return{text:v.action_copy,onClick:P}}case we.AUTHENTICATE_SIGNUP:{const P=()=>{f({authType:"signup"})};return{text:v.action_copy,onClick:P}}case we.GET_PLUS:{const P=()=>{C?f({authType:"login",shouldOpenPaymentModalOnAuth:!0}):Ne(k,h)};return{text:v.action_copy,onClick:P}}case we.GET_PRO:{const P=()=>{C?f({authType:"login",shouldOpenPaymentModalOnAuth:!0}):Ne(k,h)};return{text:v.action_copy,onClick:P}}case we.REGENERATE_MESSAGE_O3:{const P=W.getCurrentLeafId(Te(t)),b=()=>{g({sourceEvent:new Event("beacon CTA click"),nodeId:P,requestedModelId:"o3"})};return{text:v.action_copy,onClick:b}}default:return}};en(()=>{i?.()});const[I,E]=l??[],R={primaryAction:(()=>{const v=_(I);if(v)return{...v,onClick:()=>{n?.(),v.onClick?.()}}})(),secondaryAction:(()=>{const v=_(E);if(v)return{...v,onClick:()=>{o?.(),v.onClick?.()}}})()};return e.jsx(aa,{onDismiss:r,title:c,description:a,actions:R})},xm=({clientThreadId:t})=>{const s=ra(),n=J(t,W.getRequestId),o=Xt(n),r=vl(),i=Ml(),c=wl();p.useEffect(()=>{o&&(M.logEventWithStatsig("Beacon UI Banner Ignored","chatgpt_beacon_ui_banner_ignored",{...s}),Ut.dismissBanner())},[o,s]);const a=p.useRef(!1),l=()=>{a.current||s&&(M.logEventWithStatsig("Beacon UI Banner Shown","chatgpt_beacon_ui_banner_shown",{...s}),r.mutate(s.beacon_id),a.current=!0)},d=()=>{s&&(M.logEventWithStatsig("Beacon UI Banner Primary CTA Clicked","chatgpt_beacon_ui_banner_primary_cta_clicked",{...s}),i.mutate(s.beacon_id)),Ut.dismissBanner()},h=()=>{s&&(M.logEventWithStatsig("Beacon UI Banner Secondary CTA Clicked","chatgpt_beacon_ui_banner_secondary_cta_clicked",{...s}),i.mutate(s.beacon_id)),Ut.dismissBanner()},g=()=>{s&&(M.logEventWithStatsig("Beacon UI Banner Dismissed","chatgpt_beacon_ui_banner_dismissed",{...s}),c.mutate(s.beacon_id)),Ut.dismissBanner()};return e.jsx(qt,{children:s&&e.jsx(fe.div,{transition:{type:"tween",ease:"easeInOut",duration:.1},initial:{opacity:0,transform:"translateY(8px)"},animate:{opacity:1,transform:"translateY(0px)"},exit:{opacity:0,transform:"translateY(8px)"},children:e.jsx(hm,{clientThreadId:t,beaconInfo:s,onPrimaryCTAClick:d,onSecondaryCTAClick:h,onDismiss:g,onMount:l})})})};function Sm(t){const s=J(t,W.getRequestId),n=Xt(s),o=ra(),r=o!=null&&o.action_items.every(i=>Object.values(we).includes(i.action));return!n&&r}const Ia=({clientThreadId:t,rateLimitInfo:s,onDismiss:n,onInteract:o,onMount:r})=>{const{name:i,title:c,call_to_action:a,description:l}=s,d=et(),h=lo(!0),{updateSystemHint:g}=Jt(),u=Fe(),f=lo(!1),S=Jr(),C=J(t,W.getIsNewConversation),k=d?.planType??"unknown",_=Hs(),I=S&&"block_reason"in S?S.block_reason:null,E="banner_description",R=p.useMemo(()=>({type:i||"unknown",location:E,plan_type:k,is_new_conversation:C,is_hard_block:!!S,hard_block_reason:I??"",call_to_action:a}),[i,E,k,C,S,I,a]),v=mt(),P=Kt(),b=te(),w=!tt(b),j=Js(),y=ta($e.signUpButtonText),{eligible:L,isLoading:D}=Ee(_e.hasSeenTatertotNux),K=oa({clientThreadId:t}),x=Ce(b,"1368081792"),q=ge=>{switch(ge){case X.AUTHENTICATE:return{text:j?$e.logInButtonText:y,onClick:()=>{P({authType:j?"login":"signup",callback:B=>{j?M.logLogInButtonClicked({location:`Rate limit banner - ${i}`,provider:B}):M.logSignUpButtonClicked({location:`Rate limit banner - ${i}`,provider:B})}})}};case X.AUTHENTICATE_SECONDARY:return{text:j?y:$e.logInButtonText,onClick:()=>{P({authType:j?"signup":"login",callback:B=>{j?M.logSignUpButtonClicked({location:`Rate limit banner - ${i}`,provider:B}):M.logLogInButtonClicked({location:`Rate limit banner - ${i}`,provider:B})}})}};case X.GET_PLUS:return{text:Me.getPlusButton,onClick:()=>{M.logRateLimitGetPlusButtonClicked(R),w?P({authType:j?"login":"signup",shouldOpenPaymentModalOnAuth:!0,callback:B=>{j?M.logLogInButtonClicked({location:"Rate limit banner Get Plus upsell",provider:B}):M.logSignUpButtonClicked({location:"Rate limit banner Get Plus upsell",provider:B})}}):Ne(v,"Prompt textarea rate limit banner")}};case X.NEW_CHAT:return{text:Me.newChatButton,onClick:()=>{h({modelId:"",location:E})}};case X.PAID_USER_O3_MINI_HIGH:{const B=W.getCurrentLeafId(Te(t)),$=()=>{M.logEventWithStatsig("In Context Upsell Banner O3 Mini High CTA Clicked","chatgpt_in_context_upsell_banner_o3_mini_high_cta_clicked",{location:x.get("should_change_model_picker",!0)?"In-context upsell o3-mini-high for Plus banner - Try it button":"In-context upsell o3-mini-high for Plus (no model switch) banner - Try it button",eventProperties:R}),x.get("should_change_model_picker",!0)&&f({modelId:"o4-mini-high",location:"In-context upsell o4-mini-high for Plus banner - Try it button"}),K({sourceEvent:new Event("click"),nodeId:B,requestedModelId:"o4-mini-high"})};return{text:Me.tryItButton,onClick:$}}case X.FREE_USER_O3_MINI_HIGH:return{text:Me.getPlusButton,onClick:()=>{M.logEventWithStatsig("In Context Upsell Banner O3 Mini High CTA Clicked","chatgpt_in_context_upsell_banner_o3_mini_high_cta_clicked",{location:"In-context upsell o3-mini-high for Free banner - Get Plus button",eventProperties:R}),Ne(v,"Prompt textarea in-context upsell banner")}};case X.DEEP_RESEARCH_IN_CONTEXT_UPSELL:{const B=W.findNode(Te(t),ne=>Qr(ne.message)),$=B?Zr(B.message):void 0;return{text:Me.tryItButton,onClick:()=>{M.logEventWithStatsig("In Context Upsell Banner Deep Research CTA Clicked","chatgpt_in_context_upsell_banner_deep_research_cta_clicked",{location:"In-context upsell deep research - Try it button",eventProperties:R}),g(F.Research,{clientThreadId:t}),u.focus(),u.setText($??"")}}}case X.GET_PRO:return{text:Me.getProButton,onClick:()=>{M.logRateLimitUpgradePlanButtonClicked({...R,upgrade_plan_tye:"pro"}),w?P({authType:j?"login":"signup",shouldOpenPaymentModalOnAuth:!0,callback:B=>{j?M.logLogInButtonClicked({location:"Rate limit banner Get Pro upsell",provider:B}):M.logSignUpButtonClicked({location:"Rate limit banner Get Pro upsell",provider:B})}}):Ne(v,"Prompt textarea rate limit banner")}};case X.TRY_CODEX:return{text:Me.tryCodexButton,onClick:()=>{M.logEventWithStatsig("In Context Upsell Banner Codex CTA Clicked","chatgpt_in_context_upsell_banner_codex_cta_clicked",{location:"In-context upsell codex - Try Codex button",eventProperties:R}),v("/codex")}};case X.TRY_TATERTOT:return{text:Me.tryItButton,onClick:()=>{M.logEventWithStatsig("In Context Upsell Banner Tatertot CTA Clicked","chatgpt_in_context_upsell_banner_tatertot_cta_clicked",{location:"In-context upsell tatertot - Try it button",eventProperties:R}),g(F.Tatertot,{clientThreadId:t})}};default:return}};en(()=>{!x.get("should_change_model_picker",!0)&&R.type==="o3-mini-high-in-context-upsell-plus"&&(R.type="o3-mini-high-in-context-upsell-plus-no-model-switch"),M.logRateLimitBannerShown(R),r?.()});const[O,Y]=a??[];let U=Y;O===X.AUTHENTICATE&&_&&(U=X.AUTHENTICATE_SECONDARY);const se=ye(b,"2861925050");let V={};return se&&(O===X.NOTIFY_ADMIN_FOR_CREDITS||O===X.ADD_CREDITS)?O===X.ADD_CREDITS?V={customActions:e.jsx(qd,{trigger:"prompt-textarea-rate-limit-banner"})}:O===X.NOTIFY_ADMIN_FOR_CREDITS&&(V={customActions:e.jsx(Yd,{creditConsumingProduct:$d(i),trigger:"prompt-textarea-rate-limit-banner"})}):V={primaryAction:q(O),secondaryAction:q(U)},e.jsx(aa,{onDismiss:n,title:c,description:l,actions:V,onInteract:o})},Me=Le({getPlusButton:{id:"TeyLcp",defaultMessage:"Get Plus"},getProButton:{id:"Pl8/Vk",defaultMessage:"Get Pro"},newChatButton:{id:"7OvnJ5",defaultMessage:"New chat"},tryItButton:{id:"zPDzun",defaultMessage:"Try it"},tryCodexButton:{id:"KcWniZ",defaultMessage:"Try Codex"}}),bm=({clientThreadId:t,composerController:s})=>{const n=Uo(),o=Ke(s.store,k=>k.rateLimitBannerFeature),r=Oo(),i=n??Ba(o,r),c=J(t,W.getRequestId),a=J(t,W.getCurrentLeafId),l=Xt(c),{markSeen:d}=Ho(a),h=te(),g=Ce(h,"1368081792"),u=i?.name?()=>{switch(i.name){case"tatertot-in-context-upsell":d(!1);break;case"o3-mini-high-in-context-upsell-free":case"o3-mini-high-in-context-upsell-plus":case"deep-research-in-context-upsell":case"deep-research-in-context-upsell-free":case"codex-in-context-upsell":case"codex-in-context-upsell-plus":Ll(a);break}}:void 0,f=ye(h,"3612584454");p.useEffect(()=>{l&&!(i?.name==="gpt-4l"&&f)&&(co.dismissBanner(),s.setRateLimitBannerFeature(null))},[l,i?.name,f,s]);const S=i?.is_dismissible?()=>{M.logEventWithStatsig("Rate Limit: Dismiss Banner","chatgpt_rate_limit_banner_dismissed",{type:!g.get("should_change_model_picker",!0)&&i?.name==="o3-mini-high-in-context-upsell-plus"?"o3-mini-high-in-context-upsell-plus-no-model-switch":i?.name}),co.dismissBanner(),s.setRateLimitBannerFeature(null)}:void 0,C=()=>{switch(i?.name){case"o3-mini-high-in-context-upsell-free":case"o3-mini-high-in-context-upsell-plus":case"deep-research-in-context-upsell":case"deep-research-in-context-upsell-free":case"codex-in-context-upsell":case"codex-in-context-upsell-plus":Fl({interactedInPeriod:!0});break;case"tatertot-in-context-upsell":d(!0);break}};return e.jsx(qt,{children:i&&e.jsx(fe.div,{transition:{type:"tween",ease:"easeInOut",duration:.1},initial:{opacity:0,transform:"translateY(8px)"},animate:{opacity:1,transform:"translateY(0px)"},exit:{opacity:0,transform:"translateY(8px)"},children:e.jsx(Ia,{clientThreadId:t,rateLimitInfo:i,onDismiss:S,onInteract:C,onMount:u})})})};function Ba(t,s){const n=s.find(o=>o.name===t);return n?{name:n.name,title:n.title,description:n.description,is_dismissible:!0,call_to_action:n.call_to_action,resets_after:n.resets_after}:null}function ym(t,s,n,o,r,i,c,a,l,d,h,g,u){if(l||(t.name==="o3-mini-high-in-context-upsell-free"||t.name==="o3-mini-high-in-context-upsell-plus")&&(s.some(R=>R.model_slug==="o4-mini-high")||n.id==="o4-mini-high")||a&&c&&ks(Date.now(),c)<go)return!1;const S=o==null||ks(Date.now(),o)>=Bl,C=r===d,k=c==null||i==null||ks(Date.now(),c)>=go||i<Nl;if(!(S&&k||C))return!1;switch(t.name){case"deep-research-in-context-upsell":return h("should_show_deep_research_upsell_banner",!1);case"deep-research-in-context-upsell-free":return h("should_show_deep_research_upsell_banner_free",!1);case"o3-mini-high-in-context-upsell-free":return h("should_show_o3_mini_high_upsell_banner_free_user_to_plus",!1);case"o3-mini-high-in-context-upsell-plus":return h("should_show_o3_mini_high_upsell_banner_plus_user",!1);case"codex-in-context-upsell":return g("should_show_codex_upsell_banner",!1);case"codex-in-context-upsell-plus":return u("should_show_codex_upsell_banner",!1);default:return!1}}function Cm(t,s){const n=te(),o=ei(),r=Do(t),i=J(t,W.getRequestId),c=J(t,W.getCurrentLeafId),a=Xt(i),l=jl(b=>b.lastSeenInContextUpsellBannerAt),d=Tl(b=>b.inContextUpsellBannerPeriodExposureCount),h=El(b=>b.inContextUpsellBannerPeriodStartAt),g=Rl(b=>b.inContextUpsellBannerLastSeenId),u=Il(b=>b.inContextUpsellBannerInteractedInPeriod),f=Ce(n,"1368081792"),S=Ce(n,"1738106734"),C=Ce(n,"3861158060"),k=Ke(s.store,b=>b.rateLimitBannerFeature),_=ye(n,"2861925050"),I=Uo(),E=Oo(),{canBeSeen:R}=Ho(c),v=_?I:I??Ba(k,E);let P=!1;switch(v?.name){case null:case void 0:P=k!=null;break;case"o3-mini-high-in-context-upsell-free":case"o3-mini-high-in-context-upsell-plus":case"deep-research-in-context-upsell":case"deep-research-in-context-upsell-free":case"codex-in-context-upsell":case"codex-in-context-upsell-plus":P=ym(v,o,r,l,g,d,h,u,a,c,f.get,S.get,C.get);break;case"tatertot-in-context-upsell":P=R&&f.get("should_show_tatertot_in_context_upsell_banner",!1);break;default:P=!0}return!a&&P}const Vt="month",Na="year";function Am(){const t=ti(),s=oe(),{markAsViewed:n}=Ee(Dl),{initialBillingDetails:o}=Kd(t,!0),r=p.useMemo(()=>({...t?.subscriptionAnalyticsParams,referrer:document.referrer}),[t]);async function i(){try{await Ol(o,r)}catch{}}const{shouldShowBanner:c,discountValue:a,discountDuration:l}=Ul();if(p.useEffect(()=>{c&&a&&l&&Ms.logShowReferrerRedemptionBanner()},[c,a,l]),!c||!a||!l)return null;const d=_m(s,o,a,l),h=km(s,o,a,l),g=e.jsxs("div",{className:"grow",children:[e.jsx("div",{className:"mb-0.5 font-semibold",children:d}),e.jsx("span",{className:"text-token-text-secondary",children:h})]});return e.jsx(ia,{onPrimaryCtaClick:()=>{n(),Ms.logClickReferrerRedeemButton(),i()},primaryCtaText:e.jsx(N,{id:"referrerRedemptionBannerPrimaryCta",defaultMessage:"Get Plus"}),onDismiss:()=>{n(),Ms.logCloseReferrerRedemptionBanner()},content:g})}function _m(t,s,n,o){const{currencySymbol:r}=la(ca(),s.currency),i=o?o.period:Vt,c=o?o.num_periods:1,a=r.code.defaultMessage?.toString()??zo,l=t.formatNumber(n.value,{style:"currency",currency:a,minimumFractionDigits:0,maximumFractionDigits:2});let d;return i===Vt?d=c===1?e.jsx(N,{id:"referrerRedemptionBannerTitleForSingleMonth",defaultMessage:"Your {discount} credit is ready",values:{discount:l}}):e.jsx(N,{id:"referrerRedemptionBannerTitleForPluralMonths",defaultMessage:"Redeem your {discount} referral reward",values:{discount:l}}):i===Na&&(d=c===1?e.jsx(N,{id:"referrerRedemptionBannerTitleForSingleYear",defaultMessage:"Redeem your {discount} referral reward",values:{discount:l}}):e.jsx(N,{id:"referrerRedemptionBannerTitleForPluralYears",defaultMessage:"Redeem your {discount} referral reward",values:{discount:l}})),d}function km(t,s,n,o){const{currencySymbol:r}=la(ca(),s.currency),i=o?o.period:Vt,c=o?o.num_periods:1,a=r.code.defaultMessage?.toString()??zo,l=t.formatNumber(n.value,{style:"currency",currency:a,minimumFractionDigits:0,maximumFractionDigits:2});let d;return i===Vt?d=c===1?e.jsx(N,{id:"referrerRedemptionBannerContentForSingleMonth",defaultMessage:"Your referral link was used — claim your free month of Plus."}):e.jsx(N,{id:"referrerRedemptionBannerContentForPluralMonths",defaultMessage:"Your referral link earned you {discount} off {num_months} months of Plus.",values:{discount:l,num_months:c}}):i===Na&&(d=c===1?e.jsx(N,{id:"referrerRedemptionBannerContentForSingleYear",defaultMessage:"Your referral link earned you {discount} off a year of Plus.",values:{discount:l}}):e.jsx(N,{id:"referrerRedemptionBannerContentForPluralYears",defaultMessage:"Your referral link earned you {discount} off {num_years} years of Plus.",values:{discount:l,num_years:c}})),d}const Pm=$s(()=>Ks(()=>import("./mrl6054ij46mdqia.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(t=>t.JawboneNotificationsBanner)),La=p.memo(function({className:s}){const{store:n}=ue(),o=n.useIsHeaderContentAreaPopulated(),i=n.useContentAreaId(Je.HeaderTop)===A.AgentModeAnnouncementBanner?"z-0":Hl.PromptTextareaHeader;return e.jsx("div",{className:ee(s??"absolute start-0 end-0 bottom-full",i),children:e.jsx(zl,{shouldRender:o,contentArea:Je.Header,children:e.jsxs("div",{className:"mb-2 flex flex-col gap-3.5 pt-2",children:[e.jsx(vm,{}),e.jsx(Mm,{})]})})})});function vm(){const{store:t}=ue(),s=t.useSharedProps(d=>d?.clientThreadId),n=t.useContentAreaId(Je.HeaderTop),o=Gl(),r=J(s,d=>d?.modelId),i=Wl.useStore(),c=si(),a=Qe(Ze);let l;switch(n){case A.ProjectConversationTaskNoFileAccess:l=e.jsx(Em,{});break;case A.AdvancedVoiceOnMobileAnnouncement:l=e.jsx(lc,{clientThreadId:s});break;case A.S09KM1:l=null;break;case A.BannerSignup:l=e.jsx(Tm,{});break;case A.AudioParagenPrompt:l=e.jsx(ic,{clientThreadId:s});break;case A.BannerTermsDisclaimer:l=e.jsx(Rm,{});break;case A.PromptTextareaAction:l=e.jsx(Im,{});break;case A.BannersRateLimit:l=e.jsx(Bm,{});break;case A.BannersBeaconUI:l=e.jsx(Nm,{});break;case A.BannerSidekickAnnouncement:l=e.jsx(rc,{});break;case A.SearchBrowserExtensionAnnouncement:l=e.jsx(ac,{});break;case A.MoonshineAnnouncement:l=e.jsx(oc,{});break;case A.CustomizeChatGPTAnnouncement:l=e.jsx(nc,{});break;case A.SearchBrowserExtensionReactiveAnnouncement:l=e.jsx(sc,{});break;case A.BannerMemoryFull:l=e.jsx(tc,{});break;case A.Box:l=e.jsxs("div",{id:"Box",className:"flex h-20 w-full items-center justify-center gap-2 bg-red-500 p-2",children:["box",e.jsxs("div",{className:"flex h-full w-full items-center justify-center gap-2 bg-blue-500 p-2",children:["inner",e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-yellow-400 text-center",children:"actual content"})]})]});break;case A.JawboneAnnouncement:o?l=e.jsx(Pm,{}):l=null;break;case A.JawboneMaxActiveAnnouncement:o?l=e.jsx(ec,{}):l=null;break;case A.PromoRedemptionAnnouncement:l=e.jsx(Wd,{});break;case A.OperatorAnnouncement:l=e.jsx(Zl,{});break;case A.BannerPlusUpsell:l=e.jsx(Ql,{});break;case A.ReferrerRedemptionAvailableAnnouncement:l=e.jsx(Am,{});break;case A.RefereeRedemptionAvailableAnnouncement:l=e.jsx(Jl,{});break;case A.ReferralProgramUpsellAnnouncement:l=e.jsx(Xl,{});break;case A.TatertotIntakeFormAnnouncement:l=!1;break;case A.StudentsUpsellAnnouncement:l=e.jsx(Kl,{});break;case A.ModelDeprecationBanner:l=$l(r);break;case A.TeamsContextualAnswersUpsell:l=e.jsx(Yl,{});break;case A.KanziConfig:l=!1;break;case A.AgentModeAnnouncementBanner:l=c&&!a&&e.jsx(ql,{});break;case A.LanguageUpsellBanner:l=e.jsx(Vl,{onDismissSideEffect:()=>{M.logEventWithStatsig("Language Upsell Banner Dismissed","chatgpt_web_language_upsell_banner_dismissed"),i.closeBanner()},onPrimaryCtaClickSideEffect:()=>{M.logEventWithStatsig("Language Upsell Banner Primary CTA Clicked","chatgpt_web_language_upsell_banner_primary_cta_clicked"),i.closeBanner()}});break;default:l=null;break}return l}function Mm(){const{store:t}=ue(),s=t.useContentAreaId(Je.HeaderBottom);let n;switch(s){case ua.DallePromptControls:n=e.jsx(jm,{});break;default:n=null;break}return n}const wm=$s(()=>Ks(()=>import("./n5lc3jkxxguzay6r.js"),__vite__mapDeps([7,1,3,4,2,5])).then(t=>t.default));function jm(){const{store:t}=ue(),s=t.useSharedProps(n=>n?.composerController);return s?e.jsx(wm,{composerController:s}):null}function Tm(){const{store:t}=ue(),s=t.useSharedProps(r=>r?.clientThreadId),n=Js(),o=cc();return s?n?e.jsx(uc,{threadId:s,showSignUp:o}):e.jsx(dc,{threadId:s,showLogin:o}):null}function Em(){return p.useEffect(()=>()=>{Ps.getItem(vs.TasksHasSeenProjectDisclaimerBanner)||Ps.setItem(vs.TasksHasSeenProjectDisclaimerBanner,!0)},[]),e.jsx(ia,{icon:e.jsx(ni,{}),title:e.jsx(N,{id:"ibX3g7",defaultMessage:"Tasks can’t access project files"}),content:e.jsx(N,{id:"fm94Tm",defaultMessage:"There’s a task in this conversation — just FYI, it won’t be able to access project files."}),onDismiss:()=>{Ps.setItem(vs.TasksHasSeenProjectDisclaimerBanner,!0)}})}function Rm(){const{store:t}=ue(),s=t.useSharedProps(n=>n?.clientThreadId);return s?e.jsx(mc,{threadId:s}):null}function Im(){const{store:t}=ue(),s=t.useSharedProps();return s?e.jsx(pc,{...s}):null}function Bm(){const{store:t}=ue(),s=t.useSharedProps(o=>o?.clientThreadId),n=t.useSharedProps(o=>o?.composerController);return!s||!n?null:e.jsx(bm,{clientThreadId:s,composerController:n})}function Nm(){const{store:t}=ue(),s=t.useSharedProps(o=>o?.clientThreadId),n=t.useSharedProps(o=>o?.composerController);return!s||!n?null:e.jsx(xm,{clientThreadId:s})}function Lm({suggestions:t,composerController:s,onSelect:n,onChange:o}){const r=Ma(),i=p.useCallback((u,f,S,C)=>{if(f.onSelectOverride)return f.onSelectOverride(u,f,S,C);n?.(f,S,C),r(u,f,S,C)},[n,r]),[c,a]=p.useState(()=>t.length>0),[l,d]=p.useState(-1),[h,g]=p.useState(!1);return p.useEffect(()=>{const u=f=>{if(!f.isComposing)if(f.key==="ArrowDown"){const S=l===t.length-1?0:l+1;d(S),o?.(S,!0,t[S])}else if(f.key==="ArrowUp"){f.preventDefault();const S=l<=0?t.length-1:l-1;d(S),o?.(S,!0,t[S])}else f.key==="Enter"&&!f.shiftKey&&t[l]&&i(f,t[l],t,l)};return s.subscribe("keydown",u)},[t,l,o,i,s]),p.useEffect(()=>s.subscribe("blur",()=>{d(-1),a(!1),o?.(-1,!1)}),[s,o]),p.useEffect(()=>s.subscribe("focus",()=>a(!0)),[s]),p.useEffect(()=>{if(!h){const u=()=>{g(!0),window.removeEventListener("mousemove",u)};return window.addEventListener("mousemove",u),()=>{window.removeEventListener("mousemove",u)}}},[h]),p.useEffect(()=>{d(-1),o?.(-1,!1),g(!1)},[t,o]),e.jsx(fe.ul,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:ee("w-full flex-col p-2.5 max-sm:px-0",c?"flex":"hidden"),children:t.map((u,f)=>e.jsxs(fe.li,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:f*.03},exit:{opacity:0,translateY:4},className:"w-full",children:[f>0&&e.jsx("div",{className:ee("h-[1px] opacity-60 max-lg:hidden",l===f||l===f-1?"bg-token-main-surface-secondary mx-2":"bg-token-border-default")}),e.jsxs("button",{className:ee("flex w-full cursor-pointer items-center justify-start rounded-lg px-2.5 py-3 text-start whitespace-pre-wrap",l===f?"bg-token-main-surface-secondary":"bg-token-main-surface-primary"),onClick:S=>{S.preventDefault(),i(S,u,t,f)},onMouseDown:S=>{S.preventDefault()},onMouseEnter:()=>{h&&(d(f),o?.(f,!1,u))},onMouseLeave:()=>{d(-1),o?.(-1,!1,u)},children:[u.icon?e.jsx("span",{className:"text-token-text-secondary icon me-2 flex-none",children:u.icon}):null,e.jsx("span",{className:"text-sm whitespace-pre-wrap",children:u.autocompletionChunks&&u.autocompletionChunks.length>0?e.jsx(e.Fragment,{children:u.autocompletionChunks.map((S,C)=>e.jsx("span",{className:ee(S.className??(S.isMatched?"text-token-text-tertiary":"text-token-text-primary")),children:S.text},C))}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:ee(u.type===ce.Starter||u.type===ce.Trending?"text-token-text-secondary":"text-token-text-tertiary"),children:u.title}),e.jsx("span",{className:"text-token-text-primary",children:u.body})]})})]}),f>0&&e.jsx("div",{className:ee("h-[1px] opacity-60 lg:hidden",l===f||l===f-1?"bg-token-main-surface-secondary mx-2":"bg-token-border-default")})]},u.id??f))})}function Fm(t,s){t=t.toLocaleLowerCase();const n=s;s=s.toLocaleLowerCase();const o=[];let r=0;for(let a=0;a<s.length&&(r<t.length&&t[r]===s[a]&&(o.push(a),r++),r!==t.length);a++);const i=[];let c=0;if(o.forEach(a=>{if(a>c){const l=n.slice(c,a);l&&i.push({text:l,isMatched:!1})}i.push({text:n[a],isMatched:!0}),c=a+1}),c<s.length){const a=n.slice(c);a&&i.push({text:a,isMatched:!1})}return Dm(i)}function Dm(t){if(t.length===0)return t;const s=[t[0]];for(let o=1;o<t.length;o++){const r=s[s.length-1],i=t[o];r.isMatched===i.isMatched?r.text+=i.text:s.push(i)}const n=s.filter(o=>o.isMatched).reduce((o,r)=>o+r.text.trim().length,0);return s.length<=4&&n>=2?s:[{text:s.map(o=>o.text).join(""),isMatched:!1}]}async function Um(t=8,s=null){const n=await ri.safeGet("/prompt_library/",{parameters:{query:{limit:t,use_v2:!0,model_slug:s}},authOption:ii.SendIfAvailable});return Wo.addFirstTiming("load.promptStarters"),n}function Om(t=8,s=null){return Br({queryKey:["promptStarters",t,s],queryFn:()=>Um(t,s)})}function ko(t){return(fc(t)?t.promptStarters:t.gizmo.display.prompt_starters)?.map(s=>({type:ce.Starter,title:"",body:s,prompt:s}))}const Hm=()=>{const t=te(),s=oi(t),n=ma(),o=hc(xc),r=tt(t),i=r?s.getLayer("4031588851"):s.getLayer("3533083032"),c=r?s.getLayer("4031588851",{disableExposureLog:!0}):s.getLayer("3533083032",{disableExposureLog:!0});return r?n==null?!1:Date.now()/1e3-n.created<c.get("new-user-age-seconds",14*24*60*60)&&i.get("web-enable-for-new-users",!1):o<c.get("new-user-message-count",20)&&i.get("web-enable-for-new-users",!1)},Fa=({clientThreadId:t,limit:s,shouldBeEnabledForDefaultAssistant:n,isModelLoaded:o,modelSlug:r})=>{const i=Fe(),c=Go(),a=oe(),{clearAllSystemHintModeTriggers:l,setThreadSystemHintMode:d}=Jt(),h=J(t,y=>y?.mode),g=da(h?.kind===Xe.GizmoInteraction?h.gizmo_id:void 0).data,{gizmoEditorData:u,mode:f}=Ys(),S=Hm(),C=gc(h),k=et(),_=S&&n&&!C&&!k?.isEnterprisey(),{data:I,isSuccess:E}=Ir({...Om(s,r),enabled:_});if(c==null)return{promptStarters:[],isLoading:!0,isSuccess:!1};if(f==="test"&&u)return{promptStarters:ko(u)??[],isLoading:!1,isSuccess:!0};if(g!=null)return{promptStarters:ko(g),isLoading:!1,isSuccess:!0};if(!_)return{promptStarters:[],isLoading:!1,isSuccess:!0};const R=I?.items.map(y=>({type:ce.Starter,id:y.id,title:y.title,body:y.description,prompt:y.prompt,category:y.category,oneliner:y.oneliner,theme:y.theme,requires_file_upload:y.requires_file_upload}))??[],v=(y,L,D,K)=>{if(L.type===ce.Starter&&L.category==="dalle"){requestAnimationFrame(()=>{l(),d(F.PictureV2,!0,{}),i.focus()}),i.setAutocompletions(ja(a));return}const x=L.title;i.setAutocompletions([]),i.focus(),i.setText(x),requestAnimationFrame(()=>{const q=R.filter(O=>O.theme===L.theme).map(O=>{const Y=ai(O.oneliner),U=Y.startsWith(O.title);return{...O,title:U?`${O.title} `:"",body:U?O.body:Y,autocompletionChunks:Fm(x,Y),type:ce.Autocomplete}});i.setAutocompletions(q),q.length>0&&Us(q,t),Sc(L,K,t)})},P=R?.reduce((y,L)=>(L.theme&&!y[L.theme]&&(y[L.theme]=L),y),{}),b=[];if(P)for(const y in P)y!=="For you"&&b.push(P[y]);const w=b.length>0,j=!!(E&&w&&o);return Ye.markStart("StarterPromptChips",Ye.NS_COMPOSER),j&&Ye.markRendered("StarterPromptChips",Ye.NS_COMPOSER),{onSelectStarterPrompt:v,shouldShowStarterPrompts:j,promptStarters:b}};function Po({clientThreadId:t,onClick:s}){p.useEffect(()=>{Cc(t)},[t]);const n=oe();return e.jsx(fe.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},className:"inline-block",children:e.jsx(fa,{onClick:()=>{Ac(t),s()},label:n.formatMessage(qm.moreStarterPrompts)})})}function zm({starterPrompt:t,starterPrompts:s,index:n,disabled:o,onSelectStarterPrompt:r}){const i=t.theme??t.title,c=Ma(),{mutate:a}=bc(),l=t.category==="onboarding"?d=>{a({key:_e.hasUsedConversationalOnboardingStarterPrompt}),c(d,t,s,n)}:d=>r?.(d,t,s,n);return e.jsx(fa,{disabled:o,onClick:l,icon:e.jsx(yc,{category:t.category,useV2Colors:!0}),label:i})}const Gm=5,Wm=3;function Da({starterPrompts:t,onSelectStarterPrompt:s,disabled:n,clientThreadId:o,onExpand:r,mobileLayout:i=!1}){const c=i?Wm:Gm,[a,l]=p.useState(c),[d,h]=p.useState(!1),g=p.useRef(null),u=t.length<=a;p.useEffect(()=>{Us(t.slice(0,c),o)},[o]),p.useEffect(()=>{if(!d&&!u&&g.current){const S=g.current,C=S.getBoundingClientRect(),k=C.width,_=Array.from(S.children);let I=0;for(let E=0;E<_.length&&_[E].getBoundingClientRect().right-C.left<=k;E++)I++;l(I),h(!0)}},[t,u,d]);const f=()=>{const S=t.slice(a,t.length).map(C=>({...C,isAdditional:!0}));S.length>0&&Us(S,o),l(t.length),r()};return e.jsxs("div",{"data-testid":"starter-prompt-chips",className:ee("mt-5 flex items-center justify-center gap-x-2 transition-opacity xl:gap-x-2.5",d&&t.length>0?"opacity-100":"opacity-[0.01]",i?"flex-wrap":"flex-nowrap"),children:[e.jsxs("ul",{className:ee("relative flex items-stretch gap-x-2 gap-y-4 overflow-hidden py-2 sm:gap-y-2 xl:gap-x-2.5 xl:gap-y-2.5",u||i?"flex-wrap justify-center":"flex-nowrap justify-start"),ref:g,children:[t.slice(0,a).map((S,C)=>e.jsx(fe.li,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},children:e.jsx(zm,{starterPrompt:S,starterPrompts:t,index:C,disabled:n,onSelectStarterPrompt:s})},S.id??C)),i&&t.length>a&&e.jsx(Po,{clientThreadId:o,onClick:f})]}),!i&&t.length>a&&e.jsx(Po,{clientThreadId:o,onClick:f})]})}const Up=({clientThreadId:t,currentModelId:s,isModelLoaded:n})=>{const[o,r]=p.useState(!1),i=Xs(),{prospectiveModelId:c}=pa(t),a=n?s:c??"auto",{promptStarters:l,shouldShowStarterPrompts:d,onSelectStarterPrompt:h}=Fa({isModelLoaded:n,shouldBeEnabledForDefaultAssistant:!0,clientThreadId:t,limit:8,modelSlug:a});return e.jsx(fe.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:ee(!o&&"h-[116px]"),children:d&&l&&e.jsx(Da,{starterPrompts:l,onSelectStarterPrompt:h,disabled:i,clientThreadId:t,onExpand:()=>r(!0),mobileLayout:!0})})},Vm=({currentModelId:t,clientThreadId:s,isModelLoaded:n})=>{const{isUnauthenticated:o}=pt(),[r,i]=p.useState(!1),c=li(),a=Xs(),{prospectiveModelId:l}=pa(s),d=n?t:l??"auto",{promptStarters:h,shouldShowStarterPrompts:g,onSelectStarterPrompt:u}=Fa({isModelLoaded:n,shouldBeEnabledForDefaultAssistant:!0,clientThreadId:s,limit:8,modelSlug:d});return e.jsx(fe.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:ee("hidden min-h-[108px] max-w-full",c?"@lg/thread:block":"lg:block",o&&r?"":"h-[70px]"),children:g&&h&&e.jsx(Da,{starterPrompts:h,onSelectStarterPrompt:u,disabled:a,clientThreadId:s,onExpand:()=>i(!0)})})},qm=Le({moreStarterPrompts:{id:"SplashScreenV2.moreStarterPrompts",defaultMessage:"More"}}),Ua=Ro.div`group flex h-10 items-center gap-2 rounded-lg px-2 hover:bg-token-main-surface-secondary text-sm text-token-text-primary`;function Ym(){const{data:t,isLoading:s}=kc({cutId:"recent",limit:8}),{data:n,isLoading:o}=Pc();return{isLoading:s||o,recent:t,pinned:n}}function $m({query:t,onSelectGizmo:s,selectedIdx:n,currentModelId:o},r){const i=ci(),c=p.useRef([]),{isLoading:a,recent:l,pinned:d}=Ym();p.useImperativeHandle(r,()=>({handleEnterOnIndex:u=>{if(!g[u])return u<h.length?h[u].resource:"create"},getResultsLength:()=>h.length+1,scrollToItem:u=>{const f=c.current[u];f&&f.scrollIntoView({behavior:"instant",block:"nearest"})}}));let h=[];if(a)return e.jsx("div",{className:"absolute end-4 top-0 flex h-full items-center justify-center",children:e.jsx(ui,{})});l&&h.push(...l.pages.flatMap(u=>u.list.items).map(u=>({resource:u.resource,from:"recent"}))),d&&h.push(...d.items.map(u=>({resource:u,from:"pinned"}))),h=_c(h,u=>u.resource.gizmo.id);const g=h.map(u=>u.resource.gizmo.tags?.includes(Qt.WorkspaceDisabled));return t&&t!==""&&(h=h.filter(u=>(u.resource.gizmo.display.name.toLowerCase()+u.resource.gizmo.display.description?.toLowerCase()+u.resource.gizmo.author.display_name?.toLowerCase()).includes(t?.toLowerCase()))),e.jsxs("div",{className:"max-h-40 overflow-y-auto",children:[h.map((u,f)=>e.jsx("div",{ref:S=>{c.current[f]=S},tabIndex:f,onClick:()=>{g[f]||s(u.resource)},children:e.jsx(Qm,{gizmoResource:u.resource,from:u.from,showDescription:i,isSelected:n===f,grayedOut:g[f],currentModelId:o})},u.resource.gizmo.id)),e.jsx("div",{ref:u=>{c.current[h.length]=u},tabIndex:h.length,onClick:()=>{s("create")},children:e.jsx(Xm,{isSelected:n===h.length})},"create")]})}const Km=p.forwardRef($m),Xm=({isSelected:t})=>e.jsx(Ua,{className:t?"bg-token-main-surface-secondary":"",children:e.jsxs(Nr,{to:"/gpts/editor",target:"_blank",className:"flex flex-row space-x-2 font-semibold",children:[e.jsx("span",{className:"self-center",children:e.jsx(ha,{className:"icon-sm"})}),e.jsx("span",{children:e.jsx(N,{...sn.dropdownCreateLabel})})]})}),Jm=({onClick:t,onClose:s,currentModelId:n})=>{const[o,r]=p.useState(null),i=p.useRef(null),c=p.useRef(null),[a,l]=p.useState(0),d=oe(),h=g=>{M.logEvent("Mentions Click Gizmo",{gizmo_id:g==="create"?"create":g.gizmo.id}),g!=="create"&&t(g)};return e.jsxs(e.Fragment,{children:[e.jsx("input",{autoFocus:!0,placeholder:d.formatMessage(sn.searchPlaceholder),ref:i,onKeyDown:g=>{if(g.nativeEvent.isComposing)return;const u=c.current?.getResultsLength()??0;if((g.key==="Escape"||g.key==="Backspace"&&!o)&&(g.preventDefault(),s()),g.key==="Enter"||g.key==="Tab"){g.preventDefault();const f=c.current?.handleEnterOnIndex(a);if(!f)return;f==="create"?(window.open("/gpts/editor","_blank"),s()):h(f)}if(g.key==="ArrowDown"&&a<u-1){g.preventDefault();const f=a+1;c.current?.scrollToItem(f),l(f)}if(g.key==="ArrowUp"&&a>0){g.preventDefault();const f=a-1;c.current?.scrollToItem(f),l(f)}},onChange:g=>{r(g.target.value),l(0)},className:"bg-token-main-surface-primary w-full border-0 p-2 text-sm focus:outline-hidden"}),e.jsx(Km,{ref:c,query:o,selectedIdx:a,onSelectGizmo:h,currentModelId:n})]})},vo=({onClick:t,onClose:s,currentModelId:n})=>{const o=Vo(),r=!!o;return en(()=>{M.logEvent("Mentions Opened",{gizmo_selector_disabled:r})}),r?e.jsx(Ia,{clientThreadId:Ns,rateLimitInfo:o}):e.jsx("div",{onBlur:i=>{i.currentTarget.contains(i.relatedTarget)||s()},className:"popover border-token-border-default bg-token-main-surface-primary rounded-2xl border p-2 shadow-lg",children:e.jsx(Jm,{onClick:t,onClose:s,currentModelId:n})})};function Qm({gizmoResource:t,from:s,showDescription:n,isSelected:o,grayedOut:r,currentModelId:i}){const c=!!t.gizmo.tags?.includes(Qt.FirstParty),a=vc(t.tools)&&!i.startsWith("gpt-4o")&&!i.startsWith("gpt-4-1");return e.jsxs(Ua,{className:ee(o?"bg-token-main-surface-secondary":"",r&&"opacity-50"),children:[e.jsx(ga,{isFirstParty:c,src:t.gizmo.display.profile_picture_url,className:ee("icon-xl",r&&"grayscale group-hover:grayscale-0")}),e.jsxs("div",{className:"flex h-fit grow flex-row justify-between space-x-2 overflow-hidden text-ellipsis whitespace-nowrap",children:[e.jsxs("div",{className:"flex flex-row space-x-2",children:[e.jsx("span",{className:"shrink-0 truncate font-semibold",children:t.gizmo.display.name}),a&&e.jsx("span",{className:"text-token-text-tertiary shrink-0",children:e.jsx(N,{...sn.customActionsModelNote})}),n&&e.jsx("span",{className:"text-token-text-tertiary grow truncate text-sm sm:max-w-xs lg:max-w-md",children:t.gizmo.display.description})]}),e.jsx("span",{className:"shrink-0 self-center",children:s==="recent"?e.jsx(Mc,{className:"icon-sm"}):e.jsx(wc,{className:"icon-sm"})})]})]})}const sn=Le({talkingTo:{id:"TaggingDropdown.talkingTo",defaultMessage:"Talking to"},dropdownCreateLabel:{id:"TaggingDropdown.dropdownCreateLabel",defaultMessage:"Create a GPT"},searchPlaceholder:{id:"TaggingDropdown.searchPlaceholder",defaultMessage:"Search recent and pinned GPTs"},customActionsModelNote:{id:"TaggingDropdown.customActionsModelNote",defaultMessage:"[GPT-4o or GPT-4.1]"}});function Zm(t){if(t.length!==1)return!1;const{file:s,fileId:n}=t[0],o=Ic(s)&&!!s?.type&&s.type.startsWith("image/"),r=n!=null&&!!s&&mi(s.name);return o||r}function Oa({files:t,selectedApps:s=[],className:n,activeSystemHintType:o}){const r=di(),i=Gs(),c=xa.useStore(),{updateSystemHint:a}=Jt(),{clientThreadId:l}=el(),d=Zm(t),h=d&&o!==F.PictureV2,g=jc();return e.jsxs("div",{className:n,children:[g.map(u=>e.jsx(Tc,{textdocId:u.tempTextdocId,userCreatedTextdoc:u},u.tempTextdocId)),s.map(u=>e.jsx(Ec,{selectedApp:u},u.id)),t.map(u=>e.jsx(Rc,{borderRadius:"2xl",width:r?"normal":"wide",onRemoveFileClick:()=>{ct.remove(i,u.tempId,"none"),c.removeFile(u.tempId)},useLargeImageThumbnailStyle:d,onImageEditClick:h?()=>{a(F.PictureV2,{clientThreadId:l})}:void 0,file:u.file,fileId:u.fileId??void 0,contextConnectorInfo:u.contextConnectorInfo,loadingPercentage:u.status===qo.Uploading?u.progress:void 0},u.tempId))]})}const ep=5,tp=p.memo(function(s){return sp(s),np(s),op(),null});function sp(t){const{store:s}=ue(),n=s.useSetSharedProps();Ls(()=>{n(t)},[t,n])}function np(t){const{clientThreadId:s,canContinue:n}=t,{store:o}=ue(),r=p.useRef({top:o.useContentAreaApi(Je.HeaderTop),bottom:o.useContentAreaApi(Je.HeaderBottom)}).current,i=Bc(s),{shouldShowBannerSignup:c,shouldShowBannerTermsDisclaimer:a}=ap(s),l=Cm(s,t.composerController),d=Sm(s),h=Nc(t);Lc(t);const g=Fc(),u=Dc(),f=Uc(t),S=Oc(s),C=Hc(t),k=zc(s),_=Gc(s),I=Vd(),{eligible:E}=Ee(Wc),R=Vc(),v=qc(),P=Yc(),b=$c(),w=Kc(s),j=Xc(s),y=Jc(),L=Qc(s),D=Zc(se=>se.shouldShowAudioParagenPrompt),K=J(s,se=>se?.modelId),x=Zs(s),q=ft(),O=Sa(),{eligible:Y}=Ee(_e.hasSeenAgentModeAnnouncementBanner),U=Y&&O&&q!==zt;Ls(()=>{D?r.top.set(A.AudioParagenPrompt):K&&x?.kind===Xe.GizmoInteraction&&x.gizmo&&pi(K,x.gizmo)?r.top.set(A.ProjectConversationTaskNoFileAccess):C.eligible?r.top.set(A.AdvancedVoiceOnMobileAnnouncement):a?r.top.set(A.BannerTermsDisclaimer):l?r.top.set(A.BannersRateLimit):d?r.top.set(A.BannersBeaconUI):y?r.top.set(A.BannerPlusUpsell):k?r.top.set(A.JawboneAnnouncement):_?r.top.set(A.JawboneMaxActiveAnnouncement):h.eligible?r.top.set(A.BannerSidekickAnnouncement):g?r.top.set(A.MoonshineAnnouncement):u?r.top.set(A.CustomizeChatGPTAnnouncement):f?r.top.set(A.SearchBrowserExtensionReactiveAnnouncement):I?r.top.set(A.PromoRedemptionAnnouncement):E?r.top.set(A.OperatorAnnouncement):P?r.top.set(A.ReferralProgramUpsellAnnouncement):n?r.top.set(A.PromptTextareaAction):c?r.top.set(A.BannerSignup):S?r.top.set(A.BannerMemoryFull):R?r.top.set(A.ReferrerRedemptionAvailableAnnouncement):v?r.top.set(A.RefereeRedemptionAvailableAnnouncement):b?r.top.set(A.StudentsUpsellAnnouncement):w?r.top.set(A.ModelDeprecationBanner):j?r.top.set(A.TeamsContextualAnswersUpsell):L?r.top.set(A.LanguageUpsellBanner):U?r.top.set(A.AgentModeAnnouncementBanner):r.top.set(null)},[r,q,n,a,c,l,h,S,C,U]),Ls(()=>{i&&r.bottom.set(ua.DallePromptControls)},[r,i])}function op(){const{store:t}=ue();p.useEffect(()=>()=>{t.reset()},[t])}function ap(t){const s=te(),{isUnauthenticated:n}=pt(),o=Ce(s,"3637408529",{disableExposureLog:!0}),i=Ce(s,"3637408529").get("no_auth_banner_signup_rate_limit",ep),c=o.get("should_show_no_auth_signup_banner",!0),a=eu(u=>u.bannerDisclaimerClientThreadId),l=tu(),d={shouldShowBannerTermsDisclaimer:!1,shouldShowBannerSignup:!1},[h,g]=J(t,u=>[W.getConversationTurns(u).filter(f=>f.role===Yo.User).length,rp(W.getCurrentNode(u)?.message)]);return t&&(d.shouldShowBannerTermsDisclaimer=g&&n&&h===1&&!l&&(a==null||a===t),d.shouldShowBannerSignup=c&&g&&n&&h>0&&h%i===0),d}function rp(t){return t?.author.role===Yo.Assistant&&fi(t)}function ip({clientThreadId:t,icon:s,modelSupportedImageMimeTypes:n,isLoadingConnectors:o,connectorConfig:r,onSelectConnector:i,onConnectorOauthRedirect:c,openFileDialog:a,isDisabled:l=!1,highlightTooltip:d=!1,showLabel:h,disabledReason:g,currentModelName:u}){const f=oe(),S=Yt(),[C,k]=p.useState(!1),_=p.useRef(!1),I=Qe(Ze),E=y=>{if(!y&&_.current&&!o)a();else if(y&&!o&&r.size===0&&R.length===0){a();return}k(y),y&&(M.logEventWithStatsig("Composer: Open Plus Menu","chatgpt_web_composer_plus_menu_open"),_.current=!0,setTimeout(()=>{_.current=!1},250))},{desktopConnectors:R}=ba(n),v=n.length>0,P=e.jsxs(e.Fragment,{children:[I&&e.jsx(ya,{}),e.jsx(Ca,{isLoadingConnectors:o,connectorConfig:r,onConnectorClick:i,onOauthRedirect:c}),e.jsx(Ha,{modelSupportedImageMimeTypes:n}),e.jsx(tn,{openFileDialog:a,showMenuForNoAuth:!1,modelSupportsImages:v})]}),b=l||S!=null,w=p.useRef(!1),j=e.jsxs(ae.Root,{open:C,onOpenChange:E,children:[e.jsx(Wt,{clientThreadId:t,rateLimitPopup:S,highlightTooltip:d,disabled:b,disabledReason:g,currentModelName:u,children:e.jsxs(ae.BasicTrigger,{className:"composer-btn",disabled:b,id:"upload-file-btn","aria-label":Zt(f,b,g,u),children:[s,h&&e.jsx(na,{})]})}),e.jsx(ae.Portal,{children:e.jsx(ae.Content,{alignOffset:-8,onEscapeKeyDown:()=>{w.current=!0},side:"bottom",size:"small",onCloseAutoFocus:y=>{w.current||y.preventDefault()},className:"radix-side-bottom:flex-col-reverse flex flex-col",children:P})})]});return e.jsx("div",{className:"flex flex-col",children:j})}const Ha=({modelSupportedImageMimeTypes:t})=>$o()?e.jsx(lp,{modelSupportedImageMimeTypes:t}):null,lp=({modelSupportedImageMimeTypes:t})=>{const{desktopConnectors:s}=ba(t);return e.jsx(e.Fragment,{children:s.map(n=>e.jsx(su,{entry:n},n.key))})},cp=({command:t,isHighlighted:s,onHighlight:n,onClick:o})=>e.jsx(Xo,{as:"div",hasManagedFocus:!0,disabled:t.disabled,highlighted:s,icon:t.icon,label:t.title,onPointerMove:n,onClick:o}),up=t=>{"use forget";const s=Lr.c(15),{hint:n,isHighlighted:o,onHighlight:r,onClick:i}=t,c=Aa(n.systemHint);let a;s[0]!==n?(a=e.jsx(au,{hint:n,isNextToLabel:!0}),s[0]=n,s[1]=a):a=s[1];let l;s[2]!==n.name||s[3]!==o||s[4]!==i||s[5]!==r||s[6]!==c.blockedLabel||s[7]!==c.isBlocked||s[8]!==a?(l=e.jsx(Xo,{as:"div",hasManagedFocus:!0,disabled:c.isBlocked,highlighted:o,icon:a,label:n.name,secondary:c.blockedLabel,onPointerMove:r,onClick:i}),s[2]=n.name,s[3]=o,s[4]=i,s[5]=r,s[6]=c.blockedLabel,s[7]=c.isBlocked,s[8]=a,s[9]=l):l=s[9];const d=l;if(c.remainingLabel){const h=c.isBlocked?"left":"center";let g;return s[10]!==d||s[11]!==c.remainingLabel||s[12]!==c.remainingLabelSecondary||s[13]!==h?(g=e.jsx(Os,{side:"right",labelTextAlign:h,label:c.remainingLabel,secondaryLabel:c.remainingLabelSecondary,contentClassName:"cant-hover:hidden",triggerAs:null,children:d}),s[10]=d,s[11]=c.remainingLabel,s[12]=c.remainingLabelSecondary,s[13]=h,s[14]=g):g=s[14],g}return d},dp=({slashCommands:t,systemHints:s,composerController:n,clientThreadId:o})=>{const r=p.useMemo(()=>[...t,...s],[t,s]),i=nu(),c=Ko(o),{setThreadSystemHintMode:a,clearAllSystemHintModeTriggers:l}=Jt(),[d,h]=p.useState(void 0),[g,u]=p.useState(0),f=p.useMemo(()=>d?r.filter(b=>!!("systemHint"in b&&qe(b.systemHint,d.text)||"command"in b&&qe(b.command,d.text)||b.aliases?.some(w=>qe(w,d.text))||b.regexMatches?.some(w=>qe(w.replace(/[\^$()]/g,""),d.text))||"name"in b&&qe(b.name,d.text)||"title"in b&&qe(b.title,d.text))):[],[r,d]);p.useEffect(()=>{n.view.dispatch(tl(n.view.state.tr,{onHintMatch(b){h(w=>hi(w,b)?w:b)}}))},[n]);const S=p.useCallback(b=>{u(w=>{const j=f.length;for(let y=0;y<j;y++){const L=(w+j+(y+1)*b)%j,D=f[L];if(!("systemHint"in D?i.includes(D.systemHint):D.disabled))return L}return-1})},[f,i]),C=p.useRef(S);C.current=S;const k=f.length===0;p.useEffect(()=>{u(-1),C.current(1)},[f]);const _=f[g],I=p.useCallback(()=>{d?.range&&n.delete(d.range.from,d.range.to)},[d,n]),E=({hintToSave:b=_,expectPerfectMatch:w})=>{if(!d||!_)return!1;const j=d.text.toLocaleLowerCase();if(w&&("command"in b?b.command.toLocaleLowerCase()!==j:b.name.toLocaleLowerCase()!==j)&&b.aliases?.every(D=>D.toLocaleLowerCase()!==j))return!1;if(I(),Ot(n.view),"command"in b)return b.onSelect(),!0;M.logEvent("System Hint Selected",{system_hint:b.systemHint,conversation_id:c??Ns});const y={clientThreadId:o};l();const L=b.systemHint===F.Search;return a(b.systemHint,!0,y,L?ou.CONVERSATION_COMPOSER_SLASH_SEARCH:void 0),!0},R=p.useRef(E);R.current=E;const v=p.useRef(d);v.current=d;const P=n.view;return p.useEffect(()=>(k||em(P,b=>{if(b==="up")C.current(-1);else if(b==="down")C.current(1);else if(b==="cancel")Ot(P),sl(P);else{if(b==="submit")return Ot(P),R.current({expectPerfectMatch:!1});if(b==="checkMatch")return R.current({expectPerfectMatch:!0})}}),()=>Ot(P)),[k,P,_,I]),p.useEffect(()=>{k||M.logEvent("System Hint List Opened",{conversation_id:c??Ns})},[k]),k?null:e.jsx(gi,{className:"max-w-60",onPointerDown:b=>{b.preventDefault()},children:f.map((b,w)=>"command"in b?e.jsx(cp,{command:b,isHighlighted:w===g,onHighlight:()=>u(w),onClick:()=>{E({hintToSave:b,expectPerfectMatch:!1}),n.focus()}},b.command):e.jsx(up,{hint:b,isHighlighted:w===g,onHighlight:()=>u(w),onClick:()=>{E({hintToSave:b,expectPerfectMatch:!1}),n.focus()}},b.systemHint))})};function Mo({slashCommands:t,systemHints:s,composerController:n,clientThreadId:o}){return n instanceof Zd?e.jsx(dp,{slashCommands:t,systemHints:s,composerController:n,clientThreadId:o}):null}function qe(t,s){return t.toLocaleLowerCase().startsWith(s.toLocaleLowerCase())}function mp({clientThreadId:t,modelSupportedImageMimeTypes:s,openFileDialog:n,historyDisabled:o,isDisabled:r,highlightTooltip:i,disabledReason:c,currentModelName:a,isLoadingConnectors:l,connectorConfig:d,onSelectConnector:h,onConnectorOauthRedirect:g,showLabel:u,showUpsell:f,hideBorder:S,isSmall:C,showMenuForNoAuth:k,visualTreatment:_}){const I=$o(),{gdriveStatus:E,o365Status:R}=xi(),{isUnauthenticated:v}=pt(),P=o?"text-white":i?"text-brand-blue-800":"",b=!f&&(E!=="false"||R!=="false"||I),w=v?Ds:ha,j=e.jsx(w,{"aria-label":"",className:ee("icon",P)}),y=s.length>0,L=b?e.jsx(ip,{clientThreadId:t,icon:j,showLabel:v&&u,modelSupportedImageMimeTypes:s,isLoadingConnectors:l,connectorConfig:d,onSelectConnector:h,onConnectorOauthRedirect:g,openFileDialog:n,isDisabled:r,highlightTooltip:i,disabledReason:c,currentModelName:a}):e.jsx(dm,{isSmall:C,hideBorder:S,clientThreadId:t,openFileDialog:n,showLabel:u,showUpsell:f,icon:j,isDisabled:r,highlightTooltip:i,disabledReason:c,currentModelName:a,visualTreatment:_,showMenuForNoAuth:k,modelSupportsImages:y});return e.jsx(ru,{showBackground:i,className:"bg-brand-blue-800/20",children:L})}const pp=({layoutMode:t,clientThreadId:s,composerController:n,pendingFiles:o,hasFiles:r,placeholder:i,isTemporaryChat:c,state:a,inputState:l,disableReason:d,gizmoId:h,replyRegions:g,includeSidebarContextTray:u,onSubmit:f,leadingAction:S,legacyFooterActions:C,legacySuggestionsPopoverContent:k,activeSystemHint:_,hideSystemHint:I=!1,onRemoveSystemHint:E,contextualAnswerUserConnectionData:R,fileInput:v,expanded:P,expandOnMultilineInput:b})=>{const w=Qe(Ze),j=Do(s),y=p.useCallback(V=>e.jsx(iu,{inputState:l,state:a,onSubmit:f,composerController:n,clientThreadId:s,gizmoId:h,disableReason:d,disableTooltip:V}),[l,a,f,n,s,h,d]),{whisperControls:L,waveContainerRef:D}=Xd({composerController:n,renderInComposer:y,composerType:"composer-btn",isBridgedDesktopSidebar:w}),{controlsDisabled:K,waveformData:x,waveWidth:q}=Ke(n.store),O=_a(V=>V.selectedApps),Y=ka()&&O.length>0,U=r||Y,{fontSize:se}=Qs();return e.jsxs(lu,{isTemporaryChat:c,composerController:n,expanded:P,expandOnMultilineInput:b,onSubmit:f,layoutMode:t,backgroundClassName:w?"text-sm px-2 shadow-none! dark:border-token-border-heavy border-t border-gray-100 rounded-none":void 0,children:[e.jsx(cu,{children:K?x?e.jsx("div",{className:"max-w-full min-w-0 flex-1",ref:D,children:e.jsx(uu,{className:"h-14",waveform:x,containerWidth:q,scaleFactor:10,initialValue:Jd})}):null:e.jsx(Qd,{composerController:n,placeholder:i,fontSize:se})}),v&&e.jsx(du,{children:v}),g&&g.length>0&&e.jsx(ws,{children:e.jsx(mu,{replyRegions:g})}),U&&e.jsx(ws,{children:e.jsx(Oa,{files:o,selectedApps:O,activeSystemHintType:_?.systemHint,className:"no-scrollbar horizontal-scroll-fade-mask flex flex-nowrap gap-2 overflow-x-auto px-2.5 pt-2.5 pb-1.5 [--edge-fade-distance:1rem]"})}),u&&e.jsx(ws,{children:e.jsx(pu,{})}),S&&e.jsx(fu,{children:S}),C?.map((V,ge)=>e.jsx(js,{children:V},`legacy-footer-action-${ge}`)),_&&!I&&e.jsx(gu,{children:e.jsx(hu,{activeSystemHint:_,onRemoveSystemHint:E})},"active-hint-tag"),_&&j&&e.jsx(js,{children:e.jsx(xu,{activeSystemHint:_??void 0,clientThreadId:s,connectionStatuses:R?.connection_statuses,currentModelConfig:j})},"sources-tag"),_?.systemHint===F.PictureV2&&e.jsx(js,{children:e.jsx(Su,{composerController:n})},"image-style-picker"),!1,e.jsx(bu,{children:k},"legacy-suggestions-popover"),e.jsx(yu,{children:L})]})},fp=$s(()=>Ks(()=>import("./nbdb3tjxtvfmkqtk.js"),__vite__mapDeps([8,1,3,4,2,5,9,10,11])).then(t=>t.ImageGenComposer)),gp=1,hp=3e3;function xp({onCreateNewCompletion:t,onContinueGenerating:s,account:n,currentModelId:o,currentModelConfig:r,disableDraftPersistence:i=!1,areModelsLoading:c,clientThreadId:a,isNewThread:l,isCompletionInProgress:d,className:h,disabled:g=!1,disabledReason:u,canPause:f=!1,canContinue:S=!1,isInteractableSharedThread:C,onComposerInput:k,onComposerChange:_,onAutocompleteSelect:I,headerClassName:E,hideHeader:R,onTaggingDropdownOpen:v,onTaggingDropdownClose:P,onlyAllowImageUploads:b,layoutMode:w}){"use forget";Ye.markStart("PromptTextarea"),Ye.markRendered("PromptTextarea");const j=Qe(Ze),y=te(),L=p.useRef(null),[D,K]=Fr();p.useEffect(()=>{D.has("show_github_repo_modal")&&(Jo(y,Cu),K(m=>(m.delete("show_github_repo_modal"),m)))},[D,K,y]);const x=Fe();Au(x),_u();const q=ma(),O=n?.isTeam(),Y=tt(y),U=oe(),se=$t(),V=Gs(),ge=xa.useStore(),[B,$,ne,De,Re,gt]=J(a,m=>[W.getCurrentLeafId(m),W.getRequestId(m),W.findNode(m,T=>!!T.message.metadata?.b1de6e2_s),W.getIsNewConversation(m),W.lastUserMessage(m)?.metadata?.system_hints?.includes(F.Agent),!!m?.interruptionInProgress&&!!W.getCurrentNode(m)?.message.metadata?.n7jupd_message]),{gizmoEditorData:he,mode:Ue,getGizmoId:Oe}=Ys(),xe=Go(),st=Si(),za=ku(),Se=Ko(a),es=!!Vo(),Ga=Pu.useIsEnabled(a),ht=!!Xs(),H=ft(),be=jo(),Wa=Sa(),Va=Ee(_e.hasSeenAgentModeAnnouncementBanner),nn=bi.useState(({locked:m})=>m),qa=yi(),{connectionInstanceData:ts,isLoading:Ya}=Ci({skip:!qa}),{selectedSources:on,selectedMCPSources:xt,addSource:St}=vu(a);p.useEffect(()=>{const m=D.get("add_source");m&&H&&(St(m),D.delete("add_source"),K(D))},[H,St,D,K]);const an=Mu(y);Ai({skip:!an,productSku:uo.PROMPT_TEXT_AREA});const{platformConnectors:rn}=Qo(an&&(xt?.size??0)>0,uo.PROMPT_TEXT_AREA),$a=p.useMemo(()=>Array.from(xt??[]).map(m=>rn.get(m)).filter(m=>m!==void 0),[rn,xt]),ss=p.useRef(0),ns=p.useRef(!1);let z=Zs(a),bt=z&&"gizmo"in z?z.gizmo:void 0;const Ka=_i(),yt=bt?.gizmo.id??Ka,os=wu(yt),Xa=ju(),ln=Tu(a),[de,Ct]=p.useState(null);de!==null&&(z={gizmo:de,gizmo_id:de.gizmo.id,kind:Xe.GizmoInteraction},bt=de);const He=Rs(r,z,H),as=Yt(),cn=zs(y).flags,At=cn?.includes(Ws.NoAuthEnableFileUploads),rs=J(a,m=>m?.effortMode??null),un=!!rs&&rs!=="default",{systemHints:dn}=ki(),mn=De||Re,re=p.useMemo(()=>dn?.filter(m=>Eu({systemHint:m,modelConfig:r,conversationMode:z,isTemporaryChat:st}))?.filter(m=>m.systemHint!==F.Agent?!0:mn),[dn,r,z,st,mn]),Ja=re==null||re.length>0,ke=p.useMemo(()=>(H&&re?.find(m=>m.systemHint===H))??null,[re,H]),is=p.useCallback(()=>{be(null,{analyticsMetadata:{clientThreadId:a}})},[be,a]),ls=Ru(o,ke?.systemHint??null);Iu(p.useCallback(()=>{un&&je(a,m=>{m.effortMode="default"})},[un,a])),tm({serverThreadId:Se,clientThreadId:a,composerController:x,currentModelId:o,account:n,getIsDisabled:p.useCallback(()=>!1,[]),onReset:()=>{je(a,m=>{m.effortMode="default"})},onInfer:m=>{je(a,T=>{T.effortMode=m})},isInferEnabledForModel:r?.enableInfer});const Qa=!g&&(He!==Be.None||c)&&(Y||At),me=Bs(r,z),cs=Lo(r,z);let ie=Is(m=>m.files);const[_t]=p.useState(()=>Bu());Ue==="magic"?ie=ie.filter(m=>m.gizmoId!=null):ie=ie.filter(m=>m.gizmoId==null);const Za=Nu(),ze=ie.length>0||Za,pn=Is(Hi.hasUploadInProgress),fn=_a(m=>m.selectedApps),er=ka()&&fn.length>0,tr=Lu(a),us=x.useState(m=>Fu({currentModelConfig:r,composerController:m})),gn=ut(x.isEmpty$),hn=!gn,kt=!us&&!pn&&(hn||ze),xn=(He===Be.Multimodal?Vs:qs)-ie.length,Sn=xn<=0,sr=ke?.systemHint===F.Research,nr=ye(y,"3544641259"),{selectedRepos:ds}=Du(a),bn=(sr||ls)&&nr&&on?.size===0&&xt?.size===0,ms=ye(y,"2007855518"),yn=ne?.message.metadata?.async_task_id,ps=Uu(m=>yn?m.tasks[yn]:null),fs=ps?.status===Ou.RUNNING,Cn=Hu(Ft(a)||a)?.value,or=Cn===mo.STREAMING,ar=Cn===mo.REALTIME,Pt=d&&f||or||ar||fs&&ms,Ge=kt&&!g&&!ht&&(!Pt||ln)&&!bn,[An,rr]=p.useState(!1),{targetedContent:_n,setTargetedContent:vt}=zu(),le=_n?.isFocusedViewContent&&!za?void 0:_n;p.useEffect(()=>{!le||Ss.composer.autofocusDisabled$()||requestAnimationFrame(()=>requestAnimationFrame(()=>x.focus()))},[le]);const{getUpsellLabelType:ir,getUpsellShowsAttach:lr}=Gu(),{isToolsInPlusMenu:kn,showConnectedApps:Pn,isSingleLine:vn,hasAddFileSlashCommand:Mn}=Qs(),nt=Ja&&!nn&&(z==null||z?.kind===Xe.PrimaryAssistant||z?.kind===Xe.GizmoInteraction&&os),cr=nt&&Y&&(!O||!Ya)&&!po(H)&&!kn,Mt=Ke(x.store,m=>m.controlsDisabled);p.useEffect(()=>{if(!q?.id)return;const m=ho.getAndReset(q.id,Se);m&&x.setText(m.inputText)},[q?.id,Se,x]),p.useEffect(()=>{const m=D.get("prompt")??"";x.getCurrentText().length===0&&m.length>0&&x.setText(m)},[x,D]),p.useEffect(()=>{if(H!==F.Slurm)return;const m=D.getAll("sources");if(!m.length)return;const T=D.get("redirect_source"),G=m.map(Q=>Q.trim()).filter(vi);for(const Q of G)St(Q);T==="suggested_ca_prompts"&&M.logEventWithStatsig("chatgpt_contextual_answers_connector_activated","chatgpt_contextual_answers_connector_activated",{source:"suggested_ca_prompts"})},[a,St,D,be,K,H]),p.useEffect(()=>{An!==Ge&&(rr(Ge),Ge&&Wu(!0).then(m=>{Vu.startEnforcement(m),qu.startEnforcement(m)}))},[Ge,An,z?.kind,xe]);const wt=Bo(r,z),{handleFileAccepted:wn}=Ra(U,Rs(r,z,H),me,"mouse",Oe,wt?.attachments),ur=p.useCallback((m,T)=>(requestAnimationFrame(()=>{requestAnimationFrame(()=>{x.focus()})}),wn(m,T)),[x,wn]),pe=!g&&!Sn&&Qa&&as==null,{getInputProps:jn,open:Tn,inputRef:En}=wa({disabled:!pe,noClick:!0,onDropAccepted:ur,onDropRejected:m=>Ea(m,U,se,He),multiple:!0,maxSize:Fo,maxFiles:xn,...No(!Y||b?me:cs)}),Ie=p.useCallback(()=>{pe&&(M.logEventWithStatsig("Open File Viewer","chatgpt_web_file_viewer_opened",{intent:He.toString()}),Tn())},[pe,Tn,He]),Rn=Ke(_t),In=p.useCallback(()=>{x.eraseContent(),Rn.clearMessages(),x.resize(gp),x.usedDictation=!1,x.dictationEdited=!1,x.dictationAssetPointer=null,x.dictationAssetTTL=null;for(const T of ie)ct.remove(V,T.tempId,"none");if(Yu.markAllAsSent(),To(y)){const T=Mi(y,"269676899"),G=T.get("skip_search",!1);if(T.get("clear_all",!1)){const ve=[F.Slurm,F.Tatertot];G&&ve.push(F.Search),ve.push(zt),H&&!ve.includes(H)&&be(null)}}},[x,Rn,y,ie,V,H,be]),Bn=ut(Gt.sidebarUrlTrayOpen$)&&j,dr=ut(Gt.context$),Nn=(m,T)=>{if(m.preventDefault(),g||!kt&&!T||!z||gt)return;const G=x.getContentToSend(),Q=Pd(G.content),{content:ve,attachments:Rr}=vd(V,Q,r,z,H);je(a,Lt=>{Lt.hasModifiedSources=!1}),Xa(),t({sourceEvent:m,attachments:Rr,content:ve,contentToSend:G,conversationMode:z,hasSelectedApps:er,isMessageFollowupsEnabled:Ga,selectedApps:fn,isBridgedDesktopSidebar:j,shouldCollectSidebarContext:Bn,desktopSidebarContext:dr,selectedGizmoTag:de,selectedRepos:{selectedAllRepos:ds.selectedAllRepos,selectedRepos:ds.selectedRepos?[...ds.selectedRepos]:null},selectedSources:on,selectedMCPConnectors:$a,systemHints:H?[H]:[],usedDictation:x.usedDictation,dictationEdited:x.dictationEdited,dictationAssetPointer:x.dictationAssetPointer,dictationAssetTTL:x.dictationAssetTTL,effortMode:rs,isN7jupdActive:ls}),le?.onCreateCompletion?.({serverThreadId:Se,currentLeafId:B}),le?.shouldPersistAcrossMessages!==!0&&vt(void 0),Fs.hideThreadHeader();for(const Lt of ie)Lt.status===qo.Ready&&ge.addFile(Lt);In(),Wa&&H===zt&&Va.markAsViewed()},mr=m=>{vt(m.targetedReply),m.targetedReply&&M.logEventWithStatsig("Targeted Reply Button Clicked","chatgpt_targeted_reply_button_clicked",{conversationId:Se,sourceMessageId:m.messageId})},{maybeSetWaitingForRealtimeOnAbort:Ln,isWatingForRealtimeStatusChange:pr}=$u(a),gs=p.useCallback(m=>{Ln(),Ku(m,void 0,!0)},[Ln]),Fn=p.useCallback(()=>{le?.onCleared?.({serverThreadId:Se,currentLeafId:B}),vt(void 0),x.focus()},[B,Se,le,vt,x]),jt=Xu(r?.tags,z?.kind),{showTaggingDropdown:hs,isFocused:fr,autocompletions:Pe}=Ke(x.store),Tt=fr&&Pe.length>0,We=jt&&hs&&!os&&!j,Dn=sm(a),Un=x.isReady();p.useEffect(()=>x.subscribe("keydown",m=>{Dn&&nm(a);const T=x.getCurrentText();if(m.key==="@"&&!j){const G=x.getSelectionStart(),Q=T.substring(0,G);(!Q||/\s$/.test(Q)||G===0)&&setTimeout(()=>x.setShowTaggingDropdown(!0),10)}else hs&&x.setShowTaggingDropdown(!1);m.key==="Escape"&&Ct(null)}),[x,Un,hs,Dn,a,j]);const On=Ju({toaster:se,canSubmit:Ge,isTextContentTooLong:us,canAbortCompletion:f&&d,clientThreadId:a,isAutocompletionActive:()=>Tt&&ns.current,clearAutocompletions:()=>x.setAutocompletions([]),abortCompletion:()=>gs(a),requestCompletion:Nn,isEmpty:gn,hasTargetedContent:le!=null,clearTargetedContent:Fn,hasSystemHint:ke!=null,removeSystemHint:is}),xs=p.useRef(On);xs.current=On,p.useEffect(()=>{const m=Object.fromEntries(Object.keys(xs.current).map(T=>[T,Q=>{const ve=xs.current[T];return ve?ve(Q):!1}]));x.registerKeyHandlers(m),x.registerFileInput({openFileDialog:Ie,inputRef:En})},[x,Ie,En,Un]),p.useEffect(()=>x.subscribe("paste",m=>{Qu({filePickerStore:V,event:m,intl:U,toaster:se,clientThreadId:a,conversationMode:z,currentModelConfig:r,getEditorGizmoId:Oe,modelSupportedImageMimeTypes:me,activeSystemHintType:H,setActiveSystemHintType:be,ctx:y})}),[U,a,z,r,Oe,me,x,se,V,H,be,y]);const Hn=m=>{es||Ct(m),x.trimLeadingText("@"),xo(),x.setShowTaggingDropdown(!1)},gr=wi(a,_t,me,wt?.attachments),hr=p.useCallback(m=>{m.preventDefault(),gs(a),M.logEventWithStatsig("Pause Completion","chatgpt_pause_completion",{threadId:Ft(a),currentLeafId:W.getCurrentNode(Te(a)).message.id,eventSource:"mouse"}),xo()},[a,gs]),Et=p.useCallback(()=>{ho.set(q?.id,Se,x.getCurrentText())},[Se,q?.id,x]),Ss=Pi(y);p.useEffect(()=>{he||Ss.composer.autofocusDisabled$()||x.focus()},[x]),p.useEffect(()=>{if(me.length>0)for(const T of ie)Zu(T.fileSpec?.mimeType,cs)||ct.remove(V,T.tempId,"none");else ct.reset(V)},[o,V]),p.useEffect(()=>{(!jt&&de||es)&&Ct(null)},[jt,de,es]);const xr=Ce(y,"4031588851"),zn=Ce(y,"3637408529"),Sr=zn.get("is_in_composer_text_exp",!1),br=zn.get("composer_text","MESSAGE_CHATGPT"),yr=xr.get("composer_text","MESSAGE_CHATGPT"),Cr=Sr?br:yr,[Rt,Ar]=(()=>{const m=u?ed(u):void 0;if(m)return[m.placeholder,m.isLastingDisabledStyle];if(C)return[Z.placeholderWithName,!1];if(le?.placeholderTextOverride!=null)return[le.placeholderTextOverride,!1];if(r?.id===ji)return[Z.n7jupdSystemHintPlaceholder,!1];if(ke){if(po(ke.systemHint))return Pt?[Z.n7jupdActivePlaceholder,!1]:[Z.n7jupdSystemHintPlaceholder,!1];switch(ke.systemHint){case F.Search:return[Z.searchPlaceholder,!1];case F.Think:return[Z.thinkPlaceholder,!1];case F.Slurm:return[Z.connectorPlaceholder,!1];case F.Research:return[Z.researchPlaceholder,!1];case F.Canvas:return[Z.canvasPlaceholder,!1];case F.Picture:return[Z.picturePlaceholder,!1];case F.PictureV2:return[Z.pictureV2Placeholder,!1];case F.ContextualAnswers:return[Z.contextualAnswersPlaceholder,!1]}}switch(Cr){case"BLANK":return[null,!1];case"ASK_ANYTHING":return[Z.placeholderAskAnythingVariant,!1];case"ASK_CHATGPT_ANYTHING":return[Z.placeholderAskNameAnythingVariant,!1];default:return[Z.placeholderWithName,!1]}})(),Gn=os?l?U.formatMessage(td.newChatInProject,{projectName:bt?.gizmo.display.name??"this project"}):Rt?U.formatMessage(Rt,{name:"ChatGPT"}):"​":Rt?U.formatMessage(Rt,{name:he!=null?Ue==="magic"?sd:he.name||"GPT":bt?.gizmo.display.name??"ChatGPT"}):"​";p.useEffect(()=>x.subscribe("input",()=>{nd.getState().isThreadHeaderVisible&&Fs.hideThreadHeader()}),[x]),p.useEffect(()=>x.subscribe("input",()=>{ss.current=performance.now(),k?.()}),[x,k]),p.useEffect(()=>{if(_)return x.subscribe("change",()=>{_()})},[x,_]);const bs=Ti()&&!!Pe.find(m=>!!m.requires_file_upload),{connectorConfig:ot,isLoading:Wn}=Ei(),{onSelectConnector:It,onConnectorOauthRedirect:_r}=od({connectorConfig:ot,modelSupportedImageMimeTypes:me,modelAcceptedMimeTypes:cs,attachmentsProductFeature:wt?.attachments,onOauthRedirect:Et});ad(ot,It);let Vn=null;const Bt=[],qn=[],Yn=lr(),kr=Y||Yn||At,ys=He===Be.None&&!c?Ae.ModelNotSupported:Sn?Ae.HasReachedMaxFiles:as!=null?Ae.RateLimitReached:void 0,Pr=Ri("(width <= 510px)",Ii);w||(w=l&&!Pr?"center":"bottom");const Nt=me.length>0;if(Y&&kn){const m=[e.jsx(tn,{openFileDialog:Ie,modelSupportsImages:Nt,showMenuForNoAuth:!1,isDisabled:!pe,disabledReason:ys,currentModelName:r?.title},"file-upload-items"),pe&&Nt&&e.jsx(Ha,{modelSupportedImageMimeTypes:me},"desktop-connector-items"),pe&&(Pn?e.jsx(rd,{shortLabel:!1,connectorConfig:ot,onConnectorClick:It},"context-connectors"):e.jsx(Ca,{isLoadingConnectors:Wn,connectorConfig:ot,onConnectorClick:It,onOauthRedirect:Et},"context-connectors")),e.jsx(ya,{},"add-tab")];nt&&m.push(e.jsx(ae.Separator,{},"tools-separator"),e.jsx(yd,{systemHints:re,selectedHintType:H,onSelectHintType:T=>{be(T,{analyticsMetadata:{clientThreadId:a}})}},"system-hints")),Pn&&m.push(e.jsx(Cd,{},"connect-apps")),w==="bottom"&&m.reverse(),Vn=e.jsx(id,{onCloseAutoFocus:T=>{Ss.composer.autofocusDisabled$()||(T.preventDefault(),x.focus())},items:m,children:e.jsx(Wt,{disabled:g,clientThreadId:a,rateLimitPopup:as,highlightTooltip:bs&&!ze,label:U.formatMessage({id:"composer.plusMenu.label",defaultMessage:"Add files and more"}),secondaryLabel:e.jsx("kbd",{className:"bg-token-bg-tertiary -me-1 inline-grid aspect-square w-4 items-center justify-center rounded-sm text-[11px]",children:e.jsx("span",{children:"/"})}),children:e.jsx(ld,{onDoubleClick:pe?Ie:void 0,disabled:Mt})})})}else if(kr){const m=e.jsx("div",{"data-testid":"composer-action-file-upload",style:{viewTransitionName:"var(--vt-composer-attach-file-action)"},children:e.jsx(mp,{clientThreadId:a,modelSupportedImageMimeTypes:me,openFileDialog:Ie,historyDisabled:st,highlightTooltip:bs&&!ze,isLoadingConnectors:Wn,connectorConfig:ot,onSelectConnector:It,onConnectorOauthRedirect:_r,showLabel:ir()==="all",showUpsell:Yn&&!At,showMenuForNoAuth:At,isDisabled:!pe||Mt,disabledReason:ys,currentModelName:r?.title??"",visualTreatment:Y?"composer-btn":"legacy"})},"file-upload-button");Bt.push(m),qn.push(m)}Y?cr&&Bt.push(e.jsx(_d,{activeSystemHintType:H,systemHints:re,composerController:x,clientThreadId:a,disabled:Mt})):Bt.push(e.jsx(Ad,{account:n,clientBootstrapFlags:cn,features:xe,currentModelConfig:r,isDisabled:!!Mt,clientThreadId:a,composerController:x,gizmoId:yt}));const[vr,$n]=p.useState(!1),Kn=Ar||pr?"disabled":"default",Mr=!Ge,Xn=gd({promptDisabledReason:u,hasPendingFiles:pn,hasTextContent:hn,isTextContentTooLong:us,hasAsyncTaskPending:tr,noSourceSelectedDr:!bn,isDeepResearchTaskStreaming:fs,canCancelDeepResearch:ms,isThreadHardBlocked:ht}),at=Pt?"streaming":Mr?"disabled":"idle",rt=p.useRef(null),Ve=p.useRef(null),wr=ye(y,"222560275")||o&&!o.startsWith("o1")&&!o.startsWith("o3");p.useEffect(()=>{const m=()=>{rt.current!=null&&Wo.addAction("composer_state_disabled",{threadId:Ft(a),disabledReason:rt.current})};if(kt&&at==="disabled"){let T="unknown";g?T=u??"component_disabled_unknown":d?T="completion_in_progress":ht&&(T="thread_hard_blocked"),rt.current!==T&&(Ve.current&&clearTimeout(Ve.current),Ve.current=setTimeout(m,hp)),rt.current=T}else rt.current=null;return()=>{Ve.current&&(clearTimeout(Ve.current),Ve.current=null)}},[a,kt,at,g,u,d,ht]);const Cs=[];if(le?.label&&Cs.push({type:le.type,value:le.label,onRemoveRegion:Fn}),de!==null){const m=!!de.gizmo.tags?.includes(Qt.FirstParty);Cs.push({type:"mention",value:de.gizmo.display.name,icon:e.jsx(ga,{isFirstParty:m,src:de.gizmo.display.profile_picture_url,className:"icon"}),onRemoveRegion:()=>{Ct(null),x.focus()}})}p.useEffect(()=>{(!Pe||Pe.length===0||!Tt)&&(ns.current=!1)},[Pe,Tt]);const jr=p.useCallback((m,T,G)=>{ns.current=m>=0,T&&x.setText(G?`${G.title}${G.body}`:"")},[x]),Jn=Tt&&Pe&&Pe.length>0&&!We&&ke?.systemHint!==F.Research&&!ls&&!x.hasMultipleLines()&&x.canShowAutocompletion();p.useEffect(()=>{We?v?.():P?.()},[We,v,P]);const As=m=>{if(m.preventDefault(),m.stopPropagation(),ss.current>0){const T=performance.now()-ss.current;Ui.hist(Oi.DEFAULT,"final_user_input_to_submit_ms",[],T)}at==="streaming"&&(!ln||x.isEmpty())?fs&&ms?$n(!0):hr(m):Nn(m)};p.useEffect(()=>{const m=Ft(a),T=n?.normalizedAccountUserId;if(!T||i)return;const G=cd(()=>{const Q=x.getContentToSend().content;Q===""?Bi(m):Ni(m,Q,T)},1e3);return x.subscribe("change",G)},[n,a,x,i,Se]);const{connectedTypes:_s}=Li(),Qn=q&&Fi(q),Zn=p.useMemo(()=>{const m=[];pe&&Mn&&m.push({command:"upload",aliases:["file","attach"],title:U.formatMessage({id:"composer.add.label",defaultMessage:"Add photos & files"}),icon:e.jsx(Ta,{modelSupportsImages:Nt}),onSelect:Ie});const T=ts?.connection_statuses.filter(G=>G.user_connection_details.activation_status==="activated"&&["google_drive_oauth","google_drive_dwd"].includes(G.user_connection_details.knowledge_connector_type)).map(G=>G.user_connection_details.connection_type)??[];return Qn&&(_s.size>0||T.length>0)&&m.push({command:"all-connectors",aliases:["find","connectors","use"],title:U.formatMessage({id:"6YT2cp",defaultMessage:"Use all connectors"}),icon:e.jsx(Di,{}),onSelect:()=>{be(F.Slurm,{analyticsMetadata:{clientThreadId:a}}),je(a,G=>{const Q=G.selectedSources?.get(F.Slurm)??new Set;G.selectedSources??=new Map,G.selectedSources.set(F.Slurm,new Set([...Q,..._s,...T]))})}}),m},[pe,Mn,ts?.connection_statuses,Qn,_s,U,Nt,Ie,be,a]),eo=e.jsx(tp,{canUseInlineTagging:jt,isDisabled:g,clientThreadId:a,currentLeafId:B,currentRequestId:$,canContinue:S,composerController:x,isNewThread:l,onContinueGenerating:m=>s({event:m,conversationMode:Te(a)?.mode,systemHints:H?[H]:[]}),onResetState:In,conversationMode:z,isShowingAutocomplete:!!Jn}),to=!Pt&&z!=null&&wr&&ud.includes(z.kind)&&e.jsx(dd,{clientThreadId:a,onTargetedReply:mr}),so=Jn&&e.jsx("div",{className:ee("bg-token-bg-primary absolute start-0 z-[-1] box-border w-full ps-0",w==="center"?"top-full":"bottom-full"),children:e.jsx(Lm,{suggestions:Pe,composerController:x,onSelect:I,onChange:jr})}),no=e.jsx(kd,{composerController:x,parsedDocumentHandler:gr}),oo=!R&&e.jsx(La,{className:E}),ao=e.jsx(md,{modelSupportedImageMimeTypes:me,uploadType:Be.Multimodal,attachmentsProductFeature:wt?.attachments}),Tr=e.jsxs(e.Fragment,{children:[We&&e.jsx(vo,{onClick:m=>Hn(m),onClose:()=>{x.setShowTaggingDropdown(!1),x.focus()},currentModelId:o}),nt&&re&&e.jsx(Mo,{slashCommands:Zn,systemHints:re,composerController:x,clientThreadId:a})]}),{isImageGenEditor:Er}=pd(),ro=ye(y,"3760395675");return Er?e.jsxs(So.Provider,{value:_t,children:[e.jsx(bo,{defaultOpen:ro,children:e.jsxs("form",{id:"prompt",className:h,onSubmit:As,children:[e.jsxs("div",{className:"relative z-1 flex h-full max-w-full flex-1 flex-col",children:[e.jsx(yo,{onOauthRedirect:Et}),oo,e.jsxs("div",{className:"group relative z-1 flex w-full items-center",children:[e.jsxs(hd,{open:We||nt,children:[e.jsx(xd,{className:"w-full",children:e.jsx(fp,{type:st?"temporary":"default",ref:L,placeholder:Gn,inputState:Kn,composerController:x,leftSideActions:qn,state:at,onSubmit:As,renderFiles:ze&&e.jsxs(e.Fragment,{children:[Ue==="magic"&&e.jsx("div",{className:"bg-token-main-surface-secondary text-token-text-secondary m-2 mb-0 rounded-lg p-2 text-xs",children:e.jsx(N,{...Z.gizmoKnowledgeWarning})}),e.jsx(Oa,{files:ie,className:"-ms-1.5 flex flex-nowrap gap-2 overflow-x-auto p-1.5"})]}),clientThreadId:a,gizmoId:yt,disableReason:Xn,modelId:o})}),e.jsx(Sd,{children:e.jsxs(bd,{side:"bottom",align:"start",sideOffset:12,onOpenAutoFocus:m=>m.preventDefault(),children:[We&&e.jsx(vo,{onClick:m=>Hn(m),onClose:()=>{x.setShowTaggingDropdown(!1),x.focus()},currentModelId:o}),nt&&re&&e.jsx(Mo,{slashCommands:Zn,systemHints:re,composerController:x,clientThreadId:a})]})})]}),so]}),no,ao]}),e.jsx("input",{...jn({className:"hidden"})})]})}),eo,to]}):e.jsx(So.Provider,{value:_t,children:e.jsxs(bo,{defaultOpen:ro,children:[e.jsxs("div",{className:"max-xs:[--force-hide-label:none] relative z-1 flex h-full max-w-full flex-1 flex-col",children:[e.jsx(yo,{onOauthRedirect:Et}),oo,ps&&vr&&e.jsx(fd,{taskId:ps.taskId,clientThreadId:a,onClose:()=>$n(!1)}),e.jsx(pp,{layoutMode:w,hasFiles:ze,pendingFiles:ie,isUploadDisabled:!pe,clientThreadId:a,highlightUploadTooltip:bs&&!ze,disableReason:Xn,uploadButtonDisabledReason:ys,currentModel:r,conversationMode:z,state:at,inputState:Kn,gizmoId:yt,includeSidebarContextTray:Bn,isTemporaryChat:st,placeholder:Gn,composerController:x,onSubmit:As,replyRegions:Cs,leadingAction:Vn,legacyFooterActions:Bt,legacySuggestionsPopoverContent:Tr,activeSystemHint:ke,hideSystemHint:nn,onRemoveSystemHint:is,contextualAnswerUserConnectionData:ts,fileInput:e.jsx("input",{...jn()}),expanded:vn?void 0:!0,expandOnMultilineInput:vn}),so]}),no,eo,to,ao,H&&re&&e.jsx(Sp,{availableSystemHints:re,systemHintType:H,onRemoveSystemHint:is})]})})}const Sp=({availableSystemHints:t,systemHintType:s,onRemoveSystemHint:n})=>{const o=t!=null&&t.every(l=>l.systemHint!==s),{isLoading:r}=Zo(),{isBlocked:i}=Aa(s),c=te(),a=!tt(c);return p.useEffect(()=>{r||(o||i)&&!a&&n()},[o,i,a,n,s,r]),null},Op=({clientThreadId:t,isNewThread:s,isGizmoThread:n,isProjectThread:o,isModelLoaded:r,currentModelId:i,onRequestCompletion:c,shouldUseUnifiedComposer:a,onlyAllowImageUploads:l})=>{const d=Fe(),{pageType:h}=Ed(),g=h?.type==="landing-page",u=Vi(h?.type),f=Rd(t).isOdysseyMode,S=p.useContext(qi),C=Yi(S),k=Hs(),_=$t(),I=oe(),E=te(),R=et();Id(d);const v=Qe(Ze),P=ut(Gt.sidebarUrlTrayOpen$)&&v,b=ut(Gt.context$),{platformConnectors:w}=Qo(),j=Ee(_e.hasSeenOdysseyConnectorsModal),y=ft(),L=J(t,B=>W.getConversationTurns(B).some($=>$.messages.some(ne=>ne.metadata?.n7jupd_message))),D=ea(),K=Bd(),x=(D||K)&&L;Nd(async()=>{if(P)return await Qi(b)});const q=async B=>{if(Te(t)?.isLoading!==!1)return;const $=()=>{d.delete(0,d.getContentLength()),d.appendText(B.contentToSend.content),d.focus()},ne=await Hd(B),De=ne.completionMetadata?.systemHints?.includes(zt),Re=Array.from(B.selectedSources??[]).filter(he=>he!=="web")[0];if(De&&Re&&j.eligible){const he=Ki[Re]??Re,Ue=w.get(he);if(Ue){let Oe=!1;Jo(E,zd,{connector:Ue,onConfirm:()=>{j.markAsViewed(),Oe=!0,c(ne)},onTurnOffConnectors:()=>{je(t,xe=>{xe.selectedSources??=new Map,xe.selectedSources.set(y,new Set(["web"])),xe.selectedMCPSources??=new Map,xe.selectedMCPSources.set(y,new Set),xe.mentionedSources=new Set,Xi({selectedSourcesMap:xe.selectedSources,selectedMCPSourcesMap:xe.selectedMCPSources,scope:{userId:R?.authUserId,workspaceId:R?.id}})})},onClose:()=>{Oe||$()}});return}}if(v){const he=Ji(b?.url??"")?.hostname;M.logEvent("kaur1br5.messageSent",he?{host:he}:void 0)}O(ne.promptMessage?.metadata?.attachments??[])&&c(ne)},O=p.useCallback(B=>{let $=Io;const ne=B.reduce((Re,gt)=>Re+(gt.size??0),0);f&&($=wo(E,"1504865540").get("max_file_size_mb",25));const De=ne<=$*1024*1024;return De||_.danger(I.formatMessage({id:"odyssey.fileTooLarge",defaultMessage:"The attached files are too large. The maximum size is {maxFileSizeMB}MB."},{maxFileSizeMB:$})),De},[E,I,f,_]),Y=p.useCallback(B=>{M.logEvent("Continue Completion"),c(Ld(B))},[c]),U=Fd.useState(B=>B.isReplayEnabled);if($i({clientThreadId:t}))return e.jsx(Dd,{});const V=e.jsxs(e.Fragment,{children:[e.jsx(Ud,{clientThreadId:t}),e.jsx(Ts,{verticalMargin:"none",verticalPadding:C?"last-standard":"none",horizontalPadding:v?"none":"standard",children:e.jsx(Es,{children:U?e.jsx(Od,{clientThreadId:t},t):x?null:e.jsx(bp,{clientThreadId:t,currentModelId:i,isNewThread:s,hideHeader:s,onRequestCompletion:q,onContinueGenerating:Y,onAutocompleteSelect:d.onAutocompleteSelect,onlyAllowImageUploads:l})})})]}),ge=s&&e.jsx("div",{className:ee("[display:var(--display-hidden-until-loaded,block)] md:absolute md:start-0 md:bottom-6 md:w-full"),children:e.jsx(Ts,{verticalMargin:"none",verticalPadding:"none",horizontalPadding:"standard",children:e.jsx(Es,{children:e.jsx(La,{className:"block flex-1"})})})});return a?e.jsxs(e.Fragment,{children:[!k&&ge,e.jsx("div",{id:"thread-bottom",children:V}),k&&ge,s&&!g&&!n&&!u&&!f&&!o&&e.jsx(Ts,{verticalMargin:"none",verticalPadding:"none",horizontalPadding:"standard",children:e.jsxs(Es,{children:[!1,e.jsx(Vm,{clientThreadId:t,currentModelId:i,isModelLoaded:r})]})})]}):V};function bp({clientThreadId:t,currentModelId:s,disableDraftPersistence:n=!1,isNewThread:o,onRequestCompletion:r,onContinueGenerating:i,onComposerInput:c,onComposerChange:a,onAutocompleteSelect:l,headerClassName:d,hideHeader:h,onTaggingDropdownClose:g,onTaggingDropdownOpen:u,onlyAllowImageUploads:f,layoutMode:S}){const{data:C,isLoading:k}=Zo(),[_,I,E,R,v]=J(t,$=>{const ne=W.getCurrentNode($);return[ne.message.clientMetadata?.errType!=null&&ne.message.clientMetadata.errType!=="info",Zi(W.getCurrentNode($).message),$?.mode,$?.continuingFromSharedConversationId!=null,!!$?.continuingFromSharedPostId]}),P=et(),b=Fe(),w=Md({clientThreadId:t}),{isOpen:j,onClose:y}=wd({type:"just-hit-rate-limit"}),L=p.useMemo(()=>w?!1:!_&&I,[_,I,w]),D=w,K=zi(t),x=J(t,W.hasRecentPIMWarning),q=da(K).data,O=Gi(),Y=x?"pimBlock":q?.gizmo.tags?.includes(Qt.WorkspaceDisabled)&&!O?"workspaceDisallowsGizmo":C?.models.size===0?"noModelsAvailable":E?.kind===Xe.GizmoTest&&E.gizmo_id==null?"noTestGizmoId":null,U=Dr(),se=ea(),V=U.action==="moderate",ge=te(),B=ye(ge,"1860647109");return e.jsxs(e.Fragment,{children:[e.jsx(gm,{composerController:b,clientThreadId:t,currentModelId:s,isCompletionInProgress:w}),e.jsx("div",{className:"flex justify-center empty:hidden",children:se&&V&&B?e.jsx(jd,{}):null}),j?e.jsx(Td,{onClose:y}):null,e.jsx(xp,{clientThreadId:t,disableDraftPersistence:n,onCreateNewCompletion:r,onContinueGenerating:i,currentModelId:s,account:P,currentModelConfig:Wi(C?.models,s),areModelsLoading:k,isNewThread:o,isCompletionInProgress:w,className:"w-full",canContinue:L,disabled:!!Y,disabledReason:Y??void 0,canPause:D,isInteractableSharedThread:R||v,onComposerInput:c,onComposerChange:a,onAutocompleteSelect:l,headerClassName:d,hideHeader:h,onTaggingDropdownClose:g,onTaggingDropdownOpen:u,onlyAllowImageUploads:f,layoutMode:S},t)]})}export{fm as D,Dp as F,Np as I,Up as M,Fp as O,bp as P,Op as T,pm as a,ko as b,Lp as c,ja as g,Ea as h,Bp as u};
//# sourceMappingURL=g0j29k77kzjbz76f.js.map
