import{r,j as t,M as b}from"./juy90og0wtbp77qa.js";import{bv as w,c8 as _,b3 as H,b2 as F,eQ as I,P as x,bA as B,bD as L,aS as R,ik as z,B as y,aC as D,bC as G}from"./or7jf62i5kvok6pm.js";import{f3 as K,f4 as U,f5 as V}from"./kax7wcp9i7f7jtvz.js";import{E as J}from"./oxfy7bv5q29a4s25.js";function O({initialText:c,clientThreadId:n,currentLeaf:i,onExitEdit:l,onRequestCompletion:p,disabled:C,attachments:o}){const[d,j]=r.useState(c??""),u=r.useRef(null),M=w(),h=_.useStore(),g=d.trim()==="",E=r.useCallback(e=>{j(e.currentTarget.value)},[]),m=r.useCallback(e=>{if(g)return;const s={},a=K();o&&(s.attachments=o),a&&(s.__internal={search_settings:a});const v=h.getActiveSystemHintType(),{systemHints:N,extraStreamParams:A}=U(v?[v]:[]),S=H(n),P=F.getParentNode(S,i).message.id;p({sourceEvent:e,parentMessageId:P,promptMessage:I(d,Object.keys(s).length>0?s:void 0),extraStreamParams:A,completionMetadata:{conversationMode:S?.mode,systemHints:N}}),l(),x.logEvent("Change Active Node",{intent:"edit_save"})},[g,o,n,h,p,l,i,d]),f=r.useCallback(()=>{B(n,e=>{L.setCurrentBranch(e,i)}),x.logEvent("Change Active Node",{intent:"edit_cancel"}),l(),x.logEvent("Cancel Edit Prompt",{threadId:R(n)})},[i,l,n]);r.useEffect(()=>{const e=u.current;if(e){e.focus();const s=e.value.length;e.setSelectionRange(s,s)}},[]),r.useEffect(()=>{const e=u.current,s=a=>{a.isComposing||(a.key==="Enter"&&a.metaKey?m(a):a.key==="Escape"&&f())};return e&&e.addEventListener("keydown",s),()=>{e&&e.removeEventListener("keydown",s)}},[f,m]);const k=o&&o.length>0&&t.jsx(Q,{children:o.map(e=>t.jsx(V,{width:M?"wide":"normal",file:e.name,contextConnectorInfo:z(e.context_connector_info)},e.id))}),T=t.jsx("div",{className:"m-2 max-h-[25dvh] overflow-auto",children:t.jsx(J,{ref:u,value:d,onChange:E,className:"m-0 w-full resize-none border-0 bg-transparent focus:ring-0 focus-visible:ring-0"})});return t.jsxs("div",{className:"bg-token-main-surface-tertiary rounded-3xl px-3 py-3",children:[k,T,t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx(y,{as:"button",color:"secondary",onClick:f,children:t.jsx(b,{id:"D9gbPp",defaultMessage:"Cancel"})}),t.jsx(y,{as:"button",onClick:m,disabled:C||g,children:t.jsx(b,{id:"KGxIJG",defaultMessage:"Send"})})]})]})}const Q=D.div`flex gap-2 flex-wrap`;function ee({message:c,...n}){return t.jsx(O,{currentLeaf:c.id,initialText:G(c),attachments:c.metadata?.attachments,...n})}export{ee as TextMessageEditor};
//# sourceMappingURL=ekilws0edo0o2kpo.js.map
