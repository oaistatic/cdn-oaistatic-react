const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ij3o0peh5e6og9qg.js","assets/juy90og0wtbp77qa.js","assets/or7jf62i5kvok6pm.js","assets/root-ms9lll5g.css","assets/kax7wcp9i7f7jtvz.js","assets/conversation-small-j9iamy23.css","assets/hdj4jg3qlpv2q2g0.js","assets/joa8jajuiu4xqpzn.js"])))=>i.map(i=>d[i]);
import{aS as K,ar as S,g7 as O,e_ as J,aC as L,dF as Q,al as D,P as M,n as T,ag as B,B as X,ak as Z,ck as k,cj as P,bW as Y,b4 as $,D as ee,as as te,at as ne,b2 as ae}from"./or7jf62i5kvok6pm.js";import{r as u,h as y,j as e,m as W,M as w,u as se,x as oe}from"./juy90og0wtbp77qa.js";import{F as ie}from"./bould6qrqtgxhdba.js";import{hP as H,jz as re,jA as le,jB as de,jC as ce,bJ as ue,bK as me,hM as ge,bQ as pe,hJ as V,bw as E,n as fe,A,jD as he,e5 as xe,eU as je,hN as be,fp as we,fd as Ce,eV as ve,b5 as ke,jE as Ee,bx as U,jF as ye,jG as _e,jH as Ie,ez as Se}from"./kax7wcp9i7f7jtvz.js";import"./ocpfit0g1gfti5z4.js";import"./mj9z9iuqobsziv2h.js";import"./dn063lnxb0kec6my.js";import"./g0j29k77kzjbz76f.js";import"./g1mzshmp15rgsy0r.js";import"./kwrsfo4prmlqgo0w.js";import"./6l5wykugon65myc6.js";import"./fgnsrp7wj3i83g7e.js";import"./klzyif2r6c67lyfu.js";import"./osl7p7pfd29pg5qh.js";import"./khey9wv8trxtr5w5.js";import"./beq9ghaom4x8xa0j.js";import"./on0kcnmks7o53xta.js";import"./ndqdq30cq8lae3qb.js";import"./mevzpwnt01gt592f.js";import"./lc0ql189cwpzn88w.js";import"./fzjh1zjd0g21dis4.js";import"./cthaea829w6zpbcu.js";import"./m2ly71nz794qjc4q.js";import"./pc2givv05uuq8g6l.js";import"./hdclltxvbgzx8xl8.js";import"./bp3e26benx61nzb4.js";import"./b6vbevykvjt8za99.js";import"./l0ojckr7ctyz3k3l.js";import"./hnh46qey6g5q3a5a.js";import"./nyp3d57wjtx31u6o.js";import"./mdjfgzvaqpwgw5u5.js";import"./lni3pqnz6q5sgeex.js";import"./cglroz4sel446i9g.js";import"./ghzyx04jxko7zqcu.js";function Ne(){const[t,n]=u.useState({undoStack:[],currentIndex:-1});function s(a){n(d=>({undoStack:[...d.undoStack.slice(0,d.currentIndex+1),a],currentIndex:d.currentIndex+1}))}function r(){n(a=>({undoStack:a.undoStack,currentIndex:Math.max(a.currentIndex-1,-1)}))}function o(){n(a=>({undoStack:a.undoStack,currentIndex:Math.min(a.currentIndex+1,a.undoStack.length-1)}))}function i(){n({undoStack:[],currentIndex:-1})}return{currentDrawnShape:t.undoStack.length>0?t.undoStack[t.currentIndex]:null,onNewDrawnShape:s,canUndoDrawing:t.currentIndex>=0,undoDrawing:r,canRedoDrawing:t.currentIndex<t.undoStack.length-1,redoDrawing:o,clearAllDrawings:i}}function De({imageAsset:t,mode:n,setMode:s,clientThreadId:r,messageId:o,cursorWidth:i,setCursorWidth:a,inpaintingDrawingState:d,isLoadingNewImage:l}){const m=K(r),{canUndoDrawing:c,undoDrawing:x,canRedoDrawing:f,redoDrawing:h,clearAllDrawings:j}=d,b=y();return e.jsxs(W.div,{className:"flex h-16 w-full justify-between px-4",...H,children:[e.jsx("div",{className:"flex items-center",children:n==="inpaint"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:S("flex items-center gap-3",l&&"opacity-50"),children:[e.jsx(R,{className:"h-[11px] w-[11px]"}),e.jsxs(re,{className:"relative flex w-[90px] items-center",min:32,max:240,step:.01,value:[i],onValueChange:C=>a(C[0]),disabled:l,children:[e.jsx(le,{className:"bg-token-text-quaternary relative h-[2px] grow",children:e.jsx(de,{className:"bg-token-text-secondary absolute h-full"})}),e.jsx(ce,{className:"bg-token-text-secondary block h-[11px] w-[11px] rounded-full"})]}),e.jsx(R,{className:"h-6 w-6"})]}),e.jsx(F,{}),e.jsx(p,{disabled:!c||l,onClick:x,children:e.jsx(ue,{})}),e.jsx(p,{disabled:!f||l,onClick:h,children:e.jsx(me,{})}),e.jsx(F,{}),e.jsx(p,{disabled:!c||l,onClick:j,children:e.jsx(w,{id:"imageEditorControls.clearSelectionButtonLabel",defaultMessage:"Clear selection"})})]})}),e.jsx("div",{className:"flex items-center",children:n==="inpaint"?e.jsx(p,{onClick:()=>s("default"),disabled:l,children:e.jsx(w,{id:"imageEditorControls.cancelButtonLabel",defaultMessage:"Cancel"})}):e.jsxs(e.Fragment,{children:[e.jsx(Te,{imageAsset:t,setMode:s,messageId:o,serverThreadId:m}),e.jsx(p,{tooltip:b.formatMessage({id:"imageEditorControls.downloadButtonTooltip",defaultMessage:"Save"}),onClick:()=>ge(t,m,o),children:e.jsx(pe,{})}),e.jsx(Me,{prompt:V(t),children:e.jsx(p,{tooltip:b.formatMessage({id:"imageEditorControls.promptButtonTooltip",defaultMessage:"Prompt"}),children:e.jsx(O,{})})}),e.jsx(p,{tooltip:b.formatMessage({id:"imageEditorControls.closeButtonTooltip",defaultMessage:"Close"}),onClick:E.close,children:e.jsx(J,{className:"icon-lg"})})]})})]})}function Me({prompt:t,children:n}){const[s,r]=u.useState(!1),o=y(),i=B();return e.jsx(je,{sideOffset:4,alignAgainstAnchor:"end",triggerButton:e.jsx("div",{className:"group",children:n}),className:"z-10",size:"none",children:e.jsxs("div",{className:"flex max-w-sm flex-col gap-3 p-4",children:[e.jsx("div",{className:"text-token-text-secondary",children:e.jsx(w,{id:"imageEditorControls.promptPopoverLabel",defaultMessage:"Prompt"})}),e.jsx("div",{children:t}),e.jsx("div",{children:e.jsx(X,{color:"secondary",disabled:s,onClick:a=>{r(!0),we(t,i,a),setTimeout(()=>r(!1),2e3)},icon:be,children:s?o.formatMessage({id:"imageEditorControls.copiedButtonLabel",defaultMessage:"Copied!"}):o.formatMessage({id:"imageEditorControls.copyButtonLabel",defaultMessage:"Copy"})})})]})})}function p({children:t,tooltip:n,disabled:s,onClick:r}){const o=e.jsx("button",{className:S("hover:bg-token-main-surface-tertiary group-radix-state-open:bg-token-main-surface-tertiary rounded-sm p-2 font-semibold",s?"text-token-text-quaternary":"text-token-text-secondary"),disabled:s,onClick:r,children:t});return n!=null?e.jsx(Q,{label:n,children:o}):o}function Te({imageAsset:t,setMode:n,messageId:s,serverThreadId:r,disabled:o}){const i=y(),a=fe(A.DalleEditingOnboarding),d=a.eligible&&!a.isLoading,l=e.jsx(p,{tooltip:d?void 0:i.formatMessage({id:"imageEditorControls.inpaintButtonTooltip",defaultMessage:"Select"}),onClick:()=>{n("inpaint"),D.logEvent("chatgpt_dalle_inpaint_click",null,{sourceOperation:t.metadata?.dalle?.edit_op??"none",hasParent:t.metadata?.dalle?.parent_gen_id!=null?"true":"false",model:"dalle"}),M.logEvent("chatgpt_dalle_inpaint_click",{conversationId:r,messageId:s,generationId:t.metadata?.dalle?.gen_id,fileId:T(t.asset_pointer),parentGenerationId:t.metadata?.dalle?.parent_gen_id,sourceOperation:t.metadata?.dalle?.edit_op,model:"dalle"}),D.logEvent("chatgpt_image_inpaint_click",null,{sourceOperation:t.metadata?.dalle?.edit_op??"none",hasParent:t.metadata?.dalle?.parent_gen_id!=null?"true":"false",model:"dalle"}),M.logEvent("chatgpt_image_inpaint_click",{conversationId:r,messageId:s,generationId:t.metadata?.dalle?.gen_id,fileId:T(t.asset_pointer),parentGenerationId:t.metadata?.dalle?.parent_gen_id,sourceOperation:t.metadata?.dalle?.edit_op,model:"dalle"})},disabled:o,children:e.jsx(he,{})});return d?e.jsx(xe,{announcementKey:A.DalleEditingOnboarding,show:!0,side:"bottom",sideOffset:0,title:i.formatMessage({id:"imageEditorNUX.title",defaultMessage:"Select area of the image to edit"}),description:i.formatMessage({id:"imageEditorNUX.description",defaultMessage:"Highlight the area and describe changes in chat."}),onDismiss:a.markAsViewed,children:e.jsx("div",{children:l})}):l}const F=L.div`mx-3 w-[1px] h-6 bg-token-border-default`,R=L.div`rounded-full border-2 border-token-text-secondary`;function Pe({mode:t,imageIndex:n,allImages:s,onSwitchImage:r,isLoadingNewImage:o}){const i=n>0,a=u.useCallback(()=>{i&&r(s[n-1])},[i,s,n,r]),d=n<s.length-1,l=u.useCallback(()=>{d&&r(s[n+1])},[d,s,n,r]);return u.useEffect(()=>{function m(c){c.target instanceof HTMLTextAreaElement||t==="default"&&(c.key==="ArrowLeft"?a():c.key==="ArrowRight"&&l())}return document.addEventListener("keydown",m),()=>{document.removeEventListener("keydown",m)}},[t,a,l]),e.jsx("div",{className:"text-token-text-secondary flex h-16 w-full items-center justify-center gap-3 font-semibold",children:t==="inpaint"?!o&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(w,{id:"imageEditor.selectArea",defaultMessage:"Select an area to edit"}),e.jsx("a",{href:"https://help.openai.com/en/articles/9055440",target:"_blank",rel:"noreferrer",children:e.jsx(O,{className:"icon"})})]}):s.length>1?e.jsxs(e.Fragment,{children:[e.jsx("button",{disabled:!i,className:"disabled:text-token-text-tertiary",onClick:a,children:e.jsx(Ce,{className:"icon"})}),e.jsx("div",{children:e.jsx(w,{id:"imageEditor.imageNumber",defaultMessage:"Image {num} of {numImages}",values:{num:n+1,numImages:s.length}})}),e.jsx("button",{disabled:!d,className:"disabled:text-token-text-tertiary",onClick:l,children:e.jsx(ve,{className:"icon"})})]}):null})}const Ae=0,Fe=64;function Re({imageAsset:t,children:n,containerDimensions:s,isLoadingNewImage:r}){return e.jsxs(W.div,{className:"absolute",style:Oe(t,s),...H,children:[n,e.jsx("div",{className:S("bg-token-main-surface-primary absolute inset-0 flex items-center justify-center transition-opacity duration-1000",r?"pointer-events-auto opacity-60":"pointer-events-none opacity-0")})]})}function Oe(t,n){const{width:s,height:r}=t,{width:o,height:i}=n,a=o-2*Ae,d=i-2*Fe,l=s/r,m=a/d,c=l>m,x=c?a:d*l,f=c?a/l:d,h=(i-f)/2,j=(o-x)/2;return{top:h,left:j,width:x,height:f}}const Le=te(()=>ne(()=>import("./ij3o0peh5e6og9qg.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(t=>t.DynamicDrawingCanvas));function wt({clientThreadId:t,messageId:n,image:s,allImages:r}){const o=Z(t,ae.getCurrentNode),i=[k.Dalle,k.t2uay3k].includes(P(o.message))&&!ke(o.message),a=se();return u.useEffect(()=>{async function d(l,m){try{const c=await Ee(a,l);E.setFocusedObject({type:U.Image,image:c[0],allImages:c,messageId:m})}catch(c){ee.addError(new Error("Failed to load newly created images:",{cause:c}))}}if(o!=null&&[k.Dalle,k.t2uay3k].includes(P(o.message))&&o.message.content.content_type===Y.MultimodalText){const l=$.getImageAssetPointers(o.message);d(l,o.id)}},[a,o]),e.jsx(Be,{image:s,allImages:r,isLoadingNewImage:i,clientThreadId:t,messageId:n})}function Be({image:t,allImages:n,isLoadingNewImage:s,clientThreadId:r,messageId:o}){const[i,a]=u.useState("default"),[d,l]=u.useState({width:window.innerWidth-ie,height:window.innerHeight}),m=u.useRef(null),[c,x]=u.useState(136),f=Ne(),{currentDrawnShape:h,onNewDrawnShape:j,clearAllDrawings:b}=f,C=u.useRef(null),_=y(),N=B(),{setTargetedContent:v}=ye();u.useEffect(()=>{const g=new ResizeObserver(I=>{const{width:z,height:q}=I[0].contentRect;l({width:z,height:q})});return m.current&&g.observe(m.current),()=>{g.disconnect()}},[]),u.useEffect(()=>{function g(I){I.key==="Escape"&&(i==="inpaint"?a("default"):E.close())}return document.addEventListener("keydown",g),()=>{document.removeEventListener("keydown",g)}},[i]),u.useEffect(()=>(h==null?v({type:"object",placeholderTextOverride:oe({id:"imageEditor.transformationTextareaPlaceholder",defaultMessage:"Edit imageâ€¦"}),shouldPersistAcrossMessages:!0,isFocusedViewContent:!0,createNewCompletionParams:g=>_e(g,t)}):v({type:"object",label:_.formatMessage({id:"imageEditor.inpaintingTargetedContentLabel",defaultMessage:"Edit selection"}),isFocusedViewContent:!0,createNewCompletionParams:async g=>await Ie(g,t,C.current?.getImageData(),_,N),onCleared:()=>a("default")}),()=>{v(void 0)}),[t,_,v,h,N]),u.useEffect(()=>{i!=="inpaint"&&b()},[i]),u.useEffect(()=>{a("default")},[t]);const G=n.findIndex(g=>g.asset_pointer===t.asset_pointer);return e.jsxs("div",{ref:m,className:"flex h-full w-full flex-col justify-between",children:[e.jsx(De,{imageAsset:t,mode:i,setMode:a,clientThreadId:r,messageId:o,cursorWidth:c,setCursorWidth:x,inpaintingDrawingState:f,isLoadingNewImage:s}),e.jsx(Pe,{mode:i,imageIndex:G,allImages:n,onSwitchImage:g=>{E.setFocusedObject({type:U.Image,image:g,allImages:n,messageId:o})},isLoadingNewImage:s}),e.jsxs(Re,{imageAsset:t,containerDimensions:d,isLoadingNewImage:s,children:[e.jsx(Se,{className:"h-full w-full",alt:V(t),src:t.url,width:t.width,height:t.height,fadeIn:!1}),i==="inpaint"&&e.jsx("div",{className:"absolute inset-0",children:e.jsx(Le,{drawingCanvasRef:C,color:"rgba(0, 122, 255, 0.5)",dashedOutlineColor:"rgba(255, 255, 255, 0.65)",cursorWidth:c,canvasWidth:t.width,canvasHeight:t.height,currentDrawnShape:h,onNewDrawnShape:j})})]})]})}export{wt as ImageEditor};
//# sourceMappingURL=o1xmyqoqptv3197c.js.map
