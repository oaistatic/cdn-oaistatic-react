const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ekgf5i67wuz61x89.js","assets/j5zd9vs1l0bwsjqa.js","assets/j12so9ru57hpoz1y.js","assets/root-eh80jqkj.css","assets/jn7p98x7qxquz26a.js","assets/conversation-small-cmjjxogj.css","assets/fkili367bghrwku3.js","assets/o3z8kdtii15b9xui.js","assets/n8ukir0uiapwc8ai.js","assets/gld03raz97um5arz.js","assets/lcvpbf4bczccsy4p.js","assets/nc2llj0k42mz5eom.js","assets/dtivam8szgj0eqoa.js","assets/db5e3b0k0mmwmv98.js","assets/gqhbj1hjjsurx5m7.js","assets/fjoemqu4b3cvmhnq.js"])))=>i.map(i=>d[i]);
import{j as e,r as i,M as U,ap as Ln,an as Dn,ak as Ms,a9 as H,d as Qs,f as Un,aa as fe,u as Ae,R as Bn,l as qn}from"./j12so9ru57hpoz1y.js";import{bO as Xs,ff as On,lB as ze,ed as Hn,G as Js,pA as ws,pB as Gn,mQ as Vn,mT as zn,pC as Wn,pD as $n,pE as Yn,pF as Me,pG as Kn,aZ as Zs,pH as Qn,hl as Xn,hm as Jn,a2 as me,fp as et,Y as Zn,bC as ea,hY as st,pI as sa,pJ as ta,pK as na,pL as tt,fw as aa,fx as oa,fz as ra,pM as ia,an as nt,fy as la,Z as at,pN as ot,bj as ca,pO as da,pP as ua,pQ as ma,nI as ga,pR as ha,pS as pa,pT as fa,pU as we,jP as rt,bp as xa,jG as va,pV as ba,aE as ya,cF as _a,pW as Sa,hh as ge,U as it,aP as lt,pX as ct,aJ as Ta,aK as dt,aL as ja,aM as ut,pY as Ca,pZ as ka,p_ as Ma,p$ as wa,q0 as Ia,dq as mt,dr as gt,cv as ht,d as Ea,q1 as Na,q2 as Ra,cz as Aa,H as Fa,dL as Pa,q3 as La,ox as pt,f5 as Da,q4 as Ua,gY as Ba,ka as qa,y as Oa,cH as ft,q5 as Ha,hk as Ga,q6 as Va,cx as za,q7 as Wa,m1 as $a,q8 as Ya,q9 as Ka,qa as Qa,qb as Xa,cD as Ja,ko as Za,hI as eo,b1 as so,cA as to,qc as no,qd as ao,kb as oo,qe as ro,qf as io,ln as We,qg as lo,lo as Ne,qh as $e,dK as co,qi as uo,qj as xt,hK as mo,ce as go,kl as ho,qk as po,ql as fo,qm as xo,qn as vo,W as bo,oE as yo,qo as _o,qp as So,qq as To,qr as jo,qs as Co,qt as ko,qu as Mo,bE as wo,qv as Io,O as Eo,kN as No,kO as Ro}from"./jn7p98x7qxquz26a.js";import{a as D,cy as le,c3 as ne,cz as de,gU as vt,bT as Ao,at as ee,n as Is,W as L,D as Ye,Q as F,bf as he,bm as es,v as ce,V as Re,gc as Fo,bg as bt,au as ss,J as V,aI as Ke,R as yt,B as _t,P as B,bN as X,aU as ts,bD as te,fy as St,aO as pe,ef as Po,cW as K,T as Lo,dW as Do,e1 as Uo,e2 as Bo,aw as Q,b2 as qo,bH as Oo,h9 as Ho,r as Tt,u as jt,U as Go,cZ as Ct,aq as kt,cY as Vo,cu as zo,ct as Wo,cU as $o,Y as Mt,q as wt,aP as It,c_ as Yo,er as Ko,fh as Qo,gm as Oe,az as Xo,e0 as Jo,O as Zo,am as Es,gS as er,gT as sr,cA as tr,$ as nr,dk as Ns,fT as ar,h1 as or,c7 as rr,fO as ir}from"./j5zd9vs1l0bwsjqa.js";import"./cx64odxk6g9mmfxk.js";import{M as lr,O as cr}from"./i0f6lf35jgfv6z47.js";import{a as dr,G as ur}from"./owhjnpwqw9ddu7v0.js";import{C as Qe,F as mr}from"./ik1mvke1rzg5h1fr.js";import{b as Et}from"./01yrv2o49ye0ebr7.js";import{u as Nt}from"./d8hi8vzea1zd4sdu.js";import{u as gr}from"./ojd4yynl6f6f4h3l.js";import{a as Rt}from"./n5601invkykfg1ys.js";const hr="bg-token-main-surface-primary text-token-text-primary",pr="openai",Rs=["bg-blue-300 text-white"];function fr(t){return Rs[(t?.charCodeAt(0)??0)%Rs.length]}const Ie=({children:t})=>e.jsx("div",{className:"pt-0",children:e.jsx("div",{className:D(i.isValidElement(t)&&t.type===ze?"gizmo-bot-avatar":"gizmo-shadow-stroke","flex h-8 w-8 items-center justify-center overflow-hidden rounded-full"),children:t})});function Xe(t){const{messages:n,isUserTurn:a,avatarClassName:s,gizmo:o}=t,r="medium",d=n[0]?.metadata?.shared_conversation_id,c=d!=null,g=Xs(),{gizmoEditorData:u,mode:p}=On();let y=e.jsx(Ie,{children:e.jsx(ze,{className:s??hr,iconName:pr,size:r})});return o?y=e.jsx(Ie,{children:e.jsx(dr,{gizmoId:o.gizmo.id,className:"h-full w-full"})}):u!=null&&p==="test"&&(y=e.jsx(ur,{isFirstParty:!1,src:u.profilePictureUrl,className:"h-8 w-8 first:pt-[3px]"})),e.jsx("div",{className:void 0,children:a?c?e.jsx(Ie,{children:e.jsx(ze,{className:fr(d),iconName:"user",size:r})}):e.jsx(Ie,{children:e.jsx(Hn,{user:g,size:r})}):y})}const As=le(()=>de(()=>import("./ekgf5i67wuz61x89.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(t=>t.MemoryActionResult));function Fs(t,n,a){he(t,s=>{es.updateTree(s,o=>{o.updateNodeMetadata(n,{inlineComparisonRating:a})})})}const Ps=({messages:t})=>{for(const{metadata:n}of t){const{paragen_display_label:a}=n??{};if(a)return a;const{augmented_paragen_prompt_label:s}=n??{};if(s)return s}};function xr(t){const n=i.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),a=i.useRef({left:null,right:null});return t.variantIds.length<2?e.jsx(At,{setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:n,firstVisibleTokenTimestampsRef:a,...t}):e.jsx(vr,{...t,visibilityStateRef:n,firstVisibleTokenTimestampsRef:a})}function vr(t){const{clientThreadId:n,variantIds:a,turnIndex:s,firstVisibleTokenTimestampsRef:o}=t;if(a.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const r=ns(),l=vt(),d=Ao(),[c,g]=a,u=i.useMemo(()=>Js(c+g)()>=.5,[c,g]),[p,y]=u?[g,c]:[c,g],[f,h,T]=ee(n,_=>{const A=Is(_).tree.getLeafFromNode(p).id,w=Is(_).tree.getLeafFromNode(y).id,S=L.getConversationTurns(_,A),N=L.getConversationTurns(_,w),I=s<S.length?S[s]:null,j=s<N.length?N[s]:null;return I||Ye.addError(`Paragen Left turn index ${s} out of bounds`,{turnIndex:s,turnCount:S.length,lastTurnRole:F(S)?.role,lastMessageAuthor:F(F(S)?.messages)?.author,lastMessageContentType:F(F(S)?.messages)?.content.content_type,lastMessageMetadata:F(F(S)?.messages)?.metadata,altTurnCount:N.length,altLastTurnRole:F(N)?.role,altLastMessageRole:F(F(N)?.messages)?.author.role}),j||Ye.addError(`Paragen Right turn index ${s} out of bounds`,{turnIndex:s,turnCount:N.length,lastTurnRole:F(N)?.role,lastMessageAuthor:F(F(N)?.messages)?.author,lastMessageContentType:F(F(N)?.messages)?.content.content_type,lastMessageMetadata:F(F(N)?.messages)?.metadata,altTurnCount:S.length,altLastTurnRole:F(S)?.role,altLastMessageRole:F(F(S)?.messages)?.author.role}),[A,I,j]}),[k,C]=u?[T,h]:[h,T],R=r?"skippable_parallel_2_in_stream:a:2.0":"skippable_parallel_2_in_stream:a:1.5";i.useEffect(()=>(ws.setState({displayingSideBySideFeedback:!0}),()=>{ws.setState({displayingSideBySideFeedback:!1})}),[]),Gn();const P=i.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),m=i.useCallback((_,{shouldSubmitParagenFeedback:A=!0}={})=>{if(!h||!T||!k||!C)throw new Error("Expected both turns to exist");he(n,E=>{es.setCurrentBranch(E,_)});const w=_===p,S=_===c;k.messages.length>0&&Fs(n,k.messages[k.messages.length-1].id,S?"original":"new"),C.messages.length>0&&Fs(n,C.messages[C.messages.length-1].id,S?"original":"new");const N=ce(n),I=[h,T].map((E,z)=>({messageId:E.messages[E.messages.length-1].id,loadFirstTokenTime:z===0?o.current.left:o.current.right,loadEndTime:F(E.messages)?.clientMetadata?.completionSampleFinishTime})),j=w?I[0].messageId:I[1].messageId,x=L.getParentPromptNode(Re(n),f);if(!x)throw new Error("Expected prompt for side by side feedback");const v={},M=x.message.clientMetadata?.variantsInStreamInfo==null&&x.message.metadata?.paragen_variants_info!=null;for(const E of I)v[E.messageId]=M?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:E.loadFirstTokenTime,load_end_time:E.loadEndTime};A&&Os({params:{conversation_id:N,displayed_message_ids:I.map(E=>E.messageId),message_metadatas:v,rating:"selected",selected_message_id:j,source_timestamp:Date.now(),ui_variant:r?2:1,user_prompt_message_id:x.message.id}})},[n,p,c,k,C,h,T,f,o,t.conversationTurnMountTime,r]);return i.useEffect(()=>Fo(bt,{requestCompletion:_=>{const A=ce(n),w=L.getParentPromptNode(Re(n),f);if(!w)throw new Error("Expected prompt for side by side feedback");if(!h||!T)throw new Error("Expected both turns to exist");const S=[h,T].map((x,v)=>({messageId:x.messages[x.messages.length-1].id,loadFirstTokenTime:v===0?o.current.left:o.current.right,loadEndTime:F(x.messages)?.clientMetadata?.completionSampleFinishTime})),N={},I=w.message.clientMetadata?.variantsInStreamInfo==null&&w.message.metadata?.paragen_variants_info!=null;for(const x of S)N[x.messageId]=I?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:x.loadFirstTokenTime,load_end_time:x.loadEndTime};const j=_.isForSkippingParagen;Os({params:{conversation_id:A,displayed_message_ids:S.map(x=>x.messageId),message_metadatas:N,rating:j?"explicit_skipped":"skipped",selected_message_id:null,source_timestamp:Date.now(),ui_variant:j?3:r?2:1,user_prompt_message_id:w.message.id}}),j&&m(p,{shouldSubmitParagenFeedback:!1})}}),[h,T,f,n,t.conversationTurnMountTime,R,k?.messages,C?.messages,d,r,o,m,p]),e.jsx(At,{...t,setPreferredFeedback:m,leftVariantId:p,rightVariantId:y,leftTurn:h,rightTurn:T,hasActiveRequest:l,originalTurn:k,visibilityStateRef:P})}function At({setPreferredFeedback:t,leftVariantId:n,rightVariantId:a,leftTurn:s,rightTurn:o,hasActiveRequest:r,originalTurn:l,visibilityStateRef:d,...c}){const g=(s&&Ps(s))??null,u=(o&&Ps(o))??null,p=i.useMemo(()=>s?.messages??[],[s?.messages]),y=i.useMemo(()=>o?.messages??[],[o?.messages]),{avatarClassName:f,firstVisibleTokenTimestampsRef:h}=c,T=i.useMemo(()=>s?.messageGroups??[],[s?.messageGroups]),k=i.useMemo(()=>o?.messageGroups??[],[o?.messageGroups]),C=Vn(),R=Re(c.clientThreadId),P=F(s?.messages),m=F(o?.messages),_=ss(L.getRequestId(R,P?.id??m?.id)),A=_&&!P?.end_turn,w=_&&!m?.end_turn,S=s?.role===V.User,N=o?.role===V.User,I=i.useRef(null),j=i.useRef(null),x=i.useRef(null),v=s!=null,M=o!=null;!v&&h.current.left==null&&(h.current.left=Date.now()),!M&&h.current.right==null&&(h.current.right=Date.now()),i.useEffect(()=>{if(I.current&&j.current&&x.current){const se=Array(11).fill(0).map((ve,Y)=>Y/10),ue=new IntersectionObserver(ve=>ve.forEach(Y=>{Y.target===j.current?(d.current.left_visibility_initial==null&&(d.current.left_visibility_initial=Y.intersectionRatio),d.current.left_visibility_max=Math.max(d.current.left_visibility_max??0,Y.intersectionRatio)):Y.target===x.current&&(d.current.right_visibility_initial==null&&(d.current.right_visibility_initial=Y.intersectionRatio),d.current.right_visibility_max=Math.max(d.current.right_visibility_max??0,Y.intersectionRatio))}),{root:I.current,threshold:se});return ue.observe(j.current),ue.observe(x.current),()=>ue.disconnect()}},[d]);const{data:E}=zn(void 0,!1,C),z=ns(),xe=e.jsx("div",{className:"text-token-text-secondary px-(--thread-content-margin) pt-1 pb-5 text-center text-sm text-pretty",children:e.jsx(U,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})});return e.jsxs("div",{className:"relative flex flex-col",children:[e.jsxs("div",{className:D("bg-token-main-surface-primary sticky top-[-1px] z-1 px-(--thread-content-margin) text-center text-lg text-pretty",z?"md:top-header-height":"md:static"),"data-testid":"paragen-feedback-title",children:[e.jsx(U,{id:"KKeSJV",defaultMessage:"You're giving feedback on a new version of ChatGPT."}),z?xe:null]}),z?null:xe,e.jsx("div",{className:D(Wn,"horzScrollShadows relative -mb-2 snap-x snap-mandatory overflow-x-auto overflow-y-clip pb-4"),ref:I,children:e.jsxs("div",{className:D("mx-auto box-content max-w-[calc(2*var(--thread-content-max-width))] min-w-min px-(--thread-content-margin)","flex items-start",z&&"divide-token-border-medium dark:divide-token-border-heavy divide-x",!z&&"gap-4 sm:gap-6"),children:[e.jsxs(Ls,{horizontalScrollContainerRef:I,rootElementRef:j,onClick:()=>{t(n)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:v,children:[e.jsxs(Bs,{children:[e.jsx(Xe,{messages:p,isUserTurn:S,avatarClassName:f}),e.jsx(Us,{children:e.jsx(U,{...Hs.responseNumber,values:{responseIndex:1,display_label:g}})})]}),z&&v?e.jsx(Ds,{}):e.jsxs(e.Fragment,{children:[E!=null&&!S&&e.jsx(As,{clientThreadId:c.clientThreadId,messages:p,isParagen:!0}),e.jsx(Qe,{...c,allMessages:p,groupedMessagesToRender:T,allGroupedMessages:T,isUserTurn:S,isFinalUserTurn:!1,isCompletionRequestInProgress:A,hasActiveRequest:r,shouldGrowContainer:!1,isParagen:!0}),e.jsx(qs,{clientThreadId:c.clientThreadId,conversationTurnMountTime:c.conversationTurnMountTime,turn:s,originalTurn:l})]})]}),e.jsxs(Ls,{horizontalScrollContainerRef:I,rootElementRef:x,onClick:()=>{t(a)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:M,children:[e.jsxs(Bs,{children:[e.jsx(Xe,{messages:y,isUserTurn:N,avatarClassName:f}),e.jsx(Us,{children:e.jsx(U,{...Hs.responseNumber,values:{responseIndex:2,display_label:u}})})]}),z&&M?e.jsx(Ds,{}):e.jsxs(e.Fragment,{children:[E!=null&&!N&&e.jsx(As,{clientThreadId:c.clientThreadId,messages:y,isParagen:!0}),e.jsx(Qe,{...c,allMessages:y,groupedMessagesToRender:k,allGroupedMessages:k,isFinalUserTurn:!1,isUserTurn:N,isCompletionRequestInProgress:w,hasActiveRequest:r,shouldGrowContainer:!1,isParagen:!0}),e.jsx(qs,{clientThreadId:c.clientThreadId,conversationTurnMountTime:c.conversationTurnMountTime,turn:o,originalTurn:l})]})]})]})})]})}function Ls({horizontalScrollContainerRef:t,rootElementRef:n,onClick:a,children:s,hasActiveRequest:o,isWaitingOnFirstUserVisibleToken:r}){const l=ns(),{scrollX:d}=Ln({layoutEffect:!1,container:t,target:n}),c=$n(),g=Yn(),u=i.useRef(null),p=i.useRef(null),y=i.useRef(null),[f,h]=i.useState(!1),[T,k]=i.useState(!1),[C,R]=i.useState(!1),[P,m]=i.useState(0);i.useEffect(()=>{if(!l)return;const j=new IntersectionObserver(x=>{for(const v of x)v.target===u.current?h(v.isIntersecting):v.target===y.current?R(v.isIntersecting):v.target===p.current&&k(v.isIntersecting)},{root:c?.current});return u.current&&p.current&&y.current&&(j.observe(u.current),j.observe(p.current),j.observe(y.current)),()=>{j.disconnect()}},[P,l,c]);const _=!C&&(T||f),A=Dn(d,j=>_?-1*j:0),w=Ms(0);i.useEffect(()=>{if(!l)return;const j=new ResizeObserver(x=>{Me(x.length===1,"entryList.length === 1");const v=x[0];Me(v.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),w.set(v.contentBoxSize[0].inlineSize)});return n.current&&j.observe(n.current),()=>{j.disconnect()}},[l,w,n]);const S=Ms(0);i.useEffect(()=>{if(!l)return;const j=new ResizeObserver(x=>{Me(x.length===1,"entryList.length === 1");const v=x[0];Me(v.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),S.set(v.contentBoxSize[0].blockSize+16),m(v.contentBoxSize[0].blockSize)});return g.current&&j.observe(g.current),()=>{j.disconnect()}},[l,S,g]);const N=e.jsx(_t,{className:l?"px-5":"mt-4 self-start",onClick:a,"data-testid":"paragen-prefer-response-button",children:e.jsx(U,{id:"U2EAH6",defaultMessage:"I prefer this response"})}),I=r;return e.jsx("div",{"data-paragen-root":!0,className:D("@container relative flex min-w-[min(450px,80cqw,80vw)] flex-1 snap-center flex-col gap-1 text-start",l?"min-h-60":"border-token-border-tertiary rounded-xl border shadow-lg shadow-black/3"),ref:n,children:e.jsxs("div",{className:D(Kn,"px-(--thread-content-margin) py-4"),children:[e.jsx("div",{className:D("absolute top-48 right-0! left-0! h-px","invisible"),ref:u}),e.jsx("div",{className:D("absolute top-48 right-0! bottom-0 left-0!","invisible"),ref:p}),e.jsx("div",{className:D("absolute right-0! bottom-0 left-0! h-px","invisible"),ref:y}),s,l?e.jsx("div",{className:"flex-1"}):null,l?e.jsx("div",{className:"mt-4 min-h-10",children:I?null:e.jsx(H.div,{style:{translateX:A,width:w,bottom:S},animate:{opacity:100},initial:{opacity:0},transition:{ease:"easeOut",duration:.2,delay:.5},className:D({fixed:_,"z-20 flex w-full justify-center":!0}),children:N})}):o?null:N]})})}function Ds(){return e.jsxs("div",{className:"flex w-full flex-col gap-4 pt-3 pb-5",children:[e.jsx(ie,{className:"h-4 w-[75%]"}),e.jsx(ie,{className:"h-4 w-[50%]"}),e.jsx(ie,{className:"h-4 w-[80%]"}),e.jsx(ie,{className:"h-4 w-[55%]"}),e.jsx(ie,{className:"h-4 w-[66%]"}),e.jsx(ie,{className:"h-4 w-[64%]"}),e.jsx(ie,{className:"h-4 w-[48%]"})]})}function ns(){const{layer:t}=Ke("3119715334");return t.get("should-enable-hojicha",!1)}const Us=ne.div`text-sm text-token-text-secondary font-semibold`,Bs=ne.div`flex gap-4 items-center mb-1`,ie=ne.div`animate-pulse rounded-[4px] bg-token-main-surface-tertiary`;function qs({clientThreadId:t,conversationTurnMountTime:n,turn:a,originalTurn:s}){const o=Zs();if(!o.showParagenMetadata||!o.showDebugConversationTurns&&!o.forceParagen||a==null)return null;let r=a===s?"ORIGINAL":"NEW";const l=a.messages[a.messages.length-1],d=l?.metadata?.__internal,c=l?.metadata?.paragen_display_label;if(d){const{model_id:p,model_definition_slug:y,model_definition_virtual_model_id:f,alternative_model_selection_rule:h,augmented_paragen_prompt_group_id:T,augmented_paragen_prompt_id:k,augmented_paragen_prompt:C}=d;p&&(r+=`
Model ID: ${p}`),y&&(r+=`
Model Slug: ${y}`),f&&(r+=`
Virtual Model ID: ${f}`),h&&(r+=`
Alternative Model Rule: ${h}`),T&&(r+=`
Prompt Group ID: ${T}`),k&&(r+=`
Prompt ID: ${k}`),C&&(r+=`
Prompt: ${C}`),c&&(r+=`
Display Label: ${c}`)}r+=`
Message ID: ${l.id}`;const g=L.getParentPromptNode(Re(t),a.messages[0].id);if(!g)throw new Error("Expected prompt for side by side feedback");const u=g.message.clientMetadata?.variantsInStreamInfo==null&&g.message.metadata?.paragen_variants_info!=null;return r+=`
User prompt message ID: ${g.message.id}`,r+=`
Is Persisted Paragen? ${u}`,r+=`
Completion Sample Finish Time: ${u?`${n} (persisted)`:F(a.messages)?.clientMetadata?.completionSampleFinishTime}`,e.jsx("div",{className:"text-sm whitespace-pre-wrap text-red-500",children:r})}async function Os({params:t}){await yt.safePost("/paragen_submission",{requestBody:t,anonAware:!0})}const Hs=Qs({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}{display_label}"}});function br({handleShowRetrievalResults:t,clientThreadId:n,turnIndex:a,responseComplete:s=!1}){const[o,r]=ee(n,u=>[L.getTurnContentReferences(u,a),L.getConversationTurnAtIndex(u,a).messages]),l=i.useMemo(()=>({turnIndex:a,clientThreadId:n,responseComplete:s}),[n,s,a]),d=i.useRef(!1);i.useEffect(()=>{d.current||(d.current=!0,B.logEvent("File Sources Footer Shown",l))},[l]);const c=i.useCallback(()=>{B.logEvent("File Sources Footer Clicked",l),t()},[t,l]),g=i.useMemo(()=>{const u=new Set,p=[];function y(h){!h||u.has(h)||(u.add(h),p.push(h))}if(o.forEach(h=>{h.type==="file"?y(h.cloud_doc_url??h.extra?.cloud_doc_url):h.type==="file_navlist"&&h.items.forEach(T=>{y(T.cloud_doc_url)})}),s){for(const h of r)if(Qn(h)){const T=Xn(h.content.result),k=h.metadata?.cloud_doc_urls??[],C=T.chunks;for(let R=0;R<C.length;R++){const P=C[R];if(!P.documentId)continue;if(R<k.length){y(k[R]);continue}const m=P.documentId.endsWith("--google")?P.documentId.split("--")[1]:void 0,_=P.metadata.cloud_doc_url??(m?`https://drive.google.com/file/d/${m}`:void 0);y(_?.toString())}break}}const f=[];for(let h=0;h<p.length;h++){const T=p[h],k=Jn(T);if(k&&f.push(k.Icon),f.length>=3)break}return f},[r,o,s]);return e.jsxs(e.Fragment,{children:[e.jsx(H.div,{className:"absolute h-[60px]",initial:{opacity:0},animate:{opacity:1},children:e.jsxs("button",{className:D("not-prose group/footnote border-token-border-default bg-token-main-surface-primary hover:bg-token-main-surface-secondary mt-3 mb-2 flex w-fit items-center gap-1.5 rounded-xl border py-2","ps-3 pe-2.5"),onClick:c,children:[g.length>0&&e.jsx("div",{className:"flex flex-row-reverse gap-1",children:g.reverse().map((u,p)=>e.jsx(H.div,{className:D("border-token-main-surface-primary bg-token-main-surface-primary flex items-center overflow-hidden","group-hover/footnote:border-token-main-surface-secondary","relative"),initial:{opacity:0},animate:{opacity:1},children:e.jsx(u,{className:"icon-sm"})},p))}),e.jsx("div",{className:"text-token-text-secondary flex items-center gap-0.5 text-xs font-semibold",children:e.jsx(U,{id:"/48IOP",defaultMessage:"Sources"})})]})}),e.jsx("div",{className:"h-[60px]"})]})}function Ft({followups:t,analyticsMetadata:n}){const[a,s]=i.useState(-1),o=i.useRef(!1),r=Nt();return i.useEffect(()=>{o.current||(o.current=!0,t.forEach((l,d)=>{B.logEventWithStatsig("chatgpt_message_followup_action","chatgpt_message_followup_action",{...X(n),action:"show",position:d+1,followup_text:me(l)})}))},[t,n]),e.jsx(H.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex w-full flex-col",children:t.slice(0,4).map((l,d)=>e.jsxs(H.div,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:d*.03},exit:{opacity:0,translateY:4},onMouseEnter:()=>s(d),onMouseLeave:()=>s(-1),children:[d>0&&e.jsx(Pt,{$isSelected:a===d||a===d-1}),e.jsx(yr,{followUp:l,onSelectingSuggestedReply:r,analyticsMetadata:n,position:d})]},d))})}const Pt=ne.div`
  h-[1px] opacity-45
  ${({$isSelected:t})=>t?"mx-2 bg-token-main-surface-secondary":"bg-token-border-default"}
`;function yr({followUp:t,onSelectingSuggestedReply:n,analyticsMetadata:a,position:s}){return e.jsxs(H.button,{whileHover:"hover",className:"bg-token-main-surface-primary hover:bg-token-main-surface-secondary flex w-full cursor-pointer items-start justify-start gap-2 rounded-lg px-2 py-3 text-start",onClick:o=>{n(o,t,[],0),B.logEventWithStatsig("chatgpt_message_followup_action","chatgpt_message_followup_action",{...X(a),action:"click",position:s+1,followup_text:me(t)})},onMouseEnter:()=>{B.logEventWithStatsig("chatgpt_message_followup_action","chatgpt_message_followup_action",{...X(a),action:"hover",position:s+1,followup_text:me(t)})},children:[e.jsx(H.div,{className:"flex items-center justify-center pt-0.5 opacity-70",variants:{hover:{x:4}},initial:{x:0},transition:{duration:.1},children:e.jsx(et,{className:"text-token-text-secondary h-[18px] w-[18px]"})}),e.jsx("div",{className:"text-token-text-secondary pe-2 text-start text-sm",children:me(t)})]})}const _r=()=>e.jsx(Et,{size:"lg",lines:3,width:35,widthVariance:10,className:"w-full"}),Sr=t=>({[te.Search]:"Web Search",[te.Research]:"Research",[te.PictureV2]:"Draw Image",[te.Think]:"Think Harder"})[t]??"Title",Je=(t,n,a,s)=>{B.logEventWithStatsig("Capabilities Suggestion Action","chatgpt_capabilities_suggestion_action",{...X(a),categoryId:n.categoryId,suggestionId:n.id,position:s,action:t})},Tr=(t,n)=>{const a=i.useRef(!1);i.useEffect(()=>{a.current||(a.current=!0,t.forEach((s,o)=>{Je("show",s,n,o+1)}))},[t,n])},Lt=({clientThreadId:t,suggestions:n,analyticsMetadata:a,style:s="default"})=>{const o=Nt();return Tr(n,a),e.jsx(e.Fragment,{children:n.map((r,l)=>e.jsxs(H.div,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},exit:{opacity:0,translateY:4},transition:{delay:l*.03},className:D("w-full flex-1",s==="compact"&&"flex-col"),children:[s==="compact"&&l>0&&e.jsx(Pt,{$isSelected:!1}),e.jsx(jr,{clientThreadId:t,suggestion:r,onSelectingSuggestedReply:o,position:l+1,analyticsMetadata:a,style:s})]},r.prompt))})},jr=({clientThreadId:t,suggestion:n,onSelectingSuggestedReply:a,analyticsMetadata:s,position:o,style:r="default"})=>{const{setThreadSystemHintMode:l}=Zn(),d=ts(),c=Un();return e.jsx(H.button,{onClick:g=>{if(Je("click",n,s,o),n.categoryId===te.Research)if(d?.isFree()){ea(c,"Suggested Capabilities Upsell");return}else l(n.categoryId,!0,s);a(g,n,[],0)},onMouseEnter:()=>{Je("hover",n,s,o)},className:D("hover:bg-token-main-surface-secondary flex w-full flex-1 items-start rounded-xl text-start transition-colors duration-300 ease-in-out",r==="default"&&"gap-4 p-2"),children:r==="compact"?e.jsx(Cr,{clientThreadId:t,suggestion:n}):e.jsx(kr,{clientThreadId:t,suggestion:n})})},Cr=({suggestion:t,clientThreadId:n})=>{const{categoryId:a}=t,{systemHints:s}=st(n),o=s.find(r=>r.systemHint===a);return e.jsxs("div",{className:"bg-primary hover:bg-tertiary group flex w-full cursor-pointer items-center justify-start gap-2 rounded-lg px-2 py-3 text-start transition-colors duration-300 ease-in-out",children:[e.jsx("div",{className:"flex items-center justify-center opacity-70 transition-all duration-100 ease-in-out group-hover:scale-[1.02] group-hover:rotate-[-5deg] group-hover:opacity-100",children:a==="ask"?e.jsx(et,{className:"text-token-text-secondary group-hover:text-token-text-primary h-[18px] w-[18px]"}):e.jsx(St,{svgString:o?.logo??"",className:"text-token-text-secondary icon-md group-hover:text-token-interactive-label-accent-default h-[18px] w-[18px]"})}),e.jsx("div",{className:"text-token-text-secondary group-hover:text-token-text-primary flex items-center pe-2 text-start text-sm",children:me(t)})]})},kr=({clientThreadId:t,suggestion:n})=>{const{categoryId:a,imageUrl:s,description:o,title:r,ctaLabel:l,prompt:d}=n,{systemHints:c}=st(t),g=c.find(u=>u.systemHint===a);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-token-border-default bg-primary relative h-16 w-14 flex-shrink-0 rounded-lg border drop-shadow-xs transition-all duration-100 ease-in-out group-hover:scale-[1.02] group-hover:rotate-[-2deg]",children:[a===te.PictureV2?e.jsx("div",{className:"flex h-full w-full items-center justify-center rounded-lg bg-cover",style:{backgroundImage:`url(${s})`},children:e.jsx(sa,{className:"icon-xl mb-2 text-white"})}):e.jsxs("div",{className:"flex flex-col gap-1.5 p-2",children:[e.jsx("div",{className:"text-token-text-primary text-[5px] leading-tight font-semibold tracking-tighter",children:r??Sr(a)}),e.jsx("div",{className:"flex flex-col gap-0.5",children:Array.from({length:10}).map((u,p)=>e.jsx("div",{className:"bg-token-border-heavy h-[1px] w-full rounded-full"},p))})]}),e.jsx("div",{className:"absolute -end-2 -bottom-2",children:e.jsx(ta,{isBadge:!0,className:"opacity-100",logo:e.jsx(St,{svgString:g?.logo??"",className:"icon-md"})})})]}),e.jsxs("div",{className:"flex flex-col gap-2 text-sm",children:[e.jsx("div",{className:"text-token-text-primary flex-grow",children:o??d}),l&&e.jsxs("div",{className:"text-token-text-secondary flex items-center font-medium",children:[l,e.jsx(H.div,{variants:{hover:{x:2}},initial:{x:0},transition:{duration:.1},children:e.jsx(na,{})})]})]})]})},Ze=(t,n,a,s)=>{B.logEventWithStatsig("Capabilities Tab Action","chatgpt_capabilities_tab_action",{...X(a),tabId:n,position:s,action:t})},Mr=(t,n)=>{const a=i.useRef(!1);i.useEffect(()=>{a.current||(a.current=!0,t.forEach((s,o)=>{Ze("show",s.value,n,o+1)}))},[t,n])},wr=({clientThreadId:t,categorySuggestions:n,lastMessageId:a,analyticsMetadata:s,style:o="default"})=>{const r=n.map(({category_id:c,title:g,suggestions:u})=>({value:c,message:g,suggestions:u?.map(tt)??[]})),[l,d]=i.useState(r[0].value);return Mr(r,s),e.jsxs(aa,{value:l,onValueChange:d,orientation:"horizontal",className:"flex w-full flex-col",children:[e.jsx(oa,{className:"border-token-border-default relative flex w-full flex-row gap-6 border-b",children:r.map((c,g)=>e.jsx(Er,{value:c.value,message:c.message,isActive:l===c.value,analyticsMetadata:s,position:g+1},c.value))}),r.map(c=>e.jsx(ra,{value:c.value,children:e.jsx(Ir,{initialSuggestions:c.suggestions,clientThreadId:t,categoryId:c.value,isActive:l===c.value,lastMessageId:a,analyticsMetadata:s,style:o})},c.value))]})},Ir=({initialSuggestions:t,clientThreadId:n,categoryId:a,isActive:s,lastMessageId:o,analyticsMetadata:r,style:l="default"})=>{const d=ce(n),c=s&&t.length===0,{suggestions:g,isLoading:u}=ia({categoryId:a,shouldFetch:c,serverThreadId:d,lastMessageId:o}),p=c?g:t;return a==="ask"?u?e.jsx(_r,{}):e.jsx(Ft,{followups:p.map(y=>({type:nt.Reply,text:y.prompt})),analyticsMetadata:r}):e.jsx("div",{className:"flex w-full flex-col gap-y-4 py-3 md:flex-row md:gap-x-4",children:u?e.jsxs(e.Fragment,{children:[e.jsx(Gs,{}),e.jsx(Gs,{})]}):e.jsx(Lt,{clientThreadId:n,suggestions:p,analyticsMetadata:r,style:l})})},Er=({value:t,message:n,isActive:a,analyticsMetadata:s,position:o})=>e.jsxs(la,{className:"text-token-text-tertiary hover:text-token-text-secondary radix-state-active:text-token-text-primary relative flex min-w-10 justify-center py-4 text-sm font-medium",value:t,onClick:()=>{Ze("click",t,s,o)},onMouseEnter:()=>{Ze("hover",t,s,o)},children:[e.jsx("div",{className:"truncate",children:n}),e.jsx(fe,{children:a&&e.jsx(H.div,{layoutId:"tab-underline",className:"bg-token-text-primary absolute start-0 end-0 bottom-0 h-0.5",transition:{type:"spring",stiffness:500,damping:30}})})]}),Gs=()=>e.jsxs("div",{className:"flex flex-1 items-center gap-4 rounded-xl p-2",children:[e.jsx("div",{className:"bg-token-sidebar-surface-secondary dark:bg-token-border-default h-16 w-14 flex-shrink-0 rounded-lg"}),e.jsx("div",{className:"w-full flex-grow",children:e.jsx(Et,{lines:3,size:"sm"})})]}),Nr=({clientThreadId:t,categorySuggestions:n,lastMessageId:a,analyticsMetadata:s})=>{if(!n||n.length===0)return null;const o=n.length===1,r=n[0],l=r.suggestions.length>0?r.suggestions:void 0;return o&&l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-1 text-sm font-semibold",children:e.jsx(U,{id:"3UFIQc",defaultMessage:"Follow up"})}),e.jsx(Lt,{clientThreadId:t,suggestions:l.map(tt),analyticsMetadata:s,style:r.style})]}):e.jsx(wr,{clientThreadId:t,categorySuggestions:n??[],lastMessageId:a,analyticsMetadata:s})};function Rr({clientThreadId:t,followups:n,categorySuggestions:a,lastMessageId:s,analyticsMetadata:o}){const[r,l]=i.useState(null),d=at.useIsEnabled(t),{capabilitySuggestionsEnabled:c}=ot(),g=a&&a.length>0;return e.jsxs(e.Fragment,{children:[e.jsx(Pr,{visible:r==="conversation"}),e.jsx(Lr,{visible:r==="global"}),d&&(c?g&&e.jsx(Nr,{clientThreadId:t,lastMessageId:s,categorySuggestions:a,analyticsMetadata:o}):n.length>0&&e.jsx(Ar,{clientThreadId:t,followups:n,analyticsMetadata:o,setDisableMessage:l}))]})}function Ar({clientThreadId:t,followups:n,setDisableMessage:a,analyticsMetadata:s}){const{value:o}=pe("2281969373");return e.jsxs("div",{className:"group",children:[e.jsxs("div",{className:"mb-1 flex items-center text-sm font-semibold",children:[e.jsx(U,{id:"3UFIQc",defaultMessage:"Follow up"}),!o&&e.jsx(Fr,{clientThreadId:t,setDisableMessage:a,analyticsMetadata:s})]}),e.jsx(Ft,{followups:n,analyticsMetadata:s})]})}function Fr({clientThreadId:t,setDisableMessage:n,analyticsMetadata:a}){const s=at.useStore(),[o,r]=i.useState(!1);return e.jsxs(Po,{size:"small",onOpenChange:l=>r(l),contentClassName:"min-w-[200px]",triggerButton:e.jsx("button",{className:"text-token-text-tertiary hover:bg-token-main-surface-tertiary ms-2 flex h-6 w-6 items-center justify-center rounded-md focus:ring-0 focus:outline-hidden",children:e.jsx(ca,{className:D("h-4 w-4 opacity-0 group-hover:opacity-100",o&&"opacity-100")})}),children:[e.jsx(K.Item,{onClick:()=>{s.setDisabledConversation(t,!0),n("conversation"),setTimeout(()=>n(null),3e3),B.logEventWithStatsig("chatgpt_message_followup_setting","chatgpt_message_followup_setting",{...X(a),action:"disable_conversation"})},className:"text-token-text-primary",children:e.jsx(U,{id:"GZYofd",defaultMessage:"Hide for this chat"})}),e.jsx(K.Item,{onClick:()=>{s.setDisabledGlobally(!0),n("global"),setTimeout(()=>n(null),5e3),B.logEventWithStatsig("chatgpt_message_followup_setting","chatgpt_message_followup_setting",{...X(a),action:"disable_globally"})},className:"text-token-text-primary",children:e.jsx(U,{id:"dtAOq4",defaultMessage:"Hide everywhere"})})]})}const Dt={initial:{opacity:1},animate:{opacity:1},exit:{opacity:0,transition:{duration:.2}}};function Pr({visible:t}){return e.jsx(fe,{children:t&&e.jsx(H.div,{...Dt,className:"text-token-text-tertiary flex justify-center py-6 text-sm",children:e.jsx(U,{id:"ckTD9g",defaultMessage:"Follow ups are turned off for this conversation"})})})}function Lr({visible:t}){return e.jsx(fe,{children:t&&e.jsxs(H.div,{id:"disableForAllConvos",...Dt,className:"flex flex-col items-center py-3 text-sm",children:[e.jsx("div",{children:e.jsx(U,{id:"5GDIBQ",defaultMessage:"Follow up have been turned off"})}),e.jsx("div",{className:"text-token-text-tertiary pt-1",children:e.jsx(U,{id:"LYaBNe",defaultMessage:"You can re-enable them in settings"})})]})})}function Dr({modelSlug:t,animateModelLabelOnRender:n,isDropdownOpen:a,isRegenerateEnabled:s,isHovered:o,animateShortLabel:r}){const{data:l}=qo(),[d,c]=i.useState("initial");i.useEffect(()=>{if(n){const y=setTimeout(()=>c("show"),500),f=setTimeout(()=>c("initial"),2e3);return()=>{clearTimeout(y),clearTimeout(f)}}c("initial")},[n]);const{shorterLabel:g}=l?.categories.find(({defaultModel:y})=>y===t)??{},u={initial:{opacity:0,paddingLeft:0,width:"0"},show:{opacity:1,paddingLeft:2,width:"100%"},visible:{opacity:1,paddingLeft:2,width:"100%",transition:{delay:0,duration:0}}},p=a?"visible":o?"show":d;return e.jsxs(H.div,{initial:"initial",animate:p,className:"flex items-center pb-0",children:[e.jsx(rt,{className:"icon-md"}),(s||r)&&e.jsx(H.span,{className:"overflow-hidden text-sm text-clip whitespace-nowrap",variants:u,transition:{type:"tween",duration:.18},children:g}),s&&e.jsx(xa,{className:"icon-sm"})]})}function He(t,n){const{modelSwitcherDeny:a,subscriptionLevel:s}=t;return!!a&&a.reason===Oo.RATE_LIMIT&&s===Ho.PLUS&&!n}const Ee="rounded-lg radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed";function Ur({className:t,clientThreadId:n,message:a,onModelSelect:s,canRegenerateResponse:o}){const[r,l]=i.useState(null),[d,c]=i.useState(!1),[g,u]=i.useState(!1),p=a.metadata?.model_slug,y=a.id,f=i.useRef(null),h=P=>{P||setTimeout(()=>{f.current&&f.current.blur()},10)};if(i.useEffect(()=>{h(d)},[d]),ee(n,va))return null;const k=da(n,a.id),C=a.metadata?.model_slug,R=ba(k,C);return e.jsxs(K.Root,{onOpenChange:P=>{o&&(C&&ua(n,C),c(P),h(P))},children:[o?e.jsx(Lo,{sideOffset:0,label:e.jsx(U,{id:"wDs5sz",defaultMessage:"Switch model"}),children:e.jsx(Do,{ref:f,className:D("cursor-pointer",t),onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),children:e.jsx(Dr,{modelSlug:C,animateModelLabelOnRender:R,isDropdownOpen:d,isRegenerateEnabled:o,isHovered:g})})}):null,o&&e.jsx(K.Portal,{children:e.jsxs(K.Content,{className:"text-token-text-primary z-30 min-w-fit origin-top-right",side:"bottom",align:"start",children:[e.jsx(K.Item,{disabled:!0,className:"pt-2 pb-0",children:e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(U,{id:"bFLh5u",defaultMessage:"Switch model"})})}),e.jsx(Br,{clientThreadId:n,messageId:y,message:a,onModelSelect:s,messageModelSlug:p,setHoveredOption:l,hoveredOption:r})]})})]})}function Br({clientThreadId:t,message:n,messageId:a,messageModelSlug:s,onModelSelect:o,setHoveredOption:r,hoveredOption:l}){const d=Ae(),{data:c=null}=Uo(),g=c&&Bo(c),{modelOptions:u,messageModelEnabledTools:p}=ma({clientThreadId:t,message:n}),y=p.includes(te.Search),f=i.useMemo(()=>u.find(m=>m.value===s),[u,s]),[h,T]=i.useMemo(()=>ga(u,m=>m.subcategory),[u]),k=ha(n);i.useEffect(()=>{const m=u.some(_=>He(_,g));B.logEvent("Conversation Open Message Model Selector",{has_get_plus_button:m,is_new_regen_dropdown:!0})},[]);const C=i.useMemo(()=>{const m=new Map;return h.forEach(_=>{const A=_.subcategory;A&&(m.has(A)||m.set(A,[]),m.get(A)?.push(_))}),m},[h]),R=D("icon-sm","order-10 ms-auto text-token-text-tertiary icon-md"),P=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:d.formatMessage(Ge.search),icon:e.jsx(pa,{className:R}),condition:y&&!k,eventName:"chatgpt_regenerate_with_search_button_clicked"},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:d.formatMessage(Ge.nosearch),icon:e.jsx(fa,{className:R}),condition:y&&k,eventName:"chatgpt_regenerate_without_search_button_clicked"}];return e.jsxs(e.Fragment,{children:[T.map(m=>{const{value:_,...A}=m;return e.jsx(we,{value:_,onSelect:w=>{Q.logEvent("chatgpt_regenerate_switch_model_button_clicked",_,{requestedModelId:_,...X({clientThreadId:t,messageId:a})}),o({sourceEvent:w,requestedModelId:_})},includeRegenerate:!1,onMouseEnter:()=>r(_),onMouseLeave:()=>r(null),isHovered:l===_,messageModelSlug:s,includeCheck:!1,shouldShowUpsell:He(m,g),className:Ee,...A,icon:e.jsx("span",{className:R}),clientThreadId:t},_)}),[...C.entries()].map(([m,_])=>e.jsxs(K.Sub,{children:[e.jsx(K.SubMenuTrigger,{children:e.jsx("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:m})}),e.jsx(K.Portal,{children:e.jsx(K.SubContent,{className:"min-w-fit",children:_.map(A=>{const{value:w,...S}=A;return e.jsx(we,{value:w,onSelect:N=>{Q.logEvent("chatgpt_regenerate_switch_model_button_clicked",w,{requestedModelId:w,...X({clientThreadId:t,messageId:a})}),o({sourceEvent:N,requestedModelId:w})},includeRegenerate:!1,onMouseEnter:()=>r(w),onMouseLeave:()=>r(null),isHovered:l===w,messageModelSlug:s,includeCheck:!1,className:Ee,...S,icon:null,shouldShowUpsell:He(A,g),clientThreadId:t},m+"-"+w)})})})]},m)),!!f&&e.jsxs(e.Fragment,{children:[e.jsx(K.Separator,{}),e.jsx(we,{onSelect:m=>{Q.logEvent("chatgpt_regenerate_try_again_button_clicked",f.value,{requestedModelId:f.value,...X({clientThreadId:t,messageId:a})}),o({sourceEvent:m,requestedModelId:f.value})},includeRegenerate:!0,onMouseEnter:()=>r(f.value),onMouseLeave:()=>r(null),messageModelSlug:s,includeCheck:!1,className:Ee,...f,label:d.formatMessage(Ge.tryAgain),subtitle:f.label,icon:e.jsx(rt,{className:R}),clientThreadId:t},f.value),P.filter(m=>m.condition).map(m=>e.jsx(we,{onSelect:_=>{Q.logEvent(m.eventName,f.value,{requestedModelId:f.value,...X({clientThreadId:t,messageId:a})}),o({sourceEvent:_,requestedModelId:f.value,extraStreamParams:m.extraStreamParams})},includeRegenerate:!1,onMouseEnter:()=>r(m.key),onMouseLeave:()=>r(null),isHovered:l===m.key,messageModelSlug:s,includeCheck:!1,className:Ee,...f,label:m.label,subtitle:"",icon:m.icon,clientThreadId:t},m.key))]})]})}const Ge=Qs({tryAgain:{id:"VbsBGW",defaultMessage:"Try again"},search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),qr=i.memo(Ur),Or=le(()=>de(()=>import("./o3z8kdtii15b9xui.js"),__vite__mapDeps([7,2,1,3,4,5,8,9])).then(t=>t.VoicePlayButton)),Hr=le(async()=>Promise.resolve(()=>null)),Gr=({alwaysShow:t,isUserTurn:n,children:a})=>{const s=i.useRef(null);return i.useEffect(()=>{const o=s.current;o&&(t?requestAnimationFrame(()=>{o&&(o.style.maskPosition=t?"0% 0%":"")}):o.style.maskPosition="")},[t]),e.jsx("div",{className:D("flex",!t&&"absolute start-0 end-0 flex",n?"justify-end":"justify-start"),children:e.jsx("div",{ref:s,className:D("touch:-me-2 touch:-ms-3.5 -ms-2.5 -me-1 flex items-center p-1 select-none",!n&&"-mt-1",t&&"duration-[1.5s]","focus-within:transition-none hover:transition-none",!(t||n)&&"duration-500 group-hover/turn-messages:delay-300",!n&&["pointer-events-none [mask-image:linear-gradient(to_right,black_33%,transparent_66%)] [mask-position:100%_0%] [mask-size:300%_100%] motion-safe:transition-[mask-position]","group-hover/turn-messages:pointer-events-auto group-hover/turn-messages:[mask-position:0_0]","group-focus-within/turn-messages:pointer-events-auto group-focus-within/turn-messages:[mask-position:0_0]","has-data-[state=open]:pointer-events-auto has-data-[state=open]:[mask-position:0_0]"],n&&["duration-300 group-hover/turn-messages:delay-300","pointer-events-none opacity-0 motion-safe:transition-opacity","group-hover/turn-messages:pointer-events-auto group-hover/turn-messages:opacity-100","group-focus-within/turn-messages:pointer-events-auto group-focus-within/turn-messages:opacity-100","has-data-[state=open]:pointer-events-auto has-data-[state=open]:opacity-100"]),children:a})})},Vr=({activeVariantIndex:t,clientThreadId:n,conversationMode:a,lastMessage:s,messages:o,numVariants:r,onChangeIndex:l,onRate:d,showCanvasButton:c,showCopyButton:g,showPagination:u,showPlayButton:p,showRatingButtons:y,showRegenerateButton:f,isJam:h,turn:T,turnIndex:k})=>{const C=Tt(),R=Ae(),P=jt(),m=s?.clientMetadata?.rating;s?.clientMetadata?.requestId;const _=o.findLast(E=>{const[z]=E.author.name?.split(".")??[];return z===Go.T2UAY3K&&Ct.getImageAssetPointers(E).length>0}),A=!!_,w=kt(),S=ya(),N=_a(),I=ce(n),j=!h&&I!=null,x=!w&&_&&S(),v=!w&&!_&&Sa(C);let M=null;return j&&(x||v?M=e.jsx($r,{clientThreadId:n,imageGenMessageId:_?.id,messageSliceIds:o.map(E=>E.id)}):N&&Vo(C,"1547743984").get("show_share_button_inline",!1)&&(M=e.jsx(ge,{onClick:()=>{I&&it.openSharingModal(I)},label:R.formatMessage({id:"ConversationTurn.shareButtonTooltip",defaultMessage:"Share conversation"}),className:"sm:hidden",icon:lt}))),e.jsxs(e.Fragment,{children:[u&&e.jsx(ct,{currentPage:t,onChangeIndex:l,length:r}),!1,g&&e.jsx(Ut,{onClick:E=>{Rt(C,n,k,P,E)}}),!A&&y&&e.jsxs(e.Fragment,{children:[m!=="thumbsDown"&&e.jsx(ge,{onClick:()=>d("thumbsUp"),disabled:m==="thumbsUp",icon:m==="thumbsUp"?Ta:dt,label:R.formatMessage({id:"ConversationTurn.goodResponseTooltip",defaultMessage:"Good response"}),testId:"good-response-turn-action-button"}),m!=="thumbsUp"&&e.jsx(ge,{onClick:()=>d("thumbsDown"),disabled:m==="thumbsDown",icon:m==="thumbsDown"?ja:ut,label:R.formatMessage({id:"ConversationTurn.badResponseTooltip",defaultMessage:"Bad response"}),testId:"bad-response-turn-action-button"})]}),p&&s&&e.jsx(Or,{conversationId:n,message:s,iconClassName:"icon-md",className:"text-token-text-tertiary hover:text-token-text-primary gap-1.5 rounded-md p-1 text-xs"}),!A&&c&&e.jsx(Ca,{turn:T}),f&&s&&e.jsx(Wr,{clientThreadId:n,conversationMode:a,lastMessage:s,messages:o,hasImageGenMessage:A}),M]})},zr=({activeVariantIndex:t,clientThreadId:n,numVariants:a,onAnticipateEdit:s,onChangeIndex:o,onEnterEdit:r,showCopyButton:l,showEditMessageButton:d,showPagination:c,turnIndex:g})=>{const u=Tt(),p=jt();return e.jsxs(e.Fragment,{children:[l&&e.jsx(Ut,{onClick:y=>{Rt(u,n,g,p,y)}}),d&&e.jsx(ka,{onAnticipateEdit:s,onEnterEdit:r}),c&&e.jsx(ct,{currentPage:t,onChangeIndex:o,length:a})]})},Wr=({clientThreadId:t,conversationMode:n,messages:a,hasImageGenMessage:s,lastMessage:o})=>{const r=Ma({clientThreadId:t,conversationMode:n}),l=wa(t,o),d=i.useCallback(({sourceEvent:c,requestedModelId:g,appendMessages:u,extraStreamParams:p})=>{o&&r({sourceEvent:c,nodeId:o.id,requestedModelId:g,appendMessages:u,extraStreamParams:p})},[o,r]);return s?e.jsx(Hr,{messages:a,onModelSelect:d}):e.jsx(qr,{className:"text-token-text-secondary hover:bg-token-main-surface-secondary touch:px-2.5 h-[30px] rounded-md px-1.5",clientThreadId:t,message:o,onModelSelect:d,canRegenerateResponse:l})},Ut=({onClick:t})=>{const[n,a]=i.useState(!1),s=Ia(),o=Ae(),r=i.useCallback(l=>{l.stopPropagation(),B.logEvent("ChatGPT Turn Action Copy Clicked"),t(l),a(!0),setTimeout(()=>{s()&&a(!1)},2e3),Q.logEvent("chatgpt_turn_action_copy")},[s,t]);return e.jsx(ge,{icon:n?zo:Wo,onClick:r,label:o.formatMessage({id:"CopyButton.copyTooltip",defaultMessage:"Copy"}),testId:"copy-turn-action-button"})};function $r({clientThreadId:t,imageGenMessageId:n,messageSliceIds:a}){const[s,o]=i.useState(!1),r=Ae(),l=gr({clientThreadId:t,imageGenMessageId:n,messageSliceIds:a});return i.useEffect(()=>{B.logEventWithStatsig("Share Post: Share Button Shown","chatgpt_post_share_button_shown",{source:"turn_action"})},[]),e.jsx(ge,{onClick:async()=>{o(!0);try{await l()}finally{o(!1)}B.logEventWithStatsig("Share Post: Share Button Clicked","chatgpt_post_share_button_clicked",{source:"turn_action"})},label:r.formatMessage({id:"ConversationTurn.sharePostButtonTooltip",defaultMessage:"Share"}),icon:s?$o:lt,disabled:s})}const Vs=[1,2,3,4,10,20,30],Yr=1,Kr=["g-67e595af0a408191b84ee532fca12cd1","g-67ec3b78892481918c89067962526695","g-67ec3b4988f8819184c5454e18f5e84b","g-67ec3ad40750819181ccffa6a6f050d5","g-67edaaa3d3a081918205d0c470f00a32","g-67edab030ac881918ce8fa5c75a8e1b3","g-67edab2fc0f48191881a20ac98fedf6f","g-67edab4a24fc8191b975acaa8da2dcef"];function Qr({clientThreadId:t}){const n=mt(gt.isBusinessWorkspace),a=ht(),s=i.useRef(!1),o=Mt(t),[r,l,d,c]=ee(t,x=>[x?.mode,L.getRequestId(x),L.getConversationLastTurn(x),L.getConversationTurns(x).filter(v=>v.role===V.Assistant).length]),{isUnauthenticated:g}=wt(),u=i.useMemo(()=>{if(!o)return-1;const x=Js(o);return x()>Yr?-1:Vs[Math.floor(x()*Vs.length)]},[o]),p=ss(l),y=function(){return Math.random()<.5?"default":"personality_v1"},[f,h]=i.useState(null),[T,k]=i.useState(!1),[C,R]=i.useState(!1),[P,m]=i.useState(!1),[_,A]=i.useState(y),w=(x,v)=>{const M=d?.messages[0]?.id;h(x),A(v),N(M,x,v)},S=d?.role===V.Assistant,N=i.useMemo(()=>Ea((x,v,M)=>{o&&x&&(n&&a?Na({rating:Aa(v),shown_at_assistant_turn:u,prompt:M},o,x):n||yt.safePost("/conversation/{conversation_id}/rating",{parameters:{path:{conversation_id:o}},requestBody:{message_id:x,rating:v,shown_at_assistant_turn:u,prompt:M},anonAware:!0})),B.logEvent("Conversation Rating Submitted",{rating:v,showAtAssistantTurn:u,conversationId:o,prompt:M}),k(!0),setTimeout(()=>{R(!0)},1500)},2e3),[n,a,o,u]),I=c!==u||p||!S||!!n&&!a||r?.kind!==It.PrimaryAssistant&&r?.gizmo_id!==void 0&&!Kr.includes(r?.gizmo_id)||P||g;i.useEffect(()=>{!I&&!s.current&&(B.logEvent("Conversation Rating Shown",{showAtAssistantTurn:u,conversationId:o}),s.current=!0)},[I]);const j=Ra();return P||!j.forceShowConvoRating&&I?null:e.jsxs("div",{className:"mx-auto",children:[e.jsx(fe,{children:T&&!C&&e.jsx(H.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(zs,{$padded:!0,children:e.jsx("span",{className:"text-token-text-tertiary text-sm",children:e.jsx(U,{id:"rating.thanks",defaultMessage:"Thanks for your feedback!"})})})},"submitted")}),!T&&e.jsx(H.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},children:e.jsxs(zs,{$padded:!1,children:[e.jsxs("div",{className:"text-token-text-secondary flex items-center justify-center gap-4 px-4 py-3 text-sm",children:[_==="personality_v1"?e.jsx(U,{id:"rating.instructions.personality_v1",defaultMessage:"Do you like this personality?"}):e.jsx(U,{id:"rating.instructions.default",defaultMessage:"Is this conversation helpful so far?"}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx(Ve,{$selected:f==="thumbsUp",onClick:()=>w("thumbsUp",_),children:e.jsx(dt,{className:"icon-md"})}),e.jsx(Ve,{$selected:f==="thumbsDown",onClick:()=>w("thumbsDown",_),children:e.jsx(ut,{className:"icon-md"})})]})]}),e.jsx("div",{className:"bg-token-main-surface-tertiary w-px flex-1 self-stretch"}),e.jsx(Ve,{className:"p-3",$selected:!1,onClick:()=>m(!0),children:e.jsx(Yo,{className:"icon-md text-token-text-secondary hover:text-token-text-primary"})})]})},"rating")]})}const Ve=ne.button`
  ${t=>t.$selected?"text-token-text-primary":"text-token-text-secondary"}
  hover:text-token-text-primary
`,zs=ne.div`inline-flex rounded-xl border border-gray-100 dark:border-gray-700
${t=>t.$padded&&"py-3 px-4"}
`,Xr=le(()=>de(()=>import("./lcvpbf4bczccsy4p.js"),__vite__mapDeps([10,2,1,3,4,5,11])));function Jr({clientThreadId:t,canShowInlineMessageFeedback:n,messageForRating:a,allGroupedMessages:s,currentModelId:o}){const r=ts()?.isWorkspacePlan()??!1;let l=null;const d=ee(t,y=>{const f=L.getConversationTurns(y);let h=0;for(let T=f.length-1;T>=0;T--){const k=f[T];if(k.messages.some(C=>C.metadata?.is_indepth_feedback))return!0;if(k.messages.some(C=>C.author.role===V.Assistant)&&h++,h>=3)break}return!1}),c=Mt(t),g=Fa(y=>y.voiceFeedbackThread),u=c===g,{voiceName:p}=Pa();return d?null:(u&&c&&!r?(Ko.feedbackShown.success({voice:p}),l=e.jsx("div",{className:"text-center",children:e.jsx(La,{serverThreadId:c})})):a.clientMetadata?.rating&&n?l=e.jsx(Xr,{clientThreadId:t,conversationMessage:a,allGroupedMessages:s,currentModelId:o}):l=e.jsx("div",{className:"text-center",children:e.jsx(Qr,{clientThreadId:t})}),e.jsx("div",{className:"mt-3 w-full empty:hidden",children:l}))}const Zr=le(()=>de(()=>import("./ekgf5i67wuz61x89.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(t=>t.MemoryActionResult)),ei=le(()=>de(()=>import("./dtivam8szgj0eqoa.js"),__vite__mapDeps([12,2,4,1,3,5,13,14])).then(t=>t.AutomationSourceHeader)),Ws=le(()=>de(()=>import("./fjoemqu4b3cvmhnq.js"),__vite__mapDeps([15,2,1,3,4,5])).then(t=>t.TextMessageEditor)),$s=80,si=16,Ys={minHeight:`calc(100dvh - ${uo}px - 120px)`};function ti(t){const{turnIndex:n,isFinalTurn:a,clientThreadId:s,onRequestCompletion:o,currentModelId:r,avatarClassName:l,showAvatar:d,scrollToMessageId:c,dateHeaderType:g}=t,{isNewScrollEnabled:u}=pt(),p=Xs();ts()?.normalizedAccountUserId;const y=!!p&&Qo(p),f=Da(),h=mt(gt.isBusinessWorkspace),T=xt(),{value:k}=pe("1760640904"),{value:C}=pe("1456513860"),R=d??!C,m=null!=null,{value:_}=pe("1887864177"),{capabilitySuggestionsEnabled:A}=ot(),w=Ua(),[S,N]=ee(s,b=>{const O=L.getConversationTurnAtIndex(b,n),$=n>0?L.getConversationTurnAtIndex(b,n-1):null,q=$?.role===V.User&&$.messages.some(G=>G.metadata?.visually_hide_response_from_conversation);return[O,q]}),{messages:I,messageGroups:j}=S,x=Ba(),v=I[0],M=F(I),{messages:E,visibleMessages:z,messageGroups:xe,lastMessageToRender:se,doesTurnHaveDelayedMessages:ue}=i.useMemo(()=>{const b=x.size===0?-1:j.findIndex(G=>G.type===Oe?G.groups.some(oe=>oe.messages.some(Be=>x.has(Be?.id))):G.messages.some(oe=>x.has(oe?.id))),O=b!==-1&&b+1<j.length,$=O?j.slice(0,b+1):j,q=O?$.flatMap(G=>G.type===Oe?G.groups.flatMap(oe=>oe.messages):G.messages):I;return{messages:q,visibleMessages:q.filter(Xo),messageGroups:$,lastMessageToRender:F(q),doesTurnHaveDelayedMessages:b!==-1}},[I,j,x]),ve=i.useMemo(()=>({clientThreadId:s,turnIndex:n,messageId:M?.id}),[s,n,M?.id]),Y=!1,[as,os]=i.useState(!1),[Bt,qt]=i.useState(!1),Ot=i.useContext(qa)!=null,W=S.role===V.User,rs=kt(),be=Jo(s),Fe=Oa(S.gizmoId??be).data,Pe=ft(s),Ht=Ha(s),is=Ga(Pe),Gt=Va(Pe,Ht),ls=ht(),[ye,Vt,zt,cs,Le,ci,Wt,$t,Yt,ds,Kt,ae,us]=ee(s,b=>{const O=L.getParentPromptNode(b,v.id),$=O?.message.clientMetadata?.variantsInStreamInfo??(O?.message.metadata?.paragen_variant_choice?void 0:O?.message.metadata?.paragen_variants_info),q=L.getVariantIds(b,v.id),G=L.getCurrentVariantId(b,v.id),oe=L.getIsDoNotRemember(b),Be=G?q.indexOf(G):0,Pn=$&&b?.tree!=null&&q.some(re=>{const{errType:ks}=b.tree.getLeafFromNode(re).message.clientMetadata??{};return ks!=null&&ks!=="info"}),qe=L.getConversationTurns(b);return[b?.async_status===Es.STREAMING,L.isMessageTurnEnded(b,M?.id),Pn,mo(b?.mode,Fe?.gizmo.id),b?.continuingFromSharedConversationId!=null,null,qe.findIndex(re=>re.role===V.User)===n,nr(qe,re=>re.role===V.User)===n,qe.findIndex(re=>re.role===V.Assistant)===n,L.getRequestId(b,M?.id),$,q,Be,oe]});let Qt="default";const Xt=E.some(b=>b.content.content_type===Zo.MultimodalText),{layer:Jt}=Ke("3119715334"),Zt=Jt.get("should-enable-skip",!1),{isUnauthenticated:ms}=wt(),gs=S.messages.map(b=>b.id),J=i.useRef(null),hs=!u&&(c?.length??0)>2&&c!=="finalAgentTurn"&&a&&T,_e=W?F(z):void 0,De=_e?.id,en=i.useCallback(()=>{De&&(B.logEvent("Edit Prompt",{id:De,threadId:ce(s)}),Q.logEvent("chatgpt_edit_prompt"),os(!0))},[De,s]),sn=i.useCallback(()=>{os(!1)},[]),ps=za()??!1,{onChangeRating:tn}=Wa({clientThreadId:s,currentModelConfig:Pe}),nn=b=>{if(!M)return;tn({nodeId:M.id,messageId:M.id,rating:b});const O=ps&&j.some($=>$.type!==Oe&&$.messages?.some(go));B.logEventWithStatsig(b==="thumbsDown"?"Message Feedback Thumbs Down Clicked":"Message Feedback Thumbs Up Clicked","chatgpt_thumb_feedback",{id:M.id,threadId:ce(s),model:r,rating:b,...ps?{isCATriggered:O}:{}}),qt(!0)},[an]=i.useState(()=>Date.now()),on=$a(s),{layer:rn}=Ke("109457",{shouldLogExposure:!1}),fs=ee(s,b=>on&&L.getConversationTurns(b).filter(O=>O.role===V.Assistant).length<=rn.get("onboarding_inject_cards_position",3)),xs=ds!=null,ln=ss(ds),Z=!Vt&&ln||ue,vs=vt(),[cn,bs]=i.useState(xs),ys=i.useRef(!1),dn=Ya(s,M),[,un]=qn();i.useEffect(()=>{const O=new URLSearchParams(window.location.search).get("message");!(O!=null&&gs.includes(O))||!J.current||(J.current.scrollIntoView({behavior:"instant"}),un(q=>(q.delete("message"),q),{replace:!0,preventScrollReset:!0}))},[]),i.useEffect(()=>{if(u)return;const $=new URLSearchParams(window.location.search).get("message")!=null;if(ys.current||$||c===void 0||!T||!J.current){c==="finalAgentTurn"&&a&&he(s,q=>{q.scrollToMessageId=void 0});return}(gs.includes(c)||c==="finalAgentTurn"&&a)&&(ys.current=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(J.current)if(c==="finalAgentTurn"&&a)J.current.scrollIntoView({behavior:"instant",block:"end"}),he(s,q=>{q.scrollToMessageId=void 0});else{const q=J.current.offsetHeight;let G;q>$s?G=$s-q:G=0,J.current.style.scrollMarginTop=`${G+si}px`,J.current.scrollIntoView({behavior:"smooth"})}})}))},[c,J.current]);const{showDebugConversationTurns:mn}=Zs(),gn=Ka(),hn=!f&&!Le&&!rs&&!W,pn=Qa(),fn=se?.author.role===V.Assistant?se:null,xn=se?.metadata?.system_hints?.includes(te.Research);Xa({isCompletionRequestInProgress:Z,isUserTurn:W,message:fn});const{isOpen:vn}=Ja(),bn=Za(),Se=eo(cs),Te=!pn&&!Se&&hn&&a&&Kt?.num_variants_in_stream===2&&ae.length<=2&&!M?.clientMetadata?.inlineComparisonRating&&!zt,je=a&&xs,yn=so(s)?.value===Es.STREAMING,_n=(cn||je)&&!as&&!f&&!Le&&!Se&&!ye&&!Z&&!vn&&!fs&&!yn&&S.role!==V.Developer,Sn=E.some(b=>er(b)===sr.l1239dk1),Tn=je&&!Z&&!Le&&!f&&!Sn&&(_||w||A),Ce=M!=null&&!m&&(!h||Gt||y||ls)&&!Se&&!ms&&!rs&&!M.metadata?.b1de6e2_s,jn=(!h||ls)&&Ce&&je&&!ye&&!Z,_s=!f&&!((Z||ye)&&a)&&ae.length>1&&!Te&&!m&&!fs,Ss=W&&E.some(b=>to(b)?.shouldHideContent),Cn=W&&_e!=null&&!Se&&!f&&!Xt&&!Ss&&!ms&&!m&&!xn,kn=M!=null&&(M.clientMetadata?.disclaimers??[]).length===0,Ts=i.useCallback(b=>{he(s,O=>{es.setCurrentBranch(O,ae[b])}),B.logEvent("Change Active Node",{intent:"toggle_between"})},[s,ae]),Mn=no(S,E,mn),{toggleThreadSidebar:js}=tr(),ke=M?.id,wn=i.useCallback(()=>{ke&&js({type:"retrievalResults",clientThreadId:s,turnIndex:n,messageId:ke})},[ke,js,s,n]),In=i.useMemo(()=>ao(S,is,!!be),[is,be,S]);if(!Mn&&!Te)return hs?e.jsx("div",{style:Ys}):null;if(N)return null;const En=se?.metadata?.followup_prompts?se.metadata.followup_prompts.map(b=>({text:b,type:nt.Reply})):[],Nn=se?.metadata?.category_suggestions,Rn=!E.some(b=>Ct.getAudioAssetPointers(b).length>0)&&!m&&!be,An=!Z&&E.some(b=>b.author.role===V.Assistant&&b.metadata?.onboarding?.main_usages),Ue=E.find(b=>!!b.metadata?.onboarding?.examples)?.metadata?.onboarding?.examples,Cs=!Ss&&(!W||k)&&(!a||!Z);if(gn&&!m&&!a&&z.length===0)return null;const Fn=!a&&S.messages.some(b=>b.clientMetadata?.isLastMessageFromSharedConversation);return e.jsxs(oo.Provider,{value:Yt,children:[e.jsx(ro,{dateHeaderType:g,turn:S}),e.jsxs("article",{className:D("text-token-text-primary w-full",!u&&c==="finalAgentTurn"&&T?"opacity-0":"",{hidden:Ot&&Wt}),style:hs?Ys:void 0,ref:J,dir:"auto","data-testid":`conversation-turn-${n}`,"data-scroll-anchor":!u&&a,children:[e.jsx(io,{role:S.role}),e.jsxs(We,{verticalPadding:Qt,horizontalPadding:Te?"none":"standard",children:[Te?e.jsxs(e.Fragment,{children:[e.jsx(xr,{isFeedbackEnabled:Ce,variantIds:ae,conversationTurnMountTime:an,...t}),Zt&&e.jsx("div",{className:"mt-4 flex w-full justify-center",children:e.jsxs(_t,{color:"secondary",className:"text-token-text-primary","data-testid":"paragen-skip-button",onClick:()=>{bt.publish({kind:"requestCompletion",isForSkippingParagen:!0})},children:[e.jsx(lo,{className:"text-token-text-secondary me-1"}),e.jsx(U,{id:"IuTr+b",defaultMessage:"Skip"})]})})]}):e.jsx(Ne,{tabIndex:-1,className:"group/turn-messages focus-visible:outline-hidden",onFocus:()=>bs(!0),onPointerEnter:()=>bs(!0),children:e.jsxs(e.Fragment,{children:[Y,!W&&!Y&&R&&e.jsx(ai,{children:e.jsx(Xe,{messages:E,isUserTurn:W,avatarClassName:l,gizmo:Fe})}),e.jsx("div",{className:$e({isUserTurn:W}),children:e.jsx("div",{className:"relative flex-col gap-1 md:gap-3",children:e.jsxs(e.Fragment,{children:[null,!W&&!f&&e.jsx(Zr,{messages:E,clientThreadId:s,gizmoId:Fe?.gizmo.id}),bn&&!W&&e.jsx(ei,{clientThreadId:s,messages:E}),as&&_e?e.jsx(Ws,{message:_e,clientThreadId:s,onRequestCompletion:o,onExitEdit:sn,disabled:vs}):e.jsx(Qe,{allMessages:I,groupedMessagesToRender:xe,allGroupedMessages:j,...t,isUserTurn:W,isFinalUserTurn:$t,isCompletionRequestInProgress:Z,isFeedbackEnabled:Ce,isFinalTurn:a,hasActiveRequest:vs}),In&&e.jsx(br,{handleShowRetrievalResults:wn,clientThreadId:s,turnIndex:n,responseComplete:!(Z||ye)}),An&&e.jsx(lr,{clientThreadId:s}),Ue&&Ue.length>0&&!Z&&e.jsx(cr,{clientThreadId:s,examples:Ue}),_n&&e.jsx(Gr,{isUserTurn:W,alwaysShow:je,children:W?e.jsx(zr,{activeVariantIndex:us,clientThreadId:s,numVariants:ae.length,onAnticipateEdit:Ws.prefetch,onChangeIndex:Ts,onEnterEdit:en,showCopyButton:Cs,showEditMessageButton:Cn,showPagination:_s,turnIndex:n}):e.jsx(Vr,{activeVariantIndex:us,clientThreadId:s,conversationMode:cs,lastMessage:M,messages:E,numVariants:ae.length,onChangeIndex:Ts,onRate:nn,showCanvasButton:dn&&!m,showCopyButton:Cs,showPagination:_s,showPlayButton:kn,showRatingButtons:Ce,showRegenerateButton:Rn,isJam:m,turn:S,turnIndex:n})}),jn&&e.jsx(Jr,{canShowInlineMessageFeedback:Bt,clientThreadId:s,messageForRating:M,allGroupedMessages:j,currentModelId:r}),Tn&&e.jsx(Rr,{followups:En,categorySuggestions:Nn,clientThreadId:s,lastMessageId:ke,analyticsMetadata:ve})]})})})]})}),Fn&&e.jsx("div",{className:"mx-auto mt-8 -mb-2 flex justify-center",children:e.jsxs("p",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(co,{className:"icon-xs me-2"}),e.jsx(U,{id:"threadLayout.sharedConversationPrivateDisclaimer",defaultMessage:"Messages beyond this point are only visible to you"})]})})]})]})]})}const ni=Bn.memo(ti),ai=ne.div`shrink-0 flex flex-col relative items-end`;function oi(t){const n=L.getConversationTurns(t),a=n.findIndex(o=>o.role===V.Assistant);if(a===-1)return;const s=n[a];for(let o=0;o<s.messageGroups.length;o++)if(s.messageGroups[o].type===Ns.SearchGPTQuery){const l=s.messageGroups.slice(o+1).find(({type:c})=>c===Ns.Text);if(l==null)return;const d=ar(l.messages[0]);if(d?.[0]?.type==="navigation")return{turnIndex:a,navigationCitation:d[0],message:l.messages[0]}}}function ri(t,n){if(n==null||t==null)return t;const a=new Set(t.domains.map(s=>s.url));return{...t,domains:[...t.domains,...n.domains.filter(s=>!a.has(s.url))],safe_urls:[...t.safe_urls??[],...n.safe_urls??[]]}}function ii({clientThreadId:t,prefetchNavlink:n,setPrefetchNavlink:a}){const s=i.use(n),{value:o}=pe("1032814809");i.useEffect(()=>{window.__oai_SSR_NAVLINK&&ho.logEvent("Search Tool Page Load Time To Fast Nav SSR",{server_timing:s?.timing},window.__oai_SSR_NAVLINK)},[]),i.useEffect(()=>{s==null&&a(void 0)},[s,a]);const r=i.useMemo(()=>s==null?null:{...s.navlink,domains:s.navlink.domains.map(c=>({...c,subtitle:c.subtitle??c.domain}))},[s]),l=ee(t,oi),d=i.useMemo(()=>ri(r,l?.navigationCitation),[l,r]);return s==null||d==null?null:e.jsxs("div",{children:[e.jsx(We,{horizontalPadding:"standard",children:e.jsx(Ne,{children:e.jsx("div",{className:$e({isUserTurn:!0}),children:e.jsx("div",{className:po(!0),children:e.jsx(fo,{containsImagesOrAttachments:!1,isUserTurn:!0,children:e.jsx(xo,{text:s.query})})})})})}),e.jsx("div",{className:"-mb-10",children:e.jsx(We,{horizontalPadding:"standard",children:e.jsx(Ne,{children:e.jsxs("div",{className:$e({isUserTurn:!1}),children:[e.jsx(mr,{clientThreadId:t,turnIndex:l?.turnIndex??2,nextMessage:l?.message,navigationCitation:d}),o?e.jsxs("div",{className:"text-token-text-secondary relative -top-2 flex justify-end gap-2 font-mono text-xs",children:[e.jsxs("div",{elementtiming:"navlink",children:["server: ",s.timing,"ms"]}),e.jsx(li,{})]}):null]})})})}),e.jsx(vo,{scriptSrc:"requestAnimationFrame(()=>window.__oai_SSR_NAVLINK=window.__oai_SSR_NAVLINK||performance.now());"})]})}function li(){const[t,n]=i.useState(null);return i.useEffect(()=>{const a=new PerformanceObserver(s=>{s.getEntries().forEach(o=>{if(o.identifier==="navlink"){const r=o.renderTime;n(l=>l??r)}})});return a.observe({type:"element",buffered:!0}),()=>a.disconnect()},[]),t==null?null:e.jsxs("span",{children:["render: ",t,"ms"]})}function Ti({onRequestCompletion:t,clientThreadId:n,scrollContainerRef:a,prefetchNavlink:s,setPrefetchNavlink:o}){const[r,l,d,c]=ee(n,v=>[v?.mode,L.getConversationTurnIds(v),v?.conversationOrigin===or.APPLE,v?.scrollToMessageId]),{isNewScrollEnabled:g}=pt(),u=bo(),p=yo(),y=xt(),f=_o(),[h]=So(),T=To(),[k]=jo(),C=ft(n),R=u.store.useContentAreaDimensions(Co.Header,v=>v?.height?v.height:void 0),P=ko(C.id),m=r?.kind===It.GizmoMagicCreate?"bg-token-main-surface-primary text-token-text-primary":P;i.useEffect(()=>{p&&(Q.logEvent("chatgpt_continue_conversation_page_loaded"),B.logEvent("Continue Conversation: Page Loaded"),Q.logEvent("chatgpt_conversation_share_page_loaded"),B.logEvent("Share Public Chat: Shared Conversation Loaded"))},[p]);const _=i.useCallback(()=>{g||f({behavior:"smooth"})},[g,f]),[A,w]=i.useState(!1),S=A||!y,N=Mo(n),I=i.useRef(null),{getAndroidKeyboardLayout:j}=wo(),x=Io(n);return e.jsxs("div",{onCopy:N,className:D("@thread-xl/thread:pt-header-height mt-1.5 flex flex-col text-sm",j()&&"keyboard-open:pb-[calc(var(--composer-height,100px)+var(--screen-keyboard-height,0))]",R?null:!g&&"pb-25"),style:{paddingBottom:R},children:[s?e.jsx(rr,{name:"prefetch-navlink",onError:v=>{Ye.addError("Error with prefetch navlink",{error:v}),o(void 0)},children:e.jsx(i.Suspense,{fallback:null,children:e.jsx(ii,{clientThreadId:n,prefetchNavlink:s,setPrefetchNavlink:o})})}):null,p&&e.jsxs(e.Fragment,{children:[e.jsx(Ne,{children:e.jsx("p",{className:"text-xs text-gray-500",children:e.jsx(U,{id:"threadLayout.sharedConversationCopyDisclaimer",defaultMessage:"This is a copy of a conversation between ChatGPT & Anonymous."})})}),e.jsx("div",{className:"text-token-text-primary text-center text-xs font-semibold",children:e.jsx("button",{onClick:()=>{it.openModal(Eo.ReportConversation),Q.logEvent("chatgpt_conversation_share_report_content_clicked",null,{location:"Static Shared Thread Page"}),B.logEvent("Share Public Chat: Report Content Clicked",{location:"Dynamic Shared Thread Page"})},children:e.jsx(U,{id:"thread.reportSharedConversation",defaultMessage:"Report content"})})})]}),l.map((v,M)=>e.jsx(ni,{isFinalTurn:M===l.length-1,turnIndex:M,clientThreadId:n,onRequestCompletion:t,currentModelId:C.id,avatarClassName:m,scrollToBottom:g?void 0:_,scrollToMessageId:g?void 0:c,dateHeaderType:x(M),showAvatar:void 0},v)),!g&&e.jsxs(e.Fragment,{children:[a?.current&&e.jsx(ir,{setIsScrolledToEdge:v=>{w(v)},options:{root:a.current,threshold:0,rootMargin:"0%"}},"threadBottomEdgeScrollObserver"),e.jsx("div",{ref:I}),d&&h&&!k&&e.jsx(Ks,{className:D("translate-y-[10px] md:translate-y-[30px]"),onClick:()=>{Q.logEvent("chatgpt_thread_scroll_to_top"),T({behavior:"smooth"})},children:e.jsx(No,{className:"icon-md text-token-text-primary"})}),e.jsx(fe,{children:S&&e.jsx(H.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15,ease:"easeInOut"},children:e.jsx(Ks,{className:D(R?null:"bottom-8"),style:{bottom:R},onClick:()=>{Q.logEvent("chatgpt_thread_scroll_to_bottom"),I.current?.scrollIntoView({behavior:"smooth",block:"end"})},children:e.jsx(Ro,{className:"icon-md text-token-text-primary"})})})})]})]})}const Ks=ne.button`cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-token-text-secondary border-token-border-default end-1/2 translate-x-1/2 bg-token-main-surface-primary w-8 h-8 flex items-center justify-center`;export{Ti as T};
//# sourceMappingURL=jqgeyuwq00z6gkku.js.map
