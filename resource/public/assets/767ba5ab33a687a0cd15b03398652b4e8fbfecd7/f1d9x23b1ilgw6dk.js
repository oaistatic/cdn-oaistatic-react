const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/lvao6zvi0q8tyzbm.js","assets/j12so9ru57hpoz1y.js"])))=>i.map(i=>d[i]);
import{u as z,aU as V,C as H,dU as $,B as G,ao as E,cu as se,D as te,R,T as D,a as X,cU as Z,cW as y,cy as ae,cz as re,aZ as ne,aO as ie,fG as oe}from"./j5zd9vs1l0bwsjqa.js";import{u as _,r as d,j as e,M as i,ah as K,b as J,c as Y,e as P,ag as le,d as ce}from"./j12so9ru57hpoz1y.js";import{m as U}from"./klbsx4kdjyr4mj5x.js";import{cP as de,em as ue,ij as B,ik as ee,il as a,eG as me,im as L,ca as ge,bj as T,eN as pe,aS as xe}from"./jn7p98x7qxquz26a.js";import{A as he}from"./eg9sf8vq052xdqjq.js";import{b as fe,c as je,u as ye}from"./bsx5it5i69ktteto.js";import{V as Me}from"./d3y72ugnrmac5z1v.js";import"./ico83cg07nw4gm43.js";import"./j2m3ef69iou998eo.js";import"./egjzck8f21ldiiq8.js";import"./n5601invkykfg1ys.js";import"./b0v1yruiy44zd1p9.js";import"./msp412gwqdn605it.js";import"./ok8fnoyzbnoyk9qs.js";import"./owhjnpwqw9ddu7v0.js";import"./d8hi8vzea1zd4sdu.js";import"./hxt8zt4ovcs39phn.js";import"./b808i0mobwfw0uar.js";import"./b4wy8ndq94672kqa.js";import"./n0tk3xne532h7ges.js";import"./e2i9dno9lalz25o9.js";import"./01yrv2o49ye0ebr7.js";import"./dcbnlt0qk59dcwle.js";import"./kfx9sm4pjzhy5hcb.js";import"./fe0hu88t4g44z3ii.js";import"./doknjlw48az0ww3q.js";const Q=1e3;function we({group:s,isOpen:n,onClose:l}){const x=_(),h=z(),u=x.formatMessage({id:"workspaceSettings.groups.addMember",defaultMessage:"Add members to the {groupName} group"},{groupName:s.name}),p=V(),[j,g]=d.useState([]),[f,c]=d.useState(!1);async function b(){const M=p?.getWorkspaceId();if(!M)throw new Error("No workspace ID found");c(!0);const C=await E.bulkAddWorkspaceGroupUsers(M,s.id,j);h.success(x.formatMessage({id:"yU4Zf0",defaultMessage:"Added {numUsers} users to the group"},{numUsers:C.added_group_users.length})),l?.(),c(!1)}return e.jsxs(H,{testId:"modal-bulk-add-group-members",isOpen:n,onClose:l??$,title:u,type:"success",showCloseButton:!0,primaryButton:e.jsx(G,{onClick:b,disabled:j.length===0||j.length>Q,loading:f,children:e.jsx(i,{id:"EpbOzA",defaultMessage:"Add users to group"})}),children:[e.jsx(Se,{onChange:g}),j.length>Q&&e.jsx("div",{className:"text-token-text-error mt-2 text-sm",children:e.jsx(i,{id:"9lp0Tc",defaultMessage:"Email list is limited to {maxEmails} users at once",values:{maxEmails:Q}})})]})}function Se({onChange:s}){const[n,l]=d.useState("");return e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsxs("label",{htmlFor:"group-email-paste",children:[e.jsx(i,{id:"qvGcSC",defaultMessage:"Emails"}),e.jsx("br",{}),e.jsx("span",{className:"text-token-text-tertiary text-sm",children:e.jsx(i,{id:"Fhd+5h",defaultMessage:"Paste email addresses here, one per line:"})})]}),e.jsx(de,{id:"group-email-paste",className:"h-[250px] text-sm",value:n,onChange:x=>{l(x.target.value),s(be(x.target.value))},placeholder:`jean@example.com
joohyun@example.com
muhammed@example.com
susan@example.com`})]})}function be(s){return s.split(`
`).map(n=>n.trim()).filter(n=>n.length>0).filter(n=>Me.test(n))}function Ce({group:s,isOpen:n,onClose:l}){const h=_().formatMessage({id:"workspaceSettings.groups.addMember",defaultMessage:"Add members to the {groupName} group"},{groupName:s.name}),p=V()?.getWorkspaceId(),[j,g]=d.useState(""),[f,c]=d.useState(0),{data:b}=ue(p,f*B,j,B,K),[M,C]=d.useState([]),[N,w]=d.useState([]),[S,k]=d.useState("interactive"),m=b?Math.ceil(b.total??0/B):0;async function t(r){w(o=>[...o,r]);try{await Ne(p,s.id,r),C(o=>[...o,r])}catch(o){te.addError(o)}finally{w(o=>o.filter(v=>v!==r))}}return S==="batch"?e.jsx(we,{group:s,isOpen:n,onClose:l}):e.jsx(H,{testId:"modal-add-group-member",type:"warning",isOpen:n,onClose:l??$,title:h,size:"custom",className:"max-w-(--breakpoint-md)",showCloseButton:!0,primaryButton:e.jsx(G,{onClick:l,children:e.jsx(i,{id:"0NAzDq",defaultMessage:"Done"})}),children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex flex-row justify-between",children:[e.jsx("p",{children:h}),e.jsx(G,{onClick:()=>{k("batch")},color:"secondary",children:e.jsx(i,{id:"5GPldp",defaultMessage:"Bulk add users"})})]}),e.jsx(ee,{value:j,inputClassName:"w-full",onChange:r=>{g(r.target.value)}}),e.jsxs(a.Root,{className:"min-w-full",children:[e.jsxs(a.Header,{children:[e.jsx(a.HeaderCell,{children:e.jsx(i,{id:"workspaceSettings.groups.addMember.name",defaultMessage:"Name"})}),e.jsx(a.HeaderCell,{children:e.jsx(i,{id:"workspaceSettings.groups.addMember.email",defaultMessage:"Email"})}),e.jsx(a.HeaderCell,{})]}),e.jsx(a.Body,{children:b?.items.map(r=>e.jsxs(a.Row,{children:[e.jsx(a.Cell,{children:r.name}),e.jsx(a.Cell,{children:r.email}),e.jsx(a.Cell,{textAlign:"right",className:"pe-1",children:e.jsx(G,{size:"small",color:"secondary",disabled:N.includes(r.id),onClick:()=>{M.includes(r.id)||t(r.id)},icon:M.includes(r.id)?se:me,children:M.includes(r.id)?e.jsx(i,{id:"workspaceSettings.groups.addMember.addButton",defaultMessage:"Added"}):e.jsx(i,{id:"workspaceSettings.groups.addMember.addedButton",defaultMessage:"Add"})})})]},r.id))})]}),e.jsx("div",{className:"flex flex-row justify-center",children:e.jsx(L,{currentPage:f,onChangeIndex:r=>{c(r)},length:m})})]})})}async function Ne(s,n,l){await R.safePatch("/accounts/{account_id}/group/{group_id}",{parameters:{path:{account_id:s,group_id:n}},requestBody:{user_id:l}})}const W=10;function ve({workspaceId:s,group:n,readOnly:l}){const x=_(),[h,u]=d.useState(!1),[p,j]=d.useState(""),[g,f]=d.useState(0),{data:c,isLoading:b,isPlaceholderData:M}=J({queryKey:[s,"groups",n.id,p,`members-page-${g}`],queryFn:()=>E.listWorkspaceGroupMembers(s,n.id,p,g*W),placeholderData:K}),[C,N]=d.useState(!1),w=d.useRef(null),S=Y();d.useEffect(()=>{h&&w.current&&w.current.focus()},[h]);const{mutateAsync:k}=P({mutationFn:async m=>await R.safeDelete("/accounts/{account_id}/group/{group_id}/users/{user_id}",{parameters:{path:{account_id:s,group_id:n.id,user_id:m}}}),onMutate:m=>{S.cancelQueries({queryKey:[s,"groups",n.id]});const t=c;return S.setQueryData([s,"groups",n.id,p,`members-page-${g}`],r=>r?{...r,items:r.items.filter(o=>o.id!==m),total:r.total-1}:{limit:10,offset:0,items:[],total:0}),{previousData:t}},onError:(m,t,r)=>{S.setQueryData([s,"groups",n.id,`members-page-${g}`],r?.previousData),S.invalidateQueries({queryKey:[s,"groups",n.id]})},onSettled:async()=>{await new Promise(m=>setTimeout(m,1e3)),S.invalidateQueries({queryKey:[s,"groups"]})}});return e.jsxs("div",{className:"flex w-full flex-col",children:[e.jsxs("div",{className:"flex flex-row items-center",children:[e.jsx("div",{className:"border-token-border-dark mt-3 inline-block h-8 grow-0 border-b-2 text-sm font-semibold",children:e.jsx(i,{id:"workspaceSettings.groups.membersTableTitle",defaultMessage:"Group members"})}),e.jsx("div",{className:"grow"}),e.jsx(D,{label:x.formatMessage({id:"workspaceSettings.groups.searchButtonTooltip",defaultMessage:"Search members"}),children:e.jsx("div",{className:"cursor-pointer p-2",onClick:()=>{u(!0)},children:e.jsx(ge,{className:"icon-sm"})})}),e.jsx("input",{type:"text",ref:w,placeholder:x.formatMessage({id:"workspaceSettings.groups.searchMembers",defaultMessage:"Filter by name or email..."}),className:X("bg-token-surface-primary dark:bg-token-surface-secondary transition-width border-none px-0 duration-300 ease-in-out focus:ring-0",h?"w-64":"w-0"),value:p,onChange:()=>{f(0),j(w.current?.value??"")}})]}),e.jsxs(a.Root,{className:"min-w-full",children:[e.jsxs(a.Header,{children:[e.jsx(a.HeaderCell,{children:e.jsx(i,{id:"workspaceSettings.groups.memberName",defaultMessage:"Name"})}),e.jsx(a.HeaderCell,{children:e.jsx(i,{id:"workspaceSettings.groups.email",defaultMessage:"Email"})}),e.jsx(a.HeaderCell,{})]}),e.jsx(a.Body,{className:b||M?"opacity-50":void 0,children:c==null?e.jsx(a.Row,{children:e.jsx(a.Cell,{colSpan:3,children:e.jsx(Z,{})})}):c.items.length===0?e.jsx(a.Row,{children:e.jsx(a.Cell,{colSpan:3,children:p===""?e.jsx(i,{id:"workspaceSettings.groups.noMembers",defaultMessage:"No members"}):e.jsx(i,{id:"workspaceSettings.groups.noMembersForSearch",defaultMessage:"No members matched the filter"})})}):c.items.map(m=>e.jsxs(a.Row,{children:[e.jsx(a.Cell,{children:e.jsx("span",{className:"ms-3",children:m.name})}),e.jsx(a.Cell,{children:m.email}),e.jsx(a.Cell,{textAlign:"right",children:!l&&(n.is_scim_managed?e.jsx(y.Root,{children:e.jsx(y.Trigger,{disabled:!0,children:e.jsx(D,{sideOffset:0,label:x.formatMessage(U.managedViaSCIMTooltip),className:"flex",side:"right",children:e.jsx(T,{className:"icon-sm"})})})}):e.jsxs(y.Root,{children:[e.jsx(y.Trigger,{className:"-my-2",children:e.jsx(T,{className:"icon-sm"})}),e.jsx(y.Portal,{children:e.jsx(y.Content,{children:e.jsx(y.Item,{onClick:()=>k(m.id),children:e.jsx(i,{id:"workspaceSettings.groups.removeMember",defaultMessage:"Remove member"})})})})]}))})]},m.id))})]}),e.jsxs("div",{className:"my-2 flex flex-row justify-center",children:[!l&&!n.is_scim_managed&&e.jsx(G,{color:"secondary",onClick:()=>N(!0),children:e.jsx(i,{id:"workspaceSettings.groups.addMemberButton",defaultMessage:"Add member"})}),!l&&n.is_scim_managed&&e.jsx(D,{label:x.formatMessage(U.managedViaSCIMTooltip),side:"right",sideOffset:0,children:e.jsx(G,{color:"secondary",disabled:!0,children:e.jsx(i,{id:"workspaceSettings.groups.addMemberButton",defaultMessage:"Add member"})})}),e.jsx("div",{className:"grow"}),c&&c.items.length>0&&e.jsx(L,{currentPage:g,onChangeIndex:m=>{f(m)},length:Math.ceil(c.total/W)})]}),C&&e.jsx(Ce,{isOpen:!0,onClose:()=>{S.invalidateQueries({queryKey:[s,"groups"]}),N(!1)},group:n})]})}const ke=ae(()=>re(()=>import("./lvao6zvi0q8tyzbm.js"),__vite__mapDeps([0,1])).then(s=>s.DirectorySyncResourceManagedIndication)),F=10;function Ge({workspaceId:s}){const n=_(),l=z(),x=ne(),h=!(x?.isAdminOfAccount()||x?.isOwnerOfAccount()),u=Y(),[p,j]=d.useState(""),[g,f]=d.useState(0),{data:c,isLoading:b,isPlaceholderData:M}=J({queryKey:p===""?[s,"groups",`page-${g}`]:[s,"groups","filtered",p,`page-${g}`],queryFn:()=>E.getWorkspaceGroups(s,{query:p,offset:g*F}),placeholderData:K}),[C,N]=d.useState(!1),w=t=>{t&&(f(0),j("")),N(t)},{mutateAsync:S}=P({mutationFn:async({workspaceId:t,name:r})=>await E.createWorkspaceGroup(t,r),onMutate:({workspaceId:t,name:r})=>{u.cancelQueries({queryKey:[t,"groups"]});const o=c;return u.setQueryData([t,"groups","page-0"],v=>(v||(v={limit:10,offset:0,items:[],total:0}),{...v,items:[{id:"new",name:r,num_members:0,created_time:""},...v.items.slice(0,9)]})),{previousGroups:o}},onError:(t,r,o)=>{u.setQueryData([s,"groups","page-0"],o?.previousGroups),u.invalidateQueries({queryKey:[s,"groups"]}),t.message==="Group with this name already exists."&&l.warning(n.formatMessage({id:"workspaceSettings.groups.duplicateName",defaultMessage:"Group with this name already exists"}),{duration:2})},onSettled:async()=>{await new Promise(t=>setTimeout(t,1e3)),u.invalidateQueries({queryKey:[s,"groups"]})}}),{mutateAsync:k}=P({mutationFn:async t=>await R.safeDelete("/accounts/{account_id}/group/{group_id}",{parameters:{path:{account_id:s,group_id:t}}}),onMutate:t=>{u.cancelQueries({queryKey:[s,"groups","page-0"]});const r=c;return u.setQueryData([s,"groups","page-0"],o=>(o||(o={items:[]}),{...o,items:o.items.filter(v=>v.id!==t)})),{previousGroups:r}},onError:(t,r,o)=>{u.setQueryData([s,"groups","page-0"],o?.previousGroups),u.invalidateQueries({queryKey:[s,"groups"]})},onSettled:async()=>{await new Promise(t=>setTimeout(t,1e3)),u.invalidateQueries({queryKey:[s,"groups"]})}}),{mutateAsync:m}=P({mutationFn:async({workspaceId:t,groupID:r,name:o})=>await R.safePatch("/accounts/{account_id}/group/{group_id}",{parameters:{path:{account_id:t,group_id:r}},requestBody:{name:o}}),onMutate:({workspaceId:t,groupID:r,name:o})=>{const v=u.getQueryData([t,"groups",`page-${g}`]);return u.setQueryData([t,"groups",`page-${g}`],A=>(A||(A={items:[]}),{...A,items:A.items.map(q=>q.id===r?{...q,name:o}:q)})),{previousGroups:v}},onError:(t,r,o)=>{u.setQueryData([r,"groups",`page-${g}`],o?.previousGroups),t.message==="Group with this name already exists."&&l.warning(n.formatMessage({id:"workspaceSettings.groups.duplicateName",defaultMessage:"Group with this name already exists"}),{duration:2})},onSettled:async()=>{await new Promise(t=>setTimeout(t,1e3)),u.invalidateQueries({queryKey:[s,"groups"]})}});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-6 mb-3 flex flex-row justify-between gap-2",children:[e.jsx(ee,{inputClassName:"w-[250px]",value:p,onChange:t=>{j(t.target.value),f(0)},placeholder:n.formatMessage({id:"workspaceSettings.groups.search",defaultMessage:"Search group name"})}),!h&&e.jsx(G,{onClick:()=>w(!0),children:e.jsx(i,{id:"workspaceSettings.groups.create",defaultMessage:"Create group"})})]}),e.jsxs("div",{children:[e.jsxs(a.Root,{className:"min-w-full",children:[e.jsxs(a.Header,{children:[e.jsx(a.HeaderCell,{}),e.jsx(a.HeaderCell,{children:e.jsx(i,{id:"workspaceSettings.groups.groupName",defaultMessage:"Group name"})}),e.jsx(a.HeaderCell,{children:e.jsx(i,{id:"workspaceSettings.groups.members",defaultMessage:"Members"})}),e.jsx(a.HeaderCell,{children:e.jsx(i,{id:"workspaceSettings.groups.created",defaultMessage:"Created"})}),e.jsx(a.HeaderCell,{})]}),e.jsxs(a.Body,{className:X((b||M)&&"opacity-50"),children:[C&&e.jsx(I,{group:"new",workspaceId:s,onChangeName:async t=>{t.trim()!==""&&(S({workspaceId:s,name:t}),w(!1))},onDelete:()=>null,readOnly:h}),c==null?e.jsx(a.Row,{children:e.jsx(a.Cell,{colSpan:5,textAlign:"center",children:e.jsx(Z,{})})}):c.items.length===0?e.jsx(a.Row,{children:e.jsx(a.Cell,{colSpan:5,textAlign:"center",children:p===""?e.jsx(i,{id:"workspaceSettings.groups.noGroups",defaultMessage:"No groups found."}):e.jsx(i,{id:"workspaceSettings.groups.noGroupsWithFIlter",defaultMessage:"No groups found. Try changing the search query."})})}):c.items.map(t=>e.jsx(I,{group:t,workspaceId:s,onDelete:k,onChangeName:async r=>{m({workspaceId:s,groupID:t.id,name:r})},readOnly:h},t.id))]})]}),c&&e.jsx("div",{className:"text-center",children:e.jsx(L,{length:Math.ceil(c.total/F),currentPage:Math.min(g,Math.ceil(c.total/F)),onChangeIndex:t=>f(t)})})]})]})}function _e({currentWorkspaceId:s}){const n=_();return e.jsxs(e.Fragment,{children:[e.jsx(pe,{children:e.jsx("title",{children:n.formatMessage(O.title)})}),e.jsx(fe,{title:n.formatMessage(O.title),subtitle:e.jsx(i,{id:"NDDzzF",defaultMessage:"Only workspace admins can edit these settings."})}),e.jsx(je,{showSpinner:!1,children:e.jsx(Ge,{workspaceId:s})})]})}function I({group:s,workspaceId:n,onChangeName:l,onDelete:x,readOnly:h}){const u=_(),{value:p}=ie("2091463435"),[j,g]=d.useState(!1),[f,c]=d.useState(s==="new"?"":s.name),[b,M]=d.useState(!1),[C,N]=d.useState(s==="new"),[w,S]=d.useState(null),k=d.useRef(null);d.useEffect(()=>{(s==="new"||C)&&k.current?.focus()},[s,C]);const m=async()=>{if(f.trim()===""){c(s==="new"?"":s.name),N(!1),M(!1);return}l&&(M(!0),await l(f)),M(!1),N(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs(a.Row,{onClick:()=>g(t=>!t),className:"hover:bg-token-surface-secondary cursor-pointer",children:[e.jsx(a.Cell,{children:e.jsx(he,{checked:j})}),e.jsxs(a.Cell,{children:[s==="new"||C?e.jsx(xe,{ariaLabel:u.formatMessage({id:"RgbuwE",defaultMessage:"New group name"}),ref:k,name:"newGroupName",value:f,disabled:b,placeholder:u.formatMessage({id:"workspaceSettings.groups.groupNamePlaceholder",defaultMessage:"New group name..."}),onChange:t=>c(t.target.value),onBlur:()=>{f!==(s==="new"?"":s.name)&&m()},onPressEnter:m}):s.name,p&&s!=="new"&&s.is_scim_managed&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"grow"}),e.jsx(ke,{})]})]}),e.jsx(a.Cell,{children:e.jsx(i,{id:"workspaceSettings.groups.memberCount",defaultMessage:"{count} members",values:{count:s==="new"?"0":s.num_members}})}),e.jsx(a.Cell,{children:s==="new"||!s.created_time?"":e.jsx(le,{value:s.created_time,year:"numeric",month:"long",day:"numeric"})}),e.jsx(a.Cell,{textAlign:"right",children:s!=="new"&&!h&&(s.is_scim_managed?e.jsx(y.Root,{children:e.jsx(y.Trigger,{disabled:!0,children:e.jsx(D,{sideOffset:0,label:u.formatMessage(U.managedViaSCIMTooltip),className:"flex",side:"right",children:e.jsx(T,{className:"icon-sm"})})})}):e.jsxs(y.Root,{children:[e.jsx(y.Trigger,{className:"-my-2",children:e.jsx(T,{className:"icon-sm"})}),e.jsx(y.Portal,{children:e.jsxs(y.Content,{children:[e.jsx(y.Item,{onClick:t=>{N(!0),setTimeout(()=>{k.current?.focus()},120),t.stopPropagation()},children:e.jsx(i,{id:"workspaceSettings.groups.changeName",defaultMessage:"Edit name"})}),e.jsx(y.Item,{onClick:t=>{S(s),t.stopPropagation()},children:e.jsx(i,{id:"workspaceSettings.groups.edit",defaultMessage:"Delete group"})})]})})]}))})]}),j&&s!=="new"&&e.jsx(a.Row,{children:e.jsx(a.Cell,{colSpan:5,className:"ps-8",children:e.jsx(ve,{group:s,workspaceId:n,readOnly:h})})}),w&&e.jsx(Ae,{group:w,onDelete:x,onClose:()=>S(null)})]})}function Ae({group:s,onDelete:n,onClose:l}){const h=_().formatMessage({id:"workspaceSettings.groups.deleteGroupTitle",defaultMessage:"Delete group {groupName}?"},{groupName:s.name});return e.jsx(H,{type:"warning",isOpen:!0,onClose:l,title:h,testId:"modal-delete-group",showCloseButton:!0,primaryButton:e.jsx(G,{color:"danger",onClick:async()=>{n(s.id),l()},children:e.jsx(i,{id:"workspaceSettings.groups.confirmDelete",defaultMessage:"Delete"})}),secondaryButton:e.jsx(G,{onClick:l,color:"secondary",children:e.jsx(i,{id:"workspaceSettings.groups.cancelDelete",defaultMessage:"Cancel"})}),children:e.jsx("p",{children:e.jsx(i,{id:"workspaceSettings.groups.deleteGroupWarning",defaultMessage:'Are you sure you want to delete the "{groupName}" group? This action cannot be undone.',values:{groupName:s.name}})})})}const O=ce({title:{id:"admin.groupsSettings.title",defaultMessage:"Groups"}}),as=oe(function(){const n=ye();return e.jsx(_e,{...n})});export{as as default};
//# sourceMappingURL=f1d9x23b1ilgw6dk.js.map
