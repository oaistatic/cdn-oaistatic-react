import{fG as M,aU as D,g1 as E}from"./j5zd9vs1l0bwsjqa.js";import{r as m,h as w,E as R,u as k,j as A,d as v}from"./j12so9ru57hpoz1y.js";import{g}from"./hqauy7ifrpud3e3q.js";import{i as l,j as p,k as h}from"./jn7p98x7qxquz26a.js";const T="oauthRedirectUri",N=M(function(){const d=m.useRef(!1),{hash:b}=w(),{code:a,error:i,error_description:f,state:s,[T]:y}=Object.fromEntries(new URLSearchParams(b.substring(1)).entries()),e=R().pluginId,c=k(),u=D();return m.useEffect(()=>{if(d.current)return;e&&a&&s&&(d.current=!0);async function C(){if(i&&e&&(l({success:!1,pluginId:e,error:i,errorType:i,errorDesc:f}),window.close()),!(!e||!a||!s)){if(s.startsWith("v2__"))try{const r=await p.user_connection_oauth_callback(e,a,s);l({success:!0,pluginId:e,redirectTo:r.redirect_to??void 0}),window.close()}catch(r){const t=g(r);let o=c.formatMessage(_.connectedDriveErrorDesc),n="unknown";t&&(n=t.error_type,o=c.formatMessage({id:"Xjmi4X",defaultMessage:"Failed to connect your account: {error}"},{error:t.message})),h.postMessage({success:!1,pluginId:e,errorType:n,error:o}),window.close();return}else if(s.startsWith("aqs__")&&u)try{const r=await p.admin_connect_and_quickstart(u.id,e,a,s);l({success:!0,pluginId:e,redirectTo:r.redirect_to??void 0}),window.close()}catch(r){const t=g(r);let o=c.formatMessage(_.connectedDriveErrorDesc),n="unknown";t&&(n=t.error_type,o=c.formatMessage({id:"Xjmi4X",defaultMessage:"Failed to connect your account: {error}"},{error:t.message})),h.postMessage({success:!1,pluginId:e,errorType:n,error:o}),window.close();return}}}C()},[e,a,s,c,y,i,f,u]),A.jsx(E,{className:"icon-xl"})}),_=v({connectedDriveSyncDesc:{id:"CACallback.connectedDriveSyncDesc.1",defaultMessage:"Your account has been connected."},connectedDriveErrorDesc:{id:"CACallback.connectedDriveErrorDesc.1",defaultMessage:"We encountered an issue. Please retry and contact your admin if this issue persists."},emailNotMatchDesc:{id:"CACallback.emailNotMatchDesc.1",defaultMessage:"The account you're trying to connect to doesn't match your ChatGPT account"}});export{N as default};
//# sourceMappingURL=gb3lh97wh9sr4oxv.js.map
