const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ebmdm6eq16wqsch2.js","assets/j12so9ru57hpoz1y.js","assets/jn7p98x7qxquz26a.js","assets/j5zd9vs1l0bwsjqa.js","assets/root-eh80jqkj.css","assets/conversation-small-cmjjxogj.css","assets/4ew8v0dcz9pvrlu8.js","assets/hv1bil5v7oivh3ja.js","assets/l13olfrtfbvjcwlk.js","assets/ojd4yynl6f6f4h3l.js","assets/l12f3ah2dx3larti.js","assets/epsg05et2lobrl6v.js","assets/gh4kfg6qlx7b3ikk.js","assets/jgfehaz03xkmntxn.js","assets/ke2u5pwt169srvv9.js","assets/msp412gwqdn605it.js","assets/ok8fnoyzbnoyk9qs.js","assets/c7zwb9p0mkhdhxup.js","assets/hv2qnh4kmlq1qj5o.js","assets/fqps1a3pxo0q8nxi.js","assets/n0tk3xne532h7ges.js","assets/ik1mvke1rzg5h1fr.js","assets/b0v1yruiy44zd1p9.js","assets/d8hi8vzea1zd4sdu.js","assets/hxt8zt4ovcs39phn.js","assets/owhjnpwqw9ddu7v0.js","assets/i0f6lf35jgfv6z47.js","assets/egjzck8f21ldiiq8.js","assets/n5601invkykfg1ys.js","assets/01yrv2o49ye0ebr7.js"])))=>i.map(i=>d[i]);
import{r as m,f as As,j as e,d as Ee,L as pl,M as H,u as Q,a9 as Y,ae as fl,aa as ke,i as gl,au as hl,l as xl,E as bl}from"./j12so9ru57hpoz1y.js";import{d as Et,P as Ms,s as Sl,e as vl,f as gs,g as yl}from"./b0v1yruiy44zd1p9.js";import{na as Mt,Y as ge,q as jn,jS as Ps,dt as _n,gv as Tt,p_ as Na,t7 as Rn,v8 as Ba,bC as tt,gG as wl,d3 as Cl,V as Es,eG as Ia,io as kl,f0 as jl,gF as _l,v9 as Rl,va as Al,vb as Ml,vc as pt,vd as An,ve as we,vf as Pl,vg as Nt,o7 as et,X as Yt,ft as Mn,vh as El,vi as Tl,vj as Kt,nX as qe,bq as Nl,bp as Ss,vk as oe,vl as Bl,vm as Il,vn as Dl,ir as Qt,cI as Ts,R as Pn,vo as Ol,vp as vs,or as Ll,pS as Fl,aR as Ve,ax as pe,ay as En,af as Hl,vq as Da,oB as Ul,vr as Gl,vs as zl,vt as Wl,vu as fe,aw as Vl,vv as Ge,vw as Oa,vx as La,fK as Xt,de as Bt,vy as Fa,vz as ql,ex as Ns,ey as Bs,vA as gt,vB as $l,vC as Yl,vD as Kl,ez as Is,vE as Ql,vF as Xl,vG as Jl,vH as Zl,iU as Ha,vI as ec,vJ as tc,vK as sc,df as ft,vL as Ua,oz as Ds,vM as xs,vN as nc,vO as Ce,vP as oc,vQ as ac,vR as ic,vS as rc,vT as _t,vU as qt,vV as lc,vW as cc,vX as uc,M as pn,vY as se,fI as dc,cH as mc,vZ as pc,v_ as fc,v$ as gc,w0 as hc,w1 as xc,w2 as bc,jw as cn,w3 as sa,w4 as Sc,w5 as vc,w6 as yc,mQ as wc,mT as Cc,jB as kc,B as Ga,eS as jc,w7 as _c,w8 as Rc,w9 as Ac,W as je,wa as Mc,qs as $t,ko as Pc,wb as Ec,wc as L,wd as za,we as Tc,wf as Nc,wg as Bc,wh as Ic,wi as Dc,wj as Oc,wk as Lc,wl as Fc,wm as Hc,wn as Uc,wo as Gc,wp as zc,wq as Wc,wr as Vc,ws as qc,wt as $c,wu as Yc,wv as Kc,ww as Qc,wx as Xc,wy as Jc,wz as Zc,wA as eu,bM as Tn,wB as tu,gZ as su,wC as nu,wD as ou,wE as au,wF as iu,wG as ru,wH as lu,wI as cu,wJ as uu,wK as du,wL as mu,wM as pu,wN as fu,wO as gu,wP as hu,wQ as xu,wR as bu,wS as Su,wT as vu,wU as yu,wV as wu,wW as Cu,wX as ku,wY as ju,aZ as _u,d as ys,ld as na,wZ as ws,cN as mt,nC as fn,w_ as Nn,w$ as Bn,ff as In,cJ as Dn,cK as On,dZ as Ln,lc as Fn,dX as Hn,dY as Un,lf as Ru,x0 as Au,cG as Gn,o6 as Wa,cL as bs,cM as Mu,hS as Pu,oG as Va,x1 as Eu,x2 as Tu,x3 as Nu,ix as qa,x4 as Cs,gT as $a,x5 as Ya,x6 as Ka,x7 as Qa,x8 as Xa,x9 as Gt,xa as Bu,nI as ks,xb as Ja,xc as Iu,xd as Du,xe as Ou,xf as Lu,xg as Fu,xh as Hu,cF as zn,L as Wn,gP as Za,oA as js,xi as Uu,xj as Gu,xk as zu,br as Wu,xl as Vn,ew as qn,cd as Vu,fF as qu,hd as $u,xm as ei,xn as Yu,xo as Ku,xp as dt,xq as Qu,fL as Xu,cb as ti,xr as Ju,xs as Zu,xt as ed,xu as td,xv as sd,xw as nd,hO as od,xx as ad,xy as id,xz as oa,xA as rd,xB as ld,xC as cd,xD as ud,a4 as si,aW as dd,xE as md,qn as pd,fr as fd,xF as Os,fs as ni,xG as oi,fu as ai,xH as ii,fv as ri,nf as gn,hY as $n,h_ as li,hX as gd,xI as hd,eq as ci,bj as xd,xJ as bd,lD as ui,xK as Sd,xL as vd,xM as yd,lE as wd,lF as Cd,xN as kd,xO as di,xP as jd,ou as mi,xQ as _d,xR as Rd,xS as Ad,od as Md,xT as aa,xU as Pd,xV as pi,xW as Ed,xX as Td,gu as fi,xY as gi,xZ as hi,x_ as hn,i2 as ia,bO as Nd,fd as Bd,fg as Id,Z as Dd,cw as Od,x$ as Ld,q9 as Fd,y0 as Hd,y1 as Ud,y2 as Gd,y3 as zd,y4 as Wd,y5 as Vd,iE as qd,y6 as ra,mB as $d,iA as Yd,y7 as Kd,y8 as Qd,y9 as Xd,v5 as la,iH as Jd,ya as Zd,yb as ca,c6 as em,yc as tm,H as sm,U as ua,fJ as nm,k3 as om,k8 as am,b1 as im,jp as rm,yd as lm,ye as cm,yf as um,yg as dm,fq as mm,yh as da,yi as ma,yj as pa,j$ as pm,yk as fm,yl as gm,ym as hm,yn as fa,yo as xm,yp as bm,yq as Sm,d$ as vm,oh as ym,i5 as ga,yr as wm,nb as xi,ys as Cm,yt as km,iW as jm,y as bi,i_ as _m,yu as Rm,yv as Am,og as Mm,hT as Pm,ln as un,lo as dn,lS as Em,oE as Tm,yw as Nm,yx as Bm,m7 as Im,hU as Dm}from"./jn7p98x7qxquz26a.js";import{aU as nt,hB as Si,at as ce,W as Z,r as ot,a_ as ht,q as _e,dO as ze,aI as st,P as A,hC as ee,V as We,h6 as vi,K as yi,bD as T,aO as ae,c3 as Yn,cU as Ls,a as F,hD as wi,gF as xn,fy as Jt,T as xt,hE as Kn,cN as Ci,fz as Qn,bO as ki,aP as He,fg as Om,di as _s,c2 as Lm,c_ as Xn,hF as Fm,hG as Hm,hH as Um,ff as Gm,hI as zm,B as Rt,hJ as Fs,cW as Pe,b2 as Zt,bL as at,cv as Wm,gc as Vm,aw as qm,bF as $m,au as ji,hK as _i,aL as Ue,hL as Ym,bq as ha,d as Km,G as Qm,e0 as Ri,b as At,cy as Jn,cz as Zn,L as mn,dT as Rs,J as Ai,aJ as Xm,f4 as Jm,d_ as Zm,bU as ep,s as Mi,N as Pi,R as bn,ef as tp,u as It,dh as Ei,hM as sp,Y as Ti,dM as np,dH as op,dF as Sn,S as Ni,cu as ap,c6 as ip,de as xa,d5 as Ze,fv as ye,fa as me,l as rp,m as lp,gM as cp,et as up,hN as ba,dW as dp,h as mp,aW as pp,f5 as fp,bc as gp,aq as hp,gL as eo,bE as xp,bX as bp,bY as Sp,v as zt,am as vp,hO as yp,hP as wp,hQ as Cp,ec as kp,D as jp,ds as Sa,ar as _p,eg as Rp,hR as Ap,gn as Mp,go as Pp}from"./j5zd9vs1l0bwsjqa.js";import{u as Ep}from"./d8hi8vzea1zd4sdu.js";import{C as Hs,a as Tp,A as Np,b as Bi}from"./hxt8zt4ovcs39phn.js";import{G as Ii}from"./owhjnpwqw9ddu7v0.js";import{F as Bp}from"./i0f6lf35jgfv6z47.js";import{G as Ip}from"./egjzck8f21ldiiq8.js";import{T as Dp}from"./msp412gwqdn605it.js";import{b as Op}from"./01yrv2o49ye0ebr7.js";const Lp=({clientThreadId:t,rateLimitInfo:s,onDismiss:o,onInteract:a,onMount:n})=>{const{name:i,title:r,call_to_action:c,description:l}=s,p=nt(),d=Mt(!0),{updateSystemHint:f}=ge(),u=Et(),x=Mt(!1),h=Si(),g=ce(t,Z.getIsNewConversation),b=p?.planType??"unknown",S=ot(),C=ht(S,"3809605125"),k=h&&"block_reason"in h?h.block_reason:null,N="banner_description",w=m.useMemo(()=>({type:i||"unknown",location:N,plan_type:b,is_new_conversation:g,is_hard_block:!!h,hard_block_reason:k??"",call_to_action:c}),[i,N,b,g,h,k,c]),_=As(),D=jn(),{isUnauthenticated:R}=_e(),B=Ps(),M=_n(ze.signUpButtonText),v=Tt(),W=Na({clientThreadId:t}),{layer:G}=st("1368081792"),P=U=>{switch(U){case ee.AUTHENTICATE:return{text:B?ze.logInButtonText:M,onClick:()=>{D({authType:B?"login":"signup",callback:I=>{B?A.logLogInButtonClicked({location:`Rate limit banner - ${i}`,provider:I}):A.logSignUpButtonClicked({location:`Rate limit banner - ${i}`,provider:I})}})}};case ee.AUTHENTICATE_SECONDARY:return{text:B?M:ze.logInButtonText,onClick:()=>{D({authType:B?"signup":"login",callback:I=>{B?A.logSignUpButtonClicked({location:`Rate limit banner - ${i}`,provider:I}):A.logLogInButtonClicked({location:`Rate limit banner - ${i}`,provider:I})}})}};case ee.GET_PLUS:return{text:jt.getPlusButton,onClick:()=>{A.logRateLimitGetPlusButtonClicked(w),R?D({authType:B?"login":"signup",shouldOpenPaymentModalOnAuth:!0,callback:I=>{B?A.logLogInButtonClicked({location:"Rate limit banner Get Plus upsell",provider:I}):A.logSignUpButtonClicked({location:"Rate limit banner Get Plus upsell",provider:I})}}):tt(_,"Prompt textarea rate limit banner")}};case ee.NEW_CHAT:return{text:jt.newChatButton,onClick:()=>{d({modelId:"",location:N})}};case ee.PAID_USER_O3_MINI_HIGH:{const I=Z.getCurrentLeafId(We(t)),q=()=>{A.logEventWithStatsig("In Context Upsell Banner O3 Mini High CTA Clicked","chatgpt_in_context_upsell_banner_o3_mini_high_cta_clicked",{location:G.get("should_change_model_picker",!0)?"In-context upsell o3-mini-high for Plus banner - Try it button":"In-context upsell o3-mini-high for Plus (no model switch) banner - Try it button",eventProperties:w}),G.get("should_change_model_picker",!0)&&x(C?{modelId:"o4-mini-high",location:"In-context upsell o4-mini-high for Plus banner - Try it button"}:{modelId:"o3-mini-high",location:"In-context upsell o3-mini-high for Plus banner - Try it button"}),W(C?{sourceEvent:new Event("click"),nodeId:I,requestedModelId:"o4-mini-high"}:{sourceEvent:new Event("click"),nodeId:I,requestedModelId:"o3-mini-high"})};return{text:jt.tryItButton,onClick:q}}case ee.FREE_USER_O3_MINI_HIGH:return{text:jt.getPlusButton,onClick:()=>{A.logEventWithStatsig("In Context Upsell Banner O3 Mini High CTA Clicked","chatgpt_in_context_upsell_banner_o3_mini_high_cta_clicked",{location:"In-context upsell o3-mini-high for Free banner - Get Plus button",eventProperties:w}),tt(_,"Prompt textarea in-context upsell banner")}};case ee.DEEP_RESEARCH_IN_CONTEXT_UPSELL:{const I=Z.findNode(We(t),ne=>vi(ne.message)),q=I?yi(I.message):void 0;return{text:jt.tryItButton,onClick:()=>{A.logEventWithStatsig("In Context Upsell Banner Deep Research CTA Clicked","chatgpt_in_context_upsell_banner_deep_research_cta_clicked",{location:"In-context upsell deep research - Try it button",eventProperties:w}),f(T.Research,{clientThreadId:t}),u.focus(),u.setText(q??"")}}}case"get_pro":return{text:jt.getProButton,onClick:()=>{A.logRateLimitUpgradePlanButtonClicked({...w,upgrade_plan_tye:"pro"}),R?D({authType:B?"login":"signup",shouldOpenPaymentModalOnAuth:!0,callback:I=>{B?A.logLogInButtonClicked({location:"Rate limit banner Get Pro upsell",provider:I}):A.logSignUpButtonClicked({location:"Rate limit banner Get Pro upsell",provider:I})}}):tt(_,"Prompt textarea rate limit banner")}}}};Rn(()=>{!G.get("should_change_model_picker",!0)&&w.type==="o3-mini-high-in-context-upsell-plus"&&(w.type="o3-mini-high-in-context-upsell-plus-no-model-switch"),A.logRateLimitBannerShown(w),n?.()});let[j,V]=c??[];j===ee.AUTHENTICATE&&v&&(V=ee.AUTHENTICATE_SECONDARY);const O={primaryAction:P(j),secondaryAction:P(V)};return e.jsx(Ba,{onDismiss:o,title:r,description:l,actions:O,onInteract:a})},jt=Ee({getPlusButton:{id:"TeyLcp",defaultMessage:"Get Plus"},getProButton:{id:"Pl8/Vk",defaultMessage:"Get Pro"},newChatButton:{id:"7OvnJ5",defaultMessage:"New chat"},tryItButton:{id:"zPDzun",defaultMessage:"Try it"}}),Fp=({clientThreadId:t,rateLimitInfo:s,onDismiss:o,onInteract:a,onMount:n})=>{const{name:i,title:r,call_to_action:c,description:l}=s,p=nt(),d=Mt(!0),{updateSystemHint:f}=ge(),u=Et(),x=Mt(!1),h=Si(),g=ce(t,Z.getIsNewConversation),b=p?.planType??"unknown",S=Tt(),C=ot(),k=ht(C,"3809605125"),N=h&&"block_reason"in h?h.block_reason:null,w="banner_description",_=m.useMemo(()=>({type:i||"unknown",location:w,plan_type:b,is_new_conversation:g,is_hard_block:!!h,hard_block_reason:N??"",call_to_action:c}),[i,w,b,g,h,N,c]),D=As(),R=jn(),{isUnauthenticated:B}=_e(),M=Ps(),v=_n(ze.signUpButtonText),W=Na({clientThreadId:t}),{layer:G}=st("1368081792"),P=U=>{switch(U){case ee.AUTHENTICATE:return{text:M?ze.logInButtonText:v,onClick:()=>{R({authType:M?"login":"signup",callback:I=>{M?A.logLogInButtonClicked({location:`Rate limit banner - ${i}`,provider:I}):A.logSignUpButtonClicked({location:`Rate limit banner - ${i}`,provider:I})}})}};case ee.AUTHENTICATE_SECONDARY:return{text:M?v:ze.logInButtonText,onClick:()=>{R({authType:M?"signup":"login",callback:I=>{M?A.logSignUpButtonClicked({location:`Rate limit banner - ${i}`,provider:I}):A.logLogInButtonClicked({location:`Rate limit banner - ${i}`,provider:I})}})}};case ee.GET_PLUS:return{text:Wt.getPlusButton,onClick:()=>{A.logRateLimitGetPlusButtonClicked(_),B?R({authType:M?"login":"signup",shouldOpenPaymentModalOnAuth:!0,callback:I=>{M?A.logLogInButtonClicked({location:"Rate limit banner Get Plus upsell",provider:I}):A.logSignUpButtonClicked({location:"Rate limit banner Get Plus upsell",provider:I})}}):tt(D,"Prompt textarea rate limit banner")}};case ee.NEW_CHAT:return{text:Wt.newChatButton,onClick:()=>{d({modelId:"",location:w})}};case ee.PAID_USER_O3_MINI_HIGH:{const I=Z.getCurrentLeafId(We(t)),q=()=>{A.logEventWithStatsig("In Context Upsell Banner O3 Mini High CTA Clicked","chatgpt_in_context_upsell_banner_o3_mini_high_cta_clicked",{location:G.get("should_change_model_picker",!0)?"In-context upsell o3-mini-high for Plus banner - Try it button":"In-context upsell o3-mini-high for Plus (no model switch) banner - Try it button",eventProperties:_}),G.get("should_change_model_picker",!0)&&x(k?{modelId:"o4-mini-high",location:"In-context upsell o4-mini-high for Plus banner - Try it button"}:{modelId:"o3-mini-high",location:"In-context upsell o3-mini-high for Plus banner - Try it button"}),W(k?{sourceEvent:new Event("click"),nodeId:I,requestedModelId:"o4-mini-high"}:{sourceEvent:new Event("click"),nodeId:I,requestedModelId:"o3-mini-high"})};return{text:Wt.tryItButton,onClick:q}}case ee.FREE_USER_O3_MINI_HIGH:return{text:Wt.getPlusButton,onClick:()=>{A.logEventWithStatsig("In Context Upsell Banner O3 Mini High CTA Clicked","chatgpt_in_context_upsell_banner_o3_mini_high_cta_clicked",{location:"In-context upsell o3-mini-high for Free banner - Get Plus button",eventProperties:_}),tt(D,"Prompt textarea in-context upsell banner")}};case ee.DEEP_RESEARCH_IN_CONTEXT_UPSELL:{const I=Z.findNode(We(t),ne=>vi(ne.message)),q=I?yi(I.message):void 0;return{text:Wt.tryItButton,onClick:()=>{A.logEventWithStatsig("In Context Upsell Banner Deep Research CTA Clicked","chatgpt_in_context_upsell_banner_deep_research_cta_clicked",{location:"In-context upsell deep research - Try it button",eventProperties:_}),f(T.Research,{clientThreadId:t}),u.focus(),u.setText(q??"")}}}}};Rn(()=>{!G.get("should_change_model_picker",!0)&&_.type==="o3-mini-high-in-context-upsell-plus"&&(_.type="o3-mini-high-in-context-upsell-plus-no-model-switch"),A.logRateLimitBannerShown(_),n?.()}),m.useEffect(()=>()=>{A.logEventWithStatsig("Rate Limit: Dismiss Banner","chatgpt_rate_limit_banner_dismissed",_)},[_]);let[j,V]=c??[];j===ee.AUTHENTICATE&&S&&(V=ee.AUTHENTICATE_SECONDARY);const O={primaryAction:P(j),secondaryAction:P(V)};return e.jsx(Ba,{onDismiss:o,title:r,description:l,actions:O,onInteract:a})},Wt=Ee({getPlusButton:{id:"TeyLcp",defaultMessage:"Get Plus"},newChatButton:{id:"7OvnJ5",defaultMessage:"New chat"},tryItButton:{id:"zPDzun",defaultMessage:"Try it"}}),Di=t=>{const{value:s}=ae("1028682714");return s?e.jsx(Lp,{...t}):e.jsx(Fp,{...t})},Oi=Yn.div`group flex h-10 items-center gap-2 rounded-lg px-2 hover:bg-token-main-surface-secondary text-sm text-token-text-primary`;function Hp(){const{data:t,isLoading:s}=_l({cutId:"recent",limit:8}),{data:o,isLoading:a}=Rl();return{isLoading:s||a,recent:t,pinned:o}}function Up({query:t,onSelectGizmo:s,selectedIdx:o},a){const n=wl(),i=m.useRef([]),{isLoading:r,recent:c,pinned:l}=Hp();m.useImperativeHandle(a,()=>({handleEnterOnIndex:f=>{if(!d[f])return f<p.length?p[f].resource:"create"},getResultsLength:()=>p.length+1,scrollToItem:f=>{const u=i.current[f];u&&u.scrollIntoView({behavior:"instant",block:"nearest"})}}));let p=[];if(r)return e.jsx("div",{className:"absolute end-4 top-0 flex h-full items-center justify-center",children:e.jsx(Ls,{})});c&&p.push(...c.pages.flatMap(f=>f.list.items).map(f=>({resource:f.resource,from:"recent"}))),l&&p.push(...l.items.map(f=>({resource:f,from:"pinned"}))),p=Cl(p,f=>f.resource.gizmo.id);const d=p.map(f=>f.resource.gizmo.tags?.includes(Es.WorkspaceDisabled));return t&&t!==""&&(p=p.filter(f=>(f.resource.gizmo.display.name.toLowerCase()+f.resource.gizmo.display.description?.toLowerCase()+f.resource.gizmo.author.display_name?.toLowerCase()).includes(t?.toLowerCase()))),e.jsxs("div",{className:"max-h-40 overflow-y-auto",children:[p.map((f,u)=>e.jsx("div",{ref:x=>{i.current[u]=x},tabIndex:u,onClick:()=>{d[u]||s(f.resource)},children:e.jsx(Vp,{gizmoResource:f.resource,from:f.from,showDescription:n,isSelected:o===u,grayedOut:d[u]})},f.resource.gizmo.id)),e.jsx("div",{ref:f=>{i.current[p.length]=f},tabIndex:p.length,onClick:()=>{s("create")},children:e.jsx(zp,{isSelected:o===p.length})},"create")]})}const Gp=m.forwardRef(Up),zp=({isSelected:t})=>e.jsx(Oi,{className:t?"bg-token-main-surface-secondary":"",children:e.jsxs(pl,{to:"/gpts/editor",target:"_blank",className:"flex flex-row space-x-2 font-semibold",children:[e.jsx("span",{className:"self-center",children:e.jsx(Ia,{className:"icon-sm"})}),e.jsx("span",{children:e.jsx(H,{...Li.dropdownCreateLabel})})]})}),Wp=({onClick:t,onClose:s})=>{const[o,a]=m.useState(null),n=m.useRef(null),i=m.useRef(null),[r,c]=m.useState(0),l=Q(),p=d=>{A.logEvent("Mentions Click Gizmo",{gizmo_id:d==="create"?"create":d.gizmo.id}),d!=="create"&&t(d)};return e.jsxs(e.Fragment,{children:[e.jsx("input",{autoFocus:!0,placeholder:l.formatMessage(Li.searchPlaceholder),ref:n,onKeyDown:d=>{if(d.nativeEvent.isComposing)return;const f=i.current?.getResultsLength()??0;if((d.key==="Escape"||d.key==="Backspace"&&!o)&&(d.preventDefault(),s()),d.key==="Enter"||d.key==="Tab"){d.preventDefault();const u=i.current?.handleEnterOnIndex(r);if(!u)return;u==="create"?(window.open("/gpts/editor","_blank"),s()):p(u)}if(d.key==="ArrowDown"&&r<f-1){d.preventDefault();const u=r+1;i.current?.scrollToItem(u),c(u)}if(d.key==="ArrowUp"&&r>0){d.preventDefault();const u=r-1;i.current?.scrollToItem(u),c(u)}},onChange:d=>{a(d.target.value),c(0)},className:"bg-token-main-surface-primary w-full border-0 p-2 text-sm focus:outline-hidden"}),e.jsx(Gp,{ref:i,query:o,selectedIdx:r,onSelectGizmo:p})]})},va=({onClick:t,onClose:s})=>{const o=wi(),a=!!o;return Rn(()=>{A.logEvent("Mentions Opened",{gizmo_selector_disabled:a})}),a?e.jsx(Di,{clientThreadId:xn,rateLimitInfo:o}):e.jsx("div",{onBlur:n=>{n.currentTarget.contains(n.relatedTarget)||s()},className:"popover border-token-border-default bg-token-main-surface-primary rounded-2xl border p-2 shadow-lg",children:e.jsx(Wp,{onClick:t,onClose:s})})};function Vp({gizmoResource:t,from:s,showDescription:o,isSelected:a,grayedOut:n}){const i=!!t.gizmo.tags?.includes(Es.FirstParty);return e.jsxs(Oi,{className:F(a?"bg-token-main-surface-secondary":"",n&&"opacity-50"),children:[e.jsx(Ii,{isFirstParty:i,src:t.gizmo.display.profile_picture_url,className:F("icon-xl h-7 w-7 shrink-0",n&&"grayscale group-hover:grayscale-0")}),e.jsxs("div",{className:"flex h-fit grow flex-row justify-between space-x-2 overflow-hidden text-ellipsis whitespace-nowrap",children:[e.jsxs("div",{className:"flex flex-row space-x-2",children:[e.jsx("span",{className:"shrink-0 truncate font-semibold",children:t.gizmo.display.name}),o&&e.jsx("span",{className:"text-token-text-tertiary grow truncate text-sm sm:max-w-xs lg:max-w-md",children:t.gizmo.display.description})]}),e.jsx("span",{className:"shrink-0 self-center",children:s==="recent"?e.jsx(kl,{className:"icon-sm"}):e.jsx(jl,{className:"icon-sm"})})]})]})}const Li=Ee({talkingTo:{id:"TaggingDropdown.talkingTo",defaultMessage:"Talking to"},dropdownCreateLabel:{id:"TaggingDropdown.dropdownCreateLabel",defaultMessage:"Create a GPT"},searchPlaceholder:{id:"TaggingDropdown.searchPlaceholder",defaultMessage:"Search recent and pinned GPTs"}});function qp({systemHint:t,label:s,logo:o,isDisabled:a=!1,composerController:n,analyticsMetadata:i,onClick:r,showLabel:c=!1,splitButtonDropdownContent:l,dropdownContent:p,dataTestid:d}){const{name:f,systemHint:u}=t,x=u,{setThreadSystemHintMode:h,clearAllSystemHintModeTriggers:g}=ge(),b=Nt(x),S=!!t.composerBarButtonInfo?.upsell,C=et.useStore(),{value:k}=ae("2454940646"),N=Yt(),w=[T.Search,T.Think].includes(x);m.useEffect(()=>{a&&N.has(x)&&h(x,!1,i)},[a,x,i,h,N,w]);const _=m.useCallback(B=>{B.stopPropagation(),B.preventDefault();let M=!0;k&&w&&(C.getState().persistedSystemHints.has(T.Search)||C.getState().persistedSystemHints.has(T.Think))&&(M=!1),M&&g(),h(x,!b,i),b||(n.removeSystemHints(),n.focus()),An(x,b?we.Disable:we.Enable,i.clientThreadId),r?.(B)},[i,k,g,n,x,w,b,r,h,C]),D=S?e.jsx("div",{className:"py-2",children:e.jsx(Mn,{location:x,statsig_login_event:"chatgpt_composer_upsell_login_button_clicked",statsig_signup_event:"chatgpt_composer_upsell_signup_button_clicked",containerNoPadding:!0})}):null;return e.jsx(Hs,{pressed:b,disabled:a,icon:o,label:s,ariaLabel:f,animatedLabel:!c,showLabel:c||b,onClick:_,dropdownContent:p??D,splitButtonDropdownContent:l,dataTestid:d})}function $p({composerController:t,systemHint:s,composerBarButtonInfo:o,isDisabled:a,clientThreadId:n,showLabel:i,labelOverride:r,disabledReason:c,rateLimitProgress:l,dropdownContent:p,splitButtonDropdownContent:d,logoOverride:f,dataTestid:u,tooltipPosition:x,disableNuxMarkdown:h}){const g={clientThreadId:n};return e.jsx(Yp,{composerBarButtonInfo:o,isDisabled:a,analyticsMetadata:g,systemHint:s.systemHint,disabledReason:c,rateLimitProgress:l,tooltipPosition:x,disableNuxMarkdown:h,children:e.jsx(qp,{isDisabled:a,systemHint:s,label:r??s.name,logo:f??e.jsx(Jt,{svgString:s.logo,className:"h-[18px] w-[18px]"}),composerController:t,analyticsMetadata:g,showLabel:i,dropdownContent:p,splitButtonDropdownContent:d,dataTestid:u})})}function Yp({children:t,isDisabled:s,systemHint:o,composerBarButtonInfo:a,analyticsMetadata:n,disabledReason:i,rateLimitProgress:r,tooltipPosition:c="bottom",disableNuxMarkdown:l}){const p=Al(a.announcementKey,o),d=Ml({composerBarButtonInfo:a,children:t,disableMarkDown:l}),f=Q();let u=null;return r&&r.remaining?u=e.jsx(Fi,{remaining:r.remaining,reset_date:r.reset_after,text:a.tooltipText}):a.tooltipText&&(u=e.jsx(to,{text:a.tooltipText})),p?d:e.jsx("div",{children:e.jsx(xt,{sideOffset:10,label:s?i===pt.HasAttachedFiles?f.formatMessage({id:"hhxO6y",defaultMessage:"Reason disabled for attachments"}):i===pt.DeepResearchHighLoad?f.formatMessage({id:"UrDtrS",defaultMessage:"Deep research is temporarily unavailable"}):i===pt.RateLimitReached?a.rateLimitReachedText:a.disabledText:u,side:c,onOpenChange:x=>{x&&An(o,we.Hover,n.clientThreadId)},children:t})})}const to=({text:t})=>e.jsx("span",{children:t}),Fi=({remaining:t,reset_date:s,text:o})=>{const{locale:a}=Q(),n=Pl(s,a);return e.jsxs("div",{className:"text-start",children:[e.jsx("span",{className:"text-token-text-tertiary block text-xs font-semibold",children:e.jsx(H,{id:"PromptTextarea.systemHintTooltip.remaining",defaultMessage:"{remaining} available until {resetDate}",values:{remaining:t,resetDate:n}})}),e.jsx(to,{text:o})]})};function Kp({children:t,isDisabled:s,disabledReason:o,logEvent:a}){const n=Q(),i=Kn(),r=Ci(d=>d.bySystemHint(T.Research)),c=n.formatMessage({id:"LtcsGJ",defaultMessage:"Get detailed insights on any topic"});let l=null;r&&r.remaining?l=e.jsx(Fi,{remaining:r.remaining,reset_date:r.reset_after,text:c}):l=e.jsx(to,{text:c});const p=o===pt.DeepResearchHighLoad?n.formatMessage({id:"UrDtrS",defaultMessage:"Deep research is temporarily unavailable"}):o===pt.RateLimitReached&&i?n.formatMessage({id:"T3aUKM",defaultMessage:"More available {time}"},{time:i.resets_after_text}):void 0;return e.jsx(xt,{className:"inline-block",sideOffset:0,label:s?p:l,side:"bottom",onOpenChange:d=>{d&&a(we.Hover)},children:t})}function Qp({clientThreadId:t,showLabel:s=!1,isDisabled:o}){const a=El(t),n=Et(),i=Nt(T.Research),{setThreadSystemHintMode:r,clearAllSystemHintModeTriggers:c}=ge(),l=!!Kn(),{value:p}=ae("1416952492"),d=p?pt.DeepResearchHighLoad:l?pt.RateLimitReached:void 0;return a?e.jsx("div",{"data-testid":"system-hint-research",style:{viewTransitionName:`var(--vt-composer-${T.Research}-action)`},children:e.jsx(Xp,{composerController:n,isThreadInSystemHintMode:i,setThreadSystemHintMode:r,clearAllSystemHintModeTriggers:c,clientThreadId:t,showLabel:s,isDisabled:o||!!d,disabledReason:d})},`system-hint-${T.Research}`):null}function Xp({composerController:t,isThreadInSystemHintMode:s,setThreadSystemHintMode:o,clearAllSystemHintModeTriggers:a,clientThreadId:n,showLabel:i=!1,isDisabled:r=!1,disabledReason:c}){const l=Q(),p={clientThreadId:n},d=l.formatMessage({id:"ORxecl",defaultMessage:"Deep research"}),f=x=>{x===we.Hover?A.logEventWithStatsig("Composer Research Button Hovered","composer_research_button_hovered",p):x===we.Enable?A.logEventWithStatsig("Composer Research Button Enabled","composer_research_button_enabled",p):x===we.Disable&&A.logEventWithStatsig("Composer Research Button Disabled","composer_research_button_disabled",p)},u=x=>{x.stopPropagation(),x.preventDefault(),a(),o(T.Research,!s,p),s||(t.removeSystemHints(),t.focus()),f(s?we.Disable:we.Enable)};return e.jsx(Kp,{disabledReason:c,isDisabled:r,logEvent:f,children:e.jsx(Hs,{pressed:s,disabled:r,icon:e.jsx(Tl,{className:"h-[18px] w-[18px]"}),label:d,animatedLabel:!i,showLabel:i||s,onClick:u,ariaLabel:d,dataTestid:"composer-button-deep-research",splitSecondaryButton:e.jsx(Jp,{pressed:s})})})}function Jp({pressed:t}){const{isOpen:s,togglePanel:o}=Kt(),a=qe(),n=ot(),i=ht(n,"3544641259");if(!t||!i)return null;const r=s?e.jsx(Nl,{className:"h-4 w-4"}):e.jsx(Ss,{className:"h-4 w-4"}),l=a?oe:{opacity:{delay:.1},default:{type:"tween",duration:.15,ease:"easeInOut"}};return e.jsx(Y.button,{initial:{opacity:1,x:-5},animate:{opacity:1,x:0,transition:l},exit:{opacity:0,x:-10,transition:l},onClick:()=>{o()},className:"border-token-border-default border-s p-1 focus:outline-none",type:"button",children:r},"deep-research-sources-toggle")}function Zp({clientThreadId:t,gizmoId:s,composerController:o,isDisabled:a}){return Bl({clientThreadId:t,gizmoId:s})?e.jsx("div",{"data-testid":"system-hint-reason",style:{viewTransitionName:`var(--vt-composer-${T.Think}-action)`},children:e.jsx(ef,{clientThreadId:t,composerController:o,isDisabled:a})},`system-hint-${T.Think}`):null}function ef({clientThreadId:t,composerController:s,isDisabled:o}){const a=Q(),n=!!Qn();o=o||n;const i=a.formatMessage({id:"T+qu+0",defaultMessage:"Reason"}),{setThreadSystemHintMode:r,clearAllSystemHintModeTriggers:c}=ge(),l=Nt(T.Think),p=et.useStore(),d=Yt(),{isUnauthenticated:f}=_e();m.useEffect(()=>{o&&d.has(T.Think)&&r(T.Think,!1,{clientThreadId:t})},[o,d,r,t]);const u=g=>{if(g.stopPropagation(),g.preventDefault(),f)return;let b=!0;p.getState().persistedSystemHints.has(T.Search)&&(b=!1),b&&c(),r(T.Think,!l,{clientThreadId:t}),l||(s.removeSystemHints(),s.focus()),l?A.logEventWithStatsig("Composer Think Button Disabled","composer_think_button_disabled",{clientThreadId:t}):A.logEventWithStatsig("Composer Think Button Enabled","composer_think_button_enabled",{clientThreadId:t})},x=f?e.jsx(Mn,{location:T.Think,statsig_login_event:"chatgpt_composer_upsell_login_button_clicked",statsig_signup_event:"chatgpt_composer_upsell_signup_button_clicked",containerNoPadding:!0}):void 0,h=e.jsx(Hs,{pressed:l,disabled:o,icon:e.jsx(Dl,{className:"h-[18px] w-[18px]"}),label:i,ariaLabel:i,animatedLabel:!0,showLabel:!0,onClick:u,dropdownContent:x,dataTestid:"composer-button-reason"});return e.jsx(Il,{isDisabled:o,clientThreadId:t,children:h})}const tf=["o1","o1-pro","gpt-4"];function sf({account:t,clientBootstrapFlags:s,features:o,clientThreadId:a,currentModelConfig:n,composerController:i,isDisabled:r,gizmoId:c,hasFiles:l}){const{prospectiveModelId:p}=Qt(a);let d=Ts(a);const f=Pn(c),{userIsInSearchHoldoutWithWebDisabled:u}=Ol(),x=n?.enabledTools?.includes(ki.Search),h=d==null||d?.kind===He.PrimaryAssistant||d?.kind===He.GizmoInteraction&&f,{isUnauthenticated:g}=_e(),b=Om(T.Search);return g&&s?.includes(_s.AnonSearchHoldout)||!g&&(t==null||t.isFree())&&(s?.includes(_s.FreeSearchHoldout)||u)||!b||!g&&(t==null||t.isEnterprisey())&&!o?.includes(Lm.BrowsingAvailable)||!h?null:e.jsx("div",{"data-testid":"system-hint-search",style:{viewTransitionName:`var(--vt-composer-${T.Search}-action)`},children:e.jsx(nf,{clientThreadId:a,composerController:i,modelSupportsSearch:x??(g||t?.isFree()||!!p&&!tf.includes(p)),isDisabled:r,disabledReason:x?l?vs.HasAttachedFiles:void 0:vs.ModelNotSupported,currentModelName:n?.title??""})},`system-hint-${T.Search}`)}function nf({clientThreadId:t,composerController:s,isDisabled:o,disabledReason:a,currentModelName:n,modelSupportsSearch:i}){const r=Q(),c=Ll(),l=r.formatMessage({id:"TbHx8d",defaultMessage:"Search"}),{setThreadSystemHintMode:p,clearAllSystemHintModeTriggers:d}=ge(),f=et.useStore(),u=Yt();o=o||!i,m.useEffect(()=>{o&&u.has(T.Search)&&p(T.Search,!1,{clientThreadId:t})},[o,u,p,t]);const x=h=>{h.stopPropagation(),h.preventDefault();let g=!0;f.getState().persistedSystemHints.has(T.Think)&&(g=!1),g&&d(),p(T.Search,!c,{clientThreadId:t}),c||(s.removeSystemHints(),s.focus()),A.logEventWithStatsig("Composer Search Button Clicked","composer_search_button_clicked",{clientThreadId:t}),c&&s.trimLeadingText(/^search\b/i)};return e.jsx(af,{analyticsMetadata:{clientThreadId:t},isThreadUsingSearchMode:c,isDisabled:o,disabledReason:a,currentModelName:n,children:e.jsx(Hs,{pressed:c,disabled:o??!1,icon:e.jsx(Fl,{className:"h-[18px] w-[18px]"}),label:l,ariaLabel:l,animatedLabel:!0,showLabel:!0,onClick:x,dataTestid:"composer-button-search"})})}function of(){const t=Da(),s=Ve(pe.hasSeenComposerSearchButtonTooltip);return!s.isLoading&&s.eligible&&!t}function af({children:t,analyticsMetadata:s,isThreadUsingSearchMode:o,isDisabled:a,disabledReason:n,currentModelName:i}){const r=of()&&!o,c=Ve(pe.hasSeenComposerSearchButtonTooltip);return r?e.jsx(En,{announcementKey:pe.hasSeenComposerSearchButtonTooltip,side:"right",show:!0,theme:"bright",dismissOnOutsideClick:!0,badge:"new",title:e.jsx(H,{id:"Yjduqi",defaultMessage:"Search the web"}),onDismiss:c.markAsViewed,sideOffset:0,className:"xs:max-w-sm! max-w-2xs!",description:e.jsx(H,{id:"W51Aei",defaultMessage:"Get fast answers with trusted sources. {learnMore}",values:{learnMore:e.jsx(Hl,{href:"https://openai.com/index/introducing-chatgpt-search",className:"underline",children:e.jsx(H,{id:"stA7F4",defaultMessage:"Learn more"})})}}),children:e.jsx("div",{children:t})}):e.jsx("div",{children:e.jsx(xt,{className:"inline-block",sideOffset:0,label:a?n===vs.ModelNotSupported?e.jsx(H,{id:"GZemJe",defaultMessage:"Search disabled for {modelName}",values:{modelName:`${i}`}}):n===vs.HasAttachedFiles?e.jsx(H,{id:"Wd1fc2",defaultMessage:"Search disabled for attachments"}):e.jsx(H,{id:"GpDAWD",defaultMessage:"Search is unavailable"}):e.jsx(H,{id:"c+4o2s",defaultMessage:"Search the web"}),side:"bottom",onOpenChange:l=>{l&&A.logEventWithStatsig("Composer Search Button Hovered","composer_search_button_hovered",s)},children:t})})}const rf=1;function lf({value:t=rf,size:s,onStateChange:o}){return e.jsx("div",{className:"relative flex h-full w-full flex-col items-center justify-center",children:e.jsxs(Y.div,{animate:{translateY:t>1&&s==="small"?-1:0},onAnimationStart:()=>o?.("animating"),onAnimationComplete:()=>o?.("idle"),className:F("relative",s==="small"?"h-5 w-5":"h-8 w-8"),children:[e.jsx(Y.div,{style:{transformOrigin:"50% 100%",translateY:s==="large"?3:0},animate:{scale:t>1&&s==="small"?.85:1},className:"absolute start-0 top-0",children:e.jsx(Ul,{"aria-label":"",className:F(s==="small"?"h-5 w-5":"h-8 w-8")})}),e.jsx(Y.div,{initial:{scale:s==="small"?.9:1.1,opacity:0},animate:{scale:s==="large"?1.1:t>1?1:.9,opacity:t>1?1:0},style:{translateY:s==="large"?-1:0},className:"absolute start-0 top-0",children:e.jsx(Gl,{"aria-label":"",className:F(s==="small"?"h-5 w-5":"h-8 w-8")})}),e.jsx(Y.div,{initial:{scale:s==="small"?.9:1.1,opacity:0},animate:{scale:s==="large"?1.1:t>2?1:.9,opacity:t>2?1:0},style:{translateY:s==="large"?-1:0},className:"absolute start-0 top-0",children:e.jsx(zl,{"aria-label":"",className:F(s==="small"?"h-5 w-5":"h-8 w-8")})})]})})}function cf(t){const{reasoningLevelTypes:s,reasoningLevelType:o}=t,{ReasoningLevels:a}=s;let n=1;return o===a.medium.type?n=2:o===a.high.type&&(n=3),e.jsx("div",{className:F("relative flex h-5 w-5 items-center justify-center"),children:e.jsx(lf,{size:"small",value:n})})}const uf=({isManualModelSelection:t,animatedLabel:s,reasoningLevelTypes:o,reasoningLevelType:a,modelName:n,onResetReasoningLevel:i,onReasoningLevelChanged:r,type:c})=>{const[l,p]=m.useState(!1),d=fl(),{reasoningLevel:f}=Wl({reasoningLevelTypes:o,reasoningLevelType:a}),u=a!=="low"||t||!1,x=fe(g=>g.isVisuallyOverflowing),h=x;return e.jsxs("div",{className:F("radix-state-open:bg-black/10 inline-flex h-9 rounded-full border text-[13px] font-medium",u?"text-token-interactive-label-accent-default can-hover:hover:bg-[#BDDCF4] dark:can-hover:hover:bg-[#1A416A] bg-token-composer-blue-bg border-transparent dark:bg-[#2A4A6D] dark:text-[#48AAFF]":"border-token-border-default text-token-text-secondary can-hover:hover:bg-token-main-surface-secondary focus-visible:outline-black dark:focus-visible:outline-white",l&&"duration-75 motion-safe:transition-all"),children:[e.jsxs("div",{className:"flex h-full min-w-8 items-center justify-center p-2","aria-pressed":u,onTransitionEnd:()=>p(!1),onClick:g=>{c==="think"&&!t&&!x&&(g.stopPropagation(),g.preventDefault(),r(a==="low"?"medium":"low"))},children:[e.jsx(cf,{reasoningLevelTypes:o,reasoningLevelType:a}),s&&e.jsx(ke,{initial:!1,children:e.jsx(Y.span,{initial:{x:-10,width:0,opacity:0},animate:{x:0,width:"fit-content",opacity:1},exit:{x:-10,width:0,opacity:0},transition:{ease:"easeOut",duration:d?0:.15},children:e.jsx("div",{className:F("ps-1 pe-1 whitespace-nowrap",h&&!t&&"hidden"),children:t?n:f?.shortLabel})})}),!t&&c==="auto"&&!u&&!h&&e.jsx(Ss,{"aria-label":"",className:"h-[18px] w-[18px] opacity-50"})]}),u&&!x&&(t||c!=="think")?e.jsx("div",{className:"border-token-border-default mt-[1px] border-s p-2",style:{borderColor:u?"#0285FF28":void 0},onClick:g=>{g.stopPropagation(),g.preventDefault(),i()},children:e.jsx(Xn,{"aria-label":"",className:"h-[16px] w-[16px]"})}):c==="think"?e.jsx("div",{className:F("border-token-border-default border-s p-2",h&&"hidden"),style:{borderColor:u?"#0285FF28":void 0},children:e.jsx(Ss,{className:"h-[18px] w-[18px]"})}):null]})},Hi=({clientThreadId:t,rateLimitPopup:s,children:o,disabled:a,highlightTooltip:n=!1,disabledReason:i,currentModelName:r})=>{const c=Q(),l=ce(t,Z.getIsNewConversation),p=nt(),d=h=>{s!=null&&h&&A.logPopoverHover({type:"rate_limit",location:"file_upload",plan_type:p?.planType??"unknown"})},f=_n(ze.signUpButtonText),{isEligible:u}=Vl(t),x=!!s;return e.jsx(e.Fragment,{children:x?e.jsx("div",{className:"h-8",children:e.jsxs(Fm,{delayDuration:150,onOpenChange:d,children:[e.jsx(Hm,{asChild:!0,children:o}),e.jsx(Um,{children:e.jsx(Gm,{$as:zm,side:"left",sideOffset:0,align:"start",alignOffset:-12,className:"max-w-[320px]",children:e.jsx(df,{isNewConversation:l,rateLimitPopup:s,signUpButtonText:f})})})]})}):!a&&u?e.jsx(Bp,{clientThreadId:t,children:o}):e.jsx(xt,{sideOffset:0,label:a?i===Ge.ModelNotSupported?c.formatMessage({id:"pEB4vw",defaultMessage:"Attachments disabled for {modelName}"},{modelName:`${r}`}):i===Ge.ThinkModeInUse?c.formatMessage({id:"NRk4QL",defaultMessage:"Attachments disabled for Reason mode"}):i===Ge.SearchModeInUse?c.formatMessage({id:"YlO80p",defaultMessage:"Attachments disabled for Search mode"}):c.formatMessage({id:"9Wgi7B",defaultMessage:"Attach files is unavailable"}):c.formatMessage({id:"wkpQmi",defaultMessage:"Upload files and more"}),className:"flex",open:n?!0:void 0,side:"bottom",children:o})})},df=({isNewConversation:t=!1,rateLimitPopup:s,signUpButtonText:o})=>{const a=nt(),n=As(),i=jn(),r=Ps(),c=Tt();if(s==null)return null;const{call_to_action:l,description:p}=s,d=p||e.jsx(H,{...ya.defaultDescription}),f=l?.includes(ee.GET_PLUS),u=l?.includes(ee.AUTHENTICATE),x=u&&c;return e.jsxs("div",{className:"text-token-text-primary p-2 text-sm",children:[e.jsx("div",{className:"mb-3",children:d}),f?e.jsx(Rt,{size:"small",color:"secondary",onClick:()=>{tt(n,"Rate limited file upload popover"),A.logRateLimitGetPlusButtonClicked({type:"file_upload",location:"popover",plan_type:a?.planType??"unknown",is_hard_block:!1,is_new_conversation:t,hard_block_reason:""})},children:e.jsx(H,{...ya.getPlus})}):null,u?e.jsx(Rt,{size:"small",color:"primary",onClick:()=>{i({authType:r?"login":"signup",callback:h=>{r?A.logLogInButtonClicked({location:"File picker rate limit tooltip",provider:h}):A.logSignUpButtonClicked({location:"File picker rate limit tooltip",provider:h})}})},children:r?e.jsx(H,{...ze.logInButtonText}):e.jsx(H,{...o})}):null,x?e.jsx(Rt,{size:"small",color:"secondary",className:"ms-2",onClick:()=>{i({authType:r?"signup":"login",callback:h=>{r?A.logSignUpButtonClicked({location:"File picker rate limit tooltip",provider:h}):A.logLogInButtonClicked({location:"File picker rate limit tooltip",provider:h})}})},children:r?e.jsx(H,{...o}):e.jsx(H,{...ze.logInButtonText})}):null]})},ya=Ee({defaultDescription:{id:"U5qAWP",defaultMessage:"You've reached your daily upload limit. Get ChatGPT Plus to unlock more."},getPlus:{id:"TeyLcp",defaultMessage:"Get Plus"}});function mf({setOpen:t,open:s,...o}){return e.jsxs(e.Fragment,{children:[e.jsx(Pe.Trigger,{className:"m-0 h-0 w-0 border-none bg-transparent p-0"}),e.jsx(Ui,{...o,onClick:()=>t(!0),open:s})]})}function Ui({clientThreadId:t,icon:s,isDisabled:o=!1,showLabel:a=!1,highlightTooltip:n=!1,hideBorder:i=!1,isSmall:r=!1,disabledReason:c,currentModelName:l,visualTreatment:p,onClick:d,open:f,hasPopoverTrigger:u=!1,showGlowingBorder:x}){const h=Fs(),g=Q();o=o||!!h;const b=e.jsxs(Oa,{disabled:o,"aria-disabled":o,"aria-label":o?g.formatMessage({id:"NTwThg",defaultMessage:"Attach files is unavailable"}):g.formatMessage({id:"ixBxc3",defaultMessage:"Upload files and more"}),onClick:S=>{S.preventDefault(),d()},$open:f,$showLabel:a,$showGlowingBorder:x,$hideBorder:i,$isSmall:r,$visualTreatment:p,children:[s,a&&e.jsx(La,{})]});return e.jsx(Hi,{clientThreadId:t,rateLimitPopup:h,highlightTooltip:n,disabled:o,disabledReason:c,currentModelName:l,children:u?e.jsx(Xt,{asChild:!0,children:b}):b})}function Gi({clientThreadId:t,icon:s,isDisabled:o=!1,showLabel:a=!1,highlightTooltip:n=!1,hideBorder:i=!1,isSmall:r=!1,disabledReason:c,currentModelName:l,visualTreatment:p,isLoading:d,handleLocalFileUploadClick:f,noAvailableConnectors:u,showMenuForNoAuth:x,announcement:h}){const{openPopover:g,isOpen:b}=Bt(),{openMenu:S,confirmMenuOpened:C}=Fa();m.useEffect(()=>{S&&(g(),C())},[S,C,g]);const k=()=>{if(u&&!d&&!x){f();return}g(),h.eligible&&h.markAsViewed(),A.logEventWithStatsig("Composer: Open Context Connector Picker","chatgpt_composer_open_context_connector_picker")};return e.jsx(Ui,{clientThreadId:t,icon:s,isDisabled:o,showLabel:a,highlightTooltip:n,hideBorder:i,isSmall:r,disabledReason:c,currentModelName:l,visualTreatment:p,onClick:k,open:b,hasPopoverTrigger:!0})}const vn=({children:t,sideOffset:s=-35,...o})=>{const a=qe(),{isOpen:n,closePopover:i,popoverContentRef:r}=Bt();return m.useEffect(()=>{if(n)return ql(i,r)},[n,r,i]),m.useEffect(()=>{if(!n)return;const c=l=>{l.key==="Escape"&&i()};return document.addEventListener("keydown",c,{capture:!0,passive:!0}),()=>document.removeEventListener("keydown",c,{capture:!0})},[n,i]),e.jsx(Ns,{forceMount:!0,children:e.jsx(Bs,{forceMount:!0,asChild:!0,align:"center",sideOffset:s,onClick:c=>{c.stopPropagation(),c.preventDefault()},onOpenAutoFocus:c=>{c.preventDefault()},...o,children:e.jsx("div",{ref:r,className:F(!n&&"pointer-events-none"),children:e.jsx(ke,{mode:"sync",children:n&&e.jsx(Y.div,{className:F("border-token-border-xlight origin-radix-popover dark:bg-token-main-surface-secondary flex overflow-clip rounded-2xl border bg-white shadow-2xl dark:border-white/5 dark:shadow-[0px_24px_64px_rgba(0,0,0,0.32)]"),variants:{open:{scale:[.7,1],opacity:1,transition:a?oe:gt},closed:{opacity:0,scale:.8,transition:a?oe:{...gt,duration:.2}}},initial:"closed",animate:"open",exit:"closed",children:t})})})})})},zi=({as:t="div",children:s,className:o,isSelected:a=!1,shape:n="rectangle",spacing:i="normal",disableHover:r=!1,isLegacyStyle:c=!1,borderVisible:l=!1,...p})=>{const d=t==="div"?Y.div:Y.button,f=!r&&"hover:border-black/0 hover:bg-black/5 motion-safe:transition-colors dark:hover:bg-white/5",u=!r&&"hover:bg-black/[0.075]! dark:hover:bg-white/10!";return e.jsx(d,{className:F("relative -ms-1 flex cursor-pointer flex-row items-center justify-center gap-1 rounded-3xl border py-1 font-medium whitespace-nowrap select-none *:pointer-events-none","[font-size:var(--pill-font-size,14px)]",i==="compact"&&n==="round"&&"px-1.5",i==="compact"&&n==="rectangle"&&"px-2.5",i==="normal"&&n==="rectangle"&&"px-3.5",c?"min-h-9":"min-h-8",l?"border-token-border-default":"border-transparent",a?c?"text-token-interactive-label-accent-default bg-token-composer-blue-bg hover:bg-[#BDDCF4] focus-visible:outline-black dark:bg-[#2A4A6D] dark:text-[#48AAFF] dark:hover:bg-[#1A416A] dark:focus-visible:outline-white":F("dark:text-token-composer-blue-text bg-black/[0.045] dark:bg-white/5",u):c?"hover:bg-token-main-surface-secondary":F("[color:var(--pill-color,var(--text-secondary))]",f),o),...p,children:s})},yn=({children:t,className:s,isSelected:o=!1,onClick:a,tooltipLabel:n,...i})=>{const{isOpen:r,openPopover:c,popoverTriggerRef:l}=Bt(),p=m.useCallback(f=>{(f.key==="Enter"||f.key===" ")&&(f.preventDefault(),c())},[c]),d=m.useCallback(f=>{a?.(f),!f.defaultPrevented&&c()},[a,c]);return e.jsx(xt,{sideOffset:0,label:n,delayDuration:500,children:e.jsx(Xt,{asChild:!0,onFocusCapture:f=>{f.stopPropagation()},children:e.jsx(zi,{animate:r?"inactive":"active",as:"div",role:"button",className:F("group motion-safe:[transition:border-color_0.1s_ease-in-out]",s),isSelected:o,"data-reasoning-popover-action":!0,onClick:d,onKeyDown:p,ref:l,tabIndex:0,...i,children:t})})})};function pf(t=!1){const[s,o]=m.useState(t),[a,n]=m.useState(!1);return{isOpen:s,isStartingToOpen:a,setIsOpen:o,setIsStartingToOpen:n}}function so({layoutMode:t,initialOpen:s=!1,forceOpen:o=!1,restoreFocus:a,children:n,onClose:i,mode:r="default",modal:c}){const{isOpen:l,isStartingToOpen:p,setIsOpen:d,setIsStartingToOpen:f}=pf(s||o),u=o||l,x=m.useRef(null),h=m.useRef(null),g=m.useCallback((k=!0)=>{u||(d(!0),$l(),requestAnimationFrame(()=>{f(!0),k&&Yl({root:x.current,autoFocus:!0})}))},[d,f,u]),b=m.useCallback(()=>{!p&&!u||(d(!1),f(!1),requestAnimationFrame(()=>{const k=new Event("focus");a?.(k),k.defaultPrevented||h.current?.focus()}),i?.())},[i,d,f,p,u,a]),S=k=>{k?g():b()},C={Trigger:{type:yn,instance:null},Content:{type:vn,instance:null}};return m.Children.forEach(n,k=>{if(m.isValidElement(k))if(k.type===yn||k.type===Xt||k.type===Gi){if(C.Trigger.instance)throw new Error("Only one trigger is allowed");C.Trigger.instance=k}else k.type===vn&&(C.Content.instance=k)}),e.jsx(Kl,{value:{closePopover:b,isOpen:u,isStartingToOpen:p,layoutMode:t,openPopover:g,popoverContentRef:x,popoverTriggerRef:h,mode:r},children:e.jsxs(Is,{open:u,onOpenChange:S,modal:c,children:[C.Trigger.instance,C.Content.instance]})})}const Wi=Xt,ff=yn,no=vn,gf=({clientThreadId:t,currentModelId:s,onModelSelection:o,closePopover:a,setIsModelPickerOpen:n,ref:i})=>{const r=Q(),{data:c}=Zt(),{mode:l}=Bt(),p=Ql({clientThreadId:t}),{hasInternalModels:d}=Xl(),{isUXUpdatesEnabled:f}=at(),h=Jl(b=>b.query).toLowerCase().trim().length>0,g=Zl();return e.jsxs(Y.div,{initial:{clipPath:"inset(0 100% 0 0)",opacity:0},animate:{clipPath:"inset(0 0% 0 0)",opacity:1},exit:{clipPath:"inset(0 100% 0 0)",opacity:0},transition:gt,className:F("flex flex-col",g&&"scroll-mt-[44px]"),ref:i,children:[l!=="model-picker-only"&&!f&&e.jsxs("div",{className:"border-token-border-xlight bg-token-main-surface-primary dark:bg-token-main-surface-secondary sticky start-0 top-0 z-10 flex w-full flex-row items-center justify-center overflow-clip border-b p-3",children:[e.jsx("button",{onClick:()=>{n(!1)},id:"reasoning-level-popover-model-list-back-button",className:"hover:bg-token-main-surface-tertiary flex items-center rounded-md p-1",children:e.jsx(Ha,{className:"text-token-text-secondary h-5 w-5"})}),e.jsx("div",{className:"flex-auto text-center text-sm font-medium",children:r.formatMessage({id:"j6WEI7",defaultMessage:"Choose a model"})}),e.jsx("div",{className:"w-5"})]}),e.jsx("div",{className:F("flex w-full flex-col pb-2",f?"pt-3":"pt-2",g&&"min-h-[375px]"),children:h?e.jsx(ec,{currentModelId:s,onModelSelection:o,closePopover:a,rootRef:i}):e.jsxs(e.Fragment,{children:[c?.categories?.map(b=>{const S=b?.defaultModel;return e.jsx(tc,{model:b,modelSwitcherDenialsBySlug:p,isSelected:S===s,onClick:()=>{o(S),a()}},S)}),d&&e.jsxs(e.Fragment,{children:[e.jsx(sc,{modelsData:c,clientThreadId:t,triggerButton:e.jsx(ft,{className:"relative mt-1 border-transparent",children:e.jsxs("div",{className:"mb-1 flex items-center px-1",children:[e.jsx("div",{className:"text-sm",children:r.formatMessage({id:"ZDpo4I",defaultMessage:"Internal Models"})}),e.jsx(Wm,{className:"icon-md text-token-text-tertiary absolute end-1 w-7"})]})}),onModelItemClick:b=>{b&&(o(b),a())}}),e.jsx(Ua,{})]})]})})]})},hf={modelPickerOpen:{maxHeight:375,width:320},modelPickerClosed:{maxHeight:245,width:320},vanguardModelPickerClosed:{maxHeight:320,width:264}},xf=({clientThreadId:t,reasoningLevelTypes:s,reasoningLevelType:o,onReasoningLevelChanged:a,isManualModelSelection:n,currentModelId:i,onModelSelection:r,resetReasoningLevel:c})=>{const{layoutMode:l,closePopover:p,mode:d}=Bt(),f=!Ds(),[u,x]=m.useState(!!(n||d==="model-picker-only")),h=m.useRef(null),g=m.useRef(null),{isUXUpdatesEnabled:b}=at();return m.useEffect(()=>{b&&u&&!n?requestAnimationFrame(()=>{g.current?.scrollIntoView({block:"start",behavior:"smooth"}),document.getElementById("reasoning-level-popover-juice-list-model-picker-button")?.focus()}):b&&n&&requestAnimationFrame(()=>{g.current?.scrollIntoView({block:"start",behavior:"instant"}),document.getElementById("reasoning-level-popover-juice-list-model-picker-button")?.focus()}),u?b||(h.current?.scrollTo({top:-1e3,behavior:"instant"}),document.getElementById("reasoning-level-popover-model-list-back-button")?.focus()):document.getElementById("reasoning-level-popover-juice-list-model-picker-button")?.focus()},[n,u,b]),e.jsxs(Y.div,{className:F("max-h-[max(calc(var(--radix-popover-content-available-height)-64px), 245px)] flex flex-1 origin-center snap-y snap-proximity scroll-pt-[30px] overflow-y-auto overscroll-contain scroll-smooth [scrollbar-gutter:stable]",!b&&f&&!u&&"pt-4",l==="bottom"&&!b?"flex-col-reverse":"flex-col"),animate:u?"modelPickerOpen":b?"vanguardModelPickerClosed":"modelPickerClosed",transition:xs,variants:hf,ref:h,children:[(!u||b)&&d!=="model-picker-only"&&e.jsx(nc,{clientThreadId:t,reasoningLevelTypes:s,reasoningLevelType:o,onReasoningLevelChanged:a,resetReasoningLevel:c,shouldShowModelPicker:f,setIsModelPickerOpen:x,isModelPickerOpen:u,showAccountPaymentModal:tt}),e.jsx(ke,{children:u&&f&&e.jsx(gf,{clientThreadId:t,setIsModelPickerOpen:x,ref:g,currentModelId:i,onModelSelection:r,closePopover:p})})]})},bf=({clientThreadId:t,layoutMode:s,currentModel:o,category:a,type:n,...i})=>{const{data:r}=Zt(),l=fe(R=>R.threads[t]?.modelSelection)?.type===Ce.SPECIFIC,p=fe(R=>R.setThreadModelSelection),d=Ds(),f=As(),u=m.useMemo(()=>{const R=o?.id??"";return oc(R)?"low":ac(R)?"medium":ic(R)?"high":"low"},[o?.id]),x=rc(),h=Mt(),g=m.useCallback(R=>{_t(t,p,{type:Ce.EFFORT_MODE,effortMode:qt[R]}),requestAnimationFrame(()=>{requestAnimationFrame(()=>{const B=lc(R,r?.categories.map(M=>M.defaultModel)??[]);B&&(d&&R==="high"?tt(f,"Model picker upsell"):h({location:"PromptTextarea",modelId:B}))})})},[t,h,f,d,r,p]),b=R=>{const B=o?.id??"";R&&(A.logEvent("Model Switcher Model Changed",{from:B,to:R,source:"popover"}),qm.logEvent("chatgpt_model_switcher_model_changed",R,{from:B,to:R,source:"popover"}),h({modelId:R,location:"Model switcher menu item"}),uc({type:Ce.SPECIFIC,modelSlug:R}),_t(t,p,{type:Ce.SPECIFIC,modelSlug:R}))},S=!cc(o?.id??""),C=l||S,N=(a?.label&&a?.label?.length<10?a?.label:a?.shortLabel)??o?.title??"",w=o?.id??"",_=()=>{g("low")},D=m.useCallback(()=>{const{reasoningLevelList:R}=x,M=(R.findIndex(v=>v.type===u)+1)%R.length;g(R[M].type)},[g,u,x]);return m.useEffect(()=>Vm(Ip,{cycleReasoningLevel:D}),[D]),e.jsxs(so,{layoutMode:s,...i,children:[e.jsx(Wi,{children:e.jsx(uf,{isManualModelSelection:C,modelName:N,animatedLabel:!0,reasoningLevelTypes:x,reasoningLevelType:u,onResetReasoningLevel:_,onReasoningLevelChanged:g,type:n})}),e.jsx(no,{align:"start",children:e.jsx(xf,{clientThreadId:t,reasoningLevelTypes:x,reasoningLevelType:u,onReasoningLevelChanged:g,modelName:N,isManualModelSelection:C,currentModelId:w,onModelSelection:b,resetReasoningLevel:_})})]})},Vi=({className:t,children:s})=>e.jsx(Y.div,{className:t,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,transition:{duration:.1,delay:0}},transition:{type:"tween",duration:.3,delay:.2},children:s});function Sf({canContinue:t,onContinueGenerating:s}){const o=m.useCallback(n=>{s(n),pn()},[s]);let a=null;return t&&(a=e.jsx(yf,{onHandleContinueGenerating:o})),a&&e.jsx("div",{className:"flex h-full w-full items-center justify-end gap-0 py-4 md:gap-2",children:a})}function vf({className:t}){return e.jsx(dc,{className:F("-rotate-180",t)})}const yf=({onHandleContinueGenerating:t})=>e.jsx(Vi,{children:e.jsx(Rt,{as:"button",color:"secondary",onClick:t,className:"py-2 whitespace-nowrap",icon:vf,size:"small",children:e.jsx(H,{...se.continueGenerating})})}),wf=({clientThreadId:t,composerController:s})=>{const o=_i(),a=Ue(s.store,h=>h.rateLimitBannerFeature),n=Ym(),i=o??Cf(a,n),r=ce(t,Z.getRequestId),c=ce(t,Z.getCurrentLeafId),l=ji(r),{layer:p}=st("1368081792"),d=i?.name?()=>{switch(i.name){case"o3-mini-high-in-context-upsell-free":case"o3-mini-high-in-context-upsell-plus":case"deep-research-in-context-upsell":bc(c);break}}:void 0,{value:f}=ae("3612584454");m.useEffect(()=>{l&&!(i?.name==="gpt-4l"&&f)&&(ha.dismissBanner(),s.setRateLimitBannerFeature(null))},[l,i?.name,f,s]);const u=i?.is_dismissible?()=>{A.logEventWithStatsig("Rate Limit: Dismiss Banner","chatgpt_rate_limit_banner_dismissed",{type:!p.get("should_change_model_picker",!0)&&i?.name==="o3-mini-high-in-context-upsell-plus"?"o3-mini-high-in-context-upsell-plus-no-model-switch":i?.name}),ha.dismissBanner(),s.setRateLimitBannerFeature(null)}:void 0,x=()=>{switch(i?.name){case"o3-mini-high-in-context-upsell-free":case"o3-mini-high-in-context-upsell-plus":case"deep-research-in-context-upsell":yc({interactedInPeriod:!0});break}};return e.jsx(ke,{children:i&&e.jsx(Y.div,{transition:{type:"tween",ease:"easeInOut",duration:.1},initial:{opacity:0,transform:"translateY(8px)"},animate:{opacity:1,transform:"translateY(0px)"},exit:{opacity:0,transform:"translateY(8px)"},children:e.jsx(Di,{clientThreadId:t,rateLimitInfo:i,onDismiss:u,onInteract:x,onMount:d})})})};function Cf(t,s){const o=s.find(a=>a.name===t);return o?{name:o.name,title:o.title,description:o.description,is_dismissible:!0,call_to_action:o.call_to_action,resets_after:o.resets_after}:null}function kf(t,s,o,a,n,i,r,c,l,p,d){if(l||(t.name==="o3-mini-high-in-context-upsell-free"||t.name==="o3-mini-high-in-context-upsell-plus")&&(s.some(C=>C.model_slug==="o3-mini-high")||o.id==="o3-mini-high")||c&&r&&cn(Date.now(),r)<sa)return!1;const u=a==null||cn(Date.now(),a)>=Sc,x=n===p,h=r==null||i==null||cn(Date.now(),r)>=sa||i<vc;if(!(u&&h||x))return!1;switch(t.name){case"deep-research-in-context-upsell":return d("should_show_deep_research_upsell_banner",!1);case"o3-mini-high-in-context-upsell-free":return d("should_show_o3_mini_high_upsell_banner_free_user_to_plus",!1);case"o3-mini-high-in-context-upsell-plus":return d("should_show_o3_mini_high_upsell_banner_plus_user",!1);default:return!1}}function jf(t,s){const o=$m(),a=mc(t),n=ce(t,Z.getRequestId),i=ce(t,Z.getCurrentLeafId),r=ji(n),c=_i(),l=pc(b=>b.lastSeenInContextUpsellBannerAt),p=fc(b=>b.inContextUpsellBannerPeriodExposureCount),d=gc(b=>b.inContextUpsellBannerPeriodStartAt),f=hc(b=>b.inContextUpsellBannerLastSeenId),u=xc(b=>b.inContextUpsellBannerInteractedInPeriod),{layer:x}=st("1368081792"),h=Ue(s.store,b=>b.rateLimitBannerFeature);let g=!1;switch(c?.name){case null:case void 0:g=h!=null;break;case"o3-mini-high-in-context-upsell-free":case"o3-mini-high-in-context-upsell-plus":case"deep-research-in-context-upsell":g=kf(c,o,a,l,f,p,d,u,r,i,x.get);break;default:g=!0}return!r&&g}const wn=window.sessionStorage,Cn=Km(Qm(()=>({memoryFullBannerDismissed:!!wn?.getItem(At.MemoryFullBannerDismissed)}))),qi={dismissBanner(){Cn.setState(t=>{t.memoryFullBannerDismissed=!0}),wn?.setItem(At.MemoryFullBannerDismissed,"true")},clearDismissedBanner(){Cn.setState(t=>{t.memoryFullBannerDismissed=!1}),wn?.removeItem(At.MemoryFullBannerDismissed)}};function _f(t){const s=Ri(t),o=wc(),{data:a}=Cc(s,!1,o),n=a!=null,i=n&&a.memoryFullPct>=100,[r,c]=m.useState(!1);m.useEffect(()=>{!i&&n&&(c(!0),qi.clearDismissedBanner())},[i,n]);const l=Cn(p=>p.memoryFullBannerDismissed);return i&&r&&!l}function Rf(){const t=Q(),{openSettings:s}=kc();return e.jsx(Y.div,{initial:{opacity:0},animate:{opacity:1},children:e.jsx(Ga,{title:t.formatMessage(hs.memoryFullTitle),content:t.formatMessage(hs.memoryFullTooltip,hs.memoryFullTooltip.values),primaryCtaText:t.formatMessage(hs.memoryManageButton),onPrimaryCtaClick:()=>s(jc.Personalization),onDismiss:()=>qi.dismissBanner()})})}const hs=Ee({memoryFullTitle:{id:"i1hV1R",defaultMessage:"ChatGPT's out of space for saved memories"},memoryManageButton:{id:"a5A88o",defaultMessage:"Manage"},memoryFullTooltip:{id:"Rs+Att",defaultMessage:"New memories won’t be added until you make space. <a>Learn more</a>",values:{a:t=>e.jsx("a",{href:_c,target:"_blank",rel:"noopener noreferrer",className:"underline",children:t})}}}),Af=()=>{const{shouldShowSkipButton:t}=Rc();return t?e.jsx(Vi,{className:"flex justify-center",children:e.jsx(Rt,{as:"button",color:"secondary",onClick:()=>Ac.skipParagen(),children:e.jsx(H,{...Mf.skip})})}):null},Mf=Ee({skip:{id:"dvcUbp",defaultMessage:"Skip"}}),Pf=Jn(()=>Zn(()=>import("./ebmdm6eq16wqsch2.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(t=>t.JawboneNotificationsBanner)),$i=m.memo(function({className:s}){const{store:o}=je(),a=o.useIsHeaderContentAreaPopulated();return e.jsx("div",{className:F(s??"absolute start-0 end-0 bottom-full",Tc.PromptTextareaHeader),children:e.jsx(Mc,{shouldRender:a,contentArea:$t.Header,children:e.jsxs("div",{className:"mb-2 flex flex-col gap-3.5 pt-2",children:[e.jsx(Ef,{}),e.jsx(Tf,{})]})})})});function Ef(){const{store:t}=je(),s=t.useSharedProps(c=>c?.clientThreadId),o=t.useContentAreaId($t.HeaderTop),a=Pc(),n=ce(s,c=>c?.modelId),i=Ec.useStore();let r;switch(o){case L.ProjectConversationTaskNoFileAccess:r=e.jsx(Df,{});break;case L.AdvancedVoiceOnMobileAnnouncement:r=e.jsx(Xc,{clientThreadId:s});break;case L.S09KM1:r=null;break;case L.ParagenControls:r=e.jsx(Af,{});break;case L.BannerSignup:r=e.jsx(If,{});break;case L.BannerTermsDisclaimer:r=e.jsx(Of,{});break;case L.PromptTextareaAction:r=e.jsx(Lf,{});break;case L.BannersRateLimit:r=e.jsx(Ff,{});break;case L.BannerSidekickAnnouncement:r=e.jsx(Qc,{});break;case L.SearchBrowserExtensionAnnouncement:r=e.jsx(Kc,{});break;case L.MoonshineAnnouncement:r=e.jsx(Yc,{});break;case L.CustomizeChatGPTAnnouncement:r=e.jsx($c,{});break;case L.SearchBrowserExtensionReactiveAnnouncement:r=e.jsx(qc,{});break;case L.BannerMemoryFull:r=e.jsx(Rf,{});break;case L.Box:r=e.jsxs("div",{id:"Box",className:"flex h-20 w-full items-center justify-center gap-2 bg-red-500 p-2",children:["box",e.jsxs("div",{className:"flex h-full w-full items-center justify-center gap-2 bg-blue-500 p-2",children:["inner",e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-yellow-400 text-center",children:"actual content"})]})]});break;case L.JawboneAnnouncement:a?r=e.jsx(Pf,{}):r=null;break;case L.JawboneMaxActiveAnnouncement:a?r=e.jsx(Vc,{}):r=null;break;case L.PromoRedemptionAnnouncement:r=e.jsx(Wc,{});break;case L.OperatorAnnouncement:r=e.jsx(zc,{});break;case L.BannerPlusUpsell:r=e.jsx(Gc,{});break;case L.ContextualAnswersAdminUpsell:r=e.jsx(Uc,{});break;case L.ContextualAnswersUserUpsell:r=e.jsx(Hc,{});break;case L.ReferrerRedemptionAvailableAnnouncement:r=e.jsx(Fc,{});break;case L.RefereeRedemptionAvailableAnnouncement:r=e.jsx(Lc,{});break;case L.ReferralProgramUpsellAnnouncement:r=e.jsx(Oc,{});break;case L.StudentsUpsellAnnouncement:r=e.jsx(Dc,{});break;case L.ModelDeprecationBanner:r=Ic(n);break;case L.TeamsContextualAnswersUpsell:r=e.jsx(Bc,{});break;case L.LanguageUpsellBanner:r=e.jsx(Nc,{onDismissSideEffect:()=>{A.logEventWithStatsig("Language Upsell Banner Dismissed","chatgpt_web_language_upsell_banner_dismissed"),i.closeBanner()},onPrimaryCtaClickSideEffect:()=>{A.logEventWithStatsig("Language Upsell Banner Primary CTA Clicked","chatgpt_web_language_upsell_banner_primary_cta_clicked"),i.closeBanner()}});break;default:r=null;break}return r}function Tf(){const{store:t}=je(),s=t.useContentAreaId($t.HeaderBottom);let o;switch(s){case za.DallePromptControls:o=e.jsx(Bf,{});break;default:o=null;break}return o}const Nf=Jn(()=>Zn(()=>import("./hv1bil5v7oivh3ja.js"),__vite__mapDeps([7,1,3,4,2,5])).then(t=>t.default));function Bf(){const{store:t}=je(),s=t.useSharedProps(o=>o?.composerController);return s?e.jsx(Nf,{composerController:s}):null}function If(){const{store:t}=je(),s=t.useSharedProps(n=>n?.clientThreadId),o=Ps(),a=Jc();return s?o?e.jsx(Zc,{threadId:s,showSignUp:a}):e.jsx(eu,{threadId:s,showLogin:a}):null}function Df(){return m.useEffect(()=>()=>{mn.getItem(At.TasksHasSeenProjectDisclaimerBanner)||mn.setItem(At.TasksHasSeenProjectDisclaimerBanner,!0)},[]),e.jsx(Ga,{icon:e.jsx(Tn,{}),title:e.jsx(H,{id:"ibX3g7",defaultMessage:"Tasks can’t access project files"}),content:e.jsx(H,{id:"fm94Tm",defaultMessage:"There’s a task in this conversation — just FYI, it won’t be able to access project files."}),onDismiss:()=>{mn.setItem(At.TasksHasSeenProjectDisclaimerBanner,!0)}})}function Of(){const{store:t}=je(),s=t.useSharedProps(o=>o?.clientThreadId);return s?e.jsx(tu,{threadId:s}):null}function Lf(){const{store:t}=je(),s=t.useSharedProps();return s?e.jsx(Sf,{...s}):null}function Ff(){const{store:t}=je(),s=t.useSharedProps(a=>a?.clientThreadId),o=t.useSharedProps(a=>a?.composerController);return!s||!o?null:e.jsx(wf,{clientThreadId:s,composerController:o})}const Hf=5,Uf=m.memo(function(s){return Gf(s),zf(s),Wf(),null});function Gf(t){const{store:s}=je(),o=s.useSetSharedProps();Rs(()=>{o(t)},[t,o])}function zf(t){const{clientThreadId:s,canContinue:o}=t,{store:a}=je(),n=m.useRef({top:a.useContentAreaApi($t.HeaderTop),bottom:a.useContentAreaApi($t.HeaderBottom)}).current,i=su(s),{shouldShowBannerSignup:r,shouldShowBannerTermsDisclaimer:c}=Vf(s),l=jf(s,t.composerController),p=nu(t),d=ou(t),f=Da(),u=au(),x=iu(t),h=_f(s),g=ru(),b=lu(t),S=cu(s),C=uu(s),k=du(),{eligible:N}=Ve(ku),w=mu(),_=pu(),D=fu(),R=gu(),B=hu(s),M=xu(s),v=bu(),W=Su(s),G=vu(s),P=yu(s),j=ce(s,O=>O?.modelId),V=Ts(s);Rs(()=>{j&&V?.kind===He.GizmoInteraction&&V.gizmo&&ju(j,V.gizmo)?n.top.set(L.ProjectConversationTaskNoFileAccess):b.eligible?n.top.set(L.AdvancedVoiceOnMobileAnnouncement):g?n.top.set(L.ParagenControls):c?n.top.set(L.BannerTermsDisclaimer):l?n.top.set(L.BannersRateLimit):v?n.top.set(L.BannerPlusUpsell):W?n.top.set(L.ContextualAnswersAdminUpsell):G?n.top.set(L.ContextualAnswersUserUpsell):S?n.top.set(L.JawboneAnnouncement):C?n.top.set(L.JawboneMaxActiveAnnouncement):p.eligible?n.top.set(L.BannerSidekickAnnouncement):f?n.top.set(L.MoonshineAnnouncement):u?n.top.set(L.CustomizeChatGPTAnnouncement):d?n.top.set(L.SearchBrowserExtensionAnnouncement):x?n.top.set(L.SearchBrowserExtensionReactiveAnnouncement):k?n.top.set(L.PromoRedemptionAnnouncement):N?n.top.set(L.OperatorAnnouncement):D?n.top.set(L.ReferralProgramUpsellAnnouncement):o?n.top.set(L.PromptTextareaAction):r?n.top.set(L.BannerSignup):h?n.top.set(L.BannerMemoryFull):w?n.top.set(L.ReferrerRedemptionAvailableAnnouncement):_?n.top.set(L.RefereeRedemptionAvailableAnnouncement):R?n.top.set(L.StudentsUpsellAnnouncement):B?n.top.set(L.ModelDeprecationBanner):M?n.top.set(L.TeamsContextualAnswersUpsell):P?n.top.set(L.LanguageUpsellBanner):n.top.set(null)},[n,o,c,r,l,p,h,g,b]),Rs(()=>{i&&n.bottom.set(za.DallePromptControls)},[n,i])}function Wf(){const{store:t}=je();m.useEffect(()=>()=>{t.reset()},[t])}function Vf(t){const{isUnauthenticated:s}=_e(),{layer:o}=st("3637408529",{shouldLogExposure:!1}),{layer:a}=st("3637408529"),n=a.get("no_auth_banner_signup_rate_limit",Hf),i=o.get("should_show_no_auth_signup_banner",!0),r=wu(f=>f.bannerDisclaimerClientThreadId),c=Cu(),l={shouldShowBannerTermsDisclaimer:!1,shouldShowBannerSignup:!1},[p,d]=ce(t,f=>[Z.getConversationTurns(f).filter(u=>u.role===Ai.User).length,qf(Z.getCurrentNode(f)?.message)]);return t&&(l.shouldShowBannerTermsDisclaimer=d&&s&&p===1&&!c&&(r==null||r===t),l.shouldShowBannerSignup=i&&d&&s&&p>0&&p%n===0),l}function qf(t){return t?.author.role===Ai.Assistant&&Xm(t)}const $f=Jm({}),Yf=({serverThreadId:t,clientThreadId:s,getIsDisabled:o,composerController:a,onReset:n,onInfer:i,isInferEnabledForModel:r})=>{const[c,l]=m.useState(!1),p=ot(),d=Zm(p,"3519990784").value,f=Number(d?.inference_debounce_ms??200),u=ht(p,"209963048"),x=ep(),h=m.useRef(null),b=_u(({enableInferredJuice:w})=>w)||u||r,S=m.useRef(i);S.current=i;const C=m.useRef(0),k=m.useRef(0),N=m.useCallback(ys(w=>{if(o())return;A.logEventWithStatsig("chatgpt_web_autoswitch_infer_called","chatgpt_web_autoswitch_infer_called");const _=w.length,D=_<5?"<5":_<=10?"5-10":_<=20?"10-20":_<=50?"30-50":"50+";if(Mi.count(Pi.DEFAULT,"chatgpt_web_autoswitch_infer_called",{prompt_length:D}),u)return;const R=++C.current,B=Date.now();l(B);const M=We(s),v=Z.getCurrentNode(M);bn.postAnonAware("/conversation/infer",{prompt:w,conversation_id:t??null,is_history_and_training_disabled:x,parent_message_id:v.message.id},{additionalHeaders:{"x-conduit-token":h.current??""}}).then(W=>{if(h.current=W.conduit_token,o()||k.current>R||a.getContentToSend().content.length<w.length)return;k.current=R;const{effort_mode:G,debug_info:P}=W;P&&$f.set(P),S.current(G)}).finally(()=>{l(W=>W&&B<W?W:!1)})},f),[o,t]);return m.useEffect(()=>{if(!(!b||!(a instanceof Ms)))return a.subscribe("change",()=>{const{content:w}=a.getContentToSend();o()||!b||(w?N(w):(h.current=null,n(),l(!1),++C.current,k.current=C.current))})},[b,o,a,N,i,n,t,x]),c!==!1};function Yi({clientThreadId:t,getInputProps:s,openFileDialog:o,uploadType:a,icon:n,isDisabled:i=!1,isSmall:r=!1,showLabel:c=!1,showUpsell:l=!1,hideBorder:p=!1,highlightTooltip:d=!1,disabledReason:f,currentModelName:u}){const x=Q(),h=Fs();i=(i||!!h)&&!l;const g=e.jsxs(Oa,{disabled:i,$showLabel:c,$hideBorder:p,$isSmall:r,onClick:C=>{if(C.preventDefault(),l){A.logNoAuthAttachButtonClicked({location:"No auth upsell"});return}A.logEvent("Open File Viewer",{intent:a.toString()}),o()},"aria-label":i?f===Ge.ModelNotSupported?x.formatMessage({id:"pEB4vw",defaultMessage:"Attachments disabled for {modelName}"},{modelName:`${u}`}):f===Ge.ThinkModeInUse?x.formatMessage({id:"NRk4QL",defaultMessage:"Attachments disabled for Reason mode"}):f===Ge.SearchModeInUse?x.formatMessage({id:"YlO80p",defaultMessage:"Attachments disabled for Search mode"}):x.formatMessage({id:"PromptFilePicker.attachFilesUnavailable",defaultMessage:"Attach files is unavailable"}):x.formatMessage({id:"PromptFilePicker.attachFiles",defaultMessage:"Upload files and more"}),children:[n,c&&e.jsx(La,{})]}),b=e.jsx("input",{disabled:i,...s({className:"hidden"})}),S=e.jsxs("div",{className:"flex",children:[g,b]});return l?e.jsx(xt,{sideOffset:0,label:e.jsx(H,{id:"wkpQmi",defaultMessage:"Upload files and more"}),side:"bottom",open:d||void 0,children:e.jsx(tp,{triggerButton:S,sideOffset:0,alignOffset:0,children:e.jsx(Mn,{location:"attach",statsig_login_event:"chatgpt_composer_upsell_login_button_clicked",statsig_signup_event:"chatgpt_composer_upsell_signup_button_clicked"})})}):e.jsx(Hi,{disabled:i,clientThreadId:t,rateLimitPopup:h,highlightTooltip:d,children:S})}function Kf({code:t,message:s}){switch(t){case na.FileTooLarge:return wa.errorFileTooLarge;case na.TooManyFiles:return A.logEvent("Uploaded Max Files Error"),wa.errorTooManyFiles;default:return s}}const wa=Ee({attachImages:{id:"PromptFilePicker.attachImages",defaultMessage:"Attach images"},attachFiles:{id:"PromptFilePicker.attachFiles",defaultMessage:"Upload files and more"},errorFileTooLarge:{id:"PromptFilePicker.errorFileTooLarge",defaultMessage:"Your file is too large. The maximum file size is {size}MB."},errorTooManyFiles:{id:"PromptFilePicker.errorTooManyFiles",defaultMessage:"You may only upload {maxNum} files at a time."},defaultFileUploadRateLimited:{id:"U5qAWP",defaultMessage:"You've reached your daily upload limit. Get ChatGPT Plus to unlock more."},getPlusButton:{id:"TeyLcp",defaultMessage:"Get Plus"}}),Ca=Ee({dragInstructions:{id:"FileDropZone.dragInstructions",defaultMessage:"Add anything"},dragAllAccepted:{id:"FileDropZone.dragAllAccepted",defaultMessage:"Drop any file here to add it to the conversation"}});function Qf(t){if(!t.accept||Object.keys(t.accept).length===0)return[];const s=[];return Object.values(t.accept).forEach(o=>s.push(...o)),s.sort()}function fh(t){const{className:s,children:o,clientThreadId:a,currentModelConfig:n,noKeyboard:i}=t,r=Q(),c=It(),l=Ts(a),p=Yt(),d=ws(n,l,p),f=d!==mt.None,u=fn(_=>_.files),x=(d===mt.Multimodal?Nn:Bn)-u.length,h=x<=0,{getGizmoId:g}=In(),{handleFileAccepted:b}=ao(r,d,On(n,l),"drag",g,Dn(n,l)?.attachments),S=Fs(),C=Ln(Fn(n,l)),{getRootProps:k,isDragActive:N}=Hn({maxFiles:x,disabled:!f||h||S!=null,noClick:!0,noKeyboard:i,onDropAccepted:b,onDropRejected:_=>oo(_,r,c,d),multiple:!0,maxSize:Un,...C}),w=Qf(C);return e.jsxs("div",{...k({className:s}),children:[o,N&&e.jsxs(Xf,{children:[e.jsx(Ru,{}),e.jsx("h3",{children:e.jsx(H,{...Ca.dragInstructions})}),e.jsx("h4",{className:"w-2/3 text-center",children:w.length>0?w.join(", "):e.jsx(H,{...Ca.dragAllAccepted})})]})]})}function oo(t,s,o,a){const{errors:n}=t[0];n.forEach(i=>{const r=Kf(i);typeof r=="string"?o.danger(r,{hasCloseButton:!0}):o.danger(s.formatMessage(r,{size:Au,maxNum:a===mt.Multimodal?Nn:Bn}),{hasCloseButton:!0})})}function ao(t,s,o,a,n,i){const r=ot(),c=Ei(r).flags,l=It(),p=Gn(),d=Wa(),{isUnauthenticated:f}=_e(),u=c?.includes(_s.NoAuthEnableFileUploads);return{handleFileAccepted:m.useCallback(async(h,g)=>{A.logEvent("Upload File",{client:"web",eventSource:a,intent:s.toString()}),d.fileUploadAccepted();const b=n!=null?await n():void 0;h.length>0&&h.forEach(S=>{bs.uploadFile(p,Mu(S),S,s,o,t,l,{gizmoId:b,...u&&{isUnauthenticated:f}},i)})},[a,s,n,p,d,o,t,l,i,u,f])}}const Xf=Yn.div`absolute z-50 inset-0 flex gap-2 flex-col justify-center items-center after:contents-[""] after:absolute after:opacity-80 after:z-[-1] after:bg-token-main-surface-primary after:inset-0`,Ki=t=>{const s=[];s.push({category:null,systemHints:t.filter(o=>!o.category)});for(const o of sp)s.push({category:o,systemHints:t.filter(a=>a.category===o)});return s};function Qi({composerController:t,clientThreadId:s,onHintSelected:o}){const a=Ti(s),[n]=ce(s,P=>[P?.modelId]),{data:i}=Zt(),r=n??Pu(void 0).id,c=Va(i?.models,r),{configurationMenuType:l}=at(),{setThreadSystemHintMode:p,clearAllSystemHintModeTriggers:d}=ge(),{viewableSystemHints:f,persistedSystemHints:u}=et.useState(({availableHints:P,persistedSystemHints:j})=>({viewableSystemHints:P,persistedSystemHints:j})),[x,h]=m.useState([]),[g,b]=m.useState(void 0),[S,C]=m.useState(0);m.useEffect(()=>{if(!g)h([]);else{const P=g.text.toLocaleLowerCase(),j=f.filter(O=>{const U=O.name.toLocaleLowerCase().startsWith(P),I=O.systemHint.toLocaleLowerCase().startsWith(P);let q=!1;return O.regexMatches&&O.regexMatches.length>0&&(q=O.regexMatches.some(ne=>ne.replace(/[\^\$\(\)]/g,"").toLocaleLowerCase().startsWith(P))),U||I||q}).filter(O=>O.requiredFeatures.every(U=>c?.enabledTools?.includes(U))),V=Ki(j).map(O=>O.systemHints).flat();h(V)}},[g]),m.useEffect(()=>{t.view.dispatch(Sl(t.view.state.tr,{onHintMatch(P){b(j=>np(j,P)?j:P)}}))},[t]);const k=!f.length||!x.length||!g;m.useEffect(()=>{C(0)},[k]);const N=x.length,w=m.useCallback(P=>{C(j=>(P(j)%N+N)%N)},[N]),_=m.useCallback(()=>{C(-1)},[]),D=x[S],R=m.useCallback(()=>{g?.range&&t.delete(g.range.from,g.range.to)},[g,t]),B=({hintToSave:P=D,expectPerfectMatch:j})=>{if(!g||!D||j&&P.name.toLowerCase()!==g.text.toLowerCase())return!1;A.logEvent("System Hint Selected",{system_hint:P.systemHint,conversation_id:a??xn});const V=g.range.from===1?P.name:g.text+P.name.slice(g.text.length),O={clientThreadId:s};gs(t.view),u.size>0&&d();const U=!!P.composerBarButtonInfo,I=P.systemHint===T.Search;return U||I||l!=="none"?(p(P.systemHint,!0,O,I?Eu.CONVERSATION_COMPOSER_SLASH_SEARCH:void 0),R(),t.removeSystemHints(),!0):(t.addSystemHint(P.systemHint,V,g.range.from,g.range.to),!0)},M=m.useRef(B);M.current=B;const v=m.useRef(w);v.current=w;const W=m.useRef(g);W.current=g;const G=t.view;return m.useEffect(()=>(k||vl(G,P=>{if(P==="up")v.current(j=>j-1);else if(P==="down")v.current(j=>j+1);else if(P==="cancel")gs(G),yl(G);else if(P==="submit")if(o)R(),o(D.systemHint);else return gs(G),M.current({expectPerfectMatch:!1});else if(P==="checkMatch")return M.current({expectPerfectMatch:!0})}),()=>gs(G)),[k,G,D,o,R]),m.useEffect(()=>{k||A.logEvent("System Hint List Opened",{conversation_id:a??xn})},[k]),{suggestorClosed:k,systemHintSuggestions:x,hintMatch:g,selectedIndex:S,resetSelectedIndex:_,setSelectedIndex:C,saveHint:B}}function Jf({composerController:t,clientThreadId:s}){const{selectedIndex:o,systemHintSuggestions:a,suggestorClosed:n,setSelectedIndex:i,saveHint:r}=Qi({composerController:t,clientThreadId:s});return n?null:e.jsx(op,{className:"max-w-60",onMouseDown:c=>{c.preventDefault()},children:a.map((c,l)=>e.jsx("div",{onMouseOver:()=>i(l),onClick:()=>{r({hintToSave:c,expectPerfectMatch:!1}),t.focus()},children:e.jsx(Sn,{autoFocus:!1,className:"rounded-lg px-1 py-2",$spoofHovered:l===o,children:e.jsx(Xi,{title:c.name,description:c.description,logo:c.logo})})},c.systemHint))})}function Xi({title:t,description:s,logo:o,checked:a,badge:n}){const i=Q();return e.jsxs("div",{className:"group inline-flex w-full items-center justify-start gap-2 ps-1.5 pe-3",children:[e.jsx("div",{className:"flex h-7 w-7 items-center justify-center gap-2.5",children:e.jsx(Jt,{svgString:o,className:"icon-lg text-token-text-secondary"})}),e.jsxs("div",{className:"shrink grow basis-0",children:[e.jsxs("p",{className:"text-token-text-primary text-sm leading-tight font-normal",children:[t,n&&e.jsx("span",{className:"ms-2 rounded-full bg-blue-400 px-2 py-0.5 text-xs text-white","aria-label":i.formatMessage({id:"I75WNJ",defaultMessage:"Create image updated"}),children:e.jsx(H,{id:"uUmZQi",defaultMessage:"Updated"})})]}),!!s&&e.jsx("p",{className:"text-token-text-secondary text-[13px] leading-[18px] font-normal",children:s})]}),a&&e.jsx(Ni,{className:F("icon-md text-token-text-primary",{"group-hover:hidden":!a})})]})}function Zf({title:t,logo:s,checked:o,tool_uses_remaining:a,is_high_load:n}){return e.jsxs("div",{className:F("group inline-flex w-full items-center justify-start gap-4 ps-1.5 pe-3",o?"text-token-interactive-label-accent-default":n?"text-token-text-secondary":"text-token-text-primary"),children:[e.jsx("div",{className:"flex h-6 w-6 items-center justify-center gap-3",children:e.jsx(Jt,{svgString:s,"aria-label":"",className:"icon-md"})}),e.jsx("div",{className:"shrink grow basis-0",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"font-normal",children:t}),n&&e.jsx("p",{className:"text-xs",children:e.jsx(H,{id:"IgB5/a",defaultMessage:"Temporarily unavailable"})})]})}),!n&&(o?e.jsx(ap,{className:"icon-md"}):a?e.jsx("span",{className:"text-token-text-secondary",children:a}):void 0)]})}function ka({composerController:t,clientThreadId:s}){return t instanceof Ms?e.jsx(Jf,{composerController:t,clientThreadId:s}):null}function Ji({children:t,className:s,showBackground:o,showGlowingBorder:a}){return e.jsxs("div",{className:F("relative",a&&"overflow-clip rounded-full p-0.5"),children:[t,a&&e.jsx("div",{className:"border-glowing-gradient"}),o&&e.jsx(Y.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:F("pointer-events-none absolute inset-0 rounded-full",s)})]})}const eg=({showUnconnectedInSubmenu:t,unconnectedConnectors:s,handleOauthRedirect:o,handleConnectorClick:a,showOneDriveInSubmenu:n,isConnectorConfigLoading:i,connectedConnectors:r,desktopConnectors:c,modelSupportedImageMimeTypes:l,showMenuForNoAuth:p,handleLocalFileUploadClick:d,unconnectedOneDriveConnectors:f})=>{const[u,x]=m.useState("main"),h=u!=="main",g=Q(),b=m.useRef(null),S=qe();return m.useEffect(()=>{h?document.getElementById("vanguard-file-picker-popover-submenu-back-button")?.focus():b.current&&b.current.focus()},[h]),e.jsx("div",{className:F("max-h-[max(calc(var(--radix-popover-content-available-height)-64px), 215px)] flex flex-1 snap-y snap-proximity flex-col overflow-y-auto scroll-smooth py-2 [scrollbar-gutter:stable] focus-visible:rounded-[inherit] focus-visible:-outline-offset-1"),ref:b,tabIndex:0,children:e.jsxs(ke,{mode:"wait",children:[e.jsx(Y.div,{className:"flex flex-col",transition:S?oe:gt,children:u==="main"&&e.jsx(tg,{showUnconnectedInSubmenu:t,unconnectedConnectors:s,setActiveMenu:x,handleConnectorClick:a,showOneDriveInSubmenu:n,isConnectorConfigLoading:i,connectedConnectors:r,desktopConnectors:c,modelSupportedImageMimeTypes:l,showMenuForNoAuth:p,handleLocalFileUploadClick:d})},"main"),h&&e.jsxs(Y.div,{initial:{clipPath:"inset(0 100% 0 0)",opacity:0},animate:{clipPath:"inset(0 0% 0 0)",opacity:1},transition:S?oe:gt,className:"flex flex-col",children:[e.jsxs("div",{className:"border-token-border-xlight bg-token-main-surface-primary dark:bg-token-main-surface-secondary sticky start-0 top-0 z-10 flex w-full flex-row items-center justify-center overflow-clip border-b px-3 py-3",children:[e.jsx("button",{onClick:()=>x("main"),id:"vanguard-file-picker-popover-submenu-back-button",className:"hover:bg-token-main-surface-tertiary flex items-center rounded-md p-1",children:e.jsx(Ha,{className:"text-token-text-secondary h-5 w-5","aria-label":""})}),e.jsx("div",{className:"flex-auto text-center text-sm font-medium",children:g.formatMessage({id:"LlLQYj",defaultMessage:"Back"})}),e.jsx("div",{className:"w-5"})]}),e.jsxs("div",{className:"flex w-full flex-col py-2",children:[u==="connect-apps"&&e.jsx(Tu,{connectorEntries:s,onOauthRedirect:o}),u==="one-drive"&&e.jsx(Nu,{connectorEntries:f,onOauthRedirect:o})]})]},u)]})})};function tg({showUnconnectedInSubmenu:t,unconnectedConnectors:s,showOneDriveInSubmenu:o,setActiveMenu:a,handleConnectorClick:n,isConnectorConfigLoading:i,connectedConnectors:r,desktopConnectors:c,modelSupportedImageMimeTypes:l,showMenuForNoAuth:p,handleLocalFileUploadClick:d}){const f=Q();return e.jsxs(e.Fragment,{children:[t&&s.length>0&&e.jsx(ft,{label:f.formatMessage(ja.connectApps),icon:qa,isSubMenuTrigger:!0,onClick:()=>a("connect-apps")},"connect-apps-submenu-trigger"),!t&&s.map(u=>e.jsx(Cs,{entry:u,onClick:()=>n(u),visualTreatment:"vanguard"},u.id)),o&&e.jsx(ft,{label:f.formatMessage(ja.oneDriveSubmenuName),icon:$a,isSubMenuTrigger:!0,onClick:()=>a("one-drive")},"one-drive-submenu-trigger"),i&&e.jsx(ft,{icon:e.jsx(Ls,{className:"text-token-text-secondary"})}),(s.length>0||i)&&e.jsx(Ua,{}),r.map(u=>e.jsx(Cs,{entry:u,onClick:()=>n(u),visualTreatment:"vanguard"},u.id)),c.map(u=>e.jsx(Ya,{entry:u,visualTreatment:"vanguard"},u.key)),e.jsx(Ka,{modelSupportedImageMimeTypes:l,visualTreatment:"vanguard"}),e.jsx(Qa,{handleLocalFileUploadClick:d,showMenuForNoAuth:p,visualTreatment:"vanguard"})]})}const ja=Ee({connectApps:{id:"ContextConnectorPicker.connectApps",defaultMessage:"Connect apps"},oneDriveSubmenuName:{id:"ContextConnectorPickerOneDriveSubmenu.oneDriveSubmenuName",defaultMessage:"Connect to Microsoft OneDrive"}}),sg=({layoutMode:t,triggerButton:s,restoreFocus:o,...a})=>e.jsxs(so,{layoutMode:t,restoreFocus:o,children:[s,e.jsx(no,{align:"start",children:e.jsx(eg,{...a})})]});function ng(){const{connectorConfig:t}=Xa(),s=zn(),o=Wn(),[a,n]=ks(Ja([...t.values()],d=>!!d.access_token),d=>!!d.access_token),[i,r]=ks(n,d=>d.type===Ze.O365_PERSONAL||d.type===Ze.O365_BUSINESS),c=!s&&!o&&a.length>0,l=!s&&!o&&!c&&i.length>1;return{unconnectedConnectors:o?[]:l?r:n,showUnconnectedInSubmenu:c,showOneDriveInSubmenu:l}}function og({clientThreadId:t,icon:s,modelAcceptedMimeTypes:o,modelSupportedImageMimeTypes:a,attachmentsProductFeature:n,onOauthRedirect:i,uploadType:r,getInputProps:c,openFileDialog:l,isDisabled:p=!1,highlightTooltip:d=!1,showLabel:f,isSmall:u=!1,hideBorder:x=!1,disabledReason:h,currentModelName:g,visualTreatment:b="vanguard",showMenuForNoAuth:S=!1,showGlowingBorder:C=!1,layoutMode:k="centered",restoreFocus:N}){const w=ip().locale,_=Q(),D=It(),R=Gn(),{connectorConfig:B,isLoading:M}=Xa(),v=Ve(pe.ContextConnectors),{getGizmoId:W}=In(),{value:G}=ae("58345806"),P=G&&b==="vanguard",[j,V]=m.useState();m.useEffect(()=>{W?W().then(z=>V(z)):V(void 0)},[W]);const O=m.useRef(null),[U,I]=m.useState(!1),q=m.useRef(!1),ne=m.useCallback(()=>{const z=O.current?.files;Array.from(z??[]).forEach($=>Gt.uploadFile(R,$,a,_,D,n))},[R,a,_,D,n]),[ue,ie]=m.useState(null),$e=m.useCallback(()=>ie(null),[ie]),it=m.useCallback((z,$)=>Gt.uploadPickedFile(R,z,$,a,o,n,j,_,D),[R,a,o,n,j,_,D]),{openMenu:Re,confirmMenuOpened:xe}=Fa();m.useEffect(()=>{Re&&(I(!0),xe())},[Re,xe,I]);const E=m.useCallback(z=>{Gt.doContextConnectorOauthRedirect(location.pathname+location.search+location.hash,z,i,xa.Picker),i()},[i]),J=m.useCallback(z=>{Gt.uploadPickedFile(R,z,Ze.GDRIVE,a,o,n,j,_,D)},[R,a,o,n,j,_,D]),re=m.useCallback(async z=>{const{access_token:$}=z;if(!$){E(z);return}switch(Gt.logAttemptIfAccessTokenIsExpired(z,xa.Picker),z.type){case Ze.GDRIVE:Bu(w,z.type,$,Ke=>Ke.forEach(J));break;case Ze.O365_PERSONAL:case Ze.O365_BUSINESS:ie(z.type);break}},[J,E,ie,w]),Te=()=>{A.logEvent("Open File Viewer",{intent:r.toString()}),l()},Ne=z=>{if(!z&&q.current&&!M)Te();else if(z&&lt&&!M&&!S){Te();return}I(z),z&&(v.eligible&&v.markAsViewed(),A.logEventWithStatsig("Composer: Open Context Connector Picker","chatgpt_composer_open_context_connector_picker"),q.current=!0,setTimeout(()=>{q.current=!1},250))},[Ye,le]=ks(Ja([...B.values()],z=>!!z.access_token),z=>!!z.access_token);ag(Ye,re);const[Be]=ks(le,z=>z.type===Ze.O365_PERSONAL||z.type===Ze.O365_BUSINESS),{unconnectedConnectors:be,showUnconnectedInSubmenu:Ie,showOneDriveInSubmenu:rt}=ng(),{desktopConnectors:De}=Iu(a),lt=!Ye.length&&!be.length&&!De.length,te=e.jsxs(e.Fragment,{children:[Ie&&be.length>0&&e.jsx(Du,{connectorEntries:be,onOauthRedirect:z=>E(z)}),!Ie&&be.map(z=>e.jsx(Cs,{entry:z,onClick:()=>re(z)},z.id)),rt&&e.jsx(Ou,{connectors:Be,onOauthRedirect:E}),M&&e.jsx(Pe.Item,{icon:e.jsx(Ls,{className:"text-token-text-secondary"})}),(be.length>0||M)&&e.jsx(Pe.Separator,{}),Ye.map(z=>e.jsx(Cs,{entry:z,onClick:()=>re(z)},z.id)),De.map(z=>e.jsx(Ya,{entry:z},z.key)),e.jsx(Ka,{modelSupportedImageMimeTypes:a}),e.jsx(Qa,{handleLocalFileUploadClick:Te,showMenuForNoAuth:S})]}),Oe=P?e.jsx(Gi,{clientThreadId:t,icon:s,isDisabled:p,highlightTooltip:d,showLabel:f,hideBorder:x,isSmall:u,disabledReason:h,currentModelName:g,visualTreatment:b,isLoading:M,handleLocalFileUploadClick:Te,noAvailableConnectors:lt,showMenuForNoAuth:S,announcement:v}):e.jsx(mf,{clientThreadId:t,icon:s,setOpen:Ne,open:U,isDisabled:p,highlightTooltip:d,showLabel:f,hideBorder:x,isSmall:u,disabledReason:h,currentModelName:g,visualTreatment:b,showGlowingBorder:C}),bt=P?e.jsx(sg,{layoutMode:k,triggerButton:Oe,showUnconnectedInSubmenu:Ie,unconnectedConnectors:be,handleOauthRedirect:E,handleConnectorClick:re,showOneDriveInSubmenu:rt,isConnectorConfigLoading:M,connectedConnectors:Ye,desktopConnectors:De,modelSupportedImageMimeTypes:a,showMenuForNoAuth:S,handleLocalFileUploadClick:Te,unconnectedOneDriveConnectors:Be,restoreFocus:N}):e.jsxs(Pe.Root,{open:U,onOpenChange:Ne,children:[Oe,e.jsx(Pe.Portal,{children:e.jsx(Pe.Content,{alignOffset:-16,side:"top",children:te})})]}),Ae=e.jsxs("div",{className:"flex flex-col",children:[e.jsx(Lu,{type:ue,onClose:$e,uploadPickedFile:it}),e.jsx("input",{onChange:ne,...c({className:"hidden"})}),bt,e.jsx(Fu,{hasConnectors:!M&&!lt})]});return{dropdownItems:te,mainComponent:Ae}}function ag(t,s){const{connector:o,clearParam:a}=Hu(),n=t.find(i=>i.type===o&&!!i.access_token);m.useEffect(()=>{n&&(s(n),a())},[n,s,a])}function Zi(t){const{mainComponent:s}=og(t);return s}function ig({clientThreadId:t,uploadType:s,modelAcceptedMimeTypes:o,modelSupportedImageMimeTypes:a,attachmentsProductFeature:n,getInputProps:i,openFileDialog:r,onOauthRedirect:c,historyDisabled:l,isDisabled:p,highlightTooltip:d,disabledReason:f,currentModelName:u,showLabel:x,showUpsell:h,hideBorder:g,isSmall:b,showMenuForNoAuth:S,visualTreatment:C,showGlowingBorder:k}){const N=Wn(),{gdriveStatus:w,o365Status:_}=Za(),{isUnauthenticated:D}=_e(),R="h-[18px] w-[18px]",B=l?"text-white":d?"text-brand-blue-800":"",v=!h&&(S||w!=="false"||_!=="false"||N)?e.jsx(Zi,{showGlowingBorder:k,hideBorder:g,isSmall:b,clientThreadId:t,icon:D?e.jsx(js,{"aria-label":"",className:F(R,B)}):e.jsx(Ia,{"aria-label":"",className:F(R,B)}),showLabel:D&&x,modelAcceptedMimeTypes:o,modelSupportedImageMimeTypes:a,attachmentsProductFeature:n,onOauthRedirect:c,uploadType:s,openFileDialog:r,getInputProps:i,isDisabled:p,highlightTooltip:d,disabledReason:f,currentModelName:u,showMenuForNoAuth:S,visualTreatment:C}):e.jsx(Yi,{isSmall:b,hideBorder:g,clientThreadId:t,uploadType:s,openFileDialog:r,getInputProps:i,showLabel:x,showUpsell:h,icon:e.jsx(js,{"aria-label":"",className:F(R,B)}),isDisabled:p,highlightTooltip:d,disabledReason:f,currentModelName:u});return e.jsx("div",{className:"relative",children:e.jsx(Ji,{showBackground:d,showGlowingBorder:k,className:"bg-brand-blue-800/20",children:v})})}function er({suggestionData:t,visualTreatment:s,composerController:o}){const a=Q(),i=a.formatMessage(se.researchSuggestionInitial),r=m.useMemo(()=>[a.formatMessage(se.deepResearchPlaceholderBullet1),a.formatMessage(se.deepResearchPlaceholderBullet2),a.formatMessage(se.deepResearchPlaceholderBullet3)],[a]);return e.jsx(Uu,{composerController:o,visualTreatment:s,initialSuggestion:i,bulletPoints:r})}const Pt={type:"spring",stiffness:48.7,damping:13.54,mass:1};function rg({enabled:t,children:s,...o}){const a=qe();return e.jsxs(Y.div,{initial:{minHeight:0},animate:{minHeight:t?"142px":0},exit:{minHeight:0},transition:a?oe:Pt,className:"flex flex-col justify-start",children:[s,t&&e.jsx(er,{...o})]})}const lg=({items:t,searchTerm:s,setSearchTerm:o,selectedItems:a,searchPlaceholder:n,handleSelectItem:i,showConfigureRepos:r,showSelectAllRepos:c,loading:l,configureReposRef:p})=>{const d=Gu(),f=a?.includes("$all_accessible_repos");return e.jsx(Y.div,{variants:d,initial:"initial",animate:"animate",exit:"exit",className:"relative",children:e.jsxs("div",{className:"border-token-border-default bg-token-main-surface-primary flex max-h-60 w-full flex-col gap-2 overflow-y-auto rounded-lg border p-2",children:[e.jsx("input",{type:"text",value:s,onChange:u=>o(u.target.value),placeholder:n,className:"text-token-text-primary bg-token-main-surface-primary border-token-border-default w-full rounded-sm border-1 px-2 py-1 text-sm focus:ring-0 focus:ring-offset-0 focus:outline-hidden"}),t?.map(u=>{const x=a?.includes(u.name);return e.jsx(ft,{onClick:()=>{i(u)},isSelected:x,isActive:x,label:u.name,subtitle:u.description??void 0,className:"mx-0! w-full",selectedIconClassName:"color:black dark:color-gray"},u.name)}),l&&e.jsxs("div",{className:"text-token-text-secondary flex items-center justify-center gap-2 text-xs",children:[e.jsx(Ls,{}),e.jsx(H,{id:"M1WgQ2",defaultMessage:"Searching..."})]}),c&&e.jsx(ft,{onClick:()=>{i({name:"$all_accessible_repos"})},className:"mx-0! w-full",isSelected:f,isActive:f,label:e.jsx(H,{id:"pJnTxe",defaultMessage:"All Repositories"}),subtitle:e.jsx(H,{id:"EhTGqu",defaultMessage:"Select all repositories accessible to ChatGPT"}),selectedIconClassName:"color:black"},"select-all-repos"),r&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-token-border-primary border-token-border-default mt-2 mb-2 border-b",ref:p}),e.jsx(ft,{onClick:()=>{window.open(zu,"_blank")},isSelected:!1,isActive:!1,label:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Wu,{className:"icon-sm"}),e.jsx(H,{id:"8W+hV0",defaultMessage:"Configure Repos"})]}),subtitle:e.jsx(H,{id:"GXUcp/",defaultMessage:"Configure which repositories ChatGPT can access"}),className:"mx-0! w-full"},"configure-repos")]})]})})};function cg(t,s){const[o,a]=m.useState(t),n=m.useRef(ys(i=>a(i),s));return m.useEffect(()=>(n.current=ys(i=>{a(i)},s),()=>{n.current?.cancel()}),[s]),m.useEffect(()=>{n.current?.(t)},[t]),o}const ug=({searchTerm:t,setSearchTerm:s,selectedRepos:o,handleSelectRepo:a,linkId:n,showConfigureRepos:i=!1})=>{const r=It(),c=Q(),l=ot(),p=cg(t,300),{data:d,isFetching:f,isFetchingNextPage:u,isError:x,fetchNextPage:h,hasNextPage:g}=gl({queryKey:["github-repos",p,n],queryFn:async({pageParam:w=null})=>p.length===0?{repos:[],next_token:null}:ht(l,"1524828339")?await bn.safePost("/aip/connectors/github/search_repos",{requestBody:{query:p,limit:20,next_token:w,link_id:n}}):await bn.safePost("/aip/connectors/github/search_repos_v2",{requestBody:{query:p,limit:2,next_token:w,link_id:n}}),getNextPageParam:w=>w.next_token??void 0,initialPageParam:null,retry:1}),b=m.useRef(null),S=1,C=m.useRef(0);m.useEffect(()=>{if(!g||u)return;const w=b.current,_=new IntersectionObserver(D=>{D[0].isIntersecting&&C.current<S&&h()},{threshold:1});return w&&_.observe(w),()=>{w&&_.unobserve(w)}},[g,u,h]),m.useEffect(()=>{C.current=0},[p]),m.useEffect(()=>{x?(C.current+=1,C.current===1&&r.danger("Request error fetching Github repositories")):!u&&!x&&(C.current=0)},[x,u,r]);let k=d&&p?d.pages.flatMap(w=>w.repos).flatMap(w=>w.repository_full_name):[];k=Array.from(new Set([...k,...o.selectedRepos??[]]));const N=w=>{a(w.name)};return e.jsx("div",{children:e.jsx(lg,{showConfigureRepos:i,items:k?.map(w=>({name:w}))??[],searchTerm:t,setSearchTerm:s,selectedItems:[...o.selectedRepos??[],...o.selectedAllRepos?["$all_accessible_repos"]:[]],searchPlaceholder:c.formatMessage({id:"lo7uaF",defaultMessage:"Search repos…"}),handleSelectItem:N,showSelectAllRepos:!0,loading:f||u,configureReposRef:b})})};function dg({clientThreadId:t,selected:s,isVanguard:o,onToggle:a,repoSelectorOpen:n,setRepoSelectorOpen:i,linkId:r}){const{selectedRepos:c,setSelectedRepos:l}=Vn(t),p=Q(),[d,f]=m.useState(""),u=m.useRef(null),x=g=>{if(g==="$all_accessible_repos"){const b=!c?.selectedAllRepos;l({selectedRepos:[],selectedAllRepos:b})}else if(c?.selectedRepos?.includes(g)){const b=c.selectedRepos?.filter(S=>S!==g);l({selectedRepos:b,selectedAllRepos:!1})}else{const b=[...c?.selectedRepos??[],g];l({selectedRepos:b,selectedAllRepos:!1})}};let h=e.jsx(H,{id:"eC2vew",defaultMessage:"GitHub"});if(c?.selectedAllRepos)h=e.jsx(H,{id:"scEauJ",defaultMessage:"All Repositories"});else if(c?.selectedRepos?.length&&c?.selectedRepos?.length>=1){const g=c.selectedRepos,[b]=g,S=g.length-1;h=S>0?`${b} +${S}`:b}return e.jsx(Is,{open:n,onOpenChange:g=>{i(g)},children:e.jsx(qn,{children:e.jsxs("div",{className:F("inline-flex min-h-8 items-center rounded-full text-sm font-medium transition-colors focus:outline-hidden",s?"border-token-border-default bg-token-main-surface-primary border":o?"text-token-text-secondary":"text-token-text-tertiary",o?"":"border-token-border-default border"),children:[e.jsxs("button",{type:"button","aria-pressed":s,onClick:g=>{g.stopPropagation(),g.preventDefault(),a()},className:"flex items-center gap-1 px-2 py-1",children:[e.jsx(Vu,{"aria-hidden":!0,className:F("h-4 w-4 transition-colors",s?"bg-token-main-surface-primary":"grayscale filter")}),e.jsx("span",{children:h}),s&&e.jsx(Xn,{className:"text-token-text-tertiary h-4 w-4"})]}),s&&e.jsx(Xt,{asChild:!0,children:e.jsx("button",{type:"button","aria-label":p.formatMessage({id:"eoO5dY",defaultMessage:"Select repository"}),className:"border-token-border-default border-s p-1 focus:outline-none",onClick:()=>{i(!n)},children:e.jsx(qu,{className:"h-3 w-3"})})}),n&&r&&e.jsx(Ns,{children:e.jsx(Bs,{side:"bottom",align:"start",ref:u,children:e.jsx(ug,{searchTerm:d,setSearchTerm:f,selectedRepos:{selectedRepos:c.selectedRepos?[...c.selectedRepos]:[],selectedAllRepos:c.selectedAllRepos},handleSelectRepo:x,showConfigureRepos:!0,linkId:r})})})]})})})}function io(){const s=$u().has(T.Research),o=!1,a=ae("3544641259")?.value;return(s||o)&&a}function Vt({label:t,selected:s,onClick:o,Icon:a,isVanguard:n,iconColor:i}){return e.jsxs("button",{type:"button","aria-pressed":s,onClick:r=>{r.stopPropagation(),r.preventDefault(),o()},className:F("flex min-h-8 items-center gap-1 rounded-full px-2 py-1 text-sm font-medium transition-colors",s?"border-token-border-default bg-token-main-surface-primary border":n?"text-token-text-secondary":"text-token-text-tertiary",n?"":"border-token-border-default border"),children:[e.jsx(a,{"aria-hidden":!0,className:F("h-4 w-4 transition-colors",s?"bg-token-main-surface-primary":"grayscale filter",i||"text-token-text-primary")}),e.jsx("span",{children:t}),s&&e.jsx(Xn,{className:"text-token-text-tertiary h-4 w-4"})]})}const tr=({clientThreadId:t,isVanguard:s=!1})=>{const{isOpen:o}=Kt(),{selectedSources:a,toggleSource:n,deleteSource:i}=ei(t),[r,c]=m.useState(!1),{selectedRepos:l}=Vn(t),p=ot(),{isGdriveActionConnectorEnabled:d,isDropboxConnectorEnabled:f,isLinearConnectorEnabled:u,isGitHubLinkEnabled:x,isSharepointConnectorEnabled:h}=Yu(),{connectorLinks:g}=Ku(),S=!!g.get(dt[ye.GDRIVE_ACTION_CONNECTOR]),k=!!g.get(dt[ye.DROPBOX_CONNECTOR]),w=!!g.get(dt[ye.LINEAR_CONNECTOR]),_=g.get(dt[ye.GITHUB_CONNECTOR]),D=!!_,B=!!g.get(dt[ye.SHAREPOINT_CONNECTOR]),{platformConnectors:M,isLoading:v}=Qu(),W=G=>{const P=M.get(dt[G]);if(v||!P)return;let j=null;G===ye.GDRIVE_ACTION_CONNECTOR&&(ht(p,"1474375809")?j="google_oauth_client":j="google_internal_testing_oauth_client");const V={connectorId:dt[G],name:P.name,actionNames:ed[G],oauthClientId:j,oauthClientScopes:null},O=`#settings/ConnectorSettings?scroll=${nd[G]}`;td(sd,V,O)};return m.useEffect(()=>{!r&&!l?.selectedRepos?.length&&!l?.selectedAllRepos&&i(me.GitHub)},[t,a,r,l,i]),!t||!a||!o?null:e.jsxs("div",{children:[e.jsx("div",{className:"border-token-border-xlight absolute inset-x-[15px] top-0 h-0 border-t"}),e.jsx("div",{className:F("z-0 w-full p-3","bg-token-main-surface-primary dark:bg-[#303030]"),children:e.jsxs("div",{className:"flex items-center gap-4",children:[!s&&e.jsx("span",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(H,{id:"dyMo44",defaultMessage:"Sources"})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(Vt,{label:e.jsx(H,{id:"G03bJa",defaultMessage:"Web"}),selected:a.has(me.Web),onClick:()=>n(me.Web),Icon:Xu,iconColor:"text-blue-400",isVanguard:s}),x&&e.jsx(dg,{clientThreadId:t,selected:a.has(me.GitHub)&&D,onToggle:()=>{D?(!l?.selectedRepos?.length&&!l?.selectedAllRepos&&c(!0),n(me.GitHub)):W(ye.GITHUB_CONNECTOR)},repoSelectorOpen:r,setRepoSelectorOpen:c,isVanguard:s,linkId:_?.id}),d&&e.jsx(Vt,{label:e.jsx(H,{id:"m4j0Bv",defaultMessage:"Drive"}),selected:a.has(me.GoogleDrive)&&S,onClick:()=>S?n(me.GoogleDrive):W(ye.GDRIVE_ACTION_CONNECTOR),Icon:ti,isVanguard:s}),f&&e.jsx(Vt,{label:e.jsx(H,{id:"15Ur3S",defaultMessage:"Dropbox"}),selected:a.has(me.Dropbox)&&k,onClick:()=>k?n(me.Dropbox):W(ye.DROPBOX_CONNECTOR),Icon:Ju,isVanguard:s}),u&&e.jsx(Vt,{label:e.jsx(H,{id:"ExApna",defaultMessage:"Linear"}),selected:a.has(me.Linear)&&w,onClick:()=>w?n(me.Linear):W(ye.LINEAR_CONNECTOR),Icon:Zu,isVanguard:s}),h&&e.jsx(Vt,{label:e.jsx(H,{id:"ar5WAU",defaultMessage:"SharePoint"}),selected:a.has(me.Sharepoint)&&B,onClick:()=>B?n(me.Sharepoint):W(ye.SHAREPOINT_CONNECTOR),Icon:$a,isVanguard:s})]})]})})]})};function mg(){const t=qe(),a={initial:{opacity:0,y:"-28px",rotate:45},animate:{opacity:1,y:0,rotate:45,transition:t?oe:{opacity:{delay:.4},default:Pt}},exit:{opacity:0,y:"-28px",rotate:45,transition:t?oe:{opacity:{delay:0},default:Pt}}};return e.jsx(Y.div,{variants:a,initial:"initial",animate:"animate",exit:"exit",className:"border-token-border-xlight bg-token-main-surface-primary absolute start-1/2 top-full mt-[11px] h-2 w-2 -translate-x-1/2 transform rounded-se-[1px] rounded-es-[1px] border-s border-t dark:bg-[#303030]"})}const ro=.0025;function lo({composerController:t,composerType:s,renderInComposer:o,composerRightButtonType:a,layoutMode:n}){const i=Ue(t.store,b=>b.controlsDisabled),r=Tt(),{isUnauthenticated:c}=_e(),l=s==="vanguard"&&r&&!c,p=od(b=>{b.contentRect&&t.setWaveWidth(b.contentRect.width)}),d=m.useCallback(b=>{if(!(t instanceof Ms))return;const S=t.getSelectionStart();t.setControlsDisabled(!1),requestAnimationFrame(()=>{const{state:C,dispatch:k}=t.view;k(C.tr.insertText(b,S,S)),requestAnimationFrame(()=>{t.setSelection(S+b.length)}),t.usedDictation=!0})},[t]),f=()=>{t.setControlsDisabled(!0)},u=e.jsx(oa,{size:"small",onExit:f,buttonClassName:s==="vanguard"?"h-7 min-h-7 w-7 min-w-7":"h-9 min-h-9 w-9 min-w-9",invertColor:l,disableTooltip:l}),x=b=>{b.preventDefault(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{t.focus()})})};let h;if(l)if(a===ad.SPEECH){const b=rp.getBooleanCookie(lp.LastVoiceInteraction)??!1,S=C=>b?e.jsx(e.Fragment,{children:o?.(l,C)}):e.jsx(oa,{...C,size:"small",onExit:f,buttonClassName:s==="vanguard"?"h-7 min-h-7 w-7 min-w-7":"h-9 min-h-9 w-9 min-w-9",invertColor:!0,disableTooltip:!0});h=e.jsx(rd,{layoutMode:n??"centered",onDictationExit:f,renderVoiceButton:S,restoreFocus:x})}else h=e.jsx(e.Fragment,{children:o?.()});else h=e.jsxs(e.Fragment,{children:[u,o?.()]});return{whisperControls:i?e.jsx(id,{initialValue:ro,onSuccess:d,onWaveformDataUpdate:t.setWaveformData,onExit:()=>{t.setControlsDisabled(!1)},buttonClassName:s==="vanguard"?"h-7 min-h-7 w-7 min-w-7":"h-9 min-h-9 w-9 min-w-9"}):h,waveContainerRef:p,handleTranscriptionSuccess:d}}const sr=({composerController:t,placeholder:s,vanguard:o})=>{const a=m.useRef(null),n=m.useRef(null),{isMobileOS:i}=ld(),r=m.useRef(!1);return m.useEffect(()=>{if(r.current)return;if(!(t instanceof Ms))throw new Error(`Expected instance of ProseMirrorComposerController but got ${t.constructor.name}`);r.current=!0;const c=n.current;if(c!=null){const{value:l,selectionStart:p,selectionEnd:d}=c;t.view.dispatch(t.view.state.tr.insertText(l)),t.view.dispatch(t.view.state.tr.setSelection(Dp.create(t.view.state.doc,p+1,d+1))),c.style.display="none",c.value=""}a.current.appendChild(t.view.dom),t.view.dom.id=cd,t.view.dom.dataset.virtualkeyboard="true",ud(t.view.dom),!si()&&!cp()&&requestAnimationFrame(()=>{t.view.focus()})},[t]),m.useEffect(()=>{t.setPlaceholder(s)},[s,t]),m.useEffect(()=>{t.logPageMount()},[]),e.jsxs("div",{ref:a,onKeyDown:dd.prefetch,className:F([md["prosemirror-parent"],"text-token-text-primary","max-h-[25dvh]","max-h-52","overflow-auto [scrollbar-width:thin]",up()?"firefox":"default-browser"],o&&"min-h-12 pe-3"),children:[e.jsx("textarea",{className:F("text-token-text-primary placeholder:text-token-text-tertiary block h-10 w-full resize-none border-0 bg-transparent px-0 py-2 ring-0 placeholder:ps-px"),autoFocus:!i,placeholder:s,ref:n,"data-virtualkeyboard":!0}),e.jsx(pd,{scriptSrc:"window.__oai_logHTML?window.__oai_logHTML():window.__oai_SSR_HTML=window.__oai_SSR_HTML||Date.now();requestAnimationFrame((function(){window.__oai_logTTI?window.__oai_logTTI():window.__oai_SSR_TTI=window.__oai_SSR_TTI||Date.now()}))"})]})},pg=m.forwardRef(function({type:s,placeholder:o,replyRegions:a,state:n,renderFiles:i,leftSideActions:r,topRightAction:c,onSubmit:l,setIsComposerOverflowing:p,inputState:d,composerController:f,clientThreadId:u,gizmoId:x,disableReason:h,matchaData:g},b){const S=fd();let C=null;const{isLoading:k}=S;k||(C=S.modelId),m.useEffect(()=>{k||si()||f.focus()},[C,f,k]);const{value:N}=ae("3780975974"),{state:w,shouldShowResearchText:_}=Os(u),D=m.useCallback(()=>e.jsx(ni,{useStartButtonText:w==="clarify"||!1,inputState:d,state:n,onSubmit:l,composerController:f,clientThreadId:u,gizmoId:x,disableReason:h}),[d,n,l,f,u,x,h,g,w]),{whisperControls:R,waveContainerRef:B}=lo({composerController:f,renderInComposer:D,composerType:"legacy"}),{controlsDisabled:M,waveformData:v,waveWidth:W}=Ue(f.store),{getShowUpsellReason:G}=oi(),P=N||G(),j=U=>{fg({target:U.target,rootId:"composer-background",additonalInteractiveIds:["reply-regions"]})||f.focus()},V=io(),{isOpen:O}=Kt();return e.jsxs(ai,{id:"composer-background",ref:b,className:F("border-token-border-default flex w-full cursor-text flex-col overflow-clip rounded-t-3xl border-t duration-150 ease-in-out contain-inline-size motion-safe:transition-[color,background-color,border-color,text-decoration-color,fill,stroke,box-shadow,bottom] dark:border-none dark:shadow-none",s!=="temporary"&&"shadow-[0_9px_9px_0px_rgba(0,0,0,0.01),_0_2px_5px_0px_rgba(0,0,0,0.06)] has-focus:shadow-[0_2px_12px_0px_rgba(0,0,0,0.04),0_9px_9px_0px_rgba(0,0,0,0.01),0_2px_5px_0px_rgba(0,0,0,0.06)]",s!=="temporary"&&"bg-token-main-surface-primary dark:bg-[#303030]",s==="temporary"&&"dark bg-[#303030]","rounded-b-3xl border-b"),onClick:j,style:{viewTransitionName:"var(--vt-composer)"},children:[e.jsxs("div",{className:"px-3 py-1",children:[e.jsx(ke,{initial:!1,children:a.length>0&&e.jsx(Y.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0,transition:{duration:.06}},transition:{ease:"easeOut",duration:.1},id:"reply-regions",children:e.jsx("div",{className:"-mx-2",children:e.jsx(ii,{replyRegions:a})})})}),e.jsxs(e.Fragment,{children:[i,e.jsx(ke,{initial:!1,children:e.jsx(rg,{enabled:_,composerController:f,visualTreatment:"legacy",children:e.jsxs("div",{id:"composer-waveform-container",className:"flex min-h-[44px] items-start ps-1",ref:B,children:[e.jsx("div",{className:"max-w-full min-w-0 flex-1",children:M?v?e.jsx(ri,{waveform:v,containerWidth:W,scaleFactor:10,initialValue:ro}):null:e.jsx(sr,{composerController:f,placeholder:o})}),e.jsx("div",{className:"w-[32px] pt-1",children:c})]})})}),e.jsxs("div",{className:"mt-1 mb-2 flex items-center justify-between sm:mt-5",ref:U=>{if(!P||!("ResizeObserver"in window))return;let I=new AbortController,q=window.innerWidth;const ne=gn({axis:"width",debounce:!0,target:U,onChange:()=>{if(!U)return;U.scrollWidth>U.clientWidth?p?.(!0):Math.abs(q-window.innerWidth)>40&&(p?.(!1),q=window.innerWidth)}});return()=>{ne?.(),I.abort()}},children:[e.jsx("div",{className:"text-token-text-primary flex gap-x-1.5",id:"composer-left-actions",children:r}),e.jsx("div",{className:"flex gap-x-1.5",id:"composer-voice-controls",children:R})]})]})]}),e.jsx(ke,{children:V&&O&&e.jsx(tr,{clientThreadId:u})})]})});function fg({target:t,rootId:s,additonalInteractiveIds:o}){let a=t;for(;a&&a!=null;){if(a.tagName==="BUTTON"||a.tagName==="INPUT"||a.tagName==="TEXTAREA"||a.isContentEditable||o.includes(a.id))return!0;if(a.id===s)return!1;a=a.parentElement}return!1}const gg=["o3-mini","o3-mini-high","o1-pro"],hg=[T.Search,T.Research],xg=5,bg=({composerController:t,clientThreadId:s,hideThinkButton:o,disableIfNoAccess:a,disabled:n})=>{const{prospectiveModelId:i}=Qt(s),{systemHints:r,activeSystemHints:c,isLoading:l}=$n(s),p=ae("2868048419"),d=Ci(j=>j.bySystemHint(T.Research)),f=Qn(),u=Kn(),{value:x}=ae("1416952492"),h=fe(j=>j.isVisuallyOverflowing),{showLegacyReasoningSlider:g,hideSearchInSystemHintOverflow:b,hideReasonInSystemHintOverflow:S,configurationMenuType:C}=at(),k=nt()?.isFree(),N=C!=="none",w=c.filter(j=>N&&(k||j.systemHint!==T.Think)||b&&j.systemHint===T.Search||S&&j.systemHint===T.Think?!0:h&&g?j.systemHint!==T.Think&&!j.composerBarButtonInfo&&!hg.includes(j.systemHint):!j.composerBarButtonInfo&&j.systemHint!==T.Search&&(!p||j.systemHint!==T.PictureV2)&&(!o||j.systemHint!==T.Think));if(N&&k&&!w.find(j=>j.systemHint===T.Think)){const j=r.find(V=>V.systemHint===T.Think);j&&w.push(j)}const _=li(t),D=gd(t,s),{clearAllSystemHintModeTriggers:R}=ge(),B=i&&gg.includes(i),M=w.length===0&&!l||B;if(!a&&M)return null;const v={clientThreadId:s};function W(){A.logEventWithStatsig("Composer System Hint Button Hovered","composer_system_hint_button_hovered",v)}function G(){A.logEventWithStatsig("Composer System Hint Button Clicked","composer_system_hint_button_clicked",v)}const P=j=>{switch(j){case T.Research:return!!u;case T.Think:return!!f;default:return!1}};return e.jsx(Sg,{systemHints:w,selectedHint:_??void 0,disabled:n,onHover:W,onOpen:G,onSelect:D,clientThreadId:s,newToolsConfigMenu:N,isDeepResearchHighLoad:x,getFeatureRateLimitIndicator:j=>{switch(j){case T.Research:return Cg(d);case T.Think:return f?e.jsx(Tn,{"aria-label":"",className:"icon-md text-token-text-secondary h-5 w-5"}):null;default:return null}},hasFeatureRateLimit:P,setRateLimitBannerFeature:j=>{switch(j){case T.Research:case T.Think:P(j)?(R(),t.setRateLimitBannerFeature(j===T.Research?ba.DEEP_RESEARCH:ba.REASON)):t.setRateLimitBannerFeature(null);break;default:t.setRateLimitBannerFeature(null);break}}})},Sg=({systemHints:t,selectedHint:s,disabled:o,onHover:a,onOpen:n,onSelect:i,clientThreadId:r,newToolsConfigMenu:c,getFeatureRateLimitIndicator:l,isDeepResearchHighLoad:p,hasFeatureRateLimit:d,setRateLimitBannerFeature:f})=>{const u=Q(),[x,h]=m.useState(!1),g=t.find(S=>S.systemHint==="contextual_answers")?.name,b=t.length===0?e.jsxs("div",{className:"mx-2 flex min-h-[40px] flex-col justify-center gap-2",children:[e.jsx("div",{className:"loading-results-shimmer bg-token-main-surface-secondary h-9 w-full rounded-md"}),e.jsx("div",{className:"loading-results-shimmer bg-token-main-surface-secondary h-9 w-full rounded-md"})]}):e.jsxs(e.Fragment,{children:[c&&e.jsx(yg,{}),t.map(S=>e.jsx(Pe.Item,{className:"px-1 py-2",onClick:()=>{const C=S.systemHint!==s;d(S.systemHint)||i?.({hint:S,enable:C}),c&&(An(S.systemHint,S.systemHint===s?we.Disable:we.Enable,r),C&&f(S.systemHint))},disabled:S.systemHint===T.Research?p:void 0,children:c?e.jsx(Zf,{title:S.name,logo:S.logo,checked:S.systemHint===s,tool_uses_remaining:l(S.systemHint),is_high_load:S.systemHint===T.Research?p:void 0}):e.jsx(Xi,{title:S.name,description:S.description,logo:S.logo,checked:S.systemHint===s,badge:S.systemHint===T.PictureV2})},S.systemHint))]});return e.jsxs(Pe.Root,{open:x,onOpenChange:S=>{h(S),S&&n?.()},children:[e.jsx(vg,{disabled:!!o,contextualAnswersHintNameIfPresent:g,children:e.jsx(dp,{className:F(hd.toolsButton,"border-token-border-default text-token-text-secondary radix-state-open:bg-black/10 can-hover:hover:bg-token-main-surface-secondary flex h-9 min-w-9 items-center justify-center rounded-full border p-1 text-xs font-semibold focus-visible:outline-black disabled:opacity-30 dark:focus-visible:outline-white"),"data-opened":wg(x),"aria-label":u.formatMessage({id:"oDAnGy",defaultMessage:"Use a tool"}),disabled:o,onPointerOver:a,onClick:S=>{S.preventDefault()},onFocusCapture:S=>{S.stopPropagation()},children:c?e.jsx(ci,{className:"pointer-events-none h-5 w-5"}):e.jsx(xd,{className:"pointer-events-none h-5 w-5"})})}),e.jsx(Pe.Portal,{children:e.jsx(Pe.Content,{alignOffset:-16,onCloseAutoFocus:S=>{S.preventDefault()},side:c?"top":"bottom",children:b})})]})},vg=({disabled:t,children:s,contextualAnswersHintNameIfPresent:o})=>{const a=Ve(pe.hasSeenComposerSystemHintButtonTooltip),n=Ve(pe.hasSeenCaSystemHint),i=!t&&!a.isLoading&&a.eligible,r=!t&&!a.isLoading&&o&&!n.isLoading&&n.eligible,c=i?{announcementKey:pe.hasSeenComposerSystemHintButtonTooltip,title:e.jsx(H,{id:"tTydhk",defaultMessage:"All your tools, in one handy place"}),onDismiss:a.markAsViewed,description:e.jsx(H,{id:"S+BFNe",defaultMessage:"Create a canvas, generate a picture, and more."})}:r?{announcementKey:pe.hasSeenCaSystemHint,title:e.jsx(H,{id:"uaC1JM",defaultMessage:"Not finding internal information?"}),onDismiss:n.markAsViewed,description:e.jsx(H,{id:"TL/S+W",defaultMessage:"If ChatGPT didn't search your files automatically, type {hintName} or select it from the menu.",values:{hintName:e.jsx("span",{className:"font-bold whitespace-nowrap",children:'"/'+o+'"'})}})}:void 0;return c?e.jsx(En,{show:!0,side:"bottom",theme:"bright",dismissOnOutsideClick:!0,badge:"new",sideOffset:0,className:"xs:max-w-sm! max-w-2xs!",...c,children:s}):e.jsx(xt,{side:"top",sideOffset:0,label:t?e.jsx(H,{id:"uw9x80",defaultMessage:"Tools unavailable"}):e.jsx(H,{id:"mrYNGk",defaultMessage:"View tools"}),children:s})};function yg(){return e.jsx("div",{className:"text-token-text-secondary mx-5 py-2 text-sm",children:e.jsx(H,{id:"m/042P",defaultMessage:"Skills"})})}function wg(t){return t?"":null}function Cg(t){return!t||t.remaining>xg?null:t.remaining===0?e.jsx(Tn,{"aria-label":"",className:"icon-md text-token-text-secondary h-5 w-5"}):e.jsx(H,{id:"m6JsYD",defaultMessage:"{remaining} left",values:{remaining:t.remaining}})}const kg=({clientThreadId:t})=>{const{setThreadSystemHintMode:s}=ge(),o=window.location.search;m.useEffect(()=>{if(new URLSearchParams(window.location.search).get("enable-internal-knowledge")==="true"&&document){s(T.ContextualAnswers,!0,{clientThreadId:t});const n=new URLSearchParams(window.location.search);n.delete("enable-internal-knowledge");const i=n.toString();window.history.replaceState({},document.title,`${window.location.pathname}${i?`?${i}`:""}`)}},[o,t,s])},jg=({connectionStatuses:t,clientThreadId:s})=>{const{eligible:o,markAsViewed:a}=Ve(pe.hasSeenContextualAnswerGoogleSyncFinished),n=Q(),{setThreadSystemHintMode:i}=ge(),r=wd(t),c=Cd({exposed:r&&o})==="notification",l=m.useRef(!1);m.useEffect(()=>{o&&c&&r&&!l.current&&(A.logEvent("Contextual Answers User Fully Synced Notification"),kd({id:"contextual-answers-sync-done",title:e.jsxs("span",{className:"flex items-center justify-between",children:[n.formatMessage({id:"GkdUMV",defaultMessage:"Google Drive is ready to search"}),e.jsx(Ni,{className:"icon-md text-black"})]}),subtitle:e.jsx(Rt,{className:"text-caption-regular mt-1 rounded-xs",color:"secondary",size:"xs",children:e.jsx(H,{id:"Y8PQkV",defaultMessage:"Try now"})}),clientThreadId:"WEB:",icon:ti,onClick:()=>{i(T.ContextualAnswers,!0,{clientThreadId:s})},timeout:60*1e3}),l.current=!0,a())},[c,s,o,r,n,a,i])},_g=({composerController:t,systemHint:s,clientThreadId:o,connectionStatuses:a})=>{const n=Tt(),i=s.systemHint,r=Nt(i);if(jg({connectionStatuses:a,clientThreadId:o}),kg({clientThreadId:o}),!s.composerBarButtonInfo)return null;const c=a.some(l=>l.user_connection_details.activation_status==="partially_activated"||l.user_connection_details.activation_status==="activated");return e.jsx($p,{composerController:t,systemHint:s,composerBarButtonInfo:s.composerBarButtonInfo,clientThreadId:o,isDisabled:!1,showLabel:n,dropdownContent:c?void 0:e.jsx(_a,{}),splitButtonDropdownContent:c&&r?e.jsx(_a,{}):void 0,dataTestid:bd,tooltipPosition:"top",disableNuxMarkdown:!0})},_a=()=>{const{connectionInstanceData:t,isLoading:s}=ui(),o=m.useMemo(()=>[...t?.connection_statuses??[]].sort(Sd),[t]),a=o.some(n=>n.user_connection_details.activation_status==="activating"||n.user_connection_details.activation_status==="partially_activated"||n.user_connection_details.activation_status==="inactive"&&n.user_connection_details.auth_status==="user_connected");return m.useEffect(()=>{A.logEventWithStatsig("Contextual Answers User Composer Dropdown Shown","chatgpt_contextual_answers_user_composer_dropdown_shown")},[]),s?e.jsx("div",{className:"w-full max-w-[calc(100vw-1.5rem)] min-w-[calc(100vw-1.5rem)] p-3 md:min-w-[22rem]",children:e.jsx(Op,{lines:4,size:"lg"})}):e.jsx(ke,{children:e.jsxs("div",{className:"w-full max-w-[calc(100vw-1.5rem)] min-w-[calc(100vw-1.5rem)] px-1 py-3 md:min-w-[22rem]",children:[o.map(n=>e.jsx(Sn,{className:F(n.user_connection_details.activation_status==="activating"?"grayscale":void 0,"cursor-default"),onClick:i=>{i.stopPropagation()},children:e.jsx(vd,{title:n.connection_display_info.display_name,icon:e.jsx("img",{src:n.connection_display_info.icon_url??"",alt:n.connection_display_info.display_name,className:"icon-lg"}),statusIndicator:e.jsx(yd,{connection:n,location:"user_dropdown"})})},n.user_connection_details.connection_instance_id)),e.jsx(Sn,{onClick:n=>{window.location.hash="#settings/ConnectorSettings",n.stopPropagation()},children:e.jsxs("div",{className:"flex w-full flex-row items-center justify-start gap-4 text-start",children:[e.jsx("div",{className:"icon-lg",children:e.jsx(qa,{})}),e.jsx("p",{className:"text-token-text-primary flex-1 text-sm font-medium",children:a?e.jsx(H,{id:"EqgQdy",defaultMessage:"See syncing state"}):e.jsx(H,{id:"05N3nu",defaultMessage:"Manage connectors"})})]})})]})})};function Rg({systemHints:t,composerController:s,clientThreadId:o}){const{configurationMenuType:a}=at(),n=li(s),i=t.find(({systemHint:l})=>l===n),{isUnauthenticated:r}=_e(),{setThreadSystemHintMode:c}=ge();return m.useEffect(()=>{a!=="none"&&n&&!t.some(({systemHint:l})=>l===n)&&!r&&c(n,!1,{clientThreadId:o})},[o,c,n,t,r,a]),i?e.jsx("div",{"data-testid":"active-system-hint-pill",style:{viewTransitionName:`var(--vt-composer-${i.systemHint}-action)`},children:e.jsx(Ag,{activeSystemHint:i,onClick:()=>{c(i.systemHint,!1,{clientThreadId:o})}})},"active-hint-tag"):null}function Ag({activeSystemHint:t,onClick:s}){const o=Q();return e.jsxs(zi,{as:"div",role:"button",onClick:s,tabIndex:0,spacing:"compact",isSelected:!0,isLegacyStyle:!0,borderVisible:!0,children:[e.jsx(Jt,{svgString:t.logo,className:"icon-md text-token-interactive-label-accent-default flex-1","aria-label":""}),e.jsx("span",{children:t.name}),e.jsx(di,{"data-remove-think-button":!0,className:"-me-1","aria-label":o.formatMessage({id:"HW9RTL",defaultMessage:"Disable {systemHintName}"},{systemHintName:t.name})})]})}const Ra=48,Aa=32,Mg="/c/:conversationId",Pg=({isNewThread:t,clientThreadId:s,isTemporaryChat:o,placeholder:a,composerController:n,children:i,isExpandedByDefault:r=!1,onSubmit:c})=>{let l=null,p=null,d=[],f=[],u=null,x=[],h=null;m.Children.forEach(i,E=>{if(m.isValidElement(E))if(E.type===Bg){if(u!=null)throw new Error("PromptTextareaComposer only accepts a single app stack");u=E}else if(E.type===nr){if(l!=null)throw new Error("PromptTextareaComposer only accepts a single submit button");l=E}else if(E.type===Ig){if(p!=null)throw new Error("PromptTextareaComposer only accepts a single header action");p=E}else E.type===ar||E.type===or?d.push(E):E.type===ir?f.push(E):E.type===kn?x.push(E):E.type===rr&&(h=E)});const{shouldShowResearchText:g}=Os(s),b=Nt(T.ContextualAnswers)&&!!t,S=jd(),C=mi({exposed:b})==="bigbox",k=S&&g||C&&b,N=m.useRef(null),w=m.useRef(null),{waveContainerRef:_}=lo({composerController:n,composerType:"vanguard"}),{controlsDisabled:D,waveformData:R,waveWidth:B}=Ue(n.store),M=fe(E=>E.isExpanded),v=fe(E=>E.setIsExpanded),W=m.useRef(!1),G=qe(),P=m.useSyncExternalStore(E=>{const J=n.subscribe("focus",E),re=n.subscribe("blur",E);return()=>{re(),J()}},()=>n.isFocused(),()=>!1),j=E=>{if(E.target instanceof HTMLElement){if(E.target.dataset.historyItemLink||E.target.parentElement?.dataset.historyItemLink)return!0;const J=E.target?.closest("a[href]");if(J instanceof HTMLAnchorElement)return!!hl({path:Mg,end:!1},new URL(J.href).pathname)}return!1};m.useEffect(()=>{if(!W.current)return n.subscribe("input",()=>{W.current=!0})},[n]),m.useEffect(()=>{r&&v(!0),P&&!M&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{v(!0)})})},[P,M,r,v]);const V=fe(E=>E.isVisuallyOverflowing),O=m.useRef(V);Rs(()=>{O.current=V},[V]);const U=fe(E=>E.setIsVisuallyOverflowing),I=m.useRef(null),q=E=>{const J=re=>{r||W.current||E?.contains(re.target)||j(re)||v(!1)};return document.addEventListener("click",J),I.current=E,()=>{document.removeEventListener("click",J)}},ne=E=>{E.preventDefault(),c(E)},ue=d.length>0,ie=f.length>0,[$e,it]=m.useState(0),Re=24,{showLegacyReasoningSlider:xe}=at();return e.jsxs("form",{ref:q,className:"w-full [view-transition-name:var(--vt-composer)]",onSubmit:ne,"data-type":"unified-composer",children:[e.jsxs(Tg,{isTemporaryChat:o,clientThreadId:s,children:[e.jsxs(Y.div,{transition:G?oe:xs,className:"relative flex w-full flex-auto flex-col",children:[x.length>0&&e.jsx("div",{className:"mb-4 flex flex-col gap-2",children:x}),e.jsxs("div",{className:"relative ms-1.5 grid grid-cols-[auto_minmax(0,1fr)]",children:[e.jsx("div",{className:"items-top flex justify-center",children:e.jsx(Y.div,{initial:{opacity:M?1:0},animate:{opacity:M?1:0},exit:{opacity:0},transition:G?oe:gt,children:p})}),e.jsx(Y.div,{initial:{marginBottom:-20,translateX:M?0:Aa},onPointerDown:E=>E.stopPropagation(),animate:{translateX:M?0:Aa},style:{translateY:-7},transition:G?oe:xs,className:"relative flex-auto bg-transparent pt-0.5",children:e.jsxs(Eg,{composerController:n,enabled:k,children:[e.jsx("div",{className:"flex min-h-12 items-start",ref:_,children:e.jsx("div",{className:"max-w-full min-w-0 flex-1",children:D?R?e.jsx(ri,{waveform:R,containerWidth:B,scaleFactor:10,initialValue:ro}):null:e.jsx(sr,{composerController:n,placeholder:a,vanguard:!0})})}),S&&g?e.jsx(er,{composerController:n,visualTreatment:"vanguard"}):C&&b?e.jsx(_d,{composerController:n,visualTreatment:"vanguard"}):null]})})]}),e.jsx("div",{className:"justify-content-end relative ms-2 flex w-full flex-auto flex-col",children:e.jsx("div",{className:"flex-auto"})}),e.jsx(Y.div,{initial:{height:M&&ue?Ra:0},animate:{height:M&&ue?Ra:0},transition:G?oe:xs})]}),(ue||!!l)&&e.jsx("div",{className:F("bg-primary-surface-primary absolute start-3 end-0 bottom-3 z-2 flex items-center"),children:e.jsxs("div",{className:"w-full",children:[ue&&M&&e.jsx("div",{"data-testid":"composer-footer-actions",className:F("max-xs:gap-1 flex items-center gap-2 overflow-x-auto [scrollbar-width:none]",!xe&&V&&"[--force-hide-label:none]"),ref:E=>gn({debounce:!0,target:E,axis:"width",onChange:({width:J})=>{E&&(O.current?O.current&&N.current!==null&&J>=N.current&&U(!1):w.current!==null&&J<w.current?U(!0):(N.current=E.scrollWidth,U(E.scrollWidth>E.clientWidth)))}}),style:{marginRight:`${$e+Re}px`},children:d}),e.jsxs("div",{className:"absolute end-3 bottom-0 flex items-center gap-2","data-testid":"composer-trailing-actions",ref:E=>gn({target:E,axis:"width",onChange:({width:J})=>{it(J)}}),children:[ie&&e.jsx("div",{className:"relative ms-1",children:f}),l]})]})}),e.jsx("div",{className:"absolute start-4 top-3 ms-[1px] flex items-center pb-px",children:e.jsx(ke,{children:!M&&u})})]}),e.jsxs(Is,{open:!!h,children:[e.jsx(qn,{className:"w-full"}),e.jsx(Ns,{children:e.jsx(Bs,{side:"bottom",align:"start",sideOffset:12,onOpenAutoFocus:E=>E.preventDefault(),children:h})})]})]})};function Eg({composerController:t,children:s,enabled:o}){const a=qe();return e.jsx(Y.div,{initial:{minHeight:0},animate:{minHeight:o?"142px":0},exit:{minHeight:0},transition:a?oe:Pt,className:"flex flex-col justify-start",onClick:n=>{t.isFocused()?n.preventDefault():t.focus()},children:s})}function Tg({children:t,isTemporaryChat:s,clientThreadId:o}){const a=io(),{isOpen:n}=Kt();return e.jsxs(ai,{className:F("border-token-border-default flex w-full cursor-text flex-col items-center justify-center rounded-[28px] border bg-clip-padding contain-inline-size","overflow-clip shadow-sm sm:shadow-lg dark:shadow-none!",s?"dark bg-[#303030]":"bg-token-main-surface-primary dark:bg-[#303030]"),children:[e.jsx("div",{className:"relative flex w-full items-end px-3 py-3",children:t}),e.jsx(Ng,{children:a&&n?e.jsx(tr,{clientThreadId:o,isVanguard:!0}):null})]})}const Ng=({children:t})=>{const s=qe(),n={initial:{opacity:0,height:0,y:"-28px"},animate:{opacity:1,y:0,height:"56px",transition:s?oe:{opacity:{delay:.2},default:Pt}},exit:{opacity:0,y:"-28px",height:0,transition:s?oe:{opacity:{delay:0},default:Pt}}};return e.jsx(ke,{children:t&&e.jsx(Y.div,{variants:n,initial:"initial",animate:"animate",exit:"exit",className:"relative w-full",children:t})})},Bg=({children:t})=>e.jsx(Y.div,{onPointerDown:s=>{s.stopPropagation(),s.preventDefault()},children:t}),nr=({children:t})=>e.jsx("div",{className:"ms-auto flex items-center gap-1.5",onPointerDown:s=>s.stopPropagation(),children:t}),or=({children:t})=>t?e.jsx(e.Fragment,{children:t}):null,ar=({children:t})=>e.jsx("div",{onPointerDown:s=>s.stopPropagation(),children:t}),ir=({children:t})=>e.jsx("div",{onPointerDown:s=>s.stopPropagation(),children:t}),rr=({children:t})=>e.jsx("div",{onPointerDown:s=>s.stopPropagation(),children:t}),Ig=({children:t})=>e.jsx("div",{onPointerDown:s=>s.stopPropagation(),children:t}),kn=({children:t,width:s="full"})=>e.jsx("div",{className:F(s==="fit"?"w-fit":"w-full"),onPointerDown:o=>o.stopPropagation(),children:t});function Dg({clientThreadId:t,uploadType:s,modelAcceptedMimeTypes:o,modelSupportedImageMimeTypes:a,attachmentsProductFeature:n,getInputProps:i,openFileDialog:r,onOauthRedirect:c,historyDisabled:l,isDisabled:p,highlightTooltip:d,disabledReason:f,currentModelName:u,showLabel:x,showUpsell:h,hideBorder:g,isSmall:b,visualTreatment:S,layoutMode:C,restoreFocus:k}){const N=Wn(),{gdriveStatus:w,o365Status:_}=Za(),D="h-[20px] w-[20px]",R=l?"text-white":d?"text-brand-blue-800":"",B=h?e.jsx(js,{"aria-label":"",className:F(D,R)}):e.jsx(js,{"aria-label":"",className:F(D,R)}),M=(w!=="false"||_!=="false"||N||S==="vanguard")&&!h,v=mp(),W=S==="vanguard"&&!v,G=M?e.jsx(Zi,{hideBorder:g,isSmall:b,clientThreadId:t,icon:B,modelAcceptedMimeTypes:o,modelSupportedImageMimeTypes:a,attachmentsProductFeature:n,onOauthRedirect:c,uploadType:s,openFileDialog:r,getInputProps:i,isDisabled:W?!1:p,highlightTooltip:d,disabledReason:f,currentModelName:u,visualTreatment:S,layoutMode:C,restoreFocus:k}):e.jsx(Yi,{isSmall:b,hideBorder:g,clientThreadId:t,uploadType:s,openFileDialog:r,getInputProps:i,showLabel:x,showUpsell:h,icon:B,isDisabled:p,highlightTooltip:d,disabledReason:f,currentModelName:u});return e.jsx("div",{className:"relative",children:e.jsx(Ji,{showBackground:d,className:"bg-brand-blue-800/20",children:G})})}const Og=({clientThreadId:t,currentModel:s,uploadType:o,modelSupportedImageMimeTypes:a,modelAcceptedMimeTypes:n,modelProductFeatures:i,getEditorGizmoId:r,onOauthRedirect:c,disabledReason:l,isTemporaryChat:p,isDisabled:d,highlightTooltip:f,showLabel:u,showUpsell:x,numRemainingFiles:h,visualTreatment:g,layoutMode:b,restoreFocus:S})=>{const C=Q(),k=It(),{handleFileAccepted:N}=ao(C,o,a,"mouse",r,i?.attachments),{getInputProps:w,open:_}=Hn({disabled:d,noClick:!0,onDropAccepted:N,onDropRejected:D=>oo(D,C,k,o),multiple:!0,maxSize:Un,maxFiles:h,...Ln(n)});return e.jsx(Dg,{isSmall:!0,hideBorder:!0,isDisabled:d,highlightTooltip:f,onOauthRedirect:c,visualTreatment:g,attachmentsProductFeature:i?.attachments,clientThreadId:t,uploadType:o,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:a,getInputProps:w,openFileDialog:_,historyDisabled:p,showLabel:u,showUpsell:x,disabledReason:l,currentModelName:s?.title??"",layoutMode:b,restoreFocus:S})},Lg=({activeSystemHint:t,showHints:s,showContextChevron:o,onRemoveHint:a,lockSystemHint:n})=>{const i=Q(),{popoverTriggerRef:r}=Bt(),c=()=>{requestAnimationFrame(()=>{r.current?.focus()})};if(t){const{logo:l,name:p}=t;return e.jsxs("div",{className:F("relative flex items-center justify-center",!n&&"-me-1"),children:[e.jsx(Jt,{className:"icon-md text-token-interactive-label-accent-default flex-1",svgString:l}),!n&&e.jsx(di,{"data-remove-hint-button":!0,onClick:d=>{d.stopPropagation(),d.preventDefault(),a(),c()},"aria-label":i.formatMessage({id:"YQ7uOV",defaultMessage:"Remove {tool} from selection"},{tool:p})}),o&&e.jsx(mg,{})]})}return s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-token-border-default ms-0.5 h-[16px] w-[1px]"}),e.jsx("div",{className:"text-token-text-tertiary hover:text-token-text-primary me-0.5 flex items-center",children:e.jsx(Ss,{className:"text-token-text-tertiary hover:text-token-text-primary pointer-events-auto! h-4 w-4"})})]}):e.jsx(ci,{"aria-label":i.formatMessage({id:"xosz07",defaultMessage:"View all tools"}),className:"text-token-text-secondary h-5 w-5"})},Fg={source:{id:"SystemHintCategory.Sources",defaultMessage:"Sources",description:"Label on system hint menu for hints that act as data sources"},tool:{id:"SystemHintCategory.Tools",defaultMessage:"Tools",description:"Label on system hint menu for hints that act as tools"}},Hg=({children:t,clientThreadId:s,layoutMode:o,lockSystemHint:a,composerController:n,onChangeSystemHint:i,systemHints:r,activeSystemHintType:c,recentSystemHintTypes:l,showHints:p,reasonItem:d=!1,gizmoId:f,isInReasonMode:u,type:x,...h})=>{const g=io(),b=qe(),S=Q(),C=r.find(({systemHint:O})=>c===O),k=nt(),N=l.map(O=>O===T.PictureV2&&!r.find(({systemHint:U})=>O===U)?r.find(({systemHint:U})=>U===T.Picture):r.find(({systemHint:U})=>O===U)).filter(O=>!!O),[w,_]=m.useState(null),D=(O,U)=>{U?_(O):i(O)},{selectedIndex:R,systemHintSuggestions:B,suggestorClosed:M,resetSelectedIndex:v}=Qi({composerController:n,clientThreadId:s,onHintSelected:i}),W=M?r:B,G=[],P=Ki(W);let j=0;for(const O of P){const U=O.systemHints;U.length!==0&&(G.push({...O.category?{message:Fg[O.category]}:{},systemHints:U,indexOffset:j}),j=U.length)}const V=()=>{n.setReasonMode(!u),u?A.logEventWithStatsig("Composer Think Button Disabled","composer_think_button_disabled",{clientThreadId:s}):A.logEventWithStatsig("Composer Think Button Enabled","composer_think_button_enabled",{clientThreadId:s})};return e.jsxs("div",{className:F("flex items-center rounded-full",p&&"me-1 border",c!==void 0?"border-transparent":x==="toolpile_icon"?"border-token-border-default":"border-token-border-xlight"),children:[!C&&p&&e.jsx(Rd,{onChangeSystemHint:D,systemHints:N}),e.jsxs(so,{layoutMode:o,forceOpen:!M,...h,children:[t?e.jsx(Wi,{children:t}):e.jsx(ff,{transition:b?oe:gt,shape:c?"rectangle":"round",spacing:"compact",isSelected:c!==void 0,"aria-label":S.formatMessage({id:"NLd5mV",defaultMessage:"Open tool menu"}),className:F(p&&"-mx-0.5",a&&"cursor-default!",x==="config_icon"&&"min-w-9",x==="toolpile_icon"&&"min-h-9"),onClick:O=>{if(a){O.stopPropagation(),O.preventDefault();return}},tooltipLabel:!c&&S.formatMessage({id:"xgQfBi",defaultMessage:"View all tools"}),disableHover:p&&!C||a,isLegacyStyle:x==="config_icon"||x==="toolpile_icon"&&!!c,borderVisible:x==="config_icon"||x==="toolpile_icon"&&!!c,children:e.jsx(Lg,{activeSystemHint:C,showHints:p,showContextChevron:g||!1,onRemoveHint:()=>i(null),lockSystemHint:a})}),e.jsx(no,{onMouseDown:O=>{O.preventDefault()},align:"end",children:e.jsx(Ad,{onChangeSystemHint:D,systemHintCategories:G,activeSystemHint:c,activeIndex:R,resetActiveIndex:v,reasonItem:d,gizmoId:f,clientThreadId:s,handleToggleReasonItem:V,isInReasonMode:u})})]}),!k||k.planType===pp.FREE&&e.jsx(Md,{open:!!w,onOpenChange:()=>_(null),systemHint:w})]})},Ma="gpt-4o",Ug=({clientThreadId:t,composerController:s,pendingFiles:o,isUploadDisabled:a,highlightUploadTooltip:n,hasFiles:i,conversationMode:r,placeholder:c,isTemporaryChat:l,layoutMode:p,state:d,inputState:f,disableReason:u,gizmoId:x,currentModel:h,replyRegions:g,uploadButtonDisabledReason:b,keepExpanded:S=!1,getEditorGizmoId:C,onOauthRedirect:k,onSubmit:N,visualTreatment:w,legacyFooterActions:_,legacySuggestionsPopoverContent:D,isNewThread:R=!1,isInReasonMode:B,modelSupportedSystemHints:M})=>{Zt();const[v,W]=aa(!1),{updateSystemHint:G}=ge(),{configurationMenuType:P}=at();Ds();const j=et.useState(({persistedSystemHints:$})=>$);Pd(t,w==="vanguard");const V=Array.from(j)[0],O=et.useState(({recentHints:$})=>$),{state:U}=Os(t),I=Mt(!1),q=fe($=>$.threads[t]?.modelSelection),ne=q?.type===Ce.SPECIFIC,ue=fe($=>$.setThreadModelSelection),ie=w==="vanguard"&&h?.id!==Ma&&!ne&&!v();pi(m.useCallback(()=>{ie&&(I({location:"PromptTextarea",modelId:Ma}),_t(t,ue,{type:Ce.EFFORT_MODE,effortMode:qt.low}))},[ie,I,t,ue]));const{setIsOpen:$e}=Kt(),it=$=>{W(!0),G($,{clientThreadId:t}),$===T.Research?$e(!0):$e(!1),$&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{s.focus()})})},Re=!1,xe=U==="clarify"||Re,E=m.useCallback(($,Ke)=>e.jsx(ni,{...Ke,isSmall:w==="vanguard",inputState:f,state:d,onSubmit:N,composerController:s,clientThreadId:t,gizmoId:x,disableReason:u,useStartButtonText:xe,disableTooltip:$}),[f,d,N,s,t,x,u,xe,w]),J=$=>{v()&&($.preventDefault(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{s.focus()})}))},re=Ed({inputState:f,state:d,composerController:s,clientThreadId:t,gizmoId:x}),{whisperControls:Te}=lo({composerController:s,renderInComposer:E,composerType:w,composerRightButtonType:re,layoutMode:p}),[Ne=null,Ye,le]=m.useMemo(()=>[Dn(h,r),On(h,r),Fn(h,r)],[h,r]);$n(t);const Be=et.useState(({availableHints:$})=>$),be=et.useState(({locked:$})=>$),Ie=m.useMemo(()=>q?.type===Ce.EFFORT_MODE?Td[q.effortMode]:"low",[q]),[rt,De]=aa(Ie);m.useEffect(()=>{De(Ie)},[Ie,De]),Ve(pe.ModelPickerMoved);const lt=Pn(x);U!=="disabled"||Re||(r?.kind,He.GizmoInteraction);const{pageType:te}=fi(),Oe=gi($=>$.selectedApps),bt=hi()&&Oe.length>0,Ae=i||bt,z=S||!!V||g&&g.length>0||Ae||Be.length<3;return ws(h,r,j),e.jsxs(Pg,{isNewThread:R,clientThreadId:t,isTemporaryChat:l,placeholder:c,visualTreatment:w,composerController:s,isExpandedByDefault:z,onSubmit:N,children:[g&&g.length>0&&e.jsx(kn,{width:"full",children:e.jsx(ii,{replyRegions:g})}),Ae&&e.jsx(kn,{width:"fit",children:e.jsx(hn,{files:o,selectedApps:Oe,className:"no-scrollbar -ms-1.5 flex flex-nowrap gap-2 overflow-x-auto p-1.5"})}),[_?.map(($,Ke)=>e.jsx(or,{children:$},`legacy-footer-action-${Ke}`))??[],(P!=="none"&&e.jsx(ar,{children:e.jsx(Rg,{clientThreadId:t,composerController:s,systemHints:M})},"active-hint-tag"))??[],e.jsx(rr,{children:D},"legacy-suggestions-popover")],w==="vanguard"&&e.jsx(ir,{children:e.jsx(Hg,{activeSystemHintType:V,lockSystemHint:te.type==="landing-page"||be,systemHints:Be,clientThreadId:t,composerController:s,onChangeSystemHint:it,layoutMode:p,recentSystemHintTypes:O,showHints:!R,isInReasonMode:B,restoreFocus:J})},"system-hint-popover"),e.jsx(nr,{children:Te})]})},Gg=Jn(()=>Zn(()=>import("./l13olfrtfbvjcwlk.js"),__vite__mapDeps([8,1,3,4,2,5,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29])).then(t=>t.ImageGenComposer)),zg=1,Wg=3e3,Vg=()=>null;function qg({onCreateNewCompletion:t,onContinueGenerating:s,account:o,currentModelId:a,currentModelConfig:n,disableDraftPersistence:i=!1,modelCategories:r,areModelsLoading:c,clientThreadId:l,isNewThread:p,isCompletionInProgress:d,className:f,disabled:u=!1,disabledReason:x,canPause:h=!1,canContinue:g=!1,isInteractableSharedThread:b,onComposerInput:S,onComposerChange:C,onAutocompleteSelect:k,headerClassName:N,hideHeader:w,onTaggingDropdownOpen:_,onTaggingDropdownClose:D,onlyAllowImageUploads:R}){ia.markStart("PromptTextarea"),ia.markRendered("PromptTextarea");const B=ot(),M=m.useRef(null),v=Et(),W=Wa(),G=fp(W.showUploadSuggestion$),P=Nd(),j=o?.isFree(),V=o?.isTeam(),{isUnauthenticated:O}=_e(),U=Q(),I=It(),q=Gn(),ne=Ds(),ue=Bd.useStore(),[ie,$e,it]=ce(l,y=>[Z.getCurrentLeafId(y),Z.getRequestId(y),Z.findNode(y,K=>!!K.message.metadata?.b1de6e2_s)]),[Re]=xl(),{gizmoEditorData:xe,mode:E,getGizmoId:J}=In(),re=gp(),Te=Tt(),Ne=hp(),Ye=Id(),le=Ti(l),Be=!!wi(),be=!!Qn(),Ie=Dd.useIsEnabled(l),rt=!!eo(),{setThreadSystemHintMode:De,clearAllSystemHintModeTriggers:lt}=ge(),te=Yt(),{state:Oe}=Os(l),bt=Nt(T.ContextualAnswers),Ae=te.has(T.Search),z=te.has(T.Think),$=Ve(pe.ModelPickerMoved),Ke=te.has(T.Research),{activeSystemHints:es}=$n(l),cr=es.length>0,co=es.find(y=>y.systemHint===T.ContextualAnswers),ur=Od(),{connectionInstanceData:Us,isLoading:dr}=ui({skip:!ur}),mr=mi({exposed:bt})==="bigbox",{selectedSources:uo}=ei(l),Gs=m.useRef(0),zs=m.useRef(!1),pr=r?.find(y=>y.defaultModel===a),fr=Vg();let X=Ts(l),Ws=X&&"gizmo"in X?X.gizmo:void 0;const gr=xp(),St=Ws?.gizmo.id??gr,Dt=Pn(St),hr=Ld(),mo=Fd(),[Se,ts]=m.useState(null);Se!==null&&(X={gizmo:Se,gizmo_id:Se.gizmo.id,kind:He.GizmoInteraction},Ws=Se);const Ot=ws(n,X,te),xr=Fs(),po=Ei(B).flags,ss=po?.includes(_s.NoAuthEnableFileUploads),{isUXUpdatesEnabled:Le,showLegacyReasoningSlider:ct,showReasoningSliderNux:br,reasoningSliderType:Sr,hideReasonInSystemHintOverflow:vr,hideSearchInSystemHintOverflow:yr,configurationMenuType:wr}=at(),Cr=Le&&te.size===0,ns=fe(y=>y.setThreadModelSelection),fo=fe(y=>y.threads[l]?.modelSelection),go=fo?.type===Ce.EFFORT_MODE?fo.effortMode:null,Vs=Le,ho=!Vs&&!!go&&go!==qt.low;pi(m.useCallback(()=>{ho&&_t(l,ns,{type:Ce.EFFORT_MODE,effortMode:qt.low})},[ho,l,ns])),Yf({serverThreadId:le,clientThreadId:l,composerController:v,getIsDisabled:m.useCallback(()=>!!Vs,[Vs]),onReset:()=>{_t(l,ns,{type:Ce.EFFORT_MODE,effortMode:qt.low})},onInfer:y=>{_t(l,ns,{type:Ce.EFFORT_MODE,effortMode:y})},isInferEnabledForModel:n?.enableInfer});const{prospectiveModelId:xo}=Qt(l),kr=j||c&&xo&&!gm.includes(xo),bo=!u&&(Ot!==mt.None||Cr||kr)&&(!O||ss),Qe=On(n,X),qs=Fn(n,X);let de=fn(y=>y.files);const[os]=m.useState(()=>Hd());E==="magic"?de=de.filter(y=>y.gizmoId!=null):de=de.filter(y=>y.gizmoId==null);const So=Ud(),Xe=de.length>0||So,vo=fn(Gd.hasUploadInProgress),$s=gi(y=>y.selectedApps),yo=hi()&&$s.length>0,jr=Xe||yo,_r=zd(l),Ys=v.useState(y=>{const K=Wd(y);return typeof n?.maxTokens=="number"&&K>n.maxTokens}),wo=v.useState(y=>!y.isEmpty()),as=!Ys&&!vo&&(wo||Xe),Co=(Ot===mt.Multimodal?Nn:Bn)-de.length,ko=Co<=0,Rr=Vd(),Ar=ae("3544641259")?.value,{selectedRepos:Ks}=Vn(l),jo=Rr&&Ar&&uo?.size===0,vt=as&&!u&&!rt&&(!d||mo)&&!jo,[_o,Mr]=m.useState(!1),{value:Pr}=ae("3780975974"),{targetedContent:Ro,setTargetedContent:is}=qd(),Me=Ro?.isFocusedViewContent&&!Ye?void 0:Ro;m.useEffect(()=>{requestAnimationFrame(()=>requestAnimationFrame(()=>v.focus()))},[Me]);const Ao=X==null||X?.kind===He.PrimaryAssistant||X?.kind===He.GizmoInteraction&&Dt,{getUpsellLabelType:Er,getUpsellShowsAttach:Tr,getShowUpsellReason:Nr}=oi(),Qs=cr&&Ao,[Br,Ir]=m.useState(!1),Dr=!O&&Ao&&(!V||!dr),yt=Ue(v.store,y=>y.controlsDisabled);m.useEffect(()=>{if(!P?.id)return;const y=ra.getAndReset(P.id,le);y&&v.setText(y.inputText)},[P?.id,le,v]),m.useEffect(()=>{const y=Re.get("prompt")??"";v.getCurrentText().length===0&&y.length>0&&v.setText(y)},[v,Re]),m.useEffect(()=>{_o!==vt&&(Mr(vt),vt&&bp(!0).then(y=>{$d.startEnforcement(y),Sp.startEnforcement(y)}))},[vt,_o,X?.kind,re]);const rs=Dn(n,X),{handleFileAccepted:Or}=ao(U,ws(n,X,te),Qe,"mouse",J,rs?.attachments),{getInputProps:Lr,open:Xs,inputRef:Mo}=Hn({disabled:u||!bo||ko,noClick:!0,onDropAccepted:Or,onDropRejected:y=>oo(y,U,I,Ot),multiple:!0,maxSize:Un,maxFiles:Co,...Ln(O||R?Qe:qs)}),Po=Ue(os),Eo=m.useCallback(()=>{v.eraseContent(),Po.clearMessages(),v.resize(zg),v.usedDictation=!1;for(const y of de)bs.remove(q,y.tempId,"none");Yd.markAllAsSent()},[v,Po,de,q]),Js=Ue(v.store,y=>y.isInReasonMode),To=async(y,K)=>{if(y.preventDefault(),u||!as&&!K||!X)return;const he=v.getContentToSend(),ve=bm(he.content),ut=fa(Js,v,te),{content:rn,attachments:ln}=Sm(q,ve,n,X,te);hr(),t({sourceEvent:y,attachments:ln,content:rn,contentToSend:he,conversationMode:X,hasSelectedApps:yo,isMessageFollowupsEnabled:Ie,selectedApps:$s,selectedGizmoTag:Se,selectedRepos:{selectedAllRepos:Ks.selectedAllRepos,selectedRepos:Ks.selectedRepos?[...Ks.selectedRepos]:null},selectedSources:uo,systemHints:ut,usedDictation:v.usedDictation}),Me?.onCreateCompletion?.({serverThreadId:le,currentLeafId:ie}),Me?.shouldPersistAcrossMessages!==!0&&is(void 0),ua.hideThreadHeader();for(const Ut of de)Ut.status===vm.Ready&&ue.addFile(Ut);Eo();const ml=es.some(Ut=>Ut.persistBetweenMessages&&te.has(Ut.systemHint));Le&&!Ke&&!Ae&&!ml&&lt()},Fr=y=>{is(y.targetedReply),y.targetedReply&&A.logEventWithStatsig("Targeted Reply Button Clicked","chatgpt_targeted_reply_button_clicked",{conversationId:le,sourceMessageId:y.messageId})},No=m.useCallback(()=>{Me?.onCleared?.({serverThreadId:le,currentLeafId:ie}),is(void 0),v.focus()},[ie,le,Me,is,v]),Bo={Enter:{validator:y=>{const K=y.isComposing||y.keyCode===229;return!(cs&&zs.current)&&(y.metaKey||(Te||kp||!1)&&!y.shiftKey&&!K)},handler:y=>{if(!vt){Ys&&I.danger("The message you submitted was too long, please submit something shorter.",{hasCloseButton:!0});return}y.preventDefault(),To(y)}},Escape:{validator:y=>!y.isComposing,handler:y=>{h&&d&&(la(l),A.logEventWithStatsig("Pause Completion","chatgpt_pause_completion",{threadId:zt(l),currentLeafId:Z.getCurrentNode(We(l)).message.id,eventSource:"keyboard"})),y.target.value===""&&No()}}},Lt=m.useRef(Bo);Lt.current=Bo;const ls=Kd(n?.tags,X?.kind),{showTaggingDropdown:Zs,isFocused:Hr,autocompletions:Je,matchaData:Ur}=Ue(v.store),cs=Hr&&Je.length>0,wt=ls&&Zs&&!Dt,Io=v.isReady();m.useEffect(()=>v.subscribe("keydown",y=>{v.acceptLegacyKeydown()&&Lt.current[y.key].validator(y)&&Lt.current[y.key].handler(y);const he=v.getCurrentText();if(y.key==="@"){const ve=v.getSelectionStart(),ut=he.substring(0,ve);(!ut||/\s$/.test(ut)||ve===0)&&setTimeout(()=>v.setShowTaggingDropdown(!0),10)}else Zs&&v.setShowTaggingDropdown(!1);y.key==="Escape"&&(ts(null),v.setAutocompletions([])),Ae&&y.key==="Escape"&&De(T.Search,!1,{clientThreadId:l})}),[v,Io,Zs,te,Ae,De,l]),m.useEffect(()=>{const y=Object.fromEntries(Object.keys(Lt.current).map(K=>[K,ve=>{const ut=Lt.current[K];if(!ut||v.acceptLegacyKeydown())return!1;const{validator:rn,handler:ln}=ut;return rn(ve)?(ln(ve),!0):!1}]));v.registerKeyHandlers(y),v.registerFileInput({openFileDialog:Xs,inputRef:Mo})},[v,Xs,Mo,Io]),m.useEffect(()=>v.subscribe("paste",y=>{Qd({filePickerStore:q,event:y,intl:U,toaster:I,clientThreadId:l,conversationMode:X,currentModelConfig:n,getEditorGizmoId:J,modelSupportedImageMimeTypes:Qe,persistedSystemHints:te})}),[U,l,X,n,J,Qe,v,I,q,te]);const Do=y=>{Be||ts(y),v.trimLeadingText("@"),pn(),v.setShowTaggingDropdown(!1)},Gr=Xd(l,os,Qe,rs?.attachments),zr=m.useCallback(y=>{y.preventDefault(),la(l),A.logEventWithStatsig("Pause Completion","chatgpt_pause_completion",{threadId:zt(l),currentLeafId:Z.getCurrentNode(We(l)).message.id,eventSource:"mouse"}),pn()},[l]),us=m.useCallback(()=>{ra.set(P?.id,le,v.getCurrentText())},[le,P?.id,v]);m.useEffect(()=>{xe||Jd()||v.focus()},[v]),m.useEffect(()=>{if(Qe.length>0)for(const K of de)Zd(K.fileSpec?.mimeType,qs)||bs.remove(q,K.tempId,"none");else bs.reset(q)},[a,q]),m.useEffect(()=>{(!ls&&Se||Be)&&ts(null)},[ls,Se,Be]),m.useEffect(()=>{be&&v.setReasonMode(!1)},[be,v]);const{layer:Wr}=st("4031588851"),{layer:Oo}=st("3637408529"),Vr=Oo.get("is_in_composer_text_exp",!1),qr=Oo.get("composer_text","MESSAGE_CHATGPT"),$r=Wr.get("composer_text","MESSAGE_CHATGPT"),Yr=Vr?qr:$r,[ds,Kr]=(()=>{switch(x){case"workspaceDisallowsGizmo":return[se.disallowedByWorkspacePlaceholder,!0];case"noModelsAvailable":return[se.noModelsAvailablePlaceholder,!0];case"requiresPluginsToBeInstalled":return[se.requiresPluginsToBeInstalled,!0];case"loadingPlugins":return[se.loading,!0];case"noTestGizmoId":return[se.noTestGizmoId,!0];default:{if(b)return[se.placeholderWithName,!1];if(Me?.placeholderTextOverride!=null)return[Me.placeholderTextOverride,!1];if(Oe==="initial"||Oe==="recurrent")return[se.deepResearchPlaceholder,!1];if(Oe==="clarify")return[se.researchSuggestionInitial,!1];if(bt)return p&&mr?[ca.caSuggestionPlaceholder,!1]:[ca.caSuggestionInitial,!1];switch(Yr){case"BLANK":return[null,!1];case"ASK_ANYTHING":return[se.placeholderAskAnythingVariant,!1];case"ASK_CHATGPT_ANYTHING":return[se.placeholderAskNameAnythingVariant,!1];default:return[se.placeholderWithName,!1]}}}})(),en=Dt?p?U.formatMessage(em.newChatInProject):ds?U.formatMessage(ds,{name:"ChatGPT"}):"​":ds?U.formatMessage(ds,{name:xe!=null?E==="magic"?tm:xe.name||"GPT":Ws?.gizmo.display.name??"ChatGPT"}):"​";m.useEffect(()=>v.subscribe("input",()=>{sm.getState().isThreadHeaderVisible&&ua.hideThreadHeader()}),[v]),m.useEffect(()=>v.subscribe("input",()=>{Gs.current=performance.now(),S?.()}),[v,S]),m.useEffect(()=>{if(C)return v.subscribe("change",()=>{C()})},[v,C]);const Qr=Pr||Nr(),Lo=nm()&&!!Je.find(y=>!!y.requires_file_upload),Xr={clientThreadId:l,uploadType:Ot,modelAcceptedMimeTypes:qs,modelSupportedImageMimeTypes:Qe,attachmentsProductFeature:rs?.attachments,getInputProps:Lr,openFileDialog:Xs,historyDisabled:Ne,onOauthRedirect:us,highlightTooltip:Lo&&!Xe},Ft=[],Fo=[],Ho=!u&&!ko&&(bo||xr!=null)&&!Ae,Uo=Tr(),Jr=!O||Uo||ss,Go=Ot===mt.None?Ge.ModelNotSupported:z?Ge.ThinkModeInUse:Ae?Ge.SearchModeInUse:void 0;if(Jr){const y=e.jsx("div",{"data-testid":"composer-action-file-upload",style:{viewTransitionName:"var(--vt-composer-attach-file-action)"},children:e.jsx(ig,{...Xr,showGlowingBorder:G,showLabel:Er()==="all",showUpsell:Uo&&!ss,showMenuForNoAuth:ss,isDisabled:!Ho||yt,disabledReason:Go,currentModelName:n?.title??"",visualTreatment:Le?"vanguard":"legacy"})},"file-upload-button");Ft.push(y),Fo.push(y)}const Fe=[],zo=zn(),Wo=fe(y=>y.isVisuallyOverflowing)&&ct;let ms="bottom";zo?ms="bottom":p&&(ms="centered"),ct&&(X?.kind!==He.GizmoInteraction||Dt)&&Fe.push(e.jsx("div",{"data-testid":"composer-action-reasoning-level",className:"flex [--pill-color:var(--text-secondary)] [--pill-font-size:13px]",onPointerDown:y=>y.stopPropagation(),children:e.jsx(En,{announcementKey:pe.ModelPickerMoved,side:"bottom",show:ne&&br&&!$.isLoading&&$.eligible,onDismiss:$.markAsViewed,theme:"bright",badge:"none",dismissOnOutsideClick:!0,sideOffset:0,title:e.jsx(H,{id:"NGN4SW",defaultMessage:"Set how long ChatGPT should think or pick a different model"}),children:e.jsx(bf,{clientThreadId:l,layoutMode:ms,currentModel:n,category:pr,type:Sr,mode:Dt?"model-picker-only":"default"})})},"reasoning-level")),yr||Fe.push(e.jsx(sf,{account:o,clientBootstrapFlags:po,features:re,currentModelConfig:n,hasFiles:Xe,isDisabled:yt||Xe,clientThreadId:l,composerController:v,gizmoId:St},"search"));const{value:Zr}=ae("1830177352");if(!ct&&!vr&&Fe.push(e.jsx(Zp,{clientThreadId:l,gizmoId:St,composerController:v,isDisabled:yt},"reason")),Zr&&Fe.push(e.jsx(Qp,{clientThreadId:l,showLabel:Qr,isDisabled:yt},"deep-research")),Wo||Fe.push(e.jsx(Tp,{clientThreadId:l,composerController:v,isDisabled:yt,currentModelConfig:n,currentModelConfigLoading:c,disableIfNoAccess:ct},"shiba")),co&&Us&&Us.connection_statuses.length>0&&!Wo&&Fe.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-search-action)"},"data-testid":"composer-action-contextual-answers",children:e.jsx(_g,{composerController:v,systemHint:co,clientThreadId:l,connectionStatuses:Us.connection_statuses})},"contextual-answers")),Dr&&Fe.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-system-hint-action)"},"data-testid":"composer-action-system-hint-button",children:e.jsx(bg,{composerController:v,clientThreadId:l,disabled:yt,hideThinkButton:ct,disableIfNoAccess:ct})},"system-hint-button")),wr==="none")Ft.push(...Fe);else{const y=Fe.find(K=>K.key==="system-hint-button");y&&Ft.push(y)}const tn=ht(B,"2007855518"),Vo=it?.message.metadata?.async_task_id,sn=om(y=>Vo?y.tasks[Vo]:null),[el,qo]=m.useState(!1),nn=sn?.status===am.RUNNING,on=Kr?"disabled":"default",tl=im(zt(l)||l)?.value===vp.STREAMING,$o=d&&h||tl||nn&&tn,sl=yp(),nl=!vt||sl,an=hm(vo,wo,Ys,_r,!jo,nn,tn),Ct=$o?"streaming":nl?"disabled":"idle",Ht=m.useRef(null),kt=m.useRef(null),{value:ol}=ae("222560275"),al=ol||a&&!a.startsWith("o1")&&!a.startsWith("o3");m.useEffect(()=>{const y=()=>{Ht.current!=null&&jp.addAction("composer_state_disabled",{threadId:zt(l),disabledReason:Ht.current})};if(as&&Ct==="disabled"){let K="unknown";u?K=x??"component_disabled_unknown":d?K="completion_in_progress":rt&&(K="thread_hard_blocked"),Ht.current!==K&&(kt.current&&clearTimeout(kt.current),kt.current=setTimeout(y,Wg)),Ht.current=K}else Ht.current=null;return()=>{kt.current&&(clearTimeout(kt.current),kt.current=null)}},[l,as,Ct,u,x,d,rt]);const ps=[];if(Me?.label&&ps.push({type:Me.type,value:Me.label,onRemoveRegion:No}),Se!==null){const y=!!Se.gizmo.tags?.includes(Es.FirstParty);ps.push({type:"mention",value:Se.gizmo.display.name,icon:e.jsx(Ii,{isFirstParty:y,src:Se.gizmo.display.profile_picture_url,className:"icon-md"}),onRemoveRegion:()=>{ts(null),v.focus()}})}m.useEffect(()=>{(!Je||Je.length===0||!cs)&&(zs.current=!1)},[Je,cs]);const il=(y,K,he)=>{zs.current=y>=0,K&&v.setText(he?`${he.title}${he.body}`:"")},Yo=cs&&Je&&Je.length>0&&!wt&&!Ke&&!v.hasMultipleLines()&&v.canShowAutocompletion();m.useEffect(()=>{wt?_?.():D?.()},[wt,_,D]);const fs=y=>{if(y.preventDefault(),y.stopPropagation(),Gs.current>0){const K=performance.now()-Gs.current;Mi.hist(Pi.DEFAULT,"final_user_input_to_submit_ms",[],K)}Ct==="streaming"&&(!mo||v.isEmpty())?nn&&tn?qo(!0):zr(y):To(y)},rl=rm(n,ki.Canvas),{value:ll}=ae("61299031"),cl=lm(),ul=rl&&ll&&!cl&&!So&&!zo;m.useEffect(()=>{},[fr,v]),m.useEffect(()=>{const y=zt(l),K=o?.normalizedAccountUserId;if(!K||i)return;const he=ys(()=>{const ve=v.getContentToSend().content;ve===""?wp(y):Cp(y,ve,K)},1e3);return v.subscribe("change",he)},[o,l,v,i,le]);const Ko=e.jsx(Uf,{canUseInlineTagging:ls,isDisabled:u,clientThreadId:l,currentLeafId:ie,currentRequestId:$e,canContinue:g,composerController:v,isNewThread:p,onContinueGenerating:y=>s({event:y,conversationMode:We(l)?.mode,systemHints:fa(Js,v,te)}),onResetState:Eo,conversationMode:X,isShowingAutocomplete:!!Yo}),Qo=!$o&&X!=null&&al&&cm.includes(X.kind)&&e.jsx(um,{clientThreadId:l,onTargetedReply:Fr}),Xo=Yo&&e.jsx("div",{className:F("absolute start-0 z-[-1] box-border w-full ps-0 max-lg:bottom-full lg:top-full",Le?"border-token-border-default md:bg-token-main-surface-primary z-10! bg-transparent md:mt-2 md:rounded-3xl md:border md:shadow-[0px_12px_24px_rgba(0,0,0,0.032)]":"bg-token-main-surface-primary"),children:e.jsx(Np,{suggestions:Je,composerController:v,onSelect:k,onChange:il})}),Jo=e.jsx(xm,{composerController:v,parsedDocumentHandler:Gr}),Zo=!w&&e.jsx($i,{className:N}),ea=e.jsx(dm,{modelSupportedImageMimeTypes:Qe,uploadType:mt.Multimodal,attachmentsProductFeature:rs?.attachments}),dl=e.jsxs(e.Fragment,{children:[wt&&e.jsx(va,{onClick:y=>Do(y),onClose:()=>{v.setShowTaggingDropdown(!1),v.focus()}}),Qs&&e.jsx(ka,{composerController:v,clientThreadId:l})]}),{isImageGenEditor:ta}=mm();return ta?e.jsxs(da.Provider,{value:os,children:[e.jsx(pa,{onOauthRedirect:us,children:e.jsx(ma,{children:e.jsx("form",{id:"prompt",className:f,onSubmit:fs,children:e.jsxs("div",{className:"relative z-1 flex h-full max-w-full flex-1 flex-col",children:[Zo,e.jsxs("div",{className:"group relative z-1 flex w-full items-center",style:{"--force-hide-label":Br?"none":"block"},children:[e.jsxs(Is,{open:wt||Qs,children:[e.jsx(qn,{className:"w-full",children:ta?e.jsx(Gg,{type:Ne?"temporary":"default",ref:M,placeholder:en,inputState:on,composerController:v,leftSideActions:Fo,state:Ct,onSubmit:fs,renderFiles:Xe&&e.jsxs(e.Fragment,{children:[E==="magic"&&e.jsx("div",{className:"bg-token-main-surface-secondary text-token-text-secondary m-2 mb-0 rounded-lg p-2 text-xs",children:e.jsx(H,{...se.gizmoKnowledgeWarning})}),e.jsx(hn,{files:de,className:"-ms-1.5 flex flex-nowrap gap-2 overflow-x-auto p-1.5"})]}),clientThreadId:l,gizmoId:St,disableReason:an,modelId:a}):e.jsx(pg,{type:Ne?"temporary":"default",ref:M,replyRegions:ps,placeholder:en,inputState:on,setIsComposerOverflowing:Ir,composerController:v,matchaData:Ur,leftSideActions:Ft,topRightAction:ul&&e.jsx(fm,{composerRef:M,composerController:v,clientThreadId:l}),state:Ct,onSubmit:fs,renderFiles:jr&&e.jsxs(e.Fragment,{children:[E==="magic"&&e.jsx("div",{className:"bg-token-main-surface-secondary text-token-text-secondary m-2 mb-0 rounded-lg p-2 text-xs",children:e.jsx(H,{...se.gizmoKnowledgeWarning})}),e.jsx(hn,{files:de,selectedApps:$s,className:"-ms-1.5 flex flex-nowrap gap-2 overflow-x-auto p-1.5"})]}),clientThreadId:l,gizmoId:St,disableReason:an,modelId:a})}),e.jsx(Ns,{children:e.jsxs(Bs,{side:"bottom",align:"start",sideOffset:12,onOpenAutoFocus:y=>y.preventDefault(),children:[wt&&e.jsx(va,{onClick:y=>Do(y),onClose:()=>{v.setShowTaggingDropdown(!1),v.focus()}}),Qs&&e.jsx(ka,{composerController:v,clientThreadId:l})]})})]}),Xo]}),Jo,ea]})})})}),Ko,Qo]}):e.jsx(da.Provider,{value:os,children:e.jsxs(ma,{children:[e.jsx(pa,{onOauthRedirect:us,children:e.jsxs("div",{className:F(`relative z-1 flex max-w-full flex-1 flex-col ${Le?"":"h-full"}`,!Le&&"max-xs:[--force-hide-label:none]",ct&&!ne&&"[--force-hide-label:none]"),children:[Zo,sn&&el&&e.jsx(pm,{taskId:sn.taskId,clientThreadId:l,onClose:()=>qo(!1)}),e.jsx(Ug,{visualTreatment:Le?"vanguard":"legacy",hasFiles:Xe,pendingFiles:de,isUploadDisabled:!Ho,isNewThread:p,clientThreadId:l,getEditorGizmoId:J,highlightUploadTooltip:Lo&&!Xe,disableReason:an,uploadButtonDisabledReason:Go,currentModel:n,layoutMode:ms,conversationMode:X,onOauthRedirect:us,state:Ct,inputState:on,gizmoId:St,isTemporaryChat:Ne,placeholder:en,composerController:v,onSubmit:fs,replyRegions:ps,keepExpanded:p||!Le,legacyFooterActions:Ft,legacySuggestionsPopoverContent:dl,isInReasonMode:Js,modelSupportedSystemHints:es}),Xo]})}),Jo,Ko,Qo,ea]})})}function Pa({clientThreadId:t,onClick:s}){m.useEffect(()=>{wm(t)},[t]);const o=Q();return e.jsx(Y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},className:"inline-block",children:e.jsx(xi,{onClick:()=>{Cm(t),s()},label:o.formatMessage(Xg.moreStarterPrompts)})})}function $g({starterPrompt:t,starterPrompts:s,index:o,disabled:a,onSelectStarterPrompt:n}){const i=t.theme??t.title,r=Ep(),{mutate:c}=km(),l=t.category==="onboarding"?p=>{c({key:pe.hasUsedConversationalOnboardingStarterPrompt}),r(p,t,s,o)}:p=>n?.(p,t,s,o);return e.jsx(xi,{disabled:a,onClick:l,icon:e.jsx(jm,{category:t.category,useV2Colors:!0}),label:i})}const Yg=5,Kg=3;function lr({starterPrompts:t,onSelectStarterPrompt:s,disabled:o,clientThreadId:a,onExpand:n,mobileLayout:i=!1}){const r=i?Kg:Yg,[c,l]=m.useState(r),[p,d]=m.useState(!1),f=m.useRef(null),u=t.length<=c;m.useEffect(()=>{ga(t.slice(0,r),a)},[a]),m.useEffect(()=>{if(!p&&!u&&f.current){const h=f.current,g=h.getBoundingClientRect(),b=g.width,S=Array.from(h.children);let C=0;for(let k=0;k<S.length&&S[k].getBoundingClientRect().right-g.left<=b;k++)C++;l(C),d(!0)}},[t,u,p]);const x=()=>{const h=t.slice(c,t.length).map(g=>({...g,isAdditional:!0}));h.length>0&&ga(h,a),l(t.length),n()};return e.jsxs("div",{className:F("mt-5 flex items-center justify-center gap-x-2 transition-opacity xl:gap-x-2.5",p&&t.length>0?"opacity-100":"opacity-[0.01]",i?"flex-wrap":"flex-nowrap"),children:[e.jsxs("ul",{className:F("relative flex items-stretch gap-x-2 gap-y-4 overflow-hidden py-2 sm:gap-y-2 xl:gap-x-2.5 xl:gap-y-2.5",u||i?"flex-wrap justify-center":"flex-nowrap justify-start"),ref:f,children:[t.slice(0,c).map((h,g)=>e.jsx(Y.li,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},children:e.jsx($g,{starterPrompt:h,starterPrompts:t,index:g,disabled:o,onSelectStarterPrompt:s})},h.id??g)),i&&t.length>c&&e.jsx(Pa,{clientThreadId:a,onClick:x})]}),!i&&t.length>c&&e.jsx(Pa,{clientThreadId:a,onClick:x})]})}const gh=({clientThreadId:t,currentModelId:s,isModelLoaded:o})=>{const[a,n]=m.useState(!1),i=eo(),{prospectiveModelId:r}=Qt(t),c=o?s:r??"auto",{promptStarters:l,shouldShowStarterPrompts:p,onSelectStarterPrompt:d}=Bi({isModelLoaded:o,shouldBeEnabledForDefaultAssistant:!0,clientThreadId:t,limit:8,modelSlug:c});return e.jsx(Y.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:F(!a&&"h-[116px]"),children:p&&l&&e.jsx(lr,{starterPrompts:l,onSelectStarterPrompt:d,disabled:i,clientThreadId:t,onExpand:()=>n(!0),mobileLayout:!0})})},Qg=({currentModelId:t,clientThreadId:s,isModelLoaded:o})=>{const{isUnauthenticated:a}=_e(),[n,i]=m.useState(!1),r=ym(),c=eo(),{prospectiveModelId:l}=Qt(s),p=o?t:l??"auto",{promptStarters:d,shouldShowStarterPrompts:f,onSelectStarterPrompt:u}=Bi({isModelLoaded:o,shouldBeEnabledForDefaultAssistant:!0,clientThreadId:s,limit:8,modelSlug:p});return e.jsx(Y.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:F("hidden min-h-[108px] max-w-full",r?"@lg/thread:block":"lg:block",a&&n?"":"h-[70px]"),children:f&&d&&e.jsx(lr,{starterPrompts:d,onSelectStarterPrompt:u,disabled:c,clientThreadId:s,onExpand:()=>i(!0)})})},Xg=Ee({moreStarterPrompts:{id:"SplashScreenV2.moreStarterPrompts",defaultMessage:"More"}}),Ea=Yn.div`m-8 flex flex-col items-center`;function Ta(t){return e.jsx(Y.div,{initial:{opacity:0,translateY:20},animate:{opacity:1,translateY:0,transition:{duration:.5,ease:"easeIn"}},...t})}function Jg({clientThreadId:t}){const o=ce(t,n=>n?.promptGptRating)?.gizmoId,{data:a}=bi(o);return o==null||a==null||!_m(a)?null:e.jsx(Zg,{gizmoId:o})}function Zg({gizmoId:t}){const[s,o]=m.useState(!1),[a,n]=m.useState(!1),i=Rm(t),r=async l=>{o(!0),setTimeout(()=>{n(!0)},5e3),A.logEvent("Submit Inline Rating",{gizmo_id:t,rating:l}),await i.mutateAsync({rating:l})},c=async()=>{n(!0),A.logEvent("Dismiss Inline Rating",{gizmo_id:t}),await i.mutateAsync({})};return m.useEffect(()=>{a||A.logEvent("Show Inline Rating",{gizmo_id:t})},[a,t]),a?null:s?e.jsx(Ea,{children:e.jsxs(Ta,{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"border-token-border-heavy rounded-lg border p-4",children:e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(H,{id:"gizmo.inlineReview.reviewLeft",defaultMessage:"Feedback sent"}),e.jsx(Sa,{onClick:()=>{n(!0)}})]})}),e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(H,{id:"gizmo.inlineReview.reviewLeftSubtext",defaultMessage:'To update your rating, click "Send Feedback" in the GPT Menu'})})]})}):e.jsx(Ea,{children:e.jsxs(Ta,{className:"border-token-border-heavy flex flex-col items-center gap-4 rounded-lg border p-4",children:[e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(H,{id:"gizmo.inlineReview.prompt",defaultMessage:"How would you rate this GPT so far?"}),e.jsx(Sa,{onClick:c})]}),e.jsx(Am,{rating:void 0,onRating:r})]})})}const hh=({clientThreadId:t,isNewThread:s,isGizmoThread:o,isProjectThread:a,isModelLoaded:n,currentModelId:i,onRequestCompletion:r,shouldUseUnifiedComposer:c,isVanguardUxEnabled:l,onlyAllowImageUploads:p})=>{const d=Et(),{pageType:f}=fi(),u=f?.type==="landing-page",x=m.useContext(_p),h=Rp(x),g=zn();nt(),Mm(d);const b=async N=>{if(We(t)?.isLoading!==!1)return;const w=await Dm(N);r(w)},S=m.useCallback(N=>{A.logEvent("Continue Completion"),r(Pm(N))},[r]),C=e.jsxs(e.Fragment,{children:[e.jsx(Jg,{clientThreadId:t}),e.jsx(un,{verticalMargin:"none",verticalPadding:h?"last-standard":"none",horizontalPadding:"standard",children:e.jsx(dn,{children:e.jsx(eh,{clientThreadId:t,currentModelId:i,isNewThread:s,hideHeader:s,onRequestCompletion:b,onContinueGenerating:S,onAutocompleteSelect:d.onAutocompleteSelect,onlyAllowImageUploads:p})})})]}),k=s&&e.jsx("div",{className:F("[display:var(--display-hidden-until-loaded,block)] md:absolute md:start-0 md:bottom-6 md:w-full"),children:e.jsx(un,{verticalMargin:"none",verticalPadding:"none",horizontalPadding:"standard",children:e.jsx(dn,{children:e.jsx($i,{className:"block flex-1"})})})});return c?e.jsxs(e.Fragment,{children:[g&&k,e.jsx("div",{id:"thread-bottom",children:C}),!g&&k,s&&!u&&!o&&!a&&!l&&e.jsx(un,{verticalMargin:"none",verticalPadding:"none",horizontalPadding:"standard",children:e.jsx(dn,{children:e.jsx(Qg,{clientThreadId:t,currentModelId:i,isModelLoaded:n})})})]}):C};function eh({clientThreadId:t,currentModelId:s,disableDraftPersistence:o=!1,isNewThread:a,onRequestCompletion:n,onContinueGenerating:i,onComposerInput:r,onComposerChange:c,onAutocompleteSelect:l,headerClassName:p,hideHeader:d,onTaggingDropdownClose:f,onTaggingDropdownOpen:u,onlyAllowImageUploads:x}){const{data:h,isLoading:g}=Zt(),[b,S,C,k]=ce(t,I=>{const q=Z.getCurrentNode(I);return[q.message.clientMetadata?.errType!=null&&q.message.clientMetadata.errType!=="info",Ap(Z.getCurrentNode(I).message),I?.mode,I?.continuingFromSharedConversationId!=null]}),N=nt(),w=Et(),_=Mp({clientThreadId:t}),{isOpen:D,onClose:R}=Em({type:"just-hit-rate-limit"}),B=m.useMemo(()=>_?!1:!b&&S,[b,S,_]),M=_,v=Ri(t),W=bi(v).data,G=Pp(),P=W?.gizmo.tags?.includes(Es.WorkspaceDisabled)&&!G?"workspaceDisallowsGizmo":h?.models.size===0?"noModelsAvailable":C?.kind===He.GizmoTest&&C.gizmo_id==null?"noTestGizmoId":null,j=bl(),V=Tm(),O=j.action==="moderate",{value:U}=ae("1860647109");return e.jsxs(e.Fragment,{children:[e.jsx(Nm,{composerController:w,clientThreadId:t,currentModelId:s,isCompletionInProgress:_}),e.jsx("div",{className:"flex justify-center empty:hidden",children:V&&O&&U?e.jsx(Bm,{}):null}),D?e.jsx(Im,{onClose:R}):null,e.jsx(qg,{clientThreadId:t,disableDraftPersistence:o,onCreateNewCompletion:n,onContinueGenerating:i,currentModelId:s,account:N,modelCategories:h?.categories,currentModelConfig:Va(h?.models,s),areModelsLoading:g,isNewThread:a,isCompletionInProgress:_,className:"w-full",canContinue:B,disabled:!!P,disabledReason:P??void 0,canPause:M,isInteractableSharedThread:k,onComposerInput:r,onComposerChange:c,onAutocompleteSelect:l,headerClassName:p,hideHeader:d,onTaggingDropdownClose:f,onTaggingDropdownOpen:u,onlyAllowImageUploads:x},t)]})}export{Wi as B,no as C,Xf as D,fh as F,Gg as I,gh as M,so as P,sr as R,hh as T,eh as a,Qf as g,oo as h,lo as u};
//# sourceMappingURL=nc07k7y06adedb9d.js.map
