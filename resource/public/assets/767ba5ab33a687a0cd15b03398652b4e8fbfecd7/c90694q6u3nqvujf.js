import{r as w,j as n}from"./j12so9ru57hpoz1y.js";import{C as G}from"./jgfehaz03xkmntxn.js";import{D as F,a as q}from"./pcetty3qfpqopskj.js";import{T as z,a as J,A as k,u as K,i as Q,C as X,g as Y}from"./dz4gi6vh0lvtjto6.js";import{hx as Z,hy as $,hz as tt,g as et,dD as ot,hA as V,hB as rt,hC as M,hD as nt,hE as it}from"./jn7p98x7qxquz26a.js";import{C as P}from"./fmw3vtt8y90emgda.js";import{n as st,y as lt}from"./j5zd9vs1l0bwsjqa.js";import"./epsg05et2lobrl6v.js";import"./gh4kfg6qlx7b3ikk.js";import"./ke2u5pwt169srvv9.js";import"./msp412gwqdn605it.js";import"./ok8fnoyzbnoyk9qs.js";import"./bmq33amvrfzjcyfd.js";import"./ng20n9f2et03jm61.js";import"./dyn54m8afmkkz42o.js";import"./ik1mvke1rzg5h1fr.js";import"./01yrv2o49ye0ebr7.js";import"./gld03raz97um5arz.js";import"./di9gukc1ozd2hjw9.js";import"./mbbi7ghgl3dsk97a.js";import"./doknjlw48az0ww3q.js";import"./j2m3ef69iou998eo.js";import"./egjzck8f21ldiiq8.js";import"./n5601invkykfg1ys.js";import"./b0v1yruiy44zd1p9.js";import"./owhjnpwqw9ddu7v0.js";import"./d8hi8vzea1zd4sdu.js";import"./hxt8zt4ovcs39phn.js";import"./mx9tryggoikmqll4.js";import"./fqps1a3pxo0q8nxi.js";import"./e31tdb1dzgc9nuq8.js";import"./cx64odxk6g9mmfxk.js";function ct(t,e){const l=t.doc.lineAt(e.from);return e.from===l.from&&e.to-1===l.to}function at(t){const e=t.dom.querySelector(".cm-gutters");return e?e.offsetWidth:0}const mt=({onAddComment:t,isSendDisabled:e=!1,isWaitingForCommentResponse:l=!1})=>{const o=Z(),u=$(),c=tt(),L=w.useCallback(i=>{const{height:a,width:m}=i,r=o();if(!u||!r)return null;const d=u.selection.asSingle();if(d.ranges.length===0)return null;const s=d.ranges[0],{empty:j,to:O}=s;let{head:p}=s;const{platform:H}=et();p=H==="web"?p:O;const h=p===O;let g=p;if(h&&ct(u,s)&&(g-=1),j)return null;const{left:v,top:x,bottom:R}=r.contentDOM.getBoundingClientRect(),{left:A,top:I,bottom:C}=st(r.coordsAtPos(g,h?-1:1)),E=at(r);function y(){if(h)return Math.max(A-v+E-m,E);let f=A-v+E;return f+m>c&&(f=-(m-c)),f}function W(f){const b=a*2,N=f.contentHeight-(C-R)>b&&window.innerHeight-C>b,_=C-x+8,B=I-x-a-8;return h&&N||B<0?{top:_,aboveOrBelow:k.BELOW}:{top:B,aboveOrBelow:k.ABOVE}}const T=W(r);return{left:y(),top:T.top,aboveOrBelow:T.aboveOrBelow,toolbarSize:i}},[u,o,c]),D=w.useCallback(()=>o()?.dom??null,[o]);return n.jsx(z,{onAddComment:t,isWaitingForCommentResponse:l,isSendDisabled:e,toolbarType:J.CODE,getToolbarPosition:L,getEditorDom:D,getSelectionRange:()=>{const i=o();if(!i)return null;const{state:a}=i,m=a.selection.asSingle();if(m.ranges.length===0)return null;const r=m.ranges[0],{from:d,to:s}=r;return d==null||s==null?null:{from:d,to:s,sourceFrom:d,sourceTo:s}}})};function dt({diff:t}){return K(t?.edits??[]),null}function ut(t,e,l){const o=l?Y():0;return t<=1e3-o?t-(e?nt:0):t-(e?it:0)}const qt=({comments:t,currentlyStreamingLineIndex:e,isPreview:l=!1,isWaitingForCommentResponse:o=!1,isSendDisabled:u=!1,readonlyReason:c,isRequestActive:L=!1,language:D,value:i,textdocDiff:a,onAcceleratorsExpandedChange:m,onAddComment:r,onAcceptComment:d,onDismissComment:s,onBlur:j,onSave:O,onChange:p,onCancelRequest:H,getStableCommentId:h=lt,commentsMode:g=P.ENABLED,hideToolbar:v,hideAccelerators:x=!1,onSubmitAccelerator:R,modelCursor:A,codemirrorRef:I})=>{const C=w.useRef(null),[{width:E},y]=ot(),W=w.useRef(null),T=t.length>0,f=W.current,b=ut(E,T,Q(f)??!1),N=V(({commentingOn:S})=>S),_=V(({hoveredCommentId:S})=>S),B=V(({focusedCommentId:S})=>S);w.useEffect(()=>{C.current?.UNSAFE_setValue(i||"")},[i]);const U=E-b;return n.jsx("div",{className:rt.code,ref:M(y,W),children:n.jsxs(G,{id:"codemirror",comments:g===P.ALL_HIDDEN?void 0:t,commentingOn:N,currentlyStreamingLineIndex:e,hoveredCommentId:_,focusedCommentId:B,language:D,readonlyReason:c,onChange:p,value:i,textdocDiff:a,editorRef:M(C,I),width:b,modelCursor:A,isPreview:l,onBlur:j,onSave:O,children:[n.jsxs(G.EditorChildren,{children:[!v&&n.jsx(mt,{onAddComment:r,isSendDisabled:u,isWaitingForCommentResponse:o}),g!==P.ALL_HIDDEN&&n.jsx("div",{className:T?"me-4":"",children:n.jsx(X,{getStableCommentId:h,availableWidth:U,comments:t,commentsMode:g,onAddComment:r,onAcceptComment:d,onDismissComment:s,isWaitingForCommentResponse:o,isRequestActive:L,disableBlockComments:!0})})]}),n.jsxs(G.ContextChildren,{children:[a&&n.jsx(dt,{diff:a}),!x&&n.jsx(F,{isRequestActive:L,isVisuallyHidden:u||!!c?.isStreamingFromNative||c?.isReadonly&&!c.isStreaming,onSubmit:R,onCancel:H,actions:q,onExpandedChange:m})]})]})})};export{qt as CodeComposer};
//# sourceMappingURL=c90694q6u3nqvujf.js.map
