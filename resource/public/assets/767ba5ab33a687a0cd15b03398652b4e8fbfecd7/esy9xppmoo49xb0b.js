import{j as a,u as R,ae as Ce,b as ye,r,a9 as y,M as _,o as ve,aa as J}from"./j12so9ru57hpoz1y.js";import{a as S,q as we,d0 as Me,r as ne,a_ as oe,P as A,s as D,N as P,dT as Te,dk as T,J as V,D as je,$ as be,Q as U,X as ke}from"./j5zd9vs1l0bwsjqa.js";import{u as Se}from"./mx9tryggoikmqll4.js";import{f9 as _e,f7 as Ne,ne as re,ca as Re,af as Ie,ag as Ae,kc as Ee,ak as Oe,nf as Fe,aU as Be,ng as qe}from"./jn7p98x7qxquz26a.js";import{C as c,a as Ue,b as ze}from"./dzjjaskt8fkdwgfs.js";import{CA_SOURCE_TO_TEXT_MAP as De,getCASources as Pe}from"./loq1ozxos4mki5zd.js";import{F as ie,l as He}from"./gcv37ii59mzsrd32.js";import{g as Le,a as Xe,b as Ge,i as Ye,c as We,C as Qe,h as Je}from"./kipluhegsnyrr10h.js";import"./ik1mvke1rzg5h1fr.js";import"./b0v1yruiy44zd1p9.js";import"./msp412gwqdn605it.js";import"./ok8fnoyzbnoyk9qs.js";import"./lvpb6cwnqd8aihaw.js";import"./jfg5hcsrdvz6wljc.js";import"./gvjjanb6hwn8rg4p.js";import"./cg0toekqaiqcfbur.js";import"./e2i9dno9lalz25o9.js";import"./n0tk3xne532h7ges.js";import"./01yrv2o49ye0ebr7.js";import"./kep3qe1fe7a2vzu1.js";const I=24,$=12,z=4,Ve=5e3;function E(t,e,s){switch(e.type){case c.Thought:return e.thought.summary;case c.Recap:return e.content;case c.Browsing:return ce({contextualAnswerSources:e.sources,intl:t});case c.Search:return s?t.formatMessage({id:"+a5J9x",defaultMessage:"Searched the web"}):t.formatMessage({id:"GamH3R",defaultMessage:"Searching the web"});case c.CodeAnalysis:return s?t.formatMessage({id:"SGdXPO",defaultMessage:"Analyzed"}):t.formatMessage({id:"rEhiFx",defaultMessage:"Analyzing"});case c.ImageAnalysis:return s?t.formatMessage({id:"fjqIXj",defaultMessage:"Analyzed image"}):t.formatMessage({id:"D//PTx",defaultMessage:"Analyzing image"});case c.ComputerOutput:return}}const ce=({contextualAnswerSources:t,intl:e})=>{if(t.length===0)return e.formatMessage({id:"browsingMessage.startingRetrieval",defaultMessage:"Reading documents"});const s=t.map(o=>De[o]).filter(Boolean);return t.length===1?e.formatMessage({id:"Jzt2om",defaultMessage:"Reading {source}"},{source:s[0]}):t.length===2?e.formatMessage({id:"wTM7gR",defaultMessage:"Reading {source1} and {source2}"},{source1:s[0],source2:s[1]}):e.formatMessage({id:"xnwjH1",defaultMessage:"Reading {source1}, {source2} and more"},{source1:s[0],source2:s[1]})};function $e(t){const e=new Set,s=new Set;for(const o of t)if(o.type===c.Search){for(const n of o.queries)e.add(n.q);for(const n of o.sources)s.add(n.domain)}return{queries:e.size,sources:s.size}}const Ke="_markdown_1frq2_10",Ze="_fade_1frq2_1",et={markdown:Ke,fade:Ze},K=({content:t})=>a.jsx(ie,{className:S(et.markdown,"text-token-text-secondary text-sm"),componentOverrides:{code:e=>a.jsx(_e,{...e,wrapperClassName:"",showActionBar:!1})},children:t}),tt=({chunk:t,isExpanded:e,isComplete:s})=>{const o=R(),[n,l]=t.messages,m=Le(n)!=null;return a.jsxs("div",{className:"flex w-full flex-col gap-2 text-sm",children:[e&&E(o,t,s),m&&a.jsxs("div",{children:[a.jsx(Xe,{message:n,forceDarkMode:!0,FormattedText:ie,showActionBar:!1,codeRendererClassName:S("rounded-md max-h-[calc(clamp(20px,1/4*var(--thread-safe-area-height,100lvh),400px))] overflow-auto",l&&"rounded-b-none"),codeContainerClassName:"overflow-visible!"}),l&&a.jsx(Ge,{forceDarkMode:!0,wrapperClassName:"max-h-[calc(clamp(20px,1/8*var(--thread-safe-area-height,100lvh),200px))] w-full overflow-auto dark rounded-b-md",codeContainerClassName:"whitespace-pre-wrap",message:l,showLabel:!1})]})]})},st=({chunk:t,isExpanded:e,isComplete:s})=>{const o=R(),n=t.messages[1],l=Ce(),{isUnauthenticated:m}=we(),g=n.metadata?.aggregate_result?.messages.find(Ye),p=g?.image_url&&Ne(g.image_url),{data:u}=ye(p?We(p,m):{enabled:!1,queryKey:[]}),f=u?.status===Me.Success?u.download_url:void 0,{isSuccess:i}=re(f),[x]=r.useState(i);return a.jsxs("div",{className:"flex w-full flex-col gap-2 text-sm",children:[e&&E(o,t,s),a.jsxs("div",{className:"bg-token-bg-secondary relative flex h-[calc(clamp(150px,1/4*var(--thread-safe-area-height,100lvh),400px))] justify-center overflow-hidden rounded-md p-2",children:[f&&a.jsx(y.div,{initial:{opacity:x?.5:0,scale:1.1},animate:{opacity:i?.5:0,scale:s||l?1.1:[1.1,1.25,1.1]},transition:{opacity:{ease:"easeInOut"},scale:s?{type:"spring",stiffness:300,damping:20}:{duration:2.5,repeat:1/0,ease:"easeInOut"}},className:"absolute inset-0 bg-cover bg-center bg-no-repeat opacity-40 blur-lg filter",style:{backgroundImage:`url(${JSON.stringify(f)})`}}),a.jsx(y.div,{initial:{opacity:x?1:0},animate:{opacity:i?1:0},className:"relative *:m-0 *:h-full *:w-full *:rounded-md *:object-center *:shadow-lg",children:a.jsx(Qe,{isCoT:!0,message:n})})]})]})},at=4,nt=3,ot=3,rt={hidden:{opacity:0},visible:{opacity:1}},Z={hidden:{opacity:0,x:-5},visible:{opacity:1,x:0}},it=({chunk:t,isExpanded:e,isComplete:s})=>{const{queries:o,sources:n}=t,l=R(),[m,g]=r.useState(s);return a.jsxs("div",{className:"flex min-w-0 flex-col gap-2 text-sm",children:[e&&E(l,t,s),a.jsxs("div",{className:"flex min-w-0 flex-col gap-1",children:[a.jsx(ee,{isComplete:s,items:o,max:ot,getKey:p=>p.q,Item:ct,ShowMoreButton:dt,onAnimationComplete:()=>g(!0)}),a.jsx(ee,{isComplete:s,items:m?n:[],max:at,getKey:p=>p.entries[0].url,Item:lt,ShowMoreButton:ut})]})]})},ee=({isComplete:t,items:e,max:s,getKey:o,Item:n,ShowMoreButton:l,onAnimationComplete:m})=>{const[g,p]=r.useState(!1),[u,f]=e.length>s?[e.slice(0,s-1),e.slice(s-1)]:[e];return a.jsxs(y.div,{className:"flex flex-wrap items-center gap-1",initial:t?"visible":"hidden",animate:"visible",transition:{duration:.25,staggerChildren:.1,delayChildren:.3},onAnimationComplete:m,children:[u.map(i=>a.jsx(y.div,{variants:rt,className:"flex max-w-full items-center",children:a.jsx(n,{item:i,isComplete:t})},o(i))),g&&a.jsx(y.div,{className:"contents",initial:"hidden",animate:"visible",transition:{duration:.2,staggerChildren:.02},children:f?.map(i=>a.jsx(y.div,{variants:Z,className:"flex max-w-full items-center",children:a.jsx(n,{item:i,isComplete:t})},o(i)))}),f&&a.jsx(y.div,{variants:Z,className:"flex items-center",children:a.jsx(l,{moreItems:f,isShowingMore:g,onClick:()=>p(i=>!i)})},"more")]})},ct=({item:t})=>a.jsxs(O,{componentType:"span",children:[a.jsx(Re,{className:"-ms-1 h-3 w-3 shrink-0"}),a.jsx("span",{className:"overflow-hidden text-ellipsis whitespace-nowrap",children:t.q})]}),lt=({item:t,isComplete:e})=>{const s=ne(),o=oe(s,"3507026387"),n=t.entries[0],l=r.useMemo(()=>({url:n.url,title:n.title}),[n.url,n.title]);r.useEffect(()=>{A.logEventWithStatsig("link_action","link_action",{...l,action:"show"})},[l]);const m=()=>{A.logEventWithStatsig("link_action","link_action",{...l,action:"click"})};return a.jsxs(O,{componentType:Ie,href:n.url,onClick:m,animateScan:o&&!e,children:[a.jsx(le,{url:n.url}),n.attribution??Ae(n.url)]})},le=({url:t,withBorder:e=!1})=>{const{isSuccess:s,isError:o}=re(Ee(t,32)),[n]=r.useState(s);return o?null:a.jsx(y.div,{initial:{opacity:n?1:0},animate:{opacity:s?1:0},className:S("bg-token-main-surface-primary -ms-3 box-content h-3 w-3 shrink-0 overflow-hidden rounded-full first:-ms-1",e&&"border-token-main-surface-secondary group-hover:border-token-text-primary dark:group-hover:border-token-text-primary border"),children:a.jsx(Oe,{url:t,size:32,minSize:16,className:"m-0"})})},ut=({moreItems:t,isShowingMore:e,onClick:s})=>a.jsx(O,{onClick:s,children:e?a.jsx(_,{id:"19fGXl",defaultMessage:"Show less"}):a.jsxs(a.Fragment,{children:[t.slice(0,nt).map((o,n)=>a.jsx(le,{url:o.entries[0].url,withBorder:!0},n)),a.jsx(_,{id:"5ob5C8",defaultMessage:"{count} more",values:{count:t.length}})]})}),dt=({moreItems:t,isShowingMore:e,onClick:s})=>a.jsx(O,{onClick:s,children:e?a.jsx(_,{id:"0SWns2",defaultMessage:"Show less"}):a.jsx(_,{id:"PpZw7t",defaultMessage:"{count} more",values:{count:t.length}})}),mt=1500,O=t=>{"use forget";const e=ve.c(24);let s,o,n,l,m;e[0]!==t?({className:n,componentType:m,children:o,animateScan:s,...l}=t,e[0]=t,e[1]=s,e[2]=o,e[3]=n,e[4]=l,e[5]=m):(s=e[1],o=e[2],n=e[3],l=e[4],m=e[5]);const g=m===void 0?"button":m,[p,u]=r.useState(!1),f=Math.random()*mt;let i,x;e[6]!==s?(i=()=>{s&&(u(!1),requestAnimationFrame(()=>u(!0)))},x=[s,f],e[6]=s,e[7]=i,e[8]=x):(i=e[7],x=e[8]),r.useEffect(i,x);const v=s&&"dark:border-token-main-surface-secondary border border-[#f4f4f4] bg-transparent dark:bg-transparent",j=(l.href!=null||l.onClick!=null)&&"hover:bg-token-main-surface-primary-inverse hover:text-token-text-inverted dark:hover:bg-token-text-primary";let w;e[9]!==n||e[10]!==v||e[11]!==j?(w=S(He,"group relative max-w-full overflow-hidden",v,j,n),e[9]=n,e[10]=v,e[11]=j,e[12]=w):w=e[12];let h;e[13]!==s||e[14]!==p?(h=s&&a.jsx("span",{className:S("dark:bg-token-main-surface-secondary absolute start-0 top-0 z-[-1] h-full rounded-se-full rounded-ee-full bg-[#f4f4f4] transition-[width] ease-in-out",p?"w-full":"w-0"),style:{transitionDuration:`${f}ms`}}),e[13]=s,e[14]=p,e[15]=h):h=e[15];let M;e[16]!==o?(M=a.jsx("div",{className:"z-1 inline-flex items-center gap-1",children:o}),e[16]=o,e[17]=M):M=e[17];let b;return e[18]!==g||e[19]!==l||e[20]!==w||e[21]!==h||e[22]!==M?(b=a.jsxs(g,{className:w,...l,children:[h,M]}),e[18]=g,e[19]=l,e[20]=w,e[21]=h,e[22]=M,e[23]=b):b=e[23],b};var ue=(t=>(t.STATIC="static",t.ENTER="enter",t.STAGE="stage",t))(ue||{});const ft=({isAnimationComplete:t=!1,isExpanded:e=!1,isLast:s=!1,index:o,chunk:n,onClick:l,onMeasure:m,onAnimationComplete:g,showBullet:p=!1})=>{const u=s||e,f=!s||t,i=f?"static":"stage",x=f?"static":"enter",v=r.useRef(null);v.current=()=>{g?.(o,"enter")},r.useEffect(()=>{if(x!=="enter")return;const h=setTimeout(()=>{D.count(P.COT_SUMMARIZER,"cot_chunk_timeout"),v.current?.()},Ve);return()=>clearTimeout(h)},[x]);const j=x==="static",w=r.useRef(null);return Te(()=>Fe({axis:"height",target:w.current,onChange:({height:h})=>m(o,h)}),[]),a.jsx(y.div,{role:e?void 0:"button",variants:{static:{opacity:1,scale:1,position:"static",translateY:0},enter:{position:"static",translateY:0,scale:1,opacity:1},stage:{position:"absolute",translateY:-I,scale:.95,opacity:0}},initial:i,animate:x,exit:e?void 0:{opacity:0,pointerEvents:"none",position:"absolute",translateY:I,filter:"blur(8px)"},style:{zIndex:o},transition:t||x==="static"?{duration:0}:{type:"spring",bounce:.05},className:S("text-token-text-secondary start-0 end-0 top-0 flex origin-left",!u&&"pointer-events-none"),onAnimationComplete:h=>h!=="enter"&&g(o,h),onClick:l,ref:w,children:a.jsx(Be,{onComplete:v.current,isDisabled:j,defaultDelayPerSegmentMs:20,children:p?a.jsxs("div",{className:"flex w-full items-start gap-2 overflow-clip",children:[a.jsxs("div",{className:"flex h-full w-4 shrink-0 flex-col items-center gap-2",children:[a.jsx("div",{className:"flex h-5 shrink-0 items-center justify-center",children:a.jsx(Ue,{chunk:n,size:"small"})}),!s&&a.jsx(y.div,{initial:{translateY:-I,opacity:0},animate:{translateY:0,opacity:1},className:"bg-token-border-medium h-full w-[1px] rounded-full"})]}),a.jsx(te,{chunk:n,isExpanded:e,isComplete:f})]}):a.jsx(te,{chunk:n,isExpanded:e,isComplete:f})})})},ht=r.memo(ft),te=({chunk:t,isExpanded:e,isComplete:s})=>{const o=R();switch(t.type){case c.Thought:return a.jsx(K,{content:t.thought.content});case c.Recap:return a.jsx("div",{className:"text-token-text-secondary text-sm",children:a.jsx(_,{id:"Eo2n2s",defaultMessage:"Done"})});case c.Search:return a.jsx(it,{chunk:t,isExpanded:e,isComplete:s});case c.CodeAnalysis:return a.jsx(tt,{chunk:t,isExpanded:e,isComplete:s});case c.Browsing:return e&&a.jsx(K,{content:ce({contextualAnswerSources:t.sources,intl:o})});case c.ImageAnalysis:return a.jsx(st,{chunk:t,isExpanded:e,isComplete:s});case c.ComputerOutput:return null}},se=new WeakMap;function gt(t){const e=[];for(const s of t){let o=se.get(s);o||(o=pt(s),o&&se.set(s,o)),o&&e.push(...o)}return e}function pt(t){switch(t.type){case T.ReasoningRecap:{const e=t.messages[t.messages.length-1].content.content;return[{type:c.Recap,content:e}]}case T.Browsing:case T.RetrievalBrowsing:{const e=Pe({messages:t.messages});return[{type:c.Browsing,sources:e,isRetrieval:t.type===T.RetrievalBrowsing}]}case T.StructuredThoughts:{const e=[];for(const s of t.messages){const{thoughts:o}=s.content;for(const n of o)!n.content&&!n.summary||e.push({type:c.Thought,thought:n})}return e}case T.CodeInterpreter:{const[e,s]=t.messages;if(e.author.role!==V.Assistant||s&&s.author.role!==V.Tool){je.addError(new Error("[cot] out of order code tool messages"));break}return[{type:s!=null&&Je(s)?c.ImageAnalysis:c.CodeAnalysis,messages:t.messages}]}case T.CoTSearchTool:{const e={type:c.Search,queries:[],sources:[]};for(const s of t.messages)if(s.metadata?.search_queries?.length&&(e.queries=s.metadata.search_queries),s.metadata?.search_result_groups?.length)for(const o of s.metadata.search_result_groups)e?.sources?.some(n=>n.domain===o.domain)||e.sources?.push(o);return[e]}case T.n7jupd:return;case T.n7jupd_x:return}}const xt={duration:.3,ease:"easeInOut"},ae=.2,Lt=({isStreaming:t,messageGroups:e})=>{const s=r.useMemo(()=>gt(e),[e]);return a.jsx(Ct,{isStreaming:t,chunks:s})},Ct=({isStreaming:t,chunks:e})=>{const s=R(),o=oe(ne(),"3133027893"),[n,l]=r.useState(!1),[m,g]=r.useState([]),p=r.useMemo(()=>$e(e),[e]),u=!t,f=be(e,d=>d.type!==c.Recap&&(o||!(t&&d===U(e)))),[i,x]=r.useState(t?-1:e.length),v=i===-1?void 0:e[i],j=i<f||i===f&&!t,w=t?f:e.length,h=vt(v),[M,b]=r.useState(!t||i<0),H=r.useRef(performance.now()),L=r.useRef(performance.now());r.useEffect(()=>{H.current=performance.now()},[i]),r.useEffect(()=>{L.current=performance.now()},[v]);const[X]=r.useState(t);r.useEffect(()=>{if(X&&j&&M){const d=performance.now(),C=Math.max(0,yt(v)-(d-H.current),h-(d-L.current));setTimeout(()=>{x(w),b(!1)},C)}},[X,j,M,h,v,w]);const k=u?e:e.slice(0,i+1),F=r.useMemo(()=>{const d=U(k);return u?d?.type===c.Recap?d:void 0:d?.type===c.Thought?ke(k,C=>C.type===c.Thought&&C.thought.summary!=null&&C.thought.summary.length>0):d},[u,k]),G=[...k.entries()];let Y=n?G:G.slice(-1);wt(i,u);const N=k.length>0&&e[0].type!==c.Recap,de=U(k)?.type===c.Browsing&&!n,me=N&&(!u||n)&&!de,W=N&&!u&&!n,fe=qe(m)+(m.length-1)*$+2*z,he=u?"auto":n?fe:(m[i]??0)+2*z,ge=r.useCallback((d,C)=>{d===i&&C===ue.ENTER&&setTimeout(()=>{b(!0)},h)},[i,h]),B=r.useCallback((d,C)=>{l(d),D.count(P.COT_SUMMARIZER,d?"expand":"collapse",[{key:"is_streaming",value:String(t)},{key:"source",value:C}]),A.logEventWithStatsig(d?"CoT Expanded":"CoT Collapsed",d?"chatgpt_cot_expanded":"chatgpt_cot_collapsed",{is_streaming:String(t),source:C})},[t]),pe=r.useCallback(()=>{B(!0,"chunk")},[B]),xe=r.useCallback((d,C)=>{g(q=>{const Q=[...q];return Q[d]=C,Q})},[]);return r.useEffect(()=>{u||i<0||A.logEventWithStatsig(n?"Streamed CoT Chunk Viewed":"Streamed CoT Chunk Ignored",n?"chatgpt_streamed_cot_chunk_viewed":"chatgpt_streamed_cot_chunk_ignored")},[i,u,n,t]),u&&!N?null:a.jsxs(a.Fragment,{children:[a.jsx(Mt,{}),a.jsxs("div",{className:"relative my-1 min-h-6",children:[t&&(!N||W)&&a.jsx(y.div,{className:"loading-shimmer text-token-text-secondary absolute top-0 select-none",initial:t&&{translateX:-8,opacity:0},animate:{translateX:0,opacity:1},transition:{ease:"easeInOut",duration:ae},children:a.jsx(_,{id:"hgnsat",defaultMessage:"Thinking"})}),N&&a.jsxs(y.div,{className:S("relative flex max-w-[calc(0.8*var(--thread-content-max-width,40rem))] origin-top-left flex-col gap-2 overflow-x-clip",W&&"bg-token-main-surface-primary border-token-border-default mx-[calc(--spacing(-2)-1px)] -my-[1px] box-content rounded-2xl border bg-clip-padding px-5 py-4 @max-3xl:-top-2 @3xl:-start-3 @3xl:-top-4"),initial:t&&{opacity:0,scale:.85},animate:{opacity:1,scale:1},transition:{ease:"easeOut",duration:ae},children:[a.jsx(ze,{latestHeadline:F&&E(s,F,u),latestChunk:F,counters:p,onToggleExpanded:()=>B(!n,"header"),isExpanded:n,isExpandDisabled:k.length<2,isComplete:u}),a.jsx(J,{children:me&&a.jsx(y.div,{className:"relative z-0",initial:u?{opacity:0,height:0,overflowY:"hidden"}:!1,animate:{opacity:1,height:he},exit:{height:0,opacity:0,pointerEvents:"none",overflowY:"hidden",filter:u?"blur(8px)":void 0,translateY:-I},transition:xt,children:a.jsx("div",{className:"relative flex h-full flex-col",style:{gap:$,margin:`${z}px 0`},children:a.jsx(J,{children:Y.map(([d,C],q)=>a.jsx(ht,{index:d,chunk:C,isLast:Y.length-1===q,onClick:pe,onAnimationComplete:ge,onMeasure:xe,isAnimationComplete:u,isExpanded:n,showBullet:n},d))})})})})]})]})]})};function yt(t){return t?.type===c.Thought?Math.min(3e3,1e3+t.thought.content.length*3.5):1200}function vt(t){return t?.type===c.Thought?500:0}function wt(t,e){const s=r.useRef(null),o=Se(t),n=r.useCallback(()=>{if(s.current!=null){const l=performance.now()-s.current;D.hist(P.COT_SUMMARIZER,"cot_chunk_display_time",void 0,l)}},[o]);r.useEffect(()=>{if(e){n();return}t!==-1&&(n(),s.current=performance.now())},[t,e,n])}function Mt(){return a.jsx(y.div,{className:"absolute flex h-8 w-3 origin-center items-center justify-center",initial:{scale:1,opacity:1},animate:{scale:0,opacity:0},transition:{ease:"easeInOut",duration:.2},children:a.jsx("div",{className:"bg-token-text-primary h-3 w-3 rounded-full"})})}export{Lt as CoT,Ct as CoTChunks};
//# sourceMappingURL=esy9xppmoo49xb0b.js.map
