import{P as N,f as m,c as M,s as w}from"./msp412gwqdn605it.js";import{dO as $,dP as x,dQ as b,dR as C}from"./jn7p98x7qxquz26a.js";class f{constructor(t,e,n={}){this.match=t,this.match=t,this.handler=typeof e=="string"?y(e):e,this.undoable=n.undoable!==!1,this.inCode=n.inCode||!1}}function y(a){return function(t,e,n,r){let l=a;if(e[1]){let o=e[0].lastIndexOf(e[1]);l+=e[0].slice(o+e[1].length),n+=o;let i=n-r;i>0&&(l=e[0].slice(o-i,o)+l,n=r)}return t.tr.insertText(l,n,r)}}const T=500;function R({rules:a}){let t=new N({state:{init(){return null},apply(e,n){let r=e.getMeta(this);return r||(e.selectionSet||e.docChanged?null:n)}},props:{handleTextInput(e,n,r,l){return v(e,n,r,l,a,t)},handleDOMEvents:{compositionend:e=>{setTimeout(()=>{let{$cursor:n}=e.state.selection;n&&v(e,n.pos,n.pos,"",a,t)})}}},isInputRules:!0});return t}function v(a,t,e,n,r,l){if(a.composing)return!1;let o=a.state,i=o.doc.resolve(t),d=i.parent.textBetween(Math.max(0,i.parentOffset-T),i.parentOffset,null,"￼")+n;for(let s=0;s<r.length;s++){let u=r[s];if(i.parent.type.spec.code){if(!u.inCode)continue}else if(u.inCode==="only")continue;let c=u.match.exec(d),p=c&&u.handler(o,c,t-(c[0].length-n.length),e);if(p)return u.undoable&&p.setMeta(l,{transform:p,from:t,to:e,text:n}),a.dispatch(p),!0}return!1}new f(/--$/,"—");new f(/\.\.\.$/,"…");new f(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(")$/,"“");new f(/"$/,"”");new f(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(')$/,"‘");new f(/'$/,"’");function I(a,t,e=null,n){return new f(a,(r,l,o,i)=>{let d=e instanceof Function?e(l):e,s=r.tr.delete(o,i),u=s.doc.resolve(o),c=u.blockRange(),p=c&&m(c,t,d);if(!p)return null;s.wrap(c,p);let g=s.doc.resolve(o-1).nodeBefore;return g&&g.type==t&&M(s.doc,o-1)&&(!n||n(l,g))&&s.join(o-1),s})}function k(a,t,e=null){return new f(a,(n,r,l,o)=>{let i=n.doc.resolve(l),d=e instanceof Function?e(r):e;return i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),t)?n.tr.delete(l,o).setBlockType(l,l,t,d):null})}class h extends ${static isAtStart(t,e){return t.selection.empty?e!==void 0?e.endOfTextblock("backward",t):t.selection.$anchor.parentOffset>0:!1}static headingLevelCommandBuilder(t,e,n){return(r,l,o)=>{if(n&&!h.isAtStart(r,o))return!1;const{$anchor:i}=r.selection,d=i.parent;if(d.type.name!=="heading")return!1;const s=d.attrs.level+e;if(s<0||s>6)return!1;if(l===void 0)return!0;const u=i.before(i.depth);return s>0?l(r.tr.setNodeMarkup(u,void 0,{level:s})):l(r.tr.setNodeMarkup(u,t.nodes.paragraph)),!0}}dependencies(){return[new x,new b]}unistNodeName(){return"heading"}static proseMirrorNodeName(){return"heading"}proseMirrorNodeSpec(){return{attrs:{level:{default:1}},content:"text*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM(t){return["h"+t.attrs.level.toString(),0]}}}proseMirrorInputRules(t){return[k(/^\s{0,3}(#{1,6})\s$/,t.nodes[this.proseMirrorNodeName()],e=>({level:e[1].length}))]}proseMirrorKeymap(t){const e={Tab:h.headingLevelCommandBuilder(t,1,!1),"#":h.headingLevelCommandBuilder(t,1,!0),"Shift-Tab":h.headingLevelCommandBuilder(t,-1,!1)};for(let n=1;n<=6;n++)e[`Shift-Mod-${n.toString()}`]=w(t.nodes[this.proseMirrorNodeName()],{level:n});return e}unistNodeToProseMirrorNodes({node:t,schema:e,convertedChildren:n,attrs:r}){const{depth:l}=t;return C(this.proseMirrorNodeName(),e,n,{...r,level:l})}proseMirrorNodeToUnistNodes(t,e){return[{type:this.unistNodeName(),depth:t.attrs.level,children:e}]}}export{h as H,f as I,R as i,k as t,I as w};
//# sourceMappingURL=fqps1a3pxo0q8nxi.js.map
