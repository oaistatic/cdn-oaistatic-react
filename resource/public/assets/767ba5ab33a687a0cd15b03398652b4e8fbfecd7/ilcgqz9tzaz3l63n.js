import{r as u,aj as G,l as V,u as B,j as n,a9 as f,aa as q}from"./j12so9ru57hpoz1y.js";import{iz as K,iA as X,iB as Y,C,iC as J,iD as Q,iE as $,iF as Z,iG as tt,iH as et,iI as st,hc as at,iJ as ot,iK as nt,iL as it,iM as N,iN as F,ha as rt,iO as ct,iP as dt,gK as lt,iQ as ut,u as ht,iR as _,U as W,iS as M}from"./jn7p98x7qxquz26a.js";import{gW as S,L as j,at as mt,W as b,au as pt,X as gt,gm as ft,dk as xt,c7 as Ct,gs as vt,gX as wt}from"./j5zd9vs1l0bwsjqa.js";import{L as Tt,u as bt}from"./fmw3vtt8y90emgda.js";import{T as yt}from"./pcetty3qfpqopskj.js";import{g as It}from"./btagl6w1gub4aw61.js";import"./cx64odxk6g9mmfxk.js";import"./01yrv2o49ye0ebr7.js";import"./epsg05et2lobrl6v.js";import"./gh4kfg6qlx7b3ikk.js";import"./bmq33amvrfzjcyfd.js";import"./msp412gwqdn605it.js";import"./ok8fnoyzbnoyk9qs.js";import"./ng20n9f2et03jm61.js";import"./dyn54m8afmkkz42o.js";import"./ik1mvke1rzg5h1fr.js";import"./gld03raz97um5arz.js";import"./di9gukc1ozd2hjw9.js";import"./mbbi7ghgl3dsk97a.js";import"./doknjlw48az0ww3q.js";import"./j2m3ef69iou998eo.js";import"./egjzck8f21ldiiq8.js";import"./n5601invkykfg1ys.js";import"./b0v1yruiy44zd1p9.js";import"./owhjnpwqw9ddu7v0.js";import"./d8hi8vzea1zd4sdu.js";import"./hxt8zt4ovcs39phn.js";import"./mx9tryggoikmqll4.js";const D="oai/apps/canmoreSidebarWidth",St=.25,Et=400,O=400;function L(t){return t-Et}function y(t,s){return G(O,L(t),s??St*t)}function At(){const t=S.useState(S.selectWindowWidth),s=y(t,K(j.DANGER_SECRET_FOLDERS_ONLY_getItem(D))),a=k(),[e,i]=u.useState(s);u.useEffect(()=>{(e<O||e>L(t))&&i(y(t,e))},[t]);function o(c){i(x=>y(t,x+=c.delta.x))}function r(c){i(c),j.DANGER_SECRET_FOLDERS_ONLY_setItem(D,c)}function l(){const c=y(t,void 0);r(c)}const m=`calc(100vw - ${e}px)`;return a?{chatWidth:e,canvasWidth:t-e,canvasWidthCalc:m,viewportWidth:t,handleDrag:o,handleDoubleClick:l,persist:r}:{chatWidth:0,canvasWidth:t,canvasWidthCalc:"100vw",viewportWidth:t,handleDrag:()=>{},handleDoubleClick:()=>{},persist:()=>{}}}function k(t){const s=S.useState(S.selectWindowWidth);return(t??s)>1e3}const A="sharedCanvas";function Rt(){const[t,s]=V(),a=t.get(A),e=B();u.useEffect(()=>{const i=a&&X.createRemixTempTextdoc(a,e);if(!i)return;requestAnimationFrame(()=>{Y(i)});const o=new URLSearchParams(t);o.delete(A),s(o);const r=new URL(window.location.href);r.searchParams.delete(A),history.replaceState(null,"",r)},[a,t,s,e])}function Nt(t,s){let a;return s?.type===C.Textdoc&&(s.textdocId.startsWith(J)||(a={type:"canvas_textdoc",id:s.textdocId})),Q(t,{promptMessage:{metadata:{open_in_canvas_view:a}}})}const P=({isFullScreen:t=!1,clientThreadId:s,focusedObject:a,onClose:e,isAnimating:i=!1,width:o})=>{const{setTargetedContent:r}=$(),l=u.useRef(!1);if(u.useEffect(()=>(l.current&&r(void 0),l.current=!0,()=>{l.current=!1}),[a]),a==null)return null;switch(a.type){case C.Textdoc:return n.jsx(yt,{isFullScreen:t,onClose:e,clientThreadId:s,focusedTextdoc:a,isAnimating:i,width:o});case C.ADAVisualization:return null}},_t=300,Wt=t=>{switch(t?.type){case C.Textdoc:return t.textdocId;default:return null}};function Mt(t,s){const[a,e,i,o]=mt(t,d=>[b.getRequestId(d),b.getConversationLastTurn(d),b.isMessageTurnEnded(d),b.getVariantIds(d).length>1]),r=pt(a),l=Z(),[m,c]=u.useMemo(()=>{if(e&&o)return[void 0,null];if(s===!0)return[void 0,null];let d;return!i&&e&&(d=gt(e.messageGroups,p=>p.type!==ft)),jt({groupedMessage:d,isRequestActive:r,latestTextdocId:l})},[i,e,o,s,r,l]),x=c!=null,v=Wt(c),w=tt("canvas");u.useEffect(()=>{if(c&&m&&!et()&&(w(),st(c,m),c.type===C.Textdoc)){const{textdocId:d}=c,p=It(d);at(document.getElementById(p))}},[x,v])}function jt({groupedMessage:t,isRequestActive:s,latestTextdocId:a}){switch(t?.type){case xt.Canmore:{const[e,i]=t.messages;if(!ot(e))break;const o=nt(s,e,i??null),r=o.textdocId??a;if(r&&(o.function===it.CreateTextdoc?(o.content??"").length>_t||o.status===N.WAITING:o.status===N.STREAMING))return[o.messageId,{type:C.Textdoc,textdocId:r}];break}}return[void 0,null]}const Dt=260,I={type:"spring",bounce:.12,duration:.64},Ft={type:"spring",bounce:0,duration:.58},Ot=({clientThreadId:t,focusedObject:s,onClose:a})=>{const{chatWidth:e,canvasWidthCalc:i,handleDrag:o,handleDoubleClick:r,persist:l}=At(),[m,c]=u.useState(!0),[x,v]=u.useState(!1),w=ct(({rect:h})=>h),{windowHeight:d,windowWidth:p}=vt(h=>h,{windowWidth:0,windowHeight:0});let g=w??{top:0,left:e,width:p-e,height:d},R=!1;if(w&&(g.top<0||g.top+g.height>d)){R=!0;const h={width:(p-e)*.75,height:d*.75};g={top:d/2-h.height/2,left:(p-e-h.width)/2+e,width:h.width,height:h.height}}const T=w?.borderRadius,E=dt(),H=E?.history!=null||E?.showChangesAtVersion!=null,U=lt();return n.jsxs(n.Fragment,{children:[H&&n.jsx(Tt,{onClick:()=>ut(E.textdocId),zIndexKey:"chatOverlay"}),n.jsxs(f.div,{initial:{marginRight:U?0:-Dt},animate:{marginRight:0},transition:Ft,children:[n.jsx(f.div,{initial:{opacity:1},animate:{opacity:0},exit:{opacity:[1,0]},transition:{...I,delay:.22},className:"bg-token-main-surface-primary pointer-events-none absolute start-0 top-0 z-20 h-full w-full"}),n.jsx(f.div,{className:"relative z-20 h-full",style:{width:i},exit:{width:0},transition:{type:"spring",bounce:0,duration:.1}})]}),n.jsx(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"pointer-events-none absolute start-0 top-0 z-10 h-full w-full bg-black/[0.025] dark:bg-transparent"}),n.jsx(f.div,{className:"absolute start-0 z-20 h-full overflow-hidden transition-shadow",initial:{borderRadius:T,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)",opacity:R?0:1,x:g.left,y:g.top,height:g.height,width:g.width},animate:{opacity:1,x:e,y:0,width:i,height:d,borderRadius:0,boxShadow:"0px 0px 18px rgba(0,0,0,0.075)"},exit:{scale:.64,opacity:0,filter:"blur(12px)",transition:{opacity:{duration:.14,bounce:.1}},borderRadius:T,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)"},transition:x?{duration:0}:I,onAnimationComplete:()=>c(!1),children:n.jsx(f.div,{className:"dark:border-token-border-medium h-full overflow-hidden border-s border-gray-100",initial:{borderRadius:T},animate:{borderRadius:0},exit:{borderRadius:T},transition:I,children:n.jsxs("div",{className:"h-full",children:[n.jsx(f.div,{drag:"x",className:"bg-token-text-quaternary absolute start-[-2px] z-10 h-full w-[4px] cursor-ew-resize opacity-0",whileHover:{opacity:.5},whileDrag:{opacity:.75,width:"8px",left:"-4px"},transition:{type:"tween",duration:.1},style:{x:0,y:0,transform:"translateX(0px)"},dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:{left:0,right:0,top:0,bottom:0},onPointerDown:()=>v(!0),onPointerUp:()=>v(!1),onDrag:(h,z)=>o(z),onDragEnd:()=>{v(!1),l(e)},onDoubleClick:()=>r()}),x&&n.jsx("div",{className:"absolute inset-0 z-10"}),n.jsx(P,{onClose:a,clientThreadId:t,isAnimating:m,focusedObject:s,width:p-e})]})})})]})},Lt=u.memo(Ot),kt=({clientThreadId:t,focusedObject:s,onClose:a})=>n.jsx(wt,{children:n.jsx(f.div,{className:"fixed inset-0 z-40 overflow-hidden shadow-xl md:border-gray-100 md:dark:border-gray-700",initial:{scale:.98},animate:{scale:1},transition:I,children:n.jsx(P,{isFullScreen:!0,clientThreadId:t,focusedObject:s,onClose:a})})}),Pt=({clientThreadId:t,overrideWidth:s,isAutoFocusDisabled:a=!1})=>{const e=k(s),i=bt();Mt(t,a||i),Rt();const o=ht();u.useEffect(()=>{F()},[t]);const r=o&&(e?n.jsx(Lt,{clientThreadId:t,onClose:M,focusedObject:o},"canvas-sidebar"):n.jsx(kt,{clientThreadId:t,onClose:M,focusedObject:o},"canvas-modal"));u.useEffect(()=>{if(o)return _(m=>Nt(m,o)),()=>_(null)},[o]);const l=r!=null;return u.useEffect(()=>(W.setActiveStageSidebar(l),()=>{l&&W.setActiveStageSidebar(!1)}),[l]),n.jsx(q,{children:r},t)},pe=t=>{const s=u.useRef(null);return n.jsx(Ct,{ref:s,onError:(a,e)=>{F(),setTimeout(()=>{s.current?.resetErrorBoundary()}),rt.logError("Error boundary hit",a,{componentStack:e})},name:"canmore-focused-view",children:n.jsx(Pt,{...t})})};export{pe as CanvasFocusedViewManager};
//# sourceMappingURL=ilcgqz9tzaz3l63n.js.map
