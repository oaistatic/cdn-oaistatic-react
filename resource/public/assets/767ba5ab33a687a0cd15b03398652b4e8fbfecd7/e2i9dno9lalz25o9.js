import{r as c,j as e,M as y,a9 as L}from"./j12so9ru57hpoz1y.js";import{W as j}from"./n0tk3xne532h7ges.js";import{aT as v,aU as b,aV as T,aW as R,ak as E,aX as F,aK as z,aM as D,aY as _,aZ as A,a_ as H,a$ as U,b0 as W}from"./jn7p98x7qxquz26a.js";import{P as p,a as q}from"./01yrv2o49ye0ebr7.js";import{v as k,R as O,aQ as X}from"./j5zd9vs1l0bwsjqa.js";const K={positive:z,negative:D,neutral:_,mixed:_},Q={positive:"Positive",negative:"Negative",neutral:"Mixed",mixed:"Mixed"};function se({clientThreadId:t,messageId:i,product:r,trackContentReferenceEvent:a,onProductEntityUpdated:n}){const{productInfo:o,isLoading:s,isCached:m}=Y({clientThreadId:t,messageId:i,product:r}),[u]=c.useState(m),d=c.useRef(!1);return c.useEffect(()=>{n&&o.productEntity&&n(o.productEntity),o.productEntity&&!d.current&&(d.current=!0,a("Product Sidebar Entity Loaded","product_sidebar_entity_loaded","product_entity"))},[o.productEntity,n,a]),A(),e.jsx("div",{children:s?e.jsxs("div",{className:"flex flex-col gap-4 px-6 pb-6",children:[e.jsx(p,{index:0,width:50,heightSize:"sm"}),e.jsxs(q,{children:[e.jsx(p,{index:1,width:100,heightSize:"sm"}),e.jsx(p,{index:2,width:100,heightSize:"sm"}),e.jsx(p,{index:3,width:30,heightSize:"sm"})]})]}):e.jsxs("div",{className:"bg-token-bg-primary flex flex-col",children:[e.jsx(Z,{contentReference:o.productRationale,trackContentReferenceEvent:a,disableAnimation:u}),e.jsx($,{contentReference:o.productReviews,trackContentReferenceEvent:a,disableAnimation:u}),!1]})})}function Z({contentReference:t,trackContentReferenceEvent:i,disableAnimation:r}){const a=c.useRef(!1);return c.useEffect(()=>{t&&!a.current&&(a.current=!0,i("Product Sidebar Rationale Loaded","product_sidebar_rationale_loaded","product_rationale"))},[t,i]),t?e.jsx(v,{title:e.jsx(y,{id:"XgsZPF",defaultMessage:"Why you might like this"}),children:e.jsx("div",{className:"text-sm",children:e.jsx(b,{isDisabled:r,children:e.jsxs(T,{tag:"p","data-start":0,"data-end":t.rationale.length,children:[e.jsx("span",{className:"me-1",children:t.rationale}),t.grouped_citation&&e.jsx(j,{webpageItem:t.grouped_citation,trackContentReferenceEvent:i,analyticsMetadata:{section:"product_rationale",section_location:"sidebar"},isLastHovered:!0,noMarginStart:!0})]})})})}):null}function $({contentReference:t,trackContentReferenceEvent:i,disableAnimation:r}){const a=c.useRef(!1);c.useEffect(()=>{t&&!a.current&&(a.current=!0,i("Product Sidebar Reviews Loaded","product_sidebar_reviews_loaded","product_reviews"))},[t,i]);function n(s){return new URL(s).hostname.replace(/^www\./,"")}function o(s){return t?s.cite?t.cite_map[s.cite]?.url:s.cite_url:null}return t?e.jsx(v,{title:e.jsx(y,{id:"p8XHcJ",defaultMessage:"What people are saying"}),children:e.jsxs("div",{className:"flex flex-col gap-6",children:[t.summary&&e.jsx(b,{isDisabled:r,children:e.jsx(R,{className:"-mb-2 text-sm",children:t.summary})}),t.reviews.map((s,m)=>{const u=K[s.sentiment??"neutral"],d=o(s);return e.jsxs(L.div,{className:"relative flex flex-col gap-2",...!r&&{initial:{opacity:0},animate:{opacity:1},transition:{duration:.4}},children:[e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[e.jsx(E,{url:d??"",className:"h-8 w-8 rounded-full",size:128,minSize:16,fallback:e.jsx(F,{className:"text-token-text-tertiary"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"text-sm font-semibold",children:s.source}),e.jsxs("div",{className:"text-token-text-secondary flex flex-row gap-1 text-xs",children:[e.jsx("div",{children:d?n(d):""}),s.sentiment&&e.jsxs(e.Fragment,{children:["Â·",e.jsx(u,{className:"icon-sm text-token-text-secondary"}),Q[s.sentiment]]})]})]})]}),e.jsxs("div",{className:"text-sm",children:[s.theme&&e.jsx("div",{className:"font-semibold",children:s.theme}),e.jsx("span",{className:"me-1",children:s.summary}),e.jsx(J,{cite:s.cite,contentReference:t,trackContentReferenceEvent:i})]})]},m)})]})}):null}function J({cite:t,contentReference:i,trackContentReferenceEvent:r,analyticsMetadata:a}){const{cite_map:n}=i,o=t?n[t]:null;return o?e.jsx(j,{webpageItem:o,trackContentReferenceEvent:r,analyticsMetadata:{...a,section:"product_reviews",section_location:"sidebar"},isLastHovered:!0,noMarginStart:!0}):null}async function*V({conversationId:t,messageId:i,productQuery:r,productLookupData:a,evalPreset:n},o){const s=W(`${X}/search/product_info`,{method:"POST",headers:{...O.getAuthedHeaders({isAuthOptional:!0}),"Content-Type":"application/json"},body:{conversation_id:t,message_id:i,eval_preset:n,product_query:r,...a?{product_lookup_data:a}:{}},signal:o});for await(const m of s)"data"in m&&(yield m.data)}const g=new Map;function Y({clientThreadId:t,messageId:i,product:r}){const a=k(t)??t,n=[a,i,r.title].join(":"),[o,s]=c.useState(g.get(n)??{productReviews:void 0,productRationale:void 0,productEntity:void 0,__debug:void 0}),[m,u]=c.useState(!1),d=c.useRef(!1);return c.useEffect(()=>{async function S({conversationId:h,messageId:P,productQuery:N,productLookupData:w}){if(d.current)return;const x=H({namespace:U.ProductSidebar});try{d.current=!0,u(!0);const I=new URLSearchParams(window.location.search).get("product_reviews_eval_preset"),M=V({conversationId:h,messageId:P,productQuery:N,productLookupData:w,evalPreset:I});let l={productReviews:void 0,productRationale:void 0,productEntity:void 0,__debug:void 0};for await(const f of M)f.type==="product_reviews"?(l={...l,productReviews:f},x.logTiming("time_to_first_review")):f.type==="product_rationale"?(l={...l,productRationale:f},x.logTiming("time_to_rationale")):f.type==="product_entity"?(l={...l,productEntity:f},x.logTiming("time_to_product_entity")):f.type==="__debug"&&(l={...l,__debug:f}),["product_reviews","product_rationale"].includes(f.type)&&u(!1),s(l);g.set(n,l)}finally{d.current=!1,u(!1),x.logTiming("sidebar_loaded")}}(async function(){g.has(n)||a&&i&&await S({conversationId:a,messageId:i,productQuery:r.title,productLookupData:r.product_lookup_data})})()},[i,r.title,r.product_lookup_data,n,a]),{productInfo:o,isLoading:m,isCached:g.has(n)}}export{se as P,Z as a,$ as b};
//# sourceMappingURL=e2i9dno9lalz25o9.js.map
