import{j as e,f as L,h as I,d as W,r as i,M as b,a6 as R,a5 as F,L as H,a9 as S}from"./cs2gapsc2bulabhw.js";import{B as A}from"./jyst6rnznipaffx7.js";import{b as D,c as B}from"./f2cwocui2o4rh90z.js";import{P as O}from"./do5nmvaddt7ak8xi.js";import{k7 as U,cL as V,fw as z,h as G,i9 as $,fG as q,a$ as Q,b0 as _,d1 as J,fx as K,ft as X,iF as M}from"./pduvb49qgyq1mqhk.js";import{f as y,aV as C,L as Y,B as Z,c as ee,fc as se,t as te,aQ as ae,u as P}from"./eb6xg52mym6rhnsh.js";import{b as ne}from"./3s6z6so3p651ma5p.js";import{W as re}from"./ltl83crjtn7g9n8e.js";import{b as oe,a as ie,c as ce,h as le}from"./gn8hoowjr3gjt16v.js";import{W as de}from"./kla29aasg3zke6fd.js";import{T as me}from"./m51yqcd3jsaldp76.js";import{c as g,d as ue,j as xe,l as fe}from"./flul5lgejanvmzis.js";import{S as he}from"./ix38e110ffew427m.js";import{I as pe}from"./m4uwihyvndo7xd88.js";import{a as ge,b as ke}from"./ke1leuxpoxd60g1m.js";import{u as je}from"./hdzunc7lvo2i8v4s.js";function ve({disabled:o,children:n}){return o?e.jsx("div",{className:"pointer-events-none opacity-50 select-none","aria-hidden":"true",tabIndex:-1,inert:!0,children:n}):n}function be(){const o=L(),n=g(({tasksFilter:d})=>d),x=g(({setTasksFilter:d})=>d),h=y(),c=I(),l=W(),p=C(h,"2665240312"),u=i.useCallback(d=>{x(d);const k=new URLSearchParams(c.search);k.set("tab",d==="archived"?"archived":"all"),l({pathname:c.pathname,search:k.toString()},{replace:!0})},[x,c,l]);return e.jsx("div",{className:"border-token-border-primary mt-4 flex w-full items-center border-b align-middle md:mt-6",children:p&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(me,{currentTab:n,onChange:u,withUnderline:!0,tabs:[{label:o.formatMessage({id:"wham.whamTasksHeader.all",defaultMessage:"Tasks"}),key:"current"},{label:o.formatMessage({id:"wham.whamTasksHeader.archived",defaultMessage:"Archive"}),key:"archived"}]})})})}function we(){const o=L(),n=g(({tasksFilter:r})=>r),{data:x,isLoading:h,error:c,fetchNextPage:l,hasNextPage:p,isFetchingNextPage:u,refetch:d,isPending:k}=ue({refetchOnMount:!0}),m=x?.pages.flatMap(r=>r.items??[])??[],T=g(r=>r.pendingTaskIds),j=m.length>0,[a,v]=i.useState(null),t=n==="archived"?[]:Array.from(Object.entries(T)).filter(([r,s])=>!m.some(f=>f.id===s)).map(([r])=>r).reverse(),w=m.length===0&&t.length===0;return e.jsx("div",{className:"flex flex-col justify-center pt-2",children:h&&!j?e.jsx("div",{className:"mt-4 flex h-full w-full items-center justify-center",children:e.jsx(Y,{})}):e.jsxs(e.Fragment,{children:[w&&e.jsx(e.Fragment,{children:c?e.jsxs("div",{className:"mt-6 flex w-full flex-col items-center justify-center gap-2 text-sm",children:[e.jsx("div",{className:"text-token-text-error",children:e.jsx(b,{id:"wham.whamTasksSection.errorLoadingTasks",defaultMessage:"Error loading tasks"})}),e.jsx(Z,{color:"secondary",onClick:()=>d(),children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(b,{id:"wham.whamTasksSection.retry",defaultMessage:"Retry"}),e.jsx(he,{className:"icon-xs"})]})})]}):e.jsx("div",{className:"mt-6 flex h-full w-full items-center justify-center",children:e.jsx("div",{className:"text-token-text-secondary text-sm",children:n==="current"?o.formatMessage({id:"wham.whamTasksSection.noActiveTasks",defaultMessage:"No active tasks"}):o.formatMessage({id:"wham.whamTasksSection.noArchivedTasks",defaultMessage:"No archived tasks"})})})}),n!=="archived"&&t.map(r=>e.jsx(ge,{},r)),m.map((r,s)=>e.jsx(ke,{index:s,taskListItem:r,hoveredIndex:a,onMouseEnter:()=>{v(s)},onMouseLeave:()=>v(null)},r.id)),e.jsx(pe,{isFetchingNextPage:u||k,hasNextPage:p??!1,fetchNextPage:l})]})})}const Te=i.memo(we);function Ne(){const o=y();return C(o,"3984934927")}function Se(){const{eligible:o,markAsViewed:n}=U(),x=g().environmentId,{data:h,isLoading:c}=xe(),l=h?.find(t=>t.id===x),p=h?.some(t=>t.setup.length>0)??!1,{data:u,isLoading:d}=fe(),k=u??!1,m=V(),T=z(),j=i.useMemo(()=>[{id:"step-1",link:"/codex/settings/environment/create",checked:!0,label:e.jsx(b,{id:"codex.onboarding.step-1",defaultMessage:"Set up your first environment"})},{id:"step-2",checked:k,label:e.jsx(b,{id:"codex.onboarding.step-2",defaultMessage:"Create your first task"})},{id:"step-3",checked:p,link:`/codex/settings/environment/${l?.id}/edit#setup-script`,label:e.jsx(b,{id:"codex.onboarding.step-3",defaultMessage:"Install dependencies for the ‘{environmentName}’ environment",values:{environmentName:l?.label}})}],[p,l,k]),a=j.every(t=>t.checked);i.useEffect(()=>{a&&n()},[a,n]);const v=m||!o||c||d||!l||a;return e.jsx(R,{children:v?null:e.jsx(F.div,{className:"fixed end-6 bottom-6 z-50",initial:{opacity:0},animate:{opacity:1},transition:{duration:T?1e-5:.5},children:e.jsxs("div",{className:"bg-token-bg-primary border-token-border-default flex w-[272px] flex-col gap-4 rounded-xl border p-4 shadow-xl",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(b,{id:"k3HHpd",defaultMessage:"Finish setting up Codex"})})}),e.jsx("div",{className:"flex flex-col gap-3",children:j.map((t,w)=>{const r=!t.checked&&j.filter(f=>!f.checked).length===1&&j.findIndex(f=>!f.checked)===w,s=e.jsxs("div",{className:"flex items-start gap-3 select-none",children:[e.jsx("div",{className:"mt-0.5",children:t.checked?e.jsx(G,{className:"icon-md text-token-text-tertiary"}):e.jsx("span",{className:"icon-md border-token-text-secondary inline-block h-4 w-4 rounded-full border bg-transparent"})}),e.jsx("span",{className:ee("text-sm",t.checked?"text-token-text-tertiary line-through":"text-token-text-primary"),children:t.label}),t.link&&!t.checked&&e.jsx($,{className:"icon-md text-token-text-primary"})]},t.id);return t.link&&!t.checked?e.jsx(H,{to:t.link,onClick:()=>{r&&n()},children:s},t.id):s})})]})})})}function ze(){const o=y(),n=q(),x=Ne(),h=Q(_.workspaceId),{eligible:c}=J(),l=K();je();const p=C(o,"547652119");return g(u=>u.showReactQueryDevtools),n?p?e.jsx(S,{to:"/codex/failwhale"}):l==="DISABLED"?e.jsx(S,{to:"/",replace:!0}):c?e.jsx(S,{to:"/codex/onboarding"}):e.jsxs(e.Fragment,{children:[e.jsx(A,{},h),!1,e.jsx(ne,{mobileHeaderRightContent:null,children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx(ie,{children:e.jsx(ce,{hideNotificationBell:!0})}),e.jsx(se,{children:e.jsx(ye,{})})]})})]}):x?e.jsx(oe,{}):e.jsx(S,{to:"/"})}const ye=()=>{const o=g(({setPromptDraft:s})=>s),n=g(({setTasksFilter:s})=>s),x=I(),h=g(s=>s.lastViewedTaskId),[c]=i.useState(!!h),[l,p]=i.useState(!1),u=i.useRef(c),d=i.useRef(null),k=y(),m=C(k,"1406552515"),T=g(({promptDraft:s})=>s),j=te(),a=i.useMemo(()=>j?new O(D()):new X,[j]);i.useEffect(()=>{a.setText(m?"":T)},[a,m]);const v=i.useRef(null),t=M(({setIsExpanded:s})=>s),w=M(s=>s.isExpanded),r=ae(a.store,({isFocused:s})=>s);return P(()=>{c&&t(!1)},[c]),P(()=>{const s=d.current;if(!s)return;const f=()=>{const N=s.scrollTop>0;if(p(N),u.current)return;const E=a.isEmpty()&&!r&&w&&N;u.current=E,t(!E)};return s.addEventListener("scroll",f),()=>s.removeEventListener("scroll",f)},[w,r,t,a]),i.useEffect(()=>a.subscribe("focus",()=>{u.current=!1}),[a]),i.useEffect(()=>a.subscribe("blur",s=>{s.relatedTarget instanceof HTMLElement&&v.current?.contains(s.relatedTarget)||l&&(u.current=!0,t(!1))}),[a,l,t]),i.useEffect(()=>a.subscribe("change",()=>{o(a.getCurrentText())}),[a,o]),i.useEffect(()=>{const s=new URLSearchParams(x.search),f=s.get("prompt");f&&a.setText(f);const N=s.get("tab");N==="archived"?n("archived"):N==="all"&&n("current")},[x.search,a,n]),e.jsxs(B.Provider,{value:a,children:[e.jsx("div",{className:"h-full w-full overflow-y-auto",ref:d,style:{scrollbarGutter:"stable"},children:e.jsxs("div",{className:"z-0 mx-auto flex w-full flex-col md:w-3xl",children:[e.jsx(de,{}),e.jsxs("div",{className:"bg-token-bg-primary sticky top-[1px] z-50 flex flex-col items-center",children:[e.jsx("h1",{className:"mb-8 pt-8 [@media(max-height:550px)]:hidden",children:e.jsx(b,{id:"wham.home.title",defaultMessage:"What are we coding next?"})}),e.jsx("div",{ref:v,className:"w-full max-md:px-3",children:e.jsx(ve,{disabled:m,children:e.jsx(re,{disableAutoFocus:c||m,isExpandedByDefault:!m,isBigBoxMode:!m,onSubmit:()=>{a.eraseContent(),o("")},onSuccess:()=>{le.set(s=>s+1)}})})}),e.jsx(be,{})]}),e.jsx(Te,{})]})}),e.jsx(Se,{})]})};export{ze as W};
//# sourceMappingURL=k868pwzyuheqruix.js.map
