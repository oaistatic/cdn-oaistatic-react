import{R as C,r as u,j as s,M as g,a5 as f,a6 as y,f as T}from"./cs2gapsc2bulabhw.js";import{cX as R,bD as _,aC as A,aS as M,ab as S,gw as b,fZ as I,c as m,af as G,en as B}from"./eb6xg52mym6rhnsh.js";import{T as E}from"./mzfvohm008secgod.js";import{eM as q,ba as z,eN as H,eO as L}from"./pduvb49qgyq1mqhk.js";import{C as O}from"./j0zvljvurep0tkuq.js";import{c as D}from"./jt4cmjygjv1t1unw.js";import"./nhgg43vfy9ih4vl5.js";import"./fi1xw3fnwortmtrb.js";import"./jy1u8exw8iz2slve.js";import"./kpz7qev108jf94tz.js";import"./pbk0s8tey8blca1e.js";import"./n3cijkf5teq8hl4t.js";import"./f76gy0b8ieo4s693.js";import"./gy64pge8qevmvg7e.js";import"./hvq69vo4kfwx2bys.js";import"./dv3d7908pzpkjndg.js";import"./oj5g7kg81kf2ot3b.js";import"./j3y9idfzwnd1pc4w.js";import"./e95x0gs5di7mq1tw.js";import"./gnq9lz7yxp2ydive.js";import"./kyxm5nmqkee0ozbm.js";import"./abn9sjdb7psxnmu1.js";import"./c4jo9vhmn844acg2.js";import"./iop0mej0v36g33vx.js";import"./ggve90in2x9hqouv.js";import"./pc2givv05uuq8g6l.js";import"./pm0gb7r9jflnjr23.js";import"./o12gjyxv9optjnri.js";import"./o0c2m6gntt3um3fq.js";import"./do5nmvaddt7ak8xi.js";function V({turn:e,turnIndex:t,clientThreadId:n,hasActiveRequest:o,isFinalTurn:r}){return s.jsx(O,{turnIndex:t,clientThreadId:n,groupedMessagesToRender:e.messageGroups,allGroupedMessages:e.messageGroups,allMessages:e.messages,isUserTurn:e.role==="user",isFinalUserTurn:!1,isCompletionRequestInProgress:!1,isFeedbackEnabled:!1,isFinalTurn:r,hasActiveRequest:o,onRequestCompletion:()=>{}})}function U({messages:e,hasActiveRequest:t,clientThreadId:n}){const o=u.useMemo(()=>{if(n)return null;const c=R();return _.initThread(c,{kind:A.PrimaryAssistant}),c},[]),r=n??o,x=u.useMemo(()=>{const c=M(r);if(c&&r===n){let i=[];for(const h of e){const p=S.findNode(c,({message:N})=>h.id===N.id);p&&(i=b(i,p.message))}return i}const{allConversationMessages:a,threadResponse:l}=D(e);_.updateThreadFromServer(r,l);let d=[];for(const i of a)d=b(d,i.message);return d.filter(i=>i.role!=="root")},[e,r,n]);return s.jsx("div",{className:"space-y-2",children:x.map((c,a)=>s.jsx(V,{turn:c,turnIndex:a,clientThreadId:r,hasActiveRequest:t,isFinalTurn:a===x.length-1},c.messages[0].id))})}const F=C.memo(U),K=u.memo(E,(e,t)=>e.sharedTextdoc.sharedTextdocId===t.sharedTextdoc.sharedTextdocId&&e.showHeader===t.showHeader&&e.disableNetworkRequests===t.disableNetworkRequests&&e.unsafeAllowAllNetworkRequests===t.unsafeAllowAllNetworkRequests&&e.disablePermissions===t.disablePermissions);function k({children:e,className:t,fullscreen:n}){const o=u.useRef(null),[r,x]=u.useState(!1),a=B()?"#353535":"#fff";return u.useEffect(()=>{const l=o.current;if(!l)return;const d=()=>x(l.scrollHeight>l.clientHeight);d();const i=new ResizeObserver(d);return i.observe(l),()=>{i.disconnect()}},[e]),s.jsxs("div",{ref:o,className:m(!n&&"relative",t,!r&&"pb-2"),children:[e,!n&&r&&s.jsx("div",{className:"pointer-events-none absolute start-0 end-0 bottom-0 h-40",style:{background:`linear-gradient(to top, ${a}, transparent)`}})]})}function Be(){return s.jsx("div",{className:"w-full",children:s.jsx("div",{className:"bg-token-main-surface-secondary mx-auto block h-[120px] rounded-3xl",children:s.jsx(I,{})})})}const j={deep_research:s.jsx(L,{title:"Deep Research",className:"h-[16px] w-[16px]"}),canvas:s.jsx(H,{title:"Canvas",className:"h-[16px] w-[16px]"}),image:s.jsx(z,{title:"Image",className:"h-[16px] w-[16px]"}),sora:s.jsx(q,{title:"Sora",className:"h-[16px] w-[16px]"})},W={deep_research:"Deep Research",canvas:"Canvas",image:"ImageGen",sora:"Sora"},X=({icon:e,label:t})=>s.jsxs("div",{className:"flex items-center gap-1 rounded-full bg-white/80 px-2 py-1 text-xs text-black backdrop-blur-xs dark:bg-black/50 dark:text-white",children:[e,s.jsx("span",{className:"font-semibold",children:t})]}),Ee=({tags:e,badgeLabels:t})=>{const n=e.filter(o=>!!j[o]);return n.length===0?null:s.jsx("div",{className:"absolute end-3 top-3 z-10 flex gap-2",children:n.map(o=>s.jsx(X,{icon:j[o],label:t?.[o]??(W[o]||o)},o))})};function Y({url:e,attachment_width:t,attachment_height:n,isFullscreen:o}){return s.jsx("video",{className:m(o?"mx-auto block max-h-screen max-w-full rounded-none object-contain":"mx-auto block w-full rounded-3xl object-cover object-center"),style:{aspectRatio:t/n},src:e,playsInline:!0,autoPlay:!0,muted:!0,loop:!0})}const Z=u.memo(Y);function $({attachment:e,isFullscreen:t,isInline:n,isComposer:o}){return s.jsx("div",{className:m(t&&"flex h-screen items-center justify-center",t&&"rounded-none",n&&"rounded-3xl",o&&"mx-24 rounded-3xl"),children:e.generation_type==="video_gen"?s.jsx(Z,{url:e.url,attachment_width:e.width,attachment_height:e.height,isFullscreen:t,isInline:n}):s.jsxs("div",{className:"relative",children:[s.jsx("img",{className:m(t?"mx-auto block max-h-screen max-w-full rounded-none object-contain":"mx-auto block rounded-3xl object-cover object-center"),style:{aspectRatio:e.width/e.height},src:e.url,alt:e.kind}),e.output_blocked&&s.jsxs("div",{className:"text-token-text-error absolute start-0 bottom-0 flex h-1/4 w-full items-center justify-center gap-1 bg-transparent text-xs font-medium",children:[s.jsx(G,{className:"text-red-500"}),s.jsx(g,{id:"post-tree-attachment-output-blocked",defaultMessage:"Blocked by moderation"})]})]})})}const J=u.memo($);function Q({url:e,isFullscreen:t,isInline:n,isComposer:o,isUnfurl:r}){const x=T();return s.jsx("div",{className:m(t&&"flex h-screen items-center justify-center",t&&"rounded-none",n&&"rounded-3xl",o&&"mx-24 rounded-3xl",r&&"h-full w-full"),children:s.jsx("img",{src:e,className:m(t?"mx-auto block max-h-screen max-w-full":"mx-auto block aspect-square",t?"rounded-none object-contain":r?"h-full w-full rounded-none object-cover object-top":"rounded-3xl object-center"),alt:x.formatMessage({id:"image-share-renderer-alt",defaultMessage:"User Shared Image"})})})}const v=u.memo(Q);function P({attachment:e,isFullscreen:t,isInline:n}){const o=u.useRef(null);return s.jsx("div",{ref:o,className:m("bg-token-main-surface-primary w-full",t?"h-[100vh] rounded-none":"",n?"h-[300px] cursor-zoom-in overflow-hidden rounded-3xl":"flex-1"),children:s.jsx(K,{disablePermissions:!t,sharedTextdoc:{sharedTextdocId:e.shared_textdoc_id,title:e.shared_textdoc.name,type:e.shared_textdoc.textdoc_type,content:e.shared_textdoc.content},showHeader:!1,unsafeAllowAllNetworkRequests:!0})})}const ee=u.memo(P);function se({attachment:e,caption:t,variant:n,coverPhotoUrl:o,hasActiveRequest:r,clientThreadId:x}){const c=e.tags?.includes("deep_research"),a=n==="fullscreen",l=n==="inline",d=n==="composer",i=n==="unfurl";switch(e.kind){case"message_slice":return e.messages.length===0?null:s.jsx(w,{caption:t,variant:n,coverPhotoUrl:o,messages:e.messages,hasActiveRequest:r,hasCaption:!c,clientThreadId:x});case"conversation_share":{const h=e.share.linear_conversation.map(p=>p.message).filter(p=>p!=null);return h.length===0?null:s.jsx(w,{hasCaption:!1,caption:t,variant:n,coverPhotoUrl:o,messages:h,hasActiveRequest:r,clientThreadId:x})}case"image_share":return s.jsx(v,{url:e.file_public_url,isFullscreen:a,isInline:l,isComposer:d,isUnfurl:i});case"media_generation":return s.jsx(v,{url:e.url,isFullscreen:a,isInline:l,isComposer:d,isUnfurl:i});case"canvas":return s.jsx(ee,{attachment:e,isFullscreen:a,isInline:l});case"sora":return s.jsx(J,{attachment:e,isFullscreen:a,isInline:l,isComposer:d});case"shared_post":return null;case"link":return s.jsx(ne,{url:e.url,ogData:e.og_data,isFullscreen:a,isInline:l,isComposer:d});case"error":return s.jsx("div",{children:s.jsx(g,{id:"post-tree-attachment-error",defaultMessage:"Error loading attachment"})});default:return null}}function te({url:e,ogData:t,isFullscreen:n,isInline:o,isComposer:r}){return s.jsx(f.div,{layout:"position",className:m("bg-token-main-surface-primary inline-block w-full rounded-3xl dark:bg-[#353535]",n&&"h-screen overflow-auto rounded-none",r&&"shadow-[0_12px_24px_-6px_rgb(0_0_0_/_0.1),0_0_1px_rgb(0_0_0_/_0.2)] dark:shadow-[0_10px_20px_-6px_rgb(20_20_20_/_0.5),inset_0_0_1px_rgb(255_255_255_/_0.3)]"),children:s.jsx(k,{fullscreen:!o,className:m("rounded-b-3xl",n&&"relative p-4 lg:px-24 lg:py-24"),children:s.jsx("div",{className:"flex flex-col gap-2 p-4",children:s.jsx("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"text-token-main-surface-secondary break-words hover:underline",children:s.jsxs("div",{className:"items-top flex flex-row gap-4",children:[t.og_image&&s.jsx("img",{className:"h-40 w-40 object-cover",src:t.og_image,alt:t.og_title??void 0}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx("div",{className:"text-token-text-primary font-medium",children:t.og_title||e}),t.og_site_name&&s.jsx("div",{className:"text-token-text-tertiary",children:t.og_site_name}),t.og_description&&s.jsx("div",{className:"text-token-text-secondary",children:t.og_description})]})]})})})})})}const ne=u.memo(te);function w({caption:e,variant:t,coverPhotoUrl:n,messages:o,hasActiveRequest:r,hasCaption:x,clientThreadId:c}){const a=t==="fullscreen",l=t==="inline",d=t==="composer",i=t==="unfurl";return s.jsxs(f.div,{layout:"position",className:m("bg-token-main-surface-primary inline-block w-full rounded-3xl dark:bg-[#353535]",a&&"h-screen overflow-auto rounded-none",d&&"shadow-[0_12px_24px_-6px_rgb(0_0_0_/_0.1),0_0_1px_rgb(0_0_0_/_0.2)] dark:shadow-[0_10px_20px_-6px_rgb(20_20_20_/_0.5),inset_0_0_1px_rgb(255_255_255_/_0.3)]",i&&"h-full"),children:[n&&s.jsx("img",{className:m("max-h-[300px] w-full object-cover object-center",{"rounded-t-3xl":t!=="fullscreen","rounded-none":a}),src:n,alt:e??""}),s.jsx(k,{fullscreen:!l,className:m("rounded-b-3xl",a&&"relative p-4 lg:px-24 lg:py-24",l&&"max-h-[300px] overflow-hidden p-6",d&&"max-h-[300px] overflow-auto p-6",i&&"h-full overflow-hidden p-5"),children:s.jsxs(f.div,{layout:"position",transition:{type:"spring",duration:.45,bounce:.15},children:[s.jsx(y,{mode:"wait",children:x?e==null&&t==="composer"?s.jsx(f.div,{layout:"position",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},children:s.jsx("div",{className:"text-token-text-primary max-w-[460px] pb-8 text-2xl leading-[1.4] font-medium",children:s.jsx("span",{className:"animate-pulse opacity-30",children:s.jsx(g,{id:"placeholder.generatingTitle",defaultMessage:"Generating title..."})})})},"loading-caption"):e!==""?s.jsx(f.div,{layout:"position",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},children:s.jsx("div",{className:"text-token-text-primary max-w-[460px] pb-8 text-2xl leading-[1.4] font-medium",children:e})},"caption"):null:null}),s.jsx(F,{messages:o,hasActiveRequest:r,clientThreadId:c})]})})]})}const qe=u.memo(se);export{qe as AttachmentContent,W as BADGE_LABELS,X as Badge,Ee as BadgeContainer,Be as LoadingAttachmentContent,se as _AttachmentContent};
//# sourceMappingURL=epy4bnndv4k97tmj.js.map
