const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/oxcdf5lnls24q75m.js","assets/eb6xg52mym6rhnsh.js","assets/cs2gapsc2bulabhw.js","assets/root-o1pc79my.css","assets/do5nmvaddt7ak8xi.js","assets/pduvb49qgyq1mqhk.js","assets/conversation-small-ggtqjiqs.css","assets/e95x0gs5di7mq1tw.js","assets/f2cwocui2o4rh90z.js","assets/ggve90in2x9hqouv.js","assets/nlj97v8clhezwsxr.js","assets/bzo48ft2wb6beuij.js","assets/fb2gj4fu6zbut62o.js","assets/kmvt5g0oz7ekj3ft.js","assets/otrhg4fwlde4g25l.js","assets/epqkr08njby1t19h.js","assets/c1w85nn5shpnb9e0.js","assets/7u88g4wa9fostszz.js","assets/codkr9xsn28rihk7.js","assets/h71lg9jejkufcc57.js","assets/l9t7qwwrq1pkwdh1.js","assets/ec6jcwftshefgs7y.js","assets/kn0lvqy8pfftaqm4.js","assets/evmyafqvn996a7fd.js","assets/f3ceh929le7g5gef.js","assets/bav7xjsolx558eu1.js","assets/dzvj7ya113xsl1gj.js","assets/oc70e2tzdju0eixm.js","assets/lhc0r3g2ikd4jwhx.js","assets/kpz7qev108jf94tz.js","assets/echjzuil72lr2oll.js","assets/gy64pge8qevmvg7e.js","assets/jo7jtgpsehqnlvog.js","assets/id0dknkab7cx7d4m.js","assets/fribzu8vhruerbal.js","assets/ejji7zjivcs3aj1o.js","assets/iq3nfzwf18cw338m.js"])))=>i.map(i=>d[i]);
import{r as l,j as e,M as A,f as ae,d as it,a5 as O,g as fs,aq as ra,ap as ia,ak as Gt,a6 as ye,a as xs,R as la,p as ca}from"./cs2gapsc2bulabhw.js";import{bo as da,bp as ua,bq as ma,rD as Vt,cP as ga,dF as pa,cQ as zt,nL as ha,dA as fa,hg as xa,rE as va,aP as ba,rF as ya,dZ as Sa,e7 as vs,dU as K,pq as _a,d3 as ja,en as bs,e as ys,eX as Ta,jr as Xe,dR as Ma,iS as Ca,iU as ka,rG as wa,w as Ss,rH as qt,rI as Ia,rJ as Ea,rK as ke,rL as Ra,ao as _s,rM as Na,h$ as Pa,i0 as Fa,kC as xe,f6 as js,kz as Aa,bu as La,rN as Ts,rO as Ua,rP as Da,S as Ba,rQ as Ms,fm as Oa,fn as Ha,fq as Ga,fo as Va,rR as za,H as Cs,kA as ks,rS as ws,rT as qa,ac as Wa,rU as $a,rV as Ya,n8 as lt,bQ as Is,rW as Ka,rX as Qa,mF as Xa,rY as Ja,qY as Za,rZ as eo,r_ as we,pM as to,i7 as so,fr as no,qG as ao,r$ as oo,s0 as Es,aO as ro,cL as io,s1 as lo,i8 as ve,aY as Rs,U as Ns,s2 as co,aT as uo,am as Ps,aU as mo,al as Fs,s3 as go,s4 as po,j1 as ho,hP as fo,mt as xo,s5 as vo,a$ as As,b0 as Ls,cB as Us,d as bo,s6 as yo,lY as So,cG as _o,Y as Ds,dp as jo,s7 as To,nX as Bs,ds as Mo,hL as Co,me as ko,z as wo,hZ as Os,s8 as Io,h_ as Eo,s9 as Ro,cD as No,sa as Po,sb as Fo,sc as Wt,sd as Ao,se as Lo,sf as Uo,ms as Do,j8 as Bo,cF as Oo,sg as Ho,sh as Go,si as Vo,mf as zo,sj as qo,sk as Wo,oS as Je,sl as $o,np as Pe,sm as Ze,sn as Yo,so as Ko,sp as Qo,cj as Xo,ja as Jo,mx as Zo,mp as er,sq as tr,sr,qk as nr,iD as ar,ss as or,bv as rr,kx as ir,st as lr,o2 as cr,fd as dr,qy as ur,qz as mr,qB as gr,su as pr,sv as hr,sw as fr,aZ as xr,om as vr,lB as br,lC as yr}from"./pduvb49qgyq1mqhk.js";import{O as oe,_ as pe,fM as $t,e3 as Yt,bb as te,j as Fe,am as ct,co as Re,L as Hs,b as dt,c as L,F as re,aS as be,bL as P,cY as ut,ab as D,a6 as V,h2 as Gs,en as Sr,aa as se,aT as ge,ct as mt,d6 as _r,cl as Vs,aE as jr,d as zs,B as qs,q as Kt,an as et,e as B,c0 as Q,ai as gt,aF as ne,eC as Ws,a9 as tt,gi as Tr,bQ as Mr,e5 as Cr,e6 as kr,aJ as Z,bX as wr,hu as Ir,cd as $s,hv as Er,cp as pt,f as ht,aV as Ne,e1 as Rr,cn as Nr,cM as Pr,bE as Ys,hm as Fr,l as Ks,dB as ft,aC as st,dc as Ar,ew as Lr,eo as Ur,gh as We,cc as Dr,dV as Br,fL as Or,bd as $e,h3 as Hr,h4 as Gr,eU as Vr,e_ as Qt,eV as zr,eQ as qr,fc as Wr,gN as $r,ac as Yr,cS as Kr}from"./eb6xg52mym6rhnsh.js";import{a as Qr,b as Xr,c as Jr}from"./kn0lvqy8pfftaqm4.js";import{d as Zr,e as Qs}from"./f2cwocui2o4rh90z.js";import{a as Xs,u as ei,b as Js}from"./epqkr08njby1t19h.js";import"./hpoi02g0dgpne8ux.js";import{M as ti,O as si}from"./codkr9xsn28rihk7.js";import{d as ni,b as Xt}from"./h71lg9jejkufcc57.js";import{a as ai,G as oi}from"./c1w85nn5shpnb9e0.js";import{C as nt,F as ri}from"./j0zvljvurep0tkuq.js";import{b as Zs}from"./kmvt5g0oz7ekj3ft.js";import{m as ii}from"./ls88si7tay0ysj3s.js";const li=oe(async()=>pe(()=>import("./oxcdf5lnls24q75m.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24])).then(t=>t.ImageGenNewEditor));function El({postWithProfile:t,clientThreadId:n,closeModal:a}){return t.post.attachments[0]?.kind==="media_generation"?e.jsx(ci,{postWithProfile:t,clientThreadId:n,closeModal:a}):t.post.attachments[0]?.kind==="message_slice"?e.jsx(di,{postWithProfile:t,closeModal:a}):null}function ci({postWithProfile:t,clientThreadId:n,closeModal:a}){const s=l.useRef(null),[o,r]=l.useState(!1),[c,m]=l.useState(!1),i=it(),{post:u}=t,d=u.attachments[u.attachments.length-1],f={url:d.url,content_type:Yt.ImageAssetPointer,asset_pointer:d.asset_pointer??Vt(d.id),size_bytes:0,width:d.width,height:d.height},p=ae(),x=ga(),g=te(n),T=Fe(),C=l.useCallback(b=>x.getState().files.find(v=>v.tempId===b),[x]),w=d.url,R=l.useCallback(async b=>{if(s.current){const v=await s.current,y=v?C(v?.tempId):null;if(y)return y}return s.current=fetch(b).then(v=>v.blob()).then(v=>{const y=new File([v],"image.png",{type:"image/png"}),N=pa(y);return zt.uploadFile(x,N,y,ha.Multimodal,[y.type],p,T).then(()=>{const k=C(N);return k&&k.status===fa.Ready&&k.fileId?k:null})}),s.current},[x,p,T,C]),{onRequestCompletion:F}=Zr(),{isUnauthenticated:S}=ct(),_=l.useCallback(async b=>{if(!(!b.promptMessage||S)){m(!0);try{const v=await R(w);if(!v||!v.fileId||!v.fileSpec)return;const y=[{content_type:Yt.ImageAssetPointer,asset_pointer:Vt(v.fileId),size_bytes:v.fileSpec.size,width:d.width,height:d.height},...b.promptMessage.content.content_type===Re.MultimodalText||b.promptMessage.content.content_type===Re.Text?b.promptMessage.content.parts:[]],N={...b,promptMessage:{...b.promptMessage,content:{content_type:Re.MultimodalText,parts:y}},extraStreamParams:{...b.extraStreamParams??{},continueFromSharedPostId:u.id}};F(N),a(),zt.reset(x)}catch{T.danger(p.formatMessage({id:"postReceiverModal.editImageError",defaultMessage:"Failed to edit the image"}))}finally{m(!1)}}},[d.height,d.width,R,F,x,w,a,S,p,T,u.id]),I=e.jsx(en,{post:u,setIsReportModalOpen:r,closeModal:a,additionalButtons:e.jsx(Qr,{imageAsset:f,serverThreadId:g})});return e.jsxs("div",{className:"bg-token-main-surface-primary absolute start-0 end-0 top-0 bottom-0 h-full w-full",children:[e.jsx(xa,{children:e.jsx(li,{image:f,isLoadingNewImage:!1,clientThreadId:n,onClose:()=>{a(),i("/",{replace:!0})},onRequestCompletion:_,editorControls:I,messageId:u.id,footer:c?e.jsx(ui,{}):null})}),o&&e.jsx(tn,{post:u,onClose:()=>r(!1)})]})}function di({postWithProfile:t,closeModal:n}){const[a,s]=l.useState(!1),{post:o}=t;return e.jsxs("div",{className:"bg-token-main-surface-primary absolute start-0 end-0 top-0 bottom-0 h-full w-full",children:[e.jsx(en,{post:o,setIsReportModalOpen:s,closeModal:n}),e.jsx(va,{attachments:o.attachments,variant:"fullscreen"}),a&&e.jsx(tn,{post:o,onClose:()=>s(!1)})]})}function en({post:t,setIsReportModalOpen:n,closeModal:a,additionalButtons:s}){const o=it(),r=ae(),c=Fe(),m=l.useCallback(async()=>{if(window.confirm(r.formatMessage({id:"postReceiverModal.deletePostConfirmation",defaultMessage:"Are you sure you want to delete this post?"})))try{await dt.safeDelete("/share/post/{post_id}",{parameters:{path:{post_id:t.id}}}),o("/",{replace:!0})}catch{c.danger(r.formatMessage({id:"postReceiverModal.deletePostError",defaultMessage:"Failed to delete the post"}))}},[t.id,r,c,o]);return e.jsx(e.Fragment,{children:e.jsxs(O.div,{className:"flex h-16 w-full px-2 sm:px-4",...ba,children:[e.jsx("div",{className:"flex items-center justify-self-start text-start",children:e.jsx(Xr,{onClose:()=>{a(),o("/",{replace:!0})}})}),e.jsx("div",{className:"flex w-full flex-1 flex-col items-center justify-center justify-self-stretch",children:e.jsx(ya,{areButtonsFullWidth:!0,post:t,setIsReportModalOpen:n})}),e.jsxs("div",{className:"flex items-center justify-self-end text-end",children:[t.permissions.can_delete&&e.jsx(Jr,{tooltip:r.formatMessage({id:"postReceiverModal.deletePost",defaultMessage:"Delete"}),onClick:m,children:e.jsx(Sa,{})}),s]})]})})}function ui(){const t=ae();return e.jsxs(O.div,{className:"shadow-token-border-default pointer-events-none inline-flex items-center justify-center gap-1.5 self-center rounded-[16px] px-3.5 py-2 text-sm shadow-lg",transition:{duration:.3,ease:"easeInOut"},initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[e.jsx(Hs,{}),e.jsx("span",{children:t.formatMessage({id:"postReceiverModal.preparingImage",defaultMessage:"Preparing image..."})})]})}function tn({post:t,onClose:n}){const{data:a}=da($t.Post),s=ae(),o=ua(s,t.id,$t.Post);if(a==null)return null;const r=`Report ${t.text??"Post"}`;return e.jsx(ma,{reasons:a.reasons,submitReport:o,title:r,onClose:n,header:a.header,subHeader:a.header_explanation})}function mi(){const t=l.useContext(Xs),n=t?.postWithProfile?.post,a=t?.setIsReportModalOpen;return!n||!a?null:e.jsxs("div",{className:"outline-token-border-default mx-4 flex items-center justify-between gap-2.5 rounded-2xl px-4 py-1 outline-1 outline-offset-[-1px]",children:[e.jsx("span",{className:"text-token-text-secondary justify-center text-sm leading-tight",children:e.jsx(A,{id:"IV5jPE",defaultMessage:"You’re viewing model-generated content."})}),e.jsx(vs,{size:"default",contentAlign:"end",sideOffset:4,triggerButton:e.jsx(ja,{className:"rounded-full",label:"",icon:e.jsx(bs,{className:"icon-sm"})}),children:e.jsx(K.Item,{icon:_a,onClick:()=>a(!0),children:e.jsx(A,{id:"jHHbcM",defaultMessage:"Flag content as unsafe"})})})]})}function Rl(){const t=l.useContext(Xs),n=t?.postWithProfile?.post,a=t?.setIsReportModalOpen;return!n||!a?null:e.jsx("div",{className:"text-token-text-secondary text-sm",children:e.jsx(A,{id:"+lfJBi",defaultMessage:"You’re viewing model-generated content. <reportButton>Report</reportButton> if unsafe.",values:{reportButton:s=>e.jsx("button",{className:"text-token-text-primary decoration-token-text-primary underline",onClick:()=>{a(!0)},children:s})}})})}const gi="bg-token-main-surface-primary text-token-text-primary",pi="openai",Jt=["bg-blue-300 text-white"];function hi(t){return Jt[(t?.charCodeAt(0)??0)%Jt.length]}const Ie=({children:t})=>e.jsx("div",{className:"pt-0",children:e.jsx("div",{className:L(l.isValidElement(t)&&t.type===Xe?"gizmo-bot-avatar":"gizmo-shadow-stroke","flex h-8 w-8 items-center justify-center overflow-hidden rounded-full"),children:t})});function at(t){const{messages:n,isUserTurn:a,avatarClassName:s,gizmo:o}=t,r="medium",m=n[0]?.metadata?.shared_conversation_id,i=m!=null,u=ys(),{gizmoEditorData:d,mode:f}=Ta();let p=e.jsx(Ie,{children:e.jsx(Xe,{className:s??gi,iconName:pi,size:r})});return o?p=e.jsx(Ie,{children:e.jsx(ai,{gizmoId:o.gizmo.id,className:"h-full w-full"})}):d!=null&&f==="test"&&(p=e.jsx(oi,{isFirstParty:!1,src:d.profilePictureUrl,className:"h-8 w-8 first:pt-[3px]"})),e.jsx("div",{className:void 0,children:a?i?e.jsx(Ie,{children:e.jsx(Xe,{className:hi(m),iconName:"user",size:r})}):e.jsx(Ie,{children:e.jsx(Ma,{user:u,size:r})}):p})}const Zt=oe(()=>pe(()=>import("./bav7xjsolx558eu1.js"),__vite__mapDeps([25,1,2,3,5,6,26,27])).then(t=>t.MemoryActionResult));function es(t,n,a){ge(t,s=>{mt.updateTree(s,o=>{o.updateNodeMetadata(n,{inlineComparisonRating:a})})})}const ts=({messages:t})=>{for(const{metadata:n}of t){const{paragen_display_label:a}=n??{};if(a)return a;const{augmented_paragen_prompt_label:s}=n??{};if(s)return s}};function fi(t){const n=l.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),a=l.useRef({left:null,right:null});return t.variantIds.length<2?e.jsx(sn,{setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:n,firstVisibleTokenTimestampsRef:a,...t}):e.jsx(xi,{...t,visibilityStateRef:n,firstVisibleTokenTimestampsRef:a})}function xi(t){const{clientThreadId:n,variantIds:a,turnIndex:s,firstVisibleTokenTimestampsRef:o}=t;if(a.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const r=xt(),c=Gs(),m=Sr(),[i,u]=a,d=l.useMemo(()=>Ss(i+u)()>=.5,[i,u]),[f,p]=d?[u,i]:[i,u],[x,g,T]=se(n,_=>{const I=Kt(_).tree.getLeafFromNode(f).id,b=Kt(_).tree.getLeafFromNode(p).id,v=D.getConversationTurns(_,I),y=D.getConversationTurns(_,b),N=s<v.length?v[s]:null,k=s<y.length?y[s]:null;return N||et.addError(`Paragen Left turn index ${s} out of bounds`,{turnIndex:s,turnCount:v.length,lastTurnRole:P(v)?.role,lastMessageAuthor:P(P(v)?.messages)?.author,lastMessageContentType:P(P(v)?.messages)?.content.content_type,lastMessageMetadata:P(P(v)?.messages)?.metadata,altTurnCount:y.length,altLastTurnRole:P(y)?.role,altLastMessageRole:P(P(y)?.messages)?.author.role}),k||et.addError(`Paragen Right turn index ${s} out of bounds`,{turnIndex:s,turnCount:y.length,lastTurnRole:P(y)?.role,lastMessageAuthor:P(P(y)?.messages)?.author,lastMessageContentType:P(P(y)?.messages)?.content.content_type,lastMessageMetadata:P(P(y)?.messages)?.metadata,altTurnCount:v.length,altLastTurnRole:P(v)?.role,altLastMessageRole:P(P(v)?.messages)?.author.role}),[I,N,k]}),[C,w]=d?[T,g]:[g,T],R=r?"skippable_parallel_2_in_stream:a:2.0":"skippable_parallel_2_in_stream:a:1.5";l.useEffect(()=>(qt.setState({displayingSideBySideFeedback:!0}),()=>{qt.setState({displayingSideBySideFeedback:!1})}),[]);const F=l.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),S=l.useCallback((_,{shouldSubmitParagenFeedback:I=!0}={})=>{if(!g||!T||!C||!w)throw new Error("Expected both turns to exist");ge(n,E=>{mt.setCurrentBranch(E,_)});const b=_===f,v=_===i;C.messages.length>0&&es(n,C.messages[C.messages.length-1].id,v?"original":"new"),w.messages.length>0&&es(n,w.messages[w.messages.length-1].id,v?"original":"new");const y=te(n),N=[g,T].map((E,U)=>({messageId:E.messages[E.messages.length-1].id,loadFirstTokenTime:U===0?o.current.left:o.current.right,loadEndTime:P(E.messages)?.clientMetadata?.completionSampleFinishTime})),k=b?N[0].messageId:N[1].messageId,h=D.getParentPromptNode(be(n),x);if(!h)throw new Error("Expected prompt for side by side feedback");const M={},z=h.message.clientMetadata?.variantsInStreamInfo==null&&h.message.metadata?.paragen_variants_info!=null;for(const E of N)M[E.messageId]=z?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:E.loadFirstTokenTime,load_end_time:E.loadEndTime};I&&is({params:{conversation_id:y,displayed_message_ids:N.map(E=>E.messageId),message_metadatas:M,rating:"selected",selected_message_id:k,source_timestamp:Date.now(),ui_variant:r?2:1,user_prompt_message_id:h.message.id}})},[n,f,i,C,w,g,T,x,o,t.conversationTurnMountTime,r]);return l.useEffect(()=>_r(Vs,{requestCompletion:_=>{const I=te(n),b=D.getParentPromptNode(be(n),x);if(!b)throw new Error("Expected prompt for side by side feedback");if(!g||!T)throw new Error("Expected both turns to exist");const v=[g,T].map((h,M)=>({messageId:h.messages[h.messages.length-1].id,loadFirstTokenTime:M===0?o.current.left:o.current.right,loadEndTime:P(h.messages)?.clientMetadata?.completionSampleFinishTime})),y={},N=b.message.clientMetadata?.variantsInStreamInfo==null&&b.message.metadata?.paragen_variants_info!=null;for(const h of v)y[h.messageId]=N?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:h.loadFirstTokenTime,load_end_time:h.loadEndTime};const k=_.isForSkippingParagen;is({params:{conversation_id:I,displayed_message_ids:v.map(h=>h.messageId),message_metadatas:y,rating:k?"explicit_skipped":"skipped",selected_message_id:null,source_timestamp:Date.now(),ui_variant:k?3:r?2:1,user_prompt_message_id:b.message.id}}),k&&S(f,{shouldSubmitParagenFeedback:!1})}}),[g,T,x,n,t.conversationTurnMountTime,R,C?.messages,w?.messages,m,r,o,S,f]),e.jsx(sn,{...t,setPreferredFeedback:S,leftVariantId:f,rightVariantId:p,leftTurn:g,rightTurn:T,hasActiveRequest:c,originalTurn:C,visibilityStateRef:F})}function sn({setPreferredFeedback:t,leftVariantId:n,rightVariantId:a,leftTurn:s,rightTurn:o,hasActiveRequest:r,originalTurn:c,visibilityStateRef:m,...i}){const u=(s&&ts(s))??null,d=(o&&ts(o))??null,f=l.useMemo(()=>s?.messages??[],[s?.messages]),p=l.useMemo(()=>o?.messages??[],[o?.messages]),{avatarClassName:x,firstVisibleTokenTimestampsRef:g}=i,T=l.useMemo(()=>s?.messageGroups??[],[s?.messageGroups]),C=l.useMemo(()=>o?.messageGroups??[],[o?.messageGroups]),w=Ca(),R=be(i.clientThreadId),F=P(s?.messages),S=P(o?.messages),_=ut(D.getRequestId(R,F?.id??S?.id)),I=_&&!F?.end_turn,b=_&&!S?.end_turn,v=s?.role===V.User,y=o?.role===V.User,N=l.useRef(null),k=l.useRef(null),h=l.useRef(null),M=s!=null,z=o!=null;!M&&g.current.left==null&&(g.current.left=Date.now()),!z&&g.current.right==null&&(g.current.right=Date.now()),l.useEffect(()=>{if(N.current&&k.current&&h.current){const le=Array(11).fill(0).map((he,X)=>X/10),H=new IntersectionObserver(he=>he.forEach(X=>{X.target===k.current?(m.current.left_visibility_initial==null&&(m.current.left_visibility_initial=X.intersectionRatio),m.current.left_visibility_max=Math.max(m.current.left_visibility_max??0,X.intersectionRatio)):X.target===h.current&&(m.current.right_visibility_initial==null&&(m.current.right_visibility_initial=X.intersectionRatio),m.current.right_visibility_max=Math.max(m.current.right_visibility_max??0,X.intersectionRatio))}),{root:N.current,threshold:le});return H.observe(k.current),H.observe(h.current),()=>H.disconnect()}},[m]);const{data:E}=ka(void 0,!1,w),U=xt(),ie=e.jsx("div",{className:"text-token-text-secondary px-(--thread-content-margin) pt-1 pb-5 text-center text-sm text-pretty",children:e.jsx(A,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})});return e.jsxs("div",{className:"relative flex flex-col",children:[e.jsxs("div",{className:L("bg-token-main-surface-primary sticky top-[-1px] z-1 px-(--thread-content-margin) text-center text-lg text-pretty",U?"md:top-header-height":"md:static"),"data-testid":"paragen-feedback-title",children:[e.jsx(A,{id:"KKeSJV",defaultMessage:"You're giving feedback on a new version of ChatGPT."}),U?ie:null]}),U?null:ie,e.jsx("div",{className:L(wa,"horzScrollShadows relative -mb-2 snap-x snap-mandatory overflow-x-auto overflow-y-clip pb-4"),ref:N,children:e.jsxs("div",{className:L("mx-auto box-content max-w-[calc(2*var(--thread-content-max-width))] min-w-min px-(--thread-content-margin)","flex items-start",U&&"divide-token-border-medium dark:divide-token-border-heavy divide-x",!U&&"gap-4 sm:gap-6"),children:[e.jsxs(ss,{horizontalScrollContainerRef:N,rootElementRef:k,onClick:()=>{t(n)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:M,children:[e.jsxs(os,{children:[e.jsx(at,{messages:f,isUserTurn:v,avatarClassName:x}),e.jsx(as,{children:e.jsx(A,{...ls.responseNumber,values:{responseIndex:1,display_label:u}})})]}),U&&M?e.jsx(ns,{}):e.jsxs(e.Fragment,{children:[E!=null&&!v&&e.jsx(Zt,{clientThreadId:i.clientThreadId,messages:f,isParagen:!0}),e.jsx(nt,{...i,allMessages:f,groupedMessagesToRender:T,allGroupedMessages:T,isUserTurn:v,isFinalUserTurn:!1,isCompletionRequestInProgress:I,hasActiveRequest:r,shouldGrowContainer:!1,isParagen:!0}),e.jsx(rs,{clientThreadId:i.clientThreadId,conversationTurnMountTime:i.conversationTurnMountTime,turn:s,originalTurn:c})]})]}),e.jsxs(ss,{horizontalScrollContainerRef:N,rootElementRef:h,onClick:()=>{t(a)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:z,children:[e.jsxs(os,{children:[e.jsx(at,{messages:p,isUserTurn:y,avatarClassName:x}),e.jsx(as,{children:e.jsx(A,{...ls.responseNumber,values:{responseIndex:2,display_label:d}})})]}),U&&z?e.jsx(ns,{}):e.jsxs(e.Fragment,{children:[E!=null&&!y&&e.jsx(Zt,{clientThreadId:i.clientThreadId,messages:p,isParagen:!0}),e.jsx(nt,{...i,allMessages:p,groupedMessagesToRender:C,allGroupedMessages:C,isFinalUserTurn:!1,isUserTurn:y,isCompletionRequestInProgress:b,hasActiveRequest:r,shouldGrowContainer:!1,isParagen:!0}),e.jsx(rs,{clientThreadId:i.clientThreadId,conversationTurnMountTime:i.conversationTurnMountTime,turn:o,originalTurn:c})]})]})]})})]})}function ss({horizontalScrollContainerRef:t,rootElementRef:n,onClick:a,children:s,hasActiveRequest:o,isWaitingOnFirstUserVisibleToken:r}){const c=xt(),{scrollX:m}=ra({layoutEffect:!1,container:t,target:n}),i=Ia(),u=Ea(),d=l.useRef(null),f=l.useRef(null),p=l.useRef(null),[x,g]=l.useState(!1),[T,C]=l.useState(!1),[w,R]=l.useState(!1),[F,S]=l.useState(0);l.useEffect(()=>{if(!c)return;const k=new IntersectionObserver(h=>{for(const M of h)M.target===d.current?g(M.isIntersecting):M.target===p.current?R(M.isIntersecting):M.target===f.current&&C(M.isIntersecting)},{root:i?.current});return d.current&&f.current&&p.current&&(k.observe(d.current),k.observe(f.current),k.observe(p.current)),()=>{k.disconnect()}},[F,c,i]);const _=!w&&(T||x),I=ia(m,k=>_?-1*k:0),b=Gt(0);l.useEffect(()=>{if(!c)return;const k=new ResizeObserver(h=>{ke(h.length===1,"entryList.length === 1");const M=h[0];ke(M.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),b.set(M.contentBoxSize[0].inlineSize)});return n.current&&k.observe(n.current),()=>{k.disconnect()}},[c,b,n]);const v=Gt(0);l.useEffect(()=>{if(!c)return;const k=new ResizeObserver(h=>{ke(h.length===1,"entryList.length === 1");const M=h[0];ke(M.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),v.set(M.contentBoxSize[0].blockSize+16),S(M.contentBoxSize[0].blockSize)});return u.current&&k.observe(u.current),()=>{k.disconnect()}},[c,v,u]);const y=e.jsx(qs,{className:c?"px-5":"mt-4 self-start",onClick:a,"data-testid":"paragen-prefer-response-button",children:e.jsx(A,{id:"U2EAH6",defaultMessage:"I prefer this response"})}),N=r;return e.jsx("div",{"data-paragen-root":!0,className:L("@container relative flex min-w-[min(450px,80cqw,80vw)] flex-1 snap-center flex-col gap-1 text-start",c?"min-h-60":"border-token-border-tertiary rounded-xl border shadow-lg shadow-black/3"),ref:n,children:e.jsxs("div",{className:L(Ra,"px-(--thread-content-margin) py-4"),children:[e.jsx("div",{className:L("absolute top-48 right-0! left-0! h-px","invisible"),ref:d}),e.jsx("div",{className:L("absolute top-48 right-0! bottom-0 left-0!","invisible"),ref:f}),e.jsx("div",{className:L("absolute right-0! bottom-0 left-0! h-px","invisible"),ref:p}),s,c?e.jsx("div",{className:"flex-1"}):null,c?e.jsx("div",{className:"mt-4 min-h-10",children:N?null:e.jsx(O.div,{style:{translateX:I,width:b,bottom:v},animate:{opacity:100},initial:{opacity:0},transition:{ease:"easeOut",duration:.2,delay:.5},className:L({fixed:_,"z-20 flex w-full justify-center":!0}),children:y})}):o?null:y]})})}function ns(){return e.jsxs("div",{className:"flex w-full flex-col gap-4 pt-3 pb-5",children:[e.jsx(me,{className:"h-4 w-[75%]"}),e.jsx(me,{className:"h-4 w-[50%]"}),e.jsx(me,{className:"h-4 w-[80%]"}),e.jsx(me,{className:"h-4 w-[55%]"}),e.jsx(me,{className:"h-4 w-[66%]"}),e.jsx(me,{className:"h-4 w-[64%]"}),e.jsx(me,{className:"h-4 w-[48%]"})]})}function xt(){const{layer:t}=jr("3119715334");return t.get("should-enable-hojicha",!1)}const as=re.div`text-sm text-token-text-secondary font-semibold`,os=re.div`flex gap-4 items-center mb-1`,me=re.div`animate-pulse rounded-[4px] bg-token-main-surface-tertiary`;function rs({clientThreadId:t,conversationTurnMountTime:n,turn:a,originalTurn:s}){const o=_s();if(!o.showParagenMetadata||!o.showDebugConversationTurns&&!o.forceParagen||a==null)return null;let r=a===s?"ORIGINAL":"NEW";const c=a.messages[a.messages.length-1],m=c?.metadata?.__internal,i=c?.metadata?.paragen_display_label;if(m){const{model_id:f,model_definition_slug:p,model_definition_virtual_model_id:x,alternative_model_selection_rule:g,augmented_paragen_prompt_group_id:T,augmented_paragen_prompt_id:C,augmented_paragen_prompt:w}=m;f&&(r+=`
Model ID: ${f}`),p&&(r+=`
Model Slug: ${p}`),x&&(r+=`
Virtual Model ID: ${x}`),g&&(r+=`
Alternative Model Rule: ${g}`),T&&(r+=`
Prompt Group ID: ${T}`),C&&(r+=`
Prompt ID: ${C}`),w&&(r+=`
Prompt: ${w}`),i&&(r+=`
Display Label: ${i}`)}r+=`
Message ID: ${c.id}`;const u=D.getParentPromptNode(be(t),a.messages[0].id);if(!u)throw new Error("Expected prompt for side by side feedback");const d=u.message.clientMetadata?.variantsInStreamInfo==null&&u.message.metadata?.paragen_variants_info!=null;return r+=`
User prompt message ID: ${u.message.id}`,r+=`
Is Persisted Paragen? ${d}`,r+=`
Completion Sample Finish Time: ${d?`${n} (persisted)`:P(a.messages)?.clientMetadata?.completionSampleFinishTime}`,e.jsx("div",{className:"text-sm whitespace-pre-wrap text-red-500",children:r})}async function is({params:t}){await dt.safePost("/paragen_submission",{requestBody:t,authOption:zs.SendIfAvailable})}const ls=fs({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}{display_label}"}});function vi({handleShowRetrievalResults:t,clientThreadId:n,turnIndex:a,responseComplete:s=!1}){const[o,r]=se(n,d=>[D.getTurnContentReferences(d,a),D.getConversationTurnAtIndex(d,a).messages]),c=l.useMemo(()=>({turnIndex:a,clientThreadId:n,responseComplete:s}),[n,s,a]),m=l.useRef(!1);l.useEffect(()=>{m.current||(m.current=!0,B.logEvent("File Sources Footer Shown",c))},[c]);const i=l.useCallback(()=>{B.logEvent("File Sources Footer Clicked",c),t()},[t,c]),u=l.useMemo(()=>{const d=new Set,f=[];function p(g){!g||d.has(g)||(d.add(g),f.push(g))}if(o.forEach(g=>{g.type==="file"?p(g.cloud_doc_url??g.extra?.cloud_doc_url):g.type==="file_navlist"&&g.items.forEach(T=>{p(T.cloud_doc_url)})}),s){for(const g of r)if(Na(g)){const T=Pa(g.content.result),C=g.metadata?.cloud_doc_urls??[],w=T.chunks;for(let R=0;R<w.length;R++){const F=w[R];if(!F.documentId)continue;if(R<C.length){p(C[R]);continue}const S=F.documentId.endsWith("--google")?F.documentId.split("--")[1]:void 0,_=F.metadata.cloud_doc_url??(S?`https://drive.google.com/file/d/${S}`:void 0);p(_?.toString())}break}}const x=[];for(let g=0;g<f.length;g++){const T=f[g],C=Fa(T);if(C&&x.push(C.Icon),x.length>=3)break}return x},[r,o,s]);return u.length===0&&!s?null:e.jsxs(e.Fragment,{children:[e.jsx(O.div,{className:"absolute h-[60px]",initial:{opacity:0},animate:{opacity:1},children:e.jsxs("button",{className:L("not-prose group/footnote border-token-border-default bg-token-main-surface-primary hover:bg-token-main-surface-secondary mt-3 mb-2 flex w-fit items-center gap-1.5 rounded-xl border py-2","ps-3 pe-2.5"),onClick:i,children:[u.length>0&&e.jsx("div",{className:"flex flex-row-reverse gap-1",children:u.reverse().map((d,f)=>e.jsx(O.div,{className:L("border-token-main-surface-primary bg-token-main-surface-primary flex items-center overflow-hidden","group-hover/footnote:border-token-main-surface-secondary","relative"),initial:{opacity:0},animate:{opacity:1},children:e.jsx(d,{className:"icon-sm"})},f))}),e.jsx("div",{className:"text-token-text-secondary flex items-center gap-0.5 text-xs font-semibold",children:e.jsx(A,{id:"/48IOP",defaultMessage:"Sources"})})]})}),e.jsx("div",{className:"h-[60px]"})]})}function nn({followups:t,analyticsMetadata:n,isV2Enabled:a=!1}){const[s,o]=l.useState(-1),r=l.useRef(!1),c=Qs();return l.useEffect(()=>{r.current||(r.current=!0,t.forEach((m,i)=>{B.logEventWithStatsig("chatgpt_message_followup_action","chatgpt_message_followup_action",{...Q(n),action:"show",position:(i+1).toString(),followup_text:xe(m)})}))},[t,n]),e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex w-full flex-col",children:t.slice(0,4).map((m,i)=>e.jsxs(O.div,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:i*.03},exit:{opacity:0,translateY:4},onMouseEnter:()=>o(i),onMouseLeave:()=>o(-1),children:[i>0&&!a&&e.jsx(an,{$isSelected:s===i||s===i-1}),e.jsx(bi,{followUp:m,onSelectingSuggestedReply:c,analyticsMetadata:n,position:i,isV2Enabled:a})]},i))})}const an=re.div`
  h-[1px] opacity-45
  ${({$isSelected:t})=>t?"mx-2 bg-token-main-surface-secondary":"bg-token-border-default"}
`;function bi({followUp:t,onSelectingSuggestedReply:n,analyticsMetadata:a,position:s,isV2Enabled:o}){return e.jsxs(O.button,{whileHover:"hover",className:L("bg-token-main-surface-primary hover:bg-token-main-surface-secondary flex w-full cursor-pointer items-start justify-start gap-2 rounded-lg py-3 text-start",o?"px-0":"px-2"),onClick:r=>{n(r,t,[],0),B.logEventWithStatsig("chatgpt_message_followup_action","chatgpt_message_followup_action",{...Q(a),action:"click",position:(s+1).toString(),followup_text:xe(t)})},onMouseEnter:()=>{B.logEventWithStatsig("chatgpt_message_followup_action","chatgpt_message_followup_action",{...Q(a),action:"hover",position:(s+1).toString(),followup_text:xe(t)})},children:[e.jsx(O.div,{className:"flex items-center justify-center pt-0.25 opacity-70",variants:{hover:{x:4}},initial:{x:0},transition:{duration:.1},children:e.jsx(js,{className:"text-token-text-secondary h-[20px] w-[20px]"})}),e.jsx("div",{className:"text-token-text-secondary pe-2 text-start text-sm",children:xe(t)})]})}const yi=()=>e.jsx(Zs,{size:"lg",lines:3,width:35,widthVariance:10,className:"w-full"}),Si=t=>({[ne.Search]:"Web Search",[ne.Research]:"Research",[ne.PictureV2]:"Draw Image",[ne.Think]:"Think Harder"})[t]??"Title",ot=(t,n,a,s,o)=>{B.logEventWithStatsig("Capabilities Suggestion Action","chatgpt_capabilities_suggestion_action",{...Q(a),categoryId:n.categoryId,suggestionId:n.id,position:s,action:t,numSuggestions:String(o)})},_i=(t,n)=>{const a=l.useRef(!1);l.useEffect(()=>{a.current||(a.current=!0,t.forEach((s,o)=>{ot("show",s,n,o+1,t.length)}))},[t,n])},on=({clientThreadId:t,suggestions:n,analyticsMetadata:a,style:s="default"})=>{const o=Qs();return _i(n,a),e.jsx(e.Fragment,{children:n.map((r,c)=>e.jsxs(O.div,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},exit:{opacity:0,translateY:4},transition:{delay:c*.03},className:L("w-full flex-1",s==="compact"&&"flex-col"),children:[s==="compact"&&c>0&&e.jsx(an,{$isSelected:!1}),e.jsx(ji,{clientThreadId:t,suggestion:r,onSelectingSuggestedReply:o,position:c+1,numSuggestions:n.length,analyticsMetadata:a,style:s})]},r.prompt))})},ji=({clientThreadId:t,suggestion:n,onSelectingSuggestedReply:a,analyticsMetadata:s,position:o,numSuggestions:r,style:c="default"})=>{const{setThreadSystemHintMode:m}=Aa(),i=gt(),u=it();return e.jsx(O.button,{onClick:d=>{if(ot("click",n,s,o,r),n.categoryId===ne.Research)if(i?.isFree()){La(u,"Suggested Capabilities Upsell");return}else m(n.categoryId,!0,s);a(d,n,[],0)},onMouseEnter:()=>{ot("hover",n,s,o,r)},className:L("hover:bg-token-main-surface-secondary flex w-full flex-1 items-start rounded-xl text-start transition-colors duration-300 ease-in-out",c==="default"&&"gap-4 p-2"),children:c==="compact"?e.jsx(Ti,{clientThreadId:t,suggestion:n}):e.jsx(Mi,{clientThreadId:t,suggestion:n})})},Ti=({suggestion:t,clientThreadId:n})=>{const{categoryId:a}=t,{systemHints:s}=Ts(n),o=s.find(r=>r.systemHint===a);return e.jsxs("div",{className:"bg-primary hover:bg-tertiary group flex w-full cursor-pointer items-center justify-start gap-2 rounded-lg px-2 py-3 text-start transition-colors duration-300 ease-in-out",children:[e.jsx("div",{className:"flex items-center justify-center opacity-70 transition-all duration-100 ease-in-out group-hover:scale-[1.02] group-hover:rotate-[-5deg] group-hover:opacity-100",children:a==="ask"?e.jsx(js,{className:"text-token-text-secondary group-hover:text-token-text-primary h-[18px] w-[18px]"}):e.jsx(Ws,{svgString:o?.logo??"",className:"text-token-text-secondary icon-md group-hover:text-token-interactive-label-accent-default h-[18px] w-[18px]"})}),e.jsx("div",{className:"text-token-text-secondary group-hover:text-token-text-primary flex items-center pe-2 text-start text-sm",children:xe(t)})]})},Mi=({clientThreadId:t,suggestion:n})=>{const{categoryId:a,imageUrl:s,description:o,title:r,ctaLabel:c,prompt:m}=n,{systemHints:i}=Ts(t),u=i.find(d=>d.systemHint===a);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-token-border-default bg-primary relative h-16 w-14 flex-shrink-0 rounded-lg border drop-shadow-xs transition-all duration-100 ease-in-out group-hover:scale-[1.02] group-hover:rotate-[-2deg]",children:[a===ne.PictureV2?e.jsx("div",{className:"flex h-full w-full items-center justify-center rounded-lg bg-cover",style:{backgroundImage:`url(${s})`},children:e.jsx(Ua,{className:"icon-xl mb-2 text-white"})}):e.jsxs("div",{className:"flex flex-col gap-1.5 p-2",children:[e.jsx("div",{className:"text-token-text-primary text-[5px] leading-tight font-semibold tracking-tighter",children:r??Si(a)}),e.jsx("div",{className:"flex flex-col gap-0.5",children:Array.from({length:10}).map((d,f)=>e.jsx("div",{className:"bg-token-border-heavy h-[1px] w-full rounded-full"},f))})]}),e.jsx("div",{className:"absolute -end-2 -bottom-2",children:e.jsx(Da,{isBadge:!0,className:"opacity-100",logo:e.jsx(Ws,{svgString:u?.logo??"",className:"icon-md"})})})]}),e.jsxs("div",{className:"flex flex-col gap-2 text-sm",children:[e.jsx("div",{className:"text-token-text-primary flex-grow",children:o??m}),c&&e.jsxs("div",{className:"text-token-text-secondary flex items-center font-medium",children:[c,e.jsx(O.div,{variants:{hover:{x:2}},initial:{x:0},transition:{duration:.1},children:e.jsx(Ba,{})})]})]})]})},rt=(t,n,a,s)=>{B.logEventWithStatsig("Capabilities Tab Action","chatgpt_capabilities_tab_action",{...Q(a),tabId:n,position:s,action:t})},Ci=(t,n)=>{const a=l.useRef(!1);l.useEffect(()=>{a.current||(a.current=!0,t.forEach((s,o)=>{rt("show",s.value,n,o+1)}))},[t,n])},ki=({clientThreadId:t,categorySuggestions:n,lastMessageId:a,analyticsMetadata:s,style:o="default"})=>{const r=n.map(({category_id:i,title:u,suggestions:d})=>({value:i,message:u,suggestions:d?.map(Ms)??[]})),[c,m]=l.useState(r[0].value);return Ci(r,s),e.jsxs(Oa,{value:c,onValueChange:m,orientation:"horizontal",className:"flex w-full flex-col",children:[e.jsx(Ha,{className:"border-token-border-default relative flex w-full flex-row gap-6 border-b",children:r.map((i,u)=>e.jsx(Ii,{value:i.value,message:i.message,isActive:c===i.value,analyticsMetadata:s,position:u+1},i.value))}),r.map(i=>e.jsx(Ga,{value:i.value,children:e.jsx(wi,{initialSuggestions:i.suggestions,clientThreadId:t,categoryId:i.value,isActive:c===i.value,lastMessageId:a,analyticsMetadata:s,style:o})},i.value))]})},wi=({initialSuggestions:t,clientThreadId:n,categoryId:a,isActive:s,lastMessageId:o,analyticsMetadata:r,style:c="default"})=>{const m=te(n),i=s&&t.length===0,{suggestions:u,isLoading:d}=za({categoryId:a,shouldFetch:i,serverThreadId:m,lastMessageId:o}),f=i?u:t;return a==="ask"?d?e.jsx(yi,{}):e.jsx(nn,{followups:f.map(p=>({type:Cs.Reply,text:p.prompt})),analyticsMetadata:r}):e.jsx("div",{className:"flex w-full flex-col gap-y-4 py-3 md:flex-row md:gap-x-4",children:d?e.jsxs(e.Fragment,{children:[e.jsx(cs,{}),e.jsx(cs,{})]}):e.jsx(on,{clientThreadId:n,suggestions:f,analyticsMetadata:r,style:c})})},Ii=({value:t,message:n,isActive:a,analyticsMetadata:s,position:o})=>e.jsxs(Va,{className:"text-token-text-tertiary hover:text-token-text-secondary radix-state-active:text-token-text-primary relative flex min-w-10 justify-center py-4 text-sm font-medium",value:t,onClick:()=>{rt("click",t,s,o)},onMouseEnter:()=>{rt("hover",t,s,o)},children:[e.jsx("div",{className:"truncate",children:n}),e.jsx(ye,{children:a&&e.jsx(O.div,{layoutId:"tab-underline",className:"bg-token-text-primary absolute start-0 end-0 bottom-0 h-0.5",transition:{type:"spring",stiffness:500,damping:30}})})]}),cs=()=>e.jsxs("div",{className:"flex flex-1 items-center gap-4 rounded-xl p-2",children:[e.jsx("div",{className:"bg-token-sidebar-surface-secondary dark:bg-token-border-default h-16 w-14 flex-shrink-0 rounded-lg"}),e.jsx("div",{className:"w-full flex-grow",children:e.jsx(Zs,{lines:3,size:"sm"})})]}),Ei=({clientThreadId:t,categorySuggestions:n,lastMessageId:a,analyticsMetadata:s})=>{if(!n||n.length===0)return null;const o=n.length===1,r=n[0],c=r.suggestions.length>0?r.suggestions:void 0;return o&&c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-1 text-sm font-semibold",children:e.jsx(A,{id:"3UFIQc",defaultMessage:"Follow up"})}),e.jsx(on,{clientThreadId:t,suggestions:c.map(Ms),analyticsMetadata:s,style:r.style})]}):e.jsx(ki,{clientThreadId:t,categorySuggestions:n??[],lastMessageId:a,analyticsMetadata:s})};function Ri({clientThreadId:t,followups:n,categorySuggestions:a,lastMessageId:s,analyticsMetadata:o}){const[r,c]=l.useState(null),m=ks.useIsEnabled(t),{capabilitySuggestionsEnabled:i}=ws(),u=a&&a.length>0;return e.jsxs(e.Fragment,{children:[e.jsx(Fi,{visible:r==="conversation"}),e.jsx(Ai,{visible:r==="global"}),m&&(i?u&&e.jsx(Ei,{clientThreadId:t,lastMessageId:s,categorySuggestions:a,analyticsMetadata:o}):n.length>0&&e.jsx(Ni,{clientThreadId:t,followups:n,analyticsMetadata:o,setDisableMessage:c}))]})}function Ni({clientThreadId:t,followups:n,setDisableMessage:a,analyticsMetadata:s}){const{value:o}=tt("2281969373"),{value:r}=tt("2076592918");return e.jsxs("div",{className:"group",children:[r?e.jsx("hr",{className:"bg-token-bg-tertiary mt-5 mb-5 opacity-70"}):e.jsxs("div",{className:"mb-1 flex items-center text-sm font-semibold",children:[e.jsx(A,{id:"3UFIQc",defaultMessage:"Follow up"}),!o&&e.jsx(Pi,{clientThreadId:t,setDisableMessage:a,analyticsMetadata:s})]}),e.jsx(nn,{followups:n,analyticsMetadata:s,isV2Enabled:r})]})}function Pi({clientThreadId:t,setDisableMessage:n,analyticsMetadata:a}){const s=ks.useStore(),[o,r]=l.useState(!1);return e.jsxs(vs,{size:"small",onOpenChange:c=>r(c),contentClassName:"min-w-[200px]",triggerButton:e.jsx("button",{className:"text-token-text-tertiary hover:bg-token-main-surface-tertiary ms-2 flex h-6 w-6 items-center justify-center rounded-md focus:ring-0 focus:outline-hidden",children:e.jsx(bs,{className:L("h-4 w-4 opacity-0 group-hover:opacity-100",o&&"opacity-100")})}),children:[e.jsx(K.Item,{onClick:()=>{s.setDisabledConversation(t,!0),n("conversation"),setTimeout(()=>n(null),3e3),B.logEventWithStatsig("chatgpt_message_followup_setting","chatgpt_message_followup_setting",{...Q(a),action:"disable_conversation"})},className:"text-token-text-primary",children:e.jsx(A,{id:"GZYofd",defaultMessage:"Hide for this chat"})}),e.jsx(K.Item,{onClick:()=>{s.setDisabledGlobally(!0),n("global"),setTimeout(()=>n(null),5e3),B.logEventWithStatsig("chatgpt_message_followup_setting","chatgpt_message_followup_setting",{...Q(a),action:"disable_globally"})},className:"text-token-text-primary",children:e.jsx(A,{id:"dtAOq4",defaultMessage:"Hide everywhere"})})]})}const rn={initial:{opacity:1},animate:{opacity:1},exit:{opacity:0,transition:{duration:.2}}};function Fi({visible:t}){return e.jsx(ye,{children:t&&e.jsx(O.div,{...rn,className:"text-token-text-tertiary flex justify-center py-6 text-sm",children:e.jsx(A,{id:"ckTD9g",defaultMessage:"Follow ups are turned off for this conversation"})})})}function Ai({visible:t}){return e.jsx(ye,{children:t&&e.jsxs(O.div,{id:"disableForAllConvos",...rn,className:"flex flex-col items-center py-3 text-sm",children:[e.jsx("div",{children:e.jsx(A,{id:"5GDIBQ",defaultMessage:"Follow up have been turned off"})}),e.jsx("div",{className:"text-token-text-tertiary pt-1",children:e.jsx(A,{id:"LYaBNe",defaultMessage:"You can re-enable them in settings"})})]})})}function Li({modelSlug:t,animateModelLabelOnRender:n,isDropdownOpen:a,isRegenerateEnabled:s,isHovered:o,animateShortLabel:r}){const{data:c}=Mr(),[m,i]=l.useState("initial");l.useEffect(()=>{if(n){const p=setTimeout(()=>i("show"),500),x=setTimeout(()=>i("initial"),2e3);return()=>{clearTimeout(p),clearTimeout(x)}}i("initial")},[n]);const{shorterLabel:u}=c?.categories.find(({defaultModel:p})=>p===t)??{},d={initial:{opacity:0,paddingLeft:0,width:"0"},show:{opacity:1,paddingLeft:2,width:"100%"},visible:{opacity:1,paddingLeft:2,width:"100%",transition:{delay:0,duration:0}}},f=a?"visible":o?"show":m;return e.jsxs(O.div,{initial:"initial",animate:f,className:"flex items-center pb-0",children:[e.jsx(lt,{className:"icon-md"}),(s||r)&&e.jsx(O.span,{className:"overflow-hidden text-sm text-clip whitespace-nowrap",variants:d,transition:{type:"tween",duration:.18},children:u}),s&&e.jsx(Is,{className:"icon-sm"})]})}function Ye(t,n){const{modelSwitcherDeny:a,subscriptionLevel:s}=t;return!!a&&a.reason===wr.RATE_LIMIT&&s===Ir.PLUS&&!n}const Ee="rounded-lg radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed";function Ui({className:t,clientThreadId:n,message:a,onModelSelect:s,canRegenerateResponse:o,withModelSelectorLabel:r=!0}){const[c,m]=l.useState(null),[i,u]=l.useState(!1),[d,f]=l.useState(!1),p=a.metadata?.model_slug,x=a.id,g=l.useRef(null),T=b=>{b||setTimeout(()=>{g.current&&g.current.blur()},10)};l.useEffect(()=>{T(i)},[i]);const C=se(n,to),w=Tr({clientThreadId:n}),R=l.useRef(w);l.useEffect(()=>{R.current=w},[w]);const F=l.useCallback(b=>{R.current?ge(n,v=>{v.conduitToken=null,v.prepareState=null}):ge(n,v=>{v.conduitToken=b,v.prepareState="success"})},[n]);if(C)return null;const S=qa(n,a.id),_=a.metadata?.model_slug,I=Ya(S,_);return e.jsxs(K.Root,{onOpenChange:b=>{o&&(_&&Ka(n,_,[],F),u(b),T(b))},children:[o?e.jsx(Wa,{label:r?e.jsx(A,{id:"wDs5sz",defaultMessage:"Switch model "}):e.jsx(A,{id:"/a4cqQ",defaultMessage:"Switch model ({modelSlug})",values:{modelSlug:_}}),children:e.jsx($a,{ref:g,className:L("cursor-pointer",t),onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),children:r?e.jsx(Li,{modelSlug:_,animateModelLabelOnRender:I,isDropdownOpen:i,isRegenerateEnabled:o,isHovered:d}):e.jsxs("div",{className:"flex items-center",children:[e.jsx(lt,{className:"icon-md"}),e.jsx(Is,{className:"icon-sm"})]})})}):null,o&&e.jsx(K.Portal,{children:e.jsxs(K.Content,{className:"text-token-text-primary z-30 min-w-fit origin-top-right",side:"bottom",align:"start",children:[e.jsx(K.Label,{children:e.jsx(A,{id:"bFLh5u",defaultMessage:"Switch model"})}),e.jsx(Di,{clientThreadId:n,messageId:x,message:a,onModelSelect:s,messageModelSlug:p,setHoveredOption:m,hoveredOption:c})]})})]})}function Di({clientThreadId:t,message:n,messageId:a,messageModelSlug:s,onModelSelect:o,setHoveredOption:r,hoveredOption:c}){const m=ae(),{data:i=null}=Cr(),u=i&&kr(i),{modelOptions:d,messageModelEnabledTools:f}=Qa({clientThreadId:t,message:n}),p=f.includes(ne.Search),x=l.useMemo(()=>d.find(S=>S.value===s),[d,s]),[g,T]=l.useMemo(()=>Xa(d,S=>S.subcategory),[d]),C=Ja(n);l.useEffect(()=>{const S=d.some(_=>Ye(_,u));B.logEvent("Conversation Open Message Model Selector",{has_get_plus_button:S,is_new_regen_dropdown:!0})},[]);const w=l.useMemo(()=>{const S=new Map;return g.forEach(_=>{const I=_.subcategory;I&&(S.has(I)||S.set(I,[]),S.get(I)?.push(_))}),S},[g]),R=L("icon-sm","order-10 ms-auto text-token-text-tertiary icon-md"),F=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:m.formatMessage(Ke.search),icon:e.jsx(Za,{className:R}),condition:p&&!C,eventName:"chatgpt_regenerate_with_search_button_clicked"},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:m.formatMessage(Ke.nosearch),icon:e.jsx(eo,{className:R}),condition:p&&C,eventName:"chatgpt_regenerate_without_search_button_clicked"}];return e.jsxs(e.Fragment,{children:[T.map(S=>{const{value:_,...I}=S;return e.jsx(we,{value:_,onSelect:b=>{Z.logEvent("chatgpt_regenerate_switch_model_button_clicked",_,{requestedModelId:_,...Q({clientThreadId:t,messageId:a})}),o({sourceEvent:b,requestedModelId:_})},includeRegenerate:!1,onMouseEnter:()=>r(_),onMouseLeave:()=>r(null),isHovered:c===_,messageModelSlug:s,includeCheck:!1,shouldShowUpsell:Ye(S,u),className:Ee,...I,icon:e.jsx("span",{className:R}),clientThreadId:t},_)}),[...w.entries()].map(([S,_])=>e.jsxs(K.Sub,{children:[e.jsx(K.SubMenuTrigger,{children:e.jsx("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:S})}),e.jsx(K.Portal,{children:e.jsx(K.SubContent,{className:"min-w-fit",children:_.map(I=>{const{value:b,...v}=I;return e.jsx(we,{value:b,onSelect:y=>{Z.logEvent("chatgpt_regenerate_switch_model_button_clicked",b,{requestedModelId:b,...Q({clientThreadId:t,messageId:a})}),o({sourceEvent:y,requestedModelId:b})},includeRegenerate:!1,onMouseEnter:()=>r(b),onMouseLeave:()=>r(null),isHovered:c===b,messageModelSlug:s,includeCheck:!1,className:Ee,...v,icon:null,shouldShowUpsell:Ye(I,u),clientThreadId:t},S+"-"+b)})})})]},S)),!!x&&e.jsxs(e.Fragment,{children:[e.jsx(K.Separator,{}),e.jsx(we,{onSelect:S=>{Z.logEvent("chatgpt_regenerate_try_again_button_clicked",x.value,{requestedModelId:x.value,...Q({clientThreadId:t,messageId:a})}),o({sourceEvent:S,requestedModelId:x.value})},includeRegenerate:!0,onMouseEnter:()=>r(x.value),onMouseLeave:()=>r(null),messageModelSlug:s,includeCheck:!1,className:Ee,...x,label:m.formatMessage(Ke.tryAgain),subtitle:x.label,icon:e.jsx(lt,{className:R}),clientThreadId:t},x.value),F.filter(S=>S.condition).map(S=>e.jsx(we,{onSelect:_=>{Z.logEvent(S.eventName,x.value,{requestedModelId:x.value,...Q({clientThreadId:t,messageId:a})}),o({sourceEvent:_,requestedModelId:x.value,extraStreamParams:S.extraStreamParams})},includeRegenerate:!1,onMouseEnter:()=>r(S.key),onMouseLeave:()=>r(null),isHovered:c===S.key,messageModelSlug:s,includeCheck:!1,className:Ee,...x,label:S.label,subtitle:"",icon:S.icon,clientThreadId:t},S.key))]})]})}const Ke=fs({tryAgain:{id:"VbsBGW",defaultMessage:"Try again"},search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),Bi=l.memo(Ui);async function Oi(t,n,a,{unprocessed:s=!1}={}){const o=[],r=[],c={};for(const m of t.messages){if(Hi(m)){const i=m.metadata?.content_references,u=$s(m);if(s)o.push(u);else{const d=ii(u,i);d["text/plain"]&&o.push(d["text/plain"]),d["text/html"]&&r.push(d["text/html"])}}if(Er(m)){const i=pt.getImageAssetPointers(m);if(i.length>0){const u=i[0];try{const d=te(a),{url:f}=await so.fetch(n,{asset:u,conversationId:d??void 0}),x=await(await fetch(f)).blob();["image/png","image/jpeg","image/webp"].includes(x.type)&&(c[x.type]=x)}catch{return Promise.reject()}}}}return o.length>0&&(c["text/plain"]=o.join(`

`)),r.length>0&&(c["text/html"]=r.join(`

`)),c}function Hi(t){return!t.clientMetadata?.err&&(t.author.role===V.Assistant||t.author.role===V.User)&&(t.author.role===V.User||t.recipient==="all")&&!t.metadata?.reasoning_status}const ln=async(t,n,a,s,o,r="mouse",c)=>{const i=D.getConversationTurns(be(n))[a];if(!i)return Promise.reject();const{messages:u}=i,d=o,f=u[0]?.author.role===V.User,p=d.metaKey||d.altKey,x=await Oi(i,c,n,{unprocessed:p||f});await no(x,s,o);const g=te(n);g&&ao(t,{messageId:u[0].id,type:"copy",serverThreadId:g,selectedText:$s(u[0]),source:r,location:"message"})},Gi=null,Vi=oe(()=>pe(()=>import("./lhc0r3g2ikd4jwhx.js"),__vite__mapDeps([28,2,1,3,29,5,6,30,31])).then(t=>t.VoicePlayButton)),zi=oe(async()=>()=>null),qi=({alwaysShow:t,isUserTurn:n,children:a})=>{const s=l.useRef(null);return l.useEffect(()=>{const o=s.current;o&&(t?requestAnimationFrame(()=>{o&&(o.style.maskPosition=t?"0% 0%":"")}):o.style.maskPosition="")},[t]),e.jsx("div",{className:L("flex",!t&&"absolute start-0 end-0 flex",n?"justify-end":"justify-start"),children:e.jsx("div",{ref:s,className:L("touch:-me-2 touch:-ms-3.5 -ms-2.5 -me-1 flex items-center p-1 select-none",!n&&"-mt-1",t&&"duration-[1.5s]","focus-within:transition-none hover:transition-none",!(t||n)&&"duration-500 group-hover/turn-messages:delay-300",!n&&["pointer-events-none [mask-image:linear-gradient(to_right,black_33%,transparent_66%)] [mask-size:300%_100%] [mask-position:100%_0%] motion-safe:transition-[mask-position]","group-hover/turn-messages:pointer-events-auto group-hover/turn-messages:[mask-position:0_0]","group-focus-within/turn-messages:pointer-events-auto group-focus-within/turn-messages:[mask-position:0_0]","has-data-[state=open]:pointer-events-auto has-data-[state=open]:[mask-position:0_0]"],n&&["duration-300 group-hover/turn-messages:delay-300","pointer-events-none opacity-0 motion-safe:transition-opacity","group-hover/turn-messages:pointer-events-auto group-hover/turn-messages:opacity-100","group-focus-within/turn-messages:pointer-events-auto group-focus-within/turn-messages:opacity-100","has-data-[state=open]:pointer-events-auto has-data-[state=open]:opacity-100"]),children:a})})},Wi=({activeVariantIndex:t,clientThreadId:n,conversationMode:a,lastMessage:s,messages:o,numVariants:r,onChangeIndex:c,onRate:m,showCanvasButton:i,showCopyButton:u,showPagination:d,showPlayButton:f,showRatingButtons:p,showRegenerateButton:x,isJam:g,turn:T,turnIndex:C})=>{const w=ht(),R=ae(),F=Fe(),S=xs(),_=Ne(w,"4061070236"),I=s?.clientMetadata?.rating;s?.clientMetadata?.requestId;const b=Rr(o,H=>{const[he]=H.author.name?.split(".")??[];return he===Nr.T2UAY3K&&pt.getImageAssetPointers(H).length>0}),v=o.filter(Pr).filter(H=>H.recipient==="all"),y=!!b,N=Ys(),k=ro(),h=io(),M=te(n),z=y&&v.length===0&&Fr(b),E=!g&&M!=null,U=!N&&b?.status==="finished_successfully"&&k(),ie=!N&&!b&&lo(w);let le=null;return E&&(U||ie?le=e.jsx(Ki,{clientThreadId:n,imageGenMessageId:b?.id,messages:o}):h&&Ks(w,"1547743984").get("show_share_button_inline",!1)&&(le=e.jsx(ve,{onClick:()=>{M&&Ns.openSharingModal(M)},label:R.formatMessage({id:"ConversationTurn.shareButtonTooltip",defaultMessage:"Share conversation"}),className:"sm:hidden",icon:Rs}))),l.useMemo(()=>o.findLast(H=>H.metadata?.n7jupd_schedulable),[o]),co(s)?null:e.jsxs(e.Fragment,{children:[!1,d&&e.jsx(Es,{currentPage:t,onChangeIndex:c,length:r}),!1,u&&!z&&e.jsx(cn,{onClick:H=>{ln(w,n,C,F,H,"mouse",S)}}),!y&&p&&e.jsxs(e.Fragment,{children:[I!=="thumbsDown"&&e.jsx(ve,{onClick:()=>m("thumbsUp"),disabled:I==="thumbsUp",icon:I==="thumbsUp"?uo:Ps,label:R.formatMessage({id:"ConversationTurn.goodResponseTooltip",defaultMessage:"Good response"}),testId:"good-response-turn-action-button"}),I!=="thumbsUp"&&e.jsx(ve,{onClick:()=>m("thumbsDown"),disabled:I==="thumbsDown",icon:I==="thumbsDown"?mo:Fs,label:R.formatMessage({id:"ConversationTurn.badResponseTooltip",defaultMessage:"Bad response"}),testId:"bad-response-turn-action-button"})]}),f&&s&&v.length>0&&e.jsx(Vi,{conversationId:n,message:s,iconClassName:"icon-md",className:"text-token-text-tertiary hover:text-token-text-primary gap-1.5 rounded-md p-1 text-xs"}),!y&&i&&e.jsx(go,{turn:T}),!1,s&&Gi,x&&s&&e.jsx(Yi,{clientThreadId:n,conversationMode:a,lastMessage:s,messages:o,hasImageGenMessage:y,withModelSelectorLabel:!_}),le]})},$i=({activeVariantIndex:t,clientThreadId:n,numVariants:a,onAnticipateEdit:s,onChangeIndex:o,onEnterEdit:r,showCopyButton:c,showEditMessageButton:m,showPagination:i,turnIndex:u})=>{const d=ht(),f=Fe(),p=xs();return e.jsxs(e.Fragment,{children:[c&&e.jsx(cn,{onClick:x=>{ln(d,n,u,f,x,"mouse",p)}}),m&&e.jsx(oo,{onAnticipateEdit:s,onEnterEdit:r}),i&&e.jsx(Es,{currentPage:t,onChangeIndex:o,length:a})]})},Yi=({clientThreadId:t,conversationMode:n,messages:a,hasImageGenMessage:s,lastMessage:o,withModelSelectorLabel:r})=>{const c=xo({clientThreadId:t,conversationMode:n}),m=vo(t,o),i=l.useCallback(({sourceEvent:u,requestedModelId:d,appendMessages:f,extraStreamParams:p})=>{o&&c({sourceEvent:u,nodeId:o.id,requestedModelId:d,appendMessages:f,extraStreamParams:p})},[o,c]);return s?e.jsx(zi,{messages:a,onModelSelect:i}):e.jsx(Bi,{className:"text-token-text-secondary hover:bg-token-bg-secondary touch:px-2.5 h-[30px] rounded-md px-1.5",clientThreadId:t,message:o,onModelSelect:i,canRegenerateResponse:m,withModelSelectorLabel:r})},cn=({onClick:t})=>{const[n,a]=l.useState(!1),s=po(),o=ae(),r=l.useCallback(c=>{c.stopPropagation(),B.logEvent("ChatGPT Turn Action Copy Clicked"),t(c),a(!0),setTimeout(()=>{s()&&a(!1)},2e3),Z.logEvent("chatgpt_turn_action_copy")},[s,t]);return e.jsx(ve,{icon:n?ho:fo,onClick:r,label:o.formatMessage({id:"CopyButton.copyTooltip",defaultMessage:"Copy"}),testId:"copy-turn-action-button"})};function Ki({clientThreadId:t,imageGenMessageId:n,messages:a}){const[s,o]=l.useState(!1),r=ae(),c=a?.find(u=>u.metadata?.b1de6e2_rm)?.id,m=c?[c]:a?.map(u=>u.id)??void 0,i=ei({clientThreadId:t,imageGenMessageId:n,messageSliceIds:m});return l.useEffect(()=>{B.logEventWithStatsig("Share Post: Share Button Shown","chatgpt_post_share_button_shown",{source:"turn_action"})},[]),e.jsx(ve,{onClick:async()=>{o(!0);try{await i()}finally{o(!1)}B.logEventWithStatsig("Share Post: Share Button Clicked","chatgpt_post_share_button_clicked",{source:"turn_action"})},label:r.formatMessage({id:"ConversationTurn.sharePostButtonTooltip",defaultMessage:"Share"}),icon:s?Hs:Rs,disabled:s})}const ds=[1,2,3,4,10,20,30],Qi=1,Xi=["g-67e595af0a408191b84ee532fca12cd1","g-67ec3b78892481918c89067962526695","g-67ec3b4988f8819184c5454e18f5e84b","g-67ec3ad40750819181ccffa6a6f050d5","g-67edaaa3d3a081918205d0c470f00a32","g-67edab030ac881918ce8fa5c75a8e1b3","g-67edab2fc0f48191881a20ac98fedf6f","g-67edab4a24fc8191b975acaa8da2dcef"];function Ji({clientThreadId:t}){const n=As(Ls.isBusinessWorkspace),a=Us(),s=l.useRef(!1),o=ft(t),[r,c,m,i]=se(t,h=>[h?.mode,D.getRequestId(h),D.getConversationLastTurn(h),D.getConversationTurns(h).filter(M=>M.role===V.Assistant).length]),{isUnauthenticated:u}=ct(),d=l.useMemo(()=>{if(!o)return-1;const h=Ss(o);return h()>Qi?-1:ds[Math.floor(h()*ds.length)]},[o]),f=ut(c),p=function(){return Math.random()<.5?"default":"personality_v1"},[x,g]=l.useState(null),[T,C]=l.useState(!1),[w,R]=l.useState(!1),[F,S]=l.useState(!1),[_,I]=l.useState(p),b=(h,M)=>{const z=m?.messages[0]?.id;g(h),I(M),y(z,h,M)},v=m?.role===V.Assistant,y=l.useMemo(()=>bo((h,M,z)=>{o&&h&&(n&&a?yo({rating:_o(M),shown_at_assistant_turn:d,prompt:z},o,h):n||dt.safePost("/conversation/{conversation_id}/rating",{parameters:{path:{conversation_id:o}},requestBody:{message_id:h,rating:M,shown_at_assistant_turn:d,prompt:z},authOption:zs.SendIfAvailable})),B.logEvent("Conversation Rating Submitted",{rating:M,showAtAssistantTurn:d,conversationId:o,prompt:z}),C(!0),setTimeout(()=>{R(!0)},1500)},2e3),[n,a,o,d]),N=i!==d||f||!v||!!n&&!a||r?.kind!==st.PrimaryAssistant&&r?.kind!==st.FlyingCircusCustomization&&r?.gizmo_id!==void 0&&!Xi.includes(r?.gizmo_id)||F||u;l.useEffect(()=>{!N&&!s.current&&(B.logEvent("Conversation Rating Shown",{showAtAssistantTurn:d,conversationId:o}),s.current=!0)},[N]);const k=So();return F||!k.forceShowConvoRating&&N?null:e.jsxs("div",{className:"mx-auto",children:[e.jsx(ye,{children:T&&!w&&e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(us,{$padded:!0,children:e.jsx("span",{className:"text-token-text-tertiary text-sm",children:e.jsx(A,{id:"rating.thanks",defaultMessage:"Thanks for your feedback!"})})})},"submitted")}),!T&&e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},children:e.jsxs(us,{$padded:!1,children:[e.jsxs("div",{className:"text-token-text-secondary flex items-center justify-center gap-4 px-4 py-3 text-sm",children:[_==="personality_v1"?e.jsx(A,{id:"rating.instructions.personality_v1",defaultMessage:"Do you like this personality?"}):e.jsx(A,{id:"rating.instructions.default",defaultMessage:"Is this conversation helpful so far?"}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx(Qe,{$selected:x==="thumbsUp",onClick:()=>b("thumbsUp",_),children:e.jsx(Ps,{className:"icon-md"})}),e.jsx(Qe,{$selected:x==="thumbsDown",onClick:()=>b("thumbsDown",_),children:e.jsx(Fs,{className:"icon-md"})})]})]}),e.jsx("div",{className:"bg-token-main-surface-tertiary w-px flex-1 self-stretch"}),e.jsx(Qe,{className:"p-3",$selected:!1,onClick:()=>S(!0),children:e.jsx(Ar,{className:"icon-md text-token-text-secondary hover:text-token-text-primary"})})]})},"rating")]})}const Qe=re.button`
  ${t=>t.$selected?"text-token-text-primary":"text-token-text-secondary"}
  hover:text-token-text-primary
`,us=re.div`inline-flex rounded-xl border border-gray-100 dark:border-gray-700
${t=>t.$padded&&"py-3 px-4"}
`,Zi=oe(()=>pe(()=>import("./jo7jtgpsehqnlvog.js"),__vite__mapDeps([32,2,1,3,5,6,24])));function el({clientThreadId:t,canShowInlineMessageFeedback:n,messageForRating:a,allGroupedMessages:s,currentModelId:o}){const r=gt()?.isWorkspacePlan()??!1;let c=null;const m=se(t,p=>{const x=D.getConversationTurns(p);let g=0;for(let T=x.length-1;T>=0;T--){const C=x[T];if(C.messages.some(w=>w.metadata?.is_indepth_feedback))return!0;if(C.messages.some(w=>w.author.role===V.Assistant)&&g++,g>=3)break}return!1}),i=ft(t),u=Ds(p=>p.voiceFeedbackThread),d=i===u,{voiceName:f}=jo();return m?null:(d&&i&&!r?(Lr.feedbackShown.success({voice:f}),c=e.jsx("div",{className:"text-center",children:e.jsx(To,{serverThreadId:i})})):a.clientMetadata?.rating&&n?c=e.jsx(Zi,{clientThreadId:t,conversationMessage:a,allGroupedMessages:s,currentModelId:o}):c=e.jsx("div",{className:"text-center",children:e.jsx(Ji,{clientThreadId:t})}),e.jsx("div",{className:"mt-3 w-full empty:hidden",children:c}))}const tl=oe(()=>pe(()=>import("./bav7xjsolx558eu1.js"),__vite__mapDeps([25,1,2,3,5,6,26,27])).then(t=>t.MemoryActionResult)),sl=oe(()=>pe(()=>import("./id0dknkab7cx7d4m.js"),__vite__mapDeps([33,2,5,1,3,6,34,35])).then(t=>t.AutomationSourceHeader)),ms=oe(()=>pe(()=>import("./iq3nfzwf18cw338m.js"),__vite__mapDeps([36,2,1,3,5,6])).then(t=>t.TextMessageEditor)),gs=80,nl=16,ps={minHeight:`calc(100dvh - ${Vo}px - 120px)`};function al(t){const{turnIndex:n,isFinalTurn:a,clientThreadId:s,onRequestCompletion:o,currentModelId:r,avatarClassName:c,showAvatar:m,scrollToMessageId:i,dateHeaderType:u}=t,{isNewScrollEnabled:d}=Bs(),f=ys();gt()?.normalizedAccountUserId;const p=ht(),x=!!f&&Ur(f),g=Mo(),T=As(Ls.isBusinessWorkspace),C=Qo(),w=Ne(p,"1760640904"),R=Ne(p,"4061070236"),F=!!m,_=null!=null,I=Ne(p,"1887864177"),{capabilitySuggestionsEnabled:b}=ws(),v=ni(),[y,N]=se(s,j=>{const W=D.getConversationTurnAtIndex(j,n),Y=n>0?D.getConversationTurnAtIndex(j,n-1):null,G=Y?.role===V.User&&Y.messages.some(q=>q.metadata?.visually_hide_response_from_conversation);return[W,G]}),{messages:k,messageGroups:h}=y,M=Co(),z=k[0],E=P(k),{messages:U,visibleMessages:ie,messageGroups:le,lastMessageToRender:H,doesTurnHaveDelayedMessages:he}=l.useMemo(()=>{const j=M.size===0?-1:h.findIndex(q=>q.type===We?q.groups.some(de=>de.messages.some(ze=>M.has(ze?.id))):q.messages.some(de=>M.has(de?.id))),W=j!==-1&&j+1<h.length,Y=W?h.slice(0,j+1):h,G=W?Y.flatMap(q=>q.type===We?q.groups.flatMap(de=>de.messages):q.messages):k;return{messages:G,visibleMessages:G.filter(Dr),messageGroups:Y,lastMessageToRender:P(G),doesTurnHaveDelayedMessages:j!==-1}},[k,h,M]),X=l.useMemo(()=>({clientThreadId:s,turnIndex:n,messageId:E?.id}),[s,n,E?.id]),dn=!1,[vt,bt]=l.useState(!1),[un,mn]=l.useState(!1),gn=l.useContext(ko)!=null,$=y.role===V.User,yt=Ys(),Se=Br(s),Ae=wo(y.gizmoId??Se).data,Le=Os(s),pn=Io(s),St=Eo(Le),hn=Ro(Le,pn),_t=Us(),[Ue,fn,xn,jt,De,ml,vn,bn,yn,Tt,Sn,ce,Mt,Be,_n]=se(s,j=>{const W=D.getParentPromptNode(j,z.id),Y=W?.message.clientMetadata?.variantsInStreamInfo??(W?.message.metadata?.paragen_variant_choice?void 0:W?.message.metadata?.paragen_variants_info),G=D.getVariantIds(j,z.id),q=D.getCurrentVariantId(j,z.id),de=q?G.indexOf(q):0,ze=Y&&j?.tree!=null&&G.some(ue=>{const{errType:Ht}=j.tree.getLeafFromNode(ue).message.clientMetadata??{};return Ht!=null&&Ht!=="info"}),qe=D.getConversationTurns(j);return[j?.async_status===$e.STREAMING,D.isMessageTurnEnded(j,E?.id),ze,Jo(j?.mode,Ae?.gizmo.id),j?.continuingFromSharedConversationId!=null,null,qe.findIndex(ue=>ue.role===V.User)===n,Zo(qe,ue=>ue.role===V.User)===n,qe.findIndex(ue=>ue.role===V.Assistant)===n,D.getRequestId(j,E?.id),Y,G,de,!!j?.continuingFromSharedPostId,j?.currentLeafId]});let jn="default";const Tn=U.some(j=>j.content.content_type===Re.MultimodalText),Mn=Ks(p,"3119715334").get("should-enable-skip",!1),{isUnauthenticated:Ct}=ct(),kt=y.messages.map(j=>j.id),J=l.useRef(null),wt=!d&&(i?.length??0)>2&&i!=="finalAgentTurn"&&a&&C,_e=$?P(ie):void 0,Oe=_e?.id,Cn=l.useCallback(()=>{Oe&&(B.logEvent("Edit Prompt",{id:Oe,threadId:te(s)}),Or(p,"chatgpt_edit_prompt"),bt(!0))},[Oe,s,p]),kn=l.useCallback(()=>{bt(!1)},[]),It=No()??!1,{onChangeRating:wn}=Po({clientThreadId:s,currentModelConfig:Le}),In=j=>{if(!E)return;wn({nodeId:E.id,messageId:E.id,rating:j});const W=It&&h.some(Y=>Y.type!==We&&Y.messages?.some(Xo));B.logEventWithStatsig(j==="thumbsDown"?"Message Feedback Thumbs Down Clicked":"Message Feedback Thumbs Up Clicked","chatgpt_thumb_feedback",{id:E.id,threadId:te(s),model:r,rating:j,...It?{isCATriggered:W}:{}}),mn(!0)},[En]=l.useState(()=>Date.now()),Rn=ft(s),Et=Fo(s)?.value,Nn=Et===$e.STREAMING,Pn=Et===$e.REALTIME,Rt=Tt!=null,Fn=ut(Tt),An=Wt.useState(j=>Wt.isReplayInProgress(j,_n)),ee=!fn&&Fn||he||Pn||An&&a,Nt=Gs(),[Ln,Pt]=l.useState(Rt),Ft=l.useRef(!1),Un=Ao(s,E),[,Dn]=ca(),{isOpen:He}=Xt(),At=Js();l.useEffect(()=>{const W=new URLSearchParams(window.location.search).get("message");!(W!=null&&kt.includes(W))||!J.current||(J.current.scrollIntoView({behavior:"instant"}),Dn(G=>(G.delete("message"),G),{replace:!0,preventScrollReset:!0}))},[]),l.useEffect(()=>{if(d)return;const Y=new URLSearchParams(window.location.search).get("message")!=null;if(Ft.current||Y||i===void 0||!J.current||At){i==="finalAgentTurn"&&a&&ge(s,G=>{G.scrollToMessageId=void 0});return}(kt.includes(i)||i==="finalAgentTurn"&&a)&&(Ft.current=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(J.current)if(i==="finalAgentTurn"&&a)J.current.scrollIntoView({behavior:"instant",block:"end"}),ge(s,G=>{G.scrollToMessageId=void 0});else{const G=J.current.offsetHeight;let q;He?q=-8:G>gs?q=gs-G:q=0,J.current.style.scrollMarginTop=`${q+nl}px`,J.current.scrollIntoView({behavior:"smooth"})}})}))},[i,J.current,He,At]);const{showDebugConversationTurns:Bn}=_s(),On=Lo(),Hn=!g&&!De&&!Be&&!yt&&!$,Gn=H?.author.role===V.Assistant?H:null,Vn=H?.metadata?.system_hints?.includes(ne.Research);Uo({isCompletionRequestInProgress:ee,isUserTurn:$,message:Gn});const{isOpen:zn}=Xt(),qn=Do(),je=Bo(jt),Te=!je&&Hn&&a&&Sn?.num_variants_in_stream===2&&ce.length<=2&&!E?.clientMetadata?.inlineComparisonRating&&!xn,Wn=Ds(j=>j.voiceFeedbackThread),fe=a&&(Rt||Rn===Wn),Ge=Ue||ee||Nn,$n=!vt&&!g&&!De&&!Be&&!je&&!zn&&y.role!==V.Developer&&(R?!fe||!Ge:(Ln||fe)&&!Ge),Yn=U.some(j=>Hr(j)===Gr.l1239dk1),Kn=fe&&!ee&&!De&&!Be&&!g&&!Yn&&(I||v||b),Me=E!=null&&!0&&(!T||hn||x||_t)&&!je&&!Ct&&!yt&&!E.metadata?.b1de6e2_s,Qn=(!T||_t)&&Me&&fe&&!Ue&&!ee&&!He,Lt=!g&&!((ee||Ue)&&a)&&ce.length>1&&!Te&&!0,Ut=$&&U.some(j=>Oo(j)?.shouldHideContent),Xn=$&&_e!=null&&!je&&!g&&!Tn&&!Ut&&!Ct&&!0&&!Vn,Jn=E!=null&&(E.clientMetadata?.disclaimers??[]).length===0,Dt=l.useCallback(j=>{ge(s,W=>{mt.setCurrentBranch(W,ce[j])}),B.logEvent("Change Active Node",{intent:"toggle_between"})},[s,ce]),Zn=Ho(y,U,Bn),{toggleThreadSidebar:Bt}=Vr(),Ce=E?.id,ea=l.useCallback(()=>{Ce&&Bt({type:"retrievalResults",clientThreadId:s,turnIndex:n,messageId:Ce})},[Ce,Bt,s,n]),ta=l.useMemo(()=>Go(y,St,!!Se),[St,Se,y]);if(!Zn&&!Te)return wt?e.jsx("div",{style:ps}):null;if(N)return null;const sa=H?.metadata?.followup_prompts?H.metadata.followup_prompts.map(j=>({text:j,type:Cs.Reply})):[],na=H?.metadata?.category_suggestions,aa=!U.some(j=>pt.getAudioAssetPointers(j).length>0)&&!0&&!Se,oa=!ee&&U.some(j=>j.author.role===V.Assistant&&j.metadata?.onboarding?.main_usages),Ve=U.find(j=>!!j.metadata?.onboarding?.examples)?.metadata?.onboarding?.examples,Ot=!Ut&&(!$||w)&&(!a||!ee);return On&&!a&&ie.length===0?null:e.jsxs(zo.Provider,{value:yn,children:[e.jsx(qo,{dateHeaderType:u,turn:y}),e.jsxs("article",{className:L("text-token-text-primary w-full",!d&&i==="finalAgentTurn"&&C?"opacity-0":"",{hidden:gn&&vn}),style:wt?ps:void 0,ref:J,dir:"auto","data-testid":`conversation-turn-${n}`,"data-scroll-anchor":!d&&a,children:[e.jsx(Wo,{role:y.role}),e.jsxs(Je,{verticalPadding:jn,horizontalPadding:Te?"none":"standard",children:[Te?e.jsxs(e.Fragment,{children:[e.jsx(fi,{isFeedbackEnabled:Me,variantIds:ce,conversationTurnMountTime:En,...t}),Mn&&e.jsx("div",{className:"mt-4 flex w-full justify-center",children:e.jsxs(qs,{color:"secondary",className:"text-token-text-primary","data-testid":"paragen-skip-button",onClick:()=>{Vs.publish({kind:"requestCompletion",isForSkippingParagen:!0})},children:[e.jsx($o,{className:"text-token-text-secondary me-1"}),e.jsx(A,{id:"IuTr+b",defaultMessage:"Skip"})]})})]}):e.jsx(Pe,{tabIndex:-1,className:"group/turn-messages focus-visible:outline-hidden",onFocus:()=>Pt(!0),onPointerEnter:()=>Pt(!0),children:e.jsxs(e.Fragment,{children:[dn,!$&&!0&&F&&e.jsx(rl,{children:e.jsx(at,{messages:U,isUserTurn:$,avatarClassName:c,gizmo:Ae})}),e.jsx("div",{className:Ze({isUserTurn:$}),children:e.jsx("div",{className:"relative flex-col gap-1 md:gap-3",children:e.jsxs(e.Fragment,{children:[null,!$&&!g&&e.jsx(tl,{messages:U,clientThreadId:s,gizmoId:Ae?.gizmo.id}),qn&&!$&&e.jsx(sl,{clientThreadId:s,messages:U}),vt&&_e?e.jsx(ms,{message:_e,clientThreadId:s,onRequestCompletion:o,onExitEdit:kn,disabled:Nt}):e.jsx(nt,{allMessages:k,groupedMessagesToRender:le,allGroupedMessages:h,...t,isUserTurn:$,isFinalUserTurn:bn,isCompletionRequestInProgress:ee,isFeedbackEnabled:Me,isFinalTurn:a,hasActiveRequest:Nt}),ta&&e.jsx(vi,{handleShowRetrievalResults:ea,clientThreadId:s,turnIndex:n,responseComplete:!Ge}),oa&&e.jsx(ti,{clientThreadId:s}),Ve&&Ve.length>0&&!ee&&e.jsx(si,{clientThreadId:s,examples:Ve}),$n&&e.jsx(qi,{isUserTurn:$,alwaysShow:fe||R,children:$?e.jsx($i,{activeVariantIndex:Mt,clientThreadId:s,numVariants:ce.length,onAnticipateEdit:ms.prefetch,onChangeIndex:Dt,onEnterEdit:Cn,showCopyButton:Ot,showEditMessageButton:Xn,showPagination:Lt,turnIndex:n}):e.jsxs(e.Fragment,{children:[e.jsx(Wi,{activeVariantIndex:Mt,clientThreadId:s,conversationMode:jt,lastMessage:E,messages:U,numVariants:ce.length,onChangeIndex:Dt,onRate:In,showCanvasButton:Un&&!0,showCopyButton:Ot,showPagination:Lt,showPlayButton:Jn,showRatingButtons:Me,showRegenerateButton:aa,isJam:_,turn:y,turnIndex:n}),R&&e.jsx(Yo,{clientThreadId:s,message:E,turnIndex:n})]})}),Qn&&e.jsx(el,{canShowInlineMessageFeedback:un,clientThreadId:s,messageForRating:E,allGroupedMessages:h,currentModelId:r}),Kn&&e.jsx(Ri,{followups:sa,categorySuggestions:na,clientThreadId:s,lastMessageId:Ce,analyticsMetadata:X})]})})})]})}),e.jsx(Ko,{clientThreadId:s,turn:y,isFinalTurn:a})]})]})]})}const ol=la.memo(al),rl=re.div`shrink-0 flex flex-col relative items-end`;function il(t){const n=D.getConversationTurns(t),a=n.findIndex(o=>o.role===V.Assistant);if(a===-1)return;const s=n[a];for(let o=0;o<s.messageGroups.length;o++)if(s.messageGroups[o].type===Qt.SearchGPTQuery){const c=s.messageGroups.slice(o+1).find(({type:i})=>i===Qt.Text);if(c==null)return;const m=zr(c.messages[0]);if(m?.[0]?.type==="navigation")return{turnIndex:a,navigationCitation:m[0],message:c.messages[0]}}}function ll(t,n){if(n==null||t==null)return t;const a=new Set(t.domains.map(s=>s.url));return{...t,domains:[...t.domains,...n.domains.filter(s=>!a.has(s.url))],safe_urls:[...t.safe_urls??[],...n.safe_urls??[]]}}function cl({clientThreadId:t,prefetchNavlink:n,setPrefetchNavlink:a}){const s=l.use(n),{value:o}=tt("1032814809");l.useEffect(()=>{window.__oai_SSR_NAVLINK&&er.logEvent("Search Tool Page Load Time To Fast Nav SSR",{server_timing:s?.timing},window.__oai_SSR_NAVLINK)},[]),l.useEffect(()=>{s==null&&a(void 0)},[s,a]);const r=l.useMemo(()=>s==null?null:{...s.navlink,domains:s.navlink.domains.map(i=>({...i,subtitle:i.subtitle??i.domain}))},[s]),c=se(t,il),m=l.useMemo(()=>ll(r,c?.navigationCitation),[c,r]);return s==null||m==null?null:e.jsxs("div",{children:[e.jsx(Je,{horizontalPadding:"standard",children:e.jsx(Pe,{children:e.jsx("div",{className:Ze({isUserTurn:!0}),children:e.jsx("div",{className:tr(!0),children:e.jsx(sr,{containsImagesOrAttachments:!1,isUserTurn:!0,children:e.jsx(nr,{text:s.query})})})})})}),e.jsx("div",{className:"-mb-10",children:e.jsx(Je,{horizontalPadding:"standard",children:e.jsx(Pe,{children:e.jsxs("div",{className:Ze({isUserTurn:!1}),children:[e.jsx(ri,{clientThreadId:t,turnIndex:c?.turnIndex??2,nextMessage:c?.message,navigationCitation:m}),o?e.jsxs("div",{className:"text-token-text-secondary relative -top-2 flex justify-end gap-2 font-mono text-xs",children:[e.jsxs("div",{elementtiming:"navlink",children:["server: ",s.timing,"ms"]}),e.jsx(dl,{})]}):null]})})})}),e.jsx(ar,{scriptSrc:"requestAnimationFrame(()=>window.__oai_SSR_NAVLINK=window.__oai_SSR_NAVLINK||performance.now());"})]})}function dl(){const[t,n]=l.useState(null);return l.useEffect(()=>{const a=new PerformanceObserver(s=>{s.getEntries().forEach(o=>{if(o.identifier==="navlink"){const r=o.renderTime;n(c=>c??r)}})});return a.observe({type:"element",buffered:!0}),()=>a.disconnect()},[]),t==null?null:e.jsxs("span",{children:["render: ",t,"ms"]})}function Nl(t){const{prefetchNavlink:n,setPrefetchNavlink:a,clientThreadId:s}=t,{isNewScrollEnabled:o}=Bs(),r=or(s),c=rr(),i=ir().store.useContentAreaDimensions(lr.Header,u=>u?.height?u.height:void 0);return e.jsxs("div",{onCopy:r,className:L("@thread-xl/thread:pt-header-height mt-1.5 flex flex-col text-sm",c&&"keyboard-open:pb-[calc(var(--composer-height,100px)+var(--screen-keyboard-height,0))]",i?null:!o&&"pb-25"),style:{paddingBottom:i},children:[n?e.jsx(qr,{name:"prefetch-navlink",onError:u=>{et.addError("Error with prefetch navlink",{error:u}),a(void 0)},children:e.jsx(l.Suspense,{fallback:null,children:e.jsx(cl,{clientThreadId:s,prefetchNavlink:n,setPrefetchNavlink:a})})}):null,e.jsx(Wr,{children:e.jsx(ul,{isNewScrollEnabled:o,paddingBottom:i,...t})})]})}function ul({onRequestCompletion:t,clientThreadId:n,scrollContainerRef:a,paddingBottom:s,isNewScrollEnabled:o}){const[r,c,m,i]=se(n,h=>[h?.mode,D.getConversationTurnIds(h),h?.conversationOrigin===$r.APPLE,h?.scrollToMessageId]),u=cr(),d=Js(),f=dr(),p=ur(),[x]=mr(),g=gr(),[T]=pr(),C=Os(n),w=hr(C.id),R=r?.kind===st.GizmoMagicCreate?"bg-token-main-surface-primary text-token-text-primary":w;l.useEffect(()=>{u&&(Z.logEvent("chatgpt_continue_conversation_page_loaded"),B.logEvent("Continue Conversation: Page Loaded"),Z.logEvent("chatgpt_conversation_share_page_loaded"),B.logEvent("Share Public Chat: Shared Conversation Loaded"))},[u]);const F=l.useCallback(()=>{o||p({behavior:"smooth"})},[o,p]),S=l.useContext(Yr),_=Kr(S),[I,b]=l.useState(!1),v=(I||!1)&&!_,y=l.useRef(null),N=fr(n),k=d&&!f;return e.jsxs(e.Fragment,{children:[k&&e.jsx(mi,{}),u&&e.jsxs(e.Fragment,{children:[e.jsx(Pe,{children:e.jsx("p",{className:"text-xs text-gray-500",children:e.jsx(A,{id:"threadLayout.sharedConversationCopyDisclaimer",defaultMessage:"This is a copy of a conversation between ChatGPT & Anonymous."})})}),e.jsx("div",{className:"text-token-text-primary text-center text-xs font-semibold",children:e.jsx("button",{onClick:()=>{Ns.openModal(xr.ReportConversation),Z.logEvent("chatgpt_conversation_share_report_content_clicked",null,{location:"Static Shared Thread Page"}),B.logEvent("Share Public Chat: Report Content Clicked",{location:"Dynamic Shared Thread Page"})},children:e.jsx(A,{id:"thread.reportSharedConversation",defaultMessage:"Report content"})})})]}),c.map((h,M)=>e.jsx(ol,{isFinalTurn:M===c.length-1,turnIndex:M,clientThreadId:n,onRequestCompletion:t,currentModelId:C.id,avatarClassName:R,scrollToBottom:o?void 0:F,scrollToMessageId:o?void 0:i,dateHeaderType:N(M),showAvatar:void 0},h)),!o&&e.jsxs(e.Fragment,{children:[a?.current&&e.jsx(vr,{setIsScrolledToEdge:h=>{b(h)},options:{root:a.current,threshold:0,rootMargin:"0%"}},"threadBottomEdgeScrollObserver"),e.jsx("div",{ref:y}),m&&x&&!T&&e.jsx(hs,{className:L("translate-y-[10px] md:translate-y-[30px]"),onClick:()=>{Z.logEvent("chatgpt_thread_scroll_to_top"),g({behavior:"smooth"})},children:e.jsx(br,{className:"icon-md text-token-text-primary"})}),e.jsx(ye,{children:v&&e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15,ease:"easeInOut"},children:e.jsx(hs,{className:L(s?null:"bottom-8"),style:{bottom:s},onClick:()=>{Z.logEvent("chatgpt_thread_scroll_to_bottom"),y.current?.scrollIntoView({behavior:"smooth",block:"end"})},children:e.jsx(yr,{className:"icon-md text-token-text-primary"})})})})]})]})}const hs=re.button`cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-token-text-secondary border-token-border-default end-1/2 translate-x-1/2 bg-token-main-surface-primary w-8 h-8 flex items-center justify-center`;export{tn as P,Rl as S,Nl as T,El as a};
//# sourceMappingURL=hatmfprcm0t26pcx.js.map
