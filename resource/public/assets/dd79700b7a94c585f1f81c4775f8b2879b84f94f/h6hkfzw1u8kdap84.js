import{f as L,r as x,j as e,g as q,a6 as te,a5 as F,M as B}from"./cs2gapsc2bulabhw.js";import{p as se,dq as ne,dr as ie,ds as le,dt as oe,dv as re,c as N,du as de,dc as ce,B as D,cp as z,dB as K,a9 as ge,co as me,F as Q,aa as ue,aC as fe,aJ as O,e as P,j as xe}from"./eb6xg52mym6rhnsh.js";import{hJ as he,hK as W,bA as pe,ad as Ie,ae as ve,eT as we,dB as be,ci as je,hL as _e,eQ as Me,hM as ye,hN as T,cU as Ce,b8 as X,ds as ke,a$ as Se,b0 as Ne,b6 as Ee,b7 as Ve,eS as De,b9 as Te,am as J,al as Y,aX as Z,db as A,hO as Oe,hP as Pe,fr as Ae}from"./pduvb49qgyq1mqhk.js";import{D as Fe,a as ee,u as Le,I as R}from"./jkqdpka3582aq7je.js";import{b as Re}from"./h71lg9jejkufcc57.js";import{T as E}from"./j0zvljvurep0tkuq.js";import"./do5nmvaddt7ak8xi.js";import"./e95x0gs5di7mq1tw.js";const Ge={enter:a=>({zIndex:0,x:a===-1?"10%":"-10%",opacity:0}),center:{zIndex:1,x:0,opacity:1},exit:a=>({zIndex:0,x:a===1?"10%":"-10%",opacity:0})},Be={enter:{opacity:0,y:"10%"},visible:{opacity:1,y:0},exit:{opacity:0,y:"10%"}},ze=1e3,We=1e3,$=(a,n)=>Math.abs(a)*n;function $e(a){const n=L(),i=se(),l=he(),m=[W.Small,W.Mobile].includes(l),[I,u]=x.useState({width:0,height:0}),[d,h]=x.useState(!1),[o,p]=x.useState(a.image),[v,b]=x.useState(!1),C=I.width>0&&I.height>0,M=x.useRef(null),[r,f]=x.useState(0);x.useEffect(()=>{if(!o.url)throw new Error("ExpandableImage requires a src");const s=new Image;s.onload=()=>{u({width:s.naturalWidth,height:s.naturalHeight})},s.onerror=()=>{},s.src=o.url},[o.url]),x.useEffect(()=>{const s=M.current;if(v)return s?.addEventListener("keydown",j),()=>{s?.removeEventListener("keydown",j)};p(a.image)},[v]);function c(){p(s=>{const k=(a.images.findIndex(y=>y.url===s.url)+1)%a.images.length;return a.images[k]}),f(-1)}function t(){p(s=>{const w=a.images.findIndex(y=>y.url===s.url),k=w>0?(w-1)%a.images.length:a.images.length-1;return a.images[k]}),f(1)}function g(s){b(s),s&&a.onOpen?.(o)}function j(s){s.key==="ArrowLeft"?t():s.key==="ArrowRight"&&c()}const V=a.images.findIndex(s=>s.url===o.url);return e.jsxs(ne,{onOpenChange:g,children:[e.jsx(ie,{disabled:!C,className:a.className,"aria-label":n.formatMessage(S.showImage),children:a.children}),e.jsx(le,{container:i?.document.body,children:e.jsx(oe,{className:"radix-state-open:animate-show fixed inset-0 z-20 flex items-center justify-center bg-black/90 backdrop-blur-xl",children:e.jsxs(re,{className:N("radix-state-open:animate-contentShow relative flex h-[100dvh] w-screen justify-stretch divide-x divide-white/10 focus:outline-hidden"),ref:M,children:[e.jsx("div",{className:N("flex flex-1 transition-[flex-basis]",!d&&"md:basis-[75vw]"),children:e.jsxs("div",{className:"flex flex-1 flex-col md:p-6",children:[e.jsxs("div",{className:"flex justify-between px-6 py-2 pt-6 text-white sm:mb-4 md:mt-2 md:px-0 md:py-2",children:[e.jsx(de,{asChild:!0,children:e.jsx("button",{"aria-label":n.formatMessage(S.closeModal),children:e.jsx(ce,{})})}),e.jsx("div",{children:!m&&e.jsxs(e.Fragment,{children:[a.getActions?.(o)?.map((s,w)=>e.jsx(D,{color:"ghost",size:"small",onClick:s.onClick,"aria-label":s.ariaLabel,disabled:s.disabled,icon:s.icon},w)),e.jsx(D,{color:"ghost",size:"small",onClick:()=>h(s=>!s),"aria-label":n.formatMessage(S.toggleSidebar),className:"md:inline-flex",icon:pe})]})})]}),e.jsx("div",{className:"relative flex flex-1 flex-col items-center justify-center overflow-hidden",children:e.jsx(te,{initial:!1,custom:r,children:e.jsxs(F.div,{className:"absolute grid h-full w-full grid-rows-2",custom:r,variants:Ge,drag:"x",dragConstraints:{left:0,right:0},dragElastic:1,onDragEnd:(s,{offset:w,velocity:k})=>{const y=$(w.x,k.x);y<-1e3?c():y>ze&&t()},children:[e.jsx(F.img,{src:o.url,alt:o.alt,className:"row-span-4 mx-auto h-full object-scale-down",onPanEnd:(s,{offset:w,velocity:k})=>{const y=$(w.y,k.y);y<-1e3?h(!0):y>We&&h(!1)}},o.url),m&&d&&e.jsx(F.div,{className:"flex text-white",variants:Be,initial:"enter",animate:"visible",exit:"exit",transition:{y:{type:"spring",stiffness:300,damping:30},opacity:{duration:.2}},children:a.metadataRenderer(o)})]},o.url)})}),a.images.length>1?e.jsxs("div",{className:"flex items-center justify-center gap-4 p-8 text-white",children:[e.jsx(D,{color:"ghost",size:"small",onClick:t,"aria-label":n.formatMessage(S.previousImage),icon:Ie}),a.images.map((s,w)=>e.jsx("img",{src:s.url,alt:s.alt??"",className:N("h-12 w-12 cursor-pointer rounded-sm object-cover transition duration-300 hover:opacity-100",s.url===o.url?"ring-2 ring-white ring-offset-4 ring-offset-black":"opacity-25"),onClick:()=>{p(s),f(w<V?1:-1)},"aria-label":n.formatMessage(S.showImage),role:"button"},s.url)),e.jsx(D,{color:"ghost",size:"small",onClick:c,"aria-label":n.formatMessage(S.nextImage),icon:ve})]}):null]})}),e.jsx("div",{className:N("hidden items-center justify-start overflow-hidden bg-gray-900 text-white transition-[flex-basis] duration-500 md:flex",d?"md:basis-[25vw]":"md:basis-0"),children:e.jsx("div",{className:"w-[25vw] min-w-[25vw]",children:a.metadataRenderer(o)})})]})})})]})}const S=q({showImage:{id:"imageViewer.showImage",defaultMessage:"Show Image"},closeModal:{id:"imageViewer.closeModal",defaultMessage:"Close Modal"},toggleSidebar:{id:"imageViewer.toggleSidebar",defaultMessage:"Toggle Sidebar"},nextImage:{id:"imageViewer.nextImage",defaultMessage:"Next Image"},previousImage:{id:"imageViewer.previousImage",defaultMessage:"Previous Image"}});function Ue({withLottie:a}){return e.jsxs("div",{className:"absolute start-0 top-0 flex h-full w-full items-center justify-center rounded-full",children:[e.jsx(Fe,{animate:a,matchTextColor:!0,className:"h-6 w-6"}),e.jsx(He,{})]})}function He(){const[n,i]=x.useState(new Date);x.useEffect(()=>{i(new Date)},[]);const l=we(+n,25e3);return e.jsx(be,{percentage:l,thickness:1.25/23,className:"absolute start-1/2 top-1/2 h-10 w-10 -translate-x-1/2 -translate-y-1/2",backgroundStrokeClassName:"stroke-token-main-surface-tertiary",transitionDuration:`${(100-l)/100*.2}s`,transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)"})}function oa({messages:a,clientThreadId:n,disableClickThru:i=!1}){const[l,m]=a,I=je(l),u=_e(),d=a.some(p=>u.has(p.id));let h=null;m!=null&&z.isMultimodalTextMessage(m)&&(h=z.getImageAssetPointers(m));let o=E.Running;return h!=null?o=E.Finished:m!=null?o=E.Error:I&&(o=E.Stopped),e.jsx(ee.Provider,{value:i,children:!d&&e.jsx(Ke,{imageAssets:h??[],clientThreadId:n,toolStatus:o,toolMessage:m,messageId:l.id})})}const qe="https://help.openai.com/en/articles/8932459",Ke=({imageAssets:a,clientThreadId:n,toolMessage:i,toolStatus:l,messageId:m})=>{const I=L(),u=K(n),d=Me(a,void 0,u),{value:h}=ge("4132051975"),o=ye(n),p=x.useMemo(()=>l===E.Finished&&d.every(r=>!!r.data),[l,d]);if(i?.content.content_type===me.SystemError)return null;const v=ae(a[0]),b=d.map(r=>r.data).filter(r=>r!=null),C=b.map(r=>({...r,alt:T(r)})),M=(r=0)=>`${m}-image-${r}`;return e.jsxs("div",{children:[e.jsxs(Ye,{$numItems:d.length,className:"my-1 transition-opacity duration-300",children:[d.length===0&&l===E.Running&&e.jsx(U,{layoutId:"loading:placeholder",shape:v,isToolRunning:!0},"loading"),d.map((r,f)=>{const{isLoading:c,data:t,error:g}=r;if(c)return e.jsx(U,{shape:v,layoutId:M(f)},f);if(g!=null||t?.url==null)return e.jsx(G,{layoutId:M(f),className:"text-token-text-tertiary text-sm",shape:v,children:e.jsx("div",{className:"flex min-h-full flex-col items-center justify-center gap-3 px-4 pb-5",children:I.formatMessage(_.imageLoadError)})},f);if(i&&t){const j={...t,alt:T(t)};return e.jsx(Qe,{image:j,allImages:C,clientThreadId:n,toolMessage:i,index:f,onOpenImageEditor:()=>{Ce.setFocusedObject({type:X.Image,image:j,allImages:b,messageId:i.id})}},f)}})]}),h&&p&&e.jsx("div",{className:"text-md text-token-text-tertiary flex flex-row items-center py-2",children:e.jsx("span",{className:"me-2",children:o?e.jsx(B,{id:"xQcNUs",defaultMessage:"Made with the old version of image generation. <link>Learn more</link>",values:{link:r=>e.jsx("a",{className:"text-token-text-tertiary underline underline-offset-4",href:qe,target:"_blank",rel:"noopener noreferrer",children:r})}}):e.jsx(B,{id:"pvSitT",defaultMessage:"Made with the old version of image generation. New images <link>coming soon</link>.",values:{link:r=>e.jsx("a",{className:"text-token-text-tertiary underline underline-offset-4",href:"https://openai.com/index/introducing-4o-image-generation/",target:"_blank",rel:"noopener noreferrer",children:r})}})})})]})};function Qe({toolMessage:a,clientThreadId:n,allImages:i,image:l,index:m,onOpenImageEditor:I}){const u=L(),d=K(n),h=ae(l),o=x.useContext(ee),[p,v]=x.useState({}),b=Le({clientThreadId:n});async function C(t){Oe(t,d,a.id,o)}function M(t){O.logEvent("chatgpt_dalle_image_view_full",null,{sourceOperation:t.metadata?.dalle?.edit_op??"none",hasParent:t.metadata?.dalle?.parent_gen_id?"true":"false",model:"dalle"}),P.logEvent("chatgpt_dalle_image_view_full",{conversationId:d,messageId:a.id,generationId:t.metadata?.dalle?.gen_id,parentGenerationId:t.metadata?.dalle?.parent_gen_id,fileId:A(t.asset_pointer),sourceOperation:t.metadata?.dalle?.edit_op,model:"dalle"}),O.logEvent("chatgpt_image_view_full",null,{sourceOperation:t.metadata?.dalle?.edit_op??"none",hasParent:t.metadata?.dalle?.parent_gen_id?"true":"false",model:"dalle"}),P.logEvent("chatgpt_image_view_full",{conversationId:d,messageId:a.id,generationId:t.metadata?.dalle?.gen_id,parentGenerationId:t.metadata?.dalle?.parent_gen_id,fileId:A(t.asset_pointer),sourceOperation:t.metadata?.dalle?.edit_op,model:"dalle"})}function r(t,g){v(V=>({...V,[t.asset_pointer]:g}));const j=o?"chatgpt_dalle_image_captioning_rating":"chatgpt_dalle_image_rating";O.logEvent(j,g?"like":"dislike",{liked:g?"true":"false",sourceOperation:t.metadata?.dalle?.edit_op??"none",hasParent:t.metadata?.dalle?.parent_gen_id?"true":"false",model:"dalle"}),P.logEvent(j,{liked:g,conversationId:d,messageId:a.id,generationId:t.metadata?.dalle?.gen_id,parentGenerationId:t.metadata?.dalle?.parent_gen_id,fileId:A(t.asset_pointer),sourceOperation:t.metadata?.dalle?.edit_op,model:"dalle"}),O.logEvent("chatgpt_image_rating",g?"like":"dislike",{liked:g?"true":"false",sourceOperation:t.metadata?.dalle?.edit_op??"none",hasParent:t.metadata?.dalle?.parent_gen_id?"true":"false",model:"dalle"}),P.logEvent("chatgpt_image_rating",{liked:g,conversationId:d,messageId:a.id,generationId:t.metadata?.dalle?.gen_id,parentGenerationId:t.metadata?.dalle?.parent_gen_id,fileId:A(t.asset_pointer),sourceOperation:t.metadata?.dalle?.edit_op,model:"dalle"})}function f(t){const g=p[t.asset_pointer],j={label:u.formatMessage(_.likeImage),onClick:()=>r(t,!0),disabled:g===!0,ariaLabel:u.formatMessage(_.likeImage),icon:J},V={label:u.formatMessage(_.dislikeImage),onClick:()=>r(t,!1),disabled:g===!1,ariaLabel:u.formatMessage(_.dislikeImage),icon:Y},s={label:u.formatMessage(_.downloadImage),onClick:()=>C(t),ariaLabel:u.formatMessage(_.downloadImage),icon:Z};return[g!==!1&&j,g!==!0&&V,s].filter(Boolean)}let c=e.jsx(Je,{image:l,shape:h,rating:p[l.asset_pointer],onDownload:()=>C(l),onRate:(t,g)=>r(t,g),clientThreadId:n,layoutId:void 0});return b?c=e.jsx("div",{role:"button",onClick:I,children:c}):o||(c=e.jsx($e,{image:l,images:i,metadataRenderer:t=>e.jsx(Xe,{image:t}),onOpen:M,getActions:f,children:c})),e.jsx("div",{className:"flex",children:c},m)}function U({shape:a,layoutId:n,isToolRunning:i=!1}){const{isOpen:l}=Re();return e.jsx(G,{shape:a,layoutId:l?void 0:n,children:e.jsx("div",{className:"flex min-h-full items-center justify-center",children:e.jsx(Ue,{withLottie:i})})},"loading")}function Xe({image:a}){const n=L(),[i,l]=x.useState(!1),m=xe();function I(u){const d=T(a);l(!0),Ae(d,m,u),setTimeout(()=>{l(!1)},2e3)}return e.jsxs("div",{className:"flex flex-col items-start gap-3 p-6",children:[e.jsx("div",{className:"text-sm text-gray-300 sm:text-base",children:n.formatMessage(_.imageViewerMetadataTitle)}),e.jsx("div",{className:"max-h-32 overflow-y-auto text-sm md:max-h-[80vh] md:text-lg",children:T(a)}),e.jsx(D,{color:"primary",onClick:I,disabled:i,className:"hidden sm:block",icon:Pe,children:i?n.formatMessage(_.imageViewerMetadataCopyButtonCopied):n.formatMessage(_.imageViewerMetadataCopyButton)})]})}function G({children:a,shape:n,className:i,layoutId:l}){return e.jsxs(F.div,{layoutId:l,className:N("relative",i,n==="1792x1024"&&"aspect-7/4",n==="1024x1024"&&"aspect-square max-w-[400px]",n==="1024x1792"&&"aspect-4/7 max-w-xs","overflow-hidden rounded-2xl"),children:[e.jsx("div",{className:"bg-token-main-surface-secondary pointer-events-none absolute inset-0"}),e.jsx("div",{className:"relative h-full",children:a})]})}function Je({image:a,shape:n,rating:i,onDownload:l,onRate:m,clientThreadId:I,layoutId:u}){const d=ke(),h=Se(Ne.isBusinessWorkspace),o=ue(I,c=>c?.mode),p=Ee(),v=Ve(),b=v?.type===X.Image&&v.image.asset_pointer===a.asset_pointer,{url:C,width:M,height:r}=a,f=!d&&!h&&o?.kind!==fe.GizmoMagicCreate;return e.jsxs(G,{shape:n,className:"group/dalle-image",layoutId:b?void 0:u,children:[e.jsx(De,{alt:T(a),src:C,width:M,height:r}),e.jsx("div",{className:N("pointer-events-none absolute inset-0 rounded-2xl shadow-[inset_0_0_0_1px_rgba(0,0,0,0.1)] dark:shadow-[inset_0_0_0_1px_rgba(255,255,255,0.1)]",b?"bg-black/50 group-hover/dalle-image:bg-black/70":"group-hover/dalle-image:bg-transparent")}),p?!b&&e.jsx("div",{className:"pointer-events-none invisible absolute end-3 top-3 text-white group-hover/dalle-image:visible",children:e.jsx(Te,{})}):e.jsxs(e.Fragment,{children:[f&&e.jsxs(H,{children:[i!==!1&&e.jsx(R,{icon:J,selected:i===!0,onClick:c=>{c.stopPropagation(),m(a,!0)}}),i!==!0&&e.jsx(R,{icon:Y,selected:i===!1,onClick:c=>{c.stopPropagation(),m(a,!1)}})]}),e.jsx(H,{$rightAlign:!0,children:e.jsx(R,{icon:Z,onClick:c=>{c.stopPropagation(),l()}})})]})]})}const H=Q.div`invisible absolute top-3 flex gap-1 group-hover/dalle-image:visible z-2
${({$rightAlign:a})=>a?"end-3":"start-3"}`,Ye=Q.div`grid gap-2
${({$numItems:a})=>a<=1?"grid-cols-1":"grid-cols-2"}`;function ae(a){if(!a)return"1024x1024";const{width:n,height:i}=a;return n>i?"1792x1024":n<i?"1024x1792":"1024x1024"}const _=q({creatingImages:{id:"dalleMessage.creatingImagesV2",defaultMessage:"Creating image"},stopped:{id:"dalleMessage.stoppedV3",defaultMessage:"Stopped creating image"},errorCreating:{id:"dalleMessage.errorCreatingV2",defaultMessage:"Error creating image"},imageLoadError:{id:"dalleMessage.imageLoadError",defaultMessage:"Error loading image"},imageViewerMetadataTitle:{id:"dalleMessage.imageViewerMetadataTitle",defaultMessage:"Prompt"},imageViewerMetadataCopyButton:{id:"dalleMessage.imageViewerMetadataCopyButton",defaultMessage:"Copy"},imageViewerMetadataCopyButtonCopied:{id:"dalleMessage.imageViewerMetadataCopyButtonCopied",defaultMessage:"Copied!"},imageEditButton:{id:"dalleMessage.imageEditButton",defaultMessage:"Edit"},downloadImage:{id:"imageViewer.downloadImage",defaultMessage:"Download Image"},likeImage:{id:"imageViewer.likeImage",defaultMessage:"Like Image"},dislikeImage:{id:"imageViewer.dislikeImage",defaultMessage:"Dislike Image"}});export{oa as default};
//# sourceMappingURL=h6hkfzw1u8kdap84.js.map
