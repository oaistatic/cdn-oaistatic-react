import{L as E,j as D,aj as He,ak as oe,b as T,ai as B,B as b,h as O,af as he,e as W,c as q,fF as Ye,F as Qe,co as Xe,f as Je,aV as $e,fd as es}from"./eb6xg52mym6rhnsh.js";import{f as _,r as d,g as Q,j as e,M as r,a as je,b as X,u as L,a5 as _e,a6 as Ce}from"./cs2gapsc2bulabhw.js";import{d as ss,e as ts,a as as,b as ns}from"./h3nkyfh9oisoqd5o.js";import{b as Z,c as J,d as $,A as is,f as le,g as F,e as os}from"./hhcx8tizv7ae2jru.js";import{jX as ls,bb as rs,c8 as be,sx as ve,j1 as cs,dU as N,en as ye,dZ as ee,fb as we,sy as ds,ac as ke,bA as Me,sz as Ne,sA as us,l as S,rq as H,rr as Se,h as ms,ro as z,rv as se,rw as xs,f5 as fs,hR as Ae,fy as gs,sB as ps,aa as De,fz as Te,fA as G,eh as hs,qF as js,iM as _s,am as Cs,al as re,aT as bs,sC as ce,sD as vs,sE as ys,sF as ws,sG as ks,hs as k,cH as Ms,cI as Ns,fc as Ss}from"./pduvb49qgyq1mqhk.js";import{c as As,u as Ds,g as Ts,p as Fs}from"./fb2gj4fu6zbut62o.js";import{u as Es,l as Is}from"./nmgtr2wzftg19c1p.js";import{d as Ps}from"./bzo48ft2wb6beuij.js";import{c as Rs}from"./nc2b19ca6o3oqru8.js";import{C as Fe,S as Os,u as Ee,R as Ie,A as Pe,g as Re,a as Ls,b as Us,c as Gs,d as Bs,e as Ws,M as qs,D as Y,G as Zs,f as zs}from"./eg5z46aorwdil4xz.js";import{b as te,c as Ks}from"./kmvt5g0oz7ekj3ft.js";import{A as Vs}from"./gwmccaevv0qfz0d0.js";import{a as Hs,g as de}from"./ei6lea35xrwk503b.js";import{c as Oe}from"./o0c2m6gntt3um3fq.js";import"./3s6z6so3p651ma5p.js";import"./ic7rccsdo5x6ovoh.js";import"./c1w85nn5shpnb9e0.js";import"./f2cwocui2o4rh90z.js";import"./do5nmvaddt7ak8xi.js";import"./e95x0gs5di7mq1tw.js";import"./ggve90in2x9hqouv.js";import"./nlj97v8clhezwsxr.js";import"./otrhg4fwlde4g25l.js";import"./epqkr08njby1t19h.js";import"./7u88g4wa9fostszz.js";import"./codkr9xsn28rihk7.js";import"./h71lg9jejkufcc57.js";import"./l9t7qwwrq1pkwdh1.js";import"./ec6jcwftshefgs7y.js";import"./pm0gb7r9jflnjr23.js";import"./isvebwen77ppsppm.js";import"./dj9sltuyr3641pw7.js";import"./fc9gc4j06cn3ngox.js";import"./ig30z6bnmojfa37r.js";import"./dwy8f7y5ary0iziz.js";import"./cpgfkygb2tngyvm6.js";import"./jmmpzomw6bzleaig.js";import"./ix38e110ffew427m.js";import"./pzqyu1uaa8qvnned.js";import"./g3fgrnxyclmhl90i.js";import"./e3sv43kq4xmmw69e.js";import"./f3ceh929le7g5gef.js";const Ys=Oe("Search16Regular","16",["M9.3 10.02a4.5 4.5 0 1 1 .7-.7l3.85 3.83a.5.5 0 0 1-.7.7L9.3 10.02ZM10 6.5a3.5 3.5 0 1 0-7 0 3.5 3.5 0 0 0 7 0Z"]),Qs=Oe("SettingsCogMultiple20Filled","20",["M8 2c-.37 0-.73.04-1.08.1a.5.5 0 0 0-.4.4l-.26 1.36c-.05.25-.3.4-.54.31l-1.3-.45a.5.5 0 0 0-.55.14A5.5 5.5 0 0 0 2.8 5.74c-.07.2-.01.4.14.54l1.05.9c.19.17.19.47 0 .63l-1.05.91a.5.5 0 0 0-.14.54c.23.7.6 1.34 1.08 1.88.14.15.35.2.54.14l1.3-.45c.25-.08.5.06.55.31l.27 1.36c.03.2.19.35.39.4a5.52 5.52 0 0 0 2.17 0 .5.5 0 0 0 .4-.4l.25-1.36c.05-.25.3-.4.55-.31l1.3.45c.19.06.4 0 .54-.14a5.5 5.5 0 0 0 1.08-1.89.5.5 0 0 0-.14-.53l-1.04-.9a.42.42 0 0 1 0-.63l1.04-.9a.5.5 0 0 0 .14-.54 5.5 5.5 0 0 0-1.08-1.89.5.5 0 0 0-.54-.14l-1.3.45a.42.42 0 0 1-.55-.31L9.48 2.5a.5.5 0 0 0-.4-.4C8.75 2.05 8.39 2 8 2ZM6.5 7.5a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Zm4.66 4.95a.46.46 0 0 1 .53-.15l.8.27c.26.1.54-.07.6-.34l.15-.83c.04-.2.2-.36.4-.38a3.55 3.55 0 0 1 .72 0c.2.02.35.18.4.38l.15.83c.06.27.34.43.6.34l.8-.27c.19-.07.4-.02.52.15.14.2.27.4.36.62.09.19.03.4-.13.53l-.64.56c-.2.18-.2.5 0 .68l.64.56c.16.13.22.34.13.53-.1.22-.22.43-.36.62a.46.46 0 0 1-.52.15l-.8-.27a.45.45 0 0 0-.6.34l-.16.83c-.04.2-.19.36-.4.38a3.55 3.55 0 0 1-.71 0 .46.46 0 0 1-.4-.38l-.16-.83a.45.45 0 0 0-.6-.34l-.8.27c-.18.07-.4.02-.52-.15a3.5 3.5 0 0 1-.36-.62.46.46 0 0 1 .13-.53l.64-.56c.21-.18.21-.5 0-.68l-.64-.56a.46.46 0 0 1-.13-.53c.1-.22.22-.43.36-.62ZM15 14.5a1 1 0 1 0-2 0 1 1 0 0 0 2 0Z"]),Xs=({worksWith:s})=>{const t=_();return e.jsx("span",{className:"bg-token-bg-tertiary text-token-text-secondary mx-1.5 rounded-md px-1.5 py-0.5 text-xs",children:Is(s,t)})},Js=()=>e.jsx("span",{className:"text-token-text-secondary mx-1.5 rounded-full border px-1.5 py-0.5 text-[9px] uppercase",children:e.jsx(r,{...C.customConnectorBadge})}),Le=({icon:s,label:t,isCustom:n,worksWith:a,description:i,trailingContent:o,infoText:l})=>e.jsxs(is,{className:"items-center",children:[s,e.jsxs("div",{className:"flex-1 overflow-hidden",children:[e.jsxs("div",{className:"text-token-text-primary text-md flex items-center font-medium",children:[t,n?e.jsx(Js,{}):a?.map(c=>e.jsx(Xs,{worksWith:c},c))]}),e.jsxs("div",{className:"text-token-text-secondary mt-0.5 flex items-center gap-1 truncate text-sm",children:[i&&e.jsx("span",{className:"truncate",children:i}),l&&e.jsx(ke,{label:l,children:e.jsx(Me,{className:"h-4 w-4"})})]})]}),o]}),Ue=({icon:s,label:t,worksWith:n,description:a,infoText:i,enabled:o,onChange:l,isLoading:c,isCustom:u,onDelete:m})=>{const g=m?e.jsxs(N.Root,{children:[e.jsx(N.BasicTrigger,{children:e.jsx(ye,{})}),e.jsx(N.Portal,{children:e.jsx(N.Content,{size:"small",align:"end",children:e.jsxs(N.Item,{onClick:m,color:"danger",children:[e.jsx(ee,{className:"icon-md"}),e.jsx(r,{...C.deleteConnector})]})})})]}):null;return e.jsx(Le,{icon:s,label:t,worksWith:n,description:a,infoText:i,isCustom:u,trailingContent:c?e.jsx(E,{}):e.jsxs(e.Fragment,{children:[e.jsx(we,{enabled:o,onChange:l,label:t,size:"normal"}),g]})})},Ge=(s,t)=>{const n=s.owners[0]?"your workspace's admin":null;return n&&s.description?t.formatMessage(C.customConnectorDescription,{description:s.description,owner:n}):n?t.formatMessage(C.createdBy,{owner:n}):s.description?s.description:s.base_url},Be=(s,t)=>{const n=s.owners.length===0&&!s.description;return s.created_at&&s.base_url&&!n?`${s.base_url}
${t.formatMessage(C.createdAt,{createdAt:new Date(s.created_at).toLocaleString(t.locale,{dateStyle:"medium",timeStyle:"short"})})}`:s.created_at?t.formatMessage(C.createdAt,{createdAt:new Date(s.created_at).toLocaleString(t.locale,{dateStyle:"medium",timeStyle:"short"})}):n?null:s.base_url},$s=({connector:s,onPublish:t,isPublished:n})=>{const a=D(),i=_(),[o,l]=d.useState(!1),c=async()=>{l(!0);try{await t()}catch{a.danger(i.formatMessage(C.publishConnectorFailed))}finally{l(!1)}};return e.jsx(Le,{icon:e.jsx(ve,{connector:s,size:"small",className:"h-fit rounded-xl border-[0.5px] p-2 shadow-sm"}),label:s.name,description:Ge(s,i),infoText:Be(s,i),trailingContent:o||!n?e.jsx(b,{color:"secondary",size:"small",onClick:c,loading:o,children:e.jsx(r,{...C.publishConnector})}):e.jsxs(b,{color:"secondary",size:"small",disabled:!0,children:[e.jsx(cs,{className:"me-1 h-4 w-4"}),e.jsx(r,{...C.publishedConnector})]})})},et=({connector:s,workspaceId:t,onDelete:n})=>{const a=_(),i=D(),o=je(),l=B(),{enabled:c,isLoading:u}=Ds(s.id),m=Es(s),{variables:g,mutate:p}=X({mutationFn:j=>T.safePost("/accounts/{account_id}/connectors/{connector_id}/workspace_permissions",{parameters:{path:{account_id:t,connector_id:s.id}},requestBody:{enabled:j}}),onSettled:()=>{o.invalidateQueries({queryKey:Ts(l?.normalizedAccountUserId)})},onError:()=>{i.danger(a.formatMessage(C.featureSettingsUpdateFailed))}}),f=s.owners.length>0,h=async()=>{await ds(s.id),n?.()};return e.jsx(Ue,{icon:e.jsx(ve,{connector:s,size:"small",className:"h-fit rounded-xl border-[0.5px] p-2 shadow-sm"}),label:s.name,description:Ge(s,a),infoText:Be(s,a),worksWith:m,enabled:g??!!c,onChange:p,isLoading:u,isCustom:f,onDelete:f?h:void 0})},st=({workspaceId:s})=>{const t=_(),n=D(),a=je(),{data:i,isLoading:o}=He(s),l=!!i?.beta_settings[oe.CONTEXT_CONNECTOR_GDRIVE],{variables:c,mutate:u}=X({mutationFn:m=>T.safePost("/accounts/{account_id}/beta_features",{parameters:{path:{account_id:s}},requestBody:{feature:oe.CONTEXT_CONNECTOR_GDRIVE,value:m}}),onSettled:()=>{a.invalidateQueries({queryKey:["workspace-settings"]})},onError:()=>{n.danger(t.formatMessage(C.featureSettingsUpdateFailed))}});return e.jsx(Ue,{icon:e.jsx("span",{className:"h-fit rounded-xl border-[0.5px] p-2 shadow-sm",children:e.jsx(be,{className:"h-6 w-6"})}),label:t.formatMessage(C.gdriveFileUploadLabel),worksWith:["fileUploads"],description:t.formatMessage(C.gdriveFileUploadDescription),enabled:c??!!l,onChange:u,isLoading:o})},ue=({children:s})=>e.jsxs(Z,{children:[e.jsxs("div",{children:[e.jsx(J,{children:e.jsx(r,{...C.connectorsTitle})}),e.jsx($,{className:"text-token-text-secondary",children:e.jsx(r,{...C.connectorsSubtitle,values:{link:t=>e.jsx(rs,{href:"https://help.openai.com/en/collections/12923329-connected-apps",openNewTab:!0,children:t})}})})]}),s]});function tt({workspaceId:s}){const t=_(),{enabled:n,availableConnectors:a}=Ps(),{platformConnectors:i,isLoading:o,refetch:l}=As(),{showWorkspaceSettings:c}=ls(),u=d.useMemo(()=>Array.from(i.values()).filter(x=>x.connector_type==="MCP"||a.some(y=>y.id===x.id)),[i,a]),m=d.useMemo(()=>{const x=u.filter(M=>M.connector_type!=="MCP"||M.status!=="ONLY_ME").map(M=>({type:"platform",ownerCount:M.owners.length,name:M.name,connector:M})),y={type:"gdrive_file_upload",ownerCount:0,name:t.formatMessage(C.gdriveFileUploadLabel)};return[...x,...c?[y]:[]].sort((M,P)=>P.ownerCount-M.ownerCount||M.name.localeCompare(P.name))},[u,t,c]),[g,p]=d.useState([]),f=d.useMemo(()=>u.filter(x=>x.connector_type==="MCP"&&(x.status==="ONLY_ME"||g.includes(x.id))),[u,g]),h=async x=>{p(y=>[...y,x]),await Fs(x,s),await l()},j=n&&!!m.length,v=n&&!!f.length;return o?e.jsx(ue,{children:e.jsx(E,{})}):!j&&!v?null:e.jsx(ue,{children:e.jsx(Rs,{items:[...j?[{key:"workspace",label:t.formatMessage(C.workspaceTabLabel),children:e.jsx(e.Fragment,{children:m.map(x=>x.type==="gdrive_file_upload"?e.jsx(st,{workspaceId:s},x.type):e.jsx(et,{connector:x.connector,workspaceId:s,onDelete:()=>l()},x.connector.id))})}]:[],...v?[{key:"my",label:t.formatMessage(C.myTabLabel),children:e.jsx(e.Fragment,{children:f.map(x=>e.jsx($s,{connector:x,onPublish:()=>h(x.id),isPublished:g.includes(x.id)},x.id))})}]:[]]})})}const C=Q({connectorsTitle:{id:"8ZP+KV",defaultMessage:"Connectors"},connectorsSubtitle:{id:"8WR/V3",defaultMessage:"Manage which apps users in this workspace can connect to. <link>Learn more</link>"},featureSettingsUpdateFailed:{id:"allowedConnectorsSection.adminPermissionsUpdateFailed",defaultMessage:"Failed to update permissions for connector"},gdriveFileUploadLabel:{id:"allowedConnectorsSection.gdriveFileUploadLabel",defaultMessage:"Google Drive"},gdriveFileUploadDescription:{id:"allowedConnectorsSection.gdriveFileUploadDescription",defaultMessage:"Upload Google Drive files in messages sent to ChatGPT."},workspaceTabLabel:{id:"b8IYtR",defaultMessage:"Workspace"},myTabLabel:{id:"C2YTBV",defaultMessage:"My connectors"},customConnectorDescription:{id:"/fxqnH",defaultMessage:"{description} • Created by {owner}"},createdBy:{id:"xqRlBb",defaultMessage:"Created by {owner}"},customConnectorBadge:{id:"q4oGB6",defaultMessage:"Custom"},publishedConnector:{id:"5gTvjk",defaultMessage:"Published"},publishConnector:{id:"HtDEy8",defaultMessage:"Publish to workspace"},publishConnectorFailed:{id:"iTXiK2",defaultMessage:"Failed to publish connector"},deleteConnector:{id:"DJDhnI",defaultMessage:"Delete"},createdAt:{id:"vQx/QC",defaultMessage:"Created {createdAt}"}}),A=Q({fileSingular:{id:"TKyiaj",defaultMessage:"file"},filesPlural:{id:"krAMi5",defaultMessage:"files"},domainSingular:{id:"ExZP9r",defaultMessage:"domain"},domainsPlural:{id:"PmkQD7",defaultMessage:"domains"}});function me(s,t){return s==="google_drive_dwd"||s==="google_drive_oauth"?{objectTypeSingular:t.formatMessage(A.fileSingular),objectTypePlural:t.formatMessage(A.filesPlural),externalLinkableUnitSingular:t.formatMessage(A.domainSingular),externalLinkableUnitPlural:t.formatMessage(A.domainsPlural)}:s==="slack"?{objectTypeSingular:t.formatMessage({id:"Y22i2G",defaultMessage:"channel"}),objectTypePlural:t.formatMessage({id:"UXSOIk",defaultMessage:"channels"}),externalLinkableUnitSingular:t.formatMessage({id:"yyIyWp",defaultMessage:"workspace"}),externalLinkableUnitPlural:t.formatMessage({id:"LuznzN",defaultMessage:"workspaces"})}:{objectTypeSingular:t.formatMessage(A.fileSingular),objectTypePlural:t.formatMessage(A.filesPlural),externalLinkableUnitSingular:t.formatMessage(A.domainSingular),externalLinkableUnitPlural:t.formatMessage(A.domainsPlural)}}const at=s=>d.createElement("svg",{width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},d.createElement("g",{id:"icon / connected, dynamic, gpt"},d.createElement("path",{id:"vector",d:"M5.23841 3.95847C5.73982 3.95517 6.38371 4.09048 7.13793 4.39217C7.58 4.569 8.04665 4.79764 8.52798 5.07508C7.9105 5.56392 7.29772 6.10893 6.70332 6.70333C6.10893 7.29772 5.56392 7.9105 5.07508 8.52798C4.79764 8.04665 4.569 7.58 4.39217 7.13793C4.09048 6.38371 3.95517 5.73982 3.95847 5.23841C3.96174 4.74203 4.09727 4.4464 4.27183 4.27183C4.4464 4.09727 4.74203 3.96174 5.23841 3.95847ZM10.0001 4.02079C9.23413 3.52937 8.47766 3.13301 7.75692 2.84471C6.87793 2.49312 6.01323 2.28667 5.22743 2.29184C4.4366 2.29705 3.66642 2.52023 3.09332 3.09332C2.52023 3.66642 2.29705 4.4366 2.29184 5.22743C2.28667 6.01323 2.49312 6.87793 2.84471 7.75692C3.13301 8.47766 3.52937 9.23413 4.02079 10.0001C3.52937 10.766 3.13301 11.5225 2.84471 12.2432C2.49312 13.1222 2.28667 13.9869 2.29184 14.7727C2.29705 15.5636 2.52023 16.3337 3.09332 16.9068C3.66642 17.4799 4.4366 17.7031 5.22743 17.7083C6.01323 17.7135 6.87793 17.507 7.75692 17.1555C8.47766 16.8672 9.23413 16.4708 10.0001 15.9794C10.766 16.4708 11.5225 16.8672 12.2432 17.1555C13.1222 17.507 13.9869 17.7135 14.7727 17.7083C15.5636 17.7031 16.3337 17.4799 16.9068 16.9068C17.4799 16.3337 17.7031 15.5636 17.7083 14.7727C17.7135 13.9869 17.507 13.1222 17.1555 12.2432C16.8672 11.5225 16.4708 10.766 15.9794 10.0001C16.4708 9.23413 16.8672 8.47766 17.1555 7.75692C17.507 6.87793 17.7135 6.01323 17.7083 5.22743C17.7031 4.43661 17.4799 3.66642 16.9068 3.09332C16.3337 2.52023 15.5636 2.29705 14.7727 2.29184C13.9869 2.28667 13.1222 2.49312 12.2432 2.84471C11.5225 3.13301 10.766 3.52937 10.0001 4.02079ZM10.0001 6.04624C10.7059 6.57001 11.4212 7.18471 12.1183 7.88184C12.8154 8.57896 13.4301 9.29429 13.9539 10.0001C13.4301 10.7059 12.8154 11.4212 12.1183 12.1183C11.4212 12.8154 10.7059 13.4301 10.0001 13.9539C9.29429 13.4301 8.57896 12.8154 7.88184 12.1183C7.18471 11.4212 6.57001 10.7059 6.04624 10.0001C6.57001 9.29429 7.18471 8.57896 7.88184 7.88184C8.57896 7.18471 9.29429 6.57001 10.0001 6.04624ZM14.9251 8.52798C14.4362 7.9105 13.8912 7.29772 13.2968 6.70332C12.7024 6.10893 12.0897 5.56392 11.4722 5.07508C11.9535 4.79764 12.4202 4.569 12.8622 4.39217C13.6164 4.09048 14.2603 3.95517 14.7618 3.95847C15.2581 3.96174 15.5538 4.09727 15.7283 4.27184C15.9029 4.4464 16.0384 4.74203 16.0417 5.23841C16.045 5.73982 15.9097 6.38371 15.608 7.13793C15.4312 7.58 15.2025 8.04665 14.9251 8.52798ZM14.9251 11.4722C15.2025 11.9535 15.4312 12.4202 15.608 12.8622C15.9097 13.6164 16.045 14.2603 16.0417 14.7618C16.0384 15.2581 15.9029 15.5538 15.7283 15.7283C15.5538 15.9029 15.2581 16.0384 14.7618 16.0417C14.2603 16.045 13.6164 15.9097 12.8622 15.608C12.4202 15.4312 11.9535 15.2025 11.4722 14.9251C12.0897 14.4362 12.7024 13.8912 13.2968 13.2968C13.8912 12.7024 14.4362 12.0897 14.9251 11.4722ZM8.52798 14.9251C8.04665 15.2025 7.58 15.4312 7.13793 15.608C6.38371 15.9097 5.73982 16.045 5.23841 16.0417C4.74203 16.0384 4.4464 15.9029 4.27183 15.7283C4.09727 15.5538 3.96174 15.2581 3.95847 14.7618C3.95517 14.2603 4.09048 13.6164 4.39217 12.8622C4.569 12.4202 4.79764 11.9535 5.07508 11.4722C5.56392 12.0897 6.10893 12.7024 6.70332 13.2968C7.29772 13.8912 7.91049 14.4362 8.52798 14.9251Z",fill:"currentColor"})));function R({label:s,value:t}){return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-token-border-medium w-full border-t"}),e.jsxs("div",{className:"flex w-full flex-row justify-between py-2",children:[e.jsx("span",{className:"text-token-text-primary",children:s}),e.jsx("span",{className:"text-token-text-secondary",children:t})]})]})}function nt({connection:s,adminUserConnectionState:t}){const n=t&&t.user_connection_details.activation_status!=="inactive"&&t.user_connection_details.auth_status!=="not_connected";switch(s.connection_config.knowledge_connector_type){case"google_drive_oauth":return e.jsx(it,{connectionConfig:s.connection_config,connectionStatus:s.connection_status,isAdminConnected:n});case"slack":return e.jsx(lt,{connectionConfig:s.connection_config,connectionStatus:s.connection_status,isAdminConnected:n});case"github":case"notion":case"merge_file_storage":case"google_drive_dwd":return e.jsx(ot,{});case void 0:return null}}function it({connectionConfig:s,connectionStatus:t,isAdminConnected:n}){const a=_(),i=t==="activating"||t==="partially_activated"||t==="active";return e.jsxs("div",{className:"px-4",children:[i&&n!=null&&!n&&e.jsx(We,{connectionConfig:s}),e.jsx(R,{label:a.formatMessage({id:"bVi1Vt",defaultMessage:"Connection type"}),value:a.formatMessage({id:"DSWj22",defaultMessage:"Self-service"})}),!!s.domain_name&&e.jsx(R,{label:a.formatMessage({id:"DtrjbM",defaultMessage:"Domain name"}),value:s.domain_name})]})}function ot(){const s=_();return e.jsx("div",{className:"px-4",children:e.jsx(R,{label:s.formatMessage({id:"bVi1Vt",defaultMessage:"Connection type"}),value:s.formatMessage({id:"voo3FC",defaultMessage:"Admin-managed"})})})}function lt({connectionConfig:s,connectionStatus:t,isAdminConnected:n}){const a=_();return e.jsxs("div",{className:"px-4",children:[t==="activating"&&n!=null&&!n&&e.jsx(We,{connectionConfig:s}),e.jsx(R,{label:a.formatMessage({id:"JXKtnI",defaultMessage:"Slack domain"}),value:s.team_domain}),e.jsx(R,{label:a.formatMessage({id:"a1Cjhf",defaultMessage:"Team ID"}),value:s.team_id})]})}function We({connectionConfig:s}){const{data:t,isLoading:n,refetch:a}=L({queryKey:["user_connection_status"],queryFn:S.user_connection_status}),{refetch:i}=Ne({skip:!0}),o=()=>{a(),i()},l=t?.connection_statuses.some(u=>u.user_connection_details.connection_instance_id===s.connection_config_id&&u.user_connection_details.auth_status==="user_connected");if(n||l)return null;const c=({isLoading:u,disabled:m,onClick:g})=>e.jsx(b,{color:"primary",loading:u,disabled:m,onClick:g,children:e.jsx(r,{id:"9ZiK24",defaultMessage:"Connect"})});return e.jsxs(_e.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{delay:.2,duration:.5},className:"bg-token-hint-bg dark:bg-token-main-surface-tertiary mb-2 flex flex-col gap-2 rounded-xl p-4",children:[e.jsxs("div",{className:"flex flex-row items-start gap-4",children:[e.jsx(Me,{className:"icon-lg"}),e.jsx("span",{className:"text-sm",children:e.jsx(r,{id:"gdALIj",defaultMessage:"This connection will not finish activating until a user connects."})})]}),e.jsx(us,{connectionId:s.connection_config_id,connectorType:s.knowledge_connector_type,renderButton:c,location:"admin_settings",refetch:o})]})}const rt=s=>d.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},d.createElement("path",{d:"M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12Z",fill:"currentColor"}),d.createElement("path",{d:"M13.3 12.0002C13.3 12.7182 12.718 13.3002 12 13.3002C11.282 13.3002 10.7 12.7182 10.7 12.0002C10.7 11.2822 11.282 10.7002 12 10.7002C12.718 10.7002 13.3 11.2822 13.3 12.0002Z",fill:"currentColor"}),d.createElement("path",{d:"M17.3 12.0002C17.3 12.7182 16.718 13.3002 16 13.3002C15.282 13.3002 14.7 12.7182 14.7 12.0002C14.7 11.2822 15.282 10.7002 16 10.7002C16.718 10.7002 17.3 11.2822 17.3 12.0002Z",fill:"currentColor"}),d.createElement("path",{d:"M9.30001 12.0002C9.30001 12.7182 8.71798 13.3002 8.00001 13.3002C7.28204 13.3002 6.70001 12.7182 6.70001 12.0002C6.70001 11.2822 7.28204 10.7002 8.00001 10.7002C8.71798 10.7002 9.30001 11.2822 9.30001 12.0002Z",fill:"currentColor"}));function qe({isOpen:s,onClose:t,connectionId:n,accountId:a,isPostActivation:i,footerContent:o,primaryButton:l,secondaryButton:c}){const u=_(),{data:m,isLoading:g,error:p,refetch:f}=L({queryKey:["slack_channel_type_scopes",n],queryFn:()=>S.admin_connection_list_item_scopes(a,n,"channel_type")});let h,j;return m?.object_selections.forEach(({object_handle:v,selection:x})=>{v==="public"?h=x==="include":v==="private"&&(j=x==="include")}),e.jsxs(O,{testId:"modal-slack-channel-scope",...Fe,isOpen:s,onClose:t,children:[e.jsxs("div",{className:"flex flex-col gap-4 px-6 pt-4 pb-10",children:[e.jsx("p",{className:"text-token-text-primary",children:e.jsx(r,{id:"Ot9UkQ",defaultMessage:"Control which types of channels should be synced."})}),!i&&e.jsxs("div",{className:"bg-token-main-surface-secondary text-token-text-primary flex w-full flex-row items-center gap-4 rounded-xl p-4",children:[e.jsx(he,{className:"icon-lg"}),e.jsx("span",{className:"text-sm",children:e.jsx(r,{id:"qByMz2",defaultMessage:"You will not be able to modify the sync policy once the connection starts syncing data."})})]}),p&&e.jsxs("div",{className:"my-2 flex flex-row items-center gap-2 rounded-lg bg-red-500 p-2 text-white",children:[e.jsx(H,{className:"icon-md inline"}),e.jsx(r,{id:"F9HsRh",defaultMessage:"Something went wrong."}),e.jsx("button",{onClick:()=>f(),className:"underline",children:e.jsx(r,{id:"y/IEAC",defaultMessage:"Try again"})})]}),g?e.jsx(te,{lines:4}):e.jsxs(e.Fragment,{children:[h!=null&&e.jsx(xe,{connectionId:n,accountId:a,slackChannelScope:"public",title:u.formatMessage({id:"CXSVXf",defaultMessage:"Public channels"}),refetch:f,value:h,isPostActivation:i}),j!=null&&e.jsx(xe,{connectionId:n,accountId:a,slackChannelScope:"private",title:u.formatMessage({id:"5XrboJ",defaultMessage:"Private channels"}),refetch:f,value:j,isPostActivation:i})]})]}),e.jsx(Se,{footerContent:o,primaryButton:l,secondaryButton:c})]})}function xe({connectionId:s,accountId:t,slackChannelScope:n,title:a,refetch:i,value:o,isPostActivation:l}){const c=D(),u=_(),[m,g]=d.useState(!1),p=async f=>{if(!m){g(!0);try{f?await S.admin_connection_unblock_items(t,s,"channel_type",[n]):await S.admin_connection_block_items(t,s,"channel_type",[n]),i()}catch{c.danger(u.formatMessage({id:"7QF5n6",defaultMessage:"Failed to update policy. Please try again later."}))}finally{g(!1)}}};return l?e.jsxs("div",{className:"group border-token-border-medium flex w-full flex-row items-center gap-4 rounded-xl border px-8 py-4",children:[o?e.jsx(ms,{className:"icon-lg"}):e.jsx(Os,{className:"icon-lg"}),e.jsx("p",{className:"flex-1",children:a})]}):e.jsxs("div",{className:"group border-token-border-medium flex w-full flex-row items-center gap-4 rounded-xl border px-8 py-4",children:[e.jsx(we,{enabled:o,disabled:m,label:a,onChange:p}),e.jsx("p",{children:a}),m&&e.jsx(E,{})]})}const Ze=s=>d.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},d.createElement("path",{d:"M8.7587 3H15.2413C16.0463 2.99999 16.7106 2.99998 17.2518 3.04419C17.8139 3.09012 18.3306 3.18868 18.816 3.43597C19.5686 3.81947 20.1805 4.43139 20.564 5.18404C20.8113 5.66937 20.9099 6.18608 20.9558 6.74817C21 7.28936 21 7.95372 21 8.75868V15.2413C21 16.0463 21 16.7106 20.9558 17.2518C20.9099 17.8139 20.8113 18.3306 20.564 18.816C20.1805 19.5686 19.5686 20.1805 18.816 20.564C18.3306 20.8113 17.8139 20.9099 17.2518 20.9558C16.7106 21 16.0463 21 15.2413 21H8.75868C7.95372 21 7.28936 21 6.74817 20.9558C6.18608 20.9099 5.66937 20.8113 5.18404 20.564C4.43139 20.1805 3.81947 19.5686 3.43597 18.816C3.18868 18.3306 3.09012 17.8139 3.04419 17.2518C2.99998 16.7106 2.99999 16.0463 3 15.2413V8.7587C2.99999 7.95373 2.99998 7.28937 3.04419 6.74817C3.09012 6.18608 3.18868 5.66937 3.43597 5.18404C3.81947 4.43139 4.43139 3.81947 5.18404 3.43597C5.66937 3.18868 6.18608 3.09012 6.74817 3.04419C7.28937 2.99998 7.95373 2.99999 8.7587 3ZM6.91104 5.03755C6.47262 5.07337 6.24842 5.1383 6.09202 5.21799C5.7157 5.40973 5.40973 5.7157 5.21799 6.09202C5.1383 6.24842 5.07337 6.47262 5.03755 6.91104C5.00078 7.36113 5 7.94342 5 8.8V15.2C5 16.0566 5.00078 16.6389 5.03755 17.089C5.07337 17.5274 5.1383 17.7516 5.21799 17.908C5.40973 18.2843 5.7157 18.5903 6.09202 18.782C6.24842 18.8617 6.47262 18.9266 6.91104 18.9624C7.36113 18.9992 7.94342 19 8.8 19H15.2C16.0566 19 16.6389 18.9992 17.089 18.9624C17.5274 18.9266 17.7516 18.8617 17.908 18.782C18.2843 18.5903 18.5903 18.2843 18.782 17.908C18.8617 17.7516 18.9266 17.5274 18.9624 17.089C18.9992 16.6389 19 16.0566 19 15.2V8.8C19 7.94342 18.9992 7.36113 18.9624 6.91104C18.9266 6.47262 18.8617 6.24842 18.782 6.09202C18.5903 5.7157 18.2843 5.40973 17.908 5.21799C17.7516 5.1383 17.5274 5.07337 17.089 5.03755C16.6389 5.00078 16.0566 5 15.2 5H8.8C7.94342 5 7.36113 5.00078 6.91104 5.03755ZM16.3255 7.93219C16.7772 8.25003 16.8856 8.87383 16.5678 9.32549L11.8178 16.0755C11.6431 16.3237 11.3652 16.4792 11.0623 16.4981C10.7593 16.517 10.4642 16.3973 10.2601 16.1727L7.76006 13.4227C7.38855 13.014 7.41867 12.3816 7.82733 12.0101C8.23599 11.6386 8.86843 11.6687 9.23994 12.0773L10.9004 13.9039L14.9322 8.17451C15.25 7.72285 15.8738 7.61436 16.3255 7.93219Z",fill:"currentColor"}));function I({label:s,onClick:t}){return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full px-4",children:e.jsx("div",{className:"border-token-border-medium w-full border-t"})}),e.jsxs("div",{className:"flew-row hover:bg-token-surface-hover flex cursor-pointer items-center gap-4 px-4 py-2",onClick:t,children:[e.jsx("p",{className:"flex-1",children:s}),t&&e.jsx(fs,{className:"icon-md text-token-text-secondary shrink-0"})]})]})}function ct({accountId:s,connectionId:t,refetch:n}){const[a,i]=d.useState(!1),o=z(),[l,c]=d.useState(!1),{triggerLocation:u}=Ee(),m=e.jsx(b,{color:"primary",disabled:o,icon:Ze,onClick:()=>i(!0),loading:l,children:e.jsx(r,{id:"S6paZh",defaultMessage:"Finish connecting"})}),g=async()=>{c(!0),await S.admin_activate_connection_instance(s,t),W.logEventWithStatsig("Contextual Answers Admin Connection Activated","chatgpt_contextual_answers_admin_connection_activated",{triggerLocation:u,connectorType:"google_drive_oauth",connectionId:t,adminQuickstart:!0}),n(),c(!1)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full px-4",children:e.jsx("div",{className:"border-token-border-medium w-full border-t"})}),e.jsx("div",{className:"flex w-full flex-col gap-2 p-4",children:o?e.jsx(se,{children:m}):m}),a&&e.jsx(xs,{connectionId:t,location:"admin_connection_quickstart_row",isAdminFlow:!0,isAdminQuickstartFlow:!0,onClose:()=>i(!1),onSuccess:g,accountId:s})]})}function dt({accountId:s,connectionId:t,refetch:n}){const[a,i]=d.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(I,{onClick:()=>i(!0),label:e.jsx(r,{id:"wM9lvD",defaultMessage:"Configure credentials"})}),a&&e.jsx(Ls,{onClose:()=>i(!1),onNext:()=>{n(),i(!1)},accountId:s,connectionId:t})]})}function ut({accountId:s,connectionId:t,isPostActivation:n}){const[a,i]=d.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(I,{onClick:()=>i(!0),label:e.jsx(r,{id:"lTeSGb",defaultMessage:"Sync policy"})}),a&&e.jsx(qe,{isOpen:!0,onClose:()=>i(!1),accountId:s,connectionId:t,isPostActivation:n})]})}function mt({accountId:s,connectionId:t,isPostActivation:n}){const[a,i]=d.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(I,{onClick:()=>i(!0),label:e.jsx(r,{id:"AgDWHl",defaultMessage:"User drives"})}),a&&e.jsx(Us,{isOpen:!0,isPostActivation:n,onClose:()=>i(!1),accountId:s,connectionId:t})]})}function xt({accountId:s,connectionId:t}){const[n,a]=d.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(I,{onClick:()=>a(!0),label:e.jsx(r,{id:"gsRcYT",defaultMessage:"Shared drives"})}),n&&e.jsx(Gs,{isOpen:!0,onClose:()=>a(!1),accountId:s,connectionId:t})]})}function ft({accountId:s,connectionId:t,objectType:n}){const[a,i]=d.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(I,{onClick:()=>i(!0),label:e.jsx(r,{id:"tisZLQ",defaultMessage:"Block items"})}),a&&e.jsx(Bs,{isOpen:!0,onClose:()=>i(!1),accountId:s,connectionId:t,objectType:n})]})}function gt({accountId:s,connection:t}){const[n,a]=d.useState(!1);return t.connection_config.knowledge_connector_type?e.jsxs(e.Fragment,{children:[e.jsx(I,{onClick:()=>a(!0),label:e.jsx(r,{id:"9iRaQo",defaultMessage:"User access"})}),n&&e.jsx(Pe,{connectorType:t.connection_config.knowledge_connector_type,fallbackEstimatedMaxNumUsers:Re(t.connection_config),onClose:()=>a(!1),accountId:s,connectionId:t.connection_config.connection_config_id})]}):null}function pt({accountId:s,connectionId:t,connectorType:n,connectionDisplayInfo:a,onActivate:i,activationBlockingError:o}){const[l,c]=d.useState(!1),u=z(),m=e.jsx(b,{color:o?"secondary":"primary",disabled:!!o||u,icon:Ze,onClick:()=>c(!0),children:e.jsx(r,{id:"tVDCWM",defaultMessage:"Review and finish setup"})});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full px-4",children:e.jsx("div",{className:"border-token-border-medium w-full border-t"})}),e.jsxs("div",{className:"flex w-full flex-col gap-2 p-4",children:[o&&e.jsx("p",{className:"text-token-text-secondary text-sm",children:o}),u?e.jsx(se,{children:m}):m]}),l&&e.jsx(Ie,{isOpen:!0,onClose:()=>c(!1),accountId:s,connectionId:t,connectionDisplayInfo:a,onActivate:i,connectorType:n})]})}const ht=({open:s,onOpenChange:t,deleteConnection:n,isDeleting:a,connectionDisplayInfo:i})=>{const o=_();return e.jsx(O,{testId:"modal-delete-connection",isOpen:s,onClose:()=>t(!1),shouldIgnoreClickOutside:!0,title:o.formatMessage({id:"oXdl2Z",defaultMessage:"Confirm deletion"}),type:"danger",icon:he,primaryButton:e.jsx(b,{color:"danger",onClick:n,disabled:a,loading:a,children:e.jsx(r,{id:"knS5PY",defaultMessage:"Delete"})}),secondaryButton:e.jsx(b,{color:"secondary",disabled:a,onClick:()=>{t(!1)},children:e.jsx(r,{id:"KnPHlG",defaultMessage:"Cancel"})}),children:e.jsxs("ul",{className:"px-4",children:[e.jsx("li",{className:"mb-2 list-disc ps-2",children:e.jsx(r,{id:"BvnNwE",defaultMessage:"You are about to delete the connection {connection_name}.",values:{connection_name:e.jsx(Ws,{connectionDisplayInfo:i})}})}),e.jsx("li",{className:"mb-2 list-disc ps-2",children:e.jsx(r,{id:"0m+fk7",defaultMessage:"Deleting this connection will stop syncing and delete synced data."})}),e.jsx("li",{className:"mb-2 list-disc ps-2 font-bold",children:e.jsx(r,{id:"a86dO+",defaultMessage:"This action cannot be undone."})})]})})},jt=({open:s,onOpenChange:t,defaultName:n,accountId:a,connectionId:i,refetch:o})=>{const l=_(),[c,u]=d.useState(n),[m,g]=d.useState(!1),p=d.useId(),f=D(),h=d.useCallback(()=>{g(!0),S.admin_edit_name_connection_instance(a,i,{name:c}).then(()=>{f.success(l.formatMessage({id:"pepxEP",defaultMessage:"Connection updated successfully."})),o(),t(!1)}).catch(()=>{f.danger(l.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}))}).finally(()=>{g(!1)})},[a,i,l,c,t,o,f]);return e.jsx(O,{testId:"modal-rename",isOpen:s,onClose:()=>t(!1),shouldIgnoreClickOutside:!0,title:l.formatMessage({id:"mmCJWI",defaultMessage:"Rename"}),type:"success",icon:Ae,primaryButton:e.jsx(b,{onClick:()=>h(),loading:m,children:e.jsx(r,{id:"LebexD",defaultMessage:"Rename"})}),secondaryButton:e.jsx(b,{color:"secondary",onClick:()=>{t(!1)},children:e.jsx(r,{id:"KnPHlG",defaultMessage:"Cancel"})}),children:e.jsxs("form",{onSubmit:j=>{j.preventDefault(),h()},className:"flex flex-col gap-2",children:[e.jsx("label",{htmlFor:p,className:"text-token-text-secondary text-base font-medium",children:e.jsx(r,{id:"Gk2g3Q",defaultMessage:"Connection name"})}),e.jsx("input",{type:"text",value:c,onChange:j=>u(j.target.value),id:p,className:"border-token-border-default bg-token-main-surface-primary text-token-text-primary rounded-lg border border-solid"}),e.jsx("button",{type:"submit",className:"display-none"})]})})};function ze({accountId:s,refetchConnectionInstances:t,connection:n,showIcon:a=!1,adminUserConnectionState:i}){const[o,l]=d.useState(!1),c=_();let u;switch(n.connection_config.knowledge_connector_type){case void 0:break;case"github":case"notion":case"merge_file_storage":case"google_drive_oauth":case"google_drive_dwd":u="synced_object";break;case"slack":u="synced_channel";break}if(!n.connection_config.knowledge_connector_type)return null;let m;return n.connection_status!=="draft"||(n.connection_config.knowledge_connector_type==="google_drive_oauth"&&!n.connection_config.domain_name?m=e.jsx(ct,{accountId:s,connectionId:n.connection_config.connection_config_id,refetch:t}):m=e.jsx(pt,{connectorType:n.connection_config.knowledge_connector_type,connectionId:n.connection_config.connection_config_id,accountId:s,connectionDisplayInfo:n.display_info,onActivate:t,activationBlockingError:bt(n,c)})),e.jsxs(_e.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.5},className:"group bg-token-main-surface-secondary w-full rounded-xl pb-2",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 p-4 pb-6",children:[a&&n.display_info.icon_url&&e.jsx("img",{src:n.display_info.icon_url,alt:"",className:"icon-xl self-center"}),e.jsxs("div",{className:"w-full shrink overflow-hidden",children:[e.jsx("div",{className:"text-token-text-primary mb-1 overflow-hidden font-medium text-ellipsis whitespace-nowrap",children:e.jsx(ke,{label:n.display_info.display_name,side:"top",align:"center",children:n.display_info.display_name})}),e.jsx("div",{children:e.jsx(_t,{connectionStatus:n.connection_status})})]}),e.jsx(Ct,{isOpen:o,setIsOpen:l,accountId:s,refetch:t,connectionId:n.connection_config.connection_config_id,connectionDisplayInfo:n.display_info,className:q("hover:bg-token-main-surface-secondary-selected h-8 w-8",o?"bg-token-main-surface-secondary-selected":"bg-transparent")})]}),e.jsx(nt,{connection:n,adminUserConnectionState:i}),e.jsx(gt,{connection:n,accountId:s}),n.connection_config.knowledge_connector_type==="google_drive_dwd"&&e.jsxs(e.Fragment,{children:[e.jsx(dt,{connectionId:n.connection_config.connection_config_id,accountId:s,refetch:t}),e.jsx(mt,{connectionId:n.connection_config.connection_config_id,accountId:s,isPostActivation:n.connection_status!=="draft"}),e.jsx(xt,{connectionId:n.connection_config.connection_config_id,accountId:s})]}),n.connection_config.knowledge_connector_type==="slack"&&e.jsx(ut,{connectionId:n.connection_config.connection_config_id,accountId:s,isPostActivation:n.connection_status!=="draft"}),u!=null&&e.jsx(ft,{connectionId:n.connection_config.connection_config_id,accountId:s,objectType:u}),m]})}const _t=({connectionStatus:s})=>{switch(s){case"active":case"partially_activated":case"activating":return e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ye,{className:"icon-sm text-token-text-primary"}),e.jsx("span",{className:"text-token-text-primary ms-1 text-sm",children:e.jsx(r,{id:"JGGafW",defaultMessage:"Configured"})})]});case"draft":return e.jsxs("div",{className:"flex items-center",children:[e.jsx(rt,{className:"icon-sm text-token-text-primary"}),e.jsx("span",{className:"text-token-text-primary ms-1 text-sm",children:e.jsx(r,{id:"m4Lx1j",defaultMessage:"Draft"})})]});case"deleting":case"deleted":return null}};function Ct({isOpen:s,setIsOpen:t,className:n,connectionId:a,connectionDisplayInfo:i,accountId:o,refetch:l}){const c=D(),u=_(),[m,g]=d.useState(!1),[p,f]=d.useState(!1),[h,j]=d.useState(!1),v=async()=>{if(!h){j(!0);try{await S.admin_delete_connection_instance(o,a),c.success(u.formatMessage({id:"zM0Z9u",defaultMessage:"Connection deleted."}))}catch{c.danger(u.formatMessage({id:"3lBGk2",defaultMessage:"Failed to delete this connection. Please try again later."}))}finally{l(),j(!1),f(!1)}}};return e.jsxs(e.Fragment,{children:[e.jsxs(N.Root,{open:s,onOpenChange:t,children:[e.jsx(N.Trigger,{className:n,children:e.jsx(ye,{className:"icon-lg"})}),e.jsx(N.Portal,{children:e.jsxs(N.Content,{size:"medium",children:[e.jsx(N.Item,{icon:Ae,onSelect:()=>g(!0),disabled:h||p,children:e.jsx(r,{id:"XSQcFy",defaultMessage:"Rename connection"})}),e.jsx(N.Item,{icon:h||p?E:ee,onSelect:()=>f(!0),color:"danger",disabled:h||p,children:e.jsx(r,{id:"EAIYOb",defaultMessage:"Delete connection"})}),!1]})})]}),e.jsx(jt,{open:m,onOpenChange:g,defaultName:i.display_name,connectionId:a,accountId:o,refetch:l}),e.jsx(ht,{open:p,onOpenChange:f,deleteConnection:v,isDeleting:h,connectionDisplayInfo:i})]})}function bt(s,t){if(s.connection_config.knowledge_connector_type==="google_drive_dwd"){if(!s.connection_config.admin_email_address||!s.connection_config.service_account_credential_id)return t.formatMessage({id:"BfNdzb",defaultMessage:"Credential configuration is incomplete"})}else if(s.connection_config.knowledge_connector_type==="google_drive_oauth"&&!s.connection_config.domain_name)return t.formatMessage({id:"PxrodU",defaultMessage:"Google Workspace domain must be set"})}function vt({onClose:s}){const[t,n]=d.useState(),a=B();return a?t?e.jsx(wt,{accountId:a.id,connection:t,onClose:s}):e.jsx(yt,{accountId:a.id,onClose:s,setConnection:n}):null}function yt({onClose:s,setConnection:t,accountId:n}){const a=_(),i=D(),{triggerLocation:o}=Ee(),[l,c]=d.useState({teamDomain:"app"});d.useEffect(()=>{W.logEventWithStatsig("Contextual Answers Admin Create Connection Step","chatgpt_contextual_answers_admin_create_connection_step",{connectorType:"slack",stepName:"basic_info",triggerLocation:o})},[o]);const[u,m]=d.useState(!1),g=d.useCallback(()=>{!(l.teamDomain&&l.teamId)||!n||(m(!0),S.admin_create_connection_instance(n,{connection_config_id:"--fake-local-id",knowledge_connector_type:"slack",team_id:l.teamId,team_domain:l.teamDomain},l.connectionName).then(x=>{t(x)}).catch(()=>{i.danger(a.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}))}).finally(()=>{m(!1)}))},[n,l.connectionName,l.teamDomain,l.teamId,a,t,i]),p=!!l.connectionName?.length&&l.connectionName.length>128,f=!!(l.teamDomain&&l.teamId&&!p),h=d.useId(),j=d.useId(),v=d.useId();return e.jsxs(O,{...Fe,onClose:s,testId:"modal-slack-basic-info",children:[e.jsxs("form",{onSubmit:x=>{x.preventDefault(),f&&g()},className:"flex flex-col gap-4 px-6 pt-4 pb-6",children:[e.jsxs("div",{className:"mb-2 flex flex-col gap-2",children:[e.jsx("label",{htmlFor:h,className:"text-token-text-secondary text-base font-medium",children:e.jsx(r,{id:"e2yF8/",defaultMessage:"Connection display name"})}),e.jsx("input",{type:"text",value:l.connectionName??"",onChange:x=>c(y=>({...y,connectionName:x.target.value})),placeholder:a.formatMessage({id:"0gZ+BA",defaultMessage:"(optional)"}),id:h,className:"border-token-border-default bg-token-main-surface-primary text-token-text-primary rounded-lg border border-solid"}),p?e.jsx("p",{className:"text-red-500",children:e.jsx(r,{id:"vT7EGU",defaultMessage:"Name is too long."})}):null]}),e.jsxs("div",{className:"mb-2 flex flex-col gap-2",children:[e.jsx("label",{htmlFor:j,className:"text-token-text-secondary text-base font-medium",children:e.jsx(r,{id:"hEnKIS",defaultMessage:"Slack workspace domain"})}),e.jsxs("p",{children:[e.jsx("input",{type:"text",value:l.teamDomain??"",onChange:x=>c(y=>({...y,teamDomain:x.target.value})),id:j,className:"border-token-border-default bg-token-main-surface-primary text-token-text-primary rounded-lg border border-solid"}),e.jsx("span",{className:"text-token-text-secondary ms-1 font-medium",children:".slack.com"})]})]}),e.jsxs("div",{className:"mb-2 flex flex-col gap-2",children:[e.jsx("label",{htmlFor:v,className:"text-token-text-secondary text-base font-medium",children:e.jsx(r,{id:"azUOrk",defaultMessage:"Slack workspace ID"})}),e.jsx("input",{type:"text",value:l.teamId??"",onChange:x=>c(y=>({...y,teamId:x.target.value})),placeholder:a.formatMessage({id:"vUK9Kc",defaultMessage:"T0000000000"}),id:v,className:"border-token-border-default bg-token-main-surface-primary text-token-text-primary rounded-lg border border-solid"})]}),e.jsx("button",{type:"submit",className:"display-none"})]}),e.jsx(Se,{primaryButton:e.jsx(b,{color:"primary",disabled:!f,onClick:g,loading:u,children:e.jsx(r,{id:"lZthRm",defaultMessage:"Save Draft and Continue"})})})]})}function wt({connection:s,accountId:t,onClose:n}){return e.jsx(qs,{onClose:n,steps:[{connectorType:"slack",name:"allowed_users",fn:({goForward:a,close:i,stepNumber:o,totalSteps:l})=>e.jsx(Pe,{fallbackEstimatedMaxNumUsers:Re(s.connection_config),onClose:()=>i?.(),accountId:t,connectionId:s.connection_config.connection_config_id,connectorType:"slack",primaryButton:a&&e.jsx(b,{color:"primary",onClick:a,children:e.jsx(r,{id:"z5fExR",defaultMessage:"Next"})}),footerContent:e.jsx("span",{className:"text-token-text-secondary flex-1 align-middle font-medium",children:e.jsx(r,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:o+1,totalSteps:l}})})})},{connectorType:"slack",name:"slack_channel_scope",fn:({goForward:a,goBackward:i,close:o,stepNumber:l,totalSteps:c})=>e.jsx(qe,{isOpen:!0,isPostActivation:!1,onClose:()=>o?.(),accountId:t,connectionId:s.connection_config.connection_config_id,primaryButton:a&&e.jsx(b,{color:"primary",onClick:a,children:e.jsx(r,{id:"z5fExR",defaultMessage:"Next"})}),secondaryButton:i&&e.jsx(b,{color:"secondary",onClick:i,children:e.jsx(r,{id:"xJnONr",defaultMessage:"Back"})}),footerContent:e.jsx("span",{className:"text-token-text-secondary flex-1 align-middle font-medium",children:e.jsx(r,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:l+1,totalSteps:c}})})})},{connectorType:"slack",name:"review_and_activate",fn:({goBackward:a,close:i,stepNumber:o,totalSteps:l})=>e.jsx(Ie,{isOpen:!0,onClose:()=>i?.(),accountId:t,connectorType:"slack",connectionId:s.connection_config.connection_config_id,connectionDisplayInfo:s.display_info,secondaryButton:a&&e.jsx(b,{color:"secondary",onClick:a,children:e.jsx(r,{id:"xJnONr",defaultMessage:"Back"})}),footerContent:e.jsx("span",{className:"text-token-text-secondary flex-1 align-middle font-medium",children:e.jsx(r,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:o+1,totalSteps:l}})})})}]})}const ae=Qe.div`w-full border-b-1 border-token-border-light`;async function kt(s){const[t,n]=await Promise.all([S.admin_list_knowledge_connectors(s),S.admin_list_connection_instances(s)]),a=new Map;return t.knowledge_conectors.forEach(i=>a.set(i.connector_details.knowledge_connector_type,{displayInfo:i.display_info,availability:i.connector_details.availability,connections:[],limits:i.connector_details.limits??{max_instances:3}})),n.connection_instances.forEach(i=>{if(!i.connection_config.knowledge_connector_type)return;const o=a.get(i.connection_config.knowledge_connector_type)?.connections;o!=null?o.push(i):a.set(i.connection_config.knowledge_connector_type,{displayInfo:i.display_info,availability:"unavailable",limits:Y,connections:[i]})}),a}function V(s){return!(s.connection_status==="deleted"||s.connection_status==="deleting")}function Mt(){const s=_(),t=B(),[n,a]=d.useState(!1),[i,o]=d.useState(!1);d.useEffect(()=>{W.logEventWithStatsig("Contextual Answers Admin Page Visited","chatgpt_contextual_answers_admin_page_visited")},[]);const{data:l,isLoading:c,error:u,refetch:m}=L({queryKey:["admin:knowledge_connectors_with_connections",t?.id],queryFn:async()=>{if(!t)throw new Error("No current account");return await kt(t.id)},enabled:!!t}),{refetch:g,connectionInstanceData:p}=Ne(),f=()=>{m(),g()},h=l?.get("google_drive_oauth")?.availability==="available"||l?.get("google_drive_dwd")?.availability==="available",{combinedGoogleDriveConnections:j,slackConnections:v,otherConnections:x}=d.useMemo(()=>{const P=[],ne=[],ie=[];return l?.forEach((U,K)=>{if(U.availability!=="available"){ie.push(...U.connections.filter(V));return}K==="google_drive_dwd"||K==="google_drive_oauth"?P.push(...U.connections.filter(V)):K==="slack"&&ne.push(...U.connections.filter(V))}),{combinedGoogleDriveConnections:P,slackConnections:ne,otherConnections:ie}},[l]),y=l?.get("slack")?.availability==="available",M=z();return t?.id?e.jsxs(Z,{children:[e.jsx(Ke,{badge:e.jsx(gs,{})}),u&&e.jsxs("div",{className:"my-2 flex flex-row items-center gap-2 rounded-lg bg-red-500 p-2 text-white",children:[e.jsx(H,{className:"icon-md inline"}),e.jsx(r,{id:"zNCx93",defaultMessage:"Failed to get connection instances. Please refresh to try again."})]}),M&&e.jsxs("div",{className:"my-2 flex flex-row items-center gap-2 rounded-lg bg-red-500 p-2 text-white",children:[e.jsx(H,{className:"icon-md inline"}),e.jsx(r,{id:"hnTY+Z",defaultMessage:"Our systems are experiencing high load. Some operations may be temporarily unavailable."})]}),e.jsx(ae,{}),c&&e.jsx(E,{}),h&&e.jsx(fe,{accountId:t.id,connectorType:"google_drive",connectorName:s.formatMessage({id:"oDI3Mt",defaultMessage:"Google Drive"}),limits:l?.get("google_drive_oauth")?.limits??l?.get("google_drive_dwd")?.limits??Y,description:s.formatMessage({id:"3yZLm6",defaultMessage:"Connect Google Drives, Docs, Sheets, Slides and other files."}),onClickConnect:()=>a(!0),Icon:be,connectionInstancesLoading:c,connectionInstances:j,adminUserConnectionStatus:p?.connection_statuses,refetchConnectionInstances:f,singularNounConnectedObjectName:me("google_drive_oauth",s).externalLinkableUnitSingular}),y&&e.jsx(fe,{accountId:t.id,connectorType:"slack",connectorName:s.formatMessage({id:"pUDRLC",defaultMessage:"Slack"}),limits:l?.get("slack")?.limits??Y,description:s.formatMessage({id:"p1qvhM",defaultMessage:"Connect messages and channels."}),Icon:ps,onClickConnect:()=>o(!0),connectionInstancesLoading:c,connectionInstances:v,adminUserConnectionStatus:p?.connection_statuses,refetchConnectionInstances:f,singularNounConnectedObjectName:me("slack",s).externalLinkableUnitSingular}),x.length>0&&e.jsx(Nt,{accountId:t.id,connectionInstancesLoading:c,connectionInstances:x,refetchConnectionInstances:f}),n&&e.jsx(Zs,{isDwdEnabled:l?.get("google_drive_dwd")?.availability==="available",onClose:()=>{a(!1),f()},triggerLocation:"admin_settings"}),i&&e.jsx(vt,{onClose:()=>{o(!1),f()}})]}):null}function fe({accountId:s,Icon:t,connectorName:n,connectorType:a,description:i,onClickConnect:o,connectionInstances:l,connectionInstancesLoading:c,adminUserConnectionStatus:u,refetchConnectionInstances:m,singularNounConnectedObjectName:g,limits:p}){const f=z(),h=l!=null&&!f&&(p.max_instances===zs||l.length<p.max_instances),j=()=>{W.logEventWithStatsig("Contextual Answers Admin Create Connection Button Clicked","chatgpt_contextual_answers_admin_create_connection_button_clicked",{connectorType:a}),o?.()},v=e.jsx(b,{className:"text-nowrap",color:l?.length?"secondary":"primary",onClick:j,icon:hs,disabled:!h,children:l?.length?e.jsx(r,{id:"Ou779X",defaultMessage:"Connect another {connectedKnowledgeSource}",values:{connectedKnowledgeSource:g}}):e.jsx(r,{id:"Uvs01u",defaultMessage:"Connect"})});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-2 flex w-full flex-col gap-4",children:[e.jsxs("div",{className:"flex w-full flex-row flex-wrap items-center gap-4",children:[e.jsx("div",{className:"h-fit rounded-xl border-[0.5px] p-2 shadow-sm",children:e.jsx(t,{className:"icon-lg shrink-0"})}),e.jsxs("div",{className:"flex min-w-[240px] flex-1 flex-col gap-1",children:[e.jsx("p",{className:"font-semibold",children:n}),e.jsx("p",{className:"text-token-text-secondary text-xs",children:i})]}),!c&&e.jsx("div",{className:"flex shrink-0 items-center",children:h?v:f?e.jsx(se,{children:v}):null})]}),c?e.jsx(te,{lines:2}):l?.length?e.jsx(Ce,{children:e.jsxs("div",{className:"grid w-full gap-4",style:{gridTemplateColumns:"repeat(auto-fit, minmax(360px, 1fr))"},children:[l.filter(x=>!["deleted","deleting"].includes(x.connection_status)).map(x=>e.jsx(ze,{connection:x,accountId:s,refetchConnectionInstances:m,adminUserConnectionState:u?.find(y=>y.user_connection_details.connection_instance_id===x.connection_config.connection_config_id)},x.connection_config.connection_config_id)),l.length===1&&e.jsx("div",{},"grid-spacer")]})}):null]}),e.jsx(ae,{className:"mt-2"})]})}function Nt({accountId:s,connectionInstances:t,connectionInstancesLoading:n,refetchConnectionInstances:a}){return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-4 flex w-full flex-col gap-4",children:[e.jsxs("div",{className:"flex w-full flex-row flex-wrap items-center gap-4",children:[e.jsx(at,{className:"icon-2xl my-1 shrink-0"}),e.jsx("div",{className:"flex min-w-[240px] flex-1 flex-col gap-1",children:e.jsx("p",{className:"font-semibold",children:e.jsx(r,{id:"WFgOAD",defaultMessage:"Other connections"})})})]}),n?e.jsx(te,{lines:2}):t?.length?e.jsx(Ce,{children:e.jsxs("div",{className:"grid w-full gap-4",style:{gridTemplateColumns:"repeat(auto-fit, minmax(360px, 1fr))"},children:[t.map(i=>e.jsx(ze,{connection:i,showIcon:!0,accountId:s,refetchConnectionInstances:a},i.connection_config.connection_config_id)),t.length===1&&e.jsx("div",{},"grid-spacer")]})}):null]}),e.jsx(ae,{className:"mt-4"})]})}function Ke({badge:s}){const t=_();return e.jsxs("div",{children:[e.jsxs(J,{className:"flex flex-row items-center gap-2",children:[e.jsx("span",{children:t.formatMessage({id:"PzngEC",defaultMessage:"Synced connectors"})}),s]}),e.jsx($,{className:"text-token-text-secondary",children:e.jsx(r,{id:"XWG8hZ",defaultMessage:"ChatGPT syncs your organization’s content for higher quality, up-to-date answers. {learnMore}",values:{learnMore:e.jsx(De,{href:G,className:"underline",onClick:()=>Te({link:G,location:"admin_settings_header"}),children:e.jsx(r,{id:"WGpoE2",defaultMessage:"Learn more"})},"learnMore")}})})]})}function St({feedbackMetadata:s,currentWorkspaceId:t,onClose:n,onFeedbackActionTaken:a}){const i=_(),{data:o,refetch:l,isLoading:c}=L({queryKey:["adminGetCaMessageFeedback",t,s.feedback_id],queryFn:()=>T.safeGet("/ca/admin/feedback/{feedback_id}",{parameters:{path:{feedback_id:s.feedback_id},query:{account_id:t}}})}),u=D(),m=X({mutationFn:p=>p.operation==="delete"?T.safeDelete("/ca/admin/feedback/{feedback_id}",{parameters:{path:{feedback_id:p.feedbackId},query:{account_id:p.workspaceId}}}):T.safePost("/ca/admin/feedback/{feedback_id}/approve",{parameters:{path:{feedback_id:p.feedbackId},query:{account_id:p.workspaceId,with_sources:p.withSources}}}),onSuccess:(p,f)=>{a(),n(),u.success(f.operation==="approve"?i.formatMessage(w.feedbackApproved):i.formatMessage(w.feedbackDeleted))},onError:(p,f)=>{l(),u.warning(f.operation==="approve"?i.formatMessage(w.errorApprovingFeedback):i.formatMessage(w.errorDeletingFeedback))}}),g=d.useMemo(()=>{const p=s.review_status==="unreviewed",f=s.review_status==="unreviewed";let h;switch(s.review_status){case"approved_with_sources":case"approved_without_sources_data_expired":{h=i.formatMessage(w.actionMessageNoActionsAvailable);break}case"approved_without_sources_data_available":{h=i.formatMessage(w.actionMessageApprovedWithoutSources);break}case"deleted":{h=i.formatMessage(w.actionMessageFeedbackDeleted);break}}const j={workspaceId:t,feedbackId:s.feedback_id,withSources:!0};return e.jsxs("div",{className:"bg-token-main-surface-secondary sticky bottom-0 flex w-full flex-col gap-2 rounded-lg p-4",children:[!!h&&e.jsx("div",{children:e.jsx("p",{children:h})}),e.jsxs("div",{className:"flex flex-row gap-2",children:[p&&e.jsx(b,{color:"primary",icon:js,onClick:()=>m.mutate({...j,operation:"approve"}),loading:m.isPending,children:e.jsx(r,{id:"Zq8YOH",defaultMessage:"Approve Feedback"})}),f&&e.jsx(b,{color:"danger-outline",icon:ee,onClick:()=>m.mutate({...j,operation:"delete"}),loading:m.isPending,children:e.jsx(r,{id:"qeIjD9",defaultMessage:"Delete Feedback"})})]})]})},[s.review_status,s.feedback_id,m,t,i]);return e.jsx(At,{actionBar:g,onClose:n,isLoading:c,feedbackData:o,feedbackMetadata:s})}function At({actionBar:s=null,onClose:t=()=>{},isLoading:n=!1,isDebugView:a=!1,feedbackData:i,feedbackMetadata:o}){const l=_();return e.jsx(O,{testId:"modal-admin-feedback",size:"custom",className:"max-w-lg overflow-y-auto text-base",isOpen:!0,icon:_s,onClose:t,showCloseButton:!0,type:"success",title:l.formatMessage(w.modalTitle),children:e.jsx("div",{className:"flex flex-col",children:i&&!n?e.jsxs(e.Fragment,{children:[e.jsx(Dt,{feedbackData:i,feedbackMetadata:o,isDebugView:a}),e.jsx(le,{className:"my-4"}),e.jsx(Ft,{fileRefs:i.file_references}),e.jsx(le,{className:"my-4"}),e.jsx(Et,{retrievalMessages:i.retrieval_messages,userDisplayName:o.submitter_display_name??o.submitter_email,isDebugView:a}),s]}):e.jsx(Ks,{lines:8})})})}function Dt({feedbackMetadata:s,feedbackData:t,isDebugView:n=!1}){const a=_(),i=s.submitter_display_name&&s.submitter_email?a.formatMessage(w.userDisplayName,{displayName:s.submitter_display_name,email:s.submitter_email}):s.submitter_id,o=d.useMemo(()=>t.sources_feedback?Object.entries(t.sources_feedback).map(([l,c])=>{if(!c.rating&&!(c.tags&&c.tags.length>0))return null;const u=t.file_references.find(g=>g.document_id===l)?.title,m=c.tags&&c.tags.length===1&&c.tags[0]===Hs;return e.jsxs("li",{className:"flex flex-col p-1 text-sm break-words",children:[e.jsxs("div",{className:"mb-1 flex flex-row items-center gap-2",children:[c.rating==="thumbsUp"?e.jsx(Cs,{className:"icon-sm"}):c.rating==="thumbsDown"?e.jsx(re,{className:"icon-sm"}):null,e.jsx("a",{href:c.url??void 0,className:"text-sm font-semibold",children:u??c.url??l})]}),e.jsx("div",{className:"flex flex-row flex-wrap gap-1",children:m?e.jsx("span",{className:"italic",children:e.jsx(r,{id:"yNGc6H",defaultMessage:"This source should have been used."})}):c.tags?.map(g=>e.jsx("div",{className:"border-token-border-default text-token-text-secondary rounded-lg border px-3 py-1 text-xs",children:de(g,a)},g))})]},l)}).filter(l=>!!l):[],[t.file_references,t.sources_feedback,a]);return e.jsxs("div",{children:[!n&&e.jsx("div",{className:"mb-2",children:e.jsx(Ve,{reviewStatus:s.review_status})}),e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[t.rating==="thumbsUp"?e.jsx(bs,{className:"icon-xl m-2"}):e.jsx(re,{className:"icon-xl m-2"}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("p",{children:i}),s.submitted_at&&e.jsx("p",{className:"text-token-text-secondary text-xs",children:new Date(s.submitted_at).toLocaleString()})]})]}),t.tags&&t.tags.length>0&&e.jsx("div",{className:"mb-2 flex flex-wrap gap-1",children:t.tags?.map(l=>e.jsx("div",{className:"border-token-border-default text-token-text-secondary rounded-lg border px-3 py-1 text-sm",children:de(l,a)},l))}),e.jsxs("div",{className:"mb-2",children:[e.jsx(F,{className:"mb-1",children:e.jsx(r,{id:"VrPx6x",defaultMessage:"Feedback"})}),e.jsx("p",{className:"rounded-sm border p-2 text-sm break-words",children:t.text?t.text:e.jsx("span",{className:"italic",children:e.jsx(r,{id:"pEEJ/8",defaultMessage:"No written feedback was provided."})})})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx(F,{className:"mb-1",children:e.jsx(r,{id:"LUg6Vl",defaultMessage:"Additional Sources"})}),e.jsx("p",{className:"rounded-sm border p-2 text-sm break-words",children:t.additional_sources?t.additional_sources:e.jsx("span",{className:"italic",children:e.jsx(r,{id:"u24Zo5",defaultMessage:"No additional sources were provided."})})})]}),o.length>0&&e.jsxs("div",{className:"mb-2",children:[e.jsx(F,{className:"mb-1",children:e.jsx(r,{id:"lNSdNZ",defaultMessage:"Sources Feedback"})}),e.jsx("ul",{className:"flex flex-col gap-1",children:o})]})]})}const Tt=["citation","context_stuff","search_result"];function ge(s){return Array.from(s.map(t=>vs({id:t.document_id,cloud_doc_url:t.external_url??void 0,name:t.title??"",extra:{cloud_doc_url:t.external_url??void 0}})).filter(t=>!!t))}function Ft({fileRefs:s}){const[t,n]=d.useMemo(()=>{const a=new Map,i=new Map;return s.forEach(o=>{Tt.includes(o.reference_source)&&o.external_url&&!a.has(o.document_id)?a.set(o.document_id,o):o.reference_source==="user_feedback"&&o.external_url&&!i.has(o.document_id)&&i.set(o.document_id,o)}),[ge(Array.from(a.values())),ge(Array.from(i.values()))]},[s]);return e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx(F,{className:"mb-2",children:e.jsx(r,{id:"FB4YIA",defaultMessage:"Sources In Conversation"})}),t.length>0?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-token-text-secondary mb-2 text-xs",children:e.jsx(r,{id:"iTNNoN",defaultMessage:"These sources were considered or cited in the conversation. Snapshots of these sources will be included with the feedback if you choose to approve the feedback."})}),e.jsx("div",{className:"flex flex-col gap-1",children:t.map(a=>e.jsx(ce,{compact:!0,citationMetadata:a},a.url))})]}):e.jsx("p",{className:"text-token-text-secondary text-xs",children:e.jsx(r,{id:"Q+DKpB",defaultMessage:"No synced sources were considered or cited in the conversation, however there may be other sources present such as user uploaded files. If you choose to approve this feedback, only the snippets of those files that ChatGPT looked at will be shared with this feedback."})})]}),n.length>0&&e.jsxs("div",{className:"mt-8",children:[e.jsx(F,{className:"mb-2",children:e.jsx(r,{id:"SCwQnr",defaultMessage:"Sources From Feedback"})}),e.jsx("p",{className:"text-token-text-secondary mb-2 text-xs",children:e.jsx(r,{id:"Rr+4KZ",defaultMessage:"The feedback submitter mentioned these documents in their feedback. Snapshots of these documents will be included with the feedback if you choose to approve the feedback with sources and the user had access to them."})}),e.jsx("div",{className:"flex flex-col gap-1",children:n.map(a=>e.jsx(ce,{compact:!0,citationMetadata:a},a.url))})]})]})}function Et({retrievalMessages:s,userDisplayName:t,isDebugView:n=!1}){return e.jsxs("div",{className:"mb-8",children:[e.jsx(F,{className:"mb-4",children:e.jsx(r,{id:"pOb00r",defaultMessage:"Conversation"})}),s.map(a=>e.jsx(It,{message:a,userDisplayName:t,isDebugView:n},a.id))]})}function It({message:s,userDisplayName:t,isDebugView:n=!1}){const a=_();switch(s.type){case"visible_text":{if(s.author==="unknown")return null;const i={id:s.id,author:{role:s.author},clientMetadata:{canRetry:!1},metadata:{citations:s.citations??[],attachments:s.attachments??[],content_references:s.content_refs?s.content_refs:(s.citations??[]).map(o=>o.metadata?.type!=="file"?null:{start_idx:o.start_ix,end_idx:o.end_ix,refs:[],matched_text:s.text.slice(o.start_ix,o.end_ix),type:"file",source:o.metadata.source,name:o.metadata.name,id:o.metadata.id,cloud_doc_url:o.metadata.cloud_doc_url??o.metadata.extra?.cloud_doc_url}).filter(o=>!!o)},content:{content_type:Xe.Text,parts:[s.text]}};return e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:q("text-token-text-secondary mb-1 text-xs",s.author==="user"?"pe-4 text-end":"text-start"),children:s.author==="assistant"?a.formatMessage(w.authorChatGPT):s.author==="user"?t??a.formatMessage(w.authorUser):s.author}),e.jsx(ws,{id:s.id,messages:[i],attachments:i.metadata?.attachments,citations:i.metadata?.citations,contentReferences:i.metadata?.content_references,parts:[s.text],displayParts:ks({isUserTurn:s.author==="user",parts:[s.text]}),isActivelyStreaming:!1,isCompletionInProgress:!1,isFinalUserTurn:!1,hasActiveRequest:!1,clientThreadId:"--fake-thread-id--",isUserTurn:s.author==="user",turnIndex:0,isFeedbackEnabled:!1})]})}case"query":return e.jsxs("div",{className:"text-token-text-primary my-2 text-xs",children:[e.jsx(Ys,{className:"me-2"}),n?e.jsx(r,{id:"AVzRit",defaultMessage:"ChatGPT performed a search: {query}",values:{query:s.query}}):e.jsx(r,{id:"bJ9BXd",defaultMessage:"ChatGPT performed a search."})]});case"result":return n?e.jsx(Pt,{message:s}):null;case"fetch":return n?e.jsxs("div",{className:"text-token-text-primary my-2 text-xs",children:[e.jsx(ys,{className:"me-2"}),e.jsx(r,{id:"uH5X47",defaultMessage:"Read file: {fileName}",values:{fileName:s.content.content_type==="tether_quote"?s.content.title:"unknown"}})]}):null;case"generic_file_search_tool":return n?e.jsxs("div",{className:"text-token-text-primary my-2 text-xs",children:[e.jsx(Qs,{className:"me-2"}),e.jsx(r,{id:"pJmg4S",defaultMessage:"Tool message with command: {command}.",values:{command:s.command}})]}):null;case"system":case void 0:return null}}function Pt({message:s}){const[t,n]=d.useState(!1);return s.type!=="result"?null:e.jsxs("div",{className:"text-token-text-primary mt-2 mb-4 text-xs",children:[e.jsxs("div",{onClick:()=>n(a=>!a),className:"flex flex-row",children:[e.jsx(Vs,{checked:t,className:"flex-0"}),e.jsx("div",{className:"flex-1",children:e.jsx(r,{id:"94EEkt",defaultMessage:"Found {numResults} results.",values:{numResults:s.result.chunks.length}})})]}),t&&e.jsxs("div",{className:"mt-2",children:[s.result.chunks.map(a=>e.jsxs("div",{className:"mb-2",children:[e.jsx("h4",{className:"text-token-text-primary mb-1 text-sm font-bold",children:e.jsx(r,{id:"zyGUoc",defaultMessage:"Result {number}: {title}",values:{number:a.result_num,title:a.title}})}),e.jsx("h4",{className:"text-token-text-secondary mb-1 text-xs",children:a.document_id}),e.jsx("pre",{className:"max-h-[200px] max-w-full overflow-auto p-2 text-wrap",children:a.contents})]},a.result_num)),e.jsxs("div",{className:"p-2 text-center",onClick:()=>n(!1),children:[e.jsx("p",{className:"text-token-text-secondary mb-1 font-bold",children:e.jsx(r,{id:"8UUzYt",defaultMessage:"Collapse Results"})}),e.jsx("hr",{className:""})]})]})]})}function Ve({reviewStatus:s,onClick:t,disabled:n}){let a;const i=_();switch(s){case"unreviewed":a=i.formatMessage(w.reviewStatusUnreviewed);break;case"approved_with_sources":a=i.formatMessage(w.reviewStatusApprovedWithSouces);break;case"approved_without_sources_data_available":case"approved_without_sources_data_expired":a=i.formatMessage(w.reviewStatusApprovedWithoutSources);break;case"deleted":a=i.formatMessage(w.reviewStatusDeleted);break}return e.jsx("button",{className:q("text-token-text-primary rounded-2xl px-3 py-1 text-sm",s==="unreviewed"&&"bg-[#e2c541] dark:bg-[#EA8444]"),onClick:t,disabled:!!n||!t,children:a})}const w=Q({modalTitle:{id:"zufVun",defaultMessage:"Review Feedback"},feedbackApproved:{id:"DS+YGt",defaultMessage:"Feedback approved."},feedbackDeleted:{id:"Rz/tmW",defaultMessage:"Feedback deleted."},errorApprovingFeedback:{id:"UVsTlf",defaultMessage:"Encountered an error approving this feedback. Please refresh and try again."},errorDeletingFeedback:{id:"cI6gt9",defaultMessage:"Encountered an error deleting this feedback. Please refresh and try again."},actionMessageFeedbackCreating:{id:"urBely",defaultMessage:"You can't take actions on this feedback yet because it's still being processed. Once it's done processing, it will be available for review."},actionMessageNoActionsAvailable:{id:"JGNhjT",defaultMessage:"This feedback has been reviewed."},actionMessageApprovedWithoutSources:{id:"68PAfK",defaultMessage:"This feedback has already been approved without sources, but you can re-approve it with sources."},actionMessageFeedbackDeleted:{id:"Kel9lE",defaultMessage:"This feedback has been deleted."},labelIncludeSources:{id:"8UlZM0",defaultMessage:"Include Sources"},authorChatGPT:{id:"7Fo5p2",defaultMessage:"ChatGPT"},authorUser:{id:"TpT0hg",defaultMessage:"User"},userDisplayName:{id:"3OKTcX",defaultMessage:"{displayName} ({email})"},reviewStatusUnreviewed:{id:"FEHKZj",defaultMessage:"Needs Review"},reviewStatusCreating:{id:"7lVVU7",defaultMessage:"Preparing for Review"},reviewStatusApprovedWithSouces:{id:"kpZ41g",defaultMessage:"Approved With Sources"},reviewStatusApprovedWithoutSources:{id:"Y0lc+p",defaultMessage:"Approved Without Sources"},reviewStatusDeleted:{id:"gKoYhr",defaultMessage:"Deleted"}});function Rt({currentWorkspaceId:s}){const{data:t,refetch:n,isLoading:a}=L({queryKey:["adminListCaMessageFeedback",s],queryFn:()=>T.safeGet("/ca/admin/feedback",{parameters:{query:{account_id:s}}})}),[i,o]=d.useState();return e.jsxs(Z,{className:"mb-8",children:[e.jsx(J,{children:e.jsx(r,{id:"r4Y3mj",defaultMessage:"Review Feedback"})}),e.jsx($,{className:"text-token-text-secondary",children:e.jsx(r,{id:"mqh7NS",defaultMessage:"Review feedback your workspace users have submitted. Feedback is not shared with OpenAI until you approve it."})}),t&&!a?e.jsx(Ot,{feedbackList:t.feedback,setSelectedFeedback:o}):e.jsx(E,{}),i&&e.jsx(St,{feedbackMetadata:i,currentWorkspaceId:s,onClose:()=>o(void 0),onFeedbackActionTaken:()=>n()})]})}function pe(s){switch(s){case"unreviewed":return 1;case"approved_with_sources":return 2;case"approved_without_sources_data_available":return 3;case"approved_without_sources_data_expired":return 4;case"deleted":return 5}}function Ot({feedbackList:s,setSelectedFeedback:t}){const n=d.useMemo(()=>[...s].sort((a,i)=>{const o=pe(a.review_status)-pe(i.review_status);return o!==0?o:a.submitted_at>i.submitted_at?-1:a.submitted_at<i.submitted_at?1:0}),[s]);return e.jsxs(k.Root,{size:"normal",children:[e.jsxs(k.Header,{children:[e.jsx(k.HeaderCell,{className:"bg-token-main-surface-primary",children:e.jsx(r,{id:"KcGNl2",defaultMessage:"Review Status"})}),e.jsx(k.HeaderCell,{className:"bg-token-main-surface-primary w-40",children:e.jsx(r,{id:"joba0B",defaultMessage:"Submitted By"})}),e.jsx(k.HeaderCell,{className:"bg-token-main-surface-primary w-40",children:e.jsx(r,{id:"yl1cCR",defaultMessage:"Submitted At"})})]}),e.jsx(k.Body,{children:n.length===0?e.jsx(k.Row,{children:e.jsx(k.Cell,{children:e.jsx(r,{id:"AYwCJD",defaultMessage:"No feedback yet."})})}):n.map(a=>{const i=a.review_status==="deleted",o=i?void 0:()=>t(a);return e.jsxs(k.Row,{className:q("my-2",i?"bg-token-main-surface-tertiary":"hover:bg-token-main-surface-secondary hover:cursor-pointer"),onClick:o,children:[e.jsx(k.Cell,{className:"truncate",children:e.jsx(Ve,{reviewStatus:a.review_status,onClick:o,disabled:i})}),e.jsx(k.Cell,{className:"truncate",children:e.jsx("span",{children:a.submitter_display_name&&a.submitter_email?e.jsx(r,{id:"3OKTcX",defaultMessage:"{displayName} ({email})",values:{displayName:a.submitter_display_name,email:a.submitter_email}}):e.jsx("code",{children:a.submitter_id.split("__")[0]})})}),e.jsx(k.Cell,{className:"truncate",children:e.jsx("span",{children:new Date(a.submitted_at).toLocaleString()})})]},a.feedback_id)})})]})}function Lt(){const s=_();ss(!0);const t=B(),n=Ms(),a=ts(),i=Je(),o=$e(i,"2509278897");return e.jsxs(e.Fragment,{children:[e.jsx(as,{title:s.formatMessage({id:"q9azuh",defaultMessage:"Connectors"})}),e.jsx(ns,{skipLegacyWorkspaceCheck:!0,children:e.jsxs(os,{className:"mt-6 gap-6",children:[a?e.jsxs(e.Fragment,{children:[e.jsx(Mt,{}),t!=null&&n===Ns.ALPHA&&e.jsx(Rt,{currentWorkspaceId:t.id})]}):e.jsx(Ut,{}),t!=null&&o&&e.jsx(tt,{workspaceId:t.id})]})})]})}function Ut(){return e.jsxs(e.Fragment,{children:[e.jsx(Z,{children:e.jsx(Ke,{badge:e.jsx("div",{children:e.jsx("span",{className:"text-token-text-secondary rounded-xl border px-2 py-1 text-[8px] font-bold uppercase",children:e.jsx(r,{id:"IrfQIu",defaultMessage:"Coming soon"})})})})}),e.jsxs("div",{className:"bg-token-main-surface-tertiary text-token-text-secondary flex flex-row gap-2 rounded-xl p-4",children:[e.jsx(Ss,{className:"icon-md"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-xs font-bold",children:e.jsx(r,{id:"ES5xU+",defaultMessage:"When will this feature be available?"})}),e.jsxs("p",{className:"text-xs",children:[e.jsx(r,{id:"9w5rs5",defaultMessage:"Internal knowledge will be rolled out incrementally to ChatGPT Team workspaces over the next few weeks. We will notify you in ChatGPT when your workspace is eligible."})," ",e.jsx(De,{href:G,className:"underline",onClick:()=>Te({link:G,location:"admin_settings_coming_soon_widget"}),children:e.jsx(r,{id:"WGpoE2",defaultMessage:"Learn more"})})]})]})]})]})}const Sa=es(function(){return e.jsx(Lt,{})});export{Sa as default};
//# sourceMappingURL=nbwwfwpjtl4xaztu.js.map
