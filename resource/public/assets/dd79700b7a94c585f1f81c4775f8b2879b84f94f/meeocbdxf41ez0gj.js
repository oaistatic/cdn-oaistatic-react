import{j as E,t as v,fc as b,fd as R}from"./eb6xg52mym6rhnsh.js";import{a as A,f as q,r as e,j as n,a9 as F,d as L,h as M,D as N}from"./cs2gapsc2bulabhw.js";import{u as Q}from"./hdzunc7lvo2i8v4s.js";import{e as U,f as K,c as O,W as $,d as B}from"./flul5lgejanvmzis.js";import{b as G,c as H}from"./f2cwocui2o4rh90z.js";import{P as z}from"./do5nmvaddt7ak8xi.js";import{ft as J}from"./pduvb49qgyq1mqhk.js";import{u as V,W as X}from"./kbstf1piopltknze.js";import{i as Y}from"./ke1leuxpoxd60g1m.js";import"./e95x0gs5di7mq1tw.js";import"./ggve90in2x9hqouv.js";import"./m51yqcd3jsaldp76.js";import"./nlwtx7zdm2am1wmc.js";import"./ltl83crjtn7g9n8e.js";import"./fb2gj4fu6zbut62o.js";import"./kmvt5g0oz7ekj3ft.js";import"./ec6jcwftshefgs7y.js";import"./kvmheozf1dv1rz41.js";import"./m4uwihyvndo7xd88.js";import"./kla29aasg3zke6fd.js";import"./m6mpdolaukauf1xm.js";import"./dwy8f7y5ary0iziz.js";import"./msransmxvuas3w3d.js";import"./ls88si7tay0ysj3s.js";import"./c4jo9vhmn844acg2.js";import"./iop0mej0v36g33vx.js";import"./pc2givv05uuq8g6l.js";import"./dijlyyo6bxi7y1gl.js";import"./fm8x6rikk7wmsjrt.js";import"./oeue9sgf06niyskm.js";import"./j0zvljvurep0tkuq.js";import"./oe3vdo8nwau2d3cp.js";import"./isvebwen77ppsppm.js";import"./pm0gb7r9jflnjr23.js";import"./mqwhn0zqom5s9tn7.js";import"./h86cr3c8dmjcpsff.js";import"./o0c2m6gntt3um3fq.js";import"./bexqq0lppc5qpzyo.js";import"./fstrpgl2cuv98v3x.js";import"./fzrn137102spawew.js";import"./f7rvgpv9xzkroj1j.js";import"./hpw4a5uwyazjbwfj.js";import"./hpoi02g0dgpne8ux.js";import"./lzqtvz4ppmzufktl.js";import"./dugtojg1blcdqewy.js";function Z({taskId:s,onClose:a}){const o=A(),m=E(),i=q(),{data:t,error:x}=U(s);K(s);const g=O(({getTurnsForTask:r})=>r(s)),u=v(),c=e.useMemo(()=>u?new z(G()):new J,[u]),p=e.useSyncExternalStore(r=>c.subscribe("change",r),()=>!c.isEmpty(),()=>!1),[f,l]=e.useState([]),[P,d]=e.useState(!1),{focusedAssistantTurn:_,setFocusedAssistantTurnId:D}=V({taskId:s,task:t?.task,currentDiffTaskTurn:t?.current_diff_task_turn??null,currentUserTurn:t?.current_user_turn??null,currentAssistantTurn:t?.current_assistant_turn??null}),C=!!t?.task.has_unread_turn&&t?.task?.current_turn_id===t.current_assistant_turn?.id,k=t?.current_assistant_turn?.turn_status==="completed";e.useEffect(()=>{if(!u)return;const r=t?.task?.title;if(r){const y=document.title;return document.title=r,()=>{document.title=y}}},[u,t?.task?.title]),e.useEffect(()=>{C&&k&&$.markTurnAsRead(s).then(()=>{o.invalidateQueries({queryKey:["wham","tasks"]}),o.invalidateQueries({queryKey:["wham","task",s]})})},[C,k,s,o]);const h=f.length>0,T=e.useCallback(({force:r=!1}={})=>{if(r||!h&&!p){l([]),a();return}d(!0)},[a,h,p]),S=t?.current_assistant_turn?Y(t?.current_assistant_turn.turn_status):!1,W=t?.current_diff_task_turn?.id===_?.id,j=!t?.current_diff_task_turn,w=S&&(W||j);return x?(m.danger(i.formatMessage({id:"wham.task-details.error",defaultMessage:"Error loading task"}),{id:`wham-task-details-error-${s}`,hasCloseButton:!0,duration:3}),n.jsx(F,{to:"/codex"})):n.jsx(H.Provider,{value:c,children:n.jsx(X,{permissions:"write",onEscape:T,taskId:s,turnId:t?.current_assistant_turn?.id??"",lastTurnWithDiffId:t?.current_diff_task_turn?.id??"",confirmClose:P,setConfirmClose:d,task:t?.task,focusedAssistantTurn:_,pastTurns:g,clearComments:()=>l([]),setComments:l,comments:f,canFollowUp:w,handleClose:T,setFocusedAssistantTurnId:D})})}function I(){const s=L(),a=M(),{taskId:o}=N();Q(),B();const m=a.state??{},{backgroundLocation:i}=m,t=e.useCallback(()=>{s(i?-1:"/codex")},[i,s]);return o?n.jsx(b,{children:n.jsx(Z,{taskId:o,onClose:t})}):null}const Gt=()=>[{title:"Codex"}],Ht=R(function(){return n.jsx(I,{})});export{Ht as default,Gt as meta};
//# sourceMappingURL=meeocbdxf41ez0gj.js.map
