import{j as n,a5 as C,aa as $,f as k,r as u,a as V,a6 as q,g as H,d as z}from"./cs2gapsc2bulabhw.js";import{dq as X,ds as K,p as Q,c as m,en as J,dt as Y,dv as Z,du as ee,F as ae,dG as se,dH as te,f as ne,aa as re,aV as P,l as oe,o as L,bb as v,ab as I,b as N,j as ie,ai as R,e as U,cV as le,aS as T,cp as S,e1 as ce,L as de,h as ue,B as fe}from"./eb6xg52mym6rhnsh.js";import{cL as me,j as he,db as A,dc as ge,dd as F,bt as xe,a4 as pe,aX as ke,de as we,df as ve,dg as be,aM as Me}from"./pduvb49qgyq1mqhk.js";function Se({className:e,children:a,position:t="center",size:s,removePopoverStyling:r=!1,shadow:o="normal"}){const i=$(),l=k(),c=Math.random()*40-20;return u.useEffect(()=>{i.start({x:0,y:0,rotate:0,opacity:1,transition:{type:"spring",duration:.6,bounce:.15}})},[i]),n.jsx(C.div,{initial:{x:0,y:"100%",rotate:0,opacity:1},animate:i,exit:{x:0,y:"100%",rotate:c,opacity:1},transition:{type:"spring",duration:.6,bounce:.15},className:m("z-50 h-full w-full overflow-y-auto",s!=="fullscreen"&&"grid grid-cols-[10px_1fr_10px]",s!=="fullscreen"&&t==="center"&&"grid-rows-[minmax(10px,1fr)_auto_minmax(10px,1fr)] md:grid-rows-[minmax(20px,1fr)_auto_minmax(20px,1fr)]",s!=="fullscreen"&&t==="bottom"&&"grid-rows-[minmax(10px,1fr)_auto_10px] md:grid-rows-[minmax(20px,1fr)_auto_20px]"),children:n.jsx(Z,{className:m(!r&&"popover","bg-token-sidebar-surface relative start-1/2 col-auto col-start-2 row-auto row-start-2 h-full w-full gap-4 p-4 text-start ltr:-translate-x-1/2 rtl:translate-x-1/2 dark:bg-[#171717]",s!=="fullscreen"&&"rounded-[36px]",o==="normal"&&"shadow-[0_32px_48px_rgba(0,0,0,0.175),_0_0_1px_rgba(0,0,0,0.2)] dark:shadow-[0_32px_48px_rgba(0,0,0,0.175),_0_0_1px_rgba(255,255,255,0.4)]",e),"aria-description":l.formatMessage({id:"slide-up-modal.share-sheet.description",defaultMessage:"Share sheet"}),"aria-describedby":"",children:a})})}function ye({isOpen:e,onClose:a,children:t,shouldIgnoreClickOutside:s=!1,className:r}){return n.jsx(X,{open:e,onOpenChange:o=>{s||o===!1&&a(!1)},children:n.jsx(K,{container:Q()?.document.body,children:n.jsx("div",{className:m("absolute inset-0",r),children:t})})})}function je({className:e,children:a,showBackground:t=!0}){const s=J(),r=t?s?"rgba(0, 0, 0, 0.8)":"rgba(249,249,249,0.8)":"rgba(0, 0, 0, 0)";return n.jsx(Y,{asChild:!0,children:n.jsx(C.div,{initial:{backdropFilter:"blur(0px)",backgroundColor:s?"rgba(0, 0, 0, 0)":"rgba(255, 255, 255, 0)"},animate:{backdropFilter:t?"blur(4px)":"blur(0px)",backgroundColor:r},exit:{backdropFilter:"blur(0px)",backgroundColor:s?"rgba(0, 0, 0, 0)":"rgba(255, 255, 255, 0)"},className:m("fixed inset-0 z-50",e),children:a})})}function _e({title:e,description:a,icon:t,type:s}){return n.jsxs("div",{className:"flex max-w-full min-w-0 items-center",children:[n.jsx(Pe,{icon:t,type:s}),n.jsxs("div",{className:"flex max-w-full min-w-0 grow flex-col gap-1",children:[e!=null&&n.jsx(se,{className:"text-token-text-primary text-3xl leading-6 font-semibold tracking-tight max-sm:text-xl",children:e}),a!=null&&n.jsx(te,{className:"text-token-text-tertiary text-sm",children:a})]})]})}function Ce({title:e,accessory:a,description:t,withSeparator:s=!0,icon:r,type:o,closeButton:i,textCenter:l}){return!e&&!t?null:n.jsxs(Le,{$hasSeparator:s,children:[n.jsx("div",{className:m("flex max-w-full",l&&"flex-1 justify-center text-center"),children:n.jsx(_e,{title:e,description:t,icon:r,type:o})}),n.jsxs("div",{className:"flex items-center gap-5",children:[a,i!=null&&n.jsx(ee,{asChild:!0,className:"sm:mt-0",children:i})]})]})}const Pe=({type:e,icon:a})=>a==null?null:n.jsx("div",{className:m("me-4 flex h-12 w-12 shrink-0 items-center justify-center rounded-full sm:h-10 sm:w-10",e==="danger"&&"bg-red-100",e==="warning"&&"bg-yellow-100",e==="success"&&"bg-green-100"),children:n.jsx(a,{className:m("icon-lg",e==="danger"&&"text-red-600",e==="warning"&&"text-yellow-700",e==="success"&&"text-green-700"),"aria-hidden":"true"})}),Le=ae.div`px-4 pb-2 sm:p-6 flex items-center justify-between ${({$hasSeparator:e})=>e&&"border-b border-black/10 dark:border-white/10"}`,w={Root:ye,Overlay:je,Content:Se,Header:Ce},f=H({copyLink:{id:"postSharingModal.copyLink",defaultMessage:"Copy link"},linkCopied:{id:"postSharingModal.linkCopied",defaultMessage:"Link copied!"},failedToGenerateShareLink:{id:"postSharingModal.failedToGenerateShareLink",defaultMessage:"Failed to generate share link"},fromChatGPT:{id:"postSharingModal.fromChatGPT",defaultMessage:"From ChatGPT"},contentUnavailable:{id:"postSharingModal.contentUnavailable",defaultMessage:"Content Unavailable"},unavailableReasonGeneral:{id:"postSharingModal.unavailableReasonGeneral",defaultMessage:"This share link is not available because it doesn’t exist or you don’t have access to it."},unavailableReasonWorkspace:{id:"postSharingModal.unavailableReasonWorkspace",defaultMessage:"This content was shared from a workspace you don’t have access to. Ask the owner to invite you if you’d like to view it."},ok:{id:"postSharingModal.ok",defaultMessage:"OK"},shareLinkVisibleToWorkspaceOnly:{id:"postSharingModal.shareLinkVisibleToWorkspaceOnly",defaultMessage:"The share links are visible to workspace members only."}});function Ie(e){const a=ce(e,t=>S.getImageAssetPointers(t).length>0);return a?S.getImageAssetPointers(a)[0]:null}function Ne({showLinkCopied:e,isGeneratingShareLink:a,onClick:t,postText:s,showDownloadButton:r,disabled:o}){const i=k(),l=R()?.isWorkspaceAccount();let c=[{id:"copy",icon:a?n.jsx(de,{}):n.jsx(pe,{}),label:e?i.formatMessage(f.linkCopied):i.formatMessage(f.copyLink),action:"copy"}];return l&&r?c.push({id:"download",icon:n.jsx(ke,{}),label:i.formatMessage({id:"postSharingModal.download",defaultMessage:"Download"}),action:"download"}):c=c.concat({id:"x",href:d=>`https://twitter.com/intent/tweet?url=${encodeURIComponent(d)}&text=${s?encodeURIComponent(s):""}`,icon:n.jsx(we,{initialFillColor:"var(--text-primary)"}),label:i.formatMessage({id:"postSharingModal.x",defaultMessage:"X"}),action:"share"},{id:"linkedin",href:d=>`https://www.linkedin.com/shareArticle?url=${encodeURIComponent(d)}&text=${s?encodeURIComponent(s):""}`,icon:n.jsx(ve,{initialFillColor:"var(--text-primary)"}),label:i.formatMessage({id:"postSharingModal.linkedin",defaultMessage:"LinkedIn"}),action:"share"},{id:"reddit",href:d=>`https://www.reddit.com/submit?url=${encodeURIComponent(d)}&title=${s?encodeURIComponent(s):""}`,icon:n.jsx(be,{initialFillColor:"var(--text-primary)"}),label:i.formatMessage({id:"postSharingModal.reddit",defaultMessage:"Reddit"}),action:"share"}),n.jsx(n.Fragment,{children:c.map(d=>n.jsxs("button",{onClick:()=>{t(d),U.logEventWithStatsig("Share Post: Social Clicked","chatgpt_post_share_link_social_clicked",{platform:d.id})},disabled:o,className:"relative flex flex-col gap-y-4 disabled:opacity-50 max-sm:gap-y-2",children:[n.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-full shadow-lg max-sm:h-12 max-sm:w-12 max-sm:shadow-md dark:shadow-md",children:n.jsx("div",{className:"pointer-events-none flex h-8 w-8 items-center justify-center max-sm:h-6 max-sm:w-6",children:d.icon})}),n.jsx("div",{className:"w-full text-center text-xs",children:d.label})]},d.id))})}async function Re(e,a,t){return A(a.asset_pointer)?(await ge(e,[a],null,void 0,t))[0]:null}const Ue=async(e,a,t)=>{const s=()=>I.findNode(T(a),({message:i})=>i.id===t||!!S.getImageAssetPointers(i).find(l=>l.asset_pointer===e));let r=s();if(!r?.message&&(await he(a),r=s(),!r?.message))return null;const o=v(a);return{postText:r.message.metadata?.image_gen_title,imageAssetPointer:Ie([r.message]),serverThreadId:o}};async function Te(e,a,t,s){const r=A(a.asset_pointer);if(!r)return null;const o=await N.safePost("/share/post",{requestBody:{post_text:t,attachments_to_create:[{kind:"image_share",file_id:r,conversation_id:e,width:s?.width,height:s?.height}]}});return F(o.post.id)}async function Ae(e,a,t){const s=await N.safePost("/share/post",{requestBody:{post_text:t,attachments_to_create:[{kind:"message_slice",conversation_id:e,message_ids:a}]}});return F(s.post.id)}function Fe(e,a){const t=T(e);return t?{kind:"message_slice",messages:a.map(r=>{const o=I.findNode(t,({message:i})=>i.id===r);return o?o.message:null}).filter(Boolean)}:null}function W({postSharingData:e,closeModal:a}){const{clientThreadId:t,postText:s,generateShareLinkFn:r,coverImageUrl:o,messageSliceIds:i}=e,l=u.useRef(void 0),[c,d]=u.useState(!1),[g,x]=u.useState(!1),h=k(),b=ie(),[B,y]=u.useState(!0),O=R()?.isWorkspaceAccount();u.useEffect(()=>{U.logEventWithStatsig("Share Post: Post Sharing Modal Shown","chatgpt_post_share_modal_shown")},[]),u.useEffect(()=>{l.current=void 0},[t]);const j=u.useMemo(()=>o||!i||i.length===0?null:Fe(t,i),[o,t,i]),_=v(t),D=async p=>{if(!(c||!_)&&_){if(!l.current){d(!0);try{const M=await r();M&&(l.current=M)}catch{b.danger(h.formatMessage(f.failedToGenerateShareLink))}finally{d(!1)}}if(l.current){if(p.action==="copy")navigator.clipboard.writeText(l.current),x(!0),b.success(h.formatMessage(f.linkCopied)),setTimeout(()=>{x(!1)},3e3);else if(p.action==="share"&&p.href)window.open(p.href(l.current),"_blank","noopener,noreferrer");else if(p.action==="download"){if(!o)return;Me({url:o,fileName:`${s}.png`})}}}},E=n.jsx("div",{className:m("max-xs:max-h-[260px] flex h-[30vh] max-h-[550px] w-full justify-center rounded-xl max-sm:max-h-[300px]",!o&&"outline-token-border-light overflow-hidden shadow-sm outline outline-1"),children:o?n.jsx("img",{src:o,alt:s}):j&&n.jsx(xe,{attachments:[j],clientThreadId:t})});return n.jsx(q,{onExitComplete:a,children:B&&n.jsx(w.Root,{isOpen:!0,onClose:()=>{y(!1)},className:"max-w-[664px] px-4",children:n.jsx(w.Overlay,{showBackground:!0,children:n.jsxs(w.Content,{size:"normal",position:"center",className:m("flex flex-col pb-4 focus:outline-hidden",{"max-w-[640px]":"normal"==="normal"}),removePopoverStyling:!1,shadow:"normal",children:[n.jsx(w.Header,{title:s,type:"success",closeButton:n.jsx(le,{onClick:()=>y(!1)})}),n.jsxs("div",{children:[n.jsx("div",{className:"pointer-events-none flex justify-center",children:E}),n.jsx("div",{className:"mt-12 flex flex-wrap justify-center space-y-4 space-x-12 max-sm:mt-6 max-sm:space-x-6",children:n.jsx(Ne,{showLinkCopied:g,isGeneratingShareLink:c,disabled:c,onClick:D,postText:s,showDownloadButton:!!o})}),O&&n.jsx("p",{className:"text-token-text-tertiary text-center text-sm sm:mt-4",children:h.formatMessage(f.shareLinkVisibleToWorkspaceOnly)})]})]})})})})}const We=u.createContext({postWithProfile:null,setIsReportModalOpen:e=>{}});function qe(){return!!u.useContext(We)?.postWithProfile}async function G({postText:e,postTitle:a,clientThreadId:t,generateShareLinkFn:s,usePostText:r,useShareLink:o,useShareTitle:i}){if(!v(t))return!1;try{const c=await s();return c?(await navigator.share({text:r?e:void 0,url:o?c:void 0,title:i?a:void 0}),!0):!1}catch{return!1}}async function Ge(e,a,t,s,r,o){const i=await Ue(e,a,t);if(!i?.imageAssetPointer||!i?.serverThreadId)return;const{postText:l,imageAssetPointer:c,serverThreadId:d}=i,g=await Re(s,c,d);if(!g)return;const x=()=>Te(d,c,l,g);if(o&&P(r,"1138231213")){const h=oe(r,"2382399797");if(await G({clientThreadId:a,postText:l,generateShareLinkFn:x,usePostText:h.get("navigator_share_text",!1),useShareLink:h.get("navigator_share_link",!1)}))return}L(r,W,{postSharingData:{clientThreadId:a,postText:l,generateShareLinkFn:x,coverImageUrl:g?.url}})}async function Be(e,a,t,s,r){const o=v(e);if(!o)return;const i=()=>Ae(o,a,r);s&&P(t,"1138231213")&&await G({clientThreadId:e,generateShareLinkFn:i,useShareLink:!0,useShareTitle:!0,postTitle:r})||L(t,W,{postSharingData:{clientThreadId:e,generateShareLinkFn:i,postText:r,messageSliceIds:a}})}function He({assetPointer:e=null,clientThreadId:a,imageGenMessageId:t,messageSliceIds:s}){const r=V(),o=ne(),i=me(),l=re(a,c=>c?.title);return u.useCallback(async()=>{t?await Ge(e,a,t,r,o,i):s&&await Be(a,s,o,i,l??void 0)},[e,a,t,s,l,r,i,o])}function Oe(e){const a=k();switch(e){case"general":return a.formatMessage(f.unavailableReasonGeneral);case"workspace":return a.formatMessage(f.unavailableReasonWorkspace);default:return a.formatMessage(f.unavailableReasonGeneral)}}function ze({closeModal:e,reason:a}){const t=k(),s=z(),r=()=>{e(),s("/")},o=Oe(a);return n.jsx(ue,{testId:"modal-post-sharing-error",isOpen:!0,type:"danger",textCenter:!0,title:t.formatMessage(f.contentUnavailable),description:o,onClose:r,footerContent:n.jsx(fe,{size:"large",color:"primary",className:"w-full",onClick:r,children:t.formatMessage(f.ok)})})}export{ze as P,We as a,qe as b,He as u};
//# sourceMappingURL=epqkr08njby1t19h.js.map
