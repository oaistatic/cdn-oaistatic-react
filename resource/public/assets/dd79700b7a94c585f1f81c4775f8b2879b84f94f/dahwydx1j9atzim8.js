import{r as l,ah as B,p as K,f as Y,j as r,a6 as X,a5 as x}from"./cs2gapsc2bulabhw.js";import{lf as Q,lg as $,lh as j,dn as J,C as p,li as Z,lj as tt,kq as et,lk as at,ll as st,lm as ot,ln as nt,i_ as it,lo as rt,lp as ct,lq as dt,lr as R,ls as O,iY as lt,u as ut,lt as N,U as M,lu as k,lv as mt,lw as pt,hD as ht,lx as ft}from"./pduvb49qgyq1mqhk.js";import{h9 as S,aB as D,aa as z,ab as T,cY as gt,e1 as xt,gh as vt,e_ as F,eQ as Ct,gY as wt,gl as Tt}from"./eb6xg52mym6rhnsh.js";import{u as It,L as bt}from"./o9jbx8esqeax3dhl.js";import{T as yt}from"./n28u28v6jphl8y3u.js";import{g as St}from"./btagl6w1gub4aw61.js";import"./jy1u8exw8iz2slve.js";import"./hpoi02g0dgpne8ux.js";import"./kmvt5g0oz7ekj3ft.js";import"./fi1xw3fnwortmtrb.js";import"./kpz7qev108jf94tz.js";import"./nhgg43vfy9ih4vl5.js";import"./pbk0s8tey8blca1e.js";import"./n3cijkf5teq8hl4t.js";import"./f76gy0b8ieo4s693.js";import"./gy64pge8qevmvg7e.js";import"./do5nmvaddt7ak8xi.js";import"./e95x0gs5di7mq1tw.js";import"./dv3d7908pzpkjndg.js";import"./ekzdsqfpi8dxrf9q.js";import"./jcndegd4nkgfbfly.js";import"./jvqxvg1ld8ud62qh.js";import"./xbmjt85q81k7ilbj.js";import"./ocr8ihe7mqprglo4.js";import"./nkcra1lf12hy5eza.js";import"./j0zvljvurep0tkuq.js";import"./echjzuil72lr2oll.js";import"./nlwtx7zdm2am1wmc.js";import"./bk8slwxjkdlmxjxm.js";import"./m6mpdolaukauf1xm.js";import"./dwy8f7y5ary0iziz.js";import"./ic7rccsdo5x6ovoh.js";import"./c1w85nn5shpnb9e0.js";import"./f2cwocui2o4rh90z.js";import"./ggve90in2x9hqouv.js";import"./nlj97v8clhezwsxr.js";import"./bzo48ft2wb6beuij.js";import"./fb2gj4fu6zbut62o.js";import"./otrhg4fwlde4g25l.js";import"./epqkr08njby1t19h.js";import"./7u88g4wa9fostszz.js";import"./codkr9xsn28rihk7.js";import"./h71lg9jejkufcc57.js";import"./l9t7qwwrq1pkwdh1.js";import"./ec6jcwftshefgs7y.js";import"./oe3vdo8nwau2d3cp.js";import"./abn9sjdb7psxnmu1.js";const W="oai/apps/canmoreSidebarWidth",Et=.25,_t=400,L=400;function P(t){return t-_t}function b(t,a){return B(L,P(t),a??Et*t)}function At(){const t=S.useState(S.selectWindowWidth),a=b(t,Q(D.DANGER_SECRET_FOLDERS_ONLY_getItem(W))),s=H(),[e,i]=l.useState(a);l.useEffect(()=>{(e<L||e>P(t))&&i(b(t,e))},[t]);function o(c){i(v=>b(t,v+=c.delta.x))}function n(c){i(c),D.DANGER_SECRET_FOLDERS_ONLY_setItem(W,c)}function u(){const c=b(t,void 0);n(c)}const h=`calc(100vw - ${e}px)`;return s?{chatWidth:e,canvasWidth:t-e,canvasWidthCalc:h,viewportWidth:t,handleDrag:o,handleDoubleClick:u,persist:n}:{chatWidth:0,canvasWidth:t,canvasWidthCalc:"100vw",viewportWidth:t,handleDrag:()=>{},handleDoubleClick:()=>{},persist:()=>{}}}function H(t){const a=S.useState(S.selectWindowWidth);return(t??a)>1e3}const _="sharedCanvas";function Rt(){const[t,a]=K(),s=t.get(_),e=Y();l.useEffect(()=>{const i=s&&$.createRemixTempTextdoc(s,e);if(!i)return;requestAnimationFrame(()=>{j(i)});const o=new URLSearchParams(t);o.delete(_),a(o);const n=new URL(window.location.href);n.searchParams.delete(_),history.replaceState(null,"",n)},[s,t,a,e])}const Nt="textdocId",Mt=t=>{const s=new URLSearchParams(window.location.search).get(Nt),e=z(t,i=>T.findNode(i,({message:o})=>{const n=o.metadata?.canvas;return n?.create_source===J.HIVE&&(s?n?.textdoc_id===s:!0)})?.message.metadata?.canvas?.textdoc_id);l.useEffect(()=>{e&&requestAnimationFrame(()=>{j(e)})},[e])};function kt(t,a){let s;return a?.type===p.Textdoc?a.textdocId.startsWith(Z)||(s={type:"canvas_textdoc",id:a.textdocId}):a?.type===p.Kanzi&&(s={type:"canvas_kanzi",id:a.kanziId}),tt(t,{promptMessage:{metadata:{open_in_canvas_view:s}}})}const U=({isFullScreen:t=!1,clientThreadId:a,focusedObject:s,onClose:e,isAnimating:i=!1,width:o})=>{const{setTargetedContent:n}=et(),u=l.useRef(!1);if(l.useEffect(()=>(u.current&&n(void 0),u.current=!0,()=>{u.current=!1}),[s]),s==null)return null;switch(s.type){case p.Textdoc:return r.jsx(yt,{isFullScreen:t,onClose:e,clientThreadId:a,focusedTextdoc:s,isAnimating:i,width:o});case p.Kanzi:break;case p.ADAVisualization:return null}},Dt=300,Ft=t=>{switch(t?.type){case p.Textdoc:return t.textdocId;default:return null}};function Wt(t,a){const[s,e,i,o]=z(t,d=>[T.getRequestId(d),T.getConversationLastTurn(d),T.isMessageTurnEnded(d),T.getVariantIds(d).length>1]),n=gt(s),u=at(),[h,c]=l.useMemo(()=>{if(e&&o)return[void 0,null];if(a===!0)return[void 0,null];let d;return!i&&e&&(d=xt(e.messageGroups,f=>f.type!==vt)),jt({groupedMessage:d,isRequestActive:n,latestTextdocId:u})},[i,e,o,a,n,u]),v=c!=null,C=Ft(c),w=st("canvas");l.useEffect(()=>{if(c&&h&&!ot()&&(w(),nt(c,h),c.type===p.Textdoc)){const{textdocId:d}=c,f=St(d);it(document.getElementById(f))}},[v,C])}function jt({groupedMessage:t,isRequestActive:a,latestTextdocId:s}){switch(t?.type){case F.Canmore:{const[e,i]=t.messages;if(!rt(e))break;const o=ct(a,e,i??null),n=o.textdocId??s;if(n&&(o.function===dt.CreateTextdoc?(o.content??"").length>Dt||o.status===R.WAITING:o.status===R.STREAMING))return[o.messageId,{type:p.Textdoc,textdocId:n}];break}case F.kanzi:{const[,e]=t.messages,i=e?.metadata?.kanzi,o=e?.metadata?.async_task_id,n=i?.turn_id;if(o&&n)return[e.id,{type:p.Kanzi,kanziId:o,kanziTurnId:n,isKickoff:!0,defaultDebug:!0}];break}}return[void 0,null]}const y={type:"spring",bounce:.12,duration:.64},Ot={type:"spring",bounce:0,duration:.58},zt=({clientThreadId:t,focusedObject:a,onClose:s})=>{const{chatWidth:e,canvasWidthCalc:i,handleDrag:o,handleDoubleClick:n,persist:u}=At(),[h,c]=l.useState(!0),[v,C]=l.useState(!1),w=mt(({rect:m})=>m),{windowHeight:d,windowWidth:f}=Tt(m=>m,{windowWidth:0,windowHeight:0});let g=w??{top:0,left:e,width:f-e,height:d},A=!1;if(w&&(g.top<0||g.top+g.height>d)){A=!0;const m={width:(f-e)*.75,height:d*.75};g={top:d/2-m.height/2,left:(f-e-m.width)/2+e,width:m.width,height:m.height}}const I=w?.borderRadius,E=pt(),V=E?.history!=null||E?.showChangesAtVersion!=null,G=ht();return r.jsxs(r.Fragment,{children:[V&&r.jsx(bt,{onClick:()=>ft(E.textdocId),zIndexKey:"chatOverlay"}),r.jsxs(x.div,{initial:{marginRight:G?-260:0},animate:{marginRight:0},transition:Ot,children:[r.jsx(x.div,{initial:{opacity:1},animate:{opacity:0},exit:{opacity:[1,0]},transition:{...y,delay:.22},className:"bg-token-main-surface-primary pointer-events-none absolute start-0 top-0 z-20 h-full w-full"}),r.jsx(x.div,{className:"relative z-20 h-full",style:{width:i},exit:{width:0},transition:{type:"spring",bounce:0,duration:.1}})]}),r.jsx(x.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"pointer-events-none absolute start-0 top-0 z-10 h-full w-full bg-black/[0.025] dark:bg-transparent"}),r.jsx(x.div,{className:"absolute start-0 z-20 h-full overflow-hidden transition-shadow",initial:{borderRadius:I,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)",opacity:A?0:1,x:g.left,y:g.top,height:g.height,width:g.width},animate:{opacity:1,x:e,y:0,width:i,height:d,borderRadius:0,boxShadow:"0px 0px 18px rgba(0,0,0,0.075)"},exit:{scale:.64,opacity:0,filter:"blur(12px)",transition:{opacity:{duration:.14,bounce:.1}},borderRadius:I,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)"},transition:v?{duration:0}:y,onAnimationComplete:()=>c(!1),children:r.jsx(x.div,{className:"dark:border-token-border-medium h-full overflow-hidden border-s border-gray-100",initial:{borderRadius:I},animate:{borderRadius:0},exit:{borderRadius:I},transition:y,children:r.jsxs("div",{className:"h-full",children:[r.jsx(x.div,{drag:"x",className:"bg-token-text-quaternary absolute start-[-2px] z-10 h-full w-[4px] cursor-ew-resize opacity-0",whileHover:{opacity:.5},whileDrag:{opacity:.75,width:"8px",left:"-4px"},transition:{type:"tween",duration:.1},style:{x:0,y:0,transform:"translateX(0px)"},dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:{left:0,right:0,top:0,bottom:0},onPointerDown:()=>C(!0),onPointerUp:()=>C(!1),onDrag:(m,q)=>o(q),onDragEnd:()=>{C(!1),u(e)},onDoubleClick:()=>n()}),v&&r.jsx("div",{className:"absolute inset-0 z-10"}),r.jsx(U,{onClose:s,clientThreadId:t,isAnimating:h,focusedObject:a,width:f-e})]})})})]})},Lt=l.memo(zt),Pt=({clientThreadId:t,focusedObject:a,onClose:s})=>r.jsx(wt,{children:r.jsx(x.div,{className:"fixed inset-0 z-40 overflow-hidden shadow-xl md:border-gray-100 md:dark:border-gray-700",initial:{scale:.98},animate:{scale:1},transition:y,children:r.jsx(U,{isFullScreen:!0,clientThreadId:t,focusedObject:a,onClose:s})})}),Ht=({clientThreadId:t,overrideWidth:a,isAutoFocusDisabled:s=!1})=>{const e=H(a),i=It();Wt(t,s||i),Rt(),Mt(t);const o=ut();l.useEffect(()=>{O()},[t]);const n=o&&(e?r.jsx(Lt,{clientThreadId:t,onClose:k,focusedObject:o},"canvas-sidebar"):r.jsx(Pt,{clientThreadId:t,onClose:k,focusedObject:o},"canvas-modal"));l.useEffect(()=>{if(o)return N(h=>kt(h,o)),()=>N(null)},[o]);const u=n!=null;return l.useEffect(()=>(M.setActiveStageSidebar(u),()=>{u&&M.setActiveStageSidebar(!1)}),[u]),r.jsx(X,{children:n},t)},We=t=>{const a=l.useRef(null);return r.jsx(Ct,{ref:a,onError:(s,e)=>{O(),setTimeout(()=>{a.current?.resetErrorBoundary()}),lt.logError("Error boundary hit",s,{componentStack:e})},name:"canmore-focused-view",children:r.jsx(Ht,{...t})})};export{We as CanvasFocusedViewManager};
//# sourceMappingURL=dahwydx1j9atzim8.js.map
