import{r as d,j as r,M as m,u as x,h as H,d as Q,f as L,a as $,c as oe,b as ae}from"./cs2gapsc2bulabhw.js";import{f as S,aV as V,e as re,gz as I,gA as y,b as f,ag as ce,ga as ie,gB as ue,gC as W,gD as X,ai as O,j as k,gE as le,dz as de,gF as fe}from"./eb6xg52mym6rhnsh.js";import{ew as z,ck as he,fy as me,aa as Ce,fz as ge,fA as B,fB as pe,fC as _e,fD as ye,l as xe,cC as Ee,fE as we,fF as Ne,fG as Le,fH as Ie}from"./pduvb49qgyq1mqhk.js";import{b as Oe}from"./kmvt5g0oz7ekj3ft.js";const ke=({date:e})=>{const[n,t]=d.useState(Date.now());d.useEffect(()=>{const o=setInterval(()=>{t(Date.now())},6e4);return()=>clearInterval(o)},[]);const s=()=>{const o=new Date(e).getTime(),a=Math.floor((n-o)/1e3);return a<60?r.jsx(m,{id:"3Is9g3",defaultMessage:"Last updated a few seconds ago"}):a<3600?r.jsx(m,{id:"hXLIc6",defaultMessage:"Last updated a few minutes ago"}):r.jsx(m,{id:"ZV7Qx7",defaultMessage:"Last updated a few hours ago"})};return r.jsx("span",{children:s()})},Y=()=>x({queryKey:["user_connection_status"],queryFn:xe.user_connection_status});function Ue(){const e=S(),n=V(e,"2509278897"),{data:t,isLoading:s,refetch:o,dataUpdatedAt:a}=Y(),c=d.useMemo(()=>n?t?.connection_statuses.filter(i=>i.user_connection_details.connection_type!=="gdrive_sync_connector"):t?.connection_statuses,[t,n]);return d.useEffect(()=>{re.logEventWithStatsig("Contextual Answers User Settings Modal Shown","chatgpt_contextual_answers_user_settings_modal_shown")},[]),n&&!c?.length?null:r.jsxs("div",{className:"mb-8",children:[r.jsxs(z,{children:[r.jsxs("div",{className:"text-md text-token-text-primary mb-1 flex items-center gap-2 font-medium",children:[r.jsx(he,{class:"icon-md"}),r.jsx("div",{children:r.jsx(m,{id:"YxAwHl",defaultMessage:"Internal knowledge"})}),r.jsx(me,{})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-token-text-secondary",children:r.jsx(m,{id:"b5cZ0X",defaultMessage:"Connect these data sources so ChatGPT can surface relevant, personalized information — based on what you’re authorized to view. {learnMore}",values:{learnMore:r.jsx(Ce,{href:B,className:"underline",onClick:()=>ge({link:B,location:"user_settings"}),children:r.jsx(m,{id:"N1i4rw",defaultMessage:"Learn more"})})}})}),r.jsx("p",{className:"text-token-text-secondary font-medium",children:r.jsx(ke,{date:new Date(a)})})]})]}),r.jsx("div",{className:"border-b",children:s?r.jsx("div",{className:"p-2",children:r.jsx(Oe,{lines:4})}):c?.length?r.jsx("div",{children:c.map(i=>r.jsx(z,{children:r.jsx("div",{className:"pt-3 pb-1",children:r.jsx(pe,{icon:r.jsx("img",{src:i.connection_display_info.icon_url??"",alt:i.connection_display_info.display_name,className:"icon-lg"}),title:i.connection_display_info.display_name,statusIndicator:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(_e,{connection:i,location:"user_settings"}),r.jsx(ye,{connection:i,refetch:o})]})})})},i.user_connection_details.connection_instance_id))}):r.jsx("p",{className:"text-token-text-secondary my-2",children:r.jsx(m,{id:"nzXh59",defaultMessage:"No connections found."})})})]})}const Ge=I[y.GDRIVE_ACTION_CONNECTOR],K="#settings/ConnectorSettings",ze=[y.GDRIVE_ACTION_CONNECTOR,y.GCAL_CONNECTOR,y.GMAIL_CONNECTOR].map(e=>I[e]),M="add-connector-link",Be=()=>{const e=Q();return n=>{const t=window.location.hash,[s,o]=t.split("?"),a=new URLSearchParams(o);n?a.set(M,"true"):a.delete(M);const c=a.toString()?`${s}?${a.toString()}`:s;e(c,{replace:!0})}},Ke=()=>{const{hash:e}=H(),n=e.indexOf("?");return n===-1?!1:new URLSearchParams(e.substring(n+1)).get(M)==="true"},He=()=>{const e=Q();return n=>{const t=window.location.hash,[s,o]=t.split("?"),a=new URLSearchParams(o);n?a.set("connector",n):a.delete("connector");const c=a.toString()?`${s}?${a.toString()}`:s;e(c,{replace:!0})}},Qe=()=>{const{hash:e}=H(),n=e.indexOf("?");if(n===-1)return null;const t=e.substring(n+1);return new URLSearchParams(t).get("connector")},Ae=e=>e.supported_auth.some(n=>n.type==="OAUTH")?"OAUTH":"NONE",be=e=>f.safePost("/aip/connectors/links/noauth",{requestBody:{connector_id:e.id,name:e.name,action_names:e.actions.map(n=>n.name)}}),Re=async(e,n,t=!1)=>{const s=ie[e.id],o={connectorId:e.id,name:e.name,actionNames:e.actions.map(a=>a.name),oauthClientId:ue(s,n),oauthClientScopes:null};await W(X,o,t?`${K}?connector=${e.id}`:K)},Me=async(e,n,t=!1)=>{switch(Ae(e)){case"OAUTH":return await Re(e,n,t),null;case"NONE":return await be(e)}},$e=(e,n)=>f.safePost("/accounts/{account_id}/connectors/{connector_id}/publish",{parameters:{path:{account_id:n,connector_id:e}}}),Ve=()=>{const e=Ee(),n=Y(),t=d.useMemo(()=>n.data?.connection_statuses.filter(i=>["google_drive_oauth","google_drive_dwd"].includes(i.user_connection_details.knowledge_connector_type)),[n.data]),s=e&&!!t?.length,o=we(),a=o.connectorConfig.get(ce.GDRIVE),c=o.isGdriveEnabled&&!!a;return{isLoading:n.isLoading||o.isLoading,fileUploadConfig:c?a:null,internalKnowledgeConfigs:s?t:null}};async function We(e){return(await f.safeGet("/aip/connectors/mcp/oauth_config",{parameters:{query:{mcp_url:e}}})).oauth_config}function Xe(e){return f.safePost("/aip/connectors/mcp/refresh_actions",{requestBody:{link_id:e}})}function Z(e){return f.safeGet("/aip/connectors/{connector_id}/conformance",{parameters:{path:{connector_id:e}}})}function Se(e){return f.safeDelete("/aip/connectors/{connector_id}",{parameters:{path:{connector_id:e}}})}function A(){const e=S(),n=V(e,"3544641259"),t=!!de(e,"463092697")?.value?.enabled,s=Le();return n||t||s}function je(e){const{isLoading:n,error:t,refetch:s,platformConnectors:o}=j(),a=o.get(e);return{enabled:!!a&&a.status!=="DISABLED_BY_ADMIN",isLoading:n,error:t,refetch:s}}function Ye(){return je(I[y.GITHUB_CONNECTOR])}const J=(e,n=!1)=>["fetchConnectorLinkData",e,n],ee=e=>["fetchPlatformConnectorData",e],ne=async e=>(await f.safePost("/aip/connectors/list_accessible",{requestBody:{principals:[{type:"USER",id:e}]}})).connectors,te=async(e,n=!1)=>{const t=await f.safePost("/aip/connectors/links/list_accessible",{requestBody:{principals:[{type:"USER",id:e}],link_refresh_strategy:n?"BLOCKING":"NONE"}});return Ie(t.links,({connector_id:s})=>s)};function j(e=!0){const n=A(),t=O(),{data:s,isLoading:o,isFetching:a,error:c,refetch:i}=x({queryKey:ee(t?.normalizedAccountUserId),queryFn:async()=>!t||!t.normalizedAccountUserId?[]:await ne(t.normalizedAccountUserId),enabled:!!t&&e&&n});return{platformConnectors:d.useMemo(()=>new Map(s?.map(u=>[u.id,u])),[s]),isLoading:o,isFetching:a,error:c,refetch:i}}function Ze({skip:e=!1}={}){const n=A(),t=O(),s=$();d.useEffect(()=>{if(e||!t?.normalizedAccountUserId||!n)return;const o=t.normalizedAccountUserId;s.prefetchQuery({queryKey:ee(o),queryFn:()=>ne(o)}).catch(()=>{}),s.prefetchQuery({queryKey:J(o,!1),queryFn:()=>te(o,!1)}).catch(()=>{})},[e,t?.normalizedAccountUserId,s,n])}function v({skip:e=!1,fetchValidLinksOnly:n=!1}={}){const t=L(),s=O(),o=k(),a=A(),{data:c,isLoading:i,isFetching:l,error:u,refetch:C}=x({queryKey:J(s?.normalizedAccountUserId,n),enabled:!e&&!!s&&a,queryFn:async()=>{if(!s||!s.normalizedAccountUserId)return{};try{return await te(s.normalizedAccountUserId,n)}catch(p){throw o.danger(t.formatMessage({id:"EgrzHa",defaultMessage:"Error fetching connectors connections"}),{id:"fetch-connector-links-error",duration:3,hasCloseButton:!0}),p}}});return{connectorLinks:d.useMemo(()=>c?new Map(Object.entries(c)):new Map,[c]),isLoading:i,isFetching:l,error:u,refetch:C}}function ve(e,n){const t=A(),s=L(),o=k(),{data:a,isLoading:c,error:i,refetch:l}=x({queryKey:["connector-client-data",e],queryFn:async()=>{const u=await f.safeGet("/aip/connectors/oauth_clients",{parameters:{query:{service:n}}});return u.oauth_clients?u.oauth_clients:(o.danger(s.formatMessage({id:"OfpT7B",defaultMessage:"Request error fetching oauth clients"}),{id:"fetch-oauth-clients-error",duration:3,hasCloseButton:!0}),[])},enabled:t});return{oAuthClients:a,isLoading:c,error:i,refetch:l}}function Je(e,n,t="/",s,o){const a=Ne(),{platformConnectors:c,isLoading:i,error:l,refetch:u}=j(),{connectorLinks:C,isLoading:E,error:p,refetch:h}=v(),{oAuthClients:g,isLoading:T,error:se,refetch:q}=ve(e,n),D=Te(),w=d.useCallback(()=>{u(),h(),q()},[u,h,q]),_=I[e],b=c.get(_),P=C.has(_),R=C.get(_)?.[0]?.id,F=d.useCallback(()=>{R&&D(R,()=>{w()})},[D,w,R]),U=l??p??se,N=i||E||T,G=d.useCallback(()=>{if(!N){if(!b){s?.();return}if(!g?.length){o?.();return}W(X,{oauthClientId:g[0].id,oauthClientScopes:g[0].scopes,name:b.name,actionNames:le[e],connectorId:_},t,a)}},[N,b,g,e,_,t,a,s,o]);return d.useMemo(()=>({isLoading:N,isConnected:P,connect:G,error:U,refetch:w,handleDisconnect:F}),[N,P,G,U,w,F])}function en(){"use forget";const e=oe.c(12),n=L(),t=k(),s=S(),{refetch:o}=j(),{refetch:a}=v();let c;e[0]!==s?(c=async C=>{const{supported_auth:E,...p}=C,{connector:h}=await f.safePost("/aip/connectors/mcp",{requestBody:{...p,auth_request:{supported_auth:E,oauth_client_params:null}}});if(h.supported_auth.length===0&&!(await Z(h.id)).implements_retrievable)return await Se(h.id),{connector:null,link:null,implementsRetrievable:!1};const g=await Me(h,s,!0);return{connector:h,link:g,implementsRetrievable:!0}},e[0]=s,e[1]=c):c=e[1];let i;e[2]!==n||e[3]!==t?(i=()=>{t.danger(n.formatMessage({id:"9J7rOY",defaultMessage:"Error creating connector"}))},e[2]=n,e[3]=t,e[4]=i):i=e[4];let l;e[5]!==o||e[6]!==a?(l=()=>{o(),a()},e[5]=o,e[6]=a,e[7]=l):l=e[7];let u;return e[8]!==c||e[9]!==i||e[10]!==l?(u={mutationFn:c,onError:i,onSettled:l},e[8]=c,e[9]=i,e[10]=l,e[11]=u):u=e[11],ae(u)}function Te(){const e=L(),n=k(),t=O(),s=v(),o=$();return async(c,i)=>{try{await fe(c),o.invalidateQueries({queryKey:["fetchConnectorLinkData",t?.normalizedAccountUserId]}),await s.refetch(),i?.()}catch{n.danger(e.formatMessage({id:"Gmong7",defaultMessage:"Error disconnecting connector"}))}}}function nn(e,n=!0){return x({queryKey:["checkConnectorConformance",e],queryFn:async()=>(await Z(e)).implements_retrievable,enabled:n})}export{Ue as C,Ge as G,Je as a,Ye as b,j as c,v as d,Ze as e,He as f,ee as g,Te as h,Ve as i,Y as j,Se as k,Ae as l,be as m,nn as n,Qe as o,$e as p,ze as q,Xe as r,Re as s,en as t,je as u,We as v,Ke as w,Be as x};
//# sourceMappingURL=fb2gj4fu6zbut62o.js.map
