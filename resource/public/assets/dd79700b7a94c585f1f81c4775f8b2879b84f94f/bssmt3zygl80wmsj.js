import{r as w,j as n}from"./cs2gapsc2bulabhw.js";import{C as G}from"./hvq69vo4kfwx2bys.js";import{D as F}from"./xbmjt85q81k7ilbj.js";import{T as q,a as J,A as k,u as K,i as Q,C as X,g as Y}from"./kpy1xfmbqeg76ogq.js";import{C as Z,c as $}from"./fi1xw3fnwortmtrb.js";import{C as V}from"./o9jbx8esqeax3dhl.js";import{f as z,g as tt,h as et,i as P}from"./pbk0s8tey8blca1e.js";import{C as ot}from"./jy1u8exw8iz2slve.js";import{g as rt,j2 as nt,j3 as M,j4 as st}from"./pduvb49qgyq1mqhk.js";import{q as it}from"./eb6xg52mym6rhnsh.js";import{C as lt}from"./ekzdsqfpi8dxrf9q.js";import"./dv3d7908pzpkjndg.js";import"./oj5g7kg81kf2ot3b.js";import"./j3y9idfzwnd1pc4w.js";import"./e95x0gs5di7mq1tw.js";import"./f76gy0b8ieo4s693.js";import"./g3fgrnxyclmhl90i.js";import"./ocr8ihe7mqprglo4.js";import"./nkcra1lf12hy5eza.js";import"./kpz7qev108jf94tz.js";import"./hpoi02g0dgpne8ux.js";import"./kmvt5g0oz7ekj3ft.js";import"./n3cijkf5teq8hl4t.js";function ct(t,e){const l=t.doc.lineAt(e.from);return e.from===l.from&&e.to-1===l.to}function at(t){const e=t.dom.querySelector(".cm-gutters");return e?e.offsetWidth:0}const mt=({onAddComment:t,isSendDisabled:e=!1,isWaitingForCommentResponse:l=!1})=>{const o=z(),u=tt(),c=et(),L=w.useCallback(s=>{const{height:a,width:m}=s,r=o();if(!u||!r)return null;const d=u.selection.asSingle();if(d.ranges.length===0)return null;const i=d.ranges[0],{empty:D,to:O}=i;let{head:p}=i;const{platform:H}=rt();p=H==="web"?p:O;const g=p===O;let h=p;if(g&&ct(u,i)&&(h-=1),D)return null;const{left:v,top:j,bottom:R}=r.contentDOM.getBoundingClientRect(),{left:x,top:I,bottom:C}=it(r.coordsAtPos(h,g?-1:1)),E=at(r);function N(){if(g)return Math.max(x-v+E-m,E);let f=x-v+E;return f+m>c&&(f=-(m-c)),f}function A(f){const b=a*2,_=f.contentHeight-(C-R)>b&&window.innerHeight-C>b,y=C-j+8,W=I-j-a-8;return g&&_||W<0?{top:y,aboveOrBelow:k.BELOW}:{top:W,aboveOrBelow:k.ABOVE}}const T=A(r);return{left:N(),top:T.top,aboveOrBelow:T.aboveOrBelow,toolbarSize:s}},[u,o,c]),B=w.useCallback(()=>o()?.dom??null,[o]);return n.jsx(q,{onAddComment:t,isWaitingForCommentResponse:l,isSendDisabled:e,toolbarType:J.CODE,getToolbarPosition:L,getEditorDom:B,getSelectionRange:()=>{const s=o();if(!s)return null;const{state:a}=s,m=a.selection.asSingle();if(m.ranges.length===0)return null;const r=m.ranges[0],{from:d,to:i}=r;return d==null||i==null?null:{from:d,to:i,sourceFrom:d,sourceTo:i}}})};function dt({diff:t}){return K(t?.edits??[]),null}function ut(t,e,l){const o=l?Y():0;return t<=1e3-o?t-(e?Z:0):t-(e?$:0)}const _t=({comments:t,currentlyStreamingLineIndex:e,isPreview:l=!1,isWaitingForCommentResponse:o=!1,isSendDisabled:u=!1,readonlyReason:c,isRequestActive:L=!1,language:B,value:s,textdocDiff:a,onAcceleratorsExpandedChange:m,onAddComment:r,onAcceptComment:d,onDismissComment:i,onBlur:D,onSave:O,onChange:p,onCancelRequest:H,getStableCommentId:g=st,commentsMode:h=V.ENABLED,hideToolbar:v,hideAccelerators:j=!1,onSubmitAccelerator:R,modelCursor:x,codemirrorRef:I})=>{const C=w.useRef(null),[{width:E},N]=nt(),A=w.useRef(null),T=t.length>0,f=A.current,b=ut(E,T,Q(f)??!1),_=P(({commentingOn:S})=>S),y=P(({hoveredCommentId:S})=>S),W=P(({focusedCommentId:S})=>S);w.useEffect(()=>{C.current?.UNSAFE_setValue(s||"")},[s]);const U=E-b;return n.jsx("div",{className:ot.code,ref:M(N,A),children:n.jsxs(G,{id:"codemirror",comments:h===V.ALL_HIDDEN?void 0:t,commentingOn:_,currentlyStreamingLineIndex:e,hoveredCommentId:y,focusedCommentId:W,language:B,readonlyReason:c,onChange:p,value:s,textdocDiff:a,editorRef:M(C,I),width:b,modelCursor:x,isPreview:l,onBlur:D,onSave:O,children:[n.jsxs(G.EditorChildren,{children:[!v&&n.jsx(mt,{onAddComment:r,isSendDisabled:u,isWaitingForCommentResponse:o}),h!==V.ALL_HIDDEN&&n.jsx("div",{className:T?"me-4":"",children:n.jsx(X,{getStableCommentId:g,availableWidth:U,comments:t,commentsMode:h,onAddComment:r,onAcceptComment:d,onDismissComment:i,isWaitingForCommentResponse:o,isRequestActive:L,disableBlockComments:!0})})]}),n.jsxs(G.ContextChildren,{children:[a&&n.jsx(dt,{diff:a}),!j&&n.jsx(F,{isRequestActive:L,isVisuallyHidden:u||!!c?.isStreamingFromNative||c?.isReadonly&&!c.isStreaming,onSubmit:R,onCancel:H,actions:lt,onExpandedChange:m})]})]})})};export{_t as CodeComposer};
//# sourceMappingURL=bssmt3zygl80wmsj.js.map
