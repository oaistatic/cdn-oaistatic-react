import{fd as R,j as b,dd as l,de as f,b as g}from"./eb6xg52mym6rhnsh.js";import{a as C}from"./itdwpc2q0aiung3v.js";import{D as E,d as O,r}from"./cs2gapsc2bulabhw.js";async function U(p,t,e,s){const c=await g.safeGet("/connectors/{id}/oauth/callback",{parameters:{path:{id:p},query:{code:t,redirect_uri:e,state:s}}});return{...c,redirect_path:C(c.redirect_path).toString()}}const $=R(function(){const{pluginId:t}=E(),e=O(),s=r.useRef(!1),[c,m]=r.useState(""),{code:o,error:u,error_description:h,state:n}=Object.fromEntries(new URLSearchParams(c.substring(1)).entries());r.useEffect(()=>{m(window.location.hash)},[]),r.useEffect(()=>{if(s.current)return;if(t&&o&&n)s.current=!0;else{e("/");return}async function S(){const _=`https://chatgpt.com/ccc/${t}/oauth/callback`;if(!(!t||!o||!n))try{const a=await U(t,o,_,n);if(a.success){const i=new URL(l(f.OAUTH_SUCCESS,a.redirect_path),location.origin);i.searchParams.set("oauth_success","true"),e(i.pathname+i.search+i.hash)}else e(l(f.CUSTOM_ERROR,a.redirect_path,a.error??a.message))}catch{e(l(f.CUSTOM_ERROR))}}S()},[t,o,n,e]);const d=b();return r.useEffect(()=>{u&&d.danger(`${u}${h?`: ${h}`:""}`)},[u,h,d]),null});export{$ as default};
//# sourceMappingURL=crgv3u8i1bnxzcot.js.map
