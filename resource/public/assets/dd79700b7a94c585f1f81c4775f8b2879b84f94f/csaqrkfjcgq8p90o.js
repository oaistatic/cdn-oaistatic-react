import{f as I,B as S,aV as M,b0 as W,c as P,L as B,fd as z}from"./eb6xg52mym6rhnsh.js";import{f as N,r as m,j as e,M as d,d as V,a9 as D}from"./cs2gapsc2bulabhw.js";import{b3 as O,bA as A,I as Y,f as H,cL as _,ac as q,L as G,h as U,d1 as Z}from"./pduvb49qgyq1mqhk.js";import{g as k}from"./kvmheozf1dv1rz41.js";import{h as J,A as K}from"./jfxh69p8ryncyku8.js";import{F as Q}from"./lxj9p4c7fussomnd.js";import{R as X}from"./co1ila1zqn6dc99l.js";import{C as L}from"./lwopo5qrysdv33im.js";import{u as $}from"./m371nglm43iephjz.js";import{h as ee,j as te,k as R,c as C}from"./flul5lgejanvmzis.js";import{u as ne}from"./mhlnvw0pfrh2uh0n.js";import{I as se}from"./m4uwihyvndo7xd88.js";import{T as ae}from"./m51yqcd3jsaldp76.js";import{W as oe}from"./gn8hoowjr3gjt16v.js";import"./fb2gj4fu6zbut62o.js";import"./kmvt5g0oz7ekj3ft.js";import"./ic7rccsdo5x6ovoh.js";import"./c1w85nn5shpnb9e0.js";import"./f2cwocui2o4rh90z.js";import"./do5nmvaddt7ak8xi.js";import"./e95x0gs5di7mq1tw.js";import"./ggve90in2x9hqouv.js";import"./nlj97v8clhezwsxr.js";import"./bzo48ft2wb6beuij.js";import"./otrhg4fwlde4g25l.js";import"./epqkr08njby1t19h.js";import"./7u88g4wa9fostszz.js";import"./codkr9xsn28rihk7.js";import"./h71lg9jejkufcc57.js";import"./l9t7qwwrq1pkwdh1.js";import"./ec6jcwftshefgs7y.js";import"./ke1leuxpoxd60g1m.js";import"./dugtojg1blcdqewy.js";import"./lzqtvz4ppmzufktl.js";function ie({handleGoBack:n,handleSelectEnvironment:a,goToNextPage:o,lockPageView:r}){const i=N();return m.useEffect(()=>{O.recordEnvironmentsView()},[]),e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsx(L,{title:i.formatMessage({id:"wham.codexOnboardingEnvironments.createYourFirstEnvironment",defaultMessage:"Create your starting environment"}),description:i.formatMessage({id:"wham.codexOnboardingEnvironments.createYourFirstEnvironment.description",defaultMessage:"Pick a repo to set up the basics. You can customize your environment later."})}),e.jsx(F,{handleGoBack:n,handleSelectEnvironment:a,goToNextPage:o,lockPageView:r})]})}function F({handleGoBack:n,handleSelectEnvironment:a,goToNextPage:o,lockPageView:r,shouldDisableRow:i,disablePill:x}){const u=N(),f=I(),[l,v]=m.useState(""),[b,j]=m.useState(null),{mutate:y,isPending:c}=$({onSuccess:t=>{O.recordCreateEnvSuccess(),a(t.id,k(t)),o()}}),{data:g,isLoading:h}=ee(),p=ne({defaultValues:{repositoryId:""},validators:{onSubmit:({value:t})=>{const E={};return(!t.repositoryId||t.repositoryId==="")&&(E.repositoryId=u.formatMessage({id:"wham.codexOnboardingEnvironments.repositoryIsRequired",defaultMessage:"Repository is required"})),{fields:E}}},onSubmit:({value:t})=>{O.recordEnvironmentsSubmit(),r(),y({...t,label:l,description:"",machine:"wham-public/wham-universal",workspaceDirectory:"/workspace",share_settings:"workspace",setupCommands:"",envVars:[],secrets:[]})}}),s=t=>{t.preventDefault(),t.stopPropagation(),p.handleSubmit()};return m.useEffect(()=>{h||g?.installations.length===0&&J()},[h,g,f]),e.jsx("form",{onSubmit:s,className:"flex flex-col gap-6",children:e.jsxs("div",{className:"flex w-full flex-col gap-4",children:[e.jsx(K,{selectedInstallationId:b,setSelectedInstallationId:j}),e.jsx(p.Field,{name:"repositoryId",children:t=>e.jsxs("div",{className:"flex w-full flex-col gap-4",children:[e.jsx(X,{installationId:b,selectedRepository:t.state.value,onSelect:(E,T)=>{t.handleChange(E),v(T)},shouldDisableRow:i,disablePill:x}),e.jsx(Q,{field:t})]})}),e.jsx("div",{className:"pb-2",children:e.jsxs("div",{className:"bg-token-bg-tertiary text-token-text-secondary flex w-full items-center justify-between rounded-xl px-5 py-4 text-sm",children:[e.jsx("div",{className:"relative h-4 w-4 pe-8",children:e.jsx(A,{className:"icon-md"})}),e.jsx("div",{className:"w-full justify-start",children:e.jsx(d,{id:"wham.codexOnboardingEnvironments.createEnvironment.description",defaultMessage:"We’ll create a <b>basic environment</b> for your repo. To enable Codex to run linters and tests, install the required dependencies in environment settings.",values:{b:t=>e.jsx("span",{className:"font-semibold",children:t})}})})]})}),e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx(S,{color:"secondary",size:"medium",type:"button",onClick:n,children:e.jsx(d,{id:"wham.codexOnboardingEnvironments.back",defaultMessage:"Back"})}),e.jsx(S,{color:"primary",size:"medium",loading:c,disabled:!l,onClick:()=>p.handleSubmit(),children:e.jsx(d,{id:"wham.codexOnboardingEnvironments.createEnvironment",defaultMessage:"Create environment"})})]})]})})}function re({selectedTab:n,onChange:a}){const o=N(),r=I(),i=M(r,"2665240312"),x=m.useCallback(u=>{a(u)},[a]);return e.jsx("div",{className:"border-token-border-primary flex w-full items-center border-b align-middle",children:i&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(ae,{currentTab:n,onChange:x,withUnderline:!0,tabs:[{label:o.formatMessage({id:"wham.selectEnvironmentHeader.create",defaultMessage:"Existing environments"}),key:"select"},{label:o.formatMessage({id:"wham.selectEnvironmentHeader.select",defaultMessage:"New environment"}),key:"create"}]})})})}function le({environment:n,isSelected:a,className:o}){return e.jsxs("div",{className:P("flex items-center justify-between gap-2",o),children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-token-text-primary text-start text-sm font-medium",children:n.label}),n.creator.email&&e.jsx("p",{className:"text-token-text-tertiary text-start text-xs leading-tight font-normal",children:e.jsx(d,{id:"wham.createEnvironments.environmentSection.createdBy",defaultMessage:"{email}",values:{email:n.creator.name}})})]}),e.jsx("div",{className:"text-token-text-secondary text-start text-sm leading-tight font-normal",children:n.description})]}),a?e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(U,{className:"h-5 w-5"})}):e.jsx("div",{className:"w-4"})]})}function ce({environment:n,isSelected:a,onClick:o}){return e.jsx("button",{className:P("group flex w-full items-center justify-between gap-2 py-4","hover:bg-token-bg-tertiary cursor-pointer p-2"),onClick:o,type:"button",children:e.jsx(le,{environment:n,isSelected:a,className:"w-full"})})}function w(){return e.jsx("div",{className:"flex w-full items-center justify-between gap-2 rounded-md",children:e.jsx(G,{className:"h-14 w-full"})})}const de=10;function me({handleGoBack:n,handleSelectEnvironment:a,goToNextPage:o}){const r=N(),[i,x]=m.useState(""),u=I(),f=M(u,"2673860158"),{data:l,isLoading:v,fetchNextPage:b,hasNextPage:j,isFetchingNextPage:y}=R({pageSize:de,enforceRepoAccess:f}),c=m.useMemo(()=>l?.pages.flatMap(s=>s.items??[])??[],[l]),g=c.filter(s=>s.label.toLowerCase().includes(i.toLowerCase())),h=C(s=>s.environmentId),p=C(s=>s.setEnvironmentId);return m.useEffect(()=>{if(h){const s=c.find(t=>t.id===h);s?a(s.id,k(s)):p(null)}else c.length===1&&(p(c[0].id),a(c[0].id,k(c[0])))},[h,c,a,p]),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex justify-between",children:e.jsx(Y,{color:"search",iconPosition:"left",icon:H,className:"text-token-text-tertiary flex h-10 w-full items-center rounded-lg! p-3!",inputClassName:"text-token-text-primary w-full",containerInputClassName:"w-full",name:"search-envs",type:"text",value:i,onChange:s=>x(s.target.value),placeholder:r.formatMessage({id:"wham.environmentSection.searchPlaceholder",defaultMessage:"Search"}),ariaLabel:r.formatMessage({id:"wham.environmentSection.searchAria",defaultMessage:"Search"})})}),e.jsx("div",{className:"border-token-border-heavy flex flex-col gap-2 rounded-lg border p-2",children:e.jsx("div",{className:"flex h-96 flex-col overflow-y-auto",children:v?e.jsxs("div",{className:"flex h-full flex-col gap-2",children:[e.jsx(w,{}),e.jsx(w,{}),e.jsx(w,{}),e.jsx(w,{}),e.jsx(w,{}),e.jsx(w,{}),e.jsx(w,{})]}):e.jsxs(e.Fragment,{children:[g.length===0&&!j?e.jsxs("div",{className:"flex h-full flex-col items-center justify-center",children:[e.jsx("p",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(d,{id:"wham.codexOnboardingEnvironments.noEnvironments",defaultMessage:"No environments found"})}),e.jsx("p",{className:"text-token-text-secondary text-xs",children:e.jsx(d,{id:"wham.codexOnboardingEnvironments.noEnvironmentsDescription",defaultMessage:"You will be able to create more environments in settings later"})})]}):g.map((s,t)=>e.jsxs("div",{children:[e.jsx(ce,{environment:s,isSelected:h===s.id,onClick:()=>a(s.id,k(s))}),t!==g.length-1&&e.jsx("div",{className:"border-token-border-light border-t"})]},s.id)),e.jsx(se,{isFetchingNextPage:y,hasNextPage:j??!1,fetchNextPage:b,bgColor:"dark:bg-token-bg-secondary"})]})})}),e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx(S,{color:"secondary",size:"medium",type:"button",onClick:n,children:e.jsx(d,{id:"wham.codexOnboardingEnvironments.back",defaultMessage:"Back"})}),e.jsx(S,{color:"primary",size:"medium",disabled:!h,onClick:o,children:e.jsx(d,{id:"wham.codexOnboardingEnvironments.useEnvironment",defaultMessage:"Use environment"})})]})]})}function xe(){const n=N(),a=_(),i=W()?.name??n.formatMessage({id:"wham.codexOnboardingEnvironments.workspaceName",defaultMessage:"Workspace"});return e.jsx(q,{label:n.formatMessage({id:"wham.codexOnboardingEnvironments.environmentExistsTooltip",defaultMessage:"An environment has already been created for {workspaceName}. You’ll be able to create a new environment later for this repo in settings."},{workspaceName:i}),children:e.jsxs("div",{className:"bg-token-bg-tertiary text-token-text-tertiary inline-flex items-center justify-center gap-1 rounded-3xl py-1.5 ps-1.5 pe-1.5",children:[e.jsx(A,{className:"icon-sm"}),!a&&e.jsx("div",{className:"justify-start pe-1 text-xs leading-3 font-medium",children:e.jsx(d,{id:"wham.codexOnboardingEnvironments.environmentExists",defaultMessage:"Environment already exists"})})]})})}function ue({handleGoBack:n,handleSelectEnvironment:a,goToNextPage:o}){const r=N(),[i,x]=m.useState("select"),{data:u}=te(),f=l=>u?.some(v=>v.repos.includes(l.id))??!1;return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(L,{title:r.formatMessage({id:"wham.codexOnboardingEnvironments.selectEnvironment",defaultMessage:"Select an environment"}),description:r.formatMessage({id:"wham.codexOnboardingEnvironments.selectEnvironment.description",defaultMessage:"Environments configure the container for the agent to run. Not seeing your repo? You can create new environments in settings later."})}),e.jsx("div",{className:"pb-4",children:e.jsx(re,{selectedTab:i,onChange:l=>{x(l)}})}),i==="select"?e.jsx(me,{handleGoBack:n,handleSelectEnvironment:a,goToNextPage:o}):e.jsx(F,{lockPageView:()=>{},handleGoBack:n,handleSelectEnvironment:a,goToNextPage:o,shouldDisableRow:f,disablePill:e.jsx(xe,{})})]})}function fe(){return e.jsx("div",{className:"mx-auto flex h-full max-w-4xl flex-col p-8 md:p-24",children:e.jsxs("div",{className:"flex h-full w-full flex-col items-center justify-center gap-2",children:[e.jsx(d,{id:"wham.codexOnboardingEnvironments.loading",defaultMessage:"Almost there…"}),e.jsx(B,{})]})})}function ge(){const{eligible:n,isLoading:a}=Z(),o=I(),r=M(o,"2673860158"),i=M(o,"2395384117"),{data:x,isLoading:u}=R({pageSize:1,enforceRepoAccess:r}),f=V(),[l,v]=m.useState(!1),b=()=>{f("/codex/onboarding/connections")},j=()=>{f(i?"/codex/onboarding/starter-tasks":"/codex/onboarding/data-check")},y=C(t=>t.setEnvironmentId),c=C(t=>t.setBranch),g=(t,E)=>{y(t),c(E)},p=(x?.pages.flatMap(t=>t.items).length??0)>0;if(a||u)return e.jsx(fe,{});if(!n)return e.jsx(D,{to:"/codex"});const s=!l&&p&&!0;return e.jsx(oe,{showSidebar:!1,canShowAlert:!1,hideExtraHeaderInfo:!0,children:e.jsx("div",{className:"mx-auto flex max-w-3xl flex-col gap-2 p-12",children:s?e.jsx(ue,{handleGoBack:b,handleSelectEnvironment:g,goToNextPage:j}):e.jsx(ie,{handleGoBack:b,handleSelectEnvironment:g,goToNextPage:j,lockPageView:()=>v(!0)})})})}const Ke=()=>[{title:"Codex"}],Qe=z(function(){return e.jsx(ge,{})});export{Qe as default,Ke as meta};
//# sourceMappingURL=csaqrkfjcgq8p90o.js.map
