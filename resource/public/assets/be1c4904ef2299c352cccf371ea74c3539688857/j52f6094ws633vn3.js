const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/krw51z3nnez9ko8b.js","assets/fs6h2trisr1juto6.js","assets/df9u9imhvwerk6zv.js","assets/cyi7nanrg0vdotzd.js","assets/root-drzjahv8.css","assets/conversation-small-kx6wglz1.css","assets/hx2kxxv1rwdb7zis.js","assets/nwmjlrv24of4thpe.js","assets/kg9pnjn9ianmg7dc.js","assets/ky5638d0aqy7l511.js","assets/c0kkz5yw203koqyt.js","assets/exwx6mc6hw49alht.js","assets/f3zzw463zuggq6da.js","assets/069jlavvvdusqrfm.js","assets/crv164w6r8tn71zi.js","assets/b22a1k4ozfgjkxq7.js","assets/juans7zh9ytz81kz.js","assets/e2l59f6c7bsm78ye.js","assets/b7o9536h4wpvjcqi.js","assets/k154o6a9h89usuus.js","assets/nlkl42j3n1q6imdw.js","assets/jo3x2yf4dp19h25k.js"])))=>i.map(i=>d[i]);
import{r as m,f as at,e as W,j as e,M as N,a5 as U,d as ye,a7 as ge,L as Vr,as as va,k as ya,z as $r}from"./fs6h2trisr1juto6.js";import{m as qr,a as Kr}from"./f3zzw463zuggq6da.js";import{g7 as D,E as ce,G as ie,eD as mt,r1 as Z,ft as Yr,fs as ft,l as Cs,op as ws,cP as bn,R as Bt,q0 as Sn,r2 as Ca,bd as We,c4 as Jr,r3 as Qr,r4 as Xr,r5 as Zr,r6 as el,r7 as tl,r8 as sl,ob as cs,r9 as Vo,ra as nl,rb as ol,rc as al,kY as il,k$ as rl,g$ as ll,B as js,dV as cl,kX as ul,e as vn,rd as dl,bN as wa,mM as ml,re as pl,g6 as ke,rf as gl,nj as Pt,kO as hl,rg as I,rh as ja,ri as fl,rj as xl,rk as bl,rl as Sl,rm as vl,rn as yl,ro as Cl,rp as wl,rq as jl,rr as kl,rs as _l,rt as Ml,ru as Al,rv as Nl,rw as Pl,rx as El,bl as Tl,ry as Rl,mz as Il,hV as St,gc as $o,rz as Bl,kM as ka,rA as Dl,rB as Ll,ad as Hl,p as _a,hg as Fl,rC as Ol,rD as Ul,gm as Gl,cr as zl,aa as ks,dH as Ma,hU as Wl,ed as Vl,gj as $l,rE as ql,mC as _s,rF as Te,rG as os,rH as Kl,gs as Yl,rI as Jl,hG as xt,aj as on,hF as Ms,mi as yn,hH as As,hI as Ns,rJ as Ql,rK as Xl,dt as Ps,bT as Zl,rL as Cn,rM as ot,rN as wn,rO as ec,rP as tc,c5 as vt,a8 as jn,rQ as sc,rR as ps,mU as nc,cq as oc,mj as ac,rS as ic,rT as rc,rU as lc,rV as kn,rW as cc,rX as gs,rY as uc,rZ as dc,r_ as mc,r$ as Et,s0 as us,s1 as pc,pG as gc,hN as hc,s2 as fc,jr as xc,s3 as bc,s4 as Sc,s5 as vc,s6 as Aa,s7 as Na,s8 as Pa,s9 as yc,sa as ds,sb as an,kN as Cc,sc as qo,sd as wc,se as jc,sf as kc,sg as _c,sh as Mc,si as Ac,sj as Nc,sk as Pc,sl as Ec,sm as Tc,sn as Rc,so as Ic,sp as Bc,sq as Dc,sr as Lc,ss as Hc,st as Fc,mb as Oc,su as Uc,sv as Gc,sw as zc,sx as Wc,qy as Vc,sy as $c,sz as qc,sA as Kc,U as rn,sB as Re,kj as Ko,sC as Ea,sD as Ta,sE as hs,ca as st,lD as ln,sF as _n,sG as Mn,e7 as An,c6 as Nn,c7 as Pn,d2 as En,ki as Tn,d0 as Rn,d1 as In,kl as Yc,sH as Jc,c3 as Bn,c8 as ms,c9 as Qc,eJ as Xc,y as Ra,gy as Zc,sI as Yo,sJ as Jo,H as Dn,sK as Ia,sL as At,sM as eu,sN as tu,lJ as fs,sO as Ba,sP as su,sQ as nu,sR as Qo,sS as ou,sT as au,d3 as iu,sU as ru,sV as lu,sW as cu,iZ as Da,kh as uu,mn as du,a3 as Ln,gu as La,mF as xs,jT as mu,sX as pu,sY as gu,ef as hu,eg as fu,eh as Ha,hW as Fa,ei as Oa,sZ as Ua,ej as Ga,s_ as xu,s$ as bu,dI as Su,t0 as vu,t1 as yu,t2 as Cu,t3 as wu,a4 as bs,jE as za,d as Ss,t4 as Xo,t5 as ju,js as ku,t6 as _u,t7 as Wa,t8 as Va,t9 as cn,gb as Zo,bn as Mu,e5 as Au,e8 as Nu,M as Pu,ta as Eu,tb as Tu,n5 as Ru,tc as Iu,td as Bu,te as Du,tf as Lu,jb as Hu,eP as Fu,j7 as Ou,tg as Uu,th as Gu,ti as zu,eM as ea,je as Wu,bH as Vu,tj as $u,I as qu,_ as Ku,hR as Yu,tk as Ju,tl as Qu,tm as Xu,tn as Zu,ee as ed,to as ta,tp as sa,tq as td,qv as sd,ml as nd,tr as od,ts as ad,tt as id,g8 as rd,tu as ld,d4 as cd,en as ud,eo as dd,tv as md,P as pd,my as gd,ku as Zs,kv as en,i8 as hd,z as fd,eH as xd,nh as bd,tw as Sd,io as vd}from"./df9u9imhvwerk6zv.js";import{u as Es,S as yd,t as Cd,v as wd,w as jd,z as kd,A as _d,B as as,D as Md,g as Hn,c as $a}from"./exwx6mc6hw49alht.js";import{he as Ad,j as Ce,aF as ve,gp as Nd,P as j,a as B,bw as Pd,bx as Ed,c4 as Ve,d as R,aq as $e,hf as qa,a3 as re,F as X,dw as Ie,hg as ee,E as nt,bA as Td,a4 as Ka,hh as Ya,aG as Tt,a_ as na,e as Ja,v as Rd,er as Qa,L as pt,ah as Id,aA as Bd,bP as Fn,bQ as On,g as tn,fp as Un,bH as Gn,cJ as oa,cp as Xa,hi as Za,hj as un,y as zn,B as Dd,cq as Se,hk as ze,aT as Ld,c6 as ei,ey as ti,bS as De,al as Be,hl as si,hm as Hd,am as Ae,hn as Fd,bF as Wn,cF as vs,bG as Od,cG as ni,aD as Vn,g4 as Ud,S as Rt,c7 as dn,dE as Gd,aj as zd,gG as Wd,gH as Vd,ho as $d,hp as qd,hq as Ts,dC as Kd,V as Dt,b$ as oi,cE as ai,I as ii,dA as Yd,eT as ri,cV as Jd,cT as Qd,c3 as li,c2 as Q,bK as Xd,cB as aa,cA as gt,el as Zd,bT as em,R as ia,f as tm,aM as sm,a0 as nm,fX as om,fW as am,l as is,hr as im,hs as rm,ht as lm,z as cm,hu as um,hv as dm,hw as mm,eS as pm,d9 as gm,D as hm,a1 as fm,dM as xm,hx as bm,fC as Sm,aU as vm,a7 as ym,fD as Cm}from"./cyi7nanrg0vdotzd.js";import{a as Le,b as $n,h as Lt,t as mn,f as ci,i as Ht,d as bt,u as Ft,c as wm,j as jm,k as ra,l as km,m as _m,n as Mm,s as Am,o as Nm}from"./kg9pnjn9ianmg7dc.js";import{u as ui}from"./b22a1k4ozfgjkxq7.js";import{b as di,u as Pm,A as Em}from"./juans7zh9ytz81kz.js";import{G as mi}from"./e2l59f6c7bsm78ye.js";import{U as Tm,S as pi}from"./b7o9536h4wpvjcqi.js";import{G as Rm}from"./k154o6a9h89usuus.js";import{a as gi,m as It,d as hi}from"./nlkl42j3n1q6imdw.js";import{P as Im}from"./jo3x2yf4dp19h25k.js";function fi(t){const s=$n(),o=t.useState(n=>n.getSystemHints()[0]);return s.size?s.values().next().value:o}function xi(t,s){const{clearAllSystemHintModeTriggers:o,setThreadSystemHintMode:a}=Le();return m.useCallback(({hint:n,enable:r})=>{o();const l=!!n.composerBarButtonInfo;r?l?(a(n.systemHint,!0,{clientThreadId:s}),t.removeSystemHints()):(t.addSystemHint(n.systemHint,n.name),setTimeout(()=>{t.focus()},0)):t.removeSystemHints()},[o,t,a,s])}const Bm={[D.Research]:Ad.DEEP_RESEARCH};function Dm(t){return Bm[t]??null}function Lm(t,s){return new Date(t).toLocaleDateString(s,{month:"long",day:"numeric"})}const Hm="https://persistent.oaistatic.com/image-gen/nux.222e584e.mp4",Fm="https://help.openai.com/en/articles/8932459",mh=()=>{const{isLoading:t,eligible:s}=ce(ie.hasSeenShibaHomeNux),{isUnauthenticated:o}=Ce(),{value:a}=ve("2781425969");return o||!a?"hide":t?"loading":s?"show":"hide"};function bi(t){return[{title:t.formatMessage({id:"er580q",defaultMessage:"Create an image of a magazine cover of cute animals with headlines and text"}),body:"",type:mt.Autocomplete,prompt:t.formatMessage({id:"SKZKBN",defaultMessage:"Create an image of a photorealistic magazine cover for 'CUTE ANIMALS,' featuring three impossibly cute and stylishly accessorized pets, with realistic, catchy headlines and teaser text"})},{title:t.formatMessage({id:"ukPFbH",defaultMessage:"Create an image for a garden-themed birthday party invitation"}),body:"",type:mt.Autocomplete,prompt:t.formatMessage({id:"uYg5kL",defaultMessage:"Create an image of a colorful invitation for a garden-themed birthday party, including whimsical typography"})},{title:t.formatMessage({id:"mMiJxP",defaultMessage:"Create an image of an astronaut with an inflatable duck on Mars"}),body:"",type:mt.Autocomplete,prompt:t.formatMessage({id:"5nFWh4",defaultMessage:"Create a photorealistic image of an international astronaut on Mars, wearing a giant duck inflatable toy around its waist"})},{title:t.formatMessage({id:"+T7POI",defaultMessage:"Create an image of a tutorial for cooking pasta"}),body:"",type:mt.Autocomplete,prompt:t.formatMessage({id:"9N2bJ0",defaultMessage:"Create an image of a comic-book style tutorial for cooking pasta"})}]}const ph=({onClose:t,clientThreadId:s})=>{const{markAsViewed:o}=ce(ie.hasSeenShibaHomeNux),a=Es(),n=at(),r=Nd("2604379743").config.value,l=typeof r.nux_video_url=="string"?r.nux_video_url:Hm,i=typeof r.nux_image_url=="string"?r.nux_image_url:"",[d,p]=m.useState(!1),u=xi(a,s),{activeSystemHints:c}=Lt(s),g=c.find(v=>v.systemHint===D.PictureV2);m.useEffect(()=>{j.logEventWithStatsig(B.chatgptImageGenNuxModalShown,"chatgpt_imagegen_nux_modal_shown")},[]);const h=W(),f=bi(h),x=()=>{o(),t()},C=()=>{o(),t(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{g&&u({hint:g,enable:!0}),a.focus()})}),a.setAutocompletions(f)};return e.jsx(e.Fragment,{children:e.jsxs(Pd,{isOpen:!0,noPadding:!0,onClose:Ed,shouldIgnoreClickOutside:!0,showCloseButton:!1,size:"custom",type:"success",className:"max-w-lg",children:[e.jsxs("div",{className:"relative aspect-[3/2] w-full",children:[!d&&e.jsx("img",{src:i,alt:"",className:"absolute inset-0 h-full w-full object-cover object-bottom transition-opacity duration-300"}),e.jsx("video",{src:l,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"h-full w-full object-cover object-bottom",onLoadedData:()=>p(!0)})]}),e.jsxs("div",{className:"flex flex-col gap-2 px-8 pb-6 pt-6 text-center",children:[e.jsx("div",{className:"text-xl font-medium",children:e.jsx(N,{id:"KgZP2O",defaultMessage:"Image creation just got better"})}),e.jsx("div",{className:"w-full text-token-text-secondary",children:e.jsx(N,{id:"/oguus",defaultMessage:"ChatGPT now thinks a little longer to make more accurate and detailed images. <link>Learn more</link>",values:{link:v=>e.jsx("a",{href:Fm,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 no-underline",children:v})}})}),e.jsx("div",{className:"mt-2 w-full text-xs text-[#8F8F8F] dark:text-[#C4C4C4]",children:e.jsx(N,{id:"6pIXUv",defaultMessage:"You must have permission to edit images you upload, including consent from any people in them."})}),e.jsxs("div",{className:"mt-4 flex w-full gap-3",children:[e.jsx(Ve,{color:"secondary",onClick:x,className:"flex-1",children:e.jsx(N,{id:"6nf9tD",defaultMessage:"Not now"})}),e.jsx(Ve,{color:"primary",onClick:()=>{C(),n("/?model=gpt-4o")},className:"flex-1",children:e.jsx(N,{id:"ms5BU0",defaultMessage:"Try it"})})]})]})]})})},Si=({className:t,children:s})=>e.jsx(U.div,{className:t,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,transition:{duration:.1,delay:0}},transition:{type:"tween",duration:.3,delay:.2},children:s});function Om({canContinue:t,onContinueGenerating:s}){const o=m.useCallback(n=>{s(n),mn()},[s]);let a=null;return t&&(a=e.jsx(Gm,{onHandleContinueGenerating:o})),a&&e.jsx("div",{className:"flex h-full w-full items-center justify-end gap-0 py-4 md:gap-2",children:a})}function Um({className:t}){return e.jsx(Yr,{className:R("-rotate-180",t)})}const Gm=({onHandleContinueGenerating:t})=>e.jsx(Si,{children:e.jsx(Ve,{as:"button",color:"secondary",onClick:t,className:"whitespace-nowrap py-2",icon:Um,size:"small",children:e.jsx(N,{...Z.continueGenerating})})}),zm=({clientThreadId:t,rateLimitInfo:s,onDismiss:o,onInteract:a,onMount:n})=>{const{name:r,title:l,call_to_action:i,description:d}=s,p=$e(),u=ft(!0),c=ft(!1),g=qa(),h=re(t,X.getIsNewConversation),f=p?.planType??"unknown",x=g&&"block_reason"in g?g.block_reason:null,C="banner_description",v=m.useMemo(()=>({type:r||"unknown",location:C,plan_type:f,is_new_conversation:h,is_hard_block:!!g,hard_block_reason:x??"",call_to_action:i}),[r,C,f,h,g,x,i]),w=at(),E=Cs(),{isUnauthenticated:T}=Ce(),M=ws(),_=bn(Ie.signUpButtonText),L=Bt(),A=ui({clientThreadId:t}),b=y=>{switch(y){case ee.AUTHENTICATE:return{text:M?Ie.logInButtonText:_,onClick:()=>{E({authType:M?"login":"signup",callback:k=>{M?j.logLogInButtonClicked({location:`Rate limit banner - ${r}`,provider:k}):j.logSignUpButtonClicked({location:`Rate limit banner - ${r}`,provider:k})}})}};case ee.AUTHENTICATE_SECONDARY:return{text:M?_:Ie.logInButtonText,onClick:()=>{E({authType:M?"signup":"login",callback:k=>{M?j.logSignUpButtonClicked({location:`Rate limit banner - ${r}`,provider:k}):j.logLogInButtonClicked({location:`Rate limit banner - ${r}`,provider:k})}})}};case ee.GET_PLUS:return{text:Nt.getPlusButton,onClick:()=>{j.logRateLimitGetPlusButtonClicked(v),T?E({authType:M?"login":"signup",shouldOpenPaymentModalOnAuth:!0,callback:k=>{M?j.logLogInButtonClicked({location:"Rate limit banner Get Plus upsell",provider:k}):j.logSignUpButtonClicked({location:"Rate limit banner Get Plus upsell",provider:k})}}):We(w,"Prompt textarea rate limit banner")}};case ee.NEW_CHAT:return{text:Nt.newChatButton,onClick:()=>{u({modelId:"",location:C})}};case ee.PAID_USER_O3_MINI_HIGH:{const k=X.getCurrentLeafId(nt(t)),z=()=>{j.logEventWithStatsig(B.inContextUpsellBannerO3MiniHighCtaClicked,"chatgpt_in_context_upsell_banner_o3_mini_high_cta_clicked",{location:"In-context upsell o3-mini-high for Plus banner - Try it button",eventProperties:v}),c({modelId:"o3-mini-high",location:"In-context upsell o3-mini-high for Plus banner - Try it button"}),A({sourceEvent:new Event("click"),nodeId:k,requestedModelId:"o3-mini-high"})};return{text:Nt.o3MiniHighButton,onClick:z}}case ee.FREE_USER_O3_MINI_HIGH:return{text:Nt.getPlusButton,onClick:()=>{j.logEventWithStatsig(B.inContextUpsellBannerO3MiniHighCtaClicked,"chatgpt_in_context_upsell_banner_o3_mini_high_cta_clicked",{location:"In-context upsell o3-mini-high for Free banner - Get Plus button",eventProperties:v}),We(w,"Prompt textarea in-context upsell banner")}};case"get_pro":return{text:Nt.getProButton,onClick:()=>{j.logRateLimitUpgradePlanButtonClicked({...v,upgrade_plan_tye:"pro"}),T?E({authType:M?"login":"signup",shouldOpenPaymentModalOnAuth:!0,callback:k=>{M?j.logLogInButtonClicked({location:"Rate limit banner Get Pro upsell",provider:k}):j.logSignUpButtonClicked({location:"Rate limit banner Get Pro upsell",provider:k})}}):We(w,"Prompt textarea rate limit banner")}}}};Sn(()=>{j.logRateLimitBannerShown(v),n?.()});let[F,P]=i??[];F===ee.AUTHENTICATE&&L&&(P=ee.AUTHENTICATE_SECONDARY);const O={primaryAction:b(F),secondaryAction:b(P)};return e.jsx(Ca,{onDismiss:o,title:l,description:d,actions:O,onInteract:a})},Nt=ye({getPlusButton:{id:"TeyLcp",defaultMessage:"Get Plus"},getProButton:{id:"Pl8/Vk",defaultMessage:"Get Pro"},newChatButton:{id:"7OvnJ5",defaultMessage:"New chat"},o3MiniHighButton:{id:"DXaA+T",defaultMessage:"Try it"}}),Wm=({clientThreadId:t,rateLimitInfo:s,onDismiss:o,onInteract:a,onMount:n})=>{const{name:r,title:l,call_to_action:i,description:d}=s,p=$e(),u=ft(!0),c=ft(!1),g=qa(),h=re(t,X.getIsNewConversation),f=p?.planType??"unknown",x=Bt(),C=g&&"block_reason"in g?g.block_reason:null,v="banner_description",w=m.useMemo(()=>({type:r||"unknown",location:v,plan_type:f,is_new_conversation:h,is_hard_block:!!g,hard_block_reason:C??"",call_to_action:i}),[r,v,f,h,g,C,i]),E=at(),T=Cs(),{isUnauthenticated:M}=Ce(),_=ws(),L=bn(Ie.signUpButtonText),A=ui({clientThreadId:t}),b=y=>{switch(y){case ee.AUTHENTICATE:return{text:_?Ie.logInButtonText:L,onClick:()=>{T({authType:_?"login":"signup",callback:k=>{_?j.logLogInButtonClicked({location:`Rate limit banner - ${r}`,provider:k}):j.logSignUpButtonClicked({location:`Rate limit banner - ${r}`,provider:k})}})}};case ee.AUTHENTICATE_SECONDARY:return{text:_?L:Ie.logInButtonText,onClick:()=>{T({authType:_?"signup":"login",callback:k=>{_?j.logSignUpButtonClicked({location:`Rate limit banner - ${r}`,provider:k}):j.logLogInButtonClicked({location:`Rate limit banner - ${r}`,provider:k})}})}};case ee.GET_PLUS:return{text:rs.getPlusButton,onClick:()=>{j.logRateLimitGetPlusButtonClicked(w),M?T({authType:_?"login":"signup",shouldOpenPaymentModalOnAuth:!0,callback:k=>{_?j.logLogInButtonClicked({location:"Rate limit banner Get Plus upsell",provider:k}):j.logSignUpButtonClicked({location:"Rate limit banner Get Plus upsell",provider:k})}}):We(E,"Prompt textarea rate limit banner")}};case ee.NEW_CHAT:return{text:rs.newChatButton,onClick:()=>{u({modelId:"",location:v})}};case ee.PAID_USER_O3_MINI_HIGH:{const k=X.getCurrentLeafId(nt(t)),z=()=>{j.logEventWithStatsig(B.inContextUpsellBannerO3MiniHighCtaClicked,"chatgpt_in_context_upsell_banner_o3_mini_high_cta_clicked",{location:"In-context upsell o3-mini-high for Plus banner - Try it button",eventProperties:w}),c({modelId:"o3-mini-high",location:"In-context upsell o3-mini-high for Plus banner - Try it button"}),A({sourceEvent:new Event("click"),nodeId:k,requestedModelId:"o3-mini-high"})};return{text:rs.o3MiniHighButton,onClick:z}}case ee.FREE_USER_O3_MINI_HIGH:return{text:rs.getPlusButton,onClick:()=>{j.logEventWithStatsig(B.inContextUpsellBannerO3MiniHighCtaClicked,"chatgpt_in_context_upsell_banner_o3_mini_high_cta_clicked",{location:"In-context upsell o3-mini-high for Free banner - Get Plus button",eventProperties:w}),We(E,"Prompt textarea in-context upsell banner")}}}};Sn(()=>{j.logRateLimitBannerShown(w),n?.()}),m.useEffect(()=>()=>{j.logEventWithStatsig(B.rateLimitBannerDismissed,"chatgpt_rate_limit_banner_dismissed",w)},[w]);let[F,P]=i??[];F===ee.AUTHENTICATE&&x&&(P=ee.AUTHENTICATE_SECONDARY);const O={primaryAction:b(F),secondaryAction:b(P)};return e.jsx(Ca,{onDismiss:o,title:l,description:d,actions:O,onInteract:a})},rs=ye({getPlusButton:{id:"TeyLcp",defaultMessage:"Get Plus"},newChatButton:{id:"7OvnJ5",defaultMessage:"New chat"},o3MiniHighButton:{id:"DXaA+T",defaultMessage:"Try it"}}),vi=t=>{const{value:s}=ve("1028682714");return s?e.jsx(zm,{...t}):e.jsx(Wm,{...t})},Vm=({clientThreadId:t})=>{const s=Ya(),o=re(t,X.getRequestId),a=re(t,X.getCurrentLeafId),n=Ka(o),r=s?.name?()=>{switch(s.name){case"o3-mini-high-in-context-upsell-free":case"o3-mini-high-in-context-upsell-plus":sl(a,s);break}}:void 0,{value:l}=ve("3612584454");m.useEffect(()=>{n&&!(s?.name==="gpt-4l"&&l)&&na.dismissBanner()},[n,s?.name,l]);const i=s?.is_dismissible?()=>{j.logEventWithStatsig(B.rateLimitBannerDismissed,"chatgpt_rate_limit_banner_dismissed",{type:s?.name}),na.dismissBanner()}:void 0,d=()=>{switch(s?.name){case"o3-mini-high-in-context-upsell-free":case"o3-mini-high-in-context-upsell-plus":al({interactedInPeriod:!0});break}};return e.jsx(ge,{children:s&&e.jsx(U.div,{transition:{type:"tween",ease:"easeInOut",duration:.1},initial:{opacity:0,transform:"translateY(8px)"},animate:{opacity:1,transform:"translateY(0px)"},exit:{opacity:0,transform:"translateY(8px)"},children:e.jsx(vi,{clientThreadId:t,rateLimitInfo:s,onDismiss:i,onInteract:d,onMount:r})})})};function $m(t,s,o,a,n,r,l,i,d,p,u){if(d||s.some(w=>w.model_slug==="o3-mini-high")||o.id==="o3-mini-high"||i&&l&&cs(Date.now(),l)<Vo)return!1;const f=a==null||cs(Date.now(),a)>=nl,x=n===p,C=l==null||r==null||cs(Date.now(),l)>=Vo||r<ol;return f&&C||x?t.name==="o3-mini-high-in-context-upsell-free"?u("should_show_o3_mini_high_upsell_banner_free_user_to_plus",!1):u("should_show_o3_mini_high_upsell_banner_plus_user",!1):!1}function qm(t){const s=Td(),o=Jr(t),a=re(t,X.getRequestId),n=re(t,X.getCurrentLeafId),r=Ka(a),l=Ya(),i=Qr(f=>f.lastSeenInContextUpsellBannerAt),d=Xr(f=>f.inContextUpsellBannerPeriodExposureCount),p=Zr(f=>f.inContextUpsellBannerPeriodStartAt),u=el(f=>f.inContextUpsellBannerLastSeenId),c=tl(f=>f.inContextUpsellBannerInteractedInPeriod),{layer:g}=Tt("1368081792");let h=!1;switch(l?.name){case null:case void 0:h=!1;break;case"o3-mini-high-in-context-upsell-free":case"o3-mini-high-in-context-upsell-plus":h=$m(l,s,o,i,u,d,p,c,r,n,g.get);break;default:h=!0}return!r&&h}const pn=window.sessionStorage,gn=Ja(Rd(()=>({memoryFullBannerDismissed:!!pn?.getItem(pt.MemoryFullBannerDismissed)}))),yi={dismissBanner(){gn.setState(t=>{t.memoryFullBannerDismissed=!0}),pn?.setItem(pt.MemoryFullBannerDismissed,"true")},clearDismissedBanner(){gn.setState(t=>{t.memoryFullBannerDismissed=!1}),pn?.removeItem(pt.MemoryFullBannerDismissed)}};function Km(t){const s=Qa(t),o=il(),{data:a}=rl(s,!1,o),n=a!=null,r=n&&a.memoryFullPct>=100,[l,i]=m.useState(!1);m.useEffect(()=>{!r&&n&&(i(!0),yi.clearDismissedBanner())},[r,n]);const d=gn(p=>p.memoryFullBannerDismissed);return r&&l&&!d}function Ym(){const t=W(),{openSettings:s}=ll();return e.jsx(U.div,{initial:{opacity:0},animate:{opacity:1},children:e.jsx(js,{title:t.formatMessage(ls.memoryFullTitle),content:t.formatMessage(ls.memoryFullTooltip,ls.memoryFullTooltip.values),primaryCtaText:t.formatMessage(ls.memoryManageButton),onPrimaryCtaClick:()=>s(cl.Personalization),onDismiss:()=>yi.dismissBanner()})})}const ls=ye({memoryFullTitle:{id:"yRGU2/",defaultMessage:"Memory is full."},memoryManageButton:{id:"a5A88o",defaultMessage:"Manage"},memoryFullTooltip:{id:"neUc+N",defaultMessage:"New memories won’t be created until you make space. <a>Learn more</a>",values:{a:t=>e.jsx("a",{href:ul,target:"_blank",rel:"noopener noreferrer",className:"underline",children:t})}}});function Jm(){const t=W(),s=()=>{Ci.setState({lastSeenUpsellBannerAt:Date.now()})};m.useEffect(()=>{j.logEventWithStatsig(B.contextualAnswersAdminNuxBannerShown,"chatgpt_contextual_answers_admin_nux_banner_shown")},[]);const o=m.useCallback(()=>{j.logEventWithStatsig(B.contextualAnswersAdminNuxBannerConfirmationButtonClicked,"chatgpt_contextual_answers_admin_nux_banner_confirmation_button_clicked"),window.location.href="/admin/ca"},[]);return e.jsx(js,{primaryCtaText:t.formatMessage(sn.connectLabel),onPrimaryCtaClick:o,onDismiss:s,content:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(dl,{size:18,icons:[e.jsx(wa,{className:"icon-md"},"gDrive")]}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("div",{className:"flex items-center gap-2 font-bold",children:t.formatMessage(sn.title)}),e.jsx("span",{className:"text-token-text-secondary",children:t.formatMessage(sn.description)})]})]})})}const Qm=7,Xm="oai/apps/caUpsellBanner",Ci=Ja()(Id(()=>({lastSeenUpsellBannerAt:void 0}),{name:Xm}));function Zm(t){const s=Ci(d=>d.lastSeenUpsellBannerAt?cs(Date.now(),d.lastSeenUpsellBannerAt)>=Qm:!0),{activeSystemHints:o}=Lt(t),a=m.useMemo(()=>o.some(d=>d.systemHint===D.ContextualAnswers),[o]),{connectionInstanceData:n,isLoading:r}=vn({skip:!a}),l=Bd(),i=!!l?.isAdminOfAccount()||!!l?.isOwnerOfAccount();return s&&a&&i&&!r&&n?.connection_statuses.length===0}const sn=ye({connectLabel:{id:"ContextualAnswersAdminUpsellBanner.connectLabel",defaultMessage:"Connect"},title:{id:"ContextualAnswersAdminUpsellBanner.title",defaultMessage:"Connect Google Drive to help your team unblock work"},description:{id:"ContextualAnswersAdminUpsellBanner.description",defaultMessage:"Bring your internal knowledge into ChatGPT — secure and admin-controlled"}}),qn=ie.hasSeenMemoryInSearch;function ep(){const t=at();m.useEffect(()=>{j.logEventWithStatsig(B.chatgptMemoryInSearchAnnouncementShown,"chatgpt_memory_in_search_announcement_shown")},[]);const{markAsViewed:s}=ce(qn),o=m.useCallback(()=>{j.logEventWithStatsig(B.chatgptMemoryInSearchAnnouncementClosed,"chatgpt_memory_in_search_announcement_closed"),s()},[s]),a=m.useCallback(()=>{j.logEventWithStatsig(B.chatgptMemoryInSearchAnnouncementCTAClicked,"chatgpt_memory_in_search_announcement_cta_clicked"),t("#settings/Personalization"),s()},[s,t]);return e.jsx(js,{onPrimaryCtaClick:a,primaryCtaText:e.jsx(N,{id:"8MwdJw",defaultMessage:"Settings"}),onDismiss:o,content:e.jsxs("div",{className:"flex-grow",children:[e.jsx("div",{className:"mb-0.5 font-semibold",children:e.jsx(N,{id:"Sdp8JT",defaultMessage:"Search, now with memory"})}),e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(N,{id:"a4czFu",defaultMessage:"ChatGPT can now use memories to shape searches it sends to search providers, to give you more relevant answers. You can turn this off at any time in settings. {learnMoreLink}",values:{learnMoreLink:e.jsx("a",{href:"https://help.openai.com/en/articles/9237897-chatgpt-search",target:"_blank",rel:"noopener noreferrer",className:"underline",children:e.jsx(N,{id:"JMsjZT",defaultMessage:"Learn more"})},"learn-more-link")}})})]})})}function wi(){const t=ce(qn),{userIsInSearchHoldoutWithWebDisabled:s}=ci();return t.eligible&&!t.isLoading&&!s}function tp(){const{markAsViewed:t,eligible:s}=ce(qn);return s?t:void 0}const sp=()=>{const{shouldShowSkipButton:t}=ml();return t?e.jsx(Si,{className:"flex justify-center",children:e.jsx(Ve,{as:"button",color:"secondary",onClick:()=>pl.skipParagen(),children:e.jsx(N,{...np.skip})})}):null},np=ye({skip:{id:"dvcUbp",defaultMessage:"Skip"}}),op=Fn(()=>On(()=>import("./krw51z3nnez9ko8b.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(t=>t.JawboneNotificationsBanner)),ji=m.memo(function({className:s}){const{store:o}=ke(),a=o.useIsHeaderContentAreaPopulated();return e.jsx("div",{className:R(s??"absolute bottom-full left-0 right-0",fl.PromptTextareaHeader),children:e.jsx(gl,{shouldRender:a,contentArea:Pt.Header,children:e.jsxs("div",{className:"mb-2 flex flex-col gap-3.5 pt-2",children:[e.jsx(ap,{}),e.jsx(ip,{})]})})})});function ap(){const{store:t}=ke(),s=t.useSharedProps(r=>r?.clientThreadId),o=t.useContentAreaId(Pt.HeaderTop),a=hl();let n;switch(o){case I.ProjectConversationTaskNoFileAccess:n=e.jsx(up,{});break;case I.AdvancedVoiceOnMobileAnnouncement:n=e.jsx(Al,{clientThreadId:s});break;case I.S09KM1:n=null;break;case I.ParagenControls:n=e.jsx(sp,{});break;case I.BannerSignup:n=e.jsx(cp,{});break;case I.BannerTermsDisclaimer:n=e.jsx(dp,{});break;case I.PromptTextareaAction:n=e.jsx(mp,{});break;case I.BannersRateLimit:n=e.jsx(pp,{});break;case I.BannerSidekickAnnouncement:n=e.jsx(Ml,{});break;case I.SearchBrowserExtensionAnnouncement:n=e.jsx(Cd,{});break;case I.MemoryInSearchAnnouncement:n=e.jsx(ep,{});break;case I.MoonshineAnnouncement:n=e.jsx(_l,{});break;case I.CustomizeChatGPTAnnouncement:n=e.jsx(kl,{});break;case I.SearchBrowserExtensionReactiveAnnouncement:n=e.jsx(yd,{});break;case I.BannerMemoryFull:n=e.jsx(Ym,{});break;case I.Box:n=e.jsxs("div",{id:"Box",className:"flex h-20 w-full items-center justify-center gap-2 bg-red-500 p-2",children:["box",e.jsxs("div",{className:"flex h-full w-full items-center justify-center gap-2 bg-blue-500 p-2",children:["inner",e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-yellow-400 text-center",children:"actual content"})]})]});break;case I.JawboneAnnouncement:a?n=e.jsx(op,{}):n=null;break;case I.JawboneMaxActiveAnnouncement:a?n=e.jsx(jl,{}):n=null;break;case I.PromoRedemptionAnnouncement:n=e.jsx(wl,{});break;case I.OperatorAnnouncement:n=e.jsx(Cl,{});break;case I.BannerPlusUpsell:n=e.jsx(yl,{});break;case I.ContextualAnswersAdminUpsell:n=e.jsx(Jm,{});break;case I.ReferrerRedemptionAvailableAnnouncement:n=e.jsx(vl,{});break;case I.RefereeRedemptionAvailableAnnouncement:n=e.jsx(Sl,{});break;case I.ReferralProgramUpsellAnnouncement:n=e.jsx(bl,{});break;case I.StudentsUpsellAnnouncement:n=e.jsx(xl,{});break;default:n=null;break}return n}function ip(){const{store:t}=ke(),s=t.useContentAreaId(Pt.HeaderBottom);let o;switch(s){case ja.DallePromptControls:o=e.jsx(lp,{});break;default:o=null;break}return o}const rp=Fn(()=>On(()=>import("./nwmjlrv24of4thpe.js"),__vite__mapDeps([7,1,3,4,2,5,8,9])).then(t=>t.default));function lp(){const{store:t}=ke(),s=t.useSharedProps(o=>o?.composerController);return s?e.jsx(rp,{composerController:s}):null}function cp(){const{store:t}=ke(),s=t.useSharedProps(n=>n?.clientThreadId),o=ws(),a=Nl();return s?o?e.jsx(Pl,{threadId:s,showSignUp:a}):e.jsx(El,{threadId:s,showLogin:a}):null}function up(){return m.useEffect(()=>()=>{tn.getItem(pt.TasksHasSeenProjectDisclaimerBanner)||tn.setItem(pt.TasksHasSeenProjectDisclaimerBanner,!0)},[]),e.jsx(js,{icon:e.jsx(Tl,{}),title:e.jsx(N,{id:"ibX3g7",defaultMessage:"Tasks can’t access project files"}),content:e.jsx(N,{id:"fm94Tm",defaultMessage:"There’s a task in this conversation — just FYI, it won’t be able to access project files."}),onDismiss:()=>{tn.setItem(pt.TasksHasSeenProjectDisclaimerBanner,!0)}})}function dp(){const{store:t}=ke(),s=t.useSharedProps(o=>o?.clientThreadId);return s?e.jsx(Rl,{threadId:s}):null}function mp(){const{store:t}=ke(),s=t.useSharedProps();return s?e.jsx(Om,{...s}):null}function pp(){const{store:t}=ke(),s=t.useSharedProps(o=>o?.clientThreadId);return s?e.jsx(Vm,{clientThreadId:s}):null}function la({clientThreadId:t,onClick:s}){m.useEffect(()=>{Bl(t)},[t]);const o=W();return e.jsx(U.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},className:"inline-block",children:e.jsx(ka,{onClick:()=>{Dl(t),s()},label:o.formatMessage(bp.moreStarterPrompts)})})}function gp({starterPrompt:t,starterPrompts:s,index:o,disabled:a,onSelectStarterPrompt:n}){const r=t.theme??t.title,l=Pm(),{mutate:i}=Ll(),d=t.category==="onboarding"?p=>{i({key:ie.hasUsedConversationalOnboardingStarterPrompt}),l(p,t,s,o)}:p=>n?.(p,t,s,o);return e.jsx(ka,{disabled:a,onClick:d,icon:e.jsx(Hl,{category:t.category,useV2Colors:!0}),label:r})}const hp=5,fp=3;function ki({starterPrompts:t,onSelectStarterPrompt:s,disabled:o,clientThreadId:a,onExpand:n,mobileLayout:r=!1}){const l=r?fp:hp,[i,d]=m.useState(l),[p,u]=m.useState(!1),c=m.useRef(null),g=t.length<=i;m.useEffect(()=>{$o(t.slice(0,l),a)},[a]),m.useEffect(()=>{if(!p&&!g&&c.current){const f=c.current,x=f.getBoundingClientRect(),C=x.width,v=Array.from(f.children);let w=0;for(let E=0;E<v.length&&v[E].getBoundingClientRect().right-x.left<=C;E++)w++;d(w),u(!0)}},[t,g,p]);const h=()=>{const f=t.slice(i,t.length).map(x=>({...x,isAdditional:!0}));f.length>0&&$o(f,a),d(t.length),n()};return e.jsxs("div",{className:R("mt-5 flex items-center justify-center gap-x-2 transition-opacity xl:gap-x-2.5",p&&t.length>0?"opacity-100":"opacity-[0.01]",r?"flex-wrap":"flex-nowrap"),children:[e.jsxs("ul",{className:R("relative flex items-stretch gap-x-2 gap-y-4 overflow-hidden py-2 sm:gap-y-2 xl:gap-x-2.5 xl:gap-y-2.5",g||r?"flex-wrap justify-center":"flex-nowrap justify-start"),ref:c,children:[t.slice(0,i).map((f,x)=>e.jsx(U.li,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},children:e.jsx(gp,{starterPrompt:f,starterPrompts:t,index:x,disabled:o,onSelectStarterPrompt:s})},f.id??x)),r&&t.length>i&&e.jsx(la,{clientThreadId:a,onClick:h})]}),!r&&t.length>i&&e.jsx(la,{clientThreadId:a,onClick:h})]})}const gh=({clientThreadId:t,currentModelId:s,isModelLoaded:o})=>{const[a,n]=m.useState(!1),r=Un(),{prospectiveModelId:l}=St(t),i=o?s:l??"auto",{promptStarters:d,shouldShowStarterPrompts:p,onSelectStarterPrompt:u}=di({isModelLoaded:o,shouldBeEnabledForDefaultAssistant:!0,clientThreadId:t,limit:8,modelSlug:i});return e.jsx(U.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:R(!a&&"h-[116px]"),children:p&&d&&e.jsx(ki,{starterPrompts:d,onSelectStarterPrompt:u,disabled:r,clientThreadId:t,onExpand:()=>n(!0),mobileLayout:!0})})},xp=({currentModelId:t,clientThreadId:s,isModelLoaded:o})=>{const{isUnauthenticated:a}=Ce(),[n,r]=m.useState(!1),l=Il(),i=Un(),{prospectiveModelId:d}=St(s),p=o?t:d??"auto",{promptStarters:u,shouldShowStarterPrompts:c,onSelectStarterPrompt:g}=di({isModelLoaded:o,shouldBeEnabledForDefaultAssistant:!0,clientThreadId:s,limit:8,modelSlug:p});return e.jsx(U.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:R("hidden min-h-[108px] max-w-full",l?"@lg/thread:block":"lg:block",a&&n?"":"h-[70px]"),children:c&&u&&e.jsx(ki,{starterPrompts:u,onSelectStarterPrompt:g,disabled:i,clientThreadId:s,onExpand:()=>r(!0)})})},bp=ye({moreStarterPrompts:{id:"SplashScreenV2.moreStarterPrompts",defaultMessage:"More"}}),ca=Gn.div`m-8 flex flex-col items-center`;function ua(t){return e.jsx(U.div,{initial:{opacity:0,translateY:20},animate:{opacity:1,translateY:0,transition:{duration:.5,ease:"easeIn"}},...t})}function Sp({clientThreadId:t}){const o=re(t,n=>n?.promptGptRating)?.gizmoId,{data:a}=_a(o);return o==null||a==null||!Fl(a)?null:e.jsx(vp,{gizmoId:o})}function vp({gizmoId:t}){const[s,o]=m.useState(!1),[a,n]=m.useState(!1),r=Ol(t),l=async d=>{o(!0),setTimeout(()=>{n(!0)},5e3),j.logEvent(B.submitInlineRating,{gizmo_id:t,rating:d}),await r.mutateAsync({rating:d})},i=async()=>{n(!0),j.logEvent(B.dismissInlineRating,{gizmo_id:t}),await r.mutateAsync({})};return m.useEffect(()=>{a||j.logEvent(B.showInlineRating,{gizmo_id:t})},[a,t]),a?null:s?e.jsx(ca,{children:e.jsxs(ua,{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"rounded-lg border border-token-border-heavy p-4",children:e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(N,{id:"gizmo.inlineReview.reviewLeft",defaultMessage:"Feedback sent"}),e.jsx(oa,{onClick:()=>{n(!0)}})]})}),e.jsx("div",{className:"text-xs text-token-text-tertiary",children:e.jsx(N,{id:"gizmo.inlineReview.reviewLeftSubtext",defaultMessage:'To update your rating, click "Send Feedback" in the GPT Menu'})})]})}):e.jsx(ca,{children:e.jsxs(ua,{className:"flex flex-col items-center gap-4 rounded-lg border border-token-border-heavy p-4",children:[e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(N,{id:"gizmo.inlineReview.prompt",defaultMessage:"How would you rate this GPT so far?"}),e.jsx(oa,{onClick:i})]}),e.jsx(Ul,{rating:void 0,onRating:l})]})})}const _i=Gn.div`group flex h-10 items-center gap-2 rounded-lg px-2 hover:bg-token-main-surface-secondary text-sm text-token-text-primary`;function yp(){const{data:t,isLoading:s}=$l({cutId:"recent",limit:8}),{data:o,isLoading:a}=ql();return{isLoading:s||a,recent:t,pinned:o}}function Cp({query:t,onSelectGizmo:s,selectedIdx:o},a){const n=Gl(),r=m.useRef([]),{isLoading:l,recent:i,pinned:d}=yp();m.useImperativeHandle(a,()=>({handleEnterOnIndex:c=>{if(!u[c])return c<p.length?p[c].resource:"create"},getResultsLength:()=>p.length+1,scrollToItem:c=>{const g=r.current[c];g&&g.scrollIntoView({behavior:"instant",block:"nearest"})}}));let p=[];if(l)return e.jsx("div",{className:"absolute right-4 top-0 flex h-full items-center justify-center",children:e.jsx(Xa,{})});i&&p.push(...i.pages.flatMap(c=>c.list.items).map(c=>({resource:c.resource,from:"recent"}))),d&&p.push(...d.items.map(c=>({resource:c,from:"pinned"}))),p=zl(p,c=>c.resource.gizmo.id);const u=p.map(c=>c.resource.gizmo.tags?.includes(ks.WorkspaceDisabled));return t&&t!==""&&(p=p.filter(c=>(c.resource.gizmo.display.name.toLowerCase()+c.resource.gizmo.display.description?.toLowerCase()+c.resource.gizmo.author.display_name?.toLowerCase()).includes(t?.toLowerCase()))),e.jsxs("div",{className:"max-h-40 overflow-y-auto",children:[p.map((c,g)=>e.jsx("div",{ref:h=>{r.current[g]=h},tabIndex:g,onClick:()=>{u[g]||s(c.resource)},children:e.jsx(_p,{gizmoResource:c.resource,from:c.from,showDescription:n,isSelected:o===g,grayedOut:u[g]})},c.resource.gizmo.id)),e.jsx("div",{ref:c=>{r.current[p.length]=c},tabIndex:p.length,onClick:()=>{s("create")},children:e.jsx(jp,{isSelected:o===p.length})},"create")]})}const wp=m.forwardRef(Cp),jp=({isSelected:t})=>e.jsx(_i,{className:t?"bg-token-main-surface-secondary":"",children:e.jsxs(Vr,{to:"/gpts/editor",target:"_blank",className:"flex flex-row space-x-2 font-semibold",children:[e.jsx("span",{className:"self-center",children:e.jsx(Ma,{className:"icon-sm"})}),e.jsx("span",{children:e.jsx(N,{...Mi.dropdownCreateLabel})})]})}),kp=({onClick:t,onClose:s})=>{const[o,a]=m.useState(null),n=m.useRef(null),r=m.useRef(null),[l,i]=m.useState(0),d=W(),p=u=>{j.logEvent(B.mentionsClickGizmo,{gizmo_id:u==="create"?"create":u.gizmo.id}),u!=="create"&&t(u)};return e.jsxs(e.Fragment,{children:[e.jsx("input",{autoFocus:!0,placeholder:d.formatMessage(Mi.searchPlaceholder),ref:n,onKeyDown:u=>{if(u.nativeEvent.isComposing)return;const c=r.current?.getResultsLength()??0;if((u.key==="Escape"||u.key==="Backspace"&&!o)&&(u.preventDefault(),s()),u.key==="Enter"||u.key==="Tab"){u.preventDefault();const g=r.current?.handleEnterOnIndex(l);if(!g)return;g==="create"?(window.open("/gpts/editor","_blank"),s()):p(g)}if(u.key==="ArrowDown"&&l<c-1){u.preventDefault();const g=l+1;r.current?.scrollToItem(g),i(g)}if(u.key==="ArrowUp"&&l>0){u.preventDefault();const g=l-1;r.current?.scrollToItem(g),i(g)}},onChange:u=>{a(u.target.value),i(0)},className:"w-full border-0 bg-token-main-surface-primary p-2 text-sm focus:outline-none"}),e.jsx(wp,{ref:r,query:o,selectedIdx:l,onSelectGizmo:p})]})},da=({onClick:t,onClose:s})=>{const o=Za(),a=!!o;return Sn(()=>{j.logEvent(B.mentionsOpened,{gizmo_selector_disabled:a})}),a?e.jsx(vi,{clientThreadId:un,rateLimitInfo:o}):e.jsx("div",{onBlur:n=>{n.currentTarget.contains(n.relatedTarget)||s()},className:"popover rounded-2xl border border-token-border-light bg-token-main-surface-primary p-2 shadow-lg",children:e.jsx(kp,{onClick:t,onClose:s})})};function _p({gizmoResource:t,from:s,showDescription:o,isSelected:a,grayedOut:n}){const r=!!t.gizmo.tags?.includes(ks.FirstParty);return e.jsxs(_i,{className:R(a?"bg-token-main-surface-secondary":"",n&&"opacity-50"),children:[e.jsx(mi,{isFirstParty:r,src:t.gizmo.display.profile_picture_url,className:R("icon-xl h-7 w-7 flex-shrink-0",n&&"grayscale group-hover:grayscale-0")}),e.jsxs("div",{className:"flex h-fit grow flex-row justify-between space-x-2 overflow-hidden text-ellipsis whitespace-nowrap",children:[e.jsxs("div",{className:"flex flex-row space-x-2",children:[e.jsx("span",{className:"shrink-0 truncate font-semibold",children:t.gizmo.display.name}),o&&e.jsx("span",{className:"flex-grow truncate text-sm text-token-text-tertiary sm:max-w-xs lg:max-w-md",children:t.gizmo.display.description})]}),e.jsx("span",{className:"shrink-0 self-center",children:s==="recent"?e.jsx(Wl,{className:"icon-sm"}):e.jsx(Vl,{className:"icon-sm"})})]})]})}const Mi=ye({talkingTo:{id:"TaggingDropdown.talkingTo",defaultMessage:"Talking to"},dropdownCreateLabel:{id:"TaggingDropdown.dropdownCreateLabel",defaultMessage:"Create a GPT"},searchPlaceholder:{id:"TaggingDropdown.searchPlaceholder",defaultMessage:"Search recent and pinned GPTs"}});function Mp(){const{value:t}=ve("1166240779");return t}function yt(t){const o=$n().has(D.Research),a=Mp();return re(t,r=>{if(!o||!a)return{state:"disabled",shouldShowResearchText:!1};const l=X.getConversationTurns(r),i=l.filter(c=>c.role===zn.User),d=Dd(i);let p=0;for(let c=i.length-1;c>=0&&i[c].messages.some(h=>h.metadata?.system_hints?.includes(D.Research));c--)p++;const u=i.some(c=>c.messages.some(g=>g.metadata?.system_hints?.includes(D.Research)));if(l.length===0||!u)return{state:"initial",shouldShowResearchText:!0};if(d?.messages.some(c=>c.metadata?.system_hints?.includes(D.Research))){const c=l.findIndex(h=>h===d);return l.filter((h,f)=>f>c&&h.messages.some(x=>x.metadata?.b1de6e2_rm)).length>0?{state:"recurrent",shouldShowResearchText:!0}:p%2===0?{state:"running",shouldShowResearchText:!1}:{state:"clarify",shouldShowResearchText:!1}}return{state:"recurrent",shouldShowResearchText:!0}})}const Ap=350;function Np({suggestionData:t,visualTreatment:s,composerController:o,clientThreadId:a}){const n=W(),{state:r}=yt(a),i=n.formatMessage(Z.researchSuggestionInitial),d=n.formatMessage(Z.deepResearchPlaceholderBullet1),p=n.formatMessage(Z.deepResearchPlaceholderBullet2),u=n.formatMessage(Z.deepResearchPlaceholderBullet3),{displayedText:c,isStreaming:g}=os(i,{enableStreaming:r!=="disabled"},[o.isEmpty()]),h=Ap,{displayedText:f,isStreaming:x}=os(d,{startDelay:h,enableStreaming:r!=="disabled"}),{displayedText:C,isStreaming:v}=os(p,{enableStreaming:!x&&r!=="disabled"}),{displayedText:w}=os(u,{enableStreaming:!x&&!v&&r!=="disabled"});return e.jsx("div",{className:R("mb-[8px] mt-[-8px] flex select-none items-start justify-between text-token-text-tertiary",s==="legacy"&&"pl-1"),children:o.isEmpty()?e.jsxs("ul",{className:"list-disc pl-5 text-token-text-tertiary marker:text-token-text-tertiary",children:[f&&e.jsx("li",{children:f}),C&&e.jsx("li",{children:C}),w&&e.jsx("li",{children:w})]}):e.jsx("div",{className:R("relative flex items-center",o.hasMultipleLines()&&"pt-2"),children:e.jsx("div",{className:R(g&&"result-streaming",t?.isLoading&&"pulse","text-token-text-tertiary"),children:e.jsx("p",{children:c})})})})}const hn={type:"spring",stiffness:48.7,damping:13.54,mass:1};function Ai({enabled:t,children:s,...o}){const a=_s();return e.jsxs(U.div,{initial:{minHeight:0},animate:{minHeight:t?"142px":0},exit:{minHeight:0},transition:a?Te:hn,className:"flex flex-col justify-start",children:[s,t&&e.jsx(Np,{...o})]})}function Ni(t){const s=yt(t),o=ve("3544641259")?.value;return s.state!=="disabled"&&o}function Pi(t){const s=ve("3544641259")?.value,o=re(t,r=>r?.selectedSources??[ze.Web]),a=m.useMemo(()=>new Set(o),[o]),n=m.useCallback(r=>{t&&Ld(t,l=>{const i=l.selectedSources??new Set([ze.Web]);i.has(r)?(i.delete(r),l.selectedSources=i):(i.add(r),l.selectedSources=i)})},[t]);return s?{selectedSources:a,toggleSource:n}:{selectedSources:void 0,toggleSource:()=>{}}}function nn({label:t,selected:s,onClick:o,Icon:a,isVanguard:n,iconColor:r}){return e.jsxs("button",{type:"button","aria-pressed":s,onClick:l=>{l.stopPropagation(),l.preventDefault(),o()},className:R("flex min-h-8 items-center gap-1 rounded-full px-2 py-1 text-sm font-medium transition-colors focus:outline-none",s?"border border-token-border-light bg-token-main-surface-primary":n?"text-token-text-secondary":"text-token-text-tertiary",n?"":"border border-token-border-light"),children:[e.jsx(a,{"aria-hidden":!0,className:R("h-4 w-4 transition-colors",s?"bg-token-main-surface-primary":"grayscale filter",r||"text-token-text-primary")}),e.jsxs("span",{children:[t," "]}),s&&e.jsx(ei,{className:"h-4 w-4 text-token-text-tertiary"})]})}const Ei=({clientThreadId:t,isVanguard:s=!1})=>{const{selectedSources:o,toggleSource:a}=Pi(t),{connectorConfig:n}=Kl(),r=!!n.get(Se.GDRIVE_ACTION_CONNECTOR)?.access_token,l=_s(),i=!!n.get(Se.GITHUB_CONNECTOR)?.access_token,d=()=>{window.location.assign("#settings/ConnectorSettings")};if(!t||!o)return null;const c={initial:{opacity:0,height:0,y:"-28px"},animate:{opacity:1,y:0,height:"56px",transition:l?Te:{opacity:{delay:.2},default:hn}},exit:{opacity:0,y:"-28px",height:0,transition:l?Te:{opacity:{delay:0},default:hn}}};return e.jsxs(U.div,{variants:c,initial:"initial",animate:"animate",exit:"exit",className:"relative w-full",children:[e.jsx("div",{className:"absolute inset-x-[15px] top-0 h-0 border-t border-token-border-xlight"}),e.jsx("div",{className:R("z-0 w-full p-3","bg-token-main-surface-primary dark:bg-[#303030]"),children:e.jsxs("div",{className:"flex items-center gap-4",children:[!s&&e.jsx("span",{className:"text-sm font-medium text-token-text-primary",children:e.jsx(N,{id:"dyMo44",defaultMessage:"Sources"})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(nn,{label:e.jsx(N,{id:"G03bJa",defaultMessage:"Web"}),selected:o.has(ze.Web),onClick:()=>a(ze.Web),Icon:Yl,iconColor:"text-blue-1000",isVanguard:s}),e.jsx(nn,{label:e.jsx(N,{id:"XQpEHU",defaultMessage:"Github"}),selected:o.has(ze.GitHub)&&i,onClick:()=>i?a(ze.GitHub):d(),Icon:Jl,isVanguard:s}),e.jsx(nn,{label:e.jsx(N,{id:"m4j0Bv",defaultMessage:"Drive"}),selected:o.has(ze.GoogleDrive)&&r,onClick:()=>r?a(ze.GoogleDrive):d(),Icon:wa,isVanguard:s})]})]})})]})},Ot=({pressed:t,disabled:s,icon:o,label:a,ariaLabel:n,animatedLabel:r,showLabel:l,onClick:i,splitButtonDropdownContent:d,dropdownContent:p})=>{const[u,c]=m.useState(!1),g=va(),h=!s&&t,f=a&&e.jsx("div",{className:R("whitespace-nowrap pl-1 pr-1",!t&&"[display:--force-hide-label]"),children:a}),x=e.jsxs("button",{className:R("flex h-full min-w-8 items-center justify-center p-2",{"pr-1.5":!!d}),"aria-pressed":t,"aria-label":n,disabled:s,onTransitionEnd:()=>c(!1),onClick:w=>{p||(c(!0),i(w))},children:[o,!r&&l?f:null,r&&e.jsx(ge,{initial:!1,children:l&&e.jsx(U.span,{initial:{x:-10,width:0,opacity:0},animate:{x:0,width:"fit-content",opacity:1},exit:{x:-10,width:0,opacity:0},transition:{ease:"easeOut",duration:g?0:.15},children:f})})]}),C=d||p?e.jsx(e.Fragment,{children:e.jsx(As,{children:e.jsx(ti,{className:"p-0",$as:Ns,side:"bottom",align:"start",collisionPadding:10,sideOffset:8,children:p??d})})}):null,v=e.jsxs("div",{className:R("inline-flex h-9 rounded-full border text-[13px] font-medium radix-state-open:bg-black/10",{"duration-75 motion-safe:transition-all":u,"text-token-text-secondary":!t,"border-transparent bg-[#DAEEFF] text-blue-1000 can-hover:hover:bg-[#BDDCF4] dark:bg-[#2A4A6D] dark:text-[#48AAFF] dark:can-hover:hover:bg-[#1A416A]":!!h,"border-token-border-light focus-visible:outline-black can-hover:hover:bg-token-main-surface-secondary dark:focus-visible:outline-white dark:can-hover:hover:bg-gray-700":!h,"opacity-30":s}),children:[p?e.jsx(xt,{asChild:!0,children:x}):x,!p&&d?e.jsx(xt,{asChild:!0,children:e.jsx("button",{className:"border-l border-token-border-light p-2",style:{borderColor:h?"#0285FF0D":void 0},disabled:s,children:e.jsx(on,{className:"h-[18px] w-[18px]"})})}):null]});return d||p?e.jsxs(Ms,{children:[e.jsx(yn,{asChild:!0,children:v}),C]}):v},Pp={p:t=>{const{node:s,children:o,...a}=t;return e.jsx("p",{...a,className:"text-start !text-sm !leading-6 text-white",children:o})},a:t=>{const{node:s,children:o,...a}=t;return e.jsx("a",{...a,className:"!text-sm !leading-6 !text-white !underline",children:o})}};function Ep(t){const s=Cn(),o=ce(t);return!o.isLoading&&o.eligible&&!s}function Tp(t,s){const o=Ql(),a=Xl(),n=Ht(s);return Ep(t)&&!o&&!n&&!a}function Rp(t,s){const o=ce(t.announcementKey);return e.jsx(Ps,{announcementKey:t.announcementKey,side:"top",show:!0,theme:"bright",dismissOnOutsideClick:!0,badge:"new",title:t.nuxTitle,onDismiss:o.markAsViewed,sideOffset:0,className:"!max-w-2xs xs:!max-w-sm",description:e.jsx(Zl,{componentOverrides:Pp,children:t.nuxDescription}),children:e.jsx("div",{children:s})})}var et=(t=>(t.Hover="hover",t.Enable="enable",t.Disable="disable",t))(et||{});const Ti=new Map([[D.Think,{hover:[B.composerThinkButtonHovered,"composer_think_button_hovered"],enable:[B.composerThinkButtonEnabled,"composer_think_button_enabled"],disable:[B.composerThinkButtonDisabled,"composer_think_button_disabled"]}],[D.Research,{hover:[B.composerResearchButtonHovered,"composer_research_button_hovered"],enable:[B.composerResearchButtonEnabled,"composer_research_button_enabled"],disable:[B.composerResearchButtonDisabled,"composer_research_button_disabled"]}]]);function Ip({systemHint:t,label:s,logo:o,isDisabled:a=!1,composerController:n,analyticsMetadata:r,onClick:l,showLabel:i=!1,splitButtonDropdownContent:d,dropdownContent:p}){const{name:u,systemHint:c}=t,g=c,{setThreadSystemHintMode:h,clearAllSystemHintModeTriggers:f}=Le(),x=Ht(g),C=!!t.composerBarButtonInfo?.upsell,v=bt.useStore(),{value:w}=Be("2454940646"),E=Ft(),T=[D.Search,D.Think].includes(g);m.useEffect(()=>{a&&E.has(g)&&h(g,!1,r)},[a,g,r,h,E,T]);const M=m.useCallback(A=>{A.stopPropagation(),A.preventDefault();let b=!0;w&&T&&(v.getState().persistedSystemHints.has(D.Search)||v.getState().persistedSystemHints.has(D.Think))&&(b=!1),b&&f(),h(g,!x,r),x||(n.removeSystemHints(),n.focus());const{enable:F,disable:P}=Ti.get(g)??{},[O,y]=(x?P:F)??[];O&&y&&j.logEventWithStatsig(O,y,r),l?.(A)},[r,w,f,n,g,T,x,l,h,v]),_=C?e.jsx("div",{className:"py-2",children:e.jsx(wn,{location:g,statsig_login_event:"chatgpt_composer_upsell_login_button_clicked",statsig_signup_event:"chatgpt_composer_upsell_signup_button_clicked",containerNoPadding:!0})}):null;return e.jsx(Ot,{pressed:x,disabled:a,icon:o,label:s,ariaLabel:u,animatedLabel:!i,showLabel:i||x,onClick:M,dropdownContent:p??_,splitButtonDropdownContent:d})}function Bp({composerController:t,systemHint:s,composerBarButtonInfo:o,isDisabled:a,clientThreadId:n,showLabel:r,labelOverride:l,disabledReason:i,rateLimitProgress:d,dropdownContent:p,splitButtonDropdownContent:u,logoOverride:c}){const g={clientThreadId:n};return e.jsx(Dp,{composerBarButtonInfo:o,isDisabled:a,analyticsMetadata:g,systemHint:s.systemHint,disabledReason:i,rateLimitProgress:d,children:e.jsx(Ip,{isDisabled:a,systemHint:s,label:l??s.name,logo:c??e.jsx(Tm,{svgString:s.logo,className:"h-[18px] w-[18px]"}),composerController:t,analyticsMetadata:g,showLabel:r,dropdownContent:p,splitButtonDropdownContent:u})})}function Dp({children:t,isDisabled:s,systemHint:o,composerBarButtonInfo:a,analyticsMetadata:n,disabledReason:r,rateLimitProgress:l}){const i=Tp(a.announcementKey,o),d=Rp(a,t),p=W();let u=null;return l&&l.remaining?u=e.jsx(Ri,{remaining:l.remaining,reset_date:l.reset_after,text:a.tooltipText}):a.tooltipText&&(u=e.jsx(Kn,{text:a.tooltipText})),i?d:e.jsx("div",{children:e.jsx(De,{sideOffset:0,label:s?r===ot.HasAttachedFiles?p.formatMessage({id:"hhxO6y",defaultMessage:"Reason disabled for attachments"}):r===ot.DeepResearchHighLoad?p.formatMessage({id:"UrDtrS",defaultMessage:"Deep research is temporarily unavailable"}):r===ot.RateLimitReached?a.rateLimitReachedText:a.disabledText:u,side:"bottom",onOpenChange:c=>{if(c){const{hover:g}=Ti.get(o)??{},[h,f]=g??[];h&&f&&j.logEventWithStatsig(h,f,n)}},children:t})})}const Kn=({text:t})=>e.jsx("span",{children:t}),Ri=({remaining:t,reset_date:s,text:o})=>{const{locale:a}=W(),n=Lm(s,a);return e.jsxs("div",{className:"text-left",children:[e.jsx("span",{className:"block text-xs font-semibold text-token-text-tertiary",children:e.jsx(N,{id:"PromptTextarea.systemHintTooltip.remaining",defaultMessage:"{remaining} available until {resetDate}",values:{remaining:t,resetDate:n}})}),e.jsx(Kn,{text:o})]})},Lp=()=>Hd().find(t=>t.feature_name===Dm(D.Research))??null;function Hp({clientThreadId:t,showLabel:s=!1,isDisabled:o}){const a=ec(t),n=Es(),r=Ht(D.Research),{setThreadSystemHintMode:l,clearAllSystemHintModeTriggers:i}=Le(),d=!!si(),{value:p}=ve("1416952492"),u=p?ot.DeepResearchHighLoad:d?ot.RateLimitReached:void 0;return a?e.jsx("div",{style:{viewTransitionName:`var(--vt-composer-${D.Research}-action)`},children:e.jsx(Fp,{composerController:n,isThreadInSystemHintMode:r,setThreadSystemHintMode:l,clearAllSystemHintModeTriggers:i,clientThreadId:t,showLabel:s,isDisabled:o||!!u,disabledReason:u})},`system-hint-${D.Research}`):null}function Fp({composerController:t,isThreadInSystemHintMode:s,setThreadSystemHintMode:o,clearAllSystemHintModeTriggers:a,clientThreadId:n,showLabel:r=!1,isDisabled:l=!1,disabledReason:i}){const d=W(),p={clientThreadId:n},u=d.formatMessage({id:"ORxecl",defaultMessage:"Deep research"}),c=h=>{h===et.Hover?j.logEventWithStatsig(B.composerResearchButtonHovered,"composer_research_button_hovered",p):h===et.Enable?j.logEventWithStatsig(B.composerResearchButtonEnabled,"composer_research_button_enabled",p):h===et.Disable&&j.logEventWithStatsig(B.composerResearchButtonDisabled,"composer_research_button_disabled",p)},g=h=>{h.stopPropagation(),h.preventDefault(),a(),o(D.Research,!s,p),s||(t.removeSystemHints(),t.focus()),c(s?et.Disable:et.Enable)};return e.jsx(Op,{disabledReason:i,isDisabled:l,logEvent:c,children:e.jsx(Ot,{pressed:s,disabled:l,icon:e.jsx(tc,{className:"h-[18px] w-[18px]"}),label:u,animatedLabel:!r,showLabel:r||s,onClick:g,ariaLabel:u})})}function Op({children:t,isDisabled:s,disabledReason:o,logEvent:a}){const n=W(),r=si(),l=Lp(),i=n.formatMessage({id:"LtcsGJ",defaultMessage:"Get detailed insights on any topic"});let d=null;l&&l.remaining?d=e.jsx(Ri,{remaining:l.remaining,reset_date:l.reset_after,text:i}):d=e.jsx(Kn,{text:i});const p=o===ot.DeepResearchHighLoad?n.formatMessage({id:"UrDtrS",defaultMessage:"Deep research is temporarily unavailable"}):o===ot.RateLimitReached&&r?n.formatMessage({id:"T3aUKM",defaultMessage:"More available {time}"},{time:r.resets_after_text}):void 0;return e.jsx("div",{children:e.jsx(De,{className:"inline-block",sideOffset:0,label:s?p:d,side:"bottom",onOpenChange:u=>{u&&a(et.Hover)},children:t})})}function Up({clientThreadId:t,gizmoId:s,composerController:o,isDisabled:a}){const n=$e(),{value:r,isLoading:l}=Be("3780975974"),{layer:i}=Tt("2149763392");let d=vt(t);const p=jn(s),u=i.get("show-in-main-composer",!1),c=n?.isFree(),g=d==null||d?.kind===Ae.PrimaryAssistant||d?.kind===Ae.GizmoInteraction&&p,{isUnauthenticated:h}=Ce();return(h||c)&&(h||r||l)&&g&&!u?e.jsx("div",{style:{viewTransitionName:`var(--vt-composer-${D.Think}-action)`},children:e.jsx(Gp,{clientThreadId:t,composerController:o,isDisabled:a})},`system-hint-${D.Think}`):null}function Gp({clientThreadId:t,composerController:s,isDisabled:o}){const a=W(),n=!!Fd();o=o||n;const r=a.formatMessage({id:"T+qu+0",defaultMessage:"Reason"}),{setThreadSystemHintMode:l,clearAllSystemHintModeTriggers:i}=Le(),d=Ht(D.Think),p=bt.useStore(),u=Ft(),{isUnauthenticated:c}=Ce();m.useEffect(()=>{o&&u.has(D.Think)&&l(D.Think,!1,{clientThreadId:t})},[o,u,l,t]);const g=x=>{if(x.stopPropagation(),x.preventDefault(),c)return;let C=!0;p.getState().persistedSystemHints.has(D.Search)&&(C=!1),C&&i(),l(D.Think,!d,{clientThreadId:t}),d||(s.removeSystemHints(),s.focus()),d?j.logEventWithStatsig(B.composerThinkButtonDisabled,"composer_think_button_disabled",{clientThreadId:t}):j.logEventWithStatsig(B.composerThinkButtonEnabled,"composer_think_button_enabled",{clientThreadId:t})},h=c?e.jsx(wn,{location:D.Think,statsig_login_event:"chatgpt_composer_upsell_login_button_clicked",statsig_signup_event:"chatgpt_composer_upsell_signup_button_clicked",containerNoPadding:!0}):void 0,f=e.jsx(Ot,{pressed:d,disabled:o,icon:e.jsx(sc,{className:"h-[18px] w-[18px]"}),label:r,ariaLabel:r,animatedLabel:!0,showLabel:!0,onClick:g,dropdownContent:h});return e.jsx(De,{className:"inline-block",sideOffset:0,label:o?a.formatMessage({id:"Z1UTb8",defaultMessage:"Reason is unavailable"}):a.formatMessage({id:"JoBzEW",defaultMessage:"Think before responding"}),side:"bottom",onOpenChange:x=>{x&&j.logEventWithStatsig(B.composerThinkButtonHovered,"composer_think_button_hovered",{clientThreadId:t})},children:f})}const zp=["o1","o1-pro","gpt-4"];function Wp({account:t,clientBootstrapFlags:s,features:o,clientThreadId:a,currentModelConfig:n,composerController:r,isDisabled:l,gizmoId:i,hasFiles:d}){const{prospectiveModelId:p}=St(a);let u=vt(a);const c=jn(i),{userIsInSearchHoldoutWithWebDisabled:g}=ci(),h=n?.enabledTools?.includes(Wn.Search),f=u==null||u?.kind===Ae.PrimaryAssistant||u?.kind===Ae.GizmoInteraction&&c,{isUnauthenticated:x}=Ce();return x&&s?.includes(vs.AnonSearchHoldout)||!x&&(t==null||t.isFree())&&(s?.includes(vs.FreeSearchHoldout)||g)||!x&&(t==null||t.isEnterprisey())&&!o?.includes(Od.BrowsingAvailable)||!f?null:e.jsx("div",{style:{viewTransitionName:`var(--vt-composer-${D.Search}-action)`},children:e.jsx(Vp,{clientThreadId:a,composerController:r,modelSupportsSearch:h??(x||t?.isFree()||!!p&&!zp.includes(p)),isDisabled:l,disabledReason:h?d?ps.HasAttachedFiles:void 0:ps.ModelNotSupported,currentModelName:n?.title??""})},`system-hint-${D.Search}`)}function Vp({clientThreadId:t,composerController:s,isDisabled:o,disabledReason:a,currentModelName:n,modelSupportsSearch:r}){const l=W(),i=wm(),d=l.formatMessage({id:"TbHx8d",defaultMessage:"Search"}),{setThreadSystemHintMode:p,clearAllSystemHintModeTriggers:u}=Le(),c=bt.useStore(),g=Ft();o=o||!r,m.useEffect(()=>{o&&g.has(D.Search)&&p(D.Search,!1,{clientThreadId:t})},[o,g,p,t]);const h=f=>{f.stopPropagation(),f.preventDefault();let x=!0;c.getState().persistedSystemHints.has(D.Think)&&(x=!1),x&&u(),p(D.Search,!i,{clientThreadId:t}),i||(s.removeSystemHints(),s.focus()),j.logEventWithStatsig(B.composerSearchButtonClicked,"composer_search_button_clicked",{clientThreadId:t}),i&&s.trimLeadingText(/^search\b/i)};return e.jsx(qp,{analyticsMetadata:{clientThreadId:t},isThreadUsingSearchMode:i,isDisabled:o,disabledReason:a,currentModelName:n,children:e.jsx(Ot,{pressed:i,disabled:o??!1,icon:e.jsx(nc,{className:"h-[18px] w-[18px]"}),label:d,ariaLabel:d,animatedLabel:!0,showLabel:!0,onClick:h})})}function $p(){const t=wi(),s=Cn(),o=ce(ie.hasSeenComposerSearchButtonTooltip);return!o.isLoading&&o.eligible&&!t&&!s}function qp({children:t,analyticsMetadata:s,isThreadUsingSearchMode:o,isDisabled:a,disabledReason:n,currentModelName:r}){const l=$p()&&!o,i=ce(ie.hasSeenComposerSearchButtonTooltip);return l?e.jsx(Ps,{announcementKey:ie.hasSeenComposerSearchButtonTooltip,side:"right",show:!0,theme:"bright",dismissOnOutsideClick:!0,badge:"new",title:e.jsx(N,{id:"Yjduqi",defaultMessage:"Search the web"}),onDismiss:i.markAsViewed,sideOffset:0,className:"!max-w-2xs xs:!max-w-sm",description:e.jsx(N,{id:"W51Aei",defaultMessage:"Get fast answers with trusted sources. {learnMore}",values:{learnMore:e.jsx(oc,{href:"https://openai.com/index/introducing-chatgpt-search",className:"underline",children:e.jsx(N,{id:"stA7F4",defaultMessage:"Learn more"})})}}),children:e.jsx("div",{children:t})}):e.jsx("div",{children:e.jsx(De,{className:"inline-block",sideOffset:0,label:a?n===ps.ModelNotSupported?e.jsx(N,{id:"GZemJe",defaultMessage:"Search disabled for {modelName}",values:{modelName:`${r}`}}):n===ps.HasAttachedFiles?e.jsx(N,{id:"Wd1fc2",defaultMessage:"Search disabled for attachments"}):e.jsx(N,{id:"GpDAWD",defaultMessage:"Search is unavailable"}):e.jsx(N,{id:"c+4o2s",defaultMessage:"Search the web"}),side:"bottom",onOpenChange:d=>{d&&j.logEventWithStatsig(B.composerSearchButtonHovered,"composer_search_button_hovered",s)},children:t})})}const Kp=1;function Ii({value:t=Kp,size:s,onStateChange:o}){return e.jsx("div",{className:"relative flex h-full w-full flex-col items-center justify-center",children:e.jsxs(U.div,{animate:{translateY:t>1&&s==="small"?-1:0},onAnimationStart:()=>o?.("animating"),onAnimationComplete:()=>o?.("idle"),className:R("relative",s==="small"?"h-5 w-5":"h-8 w-8"),children:[e.jsx(U.div,{style:{transformOrigin:"50% 100%",translateY:s==="large"?3:0},animate:{scale:t>1&&s==="small"?.85:1},className:"absolute left-0 top-0",children:e.jsx(ac,{className:R(s==="small"?"h-5 w-5":"h-8 w-8")})}),e.jsx(U.div,{initial:{scale:s==="small"?.9:1.1,opacity:0},animate:{scale:s==="large"?1.1:t>1?1:.9,opacity:t>1?1:0},style:{translateY:s==="large"?-1:0},className:"absolute left-0 top-0",children:e.jsx(ic,{className:R(s==="small"?"h-5 w-5":"h-8 w-8")})}),e.jsx(U.div,{initial:{scale:s==="small"?.9:1.1,opacity:0},animate:{scale:s==="large"?1.1:t>2?1:.9,opacity:t>2?1:0},style:{translateY:s==="large"?-1:0},className:"absolute left-0 top-0",children:e.jsx(rc,{className:R(s==="small"?"h-5 w-5":"h-8 w-8")})})]})})}function Yp(t){const{reasoningLevelTypes:s,reasoningLevelType:o}=t,{ReasoningLevels:a}=s;let n=1;return o===a.medium.type?n=2:o===a.high.type&&(n=3),e.jsx("div",{className:R("relative flex h-5 w-5 items-center justify-center",n>1&&"text-blue-1000"),children:e.jsx(Ii,{size:"small",value:n})})}const Jp=({isManualModelSelection:t,animatedLabel:s,reasoningLevelTypes:o,reasoningLevelType:a,modelName:n,onResetReasoningLevel:r,onReasoningLevelChanged:l,type:i})=>{const[d,p]=m.useState(!1),u=va(),{reasoningLevel:c}=lc({reasoningLevelTypes:o,reasoningLevelType:a}),g=a!=="low"||t||!1;return e.jsxs("div",{className:R("inline-flex h-9 rounded-full border text-[13px] font-medium radix-state-open:bg-black/10",g?"border-transparent bg-[#DAEEFF] text-blue-1000 can-hover:hover:bg-[#BDDCF4] dark:bg-[#2A4A6D] dark:text-[#48AAFF] dark:can-hover:hover:bg-[#1A416A]":"border-token-border-light text-token-text-secondary focus-visible:outline-black can-hover:hover:bg-token-main-surface-secondary dark:focus-visible:outline-white dark:can-hover:hover:bg-gray-700",d&&"duration-75 motion-safe:transition-all"),children:[e.jsxs("div",{className:"flex h-full min-w-8 items-center justify-center p-2","aria-pressed":g,onTransitionEnd:()=>p(!1),onClick:h=>{i==="think"&&!t&&(h.stopPropagation(),h.preventDefault(),l(a==="low"?"medium":"low"))},children:[e.jsx(Yp,{reasoningLevelTypes:o,reasoningLevelType:a}),s&&e.jsx(ge,{initial:!1,children:e.jsx(U.span,{initial:{x:-10,width:0,opacity:0},animate:{x:0,width:"fit-content",opacity:1},exit:{x:-10,width:0,opacity:0},transition:{ease:"easeOut",duration:u?0:.15},children:e.jsx("div",{className:"whitespace-nowrap pl-1 pr-1",children:t?n:c?.shortLabel})})}),!t&&i==="auto"&&!g&&e.jsx(on,{className:"h-[18px] w-[18px]"})]}),g&&(t||i!=="think")?e.jsx("div",{className:"mt-[1px] border-l border-token-border-light p-2",style:{borderColor:g?"#0285FF0D":void 0},onClick:h=>{h.stopPropagation(),h.preventDefault(),r()},children:e.jsx(ei,{"aria-label":"",className:"h-[16px] w-[16px]"})}):i==="think"?e.jsx("div",{className:"border-l border-token-border-light p-2",style:{borderColor:g?"#0285FF0D":void 0},children:e.jsx(on,{className:"h-[18px] w-[18px]"})}):null]})},fn=({children:t,origin:s,...o})=>{const a=_s(),{isOpen:n,closePopover:r,layoutMode:l,popoverContentRef:i}=kn(),[d,p]=m.useState(l);return m.useEffect(()=>{if(n)return cc(r,i)},[n,i,r]),e.jsx(As,{forceMount:!0,children:e.jsx(Ns,{forceMount:!0,asChild:!0,align:"center",sideOffset:-35,onEscapeKeyDown:r,onClick:u=>{u.stopPropagation(),u.preventDefault()},onOpenAutoFocus:u=>{u.preventDefault()},...o,children:e.jsx("div",{ref:i,className:R(!n&&"pointer-events-none"),children:e.jsx(ge,{mode:d==="centered"?"popLayout":"sync",onExitComplete:()=>p(l),children:n&&e.jsx(U.div,{className:R("flex overflow-clip rounded-2xl border border-token-border-xlight bg-token-main-surface-primary shadow-2xl backdrop-blur-2xl dark:border-white/5 dark:bg-token-main-surface-secondary dark:shadow-[0px_24px_64px_rgba(0,0,0,0.32)]"),variants:{open:{scale:[.7,1],opacity:1,transition:a?Te:gs},closed:{opacity:0,scale:.8,transition:a?Te:{...gs,duration:.2}}},initial:"closed",animate:"open",exit:"closed",style:{transformOrigin:s||(d==="centered"?"top left":"bottom left")},children:t})})})})})},Qp=({as:t="div",children:s,className:o,isSelected:a=!1,shape:n="rectangle",spacing:r="normal",...l})=>{const i=t==="div"?U.div:U.button;return e.jsx(i,{className:R("relative -ml-1 flex min-h-8 cursor-pointer select-none flex-row items-center justify-center gap-1 whitespace-nowrap rounded-3xl border border-transparent py-1 font-medium *:pointer-events-none","hover:border-black/0 can-hover:hover:bg-black/5 motion-safe:transition-colors dark:can-hover:hover:bg-white/5","[font-size:var(--pill-font-size,14px)]",r==="compact"&&n==="round"&&"px-2",r==="compact"&&n==="rectangle"&&"px-2.5",r==="normal"&&n==="rectangle"&&"px-3.5",a?"bg-black/[0.045] can-hover:hover:!bg-black/[0.075] dark:bg-white/5 dark:text-token-composer-blue-text dark:can-hover:hover:!bg-white/10":"[color:var(--pill-color,var(--text-secondary))] hover:border-black/0 can-hover:hover:bg-black/5 motion-safe:transition-colors dark:can-hover:hover:bg-white/5",o),...l,children:s})},Bi=({children:t,className:s,isSelected:o=!1,onClick:a,tooltipLabel:n,...r})=>{const{isOpen:l,openPopover:i,popoverTriggerRef:d}=kn(),[p,u]=m.useState(!1),c=m.useCallback(h=>{(h.key==="Enter"||h.key===" ")&&(h.preventDefault(),i())},[i]),g=m.useCallback(h=>{a?.(h),!h.defaultPrevented&&i()},[a,i]);return e.jsx(De,{sideOffset:0,open:p&&!l,label:n,children:e.jsx(xt,{asChild:!0,children:e.jsx(Qp,{animate:l?"inactive":"active",as:"div",role:"button",className:R("group motion-safe:[transition:border-color_0.1s_ease-in-out]",s),isSelected:o,"data-reasoning-popover-action":!0,onClick:g,onKeyDown:c,ref:d,tabIndex:0,onPointerEnter:()=>{u(!0)},onPointerLeave:()=>{u(!1)},onClickCapture:()=>{u(!1)},...r,children:t})})})};function Xp(t=!1){const[s,o]=m.useState(t),[a,n]=m.useState(!1);return{isOpen:s,isStartingToOpen:a,setIsOpen:o,setIsStartingToOpen:n}}function ht({layoutMode:t,initialOpen:s=!1,forceOpen:o=!1,restoreFocus:a,children:n,onClose:r}){const{isOpen:l,isStartingToOpen:i,setIsOpen:d,setIsStartingToOpen:p}=Xp(s||o),u=o||l,c=m.useRef(null),g=m.useRef(null),h=m.useCallback(()=>{u||(d(!0),uc(),requestAnimationFrame(()=>{p(!0),dc({root:c.current,autoFocus:!0})}))},[d,p,u]),f=m.useCallback(()=>{!i&&!u||(d(!1),p(!1),requestAnimationFrame(()=>{const v=new Event("focus");a?.(v),v.defaultPrevented||g.current?.focus()}),r?.())},[r,d,p,i,u,a]),x=v=>{v?h():f()},C={Trigger:{type:xt,instance:null},Content:{type:fn,instance:null}};return m.Children.forEach(n,v=>{if(m.isValidElement(v))if(v.type===Bi||v.type===xt){if(C.Trigger.instance)throw new Error("Only one trigger is allowed");C.Trigger.instance=v}else v.type===fn&&(C.Content.instance=v)}),e.jsx(mc,{value:{closePopover:f,isOpen:u,isStartingToOpen:i,layoutMode:t,openPopover:h,popoverContentRef:c,popoverTriggerRef:g},children:e.jsxs(Ms,{open:u,onOpenChange:x,children:[C.Trigger.instance,C.Content.instance]})})}ht.BaseTrigger=xt;ht.Trigger=Bi;ht.Content=fn;const Zp={modelPickerOpen:{maxHeight:375,width:300},modelPickerClosed:{maxHeight:245,width:245}},eg=({clientThreadId:t,reasoningLevelTypes:s,reasoningLevelType:o,onReasoningLevelChanged:a,isManualModelSelection:n,currentModelId:r,onModelSelection:l,resetReasoningLevel:i})=>{const d=W(),p=at(),{isStartingToOpen:u,layoutMode:c,closePopover:g}=kn(),h=$e(),f=!h?.isFree(),{reasoningLevelList:x,reasoningLevelsByValue:C}=s,v=x.find(P=>P.type===o),w=m.useRef(!1),E=m.useRef(!1),T=m.useRef(null),M=m.useRef(!1),_=m.useRef(!1),[L,A]=m.useState(n),b=Et(P=>P.threads[t]?.isManualModelSelection),F=e.jsxs("button",{onClick:P=>{P.preventDefault(),f?(A(!L),b&&i()):We(p,"Model picker upsell")},className:"mt-2 flex cursor-pointer items-center gap-0.5 rounded-lg py-1.5 pl-3 pr-1.5 font-medium hover:bg-token-main-surface-tertiary",children:[e.jsx("div",{className:"text-pretty text-xs text-token-text-secondary",id:f?"view-all-models-toggle":"model-picker-upsell",children:f?d.formatMessage({id:"Ds350e",defaultMessage:"Choose a model"}):d.formatMessage({id:"enYanc",defaultMessage:"Upgrade for smarter answers"})}),e.jsx(ni,{className:"h-4 w-4 text-token-text-tertiary"})]});return e.jsxs(U.div,{className:R("max-h-[max(calc(var(--radix-popover-content-available-height)-64px), 245px)] flex snap-y snap-proximity overflow-y-auto scroll-smooth [scrollbar-gutter:stable]",c==="centered"&&"origin-center flex-col",c==="bottom"&&"flex-col-reverse"),animate:L?"modelPickerOpen":"modelPickerClosed",transition:us,variants:Zp,children:[!L&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:R("relative mx-4 flex flex-col items-center rounded-3xl bg-token-border-xlight",c==="bottom"?"mb-4":"mt-4"),children:[e.jsx("datalist",{id:"juice-level-markers",className:"pointer-events-none absolute inset-0 z-[-1] flex items-center justify-between px-3.5",children:x.map((P,O)=>e.jsx("option",{value:P.value,className:R("aspect-square h-1.5 overflow-hidden rounded-full bg-black/10 text-transparent [min-block-size:6px] dark:bg-white/10",O===0&&"translate-x-1.5",O===x.length-1&&"-translate-x-1.5"),label:P.label},P.type))}),e.jsx("input",{type:"range",id:"juce-level",name:"juice-level",className:R(pc.rangeSelector,"h-8 w-full cursor-pointer touch-pan-y appearance-none rounded-2xl bg-transparent px-1"),style:{"--slider-thumb-translate-x":u?"0px":v.type==="medium"?0:v.type==="low"?"45px":"-45px"},min:"0",step:"1",tabIndex:0,max:"2",value:v.value,onKeyDown:P=>{(P.key==="Escape"||P.key===" "||P.key==="Enter")&&(_.current?M.current=!0:g())},onClick:()=>{Date.now()-(T.current??0)>200&&(E.current=!0)},onPointerDown:()=>{E.current=!1,T.current=Date.now()},onPointerUp:()=>{w.current&&(_.current?M.current=!0:requestAnimationFrame(()=>{E.current&&g()}))},onChange:P=>{const O=P.target.value,y=C.get(parseInt(O));y&&(a(y.type),w.current=!0)},list:"juice-level-markers"})]}),e.jsx("div",{className:"mx-4",children:e.jsxs("div",{className:"text-md my-4 flex flex-col items-center justify-center text-black dark:text-white",children:[e.jsx("div",{className:"relative flex h-10 w-10 items-center justify-center overflow-clip",children:e.jsx(Ii,{value:v.value+1,size:"large",onStateChange:P=>{P==="idle"?(_.current=!1,M.current&&(M.current=!1)):P==="animating"&&(_.current=!0)}})}),e.jsx("label",{htmlFor:"juice-level-label",className:"my-1.5 font-semibold tracking-[-0.32px] [font-size:16px]",children:e.jsxs("span",{className:"flex items-center gap-1",children:[v.label,v.type==="high"&&h?.isFree()&&e.jsx("span",{className:"self-center rounded-2xl border border-token-border-medium bg-token-main-surface-primary px-1.5 py-0.5 text-[10px] font-semibold leading-normal text-token-text-secondary",children:d.formatMessage(gc.plusName)})]})}),e.jsx("div",{className:"mb-2 max-w-[215px] text-balance px-2 text-center text-xs font-normal text-token-text-secondary",children:v.description}),F]})})]}),e.jsx(ge,{children:L&&f&&e.jsx(tg,{clientThreadId:t,setIsModelPickerOpen:A,isModelPickerOpen:L,currentModelId:r,onModelSelection:l,closePopover:g})})]})},tg=({clientThreadId:t,currentModelId:s,onModelSelection:o,closePopover:a,setIsModelPickerOpen:n})=>{const r=W(),{data:l}=Vn(),i=hc({clientThreadId:t}),{hasInternalModels:d}=fc();return e.jsxs(U.div,{initial:{clipPath:"inset(0 100% 0 0)",opacity:0},animate:{clipPath:"inset(0 0% 0 0)",opacity:1},exit:{clipPath:"inset(0 100% 0 0)",opacity:0},transition:gs,className:"flex flex-col",children:[e.jsxs("div",{className:"sticky left-0 top-0 z-10 flex w-full flex-row items-center justify-center overflow-clip border-b border-token-border-xlight bg-token-main-surface-primary px-3 py-3 dark:bg-token-main-surface-secondary",children:[e.jsx("button",{onClick:()=>{n(!1)},className:"flex items-center rounded-md p-1 hover:bg-token-main-surface-tertiary",children:e.jsx(xc,{className:"h-5 w-5 text-token-text-secondary"})}),e.jsx("div",{className:"flex-auto text-center text-sm font-medium",children:r.formatMessage({id:"j6WEI7",defaultMessage:"Choose a model"})}),e.jsx("div",{className:"w-5"})]}),e.jsxs("div",{className:"flex w-full flex-col py-2",children:[d&&e.jsxs(e.Fragment,{children:[e.jsx(bc,{modelsData:l,clientThreadId:t,triggerButton:e.jsx(Sc,{className:"relative",children:e.jsxs("div",{className:"mb-1 flex items-center px-1",children:[e.jsx("div",{className:"text-sm",children:r.formatMessage({id:"lfH4U6",defaultMessage:"Internal Models"})}),e.jsx(ni,{className:"icon-md absolute right-1 w-7 text-token-text-tertiary"})]})})}),e.jsx("div",{className:"mx-4 mt-2 h-px bg-token-border-xlight"})]}),l?.categories?.map(p=>{const u=p?.defaultModel;return e.jsx(vc,{model:p,modelSwitcherDenialsBySlug:i,isSelected:u===s,onClick:()=>{o(u),a()}},u)})]})]})},sg=({clientThreadId:t,layoutMode:s,currentModel:o,category:a,type:n,...r})=>{const l=Et(A=>A.threads[t]?.isManualModelSelection),i=$e(),d=at(),p=m.useMemo(()=>{const A=o?.id??"";return Aa.includes(A)?"low":Na.includes(A)?"medium":Pa.includes(A)?"high":"low"},[o?.id]),u=yc(),c=ft(),g=Et(A=>A.setManualModelSelection),[h,f]=m.useState(p),x=m.useCallback(A=>{g(t,!1),requestAnimationFrame(()=>{requestAnimationFrame(()=>{const b=an[A];f(A),c({location:"PromptTextarea",modelId:b})})})},[t,g,c]),C=A=>{const b=o?.id??"";A&&(j.logEvent(B.modelSwitcherModelChanged,{from:b,to:A,source:"popover"}),Rt.logEvent("chatgpt_model_switcher_model_changed",A,{from:b,to:A,source:"popover"}),c({modelId:A,location:"Model switcher menu item"}),A!==Cc&&i&&qo(A),g(t,!0))},v=!ds.includes(o?.id??""),w=l||v,T=(a?.label&&a?.label?.length<10?a?.label:a?.shortLabel)??o?.title??"",M=o?.id??"",_=()=>{x("low"),g(t,!1),qo(an.low)},L=m.useCallback(()=>{const{reasoningLevelList:A}=u,F=(A.findIndex(P=>P.type===p)+1)%A.length;x(A[F].type)},[x,p,u]);return m.useEffect(()=>Ud(Rm,{cycleReasoningLevel:L}),[L]),e.jsxs(ht,{layoutMode:s,...r,onClose:()=>{p!==h&&i?.isFree()&&h==="high"&&(We(d,"Model picker upsell"),f(p))},children:[e.jsx(ht.BaseTrigger,{children:e.jsx(Jp,{isManualModelSelection:w,modelName:T,animatedLabel:!0,reasoningLevelTypes:u,reasoningLevelType:p,onResetReasoningLevel:_,onReasoningLevelChanged:x,type:n})}),e.jsx(ht.Content,{origin:s==="centered"?"top left":"bottom left",align:"start",children:e.jsx(eg,{clientThreadId:t,reasoningLevelTypes:u,reasoningLevelType:h,onReasoningLevelChanged:x,modelName:T,isManualModelSelection:w,currentModelId:M,onModelSelection:C,resetReasoningLevel:_})})]})},ng=5,og=m.memo(function(s){return ag(s),ig(s),rg(),null});function ag(t){const{store:s}=ke(),o=s.useSetSharedProps();dn(()=>{o(t)},[t,o])}function ig(t){const{clientThreadId:s,canContinue:o}=t,{store:a}=ke(),n=m.useRef({top:a.useContentAreaApi(Pt.HeaderTop),bottom:a.useContentAreaApi(Pt.HeaderBottom)}).current,r=wc(s),{shouldShowBannerSignup:l,shouldShowBannerTermsDisclaimer:i}=lg(s),d=qm(s),p=jc(t),u=wd(t),c=wi(),g=Cn(),h=kc(),f=jd(t),x=Km(s),C=_c(),v=Mc(t),w=Ac(s),E=Nc(s),T=Pc(),{eligible:M}=ce(Hc),_=Ec(),L=Tc(),A=Rc(),b=Ic(),F=Bc(),P=Zm(s),O=re(s,k=>k?.modelId),y=vt(s);dn(()=>{O&&y?.kind===Ae.GizmoInteraction&&y.gizmo&&Fc(O,y.gizmo)?n.top.set(I.ProjectConversationTaskNoFileAccess):v.eligible?n.top.set(I.AdvancedVoiceOnMobileAnnouncement):C?n.top.set(I.ParagenControls):i?n.top.set(I.BannerTermsDisclaimer):d?n.top.set(I.BannersRateLimit):F?n.top.set(I.BannerPlusUpsell):P?n.top.set(I.ContextualAnswersAdminUpsell):w?n.top.set(I.JawboneAnnouncement):E?n.top.set(I.JawboneMaxActiveAnnouncement):p.eligible?n.top.set(I.BannerSidekickAnnouncement):c?n.top.set(I.MemoryInSearchAnnouncement):g?n.top.set(I.MoonshineAnnouncement):h?n.top.set(I.CustomizeChatGPTAnnouncement):u?n.top.set(I.SearchBrowserExtensionAnnouncement):f?n.top.set(I.SearchBrowserExtensionReactiveAnnouncement):T?n.top.set(I.PromoRedemptionAnnouncement):M?n.top.set(I.OperatorAnnouncement):A?n.top.set(I.ReferralProgramUpsellAnnouncement):o?n.top.set(I.PromptTextareaAction):l?n.top.set(I.BannerSignup):x?n.top.set(I.BannerMemoryFull):_?n.top.set(I.ReferrerRedemptionAvailableAnnouncement):L?n.top.set(I.RefereeRedemptionAvailableAnnouncement):b?n.top.set(I.StudentsUpsellAnnouncement):n.top.set(null)},[n,o,i,l,d,p,x,C,v]),dn(()=>{r&&n.bottom.set(ja.DallePromptControls)},[n,r])}function rg(){const{store:t}=ke();m.useEffect(()=>()=>{t.reset()},[t])}function lg(t){const{isUnauthenticated:s}=Ce(),{layer:o}=Gd("3637408529"),{layer:a}=Tt("3637408529"),n=a.get("no_auth_banner_signup_rate_limit",ng),r=o.get("should_show_no_auth_signup_banner",!0),l=Dc(c=>c.bannerDisclaimerClientThreadId),i=Lc(),d={shouldShowBannerTermsDisclaimer:!1,shouldShowBannerSignup:!1},[p,u]=re(t,c=>[X.getConversationTurns(c).filter(g=>g.role===zn.User).length,cg(X.getCurrentNode(c)?.message)]);return t&&(d.shouldShowBannerTermsDisclaimer=u&&s&&p===1&&!i&&(l==null||l===t),d.shouldShowBannerSignup=r&&u&&s&&p>0&&p%n===0),d}function cg(t){return t?.author.role===zn.Assistant&&zd(t)}const ys=D.PictureV2,ug=["o1","o3-mini","o3-mini-high","o1-pro"];function dg({clientThreadId:t,composerController:s,currentModelConfig:o,currentModelConfigLoading:a,disableIfNoAccess:n}){const{prospectiveModelId:r}=St(t),{value:l}=Be("2868048419"),d=null!=null;let p=vt(t);const u=p==null||p?.kind===Ae.PrimaryAssistant,{isUnauthenticated:c}=Ce(),g=!c,h=o?.enabledTools?.includes(Wn.ImageGen),f=r&&ug.includes(r),x=g&&l&&!d&&u,C=h??(a&&!f);return x&&(C||n)?e.jsx("div",{style:{viewTransitionName:`var(--vt-composer-${ys}-action)`},children:e.jsx(mg,{clientThreadId:t,composerController:s,disabled:n&&!C})},`system-hint-${ys}`):null}function mg({clientThreadId:t,composerController:s,disabled:o}){const n=fi(s)===ys,r=W(),l=bi(r),i=r.formatMessage({id:"rh3NHv",defaultMessage:"Create image"}),d=r.formatMessage({id:"Uh+8Ls",defaultMessage:"Visualize ideas and concepts"}),{clearAllSystemHintModeTriggers:p}=Le(),u=g=>{g.stopPropagation(),g.preventDefault(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{p(),n?s.removeSystemHints():s.addSystemHint(ys,i),s.focus()})}),s.setAutocompletions(l),n?j.logEventWithStatsig(B.composerThinkButtonDisabled,"composer_create_image_button_disabled",{clientThreadId:t}):j.logEventWithStatsig(B.composerThinkButtonEnabled,"composer_create_image_button_enabled",{clientThreadId:t})},c=e.jsx(Ot,{pressed:n,icon:e.jsx(Oc,{className:"h-[18px] w-[18px]"}),label:i,ariaLabel:i,animatedLabel:!0,showLabel:!0,onClick:u,disabled:!!o});return e.jsx(De,{className:"inline-block",sideOffset:0,label:d,side:"bottom",onOpenChange:g=>{g&&j.logEventWithStatsig(B.composerCreateImageButtonHovered,"composer_create_image_button_hovered",{clientThreadId:t})},children:c})}function pg({usage:t}){const s={work:{icon:Wc,color:"#35AE47"},school:{icon:Vc,color:"#E937D1"},personalTasks:{icon:$c,color:"#EA8444"},funAndEntertainment:{icon:qc,color:"#6C71FF"},justCurious:{icon:Kc,color:"#FFCC00"}},o=s[t].icon,a=s[t].color;return e.jsx(o,{className:"icon-md",style:{color:a}})}function hh({clientThreadId:t}){const s=W(),o=gi({clientThreadId:t});return m.useEffect(()=>{Rt.logEvent("chatgpt_convo_onboarding_usage_chips_shown")},[]),e.jsx(ge,{mode:"wait",children:e.jsx(U.div,{className:"-mx-6 mt-2 flex flex-wrap gap-2 px-6",initial:{opacity:0},animate:{opacity:1,transition:{delay:.2,ease:"easeInOut"}},exit:{opacity:0,transition:{ease:"easeInOut"}},children:["school","work","personalTasks","funAndEntertainment","justCurious"].map(a=>e.jsxs("button",{className:"inline-flex h-[42px] items-center justify-start gap-2 rounded-[25px] border border-token-border-light bg-token-main-surface-primary px-4 py-3 hover:bg-token-main-surface-secondary",onClick:n=>{o({sourceEvent:n,stepPrompt:s.formatMessage(It[`${a}Prompt`]),messageMetadata:{onboarding:{main_usages:[{usage:a}]},is_starter_prompt:!0,suggestion_type:mt.Starter}}),Rt.logEvent("chatgpt_convo_onboarding_usage_chip_clicked",null,{usage:a})},children:[e.jsx("div",{"data-svg-wrapper":!0,className:"relative",children:e.jsx(pg,{usage:a})}),e.jsx("div",{className:"font-['SF Pro'] text-[13px] font-normal leading-[18px] text-token-text-primary opacity-90",children:s.formatMessage(It[a])})]},a))})})}function fh({clientThreadId:t,examples:s}){const o=gi({clientThreadId:t}),a=[Uc,Gc,zc],n=W();return m.useEffect(()=>{Rt.logEvent("chatgpt_convo_onboarding_examples_shown")},[]),e.jsx(ge,{mode:"wait",children:e.jsxs("div",{children:[e.jsx(U.p,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3,ease:"easeInOut"},className:"text-base text-token-text-primary",children:n.formatMessage(It.tryAnExample)}),e.jsx("ul",{className:"-mx-6 flex list-none flex-nowrap gap-6 overflow-auto px-6 py-4",children:s.map((r,l)=>e.jsx(U.li,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:(l+1)*.2,duration:.3},children:e.jsxs("button",{className:"inline-flex h-60 w-[222px] flex-col items-center justify-start overflow-hidden rounded-2xl bg-token-main-surface-primary outline outline-token-border-xlight transition-all duration-300 hover:shadow-lg hover:shadow-token-border-light",onClick:i=>{o({sourceEvent:i,stepPrompt:r.example,messageMetadata:{onboarding:{triggered_tools:[r.feature]},is_starter_prompt:!0,suggestion_type:mt.Starter}}),Rt.logEvent("chatgpt_convo_onboarding_example_clicked",null,{tool:r.feature})},children:[e.jsx("img",{src:a[l%a.length].src,className:"h-[160px] w-full object-cover",alt:n.formatMessage({id:"chatgpt.new-onboarding.example-prompt",defaultMessage:"Example prompt"})}),e.jsx("div",{className:"inline-flex h-20 w-full gap-1 p-4",children:e.jsx("div",{className:"line-clamp-2 shrink grow basis-0 text-start text-base leading-normal text-token-text-primary",title:r.title,children:r.title})})]})},r.feature))})]})})}function gg({clientThreadId:t,children:s}){const{isEligible:o,markAsViewed:a}=hi(t),n=W();return m.useEffect(()=>{o&&rn.showAnnouncementTooltipExclusively(ie.hasSeenFilePickerNuxTooltip,!0)},[o]),o?e.jsx(Ps,{announcementKey:ie.hasSeenFilePickerNuxTooltip,show:!0,side:"top",align:"start",theme:"bright",dismissOnOutsideClick:!0,badge:"none",title:n.formatMessage(It.tryUploadingAFile),description:n.formatMessage(It.uploadFileExample),onDismiss:a,sideOffset:0,children:s}):s}const Di=({clientThreadId:t,rateLimitPopup:s,children:o,disabled:a,highlightTooltip:n=!1,disabledReason:r,currentModelName:l})=>{const i=W(),d=re(t,X.getIsNewConversation),p=$e(),u=f=>{s!=null&&f&&j.logPopoverHover({type:"rate_limit",location:"file_upload",plan_type:p?.planType??"unknown"})},c=bn(Ie.signUpButtonText),{isEligible:g}=hi(t),h=!!s;return e.jsx(e.Fragment,{children:h?e.jsx("div",{className:"h-8",children:e.jsxs(Wd,{delayDuration:150,onOpenChange:u,children:[e.jsx(Vd,{asChild:!0,children:o}),e.jsx($d,{children:e.jsx(ti,{$as:qd,side:"left",sideOffset:0,align:"start",alignOffset:-12,className:"max-w-[320px]",children:e.jsx(hg,{isNewConversation:d,rateLimitPopup:s,signUpButtonText:c})})})]})}):!a&&g?e.jsx(gg,{clientThreadId:t,children:o}):e.jsx(De,{sideOffset:0,label:a?r===Re.ModelNotSupported?i.formatMessage({id:"pEB4vw",defaultMessage:"Attachments disabled for {modelName}"},{modelName:`${l}`}):r===Re.ThinkModeInUse?i.formatMessage({id:"NRk4QL",defaultMessage:"Attachments disabled for Reason mode"}):r===Re.SearchModeInUse?i.formatMessage({id:"YlO80p",defaultMessage:"Attachments disabled for Search mode"}):i.formatMessage({id:"9Wgi7B",defaultMessage:"Attach files is unavailable"}):i.formatMessage({id:"wkpQmi",defaultMessage:"Upload files and more"}),className:"flex",open:n?!0:void 0,side:"bottom",children:o})})},hg=({isNewConversation:t=!1,rateLimitPopup:s,signUpButtonText:o})=>{const a=$e(),n=at(),r=Cs(),l=ws(),i=Bt();if(s==null)return null;const{call_to_action:d,description:p}=s,u=p||e.jsx(N,{...ma.defaultDescription}),c=d?.includes(ee.GET_PLUS),g=d?.includes(ee.AUTHENTICATE),h=g&&i;return e.jsxs("div",{className:"p-2 text-sm text-token-text-primary",children:[e.jsx("div",{className:"mb-3",children:u}),c?e.jsx(Ve,{size:"small",color:"secondary",onClick:()=>{We(n,"Rate limited file upload popover"),j.logRateLimitGetPlusButtonClicked({type:"file_upload",location:"popover",plan_type:a?.planType??"unknown",is_hard_block:!1,is_new_conversation:t,hard_block_reason:""})},children:e.jsx(N,{...ma.getPlus})}):null,g?e.jsx(Ve,{size:"small",color:"primary",onClick:()=>{r({authType:l?"login":"signup",callback:f=>{l?j.logLogInButtonClicked({location:"File picker rate limit tooltip",provider:f}):j.logSignUpButtonClicked({location:"File picker rate limit tooltip",provider:f})}})},children:l?e.jsx(N,{...Ie.logInButtonText}):e.jsx(N,{...o})}):null,h?e.jsx(Ve,{size:"small",color:"secondary",className:"ml-2",onClick:()=>{r({authType:l?"signup":"login",callback:f=>{l?j.logSignUpButtonClicked({location:"File picker rate limit tooltip",provider:f}):j.logLogInButtonClicked({location:"File picker rate limit tooltip",provider:f})}})},children:l?e.jsx(N,{...o}):e.jsx(N,{...Ie.logInButtonText})}):null]})},ma=ye({defaultDescription:{id:"U5qAWP",defaultMessage:"You've reached your daily upload limit. Get ChatGPT Plus to unlock more."},getPlus:{id:"TeyLcp",defaultMessage:"Get Plus"}});function Li({clientThreadId:t,getInputProps:s,openFileDialog:o,uploadType:a,icon:n,isDisabled:r=!1,isSmall:l=!1,showLabel:i=!1,showUpsell:d=!1,hideBorder:p=!1,highlightTooltip:u=!1,disabledReason:c,currentModelName:g}){const h=W(),f=Ts();r=(r||!!f)&&!d;const x=e.jsxs(Ea,{disabled:r,$showLabel:i,$hideBorder:p,$isSmall:l,onClick:w=>{if(w.preventDefault(),d){j.logNoAuthAttachButtonClicked({location:"No auth upsell"});return}j.logEvent(B.openFileViewer,{intent:a.toString()}),o()},"aria-label":r?c===Re.ModelNotSupported?h.formatMessage({id:"pEB4vw",defaultMessage:"Attachments disabled for {modelName}"},{modelName:`${g}`}):c===Re.ThinkModeInUse?h.formatMessage({id:"NRk4QL",defaultMessage:"Attachments disabled for Reason mode"}):c===Re.SearchModeInUse?h.formatMessage({id:"YlO80p",defaultMessage:"Attachments disabled for Search mode"}):h.formatMessage({id:"PromptFilePicker.attachFilesUnavailable",defaultMessage:"Attach files is unavailable"}):h.formatMessage({id:"PromptFilePicker.attachFiles",defaultMessage:"Upload files and more"}),children:[n,i&&e.jsx(Ta,{})]}),C=e.jsx("input",{disabled:r,...s({className:"hidden"})}),v=e.jsxs("div",{className:"flex",children:[x,C]});return d?e.jsx(De,{sideOffset:0,label:e.jsx(N,{id:"wkpQmi",defaultMessage:"Upload files and more"}),side:"bottom",open:u||void 0,children:e.jsx(Kd,{triggerButton:v,sideOffset:0,alignOffset:0,children:e.jsx(wn,{location:"attach",statsig_login_event:"chatgpt_composer_upsell_login_button_clicked",statsig_signup_event:"chatgpt_composer_upsell_signup_button_clicked"})})}):e.jsx(Di,{disabled:r,clientThreadId:t,rateLimitPopup:f,highlightTooltip:u,children:v})}function fg({code:t,message:s}){switch(t){case Ko.FileTooLarge:return pa.errorFileTooLarge;case Ko.TooManyFiles:return j.logEvent(B.uploadedMaxFilesError),pa.errorTooManyFiles;default:return s}}const pa=ye({attachImages:{id:"PromptFilePicker.attachImages",defaultMessage:"Attach images"},attachFiles:{id:"PromptFilePicker.attachFiles",defaultMessage:"Upload files and more"},errorFileTooLarge:{id:"PromptFilePicker.errorFileTooLarge",defaultMessage:"Your file is too large. The maximum file size is {size}MB."},errorTooManyFiles:{id:"PromptFilePicker.errorTooManyFiles",defaultMessage:"You may only upload {maxNum} files at a time."},defaultFileUploadRateLimited:{id:"U5qAWP",defaultMessage:"You've reached your daily upload limit. Get ChatGPT Plus to unlock more."},getPlusButton:{id:"TeyLcp",defaultMessage:"Get Plus"}}),ga=ye({dragInstructions:{id:"FileDropZone.dragInstructions",defaultMessage:"Add anything"},dragAllAccepted:{id:"FileDropZone.dragAllAccepted",defaultMessage:"Drop any file here to add it to the conversation"}});function xg(t){if(!t.accept||Object.keys(t.accept).length===0)return[];const s=[];return Object.values(t.accept).forEach(o=>s.push(...o)),s.sort()}function xh(t){const{className:s,children:o,clientThreadId:a,currentModelConfig:n,noKeyboard:r}=t,l=W(),i=Dt(),d=vt(a),p=Ft(),u=hs(n,d,p),c=u!==st.None,g=ln(_=>_.files),h=(u===st.Multimodal?_n:Mn)-g.length,f=h<=0,{getGizmoId:x}=An(),{handleFileAccepted:C}=Jn(l,u,Pn(n,d),"drag",x,Nn(n,d)?.attachments),v=Ts(),w=En(Tn(n,d)),{getRootProps:E,isDragActive:T}=Rn({maxFiles:h,disabled:!c||f||v!=null,noClick:!0,noKeyboard:r,onDropAccepted:C,onDropRejected:_=>Yn(_,l,i,u),multiple:!0,maxSize:In,...w}),M=xg(w);return e.jsxs("div",{...E({className:s}),children:[o,T&&e.jsxs(bg,{children:[e.jsx(Yc,{}),e.jsx("h3",{children:e.jsx(N,{...ga.dragInstructions})}),e.jsx("h4",{className:"w-2/3 text-center",children:M.length>0?M.join(", "):e.jsx(N,{...ga.dragAllAccepted})})]})]})}function Yn(t,s,o,a){const{errors:n}=t[0];n.forEach(r=>{const l=fg(r);typeof l=="string"?o.danger(l,{hasCloseButton:!0}):o.danger(s.formatMessage(l,{size:Jc,maxNum:a===st.Multimodal?_n:Mn}),{hasCloseButton:!0})})}function Jn(t,s,o,a,n,r){const l=oi(),i=ai(l).flags,d=Dt(),p=Bn(),{isUnauthenticated:u}=Ce(),c=i?.includes(vs.NoAuthEnableFileUploads);return{handleFileAccepted:m.useCallback(async(h,f)=>{j.logEvent(B.uploadFile,{client:"web",eventSource:a,intent:s.toString()});const x=n!=null?await n():void 0;h.length>0&&h.forEach(C=>{ms.uploadFile(p,Qc(C),C,s,o,t,d,{gizmoId:x,...c&&{isUnauthenticated:u}},r)})},[a,s,n,p,o,t,d,r,c,u])}}const bg=Gn.div`absolute z-50 inset-0 flex gap-2 flex-col justify-center items-center after:contents-[""] after:absolute after:opacity-80 after:z-[-1] after:bg-token-main-surface-primary after:inset-0`;function Sg({composerController:t,clientThreadId:s,onHintSelected:o}){const a=ii(s),[n]=re(s,y=>[y?.modelId]),{data:r}=Vn(),l=n??Xc(void 0).id,i=Ra(r?.models,l),{setThreadSystemHintMode:d,clearAllSystemHintModeTriggers:p}=Le(),{viewableSystemHints:u,persistedSystemHints:c}=bt.useState(({availableHints:y,persistedSystemHints:k})=>({viewableSystemHints:y,persistedSystemHints:k})),[g,h]=m.useState([]),[f,x]=m.useState(void 0),[C,v]=m.useState(0);m.useEffect(()=>{if(!f)h([]);else{const y=f.text.toLocaleLowerCase();h(u.filter(k=>{const z=k.name.toLocaleLowerCase().startsWith(y),K=k.systemHint.toLocaleLowerCase().startsWith(y);let $=!1;return k.regexMatches&&k.regexMatches.length>0&&($=k.regexMatches.some(Y=>Y.replace(/[\^\$\(\)]/g,"").toLocaleLowerCase().startsWith(y))),z||K||$}).filter(k=>k.requiredFeatures.every(z=>i?.enabledTools?.includes(z))))}},[f]),m.useEffect(()=>{t.view.dispatch(kd(t.view.state.tr,{onHintMatch(y){x(k=>Yd(k,y)?k:y)}}))},[t]);const w=!u.length||!g.length||!f;m.useEffect(()=>{v(0)},[w]);const E=g.length,T=m.useCallback(y=>{v(k=>(y(k)%E+E)%E)},[E]),M=m.useCallback(()=>{v(-1)},[]),_=g[C],L=m.useCallback(()=>{f?.range&&t.delete(f.range.from,f.range.to)},[f,t]),A=({hintToSave:y=_,expectPerfectMatch:k})=>{if(!f||!_||k&&y.name.toLowerCase()!==f.text.toLowerCase())return!1;j.logEvent(B.systemHintSelected,{system_hint:y.systemHint,conversation_id:a??un});const z=f.range.from===1?y.name:f.text+y.name.slice(f.text.length),K={clientThreadId:s};as(t.view),c.size>0&&p();const $=!!y.composerBarButtonInfo,Y=y.systemHint===D.Search;return $||Y?(d(y.systemHint,!0,K,Y?ri.CONVERSATION_COMPOSER_SLASH_SEARCH:void 0),L(),t.removeSystemHints(),!0):(t.addSystemHint(y.systemHint,z,f.range.from,f.range.to),!0)},b=m.useRef(A);b.current=A;const F=m.useRef(T);F.current=T;const P=m.useRef(f);P.current=f;const O=t.view;return m.useEffect(()=>(w||_d(O,y=>{if(y==="up")F.current(k=>k-1);else if(y==="down")F.current(k=>k+1);else if(y==="cancel")as(O),Md(O);else if(y==="submit")if(o)L(),o(_.systemHint);else return as(O),b.current({expectPerfectMatch:!1});else if(y==="checkMatch")return b.current({expectPerfectMatch:!0})}),()=>as(O)),[w,O,_,o,L]),m.useEffect(()=>{w||j.logEvent(B.systemHintListOpened,{conversation_id:a??un})},[w]),{suggestorClosed:w,systemHintSuggestions:g,hintMatch:f,selectedIndex:C,resetSelectedIndex:M,setSelectedIndex:v,saveHint:A}}function vg({composerController:t,clientThreadId:s}){const{selectedIndex:o,systemHintSuggestions:a,suggestorClosed:n,setSelectedIndex:r,saveHint:l}=Sg({composerController:t,clientThreadId:s});return n?null:e.jsx(Jd,{className:"max-w-60",onMouseDown:i=>{i.preventDefault()},children:a.map((i,d)=>e.jsx("div",{onMouseOver:()=>r(d),onClick:()=>{l({hintToSave:i,expectPerfectMatch:!1}),t.focus()},children:e.jsx(Qd,{autoFocus:!1,className:"rounded-lg px-1 py-2",$spoofHovered:d===o,children:e.jsx(Hi,{title:i.name,description:i.description,logo:i.logo})})},i.systemHint))})}function Hi({title:t,description:s,logo:o,checked:a,badge:n}){const r=W();return e.jsxs("div",{className:"group inline-flex w-full items-center justify-start gap-2 pl-1.5 pr-3",children:[e.jsx("div",{className:"flex h-7 w-7 items-center justify-center gap-2.5",children:e.jsx(pi,{svgString:o,className:"icon-lg text-token-text-secondary"})}),e.jsxs("div",{className:"shrink grow basis-0",children:[e.jsxs("p",{className:"text-sm font-normal leading-tight text-token-text-primary",children:[t,n&&e.jsx("span",{className:"ml-2 rounded-full bg-blue-400 px-2 py-0.5 text-xs text-white","aria-label":r.formatMessage({id:"I75WNJ",defaultMessage:"Create image updated"}),children:e.jsx(N,{id:"uUmZQi",defaultMessage:"Updated"})})]}),!!s&&e.jsx("p",{className:"text-[13px] font-normal leading-[18px] text-token-text-secondary",children:s})]}),a&&e.jsx(li,{className:R("icon-md text-token-text-primary",{"group-hover:hidden":!a})})]})}function ha({composerController:t,clientThreadId:s}){return t instanceof Hn?e.jsx(vg,{composerController:t,clientThreadId:s}):null}function Fi({children:t,className:s,showBackground:o}){return e.jsxs("div",{className:"relative",children:[t,o&&e.jsx(U.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:R("pointer-events-none absolute inset-0 rounded-full",s)})]})}function yg({clientThreadId:t,icon:s,setOpen:o,open:a,isDisabled:n=!1,showLabel:r=!1,highlightTooltip:l=!1,hideBorder:i=!1,isSmall:d=!1,disabledReason:p,currentModelName:u,visualTreatment:c}){const g=Ts(),h=W();return n=n||!!g,e.jsxs(e.Fragment,{children:[e.jsx(Q.Trigger,{className:"m-0 h-0 w-0 border-none bg-transparent p-0"}),e.jsx(Di,{clientThreadId:t,rateLimitPopup:g,highlightTooltip:l,disabled:n,disabledReason:p,currentModelName:u,children:e.jsxs(Ea,{disabled:n,"aria-disabled":n,"aria-label":n?h.formatMessage({id:"NTwThg",defaultMessage:"Attach files is unavailable"}):h.formatMessage({id:"ixBxc3",defaultMessage:"Upload files and more"}),onClick:f=>{f.preventDefault(),o(!0)},$open:a,$showLabel:r,$hideBorder:i,$isSmall:d,$visualTreatment:c,children:[s,r&&e.jsx(Ta,{})]})})]})}function Cg({title:t,description:s,icon:o,checked:a}){return e.jsxs("div",{className:"group inline-flex w-full items-center justify-start gap-3 text-token-content-primary",children:[o&&e.jsx("div",{className:"flex items-center justify-center gap-2.5",children:e.jsx(pi,{svgString:o,className:"icon-md"})}),e.jsxs("div",{className:"shrink grow basis-0",children:[e.jsx("p",{className:"text-sm font-normal leading-tight",children:t}),!!s&&e.jsx("p",{className:"text-xs font-normal text-token-content-secondary",children:s})]}),a?e.jsx(li,{className:R("icon-md text-token-text-primary",{"group-hover:hidden":!a})}):null]})}function wg({onOauthRedirect:t,connectors:s,isNested:o}){const a=W();return e.jsxs(Q.Sub,{children:[e.jsx(Q.SubMenuTrigger,{icon:Zc,className:R(o&&"mx-0 rounded-xl p-1.5 px-2 py-2.5"),children:e.jsx(N,{...jg.oneDriveSubmenuName})}),e.jsx(Q.Portal,{children:e.jsx(Q.SubContent,{className:R(o&&"flex flex-col justify-start gap-2 p-1.5"),children:s.map(n=>n?e.jsx(Q.Item,{onClick:()=>t(n),className:R(o&&"mx-0 rounded-xl p-1.5 px-2 py-2.5"),children:o?e.jsx(Cg,{title:Yo(n.type,a),description:n.type===Se.O365_BUSINESS?e.jsx(N,{...Jo.includesSharePoint}):null}):e.jsxs("div",{className:"flex flex-col",children:[Yo(n.type,a),n.type===Se.O365_BUSINESS&&e.jsx("div",{className:"text-s text-token-text-tertiary",children:e.jsx(N,{...Jo.includesSharePoint})})]})},n.id):null)})})]})}const jg=ye({oneDriveSubmenuName:{id:"ContextConnectorPickerOneDriveSubmenu.oneDriveSubmenuName",defaultMessage:"Connect to Microsoft OneDrive"}});function kg(){const{connectorConfig:t}=Ia(),s=Dn(),o=Ln(),[a,n]=fs(Ba([...t.values()],u=>!!u.access_token),u=>!!u.access_token),[r,l]=fs(n,u=>u.type===Se.O365_PERSONAL||u.type===Se.O365_BUSINESS),i=!s&&!o&&a.length>0,d=!s&&!o&&!i&&r.length>1;return{unconnectedConnectors:o?[]:d?l:n,showUnconnectedInSubmenu:i,showOneDriveInSubmenu:d}}function _g({clientThreadId:t,icon:s,modelAcceptedMimeTypes:o,modelSupportedImageMimeTypes:a,attachmentsProductFeature:n,onOauthRedirect:r,uploadType:l,getInputProps:i,openFileDialog:d,isDisabled:p=!1,isNested:u=!1,highlightTooltip:c=!1,showLabel:g,isSmall:h=!1,hideBorder:f=!1,disabledReason:x,currentModelName:C,visualTreatment:v="vanguard",showMenuForNoAuth:w=!1}){const E=Xd().locale,T=W(),M=Dt(),_=Bn(),L=Dn(),{connectorConfig:A,isLoading:b}=Ia(),F=ce(ie.ContextConnectors),{getGizmoId:P}=An(),O=Cs(),[y,k]=m.useState();m.useEffect(()=>{P?P().then(H=>k(H)):k(void 0)},[P]);const z=m.useRef(null),[K,$]=m.useState(!1),Y=m.useRef(!1),ae=m.useCallback(()=>{const H=z.current?.files;Array.from(H??[]).forEach(Pe=>At.uploadFile(_,Pe,a,T,M,n))},[_,a,T,M,n]),[ue,le]=m.useState(null),_e=m.useCallback(()=>le(null),[le]),Me=m.useCallback((H,Pe)=>At.uploadPickedFile(_,H,Pe,a,o,n,y,T,M),[_,a,o,n,y,T,M]),{openMenu:J,confirmMenuOpened:he}=eu();m.useEffect(()=>{J&&($(!0),he())},[J,he,$]);const de=m.useCallback(H=>{At.doContextConnectorOauthRedirect(location.pathname+location.search+location.hash,H,r,aa.Picker),r()},[r]),He=m.useCallback(H=>{At.uploadPickedFile(_,H,Se.GDRIVE,a,o,n,y,T,M)},[_,a,o,n,y,T,M]),te=m.useCallback(async H=>{const{access_token:Pe}=H;if(!Pe){de(H);return}switch(At.logAttemptIfAccessTokenIsExpired(H,aa.Picker),H.type){case Se.GDRIVE:tu(E,H.type,Pe,Is=>Is.forEach(He));break;case Se.O365_PERSONAL:case Se.O365_BUSINESS:le(H.type);break}},[He,de,le,E]),fe=()=>{j.logEvent(B.openFileViewer,{intent:l.toString()}),d()},it=H=>{if(!H&&Y.current&&!b)fe();else if(H&&ne&&!b&&!w){fe();return}$(H),H&&(F.eligible&&F.markAsViewed(),j.logEventWithStatsig(B.composerOpenContextConnectorPicker,"chatgpt_composer_open_context_connector_picker"),Y.current=!0,setTimeout(()=>{Y.current=!1},250))},[we,qe]=fs(Ba([...A.values()],H=>!!H.access_token),H=>!!H.access_token);Mg(we,te);const[rt]=fs(qe,H=>H.type===Se.O365_PERSONAL||H.type===Se.O365_BUSINESS),{unconnectedConnectors:Ne,showUnconnectedInSubmenu:Ke,showOneDriveInSubmenu:se}=kg(),{desktopConnectors:G}=su(a),ne=!we.length&&!Ne.length&&!G.length,Ye=e.jsxs(e.Fragment,{children:[Ke&&Ne.length>0&&e.jsx(nu,{connectorEntries:Ne,onOauthRedirect:H=>de(H),isNested:u}),!Ke&&Ne.map(H=>e.jsx(Qo,{entry:H,onClick:()=>te(H),isNested:u},H.id)),se&&e.jsx(wg,{connectors:rt,onOauthRedirect:de,isNested:u}),b&&e.jsx(Q.Item,{icon:e.jsx(Xa,{className:"text-token-text-secondary"})}),(Ne.length>0||b)&&!u&&e.jsx(Q.Separator,{}),we.map(H=>e.jsx(Qo,{entry:H,onClick:()=>te(H),isNested:u},H.id)),G.map(H=>e.jsx(ou,{entry:H,isNested:u},H.key)),e.jsx(au,{modelSupportedImageMimeTypes:a}),w?e.jsx(Ag,{onClickUploadImages:fe,redirectToAuth:()=>O({authType:"login"})}):e.jsx(Q.Item,{className:R(u&&"mx-0 rounded-xl p-1.5 px-2 py-2.5"),onClick:fe,icon:iu,children:e.jsx(N,{...L?tt.uploadFileMobile:tt.uploadFile})},"upload")]}),Rs=u?e.jsx("div",{className:"relative flex flex-col",children:Ye}):e.jsxs("div",{className:"flex flex-col",children:[e.jsx(ru,{type:ue,onClose:_e,uploadPickedFile:Me}),e.jsx("input",{onChange:ae,...i({className:"hidden"})}),e.jsxs(Q.Root,{open:K,onOpenChange:it,children:[e.jsx(yg,{clientThreadId:t,icon:s,setOpen:it,open:K,isDisabled:p,highlightTooltip:c,showLabel:g,hideBorder:f,isSmall:h,disabledReason:x,currentModelName:C,visualTreatment:v}),e.jsx(Q.Portal,{children:e.jsx(Q.Content,{alignOffset:-16,side:"top",children:Ye})})]}),e.jsx(lu,{hasConnectors:!b&&!ne})]});return{dropdownItems:Ye,mainComponent:Rs}}function Mg(t,s){const{connector:o,clearParam:a}=cu(),n=t.find(r=>r.type===o&&!!r.access_token);m.useEffect(()=>{n&&(s(n),a())},[n,s,a])}function Oi(t){const{mainComponent:s}=_g(t);return s}function Ag({onClickUploadImages:t,redirectToAuth:s}){return e.jsxs(e.Fragment,{children:[e.jsx(Q.Item,{icon:Da,onClick:s,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx(N,{...tt.connectApps}),e.jsx("span",{className:"text-[13px] text-token-text-secondary",children:e.jsx(N,{...tt.loginRequired})})]})},"connect-apps-no-auth"),e.jsx(Q.Item,{icon:uu,onClick:s,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx(N,{...tt.uploadDocuments}),e.jsx("span",{className:"text-[13px] text-token-text-secondary",children:e.jsx(N,{...tt.loginRequired})})]})},"upload-documents-no-auth"),e.jsx(Q.Item,{icon:du,onClick:t,children:e.jsx(N,{...tt.uploadImages})},"upload-images-no-auth")]})}const tt=ye({attachFiles:{id:"ContextConnectorPicker.attachFiles",defaultMessage:"Upload files and more"},uploadFile:{id:"LocalFileDropdownItem.uploadFile",defaultMessage:"Upload from computer"},uploadFileMobile:{id:"LocalFileDropdownItem.uploadFileMobile",defaultMessage:"Upload file"},connectApps:{id:"Rna6u2",defaultMessage:"Connect apps"},uploadDocuments:{id:"0BxpM7",defaultMessage:"Documents"},uploadImages:{id:"rdMuNJ",defaultMessage:"Images"},loginRequired:{id:"/1XNys",defaultMessage:"Login required"}});function Ng({clientThreadId:t,uploadType:s,modelAcceptedMimeTypes:o,modelSupportedImageMimeTypes:a,attachmentsProductFeature:n,getInputProps:r,openFileDialog:l,onOauthRedirect:i,historyDisabled:d,isNested:p,isDisabled:u,highlightTooltip:c,disabledReason:g,currentModelName:h,showLabel:f,showUpsell:x,hideBorder:C,isSmall:v,showMenuForNoAuth:w}){const E=Ln(),{gdriveStatus:T,o365Status:M}=La(),{isUnauthenticated:_}=Ce(),L="h-[18px] w-[18px]",A=d?"text-white":c?"text-brand-blue-800":"",F=!x&&(w||T!=="false"||M!=="false"||E)?e.jsx(Oi,{hideBorder:C,isSmall:v,clientThreadId:t,icon:_?e.jsx(xs,{"aria-label":"",className:R(L,A)}):e.jsx(Ma,{"aria-label":"",className:R(L,A)}),showLabel:_&&f,modelAcceptedMimeTypes:o,modelSupportedImageMimeTypes:a,attachmentsProductFeature:n,onOauthRedirect:i,uploadType:s,openFileDialog:l,isNested:p,getInputProps:r,isDisabled:u,highlightTooltip:c,disabledReason:g,currentModelName:h,showMenuForNoAuth:w}):e.jsx(Li,{isSmall:v,hideBorder:C,clientThreadId:t,uploadType:s,openFileDialog:l,getInputProps:r,showLabel:f,showUpsell:x,icon:e.jsx(xs,{"aria-label":"",className:R(L,A)}),isDisabled:u,highlightTooltip:c,disabledReason:g,currentModelName:h});return p?F:e.jsx("div",{className:"relative",children:e.jsx(Fi,{showBackground:c,className:"bg-brand-blue-800/20",children:F})})}const Qn=.0025;function Xn({composerController:t,composerType:s,renderInComposer:o}){const a=gt(t.store,i=>i.controlsDisabled),n=mu(i=>{i.contentRect&&t.setWaveWidth(i.contentRect.width)}),r=m.useCallback(i=>{if(!(t instanceof Hn))return;const d=t.getSelectionStart();t.setControlsDisabled(!1),requestAnimationFrame(()=>{const{state:p,dispatch:u}=t.view;u(p.tr.insertText(i,d,d)),requestAnimationFrame(()=>{t.setSelection(d+i.length)}),t.usedDictation=!0})},[t]);return{whisperControls:a?e.jsx(pu,{initialValue:Qn,onSuccess:r,onWaveformDataUpdate:t.setWaveformData,onExit:()=>{t.setControlsDisabled(!1)},buttonClassName:s==="vanguard"?"h-7 min-h-7 w-7 min-w-7":"h-9 min-h-9 w-9 min-w-9"}):e.jsxs(e.Fragment,{children:[e.jsx(gu,{size:"small",onExit:()=>{t.setControlsDisabled(!0)},buttonClassName:s==="vanguard"?"h-7 min-h-7 w-7 min-w-7":"h-9 min-h-9 w-9 min-w-9"}),o?.()]}),waveContainerRef:n,handleTranscriptionSuccess:r}}const Pg=m.forwardRef(function({type:s,placeholder:o,replyRegions:a,state:n,renderFiles:r,leftSideActions:l,topRightAction:i,onSubmit:d,setIsComposerOverflowing:p,inputState:u,composerController:c,clientThreadId:g,gizmoId:h,disableReason:f,matchaData:x},C){const v=hu();let w=null;const{isLoading:E}=v;E||(w=v.modelId),m.useEffect(()=>{E||fu()||c.focus()},[w,c,E]);const{value:T}=Be("3780975974"),{state:M,shouldShowResearchText:_}=yt(g),L=m.useCallback(()=>e.jsx(Ha,{useStartButtonText:M==="clarify"||!1,inputState:u,state:n,onSubmit:d,composerController:c,clientThreadId:g,gizmoId:h,disableReason:f}),[u,n,d,c,g,h,f,x,M]),{whisperControls:A,waveContainerRef:b}=Xn({composerController:c,renderInComposer:L,composerType:"legacy"}),{controlsDisabled:F,waveformData:P,waveWidth:O}=gt(c.store),{getShowUpsellReason:y}=Fa(),k=T||y(),z=$=>{Eg({target:$.target,rootId:"composer-background",additonalInteractiveIds:["reply-regions"]})||c.focus()},K=Ni(g);return e.jsxs(Oa,{id:"composer-background",ref:C,className:R("flex w-full cursor-text flex-col overflow-clip rounded-t-3xl border-t border-token-border-light duration-150 ease-in-out contain-inline-size motion-safe:transition-[color,background-color,border-color,text-decoration-color,fill,stroke,box-shadow,bottom] dark:border-none dark:shadow-none",s!=="temporary"&&"shadow-[0_9px_9px_0px_rgba(0,0,0,0.01),_0_2px_5px_0px_rgba(0,0,0,0.06)] has-[:focus]:shadow-[0_2px_12px_0px_rgba(0,0,0,0.04),_0_9px_9px_0px_rgba(0,0,0,0.01),_0_2px_5px_0px_rgba(0,0,0,0.06)]",s!=="temporary"&&"bg-token-main-surface-primary dark:bg-[#303030]",s==="temporary"&&"dark bg-[#303030]","rounded-b-3xl border-b"),onClick:z,style:{viewTransitionName:"var(--vt-composer)"},children:[e.jsxs("div",{className:"px-3 py-1",children:[e.jsx(ge,{initial:!1,children:a.length>0&&e.jsx(U.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0,transition:{duration:.06}},transition:{ease:"easeOut",duration:.1},id:"reply-regions",children:e.jsx("div",{className:"-mx-2",children:e.jsx(Ua,{replyRegions:a})})})}),e.jsxs(e.Fragment,{children:[r,e.jsx(ge,{initial:!1,children:e.jsx(Ai,{enabled:_,composerController:c,visualTreatment:"legacy",children:e.jsxs("div",{className:"flex min-h-[44px] items-start pl-1",ref:b,children:[e.jsx("div",{className:"min-w-0 max-w-full flex-1",children:F?P?e.jsx(Ga,{waveform:P,containerWidth:O,scaleFactor:10,initialValue:Qn}):null:e.jsx($a,{composerController:c,placeholder:o})}),e.jsx("div",{className:"w-[32px] pt-1",children:i})]})})}),e.jsxs("div",{className:"mb-2 mt-1 flex items-center justify-between sm:mt-5",ref:$=>{if(!k||!("ResizeObserver"in window))return;let Y=new AbortController,ae=window.innerWidth;const ue=xu({axis:"width",debounce:!0,target:$,onChange:()=>{if(!$)return;$.scrollWidth>$.clientWidth?p?.(!0):Math.abs(ae-window.innerWidth)>40&&(p?.(!1),ae=window.innerWidth)}});return()=>{ue?.(),Y.abort()}},children:[e.jsx("div",{className:"flex gap-x-1.5 text-token-text-primary",children:l}),e.jsx("div",{className:"flex gap-x-1.5",children:A})]})]})]}),e.jsx(ge,{children:K&&e.jsx(Ei,{clientThreadId:g})})]})});function Eg({target:t,rootId:s,additonalInteractiveIds:o}){let a=t;for(;a&&a!=null;){if(a.tagName==="BUTTON"||a.tagName==="INPUT"||a.tagName==="TEXTAREA"||a.isContentEditable||o.includes(a.id))return!0;if(a.id===s)return!1;a=a.parentElement}return!1}const Tg=["o3-mini","o3-mini-high","o1-pro"],Rg=({composerController:t,clientThreadId:s,hideThinkButton:o,disableIfNoAccess:a})=>{const{prospectiveModelId:n}=St(s),{activeSystemHints:r,isLoading:l}=Lt(s),{value:i}=Be("2868048419"),d=r.filter(C=>!C.composerBarButtonInfo&&C.systemHint!==D.Search&&(!i||C.systemHint!==D.PictureV2)&&(!o||C.systemHint!==D.Think)),p=fi(t),u=xi(t,s),c=n&&Tg.includes(n),g=d.length===0&&!l||c;if(!a&&g)return null;const h={clientThreadId:s};function f(){j.logEventWithStatsig(B.composerSystemHintButtonHovered,"composer_system_hint_button_hovered",h)}function x(){j.logEventWithStatsig(B.composerSystemHintButtonClicked,"composer_system_hint_button_clicked",h)}return e.jsx(Ig,{systemHints:d,selectedHint:p,disabled:!!g,onHover:f,onOpen:x,onSelect:u})},Ig=({systemHints:t,selectedHint:s,disabled:o,onHover:a,onOpen:n,onSelect:r})=>{const l=W(),[i,d]=m.useState(!1),p=t.find(c=>c.systemHint==="contextual_answers")?.name,u=t.length===0?e.jsxs("div",{className:"mx-2 flex min-h-[40px] flex-col justify-center gap-2",children:[e.jsx("div",{className:"loading-results-shimmer h-9 w-full rounded-md bg-token-main-surface-secondary"}),e.jsx("div",{className:"loading-results-shimmer h-9 w-full rounded-md bg-token-main-surface-secondary"})]}):e.jsx(e.Fragment,{children:t.map(c=>e.jsx(Q.Item,{className:"px-1 py-2",onClick:()=>r?.({hint:c,enable:c.systemHint!==s}),children:e.jsx(Hi,{title:c.name,description:c.description,logo:c.logo,checked:c.systemHint===s,badge:c.systemHint===D.PictureV2})},c.systemHint))});return e.jsxs(Q.Root,{open:i,onOpenChange:c=>{d(c),c&&n?.()},children:[e.jsx(Bg,{disabled:!!o,contextualAnswersHintNameIfPresent:p,children:e.jsx(Zd,{className:R(bu.toolsButton,"flex h-9 min-w-9 items-center justify-center rounded-full border border-token-border-light p-1 text-xs font-semibold text-token-text-secondary focus-visible:outline-black disabled:opacity-30 radix-state-open:bg-black/10 can-hover:hover:bg-token-main-surface-secondary dark:focus-visible:outline-white dark:can-hover:hover:bg-gray-700"),"data-opened":Dg(i),"aria-label":l.formatMessage({id:"oDAnGy",defaultMessage:"Use a tool"}),disabled:o,onPointerOver:a,onClick:c=>{c.preventDefault()},onFocusCapture:c=>{c.stopPropagation()},children:e.jsx(Su,{className:"pointer-events-none h-5 w-5"})})}),e.jsx(Q.Portal,{children:e.jsx(Q.Content,{alignOffset:-16,onCloseAutoFocus:c=>{c.preventDefault()},children:u})})]})},Bg=({disabled:t,children:s,contextualAnswersHintNameIfPresent:o})=>{const a=ce(ie.hasSeenComposerSystemHintButtonTooltip),n=ce(ie.hasSeenCaSystemHint),r=!t&&!a.isLoading&&a.eligible,l=!t&&!a.isLoading&&o&&!n.isLoading&&n.eligible,i=r?{announcementKey:ie.hasSeenComposerSystemHintButtonTooltip,title:e.jsx(N,{id:"tTydhk",defaultMessage:"All your tools, in one handy place"}),onDismiss:a.markAsViewed,description:e.jsx(N,{id:"S+BFNe",defaultMessage:"Create a canvas, generate a picture, and more."})}:l?{announcementKey:ie.hasSeenCaSystemHint,title:e.jsx(N,{id:"uaC1JM",defaultMessage:"Not finding internal information?"}),onDismiss:n.markAsViewed,description:e.jsx(N,{id:"TL/S+W",defaultMessage:"If ChatGPT didn't search your files automatically, type {hintName} or select it from the menu.",values:{hintName:e.jsx("span",{className:"whitespace-nowrap font-bold",children:'"/'+o+'"'})}})}:void 0;return i?e.jsx(Ps,{show:!0,side:"bottom",theme:"bright",dismissOnOutsideClick:!0,badge:"new",sideOffset:0,className:"!max-w-2xs xs:!max-w-sm",...i,children:s}):e.jsx(De,{side:"top",sideOffset:0,label:t?e.jsx(N,{id:"uw9x80",defaultMessage:"Tools unavailable"}):e.jsx(N,{id:"mrYNGk",defaultMessage:"View tools"}),children:s})};function Dg(t){return t?"":null}const Lg=({composerController:t,systemHint:s,clientThreadId:o,connectionStatuses:a})=>{const n=Bt(),r=s.systemHint,l=Ht(r);if(!s.composerBarButtonInfo)return null;const i=a.some(d=>d.user_connection_details.activation_status==="partially_activated"||d.user_connection_details.activation_status==="activated");return e.jsx(Bp,{composerController:t,systemHint:s,composerBarButtonInfo:s.composerBarButtonInfo,clientThreadId:o,isDisabled:!1,showLabel:n,dropdownContent:i?void 0:e.jsx(fa,{}),splitButtonDropdownContent:i&&l?e.jsx(fa,{}):void 0})},fa=()=>{const{connectionInstanceData:t,isLoading:s}=vn(),o=m.useMemo(()=>[...t?.connection_statuses??[]].sort(vu),[t]),a=o.some(n=>n.user_connection_details.activation_status==="activating"||n.user_connection_details.activation_status==="partially_activated");return m.useEffect(()=>{j.logEventWithStatsig(B.contextualAnswersUserComposerDropdownShown,"chatgpt_contextual_answers_user_composer_dropdown_shown")},[]),s?e.jsx("div",{className:"w-full min-w-[calc(100vw-1.5rem)] max-w-[calc(100vw-1.5rem)] p-3 md:min-w-[22rem]",children:e.jsx(Im,{lines:4,size:"lg"})}):e.jsx(ge,{children:e.jsxs("div",{className:"w-full min-w-[calc(100vw-1.5rem)] max-w-[calc(100vw-1.5rem)] p-3 md:min-w-[22rem]",children:[e.jsx("div",{className:"px-2 py-2 text-sm font-medium text-token-text-tertiary",children:e.jsx(N,{id:"gkeRrW",defaultMessage:"Internal knowledge"})}),o.map(n=>e.jsx("div",{className:"px-2 py-3",children:e.jsx(yu,{title:n.connection_display_info.display_name,description:Cu(n.user_connection_details.activation_status),icon:e.jsx("img",{src:n.connection_display_info.icon_url??"",alt:n.connection_display_info.display_name,className:"icon-lg"}),statusIndicator:e.jsx(wu,{connection:n})})},n.user_connection_details.connection_instance_id)),e.jsx("div",{className:"border-token-border-primary mb-2 mt-2 border-b"}),e.jsx(Ve,{color:"ghost",className:"w-full rounded-xl px-2 py-3",contentsFullWidth:!0,as:"link",to:"#settings/ConnectorSettings",children:e.jsxs("div",{className:"flex w-full flex-row items-center justify-start gap-4 text-start",children:[e.jsx("div",{className:"icon-lg",children:e.jsx(Da,{})}),e.jsx("p",{className:"flex-1 text-sm font-medium text-token-text-primary",children:a?e.jsx(N,{id:"EqgQdy",defaultMessage:"See syncing state"}):e.jsx(N,{id:"05N3nu",defaultMessage:"Manage connectors"})})]})})]})})},Hg=({serverThreadId:t,getIsDisabled:s,composerController:o,onReset:a,onInfer:n})=>{const[r,l]=m.useState(!1),{isAutoSwitcherEnabled:i,inferenceDebounceTime:d}=bs(),p=em(),u=m.useRef(null),c=za(({enableInferredJuice:w})=>w),g=i||c,h=m.useCallback(w=>{s()||!g||ia.postAnonAware("/conversation/infer/prepare",{conversation_id:w??null,is_history_and_training_disabled:p}).then(E=>{u.current=E.conduit_token})},[s,g,p]);m.useEffect(()=>{h(t)},[t,h]);const f=m.useRef(n);f.current=n;const x=m.useRef(0),C=m.useRef(0),v=m.useCallback(Ss(w=>{if(s())return;const E=++x.current,T=Date.now();l(T),ia.postAnonAware("/conversation/infer",{prompt:w,conversation_id:t??null,is_history_and_training_disabled:p},{additionalHeaders:{"x-conduit-token":u.current??""}}).then(M=>{if(s()||C.current>E)return;C.current=E;const{juice:_}=M;f.current(_)}).finally(()=>{l(M=>M&&T<M?M:!1)})},d),[s]);return m.useEffect(()=>{if(!(!g||!(o instanceof Hn)))return o.subscribe("change",()=>{const{content:w}=o.getContentToSend();w?v(w):(u.current=null,a(),h(t),l(!1),++x.current,C.current=x.current)})},[g,s,o,v,n,a,t,p,h]),r!==!1},xa=48,ba=32,Fg=({clientThreadId:t,isTemporaryChat:s,placeholder:o,composerController:a,visualTreatment:n,children:r,isExpandedByDefault:l=!1,onSubmit:i})=>{let d=null,p=null,u=[],c=[],g=null,h=[],f=null;m.Children.forEach(r,y=>{if(m.isValidElement(y))if(y.type===Ug){if(g!=null)throw new Error("PromptTextareaComposer only accepts a single app stack");g=y}else if(y.type===Ui){if(d!=null)throw new Error("PromptTextareaComposer only accepts a single submit button");d=y}else if(y.type===Wg){if(p!=null)throw new Error("PromptTextareaComposer only accepts a single header action");p=y}else y.type===Gg||y.type===Gi?u.push(y):y.type===zg?c.push(y):y.type===xn?h.push(y):y.type===zi&&(f=y)});const[x,C]=m.useState(l),{shouldShowResearchText:v}=yt(t),{waveContainerRef:w}=Xn({composerController:a,composerType:"vanguard"}),{controlsDisabled:E,waveformData:T,waveWidth:M}=gt(a.store),_=m.useRef(!1),L=_s(),A=m.useSyncExternalStore(y=>{const k=a.subscribe("focus",y),z=a.subscribe("blur",y);return()=>{z(),k()}},()=>a.isFocused(),()=>!1);m.useEffect(()=>a.subscribe("change",()=>{_.current=a.getCurrentText().length>0}),[a]),m.useEffect(()=>{l&&C(!0),A&&!x&&C(!0)},[A,x,l]);const b=y=>{const k=z=>{l||_.current||y?.contains(z.target)||C(!1)};return document.addEventListener("click",k),()=>{document.removeEventListener("click",k)}},F=y=>{y.preventDefault(),i(y)},P=u.length>0,O=c.length>0;return e.jsxs("form",{ref:b,className:"w-full",onSubmit:F,"data-type":"unified-composer",children:[e.jsxs(Og,{isTemporaryChat:s,clientThreadId:t,children:[e.jsxs(U.div,{transition:L?Te:us,className:"relative flex w-full flex-auto flex-col",children:[h.length>0&&e.jsx("div",{className:"mb-4 flex flex-col gap-2",children:h}),e.jsxs("div",{className:"relative ml-1.5 grid grid-cols-[auto_minmax(0,1fr)]",children:[e.jsx("div",{className:"items-top flex justify-center",children:e.jsx(U.div,{initial:{opacity:x?1:0},animate:{opacity:x?1:0},exit:{opacity:0},transition:L?Te:gs,children:p})}),e.jsx(U.div,{initial:{marginBottom:-20,translateX:x?0:ba},onPointerDown:y=>y.stopPropagation(),animate:{translateX:x?0:ba},style:{translateY:-7},transition:L?Te:us,className:"relative flex-auto bg-transparent pl-2 pt-0.5",children:e.jsx(Ai,{enabled:v,composerController:a,visualTreatment:"vanguard",children:e.jsx("div",{className:"flex min-h-12 items-start",ref:w,children:e.jsx("div",{className:"min-w-0 max-w-full flex-1",children:E?T?e.jsx(Ga,{waveform:T,containerWidth:M,scaleFactor:10,initialValue:Qn}):null:e.jsx($a,{composerController:a,placeholder:o,vanguard:!0})})})})})]}),e.jsx("div",{className:"justify-content-end relative ml-2 flex w-full flex-auto flex-col",children:e.jsx("div",{className:"flex-auto"})}),e.jsx(U.div,{initial:{height:x&&P?xa:0},animate:{height:x&&P?xa:0},transition:L?Te:us})]}),(P||!!d)&&e.jsx("div",{className:R("bg-primary-surface-primary absolute bottom-[9px] left-[17px] right-0 z-[2] flex items-center",n==="legacy"&&"[--force-hide-label:none] @xl/thread:[--force-hide-label:unset]"),children:e.jsxs("div",{children:[P&&x&&e.jsx("div",{className:"flex items-center gap-2 max-xs:gap-1",children:u}),e.jsxs("div",{className:"absolute bottom-1 right-3 flex items-center gap-2",children:[O&&e.jsx("div",{className:"relative ml-1",children:c}),d]})]})}),e.jsx("div",{className:"absolute left-4 top-3 ml-[1px] flex items-center pb-px",children:e.jsx(ge,{children:!x&&g})})]}),e.jsxs(Ms,{open:!!f,children:[e.jsx(yn,{className:"w-full"}),e.jsx(As,{children:e.jsx(Ns,{side:"bottom",align:"start",sideOffset:12,onOpenAutoFocus:y=>y.preventDefault(),children:f})})]})]})},Og=({children:t,isTemporaryChat:s,clientThreadId:o})=>{const a=Ni(o);return e.jsxs(Oa,{className:R("flex w-full cursor-text flex-col items-center justify-center rounded-[28px] border border-token-border-xlight contain-inline-size","overflow-clip shadow-sm dark:!shadow-none sm:shadow-lg",s?"dark bg-[#303030]":"bg-token-main-surface-primary dark:bg-[#303030]"),children:[e.jsx("div",{className:"relative flex w-full items-end py-3 pl-3",children:t}),e.jsx(ge,{children:a&&e.jsx(Ei,{clientThreadId:o,isVanguard:!0})})]})},Ug=({children:t})=>e.jsx(U.div,{onPointerDown:s=>{s.stopPropagation(),s.preventDefault()},children:t}),Ui=({children:t})=>e.jsx("div",{className:"ml-auto flex items-center gap-1.5",onPointerDown:s=>s.stopPropagation(),children:t}),Gi=({children:t})=>t?e.jsx(e.Fragment,{children:t}):null,Gg=({children:t})=>e.jsx("div",{onPointerDown:s=>s.stopPropagation(),children:t}),zg=({children:t})=>e.jsx("div",{onPointerDown:s=>s.stopPropagation(),children:t}),zi=({children:t})=>e.jsx("div",{onPointerDown:s=>s.stopPropagation(),children:t}),Wg=({children:t})=>e.jsx("div",{onPointerDown:s=>s.stopPropagation(),children:t}),xn=({children:t,width:s="full"})=>e.jsx("div",{className:R(s==="fit"?"w-fit":"w-full"),onPointerDown:o=>o.stopPropagation(),children:t});function Vg({clientThreadId:t,uploadType:s,modelAcceptedMimeTypes:o,modelSupportedImageMimeTypes:a,attachmentsProductFeature:n,getInputProps:r,openFileDialog:l,onOauthRedirect:i,historyDisabled:d,isNested:p,isDisabled:u,highlightTooltip:c,disabledReason:g,currentModelName:h,showLabel:f,showUpsell:x,hideBorder:C,isSmall:v,visualTreatment:w}){const E=Ln(),{gdriveStatus:T,o365Status:M}=La(),_="h-[20px] w-[20px]",L=d?"text-white":c?"text-brand-blue-800":"",A=x?e.jsx(xs,{"aria-label":"",className:R(_,L)}):e.jsx(xs,{"aria-label":"",className:R(_,L)}),b=(T!=="false"||M!=="false"||E||w==="vanguard")&&!x,F=tm(),P=w==="vanguard"&&!F,O=b?e.jsx(Oi,{hideBorder:C,isSmall:v,clientThreadId:t,icon:A,modelAcceptedMimeTypes:o,modelSupportedImageMimeTypes:a,attachmentsProductFeature:n,onOauthRedirect:i,uploadType:s,openFileDialog:l,isNested:p,getInputProps:r,isDisabled:P?!1:u,highlightTooltip:c,disabledReason:g,currentModelName:h,visualTreatment:w}):e.jsx(Li,{isSmall:v,hideBorder:C,clientThreadId:t,uploadType:s,openFileDialog:l,getInputProps:r,showLabel:f,showUpsell:x,icon:A,isDisabled:u,highlightTooltip:c,disabledReason:g,currentModelName:h});return p?O:e.jsx("div",{className:"relative",children:e.jsx(Fi,{showBackground:c,className:"bg-brand-blue-800/20",children:O})})}const $g=({clientThreadId:t,currentModel:s,uploadType:o,modelSupportedImageMimeTypes:a,modelAcceptedMimeTypes:n,modelProductFeatures:r,getEditorGizmoId:l,onOauthRedirect:i,disabledReason:d,isTemporaryChat:p,isDisabled:u,highlightTooltip:c,showLabel:g,showUpsell:h,numRemainingFiles:f,visualTreatment:x})=>{const C=W(),v=Dt(),{handleFileAccepted:w}=Jn(C,o,a,"mouse",l,r?.attachments),{getInputProps:E,open:T}=Rn({disabled:u,noClick:!0,onDropAccepted:w,onDropRejected:M=>Yn(M,C,v,o),multiple:!0,maxSize:In,maxFiles:f,...En(n)});return e.jsx(Vg,{isSmall:!0,hideBorder:!0,isDisabled:u,highlightTooltip:c,onOauthRedirect:i,visualTreatment:x,attachmentsProductFeature:r?.attachments,clientThreadId:t,uploadType:o,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:a,getInputProps:E,openFileDialog:T,historyDisabled:p,showLabel:g,showUpsell:h,disabledReason:d,currentModelName:s?.title??""})},Sa="gpt-4o",qg=({clientThreadId:t,serverThreadId:s,composerController:o,pendingFiles:a,isUploadDisabled:n,highlightUploadTooltip:r,hasFiles:l,conversationMode:i,placeholder:d,isTemporaryChat:p,layoutMode:u,state:c,inputState:g,disableReason:h,gizmoId:f,currentModel:x,category:C,replyRegions:v,uploadButtonDisabledReason:w,keepExpanded:E=!1,getEditorGizmoId:T,onOauthRedirect:M,onSubmit:_,visualTreatment:L,legacyFooterActions:A,legacySuggestionsPopoverContent:b})=>{const[F,P]=Xo(!1);Le();const{isAutoSwitcherEnabled:O}=bs(),y=bt.useState(({persistedSystemHints:G})=>G),[k]=ya(),z=Array.from(y)[0],{state:K}=yt(t),{isUXUpdatesEnabled:$}=bs(),Y=ft(!1),ae=Et(G=>G.setManualModelSelection),ue=Et(G=>G.threads[t]?.isManualModelSelection),le=O&&x?.id!==Sa&&!ue&&!F();ju(m.useCallback(()=>{le&&Y({location:"PromptTextarea",modelId:Sa})},[le,Y]));const _e=m.useCallback(()=>e.jsx(Ha,{isSmall:$,inputState:g,state:c,onSubmit:_,composerController:o,clientThreadId:t,gizmoId:f,disableReason:h,useStartButtonText:K==="clarify"}),[g,c,_,o,t,f,h,K,$]),{whisperControls:Me}=Xn({composerController:o,renderInComposer:_e,composerType:$?"vanguard":"legacy"}),[J=null,he,de]=m.useMemo(()=>[Nn(x,i),Pn(x,i),Tn(x,i)],[x,i]);Lt(t);const He=bt.useState(({availableHints:G})=>G),te=ku(()=>{if(L!=="vanguard"||!O)return;const G=k.get("model"),ne=_u();(ne&&!ds.includes(ne)||G&&!ds.includes(G))&&ae(t,!0)});m.useEffect(()=>{te()},[te]);const fe=m.useMemo(()=>{const G=x?.id??"";return Aa.includes(G)?"low":Na.includes(G)?"medium":Pa.includes(G)?"high":"low"},[x?.id]),[it,we]=Xo(fe);m.useEffect(()=>{we(fe)},[fe,we]);const qe=(G,ne=!1)=>{ne||P(!0),!(G===it()&&ds.includes(x?.id??""))&&(we(G),ae(t,!1),requestAnimationFrame(()=>{requestAnimationFrame(()=>{const Ye=an[G];Y({location:"PromptTextarea",modelId:Ye})})}))};ce(ie.ModelPickerMoved),Hg({serverThreadId:s,composerController:o,getIsDisabled:m.useCallback(()=>!!(F()||L==="vanguard"&&(ue||z)),[ue,z,F,L]),onReset:()=>{P(!1),ue||qe("low",!0)},onInfer:G=>{qe(G,!0)}});const rt=Wa(G=>G.selectedApps),Ne=Va()&&rt.length>0,Ke=l||Ne,se=E||!!z||v&&v.length>0||Ke||He.length<3;return hs(x,i,y),e.jsxs(Fg,{clientThreadId:t,isTemporaryChat:p,placeholder:d,visualTreatment:L,composerController:o,isExpandedByDefault:se,onSubmit:_,children:[v&&v.length>0&&e.jsx(xn,{width:"full",children:e.jsx(Ua,{replyRegions:v})}),Ke&&e.jsx(xn,{width:"fit",children:e.jsx(cn,{files:a,selectedApps:rt,className:"no-scrollbar -ml-1.5 flex flex-nowrap gap-2 overflow-x-auto p-1.5"})}),[...A?.map((G,ne)=>e.jsx(Gi,{children:G},`legacy-footer-action-${ne}`))??[],e.jsx(zi,{children:b},"legacy-suggestions-popover")],e.jsx(Ui,{children:Me})]})},Kg=Fn(()=>On(()=>import("./c0kkz5yw203koqyt.js"),__vite__mapDeps([10,1,11,3,4,2,5,8,12,13,14,15,16,17,18,19,20,21])).then(t=>t.ImageGenComposer)),Yg=1,Jg=3e3;function Qg({onCreateNewCompletion:t,onContinueGenerating:s,account:o,currentModelId:a,currentModelConfig:n,modelCategories:r,areModelsLoading:l,clientThreadId:i,isNewThread:d,isCompletionInProgress:p,className:u,disabled:c=!1,disabledReason:g,canPause:h=!1,canContinue:f=!1,isInteractableSharedThread:x,onComposerInput:C,onComposerChange:v,onAutocompleteSelect:w,headerClassName:E,hideHeader:T,onTaggingDropdownOpen:M,onTaggingDropdownClose:_}){Zo.markStart("PromptTextarea"),Zo.markRendered("PromptTextarea");const L=oi(),A=m.useRef(null),b=Es(),F=Mu(),P=o?.isFree(),O=o?.isTeam(),{isUnauthenticated:y}=Ce(),k=W(),z=Dt(),K=Bn(),$=Au.useStore(),[Y,ae]=re(i,S=>[X.getCurrentLeafId(S),X.getRequestId(S)]),[ue]=ya(),{gizmoEditorData:le,mode:_e,getGizmoId:Me}=An(),J=sm(),he=Bt(),de=nm(),He=Nu(),te=ii(i),fe=!!Za(),it=Pu.useIsEnabled(i),we=!!Un(),{setThreadSystemHintMode:qe,clearSystemHintModeTrigger:rt,getSystemHintModeTrigger:Ne,clearAllSystemHintModeTriggers:Ke}=Le(),se=Ft(),{state:G}=yt(i),ne=se.has(D.Search),Ye=se.has(D.Think),Rs=se.has(D.PictureV2),H=se.has(D.Research),{activeSystemHints:Pe}=Lt(i),Is=Pe.length>0,Zn=Pe.find(S=>S.systemHint===D.ContextualAnswers),Wi=Eu(),{connectionInstanceData:Bs,isLoading:Vi}=vn({skip:!Wi}),{selectedSources:Ds}=Pi(i),[Ct,eo]=m.useState(!1),Ls=m.useRef(0),Hs=m.useRef(!1),to=r?.find(S=>S.defaultModel===a),$i=null;let q=vt(i),Je=q&&"gizmo"in q?q.gizmo:void 0;const Fs=jn(Je?.gizmo.id),qi=tp(),Ki=Tu(),Ut=Ru(),[xe,Gt]=m.useState(null);xe!==null&&(q={gizmo:xe,gizmo_id:xe.gizmo.id,kind:Ae.GizmoInteraction},Je=xe);const wt=hs(n,q,se),Yi=Ts(),so=ai(L).flags,zt=so?.includes(vs.NoAuthEnableFileUploads),{isUXUpdatesEnabled:Qe,reasoningSliderType:Os}=bs(),jt=Os!=="none",Ji=Qe&&se.size===0,{prospectiveModelId:no}=St(i),Qi=P||l&&no&&!Mm.includes(no),oo=!c&&(wt!==st.None||Ji||Qi)&&(!y||zt),Fe=Pn(n,q),Us=Tn(n,q);let me=ln(S=>S.files);const[Wt]=m.useState(()=>Iu());_e==="magic"?me=me.filter(S=>S.gizmoId!=null):me=me.filter(S=>S.gizmoId==null);const ao=Bu(),Oe=me.length>0||ao,io=ln(Du.hasUploadInProgress),Gs=Wa(S=>S.selectedApps),ro=Va()&&Gs.length>0,Xi=Oe||ro,Zi=Lu(i),zs=b.useState(S=>{const V=jm(S);return typeof n?.maxTokens=="number"&&V>n.maxTokens}),lo=b.useState(S=>!S.isEmpty()),Vt=!zs&&!io&&(lo||Oe),co=(wt===st.Multimodal?_n:Mn)-me.length,uo=co<=0,lt=Vt&&!c&&!we&&(!p||Ut),[mo,er]=m.useState(!1),{value:tr,isLoading:sr}=Be("3780975974"),{targetedContent:po,setTargetedContent:$t}=Hu(),je=po?.isFocusedViewContent&&!He?void 0:po,{rebaseSystemMessageContent:go}=za(),ho=q==null||q?.kind===Ae.PrimaryAssistant||q?.kind===Ae.GizmoInteraction&&Fs,{getUpsellLabelType:nr,getUpsellShowsAttach:or,getShowUpsellReason:ar}=Fa(),Ws=Is&&ho,[ir,rr]=m.useState(!1),lr=!y&&ho&&(!O||!Vi),ct=gt(b.store,S=>S.controlsDisabled);m.useEffect(()=>{if(!F?.id)return;const S=ra.getAndReset(F.id,te);S&&b.setText(S.inputText)},[F?.id,te,b]),m.useEffect(()=>{const S=ue.get("prompt")??"";b.getCurrentText().length===0&&S.length>0&&b.setText(S)},[b,ue]),m.useEffect(()=>{mo!==lt&&(er(lt),lt&&om(!0).then(S=>{Fu.startEnforcement(S),am.startEnforcement(S)}))},[lt,mo,q?.kind,J]);const qt=Nn(n,q),{handleFileAccepted:cr}=Jn(k,hs(n,q,se),Fe,"mouse",Me,qt?.attachments),{getInputProps:ur,open:dr}=Rn({disabled:c||!oo||uo,noClick:!0,onDropAccepted:cr,onDropRejected:S=>Yn(S,k,z,wt),multiple:!0,maxSize:In,maxFiles:co,...En(y?Fe:Us)}),fo=gt(Wt),{value:mr}=Be("1988730211"),xo=m.useCallback(()=>{b.eraseContent(),fo.clearMessages(),b.resize(Yg),b.usedDictation=!1;for(const S of me)ms.remove(K,S.tempId,"none");Ou.markAllAsSent()},[b,fo,me,K]),pr=ve("1064007944")?.value,Kt=async(S,V)=>{if(S.preventDefault(),c||!Vt&&!V||!q||nt(i)?.isLoading!==!1)return;if(Ut&&Xe==="streaming"){const oe=X.getCurrentNode(nt(i)).message,Xs=cm(oe).length;j.logEventWithStatsig(B.conversationStreamInterrupted,"chatgpt_web_conversation_stream_interrupted",{client_thread_id:i,interrupted_message_length:Xs})}const be=ae&&um(ae);if(Ut&&be&&!be.turnTracker.isStreamOpen)return;eo(!0),qi?.(),Ki();const pe=b.getContentToSend(),Ze=Am(pe.content),Mt=sd({namespace:nd.CompletionRequest,opts:{expectedTimingLogs:[{name:"prompt_submitted",expectedInMs:3e3}],debug:!1}});Mt.reset();const{content:Ys,attachments:Fo}=od(K,Ze,n,q,se),Oo=[];if(ro){const oe=await ad(Gs);oe&&Oo.push(dm(oe))}const Uo=[];go&&Uo.push(mm(go));const Js={...q};"gizmo"in Js&&delete Js.gizmo;let ns=b.getSystemHints();se.size>0&&(ns=Array.from(se));const Go=Ne(D.Search),Gr=ne?Go??ri.CONVERSATION_COMPOSER_WEB_ICON:void 0,zo=id(),Wo=rd(),zr=b.usedDictation,Wr=pm(Ys,{...Fo.length>0&&{attachments:Fo},...xe&&{gizmo_id:xe.gizmo.id},...Ds&&{caterpillar_selected_sources:Array.from(Ds.values())},...ns.length>0&&{system_hints:ns},...!!pe.metadata&&{serialization_metadata:pe.metadata},...zo.length>0&&{canvas:{user_created_textdocs:zo.map(oe=>({user_created_temp_textdoc_id:oe.tempTextdocId,type:oe.type,title:oe.title,content:oe.content,create_source:oe.create_source,remix_shared_textdoc_id:oe.remixSharedTextdocId}))}},...Object.keys(Wo).length>0&&{__internal:{search_settings:Wo}},dictation:zr});let Ee={sourceEvent:S,completionMetadata:{conversationMode:Js,systemHints:ns,searchSource:Gr},promptMessage:Wr,prependMessages:Oo,appendMessages:Uo,profiler:Mt};const Qs={};if(Ee=ld(Ee),mr&&Ee.completionMetadata?.systemHints){let oe=!1;Ee.completionMetadata.systemHints=Ee.completionMetadata.systemHints.filter(Xs=>Xs===D.Search?(oe=!0,!1):!0),oe&&(Qs.forceUseSearch=!0)}it&&(Qs.enableMessageFollowups=!0),Ee.extraStreamParams=Qs,je?.createNewCompletionParams&&(Ee=await je.createNewCompletionParams(Ee)),Mt.logTiming("request_params_ready"),t(Ee),je?.onCreateCompletion?.({serverThreadId:te,currentLeafId:Y}),je?.shouldPersistAcrossMessages!==!0&&$t(void 0),rn.hideThreadHeader();for(const oe of me)oe.status===cd.Ready&&$.addFile(oe);xo(),eo(!1),ne&&Go&&rt(D.Search),Qe&&!H&&!ne&&!(Rs&&pr)&&Ke()},gr=m.useRef(Kt);m.useEffect(()=>{gr.current=Kt});const hr=S=>{$t(S.targetedReply),S.targetedReply&&(b.focus(),j.logEventWithStatsig(B.targetedReplyButtonClicked,"chatgpt_targeted_reply_button_clicked",{conversationId:te,sourceMessageId:S.messageId}))},bo=m.useCallback(()=>{je?.onCleared?.({serverThreadId:te,currentLeafId:Y}),$t(void 0),b.focus()},[Y,te,je,$t,b]),So={Enter:{validator:S=>{const V=S.isComposing||S.keyCode===229;return!(Jt&&Hs.current)&&(S.metaKey||(he||gm)&&!S.shiftKey&&!V)},handler:S=>{if(!lt){zs&&z.danger("The message you submitted was too long, please submit something shorter.",{hasCloseButton:!0});return}S.preventDefault(),Kt(S)}},Escape:{validator:S=>!S.isComposing,handler:S=>{h&&p&&(ea(i),j.logEvent(B.pauseCompletion,{threadId:is(i),currentLeafId:X.getCurrentNode(nt(i)).message.id,eventSource:"keyboard"})),S.target.value===""&&bo()}}},kt=m.useRef(So);kt.current=So;const Yt=Uu(n?.tags,q?.kind),{showTaggingDropdown:Vs,isFocused:fr,autocompletions:Ue,matchaData:xr}=gt(b.store),Jt=fr&&Ue.length>0,ut=Yt&&Vs&&!Fs,vo=b.isReady();m.useEffect(()=>b.subscribe("keydown",S=>{b.acceptLegacyKeydown()&&kt.current[S.key].validator(S)&&kt.current[S.key].handler(S);const be=b.getCurrentText();if(S.key==="@"){const pe=b.getSelectionStart(),Ze=be.substring(0,pe);(!Ze||/\s$/.test(Ze)||pe===0)&&setTimeout(()=>b.setShowTaggingDropdown(!0),10)}else Vs&&b.setShowTaggingDropdown(!1);S.key==="Escape"&&(Gt(null),b.setAutocompletions([])),ne&&S.key==="Escape"&&qe(D.Search,!1,{clientThreadId:i})}),[b,vo,Vs,se,ne,qe,i]),m.useEffect(()=>{const S=Object.fromEntries(Object.keys(kt.current).map(V=>[V,pe=>{const Ze=kt.current[V];if(!Ze||b.acceptLegacyKeydown())return!1;const{validator:Mt,handler:Ys}=Ze;return Mt(pe)?(Ys(pe),!0):!1}]));b.registerKeyHandlers(S)},[b,vo]),m.useEffect(()=>b.subscribe("paste",S=>{Gu({filePickerStore:K,event:S,intl:k,toaster:z,clientThreadId:i,conversationMode:q,currentModelConfig:n,getEditorGizmoId:Me,modelSupportedImageMimeTypes:Fe,persistedSystemHints:se})}),[k,i,q,n,Me,Fe,b,z,K,se]);const yo=S=>{fe||Gt(S),b.trimLeadingText("@"),mn(),b.setShowTaggingDropdown(!1)},br=zu(i,Wt,Fe,qt?.attachments),Sr=m.useCallback(S=>{S.preventDefault(),ea(i),j.logEvent(B.pauseCompletion,{threadId:is(i),currentLeafId:X.getCurrentNode(nt(i)).message.id,eventSource:"mouse"}),mn()},[i]),Qt=m.useCallback(()=>{ra.set(F?.id,te,b.getCurrentText())},[te,F?.id,b]);m.useEffect(()=>{le||!Ct&&!Wu()&&b.focus()},[Ct,b]),m.useEffect(()=>{if(Fe.length>0)for(const V of me)km(V.fileSpec?.mimeType,Us)||ms.remove(K,V.tempId,"none");else ms.reset(K)},[a,K]),m.useEffect(()=>{(!Yt&&xe||fe)&&Gt(null)},[Yt,xe,fe]);const{layer:vr}=Tt("4031588851"),{layer:Co}=Tt("3637408529"),yr=Co.get("is_in_composer_text_exp",!1),Cr=Co.get("composer_text","MESSAGE_CHATGPT"),wr=vr.get("composer_text","MESSAGE_CHATGPT"),jr=yr?Cr:wr,[Xt,kr]=(()=>{switch(g){case"workspaceDisallowsGizmo":return[Z.disallowedByWorkspacePlaceholder,!0];case"noModelsAvailable":return[Z.noModelsAvailablePlaceholder,!0];case"requiresPluginsToBeInstalled":return[Z.requiresPluginsToBeInstalled,!0];case"loadingPlugins":return[Z.loading,!0];case"noTestGizmoId":return[Z.noTestGizmoId,!0];default:{if(x)return[Z.placeholderWithName,!1];if(je?.placeholderTextOverride!=null)return[je.placeholderTextOverride,!1];if(G==="initial"||G==="recurrent")return[Z.deepResearchPlaceholder,!1];if(G==="clarify")return[Z.researchSuggestionInitial,!1];switch(jr){case"BLANK":return[null,!1];case"ASK_ANYTHING":return[Z.placeholderAskAnythingVariant,!1];case"ASK_CHATGPT_ANYTHING":return[Z.placeholderAskNameAnythingVariant,!1];default:return[Z.placeholderWithName,!1]}}}})(),$s=Fs?d?k.formatMessage(Vu.newChatInProject):Xt?k.formatMessage(Xt,{name:"ChatGPT"}):"​":Xt?k.formatMessage(Xt,{name:le!=null?_e==="magic"?$u:le.name||"GPT":Je?.gizmo.display.name??"ChatGPT"}):"​";m.useEffect(()=>b.subscribe("input",()=>{qu.getState().isThreadHeaderVisible&&rn.hideThreadHeader()}),[b]),m.useEffect(()=>b.subscribe("input",()=>{Ls.current=performance.now(),C?.()}),[b,C]),m.useEffect(()=>{if(v)return b.subscribe("change",()=>{v()})},[b,v]);const _r=tr||sr||ar(),wo=Ku()&&!!Ue.find(S=>!!S.requires_file_upload),Mr={clientThreadId:i,uploadType:wt,modelAcceptedMimeTypes:Us,modelSupportedImageMimeTypes:Fe,attachmentsProductFeature:qt?.attachments,getInputProps:ur,openFileDialog:dr,historyDisabled:de,onOauthRedirect:Qt,highlightTooltip:wo&&!Oe},Zt=[],jo=[],ko=!c&&!uo&&(oo||Yi!=null)&&!ne,_o=or(),Ar=!y||_o||zt,Mo=wt===st.None?Re.ModelNotSupported:Ye?Re.ThinkModeInUse:ne?Re.SearchModeInUse:void 0;if(Ar){const S=e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-attach-file-action)"},children:e.jsx(Ng,{...Mr,showLabel:nr()==="all",showUpsell:_o&&!zt,showMenuForNoAuth:zt,isDisabled:!ko||ct,disabledReason:Mo,currentModelName:n?.title??""})},"file-upload-button");Zt.push(S),jo.push(S)}const Ge=[],Ao=Dn();let es="bottom";Ao?es="bottom":d&&(es="centered"),Ge.push(e.jsx(Wp,{account:o,clientBootstrapFlags:so,features:J,currentModelConfig:n,hasFiles:Oe,isDisabled:ct||Oe,clientThreadId:i,composerController:b},"search"));const{value:Nr}=ve("1830177352");jt||Ge.push(e.jsx(Up,{clientThreadId:i,gizmoId:Je?.gizmo.id,composerController:b,isDisabled:ct},"reason")),Nr&&Ge.push(e.jsx(Hp,{clientThreadId:i,showLabel:_r,isDisabled:ct},"deep-research")),Ge.push(e.jsx(dg,{clientThreadId:i,composerController:b,isDisabled:ct,currentModelConfig:n,currentModelConfigLoading:l,disableIfNoAccess:jt},"shiba")),jt&&Ge.push(e.jsx("div",{className:"flex [--pill-color:var(--text-secondary)] [--pill-font-size:13px]",onPointerDown:S=>S.stopPropagation(),children:e.jsx(sg,{clientThreadId:i,layoutMode:es,currentModel:n,category:to,type:Os})},"reasoning-level")),Zn&&Bs&&Bs.connection_statuses.length>0&&Ge.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-search-action)"},children:e.jsx(Lg,{composerController:b,systemHint:Zn,clientThreadId:i,connectionStatuses:Bs.connection_statuses})},"contextual-answers")),lr&&Ge.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-system-hint-action)"},children:e.jsx(Rg,{composerController:b,clientThreadId:i,disabled:ct,hideThinkButton:jt,disableIfNoAccess:jt})},"system-hint-button")),Zt.push(...Ge);const qs=kr?"disabled":"default",No=p&&h,Pr=im(),Er=_m(),Tr=ve("3544641259")?.value,Po=!!(Er&&Tr&&Ds?.size===0),Rr=!lt||Ct||Pr||Po,Ks=Nm(io,lo,zs,Zi,Po),Xe=No?"streaming":Rr?"disabled":"idle",_t=m.useRef(null),dt=m.useRef(null),{value:Ir}=ve("222560275"),Br=Ir||a&&!a.startsWith("o1")&&!a.startsWith("o3");m.useEffect(()=>{const S=()=>{_t.current!=null&&hm.addAction("composer_state_disabled",{threadId:is(i),disabledReason:_t.current})};if(Vt&&Xe==="disabled"){let V="unknown";c?V=g??"component_disabled_unknown":p?V="completion_in_progress":we?V="thread_hard_blocked":Ct&&(V="starting_new_completion_request"),_t.current!==V&&(dt.current&&clearTimeout(dt.current),dt.current=setTimeout(S,Jg)),_t.current=V}else _t.current=null;return()=>{dt.current&&(clearTimeout(dt.current),dt.current=null)}},[i,Vt,Xe,c,g,p,we,Ct]);const ts=[];if(je?.label&&ts.push({type:je.type,value:je.label,onRemoveRegion:bo}),xe!==null){const S=!!xe.gizmo.tags?.includes(ks.FirstParty);ts.push({type:"mention",value:xe.gizmo.display.name,icon:e.jsx(mi,{isFirstParty:S,src:xe.gizmo.display.profile_picture_url,className:"icon-md"}),onRemoveRegion:()=>{Gt(null),b.focus()}})}m.useEffect(()=>{(!Ue||Ue.length===0||!Jt)&&(Hs.current=!1)},[Ue,Jt]);const Dr=(S,V,be)=>{Hs.current=S>=0,V&&b.setText(be?`${be.title}${be.body}`:"")},Eo=Jt&&Ue&&Ue.length>0&&!ut&&!H&&!b.hasMultipleLines()&&b.canShowAutocompletion();m.useEffect(()=>{ut?M?.():_?.()},[ut,M,_]);const ss=S=>{if(Ls.current>0){const V=performance.now()-Ls.current;ud.hist(dd.DEFAULT,"final_user_input_to_submit_ms",[],V)}Xe==="streaming"&&(!Ut||b.isEmpty())?Sr(S):Kt(S)},Lr=Yu(n,Wn.Canvas),{value:Hr}=Be("61299031"),Fr=Ju(),Or=Lr&&Hr&&!Fr&&!ao&&!Ao;m.useEffect(()=>{},[$i,b]),m.useEffect(()=>{const S=is(i);if(!S)return;const V=o?.normalizedAccountUserId;if(!V)return;const be=Ss(()=>{const pe=b.getContentToSend().content;pe===""?rm(S):lm(S,pe,V)},1e3);return b.subscribe("change",be)},[o,i,b,te]);const To=e.jsx(og,{canUseInlineTagging:Yt,isDisabled:c,clientThreadId:i,currentLeafId:Y,currentRequestId:ae,canContinue:f,composerController:b,isNewThread:d,onCreateNewCompletion:t,onContinueGenerating:s,onResetState:xo,conversationMode:q,isShowingAutocomplete:!!Eo}),Ro=!No&&q!=null&&Br&&Qu.includes(q.kind)&&e.jsx(Xu,{clientThreadId:i,onTargetedReply:hr}),Io=Eo&&e.jsx("div",{className:R("absolute left-0 z-[-1] box-border w-full pl-0 max-lg:bottom-full lg:top-full",Qe?"bg-transparent":"bg-token-main-surface-primary"),children:e.jsx(Em,{suggestions:Ue,composerController:b,onSelect:w,onChange:Dr})}),Bo=e.jsx(md,{composerController:b,parsedDocumentHandler:br}),Do=!T&&e.jsx(ji,{className:E}),Lo=e.jsx(Zu,{modelSupportedImageMimeTypes:Fe,uploadType:st.Multimodal,attachmentsProductFeature:qt?.attachments}),Ur=e.jsxs(e.Fragment,{children:[ut&&e.jsx(da,{onClick:S=>yo(S),onClose:()=>{b.setShowTaggingDropdown(!1),b.focus()}}),Ws&&e.jsx(ha,{composerController:b,clientThreadId:i})]}),{isImageGenEditor:Ho}=ed();return Ho?e.jsxs(ta.Provider,{value:Wt,children:[e.jsx(sa,{onOauthRedirect:Qt,children:e.jsx("form",{className:u,onSubmit:ss,children:e.jsxs("div",{className:"relative z-[1] flex h-full max-w-full flex-1 flex-col",children:[Do,e.jsxs("div",{className:"group relative z-[1] flex w-full items-center",style:{"--force-hide-label":ir?"none":"block"},children:[e.jsxs(Ms,{open:ut||Ws,children:[e.jsx(yn,{className:"w-full",children:Ho?e.jsx(Kg,{type:de?"temporary":"default",ref:A,placeholder:$s,inputState:qs,composerController:b,leftSideActions:jo,state:Xe,onSubmit:ss,renderFiles:Oe&&e.jsxs(e.Fragment,{children:[_e==="magic"&&e.jsx("div",{className:"m-2 mb-0 rounded-lg bg-token-main-surface-secondary p-2 text-xs text-token-text-secondary",children:e.jsx(N,{...Z.gizmoKnowledgeWarning})}),e.jsx(cn,{files:me,className:"-ml-1.5 flex flex-nowrap gap-2 overflow-x-auto p-1.5"})]}),clientThreadId:i,gizmoId:Je?.gizmo.id,disableReason:Ks,modelId:a}):e.jsx(Pg,{type:de?"temporary":"default",ref:A,replyRegions:ts,placeholder:$s,inputState:qs,setIsComposerOverflowing:rr,composerController:b,matchaData:xr,leftSideActions:Zt,topRightAction:Or&&e.jsx(td,{composerRef:A,composerController:b,clientThreadId:i}),state:Xe,onSubmit:ss,renderFiles:Xi&&e.jsxs(e.Fragment,{children:[_e==="magic"&&e.jsx("div",{className:"m-2 mb-0 rounded-lg bg-token-main-surface-secondary p-2 text-xs text-token-text-secondary",children:e.jsx(N,{...Z.gizmoKnowledgeWarning})}),e.jsx(cn,{files:me,selectedApps:Gs,className:"-ml-1.5 flex flex-nowrap gap-2 overflow-x-auto p-1.5"})]}),clientThreadId:i,gizmoId:Je?.gizmo.id,disableReason:Ks,modelId:a})}),e.jsx(As,{children:e.jsxs(Ns,{side:"bottom",align:"start",sideOffset:12,onOpenAutoFocus:S=>S.preventDefault(),children:[ut&&e.jsx(da,{onClick:S=>yo(S),onClose:()=>{b.setShowTaggingDropdown(!1),b.focus()}}),Ws&&e.jsx(ha,{composerController:b,clientThreadId:i})]})})]}),Io]}),Bo,Lo]})})}),To,Ro]}):e.jsxs(ta.Provider,{value:Wt,children:[e.jsx(sa,{onOauthRedirect:Qt,children:e.jsxs("div",{className:R(`relative z-[1] flex max-w-full flex-1 flex-col ${Qe?"":"h-full"}`,!Qe&&"max-xs:[--force-hide-label:none]",Os!=="none"&&!P&&"[--force-hide-label:none]"),children:[Do,e.jsx(qg,{visualTreatment:Qe?"vanguard":"legacy",hasFiles:Oe,pendingFiles:me,isUploadDisabled:!ko,clientThreadId:i,serverThreadId:te,getEditorGizmoId:Me,highlightUploadTooltip:wo&&!Oe,disableReason:Ks,uploadButtonDisabledReason:Mo,currentModel:n,category:to,layoutMode:es,conversationMode:q,onOauthRedirect:Qt,state:Xe,inputState:qs,gizmoId:Je?.gizmo.id,isTemporaryChat:de,placeholder:$s,composerController:b,onSubmit:ss,replyRegions:ts,keepExpanded:d||!Qe,legacyFooterActions:Zt,legacySuggestionsPopoverContent:Ur}),Io]})}),Bo,To,Ro,Lo]})}const bh=({clientThreadId:t,isNewThread:s,isGizmoThread:o,isProjectThread:a,isModelLoaded:n,currentModelId:r,onRequestCompletion:l,shouldUseUnifiedComposer:i,isVanguardUxEnabled:d})=>{const p=Es(),u=m.useContext(fm),c=xm(u),g=pd();gd(p);const h=e.jsxs(e.Fragment,{children:[e.jsx(Sp,{clientThreadId:t}),e.jsx(Zs,{verticalMargin:"none",isStaticSharedThread:g,verticalPadding:c?"last-standard":"none",horizontalPadding:"standard",children:e.jsx(en,{children:e.jsx(Xg,{clientThreadId:t,currentModelId:r,isNewThread:s,hideHeader:s,onRequestCompletion:l,onAutocompleteSelect:p.onAutocompleteSelect})})})]});return i?e.jsxs(e.Fragment,{children:[e.jsx(U.div,{layout:!0,transition:{type:"spring",bounce:.1,duration:.5},children:h}),s&&e.jsx("div",{className:R("[display:var(--display-hidden-until-loaded,block)]",d?"min-h-[100px]":"md:absolute md:bottom-6 md:left-0 md:w-full"),children:e.jsx(Zs,{verticalMargin:"none",verticalPadding:"none",horizontalPadding:"standard",children:e.jsx(en,{children:e.jsx(ji,{className:"block flex-1"})})})}),s&&!o&&!a&&!d&&e.jsx(Zs,{verticalMargin:"none",verticalPadding:"none",horizontalPadding:"standard",children:e.jsx(en,{children:e.jsx(xp,{clientThreadId:t,currentModelId:r,isModelLoaded:n})})})]}):h};function Xg({clientThreadId:t,currentModelId:s,isNewThread:o,onRequestCompletion:a,onComposerInput:n,onComposerChange:r,onAutocompleteSelect:l,headerClassName:i,hideHeader:d,onTaggingDropdownClose:p,onTaggingDropdownOpen:u}){const{data:c,isLoading:g}=Vn(),[h,f,x,C]=re(t,J=>{const he=X.getCurrentNode(J);return[he.message.clientMetadata?.errType!=null&&he.message.clientMetadata.errType!=="info",bm(X.getCurrentNode(J).message),J?.mode,J?.continuingFromSharedConversationId!=null]}),v=$e(),w=Sm({clientThreadId:t}),{isOpen:E,onClose:T}=hd({type:"just-hit-rate-limit"}),{value:M}=Be("1988730211"),_=$n(),L=m.useCallback(J=>{j.logEvent(B.continueCompletion);const he=Array.from(_),{systemHints:de,extraStreamParams:He}=M?fd(he):{systemHints:he,extraStreamParams:{}};a({sourceEvent:J,completionType:vm.Continue,extraStreamParams:He,completionMetadata:{conversationMode:nt(t)?.mode,systemHints:de}})},[_,M,a,t]),b=m.useCallback(J=>{a(J)},[t,a,null,v?.normalizedAccountUserId]),F=xd(),P=m.useCallback(Ss(()=>qr(t,s),5e3,{leading:!0,trailing:!0}),[t,s]),O=m.useCallback(Ss(()=>Kr(t),5e3,{leading:!0,trailing:!0}),[t]),y=m.useCallback(()=>{r?.(),F&&P();const J=ym("3257646228");!F&&J&&O()},[P,O,F,r]);m.useEffect(()=>{w||(P.cancel(),O.cancel())},[w,P,O]);const k=m.useMemo(()=>w?!1:!h&&f,[h,f,w]),z=w,K=Qa(t),$=_a(K).data,Y=Cm(),ae=$?.gizmo.tags?.includes(ks.WorkspaceDisabled)&&!Y?"workspaceDisallowsGizmo":c?.models.size===0?"noModelsAvailable":x?.kind===Ae.GizmoTest&&x.gizmo_id==null?"noTestGizmoId":null,ue=$r(),le=bd(),_e=ue.action==="moderate",{value:Me}=ve("1860647109");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-center empty:hidden",children:le&&_e&&Me?e.jsx(Sd,{}):null}),E?e.jsx(vd,{onClose:T}):null,e.jsx(Qg,{clientThreadId:t,onCreateNewCompletion:b,onContinueGenerating:L,currentModelId:s,account:v,modelCategories:c?.categories,currentModelConfig:Ra(c?.models,s),areModelsLoading:g,isNewThread:o,isCompletionInProgress:w,className:"w-full",canContinue:k,disabled:!!ae,disabledReason:ae??void 0,canPause:z,isInteractableSharedThread:C,onComposerInput:n,onComposerChange:y,onAutocompleteSelect:l,headerClassName:i,hideHeader:d,onTaggingDropdownClose:p,onTaggingDropdownOpen:u},t)]})}export{bg as D,xh as F,ph as I,gh as M,fh as O,Xg as P,bh as T,mh as a,ji as b,xp as c,hh as d,xg as g,Yn as h,Xn as u};
//# sourceMappingURL=j52f6094ws633vn3.js.map
