import{al as I,E as q,eS as R,F as O,d as v,b$ as K,k as V,aS as Y,aM as Q,a3 as W,am as $,aq as X,R as B,D as J,n as Z}from"./cyi7nanrg0vdotzd.js";import{g6 as ee,M as te,U as re,g7 as N,z as se,g8 as ae,eC as oe,g9 as z,eg as ne,a4 as ie,eD as E,ab as ce,p as le,e7 as ue,ga as pe,gb as T,gc as me}from"./df9u9imhvwerk6zv.js";import{u as de}from"./exwx6mc6hw49alht.js";import{r as y,j as m,a5 as G,u as fe}from"./fs6h2trisr1juto6.js";import{u as he,a as Se,t as ye}from"./kg9pnjn9ianmg7dc.js";function xe(){const{store:e}=ee(),t=he(),{clearSystemHintModeTrigger:p,getSystemHintModeTrigger:s}=Se(),{value:u}=I("1988730211"),c=!te.useDisabledGlobally();return y.useCallback((d,a,h,l)=>{const f=e.getSharedProps();if(!f)return;const{clientThreadId:b,onCreateNewCompletion:w,onResetState:o,conversationMode:r}=f;re.hideThreadHeader();const n=t.has(N.Search),x=n?s(N.Search):void 0,C=q(b),{systemHints:A,extraStreamParams:g}=u?se(Array.from(t)):{systemHints:Array.from(t),extraStreamParams:{}};c&&(g.enableMessageFollowups=!0);const k=ae(),P={is_starter_prompt:!0,suggestion_type:a.type,starter_prompt_id:"id"in a?a.id:void 0};k&&(P.__internal={search_settings:k});const _=R(oe(a),P);w({promptMessage:_,sourceEvent:d,extraStreamParams:g,completionMetadata:{suggestions:h,suggestion:a,suggestionIndex:l,conversationMode:r??C?.mode,systemHints:A,searchSource:x}});const S=O.getCurrentNode(C).message.id;o(),z(a,l,b,S),ne()||ye(),x&&n&&p(N.Search)},[e,t,s,u,p,c])}function _e({suggestions:e,composerController:t,onSelect:p,onChange:s}){const{isUXUpdatesEnabled:u}=ie(),c=xe(),d=y.useCallback((o,r,n,x)=>{p?.(r,n,x),c(o,r,n,x)},[p,c]),[a,h]=y.useState(()=>e.length>0),[l,f]=y.useState(-1),[b,w]=y.useState(!1);return y.useEffect(()=>{const o=r=>{if(!r.isComposing)if(r.key==="ArrowDown"){const n=l===e.length-1?0:l+1;f(n),s?.(n,!0,e[n])}else if(r.key==="ArrowUp"){r.preventDefault();const n=l<=0?e.length-1:l-1;f(n),s?.(n,!0,e[n])}else r.key==="Enter"&&!r.shiftKey&&e[l]&&d(r,e[l],e,l)};return t.subscribe("keydown",o)},[e,l,s,d,t]),y.useEffect(()=>t.subscribe("blur",()=>{f(-1),h(!1),s?.(-1,!1)}),[t,s]),y.useEffect(()=>t.subscribe("focus",()=>h(!0)),[t]),y.useEffect(()=>{if(!b){const o=()=>{w(!0),window.removeEventListener("mousemove",o)};return window.addEventListener("mousemove",o),()=>{window.removeEventListener("mousemove",o)}}},[b]),y.useEffect(()=>{f(-1),s?.(-1,!1),w(!1)},[e,s]),m.jsx(G.ul,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:v("w-full flex-col p-2.5 max-lg:flex-col-reverse",a?"flex":"hidden"),children:e.map((o,r)=>m.jsxs(G.li,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:r*.03},exit:{opacity:0,translateY:4},className:"w-full",children:[r>0&&m.jsx("div",{className:v("h-[1px] opacity-60 max-lg:hidden",l===r||l===r-1?"mx-2 bg-token-main-surface-secondary":"bg-token-border-light")}),m.jsxs("button",{className:v("flex w-full cursor-pointer items-center justify-start whitespace-pre-wrap rounded-lg px-2.5 py-3 text-start",l===r?"bg-token-main-surface-secondary":u?"bg-transparent":"bg-token-main-surface-primary"),onClick:n=>{n.preventDefault(),d(n,o,e,r)},onMouseDown:n=>{n.preventDefault()},onMouseEnter:()=>{b&&(f(r),s?.(r,!1,o))},onMouseLeave:()=>{f(-1),s?.(-1,!1,o)},children:[o.icon?m.jsx("span",{className:"mr-2 h-[18px] w-[18px] text-token-text-secondary",children:o.icon}):null,m.jsx("span",{className:"whitespace-pre-wrap text-sm",children:o.autocompletionChunks&&o.autocompletionChunks.length>0?m.jsx(m.Fragment,{children:o.autocompletionChunks.map((n,x)=>m.jsx("span",{className:v(n.isMatched?"text-token-text-tertiary":"text-token-text-primary"),children:n.text},x))}):m.jsxs(m.Fragment,{children:[m.jsx("span",{className:v(o.type===E.Starter||o.type===E.Trending?"text-token-text-secondary":"text-token-text-tertiary"),children:o.title}),m.jsx("span",{className:"text-token-text-primary",children:o.body})]})})]}),r>0&&m.jsx("div",{className:v("h-[1px] opacity-60 lg:hidden",l===r||l===r-1?"mx-2 bg-token-main-surface-secondary":"bg-token-border-light")})]},o.id??r))})}function be(e,t){e=e.toLocaleLowerCase();const p=t;t=t.toLocaleLowerCase();const s=[];let u=0;for(let a=0;a<t.length&&(u<e.length&&e[u]===t[a]&&(s.push(a),u++),u!==e.length);a++);const c=[];let d=0;if(s.forEach(a=>{if(a>d){const h=p.slice(d,a);h&&c.push({text:h,isMatched:!1})}c.push({text:p[a],isMatched:!0}),d=a+1}),d<t.length){const a=p.slice(d);a&&c.push({text:a,isMatched:!1})}return Me(c)}function Me(e){if(e.length===0)return e;let t=[e[0]];for(let s=1;s<e.length;s++){const u=t[t.length-1],c=e[s];u.isMatched===c.isMatched?u.text+=c.text:t.push(c)}const p=t.filter(s=>s.isMatched).reduce((s,u)=>s+u.text.trim().length,0);return t.length<=4&&p>=2?t:[{text:t.map(s=>s.text).join(""),isMatched:!1}]}function U(e){return(ce(e)?e.promptStarters:e.gizmo.display.prompt_starters)?.map(t=>({type:E.Starter,title:"",body:t,prompt:t}))}const we=()=>{const e=K(),t=V();return!(Y(e)?t.getLayer("4031588851"):t.getLayer("3533083032")).get("web-disable",!1)},Te=({clientThreadId:e,limit:t,shouldBeEnabledForDefaultAssistant:p,isModelLoaded:s,modelSlug:u})=>{const c=de(),d=Q(),a=W(e,i=>i?.mode),h=le(a?.kind===$.GizmoInteraction?a.gizmo_id:void 0).data,{gizmoEditorData:l,mode:f}=ue(),b=we(),w=pe(a),o=X(),r=b&&p&&!w&&!o?.isEnterprisey(),{data:n,isSuccess:x}=fe({queryKey:["promptStarters",e,t,u],queryFn:async()=>{const i=await B.safeGet("/prompt_library/",{parameters:{query:{limit:t,use_v2:!0,model_slug:u}},anonAware:!0});return J.addFirstTiming("load.promptStarters"),i},enabled:r});if(d==null)return{promptStarters:[],isLoading:!0,isSuccess:!1};if(f==="test"&&l)return{promptStarters:U(l)??[],isLoading:!1,isSuccess:!0};if(h!=null)return{promptStarters:U(h),isLoading:!1,isSuccess:!0};if(!r)return{promptStarters:[],isLoading:!1,isSuccess:!0};const C=n?.items.map(i=>({type:E.Starter,id:i.id,title:i.title,body:i.description,prompt:i.prompt,category:i.category,oneliner:i.oneliner,theme:i.theme,requires_file_upload:i.requires_file_upload}))??[],A=(i,S,ge,H)=>{const F=S.title;c.setAutocompletions([]),c.focus(),c.setText(F),requestAnimationFrame(()=>{const j=C.filter(M=>M.theme===S.theme).map(M=>{const L=Z(M.oneliner),D=L.startsWith(M.title);return{...M,title:D?`${M.title} `:"",body:D?M.body:L,autocompletionChunks:be(F,L),type:E.Autocomplete}});c.setAutocompletions(j),j.length>0&&me(j,e),z(S,H,e)})},g=C?.reduce((i,S)=>(S.theme&&!i[S.theme]&&(i[S.theme]=S),i),{}),k=[];if(g)for(const i in g)i!=="For you"&&k.push(g[i]);const P=k.length>0,_=!!(p&&x&&P&&s);return p&&(T.markStart("StarterPromptChips",T.NS_COMPOSER),_&&T.markRendered("StarterPromptChips",T.NS_COMPOSER)),{onSelectStarterPrompt:A,shouldShowStarterPrompts:_,promptStarters:k}};export{_e as A,we as a,Te as b,U as g,xe as u};
//# sourceMappingURL=juans7zh9ytz81kz.js.map
