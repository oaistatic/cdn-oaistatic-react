const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/mqwpzc3bip82uqzz.js","assets/fs6h2trisr1juto6.js","assets/cyi7nanrg0vdotzd.js","assets/root-drzjahv8.css","assets/kd074dsva4b3ysqe.js","assets/olum39tx3ecm9sq0.js","assets/df9u9imhvwerk6zv.js","assets/conversation-small-kx6wglz1.css","assets/nqnvzw53d4de6cy7.js","assets/eq34zwf9q18c17ro.js","assets/u1emcz4jyxh04z01.js","assets/m7lukv8dnept58g2.js","assets/e2l59f6c7bsm78ye.js","assets/juans7zh9ytz81kz.js","assets/exwx6mc6hw49alht.js","assets/kg9pnjn9ianmg7dc.js","assets/f3zzw463zuggq6da.js","assets/069jlavvvdusqrfm.js","assets/g2mpepuj81v2h1vf.js","assets/v5hiekyjowt3msdw.js","assets/ms40jzicf31mvoix.js","assets/k9y760q7nnqywujw.js","assets/e4r3qaiq4hir6yrn.js","assets/fh68r81diqqkrx7y.js","assets/bg82vxo39mz0x6ax.js","assets/hyj1ewu0eyfbsrce.js","assets/exogbkqhbs3sd47e.js","assets/c1p22j8o7hm9vv5x.js","assets/il50daha0kb70ufn.js","assets/pcjkp37t4ugnklc3.js","assets/h7ui9r0100fo3zi2.js","assets/gy64pge8qevmvg7e.js","assets/ksgfhnrswte6iw5i.js","assets/dtx9fzvfshnw2efc.js","assets/h55t7ofrlf5o55fq.js","assets/oetwuhpmhqg31xga.js","assets/jfi01owl9mian83i.js","assets/iot2esljs5ma74te.js","assets/0i74lvadqrdq6g27.js","assets/hkx8od28rq7ar5x0.js"])))=>i.map(i=>d[i]);
import{d as A,bS as Rt,cA as Ls,dA as mn,j as Re,aG as Ae,R as gn,A as hn,aF as re,Z as Be,dE as Pt,W as ot,bJ as Hs,a0 as Ft,ai as pn,C as ns,h as os,gb as fn,I as dt,bG as xn,er as Dt,bP as ge,bQ as je,aq as Gs,cL as Os,P as $,a as B,bH as _e,gl as Bs,a3 as ee,n as rs,F as U,D as ze,B as L,aT as De,aV as Ut,l as Ue,E as lt,g4 as vn,aZ as zs,a4 as Lt,y as Z,c4 as Ht,cH as me,dC as bn,c2 as ae,el as yn,da as Sn,eB as jn,S as ne,aD as Vs,bC as _n,gN as Cn,b$ as Ws,V as qs,T as wn,d6 as Mn,ej as Tn,am as Gt,c6 as kn,fL as Nn,fB as En,aP as In,a9 as An,a1 as $s,dM as Qs,M as Rn,bR as Pn,c5 as Fn,X as Dn,J as Un,eg as is,eZ as Ln,gg as Hn,bL as Gn,gO as Ks,aM as On,bz as Bn,gP as zn,e9 as Vn}from"./cyi7nanrg0vdotzd.js";import{e as Ce,a5 as z,r,j as e,v as Wn,d as ut,a7 as Pe,M as G,ao as qn,al as $n,ai as ls,R as Xs,b as Qn}from"./fs6h2trisr1juto6.js";import{m as Kn,u as Xn}from"./f3zzw463zuggq6da.js";import{g as Yn,u as mt,C as Ys,m as Zn,j as Jn,l as eo}from"./exwx6mc6hw49alht.js";import{a4 as We,ms as q,eD as se,gc as cs,d as Zs,g7 as Se,lD as to,mt as so,mu as ao,bn as gt,H as Js,mv as ds,ku as Ie,mw as no,mx as oo,my as ro,mz as Ot,mA as io,mB as _t,mC as lo,mD as co,bf as ea,en as us,eo as ms,I as Bt,cQ as uo,a8 as ta,u as mo,P as sa,mE as go,p as aa,R as ho,mF as po,mG as fo,mj as xo,gU as vo,mH as bo,V as yo,W as gs,gq as So,aa as jo,X as _o,mI as Co,e7 as wo,i0 as Nt,di as Mo,mJ as na,mK as hs,mL as To,mM as ko,kY as No,k$ as Eo,mN as Io,mO as Ao,mP as et,jE as oa,mQ as Ro,gW as Po,gX as Fo,eC as rt,ep as Do,eq as Uo,er as Lo,eu as Ho,es as Go,M as ra,dI as Oo,mR as Bo,mS as zo,lJ as Vo,mT as Wo,mU as qo,mV as $o,mW as tt,kK as ia,aj as Qo,mX as Ko,mY as Xo,mZ as la,m_ as ca,h3 as it,h5 as Yo,gH as da,h6 as Zo,gI as ua,m$ as Jo,U as Ve,hl as er,n0 as tr,n1 as sr,v as ar,cM as ma,cN as ga,eS as nr,cY as or,n2 as rr,gE as ir,cZ as ha,c4 as pa,gV as lr,n3 as cr,eG as dr,n4 as ur,n5 as mr,n6 as gr,n7 as hr,kO as pr,hc as fr,cx as xr,n8 as vr,n9 as br,c_ as yr,na as Sr,nb as jr,nc as _r,kv as ct,nd as Et,dM as Cr,ne as wr,nf as fa,he as Mr,fu as Tr,fE as kr,fD as Nr,ng as Er,g6 as Ir,nh as xa,m5 as Ar,m6 as Rr,m4 as Pr,ni as Fr,nj as Dr,nk as Ur,nl as Lr,nm as Hr,$ as Gr,jQ as Or,jR as Br,c5 as zr,jb as Vr,nn as Wr,no as Ct,eJ as qr,y as $r,np as Qr,e8 as Kr,nq as Xr,nr as Yr,ns as Zr,nt as Jr,nu as ei,dQ as ti,w as si,kP as ai,nv as ni,nw as oi,nx as ri,gt as ii,ny as li,nz as ci,nA as di,hq as ui,mf as mi,nB as gi,g0 as hi}from"./df9u9imhvwerk6zv.js";import{a as pi}from"./m7lukv8dnept58g2.js";import{u as va,c as fi,a as xi,d as ps,e as vi,P as bi}from"./kg9pnjn9ianmg7dc.js";import{b as fs,P as yi,c as Si,M as ji,d as _i,O as Ci,F as wi,T as Mi}from"./j52f6094ws633vn3.js";import{a as Ti,u as ki}from"./juans7zh9ytz81kz.js";import"./egq3i0oq39kux8fj.js";import{c as Ni,u as Ei}from"./nlkl42j3n1q6imdw.js";import{a as Ii,G as Ai}from"./e2l59f6c7bsm78ye.js";import{C as It,F as Ri}from"./ca8xspsebes9twfc.js";import{P as Pi}from"./jo3x2yf4dp19h25k.js";import{u as Fi}from"./b22a1k4ozfgjkxq7.js";import{g as Di}from"./bibq00lzerxkdtcb.js";const Ui=19,Li=4,Hi=8,Gi=2,Oi=({as:t="div",logo:s,size:n="default",label:a,isBadge:o,isNew:l,isLauncher:i,selected:c=!1,tooltip:m,...g})=>{const x=Ce(),h=n==="large"?Ui:Hi,p=n==="large"?Li:Gi,d=t==="div"?z.div:z.button,[u,v]=r.useState(!1),b=()=>{i&&v(!0)},C=()=>{i&&v(!1)};return e.jsxs(d,{className:A(`flex cursor-pointer flex-col items-center gap-3 w-${h}`,o?"scale-[0.9]":"","opacity-80 can-hover:group-hover:opacity-100",i&&"py-4"),onMouseEnter:b,onMouseLeave:C,...g,children:[e.jsxs("div",{className:A("relative rounded-full transition-all duration-[0.24s]",u&&i&&!c&&"scale-[0.96] shadow-2xl",i&&"scale-[0.9] border border-token-border-light shadow-2xl",i&&c&&"shadow-none",o&&"border border-token-border-light shadow-[0px_4px_6px_rgba(0,0,0,0.04)]","can-hover:group-hover:motion-safe:scale-[0.95] can-hover:group-hover:motion-safe:drop-shadow-[0px_24px_26px_rgba(0,0,0,0.24)]"),children:[e.jsx(Rt,{label:m,side:"top",children:e.jsx("div",{className:A(`w-${h} h-${h} flex aspect-square items-center justify-center rounded-full border [color:var(--tint-color,#0285FF)] p-${p}`,c?"border-[#0285FF14] bg-token-composer-blue-bg dark:bg-[#0285FF40]":"border-transparent bg-white",o?"dark:bg-token-main-surface-primary":"dark:bg-token-main-surface-secondary"),children:e.jsx("div",{className:A("transition-all duration-[0.24s]",u&&i&&!c&&"drop-shadow-[0_6px_4px_rgba(0,0,0,0.1)]",u&&i&&!c&&"scale-[1.025]"),children:s})})}),l&&e.jsx("div",{className:"absolute -left-1 -top-1 z-10 rounded-full bg-blue-500 px-2 py-1 text-[10px] font-bold text-token-text-primary",children:x.formatMessage({id:"kEZrwC",defaultMessage:"New"})})]}),a&&e.jsx("div",{className:A("text-center text-[12px] leading-[17px]",c&&"text-blue-1000",!i&&"w-20"),children:a})]})},Bi=4,zi=3,Vi=async({text:t,numCompletions:s,isUnauthenticated:n,isThreadUsingSearchMode:a=!1,autocompleteMode:o,activeSystemHint:l})=>{try{return(n?await Be.generateAutocompletionsAnon(t,s,a,l):await Be.generateAutocompletions(t,s,a,l)).completions.map(c=>({id:Wn(),type:se.Autocomplete,title:c.slice(0,t.length),body:c.slice(t.length),oneliner:c,prompt:c,source:o}))}catch{return[]}},Wi=({clientThreadId:t,composerController:s})=>{const n=Ls(s.store,F=>F.showTaggingDropdown),a=va(),o=Array.from(a)[0],l=r.useRef(void 0),[i,c]=r.useState([]);r.useState([]),r.useRef(0);const{isUXUpdatesEnabled:m}=We(),g=m?zi:Bi,[x,h]=r.useState(),p=r.useCallback(F=>{c(P=>{const D=typeof F=="function"?F(P):F;return mn(D,P)?P:D})},[]),{trendingSuggestions:d,fetchTrendingSuggestions:u}=qi(g),{isUnauthenticated:v}=Re(),b=fi(),C=r.useCallback(F=>{const P=s.getCurrentText();return P&&wt(F).startsWith(P.toLocaleLowerCase())},[s]),k=r.useCallback(F=>{const P=s.getCurrentText(),D=F.title+F.body;return C(F)?{...F,title:P,body:D.slice(P.length)}:{...F,title:D,body:""}},[s,C]),N=r.useCallback((F=!1)=>{p(P=>!P.some(C)&&P.length>0?[]:F?P:P.map(k))},[C,k,p]),f=Ce(),y=r.useMemo(()=>({[q.Canvas]:[{type:se.Starter,title:f.formatMessage({id:"GMvniX",defaultMessage:"Help me write a birthday message for a friend"}),prompt:f.formatMessage({id:"JInqHw",defaultMessage:"Help me write a birthday message for a friend"}),body:"",theme:q.Canvas},{type:se.Starter,title:f.formatMessage({id:"Xwp6O+",defaultMessage:"Help me write a short story"}),prompt:f.formatMessage({id:"e2j3PL",defaultMessage:"Help me write a short story set in a post-apocalyptic Tokyo, focused on a character who’s discovering a long-lost secret"}),body:"",theme:q.Canvas},{type:se.Starter,title:f.formatMessage({id:"ARQf7p",defaultMessage:"Help me write a basic outline for an essay"}),prompt:f.formatMessage({id:"K0WcGA",defaultMessage:"Help me write a basic outline for an essay"}),body:"",theme:q.Canvas},{type:se.Starter,title:f.formatMessage({id:"z+JwEj",defaultMessage:"Create a business plan outline"}),prompt:f.formatMessage({id:"4c/Ux5",defaultMessage:"Create a detailed outline for a business plan for a new app that connects local artists with buyers. Include sections for market analysis, monetization, and user acquisition"}),body:"",theme:q.Canvas}],[q.Image]:[{type:se.Starter,title:f.formatMessage({id:"noA7wB",defaultMessage:"Design a modern logo"}),prompt:f.formatMessage({id:"k53BuX",defaultMessage:"Create a modern, minimalist logo for a tech startup called ‘Nexora’. It should use bold typography and a sleek geometric icon, suitable for both light and dark backgrounds"}),body:"",theme:q.Image},{type:se.Starter,title:f.formatMessage({id:"akHy6z",defaultMessage:"Create an invite for my birthday"}),prompt:f.formatMessage({id:"BXf15G",defaultMessage:"Please create an invite for my birthday to send to my friends. It’ll be an outdoor barbeque with music and delicious food with my closest friends and family"}),body:"",theme:q.Image},{type:se.Starter,title:f.formatMessage({id:"57SKj2",defaultMessage:"Create a cartoon illustration of my pet"}),prompt:f.formatMessage({id:"EtCE7V",defaultMessage:"Please create an illustration of my pet in 2D animation style. It’s taking a nap in its favorite spot by the fire"}),body:"",theme:q.Image},{type:se.Starter,title:f.formatMessage({id:"s5iqKS",defaultMessage:"Create a Renaissance-style painting"}),prompt:f.formatMessage({id:"mEPKGA",defaultMessage:"Please create a Renaissance-style painting of a Mars rover. Use techniques like chiaroscuro and a warm color palette"}),body:"",theme:q.Image}]}),[f]);r.useEffect(()=>{if(m)return;const F=i.some(P=>P.theme===q.Search);b&&s.getCurrentText()===""?d.length>0?p(d):u():F&&!b&&p(P=>P.filter(D=>D.theme!==q.Search))},[i,s,u,b,p,d,m]),r.useEffect(()=>{b&&s.getCurrentText()===""&&d.length>0&&cs(d,t)},[b,s,d,t]);const E=g-i.filter(C).length,w=Qi(b),{layer:_}=Ae("4031588851"),S=_.get("autocomplete_min_char",4),H=_.get("autocomplete_fetch_interval",200),I=r.useRef(null),M=r.useCallback(Zs(async F=>{const P=s.getCurrentText();if(!P||P.length<S||P.length>80||s.hasMultipleLines()){p([]);return}if(!n&&!(I.current&&I.current.length>S&&P.startsWith(I.current)))try{const D=(await Vi({text:P,numCompletions:F,isUnauthenticated:v,isThreadUsingSearchMode:b,autocompleteMode:w,activeSystemHint:o})).filter(C).map(k);p(Fe=>{const he=Fe.filter(C),Le=D.filter(we=>{const Me=wt(we);return!he.some(W=>{const ie=wt(W);if(Me===ie)return!0;const le=/[\p{P}\p{S}]$/u,pe=Me.replace(le,""),fe=ie.replace(le,"");return pe===ie||Me===fe||pe===fe})}).slice(0,g-he.length);return[...he,...Le]}),D.length>0&&cs(D,t)}catch{}},w==="BING"?150:H),[s,w,k,H,o]);r.useEffect(()=>{!m||l.current===o||(l.current=o,s.getCurrentText()===""?(p(F=>F.filter(P=>P.theme!==q.Search&&P.theme!==q.Canvas&&P.theme!==q.Image)),o===Se.Search?d.length>0?p(d):u():o===Se.Canvas?p(y[q.Canvas].slice(0,g)):(o===Se.Picture||o===Se.PictureV2)&&p(y[q.Image].slice(0,g))):(p([]),s.getCurrentText().length>S&&M(g)))},[d,u,s,p,o,g,m,y,S,M]),to(F=>F.files);const R=o===Se.Research&&!1,O=r.useCallback(()=>{N(),E>0&&M(E)},[M,N,E]);r.useEffect(()=>{n&&p([])},[n,p]);const J=r.useMemo(()=>w==="HARDCODED"?N:O,[w,O,N]),X=!1,Y=r.useCallback(()=>{J()},[J,X,R,p]),te=r.useCallback(()=>{s instanceof Yn&&N(!0),s.getCurrentText().indexOf(`
`)>0&&(p([]),h(void 0))},[s,p,N,X,R]);return r.useEffect(()=>s.subscribe("input",()=>{Y()}),[s,Y]),r.useEffect(()=>s.subscribe("change",()=>{te()}),[s,te]),{autocompletions:i,matchaData:x}},qi=t=>{const[s,n]=r.useState([]),a=r.useCallback(async()=>{const l=(await gn.safePost("/conversation/experimental/generate_trending_suggestions",{requestBody:{num_items:t},authOption:hn.SendIfAvailable})).suggestions.map((i,c)=>({type:se.Trending,title:xs(i),body:"",icon:e.jsx(so,{className:"h-full w-full"}),prompt:xs(i),id:`search-trending-${c}`,theme:q.Search}));n(l)},[t]);return{trendingSuggestions:s,fetchTrendingSuggestions:a}};function xs(t){return t.split(" ").map(ao).join(" ")}const wt=t=>`${t.title}${t.body}`.toLocaleLowerCase();function $i(){const{layer:t}=Pt("4031588851"),s=t.get("autocomplete_qualified_start_date","2099-09-13T00:00:00Z"),n=gt();return!!n&&n.created*1e3>=new Date(s).getTime()}function Qi(t){const{isUnauthenticated:s}=Re(),n=re("1468311859").value,a=re("2053937752").value,o=re("3664702598").value,l=re("471233253").value,{layer:i}=Ae("4031588851"),{layer:c}=Ae("3533083032"),m=$i(),g=!s&&n||s&&a,x=(!s&&o||s&&l)&&m;let h="HARDCODED";{const p=s?c:i;if(t){const d=p.get("search_autocomplete_mode","");g&&d&&(h=d)}else x&&(h=p.get("autocomplete_mode","HARDCODED"))}return h}const ba=({clientThreadId:t})=>{const s=mt(),{autocompletions:n,matchaData:a}=Wi({clientThreadId:t,composerController:s});return r.useEffect(()=>(s.store.setState({autocompletions:n,matchaData:a}),()=>{s.store.setState({autocompletions:[],matchaData:void 0})}),[n,s,a]),null};function ya({clientThreadId:t}){const s=mt(),n=Ce(),a=Js(),[o,l]=r.useState(),{updateSystemHint:i}=xi(),c=ps.useState(({persistedSystemHints:h})=>h),m=ps.useState(({availableHints:h})=>h),g=Array.from(c)[0];if(a)return;const x=h=>{i(h,{clientThreadId:t}),requestAnimationFrame(()=>{requestAnimationFrame(()=>{s?.focus()})})};return e.jsx("div",{className:ds.vanguardAppLaunchersContainer,children:e.jsx(Ie,{verticalMargin:"none",verticalPadding:"none",horizontalPadding:"standard",children:e.jsx("ol",{className:A("absolute left-0 right-0 mt-12 hidden w-full select-none justify-center gap-10 md:flex",ds.vanguardAppLaunchers),children:no.map(h=>{const p=h.logo,d=m.find(v=>v.systemHint===h.systemHint),u=d?.systemHint||h.systemHint;return e.jsxs("li",{children:[e.jsx(Oi,{as:"button",logo:e.jsx(p,{className:"h-9 w-9"}),label:n.formatMessage(h.label),tooltip:n.formatMessage(h.tooltip),size:"large",isLauncher:!0,onClick:()=>{if(d?.isPopulatedByDefault){l(u);return}x(g===u?null:u)},selected:g===u}),u===o&&e.jsx(oo,{open:!0,systemHint:u,onOpenChange:()=>l(void 0)})]},u)})})})})}function Ki(t){const{clientThreadId:s}=t;return e.jsx(Ys,{clientThreadId:s,children:e.jsx(Yi,{...t})})}function Xi({clientThreadId:t,headlineOption:s,currentModelId:n,isModelLoaded:a,overrideMessage:o}){const l=Ot(),{getAndroidKeyboardLayout:i}=ea(),c=mt(),{isFocused:m,autocompletions:g}=Ls(c.store),x=m&&g.length>0;return e.jsxs(z.div,{initial:{opacity:0},animate:{opacity:x?0:1},exit:{opacity:0},transition:{duration:.1},className:A("mt-[var(--screen-optical-compact-offset-amount)] flex-shrink flex-col items-center justify-center overflow-hidden text-token-text-primary [display:var(--display-hidden-until-loaded,flex)]",i()?"h-full keyboard-open:h-[calc(100%-var(--screen-keyboard-height,0px)-var(--composer-height,100px))] motion-safe:[transition:height_0.3s_var(--easing-common)]":"h-full",x?"pointer-events-none":"",l?"@lg/thread:hidden":"lg:hidden"),children:[s==="CHATGPT_LOGO"?e.jsx(Hs,{className:"inline-block h-12 w-12"}):e.jsx(Sa,{headlineOption:s,overrideMessage:o}),e.jsx(ji,{isModelLoaded:a,currentModelId:n,clientThreadId:t})]})}function Yi({clientThreadId:t,currentModelId:s,isModelLoaded:n,onRequestCompletion:a,chatgptHomepageDisclaimer:o,shouldUseUnifiedComposer:l=!1}){const i=mt(),c=ot(t),{isUnauthenticated:m}=Re();ro(i);const{layer:g}=Ae("4031588851"),{layer:x}=Pt("3533083032"),h=m?x:g,p=Ti(),d=Ot(),{isUXUpdatesEnabled:u}=We(),v=u?"HOW_CAN_I_HELP":h.get("headline_option","HELP_WITH"),b=va(),C=b.has(Se.Research),k=io(Array.from(b)[0]),N=u&&k?k:C?ue.deepResearchPlaceholder:void 0,f=e.jsxs(e.Fragment,{children:[e.jsx("div",{className:A("hidden text-center @lg/thread:block","mb-5",u&&"md:-mt-20",d?"@lg/thread:block":"lg:block"),children:v==="CHATGPT_LOGO"?e.jsx(Hs,{className:"inline-block h-12 w-12"}):e.jsx(Sa,{headlineOption:v,overrideMessage:N})}),e.jsx(Xi,{headlineOption:v,overrideMessage:u?N:void 0,clientThreadId:t,isModelLoaded:n,currentModelId:s})]});return l?e.jsx("div",{className:A("flex grow items-center justify-center",d?"@lg/thread:items-end":"lg:items-end"),children:f}):e.jsx(Pe,{children:e.jsx(Ie,{isStaticSharedThread:!1,verticalPadding:"none",horizontalPadding:"standard",fullHeight:!0,children:e.jsxs(_t,{className:"relative",children:[f,!u&&e.jsx("div",{className:A(d?"@lg/thread:absolute @lg/thread:bottom-8 @lg/thread:left-0 @lg/thread:w-full":"[display:var(--display-hidden-until-loaded,block)] lg:absolute lg:bottom-8 lg:left-0 lg:w-full"),children:e.jsx(Ie,{verticalMargin:"none",verticalPadding:"none",horizontalPadding:"standard",children:e.jsx(_t,{className:"relative @lg/thread:pb-0",children:e.jsx(fs,{className:"block"})})})}),e.jsxs("div",{className:"w-full",children:[e.jsx(yi,{clientThreadId:t,isNewThread:c,currentModelId:s,onRequestCompletion:a,onAutocompleteSelect:i.onAutocompleteSelect,hideHeader:!0}),u&&e.jsx(Ie,{verticalMargin:"none",verticalPadding:"none",horizontalPadding:"none",children:e.jsx(_t,{className:A("relative @lg/thread:pb-0",u&&"min-h-[100px] xs:justify-start"),children:e.jsx(fs,{className:"block"})})}),c&&e.jsx(ba,{clientThreadId:t}),u&&e.jsx(ya,{clientThreadId:t})]}),p&&!u?e.jsx(Si,{isModelLoaded:n,currentModelId:s,clientThreadId:t}):null,o&&e.jsx("div",{className:A("w-full translate-y-4 px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden xs:translate-y-8 md:px-[60px]",d?"@lg/thread:absolute @lg/thread:bottom-0 @lg/thread:left-0":"lg:absolute lg:bottom-0 lg:left-0"),children:e.jsx("div",{className:A("min-h-4"),children:o})})]})})})}function Zi({headlineOption:t,overrideMessage:s,isVanguardUxEnabled:n,prefersReducedMotion:a}){const o=Ce(),{layer:l}=pn("1704793646"),i=l.get("name_char_limit",20),[c]=r.useState(()=>{const v=ns.getCookie(os.GreetingName);return{cookieName:v,isReadyForPersonalized:!!v&&v.length<=i}}),{isUnauthenticated:m}=Re(),g=gt(),h=vi(!m&&!!g)?.data;r.useEffect(()=>{if(g){const v=fn(h,g);v&&(ns.setCookie(os.GreetingName,v),us.count(ms.MOONSHINE,"splashScreenV2.greeting_cookie_name_set_web"))}},[h,g]);const p=c.isReadyForPersonalized?l.get("greeting_web",!1):!1;r.useEffect(()=>{p&&us.count(ms.MOONSHINE,p?"splashScreenV2.greeting_shown_web":"splashScreenV2.greeting_not_shown_web")},[p]);let d;s?d=o.formatMessage(s):p?d=o.formatMessage(vs[t].withName,{name:c.cookieName}):d=o.formatMessage(vs[t].original);const u=n?e.jsx(Pe,{mode:"wait",initial:!1,children:e.jsx(z.div,{initial:{opacity:.4,scale:.97},animate:{opacity:1,scale:1},exit:{opacity:.4,scale:.97},transition:{duration:a?1e-9:.1},children:d},d)}):d;return e.jsx(e.Fragment,{children:u})}function Sa({headlineOption:t,overrideMessage:s}){const n=Ft(),{isUXUpdatesEnabled:a}=We(),o=lo();return e.jsx("div",{className:"relative inline-flex justify-center text-center text-2xl font-semibold leading-9",children:e.jsx("div",{style:{viewTransitionName:"var(--vt-splash-screen-headline)"},children:e.jsxs("div",{className:"grid min-h-[74px] grid-cols-1 items-center justify-end",children:[e.jsx("h1",{className:A("flex h-full items-end justify-center text-balance [grid-area:1/1] motion-safe:[transition:0.3s_transform_var(--spring-standard),0.5s_opacity_var(--spring-standard),0.5s_visibility_var(--spring-standard)]",!a&&"text-[28px] font-semibold leading-[34px] tracking-[0.38px]",n?"invisible -translate-y-full opacity-0":"translate-y-0 opacity-100",a&&"text-[28px] font-medium leading-[50px] tracking-[-0.42px] sm:text-[40px] md:-mt-10"),"aria-hidden":n,children:e.jsx(Zi,{headlineOption:t,overrideMessage:s,isVanguardUxEnabled:a,prefersReducedMotion:o})}),e.jsx("div",{className:A("flex h-full flex-col items-center justify-end [grid-area:1/1] motion-safe:[transition:0.3s_transform_var(--spring-standard),0.5s_opacity_var(--spring-standard),0.5s_visibility_var(--spring-standard)]",n?"translate-y-0 opacity-100":"invisible translate-y-full opacity-0"),"aria-hidden":!n,children:e.jsx(co,{})})]})})})}const ue=ut({whatCanIHelpWith:{id:"SplashScreenV2.whatCanIHelpWith",defaultMessage:"What can I help with?"},whatCanIHelpWithWithName:{id:"SplashScreenV2.whatCanIHelpWith.withName",defaultMessage:"What can I help with, {name}?"},whereShouldWeStart:{id:"SplashScreenV2.whereShouldWeStart",defaultMessage:"Where should we start?"},whereShouldWeStartWithName:{id:"SplashScreenV2.whereShouldWeStart.withName",defaultMessage:"Where should we start, {name}?"},askChatgptAnything:{id:"SplashScreenV2.askChatgptAnything",defaultMessage:"Ask ChatGPT anything"},askChatgptAnythingWithName:{id:"SplashScreenV2.askChatgptAnything.withName",defaultMessage:"Ask ChatGPT anything, {name}"},deepResearchPlaceholder:{id:"G1v9do",defaultMessage:"What are you researching?"},howCanIHelp:{id:"SplashScreenV2.howCanIHelp",defaultMessage:"How can I help?"},howCanIHelpWithName:{id:"SplashScreenV2.howCanIHelp.withName",defaultMessage:"How can I help, {name}?"}}),vs={HELP_WITH:{original:ue.whatCanIHelpWith,withName:ue.whatCanIHelpWithWithName},WHERE_TO_START:{original:ue.whereShouldWeStart,withName:ue.whereShouldWeStartWithName},ASK_CHATGPT:{original:ue.askChatgptAnything,withName:ue.askChatgptAnythingWithName},HOW_CAN_I_HELP:{original:ue.howCanIHelp,withName:ue.howCanIHelpWithName}},Ji=({clientThreadId:t})=>{const s=Bt(h=>h.activeStageSidebar),n=dt(t),a=uo(xn.WorkspaceShareLinks),{isUnauthenticated:o}=Re(),l=Ft(),i=Dt(t),c=ta(i),m=mo(),g=a&&n&&!o&&!l&&!c&&!m,x=!s;return e.jsx("div",{className:"flex items-center gap-2 pr-1 leading-[0]",children:e.jsx(Zn,{showShareButton:g,showProfileDropdown:x,clientThreadId:t})})},el=ge(()=>je(()=>import("./mqwpzc3bip82uqzz.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23])).then(t=>t.GizmoUsingAsOwnerNotice));function tl({clientThreadId:t,isEmptyState:s}){const n=Dt(t),a=sa(),o=go(),{data:l}=aa(n),i=Gs(),c=ho(),m=Ce(),g=!1,{isUXUpdatesEnabled:x}=We(),h=Bt(v=>v.isConversationScrolledFromTop),p=Os(),d=!x||!!n;if(a)return null;const u=d?e.jsx(e.Fragment,{children:c?e.jsx(yo,{children:e.jsx(gs,{clientThreadId:t})}):e.jsx(gs,{clientThreadId:t})}):e.jsx(Rt,{side:"bottom",theme:p?"default":"white",label:e.jsxs("div",{className:"flex h-full w-full flex-col overflow-hidden px-4 py-3",children:[e.jsx("div",{className:"flex w-full justify-center py-2",children:e.jsxs("div",{className:"flex w-56 flex-col gap-2 rounded-xl border border-token-border-light bg-token-main-surface-primary p-2 pt-1.5 shadow-lg",children:[e.jsx("div",{className:"flex w-full text-start text-[11px] font-normal tracking-tight text-token-text-tertiary",children:m.formatMessage({id:"kvZYws",defaultMessage:"Ask anything"})}),e.jsxs("div",{className:"flex w-full flex-row items-center gap-2",children:[e.jsx(po,{className:"h-3 w-3 text-token-text-primary opacity-40"}),e.jsx(fo,{className:"h-3 w-3 text-token-text-primary opacity-40"}),e.jsxs("div",{className:"relative h-3 w-3",children:[e.jsx(xo,{className:"h-3 w-3 text-token-text-primary"}),e.jsx("div",{className:"scale-200 absolute left-0 top-0 h-full w-full animate-ping rounded-full bg-blue-1000/50 duration-1000"})]}),e.jsx("div",{className:"flex-auto"}),e.jsx("div",{className:"rounded-full bg-token-main-surface-primary p-[1px] opacity-20 invert",children:e.jsx(vo,{className:"h-3 w-3 text-token-text-primary"})})]})]})}),e.jsxs("div",{className:"mt-4 flex max-w-80 flex-col gap-1 text-token-text-primary",children:[e.jsx("div",{className:"font-semibold",children:m.formatMessage({id:"ZQnsFt",defaultMessage:"The model picker has moved"})}),e.jsx("div",{className:"text-xs font-normal opacity-75",children:m.formatMessage({id:"EyZkkB",defaultMessage:"Adjust thinking or choose a model here"})})]})]}),onOpenChange:v=>{v&&$.logEvent(B.modelSwitcherMovedTooltipHover,{location:"thread_header"})},children:e.jsx("div",{className:"px-0.5 text-xl text-token-text-secondary",children:bo})});return e.jsxs(e.Fragment,{children:[e.jsxs(So,{className:A("pointer-events-none select-none *:pointer-events-auto motion-safe:transition max-md:hidden",s&&"absolute left-0 right-0",!n&&"@thread-xl/thread:absolute @thread-xl/thread:left-0 @thread-xl/thread:right-0 @thread-xl/thread:bg-transparent @thread-xl/thread:!shadow-none",g,h?"[box-shadow:var(--sharp-edge-top-shadow)]":"[box-shadow:var(--sharp-edge-top-shadow-placeholder)]"),children:[e.jsxs("div",{className:"absolute start-1/2 ltr:-translate-x-1/2 rtl:translate-x-1/2",children:[l!=null&&i?.isWorkspaceAccount()&&l.gizmo.tags?.includes(jo.WorkspaceDisabled)&&e.jsx(el,{gizmo:l}),e.jsx(_o,{gizmoId:n,clientThreadId:t})]}),e.jsxs("div",{className:"flex items-center gap-0 overflow-hidden",children:[e.jsx(Jn,{clientThreadId:t}),u]}),e.jsx(Ji,{clientThreadId:t})]}),o&&e.jsx(Co,{})]})}const sl="bg-token-main-surface-primary text-token-text-primary",al="openai",bs=["bg-blue-300 text-white"];function nl(t){return bs[(t?.charCodeAt(0)??0)%bs.length]}const st=({children:t})=>e.jsx("div",{className:"pt-0",children:e.jsx("div",{className:A(r.isValidElement(t)&&t.type===Nt?"gizmo-bot-avatar":"gizmo-shadow-stroke","flex h-8 w-8 items-center justify-center overflow-hidden rounded-full"),children:t})});function At(t){const{messages:s,isUserTurn:n,avatarClassName:a,gizmo:o}=t,l="medium",c=s[0]?.metadata?.shared_conversation_id,m=c!=null,g=gt(),{gizmoEditorData:x,mode:h}=wo();let p=e.jsx(st,{children:e.jsx(Nt,{className:a??sl,iconName:al,size:l})});return o?p=e.jsx(st,{children:e.jsx(Ii,{gizmoId:o.gizmo.id,className:"h-full w-full"})}):x!=null&&h==="test"&&(p=e.jsx(Ai,{isFirstParty:!1,src:x.profilePictureUrl,className:"h-8 w-8 first:pt-[3px]"})),e.jsx("div",{className:void 0,children:n?m?e.jsx(st,{children:e.jsx(Nt,{className:nl(c),iconName:"user",size:l})}):e.jsx(st,{children:e.jsx(Mo,{user:g,size:l})}):p})}const ys=ge(()=>je(()=>import("./bg82vxo39mz0x6ax.js"),__vite__mapDeps([24,2,1,3,6,7,25])).then(t=>t.MemoryActionResult));function Ss(t,s,n){De(t,a=>{Ut.updateTree(a,o=>{o.updateNodeMetadata(s,{inlineComparisonRating:n})})})}const js=({messages:t})=>{for(const{metadata:s}of t){const{augmented_paragen_prompt_label:n}=s??{};if(n)return n}};function ol(t){const s=r.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),n=r.useRef({left:null,right:null});return t.variantIds.length<2?e.jsx(ja,{setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:s,firstVisibleTokenTimestampsRef:n,...t}):e.jsx(rl,{...t,visibilityStateRef:s,firstVisibleTokenTimestampsRef:n})}function rl(t){const{clientThreadId:s,variantIds:n,turnIndex:a,firstVisibleTokenTimestampsRef:o}=t;if(n.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const l=zt(),i=Bs(),c=Os(),[m,g]=n,x=r.useMemo(()=>na(m+g)()>=.5,[m,g]),[h,p]=x?[g,m]:[m,g],[d,u,v]=ee(s,y=>{const E=rs(y).tree.getLeafFromNode(h).id,w=rs(y).tree.getLeafFromNode(p).id,_=U.getConversationTurns(y,E),S=U.getConversationTurns(y,w),H=a<_.length?_[a]:null,I=a<S.length?S[a]:null;return H||ze.addError(`Paragen Left turn index ${a} out of bounds`,{turnIndex:a,turnCount:_.length,lastTurnRole:L(_)?.role,lastMessageAuthor:L(L(_)?.messages)?.author,lastMessageContentType:L(L(_)?.messages)?.content.content_type,lastMessageMetadata:L(L(_)?.messages)?.metadata,altTurnCount:S.length,altLastTurnRole:L(S)?.role,altLastMessageRole:L(L(S)?.messages)?.author.role}),I||ze.addError(`Paragen Right turn index ${a} out of bounds`,{turnIndex:a,turnCount:S.length,lastTurnRole:L(S)?.role,lastMessageAuthor:L(L(S)?.messages)?.author,lastMessageContentType:L(L(S)?.messages)?.content.content_type,lastMessageMetadata:L(L(S)?.messages)?.metadata,altTurnCount:_.length,altLastTurnRole:L(_)?.role,altLastMessageRole:L(L(_)?.messages)?.author.role}),[E,H,I]}),[b,C]=x?[v,u]:[u,v],k=l?"skippable_parallel_2_in_stream:a:2.0":"skippable_parallel_2_in_stream:a:1.5";r.useEffect(()=>(hs.setState({displayingSideBySideFeedback:!0}),()=>{hs.setState({displayingSideBySideFeedback:!1})}),[]),To();const N=r.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),f=r.useCallback((y,{shouldSubmitParagenFeedback:E=!0}={})=>{if(!u||!v||!b||!C)throw new Error("Expected both turns to exist");De(s,R=>{Ut.setCurrentBranch(R,y)});const w=y===h,_=y===m;b.messages.length>0&&Ss(s,b.messages[b.messages.length-1].id,_?"original":"new"),C.messages.length>0&&Ss(s,C.messages[C.messages.length-1].id,_?"original":"new");const S=Ue(s),H=[u,v].map((R,O)=>({messageId:R.messages[R.messages.length-1].id,loadFirstTokenTime:O===0?o.current.left:o.current.right,loadEndTime:L(R.messages)?.clientMetadata?.completionSampleFinishTime})),I=w?H[0].messageId:H[1].messageId,M=U.getParentPromptNode(lt(s),d);if(!M)throw new Error("Expected prompt for side by side feedback");const T={},V=M.message.clientMetadata?.variantsInStreamInfo==null&&M.message.metadata?.paragen_variants_info!=null;for(const R of H)T[R.messageId]=V?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:R.loadFirstTokenTime,load_end_time:R.loadEndTime};E&&ks({params:{conversation_id:S,displayed_message_ids:H.map(R=>R.messageId),message_metadatas:T,rating:"selected",selected_message_id:I,source_timestamp:Date.now(),ui_variant:l?2:1,user_prompt_message_id:M.message.id}})},[s,h,m,b,C,u,v,d,o,t.conversationTurnMountTime,l]);return r.useEffect(()=>vn(zs,{requestCompletion:y=>{const E=Ue(s),w=U.getParentPromptNode(lt(s),d);if(!w)throw new Error("Expected prompt for side by side feedback");if(!u||!v)throw new Error("Expected both turns to exist");const _=[u,v].map((M,T)=>({messageId:M.messages[M.messages.length-1].id,loadFirstTokenTime:T===0?o.current.left:o.current.right,loadEndTime:L(M.messages)?.clientMetadata?.completionSampleFinishTime})),S={},H=w.message.clientMetadata?.variantsInStreamInfo==null&&w.message.metadata?.paragen_variants_info!=null;for(const M of _)S[M.messageId]=H?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:M.loadFirstTokenTime,load_end_time:M.loadEndTime};const I=y.isForSkippingParagen;ks({params:{conversation_id:E,displayed_message_ids:_.map(M=>M.messageId),message_metadatas:S,rating:I?"explicit_skipped":"skipped",selected_message_id:null,source_timestamp:Date.now(),ui_variant:I?3:l?2:1,user_prompt_message_id:w.message.id}}),I&&f(h,{shouldSubmitParagenFeedback:!1})}}),[u,v,d,s,t.conversationTurnMountTime,k,b?.messages,C?.messages,c,l,o,f,h]),e.jsx(ja,{...t,setPreferredFeedback:f,leftVariantId:h,rightVariantId:p,leftTurn:u,rightTurn:v,hasActiveRequest:i,originalTurn:b,visibilityStateRef:N})}function ja({setPreferredFeedback:t,leftVariantId:s,rightVariantId:n,leftTurn:a,rightTurn:o,hasActiveRequest:l,originalTurn:i,visibilityStateRef:c,...m}){const{defaultParagenLabel:g,shouldShowParagenLabels:x=!1}=ko(),h=(a&&js(a))??g,p=(o&&js(o))??g,d=r.useMemo(()=>a?.messages??[],[a?.messages]),u=r.useMemo(()=>o?.messages??[],[o?.messages]),{avatarClassName:v,firstVisibleTokenTimestampsRef:b}=m,C=r.useMemo(()=>a?.messageGroups??[],[a?.messageGroups]),k=r.useMemo(()=>o?.messageGroups??[],[o?.messageGroups]),N=No(),f=lt(m.clientThreadId),y=L(a?.messages),E=L(o?.messages),w=Lt(U.getRequestId(f,y?.id??E?.id)),_=w&&!y?.end_turn,S=w&&!E?.end_turn,H=a?.role===Z.User,I=o?.role===Z.User,M=r.useRef(null),T=r.useRef(null),V=r.useRef(null),R=a!=null,O=o!=null;!R&&b.current.left==null&&(b.current.left=Date.now()),!O&&b.current.right==null&&(b.current.right=Date.now()),r.useEffect(()=>{if(M.current&&T.current&&V.current){const te=Array(11).fill(0).map((P,D)=>D/10),F=new IntersectionObserver(P=>P.forEach(D=>{D.target===T.current?(c.current.left_visibility_initial==null&&(c.current.left_visibility_initial=D.intersectionRatio),c.current.left_visibility_max=Math.max(c.current.left_visibility_max??0,D.intersectionRatio)):D.target===V.current&&(c.current.right_visibility_initial==null&&(c.current.right_visibility_initial=D.intersectionRatio),c.current.right_visibility_max=Math.max(c.current.right_visibility_max??0,D.intersectionRatio))}),{root:M.current,threshold:te});return F.observe(T.current),F.observe(V.current),()=>F.disconnect()}},[c]);const{data:J}=Eo(void 0,!1,N),X=zt(),Y=e.jsx("div",{className:"text-pretty px-6 pb-5 pt-1 text-center text-sm text-token-text-secondary",children:e.jsx(G,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})});return e.jsxs("div",{className:"relative flex flex-col",children:[e.jsxs("div",{className:A("sticky top-[-1px] z-[1] text-pretty bg-token-main-surface-primary px-6 text-center text-lg",X?"md:top-header-height":"md:static"),"data-testid":"paragen-feedback-title",children:[e.jsx(G,{id:"KKeSJV",defaultMessage:"You're giving feedback on a new version of ChatGPT."}),X?Y:null]}),X?null:Y,e.jsx("div",{className:"relative -mb-2 snap-x snap-mandatory overflow-x-auto overflow-y-clip px-3 pb-4 md:px-5 lg:px-10",ref:M,children:e.jsx("div",{className:"min-w-fit",children:e.jsxs("div",{className:A("mx-auto flex max-w-6xl items-start",X&&"divide-x divide-token-border-medium dark:divide-token-border-heavy",!X&&"gap-4 sm:gap-6"),children:[e.jsxs(_s,{horizontalScrollContainerRef:M,rootElementRef:T,onClick:()=>{t(s)},hasActiveRequest:l,isWaitingOnFirstUserVisibleToken:R,children:[e.jsxs(Ms,{children:[e.jsx(At,{messages:d,isUserTurn:H,avatarClassName:v}),e.jsx(ws,{children:x?e.jsx("span",{className:"font-bold text-token-text-primary",children:h}):e.jsx(G,{...Ns.responseNumber,values:{responseIndex:1}})})]}),X&&R?e.jsx(Cs,{}):e.jsxs(e.Fragment,{children:[J!=null&&!H&&e.jsx(ys,{clientThreadId:m.clientThreadId,messages:d,isParagen:!0}),e.jsx(It,{...m,allMessages:d,groupedMessagesToRender:C,allGroupedMessages:C,isUserTurn:H,isFinalUserTurn:!1,isCompletionRequestInProgress:_,hasActiveRequest:l,shouldGrowContainer:!1,isParagen:!0}),e.jsx(Ts,{clientThreadId:m.clientThreadId,conversationTurnMountTime:m.conversationTurnMountTime,turn:a,originalTurn:i})]})]}),e.jsxs(_s,{horizontalScrollContainerRef:M,rootElementRef:V,onClick:()=>{t(n)},hasActiveRequest:l,isWaitingOnFirstUserVisibleToken:O,children:[e.jsxs(Ms,{children:[e.jsx(At,{messages:u,isUserTurn:I,avatarClassName:v}),e.jsx(ws,{children:x?e.jsx("span",{className:"font-bold text-token-text-primary",children:p}):e.jsx(G,{...Ns.responseNumber,values:{responseIndex:2}})})]}),X&&O?e.jsx(Cs,{}):e.jsxs(e.Fragment,{children:[J!=null&&!I&&e.jsx(ys,{clientThreadId:m.clientThreadId,messages:u,isParagen:!0}),e.jsx(It,{...m,allMessages:u,groupedMessagesToRender:k,allGroupedMessages:k,isFinalUserTurn:!1,isUserTurn:I,isCompletionRequestInProgress:S,hasActiveRequest:l,shouldGrowContainer:!1,isParagen:!0}),e.jsx(Ts,{clientThreadId:m.clientThreadId,conversationTurnMountTime:m.conversationTurnMountTime,turn:o,originalTurn:i})]})]})]})})})]})}function _s({horizontalScrollContainerRef:t,rootElementRef:s,onClick:n,children:a,hasActiveRequest:o,isWaitingOnFirstUserVisibleToken:l}){const i=zt(),{scrollX:c}=qn({layoutEffect:!1,container:t,target:s}),m=Io(),g=Ao(),x=r.useRef(null),h=r.useRef(null),p=r.useRef(null),[d,u]=r.useState(!1),[v,b]=r.useState(!1),[C,k]=r.useState(!1),[N,f]=r.useState(0);r.useEffect(()=>{if(!i)return;const I=new IntersectionObserver(M=>{for(const T of M)T.target===x.current?u(T.isIntersecting):T.target===p.current?k(T.isIntersecting):T.target===h.current&&b(T.isIntersecting)},{root:m?.current});return x.current&&h.current&&p.current&&(I.observe(x.current),I.observe(h.current),I.observe(p.current)),()=>{I.disconnect()}},[N,i,m]);const y=!C&&(v||d),E=$n(c,I=>y?-1*I:0),w=ls(0);r.useEffect(()=>{if(!i)return;const I=new ResizeObserver(M=>{et(M.length===1,"entryList.length === 1");const T=M[0];et(T.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),w.set(T.contentBoxSize[0].inlineSize)});return s.current&&I.observe(s.current),()=>{I.disconnect()}},[i,w,s]);const _=ls(0);r.useEffect(()=>{if(!i)return;const I=new ResizeObserver(M=>{et(M.length===1,"entryList.length === 1");const T=M[0];et(T.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),_.set(T.contentBoxSize[0].blockSize+16),f(T.contentBoxSize[0].blockSize)});return g.current&&I.observe(g.current),()=>{I.disconnect()}},[i,_,g]);const S=e.jsx(Ht,{className:i?"px-5":"mt-4 self-start",onClick:n,"data-testid":"paragen-prefer-response-button",children:e.jsx(G,{id:"U2EAH6",defaultMessage:"I prefer this response"})}),H=l;return e.jsxs("div",{"data-paragen-root":!0,className:A("relative flex w-full min-w-[min(450px,80vw)] snap-center flex-col gap-1 text-left",i?"min-h-60 px-10 py-4":"rounded-2xl border border-token-main-surface-tertiary bg-white p-5 dark:bg-gray-700"),ref:s,children:[e.jsx("div",{className:A("absolute left-0 right-0 top-48 h-px","invisible"),ref:x}),e.jsx("div",{className:A("absolute bottom-0 left-0 right-0 top-48","invisible"),ref:h}),e.jsx("div",{className:A("absolute bottom-0 left-0 right-0 h-px","invisible"),ref:p}),a,i?e.jsx("div",{className:"flex-1"}):null,i?e.jsx("div",{className:"mt-4 min-h-10",children:H?null:e.jsx(z.div,{style:{translateX:E,width:w,bottom:_},animate:{opacity:100},initial:{opacity:0},transition:{ease:"easeOut",duration:.2,delay:.5},className:A({fixed:y,"z-20 flex w-full justify-center":!0}),children:S})}):o?null:S]})}function Cs(){return e.jsxs("div",{className:"flex w-full flex-col gap-4 pb-5 pt-3",children:[e.jsx(Ee,{className:"h-4 w-[75%]"}),e.jsx(Ee,{className:"h-4 w-[50%]"}),e.jsx(Ee,{className:"h-4 w-[80%]"}),e.jsx(Ee,{className:"h-4 w-[55%]"}),e.jsx(Ee,{className:"h-4 w-[66%]"}),e.jsx(Ee,{className:"h-4 w-[64%]"}),e.jsx(Ee,{className:"h-4 w-[48%]"})]})}function zt(){const{layer:t}=Ae("3119715334");return t.get("should-enable-hojicha",!1)}const ws=_e.div`text-sm text-token-text-secondary font-semibold`,Ms=_e.div`flex gap-4 items-center mb-1`,Ee=_e.div`animate-pulse rounded-[4px] bg-token-main-surface-tertiary`;function Ts({clientThreadId:t,conversationTurnMountTime:s,turn:n,originalTurn:a}){const o=oa();if(!o.showParagenMetadata||!o.showDebugConversationTurns&&!o.forceParagen||n==null)return null;let l=n===a?"ORIGINAL":"NEW";const i=n.messages[n.messages.length-1],c=i?.metadata?.__internal;if(c){const{model_id:x,model_definition_slug:h,model_definition_virtual_model_id:p,alternative_model_selection_rule:d,augmented_paragen_prompt_group_id:u,augmented_paragen_prompt_id:v,augmented_paragen_prompt:b}=c;x&&(l+=`
Model ID: ${x}`),h&&(l+=`
Model Slug: ${h}`),p&&(l+=`
Virtual Model ID: ${p}`),d&&(l+=`
Alternative Model Rule: ${d}`),u&&(l+=`
Prompt Group ID: ${u}`),v&&(l+=`
Prompt ID: ${v}`),b&&(l+=`
Prompt: ${b}`)}l+=`
Message ID: ${i.id}`;const m=U.getParentPromptNode(lt(t),n.messages[0].id);if(!m)throw new Error("Expected prompt for side by side feedback");const g=m.message.clientMetadata?.variantsInStreamInfo==null&&m.message.metadata?.paragen_variants_info!=null;return l+=`
User prompt message ID: ${m.message.id}`,l+=`
Is Persisted Paragen? ${g}`,l+=`
Completion Sample Finish Time: ${g?`${s} (persisted)`:L(n.messages)?.clientMetadata?.completionSampleFinishTime}`,e.jsx("div",{className:"whitespace-pre-wrap text-sm text-red-500",children:l})}async function ks({params:t}){await Be.submitParagenSelectionV2(t)}const Ns=ut({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}"}});function il({handleShowRetrievalResults:t,clientThreadId:s,turnIndex:n,responseComplete:a=!1}){const[o,l]=ee(s,x=>[U.getTurnContentReferences(x,n),U.getConversationTurnAtIndex(x,n).messages]),i=r.useMemo(()=>({turnIndex:n,clientThreadId:s,responseComplete:a}),[s,a,n]),c=r.useRef(!1);r.useEffect(()=>{c.current||(c.current=!0,$.logEvent(B.fileSourcesFooterShown,i))},[i]);const m=r.useCallback(()=>{$.logEvent(B.fileSourcesFooterClicked,i),t()},[t,i]),g=r.useMemo(()=>{const x=new Set,h=[];function p(u){!u||x.has(u)||(x.add(u),h.push(u))}if(o.forEach(u=>{u.type==="file"?p(u.cloud_doc_url??u.extra?.cloud_doc_url):u.type==="file_navlist"&&u.items.forEach(v=>{p(v.cloud_doc_url)})}),a){for(const u of l)if(Ro(u)){const v=Po(u.content.result),b=u.metadata?.cloud_doc_urls??[],C=v.chunks;for(let k=0;k<C.length;k++){const N=C[k];if(!N.documentId)continue;if(k<b.length){p(b[k]);continue}const f=N.documentId.endsWith("--google")?N.documentId.split("--")[1]:void 0,y=N.metadata.cloud_doc_url??(f?`https://drive.google.com/file/d/${f}`:void 0);p(y?.toString())}break}}const d=[];for(let u=0;u<h.length;u++){const v=h[u],b=Fo(v);if(b&&d.push(b.Icon),d.length>=3)break}return d},[l,o,a]);return e.jsxs(e.Fragment,{children:[e.jsx(z.div,{className:"absolute h-[60px]",initial:{opacity:0},animate:{opacity:1},children:e.jsxs("button",{className:A("not-prose group/footnote mb-2 mt-3 flex w-fit items-center gap-1.5 rounded-xl border border-token-border-light bg-token-main-surface-primary py-2 hover:bg-token-main-surface-secondary","pl-3 pr-2.5"),onClick:m,children:[e.jsx("div",{className:"flex items-center gap-0.5 text-sm font-medium",children:e.jsx(G,{id:"/48IOP",defaultMessage:"Sources"})}),g.length>0&&e.jsx("div",{className:"flex flex-row-reverse gap-1",children:g.reverse().map((x,h)=>e.jsx(z.div,{className:A("flex items-center overflow-hidden rounded-full border-token-main-surface-primary bg-token-main-surface-primary","group-hover/footnote:border-token-main-surface-secondary","relative"),initial:{opacity:0},animate:{opacity:1},children:e.jsx(x,{className:"icon-md"})},h))})]})}),e.jsx("div",{className:"h-[60px]"})]})}function _a({followups:t,analyticsMetadata:s}){const[n,a]=r.useState(-1),o=r.useRef(!1),l=ki();return r.useEffect(()=>{o.current||(o.current=!0,t.forEach((i,c)=>{$.logEventWithStatsig(B.messageFollowupAction,"chatgpt_message_followup_action",{...me(s),action:"show",position:c+1,followup_text:rt(i)})}))},[t,s]),e.jsx(z.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex w-full flex-col",children:t.slice(0,4).map((i,c)=>e.jsxs(z.div,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:c*.03},exit:{opacity:0,translateY:4},onMouseEnter:()=>a(c),onMouseLeave:()=>a(-1),children:[c>0&&e.jsx(ll,{$isSelected:n===c||n===c-1}),e.jsx(cl,{followUp:i,onSelectingSuggestedReply:l,analyticsMetadata:s,position:c})]},c))})}const ll=_e.div`
  h-[1px] opacity-45
  ${({$isSelected:t})=>t?"mx-2 bg-token-main-surface-secondary":"bg-token-border-light"}
`;function cl({followUp:t,onSelectingSuggestedReply:s,analyticsMetadata:n,position:a}){return e.jsxs(z.button,{whileHover:"hover",className:"flex w-full cursor-pointer items-start justify-start gap-2 rounded-lg bg-token-main-surface-primary px-2 py-3 text-start hover:bg-token-main-surface-secondary",onClick:o=>{s(o,t,[],0),$.logEventWithStatsig(B.messageFollowupAction,"chatgpt_message_followup_action",{...me(n),action:"click",position:a+1,followup_text:rt(t)})},onMouseEnter:()=>{$.logEventWithStatsig(B.messageFollowupAction,"chatgpt_message_followup_action",{...me(n),action:"hover",position:a+1,followup_text:rt(t)})},children:[e.jsx(z.div,{className:"flex items-center justify-center pt-0.5 opacity-70",variants:{hover:{x:4}},initial:{x:0},transition:{duration:.1},children:e.jsx(Do,{className:"h-[18px] w-[18px] text-token-text-secondary"})}),e.jsx("div",{className:"pr-2 text-left text-sm text-token-text-secondary",children:rt(t)})]})}const at=ut({followUp:{defaultMessage:"Follow ups",id:"followUp"},search:{defaultMessage:"Search",id:"search"},makeImage:{defaultMessage:"Make Image",id:"makeImage"},deepResearch:{defaultMessage:"Deep Research",id:"deepResearch"}}),Es=[{value:"followups",message:at.followUp},{value:"search",message:at.search},{value:"image",message:at.makeImage},{value:"research",message:at.deepResearch}],dl=({followups:t,categories:s,analyticsMetadata:n})=>{const[a,o]=r.useState(Es[0].value),l=Es.filter(i=>i.value==="followups"||s.includes(i.value));return e.jsxs(Uo,{value:a,onValueChange:o,orientation:"horizontal",className:"flex w-full flex-col",children:[e.jsx(Lo,{className:"relative flex w-full flex-row gap-6 border-b border-token-border-light",children:l.map(i=>e.jsx(ul,{value:i.value,message:i.message,isActive:a===i.value},i.value))}),l.map(i=>e.jsx(Ho,{value:i.value,children:e.jsx(ml,{value:i.value,followups:t,analyticsMetadata:n})},i.value))]})},ul=({value:t,message:s,isActive:n})=>e.jsxs(Go,{className:"relative flex py-4 text-sm font-medium text-token-text-tertiary radix-state-active:text-token-text-primary",value:t,children:[e.jsx("div",{className:"truncate",children:e.jsx(G,{...s})}),e.jsx(Pe,{children:n&&e.jsx(z.div,{layoutId:"tab-underline",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-token-text-primary",transition:{type:"spring",stiffness:500,damping:30}})})]}),ml=({value:t,followups:s,analyticsMetadata:n})=>{switch(t){case"followups":return e.jsx(_a,{followups:s,analyticsMetadata:n});default:return e.jsxs("div",{className:"flex flex-row space-x-8 py-3",children:[e.jsx(Is,{}),e.jsx(Is,{})]})}},Is=()=>e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsx("div",{className:"h-16 w-14 animate-pulse rounded-[4px] bg-token-main-surface-tertiary"}),e.jsx("div",{className:"w-52",children:e.jsx(Pi,{size:"sm",lines:3})})]});function gl({clientThreadId:t,followups:s,categories:n,analyticsMetadata:a}){const[o,l]=r.useState(null),i=ra.useIsEnabled(t),{value:c}=re("3552232210");return e.jsxs(e.Fragment,{children:[e.jsx(fl,{visible:o==="conversation"}),e.jsx(xl,{visible:o==="global"}),i&&s.length>0&&(c?e.jsx(dl,{followups:s,categories:n??[],analyticsMetadata:a}):e.jsx(hl,{clientThreadId:t,followups:s,analyticsMetadata:a,setDisableMessage:l}))]})}function hl({clientThreadId:t,followups:s,setDisableMessage:n,analyticsMetadata:a}){const{value:o}=re("2281969373");return e.jsxs("div",{className:"group",children:[e.jsxs("div",{className:"mb-1 flex items-center text-sm font-semibold",children:[e.jsx(G,{id:"3UFIQc",defaultMessage:"Follow up"}),!o&&e.jsx(pl,{clientThreadId:t,setDisableMessage:n,analyticsMetadata:a})]}),e.jsx(_a,{followups:s,analyticsMetadata:a})]})}function pl({clientThreadId:t,setDisableMessage:s,analyticsMetadata:n}){const a=ra.useStore(),[o,l]=r.useState(!1);return e.jsxs(bn,{size:"small",onOpenChange:i=>l(i),contentClassName:"min-w-[200px]",triggerButton:e.jsx("button",{className:"ml-2 flex h-6 w-6 items-center justify-center rounded-md text-token-text-tertiary hover:bg-token-main-surface-tertiary focus:outline-none focus:ring-0",children:e.jsx(Oo,{className:A("h-4 w-4 opacity-0 group-hover:opacity-100",o&&"opacity-100")})}),children:[e.jsx(ae.Item,{onClick:()=>{a.setDisabledConversation(t,!0),s("conversation"),setTimeout(()=>s(null),3e3),$.logEventWithStatsig(B.messageFollowupSetting,"chatgpt_message_followup_setting",{...me(n),action:"disable_conversation"})},className:"text-token-text-primary",children:e.jsx(G,{id:"GZYofd",defaultMessage:"Hide for this chat"})}),e.jsx(ae.Item,{onClick:()=>{a.setDisabledGlobally(!0),s("global"),setTimeout(()=>s(null),5e3),$.logEventWithStatsig(B.messageFollowupSetting,"chatgpt_message_followup_setting",{...me(n),action:"disable_globally"})},className:"text-token-text-primary",children:e.jsx(G,{id:"dtAOq4",defaultMessage:"Hide everywhere"})})]})}const Ca={initial:{opacity:1},animate:{opacity:1},exit:{opacity:0,transition:{duration:.2}}};function fl({visible:t}){return e.jsx(Pe,{children:t&&e.jsx(z.div,{...Ca,className:"flex justify-center py-6 text-sm text-token-text-tertiary",children:e.jsx(G,{id:"ckTD9g",defaultMessage:"Follow ups are turned off for this conversation"})})})}function xl({visible:t}){return e.jsx(Pe,{children:t&&e.jsxs(z.div,{id:"disableForAllConvos",...Ca,className:"flex flex-col items-center py-3 text-sm",children:[e.jsx("div",{children:e.jsx(G,{id:"5GDIBQ",defaultMessage:"Follow up have been turned off"})}),e.jsx("div",{className:"pt-1 text-token-text-tertiary",children:e.jsx(G,{id:"LYaBNe",defaultMessage:"You can re-enable them in settings"})})]})})}function vl({modelSlug:t,animateModelLabelOnRender:s,isDropdownOpen:n,isRegenerateEnabled:a,isHovered:o,animateShortLabel:l}){const{data:i}=Vs(),[c,m]=r.useState("initial");r.useEffect(()=>{if(s){const p=setTimeout(()=>m("show"),500),d=setTimeout(()=>m("initial"),2e3);return()=>{clearTimeout(p),clearTimeout(d)}}m("initial")},[s]);const{shorterLabel:g}=i?.categories.find(({defaultModel:p})=>p===t)??{},x={initial:{opacity:0,paddingLeft:0,width:"0"},show:{opacity:1,paddingLeft:2,width:"100%"},visible:{opacity:1,paddingLeft:2,width:"100%",transition:{delay:0,duration:0}}},h=n?"visible":o?"show":c;return e.jsxs(z.div,{initial:"initial",animate:h,className:"flex items-center pb-0",children:[e.jsx(ia,{className:"icon-md"}),(a||l)&&e.jsx(z.span,{className:"overflow-hidden text-clip whitespace-nowrap text-sm",variants:x,transition:{type:"tween",duration:.18},children:g}),a&&e.jsx(Qo,{className:"icon-sm"})]})}function Mt(t,s){const{modelSwitcherDeny:n,subscriptionLevel:a}=t;return!!n&&n.reason===_n.RATE_LIMIT&&a===Cn.PLUS&&!s}const nt="rounded-lg radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed";function bl({className:t,clientThreadId:s,message:n,onModelSelect:a,canRegenerateResponse:o}){const[l,i]=r.useState(null),[c,m]=r.useState(!1),[g,x]=r.useState(!1),h=n.metadata?.model_slug,p=n.id,d=r.useRef(null),u=N=>{N||setTimeout(()=>{d.current&&d.current.blur()},10)};if(r.useEffect(()=>{u(c)},[c]),ee(s,Ko))return null;const b=Bo(s,n.id),C=n.metadata?.model_slug,k=Xo(b,C);return e.jsxs(ae.Root,{onOpenChange:N=>{o&&(C&&Kn(s,C),m(N),u(N))},children:[o?e.jsx(Rt,{sideOffset:0,label:e.jsx(G,{id:"wDs5sz",defaultMessage:"Switch model"}),children:e.jsx(yn,{ref:d,className:A("cursor-pointer",t),onMouseEnter:()=>x(!0),onMouseLeave:()=>x(!1),children:e.jsx(vl,{modelSlug:C,animateModelLabelOnRender:k,isDropdownOpen:c,isRegenerateEnabled:o,isHovered:g})})}):null,o&&e.jsx(ae.Portal,{children:e.jsxs(ae.Content,{className:"z-30 min-w-fit origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[e.jsx(ae.Item,{disabled:!0,className:"pb-0 pt-2",children:e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(G,{id:"bFLh5u",defaultMessage:"Switch model"})})}),e.jsx(yl,{clientThreadId:s,messageId:p,message:n,onModelSelect:a,messageModelSlug:h,setHoveredOption:i,hoveredOption:l})]})})]})}function yl({clientThreadId:t,message:s,messageId:n,messageModelSlug:a,onModelSelect:o,setHoveredOption:l,hoveredOption:i}){const c=Ce(),{data:m=null}=Sn(),g=m&&jn(m),{modelOptions:x,messageModelEnabledTools:h}=zo({clientThreadId:t,message:s}),p=h.includes(Se.Search),d=r.useMemo(()=>x.find(f=>f.value===a),[x,a]),[u,v]=r.useMemo(()=>Vo(x,f=>f.subcategory),[x]),b=Wo(s);r.useEffect(()=>{const f=x.some(y=>Mt(y,g));$.logEvent(B.conversationOpenMessageModelSelector,{has_get_plus_button:f,is_new_regen_dropdown:!0})},[]);const C=r.useMemo(()=>{const f=new Map;return u.forEach(y=>{const E=y.subcategory;E&&(f.has(E)||f.set(E,[]),f.get(E)?.push(y))}),f},[u]),k=A("icon-sm","order-10 ml-auto text-token-text-tertiary icon-md"),N=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:c.formatMessage(Tt.search),icon:e.jsx(qo,{className:k}),condition:p&&!b,eventName:"chatgpt_regenerate_with_search_button_clicked"},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:c.formatMessage(Tt.nosearch),icon:e.jsx($o,{className:k}),condition:p&&b,eventName:"chatgpt_regenerate_without_search_button_clicked"}];return e.jsxs(e.Fragment,{children:[v.map(f=>{const{value:y,...E}=f;return e.jsx(tt,{value:y,onSelect:w=>{ne.logEvent("chatgpt_regenerate_switch_model_button_clicked",y,{requestedModelId:y,...me({clientThreadId:t,messageId:n})}),o({sourceEvent:w,requestedModelId:y})},includeRegenerate:!1,onMouseEnter:()=>l(y),onMouseLeave:()=>l(null),isHovered:i===y,messageModelSlug:a,includeCheck:!1,shouldShowUpsell:Mt(f,g),className:nt,...E,icon:e.jsx("span",{className:k}),clientThreadId:t},y)}),[...C.entries()].map(([f,y])=>e.jsxs(ae.Sub,{children:[e.jsx(ae.SubMenuTrigger,{children:e.jsx("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:f})}),e.jsx(ae.Portal,{children:e.jsx(ae.SubContent,{className:"min-w-fit",children:y.map(E=>{const{value:w,..._}=E;return e.jsx(tt,{value:w,onSelect:S=>{ne.logEvent("chatgpt_regenerate_switch_model_button_clicked",w,{requestedModelId:w,...me({clientThreadId:t,messageId:n})}),o({sourceEvent:S,requestedModelId:w})},includeRegenerate:!1,onMouseEnter:()=>l(w),onMouseLeave:()=>l(null),isHovered:i===w,messageModelSlug:a,includeCheck:!1,className:nt,..._,icon:null,shouldShowUpsell:Mt(E,g),clientThreadId:t},f+"-"+w)})})})]},f)),!!d&&e.jsxs(e.Fragment,{children:[e.jsx(ae.Separator,{}),e.jsx(tt,{onSelect:f=>{ne.logEvent("chatgpt_regenerate_try_again_button_clicked",d.value,{requestedModelId:d.value,...me({clientThreadId:t,messageId:n})}),o({sourceEvent:f,requestedModelId:d.value})},includeRegenerate:!0,onMouseEnter:()=>l(d.value),onMouseLeave:()=>l(null),messageModelSlug:a,includeCheck:!1,className:nt,...d,label:c.formatMessage(Tt.tryAgain),subtitle:d.label,icon:e.jsx(ia,{className:k}),clientThreadId:t},d.value),N.filter(f=>f.condition).map(f=>e.jsx(tt,{onSelect:y=>{ne.logEvent(f.eventName,d.value,{requestedModelId:d.value,...me({clientThreadId:t,messageId:n})}),o({sourceEvent:y,requestedModelId:d.value,extraStreamParams:f.extraStreamParams})},includeRegenerate:!1,onMouseEnter:()=>l(f.key),onMouseLeave:()=>l(null),isHovered:i===f.key,messageModelSlug:a,includeCheck:!1,className:nt,...d,label:f.label,subtitle:"",icon:f.icon,clientThreadId:t},f.key))]})]})}const Tt=ut({tryAgain:{id:"VbsBGW",defaultMessage:"Try again"},search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),Sl=r.memo(bl),jl=ge(()=>je(()=>import("./exogbkqhbs3sd47e.js"),__vite__mapDeps([26,1,2,3,27,28,6,7,29,30,31])).then(t=>t.VoicePlayButton)),_l=ge(async()=>Promise.resolve(()=>null)),Cl=({alwaysShow:t,isUserTurn:s,children:n})=>{const a=r.useRef(null);return r.useEffect(()=>{const o=a.current;o&&(t?requestAnimationFrame(()=>{o&&(o.style.maskPosition=t?"0% 0%":"")}):o.style.maskPosition="")},[t]),e.jsx("div",{className:A("flex",!t&&"absolute left-0 right-0 flex",s?"justify-end":"justify-start"),children:e.jsx("div",{ref:a,className:A("-me-1 -ms-2.5 flex select-none items-center p-1 touch:-me-2 touch:-ms-3.5",!s&&"-mt-1",t&&"duration-[1.5s]","focus-within:transition-none hover:transition-none",!(t||s)&&"duration-500 group-hover/turn-messages:delay-300",!s&&["pointer-events-none [mask-image:linear-gradient(to_right,black_33%,transparent_66%)] [mask-position:100%_0%] [mask-size:300%_100%] motion-safe:transition-[mask-position]","group-hover/turn-messages:pointer-events-auto group-hover/turn-messages:[mask-position:0_0]","group-focus-within/turn-messages:pointer-events-auto group-focus-within/turn-messages:[mask-position:0_0]","has-[[data-state=open]]:pointer-events-auto has-[[data-state=open]]:[mask-position:0_0]"],s&&["duration-300 group-hover/turn-messages:delay-300","pointer-events-none opacity-0 motion-safe:transition-opacity","group-hover/turn-messages:pointer-events-auto group-hover/turn-messages:opacity-100","group-focus-within/turn-messages:pointer-events-auto group-focus-within/turn-messages:opacity-100","has-[[data-state=open]]:pointer-events-auto has-[[data-state=open]]:opacity-100"]),children:n})})},wl=({activeVariantIndex:t,clientThreadId:s,conversationMode:n,lastMessage:a,messages:o,numVariants:l,onChangeIndex:i,onRate:c,showCanvasButton:m,showCopyButton:g,showDiscussButton:x,showPagination:h,showPlayButton:p,showRatingButtons:d,showRegenerateButton:u,showShareButton:v,turn:b,turnIndex:C})=>{const k=Ws(),N=Ce(),f=qs(),y=a?.clientMetadata?.rating;a?.clientMetadata?.requestId;const E=o.some(w=>{const[_]=w.author.name?.split(".")??[];return _===wn.T2UAY3K});return e.jsxs(e.Fragment,{children:[h&&e.jsx(la,{currentPage:t,onChangeIndex:i,length:l}),!1,g&&e.jsx(wa,{onClick:w=>{ca(k,s,C,f,w)}}),!E&&d&&e.jsxs(e.Fragment,{children:[y!=="thumbsDown"&&e.jsx(it,{onClick:()=>c("thumbsUp"),disabled:y==="thumbsUp",icon:y==="thumbsUp"?Yo:da,label:N.formatMessage({id:"ConversationTurn.goodResponseTooltip",defaultMessage:"Good response"}),testId:"good-response-turn-action-button"}),y!=="thumbsUp"&&e.jsx(it,{onClick:()=>c("thumbsDown"),disabled:y==="thumbsDown",icon:y==="thumbsDown"?Zo:ua,label:N.formatMessage({id:"ConversationTurn.badResponseTooltip",defaultMessage:"Bad response"}),testId:"bad-response-turn-action-button"})]}),p&&a&&e.jsx(jl,{conversationId:s,message:a,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-xs text-token-text-tertiary hover:text-token-text-primary"}),!E&&m&&e.jsx(Jo,{turn:b}),v&&e.jsx(it,{onClick:()=>{const w=Ue(s);w&&Ve.openSharingModal(w)},label:N.formatMessage({id:"ConversationTurn.shareButtonTooltip",defaultMessage:"Share conversation"}),className:"sm:hidden",icon:er}),x&&!1,u&&a&&e.jsx(Tl,{clientThreadId:s,conversationMode:n,lastMessage:a,messages:o,hasImageGenMessage:E})]})},Ml=({activeVariantIndex:t,clientThreadId:s,numVariants:n,onAnticipateEdit:a,onChangeIndex:o,onEnterEdit:l,showCopyButton:i,showEditMessageButton:c,showPagination:m,turnIndex:g})=>{const x=Ws(),h=qs();return e.jsxs(e.Fragment,{children:[i&&e.jsx(wa,{onClick:p=>{ca(x,s,g,h,p)}}),c&&e.jsx(tr,{onAnticipateEdit:a,onEnterEdit:l}),m&&e.jsx(la,{currentPage:t,onChangeIndex:o,length:n})]})},Tl=({clientThreadId:t,conversationMode:s,messages:n,hasImageGenMessage:a,lastMessage:o})=>{const l=Fi({clientThreadId:t,conversationMode:s}),i=sr(t,o),c=r.useCallback(({sourceEvent:m,requestedModelId:g,appendMessages:x,extraStreamParams:h})=>{o&&l({sourceEvent:m,nodeId:o.id,requestedModelId:g,appendMessages:x,extraStreamParams:h})},[o,l]);return a?e.jsx(_l,{messages:n,onModelSelect:c}):e.jsx(Sl,{className:"h-[30px] rounded-md px-1.5 text-token-text-secondary hover:bg-token-main-surface-secondary touch:px-2.5",clientThreadId:t,message:o,onModelSelect:c,canRegenerateResponse:i})},wa=({onClick:t})=>{const[s,n]=r.useState(!1),a=ar(),o=Ce(),l=r.useCallback(i=>{i.stopPropagation(),$.logEvent(B.chatgptTurnActionCopyClicked),t(i),n(!0),setTimeout(()=>{a()&&n(!1)},2e3),ne.logEvent("chatgpt_turn_action_copy")},[a,t]);return e.jsx(it,{icon:s?Mn:Tn,onClick:l,label:o.formatMessage({id:"CopyButton.copyTooltip",defaultMessage:"Copy"}),testId:"copy-turn-action-button"})},As=[1,2,3,4,10,20,30],kl=.5;function Nl({clientThreadId:t}){const s=ma(ga.isBusinessWorkspace),n=r.useRef(!1),a=dt(t),[o,l,i,c]=ee(t,_=>[_?.mode,U.getRequestId(_),U.getConversationLastTurn(_),U.getConversationTurns(_).filter(S=>S.role===Z.Assistant).length]),{isUnauthenticated:m}=Re(),g=r.useMemo(()=>{if(!a)return-1;const _=na(a);return _()>kl?-1:As[Math.floor(_()*As.length)]},[a]),x=Lt(l),[h,p]=r.useState(null),[d,u]=r.useState(!1),[v,b]=r.useState(!1),[C,k]=r.useState(!1),N=_=>{const S=i?.messages[0]?.id;p(_),y(S,_)},f=i?.role===Z.Assistant,y=r.useMemo(()=>Zs((_,S)=>{a&&_&&Be.submitConversationRating({conversation_id:a,message_id:_,rating:S,shown_at_assistant_turn:g}),$.logEvent(B.conversationRatingSubmitted,{rating:S,showAtAssistantTurn:g,conversationId:a}),u(!0),setTimeout(()=>{b(!0)},1500)},2e3),[a,g]),E=c!==g||x||!f||!!s||o?.kind!==Gt.PrimaryAssistant||C||m;r.useEffect(()=>{!E&&!n.current&&($.logEvent(B.conversationRatingShown,{showAtAssistantTurn:g,conversationId:a}),n.current=!0)},[E]);const w=nr();return C||!w.forceShowConvoRating&&E?null:e.jsxs("div",{className:"mx-auto",children:[e.jsx(Pe,{children:d&&!v&&e.jsx(z.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(Rs,{$padded:!0,children:e.jsx("span",{className:"text-sm text-token-text-tertiary",children:e.jsx(G,{id:"rating.thanks",defaultMessage:"Thanks for your feedback!"})})})},"submitted")}),!d&&e.jsx(z.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},children:e.jsxs(Rs,{$padded:!1,children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 px-4 py-3 text-sm text-token-text-secondary",children:[e.jsx(G,{id:"rating.instructions",defaultMessage:"Is this conversation helpful so far?"}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx(kt,{$selected:h==="thumbsUp",onClick:()=>N("thumbsUp"),children:e.jsx(da,{className:"icon-md"})}),e.jsx(kt,{$selected:h==="thumbsDown",onClick:()=>N("thumbsDown"),children:e.jsx(ua,{className:"icon-md"})})]})]}),e.jsx("div",{className:"w-px flex-1 self-stretch bg-token-main-surface-tertiary"}),e.jsx(kt,{className:"p-3",$selected:!1,onClick:()=>k(!0),children:e.jsx(kn,{className:"icon-md text-token-text-secondary hover:text-token-text-primary"})})]})},"rating")]})}const kt=_e.button`
  ${t=>t.$selected?"text-token-text-primary":"text-token-text-secondary"}
  hover:text-token-text-primary
`,Rs=_e.div`inline-flex rounded-xl border border-gray-100 dark:border-gray-700
${t=>t.$padded&&"py-3 px-4"}
`,El=ge(()=>je(()=>import("./ksgfhnrswte6iw5i.js"),__vite__mapDeps([32,1,2,3,6,7,33])));function Il({clientThreadId:t,canShowInlineMessageFeedback:s,messageForRating:n,allGroupedMessages:a,currentModelId:o}){let l=null;const i=ee(t,h=>{const p=U.getConversationTurns(h);let d=0;for(let u=p.length-1;u>=0;u--){const v=p[u];if(v.messages.some(b=>b.metadata?.is_indepth_feedback))return!0;if(v.messages.some(b=>b.author.role===Z.Assistant)&&d++,d>=3)break}return!1}),c=dt(t),m=Bt(h=>h.voiceFeedbackThread),g=c===m,{voiceName:x}=or();return i?null:(g&&c?(Nn.feedbackShown.success({voice:x}),l=e.jsx("div",{className:"text-center",children:e.jsx(rr,{serverThreadId:c})})):n.clientMetadata?.rating&&s?l=e.jsx(El,{clientThreadId:t,conversationMessage:n,allGroupedMessages:a,currentModelId:o}):l=e.jsx("div",{className:"text-center",children:e.jsx(Nl,{clientThreadId:t})}),e.jsx("div",{className:"mt-3 w-full empty:hidden",children:l}))}const Al=ge(()=>je(()=>import("./bg82vxo39mz0x6ax.js"),__vite__mapDeps([24,2,1,3,6,7,25])).then(t=>t.MemoryActionResult)),Rl=ge(()=>je(()=>import("./h55t7ofrlf5o55fq.js"),__vite__mapDeps([34,1,6,2,3,7,35,36,37])).then(t=>t.AutomationSourceHeader)),Ps=ge(()=>je(()=>import("./0i74lvadqrdq6g27.js"),__vite__mapDeps([38,1,2,3,6,7,15])).then(t=>t.TextMessageEditor)),Fs=80,Pl=16,Ds={minHeight:`calc(100dvh - ${wr}px - 120px)`};function Fl(t){const{turnIndex:s,isFinalTurn:n,clientThreadId:a,onChangeRating:o,onRequestCompletion:l,currentModelId:i,avatarClassName:c,showAvatar:m,scrollToMessageId:g,dateHeaderType:x}=t,h=gt();Gs()?.normalizedAccountUserId;const p=!!h&&En(h),d=sa(),u=ma(ga.isBusinessWorkspace),v=fa(),{value:b}=re("1760640904"),{value:C}=re("1456513860"),k=m??!C,f=null!=null,E=In("2181185232").config.get("enabled",!1),w=Ni(),_=Ue(a),[S,H]=ee(a,j=>{const K=U.getConversationTurnAtIndex(j,s),be=s>0?U.getConversationTurnAtIndex(j,s-1):null,de=be?.role===Z.User&&be.messages.some(ye=>ye.metadata?.visually_hide_response_from_conversation);return[K,de]}),{messages:I,messageGroups:M}=S,T=ir(),V=I[0],R=L(I),{messages:O,visibleMessages:J,messageGroups:X,lastMessageToRender:Y,doesTurnHaveDelayedMessages:te}=r.useMemo(()=>{const j=T.size===0?-1:M.findIndex(ye=>ye.messages.some(St=>T.has(St?.id))),K=j!==-1&&j+1<M.length,be=K?M.slice(0,j+1):M,de=K?be.flatMap(ye=>ye.messages):I;return{messages:de,visibleMessages:de.filter(An),messageGroups:be,lastMessageToRender:L(de),doesTurnHaveDelayedMessages:j!==-1}},[I,M,T]),F=r.useMemo(()=>({clientThreadId:a,turnIndex:s,messageId:R?.id}),[a,s,R?.id]),P=!1,D=Js(),[Fe,he]=r.useState(!1),[Le,we]=r.useState(!1),Me=r.useContext(ha)!=null,W=S.role===Z.User,ie=Ft(),le=Dt(a),pe=aa(S.gizmoId??le).data,fe=pa(a),He=lr(fe),qe=cr(fe),ht=r.useContext($s),pt=Qs(ht),[Te,ft,$e,Ge,ce,xt,xe,Q,Qe,Ke,Ma,ke,Vt]=ee(a,j=>{const K=U.getParentPromptNode(j,V.id),be=K?.message.clientMetadata?.variantsInStreamInfo??(K?.message.metadata?.paragen_variant_choice?void 0:K?.message.metadata?.paragen_variants_info),de=U.getVariantIds(j,V.id),ye=U.getCurrentVariantId(j,V.id),St=ye?de.indexOf(ye):0,un=be&&j?.tree!=null&&de.some(Ne=>{const{errType:as}=j.tree.getLeafFromNode(Ne).message.clientMetadata??{};return as!=null&&as!=="info"}),jt=U.getConversationTurns(j);return[j?.async_status===Dn.STREAMING,U.isMessageTurnEnded(j,R?.id),un,Mr(j?.mode,pe?.gizmo.id),j?.continuingFromSharedConversationId!=null,null,jt.findIndex(Ne=>Ne.role===Z.User)===s,Un(jt,Ne=>Ne.role===Z.User)===s,jt.findIndex(Ne=>Ne.role===Z.Assistant)===s,U.getRequestId(j,R?.id),be,de,St]});let Ta="default";const ka=O.some(j=>j.content.content_type===Rn.MultimodalText),{layer:Na}=Ae("1547743984"),{layer:Ea}=Ae("3119715334"),Ia=Ea.get("should-enable-skip",!1),Aa=_!=null&&D&&Na.get("show_share_button_inline",!1),{isUnauthenticated:Wt}=Re(),Ra=S.messages.map(j=>j.id),ve=r.useRef(null),qt=(g?.length??0)>2&&g!=="finalAgentTurn"&&n&&v,Xe=W?L(J):void 0,vt=Xe?.id,Pa=r.useCallback(()=>{vt&&($.logEvent(B.editPrompt,{id:vt,threadId:Ue(a)}),ne.logEvent("chatgpt_edit_prompt"),he(!0))},[vt,a]),Fa=r.useCallback(()=>{he(!1)},[]),Da=j=>{R&&(o({nodeId:R.id,messageId:R.id,rating:j}),$.logEvent(j==="thumbsDown"?B.messageFeedbackThumbsDownClicked:B.messageFeedbackThumbsUpClicked,{id:R.id,threadId:Ue(a),model:i,rating:j}),we(!0))},[Ua]=r.useState(()=>Date.now()),La=dr(a),{layer:Ha}=Pt("109457"),$t=ee(a,j=>La&&U.getConversationTurns(j).filter(K=>K.role===Z.Assistant).length<=Ha.get("onboarding_inject_cards_position",3)),Qt=Ke!=null,Ga=Lt(Ke),oe=!ft&&Ga||te,Kt=Bs(),[Oa,Xt]=r.useState(Qt),Yt=r.useRef(!1),Ba=ur(a,R);r.useEffect(()=>{if(Yt.current||g===void 0||!v||!ve.current){g==="finalAgentTurn"&&n&&De(a,j=>{j.scrollToMessageId=void 0});return}(Ra.includes(g)||g==="finalAgentTurn"&&n)&&(Yt.current=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(ve.current)if(g==="finalAgentTurn"&&n)ve.current.scrollIntoView({behavior:"instant",block:"end"}),De(a,j=>{j.scrollToMessageId=void 0});else{const j=ve.current.offsetHeight;let K;j>Fs?K=Fs-j:K=0,ve.current.style.scrollMarginTop=`${K+Pl}px`,ve.current.scrollIntoView({behavior:"smooth"})}})}))},[g,ve.current]);const{showDebugConversationTurns:za}=oa(),Va=mr(),Wa=!d&&!ce&&!ie&&!W,qa=gr(),$a=Y?.author.role===Z.Assistant?Y:null,Qa=Y?.metadata?.system_hints?.includes(Se.Research);hr({isCompletionRequestInProgress:oe,isUserTurn:W,message:$a});const{isOpen:Ka}=Ei(),Xa=pr(),Ye=fr(Ge),Oe=!qa&&!Ye&&Wa&&n&&Ma?.num_variants_in_stream===2&&ke.length<=2&&!R?.clientMetadata?.inlineComparisonRating&&!$e,Ze=n&&Qt,Ya=(Oa||Ze)&&!Fe&&!d&&!ce&&!Ye&&!Te&&!oe&&!Ka&&!$t&&S.role!==Z.Developer,Za=Ze&&!oe&&!ce&&!d&&(E||w),Je=R!=null&&!f&&(!u||qe||p)&&!Ye&&!Wt&&!ie&&!R.metadata?.b1de6e2_s,Ja=Je&&Ze&&!Te&&!oe,Zt=!d&&!((oe||Te)&&n)&&ke.length>1&&!Oe&&!f&&!$t,Jt=W&&O.some(j=>xr(j)?.shouldHideContent),en=W&&Xe!=null&&!Ye&&!d&&!ka&&!Jt&&!Wt&&!f&&!Qa,tn=R!=null&&(R.clientMetadata?.disclaimers??[]).length===0,es=r.useCallback(j=>{De(a,K=>{Ut.setCurrentBranch(K,ke[j])}),$.logEvent(B.changeNode,{intent:"toggle_between"})},[a,ke]),sn=vr(S,O,za),{toggleThreadSidebar:ts}=Pn(),bt=R?.id,an=r.useCallback(()=>{bt&&ts({type:"retrievalResults",clientThreadId:a,turnIndex:s,messageId:bt})},[bt,ts,a,s]),nn=r.useMemo(()=>br(S,He,!!le),[He,le,S]);if(!sn&&!Oe)return qt?e.jsx("div",{style:Ds}):null;if(H)return null;const on=Y?.metadata?.followup_prompts?Y.metadata.followup_prompts.map(j=>({text:j,type:se.Reply})):[],rn=Y?.metadata?.followup_categories,ln=!O.some(j=>Fn.getAudioAssetPointers(j).length>0)&&!f&&!le,cn=!oe&&O.some(j=>j.author.role===Z.Assistant&&j.metadata?.onboarding?.main_usages),yt=O.find(j=>!!j.metadata?.onboarding?.examples)?.metadata?.onboarding?.examples,ss=!Jt&&(!W||b)&&(!n||!oe);if(Va&&!f&&!n&&J.length===0)return null;const dn=!n&&S.messages.some(j=>j.clientMetadata?.isLastMessageFromSharedConversation);return e.jsxs(yr.Provider,{value:Qe,children:[e.jsx(Sr,{dateHeaderType:x,turn:S}),e.jsxs("article",{className:A("w-full text-token-text-primary",g==="finalAgentTurn"&&v?"opacity-0":"",{hidden:Me&&xe}),style:qt?Ds:void 0,ref:ve,dir:"auto","data-testid":`conversation-turn-${s}`,"data-scroll-anchor":n,children:[e.jsx(jr,{role:S.role}),e.jsxs(Ie,{isStaticSharedThread:d,verticalPadding:Ta,horizontalPadding:Oe?"none":pt||k?"standard":"expanded",children:[Oe?e.jsxs(e.Fragment,{children:[e.jsx(ol,{isFeedbackEnabled:Je,variantIds:ke,conversationTurnMountTime:Ua,...t}),Ia&&e.jsx("div",{className:"mt-4 flex w-full justify-center",children:e.jsxs(Ht,{color:"secondary",className:"text-token-text-primary","data-testid":"paragen-skip-button",onClick:()=>{zs.publish({kind:"requestCompletion",isForSkippingParagen:!0})},children:[e.jsx(_r,{className:"mr-1 text-token-text-secondary"}),e.jsx(G,{id:"IuTr+b",defaultMessage:"Skip"})]})})]}):e.jsx(ct,{shouldRemoveGap:f,tabIndex:-1,className:"group/turn-messages focus-visible:outline-none",onFocus:()=>Xt(!0),onPointerEnter:()=>Xt(!0),children:e.jsxs(e.Fragment,{children:[P,!W&&!P&&k&&e.jsx(Ul,{children:e.jsx(At,{messages:O,isUserTurn:W,avatarClassName:c,gizmo:pe})}),e.jsx("div",{className:Et({isUserTurn:W,shouldDisplaySideBySideFeedback:Oe}),children:e.jsx("div",{className:"relative flex-col gap-1 md:gap-3",children:e.jsxs(e.Fragment,{children:[null,!W&&!d&&e.jsx(Al,{messages:O,clientThreadId:a,gizmoId:pe?.gizmo.id}),Xa&&!W&&e.jsx(Rl,{clientThreadId:a,messages:O}),Fe&&Xe?e.jsx(Ps,{message:Xe,clientThreadId:a,onRequestCompletion:l,onExitEdit:Fa,disabled:Kt}):e.jsx(It,{allMessages:I,groupedMessagesToRender:X,allGroupedMessages:M,...t,isUserTurn:W,isFinalUserTurn:Q,isCompletionRequestInProgress:oe,isFeedbackEnabled:Je,isFinalTurn:n,hasActiveRequest:Kt}),nn&&e.jsx(il,{handleShowRetrievalResults:an,clientThreadId:a,turnIndex:s,responseComplete:!(oe||Te)}),cn&&e.jsx(_i,{clientThreadId:a}),yt&&yt.length>0&&!oe&&e.jsx(Ci,{clientThreadId:a,examples:yt}),Ya&&e.jsx(Cl,{isUserTurn:W,alwaysShow:Ze,children:W?e.jsx(Ml,{activeVariantIndex:Vt,clientThreadId:a,numVariants:ke.length,onAnticipateEdit:Ps.prefetch,onChangeIndex:es,onEnterEdit:Pa,showCopyButton:ss,showEditMessageButton:en,showPagination:Zt,turnIndex:s}):e.jsx(wl,{activeVariantIndex:Vt,clientThreadId:a,conversationMode:Ge,lastMessage:R,messages:O,numVariants:ke.length,onChangeIndex:es,onRate:Da,showCanvasButton:Ba&&!f,showCopyButton:ss,showDiscussButton:!1,showPagination:Zt,showPlayButton:tn,showRatingButtons:Je,showRegenerateButton:ln,showShareButton:Aa,turn:S,turnIndex:s})}),Ja&&e.jsx(Il,{canShowInlineMessageFeedback:Le,clientThreadId:a,messageForRating:R,allGroupedMessages:M,currentModelId:i}),Za&&e.jsx(gl,{followups:on,categories:rn,clientThreadId:a,analyticsMetadata:F})]})})})]})}),dn&&e.jsx("div",{className:"mx-auto -mb-2 mt-8 flex justify-center",children:e.jsxs("p",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(Cr,{className:"icon-xs mr-2"}),e.jsx(G,{id:"threadLayout.sharedConversationPrivateDisclaimer",defaultMessage:"Messages beyond this point are only visible to you"})]})})]})]})]})}const Dl=Xs.memo(Fl),Ul=_e.div`flex-shrink-0 flex flex-col relative items-end`;function Ll(t){const s=U.getConversationTurns(t),n=s.findIndex(o=>o.role===Z.Assistant);if(n===-1)return;const a=s[n];for(let o=0;o<a.messageGroups.length;o++)if(a.messageGroups[o].type===is.SearchGPTQuery){const i=a.messageGroups.slice(o+1).find(({type:m})=>m===is.Text);if(i==null)return;const c=Ln(i.messages[0]);if(c?.[0]?.type==="navigation")return{turnIndex:n,navigationCitation:c[0],message:i.messages[0]}}}function Hl(t,s){if(s==null||t==null)return t;const n=new Set(t.domains.map(a=>a.url));return{...t,domains:[...t.domains,...s.domains.filter(a=>!n.has(a.url))],safe_urls:[...t.safe_urls??[],...s.safe_urls??[]]}}function Gl({clientThreadId:t,prefetchNavlink:s,setPrefetchNavlink:n}){const a=r.use(s),{value:o}=re("1032814809");r.useEffect(()=>{window.__oai_SSR_NAVLINK&&Tr.logEvent(B.searchToolPageLoadTimeToFastNavSSR,{server_timing:a?.timing},window.__oai_SSR_NAVLINK)},[]),r.useEffect(()=>{a==null&&n(void 0)},[a,n]);const l=r.useMemo(()=>a==null?null:{...a.navlink,domains:a.navlink.domains.map(m=>({...m,subtitle:m.subtitle??m.domain}))},[a]),i=ee(t,Ll),c=r.useMemo(()=>Hl(l,i?.navigationCitation),[i,l]);return a==null||c==null?null:e.jsxs("div",{children:[e.jsx(Ie,{horizontalPadding:"expanded",children:e.jsx(ct,{children:e.jsx("div",{className:Et({isUserTurn:!0,shouldDisplaySideBySideFeedback:!1}),children:e.jsx("div",{className:Di(!0),children:e.jsx(kr,{containsImagesOrAttachments:!1,isUserTurn:!0,children:e.jsx(Nr,{text:a.query})})})})})}),e.jsx("div",{className:"-mb-10",children:e.jsx(Ie,{horizontalPadding:"expanded",children:e.jsx(ct,{children:e.jsxs("div",{className:Et({isUserTurn:!1,shouldDisplaySideBySideFeedback:!1}),children:[e.jsx(Ri,{clientThreadId:t,turnIndex:i?.turnIndex??2,nextMessage:i?.message,navigationCitation:c}),o?e.jsxs("div",{className:"relative -top-2 flex justify-end gap-2 font-mono text-xs text-token-text-secondary",children:[e.jsxs("div",{elementtiming:"navlink",children:["server: ",a.timing,"ms"]}),e.jsx(Ol,{})]}):null]})})})}),e.jsx(Er,{scriptSrc:"requestAnimationFrame(()=>window.__oai_SSR_NAVLINK=window.__oai_SSR_NAVLINK||performance.now());"})]})}function Ol(){const[t,s]=r.useState(null);return r.useEffect(()=>{const n=new PerformanceObserver(a=>{a.getEntries().forEach(o=>{if(o.identifier==="navlink"){const l=o.renderTime;s(i=>i??l)}})});return n.observe({type:"element",buffered:!0}),()=>n.disconnect()},[]),t==null?null:e.jsxs("span",{children:["render: ",t,"ms"]})}function Bl({onChangeRating:t,onRequestCompletion:s,clientThreadId:n,scrollContainerRef:a,prefetchNavlink:o,setPrefetchNavlink:l}){const[i,c,m,g]=ee(n,T=>[T?.mode,U.getConversationTurnIds(T),T?.conversationOrigin===Hn.APPLE,T?.scrollToMessageId]),x=Ir(),h=xa(),p=fa(),d=Ar(),[u]=Rr(),v=Pr(),[b]=Fr(),C=pa(n),k=x.store.useContentAreaDimensions(Dr.Header,T=>T?.height?T.height:void 0),N=Ur(C.id),f=i?.kind===Gt.GizmoMagicCreate?"bg-token-main-surface-primary text-token-text-primary":N;r.useEffect(()=>{h&&(ne.logEvent("chatgpt_continue_conversation_page_loaded"),$.logEvent(B.continueConversationPageLoaded),ne.logEvent("chatgpt_conversation_share_page_loaded"),$.logEvent(B.sharedConversationPageLoaded))},[h]);const y=r.useCallback(()=>{d({behavior:"smooth"})},[d]),[E,w]=r.useState(!1),_=E||!p,S=Lr(n),H=r.useRef(null),{getAndroidKeyboardLayout:I}=ea(),M=Hr(n);return e.jsxs("div",{onCopy:S,className:A("mt-1.5 flex flex-col text-sm @thread-xl/thread:pt-header-height",I()&&"keyboard-open:pb-[calc(var(--composer-height,100px)+var(--screen-keyboard-height,0))]",k?null:"md:pb-9"),style:{paddingBottom:k},children:[o?e.jsx(Gn,{name:"prefetch-navlink",onError:T=>{ze.addError("Error with prefetch navlink",{error:T}),l(void 0)},children:e.jsx(r.Suspense,{fallback:null,children:e.jsx(Gl,{clientThreadId:n,prefetchNavlink:o,setPrefetchNavlink:l})})}):null,h&&e.jsxs(e.Fragment,{children:[e.jsx(ct,{children:e.jsx("p",{className:"text-xs text-gray-500",children:e.jsx(G,{id:"threadLayout.sharedConversationCopyDisclaimer",defaultMessage:"This is a copy of a conversation between ChatGPT & Anonymous."})})}),e.jsx("div",{className:"text-center text-xs font-semibold text-token-text-primary",children:e.jsx("button",{onClick:()=>{Ve.openModal(Gr.ReportConversation),ne.logEvent("chatgpt_conversation_share_report_content_clicked",null,{location:"Static Shared Thread Page"}),$.logEvent(B.sharedConversationReportContentClicked,{location:"Dynamic Shared Thread Page"})},children:e.jsx(G,{id:"thread.reportSharedConversation",defaultMessage:"Report content"})})})]}),c.map((T,V)=>e.jsx(Dl,{isFinalTurn:V===c.length-1,turnIndex:V,clientThreadId:n,onChangeRating:t,onRequestCompletion:s,currentModelId:C.id,avatarClassName:f,scrollToBottom:y,scrollToMessageId:g,dateHeaderType:M(V),showAvatar:void 0},T)),a?.current&&e.jsx(Ks,{setIsScrolledToEdge:w,options:{root:a.current,threshold:0,rootMargin:"0%"}},"threadBottomEdgeScrollObserver"),e.jsx("div",{ref:H}),m&&u&&!b&&e.jsx(Us,{className:A("translate-y-[10px] md:translate-y-[30px]"),onClick:()=>{ne.logEvent("chatgpt_thread_scroll_to_top"),v({behavior:"smooth"})},children:e.jsx(Or,{className:"icon-md text-token-text-primary"})}),e.jsx(Pe,{children:_&&e.jsx(z.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15,ease:"easeInOut"},children:e.jsx(Us,{className:A(k?null:"bottom-5"),style:{bottom:k},onClick:()=>{ne.logEvent("chatgpt_thread_scroll_to_bottom"),H.current?.scrollIntoView({behavior:"smooth",block:"end"})},children:e.jsx(Br,{className:"icon-md text-token-text-primary"})})})})]})}const Us=_e.button`cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-token-text-secondary border-token-border-light right-1/2 translate-x-1/2 bg-token-main-surface-primary w-8 h-8 flex items-center justify-center`;function zl(){return e.jsx("button",{"data-testid":"open-debug-sidebar-button",className:"flex h-6 w-6 items-center justify-center rounded-full border border-token-border-light text-xs text-token-text-secondary",onClick:()=>{Ve.setActiveSidebar("debug")},children:e.jsx(ui,{className:"icon-xs"})})}const Vl=ge(()=>je(()=>import("./hkx8od28rq7ar5x0.js"),__vite__mapDeps([39,1,6,2,3,7])));function Wl({clientThreadId:t}){const s=Qn(),n=dt(t),a=ee(t,U.getGizmoId),o=async()=>{n&&(await Be.patchConversation(n,{is_archived:!1}),s.invalidateQueries({queryKey:["conversation",t]}),De(n,l=>{l.initialThreadData.isArchived=!1}),hi(s,a))};return e.jsxs("div",{className:"my-6 flex flex-col items-center justify-center gap-4",children:[e.jsx("div",{className:"px-3 text-center text-sm text-token-text-secondary",children:e.jsx(G,{id:"thread.archivedConversationDescription",defaultMessage:"This conversation is archived. To continue, please unarchive it first."})}),e.jsx("div",{children:e.jsx(Ht,{disabled:!n,onClick:o,icon:mi,children:e.jsx(G,{id:"thread.unarchiveButton",defaultMessage:"Unarchive"})})})]})}const ql=function({clientThreadId:t,getGizmosCompletionParams:s,hideAppLaunchers:n,hideHeader:a,hideFooter:o,hideToolsOverlay:l,messagesVerticalAlign:i="top",renderEmptyState:c}){const m=On(),{data:g}=Vs(),x=zr(t),h=Bn(),[p,d,u,v,b,C,k]=ee(t,Q=>[Q?.isLoading,U.getCurrentLeafId(Q),U.hasUserMessage(Q),U.getConversationTurns(Q).length,U.getThreadData(Q).isArchived,Q?.modelId,Q?U.getGizmoId(Q):h]),{prefetchSearchPromises:N}=eo(),[f,y]=r.useState(N?.navlink),[E,w]=r.useState(0);r.useEffect(()=>{p||(ot(t)?ze.addTiming("chatgpt.web.chatPage.renderNewConversation"):ze.addTiming("chatgpt.web.chatPage.renderExistingConversation"))},[t,p]);const{setTargetedContent:_}=Vr(),S=m?.includes(zn),H=Wr(),I=null,M=v>=2,T=ot(t)&&!M&&Ct(x)&&N==null,V=ot(t)&&!u&&(Ct(x)||x?.kind===Gt.GizmoTest)&&N==null,O=qr(g).id,J=C??O,X=!!C,Y=$r(g?.models,J),te=Qr(t,x),F=Kr();Xr(v,t),r.useEffect(()=>{F||_(void 0)},[t,_,F,d]),r.useEffect(()=>{Ve.setIsConversationScrolledFromTop(!1)},[t]);const P=Xn(t),D=r.useCallback(Q=>{P(s?s(Q):Q)},[s,P]),{caModal:Fe,onChangeRating:he}=Yr({clientThreadId:t,currentModelConfig:Y}),Le=Zr({clientThreadId:t,handleRequestCompletion:D,prefetchSearchThreadIdPromise:N?.threadId})&&f==null,we=r.useRef(null),Me=Q=>{{const Qe=e.jsx("div",{className:"relative h-full",children:e.jsxs("div",{className:"flex h-full flex-col overflow-y-auto [scrollbar-gutter:stable]",ref:we,children:[e.jsx(Ks,{setIsScrolledToEdge:Ke=>{Ve.setIsConversationScrolledFromTop(Ke)},options:{root:we?.current}}),Q]})});return f!=null?Qe:e.jsx(Vn,{children:e.jsxs(r.Suspense,{fallback:null,children:[e.jsx(gi,{}),Qe]})})}};r.useEffect(()=>{document.title=te??"ChatGPT"},[te,I]);const W=r.useContext($s),ie=Qs(W),le=ie,pe=xa(),fe=r.useRef(null),He=r.useRef(null),qe=Jr(Q=>Q.composerHeight),ht=r.useMemo(()=>({threadContentScrollContainerElementRef:fe,footerRootContainerElementRef:He}),[]),{value:pt}=re("3861593998"),{isUXUpdatesEnabled:Te}=We(),ft=Ot(),$e=ta(k),Ge=!1,ce=!!k,xt=ce&&$e,xe=ce&&!$e||pt&&!xt;return e.jsx(ha.Provider,{value:f,children:e.jsx(ei,{children:e.jsx(bi,{clientThreadId:t,children:e.jsxs(Ys,{clientThreadId:t,children:[S&&e.jsx(Vl,{}),e.jsx(ti,{children:te!=null&&e.jsx("title",{children:te})}),e.jsx(si.Provider,{value:D,children:e.jsxs(ai,{children:[e.jsxs(ni,{currentPage:E,setCurrentPage:w,enableScroll:!1,className:A("@container/thread",!1),children:[e.jsxs(wi,{noKeyboard:!0,clientThreadId:t,currentModelConfig:Y,className:A("composer-parent flex h-full flex-col focus-visible:outline-0",Ge),children:[e.jsxs(oi,{value:ht,children:[!a&&e.jsx(tl,{clientThreadId:t,isEmptyState:V}),e.jsx("div",{ref:fe,className:"flex flex-1 grow basis-auto flex-col overflow-hidden",style:{"--composer-height":qe?`${qe}px`:void 0},children:!p&&!Le?V?c??e.jsx(e.Fragment,{children:ce?e.jsx(pi,{clientThreadId:t,gizmoId:k,onRequestCompletion:D,currentModelId:J}):e.jsx(Ki,{clientThreadId:t,currentModelId:J,isModelLoaded:X,onRequestCompletion:D,shouldUseUnifiedComposer:xe})}):M||f!=null?Me(e.jsx(Bl,{onChangeRating:he,onRequestCompletion:D,clientThreadId:t,scrollContainerRef:we,prefetchNavlink:f,setPrefetchNavlink:y},t)):null:null})]}),e.jsx("div",{className:A("isolate w-full basis-auto has-[[data-has-thread-error]]:pt-2 has-[[data-has-thread-error]]:[box-shadow:var(--sharp-edge-bottom-shadow)] dark:border-white/20 md:border-transparent md:pt-0 md:dark:border-transparent",xe&&T&&(ft?"@lg/thread:grow":"lg:grow"),xe&&"flex flex-col"),ref:He,children:b?e.jsx(Wl,{clientThreadId:t}):e.jsxs(e.Fragment,{children:[(!T||xe)&&e.jsx(Mi,{isGizmoThread:ce,isProjectThread:xt,clientThreadId:t,isNewThread:T,currentModelId:J,onRequestCompletion:D,shouldUseUnifiedComposer:xe,isModelLoaded:X,isVanguardUxEnabled:Te}),T&&e.jsx(ba,{clientThreadId:t}),T&&xe&&Te&&!ce&&!n&&E===0&&e.jsx("div",{style:{marginTop:"-80px"},children:e.jsx(ya,{clientThreadId:t})}),!o&&!le&&!Ge&&Ct(x)?e.jsx("div",{className:"relative mt-auto flex min-h-8 w-full items-center justify-center p-2 text-center text-xs text-token-text-secondary md:px-[60px]",children:e.jsx(ri,{clientThreadId:t})}):e.jsx("div",{className:"h-4"})]})})]}),!1]}),!l&&!ie&&e.jsxs("div",{className:"group absolute bottom-2 end-2 z-20 flex flex-col gap-1 md:flex lg:bottom-3 lg:end-3",children:[H?e.jsxs(e.Fragment,{children:[e.jsx(zl,{}),!1]}):null,e.jsx(ii,{})]}),Fe,e.jsx(li,{clientThreadId:t,isStaticSharedThread:!1,isDynamicSharedThread:pe}),e.jsx(ci,{}),e.jsx(di,{conversationId:t})]})})]})})})})},uc=Xs.memo(ql);export{Ji as C,uc as M};
//# sourceMappingURL=o2qs1cf88e5blfu6.js.map
