const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/j82cznxvb9ujlci8.js","assets/cyi7nanrg0vdotzd.js","assets/fs6h2trisr1juto6.js","assets/root-drzjahv8.css","assets/k76xevje6k7b3vo6.js","assets/df9u9imhvwerk6zv.js","assets/conversation-small-kx6wglz1.css","assets/ezf5q18ll5pwwbgt.js","assets/jteom3gltchw516e.js","assets/p32qvzx3ml1odktp.js","assets/lemb0bkyi7ypb3d9.js","assets/fhq0mjh143lckgnf.js","assets/fdc267gtmse8t1gq.js","assets/b76h37wcpakbn2sc.js","assets/eaofqm7le3tjix9x.js","assets/k6lz4hpqzwkvfb2a.js"])))=>i.map(i=>d[i]);
import{bH as V,a3 as xe,F as E,M as Z,V as fe,bS as he,c4 as $,E as be,y as D,d as X,z as G,aT as Se,aV as _e,cJ as Ne,bP as te,bQ as se,aM as ve,l as Y,bw as W,gn as y,c5 as L,go as ke,Z as De,gp as je,K as Me}from"./cyi7nanrg0vdotzd.js";import{j as e,r as d,e as ye,M as Pe,d as Oe,b as J}from"./fs6h2trisr1juto6.js";import{jE as ae,jF as h,d as Re,cb as C,ft as Ae,G as Te,hq as Le,eq as Ee,er as Ie,es as oe,eu as ie,a5 as Fe,hl as Ve,et as $e,jG as Ue,jH as Be,jI as qe}from"./df9u9imhvwerk6zv.js";import{S as q,c as we,_ as Ge,a as le,b as K,v as He,d as ce,g as Je,e as ze,u as We,f as Ke}from"./msv8m379cpay97wm.js";import{A as ne}from"./pcjkp37t4ugnklc3.js";import{_ as Qe}from"./fzrn137102spawew.js";import{C as Ze}from"./k76xevje6k7b3vo6.js";import{I as Xe}from"./muk733l8kcs92zol.js";import"./e9lafxuzyeh4418f.js";import"./ktvbjknz372ja7i7.js";function Ye(){const t=ae();return e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:["Force Use Search",!1]}),e.jsx(q,{id:"force-use-search",options:[{label:"Default",value:"default"},{label:"Force",value:"true"},{label:"Disable",value:"false"}],name:"force-use-search",className:"mt-1 shadow-none dark:text-gray-800",value:t.forceUseSearch==null?{value:"default",label:"Default"}:t.forceUseSearch?{value:"true",label:"Force"}:{value:"false",label:"Disable"},isMulti:!1,components:{Input:et},onChange:a=>{h({forceUseSearch:(a?.value??"default")==="default"?null:a?.value==="true"})}})]})})}const et=t=>e.jsx(we.Input,{...t,inputClassName:"focus:ring-0"});var tt=["allowCreateWhileLoading","createOptionPosition","formatCreateLabel","isValidNewOption","getNewOptionData","onCreateOption","options","onChange"],de=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",o=arguments.length>1?arguments[1]:void 0,s=arguments.length>2?arguments[2]:void 0,i=String(a).toLowerCase(),n=String(s.getOptionValue(o)).toLowerCase(),l=String(s.getOptionLabel(o)).toLowerCase();return n===i||l===i},Q={formatCreateLabel:function(a){return'Create "'.concat(a,'"')},isValidNewOption:function(a,o,s,i){return!(!a||o.some(function(n){return de(a,n,i)})||s.some(function(n){return de(a,n,i)}))},getNewOptionData:function(a,o){return{label:o,value:a,__isNew__:!0}}};function st(t){var a=t.allowCreateWhileLoading,o=a===void 0?!1:a,s=t.createOptionPosition,i=s===void 0?"last":s,n=t.formatCreateLabel,l=n===void 0?Q.formatCreateLabel:n,r=t.isValidNewOption,c=r===void 0?Q.isValidNewOption:r,u=t.getNewOptionData,g=u===void 0?Q.getNewOptionData:u,x=t.onCreateOption,m=t.options,f=m===void 0?[]:m,b=t.onChange,v=Ge(t,tt),_=v.getOptionValue,j=_===void 0?Je:_,p=v.getOptionLabel,R=p===void 0?ze:p,w=v.inputValue,I=v.isLoading,A=v.isMulti,P=v.value,T=v.name,N=d.useMemo(function(){return c(w,le(P),f,{getOptionValue:j,getOptionLabel:R})?g(w,l(w)):void 0},[l,g,R,j,w,c,f,P]),U=d.useMemo(function(){return(o||!I)&&N?i==="first"?[N].concat(K(f)):[].concat(K(f),[N]):f},[o,i,I,N,f]),z=d.useCallback(function(M,k){if(k.action!=="select-option")return b(M,k);var F=Array.isArray(M)?M:[M];if(F[F.length-1]===N){if(x)x(w);else{var S=g(w,w),O={action:"create-option",name:T,option:S};b(He(A,[].concat(K(le(P)),[S]),S),O)}return}b(M,k)},[g,w,A,T,N,x,b,P]);return ce(ce({},v),{},{options:U,onChange:z})}var at=d.forwardRef(function(t,a){var o=We(t),s=st(o);return d.createElement(Ke,Qe({ref:a},s))}),nt=at;function rt({children:t,className:a,open:o,onClose:s}){const i=d.useRef(null);d.useEffect(()=>{const l=i.current;if(!(!o||!l))return o==="modal"?l.showModal():l.show(),()=>{l.close()}},[o]);const n=l=>{l.target===l.currentTarget&&s?.()};return e.jsx("dialog",{className:a,open:o===!0,ref:i,onClick:n,children:t})}function ot({clientThreadId:t}){const{rebaseSystemMessageContent:a,showDebugConversationTurns:o}=ae(),[s,i]=d.useState(()=>a?JSON.stringify(a,null,2):void 0),[n,l]=d.useState(!!a),c=xe(t,m=>E.findNode(m,f=>f.message.content.content_type===Z.SystemContent))?.message.content??null,u=()=>{i(c?JSON.stringify(c,null,2):"")},g=fe(),x=d.useMemo(()=>Re(m=>{try{m?h({rebaseSystemMessageContent:{...JSON.parse(m),content_type:Z.SystemContent}}):h({rebaseSystemMessageContent:null}),g.closeAll()}catch{g.danger("The System Message is not valid JSON")}},500),[g]);return d.useEffect(()=>{n?x(s):(x.cancel(),h({rebaseSystemMessageContent:null}))},[x,n,s]),e.jsxs("div",{className:"flex flex-col gap-3 px-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(he,{label:"Enable to apply this system message to the current conversation.",children:e.jsx(C,{id:"enabled",label:"Enabled",checked:n,onChange:m=>l(m.currentTarget.checked)})}),e.jsx(C,{id:"show-internal-conversation-turns",label:"Conversation debug mode",checked:o,onChange:()=>{h({showDebugConversationTurns:!o})}})]}),e.jsx($,{disabled:!c,className:"mt-2",onClick:u,size:"small",children:"Load active system message"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"System Message"}),e.jsx(it,{disabled:!n,placeholder:c?"Press `Load active system message` to pre-populate this":"Start a conversation and then press `Load active system message` to pre-populate this",className:"min-h-[75vh] rounded-md border border-gray-400 p-1 font-mono",value:s,onChange:m=>i(m.target.value)})]})]})}const it=V.textarea`w-full rounded-lg border border-token-border-light bg-token-main-surface-primary text-sm text-token-text-primary focus:border-token-text-primary focus:shadow-none focus:outline-none focus:ring-token-text-primary disabled:bg-token-main-surface-tertiary`;function lt({clientThreadId:t}){const[a,o]=d.useState([]),s=be(t),i=E.getCurrentLeafId(s),n=E.getConversationTurns(s),l=c=>{Se(t,u=>{_e.setCurrentBranch(u,c)})},r=c=>{o(u=>[...u,i]),l(c)};return e.jsxs(e.Fragment,{children:[a.length>0&&e.jsxs($,{className:"absolute left-2 top-2",color:"secondary",onClick:()=>{const c=a[a.length-1];l(c),o(u=>u.slice(0,-1))},children:[e.jsx(Ae,{className:"icon-sm"}),"Go back to ",a[a.length-1]]}),e.jsx("div",{className:"flex flex-col items-center gap-4 overflow-auto p-4 text-xs",children:n.map((c,u)=>{const g=c.messages[0].id,x=E.getTree(s),m=u!==0?x.getParent(g):null,f=m!=null?m.children.findIndex(p=>g===p):0,b=m!=null?m.children:[],v=b.slice(0,f),_=b.slice(f+1);let j;switch(c.role){case D.User:j="bg-blue-500";break;case D.Assistant:j="bg-gray-600";break;default:j="bg-gray-400";break}return e.jsxs("div",{className:X("relative p-2",j),children:[e.jsx("div",{className:"absolute bottom-0 left-0 -ml-2 flex -translate-x-full gap-2 pl-2",children:v.map(p=>e.jsx(ue,{variantId:p,onChangeItemInView:r},p))}),e.jsx("div",{className:"absolute left-full top-0 ml-2 flex gap-2 pr-2",children:_.map(p=>e.jsx(ue,{variantId:p,onChangeItemInView:r},p))}),e.jsx("div",{className:"flex flex-col gap-2",children:c.messages.map(p=>e.jsxs("div",{className:"h-14 w-32 truncate bg-gray-200 p-1 text-black",children:[e.jsx("div",{className:"font-semibold",children:p.id}),e.jsx("div",{className:"italic text-token-text-tertiary",children:p.author.role}),e.jsx("div",{children:G(p)})]},p.id))})]},u)})})]})}function ue({variantId:t,onChangeItemInView:a}){return e.jsx("button",{className:"w-32 truncate bg-gray-400 p-2 text-black opacity-50 hover:opacity-100",onClick:()=>{a(t)},children:e.jsx("span",{className:"bg-gray-200 p-2",children:t})},t)}const ct=te(()=>se(()=>import("./j82cznxvb9ujlci8.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13])).then(t=>t.DebugModalContents)),dt=te(()=>se(()=>import("./eaofqm7le3tjix9x.js"),__vite__mapDeps([14,2,1,3,5,6])).then(t=>t.FramesViewer)),ut=te(()=>se(()=>import("./k6lz4hpqzwkvfb2a.js"),__vite__mapDeps([15,2,1,3])).then(t=>t.ImageEditingViewer)),me=Object.values(Te);function mt({children:t,title:a,icon:o,isOpen:s,asDialog:i,onClose:n}){const l=e.jsxs(Ct,{children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 text-lg font-semibold text-gray-900 dark:text-white",children:[e.jsx(o,{className:"icon-sm"}),a]}),e.jsx("div",{className:"mr-2 mt-2 flex h-7 items-center",children:e.jsx(Ne,{onClick:n})})]}),t]});return i&&s?e.jsx(rt,{className:"end-0 start-auto m-0 h-full max-h-full w-[fit-content] max-w-[300px]",open:"modal",onClose:n,children:l}):s?l:null}function gt({nodes:t,setDebugNodeIndex:a,setFrameSrc:o,conversationId:s}){const i=t.map((n,l)=>{const r=n.message,{role:c,name:u}=r.author,g=u&&u!==c,x=y(r,"metadata.__internal.model_id"),m=y(r,"metadata.__internal.s2s_vm_id"),f=y(r,"metadata.__internal.agent.settings.completion_api.engine"),b=m??f,v=y(r,"metadata.__internal.model_experiment_name"),_=y(r,"metadata.__internal.model_experiment_treatment"),j=y(r,"metadata.__internal.alternative_model_selection_rule"),p=y(r,"metadata.__internal.model_experiment_group_name"),R=y(r,"metadata.__internal.model_experiment_group_params"),w=y(r,"metadata.__internal.model_experiment_override"),I=y(r,"metadata.__internal.model_experiment_eval_seq"),A=y(r,"metadata.__internal.raw_tokens")?.length,P=y(r,"metadata.request_id"),T=y(r,"metadata.__internal.search_settings"),N=L.getAudio(r),U=L.getAudioAssetPointers(r),z=L.getFrameAssetPointers(r),M=L.getVideoContainerAssetPointers(r),k=L.getImageOperationFileIds(r),F=y(r,"metadata.__internal.sonic_debug");if(F){const S=G(r);return e.jsxs(pe,{role:"button",onClick:()=>a(l),children:[e.jsxs("div",{className:X("flex items-center gap-1 break-words text-xs font-semibold uppercase","text-token-text-tertiary"),children:["search (",F,")"]}),e.jsx("div",{className:"line-clamp-12 text-xs",children:S})]},r.id)}return e.jsxs(pe,{role:"button",onClick:()=>a(l),children:[e.jsxs("div",{className:X("flex items-center gap-1 break-words text-xs font-semibold uppercase",c===D.User?"text-token-text-primary":"text-token-text-tertiary"),children:[c===D.User&&e.jsx(Ue,{className:"icon-sm"}),c,g&&` (${u})`,r.recipient&&" -> ",ke(r)]}),(r.author.role!==D.System||P)&&e.jsxs("div",{className:"text-xs text-token-text-tertiary",children:[e.jsxs("div",{children:["ID: ",r.id]}),n.id!==r.id&&e.jsxs("div",{children:["UI Node ID: ",n.id]}),e.jsxs("div",{children:["Req ID: ",P||"Reload page to see ID"]})]}),e.jsx("div",{className:"line-clamp-6",children:G(r)}),(A||x||b||v||_||j||p||R||w||I||T)&&e.jsxs("div",{className:"mt-4 w-full self-start rounded-xl bg-blue-200 px-3 py-0.5 text-xs text-black",children:[A!==void 0&&e.jsxs("div",{children:[e.jsx("b",{children:"Tokens Count:"})," ",A]}),x&&e.jsxs("div",{children:[e.jsx("b",{children:"Model ID:"})," ",x]}),b&&e.jsxs("div",{children:[e.jsx("b",{children:"Engine:"})," ",b]}),v&&e.jsxs("div",{children:[e.jsx("b",{children:"Experiment:"})," ",v]}),_&&e.jsxs("div",{children:[e.jsx("b",{children:"Treatment:"})," ",_]}),j&&e.jsxs("div",{children:[e.jsx("b",{children:"Alternative Model Rule:"})," ",j]}),p&&e.jsxs("div",{children:[e.jsx("b",{children:"Group Name:"})," ",p]}),R&&e.jsxs("div",{children:[e.jsx("b",{children:"Group Params:"}),e.jsx("div",{children:JSON.stringify(R,null,2)})]}),w&&e.jsxs("div",{children:[e.jsx("b",{children:"Above Params are Overridden By:"})," ",w]}),I&&e.jsxs("div",{children:[e.jsx("b",{children:"Experiment Eval Seq:"})," click to see"]}),T&&e.jsxs("div",{children:[e.jsx("b",{children:"Search Settings:"}),e.jsx("div",{children:JSON.stringify(T,null,2)})]})]}),r.author.name===Xe&&r.content.content_type===Z.MultimodalText?e.jsx(vt,{message:r,conversationId:s}):null,N.length||U.length||M.length||k?e.jsxs("div",{className:"mt-4 flex flex-col flex-nowrap gap-2",children:[k&&e.jsx(yt,{operation:k.operation,originalFileId:k.originalFileId,maskFileId:k.maskFileId,conversationId:s}),e.jsx(bt,{frameAssets:z,setFrameSrc:o},l),N.map((S,O)=>e.jsx(H,{audio:S,conversationId:s},`audio-asset-${O}`)),U.map((S,O)=>e.jsx(H,{assetPointer:S,conversationId:s},`audio-${O}`)),M.map((S,O)=>e.jsx(wt,{assetPointer:S,conversationId:s},`video-asset-${O}`))]}):null]},r.id)});return e.jsx(St,{children:i})}const B=t=>e.jsx(we.Input,{...t,inputClassName:"focus:ring-0"});function pt(){const t=ae(),o=Be().map(n=>({label:n.name,options:n.options.flatMap(l=>"options"in l?l.options.map(r=>({label:r.value,value:r.value})):[{label:`${l.value} (${l.name})`,value:l.value}])})),[s,i]=d.useState(me[0]);return e.jsxs("div",{className:"mt-2 flex flex-col justify-around gap-3 px-4 py-1 text-xs font-semibold",children:[e.jsx(C,{id:"enable-inferred-juice",label:e.jsx("span",{children:"Use inferred juice"}),checked:t.enableInferredJuice,onChange:()=>{h({enableInferredJuice:!t.enableInferredJuice})}}),e.jsx(C,{id:"f-conversation",label:e.jsx("span",{children:"Use f/conversation endpoint ðŸš€"}),checked:t.enableFConversationEndpoint,onChange:()=>{h({enableFConversationEndpoint:!t.enableFConversationEndpoint})}}),e.jsx(C,{id:"showCompletionPerfData",label:e.jsx("span",{children:"Show turn perf stats"}),checked:t.showCompletionPerfData,onChange:()=>{h({showCompletionPerfData:!t.showCompletionPerfData})}}),e.jsx(C,{id:"force-paragen",label:"Force Parallel Gen",checked:t.forceParagen,onChange:()=>{h({forceParagen:!t.forceParagen})}}),e.jsx(nt,{options:o,name:"force-paragen-model",className:"shadow-none dark:text-gray-800",isDisabled:!t.forceParagen,isLoading:o.length===0,value:t.forceParagenModel,isClearable:!0,isMulti:!1,components:{Input:B},onChange:n=>{h({forceParagenModel:n??qe})}}),t.forceParagen?e.jsxs(e.Fragment,{children:[e.jsx("div",{children:"Paragen Stream Type:"}),e.jsx(q,{options:[{label:"Do Not Override",value:"none"},{label:"Force Classic Stream Behavior",value:"default"},{label:"Wait for Assistant",value:"wait_for_assistant"},{label:"Interleave",value:"interleave"}],name:"paragen-stream-type",className:"shadow-none dark:text-gray-800",value:t.paragenStreamType==="none"?{value:"none",label:"Do Not Override"}:t.paragenStreamType==="default"?{value:"default",label:"Force Classic Stream Behavior"}:t.paragenStreamType==="wait_for_assistant"?{value:"wait_for_assistant",label:"Wait for Assistant"}:{value:"interleave",label:"Interleave"},isMulti:!1,components:{Input:B},onChange:n=>{h({paragenStreamType:n?.value??"none"})}})]}):null,t.forceParagen?e.jsxs(e.Fragment,{children:[e.jsx("div",{children:"Show CoT in Paragen:"}),e.jsx(q,{options:[{label:"Allow",value:"allow"},{label:"Hide CoT for Alter Model",value:"hide_alter"},{label:"Hide",value:"hide"}],name:"paragen-stream-type",className:"shadow-none dark:text-gray-800",value:t.paragenCotSummaryDisplay==="allow"?{value:"allow",label:"Allow"}:t.paragenCotSummaryDisplay==="hide_alter"?{value:"hide_alter",label:"Hide CoT for Alter Model"}:{value:"hide",label:"Hide"},isMulti:!1,components:{Input:B},onChange:n=>{h({paragenCotSummaryDisplay:n?.value??"allow"})}})]}):null,e.jsx(C,{id:"show-paragen-metadata",label:"Show Paragen Metadata",checked:t.showParagenMetadata,onChange:()=>{h({showParagenMetadata:!t.showParagenMetadata})}}),e.jsx(Ye,{}),e.jsx(C,{id:"record-rendering",label:"Record Rendering",checked:t.recordRendering,onChange:()=>{h({recordRendering:!t.recordRendering})}}),e.jsx(C,{id:"force-rate-limit",label:"Force Rate Limit",checked:t.forceRateLimit,onChange:()=>{h({forceRateLimit:!t.forceRateLimit})}}),e.jsx(C,{id:"reset-rate-limit",label:"Reset Rate Limits",checked:t.resetRateLimits,onChange:()=>{h({resetRateLimits:!t.resetRateLimits})}}),e.jsx(he,{label:"Enabling this will show debug conversation messages in the chat",children:e.jsx(C,{id:"show-internal-conversation-turns",label:"Conversation debug mode",checked:t.showDebugConversationTurns,onChange:()=>{h({showDebugConversationTurns:!t.showDebugConversationTurns})}})}),e.jsx(C,{id:"force-show-convo-rating",label:"Force Show Conversation Rating",checked:t.forceShowConvoRating,onChange:()=>{h({forceShowConvoRating:!t.forceShowConvoRating})}}),e.jsx("hr",{}),e.jsx("div",{children:"Reset announcement:"}),e.jsx(q,{options:me.map(n=>({label:n.replace("oai/apps/",""),value:n})),name:"reset-announcement",className:"break-all font-mono shadow-none dark:text-gray-800",value:{label:s,value:s},isMulti:!1,components:{Input:B},onChange:n=>{n?.value&&i(n?.value)}}),e.jsx($,{onClick:()=>De.resetAnnouncement(s),children:"Reset"})]})}const ge=V.div`px-1 lg:px-2 xl:px-3 pb-2 text-xs font-semibold uppercase border-b-2 ${({$isSelected:t})=>t?"border-black dark:border-white":"border-transparent"}`;function Lt({clientThreadId:t,isOpen:a,asDialog:o,onClose:s}){const i=ye(),n=ve(),[l,r]=d.useState("conversation");return n?.includes("debug")?e.jsx(mt,{icon:Le,title:i.formatMessage(re.debugTitle),isOpen:a,asDialog:o,onClose:s,children:e.jsxs(Ee,{orientation:"vertical",defaultValue:l,onValueChange:c=>r(c),children:[e.jsxs(Ie,{className:"mb-4 grid grid-cols-3 gap-2 overflow-x-auto px-1 py-1 text-xs xl:px-2",children:[e.jsx(oe,{className:"grow basis-0",value:"conversation",children:e.jsx(ge,{className:"w-full max-w-full overflow-hidden overflow-ellipsis tracking-tighter",$isSelected:l==="conversation",children:"Conversation"})}),e.jsx(oe,{className:"grow basis-0",value:"system-message-editor",children:e.jsx(ge,{className:"w-full max-w-full overflow-hidden overflow-ellipsis tracking-tighter",$isSelected:l==="system-message-editor",children:"System Message"})}),!1]}),e.jsx(ie,{value:"conversation",children:e.jsx(xt,{clientThreadId:t})}),e.jsx(ie,{value:"system-message-editor",children:e.jsx(ot,{clientThreadId:t})}),!1]})}):null}function xt({clientThreadId:t}){const a=ye(),o=xe(t,E.getBranch).filter(b=>b.message.author.role!==D.Root),[s,i]=d.useState(),n=ve(),l=d.useCallback(()=>{i(void 0)},[]),r=fe(),c=d.useCallback(b=>{const _=E.getBranch(be(t)).filter(j=>![D.Root,D.System,D.Developer].includes(j.message.author.role)).map(j=>G(j.message)).join(`

`);Fe(_,r,b)},[t,r]),[u,g]=d.useState(!1),[x,m]=d.useState(void 0);return n?.includes("debug")?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-2 flex items-center justify-around px-4 py-1 text-xs font-semibold uppercase",children:e.jsx(ht,{clientThreadId:t,messages:o.map(b=>b.message)})}),!1,e.jsxs("div",{className:"flex items-center justify-around gap-2 px-4 py-1 text-xs font-semibold uppercase",children:[e.jsx("div",{children:e.jsx(Ze,{onCopy:c,buttonText:a.formatMessage(re.copyText)})}),e.jsxs("button",{className:"flex items-center justify-center gap-2",onClick:()=>g(!0),children:[e.jsx(Ve,{className:"icon-sm rotate-90"}),"View tree"]})]}),e.jsx(pt,{}),null,e.jsx(gt,{nodes:o,setDebugNodeIndex:i,setFrameSrc:m,conversationId:Y(t)}),s!==void 0&&e.jsx(W,{type:"success",size:"fullscreen",noPadding:!0,isOpen:!0,onClose:l,children:e.jsx(ct,{threadId:o[s].message.metadata?.__internal?.sonic_thread_id??o[s].message.metadata?.debug_sonic_thread_id,threadUserId:o[s].message.metadata?.__internal?.sonic_user_id,onClose:l,message:o[s].message})},`DebugMessageModal-${s}`),u&&e.jsx(W,{isOpen:!0,onClose:()=>g(!1),type:"success",size:"custom",noPadding:!0,children:e.jsx(lt,{clientThreadId:t})},"DebugTreeViewer"),x&&e.jsx(W,{size:"normal",isOpen:!0,onClose:()=>m(void 0),type:"success",children:e.jsx("img",{src:x,alt:"debug image"})},"DebugFrameViewer")]}):null}function ft(t,a){const o=JSON.stringify({conversation_id:Y(t),messages:a},null,2),s=new Blob([o],{type:"application/json"}),i=URL.createObjectURL(s),n=document.createElement("a");n.href=i,n.download=`messages-${Y(t)}.json`,n.click(),URL.revokeObjectURL(i)}function ht({clientThreadId:t,messages:a}){const o=d.useCallback(()=>{ft(t,a)},[t,a]);return e.jsx($,{className:"max-w-full overflow-hidden overflow-ellipsis whitespace-nowrap",onClick:o,color:"primary",size:"small",icon:$e,children:e.jsx(Pe,{...re.downloadRawConversation})})}function bt(t){const[a,o]=d.useState([]),s=J(),{frameAssets:i}=t;return d.useEffect(()=>{async function n(){const l=i.map(async({image_asset_pointer:r,timestamp:c})=>{const u={asset:r};return{src:(await ne.fetch(s,u)).url,timestamp:c}});return Promise.all(l)}i.length>0&&n().then(o)},[i,s]),e.jsx(dt,{frames:a,setFrameSrc:t.setFrameSrc})}async function ee({queryClient:t,conversationId:a,fileId:o}){const s={asset:{content_type:Me.ImageAssetPointer,asset_pointer:o},conversationId:a},{url:i}=await ne.fetch(t,s);return i}function vt({message:t,conversationId:a}){const o=L.getImageAssetPointers(t),s=t.metadata?.__internal?.image_gen_telemetry,[i,n]=d.useState("pointers"),l=d.useMemo(()=>o.map(c=>{const{gen_size:u,gen_id:g,height:x,width:m,parent_gen_id:f}=c.metadata?.generation??{};return e.jsxs("div",{className:"mt-4 w-full self-start rounded-xl bg-blue-200 px-3 py-0.5 text-xs text-black",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Size:"})," ",u]}),e.jsxs("div",{children:[e.jsx("strong",{children:"ID:"})," ",g," ",f?`(Parent: ${f})`:null]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Dimensions:"})," ",m," x ",x]}),e.jsx("div",{className:"pb-2",children:e.jsx(jt,{fileId:c.asset_pointer,conversationId:a})})]},c.asset_pointer)}),[a,o]),r=d.useMemo(()=>e.jsx("div",{className:"mt-4 w-full self-start overflow-scroll whitespace-nowrap rounded-xl bg-blue-200 px-3 py-0.5 font-sans text-xs font-extralight text-black",children:s?.map(c=>e.jsx("div",{children:e.jsxs("div",{children:[e.jsx("strong",{children:c.id}),": ",c.timestamp.toFixed(2)," ",c.duration_ms&&`(${c.duration_ms?.toPrecision(2)}ms)`]})},c.id))}),[s]);return e.jsxs("div",{className:"flex flex-col justify-center",children:[e.jsxs($,{onClick:c=>{c.stopPropagation(),n(i==="pointers"?"telemetry":"pointers")},children:["Show ",i==="pointers"?"telemetry":"pointers"]}),i==="pointers"?l:r]})}function jt({fileId:t,conversationId:a}){const o=J(),[s,i]=d.useState(void 0);return d.useEffect(()=>{ee({queryClient:o,conversationId:a,fileId:t}).then(i)},[t,o,a]),s&&e.jsx("img",{src:s,alt:t})}function yt({operation:t,originalFileId:a,maskFileId:o,conversationId:s}){const i=J(),[n,l]=d.useState(void 0),[r,c]=d.useState(void 0);return d.useEffect(()=>{n||ee({queryClient:i,conversationId:s,fileId:a}).then(l)},[n,a,s,i]),d.useEffect(()=>{!r&&o&&ee({queryClient:i,conversationId:s,fileId:o}).then(c)},[r,o,s,i]),n?e.jsx(ut,{operation:t,originalFileSrc:n,maskFileSrc:r}):null}function H(t){const a=Ce(t.assetPointer,t.conversationId),o=H.useAudioSource(t.audio),s=a??o,n=je("3230069703").config.value.expirySeconds,[l,r]=d.useState(Date.now()),c=d.useRef(null);return d.useEffect(()=>{const u=setInterval(()=>{c.current&&c.current.currentTime>0&&!c.current.paused&&!c.current.ended&&c.current.readyState>2||r(Date.now())},n*1e3);return()=>clearInterval(u)},[n]),s?e.jsx("audio",{ref:c,controls:!0,src:s,className:"w-full"},l):null}function Ce(t,a){const[o,s]=d.useState(null),i=J();return d.useEffect(()=>{t&&ne.fetch(i,{asset:t,conversationId:a}).then(n=>{s(n.url)})},[i,t,a]),o}H.useAudioSource=t=>{const[a,o]=d.useState(null);return d.useEffect(()=>{if(t){const s=atob(t.payload),i=new Uint8Array(s.length);for(let r=0;r<s.length;r++)i[r]=s.charCodeAt(r);const n=new Blob([i],{type:`audio/${t.format}`}),l=URL.createObjectURL(n);return o(l),()=>{URL.revokeObjectURL(l)}}},[t]),a};function wt(t){const a=Ce(t.assetPointer,t.conversationId),s=je("3230069703").config.value.expirySeconds,[i,n]=d.useState(Date.now()),l=d.useRef(null);return d.useEffect(()=>{const r=setInterval(()=>{l.current&&l.current.currentTime>0&&!l.current.paused&&!l.current.ended&&l.current.readyState>2||n(Date.now())},s*1e3);return()=>clearInterval(r)},[s]),a?e.jsx("video",{ref:l,controls:!0,src:a,className:"w-full"},i):null}const Ct=V.div`overflow-y-auto h-full md:w-[250px] lg:w-[300px] xl:w-[350px] 2xl:w-[400px] md:border-l md:border-gray-100 md:dark:border-gray-700 popover bg-token-main-surface-primary`,St=V.pre`whitespace-pre-wrap text-sm`,pe=V.div`px-6 py-4 flex flex-col gap-1 hover:bg-gray-50 dark:hover:bg-gray-500/10 cursor-pointer border-b dark:border-white/10 border-gray-200`,re=Oe({debugTitle:{id:"DebugSidebar.debugTitle",defaultMessage:"Debug"},copyText:{id:"DebugSidebar.copyText",defaultMessage:"Copy text"},downloadRawConversation:{id:"DebugSidebar.downloadRawConversation",defaultMessage:"Download raw conversation"},uploadRawConversation:{id:"DebugSidebar.uploadRawConversation",defaultMessage:"Upload conversation dump"},closeSidebar:{id:"DebugSidebar.closeSidebar",defaultMessage:"Close sidebar"}});export{Lt as DebugConversationSidebar,mt as default};
//# sourceMappingURL=g7ivbw640s42fkw7.js.map
