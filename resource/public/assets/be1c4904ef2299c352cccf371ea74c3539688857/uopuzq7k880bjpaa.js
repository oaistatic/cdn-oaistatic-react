const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jg273ro0g3ahinsi.js","assets/cyi7nanrg0vdotzd.js","assets/fs6h2trisr1juto6.js","assets/root-drzjahv8.css","assets/df9u9imhvwerk6zv.js","assets/conversation-small-kx6wglz1.css","assets/k154o6a9h89usuus.js","assets/kg9pnjn9ianmg7dc.js","assets/mlsnda7myeyy0pj9.js","assets/m3w8pho33i6vjltk.js","assets/hiayljqmnpspmyun.js","assets/miqolxcdfcownhv5.js","assets/v5hiekyjowt3msdw.js","assets/e2l59f6c7bsm78ye.js","assets/m7lukv8dnept58g2.js","assets/juans7zh9ytz81kz.js","assets/exwx6mc6hw49alht.js","assets/f3zzw463zuggq6da.js","assets/069jlavvvdusqrfm.js","assets/ms40jzicf31mvoix.js"])))=>i.map(i=>d[i]);
import{r as l,j as s,L as z,e as q,b as se,M as N,d as ae}from"./fs6h2trisr1juto6.js";import{fN as ne,fO as V,fP as re,fQ as ie,eb as oe,fR as B,fS as le,fT as de,fU as ue,fV as ce,fW as H,fX as me,fY as fe,fZ as he,f_ as ye,dI as ge,eN as U,f$ as pe,g0 as Se,g1 as xe,g2 as Te,g3 as F,g4 as Ee,g5 as be}from"./df9u9imhvwerk6zv.js";import{bP as Ne,bQ as ve,al as G,a3 as Re,F as Ce,a4 as Ie,X as y,Y as v,g4 as _e,n as je,d as Y,P as j,a as D,S as De,a6 as Me,j as ke,Z as _,$ as we}from"./cyi7nanrg0vdotzd.js";import{G as Le}from"./k154o6a9h89usuus.js";const Ae=Ne(()=>ve(()=>import("./jg273ro0g3ahinsi.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19])).then(e=>e.GizmoConversationOptionsDropdown)),Pe=new Date(2024,9,11,0);function $(e){De.checkGate("3922476776")||Me.abortAllRequests(),j.logEvent(D.loadThread,{threadId:e})}function Oe({conversation:e,onOpenChange:o,testId:i,inMainScreen:t=!1,isActiveConversation:a}){const n=q(),{isUnauthenticated:d}=ke();return d?null:s.jsx(Ae,{conversation:e,onOpenChange:o,inMainScreen:t,isActiveConversation:a,children:s.jsx("button",{className:"flex items-center justify-center text-token-text-secondary transition hover:text-token-text-primary radix-state-open:text-token-text-secondary","data-testid":i,"aria-label":n.formatMessage({id:"idEcXk",defaultMessage:"Open conversation options"}),children:s.jsx(ge,{className:"icon-md"})})})}const K=5,ze=3e3;function Be({threadId:e}){const o=se(),i=l.useRef(!1),t=l.useRef(null);return l.useEffect(()=>{async function a(){i.current=!0;const n=await pe(e);if(n.async_status===y.UNREAD){Se(o,n.gizmo_id),we.initThreadFromServerData(e,n,!0,void 0,!0);return}if(n.async_status!==y.STREAMING)return;const d=n.update_time??0;V(new Date,new Date(d*1e3))<K?t.current=window.setTimeout(a,ze):_.setConversationStatus(e)}return i.current||(j.logEvent(D.conversationPollingStarted),a()),()=>{t.current&&window.clearTimeout(t.current)}},[o,e]),null}function He({conversation:e,className:o,hideOverflowMenu:i=!1,isActive:t,elementRef:a,testId:n}){const[d,m]=l.useState(!1),[u,f]=l.useState(!1),[g,x]=l.useState(!1),{value:T}=G("3922476776"),{value:c}=G("232791851"),E=ne(e.id),{value:h=null,source:p=null}=E??{},X=Re(e.id,Ce.getRequestId),S=Ie(X),M=V(new Date,new Date(e.update_time??0))<K,k=re(e.id),Q=e.update_time&&ie(new Date(e.update_time),Pe),w=h===y.STREAMING&&M,W=c&&!t&&!S&&Q&&!g&&h===y.UNREAD,L=c&&(S||w)&&!g,Z=c&&!t&&k.length>0&&!g,J=!L&&c&&!t&&(S||w),ee=c&&h===y.STREAMING&&p===v.SERVER&&!S&&M,C=l.useRef(!1);l.useEffect(()=>{C.current||T&&(async()=>(C.current=!0,t&&h===y.UNREAD&&(p===v.SERVER&&await _.setConversationStatus(e.id),U(e.id,null)),!t&&p===v.CLIENT&&h===y.UNREAD&&(await _.setConversationStatus(e.id,h),U(e.id,{value:y.UNREAD,source:v.SERVER})),C.current=!1))()},[T,t,e.id,h,p,S]),l.useEffect(()=>_e(Le,{editTitle:({serverThreadId:r})=>{(r?r===e.id:t)&&m(!0)}}),[e.id,t]);const{data:te}=oe(),A=e.conversation_template_id!=null?te?.gizmos.find(r=>r.resource.gizmo.id===e.conversation_template_id)?.resource:void 0,P=l.useRef(null),O=l.useRef(null);return s.jsxs("div",{draggable:!d&&B(e.gizmo_id),onDragStart:r=>{if(!B(e.gizmo_id))return;const I=je(O.current),b=P.current;b&&(b.style.display="none"),r.dataTransfer.setDragImage(I,I.clientWidth/3,I.clientHeight/2),b&&requestAnimationFrame(()=>{b.style.display=""}),r.dataTransfer.effectAllowed="move",le({kind:"conversation",conversation:e,gizmoId:e.gizmo_id})},onDragEnd:()=>{de()},ref:O,style:{"--item-background-color":ue(g,t,u)},className:Y(ce,"relative screen-arch:bg-transparent",o),onMouseEnter:()=>{x(!0)},onMouseLeave:()=>{x(!1)},children:[ee&&s.jsx(Be,{threadId:e.id}),s.jsx(z,{to:H(e.id,A),onClick:r=>{r.metaKey||r.ctrlKey||t||$(e.id)},onDoubleClick:()=>{m(!0)},ref:a,className:"flex items-center gap-2 p-2 screen-arch:motion-safe:group-active:scale-[98%] screen-arch:motion-safe:group-active:transition-transform screen-arch:motion-safe:group-active:duration-100",style:{maskImage:"var(--sidebar-mask)"},children:s.jsx(me,{clientThreadId:e.id,historyConversationResponse:e,shouldShowLoadingShimmer:J})}),d?s.jsx("div",{className:"absolute bottom-0 left-[7px] right-2 top-0 flex items-center bg-token-sidebar-surface-secondary",children:s.jsx(fe,{conversationId:e.id,historyConversationResponse:e,onClose:()=>{m(!1)}})}):W?s.jsx(z,{to:H(e.id,A),onClick:r=>{r.metaKey||r.ctrlKey||t||$(e.id)},children:s.jsx("div",{className:"absolute bottom-0 top-0 flex items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",children:s.jsx("div",{className:"h-2 w-2 rounded-full bg-blue-selection"})})}):Z?s.jsx("div",{className:"absolute bottom-0 top-0 flex items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",children:s.jsx(he,{task:k[0]})}):L?s.jsx("div",{className:"absolute bottom-0 top-0 flex items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",children:s.jsx(ye,{size:16,className:"text-token-text-primary"})}):!i&&(g||u)&&s.jsx("div",{className:Y("absolute bottom-0 top-0 inline-flex items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",t||u?"flex":"invisible can-hover:group-hover:visible"),ref:P,children:s.jsx(Oe,{isActiveConversation:t,conversation:e,onOpenChange:r=>{f(r),r&&j.logEvent(D.conversationHistoryItemOpenMenu,{conversationId:e.id})},testId:`${n}-options`})})]})}function Ue({className:e,elementRef:o,item:i,isActive:t,testId:a,hideOverflowMenu:n=!1}){return s.jsx("li",{className:"relative","data-testid":a,children:s.jsx(He,{className:e,conversation:i,isActive:t,elementRef:o,testId:a,hideOverflowMenu:n})})}const Fe=l.memo(Ue),R=ae({historyBucketToday:{id:"history.bucket.today",defaultMessage:"Today"},historyBucketYesterday:{id:"history.bucket.yesterday",defaultMessage:"Yesterday"},historyBucketLastSeven:{id:"history.bucket.lastSeven",defaultMessage:"Previous 7 Days"},historyBucketLastThirty:{id:"history.bucket.lastThirty",defaultMessage:"Previous 30 Days"}}),Ge=5;function Ke(e,o){const i=q();return l.useMemo(()=>e.reduce((t,a)=>{const n=new Date(a.update_time??a.create_time??0),d=xe(new Date,n);if(d===0)t.recent.today.items.push(a);else if(d<=1)t.recent.yesterday.items.push(a);else if(d<=7)t.recent.lastSeven.items.push(a);else if(d<=30)t.recent.lastThirty.items.push(a);else if(Te(n)){const m=F(n),u=Ee(n),f=`${m}-${u}`;t.dynamicMonths[f]?t.dynamicMonths[f].items.push(a):t.dynamicMonths[f]={label:i.formatDate(n,{month:"long"}),items:[a]}}else{const u=`${F(n)}-`;t.dynamicYears[u]?t.dynamicYears[u].items.push(a):t.dynamicYears[u]={label:i.formatDate(n,{year:"numeric"}),items:[a]}}return t},{recent:{today:{label:s.jsx(N,{...R.historyBucketToday}),items:[]},yesterday:{label:s.jsx(N,{...R.historyBucketYesterday}),items:[]},lastSeven:{label:s.jsx(N,{...R.historyBucketLastSeven}),items:[]},lastThirty:{label:s.jsx(N,{...R.historyBucketLastThirty}),items:[]}},dynamicMonths:{},dynamicYears:{}}),[o,e])}function Xe({activeId:e,bucketedItems:o,items:i,hasNextPage:t,infiniteScrollTriggerElementRef:a,hideOverflowMenu:n}){return s.jsx(s.Fragment,{children:[o.recent,o.dynamicMonths,o.dynamicYears].flatMap((d,m)=>s.jsx(l.Fragment,{children:Object.entries(d).map(([u,{items:f,label:g}],x)=>{if(u!=="today"&&!f.length)return null;const T=!!f.find(c=>i.length>0&&c.id===i[0]?.id);return f.length>0&&s.jsxs("div",{className:"relative mt-5 first:mt-0 last:mb-5",children:[s.jsx("div",{className:"sticky top-0 z-20 bg-token-sidebar-surface-primary",children:s.jsx("span",{className:"flex h-9 items-center",children:s.jsx(be,{children:g})})}),s.jsx("ol",{children:f.map((c,E)=>{const h=T&&E===0,p=t&&i[i.length-Ge-1]?.id===c.id?a:void 0;return s.jsx(Fe,{item:c,hideOverflowMenu:n,isActive:e===c.id,isFirstItem:h,elementRef:p,testId:`history-item-${E}`},`history-item-${c.id}-${u}`)})})]},`${u}-${m}-${x}`)})},`category-${m}`))})}export{Oe as G,Xe as H,Fe as a,Ke as u};
//# sourceMappingURL=uopuzq7k880bjpaa.js.map
