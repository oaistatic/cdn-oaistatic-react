const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/o3tjep6k2ijup462.js","assets/fs6h2trisr1juto6.js","assets/df9u9imhvwerk6zv.js","assets/cyi7nanrg0vdotzd.js","assets/root-drzjahv8.css","assets/conversation-small-kx6wglz1.css","assets/e2l59f6c7bsm78ye.js"])))=>i.map(i=>d[i]);
import{R as T,bP as I,bQ as F,aP as w,y as g,z as L,M as P,V as W,l as G,fC as B,d as A,c4 as k,P as j,a as v,aT as R,aV as C,Z as D,cG as V}from"./cyi7nanrg0vdotzd.js";import{r as p,b as E,u as K,j as e,e as Q,M as d,c as z}from"./fs6h2trisr1juto6.js";import{ek as Y,U as X,$,E as Z,G as N,el as H,dt as J,em as ee}from"./df9u9imhvwerk6zv.js";import{S as te}from"./hyj1ewu0eyfbsrce.js";const _="memories/current_memory_undo_id",U={async getCurrentMemoryUndoId(t){return await T.safeGet("/memories/current_memory_undo_id",{parameters:{query:{gizmo_id:t}}})},async undoMemoryWrite(t,o){return await T.safePost("/memories/undo_memory_write",{requestBody:{gizmo_id:t,memory_undo_id:o}})}},oe=I(()=>F(()=>import("./o3tjep6k2ijup462.js").then(t=>t.b),__vite__mapDeps([0,1,2,3,4,5,6])));function O(t){return t.find(o=>o.author.role===g.Tool&&o.metadata?.pending_memory_info)}function ne(t){return t.filter((o,n)=>{const r=t[n+1],i=r?.recipient==="assistant"&&r?.author.role===g.Tool&&r?.author.name==="bio"&&L(r).startsWith("Model set context");return o.author.role===g.Assistant&&o.recipient==="bio"&&i}).flatMap(o=>{const n=o.content.content_type;return n===P.Text?o.content.parts:n===P.Code?[o.content.text]:[]}).map(ce)}function re(t){return t.some(o=>o.author.role===g.Assistant&&o.recipient==="bio"&&o.status==="in_progress")}function se(t){return t.find(n=>n.author.role===g.Tool&&n.author.name==="bio"&&n.recipient===g.Assistant)?.metadata?.current_memory_undo_id}function ie(t){const{eligible:o,isLoading:n}=Y(),r=p.useMemo(()=>t.length>0,[t]);p.useEffect(()=>{r&&o&&!n&&X.openModal($.GlobalMemoryOnboarding)},[r,o,n])}function ae(t){const[o,n]=p.useState(!1);return{isPopoverOpen:o,setIsPopoverOpen:n,handleTogglePopover:s=>{const i=s??!o;n(i),i&&j.logEvent(v.memoryUpdatePopoverShown,{updateCount:t.length})}}}function S({memoryWrites:t,popoverState:o,triggerButton:n,isParagen:r,gizmoId:s,memoryUndoId:i,setShowMemoriesModal:l}){return e.jsxs(ee,{open:o.isPopoverOpen,sideOffset:4,side:"bottom",alignAgainstAnchor:"start",size:"none",className:"z-10 min-w-60 max-w-96 text-sm",onOpenChange:a=>o.handleTogglePopover(a),disableAutofocus:!0,triggerButton:n,children:[e.jsx("div",{className:"mb-2 rounded border border-token-border-light bg-token-main-surface-secondary",children:t.map((a,u)=>e.jsx("div",{className:"border-b border-token-border-light px-3 py-2 first-letter:uppercase last:border-b-0",children:a},u))}),r?e.jsx("div",{className:"text-xs text-token-text-tertiary",children:e.jsx(d,{id:"MemoryActionResult.paragenMessage",defaultMessage:"This memory will be saved if you choose this response."})}):e.jsxs(e.Fragment,{children:[e.jsx(me,{gizmoId:s,memoryUndoId:i}),e.jsx(q,{onClick:()=>{l(!0),j.logEvent(v.memoryUpdatePopoverManageButtonClicked,{updateCount:t.length})},children:e.jsx(d,{id:"MemoryActionResult.manageMemories",defaultMessage:"Manage memories"})})]})]})}function le({clientThreadId:t,pendingMessage:o,memoryWrites:n,popoverState:r,setShowMemoriesModal:s}){const i=W(),l=Q(),a=G(t),u=B({clientThreadId:t}),f=n.join(" ");let x=f.slice(0,50).replace(new RegExp("^\\p{L}","u"),m=>m.toLocaleUpperCase()).replace(/\.$/,"");f.length>50&&(x+="...");const y=async m=>{if(!a)throw new Error("Failed to confirm or reject memory update: serverThreadId is not found");const M=o.metadata?.pending_memory_info;R(t,h=>{C.updateTree(h,c=>{c.updateNodeMessageMetadata(o.id,{pending_memory_info:{...M,is_pending:!1,confirm_result:m}})})});try{await D.confirmOrRejectMemory(o.id,a,m)}catch{i.danger(l.formatMessage({id:"memory.confirmOrDenyFail",defaultMessage:"Failed to confirm or reject memory update"})),R(t,c=>{C.updateTree(c,b=>{b.updateNodeMessageMetadata(o.id,{pending_memory_info:M})})})}};return e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"inline-block text-sm font-semibold text-token-text-tertiary outline-none",children:e.jsx(d,{id:"MemoryActionResult.memoryConfirmation",defaultMessage:"Update memory? {memoryText}",values:{memoryText:e.jsx("div",{className:"inline-block py-1",onMouseOver:()=>r.handleTogglePopover(!0),onMouseOut:()=>r.handleTogglePopover(!1),children:e.jsx(S,{memoryWrites:n,popoverState:r,triggerButton:e.jsx("button",{className:A("text-left font-normal",r.isPopoverOpen?"text-token-text-secondary":"text-token-text-tertiary"),children:e.jsx(d,{id:"MemoryActionResult.memoryWrapper",defaultMessage:"“{memoryWrites}”",values:{memoryWrites:x}})}),setShowMemoriesModal:s})})}})}),e.jsx(k,{className:"ml-3 text-token-text-tertiary hover:text-token-text-primary",size:"xs",color:"secondary",disabled:u,onClick:()=>{y(!0)},children:e.jsx(d,{id:"MemoryActionResult.confirm",defaultMessage:"Yes"})}),e.jsx(k,{className:"ml-2 text-token-text-tertiary hover:text-token-text-primary",size:"xs",color:"secondary",disabled:u,onClick:()=>{y(!1)},children:e.jsx(d,{id:"MemoryActionResult.deny",defaultMessage:"No"})})]})}function de({memoryWrites:t,popoverState:o,isParagen:n,memoryUndoId:r,gizmoId:s,setShowMemoriesModal:i}){const{eligible:l,markAsViewed:a,isLoading:u}=Z(N.hasSeenMemoryUpdatedTooltip),f=!H();return t.length===0?null:e.jsxs("div",{className:"flex items-center",children:[e.jsx(J,{announcementKey:N.hasSeenMemoryUpdatedTooltip,show:!u&&l,onDismiss:()=>{a(),j.logEventWithStatsig(v.memoryUpdatedTooltipDismissed,"memory_updated_tooltip_dismissed")},dismissOnOutsideClick:!0,side:f?"bottom":"left",sideOffset:4,theme:"bright",badge:"none",title:e.jsx(d,{id:"MoonshineV2Tooltip.heading",defaultMessage:"Memory in ChatGPT has changed"}),description:e.jsxs(e.Fragment,{children:[e.jsx(d,{id:"MoonshineV2Tooltip.description",defaultMessage:"ChatGPT can now reference all chats, in addition to saved memories."}),e.jsx("br",{}),e.jsx("a",{href:"https://help.openai.com/en/articles/10303002-how-does-memory-use-past-conversations",target:"_blank",rel:"noopener noreferrer",className:"underline",children:e.jsx(d,{id:"MoonshineV2Tooltip.learnMoreLink",defaultMessage:"Learn more"})},"learn-more-link")]}),children:e.jsx("div",{style:{width:1,height:1}})}),e.jsx("div",{className:"inline-block",onMouseOver:()=>o.handleTogglePopover(!0),onMouseOut:()=>o.handleTogglePopover(!1),children:e.jsx(S,{memoryWrites:t,popoverState:o,isParagen:n,gizmoId:s,memoryUndoId:r,triggerButton:e.jsxs("button",{className:A("my-1 flex items-center gap-1 text-sm font-semibold outline-none",o.isPopoverOpen?"text-token-text-secondary":"text-token-text-tertiary"),children:[e.jsx(te,{className:"mb-[-1px]"}),t.length===1?e.jsx(d,{id:"MemoryActionResult.memoryWriteSingular.1",defaultMessage:"Memory updated"}):e.jsx(d,{id:"MemoryActionResult.memoryWritePlural.1",defaultMessage:"Memories updated"})]}),setShowMemoriesModal:i})})]})}function ue(t){const o=O(t),n=o?.metadata?.pending_memory_info?.confirm_result;return o==null?null:n===!0?"confirmed":n===!1?"denied":"pending"}function xe({messages:t,clientThreadId:o,gizmoId:n,isParagen:r}){const s=ne(t),i=ae(s),l=re(t),a=se(t);ie(s);const u=O(t),{config:f}=w("3983984123"),x=f.get("is_memory_undo_enabled",!1),y=p.useRef(!1),m=E();p.useEffect(()=>{l&&y.current===!1&&(y.current=!0),!l&&!u&&a&&y.current&&m.invalidateQueries({queryKey:[_,n]})},[l,u,a,n,m]);const{data:M}=K({queryKey:[_,n],queryFn:()=>U.getCurrentMemoryUndoId(n),enabled:x&&!l&&!u}),[h,c]=p.useState(!1),b=ue(t);return b==="denied"?null:l?e.jsx("div",{className:"result-streaming",children:e.jsx("span",{children:e.jsx("pre",{})})}):e.jsxs(e.Fragment,{children:[b==="pending"?e.jsx(le,{clientThreadId:o,memoryWrites:s,popoverState:i,setShowMemoriesModal:c,pendingMessage:u}):e.jsx(de,{memoryWrites:s,popoverState:i,isParagen:r,memoryUndoId:M?.current_memory_undo_id===a?a:void 0,setShowMemoriesModal:c}),h&&e.jsx(oe,{initialGizmoId:n,onClose:()=>c(!1)})]})}function q({children:t,disabled:o,onClick:n}){return e.jsxs("button",{className:"flex w-full items-center justify-between rounded px-3 py-2 font-semibold hover:bg-token-main-surface-secondary",disabled:o,onClick:n,children:[t,e.jsx(V,{className:"icon-md -mr-1 text-token-text-tertiary"})]})}function me({gizmoId:t,memoryUndoId:o}){const{config:n}=w("3983984123"),r=n.get("is_memory_undo_enabled",!1),s=E(),{isPending:i,mutate:l}=z({mutationFn:a=>U.undoMemoryWrite(t,a),onSuccess:()=>{s.invalidateQueries({queryKey:[_,t]})}});return!r||!o?null:e.jsx(q,{disabled:i,onClick:()=>{o&&l(o)},children:e.jsx(d,{id:"qeyS8G",defaultMessage:"Undo"})})}function ce(t){const o=["The user ","The user's ","User ","User's "];for(const n of o)if(t.startsWith(n))return t.slice(n.length);return t}export{xe as MemoryActionResult};
//# sourceMappingURL=bg82vxo39mz0x6ax.js.map
