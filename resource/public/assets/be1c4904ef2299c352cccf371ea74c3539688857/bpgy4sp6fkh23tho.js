import{e as G,r as h,j as e,a7 as ie,a5 as R,d as K,M as ne}from"./fs6h2trisr1juto6.js";import{u as oe,cj as le,ck as re,cl as de,cm as ce,co as ge,d as E,cn as me,c6 as ue,c4 as D,eJ as fe,c5 as z,I as X,aF as xe,M as he,a3 as pe,am as Ie,bH as Q,a as T,S as O,P,V as ve,ej as we}from"./cyi7nanrg0vdotzd.js";import{gC as be,gD as W,bl as je,cG as Me,e3 as ye,d5 as Ce,bF as _e,gE as ke,gF as F,cl as Se,cm as Y,P as Ee,cM as Ne,e8 as Ve,gG as Te,gH as Z,gI as ee,et as ae,gJ as De,bE as A,cN as Fe,a5 as Oe}from"./df9u9imhvwerk6zv.js";import{E as Pe}from"./ky5638d0aqy7l511.js";import{u as Ae,I as Re}from"./m4ktbua61s1ziqoo.js";import{D as Ge,a as te,u as Le,I as L}from"./ezuow9crnw1u1146.js";import{u as Be}from"./nlkl42j3n1q6imdw.js";import{T as N}from"./ca8xspsebes9twfc.js";import"./pcjkp37t4ugnklc3.js";import"./f3zzw463zuggq6da.js";import"./kg9pnjn9ianmg7dc.js";import"./b22a1k4ozfgjkxq7.js";import"./bibq00lzerxkdtcb.js";import"./gvz98l77ingvo2jj.js";import"./exwx6mc6hw49alht.js";import"./069jlavvvdusqrfm.js";const ze={enter:a=>({zIndex:0,x:a===-1?"10%":"-10%",opacity:0}),center:{zIndex:1,x:0,opacity:1},exit:a=>({zIndex:0,x:a===1?"10%":"-10%",opacity:0})},We={enter:{opacity:0,y:"10%"},visible:{opacity:1,y:0},exit:{opacity:0,y:"10%"}},$=1e3,H=1e3,U=(a,i)=>Math.abs(a)*i;function $e(a){const i=G(),n=oe(),o=be(),m=[W.Small,W.Mobile].includes(o),[I,u]=h.useState({width:0,height:0}),[r,p]=h.useState(!1),[l,f]=h.useState(a.image),[w,j]=h.useState(!1),M=I.width>0&&I.height>0,c=h.useRef(null),[x,y]=h.useState(0);h.useEffect(()=>{if(!l.url)throw new Error("ExpandableImage requires a src");const s=new Image;s.onload=()=>{u({width:s.naturalWidth,height:s.naturalHeight})},s.onerror=()=>{},s.src=l.url},[l.url]),h.useEffect(()=>{const s=c.current;if(w)return s?.addEventListener("keydown",_),()=>{s?.removeEventListener("keydown",_)};f(a.image)},[w]);function d(){f(s=>{const k=(a.images.findIndex(C=>C.url===s.url)+1)%a.images.length;return a.images[k]}),y(-1)}function t(){f(s=>{const v=a.images.findIndex(C=>C.url===s.url),k=v>0?(v-1)%a.images.length:a.images.length-1;return a.images[k]}),y(1)}function g(s){j(s),s&&a.onOpen?.(l)}function _(s){s.key==="ArrowLeft"?t():s.key==="ArrowRight"&&d()}const V=a.images.findIndex(s=>s.url===l.url);return e.jsxs(le,{onOpenChange:g,children:[e.jsx(re,{disabled:!M,className:a.className,"aria-label":i.formatMessage(S.showImage),children:a.children}),e.jsx(de,{container:n?.document.body,children:e.jsx(ce,{className:"fixed inset-0 z-20 flex items-center justify-center bg-black/90 backdrop-blur-xl radix-state-open:animate-show",children:e.jsxs(ge,{className:E("relative flex h-[100dvh] w-screen justify-stretch divide-x divide-white/10 focus:outline-none radix-state-open:animate-contentShow"),ref:c,children:[e.jsx("div",{className:E("flex flex-1 transition-[flex-basis]",!r&&"md:basis-[75vw]"),children:e.jsxs("div",{className:"flex flex-1 flex-col md:p-6",children:[e.jsxs("div",{className:"flex justify-between px-6 py-2 pt-6 text-white sm:mb-4 md:mt-2 md:px-0 md:py-2",children:[e.jsx(me,{asChild:!0,children:e.jsx("button",{"aria-label":i.formatMessage(S.closeModal),children:e.jsx(ue,{})})}),e.jsx("div",{children:!m&&e.jsxs(e.Fragment,{children:[a.getActions?.(l)?.map((s,v)=>e.jsx(D,{color:"ghost",size:"small",onClick:s.onClick,"aria-label":s.ariaLabel,disabled:s.disabled,icon:s.icon},v)),e.jsx(D,{color:"ghost",size:"small",onClick:()=>p(s=>!s),"aria-label":i.formatMessage(S.toggleSidebar),className:"md:inline-flex",icon:je})]})})]}),e.jsx("div",{className:"relative flex flex-1 flex-col items-center justify-center overflow-hidden",children:e.jsx(ie,{initial:!1,custom:x,children:e.jsxs(R.div,{className:"absolute grid h-full w-full grid-rows-2",custom:x,variants:ze,drag:"x",dragConstraints:{left:0,right:0},dragElastic:1,onDragEnd:(s,{offset:v,velocity:k})=>{const C=U(v.x,k.x);C<-$?d():C>$&&t()},children:[e.jsx(R.img,{src:l.url,alt:l.alt,className:"row-span-4 mx-auto h-full object-scale-down",onPanEnd:(s,{offset:v,velocity:k})=>{const C=U(v.y,k.y);C<-H?p(!0):C>H&&p(!1)}},l.url),m&&r&&e.jsx(R.div,{className:"flex text-white",variants:We,initial:"enter",animate:"visible",exit:"exit",transition:{y:{type:"spring",stiffness:300,damping:30},opacity:{duration:.2}},children:a.metadataRenderer(l)})]},l.url)})}),a.images.length>1?e.jsxs("div",{className:"flex items-center justify-center gap-4 p-8 text-white",children:[e.jsx(D,{color:"ghost",size:"small",onClick:t,"aria-label":i.formatMessage(S.previousImage),icon:fe}),a.images.map((s,v)=>e.jsx("img",{src:s.url,alt:s.alt??"",className:E("h-12 w-12 cursor-pointer rounded object-cover transition duration-300 hover:opacity-100",s.url===l.url?"ring-2 ring-white ring-offset-4 ring-offset-black":"opacity-25"),onClick:()=>{f(s),y(v<V?1:-1)},"aria-label":i.formatMessage(S.showImage),role:"button"},s.url)),e.jsx(D,{color:"ghost",size:"small",onClick:d,"aria-label":i.formatMessage(S.nextImage),icon:Me})]}):null]})}),e.jsx("div",{className:E("hidden items-center justify-start overflow-hidden bg-gray-900 text-white transition-[flex-basis] duration-500 md:flex",r?"md:basis-[25vw]":"md:basis-0"),children:e.jsx("div",{className:"w-[25vw] min-w-[25vw]",children:a.metadataRenderer(l)})})]})})})]})}const S=K({showImage:{id:"imageViewer.showImage",defaultMessage:"Show Image"},closeModal:{id:"imageViewer.closeModal",defaultMessage:"Close Modal"},toggleSidebar:{id:"imageViewer.toggleSidebar",defaultMessage:"Toggle Sidebar"},nextImage:{id:"imageViewer.nextImage",defaultMessage:"Next Image"},previousImage:{id:"imageViewer.previousImage",defaultMessage:"Previous Image"}});function He({withLottie:a}){return e.jsxs("div",{className:"absolute left-0 top-0 flex h-full w-full items-center justify-center rounded-full",children:[e.jsx(Ge,{animate:a,matchTextColor:!0,className:"h-6 w-6"}),e.jsx(Ue,{})]})}function Ue(){const[i,n]=h.useState(new Date);h.useEffect(()=>{n(new Date)},[]);const o=ye(+i,25e3);return e.jsx(Ce,{percentage:o,thickness:1.25/23,className:"absolute left-1/2 top-1/2 h-10 w-10 -translate-x-1/2 -translate-y-1/2",backgroundStrokeClassName:"stroke-token-main-surface-tertiary",transitionDuration:`${(100-o)/100*.2}s`,transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)"})}function fa({messages:a,clientThreadId:i,disableClickThru:n=!1}){const[o,m]=a,I=_e(o),u=ke(),r=a.some(f=>u.has(f.id));let p=null;m!=null&&z.isMultimodalTextMessage(m)&&(p=z.getImageAssetPointers(m));let l=N.Running;return p!=null?l=N.Finished:m!=null?l=N.Error:I&&(l=N.Stopped),e.jsx(te.Provider,{value:n,children:!r&&e.jsx(qe,{imageAssets:p??[],clientThreadId:i,toolStatus:l,toolMessage:m,messageId:o.id})})}const qe=({imageAssets:a,clientThreadId:i,toolMessage:n,toolStatus:o,messageId:m})=>{const I=G(),u=X(i),r=Ae(a,void 0,u),{value:p}=xe("4132051975"),l=h.useMemo(()=>o===N.Finished&&r.every(c=>!!c.data),[o,r]);if(n?.content.content_type===he.SystemError)return null;const f=se(a[0]),w=r.map(c=>c.data).filter(c=>c!=null),j=w.map(c=>({...c,alt:F(c)})),M=(c=0)=>`${m}-image-${c}`;return e.jsxs("div",{children:[e.jsxs(Qe,{$numItems:r.length,className:"my-1 transition-opacity duration-300",children:[r.length===0&&o===N.Running&&e.jsx(q,{layoutId:"loading:placeholder",shape:f,isToolRunning:!0},"loading"),r.map((c,x)=>{const{isLoading:y,data:d,error:t}=c;if(y)return e.jsx(q,{shape:f,layoutId:M(x)},x);if(t!=null||d?.url==null)return e.jsx(B,{layoutId:M(x),className:"text-sm text-token-text-tertiary",shape:f,children:e.jsx("div",{className:"flex min-h-full flex-col items-center justify-center gap-3 px-4 pb-5",children:I.formatMessage(b.imageLoadError)})},x);if(n&&d){const g={...d,alt:F(d)};return e.jsx(Je,{image:g,allImages:j,clientThreadId:i,toolMessage:n,index:x,onOpenImageEditor:()=>{Se.setFocusedObject({type:Y.Image,image:g,allImages:w,messageId:n.id})}},x)}})]}),p&&l&&e.jsx("div",{className:"text-md flex flex-row items-center py-2 text-token-text-tertiary",children:e.jsx("span",{className:"mr-2",children:e.jsx(ne,{id:"pvSitT",defaultMessage:"Made with the old version of image generation. New images <link>coming soon</link>.",values:{link:c=>e.jsx("a",{className:"text-token-text-tertiary underline underline-offset-4",href:"https://openai.com/index/introducing-4o-image-generation/",target:"_blank",rel:"noopener noreferrer",children:c})}})})})]})};function Je({toolMessage:a,clientThreadId:i,allImages:n,image:o,index:m,onOpenImageEditor:I}){const u=G(),r=X(i),p=se(o),l=h.useContext(te),[f,w]=h.useState({}),j=Le({clientThreadId:i});async function M(t){De(t,r,a.id,l)}function c(t){O.logEvent("chatgpt_dalle_image_view_full",null,{sourceOperation:t.metadata?.dalle?.edit_op??"none",hasParent:t.metadata?.dalle?.parent_gen_id?"true":"false",model:"dalle"}),P.logEvent(T.dalleImageViewFull,{conversationId:r,messageId:a.id,generationId:t.metadata?.dalle?.gen_id,parentGenerationId:t.metadata?.dalle?.parent_gen_id,fileId:A(t.asset_pointer),sourceOperation:t.metadata?.dalle?.edit_op,model:"dalle"}),O.logEvent("chatgpt_image_view_full",null,{sourceOperation:t.metadata?.dalle?.edit_op??"none",hasParent:t.metadata?.dalle?.parent_gen_id?"true":"false",model:"dalle"}),P.logEvent(T.chatgptImageViewFull,{conversationId:r,messageId:a.id,generationId:t.metadata?.dalle?.gen_id,parentGenerationId:t.metadata?.dalle?.parent_gen_id,fileId:A(t.asset_pointer),sourceOperation:t.metadata?.dalle?.edit_op,model:"dalle"})}function x(t,g){w(V=>({...V,[t.asset_pointer]:g}));const _=l?T.dalleImageCaptioningRating:T.dalleImageRating;O.logEvent(_,g?"like":"dislike",{liked:g?"true":"false",sourceOperation:t.metadata?.dalle?.edit_op??"none",hasParent:t.metadata?.dalle?.parent_gen_id?"true":"false",model:"dalle"}),P.logEvent(_,{liked:g,conversationId:r,messageId:a.id,generationId:t.metadata?.dalle?.gen_id,parentGenerationId:t.metadata?.dalle?.parent_gen_id,fileId:A(t.asset_pointer),sourceOperation:t.metadata?.dalle?.edit_op,model:"dalle"}),O.logEvent("chatgpt_image_rating",g?"like":"dislike",{liked:g?"true":"false",sourceOperation:t.metadata?.dalle?.edit_op??"none",hasParent:t.metadata?.dalle?.parent_gen_id?"true":"false",model:"dalle"}),P.logEvent(T.chatgptImageRating,{liked:g,conversationId:r,messageId:a.id,generationId:t.metadata?.dalle?.gen_id,parentGenerationId:t.metadata?.dalle?.parent_gen_id,fileId:A(t.asset_pointer),sourceOperation:t.metadata?.dalle?.edit_op,model:"dalle"})}function y(t){const g=f[t.asset_pointer],_={label:u.formatMessage(b.likeImage),onClick:()=>x(t,!0),disabled:g===!0,ariaLabel:u.formatMessage(b.likeImage),icon:Z},V={label:u.formatMessage(b.dislikeImage),onClick:()=>x(t,!1),disabled:g===!1,ariaLabel:u.formatMessage(b.dislikeImage),icon:ee},s={label:u.formatMessage(b.downloadImage),onClick:()=>M(t),ariaLabel:u.formatMessage(b.downloadImage),icon:ae};return[g!==!1&&_,g!==!0&&V,s].filter(Boolean)}let d=e.jsx(Xe,{image:o,shape:p,rating:f[o.asset_pointer],onDownload:()=>M(o),onRate:(t,g)=>x(t,g),clientThreadId:i,layoutId:void 0});return j?d=e.jsx("div",{role:"button",onClick:I,children:d}):l||(d=e.jsx($e,{image:o,images:n,metadataRenderer:t=>e.jsx(Ke,{image:t}),onOpen:c,getActions:y,children:d})),e.jsx("div",{className:"flex",children:d},m)}function q({shape:a,layoutId:i,isToolRunning:n=!1}){const{isOpen:o}=Be();return e.jsx(B,{shape:a,layoutId:o?void 0:i,children:e.jsx("div",{className:"flex min-h-full items-center justify-center",children:e.jsx(He,{withLottie:n})})},"loading")}function Ke({image:a}){const i=G(),[n,o]=h.useState(!1),m=ve();function I(u){const r=F(a);o(!0),Oe(r,m,u),setTimeout(()=>{o(!1)},2e3)}return e.jsxs("div",{className:"flex flex-col items-start gap-3 p-6",children:[e.jsx("div",{className:"text-sm text-gray-300 sm:text-base",children:i.formatMessage(b.imageViewerMetadataTitle)}),e.jsx("div",{className:"max-h-32 overflow-y-auto text-sm md:max-h-[80vh] md:text-lg",children:F(a)}),e.jsx(D,{color:"primary",onClick:I,disabled:n,className:"hidden sm:block",icon:we,children:n?i.formatMessage(b.imageViewerMetadataCopyButtonCopied):i.formatMessage(b.imageViewerMetadataCopyButton)})]})}function B({children:a,shape:i,className:n,layoutId:o}){return e.jsxs(R.div,{layoutId:o,className:E("relative",n,i==="1792x1024"&&"aspect-[7/4]",i==="1024x1024"&&"aspect-square max-w-[400px]",i==="1024x1792"&&"aspect-[4/7] max-w-xs","overflow-hidden rounded-2xl"),children:[e.jsx("div",{className:"pointer-events-none absolute inset-0 bg-token-main-surface-secondary"}),e.jsx("div",{className:"relative h-full",children:a})]})}function Xe({image:a,shape:i,rating:n,onDownload:o,onRate:m,clientThreadId:I,layoutId:u}){const r=Ee(),p=Ne(Fe.isBusinessWorkspace),l=pe(I,d=>d?.mode),f=Ve(),w=Te(),j=w?.type===Y.Image&&w.image.asset_pointer===a.asset_pointer,{url:M,width:c,height:x}=a,y=!r&&!p&&l?.kind!==Ie.GizmoMagicCreate;return e.jsxs(B,{shape:i,className:"group/dalle-image",layoutId:j?void 0:u,children:[e.jsx(Re,{alt:F(a),src:M,width:c,height:x}),e.jsx("div",{className:E("pointer-events-none absolute inset-0 rounded-2xl shadow-[inset_0_0_0_1px_rgba(0,0,0,0.1)] dark:shadow-[inset_0_0_0_1px_rgba(255,255,255,0.1)]",j?"bg-black/50 group-hover/dalle-image:bg-black/70":"group-hover/dalle-image:bg-transparent")}),f?!j&&e.jsx("div",{className:"pointer-events-none invisible absolute right-3 top-3 text-white group-hover/dalle-image:visible",children:e.jsx(Pe,{})}):e.jsxs(e.Fragment,{children:[y&&e.jsxs(J,{children:[n!==!1&&e.jsx(L,{icon:Z,selected:n===!0,onClick:d=>{d.stopPropagation(),m(a,!0)}}),n!==!0&&e.jsx(L,{icon:ee,selected:n===!1,onClick:d=>{d.stopPropagation(),m(a,!1)}})]}),e.jsxs(J,{$rightAlign:!0,children:[!1,e.jsx(L,{icon:ae,onClick:d=>{d.stopPropagation(),o()}})]})]})]})}const J=Q.div`invisible absolute top-3 flex gap-1 group-hover/dalle-image:visible z-[2]
${({$rightAlign:a})=>a?"right-3":"left-3"}`,Qe=Q.div`grid gap-2
${({$numItems:a})=>a<=1?"grid-cols-1":"grid-cols-2"}`;function se(a){if(!a)return"1024x1024";const{width:i,height:n}=a;return i>n?"1792x1024":i<n?"1024x1792":"1024x1024"}const b=K({creatingImages:{id:"dalleMessage.creatingImagesV2",defaultMessage:"Creating image"},stopped:{id:"dalleMessage.stoppedV3",defaultMessage:"Stopped creating image"},errorCreating:{id:"dalleMessage.errorCreatingV2",defaultMessage:"Error creating image"},imageLoadError:{id:"dalleMessage.imageLoadError",defaultMessage:"Error loading image"},imageViewerMetadataTitle:{id:"dalleMessage.imageViewerMetadataTitle",defaultMessage:"Prompt"},imageViewerMetadataCopyButton:{id:"dalleMessage.imageViewerMetadataCopyButton",defaultMessage:"Copy"},imageViewerMetadataCopyButtonCopied:{id:"dalleMessage.imageViewerMetadataCopyButtonCopied",defaultMessage:"Copied!"},imageEditButton:{id:"dalleMessage.imageEditButton",defaultMessage:"Edit"},downloadImage:{id:"imageViewer.downloadImage",defaultMessage:"Download Image"},likeImage:{id:"imageViewer.likeImage",defaultMessage:"Like Image"},dislikeImage:{id:"imageViewer.dislikeImage",defaultMessage:"Dislike Image"}});export{fa as default};
//# sourceMappingURL=bpgy4sp6fkh23tho.js.map
