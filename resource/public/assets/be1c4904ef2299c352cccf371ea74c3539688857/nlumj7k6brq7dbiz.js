import{e as b,j as n,a7 as j,a5 as T}from"./fs6h2trisr1juto6.js";import{M as w,fz as a,y as x,d as k,fA as E,Z as F,bH as N}from"./cyi7nanrg0vdotzd.js";import{bG as v,bH as Q,bF as B,bI as O,bJ as L,bK as A,bL as q,bM as D,bN as R,bO as U}from"./df9u9imhvwerk6zv.js";import{T as h,a as P}from"./ca8xspsebes9twfc.js";import"./b22a1k4ozfgjkxq7.js";import"./kg9pnjn9ianmg7dc.js";import"./f3zzw463zuggq6da.js";import"./bibq00lzerxkdtcb.js";import"./gvz98l77ingvo2jj.js";import"./exwx6mc6hw49alht.js";import"./069jlavvvdusqrfm.js";function he({messages:e,isRequestActive:t,isLastMessageInTurn:r,isRetrieval:s,isUsingGizmo:i,isUsingSnorlax:l}){const c=ae({messages:e}),d=H(e),u=d.filter(m=>Z(m,!1)&&!G(m)),p=u[u.length-1]??void 0,o=b();if(Y(e).some(({content:m})=>m.content_type===w.SystemError))return null;let g=h.Running;const C=u.filter(m=>m.type===a.Search).length,M={count:u.length-C,domain:p?v(y(p)??""):void 0,query:p?_(p):void 0};let f=s?i?l?o.formatMessage(Q.searchingProjectFiles):o.formatMessage({id:"browsingMessage.searchingKnowledge",defaultMessage:"Searching my knowledge"}):o.formatMessage({id:"browsingMessage.startingRetrieval",defaultMessage:"Reading documents"}):o.formatMessage({id:"message.tools.browse.running",defaultMessage:"Searching the web"});return e.some(B)?(g=h.Stopped,f=s?i?o.formatMessage({id:"browsingMessage.searchingKnowledgeStopped",defaultMessage:"Stopped searching knowledge"}):o.formatMessage({id:"browsingMessage.retrievalStopped",defaultMessage:"Stopped reading documents"}):o.formatMessage({id:"message.tools.browse.stopped",defaultMessage:"Search stopped"})):!r||!t?d.length>0&&d.every(m=>m.didError)?(g=h.Error,f=s?i?o.formatMessage({id:"browsingMessage.searchingKnowledgeFailed",defaultMessage:"Error searching knowledge"}):o.formatMessage({id:"browsingMessage.retrievalFailed",defaultMessage:"Error reading documents"}):o.formatMessage({id:"message.tools.browse.failed",defaultMessage:"Search failed"})):(g=h.Finished,f=s?null:M.count===0?o.formatMessage({id:"message.tools.browse.started",defaultMessage:"Searching the web..."}):o.formatMessage({id:"message.tools.browse.finished",defaultMessage:"Searched {count, plural, =0 {0 sites} one {# site} other {# sites}}"},M)):c.length>0?f=se({contextualAnswerSources:c,intl:o}):u.length>0&&(f=V(o,M,s,i,u[u.length-1])),(u.length>0||s&&r)&&g!==h.Error?n.jsx(P,{highlightedCommand:f,showWorkUserSetting:!1,status:g,children:u.length===0?null:n.jsx(I,{commands:u})}):n.jsx(z,{$isError:g===h.Error,children:f})}function S(e){return e.metadata?.command==="quote"||e.metadata?.command==="quote_full"||e.metadata?.command==="quote_lines"}function H(e){return e.map((t,r)=>{if(t.author.role!==x.Tool||r>0&&S(t)&&S(e[r-1]))return null;const s=t.metadata;if(!s)return null;const{command:i,status:l}=s;return i?{type:i,status:l,didError:t.content.content_type===w.SystemError,message:t}:null}).filter(O)}function I({commands:e}){const t=b();return n.jsx("div",{className:"mb-4 divide-y divide-token-border-light rounded-xl border border-token-border-light text-sm",children:n.jsx(j,{initial:!1,children:e.map((r,s)=>{const i=$(r);if(i==null)return null;const{icon:l,url:c,title:d,externalLink:u}=i,p=c?v(c):void 0,o=d?typeof d=="string"?d:t.formatMessage(d):null,g=c&&L(c);return n.jsx(T.div,{initial:"collapsed",animate:"open",variants:{open:{opacity:1,height:"auto"},collapsed:{opacity:0,height:0}},children:n.jsxs(K,{url:u??c,className:k("flex items-start gap-3 px-4 py-3",d?"text-token-text-secondary":"text-token-text-primary",s===0&&"rounded-t-xl",s===e.length-1&&"rounded-b-xl"),children:[l?n.jsx(l,{className:"icon-sm mt-0.5 flex-shrink-0 text-token-text-secondary"}):c?n.jsx(A,{url:c,className:"mt-1"}):null,n.jsxs("div",{children:[o&&n.jsxs("div",{className:"line-clamp-1 text-token-text-primary",children:[g&&`${g} — `,o]}),n.jsx("div",{children:p})]})]})},s)})})})}function K({url:e,children:t,className:r}){return e?n.jsxs("a",{href:e,target:"_blank",className:k(r,"group relative hover:bg-token-main-surface-secondary"),rel:"noreferrer",children:[t,n.jsx("div",{className:"invisible absolute right-3 bg-gradient-to-l from-token-main-surface-secondary to-transparent pl-4 group-hover:visible",children:n.jsx(q,{className:"icon-md text-token-text-secondary"})})]}):n.jsx("div",{className:r,children:t})}function W(e){const t=e.message.metadata?._cite_metadata?.metadata_list[0];return t!=null&&t.type!=="file"?t.title:null}function _(e){return e.message.metadata?.args?.[0]}function $(e){switch(e.type){case a.Search:{const t=e.message.metadata?.search_engine;if(t&&t!==E.Bing)return null;const r=_(e);return{icon:D,url:e.message.metadata?.message_source==="apple"?null:"bing.com",externalLink:J(e),title:r?`“${r}”`:{id:"message.tools.browse.querying",defaultMessage:"Querying",description:"Status message when issuing a query"}}}case a.Click:case a.MultiClick:case a.Lookup:case a.OpenUrl:case a.Open:case a.Quote:case a.QuoteFull:case a.QuoteLines:case a.Scroll:return{url:y(e),title:W(e)??void 0};case a.Spinner:case a.Back:return null}}function J(e){const t=e.message.metadata?.args?.[0];return t===void 0?null:F.getBingLink({query:t})}function V(e,t,r,s,i){switch(i?.type){case a.Click:case a.MultiClick:case a.Lookup:case a.OpenUrl:case a.Quote:case a.QuoteFull:case a.QuoteLines:case a.Scroll:case a.Open:case a.Back:return e.formatMessage({id:"message.tools.browse.reading",defaultMessage:"Browsing {domain}"},t);case a.Search:case void 0:return r?s?e.formatMessage({id:"browsingMessage.searchingKnowledge",defaultMessage:"Searching my knowledge"}):e.formatMessage({id:"browsingMessage.startingRetrieval",defaultMessage:"Reading documents"}):e.formatMessage({id:"message.tools.browse.searching",defaultMessage:'Searching "{query}"'},t);case a.Spinner:return null}}function X(e){const t=e.message.metadata?._cite_metadata?.metadata_list[0];return t!=null&&t.type==="file"?t.name:null}function Z(e,t){switch(e.type){case a.Search:return!0;case a.Click:case a.Lookup:case a.MultiClick:case a.OpenUrl:case a.Quote:case a.QuoteFull:case a.QuoteLines:return t?X(e)!=null:y(e)!=null;case a.Open:case a.Back:case a.Scroll:case a.Spinner:return!1}}function G(e){return e.message.metadata?.message_source==="apple"}function y(e){const t=e.message.metadata?._cite_metadata?.metadata_list[0];return t!=null&&t.type!=="file"?t.url:null}function Y(e){return e.filter(t=>t.author.role===x.Tool)}const z=N.p`first:mt-0 my-1.5 h-8 flex items-center ltr:mr-auto rtl:ml-auto empty:hidden
${({$isError:e})=>e?"text-token-text-error":"text-token-text-secondary"}`,ee={google_drive:"Google Drive",slack:"Slack"},te={google_drive:R,slack:U},ae=({messages:e})=>[...e.filter(s=>s.author.role===x.Tool&&s.author.name==="file_search"&&s.metadata?.command===a.Spinner&&s.metadata?.retrieval_search_sources).reduce((s,i)=>(i.metadata?.retrieval_search_sources?.forEach(l=>{l.source_name==="contextual_answer"&&s.add(l.source_name)}),s),new Set)],se=({contextualAnswerSources:e,intl:t})=>{const r=e.map(l=>ee[l]).filter(Boolean),s=e.map(l=>{const c=te[l];return n.jsx(c,{className:"icon-sm"},l)}).filter(Boolean),i=e.length===1?t.formatMessage({id:"Jzt2om",defaultMessage:"Reading {source}"},{source:r[0]}):e.length===2?t.formatMessage({id:"wTM7gR",defaultMessage:"Reading {source1} and {source2}"},{source1:r[0],source2:r[1]}):t.formatMessage({id:"xnwjH1",defaultMessage:"Reading {source1}, {source2} and more"},{source1:r[0],source2:r[1]});return e.length>0?n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"flex items-center gap-1",children:s}),i]}):void 0};export{he as BrowsingMessage,y as getVisitedUrl};
//# sourceMappingURL=nlumj7k6brq7dbiz.js.map
