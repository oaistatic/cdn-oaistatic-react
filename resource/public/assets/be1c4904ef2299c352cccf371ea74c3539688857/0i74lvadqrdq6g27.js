import{r,j as s,M as y}from"./fs6h2trisr1juto6.js";import{d as _,bH as z,al as I,E as R,F as A,eS as G,P as h,a as p,aT as U,l as V,c4 as w,aV as B,z as K}from"./cyi7nanrg0vdotzd.js";import{H as D,g8 as J,z as L,h1 as O,h2 as W}from"./df9u9imhvwerk6zv.js";import{b as Q}from"./kg9pnjn9ianmg7dc.js";const X=r.forwardRef(function(t,c){const{className:i,...d}=t;return s.jsxs("div",{className:"grid",children:[s.jsx("textarea",{className:_("col-start-1 col-end-2 row-start-1 row-end-2 resize-none overflow-hidden p-0",i),ref:c,...d}),s.jsxs("span",{className:"invisible col-start-1 col-end-2 row-start-1 row-end-2 whitespace-pre-wrap p-0",children:[t.value," "]})]})});function Y({initialText:o,clientThreadId:t,currentLeaf:c,onExitEdit:i,onRequestCompletion:d,disabled:E,attachments:l}){const[u,N]=r.useState(o??""),m=r.useRef(null),M=D(),v=Q(),g=u.trim()==="",{value:S}=I("1988730211"),C=r.useCallback(e=>{N(e.currentTarget.value)},[]),x=r.useCallback(e=>{if(g)return;const a={},n=J();l&&(a.attachments=l),n&&(a.__internal={search_settings:n});const j=Array.from(v),{systemHints:P,extraStreamParams:H}=S?L(j):{systemHints:j,extraStreamParams:{}},b=R(t),F=A.getParentNode(b,c).message.id;d({sourceEvent:e,parentMessageId:F,promptMessage:G(u,Object.keys(a).length>0?a:void 0),extraStreamParams:H,completionMetadata:{conversationMode:b?.mode,systemHints:P}}),i(),h.logEvent(p.changeNode,{intent:"edit_save"})},[g,l,t,v,S,d,i,c,u]),f=r.useCallback(()=>{U(t,e=>{B.setCurrentBranch(e,c)}),h.logEvent(p.changeNode,{intent:"edit_cancel"}),i(),h.logEvent(p.cancelEditPrompt,{threadId:V(t)})},[c,i,t]);r.useEffect(()=>{const e=m.current;if(e){e.focus();const a=e.value.length;e.setSelectionRange(a,a)}},[]),r.useEffect(()=>{const e=m.current,a=n=>{n.isComposing||(n.key==="Enter"&&n.metaKey?x(n):n.key==="Escape"&&f())};return e&&e.addEventListener("keydown",a),()=>{e&&e.removeEventListener("keydown",a)}},[f,x]);const T=l&&l.length>0&&s.jsx(Z,{children:l.map(e=>s.jsx(O,{width:M?"normal":"wide",file:e.name,contextConnectorInfo:W(e.context_connector_info)},e.id))}),k=s.jsx("div",{className:"m-2 max-h-[25dvh] overflow-auto",children:s.jsx(X,{ref:m,value:u,onChange:C,className:"m-0 w-full resize-none border-0 bg-transparent focus:ring-0 focus-visible:ring-0"})});return s.jsxs("div",{className:"rounded-3xl bg-token-main-surface-tertiary px-3 py-3",children:[T,k,s.jsxs("div",{className:"flex justify-end gap-2",children:[s.jsx(w,{as:"button",color:"secondary",onClick:f,children:s.jsx(y,{id:"D9gbPp",defaultMessage:"Cancel"})}),s.jsx(w,{as:"button",onClick:x,disabled:E||g,children:s.jsx(y,{id:"KGxIJG",defaultMessage:"Send"})})]})]})}const Z=z.div`flex gap-2 flex-wrap`;function ne({message:o,...t}){return s.jsx(Y,{currentLeaf:o.id,initialText:K(o),attachments:o.metadata?.attachments,...t})}export{ne as TextMessageEditor};
//# sourceMappingURL=0i74lvadqrdq6g27.js.map
