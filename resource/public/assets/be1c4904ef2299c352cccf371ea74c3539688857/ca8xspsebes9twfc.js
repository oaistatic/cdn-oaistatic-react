const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/bjldstj3hm1zvwo5.js","assets/fs6h2trisr1juto6.js","assets/m4ktbua61s1ziqoo.js","assets/cyi7nanrg0vdotzd.js","assets/root-drzjahv8.css","assets/df9u9imhvwerk6zv.js","assets/conversation-small-kx6wglz1.css","assets/pcjkp37t4ugnklc3.js","assets/b22a1k4ozfgjkxq7.js","assets/kg9pnjn9ianmg7dc.js","assets/f3zzw463zuggq6da.js","assets/bibq00lzerxkdtcb.js","assets/gvz98l77ingvo2jj.js","assets/exwx6mc6hw49alht.js","assets/069jlavvvdusqrfm.js","assets/bciaydgpsr3n89ey.js","assets/dxyq241jyvrm1jhv.js","assets/l7fyhq2vzhr5qo8u.js","assets/bpgy4sp6fkh23tho.js","assets/ky5638d0aqy7l511.js","assets/ezuow9crnw1u1146.js","assets/nlkl42j3n1q6imdw.js","assets/k9h97m9f51i0np00.js","assets/czux62el9j9eyk4d.js","assets/muk733l8kcs92zol.js","assets/dtx9fzvfshnw2efc.js","assets/kkp07evd8epclwk3.js","assets/nlumj7k6brq7dbiz.js","assets/d9r5ag2pz4cjfeg7.js","assets/j4l4xvly8pb3961j.js","assets/l0wwz9fs2x6psnxm.js","assets/keaqrviydmxuvxnw.js","assets/kh3yzdvuzkxnlmrn.js","assets/dp0ii8vuue4rnykh.js","assets/b7o9536h4wpvjcqi.js","assets/k76xevje6k7b3vo6.js","assets/ml3qtquvggrs5386.js","assets/p32qvzx3ml1odktp.js","assets/obdfg8x0588jk5qt.js","assets/lodl3s7jfiypzk1n.js","assets/htu9pml8lfjcb6ls.js","assets/g67zyzc7bfbl1vkm.js","assets/jteom3gltchw516e.js","assets/e0sfrrlvs75vveq5.js","assets/hi1g9go8t53qsjy9.js","assets/fdc267gtmse8t1gq.js","assets/cvvlp6bftojvu0f7.js","assets/jo3x2yf4dp19h25k.js","assets/f25rpzpqicaw21n1.js","assets/m1fsshfoerllttos.js","assets/FormattedText-ecwyy7s8.css","assets/o77dlyy0lhhjntje.js","assets/cot-message-lf3q5fj1.css","assets/i2k9gbmxhhv635qe.js","assets/jfi01owl9mian83i.js","assets/gvcdftjo0g74i8s2.js","assets/oetwuhpmhqg31xga.js","assets/iot2esljs5ma74te.js","assets/hx2kxxv1rwdb7zis.js"])))=>i.map(i=>d[i]);
import{cG as Ae,a3 as O,F as I,dv as ke,B as te,T as ue,gz as Me,E as we,a as Q,l as ge,aT as fe,bE as De,bR as B,X as Oe,d as T,fC as Re,y as xe,c4 as J,eS as Le,am as z,P as Ie,cH as Pe,bH as pe,gA as X,eY as Fe,eZ as Ue,c0 as Ve,ef as ae,ee as Be,aF as _e,D as He,f$ as ze,bP as E,bQ as S,er as Je,eg as p,J as Ke,bL as We}from"./cyi7nanrg0vdotzd.js";import{j as s,M as v,r as f,e as $,a7 as V,a5 as D,b as Qe}from"./fs6h2trisr1juto6.js";import{l1 as Xe,jp as Ye,gR as $e,l2 as qe,jh as Ze,l3 as Ge,ea as es,l4 as he,jd as ye,l5 as L,l6 as ss,g7 as je,l7 as ts,l8 as as,_ as be,e3 as ns,e4 as os,bT as K,l9 as rs,la as is,lb as Y,lc as ls,ld as cs,le as ms,lf as ne,lg as ds,lh as us,li as gs,lj as oe,kJ as ve,d5 as fs,lk as xs,ll as ps,lm as _s,ln as hs,ak as ys,aj as js,g0 as bs,bK as vs,eO as Es,fu as Ss,lo as Cs,lp as Ns,jE as Ts,kO as As,js as ks,en as Ms,eo as ws,lq as Ds,lr as Os,ls as Rs,hx as Ls,lt as Is,j5 as Ps,fI as Fs,lu as Us,d7 as Vs,lv as Bs}from"./df9u9imhvwerk6zv.js";import{u as Hs}from"./b22a1k4ozfgjkxq7.js";import{a as Ee,u as zs}from"./kg9pnjn9ianmg7dc.js";import{u as Js}from"./f3zzw463zuggq6da.js";import{a as Ks}from"./bibq00lzerxkdtcb.js";import{N as Ws}from"./gvz98l77ingvo2jj.js";import{k as Qs}from"./exwx6mc6hw49alht.js";const Xs=(e,n)=>{const t=O(e,o=>I.getLastMessageSystemHints(o).includes(ke.CANVAS)),a=Hs({clientThreadId:e}),r=Xe(e),i=te(te(n)?.messages)?.id,m=n.some(o=>o.messages.some(c=>c.metadata?.canvas?.canvas_opt_in));return{isVisible:!t&&!r&&!m&&!!i,onClick:async o=>{if(!i)return;o.stopPropagation(),Ye();const c=[ue.CANMORE];a({sourceEvent:o,nodeId:i,appendMessages:[Me("The user has requested the canvas tool be disabled for this conversation. You should not call the tool again.",{disable_tool_ids:c,exclude_after_next_user_message:!0})]});const u=we(e),x=I.getConversationTurns(u,i).length,g=I.getParentPromptNode(u,i)?.message.id;$e.logEventWithStatsig(Q.canvasOptOutClicked,"chatgpt_canvas_opt_out_clicked",{num_turns:String(x),conversation_id:ge(e),message_id:g}),fe(e,h=>{h.disabledToolIds=c})}}},Ys=({clientThreadId:e,groupedMessages:n})=>{const{isVisible:t,onClick:a}=Xs(e,n);return t?s.jsx("button",{onClick:a,className:"mb-2 w-full text-token-text-secondary hover:text-token-text-primary",children:s.jsxs("div",{className:"flex items-center rounded-xl",children:[s.jsx(v,{id:"aa5Dyk",defaultMessage:"Answer in chat instead"}),s.jsx(Ae,{className:"icon-md text-token-text-secondary"})]})}):null},$s=({messages:e,isRequestActive:n,isFinalTurn:t,allGroupedMessages:a,clientThreadId:r,isUserTurn:i=!1})=>{const m=f.useMemo(()=>qe(e),[e]),l=f.useMemo(()=>m?m.map(([o,c])=>Ze(n,o,c)).filter(Boolean):[],[m,n]);return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"flex flex-col gap-2",children:l.map(o=>s.jsx(Ge,{toolCall:o,clientThreadId:r,isRequestActive:n},o.messageId))}),s.jsx(es,{featureType:De.CANVAS_SUPPORTED,isUserTurn:i,clientThreadId:r}),t&&s.jsx(Ys,{clientThreadId:r,groupedMessages:a})]})};function qs(e,n,t){const a=he(o=>!!(e&&o.tasks[e])),{openThreadSidebar:r}=B(),i=ye("caterpillar"),m=O(t,o=>I.findNode(o,c=>c.message.metadata?.async_task_id===e&&(c.message.metadata?.b1de6e2_rm===!0||c.message.metadata?.is_async_task_result_message===!0))!=null),{clearSystemHintModeTrigger:l}=Ee();f.useEffect(()=>{if(a||!e||!n)return;const{async_task_created_at:o,async_task_prompt:c,async_task_title:u}=n.metadata??{};if(!o||!c||!u)return;const g={originalConversationId:ge(t)??t,taskId:e,title:u,prompt:c,createdAt:o,updatedAt:o,status:L.UNDETERMINED};ss.setTask(e,g),l(je.Research)},[a,e,n,t,r,i,l,m])}const W={div:e=>{const{node:n,children:t,...a}=e;return s.jsx("div",{...a,className:"text-red-500",children:t})},p:e=>{const{node:n,children:t,...a}=e;return s.jsx("p",{...a,className:"text-start leading-6 text-token-text-primary",children:t})},a:e=>{const{node:n,children:t,...a}=e;return s.jsx("a",{...a,className:"font-sm leading-6 !text-token-text-primary",children:t})}},Zs=1e3*60*2,Gs=30;function Se({onClick:e,statusMessage:n,showSources:t,includeMargin:a,sources:r,progressBar:i}){const m=be();return s.jsx("button",{onClick:()=>m&&e(),className:T("mt-4 flex w-4/5 max-w-[416px] items-start justify-start gap-[18px] rounded-2xl border border-black/10 bg-token-main-surface-primary px-5 py-4 shadow dark:border-white/10",m?"cursor-pointer hover:bg-token-main-surface-secondary":"cursor-auto"),children:s.jsxs("div",{className:"flex w-full flex-col gap-3",children:[s.jsxs("div",{className:T("flex flex-col items-start justify-start self-stretch md:h-7 md:flex-row md:items-center md:justify-between",t?"h-12":"h-6"),children:[s.jsx("div",{className:T("font-sm w-full flex-1 truncate text-start leading-7 text-token-text-primary md:w-0",a&&"mr-[30px]"),children:n}),t&&r]}),s.jsx("div",{className:"flex w-full items-center justify-start gap-4 self-stretch pb-2",children:i})]})})}function q({toggleSidebar:e,openSidebar:n,startTime:t}){const a=$(),[r,i]=f.useState(!1),m=ts();return f.useEffect(()=>{if(!t)return;const l=Date.now()-t,o=Zs-l;if(o>0){const c=setTimeout(()=>{i(!0),n()},o);return()=>clearTimeout(c)}else i(!0),n()},[t,n]),s.jsx(Se,{onClick:e,statusMessage:r?a.formatMessage({id:"T2SbxC",defaultMessage:"Waiting…"}):s.jsx("div",{className:"text-pretty text-sm font-medium text-token-text-primary",children:m.startingMessage}),progressBar:s.jsx(as,{className:"h-2 w-full"}),showSources:!1})}function et(e,n,t){const a=e.formatMessage({id:"Bs+OcV",defaultMessage:"Thinking…"});if(n.length<2)return t?.initial??a;const r=n[n.length-2];return r.type==="summary"?r.title:r.type==="search"?r.query:r?.type==="websiteOpen"?s.jsx(K,{componentOverrides:W,children:r.activeRowText}):r.type==="fileOpen"?s.jsx(K,{componentOverrides:W,children:r.activeRowText}):r.type==="pythonAnalysis"?s.jsx(K,{componentOverrides:W,children:r.analysisSummary}):a}function st({task:e,clientThreadId:n,caterpillarRows:t,messageWithTaskMetadata:a,totalSources:r,handleToggleCaterpillarSidebar:i}){const m=$(),l=be(),o=et(m,t,a.metadata?.async_task_status_messages),c=(e?.expectedDurationMinutes??Gs)*60*1e3,u=ns(t[1]?.created_at?t[1].created_at*1e3:Date.now(),c),x=t[1]&&t[1].created_at?u:0;f.useEffect(()=>{fe(n,y=>{y.async_status=Oe.STREAMING})},[n]);const{openThreadSidebar:g}=B();f.useEffect(()=>{t.length===2&&l&&g({type:"caterpillar",caterpillarId:e.taskId,initialTab:"activity",clientThreadId:n})},[t.length,g,e.taskId,n,l]);const h=f.useCallback(()=>{g({type:"caterpillar",caterpillarId:e.taskId,initialTab:"activity",clientThreadId:n})},[g,e.taskId,n]);return t.length<=1?s.jsx(q,{toggleSidebar:()=>i("activity"),openSidebar:h,startTime:new Date(e.createdAt).getTime()}):s.jsx(Se,{onClick:()=>i("activity"),statusMessage:o,showSources:!0,includeMargin:r>0,sources:r===0?s.jsx("div",{className:"text-pretty text-sm text-token-text-tertiary",children:s.jsx(v,{id:"zfwUjs",defaultMessage:"Looking for sources…"})}):s.jsxs("button",{onClick:y=>{y.stopPropagation(),i("sources")},className:T("flex shrink-0 gap-1 text-[13px] leading-[18px] text-[#0285ff]",l?"cursor-pointer hover:text-[#0285ff]/80":"cursor-auto"),children:[s.jsx("div",{className:"relative",children:s.jsx(V,{initial:!1,children:s.jsx(D.span,{initial:{opacity:0,rotateX:-90,translateY:20},animate:{opacity:1,rotateX:0,translateY:0},exit:{opacity:0,rotateX:90,translateY:-20},transition:{duration:.35},className:"absolute left-0 md:right-0",children:r},r)})}),s.jsx("div",{className:T("md:pr-0",r>0&&"pl-2",r>9&&"pl-[14px]",r>99&&"pl-[22px]"),children:r>1?s.jsx(v,{id:"zN+MuO",defaultMessage:" sources"}):s.jsx(v,{id:"dMowmJ",defaultMessage:" source"})})]}),progressBar:s.jsx("div",{className:"flex h-2 shrink grow basis-0 items-start justify-start gap-2.5 overflow-hidden rounded-[10px] bg-token-main-surface-tertiary",children:s.jsx(os,{percentage:x,barClassName:"bg-token-text-primary",backgroundClassName:"bg-token-main-surface-tertiary"})})})}function re({task:e,clientThreadId:n,messageWithTaskMetadata:t,totalSources:a,handleToggleCaterpillarSidebar:r}){const i=rs(e),m=!1,l=O(n,c=>is(c,e?.taskId)),{clearSystemHintModeTrigger:o}=Ee();return f.useEffect(()=>{e?.status===L.COMPLETED&&!l&&!m&&(i(),o(je.Research))},[e?.status,m,l,i,o]),s.jsx(Y,{message:s.jsxs(s.Fragment,{children:[t.metadata?.async_task_status_messages?.completed_with_time??t.metadata?.async_task_status_messages?.completed_no_time??s.jsx(v,{id:"4d0xZc",defaultMessage:"Completed"}),a===0?s.jsx(v,{id:"VggF2B",defaultMessage:" · 0 sources"}):a===1?s.jsx(v,{id:"zkkdKV",defaultMessage:" · 1 source"}):s.jsx(v,{id:"qcKt3q",defaultMessage:" · {sourcesCount} sources",values:{sourcesCount:a}})]}),handleToggleCaterpillarSidebar:()=>r("activity")})}function tt({messages:e,clientThreadId:n}){const t=e.find(c=>c.metadata?.b1de6e2_s&&c.metadata?.async_task_id),a=t?.metadata?.async_task_id,r=e.find(c=>c.recipient===ue.START_RESEARCH_TASK),i=O(n,c=>ls(c,r?.id)),m=Re({clientThreadId:n}),[l,o]=f.useState(m);return f.useEffect(()=>{const c=setTimeout(()=>{o(i&&m)},3e3);return()=>clearTimeout(c)},[m,i]),!t||!a?l?s.jsx(q,{toggleSidebar:()=>{},openSidebar:()=>{},startTime:new Date().getTime()}):null:s.jsx(at,{clientThreadId:n,payloadTaskId:a,messageWithTaskMetadata:t})}function at({payloadTaskId:e,messageWithTaskMetadata:n,clientThreadId:t}){qs(e,n,t);const a=he(x=>e?x.tasks[e]:null),r=$(),i=a?.status,m=f.useMemo(()=>a?.rows?a.rows:[],[a?.rows]),{toggleThreadSidebar:l}=B(),{totalSources:o}=f.useMemo(()=>{if(!m)return{uniqueSources:[],totalSources:0};const x=cs(m),g=x.reduce((h,y)=>h+y.count,0);return{uniqueSources:x,totalSources:g}},[m]),c=ye("caterpillar"),u=f.useCallback(x=>{e&&l({type:"caterpillar",caterpillarId:e,initialTab:x,clientThreadId:t},c)},[l,e,c,t]);return ms(e),n.metadata?.async_task_status_messages?.completed_with_time?s.jsx(re,{task:a,clientThreadId:t,messageWithTaskMetadata:n,totalSources:o,handleToggleCaterpillarSidebar:u}):!a||!i||i===L.UNDETERMINED?s.jsx(q,{toggleSidebar:()=>{},openSidebar:()=>{},startTime:new Date().getTime()}):a.status===L.COMPLETED?s.jsx(re,{task:a,clientThreadId:t,messageWithTaskMetadata:n,totalSources:o,handleToggleCaterpillarSidebar:u}):a.status===L.FAILED?s.jsx(Y,{message:n.metadata?.async_task_status_messages?.error??r.formatMessage({id:"at6zk8",defaultMessage:"Failed to think"}),handleToggleCaterpillarSidebar:()=>u("activity")}):a.status===L.CANCELLED?s.jsx(Y,{message:n.metadata?.async_task_status_messages?.cancelled??r.formatMessage({id:"u1rIr5",defaultMessage:"Task Cancelled"}),handleToggleCaterpillarSidebar:()=>u("activity")}):s.jsx(st,{task:a,clientThreadId:t,caterpillarRows:m,messageWithTaskMetadata:n,totalSources:o,handleToggleCaterpillarSidebar:u})}function nt(e,n,t){const a=n.elements.length;if(a===0)return;const r=Object.entries(e).reduce((i,[m,l])=>Array.isArray(l)?l.length>0?i+1:i:l!==""?i+1:i,0);Ie.logEventWithStatsig("dynamic-form-submission","chatgpt_dyanmic_form_submission",{...Pe({clientThreadId:t}),totalItems:a.toString(),completedItems:r.toString(),ratio:(r/a).toString()})}function ot(e,n){let t="";return n.elements.forEach(a=>{const r=a.scope.split("/").pop(),i=r&&e[r],m=i?Array.isArray(i)?i.join(", "):i:"Any",l=a.label??r;t+=`${l}: ${m}
`}),t}function rt({messages:e,clientThreadId:n,isLastMessage:t}){const a=e.find(j=>j.author.role===xe.Assistant),r=e.find(j=>j.metadata?.json_form),i=r?.metadata?.json_form,[m,l]=f.useState({}),[o,c]=f.useState(),[u,x]=f.useState(),g=zs(),h=Js(n);f.useEffect(()=>{i&&(c(i.json_form_ui),x(i.json_form_data))},[i]);const y=f.useCallback(()=>{if(l({}),o){const j={...o,elements:o.elements.filter(R=>R.scope!=="#/properties/AdditionalInfo")};c(j)}u&&(delete u.properties.AdditionalInfo,x(u))},[l,c,x,o,u]),b=f.useCallback(()=>{if(o){const j={...o,elements:[...o.elements,{type:"Control",scope:"#/properties/AdditionalInfo",label:"Additional Info",placeholder:"Any other details..."}]};c(j)}if(u){const j={...u.properties,AdditionalInfo:{type:"string"}};x({...u,properties:j})}},[c,x,o,u]),C=o?.elements.some(j=>j.scope.endsWith("#/properties/AdditionalInfo")),k=O(n,I.getCurrentLeafId),N=r?.id!==k;if(!r||!u||!o)return a?.status==="in_progress"&&t?s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx(ne,{className:"h-[26px] w-full"}),s.jsx(ne,{className:"h-[26px] w-3/4"}),s.jsx(ds,{})]}):null;if(N)return null;const U=async j=>{const R=ot(m,o);nt(m,o,n),h({sourceEvent:j,promptMessage:Le(R),completionMetadata:{systemHints:[...g],conversationMode:{kind:z.PrimaryAssistant}}})};return s.jsxs(us,{children:[s.jsx(it,{formData:m,dataSchema:u,uiSchema:o,setData:l,readOnly:N}),s.jsxs("div",{className:"flex w-full justify-between",children:[C?s.jsx("div",{}):s.jsx(J,{disabled:N,onClick:b,color:"secondary",className:"text-token-text-secondary",children:s.jsx(v,{id:"Sen69P",defaultMessage:"Add a detail"})}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(J,{disabled:N,onClick:y,color:"secondary",className:"text-token-text-secondary",children:s.jsx(v,{id:"Uqo7UD",defaultMessage:"Reset"})}),s.jsx(J,{disabled:N,onClick:U,children:s.jsx(v,{id:"FVou++",defaultMessage:"Start"})})]})]})]})}function it({dataSchema:e,uiSchema:n,setData:t,readOnly:a,formData:r}){return s.jsx("div",{children:s.jsx(gs,{formData:r,readOnly:a,schema:e,uiSchema:n,onChange:i=>t(i)})})}const lt=2e3,Ce=.4,ct=.45,mt=.2,dt=.1,ut=.25;var P=(e=>(e[e.Running=0]="Running",e[e.Finished=1]="Finished",e[e.Error=2]="Error",e[e.Stopped=3]="Stopped",e[e.Paused=4]="Paused",e))(P||{});function Qt({conversationMessages:e,icon:n,status:t,text:a,estimatedToolDurationMs:r,animationLoopDurationMs:i=lt,shouldPersistAfterFinished:m=!1}){const[l,o]=f.useState(t===0?0:t===1&&!m?7:1),[c,u]=f.useState(0);f.useEffect(()=>{t===2?o(8):t===3?o(9):t===4?o(10):t===1?o(l===2?3:7):t===0&&l===10&&(o(2),u(g=>g+1))},[t]);const x=xt(l);return f.useEffect(()=>{const g=e[0].id;if(x)return oe.addDelayedRenderingMessage(g),()=>{oe.removeDelayedRenderingMessage(g)}},[x]),ve(()=>{F(l)&&u(g=>g+1)},i),l===7&&!m?null:s.jsxs("div",{className:"my-2.5 flex items-center gap-2.5",children:[s.jsx(gt,{icon:n,status:t,uiState:l,estimatedToolDurationMs:r,animationLoopCounter:c,shouldPersistAfterFinished:m,onFillProgressBarAnimationComplete:()=>o(4),onFinishAnimationComplete:()=>{o(5),setTimeout(()=>{o(m?7:6)},dt*1e3)},onHideAnimationComplete:()=>o(7)}),s.jsx(ft,{text:a,uiState:l,animationLoopCounter:c,onEnterAnimationComplete:()=>o(2)})]})}const ie=50;function gt({icon:e,status:n,uiState:t,estimatedToolDurationMs:a,animationLoopCounter:r,shouldPersistAfterFinished:i,onFillProgressBarAnimationComplete:m,onFinishAnimationComplete:l,onHideAnimationComplete:o}){const[c,u]=f.useState(0);ve(()=>{F(t)?u(N=>N+ie):t===10&&u(0)},ie);let x,g,h;F(t)||t===10?(x="running",g=s.jsx(e,{animationLoopCounter:r}),h="bg-transparent"):t===4||t===5||t===7&&i?(x="finished",g=s.jsx(xs,{}),h="bg-brand-purple"):n===2?(x="error",g=s.jsx(ps,{}),h="bg-orange-500"):n===3&&(x="stopped",g=s.jsx(_s,{}),h="bg-gray-300");let y={opacity:0,scale:0,rotate:-180,x:0},b={type:"spring",bounce:.3,duration:ct},C={opacity:0,scale:.6,rotate:0,x:0};t===0?(y={opacity:0,scale:.5,rotate:-180,x:-8},b={type:"spring",bounce:.3,duration:Ce}):t===1?y=!1:t===5&&(C={opacity:0,scale:0,rotate:0,x:0},b={type:"spring",bounce:.3,duration:ut});const k=hs(c,a);return s.jsx("div",{className:"relative h-5 w-5 shrink-0",children:s.jsx(V,{onExitComplete:()=>{t===6&&o()},children:x!=null&&s.jsxs(D.div,{className:T("absolute left-0 top-0 flex h-full w-full items-center justify-center rounded-full text-white",h),initial:y,animate:{opacity:1,scale:1,rotate:0,x:0},exit:C,transition:b,onAnimationComplete:()=>{t===4&&l()},children:[g,(F(t)||t===10)&&s.jsx(fs,{percentage:t===3?100:k,thickness:1.5/23,className:"absolute left-1/2 top-1/2 h-[23px] w-[23px] -translate-x-1/2 -translate-y-1/2 text-brand-purple",backgroundStrokeClassName:"stroke-brand-purple/25 dark:stroke-brand-purple/50",transitionDuration:t===3?`${(100-k)/100*mt}s`:void 0,transitionTimingFunction:t===3?"cubic-bezier(0.55, 0, 1, 1)":void 0,onTransitionEnd:()=>{t===3&&m()}})]},x)})})}function ft({text:e,uiState:n,animationLoopCounter:t,onEnterAnimationComplete:a}){const[r,i]=f.useState(e);f.useEffect(()=>{n===2&&i(e)},[t]),f.useEffect(()=>{F(n)||i(e)},[n,e]);let m={opacity:0,x:0,y:15},l={type:"spring",bounce:.3,opacity:{duration:.15},y:{duration:.3}};n===0?(m={opacity:0,x:-8,y:0},l={type:"spring",bounce:.3,duration:Ce,delay:.15}):n===1&&(m=!1);const o=r??void 0;return s.jsx("div",{className:T("relative h-5 w-full leading-5",n===8||n===9?"text-token-text-tertiary":"text-token-text-secondary"),children:s.jsx(V,{children:o!=null&&s.jsx(D.div,{className:"absolute left-0 top-0 line-clamp-1 overflow-visible",initial:m,animate:{opacity:1,x:0,y:0},exit:{opacity:0,x:0,y:-15},transition:l,onAnimationComplete:()=>{n===0&&a()},children:o},o.toString())})})}function F(e){return e===0||e===2||e===3}function xt(e){return F(e)||e===4||e===5||e===6||e===10}const le=pe.div`group left-0 top-0 mr-1.5 overflow-hidden mt-1 text-start`,pt=({highlightedCommand:e,status:n,children:t,showWorkUserSetting:a=!1,hideOnlyIfNotInteractedWith:r=!1,defaultExpanded:i=!1,onOpenAnalytics:m,onClick:l,...o},c)=>{const u=t!=null||l!=null,[x]=f.useState(a),[g,h]=f.useState(a||i),[y,b]=f.useState(!1),C=n===P.Finished||n===P.Error,k=r?x?!1:!y:!1,N=n===P.Running&&"loading-shimmer";return C&&k?null:u?s.jsxs(s.Fragment,{children:[s.jsx(ce,{ref:c,$canShowWork:!0,...o,children:s.jsx(V,{children:s.jsx(le,{children:s.jsx(D.button,{onClick:U=>{g||m?.(),h(j=>!j),b(!0),l?.(U)},initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:T(N),children:s.jsxs("div",{className:"flex items-center justify-start gap-1",children:[s.jsx("span",{className:"text-start",children:e}),!l&&(g?s.jsx(ys,{className:"icon-md"}):s.jsx(js,{className:"icon-md"}))]})},e?.toString())})})}),s.jsx(V,{children:g&&t&&s.jsx(D.div,{initial:"collapsed",animate:"reveal",exit:"collapsed",variants:{collapsed:{translateY:-20,opacity:0,height:0},reveal:{translateY:0,opacity:1,height:"auto"}},transition:{duration:.3,ease:"easeInOut"},className:"overflow-hidden",children:t})})]}):s.jsx(ce,{ref:c,$canShowWork:!1,...o,children:s.jsx(le,{className:T(N),children:e})})},ce=pe.span`block first:mt-0 relative
${({$canShowWork:e})=>e?"text-token-text-secondary hover:text-token-text-primary my-1.5":"text-token-text-secondary"}`,_t=f.forwardRef(pt),ht=3,yt=.1,me=[0,.26,.4];function jt({nextMessage:e,isLastMessage:n,isRequestActive:t,isLastTurnInConversation:a,clientThreadId:r,turnIndex:i}){let m=n||!e||e&&!X(e);const l=f.useRef(!1),o=Qe(),c=O(r,I.getGizmoId);f.useEffect(()=>{e&&X(e)&&!l.current&&(l.current=!0,bs(o,c))},[e,o,c]);const u=Fe(e),x=Ue(e);e?.id&&Qs(e?.id);const g=[];if(x?.[0]?.type==="navigation"&&e&&g.push(s.jsx(bt,{clientThreadId:r,turnIndex:i,nextMessage:e,isRequestActive:t,isLastTurnInConversation:a,navigationCitation:x[0]},"fast-nav")),m){const h=Ve(u.slice(0,ht).map(b=>b.entries[0].url)),y=t?s.jsxs("div",{className:"flex items-center gap-1",children:[h.map((b,C)=>s.jsx(D.div,{className:T("-ml-1.5 first:ml-0 last:mr-1.5","relative"),initial:{width:C===0?0:6,opacity:0},animate:{width:20,opacity:1},transition:{duration:yt,delay:me[Math.min(C,me.length-1)]},children:s.jsx("div",{className:T("flex h-[22px] w-[22px] items-center overflow-hidden rounded-full","border-2 border-token-main-surface-primary bg-token-main-surface-primary"),children:s.jsx(vs,{url:b,size:32,minSize:16,className:"icon-md rounded-full"})})},b)),s.jsx(v,{id:"jjx8Qg",defaultMessage:"Searching the web"})]}):s.jsx(v,{id:"fssXGM",defaultMessage:"Error while searching"});g.push(s.jsx(_t,{highlightedCommand:y,status:t?P.Running:P.Error},"search-gpt-query"))}return g.length?s.jsx(s.Fragment,{children:g}):null}const bt=({clientThreadId:e,turnIndex:n,nextMessage:t,isRequestActive:a,isLastTurnInConversation:r,navigationCitation:i})=>{const{scrollToHeader:m}=ae("searchSources")??{},l=Be(),o=ae("searchSources"),{openThreadSidebar:c}=B(),{value:u}=_e("756982148");return f.useEffect(()=>{He.addFirstTiming("render.fastNavigation")},[]),f.useEffect(()=>{l&&o&&c({type:"searchSources",scrollToHeader:m,clientThreadId:e,turnIndex:n,messageId:t?.id??""})},[]),f.useEffect(()=>{const x=t,g=x.metadata?.search_source,h=i.domains.map(y=>y.url);Es.logEvent(Q.searchToolRequestTimeToFastNav,e,x.id,{search_source:g,urls:h},()=>{g===ze.InstantQuery&&Ss.logEvent(Q.searchToolPageLoadTimeToFastNav,{message_id:x.id,urls:h,search_source:g})})},[e,t,i]),a&&r&&u?s.jsx(D.div,{initial:{opacity:a?0:1,height:a?0:"auto"},animate:{opacity:1,height:"auto"},children:s.jsx(de,{clientThreadId:e,turnIndex:n,nextMessage:t,navigationCitation:i})}):s.jsx(de,{clientThreadId:e,turnIndex:n,nextMessage:t,navigationCitation:i})},de=({clientThreadId:e,turnIndex:n,nextMessage:t,navigationCitation:a})=>{const{toggleThreadSidebar:r}=B(),{value:i}=_e("756982148"),m=f.useMemo(()=>({clientThreadId:e,turnIndex:n,messageId:t?.id}),[e,n,t?.id]),l=f.useCallback((c,u)=>{r({type:"searchSources",scrollToHeader:u,clientThreadId:e,turnIndex:n,messageId:t?.id??""})},[r,e,n,t?.id]),o=Cs(m);return i?s.jsx(Ws,{navigation:a,onShowSearchResults:l,trackContentReferenceEvent:o}):s.jsx(Ns,{tldr:{type:"tldr",status:"done",display_title:a.domains[0].title,url:a.domains[0].url,matched_text:"",start_idx:0,end_idx:0,page_title:"",breadcrumbs:[a.domains[0].domain],refs:[]},trackContentReferenceEvent:o})},vt=E(()=>S(()=>import("./bjldstj3hm1zvwo5.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]))),Et=E(()=>S(()=>import("./bciaydgpsr3n89ey.js"),__vite__mapDeps([15,1,3,4,16]))),St=E(()=>S(()=>import("./l7fyhq2vzhr5qo8u.js"),__vite__mapDeps([17,1,3,4,11,5,6,8,9]))),Ct=E(()=>S(()=>import("./bpgy4sp6fkh23tho.js"),__vite__mapDeps([18,1,3,4,5,6,19,2,7,20,21,10,9,8,11,12,13,14]))),Nt=E(async()=>()=>null),Tt=E(async()=>(await S(()=>import("./k9h97m9f51i0np00.js").then(n=>n.i),__vite__mapDeps([22,3,1,4,5,6,20,23,24,7,19,25]))).ImageGenMessage),At=E(()=>S(()=>import("./kkp07evd8epclwk3.js"),__vite__mapDeps([26,1,3,4,5,6,8,9,10,11,12,13,14]))),kt=E(()=>S(()=>import("./nlumj7k6brq7dbiz.js"),__vite__mapDeps([27,1,3,4,5,6,8,9,10,11,12,13,14])).then(e=>e.BrowsingMessage)),Mt=E(()=>S(()=>import("./d9r5ag2pz4cjfeg7.js"),__vite__mapDeps([28,1,3,4,5,6])).then(e=>e.SearchResultMessage)),wt=E(()=>S(()=>import("./j4l4xvly8pb3961j.js"),__vite__mapDeps([29,1,3,4,5,6,30,8,9,10,11,12,13,14])).then(e=>e.JITPluginMessage)),Dt=E(()=>S(()=>import("./keaqrviydmxuvxnw.js"),__vite__mapDeps([31,3,1,4,32,5,6,33,34,35,8,9,10,11,12,13,14])).then(e=>e.DataAnalysisMessage)),Ot=E(()=>S(()=>import("./ml3qtquvggrs5386.js"),__vite__mapDeps([36,1,3,4,5,6,37]))),Rt=E(()=>S(()=>import("./obdfg8x0588jk5qt.js"),__vite__mapDeps([38,1,23,3,4,5,6,39,10,9,40,41,42,43,44,45,33,34,35,46,47,48,12,49,50,51,52])).then(e=>e.CoTMessage)),Lt=E(()=>S(()=>import("./i2k9gbmxhhv635qe.js"),__vite__mapDeps([53,1,5,3,4,6,54,55,56,57,58])).then(e=>e.JawboneMessage));function Xt({groupedMessagesToRender:e,allMessages:n,allGroupedMessages:t,clientThreadId:a,isUserTurn:r,isCompletionRequestInProgress:i,isFeedbackEnabled:m,isFinalTurn:l,isFinalUserTurn:o,turnIndex:c,hasActiveRequest:u,onRequestCompletion:x,shouldGrowContainer:g=!0,isParagen:h=!1,renderingView:y="chat"}){const{showDebugConversationTurns:b}=Ts(),[C]=O(a,d=>[d?.mode]),k=Je(a),N=As(),U=t.some(d=>d.type===p.Browsing||d.type===p.RetrievalBrowsing||d.type===p.SearchGPTQuery),j=ks(()=>Ms.count(ws.DEFAULT,"conversation_turn_grouped_messages.attempted_render_missing_type_f959b8c")),R=e.map((d,_)=>{const A=_===t.length-1,Z=_===0?void 0:e[_-1],G=Z?.type,ee=Z?.messages,Te=d&&!X(d.messages[0]),se=U&&Te?null:s.jsx(Ks,{className:"min-h-8",message:d.messages[0],isFeedbackEnabled:m,isFinalUserTurn:o,isCompletionInProgress:A&&i,hasActiveRequest:u,turnIndex:c,clientThreadId:a,isUserTurn:r,prevGroupedMessageType:G,prevGroupedMessages:ee});switch(d.type){case p.Text:case p.MultiText:return d.type===p.Text?s.jsxs(f.Fragment,{children:[se,s.jsx(Is,{isUserTurn:r,message:d.messages[0]})]},"group-"+d.messages[0].id):d.type===p.MultiText?s.jsx(St,{clientThreadId:a,messages:d.messages,isCompletionInProgress:A&&i,isFeedbackEnabled:m,hasActiveRequest:u,prevGroupedMessageType:G,prevGroupedMessages:ee},"multitext-"+(d.messages[0]?.id??_)):d.type;case p.Browsing:case p.RetrievalBrowsing:{const M=C!=null&&[z.GizmoInteraction,z.GizmoMagicCreate,z.GizmoTest].includes(C.kind),w=k?Ls(k):!1;return s.jsx(kt,{messages:d.messages,isRequestActive:u,isLastMessageInTurn:A,isUsingGizmo:M,isUsingSnorlax:w,isRetrieval:d.type===p.RetrievalBrowsing},"browsing-"+(d.messages[0]?.id??_))}case p.SearchGPTQuery:{const M=t.slice(_+1).find(({type:H})=>H===p.Text),w=M?.type===p.Text?M:void 0;return s.jsx(jt,{clientThreadId:a,turnIndex:c,isRequestActive:u,isLastMessage:A,isLastTurnInConversation:l,nextMessage:w?.messages[0]},"searchquery-"+(d.messages[0]?.id??_))}case p.a8km123:{if(!d.messages.some(w=>w.metadata?.model_slug==="o1-pro")){const w=Ke(n,H=>H.author.role===xe.Assistant&&H.recipient==="all");return s.jsx(Rt,{clientThreadId:a,turnIndex:c,isStreaming:(A||w<_)&&i,messages:d.messages},"sum-"+(d.messages[0]?.id??_))}return s.jsx(Ot,{messages:d.messages,isStreaming:A&&i,isLastMessage:A,clientThreadId:a,currentGroupedMessageIndex:_,turnIndex:c},"sum-"+(d.messages[0]?.id??_))}case p.f959b8c:return j(),null;case p.is_loading_message:return A&&i?s.jsx(Rs,{},"loading-message-"+_):null;case p.c12k321:return null;case p.l1p9k3u:return null;case p.b1de6e2_c:return s.jsx(rt,{messages:d.messages,clientThreadId:a,isLastMessage:A},"b1de6e2-"+(d.messages[0]?.id??_));case p.b1de6e2_s:return s.jsx(tt,{messages:d.messages,clientThreadId:a},"b1de6e2_s-"+(d.messages[0]?.id??_));case p.b1de6e2_d:return null;case p.b1de6e2_rm:return s.jsx(Os,{messages:d.messages,clientThreadId:a,renderingView:y,children:se},"b1de6e2_rm-"+(d.messages[0]?.id??_));case p.de1d73e:if(N){const M=_+1<t.length?t[_+1]:void 0;return s.jsx(Lt,{clientThreadId:a,currentGroupedMessage:d,nextMessage:M&&M.type===p.Text?M.messages[0]:void 0,isLastMessage:A,isRequestActive:u},"jawbone-"+(d.messages[0]?.id??_))}else return null;case p.ParallelBrowsing:return s.jsx(At,{messages:d.messages},"parallel-"+(d.messages[0]?.id??_));case p.CodeInterpreter:return s.jsx(Dt,{messages:d.messages,isRequestActive:u,clientThreadId:a},"ada-"+(d.messages[0]?.id??_));case p.JITPlugin:return s.jsx(wt,{messages:d.messages,clientThreadId:a,isLastTurnInConversation:l,onRequestCompletion:x},"jit-"+(d.messages[0]?.id??_));case p.t2uay3k:return s.jsx(Tt,{messages:d.messages,clientThreadId:a,disableClickThru:h},"t2uay3k-"+(d.messages[0]?.id??_));case p.Dalle:return s.jsx(Ct,{messages:d.messages,clientThreadId:a,disableClickThru:h},"dalle-"+(d.messages[0]?.id??_));case p.GizmoEditor:return s.jsx(vt,{messages:d.messages},"gizmo-editor-"+(d.messages[0]?.id??_));case p.oiw209h:return s.jsx(Nt,{messages:d.messages,clientThreadId:a},"oiw209h-"+(d.messages[0]?.id??_));case p.Canmore:return s.jsx($s,{messages:d.messages,allGroupedMessages:e,isFinalTurn:l,isRequestActive:u,clientThreadId:a,isUserTurn:r},"canmore-"+(d.messages[0]?.id??_));case p.Oboe:return null;case p.Debug:return b?s.jsx(Et,{message:d.messages[0]},"debug-"+d.messages[0].id):null;case p.SearchResult:return s.jsx(Mt,{messages:d.messages},"search-result-"+(d.messages[0]?.id??_));default:Ds(d.type)}}),Ne=Bs();return s.jsx("div",{className:T({"flex max-w-full flex-col":!0,"flex-grow":g}),children:s.jsx(We,{name:"GroupedMessages",fallback:It,children:r?R:s.jsxs(Ps,{isDisabled:r||!l||!i,children:[Fs()&&l&&s.jsx(Us,{isStreaming:i,debug:Ne}),R]},n[0]?.id)})})}function It(){return s.jsx(Vs,{type:"danger",children:s.jsx(v,{id:"5eGo3w",defaultMessage:"Unable to display this message due to an error."})})}export{Xt as C,de as F,P as T,_t as a,Qt as b};
//# sourceMappingURL=ca8xspsebes9twfc.js.map
