import{k as ne,r as C,d as ie,j as e,M as c,a8 as le,f as T,a as $,u as de,b as me}from"./msupklk377u8vx8o.js";import{o3 as Z,o4 as ce,o5 as ue,o6 as fe,o7 as ge,ao as K,b$ as he,fx as J,o8 as Me,o9 as xe,oa as ve,jz as S,ob as X,ex as ye,mo as pe,ev as _,bH as je}from"./idf4u2jy0wx0pvap.js";import{c$ as be,aV as we,aW as Ce,aX as ke,g$ as Se,h0 as Re,aR as _e,h1 as Te,eH as Ee,an as k,c as D,m as ee,B as se,k as re,l as F,b as te,f as Ne,F as qe}from"./i3bl95k8z8nuf4dv.js";import{G as Ge}from"./gd7xfxa2yqt151v4.js";var E,P;function Ie(){if(P)return E;P=1;var s=be(),t=we(),a="[object RegExp]";function o(n){return t(n)&&s(n)==a}return E=o,E}var N,A;function Ue(){if(A)return N;A=1;var s=Ie(),t=Ce(),a=ke(),o=a&&a.isRegExp,n=o?t(o):s;return N=n,N}var q,W;function ze(){if(W)return q;W=1;var s=Se(),t=s("length");return q=t,q}var G,H;function De(){if(H)return G;H=1;var s="\\ud800-\\udfff",t="\\u0300-\\u036f",a="\\ufe20-\\ufe2f",o="\\u20d0-\\u20ff",n=t+a+o,r="\\ufe0e\\ufe0f",i="["+s+"]",u="["+n+"]",f="\\ud83c[\\udffb-\\udfff]",g="(?:"+u+"|"+f+")",h="[^"+s+"]",p="(?:\\ud83c[\\udde6-\\uddff]){2}",w="[\\ud800-\\udbff][\\udc00-\\udfff]",m="\\u200d",M=g+"?",b="["+r+"]?",x="(?:"+m+"(?:"+[h,p,w].join("|")+")"+b+M+")*",d=b+M+x,j="(?:"+[h+u+"?",u,p,w,i].join("|")+")",l=RegExp(f+"(?="+f+")|"+j+d,"g");function v(y){for(var R=l.lastIndex=0;l.test(y);)++R;return R}return G=v,G}var I,Q;function Le(){if(Q)return I;Q=1;var s=ze(),t=Z(),a=De();function o(n){return t(n)?a(n):s(n)}return I=o,I}var U,V;function Be(){if(V)return U;V=1;var s=Re(),t=ce(),a=Z(),o=_e(),n=Ue(),r=Le(),i=ue(),u=Te(),f=Ee(),g=30,h="...",p=/\w*$/;function w(m,M){var b=g,x=h;if(o(M)){var d="separator"in M?M.separator:d;b="length"in M?u(M.length):b,x="omission"in M?s(M.omission):x}m=f(m);var j=m.length;if(a(m)){var l=i(m);j=l.length}if(b>=j)return m;var v=b-r(x);if(v<1)return x;var y=l?t(l,0,v).join(""):m.slice(0,v);if(d===void 0)return y+x;if(l&&(v+=y.length-v),n(d)){if(m.slice(v).search(d)){var R,oe=y;for(d.global||(d=RegExp(d.source,f(p.exec(d))+"g")),d.lastIndex=0;R=d.exec(oe);)var B=R.index;y=y.slice(0,B===void 0?v:B)}}else if(m.indexOf(s(d),v)!=v){var O=y.lastIndexOf(d);O>-1&&(y=y.slice(0,O))}return y+x}return U=w,U}var Oe=Be();const Fe=ne(Oe),Pe=s=>C.createElement("svg",{width:24,height:24,viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},C.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6 1C3.23858 1 1 3.23858 1 6C1 8.76142 3.23858 11 6 11C8.76142 11 11 8.76142 11 6C11 3.23858 8.76142 1 6 1ZM6.75 3.75C6.75 4.16421 6.41421 4.5 6 4.5C5.58579 4.5 5.25 4.16421 5.25 3.75C5.25 3.33579 5.58579 3 6 3C6.41421 3 6.75 3.33579 6.75 3.75ZM6.75 6C6.75 5.58579 6.41421 5.25 6 5.25C5.58579 5.25 5.25 5.58579 5.25 6V8C5.25 8.41421 5.58579 8.75 6 8.75C6.41421 8.75 6.75 8.41421 6.75 8V6Z",fill:"currentColor"})),Ae=91,L=100;function We(s){return s<L?"bg-[#fcf6e0] text-yellow-500 dark:bg-yellow-600 dark:text-yellow-100":"bg-[rgba(229,76,66,0.16)] text-[#DC2626] dark:bg-[rgba(202,58,49,0.16)] dark:text-[#DC2626]"}function ae(s){return ge()&&s!=null&&s>=Ae}function He({memoryFullPct:s,className:t,children:a,showInfoLabel:o,onManageMemories:n}){return ae(s)?e.jsx("div",{className:D("border-token-border-default rounded-lg border p-1 text-sm",t),children:e.jsxs(le.div,{className:D("flex items-center overflow-hidden rounded-sm px-2 py-1.5 whitespace-nowrap",We(s)),initial:{width:0},animate:{width:`${s}%`},transition:{duration:.5},children:[e.jsx(c,{id:"6D2etG",defaultMessage:"{memoryFullPct}% full",values:{memoryFullPct:s}}),a,o&&e.jsx(K,{interactive:!0,label:s<L?e.jsx("div",{className:"whitespace-normal",children:e.jsx(c,{id:"gxY4wi",defaultMessage:"ChatGPT's almost out of space for new saved memories. <memoryModalLink>Manage saved memories</memoryModalLink> to create more space.",values:{memoryModalLink:i=>e.jsx("a",{href:"#",className:"cursor-pointer underline",onClick:u=>{u.preventDefault(),n?.()},children:i})}})}):e.jsx("div",{className:"whitespace-normal",children:e.jsx(c,{id:"1JxMf3",defaultMessage:"ChatGPT's out of space for saved memories. <memoryModalLink>Manage saved memories</memoryModalLink> to create more space.",values:{memoryModalLink:i=>e.jsx("a",{href:"#",className:"cursor-pointer underline",onClick:u=>{u.preventDefault(),n?.()},children:i})}})}),children:e.jsx(Pe,{className:"icon-sm text-token-text-secondary ms-1"})})]})}):null}function Qe({memoryFullPct:s,className:t}){const a=ae(s),o=fe(),n=ie();if(!a)return null;o&&k.logEventWithStatsig("Memory Full Warning Upsell Shown","chatgpt_memory_full_warning_upsell_shown_memory_modal");const r=e.jsx("a",{href:"#",className:"cursor-pointer underline",onClick:i=>{i.preventDefault(),k.logEventWithStatsig("Memory Full Warning Upsell Clicked","chatgpt_memory_full_warning_upsell_clicked_memory_modal"),he(n,"MemoryUsageWarning Memory Modal Upsell")},children:e.jsx(c,{id:"djYoOr",defaultMessage:"ChatGPT Plus"})});return e.jsxs("div",{className:D("flex flex-col gap-2",t),children:[e.jsx(He,{memoryFullPct:s}),e.jsx("div",{className:"text-token-text-secondary ps-3 text-sm",children:s<L?o?e.jsx(c,{id:"2Gnp5W",defaultMessage:"<strong>Almost full.</strong> Once full, new memories won't be saved. You can remove existing memories to make room, or get 4x more space with {upsellLink}.",values:{strong:i=>e.jsx("strong",{children:i}),upsellLink:r}}):e.jsx(c,{id:"SnInO0",defaultMessage:"<strong>Almost full.</strong> Once full, new memories won't be saved. You can remove existing memories to make room.",values:{strong:i=>e.jsx("strong",{children:i})}}):o?e.jsx(c,{id:"VfmXw+",defaultMessage:"<strong>You’re out of space.</strong> Remove existing memories to make room for ChatGPT to save new memories, or get 4x more space with {upsellLink}.",values:{strong:i=>e.jsx("strong",{children:i}),upsellLink:r}}):e.jsx(c,{id:"fSy74S",defaultMessage:"<strong>You’re out of space.</strong> Remove existing memories to make room for ChatGPT to save new memories.",values:{strong:i=>e.jsx("strong",{children:i})}})})]})}function Y({description:s,onClose:t,onConfirm:a}){const o=T();return e.jsx(re,{testId:"modal-confirm-reset-memory",isOpen:!0,onClose:t,type:"success",title:o.formatMessage({id:"MemoriesModal.resetModalTitle",defaultMessage:"Are you sure?"}),description:s,primaryButton:e.jsx(F.Button,{title:o.formatMessage({id:"MemoriesModal.resetModalConfirm",defaultMessage:"Clear memory"}),color:"danger",onClick:a,"data-testid":"confirm-reset-memories-button"}),secondaryButton:e.jsx(F.Button,{title:o.formatMessage({id:"MemoriesModal.resetModalCancel",defaultMessage:"Cancel"}),color:"secondary",onClick:t})})}function Ve({onReset:s,gizmoId:t,memoryName:a}){const[o,n]=C.useState(!1),r=T(),i=ee(),u=J(),f=async()=>{k.logEvent("Memory Manage Reset Button Confirmed");try{await te.safeDelete("/settings/clear_account_user_memory",{requestBody:{gizmo_id:t}}),i.success(r.formatMessage({id:"ResetMemoriesButton.resetSuccess",defaultMessage:"Memory cleared."})),s?.(),n(!1)}catch{i.danger(r.formatMessage({id:"ResetMemoriesButton.resetFailed",defaultMessage:"Failed to clear memory."}))}};return e.jsxs(e.Fragment,{children:[e.jsx(se,{color:"danger-outline",onClick:()=>{k.logEvent("Memory Manage Reset Button Clicked"),n(!0)},"data-testid":"reset-memories-button",children:t?e.jsx(c,{id:"ResetMemoriesButton.resetGizmo",defaultMessage:"Clear this GPT's memory"}):e.jsx(c,{id:"ResetMemoriesButton.resetChatGPT",defaultMessage:"Delete all"})}),o&&(u?e.jsx(Y,{description:r.formatMessage({id:"MemoriesModal.resetGizmoModalDescriptionUpdated",defaultMessage:"Deleting your saved memories means {name} may not remember this information going forward. To fully remove this information from {name}'s memory, please delete any related chats. <link>Learn more</link>"},{name:a,link:g=>e.jsx("a",{className:"underline",href:"https://help.openai.com/en/articles/8983136-what-is-memory",children:g})}),onClose:()=>n(!1),onConfirm:f}):e.jsx(Y,{description:r.formatMessage({id:"MemoriesModal.resetGizmoModalDescription",defaultMessage:"{name} will forget everything it has remembered from your chats. This cannot be undone."},{name:a}),onClose:()=>n(!1),onConfirm:f}))]})}function Ye({gizmo:s,memory:t}){const a=T(),o=ee(),n=$(),{mutate:r,isPending:i}=me({mutationFn:async h=>{const{success:p}=await te.safeDelete("/memories/{memory_id}",{parameters:{path:{memory_id:h}},requestBody:{gizmo_id:s?.id}});if(!p)throw new Error("An error occurred while deleting the memory")},onSettled:()=>{n.invalidateQueries({queryKey:X(s?.id)})},onError:()=>{o.danger(a.formatMessage({id:"MemoriesModal.deleteFailed",defaultMessage:"Failed to forget memory"}),{id:"memoryDeleteFailed"})}}),[u,f]=C.useState(!1),g=a.formatMessage({id:"N0czuB",defaultMessage:"Remove"});return e.jsxs(e.Fragment,{children:[e.jsxs(S.Row,{disabled:i,children:[e.jsx(S.Cell,{children:e.jsx("div",{className:"py-2 whitespace-pre-wrap",children:t.content})}),e.jsx(S.Cell,{textAlign:"right",children:e.jsx(S.Actions,{children:e.jsx("button",{onClick:()=>{k.logEvent("Memory Manage Modal Memory Delete Clicked"),f(!0)},"aria-label":g,className:"text-token-text-tertiary hover:text-token-text-secondary",children:e.jsx(K,{className:"leading-none",label:g,side:"top",children:e.jsx(ye,{className:"icon-sm"})})})})})]}),u&&e.jsx(pe,{isOpen:!0,primaryButtonColor:"danger",title:g,confirmText:a.formatMessage({id:"fCn0ar",defaultMessage:"Forget"}),onConfirm:()=>{k.logEvent("Memory Manage Modal Memory Delete Confirmed"),r(t.id),f(!1)},onClose:()=>{f(!1)},children:e.jsx(c,{id:"j2cZHW",defaultMessage:'Remove "{title}" from {name}’s saved memories. This can’t be undone. <link>Learn more</link>',values:{name:s?.name??"ChatGPT",title:e.jsx("strong",{children:Fe(t.content,{length:130,omission:"..."})}),link:h=>e.jsx("a",{href:"https://help.openai.com/en/articles/8590148-memory-faq",target:"_blank",className:"underline",rel:"noreferrer",children:h})}})})]})}function $e({selectedGizmoId:s,onSelect:t,items:a}){const o=a.find(r=>r.id===s);function n(r){return e.jsx(Ge,{isFirstParty:r.id===void 0,src:r.iconUrl??null,className:"icon-md"})}return e.jsx("div",{className:"border-token-border-medium mb-2 inline-flex rounded-md border",children:e.jsxs(_.Root,{children:[e.jsx(_.Trigger,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[o?e.jsxs(e.Fragment,{children:[n(o),e.jsx("span",{className:"text-token-text-primary",children:o.name})]}):e.jsx(c,{id:"MemoriesModal.unknownGizmo",defaultMessage:"Unknown GPT"}),e.jsx(je,{className:"icon-sm text-token-text-tertiary"})]})}),e.jsx(_.Portal,{children:e.jsx(_.Content,{children:a.map(r=>e.jsxs(_.Item,{className:"flex items-center gap-3",onClick:()=>{t(r.id)},children:[n(r),r.name]},r.id))})})]})})}const z=qe.div`flex h-full items-center justify-center pb-8 text-sm text-token-text-tertiary rounded-lg border border-token-border-default`;function Ze({onClose:s,initialGizmoId:t}){const a=T(),o=$(),n=Me(),[r,i]=C.useState(t),u=xe(),f=J();C.useEffect(()=>{k.logEvent("Memory Modal Shown")},[]);const{data:g,isLoading:h,isError:p,refetch:w}=ve(r,!0,n),m=g?.memories,{data:M,refetch:b}=de({queryKey:["memory_gizmos"],queryFn:()=>Ne.getGizmosWithMemory(),refetchOnMount:"always"}),x=[{id:void 0,name:"ChatGPT",iconUrl:null},...M?.items.map(({gizmo:l})=>({id:l.id,name:l.display.name,iconUrl:l.display.profile_picture_url}))??[]],d=x.find(l=>l.id===r);C.useEffect(()=>{!h&&!p&&r!==void 0&&(!m||m.length===0)&&i(void 0)},[h,p,m,r]);let j;return h?j=e.jsx(z,{children:e.jsx(c,{id:"MemoriesModal.loading",defaultMessage:"Loading..."})}):p?j=e.jsx(z,{children:e.jsxs("div",{className:"max-w-sm text-center",children:[e.jsx("div",{className:"mb-4 text-red-500",children:e.jsx(c,{id:"MemoriesModal.somethingWentWrong",defaultMessage:"Something went wrong..."})}),e.jsx("div",{children:e.jsx(se,{color:"secondary",onClick:()=>{w()},children:e.jsx(c,{id:"MemoriesModal.retry",defaultMessage:"Retry"})})})]})}):!m||m.length===0?j=e.jsx(z,{children:e.jsx("div",{className:"max-w-sm text-center",children:n?e.jsx(c,{id:"MemoriesModal.noMemories.1",defaultMessage:"As you chat with {name}, the details and preferences it saves will be shown here.",values:{name:d?.name??"ChatGPT"}}):e.jsx(c,{id:"MemoriesModal.noMemoriesAndDisabled",defaultMessage:"Memory is disabled. ChatGPT won't use or save memories."})})}):j=e.jsx(S.Root,{className:"h-full",size:"compact",bordered:!0,children:e.jsx(S.Body,{children:m.map(l=>e.jsx(Ye,{gizmo:d?{id:d.id,name:d.name}:void 0,memory:l},l.id))})}),e.jsxs(re,{testId:"modal-memories",isOpen:!0,onClose:s,size:"custom",className:"max-w-5xl",type:"success",title:a.formatMessage({id:"MemoriesModal.title",defaultMessage:"Saved memories"}),description:e.jsx("div",{className:"text-token-text-secondary",children:f?a.formatMessage({id:"MemoriesModal.description",defaultMessage:"ChatGPT tries to remember most of your chats, but it may forget things over time. Saved memories are never forgotten. <link>Learn more</link>"},{link:l=>e.jsx("a",{href:"https://help.openai.com/en/articles/8983136-what-is-memory",target:"_blank",rel:"noopener noreferrer",className:"underline",children:l})}):a.formatMessage({id:"MemoriesModalFree.description",defaultMessage:"ChatGPT remembers useful details about you and your preferences so it can be more helpful. <link>Learn more</link>"},{link:l=>e.jsx("a",{href:"https://help.openai.com/en/articles/8983136-what-is-memory",target:"_blank",rel:"noopener noreferrer",className:"underline",children:l})})}),showCloseButton:!0,children:[u&&x.length>1&&e.jsx("div",{className:"mb-4",children:e.jsx($e,{selectedGizmoId:r,items:x,onSelect:l=>{o.invalidateQueries({queryKey:X(l)}),i(l)}})}),e.jsx(Qe,{memoryFullPct:g?.memoryFullPct,className:"mb-5"}),e.jsx("div",{className:"h-[24rem]",children:j}),e.jsx("div",{className:"mt-5 flex justify-end",children:e.jsx(Ve,{onReset:()=>{w(),b(),r&&i(void 0)},gizmoId:r,memoryName:d?.name??"ChatGPT"})})]})}const ss=Object.freeze(Object.defineProperty({__proto__:null,default:Ze},Symbol.toStringTag,{value:"Module"}));export{He as M,Ze as a,ss as b,ae as u};
//# sourceMappingURL=h7q75xhoe3ilx3kh.js.map
