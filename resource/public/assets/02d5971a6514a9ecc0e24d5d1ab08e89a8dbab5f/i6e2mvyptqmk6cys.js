const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/igoc4yhxv10ch5gr.js","assets/msupklk377u8vx8o.js","assets/idf4u2jy0wx0pvap.js","assets/i3bl95k8z8nuf4dv.js","assets/root-en2soewk.css","assets/conversation-small-irmw3ffz.css","assets/cx50bzj9gti9k1eh.js","assets/jy1u8exw8iz2slve.js","assets/eyf2nwgexpz6pjnh.js","assets/etqfvs5ggajp1a11.js","assets/ftpfjx7bripqt5mr.js","assets/l4zbgkg566u66cq3.js","assets/bgffthat6lwvaj3l.js","assets/eo5uot0b1uoupak4.js","assets/gy64pge8qevmvg7e.js","assets/itm96x5skyrm0csf.js","assets/hwl3hzno2kq7obfl.js","assets/hmii3551qscelikg.js","assets/i3xeaua08fnq6vw7.js","assets/mg22stn4exi88qee.js","assets/gjp4gv474prvqiwp.js","assets/kwmncs5inhubx058.js","assets/hgzals0lml4o26vg.js","assets/galv4529ourghuwf.js","assets/hskvlm4fdvagz0fn.js","assets/bk8slwxjkdlmxjxm.js","assets/bpz5dug6lzivjns5.js","assets/bh8emud9m2ohtvi0.js","assets/fii0gwkgtas4sckd.js","assets/k4oexpwbiepmd1cd.js","assets/np9w83f07wa6edf5.js","assets/gc51ish3otzvnj1w.js","assets/gd7xfxa2yqt151v4.js","assets/igftvtdft8b4phs3.js","assets/o2t4lszmsavslsdu.js","assets/gwmfzjrffpu4d2tx.js","assets/onklb7txlsriyspd.js","assets/btagl6w1gub4aw61.js","assets/ddns1mlzlemxsi2y.js","assets/jn0uteih7mzei1kq.js","assets/mzkxlhrlmxhntkvn.js","assets/gcz2j2o5g6y0kzog.js","assets/o2zmtgrin840wbeg.js","assets/ghc7uc524xjjwk4f.js","assets/ot1k26387o73dpla.js","assets/ju1ci02jioqmoctd.js","assets/o02jebqcoqg6cyor.js","assets/m89x2zftpo6hrypr.js","assets/n6gxahppsdxdf9e1.js","assets/jm9661216xi1kol5.js","assets/iaogn9yqy8ycbrvh.js","assets/bjlvmvwbynia41h5.js","assets/en1ee50tqvrjf3xp.js","assets/n5fowtub43nwjawh.js","assets/lvc34l5biwha9w7t.js","assets/hstsg1tnsukf0vw2.js","assets/ev39bkx1q3tpviat.js","assets/l79p1rsauk0lwxt6.js","assets/etnbads10edajuhl.js","assets/e38jtoe1pk39q0qz.js","assets/ri6m584lp3ktlrkb.js","assets/fzi43ai5glir5682.js","assets/f8brziwaxja17w8l.js","assets/m2labkp4eli82luk.js","assets/ikpwdaspyqzs2oop.js","assets/k0gfwt82z96kzlbw.js","assets/b8sq4gagi5vun041.js"])))=>i.map(i=>d[i]);
import{dK as ae,bM as Fe,ax as ne,bQ as de,f as Oe,cN as Be,aw as Re,cY as Ks,b1 as Zs,bs as te,dP as Xs,cG as We,cd as Js,bJ as De,bK as et,h6 as st,bW as tt,ce as it,cj as at,ck as nt,g as He,m as ie,bF as O,d as $e,bj as ce,k as Ve,B as fe,F as qe,c as re,D as rt,dW as gs,bI as Qe,cM as Se,an as fs,s as Ye,bO as he,cX as ot,bZ as lt,en as hs,v as xs,_ as vs,fK as ct,cE as xe,am as dt,fP as js,f7 as ut,bn as mt,gZ as pt,bm as gt,bS as ft,al as ss,ak as ts,gQ as ht,cI as xt,cJ as vt,ej as jt,fJ as yt,gM as bt,ew as Mt}from"./i3bl95k8z8nuf4dv.js";import{R as ys,r as c,j as e,f as H,a as bs,g as oe,M as m,d as ue,ah as wt,a9 as Pt,a8 as Ms,D as Tt,o as kt}from"./msupklk377u8vx8o.js";import{dO as St,o$ as _t,ed as W,nm as ws,cn as Ps,pG as Ts,b as ks,be as ye,bf as Ss,eY as Ke,eG as It,eo as Nt,a3 as Ct,em as Le,bF as R,ep as Me,eq as ee,cg as _s,eB as Ze,eJ as ve,ez as je,pH as Gt,hx as Is,ey as At,ck as Ns,cl as Rt,h as Lt,pI as zt,pJ as Et,eI as Cs,ev as J,ag as Gs,nZ as Ut,ex as Ft,jH as se,aG as Ot,pK as ze,er as Bt,eC as Wt,eD as Dt,ai as Ht,ea as As,ef as $t,eb as Rs,dg as Vt,pL as qt,ee as Qt,eV as Yt,eh as Kt,df as Ee,ei as Zt,nh as Xt,n1 as is,nl as _e,nk as Jt,hL as as,pM as Ls,pN as ei,eN as zs,pO as si,pP as ti,ng as ii,pQ as ai,eO as ni,j4 as ri,pR as ns,ao as Es,c6 as oi,T as li,fQ as ci,pS as di,U as rs,e_ as ui,pT as mi,e as pi,eW as gi,ml as os,O as fi,pU as hi,pV as xi,d as vi,pW as ji,pX as ls,pY as cs,pZ as yi,r as bi,k_ as Mi,jI as ds,F as wi}from"./idf4u2jy0wx0pvap.js";import{G as Pi,A as le,M as Us,a as Ti,b as us,s as ki,S as Si,c as _i,g as Ii,d as Ni}from"./ghc7uc524xjjwk4f.js";import{f as Ci}from"./m89x2zftpo6hrypr.js";import{a as Gi}from"./k4oexpwbiepmd1cd.js";import{M as Fs}from"./n6gxahppsdxdf9e1.js";import{u as Os}from"./hwl3hzno2kq7obfl.js";import{i as Ue}from"./etnbads10edajuhl.js";import{S as Ai}from"./hskvlm4fdvagz0fn.js";import{G as Bs}from"./gd7xfxa2yqt151v4.js";import{G as Ri}from"./e38jtoe1pk39q0qz.js";import{i as Li}from"./o02jebqcoqg6cyor.js";import{S as zi}from"./ri6m584lp3ktlrkb.js";import{u as Ws}from"./hstsg1tnsukf0vw2.js";import{h as Ei}from"./jm9661216xi1kol5.js";import{F as Y,a as K,b as Ie,c as Ui,G as Fi}from"./gcz2j2o5g6y0kzog.js";import{G as Oi}from"./fzi43ai5glir5682.js";import{b as Bi}from"./f8brziwaxja17w8l.js";import{b as Wi}from"./fii0gwkgtas4sckd.js";function Di(s,t){const i=de(s),a=ne.getTree(i),n=[];let r=ne.getCurrentNode(i);for(;r!=null&&(t==null||r.id!==t);)n.unshift(r.message),r=r.parentId!==""?a.getNodeByIdOrMessageId(r.parentId):void 0;return n}function Hi(s){return s.filter(a=>a.recipient==="gizmo_editor.update_behavior").flatMap(a=>a.content.content_type==="text"?a.content.parts:a.content.content_type==="code"?[a.content.text]:[]).map(a=>JSON.parse(a)).reduce((a,n)=>({...a,...n}),{})}async function $i(s){let t;for(const i of s)if(i.author.name==="gizmo_editor.generate_profile_pic"){const a=Xs.getImageAssetPointers(i);a.length>0&&(t=a.at(-1))}if(t!=null){const i=St(t.asset_pointer),a=await Oe.getFileDownloadLink(i);if(a.status===Be.Success)return{id:i,permalink:a.download_url}}}async function Vi(s,t,i,a){const n=Di(t,a),r=Hi(n);let l=await $i(n);if(Ue(r)&&l==null)return;const{name:p,context:d,description:x,profile_pic_file_id:o,prompt_starters:y}=r;if(o!=null)try{const u=await Oe.getFileDownloadLink(o,s.id);u.status===Be.Success&&(l={id:o,permalink:u.download_url})}catch(u){Re.addError(new Error("Error while retrieving profile pic in update",{cause:u})),i.warning("Something went wrong updating your GPT's profile picture.",{duration:3})}const v={name:typeof p=="string"?p:void 0,description:typeof x=="string"?x:void 0,instructions:typeof d=="string"?d:void 0,promptStarters:Array.isArray(y)?y:void 0,profilePictureId:l?.id,profilePictureUrl:l?.permalink};return Ks(v,u=>u!=null)}function qi(s){const t=new Set;for(const d of s.tools)t.add(d.type);const i=s.name??"",a=s.description??"",n=s.instructions??"",r=Array.from(t).join(","),l=i===""&&a===""&&n==="",p=s.profilePictureUrl!=null;return l?`The GPT you are about to has the following abilities: ${r}.`:`This is the GPT's current set of fields:

name: ${i}

description: ${a}

context: ${n}

abilities: ${r}

${p?"The GPT has a profile picture.":"This GPT does not have a profile picture. You must generate a profile picture when you next update your behavior."}
`}const Qi=10;function Ds(s,t){const i=s.current,a=t.current;if(Fe(i,a))return;const n={};i.name!==a?.name&&(n.name=i.name),(i.description??"")!==(a?.description??"")&&(n.description=i.description??""),i.instructions!==(a?.instructions??"")&&(n.context=i.instructions??"");const r=new Set(a?.files?.map(o=>o.file_id)??[]),l=new Set(i.files?.map(o=>o.file_id)??[]),p=(i.files??[]).filter(o=>!r.has(o.file_id)),d=(a?.files??[]).filter(o=>!l.has(o.file_id));if(Ue(n)&&p.length===0&&d.length===0)return;const x=[];if(!Ue(n)){const o=`Explicitly update the GPT's behavior to the following exact fields:

    ${JSON.stringify(n,null,2)}

    "Do not call update_behavior yet. Instead, use these updated fields as the GPT's current behavior, and in the next call to update_behavior, incorporate these changes."
    `;x.push(ae(o))}if(d.length>0&&x.push(ae(`The user has removed the following files from the GPT. You can no longer reference these files: ${d.map(o=>o.file_id).join(", ")}`)),p.length>0){const o=p.slice(0,Qi);x.push(ae(`The user is adding these files to the GPT. The GPT may reference these files. The file IDs are: ${o.map(y=>y.file_id).join(", ")}`,{attachments:o.map(y=>({id:y.file_id,name:y.name,size:y.size}))}))}return x}function Yi(s){if(s.length===0)return;const t=`The user is uploading files in their next message. If you need to reference these in calls to update_behavior, you will use the following File ID(s), in order: ${s.map(i=>`"${i.fileId}"`).join(", ")}`;return[ae(t)]}function Ki(s){const t="Remember, you should be calling either update_behavior or generate_profile_pic after most messages from the user. Your personality should be neutral and separate from the GPT you are creating.";if(!ne.findNode(de(s),a=>a.message.content.content_type==="text"&&a.message.content.parts[0]===t))return[ae(t)]}function Zi(s,t){Zs.initThread(s,{kind:te.GizmoMagicCreate,gizmo_id:void 0,behavior_overrides:t});const i=Os(s);return async(n,r,l,p)=>{i({sourceEvent:n,promptMessage:ae(p),prependMessages:Ds(r,l),completionMetadata:{conversationMode:{kind:te.GizmoMagicCreate,gizmo_id:r.current.id,behavior_overrides:t}}})}}const Xi="Generate a new profile picture for this GPT using gizmo_editor generate_profile_pic. Do not prompt the user for any clarification. Do not send extra text outside of the tool function call. DO NOT CALL update_behavior or otherwise update GPT behavior in your response.";function Ji(s,t){c.useEffect(()=>{ne.findNode(de(s),a=>st(a.message)||a.message.author.role===tt.System&&a.message.content.content_type===it.Text)||De(s,a=>{at.updateTree(a,(n,r)=>{const l=n.findNode(p=>p.message.clientMetadata?.isPlaceholderTemplateAssistantWelcomeMessage===!0,r);return l&&(l.id===r&&(r=n.rootId),n.deleteNode(l.id)),t?n.addMessageNode(r,nt(t,void 0,{isPlaceholderTemplateAssistantWelcomeMessage:!0})):r})})},[s,t])}function ea(s,t,i){ks(s,{kind:te.GizmoMagicCreate,gizmo_id:t.id,behavior_overrides:i}),c.useEffect(()=>{De(s,n=>{n.mode={kind:te.GizmoMagicCreate,gizmo_id:t.id,behavior_overrides:et(i)}})},[s,t.id,i]);const[a]=c.useState(()=>{const n=t.id==null,r=t.id!=null&&t.name!==""&&t.description!=null&&t.instructions!==""&&t.profilePictureUrl!=null;return n?`Hi! I'll help you build a new GPT. You can say something like, "make a creative who helps generate visuals for new products" or "make a software engineer who helps format my code."

What would you like to make?`:r?`Welcome back! Is there anything ${t.name} should be doing better? Anything you'd like to change?`:"You're back! Let's continue where we left off..."});Ji(s,a)}function sa({gizmoEditorData:s,updateGizmo:t,clientThreadId:i,gizmoEditorDataRef:a,magicMakerBehaviorOverrides:n,magicMakerConversationGizmoEditorDataRef:r,requireGizmoId:l}){const p=c.useRef(l);p.current=l;const d=c.useMemo(()=>({gizmoEditorData:s,gizmoId:s.id,mode:"magic",behaviorOverrides:n,getGizmoId:p.current}),[s,n]),x=_t(y=>y.files.filter(v=>v.status===W.Ready&&v.gizmoId!=null)),o=c.useCallback(y=>{if(t(v=>({...v,files:[...v.files??[],...We(x.map(u=>u.fileId!=null&&{file_id:u.fileId,name:u.file.name,size:u.file.size,type:ws(u.file),last_modified:u.file.lastModified,file_size_tokens:u.fileSpec?.fileTokenSize}))]})),r.current=Ps(a.current),!y.completionType||y.completionType===Js.Next){const v=ne.getCurrentNode(de(i)),u=v.message.clientMetadata?.isPlaceholderTemplateAssistantWelcomeMessage?v.message:void 0;u&&(y.existingMessages=[u]),y.prependMessages=[...Yi(x)??[],...Ds(a,r)??[],...Ki(i)??[],...y.prependMessages??[]]}return y},[i,x,a,r,t]);return e.jsx(Ts.Provider,{value:d,children:e.jsx("div",{className:"relative flex h-full grow overflow-auto",children:e.jsx("div",{className:"grow",children:e.jsx(Fs,{clientThreadId:i,getGizmosCompletionParams:o,hideHeader:!0})})})})}const ta=ys.memo(sa);function ia({gizmo:s,updateGizmo:t,publishedGizmo:i,promoteGizmo:a,appealGizmo:n,setAppealState:r,showActionsModal:l,shareOnly:p,onClose:d}){const[x,o]=c.useState({type:"privacy"});return x.type==="privacy"?e.jsx(na,{gizmo:s,updateGizmo:t,publishedGizmo:i,promoteGizmo:a,appealGizmo:n,setAppealState:r,setStep:o,showActionsModal:l,shareOnly:p,onClose:d}):e.jsx(ra,{publishedGizmo:x.publishedGizmo,onClose:d})}function aa(s){return s?R.Workspace:R.Link}function na({gizmo:s,publishedGizmo:t,updateGizmo:i,promoteGizmo:a,appealGizmo:n,setAppealState:r,setStep:l,showActionsModal:p,shareOnly:d,onClose:x}){const o=He(),[y,v]=c.useState(!1),u=ye(Ss.isBusinessWorkspace),b=H(),k=ie(),[M,N]=c.useState(Ke(s)?aa(!!u):s.sharingRecipient),_=bs(),w=Li(M,s.sharingTargets),{data:S,isLoading:h}=It(),g=Nt(),[P,C]=c.useState(t!=null&&t.gizmo.display.categories.length>0?g.data?.categories.find(j=>j.id===t.gizmo.display.categories[0])?.id:void 0);c.useEffect(()=>{C(t?.gizmo.display.categories[0])},[t?.gizmo.display.categories]);const[U,G]=c.useState(void 0),E=c.useRef(Ct((j,A)=>Le.generateCategory(j,A),1e3)),F=S?.is_verified?void 0:b.formatMessage({id:"qUMu4e",defaultMessage:"To publish your GPTs to the Explore GPTs page, set up your builder profile in the user settings page."});M===R.Marketplace&&F!=null&&!h&&N(R.Link);const B=u&&!s.sharingTargets?.some(j=>j.recipient===R.Link),L=Me(s,M,P),$=L.includes(ee.MissingPublicActionPrivacyPolicyURL),we=s.tools.find(j=>j.type===O.JIT_PLUGIN&&!j.metadata.privacy_policy_url),V=ye(j=>j.currentWorkspace),Q=$e();c.useEffect(()=>{let j=!0;return(async()=>{try{if(P!=null)return;const A=await E.current(s.name,s.instructions);j&&P==null&&(A?C(A.id):G(!0))}catch{j&&P==null&&G(!0)}})(),()=>{j=!1}},[s.instructions,s.name,Q,P]);const{value:me}=ce("4226692983");return e.jsx(Ve,{testId:"modal-simple-share-gizmo",type:"success",isOpen:!0,onClose:x,title:e.jsx(m,{id:"9viumf",defaultMessage:"Share GPT"}),showCloseButton:!0,primaryButton:w?e.jsx(fe,{color:"primary",disabled:L.length>0,loading:y,onClick:async()=>{try{if(v(!0),d){if(!t?.gizmo.id){k.danger(b.formatMessage({id:"QYVEx8",defaultMessage:"Error sharing GPT"}));return}const j=await Le.shareGizmo(t.gizmo.id,P?{sharing:ve(M,[],je),categories:[P]}:{sharing:ve(M,[],je)});j.error?(k.warning(b.formatMessage({id:"tmIKmp",defaultMessage:"Unable to share GPT"})),i({sharingTargets:j.sharing_targets}),r({gizmoId:t.gizmo.id,sharingRecipient:M,categories:t.gizmo.display.categories,moderationType:Us.PublishBlocked,sharingTargets:j.sharing_targets,showModal:le.AppealAvailable})):(_.setQueryData(["gizmo",{gizmoId:t.gizmo.id},{draft:!1}],A=>j.resource),i(A=>({...A,sharingRecipient:M})),k.success(b.formatMessage({id:"SWSzcY",defaultMessage:"Sharing settings updated"})),x())}else{const j=await a({recipient:M,subjects:ve(M,[],je)},P);j?(l({type:"published",publishedGizmo:j}),i(A=>({...A,id:j.gizmo.id,sharingRecipient:M})),j.gizmo.live_version!=null&&i({liveVersion:j.gizmo.live_version}),k.success(b.formatMessage({id:"R5zko1",defaultMessage:"GPT published"}),{testId:"gpt-published-toast"})):(k.warning(b.formatMessage({id:"uf7WYw",defaultMessage:"Unable to publish GPT"})),x())}}finally{v(!1)}},"data-testid":"save-gizmo-button",children:e.jsx(m,{id:"SW4DG4",defaultMessage:"Save"})}):me?e.jsx(e.Fragment,{children:e.jsx(fe,{color:"primary",onClick:async()=>{await n(M,P)},children:e.jsx(m,{id:"bBmLUr",defaultMessage:"Appeal"})})}):null,secondaryButton:t?e.jsx(fe,{color:"secondary",onClick:j=>Ze(o,t,k,j,b.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"})),children:e.jsx(m,{id:"wvL15a",defaultMessage:"Copy link"})}):null,children:e.jsxs("div",{className:"mx-[-16px] flex flex-col gap-3 text-sm",children:[e.jsx("div",{className:"space-y-1.5",children:e.jsxs(_s,{value:M,onValueChange:j=>N(j),children:[s.sharingTargets&&s.sharingTargets.map((j,A)=>e.jsx(Ne,{value:j.recipient,disabled:j.recipient===R.Marketplace&&F!=null,tooltipText:j.recipient===R.Marketplace?F??b.formatMessage({id:"0Rcb4e",defaultMessage:"Your GPT will appear in the Explore GPTs page"}):void 0,shareLevel:j.recipient},A)),B&&e.jsxs(e.Fragment,{children:[e.jsx(Ne,{value:R.Link,disabled:!0,tooltipText:b.formatMessage(ms.workspaceDisabledHint),shareLevel:R.Link,workspaceName:V?.name}),e.jsx(Ne,{value:R.Link,disabled:!0,tooltipText:b.formatMessage(ms.workspaceDisabledHint),shareLevel:R.Marketplace,workspaceName:V?.name})]})]})}),$&&e.jsx("div",{className:"text-xs text-red-500",children:e.jsx(m,{id:"/iw1Iv",defaultMessage:"Public actions require valid privacy policy URLs. Click <fixlink>here</fixlink> to update.",values:{fixlink:j=>e.jsx("button",{onClick:()=>{p(we?.metadata.action_id)},className:"underline",children:j})}})}),M!==R.Private&&e.jsx(Pi,{gizmo:s,category:P,categories:M===R.Marketplace?g.data?.categories??[]:void 0,onCategoryChange:M===R.Marketplace?j=>C(j.id):void 0}),M===R.Marketplace&&(U?e.jsx("div",{className:"text-xs text-red-500",children:e.jsx(m,{id:"tpC3ui",defaultMessage:"There was an error updating the list of categories"})}):null),!w&&me&&e.jsx("div",{className:"text-token-text-secondary flex items-center justify-between text-sm",children:e.jsx(m,{id:"jLCMMV",defaultMessage:"Because this GPT previously may have violated our policies, you will have to submit an appeal to make it available at this level."})})]})})}function ra({publishedGizmo:s,onClose:t}){const i=He(),a=Gt(i,s),n=H(),r=ie();return e.jsx(Ve,{testId:"modal-simple-share-published",type:"success",isOpen:!0,onClose:t,title:e.jsx(m,{id:"rCRRmx",defaultMessage:"Settings Saved"}),showCloseButton:!0,primaryButton:e.jsx(fe,{color:"primary",as:"link",to:a,children:e.jsx(m,{id:"lyZz44",defaultMessage:"View GPT"})}),children:e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"bg-token-main-surface-secondary flex gap-1 rounded-sm px-2 py-1",children:[e.jsx("div",{className:"line-clamp-1 break-all text-ellipsis",children:a}),e.jsx("button",{onClick:l=>{Ze(i,s,r,l,n.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"}))},className:"text-token-text-secondary hover:text-token-text-primary transition","data-testid":"copy-saved-gpt-url-button",children:e.jsx(Is,{className:"icon-sm"})})]})})})}const ms=oe({workspaceDisabledHint:{id:"gizmo.workspaceDisabledHint",defaultMessage:"Your workspace administrator has disabled this setting"}});function Ne({shareLevel:s,workspaceName:t,value:i,disabled:a=!1,tooltipText:n}){const r=c.useId();return e.jsx(At,{disabled:n==null,label:n,side:"top",children:e.jsxs(Ns,{id:r,value:i,disabled:a,className:"hover:bg-token-main-surface-secondary flex h-14 w-full cursor-pointer flex-row items-center justify-between gap-2 rounded-md px-3 py-4 font-semibold",children:[e.jsx("label",{htmlFor:r,className:"flex cursor-pointer items-center gap-1",children:e.jsx(Ti,{shareLevel:s,workspaceName:t??"",hasInviteSharing:!1})}),e.jsx(Rt,{children:e.jsx(Lt,{className:"icon-lg me-1"})})]})})}function be(s){return!!(s&&typeof s=="object"&&"gizmo"in s)}function Hs(s){window.history.length>1?s(-1):s(Et())}function oa({gizmo:s,publishedGizmo:t,isUpsertLoading:i,isPromoteLoading:a,isUploadingProfilePic:n,isGeneratingProfilePic:r,updateGizmo:l,promoteGizmo:p,appealGizmo:d,setAppealState:x,showActionsModal:o}){const y=rt(),v=s!=null?Me(s):[];(s==null||a||i)&&v.push(ee.Loading),n&&v.push(ee.UploadingProfilePic),r&&v.push(ee.GeneratingProfilePic);const u=Ke(s),[b,k]=c.useState(!1),[M,N]=c.useState(!1),_=s.sharingRecipient?us[s.sharingRecipient]:us.private,w=a||i;return e.jsxs(e.Fragment,{children:[u?e.jsx(se,{color:"primary",onClick:()=>k("promote"),loading:i,disabled:w||s.id===void 0||v.length>0,tooltip:v.length>0?v.map(ze).join(`
`):void 0,"data-testid":"gizmo-editor-create-gpt-button",children:e.jsx(m,{id:"svUGIb",defaultMessage:"Create"})}):e.jsxs(e.Fragment,{children:[e.jsx(se,{color:"secondary",loading:a||!t,disabled:w,icon:_,onClick:()=>k("share"),children:e.jsx(m,{id:"aXKW4G",defaultMessage:"Share"})}),e.jsx(se,{color:"primary",onClick:async()=>{let S=s.sharing.subjects.map(ki);const h=Bt(s.sharing.subjects);S=ve(s.sharing.recipient,S,h?.capabilities??je);const g=t&&be(t)?t.gizmo.display.categories[0]:void 0;await p({recipient:s.sharing.recipient,subjects:S},g)&&N(!0)},loading:i||!t,disabled:w||v.length>0,tooltip:v.length>0?v.map(ze).join(`
`):void 0,children:e.jsx(m,{id:"84QVoj",defaultMessage:"Update"})})]}),b&&(y?.getWorkspaceId()==null?e.jsx(ia,{gizmo:s,publishedGizmo:t,promoteGizmo:p,appealGizmo:d,setAppealState:x,showActionsModal:o,updateGizmo:l,shareOnly:b==="share",onClose:()=>k(!1)}):e.jsx(Si,{gizmo:s,publishedGizmo:t,promoteGizmo:p,appealGizmo:d,setAppealState:x,showActionsModal:o,updateGizmo:l,onClose:()=>k(!1),shareOnly:b==="share"})),M&&t&&e.jsx(_i,{publishedGizmo:t,sharing:be(t)?t.gizmo.sharing:void 0,onClose:()=>N(!1),workspaceName:y?.data.name??""})]})}function la({gizmoEditorData:s,publishedGizmo:t,revertDraft:i}){const a=He(),n=H(),r=ie(),l=ue(),[p,d]=c.useState(!1),x=$e(),{value:o}=ce("3645668434"),y=t&&be(t)?t.gizmo.current_user_permission?.can_delete:!1;return!(t||i||s?.id&&o&&s.liveVersion>0||y||x?.includes("debug"))?null:e.jsxs(e.Fragment,{children:[e.jsxs(Cs,{side:"top",contentAlign:"end",sideOffset:8,triggerButton:e.jsx(se,{color:"ghost",icon:Ot}),children:[t!=null&&e.jsxs(J.Item,{onClick:u=>{Ze(a,t,r,u)},children:[e.jsx(Gs,{className:"icon-sm"}),e.jsx(m,{...q.copyLink})]}),i!=null&&e.jsxs(J.Item,{onClick:()=>{window.confirm(n.formatMessage(q.revertConfirm))&&i()},children:[e.jsx(Ut,{className:"icon-sm"}),e.jsx(m,{id:"W2blnV",defaultMessage:"Revert..."})]}),s?.id!=null&&o&&s.liveVersion>0&&e.jsxs(e.Fragment,{children:[e.jsxs(J.Item,{onClick:()=>{l(`/g/${s.id}/view`)},children:[e.jsx(Ai,{className:"icon-sm"}),e.jsx(m,{id:"gizmo.versionHistory",defaultMessage:"Version History"})]}),e.jsxs(J.Item,{onClick:async()=>{const u=await Le.copyGizmo({gizmoId:s.id});u.gizmo.id&&l(`/gpts/editor/${u.gizmo.id}`)},children:[e.jsx(Is,{className:"icon-sm"}),e.jsx(m,{id:"GizmoInformation.copyGizmoLabel",defaultMessage:"Duplicate GPT"})]})]}),t&&be(t)&&t.gizmo.current_user_permission?.can_delete&&e.jsxs(J.Item,{color:"danger",onClick:()=>{d(!0)},children:[e.jsx(Ft,{className:"icon-sm"}),e.jsx(m,{id:"tNrOLG",defaultMessage:"Delete GPT"})]})]}),p&&e.jsx(Ri,{gizmoId:s?.id||"",onSuccess:()=>Hs(l),onClose:()=>{d(!1)}})]})}const ge=qe.div`flex items-center gap-1`;function ca({gizmoEditorData:s}){const t=ye(i=>i.currentWorkspace?.name);switch(s.sharingRecipient){case R.Private:return e.jsxs(ge,{children:[e.jsx(Ht,{className:"icon-xs"}),e.jsx(m,{...q.onlyMe})]});case R.Link:return e.jsxs(ge,{children:[e.jsx(Gs,{className:"icon-xs"}),e.jsx(m,{...q.anyoneWithLink})]});case R.Workspace:return e.jsxs(ge,{children:[e.jsx(Dt,{className:"icon-xs"}),t]});case R.Marketplace:return e.jsxs(ge,{children:[e.jsx(Wt,{className:"icon-xs"}),e.jsx(m,{...q.public})]});default:return e.jsx("div",{})}}function da({gizmoEditorData:s}){return e.jsxs("div",{className:"flex items-center gap-2",children:[s.profilePictureUrl!=null?e.jsx(Bs,{isFirstParty:!1,src:s.profilePictureUrl,className:"h-8 w-8"}):e.jsx("div",{className:"border-token-border-medium h-8 w-8 rounded-full border-2 border-dashed"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:s.name||e.jsx(m,{...q.newGPT})}),e.jsx("div",{className:"text-token-text-secondary text-xs",children:Ke(s)?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"bg-token-text-tertiary h-1.5 w-1.5 rounded-full"}),e.jsx(m,{...q.draft})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"bg-brand-green h-1.5 w-1.5 rounded-full"}),s.sharingRecipient===R.Marketplace?e.jsx(m,{...q.published}):e.jsx(m,{id:"gizmoEditorHeader.live",defaultMessage:"Live"}),e.jsx(m,{...q.dotSeparator,tagName:"span"}),e.jsx(ca,{gizmoEditorData:s})]})})]})]})}const ua=qe.div`
  cursor-pointer
  border-b
  pb-[1px]
  pt-[2px]
  text-sm
  text-token-text-secondary
  hover:border-token-border-xheavy
  hover:text-token-text-primary
  mx-2
`;function ma({gizmoEditorData:s,isUpsertLoading:t,isPromoteLoading:i,isUploadingProfilePic:a,isGeneratingProfilePic:n,publishedGizmo:r,updateGizmo:l,promoteGizmo:p,appealGizmo:d,setAppealState:x,revertDraft:o,draftMessage:y,className:v,hasUnpublishedChanges:u,showActionsModal:b}){const k=ue();return e.jsxs("div",{className:re("border-token-border-medium relative flex h-14 w-full items-center justify-between gap-2 border-b px-3",v),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{className:"text-token-text-primary cursor-pointer",onClick:()=>Hs(k),children:e.jsx(zt,{className:"icon-lg"})}),e.jsx(da,{gizmoEditorData:s})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[r&&(r?.gizmo?.live_version??0)>1&&e.jsx(ua,{onClick:()=>k(`/g/${s.id}/view`),children:e.jsx(m,{id:"P0Ri/k",defaultMessage:"Last edited {date}",values:{date:e.jsx(wt,{value:r.gizmo.updated_at,day:"numeric",month:"short",year:new Date(r.gizmo.updated_at).getFullYear()===new Date().getFullYear()?void 0:"numeric"})}})}),y,e.jsx(la,{gizmoEditorData:s,publishedGizmo:r,revertDraft:o}),e.jsx(oa,{gizmo:s,publishedGizmo:r,isUpsertLoading:t,isPromoteLoading:i,isUploadingProfilePic:a,isGeneratingProfilePic:n,updateGizmo:l,promoteGizmo:p,appealGizmo:d,setAppealState:x,hasUnpublishedChanges:u,showActionsModal:b})]})]})}const q=oe({onlyMe:{id:"gizmo.onlyMe",defaultMessage:"Only me"},anyoneWithLink:{id:"gizmo.anyoneWithLink",defaultMessage:"Anyone with a link"},public:{id:"gizmo.public",defaultMessage:"Everyone"},newGPT:{id:"gizmo.newGPT",defaultMessage:"New GPT"},draft:{id:"gizmo.draft",defaultMessage:"Draft"},published:{id:"gizmo.published",defaultMessage:"Published"},revertConfirm:{id:"gizmo.revertConfirm",defaultMessage:"Are you sure you want to revert to the last saved version?"},copyLink:{id:"gizmo.copyLink",defaultMessage:"Copy link"},dotSeparator:{id:"gizmo.dotSeparator",defaultMessage:"·"}}),pa=512;function ga(){return e.jsx("div",{className:"border-token-border-medium relative flex h-full w-full items-center justify-center rounded-full border-2 border-dashed",children:e.jsx(Qe,{className:"h-1/4 w-1/4"})})}function fa({gizmoEditorData:s,onFileChange:t,generateProfilePic:i,isGeneratingProfilePic:a,setIsGeneratingProfilePic:n}){const r=H(),l=ie(),[p,d]=c.useState(void 0),x=c.useRef(t);c.useEffect(()=>{x.current=t});async function o(u){if(u.length>0){n(!1);const b=await Kt(u[0],pa),k=Ee(b);d({tempId:k,file:b,status:W.Uploading,progress:1,fileId:null,cdnUrl:null}),x.current("uploading"),Zt(k,b,r,l,gs.ProfilePicture,{onFileCreated(M,N,_){d(w=>w!=="initial"&&w?.tempId===M&&w.status===W.Uploading?{...w,progress:10,fileId:N,cdnUrl:_}:w)},onFileUploadProgress(M,N){d(_=>_!=="initial"&&_?.tempId===M&&_.status===W.Uploading?{..._,progress:N}:_)},onFileUploaded(M,N,_){d(w=>w!=="initial"&&w?.tempId===M?(x.current(w),{...w,status:W.Ready,progress:100,fileSpec:{name:w.file.name,id:w.fileId,size:w.file.size,..._??{}}}):w)},onError(M){d(N=>{if(N!=="initial"&&N?.tempId===M){x.current(void 0);return}return N})}})}}const{open:y,getInputProps:v}=Ws({disabled:!1,noClick:!0,onDropAccepted:o,onDropRejected:u=>Ei(u,r,l,Vt.ProfilePicture),multiple:!0,maxSize:Rs,...As($t)});return e.jsxs("div",{className:"flex w-full items-center justify-center gap-4",children:[e.jsxs(Cs,{sideOffset:8,triggerButton:e.jsx("button",{className:"h-20 w-20",children:a?e.jsx(ga,{}):p!=null&&p!="initial"&&p.status!=W.Ready?e.jsxs("div",{className:"relative h-full w-full overflow-hidden rounded-full",children:[e.jsx(qt,{file:p.file}),p.status===W.Uploading&&p.progress<90?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/5 text-white",children:e.jsx(Qt,{percentage:p.progress,className:"h-6 w-6"})}):null]}):s?.profilePictureUrl!=null&&s?.profilePictureUrl!==""?e.jsx(Bs,{isFirstParty:!1,src:s.profilePictureUrl}):e.jsx("div",{className:"border-token-border-medium flex h-full w-full items-center justify-center rounded-full border-2 border-dashed",children:e.jsx(Yt,{className:"text-4xl"})})}),children:[e.jsx(J.Item,{onClick:y,children:e.jsx(m,{id:"ERQwXg",defaultMessage:"Upload Photo"})}),e.jsx(J.Item,{onClick:i,children:e.jsx(m,{id:"NXAog/",defaultMessage:"Use DALL·E"})})]}),e.jsx("input",{...v()})]})}function ha({gizmoEditorData:s,requireGizmoId:t,currentModelConfig:i,updateGizmo:a}){const n=H(),r=ie(),[l,p]=c.useState(0),d=c.useRef(new Map),x=Xt(i,void 0),o=async g=>{fs.logEvent("Upload File",{client:"web",eventSource:"mouse",intent:"gizmo"});const P=await t();g.length>0&&await Promise.all(g.map(C=>{const U=Ee(C);d.current.set(U,{tempId:U,gizmoId:P,file:C,status:W.Uploading,progress:1,fileId:null,cdnUrl:null}),Jt(Ee(C),C,n,r,{kind:gs.Gizmo,gizmoId:P},{onFileUploaded:(G,E,F,B)=>{const L=d.current.get(G);L==null||L.fileId==null||(a($=>({...$,files:[...$.files??[],{file_id:L.fileId,name:L.file.name,size:L.file.size,type:B?.mimeType??ws(C),last_modified:L.file.lastModified,file_size_tokens:B?.fileTokenSize}]})),d.current.delete(G),p($=>$+1))},onFileCreated:(G,E,F)=>{d.current.set(G,{tempId:G,gizmoId:P,file:C,status:W.Uploading,progress:1,...d.current.get(G),fileId:E,cdnUrl:F}),p(B=>B+1)},onFileUploadProgress:(G,E)=>{const F=d.current.get(G);F?.status===W.Uploading&&d.current.set(G,{...F,progress:E}),p(B=>B+1)},onError:G=>{d.current.delete(G)}},{usesRetrievalIndex:i!=null&&_e(i,C.type,C.name)===Se.Retrieval})}))},{getInputProps:y,open:v}=Ws({disabled:!1,noClick:!0,onDropAccepted:o,multiple:!0,maxSize:Rs,maxFiles:10,...As(x)}),u=s?.files??[];function b(g){return e.jsx(as,{onRemoveFileClick:()=>{d.current.delete(g.tempId),p(P=>P+1)},file:g.file,loadingPercentage:g.status===W.Uploading?g.progress:void 0},g.tempId)}function k(g){return e.jsx(as,{file:g.name,fileId:g.file_id,onRemoveFileClick:()=>a(P=>({...P,files:P?.files?.filter(C=>C.file_id!==g.file_id)})),gizmoId:s?.id},g.file_id)}const M=Array.from(d.current.values()).filter(g=>u.every(P=>P.file_id!==g.fileId)),[N,_]=is(M,g=>i!=null&&_e(i,g.file.type,g.file.name)===Se.CodeInterpreter),[w,S]=is(u,g=>i!=null&&g.type!=null&&_e(i,g.type,g.name)===Se.CodeInterpreter),h=c.useRef(w.length);return c.useEffect(()=>{w.length>h.current&&a(g=>g.tools?.some(P=>P.type===O.PYTHON)?g:{...g,tools:[...g.tools??[],{type:O.PYTHON}]}),h.current=w.length},[w.length]),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"text-token-text-tertiary rounded-lg text-xs",children:e.jsx(m,{...xa.knowledgeWarning})}),_.length>0||S.length>0?e.jsxs("div",{className:"flex flex-wrap gap-2",children:[_.map(b),S.map(k)]}):null,N.length>0||w.length>0?e.jsxs("div",{children:[e.jsx("div",{className:"text-token-text-tertiary mb-2 text-xs",children:e.jsx(m,{id:"i/QurZ",defaultMessage:"The following files are only available for Code Interpreter:"})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[N.map(b),w.map(k)]})]}):null,e.jsx("div",{children:e.jsxs(se,{onClick:v,children:[e.jsx("input",{...y()}),e.jsx(m,{id:"sr8Qp/",defaultMessage:"Upload files"})]})})]})}const xa=oe({knowledgeWarning:{id:"gizmo.knowledgeWarning",defaultMessage:"Conversations with your GPT can potentially reveal part or all of the files uploaded."}});function va({placeholder:s,text:t,onChange:i,onClose:a}){return e.jsxs(Ve,{testId:"modal-gizmo-editor-form",className:"max-h-[100vh]! max-w-[80vw]!",type:"success",isOpen:!0,onClose:a,primaryButton:e.jsx(se,{onClick:a,children:e.jsx(m,{id:"FeFVdS",defaultMessage:"Close"})}),children:[e.jsx("textarea",{className:"bg-token-main-surface-primary h-[70vh] w-full resize-none rounded-lg dark:border-gray-700",value:t,onChange:n=>{i(n.target.value)},placeholder:s}),e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(m,{...Ls.instructionsWarning})})]})}const Ce=qe.div`text-sm text-red-500`;function ja({children:s,collapsed:t,initial:i}){return e.jsx(Pt,{initial:i,children:!t&&e.jsx(Ms.div,{initial:"collapsed",animate:"open",exit:"collapsed",variants:{open:{opacity:1,height:"auto"},collapsed:{opacity:0,height:0}},children:s})})}function ya({gizmo:s,onShowActionsEditor:t,isDisabled:i}){const a=H(),n=ie(),r=e.jsxs("div",{className:"space-y-1",children:[s?.tools?.map((l,p)=>l.type!==O.JIT_PLUGIN?null:e.jsxs("div",{children:[e.jsx(Fi,{isDisabled:i,actionTool:l,onShowActionsEditor:()=>t(l.metadata.domain)}),l.metadata.auth?.type==="oauth"&&e.jsx(ri,{label:a.formatMessage(z.callbackUrlLabel),value:`https://chat.openai.com/aip/${l.metadata.action_id}/oauth/callback`,onCopied:()=>{n.success("Copied to clipboard",{duration:3})}})]},p)),(s?.tools?.filter(l=>l.type===O.JIT_PLUGIN)??[]).length>=ns?e.jsx("div",{children:a.formatMessage(z.maxActionsReached,{number:ns})}):e.jsx(se,{disabled:i,onClick:()=>{t("Unknown domain")},className:"mt-2",children:e.jsx(m,{...z.createActionLabel})})]});return i?e.jsx(Es,{side:"top",label:a.formatMessage(z.disabledCustomActionsTooltip),children:r}):r}function ba(s){return(s.files?.length??0)>0||s?.tools?.some(t=>t.type===O.JIT_PLUGIN)}function Ma({gizmoEditorData:s,updateGizmo:t,currentModelConfig:i,generateProfilePic:a,setIsUploadingProfilePic:n,isGeneratingProfilePic:r,setIsGeneratingProfilePic:l,requireGizmoId:p,onShowActionsEditor:d}){const x=s?.tools??[],[o,y]=c.useState(!1),[v,u]=c.useState(!0),b=s?.promptStarters??[],k=[...b,...b.length<ei?[""]:[]],M=Me(s),_=Ye()?.isWorkspaceAccount(),w=zs(he.WorkspaceGPTCustomActions),S=H();return e.jsxs("div",{className:"flex h-full grow flex-col overflow-y-auto px-2 pt-6 text-sm",children:[e.jsxs("div",{className:"grow",children:[e.jsxs(Y,{children:[e.jsx(fa,{gizmoEditorData:s,generateProfilePic:a,isGeneratingProfilePic:r,setIsGeneratingProfilePic:l,onFileChange:async h=>{if(h!=null&&h!=="uploading"&&h.fileId!=null){const g=await Oe.getFileDownloadLink(h.fileId);g.status===Be.Success&&t({profilePictureId:h.fileId!=null?h.fileId:void 0,profilePictureUrl:g.download_url})}else t({profilePictureId:void 0,profilePictureUrl:void 0});n(h==="uploading")}}),e.jsx(K,{label:e.jsx(m,{id:"M4dZms",defaultMessage:"Name"}),description:e.jsx(m,{id:"+Gkni2",defaultMessage:"The name of your GPT"})}),e.jsx(Ie,{type:"text",placeholder:S.formatMessage(z.gptNamePlaceholder),value:s?.name??"",onChange:h=>{t({name:h.target.value})},onBlurCapture:()=>t(h=>({...h,name:h.name.trim()})),"data-testid":"gizmo-name-input"}),M.includes(ee.GizmoNameTooLong)?e.jsx(Ce,{className:"mt-1",children:e.jsx(m,{...z.nameTooLong,values:{length:si}})}):null]}),e.jsxs(Y,{className:"mt-4",children:[e.jsx(K,{label:e.jsx(m,{id:"YDzNvf",defaultMessage:"Description"}),description:e.jsx(m,{id:"dpxCw8",defaultMessage:"Short description of what this GPT does"})}),e.jsx(Ie,{type:"text",placeholder:S.formatMessage(z.descriptionPlaceholder),value:s?.description??"",onChange:h=>t({description:h.target.value}),onBlurCapture:()=>t(h=>({...h,description:h.description?.trim()??""})),"data-testid":"gizmo-description-input"}),M.includes(ee.GizmoDescriptionTooLong)?e.jsx(Ce,{className:"mt-1",children:e.jsx(m,{...z.descriptionTooLong,values:{length:ti}})}):null]}),e.jsxs(Y,{children:[e.jsx(K,{label:e.jsx(m,{id:"2SO0RJ",defaultMessage:"Instructions"}),description:S.formatMessage(z.instructionsSubtitle)}),e.jsxs("div",{className:"relative",children:[e.jsx(Ui,{className:"resize-none",rows:8,value:s?.instructions,onChange:h=>t({instructions:h.target.value}),onBlurCapture:()=>t(h=>({...h,instructions:h.instructions.trim()})),placeholder:S.formatMessage(z.instructionsSubtitle),"data-testid":"gizmo-instructions-input"}),e.jsx("button",{className:"text-token-text-tertiary absolute end-2 bottom-3",onClick:()=>y(!0),children:e.jsx(zi,{className:"icon-sm"})})]}),e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(m,{...Ls.instructionsWarning})}),M.includes(ee.GizmoInstructionsTooLong)?e.jsx(Ce,{className:"mt-1",children:e.jsx(m,{...z.instructionsTooLong,values:{length:ii}})}):null]}),e.jsxs(Y,{children:[e.jsx(K,{label:e.jsx(m,{id:"6rfYOX",defaultMessage:"Conversation starters"}),description:e.jsx(m,{id:"OSOIpd",defaultMessage:"Examples for the user to start the conversation"})}),e.jsx("div",{className:"flex flex-col gap-1",children:k.map((h,g)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ie,{className:"rounded-e-none",value:h,type:"text",maxLength:ai,onChange:P=>{const C=P.target.value;t(U=>({...U,promptStarters:We(g>=(b.length??0)?[...b??[],C]:b.map((G,E)=>E===g?C===""?void 0:C:G))}))}}),e.jsx("button",{className:"border-token-border-medium flex h-9 w-9 items-center justify-center rounded-lg rounded-s-none border border-s-0",onClick:()=>t(P=>({...P,promptStarters:b.filter((C,U)=>U!==g)})),children:e.jsx(ot,{className:"icon-sm"})})]},g))})]}),e.jsxs(Y,{children:[e.jsx(K,{label:e.jsx(m,{id:"bwXSkU",defaultMessage:"Knowledge"}),description:S.formatMessage(z.knowledgeExplanation)}),e.jsx(ha,{gizmoEditorData:s,requireGizmoId:p,currentModelConfig:i,updateGizmo:t})]}),e.jsxs(Y,{children:[e.jsx(K,{label:e.jsx(m,{id:"mcAwDU",defaultMessage:"Capabilities"}),description:e.jsx(m,{id:"2exQT6",defaultMessage:"Functionality this GPT can use"})}),e.jsx(Oi,{enabledTools:x,onEnabledToolsChange:h=>t({tools:h})})]}),e.jsxs(Y,{children:[e.jsx(K,{label:e.jsx(m,{id:"7r7v+u",defaultMessage:"Actions"}),description:e.jsx(m,{id:"fBln7I",defaultMessage:"APIs this GPT can use"})}),e.jsx(ya,{isDisabled:!!(_&&!w),gizmo:s,onShowActionsEditor:d})]}),!_&&ba(s)&&e.jsxs(Y,{children:[e.jsx(K,{label:e.jsx(m,{id:"R3KeU7",defaultMessage:"Additional Settings"}),collapsed:!!v,onClick:()=>{u(h=>!h)}}),e.jsx(ja,{collapsed:v,initial:!1,children:e.jsx(ni,{className:"mx-3 my-1",labelClassName:"w-full cursor-pointer",label:e.jsx(m,{id:"tZgwFW",defaultMessage:"Use conversation data in your GPT to improve our models"}),id:"improve-chatgpt",checked:!s.trainingDisabled,onChange:()=>{t({trainingDisabled:!s.trainingDisabled})}})})]})]}),o&&e.jsx(va,{text:s.instructions??"",onChange:h=>{t({instructions:h})},onClose:()=>y(!1),placeholder:S.formatMessage(z.instructionsSubtitle)})]})}const z=oe({nameTooLong:{id:"gizmo.nameTooLong",defaultMessage:"GPT names cannot be longer than {length} characters."},knowledgeExplanation:{id:"gizmo.knowledgeExplanation",defaultMessage:"Additional files for this GPT to reference."},descriptionTooLong:{id:"gizmo.descriptionTooLong",defaultMessage:"GPT descriptions cannot be longer than {length} characters."},instructionsTooLong:{id:"gizmo.instructionsTooLong",defaultMessage:"GPT instructions cannot be longer than {length} characters."},disabledCustomActionsTooltip:{id:"gizmo.disabledCustomActionsTooltip",defaultMessage:"Custom actions are disabled for your workspace. Contact your admin to enable them."},createActionLabel:{id:"gizmo.createActionLabel",defaultMessage:"Create new action"},maxActionsReached:{id:"gizmo.maxActionsReached",defaultMessage:"GPTs can have a maximum of {number} actions"},descriptionPlaceholder:{id:"gizmo.descriptionPlaceholder",defaultMessage:"Add a short description about what this GPT does"},instructionsSubtitle:{id:"gizmo.instructionsSubtitle",defaultMessage:"What does this GPT do? How does it behave? What should it avoid doing?"},gptNamePlaceholder:{id:"gizmo.gptNamePlaceholder",defaultMessage:"Name your GPT"},callbackUrlLabel:{id:"gizmo.callbackUrlLabel",defaultMessage:"Callback URL"}});function wa(s,t){const i=hs(s);if(!Array.isArray(s.detail))return i;const a=We(s.detail.map(n=>{if(n.type==="value_error.any_str.max_length")switch(n.loc[1]){case"display":{switch(n.loc[2]){case"name":return t.formatMessage(z.nameTooLong,{length:n.ctx.limit_value});case"description":return t.formatMessage(z.descriptionTooLong,{length:n.ctx.limit_value})}break}case"instructions":return t.formatMessage(z.instructionsTooLong,{length:n.ctx.limit_value})}if(typeof n.msg=="string")return n.msg}));return a.length>0?a.join(`
`):i}function Pa({upsertDraftError:s}){const t=H(),i=wa(s,t);return e.jsxs("div",{className:"flex items-center gap-2 text-red-500",children:[e.jsx("div",{children:e.jsx(m,{...$s.errorSavingDraft})}),i!=null&&e.jsx(Es,{label:i,children:e.jsx(oi,{className:"icon-sm"})})]})}function Ta({isPublished:s,isSavingDraft:t,hasUnpublishedChanges:i,upsertDraftError:a,className:n}){return a instanceof lt?e.jsx(Pa,{upsertDraftError:a}):i?e.jsxs("div",{className:re("flex items-center gap-2",n),children:[e.jsx("span",{className:"text-token-text-secondary",children:s?e.jsx(m,{id:"gizmoEditor.draftUnpublished",defaultMessage:"Unpublished changes"}):e.jsx(m,{id:"gizmoEditor.draftPending",defaultMessage:"Updates pending"})}),e.jsx("div",{className:"text-token-text-tertiary w-4",children:t&&e.jsx(Qe,{})})]}):null}const $s=oe({errorSavingDraft:{id:"gizmo.errorSavingDraft",defaultMessage:"Error saving draft"}}),ka=xs(()=>vs(()=>import("./igoc4yhxv10ch5gr.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37])).then(s=>s.CanvasFocusedViewManager));var Sa=(s=>(s.TestGizmoAction="test_gizmo_action",s))(Sa||{});const _a=new ct;function Ia({gizmoEditorData:s,isSavingDraft:t,showTitle:i=!0}){const[a,n]=c.useState(()=>xe());ks(a,{kind:te.GizmoTest,gizmo_id:s.id}),c.useEffect(()=>{De(a,u=>{u.mode={kind:te.GizmoTest,gizmo_id:s.id}})},[a,s.id]);const r=s.files?.map(u=>u.file_id).join();c.useEffect(()=>{dt(a)!=null&&n(xe())},[s.id,s.instructions,s.tools,r,a]);const l=c.useMemo(()=>({gizmoEditorData:s,mode:"test"}),[s]),[p,d]=c.useState(0),x=()=>{d(u=>u-360)},o=s.id,y=Na(a);c.useEffect(()=>js(_a,{test_gizmo_action:({rootDomain:u,operationName:b})=>{o&&y(o,u,b)}}),[y,o]);const v=c.useCallback(()=>e.jsx("div",{className:"h-full w-full",children:e.jsx(Wi,{gizmo:s,hideOwner:!0,showStarterPrompts:!0})}),[s]);return e.jsx(Ts.Provider,{value:l,children:e.jsx(li,{clientThreadId:a,children:e.jsx("div",{className:re("flex h-full w-full",t&&"cursor-wait opacity-80 transition"),children:e.jsxs("div",{className:"flex grow flex-col",children:[e.jsx("div",{className:"relative mb-2 shrink-0",children:e.jsx("div",{className:"flex justify-center py-1",children:i&&e.jsxs("div",{className:"group flex items-center gap-2 text-lg font-semibold",children:[e.jsx("div",{className:"icon-md"}),e.jsxs("button",{onClick:()=>{x(),n(xe())},className:"flex items-center gap-2",children:[e.jsx(m,{id:"2u/6Ja",defaultMessage:"Preview"}),e.jsx(Ms.div,{className:"text-token-text-primary",animate:{rotate:p},transition:{duration:.3},children:e.jsx(ci,{className:"icon-md invisible group-hover:visible"})})]})]})})}),e.jsxs("div",{className:re("relative grow overflow-auto px-2",t&&"pointer-events-none"),children:[e.jsx(Fs,{clientThreadId:a,hideHeader:!0,renderEmptyState:v()}),e.jsx(Bi.Sidebars,{children:e.jsx(ka,{clientThreadId:a,overrideWidth:0,isAutoFocusDisabled:!0})})]})]})})})})}const ps=ys.memo(Ia);function Na(s){const t=Os(s);return c.useCallback((a,n,r)=>{t({eventSource:"url",promptMessage:ut(`Call the ${n} API with the ${r} operation`,{jit_plugin_data:{from_client:{type:"test",operation:r,tool_name:di(n)}}}),completionMetadata:{conversationMode:{kind:te.GizmoTest,gizmo_id:a}}})},[t])}const Ca=xs(()=>vs(()=>import("./ddns1mlzlemxsi2y.js"),__vite__mapDeps([38,1,3,4,39,2,5,40,41,42,43,44,45,46,32,47,29,30,31,16,17,18,48,28,33,34,35,49,50,51,52,53,54,55,56,9,57,8,22,58,24,59,60,61,62,63,64,65,66])).then(s=>s.GizmoActionsEditor));var Vs=(s=>(s.MAGIC_MAKER="magic",s.ADVANCED="advanced",s.PREVIEW="preview",s))(Vs||{});function Ge({value:s,label:t,testId:i}){return e.jsx(Ns,{value:s,className:"text-md border-token-border-default text-token-text-tertiary hover:text-token-text-primary radix-state-checked:border radix-state-checked:bg-token-main-surface-primary radix-state-checked:text-token-text-primary radix-state-checked:shadow-[0_0_2px_rgba(0,0,0,.03)] w-1/3 grow rounded-lg p-1.5 font-semibold transition md:w-1/2","data-testid":i,children:t})}function Ga({className:s,editorTab:t,setEditorTab:i}){const a=H(),{value:n}=ce("1393076427");return e.jsxs(_s,{className:re("bg-token-main-surface-secondary flex w-full overflow-hidden rounded-xl p-1.5 md:w-1/2",s),value:t,onValueChange:r=>{i(r)},children:[n&&e.jsx(Ge,{value:"magic",label:a.formatMessage(Ae.magicMakerLabel)}),e.jsx(Ge,{value:"advanced",label:a.formatMessage(Ae.configureLabel),testId:"gizmo-editor-configure-button"}),e.jsx("div",{className:"flex w-1/3 md:hidden",children:e.jsx(Ge,{value:"preview",label:a.formatMessage(Ae.previewLabel)})})]})}function Aa(s,t){return s.length!==t.length?!1:s.every(i=>t.some(a=>a.type===i.type))}function Ra(s,t){return s.name===t.gizmo.display.name&&s.description===t.gizmo.display.description&&s.instructions===t.gizmo.instructions&&Aa(s.tools,t.tools)&&Fe(s.files?.map(i=>i.file_id)??[],t.files?.map(i=>i.file_id)??[])&&s.profilePictureUrl==t.gizmo.display.profile_picture_url&&s.profilePictureId==t.gizmo.display.profile_pic_id}const qs=({gizmo:s,onNewGizmoId:t})=>{const i=bs(),a=$e(),n=zs(he.BrowsingAvailable),r=a?.includes(he.GizmoCanvasToggle)&&a?.includes(he.Canvas),{value:l}=ce("4148168517"),p=H(),d=ie(),x=()=>{const f=[];n&&f.push({type:O.BROWSER}),r&&f.push({type:O.CANVAS});const T={...cs,tools:[...cs.tools,...f]};return l?{...T,tools:[...T.tools.filter(I=>I.type!==O.DALLE),{type:O.IMAGE_GEN}]}:T},o=c.useRef(s!=null?os(s):x()),y=c.useRef(s),v=c.useRef(o.current),[u,b]=c.useState(()=>o.current),[k,M]=c.useState(()=>xe()),[N]=c.useState(()=>({context_message:qi(o.current),model_slug:"unused",enabled_tools:[{tool_id:s!=null?"gizmo_editor":"gizmo_creator"}]}));ea(k,v.current,N);const{data:_}=mt(),w=_?.models.get(pt)??(_&&Ci(_.models.values(),f=>f.tags.includes(gt.GPT_4o))),{data:S}=fi(o.current.id),h=hi(),{isPending:g,error:P}=h,C=xi(),U=c.useMemo(()=>S!=null&&!Ra(u,S),[u,S]),G=async()=>{const f=o.current;try{const T=await h.mutateAsync({editorData:f,gizmoId:f.id});if(y.current=T,o.current.id==null){const I=T.gizmo.id;o.current={...o.current,id:I,sharingTargets:T.gizmo.sharing_targets},b(o.current),t?.(I)}for(const I of T.tools.filter(D=>D.type===O.JIT_PLUGIN)){const D=o.current.tools.find(Z=>Z.type===O.JIT_PLUGIN&&Z.metadata.domain===I.metadata.domain);D&&D.metadata.action_id!==I.metadata.action_id&&(D.metadata={...D.metadata,action_id:I.metadata.action_id},b(o.current))}return T}catch(T){const I=hs(T)??p.formatMessage($s.errorSavingDraft);throw d.warning(I,{duration:2}),T}},E=c.useRef(void 0),F=async()=>o.current.id!=null?o.current.id:(E.current==null&&(E.current=G().then(f=>f.gizmo.id).catch(f=>{throw E.current=void 0,f})),E.current),[B]=c.useState(()=>vi(()=>G(),2e3,{trailing:!0})),L=c.useCallback((f,T=!0)=>{const I=typeof f=="function"?f(o.current):ji(o.current,f);Fe(I,o.current)||(o.current=I,b(o.current),T&&B())},[B]),$=c.useRef(void 0);c.useEffect(()=>js(ft,{completionFinished:async f=>{const T=f.serverThreadId;if(T==null){pe(!1);return}try{const I=await Vi(o.current,T,d,$.current);I!=null&&(L(I),v.current=Ps(o.current))}catch(I){Re.addError(I),d.warning("Something went wrong generating your GPT",{duration:3})}finally{$.current=ne.getCurrentNode(de(T)).message.id,pe(!1)}}}),[d,L]);const we=Zi(k,N),[V,Q]=c.useState(void 0);c.useEffect(()=>{Q(Ii(s))},[s?.gizmo.id]);const me=async(f,T)=>{const I=Me(o.current,f.recipient,T);if(I.length>0){d.warning(`Could not save GPT:

${I.map(X=>`- ${ze(X)}`).join(`
`)}`,{duration:3});return}const D=await G(),Z=D.gizmo.id;try{return fs.logEvent("Promote Gizmo",{gizmo_id:D.gizmo.id,sharing_recipient:f.recipient,editor_tab:A}),await C.mutateAsync({gizmoId:D.gizmo.id,data:{sharingSubjects:f.subjects,sharingRecipient:f.recipient,categories:T==null?void 0:[T]}},{onSuccess(ke){i.setQueryData(ls(i,Z).queryKey,ke),i.invalidateQueries({queryKey:["gizmos"]}),i.invalidateQueries({queryKey:["gizmo",{gizmoId:Z}]}),i.invalidateQueries({queryKey:["gizmo","userActionSettings",{gizmoId:Z}]})}})}catch(X){if(X instanceof yi)Q({gizmoId:Z,sharingRecipient:f.recipient,moderationType:Us.PublishBlocked,sharingTargets:X.response?.sharing_targets,showModal:le.AppealAvailable});else{Re.addError(X);const ke=X.detail??"An unknown error occurred";d.warning("Error saving GPT - "+ke,{duration:6})}}},{value:j}=ce("1393076427"),[A,Xe]=c.useState(()=>{if(!j)return"advanced";const f=ss.getItem(ts.GizmoEditorTab);return Object.values(Vs).includes(f)?f:"magic"}),Pe=ht.useState(({windowWidth:f})=>f);c.useEffect(()=>{Pe!=null&&Pe>=768&&A==="preview"&&Xe("magic")},[Pe,A]);const[Qs,Ys]=c.useState(!1),[Je,pe]=c.useState(!1),[es,Te]=c.useState(void 0);return e.jsxs("div",{className:"flex h-screen w-full flex-col items-center",children:[e.jsx(ma,{gizmoEditorData:u,isUpsertLoading:h.isPending,isPromoteLoading:C.isPending,hasUnpublishedChanges:U,isUploadingProfilePic:Qs,isGeneratingProfilePic:Je,publishedGizmo:S,updateGizmo:L,promoteGizmo:async(f,T)=>{const I=await me(f,T);return o.current={...o.current,sharingRecipient:f.recipient},b(o.current),ss.setItem(ts.GizmoEditorTab,A),I},appealGizmo:async(f,T)=>{V!=null&&Q({...V,sharingRecipient:f,categories:T==null?void 0:[T],showModal:le.AppealAvailable})},setAppealState:Q,revertDraft:S!=null&&U?()=>{const f=i.getQueryData(ls(i,o.current.id).queryKey);if(f!=null){const T=os(f);o.current=T,b(T),G()}}:void 0,draftMessage:e.jsx(Ta,{isPublished:S!=null&&(S.gizmo.share_recipient==="marketplace"||S.gizmo.share_recipient==="workspace"),hasUnpublishedChanges:U,isSavingDraft:g,upsertDraftError:P,className:"text-sm"}),showActionsModal:f=>{Te(f)},className:"shrink-0"}),V&&e.jsx(Ni,{appealState:V,onAppealClose:()=>Q({...V,showModal:le.None}),onAppealSubmitted:()=>Q({...V,showModal:le.AppealSent})}),e.jsxs("div",{className:"relative flex w-full grow overflow-hidden",children:[e.jsx("div",{className:"flex w-full justify-center md:w-1/2",children:e.jsx("div",{className:"h-full grow overflow-hidden",children:es!==void 0?e.jsx(Ca,{currentlyEditingActionDomain:es,gizmoEditorData:u,updateGizmo:L,onClose:()=>{Te(void 0)}}):e.jsxs("div",{className:"flex h-full flex-col px-2 pt-2",children:[e.jsx("div",{className:"flex w-full flex-row justify-center",children:e.jsx(Ga,{editorTab:A,setEditorTab:Xe,className:"mb-2 shrink-0 self-center"})}),e.jsx("div",{className:"grow overflow-hidden",children:A==="magic"?e.jsx("div",{className:"h-full w-full",children:e.jsx(ta,{gizmoEditorData:u,updateGizmo:L,clientThreadId:k,gizmoEditorDataRef:o,magicMakerBehaviorOverrides:N,magicMakerConversationGizmoEditorDataRef:v,requireGizmoId:F},k)}):A==="advanced"?e.jsx(Ma,{gizmoEditorData:u,updateGizmo:L,currentModelConfig:w,generateProfilePic:f=>{pe(!0),we(f,o,v,Xi)},setIsUploadingProfilePic:Ys,isGeneratingProfilePic:Je,setIsGeneratingProfilePic:pe,requireGizmoId:F,onShowActionsEditor:f=>{Te(f)}}):e.jsx(ps,{gizmoEditorData:u,isSavingDraft:g,showTitle:!1})})]})})}),e.jsx("div",{className:re("border-token-border-medium bg-token-main-surface-secondary hidden w-1/2 justify-center border-s pt-4",A!=="preview"&&"md:flex"),children:e.jsx("div",{className:"grow",children:e.jsx(ps,{gizmoEditorData:u,isSavingDraft:g})})})]})]})};function La({gizmoId:s,version:t}){const{data:i}=mi({gizmoId:s,draft:!0,version:t}),a=ye(Ss.accountUserId),r=pi()?.id,l=i!=null&&a!=null&&r!=null&&gi(i);return i==null||!l?null:e.jsx(qs,{gizmo:i})}function za({onNewGizmoId:s}){return e.jsx(qs,{onNewGizmoId:s})}const Ea=({gizmoId:s,remixSourceId:t,version:i})=>{const a=ue(),n=Ye(),r=c.useRef(void 0);c.useEffect(()=>(rs.enterGizmoEditor(),()=>{rs.exitGizmoEditor()}),[]);let l=s;return s!=null&&r.current===s&&(l=void 0),Gi({resetThreadAction:()=>{a("/")}}),n?l!==void 0?e.jsx(La,{gizmoId:l,version:i},l):e.jsx(za,{remixSourceId:t,onNewGizmoId:p=>{r.current=p,window.history.replaceState(window.history.state,"",ui(p))}}):e.jsx("div",{className:"flex min-h-screen items-center justify-center",children:e.jsx(Qe,{})})},Ae=oe({magicMakerLabel:{id:"gizmo.magicMakerLabel",defaultMessage:"Create"},configureLabel:{id:"gizmo.advancedLabel",defaultMessage:"Configure"},previewLabel:{id:"gizmo.previewLabel",defaultMessage:"Preview"}});function Ua(s){const t=ue();c.useEffect(()=>{s||t(xt(vt.NO_ACCESS))},[s,t])}const rn=()=>(bi(),null),on=jt(function(){const t=Ye(),i=!!t?.hasPlusFeatures();Ua(t==null||i);const a=Tt(),[n]=kt(),r=ue(),l=a.slug,p=n.get("version"),d=l?yt(l):void 0,x=n.get("remixFrom");return c.useEffect(()=>{bt(!0).then(o=>{Mi.initializeAndGatherData(o),Mt.initializeAndGatherData(o)})},[]),c.useEffect(()=>{t!=null&&!i&&r("/")},[t,r,i]),c.useEffect(()=>{d&&ds(d)&&r(`/g/${l}/project`)},[d,r,l]),!i||d&&ds(d)?null:e.jsx(wi,{children:e.jsx(Ea,{gizmoId:d,remixSourceId:x??void 0,version:p!=null?Number(p):void 0})})});export{_a as G,Sa as a,rn as c,on as g};
//# sourceMappingURL=i6e2mvyptqmk6cys.js.map
