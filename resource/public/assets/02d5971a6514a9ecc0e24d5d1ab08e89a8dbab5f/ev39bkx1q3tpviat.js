import{f as de,r as o,j as t,a8 as w,a9 as $,ai as fe}from"./msupklk377u8vx8o.js";import{hY as D,hZ as me,hX as k,h_ as b,gJ as xe,h$ as he,i0 as pe,i1 as ge,i2 as q,i3 as ve,i4 as we,i5 as be,i6 as ye,a2 as Te,av as je,i7 as Re,i8 as Se,i9 as F,ia as J,ib as M,ic as Ae,fJ as Ee,id as z,eS as Pe,eP as Ne,eQ as _e,eR as Ie,fI as De}from"./idf4u2jy0wx0pvap.js";import{d as Fe}from"./gc51ish3otzvnj1w.js";import{P as Y}from"./hwl3hzno2kq7obfl.js";import{c4 as G,ar as Me,ap as ke,aq as Ce,gA as Oe,c as R,ez as Be,u as Le}from"./i3bl95k8z8nuf4dv.js";import{T as We}from"./hmii3551qscelikg.js";function He({suggestionData:e,visualTreatment:n,composerController:r}){const i=de(),m=i.formatMessage(D.researchSuggestionInitial),h=o.useMemo(()=>[i.formatMessage(D.deepResearchPlaceholderBullet1),i.formatMessage(D.deepResearchPlaceholderBullet2),i.formatMessage(D.deepResearchPlaceholderBullet3)],[i]);return t.jsx(me,{composerController:r,visualTreatment:n,initialSuggestion:m,bulletPoints:h})}const L={type:"spring",stiffness:48.7,damping:13.54,mass:1};function ct({enabled:e,children:n,...r}){const i=k();return t.jsxs(w.div,{initial:{minHeight:0},animate:{minHeight:e?"142px":0},exit:{minHeight:0},transition:i?b:L,className:"flex flex-col justify-start",children:[n,e&&t.jsx(He,{...r})]})}const Q=.0025;function Ve({composerController:e,composerType:n,renderInComposer:r,composerRightButtonType:i,layoutMode:a}){const m=G(e.store,l=>l.controlsDisabled),h=xe(),{isUnauthenticated:y}=Me(),p=n==="vanguard"&&h&&!y,S=he(l=>{l.contentRect&&e.setWaveWidth(l.contentRect.width)}),c=o.useCallback(l=>{if(!(e instanceof Y))return;const v=e.getSelectionStart();e.setControlsDisabled(!1),requestAnimationFrame(()=>{const{state:j,dispatch:A}=e.view;A(j.tr.insertText(l,v,v)),requestAnimationFrame(()=>{e.setSelection(v+l.length)}),e.usedDictation=!0})},[e]),x=()=>{e.setControlsDisabled(!0)},g=t.jsx(q,{size:"small",onExit:x,visualTreatment:n,buttonClassName:n==="vanguard"?"h-7 min-h-7 w-7 min-w-7":"h-9 min-h-9 w-9 min-w-9",invertColor:p,disableTooltip:p}),T=l=>{l.preventDefault(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{e.focus()})})};let f;if(p)if(i===pe.SPEECH){const l=ke.getBooleanCookie(Ce.LastVoiceInteraction)??!1,v=j=>l?t.jsx(t.Fragment,{children:r?.(p,j)}):t.jsx(q,{...j,size:"small",onExit:x,buttonClassName:n==="vanguard"?"h-7 min-h-7 w-7 min-w-7":"h-9 min-h-9 w-9 min-w-9",invertColor:!0,disableTooltip:!0});f=t.jsx(ve,{layoutMode:a??"centered",onDictationExit:x,renderVoiceButton:v,restoreFocus:T})}else f=t.jsx(t.Fragment,{children:r?.()});else f=t.jsxs(t.Fragment,{children:[g,r?.()]});return{whisperControls:m?t.jsx(ge,{initialValue:Q,onSuccess:c,onWaveformDataUpdate:e.setWaveformData,onExit:()=>{e.setControlsDisabled(!1)},visualTreatment:n,buttonClassName:n==="vanguard"?"h-7 min-h-7 w-7 min-w-7":"h-9 min-h-9 w-9 min-w-9"}):f,waveContainerRef:S,handleTranscriptionSuccess:c}}const Ue=({composerController:e,placeholder:n,vanguard:r,composerConfigMenuType:i="tools",disableAutoFocus:a=!1,textareaMaxHeightClassName:m="max-h-[25dvh]"})=>{const h=o.useRef(null),y=o.useRef(null),{isMobileOS:p}=we(),S=o.useRef(!1);return o.useEffect(()=>{if(S.current)return;if(!(e instanceof Y))throw new Error(`Expected instance of ProseMirrorComposerController but got ${e.constructor.name}`);S.current=!0;const c=y.current;if(c!=null){const{value:x,selectionStart:g,selectionEnd:T}=c;e.view.dispatch(e.view.state.tr.insertText(x)),e.view.dispatch(e.view.state.tr.setSelection(We.create(e.view.state.doc,g+1,T+1))),c.style.display="none",c.value=""}h.current.appendChild(e.view.dom),e.view.dom.id=be,e.view.dom.dataset.virtualkeyboard="true",ye(e.view.dom),!Te()&&!Oe()&&!a&&requestAnimationFrame(()=>{e.view.focus()})},[e,a]),o.useEffect(()=>{e.setPlaceholder(n)},[n,e]),o.useEffect(()=>{e.logPageMount()},[]),t.jsxs("div",{ref:h,onKeyDown:je.prefetch,className:R([Se["prosemirror-parent"],"text-token-text-primary",m,"max-h-52",i!=="none"&&"-mx-3 px-3","overflow-auto [scrollbar-width:thin]",Be()?"firefox":"default-browser"],i!=="none"&&"vertical-scroll-fade-mask",r&&"min-h-12 pe-3"),children:[t.jsx("textarea",{className:R("text-token-text-primary placeholder:text-token-text-tertiary block h-10 w-full resize-none border-0 bg-transparent px-0 py-2 ring-0 placeholder:ps-px"),autoFocus:!p,placeholder:n,ref:y,"data-virtualkeyboard":!0}),t.jsx(Re,{scriptSrc:"window.__oai_logHTML?window.__oai_logHTML():window.__oai_SSR_HTML=window.__oai_SSR_HTML||Date.now();requestAnimationFrame((function(){window.__oai_logTTI?window.__oai_logTTI():window.__oai_SSR_TTI=window.__oai_SSR_TTI||Date.now()}))"})]})},K=48,X=32,qe="/c/:conversationId",ut=({disableAutoFocus:e=!1,isBigBoxModeActive:n=!1,isTemporaryChat:r,placeholder:i,composerController:a,children:m,isExpandedByDefault:h=!1,visualTreatment:y,textareaMaxHeightClassName:p,onSubmit:S})=>{let c=null,x=null;const g=[],T=[];let f=null;const E=[];let l=null,v=null,j=null;o.Children.forEach(m,s=>{if(o.isValidElement(s))if(s.type===Je){if(f!=null)throw new Error("PromptTextareaComposer only accepts a single app stack");f=s}else if(s.type===Ye){if(c!=null)throw new Error("PromptTextareaComposer only accepts a single submit button");c=s}else if(s.type===tt){if(x!=null)throw new Error("PromptTextareaComposer only accepts a single header action");x=s}else s.type===Qe||s.type===Ge?g.push(s):s.type===Ze?T.push(s):s.type===st?E.push(s):s.type===et?l=s:s.type===$e?v=s:s.type===Xe&&(j=s)});const A=o.useRef(null),W=o.useRef(null),{waveContainerRef:Z}=Ve({composerController:a,composerType:"vanguard"}),{controlsDisabled:ee,waveformData:H,waveWidth:te}=G(a.store),d=F(s=>s.isExpanded),C=F(s=>s.setIsExpanded),V=o.useRef(!1),P=k(),U=o.useSyncExternalStore(s=>{const u=a.subscribe("focus",s),I=a.subscribe("blur",s);return()=>{I(),u()}},()=>a.isFocused(),()=>!1),se=s=>{if(s.target instanceof HTMLElement){if(s.target.dataset.historyItemLink||s.target.parentElement?.dataset.historyItemLink)return!0;const u=s.target?.closest("a[href]");if(u instanceof HTMLAnchorElement)return!!fe({path:qe,end:!1},new URL(u.href).pathname)}return!1};o.useEffect(()=>a.subscribe("change",()=>{V.current=!a.isEmpty()}),[a]),o.useEffect(()=>{U&&!d&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{C(!0)})})},[U,d,C]);const N=F(s=>s.isVisuallyOverflowing),O=o.useRef(N);Le(()=>{O.current=N},[N]);const B=F(s=>s.setIsVisuallyOverflowing),ne=o.useRef(null),ae=s=>{const u=I=>{h||V.current||s?.contains(I.target)||se(I)||C(!1)};return document.addEventListener("click",u),ne.current=s,()=>{document.removeEventListener("click",u)}},ie=s=>{s.preventDefault(),S(s)},_=g.length>0,oe=T.length>0,[re,le]=o.useState(0),ce=24,{showLegacyReasoningSlider:ue}=J();return t.jsxs("form",{ref:ae,className:"w-full [view-transition-name:var(--vt-composer)]",onSubmit:ie,"data-type":"unified-composer",children:[t.jsxs(Ke,{isTemporaryChat:r,children:[t.jsxs("div",{className:"relative flex w-full items-end px-3 py-3",children:[t.jsxs(w.div,{transition:P?b:M,className:"relative flex w-full flex-auto flex-col",children:[E.length>0&&t.jsx("div",{className:R("flex flex-col gap-2",y==="composer-btn"?"mb-2 has-data-fullbleed:-mt-1 has-data-fullbleed:w-[calc(100%+1rem)]":"mb-4"),children:E}),t.jsxs("div",{className:"relative ms-1.5 grid grid-cols-[auto_minmax(0,1fr)]",children:[t.jsx("div",{className:"items-top flex justify-center",children:t.jsx(w.div,{initial:{opacity:d?1:0},animate:{opacity:d?1:0},exit:{opacity:0},transition:P?b:Ae,children:x})}),t.jsx(w.div,{initial:{marginBottom:-20,translateX:d||!f?0:X},onPointerDown:s=>s.stopPropagation(),animate:{translateX:d||!f?0:X},style:{translateY:-7},transition:P?b:M,className:"relative flex-auto bg-transparent pt-0.5",children:t.jsxs(ze,{composerController:a,enabled:n&&d,children:[t.jsx("div",{className:"flex min-h-12 items-start",ref:Z,children:t.jsx("div",{className:"max-w-full min-w-0 flex-1",children:ee?H?t.jsx(Ee,{waveform:H,containerWidth:te,scaleFactor:10,initialValue:Q}):null:t.jsx(Ue,{composerController:a,placeholder:i,disableAutoFocus:e,textareaMaxHeightClassName:p,vanguard:!0})})}),v]})})]}),t.jsx("div",{className:"justify-content-end relative ms-2 flex w-full flex-auto flex-col",children:t.jsx("div",{className:"flex-auto"})}),t.jsx(w.div,{initial:{height:d&&(_||c)?K:0},animate:{height:d&&(_||c)?K:0},transition:P?b:M})]}),(_||!!c)&&t.jsx("div",{className:R("bg-primary-surface-primary absolute start-3 end-0 bottom-3 z-2 flex items-center"),children:t.jsxs("div",{className:"w-full",children:[_&&d&&t.jsx("div",{"data-testid":"composer-footer-actions",className:R("flex items-center",y!=="composer-btn"&&"max-xs:gap-1 gap-2 overflow-x-auto [scrollbar-width:none]",!ue&&N&&"[--force-hide-label:none]"),ref:s=>z({debounce:!0,target:s,axis:"width",onChange:({width:u})=>{s&&(O.current?O.current&&A.current!==null&&u>=A.current&&B(!1):W.current!==null&&u<W.current?B(!0):(A.current=s.scrollWidth,B(s.scrollWidth>s.clientWidth)))}}),style:{marginRight:`${re+ce}px`},children:g}),t.jsxs("div",{className:"absolute end-3 bottom-0 flex items-center gap-2","data-testid":"composer-trailing-actions",ref:s=>z({target:s,axis:"width",onChange:({width:u})=>{le(u)}}),children:[oe&&t.jsx("div",{className:"relative ms-1",children:T}),c]})]})}),t.jsx("div",{className:"absolute start-4 top-3 ms-[1px] flex items-center pb-px",children:t.jsx($,{children:!d&&f})})]}),j]}),t.jsxs(Pe,{open:!!l,children:[t.jsx(Ne,{className:"w-full"}),t.jsx(_e,{children:t.jsx(Ie,{side:"bottom",align:"start",sideOffset:12,onOpenAutoFocus:s=>s.preventDefault(),children:l})})]})]})};function ze({composerController:e,children:n,enabled:r}){const i=k();return t.jsx(w.div,{initial:!1,animate:{minHeight:r?"142px":0},exit:{minHeight:0},transition:i?b:M,className:"flex flex-col justify-start",onClick:a=>{e.isFocused()?a.preventDefault():e.focus()},children:n})}function Ke({children:e,isTemporaryChat:n}){const{configurationMenuType:r}=J(),i=r!=="none",a=Fe();return t.jsx(De,{onClick:m=>{!a.isFocused()&&!m.defaultPrevented&&a.focus()},className:R("flex w-full cursor-text flex-col items-center justify-center rounded-[28px] bg-clip-padding contain-inline-size","overflow-clip",i?"shadow-short":"border-token-border-default border shadow-sm sm:shadow-lg dark:shadow-none!",n?"dark bg-[#303030]":"bg-token-bg-primary dark:bg-[#303030]"),children:e})}const Xe=({children:e})=>{const n=k(),a={initial:{opacity:0,height:0,y:"-28px"},animate:{opacity:1,y:0,height:"56px",transition:n?b:{opacity:{delay:.2},default:L}},exit:{opacity:0,y:"-28px",height:0,transition:n?b:{opacity:{delay:0},default:L}}};return t.jsx($,{children:e&&t.jsx(w.div,{variants:a,initial:"initial",animate:"animate",exit:"exit",className:"relative w-full",children:e})})},$e=({children:e})=>t.jsx(t.Fragment,{children:e}),Je=({children:e})=>t.jsx(w.div,{onPointerDown:n=>{n.stopPropagation(),n.preventDefault()},children:e}),Ye=({children:e})=>t.jsx("div",{className:"ms-auto flex items-center gap-1.5",onPointerDown:n=>n.stopPropagation(),children:e}),Ge=({children:e})=>e?t.jsx(t.Fragment,{children:e}):null,Qe=({children:e})=>t.jsx("div",{onPointerDown:n=>n.stopPropagation(),children:e}),Ze=({children:e})=>t.jsx("div",{onPointerDown:n=>n.stopPropagation(),children:e}),et=({children:e})=>t.jsx("div",{onPointerDown:n=>n.stopPropagation(),children:e}),tt=({children:e})=>t.jsx("div",{onPointerDown:n=>n.stopPropagation(),children:e}),st=({children:e,width:n="full"})=>t.jsx("div",{className:R(n==="fit"?"w-fit":"w-full"),onPointerDown:r=>r.stopPropagation(),children:e});export{Ge as B,ut as C,Qe as F,st as H,Q as I,Ue as R,Ye as S,Ze as T,ct as a,L as b,et as c,$e as d,He as e,Ve as u};
//# sourceMappingURL=ev39bkx1q3tpviat.js.map
