const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/fyd734llpbdugok3.js","assets/msupklk377u8vx8o.js","assets/idf4u2jy0wx0pvap.js","assets/i3bl95k8z8nuf4dv.js","assets/root-en2soewk.css","assets/conversation-small-irmw3ffz.css","assets/hwl3hzno2kq7obfl.js","assets/hmii3551qscelikg.js","assets/i3xeaua08fnq6vw7.js","assets/dvg0o2fvp4wxkenq.js","assets/jpu6co9tyq545zyz.js","assets/nd3es8msynh3n7xc.js","assets/h5ggwu3ho4a2eo93.js","assets/edgafuoc6xivwz0d.js","assets/lvc34l5biwha9w7t.js","assets/l0hp1g1dyfwzfw82.js","assets/ohwrmnkvkdb4hdjp.js","assets/exki82npk7hw7g59.js","assets/gwmfzjrffpu4d2tx.js","assets/vieocwuyvvf28lwx.js","assets/lm1rmwueprcm5uwi.js","assets/hu4ci70fpsy8huk5.js","assets/hsdrd0g4wxszpwci.js","assets/csbo06cvz0f93p4n.js","assets/dkomeekimnulr2tm.js","assets/k08vflseu4ufd1p2.js","assets/bxvybsm8xf7u0vz6.js","assets/nr2o0yx4ps6bt6je.js","assets/gj4dzvxqws2uayv0.js","assets/cwv4mt186w1kpq9b.js","assets/hjl8i43v977zmrf7.js","assets/itgdzgk5z1u7l0jj.js","assets/onklb7txlsriyspd.js","assets/b2dyy1jg95n5gtr8.js","assets/gc51ish3otzvnj1w.js","assets/ojiial81qrlp15mq.js","assets/play-sm-1f6vhsjh.css","assets/ojrw0o0rizu55rz7.js","assets/ev39bkx1q3tpviat.js","assets/mxye9dnv7ug9w78j.js","assets/mmjudc45gj99bpja.js","assets/hykg4shppjdez6do.js","assets/bl75917ayi16sr8y.js","assets/gvsp7fy7hloerc2p.js","assets/b8sq4gagi5vun041.js","assets/k0gfwt82z96kzlbw.js","assets/etqfvs5ggajp1a11.js","assets/iot0cxie20e0du89.js","assets/nxqfgrk9atl9s5yp.js","assets/FormattedText-kb0ehjj7.css","assets/cot-message-lf3q5fj1.css","assets/es8rozmr0k9re84h.js","assets/iyjmmo9kb0jopwec.js","assets/b9ojgyolkdxleedp.js","assets/fznat16kjgzb6hqv.js","assets/crzx5wntyeiu3q18.js"])))=>i.map(i=>d[i]);
import{g as ke,r as He,c as y,bJ as We,aB as Je,dL as X,dC as Xe,bo as K,g2 as Ke,bW as Ee,B as Q,bs as J,f7 as $e,an as Qe,bC as Ye,ax as Ce,bj as B,dx as Ae,F as ee,gX as Ze,gY as G,fv as qe,dM as Ge,cG as es,ep as me,eo as ss,aw as ts,e0 as as,d2 as ns,e1 as p,bG as is,bH as os,g1 as de,v as N,ce as rs,u as ls,dF as cs,_ as E}from"./i3bl95k8z8nuf4dv.js";import{f as se,r as g,j as e,M as T,a9 as F,a8 as L,a as ms}from"./msupklk377u8vx8o.js";import{mp as ds,mq as us,fO as Te,mr as fs,ms as gs,fm as xs,fn as ps,av as Y,mt as hs,mu as _s,mv as ys,mw as js,lI as bs,mx as vs,my as ue,mz as W,mA as fe,mB as Ss,V as Ns,L as ge,mC as ks,mD as Es,mE as Cs,fA as As,dk as we,cO as Me,am as De,ar as $,mF as Ts,mG as ws,mH as xe,mI as Oe,ee as Ms,mJ as Ds,mK as Os,mL as Ls,mM as Rs,bI as Is,bH as Ps,k9 as Fs,mN as Bs,mc as Us,mO as Vs,mP as zs,mQ as Hs,aA as Ws,mR as Js,jA as Xs,jc as pe,mS as Ks,mT as $s,mU as Qs,mV as Le,jI as Ys,mW as Zs,mX as qs,at as Gs,mY as et,mZ as st,m_ as tt,m$ as he,eg as at}from"./idf4u2jy0wx0pvap.js";import{u as nt}from"./hwl3hzno2kq7obfl.js";const Z={div:s=>{const{node:n,children:t,...a}=s;return e.jsx("div",{...a,className:"text-red-500",children:t})},p:s=>{const{node:n,children:t,...a}=s;return e.jsx("p",{...a,className:"text-token-text-primary text-start leading-6",children:t})},a:s=>{const{node:n,children:t,...a}=s;return e.jsx("a",{...a,className:"font-sm text-token-text-primary! leading-6",children:t})}},it=1e3*60*2,ot=30;function Re({taskId:s,clientThreadId:n,onClick:t,statusMessage:a,showSources:i,includeMargin:o,sources:l,progressBar:c}){const r=Te(),[d,u]=g.useState(!1),x=ke(),f=He(x,"2007855518");return e.jsxs(e.Fragment,{children:[s&&d&&e.jsx(fs,{taskId:s,clientThreadId:n,onClose:()=>u(!1)}),e.jsxs("div",{className:"relative flex w-4/5 max-w-[416px]",children:[s&&f&&e.jsx("button",{onClick:()=>u(!0),disabled:!s,className:"hover:bg-token-bg-elevated-secondary bg-token-bg-elevated-primary absolute end-4 bottom-4 flex items-center justify-center rounded-full border border-black/10 p-0.5 dark:border-white/10",children:e.jsx(gs,{className:"icon-lg"})}),e.jsx("button",{onClick:()=>r&&t(),className:y("bg-token-main-surface-primary mt-4 flex w-full items-start justify-start gap-[18px] rounded-2xl border border-black/10 px-5 py-4 shadow-sm dark:border-white/10",r?"hover:bg-token-main-surface-secondary cursor-pointer":"cursor-auto"),children:e.jsxs("div",{className:"flex w-full flex-col gap-3",children:[e.jsxs("div",{className:y("flex flex-col items-start justify-start self-stretch md:h-7 md:flex-row md:items-center md:justify-between",i?"h-12":"h-6"),children:[e.jsx("div",{className:y("font-sm text-token-text-primary w-full flex-1 truncate text-start leading-7 md:w-0",o&&"me-[30px]"),children:a}),i&&l]}),e.jsx("div",{className:y("flex w-full items-center justify-start gap-4 self-stretch pb-2",s&&f&&"pe-10"),children:c})]})})]})]})}function te({taskId:s,clientThreadId:n,toggleSidebar:t,openSidebar:a,startTime:i}){const o=se(),[l,c]=g.useState(!1),r=ds();return g.useEffect(()=>{if(!i)return;const d=Date.now()-i,u=it-d;if(u>0){const x=setTimeout(()=>{c(!0),a()},u);return()=>clearTimeout(x)}else c(!0),a()},[i,a]),e.jsx(Re,{taskId:s,clientThreadId:n,onClick:t,statusMessage:l?o.formatMessage({id:"T2SbxC",defaultMessage:"Waiting…"}):e.jsx("div",{className:"text-token-text-primary text-sm font-medium text-pretty",children:r.startingMessage}),progressBar:e.jsx(us,{className:"h-2 w-full"}),showSources:!1})}function rt(s,n,t){const a=s.formatMessage({id:"Bs+OcV",defaultMessage:"Thinking…"});if(n.length<2)return t?.initial??a;const i=n[n.length-2];return i.type==="summary"?i.title:i.type==="search"?i.query:i?.type==="websiteOpen"?e.jsx(Y,{componentOverrides:Z,children:i.activeRowText}):i.type==="fileOpen"?e.jsx(Y,{componentOverrides:Z,children:i.activeRowText}):i.type==="pythonAnalysis"?e.jsx(Y,{componentOverrides:Z,children:i.analysisSummary}):a}function lt({task:s,clientThreadId:n,caterpillarRows:t,messageWithTaskMetadata:a,totalSources:i,handleToggleCaterpillarSidebar:o}){const l=se(),c=Te(),r=rt(l,t,a.metadata?.async_task_status_messages),d=(s?.expectedDurationMinutes??ot)*60*1e3,u=xs(t[1]?.created_at?t[1].created_at*1e3:Date.now(),d),x=t[1]&&t[1].created_at?u:0;g.useEffect(()=>{We(n,j=>{j.async_status=Je.STREAMING})},[n]);const{openThreadSidebar:f}=X();g.useEffect(()=>{t.length===2&&c&&f({type:"caterpillar",caterpillarId:s.taskId,initialTab:"activity",clientThreadId:n})},[t.length,f,s.taskId,n,c]);const _=g.useCallback(()=>{f({type:"caterpillar",caterpillarId:s.taskId,initialTab:"activity",clientThreadId:n})},[f,s.taskId,n]);return t.length<=1?e.jsx(te,{taskId:s.taskId,clientThreadId:n,toggleSidebar:()=>o("activity"),openSidebar:_,startTime:new Date(s.createdAt).getTime()}):e.jsx(Re,{taskId:s.taskId,clientThreadId:n,onClick:()=>o("activity"),statusMessage:r,showSources:!0,includeMargin:i>0,sources:i===0?e.jsx("div",{className:"text-token-text-tertiary text-sm text-pretty",children:e.jsx(T,{id:"zfwUjs",defaultMessage:"Looking for sources…"})}):e.jsxs("button",{onClick:j=>{j.stopPropagation(),o("sources")},className:y("flex shrink-0 gap-1 text-[13px] leading-[18px] text-[#0285ff]",c?"cursor-pointer hover:text-[#0285ff]/80":"cursor-auto"),children:[e.jsx("div",{className:"relative",children:e.jsx(F,{initial:!1,children:e.jsx(L.span,{initial:{opacity:0,rotateX:-90,translateY:20},animate:{opacity:1,rotateX:0,translateY:0},exit:{opacity:0,rotateX:90,translateY:-20},transition:{duration:.35},className:"absolute start-0 md:end-0",children:i},i)})}),e.jsx("div",{className:y("md:pe-0",i>0&&"ps-2",i>9&&"ps-[14px]",i>99&&"ps-[22px]"),children:i>1?e.jsx(T,{id:"zN+MuO",defaultMessage:" sources"}):e.jsx(T,{id:"dMowmJ",defaultMessage:" source"})})]}),progressBar:e.jsx("div",{className:"bg-token-main-surface-tertiary flex h-2 shrink grow basis-0 items-start justify-start gap-2.5 overflow-hidden rounded-[10px]",children:e.jsx(ps,{percentage:x,barClassName:"bg-token-text-primary",backgroundClassName:"bg-token-main-surface-tertiary"})})})}function ct({messages:s,clientThreadId:n}){const t=s.find(d=>d.metadata?.b1de6e2_s&&d.metadata?.async_task_id),a=t?.metadata?.async_task_id,i=s.find(d=>d.recipient===Xe.START_RESEARCH_TASK),o=K(n,d=>Ss(d,i?.id)),l=Ke({clientThreadId:n}),[c,r]=g.useState(l);return g.useEffect(()=>{const d=setTimeout(()=>{r(o&&l)},3e3);return()=>clearTimeout(d)},[l,o]),!t||!a?c?e.jsx(te,{taskId:a,clientThreadId:n,toggleSidebar:()=>{},openSidebar:()=>{},startTime:new Date().getTime()}):null:e.jsx(mt,{clientThreadId:n,payloadTaskId:a,messageWithTaskMetadata:t})}function mt({payloadTaskId:s,messageWithTaskMetadata:n,clientThreadId:t}){hs(s,n,t);const a=_s(f=>s?f.tasks[s]:null),i=se(),o=a?.status,l=g.useMemo(()=>a?.rows?a.rows:[],[a?.rows]),{toggleThreadSidebar:c}=X(),{totalSources:r,totalSearches:d}=g.useMemo(()=>{if(!l)return{uniqueSources:[],totalSources:0,totalSearches:0};const f=ys(l),_=f.reduce((v,k)=>v+k.count,0),j=js(l);return{uniqueSources:f,totalSources:_,totalSearches:j}},[l]),u=bs("caterpillar"),x=g.useCallback(f=>{s&&c({type:"caterpillar",caterpillarId:s,initialTab:f,clientThreadId:t},u)},[c,s,u,t]);return vs(s),n.metadata?.async_task_status_messages?.completed_with_time?e.jsx(ue,{task:a,clientThreadId:t,messageWithTaskMetadata:n,totalSources:r,totalSearches:d,handleToggleCaterpillarSidebar:x}):!a||!o||o===W.UNDETERMINED?e.jsx(te,{taskId:s,clientThreadId:t,toggleSidebar:()=>{},openSidebar:()=>{},startTime:new Date().getTime()}):a.status===W.COMPLETED?e.jsx(ue,{task:a,clientThreadId:t,messageWithTaskMetadata:n,totalSources:r,totalSearches:d,handleToggleCaterpillarSidebar:x}):a.status===W.FAILED?e.jsx(fe,{message:n.metadata?.async_task_status_messages?.error??i.formatMessage({id:"at6zk8",defaultMessage:"Failed to think"}),handleToggleCaterpillarSidebar:()=>x("activity")}):a.status===W.CANCELLED?e.jsx(fe,{message:n.metadata?.async_task_status_messages?.cancelled??i.formatMessage({id:"u1rIr5",defaultMessage:"Task Cancelled"}),handleToggleCaterpillarSidebar:()=>x("activity")}):e.jsx(lt,{task:a,clientThreadId:t,caterpillarRows:l,messageWithTaskMetadata:n,totalSources:r,handleToggleCaterpillarSidebar:x})}function dt(s,n,t){const a=n.elements.length;if(a===0)return;const i=Object.entries(s).reduce((o,[l,c])=>Array.isArray(c)?c.length>0?o+1:o:c!==""?o+1:o,0);Qe.logEventWithStatsig("dynamic-form-submission","chatgpt_dyanmic_form_submission",{...Ye({clientThreadId:t}),totalItems:a.toString(),completedItems:i.toString(),ratio:(i/a).toString()})}function ut(s,n){let t="";return n.elements.forEach(a=>{const i=a.scope.split("/").pop(),o=i&&s[i],l=o?Array.isArray(o)?o.join(", "):o:"Any",c=a.label??i;t+=`${c}: ${l}
`}),t}function ft({messages:s,clientThreadId:n,isLastMessage:t}){const a=s.find(S=>S.author.role===Ee.Assistant),i=s.find(S=>S.metadata?.json_form),o=i?.metadata?.json_form,[l,c]=g.useState({}),[r,d]=g.useState(),[u,x]=g.useState(),f=Ns(),_=nt(n);g.useEffect(()=>{o&&(d(o.json_form_ui),x(o.json_form_data))},[o]);const j=g.useCallback(()=>{if(c({}),r){const S={...r,elements:r.elements.filter(D=>D.scope!=="#/properties/AdditionalInfo")};d(S)}u&&(delete u.properties.AdditionalInfo,x(u))},[c,d,x,r,u]),v=g.useCallback(()=>{if(r){const S={...r,elements:[...r.elements,{type:"Control",scope:"#/properties/AdditionalInfo",label:"Additional Info",placeholder:"Any other details..."}]};d(S)}if(u){const S={...u.properties,AdditionalInfo:{type:"string"}};x({...u,properties:S})}},[d,x,r,u]),k=r?.elements.some(S=>S.scope.endsWith("#/properties/AdditionalInfo")),w=K(n,Ce.getCurrentLeafId),C=i?.id!==w;if(!i||!u||!r)return a?.status==="in_progress"&&t?e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(ge,{className:"h-[26px] w-full"}),e.jsx(ge,{className:"h-[26px] w-3/4"}),e.jsx(ks,{})]}):null;if(C)return null;const P=async S=>{const D=ut(l,r);dt(l,r,n),_({sourceEvent:S,promptMessage:$e(D),completionMetadata:{systemHints:[...f],conversationMode:{kind:J.PrimaryAssistant}}})};return e.jsxs(Es,{children:[e.jsx(gt,{formData:l,dataSchema:u,uiSchema:r,setData:c,readOnly:C}),e.jsxs("div",{className:"flex w-full justify-between",children:[k?e.jsx("div",{}):e.jsx(Q,{disabled:C,onClick:v,color:"secondary",className:"text-token-text-secondary",children:e.jsx(T,{id:"Sen69P",defaultMessage:"Add a detail"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Q,{disabled:C,onClick:j,color:"secondary",className:"text-token-text-secondary",children:e.jsx(T,{id:"Uqo7UD",defaultMessage:"Reset"})}),e.jsx(Q,{disabled:C,onClick:P,children:e.jsx(T,{id:"FVou++",defaultMessage:"Start"})})]})]})]})}function gt({dataSchema:s,uiSchema:n,setData:t,readOnly:a,formData:i}){return e.jsx("div",{children:e.jsx(Cs,{formData:i,readOnly:a,schema:s,uiSchema:n,onChange:o=>t(o)})})}const _e=4;function xt({navigation:s,onShowSearchResults:n,trackContentReferenceEvent:t}){const{value:a}=B("3472722167"),i=s.domains.filter(r=>r.url);g.useEffect(()=>{t("Search Content Reference Shown","search_content_reference_shown",s.type,{urls:i.map(r=>r.url).join(",")})},[i]);let o=[],l=[];const c=i[0].sub_domains.length>0&&a;return i.length>3||c?(o=[i[0]],l=i.slice(1,_e)):o=i,e.jsxs("div",{className:y("not-prose mb-3 flex gap-2",l.length>0?"flex-col":"flex-row"),children:[o.map((r,d)=>e.jsx(ye,{isPrimaryDomain:d===0,isFistLineDomain:!0,navigationDomain:r,trackContentReferenceEvent:t,analyticsMetadata:{section_index:d}},r.url)),l.length>0&&e.jsxs("div",{className:"flex items-stretch gap-2",children:[l.map((r,d)=>e.jsx(ye,{navigationDomain:r,trackContentReferenceEvent:t,analyticsMetadata:{section_index:o.length+d}},r.url)),s.domains.length>_e&&e.jsx(pt,{onShowSearchResults:n,trackContentReferenceEvent:t})]})]})}const Ie=ee.div`border border-token-border-default shadow-xxs hover:bg-token-main-surface-secondary dark:border-token-border-xlight dark:bg-token-main-surface-secondary dark:hover:bg-token-main-surface-tertiary`,pt=({onShowSearchResults:s,trackContentReferenceEvent:n})=>e.jsx(Ie,{className:"flex w-8 cursor-pointer items-center justify-center rounded-xl",onClick:()=>{n("Search Content Reference Clicked","search_content_reference_clicked","navigation",{sidebar:"sidebar"}),s(we.Sources,Me.Links)},children:e.jsx(As,{className:"opacity-50"})}),ye=({isPrimaryDomain:s,isFistLineDomain:n,navigationDomain:t,trackContentReferenceEvent:a,analyticsMetadata:i})=>(g.useEffect(()=>{a("link_action","link_action","navigation",{url:t.url,title:t.title,link_type:"card",action:"show",section:"fast_nav",section_location:"response",section_index:i.section_index})},[]),e.jsx("div",{className:y("flex-1",s?"min-w-[40%]":"min-w-0"),children:e.jsx(ht,{isFistLineDomain:n,isPrimaryDomain:s,title:t.title,subtitle:t.subtitle??void 0,url:t.url,domain:t.domain,subDomains:t.sub_domains,trackContentReferenceEvent:a,analyticsMetadata:i})})),ht=({isFistLineDomain:s,isPrimaryDomain:n,title:t,subtitle:a,url:i,subDomains:o,trackContentReferenceEvent:l,analyticsMetadata:c})=>{const{value:r}=B("3472722167"),[d,u]=g.useState(!1),x={url:i,title:t,link_type:"card",section:"fast_nav",section_location:"response",section_index:c.section_index};o.length>0;const f=Ae()?"_self":"_blank";return e.jsxs(Ie,{className:"group/navigation text-token-link flex flex-col rounded-2xl",children:[e.jsxs(De,{href:i,target:f,onClick:()=>l("link_action","link_action","navigation",{...x,action:"click"}),onMouseEnter:()=>{l("link_action","link_action","navigation",{...x,action:"hover"})},className:y("flex flex-row items-center gap-2",s?"px-4 py-3":"px-4 py-2.5"),children:[e.jsx("div",{className:"flex h-8 w-8 shrink-0 items-center justify-center rounded-full bg-[#1D53BF0D] group-hover/navigation:bg-[#1D53BF1A] dark:bg-[#7CA8FF33] dark:group-hover/navigation:bg-[#7CA8FF33]",children:e.jsx($,{url:i,size:32,minSize:20,className:"icon-sm rounded-full"})}),e.jsxs("div",{className:"flex min-w-0 flex-col gap-0.5",children:[e.jsxs("div",{className:y("flex items-center gap-1 font-semibold",s?"text-sm":"text-xs"),children:[e.jsx("span",{className:"flex-1 truncate",children:t}),!1]}),e.jsx("div",{className:"truncate text-xs",children:a})]})]}),!1]})},q=3,_t=3;function yt({navigation:s,onShowSearchResults:n,trackContentReferenceEvent:t}){const{value:a}=B("756982149"),i=g.useContext(Ts)!=null,o=g.useContext(ws);return e.jsx("div",{className:y({hidden:o&&i}),children:a?e.jsx(jt,{navigation:s,onShowSearchResults:n,trackContentReferenceEvent:t}):e.jsx(xt,{navigation:s,onShowSearchResults:n,trackContentReferenceEvent:t})})}function jt({navigation:s,onShowSearchResults:n,trackContentReferenceEvent:t}){const a=s.domains.filter(l=>l.url);g.useEffect(()=>{t("Search Content Reference Shown","search_content_reference_shown",s.type,{urls:a.map(l=>l.url).join(",")})},[a]);const i=a.slice(0,q),o=a.slice(q,q+_t);return e.jsxs("div",{className:"not-prose mb-3 flex gap-2",children:[i.map((l,c)=>e.jsx(vt,{isPrimaryDomain:c===0,isFistLineDomain:!0,navigationDomain:l,trackContentReferenceEvent:t,analyticsMetadata:{section_index:c}},l.url)),o.length>0&&e.jsx(bt,{onShowSearchResults:n,trackContentReferenceEvent:t,moreDomains:o})]})}const bt=({onShowSearchResults:s,trackContentReferenceEvent:n,moreDomains:t})=>e.jsx(Pe,{component:"div",className:"group flex w-28 cursor-pointer",onClick:()=>{n("Search Content Reference Clicked","search_content_reference_clicked","navigation",{sidebar:"sidebar"}),s(we.Sources,Me.Links)},children:e.jsxs("div",{className:"flex min-w-0 flex-col",children:[e.jsx("div",{className:"flex items-center",children:t.map((a,i)=>e.jsx("div",{style:{zIndex:t.length-i},className:"ms-[-6px] first:ms-0",children:e.jsx("div",{className:y("flex h-4 w-4 items-center overflow-hidden rounded-full","border-token-main-surface-primary bg-token-main-surface-primary group-hover:border-token-bg-tertiary border-2"),children:e.jsx($,{url:a.url,size:32,minSize:20,className:"icon-xs rounded-full"})},a.url)},a.url))}),e.jsx("div",{className:"text-token-text-primary flex text-sm font-semibold",children:e.jsx("span",{className:"truncate",children:e.jsx(T,{id:"B5xwY8",defaultMessage:"More links"})})})]})}),vt=({isPrimaryDomain:s,isFistLineDomain:n,navigationDomain:t,trackContentReferenceEvent:a,analyticsMetadata:i})=>(g.useEffect(()=>{a("link_action","link_action","navigation",{url:t.url,title:t.title,link_type:"card",action:"show",section:"fast_nav",section_location:"response",section_index:i.section_index})},[]),e.jsx("div",{className:"min-w-0 flex-1",children:e.jsx(St,{isFistLineDomain:n,isPrimaryDomain:s,title:t.title,subtitle:t.subtitle??void 0,url:t.url,domain:t.domain,subDomains:t.sub_domains,trackContentReferenceEvent:a,analyticsMetadata:i})})),St=({isFistLineDomain:s,title:n,subtitle:t,url:a,trackContentReferenceEvent:i,analyticsMetadata:o})=>{const l={url:a,title:n,link_type:"card",section:"fast_nav",section_location:"response",section_index:o.section_index},c=Ae(Ze())?"_self":"_blank";return e.jsxs(Pe,{component:De,href:a,target:c,onClick:()=>i("link_action","link_action","navigation",{...l,action:"click"}),onMouseEnter:()=>{i("link_action","link_action","navigation",{...l,action:"hover"})},className:"flex flex-col gap-[2px]",children:[e.jsxs("div",{className:"text-token-text-secondary flex items-center gap-[6px] text-xs",children:[e.jsx($,{url:a,size:32,minSize:20,className:"icon-xs rounded-full"}),e.jsx("div",{className:"truncate",children:t})]}),e.jsx("div",{className:y("text-token-text-primary flex items-center font-medium",s?"text-sm":"text-xs"),children:e.jsx("span",{className:"truncate",children:n})})]})},Pe=({component:s,children:n,className:t,...a})=>e.jsx(s,{...a,className:y("hover:bg-token-main-surface-secondary border-token-border-light rounded-2xl border px-4 py-3",t),children:n}),Nt=2e3,Fe=.4,kt=.45,Et=.2,Ct=.1,At=.25;var R=(s=>(s[s.Running=0]="Running",s[s.Finished=1]="Finished",s[s.Error=2]="Error",s[s.Stopped=3]="Stopped",s[s.Paused=4]="Paused",s))(R||{});function ra({conversationMessages:s,icon:n,status:t,text:a,estimatedToolDurationMs:i,animationLoopDurationMs:o=Nt,shouldPersistAfterFinished:l=!1}){const[c,r]=g.useState(t===0?0:t===1&&!l?7:1),[d,u]=g.useState(0);g.useEffect(()=>{t===2?r(8):t===3?r(9):t===4?r(10):t===1?r(c===2?3:7):t===0&&c===10&&(r(2),u(f=>f+1))},[t]);const x=Mt(c);return g.useEffect(()=>{const f=s[0].id;if(x)return xe.addDelayedRenderingMessage(f),()=>{xe.removeDelayedRenderingMessage(f)}},[x]),Oe(()=>{I(c)&&u(f=>f+1)},o),c===7&&!l?null:e.jsxs("div",{className:"my-2.5 flex items-center gap-2.5",children:[e.jsx(Tt,{icon:n,status:t,uiState:c,estimatedToolDurationMs:i,animationLoopCounter:d,shouldPersistAfterFinished:l,onFillProgressBarAnimationComplete:()=>r(4),onFinishAnimationComplete:()=>{r(5),setTimeout(()=>{r(l?7:6)},Ct*1e3)},onHideAnimationComplete:()=>r(7)}),e.jsx(wt,{text:a,uiState:c,animationLoopCounter:d,onEnterAnimationComplete:()=>r(2)})]})}const je=50;function Tt({icon:s,status:n,uiState:t,estimatedToolDurationMs:a,animationLoopCounter:i,shouldPersistAfterFinished:o,onFillProgressBarAnimationComplete:l,onFinishAnimationComplete:c,onHideAnimationComplete:r}){const[d,u]=g.useState(0);Oe(()=>{I(t)?u(C=>C+je):t===10&&u(0)},je);let x,f,_;I(t)||t===10?(x="running",f=e.jsx(s,{animationLoopCounter:i}),_="bg-transparent"):t===4||t===5||t===7&&o?(x="finished",f=e.jsx(Os,{}),_="bg-brand-purple"):n===2?(x="error",f=e.jsx(Ls,{}),_="bg-orange-500"):n===3&&(x="stopped",f=e.jsx(Rs,{}),_="bg-gray-300");let j={opacity:0,scale:0,rotate:-180,x:0},v={type:"spring",bounce:.3,duration:kt},k={opacity:0,scale:.6,rotate:0,x:0};t===0?(j={opacity:0,scale:.5,rotate:-180,x:-8},v={type:"spring",bounce:.3,duration:Fe}):t===1?j=!1:t===5&&(k={opacity:0,scale:0,rotate:0,x:0},v={type:"spring",bounce:.3,duration:At});const w=Ds(d,a);return e.jsx("div",{className:"relative h-5 w-5 shrink-0",children:e.jsx(F,{onExitComplete:()=>{t===6&&r()},children:x!=null&&e.jsxs(L.div,{className:y("absolute start-0 top-0 flex h-full w-full items-center justify-center rounded-full text-white",_),initial:j,animate:{opacity:1,scale:1,rotate:0,x:0},exit:k,transition:v,onAnimationComplete:()=>{t===4&&c()},children:[f,(I(t)||t===10)&&e.jsx(Ms,{percentage:t===3?100:w,thickness:1.5/23,className:"text-brand-purple absolute start-1/2 top-1/2 h-[23px] w-[23px] -translate-x-1/2 -translate-y-1/2",backgroundStrokeClassName:"stroke-brand-purple/25 dark:stroke-brand-purple/50",transitionDuration:t===3?`${(100-w)/100*Et}s`:void 0,transitionTimingFunction:t===3?"cubic-bezier(0.55, 0, 1, 1)":void 0,onTransitionEnd:()=>{t===3&&l()}})]},x)})})}function wt({text:s,uiState:n,animationLoopCounter:t,onEnterAnimationComplete:a}){const[i,o]=g.useState(s);g.useEffect(()=>{n===2&&o(s)},[t]),g.useEffect(()=>{I(n)||o(s)},[n,s]);let l={opacity:0,x:0,y:15},c={type:"spring",bounce:.3,opacity:{duration:.15},y:{duration:.3}};n===0?(l={opacity:0,x:-8,y:0},c={type:"spring",bounce:.3,duration:Fe,delay:.15}):n===1&&(l=!1);const r=i??void 0;return e.jsx("div",{className:y("relative h-5 w-full leading-5",n===8||n===9?"text-token-text-tertiary":"text-token-text-secondary"),children:e.jsx(F,{children:r!=null&&e.jsx(L.div,{className:"absolute start-0 top-0 line-clamp-1 overflow-visible",initial:l,animate:{opacity:1,x:0,y:0},exit:{opacity:0,x:0,y:-15},transition:c,onAnimationComplete:()=>{n===0&&a()},children:r},r.toString())})})}function I(s){return s===0||s===2||s===3}function Mt(s){return I(s)||s===4||s===5||s===6||s===10}const be=ee.div`group start-0 top-0 me-1.5 overflow-hidden mt-1 text-start`,Dt=({highlightedCommand:s,status:n,children:t,showWorkUserSetting:a=!1,hideOnlyIfNotInteractedWith:i=!1,defaultExpanded:o=!1,onOpenAnalytics:l,onClick:c,...r},d)=>{const u=t!=null||c!=null,[x]=g.useState(a),[f,_]=g.useState(a||o),[j,v]=g.useState(!1),k=n===R.Finished||n===R.Error,w=i?x?!1:!j:!1,C=n===R.Running&&"loading-shimmer";return k&&w?null:u?e.jsxs(e.Fragment,{children:[e.jsx(ve,{ref:d,$canShowWork:!0,...r,children:e.jsx(F,{children:e.jsx(be,{children:e.jsx(L.button,{onClick:P=>{f||l?.(),_(S=>!S),v(!0),c?.(P)},initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:y(C),children:e.jsxs("div",{className:"flex items-center justify-start gap-1",children:[e.jsx("span",{className:"text-start",children:s}),!c&&(f?e.jsx(Is,{className:"icon-md"}):e.jsx(Ps,{className:"icon-md"}))]})},s?.toString())})})}),e.jsx(F,{children:f&&t&&e.jsx(L.div,{initial:"collapsed",animate:"reveal",exit:"collapsed",variants:{collapsed:{translateY:-20,opacity:0,height:0},reveal:{translateY:0,opacity:1,height:"auto"}},transition:{duration:.3,ease:"easeInOut"},className:"overflow-hidden",children:t})})]}):e.jsx(ve,{ref:d,$canShowWork:!1,...r,children:e.jsx(be,{className:y(C),children:s})})},ve=ee.span`block first:mt-0 relative
${({$canShowWork:s})=>s?"text-token-text-secondary hover:text-token-text-primary my-1.5":"text-token-text-secondary"}`,Ot=g.forwardRef(Dt),Lt=3,Rt=.1,Se=[0,.26,.4];function It({nextMessage:s,isLastMessage:n,isRequestActive:t,isLastTurnInConversation:a,clientThreadId:i,turnIndex:o}){const l=n||!s||s&&!G(s),c=g.useRef(!1),r=ms(),d=K(i,Ce.getGizmoId);g.useEffect(()=>{s&&G(s)&&!c.current&&(c.current=!0,Fs(r,d))},[s,r,d]);const u=qe(s),x=Ge(s);s?.id&&Bs(s?.id);const f=[];if(x?.[0]?.type==="navigation"&&s&&f.push(e.jsx(Pt,{clientThreadId:i,turnIndex:o,nextMessage:s,isRequestActive:t,isLastTurnInConversation:a,navigationCitation:x[0]},"fast-nav")),l){const _=es(u.slice(0,Lt).map(v=>v.entries[0].url)),j=t?e.jsxs("div",{className:"flex items-center gap-1",children:[_.map((v,k)=>e.jsx(L.div,{className:y("-ms-1.5 first:ms-0 last:me-1.5","relative"),initial:{width:k===0?0:6,opacity:0},animate:{width:20,opacity:1},transition:{duration:Rt,delay:Se[Math.min(k,Se.length-1)]},children:e.jsx("div",{className:y("flex h-[22px] w-[22px] items-center overflow-hidden rounded-full","border-token-bg-primary bg-token-bg-primary border-2"),children:e.jsx($,{url:v,size:32,minSize:16,className:"icon-md rounded-full"})})},v)),e.jsx(T,{id:"jjx8Qg",defaultMessage:"Searching the web"})]}):e.jsx(T,{id:"fssXGM",defaultMessage:"Error while searching"});f.push(e.jsx(Ot,{highlightedCommand:j,status:t?R.Running:R.Error},"search-gpt-query"))}return f.length?e.jsx(e.Fragment,{children:f}):null}const Pt=({clientThreadId:s,turnIndex:n,nextMessage:t,isRequestActive:a,isLastTurnInConversation:i,navigationCitation:o})=>{const{scrollToHeader:l}=me("searchSources")??{},c=ss(),r=me("searchSources"),{openThreadSidebar:d}=X(),{value:u}=B("756982148");return g.useEffect(()=>{ts.addFirstTiming("render.fastNavigation")},[]),g.useEffect(()=>{c&&r&&d({type:"searchSources",scrollToHeader:l,clientThreadId:s,turnIndex:n,messageId:t?.id??""})},[]),g.useEffect(()=>{const x=t,f=x.metadata?.search_source,_=o.domains.map(j=>j.url);Us.logEvent("Search Tool Request Time To Fast Nav",s,x.id,{search_source:f,urls:_},()=>{f===as.InstantQuery&&Vs.logEvent("Search Tool Page Load Time To Fast Nav",{message_id:x.id,urls:_,search_source:f})})},[s,t,o]),a&&i&&u?e.jsx(L.div,{initial:{opacity:a?0:1,height:a?0:"auto"},animate:{opacity:1,height:"auto"},children:e.jsx(Ne,{clientThreadId:s,turnIndex:n,nextMessage:t,navigationCitation:o})}):e.jsx(Ne,{clientThreadId:s,turnIndex:n,nextMessage:t,navigationCitation:o})},Ne=({clientThreadId:s,turnIndex:n,nextMessage:t,navigationCitation:a})=>{const{toggleThreadSidebar:i}=X(),{value:o}=B("756982148"),l=g.useMemo(()=>({clientThreadId:s,turnIndex:n,messageId:t?.id}),[s,n,t?.id]),c=g.useCallback((d,u)=>{i({type:"searchSources",scrollToHeader:u,clientThreadId:s,turnIndex:n,messageId:t?.id??""})},[i,s,n,t?.id]),r=zs(l);return o?e.jsx(yt,{navigation:a,onShowSearchResults:c,trackContentReferenceEvent:r}):e.jsx(Hs,{tldr:{type:"tldr",status:"done",display_title:a.domains[0].title,url:a.domains[0].url,matched_text:"",start_idx:0,end_idx:0,page_title:"",breadcrumbs:[a.domains[0].domain],refs:[]},trackContentReferenceEvent:r})},Ft=N(()=>E(()=>import("./fyd734llpbdugok3.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),Bt=N(()=>E(()=>import("./dvg0o2fvp4wxkenq.js"),__vite__mapDeps([9,1,3,4,10]))),Ut=N(()=>E(()=>import("./nd3es8msynh3n7xc.js"),__vite__mapDeps([11,1,3,4,2,5]))),Vt=N(()=>E(()=>import("./h5ggwu3ho4a2eo93.js"),__vite__mapDeps([12,1,3,4,2,5,13,14,6,7,8]))),zt=N(async()=>()=>null);N(async()=>()=>null);const Ht=N(async()=>(await E(()=>import("./l0hp1g1dyfwzfw82.js"),__vite__mapDeps([15,3,1,4,13,2,5,16,17,6,7,8,18,19,20,21]))).ImageGenMessage),Wt=N(()=>E(()=>import("./hsdrd0g4wxszpwci.js"),__vite__mapDeps([22,1,3,4,2,5,6,7,8]))),Jt=N(()=>E(()=>import("./exki82npk7hw7g59.js"),__vite__mapDeps([17,1,3,4,2,5,6,7,8])).then(s=>s.BrowsingMessage)),Xt=N(()=>E(()=>import("./csbo06cvz0f93p4n.js"),__vite__mapDeps([23,1,3,4,2,5])).then(s=>s.SearchResultMessage)),Kt=N(()=>E(()=>import("./dkomeekimnulr2tm.js"),__vite__mapDeps([24,1,3,4,2,5,6,7,8])).then(s=>s.JITPluginMessage)),$t=N(()=>E(()=>import("./k08vflseu4ufd1p2.js"),__vite__mapDeps([25,3,1,4,26,2,5,27,6,7,8])).then(s=>s.DataAnalysisMessage)),Qt=N(()=>E(()=>import("./gj4dzvxqws2uayv0.js"),__vite__mapDeps([28,1,3,4,2,5,29]))),Yt=N(()=>E(()=>import("./hjl8i43v977zmrf7.js"),__vite__mapDeps([30,1,3,4,31,32,2,5,16,17,6,7,8,33,34,35,36,37,38,39,40,41,42,43,44,45,46,27,47,48,49,50])).then(s=>s.LegacyCoTMessage)),Zt=N(()=>E(()=>import("./itgdzgk5z1u7l0jj.js"),__vite__mapDeps([31,1,3,4,32,2,5,16,17,6,7,8,33,34,35,36,37,38,39,40,41,42,43,44,45,46,27,47,48,49,50])).then(s=>s.CoT)),qt=N(()=>E(()=>import("./es8rozmr0k9re84h.js"),__vite__mapDeps([51,1,2,3,4,5,52,53,54,55])).then(s=>s.JawboneMessage)),Gt=N(async()=>()=>null);function la({groupedMessagesToRender:s,allMessages:n,allGroupedMessages:t,clientThreadId:a,isUserTurn:i,isCompletionRequestInProgress:o,isFeedbackEnabled:l,isFinalTurn:c,isFinalUserTurn:r,turnIndex:d,hasActiveRequest:u,onRequestCompletion:x,shouldGrowContainer:f=!0,isParagen:_=!1,renderingView:j="chat"}){const{showDebugConversationTurns:v}=Ws(),[k]=K(a,m=>[m?.mode]),w=ns(a),C=Js(),P=t.some(m=>m.type===p.Browsing||m.type===p.RetrievalBrowsing||m.type===p.SearchGPTQuery),S=Xs(()=>is.count(os.DEFAULT,"conversation_turn_grouped_messages.attempted_render_missing_type_f959b8c")),D=s.map((m,h)=>{const b=h===t.length-1;if(m.type===de)return e.jsx(Zt,{isStreaming:b&&o,messageGroups:m.groups},"cot-"+m.groups[0].messages[0].id);const O=h===0?void 0:s[h-1],oe=O?.type!==de?O:void 0,re=oe?.type,le=oe?.messages,Ve=m&&!G(m.messages[0]),ze=P&&Ve,H=[];switch(ze||H.push(e.jsx(pe,{className:"min-h-8",message:m.messages[0],isFeedbackEnabled:l,isFinalUserTurn:r,isCompletionInProgress:b&&o,hasActiveRequest:u,turnIndex:d,clientThreadId:a,isUserTurn:i,prevGroupedMessageType:re,prevGroupedMessages:le},"text-message-"+m.messages[0].id)),v&&H.push(e.jsx(Gt,{clientThreadId:a,message:m.messages[0]},"message-debug-"+m.messages[0].id)),m.type){case p.Text:case p.MultiText:return m.type===p.Text?e.jsxs(g.Fragment,{children:[H,e.jsx(Zs,{isUserTurn:i,message:m.messages[0]})]},"group-"+m.messages[0].id):m.type===p.MultiText?e.jsx(Ut,{clientThreadId:a,messages:m.messages,isCompletionInProgress:b&&o,isFeedbackEnabled:l,hasActiveRequest:u,prevGroupedMessageType:re,prevGroupedMessages:le},"multitext-"+(m.messages[0]?.id??h)):m.type;case p.Browsing:case p.RetrievalBrowsing:{const A=k!=null&&[J.GizmoInteraction,J.GizmoMagicCreate,J.GizmoTest].includes(k.kind),M=w?Ys(w):!1;return e.jsx(Jt,{messages:m.messages,isRequestActive:u,isLastMessageInTurn:b,isUsingGizmo:A,isUsingSnorlax:M,isRetrieval:m.type===p.RetrievalBrowsing},"browsing-"+(m.messages[0]?.id??h))}case p.SearchGPTQuery:{const A=t.slice(h+1).findLast(M=>M.type===p.Text||M.type===p.CoTSearchTool);return e.jsx(It,{clientThreadId:a,turnIndex:d,isRequestActive:u,isLastMessage:b,isLastTurnInConversation:c,nextMessage:A?.messages[0]},"searchquery-"+(m.messages[0]?.id??h))}case p.StructuredThoughts:return null;case p.ReasoningRecap:return null;case p.CoTSearchTool:return null;case p.n7jupd:return null;case p.n7jupd_i:case p.n7jupd_x:return null;case p.n7jupd_m:{if(!b)return null;const A={...m.messages[0],content:{content_type:rs.Text,parts:[""]}};return e.jsx(pe,{className:"min-h-8",message:A,isFeedbackEnabled:l,isFinalUserTurn:r,isCompletionInProgress:b&&o,hasActiveRequest:u,clientThreadId:a,isUserTurn:i,turnIndex:d},"text-message-"+A.id)}case p.a8km123:{if(!m.messages.some(M=>M.metadata?.model_slug==="o1-pro")){const M=Le(n,ce=>ce.author.role===Ee.Assistant&&ce.recipient==="all");return e.jsx(Yt,{clientThreadId:a,turnIndex:d,isStreaming:(b||M<h)&&o,messages:m.messages},"sum-"+(m.messages[0]?.id??h))}return e.jsx(Qt,{messages:m.messages,isStreaming:b&&o,isLastMessage:b,clientThreadId:a,currentGroupedMessageIndex:h,turnIndex:d},"sum-"+(m.messages[0]?.id??h))}case p.f959b8c:return S(),null;case p.is_loading_message:return b&&o?e.jsx(Qs,{},"loading-message-"+h):null;case p.c12k321:return null;case p.l1p9k3u:return null;case p.b1de6e2_c:return e.jsx(ft,{messages:m.messages,clientThreadId:a,isLastMessage:b},"b1de6e2-"+(m.messages[0]?.id??h));case p.b1de6e2_s:return e.jsx(ct,{messages:m.messages,clientThreadId:a},"b1de6e2_s-"+(m.messages[0]?.id??h));case p.b1de6e2_d:return null;case p.b1de6e2_rm:return e.jsx($s,{messages:m.messages,clientThreadId:a,renderingView:j,children:H},"b1de6e2_rm-"+(m.messages[0]?.id??h));case p.de1d73e:if(C){const A=h+1<t.length?t[h+1]:void 0;return e.jsx(qt,{clientThreadId:a,currentGroupedMessage:m,nextMessage:A&&A.type===p.Text?A.messages[0]:void 0,isLastMessage:b,isRequestActive:u},"jawbone-"+(m.messages[0]?.id??h))}else return null;case p.ParallelBrowsing:return e.jsx(Wt,{messages:m.messages},"parallel-"+(m.messages[0]?.id??h));case p.CodeInterpreter:return e.jsx($t,{messages:m.messages,isRequestActive:u,clientThreadId:a},"ada-"+(m.messages[0]?.id??h));case p.JITPlugin:return e.jsx(Kt,{messages:m.messages,clientThreadId:a,isLastTurnInConversation:c,onRequestCompletion:x},"jit-"+(m.messages[0]?.id??h));case p.t2uay3k:return e.jsx(Ht,{messages:m.messages,clientThreadId:a,disableClickThru:_,isLastTurnInConversation:c},"t2uay3k-"+(m.messages[0]?.id??h));case p.Dalle:return e.jsx(Vt,{messages:m.messages,clientThreadId:a,disableClickThru:_},"dalle-"+(m.messages[0]?.id??h));case p.GizmoEditor:return e.jsx(Ft,{messages:m.messages},"gizmo-editor-"+(m.messages[0]?.id??h));case p.oiw209h:return e.jsx(zt,{messages:m.messages,clientThreadId:a},"oiw209h-"+(m.messages[0]?.id??h));case p.Canmore:return e.jsx(Ks,{messages:m.messages,allTurnMessages:n,isFinalTurn:c,isRequestActive:u,clientThreadId:a,isUserTurn:i},"canmore-"+(m.messages[0]?.id??h));case p.Oboe:return null;case p.Debug:return v?e.jsx(Bt,{message:m.messages[0]},"debug-"+m.messages[0].id):null;case p.SearchResult:return e.jsx(Xt,{messages:m.messages},"search-result-"+(m.messages[0]?.id??h));case p.kanzi:return null}}),Be=tt(),Ue=ke(),{wordFadeType:U}=qs(),V=g.useRef([]),ae=g.useRef(void 0),ne=g.useRef(null),z=!i&&c&&o,ie=n[0]?.id;return ls(()=>{if(U!=="indexed"||!z)return;const m=ne.current;if(!m)return;ae.current!==ie&&(ae.current=ie,V.current=[]);const h=m.getAnimations({subtree:!0}).filter(b=>b.animationName===he["fade-in"]);if(h.length!==0){const b=ta({now:performance.now(),previousStartTimes:V.current,groupCount:h.length});V.current=b;for(let O=0;O<h.length;O++)h[O].startTime=b[O]}else V.current=[]},[D,U,z]),e.jsx("div",{className:y({"flex max-w-full flex-col":!0,[he.root]:U==="indexed"&&z,grow:f}),ref:ne,children:e.jsx(cs,{name:"GroupedMessages",fallback:ea,children:i?D:e.jsxs(Gs,{isDisabled:!z||U!=="delay",children:[et(Ue)&&c&&e.jsx(st,{isStreaming:o,debug:Be}),D]},n[0]?.id)})})}function ea({error:s}){return e.jsxs(at,{type:"danger",children:[e.jsx(T,{id:"5eGo3w",defaultMessage:"Unable to display this message due to an error."}),!1]})}function sa(s,n,t){if(s.length<2||n<=0)return 0;const a=n/Math.log(2);s=[...s].sort((l,c)=>l-c);let i=0,o=0;for(let l=s.length-1;l>0;--l){const c=Math.exp(-(t-s[l])/a);if(i>0&&c/i<.01)break;const r=s[l]-s[l-1];i+=c,o+=c*r}return i===0?0:i/o}function ta({now:s,previousStartTimes:n,groupCount:t,initialRate:a=50,halfLife:i=1}){const o=n.slice(0,Le(n,u=>u<=s)+1),l=o.length<2?a/1e3:Math.max(.01,sa(o,i*1e3,s)),c=t-o.length;let r=o[o.length-1]??0,d=1;for(let u=0;u<c;u++){const x=l*1e3*d;c<x?d*=.8:c>x&&(d*=1.5);const f=1/(l*d),_=Math.max(s,r+f);o.push(_),r=_}return o}export{la as C,Ne as F,yt as N,R as T,Ot as a,ra as b};
//# sourceMappingURL=hgzals0lml4o26vg.js.map
