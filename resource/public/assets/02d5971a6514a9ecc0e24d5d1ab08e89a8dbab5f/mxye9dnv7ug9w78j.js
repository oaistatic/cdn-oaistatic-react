import{k as M,n as B,u as c,r as _,j as f,a9 as F,a8 as G}from"./msupklk377u8vx8o.js";import{ba as I,ac as Q,al as m,ak as l,b as i,gg as w,aw as v,cw as T,au as g,c as C}from"./i3bl95k8z8nuf4dv.js";import{l$ as A,hX as S,ln as K,eR as L,h_ as b,ic as P}from"./idf4u2jy0wx0pvap.js";var y,q;function R(){if(q)return y;q=1;var s=I(),e=A();function t(a,r){return a&&a.length?e(a,s(r,2)):0}return y=t,y}var W=R();const h=M(W);function z(s){const e=D(s?.output_items);return{filesModified:h(e,t=>t.files_modified??0),linesAdded:h(e,t=>t.lines_added??0),linesRemoved:h(e,t=>t.lines_removed??0)}}function D(s){return s?s.map(e=>{switch(e.type){case"output_diff":return e;case"pr":return e.output_diff;default:return null}}).filter(e=>e!=null):[]}const x=Q()((s,e)=>({environmentId:m.getItem(l.LastEnvironment),branch:null,manuallyAddedBranches:[],promptDraft:m.getItem(l.PromptDraft)??"",tasksFilter:"current",taskTurnMap:{},showReactQueryDevtools:!1,pendingTaskIds:{},lastViewedTaskId:null,setShowReactQueryDevtools:t=>{m.setItem(l.ReactQueryDevtoolsVisible,t),s({showReactQueryDevtools:t})},setPromptDraft:t=>{m.setItem(l.PromptDraft,t),s({promptDraft:t})},setEnvironmentId:t=>{t==null?m.removeItem(l.LastEnvironment):m.setItem(l.LastEnvironment,t),s({environmentId:t})},setBranch:t=>s({branch:t}),addManuallyAddedBranch:t=>s(a=>a.manuallyAddedBranches.includes(t)?{}:{manuallyAddedBranches:[t,...a.manuallyAddedBranches]}),setTasksFilter:t=>s({tasksFilter:t}),setLastViewedTaskId:t=>s({lastViewedTaskId:t}),addTurnToTaskMap:(t,a)=>{s(r=>{const n=r.taskTurnMap[t],u=n?{...n}:{};return u[a.id]=a,{taskTurnMap:{...r.taskTurnMap,[t]:u}}})},getTurnsForTask:t=>{const a=e().taskTurnMap[t]??[];return Object.values(a).sort((r,n)=>r.created_at-n.created_at)},addPendingTaskId:t=>{const a={...e().pendingTaskIds};a[t]=t,s({pendingTaskIds:a})},removePendingTaskId:t=>{const a={...e().pendingTaskIds};delete a[t],s({pendingTaskIds:a})},removePendingTaskByTaskId:t=>{const a=e().pendingTaskIds,[r]=Object.entries(a).find(([n,u])=>u===t)??[];if(r){const n={...a};delete n[r],s({pendingTaskIds:n})}},assignPendingTaskToFinalTask:(t,a)=>s(r=>({pendingTaskIds:{...r.pendingTaskIds,[t]:a}}))}));class d{static getTasks(e=10,t=null,a="current"){return i.safeGet("/wham/tasks",{parameters:{query:{limit:e,cursor:t,task_filter:a}}})}static getTasksForList(e=10,t=null,a="current"){return i.safeGet("/wham/tasks/list",{parameters:{query:{limit:e,cursor:t,task_filter:a}}})}static getTaskDetails(e){return i.safeGet("/wham/tasks/{task_id}",{parameters:{path:{task_id:e}}})}static getTaskTurnPR(e,t){return i.safeGet("/wham/tasks/{task_id}/turns/{turn_id}/pr",{parameters:{path:{task_id:e,turn_id:t}}})}static getUserHandle(){return i.safeGet("/wham/task_suggestions/github/user_handle",{})}static getTaskTurn(e,t){return i.safeGet("/wham/tasks/{task_id}/turns/{turn_id}",{parameters:{path:{task_id:e,turn_id:t}}})}static getGithubInstallations(){return i.safeGet("/wham/github/installations",{})}static feedback({thumbRating:e,text:t,taskId:a,turnId:r,shareUrl:n,pullRequestUrl:u,category:o}){return i.safePost("/wham/feedback",{requestBody:{thumb_rating:e,text:t,conversation_id:null,message_id:null,task_id:a,turn_id:r,share_url:n,pull_request_url:u,category:o}})}static archiveTask(e){return i.safePost("/wham/tasks/{task_id}/archive",{parameters:{path:{task_id:e}}})}static recoverTask(e){return i.safePost("/wham/tasks/{task_id}/recover",{parameters:{path:{task_id:e}}})}static createPr(e,t,a,r,n){return i.safePost("/wham/tasks/{task_id}/turns/{task_turn_id}/pr",{parameters:{path:{task_id:e,task_turn_id:t}},requestBody:{mode:a,add_codex_tag:r,hide_pr_title_and_body:n}})}static getRepositoriesByInstallationId(e,t,a){return i.safeGet("/wham/github/repositories/v2/{installation_id}",{parameters:{path:{installation_id:e},query:{page:t,per_page:a}}})}static getRepository(e){return i.safeGet("/wham/github/repositories/{repo_id}",{parameters:{path:{repo_id:e}}})}static searchBranchesByRepository(e,t,a=10,r=null){return i.safeGet("/wham/github/branches/{repo_id}/search",{parameters:{path:{repo_id:e},query:{query:t,page_size:a,cursor:r}}})}static getEnvironment(e){return i.safeGet("/wham/environments/{environment_id}",{parameters:{path:{environment_id:e}}})}static getEnvironmentWithCreatorAndMachine(e){return i.safeGet("/wham/environments/{environment_id}/with-creator-and-machine",{parameters:{path:{environment_id:e}}})}static getEnvironmentWithCreators(e=10,t=null){return i.safeGet("/wham/environments/with-creators",{parameters:{query:{limit:e,cursor:t}}})}static updateEnvironment(e,t){return i.safePatch("/wham/environments/{environment_id}",{parameters:{path:{environment_id:e}},requestBody:t})}static deleteEnvironment(e){return i.safeDelete("/wham/environments/{environment_id}",{parameters:{path:{environment_id:e}}})}static getEnvironments(){return i.safeGet("/wham/environments",{})}static getMachines(){return i.safeGet("/wham/machines",{})}static createEnvironment(e){const t=e.envVars.reduce((r,n)=>(r[n.key]=n.value,r),{}),a=e.secrets.reduce((r,n)=>(r[n.key]=n.value,r),{});return i.safePost("/wham/environments",{requestBody:{label:e.label,machine_id:e.machine,repos:[e.repositoryId],description:e.description,setup:e.setupCommands,workspace_dir:e.workspaceDirectory,share_settings:e.share_settings,env_vars:t,secrets:a}})}static runEnvironmentTestCommand(e){return i.safePost("/wham/environments/test/{test_session_id}/command",{parameters:{path:{test_session_id:e.testSessionId}},requestBody:{command:e.command}})}static getUserPreferences(){return i.safeGet("/wham/settings/user",{})}static getUserPreferencesConfig(){return i.safeGet("/wham/settings/configs/user-preferences",{})}static updateUserPreferences(e){return i.safePatch("/wham/settings/user",{requestBody:{branch_format:e.branchFormat,git_diff_mode:e.diffView,custom_instructions:e.customInstructions}})}static getTurns(e){return i.safeGet("/wham/tasks/{task_id}/turns",{parameters:{path:{task_id:e}}})}static getTurnLogs(e,t){return i.safeGet("/wham/tasks/{task_id}/turns/{turn_id}/logs",{parameters:{path:{task_id:e,turn_id:t}}})}static async createNewTask(e,t,a,r=!1){const n=await w("codex_create_task_turn").catch(o=>{v.addError(o)}),u=T(null,null,null,n);return i.safePost("/wham/tasks",{requestBody:{new_task:{environment_id:e,branch:t,run_environment_in_qa_mode:r},input_items:[{type:"message",role:"user",content:[{content_type:"text",text:a}]}]},additionalHeaders:u})}static async createNewTaskWithEditedPrompt(e,t,a,r,n=!1){const u=await d.createNewTask(t,a,r,n);return d.archiveTask(e).catch(()=>{}),u}static async createFollowUpTask(e,t,a,r,n=!1){const u=[{type:"message",role:"user",content:[{content_type:"text",text:a}]}];r.forEach(p=>{u.push({type:"comment",position:p.position,content:p.content})});const o=await w("codex_create_task_turn").catch(p=>{v.addError(p)}),k=T(null,null,null,o);return i.safePost("/wham/tasks",{requestBody:{follow_up:{task_id:e,turn_id:t,run_environment_in_qa_mode:n},input_items:u},additionalHeaders:k})}static markTurnAsRead(e){return i.safePost("/wham/tasks/{task_id}/mark_read",{parameters:{path:{task_id:e}}})}}const X=(s,e,t,a)=>({queryKey:["wham","task",s,e],staleTime:0,enabled:!!s&&!!e,queryFn:async()=>(t.invalidateQueries({queryKey:["wham","tasks"]}),await d.getTaskTurn(s??"",e??"").then(r=>(t.setQueryData(["wham","tasks"],n=>N(n,r)),r))),...a||{}}),U=s=>({queryKey:["wham","task",s],staleTime:0,enabled:!!s,queryFn:async()=>await d.getTaskDetails(s??"")}),$=s=>{const e=U(s);return c(e)},j=19;function J({enabled:s=!0,refetchOnMount:e=!1}={}){const t=x(({tasksFilter:a})=>a);return B({queryKey:["wham","tasks",t],queryFn:async({pageParam:a})=>await d.getTasksForList(j,a??null,t),initialPageParam:null,getNextPageParam:({cursor:a})=>a,enabled:s,refetchOnMount:e})}const E=s=>{const e=D(s.turn.output_items);return{id:s.task.id,title:s.task.title,updated_at:s.turn.created_at,task_status_display:{environment_label:s.turn.environment?.label,latest_turn_status_display:{turn_id:s.turn.id,turn_status:s.turn.turn_status,diff_stats:{files_modified:h(e,t=>t.files_modified??0),lines_added:h(e,t=>t.lines_added??0),lines_removed:h(e,t=>t.lines_removed??0)}}},archived:s.task.archived,has_unread_turn:!!s.task.has_unread_turn}};function N(s,e){const t=e.task.id;return e.task.current_turn_id!==e.turn.id?s:s?g(s,a=>{let r=!1;for(const n of a.pages){const u=n.items.findIndex(o=>o.id===t);if(u!==-1){n.items[u]=E(e),r=!0;break}}r||a.pages[0].items.push(E(e))}):{pageParams:[null],pages:[{items:[{task:e.task,turn:e.turn}]}]}}function V({retry:s=0}={}){return c({queryKey:["wham","environments"],queryFn:()=>d.getEnvironments(),retry:s})}function Y(){return c({queryKey:["wham","githubInstallations"],queryFn:()=>d.getGithubInstallations(),staleTime:0,refetchOnWindowFocus:!0,refetchOnMount:!0})}function ee(s,e,t){s.setQueryData(["wham","environments"],a=>a?[e,...a]:[e]),s.setQueryData(["wham","environments","with-creators"],a=>{if(!a)return a;const r={...e,creator:t};return g(a,n=>{n.pages.length>0&&n.pages[0].items.unshift(r)})})}function te(s,e){s.setQueryData(["wham","environments"],t=>t?.filter(a=>a.id!==e)),s.setQueryData(["wham","environments","with-creators"],t=>t&&g(t,a=>{a.pages[0].items=a.pages[0].items.filter(r=>r.id!==e)}))}function ae(s,e,t){s.setQueryData(["wham","environments"],a=>a?.map(r=>r.id===e?t:r)),s.setQueryData(["wham","environments","with-creators"],a=>a&&g(a,r=>{r.pages[0].items=r.pages[0].items.map(n=>n.id===e?{...n,...t}:n)})),s.setQueryData(["environments",e,"withCreatorAndMachine"],a=>a?{...a,...t}:void 0)}function se(s){return c({queryKey:["environments",s,"withCreatorAndMachine"],queryFn:()=>d.getEnvironmentWithCreatorAndMachine(s)})}function re(){return c({queryKey:["wham","userPreferences"],queryFn:()=>d.getUserPreferences()})}function ne(){return c({queryKey:["wham","userPreferencesConfig"],queryFn:()=>d.getUserPreferencesConfig()})}function ie(s,e){return Promise.all([s.invalidateQueries({queryKey:["wham","environments","with-creators"]}),s.invalidateQueries({queryKey:["wham","environments"]}),e&&s.invalidateQueries({queryKey:["environments",e]}),e&&s.invalidateQueries({queryKey:["environments",e,"withCreatorAndMachine"]})])}function ue(s){return s.invalidateQueries({queryKey:["wham","userPreferences"]})}function oe(s){const e=x(t=>t.addTurnToTaskMap);return c({queryKey:["wham","task",s,"turns"],queryFn:async()=>{const t=await d.getTurns(s??"");return Object.values(t.turn_mapping).forEach(a=>{e(s??"",a.turn)}),t},enabled:!!s})}function de(s,e){return c({queryKey:["wham","task",s,"turns",e,"logs"],queryFn:()=>d.getTurnLogs(s??"",e??""),enabled:!!s&&!!e})}const ce=({children:s,sideOffset:e=-35,isOpen:t,closePopover:a,popoverContentRef:r,...n})=>{const u=S();return _.useEffect(()=>{if(t)return K(a,r)},[t,r,a]),_.useEffect(()=>{if(!t)return;const o=k=>{k.key==="Escape"&&a()};return document.addEventListener("keydown",o,{capture:!0,passive:!0}),()=>document.removeEventListener("keydown",o,{capture:!0})},[t,a]),f.jsx(L,{forceMount:!0,asChild:!0,align:"center",sideOffset:e,onClick:o=>{o.stopPropagation(),o.preventDefault()},onOpenAutoFocus:o=>{o.preventDefault()},...n,children:f.jsx("div",{ref:r,className:C(!t&&"pointer-events-none","z-20"),children:f.jsx(F,{mode:"sync",children:t&&f.jsx(G.div,{className:C("border-token-border-light origin-radix-popover dark:bg-token-main-surface-secondary flex overflow-clip rounded-2xl border bg-white shadow-2xl dark:border-white/5 dark:shadow-[0px_24px_64px_rgba(0,0,0,0.32)]"),variants:{open:{scale:[.7,1],opacity:1,transition:u?b:P},closed:{opacity:0,scale:.8,transition:u?b:{...P,duration:.2}}},initial:"closed",animate:"open",exit:"closed",children:s})})})})},me=s=>_.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},_.createElement("path",{d:"M17.5 3C19.1569 3 20.5 4.34315 20.5 6C20.5 7.30574 19.6645 8.413 18.5 8.8252V9C18.5 11.2091 16.7091 13 14.5 13H9.5C8.39543 13 7.5 13.8954 7.5 15V15.1738C8.66468 15.5859 9.5 16.6941 9.5 18C9.5 19.6569 8.15685 21 6.5 21C4.84315 21 3.5 19.6569 3.5 18C3.5 16.6941 4.33532 15.5859 5.5 15.1738V8.8252C4.33548 8.413 3.5 7.30574 3.5 6C3.5 4.34315 4.84315 3 6.5 3C8.15685 3 9.5 4.34315 9.5 6C9.5 7.30574 8.66452 8.413 7.5 8.8252V11.5361C8.08845 11.1956 8.77125 11 9.5 11H14.5C15.6046 11 16.5 10.1046 16.5 9V8.8252C15.3355 8.413 14.5 7.30574 14.5 6C14.5 4.34315 15.8431 3 17.5 3ZM6.5 17C5.94772 17 5.5 17.4477 5.5 18C5.5 18.5523 5.94772 19 6.5 19C7.05228 19 7.5 18.5523 7.5 18C7.5 17.4477 7.05228 17 6.5 17ZM6.5 5C5.94772 5 5.5 5.44772 5.5 6C5.5 6.55228 5.94772 7 6.5 7C7.05228 7 7.5 6.55228 7.5 6C7.5 5.44772 7.05228 5 6.5 5ZM17.5 5C16.9477 5 16.5 5.44772 16.5 6C16.5 6.55228 16.9477 7 17.5 7C18.0523 7 18.5 6.55228 18.5 6C18.5 5.44772 18.0523 5 17.5 5Z",fill:"currentColor"}));export{ce as C,me as S,d as W,ae as a,x as b,J as c,V as d,Y as e,$ as f,X as g,oe as h,ie as i,re as j,ne as k,ue as l,z as m,D as n,de as o,ee as p,te as r,h as s,se as u};
//# sourceMappingURL=mxye9dnv7ug9w78j.js.map
