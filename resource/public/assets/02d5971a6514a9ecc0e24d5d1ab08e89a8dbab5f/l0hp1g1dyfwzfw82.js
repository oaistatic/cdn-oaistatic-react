const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/gicdud6trtoztlr0.js","assets/i3bl95k8z8nuf4dv.js","assets/msupklk377u8vx8o.js","assets/root-en2soewk.css","assets/hwl3hzno2kq7obfl.js","assets/idf4u2jy0wx0pvap.js","assets/conversation-small-irmw3ffz.css","assets/hmii3551qscelikg.js","assets/i3xeaua08fnq6vw7.js","assets/gc51ish3otzvnj1w.js","assets/jm9661216xi1kol5.js","assets/iaogn9yqy8ycbrvh.js","assets/bjlvmvwbynia41h5.js","assets/igftvtdft8b4phs3.js","assets/o2t4lszmsavslsdu.js","assets/gwmfzjrffpu4d2tx.js","assets/gd7xfxa2yqt151v4.js","assets/en1ee50tqvrjf3xp.js","assets/n5fowtub43nwjawh.js","assets/lvc34l5biwha9w7t.js","assets/k4oexpwbiepmd1cd.js","assets/np9w83f07wa6edf5.js","assets/hstsg1tnsukf0vw2.js","assets/ev39bkx1q3tpviat.js","assets/etqfvs5ggajp1a11.js","assets/lgau3pvpncteatb6.js","assets/vieocwuyvvf28lwx.js","assets/lm1rmwueprcm5uwi.js"])))=>i.map(i=>d[i]);
import{c as L,dC as te,g as Te,r as De,bj as oe,el as xe,b2 as Oe,an as ue,bI as Pe,F as Le,e8 as Fe,ar as Ue,aw as ge,ce as K,dP as Be,bW as He,d5 as ze,h9 as We,k as Ve,v as $e,_ as Ke}from"./i3bl95k8z8nuf4dv.js";import{j as t,a8 as ae,f as W,r as n,g as Ye,M as qe,a as Qe,o as Xe}from"./msupklk377u8vx8o.js";import{I as se,D as Je,a as be,u as Ze}from"./edgafuoc6xivwz0d.js";import{bi as re,fr as Me,hu as ye,dm as we,bl as J,bm as S,hv as ve,ao as z,bs as et,ay as le,bt as tt,ax as ce,hm as Ie,bw as de,bv as _e,bn as at,bx as nt,r0 as st,r1 as it,bk as ot,hN as rt,js as je,ju as lt}from"./idf4u2jy0wx0pvap.js";import{b as ct}from"./ohwrmnkvkdb4hdjp.js";import{u as dt}from"./gwmfzjrffpu4d2tx.js";import{I as ke}from"./vieocwuyvvf28lwx.js";import{C as ut}from"./hu4ci70fpsy8huk5.js";import"./exki82npk7hw7g59.js";import"./hgzals0lml4o26vg.js";import"./hwl3hzno2kq7obfl.js";import"./hmii3551qscelikg.js";import"./i3xeaua08fnq6vw7.js";import"./lm1rmwueprcm5uwi.js";function gt({title:e,description:a,shimmer:s}){return!e&&!a?null:t.jsxs("div",{className:"border-token-border-default my-2 max-w-[480px] min-w-72 rounded-2xl border p-6",children:[!!e&&t.jsx("p",{className:L("text-lg font-medium",s&&"loading-shimmer-pure-text-inverted",!!a&&"mb-1"),children:e}),!!a&&t.jsx("p",{children:a})]})}const Ce=({children:e,isDimensionsUnknown:a})=>t.jsxs(ae.div,{className:L(["relative max-w-[480px] rounded-2xl",a&&"aspect-square overflow-hidden"]),children:[t.jsx("div",{className:"bg-token-main-surface-secondary pointer-events-none absolute inset-0"}),t.jsx("div",{className:"relative h-full",children:e})]});var b=(e=>(e.Unavailable="unavailable",e.Thinking="thinking",e.Generating="generating",e.AsyncGenerating="async_generating",e.AsyncHanging="async_hanging",e.Complete="complete",e.Errored="errored",e.Empty="empty",e))(b||{});const mt="sj1i4kz",Y=`${te.T2UAY3K}.${mt}`,ft=({cotMessages:e,visualPercentComplete:a,isInterrupted:s=!1,state:i})=>{const u=W().formatMessage({id:"imagegen.thinkingHeader.interrupted",defaultMessage:"Stopped creating image"}),r=i===b.Complete||a===1,h=n.useMemo(()=>{if(s)return u;if(!e)return;if(r)return e.complete;if(a){const m=Object.keys(e.generating);for(let f=0;f<m.length;f+=1){const l=parseFloat(m[f]);if(a<l)return e.generating[m[f]]}}else return e.thinking;return e.complete},[e,u,s,r,a]);return h&&t.jsx(ct,{latestHeadline:h,isComplete:r||s,isExpandDisabled:!0})},Se="ChatGPT Image",ht=300,me=1e3;function X({rightAlign:e=!1,bottomAlign:a=!1,fullWidth:s=!1,justifyBetween:i=!1,alwaysVisible:o=!1,children:u}){return t.jsxs("div",{className:L("absolute z-2 transition-opacity duration-300",o?"opacity-100":"opacity-0 group-hover/imagegen-image:opacity-100 group-focus/imagegen-image:opacity-100 focus-within:opacity-100",e?"end-0":"start-0",a?"bottom-0":"top-0",s&&"w-full"),children:[t.jsx("div",{className:L(a?"bg-linear-to-b":"bg-linear-to-t","from-transparent to-black/30","h-20 w-full")}),t.jsx("div",{className:L("absolute inset-0 flex",a?"items-end py-4":"items-start py-4",e?"justify-end px-4":"justify-start px-4",i&&"justify-between"),children:u})]})}function U({icon:e,children:a,selected:s,disabled:i,onClick:o,ariaLabel:u}){return t.jsxs("button",{className:L("hover:bg-white/15 hover:backdrop-blur-md focus:bg-white/15 focus:backdrop-blur-md","z-11 flex h-10 items-center justify-center gap-1 rounded-xl font-semibold text-white",a==null?"w-10":"px-2"),onClick:o,disabled:i??s,"aria-label":u,children:[t.jsx(e,{style:{filter:"drop-shadow(0px 2px 4px rgba(0, 0, 0, 0.15))"},className:L("icon-lg",s?"fill-current":"fill-transparent")}),a]})}function H(e){return a=>{a.stopPropagation(),e()}}const pt=e=>{const a=Te();return De(a,"1524389214")?t.jsx(bt,{...e}):t.jsx(xt,{...e})},xt=({image:e,imageUrl:a,onEditorClick:s,isEditorAvailable:i,messageId:o,serverThreadId:u,shouldShowOverflow:r=!1})=>{const{value:h}=oe("706943082"),{config:m}=xe("2248456840"),f=m.get("enabled",!1),l=W(),[d,p]=n.useState(!1),[c,x]=n.useState(null),[y,M]=n.useState(!0),[g,D]=n.useState(!1),I=re(),O=c==null,w=_=>{O&&(S.imageRated({liked:_,analyticsContext:I}),x(_),M(!1),setTimeout(()=>{D(!0)},me))},v=n.useCallback(()=>{const _=new Date,V=l.formatDate(_,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"});return`${Se} ${V}.png`},[l]),E=Me(),R=ye(),N=R?.type===we.Image&&R.image.asset_pointer===e?.asset_pointer,[j,G]=n.useState(!1),B=n.useCallback(()=>{e?.asset_pointer&&(J({url:e?.asset_pointer,fileName:v()}),S.download({analyticsContext:I}))},[e,v,I]),k=n.useCallback(_=>{_.stopPropagation()},[]);return t.jsxs(t.Fragment,{children:[E?!N&&t.jsx(X,{rightAlign:!0,fullWidth:!0,children:t.jsx(U,{icon:ve,ariaLabel:l.formatMessage(P.expand)})}):t.jsxs(t.Fragment,{children:[t.jsx(X,{rightAlign:!0,fullWidth:!0,alwaysVisible:j,children:t.jsxs("div",{className:"flex flex-row",onClick:k,children:[i&&!h&&t.jsx(z,{label:l.formatMessage({id:"UH0Ly0",defaultMessage:"Edit image"}),side:"top",children:t.jsx(U,{icon:Ie,ariaLabel:l.formatMessage(P.inpaint),onClick:H(()=>{s?.(),S.inpaintStarted({analyticsContext:I})})})}),a&&t.jsx(z,{label:l.formatMessage({id:"0EYire",defaultMessage:"Download"}),side:"top",children:t.jsx(U,{icon:de,ariaLabel:l.formatMessage(P.download),onClick:H(()=>{J({url:a,fileName:v()}),S.download({analyticsContext:I})})})}),f&&r&&t.jsx(_e,{onOpenChange:G,onDownload:B,triggerClassName:"z-11 flex h-10 w-10 items-center justify-center rounded-xl bg-transparent hover:bg-token-icon-surface/10 focus:bg-token-icon-surface/10 focus-visible:bg-token-icon-surface/10",iconClassName:"icon-lg fill-transparent text-white",dropdownClassName:"z-11 min-w-fit origin-top-right text-token-text-primary"})]})}),t.jsx(X,{bottomAlign:!0,rightAlign:!0,fullWidth:!0,justifyBetween:O,children:t.jsxs("div",{className:L("flex w-full items-center justify-between transition-opacity ease-in-out",y?"opacity-100":"opacity-0"),style:{transitionDuration:`${me}ms`},children:[t.jsx("div",{className:"flex items-center ps-4 font-semibold text-white",style:{textShadow:"0px 2px 4px rgba(0, 0, 0, 0.20)"},children:l.formatMessage(c===!0?P.feedbackMessage:P.rateThisImage)}),!g&&t.jsxs("div",{className:L("flex flex-row transition-opacity ease-in-out",c===!0?"opacity-0":"opacity-100"),style:{transitionDuration:`${ht}ms`},children:[t.jsx(z,{label:l.formatMessage({id:"U99PVw",defaultMessage:"Like"}),side:"top",delayDuration:300,children:t.jsx(U,{icon:le,onClick:H(()=>w(!0)),ariaLabel:l.formatMessage(P.thumbsUp)})}),t.jsx(z,{label:l.formatMessage({id:"ncGqTt",defaultMessage:"Dislike"}),side:"top",delayDuration:300,children:t.jsx(U,{icon:ce,onClick:H(()=>{w(!1),p(!0)}),ariaLabel:l.formatMessage(P.thumbsDown)})})]})]})})]}),d&&t.jsx(ke,{messageId:o??"",serverThreadId:u??"",rating:c,onClose:()=>p(!1)})]})},bt=({image:e,imageUrl:a,onEditorClick:s,isEditorAvailable:i,messageId:o,clientThreadId:u,serverThreadId:r,shouldShowOverflow:h=!1})=>{const{value:m}=oe("706943082"),{config:f}=xe("2248456840"),l=f.get("enabled",!1),d=W(),[p,c]=n.useState(!1),[x,y]=n.useState(null),M=re(),g=N=>{x==null&&(S.imageRated({liked:N,analyticsContext:M}),y(N),N||c(!0))},D=n.useCallback(()=>{const N=new Date,j=d.formatDate(N,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"});return`${Se} ${j}.png`},[d]),I=Me(),O=ye(),w=O?.type===we.Image&&O.image.asset_pointer===e?.asset_pointer,[v,E]=n.useState(!1),R=n.useCallback(()=>{e?.asset_pointer&&(J({url:e?.asset_pointer,fileName:D()}),S.download({analyticsContext:M}))},[e,D,M]);return t.jsxs(t.Fragment,{children:[I?!w&&t.jsx(X,{rightAlign:!0,fullWidth:!0,children:t.jsx(U,{icon:ve,ariaLabel:d.formatMessage(P.expand)})}):t.jsx(t.Fragment,{children:t.jsx(X,{bottomAlign:!0,rightAlign:!0,fullWidth:!0,alwaysVisible:v,children:t.jsxs("div",{className:"flex w-full items-center justify-between",children:[t.jsxs("div",{className:"flex ps-1",children:[x!==!1&&t.jsx(z,{label:d.formatMessage({id:"U99PVw",defaultMessage:"Like"}),delayDuration:300,children:t.jsx(U,{icon:x===!0?et:le,onClick:H(()=>g(!0)),ariaLabel:d.formatMessage(P.thumbsUp)})}),x!==!0&&t.jsx(z,{label:d.formatMessage({id:"ncGqTt",defaultMessage:"Dislike"}),delayDuration:300,children:t.jsx(U,{icon:x===!1?tt:ce,onClick:H(()=>g(!1)),ariaLabel:d.formatMessage(P.thumbsDown)})}),i&&!m&&t.jsx(z,{label:d.formatMessage({id:"UH0Ly0",defaultMessage:"Edit image"}),children:t.jsx(U,{icon:Ie,ariaLabel:d.formatMessage(P.inpaint),onClick:H(()=>{s?.(),S.inpaintStarted({analyticsContext:M})})})}),a&&t.jsx(z,{label:d.formatMessage({id:"0EYire",defaultMessage:"Download"}),children:t.jsx(U,{icon:de,ariaLabel:d.formatMessage(P.download),onClick:H(()=>{J({url:a,fileName:D()}),S.download({analyticsContext:M})})})}),l&&h&&t.jsx(_e,{onOpenChange:E,onDownload:R,triggerClassName:"z-11 flex h-10 w-10 items-center justify-center rounded-xl bg-transparent hover:bg-token-icon-surface/10 focus:bg-token-icon-surface/10 focus-visible:bg-token-icon-surface/10",iconClassName:"icon-lg fill-transparent text-white",dropdownClassName:"z-11 min-w-fit origin-top-right text-token-text-primary"})]}),t.jsx("div",{className:"flex",children:t.jsx(Mt,{clientThreadId:u,messageId:o})})]})})}),p&&t.jsx(ke,{messageId:o??"",serverThreadId:r??"",rating:x,onClose:()=>c(!1)})]})};function Mt({clientThreadId:e,messageId:a}){const[s,i]=n.useState(!1),o=W(),u=Oe(),r=at(),h=!u&&r(),m=dt({clientThreadId:e,imageGenMessageId:a});return n.useEffect(()=>{h&&ue.logEventWithStatsig("Share Post: Share Button Shown","chatgpt_post_share_button_shown",{source:"image_gen_action_overlay"})},[h]),h?t.jsx(U,{icon:s?Pe:nt,disabled:s,onClick:H(async()=>{i(!0);try{await m()}finally{i(!1)}ue.logEventWithStatsig("Share Post: Share Button Clicked","chatgpt_post_share_button_clicked",{source:"image_gen_action_overlay"})}),ariaLabel:o.formatMessage(P.share),children:t.jsx(qe,{id:"imageGenActionOverlay.shareButton",defaultMessage:"Share"})}):null}const P=Ye({rateThisImage:{id:"imageGenActionOverlay.rateThisImage",defaultMessage:"Rate this image"},thumbsUp:{id:"imageGenActionOverlay.thumbsUp",defaultMessage:"Like this image"},thumbsDown:{id:"imageGenActionOverlay.thumbsDown",defaultMessage:"Dislike this image"},inpaint:{id:"imageGenActionOverlay.inpaint",defaultMessage:"Enter inpainting mode"},download:{id:"imageGenActionOverlay.download",defaultMessage:"Download this image"},expand:{id:"imageGenActionOverlay.expand",defaultMessage:"Expand this image"},share:{id:"imageGenActionOverlay.share",defaultMessage:"Share this image"},feedbackMessage:{id:"imageGenActionOverlay.feedbackMessage",defaultMessage:"Thanks for your feedback"}}),fe=Le.div`invisible absolute top-3 flex gap-1 group-hover/paragen-image:visible z-2
  ${({$rightAlign:e})=>e?"end-3":"start-3"}
  ${({$alwaysVisible:e})=>e?"visible":""}`,yt=({imageUrl:e})=>{const[a,s]=n.useState(void 0),i=W(),o=re(),u=n.useCallback(()=>{const r=new Date;return`${i.formatDate(r,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}.png`},[i]);return t.jsxs("div",{className:"group/paragen-image absolute inset-0 z-3",children:[t.jsxs(fe,{$alwaysVisible:!0,children:[a!==!1&&t.jsx(se,{icon:le,selected:a===!0,variant:"large",onClick:r=>{r.stopPropagation(),S.paragenImageRated({liked:!0,analyticsContext:o}),s(!0)}}),a!==!0&&t.jsx(se,{icon:ce,selected:a===!1,variant:"large",onClick:r=>{r.stopPropagation(),S.paragenImageRated({liked:!1,analyticsContext:o}),s(!1)}})]}),t.jsx(fe,{$alwaysVisible:!0,$rightAlign:!0,children:t.jsx(se,{icon:de,variant:"large",onClick:r=>{r.stopPropagation(),S.paragenDownload({analyticsContext:o}),J({url:e,fileName:u()})}})})]})};function Ee({withLottie:e}){const s=W().formatMessage({id:"imagegen.progressIndicator.ariaLabel",defaultMessage:"Generating image..."});return t.jsx("div",{className:"absolute start-0 top-0 flex h-full w-full items-center justify-center rounded-full","aria-label":s,children:t.jsx(ut,{size:40,arcPercentage:.2,children:t.jsx(Je,{animate:e,matchTextColor:!0,className:"h-6 w-6"})})})}const Re=300,wt=1.3,he=.05,vt=/blur\(([\d.]+)px\)/,It={duration:Re/1e3,ease:"linear"};function ie(e,a,s){e.sort((r,h)=>r.lastSrcReceivedTime-h.lastSrcReceivedTime);const i=new Array(e.length).fill(0);for(let r=0;r<=e.length;r+=1){const h=r-1,m=r,f=e[h]?.availablePercentComplete??0,l=e[m]?.availablePercentComplete??1;if(a>=f&&a<=l&&f!==l){const d=(a-f)/(l-f);i[h]=1-d,i[m]=d}}const o=i[i.length-1],u=i[i.length-2];return o===1&&u===0&&(i[i.length-2]=.01),s&&a<=e[0]?.availablePercentComplete&&(i[0]=1),i}const _t=({alt:e,src:a,availablePercentComplete:s,onAnimationUpdate:i,ignoreFirstChunk:o=!1,isTransparent:u=!1,dimensions:r,onError:h,unconstrainedWidth:m=!1})=>{const f=Fe(),l=n.useMemo(()=>`url(${f?st:it})`,[f]),[d,p]=n.useState(!1),[c,x]=n.useState(1e3),[y,M]=n.useState(s??0),[g,D]=n.useState(0),I=n.useRef(performance.now()),O=n.useRef(0),w=n.useRef([]),[v,E]=n.useState([0]),[R,N]=n.useState(!1),j=n.useRef(!1),G=n.useRef(null),B=y===1,k=s===1&&R,_=r?r.width/r.height:1;n.useEffect(()=>{!d&&s&&(p(!0),O.current=performance.now())},[d,s]),n.useEffect(()=>{const C=w.current[w.current.length-1]?.src;if(a&&a!==C){const F=w.current.findIndex(Q=>Q.availablePercentComplete===s);F!==-1?w.current[F]={src:a,availablePercentComplete:s??0,lastSrcReceivedTime:performance.now()}:w.current.push({src:a,availablePercentComplete:s??0,lastSrcReceivedTime:performance.now()}),E(ie(w.current,y,o))}},[a,y,o,s]);const V=n.useCallback(()=>{G.current&&s&&(x(k?Re:(performance.now()-I.current)*wt),(!o||j.current||s>=he)&&s!==1&&D(s),j.current=!0,I.current=performance.now())},[s,k,o]),$=n.useCallback(C=>{const F=parseFloat(C.height)/100;i?.(F),M(F),E(ie(w.current,parseFloat(C.height)/100,o))},[i,o]),A=n.useCallback(C=>{const F=C.filter.toString().match(vt)?.[1]??"0",ee=(16-parseFloat(F))/16,Ae=1-g,ne=g+Ae*ee;i?.(ne),M(ne),E(ie(w.current,ne,o))},[o,g,i]);if(!d)return t.jsx(Ce,{isDimensionsUnknown:!0,children:t.jsx(Ee,{withLottie:!0})});const q={duration:c/1e3,ease:"linear"},T=s!==1||!u;return t.jsxs("div",{className:L("relative z-0 cursor-pointer overflow-hidden",_<1?"max-w-[400px]":"max-w-[480px]",!B&&"pointer-events-none",!j.current&&"bg-token-main-surface-secondary",m&&"max-w-full"),"aria-label":e,style:{aspectRatio:_},children:[s&&s<he&&t.jsx("div",{className:"absolute inset-0 z-3 w-full overflow-hidden",children:t.jsx("div",{className:"absolute start-[-150%] top-[-150%] h-[400%] w-[400%]",children:t.jsx("div",{className:"diagonal-sweep-gradient h-full w-full"})})}),t.jsxs(ae.div,{className:"absolute start-0 end-0 top-0 z-2 w-full overflow-hidden transition-[mask] ease-linear",initial:k?!1:{height:"0%"},animate:B?{height:"100%"}:{height:`${g*100}%`},onUpdate:k?void 0:$,transition:k?{duration:0,ease:"linear"}:q,style:B?void 0:{mask:"linear-gradient(rgb(0,0,0) 0%, rgb(0,0,0) calc(100% - 24px), rgba(0,0,0,0) 100%)"},children:[a&&t.jsx("img",{ref:G,src:a,onLoad:V,onError:h,alt:e,className:"absolute top-0 z-1 w-full",style:{aspectRatio:_}}),u&&t.jsx("div",{className:"absolute inset-0 z-0 w-full overflow-hidden opacity-0 transition-opacity duration-300 group-hover/imagegen-image:opacity-100 group-focus/imagegen-image:opacity-100",children:t.jsx("div",{className:"absolute inset-0 bg-repeat",style:{backgroundImage:l,backgroundSize:"auto"}})})]}),t.jsx(ae.div,{className:"relative z-1 w-full overflow-hidden",initial:{filter:"blur(16px)"},animate:k?{filter:"blur(0px)"}:void 0,transition:k?It:void 0,onUpdate:k?A:void 0,style:{aspectRatio:_},children:w.current.map((C,F)=>{const Q=v[F],ee=C.availablePercentComplete===1;return Q!==0||ee?t.jsx("img",{src:C.src,alt:e,style:{opacity:Q,willChange:"opacity",aspectRatio:_},className:"absolute top-0 w-full",onLoad:ee?()=>N(!0):void 0},C.src):null})}),t.jsx(ae.div,{className:"absolute inset-0 z-0 scale-110 overflow-hidden blur-2xl",style:{aspectRatio:_},children:T&&w.current.filter((C,F)=>v[F]!==0).map(C=>t.jsx("img",{src:C.src,alt:e,className:"absolute top-0 w-full"},C.src))})]})},pe=2,Ne=({pointer:e,altLabel:a,isEditorAvailable:s,onPercentageRendered:i,messageId:o,clientThreadId:u,serverThreadId:r,isMultiGen:h,onEditorClick:m})=>{const f=Qe(),[l,d]=n.useState(void 0),p=n.useRef(void 0),c=e.metadata?.generation?.gen_id,x=e.metadata?.generation?.height??void 0,y=e.height,M=(x??0)/y,g=n.useRef({}),[D]=Xe(),{isUnauthenticated:I}=Ue(),[O,w]=n.useState(!1),v=n.useContext(be),E=e.width/e.height,R=ot({imageAssetPointer:e,serverThreadId:r}),j=n.useCallback((T=!1)=>{!T&&p.current===e.asset_pointer||(p.current=e.asset_pointer,rt.fetch(f,{asset:e,conversationId:r,force:T,isUnauthenticated:I}).then(C=>{d(C)}).finally(()=>{p.current=void 0}))},[e,f,r,I,null]);n.useEffect(()=>{const T=e.asset_pointer!==l?.asset_pointer;(!l||T)&&j()},[l,e.asset_pointer,j]);const G=n.useMemo(()=>je({pointer:l,conversationId:r,messageId:o,source:v?"paragen":"chat"}),[l,r,o,v]),B=n.useRef(M);n.useEffect(()=>{M===1&&B.current<1&&S.renderingComplete({analyticsContext:G})},[M,G]);const k=n.useCallback(()=>{l&&m?.({image:l,messageId:o,analyticsContext:G})},[l,o,m,G]),_=n.useMemo(()=>({width:e.width,height:e.height}),[e]),V=n.useCallback(()=>{const T=(g.current[e.asset_pointer]??0)+1;if(g.current[e.asset_pointer]=T,g.current[e.asset_pointer]>pe)return ge.addAction("image-gen-asset-error",{name:"retries-exhausted",conversation_id:r,asset_pointer:e.asset_pointer,max_retries:pe});ge.addAction("image-gen-asset-retry",{name:"retry-attempted",conversation_id:r,asset_pointer:e.asset_pointer,current_retry:T}),g.current[e.asset_pointer]=T,j(!0)},[e.asset_pointer,j,r]),$=n.useCallback(T=>{T===1&&w(!0),i?.(T)},[i]),A=l?.url,Z=h?"rounded-lg":"rounded-2xl",q=R??A;return t.jsx(lt.Provider,{value:G,children:t.jsxs("div",{className:L("group/imagegen-image relative overflow-hidden",E<1?"max-w-[400px]":"max-w-[480px]",Z,v&&"max-w-full",o===D.get("image")&&"[view-transition-name:var(--vt-active-image)]"),id:`image-${o}`,style:{aspectRatio:E},onClick:s?k:void 0,tabIndex:0,children:[R&&t.jsx("img",{alt:a,className:"absolute inset-0 z-1 opacity-0",src:R}),t.jsx(_t,{alt:a,src:A,availablePercentComplete:M,onAnimationUpdate:$,isEditorAvailable:s,ignoreFirstChunk:!0,isTransparent:e.metadata?.generation?.transparent_background,dimensions:_,onError:V,unconstrainedWidth:v},c),O&&(v?t.jsx(yt,{imageUrl:A??""}):t.jsx(pt,{image:A?{asset_pointer:A,alt:a,fileId:G.fileId}:void 0,imageUrl:q,onEditorClick:k,isEditorAvailable:s,messageId:o,clientThreadId:u,serverThreadId:r,shouldShowOverflow:R!==void 0}))]},c)})},jt=({pointersToRender:e,altLabel:a,isEditorAvailable:s,updatePercentageRendered:i,messageIds:o,clientThreadId:u,serverThreadId:r,handleEditorClick:h})=>{const m=n.useRef({}),f=n.useCallback(l=>d=>{m.current[l]=d;const p=Object.keys(m.current).length,c=Object.values(m.current).reduce((x,y)=>x+y,0);i?.(c/p)},[i]);return e.map((l,d)=>{const p=l.metadata?.generation?.gen_id;return t.jsx(Ne,{pointer:l,altLabel:a,isEditorAvailable:s,onPercentageRendered:p?f(p):void 0,messageId:o[d],clientThreadId:u,serverThreadId:r,isMultiGen:!0,onEditorClick:h},p)})};function kt(e){const a=e.find(r=>r.author.role==="tool"&&r.author.name===Y&&r.content.content_type==="text"),[s,...i]=a?.content.content_type==="text"?a.content.parts:[],o=i.pop(),u=i.length;return s&&o&&i.length>0?{thinking:s,complete:o,generating:i.reduce((r,h,m)=>{const f=(m+1)/u;return r[f.toFixed(2)]=h,r},{})}:void 0}function Ge(e){const a=e.filter(o=>o.author.role==="tool"&&o.author.name===Y&&o.content.content_type===K.MultimodalText),s=a.flatMap(o=>Be.getImageAssetPointers(o)),i=a.map(o=>o.id);return{imageAssetPointers:s,messageIds:i}}const Ct=(e,a)=>{const s=e.find(c=>c.author.role===He.Tool&&[K.Error,K.SystemError].includes(c.content.content_type)||c.metadata?.is_error),{imageAssetPointers:i}=Ge(e),o=e.some(c=>{const x=c.author.name===Y,y=c.content.content_type===K.MultimodalText,M=!!c.metadata?.is_visually_hidden_from_conversation;return x&&y&&M}),u=e.some(c=>{if(c.metadata?.image_gen_async)return!1;const x=c.author.name===te.IMAGE_GEN_HALLUCINATED||c.author.name===Y,y=c.content.content_type===K.Text,M=!!c.metadata?.is_visually_hidden_from_conversation;return x&&y&&M}),r=e.length>0&&!!e[e.length-1]?.metadata?.image_gen_async,m=!e.some(c=>[Y,te.IMAGE_GEN_HALLUCINATED].includes(c.author.name??"")&&c.content.content_type===K.MultimodalText)&&e.some(c=>{const x=[Y,te.IMAGE_GEN_HALLUCINATED].includes(c.author.name??""),y=c.recipient==="assistant";return x&&y});let f=0;for(const c of i){const x=c.height,y=c.metadata?.generation?.height??void 0;f+=x!==void 0&&y!==void 0?y/x:0}const l=i.length>0?f/i.length:0,d=s!==void 0,p=a?b.AsyncGenerating:b.AsyncHanging;if(o||u||m)return b.Empty;if(d)return b.Errored;if(l){if(l<1)return r?p:b.Generating;if(l===1)return b.Complete}else return r?p:b.Thinking;return b.Unavailable},St=e=>{const a=W(),{size:s="image",count:i=1}=e||{};return i>1?{thinking:a.formatMessage({id:"cdnmKo",defaultMessage:"Getting started"}),generating:{"0.33":a.formatMessage({id:"aTbInH",defaultMessage:"Creating images. May take a moment."}),"0.67":a.formatMessage({id:"WRM3Yw",defaultMessage:"Creating images. May take a moment."}),"1.00":a.formatMessage({id:"8ZydRG",defaultMessage:"Creating images. May take a moment."})},complete:a.formatMessage({id:"XQ81dl",defaultMessage:"Images created"})}:s==="xlimage"?{thinking:a.formatMessage({id:"y7op2E",defaultMessage:"Getting started"}),generating:{"0.33":a.formatMessage({id:"cdrDJH",defaultMessage:"Creating image. May take a moment."}),"0.67":a.formatMessage({id:"RP4bRn",defaultMessage:"Adding details"}),"1.00":a.formatMessage({id:"o36MSQ",defaultMessage:"Finishing touches"})},complete:a.formatMessage({id:"QsnnBN",defaultMessage:"Image created"})}:{thinking:a.formatMessage({id:"6c7+kN",defaultMessage:"Getting started"}),generating:{"0.33":a.formatMessage({id:"DP6/8y",defaultMessage:"Creating image"}),"0.67":a.formatMessage({id:"k9y1TT",defaultMessage:"Creating image"}),"1.00":a.formatMessage({id:"GpR7v3",defaultMessage:"Creating image"})},complete:a.formatMessage({id:"l2Izz4",defaultMessage:"Image created"})}},Et=$e(async()=>Ke(()=>import("./gicdud6trtoztlr0.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27])).then(e=>e.ImageGenNewEditor)),Rt=[b.Empty,b.Errored],Vt=({messages:e,clientThreadId:a,isLastTurnInConversation:s,disableClickThru:i=!1})=>{const o=ze(a),u=W(),r=u.formatMessage({id:"imagegen.message.altLabel",defaultMessage:"Generated image"}),[h,m]=n.useState(!1),[f,l]=n.useState(null),{messageIds:d,imageAssetPointers:p}=n.useMemo(()=>Ge(e),[e]),c=p?.[0]?.metadata?.generation?.gen_size,x=St({size:c??"image",count:p?.length??1}),y=n.useMemo(()=>kt(e)??x,[e,x]),M=e.find(A=>A.metadata?.image_gen_async),g=n.useMemo(()=>Ct(e,s),[e,s]),D=n.useRef(!1),I=n.useRef(!1),O=n.useRef(null),w=n.useMemo(()=>je({pointer:p[0],conversationId:o,messageId:d[0],source:i?"paragen":"chat"}),[p,d,o,i]);n.useEffect(()=>{if(!D.current&&(g===b.Thinking||g===b.Generating))D.current=!0,O.current=performance.now();else if(D.current&&!I.current)if(g===b.Complete){const A=O.current?performance.now()-O.current:void 0;S.generationSuccess({analyticsContext:w,durationMs:A}),I.current=!0}else g===b.Errored&&(S.generationFailure({analyticsContext:w,errorReason:"assistant_error"}),I.current=!0)},[g,w]);const v=e[e.length-1],E=n.useMemo(()=>v&&We(v),[v]),{value:R}=oe("3058498100"),N=n.useMemo(()=>R?p:p.slice(0,1),[R,p]),j=N.length>1,G=Ze({clientThreadId:a})&&g===b.Complete,[B,k]=n.useState(0),[_,V]=n.useState(null),$=n.useCallback(({image:A,messageId:Z,analyticsContext:q})=>{l(A),V(Z),m(!0),S.editorClick({sourceOperation:A.metadata?.dalle?.edit_op??"none",analyticsContext:q})},[]);return Rt.includes(g)?null:t.jsxs(be.Provider,{value:i,children:[t.jsxs("div",{className:"flex flex-col",children:[g!==b.Unavailable&&g!==b.AsyncGenerating&&g!==b.AsyncHanging&&t.jsx("div",{className:"pb-3",children:t.jsx(ft,{cotMessages:y,visualPercentComplete:B,isInterrupted:E,state:g})}),g===b.Thinking&&!E&&t.jsx(Ce,{isDimensionsUnknown:!0,children:t.jsx(Ee,{withLottie:!0})}),g===b.AsyncGenerating&&!M?.metadata?.is_visually_hidden_from_conversation&&t.jsx(gt,{shimmer:!0,title:M?.metadata?.ui_card_title,description:M?.metadata?.ui_card_description}),(g===b.Generating||g===b.Complete)&&!E&&t.jsx("div",{className:L("grid pb-2",{"grid-cols-2 gap-2":j,"grid-cols-1":!j}),children:j?t.jsx(jt,{pointersToRender:N,altLabel:r,isEditorAvailable:G,updatePercentageRendered:k,messageIds:d,clientThreadId:a,serverThreadId:o,handleEditorClick:$}):t.jsx(Ne,{pointer:N[0],altLabel:r,isEditorAvailable:G,onPercentageRendered:k,messageId:d[0],clientThreadId:a,serverThreadId:o,onEditorClick:$})})]}),t.jsx(Ve,{testId:"modal-image-gen-content",type:"success",size:"fullscreen",isOpen:h,onClose:()=>m(!1),title:u.formatMessage({id:"imagegen.message.contentModalTitle",defaultMessage:"Edit image"}),visuallyHiddenHeader:!0,className:"dark:bg-(--gray-800)",children:f&&t.jsx(Et,{image:f,isLoadingNewImage:!1,clientThreadId:a,onClose:()=>m(!1),messageId:_??""})})]})};export{Vt as ImageGenMessage};
//# sourceMappingURL=l0hp1g1dyfwzfw82.js.map
