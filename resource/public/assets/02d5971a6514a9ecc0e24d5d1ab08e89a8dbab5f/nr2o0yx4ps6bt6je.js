import{f as h,j as t,M as C,g as M,u as S,r as k,q as I}from"./msupklk377u8vx8o.js";import{ar as O,cN as m,f as T,ce as j,aw as d,e8 as b,c as g}from"./i3bl95k8z8nuf4dv.js";import{e5 as F,e6 as R,dO as D,e7 as U,e8 as L,e9 as A}from"./idf4u2jy0wx0pvap.js";function _({jupyterMessage:e}){const r=F(),s=h(),{width:a,height:n}=e;if(r)return t.jsxs("div",{className:"text-token-text-tertiary my-1 flex h-52 w-full max-w-xs flex-col items-center justify-center gap-2 rounded-md border-black/5 bg-gray-100 p-7 text-center dark:border-white/10",children:[t.jsx(R,{className:"icon-lg"}),t.jsx(C,{...p.imageNotSupported})]});if(e.image_payload!=null)return t.jsx("img",{className:"my-1 max-h-full max-w-full object-contain",src:`data:image/png;base64,${e.image_payload}`,alt:s.formatMessage(p.altText),width:a,height:n});if(e.image_url!=null){const o=D(e.image_url);return t.jsx($,{fileId:o,width:a,height:n})}return null}const P=30*1e3,w=100,x=1.5,q=Math.log(1-P*(1-x)/w)/Math.log(x);function J(e,r){return I({queryKey:["getFileDownloadLink",e],queryFn:()=>T.getFileDownloadLink(e,void 0,r),refetchInterval:s=>{const a=s.state.dataUpdateCount;return s.state.data?.status===m.Success||a>q||s.state.status===m.Error?!1:Math.pow(x,a)*w}})}function $({fileId:e,width:r,height:s}){const a=h(),{isUnauthenticated:n}=O(),{data:o,isLoading:u,refetch:l}=S(J(e,n));return k.useEffect(()=>{if(o?.status===m.Success){const i=new URL(o.download_url,location.toString()).searchParams.get("se");i!=null&&!u&&new Date>new Date(i)&&l()}},[o,u,l]),o?.status!==m.Success?null:t.jsx("img",{src:o.download_url,className:"my-1 max-h-full max-w-full object-contain",alt:a.formatMessage(p.altText),width:r,height:s})}const p=M({imageNotSupported:{id:"CodeExecutionOutputImage.imageNotSupported",defaultMessage:"Image output is not supported in a shared chat"},altText:{id:"CodeExecutionOutputImage.altText",defaultMessage:"Output image"}});function G({FormattedText:e,message:r,codeRendererClassName:s,forceDarkMode:a,removeTopBorderRadius:n,showActionBar:o,codeContainerClassName:u}){const l=b()||a,c=H(r);return c==null?null:t.jsx(L.Provider,{value:{isWithinDataAnalysisToolMessage:!0},children:t.jsx(e,{className:g("markdown prose dark:prose-invert w-full break-words",l?"dark":"light"),forceDarkMode:a,componentOverrides:{code:i=>t.jsx(A,{...i,wrapperClassName:s,codeContainerClassName:u,removeTopBorderRadius:n,showActionBar:o})},children:c})})}function H(e){function r(s,a){return`\`\`\`${a}
${s}
\`\`\``}if(e.content.content_type==="code")return r(e.content.text,"python");if(e.recipient==="python"){if(e.content.content_type!=="text")return d.addError("Unexpected content type for code message"),null;const s=e.content.parts;return s.length!==1||typeof s[0]!="string"?(d.addError("Unexpected parts for code message"),null):r(s[0],"python")}return d.addError("Unexpected code message format"),null}function W({message:e,showLabel:r=!0,wrapperClassName:s,codeContainerClassName:a,forceDarkMode:n}){const o=h();if(e.content.content_type!==j.ExecutionOutput)return null;const u=e.metadata?.aggregate_result;if(!u)return d.addError("Corrupt code execution result message"),null;const l=u.messages.filter(K),c=l.length>0,i=u.final_expression_output!=null,N=u.in_kernel_exception!=null;return t.jsxs(t.Fragment,{children:[c&&t.jsx(E,{forceDarkMode:n,label:r?"STDOUT/STDERR":null,wrapperClassName:s,output:l.map((y,v)=>t.jsx("span",{className:y.stream_name==="stderr"?"text-red-500":"",children:y.text},`${v}`))}),i&&t.jsx(E,{forceDarkMode:n,wrapperClassName:s,codeContainerClassName:a,label:r?o.formatMessage({id:"codeInterpreterMessage.resultLabel",defaultMessage:"Result"}):null,output:u.final_expression_output}),N&&t.jsx(X,{traceback:u.in_kernel_exception.traceback.join("")})]})}function E({wrapperClassName:e,label:r,output:s,codeContainerClassName:a,forceDarkMode:n}){const o=b()||n;return t.jsxs("div",{className:g("bg-token-sidebar-surface-primary p-4 text-xs",e),children:[r&&t.jsx("div",{className:"mb-1 text-gray-400",children:r}),t.jsx("div",{className:g("prose flex flex-col-reverse",o?"text-white":"text-black"),children:t.jsx("pre",{className:g("shrink-0 overflow-visible",a),children:s})})]})}function X({traceback:e}){return t.jsx("div",{className:"overflow-auto border-t border-gray-500 bg-black text-white",children:t.jsx("div",{className:"border-s-4 border-red-500 p-2 text-xs",children:t.jsx("div",{className:"scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-700 flex max-h-64 flex-col-reverse",children:t.jsx("pre",{className:"shrink-0",children:e})})})})}function B({message:e,isCoT:r=!1}){if(e.content.content_type!==j.ExecutionOutput)return null;const s=e.metadata?.aggregate_result;return s?r?s.messages.filter(f).map((a,n)=>t.jsx(_,{jupyterMessage:a},n)):t.jsx("div",{className:"flex flex-wrap gap-2",children:s.messages.filter(f).map((a,n)=>t.jsx("div",{className:"max-h-64 items-start justify-start sm:max-h-80",children:t.jsx(_,{jupyterMessage:a})},n))}):(d.addError("Corrupt code execution result message"),null)}function K(e){return e.message_type==="stream"}function f(e){return e.message_type==="image"||"image_url"in e&&U(e.image_url+"")}function Y(e){return e.metadata?.aggregate_result?.messages.some(f)??!1}export{B as C,G as a,W as b,J as c,_ as d,H as g,Y as h,f as i};
//# sourceMappingURL=nr2o0yx4ps6bt6je.js.map
