import{r as l,al as B,o as q,f as K,j as n,a9 as Y,a8 as f}from"./msupklk377u8vx8o.js";import{lA as X,lB as J,lC as W,lD as Q,C as x,lE as $,lF as Z,lG as tt,lH as et,lI as st,lJ as at,lK as ot,jp as nt,lL as it,lM as rt,lN as ct,lO as R,lP as O,jn as dt,u as lt,lQ as N,U as M,lR as F,lS as ut,lT as mt,hh as pt,lU as ht}from"./idf4u2jy0wx0pvap.js";import{gQ as y,al as j,bo as L,ax as w,dE as gt,du as ft,g1 as xt,e1 as Ct,dF as vt,gJ as Tt,g7 as wt}from"./i3bl95k8z8nuf4dv.js";import{u as bt,L as It}from"./cx50bzj9gti9k1eh.js";import{T as St}from"./bgffthat6lwvaj3l.js";import{g as yt}from"./btagl6w1gub4aw61.js";import"./jy1u8exw8iz2slve.js";import"./eyf2nwgexpz6pjnh.js";import"./etqfvs5ggajp1a11.js";import"./ftpfjx7bripqt5mr.js";import"./l4zbgkg566u66cq3.js";import"./eo5uot0b1uoupak4.js";import"./gy64pge8qevmvg7e.js";import"./itm96x5skyrm0csf.js";import"./hwl3hzno2kq7obfl.js";import"./hmii3551qscelikg.js";import"./i3xeaua08fnq6vw7.js";import"./mg22stn4exi88qee.js";import"./gjp4gv474prvqiwp.js";import"./kwmncs5inhubx058.js";import"./hgzals0lml4o26vg.js";import"./galv4529ourghuwf.js";import"./hskvlm4fdvagz0fn.js";import"./bk8slwxjkdlmxjxm.js";import"./bpz5dug6lzivjns5.js";import"./bh8emud9m2ohtvi0.js";import"./fii0gwkgtas4sckd.js";import"./k4oexpwbiepmd1cd.js";import"./np9w83f07wa6edf5.js";import"./gc51ish3otzvnj1w.js";import"./gd7xfxa2yqt151v4.js";import"./igftvtdft8b4phs3.js";import"./o2t4lszmsavslsdu.js";import"./gwmfzjrffpu4d2tx.js";import"./onklb7txlsriyspd.js";const D="oai/apps/canmoreSidebarWidth",Et=.25,At=400,P=400;function k(t){return t-At}function I(t,s){return B(P,k(t),s??Et*t)}function _t(){const t=y.useState(y.selectWindowWidth),s=I(t,X(j.DANGER_SECRET_FOLDERS_ONLY_getItem(D))),a=H(),[e,r]=l.useState(s);l.useEffect(()=>{(e<P||e>k(t))&&r(I(t,e))},[t]);function o(c){r(C=>I(t,C+=c.delta.x))}function i(c){r(c),j.DANGER_SECRET_FOLDERS_ONLY_setItem(D,c)}function u(){const c=I(t,void 0);i(c)}const p=`calc(100vw - ${e}px)`;return a?{chatWidth:e,canvasWidth:t-e,canvasWidthCalc:p,viewportWidth:t,handleDrag:o,handleDoubleClick:u,persist:i}:{chatWidth:0,canvasWidth:t,canvasWidthCalc:"100vw",viewportWidth:t,handleDrag:()=>{},handleDoubleClick:()=>{},persist:()=>{}}}function H(t){const s=y.useState(y.selectWindowWidth);return(t??s)>1e3}const A="sharedCanvas";function Rt(){const[t,s]=q(),a=t.get(A),e=K();l.useEffect(()=>{const r=a&&J.createRemixTempTextdoc(a,e);if(!r)return;requestAnimationFrame(()=>{W(r)});const o=new URLSearchParams(t);o.delete(A),s(o);const i=new URL(window.location.href);i.searchParams.delete(A),history.replaceState(null,"",i)},[a,t,s,e])}const Nt="textdocId",Mt=t=>{const a=new URLSearchParams(window.location.search).get(Nt),e=L(t,r=>w.findNode(r,({message:o})=>{const i=o.metadata?.canvas;return i?.create_source===Q.HIVE&&(a?i?.textdoc_id===a:!0)})?.message.metadata?.canvas?.textdoc_id);l.useEffect(()=>{e&&requestAnimationFrame(()=>{W(e)})},[e])};function Ft(t,s){let a;return s?.type===x.Textdoc&&(s.textdocId.startsWith($)||(a={type:"canvas_textdoc",id:s.textdocId})),Z(t,{promptMessage:{metadata:{open_in_canvas_view:a}}})}const U=({isFullScreen:t=!1,clientThreadId:s,focusedObject:a,onClose:e,isAnimating:r=!1,width:o})=>{const{setTargetedContent:i}=tt(),u=l.useRef(!1);if(l.useEffect(()=>(u.current&&i(void 0),u.current=!0,()=>{u.current=!1}),[a]),a==null)return null;switch(a.type){case x.Textdoc:return n.jsx(St,{isFullScreen:t,onClose:e,clientThreadId:s,focusedTextdoc:a,isAnimating:r,width:o});case x.Kanzi:break;case x.ADAVisualization:return null}},jt=300,Dt=t=>{switch(t?.type){case x.Textdoc:return t.textdocId;default:return null}};function Wt(t,s){const[a,e,r,o]=L(t,d=>[w.getRequestId(d),w.getConversationLastTurn(d),w.isMessageTurnEnded(d),w.getVariantIds(d).length>1]),i=gt(a),u=et(),[p,c]=l.useMemo(()=>{if(e&&o)return[void 0,null];if(s===!0)return[void 0,null];let d;return!r&&e&&(d=ft(e.messageGroups,h=>h.type!==xt)),Ot({groupedMessage:d,isRequestActive:i,latestTextdocId:u})},[r,e,o,s,i,u]),C=c!=null,v=Dt(c),T=st("canvas");l.useEffect(()=>{if(c&&p&&!at()&&(T(),ot(c,p),c.type===x.Textdoc)){const{textdocId:d}=c,h=yt(d);nt(document.getElementById(h))}},[C,v])}function Ot({groupedMessage:t,isRequestActive:s,latestTextdocId:a}){switch(t?.type){case Ct.Canmore:{const[e,r]=t.messages;if(!it(e))break;const o=rt(s,e,r??null),i=o.textdocId??a;if(i&&(o.function===ct.CreateTextdoc?(o.content??"").length>jt||o.status===R.WAITING:o.status===R.STREAMING))return[o.messageId,{type:x.Textdoc,textdocId:i}];break}}return[void 0,null]}const S={type:"spring",bounce:.12,duration:.64},Lt={type:"spring",bounce:0,duration:.58},Pt=({clientThreadId:t,focusedObject:s,onClose:a})=>{const{chatWidth:e,canvasWidthCalc:r,handleDrag:o,handleDoubleClick:i,persist:u}=_t(),[p,c]=l.useState(!0),[C,v]=l.useState(!1),T=ut(({rect:m})=>m),{windowHeight:d,windowWidth:h}=wt(m=>m,{windowWidth:0,windowHeight:0});let g=T??{top:0,left:e,width:h-e,height:d},_=!1;if(T&&(g.top<0||g.top+g.height>d)){_=!0;const m={width:(h-e)*.75,height:d*.75};g={top:d/2-m.height/2,left:(h-e-m.width)/2+e,width:m.width,height:m.height}}const b=T?.borderRadius,E=mt(),V=E?.history!=null||E?.showChangesAtVersion!=null,z=pt();return n.jsxs(n.Fragment,{children:[V&&n.jsx(It,{onClick:()=>ht(E.textdocId),zIndexKey:"chatOverlay"}),n.jsxs(f.div,{initial:{marginRight:z?0:-260},animate:{marginRight:0},transition:Lt,children:[n.jsx(f.div,{initial:{opacity:1},animate:{opacity:0},exit:{opacity:[1,0]},transition:{...S,delay:.22},className:"bg-token-main-surface-primary pointer-events-none absolute start-0 top-0 z-20 h-full w-full"}),n.jsx(f.div,{className:"relative z-20 h-full",style:{width:r},exit:{width:0},transition:{type:"spring",bounce:0,duration:.1}})]}),n.jsx(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"pointer-events-none absolute start-0 top-0 z-10 h-full w-full bg-black/[0.025] dark:bg-transparent"}),n.jsx(f.div,{className:"absolute start-0 z-20 h-full overflow-hidden transition-shadow",initial:{borderRadius:b,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)",opacity:_?0:1,x:g.left,y:g.top,height:g.height,width:g.width},animate:{opacity:1,x:e,y:0,width:r,height:d,borderRadius:0,boxShadow:"0px 0px 18px rgba(0,0,0,0.075)"},exit:{scale:.64,opacity:0,filter:"blur(12px)",transition:{opacity:{duration:.14,bounce:.1}},borderRadius:b,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)"},transition:C?{duration:0}:S,onAnimationComplete:()=>c(!1),children:n.jsx(f.div,{className:"dark:border-token-border-medium h-full overflow-hidden border-s border-gray-100",initial:{borderRadius:b},animate:{borderRadius:0},exit:{borderRadius:b},transition:S,children:n.jsxs("div",{className:"h-full",children:[n.jsx(f.div,{drag:"x",className:"bg-token-text-quaternary absolute start-[-2px] z-10 h-full w-[4px] cursor-ew-resize opacity-0",whileHover:{opacity:.5},whileDrag:{opacity:.75,width:"8px",left:"-4px"},transition:{type:"tween",duration:.1},style:{x:0,y:0,transform:"translateX(0px)"},dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:{left:0,right:0,top:0,bottom:0},onPointerDown:()=>v(!0),onPointerUp:()=>v(!1),onDrag:(m,G)=>o(G),onDragEnd:()=>{v(!1),u(e)},onDoubleClick:()=>i()}),C&&n.jsx("div",{className:"absolute inset-0 z-10"}),n.jsx(U,{onClose:a,clientThreadId:t,isAnimating:p,focusedObject:s,width:h-e})]})})})]})},kt=l.memo(Pt),Ht=({clientThreadId:t,focusedObject:s,onClose:a})=>n.jsx(Tt,{children:n.jsx(f.div,{className:"fixed inset-0 z-40 overflow-hidden shadow-xl md:border-gray-100 md:dark:border-gray-700",initial:{scale:.98},animate:{scale:1},transition:S,children:n.jsx(U,{isFullScreen:!0,clientThreadId:t,focusedObject:s,onClose:a})})}),Ut=({clientThreadId:t,overrideWidth:s,isAutoFocusDisabled:a=!1})=>{const e=H(s),r=bt();Wt(t,a||r),Rt(),Mt(t);const o=lt();l.useEffect(()=>{O()},[t]);const i=o&&(e?n.jsx(kt,{clientThreadId:t,onClose:F,focusedObject:o},"canvas-sidebar"):n.jsx(Ht,{clientThreadId:t,onClose:F,focusedObject:o},"canvas-modal"));l.useEffect(()=>{if(o)return N(p=>Ft(p,o)),()=>N(null)},[o]);const u=i!=null;return l.useEffect(()=>(M.setActiveStageSidebar(u),()=>{u&&M.setActiveStageSidebar(!1)}),[u]),n.jsx(Y,{children:i},t)},Ie=t=>{const s=l.useRef(null);return n.jsx(vt,{ref:s,onError:(a,e)=>{O(),setTimeout(()=>{s.current?.resetErrorBoundary()}),dt.logError("Error boundary hit",a,{componentStack:e})},name:"canmore-focused-view",children:n.jsx(Ut,{...t})})};export{Ie as CanvasFocusedViewManager};
//# sourceMappingURL=igoc4yhxv10ch5gr.js.map
