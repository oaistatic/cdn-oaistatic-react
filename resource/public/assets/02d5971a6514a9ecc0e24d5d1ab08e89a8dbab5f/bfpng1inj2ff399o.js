import{R as C,r as m,j as s,M as g,a8 as f,a9 as N,f as k}from"./msupklk377u8vx8o.js";import{gw as b,cE as y,b1 as j,bs as T,bQ as R,ax as M,gx as A,fG as S,c as x,dq as I,e8 as G}from"./i3bl95k8z8nuf4dv.js";import{T as D}from"./frhd6tee23cbdnaa.js";import{hl as E,hm as q,hn as B,ho as z}from"./idf4u2jy0wx0pvap.js";import{C as H}from"./hgzals0lml4o26vg.js";import"./eo5uot0b1uoupak4.js";import"./ftpfjx7bripqt5mr.js";import"./jy1u8exw8iz2slve.js";import"./l4zbgkg566u66cq3.js";import"./gy64pge8qevmvg7e.js";import"./itm96x5skyrm0csf.js";import"./f7zf49kk7a06uq1f.js";import"./iuut6wtkbfu13xzm.js";import"./dejvjdz4f1ue8tzm.js";import"./hmii3551qscelikg.js";import"./i3xeaua08fnq6vw7.js";import"./cqzdy3h5gfhj8ga6.js";import"./cw7v9j8k3qerlfe7.js";import"./k0gfwt82z96kzlbw.js";import"./mtvwsbeyeq99j9dh.js";import"./nxqfgrk9atl9s5yp.js";import"./hwl3hzno2kq7obfl.js";function L(e){const t=b.createRootNode("y-root"),o=[t];let n=t.id;for(const l of e){const r=b.createNode(l,n);o.push(r),n=r.id}const a=o.reduce((l,r)=>(l[r.id]={id:r.id,parent:r.parentId,message:r.message,children:[]},l),{});return{allConversationMessages:o,threadResponse:{moderation_results:[],conversation_id:"",current_node:n,title:null,mapping:a}}}function O({turn:e,turnIndex:t,clientThreadId:o,hasActiveRequest:n,isFinalTurn:a}){return s.jsx(H,{turnIndex:t,clientThreadId:o,groupedMessagesToRender:e.messageGroups,allGroupedMessages:e.messageGroups,allMessages:e.messages,isUserTurn:e.role==="user",isFinalUserTurn:!1,isCompletionRequestInProgress:!1,isFeedbackEnabled:!1,isFinalTurn:a,hasActiveRequest:n,onRequestCompletion:()=>{}})}function V({messages:e,hasActiveRequest:t,clientThreadId:o}){const n=m.useMemo(()=>{if(o)return null;const r=y();return j.initThread(r,{kind:T.PrimaryAssistant}),r},[]),a=o??n,l=m.useMemo(()=>{const r=R(a);if(r&&a===o){const c=new Set(e.map(p=>p.id));return M.getConversationTurns(r).filter(p=>p.role!=="root"&&p.messages.some(h=>c.has(h.id)))}const{allConversationMessages:i,threadResponse:d}=L(e);j.initThreadFromServerData(a,d,!1,void 0,!0);let u=[];for(const c of i)u=A(u,c.message);return u.filter(c=>c.role!=="root")},[e,a,o]);return s.jsx("div",{className:"space-y-2",children:l.map((r,i)=>s.jsx(O,{turn:r,turnIndex:i,clientThreadId:a,hasActiveRequest:t,isFinalTurn:i===l.length-1},r.messages[0].id))})}const F=C.memo(V),U=m.memo(D,(e,t)=>e.sharedTextdoc.sharedTextdocId===t.sharedTextdoc.sharedTextdocId&&e.showHeader===t.showHeader&&e.disableNetworkRequests===t.disableNetworkRequests&&e.unsafeAllowAllNetworkRequests===t.unsafeAllowAllNetworkRequests&&e.disablePermissions===t.disablePermissions);function K({children:e,className:t,fullscreen:o}){const n=m.useRef(null),[a,l]=m.useState(!1),i=G()?"#353535":"#fff";return m.useEffect(()=>{const d=n.current;if(!d)return;const u=()=>l(d.scrollHeight>d.clientHeight);u();const c=new ResizeObserver(u);return c.observe(d),()=>{c.disconnect()}},[e]),s.jsxs("div",{ref:n,className:x(!o&&"relative",t,!a&&"pb-2"),children:[e,!o&&a&&s.jsx("div",{className:"pointer-events-none absolute start-0 end-0 bottom-0 h-40",style:{background:`linear-gradient(to top, ${i}, transparent)`}})]})}function Ne(){return s.jsx("div",{className:"w-full",children:s.jsx("div",{className:"bg-token-main-surface-secondary mx-auto block h-[120px] rounded-3xl",children:s.jsx(S,{})})})}const _={deep_research:s.jsx(z,{title:"Deep Research",className:"h-[16px] w-[16px]"}),canvas:s.jsx(B,{title:"Canvas",className:"h-[16px] w-[16px]"}),image:s.jsx(q,{title:"Image",className:"h-[16px] w-[16px]"}),sora:s.jsx(E,{title:"Sora",className:"h-[16px] w-[16px]"})},Q={deep_research:"Deep Research",canvas:"Canvas",image:"ImageGen",sora:"Sora"},W=({icon:e,label:t})=>s.jsxs("div",{className:"flex items-center gap-1 rounded-full bg-white/80 px-2 py-1 text-xs text-black backdrop-blur-xs dark:bg-black/50 dark:text-white",children:[e,s.jsx("span",{className:"font-semibold",children:t})]}),ke=({tags:e,badgeLabels:t})=>{const o=e.filter(n=>!!_[n]);return o.length===0?null:s.jsx("div",{className:"absolute end-3 top-3 z-10 flex gap-2",children:o.map(n=>s.jsx(W,{icon:_[n],label:t?.[n]??(Q[n]||n)},n))})};function Y({url:e,attachment_width:t,attachment_height:o,isFullscreen:n}){return s.jsx("video",{className:x(n?"mx-auto block max-h-screen max-w-full rounded-none object-contain":"mx-auto block w-full rounded-3xl object-cover object-center"),style:{aspectRatio:t/o},src:e,playsInline:!0,autoPlay:!0,muted:!0,loop:!0})}const $=m.memo(Y);function J({attachment:e,isFullscreen:t,isInline:o,isComposer:n}){return s.jsx("div",{className:x(t&&"flex h-screen items-center justify-center",t&&"rounded-none",o&&"rounded-3xl",n&&"mx-24 rounded-3xl"),children:e.generation_type==="video_gen"?s.jsx($,{url:e.url,attachment_width:e.width,attachment_height:e.height,isFullscreen:t,isInline:o}):s.jsxs("div",{className:"relative",children:[s.jsx("img",{className:x(t?"mx-auto block max-h-screen max-w-full rounded-none object-contain":"mx-auto block rounded-3xl object-cover object-center"),style:{aspectRatio:e.width/e.height},src:e.url,alt:e.kind}),e.output_blocked&&s.jsxs("div",{className:"text-token-text-error absolute start-0 bottom-0 flex h-1/4 w-full items-center justify-center gap-1 bg-transparent text-xs font-medium",children:[s.jsx(I,{className:"text-red-500"}),s.jsx(g,{id:"post-tree-attachment-output-blocked",defaultMessage:"Blocked by moderation"})]})]})})}const X=m.memo(J);function Z({url:e,isFullscreen:t,isInline:o,isComposer:n,isUnfurl:a}){const l=k();return s.jsx("div",{className:x(t&&"flex h-screen items-center justify-center",t&&"rounded-none",o&&"rounded-3xl",n&&"mx-24 rounded-3xl",a&&"h-full w-full"),children:s.jsx("img",{src:e,className:x(t?"mx-auto block max-h-screen max-w-full":"mx-auto block aspect-square",t?"rounded-none object-contain":a?"h-full w-full rounded-none object-cover object-top":"rounded-3xl object-center"),alt:l.formatMessage({id:"image-share-renderer-alt",defaultMessage:"User Shared Image"})})})}const v=m.memo(Z);function P({attachment:e,isFullscreen:t,isInline:o}){const n=m.useRef(null);return s.jsx("div",{ref:n,className:x("bg-token-main-surface-primary w-full",t?"h-[100vh] rounded-none":"",o?"h-[300px] cursor-zoom-in overflow-hidden rounded-3xl":"flex-1"),children:s.jsx(U,{disablePermissions:!t,sharedTextdoc:{sharedTextdocId:e.shared_textdoc_id,title:e.shared_textdoc.name,type:e.shared_textdoc.textdoc_type,content:e.shared_textdoc.content},showHeader:!1,unsafeAllowAllNetworkRequests:!0})})}const ee=m.memo(P);function se({attachment:e,caption:t,variant:o,coverPhotoUrl:n,hasActiveRequest:a,clientThreadId:l}){const r=e.tags?.includes("deep_research"),i=o==="fullscreen",d=o==="inline",u=o==="composer",c=o==="unfurl";switch(e.kind){case"message_slice":return e.messages.length===0?null:s.jsx(w,{caption:t,variant:o,coverPhotoUrl:n,messages:e.messages,hasActiveRequest:a,hasCaption:!r,clientThreadId:l});case"conversation_share":{const p=e.share.linear_conversation.map(h=>h.message).filter(h=>h!=null);return p.length===0?null:s.jsx(w,{hasCaption:!1,caption:t,variant:o,coverPhotoUrl:n,messages:p,hasActiveRequest:a,clientThreadId:l})}case"image_share":return s.jsx(v,{url:e.file_public_url,isFullscreen:i,isInline:d,isComposer:u,isUnfurl:c});case"media_generation":return s.jsx(v,{url:e.url,isFullscreen:i,isInline:d,isComposer:u,isUnfurl:c});case"canvas":return s.jsx(ee,{attachment:e,isFullscreen:i,isInline:d});case"sora":return s.jsx(X,{attachment:e,isFullscreen:i,isInline:d,isComposer:u});case"error":return s.jsx("div",{children:s.jsx(g,{id:"post-tree-attachment-error",defaultMessage:"Error loading attachment"})});default:return null}}function w({caption:e,variant:t,coverPhotoUrl:o,messages:n,hasActiveRequest:a,hasCaption:l,clientThreadId:r}){const i=t==="fullscreen",d=t==="inline",u=t==="composer",c=t==="unfurl";return s.jsxs(f.div,{layout:"position",className:x("bg-token-main-surface-primary inline-block w-full rounded-3xl dark:bg-[#353535]",i&&"h-screen overflow-auto rounded-none",u&&"shadow-[0_12px_24px_-6px_rgb(0_0_0_/_0.1),0_0_1px_rgb(0_0_0_/_0.2)] dark:shadow-[0_10px_20px_-6px_rgb(20_20_20_/_0.5),inset_0_0_1px_rgb(255_255_255_/_0.3)]",c&&"h-full"),children:[o&&s.jsx("img",{className:x("max-h-[300px] w-full object-cover object-center",{"rounded-t-3xl":t!=="fullscreen","rounded-none":i}),src:o,alt:e??""}),s.jsx(K,{fullscreen:!d,className:x("rounded-b-3xl",i&&"relative p-4 lg:px-24 lg:py-24",d&&"max-h-[300px] overflow-hidden p-6",u&&"max-h-[300px] overflow-auto p-6",c&&"h-full overflow-hidden p-5"),children:s.jsxs(f.div,{layout:"position",transition:{type:"spring",duration:.45,bounce:.15},children:[s.jsx(N,{mode:"wait",children:l?e==null&&t==="composer"?s.jsx(f.div,{layout:"position",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},children:s.jsx("div",{className:"text-token-text-primary max-w-[460px] pb-8 text-2xl leading-[1.4] font-medium",children:s.jsx("span",{className:"animate-pulse opacity-30",children:s.jsx(g,{id:"placeholder.generatingTitle",defaultMessage:"Generating title..."})})})},"loading-caption"):e!==""?s.jsx(f.div,{layout:"position",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},children:s.jsx("div",{className:"text-token-text-primary max-w-[460px] pb-8 text-2xl leading-[1.4] font-medium",children:e})},"caption"):null:null}),s.jsx(F,{messages:n,hasActiveRequest:a,clientThreadId:r})]})})]})}const ye=m.memo(se);export{ye as AttachmentContent,Q as BADGE_LABELS,W as Badge,ke as BadgeContainer,Ne as LoadingAttachmentContent,se as _AttachmentContent};
//# sourceMappingURL=bfpng1inj2ff399o.js.map
