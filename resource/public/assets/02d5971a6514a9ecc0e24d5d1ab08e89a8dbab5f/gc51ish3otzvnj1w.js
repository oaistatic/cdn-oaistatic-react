import{of as K,og as oe,hq as ie,d7 as le,jw as ce,fr as pe,A as ue,hu as de,e5 as fe,nX as me,oh as ge,V as he,db as ve,oi as Ce,oj as we,ok as ke,ol as V,om as xe,on as _e,oo as z,op as ye,oq as Me,or as Se,os as be,ot as Ee,ou as Te,cN as b,ov as Ie,ow as Le,ox as N,oy as q,oz as Ne,oA as Pe,oB as Re,nY as De,an as Oe}from"./idf4u2jy0wx0pvap.js";import{dw as je,dx as Ue,af as Ae,h2 as Fe,am as He,bn as Be,bo as Ge,ar as We,bC as Ke,an as x,k as Ve,l as ze,B as qe,aw as Ye,g as Xe,d5 as $e,e2 as Je,c as Qe,o as Ze,bG as et,bH as tt,bs as nt,f7 as st,bj as rt,cL as Y,h3 as at}from"./i3bl95k8z8nuf4dv.js";import{r as C,j as g,f as ot,M as O,R as X}from"./msupklk377u8vx8o.js";import{s as it,a as lt,t as ct,m as pt,p as ut,b as dt,c as ft,d as mt,P as gt,u as $}from"./hwl3hzno2kq7obfl.js";import{P as ht,a as J,M as vt,k as P,d as j,S as Ct,E as wt,e as kt,n as xt,i as _t,g as yt,h as Mt,j as U,r as St}from"./hmii3551qscelikg.js";const bt=500;class v{constructor(e,t){this.items=e,this.eventCount=t}popEvent(e,t){if(this.eventCount==0)return null;let a=this.items.length;for(;;a--)if(this.items.get(a-1).selection){--a;break}let s,r;t&&(s=this.remapping(a,this.items.length),r=s.maps.length);let o=e.tr,i,l,p=[],d=[];return this.items.forEach((c,u)=>{if(!c.step){s||(s=this.remapping(a,u+1),r=s.maps.length),r--,d.push(c);return}if(s){d.push(new k(c.map));let f=c.step.map(s.slice(r)),m;f&&o.maybeStep(f).doc&&(m=o.mapping.maps[o.mapping.maps.length-1],p.push(new k(m,void 0,void 0,p.length+d.length))),r--,m&&s.appendMap(m,r)}else o.maybeStep(c.step);if(c.selection)return i=s?c.selection.map(s.slice(r)):c.selection,l=new v(this.items.slice(0,a).append(d.reverse().concat(p)),this.eventCount-1),!1},this.items.length,0),{remaining:l,transform:o,selection:i}}addTransform(e,t,a,s){let r=[],o=this.eventCount,i=this.items,l=!s&&i.length?i.get(i.length-1):null;for(let d=0;d<e.steps.length;d++){let c=e.steps[d].invert(e.docs[d]),u=new k(e.mapping.maps[d],c,t),f;(f=l&&l.merge(u))&&(u=f,d?r.pop():i=i.slice(0,i.length-1)),r.push(u),t&&(o++,t=void 0),s||(l=u)}let p=o-a.depth;return p>Tt&&(i=Et(i,p),o-=p),new v(i.append(r),o)}remapping(e,t){let a=new vt;return this.items.forEach((s,r)=>{let o=s.mirrorOffset!=null&&r-s.mirrorOffset>=e?a.maps.length-s.mirrorOffset:void 0;a.appendMap(s.map,o)},e,t),a}addMaps(e){return this.eventCount==0?this:new v(this.items.append(e.map(t=>new k(t))),this.eventCount)}rebased(e,t){if(!this.eventCount)return this;let a=[],s=Math.max(0,this.items.length-t),r=e.mapping,o=e.steps.length,i=this.eventCount;this.items.forEach(u=>{u.selection&&i--},s);let l=t;this.items.forEach(u=>{let f=r.getMirror(--l);if(f==null)return;o=Math.min(o,f);let m=r.maps[f];if(u.step){let w=e.steps[f].invert(e.docs[f]),h=u.selection&&u.selection.map(r.slice(l+1,f));h&&i++,a.push(new k(m,w,h))}else a.push(new k(m))},s);let p=[];for(let u=t;u<o;u++)p.push(new k(r.maps[u]));let d=this.items.slice(0,s).append(p).append(a),c=new v(d,i);return c.emptyItemCount()>bt&&(c=c.compress(this.items.length-a.length)),c}emptyItemCount(){let e=0;return this.items.forEach(t=>{t.step||e++}),e}compress(e=this.items.length){let t=this.remapping(0,e),a=t.maps.length,s=[],r=0;return this.items.forEach((o,i)=>{if(i>=e)s.push(o),o.selection&&r++;else if(o.step){let l=o.step.map(t.slice(a)),p=l&&l.getMap();if(a--,p&&t.appendMap(p,a),l){let d=o.selection&&o.selection.map(t.slice(a));d&&r++;let c=new k(p.invert(),l,d),u,f=s.length-1;(u=s.length&&s[f].merge(c))?s[f]=u:s.push(c)}}else o.map&&a--},this.items.length,0),new v(K.from(s.reverse()),r)}}v.empty=new v(K.empty,0);function Et(n,e){let t;return n.forEach((a,s)=>{if(a.selection&&e--==0)return t=s,!1}),n.slice(t)}class k{constructor(e,t,a,s){this.map=e,this.step=t,this.selection=a,this.mirrorOffset=s}merge(e){if(this.step&&e.step&&!e.selection){let t=e.step.merge(this.step);if(t)return new k(t.getMap().invert(),t,this.selection)}}}class M{constructor(e,t,a,s,r){this.done=e,this.undone=t,this.prevRanges=a,this.prevTime=s,this.prevComposition=r}}const Tt=20;function It(n,e,t,a){let s=t.getMeta(S),r;if(s)return s.historyState;t.getMeta(Pt)&&(n=new M(n.done,n.undone,null,0,-1));let o=t.getMeta("appendedTransaction");if(t.steps.length==0)return n;if(o&&o.getMeta(S))return o.getMeta(S).redo?new M(n.done.addTransform(t,void 0,a,E(e)),n.undone,A(t.mapping.maps),n.prevTime,n.prevComposition):new M(n.done,n.undone.addTransform(t,void 0,a,E(e)),null,n.prevTime,n.prevComposition);if(t.getMeta("addToHistory")!==!1&&!(o&&o.getMeta("addToHistory")===!1)){let i=t.getMeta("composition"),l=n.prevTime==0||!o&&n.prevComposition!=i&&(n.prevTime<(t.time||0)-a.newGroupDelay||!Lt(t,n.prevRanges)),p=o?I(n.prevRanges,t.mapping):A(t.mapping.maps);return new M(n.done.addTransform(t,l?e.selection.getBookmark():void 0,a,E(e)),v.empty,p,t.time,i??n.prevComposition)}else return(r=t.getMeta("rebased"))?new M(n.done.rebased(t,r),n.undone.rebased(t,r),I(n.prevRanges,t.mapping),n.prevTime,n.prevComposition):new M(n.done.addMaps(t.mapping.maps),n.undone.addMaps(t.mapping.maps),I(n.prevRanges,t.mapping),n.prevTime,n.prevComposition)}function Lt(n,e){if(!e)return!1;if(!n.docChanged)return!0;let t=!1;return n.mapping.maps[0].forEach((a,s)=>{for(let r=0;r<e.length;r+=2)a<=e[r+1]&&s>=e[r]&&(t=!0)}),t}function A(n){let e=[];for(let t=n.length-1;t>=0&&e.length==0;t--)n[t].forEach((a,s,r,o)=>e.push(r,o));return e}function I(n,e){if(!n)return null;let t=[];for(let a=0;a<n.length;a+=2){let s=e.map(n[a],1),r=e.map(n[a+1],-1);s<=r&&t.push(s,r)}return t}function Nt(n,e,t){let a=E(e),s=S.get(e).spec.config,r=(t?n.undone:n.done).popEvent(e,a);if(!r)return null;let o=r.selection.resolve(r.transform.doc),i=(t?n.done:n.undone).addTransform(r.transform,e.selection.getBookmark(),s,a),l=new M(t?i:r.remaining,t?r.remaining:i,null,0,-1);return r.transform.setSelection(o).setMeta(S,{redo:t,historyState:l})}let L=!1,F=null;function E(n){let e=n.plugins;if(F!=e){L=!1,F=e;for(let t=0;t<e.length;t++)if(e[t].spec.historyPreserveItems){L=!0;break}}return L}const S=new J("history"),Pt=new J("closeHistory");function Rt(n={}){return n={depth:n.depth||100,newGroupDelay:n.newGroupDelay||500},new ht({key:S,state:{init(){return new M(v.empty,v.empty,null,0,-1)},apply(e,t,a){return It(t,a,e,n)}},config:n,props:{handleDOMEvents:{beforeinput(e,t){let a=t.inputType,s=a=="historyUndo"?Z:a=="historyRedo"?R:null;return s?(t.preventDefault(),s(e.state,e.dispatch)):!1}}}})}function Q(n,e){return(t,a)=>{let s=S.getState(t);if(!s||(n?s.undone:s.done).eventCount==0)return!1;if(a){let r=Nt(s,t,n);r&&a(e?r.scrollIntoView():r)}return!0}}const Z=Q(!1,!0),R=Q(!0,!0);function Dt(){return P({"Shift-Enter":(n,e)=>j(n,e),Enter:(n,e)=>window.innerWidth>oe[ie.Medium]||je||Ue()?!1:j(n,e)})}const Ot=["p",0],jt=["br"],Ut=new Ct({nodes:{paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p",preserveWhitespace:"full"}],toDOM(){return Ot}},text:{group:"inline"},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM(){return jt}},[lt]:it,doc:{content:"block+"}},marks:{}});function At(n=null){const e=new EventTarget,t=new wt(null,{state:kt.create({schema:Ut,plugins:[Rt(),pt(),ut(""),dt(),Dt(),P({"Mod-z":Z,"Mod-y":R,"Mod-Shift-z":R}),ft(),P(Mt),mt(e),yt()]}),dispatchTransaction(a){const s=t.state.apply(a);t.updateState(s),a.docChanged&&e.dispatchEvent(new Event(ct))},handlePaste(a,s){const r=s.clipboardData?.getData("text/plain");return r===void 0?!1:(s.defaultPrevented||_t(a,r),!0)},clipboardTextSerializer(a){return xt(a.content).content}});return n!=null&&t.state.doc.textContent.trim().length===0&&t.dispatch(t.state.tr.insertText(n)),t}const D=C.createContext(null),Ft=({children:n,clientThreadId:e,ignoreParentComposerController:t=!1})=>{const a=C.useContext(D),s=C.useMemo(()=>a&&!t?a:new gt(At(e?Fe(He(e))?.content??null:null)),[a,e]);return g.jsx(D.Provider,{value:s,children:n})},un=()=>Ae(C.useContext(D));function ee(){return{clientThreadId:"",isLoggedInUser:!1,focusedObject:null,currentModelId:"",isModelLoaded:!1,isEmbeddedInFocusedView:!1,isInstalledApp:!1,onNewThread:()=>{throw new Error("onNewThread not implemented")},onRequestCompletion:()=>{throw new Error("onRequestCompletion not implemented")},resetThread:()=>{throw new Error("resetThread not implemented")}}}const te=C.createContext(ee());function Ht(){try{return C.use(te)}catch{return ee()}}function dn({children:n,clientThreadId:e,setClientThreadId:t,routeType:a,prefetchSearchPromises:s}){const{createNewThread:r,resetThread:o}=le({clientThreadId:e,setClientThreadId:t}),{data:i}=Be(),l=ce(i),p=Ge(e,T=>T?.modelId),d=pe(),c=l.id,u=p??c,f=ue(),m=de(),{isUnauthenticated:w}=We(),h=!w,_=$(e),y=C.useMemo(()=>({clientThreadId:e,currentModelId:u,isModelLoaded:!!p,isEmbeddedInFocusedView:d,isInstalledApp:f,isLoggedInUser:h,focusedObject:m,onNewThread:r,onRequestCompletion:_,resetThread:o,prefetchSearchPromises:s,routeType:a}),[e,u,p,d,f,h,m,r,_,o,s,a]);return g.jsx(te.Provider,{value:y,children:g.jsx(Ft,{clientThreadId:e,children:n})})}function Bt({closeModal:n,url:e,onAction:t,onActionAborted:a}){const s=C.useRef(!1),r=ot(),{clientThreadId:o}=Ht(),l={...Ke({clientThreadId:o}),url:e,link_type:"text",section:"safe-link-modal"};C.useEffect(()=>{x.logEventWithStatsig("Safe Link Warning Modal Shown","chatgpt_safe_link_warning_modal_shown")},[]);const p=async()=>{s.current=!0;try{await navigator.clipboard.writeText(e),x.logEventWithStatsig("Safe Link Warning Modal Copy Clicked","chatgpt_safe_link_warning_modal_copy_clicked"),x.logEventWithStatsig("link_action","link_action",{...l,action:"copy"})}catch(w){Ye.addError(w)}t?.("copy"),n()},d=()=>{s.current=!0,x.logEventWithStatsig("Safe Link Warning Modal Open Clicked","chatgpt_safe_link_warning_modal_open_clicked"),x.logEventWithStatsig("link_action","link_action",{...l,action:"click"}),t?.("open"),n()},c=()=>{s.current||(x.logEventWithStatsig("Safe Link Warning Modal Canceled","chatgpt_safe_link_warning_modal_canceled"),a?.()),s.current=!1,n()};let u="",f=e,m="";try{f=new URL(e).hostname;const h=e.indexOf(f);h!==-1&&(u=e.substring(0,h),m=e.substring(h+f.length))}catch{}return g.jsxs(Ve,{testId:"modal-safe-link-warning",isOpen:!0,hideSeparator:!0,onClose:c,showCloseButton:!0,type:"warning",title:g.jsx("div",{className:"flex items-center gap-2",children:r.formatMessage({id:"KXMlta",defaultMessage:"This link isn't verified"})}),primaryButton:g.jsx(qe,{as:"link",openNewTab:!0,rel:"noopener noreferer",color:"primary",onClick:d,to:e,children:r.formatMessage({id:"gMzmDW",defaultMessage:"Open link"})}),secondaryButton:g.jsx(ze.Button,{title:r.formatMessage({id:"YGLt71",defaultMessage:"Copy link"}),color:"secondary",onClick:p}),children:[g.jsxs("p",{className:"text-token-text-secondary -mt-4 mb-6 text-sm text-pretty sm:-mt-7",children:[g.jsx(O,{defaultMessage:"Make sure you trust this link before proceeding. If you don't recognize the URL, don't open the link to access the site.",id:"safe-link-warning-modal-description"}),g.jsx("a",{className:"can-hover:hover:text-token-link-hover ps-1 underline underline-offset-1",href:"https://help.openai.com/en/articles/10984597-chatgpt-generated-links",target:"_blank",rel:"noopener noreferrer",children:g.jsx(O,{id:"xNvPsR",defaultMessage:"Learn more"})})]}),g.jsxs("div",{className:"mb-2 text-sm break-all",children:[g.jsx("span",{className:"text-token-text-secondary",children:u}),g.jsx("span",{className:"text-token-text-primary font-medium",children:f}),g.jsx("span",{className:"text-token-text-secondary",children:m})]})]})}const H={},B={},G={};function W(n,e){return`${n}::${e}`}function ne({node:n,onClick:e,children:t,clientThreadId:a,messageId:s,href:r,disableSafeURLs:o,...i}){let l=e;const p=n?.properties?.href,d=fe(),c=C.useContext(me),u=Xe(),f=$e(a),m=ge(f,r,c?.useSafeUrls&&!o),w=Je(u,"387775177"),h=!o&&m===void 0&&w.get("enable-copy-and-open",!1);return s!=null&&typeof p=="string"&&p.includes("/bing/redirect")&&(H[s]||(x.logEvent("Browsing Show Bing Link",{id:s,content:p}),H[s]=!0),l=_=>{B[s]||(x.logEvent("Browsing Click Bing Link",{id:s,content:p}),B[s]=!0),e?.(_)}),l=_=>{const y=""+p;if(s&&!G[W(s,y)]){const T=m||h?"URL Clicked Allowed":"URL Clicked Blocked";x.logEvent(T,{id:s,content:y}),G[W(s,y)]=!0}e?.(_),h&&r&&Ze(u,Bt,{url:r})},g.jsx(g.Fragment,{children:g.jsx("a",{onClick:l,...i,className:Qe(i.className,h&&"cursor-pointer"),href:m,rel:d?"noopener noreferrer":"noopener",children:t})})}const Gt="w";function Wt({messageId:n,clientThreadId:e,text:t,children:a,...s}){const r=$(e),o=he(),i=ve(e),p=`${window.location.origin}?q=${encodeURIComponent(t)}`,d=C.useCallback(async c=>{c.preventDefault(),et.count(tt.DEFAULT,"instant_follow_up_anchor_clicked"),x.logEventWithStatsig("Instant Follow Up Anchor Clicked","chatgpt_instant_follow_up_anchor_clicked",{clientThreadId:e,messageId:n}),r({sourceEvent:c,promptMessage:st(t),completionMetadata:{systemHints:[...o],conversationMode:i??{kind:nt.PrimaryAssistant}}})},[e,i,n,o,r,t]);return g.jsx(ne,{...s,href:p,disableSafeURLs:!0,clientThreadId:e,messageId:n,className:"cursor-pointer",onClick:d,children:a})}const Kt=X.memo(Wt);function Vt({messageId:n,clientThreadId:e,text:t,children:a,...s}){const{value:r}=rt("374768818");return r?g.jsx(Kt,{messageId:n,clientThreadId:e,text:t,children:a,...s}):g.jsx(ne,{messageId:n,clientThreadId:e,children:a,...s})}const fn=X.memo(Vt),zt={},qt=[];function se(n){const e=n||zt;return function(t,a){Ce(t,"element",function(s,r){const o=Array.isArray(s.properties.className)?s.properties.className:qt,i=o.includes("language-math"),l=o.includes("math-display"),p=o.includes("math-inline");let d=l;if(!i&&!l&&!p)return;let c=r[r.length-1],u=s;if(s.tagName==="code"&&i&&c&&c.type==="element"&&c.tagName==="pre"&&(u=c,c=r[r.length-2],d=!0),!c)return;const f=we(u,{whitespace:"pre"});let m;try{m=U.renderToString(f,{...e,displayMode:d,throwOnError:!0})}catch(h){const _=h,y=_.name.toLowerCase();a.message("Could not render math with KaTeX",{ancestors:[...r,s],cause:_,place:s.position,ruleId:y,source:"rehype-katex"}),y==="parseerror"?m=U.renderToString(f,{...e,displayMode:d,strict:"ignore",throwOnError:!1}):m=[{type:"element",tagName:"span",properties:{className:["katex-error"],style:"color:"+(e.errorColor||"#cc0000"),title:String(h)},children:[{type:"text",value:f}]}]}typeof m=="string"&&(m=ke(m).children);const w=c.children.indexOf(u);return c.children.splice(w,1,...m),V})}}const mn=n=>n.startsWith(Ie)||n===Gt?n:Le(n);function Yt(){return n=>{b(n,"list",e=>{for(const t of e.children)t.spread=!0})}}function gn(n){return e=>{b(e,t=>{Object.defineProperties(t,{markdownSource:{get(){return n.slice(this.position.start.offset,this.position.end.offset)}}})})}}const re=[ye,Me,Yt,[Se,{singleDollarTextMath:!1}],be,Ee,St,Te,Xt,Jt];function Xt(){return n=>{b(n,"textDirective",e=>{e.name!==Y&&(e.type="text",e.value=`:${e.name}`)})}}const $t=/\u200b/g;function Jt(){return n=>{b(n,"text",e=>{e.value=e.value.replace($t,"")})}}function Qt(){return n=>{const e=n.position?.end.offset;b(n,"element",(t,a)=>{const{position:s}=t;if(!s)return;const{start:r,end:o}=s,i=r.offset,l=o.offset;t.properties??={},i!=null&&(t.properties["data-start"]=i),l!=null&&(t.properties["data-end"]=l,e===l&&(t.properties["data-is-last-node"]=""),a===n.children.length-1&&(t.properties["data-is-only-node"]=""))})}}const hn=[se,Qt,xe,[_e,{target:"_new",rel:"noopener noreferrer"}],z],Zt=[[se,{output:"mathml"}],z];function en(n,e){const t=at(n,e);return ae(t,e)}function ae(n,e){const t=N().use(q).use(re).use([[sn,e??[]]]).use(Ne,{rule:"-",tightDefinitions:!0,handlers:{break:()=>`
`,link:tn}}),a=N().use(Pe).use(Zt).use(Re),s=t.runSync(t.parse(n)),r=t.stringify(s),o=a.stringify(a.runSync(s));return{"text/plain":r,"text/html":o}}const tn=(n,e,t,a)=>{const s=t.createTracker(a),r=t.enter("link"),o=t.enter("label");let i=s.move("[");return i+=s.move(t.containerPhrasing(n,{before:i,after:"](",...s.current()})),i+=s.move("]("),o(),i+=s.move(n.url.replace(/[\x00-\x1F\x7F-\x9F()"]/g,nn)),n.title&&(i+=s.move(" "+JSON.stringify(n.title))),i+=s.move(")"),r(),i};function nn(n){return"%"+n.charCodeAt(0).toString(16).toUpperCase().padStart(2,"0")}function sn(n){return e=>{const t={},a=(s,r)=>{switch(r.type){case"grouped_webpages":{const o=[];for(const i of r.items)if(i.url&&i.title){let l=t[i.url];l||(l=t[i.url]={type:"definition",identifier:String(Object.keys(t).length+1),url:i.url,title:i.title}),o.push({type:"linkReference",referenceType:"shortcut",identifier:l.identifier,children:[{type:"text",value:i.attribution??Oe(i.url)}]})}return o.length===0?[]:[{type:"text",value:"("},...o.flatMap((i,l,p)=>l<p.length-1?[i,{type:"text",value:", "}]:[i]),{type:"text",value:")"}]}case"title_citation":case"location_search":case"time":case"image_v2":case"nav_list":case"file_navlist":case"file":case"grouped_webpages_model_predicted_fallback":case"tldr":case"navigation":case"stock":case"calculator":case"code_execution":case"forecast":case"businesses_map":case"video":case"sources_footnote":case"sports_standings":case"sports_schedule":case"attribution":case"webpage_extended":case"image_inline":case"product_entity":case"products":case"alt_text":case"product_reviews":case"product_rationale":if(r.alt){const o=N().use(q).use(re).parse(r.alt);if(s.type!=="textDirective")return o.children;const i=o.children[0];if(i.type==="paragraph")return i.children}return[];case"hidden":case"status":case"optimistic_image_citation":case"webpage":case"optimistic_image_inline":case"invalid":case"attribution_footer":case"sports":case"grouped_webpages_v2":return[]}};b(e,De,(s,r,o)=>{if(o==null||r==null)return;const i=rn(s,n),l=i?a(s,i)??[s]:[];return o.children.splice(r,1,...l),[V,r+l.length]}),e.children.push(...Object.values(t))}}function rn(n,e){if(n.name===Y){const t=n.attributes?.index;if(t)return e[parseInt(t,10)]}}const vn=Object.freeze(Object.defineProperty({__proto__:null,markdownToClipboardContent:ae,messageTextToClipboardContent:en},Symbol.toStringTag,{value:"Module"}));export{Ft as C,Gt as I,ne as M,re as R,fn as S,dn as a,At as b,D as c,un as d,mn as e,hn as f,ae as g,vn as h,en as m,gn as r,Ht as u};
//# sourceMappingURL=gc51ish3otzvnj1w.js.map
