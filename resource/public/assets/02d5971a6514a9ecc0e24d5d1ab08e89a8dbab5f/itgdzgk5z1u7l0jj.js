import{j as a,f as R,aj as Ce,u as ye,r as i,a8 as v,M as _,c as ve,a9 as Q}from"./msupklk377u8vx8o.js";import{c as b,ar as we,cN as Me,g as ne,r as oe,an as I,bG as D,bH as H,u as Te,e1 as j,bW as V,aw as je,be as q,du as be}from"./i3bl95k8z8nuf4dv.js";import{u as ke}from"./onklb7txlsriyspd.js";import{e9 as Se,dO as _e,oc as re,f as Ne,an as Re,am as Ie,od as Ae,ar as Ee,id as Oe,at as Fe,mV as Be,oe as qe}from"./idf4u2jy0wx0pvap.js";import{C as l,a as ze,b as De}from"./ohwrmnkvkdb4hdjp.js";import{CA_SOURCE_TO_TEXT_MAP as He,getCASources as Ue}from"./exki82npk7hw7g59.js";import{F as ie,l as Pe}from"./b2dyy1jg95n5gtr8.js";import{g as Ge,a as Le,b as Xe,i as We,c as Ye,C as Qe,h as Ve}from"./nr2o0yx4ps6bt6je.js";import"./hgzals0lml4o26vg.js";import"./hwl3hzno2kq7obfl.js";import"./hmii3551qscelikg.js";import"./i3xeaua08fnq6vw7.js";import"./gc51ish3otzvnj1w.js";import"./ojiial81qrlp15mq.js";import"./ojrw0o0rizu55rz7.js";import"./ev39bkx1q3tpviat.js";import"./mxye9dnv7ug9w78j.js";import"./mmjudc45gj99bpja.js";import"./hykg4shppjdez6do.js";import"./bl75917ayi16sr8y.js";import"./gvsp7fy7hloerc2p.js";import"./b8sq4gagi5vun041.js";import"./k0gfwt82z96kzlbw.js";import"./etqfvs5ggajp1a11.js";import"./iot0cxie20e0du89.js";import"./nxqfgrk9atl9s5yp.js";const Je=24,J=12,z=4,Ke=5e3;function A(t,e,s){switch(e.type){case l.Thought:return e.thought.summary;case l.Recap:return e.content;case l.Browsing:return ce({contextualAnswerSources:e.sources,intl:t});case l.Search:return s?t.formatMessage({id:"+a5J9x",defaultMessage:"Searched the web"}):t.formatMessage({id:"GamH3R",defaultMessage:"Searching the web"});case l.CodeAnalysis:return s?t.formatMessage({id:"SGdXPO",defaultMessage:"Analyzed"}):t.formatMessage({id:"rEhiFx",defaultMessage:"Analyzing"});case l.ImageAnalysis:return s?t.formatMessage({id:"fjqIXj",defaultMessage:"Analyzed image"}):t.formatMessage({id:"D//PTx",defaultMessage:"Analyzing image"});case l.ComputerOutput:return}}const ce=({contextualAnswerSources:t,intl:e})=>{if(t.length===0)return e.formatMessage({id:"browsingMessage.startingRetrieval",defaultMessage:"Reading documents"});const s=t.map(o=>He[o]).filter(Boolean);return t.length===1?e.formatMessage({id:"Jzt2om",defaultMessage:"Reading {source}"},{source:s[0]}):t.length===2?e.formatMessage({id:"wTM7gR",defaultMessage:"Reading {source1} and {source2}"},{source1:s[0],source2:s[1]}):e.formatMessage({id:"xnwjH1",defaultMessage:"Reading {source1}, {source2} and more"},{source1:s[0],source2:s[1]})};function Ze(t){const e=new Set,s=new Set;for(const o of t)if(o.type===l.Search){for(const n of o.queries)e.add(n.q);for(const n of o.sources)s.add(n.domain)}return{queries:e.size,sources:s.size}}const $e="_markdown_1frq2_10",et={markdown:$e},K=({content:t})=>a.jsx(ie,{className:b(et.markdown,"text-token-text-secondary text-sm"),componentOverrides:{code:e=>a.jsx(Se,{...e,wrapperClassName:"",showActionBar:!1})},children:t}),tt=({chunk:t,isExpanded:e,isComplete:s})=>{const o=R(),[n,c]=t.messages,m=Ge(n)!=null;return a.jsxs("div",{className:"flex w-full flex-col gap-2 text-sm",children:[e&&A(o,t,s),m&&a.jsxs("div",{children:[a.jsx(Le,{message:n,forceDarkMode:!0,FormattedText:ie,showActionBar:!1,codeRendererClassName:b("rounded-md max-h-[calc(clamp(20px,1/4*var(--thread-safe-area-height,100lvh),400px))] overflow-auto",c&&"rounded-b-none"),codeContainerClassName:"overflow-visible!"}),c&&a.jsx(Xe,{forceDarkMode:!0,wrapperClassName:"max-h-[calc(clamp(20px,1/8*var(--thread-safe-area-height,100lvh),200px))] w-full overflow-auto dark rounded-b-md",codeContainerClassName:"whitespace-pre-wrap",message:c,showLabel:!1})]})]})},st=({chunk:t,isExpanded:e,isComplete:s})=>{const o=R(),n=t.messages[1],c=Ce(),{isUnauthenticated:m}=we(),h=n.metadata?.aggregate_result?.messages.find(We),f=h?.image_url&&_e(h.image_url),{data:u}=ye(f?Ye(f,m):{enabled:!1,queryKey:[]}),g=u?.status===Me.Success?u.download_url:void 0,{isSuccess:r}=re(g),[w]=i.useState(r);return a.jsxs("div",{className:"flex w-full flex-col gap-2 text-sm",children:[e&&A(o,t,s),a.jsxs("div",{className:"bg-token-bg-secondary relative flex h-[calc(clamp(150px,1/4*var(--thread-safe-area-height,100lvh),400px))] justify-center overflow-hidden rounded-md p-2",children:[g&&a.jsx(v.div,{initial:{opacity:w?.5:0,scale:1.1},animate:{opacity:r?.5:0,scale:s||c?1.1:[1.1,1.25,1.1]},transition:{opacity:{ease:"easeInOut"},scale:s?{type:"spring",stiffness:300,damping:20}:{duration:2.5,repeat:1/0,ease:"easeInOut"}},className:"absolute inset-0 bg-cover bg-center bg-no-repeat opacity-40 blur-lg filter",style:{backgroundImage:`url(${JSON.stringify(g)})`}}),a.jsx(v.div,{initial:{opacity:w?1:0},animate:{opacity:r?1:0},className:"relative *:m-0 *:h-full *:w-full *:rounded-md *:object-center *:shadow-lg",children:a.jsx(Qe,{isCoT:!0,message:n})})]})]})},at=4,nt=3,ot=3,rt={hidden:{opacity:0},visible:{opacity:1}},Z={hidden:{opacity:0,x:-5},visible:{opacity:1,x:0}},it=({chunk:t,isExpanded:e,isComplete:s})=>{const{queries:o,sources:n}=t,c=R(),[m,h]=i.useState(s);return a.jsxs("div",{className:"flex min-w-0 flex-col gap-2 text-sm",children:[e&&A(c,t,s),a.jsxs("div",{className:"flex min-w-0 flex-col gap-1",children:[a.jsx($,{isComplete:s,items:o,max:ot,getKey:f=>f.q,Item:ct,ShowMoreButton:dt,onAnimationComplete:()=>h(!0)}),a.jsx($,{isComplete:s,items:m?n:[],max:at,getKey:f=>f.entries[0].url,Item:lt,ShowMoreButton:ut})]})]})},$=({isComplete:t,items:e,max:s,getKey:o,Item:n,ShowMoreButton:c,onAnimationComplete:m})=>{const[h,f]=i.useState(!1),[u,g]=e.length>s?[e.slice(0,s-1),e.slice(s-1)]:[e];return a.jsxs(v.div,{className:"flex flex-wrap items-center gap-1",initial:t?"visible":"hidden",animate:"visible",transition:{duration:.25,staggerChildren:.1,delayChildren:.3},onAnimationComplete:m,children:[u.map(r=>a.jsx(v.div,{variants:rt,className:"flex max-w-full items-center",children:a.jsx(n,{item:r,isComplete:t})},o(r))),h&&a.jsx(v.div,{className:"contents",initial:"hidden",animate:"visible",transition:{duration:.2,staggerChildren:.02},children:g?.map(r=>a.jsx(v.div,{variants:Z,className:"flex max-w-full items-center",children:a.jsx(n,{item:r,isComplete:t})},o(r)))}),g&&a.jsx(v.div,{variants:Z,className:"flex items-center",children:a.jsx(c,{moreItems:g,isShowingMore:h,onClick:()=>f(r=>!r)})},"more")]})},ct=({item:t})=>a.jsxs(E,{componentType:"span",children:[a.jsx(Ne,{className:"-ms-1 h-3 w-3 shrink-0"}),a.jsx("span",{className:"overflow-hidden text-ellipsis whitespace-nowrap",children:t.q})]}),lt=({item:t,isComplete:e})=>{const s=ne(),o=oe(s,"3507026387"),n=t.entries[0],c=i.useMemo(()=>({url:n.url,title:n.title}),[n.url,n.title]);i.useEffect(()=>{I.logEventWithStatsig("link_action","link_action",{...c,action:"show"})},[c]);const m=()=>{I.logEventWithStatsig("link_action","link_action",{...c,action:"click"})};return a.jsxs(E,{componentType:Ie,href:n.url,onClick:m,animateScan:o&&!e,children:[a.jsx(le,{url:n.url}),n.attribution??Re(n.url)]})},le=({url:t,withBorder:e=!1})=>{const{isSuccess:s,isError:o}=re(Ae(t,32)),[n]=i.useState(s);return o?null:a.jsx(v.div,{initial:{opacity:n?1:0},animate:{opacity:s?1:0},className:b("bg-token-main-surface-primary -ms-3 box-content h-3 w-3 shrink-0 overflow-hidden rounded-full first:-ms-1",e&&"border-token-main-surface-secondary group-hover:border-token-text-primary dark:group-hover:border-token-text-primary border"),children:a.jsx(Ee,{url:t,size:32,minSize:16,className:"m-0"})})},ut=({moreItems:t,isShowingMore:e,onClick:s})=>a.jsx(E,{onClick:s,children:e?a.jsx(_,{id:"19fGXl",defaultMessage:"Show less"}):a.jsxs(a.Fragment,{children:[t.slice(0,nt).map((o,n)=>a.jsx(le,{url:o.entries[0].url,withBorder:!0},n)),a.jsx(_,{id:"5ob5C8",defaultMessage:"{count} more",values:{count:t.length}})]})}),dt=({moreItems:t,isShowingMore:e,onClick:s})=>a.jsx(E,{onClick:s,children:e?a.jsx(_,{id:"0SWns2",defaultMessage:"Show less"}):a.jsx(_,{id:"PpZw7t",defaultMessage:"{count} more",values:{count:t.length}})}),mt=1500,E=t=>{"use forget";const e=ve.c(24);let s,o,n,c,m;e[0]!==t?({className:n,componentType:m,children:o,animateScan:s,...c}=t,e[0]=t,e[1]=s,e[2]=o,e[3]=n,e[4]=c,e[5]=m):(s=e[1],o=e[2],n=e[3],c=e[4],m=e[5]);const h=m===void 0?"button":m,[f,u]=i.useState(!1),g=Math.random()*mt;let r,w;e[6]!==s?(r=()=>{s&&(u(!1),requestAnimationFrame(()=>u(!0)))},w=[s,g],e[6]=s,e[7]=r,e[8]=w):(r=e[7],w=e[8]),i.useEffect(r,w);const x=s&&"dark:border-token-main-surface-secondary border border-[#f4f4f4] bg-transparent dark:bg-transparent",T=(c.href!=null||c.onClick!=null)&&"hover:bg-token-main-surface-primary-inverse hover:text-token-text-inverted dark:hover:bg-token-text-primary";let M;e[9]!==n||e[10]!==x||e[11]!==T?(M=b(Pe,"group relative max-w-full overflow-hidden",x,T,n),e[9]=n,e[10]=x,e[11]=T,e[12]=M):M=e[12];let C;e[13]!==s||e[14]!==f?(C=s&&a.jsx("span",{className:b("dark:bg-token-main-surface-secondary absolute start-0 top-0 z-[-1] h-full rounded-se-full rounded-ee-full bg-[#f4f4f4] transition-[width] ease-in-out",f?"w-full":"w-0"),style:{transitionDuration:`${g}ms`}}),e[13]=s,e[14]=f,e[15]=C):C=e[15];let p;e[16]!==o?(p=a.jsx("div",{className:"z-1 inline-flex items-center gap-1",children:o}),e[16]=o,e[17]=p):p=e[17];let k;return e[18]!==h||e[19]!==c||e[20]!==M||e[21]!==C||e[22]!==p?(k=a.jsxs(h,{className:M,...c,children:[C,p]}),e[18]=h,e[19]=c,e[20]=M,e[21]=C,e[22]=p,e[23]=k):k=e[23],k},ee=null;var ue=(t=>(t.STATIC="static",t.ENTER="enter",t.STAGE="stage",t))(ue||{});const ht=({isAnimationComplete:t=!1,isExpanded:e=!1,isLast:s=!1,index:o,chunk:n,onClick:c,onMeasure:m,onAnimationComplete:h,showBullet:f=!1,isStreaming:u=!1})=>{const g=s||e,r=!s||t,w=r?"static":"stage",x=r?"static":"enter",T=i.useRef(null);T.current=()=>{h?.(o,"enter")},i.useEffect(()=>{if(x!=="enter")return;const p=setTimeout(()=>{D.count(H.COT_SUMMARIZER,"cot_chunk_timeout"),T.current?.()},Ke);return()=>clearTimeout(p)},[x]);const M=x==="static",C=i.useRef(null);return Te(()=>Oe({axis:"height",target:C.current,onChange:({height:p})=>m(o,p)}),[]),a.jsx(v.div,{role:e?void 0:"button",variants:{static:{opacity:1,scale:1,position:"static",translateY:0},enter:{position:"static",translateY:0,scale:1,opacity:1},stage:{position:"absolute",translateY:-24,scale:.95,opacity:0}},initial:w,animate:x,exit:e?void 0:{opacity:0,pointerEvents:"none",position:"absolute",translateY:Je,filter:"blur(8px)"},style:{zIndex:o},transition:t||x==="static"?{duration:0}:{type:"spring",bounce:.05},className:b("text-token-text-secondary start-0 end-0 top-0 flex origin-left",!g&&"pointer-events-none"),onAnimationComplete:p=>p!=="enter"&&h(o,p),onClick:c,ref:C,children:a.jsx(Fe,{onComplete:T.current,isDisabled:M,defaultDelayPerSegmentMs:20,children:f?a.jsxs("div",{className:b("relative flex w-full items-start gap-2 overflow-clip",ee),children:[ee,a.jsxs("div",{className:"flex h-full w-4 shrink-0 flex-col items-center gap-2",children:[a.jsx("div",{className:"flex h-5 shrink-0 items-center justify-center",children:a.jsx(ze,{chunk:n,size:"small"})}),!s&&a.jsx(v.div,{initial:{translateY:-24,opacity:0},animate:{translateY:0,opacity:1},className:"bg-token-border-medium h-full w-[1px] rounded-full"})]}),a.jsx(te,{chunk:n,isExpanded:e,isComplete:r,isStreaming:u,isLast:s})]}):a.jsx(te,{chunk:n,isExpanded:e,isComplete:r,isStreaming:u,isLast:s})})})},ft=i.memo(ht),te=({chunk:t,isExpanded:e,isComplete:s,isStreaming:o,isLast:n})=>{const c=R();switch(t.type){case l.Thought:return a.jsx(K,{content:t.thought.content});case l.Recap:return a.jsx("div",{className:"text-token-text-secondary text-sm",children:a.jsx(_,{id:"Eo2n2s",defaultMessage:"Done"})});case l.Search:return a.jsx(it,{chunk:t,isExpanded:e,isComplete:s});case l.CodeAnalysis:return a.jsx(tt,{chunk:t,isExpanded:e,isComplete:s});case l.Browsing:return e&&a.jsx(K,{content:ce({contextualAnswerSources:t.sources,intl:c})});case l.ImageAnalysis:return a.jsx(st,{chunk:t,isExpanded:e,isComplete:s});case l.ComputerOutput:return null}},se=new WeakMap;function gt(t){const e=[];for(const s of t){let o=se.get(s);o||(o=pt(s),o&&se.set(s,o)),o&&e.push(...o)}return e}function pt(t){switch(t.type){case j.ReasoningRecap:{const e=t.messages[t.messages.length-1].content.content;return[{type:l.Recap,content:e}]}case j.Browsing:case j.RetrievalBrowsing:{const e=Ue({messages:t.messages});return[{type:l.Browsing,sources:e,isRetrieval:t.type===j.RetrievalBrowsing}]}case j.StructuredThoughts:{const e=[];for(const s of t.messages){const{thoughts:o}=s.content;for(const n of o)!n.content&&!n.summary||e.push({type:l.Thought,thought:n})}return e}case j.CodeInterpreter:{const[e,s]=t.messages;if(e.author.role!==V.Assistant||s&&s.author.role!==V.Tool){je.addError(new Error("[cot] out of order code tool messages"));break}return[{type:s!=null&&Ve(s)?l.ImageAnalysis:l.CodeAnalysis,messages:t.messages}]}case j.CoTSearchTool:{const e={type:l.Search,queries:[],sources:[]};for(const s of t.messages)if(s.metadata?.search_queries?.length&&(e.queries=s.metadata.search_queries),s.metadata?.search_result_groups?.length)for(const o of s.metadata.search_result_groups)e?.sources?.some(n=>n.domain===o.domain)||e.sources?.push(o);return[e]}case j.n7jupd:return;case j.n7jupd_x:return}}const xt={duration:.3,ease:"easeInOut"},ae=.2,Vt=({isStreaming:t,messageGroups:e})=>{const s=i.useMemo(()=>gt(e),[e]);return a.jsx(Ct,{isStreaming:t,chunks:s})},Ct=({isStreaming:t,chunks:e})=>{const s=R(),o=oe(ne(),"3133027893"),[n,c]=i.useState(!1),[m,h]=i.useState([]),f=i.useMemo(()=>Ze(e),[e]),u=!t,g=Be(e,d=>d.type!==l.Recap&&(o||!(t&&d===q(e)))),[r,w]=i.useState(t?-1:e.length),x=r===-1?void 0:e[r],T=r<g||r===g&&!t,M=t?g:e.length,C=vt(x),[p,k]=i.useState(!t||r<0),U=i.useRef(performance.now()),P=i.useRef(performance.now());i.useEffect(()=>{U.current=performance.now()},[r]),i.useEffect(()=>{P.current=performance.now()},[x]);const[G]=i.useState(t);i.useEffect(()=>{if(G&&T&&p){const d=performance.now(),y=Math.max(0,yt(x)-(d-U.current),C-(d-P.current));setTimeout(()=>{w(M),k(!1)},y)}},[G,T,p,C,x,M]);const S=u?e:e.slice(0,r+1),O=i.useMemo(()=>{const d=q(S);return u?d?.type===l.Recap?d:void 0:d?.type===l.Thought?be(S,y=>y.type===l.Thought&&y.thought.summary!=null&&y.thought.summary.length>0):d},[u,S]),L=[...S.entries()],X=n?L:L.slice(-1);wt(r,u);const N=S.length>0&&e[0].type!==l.Recap,de=q(S)?.type===l.Browsing&&!n,me=N&&(!u||n)&&!de,W=N&&!u&&!n,he=qe(m)+(m.length-1)*J+2*z,fe=u?"auto":n?he:(m[r]??0)+2*z,ge=i.useCallback((d,y)=>{d===r&&y===ue.ENTER&&setTimeout(()=>{k(!0)},C)},[r,C]),F=i.useCallback((d,y)=>{c(d),D.count(H.COT_SUMMARIZER,d?"expand":"collapse",[{key:"is_streaming",value:String(t)},{key:"source",value:y}]),I.logEventWithStatsig(d?"CoT Expanded":"CoT Collapsed",d?"chatgpt_cot_expanded":"chatgpt_cot_collapsed",{is_streaming:String(t),source:y})},[t]),pe=i.useCallback(()=>{F(!0,"chunk")},[F]),xe=i.useCallback((d,y)=>{h(B=>{const Y=[...B];return Y[d]=y,Y})},[]);return i.useEffect(()=>{u||r<0||I.logEventWithStatsig(n?"Streamed CoT Chunk Viewed":"Streamed CoT Chunk Ignored",n?"chatgpt_streamed_cot_chunk_viewed":"chatgpt_streamed_cot_chunk_ignored")},[r,u,n,t]),u&&!N?null:a.jsxs(a.Fragment,{children:[a.jsx(Mt,{}),a.jsxs("div",{className:"relative my-1 min-h-6",children:[t&&(!N||W)&&a.jsx(v.div,{className:"loading-shimmer text-token-text-secondary absolute top-0 select-none",initial:t&&{translateX:-8,opacity:0},animate:{translateX:0,opacity:1},transition:{ease:"easeInOut",duration:ae},children:a.jsx(_,{id:"hgnsat",defaultMessage:"Thinking"})}),N&&a.jsxs(v.div,{className:b("relative flex max-w-[calc(0.8*var(--thread-content-max-width,40rem))] origin-top-left flex-col gap-2 overflow-x-clip",W&&"bg-token-main-surface-primary border-token-border-default mx-[calc(--spacing(-2)-1px)] -my-[1px] box-content rounded-2xl border bg-clip-padding px-5 py-4 @max-3xl:-top-2 @3xl:-start-3 @3xl:-top-4"),initial:t&&{opacity:0,scale:.85},animate:{opacity:1,scale:1},transition:{ease:"easeOut",duration:ae},children:[a.jsx(De,{latestHeadline:O&&A(s,O,u),latestChunk:O,counters:f,onToggleExpanded:()=>F(!n,"header"),isExpanded:n,isExpandDisabled:S.length<2,isComplete:u}),a.jsx(Q,{children:me&&a.jsx(v.div,{className:"relative z-0",initial:u?{opacity:0,height:0,overflowY:"hidden"}:!1,animate:{opacity:1,height:fe},exit:{height:0,opacity:0,pointerEvents:"none",overflowY:"hidden",filter:u?"blur(8px)":void 0,translateY:-24},transition:xt,children:a.jsx("div",{className:"relative flex h-full flex-col",style:{gap:J,margin:`${z}px 0`},children:a.jsx(Q,{children:X.map(([d,y],B)=>a.jsx(ft,{index:d,chunk:y,isLast:X.length-1===B,onClick:pe,onAnimationComplete:ge,onMeasure:xe,isAnimationComplete:u,isExpanded:n,showBullet:n,isStreaming:t},d))})})})})]})]})]})};function yt(t){return t?.type===l.Thought?Math.min(3e3,1e3+t.thought.content.length*3.5):1200}function vt(t){return t?.type===l.Thought?500:0}function wt(t,e){const s=i.useRef(null),o=ke(t),n=i.useCallback(()=>{if(s.current!=null){const c=performance.now()-s.current;D.hist(H.COT_SUMMARIZER,"cot_chunk_display_time",void 0,c)}},[o]);i.useEffect(()=>{if(e){n();return}t!==-1&&(n(),s.current=performance.now())},[t,e,n])}function Mt(){return a.jsx(v.div,{className:"absolute flex h-8 w-3 origin-center items-center justify-center",initial:{scale:1,opacity:1},animate:{scale:0,opacity:0},transition:{ease:"easeInOut",duration:.2},children:a.jsx("div",{className:"bg-token-text-primary h-3 w-3 rounded-full"})})}export{Vt as CoT,Ct as CoTChunks};
//# sourceMappingURL=itgdzgk5z1u7l0jj.js.map
