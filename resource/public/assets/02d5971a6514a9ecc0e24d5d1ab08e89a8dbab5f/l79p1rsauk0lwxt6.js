const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/gm5y1gu44e9b1hhu.js","assets/i3bl95k8z8nuf4dv.js","assets/msupklk377u8vx8o.js","assets/root-en2soewk.css","assets/idf4u2jy0wx0pvap.js","assets/conversation-small-irmw3ffz.css","assets/gofv20xlqc2wkx0o.js","assets/lmxu6hvxz5hh85wp.js","assets/l4zbgkg566u66cq3.js","assets/nqftup7r2bl1ts0s.js","assets/galv4529ourghuwf.js","assets/gy64pge8qevmvg7e.js","assets/m79xqmw9o9st6d11.js","assets/lm1rmwueprcm5uwi.js","assets/e6baz4ypgq05475b.js","assets/iyjmmo9kb0jopwec.js","assets/fznat16kjgzb6hqv.js","assets/dpdfmvit4u353o4u.js"])))=>i.map(i=>d[i]);
import{j as e,r as l,M as D,g as st,as as On,aq as Gn,an as As,a8 as O,d as Vn,a9 as ve,f as Ae,R as zn,o as Wn}from"./msupklk377u8vx8o.js";import{e as tt,fq as $n,kO as We,es as Yn,o7 as Kn,oa as Qn,q8 as Xn,af as nt,q9 as Fs,qa as Jn,qb as Zn,qc as ke,qd as ea,aA as at,qe as sa,hH as ta,hI as na,a0 as fe,fB as ot,W as aa,b$ as oa,kB as rt,qf as ra,qg as ia,S as la,qh as it,fU as ca,fV as da,fY as ua,fW as ma,qi as ga,b0 as lt,X as ct,qj as dt,eI as ha,ev as Q,aG as pa,qk as fa,ao as xa,ql as va,qm as ba,nZ as ts,bH as ut,qn as ya,qo as _a,n1 as Sa,qp as Ta,qq as ja,qr as Ca,qs as we,ku as Ma,qt as ka,qu as mt,bn as wa,d8 as Ia,qv as Ea,hO as xe,bx as gt,U as ht,bs as Na,ay as pt,bt as Ra,ax as ft,qw as Aa,qx as Fa,dK as Pa,hx as La,qy as qa,qz as Da,be as xt,bf as vt,cS as bt,d as Ua,qA as Ba,mf as Ha,cX as Oa,y as yt,d_ as Ga,qB as Va,p3 as _t,e5 as za,hr as Wa,mF as $a,O as Ya,da as St,qC as Ka,hG as Qa,qD as Xa,cU as Ja,qE as Za,iC as eo,aH as so,qF as to,qG as no,qH as ao,mR as oo,jj as ro,cW as io,qI as lo,qJ as co,qK as uo,mG as mo,qL as go,qM as ho,nr as $e,qN as po,ns as Ne,qO as Ye,qP as fo,ai as xo,qQ as vo,cx as bo,jl as yo,mV as _o,mO as So,qR as To,qS as jo,qT as Co,i7 as Mo,R as ko,p9 as wo,qU as Io,qV as Eo,qW as No,qX as Ro,qY as Ao,qZ as Fo,q_ as Po,q$ as Lo,c0 as qo,H as Do,pq as Uo,mj as Bo,mk as Ho}from"./idf4u2jy0wx0pvap.js";import{c as L,v as me,_ as he,F as re,bQ as Re,be as R,dE as ns,ax as P,bW as z,gH as Tt,e8 as Oo,bo as te,bJ as ue,cj as as,am as ge,fP as Go,bS as jt,H as Ke,b as Ct,B as Mt,af as Ps,aw as Qe,an as U,bC as J,s as os,bg as ae,fk as kt,bj as oe,g2 as Vo,bn as zo,d3 as Wo,d4 as $o,bR as X,bx as Yo,h8 as Ko,g as wt,m as It,du as Qo,dC as Xo,dP as Et,cx as Jo,b2 as Nt,h9 as Zo,bq as er,bI as sr,d5 as rs,ar as Rt,bs as Xe,cX as tr,eu as nr,fc as ar,g1 as He,bX as or,d2 as rr,ce as ir,aB as Oe,gN as lr,gO as cr,dL as dr,e1 as Ls,dM as ur,gB as mr,dF as gr}from"./i3bl95k8z8nuf4dv.js";import"./eyf2nwgexpz6pjnh.js";import{M as hr,O as pr}from"./n5fowtub43nwjawh.js";import{d as fr,b as xr}from"./lvc34l5biwha9w7t.js";import{a as vr,G as br}from"./gd7xfxa2yqt151v4.js";import{C as Je,F as yr}from"./hgzals0lml4o26vg.js";import{b as At}from"./etqfvs5ggajp1a11.js";import{u as Ft}from"./igftvtdft8b4phs3.js";import{u as _r}from"./gwmfzjrffpu4d2tx.js";import{a as Pt}from"./np9w83f07wa6edf5.js";const Sr="bg-token-main-surface-primary text-token-text-primary",Tr="openai",qs=["bg-blue-300 text-white"];function jr(t){return qs[(t?.charCodeAt(0)??0)%qs.length]}const Ie=({children:t})=>e.jsx("div",{className:"pt-0",children:e.jsx("div",{className:L(l.isValidElement(t)&&t.type===We?"gizmo-bot-avatar":"gizmo-shadow-stroke","flex h-8 w-8 items-center justify-center overflow-hidden rounded-full"),children:t})});function Ze(t){const{messages:n,isUserTurn:a,avatarClassName:s,gizmo:o}=t,r="medium",u=n[0]?.metadata?.shared_conversation_id,i=u!=null,g=tt(),{gizmoEditorData:m,mode:f}=$n();let x=e.jsx(Ie,{children:e.jsx(We,{className:s??Sr,iconName:Tr,size:r})});return o?x=e.jsx(Ie,{children:e.jsx(vr,{gizmoId:o.gizmo.id,className:"h-full w-full"})}):m!=null&&f==="test"&&(x=e.jsx(br,{isFirstParty:!1,src:m.profilePictureUrl,className:"h-8 w-8 first:pt-[3px]"})),e.jsx("div",{className:void 0,children:a?i?e.jsx(Ie,{children:e.jsx(We,{className:jr(u),iconName:"user",size:r})}):e.jsx(Ie,{children:e.jsx(Yn,{user:g,size:r})}):x})}const Ds=me(()=>he(()=>import("./gm5y1gu44e9b1hhu.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(t=>t.MemoryActionResult));function Us(t,n,a){ue(t,s=>{as.updateTree(s,o=>{o.updateNodeMetadata(n,{inlineComparisonRating:a})})})}const Bs=({messages:t})=>{for(const{metadata:n}of t){const{paragen_display_label:a}=n??{};if(a)return a;const{augmented_paragen_prompt_label:s}=n??{};if(s)return s}};function Cr(t){const n=l.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),a=l.useRef({left:null,right:null});return t.variantIds.length<2?e.jsx(Lt,{setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:n,firstVisibleTokenTimestampsRef:a,...t}):e.jsx(Mr,{...t,visibilityStateRef:n,firstVisibleTokenTimestampsRef:a})}function Mr(t){const{clientThreadId:n,variantIds:a,turnIndex:s,firstVisibleTokenTimestampsRef:o}=t;if(a.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const r=is(),c=Tt(),u=Oo(),[i,g]=a,m=l.useMemo(()=>nt(i+g)()>=.5,[i,g]),[f,x]=m?[g,i]:[i,g],[b,h,T]=te(n,p=>{const E=Ps(p).tree.getLeafFromNode(f).id,C=Ps(p).tree.getLeafFromNode(x).id,S=P.getConversationTurns(p,E),_=P.getConversationTurns(p,C),A=s<S.length?S[s]:null,w=s<_.length?_[s]:null;return A||Qe.addError(`Paragen Left turn index ${s} out of bounds`,{turnIndex:s,turnCount:S.length,lastTurnRole:R(S)?.role,lastMessageAuthor:R(R(S)?.messages)?.author,lastMessageContentType:R(R(S)?.messages)?.content.content_type,lastMessageMetadata:R(R(S)?.messages)?.metadata,altTurnCount:_.length,altLastTurnRole:R(_)?.role,altLastMessageRole:R(R(_)?.messages)?.author.role}),w||Qe.addError(`Paragen Right turn index ${s} out of bounds`,{turnIndex:s,turnCount:_.length,lastTurnRole:R(_)?.role,lastMessageAuthor:R(R(_)?.messages)?.author,lastMessageContentType:R(R(_)?.messages)?.content.content_type,lastMessageMetadata:R(R(_)?.messages)?.metadata,altTurnCount:S.length,altLastTurnRole:R(S)?.role,altLastMessageRole:R(R(S)?.messages)?.author.role}),[E,A,w]}),[k,M]=m?[T,h]:[h,T],N=r?"skippable_parallel_2_in_stream:a:2.0":"skippable_parallel_2_in_stream:a:1.5";l.useEffect(()=>(Fs.setState({displayingSideBySideFeedback:!0}),()=>{Fs.setState({displayingSideBySideFeedback:!1})}),[]);const F=l.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),y=l.useCallback((p,{shouldSubmitParagenFeedback:E=!0}={})=>{if(!h||!T||!k||!M)throw new Error("Expected both turns to exist");ue(n,I=>{as.setCurrentBranch(I,p)});const C=p===f,S=p===i;k.messages.length>0&&Us(n,k.messages[k.messages.length-1].id,S?"original":"new"),M.messages.length>0&&Us(n,M.messages[M.messages.length-1].id,S?"original":"new");const _=ge(n),A=[h,T].map((I,q)=>({messageId:I.messages[I.messages.length-1].id,loadFirstTokenTime:q===0?o.current.left:o.current.right,loadEndTime:R(I.messages)?.clientMetadata?.completionSampleFinishTime})),w=C?A[0].messageId:A[1].messageId,d=P.getParentPromptNode(Re(n),b);if(!d)throw new Error("Expected prompt for side by side feedback");const j={},G=d.message.clientMetadata?.variantsInStreamInfo==null&&d.message.metadata?.paragen_variants_info!=null;for(const I of A)j[I.messageId]=G?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:I.loadFirstTokenTime,load_end_time:I.loadEndTime};E&&Ws({params:{conversation_id:_,displayed_message_ids:A.map(I=>I.messageId),message_metadatas:j,rating:"selected",selected_message_id:w,source_timestamp:Date.now(),ui_variant:r?2:1,user_prompt_message_id:d.message.id}})},[n,f,i,k,M,h,T,b,o,t.conversationTurnMountTime,r]);return l.useEffect(()=>Go(jt,{requestCompletion:p=>{const E=ge(n),C=P.getParentPromptNode(Re(n),b);if(!C)throw new Error("Expected prompt for side by side feedback");if(!h||!T)throw new Error("Expected both turns to exist");const S=[h,T].map((d,j)=>({messageId:d.messages[d.messages.length-1].id,loadFirstTokenTime:j===0?o.current.left:o.current.right,loadEndTime:R(d.messages)?.clientMetadata?.completionSampleFinishTime})),_={},A=C.message.clientMetadata?.variantsInStreamInfo==null&&C.message.metadata?.paragen_variants_info!=null;for(const d of S)_[d.messageId]=A?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:d.loadFirstTokenTime,load_end_time:d.loadEndTime};const w=p.isForSkippingParagen;Ws({params:{conversation_id:E,displayed_message_ids:S.map(d=>d.messageId),message_metadatas:_,rating:w?"explicit_skipped":"skipped",selected_message_id:null,source_timestamp:Date.now(),ui_variant:w?3:r?2:1,user_prompt_message_id:C.message.id}}),w&&y(f,{shouldSubmitParagenFeedback:!1})}}),[h,T,b,n,t.conversationTurnMountTime,N,k?.messages,M?.messages,u,r,o,y,f]),e.jsx(Lt,{...t,setPreferredFeedback:y,leftVariantId:f,rightVariantId:x,leftTurn:h,rightTurn:T,hasActiveRequest:c,originalTurn:k,visibilityStateRef:F})}function Lt({setPreferredFeedback:t,leftVariantId:n,rightVariantId:a,leftTurn:s,rightTurn:o,hasActiveRequest:r,originalTurn:c,visibilityStateRef:u,...i}){const g=(s&&Bs(s))??null,m=(o&&Bs(o))??null,f=l.useMemo(()=>s?.messages??[],[s?.messages]),x=l.useMemo(()=>o?.messages??[],[o?.messages]),{avatarClassName:b,firstVisibleTokenTimestampsRef:h}=i,T=l.useMemo(()=>s?.messageGroups??[],[s?.messageGroups]),k=l.useMemo(()=>o?.messageGroups??[],[o?.messageGroups]),M=Kn(),N=Re(i.clientThreadId),F=R(s?.messages),y=R(o?.messages),p=ns(P.getRequestId(N,F?.id??y?.id)),E=p&&!F?.end_turn,C=p&&!y?.end_turn,S=s?.role===z.User,_=o?.role===z.User,A=l.useRef(null),w=l.useRef(null),d=l.useRef(null),j=s!=null,G=o!=null;!j&&h.current.left==null&&(h.current.left=Date.now()),!G&&h.current.right==null&&(h.current.right=Date.now()),l.useEffect(()=>{if(A.current&&w.current&&d.current){const Y=Array(11).fill(0).map((be,Z)=>Z/10),K=new IntersectionObserver(be=>be.forEach(Z=>{Z.target===w.current?(u.current.left_visibility_initial==null&&(u.current.left_visibility_initial=Z.intersectionRatio),u.current.left_visibility_max=Math.max(u.current.left_visibility_max??0,Z.intersectionRatio)):Z.target===d.current&&(u.current.right_visibility_initial==null&&(u.current.right_visibility_initial=Z.intersectionRatio),u.current.right_visibility_max=Math.max(u.current.right_visibility_max??0,Z.intersectionRatio))}),{root:A.current,threshold:Y});return K.observe(w.current),K.observe(d.current),()=>K.disconnect()}},[u]);const{data:I}=Qn(void 0,!1,M),q=is(),ne=e.jsx("div",{className:"text-token-text-secondary px-(--thread-content-margin) pt-1 pb-5 text-center text-sm text-pretty",children:e.jsx(D,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})});return e.jsxs("div",{className:"relative flex flex-col",children:[e.jsxs("div",{className:L("bg-token-main-surface-primary sticky top-[-1px] z-1 px-(--thread-content-margin) text-center text-lg text-pretty",q?"md:top-header-height":"md:static"),"data-testid":"paragen-feedback-title",children:[e.jsx(D,{id:"KKeSJV",defaultMessage:"You're giving feedback on a new version of ChatGPT."}),q?ne:null]}),q?null:ne,e.jsx("div",{className:L(Xn,"horzScrollShadows relative -mb-2 snap-x snap-mandatory overflow-x-auto overflow-y-clip pb-4"),ref:A,children:e.jsxs("div",{className:L("mx-auto box-content max-w-[calc(2*var(--thread-content-max-width))] min-w-min px-(--thread-content-margin)","flex items-start",q&&"divide-token-border-medium dark:divide-token-border-heavy divide-x",!q&&"gap-4 sm:gap-6"),children:[e.jsxs(Hs,{horizontalScrollContainerRef:A,rootElementRef:w,onClick:()=>{t(n)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:j,children:[e.jsxs(Vs,{children:[e.jsx(Ze,{messages:f,isUserTurn:S,avatarClassName:b}),e.jsx(Gs,{children:e.jsx(D,{...$s.responseNumber,values:{responseIndex:1,display_label:g}})})]}),q&&j?e.jsx(Os,{}):e.jsxs(e.Fragment,{children:[I!=null&&!S&&e.jsx(Ds,{clientThreadId:i.clientThreadId,messages:f,isParagen:!0}),e.jsx(Je,{...i,allMessages:f,groupedMessagesToRender:T,allGroupedMessages:T,isUserTurn:S,isFinalUserTurn:!1,isCompletionRequestInProgress:E,hasActiveRequest:r,shouldGrowContainer:!1,isParagen:!0}),e.jsx(zs,{clientThreadId:i.clientThreadId,conversationTurnMountTime:i.conversationTurnMountTime,turn:s,originalTurn:c})]})]}),e.jsxs(Hs,{horizontalScrollContainerRef:A,rootElementRef:d,onClick:()=>{t(a)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:G,children:[e.jsxs(Vs,{children:[e.jsx(Ze,{messages:x,isUserTurn:_,avatarClassName:b}),e.jsx(Gs,{children:e.jsx(D,{...$s.responseNumber,values:{responseIndex:2,display_label:m}})})]}),q&&G?e.jsx(Os,{}):e.jsxs(e.Fragment,{children:[I!=null&&!_&&e.jsx(Ds,{clientThreadId:i.clientThreadId,messages:x,isParagen:!0}),e.jsx(Je,{...i,allMessages:x,groupedMessagesToRender:k,allGroupedMessages:k,isFinalUserTurn:!1,isUserTurn:_,isCompletionRequestInProgress:C,hasActiveRequest:r,shouldGrowContainer:!1,isParagen:!0}),e.jsx(zs,{clientThreadId:i.clientThreadId,conversationTurnMountTime:i.conversationTurnMountTime,turn:o,originalTurn:c})]})]})]})})]})}function Hs({horizontalScrollContainerRef:t,rootElementRef:n,onClick:a,children:s,hasActiveRequest:o,isWaitingOnFirstUserVisibleToken:r}){const c=is(),{scrollX:u}=On({layoutEffect:!1,container:t,target:n}),i=Jn(),g=Zn(),m=l.useRef(null),f=l.useRef(null),x=l.useRef(null),[b,h]=l.useState(!1),[T,k]=l.useState(!1),[M,N]=l.useState(!1),[F,y]=l.useState(0);l.useEffect(()=>{if(!c)return;const w=new IntersectionObserver(d=>{for(const j of d)j.target===m.current?h(j.isIntersecting):j.target===x.current?N(j.isIntersecting):j.target===f.current&&k(j.isIntersecting)},{root:i?.current});return m.current&&f.current&&x.current&&(w.observe(m.current),w.observe(f.current),w.observe(x.current)),()=>{w.disconnect()}},[F,c,i]);const p=!M&&(T||b),E=Gn(u,w=>p?-1*w:0),C=As(0);l.useEffect(()=>{if(!c)return;const w=new ResizeObserver(d=>{ke(d.length===1,"entryList.length === 1");const j=d[0];ke(j.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),C.set(j.contentBoxSize[0].inlineSize)});return n.current&&w.observe(n.current),()=>{w.disconnect()}},[c,C,n]);const S=As(0);l.useEffect(()=>{if(!c)return;const w=new ResizeObserver(d=>{ke(d.length===1,"entryList.length === 1");const j=d[0];ke(j.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),S.set(j.contentBoxSize[0].blockSize+16),y(j.contentBoxSize[0].blockSize)});return g.current&&w.observe(g.current),()=>{w.disconnect()}},[c,S,g]);const _=e.jsx(Mt,{className:c?"px-5":"mt-4 self-start",onClick:a,"data-testid":"paragen-prefer-response-button",children:e.jsx(D,{id:"U2EAH6",defaultMessage:"I prefer this response"})}),A=r;return e.jsx("div",{"data-paragen-root":!0,className:L("@container relative flex min-w-[min(450px,80cqw,80vw)] flex-1 snap-center flex-col gap-1 text-start",c?"min-h-60":"border-token-border-tertiary rounded-xl border shadow-lg shadow-black/3"),ref:n,children:e.jsxs("div",{className:L(ea,"px-(--thread-content-margin) py-4"),children:[e.jsx("div",{className:L("absolute top-48 right-0! left-0! h-px","invisible"),ref:m}),e.jsx("div",{className:L("absolute top-48 right-0! bottom-0 left-0!","invisible"),ref:f}),e.jsx("div",{className:L("absolute right-0! bottom-0 left-0! h-px","invisible"),ref:x}),s,c?e.jsx("div",{className:"flex-1"}):null,c?e.jsx("div",{className:"mt-4 min-h-10",children:A?null:e.jsx(O.div,{style:{translateX:E,width:C,bottom:S},animate:{opacity:100},initial:{opacity:0},transition:{ease:"easeOut",duration:.2,delay:.5},className:L({fixed:p,"z-20 flex w-full justify-center":!0}),children:_})}):o?null:_]})})}function Os(){return e.jsxs("div",{className:"flex w-full flex-col gap-4 pt-3 pb-5",children:[e.jsx(de,{className:"h-4 w-[75%]"}),e.jsx(de,{className:"h-4 w-[50%]"}),e.jsx(de,{className:"h-4 w-[80%]"}),e.jsx(de,{className:"h-4 w-[55%]"}),e.jsx(de,{className:"h-4 w-[66%]"}),e.jsx(de,{className:"h-4 w-[64%]"}),e.jsx(de,{className:"h-4 w-[48%]"})]})}function is(){const{layer:t}=Ke("3119715334");return t.get("should-enable-hojicha",!1)}const Gs=re.div`text-sm text-token-text-secondary font-semibold`,Vs=re.div`flex gap-4 items-center mb-1`,de=re.div`animate-pulse rounded-[4px] bg-token-main-surface-tertiary`;function zs({clientThreadId:t,conversationTurnMountTime:n,turn:a,originalTurn:s}){const o=at();if(!o.showParagenMetadata||!o.showDebugConversationTurns&&!o.forceParagen||a==null)return null;let r=a===s?"ORIGINAL":"NEW";const c=a.messages[a.messages.length-1],u=c?.metadata?.__internal,i=c?.metadata?.paragen_display_label;if(u){const{model_id:f,model_definition_slug:x,model_definition_virtual_model_id:b,alternative_model_selection_rule:h,augmented_paragen_prompt_group_id:T,augmented_paragen_prompt_id:k,augmented_paragen_prompt:M}=u;f&&(r+=`
Model ID: ${f}`),x&&(r+=`
Model Slug: ${x}`),b&&(r+=`
Virtual Model ID: ${b}`),h&&(r+=`
Alternative Model Rule: ${h}`),T&&(r+=`
Prompt Group ID: ${T}`),k&&(r+=`
Prompt ID: ${k}`),M&&(r+=`
Prompt: ${M}`),i&&(r+=`
Display Label: ${i}`)}r+=`
Message ID: ${c.id}`;const g=P.getParentPromptNode(Re(t),a.messages[0].id);if(!g)throw new Error("Expected prompt for side by side feedback");const m=g.message.clientMetadata?.variantsInStreamInfo==null&&g.message.metadata?.paragen_variants_info!=null;return r+=`
User prompt message ID: ${g.message.id}`,r+=`
Is Persisted Paragen? ${m}`,r+=`
Completion Sample Finish Time: ${m?`${n} (persisted)`:R(a.messages)?.clientMetadata?.completionSampleFinishTime}`,e.jsx("div",{className:"text-sm whitespace-pre-wrap text-red-500",children:r})}async function Ws({params:t}){await Ct.safePost("/paragen_submission",{requestBody:t,anonAware:!0})}const $s=st({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}{display_label}"}});function kr({handleShowRetrievalResults:t,clientThreadId:n,turnIndex:a,responseComplete:s=!1}){const[o,r]=te(n,m=>[P.getTurnContentReferences(m,a),P.getConversationTurnAtIndex(m,a).messages]),c=l.useMemo(()=>({turnIndex:a,clientThreadId:n,responseComplete:s}),[n,s,a]),u=l.useRef(!1);l.useEffect(()=>{u.current||(u.current=!0,U.logEvent("File Sources Footer Shown",c))},[c]);const i=l.useCallback(()=>{U.logEvent("File Sources Footer Clicked",c),t()},[t,c]),g=l.useMemo(()=>{const m=new Set,f=[];function x(h){!h||m.has(h)||(m.add(h),f.push(h))}if(o.forEach(h=>{h.type==="file"?x(h.cloud_doc_url??h.extra?.cloud_doc_url):h.type==="file_navlist"&&h.items.forEach(T=>{x(T.cloud_doc_url)})}),s){for(const h of r)if(sa(h)){const T=ta(h.content.result),k=h.metadata?.cloud_doc_urls??[],M=T.chunks;for(let N=0;N<M.length;N++){const F=M[N];if(!F.documentId)continue;if(N<k.length){x(k[N]);continue}const y=F.documentId.endsWith("--google")?F.documentId.split("--")[1]:void 0,p=F.metadata.cloud_doc_url??(y?`https://drive.google.com/file/d/${y}`:void 0);x(p?.toString())}break}}const b=[];for(let h=0;h<f.length;h++){const T=f[h],k=na(T);if(k&&b.push(k.Icon),b.length>=3)break}return b},[r,o,s]);return e.jsxs(e.Fragment,{children:[e.jsx(O.div,{className:"absolute h-[60px]",initial:{opacity:0},animate:{opacity:1},children:e.jsxs("button",{className:L("not-prose group/footnote border-token-border-default bg-token-main-surface-primary hover:bg-token-main-surface-secondary mt-3 mb-2 flex w-fit items-center gap-1.5 rounded-xl border py-2","ps-3 pe-2.5"),onClick:i,children:[g.length>0&&e.jsx("div",{className:"flex flex-row-reverse gap-1",children:g.reverse().map((m,f)=>e.jsx(O.div,{className:L("border-token-main-surface-primary bg-token-main-surface-primary flex items-center overflow-hidden","group-hover/footnote:border-token-main-surface-secondary","relative"),initial:{opacity:0},animate:{opacity:1},children:e.jsx(m,{className:"icon-sm"})},f))}),e.jsx("div",{className:"text-token-text-secondary flex items-center gap-0.5 text-xs font-semibold",children:e.jsx(D,{id:"/48IOP",defaultMessage:"Sources"})})]})}),e.jsx("div",{className:"h-[60px]"})]})}function qt({followups:t,analyticsMetadata:n,isV2Enabled:a=!1}){const[s,o]=l.useState(-1),r=l.useRef(!1),c=Ft();return l.useEffect(()=>{r.current||(r.current=!0,t.forEach((u,i)=>{U.logEventWithStatsig("chatgpt_message_followup_action","chatgpt_message_followup_action",{...J(n),action:"show",position:(i+1).toString(),followup_text:fe(u)})}))},[t,n]),e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex w-full flex-col",children:t.slice(0,4).map((u,i)=>e.jsxs(O.div,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:i*.03},exit:{opacity:0,translateY:4},onMouseEnter:()=>o(i),onMouseLeave:()=>o(-1),children:[i>0&&!a&&e.jsx(Dt,{$isSelected:s===i||s===i-1}),e.jsx(wr,{followUp:u,onSelectingSuggestedReply:c,analyticsMetadata:n,position:i,isV2Enabled:a})]},i))})}const Dt=re.div`
  h-[1px] opacity-45
  ${({$isSelected:t})=>t?"mx-2 bg-token-main-surface-secondary":"bg-token-border-default"}
`;function wr({followUp:t,onSelectingSuggestedReply:n,analyticsMetadata:a,position:s,isV2Enabled:o}){return e.jsxs(O.button,{whileHover:"hover",className:L("bg-token-main-surface-primary hover:bg-token-main-surface-secondary flex w-full cursor-pointer items-start justify-start gap-2 rounded-lg py-3 text-start",o?"px-0":"px-2"),onClick:r=>{n(r,t,[],0),U.logEventWithStatsig("chatgpt_message_followup_action","chatgpt_message_followup_action",{...J(a),action:"click",position:(s+1).toString(),followup_text:fe(t)})},onMouseEnter:()=>{U.logEventWithStatsig("chatgpt_message_followup_action","chatgpt_message_followup_action",{...J(a),action:"hover",position:(s+1).toString(),followup_text:fe(t)})},children:[e.jsx(O.div,{className:"flex items-center justify-center pt-0.25 opacity-70",variants:{hover:{x:4}},initial:{x:0},transition:{duration:.1},children:e.jsx(ot,{className:"text-token-text-secondary h-[20px] w-[20px]"})}),e.jsx("div",{className:"text-token-text-secondary pe-2 text-start text-sm",children:fe(t)})]})}const Ir=()=>e.jsx(At,{size:"lg",lines:3,width:35,widthVariance:10,className:"w-full"}),Er=t=>({[ae.Search]:"Web Search",[ae.Research]:"Research",[ae.PictureV2]:"Draw Image",[ae.Think]:"Think Harder"})[t]??"Title",es=(t,n,a,s,o)=>{U.logEventWithStatsig("Capabilities Suggestion Action","chatgpt_capabilities_suggestion_action",{...J(a),categoryId:n.categoryId,suggestionId:n.id,position:s,action:t,numSuggestions:String(o)})},Nr=(t,n)=>{const a=l.useRef(!1);l.useEffect(()=>{a.current||(a.current=!0,t.forEach((s,o)=>{es("show",s,n,o+1,t.length)}))},[t,n])},Ut=({clientThreadId:t,suggestions:n,analyticsMetadata:a,style:s="default"})=>{const o=Ft();return Nr(n,a),e.jsx(e.Fragment,{children:n.map((r,c)=>e.jsxs(O.div,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},exit:{opacity:0,translateY:4},transition:{delay:c*.03},className:L("w-full flex-1",s==="compact"&&"flex-col"),children:[s==="compact"&&c>0&&e.jsx(Dt,{$isSelected:!1}),e.jsx(Rr,{clientThreadId:t,suggestion:r,onSelectingSuggestedReply:o,position:c+1,numSuggestions:n.length,analyticsMetadata:a,style:s})]},r.prompt))})},Rr=({clientThreadId:t,suggestion:n,onSelectingSuggestedReply:a,analyticsMetadata:s,position:o,numSuggestions:r,style:c="default"})=>{const{setThreadSystemHintMode:u}=aa(),i=os(),g=Vn();return e.jsx(O.button,{onClick:m=>{if(es("click",n,s,o,r),n.categoryId===ae.Research)if(i?.isFree()){oa(g,"Suggested Capabilities Upsell");return}else u(n.categoryId,!0,s);a(m,n,[],0)},onMouseEnter:()=>{es("hover",n,s,o,r)},className:L("hover:bg-token-main-surface-secondary flex w-full flex-1 items-start rounded-xl text-start transition-colors duration-300 ease-in-out",c==="default"&&"gap-4 p-2"),children:c==="compact"?e.jsx(Ar,{clientThreadId:t,suggestion:n}):e.jsx(Fr,{clientThreadId:t,suggestion:n})})},Ar=({suggestion:t,clientThreadId:n})=>{const{categoryId:a}=t,{systemHints:s}=rt(n),o=s.find(r=>r.systemHint===a);return e.jsxs("div",{className:"bg-primary hover:bg-tertiary group flex w-full cursor-pointer items-center justify-start gap-2 rounded-lg px-2 py-3 text-start transition-colors duration-300 ease-in-out",children:[e.jsx("div",{className:"flex items-center justify-center opacity-70 transition-all duration-100 ease-in-out group-hover:scale-[1.02] group-hover:rotate-[-5deg] group-hover:opacity-100",children:a==="ask"?e.jsx(ot,{className:"text-token-text-secondary group-hover:text-token-text-primary h-[18px] w-[18px]"}):e.jsx(kt,{svgString:o?.logo??"",className:"text-token-text-secondary icon-md group-hover:text-token-interactive-label-accent-default h-[18px] w-[18px]"})}),e.jsx("div",{className:"text-token-text-secondary group-hover:text-token-text-primary flex items-center pe-2 text-start text-sm",children:fe(t)})]})},Fr=({clientThreadId:t,suggestion:n})=>{const{categoryId:a,imageUrl:s,description:o,title:r,ctaLabel:c,prompt:u}=n,{systemHints:i}=rt(t),g=i.find(m=>m.systemHint===a);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-token-border-default bg-primary relative h-16 w-14 flex-shrink-0 rounded-lg border drop-shadow-xs transition-all duration-100 ease-in-out group-hover:scale-[1.02] group-hover:rotate-[-2deg]",children:[a===ae.PictureV2?e.jsx("div",{className:"flex h-full w-full items-center justify-center rounded-lg bg-cover",style:{backgroundImage:`url(${s})`},children:e.jsx(ra,{className:"icon-xl mb-2 text-white"})}):e.jsxs("div",{className:"flex flex-col gap-1.5 p-2",children:[e.jsx("div",{className:"text-token-text-primary text-[5px] leading-tight font-semibold tracking-tighter",children:r??Er(a)}),e.jsx("div",{className:"flex flex-col gap-0.5",children:Array.from({length:10}).map((m,f)=>e.jsx("div",{className:"bg-token-border-heavy h-[1px] w-full rounded-full"},f))})]}),e.jsx("div",{className:"absolute -end-2 -bottom-2",children:e.jsx(ia,{isBadge:!0,className:"opacity-100",logo:e.jsx(kt,{svgString:g?.logo??"",className:"icon-md"})})})]}),e.jsxs("div",{className:"flex flex-col gap-2 text-sm",children:[e.jsx("div",{className:"text-token-text-primary flex-grow",children:o??u}),c&&e.jsxs("div",{className:"text-token-text-secondary flex items-center font-medium",children:[c,e.jsx(O.div,{variants:{hover:{x:2}},initial:{x:0},transition:{duration:.1},children:e.jsx(la,{})})]})]})]})},ss=(t,n,a,s)=>{U.logEventWithStatsig("Capabilities Tab Action","chatgpt_capabilities_tab_action",{...J(a),tabId:n,position:s,action:t})},Pr=(t,n)=>{const a=l.useRef(!1);l.useEffect(()=>{a.current||(a.current=!0,t.forEach((s,o)=>{ss("show",s.value,n,o+1)}))},[t,n])},Lr=({clientThreadId:t,categorySuggestions:n,lastMessageId:a,analyticsMetadata:s,style:o="default"})=>{const r=n.map(({category_id:i,title:g,suggestions:m})=>({value:i,message:g,suggestions:m?.map(it)??[]})),[c,u]=l.useState(r[0].value);return Pr(r,s),e.jsxs(ca,{value:c,onValueChange:u,orientation:"horizontal",className:"flex w-full flex-col",children:[e.jsx(da,{className:"border-token-border-default relative flex w-full flex-row gap-6 border-b",children:r.map((i,g)=>e.jsx(Dr,{value:i.value,message:i.message,isActive:c===i.value,analyticsMetadata:s,position:g+1},i.value))}),r.map(i=>e.jsx(ua,{value:i.value,children:e.jsx(qr,{initialSuggestions:i.suggestions,clientThreadId:t,categoryId:i.value,isActive:c===i.value,lastMessageId:a,analyticsMetadata:s,style:o})},i.value))]})},qr=({initialSuggestions:t,clientThreadId:n,categoryId:a,isActive:s,lastMessageId:o,analyticsMetadata:r,style:c="default"})=>{const u=ge(n),i=s&&t.length===0,{suggestions:g,isLoading:m}=ga({categoryId:a,shouldFetch:i,serverThreadId:u,lastMessageId:o}),f=i?g:t;return a==="ask"?m?e.jsx(Ir,{}):e.jsx(qt,{followups:f.map(x=>({type:lt.Reply,text:x.prompt})),analyticsMetadata:r}):e.jsx("div",{className:"flex w-full flex-col gap-y-4 py-3 md:flex-row md:gap-x-4",children:m?e.jsxs(e.Fragment,{children:[e.jsx(Ys,{}),e.jsx(Ys,{})]}):e.jsx(Ut,{clientThreadId:n,suggestions:f,analyticsMetadata:r,style:c})})},Dr=({value:t,message:n,isActive:a,analyticsMetadata:s,position:o})=>e.jsxs(ma,{className:"text-token-text-tertiary hover:text-token-text-secondary radix-state-active:text-token-text-primary relative flex min-w-10 justify-center py-4 text-sm font-medium",value:t,onClick:()=>{ss("click",t,s,o)},onMouseEnter:()=>{ss("hover",t,s,o)},children:[e.jsx("div",{className:"truncate",children:n}),e.jsx(ve,{children:a&&e.jsx(O.div,{layoutId:"tab-underline",className:"bg-token-text-primary absolute start-0 end-0 bottom-0 h-0.5",transition:{type:"spring",stiffness:500,damping:30}})})]}),Ys=()=>e.jsxs("div",{className:"flex flex-1 items-center gap-4 rounded-xl p-2",children:[e.jsx("div",{className:"bg-token-sidebar-surface-secondary dark:bg-token-border-default h-16 w-14 flex-shrink-0 rounded-lg"}),e.jsx("div",{className:"w-full flex-grow",children:e.jsx(At,{lines:3,size:"sm"})})]}),Ur=({clientThreadId:t,categorySuggestions:n,lastMessageId:a,analyticsMetadata:s})=>{if(!n||n.length===0)return null;const o=n.length===1,r=n[0],c=r.suggestions.length>0?r.suggestions:void 0;return o&&c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-1 text-sm font-semibold",children:e.jsx(D,{id:"3UFIQc",defaultMessage:"Follow up"})}),e.jsx(Ut,{clientThreadId:t,suggestions:c.map(it),analyticsMetadata:s,style:r.style})]}):e.jsx(Lr,{clientThreadId:t,categorySuggestions:n??[],lastMessageId:a,analyticsMetadata:s})};function Br({clientThreadId:t,followups:n,categorySuggestions:a,lastMessageId:s,analyticsMetadata:o}){const[r,c]=l.useState(null),u=ct.useIsEnabled(t),{capabilitySuggestionsEnabled:i}=dt(),g=a&&a.length>0;return e.jsxs(e.Fragment,{children:[e.jsx(Gr,{visible:r==="conversation"}),e.jsx(Vr,{visible:r==="global"}),u&&(i?g&&e.jsx(Ur,{clientThreadId:t,lastMessageId:s,categorySuggestions:a,analyticsMetadata:o}):n.length>0&&e.jsx(Hr,{clientThreadId:t,followups:n,analyticsMetadata:o,setDisableMessage:c}))]})}function Hr({clientThreadId:t,followups:n,setDisableMessage:a,analyticsMetadata:s}){const{value:o}=oe("2281969373"),{value:r}=oe("2076592918");return e.jsxs("div",{className:"group",children:[r?e.jsx("hr",{className:"bg-token-bg-tertiary mt-5 mb-5 opacity-70"}):e.jsxs("div",{className:"mb-1 flex items-center text-sm font-semibold",children:[e.jsx(D,{id:"3UFIQc",defaultMessage:"Follow up"}),!o&&e.jsx(Or,{clientThreadId:t,setDisableMessage:a,analyticsMetadata:s})]}),e.jsx(qt,{followups:n,analyticsMetadata:s,isV2Enabled:r})]})}function Or({clientThreadId:t,setDisableMessage:n,analyticsMetadata:a}){const s=ct.useStore(),[o,r]=l.useState(!1);return e.jsxs(ha,{size:"small",onOpenChange:c=>r(c),contentClassName:"min-w-[200px]",triggerButton:e.jsx("button",{className:"text-token-text-tertiary hover:bg-token-main-surface-tertiary ms-2 flex h-6 w-6 items-center justify-center rounded-md focus:ring-0 focus:outline-hidden",children:e.jsx(pa,{className:L("h-4 w-4 opacity-0 group-hover:opacity-100",o&&"opacity-100")})}),children:[e.jsx(Q.Item,{onClick:()=>{s.setDisabledConversation(t,!0),n("conversation"),setTimeout(()=>n(null),3e3),U.logEventWithStatsig("chatgpt_message_followup_setting","chatgpt_message_followup_setting",{...J(a),action:"disable_conversation"})},className:"text-token-text-primary",children:e.jsx(D,{id:"GZYofd",defaultMessage:"Hide for this chat"})}),e.jsx(Q.Item,{onClick:()=>{s.setDisabledGlobally(!0),n("global"),setTimeout(()=>n(null),5e3),U.logEventWithStatsig("chatgpt_message_followup_setting","chatgpt_message_followup_setting",{...J(a),action:"disable_globally"})},className:"text-token-text-primary",children:e.jsx(D,{id:"dtAOq4",defaultMessage:"Hide everywhere"})})]})}const Bt={initial:{opacity:1},animate:{opacity:1},exit:{opacity:0,transition:{duration:.2}}};function Gr({visible:t}){return e.jsx(ve,{children:t&&e.jsx(O.div,{...Bt,className:"text-token-text-tertiary flex justify-center py-6 text-sm",children:e.jsx(D,{id:"ckTD9g",defaultMessage:"Follow ups are turned off for this conversation"})})})}function Vr({visible:t}){return e.jsx(ve,{children:t&&e.jsxs(O.div,{id:"disableForAllConvos",...Bt,className:"flex flex-col items-center py-3 text-sm",children:[e.jsx("div",{children:e.jsx(D,{id:"5GDIBQ",defaultMessage:"Follow up have been turned off"})}),e.jsx("div",{className:"text-token-text-tertiary pt-1",children:e.jsx(D,{id:"LYaBNe",defaultMessage:"You can re-enable them in settings"})})]})})}function zr({modelSlug:t,animateModelLabelOnRender:n,isDropdownOpen:a,isRegenerateEnabled:s,isHovered:o,animateShortLabel:r}){const{data:c}=zo(),[u,i]=l.useState("initial");l.useEffect(()=>{if(n){const x=setTimeout(()=>i("show"),500),b=setTimeout(()=>i("initial"),2e3);return()=>{clearTimeout(x),clearTimeout(b)}}i("initial")},[n]);const{shorterLabel:g}=c?.categories.find(({defaultModel:x})=>x===t)??{},m={initial:{opacity:0,paddingLeft:0,width:"0"},show:{opacity:1,paddingLeft:2,width:"100%"},visible:{opacity:1,paddingLeft:2,width:"100%",transition:{delay:0,duration:0}}},f=a?"visible":o?"show":u;return e.jsxs(O.div,{initial:"initial",animate:f,className:"flex items-center pb-0",children:[e.jsx(ts,{className:"icon-md"}),(s||r)&&e.jsx(O.span,{className:"overflow-hidden text-sm text-clip whitespace-nowrap",variants:m,transition:{type:"tween",duration:.18},children:g}),s&&e.jsx(ut,{className:"icon-sm"})]})}function Ge(t,n){const{modelSwitcherDeny:a,subscriptionLevel:s}=t;return!!a&&a.reason===Yo.RATE_LIMIT&&s===Ko.PLUS&&!n}const Ee="rounded-lg radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed";function Wr({className:t,clientThreadId:n,message:a,onModelSelect:s,canRegenerateResponse:o,withModelSelectorLabel:r=!0}){const[c,u]=l.useState(null),[i,g]=l.useState(!1),[m,f]=l.useState(!1),x=a.metadata?.model_slug,b=a.id,h=l.useRef(null),T=C=>{C||setTimeout(()=>{h.current&&h.current.blur()},10)};l.useEffect(()=>{T(i)},[i]);const k=te(n,Ma),M=Vo({clientThreadId:n}),N=l.useRef(M);l.useEffect(()=>{N.current=M},[M]);const F=l.useCallback(C=>{N.current?ue(n,S=>{S.conduitToken=null,S.prepareState=null}):ue(n,S=>{S.conduitToken=C,S.prepareState="success"})},[n]);if(k)return null;const y=fa(n,a.id),p=a.metadata?.model_slug,E=ba(y,p);return e.jsxs(Q.Root,{onOpenChange:C=>{o&&(p&&ya(n,p,[],F),g(C),T(C))},children:[o?e.jsx(xa,{label:r?e.jsx(D,{id:"wDs5sz",defaultMessage:"Switch model "}):e.jsx(D,{id:"/a4cqQ",defaultMessage:"Switch model ({modelSlug})",values:{modelSlug:p}}),children:e.jsx(va,{ref:h,className:L("cursor-pointer",t),onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),children:r?e.jsx(zr,{modelSlug:p,animateModelLabelOnRender:E,isDropdownOpen:i,isRegenerateEnabled:o,isHovered:m}):e.jsxs("div",{className:"flex items-center",children:[e.jsx(ts,{className:"icon-md"}),e.jsx(ut,{className:"icon-sm"})]})})}):null,o&&e.jsx(Q.Portal,{children:e.jsxs(Q.Content,{className:"text-token-text-primary z-30 min-w-fit origin-top-right",side:"bottom",align:"start",children:[e.jsx(Q.Label,{children:e.jsx(D,{id:"bFLh5u",defaultMessage:"Switch model"})}),e.jsx($r,{clientThreadId:n,messageId:b,message:a,onModelSelect:s,messageModelSlug:x,setHoveredOption:u,hoveredOption:c})]})})]})}function $r({clientThreadId:t,message:n,messageId:a,messageModelSlug:s,onModelSelect:o,setHoveredOption:r,hoveredOption:c}){const u=Ae(),{data:i=null}=Wo(),g=i&&$o(i),{modelOptions:m,messageModelEnabledTools:f}=_a({clientThreadId:t,message:n}),x=f.includes(ae.Search),b=l.useMemo(()=>m.find(y=>y.value===s),[m,s]),[h,T]=l.useMemo(()=>Sa(m,y=>y.subcategory),[m]),k=Ta(n);l.useEffect(()=>{const y=m.some(p=>Ge(p,g));U.logEvent("Conversation Open Message Model Selector",{has_get_plus_button:y,is_new_regen_dropdown:!0})},[]);const M=l.useMemo(()=>{const y=new Map;return h.forEach(p=>{const E=p.subcategory;E&&(y.has(E)||y.set(E,[]),y.get(E)?.push(p))}),y},[h]),N=L("icon-sm","order-10 ms-auto text-token-text-tertiary icon-md"),F=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:u.formatMessage(Ve.search),icon:e.jsx(ja,{className:N}),condition:x&&!k,eventName:"chatgpt_regenerate_with_search_button_clicked"},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:u.formatMessage(Ve.nosearch),icon:e.jsx(Ca,{className:N}),condition:x&&k,eventName:"chatgpt_regenerate_without_search_button_clicked"}];return e.jsxs(e.Fragment,{children:[T.map(y=>{const{value:p,...E}=y;return e.jsx(we,{value:p,onSelect:C=>{X.logEvent("chatgpt_regenerate_switch_model_button_clicked",p,{requestedModelId:p,...J({clientThreadId:t,messageId:a})}),o({sourceEvent:C,requestedModelId:p})},includeRegenerate:!1,onMouseEnter:()=>r(p),onMouseLeave:()=>r(null),isHovered:c===p,messageModelSlug:s,includeCheck:!1,shouldShowUpsell:Ge(y,g),className:Ee,...E,icon:e.jsx("span",{className:N}),clientThreadId:t},p)}),[...M.entries()].map(([y,p])=>e.jsxs(Q.Sub,{children:[e.jsx(Q.SubMenuTrigger,{children:e.jsx("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:y})}),e.jsx(Q.Portal,{children:e.jsx(Q.SubContent,{className:"min-w-fit",children:p.map(E=>{const{value:C,...S}=E;return e.jsx(we,{value:C,onSelect:_=>{X.logEvent("chatgpt_regenerate_switch_model_button_clicked",C,{requestedModelId:C,...J({clientThreadId:t,messageId:a})}),o({sourceEvent:_,requestedModelId:C})},includeRegenerate:!1,onMouseEnter:()=>r(C),onMouseLeave:()=>r(null),isHovered:c===C,messageModelSlug:s,includeCheck:!1,className:Ee,...S,icon:null,shouldShowUpsell:Ge(E,g),clientThreadId:t},y+"-"+C)})})})]},y)),!!b&&e.jsxs(e.Fragment,{children:[e.jsx(Q.Separator,{}),e.jsx(we,{onSelect:y=>{X.logEvent("chatgpt_regenerate_try_again_button_clicked",b.value,{requestedModelId:b.value,...J({clientThreadId:t,messageId:a})}),o({sourceEvent:y,requestedModelId:b.value})},includeRegenerate:!0,onMouseEnter:()=>r(b.value),onMouseLeave:()=>r(null),messageModelSlug:s,includeCheck:!1,className:Ee,...b,label:u.formatMessage(Ve.tryAgain),subtitle:b.label,icon:e.jsx(ts,{className:N}),clientThreadId:t},b.value),F.filter(y=>y.condition).map(y=>e.jsx(we,{onSelect:p=>{X.logEvent(y.eventName,b.value,{requestedModelId:b.value,...J({clientThreadId:t,messageId:a})}),o({sourceEvent:p,requestedModelId:b.value,extraStreamParams:y.extraStreamParams})},includeRegenerate:!1,onMouseEnter:()=>r(y.key),onMouseLeave:()=>r(null),isHovered:c===y.key,messageModelSlug:s,includeCheck:!1,className:Ee,...b,label:y.label,subtitle:"",icon:y.icon,clientThreadId:t},y.key))]})]})}const Ve=st({tryAgain:{id:"VbsBGW",defaultMessage:"Try again"},search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),Yr=l.memo(Wr),Kr=null,Qr=me(()=>he(()=>import("./lmxu6hvxz5hh85wp.js"),__vite__mapDeps([7,2,1,3,8,9,4,5,10,11])).then(t=>t.VoicePlayButton)),Xr=me(async()=>Promise.resolve(()=>null)),Jr=({alwaysShow:t,isUserTurn:n,children:a})=>{const s=l.useRef(null);return l.useEffect(()=>{const o=s.current;o&&(t?requestAnimationFrame(()=>{o&&(o.style.maskPosition=t?"0% 0%":"")}):o.style.maskPosition="")},[t]),e.jsx("div",{className:L("flex",!t&&"absolute start-0 end-0 flex",n?"justify-end":"justify-start"),children:e.jsx("div",{ref:s,className:L("touch:-me-2 touch:-ms-3.5 -ms-2.5 -me-1 flex items-center p-1 select-none",!n&&"-mt-1",t&&"duration-[1.5s]","focus-within:transition-none hover:transition-none",!(t||n)&&"duration-500 group-hover/turn-messages:delay-300",!n&&["pointer-events-none [mask-image:linear-gradient(to_right,black_33%,transparent_66%)] [mask-size:300%_100%] [mask-position:100%_0%] motion-safe:transition-[mask-position]","group-hover/turn-messages:pointer-events-auto group-hover/turn-messages:[mask-position:0_0]","group-focus-within/turn-messages:pointer-events-auto group-focus-within/turn-messages:[mask-position:0_0]","has-data-[state=open]:pointer-events-auto has-data-[state=open]:[mask-position:0_0]"],n&&["duration-300 group-hover/turn-messages:delay-300","pointer-events-none opacity-0 motion-safe:transition-opacity","group-hover/turn-messages:pointer-events-auto group-hover/turn-messages:opacity-100","group-focus-within/turn-messages:pointer-events-auto group-focus-within/turn-messages:opacity-100","has-data-[state=open]:pointer-events-auto has-data-[state=open]:opacity-100"]),children:a})})},Zr=({activeVariantIndex:t,clientThreadId:n,conversationMode:a,lastMessage:s,messages:o,numVariants:r,onChangeIndex:c,onRate:u,showCanvasButton:i,showCopyButton:g,showPagination:m,showPlayButton:f,showRatingButtons:x,showRegenerateButton:b,isJam:h,turn:T,turnIndex:k})=>{const M=wt(),N=Ae(),F=It(),{value:y}=oe("4061070236"),p=s?.clientMetadata?.rating;s?.clientMetadata?.requestId;const E=Qo(o,Y=>{const[K]=Y.author.name?.split(".")??[];return K===Xo.T2UAY3K&&Et.getImageAssetPointers(Y).length>0}),C=o.filter(Jo).filter(Y=>Y.recipient==="all"),S=!!E,_=Nt(),A=wa(),w=Ia(),d=ge(n),j=S&&C.length===0&&Zo(E),G=!h&&d!=null,I=!_&&E&&A(),q=!_&&!E&&Ea(M);let ne=null;return G&&(I||q?ne=e.jsx(ti,{clientThreadId:n,imageGenMessageId:E?.id,messageSliceIds:o.map(Y=>Y.id)}):w&&er(M,"1547743984").get("show_share_button_inline",!1)&&(ne=e.jsx(xe,{onClick:()=>{d&&ht.openSharingModal(d)},label:N.formatMessage({id:"ConversationTurn.shareButtonTooltip",defaultMessage:"Share conversation"}),className:"sm:hidden",icon:gt}))),e.jsxs(e.Fragment,{children:[m&&e.jsx(mt,{currentPage:t,onChangeIndex:c,length:r}),!1,g&&!j&&e.jsx(Ht,{onClick:Y=>{Pt(M,n,k,F,Y)}}),!S&&x&&e.jsxs(e.Fragment,{children:[p!=="thumbsDown"&&e.jsx(xe,{onClick:()=>u("thumbsUp"),disabled:p==="thumbsUp",icon:p==="thumbsUp"?Na:pt,label:N.formatMessage({id:"ConversationTurn.goodResponseTooltip",defaultMessage:"Good response"}),testId:"good-response-turn-action-button"}),p!=="thumbsUp"&&e.jsx(xe,{onClick:()=>u("thumbsDown"),disabled:p==="thumbsDown",icon:p==="thumbsDown"?Ra:ft,label:N.formatMessage({id:"ConversationTurn.badResponseTooltip",defaultMessage:"Bad response"}),testId:"bad-response-turn-action-button"})]}),f&&s&&C.length>0&&e.jsx(Qr,{conversationId:n,message:s,iconClassName:"icon-md",className:"text-token-text-tertiary hover:text-token-text-primary gap-1.5 rounded-md p-1 text-xs"}),!S&&i&&e.jsx(Aa,{turn:T}),s&&Kr,b&&s&&e.jsx(si,{clientThreadId:n,conversationMode:a,lastMessage:s,messages:o,hasImageGenMessage:S,withModelSelectorLabel:!y}),ne]})},ei=({activeVariantIndex:t,clientThreadId:n,numVariants:a,onAnticipateEdit:s,onChangeIndex:o,onEnterEdit:r,showCopyButton:c,showEditMessageButton:u,showPagination:i,turnIndex:g})=>{const m=wt(),f=It();return e.jsxs(e.Fragment,{children:[c&&e.jsx(Ht,{onClick:x=>{Pt(m,n,g,f,x)}}),u&&e.jsx(ka,{onAnticipateEdit:s,onEnterEdit:r}),i&&e.jsx(mt,{currentPage:t,onChangeIndex:o,length:a})]})},si=({clientThreadId:t,conversationMode:n,messages:a,hasImageGenMessage:s,lastMessage:o,withModelSelectorLabel:r})=>{const c=qa({clientThreadId:t,conversationMode:n}),u=Da(t,o),i=l.useCallback(({sourceEvent:g,requestedModelId:m,appendMessages:f,extraStreamParams:x})=>{o&&c({sourceEvent:g,nodeId:o.id,requestedModelId:m,appendMessages:f,extraStreamParams:x})},[o,c]);return s?e.jsx(Xr,{messages:a,onModelSelect:i}):e.jsx(Yr,{className:"text-token-text-secondary hover:bg-token-main-surface-secondary touch:px-2.5 h-[30px] rounded-md px-1.5",clientThreadId:t,message:o,onModelSelect:i,canRegenerateResponse:u,withModelSelectorLabel:r})},Ht=({onClick:t})=>{const[n,a]=l.useState(!1),s=Fa(),o=Ae(),r=l.useCallback(c=>{c.stopPropagation(),U.logEvent("ChatGPT Turn Action Copy Clicked"),t(c),a(!0),setTimeout(()=>{s()&&a(!1)},2e3),X.logEvent("chatgpt_turn_action_copy")},[s,t]);return e.jsx(xe,{icon:n?Pa:La,onClick:r,label:o.formatMessage({id:"CopyButton.copyTooltip",defaultMessage:"Copy"}),testId:"copy-turn-action-button"})};function ti({clientThreadId:t,imageGenMessageId:n,messageSliceIds:a}){const[s,o]=l.useState(!1),r=Ae(),c=_r({clientThreadId:t,imageGenMessageId:n,messageSliceIds:a});return l.useEffect(()=>{U.logEventWithStatsig("Share Post: Share Button Shown","chatgpt_post_share_button_shown",{source:"turn_action"})},[]),e.jsx(xe,{onClick:async()=>{o(!0);try{await c()}finally{o(!1)}U.logEventWithStatsig("Share Post: Share Button Clicked","chatgpt_post_share_button_clicked",{source:"turn_action"})},label:r.formatMessage({id:"ConversationTurn.sharePostButtonTooltip",defaultMessage:"Share"}),icon:s?sr:gt,disabled:s})}const Ks=[1,2,3,4,10,20,30],ni=1,ai=["g-67e595af0a408191b84ee532fca12cd1","g-67ec3b78892481918c89067962526695","g-67ec3b4988f8819184c5454e18f5e84b","g-67ec3ad40750819181ccffa6a6f050d5","g-67edaaa3d3a081918205d0c470f00a32","g-67edab030ac881918ce8fa5c75a8e1b3","g-67edab2fc0f48191881a20ac98fedf6f","g-67edab4a24fc8191b975acaa8da2dcef"];function oi({clientThreadId:t}){const n=xt(vt.isBusinessWorkspace),a=bt(),s=l.useRef(!1),o=rs(t),[r,c,u,i]=te(t,d=>[d?.mode,P.getRequestId(d),P.getConversationLastTurn(d),P.getConversationTurns(d).filter(j=>j.role===z.Assistant).length]),{isUnauthenticated:g}=Rt(),m=l.useMemo(()=>{if(!o)return-1;const d=nt(o);return d()>ni?-1:Ks[Math.floor(d()*Ks.length)]},[o]),f=ns(c),x=function(){return Math.random()<.5?"default":"personality_v1"},[b,h]=l.useState(null),[T,k]=l.useState(!1),[M,N]=l.useState(!1),[F,y]=l.useState(!1),[p,E]=l.useState(x),C=(d,j)=>{const G=u?.messages[0]?.id;h(d),E(j),_(G,d,j)},S=u?.role===z.Assistant,_=l.useMemo(()=>Ua((d,j,G)=>{o&&d&&(n&&a?Ba({rating:Oa(j),shown_at_assistant_turn:m,prompt:G},o,d):n||Ct.safePost("/conversation/{conversation_id}/rating",{parameters:{path:{conversation_id:o}},requestBody:{message_id:d,rating:j,shown_at_assistant_turn:m,prompt:G},anonAware:!0})),U.logEvent("Conversation Rating Submitted",{rating:j,showAtAssistantTurn:m,conversationId:o,prompt:G}),k(!0),setTimeout(()=>{N(!0)},1500)},2e3),[n,a,o,m]),A=i!==m||f||!S||!!n&&!a||r?.kind!==Xe.PrimaryAssistant&&r?.kind!==Xe.FlyingCircusCustomization&&r?.gizmo_id!==void 0&&!ai.includes(r?.gizmo_id)||F||g;l.useEffect(()=>{!A&&!s.current&&(U.logEvent("Conversation Rating Shown",{showAtAssistantTurn:m,conversationId:o}),s.current=!0)},[A]);const w=Ha();return F||!w.forceShowConvoRating&&A?null:e.jsxs("div",{className:"mx-auto",children:[e.jsx(ve,{children:T&&!M&&e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(Qs,{$padded:!0,children:e.jsx("span",{className:"text-token-text-tertiary text-sm",children:e.jsx(D,{id:"rating.thanks",defaultMessage:"Thanks for your feedback!"})})})},"submitted")}),!T&&e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},children:e.jsxs(Qs,{$padded:!1,children:[e.jsxs("div",{className:"text-token-text-secondary flex items-center justify-center gap-4 px-4 py-3 text-sm",children:[p==="personality_v1"?e.jsx(D,{id:"rating.instructions.personality_v1",defaultMessage:"Do you like this personality?"}):e.jsx(D,{id:"rating.instructions.default",defaultMessage:"Is this conversation helpful so far?"}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx(ze,{$selected:b==="thumbsUp",onClick:()=>C("thumbsUp",p),children:e.jsx(pt,{className:"icon-md"})}),e.jsx(ze,{$selected:b==="thumbsDown",onClick:()=>C("thumbsDown",p),children:e.jsx(ft,{className:"icon-md"})})]})]}),e.jsx("div",{className:"bg-token-main-surface-tertiary w-px flex-1 self-stretch"}),e.jsx(ze,{className:"p-3",$selected:!1,onClick:()=>y(!0),children:e.jsx(tr,{className:"icon-md text-token-text-secondary hover:text-token-text-primary"})})]})},"rating")]})}const ze=re.button`
  ${t=>t.$selected?"text-token-text-primary":"text-token-text-secondary"}
  hover:text-token-text-primary
`,Qs=re.div`inline-flex rounded-xl border border-gray-100 dark:border-gray-700
${t=>t.$padded&&"py-3 px-4"}
`,ri=me(()=>he(()=>import("./m79xqmw9o9st6d11.js"),__vite__mapDeps([12,2,1,3,4,5,13])));function ii({clientThreadId:t,canShowInlineMessageFeedback:n,messageForRating:a,allGroupedMessages:s,currentModelId:o}){const r=os()?.isWorkspacePlan()??!1;let c=null;const u=te(t,x=>{const b=P.getConversationTurns(x);let h=0;for(let T=b.length-1;T>=0;T--){const k=b[T];if(k.messages.some(M=>M.metadata?.is_indepth_feedback))return!0;if(k.messages.some(M=>M.author.role===z.Assistant)&&h++,h>=3)break}return!1}),i=rs(t),g=yt(x=>x.voiceFeedbackThread),m=i===g,{voiceName:f}=Ga();return u?null:(m&&i&&!r?(nr.feedbackShown.success({voice:f}),c=e.jsx("div",{className:"text-center",children:e.jsx(Va,{serverThreadId:i})})):a.clientMetadata?.rating&&n?c=e.jsx(ri,{clientThreadId:t,conversationMessage:a,allGroupedMessages:s,currentModelId:o}):c=e.jsx("div",{className:"text-center",children:e.jsx(oi,{clientThreadId:t})}),e.jsx("div",{className:"mt-3 w-full empty:hidden",children:c}))}const li=me(()=>he(()=>import("./gm5y1gu44e9b1hhu.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(t=>t.MemoryActionResult)),ci=me(()=>he(()=>import("./e6baz4ypgq05475b.js"),__vite__mapDeps([14,2,4,1,3,5,15,16])).then(t=>t.AutomationSourceHeader)),Xs=me(()=>he(()=>import("./dpdfmvit4u353o4u.js"),__vite__mapDeps([17,2,1,3,4,5])).then(t=>t.TextMessageEditor)),Js=80,di=16,Zs={minHeight:`calc(100dvh - ${uo}px - 120px)`};function ui(t){const{turnIndex:n,isFinalTurn:a,clientThreadId:s,onRequestCompletion:o,currentModelId:r,avatarClassName:c,showAvatar:u,scrollToMessageId:i,dateHeaderType:g}=t,{isNewScrollEnabled:m}=_t(),f=tt();os()?.normalizedAccountUserId;const x=!!f&&ar(f),b=za(),h=xt(vt.isBusinessWorkspace),T=vo(),{value:k}=oe("1760640904"),{value:M}=oe("1456513860"),{value:N}=oe("4061070236"),F=u??!M,p=null!=null,{value:E}=oe("1887864177"),{capabilitySuggestionsEnabled:C}=dt(),S=fr(),[_,A]=te(s,v=>{const H=P.getConversationTurnAtIndex(v,n),$=n>0?P.getConversationTurnAtIndex(v,n-1):null,B=$?.role===z.User&&$.messages.some(V=>V.metadata?.visually_hide_response_from_conversation);return[H,B]}),{messages:w,messageGroups:d}=_,j=Wa(),G=w[0],I=R(w),{messages:q,visibleMessages:ne,messageGroups:Y,lastMessageToRender:K,doesTurnHaveDelayedMessages:be}=l.useMemo(()=>{const v=j.size===0?-1:d.findIndex(V=>V.type===He?V.groups.some(le=>le.messages.some(Ue=>j.has(Ue?.id))):V.messages.some(le=>j.has(le?.id))),H=v!==-1&&v+1<d.length,$=H?d.slice(0,v+1):d,B=H?$.flatMap(V=>V.type===He?V.groups.flatMap(le=>le.messages):V.messages):w;return{messages:B,visibleMessages:B.filter(or),messageGroups:$,lastMessageToRender:R(B),doesTurnHaveDelayedMessages:v!==-1}},[w,d,j]),Z=l.useMemo(()=>({clientThreadId:s,turnIndex:n,messageId:I?.id}),[s,n,I?.id]),Ot=!1,[ls,cs]=l.useState(!1),[Gt,Vt]=l.useState(!1),zt=l.useContext($a)!=null,W=_.role===z.User,ds=Nt(),ye=rr(s),Fe=Ya(_.gizmoId??ye).data,Pe=St(s),Wt=Ka(s),us=Qa(Pe),$t=Xa(Pe,Wt),ms=bt(),[_e,Yt,Kt,gs,Le,vi,Qt,Xt,Jt,hs,Zt,ie,ps]=te(s,v=>{const H=P.getParentPromptNode(v,G.id),$=H?.message.clientMetadata?.variantsInStreamInfo??(H?.message.metadata?.paragen_variant_choice?void 0:H?.message.metadata?.paragen_variants_info),B=P.getVariantIds(v,G.id),V=P.getCurrentVariantId(v,G.id),le=P.getIsDoNotRemember(v),Ue=V?B.indexOf(V):0,Hn=$&&v?.tree!=null&&B.some(ce=>{const{errType:Rs}=v.tree.getLeafFromNode(ce).message.clientMetadata??{};return Rs!=null&&Rs!=="info"}),Be=P.getConversationTurns(v);return[v?.async_status===Oe.STREAMING,P.isMessageTurnEnded(v,I?.id),Hn,yo(v?.mode,Fe?.gizmo.id),v?.continuingFromSharedConversationId!=null,null,Be.findIndex(ce=>ce.role===z.User)===n,_o(Be,ce=>ce.role===z.User)===n,Be.findIndex(ce=>ce.role===z.Assistant)===n,P.getRequestId(v,I?.id),$,B,Ue,le]});let en="default";const sn=q.some(v=>v.content.content_type===ir.MultimodalText),{layer:tn}=Ke("3119715334"),nn=tn.get("should-enable-skip",!1),{isUnauthenticated:fs}=Rt(),xs=_.messages.map(v=>v.id),ee=l.useRef(null),vs=!m&&(i?.length??0)>2&&i!=="finalAgentTurn"&&a&&T,Se=W?R(ne):void 0,qe=Se?.id,an=l.useCallback(()=>{qe&&(U.logEvent("Edit Prompt",{id:qe,threadId:ge(s)}),X.logEvent("chatgpt_edit_prompt"),cs(!0))},[qe,s]),on=l.useCallback(()=>{cs(!1)},[]),bs=Ja()??!1,{onChangeRating:rn}=Za({clientThreadId:s,currentModelConfig:Pe}),ln=v=>{if(!I)return;rn({nodeId:I.id,messageId:I.id,rating:v});const H=bs&&d.some($=>$.type!==He&&$.messages?.some(bo));U.logEventWithStatsig(v==="thumbsDown"?"Message Feedback Thumbs Down Clicked":"Message Feedback Thumbs Up Clicked","chatgpt_thumb_feedback",{id:I.id,threadId:ge(s),model:r,rating:v,...bs?{isCATriggered:H}:{}}),Vt(!0)},[cn]=l.useState(()=>Date.now()),dn=eo(s),{layer:un}=Ke("109457",{shouldLogExposure:!1}),ys=te(s,v=>dn&&P.getConversationTurns(v).filter(H=>H.role===z.Assistant).length<=un.get("onboarding_inject_cards_position",3)),_s=so(s)?.value,mn=_s===Oe.STREAMING,gn=_s===Oe.REALTIME,Ss=hs!=null,hn=ns(hs),se=!Yt&&hn||be||gn,Ts=Tt(),[pn,js]=l.useState(Ss),Cs=l.useRef(!1),fn=to(s,I),[,xn]=Wn();l.useEffect(()=>{const H=new URLSearchParams(window.location.search).get("message");!(H!=null&&xs.includes(H))||!ee.current||(ee.current.scrollIntoView({behavior:"instant"}),xn(B=>(B.delete("message"),B),{replace:!0,preventScrollReset:!0}))},[]),l.useEffect(()=>{if(m)return;const $=new URLSearchParams(window.location.search).get("message")!=null;if(Cs.current||$||i===void 0||!ee.current){i==="finalAgentTurn"&&a&&ue(s,B=>{B.scrollToMessageId=void 0});return}(xs.includes(i)||i==="finalAgentTurn"&&a)&&(Cs.current=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(ee.current)if(i==="finalAgentTurn"&&a)ee.current.scrollIntoView({behavior:"instant",block:"end"}),ue(s,B=>{B.scrollToMessageId=void 0});else{const B=ee.current.offsetHeight;let V;B>Js?V=Js-B:V=0,ee.current.style.scrollMarginTop=`${V+di}px`,ee.current.scrollIntoView({behavior:"smooth"})}})}))},[i,ee.current]);const{showDebugConversationTurns:vn}=at(),bn=no(),yn=!b&&!Le&&!ds&&!W,_n=K?.author.role===z.Assistant?K:null,Sn=K?.metadata?.system_hints?.includes(ae.Research);ao({isCompletionRequestInProgress:se,isUserTurn:W,message:_n});const{isOpen:Tn}=xr(),jn=oo(),Te=ro(gs),je=!Te&&yn&&a&&Zt?.num_variants_in_stream===2&&ie.length<=2&&!I?.clientMetadata?.inlineComparisonRating&&!Kt,Cn=rs(s),Mn=yt(v=>v.voiceFeedbackThread),pe=a&&(Ss||Cn===Mn),Ms=_e||se||mn,kn=!ls&&!b&&!Le&&!Te&&!Tn&&!ys&&_.role!==z.Developer&&(N?!pe||!Ms:(pn||pe)&&!Ms),wn=q.some(v=>lr(v)===cr.l1239dk1),In=pe&&!se&&!Le&&!b&&!wn&&(E||S||C),Ce=I!=null&&!0&&(!h||$t||x||ms)&&!Te&&!fs&&!ds&&!I.metadata?.b1de6e2_s,En=(!h||ms)&&Ce&&pe&&!_e&&!se,ks=!b&&!((se||_e)&&a)&&ie.length>1&&!je&&!0&&!ys,ws=W&&q.some(v=>io(v)?.shouldHideContent),Nn=W&&Se!=null&&!Te&&!b&&!sn&&!ws&&!fs&&!0&&!Sn,Rn=I!=null&&(I.clientMetadata?.disclaimers??[]).length===0,Is=l.useCallback(v=>{ue(s,H=>{as.setCurrentBranch(H,ie[v])}),U.logEvent("Change Active Node",{intent:"toggle_between"})},[s,ie]),An=lo(_,q,vn),{toggleThreadSidebar:Es}=dr(),Me=I?.id,Fn=l.useCallback(()=>{Me&&Es({type:"retrievalResults",clientThreadId:s,turnIndex:n,messageId:Me})},[Me,Es,s,n]),Pn=l.useMemo(()=>co(_,us,!!ye),[us,ye,_]);if(!An&&!je)return vs?e.jsx("div",{style:Zs}):null;if(A)return null;const Ln=K?.metadata?.followup_prompts?K.metadata.followup_prompts.map(v=>({text:v,type:lt.Reply})):[],qn=K?.metadata?.category_suggestions,Dn=!q.some(v=>Et.getAudioAssetPointers(v).length>0)&&!0&&!ye,Un=!se&&q.some(v=>v.author.role===z.Assistant&&v.metadata?.onboarding?.main_usages),De=q.find(v=>!!v.metadata?.onboarding?.examples)?.metadata?.onboarding?.examples,Ns=!ws&&(!W||k)&&(!a||!se);if(bn&&!a&&ne.length===0)return null;const Bn=!a&&_.messages.some(v=>v.clientMetadata?.isLastMessageFromSharedConversation);return e.jsxs(mo.Provider,{value:Jt,children:[e.jsx(go,{dateHeaderType:g,turn:_}),e.jsxs("article",{className:L("text-token-text-primary w-full",!m&&i==="finalAgentTurn"&&T?"opacity-0":"",{hidden:zt&&Qt}),style:vs?Zs:void 0,ref:ee,dir:"auto","data-testid":`conversation-turn-${n}`,"data-scroll-anchor":!m&&a,children:[e.jsx(ho,{role:_.role}),e.jsxs($e,{verticalPadding:en,horizontalPadding:je?"none":"standard",children:[je?e.jsxs(e.Fragment,{children:[e.jsx(Cr,{isFeedbackEnabled:Ce,variantIds:ie,conversationTurnMountTime:cn,...t}),nn&&e.jsx("div",{className:"mt-4 flex w-full justify-center",children:e.jsxs(Mt,{color:"secondary",className:"text-token-text-primary","data-testid":"paragen-skip-button",onClick:()=>{jt.publish({kind:"requestCompletion",isForSkippingParagen:!0})},children:[e.jsx(po,{className:"text-token-text-secondary me-1"}),e.jsx(D,{id:"IuTr+b",defaultMessage:"Skip"})]})})]}):e.jsx(Ne,{tabIndex:-1,className:"group/turn-messages focus-visible:outline-hidden",onFocus:()=>js(!0),onPointerEnter:()=>js(!0),children:e.jsxs(e.Fragment,{children:[Ot,!W&&!0&&F&&e.jsx(gi,{children:e.jsx(Ze,{messages:q,isUserTurn:W,avatarClassName:c,gizmo:Fe})}),e.jsx("div",{className:Ye({isUserTurn:W}),children:e.jsx("div",{className:"relative flex-col gap-1 md:gap-3",children:e.jsxs(e.Fragment,{children:[null,!W&&!b&&e.jsx(li,{messages:q,clientThreadId:s,gizmoId:Fe?.gizmo.id}),jn&&!W&&e.jsx(ci,{clientThreadId:s,messages:q}),ls&&Se?e.jsx(Xs,{message:Se,clientThreadId:s,onRequestCompletion:o,onExitEdit:on,disabled:Ts}):e.jsx(Je,{allMessages:w,groupedMessagesToRender:Y,allGroupedMessages:d,...t,isUserTurn:W,isFinalUserTurn:Xt,isCompletionRequestInProgress:se,isFeedbackEnabled:Ce,isFinalTurn:a,hasActiveRequest:Ts}),Pn&&e.jsx(kr,{handleShowRetrievalResults:Fn,clientThreadId:s,turnIndex:n,responseComplete:!(se||_e)}),Un&&e.jsx(hr,{clientThreadId:s}),De&&De.length>0&&!se&&e.jsx(pr,{clientThreadId:s,examples:De}),kn&&e.jsx(Jr,{isUserTurn:W,alwaysShow:pe||N,children:W?e.jsx(ei,{activeVariantIndex:ps,clientThreadId:s,numVariants:ie.length,onAnticipateEdit:Xs.prefetch,onChangeIndex:Is,onEnterEdit:an,showCopyButton:Ns,showEditMessageButton:Nn,showPagination:ks,turnIndex:n}):e.jsxs(e.Fragment,{children:[e.jsx(Zr,{activeVariantIndex:ps,clientThreadId:s,conversationMode:gs,lastMessage:I,messages:q,numVariants:ie.length,onChangeIndex:Is,onRate:ln,showCanvasButton:fn&&!0,showCopyButton:Ns,showPagination:ks,showPlayButton:Rn,showRatingButtons:Ce,showRegenerateButton:Dn,isJam:p,turn:_,turnIndex:n}),N&&e.jsx(fo,{clientThreadId:s,message:I,turnIndex:n})]})}),En&&e.jsx(ii,{canShowInlineMessageFeedback:Gt,clientThreadId:s,messageForRating:I,allGroupedMessages:d,currentModelId:r}),In&&e.jsx(Br,{followups:Ln,categorySuggestions:qn,clientThreadId:s,lastMessageId:Me,analyticsMetadata:Z})]})})})]})}),Bn&&e.jsx("div",{className:"mx-auto mt-8 -mb-2 flex justify-center",children:e.jsxs("p",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(xo,{className:"icon-xs me-2"}),e.jsx(D,{id:"threadLayout.sharedConversationPrivateDisclaimer",defaultMessage:"Messages beyond this point are only visible to you"})]})})]})]})]})}const mi=zn.memo(ui),gi=re.div`shrink-0 flex flex-col relative items-end`;function hi(t){const n=P.getConversationTurns(t),a=n.findIndex(o=>o.role===z.Assistant);if(a===-1)return;const s=n[a];for(let o=0;o<s.messageGroups.length;o++)if(s.messageGroups[o].type===Ls.SearchGPTQuery){const c=s.messageGroups.slice(o+1).find(({type:i})=>i===Ls.Text);if(c==null)return;const u=ur(c.messages[0]);if(u?.[0]?.type==="navigation")return{turnIndex:a,navigationCitation:u[0],message:c.messages[0]}}}function pi(t,n){if(n==null||t==null)return t;const a=new Set(t.domains.map(s=>s.url));return{...t,domains:[...t.domains,...n.domains.filter(s=>!a.has(s.url))],safe_urls:[...t.safe_urls??[],...n.safe_urls??[]]}}function fi({clientThreadId:t,prefetchNavlink:n,setPrefetchNavlink:a}){const s=l.use(n),{value:o}=oe("1032814809");l.useEffect(()=>{window.__oai_SSR_NAVLINK&&So.logEvent("Search Tool Page Load Time To Fast Nav SSR",{server_timing:s?.timing},window.__oai_SSR_NAVLINK)},[]),l.useEffect(()=>{s==null&&a(void 0)},[s,a]);const r=l.useMemo(()=>s==null?null:{...s.navlink,domains:s.navlink.domains.map(i=>({...i,subtitle:i.subtitle??i.domain}))},[s]),c=te(t,hi),u=l.useMemo(()=>pi(r,c?.navigationCitation),[c,r]);return s==null||u==null?null:e.jsxs("div",{children:[e.jsx($e,{horizontalPadding:"standard",children:e.jsx(Ne,{children:e.jsx("div",{className:Ye({isUserTurn:!0}),children:e.jsx("div",{className:To(!0),children:e.jsx(jo,{containsImagesOrAttachments:!1,isUserTurn:!0,children:e.jsx(Co,{text:s.query})})})})})}),e.jsx("div",{className:"-mb-10",children:e.jsx($e,{horizontalPadding:"standard",children:e.jsx(Ne,{children:e.jsxs("div",{className:Ye({isUserTurn:!1}),children:[e.jsx(yr,{clientThreadId:t,turnIndex:c?.turnIndex??2,nextMessage:c?.message,navigationCitation:u}),o?e.jsxs("div",{className:"text-token-text-secondary relative -top-2 flex justify-end gap-2 font-mono text-xs",children:[e.jsxs("div",{elementtiming:"navlink",children:["server: ",s.timing,"ms"]}),e.jsx(xi,{})]}):null]})})})}),e.jsx(Mo,{scriptSrc:"requestAnimationFrame(()=>window.__oai_SSR_NAVLINK=window.__oai_SSR_NAVLINK||performance.now());"})]})}function xi(){const[t,n]=l.useState(null);return l.useEffect(()=>{const a=new PerformanceObserver(s=>{s.getEntries().forEach(o=>{if(o.identifier==="navlink"){const r=o.renderTime;n(c=>c??r)}})});return a.observe({type:"element",buffered:!0}),()=>a.disconnect()},[]),t==null?null:e.jsxs("span",{children:["render: ",t,"ms"]})}function Fi({onRequestCompletion:t,clientThreadId:n,scrollContainerRef:a,prefetchNavlink:s,setPrefetchNavlink:o}){const[r,c,u,i]=te(n,d=>[d?.mode,P.getConversationTurnIds(d),d?.conversationOrigin===mr.APPLE,d?.scrollToMessageId]),{isNewScrollEnabled:g}=_t(),m=ko(),f=wo(),x=Io(),[b]=Eo(),h=No(),[T]=Ro(),k=St(n),M=m.store.useContentAreaDimensions(Ao.Header,d=>d?.height?d.height:void 0),N=Fo(k.id),F=r?.kind===Xe.GizmoMagicCreate?"bg-token-main-surface-primary text-token-text-primary":N;l.useEffect(()=>{f&&(X.logEvent("chatgpt_continue_conversation_page_loaded"),U.logEvent("Continue Conversation: Page Loaded"),X.logEvent("chatgpt_conversation_share_page_loaded"),U.logEvent("Share Public Chat: Shared Conversation Loaded"))},[f]);const y=l.useCallback(()=>{g||x({behavior:"smooth"})},[g,x]),[p,E]=l.useState(!1),C=p||!1,S=Po(n),_=l.useRef(null),A=Lo(n),w=qo();return e.jsxs("div",{onCopy:S,className:L("@thread-xl/thread:pt-header-height mt-1.5 flex flex-col text-sm",w&&"keyboard-open:pb-[calc(var(--composer-height,100px)+var(--screen-keyboard-height,0))]",M?null:!g&&"pb-25"),style:{paddingBottom:M},children:[s?e.jsx(gr,{name:"prefetch-navlink",onError:d=>{Qe.addError("Error with prefetch navlink",{error:d}),o(void 0)},children:e.jsx(l.Suspense,{fallback:null,children:e.jsx(fi,{clientThreadId:n,prefetchNavlink:s,setPrefetchNavlink:o})})}):null,f&&e.jsxs(e.Fragment,{children:[e.jsx(Ne,{children:e.jsx("p",{className:"text-xs text-gray-500",children:e.jsx(D,{id:"threadLayout.sharedConversationCopyDisclaimer",defaultMessage:"This is a copy of a conversation between ChatGPT & Anonymous."})})}),e.jsx("div",{className:"text-token-text-primary text-center text-xs font-semibold",children:e.jsx("button",{onClick:()=>{ht.openModal(Do.ReportConversation),X.logEvent("chatgpt_conversation_share_report_content_clicked",null,{location:"Static Shared Thread Page"}),U.logEvent("Share Public Chat: Report Content Clicked",{location:"Dynamic Shared Thread Page"})},children:e.jsx(D,{id:"thread.reportSharedConversation",defaultMessage:"Report content"})})})]}),c.map((d,j)=>e.jsx(mi,{isFinalTurn:j===c.length-1,turnIndex:j,clientThreadId:n,onRequestCompletion:t,currentModelId:k.id,avatarClassName:F,scrollToBottom:g?void 0:y,scrollToMessageId:g?void 0:i,dateHeaderType:A(j),showAvatar:void 0},d)),!g&&e.jsxs(e.Fragment,{children:[a?.current&&e.jsx(Uo,{setIsScrolledToEdge:d=>{E(d)},options:{root:a.current,threshold:0,rootMargin:"0%"}},"threadBottomEdgeScrollObserver"),e.jsx("div",{ref:_}),u&&b&&!T&&e.jsx(et,{className:L("translate-y-[10px] md:translate-y-[30px]"),onClick:()=>{X.logEvent("chatgpt_thread_scroll_to_top"),h({behavior:"smooth"})},children:e.jsx(Bo,{className:"icon-md text-token-text-primary"})}),e.jsx(ve,{children:C&&e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15,ease:"easeInOut"},children:e.jsx(et,{className:L(M?null:"bottom-8"),style:{bottom:M},onClick:()=>{X.logEvent("chatgpt_thread_scroll_to_bottom"),_.current?.scrollIntoView({behavior:"smooth",block:"end"})},children:e.jsx(Ho,{className:"icon-md text-token-text-primary"})})})})]})]})}const et=re.button`cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-token-text-secondary border-token-border-default end-1/2 translate-x-1/2 bg-token-main-surface-primary w-8 h-8 flex items-center justify-center`;export{Fi as T};
//# sourceMappingURL=l79p1rsauk0lwxt6.js.map
