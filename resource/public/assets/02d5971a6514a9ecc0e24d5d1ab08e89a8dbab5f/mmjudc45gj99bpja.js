import{j as e,f as B,r as l,n as T,M as A}from"./msupklk377u8vx8o.js";import{fP as O,ao as R,fC as V,h as K,fA as q,ce as _,d as P,jB as H,I as W,jC as G}from"./idf4u2jy0wx0pvap.js";import{b as U,S as Y,C as z,W as L}from"./mxye9dnv7ug9w78j.js";import{c as j}from"./i3bl95k8z8nuf4dv.js";import{I as Z}from"./hykg4shppjdez6do.js";function $({triggerText:t,toolTip:a,ariaLabel:s,Icon:c,truncate:o=!0}){return e.jsx(O,{className:"border-token-border-default text-token-text-primary bg-token-bg-primary hover:bg-token-bg-tertiary rounded-full border px-2 py-1","aria-label":s,children:e.jsx(R,{label:a,className:"text-sm font-medium",children:e.jsxs("div",{className:"flex max-w-full items-center gap-1.5 ps-2",children:[c,e.jsx("span",{className:j("hidden sm:block",o?"max-w-[8rem] truncate md:max-w-[10rem]":"w-fit"),children:t}),e.jsx(V,{"aria-hidden":!0,className:"icon-sm"})]})})})}function J({children:t,className:a,onClick:s,isSelected:c,isActive:o,isVirtualHover:i=!1,label:f,isDisabled:n,tooltipLabel:u,isSubMenuTrigger:d,noDefaultHoverState:m,as:v="button",truncateLabel:x,infoIcon:p,infoLink:M,icon:g,...w}){const y=B();let h=e.jsx(e.Fragment,{});t?h=e.jsx("div",{className:"flex flex-1 items-center gap-4",children:t}):f&&(h=e.jsxs("div",{className:j("flex items-center gap-3",x?"w-0 flex-1":"w-full"),children:[g&&(l.isValidElement(g)?g:e.jsx(Q,{icon:g})),f&&e.jsx("div",{className:j("flex flex-col items-start px-1 py-1",n&&"text-token-text-quaternary pointer-events-none",x&&"w-full"),children:e.jsx("div",{className:j("flex items-center gap-2 text-start text-sm",x&&"w-full"),children:f})})]}),u&&(h=e.jsx(R,{sideOffset:-10,label:u,className:"w-full",children:h})));const C=e.jsxs("div",{className:"min-w-[18px] items-center justify-center",children:[c&&e.jsx(K,{className:j("icon-md","color:var(--tint-color,#0285FF)"),"aria-label":y.formatMessage({id:"wham.codexMenuRow.selected",defaultMessage:"Selected"})}),p&&M&&e.jsx("a",{href:M,target:"_blank",rel:"noopener noreferrer",children:p}),d&&e.jsx(q,{className:"icon-md text-token-text-tertiary w-7","aria-label":y.formatMessage({id:"wham.codexMenuRow.openSubmenu",defaultMessage:"Open submenu"})})]}),S=j("flex cursor-pointer items-center gap-4 rounded-lg px-2 py-1.5 pe-3",o&&"bg-black/5 dark:bg-white/5",!m&&"hover:bg-black/5 dark:hover:bg-white/5",i&&"bg-black/5 dark:bg-white/5",a);if(v==="div"){const b=w;return e.jsxs("div",{...b,className:S,children:[h,C]})}const k=w;return e.jsxs("button",{type:"button",...k,onClick:b=>{b.persist(),requestAnimationFrame(()=>{s?.(b)})},className:S,children:[h,C]})}function Q({icon:t}){const a=t;return e.jsx("div",{className:"text-token-text-secondary flex h-5 w-5 items-center justify-center",children:e.jsx(a,{className:"h-5 w-5 shrink-0","aria-label":""})})}const X=({items:t,onSelect:a,keyExtractor:s})=>{const[c,o]=l.useState(null),[i]=l.useState(new Map);return{hoveredId:c,setHoveredId:o,getItemRef:n=>u=>{const d=s(n);return u&&i.set(d,u),()=>{i.delete(d)}},itemRefs:i,onKeyDown:n=>{const u=n.key==="ArrowDown"||n.key==="n"&&n.ctrlKey,d=n.key==="ArrowUp"||n.key==="p"&&n.ctrlKey;if(!(u||d||n.key==="Enter"))return;if(n.preventDefault(),n.key==="Enter"){c&&a(c);return}const m=t.findIndex(p=>s(p)===c),v=_(m-(d?1:-1),0,t.length-1),x=s(t[v]);i.get(x)?.scrollIntoView({behavior:"instant",block:"nearest"}),o(x)}}};function ee(t,a){const[s,c]=l.useState(t),o=l.useRef(P(i=>c(i),a));return l.useEffect(()=>(o.current=P(i=>{c(i)},a),()=>{o.current?.cancel()}),[a]),l.useEffect(()=>{o.current?.(t)},[t]),s}function I(t){return t.length>18?`â€¦${t.slice(-18)}`:t}function ce({environment:t}){const a=B(),{branch:s,setBranch:c}=U(),[o,i]=l.useState(""),[f,n]=l.useState(!1),u=l.useRef(null),d=()=>n(!1),m=l.useRef(t.repos[0]??null);return l.useEffect(()=>{(m.current!==t.repos[0]||!s)&&(m.current=t.repos[0],c(E(t)))},[s,c,t]),e.jsx("div",{className:"items-center rounded-full",children:e.jsxs(H,{open:f,onOpenChange:n,children:[e.jsx($,{triggerText:I(s??"")??a.formatMessage({id:"wham.codexBranchPopover.selectABranch",defaultMessage:"Select a Branch"}),toolTip:I(s??"")===s||f?"":s?.length?s:a.formatMessage({id:"wham.codexBranchPopover.searchForYourBranchTooltip",defaultMessage:"Search for your branch"}),ariaLabel:a.formatMessage({id:"wham.codexBranchPopover.searchForYourBranchAria",defaultMessage:"Search for your branch"}),Icon:e.jsx(Y,{"aria-hidden":!0,className:"icon-sm"}),truncate:!1}),e.jsx(z,{align:"start",sideOffset:12,isOpen:f,closePopover:d,popoverContentRef:u,children:e.jsx(te,{environment:t,repoId:m,searchQuery:o,setSearchQuery:i,setBranch:c,selectedBranch:s??"",closePopover:d})})]})})}function te({environment:t,repoId:a,setBranch:s,selectedBranch:c,searchQuery:o,setSearchQuery:i,closePopover:f}){const n=B(),u=l.useRef(null),d=ee(o,300),{data:m,isLoading:v,fetchNextPage:x,hasNextPage:p,isFetchingNextPage:M,error:g}=T({queryKey:["searchBranches",a.current,d],enabled:!!a.current,initialPageParam:null,queryFn:({pageParam:r})=>L.searchBranchesByRepository(a.current??"",d,G,r??null),getNextPageParam:r=>r?.cursor??null}),w=l.useMemo(()=>{const r=m?.pages?.flat().map(D=>D.items.flatMap(F=>F.branch))?.flat()??[],N=E(t);return N&&!r.includes(N)&&r.unshift(N),r},[m,t]),y=r=>{s(r),f()},h=l.useMemo(()=>o?.trim()?w.filter(r=>r.toLowerCase().includes(o.toLowerCase())):w??[],[o,w]),{hoveredId:C,setHoveredId:S,onKeyDown:k,getItemRef:b}=X({items:h,keyExtractor:r=>r,onSelect:y});return l.useEffect(()=>{u.current&&u.current.focus()},[]),e.jsxs("div",{className:"bg-token-bg-primary flex max-h-[400px] w-72 flex-col gap-2 rounded-lg p-2",children:[e.jsx(W,{ref:u,className:"w-full rounded-sm border-none px-2 py-1 text-sm focus:ring-0 focus:ring-offset-0 focus:outline-hidden",type:"text",autoComplete:"off",name:"search-branch",value:o,onKeyDown:k,onChange:r=>i(r.target.value),placeholder:n.formatMessage({id:"wham.codexBranchPopover.branch",defaultMessage:"Enter a branch"}),ariaLabel:n.formatMessage({id:"wham.codexBranchPopover.createBranchAria",defaultMessage:"Create a new branch"})}),e.jsxs("div",{className:"min-h-18 w-full overflow-y-auto",children:[h?.map(r=>{const N=r===c;return e.jsx(J,{className:"w-full",as:"button",onMouseEnter:()=>S(r),isVirtualHover:C===r,ref:b(r),onClick:()=>{y(r)},isSelected:N,label:r},r)}),g?e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(A,{id:"wham.branchPopover.error",defaultMessage:"Error loading branches"})}):null,e.jsx(Z,{hasNextPage:p,fetchNextPage:x,isFetchingNextPage:M||v})]})]})}function E(t){for(const a of t.repos){const s=t.repo_map?.[a];if(s?.default_branch)return s.default_branch}return"main"}export{$ as C,ce as a,J as b,E as g,X as u};
//# sourceMappingURL=mmjudc45gj99bpja.js.map
