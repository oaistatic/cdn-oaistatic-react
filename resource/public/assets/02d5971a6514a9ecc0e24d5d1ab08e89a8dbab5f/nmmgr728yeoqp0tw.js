import{j as t,r as d,t as Q,a9 as R,a8 as O}from"./msupklk377u8vx8o.js";import{dn as j,dp as f,an as y,dq as C,dr as U,ds as X,dt as B,du as $,am as E,ar as L,dv as H,a8 as J,dw as K,dx as V}from"./idf4u2jy0wx0pvap.js";import{bQ as Y,bM as T,bC as M,an as h,g as Z,r as ee,av as te,l as P,dc as ne,cX as se,ax as W,c as re,F as ae,cG as oe}from"./i3bl95k8z8nuf4dv.js";import{g as ie,u as ce,a as le,b as z}from"./i3xeaua08fnq6vw7.js";function ue(e,n){const a=W.getTurnContentReferences(e,n),r=J(a),o=de(e,n);return K(r.concat(o),"content_url")}function de(e,n){const a=W.getConversationTurnAtIndex(e,n).messages;return a?oe(a.flatMap(r=>r.metadata?.image_results??[])).map(r=>({...r,thumbnail_url:r.thumbnail_url.replace(/^http:\/\//,"https://"),content_url:r.content_url.replace(/^http:\/\//,"https://")})):[]}function me(e,n,a,r){const{product:o}=H({thread:e,messageId:n,contentReferenceStartIndex:a,productIndex:r});return!o||!o.image_urls?[]:o.image_urls.map(c=>({url:c,content_url:c,thumbnail_url:c,title:o.title,content_size:{width:0,height:0},thumbnail_size:{width:0,height:0}}))}function _e({clientThreadId:e}){const n=j.useCurrentImage();if(!n)return null;const{image:a,source:r,analyticsMetadata:o,contentReferenceStartIndex:c,productIndex:l}=n;if(r==null||e==null||o?.turnIndex==null)return t.jsx(p,{image:a,analyticsMetadata:{}});const i=Y(e),w=r===f.ProductDetails?me(i,o.messageId,c,l):ue(i,o.turnIndex);return t.jsx(p,{image:a,group:w,analyticsMetadata:o,groupSource:r})}function ke(){const e=j.useCurrentImage();if(!e)return null;const{image:n,source:a}=e;if(a==null)return t.jsx(p,{image:n,analyticsMetadata:{}});switch(a){case f.ImagesTab:return t.jsx(xe,{image:n});case f.Turn:return t.jsx(he,{image:n});default:return null}}function xe({image:e}){const{imageResults:n}=le();return t.jsx(p,{image:e,group:n,groupSource:f.ImagesTab,analyticsMetadata:{}})}function he({image:e}){const{imageResults:n}=ce();return t.jsx(p,{image:e,group:n,groupSource:f.Turn,analyticsMetadata:{}})}const D=ae.div`grow flex items-start p-8`,ge={enter:e=>({x:e>0?1e3:-1e3,opacity:0}),center:{zIndex:1,x:0,opacity:1},exit:e=>({zIndex:0,x:e<0?1e3:-1e3,opacity:0})},fe=1e4,pe=(e,n)=>Math.abs(e)*n;function p({image:e,group:n,groupSource:a,analyticsMetadata:r}){const o=d.useRef(null),c=e.attribution??y(e.url),l=j.useCurrentImage(),i=j.useStore(),w=l?.mountDirection;d.useEffect(()=>{window?.history?.state?.imageModalOpen||window.history.pushState({imageModalOpen:!0},"",window.location.href);const s=()=>{window?.history?.state?.imageModalOpen||i.setCurrentImage(void 0)};return window.addEventListener("popstate",s),()=>window.removeEventListener("popstate",s)},[i]);const S=e.content_url.replace(/^http:\/\//,"https://"),u=n?.findIndex(s=>T(e,s))??0,m=n?.length??1,x=u!=null&&m>1,g={...M(r),url:e.url,link_type:"text",section:"image",section_location:"response",section_index:(u+1).toString()};d.useEffect(()=>{o.current!==e.url&&(o.current=e.url,h.logEventWithStatsig("Search Content Reference Shown","search_content_reference_shown",{...M(r),type:"full_screen_image",url:e.url,image_url:S}),h.logEventWithStatsig("link_action","link_action",{...g,action:"show"}))},[S]);const v=()=>{window.history.go(-1),i.setCurrentImage(void 0)},I=d.useCallback(()=>{!x||n==null||i.setCurrentImage({image:n[(u+1)%n.length],source:a,mountDirection:C.FromRight,analyticsMetadata:r,contentReferenceStartIndex:l?.contentReferenceStartIndex,productIndex:l?.productIndex})},[x,n,i,u,a,r,l]);Q({queries:(n??[]).map(s=>ie(s.thumbnail_url))});const b=d.useCallback(()=>{!x||n==null||i.setCurrentImage({image:n[(u-1+n.length)%n.length],source:a,mountDirection:C.FromLeft,analyticsMetadata:r,contentReferenceStartIndex:l?.contentReferenceStartIndex,productIndex:l?.productIndex})},[x,n,i,u,a,r,l]),G=Z(),_=ee(G,"2804795149"),q=d.useMemo(()=>n??[e],[n,e]);return d.useEffect(()=>{if(!_)return te(document,{keydown:s=>{s.key==="ArrowRight"?I():s.key==="ArrowLeft"&&b()}})},[_,I,b]),_?t.jsxs(U,{forceDarkMode:!0,imageList:q,initialIndex:u,onClose:v,children:[x&&t.jsx(X,{children:s=>t.jsxs("div",{className:"text-token-text-tertiary shrink-0 px-4 py-2",children:[(n?.findIndex(k=>T(s,k))??0)+1," /"," ",m]})}),t.jsx(B,{children:s=>t.jsx(F,{image:s,isNewLightbox:!0})}),t.jsx($,{children:s=>t.jsx("div",{className:"flex w-full justify-start",children:t.jsx("div",{className:"w-fit rounded-xl backdrop-blur-xl",children:t.jsx(E,{onClick:()=>{h.logEventWithStatsig("link_action","link_action",{...g,action:"click"})},onMouseEnter:()=>{h.logEventWithStatsig("link_action","link_action",{...g,action:"hover"})},href:s.is_proxied_image?s.content_url:s.url,className:"flex min-h-20 w-fit shrink-0 items-center gap-8 px-4 py-2 text-sm hover:opacity-70",children:t.jsxs("div",{className:"flex grow flex-col gap-0.5 overflow-hidden pe-2",children:[t.jsxs("div",{className:"text-token-text-tertiary flex items-center gap-2 truncate",children:[t.jsx(L,{url:s.content_url,className:"rounded-sm",size:16}),c??y(s.url)]}),t.jsx("div",{className:"truncate font-semibold text-white",children:s.title})]})})})})})]}):t.jsx(R,{children:e&&t.jsx(P.Root,{isOpen:!0,onClose:v,testId:"modal-image-result",children:t.jsx(P.Overlay,{children:t.jsxs(ne,{className:"flex h-full w-full flex-col bg-black/95",children:[t.jsxs("div",{className:"relative flex w-full grow justify-center overflow-hidden",children:[t.jsxs("div",{className:"absolute end-4 top-4 flex items-center sm:end-6 sm:top-6",children:[x&&t.jsxs("div",{className:"text-token-text-tertiary shrink-0 px-4 py-2",children:[u+1," / ",m]}),t.jsx("button",{onClick:s=>{s.stopPropagation(),v()},className:"flex h-9 w-9 items-center justify-center outline-hidden hover:opacity-70",children:t.jsx(se,{className:"h-6 w-6 text-gray-400"})})]}),m>1&&t.jsx(D,{className:"cursor-w-resize",onClick:s=>{s.stopPropagation(),b()}}),t.jsx(R,{initial:!1,custom:w,children:t.jsx(O.div,{variants:ge,custom:w??0,className:"absolute top-24 bottom-4",initial:"enter",animate:"center",exit:"exit",transition:{x:{type:"spring",stiffness:300,damping:30},opacity:{duration:.2}},drag:m>1?"x":!1,dragConstraints:{left:0,right:0},dragElastic:1,onDragEnd:(s,{offset:k,velocity:A})=>{const N=pe(k.x,A.x);N<-1e4?I():N>fe&&b()},children:t.jsx(F,{image:e})},u)}),m>1&&t.jsx(D,{className:"cursor-e-resize",onClick:s=>{s.stopPropagation(),I()}})]}),t.jsx(E,{onClick:()=>{h.logEventWithStatsig("link_action","link_action",{...g,action:"click"})},onMouseEnter:()=>{h.logEventWithStatsig("link_action","link_action",{...g,action:"hover"})},href:e.is_proxied_image?e.content_url:e.url,className:"flex min-h-20 w-full shrink-0 items-center gap-8 px-6 pt-8 pb-3 text-sm hover:opacity-70 sm:px-8 sm:pb-8",children:t.jsxs("div",{className:"flex grow flex-col gap-0.5 overflow-hidden pe-2",children:[t.jsxs("div",{className:"text-token-text-tertiary flex items-center gap-2 truncate",children:[t.jsx(L,{url:e.content_url,className:"rounded-sm",size:16}),c??y(e.url)]}),t.jsx("div",{className:"truncate font-semibold text-white",children:e.title})]})})]})})})})}function F({image:e,isNewLightbox:n=!1}){const a=e.content_url.replace(/^http:\/\//,"https://"),r=e.thumbnail_url.replace(/^http:\/\//,"https://"),o=e.content_size.width/e.content_size.height,{isError:c}=z(a),{isError:l}=z(r),i=e.is_proxied_image?e.url:c?r:a;return!l||!c||e.is_proxied_image?t.jsx(O.img,{src:i,alt:e.title,style:{backgroundImage:r?`url(${r})`:void 0,backgroundSize:"contain",aspectRatio:o,backgroundPosition:"center",backgroundRepeat:"no-repeat"},initial:{opacity:0},animate:{opacity:1},className:re(n?"h-full max-w-full object-contain":"h-full max-w-[100vw] object-contain sm:max-w-[calc(100vw-10rem)]")}):t.jsx("div",{className:"flex h-full grow items-center justify-center",children:t.jsx("div",{className:"flex h-96 w-96 items-center justify-center bg-white/10",children:t.jsx(V,{className:"text-token-text-tertiary h-12 w-12"})})})}export{_e as ImageLightbox,ke as ImageLightboxSearchGPT};
//# sourceMappingURL=nmmgr728yeoqp0tw.js.map
