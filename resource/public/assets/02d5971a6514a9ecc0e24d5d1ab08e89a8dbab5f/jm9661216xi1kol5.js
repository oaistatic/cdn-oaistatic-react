const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/hhf5b3nino77v3be.js","assets/msupklk377u8vx8o.js","assets/idf4u2jy0wx0pvap.js","assets/i3bl95k8z8nuf4dv.js","assets/root-en2soewk.css","assets/conversation-small-irmw3ffz.css","assets/crzx5wntyeiu3q18.js","assets/h845c9skq3wadruq.js","assets/devzq0wbg16c6e5z.js","assets/ev39bkx1q3tpviat.js","assets/gc51ish3otzvnj1w.js","assets/hwl3hzno2kq7obfl.js","assets/hmii3551qscelikg.js","assets/i3xeaua08fnq6vw7.js","assets/gwmfzjrffpu4d2tx.js"])))=>i.map(i=>d[i]);
import{r as f,d as hn,j as e,g as Be,f as K,L as nl,M as P,a8 as J,n as ol,aj as al,a9 as ut,o as il,D as rl}from"./msupklk377u8vx8o.js";import{d as jt}from"./gc51ish3otzvnj1w.js";import{n$ as _t,W as pe,bK as Ha,kt as xn,dM as Ua,gJ as _s,qy as Ga,rX as bn,tW as za,b$ as rt,ha as ll,dw as cl,Q as js,h9 as ul,tX as dl,gy as ml,fg as pl,eV as fl,tY as qt,tZ as Ye,V as Yt,t_ as Sn,t$ as Se,u0 as gl,u1 as hl,ao as $t,u2 as lt,u3 as xl,fH as Cn,ev as F,dK as aa,c6 as Kt,u4 as Wa,u5 as bl,d5 as ct,d as on,u6 as yn,u7 as ks,u8 as Va,fB as Sl,eS as vn,eP as qa,eQ as wn,eR as _n,u9 as Cl,ua as yl,ie as jn,ub as Ya,fR as vl,j5 as wl,uc as ia,ud as ra,ue as _l,le as kn,r9 as jl,uf as kl,ug as $a,rh as Rl,uh as Ka,ui as Ml,uj as Al,uk as El,j3 as Qa,hT as Rn,ho as Pl,ul as Tl,um as Nl,un as Bl,jL as Rs,db as Ms,M as Mn,uo as Il,up as hs,oY as Dl,qq as Ol,b9 as Ne,a_ as me,a$ as An,am as Ll,uq as Xa,p7 as Fl,ur as Hl,us as Ul,ut as Gl,i9 as Te,bH as Gt,d4 as En,uu as zl,uv as Wl,uw as Vl,ic as xs,li as Ja,ux as ql,uy as Yl,uz as $l,fA as Kl,uA as Za,p5 as As,ib as Ql,uB as Xl,m6 as Ce,uC as Jl,uD as Zl,uE as ec,uF as tc,uG as St,uH as Ut,uI as sc,uJ as nc,uK as oc,E as an,hY as Z,fQ as ac,da as ic,uL as rc,uM as lc,uN as cc,uO as uc,uP as dc,kd as Ks,uQ as la,uR as mc,uS as pc,uT as fc,uU as gc,uV as hc,uW as xc,rQ as Qs,B as Pn,bz as ei,bA as ti,pw as bc,o7 as Sc,oa as Cc,m0 as yc,f6 as vc,uX as wc,R as ye,uY as _c,qY as zt,uZ as jc,mR as kc,u_ as Rc,u$ as I,v0 as si,v1 as Mc,v2 as Ac,v3 as Ec,v4 as Pc,v5 as Tc,v6 as Nc,v7 as Bc,v8 as Ic,v9 as Dc,va as Oc,vb as Lc,vc as Fc,vd as Hc,ve as Uc,vf as Gc,vg as zc,vh as Wc,vi as Vc,vj as qc,vk as Yc,vl as $c,hs as Kc,vm as Qc,vn as Xc,vo as Jc,vp as Zc,vq as eu,vr as tu,vs as su,vt as nu,vu as ou,vv as au,vw as iu,vx as ru,vy as lu,vz as cu,vA as uu,vB as du,vC as mu,vD as pu,vE as fu,vF as gu,vG as hu,lk as xu,ll as ni,lj as Ct,eI as bu,ni as ca,d9 as Tn,oO as oi,de as gs,df as Su,vH as Nn,vI as Bn,vJ as Cu,dg as at,vK as bs,o$ as rn,fq as In,dc as Dn,dd as On,ea as Ln,nh as Fn,eb as Hn,nj as yu,jw as vu,pb as ai,ia as Ie,vL as wu,vM as _u,pB as ju,h as ku,hX as Un,h_ as Wt,vN as Ru,vO as Mu,vP as Ss,j6 as Au,vQ as ii,vR as ri,vS as li,vT as ci,vU as Lt,lm as Eu,vV as Pu,n1 as Cs,n0 as ui,vW as Tu,vX as Nu,vY as Bu,vZ as Iu,v_ as Du,v$ as Ou,d8 as Gn,A as zn,j1 as di,w0 as ln,w1 as Lu,fF as Fu,a2 as Hu,w2 as ys,fG as mi,w3 as pi,fI as Uu,w4 as fi,fJ as Gu,id as zu,kB as Wn,kD as Vn,kA as Wu,ql as gi,w5 as cn,w6 as Vu,eL as hi,aG as qu,w7 as Yu,w8 as ua,w9 as $u,oH as qn,wa as xi,wb as bi,fP as Ku,kC as Qu,hK as Xu,wc as Ju,wd as Zu,we as ed,wf as da,wg as td,wh as Si,wi as sd,wj as nd,wk as od,gI as Ci,wl as yi,wm as vi,wn as ad,o_ as id,wo as un,wp as rd,iZ as ma,e as ld,fo as cd,fr as ud,X as dd,cT as md,wq as pd,qG as fd,wr as gd,ws as hd,wt as xd,wu as bd,wv as Sd,lG as Cd,ww as pa,k_ as yd,lB as vd,wx as Xs,wy as wd,wz as _d,wA as jd,mb as fa,lJ as kd,wB as Rd,wC as Md,cv as Ad,wD as Ed,y as Pd,U as ga,fO as Td,mu as Nd,mz as Bd,aH as Id,wE as Dd,wF as Od,wG as Ld,wH as Fd,wI as Hd,fE as Ud,wJ as ha,wK as xa,wL as ba,mr as Gd,wM as zd,wN as Wd,wO as Vd,wP as qd,wQ as Yd,wR as $d,ed as Kd,oM as Qd,kI as Sa,wS as Xd,o0 as wi,jR as Jd,wT as Zd,wU as em,O as _i,jY as tm,wV as sm,wW as nm,is as om,p9 as am,wX as im,wY as rm,iH as lm,oL as cm,jy as um,nr as Js,ns as Zs,jx as dm}from"./idf4u2jy0wx0pvap.js";import{s as kt,hr as ji,bo as ce,g as Ke,r as yt,ar as Re,cD as vt,H as $e,an as N,gP as te,ax as ee,bQ as ke,h6 as ki,bY as Ri,bg as M,bj as ie,hs as Mi,gn as dn,bI as Qt,c as W,F as Yn,fk as Xt,ht as $n,dN as Ai,m as Qe,b as Ca,q as Vt,p as oe,bJ as mm,fl as Kn,bD as Ei,bs as Pe,fb as pm,d$ as vs,bO as fm,cX as Pi,bn as Jt,fP as gm,bR as hm,B as xm,bv as bm,dE as Ti,hu as Ni,c4 as it,hv as Sm,ci as ya,D as Cm,fd as Bi,d2 as Ii,ac as ym,ak as wt,az as vm,v as Qn,_ as Xn,al as en,u as mn,bW as Di,c2 as wm,hw as Es,d_ as Oi,d5 as Li,bM as _m,hx as jm,G as km,n as va,dS as qe,hy as wa,f1 as Jn,ae as Rm,ai as Mm,E as Am,bE as Em,d as Pm,b2 as Tm,gz as Zn,bu as Nm,gM as Bm,ew as Im,am as Ft,aB as _a,hz as Dm,hA as Om,hB as Lm,dw as Fm,dx as Hm,aw as Um,bG as Gm,bH as zm,cC as ja,g2 as Wm,g3 as Vm,ay as qm,eN as Ym,hC as $m}from"./i3bl95k8z8nuf4dv.js";import{P as Km,u as Qm}from"./iaogn9yqy8ycbrvh.js";import{u as Xm}from"./bjlvmvwbynia41h5.js";import{u as Jm}from"./igftvtdft8b4phs3.js";import{C as Ps,c as Zm,A as ep,d as Fi}from"./o2t4lszmsavslsdu.js";import{G as Hi}from"./gd7xfxa2yqt151v4.js";import{P as eo,B as Ui,C as to,F as Gi,g as tp,V as sp,a as np,b as so,T as op}from"./en1ee50tqvrjf3xp.js";import{G as ap}from"./k4oexpwbiepmd1cd.js";import{e as ip,f as rp,g as ps,h as lp,P as cp,i as up}from"./hwl3hzno2kq7obfl.js";import{u as no}from"./hstsg1tnsukf0vw2.js";import{u as zi,a as dp,I as mp,R as pp,b as ka,C as fp,H as Ra,B as gp,F as Ma,c as hp,T as xp,S as bp,d as Aa,e as Sp}from"./ev39bkx1q3tpviat.js";import{b as Cp}from"./etqfvs5ggajp1a11.js";const yp=({clientThreadId:t,rateLimitInfo:s,onDismiss:n,onInteract:o,onMount:a})=>{const{name:r,title:i,call_to_action:d,description:l}=s,u=kt(),m=_t(!0),{updateSystemHint:c}=pe(),p=jt(),b=_t(!1),h=ji(),g=ce(t,ee.getIsNewConversation),S=u?.planType??"unknown",v=Ke(),y=yt(v,"3809605125"),k=h&&"block_reason"in h?h.block_reason:null,A="banner_description",R=f.useMemo(()=>({type:r||"unknown",location:A,plan_type:S,is_new_conversation:g,is_hard_block:!!h,hard_block_reason:k??"",call_to_action:d}),[r,A,S,g,h,k,d]),E=hn(),w=Ha(),{isUnauthenticated:_}=Re(),T=xn(),D=Ua(vt.signUpButtonText),x=_s(),V=Ga({clientThreadId:t}),{layer:G}=$e("1368081792"),B=q=>{switch(q){case te.AUTHENTICATE:return{text:T?vt.logInButtonText:D,onClick:()=>{w({authType:T?"login":"signup",callback:L=>{T?N.logLogInButtonClicked({location:`Rate limit banner - ${r}`,provider:L}):N.logSignUpButtonClicked({location:`Rate limit banner - ${r}`,provider:L})}})}};case te.AUTHENTICATE_SECONDARY:return{text:T?D:vt.logInButtonText,onClick:()=>{w({authType:T?"signup":"login",callback:L=>{T?N.logSignUpButtonClicked({location:`Rate limit banner - ${r}`,provider:L}):N.logLogInButtonClicked({location:`Rate limit banner - ${r}`,provider:L})}})}};case te.GET_PLUS:return{text:bt.getPlusButton,onClick:()=>{N.logRateLimitGetPlusButtonClicked(R),_?w({authType:T?"login":"signup",shouldOpenPaymentModalOnAuth:!0,callback:L=>{T?N.logLogInButtonClicked({location:"Rate limit banner Get Plus upsell",provider:L}):N.logSignUpButtonClicked({location:"Rate limit banner Get Plus upsell",provider:L})}}):rt(E,"Prompt textarea rate limit banner")}};case te.NEW_CHAT:return{text:bt.newChatButton,onClick:()=>{m({modelId:"",location:A})}};case te.PAID_USER_O3_MINI_HIGH:{const L=ee.getCurrentLeafId(ke(t)),se=()=>{N.logEventWithStatsig("In Context Upsell Banner O3 Mini High CTA Clicked","chatgpt_in_context_upsell_banner_o3_mini_high_cta_clicked",{location:G.get("should_change_model_picker",!0)?"In-context upsell o3-mini-high for Plus banner - Try it button":"In-context upsell o3-mini-high for Plus (no model switch) banner - Try it button",eventProperties:R}),G.get("should_change_model_picker",!0)&&b(y?{modelId:"o4-mini-high",location:"In-context upsell o4-mini-high for Plus banner - Try it button"}:{modelId:"o3-mini-high",location:"In-context upsell o3-mini-high for Plus banner - Try it button"}),V(y?{sourceEvent:new Event("click"),nodeId:L,requestedModelId:"o4-mini-high"}:{sourceEvent:new Event("click"),nodeId:L,requestedModelId:"o3-mini-high"})};return{text:bt.tryItButton,onClick:se}}case te.FREE_USER_O3_MINI_HIGH:return{text:bt.getPlusButton,onClick:()=>{N.logEventWithStatsig("In Context Upsell Banner O3 Mini High CTA Clicked","chatgpt_in_context_upsell_banner_o3_mini_high_cta_clicked",{location:"In-context upsell o3-mini-high for Free banner - Get Plus button",eventProperties:R}),rt(E,"Prompt textarea in-context upsell banner")}};case te.DEEP_RESEARCH_IN_CONTEXT_UPSELL:{const L=ee.findNode(ke(t),ae=>ki(ae.message)),se=L?Ri(L.message):void 0;return{text:bt.tryItButton,onClick:()=>{N.logEventWithStatsig("In Context Upsell Banner Deep Research CTA Clicked","chatgpt_in_context_upsell_banner_deep_research_cta_clicked",{location:"In-context upsell deep research - Try it button",eventProperties:R}),c(M.Research,{clientThreadId:t}),p.focus(),p.setText(se??"")}}}case"get_pro":return{text:bt.getProButton,onClick:()=>{N.logRateLimitUpgradePlanButtonClicked({...R,upgrade_plan_tye:"pro"}),_?w({authType:T?"login":"signup",shouldOpenPaymentModalOnAuth:!0,callback:L=>{T?N.logLogInButtonClicked({location:"Rate limit banner Get Pro upsell",provider:L}):N.logSignUpButtonClicked({location:"Rate limit banner Get Pro upsell",provider:L})}}):rt(E,"Prompt textarea rate limit banner")}}}};bn(()=>{!G.get("should_change_model_picker",!0)&&R.type==="o3-mini-high-in-context-upsell-plus"&&(R.type="o3-mini-high-in-context-upsell-plus-no-model-switch"),N.logRateLimitBannerShown(R),a?.()});const[U,z]=d??[];let j=z;U===te.AUTHENTICATE&&x&&(j=te.AUTHENTICATE_SECONDARY);const H={primaryAction:B(U),secondaryAction:B(j)};return e.jsx(za,{onDismiss:n,title:i,description:l,actions:H,onInteract:o})},bt=Be({getPlusButton:{id:"TeyLcp",defaultMessage:"Get Plus"},getProButton:{id:"Pl8/Vk",defaultMessage:"Get Pro"},newChatButton:{id:"7OvnJ5",defaultMessage:"New chat"},tryItButton:{id:"zPDzun",defaultMessage:"Try it"}}),vp=({clientThreadId:t,rateLimitInfo:s,onDismiss:n,onInteract:o,onMount:a})=>{const{name:r,title:i,call_to_action:d,description:l}=s,u=kt(),m=_t(!0),{updateSystemHint:c}=pe(),p=jt(),b=_t(!1),h=ji(),g=ce(t,ee.getIsNewConversation),S=u?.planType??"unknown",v=_s(),y=Ke(),k=yt(y,"3809605125"),A=h&&"block_reason"in h?h.block_reason:null,R="banner_description",E=f.useMemo(()=>({type:r||"unknown",location:R,plan_type:S,is_new_conversation:g,is_hard_block:!!h,hard_block_reason:A??"",call_to_action:d}),[r,R,S,g,h,A,d]),w=hn(),_=Ha(),{isUnauthenticated:T}=Re(),D=xn(),x=Ua(vt.signUpButtonText),V=Ga({clientThreadId:t}),{layer:G}=$e("1368081792"),B=q=>{switch(q){case te.AUTHENTICATE:return{text:D?vt.logInButtonText:x,onClick:()=>{_({authType:D?"login":"signup",callback:L=>{D?N.logLogInButtonClicked({location:`Rate limit banner - ${r}`,provider:L}):N.logSignUpButtonClicked({location:`Rate limit banner - ${r}`,provider:L})}})}};case te.AUTHENTICATE_SECONDARY:return{text:D?x:vt.logInButtonText,onClick:()=>{_({authType:D?"signup":"login",callback:L=>{D?N.logSignUpButtonClicked({location:`Rate limit banner - ${r}`,provider:L}):N.logLogInButtonClicked({location:`Rate limit banner - ${r}`,provider:L})}})}};case te.GET_PLUS:return{text:Ht.getPlusButton,onClick:()=>{N.logRateLimitGetPlusButtonClicked(E),T?_({authType:D?"login":"signup",shouldOpenPaymentModalOnAuth:!0,callback:L=>{D?N.logLogInButtonClicked({location:"Rate limit banner Get Plus upsell",provider:L}):N.logSignUpButtonClicked({location:"Rate limit banner Get Plus upsell",provider:L})}}):rt(w,"Prompt textarea rate limit banner")}};case te.NEW_CHAT:return{text:Ht.newChatButton,onClick:()=>{m({modelId:"",location:R})}};case te.PAID_USER_O3_MINI_HIGH:{const L=ee.getCurrentLeafId(ke(t)),se=()=>{N.logEventWithStatsig("In Context Upsell Banner O3 Mini High CTA Clicked","chatgpt_in_context_upsell_banner_o3_mini_high_cta_clicked",{location:G.get("should_change_model_picker",!0)?"In-context upsell o3-mini-high for Plus banner - Try it button":"In-context upsell o3-mini-high for Plus (no model switch) banner - Try it button",eventProperties:E}),G.get("should_change_model_picker",!0)&&b(k?{modelId:"o4-mini-high",location:"In-context upsell o4-mini-high for Plus banner - Try it button"}:{modelId:"o3-mini-high",location:"In-context upsell o3-mini-high for Plus banner - Try it button"}),V(k?{sourceEvent:new Event("click"),nodeId:L,requestedModelId:"o4-mini-high"}:{sourceEvent:new Event("click"),nodeId:L,requestedModelId:"o3-mini-high"})};return{text:Ht.tryItButton,onClick:se}}case te.FREE_USER_O3_MINI_HIGH:return{text:Ht.getPlusButton,onClick:()=>{N.logEventWithStatsig("In Context Upsell Banner O3 Mini High CTA Clicked","chatgpt_in_context_upsell_banner_o3_mini_high_cta_clicked",{location:"In-context upsell o3-mini-high for Free banner - Get Plus button",eventProperties:E}),rt(w,"Prompt textarea in-context upsell banner")}};case te.DEEP_RESEARCH_IN_CONTEXT_UPSELL:{const L=ee.findNode(ke(t),ae=>ki(ae.message)),se=L?Ri(L.message):void 0;return{text:Ht.tryItButton,onClick:()=>{N.logEventWithStatsig("In Context Upsell Banner Deep Research CTA Clicked","chatgpt_in_context_upsell_banner_deep_research_cta_clicked",{location:"In-context upsell deep research - Try it button",eventProperties:E}),c(M.Research,{clientThreadId:t}),p.focus(),p.setText(se??"")}}}}};bn(()=>{!G.get("should_change_model_picker",!0)&&E.type==="o3-mini-high-in-context-upsell-plus"&&(E.type="o3-mini-high-in-context-upsell-plus-no-model-switch"),N.logRateLimitBannerShown(E),a?.()}),f.useEffect(()=>()=>{N.logEventWithStatsig("Rate Limit: Dismiss Banner","chatgpt_rate_limit_banner_dismissed",E)},[E]);const[U,z]=d??[];let j=z;U===te.AUTHENTICATE&&v&&(j=te.AUTHENTICATE_SECONDARY);const H={primaryAction:B(U),secondaryAction:B(j)};return e.jsx(za,{onDismiss:n,title:i,description:l,actions:H,onInteract:o})},Ht=Be({getPlusButton:{id:"TeyLcp",defaultMessage:"Get Plus"},newChatButton:{id:"7OvnJ5",defaultMessage:"New chat"},tryItButton:{id:"zPDzun",defaultMessage:"Try it"}}),Wi=t=>{const{value:s}=ie("1028682714");return s?e.jsx(yp,{...t}):e.jsx(vp,{...t})},Vi=Yn.div`group flex h-10 items-center gap-2 rounded-lg px-2 hover:bg-token-main-surface-secondary text-sm text-token-text-primary`;function wp(){const{data:t,isLoading:s}=ul({cutId:"recent",limit:8}),{data:n,isLoading:o}=dl();return{isLoading:s||o,recent:t,pinned:n}}function _p({query:t,onSelectGizmo:s,selectedIdx:n},o){const a=ll(),r=f.useRef([]),{isLoading:i,recent:d,pinned:l}=wp();f.useImperativeHandle(o,()=>({handleEnterOnIndex:c=>{if(!m[c])return c<u.length?u[c].resource:"create"},getResultsLength:()=>u.length+1,scrollToItem:c=>{const p=r.current[c];p&&p.scrollIntoView({behavior:"instant",block:"nearest"})}}));let u=[];if(i)return e.jsx("div",{className:"absolute end-4 top-0 flex h-full items-center justify-center",children:e.jsx(Qt,{})});d&&u.push(...d.pages.flatMap(c=>c.list.items).map(c=>({resource:c.resource,from:"recent"}))),l&&u.push(...l.items.map(c=>({resource:c,from:"pinned"}))),u=cl(u,c=>c.resource.gizmo.id);const m=u.map(c=>c.resource.gizmo.tags?.includes(js.WorkspaceDisabled));return t&&t!==""&&(u=u.filter(c=>(c.resource.gizmo.display.name.toLowerCase()+c.resource.gizmo.display.description?.toLowerCase()+c.resource.gizmo.author.display_name?.toLowerCase()).includes(t?.toLowerCase()))),e.jsxs("div",{className:"max-h-40 overflow-y-auto",children:[u.map((c,p)=>e.jsx("div",{ref:b=>{r.current[p]=b},tabIndex:p,onClick:()=>{m[p]||s(c.resource)},children:e.jsx(Mp,{gizmoResource:c.resource,from:c.from,showDescription:a,isSelected:n===p,grayedOut:m[p]})},c.resource.gizmo.id)),e.jsx("div",{ref:c=>{r.current[u.length]=c},tabIndex:u.length,onClick:()=>{s("create")},children:e.jsx(kp,{isSelected:n===u.length})},"create")]})}const jp=f.forwardRef(_p),kp=({isSelected:t})=>e.jsx(Vi,{className:t?"bg-token-main-surface-secondary":"",children:e.jsxs(nl,{to:"/gpts/editor",target:"_blank",className:"flex flex-row space-x-2 font-semibold",children:[e.jsx("span",{className:"self-center",children:e.jsx(fl,{className:"icon-sm"})}),e.jsx("span",{children:e.jsx(P,{...qi.dropdownCreateLabel})})]})}),Rp=({onClick:t,onClose:s})=>{const[n,o]=f.useState(null),a=f.useRef(null),r=f.useRef(null),[i,d]=f.useState(0),l=K(),u=m=>{N.logEvent("Mentions Click Gizmo",{gizmo_id:m==="create"?"create":m.gizmo.id}),m!=="create"&&t(m)};return e.jsxs(e.Fragment,{children:[e.jsx("input",{autoFocus:!0,placeholder:l.formatMessage(qi.searchPlaceholder),ref:a,onKeyDown:m=>{if(m.nativeEvent.isComposing)return;const c=r.current?.getResultsLength()??0;if((m.key==="Escape"||m.key==="Backspace"&&!n)&&(m.preventDefault(),s()),m.key==="Enter"||m.key==="Tab"){m.preventDefault();const p=r.current?.handleEnterOnIndex(i);if(!p)return;p==="create"?(window.open("/gpts/editor","_blank"),s()):u(p)}if(m.key==="ArrowDown"&&i<c-1){m.preventDefault();const p=i+1;r.current?.scrollToItem(p),d(p)}if(m.key==="ArrowUp"&&i>0){m.preventDefault();const p=i-1;r.current?.scrollToItem(p),d(p)}},onChange:m=>{o(m.target.value),d(0)},className:"bg-token-main-surface-primary w-full border-0 p-2 text-sm focus:outline-hidden"}),e.jsx(jp,{ref:r,query:n,selectedIdx:i,onSelectGizmo:u})]})},Ea=({onClick:t,onClose:s})=>{const n=Mi(),o=!!n;return bn(()=>{N.logEvent("Mentions Opened",{gizmo_selector_disabled:o})}),o?e.jsx(Wi,{clientThreadId:dn,rateLimitInfo:n}):e.jsx("div",{onBlur:a=>{a.currentTarget.contains(a.relatedTarget)||s()},className:"popover border-token-border-default bg-token-main-surface-primary rounded-2xl border p-2 shadow-lg",children:e.jsx(Rp,{onClick:t,onClose:s})})};function Mp({gizmoResource:t,from:s,showDescription:n,isSelected:o,grayedOut:a}){const r=!!t.gizmo.tags?.includes(js.FirstParty);return e.jsxs(Vi,{className:W(o?"bg-token-main-surface-secondary":"",a&&"opacity-50"),children:[e.jsx(Hi,{isFirstParty:r,src:t.gizmo.display.profile_picture_url,className:W("icon-xl h-7 w-7 shrink-0",a&&"grayscale group-hover:grayscale-0")}),e.jsxs("div",{className:"flex h-fit grow flex-row justify-between space-x-2 overflow-hidden text-ellipsis whitespace-nowrap",children:[e.jsxs("div",{className:"flex flex-row space-x-2",children:[e.jsx("span",{className:"shrink-0 truncate font-semibold",children:t.gizmo.display.name}),n&&e.jsx("span",{className:"text-token-text-tertiary grow truncate text-sm sm:max-w-xs lg:max-w-md",children:t.gizmo.display.description})]}),e.jsx("span",{className:"shrink-0 self-center",children:s==="recent"?e.jsx(ml,{className:"icon-sm"}):e.jsx(pl,{className:"icon-sm"})})]})]})}const qi=Be({talkingTo:{id:"TaggingDropdown.talkingTo",defaultMessage:"Talking to"},dropdownCreateLabel:{id:"TaggingDropdown.dropdownCreateLabel",defaultMessage:"Create a GPT"},searchPlaceholder:{id:"TaggingDropdown.searchPlaceholder",defaultMessage:"Search recent and pinned GPTs"}});function Ap({systemHint:t,label:s,logo:n,isDisabled:o=!1,composerController:a,analyticsMetadata:r,onClick:i,showLabel:d=!1,splitButtonDropdownContent:l,dropdownContent:u,dataTestid:m,tooltip:c,as:p}){const{name:b,systemHint:h}=t,g=h,{setThreadSystemHintMode:S,clearAllSystemHintModeTriggers:v}=pe(),y=qt(g),k=!!t.composerBarButtonInfo?.upsell,A=Ye.useStore(),{value:R}=ie("2454940646"),E=Yt(),w=[M.Search,M.Think].includes(g);f.useEffect(()=>{o&&E.has(g)&&S(g,!1,r)},[o,g,r,S,E,w]);const _=f.useCallback(x=>{x.stopPropagation(),x.preventDefault();let V=!0;R&&w&&(A.getState().persistedSystemHints.has(M.Search)||A.getState().persistedSystemHints.has(M.Think))&&(V=!1),V&&v(),S(g,!y,r),y||(a.removeSystemHints(),a.focus()),Sn(g,y?Se.Disable:Se.Enable,r.clientThreadId),i?.(x)},[r,R,v,a,g,w,y,i,S,A]),T=k?e.jsx("div",{className:"py-2",children:e.jsx(Cn,{location:g,statsig_login_event:"chatgpt_composer_upsell_login_button_clicked",statsig_signup_event:"chatgpt_composer_upsell_signup_button_clicked",containerNoPadding:!0})}):null;return e.jsx(Ps,{pressed:y,disabled:o,icon:n,label:s,ariaLabel:b,animatedLabel:!d,showLabel:d||y,onClick:_,dropdownContent:u??T,splitButtonDropdownContent:l,dataTestid:m,tooltip:c,as:p})}function Ep({composerController:t,systemHint:s,composerBarButtonInfo:n,isDisabled:o,clientThreadId:a,showLabel:r,labelOverride:i,disabledReason:d,rateLimitProgress:l,dropdownContent:u,splitButtonDropdownContent:m,logoOverride:c,dataTestid:p,tooltipPosition:b,disableNuxMarkdown:h,as:g}){const S={clientThreadId:a},v=y=>e.jsx(Pp,{composerBarButtonInfo:n,isDisabled:o,analyticsMetadata:S,systemHint:s.systemHint,disabledReason:d,rateLimitProgress:l,tooltipPosition:b,disableNuxMarkdown:h,children:y});return e.jsx(Ap,{isDisabled:o,systemHint:s,label:i??s.name,logo:c??e.jsx(Xt,{svgString:s.logo,className:"h-[18px] w-[18px]"}),composerController:t,analyticsMetadata:S,showLabel:r,dropdownContent:u,splitButtonDropdownContent:m,dataTestid:p,tooltip:v,as:g})}function Pp({children:t,isDisabled:s,systemHint:n,composerBarButtonInfo:o,analyticsMetadata:a,disabledReason:r,rateLimitProgress:i,tooltipPosition:d="bottom",disableNuxMarkdown:l}){const u=gl(o.announcementKey,n),m=hl({composerBarButtonInfo:o,children:t,disableMarkDown:l}),c=K();let p=null;return i&&i.remaining?p=e.jsx(Yi,{remaining:i.remaining,reset_date:i.reset_after,text:o.tooltipText}):o.tooltipText&&(p=e.jsx(oo,{text:o.tooltipText})),u?m:e.jsx("div",{children:e.jsx($t,{label:s?r===lt.HasAttachedFiles?c.formatMessage({id:"hhxO6y",defaultMessage:"Reason disabled for attachments"}):r===lt.DeepResearchHighLoad?c.formatMessage({id:"UrDtrS",defaultMessage:"Deep research is temporarily unavailable"}):r===lt.RateLimitReached?o.rateLimitReachedText:o.disabledText:p,side:d,onOpenChange:b=>{b&&Sn(n,Se.Hover,a.clientThreadId)},children:t})})}const oo=({text:t})=>e.jsx("span",{children:t}),Yi=({remaining:t,reset_date:s,text:n})=>{const{locale:o}=K(),a=xl(s,o);return e.jsxs("div",{className:"text-start",children:[e.jsx("span",{className:"text-token-text-tertiary block text-xs font-semibold",children:e.jsx(P,{id:"PromptTextarea.systemHintTooltip.remaining",defaultMessage:"{remaining} available until {resetDate}",values:{remaining:t,resetDate:a}})}),e.jsx(oo,{text:n})]})};function Tp({children:t,isDisabled:s,disabledReason:n,logEvent:o}){const a=K(),r=$n(),i=Ai(m=>m.bySystemHint(M.Research)),d=a.formatMessage({id:"SpX/tG",defaultMessage:"Get a detailed report"});let l=null;i&&i.remaining?l=e.jsx(Yi,{remaining:i.remaining,reset_date:i.reset_after,text:d}):l=e.jsx(oo,{text:d});const u=n===lt.DeepResearchHighLoad?a.formatMessage({id:"UrDtrS",defaultMessage:"Deep research is temporarily unavailable"}):n===lt.RateLimitReached&&r?a.formatMessage({id:"T3aUKM",defaultMessage:"More available {time}"},{time:r.resets_after_text}):void 0;return e.jsx($t,{className:"inline-block",label:s?u:l,side:"bottom",onOpenChange:m=>{m&&o(Se.Hover)},children:t})}const Np=({items:t,searchTerm:s,setSearchTerm:n,selectedItems:o,searchPlaceholder:a,handleSelectItem:r,showSelectAllRepos:i,loading:d,endReposRef:l})=>{const u=bl(),m=i&&o?.includes("$all_accessible_repos");return e.jsx(J.div,{variants:u,initial:"initial",animate:"animate",exit:"exit",className:"relative",children:e.jsxs("div",{className:"border-token-border-default bg-token-main-surface-primary flex max-h-60 w-full flex-col gap-2 overflow-y-auto rounded-lg border p-4",children:[e.jsx("input",{type:"text",value:s,onChange:c=>n(c.target.value),placeholder:a,className:"text-token-text-primary bg-token-main-surface-primary border-token-border-default w-full rounded-sm border-1 px-2 py-1 text-sm focus:ring-0 focus:ring-offset-0 focus:outline-hidden"}),t?.map(c=>{const p=o?.includes(c.name);return e.jsx(ct,{onClick:()=>{r(c)},isSelected:p,label:c.name,subtitle:c.description??void 0,className:"mx-0! w-full",selectedIconClassName:"color:black dark:color-gray"},c.name)}),d&&e.jsxs("div",{className:"text-token-text-secondary flex items-center justify-center gap-2 text-xs",children:[e.jsx(Qt,{}),e.jsx(P,{id:"M1WgQ2",defaultMessage:"Searching..."})]}),i&&e.jsx(ct,{onClick:()=>{r({name:"$all_accessible_repos"})},className:"mx-0! w-full",isSelected:m,label:e.jsx(P,{id:"pJnTxe",defaultMessage:"All Repositories"}),subtitle:e.jsx(P,{id:"EhTGqu",defaultMessage:"Select all repositories accessible to ChatGPT"}),selectedIconClassName:"color:black"},"select-all-repos"),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-token-border-primary border-token-border-default mt-2 mb-2 border-b"}),e.jsx(ct,{onClick:()=>{window.open(Wa,"_blank")},isSelected:!1,isActive:!1,label:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(P,{id:"ICVOEb",defaultMessage:"Configure Repositories"})}),subtitle:e.jsx(P,{id:"GXUcp/",defaultMessage:"Configure which repositories ChatGPT can access"}),className:"mx-0! w-full",infoIcon:e.jsx(Kt,{className:"icon-sm"}),infoLink:"https://help.openai.com/en/articles/11145903-chatgpt-connectors "},"configure-repos")]}),e.jsx("div",{className:"border-token-border-default my-2 border-t",ref:l}),e.jsx("div",{className:"text-token-text-secondary justify-center text-center text-xs",children:e.jsx(P,{id:"5A9QzP",defaultMessage:"Not seeing your repositories? {helpLink}.",values:{helpLink:e.jsx(e.Fragment,{children:e.jsx("a",{href:"https://help.openai.com/en/articles/11145903-chatgpt-connectors",target:"_blank",rel:"noopener noreferrer",className:"underline",children:e.jsx(P,{id:"sVuhcw",defaultMessage:"Learn more"})})})}})})]})})},Bp=({items:t,searchTerm:s,setSearchTerm:n,selectedItems:o,searchPlaceholder:a,handleSelectItem:r,showSelectAllRepos:i,loading:d,endReposRef:l})=>{const u=f.useRef(null),m=i&&o?.includes("$all_accessible_repos");return f.useEffect(()=>{requestAnimationFrame(()=>{u.current?.focus(),u.current?.select()})},[]),e.jsxs(e.Fragment,{children:[e.jsx(F.Item,{className:"mx-1.5 mb-1 p-0!",onClick:c=>{c.preventDefault(),u.current?.focus()},onFocus:()=>u.current?.focus(),tabIndex:-1,children:e.jsx("input",{type:"text",value:s,onChange:c=>n(c.target.value),placeholder:a,className:"text-token-text-primary bg-token-bg-primary border-token-border-default m-[-1px] w-full rounded-[10px] border-1 px-2.5 py-2 text-sm focus:ring-0 focus:ring-offset-0 focus:outline-hidden",ref:u,onKeyDown:c=>{if(tn(c,"ArrowDown"))c.preventDefault(),sn(c.currentTarget);else{if((tn(c,"ArrowLeft")||tn(c,"ArrowRight"))&&c.currentTarget.selectionStart===0)return;c.stopPropagation()}}})}),t?.map(c=>{const p=o?.includes(c.name);return e.jsx(F.Item,{onClick:b=>{b.preventDefault(),r(c),p&&!s&&sn(b.currentTarget)},secondary:c.description,trailing:p&&aa,children:c.name},c.name)}),d&&e.jsx("div",{className:"text-token-text-tertiary mx-1.5 px-2 py-2.5 text-sm",role:"alert","aria-busy":"true",children:e.jsx(P,{id:"M1WgQ2",defaultMessage:"Searching..."})}),i&&e.jsx(F.Item,{onClick:c=>{c.preventDefault(),r({name:"$all_accessible_repos"}),m&&!s&&sn(c.currentTarget)},secondary:e.jsx(P,{id:"EhTGqu",defaultMessage:"Select all repositories accessible to ChatGPT"}),trailing:m&&aa,children:e.jsx(P,{id:"pJnTxe",defaultMessage:"All Repositories"})}),(i||t.length>0)&&e.jsx(F.Separator,{}),e.jsx(F.Item,{onClick:()=>{window.open(Wa,"_blank")},secondary:e.jsx(P,{id:"GXUcp/",defaultMessage:"Configure which repositories ChatGPT can access"}),trailing:e.jsx(Kt,{className:"icon-sm"}),children:e.jsx(P,{id:"ICVOEb",defaultMessage:"Configure Repositories"})}),e.jsx("div",{className:"text-token-text-tertiary mx-1.5 justify-center px-2.5 py-2 text-center text-xs",ref:l,children:e.jsx(P,{id:"4Z21ID",defaultMessage:"Not seeing a repository? {helpLink}",values:{helpLink:e.jsx(e.Fragment,{children:e.jsx("a",{href:"https://help.openai.com/en/articles/11145903-chatgpt-connectors",target:"_blank",rel:"noopener noreferrer",className:"underline",children:e.jsx(P,{id:"sVuhcw",defaultMessage:"Learn more"})})})}})})]})};function tn(t,s){return t.key===s&&!t.nativeEvent.isComposing&&!t.ctrlKey&&!t.altKey&&!t.shiftKey&&!t.metaKey}function sn(t){const s=t.closest("[role=menuitem]");if(!s)return;let n=s.nextElementSibling;for(;n&&n.getAttribute("role")!=="menuitem";)n=n.nextElementSibling;if(!n)for(n=s.previousElementSibling;n&&n.getAttribute("role")!=="menuitem";)n=n.previousElementSibling;n instanceof HTMLElement&&n.focus()}function Ip(t,s){const[n,o]=f.useState(t),a=f.useRef(on(r=>o(r),s));return f.useEffect(()=>(a.current=on(r=>{o(r)},s),()=>{a.current?.cancel()}),[s]),f.useEffect(()=>{a.current?.(t)},[t]),n}const Pa=({searchTerm:t,setSearchTerm:s,selectedRepos:n,handleSelectRepo:o,linkId:a,asSubmenu:r})=>{const i=Qe(),d=K(),l=Ke(),u=Ip(t,300),{data:m,isFetching:c,isFetchingNextPage:p,isError:b,fetchNextPage:h,hasNextPage:g}=ol({queryKey:["github-repos",u,a],queryFn:async({pageParam:w=null})=>u.length===0?{repos:[],next_token:null}:yt(l,"1524828339")?await Ca.safePost("/aip/connectors/github/search_repos",{requestBody:{query:u,limit:20,next_token:w,link_id:a}}):await Ca.safePost("/aip/connectors/github/search_repos_v2",{requestBody:{query:u,limit:2,next_token:w,link_id:a}}),getNextPageParam:w=>w.next_token??void 0,initialPageParam:null,retry:1}),S=f.useRef(null),v=1,y=f.useRef(0);f.useEffect(()=>{if(!g||p)return;const w=S.current,_=new IntersectionObserver(T=>{T[0].isIntersecting&&y.current<v&&h()},{threshold:1});return w&&_.observe(w),()=>{w&&_.unobserve(w)}},[g,p,h]),f.useEffect(()=>{y.current=0},[u]),f.useEffect(()=>{b?(y.current+=1,y.current===1&&i.danger("Request error fetching Github repositories. Try disconnecting and connecting GitHub again.")):!p&&!b&&(y.current=0)},[b,p,i]);let k=m&&u?m.pages.flatMap(w=>w.repos).flatMap(w=>w.repository_full_name):[];k=Array.from(new Set([...k,...n.selectedRepos??[]]));const A=w=>{o(w.name)},R=r?Bp:Np,E=e.jsx(R,{items:k?.map(w=>({name:w}))??[],searchTerm:t,setSearchTerm:s,selectedItems:[...n.selectedRepos??[],...n.selectedAllRepos?["$all_accessible_repos"]:[]],searchPlaceholder:d.formatMessage({id:"lEa/MK",defaultMessage:"Add a repositoryâ€¦"}),handleSelectItem:A,showSelectAllRepos:!1,loading:c||p,endReposRef:S});return r?E:e.jsx("div",{children:E})};function Dp({clientThreadId:t,repoSelectorOpen:s,linkId:n,triggerButton:o,setRepoSelectorOpen:a,asSubmenu:r}){const{selectedRepos:i,setSelectedRepos:d}=yn(t),{deleteSource:l,addSource:u}=ks(t),[m,c]=f.useState(""),p=f.useRef(null),b=h=>{let g=[],S=!1;h==="$all_accessible_repos"?(S=!i?.selectedAllRepos,d({selectedRepos:[],selectedAllRepos:S})):i?.selectedRepos?.includes(h)?(g=i.selectedRepos?.filter(v=>v!==h),d({selectedRepos:g,selectedAllRepos:!1})):(g=[...i?.selectedRepos??[],h],d({selectedRepos:g,selectedAllRepos:!1})),S||g.length>0?u(Vt.GitHub):r||l(Vt.GitHub)};if(r){if(!n)return null;const h=Va(i);return e.jsxs(F.Sub,{open:h?s:!0,onOpenChange:g=>{h&&a(g)},children:[e.jsx(F.SubMenuTrigger,{className:"ps-4",icon:Sl,children:o}),e.jsx(F.Portal,{children:e.jsx(F.SubContent,{children:e.jsx(Pa,{asSubmenu:r,searchTerm:m,setSearchTerm:c,selectedRepos:{selectedRepos:i.selectedRepos?[...i.selectedRepos]:[],selectedAllRepos:i.selectedAllRepos},handleSelectRepo:b,linkId:n})})})]})}return e.jsx(vn,{open:s,onOpenChange:h=>{a(h),h||c("")},children:e.jsxs(qa,{children:[o,n&&e.jsx(wn,{children:e.jsx(_n,{side:"bottom",align:"start",ref:p,children:e.jsx(Pa,{asSubmenu:r,searchTerm:m,setSearchTerm:c,selectedRepos:{selectedRepos:i.selectedRepos?[...i.selectedRepos]:[],selectedAllRepos:i.selectedAllRepos},handleSelectRepo:b,linkId:n})})})]})})}const Op=30,Lp=25,Ts=({clientThreadId:t,enabledConnectors:s,includeWebSearch:n=!0,includeSyncConnectors:o=!1})=>{const a=K(),{selectedSources:r,toggleSource:i}=ks(t),d=Cl(),[l,u]=f.useState(!1),{selectedRepos:m}=yn(t),c=Ke(),{connectorLinks:p}=yl(),{connectionInstanceData:b,refetch:h}=jn({skip:!o}),g=f.useMemo(()=>[...b?.connection_statuses??[]].sort(Ya),[b]),S=f.useMemo(()=>{if(m?.selectedRepos?.length&&m?.selectedRepos?.length>=1){const v=m.selectedRepos;let y=v[0];if(y.length>Op){const A=(Lp-3)/2;y=y.slice(0,Math.floor(A))+"..."+y.slice(Math.floor(-11))}const k=v.length-1;return k>0?`${y} +${k}`:y}},[m.selectedRepos]);return!t||!r?null:e.jsxs(e.Fragment,{children:[e.jsx(F.Label,{children:e.jsx(P,{id:"bXIRlR",defaultMessage:"Sources"})}),n&&e.jsx(F.CheckboxItem,{icon:vl,checked:r.has(Vt.Web),onCheckedChange:()=>{i(Vt.Web)},children:a.formatMessage(nn.webSearch)}),o&&g.map(v=>e.jsx(Hp,{connection:v,location:"user_dropdown",refetch:h},v.user_connection_details.connection_instance_id)),s.map(v=>{const y=ia[v],k=p.get(wl[v])?.[0],A=!!k,R=!!y&&r.has(y)&&A;switch(v){case oe.GITHUB_CONNECTOR:case oe.GDRIVE_ACTION_CONNECTOR:case oe.DROPBOX_CONNECTOR:case oe.LINEAR_CONNECTOR:case oe.SHAREPOINT_CONNECTOR:case oe.OUTLOOK_EMAIL_CONNECTOR:case oe.GCAL_CONNECTOR:case oe.GMAIL_CONNECTOR:case oe.GOOGLE_CONTACTS_CONNECTOR:case oe.OUTLOOK_CALENDAR_CONNECTOR:case oe.TEAMS_CONNECTOR:case oe.BOX_CONNECTOR:case oe.INTERCOM_CONNECTOR:{const E=v===oe.GITHUB_CONNECTOR&&A&&R,w=ia[v],_=a.formatMessage(ra[v].title),T=ra[v].icon;return e.jsxs(e.Fragment,{children:[A?e.jsx(F.CheckboxItem,{icon:T,checked:R,onCheckedChange:()=>{i(w)},children:_}):e.jsx(F.Item,{onSelect:()=>{_l(v,c,void 0,d)},icon:T,trailing:e.jsx("div",{className:"text-token-text-tertiary",children:a.formatMessage(nn.connect)}),children:_}),E&&e.jsx(Dp,{asSubmenu:!0,clientThreadId:t,setRepoSelectorOpen:u,repoSelectorOpen:l,linkId:k?.id,triggerButton:S??a.formatMessage({id:"sDCihQ",defaultMessage:"Repositories"})},v)]})}default:return}}),e.jsx(F.Item,{icon:kn,onSelect:()=>{window.location.hash="#settings/ConnectorSettings"},children:a.formatMessage(nn.connectApps)})]})},Fp=({clientThreadId:t,enabledConnectors:s,trigger:n,includeWebSearch:o})=>{const{deleteSource:a}=ks(t);return e.jsxs(F.Root,{"data-testid":"sources-pill",onOpenChange:r=>{r||(Va(Al(ke(t)))||a(Vt.GitHub),ke(t)?.selectedSources?.size===0&&mm(t,l=>{l.selectedSources=void 0}))},children:[n,e.jsx(F.Portal,{children:e.jsx(F.Content,{alignOffset:-8,size:"auto",children:e.jsx(Ts,{clientThreadId:t,enabledConnectors:s,includeWebSearch:o})})})]})},Hp=({connection:t,refetch:s,location:n})=>{const o=K(),[a,r]=f.useState(!1),[i,d]=f.useState(),l=t.user_connection_details.connection_instance_id,u=Qe(),m=jl(),c=t.user_connection_details.knowledge_connector_type,p=c==="google_drive_oauth",b=f.useCallback(async()=>{try{r(!0),await kl({connectorType:c,connectionId:l,location:n,intl:o})}catch(A){A instanceof Error?u.danger(A.message):u.danger(o.formatMessage({id:"FNXFnS",defaultMessage:"Encountered an error connecting your account. Please try again later."}))}finally{r(!1),s?.()}},[l,c,o,n,s,u]),[h,g]=f.useState(!1),S=()=>p?g(!0):b(),v=t.user_connection_details.activation_status==="inactive"&&t.user_connection_details.auth_status==="not_connected",y=["activating","partially_activated"].includes(t.user_connection_details.activation_status),k=v&&!m||y;return e.jsxs(e.Fragment,{children:[i&&e.jsx($a,{connection:i,onClose:()=>d(void 0)}),h&&e.jsx(Rl,{isAdminFlow:!1,onClose:()=>g(!1),connectionId:l,location:n,onSuccess:s}),e.jsx(F.Item,{disabled:!k,onSelect:A=>{if(A.stopPropagation(),A.preventDefault(),v){S();return}if(y){d(t);return}},icon:e.jsx("img",{src:t.connection_display_info.icon_url??"",alt:t.connection_display_info.display_name,className:"icon-md"}),trailing:a?e.jsx(Qt,{className:"icon-md"}):e.jsx(Ka,{connection:t,location:"user_dropdown",inactiveButtonOverride:e.jsx("div",{className:"text-token-text-tertiary",children:e.jsx(Ml,{connection:t,refetch:s,location:"user_dropdown"})})}),children:t.connection_display_info.display_name},t.connection_display_info.display_name)]})},nn=Be({allRepositories:{id:"EzHFPp",defaultMessage:"All Repositories"},connect:{id:"OODbh3",defaultMessage:"Connect"},sourcesEnabled:{id:"aEIPI+",defaultMessage:"On"},webSearch:{id:"XoUbAe",defaultMessage:"Web search"},sourcesDisabled:{id:"j32+iI",defaultMessage:"Off"},connectApps:{id:"QJdTTY",defaultMessage:"Connect apps"}});function Up({clientThreadId:t,gizmoId:s,showLabel:n=!1,isDisabled:o}){const a=El(t,s),r=jt(),i=qt(M.Research),{setThreadSystemHintMode:d,clearAllSystemHintModeTriggers:l}=pe(),u=!!$n(),{value:m}=ie("1416952492"),c=m?lt.DeepResearchHighLoad:u?lt.RateLimitReached:void 0;return a?e.jsx("div",{"data-testid":"system-hint-research",style:{viewTransitionName:`var(--vt-composer-${M.Research}-action)`},children:e.jsx(Gp,{composerController:r,isThreadInSystemHintMode:i,setThreadSystemHintMode:d,clearAllSystemHintModeTriggers:l,clientThreadId:t,showLabel:n,isDisabled:o||!!c,disabledReason:c})},`system-hint-${M.Research}`):null}function Gp({composerController:t,isThreadInSystemHintMode:s,setThreadSystemHintMode:n,clearAllSystemHintModeTriggers:o,clientThreadId:a,showLabel:r=!1,isDisabled:i=!1,disabledReason:d}){const l=K(),u={clientThreadId:a},m=l.formatMessage({id:"ORxecl",defaultMessage:"Deep research"}),c=y=>{y===Se.Hover?N.logEventWithStatsig("Composer Research Button Hovered","composer_research_button_hovered",u):y===Se.Enable?N.logEventWithStatsig("Composer Research Button Enabled","composer_research_button_enabled",u):y===Se.Disable&&N.logEventWithStatsig("Composer Research Button Disabled","composer_research_button_disabled",u)},p=y=>{y.stopPropagation(),y.preventDefault(),o(),n(M.Research,!s,u),s||(t.removeSystemHints(),t.focus()),c(s?Se.Disable:Se.Enable)},b=ie("3544641259")?.value,h=Qa(),{enabled:g}=Rn(),S=f.useMemo(()=>Object.entries(h).reduce((y,[k,A])=>(A&&(k!==oe.GITHUB_CONNECTOR||g)&&y.push(k),y),[]),[h,g]),v=y=>e.jsx(Tp,{disabledReason:d,isDisabled:i,logEvent:c,children:y});return e.jsx(Ps,{pressed:s,disabled:i,icon:e.jsx(Pl,{className:"h-[18px] w-[18px]"}),label:m,animatedLabel:!r,showLabel:r||s,onClick:p,ariaLabel:m,dataTestid:"composer-button-deep-research",splitButtonDropdownContent:s&&b?e.jsx(Ts,{clientThreadId:a,enabledConnectors:S,includeSyncConnectors:!1,includeWebSearch:!0}):void 0,tooltip:v,as:b?"dropdown":"popover"})}function zp({clientThreadId:t,gizmoId:s,composerController:n,isDisabled:o}){return Tl({clientThreadId:t,gizmoId:s})?e.jsx("div",{"data-testid":"system-hint-reason",style:{viewTransitionName:`var(--vt-composer-${M.Think}-action)`},children:e.jsx(Wp,{clientThreadId:t,composerController:n,isDisabled:o})},`system-hint-${M.Think}`):null}function Wp({clientThreadId:t,composerController:s,isDisabled:n}){const o=K(),a=!!Kn();n=n||a;const r=o.formatMessage({id:"T+qu+0",defaultMessage:"Reason"}),{setThreadSystemHintMode:i,clearAllSystemHintModeTriggers:d}=pe(),l=qt(M.Think),u=Ye.useStore(),m=Yt(),{isUnauthenticated:c}=Re();f.useEffect(()=>{n&&m.has(M.Think)&&i(M.Think,!1,{clientThreadId:t})},[n,m,i,t]);const p=g=>{if(g.stopPropagation(),g.preventDefault(),c)return;let S=!0;u.getState().persistedSystemHints.has(M.Search)&&(S=!1),S&&d(),i(M.Think,!l,{clientThreadId:t}),l||(s.removeSystemHints(),s.focus()),l?N.logEventWithStatsig("Composer Think Button Disabled","composer_think_button_disabled",{clientThreadId:t}):N.logEventWithStatsig("Composer Think Button Enabled","composer_think_button_enabled",{clientThreadId:t})},b=c?e.jsx(Cn,{location:M.Think,statsig_login_event:"chatgpt_composer_upsell_login_button_clicked",statsig_signup_event:"chatgpt_composer_upsell_signup_button_clicked",containerNoPadding:!0}):void 0,h=e.jsx(Ps,{pressed:l,disabled:n,icon:e.jsx(Bl,{className:"h-[18px] w-[18px]"}),label:r,ariaLabel:r,animatedLabel:!0,showLabel:!0,onClick:p,dropdownContent:b,dataTestid:"composer-button-reason"});return e.jsx(Nl,{isDisabled:n,clientThreadId:t,children:h})}const Vp=["o1","o1-pro","gpt-4"];function qp({account:t,clientBootstrapFlags:s,features:n,clientThreadId:o,currentModelConfig:a,composerController:r,isDisabled:i,gizmoId:d,hasFiles:l}){const{prospectiveModelId:u}=Rs(o),m=Ms(o),c=Mn(d),{userIsInSearchHoldoutWithWebDisabled:p}=Il(),b=a?.enabledTools?.includes(Ei.Search),h=m==null||m?.kind===Pe.PrimaryAssistant||m?.kind===Pe.GizmoInteraction&&c,{isUnauthenticated:g}=Re(),S=pm(M.Search);return b===!1||g&&s?.includes(vs.AnonSearchHoldout)||!g&&(t==null||t.isFree())&&(s?.includes(vs.FreeSearchHoldout)||p)||!S||!g&&(t==null||t.isEnterprisey())&&!n?.includes(fm.BrowsingAvailable)||!h?null:e.jsx("div",{"data-testid":"system-hint-search",style:{viewTransitionName:`var(--vt-composer-${M.Search}-action)`},children:e.jsx(Yp,{clientThreadId:o,composerController:r,modelSupportsSearch:b??(g||t?.isFree()||!!u&&!Vp.includes(u)),isDisabled:i,disabledReason:b?l?hs.HasAttachedFiles:void 0:hs.ModelNotSupported,currentModelName:a?.title??""})},`system-hint-${M.Search}`)}function Yp({clientThreadId:t,composerController:s,isDisabled:n,disabledReason:o,currentModelName:a,modelSupportsSearch:r}){const i=K(),d=Dl(),l=i.formatMessage({id:"TbHx8d",defaultMessage:"Search"}),{setThreadSystemHintMode:u,clearAllSystemHintModeTriggers:m}=pe(),c=Ye.useStore(),p=Yt();n=n||!r,f.useEffect(()=>{n&&p.has(M.Search)&&u(M.Search,!1,{clientThreadId:t})},[n,p,u,t]);const b=h=>{h.stopPropagation(),h.preventDefault();let g=!0;c.getState().persistedSystemHints.has(M.Think)&&(g=!1),g&&m(),u(M.Search,!d,{clientThreadId:t}),d||(s.removeSystemHints(),s.focus()),N.logEventWithStatsig("Composer Search Button Clicked","composer_search_button_clicked",{clientThreadId:t}),d&&s.trimLeadingText(/^search\b/i)};return e.jsx(Kp,{analyticsMetadata:{clientThreadId:t},isThreadUsingSearchMode:d,isDisabled:n,disabledReason:o,currentModelName:a,children:e.jsx(Ps,{pressed:d,disabled:n??!1,icon:e.jsx(Ol,{className:"h-[18px] w-[18px]"}),label:l,ariaLabel:l,animatedLabel:!0,showLabel:!0,onClick:b,dataTestid:"composer-button-search"})})}function $p(){const t=Xa(),s=Ne(me.hasSeenComposerSearchButtonTooltip);return!s.isLoading&&s.eligible&&!t}function Kp({children:t,analyticsMetadata:s,isThreadUsingSearchMode:n,isDisabled:o,disabledReason:a,currentModelName:r}){const i=$p()&&!n,d=Ne(me.hasSeenComposerSearchButtonTooltip);return i?e.jsx(An,{announcementKey:me.hasSeenComposerSearchButtonTooltip,side:"right",show:!0,theme:"bright",dismissOnOutsideClick:!0,badge:"new",title:e.jsx(P,{id:"Yjduqi",defaultMessage:"Search the web"}),onDismiss:d.markAsViewed,sideOffset:0,className:"xs:max-w-sm! max-w-2xs!",description:e.jsx(P,{id:"W51Aei",defaultMessage:"Get fast answers with trusted sources. {learnMore}",values:{learnMore:e.jsx(Ll,{href:"https://openai.com/index/introducing-chatgpt-search",className:"underline",children:e.jsx(P,{id:"stA7F4",defaultMessage:"Learn more"})})}}),children:e.jsx("div",{children:t})}):e.jsx("div",{children:e.jsx($t,{className:"inline-block",label:o?a===hs.ModelNotSupported?e.jsx(P,{id:"GZemJe",defaultMessage:"Search disabled for {modelName}",values:{modelName:`${r}`}}):a===hs.HasAttachedFiles?e.jsx(P,{id:"Wd1fc2",defaultMessage:"Search disabled for attachments"}):e.jsx(P,{id:"GpDAWD",defaultMessage:"Search is unavailable"}):e.jsx(P,{id:"c+4o2s",defaultMessage:"Search the web"}),side:"bottom",onOpenChange:l=>{l&&N.logEventWithStatsig("Composer Search Button Hovered","composer_search_button_hovered",s)},children:t})})}const Qp=1;function Xp({value:t=Qp,size:s,onStateChange:n}){return e.jsx("div",{className:"relative flex h-full w-full flex-col items-center justify-center",children:e.jsxs(J.div,{animate:{translateY:t>1&&s==="small"?-1:0},onAnimationStart:()=>n?.("animating"),onAnimationComplete:()=>n?.("idle"),className:W("relative",s==="small"?"h-5 w-5":"h-8 w-8"),children:[e.jsx(J.div,{style:{transformOrigin:"50% 100%",translateY:s==="large"?3:0},animate:{scale:t>1&&s==="small"?.85:1},className:"absolute start-0 top-0",children:e.jsx(Fl,{"aria-label":"",className:W(s==="small"?"h-5 w-5":"h-8 w-8")})}),e.jsx(J.div,{initial:{scale:s==="small"?.9:1.1,opacity:0},animate:{scale:s==="large"?1.1:t>1?1:.9,opacity:t>1?1:0},style:{translateY:s==="large"?-1:0},className:"absolute start-0 top-0",children:e.jsx(Hl,{"aria-label":"",className:W(s==="small"?"h-5 w-5":"h-8 w-8")})}),e.jsx(J.div,{initial:{scale:s==="small"?.9:1.1,opacity:0},animate:{scale:s==="large"?1.1:t>2?1:.9,opacity:t>2?1:0},style:{translateY:s==="large"?-1:0},className:"absolute start-0 top-0",children:e.jsx(Ul,{"aria-label":"",className:W(s==="small"?"h-5 w-5":"h-8 w-8")})})]})})}function Jp(t){const{reasoningLevelTypes:s,reasoningLevelType:n}=t,{ReasoningLevels:o}=s;let a=1;return n===o.medium.type?a=2:n===o.high.type&&(a=3),e.jsx("div",{className:W("relative flex h-5 w-5 items-center justify-center"),children:e.jsx(Xp,{size:"small",value:a})})}const Zp=({isManualModelSelection:t,animatedLabel:s,reasoningLevelTypes:n,reasoningLevelType:o,modelName:a,onResetReasoningLevel:r,onReasoningLevelChanged:i,type:d})=>{const[l,u]=f.useState(!1),m=al(),{reasoningLevel:c}=Gl({reasoningLevelTypes:n,reasoningLevelType:o}),p=o!=="low"||t||!1,b=Te(g=>g.isVisuallyOverflowing),h=b;return e.jsxs("div",{className:W("radix-state-open:bg-black/10 inline-flex h-9 rounded-full border text-[13px] font-medium",p?"text-token-interactive-label-accent-default can-hover:hover:bg-[#BDDCF4] dark:can-hover:hover:bg-[#1A416A] bg-token-composer-blue-bg border-transparent dark:bg-[#2A4A6D] dark:text-[#48AAFF]":"border-token-border-default text-token-text-secondary can-hover:hover:bg-token-main-surface-secondary focus-visible:outline-black dark:focus-visible:outline-white",l&&"duration-75 motion-safe:transition-all"),children:[e.jsxs("div",{className:"flex h-full min-w-8 items-center justify-center p-2","aria-pressed":p,onTransitionEnd:()=>u(!1),onClick:g=>{d==="think"&&!t&&!b&&(g.stopPropagation(),g.preventDefault(),i(o==="low"?"medium":"low"))},children:[e.jsx(Jp,{reasoningLevelTypes:n,reasoningLevelType:o}),s&&e.jsx(ut,{initial:!1,children:e.jsx(J.span,{initial:{x:-10,width:0,opacity:0},animate:{x:0,width:"fit-content",opacity:1},exit:{x:-10,width:0,opacity:0},transition:{ease:"easeOut",duration:m?0:.15},children:e.jsx("div",{className:W("ps-1 pe-1 whitespace-nowrap",h&&!t&&"hidden"),children:t?a:c?.shortLabel})})}),!t&&d==="auto"&&!p&&!h&&e.jsx(Gt,{"aria-label":"",className:"h-[18px] w-[18px] opacity-50"})]}),p&&!b&&(t||d!=="think")?e.jsx("div",{className:"border-token-border-default mt-[1px] border-s p-2",style:{borderColor:p?"#0285FF28":void 0},onClick:g=>{g.stopPropagation(),g.preventDefault(),r()},children:e.jsx(Pi,{"aria-label":"",className:"h-[16px] w-[16px]"})}):d==="think"?e.jsx("div",{className:W("border-token-border-default border-s p-2",h&&"hidden"),style:{borderColor:p?"#0285FF28":void 0},children:e.jsx(Gt,{className:"h-[18px] w-[18px]"})}):null]})},ef=({clientThreadId:t,currentModelId:s,onModelSelection:n,closePopover:o,setIsModelPickerOpen:a,ref:r})=>{const i=K(),{data:d}=Jt(),{mode:l}=En(),u=zl({clientThreadId:t}),{hasInternalModels:m}=Wl(),b=Vl(h=>h.query).toLowerCase().trim().length>0;return e.jsxs(J.div,{initial:{clipPath:"inset(0 100% 0 0)",opacity:0},animate:{clipPath:"inset(0 0% 0 0)",opacity:1},exit:{clipPath:"inset(0 100% 0 0)",opacity:0},transition:xs,className:"flex flex-col",ref:r,children:[l!=="model-picker-only"&&e.jsxs("div",{className:"border-token-border-xlight bg-token-main-surface-primary dark:bg-token-main-surface-secondary sticky start-0 top-0 z-10 flex w-full flex-row items-center justify-center overflow-clip border-b p-3",children:[e.jsx("button",{onClick:()=>{a(!1)},id:"reasoning-level-popover-model-list-back-button",className:"hover:bg-token-main-surface-tertiary flex items-center rounded-md p-1",children:e.jsx(Ja,{className:"text-token-text-secondary h-5 w-5"})}),e.jsx("div",{className:"flex-auto text-center text-sm font-medium",children:i.formatMessage({id:"j6WEI7",defaultMessage:"Choose a model"})}),e.jsx("div",{className:"w-5"})]}),e.jsx("div",{className:W("flex w-full flex-col pb-2"),children:b?e.jsx(ql,{currentModelId:s,onModelSelection:n,closePopover:o,rootRef:r}):e.jsxs(e.Fragment,{children:[d?.categories?.map(h=>{const g=h?.defaultModel;return e.jsx(Yl,{model:h,modelSwitcherDenialsBySlug:u,isSelected:g===s,onClick:()=>{n(g),o()}},g)}),m&&e.jsxs(e.Fragment,{children:[e.jsx($l,{modelsData:d,clientThreadId:t,triggerButton:e.jsx(ct,{className:"relative mt-1 border-transparent",children:e.jsxs("div",{className:"mb-1 flex items-center px-1",children:[e.jsx("div",{className:"text-sm",children:i.formatMessage({id:"ZDpo4I",defaultMessage:"Internal Models"})}),e.jsx(Kl,{className:"icon-md text-token-text-tertiary absolute end-1 w-7"})]})}),onModelItemClick:h=>{h&&(n(h),o())}}),e.jsx(Za,{})]})]})})]})},tf={modelPickerOpen:{maxHeight:375,width:320},modelPickerClosed:{maxHeight:245,width:320},vanguardModelPickerClosed:{maxHeight:320,width:264}},sf=({clientThreadId:t,reasoningLevelTypes:s,reasoningLevelType:n,onReasoningLevelChanged:o,isManualModelSelection:a,currentModelId:r,onModelSelection:i,resetReasoningLevel:d})=>{const{layoutMode:l,closePopover:u,mode:m}=En(),c=!As(),[p,b]=f.useState(!!(a||m==="model-picker-only")),h=f.useRef(null),g=f.useRef(null);return f.useEffect(()=>{p?(h.current?.scrollTo({top:-1e3,behavior:"instant"}),document.getElementById("reasoning-level-popover-model-list-back-button")?.focus()):document.getElementById("reasoning-level-popover-juice-list-model-picker-button")?.focus()},[a,p]),e.jsxs(J.div,{className:W("max-h-[max(calc(var(--radix-popover-content-available-height)-64px), 245px)] flex flex-1 origin-center snap-y snap-proximity scroll-pt-[30px] overflow-y-auto overscroll-contain scroll-smooth [scrollbar-gutter:stable]",c&&!p&&"pt-4",l==="bottom"&&"flex-col-reverse"),animate:p?"modelPickerOpen":"modelPickerClosed",transition:Ql,variants:tf,ref:h,children:[!p&&m!=="model-picker-only"&&e.jsx(Xl,{clientThreadId:t,reasoningLevelTypes:s,reasoningLevelType:n,onReasoningLevelChanged:o,resetReasoningLevel:d,shouldShowModelPicker:c,setIsModelPickerOpen:b,isModelPickerOpen:p,showAccountPaymentModal:rt}),e.jsx(ut,{children:p&&c&&e.jsx(ef,{clientThreadId:t,setIsModelPickerOpen:b,ref:g,currentModelId:r,onModelSelection:i,closePopover:u})})]})},nf=({clientThreadId:t,layoutMode:s,currentModel:n,category:o,type:a,...r})=>{const{data:i}=Jt(),l=Te(_=>_.threads[t]?.modelSelection)?.type===Ce.SPECIFIC,u=Te(_=>_.setThreadModelSelection),m=As(),c=hn(),p=f.useMemo(()=>{const _=n?.id??"";return Jl(_)?"low":Zl(_)?"medium":ec(_)?"high":"low"},[n?.id]),b=tc(),h=_t(),g=f.useCallback(_=>{St(t,u,{type:Ce.EFFORT_MODE,effortMode:Ut[_]}),requestAnimationFrame(()=>{requestAnimationFrame(()=>{const T=sc(_,i?.categories.map(D=>D.defaultModel)??[]);T&&(m&&_==="high"?rt(c,"Model picker upsell"):h({location:"PromptTextarea",modelId:T}))})})},[t,h,c,m,i,u]),S=_=>{const T=n?.id??"";_&&(N.logEvent("Model Switcher Model Changed",{from:T,to:_,source:"popover"}),hm.logEvent("chatgpt_model_switcher_model_changed",_,{from:T,to:_,source:"popover"}),h({modelId:_,location:"Model switcher menu item"}),oc({type:Ce.SPECIFIC,modelSlug:_}),St(t,u,{type:Ce.SPECIFIC,modelSlug:_}))},v=!nc(n?.id??""),y=l||v,A=(o?.label&&o?.label?.length<10?o?.label:o?.shortLabel)??n?.title??"",R=n?.id??"",E=()=>{g("low")},w=f.useCallback(()=>{const{reasoningLevelList:_}=b,D=(_.findIndex(x=>x.type===p)+1)%_.length;g(_[D].type)},[g,p,b]);return f.useEffect(()=>gm(ap,{cycleReasoningLevel:w}),[w]),e.jsxs(eo,{layoutMode:s,...r,children:[e.jsx(Ui,{children:e.jsx(Zp,{isManualModelSelection:y,modelName:A,animatedLabel:!0,reasoningLevelTypes:b,reasoningLevelType:p,onResetReasoningLevel:E,onReasoningLevelChanged:g,type:a})}),e.jsx(to,{align:"start",children:e.jsx(sf,{clientThreadId:t,reasoningLevelTypes:b,reasoningLevelType:p,onReasoningLevelChanged:g,modelName:A,isManualModelSelection:y,currentModelId:R,onModelSelection:S,resetReasoningLevel:E})})]})},of=({className:t,children:s})=>e.jsx(J.div,{className:t,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,transition:{duration:.1,delay:0}},transition:{type:"tween",duration:.3,delay:.2},children:s});function af({canContinue:t,onContinueGenerating:s}){const n=f.useCallback(a=>{s(a),an()},[s]);let o=null;return t&&(o=e.jsx(lf,{onHandleContinueGenerating:n})),o&&e.jsx("div",{className:"flex h-full w-full items-center justify-end gap-0 py-4 md:gap-2",children:o})}function rf({className:t}){return e.jsx(ac,{className:W("-rotate-180",t)})}const lf=({onHandleContinueGenerating:t})=>e.jsx(of,{children:e.jsx(xm,{as:"button",color:"secondary",onClick:t,className:"py-2 whitespace-nowrap",icon:rf,size:"small",children:e.jsx(P,{...Z.continueGenerating})})}),cf=({clientThreadId:t,composerController:s})=>{const n=Ni(),o=it(s.store,h=>h.rateLimitBannerFeature),a=Sm(),r=n??uf(o,a),i=ce(t,ee.getRequestId),d=ce(t,ee.getCurrentLeafId),l=Ti(i),{layer:u}=$e("1368081792"),m=r?.name?()=>{switch(r.name){case"o3-mini-high-in-context-upsell-free":case"o3-mini-high-in-context-upsell-plus":case"deep-research-in-context-upsell":fc(d);break}}:void 0,{value:c}=ie("3612584454");f.useEffect(()=>{l&&!(r?.name==="gpt-4l"&&c)&&(ya.dismissBanner(),s.setRateLimitBannerFeature(null))},[l,r?.name,c,s]);const p=r?.is_dismissible?()=>{N.logEventWithStatsig("Rate Limit: Dismiss Banner","chatgpt_rate_limit_banner_dismissed",{type:!u.get("should_change_model_picker",!0)&&r?.name==="o3-mini-high-in-context-upsell-plus"?"o3-mini-high-in-context-upsell-plus-no-model-switch":r?.name}),ya.dismissBanner(),s.setRateLimitBannerFeature(null)}:void 0,b=()=>{switch(r?.name){case"o3-mini-high-in-context-upsell-free":case"o3-mini-high-in-context-upsell-plus":case"deep-research-in-context-upsell":gc({interactedInPeriod:!0});break}};return e.jsx(ut,{children:r&&e.jsx(J.div,{transition:{type:"tween",ease:"easeInOut",duration:.1},initial:{opacity:0,transform:"translateY(8px)"},animate:{opacity:1,transform:"translateY(0px)"},exit:{opacity:0,transform:"translateY(8px)"},children:e.jsx(Wi,{clientThreadId:t,rateLimitInfo:r,onDismiss:p,onInteract:b,onMount:m})})})};function uf(t,s){const n=s.find(o=>o.name===t);return n?{name:n.name,title:n.title,description:n.description,is_dismissible:!0,call_to_action:n.call_to_action,resets_after:n.resets_after}:null}function df(t,s,n,o,a,r,i,d,l,u,m){if(l||(t.name==="o3-mini-high-in-context-upsell-free"||t.name==="o3-mini-high-in-context-upsell-plus")&&(s.some(y=>y.model_slug==="o3-mini-high")||n.id==="o3-mini-high")||d&&i&&Ks(Date.now(),i)<la)return!1;const p=o==null||Ks(Date.now(),o)>=mc,b=a===u,h=i==null||r==null||Ks(Date.now(),i)>=la||r<pc;if(!(p&&h||b))return!1;switch(t.name){case"deep-research-in-context-upsell":return m("should_show_deep_research_upsell_banner",!1);case"o3-mini-high-in-context-upsell-free":return m("should_show_o3_mini_high_upsell_banner_free_user_to_plus",!1);case"o3-mini-high-in-context-upsell-plus":return m("should_show_o3_mini_high_upsell_banner_plus_user",!1);default:return!1}}function mf(t,s){const n=bm(),o=ic(t),a=ce(t,ee.getRequestId),r=ce(t,ee.getCurrentLeafId),i=Ti(a),d=Ni(),l=rc(S=>S.lastSeenInContextUpsellBannerAt),u=lc(S=>S.inContextUpsellBannerPeriodExposureCount),m=cc(S=>S.inContextUpsellBannerPeriodStartAt),c=uc(S=>S.inContextUpsellBannerLastSeenId),p=dc(S=>S.inContextUpsellBannerInteractedInPeriod),{layer:b}=$e("1368081792"),h=it(s.store,S=>S.rateLimitBannerFeature);let g=!1;switch(d?.name){case null:case void 0:g=h!=null;break;case"o3-mini-high-in-context-upsell-free":case"o3-mini-high-in-context-upsell-plus":case"deep-research-in-context-upsell":g=df(d,n,o,l,c,u,m,p,i,r,b.get);break;default:g=!0}return!i&&g}const ws="month",$i="year";function pf(){const t=Cm(),s=K(),n=Qe(),{markAsViewed:o}=Ne(hc),{initialBillingDetails:a}=Xm(t,!0),r=f.useMemo(()=>({...t?.subscriptionAnalyticsParams,referrer:document.referrer}),[t]);async function i(){try{await bc(t?.features??[],s,n,a,r)}catch{}}const{shouldShowBanner:d,discountValue:l,discountDuration:u}=xc();if(f.useEffect(()=>{d&&l&&u&&Qs.logShowReferrerRedemptionBanner()},[d,l,u]),!d||!l||!u)return null;const m=ff(s,a,l,u),c=gf(s,a,l,u),p=e.jsxs("div",{className:"grow",children:[e.jsx("div",{className:"mb-0.5 font-semibold",children:m}),e.jsx("span",{className:"text-token-text-secondary",children:c})]});return e.jsx(Pn,{onPrimaryCtaClick:()=>{o(),Qs.logClickReferrerRedeemButton(),i()},primaryCtaText:e.jsx(P,{id:"referrerRedemptionBannerPrimaryCta",defaultMessage:"Get Plus"}),onDismiss:()=>{o(),Qs.logCloseReferrerRedemptionBanner()},content:p})}function ff(t,s,n,o){const{currencySymbol:a}=ei(ti(),s.currency),r=o?o.period:ws,i=o?o.num_periods:1,d=a.code.defaultMessage?.toString()??Bi,l=t.formatNumber(n.value,{style:"currency",currency:d,minimumFractionDigits:0,maximumFractionDigits:2});let u;return r===ws?u=i===1?e.jsx(P,{id:"referrerRedemptionBannerTitleForSingleMonth",defaultMessage:"Your {discount} credit is ready",values:{discount:l}}):e.jsx(P,{id:"referrerRedemptionBannerTitleForPluralMonths",defaultMessage:"Redeem your {discount} referral reward",values:{discount:l}}):r===$i&&(u=i===1?e.jsx(P,{id:"referrerRedemptionBannerTitleForSingleYear",defaultMessage:"Redeem your {discount} referral reward",values:{discount:l}}):e.jsx(P,{id:"referrerRedemptionBannerTitleForPluralYears",defaultMessage:"Redeem your {discount} referral reward",values:{discount:l}})),u}function gf(t,s,n,o){const{currencySymbol:a}=ei(ti(),s.currency),r=o?o.period:ws,i=o?o.num_periods:1,d=a.code.defaultMessage?.toString()??Bi,l=t.formatNumber(n.value,{style:"currency",currency:d,minimumFractionDigits:0,maximumFractionDigits:2});let u;return r===ws?u=i===1?e.jsx(P,{id:"referrerRedemptionBannerContentForSingleMonth",defaultMessage:"Your referral link was used â€” claim your free month of Plus."}):e.jsx(P,{id:"referrerRedemptionBannerContentForPluralMonths",defaultMessage:"Your referral link earned you {discount} off {num_months} months of Plus.",values:{discount:l,num_months:i}}):r===$i&&(u=i===1?e.jsx(P,{id:"referrerRedemptionBannerContentForSingleYear",defaultMessage:"Your referral link earned you {discount} off a year of Plus.",values:{discount:l}}):e.jsx(P,{id:"referrerRedemptionBannerContentForPluralYears",defaultMessage:"Your referral link earned you {discount} off {num_years} years of Plus.",values:{discount:l,num_years:i}})),u}const pn=window.sessionStorage,fn=ym(vm(()=>({memoryFullBannerDismissed:!!pn?.getItem(wt.MemoryFullBannerDismissed)}))),Ki={dismissBanner(){fn.setState(t=>{t.memoryFullBannerDismissed=!0}),pn?.setItem(wt.MemoryFullBannerDismissed,"true")},clearDismissedBanner(){fn.setState(t=>{t.memoryFullBannerDismissed=!1}),pn?.removeItem(wt.MemoryFullBannerDismissed)}};function hf(t){const s=Ii(t),n=Sc(),{data:o}=Cc(s,!1,n),a=o!=null,r=a&&o.memoryFullPct>=100,[i,d]=f.useState(!1);f.useEffect(()=>{!r&&a&&(d(!0),Ki.clearDismissedBanner())},[r,a]);const l=fn(u=>u.memoryFullBannerDismissed);return r&&i&&!l}function xf(){const t=K(),{openSettings:s}=yc();return e.jsx(J.div,{initial:{opacity:0},animate:{opacity:1},children:e.jsx(Pn,{title:t.formatMessage(fs.memoryFullTitle),content:t.formatMessage(fs.memoryFullTooltip,fs.memoryFullTooltip.values),primaryCtaText:t.formatMessage(fs.memoryManageButton),onPrimaryCtaClick:()=>s(vc.Personalization),onDismiss:()=>Ki.dismissBanner()})})}const fs=Be({memoryFullTitle:{id:"i1hV1R",defaultMessage:"ChatGPT's out of space for saved memories"},memoryManageButton:{id:"a5A88o",defaultMessage:"Manage"},memoryFullTooltip:{id:"Rs+Att",defaultMessage:"New memories wonâ€™t be added until you make space. <a>Learn more</a>",values:{a:t=>e.jsx("a",{href:wc,target:"_blank",rel:"noopener noreferrer",className:"underline",children:t})}}}),bf=Qn(()=>Xn(()=>import("./hhf5b3nino77v3be.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(t=>t.JawboneNotificationsBanner)),Qi=f.memo(function({className:s}){const{store:n}=ye(),o=n.useIsHeaderContentAreaPopulated();return e.jsx("div",{className:W(s??"absolute start-0 end-0 bottom-full",jc.PromptTextareaHeader),children:e.jsx(_c,{shouldRender:o,contentArea:zt.Header,children:e.jsxs("div",{className:"mb-2 flex flex-col gap-3.5 pt-2",children:[e.jsx(Sf,{}),e.jsx(Cf,{})]})})})});function Sf(){const{store:t}=ye(),s=t.useSharedProps(d=>d?.clientThreadId),n=t.useContentAreaId(zt.HeaderTop),o=kc(),a=ce(s,d=>d?.modelId),r=Rc.useStore();let i;switch(n){case I.ProjectConversationTaskNoFileAccess:i=e.jsx(_f,{});break;case I.AdvancedVoiceOnMobileAnnouncement:i=e.jsx(Wc,{clientThreadId:s});break;case I.S09KM1:i=null;break;case I.TeamsCreditRequest:i=null;break;case I.BannerSignup:i=e.jsx(wf,{});break;case I.BannerTermsDisclaimer:i=e.jsx(jf,{});break;case I.PromptTextareaAction:i=e.jsx(kf,{});break;case I.BannersRateLimit:i=e.jsx(Rf,{});break;case I.BannerSidekickAnnouncement:i=e.jsx(zc,{});break;case I.SearchBrowserExtensionAnnouncement:i=e.jsx(Gc,{});break;case I.MoonshineAnnouncement:i=e.jsx(Uc,{});break;case I.CustomizeChatGPTAnnouncement:i=e.jsx(Hc,{});break;case I.SearchBrowserExtensionReactiveAnnouncement:i=e.jsx(Fc,{});break;case I.BannerMemoryFull:i=e.jsx(xf,{});break;case I.Box:i=e.jsxs("div",{id:"Box",className:"flex h-20 w-full items-center justify-center gap-2 bg-red-500 p-2",children:["box",e.jsxs("div",{className:"flex h-full w-full items-center justify-center gap-2 bg-blue-500 p-2",children:["inner",e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-yellow-400 text-center",children:"actual content"})]})]});break;case I.JawboneAnnouncement:o?i=e.jsx(bf,{}):i=null;break;case I.JawboneMaxActiveAnnouncement:o?i=e.jsx(Lc,{}):i=null;break;case I.PromoRedemptionAnnouncement:i=e.jsx(Km,{});break;case I.OperatorAnnouncement:i=e.jsx(Oc,{});break;case I.BannerPlusUpsell:i=e.jsx(Dc,{});break;case I.ContextualAnswersAdminUpsell:i=e.jsx(Ic,{});break;case I.ContextualAnswersUserUpsell:i=e.jsx(Bc,{});break;case I.ReferrerRedemptionAvailableAnnouncement:i=e.jsx(pf,{});break;case I.RefereeRedemptionAvailableAnnouncement:i=e.jsx(Nc,{});break;case I.ReferralProgramUpsellAnnouncement:i=e.jsx(Tc,{});break;case I.StudentsUpsellAnnouncement:i=e.jsx(Pc,{});break;case I.ModelDeprecationBanner:i=Ec(a);break;case I.TeamsContextualAnswersUpsell:i=e.jsx(Ac,{});break;case I.LanguageUpsellBanner:i=e.jsx(Mc,{onDismissSideEffect:()=>{N.logEventWithStatsig("Language Upsell Banner Dismissed","chatgpt_web_language_upsell_banner_dismissed"),r.closeBanner()},onPrimaryCtaClickSideEffect:()=>{N.logEventWithStatsig("Language Upsell Banner Primary CTA Clicked","chatgpt_web_language_upsell_banner_primary_cta_clicked"),r.closeBanner()}});break;default:i=null;break}return i}function Cf(){const{store:t}=ye(),s=t.useContentAreaId(zt.HeaderBottom);let n;switch(s){case si.DallePromptControls:n=e.jsx(vf,{});break;default:n=null;break}return n}const yf=Qn(()=>Xn(()=>import("./h845c9skq3wadruq.js"),__vite__mapDeps([7,1,2,3,4,5])).then(t=>t.default));function vf(){const{store:t}=ye(),s=t.useSharedProps(n=>n?.composerController);return s?e.jsx(yf,{composerController:s}):null}function wf(){const{store:t}=ye(),s=t.useSharedProps(a=>a?.clientThreadId),n=xn(),o=Vc();return s?n?e.jsx(qc,{threadId:s,showSignUp:o}):e.jsx(Yc,{threadId:s,showLogin:o}):null}function _f(){return f.useEffect(()=>()=>{en.getItem(wt.TasksHasSeenProjectDisclaimerBanner)||en.setItem(wt.TasksHasSeenProjectDisclaimerBanner,!0)},[]),e.jsx(Pn,{icon:e.jsx(Kt,{}),title:e.jsx(P,{id:"ibX3g7",defaultMessage:"Tasks canâ€™t access project files"}),content:e.jsx(P,{id:"fm94Tm",defaultMessage:"Thereâ€™s a task in this conversation â€” just FYI, it wonâ€™t be able to access project files."}),onDismiss:()=>{en.setItem(wt.TasksHasSeenProjectDisclaimerBanner,!0)}})}function jf(){const{store:t}=ye(),s=t.useSharedProps(n=>n?.clientThreadId);return s?e.jsx($c,{threadId:s}):null}function kf(){const{store:t}=ye(),s=t.useSharedProps();return s?e.jsx(af,{...s}):null}function Rf(){const{store:t}=ye(),s=t.useSharedProps(o=>o?.clientThreadId),n=t.useSharedProps(o=>o?.composerController);return!s||!n?null:e.jsx(cf,{clientThreadId:s,composerController:n})}const Mf=5,Af=f.memo(function(s){return Ef(s),Pf(s),Tf(),null});function Ef(t){const{store:s}=ye(),n=s.useSetSharedProps();mn(()=>{n(t)},[t,n])}function Pf(t){const{clientThreadId:s,canContinue:n}=t,{store:o}=ye(),a=f.useRef({top:o.useContentAreaApi(zt.HeaderTop),bottom:o.useContentAreaApi(zt.HeaderBottom)}).current,r=Kc(s),{shouldShowBannerSignup:i,shouldShowBannerTermsDisclaimer:d}=Nf(s),l=mf(s,t.composerController),u=Qc(t),m=Xc(t),c=Xa(),p=Jc(),b=Zc(t),h=hf(s),g=eu(t),S=tu(s),v=su(s),y=Qm(),{eligible:k}=Ne(nu),A=ou(),R=au(),E=iu(),w=ru(),_=lu(s),T=cu(s),D=uu(),x=du(s),V=mu(s),G=pu(s),B=ce(s,z=>z?.modelId),U=Ms(s);mn(()=>{B&&U?.kind===Pe.GizmoInteraction&&U.gizmo&&fu(B,U.gizmo)?a.top.set(I.ProjectConversationTaskNoFileAccess):g.eligible?a.top.set(I.AdvancedVoiceOnMobileAnnouncement):d?a.top.set(I.BannerTermsDisclaimer):l?a.top.set(I.BannersRateLimit):D?a.top.set(I.BannerPlusUpsell):x?a.top.set(I.ContextualAnswersAdminUpsell):V?a.top.set(I.ContextualAnswersUserUpsell):S?a.top.set(I.JawboneAnnouncement):v?a.top.set(I.JawboneMaxActiveAnnouncement):u.eligible?a.top.set(I.BannerSidekickAnnouncement):c?a.top.set(I.MoonshineAnnouncement):p?a.top.set(I.CustomizeChatGPTAnnouncement):m?a.top.set(I.SearchBrowserExtensionAnnouncement):b?a.top.set(I.SearchBrowserExtensionReactiveAnnouncement):y?a.top.set(I.PromoRedemptionAnnouncement):k?a.top.set(I.OperatorAnnouncement):E?a.top.set(I.ReferralProgramUpsellAnnouncement):n?a.top.set(I.PromptTextareaAction):i?a.top.set(I.BannerSignup):h?a.top.set(I.BannerMemoryFull):A?a.top.set(I.ReferrerRedemptionAvailableAnnouncement):R?a.top.set(I.RefereeRedemptionAvailableAnnouncement):w?a.top.set(I.StudentsUpsellAnnouncement):_?a.top.set(I.ModelDeprecationBanner):T?a.top.set(I.TeamsContextualAnswersUpsell):G?a.top.set(I.LanguageUpsellBanner):a.top.set(null)},[a,n,d,i,l,u,h,g]),mn(()=>{r&&a.bottom.set(si.DallePromptControls)},[a,r])}function Tf(){const{store:t}=ye();f.useEffect(()=>()=>{t.reset()},[t])}function Nf(t){const{isUnauthenticated:s}=Re(),{layer:n}=$e("3637408529",{shouldLogExposure:!1}),{layer:o}=$e("3637408529"),a=o.get("no_auth_banner_signup_rate_limit",Mf),r=n.get("should_show_no_auth_signup_banner",!0),i=gu(c=>c.bannerDisclaimerClientThreadId),d=hu(),l={shouldShowBannerTermsDisclaimer:!1,shouldShowBannerSignup:!1},[u,m]=ce(t,c=>[ee.getConversationTurns(c).filter(p=>p.role===Di.User).length,Bf(ee.getCurrentNode(c)?.message)]);return t&&(l.shouldShowBannerTermsDisclaimer=m&&s&&u===1&&!d&&(i==null||i===t),l.shouldShowBannerSignup=r&&m&&s&&u>0&&u%a===0),l}function Bf(t){return t?.author.role===Di.Assistant&&wm(t)}function Xi({clientThreadId:t,getInputProps:s,openFileDialog:n,uploadType:o,icon:a,isDisabled:r=!1,isSmall:i=!1,showLabel:d=!1,showUpsell:l=!1,hideBorder:u=!1,highlightTooltip:m=!1,disabledReason:c,currentModelName:p,visualTreatment:b}){const h=K(),g=Es();r=(r||!!g)&&!l;const S=e.jsxs(xu,{disabled:r,$showLabel:d,$hideBorder:u,$isSmall:i,$visualTreatment:b,onClick:k=>{if(k.preventDefault(),l){N.logNoAuthAttachButtonClicked({location:"No auth upsell"});return}N.logEvent("Open File Viewer",{intent:o.toString()}),n()},"aria-label":r?c===Ct.ModelNotSupported?h.formatMessage({id:"pEB4vw",defaultMessage:"Attachments disabled for {modelName}"},{modelName:`${p}`}):c===Ct.ThinkModeInUse?h.formatMessage({id:"NRk4QL",defaultMessage:"Attachments disabled for Reason mode"}):c===Ct.SearchModeInUse?h.formatMessage({id:"YlO80p",defaultMessage:"Attachments disabled for Search mode"}):h.formatMessage({id:"PromptFilePicker.attachFilesUnavailable",defaultMessage:"Attach files is unavailable"}):h.formatMessage({id:"PromptFilePicker.attachFiles",defaultMessage:"Upload files and more"}),children:[a,d&&e.jsx(ni,{})]}),v=e.jsx("input",{disabled:r,...s({className:"hidden"})}),y=e.jsxs("div",{className:"flex",children:[S,v]});return l?e.jsx($t,{label:e.jsx(P,{id:"wkpQmi",defaultMessage:"Upload files and more"}),side:"bottom",open:m||void 0,children:e.jsx(bu,{triggerButton:y,sideOffset:0,alignOffset:0,children:e.jsx(Cn,{location:"attach",statsig_login_event:"chatgpt_composer_upsell_login_button_clicked",statsig_signup_event:"chatgpt_composer_upsell_signup_button_clicked"})})}):e.jsx(Gi,{disabled:r,clientThreadId:t,rateLimitPopup:g,highlightTooltip:m,children:y})}function If({code:t,message:s}){switch(t){case ca.FileTooLarge:return Ta.errorFileTooLarge;case ca.TooManyFiles:return N.logEvent("Uploaded Max Files Error"),Ta.errorTooManyFiles;default:return s}}const Ta=Be({attachImages:{id:"PromptFilePicker.attachImages",defaultMessage:"Attach images"},attachFiles:{id:"PromptFilePicker.attachFiles",defaultMessage:"Upload files and more"},errorFileTooLarge:{id:"PromptFilePicker.errorFileTooLarge",defaultMessage:"Your file is too large. The maximum file size is {size}MB."},errorTooManyFiles:{id:"PromptFilePicker.errorTooManyFiles",defaultMessage:"You may only upload {maxNum} files at a time."},defaultFileUploadRateLimited:{id:"U5qAWP",defaultMessage:"You've reached your daily upload limit. Get ChatGPT Plus to unlock more."},getPlusButton:{id:"TeyLcp",defaultMessage:"Get Plus"}}),Na=Be({dragInstructions:{id:"FileDropZone.dragInstructions",defaultMessage:"Add anything"},dragAllAccepted:{id:"FileDropZone.dragAllAccepted",defaultMessage:"Drop any file here to add it to the conversation"}});function Df(t){if(!t.accept||Object.keys(t.accept).length===0)return[];const s=[];return Object.values(t.accept).forEach(n=>s.push(...n)),s.sort()}function zg(t){const{className:s,children:n,clientThreadId:o,currentModelConfig:a,noKeyboard:r}=t,i=K(),d=Qe(),l=Ms(o),u=Yt(),m=bs(a,l,u),c=m!==at.None,p=rn(E=>E.files),b=(m===at.Multimodal?Nn:Bn)-p.length,h=b<=0,{getGizmoId:g}=In(),{handleFileAccepted:S}=io(i,m,On(a,l),"drag",g,Dn(a,l)?.attachments),v=Es(),y=Ln(Fn(a,l)),{getRootProps:k,isDragActive:A}=no({maxFiles:b,disabled:!c||h||v!=null,noClick:!0,noKeyboard:r,onDropAccepted:S,onDropRejected:E=>ao(E,i,d,m),multiple:!0,maxSize:Hn,...y}),R=Df(y);return e.jsxs("div",{...k({className:s}),children:[n,A&&e.jsxs(Of,{children:[e.jsx(yu,{}),e.jsx("h3",{children:e.jsx(P,{...Na.dragInstructions})}),e.jsx("h4",{className:"w-2/3 text-center",children:R.length>0?R.join(", "):e.jsx(P,{...Na.dragAllAccepted})})]})]})}function ao(t,s,n,o){const{errors:a}=t[0];a.forEach(r=>{const i=If(r);typeof i=="string"?n.danger(i,{hasCloseButton:!0}):n.danger(s.formatMessage(i,{size:Cu,maxNum:o===at.Multimodal?Nn:Bn}),{hasCloseButton:!0})})}function io(t,s,n,o,a,r){const i=Ke(),d=Oi(i).flags,l=Qe(),u=Tn(),m=oi(),{isUnauthenticated:c}=Re(),p=d?.includes(vs.NoAuthEnableFileUploads);return{handleFileAccepted:f.useCallback(async(h,g)=>{N.logEvent("Upload File",{client:"web",eventSource:o,intent:s.toString()}),m.fileUploadAccepted();const S=a!=null?await a():void 0;h.length>0&&h.forEach(v=>{gs.uploadFile(u,Su(v),v,s,n,t,l,{gizmoId:S,...p&&{isUnauthenticated:c}},r)})},[o,s,a,u,m,n,t,l,r,p,c])}}const Of=Yn.div`absolute z-50 inset-0 flex gap-2 flex-col justify-center items-center after:contents-[""] after:absolute after:opacity-80 after:z-[-1] after:bg-token-main-surface-primary after:inset-0`,Ji=t=>{const s=[];s.push({category:null,systemHints:t.filter(n=>!n.category)});for(const n of jm)s.push({category:n,systemHints:t.filter(o=>o.category===n)});return s};function Zi({composerController:t,clientThreadId:s,onHintSelected:n}){const o=Li(s),[a]=ce(s,B=>[B?.modelId]),{data:r}=Jt(),i=a??vu(void 0).id,d=ai(r?.models,i),{configurationMenuType:l}=Ie(),{setThreadSystemHintMode:u,clearAllSystemHintModeTriggers:m}=pe(),{viewableSystemHints:c,persistedSystemHints:p}=Ye.useState(({availableHints:B,persistedSystemHints:U})=>({viewableSystemHints:B,persistedSystemHints:U})),[b,h]=f.useState([]),[g,S]=f.useState(void 0),[v,y]=f.useState(0);f.useEffect(()=>{if(!g)h([]);else{const B=g.text.toLocaleLowerCase(),U=c.filter(j=>{const H=j.name.toLocaleLowerCase().startsWith(B),q=j.systemHint.toLocaleLowerCase().startsWith(B);let L=!1;return j.regexMatches&&j.regexMatches.length>0&&(L=j.regexMatches.some(se=>se.replace(/[\^\$\(\)]/g,"").toLocaleLowerCase().startsWith(B))),H||q||L}).filter(j=>j.requiredFeatures.every(H=>d?.enabledTools?.includes(H))),z=Ji(U).map(j=>j.systemHints).flat();h(z)}},[g]),f.useEffect(()=>{t.view.dispatch(ip(t.view.state.tr,{onHintMatch(B){S(U=>_m(U,B)?U:B)}}))},[t]);const k=!c.length||!b.length||!g;f.useEffect(()=>{y(0)},[k]);const A=b.length,R=f.useCallback(B=>{y(U=>(B(U)%A+A)%A)},[A]),E=f.useCallback(()=>{y(-1)},[]),w=b[v],_=f.useCallback(()=>{g?.range&&t.delete(g.range.from,g.range.to)},[g,t]),T=({hintToSave:B=w,expectPerfectMatch:U})=>{if(!g||!w||U&&B.name.toLowerCase()!==g.text.toLowerCase())return!1;N.logEvent("System Hint Selected",{system_hint:B.systemHint,conversation_id:o??dn});const z=g.range.from===1?B.name:g.text+B.name.slice(g.text.length),j={clientThreadId:s};ps(t.view),p.size>0&&m();const H=!!B.composerBarButtonInfo,q=B.systemHint===M.Search;return H||q||l!=="none"?(u(B.systemHint,!0,j,q?wu.CONVERSATION_COMPOSER_SLASH_SEARCH:void 0),_(),t.removeSystemHints(),!0):(t.addSystemHint(B.systemHint,z,g.range.from,g.range.to),!0)},D=f.useRef(T);D.current=T;const x=f.useRef(R);x.current=R;const V=f.useRef(g);V.current=g;const G=t.view;return f.useEffect(()=>(k||rp(G,B=>{if(B==="up")x.current(U=>U-1);else if(B==="down")x.current(U=>U+1);else if(B==="cancel")ps(G),lp(G);else if(B==="submit")if(n)_(),n(w.systemHint);else return ps(G),D.current({expectPerfectMatch:!1});else if(B==="checkMatch")return D.current({expectPerfectMatch:!0})}),()=>ps(G)),[k,G,w,n,_]),f.useEffect(()=>{k||N.logEvent("System Hint List Opened",{conversation_id:o??dn})},[k]),{suggestorClosed:k,systemHintSuggestions:b,hintMatch:g,selectedIndex:v,resetSelectedIndex:E,setSelectedIndex:y,saveHint:T}}function Lf({composerController:t,clientThreadId:s}){const{selectedIndex:n,systemHintSuggestions:o,suggestorClosed:a,setSelectedIndex:r,saveHint:i}=Zi({composerController:t,clientThreadId:s});return a?null:e.jsx(_u,{className:"max-w-60",onMouseDown:d=>{d.preventDefault()},children:o.map((d,l)=>e.jsx("div",{onMouseOver:()=>r(l),onClick:()=>{i({hintToSave:d,expectPerfectMatch:!1}),t.focus()},children:e.jsx(ju,{autoFocus:!1,className:"rounded-lg px-1 py-2",highlighted:l===n,children:e.jsx(er,{title:d.name,description:d.description,logo:d.logo})})},d.systemHint))})}function er({title:t,description:s,logo:n,checked:o,badge:a}){const r=K();return e.jsxs("div",{className:"group inline-flex w-full items-center justify-start gap-2 ps-1.5 pe-3",children:[e.jsx("div",{className:"flex h-7 w-7 items-center justify-center gap-2.5",children:e.jsx(Xt,{svgString:n,className:"icon-lg text-token-text-secondary"})}),e.jsxs("div",{className:"shrink grow basis-0",children:[e.jsxs("p",{className:"text-token-text-primary text-sm leading-tight font-normal",children:[t,a&&e.jsx("span",{className:"ms-2 rounded-full bg-blue-400 px-2 py-0.5 text-xs text-white","aria-label":r.formatMessage({id:"I75WNJ",defaultMessage:"Create image updated"}),children:e.jsx(P,{id:"uUmZQi",defaultMessage:"Updated"})})]}),!!s&&e.jsx("p",{className:"text-token-text-secondary text-[13px] leading-[18px] font-normal",children:s})]}),o&&e.jsx(ku,{className:W("icon-md text-token-text-primary",{"group-hover:hidden":!o})})]})}function Ba({composerController:t,clientThreadId:s}){return t instanceof cp?e.jsx(Lf,{composerController:t,clientThreadId:s}):null}function tr({children:t,className:s,showBackground:n,showGlowingBorder:o}){return e.jsxs("div",{className:W("relative",o&&"overflow-clip rounded-full p-0.5"),children:[t,o&&e.jsx("div",{className:"border-glowing-gradient"}),n&&e.jsx(J.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:W("pointer-events-none absolute inset-0 rounded-full",s)})]})}const Ff=({showUnconnectedInSubmenu:t,unconnectedConnectors:s,handleOauthRedirect:n,handleConnectorClick:o,showOneDriveInSubmenu:a,isConnectorConfigLoading:r,connectedConnectors:i,desktopConnectors:d,modelSupportedImageMimeTypes:l,showMenuForNoAuth:u,handleLocalFileUploadClick:m,unconnectedOneDriveConnectors:c})=>{const[p,b]=f.useState("main"),h=p!=="main",g=K(),S=f.useRef(null),v=Un();return f.useEffect(()=>{h?document.getElementById("vanguard-file-picker-popover-submenu-back-button")?.focus():S.current&&S.current.focus()},[h]),e.jsx("div",{className:W("max-h-[max(calc(var(--radix-popover-content-available-height)-64px), 215px)] flex flex-1 snap-y snap-proximity flex-col overflow-y-auto scroll-smooth py-2 [scrollbar-gutter:stable] focus-visible:rounded-[inherit] focus-visible:-outline-offset-1"),ref:S,tabIndex:0,children:e.jsxs(ut,{mode:"wait",children:[e.jsx(J.div,{className:"flex flex-col",transition:v?Wt:xs,children:p==="main"&&e.jsx(Hf,{showUnconnectedInSubmenu:t,unconnectedConnectors:s,setActiveMenu:b,handleConnectorClick:o,showOneDriveInSubmenu:a,isConnectorConfigLoading:r,connectedConnectors:i,desktopConnectors:d,modelSupportedImageMimeTypes:l,showMenuForNoAuth:u,handleLocalFileUploadClick:m})},"main"),h&&e.jsxs(J.div,{initial:{clipPath:"inset(0 100% 0 0)",opacity:0},animate:{clipPath:"inset(0 0% 0 0)",opacity:1},transition:v?Wt:xs,className:"flex flex-col",children:[e.jsxs("div",{className:"border-token-border-xlight bg-token-main-surface-primary dark:bg-token-main-surface-secondary sticky start-0 top-0 z-10 flex w-full flex-row items-center justify-center overflow-clip border-b px-3 py-3",children:[e.jsx("button",{onClick:()=>b("main"),id:"vanguard-file-picker-popover-submenu-back-button",className:"hover:bg-token-main-surface-tertiary flex items-center rounded-md p-1",children:e.jsx(Ja,{className:"text-token-text-secondary h-5 w-5","aria-label":""})}),e.jsx("div",{className:"flex-auto text-center text-sm font-medium",children:g.formatMessage({id:"LlLQYj",defaultMessage:"Back"})}),e.jsx("div",{className:"w-5"})]}),e.jsxs("div",{className:"flex w-full flex-col py-2",children:[p==="connect-apps"&&e.jsx(Ru,{connectorEntries:s,onOauthRedirect:n}),p==="one-drive"&&e.jsx(Mu,{connectorEntries:c,onOauthRedirect:n})]})]},p)]})})};function Hf({showUnconnectedInSubmenu:t,unconnectedConnectors:s,showOneDriveInSubmenu:n,setActiveMenu:o,handleConnectorClick:a,isConnectorConfigLoading:r,connectedConnectors:i,desktopConnectors:d,modelSupportedImageMimeTypes:l,showMenuForNoAuth:u,handleLocalFileUploadClick:m}){const c=K();return e.jsxs(e.Fragment,{children:[t&&s.length>0&&e.jsx(ct,{label:c.formatMessage(Ia.connectApps),icon:kn,isSubMenuTrigger:!0,onClick:()=>o("connect-apps")},"connect-apps-submenu-trigger"),!t&&s.map(p=>e.jsx(Ss,{entry:p,onClick:()=>a(p),visualTreatment:"vanguard"},p.id)),n&&e.jsx(ct,{label:c.formatMessage(Ia.oneDriveSubmenuName),icon:Au,isSubMenuTrigger:!0,onClick:()=>o("one-drive")},"one-drive-submenu-trigger"),r&&e.jsx(ct,{icon:e.jsx(Qt,{className:"text-token-text-secondary"})}),(s.length>0||r)&&e.jsx(Za,{}),i.map(p=>e.jsx(Ss,{entry:p,onClick:()=>a(p),visualTreatment:"vanguard"},p.id)),d.map(p=>e.jsx(ii,{entry:p,visualTreatment:"vanguard"},p.key)),e.jsx(ri,{modelSupportedImageMimeTypes:l}),e.jsx(li,{handleLocalFileUploadClick:m,showMenuForNoAuth:u})]})}const Ia=Be({connectApps:{id:"ContextConnectorPicker.connectApps",defaultMessage:"Connect apps"},oneDriveSubmenuName:{id:"ContextConnectorPickerOneDriveSubmenu.oneDriveSubmenuName",defaultMessage:"Connect to Microsoft OneDrive"}}),Uf=({layoutMode:t,triggerButton:s,restoreFocus:n,...o})=>e.jsxs(eo,{layoutMode:t,restoreFocus:n,children:[s,e.jsx(to,{align:"start",children:e.jsx(Ff,{...o})})]});function Gf(){const{connectorConfig:t}=ci(),s=Gn(),n=zn(),[o,a]=Cs(ui([...t.values()],m=>!!m.access_token),m=>!!m.access_token),[r,i]=Cs(a,m=>m.type===qe.O365_PERSONAL||m.type===qe.O365_BUSINESS),d=!s&&!n&&o.length>0,l=!s&&!n&&!d&&r.length>1;return{unconnectedConnectors:n?[]:l?i:a,showUnconnectedInSubmenu:d,showOneDriveInSubmenu:l}}function sr({clientThreadId:t,icon:s,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:o,attachmentsProductFeature:a,onOauthRedirect:r,uploadType:i,getInputProps:d,openFileDialog:l,isDisabled:u=!1,highlightTooltip:m=!1,showLabel:c,isSmall:p=!1,hideBorder:b=!1,disabledReason:h,currentModelName:g,visualTreatment:S="vanguard",showMenuForNoAuth:v=!1,showGlowingBorder:y=!1,layoutMode:k="centered",restoreFocus:A}){const R=km().locale,E=K(),w=Qe(),_=Tn(),T=Es(),{connectorConfig:D,isLoading:x}=ci(),V=Ne(me.ContextConnectors),{getGizmoId:G}=In(),{value:B}=ie("58345806"),{configurationMenuType:U}=Ie(),z=U!=="none",j=B&&S==="vanguard",[H,q]=f.useState();f.useEffect(()=>{G?G().then(O=>q(O)):q(void 0)},[G]);const L=f.useRef(null),[se,ae]=f.useState(!1),ve=f.useRef(!1),Rt=f.useCallback(()=>{const O=L.current?.files;Array.from(O??[]).forEach(re=>Lt.uploadFile(_,re,o,E,w,a))},[_,o,E,w,a]),[Xe,fe]=f.useState(null),Me=f.useCallback(()=>fe(null),[fe]),De=f.useCallback((O,re)=>Lt.uploadPickedFile(_,O,re,o,n,a,H,E,w),[_,o,n,a,H,E,w]),{openMenu:Oe,confirmMenuOpened:Je}=Eu();f.useEffect(()=>{Oe&&(ae(!0),Je())},[Oe,Je,ae]);const ue=f.useCallback(O=>{Lt.doContextConnectorOauthRedirect(location.pathname+location.search+location.hash,O,r,va.Picker),r()},[r]),Ze=f.useCallback(O=>{Lt.uploadPickedFile(_,O,qe.GDRIVE,o,n,a,H,E,w)},[_,o,n,a,H,E,w]),ne=f.useCallback(async O=>{const{access_token:re}=O;if(!re){ue(O);return}switch(Lt.logAttemptIfAccessTokenIsExpired(O,va.Picker),O.type){case qe.GDRIVE:Pu(R,O.type,re,mt=>mt.forEach(Ze));break;case qe.O365_PERSONAL:case qe.O365_BUSINESS:fe(O.type);break}},[Ze,ue,fe,R]),ge=()=>{N.logEvent("Open File Viewer",{intent:i.toString()}),l()},et=O=>{if(!O&&ve.current&&!x)ge();else if(O&&Ae&&!x&&!v){ge();return}ae(O),O&&(V.eligible&&V.markAsViewed(),N.logEventWithStatsig("Composer: Open Context Connector Picker","chatgpt_composer_open_context_connector_picker"),ve.current=!0,setTimeout(()=>{ve.current=!1},250))},[Le,tt]=Cs(ui([...D.values()],O=>!!O.access_token),O=>!!O.access_token);zf(Le,ne);const[Fe]=Cs(tt,O=>O.type===qe.O365_PERSONAL||O.type===qe.O365_BUSINESS),{unconnectedConnectors:X,showUnconnectedInSubmenu:he,showOneDriveInSubmenu:He}=Gf(),{desktopConnectors:Ue}=Tu(o),Ae=!Le.length&&!X.length&&!Ue.length,Mt=e.jsxs(e.Fragment,{children:[he&&X.length>0&&e.jsx(Nu,{connectorEntries:X,onOauthRedirect:O=>ue(O)}),!he&&X.map(O=>e.jsx(Ss,{entry:O,onClick:()=>ne(O)},O.id)),He&&e.jsx(Bu,{connectors:Fe,onOauthRedirect:ue}),x&&e.jsx(F.Item,{icon:e.jsx(Qt,{className:"text-token-text-secondary"})}),(X.length>0||x)&&e.jsx(F.Separator,{}),Le.map(O=>e.jsx(Ss,{entry:O,onClick:()=>ne(O)},O.id)),Ue.map(O=>e.jsx(ii,{entry:O},O.key)),e.jsx(ri,{modelSupportedImageMimeTypes:o}),e.jsx(li,{handleLocalFileUploadClick:ge,showMenuForNoAuth:v})]}),we=u||T!=null,Ge=f.useRef(!1);let _e;z?_e=e.jsx(Gi,{clientThreadId:t,rateLimitPopup:T,highlightTooltip:m,disabled:we,disabledReason:h,currentModelName:g,children:e.jsxs(F.BasicTrigger,{className:"composer-btn",disabled:we,id:"upload-file-btn","aria-label":tp(E,we,h,g),children:[s,c&&e.jsx(ni,{})]})}):j?_e=e.jsx(sp,{clientThreadId:t,icon:s,isDisabled:we,highlightTooltip:m,showLabel:c,hideBorder:b,isSmall:p,disabledReason:h,currentModelName:g,visualTreatment:S,isLoading:x,handleLocalFileUploadClick:ge,noAvailableConnectors:Ae,showMenuForNoAuth:v,announcement:V,rateLimit:T}):_e=e.jsx(np,{clientThreadId:t,icon:s,setOpen:et,open:se,isDisabled:we,highlightTooltip:m,showLabel:c,hideBorder:b,isSmall:p,disabledReason:h,currentModelName:g,visualTreatment:S,showGlowingBorder:y,rateLimit:T});const dt=j?e.jsx(Uf,{layoutMode:k,triggerButton:_e,showUnconnectedInSubmenu:he,unconnectedConnectors:X,handleOauthRedirect:ue,handleConnectorClick:ne,showOneDriveInSubmenu:He,isConnectorConfigLoading:x,connectedConnectors:Le,desktopConnectors:Ue,modelSupportedImageMimeTypes:o,showMenuForNoAuth:v,handleLocalFileUploadClick:ge,unconnectedOneDriveConnectors:Fe,restoreFocus:A}):e.jsxs(F.Root,{open:se,onOpenChange:et,children:[_e,e.jsx(F.Portal,{children:e.jsx(F.Content,{alignOffset:-8,onEscapeKeyDown:()=>{Ge.current=!0},side:z?"bottom":"top",size:"small",onCloseAutoFocus:O=>{Ge.current||O.preventDefault()},className:"radix-side-bottom:flex-col-reverse flex flex-col",children:Mt})})]});return e.jsxs("div",{className:"flex flex-col",children:[e.jsx(Iu,{type:Xe,onClose:Me,uploadPickedFile:De}),e.jsx("input",{onChange:Rt,...d({className:"hidden"})}),dt,e.jsx(Du,{hasConnectors:!x&&!Ae})]})}function zf(t,s){const{connector:n,clearParam:o}=Ou(),a=t.find(r=>r.type===n&&!!r.access_token);f.useEffect(()=>{a&&(s(a),o())},[a,s,o])}function Wf({clientThreadId:t,uploadType:s,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:o,attachmentsProductFeature:a,getInputProps:r,openFileDialog:i,onOauthRedirect:d,historyDisabled:l,isDisabled:u,highlightTooltip:m,disabledReason:c,currentModelName:p,showLabel:b,showUpsell:h,hideBorder:g,isSmall:S,showMenuForNoAuth:v,visualTreatment:y,showGlowingBorder:k}){const A=zn(),{gdriveStatus:R,o365Status:E}=di(),{isUnauthenticated:w}=Re(),_=l?"text-white":m?"text-brand-blue-800":"",T=!h&&(v||R!=="false"||E!=="false"||A),D=w?ln:Lu,x=e.jsx(D,{"aria-label":"",className:W("icon-md",_)}),V=T?e.jsx(sr,{showGlowingBorder:k,hideBorder:g,isSmall:S,clientThreadId:t,icon:x,showLabel:w&&b,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:o,attachmentsProductFeature:a,onOauthRedirect:d,uploadType:s,openFileDialog:i,getInputProps:r,isDisabled:u,highlightTooltip:m,disabledReason:c,currentModelName:p,showMenuForNoAuth:v,visualTreatment:y}):e.jsx(Xi,{isSmall:S,hideBorder:g,clientThreadId:t,uploadType:s,openFileDialog:i,getInputProps:r,showLabel:b,showUpsell:h,icon:x,isDisabled:u,highlightTooltip:m,disabledReason:c,currentModelName:p,visualTreatment:y});return e.jsx(tr,{showBackground:m,showGlowingBorder:k,className:"bg-brand-blue-800/20",children:V})}const Vf=f.forwardRef(function({type:s,placeholder:n,replyRegions:o,state:a,renderFiles:r,leftSideActions:i,topRightAction:d,onSubmit:l,setIsComposerOverflowing:u,inputState:m,composerController:c,clientThreadId:p,gizmoId:b,disableReason:h,matchaData:g},S){const v=Fu();let y=null;const{isLoading:k}=v;k||(y=v.modelId),f.useEffect(()=>{k||Hu()||c.focus()},[y,c,k]);const{value:A}=ie("3780975974"),{state:R,shouldShowResearchText:E}=ys(p),w=f.useCallback(()=>e.jsx(mi,{useStartButtonText:R==="clarify"||!1,inputState:m,state:a,onSubmit:l,composerController:c,clientThreadId:p,gizmoId:b,disableReason:h}),[m,a,l,c,p,b,h,g,R]),{whisperControls:_,waveContainerRef:T}=zi({composerController:c,renderInComposer:w,composerType:"legacy"}),{controlsDisabled:D,waveformData:x,waveWidth:V}=it(c.store),{getShowUpsellReason:G}=pi(),B=A||G(),U=z=>{qf({target:z.target,rootId:"composer-background",additonalInteractiveIds:["reply-regions"]})||c.focus()};return e.jsx(Uu,{id:"composer-background",ref:S,className:W("border-token-border-default flex w-full cursor-text flex-col overflow-clip rounded-t-3xl border-t duration-150 ease-in-out contain-inline-size motion-safe:transition-[color,background-color,border-color,text-decoration-color,fill,stroke,box-shadow,bottom] dark:border-none dark:shadow-none",s!=="temporary"&&"shadow-[0_9px_9px_0px_rgba(0,0,0,0.01),_0_2px_5px_0px_rgba(0,0,0,0.06)] has-focus:shadow-[0_2px_12px_0px_rgba(0,0,0,0.04),0_9px_9px_0px_rgba(0,0,0,0.01),0_2px_5px_0px_rgba(0,0,0,0.06)]",s!=="temporary"&&"bg-token-main-surface-primary dark:bg-[#303030]",s==="temporary"&&"dark bg-[#303030]","rounded-b-3xl border-b"),onClick:U,style:{viewTransitionName:"var(--vt-composer)"},children:e.jsxs("div",{className:"px-3 py-1",children:[e.jsx(ut,{initial:!1,children:o.length>0&&e.jsx(J.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0,transition:{duration:.06}},transition:{ease:"easeOut",duration:.1},id:"reply-regions",children:e.jsx("div",{className:"-mx-2",children:e.jsx(fi,{replyRegions:o})})})}),e.jsxs(e.Fragment,{children:[r,e.jsx(ut,{initial:!1,children:e.jsx(dp,{enabled:E,composerController:c,visualTreatment:"legacy",children:e.jsxs("div",{id:"composer-waveform-container",className:"flex min-h-[44px] items-start ps-1",ref:T,children:[e.jsx("div",{className:"max-w-full min-w-0 flex-1",children:D?x?e.jsx(Gu,{waveform:x,containerWidth:V,scaleFactor:10,initialValue:mp}):null:e.jsx(pp,{composerController:c,placeholder:n})}),e.jsx("div",{className:"w-[32px] pt-1",children:d})]})})}),e.jsxs("div",{className:"mt-1 mb-2 flex items-center justify-between sm:mt-5",ref:z=>{if(!B||!("ResizeObserver"in window))return;const j=new AbortController;let H=window.innerWidth;const q=zu({axis:"width",debounce:!0,target:z,onChange:()=>{if(!z)return;z.scrollWidth>z.clientWidth?u?.(!0):Math.abs(H-window.innerWidth)>40&&(u?.(!1),H=window.innerWidth)}});return()=>{q?.(),j.abort()}},children:[e.jsx("div",{className:"text-token-text-primary flex gap-x-1.5",id:"composer-left-actions",children:i}),e.jsx("div",{className:"flex gap-x-1.5",id:"composer-voice-controls",children:_})]})]})]})})});function qf({target:t,rootId:s,additonalInteractiveIds:n}){let o=t;for(;o&&o!=null;){if(o.tagName==="BUTTON"||o.tagName==="INPUT"||o.tagName==="TEXTAREA"||o.isContentEditable||n.includes(o.id))return!0;if(o.id===s)return!1;o=o.parentElement}return!1}const Yf=["o3-mini","o3-mini-high","o1-pro"],$f=[M.Search,M.Research],Kf=5,Qf=({composerController:t,clientThreadId:s,hideThinkButton:n,disableIfNoAccess:o,disabled:a})=>{const{prospectiveModelId:r}=Rs(s),{systemHints:i,activeSystemHints:d,isLoading:l}=Wn(s),u=ie("2868048419"),m=Ai(j=>j.bySystemHint(M.Research)),c=Kn(),p=$n(),{value:b}=ie("1416952492"),h=Te(j=>j.isVisuallyOverflowing),{showLegacyReasoningSlider:g,hideSearchInSystemHintOverflow:S,hideReasonInSystemHintOverflow:v,configurationMenuType:y}=Ie(),k=kt()?.isFree(),A=y!=="none",R=d.filter(j=>A&&(k||j.systemHint!==M.Think)||S&&j.systemHint===M.Search||v&&j.systemHint===M.Think?!0:h&&g?j.systemHint!==M.Think&&!j.composerBarButtonInfo&&!$f.includes(j.systemHint):!j.composerBarButtonInfo&&j.systemHint!==M.Search&&(!u||j.systemHint!==M.PictureV2)&&(!n||j.systemHint!==M.Think));if(A&&k&&!R.find(j=>j.systemHint===M.Think)){const j=i.find(H=>H.systemHint===M.Think);j&&R.push(j)}const E=Vn(t),w=Wu(t,s),{clearAllSystemHintModeTriggers:_}=pe(),T=r&&Yf.includes(r),D=R.length===0&&!l||T;if(!o&&D)return null;const x={clientThreadId:s};function V(){N.logEventWithStatsig("Composer System Hint Button Hovered","composer_system_hint_button_hovered",x)}function G(){N.logEventWithStatsig("Composer System Hint Button Clicked","composer_system_hint_button_clicked",x)}const B=j=>{switch(j){case M.Research:return!!p;case M.Think:return!!c;default:return!1}},U=()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{t.focus()})})},z=A?Jf:Xf;return e.jsx(z,{systemHints:R,selectedHint:E??void 0,disabled:a,onHover:V,onOpen:G,onSelect:w,clientThreadId:s,isDeepResearchHighLoad:b,getFeatureRateLimitIndicator:j=>{switch(j){case M.Research:return Zf(m);case M.Think:return c?e.jsx(Kt,{"aria-label":"",className:"icon-md text-token-text-secondary h-5 w-5"}):null;default:return null}},hasFeatureRateLimit:B,setRateLimitBannerFeature:j=>{switch(j){case M.Research:case M.Think:B(j)?(_(),t.setRateLimitBannerFeature(j===M.Research?wa.DEEP_RESEARCH:wa.REASON)):t.setRateLimitBannerFeature(null);break;default:t.setRateLimitBannerFeature(null);break}},restoreFocus:U})},Xf=({systemHints:t,selectedHint:s,disabled:n,onHover:o,onOpen:a,onSelect:r,isDeepResearchHighLoad:i,hasFeatureRateLimit:d,restoreFocus:l})=>{const u=K(),[m,c]=f.useState(!1),p=t.find(S=>S.systemHint==="contextual_answers")?.name,b=f.useRef(!1);f.useEffect(()=>{if(!m)return()=>{requestAnimationFrame(()=>{b.current=!1})}},[m]);const h=f.useRef(!1),g=t.length===0?e.jsxs("div",{className:"mx-2 flex min-h-[40px] flex-col justify-center gap-2",children:[e.jsx("div",{className:"loading-results-shimmer bg-token-bg-tertiary h-9 w-[180px] rounded-md"}),e.jsx("div",{className:"loading-results-shimmer bg-token-bg-tertiary h-9 w-[180px] rounded-md"})]}):e.jsx(e.Fragment,{children:t.map(S=>e.jsx(F.Item,{className:"px-1 py-2",onClick:()=>{const v=S.systemHint!==s;d(S.systemHint)||(b.current=!0,r?.({hint:S,enable:v}))},disabled:S.systemHint===M.Research?i:void 0,children:e.jsx(er,{title:S.name,description:S.description,logo:S.logo,checked:S.systemHint===s,badge:S.systemHint===M.PictureV2})},S.systemHint))});return e.jsxs(F.Root,{open:m,onOpenChange:S=>{c(S),S?a?.():requestAnimationFrame(()=>{requestAnimationFrame(()=>{b.current&&l()})})},children:[e.jsx(nr,{disabled:!!n,contextualAnswersHintNameIfPresent:p,children:e.jsx(gi,{className:"border-token-border-default text-token-text-secondary radix-state-open:bg-black/10 can-hover:hover:bg-tertiary flex h-9 min-w-9 items-center justify-center rounded-full border p-1 text-xs font-semibold focus-visible:outline-black disabled:opacity-30 dark:focus-visible:outline-white","data-opened":cn(m),"aria-label":u.formatMessage({id:"oDAnGy",defaultMessage:"Use a tool"}),id:"system-hint-button",disabled:n,onPointerOver:o,onClick:S=>{S.preventDefault()},onFocusCapture:S=>{S.stopPropagation()},children:e.jsx(qu,{className:"pointer-events-none h-5 w-5"})})}),e.jsx(F.Portal,{children:e.jsx(F.Content,{size:"auto",alignOffset:-16,onEscapeKeyDown:()=>{h.current=!0},onCloseAutoFocus:S=>{if(!h.current||b.current){S.preventDefault();return}document.querySelector("#system-hint-button")?.focus()},children:g})})]})},Jf=({systemHints:t,selectedHint:s,disabled:n,onHover:o,onOpen:a,onSelect:r,clientThreadId:i,getFeatureRateLimitIndicator:d,isDeepResearchHighLoad:l,hasFeatureRateLimit:u,setRateLimitBannerFeature:m,restoreFocus:c})=>{const p=K(),[b,h]=f.useState(!1),g=t.find(w=>w.systemHint==="contextual_answers")?.name,{configurationMenuType:S}=Ie(),v=S==="config_icon"||S==="skills_icon",k=(S==="settings_icon"||S==="skills_icon")&&s==null,A=v?Vu:hi,R=f.useRef(!1);f.useEffect(()=>{if(!b)return()=>{requestAnimationFrame(()=>{R.current=!1})}},[b]);const E=f.useRef(!1);return e.jsxs(F.Root,{open:b,onOpenChange:w=>{h(w),w?a?.():requestAnimationFrame(()=>{requestAnimationFrame(()=>{R.current&&c()})})},children:[e.jsx(nr,{disabled:!!n,contextualAnswersHintNameIfPresent:g,newToolsConfigMenu:S,skip:k,children:e.jsxs(gi,{className:"composer-btn","data-opened":cn(b),"data-pill":cn(k),"aria-label":v?p.formatMessage({id:"RiMXTh",defaultMessage:"Use a skill"}):p.formatMessage({id:"mJYhKI",defaultMessage:"Choose tool"}),id:"system-hint-button",disabled:n,onPointerOver:o,onClick:w=>{w.preventDefault()},onFocusCapture:w=>{w.stopPropagation()},children:[e.jsx(A,{"aria-label":"",className:"icon-md"}),k&&e.jsx("span",{className:"ms-1.5 me-0.5",children:v?e.jsx(P,{id:"5+Ls1e",defaultMessage:"Skills"}):e.jsx(P,{id:"mNL7WC",defaultMessage:"Tools"})})]})}),e.jsx(F.Portal,{children:e.jsx(F.Content,{size:"auto",alignOffset:-8,onEscapeKeyDown:()=>{E.current=!0},onCloseAutoFocus:w=>{if(!E.current||R.current){w.preventDefault();return}document.querySelector("#system-hint-button")?.focus()},children:e.jsxs(F.RadioGroup,{value:s,onValueChange:w=>{const _=t.find(T=>T.systemHint===w);_&&(Sn(_.systemHint,_.systemHint===s?Se.Disable:Se.Enable,i),s===w?r?.({hint:_,enable:!1}):u(_.systemHint)||(R.current=!0,r?.({hint:_,enable:!0}),m(_.systemHint)))},children:[!k&&e.jsx(F.Label,{children:v?e.jsx(P,{id:"m/042P",defaultMessage:"Skills"}):e.jsx(P,{id:"KSn3Jr",defaultMessage:"Tools"})}),t.length===0?e.jsxs(e.Fragment,{children:[e.jsx(F.Shimmer,{}),e.jsx(F.Shimmer,{}),e.jsx(F.Shimmer,{})]}):e.jsx(e.Fragment,{children:t.map(w=>{const _=w.actionLabel??w.name,T=d(w.systemHint),D=w.systemHint===M.Research&&l,x=w.systemHint===s;return e.jsx(F.RadioItem,{value:w.systemHint,disabled:D,color:x?"selected":"default",icon:e.jsx(Xt,{svgString:w.logo,"aria-label":"",className:"icon-md"}),trailing:!D&&!x&&T?e.jsx("span",{className:"text-token-text-secondary",children:T}):e.jsx(F.RadioItemCheck,{}),children:D?e.jsxs("div",{className:"flex flex-col",children:[_,D&&e.jsx("span",{className:"text-xs",children:e.jsx(P,{id:"composer.skills.unavailable",defaultMessage:"Temporarily unavailable"})})]}):_},w.systemHint)})})]})})})]})},nr=({disabled:t,children:s,contextualAnswersHintNameIfPresent:n,newToolsConfigMenu:o,skip:a})=>{const r=o!=null,i=o==="config_icon"||o==="skills_icon",d=Ne(me.hasSeenComposerSystemHintButtonTooltip),l=Ne(me.hasSeenCaSystemHint),u=!t&&!d.isLoading&&d.eligible,m=!t&&!d.isLoading&&n&&!l.isLoading&&l.eligible,c=u?{announcementKey:me.hasSeenComposerSystemHintButtonTooltip,title:r&&i?e.jsx(P,{id:"H819Oo",defaultMessage:"ChatGPT skills, all in one place"}):e.jsx(P,{id:"tTydhk",defaultMessage:"All your tools, in one handy place"}),onDismiss:d.markAsViewed,description:e.jsx(P,{id:"Kgb5fv",defaultMessage:"Create an image, research report, and more."})}:m?{announcementKey:me.hasSeenCaSystemHint,title:e.jsx(P,{id:"uaC1JM",defaultMessage:"Not finding internal information?"}),onDismiss:l.markAsViewed,description:e.jsx(P,{id:"TL/S+W",defaultMessage:"If ChatGPT didn't search your files automatically, type {hintName} or select it from the menu.",values:{hintName:e.jsx("span",{className:"font-bold whitespace-nowrap",children:'"/'+n+'"'})}})}:void 0;if(a)return s;if(c)return e.jsx(An,{show:!0,side:"bottom",theme:"bright",dismissOnOutsideClick:!0,badge:"new",sideOffset:0,className:"xs:max-w-sm! max-w-2xs!",...c,children:s});let p;return t?p=i?e.jsx(P,{id:"R3rcdg",defaultMessage:"Skills unavailable"}):e.jsx(P,{id:"uw9x80",defaultMessage:"Tools unavailable"}):r?p=i?e.jsx(P,{id:"SiU5Ib",defaultMessage:"Choose skill"}):e.jsx(P,{id:"Yr1zf1",defaultMessage:"Choose tool"}):p=e.jsx(P,{id:"mrYNGk",defaultMessage:"View tools"}),e.jsx($t,{side:"bottom",label:p,children:s})};function Zf(t){return!t||t.remaining>Kf?null:t.remaining===0?e.jsx(Kt,{"aria-label":"",className:"icon-md text-token-text-secondary h-5 w-5"}):e.jsx(P,{id:"m6JsYD",defaultMessage:"{remaining} left",values:{remaining:t.remaining}})}const or=({clientThreadId:t})=>{const s=Rm(),{setThreadSystemHintMode:n}=pe(),o=s?.location.search;f.useEffect(()=>{if(new URLSearchParams(window.location.search).get("enable-internal-knowledge")==="true"&&document){n(M.ContextualAnswers,!0,{clientThreadId:t});const r=new URLSearchParams(window.location.search);r.delete("enable-internal-knowledge");const i=r.toString();window.history.replaceState({},document.title,`${window.location.pathname}${i?`?${i}`:""}`)}},[o,t,n])},eg=({composerController:t,systemHint:s,clientThreadId:n,connectionStatuses:o})=>{const a=_s(),r=s.systemHint,i=qt(r);or({clientThreadId:n});const d=Ke();if(!s.composerBarButtonInfo)return null;const l=o.some(p=>p.user_connection_details.activation_status==="partially_activated"||p.user_connection_details.activation_status==="activated"),u=Jn(d,"463092697")?.value,m=u?.enabled??!1,c=u?.enabledConnectors??[];return e.jsx(Ep,{composerController:t,systemHint:s,composerBarButtonInfo:s.composerBarButtonInfo,clientThreadId:n,isDisabled:!1,showLabel:a,dropdownContent:!l&&!m?e.jsx(gn,{}):void 0,splitButtonDropdownContent:m?e.jsx(Ts,{clientThreadId:n,enabledConnectors:c,includeSyncConnectors:!0,includeWebSearch:!1}):l&&i?e.jsx(gn,{}):void 0,dataTestid:Yu,tooltipPosition:"top",disableNuxMarkdown:!0,as:m?"dropdown":"popover"})},gn=()=>{const[t,s]=f.useState(),{connectionInstanceData:n,isLoading:o}=jn(),a=f.useMemo(()=>[...n?.connection_statuses??[]].sort(Ya),[n]),r=a.some(i=>i.user_connection_details.activation_status==="activating"||i.user_connection_details.activation_status==="partially_activated"||i.user_connection_details.activation_status==="inactive"&&i.user_connection_details.auth_status==="user_connected");return f.useEffect(()=>{N.logEventWithStatsig("Contextual Answers User Composer Dropdown Shown","chatgpt_contextual_answers_user_composer_dropdown_shown")},[]),o?e.jsx("div",{className:"w-full max-w-[calc(100vw-1.5rem)] min-w-[calc(100vw-1.5rem)] p-3 md:min-w-[22rem]",children:e.jsx(Cp,{lines:4,size:"lg"})}):e.jsxs(ut,{children:[t&&e.jsx($a,{connection:t,onClose:()=>s(void 0)}),e.jsxs("div",{className:"w-full max-w-[calc(100vw-1.5rem)] min-w-[calc(100vw-1.5rem)] px-1 py-3 md:min-w-[22rem]",children:[a.map(i=>{const d=i.user_connection_details.activation_status,l=d==="partially_activated"||d==="activating";return e.jsx(ua,{className:W(i.user_connection_details.activation_status==="activating"?"grayscale":void 0,l?"":"cursor-default"),onClick:u=>{l&&s(i),u.stopPropagation()},children:e.jsx($u,{title:i.connection_display_info.display_name,icon:e.jsx("img",{src:i.connection_display_info.icon_url??"",alt:i.connection_display_info.display_name,className:"icon-md"}),statusIndicator:e.jsx(Ka,{connection:i,location:"user_dropdown"})})},i.user_connection_details.connection_instance_id)}),e.jsx(ua,{onClick:i=>{window.location.hash="#settings/ConnectorSettings",i.stopPropagation()},children:e.jsxs("div",{className:"flex w-full flex-row items-center justify-start gap-4 text-start",children:[e.jsx(kn,{className:"icon-md"}),e.jsx("p",{className:"text-token-text-primary flex-1 text-sm font-medium",children:r?e.jsx(P,{id:"EqgQdy",defaultMessage:"See syncing state"}):e.jsx(P,{id:"05N3nu",defaultMessage:"Manage connectors"})})]})})]})]})};function tg({systemHints:t,composerController:s,clientThreadId:n}){const{configurationMenuType:o}=Ie(),a=o!=="none",r=Vn(s),i=t.find(({systemHint:u})=>u===r),{isUnauthenticated:d}=Re(),{setThreadSystemHintMode:l}=pe();return f.useEffect(()=>{o!=="none"&&r&&!t.some(({systemHint:u})=>u===r)&&!d&&l(r,!1,{clientThreadId:n})},[n,l,r,t,d,o]),i?e.jsxs("div",{"data-testid":"active-system-hint-pill",className:qn("[view-transition-name:var(--vt-composer-active-system-hint-pill)",a&&"flex items-center gap-1.5 ps-0.5"),children:[e.jsx("div",{"data-separator":!0,className:"bg-token-border-default h-3 w-px"}),e.jsx(sg,{activeSystemHint:i,onClick:()=>{l(i.systemHint,!1,{clientThreadId:n})}})]},"active-hint-tag"):null}function sg({activeSystemHint:t,onClick:s}){const n=K(),{configurationMenuType:o}=Ie(),a=o!=="none";return e.jsxs(so,{as:a?"button":"div",role:a?void 0:"button",tabIndex:a?void 0:0,onClick:s,spacing:"compact",isSelected:!0,isLegacyStyle:!0,borderVisible:!0,children:[e.jsx(Xt,{svgString:t.logo,className:a?"icon-md":"icon-md text-token-interactive-label-accent-default flex-1","aria-label":""}),e.jsx("span",{"data-label":!0,className:"mx-1.5",children:t.shortLabel??t.name}),a&&e.jsx(Pi,{"aria-label":"",className:"icon-smaller -ms-0.5 mt-px @max-[521px]/thread:ms-1"}),!a&&e.jsx(xi,{"data-remove-think-button":!0,className:"-me-1","aria-label":n.formatMessage({id:"HW9RTL",defaultMessage:"Disable {systemHintName}"},{systemHintName:t.name})})]})}function ng({systemHints:t,composerController:s,clientThreadId:n,connectionStatuses:o}){or({clientThreadId:n});const a=Ke(),{configurationMenuType:r}=Ie(),i=r!=="none",d=Vn(s),l=t.find(({systemHint:v})=>v===d),u=Qa(),{enabled:m}=Rn(),c=f.useMemo(()=>Object.entries(u).reduce((v,[y,k])=>(k&&(y!==oe.GITHUB_CONNECTOR||m)&&v.push(y),v),[]),[u,m]);if(!i||!l)return null;if(d===M.Research||!1)return e.jsx(Fp,{clientThreadId:n,enabledConnectors:c,trigger:e.jsx(F.BasicTrigger,{children:e.jsxs(so,{as:"button",spacing:"compact",children:[e.jsx(bi,{className:"icon-md","aria-label":""}),e.jsx("span",{"data-label":!0,className:"mx-1.5",children:e.jsx(P,{id:"DhW8Wx",defaultMessage:"Sources"})}),e.jsx(Gt,{className:"icon-sm -ms-0.5 @max-[521px]/thread:ms-1"})]})})});const h=Jn(a,"463092697")?.value,g=h?.enabled??!1,S=h?.enabledConnectors??[];return d===M.ContextualAnswers&&(o&&o.length>0||g)?e.jsx("div",{"data-testid":"sources-pill",className:qn("[view-transition-name:var(--vt-composer-sources-pill)",i&&"flex items-center gap-1.5 ps-0.5"),children:e.jsx(og,{dropdownContent:g?e.jsx(Ts,{clientThreadId:n,enabledConnectors:S,includeSyncConnectors:!0,includeWebSearch:!1}):e.jsx(gn,{}),as:g?"dropdown":"popover"})},"sources-tag"):null}function og({dropdownContent:t,as:s}){const n=e.jsxs(so,{as:"button",spacing:"compact",children:[e.jsx(bi,{className:"icon-md mx-1","aria-label":""}),e.jsx("span",{"data-label":!0,children:e.jsx(P,{id:"DhW8Wx",defaultMessage:"Sources"})}),e.jsx("div",{className:"me-0.5 flex items-center",children:e.jsx(Gt,{className:"pointer-events-auto! h-4 w-4"})})]}),o=s==="popover"?e.jsx(wn,{children:e.jsx(Qu,{className:"p-0",$as:_n,side:"bottom",align:"start",collisionPadding:10,sideOffset:8,children:t})}):e.jsx(F.Portal,{children:e.jsx(F.Content,{children:t})});return s==="popover"?e.jsxs(vn,{children:[e.jsx(Ku,{asChild:!0,children:n}),o]}):e.jsxs(F.Root,{children:[e.jsx(F.Trigger,{asChild:!0,children:n}),o]})}function ag({clientThreadId:t,uploadType:s,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:o,attachmentsProductFeature:a,getInputProps:r,openFileDialog:i,onOauthRedirect:d,historyDisabled:l,isDisabled:u,highlightTooltip:m,disabledReason:c,currentModelName:p,showLabel:b,showUpsell:h,hideBorder:g,isSmall:S,visualTreatment:v,layoutMode:y,restoreFocus:k}){const A=zn(),{gdriveStatus:R,o365Status:E}=di(),w="h-[20px] w-[20px]",_=l?"text-white":m?"text-brand-blue-800":"",T=h?e.jsx(ln,{"aria-label":"",className:W(w,_)}):e.jsx(ln,{"aria-label":"",className:W(w,_)}),D=(R!=="false"||E!=="false"||A||v==="vanguard")&&!h,x=Mm(),V=v==="vanguard"&&!x,G=D?e.jsx(sr,{hideBorder:g,isSmall:S,clientThreadId:t,icon:T,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:o,attachmentsProductFeature:a,onOauthRedirect:d,uploadType:s,openFileDialog:i,getInputProps:r,isDisabled:V?!1:u,highlightTooltip:m,disabledReason:c,currentModelName:p,visualTreatment:v,layoutMode:y,restoreFocus:k}):e.jsx(Xi,{isSmall:S,hideBorder:g,clientThreadId:t,uploadType:s,openFileDialog:i,getInputProps:r,showLabel:b,showUpsell:h,icon:T,isDisabled:u,highlightTooltip:m,disabledReason:c,currentModelName:p});return e.jsx("div",{className:"relative",children:e.jsx(tr,{showBackground:m,className:"bg-brand-blue-800/20",children:G})})}const ig=({clientThreadId:t,currentModel:s,uploadType:n,modelSupportedImageMimeTypes:o,modelAcceptedMimeTypes:a,modelProductFeatures:r,getEditorGizmoId:i,onOauthRedirect:d,disabledReason:l,isTemporaryChat:u,isDisabled:m,highlightTooltip:c,showLabel:p,showUpsell:b,numRemainingFiles:h,visualTreatment:g,layoutMode:S,restoreFocus:v})=>{const y=K(),k=Qe(),{handleFileAccepted:A}=io(y,n,o,"mouse",i,r?.attachments),{getInputProps:R,open:E}=no({disabled:m,noClick:!0,onDropAccepted:A,onDropRejected:w=>ao(w,y,k,n),multiple:!0,maxSize:Hn,maxFiles:h,...Ln(a)});return e.jsx(ag,{isSmall:!0,hideBorder:!0,isDisabled:m,highlightTooltip:c,onOauthRedirect:d,visualTreatment:g,attachmentsProductFeature:r?.attachments,clientThreadId:t,uploadType:n,modelAcceptedMimeTypes:a,modelSupportedImageMimeTypes:o,getInputProps:R,openFileDialog:E,historyDisabled:u,showLabel:p,showUpsell:b,disabledReason:l,currentModelName:s?.title??"",layoutMode:S,restoreFocus:v})};function rg(){const s=Xu().has(M.Research),n=!1,o=ie("3544641259")?.value;return(s||n)&&o}function lg(){const t=Un(),o={initial:{opacity:0,y:"-28px",rotate:45},animate:{opacity:1,y:0,rotate:45,transition:t?Wt:{opacity:{delay:.4},default:ka}},exit:{opacity:0,y:"-28px",rotate:45,transition:t?Wt:{opacity:{delay:0},default:ka}}};return e.jsx(J.div,{variants:o,initial:"initial",animate:"animate",exit:"exit",className:"border-token-border-xlight bg-token-main-surface-primary absolute start-1/2 top-full mt-[11px] h-2 w-2 -translate-x-1/2 transform rounded-se-[1px] rounded-es-[1px] border-s border-t dark:bg-[#303030]"})}const cg=({activeSystemHint:t,showHints:s,showContextChevron:n,onRemoveHint:o,lockSystemHint:a})=>{const r=K(),{popoverTriggerRef:i}=En(),d=()=>{requestAnimationFrame(()=>{i.current?.focus()})};if(t){const{logo:l,name:u}=t;return e.jsxs("div",{className:W("relative flex items-center justify-center",!a&&"-me-1"),children:[e.jsx(Xt,{className:"icon-md text-token-interactive-label-accent-default flex-1",svgString:l}),!a&&e.jsx(xi,{"data-remove-hint-button":!0,onClick:m=>{m.stopPropagation(),m.preventDefault(),o(),d()},"aria-label":r.formatMessage({id:"YQ7uOV",defaultMessage:"Remove {tool} from selection"},{tool:u})}),n&&e.jsx(lg,{})]})}return s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-token-border-default ms-0.5 h-[16px] w-[1px]"}),e.jsx("div",{className:"text-token-text-tertiary hover:text-token-text-primary me-0.5 flex items-center",children:e.jsx(Gt,{className:"text-token-text-tertiary hover:text-token-text-primary pointer-events-auto! h-4 w-4"})})]}):e.jsx(hi,{"aria-label":r.formatMessage({id:"xosz07",defaultMessage:"View all tools"}),className:"text-token-text-secondary h-5 w-5"})},ug={source:{id:"SystemHintCategory.Sources",defaultMessage:"Sources",description:"Label on system hint menu for hints that act as data sources"},tool:{id:"SystemHintCategory.Tools",defaultMessage:"Tools",description:"Label on system hint menu for hints that act as tools"}},dg=({children:t,clientThreadId:s,layoutMode:n,lockSystemHint:o,composerController:a,onChangeSystemHint:r,systemHints:i,activeSystemHintType:d,recentSystemHintTypes:l,showHints:u,reasonItem:m=!1,gizmoId:c,isInReasonMode:p,type:b,...h})=>{const g=rg(),S=Un(),v=K(),y=i.find(({systemHint:j})=>d===j),k=kt(),A=l.map(j=>j===M.PictureV2&&!i.find(({systemHint:H})=>j===H)?i.find(({systemHint:H})=>H===M.Picture):i.find(({systemHint:H})=>j===H)).filter(j=>!!j),[R,E]=f.useState(null),w=(j,H)=>{H?E(j):r(j)},{selectedIndex:_,systemHintSuggestions:T,suggestorClosed:D,resetSelectedIndex:x}=Zi({composerController:a,clientThreadId:s,onHintSelected:r}),V=D?i:T,G=[],B=Ji(V);let U=0;for(const j of B){const H=j.systemHints;H.length!==0&&(G.push({...j.category?{message:ug[j.category]}:{},systemHints:H,indexOffset:U}),U=H.length)}const z=()=>{a.setReasonMode(!p),p?N.logEventWithStatsig("Composer Think Button Disabled","composer_think_button_disabled",{clientThreadId:s}):N.logEventWithStatsig("Composer Think Button Enabled","composer_think_button_enabled",{clientThreadId:s})};return e.jsxs("div",{className:W("flex items-center rounded-full",u&&"me-1 border",d!==void 0?"border-transparent":b==="toolpile_icon"?"border-token-border-default":"border-token-border-xlight"),children:[!y&&u&&e.jsx(Ju,{onChangeSystemHint:w,systemHints:A}),e.jsxs(eo,{layoutMode:n,forceOpen:!D,...h,children:[t?e.jsx(Ui,{children:t}):e.jsx(op,{transition:S?Wt:xs,shape:d?"rectangle":"round",spacing:"compact",isSelected:d!==void 0,"aria-label":v.formatMessage({id:"NLd5mV",defaultMessage:"Open tool menu"}),className:W(u&&"-mx-0.5",o&&"cursor-default!",b==="config_icon"&&"min-w-9",b==="toolpile_icon"&&"min-h-9"),onClick:j=>{if(o){j.stopPropagation(),j.preventDefault();return}},tooltipLabel:!d&&v.formatMessage({id:"xgQfBi",defaultMessage:"View all tools"}),disableHover:u&&!y||o,isLegacyStyle:b==="config_icon"||b==="toolpile_icon"&&!!d,borderVisible:b==="config_icon"||b==="toolpile_icon"&&!!d,children:e.jsx(cg,{activeSystemHint:y,showHints:u,showContextChevron:g||!1,onRemoveHint:()=>r(null),lockSystemHint:o})}),e.jsx(to,{onMouseDown:j=>{j.preventDefault()},align:"end",children:e.jsx(Zu,{onChangeSystemHint:w,systemHintCategories:G,activeSystemHint:d,activeIndex:_,resetActiveIndex:x,reasonItem:m,gizmoId:c,clientThreadId:s,handleToggleReasonItem:z,isInReasonMode:p})})]}),!k||k.planType===Am.FREE&&e.jsx(ed,{open:!!R,onOpenChange:()=>E(null),systemHint:R})]})},Da="gpt-4o",mg=({clientThreadId:t,composerController:s,pendingFiles:n,isUploadDisabled:o,highlightUploadTooltip:a,hasFiles:r,conversationMode:i,placeholder:d,isTemporaryChat:l,layoutMode:u,state:m,inputState:c,disableReason:p,gizmoId:b,currentModel:h,replyRegions:g,uploadButtonDisabledReason:S,keepExpanded:v=!1,getEditorGizmoId:y,onOauthRedirect:k,onSubmit:A,visualTreatment:R,legacyFooterActions:E,legacySuggestionsPopoverContent:w,isNewThread:_=!1,isInReasonMode:T,modelSupportedSystemHints:D,contextualAnswerUserConnectionData:x})=>{const{data:V}=Jt(),[G,B]=da(!1),{updateSystemHint:U}=pe(),{configurationMenuType:z}=Ie(),j=z!=="none";As();const H=Ye.useState(({persistedSystemHints:$})=>$);td(t,R==="vanguard");const q=Array.from(H)[0],L=Ye.useState(({recentHints:$})=>$),{state:se}=ys(t),ae=_t(!1),ve=Te($=>$.threads[t]?.modelSelection),Rt=ve?.type===Ce.SPECIFIC,Xe=Te($=>$.setThreadModelSelection),fe=R==="vanguard"&&h?.id!==Da&&!Rt&&!G();Si(f.useCallback(()=>{fe&&(ae({location:"PromptTextarea",modelId:Da}),St(t,Xe,{type:Ce.EFFORT_MODE,effortMode:Ut.low}))},[fe,ae,t,Xe]));const{setIsOpen:Me}=sd(),De=$=>{B(!0),U($,{clientThreadId:t}),$===M.Research?Me(!0):Me(!1),$&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{s.focus()})})},Oe=!1,Je=se==="clarify"||Oe,ue=f.useCallback(($,Pt)=>e.jsx(mi,{...Pt,isSmall:R==="vanguard",inputState:c,state:m,onSubmit:A,composerController:s,clientThreadId:t,gizmoId:b,disableReason:p,useStartButtonText:Je,disableTooltip:$}),[c,m,A,s,t,b,p,Je,R]),Ze=$=>{G()&&($.preventDefault(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{s.focus()})}))},ne=nd({inputState:c,state:m,composerController:s,clientThreadId:t,gizmoId:b}),{whisperControls:ge}=zi({composerController:s,renderInComposer:ue,composerType:R,composerRightButtonType:ne,layoutMode:u}),[et=null,Le,tt]=f.useMemo(()=>[Dn(h,i),On(h,i),Fn(h,i)],[h,i]);Wn(t);const Fe=Ye.useState(({availableHints:$})=>$),X=Ye.useState(({locked:$})=>$),he=f.useMemo(()=>ve?.type===Ce.EFFORT_MODE?od[ve.effortMode]:"low",[ve]),[He,Ue]=da(he);f.useEffect(()=>{Ue(he)},[he,Ue]),Ne(me.ModelPickerMoved);const Ae=Mn(b);se!=="disabled"||Oe||(i?.kind,Pe.GizmoInteraction);const{pageType:Mt}=Ci(),we=yi($=>$.selectedApps),Ge=vi()&&we.length>0,_e=r||Ge,dt=v||!!q||g&&g.length>0||_e||Fe.length<3;bs(h,i,H);const O=qt(M.ContextualAnswers)&&!!_,{shouldShowResearchText:re}=ys(t),mt=ad(),At=id({exposed:O})==="bigbox",Et=mt&&re||At&&O;return e.jsxs(fp,{isBigBoxModeActive:Et,isTemporaryChat:l,placeholder:d,visualTreatment:R,composerController:s,isExpandedByDefault:dt,onSubmit:A,children:[g&&g.length>0&&e.jsx(Ra,{children:e.jsx(fi,{replyRegions:g})}),_e&&e.jsx(Ra,{children:e.jsx(un,{files:n,fullBleed:!0,selectedApps:we,className:qn("no-scrollbar -ms-1.5 flex flex-nowrap gap-2 overflow-x-auto",R==="composer-btn"?"horizontal-scroll-fade-mask py-1.5 ps-2 pe-4 [--edge-fade-distance:1rem]":"p-1.5")})}),[E?.map(($,Pt)=>e.jsx(gp,{children:$},`legacy-footer-action-${Pt}`))??[],(j&&e.jsx(Ma,{children:e.jsx(tg,{clientThreadId:t,composerController:s,systemHints:D})},"active-hint-tag"))??[],e.jsx(Ma,{children:e.jsx(ng,{clientThreadId:t,composerController:s,systemHints:D,connectionStatuses:x?.connection_statuses})},"sources-tag"),e.jsx(hp,{children:w},"legacy-suggestions-popover")],R==="vanguard"&&e.jsx(xp,{children:e.jsx(dg,{activeSystemHintType:q,lockSystemHint:Mt.type==="landing-page"||X,systemHints:Fe,clientThreadId:t,composerController:s,onChangeSystemHint:De,layoutMode:u,recentSystemHintTypes:L,showHints:!_,isInReasonMode:T,restoreFocus:Ze})},"system-hint-popover"),e.jsx(bp,{children:ge}),mt&&re?e.jsx(Aa,{children:e.jsx(Sp,{composerController:s,visualTreatment:"vanguard"})}):At&&O?e.jsx(Aa,{children:e.jsx(rd,{composerController:s,visualTreatment:"vanguard"})}):null]})},pg=Qn(()=>Xn(()=>import("./devzq0wbg16c6e5z.js"),__vite__mapDeps([8,1,2,3,4,5,9,10,11,12,13,14])).then(t=>t.ImageGenComposer)),fg=1,gg=3e3,hg=()=>null;function xg({onCreateNewCompletion:t,onContinueGenerating:s,account:n,currentModelId:o,currentModelConfig:a,disableDraftPersistence:r=!1,modelCategories:i,areModelsLoading:d,clientThreadId:l,isNewThread:u,isCompletionInProgress:m,className:c,disabled:p=!1,disabledReason:b,canPause:h=!1,canContinue:g=!1,isInteractableSharedThread:S,onComposerInput:v,onComposerChange:y,onAutocompleteSelect:k,headerClassName:A,hideHeader:R,onTaggingDropdownOpen:E,onTaggingDropdownClose:w,onlyAllowImageUploads:_}){ma.markStart("PromptTextarea"),ma.markRendered("PromptTextarea");const T=Ke(),D=f.useRef(null),x=jt(),V=oi(),G=Em(V.showUploadSuggestion$),B=ld(),U=n?.isTeam(),{isUnauthenticated:z}=Re(),j=K(),H=Qe(),q=Tn(),L=As(),se=cd.useStore(),[ae,ve,Rt]=ce(l,C=>[ee.getCurrentLeafId(C),ee.getRequestId(C),ee.findNode(C,Y=>!!Y.message.metadata?.b1de6e2_s)]),[Xe]=il(),{gizmoEditorData:fe,mode:Me,getGizmoId:De}=In(),Oe=Pm(),Je=_s(),ue=Tm(),Ze=ud(),ne=Li(l),ge=!!Mi(),et=!!Kn(),Le=dd.useIsEnabled(l),tt=!!Zn(),{setThreadSystemHintMode:Fe}=pe(),X=Yt(),{state:he}=ys(l),He=X.has(M.Search),Ue=X.has(M.Think),Ae=Ne(me.ModelPickerMoved),Mt=X.has(M.Research),{enabled:we}=Rn(),{activeSystemHints:Ge}=Wn(l),_e=Ge.length>0,dt=Ge.find(C=>C.systemHint===M.ContextualAnswers),O=md(),{connectionInstanceData:re,isLoading:mt}=jn({skip:!O}),{selectedSources:At}=ks(l),Et=f.useRef(0),$=f.useRef(!1),Pt=i?.find(C=>C.defaultModel===o),ir=hg();let Q=Ms(l),Ns=Q&&"gizmo"in Q?Q.gizmo:void 0;const rr=Nm(),st=Ns?.gizmo.id??rr,Tt=Mn(st),lr=pd(),ro=fd(),[xe,Zt]=f.useState(null);xe!==null&&(Q={gizmo:xe,gizmo_id:xe.gizmo.id,kind:Pe.GizmoInteraction},Ns=xe);const Nt=bs(a,Q,X),cr=Es(),lo=Oi(T).flags,es=lo?.includes(vs.NoAuthEnableFileUploads),{showLegacyReasoningSlider:nt,showReasoningSliderNux:ur,reasoningSliderType:dr,hideReasonInSystemHintOverflow:mr,hideSearchInSystemHintOverflow:pr,configurationMenuType:co}=Ie(),uo=co!=="none",ts=Te(C=>C.setThreadModelSelection),mo=Te(C=>C.threads[l]?.modelSelection),po=mo?.type===Ce.EFFORT_MODE?mo.effortMode:null,fo=!!po&&po!==Ut.low;Si(f.useCallback(()=>{fo&&St(l,ts,{type:Ce.EFFORT_MODE,effortMode:Ut.low})},[fo,l,ts])),up({serverThreadId:ne,clientThreadId:l,composerController:x,currentModelId:o,account:n,getIsDisabled:f.useCallback(()=>!1,[]),onReset:()=>{St(l,ts,{type:Ce.EFFORT_MODE,effortMode:Ut.low})},onInfer:C=>{St(l,ts,{type:Ce.EFFORT_MODE,effortMode:C})},isInferEnabledForModel:a?.enableInfer});const go=!p&&(Nt!==at.None||d)&&(!z||es),ze=On(a,Q),Bs=Fn(a,Q);let le=rn(C=>C.files);const[ss]=f.useState(()=>gd());Me==="magic"?le=le.filter(C=>C.gizmoId!=null):le=le.filter(C=>C.gizmoId==null);const ho=hd(),We=le.length>0||ho,xo=rn(qd.hasUploadInProgress),Is=yi(C=>C.selectedApps),bo=vi()&&Is.length>0,fr=We||bo,gr=xd(l),Ds=x.useState(C=>{const Y=bd(C);return typeof a?.maxTokens=="number"&&Y>a.maxTokens}),So=x.useState(C=>!C.isEmpty()),ns=!Ds&&!xo&&(So||We),Co=(Nt===at.Multimodal?Nn:Bn)-le.length,yo=Co<=0,hr=Sd(),xr=ie("3544641259")?.value,{selectedRepos:Os}=yn(l),vo=hr&&xr&&At?.size===0,pt=ns&&!p&&!tt&&(!m||ro)&&!vo,[wo,br]=f.useState(!1),{value:Sr}=ie("3780975974"),{targetedContent:_o,setTargetedContent:os}=Cd(),je=_o?.isFocusedViewContent&&!Ze?void 0:_o;f.useEffect(()=>{requestAnimationFrame(()=>requestAnimationFrame(()=>x.focus()))},[je]);const jo=Q==null||Q?.kind===Pe.PrimaryAssistant||Q?.kind===Pe.GizmoInteraction&&Tt,{getUpsellLabelType:Cr,getUpsellShowsAttach:yr,getShowUpsellReason:vr}=pi(),Ls=_e&&jo,[wr,_r]=f.useState(!1),jr=!z&&jo&&(!U||!mt),ft=it(x.store,C=>C.controlsDisabled);f.useEffect(()=>{if(!B?.id)return;const C=pa.getAndReset(B.id,ne);C&&x.setText(C.inputText)},[B?.id,ne,x]),f.useEffect(()=>{const C=Xe.get("prompt")??"";x.getCurrentText().length===0&&C.length>0&&x.setText(C)},[x,Xe]),f.useEffect(()=>{wo!==pt&&(br(pt),pt&&Bm(!0).then(C=>{yd.startEnforcement(C),Im.startEnforcement(C)}))},[pt,wo,Q?.kind,Oe]);const as=Dn(a,Q),{handleFileAccepted:ko}=io(j,bs(a,Q,X),ze,"mouse",De,as?.attachments),kr=f.useCallback((C,Y)=>(requestAnimationFrame(()=>{requestAnimationFrame(()=>{x.focus()})}),ko(C,Y)),[x,ko]),{getInputProps:Rr,open:Fs,inputRef:Ro}=no({disabled:p||!go||yo,noClick:!0,onDropAccepted:kr,onDropRejected:C=>ao(C,j,H,Nt),multiple:!0,maxSize:Hn,maxFiles:Co,...Ln(z||_?ze:Bs)}),Mo=it(ss),Ao=f.useCallback(()=>{x.eraseContent(),Mo.clearMessages(),x.resize(fg),x.usedDictation=!1;for(const C of le)gs.remove(q,C.tempId,"none");vd.markAllAsSent()},[x,Mo,le,q]),Bt=it(x.store,C=>C.isInReasonMode),Eo=f.useMemo(()=>Xs(Bt,x,X)[0],[Bt,x,X]),Po=async(C,Y)=>{if(C.preventDefault(),p||!ns||!Q)return;const de=x.getContentToSend(),be=Yd(de.content),ot=Xs(Bt,x,X),{content:Ys,attachments:$s}=$d(q,be,a,Q,X);lr(),t({sourceEvent:C,attachments:$s,content:Ys,contentToSend:de,conversationMode:Q,hasSelectedApps:bo,isMessageFollowupsEnabled:Le,selectedApps:Is,selectedGizmoTag:xe,selectedRepos:{selectedAllRepos:Os.selectedAllRepos,selectedRepos:Os.selectedRepos?[...Os.selectedRepos]:null},selectedSources:At,systemHints:ot,usedDictation:x.usedDictation}),je?.onCreateCompletion?.({serverThreadId:ne,currentLeafId:ae}),je?.shouldPersistAcrossMessages!==!0&&os(void 0),ga.hideThreadHeader();for(const oa of le)oa.status===Kd.Ready&&se.addFile(oa);Ao()},Mr=C=>{os(C.targetedReply),C.targetedReply&&N.logEventWithStatsig("Targeted Reply Button Clicked","chatgpt_targeted_reply_button_clicked",{conversationId:ne,sourceMessageId:C.messageId})},To=f.useCallback(()=>{je?.onCleared?.({serverThreadId:ne,currentLeafId:ae}),os(void 0),x.focus()},[ae,ne,je,os,x]),No={Enter:{validator:C=>{const Y=C.isComposing||C.keyCode===229;return!(rs&&$.current)&&(C.metaKey||(Je||Fm||Hm())&&!C.shiftKey&&!Y)},handler:C=>{if(!pt){Ds&&H.danger("The message you submitted was too long, please submit something shorter.",{hasCloseButton:!0});return}C.preventDefault(),Po(C)}},Escape:{validator:C=>!C.isComposing,handler:C=>{h&&m&&(fa(l),N.logEventWithStatsig("Pause Completion","chatgpt_pause_completion",{threadId:Ft(l),currentLeafId:ee.getCurrentNode(ke(l)).message.id,eventSource:"keyboard"})),C.target.value===""&&To()}}},It=f.useRef(No);It.current=No;const is=wd(a?.tags,Q?.kind),{showTaggingDropdown:Hs,isFocused:Ar,autocompletions:Ve,matchaData:Er}=it(x.store),rs=Ar&&Ve.length>0,gt=is&&Hs&&!Tt,Bo=x.isReady();f.useEffect(()=>x.subscribe("keydown",C=>{x.acceptLegacyKeydown()&&It.current[C.key].validator(C)&&It.current[C.key].handler(C);const de=x.getCurrentText();if(C.key==="@"){const be=x.getSelectionStart(),ot=de.substring(0,be);(!ot||/\s$/.test(ot)||be===0)&&setTimeout(()=>x.setShowTaggingDropdown(!0),10)}else Hs&&x.setShowTaggingDropdown(!1);C.key==="Escape"&&(Zt(null),x.setAutocompletions([])),He&&C.key==="Escape"&&Fe(M.Search,!1,{clientThreadId:l})}),[x,Bo,Hs,X,He,Fe,l]),f.useEffect(()=>{const C=Object.fromEntries(Object.keys(It.current).map(Y=>[Y,be=>{const ot=It.current[Y];if(!ot||x.acceptLegacyKeydown())return!1;const{validator:Ys,handler:$s}=ot;return Ys(be)?($s(be),!0):!1}]));x.registerKeyHandlers(C),x.registerFileInput({openFileDialog:Fs,inputRef:Ro})},[x,Fs,Ro,Bo]),f.useEffect(()=>x.subscribe("paste",C=>{_d({filePickerStore:q,event:C,intl:j,toaster:H,clientThreadId:l,conversationMode:Q,currentModelConfig:a,getEditorGizmoId:De,modelSupportedImageMimeTypes:ze,persistedSystemHints:X})}),[j,l,Q,a,De,ze,x,H,q,X]);const Io=C=>{ge||Zt(C),x.trimLeadingText("@"),an(),x.setShowTaggingDropdown(!1)},Pr=jd(l,ss,ze,as?.attachments),Tr=f.useCallback(C=>{C.preventDefault(),fa(l),N.logEventWithStatsig("Pause Completion","chatgpt_pause_completion",{threadId:Ft(l),currentLeafId:ee.getCurrentNode(ke(l)).message.id,eventSource:"mouse"}),an()},[l]),ls=f.useCallback(()=>{pa.set(B?.id,ne,x.getCurrentText())},[ne,B?.id,x]);f.useEffect(()=>{fe||kd()||x.focus()},[x]),f.useEffect(()=>{if(ze.length>0)for(const Y of le)Rd(Y.fileSpec?.mimeType,Bs)||gs.remove(q,Y.tempId,"none");else gs.reset(q)},[o,q]),f.useEffect(()=>{(!is&&xe||ge)&&Zt(null)},[is,xe,ge]),f.useEffect(()=>{et&&x.setReasonMode(!1)},[et,x]);const{layer:Nr}=$e("4031588851"),{layer:Do}=$e("3637408529"),Br=Do.get("is_in_composer_text_exp",!1),Ir=Do.get("composer_text","MESSAGE_CHATGPT"),Dr=Nr.get("composer_text","MESSAGE_CHATGPT"),Or=Br?Ir:Dr,[cs,Lr]=(()=>{switch(b){case"workspaceDisallowsGizmo":return[Z.disallowedByWorkspacePlaceholder,!0];case"noModelsAvailable":return[Z.noModelsAvailablePlaceholder,!0];case"requiresPluginsToBeInstalled":return[Z.requiresPluginsToBeInstalled,!0];case"loadingPlugins":return[Z.loading,!0];case"noTestGizmoId":return[Z.noTestGizmoId,!0];default:{if(S)return[Z.placeholderWithName,!1];if(je?.placeholderTextOverride!=null)return[je.placeholderTextOverride,!1];if(he==="initial"||he==="recurrent")return[Z.deepResearchPlaceholder,!1];if(he==="clarify")return[Z.researchSuggestionInitial,!1];if(Eo)switch(Eo){case M.Search:return[Z.searchPlaceholder,!1];case M.Think:return[Z.thinkPlaceholder,!1];case M.Research:return[Z.researchPlaceholder,!1];case M.Canvas:return[Z.canvasPlaceholder,!1];case M.Picture:return[Z.picturePlaceholder,!1];case M.PictureV2:return[Z.pictureV2Placeholder,!1];case M.ContextualAnswers:return[Md.caSuggestionInitial,!1]}switch(Or){case"BLANK":return[null,!1];case"ASK_ANYTHING":return[Z.placeholderAskAnythingVariant,!1];case"ASK_CHATGPT_ANYTHING":return[Z.placeholderAskNameAnythingVariant,!1];default:return[Z.placeholderWithName,!1]}}}})(),Us=Tt?u?j.formatMessage(Ad.newChatInProject):cs?j.formatMessage(cs,{name:"ChatGPT"}):"â€‹":cs?j.formatMessage(cs,{name:fe!=null?Me==="magic"?Ed:fe.name||"GPT":Ns?.gizmo.display.name??"ChatGPT"}):"â€‹";f.useEffect(()=>x.subscribe("input",()=>{Pd.getState().isThreadHeaderVisible&&ga.hideThreadHeader()}),[x]),f.useEffect(()=>x.subscribe("input",()=>{Et.current=performance.now(),v?.()}),[x,v]),f.useEffect(()=>{if(y)return x.subscribe("change",()=>{y()})},[x,y]);const Fr=Sr||vr(),Oo=Td()&&!!Ve.find(C=>!!C.requires_file_upload),Hr={clientThreadId:l,uploadType:Nt,modelAcceptedMimeTypes:Bs,modelSupportedImageMimeTypes:ze,attachmentsProductFeature:as?.attachments,getInputProps:Rr,openFileDialog:Fs,historyDisabled:ue,onOauthRedirect:ls,highlightTooltip:Oo&&!We},Dt=[],Lo=[],Fo=!p&&!yo&&(go||cr!=null)&&!He,Ho=yr(),Ur=!z||Ho||es,Uo=Nt===at.None?Ct.ModelNotSupported:Ue?Ct.ThinkModeInUse:He?Ct.SearchModeInUse:void 0;if(Ur){const C=e.jsx("div",{"data-testid":"composer-action-file-upload",style:{viewTransitionName:"var(--vt-composer-attach-file-action)"},children:e.jsx(Wf,{...Hr,showGlowingBorder:G,showLabel:Cr()==="all",showUpsell:Ho&&!es,showMenuForNoAuth:es,isDisabled:!Fo||ft,disabledReason:Uo,currentModelName:a?.title??"",visualTreatment:uo?"composer-btn":"legacy"})},"file-upload-button");Dt.push(C),Lo.push(C)}const Ee=[],Go=Gn(),zo=Te(C=>C.isVisuallyOverflowing)&&nt;let us="bottom";Go?us="bottom":u&&(us="centered"),nt&&(Q?.kind!==Pe.GizmoInteraction||Tt)&&Ee.push(e.jsx("div",{"data-testid":"composer-action-reasoning-level",className:"flex [--pill-color:var(--text-secondary)] [--pill-font-size:13px]",onPointerDown:C=>C.stopPropagation(),children:e.jsx(An,{announcementKey:me.ModelPickerMoved,side:"bottom",show:L&&ur&&!Ae.isLoading&&Ae.eligible,onDismiss:Ae.markAsViewed,theme:"bright",badge:"none",dismissOnOutsideClick:!0,sideOffset:0,title:e.jsx(P,{id:"NGN4SW",defaultMessage:"Set how long ChatGPT should think or pick a different model"}),children:e.jsx(nf,{clientThreadId:l,layoutMode:us,currentModel:a,category:Pt,type:dr,mode:Tt?"model-picker-only":"default"})})},"reasoning-level")),pr||Ee.push(e.jsx(qp,{account:n,clientBootstrapFlags:lo,features:Oe,currentModelConfig:a,hasFiles:We,isDisabled:ft||We,clientThreadId:l,composerController:x,gizmoId:st},"search"));const{value:Gr}=ie("1830177352");!nt&&!mr&&Ee.push(e.jsx(zp,{clientThreadId:l,gizmoId:st,composerController:x,isDisabled:ft},"reason")),Gr&&Ee.push(e.jsx(Up,{clientThreadId:l,gizmoId:st,showLabel:Fr,isDisabled:ft},"deep-research")),zo||Ee.push(e.jsx(Zm,{clientThreadId:l,composerController:x,isDisabled:ft,currentModelConfig:a,currentModelConfigLoading:d,disableIfNoAccess:nt},"shiba")),yt(T,"3240576626");const Wo=Jn(T,"463092697")?.value,zr=Wo?.enabled??!1;if((Wo?.enabledConnectors??[]).filter(C=>C!==oe.GITHUB_CONNECTOR||we),dt&&!zo&&(re&&re.connection_statuses.length>0||zr)&&Ee.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-search-action)"},"data-testid":"composer-action-contextual-answers",children:e.jsx(eg,{composerController:x,systemHint:dt,clientThreadId:l,connectionStatuses:re?.connection_statuses??[]})},"contextual-answers")),jr&&Ee.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-system-hint-action)"},"data-testid":"composer-action-system-hint-button",children:e.jsx(Qf,{composerController:x,clientThreadId:l,disabled:ft,hideThinkButton:nt,disableIfNoAccess:nt})},"system-hint-button")),co==="none")Dt.push(...Ee);else{const C=Ee.find(Y=>Y.key==="system-hint-button");C&&Dt.push(C)}const Gs=yt(T,"2007855518"),Vo=Rt?.message.metadata?.async_task_id,zs=Nd(C=>Vo?C.tasks[Vo]:null),[Wr,qo]=f.useState(!1),Ws=zs?.status===Bd.RUNNING,Vs=Lr?"disabled":"default",Yo=Id(Ft(l)||l)?.value,Vr=Yo===_a.STREAMING,qr=Yo===_a.REALTIME,$o=m&&h||Vr||qr||Ws&&Gs,Yr=Dm(),$r=!pt||Yr,qs=zd(xo,So,Ds,gr,!vo,Ws,Gs),ht=$o?"streaming":$r?"disabled":"idle",Ot=f.useRef(null),xt=f.useRef(null),{value:Kr}=ie("222560275"),Qr=Kr||o&&!o.startsWith("o1")&&!o.startsWith("o3");f.useEffect(()=>{const C=()=>{Ot.current!=null&&Um.addAction("composer_state_disabled",{threadId:Ft(l),disabledReason:Ot.current})};if(ns&&ht==="disabled"){let Y="unknown";p?Y=b??"component_disabled_unknown":m?Y="completion_in_progress":tt&&(Y="thread_hard_blocked"),Ot.current!==Y&&(xt.current&&clearTimeout(xt.current),xt.current=setTimeout(C,gg)),Ot.current=Y}else Ot.current=null;return()=>{xt.current&&(clearTimeout(xt.current),xt.current=null)}},[l,ns,ht,p,b,m,tt]);const ds=[];if(je?.label&&ds.push({type:je.type,value:je.label,onRemoveRegion:To}),xe!==null){const C=!!xe.gizmo.tags?.includes(js.FirstParty);ds.push({type:"mention",value:xe.gizmo.display.name,icon:e.jsx(Hi,{isFirstParty:C,src:xe.gizmo.display.profile_picture_url,className:"icon-md"}),onRemoveRegion:()=>{Zt(null),x.focus()}})}f.useEffect(()=>{(!Ve||Ve.length===0||!rs)&&($.current=!1)},[Ve,rs]);const Xr=f.useCallback((C,Y,de)=>{$.current=C>=0,Y&&x.setText(de?`${de.title}${de.body}`:"")},[x]),Ko=rs&&Ve&&Ve.length>0&&!gt&&!Mt&&!x.hasMultipleLines()&&x.canShowAutocompletion();f.useEffect(()=>{gt?E?.():w?.()},[gt,E,w]);const ms=C=>{if(C.preventDefault(),C.stopPropagation(),Et.current>0){const Y=performance.now()-Et.current;Gm.hist(zm.DEFAULT,"final_user_input_to_submit_ms",[],Y)}ht==="streaming"&&(!ro||x.isEmpty())?Ws&&Gs?qo(!0):Tr(C):Po(C)},Jr=Dd(a,Ei.Canvas),{value:Zr}=ie("61299031"),el=Od(),tl=Jr&&Zr&&!el&&!ho&&!Go;f.useEffect(()=>{},[ir,x]),f.useEffect(()=>{const C=Ft(l),Y=n?.normalizedAccountUserId;if(!Y||r)return;const de=on(()=>{const be=x.getContentToSend().content;be===""?Om(C):Lm(C,be,Y)},1e3);return x.subscribe("change",de)},[n,l,x,r,ne]);const Qo=e.jsx(Af,{canUseInlineTagging:is,isDisabled:p,clientThreadId:l,currentLeafId:ae,currentRequestId:ve,canContinue:g,composerController:x,isNewThread:u,onContinueGenerating:C=>s({event:C,conversationMode:ke(l)?.mode,systemHints:Xs(Bt,x,X)}),onResetState:Ao,conversationMode:Q,isShowingAutocomplete:!!Ko}),Xo=!$o&&Q!=null&&Qr&&Ld.includes(Q.kind)&&e.jsx(Fd,{clientThreadId:l,onTargetedReply:Mr}),Jo=Ko&&e.jsx("div",{className:"bg-token-main-surface-primary absolute start-0 z-[-1] box-border w-full ps-0 max-lg:bottom-full lg:top-full",children:e.jsx(ep,{suggestions:Ve,composerController:x,onSelect:k,onChange:Xr})}),Zo=e.jsx(Vd,{composerController:x,parsedDocumentHandler:Pr}),ea=!R&&e.jsx(Qi,{className:A}),ta=e.jsx(Hd,{modelSupportedImageMimeTypes:ze,uploadType:at.Multimodal,attachmentsProductFeature:as?.attachments}),sl=e.jsxs(e.Fragment,{children:[gt&&e.jsx(Ea,{onClick:C=>Io(C),onClose:()=>{x.setShowTaggingDropdown(!1),x.focus()}}),Ls&&e.jsx(Ba,{composerController:x,clientThreadId:l})]}),{isImageGenEditor:sa}=Ud(),na=yt(T,"3760395675");return sa?e.jsxs(ha.Provider,{value:ss,children:[e.jsx(ba,{onOauthRedirect:ls,children:e.jsx(xa,{defaultOpen:na,children:e.jsx("form",{id:"prompt",className:c,onSubmit:ms,children:e.jsxs("div",{className:"relative z-1 flex h-full max-w-full flex-1 flex-col",children:[ea,e.jsxs("div",{className:"group relative z-1 flex w-full items-center",style:{"--force-hide-label":wr?"none":"block"},children:[e.jsxs(vn,{open:gt||Ls,children:[e.jsx(qa,{className:"w-full",children:sa?e.jsx(pg,{type:ue?"temporary":"default",ref:D,placeholder:Us,inputState:Vs,composerController:x,leftSideActions:Lo,state:ht,onSubmit:ms,renderFiles:We&&e.jsxs(e.Fragment,{children:[Me==="magic"&&e.jsx("div",{className:"bg-token-main-surface-secondary text-token-text-secondary m-2 mb-0 rounded-lg p-2 text-xs",children:e.jsx(P,{...Z.gizmoKnowledgeWarning})}),e.jsx(un,{files:le,className:"-ms-1.5 flex flex-nowrap gap-2 overflow-x-auto p-1.5"})]}),clientThreadId:l,gizmoId:st,disableReason:qs,modelId:o}):e.jsx(Vf,{type:ue?"temporary":"default",ref:D,replyRegions:ds,placeholder:Us,inputState:Vs,setIsComposerOverflowing:_r,composerController:x,matchaData:Er,leftSideActions:Dt,topRightAction:tl&&e.jsx(Wd,{composerRef:D,composerController:x,clientThreadId:l}),state:ht,onSubmit:ms,renderFiles:fr&&e.jsxs(e.Fragment,{children:[Me==="magic"&&e.jsx("div",{className:"bg-token-main-surface-secondary text-token-text-secondary m-2 mb-0 rounded-lg p-2 text-xs",children:e.jsx(P,{...Z.gizmoKnowledgeWarning})}),e.jsx(un,{files:le,selectedApps:Is,className:"-ms-1.5 flex flex-nowrap gap-2 overflow-x-auto p-1.5"})]}),clientThreadId:l,gizmoId:st,disableReason:qs,modelId:o})}),e.jsx(wn,{children:e.jsxs(_n,{side:"bottom",align:"start",sideOffset:12,onOpenAutoFocus:C=>C.preventDefault(),children:[gt&&e.jsx(Ea,{onClick:C=>Io(C),onClose:()=>{x.setShowTaggingDropdown(!1),x.focus()}}),Ls&&e.jsx(Ba,{composerController:x,clientThreadId:l})]})})]}),Jo]}),Zo,ta]})})})}),Qo,Xo]}):e.jsx(ha.Provider,{value:ss,children:e.jsxs(xa,{defaultOpen:na,children:[e.jsx(ba,{onOauthRedirect:ls,children:e.jsxs("div",{className:W("max-xs:[--force-hide-label:none] relative z-1 flex h-full max-w-full flex-1 flex-col",nt&&!L&&"[--force-hide-label:none]"),children:[ea,zs&&Wr&&e.jsx(Gd,{taskId:zs.taskId,clientThreadId:l,onClose:()=>qo(!1)}),e.jsx(mg,{visualTreatment:uo?"composer-btn":"legacy",hasFiles:We,pendingFiles:le,isUploadDisabled:!Fo,isNewThread:u,clientThreadId:l,getEditorGizmoId:De,highlightUploadTooltip:Oo&&!We,disableReason:qs,uploadButtonDisabledReason:Uo,currentModel:a,layoutMode:us,conversationMode:Q,onOauthRedirect:ls,state:ht,inputState:Vs,gizmoId:st,isTemporaryChat:ue,placeholder:Us,composerController:x,onSubmit:ms,replyRegions:ds,keepExpanded:!0,legacyFooterActions:Dt,legacySuggestionsPopoverContent:sl,isInReasonMode:Bt,modelSupportedSystemHints:Ge,contextualAnswerUserConnectionData:re}),Jo]})}),Zo,Qo,Xo,ta]})})}function Oa({clientThreadId:t,onClick:s}){f.useEffect(()=>{Zd(t)},[t]);const n=K();return e.jsx(J.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},className:"inline-block",children:e.jsx(wi,{onClick:()=>{em(t),s()},label:n.formatMessage(vg.moreStarterPrompts)})})}function bg({starterPrompt:t,starterPrompts:s,index:n,disabled:o,onSelectStarterPrompt:a}){const r=t.theme??t.title,i=Jm(),{mutate:d}=Xd(),l=t.category==="onboarding"?u=>{d({key:me.hasUsedConversationalOnboardingStarterPrompt}),i(u,t,s,n)}:u=>a?.(u,t,s,n);return e.jsx(wi,{disabled:o,onClick:l,icon:e.jsx(Jd,{category:t.category,useV2Colors:!0}),label:r})}const Sg=5,Cg=3;function ar({starterPrompts:t,onSelectStarterPrompt:s,disabled:n,clientThreadId:o,onExpand:a,mobileLayout:r=!1}){const i=r?Cg:Sg,[d,l]=f.useState(i),[u,m]=f.useState(!1),c=f.useRef(null),p=t.length<=d;f.useEffect(()=>{Sa(t.slice(0,i),o)},[o]),f.useEffect(()=>{if(!u&&!p&&c.current){const h=c.current,g=h.getBoundingClientRect(),S=g.width,v=Array.from(h.children);let y=0;for(let k=0;k<v.length&&v[k].getBoundingClientRect().right-g.left<=S;k++)y++;l(y),m(!0)}},[t,p,u]);const b=()=>{const h=t.slice(d,t.length).map(g=>({...g,isAdditional:!0}));h.length>0&&Sa(h,o),l(t.length),a()};return e.jsxs("div",{"data-testid":"starter-prompt-chips",className:W("mt-5 flex items-center justify-center gap-x-2 transition-opacity xl:gap-x-2.5",u&&t.length>0?"opacity-100":"opacity-[0.01]",r?"flex-wrap":"flex-nowrap"),children:[e.jsxs("ul",{className:W("relative flex items-stretch gap-x-2 gap-y-4 overflow-hidden py-2 sm:gap-y-2 xl:gap-x-2.5 xl:gap-y-2.5",p||r?"flex-wrap justify-center":"flex-nowrap justify-start"),ref:c,children:[t.slice(0,d).map((h,g)=>e.jsx(J.li,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},children:e.jsx(bg,{starterPrompt:h,starterPrompts:t,index:g,disabled:n,onSelectStarterPrompt:s})},h.id??g)),r&&t.length>d&&e.jsx(Oa,{clientThreadId:o,onClick:b})]}),!r&&t.length>d&&e.jsx(Oa,{clientThreadId:o,onClick:b})]})}const Wg=({clientThreadId:t,currentModelId:s,isModelLoaded:n})=>{const[o,a]=f.useState(!1),r=Zn(),{prospectiveModelId:i}=Rs(t),d=n?s:i??"auto",{promptStarters:l,shouldShowStarterPrompts:u,onSelectStarterPrompt:m}=Fi({isModelLoaded:n,shouldBeEnabledForDefaultAssistant:!0,clientThreadId:t,limit:8,modelSlug:d});return e.jsx(J.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:W(!o&&"h-[116px]"),children:u&&l&&e.jsx(ar,{starterPrompts:l,onSelectStarterPrompt:m,disabled:r,clientThreadId:t,onExpand:()=>a(!0),mobileLayout:!0})})},yg=({currentModelId:t,clientThreadId:s,isModelLoaded:n})=>{const{isUnauthenticated:o}=Re(),[a,r]=f.useState(!1),i=Qd(),d=Zn(),{prospectiveModelId:l}=Rs(s),u=n?t:l??"auto",{promptStarters:m,shouldShowStarterPrompts:c,onSelectStarterPrompt:p}=Fi({isModelLoaded:n,shouldBeEnabledForDefaultAssistant:!0,clientThreadId:s,limit:8,modelSlug:u});return e.jsx(J.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:W("hidden min-h-[108px] max-w-full",i?"@lg/thread:block":"lg:block",o&&a?"":"h-[70px]"),children:c&&m&&e.jsx(ar,{starterPrompts:m,onSelectStarterPrompt:p,disabled:d,clientThreadId:s,onExpand:()=>r(!0)})})},vg=Be({moreStarterPrompts:{id:"SplashScreenV2.moreStarterPrompts",defaultMessage:"More"}}),La=Yn.div`m-8 flex flex-col items-center`;function Fa(t){return e.jsx(J.div,{initial:{opacity:0,translateY:20},animate:{opacity:1,translateY:0,transition:{duration:.5,ease:"easeIn"}},...t})}function wg({clientThreadId:t}){const n=ce(t,a=>a?.promptGptRating)?.gizmoId,{data:o}=_i(n);return n==null||o==null||!tm(o)?null:e.jsx(_g,{gizmoId:n})}function _g({gizmoId:t}){const[s,n]=f.useState(!1),[o,a]=f.useState(!1),r=sm(t),i=async l=>{n(!0),setTimeout(()=>{a(!0)},5e3),N.logEvent("Submit Inline Rating",{gizmo_id:t,rating:l}),await r.mutateAsync({rating:l})},d=async()=>{a(!0),N.logEvent("Dismiss Inline Rating",{gizmo_id:t}),await r.mutateAsync({})};return f.useEffect(()=>{o||N.logEvent("Show Inline Rating",{gizmo_id:t})},[o,t]),o?null:s?e.jsx(La,{children:e.jsxs(Fa,{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"border-token-border-heavy rounded-lg border p-4",children:e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(P,{id:"gizmo.inlineReview.reviewLeft",defaultMessage:"Feedback sent"}),e.jsx(ja,{onClick:()=>{a(!0)}})]})}),e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(P,{id:"gizmo.inlineReview.reviewLeftSubtext",defaultMessage:'To update your rating, click "Send Feedback" in the GPT Menu'})})]})}):e.jsx(La,{children:e.jsxs(Fa,{className:"border-token-border-heavy flex flex-col items-center gap-4 rounded-lg border p-4",children:[e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(P,{id:"gizmo.inlineReview.prompt",defaultMessage:"How would you rate this GPT so far?"}),e.jsx(ja,{onClick:d})]}),e.jsx(nm,{rating:void 0,onRating:i})]})})}const Vg=({clientThreadId:t,isNewThread:s,isGizmoThread:n,isProjectThread:o,isModelLoaded:a,currentModelId:r,onRequestCompletion:i,shouldUseUnifiedComposer:d,onlyAllowImageUploads:l})=>{const u=jt(),{pageType:m}=Ci(),c=m?.type==="landing-page",p=f.useContext(qm),b=Ym(p),h=Gn();kt(),cm(u);const g=async k=>{if(ke(t)?.isLoading!==!1)return;const A=await dm(k);i(A)},S=f.useCallback(k=>{N.logEvent("Continue Completion"),i(um(k))},[i]),v=e.jsxs(e.Fragment,{children:[e.jsx(wg,{clientThreadId:t}),e.jsx(Js,{verticalMargin:"none",verticalPadding:b?"last-standard":"none",horizontalPadding:"standard",children:e.jsx(Zs,{children:e.jsx(jg,{clientThreadId:t,currentModelId:r,isNewThread:s,hideHeader:s,onRequestCompletion:g,onContinueGenerating:S,onAutocompleteSelect:u.onAutocompleteSelect,onlyAllowImageUploads:l})})})]}),y=s&&e.jsx("div",{className:W("[display:var(--display-hidden-until-loaded,block)] md:absolute md:start-0 md:bottom-6 md:w-full"),children:e.jsx(Js,{verticalMargin:"none",verticalPadding:"none",horizontalPadding:"standard",children:e.jsx(Zs,{children:e.jsx(Qi,{className:"block flex-1"})})})});return d?e.jsxs(e.Fragment,{children:[h&&y,e.jsx("div",{id:"thread-bottom",children:v}),!h&&y,s&&!c&&!n&&!o&&e.jsx(Js,{verticalMargin:"none",verticalPadding:"none",horizontalPadding:"standard",children:e.jsx(Zs,{children:e.jsx(yg,{clientThreadId:t,currentModelId:r,isModelLoaded:a})})})]}):v};function jg({clientThreadId:t,currentModelId:s,disableDraftPersistence:n=!1,isNewThread:o,onRequestCompletion:a,onContinueGenerating:r,onComposerInput:i,onComposerChange:d,onAutocompleteSelect:l,headerClassName:u,hideHeader:m,onTaggingDropdownClose:c,onTaggingDropdownOpen:p,onlyAllowImageUploads:b}){const{data:h,isLoading:g}=Jt(),[S,v,y,k]=ce(t,q=>{const L=ee.getCurrentNode(q);return[L.message.clientMetadata?.errType!=null&&L.message.clientMetadata.errType!=="info",$m(ee.getCurrentNode(q).message),q?.mode,q?.continuingFromSharedConversationId!=null]}),A=kt(),R=jt(),E=Wm({clientThreadId:t}),{isOpen:w,onClose:_}=om({type:"just-hit-rate-limit"}),T=f.useMemo(()=>E?!1:!S&&v,[S,v,E]),D=E,x=Ii(t),V=_i(x).data,G=Vm(),B=V?.gizmo.tags?.includes(js.WorkspaceDisabled)&&!G?"workspaceDisallowsGizmo":h?.models.size===0?"noModelsAvailable":y?.kind===Pe.GizmoTest&&y.gizmo_id==null?"noTestGizmoId":null,U=rl(),z=am(),j=U.action==="moderate",{value:H}=ie("1860647109");return e.jsxs(e.Fragment,{children:[e.jsx(im,{composerController:R,clientThreadId:t,currentModelId:s,isCompletionInProgress:E}),e.jsx("div",{className:"flex justify-center empty:hidden",children:z&&j&&H?e.jsx(rm,{}):null}),w?e.jsx(lm,{onClose:_}):null,e.jsx(xg,{clientThreadId:t,disableDraftPersistence:n,onCreateNewCompletion:a,onContinueGenerating:r,currentModelId:s,account:A,modelCategories:h?.categories,currentModelConfig:ai(h?.models,s),areModelsLoading:g,isNewThread:o,isCompletionInProgress:E,className:"w-full",canContinue:T,disabled:!!B,disabledReason:B??void 0,canPause:D,isInteractableSharedThread:k,onComposerInput:i,onComposerChange:d,onAutocompleteSelect:l,headerClassName:u,hideHeader:m,onTaggingDropdownClose:c,onTaggingDropdownOpen:p,onlyAllowImageUploads:b},t)]})}export{Of as D,zg as F,pg as I,Wg as M,jg as P,Vg as T,Df as g,ao as h};
//# sourceMappingURL=jm9661216xi1kol5.js.map
