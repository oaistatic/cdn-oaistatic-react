import{r as u,f as V,j as e,M as x}from"./msupklk377u8vx8o.js";import{eI as I,ev as _,lg as T,aG as L,fA as O,ao as R}from"./idf4u2jy0wx0pvap.js";import{c as h,B as C,e8 as z,m as W}from"./i3bl95k8z8nuf4dv.js";import{C as H,S as U,i as K,g as $,D as G,f as q}from"./dlnf68ukfyzf5s4a.js";import{i as J}from"./gjp4gv474prvqiwp.js";import{F as Q}from"./j9j5epjhcjv8ndrh.js";import{W as X}from"./n737zu6y3rojcst6.js";import"./mxye9dnv7ug9w78j.js";import"./km20jt8rls1pvll5.js";import"./hskvlm4fdvagz0fn.js";import"./ojrw0o0rizu55rz7.js";import"./gc51ish3otzvnj1w.js";import"./hwl3hzno2kq7obfl.js";import"./hmii3551qscelikg.js";import"./i3xeaua08fnq6vw7.js";import"./ev39bkx1q3tpviat.js";import"./mmjudc45gj99bpja.js";import"./hykg4shppjdez6do.js";import"./kqsvxl6vimrirts2.js";import"./bpz5dug6lzivjns5.js";import"./bh8emud9m2ohtvi0.js";import"./b2dyy1jg95n5gtr8.js";import"./ojiial81qrlp15mq.js";import"./bl75917ayi16sr8y.js";import"./gvsp7fy7hloerc2p.js";import"./hgzals0lml4o26vg.js";import"./onklb7txlsriyspd.js";import"./b8sq4gagi5vun041.js";import"./k0gfwt82z96kzlbw.js";import"./etqfvs5ggajp1a11.js";import"./nr2o0yx4ps6bt6je.js";import"./iot0cxie20e0du89.js";import"./nxqfgrk9atl9s5yp.js";import"./jyaoagcxkb094sr3.js";import"./c8aouq5xzucu176k.js";import"./fg6m3tmym7bd4wpr.js";import"./2jlfyhj3fjtss87f.js";import"./eyf2nwgexpz6pjnh.js";import"./l2bq6yq3kjp539k9.js";import"./kwmncs5inhubx058.js";import"./hu4ci70fpsy8huk5.js";function E({filePath:t,side:f,lineNumber:m,onSubmit:a,onDelete:s,onClose:r,initialComment:i}){const g=i?D(i):"",[o,l]=u.useState(i?D(i):""),[b,w]=u.useState(!i),[j,v]=u.useState(!1),F=u.useRef(null),k=V(),y=()=>{if(!o)return;const d=i?{...i,content:[{content_type:"text",text:o}]}:{id:crypto.randomUUID(),type:"comment",content:[{content_type:"text",text:o}],position:{side:f===U.old?"left":"right",path:t,line:m}};a?.(d),w(!1),F.current?.blur(),r?.()};return u.useEffect(()=>{!j&&i&&o===g&&setTimeout(()=>{w(!1)},100),j&&(w(!0),F.current?.focus())},[j,i,o,g]),e.jsx("div",{className:"gap-2 bg-gray-100/50 p-4 font-sans dark:bg-gray-900",id:i?.id,children:e.jsxs("div",{className:h("flex flex-col gap-2",H),children:[e.jsx(J,{ref:F,className:"border-token-border-medium bg-token-main-surface-primary text-token-text-primary border-1.5 w-full resize-none rounded-lg p-4 text-sm ring-0 focus:border-black focus:outline-hidden dark:focus:border-white",onFocus:()=>v(!0),onBlur:()=>v(!1),placeholder:k.formatMessage({id:"code.diff.addComment",defaultMessage:"Add a comment"}),minRows:1,maxRows:10,autoFocus:!i,onSubmit:()=>{},value:o,onChange:d=>l(d.target.value),onKeyDown:d=>{d.key==="Enter"&&d.metaKey&&(d.preventDefault(),y()),d.key==="Escape"&&(d.preventDefault(),r?.())}}),b&&e.jsxs("div",{className:h("mt-2 flex items-center justify-between gap-2",!s&&"justify-end"),children:[s&&e.jsx(C,{color:"danger",onClick:()=>s?.(),children:e.jsx(x,{id:"code.diffComment.delete",defaultMessage:"Delete"})}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(C,{color:"secondary",onClick:()=>{r?.(),w(!1),i&&l(D(i))},children:e.jsx(x,{id:"code.diffComment.cancel",defaultMessage:"Cancel"})}),e.jsx(C,{color:"primary",disabled:!o,onClick:y,children:i?e.jsx(x,{id:"code.diffComment.save",defaultMessage:"Save"}):e.jsx(x,{id:"code.diffComment.comment",defaultMessage:"Comment"})})]})]})]})})}function D(t){return t.content.map(f=>f.content_type==="text"?f.text:"").join("")}function Y({copyDiffToClipboard:t,copyPatchToClipboard:f}){const[m,a]=u.useState(!1),s=r=>i=>{i.preventDefault(),i.stopPropagation(),r==="diff"?t():f()};return e.jsxs(I,{open:m,onOpenChange:a,contentAlign:"end",sideOffset:8,triggerButton:e.jsx("button",{type:"button",onClick:r=>{r.preventDefault(),r.stopPropagation(),a(!0)},className:"hover:bg-token-border-light rounded p-1",children:e.jsx(L,{className:"icon-md"})}),children:[e.jsx(_.Item,{icon:T,onClick:s("diff"),children:e.jsx(x,{id:"wham.copyFile.apply",defaultMessage:"Copy git apply"})}),e.jsx(_.Item,{icon:T,onClick:s("patch"),children:e.jsx(x,{id:"wham.copyFile.patch",defaultMessage:"Copy patch"})})]})}const Z="_diffView_avtz7_1",ee={diffView:Z};function te({diff:t,viewType:f,stickyHeader:m,enableComments:a=!1,comments:s,onCommentCreate:r,onCommentDelete:i,onCommentUpdate:g}){const o=z(),l=V(),[b,w]=u.useState(()=>!K(t.diffFile)),[j,v]=u.useState(!1),F=W();u.useEffect(()=>{t.diffFile.initTheme(o?"dark":"light")},[t.diffFile,o]);const k=(s??[]).reduce((n,c)=>{const p=c.position.path,M=c.position.side,N=c.position.line;n[p]||(n[p]={oldFile:{},newFile:{}});const S=M==="left"?n[p].oldFile:n[p].newFile;return S&&(S[N]={data:c}),n},{}),y=$(t.diffFile),d=()=>{navigator.clipboard.writeText(t.diffFile._newFileName),v(!0),setTimeout(()=>{v(!1)},1e3)},P=async()=>{t.hunksText&&(await navigator.clipboard.writeText(` (cd "$(git rev-parse --show-toplevel)" && git apply --3way <<'EOF' 
${t.hunksText} 
EOF
)`),F.success(l.formatMessage({id:"wham.message.modal.footer.copiedToClipboard",defaultMessage:"Copied git apply command to clipboard"}),{duration:3,hasCloseButton:!0}))},A=async()=>{t.hunksText&&(await navigator.clipboard.writeText(t.hunksText),F.success(l.formatMessage({id:"wham.codeDiff.copiedPatchToClipboard",defaultMessage:"Copied patch to clipboard"}),{duration:3,hasCloseButton:!0}))},B=!t.diffFile.unifiedLineLength&&!t.diffFile.splitLineLength;return e.jsxs("div",{"data-diff-header":y,className:h("flex flex-col pt-1",ee.diffView),children:[e.jsx("button",{onClick:()=>w(!b),className:h("focus-visible:outline-none",m&&"sticky top-0 z-1"),children:e.jsxs("div",{className:h("bg-token-bg-primary border-token-border-default relative flex items-center rounded-t-2xl border px-4 py-3 text-sm font-medium before:absolute before:inset-x-[-1px] before:top-[-1px] before:bottom-0 before:z-[-1] before:bg-[var(--right-bg)] before:content-['']",!b&&"rounded-b-2xl"),children:[e.jsx(O,{className:h("icon-md me-3 transition-transform duration-200",b&&"rotate-90")}),e.jsx("span",{className:"me-1 truncate text-start select-text",title:y,children:y}),e.jsx(Q,{diffFile:t.diffFile}),e.jsx(R,{label:l.formatMessage({id:"wham.codeDiff.copiedFileName",defaultMessage:"Copied File Name"}),open:j,children:e.jsx("div",{role:"button",onClick:n=>{n.preventDefault(),n.stopPropagation(),d()},className:"hover:bg-token-border-light rounded p-1",children:e.jsx(T,{className:"icon-xs"})})}),e.jsxs("div",{className:"ms-auto flex items-center gap-1 ps-1",children:[e.jsx(X,{linesAdded:t.diffFile.additionLength,linesRemoved:t.diffFile.deletionLength}),e.jsx(Y,{copyDiffToClipboard:P,copyPatchToClipboard:A})]})]})}),b&&(B?e.jsx("div",{className:"text-token-text-secondary bg-token-bg-secondary flex h-full justify-center rounded-b-2xl py-4 text-sm font-medium",children:e.jsx(x,{id:"wham.diff.noContent",defaultMessage:"No content"})}):e.jsx(G,{className:h("relative overflow-clip rounded-b-2xl transition-opacity duration-300","after:border-token-border-default after:pointer-events-none after:absolute after:inset-0 after:rounded-b-2xl after:border-s after:border-e after:border-b after:content-['']"),diffViewFontSize:12,diffFile:t.diffFile,diffViewTheme:o?"dark":"light",diffViewHighlight:!0,diffViewMode:f==="split"&&!q(t.diffFile)?3:4,diffViewWrap:!0,diffViewAddWidget:a,extendData:k[t.diffFile._newFileName],renderExtendLine:({lineNumber:n,side:c,data:p})=>!a||!(c===1?k[t.diffFile._newFileName]?.oldFile:k[t.diffFile._newFileName]?.newFile)?null:e.jsx(E,{initialComment:p,onSubmit:N=>g?.(N),onDelete:()=>i?.(p),filePath:t.diffFile._newFileName,side:c,lineNumber:n}),renderWidgetLine:({onClose:n,lineNumber:c,side:p})=>!a||!r?null:e.jsx(E,{onSubmit:r,onClose:n,filePath:t.diffFile._newFileName,side:p,lineNumber:c})}))]})}function He({diffFiles:t,unifiedDiff:f,enableComments:m,comments:a,setComments:s}){if(!t.length)return e.jsx("div",{className:"flex h-full w-full flex-1 items-center justify-center",children:e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(x,{id:"wham.whamTaskPageCodeDiffContent.noDiffAvailable",defaultMessage:"No diff available"})})});function r(o){!s||!a||s([...a,o])}function i(o){!s||!a||s(a.filter(l=>l.id!==o.id))}function g(o){!s||!a||s(a.map(l=>l.id===o.id?o:l))}return e.jsx("div",{className:"relative h-full w-full pt-6",children:e.jsx("div",{className:"flex h-full w-full flex-col gap-6 overflow-y-auto px-6 pb-6",children:t.map(o=>e.jsx(te,{diff:o,stickyHeader:!0,viewType:f?"unified":"split",enableComments:m,comments:m?a:[],onCommentCreate:r,onCommentDelete:i,onCommentUpdate:g},o.diffFile._newFileName))})})}export{He as WhamTaskPageCodeDiffContent};
//# sourceMappingURL=iq16nt0wet98enji.js.map
