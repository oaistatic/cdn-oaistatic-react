import{m as W,ai as b,bN as j,ej as w}from"./i3bl95k8z8nuf4dv.js";import{a as y,f as D,r,j as o,ac as E,d as A,h as R,D as q}from"./msupklk377u8vx8o.js";import{u as M}from"./m155zrrujuukfclv.js";import{f as L,h as N,b as Q,W as U,c as F}from"./mxye9dnv7ug9w78j.js";import{b as K,c as O}from"./gc51ish3otzvnj1w.js";import{P as $}from"./hwl3hzno2kq7obfl.js";import{f_ as B}from"./idf4u2jy0wx0pvap.js";import{u as G,W as H}from"./dlnf68ukfyzf5s4a.js";import"./hmii3551qscelikg.js";import"./i3xeaua08fnq6vw7.js";import"./km20jt8rls1pvll5.js";import"./n737zu6y3rojcst6.js";import"./hu4ci70fpsy8huk5.js";import"./l2bq6yq3kjp539k9.js";import"./hskvlm4fdvagz0fn.js";import"./ojrw0o0rizu55rz7.js";import"./ev39bkx1q3tpviat.js";import"./mmjudc45gj99bpja.js";import"./hykg4shppjdez6do.js";import"./kqsvxl6vimrirts2.js";import"./bpz5dug6lzivjns5.js";import"./bh8emud9m2ohtvi0.js";import"./b2dyy1jg95n5gtr8.js";import"./ojiial81qrlp15mq.js";import"./bl75917ayi16sr8y.js";import"./gvsp7fy7hloerc2p.js";import"./hgzals0lml4o26vg.js";import"./onklb7txlsriyspd.js";import"./b8sq4gagi5vun041.js";import"./k0gfwt82z96kzlbw.js";import"./etqfvs5ggajp1a11.js";import"./nr2o0yx4ps6bt6je.js";import"./iot0cxie20e0du89.js";import"./nxqfgrk9atl9s5yp.js";import"./jyaoagcxkb094sr3.js";import"./c8aouq5xzucu176k.js";import"./fg6m3tmym7bd4wpr.js";import"./2jlfyhj3fjtss87f.js";import"./eyf2nwgexpz6pjnh.js";function z({taskId:s,onClose:n}){const e=y(),u=W(),i=D(),{data:t,error:x}=L(s);N(s);const g=Q(({getTurnsForTask:a})=>a(s)),l=b(),m=r.useMemo(()=>l?new $(K()):new B,[l]),p=r.useSyncExternalStore(a=>m.subscribe("change",a),()=>!m.isEmpty(),()=>!1),[d,c]=r.useState([]),[P,f]=r.useState(!1),{activeAssistantTurn:_,setActiveAssistantTurnId:v}=G({taskId:s,task:t?.task,currentDiffTaskTurn:t?.current_diff_task_turn??null,currentUserTurn:t?.current_user_turn??null,currentAssistantTurn:t?.current_assistant_turn??null}),C=!!t?.task.has_unread_turn&&t?.task?.current_turn_id===t.current_assistant_turn?.id,k=t?.current_assistant_turn?.turn_status==="completed";r.useEffect(()=>{C&&k&&U.markTurnAsRead(s).then(()=>{e.invalidateQueries({queryKey:["wham","tasks"]}),e.invalidateQueries({queryKey:["wham","task",s]})})},[C,k,s,e]);const h=d.length>0,T=r.useCallback(({force:a=!1}={})=>{if(a||!h&&!p){c([]),n();return}f(!0)},[n,h,p]),S=t?.current_assistant_turn?.turn_status==="completed"&&t?.current_diff_task_turn?.id===_?.id;return x?(u.danger(i.formatMessage({id:"wham.task-details.error",defaultMessage:"Error loading task"}),{id:`wham-task-details-error-${s}`,hasCloseButton:!0,duration:3}),o.jsx(E,{to:"/codex"})):o.jsx(O.Provider,{value:m,children:o.jsx(H,{permissions:"write",onEscape:T,taskId:s,turnId:t?.current_assistant_turn?.id??"",lastTurnWithDiffId:t?.current_diff_task_turn?.id??"",confirmClose:P,setConfirmClose:f,task:t?.task,assistantTurn:_,pastTurns:g,clearComments:()=>c([]),setComments:c,comments:d,canFollowUp:S,handleClose:T,setActiveAssistantTurnId:v})})}function J(){const s=A(),n=R(),{taskId:e}=q();M(),F();const u=n.state??{},{backgroundLocation:i}=u,t=r.useCallback(()=>{s(i?-1:"/codex")},[i,s]);return e?o.jsx(j,{children:o.jsx(z,{taskId:e,onClose:t})}):null}const qt=()=>[{title:"Codex"}],Mt=w(function(){return o.jsx(J,{})});export{Mt as default,qt as meta};
//# sourceMappingURL=o1uksud7u89tz6l8.js.map
