import{B as N,c as M,bI as F,g as L,bG as S,bH as k,ej as R}from"./i3bl95k8z8nuf4dv.js";import{f as C,r as c,n as A,j as e,M as x,d as B,ac as D}from"./msupklk377u8vx8o.js";import{g as y}from"./mmjudc45gj99bpja.js";import{I as W,f as z,L as q,h as V,dC as Y}from"./idf4u2jy0wx0pvap.js";import{h as _,A as G}from"./b55502r205nz6n48.js";import{F as T}from"./imu5mwp7oamdtl8y.js";import{R as H}from"./iw3ol6hqkoiaf3nc.js";import{C as P}from"./h8tojgz341sqtlwj.js";import{I as X}from"./hykg4shppjdez6do.js";import{b as I,W as K,d as Q,e as U}from"./mxye9dnv7ug9w78j.js";import{u as Z}from"./gvkgmn13nkgyqqw9.js";import{W as J}from"./lvcn6tc5m2pwz77u.js";import{u as $}from"./umecogb8uj87jcv4.js";import"./fii0gwkgtas4sckd.js";import"./k4oexpwbiepmd1cd.js";import"./np9w83f07wa6edf5.js";import"./gc51ish3otzvnj1w.js";import"./hwl3hzno2kq7obfl.js";import"./hmii3551qscelikg.js";import"./i3xeaua08fnq6vw7.js";import"./gd7xfxa2yqt151v4.js";import"./igftvtdft8b4phs3.js";import"./o2t4lszmsavslsdu.js";import"./gwmfzjrffpu4d2tx.js";import"./n737zu6y3rojcst6.js";import"./hu4ci70fpsy8huk5.js";import"./l2bq6yq3kjp539k9.js";import"./me2w1vt1t6ynrd52.js";function ee({environment:n,isSelected:o,className:r}){return e.jsxs("div",{className:M("flex items-center justify-between gap-2",r),children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-token-text-primary text-start text-sm font-medium",children:n.label}),n.creator.email&&e.jsx("p",{className:"text-token-text-tertiary text-start text-xs leading-tight font-normal",children:e.jsx(x,{id:"wham.createEnvironments.environmentSection.createdBy",defaultMessage:"{email}",values:{email:n.creator.name}})})]}),e.jsx("div",{className:"text-token-text-secondary text-start text-sm leading-tight font-normal",children:n.description})]}),o?e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(V,{className:"h-5 w-5"})}):e.jsx("div",{className:"w-4"})]})}function te({environment:n,isSelected:o,onClick:r}){return e.jsx("button",{className:M("group flex w-full items-center justify-between gap-2 py-4","hover:bg-token-bg-tertiary cursor-pointer p-2"),onClick:r,type:"button",children:e.jsx(ee,{environment:n,isSelected:o,className:"w-full"})})}function p(){return e.jsx("div",{className:"flex w-full items-center justify-between gap-2 rounded-md",children:e.jsx(q,{className:"h-14 w-full"})})}const ne=10;function se({handleGoBack:n,handleSelectEnvironment:o,goToDataCheckPage:r}){const u=C(),[d,v]=c.useState(""),{data:f,isLoading:j,fetchNextPage:g,hasNextPage:h,isFetchingNextPage:b}=A({queryKey:["wham","environments","with-creators"],initialPageParam:null,queryFn:({pageParam:t})=>K.getEnvironmentWithCreators(ne,t),getNextPageParam:t=>t.cursor??null}),i=c.useMemo(()=>f?.pages.flatMap(t=>t.items??[])??[],[f]),l=i.filter(t=>t.label.toLowerCase().includes(d.toLowerCase())),s=I(t=>t.environmentId),m=I(t=>t.setEnvironmentId);return c.useEffect(()=>{if(s){const t=i.find(w=>w.id===s);t?o(t.id,y(t)):m(null)}else i.length===1&&(m(i[0].id),o(i[0].id,y(i[0])))},[s,i,o,m]),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex justify-between",children:e.jsx(W,{color:"search",iconPosition:"left",icon:z,className:"text-token-text-tertiary flex h-10 w-full items-center rounded-lg! p-3!",inputClassName:"text-token-text-primary w-full",containerInputClassName:"w-full",name:"search-envs",type:"text",value:d,onChange:t=>v(t.target.value),placeholder:u.formatMessage({id:"wham.environmentSection.searchPlaceholder",defaultMessage:"Search"}),ariaLabel:u.formatMessage({id:"wham.environmentSection.searchAria",defaultMessage:"Search"})})}),e.jsx("div",{className:"border-token-border-heavy flex flex-col gap-2 rounded-lg border p-2",children:e.jsx("div",{className:"flex h-96 flex-col overflow-y-auto",children:j?e.jsxs("div",{className:"flex h-full flex-col gap-2",children:[e.jsx(p,{}),e.jsx(p,{}),e.jsx(p,{}),e.jsx(p,{}),e.jsx(p,{}),e.jsx(p,{}),e.jsx(p,{})]}):e.jsxs(e.Fragment,{children:[l.length===0&&!h?e.jsxs("div",{className:"flex h-full flex-col items-center justify-center",children:[e.jsx("p",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(x,{id:"wham.codexOnboardingEnvironments.noEnvironments",defaultMessage:"No environments found"})}),e.jsx("p",{className:"text-token-text-secondary text-xs",children:e.jsx(x,{id:"wham.codexOnboardingEnvironments.noEnvironmentsDescription",defaultMessage:"You will be able to create more environments in settings later"})})]}):l.map((t,w)=>e.jsxs("div",{children:[e.jsx(te,{environment:t,isSelected:s===t.id,onClick:()=>o(t.id,y(t))}),w!==l.length-1&&e.jsx("div",{className:"border-token-border-light border-t"})]},t.id)),e.jsx(X,{isFetchingNextPage:b,hasNextPage:h??!1,fetchNextPage:g,bgColor:"dark:bg-token-bg-secondary"})]})})}),e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx(N,{color:"secondary",size:"medium",type:"button",onClick:n,children:e.jsx(x,{id:"wham.codexOnboardingEnvironments.back",defaultMessage:"Back"})}),e.jsx(N,{color:"primary",size:"medium",disabled:!s,onClick:r,children:e.jsx(x,{id:"wham.codexOnboardingEnvironments.useEnvironment",defaultMessage:"Use environment"})})]})]})}function ae({handleGoBack:n,handleSelectEnvironment:o,goToDataCheckPage:r,lockPageView:u}){const d=C(),v=L(),[f,j]=c.useState(""),[g,h]=c.useState(null),{mutate:b,isPending:i}=Z({onSuccess:a=>{S.count(k.CODEX,"onboarding.environments.create_success"),o(a.id,y(a)),r()}}),{data:l,isLoading:s}=U();c.useEffect(()=>{S.count(k.CODEX,"onboarding.environments.view")},[]);const m=c.useMemo(()=>l?.installations??[],[l]),t=$({defaultValues:{repositoryId:""},validators:{onSubmit:({value:a})=>{const E={};return(!a.repositoryId||a.repositoryId==="")&&(E.repositoryId=d.formatMessage({id:"wham.codexOnboardingEnvironments.repositoryIsRequired",defaultMessage:"Repository is required"})),{fields:E}}},onSubmit:({value:a})=>{S.count(k.CODEX,"onboarding.environments.submit"),u(),b({...a,label:f,description:"",machine:"wham-public/wham-universal",workspaceDirectory:"/workspace",share_settings:"workspace",setupCommands:"",envVars:[],secrets:[]})}}),w=a=>{a.preventDefault(),a.stopPropagation(),t.handleSubmit()};return c.useEffect(()=>{s||m.length===0&&_()},[s,m.length,v]),e.jsx(e.Fragment,{children:e.jsxs("form",{onSubmit:w,className:"flex flex-col gap-6",children:[e.jsx(P,{title:d.formatMessage({id:"wham.codexOnboardingEnvironments.createYourFirstEnvironment",defaultMessage:"Create your starting environment"}),description:d.formatMessage({id:"wham.codexOnboardingEnvironments.createYourFirstEnvironment.description",defaultMessage:"Pick a repo to set up the basics. You can customize your environment later."})}),e.jsxs("div",{className:"flex w-full flex-col gap-4",children:[e.jsx(G,{selectedInstallationId:g,setSelectedInstallationId:h}),e.jsx(t.Field,{name:"repositoryId",children:a=>e.jsxs("div",{className:"flex w-full flex-col gap-4",children:[e.jsx(H,{installationId:g,selectedRepository:a.state.value,onSelect:(E,O)=>{a.handleChange(E),j(O)}}),e.jsx(T,{field:a})]})}),e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx(N,{color:"secondary",size:"medium",type:"button",onClick:n,children:e.jsx(x,{id:"wham.codexOnboardingEnvironments.back",defaultMessage:"Back"})}),e.jsx(N,{color:"primary",size:"medium",loading:i,disabled:!f,onClick:()=>t.handleSubmit(),children:e.jsx(x,{id:"wham.codexOnboardingEnvironments.createEnvironment",defaultMessage:"Create environment"})})]})]})]})})}function oe(){return e.jsx("div",{className:"mx-auto flex h-full max-w-4xl flex-col p-8 md:p-24",children:e.jsxs("div",{className:"flex h-full w-full flex-col items-center justify-center gap-2",children:[e.jsx(x,{id:"wham.codexOnboardingEnvironments.loading",defaultMessage:"Almost thereâ€¦"}),e.jsx(F,{})]})})}function ie(){const n=C(),{eligible:o,loading:r}=Y(),{data:u,isLoading:d}=Q({retry:3}),v=B(),[f,j]=c.useState(!1),g=()=>{v("/codex/onboarding/connections")},h=()=>{v("/codex/onboarding/data-check")},b=I(s=>s.setEnvironmentId),i=I(s=>s.setBranch),l=(s,m)=>{b(s),i(m)};return r||d?e.jsx(oe,{}):o?e.jsx(J,{showSidebar:!1,canShowAlert:!1,hideExtraHeaderInfo:!0,children:e.jsx("div",{className:"mx-auto flex max-w-3xl flex-col gap-2 p-12",children:!f&&u&&u.length>0?e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsx(P,{title:n.formatMessage({id:"wham.codexOnboardingEnvironments.selectEnvironment",defaultMessage:"Select an environment"}),description:n.formatMessage({id:"wham.codexOnboardingEnvironments.selectEnvironment.description",defaultMessage:"Environments configure the container for the agent to run. Not seeing your repo? You can create new environments in settings later."})}),e.jsx(se,{handleGoBack:g,handleSelectEnvironment:l,goToDataCheckPage:h})]}):e.jsx(ae,{handleGoBack:g,handleSelectEnvironment:l,goToDataCheckPage:h,lockPageView:()=>j(!0)})})}):e.jsx(D,{to:"/codex"})}const Ae=()=>[{title:"Codex"}],Be=R(function(){return e.jsx(ie,{})});export{Be as default,Ae as meta};
//# sourceMappingURL=e7bfkuq2jm4lb7u0.js.map
