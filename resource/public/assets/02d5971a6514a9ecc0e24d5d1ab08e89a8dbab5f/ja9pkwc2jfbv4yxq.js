import{B as j,ej as w}from"./i3bl95k8z8nuf4dv.js";import{f as y,d as k,a as P,D as v,r as c,u as C,j as e,M as o}from"./msupklk377u8vx8o.js";import{dD as _,dE as N,ad as M}from"./idf4u2jy0wx0pvap.js";import{S as p}from"./hyviotcy9l0eyqwj.js";import{b as q}from"./f8brziwaxja17w8l.js";import{g as b,W as I}from"./mxye9dnv7ug9w78j.js";import{a as R}from"./lvcn6tc5m2pwz77u.js";import"./fii0gwkgtas4sckd.js";import"./k4oexpwbiepmd1cd.js";import"./np9w83f07wa6edf5.js";import"./gc51ish3otzvnj1w.js";import"./hwl3hzno2kq7obfl.js";import"./hmii3551qscelikg.js";import"./i3xeaua08fnq6vw7.js";import"./gd7xfxa2yqt151v4.js";import"./igftvtdft8b4phs3.js";import"./o2t4lszmsavslsdu.js";import"./gwmfzjrffpu4d2tx.js";import"./m2labkp4eli82luk.js";import"./ikpwdaspyqzs2oop.js";import"./k0gfwt82z96kzlbw.js";import"./b8sq4gagi5vun041.js";import"./etqfvs5ggajp1a11.js";import"./n737zu6y3rojcst6.js";import"./hu4ci70fpsy8huk5.js";import"./l2bq6yq3kjp539k9.js";import"./me2w1vt1t6ynrd52.js";function S(){const i=y(),r=k(),n=P(),{taskId:t,turnId:a}=v(),[f,m]=c.useState(!1),x=c.useMemo(()=>b(t,a,n,{refetchInterval:s=>{const d=s.state?.data?.turn?.pull_request_status;switch(d){case null:case void 0:case"not_created":case"creating":return 2e3;case"failed":case"created":return!1;default:_(d)}}}),[t,a,n]),{data:u}=C(x),g=async()=>{if(!(!t||!a))try{m(!0),await I.createPr(t,a,E()),await n.invalidateQueries({queryKey:["wham","task"]})}catch{}finally{m(!1)}},l=u?.turn?.pull_request_data?.url;c.useEffect(()=>{l&&(window.location.href=l)},[l]);const h=u?.turn?.pull_request_status==="failed";return e.jsx(q,{mobileHeaderRightContent:null,children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx(R,{className:"absolute start-0 end-0 top-0",children:e.jsx("div",{className:"flex w-full justify-end",children:e.jsx(N,{onClick:()=>{window.opener?(window.opener.focus(),window.close()):r(`/codex/tasks/${t}`)},icon:e.jsx(p,{}),label:i.formatMessage({id:"wham.task.pr.header.title",defaultMessage:"Back to task"})})})}),e.jsx("div",{className:"flex grow items-center justify-center p-4",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(M,{className:"mb-4 h-15 w-15"}),h?e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"text-token-text-error flex items-center gap-1",children:e.jsx(o,{id:"wham.task.pr.inProgress.error.description",defaultMessage:"Failed to create pull request. Please try again."})}),e.jsx(j,{color:"secondary",size:"small",icon:p,loading:f,onClick:s=>{s.preventDefault(),s.stopPropagation(),g()},children:e.jsx(o,{id:"wham.task.pr.inProgress.error.button",defaultMessage:"Retry"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"loading-shimmer-pure-text text-lg font-semibold",children:e.jsx(o,{id:"wham.task.pr.inProgress.title",defaultMessage:"Creating pull requestâ€¦"})}),e.jsx("p",{className:"text-token-text-secondary text-sm",children:e.jsx(o,{id:"wham.task.pr.inProgress.description",defaultMessage:"Pull request will automatically open once it has been created."})})]})]})})]})})}function E(){const r=new URLSearchParams(location.search).get("mode");if(r==="draft")return"draft";if(r==="auto_merge")return"auto_merge"}const ne=()=>[{title:"Codex"}],le=w(function(){return e.jsx(S,{})});export{le as default,ne as meta};
//# sourceMappingURL=ja9pkwc2jfbv4yxq.js.map
