import{dR as f,bO as p,b as _,f as c,cN as d,s as w,fc as h,_ as g,ak as l,al as u,bo as y,ax as S}from"./i3bl95k8z8nuf4dv.js";import{cE as b,cF as F,cG as V,e as x}from"./idf4u2jy0wx0pvap.js";import{u as m,r as i}from"./msupklk377u8vx8o.js";import{i as E}from"./nr2o0yx4ps6bt6je.js";function v(){const a=x(),e=w();return e&&a&&!h(a)&&e.isEnterprisey()}function D(){return f(p.ChartSerialization)}function H(a,e){const t=a==="chart"?l.HasSeenAdaInteractiveChart:l.HasSeenAdaInteractiveTable,[s,o]=i.useState(u.getItem(t,{userId:e})??!1),n=i.useCallback(()=>{o(!0),u.setItem(t,!0,{userId:e})},[t,e]);return[s,n]}function N(a){const[e,t]=i.useState([]),s=y(a,S.getBranch);return i.useEffect(()=>{const o=I(s);o.length!==e.length&&t(o)},[e.length,a,s]),e}function z(a){const e=a.metadata?.aggregate_result?.messages.filter(E)??[];let t=0;const s=(a.metadata?.ada_visualizations??[]).map(n=>{let r=n;return n.type=="chart"&&(r={...n,fallback_image:e[t++]}),r}),o=(a.metadata?.attachments??[]).filter(n=>b(n.name)).map(n=>({type:"table",file_id:n.id??"",title:F(n),file_name:n.name,context_connector_info:n.context_connector_info}));return[...s,...o]}function I(a){return a.filter(t=>t.message?.author.role==="tool"&&t.message?.author.name==="python"||(t.message?.metadata?.attachments??[]).length>0).flatMap(t=>z(t.message))}async function T(a,e,t){const s=await a.text(),{parse:o}=await g(async()=>{const{parse:r}=await import("./oeujip5i1ptrxie5.js");return{parse:r}},[]),n=o(s);return{content:{columnNames:n.shift(),columnTypes:n[0].map(()=>"string"),rows:n},file_name:e,download_url:t}}function A(a){const e=a[0].values.length,t=[];for(let s=0;s<e;s++){const o=a.map(n=>n.values[s]);t.push(o)}return t}function L(a){return m({queryKey:["ada-visualization","chart",a.file_id],queryFn:async()=>{const e=await c.getFileDownloadLink(a.file_id);if(e.status===d.Success){const s=await(await fetch(e.download_url)).json();return{content:{chart_type:s.type,title:s.title,labels:s.labels,datasets:s.datasets,x_label:s.x_label,y_label:s.y_label},file_name:e.file_name??"",download_url:e.download_url}}else throw new Error("Failed to download chart json from interpreter")}})}function M(a){return m({queryKey:["ada-visualization","table",a.file_id],queryFn:async()=>{if(a.file_name&&V(a.file_name)){const e=await _.safeGet("/ada/parse_xls/{file_id}",{parameters:{path:{file_id:a.file_id}}});return{content:e.sheets.map(t=>({name:t.name,columnNames:t.columns.map(s=>s.name),columnTypes:t.columns.map(()=>"string"),rows:A(t.columns)})),download_url:e.download_url,file_name:a.file_name}}else{const e=await c.getFileDownloadLink(a.file_id);if(e.status===d.Success){const t=await fetch(e.download_url);return T(t,e.file_name??"",e.download_url)}else throw new Error("Failed to download from interpreter")}},throwOnError:!1})}export{N as a,M as b,L as c,v as d,H as e,z as g,D as u};
//# sourceMappingURL=bxvybsm8xf7u0vz6.js.map
