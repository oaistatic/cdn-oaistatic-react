const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/cgy1a4ln2o7x1ucq.js","assets/ls1hkjm4csy89kc5.js","assets/hj6jep7mk4776vwc.js","assets/jfjoua4700kji9z3.js","assets/root-g83krhyb.css","assets/conversation-small-hvit8l60.css","assets/m6d28lwoyiuxtlg3.js","assets/jy1u8exw8iz2slve.js","assets/f06euqb6n9n90ph6.js","assets/oe4qwwp6lvtt8c1x.js","assets/lup3lhp4jup8hwgh.js","assets/maaa59io6z1tsugr.js","assets/ko48v43v67hat5pb.js","assets/n3zdfvn2wsqd8rrk.js","assets/gy64pge8qevmvg7e.js","assets/ekgxdfqrb84ds7yx.js","assets/eznezzwnoh2bc43l.js","assets/c166njesc8ruqs2t.js","assets/op6u27mntqa8at4f.js","assets/fzrn137102spawew.js","assets/fbs9v8bh3wllita3.js","assets/lqfx7r9jl2q1tbdy.js","assets/gnihsipfzowq5klb.js","assets/gm98iwmt6t0m5rzt.js","assets/f9d7padxd97mxih2.js","assets/bjbryornudc3ovxe.js","assets/ht69l5cqsqb2usac.js","assets/ltik0hzezyevzkdj.js","assets/jl416oerpm5p44nd.js","assets/b8nw7o07u9fxmapm.js","assets/epe2ts57f6uih0zz.js","assets/btagl6w1gub4aw61.js","assets/n5c76wr6kp07hxp3.js","assets/eey4w0zfc26uarhq.js","assets/mzkxlhrlmxhntkvn.js","assets/i8oyu712pii988i4.js","assets/k9nmbrmwxe5kftqh.js","assets/kvstg2tzx9qc64io.js","assets/etwkfz2vgi16v29o.js","assets/np3k8d7kul7llit2.js","assets/fzpqbcgft3m73fai.js","assets/m89x2zftpo6hrypr.js","assets/e65eph5k56t09h70.js","assets/exdc9xpq8ubwzri2.js","assets/f35srtyza27o1d4v.js","assets/c5hp2e6cf62lum4k.js","assets/enfrb2yfoh52zdmb.js","assets/kxop6zvaqduak0b6.js","assets/or5cnyq3n3nz4l0h.js","assets/hs1cxbaatjjjvt15.js","assets/hzafhrv9gkbf31n7.js","assets/e2qest7knlqdkffe.js","assets/mbpp0embmbt5iptr.js","assets/nh14du86kynnf5fc.js","assets/dt7ksh4fvumz5f8p.js"])))=>i.map(i=>d[i]);
import{dC as Fe,cn as ne,F as re,E as ue,ae as Oe,cN as We,D as Re,dV as Ks,af as Xs,aH as ae,cK as Ys,cx as Be,be as Zs,b8 as De,bK as Js,h1 as et,z as st,M as tt,bf as at,bg as it,V as ie,bH as O,b5 as He,aG as de,cW as Ve,cH as he,dQ as gs,el as nt,cG as rt,bX as $e,a as oe,h2 as ot,aW as lt,ea as fs,cF as ee,cX as qe,d2 as ps,cO as Se,P as hs,aL as Qe,bW as xe,cL as ct,cr as xs,aq as dt,fJ as vs,co as js,dI as ut,cp as ys,dU as ve,o as mt,fG as bs,cI as gt,a_ as ft,gV as pt,aX as ht,b9 as xt,g as es,L as ss,gM as vt,y as jt,G as yt,fE as bt,g5 as Mt,bP as wt,bQ as Pt}from"./jfjoua4700kji9z3.js";import{R as Ms,r as l,j as e,e as H,b as ws,M as m,d as le,f as me,ae as Tt,a9 as kt,a8 as Ps,C as St,k as _t}from"./ls1hkjm4csy89kc5.js";import{gv as Ts,dh as It,mc as Nt,ke as ks,cP as Ss,md as _s,ds as W,b as Is,cW as be,cX as Ns,e4 as Ke,dN as Ct,dB as Gt,cQ as At,dz as Le,aV as G,dC as we,dD as se,dR as je,dL as ye,dF as Xe,bh as Cs,me as Rt,bi as Gs,bj as Lt,mf as zt,g$ as te,dE as Et,mg as ze,e8 as Ut,d4 as As,iI as Ft,dK as Ot,dW as Wt,dV as Bt,d7 as Dt,dn as Rs,cj as Ht,dp as Ls,dq as zs,du as Vt,mh as $t,dt as qt,e7 as Qt,dw as Kt,ci as Ee,dx as Xt,k8 as Yt,mi as ts,kc as _e,kd as Zt,gr as as,mj as Es,mk as Jt,dX as Us,ml as ea,mm as sa,ka as ta,mn as aa,dY as ia,fZ as na,mo as is,bk as ra,T as oa,f6 as la,mp as ca,a5 as ns,aa as da,e5 as ua,mq as ma,bm as ga,e2 as fa,jG as rs,x as pa,mr as ha,ms as xa,d as va,mt as ja,mu as os,mv as ls,mw as ya,r as ba,lA as Ma,h1 as cs,F as wa}from"./hj6jep7mk4776vwc.js";import{M as Fs,A as ce,G as Pa,a as Ta,b as ds,s as ka,S as Sa,c as _a,g as Ia,d as Na}from"./kvstg2tzx9qc64io.js";import{f as Ca}from"./m89x2zftpo6hrypr.js";import{M as Os}from"./e65eph5k56t09h70.js";import{i as Ue}from"./or5cnyq3n3nz4l0h.js";import{S as Ga}from"./gm98iwmt6t0m5rzt.js";import{G as Ws}from"./ltik0hzezyevzkdj.js";import{G as Aa}from"./hs1cxbaatjjjvt15.js";import{i as Ra}from"./fzpqbcgft3m73fai.js";import{S as La}from"./hzafhrv9gkbf31n7.js";import{h as za}from"./f35srtyza27o1d4v.js";import{F as X,a as Y,b as Ie,c as Ea,G as Ua}from"./i8oyu712pii988i4.js";import{G as Fa}from"./e2qest7knlqdkffe.js";import{S as Oa}from"./mbpp0embmbt5iptr.js";import{b as Wa}from"./ht69l5cqsqb2usac.js";function Ba(s,t){const a=ue(s),i=re.getTree(a),n=[];let r=re.getCurrentNode(a);for(;r!=null&&(t==null||r.id!==t);)n.unshift(r.message),r=r.parentId!==""?i.getNodeByIdOrMessageId(r.parentId):void 0;return n}function Da(s){return s.filter(i=>i.recipient==="gizmo_editor.update_behavior").flatMap(i=>i.content.content_type==="text"?i.content.parts:i.content.content_type==="code"?[i.content.text]:[]).map(i=>JSON.parse(i)).reduce((i,n)=>({...i,...n}),{})}async function Ha(s){let t;for(const a of s)if(a.author.name==="gizmo_editor.generate_profile_pic"){const i=Ys.getImageAssetPointers(a);i.length>0&&(t=i.at(-1))}if(t!=null){const a=It(t.asset_pointer),i=await Oe.getFileDownloadLink(a);if(i.status===We.Success)return{id:a,permalink:i.download_url}}}async function Va(s,t,a,i){const n=Ba(t,i),r=Da(n);let d=await Ha(n);if(Ue(r)&&d==null)return;const{name:g,context:u,description:v,profile_pic_file_id:o,prompt_starters:y}=r;if(o!=null)try{const c=await Oe.getFileDownloadLink(o,s.id);c.status===We.Success&&(d={id:o,permalink:c.download_url})}catch(c){Re.addError(new Error("Error while retrieving profile pic in update",{cause:c})),a.warning("Something went wrong updating your GPT's profile picture.",{duration:3})}const p={name:typeof g=="string"?g:void 0,description:typeof v=="string"?v:void 0,instructions:typeof u=="string"?u:void 0,promptStarters:Array.isArray(y)?y:void 0,profilePictureId:d?.id,profilePictureUrl:d?.permalink};return Ks(p,c=>c!=null)}function $a(s){const t=new Set;for(const u of s.tools)t.add(u.type);const a=s.name??"",i=s.description??"",n=s.instructions??"",r=Array.from(t).join(","),d=a===""&&i===""&&n==="",g=s.profilePictureUrl!=null;return d?`The GPT you are about to has the following abilities: ${r}.`:`This is the GPT's current set of fields:

name: ${a}

description: ${i}

context: ${n}

abilities: ${r}

${g?"The GPT has a profile picture.":"This GPT does not have a profile picture. You must generate a profile picture when you next update your behavior."}
`}const qa=10;function Bs(s,t){const a=s.current,i=t.current;if(Fe(a,i))return;const n={};a.name!==i?.name&&(n.name=a.name),(a.description??"")!==(i?.description??"")&&(n.description=a.description??""),a.instructions!==(i?.instructions??"")&&(n.context=a.instructions??"");const r=new Set(i?.files?.map(o=>o.file_id)??[]),d=new Set(a.files?.map(o=>o.file_id)??[]),g=(a.files??[]).filter(o=>!r.has(o.file_id)),u=(i?.files??[]).filter(o=>!d.has(o.file_id));if(Ue(n)&&g.length===0&&u.length===0)return;const v=[];if(!Ue(n)){const o=`Explicitly update the GPT's behavior to the following exact fields:

    ${JSON.stringify(n,null,2)}

    "Do not call update_behavior yet. Instead, use these updated fields as the GPT's current behavior, and in the next call to update_behavior, incorporate these changes."
    `;v.push(ne(o))}if(u.length>0&&v.push(ne(`The user has removed the following files from the GPT. You can no longer reference these files: ${u.map(o=>o.file_id).join(", ")}`)),g.length>0){const o=g.slice(0,qa);v.push(ne(`The user is adding these files to the GPT. The GPT may reference these files. The file IDs are: ${o.map(y=>y.file_id).join(", ")}`,{attachments:o.map(y=>({id:y.file_id,name:y.name,size:y.size}))}))}return v}function Qa(s){if(s.length===0)return;const t=`The user is uploading files in their next message. If you need to reference these in calls to update_behavior, you will use the following File ID(s), in order: ${s.map(a=>`"${a.fileId}"`).join(", ")}`;return[ne(t)]}function Ka(s){const t="Remember, you should be calling either update_behavior or generate_profile_pic after most messages from the user. Your personality should be neutral and separate from the GPT you are creating.";if(!re.findNode(ue(s),i=>i.message.content.content_type==="text"&&i.message.content.parts[0]===t))return[ne(t)]}function Xa(s,t){Xs.initThread(s,{kind:ae.GizmoMagicCreate,gizmo_id:void 0,behavior_overrides:t});const a=Ts(s);return async(n,r,d,g)=>{a({sourceEvent:n,promptMessage:ne(g),prependMessages:Bs(r,d),completionMetadata:{conversationMode:{kind:ae.GizmoMagicCreate,gizmo_id:r.current.id,behavior_overrides:t}}})}}const Ya="Generate a new profile picture for this GPT using gizmo_editor generate_profile_pic. Do not prompt the user for any clarification. Do not send extra text outside of the tool function call. DO NOT CALL update_behavior or otherwise update GPT behavior in your response.";function Za(s,t){l.useEffect(()=>{re.findNode(ue(s),i=>et(i.message)||i.message.author.role===st.System&&i.message.content.content_type===tt.Text)||De(s,i=>{at.updateTree(i,(n,r)=>{const d=n.findNode(g=>g.message.clientMetadata?.isPlaceholderTemplateAssistantWelcomeMessage===!0,r);return d&&(d.id===r&&(r=n.rootId),n.deleteNode(d.id)),t?n.addMessageNode(r,it(t,void 0,{isPlaceholderTemplateAssistantWelcomeMessage:!0})):r})})},[s,t])}function Ja(s,t,a){Is(s,{kind:ae.GizmoMagicCreate,gizmo_id:t.id,behavior_overrides:a}),l.useEffect(()=>{De(s,n=>{n.mode={kind:ae.GizmoMagicCreate,gizmo_id:t.id,behavior_overrides:Js(a)}})},[s,t.id,a]);const[i]=l.useState(()=>{const n=t.id==null,r=t.id!=null&&t.name!==""&&t.description!=null&&t.instructions!==""&&t.profilePictureUrl!=null;return n?`Hi! I'll help you build a new GPT. You can say something like, "make a creative who helps generate visuals for new products" or "make a software engineer who helps format my code."

What would you like to make?`:r?`Welcome back! Is there anything ${t.name} should be doing better? Anything you'd like to change?`:"You're back! Let's continue where we left off..."});Za(s,i)}function ei({gizmoEditorData:s,updateGizmo:t,clientThreadId:a,gizmoEditorDataRef:i,magicMakerBehaviorOverrides:n,magicMakerConversationGizmoEditorDataRef:r,requireGizmoId:d}){const g=l.useRef(d);g.current=d;const u=l.useMemo(()=>({gizmoEditorData:s,gizmoId:s.id,mode:"magic",behaviorOverrides:n,getGizmoId:g.current}),[s,n]),v=Nt(y=>y.files.filter(p=>p.status===W.Ready&&p.gizmoId!=null)),o=l.useCallback(y=>{if(t(p=>({...p,files:[...p.files??[],...Be(v.map(c=>c.fileId!=null&&{file_id:c.fileId,name:c.file.name,size:c.file.size,type:ks(c.file),last_modified:c.file.lastModified,file_size_tokens:c.fileSpec?.fileTokenSize}))]})),r.current=Ss(i.current),!y.completionType||y.completionType===Zs.Next){const p=re.getCurrentNode(ue(a)),c=p.message.clientMetadata?.isPlaceholderTemplateAssistantWelcomeMessage?p.message:void 0;c&&(y.existingMessages=[c]),y.prependMessages=[...Qa(v)??[],...Bs(i,r)??[],...Ka(a)??[],...y.prependMessages??[]]}return y},[a,v,i,r,t]);return e.jsx(_s.Provider,{value:u,children:e.jsx("div",{className:"relative flex h-full grow overflow-auto",children:e.jsx("div",{className:"grow",children:e.jsx(Os,{clientThreadId:a,getGizmosCompletionParams:o,hideHeader:!0})})})})}const si=Ms.memo(ei);function ti({gizmo:s,updateGizmo:t,publishedGizmo:a,promoteGizmo:i,appealGizmo:n,setAppealState:r,showActionsModal:d,shareOnly:g,onClose:u}){const[v,o]=l.useState({type:"privacy"});return v.type==="privacy"?e.jsx(ii,{gizmo:s,updateGizmo:t,publishedGizmo:a,promoteGizmo:i,appealGizmo:n,setAppealState:r,setStep:o,showActionsModal:d,shareOnly:g,onClose:u}):e.jsx(ni,{publishedGizmo:v.publishedGizmo,onClose:u})}function ai(s){return s?G.Workspace:G.Link}function ii({gizmo:s,publishedGizmo:t,updateGizmo:a,promoteGizmo:i,appealGizmo:n,setAppealState:r,setStep:d,showActionsModal:g,shareOnly:u,onClose:v}){const[o,y]=l.useState(!1),p=be(Ns.isBusinessWorkspace),c=H(),M=ie(),[b,A]=l.useState(Ke(s)?ai(!!p):s.sharingRecipient),I=ws(),T=Ra(b,s.sharingTargets),{data:w,isLoading:k}=Ct(),x=Gt(),[f,S]=l.useState(t!=null&&t.gizmo.display.categories.length>0?x.data?.categories.find(j=>j.id===t.gizmo.display.categories[0])?.id:void 0);l.useEffect(()=>{S(t?.gizmo.display.categories[0])},[t?.gizmo.display.categories]);const[N,U]=l.useState(void 0),C=l.useRef(At((j,E)=>Le.generateCategory(j,E),1e3)),L=w?.is_verified?void 0:c.formatMessage({id:"qUMu4e",defaultMessage:"To publish your GPTs to the Explore GPTs page, set up your builder profile in the user settings page."});b===G.Marketplace&&L!=null&&!k&&A(G.Link);const B=p&&!s.sharingTargets?.some(j=>j.recipient===G.Link),F=we(s,b,f),z=F.includes(se.MissingPublicActionPrivacyPolicyURL),V=s.tools.find(j=>j.type===O.JIT_PLUGIN&&!j.metadata.privacy_policy_url),ge=be(j=>j.currentWorkspace),Q=He();l.useEffect(()=>{let j=!0;return(async()=>{try{if(f!=null)return;const E=await C.current(s.name,s.instructions);j&&f==null&&(E?S(E.id):U(!0))}catch{j&&f==null&&U(!0)}})(),()=>{j=!1}},[s.instructions,s.name,Q,f]);const{value:$}=de("4226692983");return e.jsx(Ve,{testId:"modal-simple-share-gizmo",type:"success",isOpen:!0,onClose:v,title:e.jsx(m,{id:"9viumf",defaultMessage:"Share GPT"}),showCloseButton:!0,primaryButton:T?e.jsx(he,{color:"primary",disabled:F.length>0,loading:o,onClick:async()=>{try{if(y(!0),u){if(!t?.gizmo.id){M.danger(c.formatMessage({id:"QYVEx8",defaultMessage:"Error sharing GPT"}));return}const j=await Le.shareGizmo(t.gizmo.id,f?{sharing:je(b,[],ye),categories:[f]}:{sharing:je(b,[],ye)});j.error?(M.warning(c.formatMessage({id:"tmIKmp",defaultMessage:"Unable to share GPT"})),a({sharingTargets:j.sharing_targets}),r({gizmoId:t.gizmo.id,sharingRecipient:b,categories:t.gizmo.display.categories,moderationType:Fs.PublishBlocked,sharingTargets:j.sharing_targets,showModal:ce.AppealAvailable})):(I.setQueryData(["gizmo",{gizmoId:t.gizmo.id},{draft:!1}],E=>j.resource),a(E=>({...E,sharingRecipient:b})),M.success(c.formatMessage({id:"SWSzcY",defaultMessage:"Sharing settings updated"})),v())}else{const j=await i({recipient:b,subjects:je(b,[],ye)},f);j?(d({type:"published",publishedGizmo:j}),a(E=>({...E,id:j.gizmo.id,sharingRecipient:b})),j.gizmo.live_version!=null&&a({liveVersion:j.gizmo.live_version}),M.success(c.formatMessage({id:"R5zko1",defaultMessage:"GPT published"}),{testId:"gpt-published-toast"})):(M.warning(c.formatMessage({id:"uf7WYw",defaultMessage:"Unable to publish GPT"})),v())}}finally{y(!1)}},"data-testid":"save-gizmo-button",children:e.jsx(m,{id:"SW4DG4",defaultMessage:"Save"})}):$?e.jsx(e.Fragment,{children:e.jsx(he,{color:"primary",onClick:async()=>{await n(b,f)},children:e.jsx(m,{id:"bBmLUr",defaultMessage:"Appeal"})})}):null,secondaryButton:t?e.jsx(he,{color:"secondary",onClick:j=>Xe(t,M,j,c.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"})),children:e.jsx(m,{id:"wvL15a",defaultMessage:"Copy link"})}):null,children:e.jsxs("div",{className:"mx-[-16px] flex flex-col gap-3 text-sm",children:[e.jsx("div",{className:"space-y-1.5",children:e.jsxs(Cs,{value:b,onValueChange:j=>A(j),children:[s.sharingTargets&&s.sharingTargets.map((j,E)=>e.jsx(Ne,{value:j.recipient,disabled:j.recipient===G.Marketplace&&L!=null,tooltipText:j.recipient===G.Marketplace?L??c.formatMessage({id:"0Rcb4e",defaultMessage:"Your GPT will appear in the Explore GPTs page"}):void 0,shareLevel:j.recipient},E)),B&&e.jsxs(e.Fragment,{children:[e.jsx(Ne,{value:G.Link,disabled:!0,tooltipText:c.formatMessage(us.workspaceDisabledHint),shareLevel:G.Link,workspaceName:ge?.name}),e.jsx(Ne,{value:G.Link,disabled:!0,tooltipText:c.formatMessage(us.workspaceDisabledHint),shareLevel:G.Marketplace,workspaceName:ge?.name})]})]})}),z&&e.jsx("div",{className:"text-xs text-red-500",children:e.jsx(m,{id:"/iw1Iv",defaultMessage:"Public actions require valid privacy policy URLs. Click <fixlink>here</fixlink> to update.",values:{fixlink:j=>e.jsx("button",{onClick:()=>{g(V?.metadata.action_id)},className:"underline",children:j})}})}),b!==G.Private&&e.jsx(Pa,{gizmo:s,category:f,categories:b===G.Marketplace?x.data?.categories??[]:void 0,onCategoryChange:b===G.Marketplace?j=>S(j.id):void 0}),b===G.Marketplace&&(N?e.jsx("div",{className:"text-xs text-red-500",children:e.jsx(m,{id:"tpC3ui",defaultMessage:"There was an error updating the list of categories"})}):null),!T&&$&&e.jsx("div",{className:"text-token-text-secondary flex items-center justify-between text-sm",children:e.jsx(m,{id:"jLCMMV",defaultMessage:"Because this GPT previously may have violated our policies, you will have to submit an appeal to make it available at this level."})})]})})}function ni({publishedGizmo:s,onClose:t}){const a=Rt(s),i=H(),n=ie();return e.jsx(Ve,{testId:"modal-simple-share-published",type:"success",isOpen:!0,onClose:t,title:e.jsx(m,{id:"rCRRmx",defaultMessage:"Settings Saved"}),showCloseButton:!0,primaryButton:e.jsx(he,{color:"primary",as:"link",to:a,children:e.jsx(m,{id:"lyZz44",defaultMessage:"View GPT"})}),children:e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"bg-token-main-surface-secondary flex gap-1 rounded-sm px-2 py-1",children:[e.jsx("div",{className:"line-clamp-1 break-all text-ellipsis",children:a}),e.jsx("button",{onClick:r=>{Xe(s,n,r,i.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"}))},className:"text-token-text-secondary hover:text-token-text-primary transition","data-testid":"copy-saved-gpt-url-button",children:e.jsx(gs,{className:"icon-sm"})})]})})})}const us=le({workspaceDisabledHint:{id:"gizmo.workspaceDisabledHint",defaultMessage:"Your workspace administrator has disabled this setting"}});function Ne({shareLevel:s,workspaceName:t,value:a,disabled:i=!1,tooltipText:n}){const r=l.useId();return e.jsx(nt,{disabled:n==null,label:n,side:"top",children:e.jsxs(Gs,{id:r,value:a,disabled:i,className:"hover:bg-token-main-surface-secondary flex h-14 w-full cursor-pointer flex-row items-center justify-between gap-2 rounded-md px-3 py-4 font-semibold",children:[e.jsx("label",{htmlFor:r,className:"flex cursor-pointer items-center gap-1",children:e.jsx(Ta,{shareLevel:s,workspaceName:t??"",hasInviteSharing:!1})}),e.jsx(Lt,{children:e.jsx(rt,{className:"icon-lg me-1"})})]})})}function Me(s){return!!(s&&typeof s=="object"&&"gizmo"in s)}function Ds(s){window.history.length>1?s(-1):s(zt())}function ri({gizmo:s,publishedGizmo:t,isUpsertLoading:a,isPromoteLoading:i,isUploadingProfilePic:n,isGeneratingProfilePic:r,updateGizmo:d,promoteGizmo:g,appealGizmo:u,setAppealState:v,showActionsModal:o}){const y=lt(),p=s!=null?we(s):[];(s==null||i||a)&&p.push(se.Loading),n&&p.push(se.UploadingProfilePic),r&&p.push(se.GeneratingProfilePic);const c=Ke(s),[M,b]=l.useState(!1),[A,I]=l.useState(!1),T=s.sharingRecipient?ds[s.sharingRecipient]:ds.private,w=i||a;return e.jsxs(e.Fragment,{children:[c?e.jsx(te,{color:"primary",onClick:()=>b("promote"),loading:a,disabled:w||s.id===void 0||p.length>0,tooltip:p.length>0?p.map(ze).join(`
`):void 0,"data-testid":"gizmo-editor-create-gpt-button",children:e.jsx(m,{id:"svUGIb",defaultMessage:"Create"})}):e.jsxs(e.Fragment,{children:[e.jsx(te,{color:"secondary",loading:i||!t,disabled:w,icon:T,onClick:()=>b("share"),children:e.jsx(m,{id:"aXKW4G",defaultMessage:"Share"})}),e.jsx(te,{color:"primary",onClick:async()=>{let k=s.sharing.subjects.map(ka);const x=Et(s.sharing.subjects);k=je(s.sharing.recipient,k,x?.capabilities??ye);const f=t&&Me(t)?t.gizmo.display.categories[0]:void 0;await g({recipient:s.sharing.recipient,subjects:k},f)&&I(!0)},loading:a||!t,disabled:w||p.length>0,tooltip:p.length>0?p.map(ze).join(`
`):void 0,children:e.jsx(m,{id:"84QVoj",defaultMessage:"Update"})})]}),M&&(y?.getWorkspaceId()==null?e.jsx(ti,{gizmo:s,publishedGizmo:t,promoteGizmo:g,appealGizmo:u,setAppealState:v,showActionsModal:o,updateGizmo:d,shareOnly:M==="share",onClose:()=>b(!1)}):e.jsx(Sa,{gizmo:s,publishedGizmo:t,promoteGizmo:g,appealGizmo:u,setAppealState:v,showActionsModal:o,updateGizmo:d,onClose:()=>b(!1),shareOnly:M==="share"})),A&&t&&e.jsx(_a,{publishedGizmo:t,sharing:Me(t)?t.gizmo.sharing:void 0,onClose:()=>I(!1),workspaceName:y?.data.name??""})]})}function oi({gizmoEditorData:s,publishedGizmo:t,revertDraft:a}){const i=H(),n=ie(),r=me(),[d,g]=l.useState(!1),u=He(),{value:v}=de("3645668434"),o=t&&Me(t)?t.gizmo.current_user_permission?.can_delete:!1;return!(t||a||s?.id&&v&&s.liveVersion>0||o||u?.includes("debug"))?null:e.jsxs(e.Fragment,{children:[e.jsxs(fs,{side:"top",contentAlign:"end",sideOffset:8,triggerButton:e.jsx(te,{color:"ghost",icon:Ut}),children:[t!=null&&e.jsxs(ee.Item,{onClick:p=>{Xe(t,n,p)},children:[e.jsx(As,{className:"icon-sm"}),e.jsx(m,{...q.copyLink})]}),a!=null&&e.jsxs(ee.Item,{onClick:()=>{window.confirm(i.formatMessage(q.revertConfirm))&&a()},children:[e.jsx(Ft,{className:"icon-sm"}),e.jsx(m,{id:"W2blnV",defaultMessage:"Revert..."})]}),s?.id!=null&&v&&s.liveVersion>0&&e.jsxs(e.Fragment,{children:[e.jsxs(ee.Item,{onClick:()=>{r(`/g/${s.id}/view`)},children:[e.jsx(Ga,{className:"icon-sm"}),e.jsx(m,{id:"gizmo.versionHistory",defaultMessage:"Version History"})]}),e.jsxs(ee.Item,{onClick:async()=>{const p=await Le.copyGizmo({gizmoId:s.id});p.gizmo.id&&r(`/gpts/editor/${p.gizmo.id}`)},children:[e.jsx(gs,{className:"icon-sm"}),e.jsx(m,{id:"GizmoInformation.copyGizmoLabel",defaultMessage:"Duplicate GPT"})]})]}),t&&Me(t)&&t.gizmo.current_user_permission?.can_delete&&e.jsxs(ee.Item,{color:"danger",onClick:()=>{g(!0)},children:[e.jsx(Ot,{className:"icon-sm"}),e.jsx(m,{id:"tNrOLG",defaultMessage:"Delete GPT"})]})]}),d&&e.jsx(Aa,{gizmoId:s?.id||"",onSuccess:()=>Ds(r),onClose:()=>{g(!1)}})]})}const pe=$e.div`flex items-center gap-1`;function li({gizmoEditorData:s}){const t=be(a=>a.currentWorkspace?.name);switch(s.sharingRecipient){case G.Private:return e.jsxs(pe,{children:[e.jsx(Dt,{className:"icon-xs"}),e.jsx(m,{...q.onlyMe})]});case G.Link:return e.jsxs(pe,{children:[e.jsx(As,{className:"icon-xs"}),e.jsx(m,{...q.anyoneWithLink})]});case G.Workspace:return e.jsxs(pe,{children:[e.jsx(Bt,{className:"icon-xs"}),t]});case G.Marketplace:return e.jsxs(pe,{children:[e.jsx(Wt,{className:"icon-xs"}),e.jsx(m,{...q.public})]});default:return e.jsx("div",{})}}function ci({gizmoEditorData:s}){return e.jsxs("div",{className:"flex items-center gap-2",children:[s.profilePictureUrl!=null?e.jsx(Ws,{isFirstParty:!1,src:s.profilePictureUrl,className:"h-8 w-8"}):e.jsx("div",{className:"border-token-border-medium h-8 w-8 rounded-full border-2 border-dashed"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:s.name||e.jsx(m,{...q.newGPT})}),e.jsx("div",{className:"text-token-text-secondary text-xs",children:Ke(s)?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"bg-token-text-tertiary h-1.5 w-1.5 rounded-full"}),e.jsx(m,{...q.draft})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"bg-brand-green h-1.5 w-1.5 rounded-full"}),s.sharingRecipient===G.Marketplace?e.jsx(m,{...q.published}):e.jsx(m,{id:"gizmoEditorHeader.live",defaultMessage:"Live"}),e.jsx(m,{...q.dotSeparator,tagName:"span"}),e.jsx(li,{gizmoEditorData:s})]})})]})]})}const di=$e.div`
  cursor-pointer
  border-b
  pb-[1px]
  pt-[2px]
  text-sm
  text-token-text-secondary
  hover:border-token-border-xheavy
  hover:text-token-text-primary
  mx-2
`;function ui({gizmoEditorData:s,isUpsertLoading:t,isPromoteLoading:a,isUploadingProfilePic:i,isGeneratingProfilePic:n,publishedGizmo:r,updateGizmo:d,promoteGizmo:g,appealGizmo:u,setAppealState:v,revertDraft:o,draftMessage:y,className:p,hasUnpublishedChanges:c,showActionsModal:M}){const b=me();return e.jsxs("div",{className:oe("border-token-border-medium relative flex h-14 w-full items-center justify-between gap-2 border-b px-3",p),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{className:"text-token-text-primary cursor-pointer",onClick:()=>Ds(b),children:e.jsx(ot,{className:"icon-lg"})}),e.jsx(ci,{gizmoEditorData:s})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[r&&(r?.gizmo?.live_version??0)>1&&e.jsx(di,{onClick:()=>b(`/g/${s.id}/view`),children:e.jsx(m,{id:"P0Ri/k",defaultMessage:"Last edited {date}",values:{date:e.jsx(Tt,{value:r.gizmo.updated_at,day:"numeric",month:"short",year:new Date(r.gizmo.updated_at).getFullYear()===new Date().getFullYear()?void 0:"numeric"})}})}),y,e.jsx(oi,{gizmoEditorData:s,publishedGizmo:r,revertDraft:o}),e.jsx(ri,{gizmo:s,publishedGizmo:r,isUpsertLoading:t,isPromoteLoading:a,isUploadingProfilePic:i,isGeneratingProfilePic:n,updateGizmo:d,promoteGizmo:g,appealGizmo:u,setAppealState:v,hasUnpublishedChanges:c,showActionsModal:M})]})]})}const q=le({onlyMe:{id:"gizmo.onlyMe",defaultMessage:"Only me"},anyoneWithLink:{id:"gizmo.anyoneWithLink",defaultMessage:"Anyone with a link"},public:{id:"gizmo.public",defaultMessage:"Everyone"},newGPT:{id:"gizmo.newGPT",defaultMessage:"New GPT"},draft:{id:"gizmo.draft",defaultMessage:"Draft"},published:{id:"gizmo.published",defaultMessage:"Published"},revertConfirm:{id:"gizmo.revertConfirm",defaultMessage:"Are you sure you want to revert to the last saved version?"},copyLink:{id:"gizmo.copyLink",defaultMessage:"Copy link"},dotSeparator:{id:"gizmo.dotSeparator",defaultMessage:"·"}}),mi=512;function gi(){return e.jsx("div",{className:"border-token-border-medium relative flex h-full w-full items-center justify-center rounded-full border-2 border-dashed",children:e.jsx(qe,{className:"h-1/4 w-1/4"})})}function fi({gizmoEditorData:s,onFileChange:t,generateProfilePic:a,isGeneratingProfilePic:i,setIsGeneratingProfilePic:n}){const r=H(),d=ie(),[g,u]=l.useState(void 0),v=l.useRef(t);l.useEffect(()=>{v.current=t});async function o(c){if(c.length>0){n(!1);const M=await Kt(c[0],mi),b=Ee(M);u({tempId:b,file:M,status:W.Uploading,progress:1,fileId:null,cdnUrl:null}),v.current("uploading"),Xt(b,M,r,d,ps.ProfilePicture,{onFileCreated(A,I,T){u(w=>w!=="initial"&&w?.tempId===A&&w.status===W.Uploading?{...w,progress:10,fileId:I,cdnUrl:T}:w)},onFileUploadProgress(A,I){u(T=>T!=="initial"&&T?.tempId===A&&T.status===W.Uploading?{...T,progress:I}:T)},onFileUploaded(A,I,T){u(w=>w!=="initial"&&w?.tempId===A?(v.current(w),{...w,status:W.Ready,progress:100,fileSpec:{name:w.file.name,id:w.fileId,size:w.file.size,...T??{}}}):w)},onError(A){u(I=>{if(I!=="initial"&&I?.tempId===A){v.current(void 0);return}return I})}})}}const{open:y,getInputProps:p}=Rs({disabled:!1,noClick:!0,onDropAccepted:o,onDropRejected:c=>za(c,r,d,Ht.ProfilePicture),multiple:!0,maxSize:Ls,...zs(Vt)});return e.jsxs("div",{className:"flex w-full items-center justify-center gap-4",children:[e.jsxs(fs,{sideOffset:8,triggerButton:e.jsx("button",{className:"h-20 w-20",children:i?e.jsx(gi,{}):g!=null&&g!="initial"&&g.status!=W.Ready?e.jsxs("div",{className:"relative h-full w-full overflow-hidden rounded-full",children:[e.jsx($t,{file:g.file}),g.status===W.Uploading&&g.progress<90?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/5 text-white",children:e.jsx(qt,{percentage:g.progress,className:"h-6 w-6"})}):null]}):s?.profilePictureUrl!=null&&s?.profilePictureUrl!==""?e.jsx(Ws,{isFirstParty:!1,src:s.profilePictureUrl}):e.jsx("div",{className:"border-token-border-medium flex h-full w-full items-center justify-center rounded-full border-2 border-dashed",children:e.jsx(Qt,{className:"text-4xl"})})}),children:[e.jsx(ee.Item,{onClick:y,children:e.jsx(m,{id:"ERQwXg",defaultMessage:"Upload Photo"})}),e.jsx(ee.Item,{onClick:a,children:e.jsx(m,{id:"NXAog/",defaultMessage:"Use DALL·E"})})]}),e.jsx("input",{...p()})]})}function pi({gizmoEditorData:s,requireGizmoId:t,currentModelConfig:a,updateGizmo:i}){const n=H(),r=ie(),[d,g]=l.useState(0),u=l.useRef(new Map),v=Yt(a,void 0),o=async f=>{hs.logEvent("Upload File",{client:"web",eventSource:"mouse",intent:"gizmo"});const S=await t();f.length>0&&await Promise.all(f.map(N=>{const U=Ee(N);u.current.set(U,{tempId:U,gizmoId:S,file:N,status:W.Uploading,progress:1,fileId:null,cdnUrl:null}),Zt(Ee(N),N,n,r,{kind:ps.Gizmo,gizmoId:S},{onFileUploaded:(C,L,B,F)=>{const z=u.current.get(C);z==null||z.fileId==null||(i(V=>({...V,files:[...V.files??[],{file_id:z.fileId,name:z.file.name,size:z.file.size,type:F?.mimeType??ks(N),last_modified:z.file.lastModified,file_size_tokens:F?.fileTokenSize}]})),u.current.delete(C),g(V=>V+1))},onFileCreated:(C,L,B)=>{u.current.set(C,{tempId:C,gizmoId:S,file:N,status:W.Uploading,progress:1,...u.current.get(C),fileId:L,cdnUrl:B}),g(F=>F+1)},onFileUploadProgress:(C,L)=>{const B=u.current.get(C);B?.status===W.Uploading&&u.current.set(C,{...B,progress:L}),g(F=>F+1)},onError:C=>{u.current.delete(C)}},{usesRetrievalIndex:a!=null&&_e(a,N.type,N.name)===Se.Retrieval})}))},{getInputProps:y,open:p}=Rs({disabled:!1,noClick:!0,onDropAccepted:o,multiple:!0,maxSize:Ls,maxFiles:10,...zs(v)}),c=s?.files??[];function M(f){return e.jsx(as,{onRemoveFileClick:()=>{u.current.delete(f.tempId),g(S=>S+1)},file:f.file,loadingPercentage:f.status===W.Uploading?f.progress:void 0},f.tempId)}function b(f){return e.jsx(as,{file:f.name,fileId:f.file_id,onRemoveFileClick:()=>i(S=>({...S,files:S?.files?.filter(N=>N.file_id!==f.file_id)})),gizmoId:s?.id},f.file_id)}const A=Array.from(u.current.values()).filter(f=>c.every(S=>S.file_id!==f.fileId)),[I,T]=ts(A,f=>a!=null&&_e(a,f.file.type,f.file.name)===Se.CodeInterpreter),[w,k]=ts(c,f=>a!=null&&f.type!=null&&_e(a,f.type,f.name)===Se.CodeInterpreter),x=l.useRef(w.length);return l.useEffect(()=>{w.length>x.current&&i(f=>f.tools?.some(S=>S.type===O.PYTHON)?f:{...f,tools:[...f.tools??[],{type:O.PYTHON}]}),x.current=w.length},[w.length]),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"text-token-text-tertiary rounded-lg text-xs",children:e.jsx(m,{...hi.knowledgeWarning})}),T.length>0||k.length>0?e.jsxs("div",{className:"flex flex-wrap gap-2",children:[T.map(M),k.map(b)]}):null,I.length>0||w.length>0?e.jsxs("div",{children:[e.jsx("div",{className:"text-token-text-tertiary mb-2 text-xs",children:e.jsx(m,{id:"i/QurZ",defaultMessage:"The following files are only available for Code Interpreter:"})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[I.map(M),w.map(b)]})]}):null,e.jsx("div",{children:e.jsxs(te,{onClick:p,children:[e.jsx("input",{...y()}),e.jsx(m,{id:"sr8Qp/",defaultMessage:"Upload files"})]})})]})}const hi=le({knowledgeWarning:{id:"gizmo.knowledgeWarning",defaultMessage:"Conversations with your GPT can potentially reveal part or all of the files uploaded."}});function xi({placeholder:s,text:t,onChange:a,onClose:i}){return e.jsxs(Ve,{testId:"modal-gizmo-editor-form",className:"max-h-[100vh]! max-w-[80vw]!",type:"success",isOpen:!0,onClose:i,primaryButton:e.jsx(te,{onClick:i,children:e.jsx(m,{id:"FeFVdS",defaultMessage:"Close"})}),children:[e.jsx("textarea",{className:"bg-token-main-surface-primary h-[70vh] w-full resize-none rounded-lg dark:border-gray-700",value:t,onChange:n=>{a(n.target.value)},placeholder:s}),e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(m,{...Es.instructionsWarning})})]})}const Ce=$e.div`text-sm text-red-500`;function vi({children:s,collapsed:t,initial:a}){return e.jsx(kt,{initial:a,children:!t&&e.jsx(Ps.div,{initial:"collapsed",animate:"open",exit:"collapsed",variants:{open:{opacity:1,height:"auto"},collapsed:{opacity:0,height:0}},children:s})})}function ji({gizmo:s,onShowActionsEditor:t,isDisabled:a}){const i=H(),n=ie(),r=e.jsxs("div",{className:"space-y-1",children:[s?.tools?.map((d,g)=>d.type!==O.JIT_PLUGIN?null:e.jsxs("div",{children:[e.jsx(Ua,{isDisabled:a,actionTool:d,onShowActionsEditor:()=>t(d.metadata.domain)}),d.metadata.auth?.type==="oauth"&&e.jsx(na,{label:i.formatMessage(R.callbackUrlLabel),value:`https://chat.openai.com/aip/${d.metadata.action_id}/oauth/callback`,onCopied:()=>{n.success("Copied to clipboard",{duration:3})}})]},g)),(s?.tools?.filter(d=>d.type===O.JIT_PLUGIN)??[]).length>=is?e.jsx("div",{children:i.formatMessage(R.maxActionsReached,{number:is})}):e.jsx(te,{disabled:a,onClick:()=>{t("Unknown domain")},className:"mt-2",children:e.jsx(m,{...R.createActionLabel})})]});return a?e.jsx(xs,{side:"top",label:i.formatMessage(R.disabledCustomActionsTooltip),children:r}):r}function yi(s){return(s.files?.length??0)>0||s?.tools?.some(t=>t.type===O.JIT_PLUGIN)}function bi({gizmoEditorData:s,updateGizmo:t,currentModelConfig:a,generateProfilePic:i,setIsUploadingProfilePic:n,isGeneratingProfilePic:r,setIsGeneratingProfilePic:d,requireGizmoId:g,onShowActionsEditor:u}){const v=s?.tools??[],[o,y]=l.useState(!1),[p,c]=l.useState(!0),M=s?.promptStarters??[],b=[...M,...M.length<Jt?[""]:[]],A=we(s),T=Qe()?.isWorkspaceAccount(),w=Us(xe.WorkspaceGPTCustomActions),k=H();return e.jsxs("div",{className:"flex h-full grow flex-col overflow-y-auto px-2 pt-6 text-sm",children:[e.jsxs("div",{className:"grow",children:[e.jsxs(X,{children:[e.jsx(fi,{gizmoEditorData:s,generateProfilePic:i,isGeneratingProfilePic:r,setIsGeneratingProfilePic:d,onFileChange:async x=>{if(x!=null&&x!=="uploading"&&x.fileId!=null){const f=await Oe.getFileDownloadLink(x.fileId);f.status===We.Success&&t({profilePictureId:x.fileId!=null?x.fileId:void 0,profilePictureUrl:f.download_url})}else t({profilePictureId:void 0,profilePictureUrl:void 0});n(x==="uploading")}}),e.jsx(Y,{label:e.jsx(m,{id:"M4dZms",defaultMessage:"Name"}),description:e.jsx(m,{id:"+Gkni2",defaultMessage:"The name of your GPT"})}),e.jsx(Ie,{type:"text",placeholder:k.formatMessage(R.gptNamePlaceholder),value:s?.name??"",onChange:x=>{t({name:x.target.value})},onBlurCapture:()=>t(x=>({...x,name:x.name.trim()})),"data-testid":"gizmo-name-input"}),A.includes(se.GizmoNameTooLong)?e.jsx(Ce,{className:"mt-1",children:e.jsx(m,{...R.nameTooLong,values:{length:ea}})}):null]}),e.jsxs(X,{className:"mt-4",children:[e.jsx(Y,{label:e.jsx(m,{id:"YDzNvf",defaultMessage:"Description"}),description:e.jsx(m,{id:"dpxCw8",defaultMessage:"Short description of what this GPT does"})}),e.jsx(Ie,{type:"text",placeholder:k.formatMessage(R.descriptionPlaceholder),value:s?.description??"",onChange:x=>t({description:x.target.value}),onBlurCapture:()=>t(x=>({...x,description:x.description?.trim()??""})),"data-testid":"gizmo-description-input"}),A.includes(se.GizmoDescriptionTooLong)?e.jsx(Ce,{className:"mt-1",children:e.jsx(m,{...R.descriptionTooLong,values:{length:sa}})}):null]}),e.jsxs(X,{children:[e.jsx(Y,{label:e.jsx(m,{id:"2SO0RJ",defaultMessage:"Instructions"}),description:k.formatMessage(R.instructionsSubtitle)}),e.jsxs("div",{className:"relative",children:[e.jsx(Ea,{className:"resize-none",rows:8,value:s?.instructions,onChange:x=>t({instructions:x.target.value}),onBlurCapture:()=>t(x=>({...x,instructions:x.instructions.trim()})),placeholder:k.formatMessage(R.instructionsSubtitle),"data-testid":"gizmo-instructions-input"}),e.jsx("button",{className:"text-token-text-tertiary absolute end-2 bottom-3",onClick:()=>y(!0),children:e.jsx(La,{className:"icon-sm"})})]}),e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(m,{...Es.instructionsWarning})}),A.includes(se.GizmoInstructionsTooLong)?e.jsx(Ce,{className:"mt-1",children:e.jsx(m,{...R.instructionsTooLong,values:{length:ta}})}):null]}),e.jsxs(X,{children:[e.jsx(Y,{label:e.jsx(m,{id:"6rfYOX",defaultMessage:"Conversation starters"}),description:e.jsx(m,{id:"OSOIpd",defaultMessage:"Examples for the user to start the conversation"})}),e.jsx("div",{className:"flex flex-col gap-1",children:b.map((x,f)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ie,{className:"rounded-e-none",value:x,type:"text",maxLength:aa,onChange:S=>{const N=S.target.value;t(U=>({...U,promptStarters:Be(f>=(M.length??0)?[...M??[],N]:M.map((C,L)=>L===f?N===""?void 0:N:C))}))}}),e.jsx("button",{className:"border-token-border-medium flex h-9 w-9 items-center justify-center rounded-lg rounded-s-none border border-s-0",onClick:()=>t(S=>({...S,promptStarters:M.filter((N,U)=>U!==f)})),children:e.jsx(ct,{className:"icon-sm"})})]},f))})]}),e.jsxs(X,{children:[e.jsx(Y,{label:e.jsx(m,{id:"bwXSkU",defaultMessage:"Knowledge"}),description:k.formatMessage(R.knowledgeExplanation)}),e.jsx(pi,{gizmoEditorData:s,requireGizmoId:g,currentModelConfig:a,updateGizmo:t})]}),e.jsxs(X,{children:[e.jsx(Y,{label:e.jsx(m,{id:"mcAwDU",defaultMessage:"Capabilities"}),description:e.jsx(m,{id:"2exQT6",defaultMessage:"Functionality this GPT can use"})}),e.jsx(Fa,{enabledTools:v,onEnabledToolsChange:x=>t({tools:x})})]}),e.jsxs(X,{children:[e.jsx(Y,{label:e.jsx(m,{id:"7r7v+u",defaultMessage:"Actions"}),description:e.jsx(m,{id:"fBln7I",defaultMessage:"APIs this GPT can use"})}),e.jsx(ji,{isDisabled:!!(T&&!w),gizmo:s,onShowActionsEditor:u})]}),!T&&yi(s)&&e.jsxs(X,{children:[e.jsx(Y,{label:e.jsx(m,{id:"R3KeU7",defaultMessage:"Additional Settings"}),collapsed:!!p,onClick:()=>{c(x=>!x)}}),e.jsx(vi,{collapsed:p,initial:!1,children:e.jsx(ia,{className:"mx-3 my-1",labelClassName:"w-full cursor-pointer",label:e.jsx(m,{id:"tZgwFW",defaultMessage:"Use conversation data in your GPT to improve our models"}),id:"improve-chatgpt",checked:!s.trainingDisabled,onChange:()=>{t({trainingDisabled:!s.trainingDisabled})}})})]})]}),o&&e.jsx(xi,{text:s.instructions??"",onChange:x=>{t({instructions:x})},onClose:()=>y(!1),placeholder:k.formatMessage(R.instructionsSubtitle)})]})}const R=le({nameTooLong:{id:"gizmo.nameTooLong",defaultMessage:"GPT names cannot be longer than {length} characters."},knowledgeExplanation:{id:"gizmo.knowledgeExplanation",defaultMessage:"Additional files for this GPT to reference."},descriptionTooLong:{id:"gizmo.descriptionTooLong",defaultMessage:"GPT descriptions cannot be longer than {length} characters."},instructionsTooLong:{id:"gizmo.instructionsTooLong",defaultMessage:"GPT instructions cannot be longer than {length} characters."},disabledCustomActionsTooltip:{id:"gizmo.disabledCustomActionsTooltip",defaultMessage:"Custom actions are disabled for your workspace. Contact your admin to enable them."},createActionLabel:{id:"gizmo.createActionLabel",defaultMessage:"Create new action"},maxActionsReached:{id:"gizmo.maxActionsReached",defaultMessage:"GPTs can have a maximum of {number} actions"},descriptionPlaceholder:{id:"gizmo.descriptionPlaceholder",defaultMessage:"Add a short description about what this GPT does"},instructionsSubtitle:{id:"gizmo.instructionsSubtitle",defaultMessage:"What does this GPT do? How does it behave? What should it avoid doing?"},gptNamePlaceholder:{id:"gizmo.gptNamePlaceholder",defaultMessage:"Name your GPT"},callbackUrlLabel:{id:"gizmo.callbackUrlLabel",defaultMessage:"Callback URL"}});function Mi(s,t){const a=vs(s);if(!Array.isArray(s.detail))return a;const i=Be(s.detail.map(n=>{if(n.type==="value_error.any_str.max_length")switch(n.loc[1]){case"display":{switch(n.loc[2]){case"name":return t.formatMessage(R.nameTooLong,{length:n.ctx.limit_value});case"description":return t.formatMessage(R.descriptionTooLong,{length:n.ctx.limit_value})}break}case"instructions":return t.formatMessage(R.instructionsTooLong,{length:n.ctx.limit_value})}if(typeof n.msg=="string")return n.msg}));return i.length>0?i.join(`
`):a}function wi({upsertDraftError:s}){const t=H(),a=Mi(s,t);return e.jsxs("div",{className:"flex items-center gap-2 text-red-500",children:[e.jsx("div",{children:e.jsx(m,{...Hs.errorSavingDraft})}),a!=null&&e.jsx(xs,{label:a,children:e.jsx(ra,{className:"icon-sm"})})]})}function Pi({isPublished:s,isSavingDraft:t,hasUnpublishedChanges:a,upsertDraftError:i,className:n}){return i instanceof dt?e.jsx(wi,{upsertDraftError:i}):a?e.jsxs("div",{className:oe("flex items-center gap-2",n),children:[e.jsx("span",{className:"text-token-text-secondary",children:s?e.jsx(m,{id:"gizmoEditor.draftUnpublished",defaultMessage:"Unpublished changes"}):e.jsx(m,{id:"gizmoEditor.draftPending",defaultMessage:"Updates pending"})}),e.jsx("div",{className:"text-token-text-tertiary w-4",children:t&&e.jsx(qe,{})})]}):null}const Hs=le({errorSavingDraft:{id:"gizmo.errorSavingDraft",defaultMessage:"Error saving draft"}}),Ti=js(()=>ys(()=>import("./cgy1a4ln2o7x1ucq.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31])).then(s=>s.CanvasFocusedViewManager));var ki=(s=>(s.TestGizmoAction="test_gizmo_action",s))(ki||{});const Si=new ut;function _i({gizmoEditorData:s,isSavingDraft:t,showTitle:a=!0}){const[i,n]=l.useState(()=>ve());Is(i,{kind:ae.GizmoTest,gizmo_id:s.id}),l.useEffect(()=>{De(i,c=>{c.mode={kind:ae.GizmoTest,gizmo_id:s.id}})},[i,s.id]);const r=s.files?.map(c=>c.file_id).join();l.useEffect(()=>{mt(i)!=null&&n(ve())},[s.id,s.instructions,s.tools,r,i]);const d=l.useMemo(()=>({gizmoEditorData:s,mode:"test"}),[s]),[g,u]=l.useState(0),v=()=>{u(c=>c-360)},o=s.id,y=Ii(i);l.useEffect(()=>bs(Si,{test_gizmo_action:({rootDomain:c,operationName:M})=>{o&&y(o,c,M)}}),[y,o]);const p=l.useCallback(()=>e.jsx("div",{className:"h-full w-full",children:e.jsx(Wa,{gizmo:s,hideOwner:!0,showStarterPrompts:!0})}),[s]);return e.jsx(_s.Provider,{value:d,children:e.jsx(oa,{clientThreadId:i,children:e.jsx("div",{className:oe("flex h-full w-full",t&&"cursor-wait opacity-80 transition"),children:e.jsxs("div",{className:"flex grow flex-col",children:[e.jsx("div",{className:"relative mb-2 shrink-0",children:e.jsx("div",{className:"flex justify-center py-1",children:a&&e.jsxs("div",{className:"group flex items-center gap-2 text-lg font-semibold",children:[e.jsx("div",{className:"icon-md"}),e.jsxs("button",{onClick:()=>{v(),n(ve())},className:"flex items-center gap-2",children:[e.jsx(m,{id:"2u/6Ja",defaultMessage:"Preview"}),e.jsx(Ps.div,{className:"text-token-text-primary",animate:{rotate:g},transition:{duration:.3},children:e.jsx(la,{className:"icon-md invisible group-hover:visible"})})]})]})})}),e.jsxs("div",{className:oe("relative grow overflow-auto px-2",t&&"pointer-events-none"),children:[e.jsx(Os,{clientThreadId:i,hideHeader:!0,renderEmptyState:p()}),e.jsx(Oa.Sidebars,{children:e.jsx(Ti,{clientThreadId:i,overrideWidth:0,isAutoFocusDisabled:!0})})]})]})})})})}const ms=Ms.memo(_i);function Ii(s){const t=Ts(s);return l.useCallback((i,n,r)=>{t({eventSource:"url",promptMessage:gt(`Call the ${n} API with the ${r} operation`,{jit_plugin_data:{from_client:{type:"test",operation:r,tool_name:ca(n)}}}),completionMetadata:{conversationMode:{kind:ae.GizmoTest,gizmo_id:i}}})},[t])}const Ni=js(()=>ys(()=>import("./n5c76wr6kp07hxp3.js"),__vite__mapDeps([32,1,3,4,33,2,5,34,35,36,37,38,39,40,27,41,42,28,17,26,29,43,44,45,9,46,47,8,21,48,23,49,50,51,52,53,54])).then(s=>s.GizmoActionsEditor));var Vs=(s=>(s.MAGIC_MAKER="magic",s.ADVANCED="advanced",s.PREVIEW="preview",s))(Vs||{});function Ge({value:s,label:t,testId:a}){return e.jsx(Gs,{value:s,className:"text-md border-token-border-default text-token-text-tertiary hover:text-token-text-primary radix-state-checked:border radix-state-checked:bg-token-main-surface-primary radix-state-checked:text-token-text-primary radix-state-checked:shadow-[0_0_2px_rgba(0,0,0,.03)] w-1/3 grow rounded-lg p-1.5 font-semibold transition md:w-1/2","data-testid":a,children:t})}function Ci({className:s,editorTab:t,setEditorTab:a}){const i=H(),{value:n}=de("1393076427");return e.jsxs(Cs,{className:oe("bg-token-main-surface-secondary flex w-full overflow-hidden rounded-xl p-1.5 md:w-1/2",s),value:t,onValueChange:r=>{a(r)},children:[n&&e.jsx(Ge,{value:"magic",label:i.formatMessage(Ae.magicMakerLabel)}),e.jsx(Ge,{value:"advanced",label:i.formatMessage(Ae.configureLabel),testId:"gizmo-editor-configure-button"}),e.jsx("div",{className:"flex w-1/3 md:hidden",children:e.jsx(Ge,{value:"preview",label:i.formatMessage(Ae.previewLabel)})})]})}function Gi(s,t){return s.length!==t.length?!1:s.every(a=>t.some(i=>i.type===a.type))}function Ai(s,t){return s.name===t.gizmo.display.name&&s.description===t.gizmo.display.description&&s.instructions===t.gizmo.instructions&&Gi(s.tools,t.tools)&&Fe(s.files?.map(a=>a.file_id)??[],t.files?.map(a=>a.file_id)??[])&&s.profilePictureUrl==t.gizmo.display.profile_picture_url&&s.profilePictureId==t.gizmo.display.profile_pic_id}const $s=({gizmo:s,onNewGizmoId:t})=>{const a=ws(),i=He(),n=Us(xe.BrowsingAvailable),r=i?.includes(xe.GizmoCanvasToggle)&&i?.includes(xe.Canvas),{value:d}=de("4148168517"),g=H(),u=ie(),v=()=>{const h=[];n&&h.push({type:O.BROWSER}),r&&h.push({type:O.CANVAS});const P={...ls,tools:[...ls.tools,...h]};return d?{...P,tools:[...P.tools.filter(_=>_.type!==O.DALLE),{type:O.IMAGE_GEN}]}:P},o=l.useRef(s!=null?rs(s):v()),y=l.useRef(s),p=l.useRef(o.current),[c,M]=l.useState(()=>o.current),[b,A]=l.useState(()=>ve()),[I]=l.useState(()=>({context_message:$a(o.current),model_slug:"unused",enabled_tools:[{tool_id:s!=null?"gizmo_editor":"gizmo_creator"}]}));Ja(b,p.current,I);const{data:T}=ft(),w=T?.models.get(pt)??(T&&Ca(T.models.values(),h=>h.tags.includes(ht.GPT_4o))),{data:k}=pa(o.current.id),x=ha(),{isPending:f,error:S}=x,N=xa(),U=l.useMemo(()=>k!=null&&!Ai(c,k),[c,k]),C=async()=>{const h=o.current;try{const P=await x.mutateAsync({editorData:h,gizmoId:h.id});if(y.current=P,o.current.id==null){const _=P.gizmo.id;o.current={...o.current,id:_,sharingTargets:P.gizmo.sharing_targets},M(o.current),t?.(_)}for(const _ of P.tools.filter(D=>D.type===O.JIT_PLUGIN)){const D=o.current.tools.find(Z=>Z.type===O.JIT_PLUGIN&&Z.metadata.domain===_.metadata.domain);D&&D.metadata.action_id!==_.metadata.action_id&&(D.metadata={...D.metadata,action_id:_.metadata.action_id},M(o.current))}return P}catch(P){const _=vs(P)??g.formatMessage(Hs.errorSavingDraft);throw u.warning(_,{duration:2}),P}},L=l.useRef(void 0),B=async()=>o.current.id!=null?o.current.id:(L.current==null&&(L.current=C().then(h=>h.gizmo.id).catch(h=>{throw L.current=void 0,h})),L.current),[F]=l.useState(()=>va(()=>C(),2e3,{trailing:!0})),z=l.useCallback((h,P=!0)=>{const _=typeof h=="function"?h(o.current):ja(o.current,h);Fe(_,o.current)||(o.current=_,M(o.current),P&&F())},[F]),V=l.useRef(void 0);l.useEffect(()=>bs(xt,{completionFinished:async h=>{const P=h.serverThreadId;if(P==null){fe(!1);return}try{const _=await Va(o.current,P,u,V.current);_!=null&&(z(_),p.current=Ss(o.current))}catch(_){Re.addError(_),u.warning("Something went wrong generating your GPT",{duration:3})}finally{V.current=re.getCurrentNode(ue(P)).message.id,fe(!1)}}}),[u,z]);const ge=Xa(b,I),[Q,$]=l.useState(void 0);l.useEffect(()=>{$(Ia(s))},[s?.gizmo.id]);const j=async(h,P)=>{const _=we(o.current,h.recipient,P);if(_.length>0){u.warning(`Could not save GPT:

${_.map(J=>`- ${ze(J)}`).join(`
`)}`,{duration:3});return}const D=await C(),Z=D.gizmo.id;try{return hs.logEvent("Promote Gizmo",{gizmo_id:D.gizmo.id,sharing_recipient:h.recipient,editor_tab:K}),await N.mutateAsync({gizmoId:D.gizmo.id,data:{sharingSubjects:h.subjects,sharingRecipient:h.recipient,categories:P==null?void 0:[P]}},{onSuccess(ke){a.setQueryData(os(a,Z).queryKey,ke),a.invalidateQueries({queryKey:["gizmos"]}),a.invalidateQueries({queryKey:["gizmo",{gizmoId:Z}]}),a.invalidateQueries({queryKey:["gizmo","userActionSettings",{gizmoId:Z}]})}})}catch(J){if(J instanceof ya)$({gizmoId:Z,sharingRecipient:h.recipient,moderationType:Fs.PublishBlocked,sharingTargets:J.response?.sharing_targets,showModal:ce.AppealAvailable});else{Re.addError(J);const ke=J.detail??"An unknown error occurred";u.warning("Error saving GPT - "+ke,{duration:6})}}},{value:E}=de("1393076427"),[K,Ye]=l.useState(()=>{if(!E)return"advanced";const h=es.getItem(ss.GizmoEditorTab);return Object.values(Vs).includes(h)?h:"magic"}),Pe=vt.useState(({windowWidth:h})=>h);l.useEffect(()=>{Pe!=null&&Pe>=768&&K==="preview"&&Ye("magic")},[Pe,K]);const[qs,Qs]=l.useState(!1),[Ze,fe]=l.useState(!1),[Je,Te]=l.useState(void 0);return e.jsxs("div",{className:"flex h-screen w-full flex-col items-center",children:[e.jsx(ui,{gizmoEditorData:c,isUpsertLoading:x.isPending,isPromoteLoading:N.isPending,hasUnpublishedChanges:U,isUploadingProfilePic:qs,isGeneratingProfilePic:Ze,publishedGizmo:k,updateGizmo:z,promoteGizmo:async(h,P)=>{const _=await j(h,P);return o.current={...o.current,sharingRecipient:h.recipient},M(o.current),es.setItem(ss.GizmoEditorTab,K),_},appealGizmo:async(h,P)=>{Q!=null&&$({...Q,sharingRecipient:h,categories:P==null?void 0:[P],showModal:ce.AppealAvailable})},setAppealState:$,revertDraft:k!=null&&U?()=>{const h=a.getQueryData(os(a,o.current.id).queryKey);if(h!=null){const P=rs(h);o.current=P,M(P),C()}}:void 0,draftMessage:e.jsx(Pi,{isPublished:k!=null&&(k.gizmo.share_recipient==="marketplace"||k.gizmo.share_recipient==="workspace"),hasUnpublishedChanges:U,isSavingDraft:f,upsertDraftError:S,className:"text-sm"}),showActionsModal:h=>{Te(h)},className:"shrink-0"}),Q&&e.jsx(Na,{appealState:Q,onAppealClose:()=>$({...Q,showModal:ce.None}),onAppealSubmitted:()=>$({...Q,showModal:ce.AppealSent})}),e.jsxs("div",{className:"relative flex w-full grow overflow-hidden",children:[e.jsx("div",{className:"flex w-full justify-center md:w-1/2",children:e.jsx("div",{className:"h-full grow overflow-hidden",children:Je!==void 0?e.jsx(Ni,{currentlyEditingActionDomain:Je,gizmoEditorData:c,updateGizmo:z,onClose:()=>{Te(void 0)}}):e.jsxs("div",{className:"flex h-full flex-col px-2 pt-2",children:[e.jsx("div",{className:"flex w-full flex-row justify-center",children:e.jsx(Ci,{editorTab:K,setEditorTab:Ye,className:"mb-2 shrink-0 self-center"})}),e.jsx("div",{className:"grow overflow-hidden",children:K==="magic"?e.jsx("div",{className:"h-full w-full",children:e.jsx(si,{gizmoEditorData:c,updateGizmo:z,clientThreadId:b,gizmoEditorDataRef:o,magicMakerBehaviorOverrides:I,magicMakerConversationGizmoEditorDataRef:p,requireGizmoId:B},b)}):K==="advanced"?e.jsx(bi,{gizmoEditorData:c,updateGizmo:z,currentModelConfig:w,generateProfilePic:h=>{fe(!0),ge(h,o,p,Ya)},setIsUploadingProfilePic:Qs,isGeneratingProfilePic:Ze,setIsGeneratingProfilePic:fe,requireGizmoId:B,onShowActionsEditor:h=>{Te(h)}}):e.jsx(ms,{gizmoEditorData:c,isSavingDraft:f,showTitle:!1})})]})})}),e.jsx("div",{className:oe("border-token-border-medium bg-token-main-surface-secondary hidden w-1/2 justify-center border-s pt-4",K!=="preview"&&"md:flex"),children:e.jsx("div",{className:"grow",children:e.jsx(ms,{gizmoEditorData:c,isSavingDraft:f})})})]})]})};function Ri({gizmoId:s,version:t}){const{data:a}=ma({gizmoId:s,draft:!0,version:t}),i=be(Ns.accountUserId),r=ga()?.id,d=a!=null&&i!=null&&r!=null&&fa(a);return a==null||!d?null:e.jsx($s,{gizmo:a})}function Li({onNewGizmoId:s}){return e.jsx($s,{onNewGizmoId:s})}const zi=({gizmoId:s,remixSourceId:t,version:a})=>{const i=me(),n=Qe(),r=l.useRef(void 0);l.useEffect(()=>(ns.enterGizmoEditor(),()=>{ns.exitGizmoEditor()}),[]);let d=s;return s!=null&&r.current===s&&(d=void 0),da({resetThreadAction:()=>{i("/")}}),n?d!==void 0?e.jsx(Ri,{gizmoId:d,version:a},d):e.jsx(Li,{remixSourceId:t,onNewGizmoId:g=>{r.current=g,window.history.replaceState(window.history.state,"",ua(g))}}):e.jsx("div",{className:"flex min-h-screen items-center justify-center",children:e.jsx(qe,{})})},Ae=le({magicMakerLabel:{id:"gizmo.magicMakerLabel",defaultMessage:"Create"},configureLabel:{id:"gizmo.advancedLabel",defaultMessage:"Configure"},previewLabel:{id:"gizmo.previewLabel",defaultMessage:"Preview"}});function Ei(s){const t=me();l.useEffect(()=>{s||t(jt(yt.NO_ACCESS))},[s,t])}const sn=()=>(ba(),null),tn=bt(function(){const t=Qe(),a=!!t?.hasPlusFeatures();Ei(t==null||a);const i=St(),[n]=_t(),r=me(),d=i.slug,g=n.get("version"),u=d?Mt(d):void 0,v=n.get("remixFrom");return l.useEffect(()=>{wt(!0).then(o=>{Ma.initializeAndGatherData(o),Pt.initializeAndGatherData(o)})},[]),l.useEffect(()=>{t!=null&&!a&&r("/")},[t,r,a]),l.useEffect(()=>{u&&cs(u)&&r(`/g/${d}/project`)},[u,r,d]),!a||u&&cs(u)?null:e.jsx(wa,{children:e.jsx(zi,{gizmoId:u,remixSourceId:v??void 0,version:g!=null?Number(g):void 0})})});export{Si as G,ki as a,sn as c,tn as g};
//# sourceMappingURL=k3hpt23ylv5xtt34.js.map
