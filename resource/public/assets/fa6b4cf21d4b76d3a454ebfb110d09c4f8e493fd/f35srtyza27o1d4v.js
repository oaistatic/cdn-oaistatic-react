const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ctutgkmdnr0gjcbs.js","assets/ls1hkjm4csy89kc5.js","assets/hj6jep7mk4776vwc.js","assets/jfjoua4700kji9z3.js","assets/root-g83krhyb.css","assets/conversation-small-hvit8l60.css","assets/c81yh7ki1xnazhuz.js","assets/ooz34ip0v5zjt48o.js","assets/dbytrd0cso3hgqr4.js","assets/exdc9xpq8ubwzri2.js","assets/jl416oerpm5p44nd.js","assets/c166njesc8ruqs2t.js","assets/b8nw7o07u9fxmapm.js","assets/ltik0hzezyevzkdj.js","assets/c5hp2e6cf62lum4k.js","assets/oe4qwwp6lvtt8c1x.js"])))=>i.map(i=>d[i]);
import{f as qt,r as f,e as K,j as e,M as F,d as Te,L as pl,ai as Ma,a9 as be,a8 as $,k as Pa,i as fl,at as gl,C as hl}from"./ls1hkjm4csy89kc5.js";import{b as ht,P as Bs,s as xl,f as bl,g as vs,h as vl,u as Sl}from"./jl416oerpm5p44nd.js";import{aF as je,a6 as ce,se as yl,sf as Ra,mW as Is,my as D,W as Ss,l$ as Et,mD as ve,o as wn,iL as Ds,cZ as jn,af as Nt,nd as Ea,qK as _n,sg as Ta,b9 as Je,fN as Cl,cB as kl,I as Ls,e7 as Na,h6 as wl,ev as jl,fM as _l,sh as Al,f7 as ft,aX as ws,e0 as Yt,dZ as Fs,d_ as Kt,d$ as Qt,si as Ml,sj as Pl,sk as dt,sl as Rl,sm as Bt,o1 as Qe,mC as Jt,eS as An,sn as El,so as Tl,sp as Nl,sq as Bl,sr as Il,ss as Dl,h9 as Xt,ce as Zt,G as Mn,st as Ll,su as js,om as Fl,n5 as Ol,a7 as Pn,L as Hl,sv as Ba,ov as Ia,sw as Ul,sx as Gl,sy as zl,sz as pe,a4 as Wl,sA as Fe,sB as Da,sC as La,cM as It,sD as Fa,nN as Ze,sE as Vl,sF as ue,sG as gt,sH as $l,sI as ql,sJ as Yl,sK as Kl,sL as Ql,sM as Jl,sN as Xl,hJ as Oa,sO as Zl,sP as ec,sQ as tc,cN as mt,sR as Ha,ot as Os,sS as Cs,sT as sc,sU as xe,sV as nc,sW as oc,sX as ac,sY as ic,sZ as pt,s_ as lt,s$ as Ua,t0 as rc,i3 as lc,m1 as cc,t1 as uc,mH as pn,t2 as oe,f6 as dc,cd as mc,t3 as pc,t4 as fc,t5 as gc,t6 as hc,t7 as xc,t8 as bc,is as cn,t9 as Ko,ta as vc,tb as Sc,tc as yc,lP as Cc,lS as kc,iv as wc,B as Ga,el as jc,td as _c,te as Ac,tf as Mc,mB as _e,tg as Pc,nJ as $t,jo as Rc,th as Ec,ti as T,tj as za,tk as Tc,tl as Nc,tm as Bc,tn as Ic,to as Dc,tp as Lc,tq as Fc,tr as Oc,ts as Hc,tt as Uc,tu as Gc,tv as zc,tw as Wc,tx as Vc,ty as $c,tz as qc,tA as Yc,tB as Kc,tC as Qc,tD as Jc,tE as Xc,tF as Zc,tG as eu,bk as tu,tH as su,g7 as nu,tI as ou,tJ as au,tK as iu,tL as ru,tM as lu,tN as cu,tO as uu,tP as du,tQ as mu,tR as pu,tS as fu,tT as gu,tU as hu,tV as xu,tW as bu,tX as vu,tY as Su,tZ as yu,t_ as Cu,t$ as ku,u0 as wu,u1 as ju,u2 as _u,aO as Au,d as _s,u3 as Mu,u4 as Wa,oV as Pu,k9 as Qo,u5 as As,cj as ct,mc as fn,u6 as Rn,u7 as En,da as Tn,cf as Nn,cg as Bn,dq as In,k8 as Dn,dn as Ln,dp as Fn,kb as Ru,u8 as Eu,cc as On,o0 as Va,ch as ks,ci as Tu,gU as Nu,oz as $a,u9 as Bu,ua as Iu,ub as Du,hh as qa,uc as Ms,f$ as Lu,ud as Ya,ue as Ka,uf as Qa,ug as Ja,uh as zt,ui as Fu,mi as Ps,uj as Xa,uk as Ou,ul as Hu,um as Uu,un as Gu,uo as zu,up as Wu,cb as Hn,ed as Un,fW as Za,ou as Rs,uq as Vu,ur as $u,us as qu,aZ as Yu,ut as Gn,bP as Ku,f3 as Qu,go as Ju,uu as ei,uv as Xu,uw as Zu,ux as Jo,f8 as ed,bN as ti,gQ as td,uy as sd,uz as nd,uA as Xo,uB as od,uC as ad,uD as id,uE as rd,eQ as si,aL as ld,uF as cd,nD as ud,eP as dd,uG as Hs,eR as ni,uH as oi,eT as ai,uI as ii,eU as ri,lV as gn,uJ as md,e8 as pd,uK as fd,kB as li,uL as gd,uM as hd,uN as xd,uO as bd,kC as vd,kD as Sd,uP as yd,uQ as ci,uR as Cd,op as ui,uS as kd,dT as wd,uT as jd,uU as _d,o7 as Ad,uV as Zo,uW as Md,uX as di,uY as Pd,uZ as Rd,ae as mi,u_ as pi,u$ as fi,v0 as hn,v1 as Ed,v2 as Td,dc as ea,bm as Nd,eC as Bd,eE as Id,mE as Dd,c3 as Ld,v3 as Fd,no as Od,v4 as Hd,v5 as Ud,v6 as Gd,v7 as zd,v8 as Wd,v9 as Vd,ht as $d,va as ta,lA as qd,hp as Yd,vb as Kd,vc as Qd,vd as Jd,sb as sa,hw as Xd,ve as Zd,vf as na,bH as em,vg as tm,e$ as sm,a5 as oa,am as nm,nr as om,ii as am,vh as im,vi as rm,vj as lm,vk as cm,eO as um,vl as aa,vm as ia,vn as dm,vo as mm,vp as pm,vq as ra,vr as fm,vs as gm,vt as hm,ds as xm,ob as bm,df as la,vu as vm,m0 as gi,vv as Sm,vw as ym,hL as Cm,x as hi,hP as km,vx as wm,vy as jm,oa as _m,gV as Am,kj as un,kk as dn,kQ as Mm,nE as Pm,vz as Rm,vA as Em,l5 as Tm,gW as Nm}from"./hj6jep7mk4776vwc.js";import{l as Se,aG as ie,c_ as Bm,P as w,cW as Im,dJ as Dm,cH as Oe,aL as et,hv as xi,aj as de,F as te,m as es,dE as zn,dT as He,aA as Xe,hw as ee,E as Ue,h1 as bi,A as vi,bX as Wn,cX as Us,a as N,hx as Si,h6 as xn,fa as yi,fw as Vn,cr as tt,hy as Ci,hz as Lm,fx as ki,bG as $n,aH as Ee,fb as wi,d9 as Es,bW as Fm,cL as qn,hA as Om,hB as Hm,hC as Um,hD as Gm,hE as Gs,cF as Re,a_ as ts,bD as xt,cm as zm,fG as Wm,am as Vm,bx as $m,ak as ji,hF as _i,bj as ca,b as qm,x as Ym,fe as Ai,L as Rt,co as Yn,cp as Kn,g as mn,dH as Ts,z as Mi,aB as Km,bM as Qm,R as Pi,hG as Jm,ea as Xm,V as Dt,d8 as Ri,hH as Zm,I as Ei,dC as ep,dx as tp,dv as sp,cG as Ti,b_ as np,d5 as ua,cY as Ke,hu as op,ft as da,f5 as it,aD as ut,C as ap,h as ip,gE as rp,ep as lp,dS as cp,u as up,aT as dp,fH as mp,b5 as pp,ag as fp,gD as Qn,bw as gp,fl as hp,fd as xp,bP as bp,bQ as vp,o as Wt,ac as Sp,hI as yp,hJ as Cp,hK as kp,dN as wp,D as jp,as as _p,at as Ap,di as ma,ah as Mp,ec as Pp,hL as Rp,gj as Ep,gk as Tp}from"./jfjoua4700kji9z3.js";import{A as Np,u as Ni}from"./b8nw7o07u9fxmapm.js";import{G as Bi}from"./ltik0hzezyevzkdj.js";import{F as Bp}from"./c5hp2e6cf62lum4k.js";import{T as Ip}from"./c166njesc8ruqs2t.js";import{b as Dp}from"./oe4qwwp6lvtt8c1x.js";const Lp="https://persistent.oaistatic.com/image-gen/nux.222e584e.mp4",Fp="https://help.openai.com/en/articles/8932459",ch=()=>{const{isLoading:t,eligible:s}=je(ce.hasSeenShibaHomeNux),{isUnauthenticated:n}=Se(),[a]=yl(),{value:o}=ie("2781425969");return n||!o||a?"hide":t?"loading":s?"show":"hide"};function Ii(t){return[{title:t.formatMessage({id:"er580q",defaultMessage:"Create an image of a magazine cover of cute animals with headlines and text"}),body:"",type:Ss.Autocomplete,prompt:t.formatMessage({id:"SKZKBN",defaultMessage:"Create an image of a photorealistic magazine cover for 'CUTE ANIMALS,' featuring three impossibly cute and stylishly accessorized pets, with realistic, catchy headlines and teaser text"})},{title:t.formatMessage({id:"ukPFbH",defaultMessage:"Create an image for a garden-themed birthday party invitation"}),body:"",type:Ss.Autocomplete,prompt:t.formatMessage({id:"uYg5kL",defaultMessage:"Create an image of a colorful invitation for a garden-themed birthday party, including whimsical typography"})},{title:t.formatMessage({id:"mMiJxP",defaultMessage:"Create an image of an astronaut with an inflatable duck on Mars"}),body:"",type:Ss.Autocomplete,prompt:t.formatMessage({id:"5nFWh4",defaultMessage:"Create a photorealistic image of an international astronaut on Mars, wearing a giant duck inflatable toy around its waist"})},{title:t.formatMessage({id:"+T7POI",defaultMessage:"Create an image of a tutorial for cooking pasta"}),body:"",type:Ss.Autocomplete,prompt:t.formatMessage({id:"9N2bJ0",defaultMessage:"Create an image of a comic-book style tutorial for cooking pasta"})}]}const uh=({onClose:t,clientThreadId:s})=>{const{markAsViewed:n}=je(ce.hasSeenShibaHomeNux),a=ht(),o=qt(),i=Bm("2604379743").config.value,r=typeof i.nux_video_url=="string"?i.nux_video_url:Lp,c=typeof i.nux_image_url=="string"?i.nux_image_url:"",[l,p]=f.useState(!1),d=Ra(a,s),{activeSystemHints:u}=Is(s),m=u.find(S=>S.systemHint===D.PictureV2);f.useEffect(()=>{w.logEventWithStatsig("chatgpt_imagegen_nux_modal_shown","chatgpt_imagegen_nux_modal_shown")},[]);const h=K(),g=Ii(h),x=()=>{n(),t(),w.logEventWithStatsig("chatgpt_imagegen_nux_modal_dismissed","chatgpt_imagegen_nux_modal_dismissed")},b=()=>{n(),t(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{m&&d({hint:m,enable:!0}),a.focus()})}),a.setAutocompletions(g)};return e.jsx(e.Fragment,{children:e.jsxs(Im,{testId:"modal-imagegen-nux",isOpen:!0,noPadding:!0,onClose:Dm,shouldIgnoreClickOutside:!0,showCloseButton:!1,size:"custom",type:"success",className:"max-w-lg",children:[e.jsxs("div",{className:"relative aspect-3/2 w-full",children:[!l&&e.jsx("img",{src:c,alt:"",className:"absolute inset-0 h-full w-full object-cover object-bottom transition-opacity duration-300"}),e.jsx("video",{src:r,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"h-full w-full object-cover object-bottom",onLoadedData:()=>p(!0)})]}),e.jsxs("div",{className:"flex flex-col gap-2 px-8 pt-6 pb-6 text-center",children:[e.jsx("div",{className:"text-xl font-medium",children:e.jsx(F,{id:"KgZP2O",defaultMessage:"Image creation just got better"})}),e.jsx("div",{className:"text-token-text-secondary w-full",children:e.jsx(F,{id:"/oguus",defaultMessage:"ChatGPT now thinks a little longer to make more accurate and detailed images. <link>Learn more</link>",values:{link:S=>e.jsx("a",{href:Fp,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 no-underline",children:S})}})}),e.jsx("div",{className:"mt-2 w-full text-xs text-[#8F8F8F] dark:text-[#C4C4C4]",children:e.jsx(F,{id:"6pIXUv",defaultMessage:"You must have permission to edit images you upload, including consent from any people in them."})}),e.jsxs("div",{className:"mt-4 flex w-full gap-3",children:[e.jsx(Oe,{color:"secondary",onClick:x,className:"flex-1",children:e.jsx(F,{id:"6nf9tD",defaultMessage:"Not now"})}),e.jsx(Oe,{color:"primary",onClick:()=>{b(),o("/?model=gpt-4o"),w.logEventWithStatsig("chatgpt_imagegen_nux_modal_continued","chatgpt_imagegen_nux_modal_continued")},className:"flex-1",children:e.jsx(F,{id:"ms5BU0",defaultMessage:"Try it"})})]})]})]})})},Op=({clientThreadId:t,rateLimitInfo:s,onDismiss:n,onInteract:a,onMount:o})=>{const{name:i,title:r,call_to_action:c,description:l}=s,p=et(),d=Et(!0),{updateSystemHint:u}=ve(),m=ht(),h=Et(!1),g=xi(),x=de(t,te.getIsNewConversation),b=p?.planType??"unknown",S=es(),C=zn(S,"3809605125"),k=g&&"block_reason"in g?g.block_reason:null,A="banner_description",E=f.useMemo(()=>({type:i||"unknown",location:A,plan_type:b,is_new_conversation:x,is_hard_block:!!g,hard_block_reason:k??"",call_to_action:c}),[i,A,b,x,g,k,c]),j=qt(),I=wn(),{isUnauthenticated:_}=Se(),L=Ds(),O=jn(He.signUpButtonText),v=Nt(),z=Ea({clientThreadId:t}),{layer:M}=Xe("1368081792"),U=G=>{switch(G){case ee.AUTHENTICATE:return{text:L?He.logInButtonText:O,onClick:()=>{I({authType:L?"login":"signup",callback:P=>{L?w.logLogInButtonClicked({location:`Rate limit banner - ${i}`,provider:P}):w.logSignUpButtonClicked({location:`Rate limit banner - ${i}`,provider:P})}})}};case ee.AUTHENTICATE_SECONDARY:return{text:L?O:He.logInButtonText,onClick:()=>{I({authType:L?"signup":"login",callback:P=>{L?w.logSignUpButtonClicked({location:`Rate limit banner - ${i}`,provider:P}):w.logLogInButtonClicked({location:`Rate limit banner - ${i}`,provider:P})}})}};case ee.GET_PLUS:return{text:Pt.getPlusButton,onClick:()=>{w.logRateLimitGetPlusButtonClicked(E),_?I({authType:L?"login":"signup",shouldOpenPaymentModalOnAuth:!0,callback:P=>{L?w.logLogInButtonClicked({location:"Rate limit banner Get Plus upsell",provider:P}):w.logSignUpButtonClicked({location:"Rate limit banner Get Plus upsell",provider:P})}}):Je(j,"Prompt textarea rate limit banner")}};case ee.NEW_CHAT:return{text:Pt.newChatButton,onClick:()=>{d({modelId:"",location:A})}};case ee.PAID_USER_O3_MINI_HIGH:{const P=te.getCurrentLeafId(Ue(t)),Y=()=>{w.logEventWithStatsig("In Context Upsell Banner O3 Mini High CTA Clicked","chatgpt_in_context_upsell_banner_o3_mini_high_cta_clicked",{location:M.get("should_change_model_picker",!0)?"In-context upsell o3-mini-high for Plus banner - Try it button":"In-context upsell o3-mini-high for Plus (no model switch) banner - Try it button",eventProperties:E}),M.get("should_change_model_picker",!0)&&h(C?{modelId:"o4-mini-high",location:"In-context upsell o4-mini-high for Plus banner - Try it button"}:{modelId:"o3-mini-high",location:"In-context upsell o3-mini-high for Plus banner - Try it button"}),z(C?{sourceEvent:new Event("click"),nodeId:P,requestedModelId:"o4-mini-high"}:{sourceEvent:new Event("click"),nodeId:P,requestedModelId:"o3-mini-high"})};return{text:Pt.tryItButton,onClick:Y}}case ee.FREE_USER_O3_MINI_HIGH:return{text:Pt.getPlusButton,onClick:()=>{w.logEventWithStatsig("In Context Upsell Banner O3 Mini High CTA Clicked","chatgpt_in_context_upsell_banner_o3_mini_high_cta_clicked",{location:"In-context upsell o3-mini-high for Free banner - Get Plus button",eventProperties:E}),Je(j,"Prompt textarea in-context upsell banner")}};case ee.DEEP_RESEARCH_IN_CONTEXT_UPSELL:{const P=te.findNode(Ue(t),re=>bi(re.message)),Y=P?vi(P.message):void 0;return{text:Pt.tryItButton,onClick:()=>{w.logEventWithStatsig("In Context Upsell Banner Deep Research CTA Clicked","chatgpt_in_context_upsell_banner_deep_research_cta_clicked",{location:"In-context upsell deep research - Try it button",eventProperties:E}),u(D.Research,{clientThreadId:t}),m.focus(),m.setText(Y??"")}}}case"get_pro":return{text:Pt.getProButton,onClick:()=>{w.logRateLimitUpgradePlanButtonClicked({...E,upgrade_plan_tye:"pro"}),_?I({authType:L?"login":"signup",shouldOpenPaymentModalOnAuth:!0,callback:P=>{L?w.logLogInButtonClicked({location:"Rate limit banner Get Pro upsell",provider:P}):w.logSignUpButtonClicked({location:"Rate limit banner Get Pro upsell",provider:P})}}):Je(j,"Prompt textarea rate limit banner")}}}};_n(()=>{!M.get("should_change_model_picker",!0)&&E.type==="o3-mini-high-in-context-upsell-plus"&&(E.type="o3-mini-high-in-context-upsell-plus-no-model-switch"),w.logRateLimitBannerShown(E),o?.()});let[q,W]=c??[];q===ee.AUTHENTICATE&&v&&(W=ee.AUTHENTICATE_SECONDARY);const B={primaryAction:U(q),secondaryAction:U(W)};return e.jsx(Ta,{onDismiss:n,title:r,description:l,actions:B,onInteract:a})},Pt=Te({getPlusButton:{id:"TeyLcp",defaultMessage:"Get Plus"},getProButton:{id:"Pl8/Vk",defaultMessage:"Get Pro"},newChatButton:{id:"7OvnJ5",defaultMessage:"New chat"},tryItButton:{id:"zPDzun",defaultMessage:"Try it"}}),Hp=({clientThreadId:t,rateLimitInfo:s,onDismiss:n,onInteract:a,onMount:o})=>{const{name:i,title:r,call_to_action:c,description:l}=s,p=et(),d=Et(!0),{updateSystemHint:u}=ve(),m=ht(),h=Et(!1),g=xi(),x=de(t,te.getIsNewConversation),b=p?.planType??"unknown",S=Nt(),C=es(),k=zn(C,"3809605125"),A=g&&"block_reason"in g?g.block_reason:null,E="banner_description",j=f.useMemo(()=>({type:i||"unknown",location:E,plan_type:b,is_new_conversation:x,is_hard_block:!!g,hard_block_reason:A??"",call_to_action:c}),[i,E,b,x,g,A,c]),I=qt(),_=wn(),{isUnauthenticated:L}=Se(),O=Ds(),v=jn(He.signUpButtonText),z=Ea({clientThreadId:t}),{layer:M}=Xe("1368081792"),U=G=>{switch(G){case ee.AUTHENTICATE:return{text:O?He.logInButtonText:v,onClick:()=>{_({authType:O?"login":"signup",callback:P=>{O?w.logLogInButtonClicked({location:`Rate limit banner - ${i}`,provider:P}):w.logSignUpButtonClicked({location:`Rate limit banner - ${i}`,provider:P})}})}};case ee.AUTHENTICATE_SECONDARY:return{text:O?v:He.logInButtonText,onClick:()=>{_({authType:O?"signup":"login",callback:P=>{O?w.logSignUpButtonClicked({location:`Rate limit banner - ${i}`,provider:P}):w.logLogInButtonClicked({location:`Rate limit banner - ${i}`,provider:P})}})}};case ee.GET_PLUS:return{text:Vt.getPlusButton,onClick:()=>{w.logRateLimitGetPlusButtonClicked(j),L?_({authType:O?"login":"signup",shouldOpenPaymentModalOnAuth:!0,callback:P=>{O?w.logLogInButtonClicked({location:"Rate limit banner Get Plus upsell",provider:P}):w.logSignUpButtonClicked({location:"Rate limit banner Get Plus upsell",provider:P})}}):Je(I,"Prompt textarea rate limit banner")}};case ee.NEW_CHAT:return{text:Vt.newChatButton,onClick:()=>{d({modelId:"",location:E})}};case ee.PAID_USER_O3_MINI_HIGH:{const P=te.getCurrentLeafId(Ue(t)),Y=()=>{w.logEventWithStatsig("In Context Upsell Banner O3 Mini High CTA Clicked","chatgpt_in_context_upsell_banner_o3_mini_high_cta_clicked",{location:M.get("should_change_model_picker",!0)?"In-context upsell o3-mini-high for Plus banner - Try it button":"In-context upsell o3-mini-high for Plus (no model switch) banner - Try it button",eventProperties:j}),M.get("should_change_model_picker",!0)&&h(k?{modelId:"o4-mini-high",location:"In-context upsell o4-mini-high for Plus banner - Try it button"}:{modelId:"o3-mini-high",location:"In-context upsell o3-mini-high for Plus banner - Try it button"}),z(k?{sourceEvent:new Event("click"),nodeId:P,requestedModelId:"o4-mini-high"}:{sourceEvent:new Event("click"),nodeId:P,requestedModelId:"o3-mini-high"})};return{text:Vt.tryItButton,onClick:Y}}case ee.FREE_USER_O3_MINI_HIGH:return{text:Vt.getPlusButton,onClick:()=>{w.logEventWithStatsig("In Context Upsell Banner O3 Mini High CTA Clicked","chatgpt_in_context_upsell_banner_o3_mini_high_cta_clicked",{location:"In-context upsell o3-mini-high for Free banner - Get Plus button",eventProperties:j}),Je(I,"Prompt textarea in-context upsell banner")}};case ee.DEEP_RESEARCH_IN_CONTEXT_UPSELL:{const P=te.findNode(Ue(t),re=>bi(re.message)),Y=P?vi(P.message):void 0;return{text:Vt.tryItButton,onClick:()=>{w.logEventWithStatsig("In Context Upsell Banner Deep Research CTA Clicked","chatgpt_in_context_upsell_banner_deep_research_cta_clicked",{location:"In-context upsell deep research - Try it button",eventProperties:j}),u(D.Research,{clientThreadId:t}),m.focus(),m.setText(Y??"")}}}}};_n(()=>{!M.get("should_change_model_picker",!0)&&j.type==="o3-mini-high-in-context-upsell-plus"&&(j.type="o3-mini-high-in-context-upsell-plus-no-model-switch"),w.logRateLimitBannerShown(j),o?.()}),f.useEffect(()=>()=>{w.logEventWithStatsig("Rate Limit: Dismiss Banner","chatgpt_rate_limit_banner_dismissed",j)},[j]);let[q,W]=c??[];q===ee.AUTHENTICATE&&S&&(W=ee.AUTHENTICATE_SECONDARY);const B={primaryAction:U(q),secondaryAction:U(W)};return e.jsx(Ta,{onDismiss:n,title:r,description:l,actions:B,onInteract:a})},Vt=Te({getPlusButton:{id:"TeyLcp",defaultMessage:"Get Plus"},newChatButton:{id:"7OvnJ5",defaultMessage:"New chat"},tryItButton:{id:"zPDzun",defaultMessage:"Try it"}}),Di=t=>{const{value:s}=ie("1028682714");return s?e.jsx(Op,{...t}):e.jsx(Hp,{...t})},Li=Wn.div`group flex h-10 items-center gap-2 rounded-lg px-2 hover:bg-token-main-surface-secondary text-sm text-token-text-primary`;function Up(){const{data:t,isLoading:s}=_l({cutId:"recent",limit:8}),{data:n,isLoading:a}=Al();return{isLoading:s||a,recent:t,pinned:n}}function Gp({query:t,onSelectGizmo:s,selectedIdx:n},a){const o=Cl(),i=f.useRef([]),{isLoading:r,recent:c,pinned:l}=Up();f.useImperativeHandle(a,()=>({handleEnterOnIndex:u=>{if(!d[u])return u<p.length?p[u].resource:"create"},getResultsLength:()=>p.length+1,scrollToItem:u=>{const m=i.current[u];m&&m.scrollIntoView({behavior:"instant",block:"nearest"})}}));let p=[];if(r)return e.jsx("div",{className:"absolute end-4 top-0 flex h-full items-center justify-center",children:e.jsx(Us,{})});c&&p.push(...c.pages.flatMap(u=>u.list.items).map(u=>({resource:u.resource,from:"recent"}))),l&&p.push(...l.items.map(u=>({resource:u,from:"pinned"}))),p=kl(p,u=>u.resource.gizmo.id);const d=p.map(u=>u.resource.gizmo.tags?.includes(Ls.WorkspaceDisabled));return t&&t!==""&&(p=p.filter(u=>(u.resource.gizmo.display.name.toLowerCase()+u.resource.gizmo.display.description?.toLowerCase()+u.resource.gizmo.author.display_name?.toLowerCase()).includes(t?.toLowerCase()))),e.jsxs("div",{className:"max-h-40 overflow-y-auto",children:[p.map((u,m)=>e.jsx("div",{ref:h=>{i.current[m]=h},tabIndex:m,onClick:()=>{d[m]||s(u.resource)},children:e.jsx($p,{gizmoResource:u.resource,from:u.from,showDescription:o,isSelected:n===m,grayedOut:d[m]})},u.resource.gizmo.id)),e.jsx("div",{ref:u=>{i.current[p.length]=u},tabIndex:p.length,onClick:()=>{s("create")},children:e.jsx(Wp,{isSelected:n===p.length})},"create")]})}const zp=f.forwardRef(Gp),Wp=({isSelected:t})=>e.jsx(Li,{className:t?"bg-token-main-surface-secondary":"",children:e.jsxs(pl,{to:"/gpts/editor",target:"_blank",className:"flex flex-row space-x-2 font-semibold",children:[e.jsx("span",{className:"self-center",children:e.jsx(Na,{className:"icon-sm"})}),e.jsx("span",{children:e.jsx(F,{...Fi.dropdownCreateLabel})})]})}),Vp=({onClick:t,onClose:s})=>{const[n,a]=f.useState(null),o=f.useRef(null),i=f.useRef(null),[r,c]=f.useState(0),l=K(),p=d=>{w.logEvent("Mentions Click Gizmo",{gizmo_id:d==="create"?"create":d.gizmo.id}),d!=="create"&&t(d)};return e.jsxs(e.Fragment,{children:[e.jsx("input",{autoFocus:!0,placeholder:l.formatMessage(Fi.searchPlaceholder),ref:o,onKeyDown:d=>{if(d.nativeEvent.isComposing)return;const u=i.current?.getResultsLength()??0;if((d.key==="Escape"||d.key==="Backspace"&&!n)&&(d.preventDefault(),s()),d.key==="Enter"||d.key==="Tab"){d.preventDefault();const m=i.current?.handleEnterOnIndex(r);if(!m)return;m==="create"?(window.open("/gpts/editor","_blank"),s()):p(m)}if(d.key==="ArrowDown"&&r<u-1){d.preventDefault();const m=r+1;i.current?.scrollToItem(m),c(m)}if(d.key==="ArrowUp"&&r>0){d.preventDefault();const m=r-1;i.current?.scrollToItem(m),c(m)}},onChange:d=>{a(d.target.value),c(0)},className:"bg-token-main-surface-primary w-full border-0 p-2 text-sm focus:outline-hidden"}),e.jsx(zp,{ref:i,query:n,selectedIdx:r,onSelectGizmo:p})]})},pa=({onClick:t,onClose:s})=>{const n=Si(),a=!!n;return _n(()=>{w.logEvent("Mentions Opened",{gizmo_selector_disabled:a})}),a?e.jsx(Di,{clientThreadId:xn,rateLimitInfo:n}):e.jsx("div",{onBlur:o=>{o.currentTarget.contains(o.relatedTarget)||s()},className:"popover border-token-border-default bg-token-main-surface-primary rounded-2xl border p-2 shadow-lg",children:e.jsx(Vp,{onClick:t,onClose:s})})};function $p({gizmoResource:t,from:s,showDescription:n,isSelected:a,grayedOut:o}){const i=!!t.gizmo.tags?.includes(Ls.FirstParty);return e.jsxs(Li,{className:N(a?"bg-token-main-surface-secondary":"",o&&"opacity-50"),children:[e.jsx(Bi,{isFirstParty:i,src:t.gizmo.display.profile_picture_url,className:N("icon-xl h-7 w-7 shrink-0",o&&"grayscale group-hover:grayscale-0")}),e.jsxs("div",{className:"flex h-fit grow flex-row justify-between space-x-2 overflow-hidden text-ellipsis whitespace-nowrap",children:[e.jsxs("div",{className:"flex flex-row space-x-2",children:[e.jsx("span",{className:"shrink-0 truncate font-semibold",children:t.gizmo.display.name}),n&&e.jsx("span",{className:"text-token-text-tertiary grow truncate text-sm sm:max-w-xs lg:max-w-md",children:t.gizmo.display.description})]}),e.jsx("span",{className:"shrink-0 self-center",children:s==="recent"?e.jsx(wl,{className:"icon-sm"}):e.jsx(jl,{className:"icon-sm"})})]})]})}const Fi=Te({talkingTo:{id:"TaggingDropdown.talkingTo",defaultMessage:"Talking to"},dropdownCreateLabel:{id:"TaggingDropdown.dropdownCreateLabel",defaultMessage:"Create a GPT"},searchPlaceholder:{id:"TaggingDropdown.searchPlaceholder",defaultMessage:"Search recent and pinned GPTs"}}),ss=({pressed:t,disabled:s,icon:n,label:a,ariaLabel:o,animatedLabel:i,showLabel:r,onClick:c,splitButtonDropdownContent:l,dropdownContent:p,dataTestid:d})=>{const[u,m]=f.useState(!1),h=Ma(),g=!s&&t,x=a&&e.jsx("div",{className:N("[display:var(--force-hide-label)] ps-1 pe-1 whitespace-nowrap"),children:a}),b=e.jsxs("button",{className:N("flex h-full min-w-8 items-center justify-center p-2",{"pe-1.5":!!l}),"data-testid":d,"aria-pressed":t,"aria-label":o,disabled:s,onTransitionEnd:()=>m(!1),onClick:k=>{p||(m(!0),c(k))},children:[n,!i&&r?x:null,i&&e.jsx(be,{initial:!1,children:r&&e.jsx($.span,{initial:{x:-10,width:0,opacity:0},animate:{x:0,width:"fit-content",opacity:1},exit:{x:-10,width:0,opacity:0},transition:{ease:"easeOut",duration:h?0:.15},children:x})})]}),S=l||p?e.jsx(e.Fragment,{children:e.jsx(Kt,{children:e.jsx(yi,{className:"p-0",$as:Qt,side:"bottom",align:"start",collisionPadding:10,sideOffset:8,children:p??l})})}):null,C=e.jsxs("div",{className:N("radix-state-open:bg-black/10 inline-flex h-9 rounded-full border text-[13px] font-medium",{"duration-75 motion-safe:transition-all":u,"text-token-text-secondary":!t,"text-token-interactive-label-accent-default can-hover:hover:bg-[#BDDCF4] dark:can-hover:hover:bg-[#1A416A] bg-token-composer-blue-bg border-transparent dark:bg-[#2A4A6D] dark:text-[#48AAFF]":!!g,"border-token-border-default can-hover:hover:bg-token-main-surface-secondary focus-visible:outline-black dark:focus-visible:outline-white":!g,"opacity-30":s}),children:[p?e.jsx(ft,{asChild:!0,children:b}):b,!p&&l?e.jsx(ft,{asChild:!0,children:e.jsx("button",{className:"border-token-border-default border-s p-2",style:{borderColor:g?"#0285FF0D":void 0},disabled:s,children:e.jsx(ws,{className:"h-[18px] w-[18px]"})})}):null]});return l||p?e.jsxs(Yt,{children:[e.jsx(Fs,{asChild:!0,children:C}),S]}):C};var rt=(t=>(t.Hover="hover",t.Enable="enable",t.Disable="disable",t))(rt||{});const Oi=new Map([[D.Think,{hover:["Composer Think Button Hovered","composer_think_button_hovered"],enable:["Composer Think Button Enabled","composer_think_button_enabled"],disable:["Composer Think Button Disabled","composer_think_button_disabled"]}],[D.Research,{hover:["Composer Research Button Hovered","composer_research_button_hovered"],enable:["Composer Research Button Enabled","composer_research_button_enabled"],disable:["Composer Research Button Disabled","composer_research_button_disabled"]}]]);function qp({systemHint:t,label:s,logo:n,isDisabled:a=!1,composerController:o,analyticsMetadata:i,onClick:r,showLabel:c=!1,splitButtonDropdownContent:l,dropdownContent:p,dataTestid:d}){const{name:u,systemHint:m}=t,h=m,{setThreadSystemHintMode:g,clearAllSystemHintModeTriggers:x}=ve(),b=Bt(h),S=!!t.composerBarButtonInfo?.upsell,C=Qe.useStore(),{value:k}=ie("2454940646"),A=Jt(),E=[D.Search,D.Think].includes(h);f.useEffect(()=>{a&&A.has(h)&&g(h,!1,i)},[a,h,i,g,A,E]);const j=f.useCallback(L=>{L.stopPropagation(),L.preventDefault();let O=!0;k&&E&&(C.getState().persistedSystemHints.has(D.Search)||C.getState().persistedSystemHints.has(D.Think))&&(O=!1),O&&x(),g(h,!b,i),b||(o.removeSystemHints(),o.focus());const{enable:v,disable:z}=Oi.get(h)??{},[M,U]=(b?z:v)??[];M&&U&&w.logEventWithStatsig(M,U,i),r?.(L)},[i,k,x,o,h,E,b,r,g,C]),I=S?e.jsx("div",{className:"py-2",children:e.jsx(An,{location:h,statsig_login_event:"chatgpt_composer_upsell_login_button_clicked",statsig_signup_event:"chatgpt_composer_upsell_signup_button_clicked",containerNoPadding:!0})}):null;return e.jsx(ss,{pressed:b,disabled:a,icon:n,label:s,ariaLabel:u,animatedLabel:!c,showLabel:c||b,onClick:j,dropdownContent:p??I,splitButtonDropdownContent:l,dataTestid:d})}function Yp({composerController:t,systemHint:s,composerBarButtonInfo:n,isDisabled:a,clientThreadId:o,showLabel:i,labelOverride:r,disabledReason:c,rateLimitProgress:l,dropdownContent:p,splitButtonDropdownContent:d,logoOverride:u,dataTestid:m,tooltipPosition:h,disableNuxMarkdown:g}){const x={clientThreadId:o};return e.jsx(Kp,{composerBarButtonInfo:n,isDisabled:a,analyticsMetadata:x,systemHint:s.systemHint,disabledReason:c,rateLimitProgress:l,tooltipPosition:h,disableNuxMarkdown:g,children:e.jsx(qp,{isDisabled:a,systemHint:s,label:r??s.name,logo:u??e.jsx(Vn,{svgString:s.logo,className:"h-[18px] w-[18px]"}),composerController:t,analyticsMetadata:x,showLabel:i,dropdownContent:p,splitButtonDropdownContent:d,dataTestid:m})})}function Kp({children:t,isDisabled:s,systemHint:n,composerBarButtonInfo:a,analyticsMetadata:o,disabledReason:i,rateLimitProgress:r,tooltipPosition:c="bottom",disableNuxMarkdown:l}){const p=Ml(a.announcementKey,n),d=Pl({composerBarButtonInfo:a,children:t,disableMarkDown:l}),u=K();let m=null;return r&&r.remaining?m=e.jsx(Hi,{remaining:r.remaining,reset_date:r.reset_after,text:a.tooltipText}):a.tooltipText&&(m=e.jsx(Jn,{text:a.tooltipText})),p?d:e.jsx("div",{children:e.jsx(tt,{sideOffset:10,label:s?i===dt.HasAttachedFiles?u.formatMessage({id:"hhxO6y",defaultMessage:"Reason disabled for attachments"}):i===dt.DeepResearchHighLoad?u.formatMessage({id:"UrDtrS",defaultMessage:"Deep research is temporarily unavailable"}):i===dt.RateLimitReached?a.rateLimitReachedText:a.disabledText:m,side:c,onOpenChange:h=>{if(h){const{hover:g}=Oi.get(n)??{},[x,b]=g??[];x&&b&&w.logEventWithStatsig(x,b,o)}},children:t})})}const Jn=({text:t})=>e.jsx("span",{children:t}),Hi=({remaining:t,reset_date:s,text:n})=>{const{locale:a}=K(),o=Rl(s,a);return e.jsxs("div",{className:"text-start",children:[e.jsx("span",{className:"text-token-text-tertiary block text-xs font-semibold",children:e.jsx(F,{id:"PromptTextarea.systemHintTooltip.remaining",defaultMessage:"{remaining} available until {resetDate}",values:{remaining:t,resetDate:o}})}),e.jsx(Jn,{text:n})]})},Qp=()=>Lm().find(t=>t.feature_name===Nl(D.Research))??null;function Jp({clientThreadId:t,showLabel:s=!1,isDisabled:n}){const a=El(t),o=ht(),i=Bt(D.Research),{setThreadSystemHintMode:r,clearAllSystemHintModeTriggers:c}=ve(),l=!!Ci(),{value:p}=ie("1416952492"),d=p?dt.DeepResearchHighLoad:l?dt.RateLimitReached:void 0;return a?e.jsx("div",{"data-testid":"system-hint-research",style:{viewTransitionName:`var(--vt-composer-${D.Research}-action)`},children:e.jsx(Xp,{composerController:o,isThreadInSystemHintMode:i,setThreadSystemHintMode:r,clearAllSystemHintModeTriggers:c,clientThreadId:t,showLabel:s,isDisabled:n||!!d,disabledReason:d})},`system-hint-${D.Research}`):null}function Xp({composerController:t,isThreadInSystemHintMode:s,setThreadSystemHintMode:n,clearAllSystemHintModeTriggers:a,clientThreadId:o,showLabel:i=!1,isDisabled:r=!1,disabledReason:c}){const l=K(),p={clientThreadId:o},d=l.formatMessage({id:"ORxecl",defaultMessage:"Deep research"}),u=h=>{h===rt.Hover?w.logEventWithStatsig("Composer Research Button Hovered","composer_research_button_hovered",p):h===rt.Enable?w.logEventWithStatsig("Composer Research Button Enabled","composer_research_button_enabled",p):h===rt.Disable&&w.logEventWithStatsig("Composer Research Button Disabled","composer_research_button_disabled",p)},m=h=>{h.stopPropagation(),h.preventDefault(),a(),n(D.Research,!s,p),s||(t.removeSystemHints(),t.focus()),u(s?rt.Disable:rt.Enable)};return e.jsx(Zp,{disabledReason:c,isDisabled:r,logEvent:u,children:e.jsx(ss,{pressed:s,disabled:r,icon:e.jsx(Tl,{className:"h-[18px] w-[18px]"}),label:d,animatedLabel:!i,showLabel:i||s,onClick:m,ariaLabel:d,dataTestid:"composer-button-deep-research"})})}function Zp({children:t,isDisabled:s,disabledReason:n,logEvent:a}){const o=K(),i=Ci(),r=Qp(),c=o.formatMessage({id:"LtcsGJ",defaultMessage:"Get detailed insights on any topic"});let l=null;r&&r.remaining?l=e.jsx(Hi,{remaining:r.remaining,reset_date:r.reset_after,text:c}):l=e.jsx(Jn,{text:c});const p=n===dt.DeepResearchHighLoad?o.formatMessage({id:"UrDtrS",defaultMessage:"Deep research is temporarily unavailable"}):n===dt.RateLimitReached&&i?o.formatMessage({id:"T3aUKM",defaultMessage:"More available {time}"},{time:i.resets_after_text}):void 0;return e.jsx("div",{children:e.jsx(tt,{className:"inline-block",sideOffset:0,label:s?p:l,side:"bottom",onOpenChange:d=>{d&&a(rt.Hover)},children:t})})}function ef({clientThreadId:t,gizmoId:s,composerController:n,isDisabled:a}){return Bl({clientThreadId:t,gizmoId:s})?e.jsx("div",{"data-testid":"system-hint-reason",style:{viewTransitionName:`var(--vt-composer-${D.Think}-action)`},children:e.jsx(tf,{clientThreadId:t,composerController:n,isDisabled:a})},`system-hint-${D.Think}`):null}function tf({clientThreadId:t,composerController:s,isDisabled:n}){const a=K(),o=!!ki();n=n||o;const i=a.formatMessage({id:"T+qu+0",defaultMessage:"Reason"}),{setThreadSystemHintMode:r,clearAllSystemHintModeTriggers:c}=ve(),l=Bt(D.Think),p=Qe.useStore(),d=Jt(),{isUnauthenticated:u}=Se();f.useEffect(()=>{n&&d.has(D.Think)&&r(D.Think,!1,{clientThreadId:t})},[n,d,r,t]);const m=x=>{if(x.stopPropagation(),x.preventDefault(),u)return;let b=!0;p.getState().persistedSystemHints.has(D.Search)&&(b=!1),b&&c(),r(D.Think,!l,{clientThreadId:t}),l||(s.removeSystemHints(),s.focus()),l?w.logEventWithStatsig("Composer Think Button Disabled","composer_think_button_disabled",{clientThreadId:t}):w.logEventWithStatsig("Composer Think Button Enabled","composer_think_button_enabled",{clientThreadId:t})},h=u?e.jsx(An,{location:D.Think,statsig_login_event:"chatgpt_composer_upsell_login_button_clicked",statsig_signup_event:"chatgpt_composer_upsell_signup_button_clicked",containerNoPadding:!0}):void 0,g=e.jsx(ss,{pressed:l,disabled:n,icon:e.jsx(Dl,{className:"h-[18px] w-[18px]"}),label:i,ariaLabel:i,animatedLabel:!0,showLabel:!0,onClick:m,dropdownContent:h,dataTestid:"composer-button-reason"});return e.jsx(Il,{isDisabled:n,clientThreadId:t,children:g})}const sf=["o1","o1-pro","gpt-4"];function nf({account:t,clientBootstrapFlags:s,features:n,clientThreadId:a,currentModelConfig:o,composerController:i,isDisabled:r,gizmoId:c,hasFiles:l}){const{prospectiveModelId:p}=Xt(a);let d=Zt(a);const u=Mn(c),{userIsInSearchHoldoutWithWebDisabled:m}=Ll(),h=o?.enabledTools?.includes($n.Search),g=d==null||d?.kind===Ee.PrimaryAssistant||d?.kind===Ee.GizmoInteraction&&u,{isUnauthenticated:x}=Se(),b=wi(D.Search);return x&&s?.includes(Es.AnonSearchHoldout)||!x&&(t==null||t.isFree())&&(s?.includes(Es.FreeSearchHoldout)||m)||!b||!x&&(t==null||t.isEnterprisey())&&!n?.includes(Fm.BrowsingAvailable)||!g?null:e.jsx("div",{"data-testid":"system-hint-search",style:{viewTransitionName:`var(--vt-composer-${D.Search}-action)`},children:e.jsx(of,{clientThreadId:a,composerController:i,modelSupportsSearch:h??(x||t?.isFree()||!!p&&!sf.includes(p)),isDisabled:r,disabledReason:h?l?js.HasAttachedFiles:void 0:js.ModelNotSupported,currentModelName:o?.title??""})},`system-hint-${D.Search}`)}function of({clientThreadId:t,composerController:s,isDisabled:n,disabledReason:a,currentModelName:o,modelSupportsSearch:i}){const r=K(),c=Fl(),l=r.formatMessage({id:"TbHx8d",defaultMessage:"Search"}),{setThreadSystemHintMode:p,clearAllSystemHintModeTriggers:d}=ve(),u=Qe.useStore(),m=Jt();n=n||!i,f.useEffect(()=>{n&&m.has(D.Search)&&p(D.Search,!1,{clientThreadId:t})},[n,m,p,t]);const h=g=>{g.stopPropagation(),g.preventDefault();let x=!0;u.getState().persistedSystemHints.has(D.Think)&&(x=!1),x&&d(),p(D.Search,!c,{clientThreadId:t}),c||(s.removeSystemHints(),s.focus()),w.logEventWithStatsig("Composer Search Button Clicked","composer_search_button_clicked",{clientThreadId:t}),c&&s.trimLeadingText(/^search\b/i)};return e.jsx(rf,{analyticsMetadata:{clientThreadId:t},isThreadUsingSearchMode:c,isDisabled:n,disabledReason:a,currentModelName:o,children:e.jsx(ss,{pressed:c,disabled:n??!1,icon:e.jsx(Ol,{className:"h-[18px] w-[18px]"}),label:l,ariaLabel:l,animatedLabel:!0,showLabel:!0,onClick:h,dataTestid:"composer-button-search"})})}function af(){const t=Ba(),s=je(ce.hasSeenComposerSearchButtonTooltip);return!s.isLoading&&s.eligible&&!t}function rf({children:t,analyticsMetadata:s,isThreadUsingSearchMode:n,isDisabled:a,disabledReason:o,currentModelName:i}){const r=af()&&!n,c=je(ce.hasSeenComposerSearchButtonTooltip);return r?e.jsx(Pn,{announcementKey:ce.hasSeenComposerSearchButtonTooltip,side:"right",show:!0,theme:"bright",dismissOnOutsideClick:!0,badge:"new",title:e.jsx(F,{id:"Yjduqi",defaultMessage:"Search the web"}),onDismiss:c.markAsViewed,sideOffset:0,className:"xs:max-w-sm! max-w-2xs!",description:e.jsx(F,{id:"W51Aei",defaultMessage:"Get fast answers with trusted sources. {learnMore}",values:{learnMore:e.jsx(Hl,{href:"https://openai.com/index/introducing-chatgpt-search",className:"underline",children:e.jsx(F,{id:"stA7F4",defaultMessage:"Learn more"})})}}),children:e.jsx("div",{children:t})}):e.jsx("div",{children:e.jsx(tt,{className:"inline-block",sideOffset:0,label:a?o===js.ModelNotSupported?e.jsx(F,{id:"GZemJe",defaultMessage:"Search disabled for {modelName}",values:{modelName:`${i}`}}):o===js.HasAttachedFiles?e.jsx(F,{id:"Wd1fc2",defaultMessage:"Search disabled for attachments"}):e.jsx(F,{id:"GpDAWD",defaultMessage:"Search is unavailable"}):e.jsx(F,{id:"c+4o2s",defaultMessage:"Search the web"}),side:"bottom",onOpenChange:l=>{l&&w.logEventWithStatsig("Composer Search Button Hovered","composer_search_button_hovered",s)},children:t})})}const lf=1;function cf({value:t=lf,size:s,onStateChange:n}){return e.jsx("div",{className:"relative flex h-full w-full flex-col items-center justify-center",children:e.jsxs($.div,{animate:{translateY:t>1&&s==="small"?-1:0},onAnimationStart:()=>n?.("animating"),onAnimationComplete:()=>n?.("idle"),className:N("relative",s==="small"?"h-5 w-5":"h-8 w-8"),children:[e.jsx($.div,{style:{transformOrigin:"50% 100%",translateY:s==="large"?3:0},animate:{scale:t>1&&s==="small"?.85:1},className:"absolute start-0 top-0",children:e.jsx(Ia,{"aria-label":"",className:N(s==="small"?"h-5 w-5":"h-8 w-8")})}),e.jsx($.div,{initial:{scale:s==="small"?.9:1.1,opacity:0},animate:{scale:s==="large"?1.1:t>1?1:.9,opacity:t>1?1:0},style:{translateY:s==="large"?-1:0},className:"absolute start-0 top-0",children:e.jsx(Ul,{"aria-label":"",className:N(s==="small"?"h-5 w-5":"h-8 w-8")})}),e.jsx($.div,{initial:{scale:s==="small"?.9:1.1,opacity:0},animate:{scale:s==="large"?1.1:t>2?1:.9,opacity:t>2?1:0},style:{translateY:s==="large"?-1:0},className:"absolute start-0 top-0",children:e.jsx(Gl,{"aria-label":"",className:N(s==="small"?"h-5 w-5":"h-8 w-8")})})]})})}function uf(t){const{reasoningLevelTypes:s,reasoningLevelType:n}=t,{ReasoningLevels:a}=s;let o=1;return n===a.medium.type?o=2:n===a.high.type&&(o=3),e.jsx("div",{className:N("relative flex h-5 w-5 items-center justify-center"),children:e.jsx(cf,{size:"small",value:o})})}const df=({isManualModelSelection:t,animatedLabel:s,reasoningLevelTypes:n,reasoningLevelType:a,modelName:o,onResetReasoningLevel:i,onReasoningLevelChanged:r,type:c})=>{const[l,p]=f.useState(!1),d=Ma(),{reasoningLevel:u}=zl({reasoningLevelTypes:n,reasoningLevelType:a}),m=a!=="low"||t||!1,h=pe(x=>x.isVisuallyOverflowing),g=h;return e.jsxs("div",{className:N("radix-state-open:bg-black/10 inline-flex h-9 rounded-full border text-[13px] font-medium",m?"text-token-interactive-label-accent-default can-hover:hover:bg-[#BDDCF4] dark:can-hover:hover:bg-[#1A416A] bg-token-composer-blue-bg border-transparent dark:bg-[#2A4A6D] dark:text-[#48AAFF]":"border-token-border-default text-token-text-secondary can-hover:hover:bg-token-main-surface-secondary focus-visible:outline-black dark:focus-visible:outline-white",l&&"duration-75 motion-safe:transition-all"),children:[e.jsxs("div",{className:"flex h-full min-w-8 items-center justify-center p-2","aria-pressed":m,onTransitionEnd:()=>p(!1),onClick:x=>{c==="think"&&!t&&!h&&(x.stopPropagation(),x.preventDefault(),r(a==="low"?"medium":"low"))},children:[e.jsx(uf,{reasoningLevelTypes:n,reasoningLevelType:a}),s&&e.jsx(be,{initial:!1,children:e.jsx($.span,{initial:{x:-10,width:0,opacity:0},animate:{x:0,width:"fit-content",opacity:1},exit:{x:-10,width:0,opacity:0},transition:{ease:"easeOut",duration:d?0:.15},children:e.jsx("div",{className:N("ps-1 pe-1 whitespace-nowrap",g&&!t&&"hidden"),children:t?o:u?.shortLabel})})}),!t&&c==="auto"&&!m&&!g&&e.jsx(ws,{"aria-label":"",className:"h-[18px] w-[18px] opacity-50"})]}),m&&!h&&(t||c!=="think")?e.jsx("div",{className:"border-token-border-default mt-[1px] border-s p-2",style:{borderColor:m?"#0285FF28":void 0},onClick:x=>{x.stopPropagation(),x.preventDefault(),i()},children:e.jsx(qn,{"aria-label":"",className:"h-[16px] w-[16px]"})}):c==="think"?e.jsx("div",{className:N("border-token-border-default border-s p-2",g&&"hidden"),style:{borderColor:m?"#0285FF28":void 0},children:e.jsx(ws,{className:"h-[18px] w-[18px]"})}):null]})},Ui=({clientThreadId:t,rateLimitPopup:s,children:n,disabled:a,highlightTooltip:o=!1,disabledReason:i,currentModelName:r})=>{const c=K(),l=de(t,te.getIsNewConversation),p=et(),d=g=>{s!=null&&g&&w.logPopoverHover({type:"rate_limit",location:"file_upload",plan_type:p?.planType??"unknown"})},u=jn(He.signUpButtonText),{isEligible:m}=Wl(t),h=!!s;return e.jsx(e.Fragment,{children:h?e.jsx("div",{className:"h-8",children:e.jsxs(Om,{delayDuration:150,onOpenChange:d,children:[e.jsx(Hm,{asChild:!0,children:n}),e.jsx(Um,{children:e.jsx(yi,{$as:Gm,side:"left",sideOffset:0,align:"start",alignOffset:-12,className:"max-w-[320px]",children:e.jsx(mf,{isNewConversation:l,rateLimitPopup:s,signUpButtonText:u})})})]})}):!a&&m?e.jsx(Bp,{clientThreadId:t,children:n}):e.jsx(tt,{sideOffset:0,label:a?i===Fe.ModelNotSupported?c.formatMessage({id:"pEB4vw",defaultMessage:"Attachments disabled for {modelName}"},{modelName:`${r}`}):i===Fe.ThinkModeInUse?c.formatMessage({id:"NRk4QL",defaultMessage:"Attachments disabled for Reason mode"}):i===Fe.SearchModeInUse?c.formatMessage({id:"YlO80p",defaultMessage:"Attachments disabled for Search mode"}):c.formatMessage({id:"9Wgi7B",defaultMessage:"Attach files is unavailable"}):c.formatMessage({id:"wkpQmi",defaultMessage:"Upload files and more"}),className:"flex",open:o?!0:void 0,side:"bottom",children:n})})},mf=({isNewConversation:t=!1,rateLimitPopup:s,signUpButtonText:n})=>{const a=et(),o=qt(),i=wn(),r=Ds(),c=Nt();if(s==null)return null;const{call_to_action:l,description:p}=s,d=p||e.jsx(F,{...fa.defaultDescription}),u=l?.includes(ee.GET_PLUS),m=l?.includes(ee.AUTHENTICATE),h=m&&c;return e.jsxs("div",{className:"text-token-text-primary p-2 text-sm",children:[e.jsx("div",{className:"mb-3",children:d}),u?e.jsx(Oe,{size:"small",color:"secondary",onClick:()=>{Je(o,"Rate limited file upload popover"),w.logRateLimitGetPlusButtonClicked({type:"file_upload",location:"popover",plan_type:a?.planType??"unknown",is_hard_block:!1,is_new_conversation:t,hard_block_reason:""})},children:e.jsx(F,{...fa.getPlus})}):null,m?e.jsx(Oe,{size:"small",color:"primary",onClick:()=>{i({authType:r?"login":"signup",callback:g=>{r?w.logLogInButtonClicked({location:"File picker rate limit tooltip",provider:g}):w.logSignUpButtonClicked({location:"File picker rate limit tooltip",provider:g})}})},children:r?e.jsx(F,{...He.logInButtonText}):e.jsx(F,{...n})}):null,h?e.jsx(Oe,{size:"small",color:"secondary",className:"ms-2",onClick:()=>{i({authType:r?"signup":"login",callback:g=>{r?w.logSignUpButtonClicked({location:"File picker rate limit tooltip",provider:g}):w.logLogInButtonClicked({location:"File picker rate limit tooltip",provider:g})}})},children:r?e.jsx(F,{...n}):e.jsx(F,{...He.logInButtonText})}):null]})},fa=Te({defaultDescription:{id:"U5qAWP",defaultMessage:"You've reached your daily upload limit. Get ChatGPT Plus to unlock more."},getPlus:{id:"TeyLcp",defaultMessage:"Get Plus"}});function pf({setOpen:t,open:s,...n}){return e.jsxs(e.Fragment,{children:[e.jsx(Re.Trigger,{className:"m-0 h-0 w-0 border-none bg-transparent p-0"}),e.jsx(Gi,{...n,onClick:()=>t(!0),open:s})]})}function Gi({clientThreadId:t,icon:s,isDisabled:n=!1,showLabel:a=!1,highlightTooltip:o=!1,hideBorder:i=!1,isSmall:r=!1,disabledReason:c,currentModelName:l,visualTreatment:p,onClick:d,open:u,hasPopoverTrigger:m=!1,showGlowingBorder:h}){const g=Gs(),x=K();n=n||!!g;const b=e.jsxs(Da,{disabled:n,"aria-disabled":n,"aria-label":n?x.formatMessage({id:"NTwThg",defaultMessage:"Attach files is unavailable"}):x.formatMessage({id:"ixBxc3",defaultMessage:"Upload files and more"}),onClick:S=>{S.preventDefault(),d()},$open:u,$showLabel:a,$showGlowingBorder:h,$hideBorder:i,$isSmall:r,$visualTreatment:p,children:[s,a&&e.jsx(La,{})]});return e.jsx(Ui,{clientThreadId:t,rateLimitPopup:g,highlightTooltip:o,disabled:n,disabledReason:c,currentModelName:l,children:m?e.jsx(ft,{asChild:!0,children:b}):b})}function zi({clientThreadId:t,icon:s,isDisabled:n=!1,showLabel:a=!1,highlightTooltip:o=!1,hideBorder:i=!1,isSmall:r=!1,disabledReason:c,currentModelName:l,visualTreatment:p,isLoading:d,handleLocalFileUploadClick:u,noAvailableConnectors:m,showMenuForNoAuth:h,announcement:g}){const{openPopover:x,isOpen:b}=It(),{openMenu:S,confirmMenuOpened:C}=Fa();f.useEffect(()=>{S&&(x(),C())},[S,C,x]);const k=()=>{if(m&&!d&&!h){u();return}x(),g.eligible&&g.markAsViewed(),w.logEventWithStatsig("Composer: Open Context Connector Picker","chatgpt_composer_open_context_connector_picker")};return e.jsx(Gi,{clientThreadId:t,icon:s,isDisabled:n,showLabel:a,highlightTooltip:o,hideBorder:i,isSmall:r,disabledReason:c,currentModelName:l,visualTreatment:p,onClick:k,open:b,hasPopoverTrigger:!0})}const bn=({children:t,sideOffset:s=-35,...n})=>{const a=Ze(),{isOpen:o,closePopover:i,popoverContentRef:r}=It();return f.useEffect(()=>{if(o)return Vl(i,r)},[o,r,i]),f.useEffect(()=>{if(!o)return;const c=l=>{l.key==="Escape"&&i()};return document.addEventListener("keydown",c,{capture:!0,passive:!0}),()=>document.removeEventListener("keydown",c,{capture:!0})},[o,i]),e.jsx(Kt,{forceMount:!0,children:e.jsx(Qt,{forceMount:!0,asChild:!0,align:"center",sideOffset:s,onClick:c=>{c.stopPropagation(),c.preventDefault()},onOpenAutoFocus:c=>{c.preventDefault()},...n,children:e.jsx("div",{ref:r,className:N(!o&&"pointer-events-none"),children:e.jsx(be,{mode:"sync",children:o&&e.jsx($.div,{className:N("border-token-border-xlight origin-radix-popover dark:bg-token-main-surface-secondary flex overflow-clip rounded-2xl border bg-white shadow-2xl dark:border-white/5 dark:shadow-[0px_24px_64px_rgba(0,0,0,0.32)]"),variants:{open:{scale:[.7,1],opacity:1,transition:a?ue:gt},closed:{opacity:0,scale:.8,transition:a?ue:{...gt,duration:.2}}},initial:"closed",animate:"open",exit:"closed",children:t})})})})})},Wi=({as:t="div",children:s,className:n,isSelected:a=!1,shape:o="rectangle",spacing:i="normal",disableHover:r=!1,isLegacyStyle:c=!1,borderVisible:l=!1,...p})=>{const d=t==="div"?$.div:$.button,u=!r&&"hover:border-black/0 hover:bg-black/5 motion-safe:transition-colors dark:hover:bg-white/5",m=!r&&"hover:bg-black/[0.075]! dark:hover:bg-white/10!";return e.jsx(d,{className:N("relative -ms-1 flex cursor-pointer flex-row items-center justify-center gap-1 rounded-3xl border py-1 font-medium whitespace-nowrap select-none *:pointer-events-none","[font-size:var(--pill-font-size,14px)]",i==="compact"&&o==="round"&&"px-1.5",i==="compact"&&o==="rectangle"&&"px-2.5",i==="normal"&&o==="rectangle"&&"px-3.5",c?"min-h-9":"min-h-8",l?"border-token-border-default":"border-transparent",a?c?"text-token-interactive-label-accent-default bg-token-composer-blue-bg hover:bg-[#BDDCF4] focus-visible:outline-black dark:bg-[#2A4A6D] dark:text-[#48AAFF] dark:hover:bg-[#1A416A] dark:focus-visible:outline-white":N("dark:text-token-composer-blue-text bg-black/[0.045] dark:bg-white/5",m):c?"hover:bg-token-main-surface-secondary":N("[color:var(--pill-color,var(--text-secondary))]",u),n),...p,children:s})},vn=({children:t,className:s,isSelected:n=!1,onClick:a,tooltipLabel:o,...i})=>{const{isOpen:r,openPopover:c,popoverTriggerRef:l}=It(),p=f.useCallback(u=>{(u.key==="Enter"||u.key===" ")&&(u.preventDefault(),c())},[c]),d=f.useCallback(u=>{a?.(u),!u.defaultPrevented&&c()},[a,c]);return e.jsx(tt,{sideOffset:0,label:o,delayDuration:500,children:e.jsx(ft,{asChild:!0,onFocusCapture:u=>{u.stopPropagation()},children:e.jsx(Wi,{animate:r?"inactive":"active",as:"div",role:"button",className:N("group motion-safe:[transition:border-color_0.1s_ease-in-out]",s),isSelected:n,"data-reasoning-popover-action":!0,onClick:d,onKeyDown:p,ref:l,tabIndex:0,...i,children:t})})})};function ff(t=!1){const[s,n]=f.useState(t),[a,o]=f.useState(!1);return{isOpen:s,isStartingToOpen:a,setIsOpen:n,setIsStartingToOpen:o}}function Xn({layoutMode:t,initialOpen:s=!1,forceOpen:n=!1,restoreFocus:a,children:o,onClose:i,mode:r="default",modal:c}){const{isOpen:l,isStartingToOpen:p,setIsOpen:d,setIsStartingToOpen:u}=ff(s||n),m=n||l,h=f.useRef(null),g=f.useRef(null),x=f.useCallback((k=!0)=>{m||(d(!0),$l(),requestAnimationFrame(()=>{u(!0),k&&ql({root:h.current,autoFocus:!0})}))},[d,u,m]),b=f.useCallback(()=>{!p&&!m||(d(!1),u(!1),requestAnimationFrame(()=>{const k=new Event("focus");a?.(k),k.defaultPrevented||g.current?.focus()}),i?.())},[i,d,u,p,m,a]),S=k=>{k?x():b()},C={Trigger:{type:vn,instance:null},Content:{type:bn,instance:null}};return f.Children.forEach(o,k=>{if(f.isValidElement(k))if(k.type===vn||k.type===ft||k.type===zi){if(C.Trigger.instance)throw new Error("Only one trigger is allowed");C.Trigger.instance=k}else k.type===bn&&(C.Content.instance=k)}),e.jsx(Yl,{value:{closePopover:b,isOpen:m,isStartingToOpen:p,layoutMode:t,openPopover:x,popoverContentRef:h,popoverTriggerRef:g,mode:r},children:e.jsxs(Yt,{open:m,onOpenChange:S,modal:c,children:[C.Trigger.instance,C.Content.instance]})})}const Vi=ft,gf=vn,Zn=bn,hf=({clientThreadId:t,currentModelId:s,onModelSelection:n,closePopover:a,setIsModelPickerOpen:o,ref:i})=>{const r=K(),{data:c}=ts(),{mode:l}=It(),p=Kl({clientThreadId:t}),{hasInternalModels:d}=Ql(),{isUXUpdatesEnabled:u}=xt(),g=Jl(b=>b.query).toLowerCase().trim().length>0,x=Xl();return e.jsxs($.div,{initial:{clipPath:"inset(0 100% 0 0)",opacity:0},animate:{clipPath:"inset(0 0% 0 0)",opacity:1},exit:{clipPath:"inset(0 100% 0 0)",opacity:0},transition:gt,className:N("flex flex-col",x&&"scroll-mt-[44px]"),ref:i,children:[l!=="model-picker-only"&&!u&&e.jsxs("div",{className:"border-token-border-xlight bg-token-main-surface-primary dark:bg-token-main-surface-secondary sticky start-0 top-0 z-10 flex w-full flex-row items-center justify-center overflow-clip border-b p-3",children:[e.jsx("button",{onClick:()=>{o(!1)},id:"reasoning-level-popover-model-list-back-button",className:"hover:bg-token-main-surface-tertiary flex items-center rounded-md p-1",children:e.jsx(Oa,{className:"text-token-text-secondary h-5 w-5"})}),e.jsx("div",{className:"flex-auto text-center text-sm font-medium",children:r.formatMessage({id:"j6WEI7",defaultMessage:"Choose a model"})}),e.jsx("div",{className:"w-5"})]}),e.jsx("div",{className:N("flex w-full flex-col pb-2",u?"pt-3":"pt-2",x&&"min-h-[375px]"),children:g?e.jsx(Zl,{currentModelId:s,onModelSelection:n,closePopover:a,rootRef:i}):e.jsxs(e.Fragment,{children:[c?.categories?.map(b=>{const S=b?.defaultModel;return e.jsx(ec,{model:b,modelSwitcherDenialsBySlug:p,isSelected:S===s,onClick:()=>{n(S),a()}},S)}),d&&e.jsxs(e.Fragment,{children:[e.jsx(tc,{modelsData:c,clientThreadId:t,triggerButton:e.jsx(mt,{className:"relative mt-1 border-transparent",children:e.jsxs("div",{className:"mb-1 flex items-center px-1",children:[e.jsx("div",{className:"text-sm",children:r.formatMessage({id:"ZDpo4I",defaultMessage:"Internal Models"})}),e.jsx(zm,{className:"icon-md text-token-text-tertiary absolute end-1 w-7"})]})}),onModelItemClick:b=>{b&&(n(b),a())}}),e.jsx(Ha,{})]})]})})]})},xf={modelPickerOpen:{maxHeight:375,width:320},modelPickerClosed:{maxHeight:245,width:320},vanguardModelPickerClosed:{maxHeight:320,width:264}},bf=({clientThreadId:t,reasoningLevelTypes:s,reasoningLevelType:n,onReasoningLevelChanged:a,isManualModelSelection:o,currentModelId:i,onModelSelection:r,resetReasoningLevel:c})=>{const{layoutMode:l,closePopover:p,mode:d}=It(),u=!Os(),[m,h]=f.useState(!!(o||d==="model-picker-only")),g=f.useRef(null),x=f.useRef(null),{isUXUpdatesEnabled:b}=xt();return f.useEffect(()=>{b&&m&&!o?requestAnimationFrame(()=>{x.current?.scrollIntoView({block:"start",behavior:"smooth"}),document.getElementById("reasoning-level-popover-juice-list-model-picker-button")?.focus()}):b&&o&&requestAnimationFrame(()=>{x.current?.scrollIntoView({block:"start",behavior:"instant"}),document.getElementById("reasoning-level-popover-juice-list-model-picker-button")?.focus()}),m?b||(g.current?.scrollTo({top:-1e3,behavior:"instant"}),document.getElementById("reasoning-level-popover-model-list-back-button")?.focus()):document.getElementById("reasoning-level-popover-juice-list-model-picker-button")?.focus()},[o,m,b]),e.jsxs($.div,{className:N("max-h-[max(calc(var(--radix-popover-content-available-height)-64px), 245px)] flex flex-1 origin-center snap-y snap-proximity scroll-pt-[30px] overflow-y-auto overscroll-contain scroll-smooth [scrollbar-gutter:stable]",!b&&u&&!m&&"pt-4",l==="bottom"&&!b?"flex-col-reverse":"flex-col"),animate:m?"modelPickerOpen":b?"vanguardModelPickerClosed":"modelPickerClosed",transition:Cs,variants:xf,ref:g,children:[(!m||b)&&d!=="model-picker-only"&&e.jsx(sc,{clientThreadId:t,reasoningLevelTypes:s,reasoningLevelType:n,onReasoningLevelChanged:a,resetReasoningLevel:c,shouldShowModelPicker:u,setIsModelPickerOpen:h,isModelPickerOpen:m,showAccountPaymentModal:Je}),e.jsx(be,{children:m&&u&&e.jsx(hf,{clientThreadId:t,setIsModelPickerOpen:h,ref:x,currentModelId:i,onModelSelection:r,closePopover:p})})]})},vf=({clientThreadId:t,layoutMode:s,currentModel:n,category:a,type:o,...i})=>{const{data:r}=ts(),l=pe(_=>_.threads[t]?.modelSelection)?.type===xe.SPECIFIC,p=pe(_=>_.setThreadModelSelection),d=Os(),u=qt(),m=f.useMemo(()=>{const _=n?.id??"";return nc(_)?"low":oc(_)?"medium":ac(_)?"high":"low"},[n?.id]),h=ic(),g=Et(),x=f.useCallback(_=>{pt(t,p,{type:xe.EFFORT_MODE,effortMode:lt[_]}),requestAnimationFrame(()=>{requestAnimationFrame(()=>{const L=Ua(_,r?.categories.map(O=>O.defaultModel)??[]);L&&(d&&_==="high"?Je(u,"Model picker upsell"):g({location:"PromptTextarea",modelId:L}))})})},[t,g,u,d,r,p]),b=_=>{const L=n?.id??"";_&&(w.logEvent("Model Switcher Model Changed",{from:L,to:_,source:"popover"}),Vm.logEvent("chatgpt_model_switcher_model_changed",_,{from:L,to:_,source:"popover"}),g({modelId:_,location:"Model switcher menu item"}),_!==cc&&uc({type:xe.SPECIFIC,modelSlug:_}),pt(t,p,{type:xe.SPECIFIC,modelSlug:_}))},S=!rc(n?.id??""),C=l||S,A=(a?.label&&a?.label?.length<10?a?.label:a?.shortLabel)??n?.title??"",E=n?.id??"",j=()=>{x("low")},I=f.useCallback(()=>{const{reasoningLevelList:_}=h,O=(_.findIndex(v=>v.type===m)+1)%_.length;x(_[O].type)},[x,m,h]);return f.useEffect(()=>Wm(lc,{cycleReasoningLevel:I}),[I]),e.jsxs(Xn,{layoutMode:s,...i,children:[e.jsx(Vi,{children:e.jsx(df,{isManualModelSelection:C,modelName:A,animatedLabel:!0,reasoningLevelTypes:h,reasoningLevelType:m,onResetReasoningLevel:j,onReasoningLevelChanged:x,type:o})}),e.jsx(Zn,{align:"start",children:e.jsx(bf,{clientThreadId:t,reasoningLevelTypes:h,reasoningLevelType:m,onReasoningLevelChanged:x,modelName:A,isManualModelSelection:C,currentModelId:E,onModelSelection:b,resetReasoningLevel:j})})]})},$i=({className:t,children:s})=>e.jsx($.div,{className:t,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,transition:{duration:.1,delay:0}},transition:{type:"tween",duration:.3,delay:.2},children:s});function Sf({canContinue:t,onContinueGenerating:s}){const n=f.useCallback(o=>{s(o),pn()},[s]);let a=null;return t&&(a=e.jsx(Cf,{onHandleContinueGenerating:n})),a&&e.jsx("div",{className:"flex h-full w-full items-center justify-end gap-0 py-4 md:gap-2",children:a})}function yf({className:t}){return e.jsx(dc,{className:N("-rotate-180",t)})}const Cf=({onHandleContinueGenerating:t})=>e.jsx($i,{children:e.jsx(Oe,{as:"button",color:"secondary",onClick:t,className:"py-2 whitespace-nowrap",icon:yf,size:"small",children:e.jsx(F,{...oe.continueGenerating})})}),kf=({clientThreadId:t})=>{const s=_i(),n=de(t,te.getRequestId),a=de(t,te.getCurrentLeafId),o=ji(n),{layer:i}=Xe("1368081792"),r=s?.name?()=>{switch(s.name){case"o3-mini-high-in-context-upsell-free":case"o3-mini-high-in-context-upsell-plus":case"deep-research-in-context-upsell":bc(a);break}}:void 0,{value:c}=ie("3612584454");f.useEffect(()=>{o&&!(s?.name==="gpt-4l"&&c)&&ca.dismissBanner()},[o,s?.name,c]);const l=s?.is_dismissible?()=>{w.logEventWithStatsig("Rate Limit: Dismiss Banner","chatgpt_rate_limit_banner_dismissed",{type:!i.get("should_change_model_picker",!0)&&s?.name==="o3-mini-high-in-context-upsell-plus"?"o3-mini-high-in-context-upsell-plus-no-model-switch":s?.name}),ca.dismissBanner()}:void 0,p=()=>{switch(s?.name){case"o3-mini-high-in-context-upsell-free":case"o3-mini-high-in-context-upsell-plus":case"deep-research-in-context-upsell":yc({interactedInPeriod:!0});break}};return e.jsx(be,{children:s&&e.jsx($.div,{transition:{type:"tween",ease:"easeInOut",duration:.1},initial:{opacity:0,transform:"translateY(8px)"},animate:{opacity:1,transform:"translateY(0px)"},exit:{opacity:0,transform:"translateY(8px)"},children:e.jsx(Di,{clientThreadId:t,rateLimitInfo:s,onDismiss:l,onInteract:p,onMount:r})})})};function wf(t,s,n,a,o,i,r,c,l,p,d){if(l||(t.name==="o3-mini-high-in-context-upsell-free"||t.name==="o3-mini-high-in-context-upsell-plus")&&(s.some(C=>C.model_slug==="o3-mini-high")||n.id==="o3-mini-high")||c&&r&&cn(Date.now(),r)<Ko)return!1;const m=a==null||cn(Date.now(),a)>=vc,h=o===p,g=r==null||i==null||cn(Date.now(),r)>=Ko||i<Sc;if(!(m&&g||h))return!1;switch(t.name){case"deep-research-in-context-upsell":return d("should_show_deep_research_upsell_banner",!1);case"o3-mini-high-in-context-upsell-free":return d("should_show_o3_mini_high_upsell_banner_free_user_to_plus",!1);case"o3-mini-high-in-context-upsell-plus":return d("should_show_o3_mini_high_upsell_banner_plus_user",!1);default:return!1}}function jf(t){const s=$m(),n=mc(t),a=de(t,te.getRequestId),o=de(t,te.getCurrentLeafId),i=ji(a),r=_i(),c=pc(g=>g.lastSeenInContextUpsellBannerAt),l=fc(g=>g.inContextUpsellBannerPeriodExposureCount),p=gc(g=>g.inContextUpsellBannerPeriodStartAt),d=hc(g=>g.inContextUpsellBannerLastSeenId),u=xc(g=>g.inContextUpsellBannerInteractedInPeriod),{layer:m}=Xe("1368081792");let h=!1;switch(r?.name){case null:case void 0:h=!1;break;case"o3-mini-high-in-context-upsell-free":case"o3-mini-high-in-context-upsell-plus":case"deep-research-in-context-upsell":h=wf(r,s,n,c,d,l,p,u,i,o,m.get);break;default:h=!0}return!i&&h}const Sn=window.sessionStorage,yn=qm(Ym(()=>({memoryFullBannerDismissed:!!Sn?.getItem(Rt.MemoryFullBannerDismissed)}))),qi={dismissBanner(){yn.setState(t=>{t.memoryFullBannerDismissed=!0}),Sn?.setItem(Rt.MemoryFullBannerDismissed,"true")},clearDismissedBanner(){yn.setState(t=>{t.memoryFullBannerDismissed=!1}),Sn?.removeItem(Rt.MemoryFullBannerDismissed)}};function _f(t){const s=Ai(t),n=Cc(),{data:a}=kc(s,!1,n),o=a!=null,i=o&&a.memoryFullPct>=100,[r,c]=f.useState(!1);f.useEffect(()=>{!i&&o&&(c(!0),qi.clearDismissedBanner())},[i,o]);const l=yn(p=>p.memoryFullBannerDismissed);return i&&r&&!l}function Af(){const t=K(),{openSettings:s}=wc();return e.jsx($.div,{initial:{opacity:0},animate:{opacity:1},children:e.jsx(Ga,{title:t.formatMessage(ys.memoryFullTitle),content:t.formatMessage(ys.memoryFullTooltip,ys.memoryFullTooltip.values),primaryCtaText:t.formatMessage(ys.memoryManageButton),onPrimaryCtaClick:()=>s(jc.Personalization),onDismiss:()=>qi.dismissBanner()})})}const ys=Te({memoryFullTitle:{id:"i1hV1R",defaultMessage:"ChatGPT's out of space for saved memories"},memoryManageButton:{id:"a5A88o",defaultMessage:"Manage"},memoryFullTooltip:{id:"Rs+Att",defaultMessage:"New memories wont be added until you make space. <a>Learn more</a>",values:{a:t=>e.jsx("a",{href:_c,target:"_blank",rel:"noopener noreferrer",className:"underline",children:t})}}}),Mf=()=>{const{shouldShowSkipButton:t}=Ac();return t?e.jsx($i,{className:"flex justify-center",children:e.jsx(Oe,{as:"button",color:"secondary",onClick:()=>Mc.skipParagen(),children:e.jsx(F,{...Pf.skip})})}):null},Pf=Te({skip:{id:"dvcUbp",defaultMessage:"Skip"}}),Rf=Yn(()=>Kn(()=>import("./ctutgkmdnr0gjcbs.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(t=>t.JawboneNotificationsBanner)),Yi=f.memo(function({className:s}){const{store:n}=_e(),a=n.useIsHeaderContentAreaPopulated();return e.jsx("div",{className:N(s??"absolute start-0 end-0 bottom-full",Tc.PromptTextareaHeader),children:e.jsx(Pc,{shouldRender:a,contentArea:$t.Header,children:e.jsxs("div",{className:"mb-2 flex flex-col gap-3.5 pt-2",children:[e.jsx(Ef,{}),e.jsx(Tf,{})]})})})});function Ef(){const{store:t}=_e(),s=t.useSharedProps(c=>c?.clientThreadId),n=t.useContentAreaId($t.HeaderTop),a=Rc(),o=de(s,c=>c?.modelId),i=Ec.useStore();let r;switch(n){case T.ProjectConversationTaskNoFileAccess:r=e.jsx(Df,{});break;case T.AdvancedVoiceOnMobileAnnouncement:r=e.jsx(Jc,{clientThreadId:s});break;case T.S09KM1:r=null;break;case T.ParagenControls:r=e.jsx(Mf,{});break;case T.BannerSignup:r=e.jsx(If,{});break;case T.BannerTermsDisclaimer:r=e.jsx(Lf,{});break;case T.PromptTextareaAction:r=e.jsx(Ff,{});break;case T.BannersRateLimit:r=e.jsx(Of,{});break;case T.BannerSidekickAnnouncement:r=e.jsx(Qc,{});break;case T.SearchBrowserExtensionAnnouncement:r=e.jsx(Kc,{});break;case T.MoonshineAnnouncement:r=e.jsx(Yc,{});break;case T.CustomizeChatGPTAnnouncement:r=e.jsx(qc,{});break;case T.SearchBrowserExtensionReactiveAnnouncement:r=e.jsx($c,{});break;case T.BannerMemoryFull:r=e.jsx(Af,{});break;case T.Box:r=e.jsxs("div",{id:"Box",className:"flex h-20 w-full items-center justify-center gap-2 bg-red-500 p-2",children:["box",e.jsxs("div",{className:"flex h-full w-full items-center justify-center gap-2 bg-blue-500 p-2",children:["inner",e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-yellow-400 text-center",children:"actual content"})]})]});break;case T.JawboneAnnouncement:a?r=e.jsx(Rf,{}):r=null;break;case T.JawboneMaxActiveAnnouncement:a?r=e.jsx(Vc,{}):r=null;break;case T.PromoRedemptionAnnouncement:r=e.jsx(Wc,{});break;case T.OperatorAnnouncement:r=e.jsx(zc,{});break;case T.BannerPlusUpsell:r=e.jsx(Gc,{});break;case T.ContextualAnswersAdminUpsell:r=e.jsx(Uc,{});break;case T.ContextualAnswersUserUpsell:r=e.jsx(Hc,{});break;case T.ReferrerRedemptionAvailableAnnouncement:r=e.jsx(Oc,{});break;case T.RefereeRedemptionAvailableAnnouncement:r=e.jsx(Fc,{});break;case T.ReferralProgramUpsellAnnouncement:r=e.jsx(Lc,{});break;case T.StudentsUpsellAnnouncement:r=e.jsx(Dc,{});break;case T.ModelDeprecationBanner:r=Ic(o);break;case T.TeamsContextualAnswersUpsell:r=e.jsx(Bc,{});break;case T.LanguageUpsellBanner:r=e.jsx(Nc,{onDismissSideEffect:()=>{w.logEventWithStatsig("Language Upsell Banner Dismissed","chatgpt_web_language_upsell_banner_dismissed"),i.closeBanner()},onPrimaryCtaClickSideEffect:()=>{w.logEventWithStatsig("Language Upsell Banner Primary CTA Clicked","chatgpt_web_language_upsell_banner_primary_cta_clicked"),i.closeBanner()}});break;default:r=null;break}return r}function Tf(){const{store:t}=_e(),s=t.useContentAreaId($t.HeaderBottom);let n;switch(s){case za.DallePromptControls:n=e.jsx(Bf,{});break;default:n=null;break}return n}const Nf=Yn(()=>Kn(()=>import("./ooz34ip0v5zjt48o.js"),__vite__mapDeps([7,1,3,4,2,5])).then(t=>t.default));function Bf(){const{store:t}=_e(),s=t.useSharedProps(n=>n?.composerController);return s?e.jsx(Nf,{composerController:s}):null}function If(){const{store:t}=_e(),s=t.useSharedProps(o=>o?.clientThreadId),n=Ds(),a=Xc();return s?n?e.jsx(Zc,{threadId:s,showSignUp:a}):e.jsx(eu,{threadId:s,showLogin:a}):null}function Df(){return f.useEffect(()=>()=>{mn.getItem(Rt.TasksHasSeenProjectDisclaimerBanner)||mn.setItem(Rt.TasksHasSeenProjectDisclaimerBanner,!0)},[]),e.jsx(Ga,{icon:e.jsx(tu,{}),title:e.jsx(F,{id:"ibX3g7",defaultMessage:"Tasks cant access project files"}),content:e.jsx(F,{id:"fm94Tm",defaultMessage:"Theres a task in this conversation  just FYI, it wont be able to access project files."}),onDismiss:()=>{mn.setItem(Rt.TasksHasSeenProjectDisclaimerBanner,!0)}})}function Lf(){const{store:t}=_e(),s=t.useSharedProps(n=>n?.clientThreadId);return s?e.jsx(su,{threadId:s}):null}function Ff(){const{store:t}=_e(),s=t.useSharedProps();return s?e.jsx(Sf,{...s}):null}function Of(){const{store:t}=_e(),s=t.useSharedProps(n=>n?.clientThreadId);return s?e.jsx(kf,{clientThreadId:s}):null}const Hf=5,Uf=f.memo(function(s){return Gf(s),zf(s),Wf(),null});function Gf(t){const{store:s}=_e(),n=s.useSetSharedProps();Ts(()=>{n(t)},[t,n])}function zf(t){const{clientThreadId:s,canContinue:n}=t,{store:a}=_e(),o=f.useRef({top:a.useContentAreaApi($t.HeaderTop),bottom:a.useContentAreaApi($t.HeaderBottom)}).current,i=nu(s),{shouldShowBannerSignup:r,shouldShowBannerTermsDisclaimer:c}=Vf(s),l=jf(s),p=ou(t),d=au(t),u=Ba(),m=iu(),h=ru(t),g=_f(s),x=lu(),b=cu(t),S=uu(s),C=du(s),k=mu(),{eligible:A}=je(ju),E=pu(),j=fu(),I=gu(),_=hu(),L=xu(s),O=bu(s),v=vu(),z=Su(s),M=yu(s),U=Cu(s),q=de(s,B=>B?.modelId),W=Zt(s);Ts(()=>{q&&W?.kind===Ee.GizmoInteraction&&W.gizmo&&_u(q,W.gizmo)?o.top.set(T.ProjectConversationTaskNoFileAccess):b.eligible?o.top.set(T.AdvancedVoiceOnMobileAnnouncement):x?o.top.set(T.ParagenControls):c?o.top.set(T.BannerTermsDisclaimer):l?o.top.set(T.BannersRateLimit):v?o.top.set(T.BannerPlusUpsell):z?o.top.set(T.ContextualAnswersAdminUpsell):M?o.top.set(T.ContextualAnswersUserUpsell):S?o.top.set(T.JawboneAnnouncement):C?o.top.set(T.JawboneMaxActiveAnnouncement):p.eligible?o.top.set(T.BannerSidekickAnnouncement):u?o.top.set(T.MoonshineAnnouncement):m?o.top.set(T.CustomizeChatGPTAnnouncement):d?o.top.set(T.SearchBrowserExtensionAnnouncement):h?o.top.set(T.SearchBrowserExtensionReactiveAnnouncement):k?o.top.set(T.PromoRedemptionAnnouncement):A?o.top.set(T.OperatorAnnouncement):I?o.top.set(T.ReferralProgramUpsellAnnouncement):n?o.top.set(T.PromptTextareaAction):r?o.top.set(T.BannerSignup):g?o.top.set(T.BannerMemoryFull):E?o.top.set(T.ReferrerRedemptionAvailableAnnouncement):j?o.top.set(T.RefereeRedemptionAvailableAnnouncement):_?o.top.set(T.StudentsUpsellAnnouncement):L?o.top.set(T.ModelDeprecationBanner):O?o.top.set(T.TeamsContextualAnswersUpsell):U?o.top.set(T.LanguageUpsellBanner):o.top.set(null)},[o,n,c,r,l,p,g,x,b]),Ts(()=>{i&&o.bottom.set(za.DallePromptControls)},[o,i])}function Wf(){const{store:t}=_e();f.useEffect(()=>()=>{t.reset()},[t])}function Vf(t){const{isUnauthenticated:s}=Se(),{layer:n}=Xe("3637408529",{shouldLogExposure:!1}),{layer:a}=Xe("3637408529"),o=a.get("no_auth_banner_signup_rate_limit",Hf),i=n.get("should_show_no_auth_signup_banner",!0),r=ku(u=>u.bannerDisclaimerClientThreadId),c=wu(),l={shouldShowBannerTermsDisclaimer:!1,shouldShowBannerSignup:!1},[p,d]=de(t,u=>[te.getConversationTurns(u).filter(m=>m.role===Mi.User).length,$f(te.getCurrentNode(u)?.message)]);return t&&(l.shouldShowBannerTermsDisclaimer=d&&s&&p===1&&!c&&(r==null||r===t),l.shouldShowBannerSignup=i&&d&&s&&p>0&&p%o===0),l}function $f(t){return t?.author.role===Mi.Assistant&&Km(t)}const Ki=({serverThreadId:t,clientThreadId:s,getIsDisabled:n,composerController:a,onReset:o,onInfer:i})=>{const[r,c]=f.useState(!1),{isAutoSwitcherEnabled:l,inferenceDebounceTime:p}=xt(),d=Qm(),u=f.useRef(null),m=Au(({enableInferredJuice:C})=>C),h=l||m,g=f.useRef(i);g.current=i;const x=f.useRef(0),b=f.useRef(0),S=f.useCallback(_s(C=>{if(n())return;const k=++x.current,A=Date.now();c(A);const E=Ue(s),j=te.getCurrentNode(E);Pi.postAnonAware("/conversation/infer",{prompt:C,conversation_id:t??null,is_history_and_training_disabled:d,parent_message_id:j.message.id},{additionalHeaders:{"x-conduit-token":u.current??""}}).then(I=>{if(u.current=I.conduit_token,n()||b.current>k||a.getContentToSend().content.length<C.length)return;b.current=k;const{juice:_}=I;g.current(_)}).finally(()=>{c(I=>I&&A<I?I:!1)})},p),[n]);return f.useEffect(()=>{if(!(!h||!(a instanceof Bs)))return a.subscribe("change",()=>{const{content:C}=a.getContentToSend();n()||!h||(C?S(C):(u.current=null,o(),c(!1),++x.current,b.current=x.current))})},[h,n,a,S,i,o,t,d]),r!==!1},Ns=D.PictureV2,qf=["o1","o3-mini","o3-mini-high","o1-pro","gpt-4.5","gpt-4-5"];function Yf({clientThreadId:t,composerController:s,currentModelConfig:n,currentModelConfigLoading:a,disableIfNoAccess:o}){const i=es(),[r]=Pa(),c=et()?.planType,l=de(t,j=>Mu(i,t,j,r,c)),{value:p}=ie("2868048419"),u=null!=null;let m=Zt(t);const h=m==null||m?.kind===Ee.PrimaryAssistant,{isUnauthenticated:g}=Se(),x=!g,b=n?.enabledTools?.includes($n.ImageGen),S=Jm(),C=!!S,k=b&&!a&&l&&!qf.includes(l),A=x&&p&&!u&&h;return!wi(D.PictureV2)||!(A&&(k||o))?null:e.jsx("div",{"data-testid":"system-hint-picture_v2",style:{viewTransitionName:`var(--vt-composer-${Ns}-action)`},children:e.jsx(Kf,{clientThreadId:t,composerController:s,disabled:!!o&&!k||C,imageGenFeatureBlock:S})},`system-hint-${Ns}`)}function Kf({clientThreadId:t,composerController:s,disabled:n,imageGenFeatureBlock:a}){const i=Wa(s)===Ns,r=K(),c=Ii(r),l=r.formatMessage({id:"rh3NHv",defaultMessage:"Create image"}),p=r.formatMessage({id:"Uh+8Ls",defaultMessage:"Visualize ideas and concepts"}),{clearAllSystemHintModeTriggers:d}=ve(),u=x=>{x.stopPropagation(),x.preventDefault(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{d(),i?s.removeSystemHints():s.addSystemHint(Ns,l),s.focus()})}),s.setAutocompletions(c),i?w.logEventWithStatsig("Composer Think Button Disabled","composer_create_image_button_disabled",{clientThreadId:t}):w.logEventWithStatsig("Composer Think Button Enabled","composer_create_image_button_enabled",{clientThreadId:t})},m=e.jsx(ss,{pressed:i,icon:e.jsx(Pu,{className:"h-[18px] w-[18px]"}),label:l,ariaLabel:l,animatedLabel:!0,showLabel:!0,onClick:u,disabled:!!n,dataTestid:"composer-button-create-image"}),h=a?.title??p,g=a?.description??void 0;return e.jsx(tt,{className:"inline-block",sideOffset:0,label:h,secondaryLabel:g,side:"bottom",onOpenChange:x=>{x&&w.logEventWithStatsig("Composer Create Image Button Hovered","composer_create_image_button_hovered",{clientThreadId:t})},children:m})}function Qi({clientThreadId:t,getInputProps:s,openFileDialog:n,uploadType:a,icon:o,isDisabled:i=!1,isSmall:r=!1,showLabel:c=!1,showUpsell:l=!1,hideBorder:p=!1,highlightTooltip:d=!1,disabledReason:u,currentModelName:m}){const h=K(),g=Gs();i=(i||!!g)&&!l;const x=e.jsxs(Da,{disabled:i,$showLabel:c,$hideBorder:p,$isSmall:r,onClick:C=>{if(C.preventDefault(),l){w.logNoAuthAttachButtonClicked({location:"No auth upsell"});return}w.logEvent("Open File Viewer",{intent:a.toString()}),n()},"aria-label":i?u===Fe.ModelNotSupported?h.formatMessage({id:"pEB4vw",defaultMessage:"Attachments disabled for {modelName}"},{modelName:`${m}`}):u===Fe.ThinkModeInUse?h.formatMessage({id:"NRk4QL",defaultMessage:"Attachments disabled for Reason mode"}):u===Fe.SearchModeInUse?h.formatMessage({id:"YlO80p",defaultMessage:"Attachments disabled for Search mode"}):h.formatMessage({id:"PromptFilePicker.attachFilesUnavailable",defaultMessage:"Attach files is unavailable"}):h.formatMessage({id:"PromptFilePicker.attachFiles",defaultMessage:"Upload files and more"}),children:[o,c&&e.jsx(La,{})]}),b=e.jsx("input",{disabled:i,...s({className:"hidden"})}),S=e.jsxs("div",{className:"flex",children:[x,b]});return l?e.jsx(tt,{sideOffset:0,label:e.jsx(F,{id:"wkpQmi",defaultMessage:"Upload files and more"}),side:"bottom",open:d||void 0,children:e.jsx(Xm,{triggerButton:S,sideOffset:0,alignOffset:0,children:e.jsx(An,{location:"attach",statsig_login_event:"chatgpt_composer_upsell_login_button_clicked",statsig_signup_event:"chatgpt_composer_upsell_signup_button_clicked"})})}):e.jsx(Ui,{disabled:i,clientThreadId:t,rateLimitPopup:g,highlightTooltip:d,children:S})}function Qf({code:t,message:s}){switch(t){case Qo.FileTooLarge:return ga.errorFileTooLarge;case Qo.TooManyFiles:return w.logEvent("Uploaded Max Files Error"),ga.errorTooManyFiles;default:return s}}const ga=Te({attachImages:{id:"PromptFilePicker.attachImages",defaultMessage:"Attach images"},attachFiles:{id:"PromptFilePicker.attachFiles",defaultMessage:"Upload files and more"},errorFileTooLarge:{id:"PromptFilePicker.errorFileTooLarge",defaultMessage:"Your file is too large. The maximum file size is {size}MB."},errorTooManyFiles:{id:"PromptFilePicker.errorTooManyFiles",defaultMessage:"You may only upload {maxNum} files at a time."},defaultFileUploadRateLimited:{id:"U5qAWP",defaultMessage:"You've reached your daily upload limit. Get ChatGPT Plus to unlock more."},getPlusButton:{id:"TeyLcp",defaultMessage:"Get Plus"}}),ha=Te({dragInstructions:{id:"FileDropZone.dragInstructions",defaultMessage:"Add anything"},dragAllAccepted:{id:"FileDropZone.dragAllAccepted",defaultMessage:"Drop any file here to add it to the conversation"}});function Jf(t){if(!t.accept||Object.keys(t.accept).length===0)return[];const s=[];return Object.values(t.accept).forEach(n=>s.push(...n)),s.sort()}function dh(t){const{className:s,children:n,clientThreadId:a,currentModelConfig:o,noKeyboard:i}=t,r=K(),c=Dt(),l=Zt(a),p=Jt(),d=As(o,l,p),u=d!==ct.None,m=fn(j=>j.files),h=(d===ct.Multimodal?Rn:En)-m.length,g=h<=0,{getGizmoId:x}=Tn(),{handleFileAccepted:b}=to(r,d,Bn(o,l),"drag",x,Nn(o,l)?.attachments),S=Gs(),C=In(Dn(o,l)),{getRootProps:k,isDragActive:A}=Ln({maxFiles:h,disabled:!u||g||S!=null,noClick:!0,noKeyboard:i,onDropAccepted:b,onDropRejected:j=>eo(j,r,c,d),multiple:!0,maxSize:Fn,...C}),E=Jf(C);return e.jsxs("div",{...k({className:s}),children:[n,A&&e.jsxs(Xf,{children:[e.jsx(Ru,{}),e.jsx("h3",{children:e.jsx(F,{...ha.dragInstructions})}),e.jsx("h4",{className:"w-2/3 text-center",children:E.length>0?E.join(", "):e.jsx(F,{...ha.dragAllAccepted})})]})]})}function eo(t,s,n,a){const{errors:o}=t[0];o.forEach(i=>{const r=Qf(i);typeof r=="string"?n.danger(r,{hasCloseButton:!0}):n.danger(s.formatMessage(r,{size:Eu,maxNum:a===ct.Multimodal?Rn:En}),{hasCloseButton:!0})})}function to(t,s,n,a,o,i){const r=es(),c=Ri(r).flags,l=Dt(),p=On(),d=Va(),{isUnauthenticated:u}=Se(),m=c?.includes(Es.NoAuthEnableFileUploads);return{handleFileAccepted:f.useCallback(async(g,x)=>{w.logEvent("Upload File",{client:"web",eventSource:a,intent:s.toString()}),d.fileUploadAccepted();const b=o!=null?await o():void 0;g.length>0&&g.forEach(S=>{ks.uploadFile(p,Tu(S),S,s,n,t,l,{gizmoId:b,...m&&{isUnauthenticated:u}},i)})},[a,s,o,p,d,n,t,l,i,m,u])}}const Xf=Wn.div`absolute z-50 inset-0 flex gap-2 flex-col justify-center items-center after:contents-[""] after:absolute after:opacity-80 after:z-[-1] after:bg-token-main-surface-primary after:inset-0`,Ji=t=>{const s=[];s.push({category:null,systemHints:t.filter(n=>!n.category)});for(const n of Zm)s.push({category:n,systemHints:t.filter(a=>a.category===n)});return s};function Xi({composerController:t,clientThreadId:s,onHintSelected:n}){const a=Ei(s),[o]=de(s,M=>[M?.modelId]),{data:i}=ts(),r=o??Nu(void 0).id,c=$a(i?.models,r),{setThreadSystemHintMode:l,clearAllSystemHintModeTriggers:p}=ve(),{viewableSystemHints:d,persistedSystemHints:u}=Qe.useState(({availableHints:M,persistedSystemHints:U})=>({viewableSystemHints:M,persistedSystemHints:U})),[m,h]=f.useState([]),[g,x]=f.useState(void 0),[b,S]=f.useState(0);f.useEffect(()=>{if(!g)h([]);else{const M=g.text.toLocaleLowerCase(),U=d.filter(W=>{const B=W.name.toLocaleLowerCase().startsWith(M),G=W.systemHint.toLocaleLowerCase().startsWith(M);let P=!1;return W.regexMatches&&W.regexMatches.length>0&&(P=W.regexMatches.some(Y=>Y.replace(/[\^\$\(\)]/g,"").toLocaleLowerCase().startsWith(M))),B||G||P}).filter(W=>W.requiredFeatures.every(B=>c?.enabledTools?.includes(B))),q=Ji(U).map(W=>W.systemHints).flat();h(q)}},[g]),f.useEffect(()=>{t.view.dispatch(xl(t.view.state.tr,{onHintMatch(M){x(U=>ep(U,M)?U:M)}}))},[t]);const C=!d.length||!m.length||!g;f.useEffect(()=>{S(0)},[C]);const k=m.length,A=f.useCallback(M=>{S(U=>(M(U)%k+k)%k)},[k]),E=f.useCallback(()=>{S(-1)},[]),j=m[b],I=f.useCallback(()=>{g?.range&&t.delete(g.range.from,g.range.to)},[g,t]),_=({hintToSave:M=j,expectPerfectMatch:U})=>{if(!g||!j||U&&M.name.toLowerCase()!==g.text.toLowerCase())return!1;w.logEvent("System Hint Selected",{system_hint:M.systemHint,conversation_id:a??xn});const q=g.range.from===1?M.name:g.text+M.name.slice(g.text.length),W={clientThreadId:s};vs(t.view),u.size>0&&p();const B=!!M.composerBarButtonInfo,G=M.systemHint===D.Search;return B||G?(l(M.systemHint,!0,W,G?Bu.CONVERSATION_COMPOSER_SLASH_SEARCH:void 0),I(),t.removeSystemHints(),!0):(t.addSystemHint(M.systemHint,q,g.range.from,g.range.to),!0)},L=f.useRef(_);L.current=_;const O=f.useRef(A);O.current=A;const v=f.useRef(g);v.current=g;const z=t.view;return f.useEffect(()=>(C||bl(z,M=>{if(M==="up")O.current(U=>U-1);else if(M==="down")O.current(U=>U+1);else if(M==="cancel")vs(z),vl(z);else if(M==="submit")if(n)I(),n(j.systemHint);else return vs(z),L.current({expectPerfectMatch:!1});else if(M==="checkMatch")return L.current({expectPerfectMatch:!0})}),()=>vs(z)),[C,z,j,n,I]),f.useEffect(()=>{C||w.logEvent("System Hint List Opened",{conversation_id:a??xn})},[C]),{suggestorClosed:C,systemHintSuggestions:m,hintMatch:g,selectedIndex:b,resetSelectedIndex:E,setSelectedIndex:S,saveHint:_}}function Zf({composerController:t,clientThreadId:s}){const{selectedIndex:n,systemHintSuggestions:a,suggestorClosed:o,setSelectedIndex:i,saveHint:r}=Xi({composerController:t,clientThreadId:s});return o?null:e.jsx(tp,{className:"max-w-60",onMouseDown:c=>{c.preventDefault()},children:a.map((c,l)=>e.jsx("div",{onMouseOver:()=>i(l),onClick:()=>{r({hintToSave:c,expectPerfectMatch:!1}),t.focus()},children:e.jsx(sp,{autoFocus:!1,className:"rounded-lg px-1 py-2",$spoofHovered:l===n,children:e.jsx(Zi,{title:c.name,description:c.description,logo:c.logo})})},c.systemHint))})}function Zi({title:t,description:s,logo:n,checked:a,badge:o}){const i=K();return e.jsxs("div",{className:"group inline-flex w-full items-center justify-start gap-2 ps-1.5 pe-3",children:[e.jsx("div",{className:"flex h-7 w-7 items-center justify-center gap-2.5",children:e.jsx(Vn,{svgString:n,className:"icon-lg text-token-text-secondary"})}),e.jsxs("div",{className:"shrink grow basis-0",children:[e.jsxs("p",{className:"text-token-text-primary text-sm leading-tight font-normal",children:[t,o&&e.jsx("span",{className:"ms-2 rounded-full bg-blue-400 px-2 py-0.5 text-xs text-white","aria-label":i.formatMessage({id:"I75WNJ",defaultMessage:"Create image updated"}),children:e.jsx(F,{id:"uUmZQi",defaultMessage:"Updated"})})]}),!!s&&e.jsx("p",{className:"text-token-text-secondary text-[13px] leading-[18px] font-normal",children:s})]}),a&&e.jsx(Ti,{className:N("icon-md text-token-text-primary",{"group-hover:hidden":!a})})]})}function xa({composerController:t,clientThreadId:s}){return t instanceof Bs?e.jsx(Zf,{composerController:t,clientThreadId:s}):null}function er({children:t,className:s,showBackground:n,showGlowingBorder:a}){return e.jsxs("div",{className:N("relative",a&&"overflow-clip rounded-full p-0.5"),children:[t,a&&e.jsx("div",{className:"border-glowing-gradient"}),n&&e.jsx($.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:N("pointer-events-none absolute inset-0 rounded-full",s)})]})}const eg=({showUnconnectedInSubmenu:t,unconnectedConnectors:s,handleOauthRedirect:n,handleConnectorClick:a,showOneDriveInSubmenu:o,isConnectorConfigLoading:i,connectedConnectors:r,desktopConnectors:c,modelSupportedImageMimeTypes:l,showMenuForNoAuth:p,handleLocalFileUploadClick:d,unconnectedOneDriveConnectors:u})=>{const[m,h]=f.useState("main"),g=m!=="main",x=K(),b=f.useRef(null),S=Ze();return f.useEffect(()=>{g?document.getElementById("vanguard-file-picker-popover-submenu-back-button")?.focus():b.current&&b.current.focus()},[g]),e.jsx("div",{className:N("max-h-[max(calc(var(--radix-popover-content-available-height)-64px), 215px)] flex flex-1 snap-y snap-proximity flex-col overflow-y-auto scroll-smooth py-2 [scrollbar-gutter:stable] focus-visible:rounded-[inherit] focus-visible:-outline-offset-1"),ref:b,tabIndex:0,children:e.jsxs(be,{mode:"wait",children:[e.jsx($.div,{className:"flex flex-col",transition:S?ue:gt,children:m==="main"&&e.jsx(tg,{showUnconnectedInSubmenu:t,unconnectedConnectors:s,setActiveMenu:h,handleConnectorClick:a,showOneDriveInSubmenu:o,isConnectorConfigLoading:i,connectedConnectors:r,desktopConnectors:c,modelSupportedImageMimeTypes:l,showMenuForNoAuth:p,handleLocalFileUploadClick:d})},"main"),g&&e.jsxs($.div,{initial:{clipPath:"inset(0 100% 0 0)",opacity:0},animate:{clipPath:"inset(0 0% 0 0)",opacity:1},transition:S?ue:gt,className:"flex flex-col",children:[e.jsxs("div",{className:"border-token-border-xlight bg-token-main-surface-primary dark:bg-token-main-surface-secondary sticky start-0 top-0 z-10 flex w-full flex-row items-center justify-center overflow-clip border-b px-3 py-3",children:[e.jsx("button",{onClick:()=>h("main"),id:"vanguard-file-picker-popover-submenu-back-button",className:"hover:bg-token-main-surface-tertiary flex items-center rounded-md p-1",children:e.jsx(Oa,{className:"text-token-text-secondary h-5 w-5","aria-label":""})}),e.jsx("div",{className:"flex-auto text-center text-sm font-medium",children:x.formatMessage({id:"LlLQYj",defaultMessage:"Back"})}),e.jsx("div",{className:"w-5"})]}),e.jsxs("div",{className:"flex w-full flex-col py-2",children:[m==="connect-apps"&&e.jsx(Iu,{connectorEntries:s,onOauthRedirect:n}),m==="one-drive"&&e.jsx(Du,{connectorEntries:u,onOauthRedirect:n})]})]},m)]})})};function tg({showUnconnectedInSubmenu:t,unconnectedConnectors:s,showOneDriveInSubmenu:n,setActiveMenu:a,handleConnectorClick:o,isConnectorConfigLoading:i,connectedConnectors:r,desktopConnectors:c,modelSupportedImageMimeTypes:l,showMenuForNoAuth:p,handleLocalFileUploadClick:d}){const u=K();return e.jsxs(e.Fragment,{children:[t&&s.length>0&&e.jsx(mt,{label:u.formatMessage(ba.connectApps),icon:qa,isSubMenuTrigger:!0,onClick:()=>a("connect-apps")},"connect-apps-submenu-trigger"),!t&&s.map(m=>e.jsx(Ms,{entry:m,onClick:()=>o(m),visualTreatment:"vanguard"},m.id)),n&&e.jsx(mt,{label:u.formatMessage(ba.oneDriveSubmenuName),icon:Lu,isSubMenuTrigger:!0,onClick:()=>a("one-drive")},"one-drive-submenu-trigger"),i&&e.jsx(mt,{icon:e.jsx(Us,{className:"text-token-text-secondary"})}),(s.length>0||i)&&e.jsx(Ha,{}),r.map(m=>e.jsx(Ms,{entry:m,onClick:()=>o(m),visualTreatment:"vanguard"},m.id)),c.map(m=>e.jsx(Ya,{entry:m,visualTreatment:"vanguard"},m.key)),e.jsx(Ka,{modelSupportedImageMimeTypes:l,visualTreatment:"vanguard"}),e.jsx(Qa,{handleLocalFileUploadClick:d,showMenuForNoAuth:p,visualTreatment:"vanguard"})]})}const ba=Te({connectApps:{id:"ContextConnectorPicker.connectApps",defaultMessage:"Connect apps"},oneDriveSubmenuName:{id:"ContextConnectorPickerOneDriveSubmenu.oneDriveSubmenuName",defaultMessage:"Connect to Microsoft OneDrive"}}),sg=({layoutMode:t,triggerButton:s,restoreFocus:n,...a})=>e.jsxs(Xn,{layoutMode:t,restoreFocus:n,children:[s,e.jsx(Zn,{align:"start",children:e.jsx(eg,{...a})})]});function ng(){const{connectorConfig:t}=Ja(),s=Hn(),n=Un(),[a,o]=Ps(Xa([...t.values()],d=>!!d.access_token),d=>!!d.access_token),[i,r]=Ps(o,d=>d.type===Ke.O365_PERSONAL||d.type===Ke.O365_BUSINESS),c=!s&&!n&&a.length>0,l=!s&&!n&&!c&&i.length>1;return{unconnectedConnectors:n?[]:l?r:o,showUnconnectedInSubmenu:c,showOneDriveInSubmenu:l}}function og({clientThreadId:t,icon:s,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:a,attachmentsProductFeature:o,onOauthRedirect:i,uploadType:r,getInputProps:c,openFileDialog:l,isDisabled:p=!1,highlightTooltip:d=!1,showLabel:u,isSmall:m=!1,hideBorder:h=!1,disabledReason:g,currentModelName:x,visualTreatment:b="vanguard",showMenuForNoAuth:S=!1,showGlowingBorder:C=!1,layoutMode:k="centered",restoreFocus:A}){const E=np().locale,j=K(),I=Dt(),_=On(),{connectorConfig:L,isLoading:O}=Ja(),v=je(ce.ContextConnectors),{getGizmoId:z}=Tn(),{value:M}=ie("58345806"),U=M&&b==="vanguard",[q,W]=f.useState();f.useEffect(()=>{z?z().then(H=>W(H)):W(void 0)},[z]);const B=f.useRef(null),[G,P]=f.useState(!1),Y=f.useRef(!1),re=f.useCallback(()=>{const H=B.current?.files;Array.from(H??[]).forEach(Ce=>zt.uploadFile(_,Ce,a,j,I,o))},[_,a,j,I,o]),[Ae,se]=f.useState(null),Ne=f.useCallback(()=>se(null),[se]),Be=f.useCallback((H,Ce)=>zt.uploadPickedFile(_,H,Ce,a,n,o,q,j,I),[_,a,n,o,q,j,I]),{openMenu:ye,confirmMenuOpened:fe}=Fa();f.useEffect(()=>{ye&&(P(!0),fe())},[ye,fe,P]);const le=f.useCallback(H=>{zt.doContextConnectorOauthRedirect(location.pathname+location.search+location.hash,H,i,ua.Picker),i()},[i]),R=f.useCallback(H=>{zt.uploadPickedFile(_,H,Ke.GDRIVE,a,n,o,q,j,I)},[_,a,n,o,q,j,I]),X=f.useCallback(async H=>{const{access_token:Ce}=H;if(!Ce){le(H);return}switch(zt.logAttemptIfAccessTokenIsExpired(H,ua.Picker),H.type){case Ke.GDRIVE:Fu(E,H.type,Ce,Lt=>Lt.forEach(R));break;case Ke.O365_PERSONAL:case Ke.O365_BUSINESS:se(H.type);break}},[R,le,se,E]),ae=()=>{w.logEvent("Open File Viewer",{intent:r.toString()}),l()},bt=H=>{if(!H&&Y.current&&!O)ae();else if(H&&Z&&!O&&!S){ae();return}P(H),H&&(v.eligible&&v.markAsViewed(),w.logEventWithStatsig("Composer: Open Context Connector Picker","chatgpt_composer_open_context_connector_picker"),Y.current=!0,setTimeout(()=>{Y.current=!1},250))},[ne,st]=Ps(Xa([...L.values()],H=>!!H.access_token),H=>!!H.access_token);ag(ne,X);const[nt]=Ps(st,H=>H.type===Ke.O365_PERSONAL||H.type===Ke.O365_BUSINESS),{unconnectedConnectors:ge,showUnconnectedInSubmenu:Me,showOneDriveInSubmenu:Ie}=ng(),{desktopConnectors:vt}=Ou(a),Z=!ne.length&&!ge.length&&!vt.length,De=e.jsxs(e.Fragment,{children:[Me&&ge.length>0&&e.jsx(Hu,{connectorEntries:ge,onOauthRedirect:H=>le(H)}),!Me&&ge.map(H=>e.jsx(Ms,{entry:H,onClick:()=>X(H)},H.id)),Ie&&e.jsx(Uu,{connectors:nt,onOauthRedirect:le}),O&&e.jsx(Re.Item,{icon:e.jsx(Us,{className:"text-token-text-secondary"})}),(ge.length>0||O)&&e.jsx(Re.Separator,{}),ne.map(H=>e.jsx(Ms,{entry:H,onClick:()=>X(H)},H.id)),vt.map(H=>e.jsx(Ya,{entry:H},H.key)),e.jsx(Ka,{modelSupportedImageMimeTypes:a}),e.jsx(Qa,{handleLocalFileUploadClick:ae,showMenuForNoAuth:S})]}),Ge=U?e.jsx(zi,{clientThreadId:t,icon:s,isDisabled:p,highlightTooltip:d,showLabel:u,hideBorder:h,isSmall:m,disabledReason:g,currentModelName:x,visualTreatment:b,isLoading:O,handleLocalFileUploadClick:ae,noAvailableConnectors:Z,showMenuForNoAuth:S,announcement:v}):e.jsx(pf,{clientThreadId:t,icon:s,setOpen:bt,open:G,isDisabled:p,highlightTooltip:d,showLabel:u,hideBorder:h,isSmall:m,disabledReason:g,currentModelName:x,visualTreatment:b,showGlowingBorder:C}),ze=U?e.jsx(sg,{layoutMode:k,triggerButton:Ge,showUnconnectedInSubmenu:Me,unconnectedConnectors:ge,handleOauthRedirect:le,handleConnectorClick:X,showOneDriveInSubmenu:Ie,isConnectorConfigLoading:O,connectedConnectors:ne,desktopConnectors:vt,modelSupportedImageMimeTypes:a,showMenuForNoAuth:S,handleLocalFileUploadClick:ae,unconnectedOneDriveConnectors:nt,restoreFocus:A}):e.jsxs(Re.Root,{open:G,onOpenChange:bt,children:[Ge,e.jsx(Re.Portal,{children:e.jsx(Re.Content,{alignOffset:-16,side:"top",children:De})})]}),St=e.jsxs("div",{className:"flex flex-col",children:[e.jsx(Gu,{type:Ae,onClose:Ne,uploadPickedFile:Be}),e.jsx("input",{onChange:re,...c({className:"hidden"})}),ze,e.jsx(zu,{hasConnectors:!O&&!Z})]});return{dropdownItems:De,mainComponent:St}}function ag(t,s){const{connector:n,clearParam:a}=Wu(),o=t.find(i=>i.type===n&&!!i.access_token);f.useEffect(()=>{o&&(s(o),a())},[o,s,a])}function tr(t){const{mainComponent:s}=og(t);return s}function ig({clientThreadId:t,uploadType:s,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:a,attachmentsProductFeature:o,getInputProps:i,openFileDialog:r,onOauthRedirect:c,historyDisabled:l,isDisabled:p,highlightTooltip:d,disabledReason:u,currentModelName:m,showLabel:h,showUpsell:g,hideBorder:x,isSmall:b,showMenuForNoAuth:S,visualTreatment:C,showGlowingBorder:k}){const A=Un(),{gdriveStatus:E,o365Status:j}=Za(),{isUnauthenticated:I}=Se(),_="h-[18px] w-[18px]",L=l?"text-white":d?"text-brand-blue-800":"",v=!g&&(S||E!=="false"||j!=="false"||A)?e.jsx(tr,{showGlowingBorder:k,hideBorder:x,isSmall:b,clientThreadId:t,icon:I?e.jsx(Rs,{"aria-label":"",className:N(_,L)}):e.jsx(Na,{"aria-label":"",className:N(_,L)}),showLabel:I&&h,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:a,attachmentsProductFeature:o,onOauthRedirect:c,uploadType:s,openFileDialog:r,getInputProps:i,isDisabled:p,highlightTooltip:d,disabledReason:u,currentModelName:m,showMenuForNoAuth:S,visualTreatment:C}):e.jsx(Qi,{isSmall:b,hideBorder:x,clientThreadId:t,uploadType:s,openFileDialog:r,getInputProps:i,showLabel:h,showUpsell:g,icon:e.jsx(Rs,{"aria-label":"",className:N(_,L)}),isDisabled:p,highlightTooltip:d,disabledReason:u,currentModelName:m});return e.jsx("div",{className:"relative",children:e.jsx(er,{showBackground:d,showGlowingBorder:k,className:"bg-brand-blue-800/20",children:v})})}function sr({suggestionData:t,visualTreatment:s,composerController:n}){const a=K(),i=a.formatMessage(oe.researchSuggestionInitial),r=f.useMemo(()=>[a.formatMessage(oe.deepResearchPlaceholderBullet1),a.formatMessage(oe.deepResearchPlaceholderBullet2),a.formatMessage(oe.deepResearchPlaceholderBullet3)],[a]);return e.jsx(Vu,{composerController:n,visualTreatment:s,initialSuggestion:i,bulletPoints:r})}const Tt={type:"spring",stiffness:48.7,damping:13.54,mass:1};function rg({enabled:t,children:s,...n}){const a=Ze();return e.jsxs($.div,{initial:{minHeight:0},animate:{minHeight:t?"142px":0},exit:{minHeight:0},transition:a?ue:Tt,className:"flex flex-col justify-start",children:[s,t&&e.jsx(sr,{...n})]})}const lg=({items:t,searchTerm:s,setSearchTerm:n,selectedItems:a,searchPlaceholder:o,handleSelectItem:i,showConfigureRepos:r,showSelectAllRepos:c,loading:l})=>{const p=$u(),d=a?.includes("$all_accessible_repos");return e.jsx($.div,{variants:p,initial:"initial",animate:"animate",exit:"exit",className:"relative",children:e.jsxs("div",{className:"border-token-border-default bg-token-main-surface-primary flex max-h-60 w-full flex-col gap-2 overflow-y-auto rounded-lg border p-2",children:[e.jsx("input",{type:"text",value:s,onChange:u=>n(u.target.value),placeholder:o,className:"text-token-text-primary bg-token-main-surface-primary w-full rounded-sm border-none px-2 py-1 text-sm focus:ring-0 focus:ring-offset-0 focus:outline-hidden"}),l&&e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(Us,{})}),t?.map(u=>{const m=a?.includes(u.name);return e.jsx(mt,{onClick:()=>{i(u)},isSelected:m,isActive:m,label:u.name,subtitle:u.description??void 0,className:"mx-0! w-full"},u.name)}),c&&e.jsx(mt,{onClick:()=>{i({name:"$all_accessible_repos"})},className:"mx-0! w-full",isSelected:d,isActive:d,label:e.jsx(F,{id:"pJnTxe",defaultMessage:"All Repositories"}),subtitle:e.jsx(F,{id:"EhTGqu",defaultMessage:"Select all repositories accessible to ChatGPT"})},"select-all-repos"),r&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-token-border-primary border-token-border-default mt-2 mb-2 border-b"}),e.jsx(mt,{onClick:()=>{window.open(qu,"_blank")},isSelected:!1,isActive:!1,label:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Yu,{className:"icon-sm"}),e.jsx(F,{id:"8W+hV0",defaultMessage:"Configure Repos"})]}),subtitle:e.jsx(F,{id:"GXUcp/",defaultMessage:"Configure which repositories ChatGPT can access"}),className:"mx-0! w-full"},"configure-repos")]})]})})};function cg(t,s){const[n,a]=f.useState(t),o=f.useRef(_s(i=>a(i),s));return f.useEffect(()=>(o.current=_s(i=>{a(i)},s),()=>{o.current?.cancel()}),[s]),f.useEffect(()=>{o.current?.(t)},[t]),n}const ug=({searchTerm:t,setSearchTerm:s,selectedRepos:n,handleSelectRepo:a,setRepoSelectorOpen:o,allowMultiSelect:i,linkId:r,showConfigureRepos:c=!1})=>{const l=Dt(),p=K(),d=cg(t,300),{data:u,isFetching:m,isFetchingNextPage:h,isError:g}=fl({queryKey:["github-repos",d,r],queryFn:async({pageParam:S=null})=>await Pi.safePost("/aip/connectors/github/search_repos",{requestBody:{query:d,limit:20,next_token:S,link_id:r}}),enabled:!!d,getNextPageParam:S=>S.next_token??void 0,initialPageParam:null});f.useEffect(()=>{g&&l.danger("Request error fetching Github repositories")},[g,l]);let x=u&&d?u.pages.flatMap(S=>S.repos).flatMap(S=>S.repository_full_name):[];x=Array.from(new Set([...x,...n.selectedRepos??[]]));const b=S=>{a(S.name,S.name==="$all_accessible_repos"),i||o(!1)};return e.jsx("div",{children:e.jsx(lg,{showConfigureRepos:c,items:x?.map(S=>({name:S}))??[],searchTerm:t,setSearchTerm:s,selectedItems:[...n.selectedRepos??[],...n.selectedAllRepos?["$all_accessible_repos"]:[]],searchPlaceholder:p.formatMessage({id:"lo7uaF",defaultMessage:"Search repos"}),handleSelectItem:b,showSelectAllRepos:!0,loading:m||h})})};function dg({clientThreadId:t,selected:s,isVanguard:n,onToggle:a,repoSelectorOpen:o,setRepoSelectorOpen:i,linkId:r}){const{selectedRepos:c,setSelectedRepos:l}=Gn(t),p=K(),[d,u]=f.useState(""),{triggerRef:m,container:h}=op({isOpen:o,onClose:()=>i(!1)}),g=(b,S)=>{if(S)l({selectedRepos:[],selectedAllRepos:!c?.selectedAllRepos});else if(c?.selectedRepos?.includes(b)){const C=c.selectedRepos?.filter(k=>k!==b);l({selectedRepos:C,selectedAllRepos:!1})}else{const C=[...c?.selectedRepos??[],b];l({selectedRepos:C,selectedAllRepos:!1})}};let x=e.jsx(F,{id:"eC2vew",defaultMessage:"GitHub"});return c?.selectedAllRepos?x=e.jsx(F,{id:"scEauJ",defaultMessage:"All Repositories"}):c?.selectedRepos?.length&&c?.selectedRepos?.length>=1&&(x=c?.selectedRepos?.join(", ")),e.jsx(Yt,{open:o,onOpenChange:i,children:e.jsx(Fs,{children:e.jsxs("div",{className:N("inline-flex min-h-8 items-center rounded-full text-sm font-medium transition-colors focus:outline-hidden",s?"border-token-border-default bg-token-main-surface-primary border":n?"text-token-text-secondary":"text-token-text-tertiary",n?"":"border-token-border-default border"),children:[e.jsxs("button",{type:"button","aria-pressed":s,onClick:b=>{b.stopPropagation(),b.preventDefault(),a()},className:"flex items-center gap-1 px-2 py-1",children:[e.jsx(Ku,{"aria-hidden":!0,className:N("h-4 w-4 transition-colors",s?"bg-token-main-surface-primary":"grayscale filter")}),e.jsx("span",{children:x}),s&&e.jsx(qn,{className:"text-token-text-tertiary h-4 w-4"})]}),s&&e.jsx(ft,{asChild:!0,ref:m,children:e.jsx("button",{type:"button","aria-label":p.formatMessage({id:"eoO5dY",defaultMessage:"Select repository"}),className:"border-token-border-default border-s p-1",onClick:()=>{i(!o)},children:e.jsx(Qu,{className:"h-3 w-3"})})}),o&&r&&e.jsx(Kt,{forceMount:!0,container:h,children:e.jsx(Qt,{side:"bottom",align:"start",children:e.jsx(ug,{searchTerm:d,setSearchTerm:u,selectedRepos:{selectedRepos:c.selectedRepos?[...c.selectedRepos]:[],selectedAllRepos:c.selectedAllRepos},handleSelectRepo:g,setRepoSelectorOpen:i,allowMultiSelect:!0,showConfigureRepos:!0,linkId:r})})})]})})})}function so(){const t=Ju().has(D.Research),s=ie("3544641259")?.value;return t&&s}function va({label:t,selected:s,onClick:n,Icon:a,isVanguard:o,iconColor:i}){return e.jsxs("button",{type:"button","aria-pressed":s,onClick:r=>{r.stopPropagation(),r.preventDefault(),n()},className:N("flex min-h-8 items-center gap-1 rounded-full px-2 py-1 text-sm font-medium transition-colors",s?"border-token-border-default bg-token-main-surface-primary border":o?"text-token-text-secondary":"text-token-text-tertiary",o?"":"border-token-border-default border"),children:[e.jsx(a,{"aria-hidden":!0,className:N("h-4 w-4 transition-colors",s?"bg-token-main-surface-primary":"grayscale filter",i||"text-token-text-primary")}),e.jsx("span",{children:t}),s&&e.jsx(qn,{className:"text-token-text-tertiary h-4 w-4"})]})}const nr=({clientThreadId:t,isVanguard:s=!1})=>{const{selectedSources:n,toggleSource:a,deleteSource:o}=ei(t),[i,r]=f.useState(!1),{selectedRepos:c}=Gn(t),{isGdriveActionConnectorEnabled:l,isGitHubLinkEnabled:p}=Xu(),{connectorLinks:d}=Zu(),u=d.get(Jo[da.GDRIVE_ACTION_CONNECTOR]),m=d.get(Jo[da.GITHUB_CONNECTOR]),h=!!u,g=!!m,x=b=>{window.location.assign(`#settings/ConnectorSettings${b?`?scroll=${b}`:""}`)};return f.useEffect(()=>{!i&&!c?.selectedRepos?.length&&!c?.selectedAllRepos&&o(it.GitHub)},[t,n,i,c,o]),!t||!n?null:e.jsxs("div",{children:[e.jsx("div",{className:"border-token-border-xlight absolute inset-x-[15px] top-0 h-0 border-t"}),e.jsx("div",{className:N("z-0 w-full p-3","bg-token-main-surface-primary dark:bg-[#303030]"),children:e.jsxs("div",{className:"flex items-center gap-4",children:[!s&&e.jsx("span",{className:"text-token-text-primary text-sm font-medium",children:e.jsx(F,{id:"dyMo44",defaultMessage:"Sources"})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(va,{label:e.jsx(F,{id:"G03bJa",defaultMessage:"Web"}),selected:n.has(it.Web),onClick:()=>a(it.Web),Icon:ed,iconColor:"text-blue-400",isVanguard:s}),p&&e.jsx(dg,{clientThreadId:t,selected:n.has(it.GitHub)&&g,onToggle:()=>{g?(!c?.selectedRepos?.length&&!c?.selectedAllRepos&&r(!0),a(it.GitHub)):x("github-connector")},repoSelectorOpen:i,setRepoSelectorOpen:r,isVanguard:s,linkId:m?.id}),l&&e.jsx(va,{label:e.jsx(F,{id:"m4j0Bv",defaultMessage:"Drive"}),selected:n.has(it.GoogleDrive)&&h,onClick:()=>h?a(it.GoogleDrive):x("gdrive-connector"),Icon:ti,isVanguard:s})]})]})})]})};function mg(){const t=Ze(),a={initial:{opacity:0,y:"-28px",rotate:45},animate:{opacity:1,y:0,rotate:45,transition:t?ue:{opacity:{delay:.4},default:Tt}},exit:{opacity:0,y:"-28px",rotate:45,transition:t?ue:{opacity:{delay:0},default:Tt}}};return e.jsx($.div,{variants:a,initial:"initial",animate:"animate",exit:"exit",className:"border-token-border-xlight bg-token-main-surface-primary absolute start-1/2 top-full mt-[11px] h-2 w-2 -translate-x-1/2 transform rounded-se-[1px] rounded-es-[1px] border-s border-t dark:bg-[#303030]"})}const no=.0025;function oo({composerController:t,composerType:s,renderInComposer:n,composerRightButtonType:a,layoutMode:o}){const i=ut(t.store,b=>b.controlsDisabled),r=Nt(),{isUnauthenticated:c}=Se(),l=s==="vanguard"&&r&&!c,p=td(b=>{b.contentRect&&t.setWaveWidth(b.contentRect.width)}),d=f.useCallback(b=>{if(!(t instanceof Bs))return;const S=t.getSelectionStart();t.setControlsDisabled(!1),requestAnimationFrame(()=>{const{state:C,dispatch:k}=t.view;k(C.tr.insertText(b,S,S)),requestAnimationFrame(()=>{t.setSelection(S+b.length)}),t.usedDictation=!0})},[t]),u=()=>{t.setControlsDisabled(!0)},m=e.jsx(Xo,{size:"small",onExit:u,buttonClassName:s==="vanguard"?"h-7 min-h-7 w-7 min-w-7":"h-9 min-h-9 w-9 min-w-9",invertColor:l,disableTooltip:l}),h=b=>{b.preventDefault(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{t.focus()})})};let g;if(l)if(a===sd.SPEECH){const b=ap.getBooleanCookie(ip.LastVoiceInteraction)??!1,S=C=>b?e.jsx(e.Fragment,{children:n?.(l,C)}):e.jsx(Xo,{...C,size:"small",onExit:u,buttonClassName:s==="vanguard"?"h-7 min-h-7 w-7 min-w-7":"h-9 min-h-9 w-9 min-w-9",invertColor:!0,disableTooltip:!0});g=e.jsx(od,{layoutMode:o??"centered",onDictationExit:u,renderVoiceButton:S,restoreFocus:h})}else g=e.jsx(e.Fragment,{children:n?.()});else g=e.jsxs(e.Fragment,{children:[m,n?.()]});return{whisperControls:i?e.jsx(nd,{initialValue:no,onSuccess:d,onWaveformDataUpdate:t.setWaveformData,onExit:()=>{t.setControlsDisabled(!1)},buttonClassName:s==="vanguard"?"h-7 min-h-7 w-7 min-w-7":"h-9 min-h-9 w-9 min-w-9"}):g,waveContainerRef:p,handleTranscriptionSuccess:d}}const or=({composerController:t,placeholder:s,vanguard:n})=>{const a=f.useRef(null),o=f.useRef(null),{isMobileOS:i}=ad(),r=f.useRef(!1);return f.useEffect(()=>{if(r.current)return;if(!(t instanceof Bs))throw new Error(`Expected instance of ProseMirrorComposerController but got ${t.constructor.name}`);r.current=!0;const c=o.current;if(c!=null){const{value:l,selectionStart:p,selectionEnd:d}=c;t.view.dispatch(t.view.state.tr.insertText(l)),t.view.dispatch(t.view.state.tr.setSelection(Ip.create(t.view.state.doc,p+1,d+1))),c.style.display="none",c.value=""}a.current.appendChild(t.view.dom),t.view.dom.id=id,t.view.dom.dataset.virtualkeyboard="true",rd(t.view.dom),!si()&&!rp()&&requestAnimationFrame(()=>{t.view.focus()})},[t]),f.useEffect(()=>{t.setPlaceholder(s)},[s,t]),f.useEffect(()=>{t.logPageMount()},[]),e.jsxs("div",{ref:a,onKeyDown:ld.prefetch,className:N([cd["prosemirror-parent"],"text-token-text-primary","max-h-[25dvh]","max-h-52","overflow-auto [scrollbar-width:thin]",lp()?"firefox":"default-browser"],n&&"min-h-12 pe-3"),children:[e.jsx("textarea",{className:N("text-token-text-primary placeholder:text-token-text-tertiary block h-10 w-full resize-none border-0 bg-transparent px-0 py-2 ring-0 placeholder:ps-px"),autoFocus:!i,placeholder:s,ref:o,"data-virtualkeyboard":!0}),e.jsx(ud,{scriptSrc:"window.__oai_logHTML?window.__oai_logHTML():window.__oai_SSR_HTML=window.__oai_SSR_HTML||Date.now();requestAnimationFrame((function(){window.__oai_logTTI?window.__oai_logTTI():window.__oai_SSR_TTI=window.__oai_SSR_TTI||Date.now()}))"})]})},pg=f.forwardRef(function({type:s,placeholder:n,replyRegions:a,state:o,renderFiles:i,leftSideActions:r,topRightAction:c,onSubmit:l,setIsComposerOverflowing:p,inputState:d,composerController:u,clientThreadId:m,gizmoId:h,disableReason:g,matchaData:x},b){const S=dd();let C=null;const{isLoading:k}=S;k||(C=S.modelId),f.useEffect(()=>{k||si()||u.focus()},[C,u,k]);const{value:A}=ie("3780975974"),{state:E,shouldShowResearchText:j}=Hs(m),I=f.useCallback(()=>e.jsx(ni,{useStartButtonText:E==="clarify"||!1,inputState:d,state:o,onSubmit:l,composerController:u,clientThreadId:m,gizmoId:h,disableReason:g}),[d,o,l,u,m,h,g,x,E]),{whisperControls:_,waveContainerRef:L}=oo({composerController:u,renderInComposer:I,composerType:"legacy"}),{controlsDisabled:O,waveformData:v,waveWidth:z}=ut(u.store),{getShowUpsellReason:M}=oi(),U=A||M(),q=B=>{fg({target:B.target,rootId:"composer-background",additonalInteractiveIds:["reply-regions"]})||u.focus()},W=so();return e.jsxs(ai,{id:"composer-background",ref:b,className:N("border-token-border-default flex w-full cursor-text flex-col overflow-clip rounded-t-3xl border-t duration-150 ease-in-out contain-inline-size motion-safe:transition-[color,background-color,border-color,text-decoration-color,fill,stroke,box-shadow,bottom] dark:border-none dark:shadow-none",s!=="temporary"&&"shadow-[0_9px_9px_0px_rgba(0,0,0,0.01),_0_2px_5px_0px_rgba(0,0,0,0.06)] has-focus:shadow-[0_2px_12px_0px_rgba(0,0,0,0.04),0_9px_9px_0px_rgba(0,0,0,0.01),0_2px_5px_0px_rgba(0,0,0,0.06)]",s!=="temporary"&&"bg-token-main-surface-primary dark:bg-[#303030]",s==="temporary"&&"dark bg-[#303030]","rounded-b-3xl border-b"),onClick:q,style:{viewTransitionName:"var(--vt-composer)"},children:[e.jsxs("div",{className:"px-3 py-1",children:[e.jsx(be,{initial:!1,children:a.length>0&&e.jsx($.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0,transition:{duration:.06}},transition:{ease:"easeOut",duration:.1},id:"reply-regions",children:e.jsx("div",{className:"-mx-2",children:e.jsx(ii,{replyRegions:a})})})}),e.jsxs(e.Fragment,{children:[i,e.jsx(be,{initial:!1,children:e.jsx(rg,{enabled:j,composerController:u,visualTreatment:"legacy",children:e.jsxs("div",{id:"composer-waveform-container",className:"flex min-h-[44px] items-start ps-1",ref:L,children:[e.jsx("div",{className:"max-w-full min-w-0 flex-1",children:O?v?e.jsx(ri,{waveform:v,containerWidth:z,scaleFactor:10,initialValue:no}):null:e.jsx(or,{composerController:u,placeholder:n})}),e.jsx("div",{className:"w-[32px] pt-1",children:c})]})})}),e.jsxs("div",{className:"mt-1 mb-2 flex items-center justify-between sm:mt-5",ref:B=>{if(!U||!("ResizeObserver"in window))return;let G=new AbortController,P=window.innerWidth;const Y=gn({axis:"width",debounce:!0,target:B,onChange:()=>{if(!B)return;B.scrollWidth>B.clientWidth?p?.(!0):Math.abs(P-window.innerWidth)>40&&(p?.(!1),P=window.innerWidth)}});return()=>{Y?.(),G.abort()}},children:[e.jsx("div",{className:"text-token-text-primary flex gap-x-1.5",id:"composer-left-actions",children:r}),e.jsx("div",{className:"flex gap-x-1.5",id:"composer-voice-controls",children:_})]})]})]}),e.jsx(be,{children:W&&e.jsx(nr,{clientThreadId:m})})]})});function fg({target:t,rootId:s,additonalInteractiveIds:n}){let a=t;for(;a&&a!=null;){if(a.tagName==="BUTTON"||a.tagName==="INPUT"||a.tagName==="TEXTAREA"||a.isContentEditable||n.includes(a.id))return!0;if(a.id===s)return!1;a=a.parentElement}return!1}const gg=["o3-mini","o3-mini-high","o1-pro"],hg=[D.Search,D.Research],xg=({composerController:t,clientThreadId:s,hideThinkButton:n,disableIfNoAccess:a})=>{const{prospectiveModelId:o}=Xt(s),{activeSystemHints:i,isLoading:r}=Is(s),c=ie("2868048419"),l=pe(A=>A.isVisuallyOverflowing),{showLegacyReasoningSlider:p,hideSearchInSystemHintOverflow:d,hideReasonInSystemHintOverflow:u}=xt(),m=i.filter(A=>d&&A.systemHint===D.Search||u&&A.systemHint===D.Think?!0:l&&p?A.systemHint!==D.Think&&!A.composerBarButtonInfo&&!hg.includes(A.systemHint):!A.composerBarButtonInfo&&A.systemHint!==D.Search&&(!c||A.systemHint!==D.PictureV2)&&(!n||A.systemHint!==D.Think)),h=Wa(t),g=Ra(t,s),x=o&&gg.includes(o),b=m.length===0&&!r||x;if(!a&&b)return null;const S={clientThreadId:s};function C(){w.logEventWithStatsig("Composer System Hint Button Hovered","composer_system_hint_button_hovered",S)}function k(){w.logEventWithStatsig("Composer System Hint Button Clicked","composer_system_hint_button_clicked",S)}return e.jsx(bg,{systemHints:m,selectedHint:h,disabled:!!b,onHover:C,onOpen:k,onSelect:g})},bg=({systemHints:t,selectedHint:s,disabled:n,onHover:a,onOpen:o,onSelect:i})=>{const r=K(),[c,l]=f.useState(!1),p=t.find(u=>u.systemHint==="contextual_answers")?.name,d=t.length===0?e.jsxs("div",{className:"mx-2 flex min-h-[40px] flex-col justify-center gap-2",children:[e.jsx("div",{className:"loading-results-shimmer bg-token-main-surface-secondary h-9 w-full rounded-md"}),e.jsx("div",{className:"loading-results-shimmer bg-token-main-surface-secondary h-9 w-full rounded-md"})]}):e.jsx(e.Fragment,{children:t.map(u=>e.jsx(Re.Item,{className:"px-1 py-2",onClick:()=>i?.({hint:u,enable:u.systemHint!==s}),children:e.jsx(Zi,{title:u.name,description:u.description,logo:u.logo,checked:u.systemHint===s,badge:u.systemHint===D.PictureV2})},u.systemHint))});return e.jsxs(Re.Root,{open:c,onOpenChange:u=>{l(u),u&&o?.()},children:[e.jsx(vg,{disabled:!!n,contextualAnswersHintNameIfPresent:p,children:e.jsx(cp,{className:N(md.toolsButton,"border-token-border-default text-token-text-secondary radix-state-open:bg-black/10 can-hover:hover:bg-token-main-surface-secondary flex h-9 min-w-9 items-center justify-center rounded-full border p-1 text-xs font-semibold focus-visible:outline-black disabled:opacity-30 dark:focus-visible:outline-white"),"data-opened":Sg(c),"aria-label":r.formatMessage({id:"oDAnGy",defaultMessage:"Use a tool"}),disabled:n,onPointerOver:a,onClick:u=>{u.preventDefault()},onFocusCapture:u=>{u.stopPropagation()},children:e.jsx(pd,{className:"pointer-events-none h-5 w-5"})})}),e.jsx(Re.Portal,{children:e.jsx(Re.Content,{alignOffset:-16,onCloseAutoFocus:u=>{u.preventDefault()},children:d})})]})},vg=({disabled:t,children:s,contextualAnswersHintNameIfPresent:n})=>{const a=je(ce.hasSeenComposerSystemHintButtonTooltip),o=je(ce.hasSeenCaSystemHint),i=!t&&!a.isLoading&&a.eligible,r=!t&&!a.isLoading&&n&&!o.isLoading&&o.eligible,c=i?{announcementKey:ce.hasSeenComposerSystemHintButtonTooltip,title:e.jsx(F,{id:"tTydhk",defaultMessage:"All your tools, in one handy place"}),onDismiss:a.markAsViewed,description:e.jsx(F,{id:"S+BFNe",defaultMessage:"Create a canvas, generate a picture, and more."})}:r?{announcementKey:ce.hasSeenCaSystemHint,title:e.jsx(F,{id:"uaC1JM",defaultMessage:"Not finding internal information?"}),onDismiss:o.markAsViewed,description:e.jsx(F,{id:"TL/S+W",defaultMessage:"If ChatGPT didn't search your files automatically, type {hintName} or select it from the menu.",values:{hintName:e.jsx("span",{className:"font-bold whitespace-nowrap",children:'"/'+n+'"'})}})}:void 0;return c?e.jsx(Pn,{show:!0,side:"bottom",theme:"bright",dismissOnOutsideClick:!0,badge:"new",sideOffset:0,className:"xs:max-w-sm! max-w-2xs!",...c,children:s}):e.jsx(tt,{side:"top",sideOffset:0,label:t?e.jsx(F,{id:"uw9x80",defaultMessage:"Tools unavailable"}):e.jsx(F,{id:"mrYNGk",defaultMessage:"View tools"}),children:s})};function Sg(t){return t?"":null}const yg=({clientThreadId:t})=>{const{setThreadSystemHintMode:s}=ve(),n=window.location.search;f.useEffect(()=>{if(new URLSearchParams(window.location.search).get("enable-internal-knowledge")==="true"&&document){s(D.ContextualAnswers,!0,{clientThreadId:t});const o=new URLSearchParams(window.location.search);o.delete("enable-internal-knowledge");const i=o.toString();window.history.replaceState({},document.title,`${window.location.pathname}${i?`?${i}`:""}`)}},[n,t,s])},Cg=({connectionStatuses:t,clientThreadId:s})=>{const{eligible:n,markAsViewed:a}=je(ce.hasSeenContextualAnswerGoogleSyncFinished),o=K(),{setThreadSystemHintMode:i}=ve(),r=vd(t),c=Sd({exposed:r&&n})==="notification",l=f.useRef(!1);f.useEffect(()=>{n&&c&&r&&!l.current&&(w.logEvent("Contextual Answers User Fully Synced Notification"),yd({id:"contextual-answers-sync-done",title:e.jsxs("span",{className:"flex items-center justify-between",children:[o.formatMessage({id:"GkdUMV",defaultMessage:"Google Drive is ready to search"}),e.jsx(Ti,{className:"icon-md text-black"})]}),subtitle:e.jsx(Oe,{className:"text-caption-regular mt-1 rounded-xs",color:"secondary",size:"xs",children:e.jsx(F,{id:"Y8PQkV",defaultMessage:"Try now"})}),clientThreadId:"WEB:",icon:ti,onClick:()=>{i(D.ContextualAnswers,!0,{clientThreadId:s})},timeout:60*1e3}),l.current=!0,a())},[c,s,n,r,o,a,i])},kg=({composerController:t,systemHint:s,clientThreadId:n,connectionStatuses:a})=>{const o=Nt(),i=s.systemHint,r=Bt(i);if(Cg({connectionStatuses:a,clientThreadId:n}),yg({clientThreadId:n}),!s.composerBarButtonInfo)return null;const c=a.some(l=>l.user_connection_details.activation_status==="partially_activated"||l.user_connection_details.activation_status==="activated");return e.jsx(Yp,{composerController:t,systemHint:s,composerBarButtonInfo:s.composerBarButtonInfo,clientThreadId:n,isDisabled:!1,showLabel:o,dropdownContent:c?void 0:e.jsx(Sa,{}),splitButtonDropdownContent:c&&r?e.jsx(Sa,{}):void 0,dataTestid:fd,tooltipPosition:"top",disableNuxMarkdown:!0})},Sa=()=>{const{connectionInstanceData:t,isLoading:s}=li(),n=f.useMemo(()=>[...t?.connection_statuses??[]].sort(gd),[t]),a=n.some(o=>o.user_connection_details.activation_status==="activating"||o.user_connection_details.activation_status==="partially_activated"||o.user_connection_details.activation_status==="inactive"&&o.user_connection_details.auth_status==="user_connected");return f.useEffect(()=>{w.logEventWithStatsig("Contextual Answers User Composer Dropdown Shown","chatgpt_contextual_answers_user_composer_dropdown_shown")},[]),s?e.jsx("div",{className:"w-full max-w-[calc(100vw-1.5rem)] min-w-[calc(100vw-1.5rem)] p-3 md:min-w-[22rem]",children:e.jsx(Dp,{lines:4,size:"lg"})}):e.jsx(be,{children:e.jsxs("div",{className:"w-full max-w-[calc(100vw-1.5rem)] min-w-[calc(100vw-1.5rem)] p-3 md:min-w-[22rem]",children:[e.jsx("div",{className:"text-token-text-tertiary px-2 py-2 text-sm font-medium",children:e.jsx(F,{id:"gkeRrW",defaultMessage:"Internal knowledge"})}),n.map(o=>e.jsx("div",{className:"px-2 py-3",children:e.jsx(hd,{title:o.connection_display_info.display_name,description:xd({activationStatus:o.user_connection_details.activation_status,authStatus:o.user_connection_details.auth_status}),icon:e.jsx("img",{src:o.connection_display_info.icon_url??"",alt:o.connection_display_info.display_name,className:"icon-lg"}),statusIndicator:e.jsx(bd,{connection:o})})},o.user_connection_details.connection_instance_id)),e.jsx("div",{className:"border-token-border-primary border-token-border-default mt-2 mb-2 border-b"}),e.jsx(Oe,{color:"ghost",className:"w-full rounded-xl px-2 py-3",contentsFullWidth:!0,as:"link",to:"#settings/ConnectorSettings",children:e.jsxs("div",{className:"flex w-full flex-row items-center justify-start gap-4 text-start",children:[e.jsx("div",{className:"icon-lg",children:e.jsx(qa,{})}),e.jsx("p",{className:"text-token-text-primary flex-1 text-sm font-medium",children:a?e.jsx(F,{id:"EqgQdy",defaultMessage:"See syncing state"}):e.jsx(F,{id:"05N3nu",defaultMessage:"Manage connectors"})})]})})]})})},wg=({onRemoveThink:t})=>{const s=K();return e.jsxs(Wi,{as:"div",role:"button",onClick:n=>{n.stopPropagation(),n.preventDefault(),t()},tabIndex:0,spacing:"compact",isSelected:!0,isLegacyStyle:!0,borderVisible:!0,children:[e.jsx(Ia,{className:"icon-md text-token-interactive-label-accent-default flex-1","aria-label":""}),e.jsx("span",{children:s.formatMessage({id:"8y4FP9",defaultMessage:"Think"})}),e.jsx(ci,{"data-remove-think-button":!0,className:"-me-1","aria-label":s.formatMessage({id:"AD7lkL",defaultMessage:"Disable reasoning mode"})})]})},ya=48,Ca=32,jg="/c/:conversationId",_g=({isNewThread:t,clientThreadId:s,isTemporaryChat:n,placeholder:a,composerController:o,children:i,isExpandedByDefault:r=!1,onSubmit:c})=>{let l=null,p=null,d=[],u=[],m=null,h=[],g=null;f.Children.forEach(i,R=>{if(f.isValidElement(R))if(R.type===Rg){if(m!=null)throw new Error("PromptTextareaComposer only accepts a single app stack");m=R}else if(R.type===ar){if(l!=null)throw new Error("PromptTextareaComposer only accepts a single submit button");l=R}else if(R.type===Eg){if(p!=null)throw new Error("PromptTextareaComposer only accepts a single header action");p=R}else R.type===Cn||R.type===ir?d.push(R):R.type===rr?u.push(R):R.type===kn?h.push(R):R.type===lr&&(g=R)});const{shouldShowResearchText:x}=Hs(s),b=Bt(D.ContextualAnswers)&&!!t,S=!1,C=Cd(),k=ui({exposed:b})==="bigbox",A=C&&(x||S)||k&&b,E=f.useRef(null),j=f.useRef(null),{waveContainerRef:I}=oo({composerController:o,composerType:"vanguard"}),{controlsDisabled:_,waveformData:L,waveWidth:O}=ut(o.store),v=pe(R=>R.isExpanded),z=pe(R=>R.setIsExpanded),M=f.useRef(!1),U=Ze(),q=f.useSyncExternalStore(R=>{const X=o.subscribe("focus",R),ae=o.subscribe("blur",R);return()=>{ae(),X()}},()=>o.isFocused(),()=>!1),W=R=>{if(R.target instanceof HTMLElement){if(R.target.dataset.historyItemLink||R.target.parentElement?.dataset.historyItemLink)return!0;const X=R.target?.closest("a[href]");if(X instanceof HTMLAnchorElement)return!!gl({path:jg,end:!1},new URL(X.href).pathname)}return!1};f.useEffect(()=>{if(!M.current)return o.subscribe("input",()=>{M.current=!0})},[o]),f.useEffect(()=>{r&&z(!0),q&&!v&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{z(!0)})})},[q,v,r,z]);const B=pe(R=>R.isVisuallyOverflowing),G=f.useRef(B);Ts(()=>{G.current=B},[B]);const P=pe(R=>R.setIsVisuallyOverflowing),Y=f.useRef(null),re=R=>{const X=ae=>{r||M.current||R?.contains(ae.target)||W(ae)||z(!1)};return document.addEventListener("click",X),Y.current=R,()=>{document.removeEventListener("click",X)}},Ae=R=>{R.preventDefault(),c(R)},se=d.length>0,Ne=u.length>0,[Be,ye]=f.useState(0),fe=24,{showLegacyReasoningSlider:le}=xt();return e.jsxs("form",{ref:re,className:"w-full [view-transition-name:var(--vt-composer)]",onSubmit:Ae,"data-type":"unified-composer",onClick:()=>{o.focus()},children:[e.jsxs(Mg,{isTemporaryChat:n,clientThreadId:s,isNewThread:!!t,children:[e.jsxs($.div,{transition:U?ue:Cs,className:"relative flex w-full flex-auto flex-col",children:[h.length>0&&e.jsx("div",{className:"mb-4 flex flex-col gap-2",children:h}),e.jsxs("div",{className:"relative ms-1.5 grid grid-cols-[auto_minmax(0,1fr)]",children:[e.jsx("div",{className:"items-top flex justify-center",children:e.jsx($.div,{initial:{opacity:v?1:0},animate:{opacity:v?1:0},exit:{opacity:0},transition:U?ue:gt,children:p})}),e.jsx($.div,{initial:{marginBottom:-20,translateX:v?0:Ca},onPointerDown:R=>R.stopPropagation(),animate:{translateX:v?0:Ca},style:{translateY:-7},transition:U?ue:Cs,className:"relative flex-auto bg-transparent ps-2 pt-0.5",children:e.jsxs(Ag,{composerController:o,enabled:A,children:[e.jsx("div",{className:"flex min-h-12 items-start",ref:I,children:e.jsx("div",{className:"max-w-full min-w-0 flex-1",children:_?L?e.jsx(ri,{waveform:L,containerWidth:O,scaleFactor:10,initialValue:no}):null:e.jsx(or,{composerController:o,placeholder:a,vanguard:!0})})}),C&&x?e.jsx(sr,{composerController:o,visualTreatment:"vanguard"}):k&&b?e.jsx(kd,{composerController:o,visualTreatment:"vanguard"}):null]})})]}),e.jsx("div",{className:"justify-content-end relative ms-2 flex w-full flex-auto flex-col",children:e.jsx("div",{className:"flex-auto"})}),e.jsx($.div,{initial:{height:v&&se?ya:0},animate:{height:v&&se?ya:0},transition:U?ue:Cs})]}),(se||!!l)&&e.jsx("div",{className:N("bg-primary-surface-primary absolute start-[17px] end-0 bottom-[9px] z-2 flex items-center"),children:e.jsxs("div",{className:"w-full",children:[se&&v&&e.jsx("div",{"data-testid":"composer-footer-actions",className:N("max-xs:gap-1 flex items-center gap-2 overflow-x-auto [scrollbar-width:none]",!le&&B&&"[--force-hide-label:none]"),ref:R=>gn({debounce:!0,target:R,axis:"width",onChange:({width:X})=>{R&&(G.current?G.current&&E.current!==null&&X>=E.current&&P(!1):j.current!==null&&X<j.current?P(!0):(E.current=R.scrollWidth,P(R.scrollWidth>R.clientWidth)))}}),style:{marginRight:`${Be+fe}px`},children:d}),e.jsxs("div",{className:"absolute end-3 bottom-0 flex items-center gap-2","data-testid":"composer-trailing-actions",ref:R=>gn({target:R,axis:"width",onChange:({width:X})=>{ye(X)}}),children:[Ne&&e.jsx("div",{className:"relative ms-1",children:u}),l]})]})}),e.jsx("div",{className:"absolute start-4 top-3 ms-[1px] flex items-center pb-px",children:e.jsx(be,{children:!v&&m})})]}),e.jsxs(Yt,{open:!!g,children:[e.jsx(Fs,{className:"w-full"}),e.jsx(Kt,{children:e.jsx(Qt,{side:"bottom",align:"start",sideOffset:12,onOpenAutoFocus:R=>R.preventDefault(),children:g})})]})]})};function Ag({composerController:t,children:s,enabled:n}){const a=Ze();return e.jsx($.div,{initial:{minHeight:0},animate:{minHeight:n?"142px":0},exit:{minHeight:0},transition:a?ue:Tt,className:"flex flex-col justify-start",onClick:o=>{t.isFocused()?o.preventDefault():t.focus()},children:s})}function Mg({children:t,isTemporaryChat:s,clientThreadId:n,isNewThread:a}){const o=so();return e.jsxs(ai,{className:N("border-token-border-default flex w-full cursor-text flex-col items-center justify-center rounded-[28px] border bg-clip-padding contain-inline-size","overflow-clip shadow-sm sm:shadow-lg dark:shadow-none!",s?"dark bg-[#303030]":"bg-token-main-surface-primary dark:bg-[#303030]"),children:[e.jsx("div",{className:"relative flex w-full items-end px-3 py-3",children:t}),e.jsx(Pg,{children:o?e.jsx(nr,{clientThreadId:n,isVanguard:!0}):null})]})}const Pg=({children:t})=>{const s=Ze(),o={initial:{opacity:0,height:0,y:"-28px"},animate:{opacity:1,y:0,height:"56px",transition:s?ue:{opacity:{delay:.2},default:Tt}},exit:{opacity:0,y:"-28px",height:0,transition:s?ue:{opacity:{delay:0},default:Tt}}};return e.jsx(be,{children:t&&e.jsx($.div,{variants:o,initial:"initial",animate:"animate",exit:"exit",className:"relative w-full",children:t})})},Rg=({children:t})=>e.jsx($.div,{onPointerDown:s=>{s.stopPropagation(),s.preventDefault()},children:t}),ar=({children:t})=>e.jsx("div",{className:"ms-auto flex items-center gap-1.5",onPointerDown:s=>s.stopPropagation(),children:t}),ir=({children:t})=>t?e.jsx(e.Fragment,{children:t}):null,Cn=({children:t})=>e.jsx("div",{onPointerDown:s=>s.stopPropagation(),children:t}),rr=({children:t})=>e.jsx("div",{onPointerDown:s=>s.stopPropagation(),children:t}),lr=({children:t})=>e.jsx("div",{onPointerDown:s=>s.stopPropagation(),children:t}),Eg=({children:t})=>e.jsx("div",{onPointerDown:s=>s.stopPropagation(),children:t}),kn=({children:t,width:s="full"})=>e.jsx("div",{className:N(s==="fit"?"w-fit":"w-full"),onPointerDown:n=>n.stopPropagation(),children:t});function Tg({clientThreadId:t,uploadType:s,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:a,attachmentsProductFeature:o,getInputProps:i,openFileDialog:r,onOauthRedirect:c,historyDisabled:l,isDisabled:p,highlightTooltip:d,disabledReason:u,currentModelName:m,showLabel:h,showUpsell:g,hideBorder:x,isSmall:b,visualTreatment:S,layoutMode:C,restoreFocus:k}){const A=Un(),{gdriveStatus:E,o365Status:j}=Za(),I="h-[20px] w-[20px]",_=l?"text-white":d?"text-brand-blue-800":"",L=g?e.jsx(Rs,{"aria-label":"",className:N(I,_)}):e.jsx(Rs,{"aria-label":"",className:N(I,_)}),O=(E!=="false"||j!=="false"||A||S==="vanguard")&&!g,v=up(),z=S==="vanguard"&&!v,M=O?e.jsx(tr,{hideBorder:x,isSmall:b,clientThreadId:t,icon:L,modelAcceptedMimeTypes:n,modelSupportedImageMimeTypes:a,attachmentsProductFeature:o,onOauthRedirect:c,uploadType:s,openFileDialog:r,getInputProps:i,isDisabled:z?!1:p,highlightTooltip:d,disabledReason:u,currentModelName:m,visualTreatment:S,layoutMode:C,restoreFocus:k}):e.jsx(Qi,{isSmall:b,hideBorder:x,clientThreadId:t,uploadType:s,openFileDialog:r,getInputProps:i,showLabel:h,showUpsell:g,icon:L,isDisabled:p,highlightTooltip:d,disabledReason:u,currentModelName:m});return e.jsx("div",{className:"relative",children:e.jsx(er,{showBackground:d,className:"bg-brand-blue-800/20",children:M})})}const Ng=({clientThreadId:t,currentModel:s,uploadType:n,modelSupportedImageMimeTypes:a,modelAcceptedMimeTypes:o,modelProductFeatures:i,getEditorGizmoId:r,onOauthRedirect:c,disabledReason:l,isTemporaryChat:p,isDisabled:d,highlightTooltip:u,showLabel:m,showUpsell:h,numRemainingFiles:g,visualTreatment:x,layoutMode:b,restoreFocus:S})=>{const C=K(),k=Dt(),{handleFileAccepted:A}=to(C,n,a,"mouse",r,i?.attachments),{getInputProps:E,open:j}=Ln({disabled:d,noClick:!0,onDropAccepted:A,onDropRejected:I=>eo(I,C,k,n),multiple:!0,maxSize:Fn,maxFiles:g,...In(o)});return e.jsx(Tg,{isSmall:!0,hideBorder:!0,isDisabled:d,highlightTooltip:u,onOauthRedirect:c,visualTreatment:x,attachmentsProductFeature:i?.attachments,clientThreadId:t,uploadType:n,modelAcceptedMimeTypes:o,modelSupportedImageMimeTypes:a,getInputProps:E,openFileDialog:j,historyDisabled:p,showLabel:m,showUpsell:h,disabledReason:l,currentModelName:s?.title??"",layoutMode:b,restoreFocus:S})},Bg=({activeSystemHint:t,showHints:s,showContextChevron:n,onRemoveHint:a,lockSystemHint:o})=>{const i=K(),{popoverTriggerRef:r}=It(),c=()=>{requestAnimationFrame(()=>{r.current?.focus()})};if(t){const{logo:l,name:p}=t;return e.jsxs("div",{className:N("relative flex items-center justify-center",!o&&"-me-1"),children:[e.jsx(Vn,{className:"icon-md text-token-interactive-label-accent-default flex-1",svgString:l}),!o&&e.jsx(ci,{"data-remove-hint-button":!0,onClick:d=>{d.stopPropagation(),d.preventDefault(),a(),c()},"aria-label":i.formatMessage({id:"YQ7uOV",defaultMessage:"Remove {tool} from selection"},{tool:p})}),n&&e.jsx(mg,{})]})}return s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-token-border-default ms-0.5 h-[16px] w-[1px]"}),e.jsx("div",{className:"text-token-text-tertiary hover:text-token-text-primary me-0.5 flex items-center",children:e.jsx(ws,{className:"text-token-text-tertiary hover:text-token-text-primary pointer-events-auto! h-4 w-4"})})]}):e.jsx(wd,{"aria-label":i.formatMessage({id:"xosz07",defaultMessage:"View all tools"}),className:"text-token-text-secondary h-5 w-5"})},Ig={source:{id:"SystemHintCategory.Sources",defaultMessage:"Sources",description:"Label on system hint menu for hints that act as data sources"},tool:{id:"SystemHintCategory.Tools",defaultMessage:"Tools",description:"Label on system hint menu for hints that act as tools"}},ka=({children:t,clientThreadId:s,layoutMode:n,lockSystemHint:a,composerController:o,onChangeSystemHint:i,systemHints:r,activeSystemHintType:c,recentSystemHintTypes:l,showHints:p,reasonItem:d=!1,gizmoId:u,isInReasonMode:m,type:h,...g})=>{const x=so(),b=Ze(),S=K(),C=r.find(({systemHint:B})=>c===B),k=et(),A=l.map(B=>B===D.PictureV2&&!r.find(({systemHint:G})=>B===G)?r.find(({systemHint:G})=>G===D.Picture):r.find(({systemHint:G})=>B===G)).filter(B=>!!B),[E,j]=f.useState(null),I=(B,G)=>{G?j(B):i(B)},{selectedIndex:_,systemHintSuggestions:L,suggestorClosed:O,resetSelectedIndex:v}=Xi({composerController:o,clientThreadId:s,onHintSelected:i}),z=O?r:L,M=[],U=Ji(z);let q=0;for(const B of U){const G=B.systemHints;G.length!==0&&(M.push({...B.category?{message:Ig[B.category]}:{},systemHints:G,indexOffset:q}),q=G.length)}const W=()=>{o.setReasonMode(!m),m?w.logEventWithStatsig("Composer Think Button Disabled","composer_think_button_disabled",{clientThreadId:s}):w.logEventWithStatsig("Composer Think Button Enabled","composer_think_button_enabled",{clientThreadId:s})};return e.jsxs("div",{className:N("flex items-center rounded-full",p&&"me-1 border",c!==void 0?"border-transparent":h==="toolpile_icon"?"border-token-border-default":"border-token-border-xlight"),children:[!C&&p&&e.jsx(jd,{onChangeSystemHint:I,systemHints:A}),e.jsxs(Xn,{layoutMode:n,forceOpen:!O,...g,children:[t?e.jsx(Vi,{children:t}):e.jsx(gf,{transition:b?ue:gt,shape:c?"rectangle":"round",spacing:"compact",isSelected:c!==void 0,"aria-label":S.formatMessage({id:"NLd5mV",defaultMessage:"Open tool menu"}),className:N(p&&"-mx-0.5",a&&"cursor-default!",h==="config_icon"&&"min-w-9",h==="toolpile_icon"&&"min-h-9"),onClick:B=>{if(a){B.stopPropagation(),B.preventDefault();return}},tooltipLabel:!c&&S.formatMessage({id:"xgQfBi",defaultMessage:"View all tools"}),disableHover:p&&!C||a,isLegacyStyle:h==="config_icon"||h==="toolpile_icon"&&!!c,borderVisible:h==="config_icon"||h==="toolpile_icon"&&!!c,children:e.jsx(Bg,{activeSystemHint:C,showHints:p,showContextChevron:x||!1,onRemoveHint:()=>i(null),lockSystemHint:a})}),e.jsx(Zn,{onMouseDown:B=>{B.preventDefault()},align:"end",children:e.jsx(_d,{onChangeSystemHint:I,systemHintCategories:M,activeSystemHint:c,activeIndex:_,resetActiveIndex:v,reasonItem:d,gizmoId:u,clientThreadId:s,handleToggleReasonItem:W,isInReasonMode:m})})]}),!k||k.planType===dp.FREE&&e.jsx(Ad,{open:!!E,onOpenChange:()=>j(null),systemHint:E})]})},wa="gpt-4o",Dg=({clientThreadId:t,serverThreadId:s,composerController:n,pendingFiles:a,isUploadDisabled:o,highlightUploadTooltip:i,hasFiles:r,conversationMode:c,placeholder:l,isTemporaryChat:p,layoutMode:d,state:u,inputState:m,disableReason:h,gizmoId:g,currentModel:x,replyRegions:b,uploadButtonDisabledReason:S,keepExpanded:C=!1,getEditorGizmoId:k,onOauthRedirect:A,onSubmit:E,visualTreatment:j,legacyFooterActions:I,legacySuggestionsPopoverContent:_,isNewThread:L=!1,isInReasonMode:O})=>{const{data:v}=ts(),[z,M]=Zo(!1),{updateSystemHint:U}=ve(),{isAutoSwitcherEnabled:q,configurationMenuType:W}=xt();Os();const B=Qe.useState(({persistedSystemHints:V})=>V);Md(t,j==="vanguard");const G=Array.from(B)[0],P=Qe.useState(({recentHints:V})=>V),{state:Y}=Hs(t),re=Et(!1),Ae=pe(V=>V.threads[t]?.modelSelection),se=Ae?.type===xe.SPECIFIC,Ne=pe(V=>V.setThreadModelSelection),Be=j==="vanguard"&&q&&x?.id!==wa&&!se&&!z();di(f.useCallback(()=>{Be&&(re({location:"PromptTextarea",modelId:wa}),pt(t,Ne,{type:xe.EFFORT_MODE,effortMode:lt.low}))},[Be,re,t,Ne]));const ye=V=>{M(!0),U(V,{clientThreadId:t}),V&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{n.focus()})})},fe=!1,le=Y==="clarify"||fe,R=f.useCallback((V,We)=>e.jsx(ni,{...We,isSmall:j==="vanguard",inputState:m,state:u,onSubmit:E,composerController:n,clientThreadId:t,gizmoId:g,disableReason:h,useStartButtonText:le,disableTooltip:V}),[m,u,E,n,t,g,h,le,j]),X=V=>{z()&&(V.preventDefault(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{n.focus()})}))},ae=Pd({inputState:m,state:u,composerController:n,clientThreadId:t,gizmoId:g}),{whisperControls:bt}=oo({composerController:n,renderInComposer:R,composerType:j,composerRightButtonType:ae,layoutMode:d}),[ne=null,st,nt]=f.useMemo(()=>[Nn(x,c),Bn(x,c),Dn(x,c)],[x,c]);Is(t);const ge=Qe.useState(({availableHints:V})=>V),Me=Qe.useState(({locked:V})=>V),Ie=f.useMemo(()=>Ae?.type===xe.EFFORT_MODE?Rd[Ae.effortMode]:"low",[Ae]),[vt,Z]=Zo(Ie);f.useEffect(()=>{Z(Ie)},[Ie,Z]);const De=(V,We=!1)=>{We||M(!0),Z(V),pt(t,Ne,{type:xe.EFFORT_MODE,effortMode:lt[V],isManual:!We});const Ct=Ua(V,v?.categories.map(zs=>zs.defaultModel)??[]);Ed(Ct??Td[V]),requestAnimationFrame(()=>{requestAnimationFrame(()=>{Ct&&re({location:"PromptTextarea",modelId:Ct})})})};je(ce.ModelPickerMoved);const Ge=Mn(g),ze=Y!=="disabled"||fe||c?.kind===Ee.GizmoInteraction&&!Ge,St=Ge;Ki({serverThreadId:s,clientThreadId:t,composerController:n,getIsDisabled:f.useCallback(()=>!!(z()||ze||St||j!=="vanguard"||j==="vanguard"&&(se||G)),[z,j,ze,St,se,G]),onReset:()=>{M(!1),se||De("low",!0)},onInfer:V=>{De(V,!0)}});const{pageType:H}=mi(),Ce=pi(V=>V.selectedApps),Lt=fi()&&Ce.length>0,yt=r||Lt,ns=C||!!G||b&&b.length>0||yt||ge.length<3;return As(x,c,B),e.jsxs(_g,{isNewThread:L,clientThreadId:t,isTemporaryChat:p,placeholder:l,visualTreatment:j,composerController:n,isExpandedByDefault:ns,onSubmit:E,children:[b&&b.length>0&&e.jsx(kn,{width:"full",children:e.jsx(ii,{replyRegions:b})}),yt&&e.jsx(kn,{width:"fit",children:e.jsx(hn,{files:a,selectedApps:Ce,className:"no-scrollbar -ms-1.5 flex flex-nowrap gap-2 overflow-x-auto p-1.5"})}),[I?.map((V,We)=>e.jsx(ir,{children:V},`legacy-footer-action-${We}`))??[],(W!=="none"&&e.jsx(Cn,{children:e.jsx(ka,{activeSystemHintType:G,lockSystemHint:H.type==="landing-page"||Me,systemHints:ge,clientThreadId:t,composerController:n,onChangeSystemHint:ye,layoutMode:d,recentSystemHintTypes:P,showHints:W==="toolpile_icon",gizmoId:g,reasonItem:!0,isInReasonMode:O,type:W,restoreFocus:X})},"system-hint-popover"))??[],(W!=="none"&&O&&e.jsx(Cn,{children:e.jsx(wg,{onRemoveThink:()=>{n.setReasonMode(!1),w.logEventWithStatsig("Composer Think Button Disabled","composer_think_button_disabled",{clientThreadId:t}),requestAnimationFrame(()=>{requestAnimationFrame(()=>{n.focus()})})}})},"think-button"))??[],e.jsx(lr,{children:_},"legacy-suggestions-popover")],j==="vanguard"&&e.jsx(rr,{children:e.jsx(ka,{activeSystemHintType:G,lockSystemHint:H.type==="landing-page"||Me,systemHints:ge,clientThreadId:t,composerController:n,onChangeSystemHint:ye,layoutMode:d,recentSystemHintTypes:P,showHints:!L,isInReasonMode:O,restoreFocus:X})},"system-hint-popover"),e.jsx(ar,{children:bt})]})},Lg=Yn(()=>Kn(()=>import("./dbytrd0cso3hgqr4.js"),__vite__mapDeps([8,1,3,4,2,5,9,10,11,12,13,14,15])).then(t=>t.ImageGenComposer)),Fg=1,Og=3e3;function Hg({onCreateNewCompletion:t,onContinueGenerating:s,account:n,currentModelId:a,currentModelConfig:o,disableDraftPersistence:i=!1,modelCategories:r,areModelsLoading:c,clientThreadId:l,isNewThread:p,isCompletionInProgress:d,className:u,disabled:m=!1,disabledReason:h,canPause:g=!1,canContinue:x=!1,isInteractableSharedThread:b,onComposerInput:S,onComposerChange:C,onAutocompleteSelect:k,headerClassName:A,hideHeader:E,onTaggingDropdownOpen:j,onTaggingDropdownClose:I,onlyAllowImageUploads:_}){ea.markStart("PromptTextarea"),ea.markRendered("PromptTextarea");const L=es(),O=f.useRef(null),v=ht(),z=Va(),M=mp(z.showUploadSuggestion$),U=Nd(),q=n?.isFree(),W=n?.isTeam(),{isUnauthenticated:B}=Se(),G=K(),P=Dt(),Y=On(),re=Os(),Ae=Bd.useStore(),[se,Ne]=de(l,y=>[te.getCurrentLeafId(y),te.getRequestId(y)]),[Be]=Pa(),{gizmoEditorData:ye,mode:fe,getGizmoId:le}=Tn(),R=pp(),X=Nt(),ae=fp(),bt=Id(),ne=Ei(l),st=!!Si(),nt=!!ki(),ge=Dd.useIsEnabled(l),Me=!!Qn(),{setThreadSystemHintMode:Ie,clearAllSystemHintModeTriggers:vt}=ve(),Z=Jt(),{state:De}=Hs(l),Ge=Bt(D.ContextualAnswers),ze=!1,St=null,H=Z.has(D.Search),Ce=Z.has(D.Think),Lt=Z.has(D.PictureV2),yt=je(ce.ModelPickerMoved),ns=Z.has(D.Research),{activeSystemHints:V}=Is(l),We=V.length>0,Ct=V.find(y=>y.systemHint===D.ContextualAnswers),zs=Ld(),{connectionInstanceData:Ws,isLoading:ur}=li({skip:!zs}),dr=ui({exposed:Ge})==="bigbox",{selectedSources:ao}=ei(l),Vs=f.useRef(0),$s=f.useRef(!1),mr=r?.find(y=>y.defaultModel===a),pr=null;let J=Zt(l),qs=J&&"gizmo"in J?J.gizmo:void 0;const fr=gp(),kt=qs?.gizmo.id??fr,Ft=Mn(kt),gr=Fd(),io=Od(),[ke,os]=f.useState(null);ke!==null&&(J={gizmo:ke,gizmo_id:ke.gizmo.id,kind:Ee.GizmoInteraction},qs=ke);const Ot=As(o,J,Z),hr=Gs(),ro=Ri(L).flags,as=ro?.includes(Es.NoAuthEnableFileUploads),{isUXUpdatesEnabled:Le,showLegacyReasoningSlider:ot,showReasoningSliderNux:xr,reasoningSliderType:br,hideReasonInSystemHintOverflow:vr,hideSearchInSystemHintOverflow:Sr,configurationMenuType:yr}=xt(),Cr=Le&&Z.size===0,is=pe(y=>y.setThreadModelSelection),lo=pe(y=>y.threads[l]?.modelSelection),co=lo?.type===xe.EFFORT_MODE?lo.effortMode:null,Ys=zn(L,"850280859")&&!Le&&[hp,xp.AUTO].includes(a),uo=Ys&&!!co&&co!==lt.low;di(f.useCallback(()=>{uo&&pt(l,is,{type:xe.EFFORT_MODE,effortMode:lt.low})},[uo,l,is])),Ki({serverThreadId:ne,clientThreadId:l,composerController:v,getIsDisabled:f.useCallback(()=>!Ys,[Ys]),onReset:()=>{pt(l,is,{type:xe.EFFORT_MODE,effortMode:lt.low})},onInfer:y=>{pt(l,is,{type:xe.EFFORT_MODE,effortMode:lt[y]})}});const{prospectiveModelId:mo}=Xt(l),kr=q||c&&mo&&!mm.includes(mo),po=!m&&(Ot!==ct.None||Cr||kr)&&(!B||as),Ve=Bn(o,J),Ks=Dn(o,J);let me=fn(y=>y.files);const[rs]=f.useState(()=>Hd());fe==="magic"?me=me.filter(y=>y.gizmoId!=null):me=me.filter(y=>y.gizmoId==null);const fo=Ud(),$e=me.length>0||fo,go=fn(Gd.hasUploadInProgress),Qs=pi(y=>y.selectedApps),ho=fi()&&Qs.length>0,wr=$e||ho,jr=!!St?.comments.length,_r=zd(l),Js=v.useState(y=>{const Q=Wd(y);return typeof o?.maxTokens=="number"&&Q>o.maxTokens}),xo=v.useState(y=>!y.isEmpty()),ls=!Js&&!go&&(xo||$e||jr),bo=(Ot===ct.Multimodal?Rn:En)-me.length,vo=bo<=0,Ar=Vd(),Mr=ie("3544641259")?.value,{selectedRepos:Xs}=Gn(l),So=Ar&&Mr&&ao?.size===0,wt=ls&&!m&&!Me&&(!d||io)&&!So&&!!1,[yo,Pr]=f.useState(!1),{value:Rr}=ie("3780975974"),{targetedContent:Co,setTargetedContent:cs}=$d(),Pe=Co?.isFocusedViewContent&&!bt?void 0:Co;f.useEffect(()=>{requestAnimationFrame(()=>requestAnimationFrame(()=>v.focus()))},[Pe]);const ko=J==null||J?.kind===Ee.PrimaryAssistant||J?.kind===Ee.GizmoInteraction&&Ft,{getUpsellLabelType:Er,getUpsellShowsAttach:Tr,getShowUpsellReason:Nr}=oi(),Zs=We&&ko,[Br,Ir]=f.useState(!1),Dr=!B&&ko&&(!W||!ur),jt=ut(v.store,y=>y.controlsDisabled);f.useEffect(()=>{if(!U?.id)return;const y=ta.getAndReset(U.id,ne);y&&v.setText(y.inputText)},[U?.id,ne,v]),f.useEffect(()=>{const y=Be.get("prompt")??"";v.getCurrentText().length===0&&y.length>0&&v.setText(y)},[v,Be]),f.useEffect(()=>{yo!==wt&&(Pr(wt),wt&&bp(!0).then(y=>{qd.startEnforcement(y),vp.startEnforcement(y)}))},[wt,yo,J?.kind,R]);const us=Nn(o,J),{handleFileAccepted:Lr}=to(G,As(o,J,Z),Ve,"mouse",le,us?.attachments),{getInputProps:Fr,open:en,inputRef:wo}=Ln({disabled:m||!po||vo,noClick:!0,onDropAccepted:Lr,onDropRejected:y=>eo(y,G,P,Ot),multiple:!0,maxSize:Fn,maxFiles:bo,...In(B||_?Ve:Ks)}),jo=ut(rs),_o=f.useCallback(()=>{v.eraseContent(),jo.clearMessages(),v.resize(Fg),v.usedDictation=!1;for(const y of me)ks.remove(Y,y.tempId,"none");Yd.markAllAsSent()},[v,jo,me,Y]),Or=ie("1064007944")?.value,tn=ut(v.store,y=>y.isInReasonMode),Ao=async(y,Q)=>{if(y.preventDefault(),m||!ls&&!Q||!J)return;const he=v.getContentToSend(),we=gm(he.content),at=ra(tn,v,Z),{content:rn,attachments:ln}=hm(Y,we,o,J,Z);gr(),t({sourceEvent:y,attachments:ln,content:rn,contentToSend:he,conversationMode:J,hasSelectedApps:ho,isMessageFollowupsEnabled:ge,selectedApps:Qs,selectedGizmoTag:ke,selectedRepos:{selectedAllRepos:Xs.selectedAllRepos,selectedRepos:Xs.selectedRepos?[...Xs.selectedRepos]:null},selectedSources:ao,systemHints:at,usedDictation:v.usedDictation}),Pe?.onCreateCompletion?.({serverThreadId:ne,currentLeafId:se}),Pe?.shouldPersistAcrossMessages!==!0&&cs(void 0),oa.hideThreadHeader();for(const Gt of me)Gt.status===xm.Ready&&Ae.addFile(Gt);_o();const ml=V.some(Gt=>Gt.persistBetweenMessages&&Z.has(Gt.systemHint));Le&&!ns&&!H&&!(Lt&&Or)&&!ml&&vt()},Hr=y=>{cs(y.targetedReply),y.targetedReply&&w.logEventWithStatsig("Targeted Reply Button Clicked","chatgpt_targeted_reply_button_clicked",{conversationId:ne,sourceMessageId:y.messageId})},Mo=f.useCallback(()=>{Pe?.onCleared?.({serverThreadId:ne,currentLeafId:se}),cs(void 0),v.focus()},[se,ne,Pe,cs,v]),Po={Enter:{validator:y=>{const Q=y.isComposing||y.keyCode===229;return!(ms&&$s.current)&&(y.metaKey||(X||wp||!1)&&!y.shiftKey&&!Q&&!ze)},handler:y=>{if(!wt){Js&&P.danger("The message you submitted was too long, please submit something shorter.",{hasCloseButton:!0});return}y.preventDefault(),Ao(y)}},Escape:{validator:y=>!y.isComposing,handler:y=>{g&&d&&(sa(l),w.logEvent("Pause Completion",{threadId:Wt(l),currentLeafId:te.getCurrentNode(Ue(l)).message.id,eventSource:"keyboard"})),y.target.value===""&&Mo()}}},Ht=f.useRef(Po);Ht.current=Po;const ds=Kd(o?.tags,J?.kind),{showTaggingDropdown:sn,isFocused:Ur,autocompletions:qe,matchaData:Gr}=ut(v.store),ms=Ur&&qe.length>0,_t=ds&&sn&&!Ft,Ro=v.isReady();f.useEffect(()=>v.subscribe("keydown",y=>{v.acceptLegacyKeydown()&&Ht.current[y.key].validator(y)&&Ht.current[y.key].handler(y);const he=v.getCurrentText();if(y.key==="@"){const we=v.getSelectionStart(),at=he.substring(0,we);(!at||/\s$/.test(at)||we===0)&&setTimeout(()=>v.setShowTaggingDropdown(!0),10)}else sn&&v.setShowTaggingDropdown(!1);y.key==="Escape"&&(os(null),v.setAutocompletions([])),H&&y.key==="Escape"&&Ie(D.Search,!1,{clientThreadId:l})}),[v,Ro,sn,Z,H,Ie,l]),f.useEffect(()=>{const y=Object.fromEntries(Object.keys(Ht.current).map(Q=>[Q,we=>{const at=Ht.current[Q];if(!at||v.acceptLegacyKeydown())return!1;const{validator:rn,handler:ln}=at;return rn(we)?(ln(we),!0):!1}]));v.registerKeyHandlers(y),v.registerFileInput({openFileDialog:en,inputRef:wo})},[v,en,wo,Ro]),f.useEffect(()=>v.subscribe("paste",y=>{Qd({filePickerStore:Y,event:y,intl:G,toaster:P,clientThreadId:l,conversationMode:J,currentModelConfig:o,getEditorGizmoId:le,modelSupportedImageMimeTypes:Ve,persistedSystemHints:Z})}),[G,l,J,o,le,Ve,v,P,Y,Z]);const Eo=y=>{st||os(y),v.trimLeadingText("@"),pn(),v.setShowTaggingDropdown(!1)},zr=Jd(l,rs,Ve,us?.attachments),Wr=f.useCallback(y=>{y.preventDefault(),sa(l),w.logEvent("Pause Completion",{threadId:Wt(l),currentLeafId:te.getCurrentNode(Ue(l)).message.id,eventSource:"mouse"}),pn()},[l]),ps=f.useCallback(()=>{ta.set(U?.id,ne,v.getCurrentText())},[ne,U?.id,v]);f.useEffect(()=>{ye||Xd()||v.focus()},[v]),f.useEffect(()=>{if(Ve.length>0)for(const Q of me)Zd(Q.fileSpec?.mimeType,Ks)||ks.remove(Y,Q.tempId,"none");else ks.reset(Y)},[a,Y]),f.useEffect(()=>{(!ds&&ke||st)&&os(null)},[ds,ke,st]),f.useEffect(()=>{nt&&v.setReasonMode(!1)},[nt,v]);const{layer:Vr}=Xe("4031588851"),{layer:To}=Xe("3637408529"),$r=To.get("is_in_composer_text_exp",!1),qr=To.get("composer_text","MESSAGE_CHATGPT"),Yr=Vr.get("composer_text","MESSAGE_CHATGPT"),Kr=$r?qr:Yr,[fs,Qr]=(()=>{switch(h){case"workspaceDisallowsGizmo":return[oe.disallowedByWorkspacePlaceholder,!0];case"noModelsAvailable":return[oe.noModelsAvailablePlaceholder,!0];case"requiresPluginsToBeInstalled":return[oe.requiresPluginsToBeInstalled,!0];case"loadingPlugins":return[oe.loading,!0];case"noTestGizmoId":return[oe.noTestGizmoId,!0];default:{if(b)return[oe.placeholderWithName,!1];if(Pe?.placeholderTextOverride!=null)return[Pe.placeholderTextOverride,!1];if(De==="initial"||De==="recurrent")return[oe.deepResearchPlaceholder,!1];if(De==="clarify")return[oe.researchSuggestionInitial,!1];if(Ge)return p&&dr?[na.caSuggestionPlaceholder,!1]:[na.caSuggestionInitial,!1];switch(Kr){case"BLANK":return[null,!1];case"ASK_ANYTHING":return[oe.placeholderAskAnythingVariant,!1];case"ASK_CHATGPT_ANYTHING":return[oe.placeholderAskNameAnythingVariant,!1];default:return[oe.placeholderWithName,!1]}}}})(),nn=Ft?p?G.formatMessage(em.newChatInProject):fs?G.formatMessage(fs,{name:"ChatGPT"}):"":fs?G.formatMessage(fs,{name:ye!=null?fe==="magic"?tm:ye.name||"GPT":qs?.gizmo.display.name??"ChatGPT"}):"";f.useEffect(()=>v.subscribe("input",()=>{sm.getState().isThreadHeaderVisible&&oa.hideThreadHeader()}),[v]),f.useEffect(()=>v.subscribe("input",()=>{Vs.current=performance.now(),S?.()}),[v,S]),f.useEffect(()=>{if(C)return v.subscribe("change",()=>{C()})},[v,C]);const Jr=Rr||Nr(),No=nm()&&!!qe.find(y=>!!y.requires_file_upload),Xr={clientThreadId:l,uploadType:Ot,modelAcceptedMimeTypes:Ks,modelSupportedImageMimeTypes:Ve,attachmentsProductFeature:us?.attachments,getInputProps:Fr,openFileDialog:en,historyDisabled:ae,onOauthRedirect:ps,highlightTooltip:No&&!$e},gs=[],Bo=[],Io=!m&&!vo&&(po||hr!=null)&&!H&&!ze,Do=Tr(),Zr=!B||Do||as,Lo=Ot===ct.None?Fe.ModelNotSupported:Ce?Fe.ThinkModeInUse:H?Fe.SearchModeInUse:void 0;if(Zr){const y=e.jsx("div",{"data-testid":"composer-action-file-upload",style:{viewTransitionName:"var(--vt-composer-attach-file-action)"},children:e.jsx(ig,{...Xr,showGlowingBorder:M,showLabel:Er()==="all",showUpsell:Do&&!as,showMenuForNoAuth:as,isDisabled:!Io||jt,disabledReason:Lo,currentModelName:o?.title??"",visualTreatment:Le?"vanguard":"legacy"})},"file-upload-button");gs.push(y),Bo.push(y)}const Ye=[],Fo=Hn(),Oo=pe(y=>y.isVisuallyOverflowing)&&ot;let hs="bottom";Fo?hs="bottom":p&&(hs="centered"),ot&&(J?.kind!==Ee.GizmoInteraction||Ft)&&Ye.push(e.jsx("div",{"data-testid":"composer-action-reasoning-level",className:"flex [--pill-color:var(--text-secondary)] [--pill-font-size:13px]",onPointerDown:y=>y.stopPropagation(),children:e.jsx(Pn,{announcementKey:ce.ModelPickerMoved,side:"bottom",show:re&&xr&&!yt.isLoading&&yt.eligible,onDismiss:yt.markAsViewed,theme:"bright",badge:"none",dismissOnOutsideClick:!0,sideOffset:0,title:e.jsx(F,{id:"NGN4SW",defaultMessage:"Set how long ChatGPT should think or pick a different model"}),children:e.jsx(vf,{clientThreadId:l,layoutMode:hs,currentModel:o,category:mr,type:br,mode:Ft?"model-picker-only":"default"})})},"reasoning-level")),Sr||Ye.push(e.jsx(nf,{account:n,clientBootstrapFlags:ro,features:R,currentModelConfig:o,hasFiles:$e,isDisabled:jt||$e,clientThreadId:l,composerController:v,gizmoId:kt},"search"));const{value:el}=ie("1830177352");!ot&&!vr&&Ye.push(e.jsx(ef,{clientThreadId:l,gizmoId:kt,composerController:v,isDisabled:jt},"reason")),el&&Ye.push(e.jsx(Jp,{clientThreadId:l,showLabel:Jr,isDisabled:jt},"deep-research")),Oo||Ye.push(e.jsx(Yf,{clientThreadId:l,composerController:v,isDisabled:jt,currentModelConfig:o,currentModelConfigLoading:c,disableIfNoAccess:ot},"shiba")),Ct&&Ws&&Ws.connection_statuses.length>0&&!Oo&&Ye.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-search-action)"},"data-testid":"composer-action-contextual-answers",children:e.jsx(kg,{composerController:v,systemHint:Ct,clientThreadId:l,connectionStatuses:Ws.connection_statuses})},"contextual-answers")),Dr&&Ye.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-system-hint-action)"},"data-testid":"composer-action-system-hint-button",children:e.jsx(xg,{composerController:v,clientThreadId:l,disabled:jt,hideThinkButton:ot,disableIfNoAccess:ot})},"system-hint-button")),yr==="none"&&gs.push(...Ye);const on=Qr?"disabled":"default",tl=om(Wt(l)||l)?.value===Sp.STREAMING,Ho=d&&g||tl,sl=yp(),nl=!wt||sl,an=pm(go,xo,Js,_r,!So),At=Ho?"streaming":nl?"disabled":"idle",Ut=f.useRef(null),Mt=f.useRef(null),{value:ol}=ie("222560275"),al=ol||a&&!a.startsWith("o1")&&!a.startsWith("o3");f.useEffect(()=>{const y=()=>{Ut.current!=null&&jp.addAction("composer_state_disabled",{threadId:Wt(l),disabledReason:Ut.current})};if(ls&&At==="disabled"){let Q="unknown";m?Q=h??"component_disabled_unknown":d?Q="completion_in_progress":Me&&(Q="thread_hard_blocked"),Ut.current!==Q&&(Mt.current&&clearTimeout(Mt.current),Mt.current=setTimeout(y,Og)),Ut.current=Q}else Ut.current=null;return()=>{Mt.current&&(clearTimeout(Mt.current),Mt.current=null)}},[l,ls,At,m,h,d,Me]);const xs=[];if(Pe?.label&&xs.push({type:Pe.type,value:Pe.label,onRemoveRegion:Mo}),ke!==null){const y=!!ke.gizmo.tags?.includes(Ls.FirstParty);xs.push({type:"mention",value:ke.gizmo.display.name,icon:e.jsx(Bi,{isFirstParty:y,src:ke.gizmo.display.profile_picture_url,className:"icon-md"}),onRemoveRegion:()=>{os(null),v.focus()}})}f.useEffect(()=>{(!qe||qe.length===0||!ms)&&($s.current=!1)},[qe,ms]);const il=(y,Q,he)=>{$s.current=y>=0,Q&&v.setText(he?`${he.title}${he.body}`:"")},Uo=ms&&qe&&qe.length>0&&!_t&&!ns&&!v.hasMultipleLines()&&v.canShowAutocompletion()&&!ze;f.useEffect(()=>{_t?j?.():I?.()},[_t,j,I]);const bs=y=>{if(y.preventDefault(),y.stopPropagation(),Vs.current>0){const Q=performance.now()-Vs.current;_p.hist(Ap.DEFAULT,"final_user_input_to_submit_ms",[],Q)}At==="streaming"&&(!io||v.isEmpty())?Wr(y):Ao(y)},rl=am(o,$n.Canvas),{value:ll}=ie("61299031"),cl=im(),ul=rl&&ll&&!cl&&!fo&&!Fo;f.useEffect(()=>{},[pr,v]),f.useEffect(()=>{const y=Wt(l),Q=n?.normalizedAccountUserId;if(!Q||i)return;const he=_s(()=>{const we=v.getContentToSend().content;we===""?Cp(y):kp(y,we,Q)},1e3);return v.subscribe("change",he)},[n,l,v,i,ne]);const Go=e.jsx(Uf,{canUseInlineTagging:ds,isDisabled:m,clientThreadId:l,currentLeafId:se,currentRequestId:Ne,canContinue:x,composerController:v,isNewThread:p,onContinueGenerating:y=>s({event:y,conversationMode:Ue(l)?.mode,systemHints:ra(tn,v,Z)}),onResetState:_o,conversationMode:J,isShowingAutocomplete:!!Uo}),zo=!Ho&&J!=null&&al&&rm.includes(J.kind)&&e.jsx(lm,{clientThreadId:l,onTargetedReply:Hr}),Wo=Uo&&e.jsx("div",{className:N("absolute start-0 z-[-1] box-border w-full ps-0 max-lg:bottom-full lg:top-full",Le?"border-token-border-default md:bg-token-main-surface-primary z-10! bg-transparent md:mt-2 md:rounded-3xl md:border md:shadow-[0px_12px_24px_rgba(0,0,0,0.032)]":"bg-token-main-surface-primary"),children:e.jsx(Np,{suggestions:qe,composerController:v,onSelect:k,onChange:il})}),Vo=e.jsx(fm,{composerController:v,parsedDocumentHandler:zr}),$o=!E&&e.jsx(Yi,{className:A}),qo=e.jsx(cm,{modelSupportedImageMimeTypes:Ve,uploadType:ct.Multimodal,attachmentsProductFeature:us?.attachments}),dl=e.jsxs(e.Fragment,{children:[_t&&e.jsx(pa,{onClick:y=>Eo(y),onClose:()=>{v.setShowTaggingDropdown(!1),v.focus()}}),Zs&&e.jsx(xa,{composerController:v,clientThreadId:l})]}),{isImageGenEditor:Yo}=um();return Yo?e.jsxs(aa.Provider,{value:rs,children:[e.jsx(ia,{onOauthRedirect:ps,children:e.jsx("form",{id:"prompt",className:u,onSubmit:bs,children:e.jsxs("div",{className:"relative z-1 flex h-full max-w-full flex-1 flex-col",children:[$o,e.jsxs("div",{className:"group relative z-1 flex w-full items-center",style:{"--force-hide-label":Br?"none":"block"},children:[e.jsxs(Yt,{open:_t||Zs,children:[e.jsx(Fs,{className:"w-full",children:Yo?e.jsx(Lg,{type:ae?"temporary":"default",ref:O,placeholder:nn,inputState:on,composerController:v,leftSideActions:Bo,state:At,onSubmit:bs,renderFiles:$e&&e.jsxs(e.Fragment,{children:[fe==="magic"&&e.jsx("div",{className:"bg-token-main-surface-secondary text-token-text-secondary m-2 mb-0 rounded-lg p-2 text-xs",children:e.jsx(F,{...oe.gizmoKnowledgeWarning})}),e.jsx(hn,{files:me,className:"-ms-1.5 flex flex-nowrap gap-2 overflow-x-auto p-1.5"})]}),clientThreadId:l,gizmoId:kt,disableReason:an,modelId:a}):e.jsx(pg,{type:ae?"temporary":"default",ref:O,replyRegions:xs,placeholder:nn,inputState:on,setIsComposerOverflowing:Ir,composerController:v,matchaData:Gr,leftSideActions:gs,topRightAction:ul&&e.jsx(dm,{composerRef:O,composerController:v,clientThreadId:l}),state:At,onSubmit:bs,renderFiles:wr&&e.jsxs(e.Fragment,{children:[fe==="magic"&&e.jsx("div",{className:"bg-token-main-surface-secondary text-token-text-secondary m-2 mb-0 rounded-lg p-2 text-xs",children:e.jsx(F,{...oe.gizmoKnowledgeWarning})}),e.jsx(hn,{files:me,selectedApps:Qs,className:"-ms-1.5 flex flex-nowrap gap-2 overflow-x-auto p-1.5"})]}),clientThreadId:l,gizmoId:kt,disableReason:an,modelId:a})}),e.jsx(Kt,{children:e.jsxs(Qt,{side:"bottom",align:"start",sideOffset:12,onOpenAutoFocus:y=>y.preventDefault(),children:[_t&&e.jsx(pa,{onClick:y=>Eo(y),onClose:()=>{v.setShowTaggingDropdown(!1),v.focus()}}),Zs&&e.jsx(xa,{composerController:v,clientThreadId:l})]})})]}),Wo]}),Vo,qo]})})}),Go,zo]}):e.jsxs(aa.Provider,{value:rs,children:[e.jsx(ia,{onOauthRedirect:ps,children:e.jsxs("div",{className:N(`relative z-1 flex max-w-full flex-1 flex-col ${Le?"":"h-full"}`,!Le&&"max-xs:[--force-hide-label:none]",ot&&!re&&"[--force-hide-label:none]"),children:[$o,e.jsx(Dg,{visualTreatment:Le?"vanguard":"legacy",hasFiles:$e,pendingFiles:me,isUploadDisabled:!Io,isNewThread:p,clientThreadId:l,serverThreadId:ne,getEditorGizmoId:le,highlightUploadTooltip:No&&!$e,disableReason:an,uploadButtonDisabledReason:Lo,currentModel:o,layoutMode:hs,conversationMode:J,onOauthRedirect:ps,state:At,inputState:on,gizmoId:kt,isTemporaryChat:ae,placeholder:nn,composerController:v,onSubmit:bs,replyRegions:xs,keepExpanded:p||!Le,legacyFooterActions:gs,legacySuggestionsPopoverContent:dl,isInReasonMode:tn}),Wo]})}),Vo,Go,zo,qo]})}function ja({clientThreadId:t,onClick:s}){f.useEffect(()=>{vm(t)},[t]);const n=K();return e.jsx($.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},className:"inline-block",children:e.jsx(gi,{onClick:()=>{Sm(t),s()},label:n.formatMessage(Vg.moreStarterPrompts)})})}function Ug({starterPrompt:t,starterPrompts:s,index:n,disabled:a,onSelectStarterPrompt:o}){const i=t.theme??t.title,r=Sl(),{mutate:c}=ym(),l=t.category==="onboarding"?p=>{c({key:ce.hasUsedConversationalOnboardingStarterPrompt}),r(p,t,s,n)}:p=>o?.(p,t,s,n);return e.jsx(gi,{disabled:a,onClick:l,icon:e.jsx(Cm,{category:t.category,useV2Colors:!0}),label:i})}const Gg=5,zg=3;function cr({starterPrompts:t,onSelectStarterPrompt:s,disabled:n,clientThreadId:a,onExpand:o,mobileLayout:i=!1}){const r=i?zg:Gg,[c,l]=f.useState(r),[p,d]=f.useState(!1),u=f.useRef(null),m=t.length<=c;f.useEffect(()=>{la(t.slice(0,r),a)},[a]),f.useEffect(()=>{if(!p&&!m&&u.current){const g=u.current,x=g.getBoundingClientRect(),b=x.width,S=Array.from(g.children);let C=0;for(let k=0;k<S.length&&S[k].getBoundingClientRect().right-x.left<=b;k++)C++;l(C),d(!0)}},[t,m,p]);const h=()=>{const g=t.slice(c,t.length).map(x=>({...x,isAdditional:!0}));g.length>0&&la(g,a),l(t.length),o()};return e.jsxs("div",{className:N("mt-5 flex items-center justify-center gap-x-2 transition-opacity xl:gap-x-2.5",p&&t.length>0?"opacity-100":"opacity-[0.01]",i?"flex-wrap":"flex-nowrap"),children:[e.jsxs("ul",{className:N("relative flex items-stretch gap-x-2 gap-y-4 overflow-hidden py-2 sm:gap-y-2 xl:gap-x-2.5 xl:gap-y-2.5",m||i?"flex-wrap justify-center":"flex-nowrap justify-start"),ref:u,children:[t.slice(0,c).map((g,x)=>e.jsx($.li,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},children:e.jsx(Ug,{starterPrompt:g,starterPrompts:t,index:x,disabled:n,onSelectStarterPrompt:s})},g.id??x)),i&&t.length>c&&e.jsx(ja,{clientThreadId:a,onClick:h})]}),!i&&t.length>c&&e.jsx(ja,{clientThreadId:a,onClick:h})]})}const mh=({clientThreadId:t,currentModelId:s,isModelLoaded:n})=>{const[a,o]=f.useState(!1),i=Qn(),{prospectiveModelId:r}=Xt(t),c=n?s:r??"auto",{promptStarters:l,shouldShowStarterPrompts:p,onSelectStarterPrompt:d}=Ni({isModelLoaded:n,shouldBeEnabledForDefaultAssistant:!0,clientThreadId:t,limit:8,modelSlug:c});return e.jsx($.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:N(!a&&"h-[116px]"),children:p&&l&&e.jsx(cr,{starterPrompts:l,onSelectStarterPrompt:d,disabled:i,clientThreadId:t,onExpand:()=>o(!0),mobileLayout:!0})})},Wg=({currentModelId:t,clientThreadId:s,isModelLoaded:n})=>{const{isUnauthenticated:a}=Se(),[o,i]=f.useState(!1),r=bm(),c=Qn(),{prospectiveModelId:l}=Xt(s),p=n?t:l??"auto",{promptStarters:d,shouldShowStarterPrompts:u,onSelectStarterPrompt:m}=Ni({isModelLoaded:n,shouldBeEnabledForDefaultAssistant:!0,clientThreadId:s,limit:8,modelSlug:p});return e.jsx($.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:N("hidden min-h-[108px] max-w-full",r?"@lg/thread:block":"lg:block",a&&o?"":"h-[70px]"),children:u&&d&&e.jsx(cr,{starterPrompts:d,onSelectStarterPrompt:m,disabled:c,clientThreadId:s,onExpand:()=>i(!0)})})},Vg=Te({moreStarterPrompts:{id:"SplashScreenV2.moreStarterPrompts",defaultMessage:"More"}}),_a=Wn.div`m-8 flex flex-col items-center`;function Aa(t){return e.jsx($.div,{initial:{opacity:0,translateY:20},animate:{opacity:1,translateY:0,transition:{duration:.5,ease:"easeIn"}},...t})}function $g({clientThreadId:t}){const n=de(t,o=>o?.promptGptRating)?.gizmoId,{data:a}=hi(n);return n==null||a==null||!km(a)?null:e.jsx(qg,{gizmoId:n})}function qg({gizmoId:t}){const[s,n]=f.useState(!1),[a,o]=f.useState(!1),i=wm(t),r=async l=>{n(!0),setTimeout(()=>{o(!0)},5e3),w.logEvent("Submit Inline Rating",{gizmo_id:t,rating:l}),await i.mutateAsync({rating:l})},c=async()=>{o(!0),w.logEvent("Dismiss Inline Rating",{gizmo_id:t}),await i.mutateAsync({})};return f.useEffect(()=>{a||w.logEvent("Show Inline Rating",{gizmo_id:t})},[a,t]),a?null:s?e.jsx(_a,{children:e.jsxs(Aa,{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"border-token-border-heavy rounded-lg border p-4",children:e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(F,{id:"gizmo.inlineReview.reviewLeft",defaultMessage:"Feedback sent"}),e.jsx(ma,{onClick:()=>{o(!0)}})]})}),e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(F,{id:"gizmo.inlineReview.reviewLeftSubtext",defaultMessage:'To update your rating, click "Send Feedback" in the GPT Menu'})})]})}):e.jsx(_a,{children:e.jsxs(Aa,{className:"border-token-border-heavy flex flex-col items-center gap-4 rounded-lg border p-4",children:[e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(F,{id:"gizmo.inlineReview.prompt",defaultMessage:"How would you rate this GPT so far?"}),e.jsx(ma,{onClick:c})]}),e.jsx(jm,{rating:void 0,onRating:r})]})})}const ph=({clientThreadId:t,isNewThread:s,isGizmoThread:n,isProjectThread:a,isModelLoaded:o,currentModelId:i,onRequestCompletion:r,shouldUseUnifiedComposer:c,isVanguardUxEnabled:l,onlyAllowImageUploads:p})=>{const d=ht(),{pageType:u}=mi(),m=u?.type==="landing-page",h=f.useContext(Mp),g=Pp(h),x=Hn();et(),_m(d);const b=async A=>{if(Ue(t)?.isLoading!==!1)return;const E=await Nm(A);r(E)},S=f.useCallback(A=>{w.logEvent("Continue Completion"),r(Am(A))},[r]),C=e.jsxs(e.Fragment,{children:[e.jsx($g,{clientThreadId:t}),e.jsx(un,{verticalMargin:"none",verticalPadding:g?"last-standard":"none",horizontalPadding:"standard",children:e.jsx(dn,{children:e.jsx(Yg,{clientThreadId:t,currentModelId:i,isNewThread:s,hideHeader:s,onRequestCompletion:b,onContinueGenerating:S,onAutocompleteSelect:d.onAutocompleteSelect,onlyAllowImageUploads:p})})})]}),k=s&&e.jsx("div",{className:N("[display:var(--display-hidden-until-loaded,block)] md:absolute md:start-0 md:bottom-6 md:w-full"),children:e.jsx(un,{verticalMargin:"none",verticalPadding:"none",horizontalPadding:"standard",children:e.jsx(dn,{children:e.jsx(Yi,{className:"block flex-1"})})})});return c?e.jsxs(e.Fragment,{children:[x&&k,e.jsx("div",{id:"thread-bottom",children:C}),!x&&k,s&&!m&&!n&&!a&&!l&&e.jsx(un,{verticalMargin:"none",verticalPadding:"none",horizontalPadding:"standard",children:e.jsx(dn,{children:e.jsx(Wg,{clientThreadId:t,currentModelId:i,isModelLoaded:o})})})]}):C};function Yg({clientThreadId:t,currentModelId:s,disableDraftPersistence:n=!1,isNewThread:a,onRequestCompletion:o,onContinueGenerating:i,onComposerInput:r,onComposerChange:c,onAutocompleteSelect:l,headerClassName:p,hideHeader:d,onTaggingDropdownClose:u,onTaggingDropdownOpen:m,onlyAllowImageUploads:h}){const{data:g,isLoading:x}=ts(),[b,S,C,k]=de(t,P=>{const Y=te.getCurrentNode(P);return[Y.message.clientMetadata?.errType!=null&&Y.message.clientMetadata.errType!=="info",Rp(te.getCurrentNode(P).message),P?.mode,P?.continuingFromSharedConversationId!=null]}),A=et(),E=ht(),j=Ep({clientThreadId:t}),{isOpen:I,onClose:_}=Mm({type:"just-hit-rate-limit"}),L=f.useMemo(()=>j?!1:!b&&S,[b,S,j]),O=j,v=Ai(t),z=hi(v).data,M=Tp(),U=z?.gizmo.tags?.includes(Ls.WorkspaceDisabled)&&!M?"workspaceDisallowsGizmo":g?.models.size===0?"noModelsAvailable":C?.kind===Ee.GizmoTest&&C.gizmo_id==null?"noTestGizmoId":null,q=hl(),W=Pm(),B=q.action==="moderate",{value:G}=ie("1860647109");return e.jsxs(e.Fragment,{children:[e.jsx(Rm,{composerController:E,clientThreadId:t,currentModelId:s,isCompletionInProgress:j}),e.jsx("div",{className:"flex justify-center empty:hidden",children:W&&B&&G?e.jsx(Em,{}):null}),I?e.jsx(Tm,{onClose:_}):null,e.jsx(Hg,{clientThreadId:t,disableDraftPersistence:n,onCreateNewCompletion:o,onContinueGenerating:i,currentModelId:s,account:A,modelCategories:g?.categories,currentModelConfig:$a(g?.models,s),areModelsLoading:x,isNewThread:a,isCompletionInProgress:j,className:"w-full",canContinue:L,disabled:!!U,disabledReason:U??void 0,canPause:O,isInteractableSharedThread:k,onComposerInput:r,onComposerChange:c,onAutocompleteSelect:l,headerClassName:p,hideHeader:d,onTaggingDropdownClose:u,onTaggingDropdownOpen:m,onlyAllowImageUploads:h},t)]})}export{Vi as B,Zn as C,Xf as D,dh as F,uh as I,mh as M,Xn as P,or as R,ph as T,Yg as a,ch as b,Lg as c,Jf as g,eo as h,oo as u};
//# sourceMappingURL=f35srtyza27o1d4v.js.map
