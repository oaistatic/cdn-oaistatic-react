const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/dq3pqr6d13y4aou5.js","assets/jfjoua4700kji9z3.js","assets/ls1hkjm4csy89kc5.js","assets/root-g83krhyb.css","assets/hj6jep7mk4776vwc.js","assets/conversation-small-hvit8l60.css","assets/kmym47afujuunb5s.js","assets/llskn1gyptsndib1.js","assets/maaa59io6z1tsugr.js","assets/lffgvq8meznwnms4.js","assets/gnihsipfzowq5klb.js","assets/gy64pge8qevmvg7e.js","assets/cr2ybjatckrmk16m.js","assets/g3dajzb0qfwp9r26.js","assets/cpr52vluyhgy2b7t.js","assets/bsithgh2jt2ne9l1.js","assets/cuigateqn8q8lgiz.js","assets/gjfwndu321zh29d1.js"])))=>i.map(i=>d[i]);
import{j as e,r as i,M as U,ao as Dn,am as Un,aj as Ms,a8 as O,d as Xs,f as Bn,a9 as fe,e as Ae,R as Hn,k as Gn}from"./ls1hkjm4csy89kc5.js";import{bm as Qs,da as On,kz as We,dG as Vn,mN as Js,mO as ws,mP as zn,lP as Wn,lS as qn,mQ as Zs,mR as $n,mS as Kn,mT as Me,mU as Yn,aO as et,mV as Xn,gy as Qn,gz as Jn,mG as me,eN as st,mD as Zn,my as te,b9 as ea,mW as tt,mX as sa,mY as ta,mZ as na,m_ as nt,eV as aa,eW as oa,eY as ra,m$ as ia,W as at,eX as la,mE as ot,n0 as rt,e8 as ca,n1 as da,n2 as ua,n3 as ma,mi as ga,n4 as ha,n5 as pa,n6 as fa,n7 as we,iI as it,aX as xa,iA as va,n8 as ba,as as ya,cb as _a,gu as ge,a5 as lt,aD as ct,n9 as dt,na as ut,ax as Sa,ay as mt,az as Ta,aA as gt,nb as ja,nc as Ca,nd as ka,ne as Ma,E as wa,cW as ht,cX as pt,c2 as ft,d as Ia,nf as Ea,ng as Na,c6 as Ra,e$ as Aa,d8 as Fa,nh as Pa,ni as xt,ac as La,nj as Da,g6 as Ua,ja as Ba,x as Ha,cd as vt,nk as Ga,gx as Oa,nl as Va,c4 as za,nm as Wa,k$ as qa,nn as $a,no as Ka,np as Ya,nq as Xa,ca as Qa,jo as Ja,gK as Za,nr as eo,c7 as so,ns as to,nt as no,jb as ao,nu as oo,nv as ro,kj as qe,nw as io,kk as Ne,nx as $e,d7 as lo,ny as co,nz as bt,gM as uo,bL as mo,jl as go,nA as ho,nB as po,nC as fo,nD as xo,mB as vo,nE as bo,nF as yo,nG as _o,nH as So,nI as To,nJ as jo,nK as Co,nL as ko,bb as Mo,nM as wo,aG as Io,jH as Eo,jI as No}from"./hj6jep7mk4776vwc.js";import{a as D,co as le,bX as ne,cp as de,gK as yt,bL as Ro,aj as ee,n as Is,F as L,D as Ke,B as A,b8 as he,bf as es,o as ce,E as Re,fG as Ao,b9 as _t,ak as ss,z,aA as Ye,R as St,cH as Tt,P as B,bF as Q,aL as ts,fw as jt,aG as pe,ea as Fo,cF as Y,cr as Po,dS as Lo,e7 as Do,ff as Uo,am as X,a_ as Bo,bz as Ho,h4 as Go,m as Ct,V as kt,T as Oo,cK as Mt,ag as wt,cJ as Vo,e4 as zo,dQ as Wo,cX as qo,I as It,l as Et,aH as Nt,cL as $o,en as Ko,fc as Yo,gi as Ge,ap as Xo,fe as Qo,M as Jo,ac as Es,gI as Zo,gJ as er,cq as sr,K as tr,db as Ns,fV as nr,gW as ar,b$ as or,fP as rr}from"./jfjoua4700kji9z3.js";import"./f06euqb6n9n90ph6.js";import{M as ir,O as lr}from"./c5hp2e6cf62lum4k.js";import{a as cr,G as dr}from"./ltik0hzezyevzkdj.js";import{C as Xe,F as ur}from"./lqfx7r9jl2q1tbdy.js";import{b as Rt}from"./oe4qwwp6lvtt8c1x.js";import{u as At}from"./jl416oerpm5p44nd.js";import{u as mr}from"./exdc9xpq8ubwzri2.js";const gr="bg-token-main-surface-primary text-token-text-primary",hr="openai",Rs=["bg-blue-300 text-white"];function pr(t){return Rs[(t?.charCodeAt(0)??0)%Rs.length]}const Ie=({children:t})=>e.jsx("div",{className:"pt-0",children:e.jsx("div",{className:D(i.isValidElement(t)&&t.type===We?"gizmo-bot-avatar":"gizmo-shadow-stroke","flex h-8 w-8 items-center justify-center overflow-hidden rounded-full"),children:t})});function Qe(t){const{messages:n,isUserTurn:a,avatarClassName:s,gizmo:o}=t,r="medium",d=n[0]?.metadata?.shared_conversation_id,c=d!=null,g=Qs(),{gizmoEditorData:u,mode:p}=On();let y=e.jsx(Ie,{children:e.jsx(We,{className:s??gr,iconName:hr,size:r})});return o?y=e.jsx(Ie,{children:e.jsx(cr,{gizmoId:o.gizmo.id,className:"h-full w-full"})}):u!=null&&p==="test"&&(y=e.jsx(dr,{isFirstParty:!1,src:u.profilePictureUrl,className:"h-8 w-8 first:pt-[3px]"})),e.jsx("div",{className:void 0,children:a?c?e.jsx(Ie,{children:e.jsx(We,{className:pr(d),iconName:"user",size:r})}):e.jsx(Ie,{children:e.jsx(Vn,{user:g,size:r})}):y})}const As=le(()=>de(()=>import("./dq3pqr6d13y4aou5.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(t=>t.MemoryActionResult));function Fs(t,n,a){he(t,s=>{es.updateTree(s,o=>{o.updateNodeMetadata(n,{inlineComparisonRating:a})})})}const Ps=({messages:t})=>{for(const{metadata:n}of t){const{paragen_display_label:a}=n??{};if(a)return a;const{augmented_paragen_prompt_label:s}=n??{};if(s)return s}};function fr(t){const n=i.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),a=i.useRef({left:null,right:null});return t.variantIds.length<2?e.jsx(Ft,{setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:n,firstVisibleTokenTimestampsRef:a,...t}):e.jsx(xr,{...t,visibilityStateRef:n,firstVisibleTokenTimestampsRef:a})}function xr(t){const{clientThreadId:n,variantIds:a,turnIndex:s,firstVisibleTokenTimestampsRef:o}=t;if(a.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const r=ns(),l=yt(),d=Ro(),[c,g]=a,u=i.useMemo(()=>Js(c+g)()>=.5,[c,g]),[p,y]=u?[g,c]:[c,g],[x,h,T]=ee(n,_=>{const R=Is(_).tree.getLeafFromNode(p).id,I=Is(_).tree.getLeafFromNode(y).id,S=L.getConversationTurns(_,R),E=L.getConversationTurns(_,I),w=s<S.length?S[s]:null,j=s<E.length?E[s]:null;return w||Ke.addError(`Paragen Left turn index ${s} out of bounds`,{turnIndex:s,turnCount:S.length,lastTurnRole:A(S)?.role,lastMessageAuthor:A(A(S)?.messages)?.author,lastMessageContentType:A(A(S)?.messages)?.content.content_type,lastMessageMetadata:A(A(S)?.messages)?.metadata,altTurnCount:E.length,altLastTurnRole:A(E)?.role,altLastMessageRole:A(A(E)?.messages)?.author.role}),j||Ke.addError(`Paragen Right turn index ${s} out of bounds`,{turnIndex:s,turnCount:E.length,lastTurnRole:A(E)?.role,lastMessageAuthor:A(A(E)?.messages)?.author,lastMessageContentType:A(A(E)?.messages)?.content.content_type,lastMessageMetadata:A(A(E)?.messages)?.metadata,altTurnCount:S.length,altLastTurnRole:A(S)?.role,altLastMessageRole:A(A(S)?.messages)?.author.role}),[R,w,j]}),[C,k]=u?[T,h]:[h,T],N=r?"skippable_parallel_2_in_stream:a:2.0":"skippable_parallel_2_in_stream:a:1.5";i.useEffect(()=>(ws.setState({displayingSideBySideFeedback:!0}),()=>{ws.setState({displayingSideBySideFeedback:!1})}),[]),zn();const F=i.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),m=i.useCallback((_,{shouldSubmitParagenFeedback:R=!0}={})=>{if(!h||!T||!C||!k)throw new Error("Expected both turns to exist");he(n,P=>{es.setCurrentBranch(P,_)});const I=_===p,S=_===c;C.messages.length>0&&Fs(n,C.messages[C.messages.length-1].id,S?"original":"new"),k.messages.length>0&&Fs(n,k.messages[k.messages.length-1].id,S?"original":"new");const E=ce(n),w=[h,T].map((P,$)=>({messageId:P.messages[P.messages.length-1].id,loadFirstTokenTime:$===0?o.current.left:o.current.right,loadEndTime:A(P.messages)?.clientMetadata?.completionSampleFinishTime})),j=I?w[0].messageId:w[1].messageId,f=L.getParentPromptNode(Re(n),x);if(!f)throw new Error("Expected prompt for side by side feedback");const v={},M=f.message.clientMetadata?.variantsInStreamInfo==null&&f.message.metadata?.paragen_variants_info!=null;for(const P of w)v[P.messageId]=M?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:P.loadFirstTokenTime,load_end_time:P.loadEndTime};R&&Gs({params:{conversation_id:E,displayed_message_ids:w.map(P=>P.messageId),message_metadatas:v,rating:"selected",selected_message_id:j,source_timestamp:Date.now(),ui_variant:r?2:1,user_prompt_message_id:f.message.id}})},[n,p,c,C,k,h,T,x,o,t.conversationTurnMountTime,r]);return i.useEffect(()=>Ao(_t,{requestCompletion:_=>{const R=ce(n),I=L.getParentPromptNode(Re(n),x);if(!I)throw new Error("Expected prompt for side by side feedback");if(!h||!T)throw new Error("Expected both turns to exist");const S=[h,T].map((f,v)=>({messageId:f.messages[f.messages.length-1].id,loadFirstTokenTime:v===0?o.current.left:o.current.right,loadEndTime:A(f.messages)?.clientMetadata?.completionSampleFinishTime})),E={},w=I.message.clientMetadata?.variantsInStreamInfo==null&&I.message.metadata?.paragen_variants_info!=null;for(const f of S)E[f.messageId]=w?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:f.loadFirstTokenTime,load_end_time:f.loadEndTime};const j=_.isForSkippingParagen;Gs({params:{conversation_id:R,displayed_message_ids:S.map(f=>f.messageId),message_metadatas:E,rating:j?"explicit_skipped":"skipped",selected_message_id:null,source_timestamp:Date.now(),ui_variant:j?3:r?2:1,user_prompt_message_id:I.message.id}}),j&&m(p,{shouldSubmitParagenFeedback:!1})}}),[h,T,x,n,t.conversationTurnMountTime,N,C?.messages,k?.messages,d,r,o,m,p]),e.jsx(Ft,{...t,setPreferredFeedback:m,leftVariantId:p,rightVariantId:y,leftTurn:h,rightTurn:T,hasActiveRequest:l,originalTurn:C,visibilityStateRef:F})}function Ft({setPreferredFeedback:t,leftVariantId:n,rightVariantId:a,leftTurn:s,rightTurn:o,hasActiveRequest:r,originalTurn:l,visibilityStateRef:d,...c}){const g=(s&&Ps(s))??null,u=(o&&Ps(o))??null,p=i.useMemo(()=>s?.messages??[],[s?.messages]),y=i.useMemo(()=>o?.messages??[],[o?.messages]),{avatarClassName:x,firstVisibleTokenTimestampsRef:h}=c,T=i.useMemo(()=>s?.messageGroups??[],[s?.messageGroups]),C=i.useMemo(()=>o?.messageGroups??[],[o?.messageGroups]),k=Wn(),N=Re(c.clientThreadId),F=A(s?.messages),m=A(o?.messages),_=ss(L.getRequestId(N,F?.id??m?.id)),R=_&&!F?.end_turn,I=_&&!m?.end_turn,S=s?.role===z.User,E=o?.role===z.User,w=i.useRef(null),j=i.useRef(null),f=i.useRef(null),v=s!=null,M=o!=null;!v&&h.current.left==null&&(h.current.left=Date.now()),!M&&h.current.right==null&&(h.current.right=Date.now()),i.useEffect(()=>{if(w.current&&j.current&&f.current){const se=Array(11).fill(0).map((ve,K)=>K/10),ue=new IntersectionObserver(ve=>ve.forEach(K=>{K.target===j.current?(d.current.left_visibility_initial==null&&(d.current.left_visibility_initial=K.intersectionRatio),d.current.left_visibility_max=Math.max(d.current.left_visibility_max??0,K.intersectionRatio)):K.target===f.current&&(d.current.right_visibility_initial==null&&(d.current.right_visibility_initial=K.intersectionRatio),d.current.right_visibility_max=Math.max(d.current.right_visibility_max??0,K.intersectionRatio))}),{root:w.current,threshold:se});return ue.observe(j.current),ue.observe(f.current),()=>ue.disconnect()}},[d]);const{data:P}=qn(void 0,!1,k),$=ns(),xe=e.jsx("div",{className:"text-token-text-secondary px-(--thread-content-margin) pt-1 pb-5 text-center text-sm text-pretty",children:e.jsx(U,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})});return e.jsxs("div",{className:"relative flex flex-col",children:[e.jsxs("div",{className:D("bg-token-main-surface-primary sticky top-[-1px] z-1 px-(--thread-content-margin) text-center text-lg text-pretty",$?"md:top-header-height":"md:static"),"data-testid":"paragen-feedback-title",children:[e.jsx(U,{id:"KKeSJV",defaultMessage:"You're giving feedback on a new version of ChatGPT."}),$?xe:null]}),$?null:xe,e.jsx("div",{className:D(Zs,"horzScrollShadows relative -mb-2 snap-x snap-mandatory overflow-x-auto overflow-y-clip pb-4"),ref:w,children:e.jsxs("div",{className:D("mx-auto box-content max-w-[calc(2*var(--thread-content-max-width))] min-w-min px-(--thread-content-margin)","flex items-start",$&&"divide-token-border-medium dark:divide-token-border-heavy divide-x",!$&&"gap-4 sm:gap-6"),children:[e.jsxs(Ls,{horizontalScrollContainerRef:w,rootElementRef:j,onClick:()=>{t(n)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:v,children:[e.jsxs(Bs,{children:[e.jsx(Qe,{messages:p,isUserTurn:S,avatarClassName:x}),e.jsx(Us,{children:e.jsx(U,{...Os.responseNumber,values:{responseIndex:1,display_label:g}})})]}),$&&v?e.jsx(Ds,{}):e.jsxs(e.Fragment,{children:[P!=null&&!S&&e.jsx(As,{clientThreadId:c.clientThreadId,messages:p,isParagen:!0}),e.jsx(Xe,{...c,allMessages:p,groupedMessagesToRender:T,allGroupedMessages:T,isUserTurn:S,isFinalUserTurn:!1,isCompletionRequestInProgress:R,hasActiveRequest:r,shouldGrowContainer:!1,isParagen:!0}),e.jsx(Hs,{clientThreadId:c.clientThreadId,conversationTurnMountTime:c.conversationTurnMountTime,turn:s,originalTurn:l})]})]}),e.jsxs(Ls,{horizontalScrollContainerRef:w,rootElementRef:f,onClick:()=>{t(a)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:M,children:[e.jsxs(Bs,{children:[e.jsx(Qe,{messages:y,isUserTurn:E,avatarClassName:x}),e.jsx(Us,{children:e.jsx(U,{...Os.responseNumber,values:{responseIndex:2,display_label:u}})})]}),$&&M?e.jsx(Ds,{}):e.jsxs(e.Fragment,{children:[P!=null&&!E&&e.jsx(As,{clientThreadId:c.clientThreadId,messages:y,isParagen:!0}),e.jsx(Xe,{...c,allMessages:y,groupedMessagesToRender:C,allGroupedMessages:C,isFinalUserTurn:!1,isUserTurn:E,isCompletionRequestInProgress:I,hasActiveRequest:r,shouldGrowContainer:!1,isParagen:!0}),e.jsx(Hs,{clientThreadId:c.clientThreadId,conversationTurnMountTime:c.conversationTurnMountTime,turn:o,originalTurn:l})]})]})]})})]})}function Ls({horizontalScrollContainerRef:t,rootElementRef:n,onClick:a,children:s,hasActiveRequest:o,isWaitingOnFirstUserVisibleToken:r}){const l=ns(),{scrollX:d}=Dn({layoutEffect:!1,container:t,target:n}),c=$n(),g=Kn(),u=i.useRef(null),p=i.useRef(null),y=i.useRef(null),[x,h]=i.useState(!1),[T,C]=i.useState(!1),[k,N]=i.useState(!1),[F,m]=i.useState(0);i.useEffect(()=>{if(!l)return;const j=new IntersectionObserver(f=>{for(const v of f)v.target===u.current?h(v.isIntersecting):v.target===y.current?N(v.isIntersecting):v.target===p.current&&C(v.isIntersecting)},{root:c?.current});return u.current&&p.current&&y.current&&(j.observe(u.current),j.observe(p.current),j.observe(y.current)),()=>{j.disconnect()}},[F,l,c]);const _=!k&&(T||x),R=Un(d,j=>_?-1*j:0),I=Ms(0);i.useEffect(()=>{if(!l)return;const j=new ResizeObserver(f=>{Me(f.length===1,"entryList.length === 1");const v=f[0];Me(v.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),I.set(v.contentBoxSize[0].inlineSize)});return n.current&&j.observe(n.current),()=>{j.disconnect()}},[l,I,n]);const S=Ms(0);i.useEffect(()=>{if(!l)return;const j=new ResizeObserver(f=>{Me(f.length===1,"entryList.length === 1");const v=f[0];Me(v.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),S.set(v.contentBoxSize[0].blockSize+16),m(v.contentBoxSize[0].blockSize)});return g.current&&j.observe(g.current),()=>{j.disconnect()}},[l,S,g]);const E=e.jsx(Tt,{className:l?"px-5":"mt-4 self-start",onClick:a,"data-testid":"paragen-prefer-response-button",children:e.jsx(U,{id:"U2EAH6",defaultMessage:"I prefer this response"})}),w=r;return e.jsx("div",{"data-paragen-root":!0,className:D("@container relative flex min-w-[min(450px,80cqw,80vw)] flex-1 snap-center flex-col gap-1 text-start",l?"min-h-60":"border-token-border-tertiary rounded-xl border shadow-lg shadow-black/3"),ref:n,children:e.jsxs("div",{className:D(Yn,Zs,"px-(--thread-content-margin) py-4"),children:[e.jsx("div",{className:D("absolute top-48 right-0! left-0! h-px","invisible"),ref:u}),e.jsx("div",{className:D("absolute top-48 right-0! bottom-0 left-0!","invisible"),ref:p}),e.jsx("div",{className:D("absolute right-0! bottom-0 left-0! h-px","invisible"),ref:y}),s,l?e.jsx("div",{className:"flex-1"}):null,l?e.jsx("div",{className:"mt-4 min-h-10",children:w?null:e.jsx(O.div,{style:{translateX:R,width:I,bottom:S},animate:{opacity:100},initial:{opacity:0},transition:{ease:"easeOut",duration:.2,delay:.5},className:D({fixed:_,"z-20 flex w-full justify-center":!0}),children:E})}):o?null:E]})})}function Ds(){return e.jsxs("div",{className:"flex w-full flex-col gap-4 pt-3 pb-5",children:[e.jsx(ie,{className:"h-4 w-[75%]"}),e.jsx(ie,{className:"h-4 w-[50%]"}),e.jsx(ie,{className:"h-4 w-[80%]"}),e.jsx(ie,{className:"h-4 w-[55%]"}),e.jsx(ie,{className:"h-4 w-[66%]"}),e.jsx(ie,{className:"h-4 w-[64%]"}),e.jsx(ie,{className:"h-4 w-[48%]"})]})}function ns(){const{layer:t}=Ye("3119715334");return t.get("should-enable-hojicha",!1)}const Us=ne.div`text-sm text-token-text-secondary font-semibold`,Bs=ne.div`flex gap-4 items-center mb-1`,ie=ne.div`animate-pulse rounded-[4px] bg-token-main-surface-tertiary`;function Hs({clientThreadId:t,conversationTurnMountTime:n,turn:a,originalTurn:s}){const o=et();if(!o.showParagenMetadata||!o.showDebugConversationTurns&&!o.forceParagen||a==null)return null;let r=a===s?"ORIGINAL":"NEW";const l=a.messages[a.messages.length-1],d=l?.metadata?.__internal,c=l?.metadata?.paragen_display_label;if(d){const{model_id:p,model_definition_slug:y,model_definition_virtual_model_id:x,alternative_model_selection_rule:h,augmented_paragen_prompt_group_id:T,augmented_paragen_prompt_id:C,augmented_paragen_prompt:k}=d;p&&(r+=`
Model ID: ${p}`),y&&(r+=`
Model Slug: ${y}`),x&&(r+=`
Virtual Model ID: ${x}`),h&&(r+=`
Alternative Model Rule: ${h}`),T&&(r+=`
Prompt Group ID: ${T}`),C&&(r+=`
Prompt ID: ${C}`),k&&(r+=`
Prompt: ${k}`),c&&(r+=`
Display Label: ${c}`)}r+=`
Message ID: ${l.id}`;const g=L.getParentPromptNode(Re(t),a.messages[0].id);if(!g)throw new Error("Expected prompt for side by side feedback");const u=g.message.clientMetadata?.variantsInStreamInfo==null&&g.message.metadata?.paragen_variants_info!=null;return r+=`
User prompt message ID: ${g.message.id}`,r+=`
Is Persisted Paragen? ${u}`,r+=`
Completion Sample Finish Time: ${u?`${n} (persisted)`:A(a.messages)?.clientMetadata?.completionSampleFinishTime}`,e.jsx("div",{className:"text-sm whitespace-pre-wrap text-red-500",children:r})}async function Gs({params:t}){await St.safePost("/paragen_submission",{requestBody:t,anonAware:!0})}const Os=Xs({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}{display_label}"}});function vr({handleShowRetrievalResults:t,clientThreadId:n,turnIndex:a,responseComplete:s=!1}){const[o,r]=ee(n,u=>[L.getTurnContentReferences(u,a),L.getConversationTurnAtIndex(u,a).messages]),l=i.useMemo(()=>({turnIndex:a,clientThreadId:n,responseComplete:s}),[n,s,a]),d=i.useRef(!1);i.useEffect(()=>{d.current||(d.current=!0,B.logEvent("File Sources Footer Shown",l))},[l]);const c=i.useCallback(()=>{B.logEvent("File Sources Footer Clicked",l),t()},[t,l]),g=i.useMemo(()=>{const u=new Set,p=[];function y(h){!h||u.has(h)||(u.add(h),p.push(h))}if(o.forEach(h=>{h.type==="file"?y(h.cloud_doc_url??h.extra?.cloud_doc_url):h.type==="file_navlist"&&h.items.forEach(T=>{y(T.cloud_doc_url)})}),s){for(const h of r)if(Xn(h)){const T=Qn(h.content.result),C=h.metadata?.cloud_doc_urls??[],k=T.chunks;for(let N=0;N<k.length;N++){const F=k[N];if(!F.documentId)continue;if(N<C.length){y(C[N]);continue}const m=F.documentId.endsWith("--google")?F.documentId.split("--")[1]:void 0,_=F.metadata.cloud_doc_url??(m?`https://drive.google.com/file/d/${m}`:void 0);y(_?.toString())}break}}const x=[];for(let h=0;h<p.length;h++){const T=p[h],C=Jn(T);if(C&&x.push(C.Icon),x.length>=3)break}return x},[r,o,s]);return e.jsxs(e.Fragment,{children:[e.jsx(O.div,{className:"absolute h-[60px]",initial:{opacity:0},animate:{opacity:1},children:e.jsxs("button",{className:D("not-prose group/footnote border-token-border-default bg-token-main-surface-primary hover:bg-token-main-surface-secondary mt-3 mb-2 flex w-fit items-center gap-1.5 rounded-xl border py-2","ps-3 pe-2.5"),onClick:c,children:[g.length>0&&e.jsx("div",{className:"flex flex-row-reverse gap-1",children:g.reverse().map((u,p)=>e.jsx(O.div,{className:D("border-token-main-surface-primary bg-token-main-surface-primary flex items-center overflow-hidden","group-hover/footnote:border-token-main-surface-secondary","relative"),initial:{opacity:0},animate:{opacity:1},children:e.jsx(u,{className:"icon-sm"})},p))}),e.jsx("div",{className:"text-token-text-secondary flex items-center gap-0.5 text-xs font-semibold",children:e.jsx(U,{id:"/48IOP",defaultMessage:"Sources"})})]})}),e.jsx("div",{className:"h-[60px]"})]})}function Pt({followups:t,analyticsMetadata:n}){const[a,s]=i.useState(-1),o=i.useRef(!1),r=At();return i.useEffect(()=>{o.current||(o.current=!0,t.forEach((l,d)=>{B.logEventWithStatsig("chatgpt_message_followup_action","chatgpt_message_followup_action",{...Q(n),action:"show",position:d+1,followup_text:me(l)})}))},[t,n]),e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex w-full flex-col",children:t.slice(0,4).map((l,d)=>e.jsxs(O.div,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:d*.03},exit:{opacity:0,translateY:4},onMouseEnter:()=>s(d),onMouseLeave:()=>s(-1),children:[d>0&&e.jsx(Lt,{$isSelected:a===d||a===d-1}),e.jsx(br,{followUp:l,onSelectingSuggestedReply:r,analyticsMetadata:n,position:d})]},d))})}const Lt=ne.div`
  h-[1px] opacity-45
  ${({$isSelected:t})=>t?"mx-2 bg-token-main-surface-secondary":"bg-token-border-default"}
`;function br({followUp:t,onSelectingSuggestedReply:n,analyticsMetadata:a,position:s}){return e.jsxs(O.button,{whileHover:"hover",className:"bg-token-main-surface-primary hover:bg-token-main-surface-secondary flex w-full cursor-pointer items-start justify-start gap-2 rounded-lg px-2 py-3 text-start",onClick:o=>{n(o,t,[],0),B.logEventWithStatsig("chatgpt_message_followup_action","chatgpt_message_followup_action",{...Q(a),action:"click",position:s+1,followup_text:me(t)})},onMouseEnter:()=>{B.logEventWithStatsig("chatgpt_message_followup_action","chatgpt_message_followup_action",{...Q(a),action:"hover",position:s+1,followup_text:me(t)})},children:[e.jsx(O.div,{className:"flex items-center justify-center pt-0.5 opacity-70",variants:{hover:{x:4}},initial:{x:0},transition:{duration:.1},children:e.jsx(st,{className:"text-token-text-secondary h-[18px] w-[18px]"})}),e.jsx("div",{className:"text-token-text-secondary pe-2 text-start text-sm",children:me(t)})]})}const yr=()=>e.jsx(Rt,{size:"lg",lines:3,width:35,widthVariance:10,className:"w-full"}),_r=t=>({[te.Search]:"Web Search",[te.Research]:"Research",[te.PictureV2]:"Draw Image",[te.Think]:"Think Harder"})[t]??"Title",Je=(t,n,a,s)=>{B.logEventWithStatsig("Capabilities Suggestion Action","chatgpt_capabilities_suggestion_action",{...Q(a),categoryId:n.categoryId,suggestionId:n.id,position:s,action:t})},Sr=(t,n)=>{const a=i.useRef(!1);i.useEffect(()=>{a.current||(a.current=!0,t.forEach((s,o)=>{Je("show",s,n,o+1)}))},[t,n])},Dt=({clientThreadId:t,suggestions:n,analyticsMetadata:a,style:s="default"})=>{const o=At();return Sr(n,a),e.jsx(e.Fragment,{children:n.map((r,l)=>e.jsxs(O.div,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},exit:{opacity:0,translateY:4},transition:{delay:l*.03},className:D("w-full flex-1",s==="compact"&&"flex-col"),children:[s==="compact"&&l>0&&e.jsx(Lt,{$isSelected:!1}),e.jsx(Tr,{clientThreadId:t,suggestion:r,onSelectingSuggestedReply:o,position:l+1,analyticsMetadata:a,style:s})]},r.prompt))})},Tr=({clientThreadId:t,suggestion:n,onSelectingSuggestedReply:a,analyticsMetadata:s,position:o,style:r="default"})=>{const{setThreadSystemHintMode:l}=Zn(),d=ts(),c=Bn();return e.jsx(O.button,{onClick:g=>{if(Je("click",n,s,o),n.categoryId===te.Research)if(d?.isFree()){ea(c,"Suggested Capabilities Upsell");return}else l(n.categoryId,!0,s);a(g,n,[],0)},onMouseEnter:()=>{Je("hover",n,s,o)},className:D("hover:bg-token-main-surface-secondary flex w-full flex-1 items-start rounded-xl text-start transition-colors duration-300 ease-in-out",r==="default"&&"gap-4 p-2"),children:r==="compact"?e.jsx(jr,{clientThreadId:t,suggestion:n}):e.jsx(Cr,{clientThreadId:t,suggestion:n})})},jr=({suggestion:t,clientThreadId:n})=>{const{categoryId:a}=t,{systemHints:s}=tt(n),o=s.find(r=>r.systemHint===a);return e.jsxs("div",{className:"bg-primary hover:bg-tertiary group flex w-full cursor-pointer items-center justify-start gap-2 rounded-lg px-2 py-3 text-start transition-colors duration-300 ease-in-out",children:[e.jsx("div",{className:"flex items-center justify-center opacity-70 transition-all duration-100 ease-in-out group-hover:scale-[1.02] group-hover:rotate-[-5deg] group-hover:opacity-100",children:a==="ask"?e.jsx(st,{className:"text-token-text-secondary group-hover:text-token-text-primary h-[18px] w-[18px]"}):e.jsx(jt,{svgString:o?.logo??"",className:"text-token-text-secondary icon-md group-hover:text-token-interactive-label-accent-default h-[18px] w-[18px]"})}),e.jsx("div",{className:"text-token-text-secondary group-hover:text-token-text-primary flex items-center pe-2 text-start text-sm",children:me(t)})]})},Cr=({clientThreadId:t,suggestion:n})=>{const{categoryId:a,imageUrl:s,description:o,title:r,ctaLabel:l,prompt:d}=n,{systemHints:c}=tt(t),g=c.find(u=>u.systemHint===a);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-token-border-default bg-primary relative h-16 w-14 flex-shrink-0 rounded-lg border drop-shadow-xs transition-all duration-100 ease-in-out group-hover:scale-[1.02] group-hover:rotate-[-2deg]",children:[a===te.PictureV2?e.jsx("div",{className:"flex h-full w-full items-center justify-center rounded-lg bg-cover",style:{backgroundImage:`url(${s})`},children:e.jsx(sa,{className:"icon-xl mb-2 text-white"})}):e.jsxs("div",{className:"flex flex-col gap-1.5 p-2",children:[e.jsx("div",{className:"text-token-text-primary text-[5px] leading-tight font-semibold tracking-tighter",children:r??_r(a)}),e.jsx("div",{className:"flex flex-col gap-0.5",children:Array.from({length:10}).map((u,p)=>e.jsx("div",{className:"bg-token-border-heavy h-[1px] w-full rounded-full"},p))})]}),e.jsx("div",{className:"absolute -end-2 -bottom-2",children:e.jsx(ta,{isBadge:!0,className:"opacity-100",logo:e.jsx(jt,{svgString:g?.logo??"",className:"icon-md"})})})]}),e.jsxs("div",{className:"flex flex-col gap-2 text-sm",children:[e.jsx("div",{className:"text-token-text-primary flex-grow",children:o??d}),l&&e.jsxs("div",{className:"text-token-text-secondary flex items-center font-medium",children:[l,e.jsx(O.div,{variants:{hover:{x:2}},initial:{x:0},transition:{duration:.1},children:e.jsx(na,{})})]})]})]})},Ze=(t,n,a,s)=>{B.logEventWithStatsig("Capabilities Tab Action","chatgpt_capabilities_tab_action",{...Q(a),tabId:n,position:s,action:t})},kr=(t,n)=>{const a=i.useRef(!1);i.useEffect(()=>{a.current||(a.current=!0,t.forEach((s,o)=>{Ze("show",s.value,n,o+1)}))},[t,n])},Mr=({clientThreadId:t,categorySuggestions:n,lastMessageId:a,analyticsMetadata:s,style:o="default"})=>{const r=n.map(({category_id:c,title:g,suggestions:u})=>({value:c,message:g,suggestions:u?.map(nt)??[]})),[l,d]=i.useState(r[0].value);return kr(r,s),e.jsxs(aa,{value:l,onValueChange:d,orientation:"horizontal",className:"flex w-full flex-col",children:[e.jsx(oa,{className:"border-token-border-default relative flex w-full flex-row gap-6 border-b",children:r.map((c,g)=>e.jsx(Ir,{value:c.value,message:c.message,isActive:l===c.value,analyticsMetadata:s,position:g+1},c.value))}),r.map(c=>e.jsx(ra,{value:c.value,children:e.jsx(wr,{initialSuggestions:c.suggestions,clientThreadId:t,categoryId:c.value,isActive:l===c.value,lastMessageId:a,analyticsMetadata:s,style:o})},c.value))]})},wr=({initialSuggestions:t,clientThreadId:n,categoryId:a,isActive:s,lastMessageId:o,analyticsMetadata:r,style:l="default"})=>{const d=ce(n),c=s&&t.length===0,{suggestions:g,isLoading:u}=ia({categoryId:a,shouldFetch:c,serverThreadId:d,lastMessageId:o}),p=c?g:t;return a==="ask"?u?e.jsx(yr,{}):e.jsx(Pt,{followups:p.map(y=>({type:at.Reply,text:y.prompt})),analyticsMetadata:r}):e.jsx("div",{className:"flex w-full flex-col gap-y-4 py-3 md:flex-row md:gap-x-4",children:u?e.jsxs(e.Fragment,{children:[e.jsx(Vs,{}),e.jsx(Vs,{})]}):e.jsx(Dt,{clientThreadId:n,suggestions:p,analyticsMetadata:r,style:l})})},Ir=({value:t,message:n,isActive:a,analyticsMetadata:s,position:o})=>e.jsxs(la,{className:"text-token-text-tertiary hover:text-token-text-secondary radix-state-active:text-token-text-primary relative flex min-w-10 justify-center py-4 text-sm font-medium",value:t,onClick:()=>{Ze("click",t,s,o)},onMouseEnter:()=>{Ze("hover",t,s,o)},children:[e.jsx("div",{className:"truncate",children:n}),e.jsx(fe,{children:a&&e.jsx(O.div,{layoutId:"tab-underline",className:"bg-token-text-primary absolute start-0 end-0 bottom-0 h-0.5",transition:{type:"spring",stiffness:500,damping:30}})})]}),Vs=()=>e.jsxs("div",{className:"flex flex-1 items-center gap-4 rounded-xl p-2",children:[e.jsx("div",{className:"bg-token-sidebar-surface-secondary dark:bg-token-border-default h-16 w-14 flex-shrink-0 rounded-lg"}),e.jsx("div",{className:"w-full flex-grow",children:e.jsx(Rt,{lines:3,size:"sm"})})]}),Er=({clientThreadId:t,categorySuggestions:n,lastMessageId:a,analyticsMetadata:s})=>{if(!n||n.length===0)return null;const o=n.length===1,r=n[0],l=r.suggestions.length>0?r.suggestions:void 0;return o&&l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-1 text-sm font-semibold",children:e.jsx(U,{id:"3UFIQc",defaultMessage:"Follow up"})}),e.jsx(Dt,{clientThreadId:t,suggestions:l.map(nt),analyticsMetadata:s,style:r.style})]}):e.jsx(Mr,{clientThreadId:t,categorySuggestions:n??[],lastMessageId:a,analyticsMetadata:s})};function Nr({clientThreadId:t,followups:n,categorySuggestions:a,lastMessageId:s,analyticsMetadata:o}){const[r,l]=i.useState(null),d=ot.useIsEnabled(t),{capabilitySuggestionsEnabled:c}=rt(),g=a&&a.length>0;return e.jsxs(e.Fragment,{children:[e.jsx(Fr,{visible:r==="conversation"}),e.jsx(Pr,{visible:r==="global"}),d&&(c?g&&e.jsx(Er,{clientThreadId:t,lastMessageId:s,categorySuggestions:a,analyticsMetadata:o}):n.length>0&&e.jsx(Rr,{clientThreadId:t,followups:n,analyticsMetadata:o,setDisableMessage:l}))]})}function Rr({clientThreadId:t,followups:n,setDisableMessage:a,analyticsMetadata:s}){const{value:o}=pe("2281969373");return e.jsxs("div",{className:"group",children:[e.jsxs("div",{className:"mb-1 flex items-center text-sm font-semibold",children:[e.jsx(U,{id:"3UFIQc",defaultMessage:"Follow up"}),!o&&e.jsx(Ar,{clientThreadId:t,setDisableMessage:a,analyticsMetadata:s})]}),e.jsx(Pt,{followups:n,analyticsMetadata:s})]})}function Ar({clientThreadId:t,setDisableMessage:n,analyticsMetadata:a}){const s=ot.useStore(),[o,r]=i.useState(!1);return e.jsxs(Fo,{size:"small",onOpenChange:l=>r(l),contentClassName:"min-w-[200px]",triggerButton:e.jsx("button",{className:"text-token-text-tertiary hover:bg-token-main-surface-tertiary ms-2 flex h-6 w-6 items-center justify-center rounded-md focus:ring-0 focus:outline-hidden",children:e.jsx(ca,{className:D("h-4 w-4 opacity-0 group-hover:opacity-100",o&&"opacity-100")})}),children:[e.jsx(Y.Item,{onClick:()=>{s.setDisabledConversation(t,!0),n("conversation"),setTimeout(()=>n(null),3e3),B.logEventWithStatsig("chatgpt_message_followup_setting","chatgpt_message_followup_setting",{...Q(a),action:"disable_conversation"})},className:"text-token-text-primary",children:e.jsx(U,{id:"GZYofd",defaultMessage:"Hide for this chat"})}),e.jsx(Y.Item,{onClick:()=>{s.setDisabledGlobally(!0),n("global"),setTimeout(()=>n(null),5e3),B.logEventWithStatsig("chatgpt_message_followup_setting","chatgpt_message_followup_setting",{...Q(a),action:"disable_globally"})},className:"text-token-text-primary",children:e.jsx(U,{id:"dtAOq4",defaultMessage:"Hide everywhere"})})]})}const Ut={initial:{opacity:1},animate:{opacity:1},exit:{opacity:0,transition:{duration:.2}}};function Fr({visible:t}){return e.jsx(fe,{children:t&&e.jsx(O.div,{...Ut,className:"text-token-text-tertiary flex justify-center py-6 text-sm",children:e.jsx(U,{id:"ckTD9g",defaultMessage:"Follow ups are turned off for this conversation"})})})}function Pr({visible:t}){return e.jsx(fe,{children:t&&e.jsxs(O.div,{id:"disableForAllConvos",...Ut,className:"flex flex-col items-center py-3 text-sm",children:[e.jsx("div",{children:e.jsx(U,{id:"5GDIBQ",defaultMessage:"Follow up have been turned off"})}),e.jsx("div",{className:"text-token-text-tertiary pt-1",children:e.jsx(U,{id:"LYaBNe",defaultMessage:"You can re-enable them in settings"})})]})})}function Lr({modelSlug:t,animateModelLabelOnRender:n,isDropdownOpen:a,isRegenerateEnabled:s,isHovered:o,animateShortLabel:r}){const{data:l}=Bo(),[d,c]=i.useState("initial");i.useEffect(()=>{if(n){const y=setTimeout(()=>c("show"),500),x=setTimeout(()=>c("initial"),2e3);return()=>{clearTimeout(y),clearTimeout(x)}}c("initial")},[n]);const{shorterLabel:g}=l?.categories.find(({defaultModel:y})=>y===t)??{},u={initial:{opacity:0,paddingLeft:0,width:"0"},show:{opacity:1,paddingLeft:2,width:"100%"},visible:{opacity:1,paddingLeft:2,width:"100%",transition:{delay:0,duration:0}}},p=a?"visible":o?"show":d;return e.jsxs(O.div,{initial:"initial",animate:p,className:"flex items-center pb-0",children:[e.jsx(it,{className:"icon-md"}),(s||r)&&e.jsx(O.span,{className:"overflow-hidden text-sm text-clip whitespace-nowrap",variants:u,transition:{type:"tween",duration:.18},children:g}),s&&e.jsx(xa,{className:"icon-sm"})]})}function Oe(t,n){const{modelSwitcherDeny:a,subscriptionLevel:s}=t;return!!a&&a.reason===Ho.RATE_LIMIT&&s===Go.PLUS&&!n}const Ee="rounded-lg radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed";function Dr({className:t,clientThreadId:n,message:a,onModelSelect:s,canRegenerateResponse:o}){const[r,l]=i.useState(null),[d,c]=i.useState(!1),[g,u]=i.useState(!1),p=a.metadata?.model_slug,y=a.id,x=i.useRef(null),h=F=>{F||setTimeout(()=>{x.current&&x.current.blur()},10)};if(i.useEffect(()=>{h(d)},[d]),ee(n,va))return null;const C=da(n,a.id),k=a.metadata?.model_slug,N=ba(C,k);return e.jsxs(Y.Root,{onOpenChange:F=>{o&&(k&&ua(n,k),c(F),h(F))},children:[o?e.jsx(Po,{sideOffset:0,label:e.jsx(U,{id:"wDs5sz",defaultMessage:"Switch model"}),children:e.jsx(Lo,{ref:x,className:D("cursor-pointer",t),onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),children:e.jsx(Lr,{modelSlug:k,animateModelLabelOnRender:N,isDropdownOpen:d,isRegenerateEnabled:o,isHovered:g})})}):null,o&&e.jsx(Y.Portal,{children:e.jsxs(Y.Content,{className:"text-token-text-primary z-30 min-w-fit origin-top-right",side:"bottom",align:"start",children:[e.jsx(Y.Item,{disabled:!0,className:"pt-2 pb-0",children:e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(U,{id:"bFLh5u",defaultMessage:"Switch model"})})}),e.jsx(Ur,{clientThreadId:n,messageId:y,message:a,onModelSelect:s,messageModelSlug:p,setHoveredOption:l,hoveredOption:r})]})})]})}function Ur({clientThreadId:t,message:n,messageId:a,messageModelSlug:s,onModelSelect:o,setHoveredOption:r,hoveredOption:l}){const d=Ae(),{data:c=null}=Do(),g=c&&Uo(c),{modelOptions:u,messageModelEnabledTools:p}=ma({clientThreadId:t,message:n}),y=p.includes(te.Search),x=i.useMemo(()=>u.find(m=>m.value===s),[u,s]),[h,T]=i.useMemo(()=>ga(u,m=>m.subcategory),[u]),C=ha(n);i.useEffect(()=>{const m=u.some(_=>Oe(_,g));B.logEvent("Conversation Open Message Model Selector",{has_get_plus_button:m,is_new_regen_dropdown:!0})},[]);const k=i.useMemo(()=>{const m=new Map;return h.forEach(_=>{const R=_.subcategory;R&&(m.has(R)||m.set(R,[]),m.get(R)?.push(_))}),m},[h]),N=D("icon-sm","order-10 ms-auto text-token-text-tertiary icon-md"),F=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:d.formatMessage(Ve.search),icon:e.jsx(pa,{className:N}),condition:y&&!C,eventName:"chatgpt_regenerate_with_search_button_clicked"},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:d.formatMessage(Ve.nosearch),icon:e.jsx(fa,{className:N}),condition:y&&C,eventName:"chatgpt_regenerate_without_search_button_clicked"}];return e.jsxs(e.Fragment,{children:[T.map(m=>{const{value:_,...R}=m;return e.jsx(we,{value:_,onSelect:I=>{X.logEvent("chatgpt_regenerate_switch_model_button_clicked",_,{requestedModelId:_,...Q({clientThreadId:t,messageId:a})}),o({sourceEvent:I,requestedModelId:_})},includeRegenerate:!1,onMouseEnter:()=>r(_),onMouseLeave:()=>r(null),isHovered:l===_,messageModelSlug:s,includeCheck:!1,shouldShowUpsell:Oe(m,g),className:Ee,...R,icon:e.jsx("span",{className:N}),clientThreadId:t},_)}),[...k.entries()].map(([m,_])=>e.jsxs(Y.Sub,{children:[e.jsx(Y.SubMenuTrigger,{children:e.jsx("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:m})}),e.jsx(Y.Portal,{children:e.jsx(Y.SubContent,{className:"min-w-fit",children:_.map(R=>{const{value:I,...S}=R;return e.jsx(we,{value:I,onSelect:E=>{X.logEvent("chatgpt_regenerate_switch_model_button_clicked",I,{requestedModelId:I,...Q({clientThreadId:t,messageId:a})}),o({sourceEvent:E,requestedModelId:I})},includeRegenerate:!1,onMouseEnter:()=>r(I),onMouseLeave:()=>r(null),isHovered:l===I,messageModelSlug:s,includeCheck:!1,className:Ee,...S,icon:null,shouldShowUpsell:Oe(R,g),clientThreadId:t},m+"-"+I)})})})]},m)),!!x&&e.jsxs(e.Fragment,{children:[e.jsx(Y.Separator,{}),e.jsx(we,{onSelect:m=>{X.logEvent("chatgpt_regenerate_try_again_button_clicked",x.value,{requestedModelId:x.value,...Q({clientThreadId:t,messageId:a})}),o({sourceEvent:m,requestedModelId:x.value})},includeRegenerate:!0,onMouseEnter:()=>r(x.value),onMouseLeave:()=>r(null),messageModelSlug:s,includeCheck:!1,className:Ee,...x,label:d.formatMessage(Ve.tryAgain),subtitle:x.label,icon:e.jsx(it,{className:N}),clientThreadId:t},x.value),F.filter(m=>m.condition).map(m=>e.jsx(we,{onSelect:_=>{X.logEvent(m.eventName,x.value,{requestedModelId:x.value,...Q({clientThreadId:t,messageId:a})}),o({sourceEvent:_,requestedModelId:x.value,extraStreamParams:m.extraStreamParams})},includeRegenerate:!1,onMouseEnter:()=>r(m.key),onMouseLeave:()=>r(null),isHovered:l===m.key,messageModelSlug:s,includeCheck:!1,className:Ee,...x,label:m.label,subtitle:"",icon:m.icon,clientThreadId:t},m.key))]})]})}const Ve=Xs({tryAgain:{id:"VbsBGW",defaultMessage:"Try again"},search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),Br=i.memo(Dr),Hr=le(()=>de(()=>import("./llskn1gyptsndib1.js"),__vite__mapDeps([7,2,1,3,8,9,4,5,10,11])).then(t=>t.VoicePlayButton)),Gr=le(async()=>Promise.resolve(()=>null)),Or=({alwaysShow:t,isUserTurn:n,children:a})=>{const s=i.useRef(null);return i.useEffect(()=>{const o=s.current;o&&(t?requestAnimationFrame(()=>{o&&(o.style.maskPosition=t?"0% 0%":"")}):o.style.maskPosition="")},[t]),e.jsx("div",{className:D("flex",!t&&"absolute start-0 end-0 flex",n?"justify-end":"justify-start"),children:e.jsx("div",{ref:s,className:D("touch:-me-2 touch:-ms-3.5 -ms-2.5 -me-1 flex items-center p-1 select-none",!n&&"-mt-1",t&&"duration-[1.5s]","focus-within:transition-none hover:transition-none",!(t||n)&&"duration-500 group-hover/turn-messages:delay-300",!n&&["pointer-events-none [mask-image:linear-gradient(to_right,black_33%,transparent_66%)] [mask-position:100%_0%] [mask-size:300%_100%] motion-safe:transition-[mask-position]","group-hover/turn-messages:pointer-events-auto group-hover/turn-messages:[mask-position:0_0]","group-focus-within/turn-messages:pointer-events-auto group-focus-within/turn-messages:[mask-position:0_0]","has-data-[state=open]:pointer-events-auto has-data-[state=open]:[mask-position:0_0]"],n&&["duration-300 group-hover/turn-messages:delay-300","pointer-events-none opacity-0 motion-safe:transition-opacity","group-hover/turn-messages:pointer-events-auto group-hover/turn-messages:opacity-100","group-focus-within/turn-messages:pointer-events-auto group-focus-within/turn-messages:opacity-100","has-data-[state=open]:pointer-events-auto has-data-[state=open]:opacity-100"]),children:a})})},Vr=({activeVariantIndex:t,clientThreadId:n,conversationMode:a,lastMessage:s,messages:o,numVariants:r,onChangeIndex:l,onRate:d,showCanvasButton:c,showCopyButton:g,showPagination:u,showPlayButton:p,showRatingButtons:y,showRegenerateButton:x,isJam:h,turn:T,turnIndex:C})=>{const k=Ct(),N=Ae(),F=kt(),m=s?.clientMetadata?.rating;s?.clientMetadata?.requestId;const _=o.findLast(v=>{const[M]=v.author.name?.split(".")??[];return M===Oo.T2UAY3K&&Mt.getImageAssetPointers(v).length>0}),R=!!_,I=wt(),S=ya(),E=_a(),w=ce(n),j=!h&&w!=null;let f=null;return j&&(_&&!I&&S()?f=e.jsx(qr,{clientThreadId:n,message:_}):E&&Vo(k,"1547743984").get("show_share_button_inline",!1)&&(f=e.jsx(ge,{onClick:()=>{w&&lt.openSharingModal(w)},label:N.formatMessage({id:"ConversationTurn.shareButtonTooltip",defaultMessage:"Share conversation"}),className:"sm:hidden",icon:ct}))),e.jsxs(e.Fragment,{children:[u&&e.jsx(dt,{currentPage:t,onChangeIndex:l,length:r}),!1,g&&e.jsx(Bt,{onClick:v=>{ut(k,n,C,F,v)}}),!R&&y&&e.jsxs(e.Fragment,{children:[m!=="thumbsDown"&&e.jsx(ge,{onClick:()=>d("thumbsUp"),disabled:m==="thumbsUp",icon:m==="thumbsUp"?Sa:mt,label:N.formatMessage({id:"ConversationTurn.goodResponseTooltip",defaultMessage:"Good response"}),testId:"good-response-turn-action-button"}),m!=="thumbsUp"&&e.jsx(ge,{onClick:()=>d("thumbsDown"),disabled:m==="thumbsDown",icon:m==="thumbsDown"?Ta:gt,label:N.formatMessage({id:"ConversationTurn.badResponseTooltip",defaultMessage:"Bad response"}),testId:"bad-response-turn-action-button"})]}),p&&s&&e.jsx(Hr,{conversationId:n,message:s,iconClassName:"icon-md",className:"text-token-text-tertiary hover:text-token-text-primary gap-1.5 rounded-md p-1 text-xs"}),!R&&c&&e.jsx(ja,{turn:T}),x&&s&&e.jsx(Wr,{clientThreadId:n,conversationMode:a,lastMessage:s,messages:o,hasImageGenMessage:R}),f]})},zr=({activeVariantIndex:t,clientThreadId:n,numVariants:a,onAnticipateEdit:s,onChangeIndex:o,onEnterEdit:r,showCopyButton:l,showEditMessageButton:d,showPagination:c,turnIndex:g})=>{const u=Ct(),p=kt();return e.jsxs(e.Fragment,{children:[l&&e.jsx(Bt,{onClick:y=>{ut(u,n,g,p,y)}}),d&&e.jsx(Ca,{onAnticipateEdit:s,onEnterEdit:r}),c&&e.jsx(dt,{currentPage:t,onChangeIndex:o,length:a})]})},Wr=({clientThreadId:t,conversationMode:n,messages:a,hasImageGenMessage:s,lastMessage:o})=>{const r=ka({clientThreadId:t,conversationMode:n}),l=Ma(t,o),d=i.useCallback(({sourceEvent:c,requestedModelId:g,appendMessages:u,extraStreamParams:p})=>{o&&r({sourceEvent:c,nodeId:o.id,requestedModelId:g,appendMessages:u,extraStreamParams:p})},[o,r]);return s?e.jsx(Gr,{messages:a,onModelSelect:d}):e.jsx(Br,{className:"text-token-text-secondary hover:bg-token-main-surface-secondary touch:px-2.5 h-[30px] rounded-md px-1.5",clientThreadId:t,message:o,onModelSelect:d,canRegenerateResponse:l})},Bt=({onClick:t})=>{const[n,a]=i.useState(!1),s=wa(),o=Ae(),r=i.useCallback(l=>{l.stopPropagation(),B.logEvent("ChatGPT Turn Action Copy Clicked"),t(l),a(!0),setTimeout(()=>{s()&&a(!1)},2e3),X.logEvent("chatgpt_turn_action_copy")},[s,t]);return e.jsx(ge,{icon:n?zo:Wo,onClick:r,label:o.formatMessage({id:"CopyButton.copyTooltip",defaultMessage:"Copy"}),testId:"copy-turn-action-button"})};function qr({clientThreadId:t,message:n}){const[a,s]=i.useState(!1),o=Ae(),r=mr({clientThreadId:t,messageId:n.id});return i.useEffect(()=>{B.logEventWithStatsig("Share Post: Share Button Shown","chatgpt_post_share_button_shown",{source:"turn_action"})},[]),e.jsx(ge,{onClick:async()=>{s(!0);try{await r()}finally{s(!1)}B.logEventWithStatsig("Share Post: Share Button Clicked","chatgpt_post_share_button_clicked",{source:"turn_action"})},label:o.formatMessage({id:"ConversationTurn.sharePostButtonTooltip",defaultMessage:"Share"}),icon:a?qo:ct,disabled:a})}const zs=[1,2,3,4,10,20,30],$r=1,Kr=["g-67e595af0a408191b84ee532fca12cd1","g-67ec3b78892481918c89067962526695","g-67ec3b4988f8819184c5454e18f5e84b","g-67ec3ad40750819181ccffa6a6f050d5","g-67edaaa3d3a081918205d0c470f00a32","g-67edab030ac881918ce8fa5c75a8e1b3","g-67edab2fc0f48191881a20ac98fedf6f","g-67edab4a24fc8191b975acaa8da2dcef"];function Yr({clientThreadId:t}){const n=ht(pt.isBusinessWorkspace),a=ft(),s=i.useRef(!1),o=It(t),[r,l,d,c]=ee(t,f=>[f?.mode,L.getRequestId(f),L.getConversationLastTurn(f),L.getConversationTurns(f).filter(v=>v.role===z.Assistant).length]),{isUnauthenticated:g}=Et(),u=i.useMemo(()=>{if(!o)return-1;const f=Js(o);return f()>$r?-1:zs[Math.floor(f()*zs.length)]},[o]),p=ss(l),y=function(){return Math.random()<.5?"default":"personality_v1"},[x,h]=i.useState(null),[T,C]=i.useState(!1),[k,N]=i.useState(!1),[F,m]=i.useState(!1),[_,R]=i.useState(y),I=(f,v)=>{const M=d?.messages[0]?.id;h(f),R(v),E(M,f,v)},S=d?.role===z.Assistant,E=i.useMemo(()=>Ia((f,v,M)=>{o&&f&&(n&&a?Ea({rating:Ra(v),shown_at_assistant_turn:u,prompt:M},o,f):n||St.safePost("/conversation/{conversation_id}/rating",{parameters:{path:{conversation_id:o}},requestBody:{message_id:f,rating:v,shown_at_assistant_turn:u,prompt:M},anonAware:!0})),B.logEvent("Conversation Rating Submitted",{rating:v,showAtAssistantTurn:u,conversationId:o,prompt:M}),C(!0),setTimeout(()=>{N(!0)},1500)},2e3),[n,a,o,u]),w=c!==u||p||!S||!!n&&!a||r?.kind!==Nt.PrimaryAssistant&&r?.gizmo_id!==void 0&&!Kr.includes(r?.gizmo_id)||F||g;i.useEffect(()=>{!w&&!s.current&&(B.logEvent("Conversation Rating Shown",{showAtAssistantTurn:u,conversationId:o}),s.current=!0)},[w]);const j=Na();return F||!j.forceShowConvoRating&&w?null:e.jsxs("div",{className:"mx-auto",children:[e.jsx(fe,{children:T&&!k&&e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(Ws,{$padded:!0,children:e.jsx("span",{className:"text-token-text-tertiary text-sm",children:e.jsx(U,{id:"rating.thanks",defaultMessage:"Thanks for your feedback!"})})})},"submitted")}),!T&&e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},children:e.jsxs(Ws,{$padded:!1,children:[e.jsxs("div",{className:"text-token-text-secondary flex items-center justify-center gap-4 px-4 py-3 text-sm",children:[_==="personality_v1"?e.jsx(U,{id:"rating.instructions.personality_v1",defaultMessage:"Do you like this personality?"}):e.jsx(U,{id:"rating.instructions.default",defaultMessage:"Is this conversation helpful so far?"}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx(ze,{$selected:x==="thumbsUp",onClick:()=>I("thumbsUp",_),children:e.jsx(mt,{className:"icon-md"})}),e.jsx(ze,{$selected:x==="thumbsDown",onClick:()=>I("thumbsDown",_),children:e.jsx(gt,{className:"icon-md"})})]})]}),e.jsx("div",{className:"bg-token-main-surface-tertiary w-px flex-1 self-stretch"}),e.jsx(ze,{className:"p-3",$selected:!1,onClick:()=>m(!0),children:e.jsx($o,{className:"icon-md text-token-text-secondary hover:text-token-text-primary"})})]})},"rating")]})}const ze=ne.button`
  ${t=>t.$selected?"text-token-text-primary":"text-token-text-secondary"}
  hover:text-token-text-primary
`,Ws=ne.div`inline-flex rounded-xl border border-gray-100 dark:border-gray-700
${t=>t.$padded&&"py-3 px-4"}
`,Xr=le(()=>de(()=>import("./cr2ybjatckrmk16m.js"),__vite__mapDeps([12,2,1,3,4,5,13])));function Qr({clientThreadId:t,canShowInlineMessageFeedback:n,messageForRating:a,allGroupedMessages:s,currentModelId:o}){const r=ts()?.isWorkspacePlan()??!1;let l=null;const d=ee(t,y=>{const x=L.getConversationTurns(y);let h=0;for(let T=x.length-1;T>=0;T--){const C=x[T];if(C.messages.some(k=>k.metadata?.is_indepth_feedback))return!0;if(C.messages.some(k=>k.author.role===z.Assistant)&&h++,h>=3)break}return!1}),c=It(t),g=Aa(y=>y.voiceFeedbackThread),u=c===g,{voiceName:p}=Fa();return d?null:(u&&c&&!r?(Ko.feedbackShown.success({voice:p}),l=e.jsx("div",{className:"text-center",children:e.jsx(Pa,{serverThreadId:c})})):a.clientMetadata?.rating&&n?l=e.jsx(Xr,{clientThreadId:t,conversationMessage:a,allGroupedMessages:s,currentModelId:o}):l=e.jsx("div",{className:"text-center",children:e.jsx(Yr,{clientThreadId:t})}),e.jsx("div",{className:"mt-3 w-full empty:hidden",children:l}))}const Jr=le(()=>de(()=>import("./dq3pqr6d13y4aou5.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(t=>t.MemoryActionResult)),Zr=le(()=>de(()=>import("./cpr52vluyhgy2b7t.js"),__vite__mapDeps([14,2,4,1,3,5,15,16])).then(t=>t.AutomationSourceHeader)),qs=le(()=>de(()=>import("./gjfwndu321zh29d1.js"),__vite__mapDeps([17,2,1,3,4,5])).then(t=>t.TextMessageEditor)),$s=80,ei=16,Ks={minHeight:`calc(100dvh - ${co}px - 120px)`};function si(t){const{turnIndex:n,isFinalTurn:a,clientThreadId:s,onRequestCompletion:o,currentModelId:r,avatarClassName:l,showAvatar:d,scrollToMessageId:c,dateHeaderType:g}=t,{isNewScrollEnabled:u}=xt(),p=Qs();ts()?.normalizedAccountUserId;const y=!!p&&Yo(p),x=La(),h=ht(pt.isBusinessWorkspace),T=bt(),{value:C}=pe("1760640904"),{value:k}=pe("1456513860"),N=d??!k,m=null!=null,{value:_}=pe("1887864177"),{capabilitySuggestionsEnabled:R}=rt(),I=Da(),[S,E]=ee(s,b=>{const G=L.getConversationTurnAtIndex(b,n),q=n>0?L.getConversationTurnAtIndex(b,n-1):null,H=q?.role===z.User&&q.messages.some(V=>V.metadata?.visually_hide_response_from_conversation);return[G,H]}),{messages:w,messageGroups:j}=S,f=Ua(),v=w[0],M=A(w),{messages:P,visibleMessages:$,messageGroups:xe,lastMessageToRender:se,doesTurnHaveDelayedMessages:ue}=i.useMemo(()=>{const b=f.size===0?-1:j.findIndex(V=>V.type===Ge?V.groups.some(oe=>oe.messages.some(Be=>f.has(Be?.id))):V.messages.some(oe=>f.has(oe?.id))),G=b!==-1&&b+1<j.length,q=G?j.slice(0,b+1):j,H=G?q.flatMap(V=>V.type===Ge?V.groups.flatMap(oe=>oe.messages):V.messages):w;return{messages:H,visibleMessages:H.filter(Xo),messageGroups:q,lastMessageToRender:A(H),doesTurnHaveDelayedMessages:b!==-1}},[w,j,f]),ve=i.useMemo(()=>({clientThreadId:s,turnIndex:n,messageId:M?.id}),[s,n,M?.id]),K=!1,[as,os]=i.useState(!1),[Ht,Gt]=i.useState(!1),Ot=i.useContext(Ba)!=null,W=S.role===z.User,rs=wt(),be=Qo(s),Fe=Ha(S.gizmoId??be).data,Pe=vt(s),Vt=Ga(s),is=Oa(Pe),zt=Va(Pe,Vt),ls=ft(),[ye,Wt,qt,cs,Le,li,$t,Kt,Yt,ds,Xt,ae,us]=ee(s,b=>{const G=L.getParentPromptNode(b,v.id),q=G?.message.clientMetadata?.variantsInStreamInfo??(G?.message.metadata?.paragen_variant_choice?void 0:G?.message.metadata?.paragen_variants_info),H=L.getVariantIds(b,v.id),V=L.getCurrentVariantId(b,v.id),oe=L.getIsDoNotRemember(b),Be=V?H.indexOf(V):0,Ln=q&&b?.tree!=null&&H.some(re=>{const{errType:ks}=b.tree.getLeafFromNode(re).message.clientMetadata??{};return ks!=null&&ks!=="info"}),He=L.getConversationTurns(b);return[b?.async_status===Es.STREAMING,L.isMessageTurnEnded(b,M?.id),Ln,uo(b?.mode,Fe?.gizmo.id),b?.continuingFromSharedConversationId!=null,null,He.findIndex(re=>re.role===z.User)===n,tr(He,re=>re.role===z.User)===n,He.findIndex(re=>re.role===z.Assistant)===n,L.getRequestId(b,M?.id),q,H,Be,oe]});let Qt="default";const Jt=P.some(b=>b.content.content_type===Jo.MultimodalText),{layer:Zt}=Ye("3119715334"),en=Zt.get("should-enable-skip",!1),{isUnauthenticated:ms}=Et(),gs=S.messages.map(b=>b.id),J=i.useRef(null),hs=!u&&(c?.length??0)>2&&c!=="finalAgentTurn"&&a&&T,_e=W?A($):void 0,De=_e?.id,sn=i.useCallback(()=>{De&&(B.logEvent("Edit Prompt",{id:De,threadId:ce(s)}),X.logEvent("chatgpt_edit_prompt"),os(!0))},[De,s]),tn=i.useCallback(()=>{os(!1)},[]),ps=za()??!1,{onChangeRating:nn}=Wa({clientThreadId:s,currentModelConfig:Pe}),an=b=>{if(!M)return;nn({nodeId:M.id,messageId:M.id,rating:b});const G=ps&&j.some(q=>q.type!==Ge&&q.messages?.some(mo));B.logEventWithStatsig(b==="thumbsDown"?"Message Feedback Thumbs Down Clicked":"Message Feedback Thumbs Up Clicked","chatgpt_thumb_feedback",{id:M.id,threadId:ce(s),model:r,rating:b,...ps?{isCATriggered:G}:{}}),Gt(!0)},[on]=i.useState(()=>Date.now()),rn=qa(s),{layer:ln}=Ye("109457",{shouldLogExposure:!1}),fs=ee(s,b=>rn&&L.getConversationTurns(b).filter(G=>G.role===z.Assistant).length<=ln.get("onboarding_inject_cards_position",3)),xs=ds!=null,cn=ss(ds),Z=!Wt&&cn||ue,vs=yt(),[dn,bs]=i.useState(xs),ys=i.useRef(!1),un=$a(s,M),[,mn]=Gn();i.useEffect(()=>{const G=new URLSearchParams(window.location.search).get("message");!(G!=null&&gs.includes(G))||!J.current||(J.current.scrollIntoView({behavior:"instant"}),mn(H=>(H.delete("message"),H),{replace:!0,preventScrollReset:!0}))},[]),i.useEffect(()=>{if(u)return;const q=new URLSearchParams(window.location.search).get("message")!=null;if(ys.current||q||c===void 0||!T||!J.current){c==="finalAgentTurn"&&a&&he(s,H=>{H.scrollToMessageId=void 0});return}(gs.includes(c)||c==="finalAgentTurn"&&a)&&(ys.current=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(J.current)if(c==="finalAgentTurn"&&a)J.current.scrollIntoView({behavior:"instant",block:"end"}),he(s,H=>{H.scrollToMessageId=void 0});else{const H=J.current.offsetHeight;let V;H>$s?V=$s-H:V=0,J.current.style.scrollMarginTop=`${V+ei}px`,J.current.scrollIntoView({behavior:"smooth"})}})}))},[c,J.current]);const{showDebugConversationTurns:gn}=et(),hn=Ka(),pn=!x&&!Le&&!rs&&!W,fn=Ya(),xn=se?.author.role===z.Assistant?se:null,vn=se?.metadata?.system_hints?.includes(te.Research);Xa({isCompletionRequestInProgress:Z,isUserTurn:W,message:xn});const{isOpen:bn}=Qa(),yn=Ja(),Se=Za(cs),Te=!fn&&!Se&&pn&&a&&Xt?.num_variants_in_stream===2&&ae.length<=2&&!M?.clientMetadata?.inlineComparisonRating&&!qt,je=a&&xs,_n=eo(s)?.value===Es.STREAMING,Sn=(dn||je)&&!as&&!x&&!Le&&!Se&&!ye&&!Z&&!bn&&!fs&&!_n&&S.role!==z.Developer,Tn=P.some(b=>Zo(b)===er.l1239dk1),jn=je&&!Z&&!Le&&!x&&!Tn&&(_||I||R),Ce=M!=null&&!m&&(!h||zt||y||ls)&&!Se&&!ms&&!rs&&!M.metadata?.b1de6e2_s,Cn=(!h||ls)&&Ce&&je&&!ye&&!Z,_s=!x&&!((Z||ye)&&a)&&ae.length>1&&!Te&&!m&&!fs,Ss=W&&P.some(b=>so(b)?.shouldHideContent),kn=W&&_e!=null&&!Se&&!x&&!Jt&&!Ss&&!ms&&!m&&!vn,Mn=M!=null&&(M.clientMetadata?.disclaimers??[]).length===0,Ts=i.useCallback(b=>{he(s,G=>{es.setCurrentBranch(G,ae[b])}),B.logEvent("Change Active Node",{intent:"toggle_between"})},[s,ae]),wn=to(S,P,gn),{toggleThreadSidebar:js}=sr(),ke=M?.id,In=i.useCallback(()=>{ke&&js({type:"retrievalResults",clientThreadId:s,turnIndex:n,messageId:ke})},[ke,js,s,n]),En=i.useMemo(()=>no(S,is,!!be),[is,be,S]);if(!wn&&!Te)return hs?e.jsx("div",{style:Ks}):null;if(E)return null;const Nn=se?.metadata?.followup_prompts?se.metadata.followup_prompts.map(b=>({text:b,type:at.Reply})):[],Rn=se?.metadata?.category_suggestions,An=!P.some(b=>Mt.getAudioAssetPointers(b).length>0)&&!m&&!be,Fn=!Z&&P.some(b=>b.author.role===z.Assistant&&b.metadata?.onboarding?.main_usages),Ue=P.find(b=>!!b.metadata?.onboarding?.examples)?.metadata?.onboarding?.examples,Cs=!Ss&&(!W||C)&&(!a||!Z);if(hn&&!m&&!a&&$.length===0)return null;const Pn=!a&&S.messages.some(b=>b.clientMetadata?.isLastMessageFromSharedConversation);return e.jsxs(ao.Provider,{value:Yt,children:[e.jsx(oo,{dateHeaderType:g,turn:S}),e.jsxs("article",{className:D("text-token-text-primary w-full",!u&&c==="finalAgentTurn"&&T?"opacity-0":"",{hidden:Ot&&$t}),style:hs?Ks:void 0,ref:J,dir:"auto","data-testid":`conversation-turn-${n}`,"data-scroll-anchor":!u&&a,children:[e.jsx(ro,{role:S.role}),e.jsxs(qe,{verticalPadding:Qt,horizontalPadding:Te?"none":"standard",children:[Te?e.jsxs(e.Fragment,{children:[e.jsx(fr,{isFeedbackEnabled:Ce,variantIds:ae,conversationTurnMountTime:on,...t}),en&&e.jsx("div",{className:"mt-4 flex w-full justify-center",children:e.jsxs(Tt,{color:"secondary",className:"text-token-text-primary","data-testid":"paragen-skip-button",onClick:()=>{_t.publish({kind:"requestCompletion",isForSkippingParagen:!0})},children:[e.jsx(io,{className:"text-token-text-secondary me-1"}),e.jsx(U,{id:"IuTr+b",defaultMessage:"Skip"})]})})]}):e.jsx(Ne,{tabIndex:-1,className:"group/turn-messages focus-visible:outline-hidden",onFocus:()=>bs(!0),onPointerEnter:()=>bs(!0),children:e.jsxs(e.Fragment,{children:[K,!W&&!K&&N&&e.jsx(ni,{children:e.jsx(Qe,{messages:P,isUserTurn:W,avatarClassName:l,gizmo:Fe})}),e.jsx("div",{className:$e({isUserTurn:W}),children:e.jsx("div",{className:"relative flex-col gap-1 md:gap-3",children:e.jsxs(e.Fragment,{children:[null,!W&&!x&&e.jsx(Jr,{messages:P,clientThreadId:s,gizmoId:Fe?.gizmo.id}),yn&&!W&&e.jsx(Zr,{clientThreadId:s,messages:P}),as&&_e?e.jsx(qs,{message:_e,clientThreadId:s,onRequestCompletion:o,onExitEdit:tn,disabled:vs}):e.jsx(Xe,{allMessages:w,groupedMessagesToRender:xe,allGroupedMessages:j,...t,isUserTurn:W,isFinalUserTurn:Kt,isCompletionRequestInProgress:Z,isFeedbackEnabled:Ce,isFinalTurn:a,hasActiveRequest:vs}),En&&e.jsx(vr,{handleShowRetrievalResults:In,clientThreadId:s,turnIndex:n,responseComplete:!(Z||ye)}),Fn&&e.jsx(ir,{clientThreadId:s}),Ue&&Ue.length>0&&!Z&&e.jsx(lr,{clientThreadId:s,examples:Ue}),Sn&&e.jsx(Or,{isUserTurn:W,alwaysShow:je,children:W?e.jsx(zr,{activeVariantIndex:us,clientThreadId:s,numVariants:ae.length,onAnticipateEdit:qs.prefetch,onChangeIndex:Ts,onEnterEdit:sn,showCopyButton:Cs,showEditMessageButton:kn,showPagination:_s,turnIndex:n}):e.jsx(Vr,{activeVariantIndex:us,clientThreadId:s,conversationMode:cs,lastMessage:M,messages:P,numVariants:ae.length,onChangeIndex:Ts,onRate:an,showCanvasButton:un&&!m,showCopyButton:Cs,showPagination:_s,showPlayButton:Mn,showRatingButtons:Ce,showRegenerateButton:An,isJam:m,turn:S,turnIndex:n})}),Cn&&e.jsx(Qr,{canShowInlineMessageFeedback:Ht,clientThreadId:s,messageForRating:M,allGroupedMessages:j,currentModelId:r}),jn&&e.jsx(Nr,{followups:Nn,categorySuggestions:Rn,clientThreadId:s,lastMessageId:ke,analyticsMetadata:ve})]})})})]})}),Pn&&e.jsx("div",{className:"mx-auto mt-8 -mb-2 flex justify-center",children:e.jsxs("p",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(lo,{className:"icon-xs me-2"}),e.jsx(U,{id:"threadLayout.sharedConversationPrivateDisclaimer",defaultMessage:"Messages beyond this point are only visible to you"})]})})]})]})]})}const ti=Hn.memo(si),ni=ne.div`shrink-0 flex flex-col relative items-end`;function ai(t){const n=L.getConversationTurns(t),a=n.findIndex(o=>o.role===z.Assistant);if(a===-1)return;const s=n[a];for(let o=0;o<s.messageGroups.length;o++)if(s.messageGroups[o].type===Ns.SearchGPTQuery){const l=s.messageGroups.slice(o+1).find(({type:c})=>c===Ns.Text);if(l==null)return;const d=nr(l.messages[0]);if(d?.[0]?.type==="navigation")return{turnIndex:a,navigationCitation:d[0],message:l.messages[0]}}}function oi(t,n){if(n==null||t==null)return t;const a=new Set(t.domains.map(s=>s.url));return{...t,domains:[...t.domains,...n.domains.filter(s=>!a.has(s.url))],safe_urls:[...t.safe_urls??[],...n.safe_urls??[]]}}function ri({clientThreadId:t,prefetchNavlink:n,setPrefetchNavlink:a}){const s=i.use(n),{value:o}=pe("1032814809");i.useEffect(()=>{window.__oai_SSR_NAVLINK&&go.logEvent("Search Tool Page Load Time To Fast Nav SSR",{server_timing:s?.timing},window.__oai_SSR_NAVLINK)},[]),i.useEffect(()=>{s==null&&a(void 0)},[s,a]);const r=i.useMemo(()=>s==null?null:{...s.navlink,domains:s.navlink.domains.map(c=>({...c,subtitle:c.subtitle??c.domain}))},[s]),l=ee(t,ai),d=i.useMemo(()=>oi(r,l?.navigationCitation),[l,r]);return s==null||d==null?null:e.jsxs("div",{children:[e.jsx(qe,{horizontalPadding:"standard",children:e.jsx(Ne,{children:e.jsx("div",{className:$e({isUserTurn:!0}),children:e.jsx("div",{className:ho(!0),children:e.jsx(po,{containsImagesOrAttachments:!1,isUserTurn:!0,children:e.jsx(fo,{text:s.query})})})})})}),e.jsx("div",{className:"-mb-10",children:e.jsx(qe,{horizontalPadding:"standard",children:e.jsx(Ne,{children:e.jsxs("div",{className:$e({isUserTurn:!1}),children:[e.jsx(ur,{clientThreadId:t,turnIndex:l?.turnIndex??2,nextMessage:l?.message,navigationCitation:d}),o?e.jsxs("div",{className:"text-token-text-secondary relative -top-2 flex justify-end gap-2 font-mono text-xs",children:[e.jsxs("div",{elementtiming:"navlink",children:["server: ",s.timing,"ms"]}),e.jsx(ii,{})]}):null]})})})}),e.jsx(xo,{scriptSrc:"requestAnimationFrame(()=>window.__oai_SSR_NAVLINK=window.__oai_SSR_NAVLINK||performance.now());"})]})}function ii(){const[t,n]=i.useState(null);return i.useEffect(()=>{const a=new PerformanceObserver(s=>{s.getEntries().forEach(o=>{if(o.identifier==="navlink"){const r=o.renderTime;n(l=>l??r)}})});return a.observe({type:"element",buffered:!0}),()=>a.disconnect()},[]),t==null?null:e.jsxs("span",{children:["render: ",t,"ms"]})}function _i({onRequestCompletion:t,clientThreadId:n,scrollContainerRef:a,prefetchNavlink:s,setPrefetchNavlink:o}){const[r,l,d,c]=ee(n,v=>[v?.mode,L.getConversationTurnIds(v),v?.conversationOrigin===ar.APPLE,v?.scrollToMessageId]),{isNewScrollEnabled:g}=xt(),u=vo(),p=bo(),y=bt(),x=yo(),[h]=_o(),T=So(),[C]=To(),k=vt(n),N=u.store.useContentAreaDimensions(jo.Header,v=>v?.height?v.height:void 0),F=Co(k.id),m=r?.kind===Nt.GizmoMagicCreate?"bg-token-main-surface-primary text-token-text-primary":F;i.useEffect(()=>{p&&(X.logEvent("chatgpt_continue_conversation_page_loaded"),B.logEvent("Continue Conversation: Page Loaded"),X.logEvent("chatgpt_conversation_share_page_loaded"),B.logEvent("Share Public Chat: Shared Conversation Loaded"))},[p]);const _=i.useCallback(()=>{g||x({behavior:"smooth"})},[g,x]),[R,I]=i.useState(!1),S=R||!y,E=ko(n),w=i.useRef(null),{getAndroidKeyboardLayout:j}=Mo(),f=wo(n);return e.jsxs("div",{onCopy:E,className:D("@thread-xl/thread:pt-header-height mt-1.5 flex flex-col text-sm",j()&&"keyboard-open:pb-[calc(var(--composer-height,100px)+var(--screen-keyboard-height,0))]",N?null:!g&&"pb-25"),style:{paddingBottom:N},children:[s?e.jsx(or,{name:"prefetch-navlink",onError:v=>{Ke.addError("Error with prefetch navlink",{error:v}),o(void 0)},children:e.jsx(i.Suspense,{fallback:null,children:e.jsx(ri,{clientThreadId:n,prefetchNavlink:s,setPrefetchNavlink:o})})}):null,p&&e.jsxs(e.Fragment,{children:[e.jsx(Ne,{children:e.jsx("p",{className:"text-xs text-gray-500",children:e.jsx(U,{id:"threadLayout.sharedConversationCopyDisclaimer",defaultMessage:"This is a copy of a conversation between ChatGPT & Anonymous."})})}),e.jsx("div",{className:"text-token-text-primary text-center text-xs font-semibold",children:e.jsx("button",{onClick:()=>{lt.openModal(Io.ReportConversation),X.logEvent("chatgpt_conversation_share_report_content_clicked",null,{location:"Static Shared Thread Page"}),B.logEvent("Share Public Chat: Report Content Clicked",{location:"Dynamic Shared Thread Page"})},children:e.jsx(U,{id:"thread.reportSharedConversation",defaultMessage:"Report content"})})})]}),l.map((v,M)=>e.jsx(ti,{isFinalTurn:M===l.length-1,turnIndex:M,clientThreadId:n,onRequestCompletion:t,currentModelId:k.id,avatarClassName:m,scrollToBottom:g?void 0:_,scrollToMessageId:g?void 0:c,dateHeaderType:f(M),showAvatar:void 0},v)),!g&&e.jsxs(e.Fragment,{children:[a?.current&&e.jsx(rr,{setIsScrolledToEdge:I,options:{root:a.current,threshold:0,rootMargin:"0%"}},"threadBottomEdgeScrollObserver"),e.jsx("div",{ref:w}),d&&h&&!C&&e.jsx(Ys,{className:D("translate-y-[10px] md:translate-y-[30px]"),onClick:()=>{X.logEvent("chatgpt_thread_scroll_to_top"),T({behavior:"smooth"})},children:e.jsx(Eo,{className:"icon-md text-token-text-primary"})}),e.jsx(fe,{children:S&&e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15,ease:"easeInOut"},children:e.jsx(Ys,{className:D(N?null:"bottom-8"),style:{bottom:N},onClick:()=>{X.logEvent("chatgpt_thread_scroll_to_bottom"),w.current?.scrollIntoView({behavior:"smooth",block:"end"})},children:e.jsx(No,{className:"icon-md text-token-text-primary"})})})})]})]})}const Ys=ne.button`cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-token-text-secondary border-token-border-default end-1/2 translate-x-1/2 bg-token-main-surface-primary w-8 h-8 flex items-center justify-center`;export{_i as T};
//# sourceMappingURL=kxop6zvaqduak0b6.js.map
