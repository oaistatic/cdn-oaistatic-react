const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/blgb4cx1t3za2wz8.js","assets/jfjoua4700kji9z3.js","assets/ls1hkjm4csy89kc5.js","assets/root-g83krhyb.css","assets/hj6jep7mk4776vwc.js","assets/conversation-small-hvit8l60.css","assets/jl416oerpm5p44nd.js","assets/c166njesc8ruqs2t.js","assets/f35srtyza27o1d4v.js","assets/b8nw7o07u9fxmapm.js","assets/ltik0hzezyevzkdj.js","assets/c5hp2e6cf62lum4k.js","assets/oe4qwwp6lvtt8c1x.js","assets/frnfux3hbefwtfkz.js","assets/exdc9xpq8ubwzri2.js","assets/nn74387gyac7v6x1.js","assets/g3dajzb0qfwp9r26.js"])))=>i.map(i=>d[i]);
import{a as T,T as ee,aG as ge,bb as je,cr as J,bX as ke,bL as Ce,l as Re,D as oe,M as $,cK as Ee,z as Ne,co as Ae,cp as Ge,I as Te,h8 as Se,cW as De}from"./jfjoua4700kji9z3.js";import{j as t,a8 as Y,e as V,r as n,d as Oe,b as Pe,k as Le}from"./ls1hkjm4csy89kc5.js";import{I as ne,D as Ue,a as me,u as Fe}from"./inqob5dknf6bvupw.js";import{an as fe,eE as He,g9 as Be,cs as $e,aq as re,ar as P,ga as ze,oV as Ve,aE as pe,aC as We,ay as he,aA as xe,oW as Ke,oX as Xe,ap as Ye,gt as qe,gP as be,gS as Qe}from"./hj6jep7mk4776vwc.js";import{b as Je}from"./lh104zerb9ve2tyv.js";import{I as Ze}from"./nn74387gyac7v6x1.js";import"./g3dajzb0qfwp9r26.js";function et({title:e,description:a,shimmer:s}){return!e&&!a?null:t.jsxs("div",{className:"border-token-border-default my-2 max-w-[480px] min-w-72 rounded-2xl border p-6",children:[!!e&&t.jsx("p",{className:T("text-lg font-medium",s&&"loading-shimmer-pure-text-inverted",!!a&&"mb-1"),children:e}),!!a&&t.jsx("p",{children:a})]})}const Me=({children:e,isDimensionsUnknown:a})=>t.jsxs(Y.div,{className:T(["relative max-w-[480px] rounded-2xl",a&&"aspect-square overflow-hidden"]),children:[t.jsx("div",{className:"bg-token-main-surface-secondary pointer-events-none absolute inset-0"}),t.jsx("div",{className:"relative h-full",children:e})]});var x=(e=>(e.Unavailable="unavailable",e.Thinking="thinking",e.Generating="generating",e.AsyncGenerating="async_generating",e.AsyncHanging="async_hanging",e.Complete="complete",e.Errored="errored",e.Empty="empty",e))(x||{});const tt="sj1i4kz",z=`${ee.T2UAY3K}.${tt}`,at=({cotMessages:e,visualPercentComplete:a,isInterrupted:s=!1,state:i})=>{const l=V().formatMessage({id:"imagegen.thinkingHeader.interrupted",defaultMessage:"Stopped creating image"}),r=i===x.Complete||a===1,m=n.useMemo(()=>{if(s)return l;if(!e)return;if(r)return e.complete;if(a){const u=Object.keys(e.generating);for(let f=0;f<u.length;f+=1){const o=parseFloat(u[f]);if(a<o)return e.generating[u[f]]}}else return e.thinking;return e.complete},[e,l,s,r,a]);return m&&t.jsx(Je,{latestHeadline:m,isComplete:r||s,isExpandDisabled:!0})},nt="ChatGPT Image",st=300,le=1e3;function se({rightAlign:e=!1,bottomAlign:a=!1,fullWidth:s=!1,justifyBetween:i=!1,alwaysVisible:c=!1,children:l}){return t.jsxs("div",{className:T("absolute z-2 transition-opacity duration-300",c?"opacity-100":"opacity-0 group-hover/imagegen-image:opacity-100 group-focus/imagegen-image:opacity-100 focus-within:opacity-100",e?"end-0":"start-0",a?"bottom-0":"top-0",s&&"w-full"),children:[t.jsx("div",{className:T(a?"bg-linear-to-b":"bg-linear-to-t","from-transparent to-black/30","h-20 w-full")}),t.jsx("div",{className:T("absolute inset-0 flex",a?"items-end pt-3 pb-1":"items-start pt-1 pb-3",e?"justify-end pe-1":"justify-start ps-1",i&&"justify-between"),children:l})]})}function X({icon:e,selected:a,onClick:s,ariaLabel:i}){return t.jsx("button",{className:T("hover:bg-token-icon-surface/10 focus:bg-token-icon-surface/10 z-11 flex h-10 w-10 items-center justify-center rounded-xl"),onClick:s,disabled:a,"aria-label":i,children:t.jsx(e,{style:{filter:"drop-shadow(0px 2px 4px rgba(0, 0, 0, 0.20))"},className:T("icon-lg",a?"fill-current text-white":"fill-transparent text-white")})})}function Z(e){return a=>{a.stopPropagation(),e()}}const it=({image:e,imageUrl:a,onEditorClick:s,isEditorAvailable:i,messageId:c,serverThreadId:l,shouldShowOverflow:r=!1})=>{const{value:m}=ge("706943082"),{config:u}=je("2248456840"),f=u.get("enabled",!1),o=V(),[b,g]=n.useState(!1),[d,M]=n.useState(null),[v,I]=n.useState(!0),[p,E]=n.useState(!1),_=fe(),S=d==null,L=y=>{S&&(P.imageRated({liked:y,analyticsContext:_}),M(y),I(!1),setTimeout(()=>{E(!0)},le))},h=n.useCallback(()=>{const y=new Date,G=o.formatDate(y,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"});return`${nt} ${G}.png`},[o]),N=He(),j=Be(),U=j?.type===$e.Image&&j.image.asset_pointer===e?.asset_pointer,[A,w]=n.useState(!1),F=n.useCallback(()=>{e?.asset_pointer&&(re({url:e?.asset_pointer,fileName:h()}),P.download({analyticsContext:_}))},[e,h,_]),D=n.useCallback(y=>{y.stopPropagation()},[]);return t.jsxs(t.Fragment,{children:[N?!U&&t.jsx(se,{rightAlign:!0,fullWidth:!0,children:t.jsx(X,{icon:ze,ariaLabel:o.formatMessage(H.expand)})}):t.jsxs(t.Fragment,{children:[t.jsx(se,{rightAlign:!0,fullWidth:!0,alwaysVisible:A,children:t.jsxs("div",{className:"flex flex-row",onClick:D,children:[i&&!m&&t.jsx(J,{sideOffset:4,label:o.formatMessage({id:"UH0Ly0",defaultMessage:"Edit image"}),side:"top",children:t.jsx(X,{icon:Ve,ariaLabel:o.formatMessage(H.inpaint),onClick:Z(()=>{s?.(),P.inpaintStarted({analyticsContext:_})})})}),a&&t.jsx(J,{sideOffset:4,label:o.formatMessage({id:"0EYire",defaultMessage:"Download"}),side:"top",children:t.jsx(X,{icon:pe,ariaLabel:o.formatMessage(H.download),onClick:Z(()=>{re({url:a,fileName:h()}),P.download({analyticsContext:_})})})}),f&&r&&t.jsx(We,{onOpenChange:w,onDownload:F,triggerClassName:"z-11 flex h-10 w-10 items-center justify-center rounded-xl bg-transparent hover:bg-token-icon-surface/10 focus:bg-token-icon-surface/10 focus-visible:bg-token-icon-surface/10",iconClassName:"icon-lg fill-transparent text-white",dropdownClassName:"z-11 min-w-fit origin-top-right text-token-text-primary"})]})}),t.jsx(se,{bottomAlign:!0,rightAlign:!0,fullWidth:!0,justifyBetween:S,children:t.jsxs("div",{className:T("flex w-full items-center justify-between transition-opacity ease-in-out",v?"opacity-100":"opacity-0"),style:{transitionDuration:`${le}ms`},children:[t.jsx("div",{className:"flex items-center ps-4 font-semibold text-white",style:{textShadow:"0px 2px 4px rgba(0, 0, 0, 0.20)"},children:o.formatMessage(d===!0?H.feedbackMessage:H.rateThisImage)}),!p&&t.jsxs("div",{className:T("flex flex-row transition-opacity ease-in-out",d===!0?"opacity-0":"opacity-100"),style:{transitionDuration:`${st}ms`},children:[t.jsx(J,{sideOffset:4,label:o.formatMessage({id:"U99PVw",defaultMessage:"Like"}),side:"top",children:t.jsx(X,{icon:he,onClick:Z(()=>L(!0)),ariaLabel:o.formatMessage(H.thumbsUp)})}),t.jsx(J,{sideOffset:4,label:o.formatMessage({id:"ncGqTt",defaultMessage:"Dislike"}),side:"top",children:t.jsx(X,{icon:xe,onClick:Z(()=>{L(!1),g(!0)}),ariaLabel:o.formatMessage(H.thumbsDown)})})]})]})})]}),b&&t.jsx(Ze,{messageId:c??"",serverThreadId:l??"",rating:d,onClose:()=>g(!1)})]})},H=Oe({rateThisImage:{id:"imageGenActionOverlay.rateThisImage",defaultMessage:"Rate this image"},thumbsUp:{id:"imageGenActionOverlay.thumbsUp",defaultMessage:"Like this image"},thumbsDown:{id:"imageGenActionOverlay.thumbsDown",defaultMessage:"Dislike this image"},inpaint:{id:"imageGenActionOverlay.inpaint",defaultMessage:"Enter inpainting mode"},download:{id:"imageGenActionOverlay.download",defaultMessage:"Download this image"},expand:{id:"imageGenActionOverlay.expand",defaultMessage:"Expand this image"},feedbackMessage:{id:"imageGenActionOverlay.feedbackMessage",defaultMessage:"Thanks for your feedback"}}),ce=ke.div`invisible absolute top-3 flex gap-1 group-hover/paragen-image:visible z-2
  ${({$rightAlign:e})=>e?"end-3":"start-3"}
  ${({$alwaysVisible:e})=>e?"visible":""}`,rt=({imageUrl:e})=>{const[a,s]=n.useState(void 0),i=V(),c=fe(),l=n.useCallback(()=>{const r=new Date;return`${i.formatDate(r,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}.png`},[i]);return t.jsxs("div",{className:"group/paragen-image absolute inset-0 z-3",children:[t.jsxs(ce,{$alwaysVisible:!0,children:[a!==!1&&t.jsx(ne,{icon:he,selected:a===!0,variant:"large",onClick:r=>{r.stopPropagation(),P.paragenImageRated({liked:!0,analyticsContext:c}),s(!0)}}),a!==!0&&t.jsx(ne,{icon:xe,selected:a===!1,variant:"large",onClick:r=>{r.stopPropagation(),P.paragenImageRated({liked:!1,analyticsContext:c}),s(!1)}})]}),t.jsx(ce,{$alwaysVisible:!0,$rightAlign:!0,children:t.jsx(ne,{icon:pe,variant:"large",onClick:r=>{r.stopPropagation(),P.paragenDownload({analyticsContext:c}),re({url:e,fileName:l()})}})})]})};function ot({size:e=60,strokeWidth:a=2,arcPercentage:s=.25,ariaMessage:i,children:c}){const l=(e-a)/2,r=2*Math.PI*l,m=r*s,u=`${m} ${r-m}`;return t.jsxs("div",{className:"relative flex items-center justify-center",role:"progressbar","aria-live":"assertive","aria-valuetext":i,children:[t.jsxs(Y.svg,{width:e,height:e,viewBox:`0 0 ${e} ${e}`,animate:{rotate:360},transition:{repeat:1/0,duration:1.2,ease:"linear"},children:[t.jsx("circle",{className:"text-[var(--sidebar-surface-secondary)]",stroke:"currentColor",fill:"transparent",strokeWidth:a,cx:e/2,cy:e/2,r:l}),t.jsx("circle",{className:"text-[var(--main-surface-primary-inverse)]",stroke:"currentColor",fill:"transparent",strokeWidth:a,strokeDasharray:u,strokeDashoffset:"0",strokeLinecap:"butt",cx:e/2,cy:e/2,r:l})]}),c&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:c})]})}function ye({withLottie:e}){const s=V().formatMessage({id:"imagegen.progressIndicator.ariaLabel",defaultMessage:"Generating image..."});return t.jsx("div",{className:"absolute start-0 top-0 flex h-full w-full items-center justify-center rounded-full","aria-label":s,children:t.jsx(ot,{size:40,arcPercentage:.2,children:t.jsx(Ue,{animate:e,matchTextColor:!0,className:"h-6 w-6"})})})}const ve=300,lt=1.3,de=.05,ct=/blur\(([\d.]+)px\)/,dt={duration:ve/1e3,ease:"linear"};function ie(e,a,s){e.sort((r,m)=>r.lastSrcReceivedTime-m.lastSrcReceivedTime);const i=new Array(e.length).fill(0);for(let r=0;r<=e.length;r+=1){const m=r-1,u=r,f=e[m]?.availablePercentComplete??0,o=e[u]?.availablePercentComplete??1;if(a>=f&&a<=o&&f!==o){const b=(a-f)/(o-f);i[m]=1-b,i[u]=b}}const c=i[i.length-1],l=i[i.length-2];return c===1&&l===0&&(i[i.length-2]=.01),s&&a<=e[0]?.availablePercentComplete&&(i[0]=1),i}const ut=({alt:e,src:a,availablePercentComplete:s,onAnimationUpdate:i,isInterrupted:c,ignoreFirstChunk:l=!1,isTransparent:r=!1,dimensions:m,onError:u,unconstrainedWidth:f=!1})=>{const o=Ce(),b=n.useMemo(()=>`url(${o?Ke:Xe})`,[o]),[g,d]=n.useState(!1),[M,v]=n.useState(1e3),[I,p]=n.useState(s??0),[E,_]=n.useState(0),S=n.useRef(performance.now()),L=n.useRef(0),h=n.useRef([]),[N,j]=n.useState([0]),[U,A]=n.useState(!1),w=n.useRef(!1),F=n.useRef(null),D=I===1,y=s===1&&U,G=m?m.width/m.height:1;n.useEffect(()=>{!g&&s&&(d(!0),L.current=performance.now())},[g,s]),n.useEffect(()=>{const R=h.current[h.current.length-1]?.src;if(a&&a!==R){const O=h.current.findIndex(K=>K.availablePercentComplete===s);O!==-1?h.current[O]={src:a,availablePercentComplete:s??0,lastSrcReceivedTime:performance.now()}:h.current.push({src:a,availablePercentComplete:s??0,lastSrcReceivedTime:performance.now()}),j(ie(h.current,I,l))}},[a,I,l,s]);const B=n.useCallback(()=>{F.current&&s&&(v(y?ve:(performance.now()-S.current)*lt),(!l||w.current||s>=de)&&s!==1&&_(s),w.current=!0,S.current=performance.now())},[s,y,l]),k=n.useCallback(R=>{const O=parseFloat(R.height)/100;i?.(O),p(O),j(ie(h.current,parseFloat(R.height)/100,l))},[i,l]),W=n.useCallback(R=>{const O=R.filter.toString().match(ct)?.[1]??"0",Q=(16-parseFloat(O))/16,_e=1-E,ae=E+_e*Q;i?.(ae),p(ae),j(ie(h.current,ae,l))},[l,E,i]);if(!g)return c?null:t.jsx(Me,{isDimensionsUnknown:!0,children:t.jsx(ye,{withLottie:!0})});const C={duration:M/1e3,ease:"linear"},te=s!==1||!r;return t.jsxs("div",{className:T("relative z-0 cursor-pointer overflow-hidden",G<1?"max-w-[400px]":"max-w-[480px]",!D&&"pointer-events-none",!w.current&&"bg-token-main-surface-secondary",f&&"max-w-full"),"aria-label":e,style:{aspectRatio:G},children:[s&&s<de&&t.jsx("div",{className:"absolute inset-0 z-3 w-full overflow-hidden",children:t.jsx("div",{className:"absolute start-[-150%] top-[-150%] h-[400%] w-[400%]",children:t.jsx("div",{className:"diagonal-sweep-gradient h-full w-full"})})}),t.jsxs(Y.div,{className:"absolute start-0 end-0 top-0 z-2 w-full overflow-hidden transition-[mask] ease-linear",initial:y?!1:{height:"0%"},animate:D?{height:"100%"}:{height:`${E*100}%`},onUpdate:y?void 0:k,transition:y?{duration:0,ease:"linear"}:C,style:D?void 0:{mask:"linear-gradient(rgb(0,0,0) 0%, rgb(0,0,0) calc(100% - 24px), rgba(0,0,0,0) 100%)"},children:[a&&t.jsx("img",{ref:F,src:a,onLoad:B,onError:u,alt:e,className:"absolute top-0 z-1 w-full",style:{aspectRatio:G}}),r&&t.jsx("div",{className:"absolute inset-0 z-0 w-full overflow-hidden opacity-0 transition-opacity duration-300 group-hover/imagegen-image:opacity-100 group-focus/imagegen-image:opacity-100",children:t.jsx("div",{className:"absolute inset-0 bg-repeat",style:{backgroundImage:b,backgroundSize:"auto"}})})]}),t.jsx(Y.div,{className:"relative z-1 w-full overflow-hidden",initial:{filter:"blur(16px)"},animate:y?{filter:"blur(0px)"}:void 0,transition:y?dt:void 0,onUpdate:y?W:void 0,style:{aspectRatio:G},children:h.current.map((R,O)=>{const K=N[O],Q=R.availablePercentComplete===1;return K!==0||Q?t.jsx("img",{src:R.src,alt:e,style:{opacity:K,willChange:"opacity",aspectRatio:G},className:"absolute top-0 w-full",onLoad:Q?()=>A(!0):void 0},R.src):null})}),t.jsx(Y.div,{className:"absolute inset-0 z-0 scale-110 overflow-hidden blur-2xl",style:{aspectRatio:G},children:te&&h.current.filter((R,O)=>N[O]!==0).map(R=>t.jsx("img",{src:R.src,alt:e,className:"absolute top-0 w-full"},R.src))})]})},ue=2,Ie=({pointer:e,altLabel:a,isInterrupted:s,isEditorAvailable:i,onPercentageRendered:c,messageId:l,serverThreadId:r,isMultiGen:m,onEditorClick:u})=>{const f=Pe(),[o,b]=n.useState(void 0),g=n.useRef(void 0),d=e.metadata?.generation?.gen_id,M=e.metadata?.generation?.height??void 0,v=e.height,I=(M??0)/v,p=n.useRef({}),[E]=Le(),{isUnauthenticated:_}=Re(),[S,L]=n.useState(!1),h=n.useContext(me),N=e.width/e.height,j=Ye({imageAssetPointer:e,serverThreadId:r}),A=n.useCallback((C=!1)=>{!C&&g.current===e.asset_pointer||(g.current=e.asset_pointer,qe.fetch(f,{asset:e,conversationId:r,force:C,isUnauthenticated:_}).then(te=>{b(te)}).finally(()=>{g.current=void 0}))},[e,f,r,_,null]);n.useEffect(()=>{const C=e.asset_pointer!==o?.asset_pointer;(!o||C)&&A()},[o,e.asset_pointer,A]);const w=n.useMemo(()=>be({pointer:o,conversationId:r,messageId:l,source:h?"paragen":"chat"}),[o,r,l,h]),F=n.useRef(I);n.useEffect(()=>{I===1&&F.current<1&&P.renderingComplete({analyticsContext:w})},[I,w]);const D=n.useCallback(()=>{o&&u?.({image:o,messageId:l,analyticsContext:w})},[o,l,u,w]),y=n.useMemo(()=>({width:e.width,height:e.height}),[e]),G=n.useCallback(()=>{const C=(p.current[e.asset_pointer]??0)+1;if(p.current[e.asset_pointer]=C,p.current[e.asset_pointer]>ue)return oe.addAction("image-gen-asset-error",{name:"retries-exhausted",conversation_id:r,asset_pointer:e.asset_pointer,max_retries:ue});oe.addAction("image-gen-asset-retry",{name:"retry-attempted",conversation_id:r,asset_pointer:e.asset_pointer,current_retry:C}),p.current[e.asset_pointer]=C,A(!0)},[e.asset_pointer,A,r]),B=n.useCallback(C=>{C===1&&L(!0),c?.(C)},[c]),k=o?.url,W=m?"rounded-lg":"rounded-2xl",q=j??k;return t.jsx(Qe.Provider,{value:w,children:t.jsxs("div",{className:T("group/imagegen-image relative overflow-hidden",N<1?"max-w-[400px]":"max-w-[480px]",W,h&&"max-w-full",l===E.get("image")&&"[view-transition-name:var(--vt-active-image)]"),id:`image-${l}`,style:{aspectRatio:N},onClick:i?D:void 0,tabIndex:0,children:[j&&t.jsx("img",{alt:a,className:"absolute inset-0 z-1 opacity-0",src:j}),t.jsx(ut,{alt:a,src:k,availablePercentComplete:I,onAnimationUpdate:B,isInterrupted:s,isEditorAvailable:i,ignoreFirstChunk:!0,isTransparent:e.metadata?.generation?.transparent_background,dimensions:y,onError:G,unconstrainedWidth:h},d),S&&(h?t.jsx(rt,{imageUrl:k??""}):t.jsx(it,{image:k?{asset_pointer:k,alt:a,fileId:w.fileId}:void 0,imageUrl:q,onEditorClick:D,isEditorAvailable:i,messageId:l,serverThreadId:r,shouldShowOverflow:j!==void 0}))]},d)})},gt=({pointersToRender:e,altLabel:a,isInterrupted:s,isEditorAvailable:i,updatePercentageRendered:c,messageIds:l,serverThreadId:r,handleEditorClick:m})=>{const u=n.useRef({}),f=n.useCallback(o=>b=>{u.current[o]=b;const g=Object.keys(u.current).length,d=Object.values(u.current).reduce((M,v)=>M+v,0);c?.(d/g)},[c]);return e.map((o,b)=>{const g=o.metadata?.generation?.gen_id;return t.jsx(Ie,{pointer:o,altLabel:a,isInterrupted:s,isEditorAvailable:i,onPercentageRendered:g?f(g):void 0,messageId:l[b],serverThreadId:r,isMultiGen:!0,onEditorClick:m},g)})};function mt(e){const a=e.find(r=>r.author.role==="tool"&&r.author.name===z&&r.content.content_type==="text"),[s,...i]=a?.content.content_type==="text"?a.content.parts:[],c=i.pop(),l=i.length;return s&&c&&i.length>0?{thinking:s,complete:c,generating:i.reduce((r,m,u)=>{const f=(u+1)/l;return r[f.toFixed(2)]=m,r},{})}:void 0}function we(e){const a=e.filter(c=>c.author.role==="tool"&&c.author.name===z&&c.content.content_type===$.MultimodalText),s=a.flatMap(c=>Ee.getImageAssetPointers(c)),i=a.map(c=>c.id);return{imageAssetPointers:s,messageIds:i}}const ft=(e,a)=>{const s=e.find(d=>d.author.role===Ne.Tool&&[$.Error,$.SystemError].includes(d.content.content_type)||d.metadata?.is_error),{imageAssetPointers:i}=we(e),c=e.some(d=>{const M=d.author.name===z,v=d.content.content_type===$.MultimodalText,I=!!d.metadata?.is_visually_hidden_from_conversation;return M&&v&&I}),l=e.some(d=>{if(d.metadata?.image_gen_async)return!1;const M=d.author.name===ee.IMAGE_GEN_HALLUCINATED||d.author.name===z,v=d.content.content_type===$.Text,I=!!d.metadata?.is_visually_hidden_from_conversation;return M&&v&&I}),r=e.length>0&&!!e[e.length-1]?.metadata?.image_gen_async,u=!e.some(d=>[z,ee.IMAGE_GEN_HALLUCINATED].includes(d.author.name??"")&&d.content.content_type===$.MultimodalText)&&e.some(d=>{const M=[z,ee.IMAGE_GEN_HALLUCINATED].includes(d.author.name??""),v=d.recipient==="assistant";return M&&v});let f=0;for(const d of i){const M=d.height,v=d.metadata?.generation?.height??void 0;f+=M!==void 0&&v!==void 0?v/M:0}const o=i.length>0?f/i.length:0,b=s!==void 0,g=a?x.AsyncGenerating:x.AsyncHanging;if(c||l||u)return x.Empty;if(b)return x.Errored;if(o){if(o<1)return r?g:x.Generating;if(o===1)return x.Complete}else return r?g:x.Thinking;return x.Unavailable},pt=e=>{const a=V(),{size:s="image",count:i=1}=e||{};return i>1?{thinking:a.formatMessage({id:"cdnmKo",defaultMessage:"Getting started"}),generating:{"0.33":a.formatMessage({id:"aTbInH",defaultMessage:"Creating images. May take a moment."}),"0.67":a.formatMessage({id:"WRM3Yw",defaultMessage:"Creating images. May take a moment."}),"1.00":a.formatMessage({id:"8ZydRG",defaultMessage:"Creating images. May take a moment."})},complete:a.formatMessage({id:"XQ81dl",defaultMessage:"Images created"})}:s==="xlimage"?{thinking:a.formatMessage({id:"y7op2E",defaultMessage:"Getting started"}),generating:{"0.33":a.formatMessage({id:"cdrDJH",defaultMessage:"Creating image. May take a moment."}),"0.67":a.formatMessage({id:"RP4bRn",defaultMessage:"Adding details"}),"1.00":a.formatMessage({id:"o36MSQ",defaultMessage:"Finishing touches"})},complete:a.formatMessage({id:"QsnnBN",defaultMessage:"Image created"})}:{thinking:a.formatMessage({id:"6c7+kN",defaultMessage:"Getting started"}),generating:{"0.33":a.formatMessage({id:"DP6/8y",defaultMessage:"Creating image"}),"0.67":a.formatMessage({id:"k9y1TT",defaultMessage:"Creating image"}),"1.00":a.formatMessage({id:"GpR7v3",defaultMessage:"Creating image"})},complete:a.formatMessage({id:"l2Izz4",defaultMessage:"Image created"})}},ht=Ae(async()=>Ge(()=>import("./blgb4cx1t3za2wz8.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16])).then(e=>e.ImageGenNewEditor)),xt=[x.Empty,x.Errored],jt=({messages:e,clientThreadId:a,isLastTurnInConversation:s,disableClickThru:i=!1})=>{const c=Te(a),l=V(),r=l.formatMessage({id:"imagegen.message.altLabel",defaultMessage:"Generated image"}),[m,u]=n.useState(!1),[f,o]=n.useState(null),{messageIds:b,imageAssetPointers:g}=n.useMemo(()=>we(e),[e]),d=g?.[0]?.metadata?.generation?.gen_size,M=pt({size:d??"image",count:g?.length??1}),v=n.useMemo(()=>mt(e)??M,[e,M]),I=e.find(k=>k.metadata?.image_gen_async),p=n.useMemo(()=>ft(e,s),[e,s]),E=n.useRef(!1),_=n.useRef(!1),S=n.useRef(null),L=n.useMemo(()=>be({pointer:g[0],conversationId:c,messageId:b[0],source:i?"paragen":"chat"}),[g,b,c,i]);n.useEffect(()=>{if(!E.current&&(p===x.Thinking||p===x.Generating))E.current=!0,S.current=performance.now();else if(E.current&&!_.current)if(p===x.Complete){const k=S.current?performance.now()-S.current:void 0;P.generationSuccess({analyticsContext:L,durationMs:k}),_.current=!0}else p===x.Errored&&(P.generationFailure({analyticsContext:L,errorReason:"assistant_error"}),_.current=!0)},[p,L]);const h=e[e.length-1],N=n.useMemo(()=>h&&Se(h),[h]),{value:j}=ge("3058498100"),U=n.useMemo(()=>j?g:g.slice(0,1),[j,g]),A=U.length>1,w=Fe({clientThreadId:a})&&p===x.Complete,[F,D]=n.useState(0),[y,G]=n.useState(null),B=n.useCallback(({image:k,messageId:W,analyticsContext:q})=>{o(k),G(W),u(!0),P.editorClick({sourceOperation:k.metadata?.dalle?.edit_op??"none",analyticsContext:q})},[]);return xt.includes(p)?null:t.jsxs(me.Provider,{value:i,children:[t.jsxs("div",{className:"flex flex-col",children:[p!==x.Unavailable&&p!==x.AsyncGenerating&&p!==x.AsyncHanging&&t.jsx("div",{className:"pb-3",children:t.jsx(at,{cotMessages:v,visualPercentComplete:F,isInterrupted:N,state:p})}),p===x.Thinking&&!N&&t.jsx(Me,{isDimensionsUnknown:!0,children:t.jsx(ye,{withLottie:!0})}),p===x.AsyncGenerating&&!I?.metadata?.is_visually_hidden_from_conversation&&t.jsx(et,{shimmer:!0,title:I?.metadata?.ui_card_title,description:I?.metadata?.ui_card_description}),(p===x.Generating||p===x.Complete)&&t.jsx("div",{className:T("grid pb-2",{"grid-cols-2 gap-2":A,"grid-cols-1":!A}),children:A?t.jsx(gt,{pointersToRender:U,altLabel:r,isInterrupted:N,isEditorAvailable:w,updatePercentageRendered:D,messageIds:b,serverThreadId:c,handleEditorClick:B}):t.jsx(Ie,{pointer:U[0],altLabel:r,isInterrupted:N,isEditorAvailable:w,onPercentageRendered:D,messageId:b[0],serverThreadId:c,onEditorClick:B})})]}),t.jsx(De,{testId:"modal-image-gen-content",type:"success",size:"fullscreen",isOpen:m,onClose:()=>u(!1),title:l.formatMessage({id:"imagegen.message.contentModalTitle",defaultMessage:"Edit image"}),visuallyHiddenHeader:!0,className:"dark:bg-(--gray-800)",children:f&&t.jsx(ht,{image:f,isLoadingNewImage:!1,clientThreadId:a,onClose:()=>u(!1),messageId:y??""})})]})};export{jt as ImageGenMessage};
//# sourceMappingURL=j9ehcejvkquy0f6m.js.map
