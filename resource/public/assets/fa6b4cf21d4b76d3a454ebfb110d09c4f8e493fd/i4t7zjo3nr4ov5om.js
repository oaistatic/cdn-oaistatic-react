import{r as i,j as f,u as d}from"./ls1hkjm4csy89kc5.js";import{C as s,h as r}from"./jfjoua4700kji9z3.js";import{u as y}from"./m3f31zjufq98h3xn.js";import{ba as g}from"./hj6jep7mk4776vwc.js";const c="last_checked_loc",S=24*60*60*1e3,u="last_denied_loc",A=60*60*1e3;function x(){const[e]=y(),{data:n}=d({queryKey:["userLocation",e.useLocation],queryFn:({queryKey:[o,t]})=>_({enabled:t}),initialData:C(e.useLocation),networkMode:"always",refetchOnMount:"always",refetchOnWindowFocus:"always",staleTime:0});return n}function C(e){if(e){const n=s.getCookie(r.LastLocation);if(n)try{return JSON.parse(n)}catch{return l(),null}}return null}async function _({enabled:e}){if(!e)return l();if((await L())?.state!=="granted"){const o=localStorage.getItem(c);if(o){const t=Number(o),a=s.getCookie(r.LastLocation);if(a&&Date.now()-S<t)try{return JSON.parse(a)}catch{}}}const n=localStorage.getItem(u);if(n){const o=Number(n);if(Date.now()-A<o)return null}return await new Promise(o=>{navigator.geolocation.getCurrentPosition(t=>{const a={latitude:t.coords.latitude,longitude:t.coords.longitude,locationAccuracy:t.coords.accuracy};s.setCookie(r.LastLocation,JSON.stringify(a),{maxAge:g}),localStorage.setItem(c,Date.now().toString()),o(a)},()=>{localStorage.setItem(u,Date.now().toString()),o(l())},{enableHighAccuracy:!0,maximumAge:0})})}async function L(){return navigator?.permissions?await navigator.permissions.query({name:"geolocation"}):null}const E={latitude:null,longitude:null,locationAccuracy:null};function l(){return s.setCookie(r.LastLocation,JSON.stringify(E),{maxAge:g}),localStorage.removeItem(c),localStorage.removeItem(u),null}const m=i.createContext(null),P=({children:e})=>{const[n,o]=i.useState(null);return i.useEffect(()=>{L().then(t=>{t!=null&&(o(t.state),t.onchange=()=>{o(t.state)})})},[]),f.jsx(m.Provider,{value:n,children:e})};function N(){return i.useContext(m)}export{P as L,x as a,N as u};
//# sourceMappingURL=i4t7zjo3nr4ov5om.js.map
