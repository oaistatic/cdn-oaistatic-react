const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jh0xtf2897091ifd.js","assets/ls1hkjm4csy89kc5.js","assets/jfjoua4700kji9z3.js","assets/root-g83krhyb.css","assets/hj6jep7mk4776vwc.js","assets/conversation-small-hvit8l60.css","assets/eberl7qlyoy704d6.js","assets/joa8jajuiu4xqpzn.js"])))=>i.map(i=>d[i]);
import{a as M,co as Y,cp as U,aG as K,I as X,aj as Z,ab as $}from"./jfjoua4700kji9z3.js";import{r as t,j as n,a8 as N}from"./ls1hkjm4csy89kc5.js";import{at as B,au as i,gO as Q,gP as J,gQ as ee,gR as te,gv as ne,ap as ae,ar as k,gS as se,g8 as y,ez as oe,gT as re,gU as ie,gV as ce,gW as ue}from"./hj6jep7mk4776vwc.js";import{P as le,c as de,d as me}from"./jl416oerpm5p44nd.js";import{a as he}from"./f35srtyza27o1d4v.js";import{I as ge}from"./frnfux3hbefwtfkz.js";import"./c166njesc8ruqs2t.js";import"./b8nw7o07u9fxmapm.js";import"./ltik0hzezyevzkdj.js";import"./c5hp2e6cf62lum4k.js";import"./oe4qwwp6lvtt8c1x.js";import"./exdc9xpq8ubwzri2.js";import"./nn74387gyac7v6x1.js";import"./g3dajzb0qfwp9r26.js";function fe(){const[e,a]=t.useState({undoStack:[],currentIndex:-1});function s(r){a(h=>({undoStack:[...h.undoStack.slice(0,h.currentIndex+1),r],currentIndex:h.currentIndex+1}))}function c(){a(r=>({undoStack:r.undoStack,currentIndex:Math.max(r.currentIndex-1,-1)}))}function d(){a(r=>({undoStack:r.undoStack,currentIndex:Math.min(r.currentIndex+1,r.undoStack.length-1)}))}function m(){a({undoStack:[],currentIndex:-1})}return{currentDrawnShape:e.undoStack.length>0?e.undoStack[e.currentIndex]:null,onNewDrawnShape:s,canUndoDrawing:e.currentIndex>=0,undoDrawing:c,canRedoDrawing:e.currentIndex<e.undoStack.length-1,redoDrawing:d,clearAllDrawings:m}}const pe=0,xe=48;function Ie({imageAsset:e,children:a,containerDimensions:s,isLoadingNewImage:c}){return n.jsxs(N.div,{className:"absolute",style:we(e,s),...B,children:[a,n.jsx("div",{className:M("bg-token-main-surface-primary absolute inset-0 flex items-center justify-center transition-opacity duration-1000",c?"pointer-events-auto opacity-60":"pointer-events-none opacity-0")})]})}function we(e,a){const{width:s,height:c}=e,{width:d,height:m}=a,r=d-2*pe,h=m-2*xe,f=s/c,p=r/h,u=f>p,l=u?r:h*f,S=u?r/f:h;return{top:"50%",left:"50%",width:l,height:S,transform:"translate(-50%, -50%)"}}const Se=({onEscape:e})=>{t.useEffect(()=>{function a(s){s.key==="Escape"&&e()}return document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)}},[e])},Ce=Y(()=>U(()=>import("./jh0xtf2897091ifd.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(e=>e.DynamicDrawingCanvas)),R=126,De=63,ve=136,Ee=50;function Ae({width:e,height:a,delay:s=Ee}){const[c,d]=t.useState(!1);return t.useEffect(()=>{const m=setTimeout(()=>{d(!0)},s);return()=>{clearTimeout(m)}},[s]),c?n.jsx("div",{className:"flex max-h-full max-w-full items-center justify-center",style:{width:e,height:a,aspectRatio:`${e} / ${a}`},children:n.jsx("div",{className:"bg-token-border-default h-full w-full animate-pulse"})}):null}function He({image:e,isLoadingNewImage:a,clientThreadId:s,onClose:c,messageId:d,onRequestCompletion:m,editorControls:r,footer:h}){const{value:f}=K("706943082"),p=X(s),[u,l]=t.useState(i.Default),[S,P]=t.useState({width:window.innerWidth,height:window.innerHeight-R}),_=Q(),[T,G]=t.useState(!1),D=fe(),{currentDrawnShape:C,onNewDrawnShape:L,clearAllDrawings:O}=D,I=t.useRef(null),W=t.useMemo(()=>new le(de()),[]),v=t.useRef(void 0),x=t.useMemo(()=>J({pointer:e,conversationId:p,messageId:d,source:"editor"}),[e,d,p]),H=ee(o=>{const{width:g,height:w}=o.contentRect;P({width:g,height:_?w-De:w-R})});Se(t.useMemo(()=>({onEscape:()=>{u===i.Selecting?l(i.Default):c()}}),[u,c])),te(t.useMemo(()=>({image:e,currentDrawnShape:C,onCleared:()=>l(i.Default),getImageData:()=>I.current?.getImageData()}),[e,C])),t.useEffect(()=>{u!==i.Selecting&&O()},[u]),t.useEffect(()=>{l(i.Default)},[e]);const E=ne(s),A=t.useCallback(o=>{l(i.Default),E(o),c()},[E,c]),b=t.useMemo(()=>m||A,[m,A]),[F]=Z(s,o=>[o?.modelId]),z=t.useCallback(o=>{const g=o.button===0;!f&&g&&u===i.Default&&(l(i.Selecting),requestAnimationFrame(()=>{if(I.current){const w=new MouseEvent(o.type,{bubbles:!0,cancelable:!0,clientX:o.clientX,clientY:o.clientY});I.current.sendEventToCanvas(w)}}))},[u,f]),j=ae({imageAssetPointer:e,serverThreadId:p}),V=t.useCallback(()=>{l(i.Selecting),k.inpaintClick({analyticsContext:x})},[x]),q=t.useCallback(o=>{const g=o.deltaY<0?"in":"out";o.ctrlKey&&v.current!==g&&(k.zoom({zoomType:g,analyticsContext:x}),v.current=g)},[x]);return n.jsx(se.Provider,{value:x,children:n.jsxs("div",{ref:H,className:"flex h-full w-full flex-col items-center justify-between",onWheel:q,children:[r??n.jsx(ge,{clientThreadId:s,imageAsset:e,mode:u,setMode:l,inpaintingDrawingState:D,isLoadingNewImage:a,onClose:c,onInpaintClick:V,messageId:d,serverThreadId:p}),n.jsx("div",{className:"relative flex w-full grow items-center justify-center",children:n.jsxs(Ie,{imageAsset:e,containerDimensions:S,isLoadingNewImage:a,children:[j&&u!==i.Selecting&&n.jsx("img",{alt:y(e),className:"absolute inset-0 z-1 opacity-0",src:j}),!T&&n.jsx(Ae,{width:e.width,height:e.height}),n.jsx(oe,{className:"h-full w-full",alt:y(e),onLoad:()=>{G(!0)},src:e.url,width:e.width,height:e.height,fadeIn:!1,onMouseDown:z}),n.jsx("div",{className:M("absolute inset-0",u===i.Selecting?"":"hidden"),children:n.jsx(Ce,{drawingCanvasRef:I,color:"rgba(0, 122, 255, 0.5)",dashedOutlineColor:"rgba(255, 255, 255, 0.65)",cursorWidth:ve,canvasWidth:e.width,canvasHeight:e.height,currentDrawnShape:C,onNewDrawnShape:L})})]})}),n.jsx("div",{className:"flex min-h-[132px] w-full flex-col items-center justify-end max-sm:min-h-[84px]",children:n.jsx(N.div,{className:"mb-6 flex w-[90%] items-center justify-center lg:w-[53%]",layout:!0,transition:{duration:.2,ease:"easeInOut"},children:h??n.jsx(re,{value:{isImageGenEditor:!0,isInpainting:u===i.Selecting,onCancelInpaint:()=>l(i.Default)},children:n.jsx(me.Provider,{value:W,children:n.jsx(he,{clientThreadId:s,isNewThread:$(s),currentModelId:F??ie(void 0).id,onContinueGenerating:o=>b(ce(o)),onRequestCompletion:async o=>b(await ue(o)),hideHeader:!0})})})})})]})})}export{He as ImageGenNewEditor,Ae as ShimmerLoader};
//# sourceMappingURL=blgb4cx1t3za2wz8.js.map
