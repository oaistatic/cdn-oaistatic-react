import{r as l,j as p,e as R}from"./ls1hkjm4csy89kc5.js";import{gc as y}from"./hj6jep7mk4776vwc.js";import{B as k,as as C,at as x,aG as d,dd as E,A as S}from"./jfjoua4700kji9z3.js";import{CoTChunks as A}from"./hafz3trlgs2nbqfg.js";import{C as f}from"./lh104zerb9ve2tyv.js";import"./epe2ts57f6uih0zz.js";import"./mqyx9svnjg4qfuxq.js";import"./jhwen9m0dt0iy2gd.js";import"./ghefszvvbc0hzvcq.js";import"./b9iv65ef6it0bnl8.js";import"./h1em0bjkpkjv8ykw.js";import"./m3f31zjufq98h3xn.js";import"./m9dr8qz6tq7kspod.js";import"./ekgxdfqrb84ds7yx.js";import"./jl53i4v1h82l6528.js";import"./gws83r0h557ixj4e.js";import"./lqfx7r9jl2q1tbdy.js";import"./r19pqfj3as87cukj.js";import"./dt7ksh4fvumz5f8p.js";import"./nh14du86kynnf5fc.js";import"./oe4qwwp6lvtt8c1x.js";import"./iwazw5q362siufqb.js";import"./gstsldttv6qa02ku.js";import"./pc2givv05uuq8g6l.js";import"./iijxhy0p5rwh7gyf.js";import"./nxur2fbfj63tq7sy.js";const O=(e,t)=>{if(t<=1)return e.formatMessage({id:"ZxhUq1",defaultMessage:"a second"});if(t<3)return e.formatMessage({id:"4GD7tD",defaultMessage:"a couple of seconds"});if(t<4)return e.formatMessage({id:"jx5V1u",defaultMessage:"a few seconds"});if(t>=60){const s=Math.floor(t/60),o=t%60;return`${s}m ${o}s`}return e.formatMessage({id:"p4/pTg",defaultMessage:"{seconds} seconds"},{seconds:t})},I=e=>{let t=0;for(const s of e)t+=s.metadata?.finished_duration_sec??0;return t},v=(e,t,s)=>t.length>1?e.formatMessage({id:"sdDgmZ",defaultMessage:"Thought for {timing}"},{timing:O(e,s)}):k(t)?.metadata?.finished_text??"",j=(e,t,s=!1)=>{const o=[];let n={type:f.Thought,thought:{summary:"",content:""}};const u=()=>{n.thought.content.trim()&&(o.push(n),n={type:f.Thought,thought:{summary:n.thought.summary,content:""}})},a=e.split(/( {2}\n)|(\n\n)/).filter(r=>r!=null&&r.trim());if(!s&&a.length<2)return o;let i=!1;for(let r=0;r<a.length;r++){const c=a[r].trim();if(c.toLowerCase()==="none"){C.count(x.COT_SUMMARIZER,"num_none_chunks");continue}const m=c.match(/^\*\*(.*)\*\*$/);if(m)u(),n.thought.summary=m[1]??"";else if(c){if(c.startsWith("```")){if(i){n.thought.content+=n.thought.content?`
${c}`:c,u(),i=!1;continue}u(),i=!0}n.thought.content.trim()&&!c.startsWith("\\[")&&!c.startsWith("\\(")&&!i&&u(),n.thought.content+=n.thought.content?`
${c}`:c}}return n?.thought.content.trim()&&o.push(n),s&&t&&o.push({type:f.Recap,content:t}),o},N=(e,t,s)=>{const o=!s,n=l.useMemo(()=>j(e,t,o),[e,t,o]);return l.useEffect(()=>{o&&C.hist(x.COT_SUMMARIZER,"num_cot_chunks",void 0,n.length)},[o]),n},w=({isStreaming:e,finishedText:t,summaryText:s})=>{const o=N(s,t,e);return p.jsx(A,{isStreaming:e,chunks:o})},L=8,it=({messages:e,isStreaming:t,clientThreadId:s,turnIndex:o})=>{const n=R(),{value:u}=d("1214379119"),{value:a}=d("2968810397"),i=I(e),{summaryText:r,contentReferences:h}=$(e),c=h.length,{processedText:m,displayedContentReferences:M}=l.useMemo(()=>a?E(r,h,void 0,!1,t):{processedText:r,displayedContentReferences:[]},[r,c,t,a]);if(u&&!t&&!m&&i<L)return null;const _={turnIndex:o,clientThreadId:s,messageId:e[0].id};return p.jsx(y.Provider,{value:{analyticsMetadata:_,clientThreadId:s,message:e[0],contentReferences:M,onShowSearchResults:()=>{},isActivelyStreaming:t,useSafeUrls:!0},children:p.jsx(w,{finishedText:v(n,e,i),summaryText:m,isStreaming:t})})},g=`

`,T="sonic_browser_tool",$=e=>{let t="";const s=[];let o=0;return e.forEach((n,u)=>{if(n.metadata?.cot_tool===T&&e[u+1]?.metadata?.cot_tool===T)return;const a=S(n);t+=t?g+a:a;const i=n.metadata?.content_references?.map(r=>({...r,start_idx:o+r.start_idx,end_idx:o+r.end_idx}))??[];o+=a.length+g.length,s.push(...i)}),{summaryText:t,contentReferences:s}};export{w as LegacyCoT,it as LegacyCoTMessage};
//# sourceMappingURL=hcrcpjpu48939tgp.js.map
