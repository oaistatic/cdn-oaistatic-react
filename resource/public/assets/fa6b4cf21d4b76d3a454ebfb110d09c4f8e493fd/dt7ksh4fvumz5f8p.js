import{j as e,M as j,a8 as R,r as m}from"./ls1hkjm4csy89kc5.js";import{W as v}from"./nh14du86kynnf5fc.js";import{aI as y,aJ as S,aK as T,aL as E,R as L,aM as k,ay as F,aA as z,aN as _,aO as A,aP as D,aQ as H,aR as W}from"./hj6jep7mk4776vwc.js";import{P as x,a as q}from"./oe4qwwp6lvtt8c1x.js";import{o as O,R as U,aN as J}from"./jfjoua4700kji9z3.js";const K={positive:F,negative:z,neutral:_,mixed:_},Q={positive:"Positive",negative:"Negative",neutral:"Mixed",mixed:"Mixed"};function se({clientThreadId:s,messageId:n,product:a,trackContentReferenceEvent:o,onProductEntityUpdated:i}){const{productInfo:t,isLoading:u,isCached:l}=G({clientThreadId:s,messageId:n,product:a}),[r]=m.useState(l);return m.useEffect(()=>{i&&t.productEntity&&i(t.productEntity)},[t.productEntity,i]),A(),e.jsx("div",{children:u?e.jsxs("div",{className:"flex flex-col gap-4 px-6 pb-6",children:[e.jsx(x,{index:0,width:50,heightSize:"sm"}),e.jsxs(q,{children:[e.jsx(x,{index:1,width:100,heightSize:"sm"}),e.jsx(x,{index:2,width:100,heightSize:"sm"}),e.jsx(x,{index:3,width:30,heightSize:"sm"})]})]}):e.jsxs("div",{className:"bg-token-bg-primary flex flex-col",children:[e.jsx(X,{contentReference:t.productRationale,trackContentReferenceEvent:o,disableAnimation:r}),e.jsx(Z,{contentReference:t.productReviews,trackContentReferenceEvent:o,disableAnimation:r}),!1]})})}function X({contentReference:s,trackContentReferenceEvent:n,disableAnimation:a}){return s?e.jsx(y,{title:e.jsx(j,{id:"XgsZPF",defaultMessage:"Why you might like this"}),children:e.jsx("div",{className:"text-sm",children:e.jsx(S,{isDisabled:a,children:e.jsxs(T,{tag:"p","data-start":0,"data-end":s.rationale.length,children:[e.jsx("span",{className:"me-1",children:s.rationale}),s.grouped_citation&&e.jsx(v,{webpageItem:s.grouped_citation,trackContentReferenceEvent:n,analyticsMetadata:{section:"product_rationale",section_location:"sidebar"},isLastHovered:!0,noMarginStart:!0})]})})})}):null}function Z({contentReference:s,trackContentReferenceEvent:n,disableAnimation:a}){function o(t){return new URL(t).hostname.replace(/^www\./,"")}function i(t){return s?t.cite?s.cite_map[t.cite]?.url:t.cite_url:null}return s?e.jsx(y,{title:e.jsx(j,{id:"p8XHcJ",defaultMessage:"What people are saying"}),children:e.jsxs("div",{className:"flex flex-col gap-6",children:[s.summary&&e.jsx(S,{isDisabled:a,children:e.jsx(E,{className:"-mb-2 text-sm",children:s.summary})}),s.reviews.map((t,u)=>{const l=K[t.sentiment??"neutral"],r=i(t);return e.jsxs(R.div,{className:"relative flex flex-col gap-2",...!a&&{initial:{opacity:0},animate:{opacity:1},transition:{duration:.4}},children:[e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[e.jsx(L,{url:r??"",className:"h-8 w-8 rounded-full",size:128,minSize:16,fallback:e.jsx(k,{className:"text-token-text-tertiary"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"text-sm font-semibold",children:t.source}),e.jsxs("div",{className:"text-token-text-secondary flex flex-row gap-1 text-xs",children:[e.jsx("div",{children:r?o(r):""}),t.sentiment&&e.jsxs(e.Fragment,{children:["Â·",e.jsx(l,{className:"icon-sm text-token-text-secondary"}),Q[t.sentiment]]})]})]})]}),e.jsxs("div",{className:"text-sm",children:[t.theme&&e.jsx("div",{className:"font-semibold",children:t.theme}),e.jsx("span",{className:"me-1",children:t.summary}),e.jsx($,{cite:t.cite,contentReference:s,trackContentReferenceEvent:n})]})]},u)})]})}):null}function $({cite:s,contentReference:n,trackContentReferenceEvent:a,analyticsMetadata:o}){const{cite_map:i}=n,t=s?i[s]:null;return t?e.jsx(v,{webpageItem:t,trackContentReferenceEvent:a,analyticsMetadata:{...o,section:"product_reviews",section_location:"sidebar"},isLastHovered:!0,noMarginStart:!0}):null}async function*B({conversationId:s,messageId:n,productQuery:a,productLookupData:o,evalPreset:i},t){const u=W(`${J}/search/product_info`,{method:"POST",headers:{...U.getAuthedHeaders({isAuthOptional:!0}),"Content-Type":"application/json"},body:{conversation_id:s,message_id:n,eval_preset:i,product_query:a,...o?{product_lookup_data:o}:{}},signal:t});for await(const l of u)"data"in l&&(yield l.data)}const p=new Map;function G({clientThreadId:s,messageId:n,product:a}){const o=O(s)??s,i=[o,n,a.title].join(":"),[t,u]=m.useState(p.get(i)??{productReviews:void 0,productRationale:void 0,productEntity:void 0,__debug:void 0}),[l,r]=m.useState(!1),h=m.useRef(!1);return m.useEffect(()=>{async function b({conversationId:g,messageId:P,productQuery:N,productLookupData:I}){if(h.current)return;const f=D({namespace:H.ProductSidebar});try{h.current=!0,r(!0);const M=new URLSearchParams(window.location.search).get("product_reviews_eval_preset"),w=B({conversationId:g,messageId:P,productQuery:N,productLookupData:I,evalPreset:M});let c={productReviews:void 0,productRationale:void 0,productEntity:void 0,__debug:void 0};for await(const d of w)d.type==="product_reviews"?(c={...c,productReviews:d},f.logTiming("time_to_first_review")):d.type==="product_rationale"?(c={...c,productRationale:d},f.logTiming("time_to_rationale")):d.type==="product_entity"?(c={...c,productEntity:d},f.logTiming("time_to_product_entity")):d.type==="__debug"&&(c={...c,__debug:d}),["product_reviews","product_rationale"].includes(d.type)&&r(!1),u(c);p.set(i,c)}finally{h.current=!1,r(!1),f.logTiming("sidebar_loaded")}}(async function(){p.has(i)||o&&n&&await b({conversationId:o,messageId:n,productQuery:a.title,productLookupData:a.product_lookup_data})})()},[n,a.title,a.product_lookup_data,i,o]),{productInfo:t,isLoading:l,isCached:p.has(i)}}export{se as P,X as a,Z as b};
//# sourceMappingURL=dt7ksh4fvumz5f8p.js.map
