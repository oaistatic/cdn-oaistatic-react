import{r as u,ah as U,k as V,e as B,j as n,a8 as f,a9 as q}from"./ls1hkjm4csy89kc5.js";import{ho as Y,hp as K,hq as X,C,hr as $,hs as J,ht as Q,hu as Z,hv as tt,hw as et,hx as st,gn as at,hy as ot,hz as nt,hA as it,hB as N,hC as D,gl as rt,hD as ct,hE as dt,fR as lt,hF as ut,u as ht,hG as _,a5 as F,hH as M}from"./hj6jep7mk4776vwc.js";import{gM as S,g as W,aj as pt,F as b,ak as mt,H as gt,gi as ft,db as xt,b$ as Ct,go as vt,gN as wt}from"./jfjoua4700kji9z3.js";import{L as Tt,u as bt}from"./m6d28lwoyiuxtlg3.js";import{T as yt}from"./ko48v43v67hat5pb.js";import{g as It}from"./btagl6w1gub4aw61.js";import"./jy1u8exw8iz2slve.js";import"./f06euqb6n9n90ph6.js";import"./oe4qwwp6lvtt8c1x.js";import"./lup3lhp4jup8hwgh.js";import"./maaa59io6z1tsugr.js";import"./n3zdfvn2wsqd8rrk.js";import"./gy64pge8qevmvg7e.js";import"./ekgxdfqrb84ds7yx.js";import"./eznezzwnoh2bc43l.js";import"./c166njesc8ruqs2t.js";import"./op6u27mntqa8at4f.js";import"./fzrn137102spawew.js";import"./fbs9v8bh3wllita3.js";import"./lqfx7r9jl2q1tbdy.js";import"./gnihsipfzowq5klb.js";import"./gm98iwmt6t0m5rzt.js";import"./f9d7padxd97mxih2.js";import"./bjbryornudc3ovxe.js";import"./ht69l5cqsqb2usac.js";import"./ltik0hzezyevzkdj.js";import"./jl416oerpm5p44nd.js";import"./b8nw7o07u9fxmapm.js";import"./epe2ts57f6uih0zz.js";const j="oai/apps/canmoreSidebarWidth",St=.25,Et=400,O=400;function k(t){return t-Et}function y(t,s){return U(O,k(t),s??St*t)}function At(){const t=S.useState(S.selectWindowWidth),s=y(t,Y(W.DANGER_SECRET_FOLDERS_ONLY_getItem(j))),a=L(),[e,i]=u.useState(s);u.useEffect(()=>{(e<O||e>k(t))&&i(y(t,e))},[t]);function o(c){i(x=>y(t,x+=c.delta.x))}function r(c){i(c),W.DANGER_SECRET_FOLDERS_ONLY_setItem(j,c)}function l(){const c=y(t,void 0);r(c)}const p=`calc(100vw - ${e}px)`;return a?{chatWidth:e,canvasWidth:t-e,canvasWidthCalc:p,viewportWidth:t,handleDrag:o,handleDoubleClick:l,persist:r}:{chatWidth:0,canvasWidth:t,canvasWidthCalc:"100vw",viewportWidth:t,handleDrag:()=>{},handleDoubleClick:()=>{},persist:()=>{}}}function L(t){const s=S.useState(S.selectWindowWidth);return(t??s)>1e3}const A="sharedCanvas";function Rt(){const[t,s]=V(),a=t.get(A),e=B();u.useEffect(()=>{const i=a&&K.createRemixTempTextdoc(a,e);if(!i)return;requestAnimationFrame(()=>{X(i)});const o=new URLSearchParams(t);o.delete(A),s(o);const r=new URL(window.location.href);r.searchParams.delete(A),history.replaceState(null,"",r)},[a,t,s,e])}function Nt(t,s){let a;return s?.type===C.Textdoc&&(s.textdocId.startsWith($)||(a={type:"canvas_textdoc",id:s.textdocId})),J(t,{promptMessage:{metadata:{open_in_canvas_view:a}}})}const P=({isFullScreen:t=!1,clientThreadId:s,focusedObject:a,onClose:e,isAnimating:i=!1,width:o})=>{const{setTargetedContent:r}=Q(),l=u.useRef(!1);if(u.useEffect(()=>(l.current&&r(void 0),l.current=!0,()=>{l.current=!1}),[a]),a==null)return null;switch(a.type){case C.Textdoc:return n.jsx(yt,{isFullScreen:t,onClose:e,clientThreadId:s,focusedTextdoc:a,isAnimating:i,width:o});case C.ADAVisualization:return null}},_t=300,Ft=t=>{switch(t?.type){case C.Textdoc:return t.textdocId;default:return null}};function Mt(t,s){const[a,e,i,o]=pt(t,d=>[b.getRequestId(d),b.getConversationLastTurn(d),b.isMessageTurnEnded(d),b.getVariantIds(d).length>1]),r=mt(a),l=Z(),[p,c]=u.useMemo(()=>{if(e&&o)return[void 0,null];if(s===!0)return[void 0,null];let d;return!i&&e&&(d=gt(e.messageGroups,m=>m.type!==ft)),Wt({groupedMessage:d,isRequestActive:r,latestTextdocId:l})},[i,e,o,s,r,l]),x=c!=null,v=Ft(c),w=tt("canvas");u.useEffect(()=>{if(c&&p&&!et()&&(w(),st(c,p),c.type===C.Textdoc)){const{textdocId:d}=c,m=It(d);at(document.getElementById(m))}},[x,v])}function Wt({groupedMessage:t,isRequestActive:s,latestTextdocId:a}){switch(t?.type){case xt.Canmore:{const[e,i]=t.messages;if(!ot(e))break;const o=nt(s,e,i??null),r=o.textdocId??a;if(r&&(o.function===it.CreateTextdoc?(o.content??"").length>_t||o.status===N.WAITING:o.status===N.STREAMING))return[o.messageId,{type:C.Textdoc,textdocId:r}];break}}return[void 0,null]}const jt=260,I={type:"spring",bounce:.12,duration:.64},Dt={type:"spring",bounce:0,duration:.58},Ot=({clientThreadId:t,focusedObject:s,onClose:a})=>{const{chatWidth:e,canvasWidthCalc:i,handleDrag:o,handleDoubleClick:r,persist:l}=At(),[p,c]=u.useState(!0),[x,v]=u.useState(!1),w=ct(({rect:h})=>h),{windowHeight:d,windowWidth:m}=vt(h=>h,{windowWidth:0,windowHeight:0});let g=w??{top:0,left:e,width:m-e,height:d},R=!1;if(w&&(g.top<0||g.top+g.height>d)){R=!0;const h={width:(m-e)*.75,height:d*.75};g={top:d/2-h.height/2,left:(m-e-h.width)/2+e,width:h.width,height:h.height}}const T=w?.borderRadius,E=dt(),H=E?.history!=null||E?.showChangesAtVersion!=null,z=lt();return n.jsxs(n.Fragment,{children:[H&&n.jsx(Tt,{onClick:()=>ut(E.textdocId),zIndexKey:"chatOverlay"}),n.jsxs(f.div,{initial:{marginRight:z?0:-jt},animate:{marginRight:0},transition:Dt,children:[n.jsx(f.div,{initial:{opacity:1},animate:{opacity:0},exit:{opacity:[1,0]},transition:{...I,delay:.22},className:"bg-token-main-surface-primary pointer-events-none absolute start-0 top-0 z-20 h-full w-full"}),n.jsx(f.div,{className:"relative z-20 h-full",style:{width:i},exit:{width:0},transition:{type:"spring",bounce:0,duration:.1}})]}),n.jsx(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"pointer-events-none absolute start-0 top-0 z-10 h-full w-full bg-black/[0.025] dark:bg-transparent"}),n.jsx(f.div,{className:"absolute start-0 z-20 h-full overflow-hidden transition-shadow",initial:{borderRadius:T,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)",opacity:R?0:1,x:g.left,y:g.top,height:g.height,width:g.width},animate:{opacity:1,x:e,y:0,width:i,height:d,borderRadius:0,boxShadow:"0px 0px 18px rgba(0,0,0,0.075)"},exit:{scale:.64,opacity:0,filter:"blur(12px)",transition:{opacity:{duration:.14,bounce:.1}},borderRadius:T,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)"},transition:x?{duration:0}:I,onAnimationComplete:()=>c(!1),children:n.jsx(f.div,{className:"dark:border-token-border-medium h-full overflow-hidden border-s border-gray-100",initial:{borderRadius:T},animate:{borderRadius:0},exit:{borderRadius:T},transition:I,children:n.jsxs("div",{className:"h-full",children:[n.jsx(f.div,{drag:"x",className:"bg-token-text-quaternary absolute start-[-2px] z-10 h-full w-[4px] cursor-ew-resize opacity-0",whileHover:{opacity:.5},whileDrag:{opacity:.75,width:"8px",left:"-4px"},transition:{type:"tween",duration:.1},style:{x:0,y:0,transform:"translateX(0px)"},dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:{left:0,right:0,top:0,bottom:0},onPointerDown:()=>v(!0),onPointerUp:()=>v(!1),onDrag:(h,G)=>o(G),onDragEnd:()=>{v(!1),l(e)},onDoubleClick:()=>r()}),x&&n.jsx("div",{className:"absolute inset-0 z-10"}),n.jsx(P,{onClose:a,clientThreadId:t,isAnimating:p,focusedObject:s,width:m-e})]})})})]})},kt=u.memo(Ot),Lt=({clientThreadId:t,focusedObject:s,onClose:a})=>n.jsx(wt,{children:n.jsx(f.div,{className:"fixed inset-0 z-40 overflow-hidden shadow-xl md:border-gray-100 md:dark:border-gray-700",initial:{scale:.98},animate:{scale:1},transition:I,children:n.jsx(P,{isFullScreen:!0,clientThreadId:t,focusedObject:s,onClose:a})})}),Pt=({clientThreadId:t,overrideWidth:s,isAutoFocusDisabled:a=!1})=>{const e=L(s),i=bt();Mt(t,a||i),Rt();const o=ht();u.useEffect(()=>{D()},[t]);const r=o&&(e?n.jsx(kt,{clientThreadId:t,onClose:M,focusedObject:o},"canvas-sidebar"):n.jsx(Lt,{clientThreadId:t,onClose:M,focusedObject:o},"canvas-modal"));u.useEffect(()=>{if(o)return _(p=>Nt(p,o)),()=>_(null)},[o]);const l=r!=null;return u.useEffect(()=>(F.setActiveStageSidebar(l),()=>{l&&F.setActiveStageSidebar(!1)}),[l]),n.jsx(q,{children:r},t)},ge=t=>{const s=u.useRef(null);return n.jsx(Ct,{ref:s,onError:(a,e)=>{D(),setTimeout(()=>{s.current?.resetErrorBoundary()}),rt.logError("Error boundary hit",a,{componentStack:e})},name:"canmore-focused-view",children:n.jsx(Pt,{...t})})};export{ge as CanvasFocusedViewManager};
//# sourceMappingURL=cgy1a4ln2o7x1ucq.js.map
