import{r as n,j as s,M as y}from"./cg166fqqcxkeiosv.js";import{d as R,bi as A,c1 as z,ai as G,aE as w,q as L,P as p,a as h,C as U,bT as E,bA as N,fN as K,r as C,n as V}from"./mwlpozqwnbys03vp.js";import{a as q}from"./lyxz8i5c4a3y7iew.js";import{gb as B,cn as D,di as J,dj as O}from"./d5k5wa3zyqlgc9bk.js";import{u as W}from"./mptd6395vqovl9h2.js";import"./lreb9dbp4o4sdhlz.js";const Q=n.forwardRef(function(t,i){const{className:c,...d}=t;return s.jsxs("div",{className:"grid",children:[s.jsx("textarea",{className:R("col-start-1 col-end-2 row-start-1 row-end-2 resize-none overflow-hidden p-0",c),ref:i,...d}),s.jsxs("span",{className:"invisible col-start-1 col-end-2 row-start-1 row-end-2 whitespace-pre-wrap p-0",children:[t.value," "]})]})});function X({initialText:o,clientThreadId:t,currentLeaf:i,onExitEdit:c,onRequestCompletion:d,disabled:M,attachments:l}){const[u,T]=n.useState(o??""),m=n.useRef(null),k=z(),v=W(),g=u.trim()==="",{value:b}=G("1988730211"),P=n.useCallback(e=>{T(e.currentTarget.value)},[]),f=n.useCallback(e=>{if(g)return;const a={},r=B();l&&(a.attachments=l),r&&(a.__internal={search_settings:r}),w(t,j=>{N.appendMessage(j,K(u,Object.keys(a).length>0?a:void 0),void 0,C.getTree(j).getParentId(i))});const S=Array.from(v),{systemHints:H,extraStreamParams:I}=b?D(S):{systemHints:S,extraStreamParams:{}};q(t),d({eventSource:e,extraStreamParams:I,completionMetadata:{conversationMode:L(t)?.mode,systemHints:H}}),c(),p.logEvent(h.changeNode,{intent:"edit_save"})},[g,l,t,v,b,d,c,i,u]),x=n.useCallback(()=>{w(t,e=>{const a=C.getTree(e).getLeafFromNode(i);N.setCurrentLeafId(e,a.id)}),p.logEvent(h.changeNode,{intent:"edit_cancel"}),c(),p.logEvent(h.cancelEditPrompt,{threadId:U(t)})},[i,c,t]);n.useEffect(()=>{const e=m.current;if(e){e.focus();const a=e.value.length;e.setSelectionRange(a,a)}},[]),n.useEffect(()=>{const e=m.current,a=r=>{r.isComposing||(r.key==="Enter"&&r.metaKey?f("keyboard"):r.key==="Escape"&&x())};return e&&e.addEventListener("keydown",a),()=>{e&&e.removeEventListener("keydown",a)}},[x,f]);const F=l&&l.length>0&&s.jsx(Y,{children:l.map(e=>s.jsx(J,{width:k?"normal":"wide",file:e.name,contextConnectorInfo:O(e.context_connector_info)},e.id))}),_=s.jsx("div",{className:"m-2 max-h-[25dvh] overflow-auto",children:s.jsx(Q,{ref:m,value:u,onChange:P,className:"m-0 w-full resize-none border-0 bg-transparent focus:ring-0 focus-visible:ring-0"})});return s.jsxs("div",{className:"rounded-3xl bg-token-main-surface-tertiary px-3 py-3",children:[F,_,s.jsxs("div",{className:"flex justify-end gap-2",children:[s.jsx(E,{as:"button",color:"secondary",onClick:x,children:s.jsx(y,{id:"D9gbPp",defaultMessage:"Cancel"})}),s.jsx(E,{as:"button",onClick:()=>f("mouse"),disabled:M||g,children:s.jsx(y,{id:"KGxIJG",defaultMessage:"Send"})})]})]})}const Y=A.div`flex gap-2 flex-wrap`;function re({message:o,...t}){return s.jsx(X,{currentLeaf:o.nodeId,initialText:V(o.message),attachments:o.message.metadata?.attachments,...t})}export{re as TextMessageEditor};
//# sourceMappingURL=jm22b0y52k0rmitb.js.map
