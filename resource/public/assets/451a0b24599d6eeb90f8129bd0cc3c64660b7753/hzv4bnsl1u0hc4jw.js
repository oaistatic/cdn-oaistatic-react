import{r as h,aZ as K,h as X,c as $,j as i,au as f,aw as Q}from"./cg166fqqcxkeiosv.js";import{i7 as Z,i8 as J,i9 as ee,C as g,ia as te,hC as se,ib as ae,dm as oe,ic as ie,id as ne,ie as re,ig as ce,dv as de,cz as N,ih as le,ii as ue,ij as he,ik as M,il as L,dt as me,z as W,im as pe,io as fe,ip as ge,u as xe,iq as D,U as F,ir as j}from"./d5k5wa3zyqlgc9bk.js";import{gE as E,$ as O,Q as ve,r as k,V as Ce,eq as we,o as Se,gF as be,eG as Te,dU as U,fW as ye,d as Ie,gG as Ee}from"./mwlpozqwnbys03vp.js";import{L as Ae}from"./euxxc9e4zh86bdsx.js";import{u as Re}from"./dwgbagtcbp3llpgj.js";import{T as _e}from"./f6h3kyofrkhu3s3z.js";import{g as Ne}from"./btagl6w1gub4aw61.js";import"./j8x3nt0b4atg14yj.js";import"./h9b0sydnyfwx9msy.js";import"./i7xkmczefffl02lb.js";import"./eejnwg9biczpfc2f.js";import"./gy64pge8qevmvg7e.js";import"./bk3oz68r6jpv53p0.js";import"./e1a7vwuqoah2oayi.js";import"./lreb9dbp4o4sdhlz.js";import"./mptd6395vqovl9h2.js";import"./e9twjvrfqdwmahlj.js";import"./ffqd4m2qodkr5sj8.js";import"./kb4dwh5v3nuso8nd.js";import"./gd3hm2r8fxvriszj.js";import"./fzrn137102spawew.js";import"./jy3dt8r0gwwixm3r.js";import"./f9ed4qokx92gm8gq.js";import"./lyxz8i5c4a3y7iew.js";import"./oxip50nz1ohggehf.js";import"./bcgu844kz5rwd68s.js";import"./gjup1pnw4u9rwx39.js";import"./k167qwis51wxn1ax.js";import"./bk8slwxjkdlmxjxm.js";import"./oyod5vgp8gzuy8hf.js";import"./mkaurxw37czmxs2e.js";import"./nbo9a5e09uaxkp2z.js";const P="oai/apps/canmoreSidebarWidth",Me=.25,We=400,z=400;function V(e){return e-We}function y(e,t){return K(z,V(e),t??Me*e)}function De(){const e=E.useState(E.selectWindowWidth),t=y(e,Z(O.DANGER_SECRET_FOLDERS_ONLY_getItem(P))),a=G(),[s,c]=h.useState(t);h.useEffect(()=>{(s<z||s>V(e))&&c(y(e,s))},[e]);function o(l){c(x=>y(e,x+=l.delta.x))}function d(l){c(l),O.DANGER_SECRET_FOLDERS_ONLY_setItem(P,l)}function n(){const l=y(e,void 0);d(l)}const r=`calc(100vw - ${s}px)`;return a?{chatWidth:s,canvasWidth:e-s,canvasWidthCalc:r,viewportWidth:e,handleDrag:o,handleDoubleClick:n,persist:d}:{chatWidth:0,canvasWidth:e,canvasWidthCalc:"100vw",viewportWidth:e,handleDrag:()=>{},handleDoubleClick:()=>{},persist:()=>{}}}function G(e){const t=E.useState(E.selectWindowWidth);return(e??t)>1e3}const R="sharedCanvas";function Fe(){const[e,t]=X(),a=e.get(R),s=$();h.useEffect(()=>{const c=a&&J.createRemixTempTextdoc(a,s);if(!c)return;requestAnimationFrame(()=>{ee(c)});const o=new URLSearchParams(e);o.delete(R),t(o);const d=new URL(window.location.href);d.searchParams.delete(R),history.replaceState(null,"",d)},[a,e,t,s])}function je(e,t){let a;return t?.type===g.Textdoc&&(t.textdocId.startsWith(te)||(a={type:"canvas_textdoc",id:t.textdocId})),{...e,messageMetadata:{...e.messageMetadata,open_in_canvas_view:a}}}const H=({isFullScreen:e=!1,clientThreadId:t,focusedObject:a,onClose:s,isAnimating:c=!1,width:o})=>{const{setTargetedContent:d}=se(),n=h.useRef(!1);if(h.useEffect(()=>(n.current&&d(void 0),n.current=!0,()=>{n.current=!1}),[a]),a==null)return null;switch(a.type){case g.Textdoc:return i.jsx(_e,{isFullScreen:e,onClose:s,clientThreadId:t,focusedTextdoc:a,isAnimating:c,width:o});case g.ADAVisualization:return null;case g.Sonic:return!1}},Oe=300,ke=e=>{switch(e?.type){case g.Textdoc:return e.textdocId;case g.Sonic:return e.messageId;default:return null}};function Pe(e,t){const[a,s]=ve(e,p=>[k.getRequestId(p),k.isMessageTurnEnded(p)]),c=Ce(a),o=we(e),d=ae(),n=oe(),[r,l]=h.useMemo(()=>{if(o&&ie(o))return[void 0,null];if(t===!0)return[void 0,null];let p;return!s&&o&&(p=Se(ne(o.messages))),Le({clientThreadId:e,groupedMessage:p,isRequestActive:c,isCanvasOpen:n,latestTextdocId:d})},[s,o,t,e,c,n,d]),x=l!=null,b=ke(l),v=re("canvas");h.useEffect(()=>{if(l&&r&&!be()&&(v(),ce(l,r),l.type===g.Textdoc)){const{textdocId:p}=l,C=Ne(p);de(document.getElementById(C))}},[x,b])}function Le({clientThreadId:e,groupedMessage:t,isRequestActive:a,isCanvasOpen:s,latestTextdocId:c}){switch(t?.type){case N.Canmore:{const[o,d]=t.messages;if(!le(o?.message))break;const n=ue(a,o.message,d?.message??null),r=n.textdocId??c;if(r&&(n.function===he.CreateTextdoc?(n.content??"").length>Oe||n.status===M.WAITING:n.status===M.STREAMING))return[n.messageId,{type:g.Textdoc,textdocId:r}];break}case N.SonicCanvas:break}return[void 0,null]}const Ue=260,I={type:"spring",bounce:.12,duration:.64},ze={type:"spring",bounce:0,duration:.58},Ve=({clientThreadId:e,focusedObject:t,onClose:a})=>{const{chatWidth:s,canvasWidthCalc:c,handleDrag:o,handleDoubleClick:d,persist:n}=De(),r=U(),[l,x]=h.useState(!0),[b,v]=h.useState(!1),p=W(u=>u.activeSidebar),C=pe(({rect:u})=>u),{windowHeight:w,windowWidth:S}=ye(u=>u,{windowWidth:0,windowHeight:0});let m=C??{top:0,left:s,width:S-s,height:w},_=!1;if(C&&(m.top<0||m.top+m.height>w)){_=!0;const u={width:(S-s)*.75,height:w*.75};m={top:w/2-u.height/2,left:(S-s-u.width)/2+s,width:u.width,height:u.height}}if(r){const u=S-m.width-m.left;m={...m,left:-u}}const T=C?.borderRadius,A=fe(),q=A?.history!=null||A?.showChangesAtVersion!=null,B=W(u=>u.isDesktopNavCollapsed);return i.jsxs(i.Fragment,{children:[q&&i.jsx(Ae,{onClick:()=>ge(A.textdocId),zIndexKey:"chatOverlay"}),i.jsxs(f.div,{initial:!r&&{marginRight:B?0:-Ue},animate:!r&&{marginRight:0},transition:ze,children:[i.jsx(f.div,{initial:{opacity:1},animate:{opacity:0},exit:{opacity:[1,0]},transition:{...I,delay:.22},className:"pointer-events-none absolute left-0 top-0 z-20 h-full w-full bg-token-main-surface-primary"}),!r&&i.jsx(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"pointer-events-none absolute left-0 top-0 z-10 h-full w-full bg-black/[0.025] dark:bg-transparent"}),i.jsx(f.div,{className:"relative z-20 h-full",style:{width:c},exit:{width:0},transition:{type:"spring",bounce:0,duration:.1}})]}),i.jsx(f.div,{className:Ie("absolute z-20 h-full transition-shadow",r&&"right-0 max-h-[100cqh] max-w-[var(--available-details-width)] overflow-y-auto overflow-x-clip",!r&&"overflow-hidden",!r&&(p==="debug"?"md:left-[-250px] lg:left-[-300px] xl:left-[-350px] 2xl:left-[-400px]":"left-0")),initial:{borderRadius:T,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)",opacity:_?0:1,x:m.left,y:m.top,height:m.height,width:m.width},animate:{opacity:1,x:r?0:s,y:0,width:c,height:w,borderRadius:0,boxShadow:"0px 0px 18px rgba(0,0,0,0.075)"},exit:{scale:.64,opacity:0,filter:"blur(12px)",transition:{opacity:{duration:.14,bounce:.1}},borderRadius:T,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)"},transition:b?{duration:0}:I,onAnimationComplete:()=>x(!1),children:i.jsx(f.div,{className:"h-full overflow-hidden border-l border-gray-100 dark:border-token-border-medium",initial:{borderRadius:T},animate:{borderRadius:0},exit:{borderRadius:T},transition:I,children:i.jsxs("div",{className:"h-full",children:[i.jsx(f.div,{drag:"x",className:"absolute left-[-2px] z-10 h-full w-[4px] cursor-ew-resize bg-token-text-quaternary opacity-0",whileHover:{opacity:.5},whileDrag:{opacity:.75,width:"8px",left:"-4px"},transition:{type:"tween",duration:.1},style:{x:0,y:0,transform:"translateX(0px)"},dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:{left:0,right:0,top:0,bottom:0},onPointerDown:()=>v(!0),onPointerUp:()=>v(!1),onDrag:(u,Y)=>o(Y),onDragEnd:()=>{v(!1),n(s)},onDoubleClick:()=>d()}),b&&i.jsx("div",{className:"absolute inset-0 z-10"}),i.jsx(H,{onClose:a,clientThreadId:e,isAnimating:l,focusedObject:t,width:S-s})]})})})]})},Ge=h.memo(Ve),He=({clientThreadId:e,focusedObject:t,onClose:a})=>i.jsx(Ee,{children:i.jsx(f.div,{className:"fixed inset-0 z-40 overflow-hidden shadow-xl md:border-gray-100 md:dark:border-gray-700",initial:{scale:.98},animate:{scale:1},transition:I,children:i.jsx(H,{isFullScreen:!0,clientThreadId:e,focusedObject:t,onClose:a})})}),qe=({clientThreadId:e,overrideWidth:t,isAutoFocusDisabled:a=!1})=>{const s=G(t),c=Re(e);Pe(e,a),Fe();const o=xe();h.useEffect(()=>{L()},[e]);const d=o&&(s?i.jsx(Ge,{clientThreadId:e,onClose:j,focusedObject:o},"canvas-sidebar"):i.jsx(He,{clientThreadId:e,onClose:j,focusedObject:o},"canvas-modal"));h.useEffect(()=>{if(o)return D(x=>je(x,o)),()=>D(null)},[o]);const n=U(),r=d!=null;return h.useEffect(()=>{if(!n)return F.setActiveStageSidebar(r),()=>{r&&F.setActiveStageSidebar(!1)}},[r,n]),c!==e?null:i.jsx(Q,{children:d})},yt=e=>{const t=h.useRef(null);return i.jsx(Te,{ref:t,onError:(a,s)=>{L(),setTimeout(()=>{t.current?.resetErrorBoundary()}),me.logError("Error boundary hit",a,{componentStack:s})},name:"canmore-focused-view",children:i.jsx(qe,{...e})})};export{yt as CanvasFocusedViewManager};
//# sourceMappingURL=hzv4bnsl1u0hc4jw.js.map
