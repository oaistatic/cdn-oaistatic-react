const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jn1zlwl4dxqm29c9.js","assets/mwlpozqwnbys03vp.js","assets/cg166fqqcxkeiosv.js","assets/root-0muf4psh.css","assets/d5k5wa3zyqlgc9bk.js","assets/conversation-small-ga20ijz2.css","assets/ehrl4h7p8z26p31l.js","assets/mptd6395vqovl9h2.js","assets/lr1sxgzrfwn4hmj0.js","assets/hqprvq82xcpllir3.js","assets/e9twjvrfqdwmahlj.js","assets/i8wt1ptmzikt53pm.js","assets/lj33efal9jfvd2er.js","assets/mkblidk2favziv5s.js","assets/oyod5vgp8gzuy8hf.js"])))=>i.map(i=>d[i]);
import{bm as pe,bn as ve,b4 as Se,fx as Ce,B as Ee,fy as $,N as E,S as O,P as y,a as x,c2 as ye,aD as xe,dU as be,ai as F,Q as Te,r as Ne,V as Re,E as c,F as w,de as _e,d as D,Y as Ae,aM as we,O as De}from"./mwlpozqwnbys03vp.js";import{c as Z,r as o,a as W,d as Ie,j as t,L as B}from"./cg166fqqcxkeiosv.js";import{ae as je,af as ke,ag as M,ac as K,ah as Oe,ai as Me,aj as ze,ak as ee,al as Pe,am as Le,an as Ge,ao as Ue,ap as X,aq as He,ar as qe,as as Ve,at as Q,au as Fe,av as Be,aw as Ke,ax as Xe,ay as Y,az as Qe,aA as Ye,aB as Je,aC as $e}from"./d5k5wa3zyqlgc9bk.js";import{G as te}from"./ehrl4h7p8z26p31l.js";const Ze=pe(()=>ve(()=>import("./jn1zlwl4dxqm29c9.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14])).then(e=>e.GizmoConversationOptionsDropdown)),We=new Date(2024,9,11,0);function J(e){O.checkGate("3922476776")||we.abortAllRequests(),y.logEvent(x.loadThread,{threadId:e})}function et({conversation:e,conversationTitle:d,onOpenChange:m,testId:a,inMainScreen:n=!1}){const i=Z(),{isUnauthenticated:h}=Se(),{eligible:p,markAsViewed:b}=je(ke.ArchiveConversationOnboarding),u=Ce(e.id),[v,T]=o.useState(!1);o.useState(!1);const l=W(),g=Ie(),S=Ee();if(o.useEffect(()=>$(te,{deleteChat:({serverThreadId:r})=>{r===e.id&&T(!0)},archiveChat:async({serverThreadId:r})=>{r===e.id&&(await E.patchConversation(e.id,{is_archived:!0}),M(l,e.gizmo_id),O.logEvent("chatgpt_conversation_archived"),y.logEvent(x.conversationArchived),p&&(S.info(i.formatMessage({defaultMessage:"You can view archived chats in Settings",id:"HistoryGizmoItem.archiveChatOnboarding"}),{duration:10,hasCloseButton:!0}),b()),u&&K(g))}}),[g,S,l,p,e.id,e.gizmo_id,i,u,b]),h)return null;const N=t.jsx(Ze,{conversation:e,onOpenChange:m,inMainScreen:n,children:t.jsx("button",{className:"flex items-center justify-center text-token-text-secondary transition hover:text-token-text-primary radix-state-open:text-token-text-secondary","data-testid":a,"aria-label":i.formatMessage({id:"idEcXk",defaultMessage:"Open conversation options"}),children:t.jsx(Oe,{className:"icon-md"})})});return t.jsxs(t.Fragment,{children:[t.jsx(ye,{label:i.formatMessage({id:"tJPHEQ",defaultMessage:"Options"}),sideOffset:4,side:"top",children:N}),!1,v&&t.jsx(Me,{title:d,handleDelete:()=>{E.patchConversation(e.id,{is_visible:!1}).then(()=>{M(l,e.gizmo_id),O.logEvent("chatgpt_conversation_deleted"),y.logEvent(x.conversationDeleted),xe.publish({kind:"deleteConversation",serverThreadId:e.id})}),u&&K(g)},onClose:()=>{T(!1)}})]})}const se=5,tt=3e3;function st({threadId:e}){const d=W(),m=o.useRef(!1),a=o.useRef(null);return o.useEffect(()=>{async function n(){m.current=!0;const i=await $e(e);if(i.async_status===c.UNREAD){M(d,i.gizmo_id),De.initThreadFromServerData(e,i,!0,void 0,!0);return}if(i.async_status!==c.STREAMING)return;const h=i.update_time??0;ee(new Date,new Date(h*1e3))<se?a.current=window.setTimeout(n,tt):E.setConversationStatus(e)}return m.current||(y.logEvent(x.conversationPollingStarted),n()),()=>{a.current&&window.clearTimeout(a.current)}},[d,e]),null}function rt({conversation:e,className:d,hideOverflowMenu:m=!1,isActiveInMainWindow:a,isActive:n,elementRef:i,testId:h}){const p=Z(),[b,u]=o.useState(!1),[v,T]=o.useState(!1),[l,g]=o.useState(!1),S=be(),{value:N}=F("3922476776"),{value:r}=F("232791851"),ae=ze(e.id),{value:f=null,source:R=null}=ae??{},oe=Te(e.id,Ne.getRequestId),C=Re(oe),z=ee(new Date,new Date(e.update_time??0))<se,P=Pe(e.id),ne=e.update_time&&Le(new Date(e.update_time),We),L=f===c.STREAMING&&z,ie=r&&!n&&!C&&ne&&!l&&f===c.UNREAD,G=r&&(C||L)&&!l,re=r&&!a&&P.length>0&&!l,le=r&&!a&&(C||L),ce=r&&f===c.STREAMING&&R===w.SERVER&&!C&&z,I=o.useRef(!1);o.useEffect(()=>{I.current||N&&(async()=>(I.current=!0,n&&f===c.UNREAD&&(R===w.SERVER&&await E.setConversationStatus(e.id),Y(e.id,null)),!n&&R===w.CLIENT&&f===c.UNREAD&&(await E.setConversationStatus(e.id,f),Y(e.id,{value:c.UNREAD,source:w.SERVER})),I.current=!1))()},[N,n,e.id,f,R,C]),o.useEffect(()=>$(te,{editTitle:({serverThreadId:s})=>{(s?s===e.id:a)&&u(!0)}}),[e.id,a]);const j=p.formatMessage({id:"mpXAeu",defaultMessage:"New chat"}),{resolvedTitle:_,isTypingEffect:de}=Ge(e.id,e.title,n),ue=_e(),fe=de&&n&&ue,{data:me}=Ue(),U=e.conversation_template_id!=null?me?.gizmos.find(s=>s.resource.gizmo.id===e.conversation_template_id)?.resource:void 0,H=o.useRef(null),ge=t.jsx("div",{className:D("absolute bottom-0 top-0 inline-flex items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",a||v?"flex":"invisible can-hover:group-hover:visible"),ref:H,children:t.jsx(et,{conversation:e,conversationTitle:_??e.title,onOpenChange:s=>{T(s),s&&y.logEvent(x.conversationHistoryItemOpenMenu,{conversationId:e.id})},testId:`${h}-options`})}),q=S?Qe:Ye,he=(a||v)&&Je,V=o.useRef(null);return t.jsxs("div",{draggable:X(e.gizmo_id),onDragStart:s=>{if(!X(e.gizmo_id))return;const k=Ae(V.current),A=H.current;A&&(A.style.display="none"),s.dataTransfer.setDragImage(k,k.clientWidth/3,k.clientHeight/2),A&&requestAnimationFrame(()=>{A.style.display=""}),s.dataTransfer.effectAllowed="move",He({kind:"conversation",conversation:e,gizmoId:e.gizmo_id})},onDragEnd:()=>{qe()},ref:V,style:{"--item-background-color":Ve(l,n,v)},className:D(q,"relative screen-arch:bg-transparent",d),onMouseEnter:()=>{g(!0)},onMouseLeave:()=>{g(!1)},children:[S&&t.jsx("div",{className:D(q,he,"pointer-events-none absolute inset-0 group-hover:bg-transparent motion-safe:group-active:scale-[98%] motion-safe:group-active:transition-transform motion-safe:group-active:duration-100")}),ce&&t.jsx(st,{threadId:e.id}),t.jsx(B,{to:Q(e.id,U),onClick:s=>{s.metaKey||s.ctrlKey||a||J(e.id)},onDoubleClick:()=>{u(!0)},ref:i,className:"flex items-center gap-2 p-2 screen-arch:motion-safe:group-active:scale-[98%] screen-arch:motion-safe:group-active:transition-transform screen-arch:motion-safe:group-active:duration-100",style:{maskImage:"var(--sidebar-mask)"},children:t.jsx("div",{className:D("relative grow overflow-hidden whitespace-nowrap",le&&!G&&"loading-shimmer"),dir:"auto",title:_??j,children:fe?t.jsx(Fe,{text:_||j}):_||j})}),b?t.jsx("div",{className:"absolute bottom-0 left-[7px] right-2 top-0 flex items-center bg-token-sidebar-surface-secondary",children:t.jsx(Be,{conversation:e,onClose:()=>{u(!1)}})}):ie?t.jsx(B,{to:Q(e.id,U),onClick:s=>{s.metaKey||s.ctrlKey||a||J(e.id)},children:t.jsx("div",{className:"absolute bottom-0 top-0 flex items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",children:t.jsx("div",{className:"h-2 w-2 rounded-full bg-blue-selection"})})}):re?t.jsx("div",{className:"absolute bottom-0 top-0 flex items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",children:t.jsx(Ke,{task:P[0]})}):G?t.jsx("div",{className:"absolute bottom-0 top-0 flex items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",children:t.jsx(Xe,{size:16,className:"text-token-text-primary"})}):!m&&ge]})}export{et as G,rt as H};
//# sourceMappingURL=kv6ufg5o3s8p0dme.js.map
