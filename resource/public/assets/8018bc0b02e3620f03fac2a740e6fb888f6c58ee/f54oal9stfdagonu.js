const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/blt4iivbg9y2bvf9.js","assets/n3epq09dut36rmi2.js","assets/nqrmgk5te3uzwsyz.js","assets/root-nu0t8wee.css","assets/uox23aig6gp6se2y.js","assets/conversation-small-cqkvcue6.css","assets/epgcz98kjiq5r9h6.js","assets/joa8jajuiu4xqpzn.js"])))=>i.map(i=>d[i]);
import{c as M,ae as Y,dk as X,af as K,X as U,bd as Z,_ as $}from"./nqrmgk5te3uzwsyz.js";import{r as t,j as n,a5 as N}from"./n3epq09dut36rmi2.js";import{P as B,u as Q}from"./e4sjbad9hyqt73xe.js";import{b as J,c as ee}from"./dnyjnsewv99rujtf.js";import{bp as te,bq as i,jM as ne,jN as se,ih as oe,jO as re,bl as ae,bn as k,jP as ie,hO as y,fg as ce,jQ as ue,jR as le,jS as de,jT as me}from"./uox23aig6gp6se2y.js";import{P as he}from"./jvs80tn6co0ttzp0.js";import{I as fe}from"./fqlc6cxqy4xl9ika.js";import"./dkr8jkx9n88ez7ho.js";import"./nnldvg4yjd3ynnqu.js";import"./ga29rzv9pwswyv07.js";import"./d588ndwa76k83w2v.js";import"./jit20xrzecwhc2dk.js";import"./hi5bz78ars1jrvhf.js";import"./jsnptf63edu6k32a.js";import"./c1itczlqrzelhws9.js";import"./eirgecln9yzcy5p4.js";import"./izzltcwrbklvvt51.js";import"./i1gy5x3o7l2ezmdz.js";import"./m142gq95svb5klgv.js";import"./he8nwqvd8i1qrsxh.js";import"./hk3emygtpn0flzgl.js";import"./nm5ivxaismwgb6gf.js";import"./nonl1vc40q9bndh8.js";import"./oshe56yhea4czc03.js";import"./hg9sd8r31mlqtsqh.js";import"./7h5hwpux622xuq2c.js";function ge(){const[e,s]=t.useState({undoStack:[],currentIndex:-1});function o(a){s(h=>({undoStack:[...h.undoStack.slice(0,h.currentIndex+1),a],currentIndex:h.currentIndex+1}))}function c(){s(a=>({undoStack:a.undoStack,currentIndex:Math.max(a.currentIndex-1,-1)}))}function d(){s(a=>({undoStack:a.undoStack,currentIndex:Math.min(a.currentIndex+1,a.undoStack.length-1)}))}function m(){s({undoStack:[],currentIndex:-1})}return{currentDrawnShape:e.undoStack.length>0?e.undoStack[e.currentIndex]:null,onNewDrawnShape:o,canUndoDrawing:e.currentIndex>=0,undoDrawing:c,canRedoDrawing:e.currentIndex<e.undoStack.length-1,redoDrawing:d,clearAllDrawings:m}}const pe=0,xe=48;function Ie({imageAsset:e,children:s,containerDimensions:o,isLoadingNewImage:c}){return n.jsxs(N.div,{className:"absolute",style:we(e,o),...te,children:[s,n.jsx("div",{className:M("bg-token-main-surface-primary absolute inset-0 flex items-center justify-center transition-opacity duration-1000",c?"pointer-events-auto opacity-60":"pointer-events-none opacity-0")})]})}function we(e,s){const{width:o,height:c}=e,{width:d,height:m}=s,a=d-2*pe,h=m-2*xe,g=o/c,p=a/h,u=g>p,l=u?a:h*g,S=u?a/g:h;return{top:"50%",left:"50%",width:l,height:S,transform:"translate(-50%, -50%)"}}const Se=({onEscape:e})=>{t.useEffect(()=>{function s(o){o.key==="Escape"&&e()}return document.addEventListener("keydown",s),()=>{document.removeEventListener("keydown",s)}},[e])},Ce=U(()=>$(()=>import("./blt4iivbg9y2bvf9.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(e=>e.DynamicDrawingCanvas)),R=126,De=63,ve=136,je=50;function be({width:e,height:s,delay:o=je}){const[c,d]=t.useState(!1);return t.useEffect(()=>{const m=setTimeout(()=>{d(!0)},o);return()=>{clearTimeout(m)}},[o]),c?n.jsx("div",{className:"flex max-h-full max-w-full items-center justify-center",style:{width:e,height:s,aspectRatio:`${e} / ${s}`},children:n.jsx("div",{className:"bg-token-border-default h-full w-full animate-pulse"})}):null}function Qe({image:e,isLoadingNewImage:s,clientThreadId:o,onClose:c,messageId:d,onRequestCompletion:m,editorControls:a,footer:h}){const{value:g}=Y("706943082"),p=X(o),[u,l]=t.useState(i.Default),[S,P]=t.useState({width:window.innerWidth,height:window.innerHeight-R}),_=ne(),[T,L]=t.useState(!1),D=ge(),{currentDrawnShape:C,onNewDrawnShape:G,clearAllDrawings:O}=D,I=t.useRef(null),W=t.useMemo(()=>new B(J()),[]),v=t.useRef(void 0),x=t.useMemo(()=>se({pointer:e,conversationId:p,messageId:d,source:"editor"}),[e,d,p]),H=oe(r=>{const{width:f,height:w}=r.contentRect;P({width:f,height:_?w-De:w-R})});Se(t.useMemo(()=>({onEscape:()=>{u===i.Selecting?l(i.Default):c()}}),[u,c])),re(t.useMemo(()=>({image:e,currentDrawnShape:C,onCleared:()=>l(i.Default),getImageData:()=>I.current?.getImageData()}),[e,C])),t.useEffect(()=>{u!==i.Selecting&&O()},[u]),t.useEffect(()=>{l(i.Default)},[e]);const j=Q(o),b=t.useCallback(r=>{l(i.Default),j(r),c()},[j,c]),E=t.useMemo(()=>m||b,[m,b]),[F]=K(o,r=>[r?.modelId]),q=t.useCallback(r=>{const f=r.button===0;!g&&f&&u===i.Default&&(l(i.Selecting),requestAnimationFrame(()=>{if(I.current){const w=new MouseEvent(r.type,{bubbles:!0,cancelable:!0,clientX:r.clientX,clientY:r.clientY});I.current.sendEventToCanvas(w)}}))},[u,g]),A=ae({imageAssetPointer:e,serverThreadId:p}),z=t.useCallback(()=>{l(i.Selecting),k.inpaintClick({analyticsContext:x})},[x]),V=t.useCallback(r=>{const f=r.deltaY<0?"in":"out";r.ctrlKey&&v.current!==f&&(k.zoom({zoomType:f,analyticsContext:x}),v.current=f)},[x]);return n.jsx(ie.Provider,{value:x,children:n.jsxs("div",{ref:H,className:"flex h-full w-full flex-col items-center justify-between",onWheel:V,children:[a??n.jsx(fe,{clientThreadId:o,imageAsset:e,mode:u,setMode:l,inpaintingDrawingState:D,isLoadingNewImage:s,onClose:c,onInpaintClick:z,messageId:d,serverThreadId:p}),n.jsx("div",{className:"relative flex w-full grow items-center justify-center",children:n.jsxs(Ie,{imageAsset:e,containerDimensions:S,isLoadingNewImage:s,children:[A&&u!==i.Selecting&&n.jsx("img",{alt:y(e),className:"absolute inset-0 z-1 opacity-0",src:A}),!T&&n.jsx(be,{width:e.width,height:e.height}),n.jsx(ce,{className:"h-full w-full",alt:y(e),onLoad:()=>{L(!0)},src:e.url,width:e.width,height:e.height,fadeIn:!1,onMouseDown:q}),n.jsx("div",{className:M("absolute inset-0",u===i.Selecting?"":"hidden"),children:n.jsx(Ce,{drawingCanvasRef:I,color:"rgba(0, 122, 255, 0.5)",dashedOutlineColor:"rgba(255, 255, 255, 0.65)",cursorWidth:ve,canvasWidth:e.width,canvasHeight:e.height,currentDrawnShape:C,onNewDrawnShape:G})})]})}),n.jsx("div",{className:"flex min-h-[132px] w-full flex-col items-center justify-end max-sm:min-h-[84px]",children:n.jsx(N.div,{className:"mb-6 flex w-[90%] items-center justify-center lg:w-[53%]",layout:!0,transition:{duration:.2,ease:"easeInOut"},children:h??n.jsx(ue,{value:{isImageGenEditor:!0,isInpainting:u===i.Selecting,onCancelInpaint:()=>l(i.Default)},children:n.jsx(ee.Provider,{value:W,children:n.jsx(he,{clientThreadId:o,isNewThread:Z(o),currentModelId:F??le(void 0).id,onContinueGenerating:r=>E(me(r)),onRequestCompletion:async r=>E(await de(r)),hideHeader:!0})})})})})]})})}export{Qe as ImageGenNewEditor,be as ShimmerLoader};
//# sourceMappingURL=f54oal9stfdagonu.js.map
