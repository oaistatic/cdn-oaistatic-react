import{j as e,f as B,r as l,o as T,M as A}from"./n3epq09dut36rmi2.js";import{fL as O,aG as R,fx as V,h as K,fv as q,ce as _,d as P,jW as W,jX as G,I as H}from"./uox23aig6gp6se2y.js";import{c as L,S as U,C as Y,W as z}from"./azqvry2z7sssyjfm.js";import{c as j}from"./nqrmgk5te3uzwsyz.js";import{I as X}from"./bns64zud9fwchaft.js";function Z({triggerText:t,toolTip:a,ariaLabel:r,Icon:c,truncate:o=!0}){return e.jsx(O,{className:"border-token-border-default text-token-text-primary bg-token-bg-primary hover:bg-token-bg-tertiary rounded-full border px-2 py-1","aria-label":r,children:e.jsx(R,{label:a,className:"text-sm font-medium",children:e.jsxs("div",{className:"flex max-w-full items-center gap-1.5 ps-2",children:[c,e.jsx("span",{className:j("hidden sm:block",o?"max-w-[8rem] truncate md:max-w-[10rem]":"w-fit"),children:t}),e.jsx(V,{"aria-hidden":!0,className:"icon-sm"})]})})})}function $({children:t,className:a,onClick:r,isSelected:c,isActive:o,isVirtualHover:i=!1,label:f,isDisabled:n,tooltipLabel:u,isSubMenuTrigger:d,noDefaultHoverState:m,as:v="button",truncateLabel:x,infoIcon:p,infoLink:M,icon:g,...w}){const y=B();let h=e.jsx(e.Fragment,{});t?h=e.jsx("div",{className:"flex flex-1 items-center gap-4",children:t}):f&&(h=e.jsxs("div",{className:j("flex items-center gap-3",x?"w-0 flex-1":"w-full"),children:[g&&(l.isValidElement(g)?g:e.jsx(J,{icon:g})),f&&e.jsx("div",{className:j("flex flex-col items-start px-1 py-1",n&&"text-token-text-quaternary pointer-events-none",x&&"w-full"),children:e.jsx("div",{className:j("flex items-center gap-2 text-start text-sm",x&&"w-full"),children:f})})]}),u&&(h=e.jsx(R,{sideOffset:-10,label:u,className:"w-full",children:h})));const S=e.jsxs("div",{className:"min-w-[18px] items-center justify-center",children:[c&&e.jsx(K,{className:j("icon-md","color:var(--tint-color,#0285FF)"),"aria-label":y.formatMessage({id:"wham.codexMenuRow.selected",defaultMessage:"Selected"})}),p&&M&&e.jsx("a",{href:M,target:"_blank",rel:"noopener noreferrer",children:p}),d&&e.jsx(q,{className:"icon-md text-token-text-tertiary w-7","aria-label":y.formatMessage({id:"wham.codexMenuRow.openSubmenu",defaultMessage:"Open submenu"})})]}),k=j("flex cursor-pointer items-center gap-4 rounded-lg px-2 py-1.5 pe-3",o&&"bg-black/5 dark:bg-white/5",!m&&"hover:bg-black/5 dark:hover:bg-white/5",i&&"bg-black/5 dark:bg-white/5",a);if(v==="div"){const b=w;return e.jsxs("div",{...b,className:k,children:[h,S]})}const C=w;return e.jsxs("button",{type:"button",...C,onClick:b=>{b.persist(),requestAnimationFrame(()=>{r?.(b)})},className:k,children:[h,S]})}function J({icon:t}){const a=t;return e.jsx("div",{className:"text-token-text-secondary flex h-5 w-5 items-center justify-center",children:e.jsx(a,{className:"h-5 w-5 shrink-0","aria-label":""})})}const Q=({items:t,onSelect:a,keyExtractor:r})=>{const[c,o]=l.useState(null),[i]=l.useState(new Map);return{hoveredId:c,setHoveredId:o,getItemRef:n=>u=>{const d=r(n);return u&&i.set(d,u),()=>{i.delete(d)}},itemRefs:i,onKeyDown:n=>{const u=n.key==="ArrowDown"||n.key==="n"&&n.ctrlKey,d=n.key==="ArrowUp"||n.key==="p"&&n.ctrlKey;if(!(u||d||n.key==="Enter"))return;if(n.preventDefault(),n.key==="Enter"){c&&a(c);return}const m=t.findIndex(p=>r(p)===c),v=_(m-(d?1:-1),0,t.length-1),x=r(t[v]);i.get(x)?.scrollIntoView({behavior:"instant",block:"nearest"}),o(x)}}};function ee(t,a){const[r,c]=l.useState(t),o=l.useRef(P(i=>c(i),a));return l.useEffect(()=>(o.current=P(i=>{c(i)},a),()=>{o.current?.cancel()}),[a]),l.useEffect(()=>{o.current?.(t)},[t]),r}function I(t){return t.length>18?`â€¦${t.slice(-18)}`:t}function ce({environment:t}){const a=B(),{branch:r,setBranch:c}=L(),[o,i]=l.useState(""),[f,n]=l.useState(!1),u=l.useRef(null),d=()=>n(!1),m=l.useRef(t.repos[0]??null);return l.useEffect(()=>{(m.current!==t.repos[0]||!r)&&(m.current=t.repos[0],c(E(t)))},[r,c,t]),e.jsx("div",{className:"items-center rounded-full",children:e.jsxs(W,{open:f,onOpenChange:n,children:[e.jsx(Z,{triggerText:I(r??"")??a.formatMessage({id:"wham.codexBranchPopover.selectABranch",defaultMessage:"Select a Branch"}),toolTip:I(r??"")===r||f?"":r?.length?r:a.formatMessage({id:"wham.codexBranchPopover.searchForYourBranchTooltip",defaultMessage:"Search for your branch"}),ariaLabel:a.formatMessage({id:"wham.codexBranchPopover.searchForYourBranchAria",defaultMessage:"Search for your branch"}),Icon:e.jsx(U,{"aria-hidden":!0,className:"icon-sm"}),truncate:!1}),e.jsx(Y,{align:"start",sideOffset:12,isOpen:f,closePopover:d,popoverContentRef:u,children:e.jsx(te,{environment:t,repoId:m,searchQuery:o,setSearchQuery:i,setBranch:c,selectedBranch:r??"",closePopover:d})})]})})}function te({environment:t,repoId:a,setBranch:r,selectedBranch:c,searchQuery:o,setSearchQuery:i,closePopover:f}){const n=B(),u=l.useRef(null),d=ee(o,300),{data:m,isLoading:v,fetchNextPage:x,hasNextPage:p,isFetchingNextPage:M,error:g}=T({queryKey:["searchBranches",a.current,d],enabled:!!a.current,initialPageParam:null,queryFn:({pageParam:s})=>z.searchBranchesByRepository(a.current??"",d,G,s??null),getNextPageParam:s=>s?.cursor??null}),w=l.useMemo(()=>{const s=m?.pages?.flat().map(D=>D.items.flatMap(F=>F.branch))?.flat()??[],N=E(t);return N&&!s.includes(N)&&s.unshift(N),s},[m,t]),y=s=>{r(s),f()},h=l.useMemo(()=>o?.trim()?w.filter(s=>s.toLowerCase().includes(o.toLowerCase())):w??[],[o,w]),{hoveredId:S,setHoveredId:k,onKeyDown:C,getItemRef:b}=Q({items:h,keyExtractor:s=>s,onSelect:y});return l.useEffect(()=>{u.current&&u.current.focus()},[]),e.jsxs("div",{className:"bg-token-bg-primary flex max-h-[400px] w-72 flex-col gap-2 rounded-lg p-2",onClick:s=>{s.stopPropagation()},children:[e.jsx(H,{ref:u,className:"w-full rounded-sm border-none px-2 py-1 text-sm focus:ring-0 focus:ring-offset-0 focus:outline-hidden",type:"text",autoComplete:"off",name:"search-branch",value:o,onKeyDown:C,onChange:s=>i(s.target.value),placeholder:n.formatMessage({id:"wham.codexBranchPopover.branch",defaultMessage:"Enter a branch"}),ariaLabel:n.formatMessage({id:"wham.codexBranchPopover.createBranchAria",defaultMessage:"Create a new branch"})}),e.jsxs("div",{className:"min-h-18 w-full overflow-y-auto",children:[h?.map(s=>{const N=s===c;return e.jsx($,{className:"w-full",as:"button",onMouseEnter:()=>k(s),isVirtualHover:S===s,ref:b(s),onClick:()=>{y(s)},isSelected:N,label:s},s)}),g?e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(A,{id:"wham.branchPopover.error",defaultMessage:"Error loading branches"})}):null,e.jsx(X,{hasNextPage:p,fetchNextPage:x,isFetchingNextPage:M||v})]})]})}function E(t){for(const a of t.repos){const r=t.repo_map?.[a];if(r?.default_branch)return r.default_branch}return"main"}export{Z as C,ce as a,$ as b,E as g,Q as u};
//# sourceMappingURL=ipklaqcgu1ejshk6.js.map
