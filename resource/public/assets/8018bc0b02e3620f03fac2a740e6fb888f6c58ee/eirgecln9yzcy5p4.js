import{r as f,j as r,M as p,u as w,h as B,d as z,f as C,a as V,c as W,b as X}from"./n3epq09dut36rmi2.js";import{aj as Y,q as N,b as h,am as Z,ao as I,m as _,g as J}from"./nqrmgk5te3uzwsyz.js";import{f3 as F,cC as ee,f_ as te,aE as ne,f$ as se,g0 as G,g1 as oe,g2 as ae,g3 as re,l as ce,g4 as M,cX as ie,g5 as ue,g6 as de,g7 as le,g8 as H,g9 as K,ga as fe,gb as he,gc as ge,gd as me}from"./uox23aig6gp6se2y.js";import{b as pe}from"./izzltcwrbklvvt51.js";const Ce=({date:t})=>{const[e,s]=f.useState(Date.now());f.useEffect(()=>{const n=setInterval(()=>{s(Date.now())},6e4);return()=>clearInterval(n)},[]);const o=()=>{const n=new Date(t).getTime(),a=Math.floor((e-n)/1e3);return a<60?r.jsx(p,{id:"3Is9g3",defaultMessage:"Last updated a few seconds ago"}):a<3600?r.jsx(p,{id:"hXLIc6",defaultMessage:"Last updated a few minutes ago"}):r.jsx(p,{id:"ZV7Qx7",defaultMessage:"Last updated a few hours ago"})};return r.jsx("span",{children:o()})},Q=()=>w({queryKey:["user_connection_status"],queryFn:ce.user_connection_status});function Re(){const{data:t,isLoading:e,refetch:s,dataUpdatedAt:o}=Q();return f.useEffect(()=>{Y.logEventWithStatsig("Contextual Answers User Settings Modal Shown","chatgpt_contextual_answers_user_settings_modal_shown")},[]),r.jsxs("div",{children:[r.jsxs(F,{children:[r.jsxs("div",{className:"text-md text-token-text-primary mb-1 flex items-center gap-2 font-medium",children:[r.jsx(ee,{class:"icon-md"}),r.jsx("div",{children:r.jsx(p,{id:"YxAwHl",defaultMessage:"Internal knowledge"})}),r.jsx(te,{})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-token-text-secondary",children:r.jsx(p,{id:"b5cZ0X",defaultMessage:"Connect these data sources so ChatGPT can surface relevant, personalized information — based on what you’re authorized to view. {learnMore}",values:{learnMore:r.jsx(ne,{href:G,className:"underline",onClick:()=>se({link:G,location:"user_settings"}),children:r.jsx(p,{id:"N1i4rw",defaultMessage:"Learn more"})})}})}),r.jsx("p",{className:"text-token-text-secondary font-medium",children:r.jsx(Ce,{date:new Date(o)})})]})]}),r.jsx("div",{className:"border-b",children:e?r.jsx("div",{className:"p-2",children:r.jsx(pe,{lines:4})}):t?.connection_statuses.length?r.jsx("div",{children:t.connection_statuses.map(n=>r.jsx(F,{children:r.jsx("div",{className:"pt-3 pb-1",children:r.jsx(oe,{icon:r.jsx("img",{src:n.connection_display_info.icon_url??"",alt:n.connection_display_info.display_name,className:"icon-lg"}),title:n.connection_display_info.display_name,statusIndicator:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(ae,{connection:n,location:"user_settings"}),r.jsx(re,{connection:n,refetch:s})]})})})},n.user_connection_details.connection_instance_id))}):r.jsx("p",{className:"text-token-text-secondary my-2",children:r.jsx(p,{id:"nzXh59",defaultMessage:"No connections found."})})})]})}const je=M[N.GDRIVE_ACTION_CONNECTOR],_e="#settings/ConnectorSettings",Se=[N.GDRIVE_ACTION_CONNECTOR,N.GCAL_CONNECTOR,N.GMAIL_CONNECTOR].map(t=>M[t]),S="add-connector-link",Te=()=>{const t=z();return e=>{const s=window.location.hash,[o,n]=s.split("?"),a=new URLSearchParams(n);e?a.set(S,"true"):a.delete(S);const c=a.toString()?`${o}?${a.toString()}`:o;t(c,{replace:!0})}},be=()=>{const{hash:t}=B(),e=t.indexOf("?");return e===-1?!1:new URLSearchParams(t.substring(e+1)).get(S)==="true"},qe=()=>{const t=z();return e=>{const s=window.location.hash,[o,n]=s.split("?"),a=new URLSearchParams(n);e?a.set("connector",e):a.delete("connector");const c=a.toString()?`${o}?${a.toString()}`:o;t(c,{replace:!0})}},Pe=()=>{const{hash:t}=B(),e=t.indexOf("?");if(e===-1)return null;const s=t.substring(e+1);return new URLSearchParams(s).get("connector")},ye=t=>t.supported_auth.some(e=>e.type==="OAUTH")?"OAUTH":"NONE",we=t=>h.safePost("/aip/connectors/links/noauth",{requestBody:{connector_id:t.id,name:t.name,action_names:t.actions.map(e=>e.name)}}),xe=async(t,e)=>{const s=de[t.id],o={connectorId:t.id,name:t.name,actionNames:t.actions.map(n=>n.name),oauthClientId:le(s,e),oauthClientScopes:null};await H(K,o,_e)},Ee=async(t,e)=>{switch(ye(t)){case"OAUTH":return await xe(t,e),null;case"NONE":return await we(t)}},Ue=()=>{const t=ie(),e=Q(),s=f.useMemo(()=>e.data?.connection_statuses.filter(i=>["google_drive_oauth","google_drive_dwd"].includes(i.user_connection_details.knowledge_connector_type)),[e.data]),o=t&&!!s?.length,n=ue(),a=n.connectorConfig.get(Z.GDRIVE),c=n.isGdriveEnabled&&!!a;return{isLoading:e.isLoading||n.isLoading,fileUploadConfig:c?a:null,internalKnowledgeConfigs:o?s:null}};async function ve(t){return(await h.safeGet("/aip/connectors/mcp/oauth_config",{parameters:{query:{mcp_url:t}}})).oauth_config}async function De(t){await h.safePost("/aip/connectors/mcp/refresh_actions",{requestBody:{link_id:t}})}function Ne(t){const e=C(),o=I()?.getWorkspaceId(),n=_(),{data:a,isLoading:c,error:i,refetch:d}=w({queryKey:["fetchConnectorWorkspacePermissions",o,t],queryFn:async()=>{if(!o)return!0;try{const{enabled:l}=await h.safeGet("/accounts/{account_id}/connectors/{connector_id}/workspace_permissions",{parameters:{path:{account_id:o,connector_id:t}}});return l}catch(l){throw n.danger(e.formatMessage({id:"GZxiZ3",defaultMessage:"Error fetching connector workspace permissions"})),l}}});return{enabled:a,isLoading:c,error:i,refetch:d}}function Fe(){return Ne(M[N.GITHUB_CONNECTOR])}function $({skip:t=!1}={}){const e=C(),s=I(),o=_(),{data:n,isLoading:a,isFetching:c,error:i,refetch:d}=w({queryKey:["fetchPlatformConnectorData",s?.normalizedAccountUserId],queryFn:async()=>{if(!s||!s.normalizedAccountUserId)return[];try{return(await h.safePost("/aip/connectors/list_accessible",{requestBody:{principals:[{type:"USER",id:s.normalizedAccountUserId}]}})).connectors}catch(u){throw o.danger(e.formatMessage({id:"F+mY2E",defaultMessage:"Error fetching connectors"}),{id:"fetch-connectors-error",duration:3,hasCloseButton:!0}),u}},enabled:!t&&!!s});return{platformConnectors:f.useMemo(()=>new Map(n?.map(u=>[u.id,u])),[n]),isLoading:a,isFetching:c,error:i,refetch:d}}function Ge(t=!0){const e=C(),s=_(),{data:o,isLoading:n,error:a,refetch:c}=w({queryKey:["fetchFirstPartyConnectors"],queryFn:async()=>{try{return(await h.safeGet("/aip/connectors/first_party")).connectors}catch{return s.danger(e.formatMessage({id:"F+mY2E",defaultMessage:"Error fetching connectors"}),{id:"fetch-first-party-connectors-error",duration:3,hasCloseButton:!0}),[]}},enabled:t});return{connectors:o??[],isLoading:n,error:a,refetch:c}}function T({skip:t=!1}={}){const e=C(),s=I(),o=_(),{data:n,isLoading:a,isFetching:c,error:i,refetch:d}=w({queryKey:["fetchConnectorLinkData",s?.normalizedAccountUserId],enabled:!t,queryFn:async()=>{if(!s||!s.normalizedAccountUserId)return{};try{const u=await h.safePost("/aip/connectors/links/list_accessible",{requestBody:{principals:[{type:"USER",id:s.normalizedAccountUserId}]}});return me(u.links,({connector_id:g})=>g)}catch(u){throw o.danger(e.formatMessage({id:"EgrzHa",defaultMessage:"Error fetching connectors connections"}),{id:"fetch-connector-links-error",duration:3,hasCloseButton:!0}),u}}});return{connectorLinks:f.useMemo(()=>n?new Map(Object.entries(n)):new Map,[n]),isLoading:a,isFetching:c,error:i,refetch:d}}function Le(t,e){const s=C(),o=_(),{data:n,isLoading:a,error:c,refetch:i}=w({queryKey:["connector-client-data",t],queryFn:async()=>{const d=await h.safeGet("/aip/connectors/oauth_clients",{parameters:{query:{service:e}}});return d.oauth_clients?d.oauth_clients:(o.danger(s.formatMessage({id:"OfpT7B",defaultMessage:"Request error fetching oauth clients"}),{id:"fetch-oauth-clients-error",duration:3,hasCloseButton:!0}),[])}});return{oAuthClients:n,isLoading:a,error:c,refetch:i}}function Be(t,e,s="/",o,n){const a=fe(),{platformConnectors:c,isLoading:i,error:d,refetch:l}=$(),{connectorLinks:u,isLoading:g,error:x,refetch:m}=T(),{oAuthClients:y,isLoading:L,error:A,refetch:b}=Le(t,e),q=Oe(),O=f.useCallback(()=>{l(),m(),b()},[l,m,b]),E=M[t],R=c.get(E),P=u.has(E),j=u.get(E)?.[0]?.id,U=f.useCallback(()=>{j&&q(j,()=>{O()})},[q,O,j]),v=d??x??A,k=i||g||L,D=f.useCallback(()=>{if(!k){if(!R){o?.();return}if(!y?.length){n?.();return}H(K,{oauthClientId:y[0].id,oauthClientScopes:y[0].scopes,name:R.name,actionNames:he[t],connectorId:E},s,a)}},[k,R,y,t,E,s,a,o,n]);return f.useMemo(()=>({isLoading:k,isConnected:P,connect:D,error:v,refetch:O,handleDisconnect:U}),[k,P,D,v,O,U])}function ze(t){"use forget";const e=W.c(15),{onSuccess:s}=t,o=C(),n=J(),a=_(),{refetch:c}=$(),{refetch:i}=T();let d;e[0]!==n?(d=async x=>{const{supported_auth:m,...y}=x,{connector:L}=await h.safePost("/aip/connectors/mcp",{requestBody:{...y,auth_request:{supported_auth:m,oauth_client_params:null}}}),A=await Ee(L,n);return{connector:L,link:A}},e[0]=n,e[1]=d):d=e[1];let l;e[2]!==o||e[3]!==s||e[4]!==c||e[5]!==i||e[6]!==a?(l=x=>{const{connector:m}=x;m.supported_auth.length===0&&a.success(o.formatMessage({id:"lQ8QJw",defaultMessage:"{connectorName} is now connected"},{connectorName:m.name})),c(),i(),s?.(m)},e[2]=o,e[3]=s,e[4]=c,e[5]=i,e[6]=a,e[7]=l):l=e[7];let u;e[8]!==o||e[9]!==a?(u=()=>{a.danger(o.formatMessage({id:"rftuYU",defaultMessage:"Error creating custom connector"}))},e[8]=o,e[9]=a,e[10]=u):u=e[10];let g;return e[11]!==d||e[12]!==l||e[13]!==u?(g={mutationFn:d,onSuccess:l,onError:u},e[11]=d,e[12]=l,e[13]=u,e[14]=g):g=e[14],X(g)}function Oe(){const t=C(),e=_(),s=I(),o=T(),n=V();return async(c,i)=>{try{await ge(c),n.invalidateQueries({queryKey:["fetchConnectorLinkData",s?.normalizedAccountUserId]}),await o.refetch(),i?.()}catch{e.danger(t.formatMessage({id:"Gmong7",defaultMessage:"Error disconnecting connector"}))}}}export{Re as C,je as G,Ge as a,Fe as b,Be as c,T as d,$ as e,qe as f,Oe as g,Ue as h,Q as i,we as j,Pe as k,Se as l,xe as m,ze as n,ve as o,ye as p,be as q,De as r,Te as s,Ne as u};
//# sourceMappingURL=eirgecln9yzcy5p4.js.map
