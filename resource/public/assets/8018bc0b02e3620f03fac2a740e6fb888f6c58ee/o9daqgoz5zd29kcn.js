import{m as j,E as v,et as b,eq as R}from"./nqrmgk5te3uzwsyz.js";import{a as A,f as q,r as e,j as n,a9 as F,d as L,h as M,D as N}from"./n3epq09dut36rmi2.js";import{u as Q}from"./geq0szxpp44x56uy.js";import{e as U,f as K,c as O,W as $,d as B}from"./azqvry2z7sssyjfm.js";import{b as G,c as H}from"./dnyjnsewv99rujtf.js";import{P as V}from"./e4sjbad9hyqt73xe.js";import{fV as z}from"./uox23aig6gp6se2y.js";import{u as J,W as X}from"./es8ut1140mmjn9bb.js";import{i as Y}from"./k9dqus9crie9cyow.js";import"./dkr8jkx9n88ez7ho.js";import"./nnldvg4yjd3ynnqu.js";import"./esvlql2z91zwym50.js";import"./ms88w7omyr5fyl5m.js";import"./mwmzy5d3s65b6nqi.js";import"./eirgecln9yzcy5p4.js";import"./izzltcwrbklvvt51.js";import"./oshe56yhea4czc03.js";import"./ipklaqcgu1ejshk6.js";import"./bns64zud9fwchaft.js";import"./gt0o8gecgu18rlu9.js";import"./hywf39bgiuru57vx.js";import"./dplssc7283prca44.js";import"./732ktrbtyfqle46e.js";import"./loybro28dk8o1rh8.js";import"./lw3nae8q1eor1tu0.js";import"./kth8b95xbvmuu5bx.js";import"./iwi9e9tak1je4ys9.js";import"./xdtirbwvvk4sqc30.js";import"./iiunoc4k1n6g4a9l.js";import"./kvhuqs0v8em60vy1.js";import"./mmgogcu21wjwfuju.js";import"./oco3z5r1wfatkk2z.js";import"./i29w7batiy3i4iov.js";import"./h0v70jeb8vuswv8x.js";import"./bqizorod7tt9c8xq.js";import"./e3g5ffsb6g0bu7pn.js";import"./ge980eja361ie3ca.js";import"./gbfmb6n7vmtt0mld.js";import"./mgq4dy5xj5doeoq7.js";import"./b99rlgw1hhu0zh6m.js";function Z({taskId:s,onClose:a}){const o=A(),m=j(),i=q(),{data:t,error:x}=U(s);K(s);const g=O(({getTurnsForTask:r})=>r(s)),u=v(),c=e.useMemo(()=>u?new V(G()):new z,[u]),p=e.useSyncExternalStore(r=>c.subscribe("change",r),()=>!c.isEmpty(),()=>!1),[f,l]=e.useState([]),[P,d]=e.useState(!1),{focusedAssistantTurn:_,setFocusedAssistantTurnId:D}=J({taskId:s,task:t?.task,currentDiffTaskTurn:t?.current_diff_task_turn??null,currentUserTurn:t?.current_user_turn??null,currentAssistantTurn:t?.current_assistant_turn??null}),C=!!t?.task.has_unread_turn&&t?.task?.current_turn_id===t.current_assistant_turn?.id,k=t?.current_assistant_turn?.turn_status==="completed";e.useEffect(()=>{if(!u)return;const r=t?.task?.title;if(r){const y=document.title;return document.title=r,()=>{document.title=y}}},[u,t?.task?.title]),e.useEffect(()=>{C&&k&&$.markTurnAsRead(s).then(()=>{o.invalidateQueries({queryKey:["wham","tasks"]}),o.invalidateQueries({queryKey:["wham","task",s]})})},[C,k,s,o]);const h=f.length>0,T=e.useCallback(({force:r=!1}={})=>{if(r||!h&&!p){l([]),a();return}d(!0)},[a,h,p]),E=t?.current_assistant_turn?Y(t?.current_assistant_turn.turn_status):!1,S=t?.current_diff_task_turn?.id===_?.id,W=!t?.current_diff_task_turn,w=E&&(S||W);return x?(m.danger(i.formatMessage({id:"wham.task-details.error",defaultMessage:"Error loading task"}),{id:`wham-task-details-error-${s}`,hasCloseButton:!0,duration:3}),n.jsx(F,{to:"/codex"})):n.jsx(H.Provider,{value:c,children:n.jsx(X,{permissions:"write",onEscape:T,taskId:s,turnId:t?.current_assistant_turn?.id??"",lastTurnWithDiffId:t?.current_diff_task_turn?.id??"",confirmClose:P,setConfirmClose:d,task:t?.task,focusedAssistantTurn:_,pastTurns:g,clearComments:()=>l([]),setComments:l,comments:f,canFollowUp:w,handleClose:T,setFocusedAssistantTurnId:D})})}function I(){const s=L(),a=M(),{taskId:o}=N();Q(),B();const m=a.state??{},{backgroundLocation:i}=m,t=e.useCallback(()=>{s(i?-1:"/codex")},[i,s]);return o?n.jsx(b,{children:n.jsx(Z,{taskId:o,onClose:t})}):null}const Ut=()=>[{title:"Codex"}],Kt=R(function(){return n.jsx(I,{})});export{Kt as default,Ut as meta};
//# sourceMappingURL=o9daqgoz5zd29kcn.js.map
