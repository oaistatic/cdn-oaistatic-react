import{j as s,a6 as J,a5 as W,f as F,r,M as T,k as Z,d as z,o as ee,v as te,R as se}from"./n3epq09dut36rmi2.js";import{l as E,c as w,cQ as ne,ds as ae,aj as oe,eO as re,ac as U,b as ce,ae as O,k as ie,ao as le,dd as ue}from"./nqrmgk5te3uzwsyz.js";import{u as de,F as B}from"./noppaak77yhwzd3y.js";import{u as b,F as p,a as j,b as fe}from"./gs8kbr9bfiwsxmyq.js";import{e_ as Y,hU as me,mo as he,dc as $,U as xe,s3 as ge,a2 as V,d as ye,f as pe}from"./uox23aig6gp6se2y.js";import{u as ve}from"./e3jbhlk6nvddhkdz.js";import"./hk3emygtpn0flzgl.js";import"./nm5ivxaismwgb6gf.js";import"./dnyjnsewv99rujtf.js";import"./e4sjbad9hyqt73xe.js";import"./dkr8jkx9n88ez7ho.js";import"./nnldvg4yjd3ynnqu.js";import"./h446s733avqwi4v2.js";function ke({children:e,rootClassName:t,className:n,description:a,icon:c,isOpen:o=!1,onClose:i,primaryButton:m,secondaryButton:d,size:h="normal",title:x,type:g,noPadding:f=!1,hideSeparator:v=!1,showCloseButton:l=!1,shouldIgnoreClickOutside:y=!1,closeButton:D,isScrollable:S=!0,position:A="center",removePopoverStyling:_=!1,showOverlayBackground:L=!0,shadow:M="normal"}){const R=!!x,P=!!e,u=R&&P&&!v;return s.jsx(J,{children:o&&s.jsx(E.Root,{testId:"modal-fanny-pack",isOpen:!0,onClose:i,shouldIgnoreClickOutside:y,className:t,children:s.jsx(E.Overlay,{showBackground:L,children:s.jsxs(we,{size:h,position:A,className:w("flex flex-col focus:outline-hidden",{"max-w-md":h==="normal"},n),removePopoverStyling:_,shadow:M,children:[s.jsx(E.Header,{icon:c,title:x,type:g,closeButton:l&&(D??s.jsx(ne,{onClick:()=>i(!0)})),description:a,withSeparator:u}),s.jsxs("div",{className:w("grow",S?"overflow-y-auto":"overflow-y-hidden",{"p-4 sm:p-6":h!=="fullscreen"&&!f,"md:pt-0!":!P}),children:[e,m!=null||d!=null?s.jsx(E.Actions,{primaryButton:m,secondaryButton:d,modalHasContent:P}):null]})]})})})})}function we({className:e,children:t,position:n="center",size:a,removePopoverStyling:c=!1,shadow:o="normal"}){return s.jsx(W.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},exit:{opacity:0,y:14},transition:{duration:.175,ease:"easeInOut",exit:{opacity:{duration:.1,ease:"easeOut"},y:{duration:.175,ease:"easeOut"}}},className:w("z-50 h-full w-full overflow-y-auto",a!=="fullscreen"&&"grid grid-cols-[10px_1fr_10px]",a!=="fullscreen"&&n==="center"&&"grid-rows-[minmax(10px,1fr)_auto_minmax(10px,1fr)] md:grid-rows-[minmax(20px,1fr)_auto_minmax(20px,1fr)]",a!=="fullscreen"&&n==="bottom"&&"grid-rows-[minmax(10px,1fr)_auto_10px] md:grid-rows-[minmax(20px,1fr)_auto_20px]"),children:s.jsx(ae,{className:w(!c&&"popover","bg-token-main-surface-primary relative start-1/2 col-auto col-start-2 row-auto row-start-2 h-full w-full text-start ltr:-translate-x-1/2 rtl:translate-x-1/2",a!=="fullscreen"&&"rounded-2xl",o==="normal"&&"shadow-xl",e),children:t})})}function je(){const e=F(),t=b(a=>a.query),n=r.useRef(null);return s.jsx("input",{className:"placeholder:text-token-text-tertiary w-full border-none bg-transparent focus:border-transparent focus:ring-0 focus:outline-hidden",placeholder:e.formatMessage({id:"FannyPack.SearchPlaceholder",defaultMessage:"Search chats..."}),onChange:a=>p.setQuery(a.target.value),onKeyDown:a=>{!a.shiftKey&&(a.key==="ArrowUp"||a.key==="ArrowDown")&&a.preventDefault()},value:t,ref:n})}function C({className:e,isActive:t=!1,icon:n,children:a,onClick:c,onMouseEnter:o,onMouseLeave:i}){const m=b(d=>d.mouseInteractionsDisabled);return s.jsx("div",{className:w("cursor-pointer",e),onMouseEnter:m?void 0:o,onMouseLeave:m?void 0:i,onClick:c,children:s.jsxs("div",{className:w("group relative flex items-center rounded-lg px-4 py-3",t&&"dark:bg-token-main-surface-secondary bg-[#f4f4f4]"),children:[n,s.jsx("div",{className:w("relative grow overflow-hidden whitespace-nowrap",n?"ps-4":""),children:a})]})})}function G(e){return e.formatMessage({id:"fannyPack.DefaultChatTitle",defaultMessage:"New chat"})}function be({historyResult:e,index:t}){const n=F(),{item:a,onSelect:c}=e,o=b(i=>i.activeIndex);return s.jsx(C,{isActive:o===t,icon:s.jsx(Y,{className:"icon-sidebar text-token-text-secondary"}),onClick:()=>{j.logClick(a.id,t,"history"),c&&c()},onMouseEnter:()=>p.setActiveIndex(t),onMouseLeave:()=>p.setActiveIndex(void 0),children:s.jsx("div",{className:"text-sm",children:a.title??G(n)})})}function Ne({labelResult:e}){return s.jsx("div",{className:"group text-token-text-secondary relative my-2 px-4 py-2 text-xs leading-4 font-medium",children:e.text})}function Ce({newChatResult:e,query:t=void 0,index:n}){const{onSelect:a}=e,c=b(o=>o.activeIndex);return s.jsx(C,{isActive:c===n,onClick:()=>{oe.logNewChatButtonClicked({location:"Fanny Pack"}),a&&a()},onMouseEnter:()=>p.setActiveIndex(n),onMouseLeave:()=>p.setActiveIndex(void 0),icon:s.jsx(me,{className:"icon-sidebar text-token-text-secondary"}),children:s.jsx("div",{className:"text-sm",children:t?s.jsx(T,{id:"iQsutJ",defaultMessage:'New chat "{query}"',values:{query:t}}):s.jsx(T,{id:"FannyPack.NewChat",defaultMessage:"New chat"})})})}function Se(e){return r.useMemo(()=>{if(!e)return null;const t=new Date(e*1e3),n=new Date;return t.toDateString()===n.toDateString()?"Today":new Date(new Date().setDate(n.getDate()-1)).toDateString()===t.toDateString()?"Yesterday":t.getFullYear()===n.getFullYear()?t.toLocaleDateString(void 0,{month:"short",day:"numeric"}):t.toLocaleDateString(void 0,{year:"2-digit",month:"numeric",day:"numeric"})},[e])}var q,H;function Me(){if(H)return q;H=1;var e=re(),t=/[\\^$.*+?()[\]{}|]/g,n=RegExp(t.source);function a(c){return c=e(c),c&&n.test(c)?c.replace(t,"\\$&"):c}return q=a,q}var Re=Me();const Pe=Z(Re),Ee=8;function Fe(e){return e.isArchived?{titleClassName:"text-sm text-token-text-tertiary",titleHighlightedClassName:"text-token-text-secondary font-semibold",messageClassName:"text-xs text-token-text-tertiary",messageHighlightedClassName:"text-token-text-secondary font-medium"}:{titleClassName:"text-sm text-token-text-primary",titleHighlightedClassName:"text-token-text-primary font-semibold",messageClassName:"text-xs text-token-text-secondary",messageHighlightedClassName:"text-token-text-primary font-medium"}}function K({text:e,textToHighlight:t,shouldAdjustStart:n=!1,highlightClassName:a}){const c=r.useMemo(()=>{if(!n||!t)return e;const i=e.toLowerCase().indexOf(t?.toLowerCase());if(i===-1)return e;const m=Math.max(i-Ee,0),d=e.substring(m);return m===0?d:"â€¦"+d},[e,t,n]),o=r.useMemo(()=>{const i=new RegExp(`(${Pe(t)})`,"gi");return c.split(i)},[c,t]);return!t||t.length===0?s.jsx("span",{children:e}):s.jsx("div",{className:"truncate",children:o.map((i,m)=>i.toLowerCase()===t.toLowerCase()?s.jsx("span",{className:a,children:i},m):i)})}function Ie({searchResult:e,index:t,elementRef:n}){const{item:a,onSelect:c,query:o}=e,i=F(),m=Se(a.updateTime),d=Fe(a),x=b(f=>f.activeIndex)===t,g=r.useRef(null);return r.useEffect(()=>{let f;const v=setTimeout(()=>{f=new IntersectionObserver(l=>{l.forEach(y=>{y.isIntersecting&&(j.logImpression(a.source,t,a.conversationId),f&&f.disconnect())})},{threshold:.5}),g.current&&f.observe(g.current)},250);return()=>{f&&f.disconnect(),clearTimeout(v)}},[g,a,o,t]),s.jsx("div",{ref:g,children:s.jsx(C,{isActive:x,icon:a.isArchived?s.jsx(he,{className:"icon-sidebar text-token-text-tertiary"}):s.jsx(Y,{className:"icon-sidebar text-token-text-secondary"}),onClick:()=>{j.logClick(a.conversationId,t,a.source),c&&c()},onMouseEnter:()=>p.setActiveIndex(t),onMouseLeave:()=>p.setActiveIndex(void 0),children:s.jsxs("div",{className:"flex items-center",ref:n,children:[s.jsxs("div",{className:"relative grow overflow-hidden whitespace-nowrap",children:[s.jsx("div",{className:d.titleClassName,children:s.jsx(K,{text:a.title&&a.title.length>0?a.title:G(i),textToHighlight:o.length>=3?o:void 0,highlightClassName:d.titleHighlightedClassName})}),s.jsx("div",{className:w("pt-1",d.messageClassName),children:s.jsx(K,{text:a.snippet??"",textToHighlight:o.length>=3?o:void 0,shouldAdjustStart:!0,highlightClassName:d.messageHighlightedClassName})})]}),x&&s.jsx("div",{className:"text-token-text-secondary ps-6 text-xs",children:m})]})})})}function I(){return r.useMemo(()=>({closeFannyPackModal:e=>{j.logClose(e),p.setIsActive(!1)}}),[])}function Q(){const e=z(),t=$(),{closeFannyPackModal:n}=I();return r.useCallback(a=>{t&&xe.closeActiveSidebar(),e(a),n("click")},[e,n,t])}function De(){const{conversations:e}=ge(r.useMemo(()=>({}),[])),t=U("550560761").config.value,n=Number(t?.history_results_limit??6),a=r.useMemo(()=>e.slice(0,Math.min(e.length,n)),[e,n]),c=ve(a,0),o=Q(),i=r.useMemo(()=>({kind:"newChat",onSelect:()=>{o("/")}}),[o]);return r.useMemo(()=>{const d=[i];return d.push(...[c.recent,c.dynamicMonths,c.dynamicYears].reduce((h,x)=>(Object.entries(x).forEach(([g,{items:f,label:v}])=>{f.length>0&&(h.push({kind:"label",text:v}),f.forEach(l=>{h.push({kind:"history",onSelect:()=>{o(V(l.id))},item:l})}))}),h),[])),d},[i,c,o])}async function Ae({query:e,cursor:t}){return ce.safeGet("/conversations/search",{parameters:{query:{query:e,cursor:t}}})}function _e(){const e=b(u=>u.query),t=Q(),[n,a]=r.useState(""),[c,o]=r.useState(!1),i=r.useRef(ye(u=>{o(!1),a(u)},250)).current,m=r.useCallback(u=>{u!==n&&(o(!0),i(u))},[n,i]);r.useEffect(()=>{m(e)},[e,m]);const{data:d,isError:h,isLoading:x,isFetchingNextPage:g,hasNextPage:f,fetchNextPage:v}=ee({queryKey:["conversationSearch",{query:n}],queryFn:({pageParam:u})=>Ae({query:n,cursor:u}),initialPageParam:"",getNextPageParam:u=>u.cursor??void 0,enabled:!!n});r.useEffect(()=>{x&&j.logQuery()},[x]),r.useEffect(()=>{h&&j.logQueryError()},[h]),r.useEffect(()=>{g&&j.logQueryMore()},[g]);const l=r.useMemo(()=>d?.pages.flatMap(u=>u.items)??[],[d]),y=r.useRef(null),D=r.useCallback(u=>{x||u==null||(y.current?.disconnect(),y.current=new IntersectionObserver(k=>{k[0].isIntersecting&&!g&&f&&v()}),y.current.observe(u))},[x,g,f,v]);r.useEffect(()=>()=>{y.current?.disconnect()},[]);const S=l&&n===e,A=e.length>0&&(c||x||g),_=U("550560761").config.value,L=Number(_?.local_results_limit??0),M=de(e,L),R=r.useMemo(()=>{const u=M;return S&&l.forEach(k=>{u.has(k.conversation_id)||u.set(k.conversation_id,{conversationId:k.conversation_id,nodeId:k.current_node_id,title:k.title,isArchived:k.is_archived,updateTime:k.update_time,snippet:k.payload.snippet,source:"remote"})}),Array.from(u.values())},[M,l,S]);return{searchResults:r.useMemo(()=>R.map(u=>({kind:"search",onSelect:()=>{t(`${V(u.conversationId)}?src=history_search`)},item:u,query:e})),[R,t,e]),shouldShowLoading:A,infiniteScrollTriggerElementRef:D}}function Le(e,t,n){switch(e.kind){case"history":return s.jsx(be,{historyResult:e,index:t});case"label":return s.jsx(Ne,{labelResult:e});case"loading":return s.jsx(Qe,{loadingResults:e});case"newChat":return s.jsx(Ce,{newChatResult:e,query:e.query,index:t});case"noResults":return s.jsx(Oe,{});case"search":return s.jsx(Ie,{searchResult:e,index:t,elementRef:n})}}function qe(e,t){const n=r.useCallback(()=>{for(let o=(e??-1)+1;o<t.length;o++)if(t[o].onSelect)return o;return e},[e,t]),a=r.useCallback(()=>{for(let o=(e??t.length)-1;o>=0;o--)if(t[o].onSelect)return o;return e},[e,t]),c=r.useCallback(()=>{e!==void 0&&t[e]&&t[e].onSelect&&t[e].onSelect()},[e,t]);r.useEffect(()=>{const o=i=>{i.isComposing||(i.key==="ArrowUp"&&!i.shiftKey?p.setActiveIndex(a()):i.key==="ArrowDown"&&!i.shiftKey?p.setActiveIndex(n()):(i.key==="Enter"||i.key==="Return")&&(i.preventDefault(),c()))};return window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)}},[a,n,c]),r.useEffect(()=>{const o=()=>{fe.getMouseInteractionsDisabled()&&p.setMouseInteractionsDisabled(!1)};return window.addEventListener("mousemove",o),()=>{window.removeEventListener("mousemove",o)}},[])}function Te(e,t){const n=r.useRef([]);return r.useEffect(()=>{n.current=t.map(()=>se.createRef())},[t]),r.useEffect(()=>{n.current.forEach((a,c)=>{e===c&&a?.current&&a.current.scrollIntoView({behavior:"instant",block:"nearest"})})},[e,n]),n}function Oe(){return s.jsx(C,{className:"text-token-text-tertiary text-sm",icon:s.jsx(pe,{className:"icon-sidebar"}),children:s.jsx(T,{id:"FannyPack.Noresults",defaultMessage:"No results"})})}function N(){return s.jsx(C,{icon:s.jsx("div",{className:"loading-results-shimmer bg-token-main-surface-secondary h-[14px] w-[14px] rounded-full"}),children:s.jsxs("div",{className:"flex min-h-[40px] flex-col justify-center",children:[s.jsx("div",{className:"loading-results-shimmer bg-token-main-surface-secondary h-2 w-1/4 rounded-full"}),s.jsx("div",{className:"loading-results-shimmer bg-token-main-surface-secondary mt-3 h-2 w-1/2 rounded-full"})]})})}function Qe({loadingResults:e}){return e.shouldShowMultiple?s.jsxs(s.Fragment,{children:[s.jsx(N,{}),s.jsx(N,{}),s.jsx(N,{}),s.jsx(N,{}),s.jsx(N,{})]}):s.jsx(N,{})}function Be(){const e=Q(),{searchResults:t,shouldShowLoading:n,infiniteScrollTriggerElementRef:a}=_e(),c=De(),o=b(l=>l.query),i=o.length>0,{value:m}=O("1741586789");r.useEffect(()=>{j.setQuerySessionId(te())},[o]);const d=r.useMemo(()=>({kind:"newChat",query:o,onSelect:()=>{e(`/?q=${o}`)}}),[o,e]),h=r.useMemo(()=>{const l=[];return o&&m&&l.push(d),i?l.push(...t):l.push(...c),n?l.push({kind:"loading",shouldShowMultiple:l.length===0}):l.length===0&&l.push({kind:"noResults"}),l},[o,m,d,i,n,t,c]),x=b(l=>l.activeIndex);qe(x,h);const g=Te(x,h),f=r.useRef(null);r.useEffect(()=>{p.setActiveIndex(0),f.current&&(f.current.scrollTop=0)},[o]);const v=r.useRef(!0);return r.useEffect(()=>{v.current&&!n&&h.length===1&&h[0].kind==="noResults"&&j.logNoResults(),v.current=n},[n,h]),s.jsx("div",{ref:f,children:s.jsx("ol",{className:"mx-2",children:h.map((l,y)=>s.jsx("li",{ref:g.current[y],children:Le(l,y,y===h.length-1?a:void 0)},y))})})}function at(){const e=b(n=>n.isActive);return $()?s.jsx(Ke,{isOpen:e}):s.jsx(Ue,{isOpen:e})}function He({onClick:e,className:t}){const n=F();return s.jsx("button",{className:w("hover:bg-token-main-surface-secondary focus-visible:ring-token-text-quaternary dark:hover:bg-token-main-surface-tertiary flex items-center justify-center rounded-full bg-transparent p-1 focus-visible:ring-2 focus-visible:ring-offset-1 focus-visible:ring-offset-transparent focus-visible:outline-hidden",t),"aria-label":n.formatMessage({id:"Px7S/2",defaultMessage:"Close"}),onClick:e,children:s.jsx(ue,{className:"icon-sidebar text-token-text-tertiary hover:text-token-text-primary"})})}function X({className:e}){const{closeFannyPackModal:t}=I(),n=le(),a=r.useRef(!1),{value:c}=O("3678527908"),{value:o}=O("1422501431");return r.useEffect(()=>{!a.current&&c&&n&&(o?B.setCurrentAccountV2(n):B.setCurrentAccount(n),a.current=!0)},[c,n,o]),s.jsxs("div",{className:w("flex flex-col",e),children:[s.jsxs("div",{className:"ms-6 me-4 flex max-h-[64px] min-h-[64px] items-center justify-between",children:[s.jsx(je,{}),s.jsx(He,{className:"ms-4",onClick:()=>{t("button")}})]}),s.jsx("hr",{className:"border-token-border-default"}),s.jsx("div",{className:"my-2 grow overflow-y-auto",children:s.jsx(Be,{})})]})}function Ke({isOpen:e}){const{closeFannyPackModal:t}=I();return s.jsx(ie,{testId:"modal-fanny-pack-mobile",isOpen:e,onClose:()=>{t("modal")},size:"fullscreen",showCloseButton:!0,type:"success",noPadding:!0,children:s.jsx(X,{})})}function Ue({isOpen:e}){const{closeFannyPackModal:t}=I();return s.jsx(ke,{className:"border-token-border-default border bg-clip-padding shadow-[0_14px_62px_0_rgba(0,0,0,0.25)] md:max-w-[680px] md:min-w-[680px]",isOpen:e,onClose:()=>{t("modal")},showCloseButton:!0,type:"success",noPadding:!0,showOverlayBackground:!1,shadow:"custom",children:s.jsx(X,{className:"max-h-[440px] min-h-[440px]"})})}export{at as FannyPackModalContainer};
//# sourceMappingURL=dveqw68h0kumimpe.js.map
