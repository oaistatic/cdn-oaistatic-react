import{cf as h,gd as x,d$ as v,bc as T,aa as g,ag as b,aX as y}from"./nqrmgk5te3uzwsyz.js";import{dO as M,H as C,dP as P}from"./uox23aig6gp6se2y.js";import{m as I}from"./dnyjnsewv99rujtf.js";async function w(e,o,l,{unprocessed:m=!1}={}){const t=[],i=[],n={};for(const c of e.messages){if(F(c)){const a=c.metadata?.content_references,r=h(c);if(m)t.push(r);else{const s=I(r,a);s["text/plain"]&&t.push(s["text/plain"]),s["text/html"]&&i.push(s["text/html"])}}if(x(c)){const a=v.getImageAssetPointers(c);if(a.length>0){const r=a[0];try{const s=T(l),{url:p}=await M.fetch(o,{asset:r,conversationId:s??void 0}),u=await(await fetch(p)).blob();["image/png","image/jpeg","image/webp"].includes(u.type)&&(n[u.type]=u)}catch{return Promise.reject()}}}}return t.length>0&&(n["text/plain"]=t.join(`

`)),i.length>0&&(n["text/html"]=i.join(`

`)),n}function F(e){return!e.clientMetadata?.err&&(e.author.role===g.Assistant||e.author.role===g.User)&&(e.author.role===g.User||e.recipient==="all")&&!e.metadata?.reasoning_status}const U=async(e,o,l,m,t,i="mouse",n)=>{const a=b.getConversationTurns(y(o))[l];if(!a)return Promise.reject();const{messages:r}=a,s=t,p=r[0]?.author.role===g.User,d=s.metaKey||s.altKey,u=await w(a,n,o,{unprocessed:d||p});await C(u,m,t);const f=T(o);f&&P(e,{messageId:r[0].id,type:"copy",serverThreadId:f,selectedText:h(r[0]),source:i,location:"message"})},R=(e,o,l,m,t="mouse",i)=>{const n=b.getConversationTurns(y(o));return U(e,o,n.length-1,l,m,t,i)};export{U as a,R as c};
//# sourceMappingURL=nm5ivxaismwgb6gf.js.map
