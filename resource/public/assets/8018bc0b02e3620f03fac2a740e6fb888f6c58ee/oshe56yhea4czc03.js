import{f as de,r as i,j as t,a5 as v,a6 as Y,ae as fe}from"./n3epq09dut36rmi2.js";import{id as F,ie as me,fY as k,ig as w,gW as xe,ih as pe,ii as he,ij as ge,ik as z,il as ve,im as we,io as be,ip as ye,fB as je,aN as Te,iq as Re,ir as Se,is as D,it as $,iu as M,iv as Ae,fF as Ee,iw as K,eP as Pe,eM as Ne,eN as _e,eO as Ie,fE as Fe}from"./uox23aig6gp6se2y.js";import{u as De}from"./dnyjnsewv99rujtf.js";import{P as J}from"./e4sjbad9hyqt73xe.js";import{ah as Me,eJ as ke,aV as Q,as as Ce,c6 as Oe,c7 as Be,gG as Le,c as R,eF as We,u as He}from"./nqrmgk5te3uzwsyz.js";import{T as Ve}from"./dkr8jkx9n88ez7ho.js";function Ue({suggestionData:e,visualTreatment:n,composerController:r}){const o=de(),f=o.formatMessage(F.researchSuggestionInitial),h=i.useMemo(()=>[o.formatMessage(F.deepResearchPlaceholderBullet1),o.formatMessage(F.deepResearchPlaceholderBullet2),o.formatMessage(F.deepResearchPlaceholderBullet3)],[o]);return t.jsx(me,{composerController:r,visualTreatment:n,initialSuggestion:f,bulletPoints:h})}const H={type:"spring",stiffness:48.7,damping:13.54,mass:1};function dt({enabled:e,children:n,...r}){const o=k();return t.jsxs(v.div,{initial:{minHeight:0},animate:{minHeight:e?"142px":0},exit:{minHeight:0},transition:o?w:H,className:"flex flex-col justify-start",children:[n,e&&t.jsx(Ue,{...r})]})}const Z=.0025;function qe({composerController:e,composerType:n,renderInComposer:r,composerRightButtonType:o,layoutMode:a}){const f=i.useContext(Me),h=ke(f),b=Q(e.store,c=>c.controlsDisabled),A=xe(),{isUnauthenticated:S}=Ce(),l=n==="vanguard"&&A&&!S,y=pe(c=>{c.contentRect&&e.setWaveWidth(c.contentRect.width)}),m=i.useCallback(c=>{if(!(e instanceof J))return;const p=e.getSelectionStart();e.setControlsDisabled(!1),requestAnimationFrame(()=>{const{state:T,dispatch:O}=e.view;O(T.tr.insertText(c,p,p)),requestAnimationFrame(()=>{e.setSelection(p+c.length)}),e.usedDictation=!0,e.dictationEdited=!1})},[e]),x=()=>{e.setControlsDisabled(!0)},j=t.jsx(z,{size:"small",onExit:x,visualTreatment:n,buttonClassName:n==="vanguard"?"h-7 min-h-7 w-7 min-w-7":"h-9 min-h-9 w-9 min-w-9",invertColor:l,disableTooltip:l}),E=c=>{c.preventDefault(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{e.focus()})})};let g;if(l)if(o===he.SPEECH){const c=Oe.getBooleanCookie(Be.LastVoiceInteraction)??!1,p=T=>c?t.jsx(t.Fragment,{children:r?.(l,T)}):t.jsx(z,{...T,size:"small",onExit:x,buttonClassName:n==="vanguard"?"h-7 min-h-7 w-7 min-w-7":"h-9 min-h-9 w-9 min-w-9",invertColor:!0,disableTooltip:!0});g=t.jsx(ve,{layoutMode:a??"centered",onDictationExit:x,renderVoiceButton:p,restoreFocus:E})}else g=t.jsx(t.Fragment,{children:r?.()});else g=t.jsxs(t.Fragment,{children:[!h&&j,r?.()]});return{whisperControls:b?t.jsx(ge,{initialValue:Z,onSuccess:m,onWaveformDataUpdate:e.setWaveformData,onExit:()=>{e.setControlsDisabled(!1)},visualTreatment:n,buttonClassName:n==="vanguard"?"h-7 min-h-7 w-7 min-w-7":"h-9 min-h-9 w-9 min-w-9"}):g,waveContainerRef:y,handleTranscriptionSuccess:m}}const ze=({composerController:e,placeholder:n,vanguard:r,composerConfigMenuType:o="tools",disableAutoFocus:a=!1,textareaMaxHeightClassName:f="max-h-[25dvh]"})=>{const h=i.useRef(null),b=i.useRef(null),{isMobileOS:A}=we(),S=i.useRef(!1);return i.useEffect(()=>{if(S.current)return;if(!(e instanceof J))throw new Error(`Expected instance of ProseMirrorComposerController but got ${e.constructor.name}`);S.current=!0;const l=b.current;if(l!=null){const{value:y,selectionStart:m,selectionEnd:x}=l;e.view.dispatch(e.view.state.tr.insertText(y)),e.view.dispatch(e.view.state.tr.setSelection(Ve.create(e.view.state.doc,m+1,x+1))),l.style.display="none",l.value=""}h.current.appendChild(e.view.dom),e.view.dom.id=be,e.view.dom.dataset.virtualkeyboard="true",ye(e.view.dom),!je()&&!Le()&&!a&&requestAnimationFrame(()=>{e.view.focus()})},[e,a]),i.useEffect(()=>{e.setPlaceholder(n)},[n,e]),i.useEffect(()=>{e.logPageMount()},[]),t.jsxs("div",{ref:h,onKeyDown:Te.prefetch,className:R([Se["prosemirror-parent"],"text-token-text-primary",f,"max-h-52",o!=="none"&&"-mx-3 px-3","overflow-auto [scrollbar-width:thin]",We()?"firefox":"default-browser"],o!=="none"&&"vertical-scroll-fade-mask",r&&"min-h-12 pe-3"),children:[t.jsx("textarea",{className:R("text-token-text-primary placeholder:text-token-text-tertiary block h-10 w-full resize-none border-0 bg-transparent px-0 py-2 ring-0 placeholder:ps-px"),autoFocus:!A,placeholder:n,ref:b,"data-virtualkeyboard":!0}),t.jsx(Re,{scriptSrc:"window.__oai_logHTML?window.__oai_logHTML():window.__oai_SSR_HTML=window.__oai_SSR_HTML||Date.now();requestAnimationFrame((function(){window.__oai_logTTI?window.__oai_logTTI():window.__oai_SSR_TTI=window.__oai_SSR_TTI||Date.now()}))"})]})},X=48,G=32,Ke="/c/:conversationId",ft=({disableAutoFocus:e=!1,isBigBoxModeActive:n=!1,isTemporaryChat:r,placeholder:o,composerController:a,children:f,isExpandedByDefault:h=!1,visualTreatment:b,textareaMaxHeightClassName:A,onSubmit:S})=>{let l=null,y=null;const m=[],x=[];let j=null;const E=[];let g=null,C=null,c=null;i.Children.forEach(f,s=>{if(i.isValidElement(s))if(s.type===Je){if(j!=null)throw new Error("PromptTextareaComposer only accepts a single app stack");j=s}else if(s.type===Qe){if(l!=null)throw new Error("PromptTextareaComposer only accepts a single submit button");l=s}else if(s.type===nt){if(y!=null)throw new Error("PromptTextareaComposer only accepts a single header action");y=s}else s.type===et||s.type===Ze?m.push(s):s.type===tt?x.push(s):s.type===at?E.push(s):s.type===st?g=s:s.type===$e?C=s:s.type===Ye&&(c=s)});const p=i.useRef(null),T=i.useRef(null),{waveContainerRef:O}=qe({composerController:a,composerType:"vanguard"}),{controlsDisabled:ee,waveformData:V,waveWidth:te}=Q(a.store),d=D(s=>s.isExpanded),B=D(s=>s.setIsExpanded),U=i.useRef(!1),P=k(),q=i.useSyncExternalStore(s=>{const u=a.subscribe("focus",s),I=a.subscribe("blur",s);return()=>{I(),u()}},()=>a.isFocused(),()=>!1),se=s=>{if(s.target instanceof HTMLElement){if(s.target.dataset.historyItemLink||s.target.parentElement?.dataset.historyItemLink)return!0;const u=s.target?.closest("a[href]");if(u instanceof HTMLAnchorElement)return!!fe({path:Ke,end:!1},new URL(u.href).pathname)}return!1};i.useEffect(()=>a.subscribe("change",()=>{U.current=!a.isEmpty()}),[a]),i.useEffect(()=>{q&&!d&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{B(!0)})})},[q,d,B]);const N=D(s=>s.isVisuallyOverflowing),L=i.useRef(N);He(()=>{L.current=N},[N]);const W=D(s=>s.setIsVisuallyOverflowing),ne=i.useRef(null),ae=s=>{const u=I=>{h||U.current||s?.contains(I.target)||se(I)||B(!1)};return document.addEventListener("click",u),ne.current=s,()=>{document.removeEventListener("click",u)}},ie=s=>{s.preventDefault(),S(s)},_=m.length>0,oe=x.length>0,[re,le]=i.useState(0),ce=24,{showLegacyReasoningSlider:ue}=$();return t.jsxs("form",{ref:ae,className:"w-full [view-transition-name:var(--vt-composer)]",onSubmit:ie,"data-type":"unified-composer",children:[t.jsxs(Ge,{isTemporaryChat:r,children:[t.jsxs("div",{className:"relative flex w-full items-end px-3 py-3",children:[t.jsxs(v.div,{transition:P?w:M,className:"relative flex w-full flex-auto flex-col",children:[E.length>0&&t.jsx("div",{className:R("flex flex-col gap-2",b==="composer-btn"?"mb-2 has-data-fullbleed:-mt-1 has-data-fullbleed:w-[calc(100%+1rem)]":"mb-4"),children:E}),t.jsxs("div",{className:"relative ms-1.5 grid grid-cols-[auto_minmax(0,1fr)]",children:[t.jsx("div",{className:"items-top flex justify-center",children:t.jsx(v.div,{initial:{opacity:d?1:0},animate:{opacity:d?1:0},exit:{opacity:0},transition:P?w:Ae,children:y})}),t.jsx(v.div,{initial:{marginBottom:-20,translateX:d||!j?0:G},onPointerDown:s=>s.stopPropagation(),animate:{translateX:d||!j?0:G},style:{translateY:-7},transition:P?w:M,className:"relative flex-auto bg-transparent pt-0.5",children:t.jsxs(Xe,{composerController:a,enabled:n&&d,children:[t.jsx("div",{className:"flex min-h-12 items-start",ref:O,children:t.jsx("div",{className:"max-w-full min-w-0 flex-1",children:ee?V?t.jsx(Ee,{waveform:V,containerWidth:te,scaleFactor:10,initialValue:Z}):null:t.jsx(ze,{composerController:a,placeholder:o,disableAutoFocus:e,textareaMaxHeightClassName:A,vanguard:!0})})}),C]})})]}),t.jsx("div",{className:"justify-content-end relative ms-2 flex w-full flex-auto flex-col",children:t.jsx("div",{className:"flex-auto"})}),t.jsx(v.div,{initial:{height:d&&(_||l)?X:0},animate:{height:d&&(_||l)?X:0},transition:P?w:M})]}),(_||!!l)&&t.jsx("div",{className:R("bg-primary-surface-primary absolute start-3 end-0 bottom-3 z-2 flex items-center"),children:t.jsxs("div",{className:"w-full",children:[_&&d&&t.jsx("div",{"data-testid":"composer-footer-actions",className:R("flex items-center",b!=="composer-btn"&&"max-xs:gap-1 gap-2 overflow-x-auto [scrollbar-width:none]",!ue&&N&&"[--force-hide-label:none]"),ref:s=>K({debounce:!0,target:s,axis:"width",onChange:({width:u})=>{s&&(L.current?L.current&&p.current!==null&&u>=p.current&&W(!1):T.current!==null&&u<T.current?W(!0):(p.current=s.scrollWidth,W(s.scrollWidth>s.clientWidth)))}}),style:{marginRight:`${re+ce}px`},children:m}),t.jsxs("div",{className:"absolute end-3 bottom-0 flex items-center gap-2","data-testid":"composer-trailing-actions",ref:s=>K({target:s,axis:"width",onChange:({width:u})=>{le(u)}}),children:[oe&&t.jsx("div",{className:"relative ms-1",children:x}),l]})]})}),t.jsx("div",{className:"absolute start-4 top-3 ms-[1px] flex items-center pb-px",children:t.jsx(Y,{children:!d&&j})})]}),c]}),t.jsxs(Pe,{open:!!g,children:[t.jsx(Ne,{className:"w-full"}),t.jsx(_e,{children:t.jsx(Ie,{side:"bottom",align:"start",sideOffset:12,onOpenAutoFocus:s=>s.preventDefault(),children:g})})]})]})};function Xe({composerController:e,children:n,enabled:r}){const o=k();return t.jsx(v.div,{initial:!1,animate:{minHeight:r?"142px":0},exit:{minHeight:0},transition:o?w:M,className:"flex flex-col justify-start",onClick:a=>{e.isFocused()?a.preventDefault():e.focus()},children:n})}function Ge({children:e,isTemporaryChat:n}){const{configurationMenuType:r}=$(),o=r!=="none",a=De();return t.jsx(Fe,{onClick:f=>{!a.isFocused()&&!f.defaultPrevented&&a.focus()},className:R("flex w-full cursor-text flex-col items-center justify-center rounded-[28px] bg-clip-padding contain-inline-size","overflow-clip",o?"shadow-short":"border-token-border-default border shadow-sm sm:shadow-lg dark:shadow-none!",n?"dark bg-[#303030]":"bg-token-bg-primary dark:bg-[#303030]"),children:e})}const Ye=({children:e})=>{const n=k(),a={initial:{opacity:0,height:0,y:"-28px"},animate:{opacity:1,y:0,height:"56px",transition:n?w:{opacity:{delay:.2},default:H}},exit:{opacity:0,y:"-28px",height:0,transition:n?w:{opacity:{delay:0},default:H}}};return t.jsx(Y,{children:e&&t.jsx(v.div,{variants:a,initial:"initial",animate:"animate",exit:"exit",className:"relative w-full",children:e})})},$e=({children:e})=>t.jsx(t.Fragment,{children:e}),Je=({children:e})=>t.jsx(v.div,{onPointerDown:n=>{n.stopPropagation(),n.preventDefault()},children:e}),Qe=({children:e})=>t.jsx("div",{className:"ms-auto flex items-center gap-1.5",onPointerDown:n=>n.stopPropagation(),children:e}),Ze=({children:e})=>e?t.jsx(t.Fragment,{children:e}):null,et=({children:e})=>t.jsx("div",{onPointerDown:n=>n.stopPropagation(),children:e}),tt=({children:e})=>t.jsx("div",{onPointerDown:n=>n.stopPropagation(),children:e}),st=({children:e})=>t.jsx("div",{onPointerDown:n=>n.stopPropagation(),children:e}),nt=({children:e})=>t.jsx("div",{onPointerDown:n=>n.stopPropagation(),children:e}),at=({children:e,width:n="full"})=>t.jsx("div",{className:R(n==="fit"?"w-fit":"w-full"),onPointerDown:r=>r.stopPropagation(),children:e});export{Ze as B,ft as C,et as F,at as H,Z as I,ze as R,Qe as S,tt as T,dt as a,H as b,st as c,$e as d,Ue as e,qe as u};
//# sourceMappingURL=oshe56yhea4czc03.js.map
