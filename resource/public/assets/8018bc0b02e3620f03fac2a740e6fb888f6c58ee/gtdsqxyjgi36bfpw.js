import{m as j,B as y,eq as k}from"./nqrmgk5te3uzwsyz.js";import{f as P,d as v,a as C,D as _,r as c,u as M,j as e,M as i}from"./n3epq09dut36rmi2.js";import{dH as N,dI as q,ar as b}from"./uox23aig6gp6se2y.js";import{S as p}from"./k7u5jgad3qccdmw2.js";import{b as I}from"./izxna8u6mo9guqnq.js";import{M as R}from"./di1wth7zrf6rq4dj.js";import{g as S,W as T,b as E,w as W}from"./azqvry2z7sssyjfm.js";import{a as B}from"./kil09ef9w65kh1p8.js";import"./e3jbhlk6nvddhkdz.js";import"./h446s733avqwi4v2.js";import"./hk3emygtpn0flzgl.js";import"./nm5ivxaismwgb6gf.js";import"./dnyjnsewv99rujtf.js";import"./e4sjbad9hyqt73xe.js";import"./dkr8jkx9n88ez7ho.js";import"./nnldvg4yjd3ynnqu.js";import"./gfex7240qlmgxew5.js";import"./jsnptf63edu6k32a.js";import"./jit20xrzecwhc2dk.js";import"./hi5bz78ars1jrvhf.js";import"./kvhuqs0v8em60vy1.js";import"./iiunoc4k1n6g4a9l.js";import"./izzltcwrbklvvt51.js";import"./eirgecln9yzcy5p4.js";import"./k9dqus9crie9cyow.js";import"./b99rlgw1hhu0zh6m.js";import"./mgq4dy5xj5doeoq7.js";function F(){const a=P(),o=v(),n=C(),{taskId:s,turnId:r}=_(),[f,m]=c.useState(!1),x=c.useMemo(()=>S(s,r,n,{refetchInterval:t=>{const d=t.state?.data?.turn?.pull_request_status;switch(d){case null:case void 0:case"not_created":case"creating":return 2e3;case"failed":case"created":return!1;default:N(d)}}}),[s,r,n]),{data:u}=M(x),g=j(),h=async()=>{if(!(!s||!r))try{m(!0),await T.createPr(s,r,Q()),await n.invalidateQueries({queryKey:["wham","task"]})}catch(t){t instanceof E&&W(t,r,a,g)}finally{m(!1)}},l=u?.turn?.pull_request_data?.url;c.useEffect(()=>{l&&(window.location.href=l)},[l]);const w=u?.turn?.pull_request_status==="failed";return e.jsx(R,{children:e.jsx(I,{mobileHeaderRightContent:null,children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx(B,{className:"absolute start-0 end-0 top-0",children:e.jsx("div",{className:"flex w-full justify-end",children:e.jsx(q,{onClick:()=>{window.opener?(window.opener.focus(),window.close()):o(`/codex/tasks/${s}`)},icon:e.jsx(p,{}),label:a.formatMessage({id:"wham.task.pr.header.title",defaultMessage:"Back to task"})})})}),e.jsx("div",{className:"flex grow items-center justify-center p-4",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(b,{className:"mb-4 h-15 w-15"}),w?e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"text-token-text-error flex items-center gap-1",children:e.jsx(i,{id:"wham.task.pr.inProgress.error.description",defaultMessage:"Failed to create pull request. Please try again."})}),e.jsx(y,{color:"secondary",size:"small",icon:p,loading:f,onClick:t=>{t.preventDefault(),t.stopPropagation(),h()},children:e.jsx(i,{id:"wham.task.pr.inProgress.error.button",defaultMessage:"Retry"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"loading-shimmer-pure-text text-lg font-semibold",children:e.jsx(i,{id:"wham.task.pr.inProgress.title",defaultMessage:"Creating pull requestâ€¦"})}),e.jsx("p",{className:"text-token-text-secondary text-sm",children:e.jsx(i,{id:"wham.task.pr.inProgress.description",defaultMessage:"Pull request will automatically open once it has been created."})})]})]})})]})})})}function Q(){const o=new URLSearchParams(location.search).get("mode");if(o==="draft")return"draft";if(o==="auto_merge")return"auto_merge"}const de=()=>[{title:"Codex"}],pe=k(function(){return e.jsx(F,{})});export{pe as default,de as meta};
//# sourceMappingURL=gtdsqxyjgi36bfpw.js.map
