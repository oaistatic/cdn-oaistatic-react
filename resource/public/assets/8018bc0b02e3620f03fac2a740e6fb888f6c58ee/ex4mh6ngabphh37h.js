const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/m7lwf6btsri0ydn8.js","assets/nqrmgk5te3uzwsyz.js","assets/n3epq09dut36rmi2.js","assets/root-nu0t8wee.css","assets/uox23aig6gp6se2y.js","assets/conversation-small-cqkvcue6.css","assets/okmqe1qj6dv3h4kg.js","assets/jjyl0gfnyux1gir1.js","assets/er4xq69qu4sjw5id.js","assets/np05s3lkl6u1coe1.js","assets/nusgnk3mg4uy8u2z.js","assets/dss9cgi0qcblcwju.js","assets/gy64pge8qevmvg7e.js","assets/jr0ylqyi4w8to7tq.js","assets/7h5hwpux622xuq2c.js","assets/ejg7eu8fdglznsor.js","assets/fqir9qbv9yg84epv.js","assets/e255q8q718drrsgb.js","assets/fw37lmma5ljh7fs1.js"])))=>i.map(i=>d[i]);
import{j as e,r as l,M as B,g as nt,ap as Gn,an as Hn,ak as Fs,a5 as H,d as Vn,a6 as ve,f as Ae,a as at,R as zn,p as Wn}from"./n3epq09dut36rmi2.js";import{e as ot,fl as $n,kv as $e,eq as Yn,jr as Qn,ju as Kn,qF as Xn,w as rt,qG as Ps,qH as Jn,qI as Zn,qJ as ke,qK as ea,aS as it,qL as sa,i0 as ta,i1 as na,qf as fe,fw as lt,ki as aa,c0 as oa,kf as ct,qM as ra,qN as ia,S as la,qO as dt,fP as ca,fQ as da,fT as ua,fR as ma,qP as ga,a_ as ut,qd as mt,qQ as gt,eF as ha,et as Q,a9 as pa,qR as fa,aG as xa,qS as va,qT as ba,oz as ts,bI as ht,qU as ya,qV as Sa,nw as _a,qW as Ta,qX as ja,qY as Ca,qZ as Me,mD as ka,q_ as Ma,q$ as pt,bo as wa,dc as Ia,r0 as Ea,i8 as xe,by as ft,U as xt,bt as Na,aQ as vt,bu as Ra,aP as bt,r1 as Aa,r2 as Fa,jL as Pa,hS as La,nk as Da,r3 as Ua,bc as yt,bd as St,cW as _t,d as Ba,r4 as Oa,mQ as qa,c$ as Ga,z as Tt,e0 as Ha,r5 as Va,p9 as jt,e3 as za,hM as Wa,n7 as $a,Q as Ya,de as Ct,r6 as Qa,h$ as Ka,r7 as Xa,cY as Ja,r8 as Za,V as eo,r9 as so,ra as to,rb as no,nj as ao,jC as oo,c_ as ro,rc as io,rd as lo,re as co,n8 as uo,rf as mo,rg as go,nS as Ye,rh as ho,nT as Ee,ri as Qe,rj as po,rk as fo,rl as xo,cB as vo,jE as bo,no as yo,ng as So,rm as _o,rn as To,ro as jo,iq as Co,qc as ko,pe as Mo,rp as wo,rq as Io,rr as Eo,rs as No,rt as Ro,ru as Ao,rv as Fo,rw as Po,c1 as Lo,J as Do,pv as Uo,lM as Bo,lN as Oo}from"./uox23aig6gp6se2y.js";import{c as L,X as ue,_ as he,F as ne,aX as Ne,bL as F,cT as ns,ag as U,aa as Y,gN as kt,ec as qo,af as se,aY as de,cx as as,bc as ge,fX as Go,cn as Mt,aI as Ho,b as wt,d as It,B as Et,z as Ls,at as Ke,aj as O,c0 as K,ao as os,aJ as te,fr as Nt,ae as Re,ga as Vo,bQ as zo,di as Wo,dj as $o,aO as ee,bX as Yo,hf as Qo,g as rs,m as Rt,dI as Ko,dP as Xo,d$ as At,cM as Jo,bE as Ft,hg as Zo,v as Pt,W as er,dk as is,as as Lt,aL as Xe,dd as sr,eA as tr,fi as nr,s as qe,g9 as Ge,ce as ar,dh as or,cs as rr,f9 as ir,be as He,gT as lr,gU as cr,dX as dr,e6 as Ds,dY as ur,gH as mr,ah as gr,eJ as hr,dR as pr}from"./nqrmgk5te3uzwsyz.js";import"./gbfmb6n7vmtt0mld.js";import{M as fr,O as xr}from"./m142gq95svb5klgv.js";import{d as vr,b as Us}from"./he8nwqvd8i1qrsxh.js";import{a as br,G as yr}from"./jsnptf63edu6k32a.js";import{C as Je,F as Sr}from"./iwi9e9tak1je4ys9.js";import{b as Dt}from"./izzltcwrbklvvt51.js";import{d as Ut}from"./dnyjnsewv99rujtf.js";import{u as _r}from"./hi5bz78ars1jrvhf.js";import{a as Bt}from"./nm5ivxaismwgb6gf.js";const Tr="bg-token-main-surface-primary text-token-text-primary",jr="openai",Bs=["bg-blue-300 text-white"];function Cr(t){return Bs[(t?.charCodeAt(0)??0)%Bs.length]}const we=({children:t})=>e.jsx("div",{className:"pt-0",children:e.jsx("div",{className:L(l.isValidElement(t)&&t.type===$e?"gizmo-bot-avatar":"gizmo-shadow-stroke","flex h-8 w-8 items-center justify-center overflow-hidden rounded-full"),children:t})});function Ze(t){const{messages:n,isUserTurn:a,avatarClassName:s,gizmo:o}=t,r="medium",d=n[0]?.metadata?.shared_conversation_id,i=d!=null,g=ot(),{gizmoEditorData:u,mode:f}=$n();let h=e.jsx(we,{children:e.jsx($e,{className:s??Tr,iconName:jr,size:r})});return o?h=e.jsx(we,{children:e.jsx(br,{gizmoId:o.gizmo.id,className:"h-full w-full"})}):u!=null&&f==="test"&&(h=e.jsx(yr,{isFirstParty:!1,src:u.profilePictureUrl,className:"h-8 w-8 first:pt-[3px]"})),e.jsx("div",{className:void 0,children:a?i?e.jsx(we,{children:e.jsx($e,{className:Cr(d),iconName:"user",size:r})}):e.jsx(we,{children:e.jsx(Yn,{user:g,size:r})}):h})}const Os=ue(()=>he(()=>import("./m7lwf6btsri0ydn8.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(t=>t.MemoryActionResult));function qs(t,n,a){de(t,s=>{as.updateTree(s,o=>{o.updateNodeMetadata(n,{inlineComparisonRating:a})})})}const Gs=({messages:t})=>{for(const{metadata:n}of t){const{paragen_display_label:a}=n??{};if(a)return a;const{augmented_paragen_prompt_label:s}=n??{};if(s)return s}};function kr(t){const n=l.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),a=l.useRef({left:null,right:null});return t.variantIds.length<2?e.jsx(Ot,{setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:n,firstVisibleTokenTimestampsRef:a,...t}):e.jsx(Mr,{...t,visibilityStateRef:n,firstVisibleTokenTimestampsRef:a})}function Mr(t){const{clientThreadId:n,variantIds:a,turnIndex:s,firstVisibleTokenTimestampsRef:o}=t;if(a.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const r=ls(),c=kt(),d=qo(),[i,g]=a,u=l.useMemo(()=>rt(i+g)()>=.5,[i,g]),[f,h]=u?[g,i]:[i,g],[b,m,T]=se(n,x=>{const E=Ls(x).tree.getLeafFromNode(f).id,_=Ls(x).tree.getLeafFromNode(h).id,C=U.getConversationTurns(x,E),S=U.getConversationTurns(x,_),A=s<C.length?C[s]:null,w=s<S.length?S[s]:null;return A||Ke.addError(`Paragen Left turn index ${s} out of bounds`,{turnIndex:s,turnCount:C.length,lastTurnRole:F(C)?.role,lastMessageAuthor:F(F(C)?.messages)?.author,lastMessageContentType:F(F(C)?.messages)?.content.content_type,lastMessageMetadata:F(F(C)?.messages)?.metadata,altTurnCount:S.length,altLastTurnRole:F(S)?.role,altLastMessageRole:F(F(S)?.messages)?.author.role}),w||Ke.addError(`Paragen Right turn index ${s} out of bounds`,{turnIndex:s,turnCount:S.length,lastTurnRole:F(S)?.role,lastMessageAuthor:F(F(S)?.messages)?.author,lastMessageContentType:F(F(S)?.messages)?.content.content_type,lastMessageMetadata:F(F(S)?.messages)?.metadata,altTurnCount:C.length,altLastTurnRole:F(C)?.role,altLastMessageRole:F(F(C)?.messages)?.author.role}),[E,A,w]}),[k,M]=u?[T,m]:[m,T],N=r?"skippable_parallel_2_in_stream:a:2.0":"skippable_parallel_2_in_stream:a:1.5";l.useEffect(()=>(Ps.setState({displayingSideBySideFeedback:!0}),()=>{Ps.setState({displayingSideBySideFeedback:!1})}),[]);const P=l.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),v=l.useCallback((x,{shouldSubmitParagenFeedback:E=!0}={})=>{if(!m||!T||!k||!M)throw new Error("Expected both turns to exist");de(n,I=>{as.setCurrentBranch(I,x)});const _=x===f,C=x===i;k.messages.length>0&&qs(n,k.messages[k.messages.length-1].id,C?"original":"new"),M.messages.length>0&&qs(n,M.messages[M.messages.length-1].id,C?"original":"new");const S=ge(n),A=[m,T].map((I,D)=>({messageId:I.messages[I.messages.length-1].id,loadFirstTokenTime:D===0?o.current.left:o.current.right,loadEndTime:F(I.messages)?.clientMetadata?.completionSampleFinishTime})),w=_?A[0].messageId:A[1].messageId,p=U.getParentPromptNode(Ne(n),b);if(!p)throw new Error("Expected prompt for side by side feedback");const j={},R=p.message.clientMetadata?.variantsInStreamInfo==null&&p.message.metadata?.paragen_variants_info!=null;for(const I of A)j[I.messageId]=R?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:I.loadFirstTokenTime,load_end_time:I.loadEndTime};E&&Ys({params:{conversation_id:S,displayed_message_ids:A.map(I=>I.messageId),message_metadatas:j,rating:"selected",selected_message_id:w,source_timestamp:Date.now(),ui_variant:r?2:1,user_prompt_message_id:p.message.id}})},[n,f,i,k,M,m,T,b,o,t.conversationTurnMountTime,r]);return l.useEffect(()=>Go(Mt,{requestCompletion:x=>{const E=ge(n),_=U.getParentPromptNode(Ne(n),b);if(!_)throw new Error("Expected prompt for side by side feedback");if(!m||!T)throw new Error("Expected both turns to exist");const C=[m,T].map((p,j)=>({messageId:p.messages[p.messages.length-1].id,loadFirstTokenTime:j===0?o.current.left:o.current.right,loadEndTime:F(p.messages)?.clientMetadata?.completionSampleFinishTime})),S={},A=_.message.clientMetadata?.variantsInStreamInfo==null&&_.message.metadata?.paragen_variants_info!=null;for(const p of C)S[p.messageId]=A?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:p.loadFirstTokenTime,load_end_time:p.loadEndTime};const w=x.isForSkippingParagen;Ys({params:{conversation_id:E,displayed_message_ids:C.map(p=>p.messageId),message_metadatas:S,rating:w?"explicit_skipped":"skipped",selected_message_id:null,source_timestamp:Date.now(),ui_variant:w?3:r?2:1,user_prompt_message_id:_.message.id}}),w&&v(f,{shouldSubmitParagenFeedback:!1})}}),[m,T,b,n,t.conversationTurnMountTime,N,k?.messages,M?.messages,d,r,o,v,f]),e.jsx(Ot,{...t,setPreferredFeedback:v,leftVariantId:f,rightVariantId:h,leftTurn:m,rightTurn:T,hasActiveRequest:c,originalTurn:k,visibilityStateRef:P})}function Ot({setPreferredFeedback:t,leftVariantId:n,rightVariantId:a,leftTurn:s,rightTurn:o,hasActiveRequest:r,originalTurn:c,visibilityStateRef:d,...i}){const g=(s&&Gs(s))??null,u=(o&&Gs(o))??null,f=l.useMemo(()=>s?.messages??[],[s?.messages]),h=l.useMemo(()=>o?.messages??[],[o?.messages]),{avatarClassName:b,firstVisibleTokenTimestampsRef:m}=i,T=l.useMemo(()=>s?.messageGroups??[],[s?.messageGroups]),k=l.useMemo(()=>o?.messageGroups??[],[o?.messageGroups]),M=Qn(),N=Ne(i.clientThreadId),P=F(s?.messages),v=F(o?.messages),x=ns(U.getRequestId(N,P?.id??v?.id)),E=x&&!P?.end_turn,_=x&&!v?.end_turn,C=s?.role===Y.User,S=o?.role===Y.User,A=l.useRef(null),w=l.useRef(null),p=l.useRef(null),j=s!=null,R=o!=null;!j&&m.current.left==null&&(m.current.left=Date.now()),!R&&m.current.right==null&&(m.current.right=Date.now()),l.useEffect(()=>{if(A.current&&w.current&&p.current){const oe=Array(11).fill(0).map((me,X)=>X/10),q=new IntersectionObserver(me=>me.forEach(X=>{X.target===w.current?(d.current.left_visibility_initial==null&&(d.current.left_visibility_initial=X.intersectionRatio),d.current.left_visibility_max=Math.max(d.current.left_visibility_max??0,X.intersectionRatio)):X.target===p.current&&(d.current.right_visibility_initial==null&&(d.current.right_visibility_initial=X.intersectionRatio),d.current.right_visibility_max=Math.max(d.current.right_visibility_max??0,X.intersectionRatio))}),{root:A.current,threshold:oe});return q.observe(w.current),q.observe(p.current),()=>q.disconnect()}},[d]);const{data:I}=Kn(void 0,!1,M),D=ls(),ae=e.jsx("div",{className:"text-token-text-secondary px-(--thread-content-margin) pt-1 pb-5 text-center text-sm text-pretty",children:e.jsx(B,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})});return e.jsxs("div",{className:"relative flex flex-col",children:[e.jsxs("div",{className:L("bg-token-main-surface-primary sticky top-[-1px] z-1 px-(--thread-content-margin) text-center text-lg text-pretty",D?"md:top-header-height":"md:static"),"data-testid":"paragen-feedback-title",children:[e.jsx(B,{id:"KKeSJV",defaultMessage:"You're giving feedback on a new version of ChatGPT."}),D?ae:null]}),D?null:ae,e.jsx("div",{className:L(Xn,"horzScrollShadows relative -mb-2 snap-x snap-mandatory overflow-x-auto overflow-y-clip pb-4"),ref:A,children:e.jsxs("div",{className:L("mx-auto box-content max-w-[calc(2*var(--thread-content-max-width))] min-w-min px-(--thread-content-margin)","flex items-start",D&&"divide-token-border-medium dark:divide-token-border-heavy divide-x",!D&&"gap-4 sm:gap-6"),children:[e.jsxs(Hs,{horizontalScrollContainerRef:A,rootElementRef:w,onClick:()=>{t(n)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:j,children:[e.jsxs(Ws,{children:[e.jsx(Ze,{messages:f,isUserTurn:C,avatarClassName:b}),e.jsx(zs,{children:e.jsx(B,{...Qs.responseNumber,values:{responseIndex:1,display_label:g}})})]}),D&&j?e.jsx(Vs,{}):e.jsxs(e.Fragment,{children:[I!=null&&!C&&e.jsx(Os,{clientThreadId:i.clientThreadId,messages:f,isParagen:!0}),e.jsx(Je,{...i,allMessages:f,groupedMessagesToRender:T,allGroupedMessages:T,isUserTurn:C,isFinalUserTurn:!1,isCompletionRequestInProgress:E,hasActiveRequest:r,shouldGrowContainer:!1,isParagen:!0}),e.jsx($s,{clientThreadId:i.clientThreadId,conversationTurnMountTime:i.conversationTurnMountTime,turn:s,originalTurn:c})]})]}),e.jsxs(Hs,{horizontalScrollContainerRef:A,rootElementRef:p,onClick:()=>{t(a)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:R,children:[e.jsxs(Ws,{children:[e.jsx(Ze,{messages:h,isUserTurn:S,avatarClassName:b}),e.jsx(zs,{children:e.jsx(B,{...Qs.responseNumber,values:{responseIndex:2,display_label:u}})})]}),D&&R?e.jsx(Vs,{}):e.jsxs(e.Fragment,{children:[I!=null&&!S&&e.jsx(Os,{clientThreadId:i.clientThreadId,messages:h,isParagen:!0}),e.jsx(Je,{...i,allMessages:h,groupedMessagesToRender:k,allGroupedMessages:k,isFinalUserTurn:!1,isUserTurn:S,isCompletionRequestInProgress:_,hasActiveRequest:r,shouldGrowContainer:!1,isParagen:!0}),e.jsx($s,{clientThreadId:i.clientThreadId,conversationTurnMountTime:i.conversationTurnMountTime,turn:o,originalTurn:c})]})]})]})})]})}function Hs({horizontalScrollContainerRef:t,rootElementRef:n,onClick:a,children:s,hasActiveRequest:o,isWaitingOnFirstUserVisibleToken:r}){const c=ls(),{scrollX:d}=Gn({layoutEffect:!1,container:t,target:n}),i=Jn(),g=Zn(),u=l.useRef(null),f=l.useRef(null),h=l.useRef(null),[b,m]=l.useState(!1),[T,k]=l.useState(!1),[M,N]=l.useState(!1),[P,v]=l.useState(0);l.useEffect(()=>{if(!c)return;const w=new IntersectionObserver(p=>{for(const j of p)j.target===u.current?m(j.isIntersecting):j.target===h.current?N(j.isIntersecting):j.target===f.current&&k(j.isIntersecting)},{root:i?.current});return u.current&&f.current&&h.current&&(w.observe(u.current),w.observe(f.current),w.observe(h.current)),()=>{w.disconnect()}},[P,c,i]);const x=!M&&(T||b),E=Hn(d,w=>x?-1*w:0),_=Fs(0);l.useEffect(()=>{if(!c)return;const w=new ResizeObserver(p=>{ke(p.length===1,"entryList.length === 1");const j=p[0];ke(j.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),_.set(j.contentBoxSize[0].inlineSize)});return n.current&&w.observe(n.current),()=>{w.disconnect()}},[c,_,n]);const C=Fs(0);l.useEffect(()=>{if(!c)return;const w=new ResizeObserver(p=>{ke(p.length===1,"entryList.length === 1");const j=p[0];ke(j.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),C.set(j.contentBoxSize[0].blockSize+16),v(j.contentBoxSize[0].blockSize)});return g.current&&w.observe(g.current),()=>{w.disconnect()}},[c,C,g]);const S=e.jsx(Et,{className:c?"px-5":"mt-4 self-start",onClick:a,"data-testid":"paragen-prefer-response-button",children:e.jsx(B,{id:"U2EAH6",defaultMessage:"I prefer this response"})}),A=r;return e.jsx("div",{"data-paragen-root":!0,className:L("@container relative flex min-w-[min(450px,80cqw,80vw)] flex-1 snap-center flex-col gap-1 text-start",c?"min-h-60":"border-token-border-tertiary rounded-xl border shadow-lg shadow-black/3"),ref:n,children:e.jsxs("div",{className:L(ea,"px-(--thread-content-margin) py-4"),children:[e.jsx("div",{className:L("absolute top-48 right-0! left-0! h-px","invisible"),ref:u}),e.jsx("div",{className:L("absolute top-48 right-0! bottom-0 left-0!","invisible"),ref:f}),e.jsx("div",{className:L("absolute right-0! bottom-0 left-0! h-px","invisible"),ref:h}),s,c?e.jsx("div",{className:"flex-1"}):null,c?e.jsx("div",{className:"mt-4 min-h-10",children:A?null:e.jsx(H.div,{style:{translateX:E,width:_,bottom:C},animate:{opacity:100},initial:{opacity:0},transition:{ease:"easeOut",duration:.2,delay:.5},className:L({fixed:x,"z-20 flex w-full justify-center":!0}),children:S})}):o?null:S]})})}function Vs(){return e.jsxs("div",{className:"flex w-full flex-col gap-4 pt-3 pb-5",children:[e.jsx(ce,{className:"h-4 w-[75%]"}),e.jsx(ce,{className:"h-4 w-[50%]"}),e.jsx(ce,{className:"h-4 w-[80%]"}),e.jsx(ce,{className:"h-4 w-[55%]"}),e.jsx(ce,{className:"h-4 w-[66%]"}),e.jsx(ce,{className:"h-4 w-[64%]"}),e.jsx(ce,{className:"h-4 w-[48%]"})]})}function ls(){const{layer:t}=Ho("3119715334");return t.get("should-enable-hojicha",!1)}const zs=ne.div`text-sm text-token-text-secondary font-semibold`,Ws=ne.div`flex gap-4 items-center mb-1`,ce=ne.div`animate-pulse rounded-[4px] bg-token-main-surface-tertiary`;function $s({clientThreadId:t,conversationTurnMountTime:n,turn:a,originalTurn:s}){const o=it();if(!o.showParagenMetadata||!o.showDebugConversationTurns&&!o.forceParagen||a==null)return null;let r=a===s?"ORIGINAL":"NEW";const c=a.messages[a.messages.length-1],d=c?.metadata?.__internal,i=c?.metadata?.paragen_display_label;if(d){const{model_id:f,model_definition_slug:h,model_definition_virtual_model_id:b,alternative_model_selection_rule:m,augmented_paragen_prompt_group_id:T,augmented_paragen_prompt_id:k,augmented_paragen_prompt:M}=d;f&&(r+=`
Model ID: ${f}`),h&&(r+=`
Model Slug: ${h}`),b&&(r+=`
Virtual Model ID: ${b}`),m&&(r+=`
Alternative Model Rule: ${m}`),T&&(r+=`
Prompt Group ID: ${T}`),k&&(r+=`
Prompt ID: ${k}`),M&&(r+=`
Prompt: ${M}`),i&&(r+=`
Display Label: ${i}`)}r+=`
Message ID: ${c.id}`;const g=U.getParentPromptNode(Ne(t),a.messages[0].id);if(!g)throw new Error("Expected prompt for side by side feedback");const u=g.message.clientMetadata?.variantsInStreamInfo==null&&g.message.metadata?.paragen_variants_info!=null;return r+=`
User prompt message ID: ${g.message.id}`,r+=`
Is Persisted Paragen? ${u}`,r+=`
Completion Sample Finish Time: ${u?`${n} (persisted)`:F(a.messages)?.clientMetadata?.completionSampleFinishTime}`,e.jsx("div",{className:"text-sm whitespace-pre-wrap text-red-500",children:r})}async function Ys({params:t}){await wt.safePost("/paragen_submission",{requestBody:t,authOption:It.SendIfAvailable})}const Qs=nt({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}{display_label}"}});function wr({handleShowRetrievalResults:t,clientThreadId:n,turnIndex:a,responseComplete:s=!1}){const[o,r]=se(n,u=>[U.getTurnContentReferences(u,a),U.getConversationTurnAtIndex(u,a).messages]),c=l.useMemo(()=>({turnIndex:a,clientThreadId:n,responseComplete:s}),[n,s,a]),d=l.useRef(!1);l.useEffect(()=>{d.current||(d.current=!0,O.logEvent("File Sources Footer Shown",c))},[c]);const i=l.useCallback(()=>{O.logEvent("File Sources Footer Clicked",c),t()},[t,c]),g=l.useMemo(()=>{const u=new Set,f=[];function h(m){!m||u.has(m)||(u.add(m),f.push(m))}if(o.forEach(m=>{m.type==="file"?h(m.cloud_doc_url??m.extra?.cloud_doc_url):m.type==="file_navlist"&&m.items.forEach(T=>{h(T.cloud_doc_url)})}),s){for(const m of r)if(sa(m)){const T=ta(m.content.result),k=m.metadata?.cloud_doc_urls??[],M=T.chunks;for(let N=0;N<M.length;N++){const P=M[N];if(!P.documentId)continue;if(N<k.length){h(k[N]);continue}const v=P.documentId.endsWith("--google")?P.documentId.split("--")[1]:void 0,x=P.metadata.cloud_doc_url??(v?`https://drive.google.com/file/d/${v}`:void 0);h(x?.toString())}break}}const b=[];for(let m=0;m<f.length;m++){const T=f[m],k=na(T);if(k&&b.push(k.Icon),b.length>=3)break}return b},[r,o,s]);return e.jsxs(e.Fragment,{children:[e.jsx(H.div,{className:"absolute h-[60px]",initial:{opacity:0},animate:{opacity:1},children:e.jsxs("button",{className:L("not-prose group/footnote border-token-border-default bg-token-main-surface-primary hover:bg-token-main-surface-secondary mt-3 mb-2 flex w-fit items-center gap-1.5 rounded-xl border py-2","ps-3 pe-2.5"),onClick:i,children:[g.length>0&&e.jsx("div",{className:"flex flex-row-reverse gap-1",children:g.reverse().map((u,f)=>e.jsx(H.div,{className:L("border-token-main-surface-primary bg-token-main-surface-primary flex items-center overflow-hidden","group-hover/footnote:border-token-main-surface-secondary","relative"),initial:{opacity:0},animate:{opacity:1},children:e.jsx(u,{className:"icon-sm"})},f))}),e.jsx("div",{className:"text-token-text-secondary flex items-center gap-0.5 text-xs font-semibold",children:e.jsx(B,{id:"/48IOP",defaultMessage:"Sources"})})]})}),e.jsx("div",{className:"h-[60px]"})]})}function qt({followups:t,analyticsMetadata:n,isV2Enabled:a=!1}){const[s,o]=l.useState(-1),r=l.useRef(!1),c=Ut();return l.useEffect(()=>{r.current||(r.current=!0,t.forEach((d,i)=>{O.logEventWithStatsig("chatgpt_message_followup_action","chatgpt_message_followup_action",{...K(n),action:"show",position:(i+1).toString(),followup_text:fe(d)})}))},[t,n]),e.jsx(H.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex w-full flex-col",children:t.slice(0,4).map((d,i)=>e.jsxs(H.div,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:i*.03},exit:{opacity:0,translateY:4},onMouseEnter:()=>o(i),onMouseLeave:()=>o(-1),children:[i>0&&!a&&e.jsx(Gt,{$isSelected:s===i||s===i-1}),e.jsx(Ir,{followUp:d,onSelectingSuggestedReply:c,analyticsMetadata:n,position:i,isV2Enabled:a})]},i))})}const Gt=ne.div`
  h-[1px] opacity-45
  ${({$isSelected:t})=>t?"mx-2 bg-token-main-surface-secondary":"bg-token-border-default"}
`;function Ir({followUp:t,onSelectingSuggestedReply:n,analyticsMetadata:a,position:s,isV2Enabled:o}){return e.jsxs(H.button,{whileHover:"hover",className:L("bg-token-main-surface-primary hover:bg-token-main-surface-secondary flex w-full cursor-pointer items-start justify-start gap-2 rounded-lg py-3 text-start",o?"px-0":"px-2"),onClick:r=>{n(r,t,[],0),O.logEventWithStatsig("chatgpt_message_followup_action","chatgpt_message_followup_action",{...K(a),action:"click",position:(s+1).toString(),followup_text:fe(t)})},onMouseEnter:()=>{O.logEventWithStatsig("chatgpt_message_followup_action","chatgpt_message_followup_action",{...K(a),action:"hover",position:(s+1).toString(),followup_text:fe(t)})},children:[e.jsx(H.div,{className:"flex items-center justify-center pt-0.25 opacity-70",variants:{hover:{x:4}},initial:{x:0},transition:{duration:.1},children:e.jsx(lt,{className:"text-token-text-secondary h-[20px] w-[20px]"})}),e.jsx("div",{className:"text-token-text-secondary pe-2 text-start text-sm",children:fe(t)})]})}const Er=()=>e.jsx(Dt,{size:"lg",lines:3,width:35,widthVariance:10,className:"w-full"}),Nr=t=>({[te.Search]:"Web Search",[te.Research]:"Research",[te.PictureV2]:"Draw Image",[te.Think]:"Think Harder"})[t]??"Title",es=(t,n,a,s,o)=>{O.logEventWithStatsig("Capabilities Suggestion Action","chatgpt_capabilities_suggestion_action",{...K(a),categoryId:n.categoryId,suggestionId:n.id,position:s,action:t,numSuggestions:String(o)})},Rr=(t,n)=>{const a=l.useRef(!1);l.useEffect(()=>{a.current||(a.current=!0,t.forEach((s,o)=>{es("show",s,n,o+1,t.length)}))},[t,n])},Ht=({clientThreadId:t,suggestions:n,analyticsMetadata:a,style:s="default"})=>{const o=Ut();return Rr(n,a),e.jsx(e.Fragment,{children:n.map((r,c)=>e.jsxs(H.div,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},exit:{opacity:0,translateY:4},transition:{delay:c*.03},className:L("w-full flex-1",s==="compact"&&"flex-col"),children:[s==="compact"&&c>0&&e.jsx(Gt,{$isSelected:!1}),e.jsx(Ar,{clientThreadId:t,suggestion:r,onSelectingSuggestedReply:o,position:c+1,numSuggestions:n.length,analyticsMetadata:a,style:s})]},r.prompt))})},Ar=({clientThreadId:t,suggestion:n,onSelectingSuggestedReply:a,analyticsMetadata:s,position:o,numSuggestions:r,style:c="default"})=>{const{setThreadSystemHintMode:d}=aa(),i=os(),g=Vn();return e.jsx(H.button,{onClick:u=>{if(es("click",n,s,o,r),n.categoryId===te.Research)if(i?.isFree()){oa(g,"Suggested Capabilities Upsell");return}else d(n.categoryId,!0,s);a(u,n,[],0)},onMouseEnter:()=>{es("hover",n,s,o,r)},className:L("hover:bg-token-main-surface-secondary flex w-full flex-1 items-start rounded-xl text-start transition-colors duration-300 ease-in-out",c==="default"&&"gap-4 p-2"),children:c==="compact"?e.jsx(Fr,{clientThreadId:t,suggestion:n}):e.jsx(Pr,{clientThreadId:t,suggestion:n})})},Fr=({suggestion:t,clientThreadId:n})=>{const{categoryId:a}=t,{systemHints:s}=ct(n),o=s.find(r=>r.systemHint===a);return e.jsxs("div",{className:"bg-primary hover:bg-tertiary group flex w-full cursor-pointer items-center justify-start gap-2 rounded-lg px-2 py-3 text-start transition-colors duration-300 ease-in-out",children:[e.jsx("div",{className:"flex items-center justify-center opacity-70 transition-all duration-100 ease-in-out group-hover:scale-[1.02] group-hover:rotate-[-5deg] group-hover:opacity-100",children:a==="ask"?e.jsx(lt,{className:"text-token-text-secondary group-hover:text-token-text-primary h-[18px] w-[18px]"}):e.jsx(Nt,{svgString:o?.logo??"",className:"text-token-text-secondary icon-md group-hover:text-token-interactive-label-accent-default h-[18px] w-[18px]"})}),e.jsx("div",{className:"text-token-text-secondary group-hover:text-token-text-primary flex items-center pe-2 text-start text-sm",children:fe(t)})]})},Pr=({clientThreadId:t,suggestion:n})=>{const{categoryId:a,imageUrl:s,description:o,title:r,ctaLabel:c,prompt:d}=n,{systemHints:i}=ct(t),g=i.find(u=>u.systemHint===a);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-token-border-default bg-primary relative h-16 w-14 flex-shrink-0 rounded-lg border drop-shadow-xs transition-all duration-100 ease-in-out group-hover:scale-[1.02] group-hover:rotate-[-2deg]",children:[a===te.PictureV2?e.jsx("div",{className:"flex h-full w-full items-center justify-center rounded-lg bg-cover",style:{backgroundImage:`url(${s})`},children:e.jsx(ra,{className:"icon-xl mb-2 text-white"})}):e.jsxs("div",{className:"flex flex-col gap-1.5 p-2",children:[e.jsx("div",{className:"text-token-text-primary text-[5px] leading-tight font-semibold tracking-tighter",children:r??Nr(a)}),e.jsx("div",{className:"flex flex-col gap-0.5",children:Array.from({length:10}).map((u,f)=>e.jsx("div",{className:"bg-token-border-heavy h-[1px] w-full rounded-full"},f))})]}),e.jsx("div",{className:"absolute -end-2 -bottom-2",children:e.jsx(ia,{isBadge:!0,className:"opacity-100",logo:e.jsx(Nt,{svgString:g?.logo??"",className:"icon-md"})})})]}),e.jsxs("div",{className:"flex flex-col gap-2 text-sm",children:[e.jsx("div",{className:"text-token-text-primary flex-grow",children:o??d}),c&&e.jsxs("div",{className:"text-token-text-secondary flex items-center font-medium",children:[c,e.jsx(H.div,{variants:{hover:{x:2}},initial:{x:0},transition:{duration:.1},children:e.jsx(la,{})})]})]})]})},ss=(t,n,a,s)=>{O.logEventWithStatsig("Capabilities Tab Action","chatgpt_capabilities_tab_action",{...K(a),tabId:n,position:s,action:t})},Lr=(t,n)=>{const a=l.useRef(!1);l.useEffect(()=>{a.current||(a.current=!0,t.forEach((s,o)=>{ss("show",s.value,n,o+1)}))},[t,n])},Dr=({clientThreadId:t,categorySuggestions:n,lastMessageId:a,analyticsMetadata:s,style:o="default"})=>{const r=n.map(({category_id:i,title:g,suggestions:u})=>({value:i,message:g,suggestions:u?.map(dt)??[]})),[c,d]=l.useState(r[0].value);return Lr(r,s),e.jsxs(ca,{value:c,onValueChange:d,orientation:"horizontal",className:"flex w-full flex-col",children:[e.jsx(da,{className:"border-token-border-default relative flex w-full flex-row gap-6 border-b",children:r.map((i,g)=>e.jsx(Br,{value:i.value,message:i.message,isActive:c===i.value,analyticsMetadata:s,position:g+1},i.value))}),r.map(i=>e.jsx(ua,{value:i.value,children:e.jsx(Ur,{initialSuggestions:i.suggestions,clientThreadId:t,categoryId:i.value,isActive:c===i.value,lastMessageId:a,analyticsMetadata:s,style:o})},i.value))]})},Ur=({initialSuggestions:t,clientThreadId:n,categoryId:a,isActive:s,lastMessageId:o,analyticsMetadata:r,style:c="default"})=>{const d=ge(n),i=s&&t.length===0,{suggestions:g,isLoading:u}=ga({categoryId:a,shouldFetch:i,serverThreadId:d,lastMessageId:o}),f=i?g:t;return a==="ask"?u?e.jsx(Er,{}):e.jsx(qt,{followups:f.map(h=>({type:ut.Reply,text:h.prompt})),analyticsMetadata:r}):e.jsx("div",{className:"flex w-full flex-col gap-y-4 py-3 md:flex-row md:gap-x-4",children:u?e.jsxs(e.Fragment,{children:[e.jsx(Ks,{}),e.jsx(Ks,{})]}):e.jsx(Ht,{clientThreadId:n,suggestions:f,analyticsMetadata:r,style:c})})},Br=({value:t,message:n,isActive:a,analyticsMetadata:s,position:o})=>e.jsxs(ma,{className:"text-token-text-tertiary hover:text-token-text-secondary radix-state-active:text-token-text-primary relative flex min-w-10 justify-center py-4 text-sm font-medium",value:t,onClick:()=>{ss("click",t,s,o)},onMouseEnter:()=>{ss("hover",t,s,o)},children:[e.jsx("div",{className:"truncate",children:n}),e.jsx(ve,{children:a&&e.jsx(H.div,{layoutId:"tab-underline",className:"bg-token-text-primary absolute start-0 end-0 bottom-0 h-0.5",transition:{type:"spring",stiffness:500,damping:30}})})]}),Ks=()=>e.jsxs("div",{className:"flex flex-1 items-center gap-4 rounded-xl p-2",children:[e.jsx("div",{className:"bg-token-sidebar-surface-secondary dark:bg-token-border-default h-16 w-14 flex-shrink-0 rounded-lg"}),e.jsx("div",{className:"w-full flex-grow",children:e.jsx(Dt,{lines:3,size:"sm"})})]}),Or=({clientThreadId:t,categorySuggestions:n,lastMessageId:a,analyticsMetadata:s})=>{if(!n||n.length===0)return null;const o=n.length===1,r=n[0],c=r.suggestions.length>0?r.suggestions:void 0;return o&&c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-1 text-sm font-semibold",children:e.jsx(B,{id:"3UFIQc",defaultMessage:"Follow up"})}),e.jsx(Ht,{clientThreadId:t,suggestions:c.map(dt),analyticsMetadata:s,style:r.style})]}):e.jsx(Dr,{clientThreadId:t,categorySuggestions:n??[],lastMessageId:a,analyticsMetadata:s})};function qr({clientThreadId:t,followups:n,categorySuggestions:a,lastMessageId:s,analyticsMetadata:o}){const[r,c]=l.useState(null),d=mt.useIsEnabled(t),{capabilitySuggestionsEnabled:i}=gt(),g=a&&a.length>0;return e.jsxs(e.Fragment,{children:[e.jsx(Vr,{visible:r==="conversation"}),e.jsx(zr,{visible:r==="global"}),d&&(i?g&&e.jsx(Or,{clientThreadId:t,lastMessageId:s,categorySuggestions:a,analyticsMetadata:o}):n.length>0&&e.jsx(Gr,{clientThreadId:t,followups:n,analyticsMetadata:o,setDisableMessage:c}))]})}function Gr({clientThreadId:t,followups:n,setDisableMessage:a,analyticsMetadata:s}){const{value:o}=Re("2281969373"),{value:r}=Re("2076592918");return e.jsxs("div",{className:"group",children:[r?e.jsx("hr",{className:"bg-token-bg-tertiary mt-5 mb-5 opacity-70"}):e.jsxs("div",{className:"mb-1 flex items-center text-sm font-semibold",children:[e.jsx(B,{id:"3UFIQc",defaultMessage:"Follow up"}),!o&&e.jsx(Hr,{clientThreadId:t,setDisableMessage:a,analyticsMetadata:s})]}),e.jsx(qt,{followups:n,analyticsMetadata:s,isV2Enabled:r})]})}function Hr({clientThreadId:t,setDisableMessage:n,analyticsMetadata:a}){const s=mt.useStore(),[o,r]=l.useState(!1);return e.jsxs(ha,{size:"small",onOpenChange:c=>r(c),contentClassName:"min-w-[200px]",triggerButton:e.jsx("button",{className:"text-token-text-tertiary hover:bg-token-main-surface-tertiary ms-2 flex h-6 w-6 items-center justify-center rounded-md focus:ring-0 focus:outline-hidden",children:e.jsx(pa,{className:L("h-4 w-4 opacity-0 group-hover:opacity-100",o&&"opacity-100")})}),children:[e.jsx(Q.Item,{onClick:()=>{s.setDisabledConversation(t,!0),n("conversation"),setTimeout(()=>n(null),3e3),O.logEventWithStatsig("chatgpt_message_followup_setting","chatgpt_message_followup_setting",{...K(a),action:"disable_conversation"})},className:"text-token-text-primary",children:e.jsx(B,{id:"GZYofd",defaultMessage:"Hide for this chat"})}),e.jsx(Q.Item,{onClick:()=>{s.setDisabledGlobally(!0),n("global"),setTimeout(()=>n(null),5e3),O.logEventWithStatsig("chatgpt_message_followup_setting","chatgpt_message_followup_setting",{...K(a),action:"disable_globally"})},className:"text-token-text-primary",children:e.jsx(B,{id:"dtAOq4",defaultMessage:"Hide everywhere"})})]})}const Vt={initial:{opacity:1},animate:{opacity:1},exit:{opacity:0,transition:{duration:.2}}};function Vr({visible:t}){return e.jsx(ve,{children:t&&e.jsx(H.div,{...Vt,className:"text-token-text-tertiary flex justify-center py-6 text-sm",children:e.jsx(B,{id:"ckTD9g",defaultMessage:"Follow ups are turned off for this conversation"})})})}function zr({visible:t}){return e.jsx(ve,{children:t&&e.jsxs(H.div,{id:"disableForAllConvos",...Vt,className:"flex flex-col items-center py-3 text-sm",children:[e.jsx("div",{children:e.jsx(B,{id:"5GDIBQ",defaultMessage:"Follow up have been turned off"})}),e.jsx("div",{className:"text-token-text-tertiary pt-1",children:e.jsx(B,{id:"LYaBNe",defaultMessage:"You can re-enable them in settings"})})]})})}function Wr({modelSlug:t,animateModelLabelOnRender:n,isDropdownOpen:a,isRegenerateEnabled:s,isHovered:o,animateShortLabel:r}){const{data:c}=zo(),[d,i]=l.useState("initial");l.useEffect(()=>{if(n){const h=setTimeout(()=>i("show"),500),b=setTimeout(()=>i("initial"),2e3);return()=>{clearTimeout(h),clearTimeout(b)}}i("initial")},[n]);const{shorterLabel:g}=c?.categories.find(({defaultModel:h})=>h===t)??{},u={initial:{opacity:0,paddingLeft:0,width:"0"},show:{opacity:1,paddingLeft:2,width:"100%"},visible:{opacity:1,paddingLeft:2,width:"100%",transition:{delay:0,duration:0}}},f=a?"visible":o?"show":d;return e.jsxs(H.div,{initial:"initial",animate:f,className:"flex items-center pb-0",children:[e.jsx(ts,{className:"icon-md"}),(s||r)&&e.jsx(H.span,{className:"overflow-hidden text-sm text-clip whitespace-nowrap",variants:u,transition:{type:"tween",duration:.18},children:g}),s&&e.jsx(ht,{className:"icon-sm"})]})}function Ve(t,n){const{modelSwitcherDeny:a,subscriptionLevel:s}=t;return!!a&&a.reason===Yo.RATE_LIMIT&&s===Qo.PLUS&&!n}const Ie="rounded-lg radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed";function $r({className:t,clientThreadId:n,message:a,onModelSelect:s,canRegenerateResponse:o,withModelSelectorLabel:r=!0}){const[c,d]=l.useState(null),[i,g]=l.useState(!1),[u,f]=l.useState(!1),h=a.metadata?.model_slug,b=a.id,m=l.useRef(null),T=_=>{_||setTimeout(()=>{m.current&&m.current.blur()},10)};l.useEffect(()=>{T(i)},[i]);const k=se(n,ka),M=Vo({clientThreadId:n}),N=l.useRef(M);l.useEffect(()=>{N.current=M},[M]);const P=l.useCallback(_=>{N.current?de(n,C=>{C.conduitToken=null,C.prepareState=null}):de(n,C=>{C.conduitToken=_,C.prepareState="success"})},[n]);if(k)return null;const v=fa(n,a.id),x=a.metadata?.model_slug,E=ba(v,x);return e.jsxs(Q.Root,{onOpenChange:_=>{o&&(x&&ya(n,x,[],P),g(_),T(_))},children:[o?e.jsx(xa,{label:r?e.jsx(B,{id:"wDs5sz",defaultMessage:"Switch model "}):e.jsx(B,{id:"/a4cqQ",defaultMessage:"Switch model ({modelSlug})",values:{modelSlug:x}}),children:e.jsx(va,{ref:m,className:L("cursor-pointer",t),onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),children:r?e.jsx(Wr,{modelSlug:x,animateModelLabelOnRender:E,isDropdownOpen:i,isRegenerateEnabled:o,isHovered:u}):e.jsxs("div",{className:"flex items-center",children:[e.jsx(ts,{className:"icon-md"}),e.jsx(ht,{className:"icon-sm"})]})})}):null,o&&e.jsx(Q.Portal,{children:e.jsxs(Q.Content,{className:"text-token-text-primary z-30 min-w-fit origin-top-right",side:"bottom",align:"start",children:[e.jsx(Q.Label,{children:e.jsx(B,{id:"bFLh5u",defaultMessage:"Switch model"})}),e.jsx(Yr,{clientThreadId:n,messageId:b,message:a,onModelSelect:s,messageModelSlug:h,setHoveredOption:d,hoveredOption:c})]})})]})}function Yr({clientThreadId:t,message:n,messageId:a,messageModelSlug:s,onModelSelect:o,setHoveredOption:r,hoveredOption:c}){const d=Ae(),{data:i=null}=Wo(),g=i&&$o(i),{modelOptions:u,messageModelEnabledTools:f}=Sa({clientThreadId:t,message:n}),h=f.includes(te.Search),b=l.useMemo(()=>u.find(v=>v.value===s),[u,s]),[m,T]=l.useMemo(()=>_a(u,v=>v.subcategory),[u]),k=Ta(n);l.useEffect(()=>{const v=u.some(x=>Ve(x,g));O.logEvent("Conversation Open Message Model Selector",{has_get_plus_button:v,is_new_regen_dropdown:!0})},[]);const M=l.useMemo(()=>{const v=new Map;return m.forEach(x=>{const E=x.subcategory;E&&(v.has(E)||v.set(E,[]),v.get(E)?.push(x))}),v},[m]),N=L("icon-sm","order-10 ms-auto text-token-text-tertiary icon-md"),P=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:d.formatMessage(ze.search),icon:e.jsx(ja,{className:N}),condition:h&&!k,eventName:"chatgpt_regenerate_with_search_button_clicked"},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:d.formatMessage(ze.nosearch),icon:e.jsx(Ca,{className:N}),condition:h&&k,eventName:"chatgpt_regenerate_without_search_button_clicked"}];return e.jsxs(e.Fragment,{children:[T.map(v=>{const{value:x,...E}=v;return e.jsx(Me,{value:x,onSelect:_=>{ee.logEvent("chatgpt_regenerate_switch_model_button_clicked",x,{requestedModelId:x,...K({clientThreadId:t,messageId:a})}),o({sourceEvent:_,requestedModelId:x})},includeRegenerate:!1,onMouseEnter:()=>r(x),onMouseLeave:()=>r(null),isHovered:c===x,messageModelSlug:s,includeCheck:!1,shouldShowUpsell:Ve(v,g),className:Ie,...E,icon:e.jsx("span",{className:N}),clientThreadId:t},x)}),[...M.entries()].map(([v,x])=>e.jsxs(Q.Sub,{children:[e.jsx(Q.SubMenuTrigger,{children:e.jsx("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:v})}),e.jsx(Q.Portal,{children:e.jsx(Q.SubContent,{className:"min-w-fit",children:x.map(E=>{const{value:_,...C}=E;return e.jsx(Me,{value:_,onSelect:S=>{ee.logEvent("chatgpt_regenerate_switch_model_button_clicked",_,{requestedModelId:_,...K({clientThreadId:t,messageId:a})}),o({sourceEvent:S,requestedModelId:_})},includeRegenerate:!1,onMouseEnter:()=>r(_),onMouseLeave:()=>r(null),isHovered:c===_,messageModelSlug:s,includeCheck:!1,className:Ie,...C,icon:null,shouldShowUpsell:Ve(E,g),clientThreadId:t},v+"-"+_)})})})]},v)),!!b&&e.jsxs(e.Fragment,{children:[e.jsx(Q.Separator,{}),e.jsx(Me,{onSelect:v=>{ee.logEvent("chatgpt_regenerate_try_again_button_clicked",b.value,{requestedModelId:b.value,...K({clientThreadId:t,messageId:a})}),o({sourceEvent:v,requestedModelId:b.value})},includeRegenerate:!0,onMouseEnter:()=>r(b.value),onMouseLeave:()=>r(null),messageModelSlug:s,includeCheck:!1,className:Ie,...b,label:d.formatMessage(ze.tryAgain),subtitle:b.label,icon:e.jsx(ts,{className:N}),clientThreadId:t},b.value),P.filter(v=>v.condition).map(v=>e.jsx(Me,{onSelect:x=>{ee.logEvent(v.eventName,b.value,{requestedModelId:b.value,...K({clientThreadId:t,messageId:a})}),o({sourceEvent:x,requestedModelId:b.value,extraStreamParams:v.extraStreamParams})},includeRegenerate:!1,onMouseEnter:()=>r(v.key),onMouseLeave:()=>r(null),isHovered:c===v.key,messageModelSlug:s,includeCheck:!1,className:Ie,...b,label:v.label,subtitle:"",icon:v.icon,clientThreadId:t},v.key))]})]})}const ze=nt({tryAgain:{id:"VbsBGW",defaultMessage:"Try again"},search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),Qr=l.memo($r),Kr=null,Xr=ue(()=>he(()=>import("./er4xq69qu4sjw5id.js"),__vite__mapDeps([8,2,1,3,9,10,4,5,11,12])).then(t=>t.VoicePlayButton)),Jr=ue(async()=>Promise.resolve(()=>null)),Zr=({alwaysShow:t,isUserTurn:n,children:a})=>{const s=l.useRef(null);return l.useEffect(()=>{const o=s.current;o&&(t?requestAnimationFrame(()=>{o&&(o.style.maskPosition=t?"0% 0%":"")}):o.style.maskPosition="")},[t]),e.jsx("div",{className:L("flex",!t&&"absolute start-0 end-0 flex",n?"justify-end":"justify-start"),children:e.jsx("div",{ref:s,className:L("touch:-me-2 touch:-ms-3.5 -ms-2.5 -me-1 flex items-center p-1 select-none",!n&&"-mt-1",t&&"duration-[1.5s]","focus-within:transition-none hover:transition-none",!(t||n)&&"duration-500 group-hover/turn-messages:delay-300",!n&&["pointer-events-none [mask-image:linear-gradient(to_right,black_33%,transparent_66%)] [mask-size:300%_100%] [mask-position:100%_0%] motion-safe:transition-[mask-position]","group-hover/turn-messages:pointer-events-auto group-hover/turn-messages:[mask-position:0_0]","group-focus-within/turn-messages:pointer-events-auto group-focus-within/turn-messages:[mask-position:0_0]","has-data-[state=open]:pointer-events-auto has-data-[state=open]:[mask-position:0_0]"],n&&["duration-300 group-hover/turn-messages:delay-300","pointer-events-none opacity-0 motion-safe:transition-opacity","group-hover/turn-messages:pointer-events-auto group-hover/turn-messages:opacity-100","group-focus-within/turn-messages:pointer-events-auto group-focus-within/turn-messages:opacity-100","has-data-[state=open]:pointer-events-auto has-data-[state=open]:opacity-100"]),children:a})})},ei=({activeVariantIndex:t,clientThreadId:n,conversationMode:a,lastMessage:s,messages:o,numVariants:r,onChangeIndex:c,onRate:d,showCanvasButton:i,showCopyButton:g,showPagination:u,showPlayButton:f,showRatingButtons:h,showRegenerateButton:b,isJam:m,turn:T,turnIndex:k})=>{const M=rs(),N=Ae(),P=Rt(),v=at(),{value:x}=Re("4061070236"),E=s?.clientMetadata?.rating;s?.clientMetadata?.requestId;const _=Ko(o,q=>{const[me]=q.author.name?.split(".")??[];return me===Xo.T2UAY3K&&At.getImageAssetPointers(q).length>0}),C=o.filter(Jo).filter(q=>q.recipient==="all"),S=!!_,A=Ft(),w=wa(),p=Ia(),j=ge(n),R=S&&C.length===0&&Zo(_),I=!m&&j!=null,D=!A&&_?.status==="finished_successfully"&&w(),ae=!A&&!_&&Ea(M);let oe=null;return I&&(D||ae?oe=e.jsx(ni,{clientThreadId:n,imageGenMessageId:_?.id,messageSliceIds:o.map(q=>q.id)}):p&&Pt(M,"1547743984").get("show_share_button_inline",!1)&&(oe=e.jsx(xe,{onClick:()=>{j&&xt.openSharingModal(j)},label:N.formatMessage({id:"ConversationTurn.shareButtonTooltip",defaultMessage:"Share conversation"}),className:"sm:hidden",icon:ft}))),e.jsxs(e.Fragment,{children:[u&&e.jsx(pt,{currentPage:t,onChangeIndex:c,length:r}),!1,g&&!R&&e.jsx(zt,{onClick:q=>{Bt(M,n,k,P,q,"mouse",v)}}),!S&&h&&e.jsxs(e.Fragment,{children:[E!=="thumbsDown"&&e.jsx(xe,{onClick:()=>d("thumbsUp"),disabled:E==="thumbsUp",icon:E==="thumbsUp"?Na:vt,label:N.formatMessage({id:"ConversationTurn.goodResponseTooltip",defaultMessage:"Good response"}),testId:"good-response-turn-action-button"}),E!=="thumbsUp"&&e.jsx(xe,{onClick:()=>d("thumbsDown"),disabled:E==="thumbsDown",icon:E==="thumbsDown"?Ra:bt,label:N.formatMessage({id:"ConversationTurn.badResponseTooltip",defaultMessage:"Bad response"}),testId:"bad-response-turn-action-button"})]}),f&&s&&C.length>0&&e.jsx(Xr,{conversationId:n,message:s,iconClassName:"icon-md",className:"text-token-text-tertiary hover:text-token-text-primary gap-1.5 rounded-md p-1 text-xs"}),!S&&i&&e.jsx(Aa,{turn:T}),!1,s&&Kr,b&&s&&e.jsx(ti,{clientThreadId:n,conversationMode:a,lastMessage:s,messages:o,hasImageGenMessage:S,withModelSelectorLabel:!x}),oe]})},si=({activeVariantIndex:t,clientThreadId:n,numVariants:a,onAnticipateEdit:s,onChangeIndex:o,onEnterEdit:r,showCopyButton:c,showEditMessageButton:d,showPagination:i,turnIndex:g})=>{const u=rs(),f=Rt(),h=at();return e.jsxs(e.Fragment,{children:[c&&e.jsx(zt,{onClick:b=>{Bt(u,n,g,f,b,"mouse",h)}}),d&&e.jsx(Ma,{onAnticipateEdit:s,onEnterEdit:r}),i&&e.jsx(pt,{currentPage:t,onChangeIndex:o,length:a})]})},ti=({clientThreadId:t,conversationMode:n,messages:a,hasImageGenMessage:s,lastMessage:o,withModelSelectorLabel:r})=>{const c=Da({clientThreadId:t,conversationMode:n}),d=Ua(t,o),i=l.useCallback(({sourceEvent:g,requestedModelId:u,appendMessages:f,extraStreamParams:h})=>{o&&c({sourceEvent:g,nodeId:o.id,requestedModelId:u,appendMessages:f,extraStreamParams:h})},[o,c]);return s?e.jsx(Jr,{messages:a,onModelSelect:i}):e.jsx(Qr,{className:"text-token-text-secondary hover:bg-token-main-surface-secondary touch:px-2.5 h-[30px] rounded-md px-1.5",clientThreadId:t,message:o,onModelSelect:i,canRegenerateResponse:d,withModelSelectorLabel:r})},zt=({onClick:t})=>{const[n,a]=l.useState(!1),s=Fa(),o=Ae(),r=l.useCallback(c=>{c.stopPropagation(),O.logEvent("ChatGPT Turn Action Copy Clicked"),t(c),a(!0),setTimeout(()=>{s()&&a(!1)},2e3),ee.logEvent("chatgpt_turn_action_copy")},[s,t]);return e.jsx(xe,{icon:n?Pa:La,onClick:r,label:o.formatMessage({id:"CopyButton.copyTooltip",defaultMessage:"Copy"}),testId:"copy-turn-action-button"})};function ni({clientThreadId:t,imageGenMessageId:n,messageSliceIds:a}){const[s,o]=l.useState(!1),r=Ae(),c=_r({clientThreadId:t,imageGenMessageId:n,messageSliceIds:a});return l.useEffect(()=>{O.logEventWithStatsig("Share Post: Share Button Shown","chatgpt_post_share_button_shown",{source:"turn_action"})},[]),e.jsx(xe,{onClick:async()=>{o(!0);try{await c()}finally{o(!1)}O.logEventWithStatsig("Share Post: Share Button Clicked","chatgpt_post_share_button_clicked",{source:"turn_action"})},label:r.formatMessage({id:"ConversationTurn.sharePostButtonTooltip",defaultMessage:"Share"}),icon:s?er:ft,disabled:s})}const Xs=[1,2,3,4,10,20,30],ai=1,oi=["g-67e595af0a408191b84ee532fca12cd1","g-67ec3b78892481918c89067962526695","g-67ec3b4988f8819184c5454e18f5e84b","g-67ec3ad40750819181ccffa6a6f050d5","g-67edaaa3d3a081918205d0c470f00a32","g-67edab030ac881918ce8fa5c75a8e1b3","g-67edab2fc0f48191881a20ac98fedf6f","g-67edab4a24fc8191b975acaa8da2dcef"];function ri({clientThreadId:t}){const n=yt(St.isBusinessWorkspace),a=_t(),s=l.useRef(!1),o=is(t),[r,c,d,i]=se(t,p=>[p?.mode,U.getRequestId(p),U.getConversationLastTurn(p),U.getConversationTurns(p).filter(j=>j.role===Y.Assistant).length]),{isUnauthenticated:g}=Lt(),u=l.useMemo(()=>{if(!o)return-1;const p=rt(o);return p()>ai?-1:Xs[Math.floor(p()*Xs.length)]},[o]),f=ns(c),h=function(){return Math.random()<.5?"default":"personality_v1"},[b,m]=l.useState(null),[T,k]=l.useState(!1),[M,N]=l.useState(!1),[P,v]=l.useState(!1),[x,E]=l.useState(h),_=(p,j)=>{const R=d?.messages[0]?.id;m(p),E(j),S(R,p,j)},C=d?.role===Y.Assistant,S=l.useMemo(()=>Ba((p,j,R)=>{o&&p&&(n&&a?Oa({rating:Ga(j),shown_at_assistant_turn:u,prompt:R},o,p):n||wt.safePost("/conversation/{conversation_id}/rating",{parameters:{path:{conversation_id:o}},requestBody:{message_id:p,rating:j,shown_at_assistant_turn:u,prompt:R},authOption:It.SendIfAvailable})),O.logEvent("Conversation Rating Submitted",{rating:j,showAtAssistantTurn:u,conversationId:o,prompt:R}),k(!0),setTimeout(()=>{N(!0)},1500)},2e3),[n,a,o,u]),A=i!==u||f||!C||!!n&&!a||r?.kind!==Xe.PrimaryAssistant&&r?.kind!==Xe.FlyingCircusCustomization&&r?.gizmo_id!==void 0&&!oi.includes(r?.gizmo_id)||P||g;l.useEffect(()=>{!A&&!s.current&&(O.logEvent("Conversation Rating Shown",{showAtAssistantTurn:u,conversationId:o}),s.current=!0)},[A]);const w=qa();return P||!w.forceShowConvoRating&&A?null:e.jsxs("div",{className:"mx-auto",children:[e.jsx(ve,{children:T&&!M&&e.jsx(H.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(Js,{$padded:!0,children:e.jsx("span",{className:"text-token-text-tertiary text-sm",children:e.jsx(B,{id:"rating.thanks",defaultMessage:"Thanks for your feedback!"})})})},"submitted")}),!T&&e.jsx(H.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},children:e.jsxs(Js,{$padded:!1,children:[e.jsxs("div",{className:"text-token-text-secondary flex items-center justify-center gap-4 px-4 py-3 text-sm",children:[x==="personality_v1"?e.jsx(B,{id:"rating.instructions.personality_v1",defaultMessage:"Do you like this personality?"}):e.jsx(B,{id:"rating.instructions.default",defaultMessage:"Is this conversation helpful so far?"}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx(We,{$selected:b==="thumbsUp",onClick:()=>_("thumbsUp",x),children:e.jsx(vt,{className:"icon-md"})}),e.jsx(We,{$selected:b==="thumbsDown",onClick:()=>_("thumbsDown",x),children:e.jsx(bt,{className:"icon-md"})})]})]}),e.jsx("div",{className:"bg-token-main-surface-tertiary w-px flex-1 self-stretch"}),e.jsx(We,{className:"p-3",$selected:!1,onClick:()=>v(!0),children:e.jsx(sr,{className:"icon-md text-token-text-secondary hover:text-token-text-primary"})})]})},"rating")]})}const We=ne.button`
  ${t=>t.$selected?"text-token-text-primary":"text-token-text-secondary"}
  hover:text-token-text-primary
`,Js=ne.div`inline-flex rounded-xl border border-gray-100 dark:border-gray-700
${t=>t.$padded&&"py-3 px-4"}
`,ii=ue(()=>he(()=>import("./jr0ylqyi4w8to7tq.js"),__vite__mapDeps([13,2,1,3,4,5,14])));function li({clientThreadId:t,canShowInlineMessageFeedback:n,messageForRating:a,allGroupedMessages:s,currentModelId:o}){const r=os()?.isWorkspacePlan()??!1;let c=null;const d=se(t,h=>{const b=U.getConversationTurns(h);let m=0;for(let T=b.length-1;T>=0;T--){const k=b[T];if(k.messages.some(M=>M.metadata?.is_indepth_feedback))return!0;if(k.messages.some(M=>M.author.role===Y.Assistant)&&m++,m>=3)break}return!1}),i=is(t),g=Tt(h=>h.voiceFeedbackThread),u=i===g,{voiceName:f}=Ha();return d?null:(u&&i&&!r?(tr.feedbackShown.success({voice:f}),c=e.jsx("div",{className:"text-center",children:e.jsx(Va,{serverThreadId:i})})):a.clientMetadata?.rating&&n?c=e.jsx(ii,{clientThreadId:t,conversationMessage:a,allGroupedMessages:s,currentModelId:o}):c=e.jsx("div",{className:"text-center",children:e.jsx(ri,{clientThreadId:t})}),e.jsx("div",{className:"mt-3 w-full empty:hidden",children:c}))}const ci=ue(()=>he(()=>import("./m7lwf6btsri0ydn8.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(t=>t.MemoryActionResult)),di=ue(()=>he(()=>import("./ejg7eu8fdglznsor.js"),__vite__mapDeps([15,2,4,1,3,5,16,17])).then(t=>t.AutomationSourceHeader)),Zs=ue(()=>he(()=>import("./fw37lmma5ljh7fs1.js"),__vite__mapDeps([18,2,1,3,4,5])).then(t=>t.TextMessageEditor)),et=80,ui=16,st={minHeight:`calc(100dvh - ${co}px - 120px)`};function mi(t){const{turnIndex:n,isFinalTurn:a,clientThreadId:s,onRequestCompletion:o,currentModelId:r,avatarClassName:c,showAvatar:d,scrollToMessageId:i,dateHeaderType:g}=t,{isNewScrollEnabled:u}=jt(),f=ot();os()?.normalizedAccountUserId;const h=rs(),b=!!f&&nr(f),m=za(),T=yt(St.isBusinessWorkspace),k=xo(),M=qe(h,"1760640904"),N=qe(h,"4061070236"),P=!!d,x=null!=null,E=qe(h,"1887864177"),{capabilitySuggestionsEnabled:_}=gt(),C=vr(),[S,A]=se(s,y=>{const V=U.getConversationTurnAtIndex(y,n),$=n>0?U.getConversationTurnAtIndex(y,n-1):null,G=$?.role===Y.User&&$.messages.some(z=>z.metadata?.visually_hide_response_from_conversation);return[V,G]}),{messages:w,messageGroups:p}=S,j=Wa(),R=w[0],I=F(w),{messages:D,visibleMessages:ae,messageGroups:oe,lastMessageToRender:q,doesTurnHaveDelayedMessages:me}=l.useMemo(()=>{const y=j.size===0?-1:p.findIndex(z=>z.type===Ge?z.groups.some(ie=>ie.messages.some(Be=>j.has(Be?.id))):z.messages.some(ie=>j.has(ie?.id))),V=y!==-1&&y+1<p.length,$=V?p.slice(0,y+1):p,G=V?$.flatMap(z=>z.type===Ge?z.groups.flatMap(ie=>ie.messages):z.messages):w;return{messages:G,visibleMessages:G.filter(ar),messageGroups:$,lastMessageToRender:F(G),doesTurnHaveDelayedMessages:y!==-1}},[w,p,j]),X=l.useMemo(()=>({clientThreadId:s,turnIndex:n,messageId:I?.id}),[s,n,I?.id]),Wt=!1,[cs,ds]=l.useState(!1),[$t,Yt]=l.useState(!1),Qt=l.useContext($a)!=null,W=S.role===Y.User,us=Ft(),be=or(s),Fe=Ya(S.gizmoId??be).data,Pe=Ct(s),Kt=Qa(s),ms=Ka(Pe),Xt=Xa(Pe,Kt),gs=_t(),[ye,Jt,Zt,hs,Le,bi,en,sn,tn,ps,nn,re,fs]=se(s,y=>{const V=U.getParentPromptNode(y,R.id),$=V?.message.clientMetadata?.variantsInStreamInfo??(V?.message.metadata?.paragen_variant_choice?void 0:V?.message.metadata?.paragen_variants_info),G=U.getVariantIds(y,R.id),z=U.getCurrentVariantId(y,R.id),ie=U.getIsDoNotRemember(y),Be=z?G.indexOf(z):0,qn=$&&y?.tree!=null&&G.some(le=>{const{errType:As}=y.tree.getLeafFromNode(le).message.clientMetadata??{};return As!=null&&As!=="info"}),Oe=U.getConversationTurns(y);return[y?.async_status===He.STREAMING,U.isMessageTurnEnded(y,I?.id),qn,bo(y?.mode,Fe?.gizmo.id),y?.continuingFromSharedConversationId!=null,null,Oe.findIndex(le=>le.role===Y.User)===n,yo(Oe,le=>le.role===Y.User)===n,Oe.findIndex(le=>le.role===Y.Assistant)===n,U.getRequestId(y,I?.id),$,G,Be,ie]});let an="default";const on=D.some(y=>y.content.content_type===rr.MultimodalText),rn=Pt(h,"3119715334").get("should-enable-skip",!1),{isUnauthenticated:xs}=Lt(),vs=S.messages.map(y=>y.id),J=l.useRef(null),bs=!u&&(i?.length??0)>2&&i!=="finalAgentTurn"&&a&&k,Se=W?F(ae):void 0,De=Se?.id,ln=l.useCallback(()=>{De&&(O.logEvent("Edit Prompt",{id:De,threadId:ge(s)}),ir(h,"chatgpt_edit_prompt"),ds(!0))},[De,s,h]),cn=l.useCallback(()=>{ds(!1)},[]),ys=Ja()??!1,{onChangeRating:dn}=Za({clientThreadId:s,currentModelConfig:Pe}),un=y=>{if(!I)return;dn({nodeId:I.id,messageId:I.id,rating:y});const V=ys&&p.some($=>$.type!==Ge&&$.messages?.some(vo));O.logEventWithStatsig(y==="thumbsDown"?"Message Feedback Thumbs Down Clicked":"Message Feedback Thumbs Up Clicked","chatgpt_thumb_feedback",{id:I.id,threadId:ge(s),model:r,rating:y,...ys?{isCATriggered:V}:{}}),Yt(!0)},[mn]=l.useState(()=>Date.now()),gn=is(s),Ss=eo(s)?.value,hn=Ss===He.STREAMING,pn=Ss===He.REALTIME,_s=ps!=null,fn=ns(ps),Z=!Jt&&fn||me||pn,Ts=kt(),[xn,js]=l.useState(_s),Cs=l.useRef(!1),vn=so(s,I),[,bn]=Wn(),{isOpen:ks}=Us();l.useEffect(()=>{const V=new URLSearchParams(window.location.search).get("message");!(V!=null&&vs.includes(V))||!J.current||(J.current.scrollIntoView({behavior:"instant"}),bn(G=>(G.delete("message"),G),{replace:!0,preventScrollReset:!0}))},[]),l.useEffect(()=>{if(u)return;const $=new URLSearchParams(window.location.search).get("message")!=null;if(Cs.current||$||i===void 0||!J.current){i==="finalAgentTurn"&&a&&de(s,G=>{G.scrollToMessageId=void 0});return}(vs.includes(i)||i==="finalAgentTurn"&&a)&&(Cs.current=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(J.current)if(i==="finalAgentTurn"&&a)J.current.scrollIntoView({behavior:"instant",block:"end"}),de(s,G=>{G.scrollToMessageId=void 0});else{const G=J.current.offsetHeight;let z;G>et&&!ks?z=et-G:z=0,J.current.style.scrollMarginTop=`${z+ui}px`,J.current.scrollIntoView({behavior:"smooth"})}})}))},[i,J.current,ks]);const{showDebugConversationTurns:yn}=it(),Sn=to(),_n=!m&&!Le&&!us&&!W,Tn=q?.author.role===Y.Assistant?q:null,jn=q?.metadata?.system_hints?.includes(te.Research);no({isCompletionRequestInProgress:Z,isUserTurn:W,message:Tn});const{isOpen:Cn}=Us(),kn=ao(),_e=oo(hs),Te=!_e&&_n&&a&&nn?.num_variants_in_stream===2&&re.length<=2&&!I?.clientMetadata?.inlineComparisonRating&&!Zt,Mn=Tt(y=>y.voiceFeedbackThread),pe=a&&(_s||gn===Mn),Ms=ye||Z||hn,wn=!cs&&!m&&!Le&&!_e&&!Cn&&S.role!==Y.Developer&&(N?!pe||!Ms:(xn||pe)&&!Ms),In=D.some(y=>lr(y)===cr.l1239dk1),En=pe&&!Z&&!Le&&!m&&!In&&(E||C||_),je=I!=null&&!0&&(!T||Xt||b||gs)&&!_e&&!xs&&!us&&!I.metadata?.b1de6e2_s,Nn=(!T||gs)&&je&&pe&&!ye&&!Z,ws=!m&&!((Z||ye)&&a)&&re.length>1&&!Te&&!0,Is=W&&D.some(y=>ro(y)?.shouldHideContent),Rn=W&&Se!=null&&!_e&&!m&&!on&&!Is&&!xs&&!0&&!jn,An=I!=null&&(I.clientMetadata?.disclaimers??[]).length===0,Es=l.useCallback(y=>{de(s,V=>{as.setCurrentBranch(V,re[y])}),O.logEvent("Change Active Node",{intent:"toggle_between"})},[s,re]),Fn=io(S,D,yn),{toggleThreadSidebar:Ns}=dr(),Ce=I?.id,Pn=l.useCallback(()=>{Ce&&Ns({type:"retrievalResults",clientThreadId:s,turnIndex:n,messageId:Ce})},[Ce,Ns,s,n]),Ln=l.useMemo(()=>lo(S,ms,!!be),[ms,be,S]);if(!Fn&&!Te)return bs?e.jsx("div",{style:st}):null;if(A)return null;const Dn=q?.metadata?.followup_prompts?q.metadata.followup_prompts.map(y=>({text:y,type:ut.Reply})):[],Un=q?.metadata?.category_suggestions,Bn=!D.some(y=>At.getAudioAssetPointers(y).length>0)&&!0&&!be,On=!Z&&D.some(y=>y.author.role===Y.Assistant&&y.metadata?.onboarding?.main_usages),Ue=D.find(y=>!!y.metadata?.onboarding?.examples)?.metadata?.onboarding?.examples,Rs=!Is&&(!W||M)&&(!a||!Z);return Sn&&!a&&ae.length===0?null:e.jsxs(uo.Provider,{value:tn,children:[e.jsx(mo,{dateHeaderType:g,turn:S}),e.jsxs("article",{className:L("text-token-text-primary w-full",!u&&i==="finalAgentTurn"&&k?"opacity-0":"",{hidden:Qt&&en}),style:bs?st:void 0,ref:J,dir:"auto","data-testid":`conversation-turn-${n}`,"data-scroll-anchor":!u&&a,children:[e.jsx(go,{role:S.role}),e.jsxs(Ye,{verticalPadding:an,horizontalPadding:Te?"none":"standard",children:[Te?e.jsxs(e.Fragment,{children:[e.jsx(kr,{isFeedbackEnabled:je,variantIds:re,conversationTurnMountTime:mn,...t}),rn&&e.jsx("div",{className:"mt-4 flex w-full justify-center",children:e.jsxs(Et,{color:"secondary",className:"text-token-text-primary","data-testid":"paragen-skip-button",onClick:()=>{Mt.publish({kind:"requestCompletion",isForSkippingParagen:!0})},children:[e.jsx(ho,{className:"text-token-text-secondary me-1"}),e.jsx(B,{id:"IuTr+b",defaultMessage:"Skip"})]})})]}):e.jsx(Ee,{tabIndex:-1,className:"group/turn-messages focus-visible:outline-hidden",onFocus:()=>js(!0),onPointerEnter:()=>js(!0),children:e.jsxs(e.Fragment,{children:[Wt,!W&&!0&&P&&e.jsx(hi,{children:e.jsx(Ze,{messages:D,isUserTurn:W,avatarClassName:c,gizmo:Fe})}),e.jsx("div",{className:Qe({isUserTurn:W}),children:e.jsx("div",{className:"relative flex-col gap-1 md:gap-3",children:e.jsxs(e.Fragment,{children:[null,!W&&!m&&e.jsx(ci,{messages:D,clientThreadId:s,gizmoId:Fe?.gizmo.id}),kn&&!W&&e.jsx(di,{clientThreadId:s,messages:D}),cs&&Se?e.jsx(Zs,{message:Se,clientThreadId:s,onRequestCompletion:o,onExitEdit:cn,disabled:Ts}):e.jsx(Je,{allMessages:w,groupedMessagesToRender:oe,allGroupedMessages:p,...t,isUserTurn:W,isFinalUserTurn:sn,isCompletionRequestInProgress:Z,isFeedbackEnabled:je,isFinalTurn:a,hasActiveRequest:Ts}),Ln&&e.jsx(wr,{handleShowRetrievalResults:Pn,clientThreadId:s,turnIndex:n,responseComplete:!(Z||ye)}),On&&e.jsx(fr,{clientThreadId:s}),Ue&&Ue.length>0&&!Z&&e.jsx(xr,{clientThreadId:s,examples:Ue}),wn&&e.jsx(Zr,{isUserTurn:W,alwaysShow:pe||N,children:W?e.jsx(si,{activeVariantIndex:fs,clientThreadId:s,numVariants:re.length,onAnticipateEdit:Zs.prefetch,onChangeIndex:Es,onEnterEdit:ln,showCopyButton:Rs,showEditMessageButton:Rn,showPagination:ws,turnIndex:n}):e.jsxs(e.Fragment,{children:[e.jsx(ei,{activeVariantIndex:fs,clientThreadId:s,conversationMode:hs,lastMessage:I,messages:D,numVariants:re.length,onChangeIndex:Es,onRate:un,showCanvasButton:vn&&!0,showCopyButton:Rs,showPagination:ws,showPlayButton:An,showRatingButtons:je,showRegenerateButton:Bn,isJam:x,turn:S,turnIndex:n}),N&&e.jsx(po,{clientThreadId:s,message:I,turnIndex:n})]})}),Nn&&e.jsx(li,{canShowInlineMessageFeedback:$t,clientThreadId:s,messageForRating:I,allGroupedMessages:p,currentModelId:r}),En&&e.jsx(qr,{followups:Dn,categorySuggestions:Un,clientThreadId:s,lastMessageId:Ce,analyticsMetadata:X})]})})})]})}),e.jsx(fo,{clientThreadId:s,turn:S,isFinalTurn:a})]})]})]})}const gi=zn.memo(mi),hi=ne.div`shrink-0 flex flex-col relative items-end`;function pi(t){const n=U.getConversationTurns(t),a=n.findIndex(o=>o.role===Y.Assistant);if(a===-1)return;const s=n[a];for(let o=0;o<s.messageGroups.length;o++)if(s.messageGroups[o].type===Ds.SearchGPTQuery){const c=s.messageGroups.slice(o+1).find(({type:i})=>i===Ds.Text);if(c==null)return;const d=ur(c.messages[0]);if(d?.[0]?.type==="navigation")return{turnIndex:a,navigationCitation:d[0],message:c.messages[0]}}}function fi(t,n){if(n==null||t==null)return t;const a=new Set(t.domains.map(s=>s.url));return{...t,domains:[...t.domains,...n.domains.filter(s=>!a.has(s.url))],safe_urls:[...t.safe_urls??[],...n.safe_urls??[]]}}function xi({clientThreadId:t,prefetchNavlink:n,setPrefetchNavlink:a}){const s=l.use(n),{value:o}=Re("1032814809");l.useEffect(()=>{window.__oai_SSR_NAVLINK&&So.logEvent("Search Tool Page Load Time To Fast Nav SSR",{server_timing:s?.timing},window.__oai_SSR_NAVLINK)},[]),l.useEffect(()=>{s==null&&a(void 0)},[s,a]);const r=l.useMemo(()=>s==null?null:{...s.navlink,domains:s.navlink.domains.map(i=>({...i,subtitle:i.subtitle??i.domain}))},[s]),c=se(t,pi),d=l.useMemo(()=>fi(r,c?.navigationCitation),[c,r]);return s==null||d==null?null:e.jsxs("div",{children:[e.jsx(Ye,{horizontalPadding:"standard",children:e.jsx(Ee,{children:e.jsx("div",{className:Qe({isUserTurn:!0}),children:e.jsx("div",{className:_o(!0),children:e.jsx(To,{containsImagesOrAttachments:!1,isUserTurn:!0,children:e.jsx(jo,{text:s.query})})})})})}),e.jsx("div",{className:"-mb-10",children:e.jsx(Ye,{horizontalPadding:"standard",children:e.jsx(Ee,{children:e.jsxs("div",{className:Qe({isUserTurn:!1}),children:[e.jsx(Sr,{clientThreadId:t,turnIndex:c?.turnIndex??2,nextMessage:c?.message,navigationCitation:d}),o?e.jsxs("div",{className:"text-token-text-secondary relative -top-2 flex justify-end gap-2 font-mono text-xs",children:[e.jsxs("div",{elementtiming:"navlink",children:["server: ",s.timing,"ms"]}),e.jsx(vi,{})]}):null]})})})}),e.jsx(Co,{scriptSrc:"requestAnimationFrame(()=>window.__oai_SSR_NAVLINK=window.__oai_SSR_NAVLINK||performance.now());"})]})}function vi(){const[t,n]=l.useState(null);return l.useEffect(()=>{const a=new PerformanceObserver(s=>{s.getEntries().forEach(o=>{if(o.identifier==="navlink"){const r=o.renderTime;n(c=>c??r)}})});return a.observe({type:"element",buffered:!0}),()=>a.disconnect()},[]),t==null?null:e.jsxs("span",{children:["render: ",t,"ms"]})}function Li({onRequestCompletion:t,clientThreadId:n,scrollContainerRef:a,prefetchNavlink:s,setPrefetchNavlink:o}){const[r,c,d,i]=se(n,R=>[R?.mode,U.getConversationTurnIds(R),R?.conversationOrigin===mr.APPLE,R?.scrollToMessageId]),{isNewScrollEnabled:g}=jt(),u=ko(),f=Mo(),h=wo(),[b]=Io(),m=Eo(),[T]=No(),k=Ct(n),M=u.store.useContentAreaDimensions(Ro.Header,R=>R?.height?R.height:void 0),N=Ao(k.id),P=r?.kind===Xe.GizmoMagicCreate?"bg-token-main-surface-primary text-token-text-primary":N;l.useEffect(()=>{f&&(ee.logEvent("chatgpt_continue_conversation_page_loaded"),O.logEvent("Continue Conversation: Page Loaded"),ee.logEvent("chatgpt_conversation_share_page_loaded"),O.logEvent("Share Public Chat: Shared Conversation Loaded"))},[f]);const v=l.useCallback(()=>{g||h({behavior:"smooth"})},[g,h]),x=l.useContext(gr),E=hr(x),[_,C]=l.useState(!1),S=(_||!1)&&!E,A=Fo(n),w=l.useRef(null),p=Po(n),j=Lo();return e.jsxs("div",{onCopy:A,className:L("@thread-xl/thread:pt-header-height mt-1.5 flex flex-col text-sm",j&&"keyboard-open:pb-[calc(var(--composer-height,100px)+var(--screen-keyboard-height,0))]",M?null:!g&&"pb-25"),style:{paddingBottom:M},children:[s?e.jsx(pr,{name:"prefetch-navlink",onError:R=>{Ke.addError("Error with prefetch navlink",{error:R}),o(void 0)},children:e.jsx(l.Suspense,{fallback:null,children:e.jsx(xi,{clientThreadId:n,prefetchNavlink:s,setPrefetchNavlink:o})})}):null,f&&e.jsxs(e.Fragment,{children:[e.jsx(Ee,{children:e.jsx("p",{className:"text-xs text-gray-500",children:e.jsx(B,{id:"threadLayout.sharedConversationCopyDisclaimer",defaultMessage:"This is a copy of a conversation between ChatGPT & Anonymous."})})}),e.jsx("div",{className:"text-token-text-primary text-center text-xs font-semibold",children:e.jsx("button",{onClick:()=>{xt.openModal(Do.ReportConversation),ee.logEvent("chatgpt_conversation_share_report_content_clicked",null,{location:"Static Shared Thread Page"}),O.logEvent("Share Public Chat: Report Content Clicked",{location:"Dynamic Shared Thread Page"})},children:e.jsx(B,{id:"thread.reportSharedConversation",defaultMessage:"Report content"})})})]}),c.map((R,I)=>e.jsx(gi,{isFinalTurn:I===c.length-1,turnIndex:I,clientThreadId:n,onRequestCompletion:t,currentModelId:k.id,avatarClassName:P,scrollToBottom:g?void 0:v,scrollToMessageId:g?void 0:i,dateHeaderType:p(I),showAvatar:void 0},R)),!g&&e.jsxs(e.Fragment,{children:[a?.current&&e.jsx(Uo,{setIsScrolledToEdge:R=>{C(R)},options:{root:a.current,threshold:0,rootMargin:"0%"}},"threadBottomEdgeScrollObserver"),e.jsx("div",{ref:w}),d&&b&&!T&&e.jsx(tt,{className:L("translate-y-[10px] md:translate-y-[30px]"),onClick:()=>{ee.logEvent("chatgpt_thread_scroll_to_top"),m({behavior:"smooth"})},children:e.jsx(Bo,{className:"icon-md text-token-text-primary"})}),e.jsx(ve,{children:S&&e.jsx(H.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15,ease:"easeInOut"},children:e.jsx(tt,{className:L(M?null:"bottom-8"),style:{bottom:M},onClick:()=>{ee.logEvent("chatgpt_thread_scroll_to_bottom"),w.current?.scrollIntoView({behavior:"smooth",block:"end"})},children:e.jsx(Oo,{className:"icon-md text-token-text-primary"})})})})]})]})}const tt=ne.button`cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-token-text-secondary border-token-border-default end-1/2 translate-x-1/2 bg-token-main-surface-primary w-8 h-8 flex items-center justify-center`;export{Li as T};
//# sourceMappingURL=ex4mh6ngabphh37h.js.map
