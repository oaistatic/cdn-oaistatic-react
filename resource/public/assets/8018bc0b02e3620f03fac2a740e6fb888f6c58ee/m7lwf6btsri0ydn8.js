const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ham3bgr4sv1c8bbl.js","assets/n3epq09dut36rmi2.js","assets/uox23aig6gp6se2y.js","assets/nqrmgk5te3uzwsyz.js","assets/root-nu0t8wee.css","assets/conversation-small-cqkvcue6.css","assets/jjyl0gfnyux1gir1.js","assets/jsnptf63edu6k32a.js"])))=>i.map(i=>d[i]);
import{b as _,en as N,g as q,s as L,X as W,aa as M,cf as B,cs as P,m as G,bc as D,ga as K,c as R,B as S,b3 as V,aj as v,_ as Y,aY as k,cx as w,d as Q}from"./nqrmgk5te3uzwsyz.js";import{r as y,a as U,u as z,j as e,f as X,M as u,b as H}from"./n3epq09dut36rmi2.js";import{fr as J,U as Z,J as $,fs as ee,b7 as te,aY as A,ft as oe,aZ as ne,fu as se,fv as re}from"./uox23aig6gp6se2y.js";import{S as ie}from"./okmqe1qj6dv3h4kg.js";import"./jjyl0gfnyux1gir1.js";const j="memories/current_memory_undo_id",O={async getCurrentMemoryUndoId(t){return await _.safeGet("/memories/current_memory_undo_id",{parameters:{query:{gizmo_id:t}}})},async undoMemoryWrite(t,o){return await _.safePost("/memories/undo_memory_write",{requestBody:{gizmo_id:t,memory_undo_id:o}})}},ae=W(()=>Y(()=>import("./ham3bgr4sv1c8bbl.js").then(t=>t.b),__vite__mapDeps([0,1,2,3,4,5,6,7])));let C=!1;function E(t){return t.find(o=>o.author.role===M.Tool&&o.metadata?.pending_memory_info)}function le(t){return t.filter((o,n)=>{const s=t[n+1],a=s?.recipient==="assistant"&&s?.author.role===M.Tool&&s?.author.name==="bio"&&B(s).startsWith("Model set context");return o.author.role===M.Assistant&&o.recipient==="bio"&&a}).flatMap(o=>{const n=o.content.content_type;return n===P.Text?o.content.parts:n===P.Code?[o.content.text]:[]}).map(ge)}function de(t){return t.some(o=>o.author.role===M.Assistant&&o.recipient==="bio"&&o.status==="in_progress")}function ue(t){return t.find(n=>n.author.role===M.Tool&&n.author.name==="bio"&&n.recipient===M.Assistant)?.metadata?.current_memory_undo_id}function ce(t){const{eligible:o,isLoading:n}=J(),s=y.useMemo(()=>t.length>0,[t]);y.useEffect(()=>{s&&o&&!n&&Z.openModal($.GlobalMemoryOnboarding)},[s,o,n])}function me(t){const[o,n]=y.useState(!1);return{isPopoverOpen:o,setIsPopoverOpen:n,handleTogglePopover:r=>{const a=r??!o;n(a),a&&v.logEvent("Memory Update Popover Shown",{updateCount:t.length})}}}function F({memoryWrites:t,popoverState:o,triggerButton:n,isParagen:s,gizmoId:r,memoryUndoId:a,setShowMemoriesModal:l}){return e.jsxs(se,{open:o.isPopoverOpen,sideOffset:4,side:"bottom",alignAgainstAnchor:"start",size:"none",className:"z-10 max-w-96 min-w-60 text-sm",onOpenChange:i=>o.handleTogglePopover(i),disableAutofocus:!0,triggerButton:n,children:[e.jsx("div",{className:"border-token-border-default bg-token-main-surface-secondary mb-2 rounded-sm border",children:t.map((i,d)=>e.jsx("div",{className:"border-token-border-default border-b px-3 py-2 first-letter:uppercase last:border-b-0",children:i},d))}),s?e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(u,{id:"MemoryActionResult.paragenMessage",defaultMessage:"This memory will be saved if you choose this response."})}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{gizmoId:r,memoryUndoId:a}),e.jsx(I,{onClick:()=>{l(!0),v.logEvent("Memory Update Popover Manage Button Clicked",{updateCount:t.length})},children:e.jsx(u,{id:"MemoryActionResult.manageMemories",defaultMessage:"Manage"})})]})]})}function fe({clientThreadId:t,pendingMessage:o,memoryWrites:n,popoverState:s,setShowMemoriesModal:r}){const a=G(),l=X(),i=D(t),d=K({clientThreadId:t}),p=n.join(" ");let m=p.slice(0,50).replace(new RegExp("^\\p{L}","u"),c=>c.toLocaleUpperCase()).replace(/\.$/,"");p.length>50&&(m+="...");const g=async c=>{if(!i)throw new Error("Failed to confirm or reject memory update: serverThreadId is not found");const f=o.metadata?.pending_memory_info;k(t,x=>{w.updateTree(x,h=>{h.updateNodeMessageMetadata(o.id,{pending_memory_info:{...f,is_pending:!1,confirm_result:c}})})});try{await _.safePost("/memories/confirm_or_reject",{requestBody:{message_id:o.id,conversation_id:i,is_confirm:c},authOption:Q.SendIfAvailable})}catch{a.danger(l.formatMessage({id:"memory.confirmOrDenyFail",defaultMessage:"Failed to confirm or reject memory update"})),k(t,h=>{w.updateTree(h,b=>{b.updateNodeMessageMetadata(o.id,{pending_memory_info:f})})})}};return e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"text-token-text-tertiary inline-block text-sm font-semibold outline-hidden",children:e.jsx(u,{id:"MemoryActionResult.memoryConfirmation",defaultMessage:"Update memory? {memoryText}",values:{memoryText:e.jsx("div",{className:"inline-block py-1",onMouseOver:()=>s.handleTogglePopover(!0),onMouseOut:()=>s.handleTogglePopover(!1),children:e.jsx(F,{memoryWrites:n,popoverState:s,triggerButton:e.jsx("button",{className:R("text-start font-normal",s.isPopoverOpen?"text-token-text-secondary":"text-token-text-tertiary"),children:e.jsx(u,{id:"MemoryActionResult.memoryWrapper",defaultMessage:"“{memoryWrites}”",values:{memoryWrites:m}})}),setShowMemoriesModal:r})})}})}),e.jsx(S,{className:"text-token-text-tertiary hover:text-token-text-primary ms-3",size:"xs",color:"secondary",disabled:d,onClick:()=>{g(!0)},children:e.jsx(u,{id:"MemoryActionResult.confirm",defaultMessage:"Yes"})}),e.jsx(S,{className:"text-token-text-tertiary hover:text-token-text-primary ms-2",size:"xs",color:"secondary",disabled:d,onClick:()=>{g(!1)},children:e.jsx(u,{id:"MemoryActionResult.deny",defaultMessage:"No"})})]})}function ye({memoryWrites:t,popoverState:o,isParagen:n,memoryUndoId:s,gizmoId:r,setShowMemoriesModal:a,showTooltip:l}){const i=ee(),{eligible:d,markAsViewed:p,isLoading:m}=te(A.hasSeenMemoryUpdatedTooltip),g=!oe(),[c,f]=y.useState(!1),h=V()?.hasPaidSubscription()??!1;return y.useEffect(()=>{!m&&d&&i&&l===!0&&!C?(f(!0),C=!0):!m&&!d&&f(!1)},[l,m,d,i]),t.length===0?null:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ne,{announcementKey:A.hasSeenMemoryUpdatedTooltip,show:c,onDismiss:()=>{p(),v.logEventWithStatsig("Memory Updated Tooltip Dismissed","memory_updated_tooltip_dismissed")},dismissOnOutsideClick:!0,side:g?"bottom":"left",sideOffset:4,theme:"bright",badge:"none",title:e.jsx(u,{id:"MoonshineV2Tooltip.heading",defaultMessage:"Memory in ChatGPT has changed"}),description:e.jsxs(e.Fragment,{children:[h?e.jsx(u,{id:"MoonshineV2Tooltip.description",defaultMessage:"ChatGPT can now reference all chats, but you can still manage individual saved memories."}):e.jsx(u,{id:"MoonshineV2Tooltip.description.freeMoonshine",defaultMessage:"ChatGPT can now reference recent chats, but you can still manage individual saved memories."}),e.jsx("br",{}),e.jsx("a",{href:"https://help.openai.com/en/articles/10303002-how-does-memory-use-past-conversations",target:"_blank",rel:"noopener noreferrer",className:"underline",children:e.jsx(u,{id:"MoonshineV2Tooltip.learnMoreLink",defaultMessage:"Learn more"})},"learn-more-link")]}),children:e.jsx("div",{style:{width:1,height:1}})}),e.jsx("div",{className:"inline-block",onMouseOver:()=>o.handleTogglePopover(!0),onMouseOut:()=>o.handleTogglePopover(!1),children:e.jsx(F,{memoryWrites:t,popoverState:o,isParagen:n,gizmoId:r,memoryUndoId:s,triggerButton:e.jsxs("button",{className:R("my-1 flex items-center gap-1 text-sm font-semibold outline-hidden",o.isPopoverOpen?"text-token-text-secondary":"text-token-text-tertiary"),children:[e.jsx(ie,{className:"mb-[-1px]"}),t.length===1?e.jsx(u,{id:"MemoryActionResult.memoryWriteSingular.New",defaultMessage:"Updated saved memory"}):e.jsx(u,{id:"MemoryActionResult.memoryWritePlural.New",defaultMessage:"Updated saved memories"})]}),setShowMemoriesModal:a})})]})}function he(t){const o=E(t),n=o?.metadata?.pending_memory_info?.confirm_result;return o==null?null:n===!0?"confirmed":n===!1?"denied":"pending"}function ve({messages:t,clientThreadId:o,gizmoId:n,isParagen:s}){const r=le(t),a=me(r),l=de(t),i=ue(t);ce(r);const d=E(t),{config:p}=N("3983984123"),m=p.get("is_memory_undo_enabled",!1),g=q();L(g,"1900515849");const c=y.useRef(!1),f=U();y.useEffect(()=>{l&&c.current===!1&&(c.current=!0),!l&&!d&&i&&c.current&&f.invalidateQueries({queryKey:[j,n]})},[l,d,i,n,f]);const{data:x}=z({queryKey:[j,n],queryFn:()=>O.getCurrentMemoryUndoId(n),enabled:m&&!l&&!d}),[h,b]=y.useState(!1),T=he(t);return T==="denied"?null:l?e.jsx("div",{className:"result-streaming",children:e.jsx("span",{children:e.jsx("pre",{})})}):e.jsxs(e.Fragment,{children:[T==="pending"?e.jsx(fe,{clientThreadId:o,memoryWrites:r,popoverState:a,setShowMemoriesModal:b,pendingMessage:d}):e.jsx(ye,{memoryWrites:r,popoverState:a,isParagen:s,memoryUndoId:x?.current_memory_undo_id===i?i:void 0,setShowMemoriesModal:b,showTooltip:c.current&&r.length>0}),h&&e.jsx(ae,{initialGizmoId:n,onClose:()=>b(!1)})]})}function I({children:t,disabled:o,onClick:n}){return e.jsxs("button",{className:"hover:bg-token-main-surface-secondary flex w-full items-center justify-between rounded-sm px-3 py-2 font-semibold",disabled:o,onClick:n,children:[t,e.jsx(re,{className:"icon-md text-token-text-tertiary -me-1"})]})}function pe({gizmoId:t,memoryUndoId:o}){const{config:n}=N("3983984123"),s=n.get("is_memory_undo_enabled",!1),r=U(),{isPending:a,mutate:l}=H({mutationFn:i=>O.undoMemoryWrite(t,i),onSuccess:()=>{r.invalidateQueries({queryKey:[j,t]})}});return!s||!o?null:e.jsx(I,{disabled:a,onClick:()=>{o&&l(o)},children:e.jsx(u,{id:"qeyS8G",defaultMessage:"Undo"})})}function ge(t){const o=["The user ","The user's ","User ","User's "];for(const n of o)if(t.startsWith(n))return t.slice(n.length);return t}export{ve as MemoryActionResult};
//# sourceMappingURL=m7lwf6btsri0ydn8.js.map
