import{f as W,g as L,j as e,r as x,M as U,a as G,b as J}from"./n3epq09dut36rmi2.js";import{c as K,m as _,l as R,k as Q,aP as X,b as Y,dd as Z,p as $,aM as H}from"./nqrmgk5te3uzwsyz.js";import{e8 as V,e9 as ee,ea as ae,co as se,J as A,U as y,eb as h,I as te,dN as B,dK as E,ec as re,ed as oe,ee as le,ef as ce,dj as ie,eg as ne}from"./uox23aig6gp6se2y.js";import{u as de}from"./nonl1vc40q9bndh8.js";function pe({onFileChange:s,className:c,message:k,mimeTypes:u}){const v=W(),i=k??v.formatMessage(z.helpText),n=j=>{if(j.length>0){const b=j[0];u&&u.includes(b.type)&&s(b)}},{open:M,getRootProps:g,getInputProps:N,isDragActive:d}=de({disabled:!1,noClick:!0,onDropAccepted:n,onDropRejected:()=>null,multiple:!1,maxSize:ee,...V(u)});return e.jsxs("div",{className:K("flex flex-col content-center justify-center gap-3 rounded-xl border border-dashed px-6 py-16 text-center",d?"border-green-600 bg-green-600/10":"border-token-border-medium",c),...g(),children:[e.jsx("input",{...N()}),e.jsx("div",{className:"text-center dark:text-white",children:e.jsx("div",{className:"inline-block",children:e.jsx(ae,{})})}),e.jsx("div",{className:"text-center text-sm",children:i}),e.jsx("div",{className:"cursor-pointer text-center text-sm font-bold text-green-600",onClick:()=>{M()},children:v.formatMessage(z.openFilePicker)})]})}const z=L({helpText:{id:"FileUploadBox.helpText",defaultMessage:"Drop file here to upload"},openFilePicker:{id:"FileUploadBox.openFilePicker",defaultMessage:"Browse files"}});function ue(s){const c=G(),k=W(),u=_();return J({mutationFn:({name:v,profilePictureId:i,profilePictureUrl:n})=>Y.safePatch("/accounts/{account_id}",{parameters:{path:{account_id:s}},requestBody:{name:v,profile_picture_id:i??"",profile_picture_url:n??""}}).catch(M=>{u.danger(k.formatMessage(l.saveError,{error:M.message}))}),onSuccess:()=>{c.invalidateQueries({queryKey:["account-status"]})}})}function ge({workspace:s}){const[c,k]=x.useState(s?.name??""),[u,v]=x.useState(!1);!u&&s&&(v(!0),c==""&&k(s?.name??""));const[i,n]=x.useState(s.profilePictureUrl),[M,g]=x.useState(s.profilePictureId),N=se(A.WorkspaceAppearance),d=W(),j=_(),b=()=>y.closeModal(A.WorkspaceAppearance),[t,m]=x.useState(void 0);async function T(r){const w=await ce(r,B.workspaceAvatarPreview*2),S=ie(w);m({tempId:S,file:w,status:h.Uploading,progress:1,fileId:null,cdnUrl:null}),ne(S,w,d,j,X.ProfilePicture,{onFileCreated(f,p,o){m(a=>a!=="initial"&&a?.tempId===f&&a.status===h.Uploading?{...a,progress:10,fileId:p,cdnUrl:o}:a)},onFileUploadProgress(f,p){m(o=>o!=="initial"&&o?.tempId===f&&o.status===h.Uploading?{...o,progress:p}:o)},onFileUploaded(f,p,o){m(a=>a!=="initial"&&a&&a.cdnUrl&&a.tempId===f?($.getFileDownloadLink(a.fileId).then(C=>{C.status===H.Success&&(g(a.fileId),n(C.download_url))}),{...a,status:h.Ready,progress:100,fileSpec:{name:a.file.name,id:a.fileId,size:a.file.size,...o??{}}}):a)},onError(f){m(p=>{if(p!=="initial"&&p?.tempId===f){g(void 0),n(void 0),P(null);return}return p})}})}const D=ue(s.id),F=e.jsx(R.Button,{color:"primary",disabled:t!=="initial"&&t!==void 0&&t.status!==h.Ready||t!=="initial"&&t!==void 0&&t.status===h.Ready&&!i||D.isPending||c.trim().length===0,onClick:async()=>{D.mutate({name:c,profilePictureId:M,profilePictureUrl:i}),y.closeModal(A.WorkspaceAppearance)},title:d.formatMessage(l.modalSubmit)}),q=e.jsx(R.Button,{onClick:()=>{m(void 0),g(s.profilePictureId),n(s.profilePictureUrl),y.closeModal(A.WorkspaceAppearance)},title:d.formatMessage(l.modalCancel)}),[I,P]=x.useState(null);x.useEffect(()=>{if(t!=="initial"&&t!=null&&I==null){const r=new FileReader;r.addEventListener("load",()=>{const w=r.result;typeof w=="string"&&P(w)}),r.readAsDataURL(t.file)}},[t,I]);const O=()=>{g(null),n(null),m(void 0),P(null)};return e.jsxs(Q,{testId:"modal-workspace-appearance",isOpen:N,onClose:b,showCloseButton:!0,primaryButton:F,secondaryButton:q,type:"danger",title:d.formatMessage(l.modalTitle),children:[e.jsxs("div",{className:"mb-4 flex-wrap",children:[e.jsx("label",{htmlFor:"workspace-name",className:"text-token-text-primary block pb-1 font-semibold",children:e.jsx(U,{...l.workspaceName})}),e.jsx("p",{className:"font-base text-token-text-secondary text-sm",children:e.jsx(U,{...l.workspaceNameDescription})})]}),e.jsx("div",{className:"mb-4",children:e.jsx(te,{ariaLabel:!1,type:"text",name:"workspace-name",value:c,onChange:r=>k(r.target.value),maxLength:64})}),e.jsxs("div",{className:"mb-4 flex-wrap",children:[e.jsx("label",{htmlFor:"workspace-avatar",className:"text-token-text-primary block pb-1 font-semibold",children:e.jsx(U,{...l.workspaceAvatar})}),e.jsx("p",{className:"font-base text-token-text-secondary text-sm",children:d.formatMessage(l.workspaceAvatarDescription,{size:B.workspaceAvatarPreview*2})})]}),e.jsxs("div",{className:"mb-4 flex-wrap text-center",children:[i?e.jsxs("div",{className:"relative mb-3 inline-flex",children:[e.jsx(E,{src:i,size:"workspaceAvatarPreview"}),e.jsx("div",{className:"absolute -end-1 -top-1",children:e.jsx(me,{onClick:O})})]}):t!=null&&t!=="initial"&&I?e.jsx("div",{className:"flex flex-col justify-center text-center",children:e.jsxs("div",{className:"relative mb-3 text-center",children:[e.jsx(E,{src:URL.createObjectURL(t.file),size:"workspaceAvatarPreview"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-white",children:e.jsx(re,{percentage:t.progress,className:"h-6 w-6"})})]})}):e.jsx(pe,{onFileChange:r=>{T(r)},mimeTypes:oe}),e.jsx(le,{className:"mt-3",children:d.formatMessage(l.propagationWarning)})]})]})}function me({onClick:s}){return e.jsx("div",{className:"flex h-6 w-6 cursor-pointer flex-row flex-wrap content-center justify-center rounded-full border-2 border-white bg-black text-white",onClick:s,children:e.jsx(Z,{className:"h-3 w-3"})})}const l=L({modalTitle:{id:"workspaceAppearanceModal.title",defaultMessage:"Workspace appearance"},modalSubmit:{id:"workspaceAppearanceModal.submit",defaultMessage:"Save"},modalCancel:{id:"workspaceAppearanceModal.cancel",defaultMessage:"Cancel"},workspaceName:{id:"workspaceAppearanceModal.workspaceName",defaultMessage:"Workspace name"},workspaceNameDescription:{id:"workspaceAppearanceModal.workspaceNameDescription",defaultMessage:"Update the name of the workspace."},workspaceAvatar:{id:"workspaceAppearanceModal.workspaceAvatar",defaultMessage:"Workspace image"},workspaceAvatarDescription:{id:"workspaceAppearanceModal.workspaceAvatarDescription",defaultMessage:"Upload a JPEG or PNG workspace image for your team. (Minimum {size}Ã—{size}px recommended.)"},propagationWarning:{id:"workspaceAppearanceModal.propagationWarning",defaultMessage:"Changes to the workspace name and image may take some time to take effect."},saveError:{id:"workspaceAppearanceModal.saveError",defaultMessage:"Failed to save workspace appearance"}});export{ge as W,l as m,ue as u};
//# sourceMappingURL=o45h287n9hcy4q5i.js.map
