import{r as l,ai as B,p as q,f as K,j as n,a6 as Y,a5 as f}from"./n3epq09dut36rmi2.js";import{li as X,lj as $,lk as D,ll as J,C as x,lm as Q,ln as Z,lo as ee,lp as te,lq as se,lr as ae,ls as oe,jI as ne,lt as ie,lu as re,lv as ce,lw as R,lx as O,jG as de,u as le,ly as N,U as M,lz as W,lA as ue,lB as me,hC as pe,lC as he}from"./uox23aig6gp6se2y.js";import{gW as S,aH as j,af as k,ag as T,cT as ge,dI as fe,g9 as xe,e6 as ve,dR as Ce,gP as we,ge as Te}from"./nqrmgk5te3uzwsyz.js";import{u as Ie,L as be}from"./ets1agouwvjdf3pn.js";import{T as ye}from"./lbge85qd7znz0laj.js";import{g as Se}from"./btagl6w1gub4aw61.js";import"./jy1u8exw8iz2slve.js";import"./gbfmb6n7vmtt0mld.js";import"./izzltcwrbklvvt51.js";import"./lplxjn5phekt2gia.js";import"./np05s3lkl6u1coe1.js";import"./kph6x8ukuagieza9.js";import"./gy64pge8qevmvg7e.js";import"./juhgpsl7u72fbr55.js";import"./e4sjbad9hyqt73xe.js";import"./dkr8jkx9n88ez7ho.js";import"./nnldvg4yjd3ynnqu.js";import"./gexkii4rc9qoeezs.js";import"./o1zu0t2rzad6c81z.js";import"./lz1vmotuvwwmb129.js";import"./iwi9e9tak1je4ys9.js";import"./dss9cgi0qcblcwju.js";import"./ms88w7omyr5fyl5m.js";import"./bk8slwxjkdlmxjxm.js";import"./hywf39bgiuru57vx.js";import"./dplssc7283prca44.js";import"./gfex7240qlmgxew5.js";import"./jsnptf63edu6k32a.js";import"./dnyjnsewv99rujtf.js";import"./h446s733avqwi4v2.js";import"./hk3emygtpn0flzgl.js";import"./nm5ivxaismwgb6gf.js";import"./jit20xrzecwhc2dk.js";import"./hi5bz78ars1jrvhf.js";import"./xdtirbwvvk4sqc30.js";const F="oai/apps/canmoreSidebarWidth",Ee=.25,Ae=400,L=400;function P(e){return e-Ae}function b(e,s){return B(L,P(e),s??Ee*e)}function _e(){const e=S.useState(S.selectWindowWidth),s=b(e,X(j.DANGER_SECRET_FOLDERS_ONLY_getItem(F))),a=z(),[t,r]=l.useState(s);l.useEffect(()=>{(t<L||t>P(e))&&r(b(e,t))},[e]);function o(c){r(v=>b(e,v+=c.delta.x))}function i(c){r(c),j.DANGER_SECRET_FOLDERS_ONLY_setItem(F,c)}function u(){const c=b(e,void 0);i(c)}const p=`calc(100vw - ${t}px)`;return a?{chatWidth:t,canvasWidth:e-t,canvasWidthCalc:p,viewportWidth:e,handleDrag:o,handleDoubleClick:u,persist:i}:{chatWidth:0,canvasWidth:e,canvasWidthCalc:"100vw",viewportWidth:e,handleDrag:()=>{},handleDoubleClick:()=>{},persist:()=>{}}}function z(e){const s=S.useState(S.selectWindowWidth);return(e??s)>1e3}const A="sharedCanvas";function Re(){const[e,s]=q(),a=e.get(A),t=K();l.useEffect(()=>{const r=a&&$.createRemixTempTextdoc(a,t);if(!r)return;requestAnimationFrame(()=>{D(r)});const o=new URLSearchParams(e);o.delete(A),s(o);const i=new URL(window.location.href);i.searchParams.delete(A),history.replaceState(null,"",i)},[a,e,s,t])}const Ne="textdocId",Me=e=>{const a=new URLSearchParams(window.location.search).get(Ne),t=k(e,r=>T.findNode(r,({message:o})=>{const i=o.metadata?.canvas;return i?.create_source===J.HIVE&&(a?i?.textdoc_id===a:!0)})?.message.metadata?.canvas?.textdoc_id);l.useEffect(()=>{t&&requestAnimationFrame(()=>{D(t)})},[t])};function We(e,s){let a;return s?.type===x.Textdoc?s.textdocId.startsWith(Q)||(a={type:"canvas_textdoc",id:s.textdocId}):s?.type===x.Kanzi&&(a={type:"canvas_kanzi",id:s.kanziId}),Z(e,{promptMessage:{metadata:{open_in_canvas_view:a}}})}const H=({isFullScreen:e=!1,clientThreadId:s,focusedObject:a,onClose:t,isAnimating:r=!1,width:o})=>{const{setTargetedContent:i}=ee(),u=l.useRef(!1);if(l.useEffect(()=>(u.current&&i(void 0),u.current=!0,()=>{u.current=!1}),[a]),a==null)return null;switch(a.type){case x.Textdoc:return n.jsx(ye,{isFullScreen:e,onClose:t,clientThreadId:s,focusedTextdoc:a,isAnimating:r,width:o});case x.Kanzi:break;case x.ADAVisualization:return null}},je=300,Fe=e=>{switch(e?.type){case x.Textdoc:return e.textdocId;default:return null}};function De(e,s){const[a,t,r,o]=k(e,d=>[T.getRequestId(d),T.getConversationLastTurn(d),T.isMessageTurnEnded(d),T.getVariantIds(d).length>1]),i=ge(a),u=te(),[p,c]=l.useMemo(()=>{if(t&&o)return[void 0,null];if(s===!0)return[void 0,null];let d;return!r&&t&&(d=fe(t.messageGroups,h=>h.type!==xe)),Oe({groupedMessage:d,isRequestActive:i,latestTextdocId:u})},[r,t,o,s,i,u]),v=c!=null,C=Fe(c),w=se("canvas");l.useEffect(()=>{if(c&&p&&!ae()&&(w(),oe(c,p),c.type===x.Textdoc)){const{textdocId:d}=c,h=Se(d);ne(document.getElementById(h))}},[v,C])}function Oe({groupedMessage:e,isRequestActive:s,latestTextdocId:a}){switch(e?.type){case ve.Canmore:{const[t,r]=e.messages;if(!ie(t))break;const o=re(s,t,r??null),i=o.textdocId??a;if(i&&(o.function===ce.CreateTextdoc?(o.content??"").length>je||o.status===R.WAITING:o.status===R.STREAMING))return[o.messageId,{type:x.Textdoc,textdocId:i}];break}}return[void 0,null]}const y={type:"spring",bounce:.12,duration:.64},ke={type:"spring",bounce:0,duration:.58},Le=({clientThreadId:e,focusedObject:s,onClose:a})=>{const{chatWidth:t,canvasWidthCalc:r,handleDrag:o,handleDoubleClick:i,persist:u}=_e(),[p,c]=l.useState(!0),[v,C]=l.useState(!1),w=ue(({rect:m})=>m),{windowHeight:d,windowWidth:h}=Te(m=>m,{windowWidth:0,windowHeight:0});let g=w??{top:0,left:t,width:h-t,height:d},_=!1;if(w&&(g.top<0||g.top+g.height>d)){_=!0;const m={width:(h-t)*.75,height:d*.75};g={top:d/2-m.height/2,left:(h-t-m.width)/2+t,width:m.width,height:m.height}}const I=w?.borderRadius,E=me(),U=E?.history!=null||E?.showChangesAtVersion!=null,V=pe();return n.jsxs(n.Fragment,{children:[U&&n.jsx(be,{onClick:()=>he(E.textdocId),zIndexKey:"chatOverlay"}),n.jsxs(f.div,{initial:{marginRight:V?-260:0},animate:{marginRight:0},transition:ke,children:[n.jsx(f.div,{initial:{opacity:1},animate:{opacity:0},exit:{opacity:[1,0]},transition:{...y,delay:.22},className:"bg-token-main-surface-primary pointer-events-none absolute start-0 top-0 z-20 h-full w-full"}),n.jsx(f.div,{className:"relative z-20 h-full",style:{width:r},exit:{width:0},transition:{type:"spring",bounce:0,duration:.1}})]}),n.jsx(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"pointer-events-none absolute start-0 top-0 z-10 h-full w-full bg-black/[0.025] dark:bg-transparent"}),n.jsx(f.div,{className:"absolute start-0 z-20 h-full overflow-hidden transition-shadow",initial:{borderRadius:I,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)",opacity:_?0:1,x:g.left,y:g.top,height:g.height,width:g.width},animate:{opacity:1,x:t,y:0,width:r,height:d,borderRadius:0,boxShadow:"0px 0px 18px rgba(0,0,0,0.075)"},exit:{scale:.64,opacity:0,filter:"blur(12px)",transition:{opacity:{duration:.14,bounce:.1}},borderRadius:I,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)"},transition:v?{duration:0}:y,onAnimationComplete:()=>c(!1),children:n.jsx(f.div,{className:"dark:border-token-border-medium h-full overflow-hidden border-s border-gray-100",initial:{borderRadius:I},animate:{borderRadius:0},exit:{borderRadius:I},transition:y,children:n.jsxs("div",{className:"h-full",children:[n.jsx(f.div,{drag:"x",className:"bg-token-text-quaternary absolute start-[-2px] z-10 h-full w-[4px] cursor-ew-resize opacity-0",whileHover:{opacity:.5},whileDrag:{opacity:.75,width:"8px",left:"-4px"},transition:{type:"tween",duration:.1},style:{x:0,y:0,transform:"translateX(0px)"},dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:{left:0,right:0,top:0,bottom:0},onPointerDown:()=>C(!0),onPointerUp:()=>C(!1),onDrag:(m,G)=>o(G),onDragEnd:()=>{C(!1),u(t)},onDoubleClick:()=>i()}),v&&n.jsx("div",{className:"absolute inset-0 z-10"}),n.jsx(H,{onClose:a,clientThreadId:e,isAnimating:p,focusedObject:s,width:h-t})]})})})]})},Pe=l.memo(Le),ze=({clientThreadId:e,focusedObject:s,onClose:a})=>n.jsx(we,{children:n.jsx(f.div,{className:"fixed inset-0 z-40 overflow-hidden shadow-xl md:border-gray-100 md:dark:border-gray-700",initial:{scale:.98},animate:{scale:1},transition:y,children:n.jsx(H,{isFullScreen:!0,clientThreadId:e,focusedObject:s,onClose:a})})}),He=({clientThreadId:e,overrideWidth:s,isAutoFocusDisabled:a=!1})=>{const t=z(s),r=Ie();De(e,a||r),Re(),Me(e);const o=le();l.useEffect(()=>{O()},[e]);const i=o&&(t?n.jsx(Pe,{clientThreadId:e,onClose:W,focusedObject:o},"canvas-sidebar"):n.jsx(ze,{clientThreadId:e,onClose:W,focusedObject:o},"canvas-modal"));l.useEffect(()=>{if(o)return N(p=>We(p,o)),()=>N(null)},[o]);const u=i!=null;return l.useEffect(()=>(M.setActiveStageSidebar(u),()=>{u&&M.setActiveStageSidebar(!1)}),[u]),n.jsx(Y,{children:i},e)},bt=e=>{const s=l.useRef(null);return n.jsx(Ce,{ref:s,onError:(a,t)=>{O(),setTimeout(()=>{s.current?.resetErrorBoundary()}),de.logError("Error boundary hit",a,{componentStack:t})},name:"canmore-focused-view",children:n.jsx(He,{...e})})};export{bt as CanvasFocusedViewManager};
//# sourceMappingURL=mc22npbigdzdjwa7.js.map
