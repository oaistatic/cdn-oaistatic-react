import{r as m,j as e,f as N,u as z,M as l,b as Q,g as te}from"./n3epq09dut36rmi2.js";import{rG as Le,rH as Ae,rI as _e,eC as se,jX as Te,rJ as Y,f as Oe,rK as Pe,lK as Ie,rL as T,cg as je,ck as ye,rM as ve,dn as We,l as b,aE as ae,f$ as ne,rN as ue,h as oe,et as q,a9 as Ue,I as Fe,rO as $,fI as Ge,aG as Re,fJ as Be,rP as qe,rQ as Ve,e as Ye,bh as ze,rR as me,rS as Qe,rT as Ze,rU as ge,rV as He,rW as xe}from"./uox23aig6gp6se2y.js";import{ao as W,k as D,W as F,c as Z,m as L,B as y,aj as E,al as Xe,g as Je,ad as $e}from"./nqrmgk5te3uzwsyz.js";import{S as Ke}from"./dplssc7283prca44.js";import{S as et}from"./lth5uuz88qwgi4it.js";import{b as O}from"./izzltcwrbklvvt51.js";import{g as tt}from"./clihwsciqsrnof4y.js";import{S as st}from"./ei7xyhs9opc6t2x1.js";import{S as ie}from"./k7u5jgad3qccdmw2.js";import{S as at}from"./oawcjxlzyn0p3s26.js";import{I as nt}from"./dudzu8p2x62xexsf.js";const ot=t=>m.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},m.createElement("circle",{cx:12,cy:12,r:7,stroke:"currentColor",strokeWidth:6})),G={isOpen:!0,type:"success",size:"custom",className:"max-w-xl",showCloseButton:!0,shouldIgnoreClickOutside:!0,hideSeparator:!0,noPadding:!0},U={...G,title:e.jsx(Le,{})},Yt={...G,title:e.jsx(Ae,{})};function we({onClose:t,footerContent:a,primaryButton:n,secondaryButton:s,pageSize:i=Te,accountId:o,connectionId:r,connectorType:c,fallbackEstimatedMaxNumUsers:d}){const u=N(),[x,f]=m.useState(""),h=W(),[_,p]=m.useState(0),w=_e(),{data:j,isLoading:v}=se(h?.getWorkspaceId(),_*i,x,i),{data:g,isLoading:C,refetch:M,error:A}=z({queryKey:["admin_connection_get_access_policy",r],queryFn:()=>b.admin_connection_get_access_policy(o,r)}),k=Math.ceil((j?.total??0)/i);_>=k&&k!==0&&p(Math.max(k-1,0));const[P,S]=m.useState(!1),[Ce,Ne]=m.useState(0),H=Ce>0||P,ce=C||v||H,X=g?.limits?.max_allowed_users??d,J=X===-1,Se=!w&&(J||(g?.allowed_users.length??0)<X);return c==="google_drive_dwd"?g==null?e.jsx(D,{...G,title:Y(c),onClose:t,testId:"modal-allowed-users-picker",children:e.jsx("div",{className:"flex min-h-64 items-center justify-center p-8",children:e.jsx(F,{})})}):e.jsx(ct,{accountId:o,connectorType:c,connectionId:r,areAllUsersAllowed:g?.allow_all_in_workspace,allowedUserIds:g?.allowed_users,onClose:t,numWorkspaceMembers:j?.total,refetch:M,primaryButton:n,secondaryButton:s,footerContent:a}):e.jsxs(D,{...G,title:Y(c),onClose:t,testId:"modal-allowed-users-picker",children:[e.jsxs("div",{className:"flex flex-col px-6 pt-4 pb-10",children:[e.jsx("div",{className:"mb-3 text-xl font-medium",children:e.jsx(l,{id:"5e46Ss",defaultMessage:"Which workspace members can use this?"})}),e.jsx("div",{className:"text-token-text-secondary mb-4",children:J?e.jsx("p",{children:e.jsx(l,{id:"Ny/DGR",defaultMessage:"You must also select yourself, these changes will be auto-saved"})}):C?e.jsx(O,{lines:1,className:"w-full"}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:e.jsx(l,{id:"Ny/DGR",defaultMessage:"You must also select yourself, these changes will be auto-saved"})}),e.jsx("p",{children:e.jsx(lt,{numSelectedUsers:g?.allowed_users.length??0,maxAllowedUsers:X})})]})}),e.jsxs("div",{className:"mb-4 flex flex-row items-center",children:[e.jsxs("div",{className:"group relative",children:[e.jsx("input",{type:"text",value:x,onChange:B=>{f(B.target.value),p(0)},disabled:!!g?.allow_all_in_workspace,placeholder:u.formatMessage({id:"RWqomV",defaultMessage:"Search"}),className:"border-token-border-default bg-token-main-surface-primary text-token-text-primary rounded-lg border border-solid ps-10"}),e.jsx("div",{className:"absolute start-2 top-0 flex h-full w-8 items-center justify-center",children:e.jsx(Oe,{className:"icon-md text-token-text-tertiary group-focus-within:text-token-text-secondary"})})]}),ce&&e.jsx(F,{className:"ms-4 h-4 w-4"})]}),A&&e.jsxs("div",{className:"my-2 flex flex-row items-center gap-2 rounded-lg bg-red-500 p-2 text-white",children:[e.jsx(Pe,{className:"icon-md inline"}),e.jsx(l,{id:"ZhxtEO",defaultMessage:"Failed to load allowed users."}),e.jsx("button",{onClick:()=>M(),className:"underline",children:e.jsx(l,{id:"y/IEAC",defaultMessage:"Try again"})})]}),e.jsx("div",{className:Z("h-[200px] max-h-[600px] overflow-y-auto px-2",g?.allow_all_in_workspace&&"opacity-50"),children:e.jsx("table",{children:e.jsx("tbody",{children:j?.items.length?j.items.map(({id:B,name:De,email:Ee})=>{const de=!!g?.allowed_users.includes(B);return e.jsx("tr",{className:"mb-2",children:e.jsx("td",{children:e.jsx(it,{controlDisabled:!de&&!Se||!!g?.allow_all_in_workspace||P,userId:B,isUserEnabled:de||!!g?.allow_all_in_workspace,accountId:o,connectionId:r,refetch:M,setNumPendingUserOperations:Ne,name:De,email:Ee})})},B)}):e.jsx("tr",{children:e.jsx("td",{children:e.jsx(l,{id:"n3uhaN",defaultMessage:"No users found"})})})})})}),k>1&&e.jsx("div",{className:"my-4",children:e.jsx(Ie,{currentPage:_,onChangeIndex:p,length:k})}),J&&e.jsx(rt,{allowAllInWorkspace:!!g?.allow_all_in_workspace,controlDisabled:ce||w&&!g?.allow_all_in_workspace,refetch:M,accountId:o,connectionId:r,setShouldBlockOtherInteractions:S})]}),e.jsx(T,{footerContent:a,primaryButton:H&&n?m.cloneElement(n,{disabled:!0,onClick:()=>{}}):n,secondaryButton:H&&s?m.cloneElement(s,{disabled:!0,onClick:()=>{}}):s})]})}function it({userId:t,controlDisabled:a,isUserEnabled:n,refetch:s,setNumPendingUserOperations:i,accountId:o,connectionId:r,name:c,email:d}){const u=N(),x=L(),[f,h]=m.useState(!1),_=async j=>{if(!a){h(!0),i(v=>v+1);try{await b.admin_connection_allow_user(o,r,j),await s()}catch{x.danger(u.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}))}finally{h(!1),i(v=>v-1)}}},p=async j=>{h(!0),i(v=>v+1);try{await b.admin_connection_disallow_user(o,r,j),await s()}catch{x.danger(u.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}))}finally{h(!1),i(v=>v-1)}},w=e.jsxs("p",{children:[e.jsx("span",{className:"text-token-text-primary",children:c}),e.jsx("span",{className:"text-token-text-tertiary ms-2",children:d})]});return e.jsx(ke,{isLoading:f,id:`is-user-enabled--${t}`,disabled:a,checked:n,onChange:j=>{a||f||(j.currentTarget.checked?_(t):p(t))},label:w})}function rt({allowAllInWorkspace:t,controlDisabled:a=!1,accountId:n,connectionId:s,refetch:i,setShouldBlockOtherInteractions:o}){const r=N(),c=L(),[d,u]=m.useState(!1),x=async f=>{if(!a){u(!0),o(!0);try{await b.admin_connection_update_access_policy(n,s,f),await i()}catch{await i(),c.danger(r.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}))}finally{u(!1),o(!1)}}};return e.jsx(ke,{isLoading:d,id:"enabled-for-everyone-checkbox",checked:t,disabled:a,onChange:f=>{a||x(f.currentTarget.checked)},label:e.jsx("span",{className:"text-token-text-primary ms-2",children:e.jsx(l,{id:"MsFKpF",defaultMessage:"Enable for everyone"})})})}function ke({isLoading:t,...a}){return t?e.jsxs("div",{className:"form-check flex items-center gap-2",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsx("div",{className:"form-check-label text-token-text-primary",children:a.label})]}):e.jsx(We,{...a})}function lt({maxAllowedUsers:t,numSelectedUsers:a}){return a>=t?e.jsx(l,{id:"JWJ5gc",defaultMessage:`{numSelectedUsers, plural,
          =0 {No users}
          one {# user}
          other {# users}
        } selected. You cannot select any more.`,values:{numSelectedUsers:a}}):a>0?e.jsx(l,{id:"dYtUgP",defaultMessage:`{numSelectedUsers, plural,
          =0 {No users}
          one {# user}
          other {# users}
        } selected. You can select up to {remainingAllowedUsers} more.`,values:{numSelectedUsers:a,remainingAllowedUsers:t-a}}):e.jsx(l,{id:"nVfqBL",defaultMessage:`Select up to {maxAllowedUsers, plural,
          =0 {No users}
          one {# user}
          other {# users}
        }.`,values:{maxAllowedUsers:t}})}function ct({connectionId:t,connectorType:a,accountId:n,onClose:s,refetch:i,numWorkspaceMembers:o,areAllUsersAllowed:r,allowedUserIds:c,primaryButton:d,secondaryButton:u,footerContent:x}){const f=N(),[h,_]=m.useState(r?"allow_all":"allow_admins"),[p,w]=m.useState(!1),j=L(),{data:v}=se(n,0,void 0,100,void 0,["account-owner","account-admin"]),g=v?.items,C=async()=>{if(!g?.length||p)return;r!==!1&&await b.admin_connection_update_access_policy(n,t,!1);const k=new Set(g.map(S=>S.id));await Promise.all(g.map(S=>b.admin_connection_allow_user(n,t,S.id)));const P=(c??[]).filter(S=>!k.has(S));await Promise.all(P.map(S=>b.admin_connection_disallow_user(n,t,S)))},M=async()=>{p||r||await b.admin_connection_update_access_policy(n,t,!0)},A=async()=>{w(!0);try{await(h==="allow_admins"?C():M()),await i()}catch{j.danger(f.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}))}finally{w(!1)}};return e.jsxs(D,{...G,title:Y(a),onClose:s,testId:"modal-dwd-allowed-users-picker",children:[e.jsx("div",{className:"px-6 py-4 text-xl font-medium",children:e.jsx(l,{id:"5e46Ss",defaultMessage:"Which workspace members can use this?"})}),e.jsxs(je,{value:h,onValueChange:k=>_(k),className:"flex w-full flex-col gap-2 px-6 py-4",children:[e.jsx(fe,{optionValue:"allow_all",Icon:Ke,optionName:f.formatMessage({id:"vtytpk",defaultMessage:"Everyone"}),subtitle:o!=null?f.formatMessage({id:"15cHOa",defaultMessage:"{count} members"},{count:o}):e.jsx(O,{lines:1}),isSelected:h==="allow_all"}),e.jsx("div",{className:"border-token-border-default border-t"}),e.jsx(fe,{optionValue:"allow_admins",Icon:et,subtitle:g!=null?g.length>3?f.formatList([...g.slice(3).map(k=>k.name??k.email),f.formatMessage({id:"zb4UOk",defaultMessage:"{count} more"},{count:g.length-3})]):f.formatList(g.map(k=>k.name??k.email)):e.jsx(O,{lines:1}),optionName:f.formatMessage({id:"l0D/jy",defaultMessage:"Admins only"}),isSelected:h==="allow_admins"})]}),e.jsx(T,{footerContent:x,primaryButton:d?m.cloneElement(d,{disabled:p,loading:p,onClick:async k=>{await A(),d.props.onClick?.(k)}}):e.jsx(y,{color:"primary",onClick:A,loading:p,disabled:p,children:e.jsx(l,{id:"+itf/D",defaultMessage:"Save"})}),secondaryButton:p&&u?m.cloneElement(u,{disabled:!0,onClick:()=>{}}):u})]})}function fe({optionName:t,optionValue:a,subtitle:n,Icon:s,isSelected:i,disabled:o}){const r=i?ot:ve;return e.jsxs(ye,{value:a,id:`dwd-allowed-users-option-${a}`,className:Z("flex w-full items-center justify-start gap-4",o&&"opacity-50"),disabled:o,children:[e.jsx("div",{className:"bg-token-bg-tertiary flex h-[40px] w-[40px] items-center justify-center rounded-xl",children:e.jsx(s,{className:"icon-lg"})}),e.jsxs("div",{className:"grow",children:[e.jsx("div",{className:"text-token-text-primary text-start",children:t}),e.jsx("div",{className:"text-token-text-secondary mt-1 text-start text-sm text-wrap",children:n})]}),e.jsx(r,{className:"icon-lg shrink-0"})]})}const re=m.createContext({triggerLocation:"admin_settings"});re.Provider;const R=()=>{const t=m.useContext(re);if(!t)throw new Error("useTriggerLocation must be used within a TriggerLocationProvider");return t};function dt({accountId:t,connectionId:a,onClose:n,onNext:s,secondaryButton:i,footerContent:o}){const r=N(),c=L(),d=m.useId(),[u,x]=m.useState(""),[f,h]=m.useState(null),[_,p]=m.useState(!1),{triggerLocation:w}=R(),{isLoading:j,refetch:v,data:g}=z({queryKey:["admin:connection_instance",a],queryFn:async()=>await b.admin_get_connection_instance(t,a)});m.useEffect(()=>{g?.connection_config.knowledge_connector_type==="google_drive_dwd"&&x(g.connection_config.admin_email_address??"")},[g]);const C=g?.connection_config.knowledge_connector_type==="google_drive_dwd"?g.connection_config.service_account_credential_id:void 0,M=u.trim().length>0&&(!!f||C),A=async()=>{if(!(!M||!t||_)){p(!0);try{let k;f&&(k=await f.text()),await b.admin_connection_update_credential(t,a,{admin_email:u,new_service_credential_content:k,credential_id:C&&!k?C:void 0}),c.success(r.formatMessage({id:"q/AX/d",defaultMessage:"Credentials successfully updated."})),s()}catch(k){let P=r.formatMessage({id:"qbD4Az",defaultMessage:"Failed to update credentials."});const S=tt(k);S&&(P=r.formatMessage({id:"pzfjhv",defaultMessage:"Failed to update credentials: {error}"},{error:S.message})),E.logEventWithStatsig("Contextual Answers Admin Connection Config Change Error","chatgpt_contextual_answers_admin_connection_config_change_error",{connectorType:"google_drive_dwd",error:S?.error_type,triggerLocation:w}),c.danger(P)}finally{v(),p(!1)}}};return e.jsx(D,{...U,onClose:n,testId:"modal-gdrive-dwd-credentials",children:j?e.jsx(O,{lines:4,className:"px-6 pt-4 pb-10"}):e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:k=>{k.preventDefault(),M&&A()},className:"flex flex-col px-6 pt-4 pb-10",children:[e.jsx("button",{type:"submit",className:"display-none"}),e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xl font-medium",children:e.jsx(l,{id:"qq+Txa",defaultMessage:"Setup a new connection"})}),e.jsx("div",{className:"text-token-text-secondary mt-2",children:e.jsx(l,{id:"xlzWm6",defaultMessage:"To setup an Admin-managed connection, follow the steps linked below, then enter the key from Google. {readMoreLink}",values:{readMoreLink:e.jsx(ae,{href:ue,className:"underline",onClick:()=>ne({link:ue,location:"admin_onboarding_dwd_credentials"}),children:e.jsx(l,{id:"wVvI34",defaultMessage:"Read setup instructions"})})}})})]}),e.jsx(ut,{existingServiceKeyId:C,serviceKeyFile:f,setServiceKeyFile:h}),e.jsxs("div",{className:"mb-2 flex flex-col gap-2",children:[e.jsx("label",{htmlFor:d,className:"text-base font-medium",children:e.jsx(l,{id:"sPqjJA",defaultMessage:"Google Workspace admin email address"})}),e.jsx("input",{type:"text",value:u,onChange:k=>x(k.target.value),placeholder:r.formatMessage({id:"+zP1RE",defaultMessage:"admin@example.com"}),id:d,className:"border-token-border-default bg-token-main-surface-primary text-token-text-primary rounded-lg border border-solid"}),e.jsx("p",{className:"text-token-text-secondary text-sm",children:e.jsx(l,{id:"Y8w9Sz",defaultMessage:"We require a Google Workspace admin user's email to perform administrative actions like listing users and discovering Shared Drives with the provided service account key."})})]})]})]}),e.jsx(T,{primaryButton:e.jsx(y,{loading:_,color:"primary",disabled:!M||_,onClick:A,children:e.jsx(l,{id:"+itf/D",defaultMessage:"Save"})}),secondaryButton:i,footerContent:o})]})})}function ut({existingServiceKeyId:t,serviceKeyFile:a,setServiceKeyFile:n}){const s=m.useRef(null),i=m.useId();return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("p",{className:"text-base font-medium",children:e.jsx(l,{id:"gI0O53",defaultMessage:"Service account key"})}),!!t&&!a&&e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[e.jsx(oe,{className:"icon-sm"}),e.jsx(l,{id:"B+/4/L",defaultMessage:"Service account key already exists."})]}),!!a&&e.jsx("p",{className:"text-token-text-secondary",children:a.name}),e.jsxs("div",{className:"flex flex-row gap-2",children:[!t&&!a&&e.jsx(y,{color:"primary",type:"button",onClick:()=>s.current?.click(),children:e.jsx(l,{id:"4GjErm",defaultMessage:"Upload key"})}),(!!t&&!a||!t&&!!a)&&e.jsx(y,{color:"secondary",type:"button",onClick:()=>s.current?.click(),children:e.jsx(l,{id:"qV3zuG",defaultMessage:"Replace key"})}),!!t&&!!a&&e.jsx(y,{color:"danger-outline",type:"button",onClick:()=>n(null),children:e.jsx(l,{id:"NFpNok",defaultMessage:"Clear"})})]}),e.jsx("input",{type:"file",className:"hidden",id:i,ref:s,onChange:o=>{o.target.files&&o.target.files.length>0?n(o.target.files[0]):n(null)},accept:".json"})]})}function zt({isOpen:t,onClose:a,objectType:n,connectionId:s,accountId:i}){const[o,r]=m.useState(null),[c,d]=m.useState([]),[u,x]=m.useState(!1),[f,h]=m.useState(!1),_=N(),p=async v=>{x(!0),h(!1);try{const g=await b.admin_connection_list_item_scopes(i,s,n,v);r(g.page_token??null),d(C=>[...C,...g.object_selections.map(M=>M.object_handle)])}catch{h(!0)}finally{x(!1)}},w=async()=>{r(null),x(!1),d([]),h(!1),p(null)},j=m.useRef(!1);return m.useEffect(()=>{j.current||(j.current=!0,w())},[]),e.jsx(D,{testId:"modal-connection-blocked-items",isOpen:t,onClose:a,type:"success",size:"custom",className:"max-w-xl",showCloseButton:!0,title:_.formatMessage({id:"BVUVRc",defaultMessage:"Block items"}),children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("p",{className:"text-token-text-secondary text-sm",children:e.jsx(l,{id:"LYXIh1",defaultMessage:"Found something that shouldn't be synced? You can block items here to prevent them from being synced or shown in search results."})}),e.jsx(xt,{connectionId:s,accountId:i,onItemBlocked:w,objectType:n}),e.jsx(mt,{connectionId:s,accountId:i,isLoading:u,hasError:f,hasMoreItems:o!=null,loadMoreItems:()=>p(o),objectType:n,objectHandles:c,onItemUnblocked:w})]})})}function mt({connectionId:t,accountId:a,objectHandles:n,isLoading:s,hasError:i,hasMoreItems:o,loadMoreItems:r,onItemUnblocked:c,objectType:d}){return e.jsxs("div",{children:[e.jsx("h3",{className:"mb-2 font-medium",children:e.jsx(l,{id:"gimLZo",defaultMessage:"Currently blocked items"})}),i?e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx("div",{className:"text-token-text-error",children:e.jsx(l,{id:"3BZzpX",defaultMessage:"Something went wrong"})}),e.jsx("div",{children:e.jsx(y,{color:"secondary",icon:ie,onClick:r,children:e.jsx(l,{id:"fFd9RR",defaultMessage:"Try again"})})})]}):e.jsxs(e.Fragment,{children:[n.length>0||s?e.jsx("ul",{className:"flex flex-col gap-1",children:n.map(u=>e.jsx(gt,{connectionId:t,accountId:a,objectType:d,objectHandle:u,onItemUnblocked:c},u))}):e.jsx("p",{className:"text-token-text-secondary text-sm",children:e.jsx(l,{id:"IGg+fh",defaultMessage:"No items are currently being blocked."})}),s?e.jsx(O,{lines:1}):o&&e.jsx(y,{color:"ghost",icon:st,onClick:r,children:e.jsx(l,{id:"g+Tw+y",defaultMessage:"See more"})})]})]})}function gt({connectionId:t,accountId:a,objectHandle:n,onItemUnblocked:s,objectType:i}){const o=L(),r=N();return e.jsx(K,{scopeChangeIcon:$,scopeChangeLabel:r.formatMessage({id:"yaj/om",defaultMessage:"Unblock item"}),scopeChangeTarget:"include",objectHandle:n,objectType:i,onError:()=>{o.danger(r.formatMessage({id:"yRm6yX",defaultMessage:"Failed to unblock item. Please try again later."}))},onScopeUpdated:()=>{o.success(r.formatMessage({id:"Xot/uQ",defaultMessage:"Item successfully unblocked."})),s()},connectionId:t,accountId:a})}function K({connectionId:t,accountId:a,objectType:n,objectHandle:s,scopeChangeTarget:i,scopeChangeLabel:o,scopeChangeIcon:r,onScopeUpdated:c,onError:d}){const[u,x]=m.useState(!1),{isPending:f,mutate:h}=Q({mutationFn:async()=>i==="exclude"?await b.admin_connection_block_items(a,t,n,[s]):await b.admin_connection_unblock_items(a,t,n,[s]),mutationKey:["admin_connection_update_item_scope",t,n,i,s],onSuccess:()=>{c(),x(!1)},onError:()=>{x(!1),d()}});return e.jsxs("li",{className:"group hover:bg-token-surface-hover flex w-full flex-row rounded-xl px-4 py-1 text-sm",children:[e.jsx("span",{className:"flex-1",children:s}),e.jsxs(q.Root,{open:u||f,onOpenChange:x,children:[e.jsx(q.Trigger,{className:Z("h-6 flex-0 group-hover:visible",!u&&"invisible"),children:e.jsx(Ue,{className:"icon-sm"})}),e.jsx(q.Portal,{children:e.jsx(q.Content,{size:"small",children:e.jsx(q.Item,{icon:f?F:r,onSelect:()=>h(),disabled:f,children:o})})})]})]})}function xt({accountId:t,connectionId:a,onItemBlocked:n,objectType:s}){const i=L(),o=N();return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"font-medium",children:e.jsx(l,{id:"dU+IPT",defaultMessage:"Block an item"})}),e.jsx("p",{className:"text-token-text-secondary text-sm",children:e.jsx(l,{id:"y6yn/t",defaultMessage:"Enter the ID or URL of the item you want to block."})}),e.jsx(ee,{accountId:t,connectionId:a,objectType:s,onSuccess:()=>{i.success(o.formatMessage({id:"Q+KnAh",defaultMessage:"Item successfully blocked."})),n()},onError:()=>{i.danger(o.formatMessage({id:"UH92LU",defaultMessage:"Failed to block item. Please try again later."}))},targetScopeSelection:"exclude",buttonLabel:e.jsx(l,{id:"5FIVI9",defaultMessage:"Block"})})]})}function ee({accountId:t,connectionId:a,objectType:n,onSuccess:s,onError:i,placeholder:o,targetScopeSelection:r,buttonLabel:c}){const d=N(),[u,x]=m.useState(""),{isPending:f,mutate:h}=Q({mutationFn:async()=>{if(u.trim())return r==="exclude"?await b.admin_connection_block_items(t,a,n,[u]):await b.admin_connection_unblock_items(t,a,n,[u])},mutationKey:["admin_connection_update_item_scope",a,n,r,u],onSuccess:()=>{s(),x("")},onError:i});return e.jsx("form",{onSubmit:_=>{_.preventDefault(),u.trim()&&h()},children:e.jsxs("div",{className:"flex w-full flex-row gap-2",children:[e.jsx(Fe,{type:"text",className:"flex-1",name:"objectHandle",ariaLabel:"object handle",value:u,onChange:_=>x(_.target.value),placeholder:o??d.formatMessage({id:"sPUyj/",defaultMessage:"ID or URL"}),disabled:f}),e.jsx(y,{color:"primary",type:"button",onClick:()=>h(),loading:f,disabled:f||!u.trim(),className:"flex-0",children:c})]})})}function ft({isOpen:t,onClose:a,connectionId:n,accountId:s,primaryButton:i,secondaryButton:o,footerContent:r}){const{refetch:c,data:d,error:u,isLoading:x}=z({queryFn:()=>pt({accountId:s,connectionId:n}),queryKey:["admin_connection_list_item_scopes",n,"shared_drive"]});return e.jsxs(D,{...U,isOpen:t,onClose:a,testId:"modal-gdrive-dwd-shared-drive-picker",children:[e.jsx("div",{className:"flex flex-col gap-6 px-6 pt-4 pb-10",children:x?e.jsx(O,{lines:4}):u?e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx("div",{className:"text-token-text-error",children:e.jsx(l,{id:"3BZzpX",defaultMessage:"Something went wrong"})}),e.jsx("div",{children:e.jsx(y,{color:"secondary",icon:ie,onClick:()=>c(),children:e.jsx(l,{id:"fFd9RR",defaultMessage:"Try again"})})})]}):e.jsx(e.Fragment,{children:d&&e.jsx(ht,{accountId:s,connectionId:n,sharedDriveDefaultScope:d.default_selection,sharedDriveScopes:d.object_selections,refetch:c})})}),e.jsx(T,{primaryButton:i,secondaryButton:o,footerContent:r})]})}function ht({refetch:t,accountId:a,connectionId:n,sharedDriveDefaultScope:s,sharedDriveScopes:i}){const o=N(),r=L(),{isPending:c,mutate:d}=Q({mutationFn:async u=>await b.admin_connection_update_item_default_scope(a,n,"shared_drive",u),mutationKey:["admin_connection_update_item_default_scope",n,"shared_drive"],onError:()=>{r.danger(o.formatMessage({id:"YnlDV7",defaultMessage:"Failed to update policy."}))},onSettled:()=>{t()}});return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"text-xl font-medium",children:e.jsx(l,{id:"CIWfUm",defaultMessage:"How do you want to handle Shared Drives?"})}),e.jsx("div",{className:"text-token-text-secondary text-sm",children:e.jsx(l,{id:"BXG6kp",defaultMessage:"Add any Shared Drives youâ€™d like to exclude or include by default."})}),e.jsx(at,{ariaLabel:{id:"ca.scope-selector.aria-label",defaultMessage:"Select whether Shared drives are included or exlcuded from syncing by default.",description:"@nocommit"},onChange:u=>{c||d(u)},value:s,leftItem:{ariaLabel:V.includeToggleLabel,label:V.includeToggleLabel,value:"include"},rightItem:{ariaLabel:V.excludeToggleLabel,label:V.excludeToggleLabel,value:"exclude"}}),c?e.jsx(O,{lines:3}):s==="include"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-token-text-secondary text-sm",children:e.jsx(l,{id:"dmDuO6",defaultMessage:"All Shared drives will be synced except for ones you choose to exclude."})}),e.jsx("p",{className:"text-token-text-secondary font-medium",children:e.jsx(l,{id:"buyi/M",defaultMessage:"Excluded Shared drives"})}),e.jsx("ul",{children:i.filter(u=>u.selection==="exclude").map(u=>e.jsx(K,{objectHandle:u.object_handle,objectType:"shared_drive",accountId:a,connectionId:n,scopeChangeIcon:$,scopeChangeLabel:o.formatMessage({id:"NLi7nF",defaultMessage:"Remove exclusion"}),scopeChangeTarget:"include",onError:()=>{r.danger(o.formatMessage({id:"tdBT+A",defaultMessage:"Failed to remove exclusion. Please try again later."}))},onScopeUpdated:()=>{r.success(o.formatMessage({id:"AC/4a7",defaultMessage:"Sucessfully removed exclusion."})),t()}},u.object_handle))}),e.jsx(ee,{objectType:"shared_drive",targetScopeSelection:"exclude",accountId:a,connectionId:n,buttonLabel:o.formatMessage({id:"ThGxVh",defaultMessage:"Exclude"}),onSuccess:()=>{r.success(o.formatMessage({id:"1hsj8s",defaultMessage:"Shared drive has been excluded."})),t()},onError:()=>{r.danger(o.formatMessage({id:"4JkX1y",defaultMessage:"Failed to exclude Shared drive. Please try again later."}))}})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-token-text-secondary text-sm",children:e.jsx(l,{id:"Pa+iyD",defaultMessage:"Only the Shared drives you select will be synced."})}),e.jsx("p",{className:"text-token-text-secondary font-medium",children:e.jsx(l,{id:"e4EV27",defaultMessage:"Included Shared drives"})}),e.jsx("ul",{children:i.filter(u=>u.selection==="include").map(u=>e.jsx(K,{objectHandle:u.object_handle,objectType:"shared_drive",accountId:a,connectionId:n,scopeChangeIcon:$,scopeChangeLabel:o.formatMessage({id:"/oSk2L",defaultMessage:"Remove inclusion"}),scopeChangeTarget:"exclude",onError:()=>{r.danger(o.formatMessage({id:"JhaVH0",defaultMessage:"Failed to remove inclusion. Please try again later."}))},onScopeUpdated:()=>{r.success(o.formatMessage({id:"m6h3gf",defaultMessage:"Sucessfully removed inclusion."})),t()}},u.object_handle))}),e.jsx(ee,{objectType:"shared_drive",targetScopeSelection:"include",accountId:a,connectionId:n,buttonLabel:o.formatMessage({id:"At82Iq",defaultMessage:"Include"}),onSuccess:()=>{r.success(o.formatMessage({id:"IMoGWZ",defaultMessage:"Shared drive has been included."})),t()},onError:()=>{r.danger(o.formatMessage({id:"De2z4Y",defaultMessage:"Failed to include Shared drive. Please try again later."}))}})]})]})}const V=te({includeToggleLabel:{id:"ca.scope-selection.include-by-default",defaultMessage:"Include by default"},excludeToggleLabel:{id:"ca.scope-selection.exclude-by-default",defaultMessage:"Exclude by default"},includeUserDrivesLabel:{id:"pDGrBu",defaultMessage:"Include user-owned files?"}});async function pt({accountId:t,connectionId:a}){const n=[];let s=await b.admin_connection_list_item_scopes(t,a,"shared_drive",null);for(n.push(s);s.page_token!=null;)s=await b.admin_connection_list_item_scopes(t,a,"shared_drive",s.page_token),n.push(s);return{object_type:"shared_drive",default_selection:n[0].default_selection,object_selections:n.flatMap(o=>o.object_selections)}}const _t=t=>m.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},m.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2ZM9.70711 8.29289C9.31658 7.90237 8.68342 7.90237 8.29289 8.29289C7.90237 8.68342 7.90237 9.31658 8.29289 9.70711L10.5858 12L8.29289 14.2929C7.90237 14.6834 7.90237 15.3166 8.29289 15.7071C8.68342 16.0976 9.31658 16.0976 9.70711 15.7071L12 13.4142L14.2929 15.7071C14.6834 16.0976 15.3166 16.0976 15.7071 15.7071C16.0976 15.3166 16.0976 14.6834 15.7071 14.2929L13.4142 12L15.7071 9.70711C16.0976 9.31658 16.0976 8.68342 15.7071 8.29289C15.3166 7.90237 14.6834 7.90237 14.2929 8.29289L12 10.5858L9.70711 8.29289Z",fill:"currentColor"}));function jt({isOpen:t,onClose:a,connectionId:n,accountId:s,isPostActivation:i,footerContent:o,primaryButton:r,secondaryButton:c}){const d=N(),u=L(),{refetch:x,data:f,error:h,isLoading:_}=z({queryFn:async()=>await b.admin_connection_list_item_scopes(s,n,"user_drive"),queryKey:["admin_connection_list_item_scopes",n,"user_drive"]}),{isPending:p,mutate:w}=Q({mutationFn:async v=>await b.admin_connection_update_item_default_scope(s,n,"user_drive",v?"include":"exclude"),mutationKey:["admin_connection_update_item_default_scope",n,"user_drive"],onError:()=>{u.danger(d.formatMessage({id:"YnlDV7",defaultMessage:"Failed to update policy."}))},onSettled:()=>{x()}}),j=f?.default_selection==="include";return e.jsxs(D,{...U,isOpen:t,onClose:a,testId:"modal-gdrive-dwd-user-drives",children:[e.jsx("div",{className:"flex flex-col gap-6 px-6 pt-4 pb-10",children:_?e.jsx(O,{lines:4}):h?e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx("div",{className:"text-token-text-error",children:e.jsx(l,{id:"3BZzpX",defaultMessage:"Something went wrong"})}),e.jsx("div",{children:e.jsx(y,{color:"secondary",icon:ie,onClick:()=>x(),children:e.jsx(l,{id:"fFd9RR",defaultMessage:"Try again"})})})]}):i?e.jsx("div",{className:"group border-token-border-medium flex w-full flex-row items-center gap-4 rounded-xl border px-8 py-4",children:j?e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"icon-lg"}),e.jsx("p",{className:"grow",children:e.jsx(l,{id:"rWqZ31",defaultMessage:"User owned files in My Drives are being synced."})})]}):e.jsxs(e.Fragment,{children:[e.jsx(_t,{className:"icon-lg"}),e.jsx("p",{className:"grow",children:e.jsx(l,{id:"/dUChW",defaultMessage:"User owned files in My Drives are not being synced."})})]})}):e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"text-xl font-medium",children:e.jsx(l,{id:"K4ZFoX",defaultMessage:"How do you want to handle My Drives?"})}),e.jsx("div",{className:"text-token-text-secondary text-sm",children:e.jsx(l,{id:"kAW/VW",defaultMessage:"Choose whether you want to sync the My Drive folder for your users."})}),e.jsxs("div",{className:"group border-token-border-medium flex w-full flex-row items-center gap-4 rounded-xl border px-8 py-4",children:[e.jsx(Ge,{enabled:j,disabled:p,label:d.formatMessage(he.includeUserDrivesLabel),onChange:()=>{!p&&w(!j)}}),e.jsx("p",{children:e.jsx(l,{...he.includeUserDrivesLabel})}),p&&e.jsx(F,{}),e.jsx("div",{className:"grow"}),e.jsx(Re,{label:e.jsx("p",{children:e.jsx(l,{id:"xJvlxk",defaultMessage:"Enable this setting to sync files in users' individual My Drives."})}),children:e.jsx(Be,{className:"icon-lg text-token-text-tertiary"})})]}),e.jsxs("div",{className:"bg-token-main-surface-secondary text-token-text-primary flex w-full flex-row items-center gap-4 rounded-xl p-4",children:[e.jsx(Xe,{className:"icon-lg"}),e.jsx("span",{className:"text-token-text-secondary text-sm",children:e.jsx(l,{id:"4vN9WK",defaultMessage:"You will not be able to change whether user My Drives are included once the connection starts syncing data."})})]})]})}),e.jsx(T,{footerContent:o,primaryButton:r,secondaryButton:c})]})}const he=te({includeUserDrivesLabel:{id:"75ojp7",defaultMessage:"Include user My Drives?"}});function yt({connectionDisplayInfo:t}){return e.jsxs("span",{className:"bg-token-main-surface-secondary rounded-xl px-2 py-1 font-bold whitespace-nowrap",children:[t.icon_url&&e.jsx("img",{src:t.icon_url,alt:"",className:"icon-sm me-2 inline"}),t.display_name]})}function vt({isOpen:t,onClose:a,onActivate:n,connectionId:s,accountId:i,connectionDisplayInfo:o,footerContent:r,secondaryButton:c,connectorType:d}){const u=N(),x=L(),f=_e(),{triggerLocation:h}=R(),[_,p]=m.useState(!1),w=()=>{p(!0),b.admin_activate_connection_instance(i,s).then(()=>{E.logEventWithStatsig("Contextual Answers Admin Connection Activated","chatgpt_contextual_answers_admin_connection_activated",{connectorType:d,triggerLocation:h}),x.success(u.formatMessage({id:"y5DD0Z",defaultMessage:"Connection successfully activated."})),n?.(),a?.()}).catch(()=>{x.danger(u.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}))}).finally(()=>{p(!1)})},j=e.jsx(y,{color:"primary",loading:_,onClick:w,disabled:f,children:e.jsx(l,{id:"C2dZRO",defaultMessage:"Done"})});return e.jsxs(D,{...G,testId:"modal-review-and-activate",isOpen:t,onClose:a,title:Y(d),children:[e.jsxs("div",{className:"flex flex-col gap-3 px-6 pt-4 pb-10",children:[e.jsx("div",{className:"text-xl font-medium",children:e.jsx(l,{id:"38WXzu",defaultMessage:"Review"})}),e.jsx("p",{className:"text-token-text-secondary text-sm",children:e.jsx(l,{id:"yQhjtE",defaultMessage:"Confirm everything looks good to you, then click the button to activate the connection and start syncing. "})}),e.jsx(yt,{connectionDisplayInfo:o})]}),e.jsx(T,{primaryButton:f?e.jsx(qe,{children:j}):j,secondaryButton:c,footerContent:r})]})}function be({steps:t,onClose:a}){const n=t.length,[s,i]=m.useState(0),o=t[0]?.connectorType,r=t[0]?.name;m.useEffect(()=>{!o||!r||E.logEventWithStatsig("Contextual Answers Admin Create Connection Step","chatgpt_contextual_answers_admin_create_connection_step",{connectorType:o,stepName:r})},[o,r]);const c=d=>{i(d),!(d<0||d>=t.length)&&E.logEventWithStatsig("Contextual Answers Admin Create Connection Step","chatgpt_contextual_answers_admin_create_connection_step",{connectorType:t[d].connectorType,stepName:t[d].name})};return s<t.length?t[s].fn({goForward:s<n-1?()=>c(s+1):void 0,goBackward:s>0?()=>c(s-1):void 0,close:a,stepNumber:s,totalSteps:n}):null}const wt=-1;function Me(t){return le(t.knowledge_connector_type)}function le(t){switch(t){case void 0:return 0;case"slack":case"github":case"notion":case"google_drive_dwd":return wt;case"google_drive_oauth":return 25;case"merge_file_storage":return 10}}const Qt={max_instances:0};function kt({onClose:t,backButton:a}){const[n,s]=m.useState(),i=W();return i?n?e.jsx(Mt,{accountId:i.id,connection:n,onClose:()=>t(!0)}):e.jsx(bt,{onClose:t,backButton:a,setConnection:s}):null}function bt({onClose:t,setConnection:a,backButton:n}){const s=N(),i=L(),o=W(),r=m.useId(),{triggerLocation:c}=R();m.useEffect(()=>{E.logEventWithStatsig("Contextual Answers Admin Create Connection Step","chatgpt_contextual_answers_admin_create_connection_step",{connectorType:"google_drive_dwd",stepName:"basic_info",triggerLocation:c})},[c]);const[d,u]=m.useState(""),x=d.length>128,f=d.trim().length>0&&!x,[h,_]=m.useState(!1),p=m.useCallback(()=>{!f||!o||h||(_(!0),b.admin_create_connection_instance(o.id,{knowledge_connector_type:"google_drive_dwd",connection_config_id:"--fake-local-id"},d.trim()).then(w=>{a(w)}).catch(()=>{i.danger(s.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}))}).finally(()=>{_(!1)}))},[o,d,s,f,h,a,i]);return e.jsxs(D,{...U,onClose:()=>t?.(),testId:"modal-gdrive-dwd-basic-info",children:[e.jsxs("form",{onSubmit:w=>{w.preventDefault(),f&&p()},className:"flex flex-col px-6 pt-4 pb-10",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{htmlFor:r,className:"text-xl font-medium",children:e.jsx(l,{id:"+wLWeZ",defaultMessage:"Enter display name"})}),e.jsx("input",{type:"text",value:d,onChange:w=>u(w.target.value),id:r,className:"border-token-border-default bg-token-main-surface-primary text-token-text-primary rounded-lg border border-solid"}),e.jsx("div",{className:"text-token-text-tertiary text-sm",children:e.jsx(l,{id:"CPXVQO",defaultMessage:"This is the name your members will see in their ChatGPT connectors."})}),x?e.jsx("p",{className:"text-red-500",children:e.jsx(l,{id:"vT7EGU",defaultMessage:"Name is too long."})}):null]}),e.jsx("button",{type:"submit",className:"display-none"})]}),e.jsx(T,{secondaryButton:n,primaryButton:e.jsx(y,{color:"primary",disabled:!f||h,loading:h,onClick:p,children:e.jsx(l,{id:"lZthRm",defaultMessage:"Save Draft and Continue"})})})]})}function Mt({connection:t,accountId:a,onClose:n}){return e.jsx(be,{onClose:n,steps:[{connectorType:"google_drive_dwd",name:"credential",fn:({goForward:s,close:i,stepNumber:o,totalSteps:r})=>e.jsx(dt,{onClose:()=>i?.(),accountId:a,connectionId:t.connection_config.connection_config_id,onNext:s??(()=>null),footerContent:e.jsx("span",{className:"text-token-text-secondary flex-1 align-middle font-medium",children:e.jsx(l,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:o+1,totalSteps:r}})})})},{connectorType:"google_drive_dwd",name:"user_drives",fn:({goForward:s,goBackward:i,close:o,stepNumber:r,totalSteps:c})=>e.jsx(jt,{onClose:()=>o?.(),accountId:a,connectionId:t.connection_config.connection_config_id,primaryButton:s&&e.jsx(y,{color:"primary",onClick:s,children:e.jsx(l,{id:"z5fExR",defaultMessage:"Next"})}),secondaryButton:i&&e.jsx(y,{color:"secondary",onClick:i,children:e.jsx(l,{id:"xJnONr",defaultMessage:"Back"})}),footerContent:e.jsx("span",{className:"text-token-text-secondary flex-1 align-middle font-medium",children:e.jsx(l,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:r+1,totalSteps:c}})}),isOpen:!0,isPostActivation:!1})},{connectorType:"google_drive_dwd",name:"shared_drives",fn:({goForward:s,goBackward:i,close:o,stepNumber:r,totalSteps:c})=>e.jsx(ft,{onClose:()=>o?.(),accountId:a,connectionId:t.connection_config.connection_config_id,primaryButton:s&&e.jsx(y,{color:"primary",onClick:s,children:e.jsx(l,{id:"z5fExR",defaultMessage:"Next"})}),secondaryButton:i&&e.jsx(y,{color:"secondary",onClick:i,children:e.jsx(l,{id:"xJnONr",defaultMessage:"Back"})}),footerContent:e.jsx("span",{className:"text-token-text-secondary flex-1 align-middle font-medium",children:e.jsx(l,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:r+1,totalSteps:c}})}),isOpen:!0})},{connectorType:"google_drive_dwd",name:"allowed_users",fn:({goForward:s,goBackward:i,close:o,stepNumber:r,totalSteps:c})=>e.jsx(we,{connectorType:"google_drive_dwd",fallbackEstimatedMaxNumUsers:Me(t.connection_config),onClose:()=>o?.(),accountId:a,connectionId:t.connection_config.connection_config_id,primaryButton:s&&e.jsx(y,{color:"primary",onClick:s,children:e.jsx(l,{id:"z5fExR",defaultMessage:"Next"})}),secondaryButton:i&&e.jsx(y,{color:"secondary",onClick:i,children:e.jsx(l,{id:"xJnONr",defaultMessage:"Back"})}),footerContent:e.jsx("span",{className:"text-token-text-secondary flex-1 align-middle font-medium",children:e.jsx(l,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:r+1,totalSteps:c}})})})},{connectorType:"google_drive_dwd",name:"review_and_activate",fn:({goBackward:s,close:i,stepNumber:o,totalSteps:r})=>e.jsx(vt,{isOpen:!0,onClose:()=>i?.(),accountId:a,connectorType:"google_drive_dwd",connectionId:t.connection_config.connection_config_id,connectionDisplayInfo:t.display_info,secondaryButton:s&&e.jsx(y,{color:"secondary",onClick:s,children:e.jsx(l,{id:"xJnONr",defaultMessage:"Back"})}),footerContent:e.jsx("span",{className:"text-token-text-secondary flex-1 align-middle font-medium",children:e.jsx(l,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:o+1,totalSteps:r}})})})}]})}const Ct=({domainName:t,intl:a})=>t.trim().toLocaleLowerCase()==="gmail.com"?{valid:!1,errorType:"domainChecker.error.gmail",error:a.formatMessage({id:"domainChecker.error.gmail",defaultMessage:"Personal Google Accounts (e.g. gmail.com) are not supported"})}:{valid:!0},Nt=({domainName:t,intl:a})=>{const n=t.trim();if(/^https?:\/\//i.test(n))return{valid:!1,errorType:"domainChecker.error.noHttp",error:a.formatMessage({id:"domainChecker.error.noHttp",defaultMessage:"Do not include http:// or https:// in the domain."})};if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n))return{valid:!1,errorType:"domainChecker.error.noEmail",error:a.formatMessage({id:"domainChecker.error.noEmail",defaultMessage:"Do not use an email address. Use only the domain name."})};if(/[^a-zA-Z0-9.-]/.test(n))return{valid:!1,errorType:"domainChecker.error.invalidCharacters",error:a.formatMessage({id:"domainChecker.error.invalidCharacters",defaultMessage:"Domain contains invalid characters. Only letters, numbers, hyphens, and dots are allowed."})};const s=n.split(".");if(s.length<2)return{valid:!1,errorType:"domainChecker.error.missingDot",error:a.formatMessage({id:"domainChecker.error.missingDot",defaultMessage:"Domain must include at least one dot (e.g., example.com)."})};for(const o of s){if(!o)return{valid:!1,errorType:"domainChecker.error.emptySection",error:a.formatMessage({id:"domainChecker.error.emptySection",defaultMessage:"Domain has empty sections between dots (e.g., '..' or '.com.')."})};if(o.length>63)return{valid:!1,errorType:"domainChecker.error.labelTooLong",error:a.formatMessage({id:"domainChecker.error.labelTooLong",defaultMessage:"Each part of the domain must be 63 characters or less."})};if(!/^[a-zA-Z0-9-]+$/.test(o))return{valid:!1,errorType:"domainChecker.error.invalidLabelCharacters",error:a.formatMessage({id:"domainChecker.error.invalidLabelCharacters",defaultMessage:'Domain label "{label}" has invalid characters.'},{label:o})};if(/^-|-$/.test(o))return{valid:!1,errorType:"domainChecker.error.hyphenPosition",error:a.formatMessage({id:"domainChecker.error.hyphenPosition",defaultMessage:'Domain label "{label}" cannot start or end with a hyphen.'},{label:o})}}const i=s[s.length-1];return i.length<2||!/^[a-zA-Z]+$/.test(i)?{valid:!1,errorType:"domainChecker.error.invalidTLD",error:a.formatMessage({id:"domainChecker.error.invalidTLD",defaultMessage:"Top-level domain must be at least 2 letters."})}:{valid:!0}};function St({onClose:t,backButton:a}){const[n,s]=m.useState(),i=W();return i?n?e.jsx(Lt,{accountId:i.id,connection:n,onClose:t}):e.jsx(Dt,{onClose:t,backButton:a,setConnection:s}):null}function Dt({onClose:t,setConnection:a,backButton:n}){const s=N(),i=L(),o=W(),r=m.useId(),{triggerLocation:c}=R();m.useEffect(()=>{E.logEventWithStatsig("Contextual Answers Admin Create Connection Step","chatgpt_contextual_answers_admin_create_connection_step",{connectorType:"google_drive_oauth",stepName:"basic_info",triggerLocation:c})},[c]);const d=Ye(),u=m.useMemo(()=>{const g=d?.email?.split("@")[1];return g&&d.email_domain_type!=="social"?g:""},[d]),[x,f]=m.useState(u),[h,_]=m.useState(""),p=m.useCallback(g=>{let{valid:C,error:M,errorType:A}=Ct({domainName:g,intl:s});return C&&({valid:C,error:M,errorType:A}=Nt({domainName:g,intl:s})),M&&E.logEventWithStatsig("Contextual Answers Admin Connection Config Change Error","chatgpt_contextual_answers_admin_connection_config_change_error",{connectorType:"google_drive_oauth",stepName:"basic_info",error:`invalid_domain-${A}`,triggerLocation:c}),{valid:C,error:M}},[s,c]),[w,j]=m.useState(!1),v=m.useCallback(async()=>{if(!x||!o)return;const{valid:g,error:C}=p(x);if(_(C??""),!!g){j(!0);try{const M=await b.admin_create_connection_instance(o.id,{knowledge_connector_type:"google_drive_oauth",domain_name:x,connection_config_id:"--fake-local-id"});d&&await b.admin_connection_allow_user(o.id,M.connection_config.connection_config_id,d.id),await b.admin_activate_connection_instance(o.id,M.connection_config.connection_config_id),E.logEventWithStatsig("Contextual Answers Admin Connection Activated","chatgpt_contextual_answers_admin_connection_activated",{connectorType:"google_drive_oauth",connectionId:M.connection_config.connection_config_id,triggerLocation:c}),a(M)}catch{i.danger(s.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}))}finally{j(!1)}}},[o,x,s,a,i,d,p,c]);return e.jsxs(D,{...U,onClose:()=>t?.(),testId:"modal-gdrive-basic-info",children:[e.jsxs("form",{onSubmit:g=>{g.preventDefault(),v()},className:"flex flex-col px-6 pt-4 pb-10",children:[e.jsxs("label",{htmlFor:r,children:[e.jsx("div",{className:"mb-4 text-xl font-medium",children:e.jsx(l,{id:"EbU972",defaultMessage:"Enter your Google Workspace domain"})}),e.jsx("div",{className:"text-token-text-secondary mb-4 text-sm font-normal",children:e.jsx(l,{id:"i83LbI",defaultMessage:"Only users from this Google Workspace domain will be able to connect their account. You domain name should look like example.com"})})]}),e.jsx(nt,{type:"text",value:x,placeholder:"example.com",onChange:g=>{f(g.target.value),_("")},onBlur:()=>{const{error:g}=p(x);_(g??"")},name:r,ariaLabel:"Domain name",className:"border-token-border-default bg-token-main-surface-primary text-token-text-primary rounded-lg border border-solid",error:h}),e.jsxs("div",{className:"bg-token-main-surface-secondary text-token-text-primary mt-6 flex w-full flex-row items-center gap-4 rounded-xl p-4",children:[e.jsx(ze,{className:"icon-lg"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-token-text-secondary text-xs font-medium",children:e.jsx(l,{id:"h6elsv",defaultMessage:"Double-check this is the right domain for your Google Workspace."})}),e.jsx("div",{className:"text-token-text-secondary text-xs",children:e.jsx(l,{id:"9LPdfq",defaultMessage:"Entering the wrong domain will prevent this feature from working."})})]})]}),e.jsx("button",{type:"submit",className:"display-none"})]}),e.jsx(T,{footerContent:e.jsx("div",{children:e.jsx(ae,{href:me,className:"text-token-text-secondary text-sm underline",onClick:()=>ne({link:me,location:"admin_onboarding_basic_info"}),children:e.jsx(l,{id:"6WfLis",defaultMessage:"Where do I find my domain name?"})})}),primaryButton:e.jsx(y,{color:"primary",disabled:x.trim()===""||!!h,loading:w,onClick:v,children:e.jsx(l,{id:"+itf/D",defaultMessage:"Save"})}),secondaryButton:n})]})}function Et({onClose:t,onSuccess:a,connection:n,accountId:s}){const{triggerLocation:i}=R();m.useEffect(()=>{E.logEventWithStatsig("Contextual Answers Admin Create Connection Step","chatgpt_contextual_answers_admin_create_connection_step",{connectorType:"google_drive_oauth",stepName:"quickstart",triggerLocation:i})},[i]);const o=async()=>{await b.admin_activate_connection_instance(s,n.connection_config.connection_config_id),E.logEventWithStatsig("Contextual Answers Admin Connection Activated","chatgpt_contextual_answers_admin_connection_activated",{connectorType:"google_drive_oauth",connectionId:n.connection_config.connection_config_id,adminQuickstart:!0,triggerLocation:i}),a()};return e.jsx(Ve,{connectionId:n.connection_config.connection_config_id,location:"admin_connection_quickstart",isAdminFlow:!0,isAdminQuickstartFlow:!0,onClose:()=>{t?.()},onSuccess:o,accountId:s})}function Lt({connection:t,accountId:a,onClose:n,hasAdminAlreadyConnected:s=!1}){const i=N(),o=[{connectorType:"google_drive_oauth",name:"allowed_users",fn:({goForward:r,close:c})=>e.jsx(we,{connectorType:"google_drive_oauth",fallbackEstimatedMaxNumUsers:Me(t.connection_config),onClose:()=>c?.(),accountId:a,connectionId:t.connection_config.connection_config_id,primaryButton:s?e.jsx(y,{color:"primary",onClick:()=>n(),children:i.formatMessage(I.finish)}):r&&e.jsx(y,{color:"primary",onClick:r,children:i.formatMessage(I.continue)})})}];return s||o.push({connectorType:"google_drive_oauth",name:"admin_oauth_disclaimer",fn:({goForward:r,goBackward:c,close:d})=>e.jsx(Qe,{isOpen:!0,onClose:()=>d?.(),isAdminFlow:!0,isAdminQuickstartFlow:!1,secondaryButton:c&&e.jsx(y,{color:"secondary",onClick:c,children:i.formatMessage(I.back)}),primaryButton:e.jsx(y,{color:"primary",onClick:r,children:i.formatMessage(I.continue)})})},{connectorType:"google_drive_oauth",name:"admin_oauth_cta",fn:({goForward:r,goBackward:c,close:d})=>e.jsx(Ze,{isOpen:!0,onClose:()=>d?.(),secondaryButton:c&&e.jsx(y,{color:"secondary",onClick:c,children:i.formatMessage(I.back)}),primaryButton:e.jsx(ge,{onSuccess:()=>d?.(!0),onError:()=>r?.(),label:i.formatMessage(I.loginWithGoogle),connectionId:t.connection_config.connection_config_id,connectorType:"google_drive_oauth",location:"admin_flow"})})},{connectorType:"google_drive_oauth",name:"admin_oauth_error",fn:({close:r})=>e.jsx(He,{isOpen:!0,onClose:()=>r?.(),primaryButton:e.jsx(ge,{onSuccess:()=>r?.(),label:i.formatMessage(I.reconnect),connectionId:t.connection_config.connection_config_id,connectorType:"google_drive_oauth",location:"admin_flow",isReconnect:!0})})}),e.jsx(be,{onClose:n,steps:o})}const I=te({back:{id:"RDaXnk",defaultMessage:"Back"},cancel:{id:"CfN1/v",defaultMessage:"Cancel"},continue:{id:"XGnWba",defaultMessage:"Continue"},loginWithGoogle:{id:"9ImAmL",defaultMessage:"Log in with Google"},reconnect:{id:"0qUCBD",defaultMessage:"Reconnect"},finish:{id:"5Wpd39",defaultMessage:"Finish"}});function Zt({triggerLocation:t,...a}){const n=W(),{data:s,isLoading:i}=se(n?.getWorkspaceId(),0,void 0,1);return s||!i?e.jsx(re.Provider,{value:{triggerLocation:t},children:e.jsx(At,{numUsersInWorkspace:s?.total??0,...a})}):e.jsx(D,{testId:"modal-gdrive-add-workspace-loader",...U,isOpen:!0,onClose:a.onClose,children:e.jsx("div",{className:"flex min-h-64 items-center justify-center p-8",children:e.jsx(F,{})})})}function At({onClose:t,numUsersInWorkspace:a,isDwdEnabled:n}){const s=a>=le("google_drive_oauth")&&n,[i,o]=m.useState(s?"gdrive-dwd":"gdrive-oauth"),[r,c]=m.useState(!0),[d,u]=m.useState(),[x,f]=m.useState(!1),h=r&&n&&!d,_=W(),p=Je(),w=async()=>{const v=$e(p,"516806730").get("quickstart_enabled");if(!(i==="gdrive-oauth"&&v)){c(!1);return}if(!(!_?.id||d))try{f(!0),u(await b.admin_create_connection_instance(_.id,{knowledge_connector_type:"google_drive_oauth",domain_name:"",connection_config_id:"--fake-local-id"}))}catch{t()}finally{f(!1)}},{triggerLocation:j}=R();return m.useEffect(()=>{E.logEventWithStatsig("Contextual Answers Admin Create Connection Step","chatgpt_contextual_answers_admin_create_connection_step",{connectorType:"google_drive",stepName:"options",triggerLocation:j})},[j]),e.jsxs(e.Fragment,{children:[e.jsxs(D,{testId:"modal-gdrive-add-workspace",...U,isOpen:h,onClose:t,children:[e.jsx("div",{className:"px-6 pt-4 pb-10",children:e.jsx(Tt,{preferDwd:s,selectedConnector:i,setSelectedConnector:o})}),e.jsx(T,{footerContent:e.jsx(ae,{href:xe,className:"text-token-text-secondary text-sm underline",onClick:()=>ne({link:xe,location:"admin_onboarding_gdrive_options"}),children:e.jsx(l,{id:"ADGK4d",defaultMessage:"Which option is right for my team?"})}),primaryButton:e.jsx(y,{color:"primary",onClick:w,loading:x,disabled:x,children:e.jsx(l,{id:"z5fExR",defaultMessage:"Next"})}),secondaryButton:e.jsx(y,{color:"secondary",onClick:()=>t(),disabled:x,children:e.jsx(l,{id:"5Oo8TW",defaultMessage:"Cancel"})})})]}),!h&&(d&&_?e.jsx(Et,{onClose:()=>{c(!0),u(void 0),t()},onSuccess:()=>{c(!0),u(void 0),t(!0)},connection:d,accountId:_.id}):i==="gdrive-oauth"?e.jsx(St,{onClose:v=>{t(v),c(!0)},backButton:n&&e.jsx(y,{color:"secondary",onClick:()=>c(!0),children:e.jsx(l,{id:"xJnONr",defaultMessage:"Back"})})}):i==="gdrive-dwd"?e.jsx(kt,{onClose:v=>{t(v),c(!0)},backButton:e.jsx(y,{color:"secondary",onClick:()=>c(!0),children:e.jsx(l,{id:"xJnONr",defaultMessage:"Back"})})}):null)]})}function Tt({selectedConnector:t,setSelectedConnector:a,preferDwd:n}){const s=N(),i=e.jsx(pe,{optionValue:"gdrive-oauth",optionName:s.formatMessage({id:"C1Gn3w",defaultMessage:"Member-controlled access"}),isSelected:t==="gdrive-oauth",checkedBulletPoints:[s.formatMessage({id:"ATU4nE",defaultMessage:"For teams with fewer than {max_users} users"},{max_users:le("google_drive_oauth")}),s.formatMessage({id:"hXiuKC",defaultMessage:"Each member must authenticate their account"})]}),o=e.jsx(pe,{optionValue:"gdrive-dwd",optionName:s.formatMessage({id:"l7w56H",defaultMessage:"Admin-controlled access"}),isSelected:t==="gdrive-dwd",checkedBulletPoints:[s.formatMessage({id:"suAHPy",defaultMessage:"Required for large teams"}),s.formatMessage({id:"1W662S",defaultMessage:"Centralized setup with service account credentials"})]});return e.jsxs("div",{children:[e.jsx("div",{className:"-mt-2 mb-6 text-start text-lg font-medium",children:e.jsx(l,{id:"JKSyU3",defaultMessage:"Choose how your team connects Google Drive"})}),e.jsx(je,{value:t,onValueChange:r=>a(r),className:"flex w-full flex-col gap-4",children:n?e.jsxs(e.Fragment,{children:[o,i]}):e.jsxs(e.Fragment,{children:[i,o]})})]})}function pe({optionName:t,optionValue:a,isSelected:n,checkedBulletPoints:s,disabled:i}){const o=n?oe:ve;return e.jsxs(ye,{value:a,id:`connector-group-option-${a}`,className:Z("border-token-border-heavy flex w-full justify-between rounded-xl border border-solid p-4",i&&"opacity-50",n&&"border-token-text-primary"),disabled:i,children:[e.jsxs("div",{className:"max-w-96 shrink-0",children:[e.jsx("div",{className:"text-start font-medium",children:t}),e.jsx("div",{className:"font-tertiary mt-1 text-start text-sm",children:s.length&&e.jsx("ul",{className:"text-token-text-secondary mt-1 mb-2 flex-1 list-inside list-disc",children:s.map((r,c)=>e.jsx("li",{className:"text-sm",children:r},c))})})]}),e.jsx(o,{className:"icon-lg shrink-0"})]})}export{we as A,Yt as C,Qt as D,Zt as G,be as M,vt as R,_t as S,dt as a,jt as b,ft as c,zt as d,yt as e,wt as f,Me as g,R as u};
//# sourceMappingURL=iitnsevxfoy2pp6j.js.map
