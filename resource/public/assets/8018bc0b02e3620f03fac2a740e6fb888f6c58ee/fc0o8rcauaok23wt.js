import{r as g,f as E,j as e,M as c}from"./n3epq09dut36rmi2.js";import{eF as L,et as F,l0 as T,a9 as O,fv as A,aG as z}from"./uox23aig6gp6se2y.js";import{c as j,B as C,ec as U,m as W}from"./nqrmgk5te3uzwsyz.js";import{C as H,S as G,i as K,g as $,D as q,f as J}from"./es8ut1140mmjn9bb.js";import{i as Q}from"./o1zu0t2rzad6c81z.js";import{S as X,a as Y}from"./wcw7ksbemgmhp6gb.js";import{F as Z}from"./g4077lnext0t7dfo.js";import{W as ee}from"./k9dqus9crie9cyow.js";import"./azqvry2z7sssyjfm.js";import"./esvlql2z91zwym50.js";import"./dnyjnsewv99rujtf.js";import"./e4sjbad9hyqt73xe.js";import"./dkr8jkx9n88ez7ho.js";import"./nnldvg4yjd3ynnqu.js";import"./ms88w7omyr5fyl5m.js";import"./mwmzy5d3s65b6nqi.js";import"./eirgecln9yzcy5p4.js";import"./izzltcwrbklvvt51.js";import"./oshe56yhea4czc03.js";import"./ipklaqcgu1ejshk6.js";import"./bns64zud9fwchaft.js";import"./gt0o8gecgu18rlu9.js";import"./hywf39bgiuru57vx.js";import"./dplssc7283prca44.js";import"./732ktrbtyfqle46e.js";import"./loybro28dk8o1rh8.js";import"./lw3nae8q1eor1tu0.js";import"./kth8b95xbvmuu5bx.js";import"./iwi9e9tak1je4ys9.js";import"./xdtirbwvvk4sqc30.js";import"./iiunoc4k1n6g4a9l.js";import"./kvhuqs0v8em60vy1.js";import"./mmgogcu21wjwfuju.js";import"./oco3z5r1wfatkk2z.js";import"./i29w7batiy3i4iov.js";import"./h0v70jeb8vuswv8x.js";import"./bqizorod7tt9c8xq.js";import"./e3g5ffsb6g0bu7pn.js";import"./ge980eja361ie3ca.js";import"./gbfmb6n7vmtt0mld.js";import"./mgq4dy5xj5doeoq7.js";import"./lz1vmotuvwwmb129.js";import"./b99rlgw1hhu0zh6m.js";function B({filePath:t,side:f,lineNumber:b,onSubmit:p,onDelete:s,onClose:o,initialComment:i}){const n=i?S(i):"",[r,a]=g.useState(i?S(i):""),[u,m]=g.useState(!i),[v,N]=g.useState(!1),w=g.useRef(null),k=E(),y=()=>{if(!r)return;const l=i?{...i,content:[{content_type:"text",text:r}]}:{id:crypto.randomUUID(),type:"comment",content:[{content_type:"text",text:r}],position:{side:f===G.old?"left":"right",path:t,line:b}};p?.(l),m(!1),w.current?.blur(),o?.()};return g.useEffect(()=>{!v&&i&&r===n&&setTimeout(()=>{m(!1)},100),v&&(m(!0),w.current?.focus())},[v,i,r,n]),e.jsx("div",{className:"gap-2 bg-gray-100/50 p-4 font-sans dark:bg-gray-900",id:i?.id,children:e.jsxs("div",{className:j("flex flex-col gap-2",H),children:[e.jsx(Q,{ref:w,className:"border-token-border-medium bg-token-main-surface-primary text-token-text-primary border-1.5 w-full resize-none rounded-lg p-4 text-sm ring-0 focus:border-black focus:outline-hidden dark:focus:border-white",onFocus:()=>N(!0),onBlur:()=>N(!1),placeholder:k.formatMessage({id:"code.diff.addComment",defaultMessage:"Add a comment"}),minRows:1,maxRows:10,autoFocus:!i,onSubmit:()=>{},value:r,onChange:l=>a(l.target.value),onKeyDown:l=>{l.key==="Enter"&&l.metaKey&&(l.preventDefault(),y()),l.key==="Escape"&&(l.preventDefault(),o?.())}}),u&&e.jsxs("div",{className:j("mt-2 flex items-center justify-between gap-2",!s&&"justify-end"),children:[s&&e.jsx(C,{color:"danger",onClick:()=>s?.(),children:e.jsx(c,{id:"code.diffComment.delete",defaultMessage:"Delete"})}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(C,{color:"secondary",onClick:()=>{o?.(),m(!1),i&&a(S(i))},children:e.jsx(c,{id:"code.diffComment.cancel",defaultMessage:"Cancel"})}),e.jsx(C,{color:"primary",disabled:!r,onClick:y,children:i?e.jsx(c,{id:"code.diffComment.save",defaultMessage:"Save"}):e.jsx(c,{id:"code.diffComment.comment",defaultMessage:"Comment"})})]})]})]})})}function S(t){return t.content.map(f=>f.content_type==="text"?f.text:"").join("")}function te({copyDiffToClipboard:t,copyPatchToClipboard:f,unifiedDiff:b,setUnifiedDiff:p}){const[s,o]=g.useState(!1),i=n=>r=>{r.preventDefault(),r.stopPropagation(),n==="diff"?t():f()};return e.jsxs(L,{open:s,onOpenChange:o,contentAlign:"end",sideOffset:8,triggerButton:e.jsx("button",{type:"button",onClick:n=>{n.preventDefault(),n.stopPropagation(),o(!0)},className:"hover:bg-token-border-light rounded p-1",children:e.jsx(O,{className:"icon-md"})}),children:[e.jsx(F.Item,{icon:T,onClick:i("diff"),children:e.jsx(c,{id:"wham.copyFile.apply",defaultMessage:"Copy git apply"})}),e.jsx(F.Item,{icon:T,onClick:i("patch"),children:e.jsx(c,{id:"wham.copyFile.patch",defaultMessage:"Copy patch"})}),e.jsx(F.Separator,{}),e.jsxs(F.RadioGroup,{value:b?"unified":"split",onValueChange:n=>p(n==="unified"),children:[e.jsx(F.RadioItem,{value:"split",children:e.jsxs("div",{className:"text-token-text-primary flex items-center gap-3",children:[e.jsx(X,{className:"icon-md"}),e.jsx(c,{id:"wham.message.modal.footer.splitDiff",defaultMessage:"Split diff"})]})}),e.jsx(F.RadioItem,{value:"unified",children:e.jsxs("div",{className:"text-token-text-primary flex items-center gap-3",children:[e.jsx(Y,{className:"icon-md"}),e.jsx(c,{id:"wham.message.modal.footer.unifiedDiff",defaultMessage:"Unified diff"})]})})]})]})}const ie="_diffView_avtz7_1",oe={diffView:ie};function ae({diff:t,viewType:f,stickyHeader:b,enableComments:p=!1,comments:s,onCommentCreate:o,onCommentDelete:i,onCommentUpdate:n,setUnifiedDiff:r}){const a=U(),u=E(),[m,v]=g.useState(()=>!K(t.diffFile)),[N,w]=g.useState(!1),k=W();g.useEffect(()=>{t.diffFile.initTheme(a?"dark":"light")},[t.diffFile,a]);const y=(s??[]).reduce((d,x)=>{const h=x.position.path,M=x.position.side,D=x.position.line;d[h]||(d[h]={oldFile:{},newFile:{}});const _=M==="left"?d[h].oldFile:d[h].newFile;return _&&(_[D]={data:x}),d},{}),l=$(t.diffFile),V=()=>{navigator.clipboard.writeText(t.diffFile._newFileName),w(!0),setTimeout(()=>{w(!1)},1e3)},R=async()=>{t.hunksText&&(await navigator.clipboard.writeText(` (cd "$(git rev-parse --show-toplevel)" && git apply --3way <<'EOF' 
${t.hunksText} 
EOF
)`),k.success(u.formatMessage({id:"wham.message.modal.footer.copiedToClipboard",defaultMessage:"Copied git apply command to clipboard"}),{duration:3,hasCloseButton:!0}))},I=async()=>{t.hunksText&&(await navigator.clipboard.writeText(t.hunksText),k.success(u.formatMessage({id:"wham.codeDiff.copiedPatchToClipboard",defaultMessage:"Copied patch to clipboard"}),{duration:3,hasCloseButton:!0}))},P=!t.diffFile.unifiedLineLength&&!t.diffFile.splitLineLength;return e.jsxs("div",{"data-diff-header":l,className:j("flex flex-col pt-1",oe.diffView),children:[e.jsx("div",{role:"button",onClick:()=>v(!m),className:j("focus-visible:outline-none",b&&"sticky top-0 z-1"),children:e.jsxs("div",{className:j("bg-token-bg-primary border-token-border-default relative flex items-center rounded-t-2xl border px-4 py-3 text-sm font-medium before:absolute before:inset-x-[-1px] before:top-[-1px] before:bottom-0 before:z-[-1] before:bg-[var(--right-bg)] before:content-['']",!m&&"rounded-b-2xl"),children:[e.jsx(A,{className:j("icon-md me-3 transition-transform duration-200",m&&"rotate-90")}),e.jsx("span",{className:"me-1 truncate text-start select-text",title:l,children:l}),e.jsx(Z,{diffFile:t.diffFile}),e.jsx(z,{label:u.formatMessage({id:"wham.codeDiff.copiedFileName",defaultMessage:"Copied File Name"}),open:N,children:e.jsx("div",{role:"button",onClick:d=>{d.preventDefault(),d.stopPropagation(),V()},className:"hover:bg-token-border-light rounded p-1",children:e.jsx(T,{className:"icon-xs"})})}),e.jsxs("div",{className:"ms-auto flex items-center gap-1 ps-1",children:[e.jsx(ee,{linesAdded:t.diffFile.additionLength,linesRemoved:t.diffFile.deletionLength}),!t.isBinary&&e.jsx(te,{copyDiffToClipboard:R,copyPatchToClipboard:I,unifiedDiff:f==="unified",setUnifiedDiff:r})]})]})}),m&&(P||t.isBinary?e.jsx("div",{className:"text-token-text-secondary bg-token-bg-secondary flex h-full justify-center rounded-b-2xl py-4 text-sm font-medium",children:t.isBinary?e.jsx(c,{id:"wham.diff.binaryFile",defaultMessage:"Binary file not shown"}):e.jsx(c,{id:"wham.diff.noContent",defaultMessage:"No content"})}):e.jsx(q,{className:j("relative overflow-clip rounded-b-2xl transition-opacity duration-300","after:border-token-border-default after:pointer-events-none after:absolute after:inset-0 after:rounded-b-2xl after:border-s after:border-e after:border-b after:content-['']"),diffViewFontSize:12,diffFile:t.diffFile,diffViewTheme:a?"dark":"light",diffViewHighlight:!0,diffViewMode:f==="split"&&!J(t.diffFile)?3:4,diffViewWrap:!0,diffViewAddWidget:p,extendData:y[t.diffFile._newFileName],renderExtendLine:({lineNumber:d,side:x,data:h})=>!p||!(x===1?y[t.diffFile._newFileName]?.oldFile:y[t.diffFile._newFileName]?.newFile)?null:e.jsx(B,{initialComment:h,onSubmit:D=>n?.(D),onDelete:()=>i?.(h),filePath:t.diffFile._newFileName,side:x,lineNumber:d}),renderWidgetLine:({onClose:d,lineNumber:x,side:h})=>!p||!o?null:e.jsx(B,{onSubmit:o,onClose:d,filePath:t.diffFile._newFileName,side:h,lineNumber:x})}))]})}function qe({diffFiles:t,unifiedDiff:f,setUnifiedDiff:b,enableComments:p,comments:s,setComments:o}){if(!t.length)return e.jsx("div",{className:"flex h-full w-full flex-1 items-center justify-center",children:e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(c,{id:"wham.whamTaskPageCodeDiffContent.noDiffAvailable",defaultMessage:"No diff available"})})});function i(a){!o||!s||o([...s,a])}function n(a){!o||!s||o(s.filter(u=>u.id!==a.id))}function r(a){!o||!s||o(s.map(u=>u.id===a.id?a:u))}return e.jsx("div",{className:"relative h-full w-full pt-6",children:e.jsx("div",{className:"flex h-full w-full flex-col gap-6 overflow-y-auto px-6 pb-6",children:t.map(a=>e.jsx(ae,{diff:a,stickyHeader:!0,viewType:f?"unified":"split",setUnifiedDiff:b,enableComments:p,comments:p?s:[],onCommentCreate:i,onCommentDelete:n,onCommentUpdate:r},a.diffFile._newFileName))})})}export{qe as WhamTaskPageCodeDiffContent};
//# sourceMappingURL=fc0o8rcauaok23wt.js.map
