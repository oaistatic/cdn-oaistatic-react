const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/huy9i8wu7ua2l4zn.js","assets/dze2l9y9kn6nwat0.js","assets/cg166fqqcxkeiosv.js","assets/root-fk1yg8gm.css","assets/j4xe1fdohr6xk09p.js","assets/conversation-small-ga20ijz2.css","assets/m5tfr0dtbetugou5.js","assets/gzm2pyuieq14d2cd.js","assets/d879imt950hfadhv.js","assets/hqprvq82xcpllir3.js","assets/e9twjvrfqdwmahlj.js","assets/i8wt1ptmzikt53pm.js","assets/kd15wrub5zpa591b.js","assets/765apt28hvug1izo.js","assets/oyod5vgp8gzuy8hf.js"])))=>i.map(i=>d[i]);
import{bl as pe,bm as ve,b3 as Se,fx as Ce,C as Ee,fy as $,N as E,S as O,P as y,a as x,c1 as ye,aD as xe,dT as be,ai as F,Q as Te,r as Ne,V as Re,E as c,F as w,dc as _e,d as D,Y as Ae,aL as we,O as De}from"./dze2l9y9kn6nwat0.js";import{c as Z,r as o,a as W,d as Ie,j as t,L as K}from"./cg166fqqcxkeiosv.js";import{ae as je,af as ke,ag as M,ac as B,ah as Oe,ai as Me,aj as ze,ak as ee,al as Le,am as Pe,an as Ge,ao as He,ap as X,aq as Ue,ar as qe,as as Ve,at as Q,au as Fe,av as Ke,aw as Be,ax as Xe,ay as Y,az as Qe,aA as Ye,aB as Je,aC as $e}from"./j4xe1fdohr6xk09p.js";import{G as te}from"./m5tfr0dtbetugou5.js";const Ze=pe(()=>ve(()=>import("./huy9i8wu7ua2l4zn.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14])).then(e=>e.GizmoConversationOptionsDropdown)),We=new Date(2024,9,11,0);function J(e){O.checkGate("3922476776")||we.abortAllRequests(),y.logEvent(x.loadThread,{threadId:e})}function et({conversation:e,conversationTitle:d,onOpenChange:m,testId:a,inMainScreen:n=!1}){const i=Z(),{isUnauthenticated:h}=Se(),{eligible:p,markAsViewed:b}=je(ke.ArchiveConversationOnboarding),u=Ce(e.id),[v,T]=o.useState(!1);o.useState(!1);const l=W(),g=Ie(),S=Ee();if(o.useEffect(()=>$(te,{deleteChat:({serverThreadId:r})=>{r===e.id&&T(!0)},archiveChat:async({serverThreadId:r})=>{r===e.id&&(await E.patchConversation(e.id,{is_archived:!0}),M(l,e.gizmo_id),O.logEvent("chatgpt_conversation_archived"),y.logEvent(x.conversationArchived),p&&(S.info(i.formatMessage({defaultMessage:"You can view archived chats in Settings",id:"HistoryGizmoItem.archiveChatOnboarding"}),{duration:10,hasCloseButton:!0}),b()),u&&B(g))}}),[g,S,l,p,e.id,e.gizmo_id,i,u,b]),h)return null;const N=t.jsx(Ze,{conversation:e,onOpenChange:m,inMainScreen:n,children:t.jsx("button",{className:"flex items-center justify-center text-token-text-secondary transition hover:text-token-text-primary radix-state-open:text-token-text-secondary","data-testid":a,"aria-label":i.formatMessage({id:"idEcXk",defaultMessage:"Open conversation options"}),children:t.jsx(Oe,{className:"icon-md"})})});return t.jsxs(t.Fragment,{children:[t.jsx(ye,{label:i.formatMessage({id:"tJPHEQ",defaultMessage:"Options"}),sideOffset:4,side:"top",children:N}),!1,v&&t.jsx(Me,{title:d,handleDelete:()=>{E.patchConversation(e.id,{is_visible:!1}).then(()=>{M(l,e.gizmo_id),O.logEvent("chatgpt_conversation_deleted"),y.logEvent(x.conversationDeleted),xe.publish({kind:"deleteConversation",serverThreadId:e.id})}),u&&B(g)},onClose:()=>{T(!1)}})]})}const se=5,tt=3e3;function st({threadId:e}){const d=W(),m=o.useRef(!1),a=o.useRef(null);return o.useEffect(()=>{async function n(){m.current=!0;const i=await $e(e);if(i.async_status===c.UNREAD){M(d,i.gizmo_id),De.initThreadFromServerData(e,i,!0,void 0,!0);return}if(i.async_status!==c.STREAMING)return;const h=i.update_time??0;ee(new Date,new Date(h*1e3))<se?a.current=window.setTimeout(n,tt):E.setConversationStatus(e)}return m.current||(y.logEvent(x.conversationPollingStarted),n()),()=>{a.current&&window.clearTimeout(a.current)}},[d,e]),null}function rt({conversation:e,className:d,hideOverflowMenu:m=!1,isActiveInMainWindow:a,isActive:n,elementRef:i,testId:h}){const p=Z(),[b,u]=o.useState(!1),[v,T]=o.useState(!1),[l,g]=o.useState(!1),S=be(),{value:N}=F("3922476776"),{value:r}=F("232791851"),ae=ze(e.id),{value:f=null,source:R=null}=ae??{},oe=Te(e.id,Ne.getRequestId),C=Re(oe),z=ee(new Date,new Date(e.update_time??0))<se,L=Le(e.id),ne=e.update_time&&Pe(new Date(e.update_time),We),P=f===c.STREAMING&&z,ie=r&&!n&&!C&&ne&&!l&&f===c.UNREAD,G=r&&(C||P)&&!l,re=r&&!a&&L.length>0&&!l,le=r&&!a&&(C||P),ce=r&&f===c.STREAMING&&R===w.SERVER&&!C&&z,I=o.useRef(!1);o.useEffect(()=>{I.current||N&&(async()=>(I.current=!0,n&&f===c.UNREAD&&(R===w.SERVER&&await E.setConversationStatus(e.id),Y(e.id,null)),!n&&R===w.CLIENT&&f===c.UNREAD&&(await E.setConversationStatus(e.id,f),Y(e.id,{value:c.UNREAD,source:w.SERVER})),I.current=!1))()},[N,n,e.id,f,R,C]),o.useEffect(()=>$(te,{editTitle:({serverThreadId:s})=>{(s?s===e.id:a)&&u(!0)}}),[e.id,a]);const j=p.formatMessage({id:"mpXAeu",defaultMessage:"New chat"}),{resolvedTitle:_,isTypingEffect:de}=Ge(e.id,e.title,n),ue=_e(),fe=de&&n&&ue,{data:me}=He(),H=e.conversation_template_id!=null?me?.gizmos.find(s=>s.resource.gizmo.id===e.conversation_template_id)?.resource:void 0,U=o.useRef(null),ge=t.jsx("div",{className:D("absolute bottom-0 top-0 inline-flex items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",a||v?"flex":"invisible can-hover:group-hover:visible"),ref:U,children:t.jsx(et,{conversation:e,conversationTitle:_??e.title,onOpenChange:s=>{T(s),s&&y.logEvent(x.conversationHistoryItemOpenMenu,{conversationId:e.id})},testId:`${h}-options`})}),q=S?Qe:Ye,he=(a||v)&&Je,V=o.useRef(null);return t.jsxs("div",{draggable:X(e.gizmo_id),onDragStart:s=>{if(!X(e.gizmo_id))return;const k=Ae(V.current),A=U.current;A&&(A.style.display="none"),s.dataTransfer.setDragImage(k,k.clientWidth/3,k.clientHeight/2),A&&requestAnimationFrame(()=>{A.style.display=""}),s.dataTransfer.effectAllowed="move",Ue({kind:"conversation",conversation:e,gizmoId:e.gizmo_id})},onDragEnd:()=>{qe()},ref:V,style:{"--item-background-color":Ve(l,n,v)},className:D(q,"relative screen-arch:bg-transparent",d),onMouseEnter:()=>{g(!0)},onMouseLeave:()=>{g(!1)},children:[S&&t.jsx("div",{className:D(q,he,"pointer-events-none absolute inset-0 group-hover:bg-transparent motion-safe:group-active:scale-[98%] motion-safe:group-active:transition-transform motion-safe:group-active:duration-100")}),ce&&t.jsx(st,{threadId:e.id}),t.jsx(K,{to:Q(e.id,H),onClick:s=>{s.metaKey||s.ctrlKey||a||J(e.id)},onDoubleClick:()=>{u(!0)},ref:i,className:"flex items-center gap-2 p-2 screen-arch:motion-safe:group-active:scale-[98%] screen-arch:motion-safe:group-active:transition-transform screen-arch:motion-safe:group-active:duration-100",style:{maskImage:"var(--sidebar-mask)"},children:t.jsx("div",{className:D("relative grow overflow-hidden whitespace-nowrap",le&&!G&&"loading-shimmer"),dir:"auto",title:_??j,children:fe?t.jsx(Fe,{text:_||j}):_||j})}),b?t.jsx("div",{className:"absolute bottom-0 left-[7px] right-2 top-0 flex items-center bg-token-sidebar-surface-secondary",children:t.jsx(Ke,{conversation:e,onClose:()=>{u(!1)}})}):ie?t.jsx(K,{to:Q(e.id,H),onClick:s=>{s.metaKey||s.ctrlKey||a||J(e.id)},children:t.jsx("div",{className:"absolute bottom-0 top-0 flex items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",children:t.jsx("div",{className:"h-2 w-2 rounded-full bg-blue-selection"})})}):re?t.jsx("div",{className:"absolute bottom-0 top-0 flex items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",children:t.jsx(Be,{task:L[0]})}):G?t.jsx("div",{className:"absolute bottom-0 top-0 flex items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",children:t.jsx(Xe,{size:16,className:"text-token-text-primary"})}):!m&&ge]})}export{et as G,rt as H};
//# sourceMappingURL=clkzaq2ue82unbic.js.map
