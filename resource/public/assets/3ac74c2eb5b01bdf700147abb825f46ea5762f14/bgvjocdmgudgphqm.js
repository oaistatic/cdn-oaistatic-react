import{f2 as b,bo as M,fn as T,R as W,A as R,P as r,a as u,bT as _}from"./dze2l9y9kn6nwat0.js";import{r as x,h as U,A as I,b as O,j as e,c as L,M as n}from"./cg166fqqcxkeiosv.js";import{N as g,U as l,W as $,a as j,S as C}from"./kqvqy5txqx9dr8ww.js";import{i as q,A as B}from"./j4xe1fdohr6xk09p.js";function D(t,c){setTimeout(()=>{window.location.href=c},t*1e3)}const X=b(function(){const[c,d]=x.useState(!1),[o,h]=U(),{phoneNumber:s,proof:y,nextAction:f}=I(),{session:P,isLoading:E}=M(),p=q(),A=f===g.Authenticate,N=f===g.LinkAccount&&!c,w=o.get("show_success_screen")==="true",v=f===g.LinkAccount&&c,{mutate:k,isPending:S}=O({mutationFn:async a=>{try{if(a===l.Cancel)return{success:!1};if(!P||E)return{success:!1,errorCode:T.SessionExpired};const{success:m,error_code:i}=await W.safePost("/moodeng/account_linking",{requestBody:{proof:y,identifier:s},authOption:R.Required});return{success:m,errorCode:i}}catch{return{success:!1}}},onSuccess:(a,m)=>{if(!a.success&&m===l.Cancel){window.location.href=$;return}else if(!a.success){const i=new URLSearchParams;i.set("reason",a.errorCode??""),i.set("phone_number",s??""),window.location.href=`/account-link/error?${i.toString()}`;return}if(w)return d(!0),D(2,j);window.location.href=j}});return x.useEffect(()=>{if(A){if(!s)return;r.logEventWithStatsig(u.chatgptAccountLinkRedirectAuthenticate,"chatgpt_account_link_redirect_authenticate",{phoneNumber:s}),p({authType:"login",callbackUrl:`${location.pathname}${location.search}${location.hash}`,additionalAuthParams:{[B]:"true"}})}},[A,p,s]),e.jsxs("div",{className:"mx-auto w-full max-w-sm sm:max-w-md",children:[N&&e.jsx(F,{phoneNumber:s,onAllowClick:()=>k(l.Allow),onCancelClick:()=>k(l.Cancel),isOnAllowClickPending:S,isOnCancelClickPending:S}),w&&v&&e.jsx(H,{phoneNumber:s})]})});function F({phoneNumber:t,onAllowClick:c,onCancelClick:d,isOnAllowClickPending:o,isOnCancelClickPending:h}){const s=L();return e.jsxs("div",{className:"flex w-full flex-col items-center justify-center px-4 py-10",children:[e.jsx("header",{className:"oai-header",children:e.jsx(C,{alt:s.formatMessage({id:"login.openAiLogo",defaultMessage:"OpenAI Logo"}),className:"h-10 w-10"})}),e.jsx("h1",{className:"mt-10 text-center text-3xl font-semibold",children:e.jsx(n,{id:"account-link.confirm.title",defaultMessage:"Confirm account linking"})}),e.jsx("p",{className:"mt-6 text-center text-token-text-secondary",children:e.jsx(n,{id:"account-link.confirm.description",defaultMessage:'By clicking "Allow", your WhatsApp number {branch, select, pn {{phoneValue}} other {}} will be linked to your ChatGPT account.',values:{branch:t?"pn":"other",phoneValue:t}})}),e.jsxs("div",{className:"mt-6 flex w-full flex-col gap-3",children:[e.jsx(_,{className:"w-full rounded-md",color:"green",type:"submit",onClick:()=>{r.logEventWithStatsig(u.chatgptAccountLinkAllowClicked,"chatgpt_account_link_allow_clicked",{phoneNumber:t}),c()},disabled:o||h,loading:o,children:e.jsx(n,{id:"account-link.confirm.button",defaultMessage:"Allow"})}),e.jsx(_,{className:"w-full rounded-md",color:"secondary",onClick:()=>{r.logEventWithStatsig(u.chatgptAccountLinkCancelClicked,"chatgpt_account_link_cancel_clicked",{phoneNumber:t}),d()},disabled:h||o,children:e.jsx(n,{id:"account-link.confirm.cancel",defaultMessage:"Cancel"})})]})]})}function H({phoneNumber:t}){const c=L();return x.useEffect(()=>{r.logEventWithStatsig(u.chatgptAccountLinkSuccess,"chatgpt_account_link_success",{phoneNumber:t??void 0})},[t]),e.jsxs("div",{className:"flex w-full flex-col items-center justify-center px-4 py-10",children:[e.jsx("header",{className:"oai-header",children:e.jsx(C,{alt:c.formatMessage({id:"login.openAiLogo",defaultMessage:"OpenAI Logo"}),className:"h-10 w-10"})}),e.jsx("h1",{className:"mt-10 text-center text-3xl font-semibold",children:e.jsx(n,{id:"account-link.success.title",defaultMessage:"Successfully linked your ChatGPT account"})}),e.jsx("p",{className:"mt-6 text-center text-token-text-secondary",children:e.jsx(n,{id:"account-link.success.description",defaultMessage:"You can now close this window and return to WhatsApp, or you will be automatically redirected momentarily."})})]})}export{X as default};
//# sourceMappingURL=bgvjocdmgudgphqm.js.map
