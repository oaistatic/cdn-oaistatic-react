const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/kduuqrx6hin9e9dr.js","assets/dze2l9y9kn6nwat0.js","assets/cg166fqqcxkeiosv.js","assets/root-fk1yg8gm.css","assets/j4xe1fdohr6xk09p.js","assets/conversation-small-ga20ijz2.css","assets/eitqn0jg73mn1rk1.js","assets/d0cbiu6zi6zdiy98.js","assets/huy9i8wu7ua2l4zn.js","assets/m5tfr0dtbetugou5.js","assets/gzm2pyuieq14d2cd.js","assets/d879imt950hfadhv.js","assets/hqprvq82xcpllir3.js","assets/e9twjvrfqdwmahlj.js","assets/i8wt1ptmzikt53pm.js","assets/kd15wrub5zpa591b.js","assets/765apt28hvug1izo.js","assets/oyod5vgp8gzuy8hf.js","assets/h83rc28v2vsm5nda.js","assets/jky4nhpbj4n3xuh7.js","assets/m4iicmyh3x1nme4j.js","assets/b6ddr1xo1x0u3g1f.js","assets/f55klt1ppf2qkvcm.js","assets/cfvh96gbcjdpth1v.js","assets/kxggiygl9l9wvt1i.js","assets/m5vf38e63o5zwpil.js","assets/lrkrzy6dryttabks.js","assets/dsmgvb64sf3p46z0.js","assets/djzzdnaoqvg0j73r.js","assets/cx73vm87kae7yjob.js","assets/3qaegw5tahuvxmqt.js","assets/oq5ot6nfr5izuy8j.js","assets/f6z90v8o194ltjms.js","assets/on5pusyq8qp7ddxm.js","assets/e61g0qvb4nak98bl.js","assets/fnzd64m6c6nr1y9q.js","assets/clkzaq2ue82unbic.js","assets/huldggq89x8k42xn.js","assets/knox9y5o8wayzcvt.js","assets/gmezro39sx7pylia.js","assets/kh0gitwtnn88bmiu.js","assets/be1jjmyfj67ldije.js","assets/m8cqe5q3w6sbkxog.js","assets/l47qarkimrjcekzk.js","assets/hb7gvbmguhj1ye9u.js","assets/b2w5qfsxz967tcnb.js","assets/n0v4yzxrm6ry3e9y.js","assets/dbmtgsrrmt3lreop.js","assets/o3ts9y7n7vziy25l.js","assets/larbu1qzw78jtkka.js","assets/ovb5kep42p2245u0.js","assets/m89x2zftpo6hrypr.js","assets/n8jmpr6zz1wdkuah.js","assets/mjyf4htuopss3vc7.js","assets/kagkxfhdgfecf5mj.js","assets/e1a7vwuqoah2oayi.js","assets/noatv9rm421ruoof.js","assets/kb3phtht4s5rhb60.js","assets/bol4u3fhxl3qevnk.js","assets/gy64pge8qevmvg7e.js","assets/fzmfci967s5k1wuo.js","assets/g549sgbpr5cp6cvm.js","assets/jhtry11ljwp90don.js","assets/ced3w4iko87xbhmy.js","assets/fm63ou1k4lfiij20.js","assets/fzrn137102spawew.js","assets/e9lafxuzyeh4418f.js","assets/jy3dt8r0gwwixm3r.js","assets/bsl07ehiis3tpn40.js","assets/mpssb3y10pcwu0wn.js"])))=>i.map(i=>d[i]);
import{al as ht,cM as rn,dt as ao,Q as ae,r as Q,a4 as sr,C as ro,fN as nr,cN as or,aj as io,q as Oe,s as Qe,cd as Js,bA as lo,D as Qs,H as At,L as Lt,ab as Le,bh as Ce,dT as st,af as nl,c2 as ol,dg as co,P as W,a as U,bR as ee,dd as al,bl as Ve,bm as $e,bb as nt,hE as pa,b3 as ot,hF as rl,d as B,hG as il,S as je,h as pt,b$ as Vs,a5 as ds,I as uo,c5 as ga,c1 as us,ai as ye,bk as mo,bj as ln,bT as qt,V as _t,hH as ar,aF as fa,e as ll,j as cl,a0 as Ot,$ as Dn,ba as qn,ao as Ee,bC as ho,dl as Xs,ap as zt,m as tt,ag as dl,eA as po,bP as ms,eF as xa,cp as ul,cn as ml,bS as hl,df as rr,gm as pl,J as cn,gs as gl,ad as ir,dc as fl,eE as xl,hI as Sl,gn as go,eh as vl,ge as bl,gf as yl,bv as wl,gG as jl,hJ as Cl,c0 as fo,gx as Ml,hK as Tl,cL as kl,eY as _l,fp as Al,aK as Nl,aE as $s,bz as lr,fQ as El,fP as xo,hL as So,gE as vo,c3 as rs,E as cr,aC as Sa,bO as Rl,N as hs,ey as dr,Y as Ft,d4 as ur,be as Pl,hM as Il,bw as Hl,e6 as Vn,fy as Dl,o as cs,aD as Bl,e7 as Zs,b8 as Ds,O as mr,U as Fl,bW as Ll,u as hr,fO as Ol,eP as Ul,M as zl,bB as Gl,bV as Wl,dP as ql,gB as Vl,hN as $l,by as Yl}from"./dze2l9y9kn6nwat0.js";import{r as i,h as bo,c as we,j as e,L as $n,M as H,d as dn,R as yo,au as ne,b5 as Kl,aw as ps,a as pr,z as Jl,v as Ql,b6 as Xl,b2 as Zl,a$ as va}from"./cg166fqqcxkeiosv.js";import{u as ec}from"./h83rc28v2vsm5nda.js";import{gb as gr,o8 as tc,o9 as sc,a6 as wo,ed as K,h8 as en,oa as Bn,h6 as nc,a7 as un,cA as jo,hL as Ys,e2 as gs,ob as Co,m as Nt,jM as oc,bR as Yn,an as ac,o as ba,ab as rc,at as ic,fB as lc,au as cc,aF as Mo,cf as mn,jk as To,gq as dc,h5 as uc,i as mc,oc as bt,bB as hc,bJ as fr,cI as ko,od as Kn,oe as Fn,of as pc,og as Bs,oh as gc,gV as fc,eS as qe,md as xc,l$ as ya,gU as Sc,eT as vc,oi as bc,iQ as Fs,oj as yc,z as _o,d8 as wc,u as jc,ok as Cc,fV as Mc,cx as Ao,x as Tc,ol as kc,hU as _c,om as Ac,on as Nc,oo as hn,op as Ec,oq as Rc,ae as mt,or as tn,i3 as No,c2 as Pc,ju as xr,os as Eo,f3 as Ut,ot as Sr,ou as vr,e_ as Re,ov as We,gY as br,ow as Ic,lo as yr,lr as wr,gs as Hc,B as Ro,g4 as Dc,ln as Bc,af as ut,ox as jr,e4 as Fc,oy as Lc,oz as Gt,kE as Cr,oA as V,oB as Mr,oC as Tr,oD as Oc,oE as Uc,oF as zc,oG as Gc,oH as Wc,oI as qc,oJ as Vc,gp as $c,oK as Yc,oL as Kc,oM as Jc,oN as Qc,oO as Xc,oP as Zc,oQ as ed,oR as td,oS as sd,oT as nd,oU as od,oV as ad,oW as rd,oX as id,oY as ld,oZ as cd,o_ as dd,o$ as kr,a5 as is,p0 as _r,kQ as Ar,p1 as sn,E as ud,O as md,fX as hd,gX as Po,fe as Nr,p2 as pd,p3 as gd,dY as Wt,p4 as fd,cG as Er,p5 as Rr,p6 as xd,p7 as Sd,J as vd,dB as Pr,p8 as bd,ah as yd,p9 as wd,cd as Io,ce as Ir,dw as jd,dx as Hr,pa as Cd,dT as wa,pb as Md,pc as Td,ck as Ls,ch as kd,jv as _d,lD as ja,pd as Ad,pe as Nd,pf as Ed,hA as Dr,pg as Rd,ph as Pd,hB as Br,jf as Ho,e5 as Id,cg as Hd,pi as Dd,iW as Bd,lJ as Fd,iX as Ld,iY as Od,pj as Ud,ci as Ks,i7 as zd,pk as Gd,pl as Wd,pm as qd,pn as Vd,U as nn,po as Bt,hf as $d,f6 as Yd,dm as Kd,pp as Jd,pq as Qd,jc as Xd,gZ as Zd,mB as eu,pr as tu,g$ as su,h0 as nu,ps as ou,pt as au,pu as ru,pv as iu,pw as lu,px as cu,di as du,i_ as uu,gO as mu,dS as hu,nf as pu,mE as gu,py as fu,pz as xu,pA as Jn,pB as Su,cn as vu,f1 as Fr,pC as bu,pD as yu,pE as Lr,jH as Do,f4 as on,h9 as wu,hc as ju,hd as Cu,i2 as Mu,pF as Qn,d as Or,pG as Ca,pH as Tu,pI as ku,nE as _u,e$ as Au,pJ as Nu,ly as Ur,f0 as Eu,pK as Ru,pL as Pu,fR as Iu,pM as Hu,pN as Du,pO as Bu,pP as Fu,pQ as Lu,lL as Ou,pR as Uu,pS as Os,fF as zr,pT as zu,dX as Gu,pU as Gr,pV as Wu,ic as an,pW as Xn,pX as qu,pY as Vu,pZ as Us,p_ as $u,cB as Yu,cC as Ku,bI as Wr,cU as qr,gH as Vr,gJ as $r,d6 as Ju,p$ as Qu,j6 as Xu,q0 as Zu,q1 as em,q2 as tm,q3 as Yr,q4 as sm,q5 as nm,q6 as om,cc as am,dh as rm,ib as im,q7 as lm,q8 as cm,go as Ln,gG as dm,gI as um,hZ as mm,q9 as hm,qa as pm,qb as gm,qc as fm,qd as xm,qe as Sm,qf as vm,qg as bm,qh as ym,dl as wm,qi as jm,qj as Cm,qk as Mm,lv as Tm,lw as km,lu as _m,ql as Am,i5 as Nm,qm as Em,hC as Rm,hE as Pm,H as Im,gE as Hm,j4 as Dm,j5 as Bm,nv as Fm,hQ as Lm,hD as Om,n1 as Um,cW as zm,cV as Gm,cY as Wm,qn as qm,hF as Ma,fW as Vm,cJ as $m,cK as Ym,iK as Km,mz as Jm,hI as Qm,qo as Xm,ag as Zm}from"./j4xe1fdohr6xk09p.js";import{a as Kr,d as eh,c as th}from"./jky4nhpbj4n3xuh7.js";import{d as Jr,b as pn,e as sh,a as Qr,t as Zn,c as Xr,f as Zr,u as Bo,h as gn,T as nh,i as oh,j as Ta,k as ah,s as rh,l as ih,P as lh}from"./gzm2pyuieq14d2cd.js";import{S as ch,u as fn,G as dh,L as uh,a as mh}from"./765apt28hvug1izo.js";import{u as hh,j as ph,i as gh,S as fh,k as xh,l as Sh,m as vh,n as Fo,s as bh,o as yh,p as zs,q as wh,r as jh,t as xn,C as ei}from"./m4iicmyh3x1nme4j.js";import{B as Ch}from"./f55klt1ppf2qkvcm.js";import{u as Mh,g as Th}from"./cfvh96gbcjdpth1v.js";import{C as eo,g as kh}from"./kxggiygl9l9wvt1i.js";const On="m",_h=2e3;function Ah(t){const{clientThreadId:s,handleRequestCompletion:a}=t,o=i.useRef(!1),n=i.useRef(null),{isLoading:r,data:l}=ht(),{isLoading:c,data:u}=rn(),p=u&&ao(u),m=ae(s,Q.hasUserMessage),d=sr(u),[h,v]=bo(),g=ro(),b=i.useCallback(async({content:M,attachments:L},k,x)=>{const j=gr(),N=L.length>0?{attachments:L}:{};N.system_hints=k.systemHints,Object.keys(j).length>0&&(N.__internal={search_settings:j}),Kr(s),a({promptMessage:nr(M,N),requestedModelId:x,eventSource:"url",completionMetadata:k})},[s,a]),C=or(()=>window.location.pathname)??null,S=tc();let w=!r&&!c&&C!=null;const[T,_]=i.useState(!0);return i.useEffect(()=>{if(!T||o.current)return;const M=io(Oe(s)?.mode);if(!w||M==null)return;if(!Eh(C)||Nh(C)&&S===void 0||Qe(s)!=null){_(!1);return}const L=(()=>{try{return Object.fromEntries(new URLSearchParams(location.hash.slice(1)).entries())}catch{return{}}})(),k={...Object.fromEntries(h),...L},{[Bn]:x,[On]:j,[nc]:N}=k,E=(typeof x=="string"?x:null)??(typeof j=="string"?j:null);if(!E||!E.trim()){_(!1);return}else n.current=Date.now();const R=sc(N);o.current=!0;let f=wo(l);if(R.has(K.Search)&&!en(f,Js.Search)&&l)for(const P of l.models.values())en(P,Js.Search)&&(f=P);const F=N?.includes(K.Search);(t.prefetchSearchPromise??Promise.resolve(null)).then(P=>{v(I=>{const A=new URLSearchParams(I);return A.delete(Bn),A.delete(On),A.append("model",f.id),A}),b({content:E,attachments:[]},{conversationMode:M,source:"instant-query",systemHints:N?Array.from(R):void 0,prefetchIds:P!=null?[P]:void 0,searchSource:F?lo.URL_SEARCH_HINT:void 0},f?.id),P!=null&&Qs.addFirstTiming("createCompletion.prefetchSearch")})},[r,c,w,C,l,p,d,b,T,s,S,g,t.prefetchSearchPromise,h,v]),T&&(t.prefetchSearchPromise!=null||h.has(Bn)||h.has(On)?!0:n.current?m||Date.now()-n.current>_h?(n.current=null,_(!1),!1):!0:!1)}function Nh(t){return ti(t)}function ti(t){return t==null?!1:/^\/g\/[\w-]+$/.test(t)}function Eh(t){return t==null?!1:t==="/"||ti(t)}function si(t){const{currentModelId:s}=hh(),a=un(t),[o,n]=ae(t,d=>[Q.hasUserMessage(d),Q.getGizmoId(d)]),r=At(),l=jo(s),c=Lt(t)&&!o&&(Ys(a)||a?.kind===Le.GizmoTest),u=gs(n);return{showEmptyState:c,canUseNewHomepage:c&&u||c&&!n&&!l&&!r}}const ka=Ce.button`max-w-28 xs:max-w-40 sm:max-w-60 md:max-w-none group flex cursor-pointer items-center gap-1 rounded-lg py-1.5 ${({$shimmer:t})=>t?"loading-shimmer":""} ${({$isScreenArch:t})=>t?"text-md px-1":"px-1 text-lg"} hover:bg-token-main-surface-secondary radix-state-open:bg-token-main-surface-secondary font-semibold text-token-text-secondary overflow-hidden whitespace-nowrap`;function Rh({conversation:t,gizmoResource:s,elementRef:a}){const n=ae(t.id,r=>r?.title??null)??t.title;return e.jsx($n,{to:ic(t.id,s),children:e.jsx(ee.Item,{onSelect:()=>{W.logEvent(U.projectsBreadcrumbPickerPickConversation)},icon:lc,children:e.jsx("div",{ref:a,children:n})},t.id)})}function Ph({gizmoId:t,clientThreadId:s,inMobileHeader:a,modelLabel:o,modelPickerContent:n}){const r=we(),c=!Co(t),{data:u}=Nt(t),{items:p,hasNextPage:m,fetchNextPage:d,isLoading:h,isFetchingNextPage:v}=oc(t),g=i.useRef(null),b=i.useCallback(E=>{h||E==null||(g.current?.disconnect(),g.current=new IntersectionObserver(R=>{R[0].isIntersecting&&m&&d()}),g.current.observe(E))},[h,m,d]);i.useEffect(()=>()=>{g.current?.disconnect()},[]);const[C,S,w]=ae(s,E=>[E?.isLoading,E?.title??null,Q.getThreadTitleSource(E)]),T=st(),{showEmptyState:_}=si(s),M=r.formatMessage(Yn.newChatTitle),{resolvedTitle:L,isTypingEffect:k}=ac(s,S,!0);if(!u||_)return null;const x=L==null&&(Lt(s)||w===nl.NewChat),j=C?e.jsx(e.Fragment,{}):e.jsxs(ka,{$isScreenArch:T,$shimmer:x,children:[e.jsxs("div",{className:"truncate",children:[k?e.jsx(cc,{text:L??""}):L??M,c&&e.jsx("span",{className:"relative bottom-[1px] mx-1 inline-block rounded-md bg-token-main-surface-secondary px-1 text-xs leading-4 text-token-text-secondary",children:o})]}),e.jsx(Mo,{className:"icon-md text-token-text-tertiary"})]}),N=u.gizmo.display.name;return e.jsxs("div",{className:"flex items-center gap-0 overflow-hidden whitespace-nowrap px-2 py-1.5",children:[e.jsx(ka,{$isScreenArch:T,children:e.jsx($n,{className:"truncate",to:ba(u),children:N})}),e.jsxs(e.Fragment,{children:[e.jsx(ol,{className:"icon-md text-token-text-tertiary"}),e.jsxs(co,{contentAlign:a?"center":"start",size:"small",onOpenChange:E=>{E&&W.logEvent(U.projectsBreadcrumbPickerOpen)},triggerButton:j,contentClassName:"max-h-[50dvh] overflow-y-scroll",children:[c&&e.jsxs(ee.Sub,{onOpenChange:E=>{E&&W.logEvent(U.projectsBreadcrumbPickerModelPickerOpen)},children:[e.jsx(ee.SubMenuTrigger,{children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-1",children:[e.jsx(H,{id:"ilkdMh",defaultMessage:"Model"}),e.jsx("span",{className:"text-xs font-medium text-token-text-secondary",children:o})]})}),e.jsx(ee.Portal,{children:e.jsx(ee.SubContent,{onClick:()=>{W.logEvent(U.projectsBreadcrumbPickerModelPickerSelect)},children:n})})]}),e.jsx($n,{to:ba(u),children:e.jsx(ee.Item,{onSelect:()=>{W.logEvent(U.projectsBreadcrumbPickerPickNewChat)},icon:rc,children:e.jsx(H,{...Yn.newChatProjectDropdownItem,values:{name:`"${u.gizmo.display.name}"`}})},"new-chat")}),p.filter(E=>E.id!==s).map((E,R)=>{const f=m&&R===p.length-4?b:void 0;return e.jsx(Rh,{elementRef:f,conversation:E,gizmoResource:u},E.id)}),v&&e.jsx("div",{className:"m-4 mb-5 flex justify-center",children:e.jsx(al,{})})]})]})]})}const Ih=Ve(()=>$e(()=>import("./kduuqrx6hin9e9dr.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(t=>t.ThreadHeaderGizmoDropdown)),Hh=Ve(()=>$e(()=>import("./d0cbiu6zi6zdiy98.js"),__vite__mapDeps([7,2,4,1,3,5,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25])).then(t=>t.ConversationHeaderMenuItems));function Dh({clientThreadId:t}){const s=we(),a=At(),o=ae(t,Q.getIsNewConversation),n=dn(),[,r]=bo(),l=()=>{!o&&!a?n({pathname:"/",search:new URLSearchParams({[Fs]:"true"}).toString()}):r(c=>(c.get(Fs)==="true"?c.delete(Fs):c.set(Fs,"true"),c),{replace:o,state:yc()})};return e.jsx(ee.Item,{size:"large",className:"!pr-3",onClick:l,icon:gc,children:e.jsxs("div",{className:"flex grow items-center justify-between gap-2",children:[e.jsx("div",{className:"flex flex-1 items-center gap-3",children:e.jsx(H,{...zo.temporaryChat})}),e.jsx(fc,{enabled:a,label:s.formatMessage({defaultMessage:"Temporary",id:"temporaryChatToggleLabel"}),testId:"temporary-chat-toggle"})]})})}function Bh(t){return t.title?t.title:t.shortLabel}function Lo(t,s){let a=t;if(t===pa.AUTO){const r=s?.categories.filter(({defaultModel:l})=>l!==pa.AUTO);r?.length===1&&(a=r[0].defaultModel)}const o=s?.categories.find(({defaultModel:r})=>r===a);if(o){const{categoryId:r}=o,l=Bh(o);return{selectedCategory:r,modelLabel:l,omitPrefix:!!o.title}}const n=s?.groups.find(({modelIds:r})=>r.includes(a));if(n){const{group:r,shortLabel:l}=n;return{selectedCategory:r,modelLabel:l}}return{selectedCategory:null,modelLabel:null}}function Fh({modelLabel:t}){return e.jsx("span",{className:"overflow-x-clip text-ellipsis text-token-text-secondary",children:t})}function Lh({clientThreadId:t,inMobileHeader:s}){const{isLoading:a,data:o}=ht(),n=il(),l=mn(t).id,c=To();qe.markStart("ThreadModelSelector");const{modelLabel:u,omitPrefix:p}=Lo(l,o),m=Oo(t,c),d=we(),{isUnauthenticated:h}=ot(),v=!h&&!n;u&&qe.markRendered("ThreadModelSelector");const g=st(),b=e.jsxs("div",{className:B(g?"overflow-x-hidden text-ellipsis":"text-token-text-secondary"),children:[p?null:`${xc} `,v?e.jsx("span",{className:"text-token-text-secondary",children:u}):h&&u?e.jsx(Fh,{modelLabel:u}):null]});return m.length?a?null:e.jsx(co,{sideOffset:8,size:"large",triggerButton:e.jsxs(ya,{$isScreenArch:g,style:{viewTransitionName:"var(--vt-thread-model-switcher)"},"aria-label":u?d.formatMessage({id:"JrtGPQ",defaultMessage:"Model selector, current model is {modelLabel}"},{modelLabel:u}):"",children:[b,g?e.jsx(Sc,{className:"icon-md text-token-text-tertiary"}):e.jsx(Mo,{className:"icon-md text-token-text-tertiary"})]}),onOpenChange:C=>{W.logEvent(U.toggleModelSwitcher,{isOpen:C}),je.logEvent("toggle_model_switcher",null,{isOpen:String(C)})},contentAlign:s?"center":"start",testId:"model-switcher-dropdown",children:e.jsx(Uo,{sections:m})}):e.jsx(ya,{className:"cursor-default",children:b})}function Oh({category:t,modelSwitcherDenialsBySlug:s,currentGizmoId:a,currentModelId:o,testId:n}){const{defaultModel:r,label:l,description:c,isBeta:u,isAlpha:p}=t,m=vc(a??"");return e.jsx(Kn,{value:r,currentModelId:o,modelSwitcherDenialsBySlug:s,renderName:d=>e.jsx(to,{name:l,description:c,isDisabled:d,isBeta:u,isAlpha:p}),isSelected:(!a||m)&&o===r,testId:n},r)}function Oo(t,s,a=!1){const o=mn(t),n=o.id,r=nt(t),{data:l}=ht(),{data:c}=rn(),u=dc(r),p=c&&ao(c),m=Qe(t),d=uc({clientThreadId:t}),h=we(),v=!m,{isUnauthenticated:g}=ot(),b=mc(),C=s.find(({categoryId:A})=>A===bt.ALPHA),S=s.find(({categoryId:A})=>A===bt.DATA_CAMPAIGNS),w=s.find(({categoryId:A})=>A===bt.EXPERIMENTS),T=s.find(({categoryId:A})=>A===bt.MAINLINE),_=!!C?.options?.length,M=!!S?.options?.length,L=!!w?.options?.length,k=!!T?.options?.length,x=dn(),j=i.useCallback(()=>{W.logEvent(U.accountPayOpenPaymentFromModelPicker,{content:"gizmo-button"}),hc(x,"Thread header dropdown")},[x]),N=()=>{je.logEvent("chatgpt_model_switcher_plus_upgrade_button_clicked"),W.logEvent(U.modelSwitcherPlusUpgradeButtonClicked),g?b({shouldOpenPaymentModalOnAuth:!0,callback:A=>{W.logSignUpButtonClicked({location:"Model switcher GPT-4 upsell",provider:A})}}):j()},E=[],[R,f]=i.useState(!1),F=e.jsxs(e.Fragment,{children:[a&&e.jsx(rl,{setIsScrolledToEdge:f}),e.jsxs("div",{className:B("mb-1 flex items-center justify-between px-5 pt-2",{"sticky top-0 z-10 bg-token-main-surface-primary py-2":a},{"[box-shadow:--sharp-edge-top-shadow]":a&&R},{"[box-shadow:--sharp-edge-top-shadow-placeholder]":a&&!R}),children:[e.jsx("span",{className:"text-sm text-token-text-tertiary",children:e.jsx(H,{id:"ilkdMh",defaultMessage:"Model"})}),e.jsx("a",{href:"https://help.openai.com/en/articles/7864572-what-is-the-chatgpt-model-selector",target:"_blank",rel:"noreferrer",children:e.jsx(fr,{className:"icon-md h-5 w-5 pl-0.5 text-token-text-tertiary"})})]},"header")]});if(g){const A={id:"modelSection",content:[]};A.content.push(e.jsx(ko,{location:"model-switcher",statsig_login_event:"chatgpt_modelswitcher_login_button_clicked",statsig_signup_event:"chatgpt_modelswitcher_signup_button_clicked"},"noAuthUpsell")),E.push(A)}else if(!p&&!r){const A={id:"modelSection",content:[]};A.content.push(e.jsx(Kn,{value:"",currentModelId:n,onClick:N,modelSwitcherDenialsBySlug:d,isUpgradeUpsell:!0,renderName:G=>e.jsx(to,{icon:bc,isDisabled:G,name:h.formatMessage({id:"mzDzkX",defaultMessage:"ChatGPT Plus"}),description:h.formatMessage({id:"bqTHri",defaultMessage:"Our smartest model & more"})}),isSelected:!1,showNewChatHint:!1},"plusUpgrade")),A.content.push(e.jsx(Kn,{value:Fn.AUTO,currentModelId:n,modelSwitcherDenialsBySlug:d,renderName:G=>e.jsx(to,{icon:pc,name:h.formatMessage({id:"U9E7Rx",defaultMessage:"ChatGPT"}),description:h.formatMessage({id:"n96qML",defaultMessage:"Great for everyday tasks"}),isDisabled:G}),isSelected:!r&&n===Fn.AUTO,showNewChatHint:!0},Fn.AUTO)),E.push(A)}else{const A={id:"modelSection",content:[]};l?.categories.length&&A.content.push(F);const G=new Map;l?.categories.forEach(Y=>{const D=e.jsx(Oh,{category:Y,currentGizmoId:r,currentModelId:n,modelSwitcherDenialsBySlug:d,testId:`model-switcher-${Y.defaultModel}`},Y.categoryId);Y.subcategory?(G.has(Y.subcategory)||G.set(Y.subcategory,[]),G.get(Y.subcategory)?.push(D)):A.content.push(D)}),G.forEach((Y,D)=>{const te=l?.categories.find(re=>re.subcategory===D&&re.defaultModel===o.id);A.content.push(e.jsxs(ee.Sub,{children:[e.jsx(ee.SubMenuTrigger,{"data-testid":D==="More models"?"more-models-submenu":void 0,children:e.jsxs("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:[D,!!te&&e.jsx("div",{className:"truncate text-token-text-tertiary",children:te.label})]})}),e.jsx(ee.Portal,{children:e.jsx(ee.SubContent,{className:"min-w-72",children:Y})})]},D))}),E.push(A)}const P={id:"otherOptionsSection",content:[]},{selectedCategory:I}=Lo(n,l);return v&&(_&&P.content.push(e.jsx(Bs,{isSelected:I===bt.ALPHA,currentModel:o,option:C,modelSwitcherDenialsBySlug:d,displayInFull_INTERNAL_USE_ONLY:!0},C.value)),M&&P.content.push(e.jsx(Bs,{isSelected:I===bt.DATA_CAMPAIGNS,currentModel:o,option:S,modelSwitcherDenialsBySlug:d,displayInFull_INTERNAL_USE_ONLY:!0},S.value)),L&&P.content.push(e.jsx(Bs,{currentModel:o,isSelected:I===bt.EXPERIMENTS,option:w,modelSwitcherDenialsBySlug:d,displayInFull_INTERNAL_USE_ONLY:!0},w.value)),k&&P.content.push(e.jsx(Bs,{isSelected:I===bt.MAINLINE,currentModel:o,option:T,modelSwitcherDenialsBySlug:d,displayInFull_INTERNAL_USE_ONLY:!0},T.value))),P.content.length&&E.push(P),!g&&!r&&!u&&E.push({id:"temporaryChatSection",content:[e.jsx(Dh,{clientThreadId:t},"tempChat")]}),E}function Uh(){const t=we();return e.jsx("div",{className:"border-token-text-quartenary items-center rounded-full border px-1 py-0.5 text-[8px] font-semibold uppercase leading-3 text-token-text-secondary dark:border-token-border-heavy dark:text-token-text-tertiary",children:t.formatMessage(zo.beta)})}function zh(){const t=we();return e.jsx("div",{className:"border-token-text-quartenary items-center rounded-full border px-1 py-0.5 text-[8px] font-semibold uppercase leading-3 text-token-text-secondary dark:border-token-border-heavy dark:text-token-text-tertiary",children:t.formatMessage(zo.alpha)})}function to({isDisabled:t,name:s,icon:a,description:o,extra:n,isBeta:r=!1,isAlpha:l=!1}){let c=s;return r&&(c=e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s}),e.jsx(Uh,{})]})),l&&(c=e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s}),e.jsx(zh,{})]})),e.jsxs("div",{className:"flex items-center gap-3",children:[a&&e.jsx("span",{className:"flex h-7 w-7 flex-shrink-0 items-center justify-center rounded-full bg-token-main-surface-secondary",children:e.jsx(a,{className:"h-4 w-4 text-token-text-primary"})}),e.jsxs("div",{children:[c,e.jsxs("div",{className:B(!t&&"text-token-text-secondary","text-xs"),children:[o,n]})]})]})}function Uo({sections:t}){return e.jsx(e.Fragment,{children:t.map((s,a)=>e.jsxs(yo.Fragment,{children:[a!==0?e.jsx(ee.Separator,{}):null,s.content]},s.id))})}function Gh({clientThreadId:t,inMobileHeader:s=!1}){const a=nt(t),o=gs(a),n=Co(a),{showEmptyState:r}=si(t),{data:l}=Nt(a),{data:c}=ht(),p=mn(t).id,{modelLabel:m}=Lo(p,c),d=To(),h=Oo(t,d,n),v=e.jsx(Lh,{clientThreadId:t,inMobileHeader:s});return a==null?n?e.jsx(Hh,{clientThreadId:t}):v:o?r&&l&&!n?v:e.jsx(Ph,{modelLabel:m??"",modelPickerContent:e.jsx(Uo,{sections:h}),gizmoId:a,clientThreadId:t,inMobileHeader:s}):e.jsx(Ih,{clientThreadId:t,gizmoId:a,inMobileHeader:s})}const zo=pt({alpha:{id:"o5FsPB",defaultMessage:"Alpha"},beta:{id:"XZwFET",defaultMessage:"Beta"},gpt35ShortExplainer:{defaultMessage:"Great for everyday tasks",id:"ModelSwitcher.gpt35ShortExplainer"},modelTunerSmartSelectionTitle:{id:"czjW8I",defaultMessage:"Dynamic"},modelTunerSmartSelectionExplainer:{id:"gp/YH1",defaultMessage:"Optimized for speed and intelligence"},gpt4ShortExplainer:{defaultMessage:"With DALL·E, browsing and analysis",id:"ModelSwitcher.gpt4ShortExplainer"},gpt4ShortExplainerWithoutBrowse:{defaultMessage:"With DALL·E and analysis",id:"ModelSwitcher.gpt4ShortExplainerWithoutBrowse"},gpt4UpsellExplainer:{id:"ModelSwitcher.gpt4Upsell",defaultMessage:"Our smartest and most capable model. Includes DALL·E, browsing and more."},userUpgrade:{id:"ModelSwithcer.upgradeButton",defaultMessage:"Upgrade to Plus"},userUpgradeSignup:{id:"ModelSwitcher.signupUpgradeButton",defaultMessage:"Sign up for ChatGPT Plus"},temporaryChat:{id:"ModelSwitcher.temporaryChat",defaultMessage:"Temporary chat"},shareChat:{id:"ModelSwitcher.shareChat",defaultMessage:"Share chat"}}),Wh=Ve(()=>$e(()=>import("./lrkrzy6dryttabks.js"),__vite__mapDeps([26,2,1,3,27,28,4,5,29,30,31,32,33,20,10,18,21,34,35,36,9,37,38,39,40,16,6,41,15,17,42])).then(t=>t.GizmoUsingAsOwnerNotice)),qh=({clientThreadId:t})=>{const s=_o(h=>h.activeStageSidebar),a=Qe(t),o=wc(Vs.WorkspaceShareLinks),{isUnauthenticated:n}=ot(),r=At(),l=nt(t),c=gs(l),u=jc(),p=o&&a&&!n&&!r&&!c&&!u,m=st(),d=!s&&!(!n&&m);return e.jsx("div",{className:B(!m&&"gap-2",m&&"@lg/screen-composer:gap-1","flex items-center pr-1 leading-[0]"),children:e.jsx(ph,{showShareButton:p,showProfileDropdown:d,clientThreadId:t})})};function Vh({clientThreadId:t,gizmoId:s}){const a=Cc(),{data:o}=Nt(s),n=ds();return e.jsxs(e.Fragment,{children:[e.jsxs(Mc,{className:"max-md:hidden",children:[e.jsxs("div",{className:"absolute start-1/2 ltr:-translate-x-1/2 rtl:translate-x-1/2",children:[o!=null&&n?.isWorkspaceAccount()&&o.gizmo.tags?.includes(Ao.WorkspaceDisabled)&&e.jsx(Wh,{gizmo:o}),e.jsx(Tc,{gizmoId:s,clientThreadId:t})]}),e.jsxs("div",{className:"flex items-center gap-0 overflow-hidden",children:[e.jsx(gh,{clientThreadId:t}),e.jsx(Gh,{clientThreadId:t})]}),e.jsx(qh,{clientThreadId:t})]}),a&&e.jsx(kc,{})]})}function ni({clientThreadId:t}){const s=nt(t),a=uo(),o=st();return a||o?null:e.jsx(Vh,{gizmoId:s,clientThreadId:t})}const _a=Ce.div`m-8 flex flex-col items-center`;function Aa(t){return e.jsx(ne.div,{initial:{opacity:0,translateY:20},animate:{opacity:1,translateY:0,transition:{duration:.5,ease:"easeIn"}},...t})}function $h({clientThreadId:t}){const a=ae(t,n=>n?.promptGptRating)?.gizmoId,{data:o}=Nt(a);return a==null||o==null||!_c(o)?null:e.jsx(Yh,{gizmoId:a})}function Yh({gizmoId:t}){const[s,a]=i.useState(!1),[o,n]=i.useState(!1),r=Ac(t),l=async u=>{a(!0),setTimeout(()=>{n(!0)},5e3),W.logEvent(U.submitInlineRating,{gizmo_id:t,rating:u}),await r.mutateAsync({rating:u})},c=async()=>{n(!0),W.logEvent(U.dismissInlineRating,{gizmo_id:t}),await r.mutateAsync({})};return i.useEffect(()=>{o||W.logEvent(U.showInlineRating,{gizmo_id:t})},[o,t]),o?null:s?e.jsx(_a,{children:e.jsxs(Aa,{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"rounded-lg border border-token-border-heavy p-4",children:e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(H,{id:"gizmo.inlineReview.reviewLeft",defaultMessage:"Feedback sent"}),e.jsx(ga,{onClick:()=>{n(!0)}})]})}),e.jsx("div",{className:"text-xs text-token-text-tertiary",children:e.jsx(H,{id:"gizmo.inlineReview.reviewLeftSubtext",defaultMessage:'To update your rating, click "Send Feedback" in the GPT Menu'})})]})}):e.jsx(_a,{children:e.jsxs(Aa,{className:"flex flex-col items-center gap-4 rounded-lg border border-token-border-heavy p-4",children:[e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(H,{id:"gizmo.inlineReview.prompt",defaultMessage:"How would you rate this GPT so far?"}),e.jsx(ga,{onClick:c})]}),e.jsx(Nc,{rating:void 0,onRating:l})]})})}const oi=new Map([[K.Think,{hover:[U.composerThinkButtonHovered,"composer_think_button_hovered"],enable:[U.composerThinkButtonEnabled,"composer_think_button_enabled"],disable:[U.composerThinkButtonDisabled,"composer_think_button_disabled"]}],[K.Research,{hover:[U.composerResearchButtonHovered,"composer_research_button_hovered"],enable:[U.composerResearchButtonEnabled,"composer_research_button_enabled"],disable:[U.composerResearchButtonDisabled,"composer_research_button_disabled"]}]]);function ai({systemHint:t,logo:s,highlightTooltip:a,isPinnedActive:o=!1,isDisabled:n=!1,composerController:r,analyticsMetadata:l,onClick:c,showLabel:u=!1}){const{name:p,systemHint:m}=t,d=m,{setThreadSystemHintMode:h,clearAllSystemHintModeTriggers:v}=pn(),g=Jr(d),b=!!t.composerBarButtonInfo?.upsell,C=sh.useStore(),[S,w]=i.useState(!1),{value:T}=ye("2454940646"),_=Kl(),M=n||o,L=Qr(),k=[K.Search,K.Think].includes(d);i.useEffect(()=>{n&&L.has(d)&&h(d,!1,l)},[n,d,l,h,L,k]);const x=!n&&(g||a),j=e.jsxs("button",{className:B("flex h-9 min-w-8 items-center justify-center rounded-full border border-token-border-light p-2 text-[13px] font-medium radix-state-open:bg-black/10",{"transition-all duration-75":S},{"text-token-text-secondary":!g&&!a&&!o},{"bg-blue-250 text-blue-1000 dark:bg-[#2A4A6D] dark:text-[#48AAFF]":!!x||o,"can-hover:hover:bg-[#BDDCF4] dark:hover:bg-[#1A416A]":x&&!o||o,"can-hover:hover:bg-token-main-surface-secondary dark:can-hover:hover:bg-gray-700":!o&&!x},{"focus-visible:outline-black can-hover:hover:bg-black/10 dark:focus-visible:outline-white":!x&&!o},{"opacity-30":n&&!o,"opacity-50":o}),"aria-pressed":g,"aria-label":p,disabled:M,onTransitionEnd:()=>w(!1),onClick:N=>{if(N.stopPropagation(),N.preventDefault(),b&&d!==K.Search)return;w(!0);let E=!0;T&&k&&(C.getState().persistedSystemHints.has(K.Search)||C.getState().persistedSystemHints.has(K.Think))&&(E=!1),E&&v(),h(d,!g,l),g||(r.removeSystemHints(),r.focus());const{enable:R,disable:f}=oi.get(d)??{},[F,P]=(g?f:R)??[];F&&P&&W.logEventWithStatsig(F,P,l),c?.(N)},children:[s,u&&e.jsx("div",{className:"whitespace-nowrap pl-1 pr-1 [display:--force-hide-label]",children:p}),e.jsx(ps,{children:!u&&g&&e.jsx(ne.span,{initial:{x:-10,width:0,opacity:0},animate:{x:0,width:"fit-content",opacity:1},exit:{x:-10,width:0,opacity:0},transition:{ease:"easeOut",duration:_?0:.15},children:e.jsx("div",{className:"whitespace-nowrap pl-1 pr-2 [display:--force-hide-label]",children:p})})})]});return b?e.jsx(mo,{children:e.jsx(co,{triggerButton:j,sideOffset:0,alignOffset:0,children:e.jsx(ko,{location:d,statsig_login_event:"chatgpt_composer_upsell_login_button_clicked",statsig_signup_event:"chatgpt_composer_upsell_signup_button_clicked"})})}):j}function Kh({composerController:t,systemHint:s,highlightTooltip:a,composerBarButtonInfo:o,isDisabled:n,clientThreadId:r,showLabel:l,isPinnedActive:c,currentModelName:u,disabledReason:p}){const m=Jr(s.systemHint),d={clientThreadId:r};return e.jsx(Xh,{composerBarButtonInfo:o,highlightTooltip:a,isThreadInSystemHintMode:m,isDisabled:n,isPinnedActive:c,analyticsMetadata:d,systemHint:s.systemHint,currentModelName:u,disabledReason:p,children:e.jsx(ai,{highlightTooltip:a,isDisabled:n,isPinnedActive:c,systemHint:s,logo:e.jsx(hn,{svgString:s.logo,className:"h-[18px] w-[18px]"}),composerController:t,analyticsMetadata:d,showLabel:l})})}function Jh(t){const s=Eo(),a=mt(t);return!a.isLoading&&a.eligible&&!s}const Qh={p:t=>{const{node:s,children:a,...o}=t;return e.jsx("p",{...o,className:"text-start !text-sm !leading-6 text-white",children:a})},a:t=>{const{node:s,children:a,...o}=t;return e.jsx("a",{...o,className:"!text-sm !leading-6 !text-white !underline",children:a})}};function Xh({children:t,highlightTooltip:s,isThreadInSystemHintMode:a,isDisabled:o,isPinnedActive:n,systemHint:r,composerBarButtonInfo:l,analyticsMetadata:c,currentModelName:u,disabledReason:p}){const m=Ec(),d=Rc(),h=Jh(l.announcementKey)&&!m&&!a&&!d,v=mt(l.announcementKey),g=we();return h?e.jsx(No,{announcementKey:l.announcementKey,side:"bottom",show:!0,theme:"bright",dismissOnOutsideClick:!0,badge:"new",title:l.nuxTitle,onDismiss:v.markAsViewed,sideOffset:0,className:"!max-w-2xs xs:!max-w-sm",description:e.jsx(Pc,{componentOverrides:Qh,children:l.nuxDescription}),children:e.jsx("div",{children:t})}):e.jsx("div",{children:e.jsx(us,{sideOffset:0,label:o?p===tn.HasAttachedFiles?g.formatMessage({id:"z7E1Px",defaultMessage:"Reason disabled for attachments"}):p===tn.DeepResearchHighLoad?g.formatMessage({id:"UrDtrS",defaultMessage:"Deep research is temporarily unavailable"}):l.disabledText:n?g.formatMessage({id:"gFCsls",defaultMessage:"You've selected a thinking model {modelName}"},{modelName:`(${u})`}):l.tooltipText,side:"bottom",open:s||void 0,onOpenChange:b=>{if(b){const{hover:C}=oi.get(r)??{},[S,w]=C??[];S&&w&&W.logEventWithStatsig(S,w,c)}},children:t})})}function Na({logo:t,onClick:s,showLabel:a,label:o,showRemoveIcon:n=!1}){return e.jsxs("button",{type:"button",className:"flex h-9 items-center gap-2 overflow-hidden rounded-full border border-token-border-light bg-blue-250 px-2 text-blue-1000 focus-visible:outline-black can-hover:hover:bg-[#BDDCF4] dark:bg-[#2A4A6D] dark:text-[#48AAFF] dark:hover:bg-[#1A416A] dark:focus-visible:outline-white","aria-label":a?void 0:o,onClick:s,children:[e.jsxs("div",{className:"flex h-full items-center justify-center text-[13px] font-semibold",children:[t,a&&e.jsx("div",{className:"pl-1 [display:--force-hide-label]",children:o})]}),n&&e.jsx("div",{className:"flex h-full items-center justify-center",children:e.jsx(xr,{className:"h-[16px] w-[16px] text-blue-1000 dark:text-[#48AAFF]"})})]})}const Gs={initial:{opacity:0,y:20,scale:.9},animate:{opacity:1,y:0,scale:1},transition:{delay:.1},exit:{opacity:0,scale:.5,transition:{duration:.2}}},Zh=({suggestions:t,onSelectingSuggestedReply:s})=>e.jsx("div",{className:"absolute bottom-full flex w-full max-w-[100vw] grow gap-2 overflow-auto px-1 pb-1 contain-inline-size sm:mb-0 sm:justify-start sm:px-2 sm:pb-0 md:static md:mb-2 md:max-w-none md:justify-center md:overflow-visible",children:t.slice(0,2).map((a,o)=>e.jsx(ne.div,{initial:Gs.initial,animate:Gs.animate,transition:{delay:(o-1)*Gs.transition.delay},exit:Gs.exit,children:e.jsx(qt,{as:"button",color:"secondary",size:"small",onClick:()=>{s(a,t,o)},className:"group whitespace-nowrap md:whitespace-normal",children:e.jsx(tp,{suggestion:a})},o)},o))});function ep({suggestions:t,onSelectingSuggestedReply:s,clientThreadId:a}){const o=t?.length>0;i.useEffect(()=>{o&&Ut(t,a)},[o,a]);const{isUnauthenticated:n}=ot();return o?t.every(Sr)?e.jsxs(ne.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:"flex flex-col items-center",children:[n&&e.jsx(ln,{className:"mb-6 h-12 w-12 sm:hidden"}),e.jsx(ch,{starterPrompts:t,onSelectStarterPrompt:s})]}):t.every(vr)?e.jsx(Zh,{suggestions:t,onSelectingSuggestedReply:s}):null:null}function tp({suggestion:t}){return vr(t)?e.jsx(e.Fragment,{children:t.text}):Sr(t)?e.jsxs("div",{className:"flex flex-col overflow-hidden",children:[t.title&&e.jsx("div",{className:"truncate font-semibold",children:t.title}),e.jsx("div",{className:B("truncate font-normal",t.title?"opacity-50":""),children:t.body})]}):null}function sp(){const{store:t}=Re(),s=t.useSharedProps();return s?e.jsx(np,{...s}):null}function np({clientThreadId:t,suggestions:s}){const a=fn();return s===void 0||s.length===0?null:e.jsx("div",{children:e.jsx(op,{children:e.jsx("div",{className:"grow",children:s!==void 0&&e.jsx(ep,{suggestions:s,onSelectingSuggestedReply:a,clientThreadId:t})})})})}const op=Ce.div`h-full flex ml-1 md:w-full md:m-auto gap-0 md:gap-2 justify-center`,ri=({className:t,children:s})=>e.jsx(ne.div,{className:t,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,transition:{duration:.1,delay:0}},transition:{type:"tween",duration:.3,delay:.2},children:s});function ap({canContinue:t,onContinueGenerating:s}){const a=i.useCallback(()=>{s(),Zn()},[s]);let o=null;return t&&(o=e.jsx(ip,{onHandleContinueGenerating:a})),o&&e.jsx("div",{className:"flex h-full w-full items-center justify-end gap-0 py-4 md:gap-2",children:o})}function rp({className:t}){return e.jsx(br,{className:B("-rotate-180",t)})}const ip=({onHandleContinueGenerating:t})=>e.jsx(ri,{children:e.jsx(qt,{as:"button",color:"secondary",onClick:t,className:"whitespace-nowrap py-2",icon:rp,size:"small",children:e.jsx(H,{...We.continueGenerating})})}),lp=({clientThreadId:t})=>{const s=ar(),a=ae(t,Q.getRequestId),o=_t(a);i.useEffect(()=>{o&&fa.dismissBanner()},[o]);const n=s?.is_dismissible?()=>fa.dismissBanner():void 0;return e.jsx(ps,{children:s&&e.jsx(ne.div,{transition:{type:"tween",ease:"easeInOut",duration:.1},initial:{opacity:0,transform:"translateY(8px)"},animate:{opacity:1,transform:"translateY(0px)"},exit:{opacity:0,transform:"translateY(8px)"},children:e.jsx(Ic,{clientThreadId:t,rateLimitInfo:s,onDismiss:n})})})};function cp(t){const s=ae(t,Q.getRequestId),a=_t(s),o=ar();return!a&&o!=null}const so=window.sessionStorage,no=ll(cl(()=>({memoryFullBannerDismissed:!!so?.getItem(Ot.MemoryFullBannerDismissed)}))),ii={dismissBanner(){no.setState(t=>{t.memoryFullBannerDismissed=!0}),so?.setItem(Ot.MemoryFullBannerDismissed,"true")},clearDismissedBanner(){no.setState(t=>{t.memoryFullBannerDismissed=!1}),so?.removeItem(Ot.MemoryFullBannerDismissed)}};function dp(t){const s=nt(t),a=yr(),{data:o}=wr(s,!1,a),n=o!=null,r=n&&o.memoryFullPct>=100,[l,c]=i.useState(!1);i.useEffect(()=>{!r&&n&&(c(!0),ii.clearDismissedBanner())},[r,n]);const u=no(p=>p.memoryFullBannerDismissed);return r&&l&&!u}function up(){const t=we(),{openSettings:s}=Hc();return e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},children:e.jsx(Ro,{title:t.formatMessage(Ws.memoryFullTitle),content:t.formatMessage(Ws.memoryFullTooltip,Ws.memoryFullTooltip.values),primaryCtaText:t.formatMessage(Ws.memoryManageButton),onPrimaryCtaClick:()=>s(Dc.Personalization),onDismiss:()=>ii.dismissBanner()})})}const Ws=pt({memoryFullTitle:{id:"yRGU2/",defaultMessage:"Memory is full."},memoryManageButton:{id:"a5A88o",defaultMessage:"Manage"},memoryFullTooltip:{id:"neUc+N",defaultMessage:"New memories won’t be created until you make space. <a>Learn more</a>",values:{a:t=>e.jsx("a",{href:Bc,target:"_blank",rel:"noopener noreferrer",className:"underline",children:t})}}}),Go=ut.hasSeenMemoryInSearch;function mp(){const t=dn();i.useEffect(()=>{W.logEventWithStatsig(U.chatgptMemoryInSearchAnnouncementShown,"chatgpt_memory_in_search_announcement_shown")},[]);const{markAsViewed:s}=mt(Go),a=i.useCallback(()=>{W.logEventWithStatsig(U.chatgptMemoryInSearchAnnouncementClosed,"chatgpt_memory_in_search_announcement_closed"),s()},[s]),o=i.useCallback(()=>{W.logEventWithStatsig(U.chatgptMemoryInSearchAnnouncementCTAClicked,"chatgpt_memory_in_search_announcement_cta_clicked"),t("#settings/Personalization"),s()},[s,t]);return e.jsx(Ro,{onPrimaryCtaClick:o,primaryCtaText:e.jsx(H,{id:"8MwdJw",defaultMessage:"Settings"}),onDismiss:a,content:e.jsxs("div",{className:"flex-grow",children:[e.jsx("div",{className:"mb-0.5 font-semibold",children:e.jsx(H,{id:"Sdp8JT",defaultMessage:"Search, now with memory"})}),e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(H,{id:"a4czFu",defaultMessage:"ChatGPT can now use memories to shape searches it sends to search providers, to give you more relevant answers. You can turn this off at any time in settings. {learnMoreLink}",values:{learnMoreLink:e.jsx("a",{href:"https://help.openai.com/en/articles/9237897-chatgpt-search",target:"_blank",rel:"noopener noreferrer",className:"underline",children:e.jsx(H,{id:"JMsjZT",defaultMessage:"Learn more"})},"learn-more-link")}})})]})})}function li(){const t=mt(Go),{userIsInSearchHoldoutWithWebDisabled:s}=Xr();return t.eligible&&!t.isLoading&&!s}function hp(){const{markAsViewed:t,eligible:s}=mt(Go);return s?t:void 0}const pp=()=>{const{shouldShowSkipButton:t}=jr();return t?e.jsx(ri,{className:"flex justify-center",children:e.jsx(qt,{as:"button",color:"secondary",onClick:()=>Fc.skipParagen(),children:e.jsx(H,{...gp.skip})})}):null},gp=pt({skip:{id:"dvcUbp",defaultMessage:"Skip"}}),fp=Ve(()=>$e(()=>import("./l47qarkimrjcekzk.js"),__vite__mapDeps([43,2,4,1,3,5,44,45,46])).then(t=>t.JawboneNotificationsBanner)),ci=i.memo(function({className:s}){const{store:a}=Re(),o=a.useIsHeaderContentAreaPopulated();return e.jsx("div",{className:B(s??"absolute bottom-full left-0 right-0",Tr.PromptTextareaHeader),children:e.jsx(Lc,{shouldRender:o,contentArea:Gt.Header,children:e.jsxs("div",{className:"mb-2 flex flex-col gap-3.5 pt-2",children:[e.jsx(di,{}),e.jsx(ui,{})]})})})});function di(){const{store:t}=Re(),s=t.useSharedProps(r=>r?.clientThreadId),a=t.useContentAreaId(Gt.HeaderTop),o=Cr();let n;switch(a){case V.ProjectConversationTaskNoFileAccess:n=e.jsx(bp,{});break;case V.AdvancedVoiceOnMobileAnnouncement:n=e.jsx(Vc,{clientThreadId:s});break;case V.S09KM1:n=null;break;case V.ParagenControls:n=e.jsx(pp,{});break;case V.ItemActions:n=e.jsx(sp,{});break;case V.BannerSignup:n=e.jsx(vp,{});break;case V.BannerTermsDisclaimer:n=e.jsx(yp,{});break;case V.PromptTextareaAction:n=e.jsx(wp,{});break;case V.BannersRateLimit:n=e.jsx(jp,{});break;case V.BannerSidekickAnnouncement:n=e.jsx(qc,{});break;case V.SearchBrowserExtensionAnnouncement:n=e.jsx(xh,{});break;case V.MemoryInSearchAnnouncement:n=e.jsx(mp,{});break;case V.MoonshineAnnouncement:n=e.jsx(Wc,{});break;case V.CustomizeChatGPTAnnouncement:n=e.jsx(Gc,{});break;case V.SearchBrowserExtensionReactiveAnnouncement:n=e.jsx(fh,{});break;case V.BannerMemoryFull:n=e.jsx(up,{});break;case V.Box:n=e.jsxs("div",{className:"flex h-20 w-full items-center justify-center gap-2 bg-red-500 p-2",children:["box",e.jsxs("div",{className:"flex h-full w-full items-center justify-center gap-2 bg-blue-500 p-2",children:["inner",e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-yellow-400 text-center",children:"actual content"})]})]});break;case V.JawboneAnnouncement:o?n=e.jsx(fp,{}):n=null;break;case V.JawboneMaxActiveAnnouncement:o?n=e.jsx(zc,{}):n=null;break;case V.PromoRedemptionAnnouncement:n=e.jsx(Uc,{});break;case V.OperatorAnnouncement:n=e.jsx(Oc,{});break;default:n=null;break}return n}function ui(){const{store:t}=Re(),s=t.useContentAreaId(Gt.HeaderBottom);let a;switch(s){case Mr.DallePromptControls:a=e.jsx(Sp,{});break;default:a=null;break}return a}const xp=Ve(()=>$e(()=>import("./dbmtgsrrmt3lreop.js"),__vite__mapDeps([47,2,1,3,4,5,10,48])).then(t=>t.default));function Sp(){const{store:t}=Re(),s=t.useSharedProps(a=>a?.composerController);return s?e.jsx(xp,{composerController:s}):null}function vp(){const{store:t}=Re(),s=t.useSharedProps(n=>n?.clientThreadId),a=$c(),o=Yc();return s?a?e.jsx(Kc,{threadId:s,showSignUp:o}):e.jsx(Jc,{threadId:s,showLogin:o}):null}function bp(){return i.useEffect(()=>()=>{Dn.getItem(Ot.TasksHasSeenProjectDisclaimerBanner)||Dn.setItem(Ot.TasksHasSeenProjectDisclaimerBanner,!0)},[]),e.jsx(Ro,{icon:e.jsx(fr,{}),title:e.jsx(H,{id:"ibX3g7",defaultMessage:"Tasks can’t access project files"}),content:e.jsx(H,{id:"fm94Tm",defaultMessage:"There’s a task in this conversation — just FYI, it won’t be able to access project files."}),onDismiss:()=>{Dn.setItem(Ot.TasksHasSeenProjectDisclaimerBanner,!0)}})}function yp(){const{store:t}=Re(),s=t.useSharedProps(a=>a?.clientThreadId);return s?e.jsx(Qc,{threadId:s}):null}function wp(){const{store:t}=Re(),s=t.useSharedProps();return s?e.jsx(ap,{...s}):null}function jp(){const{store:t}=Re(),s=t.useSharedProps(a=>a?.clientThreadId);return s?e.jsx(lp,{clientThreadId:s}):null}const Cp=5,Mp=i.memo(function(s){return Tp(s),kp(s),_p(),null});function Tp(t){const{store:s}=Re(),a=s.useSetSharedProps();qn(()=>{a(t)},[t,a])}function kp(t){const{clientThreadId:s,canContinue:a}=t,{store:o}=Re(),n=i.useRef({top:o.useContentAreaApi(Gt.HeaderTop),bottom:o.useContentAreaApi(Gt.HeaderBottom)}).current,r=Ep(t),l=Xc(s),{shouldShowBannerSignup:c,shouldShowBannerTermsDisclaimer:u}=Rp(s),p=cp(s),m=Zc(t),d=Sh(t),h=li(),v=Eo(),g=ed(),b=vh(t),C=dp(s),S=td(),w=sd(t),T=nd(s),_=od(s),M=ad(),L=rd(),k=ae(s,j=>j?.modelId),x=un(s);qn(()=>{k&&x?.kind===Le.GizmoInteraction&&x.gizmo&&dd(k,x.gizmo)?n.top.set(V.ProjectConversationTaskNoFileAccess):w.eligible?n.top.set(V.AdvancedVoiceOnMobileAnnouncement):S?n.top.set(V.ParagenControls):u?n.top.set(V.BannerTermsDisclaimer):p?n.top.set(V.BannersRateLimit):T?n.top.set(V.JawboneAnnouncement):_?n.top.set(V.JawboneMaxActiveAnnouncement):m.eligible?n.top.set(V.BannerSidekickAnnouncement):h?n.top.set(V.MemoryInSearchAnnouncement):v?n.top.set(V.MoonshineAnnouncement):g?n.top.set(V.CustomizeChatGPTAnnouncement):d?n.top.set(V.SearchBrowserExtensionAnnouncement):b?n.top.set(V.SearchBrowserExtensionReactiveAnnouncement):M?n.top.set(V.PromoRedemptionAnnouncement):L()?n.top.set(V.OperatorAnnouncement):r?n.top.set(V.ItemActions):a?n.top.set(V.PromptTextareaAction):c?n.top.set(V.BannerSignup):C?n.top.set(V.BannerMemoryFull):n.top.set(null)},[n,r,a,u,c,p,m,C,S,w]),qn(()=>{l&&n.bottom.set(Mr.DallePromptControls)},[n,l])}function _p(){const{store:t}=Re();i.useEffect(()=>()=>{t.reset()},[t])}function Ap(t){const s=kr(),a=ho(t),o=Q.getTree(Oe(t)).getLastValidNode(a)?.message?.id;return s?.messageId===o?s.suggestions:[]}function Np(t){return Ap(t).length>0}function Ep(t){const{value:s}=Ee("1887864177"),a=id(t.clientThreadId),o=Np(t.clientThreadId);return t.isDisabled||s?!1:t.isNewThread||a||o}function Rp(t){const{isUnauthenticated:s}=ot(),a=ho(t),{layer:o}=Xs("3637408529"),{layer:n}=zt("3637408529"),r=n.get("no_auth_banner_signup_rate_limit",Cp),l=o.get("should_show_no_auth_signup_banner",!0),c=ld(g=>g.bannerDisclaimerClientThreadId),u=cd(),p={shouldShowBannerTermsDisclaimer:!1,shouldShowBannerSignup:!1};if(!t)return p;const m=Q.getTree(Oe(t)),d=m.countMessagesByAuthor(tt.User),h=m.getNodeByIdOrMessageId(a),v=h?.message?.author.role===tt.Assistant&&dl(h.message);return p.shouldShowBannerTermsDisclaimer=v&&s&&d===1&&!u&&(c==null||c===t),p.shouldShowBannerSignup=l&&v&&s&&d>0&&d%r===0,p}const Pp=({disabled:t,clientThreadId:s})=>{qe.markStart("ComposerModelSelectorButton",qe.NS_COMPOSER);const a={clientThreadId:s},o=To(),n=Oo(s,o,!0),{isLoading:r,data:l}=ht(),c=ae(s,v=>v?.modelId),u=is(l?.models,c);if(r||!u)return null;const m=l?.categories.find(v=>v.defaultModel===u.id)?.shortLabel??u.title;qe.markRendered("ComposerModelSelectorButton",qe.NS_COMPOSER);function d(){W.logEventWithStatsig(U.composerSystemHintButtonHovered,"composer_model_selector_button_hovered",a)}function h(){W.logEventWithStatsig(U.composerSystemHintButtonClicked,"composer_model_selector_button_clicked",a)}return e.jsx(Ip,{disabled:t,modelLabel:m,onHover:d,onOpen:h,children:e.jsx(Uo,{sections:n})})},Ip=({disabled:t,children:s,modelLabel:a,onHover:o,onOpen:n})=>{const r=we(),[l,c]=i.useState(!1);return e.jsxs(ee.Root,{open:l,onOpenChange:u=>{c(u),u&&n?.()},children:[e.jsx(Hp,{disabled:!!t,children:e.jsx(po,{className:B(_r.toolsButton,"flex h-8 min-w-8 items-center justify-center gap-1 rounded-lg p-1 px-2 text-sm font-semibold text-token-text-secondary hover:bg-black/10 focus-visible:outline-black disabled:opacity-30 radix-state-open:bg-black/10 dark:focus-visible:outline-white"),"aria-label":r.formatMessage({id:"njhg2P",defaultMessage:"Choose a model"}),disabled:t,onPointerOver:o,onClick:u=>{u.preventDefault()},onFocusCapture:u=>{u.stopPropagation()},children:a})}),e.jsx(ee.Portal,{children:e.jsx(ee.Content,{alignOffset:-16,onCloseAutoFocus:u=>{u.preventDefault()},className:"[--radix-popper-available-height:40dvh]",removeVerticalPadding:!0,addBottomGradient:!0,children:e.jsx("div",{className:"flex flex-col",children:s})})})]})},Hp=({disabled:t,children:s})=>e.jsx(us,{side:"right",sideOffset:0,label:t?e.jsx(H,{id:"WU1XH1",defaultMessage:"Model selector unavailable"}):e.jsx(H,{id:"7bVJwH",defaultMessage:"Choose a model"}),children:s});function Dp({composerController:t,isDisabled:s,disabledReason:a,highlightTooltip:o,isPinnedActive:n,clientThreadId:r,showLabel:l,currentModelName:c}){const u=Zr(),p=we(),m=i.useMemo(()=>({clientThreadId:r}),[r]),d=i.useCallback(()=>{W.logEventWithStatsig(U.composerSearchButtonClicked,"composer_search_button_clicked",m),u&&t.trimLeadingText(/^search\b/i)},[m,t,u]),h=i.useMemo(()=>({systemHint:K.Search,description:p.formatMessage({id:"m/oaZE",defaultMessage:"Find on the web"}),logo:"",requiredFeatures:["search"],requiredModels:[],requiredConversationModes:[Le.PrimaryAssistant],name:p.formatMessage({id:"TbHx8d",defaultMessage:"Search"})}),[p]);return e.jsx(Fp,{highlightTooltip:o,analyticsMetadata:m,isThreadUsingSearchMode:u,isDisabled:s||n,disabledReason:a,currentModelName:c,children:e.jsx(ai,{highlightTooltip:o,isDisabled:s||n,isPinnedActive:n,systemHint:h,logo:e.jsx(Ar,{className:"h-[18px] w-[18px]"}),composerController:t,analyticsMetadata:m,onClick:d,showLabel:l})})}function Bp(){const t=li(),s=Eo(),a=mt(ut.hasSeenComposerSearchButtonTooltip);return!a.isLoading&&a.eligible&&!t&&!s}function Fp({children:t,highlightTooltip:s,analyticsMetadata:a,isThreadUsingSearchMode:o,isDisabled:n,disabledReason:r,currentModelName:l}){const c=Bp()&&!o,u=mt(ut.hasSeenComposerSearchButtonTooltip);return c?e.jsx(No,{announcementKey:ut.hasSeenComposerSearchButtonTooltip,side:"right",show:!0,theme:"bright",dismissOnOutsideClick:!0,badge:"new",title:e.jsx(H,{id:"Yjduqi",defaultMessage:"Search the web"}),onDismiss:u.markAsViewed,sideOffset:0,className:"!max-w-2xs xs:!max-w-sm",description:e.jsx(H,{id:"W51Aei",defaultMessage:"Get fast answers with trusted sources. {learnMore}",values:{learnMore:e.jsx(ud,{href:"https://openai.com/index/introducing-chatgpt-search",className:"underline",children:e.jsx(H,{id:"stA7F4",defaultMessage:"Learn more"})})}}),children:e.jsx("div",{children:t})}):e.jsx("div",{children:e.jsx(us,{sideOffset:0,label:n?r===sn.ModelNotSupported?e.jsx(H,{id:"GZemJe",defaultMessage:"Search disabled for {modelName}",values:{modelName:`${l}`}}):r===sn.HasAttachedFiles?e.jsx(H,{id:"Wd1fc2",defaultMessage:"Search disabled for attachments"}):e.jsx(H,{id:"GpDAWD",defaultMessage:"Search is unavailable"}):e.jsx(H,{id:"c+4o2s",defaultMessage:"Search the web"}),side:"bottom",open:s||void 0,onOpenChange:p=>{p&&W.logEventWithStatsig(U.composerSearchButtonHovered,"composer_search_button_hovered",a)},children:t})})}function Lp({composerController:t,clientThreadId:s}){const a=ms(s),o=Bo(),{setThreadSystemHintMode:n,clearAllSystemHintModeTriggers:r}=pn(),{value:l}=Ee("1416952492"),{value:c}=ye("1325692000"),u=gn(s).filter(x=>x.systemHint!==K.Think&&(x.systemHint!==K.Research||!l)&&!x.composerBarButtonInfo?.upsell),[p,m]=i.useState([]),[d,h]=i.useState(void 0),[v,g]=i.useState(0);i.useEffect(()=>{m(d?u.filter(x=>x.name.toLocaleLowerCase().startsWith(d.text.toLocaleLowerCase())||x.systemHint.toLocaleLowerCase().startsWith(d.text.toLocaleLowerCase())):[])},[d]),i.useEffect(()=>{t.view.dispatch(bh(t.view.state.tr,{onHintMatch(x){h(j=>rr(j,x)?j:x)}}))},[t]);const b=!u.length||!p.length||!d;i.useEffect(()=>{b&&g(0)},[b]);const C=p.length,S=i.useCallback(x=>{g(j=>(x(j)%C+C)%C)},[C]),w=p[v],T=({hintToSave:x=w,expectPerfectMatch:j})=>{if(!d||!w||j&&x.name.toLowerCase()!==d.text.toLowerCase())return!1;W.logEvent(U.systemHintSelected,{system_hint:x.systemHint,conversation_id:a??xa});const N=d.range.from===1?x.name:d.text+x.name.slice(d.text.length),E={clientThreadId:s};zs(t.view),o.size>0&&r();const R=!!x.composerBarButtonInfo,f=x.systemHint===K.Search;return c||R||f?(n(x.systemHint,!0,E,f?lo.CONVERSATION_COMPOSER_SLASH_SEARCH:void 0),d.range&&t.delete(d.range.from,d.range.to),t.removeSystemHints(),!0):(t.addSystemHint(x.systemHint,N,d.range.from,d.range.to),!0)},_=i.useRef(T);_.current=T;const M=i.useRef(S);M.current=S;const L=i.useRef(d);L.current=d;const k=t.view;return i.useEffect(()=>(b||yh(k,x=>{if(x==="up")M.current(j=>j-1);else if(x==="down")M.current(j=>j+1);else if(x==="cancel")zs(k),wh(k);else{if(x==="submit")return zs(k),_.current({expectPerfectMatch:!1});if(x==="checkMatch")return _.current({expectPerfectMatch:!0})}}),()=>zs(k)),[b,k]),i.useEffect(()=>{b||W.logEvent(U.systemHintListOpened,{conversation_id:a??xa})},[b]),b?null:e.jsx(ul,{className:"max-w-60",onMouseDown:x=>{x.preventDefault()},children:p.map((x,j)=>e.jsx("div",{onMouseOver:()=>g(j),onClick:()=>{T({hintToSave:x,expectPerfectMatch:!1}),t.focus()},children:e.jsx(ml,{autoFocus:!1,className:"rounded-lg px-1 py-2",$spoofHovered:j===v,children:e.jsx(mi,{title:x.name,description:x.description,logo:x.logo})})},x.systemHint))})}function mi({title:t,description:s,logo:a,checked:o}){return e.jsxs("div",{className:"group inline-flex w-full items-center justify-start gap-2 pl-1.5 pr-3",children:[e.jsx("div",{className:"flex h-7 w-7 items-center justify-center gap-2.5",children:e.jsx(hn,{svgString:a,className:"icon-lg text-token-text-secondary"})}),e.jsxs("div",{className:"shrink grow basis-0",children:[e.jsx("p",{className:"text-sm font-normal leading-tight text-token-text-primary",children:t}),!!s&&e.jsx("p",{className:"text-[13px] font-normal leading-[18px] text-token-text-secondary",children:s})]}),o&&e.jsx(hl,{className:B("icon-md text-token-text-primary",{"group-hover:hidden":!o})})]})}function Op({composerController:t,clientThreadId:s}){return t instanceof Fo?e.jsx(Lp,{composerController:t,clientThreadId:s}):null}function Up({children:t,className:s,showBackground:a}){return e.jsxs("div",{className:"relative",children:[t,a&&e.jsx(ne.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:B("pointer-events-none absolute bottom-0 top-0 h-9 w-9 rounded-full",s)})]})}function Ea({clientThreadId:t,uploadType:s,modelAcceptedMimeTypes:a,modelSupportedImageMimeTypes:o,attachmentsProductFeature:n,getInputProps:r,openFileDialog:l,onOauthRedirect:c,historyDisabled:u,isNested:p,isDisabled:m,highlightTooltip:d,disabledReason:h,currentModelName:v,showLabel:g,showUpsell:b}){const C=md(),{gdriveStatus:S,o365Status:w}=hd(),T="h-[18px] w-[18px]",_=u?"text-white":d?"text-brand-blue-800":"",M=b?e.jsx(Po,{"aria-label":"",className:B(T,_)}):e.jsx(Nr,{"aria-label":"",className:B(T,_)}),k=(S!=="false"||w!=="false"||C)&&!b?e.jsx(pd,{clientThreadId:t,icon:M,modelAcceptedMimeTypes:a,modelSupportedImageMimeTypes:o,attachmentsProductFeature:n,onOauthRedirect:c,uploadType:s,openFileDialog:l,isNested:p,getInputProps:r,isDisabled:m,highlightTooltip:d,disabledReason:h,currentModelName:v}):e.jsx(gd,{clientThreadId:t,uploadType:s,openFileDialog:l,getInputProps:r,showLabel:g,showUpsell:b,icon:M,isDisabled:m,highlightTooltip:d,disabledReason:h,currentModelName:v});return p?k:e.jsx("div",{className:"relative",children:e.jsx(Up,{showBackground:d,className:"bg-brand-blue-800/20",children:k})})}function zp({suggestions:t,composerController:s,onSelect:a,onChange:o}){const n=fn(),r=i.useCallback((m,d,h)=>{a?.(m,d,h),n(m,d,h)},[a,n]),[l,c]=i.useState(-1),[u,p]=i.useState(!1);return i.useEffect(()=>{const m=d=>{if(!d.isComposing)if(d.key==="ArrowDown"){const h=l===t.length-1?0:l+1;c(h),o?.(h,!0,t[h])}else if(d.key==="ArrowUp"){d.preventDefault();const h=l<=0?t.length-1:l-1;c(h),o?.(h,!0,t[h])}else d.key==="Enter"&&!d.shiftKey&&t[l]&&r(t[l],t,l)};return s.subscribe("keydown",m)},[t,l,o,r,s]),i.useEffect(()=>s.subscribe("blur",()=>{c(-1),o?.(-1,!1)}),[s,o]),i.useEffect(()=>{if(!u){const m=()=>{p(!0),window.removeEventListener("mousemove",m)};return window.addEventListener("mousemove",m),()=>{window.removeEventListener("mousemove",m)}}},[u]),i.useEffect(()=>{c(-1),o?.(-1,!1),p(!1)},[t,o]),e.jsx(ne.ul,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"hidden w-full flex-col p-2.5 group-focus-within:flex group-focus-within:max-lg:flex-col-reverse",children:t.map((m,d)=>e.jsxs(ne.li,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:d*.03},exit:{opacity:0,translateY:4},className:"w-full",children:[d>0&&e.jsx("div",{className:B("h-[1px] opacity-60 max-lg:hidden",l===d||l===d-1?"mx-2 bg-token-main-surface-secondary":"bg-token-border-light")}),e.jsxs("button",{className:B("flex w-full cursor-pointer items-center justify-start whitespace-pre-wrap rounded-lg px-2.5 py-3 text-start",l===d?"bg-token-main-surface-secondary":"bg-token-main-surface-primary"),onClick:h=>{h.preventDefault(),r(m,t,d)},onMouseDown:h=>{h.preventDefault()},onMouseEnter:()=>{u&&(c(d),o?.(d,!1,m))},onMouseLeave:()=>{c(-1),o?.(-1,!1,m)},children:[m.icon?e.jsx("span",{className:"mr-4 h-6 w-6 text-token-text-secondary",children:m.icon}):null,e.jsx("span",{className:"whitespace-pre-wrap",children:m.autocompletionChunks&&m.autocompletionChunks.length>0?e.jsx(e.Fragment,{children:m.autocompletionChunks.map((h,v)=>e.jsx("span",{className:B(h.isMatched?"text-token-text-tertiary":"text-token-text-primary"),children:h.text},v))}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:B(m.type===Wt.Starter||m.type===Wt.Trending?"text-token-text-secondary":"text-token-text-tertiary"),children:m.title}),e.jsx("span",{className:"text-token-text-primary",children:m.body})]})})]}),d>0&&e.jsx("div",{className:B("h-[1px] opacity-60 lg:hidden",l===d||l===d-1?"mx-2 bg-token-main-surface-secondary":"bg-token-border-light")})]},m.id??d))})}function Gp(t,s){t=t.toLocaleLowerCase();const a=s;s=s.toLocaleLowerCase();const o=[];let n=0;for(let c=0;c<s.length&&(n<t.length&&t[n]===s[c]&&(o.push(c),n++),n!==t.length);c++);const r=[];let l=0;if(o.forEach(c=>{if(c>l){const u=a.slice(l,c);u&&r.push({text:u,isMatched:!1})}r.push({text:a[c],isMatched:!0}),l=c+1}),l<s.length){const c=a.slice(l);c&&r.push({text:c,isMatched:!1})}return Wp(r)}function Wp(t){if(t.length===0)return t;let s=[t[0]];for(let o=1;o<t.length;o++){const n=s[s.length-1],r=t[o];n.isMatched===r.isMatched?n.text+=r.text:s.push(r)}const a=s.filter(o=>o.isMatched).reduce((o,n)=>o+n.text.trim().length,0);return s.length<=4&&a>=2?s:[{text:s.map(o=>o.text).join(""),isMatched:!1}]}const qp=i.forwardRef(function({type:s,placeholder:a,replyRegions:o,state:n,renderFiles:r,leftSideActions:l,topRightAction:c,onSubmit:u,setIsComposerOverflowing:p,inputState:m,currentLeafId:d,composerController:h,clientThreadId:v,gizmoId:g,disableReason:b,controlsDisabled:C,setControlsDisabled:S},w){const T=st(),_=fd();i.useState(void 0);let M=null;const{isLoading:L}=_;L||(M=_.modelId);const k=i.useRef(null),[x,j]=i.useState(300);i.useEffect(()=>{k.current&&j(k.current.offsetWidth)},[]),i.useEffect(()=>{L||pl()||h.focus()},[M,h,L]);const{value:N}=ye("3780975974"),{getShowUpsellReason:E}=Er(),R=N||E(),f=I=>{Qp({target:I.target,rootId:"composer-background",additonalInteractiveIds:["reply-regions"]})||h.focus()},F=i.useCallback(()=>h instanceof Rr?e.jsx(Vp,{composerController:h,currentLeafId:d,placeholder:a,inputState:m}):e.jsx(jh,{composerController:h,placeholder:a}),[h,d,a,m]),P=i.useCallback(()=>e.jsx(xd,{inputState:m,state:n,onSubmit:u,composerController:h,clientThreadId:v,gizmoId:g,disableReason:b}),[m,n,u,h,v,g,b]);return e.jsxs("div",{id:"composer-background",ref:w,className:B("flex w-full cursor-text flex-col rounded-3xl border border-token-border-light px-3 py-1 duration-150 ease-in-out contain-inline-size motion-safe:transition-[color,background-color,border-color,text-decoration-color,fill,stroke,box-shadow] dark:border-none dark:shadow-none",s!=="temporary"&&"shadow-[0_9px_9px_0px_rgba(0,0,0,0.01),_0_2px_5px_0px_rgba(0,0,0,0.06)] has-[:focus]:shadow-[0_2px_12px_0px_rgba(0,0,0,0.04),_0_9px_9px_0px_rgba(0,0,0,0.01),_0_2px_5px_0px_rgba(0,0,0,0.06)]",T&&"backdrop-blur-2xl no-transparency:backdrop-blur-none",T&&s!=="temporary"&&"bg-token-composer-surface",!T&&s!=="temporary"&&"bg-token-main-surface-primary dark:bg-[#303030]",s==="temporary"&&"dark bg-[#303030]"),onClick:f,style:{viewTransitionName:"var(--vt-composer)"},children:[e.jsx(ps,{initial:!1,children:o.length>0&&e.jsx(ne.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0,transition:{duration:.06}},transition:{ease:"easeOut",duration:.1},id:"reply-regions",children:e.jsx($p,{replyRegions:o})})}),e.jsxs(e.Fragment,{children:[r,e.jsxs("div",{className:"flex min-h-[44px] items-start pl-1",ref:k,children:[e.jsx("div",{className:"min-w-0 max-w-full flex-1",children:F()}),e.jsx("div",{className:"w-[32px] pt-1",children:c})]}),e.jsxs("div",{className:"mb-2 mt-1 flex items-center justify-between sm:mt-5",ref:I=>{if(!R||!("ResizeObserver"in window))return;let A=new AbortController,G=window.innerWidth;const Y=Sd({axis:"width",debounce:!0,target:I,onChange:()=>{if(!I)return;I.scrollWidth>I.clientWidth?p?.(!0):Math.abs(G-window.innerWidth)>40&&(p?.(!1),G=window.innerWidth)}});return()=>{Y?.(),A.abort()}},children:[e.jsx("div",{className:"flex gap-x-1.5 text-token-text-primary",children:l}),e.jsx("div",{className:"flex gap-x-1.5",children:P()})]})]})]})});function Vp({composerController:t,currentLeafId:s,placeholder:a,inputState:o}){const n=i.useContext(cn);return e.jsxs(e.Fragment,{children:[e.jsx(vd,{id:nh,autoFocus:!0,tabIndex:0,"data-id":s,dir:"auto",ref:r=>{if(!(t instanceof Rr))throw new Error("Expected TextAreaComposerController");r!=null&&(t.textArea=r,t.logPageMount())},rows:1,placeholder:a,disabled:o!=="default",className:B("m-0 resize-none border-0 bg-transparent px-0 text-token-text-primary focus:ring-0 focus-visible:ring-0",o==="disabled"&&"text-center",["max-h-[25dvh]","max-h-52"])}),e.jsx("script",{nonce:n.cspScriptNonce,suppressHydrationWarning:!0,children:"requestAnimationFrame((function(){window.__oai_logTTI?window.__oai_logTTI():window.__oai_SSR_TTI=window.__oai_SSR_TTI??Date.now()}))"})]})}function $p({replyRegions:t}){return e.jsx("div",{className:"-mx-2 flex cursor-auto flex-col divide-y divide-token-border-light overflow-hidden rounded-b-lg rounded-t-[20px] bg-token-main-surface-primary",children:t.map((s,a)=>{switch(s.type){case"text":return e.jsx(Yp,{value:s.value,onRemoveRegion:s.onRemoveRegion},a);case"object":return e.jsx(Kp,{value:s.value,onRemoveRegion:s.onRemoveRegion},a);case"mention":case"system_hint":return e.jsx(Jp,{value:s.value,icon:s.icon,onRemoveRegion:s.onRemoveRegion},a)}})})}function Yp({value:t,onRemoveRegion:s}){return e.jsxs(qo,{className:"text-token-text-secondary",children:[e.jsx(Vo,{children:e.jsx(Pr,{className:"icon-lg-heavy"})}),e.jsx($o,{children:`“${t}”`}),e.jsx(Wo,{onClick:s})]})}function Kp({value:t,onRemoveRegion:s}){return e.jsxs(qo,{className:"text-blue-selection",children:[e.jsx(Vo,{children:e.jsx(Pr,{className:"icon-lg-heavy"})}),e.jsx($o,{className:"font-semibold",children:t}),e.jsx(Wo,{onClick:s})]})}function Jp({value:t,icon:s,onRemoveRegion:a}){return e.jsxs(qo,{children:[e.jsx(Vo,{className:"mt-0",children:s}),e.jsx($o,{className:"font-semibold text-token-text-primary",children:t}),e.jsx(Wo,{onClick:a})]})}function Wo({onClick:t}){return e.jsx("button",{onClick:t,type:"button",className:"flex-shrink-0 text-token-text-secondary",children:e.jsx(xr,{className:"icon-lg"})})}const qo=Ce.div`bg-token-main-surface-secondary dark:bg-token-main-surface-tertiary flex items-start py-2.5 gap-3 pl-3 pr-1.5 text-sm`,Vo=Ce.span`flex-shrink-0 mt-0.5 w-7 h-6 flex justify-center items-center`,$o=Ce.span`flex-1 line-clamp-3 py-0.5`;function Qp({target:t,rootId:s,additonalInteractiveIds:a}){let o=t;for(;o&&o!=null;){if(o.tagName==="BUTTON"||o.tagName==="INPUT"||o.tagName==="TEXTAREA"||o.isContentEditable||a.includes(o.id))return!0;if(o.id===s)return!1;o=o.parentElement}return!1}function hi(t){const s=Bo(),a=t.useState(n=>n.getSystemHints()[0]);return s.size?s.values().next().value:a}function pi(t,s){const{clearAllSystemHintModeTriggers:a,setThreadSystemHintMode:o}=pn(),{value:n}=ye("1325692000");return i.useCallback(({hint:r,enable:l})=>{a();const c=!!r.composerBarButtonInfo;l?c||n?(o(r.systemHint,!0,{clientThreadId:s}),t.removeSystemHints()):(t.addSystemHint(r.systemHint,r.name),setTimeout(()=>{t.focus()},0)):t.removeSystemHints()},[a,t,o,s,n])}const Ra=({composerController:t,disabled:s,clientThreadId:a,isComposerV2Mode:o,uploadButtons:n,showLabel:r,showUpsell:l})=>{const{value:c}=ye("1325692000"),u=gn(a).filter(S=>S.systemHint===K.Research&&(o||c)?!0:!S.composerBarButtonInfo&&S.systemHint!==K.Search),p=hi(t),{value:m}=ye("3780975974"),d=pi(t,a),[h,v]=i.useState(!1);if(i.useEffect(()=>{const S=Math.random(),w=setInterval(()=>{const T=new Date,_=T.getHours()+T.getMinutes()/60+T.getSeconds()/3600,M=Math.abs((6+_)%12-6)/6;v(Math.pow(M,15)>S)},1e3);return()=>clearInterval(w)},[]),!(t instanceof Fo)||u.length===0&&!o)return null;const g={clientThreadId:a};function b(){W.logEventWithStatsig(U.composerSystemHintButtonHovered,"composer_system_hint_button_hovered",g)}function C(){W.logEventWithStatsig(U.composerSystemHintButtonClicked,"composer_system_hint_button_clicked",g)}return e.jsx(Xp,{systemHints:u,selectedHint:p,showJack:m?!1:h,disabled:s,isComposerV2Mode:o,onHover:b,onOpen:C,onSelect:d,uploadButtons:n,showLabel:r,showUpsell:l})},Xp=({systemHints:t,selectedHint:s,showJack:a,disabled:o,isComposerV2Mode:n,onHover:r,onOpen:l,onSelect:c,uploadButtons:u,showLabel:p,showUpsell:m})=>{const d=we(),[h,v]=i.useState(!1),g=t.find(M=>M.systemHint==="contextual_answers")?.name,{value:b}=ye("3780975974"),C=t.length>0,S=!1;if(!gl())return null;const T=m?e.jsx(ko,{location:"tools",statsig_login_event:"chatgpt_composer_upsell_login_button_clicked",statsig_signup_event:"chatgpt_composer_upsell_signup_button_clicked"}):e.jsxs(e.Fragment,{children:[C&&e.jsxs(e.Fragment,{children:[S,t.map(M=>e.jsx(ee.Item,{className:B(!n&&"px-1 py-2",n&&"mx-0 rounded-xl p-1.5 px-2 py-2.5"),onClick:()=>c?.({hint:M,enable:M.systemHint!==s}),children:n?e.jsx(bd,{title:M.name,description:M.description,icon:M.logo,checked:M.systemHint===s}):e.jsx(mi,{title:M.name,description:M.description,logo:M.logo,checked:M.systemHint===s})},M.systemHint))]}),C&&u&&e.jsx(ee.Separator,{className:"mx-2 my-1",noMargin:!0}),u]}),_=m&&p?e.jsx(Po,{"aria-label":"",className:"pointer-events-none h-[18px] w-[18px]"}):e.jsx(Nr,{"aria-label":"",className:"pointer-events-none h-5 w-5"});return e.jsxs(ee.Root,{open:h,onOpenChange:M=>{v(M),M&&l?.()},children:[e.jsx(Zp,{disabled:!!o,contextualAnswersHintNameIfPresent:g,children:e.jsxs(po,{className:B(_r.toolsButton,"flex h-9 min-w-9 items-center justify-center rounded-full border border-token-border-light p-1 text-xs font-semibold text-token-text-secondary focus-visible:outline-black disabled:opacity-30 radix-state-open:bg-black/10 can-hover:hover:bg-token-main-surface-secondary dark:focus-visible:outline-white dark:can-hover:hover:bg-gray-700"),"data-opened":Pa(h),"data-jack":Pa(!!a),"aria-label":n?d.formatMessage({id:"9xVxsA",defaultMessage:"Upload files and more"}):d.formatMessage({id:"oDAnGy",defaultMessage:"Use a tool"}),disabled:o,onPointerOver:r,onClick:M=>{M.preventDefault()},onFocusCapture:M=>{M.stopPropagation()},children:[n?_:b?e.jsx(yd,{className:"pointer-events-none h-5 w-5"}):e.jsx(wd,{className:"pointer-events-none h-5 w-5"}),m&&p&&e.jsx("span",{className:"whitespace-nowrap pr-2 text-[13px] font-semibold [display:--force-hide-label]",children:d.formatMessage({id:"AlZBxR",defaultMessage:"Tools"})})]})}),e.jsx(ee.Portal,{children:e.jsx(ee.Content,{alignOffset:-16,className:B(n&&"flex flex-col justify-start gap-2",n&&!m&&"p-1.5"),onCloseAutoFocus:M=>{M.preventDefault()},removeVerticalPadding:n||m,children:T})})]})},Zp=({disabled:t,children:s,contextualAnswersHintNameIfPresent:a})=>{const o=mt(ut.hasSeenComposerSystemHintButtonTooltip),n=mt(ut.hasSeenCaSystemHint),r=!t&&!o.isLoading&&o.eligible,l=!t&&!o.isLoading&&a&&!n.isLoading&&n.eligible,c=r?{announcementKey:ut.hasSeenComposerSystemHintButtonTooltip,title:e.jsx(H,{id:"tTydhk",defaultMessage:"All your tools, in one handy place"}),onDismiss:o.markAsViewed,description:e.jsx(H,{id:"S+BFNe",defaultMessage:"Create a canvas, generate a picture, and more."})}:l?{announcementKey:ut.hasSeenCaSystemHint,title:e.jsx(H,{id:"uaC1JM",defaultMessage:"Not finding internal information?"}),onDismiss:n.markAsViewed,description:e.jsx(H,{id:"TL/S+W",defaultMessage:"If ChatGPT didn't search your files automatically, type {hintName} or select it from the menu.",values:{hintName:e.jsx("span",{className:"whitespace-nowrap font-bold",children:'"/'+a+'"'})}})}:void 0;return c?e.jsx(No,{show:!0,side:"bottom",theme:"bright",dismissOnOutsideClick:!0,badge:"new",sideOffset:0,className:"!max-w-2xs xs:!max-w-sm",...c,children:s}):e.jsx(us,{side:"top",sideOffset:0,label:t?e.jsx(H,{id:"uw9x80",defaultMessage:"Tools unavailable"}):e.jsx(H,{id:"mrYNGk",defaultMessage:"View tools"}),children:s})};function Pa(t){return t?"":null}const eg=1,tg=3e3;function sg({files:t,className:s}){const a=fo(),o=Ir(),n=lu();return e.jsxs("div",{className:s,children:[n.map(r=>e.jsx(cu,{textdocId:r.tempTextdocId,userCreatedTextdoc:r},r.tempTextdocId)),t.map(r=>e.jsx(du,{borderRadius:"2xl",useV2Style:!0,width:a?"normal":"wide",onRemoveFileClick:()=>Ks.remove(o,r.tempId,"none"),file:r.file,fileId:r.fileId??void 0,contextConnectorInfo:r.contextConnectorInfo,loadingPercentage:r.status===uu.Uploading?r.progress:void 0},r.tempId))]})}const Ia="search-button",Ha="active-hint-tag";function ng({onAbortCompletion:t,onCreateNewCompletion:s,onContinueGenerating:a,currentModelId:o,clientThreadId:n,isNewThread:r,isCompletionInProgress:l,className:c,disabled:u=!1,disabledReason:p,canPause:m=!1,canContinue:d=!1,suggestions:h,isInteractableSharedThread:v,composerContainerRef:g,autocompletions:b,requiresFileUpload:C,onComposerInput:S,onComposerChange:w,onAutocompleteSelect:T,headerClassName:_,hideHeader:M,setComposerBarElement:L,onTaggingDropdownOpen:k,onTaggingDropdownClose:x}){qe.markStart("PromptTextarea"),qe.markRendered("PromptTextarea");const j=i.useRef(null),N=mu(j,L),{data:E}=rn(),{data:R}=ht(),f=xn(),F=Io(),P=sr(E),I=P?.isFree(),{isUnauthenticated:A}=ot(),G=we(),Y=ro(),D=Ir(),[te,re]=ae(n,y=>[Q.getCurrentLeafId(y),Q.getRequestId(y)]),[Me]=bo(),at=dn(),{gizmoEditorData:Z,mode:Te,getGizmoId:fe}=jd(),ve=ir(),ke=fl(),Pe=At(),xe=Hr(),he=ms(n),Ie=!!xl(),Ue=!!Sl(),ze=!!go(),[ue,Ge]=i.useState({}),{setThreadSystemHintMode:z,clearSystemHintModeTrigger:q,getSystemHintModeTrigger:ie}=pn(),$=Qr(),X=$.has(K.Search),le=$.has(K.Think),Se=gn(n),Ye=Se.length>0,be=$.size===1&&$.values().next().value,Ke=be&&be!==K.Search&&be!==K.Think,He=Se.find(y=>y.systemHint===be),[_e,rt]=i.useState(!1),[pe,ce]=i.useState(!1),gt=st(),Et=i.useRef(!1),fs=null,de=is(R?.models,o);let se=un(n),Xe=se&&"gizmo"in se?se.gizmo:void 0;const Rt=gs(Xe?.gizmo.id),Sn=hp(),Ae=Cd(),xs=Co(Xe?.gizmo.id),[Ne,ft]=i.useState(null);Ne!==null&&(se={gizmo:Ne,gizmo_id:Ne.gizmo.id,kind:Le.GizmoInteraction},Xe=Ne);const xt=wa(de,se);let Ss=!1;Md(se)&&Xe?.gizmo.id===Td&&(Ss=!0);const vn=vl(),Vt=!u&&!Ss&&xt!==Ls.None&&!A,St=kd(de,se),$t=_d(de,se);let De=ja(y=>y.files);const[Yt]=i.useState(()=>Ad());Te==="magic"?De=De.filter(y=>y.gizmoId!=null):De=De.filter(y=>y.gizmoId==null);const vs=Nd(),it=De.length>0||vs,Kt=ja(hu.hasUploadInProgress),Pt=Ed(n),It=f.useState(y=>{const J=oh(y);return typeof de?.maxTokens=="number"&&J>de.maxTokens}),Jt=f.useState(y=>!y.isEmpty()),Ze=!It&&!Kt&&(Jt||it);Dr(De.length>0||Kt||Jt);const bs=(xt===Ls.Multimodal?Rd:Pd)-De.length,yt=bs<=0,et=Ze&&!u&&!l&&!ze,[wt,Qt]=i.useState(!1),{value:ys,isLoading:bn}=ye("3780975974"),{value:yn}=ye("759329447"),{value:ws}=ye("2223246572"),{value:Be}=ye("1325692000"),js=o??wo(R).id,jt=is(R?.models,js),Xt=en(jt,Js.Search),{value:Cs}=Ee("2603280534"),{userIsInSearchHoldoutWithWebDisabled:wn}=Xr(),Ms=!u&&(!Xe||Rt&&Cs)&&ve?.includes(Vs.SearchTool)&&!ve?.includes(Vs.SearchToolHoldout)&&!wn&&(ve?.includes(Vs.BrowsingAvailable)||!P?.isEnterprisey())&&(!Be||!Ke),{value:jn}=Ee("1416952492"),{value:Zt}=Ee("4239853523"),es=Ms&&Xt,{targetedContent:Ts,setTargetedContent:Ht}=Br(),Fe=Ts?.isFocusedViewContent&&!xe?void 0:Ts,{rebaseSystemMessageContent:ks}=Ho(),Cn=se?.kind===Le.PrimaryAssistant||se?.kind===Le.GizmoInteraction&&Rt,Mn=Se.find(y=>y.systemHint===K.Think),{getUpsellLabelType:_s,getUpsellShowsAttach:Tn,getShowUpsellReason:O}=Er(),ge=ys&&Mn&&fs==null&&se?.kind===Le.PrimaryAssistant&&(yn||Be)&&(!Be||!Ke),lt=se?.kind===Le.PrimaryAssistant&&!Pe&&!Be&&!Zt,Ct=Ye&&Cn,[Ko,yi]=i.useState(!1),wi=!I&&Ct&&!ws,[ts,ji]=i.useState(!1);i.useEffect(()=>{if(!F?.id)return;const y=Ta.getAndReset(F?.id,he);y&&f.setText(y.inputText)},[F?.id,he,f]),i.useEffect(()=>{const y=Me.get("prompt")??"";f.getCurrentText().length===0&&y.length>0&&f.setText(y)},[f,Me]),i.useEffect(()=>{wt!==et&&(Qt(et),et&&bl(!0).then(y=>{Id.startEnforcement(y),yl.startEnforcement(y)}))},[et,wt,se?.kind,ve]);const kn=Hd(de,se),{handleFileAccepted:Ci}=Dd(G,wa(de,se),St,"mouse",fe,kn?.attachments),{getInputProps:Mi,open:Ti}=Bd({disabled:u||!Vt||yt,noClick:!0,onDropAccepted:Ci,onDropRejected:y=>Fd(y,G,Y,xt),multiple:!0,maxSize:Ld,maxFiles:bs,...Od($t)}),Jo=wl(Yt),{value:ki}=ye("1988730211"),Qo=i.useCallback(()=>{f.eraseContent(),Jo.clearMessages(),f.resize(eg),f.usedDictation=!1,Ud();for(const y of De)Ks.remove(D,y.tempId,"none");zd.markAllAsSent()},[f,Jo,De,D]),As=async(y,J)=>{if(y?.preventDefault(),u||!Ze&&!J||!se||Oe(n)?.isLoading!==!1)return;rt(!0),Sn?.(),Ae?.();const oe=f.getContentToSend(),me=rh(oe.content),Je=new pu(gu.CompletionRequest,{expectedTimingLogs:[{name:"prompt_submitted",expectedInMs:3e3}]}),{content:as,attachments:Is}=eh(D,me,de,se),da=[],In=[];ks&&In.push(Tl(ks));const Hn={...se};"gizmo"in Hn&&delete Hn.gizmo;let Hs=f.getSystemHints();$.size>0&&(Hs=Array.from($));const ua=ie(K.Search),el=X?ua??lo.CONVERSATION_COMPOSER_WEB_ICON:void 0,ma=fu(),ha=gr(),tl=f.usedDictation;let ct={content:as,eventSource:y?"mouse":"keyboard",completionMetadata:{suggestions:h,conversationMode:Hn,systemHints:Hs,searchSource:el},messageMetadata:{...Is.length>0&&{attachments:Is},...Ne&&{gizmo_id:Ne?.gizmo.id},...ue,...Hs.length>0&&{system_hints:Hs},...!!oe.metadata&&{serialization_metadata:oe.metadata},...ma.length>0&&{canvas:{user_created_textdocs:ma.map(dt=>({user_created_temp_textdoc_id:dt.tempTextdocId,type:dt.type,title:dt.title,content:dt.content,create_source:dt.create_source,remix_shared_textdoc_id:dt.remixSharedTextdocId}))}},...Object.keys(ha).length>0&&{__internal:{search_settings:ha}},dictation:tl},prependMessages:da.length>0?da:void 0,appendMessages:In.length>0?In:void 0,profiler:Je};if(ct=xu(ct),ki&&ct.completionMetadata.systemHints){let dt=!1;ct.completionMetadata.systemHints=ct.completionMetadata.systemHints.filter(sl=>sl===K.Search?(dt=!0,!1):!0),dt&&(ct.extraStreamParams={forceUseSearch:!0})}Fe?.createNewCompletionParams&&(ct=await Fe.createNewCompletionParams(ct)),Je.logTiming("request_params_ready"),await s(ct),Fe?.onCreateCompletion?.({serverThreadId:he,currentLeafId:te}),Fe?.shouldPersistAcrossMessages!==!0&&Ht(void 0),nn.hideThreadHeader(),Qo(),rt(!1),Je.logTiming("prompt_submitted"),h!==void 0&&(je.logEvent("chatgpt_prompt_ignore_suggestions"),W.logEvent(U.promptIgnoreSuggestions)),X&&ua&&q(K.Search)},_i=i.useRef(As);i.useEffect(()=>{_i.current=As});const Ai=y=>{Ht(y.targetedReply),y.targetedReply&&(f.focus(),W.logEvent(U.targetedReplyButtonClicked,{conversationId:he,sourceMessageId:y.messageId}))},Xo=i.useCallback(()=>{Fe?.onCleared?.({serverThreadId:he,currentLeafId:te}),Ht(void 0),f.focus()},[te,he,Fe,Ht,f]),Zo={Enter:{validator:y=>{const J=y.isComposing||y.keyCode===229;return!(pe&&Et.current)&&(y.metaKey||(ke||kl)&&!y.shiftKey&&!J)},handler:y=>{if(!et){It&&Y.danger("The message you submitted was too long, please submit something shorter.",{hasCloseButton:!0});return}y.preventDefault(),As()}},Escape:{validator:y=>!y.isComposing,handler:y=>{m&&l&&(t("",re),W.logEvent(U.pauseCompletion,{threadId:Qe(n),currentLeafId:Q.getMessageId(Oe(n)),eventSource:"keyboard"})),y.target.value===""&&Xo()}}},ss=i.useRef(Zo);ss.current=Zo;const Ns=Gd(jt?.tags,se?.kind),[_n,Es]=i.useState(!1),[An,ea]=i.useState(!1),ns=Ns&&_n&&!Rt,ta=f.isReady();i.useEffect(()=>f.subscribe("keydown",y=>{f.acceptLegacyKeydown()&&ss.current[y.key]?.validator(y)&&ss.current[y.key].handler(y);const oe=f.getCurrentText();if(y.key==="@"){const me=f.getSelectionStart(),Je=oe.substring(0,me);(!Je||/\s$/.test(Je)||me===0)&&setTimeout(()=>Es(!0),10)}else _n&&Es(!1);if(y.key==="Escape"&&(ft(null),ce(!1)),es&&!X){let me;y.key==="Backspace"?me=oe.substring(0,oe.length-1):me=oe+y.key,/^search\s?$/i.test(me)?ea(!0):An&&ea(!1)}X&&y.key==="Escape"&&z(K.Search,!1,{clientThreadId:n})}),[f,ta,_n,An,es,$,X,z,n]),i.useEffect(()=>{const y=Object.fromEntries(Object.keys(ss.current).map(J=>[J,me=>{const Je=ss.current[J];if(!Je||f.acceptLegacyKeydown())return!1;const{validator:as,handler:Is}=Je;return as(me)?(Is(me),!0):!1}]));f.registerKeyHandlers(y)},[f,ta]),i.useEffect(()=>f.subscribe("paste",y=>{Wd({filePickerStore:D,event:y,intl:G,toaster:Y,clientThreadId:n,conversationMode:se,currentModelConfig:de,getEditorGizmoId:fe,modelSupportedImageMimeTypes:St})}),[G,n,se,de,fe,St,f,Y,D]);const Ni=y=>{Ie||ft(y),f.trimLeadingText("@"),Zn(),Es(!1)},Ei=qd(n,Yt,St,kn?.attachments),Ri=i.useCallback(y=>{y?.preventDefault(),t("",re),W.logEvent(U.pauseCompletion,{threadId:Qe(n),currentLeafId:Q.getMessageId(Oe(n)),eventSource:"mouse"}),Zn()},[t,n,re]),sa=i.useCallback(()=>{Ta.set(F?.id,he,f.getCurrentText())},[he,F?.id,f]);i.useEffect(()=>{Z||!_e&&!jl()&&f.focus()},[_e,f]),i.useEffect(()=>{if(St.length>0)for(const J of De)ah(J.fileSpec?.mimeType,$t)||Ks.remove(D,J.tempId,"none");else Ks.reset(D)},[o,D]),i.useEffect(()=>{(!Ns&&Ne||Ie)&&ft(null)},[Ns,Ne,Ie]);const{layer:Pi}=zt("4031588851"),{layer:na}=zt("3637408529"),Ii=na.get("is_in_composer_text_exp",!1),Hi=na.get("composer_text","MESSAGE_CHATGPT"),Di=Pi.get("composer_text","MESSAGE_CHATGPT"),Bi=Ii?Hi:Di,[Rs,Fi]=(()=>{switch(p){case"workspaceDisallowsGizmo":return[We.disallowedByWorkspacePlaceholder,!0];case"feedbackRequired":return[We.disabledFeedbackPlaceholder,!0];case"noModelsAvailable":return[We.noModelsAvailablePlaceholder,!0];case"requiresPluginsToBeInstalled":return[We.requiresPluginsToBeInstalled,!0];case"loadingPlugins":return[We.loading,!0];case"noTestGizmoId":return[We.noTestGizmoId,!0];default:{if(v)return[We.placeholderWithName,!1];if(Fe?.placeholderTextOverride!=null)return[Fe.placeholderTextOverride,!1];switch(Bi){case"BLANK":return[null,!1];case"ASK_ANYTHING":return[We.placeholderAskAnythingVariant,!1];case"ASK_CHATGPT_ANYTHING":return[We.placeholderAskNameAnythingVariant,!1];default:return[We.placeholderWithName,!1]}}}})(),Li=Rt?r?G.formatMessage(Yn.newChatInProject):Rs?G.formatMessage(Rs,{name:"ChatGPT"}):"​":Rs?G.formatMessage(Rs,{name:Z!=null?Te==="magic"?Vd:Z.name||"GPT":Xe?.gizmo.display.name??"ChatGPT"}):"​";i.useEffect(()=>f.subscribe("input",()=>{_o.getState().isThreadHeaderVisible&&nn.hideThreadHeader(),ce(!0)}),[f]),i.useEffect(()=>{if(S)return f.subscribe("input",()=>{S?.()})},[f,S]),i.useEffect(()=>{if(w)return f.subscribe("change",()=>{w?.()})},[f,w]),i.useEffect(()=>f.subscribe("focus",()=>{ce(!0)}),[f]),i.useEffect(()=>{Be&&be&&Ke&&!Se.some(({systemHint:y})=>y===be)&&!A&&z(be,!1,{clientThreadId:n})},[n,z,be,Ke,Se,A,Be]);const oa=ys||bn||O(),aa={clientThreadId:n,uploadType:xt,modelAcceptedMimeTypes:$t,modelSupportedImageMimeTypes:St,attachmentsProductFeature:kn?.attachments,getInputProps:Mi,openFileDialog:Ti,historyDisabled:Pe,onOauthRedirect:sa,highlightTooltip:C&&!it},Nn=Se.some(({systemHint:y,requiredModels:J})=>y===K.Think&&J.some(oe=>{const me=is(R?.models,oe);return me?me.product_features.attachments:!1})),Mt=[],ra=!u&&!yt&&(Vt||vn!=null)&&!X&&(!le||Nn),En=Tn(),ia=En||!A;!Zt&&ia?Mt.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-attach-file-action)"},children:e.jsx(Ea,{...aa,showLabel:_s()==="all",showUpsell:En,isDisabled:!ra||ts,disabledReason:xt===Ls.None?Bt.ModelNotSupported:le?Bt.ThinkModeInUse:X?Bt.SearchModeInUse:void 0,currentModelName:de?.title??""})},"file-upload-button")):Mt.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-system-hint-action)"},children:e.jsx(Ra,{composerController:f,clientThreadId:n,disabled:!ia,showLabel:_s()==="all",showUpsell:En,isComposerV2Mode:!0,uploadButtons:e.jsx(Ea,{...aa,isDisabled:!ra,isNested:!0,disabledReason:xt===Ls.None?Bt.ModelNotSupported:le?Bt.ThinkModeInUse:X?Bt.SearchModeInUse:void 0,currentModelName:de?.title??""})})},"system-hint-button"));const vt=[];He&&Ke&&Be&&vt.push(e.jsx("div",{style:{viewTransitionName:`var(--vt-composer-${He}-action)`},children:e.jsx(Na,{logo:e.jsx(hn,{svgString:He.logo,className:"h-[18px] w-[18px] text-blue-1000 dark:text-[#48AAFF]"}),label:He.name,showRemoveIcon:!0,onClick:()=>{z(He.systemHint,!1,{clientThreadId:n})},showLabel:oa})},Ha)),Ms&&vt.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-search-action)"},children:e.jsx(Dp,{composerController:f,highlightTooltip:An,clientThreadId:n,isDisabled:!es||it||ts,disabledReason:Xt?it?sn.HasAttachedFiles:void 0:sn.ModelNotSupported,showLabel:!Ko,currentModelName:de?.title??""})},Ia)),Se.forEach(y=>{const J=y.systemHint===K.Think,oe=y.systemHint===K.Research;if(J&&!ge||y.systemHint===K.Search&&Ms||oe&&!lt)return;const Je=J&&(Ue||!Nn&&it)||oe&&jn;if(y.composerBarButtonInfo){const as=de?.tags.includes("reasoning")||de?.id.includes("o1")||de?.id.includes("o3");vt.push(e.jsx("div",{style:{viewTransitionName:`var(--vt-composer-${y.systemHint}-action)`},children:e.jsx(Kh,{composerController:f,systemHint:y,composerBarButtonInfo:y.composerBarButtonInfo,clientThreadId:n,isDisabled:!Ct||Je||ts,isPinnedActive:as&&J,showLabel:oa,currentModelName:de?.title??"",disabledReason:J&&!Nn&&it?tn.HasAttachedFiles:oe&&jn?tn.DeepResearchHighLoad:void 0})},`system-hint-${y.systemHint}`))}}),xs&&vt.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-system-model-selector)"},children:e.jsx(Pp,{clientThreadId:n})},"model-selector-button")),wi&&!O()&&!Zt&&vt.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-system-hint-action)"},children:e.jsx(Ra,{composerController:f,clientThreadId:n,disabled:!Ct||ts})},"system-hint-button"));const Oi=$d(!1),Rn=R?.defaultModelSlug;if(!Be||o===Rn)Mt.push(...vt);else if(Be&&de&&Rn&&R?.categories){const y=R.categories.find(J=>J.defaultModel===de.id);if(y){Mt.push(e.jsx(Na,{showLabel:!0,logo:null,label:y.shortLabel,onClick:()=>Oi({location:"PromptTextArea",modelId:Rn}),showRemoveIcon:!0}));const J=vt.find(me=>me.key===Ia);Xt&&J?Mt.push(J):$.has(K.Search)&&z(K.Search,!1,{clientThreadId:n}),$.has(K.Think)&&z(K.Think,!1,{clientThreadId:n});const oe=vt.find(me=>me.key===Ha);Mt.push(oe)}}const Ui=it&&e.jsxs(e.Fragment,{children:[Te==="magic"&&e.jsx("div",{className:"m-2 mb-0 rounded-lg bg-token-main-surface-secondary p-2 text-xs text-token-text-secondary",children:e.jsx(H,{...We.gizmoKnowledgeWarning})}),e.jsx(sg,{files:De,className:"-ml-1.5 flex flex-nowrap gap-2 overflow-x-auto p-1.5"})]}),zi=Fi?"disabled":"default",Gi=l&&m,Wi=Cl(),qi=!et||_e||Wi,Vi=ih(Kt,Jt,It,Pt),Ps=Gi?"streaming":qi?"disabled":"idle",os=i.useRef(null),Dt=i.useRef(null),$i=o&&(o.startsWith("o1")||o.startsWith("o3"));i.useEffect(()=>{const y=()=>{os.current!=null&&Qs.addAction("composer_state_disabled",{threadId:Qe(n),disabledReason:os.current})};if(Ze&&Ps==="disabled"){let J="unknown";u?J=p??"component_disabled_unknown":l?J="completion_in_progress":ze?J="thread_hard_blocked":_e&&(J="starting_new_completion_request"),os.current!==J&&(Dt.current&&clearTimeout(Dt.current),Dt.current=setTimeout(y,tg)),os.current=J}else os.current=null;return()=>{Dt.current&&(clearTimeout(Dt.current),Dt.current=null)}},[n,Ze,Ps,u,p,l,ze,_e]);const Pn=[];if(Fe?.label&&Pn.push({type:Fe.type,value:Fe.label,onRemoveRegion:Xo}),Ne!==null){const y=!!Ne.gizmo.tags?.includes(Ao.FirstParty);Pn.push({type:"mention",value:Ne.gizmo.display.name,icon:e.jsx(Yd,{isFirstParty:y,src:Ne.gizmo.display.profile_picture_url,className:"icon-md"}),onRemoveRegion:()=>{ft(null),f.focus()}})}i.useEffect(()=>{(!b||b.length===0||!pe)&&(Et.current=!1)},[b,pe]);const Yi=(y,J,oe)=>{Et.current=y>=0,J&&f.setText(oe?`${oe.title}${oe.body}`:"")},la=pe&&b&&b.length>0&&!ns&&!f.hasMultipleLines()&&f.canShowAutocompletion();i.useEffect(()=>{ns?k?.():x?.()},[ns,k,x]);const ca=Ps==="streaming"?Ri:As,Ki=en(jt,Js.Canvas),{value:Ji}=ye("61299031"),Qi=fo(),Xi=Kd(),Zi=Ki&&Ji&&!Xi&&!vs&&!Qi;return i.useEffect(()=>{},[fs,f]),e.jsxs(Jd.Provider,{value:Yt,children:[e.jsx(Qd,{onOauthRedirect:sa,children:e.jsx("form",{className:c,onSubmit:ca,children:e.jsxs("div",{className:"relative z-[1] flex h-full max-w-full flex-1 flex-col",children:[!M&&!gt&&e.jsx(ci,{className:_}),e.jsxs("div",{ref:g,className:"group relative z-[1] flex w-full items-center",style:{"--force-hide-label":Ko?"none":"block"},children:[r&&Me.has("from_template_row")&&e.jsx("button",{type:"button",onClick:()=>{at("/")},className:"mr-2 flex h-8 w-8 items-center justify-center text-token-text-tertiary hover:text-token-text-secondary",children:e.jsx(Xd,{className:"icon-lg"})}),e.jsxs(Zd,{open:ns||Ct||xs,children:[e.jsx(eu,{className:"w-full",children:e.jsx(qp,{type:Pe?"temporary":"default",ref:N,replyRegions:Pn,placeholder:Li,inputState:zi,setIsComposerOverflowing:yi,composerController:f,leftSideActions:Mt,topRightAction:Zi&&e.jsx(tu,{composerRef:j,composerController:f,clientThreadId:n}),state:Ps,onSubmit:ca,renderFiles:Ui,currentLeafId:te,clientThreadId:n,gizmoId:Xe?.gizmo.id,disableReason:Vi,modelId:js,controlsDisabled:ts,setControlsDisabled:ji})}),e.jsx(su,{children:e.jsxs(nu,{side:"bottom",align:"start",sideOffset:12,onOpenAutoFocus:y=>{Ml("2713687629")&&y.preventDefault()},children:[ns&&e.jsx(ou,{onClick:y=>Ni(y),onClose:()=>{Es(!1),f.focus()}}),Ct&&e.jsx(Op,{composerController:f,clientThreadId:n})]})})]}),la&&e.jsx("div",{className:"absolute left-0 z-[-1] box-border w-full bg-token-main-surface-primary pl-0 max-lg:bottom-full lg:top-full",children:e.jsx(zp,{suggestions:b,composerController:f,onSelect:T,onChange:Yi})})]}),e.jsx(au,{composerController:f,parsedDocumentHandler:Ei})]})})}),e.jsx(Mp,{canUseInlineTagging:Ns,isDisabled:u,clientThreadId:n,currentLeafId:te,currentRequestId:re,canContinue:d,composerController:f,setPromptInputMetadata:Ge,suggestions:h,isNewThread:r,onCreateNewCompletion:s,onContinueGenerating:a,onResetState:Qo,conversationMode:se,isShowingAutocomplete:!!la}),se!=null&&!$i&&ru.includes(se.kind)&&e.jsx(iu,{clientThreadId:n,onTargetedReply:Ai})]})}function og(t,s){const a=s==null&&t.message?.author.role===tt.User&&t.message.status==="in_progress",o=t.metadata?.err!=null&&t.metadata?.errCode!==Sa.ContentPolicy,n=t.metadata?.errCode===Sa.ModelIncompatibility;return t.metadata?.canRetry===!1||n?!1:a||o}function ag(t){return e.jsx(ei,{clientThreadId:t.clientThreadId,children:e.jsx(rg,{...t})})}function rg({clientThreadId:t,isNewThread:s,currentModelId:a,showPromptStarters:o,noWrap:n,onRequestCompletion:r,composerContainerRef:l}){const u=xn(),p=i.useContext(cn),m=So(p),d=uo(),h=vo(),v=ae(t,b=>og(Q.getCurrentNode(b),null));if(Lr(u),!h&&v)return e.jsx(ig,{clientThreadId:t});const g=e.jsx(e.Fragment,{children:e.jsx(gi,{composerContainerRef:l,clientThreadId:t,currentModelId:a,isNewThread:s,showPromptStarters:o,onRequestCompletion:r})});return n?g:e.jsxs(e.Fragment,{children:[e.jsx($h,{clientThreadId:t}),e.jsx(Do,{clientThreadId:t,isStaticSharedThread:d,verticalPadding:m?"last-standard":"none",horizontalPadding:"standard",children:e.jsx(on,{children:g})})]})}function ig({clientThreadId:t}){const s=wu(t),a=ae(t,r=>Q.getCurrentNode(r).metadata?.errCode===ju),o=Cu(r=>r.isoDate),n=ho(t);return a&&o!=null&&o!==""?null:e.jsxs("div",{children:[e.jsx("div",{className:"mb-3 text-center text-xs","data-has-thread-error":!0,children:e.jsx(H,{...Da.errorGeneratingResponse})}),e.jsx("div",{className:"flex items-center md:mb-4",children:e.jsx(qt,{as:"button",color:"primary",onClick:()=>{je.logEvent("chatgpt_regenerate_due_to_error_button_clicked",void 0,rs({clientThreadId:t})),s({id:n,conversationMode:Oe(t)?.mode})},className:"m-auto",icon:br,"data-testid":"regenerate-thread-error-button",children:e.jsx(H,{...Da.regenerateResponse})})})]})}function gi({clientThreadId:t,currentModelId:s,isNewThread:a,onRequestCompletion:o,showPromptStarters:n,composerContainerRef:r,autocompletions:l,requiresFileUpload:c,onComposerInput:u,onComposerChange:p,onAutocompleteSelect:m,headerClassName:d,hideHeader:h,onTaggingDropdownClose:v,onTaggingDropdownOpen:g}){const{data:b}=ht(),[C,S,w,T,_,M,L,k,x]=ae(t,$=>{const X=Q.getCurrentLeafId($);return[X,Q.getRequestId($),$?.isLoading,$?.async_status===cr.STREAMING,Q.isMessageTurnEnded($),$?.tree.getHasErrorFromNode(X)??!1,$?.tree.isMessageIncomplete(X)??!1,$?.mode,$?.continuingFromSharedConversationId!=null]}),j=ds(),N=Jn(),{isUnauthenticated:E}=ot(),R=_t(S),f=_l({clientThreadId:t}),F=!E,P=Al(),{isOpen:I,onClose:A}=Su({type:"just-hit-rate-limit"}),{value:G}=ye("1988730211"),Y=Bo(),D=i.useCallback(()=>{W.logEvent(U.continueCompletion);const $=Array.from(Y),{systemHints:X,extraStreamParams:le}=G?vu($):{systemHints:$,extraStreamParams:{}};o({completionType:Nl.Continue,extraStreamParams:le,completionMetadata:{conversationMode:Oe(t)?.mode,systemHints:X}})},[Y,G,o,t]),te=pr(),re=i.useCallback(async($,X)=>th({clientThreadId:t,currentRequestId:X,isHistoryAndTrainingDisabled:P,queryClient:te}),[t,P,te]),at=i.useCallback(async({content:$,eventSource:X,extraStreamParams:le,completionMetadata:Se,messageMetadata:Ye,prependMessages:be,appendMessages:Ke,profiler:He,requestedModelId:_e})=>{let rt;$s(t,pe=>{lr.appendMessage(pe,nr($,Ye,rt))}),Kr(t),await o({eventSource:X,completionMetadata:Se,extraStreamParams:le,prependMessages:be,appendMessages:Ke,profiler:He,..._e?{requestedModelId:_e}:{}})},[t,o,null,j?.normalizedAccountUserId]),Z=!_&&(R||T),Te=i.useMemo(()=>Z?!1:!M&&L,[M,L,Z]),fe=Z,ve=nt(t),ke=Nt(ve).data,{promptStarters:Pe,isSuccess:xe}=Fr(a&&!w,t,4),he=kr(),Ie=(()=>{if(he?.messageId===Q.getTree(Oe(t)).getLastValidNode(C)?.message?.id)return he?.suggestions;if(n&&!w&&xe&&!F)return Pe})(),Ue=El(),ze=ke?.gizmo.tags?.includes(Ao.WorkspaceDisabled)&&!Ue?"workspaceDisallowsGizmo":b?.models.size===0?"noModelsAvailable":N.displayingSideBySideFeedback&&N.unskippable?"feedbackRequired":k?.kind===Le.GizmoTest&&k.gizmo_id==null?"noTestGizmoId":null,ue=ye("15117983")?.value,Ge=Jl(),z=xo(),q=Ge.action==="moderate",{value:ie}=Ee("1860647109");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-center empty:hidden",children:z&&q&&ie?e.jsx(bu,{}):null}),I?e.jsx(yu,{onClose:A}):null,ue&&k&&k.kind===Le.PrimaryAssistant&&k.plugin_ids&&k.plugin_ids.length>0?e.jsx(lg,{}):e.jsx(ng,{composerContainerRef:r,clientThreadId:t,onCreateNewCompletion:at,onAbortCompletion:re,onContinueGenerating:D,currentModelId:s,isNewThread:a,isCompletionInProgress:f,className:"w-full",canContinue:Te,suggestions:Ie??[],disabled:!!ze,disabledReason:ze??void 0,canPause:fe,isInteractableSharedThread:x,autocompletions:l,requiresFileUpload:c,onComposerInput:u,onComposerChange:p,onAutocompleteSelect:m,headerClassName:d,hideHeader:h,onTaggingDropdownClose:v,onTaggingDropdownOpen:g},t)]})}function lg(){return e.jsxs("div",{className:"mx-auto flex max-w-md flex-col items-center justify-center gap-2 rounded-xl border border-token-border-light bg-token-main-surface-primary p-6 shadow-lg",children:[e.jsx("span",{className:"text-token-text-primary",children:e.jsx(H,{id:"PluginsDecrepatedNotice.pluginsDeprecationTitle",defaultMessage:"Conversations with plugins are archived"})}),e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(H,{id:"PluginsDecrepatedNotice.pluginsDeprecationSubtitle",defaultMessage:"Explore GPT Store to find a replacement"})}),e.jsxs("a",{href:"https://chat.openai.com/gpts",className:"text-green-500 hover:cursor-pointer dark:text-green-400",children:[e.jsx(H,{id:"PluginsDecrepatedNotice.pluginsDeprecationGptStoreLink",defaultMessage:"Explore GPTs"}),e.jsx("span",{className:"ml-2",children:e.jsx(H,{id:"PluginsDecrepatedNotice.pluginsDeprecationGptStoreLinkArrow",defaultMessage:"→"})})]})]})}const Da=pt({errorGeneratingResponse:{id:"PromptTextarea.errorGeneratingResponse",defaultMessage:"There was an error generating a response"},regenerateResponse:{id:"PromptTextarea.regenerateResponse",defaultMessage:"Regenerate"}}),fi=i.memo(function(){return e.jsxs("div",{className:`mb-2 flex flex-col gap-2 empty:hidden ${Tr.PromptTextareaHeader}`,children:[e.jsx(di,{}),e.jsx(ui,{})]})}),pf=Object.freeze(Object.defineProperty({__proto__:null,ChatScreenComposerAlerts:fi},Symbol.toStringTag,{value:"Module"}));function cg(t){const{value:s}=ye("2223246572"),a=gn(t),o=i.useMemo(()=>a.filter(n=>n.suggestedPrompt).sort((n,r)=>(n.suggestedPrompt?.sortOrder??0)-(r.suggestedPrompt?.sortOrder??0)).map(n=>({id:n.systemHint,label:n.suggestedPrompt?.title??"",description:n.suggestedPrompt?.subtitle??"",icon:e.jsx(hn,{svgString:n.logo,className:"h-[22px] w-[22px]",color:n.suggestedPrompt?.theme??""}),systemHint:n})),[a]);return{replaceStarterPromptsWithToolChips:s,toolChips:o}}const Ba=Ve(()=>$e(()=>import("./larbu1qzw78jtkka.js"),__vite__mapDeps([49,2,4,1,3,5,36,9,10,45,50,51,18,19,16,20,21,22,23,24,25])).then(t=>t.SnorlaxSplashScreen)),Un=4;function dg(){const{layer:t}=Xs("4031588851"),s=t.get("autocomplete_qualified_start_date","2099-09-13T00:00:00Z"),a=Io();return!!a&&a.created*1e3>=new Date(s).getTime()}const zn=t=>`${t.title}${t.body}`.toLocaleLowerCase();function ug(t){const s=nt(t.clientThreadId),a=gs(s);return e.jsx(ei,{clientThreadId:t.clientThreadId,children:a&&s&&Ba?e.jsx(Ba,{clientThreadId:t.clientThreadId,gizmoId:s,currentModelId:t.currentModelId,onRequestCompletion:t.onRequestCompletion}):e.jsx(gg,{...t})})}function mg({children:t}){const{store:s}=Re(),[a,o]=i.useState(!1),n=xn();i.useEffect(()=>n.subscribe("focus",()=>{o(!0)}),[n]),i.useEffect(()=>n.subscribe("blur",()=>{o(!1)}),[n]);const l=!!s.useSharedProps()?.isShowingAutocomplete;return t(l&&a)}function hg({isSendBlocked:t,clientThreadId:s,headlineOption:a,shouldShowStarterPrompts:o,promptChips:n,onSelectStarterPrompt:r,starterPromptExpanded:l,setStarterPromptExpanded:c,replaceStarterPromptsWithToolChips:u,toolChips:p,onSelectToolChip:m,selectedHint:d}){const h=dr();return e.jsx(mg,{children:v=>e.jsxs(ne.div,{initial:{opacity:0},animate:{opacity:v?0:1},exit:{opacity:0},transition:{duration:.1},className:B("justify-center",v?"pointer-events-none":"","mt-[var(--screen-optical-compact-offset-amount)] h-full flex-shrink flex-col items-center overflow-hidden text-token-text-primary [display:var(--display-hidden-until-loaded,flex)]",h?"@lg/thread:hidden":"lg:hidden"),children:[a==="CHATGPT_LOGO"?e.jsx(ln,{className:"inline-block h-12 w-12"}):e.jsx(xi,{headlineOption:a}),e.jsxs(ne.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:B(!l&&!u&&"h-[116px]"),children:[o&&e.jsx(Si,{starterPrompts:n,onSelectStarterPrompt:r,disabled:t,clientThreadId:s,onExpand:()=>c(!0),mobileLayout:!0}),u&&e.jsx(vi,{toolChips:p,onSelectToolChip:m,disabled:t,mobileLayout:!0,selectedHint:d})]})]})})}function pg(t){const s=Ee("1468311859").value,a=Ee("3664702598").value,{layer:o}=zt("4031588851"),n=dg(),r=s,l=a&&n;let c="HARDCODED";if(t){const u=o.get("search_autocomplete_mode","");r&&u&&(c=u)}else l&&(c=o.get("autocomplete_mode","HARDCODED"));return c}function gg({clientThreadId:t,currentModelId:s,isModelLoaded:a,onRequestCompletion:o,chatgptHomepageDisclaimer:n}){const r=xn(),l=Lt(t),c=go(),[u,p]=i.useState([]),m=i.useCallback(z=>{p(q=>{const ie=typeof z=="function"?z(q):z;return rr(ie,q)?q:ie})},[]),{trendingSuggestions:d,fetchTrendingSuggestions:h}=vg(Un),v=i.useRef(!1),{isUnauthenticated:g}=ot(),b=Rl(),[C,S]=i.useState(!1),w=Zr(),T=st();Lr(r);const _=Ee("589604007").value,{layer:M}=Xs("4031588851"),{layer:L}=Xs("3533083032"),{replaceStarterPromptsWithToolChips:k,toolChips:x}=cg(t),j=pi(r,t),N=hi(r),{prospectiveModelId:E,isLastUsedModelLoading:R}=Mu(t),f=a?s:E??"auto",F=!R,{promptStarters:P,isSuccess:I}=Fr(l&&F,t,8,_,!0,f),A=b&&!!u.find(z=>!!z.requires_file_upload),G=i.useCallback(z=>{const q=r.getCurrentText();return q&&zn(z).startsWith(q.toLocaleLowerCase())},[r]),Y=i.useCallback(z=>{const q=r.getCurrentText(),ie=z.title+z.body;return G(z)?{...z,title:q,body:ie.slice(q.length)}:{...z,title:ie,body:""}},[r,G]),D=i.useCallback((z=!1)=>{m(q=>!q.some(G)&&q.length>0?[]:z?q:q.map(Y))},[G,Y,m]),te=(z,q,ie)=>{const $=z.title;m([]),r.focus(),r.setText($),requestAnimationFrame(()=>{const X=(P?.filter(le=>le.theme===z.theme)??[]).map(le=>{const Se=Ft(le.oneliner),Ye=Se.startsWith(le.title);return{...le,title:Ye?`${le.title} `:"",body:Ye?le.body:Se,autocompletionChunks:Gp($,Se),type:Wt.Autocomplete}});m(X),X.length>0&&Ut(X,t),Au(z,ie,t)})};i.useEffect(()=>{const z=u.some(q=>q.theme===Qn.Search);w&&r.getCurrentText()===""?d.length>0?m(d):h():z&&!w&&m(q=>q.filter(ie=>ie.theme!==Qn.Search))},[u,w,d,h,r,m]),i.useEffect(()=>{w&&r.getCurrentText()===""&&d.length>0&&Ut(d,t)},[w,r,d,t]);const re=P?.reduce((z,q)=>(q.theme&&!z[q.theme]&&(z[q.theme]=q),z),{}),Me=[];if(re)for(const z in re)z!=="For you"&&Me.push(re[z]);const at=Me&&Me.length>0,Z=!!(I&&at&&a&&!k);qe.markStart("StarterPromptChips",qe.NS_COMPOSER),Z&&qe.markRendered("StarterPromptChips",qe.NS_COMPOSER);const Te=Un-u.filter(G).length,fe=pg(w),ve=g?L.get("headline_option","HELP_WITH"):M.get("headline_option","HELP_WITH"),ke=M.get("autocomplete_min_char",4),Pe=M.get("autocomplete_fetch_interval",200),xe=i.useRef(null),he=i.useCallback(Or(async z=>{const q=r.getCurrentText();if(!q||q.length<ke||q.length>80||r.hasMultipleLines()){m([]);return}if(!v.current&&!(xe.current&&xe.current.length>ke&&q.startsWith(xe.current)))try{const ie=await hs.generateAutocompletions(q,z,w);if(ie.completions.length===0){xe.current=q;return}const $=ie.completions.map(X=>({id:Ql(),type:Wt.Autocomplete,title:X.slice(0,q.length),body:X.slice(q.length),oneliner:X,prompt:X,source:fe})).filter(G).map(Y);m(X=>{const le=X.filter(G),Se=$.filter(Ye=>{const be=zn(Ye);return!le.some(Ke=>{const He=zn(Ke);if(be===He)return!0;const _e=/[\p{P}\p{S}]$/u,rt=be.replace(_e,""),pe=He.replace(_e,"");return rt===He||be===pe||rt===pe})}).slice(0,Un-le.length);return[...le,...Se]}),$.length>0&&Ut($,t)}catch{}},fe==="BING"?150:Pe),[r,fe,Y,Pe]),Ie=i.useCallback(()=>{D(),Te>0&&he(Te)},[he,D,Te]);i.useEffect(()=>{v.current&&m([])},[v,m]);const Ue=i.useMemo(()=>fe==="HARDCODED"?D:Ie,[fe,Ie,D]),ze=i.useCallback(()=>{r instanceof Fo&&D(!0),r.getCurrentText().indexOf(`
`)>0&&m([])},[r,m,D]),ue=i.useCallback((z,q,ie)=>{q.forEach($=>{$.id===z.id&&($.userInput=r.getCurrentText())}),m([q[ie]])},[r,m]),Ge=dr();return e.jsx(e.Fragment,{children:e.jsx(ps,{children:e.jsx("div",{className:B("h-full w-full",Ge?"@lg/thread:py-[18px]":"lg:py-[18px]"),children:e.jsx(Do,{isStaticSharedThread:!1,verticalPadding:"none",horizontalPadding:"standard",clientThreadId:t,fullHeight:!0,children:e.jsxs(Ca,{className:"relative",children:[e.jsx("div",{className:B("mb-7 hidden text-center",Ge?"@lg/thread:block":"lg:block"),children:ve==="CHATGPT_LOGO"?e.jsx(ln,{className:"inline-block h-12 w-12"}):e.jsx(xi,{headlineOption:ve})}),e.jsx(hg,{headlineOption:ve,shouldShowStarterPrompts:Z,promptChips:Me,onSelectStarterPrompt:te,starterPromptExpanded:C,setStarterPromptExpanded:S,isSendBlocked:c,clientThreadId:t,replaceStarterPromptsWithToolChips:k,toolChips:x,onSelectToolChip:j,selectedHint:N}),e.jsx("div",{className:B(Ge?"@lg/thread:absolute @lg/thread:bottom-8 @lg/thread:left-0 @lg/thread:w-full":"[display:var(--display-hidden-until-loaded,block)] lg:absolute lg:bottom-8 lg:left-0 lg:w-full"),children:e.jsx(Ca,{className:"relative @lg/thread:pb-0",children:T?e.jsx(fi,{}):e.jsx(ci,{className:"block"})})}),e.jsx("div",{className:"w-full",children:e.jsx(gi,{clientThreadId:t,isNewThread:l,currentModelId:s,onRequestCompletion:o,showPromptStarters:!1,autocompletions:u,requiresFileUpload:A,onComposerInput:Ue,onComposerChange:ze,onAutocompleteSelect:ue,onTaggingDropdownClose:()=>{v.current=!1},onTaggingDropdownOpen:()=>{v.current=!0},hideHeader:!0})}),e.jsxs(ne.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:B("hidden",Ge?"@lg/thread:block":"lg:block",n&&g&&C?"":!k&&"h-[70px]"),children:[Z&&e.jsx(Si,{starterPrompts:Me,onSelectStarterPrompt:te,disabled:c,clientThreadId:t,onExpand:()=>S(!0)}),k&&e.jsx(vi,{toolChips:x,onSelectToolChip:j,disabled:c,selectedHint:N})]}),n&&e.jsx("div",{className:B("w-full px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden md:px-[60px]",Ge?"@lg/thread:absolute @lg/thread:bottom-0 @lg/thread:left-0":"lg:absolute lg:bottom-0 lg:left-0"),children:e.jsx("div",{className:B("min-h-4"),children:n})})]})})})})})}function xi({headlineOption:t}){const a=we().formatMessage(bg[t]||ls.whatCanIHelpWith);return e.jsx("div",{className:"relative inline-flex justify-center text-center text-2xl font-semibold leading-9",children:e.jsx("h1",{style:{viewTransitionName:"var(--vt-splash-screen-headline)"},children:a})})}function fg({starterPrompt:t,starterPrompts:s,index:a,disabled:o,onSelectStarterPrompt:n}){const r=t.theme??t.title,l=fn(),{mutate:c}=Nu(),u=t.category==="onboarding"?()=>{c({key:ut.hasUsedConversationalOnboardingStarterPrompt}),l(t,s,a)}:()=>n(t,s,a);return e.jsx(Ur,{disabled:o,onClick:u,icon:e.jsx(Eu,{category:t.category,useV2Colors:!0}),label:r})}function Fa({clientThreadId:t,onClick:s}){i.useEffect(()=>{Ru(t)},[t]);const a=we();return e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},className:"inline-block",children:e.jsx(Ur,{onClick:()=>{Pu(t),s()},label:a.formatMessage(ls.moreStarterPrompts)})})}const xg=5,Sg=3;function Si({starterPrompts:t,onSelectStarterPrompt:s,disabled:a,clientThreadId:o,onExpand:n,mobileLayout:r=!1}){const l=r?Sg:xg,[c,u]=i.useState(l),[p,m]=i.useState(!1),d=i.useRef(null),h=t.length<=c;i.useEffect(()=>{Ut(t.slice(0,l),o)},[o]),i.useEffect(()=>{if(!p&&!h&&d.current){const g=d.current,b=g.getBoundingClientRect(),C=b.width,S=Array.from(g.children);let w=0;for(let T=0;T<S.length&&S[T].getBoundingClientRect().right-b.left<=C;T++)w++;u(w),m(!0)}},[t,h,p]);const v=()=>{const g=t.slice(c,t.length).map(b=>({...b,isAdditional:!0}));g.length>0&&Ut(g,o),u(t.length),n()};return e.jsxs("div",{className:B("mt-5 flex items-center justify-center gap-x-2 transition-opacity xl:gap-x-2.5",p&&t.length>0?"opacity-100":"opacity-[0.01]",r?"flex-wrap":"flex-nowrap"),children:[e.jsxs("ul",{className:B("relative flex items-stretch gap-x-2 gap-y-4 overflow-hidden py-2 sm:gap-y-2 xl:gap-x-2.5 xl:gap-y-2.5",h||r?"flex-wrap justify-center":"flex-nowrap justify-start"),ref:d,children:[t.slice(0,c).map((g,b)=>e.jsx(ne.li,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},children:e.jsx(fg,{starterPrompt:g,starterPrompts:t,index:b,disabled:a,onSelectStarterPrompt:s})},g.id??b)),r&&t.length>c&&e.jsx(Fa,{clientThreadId:o,onClick:v})]}),!r&&t.length>c&&e.jsx(Fa,{clientThreadId:o,onClick:v})]})}function vi({toolChips:t,onSelectToolChip:s,disabled:a,mobileLayout:o=!1,selectedHint:n}){return e.jsx("div",{className:B("mt-5 gap-x-2 transition-opacity xl:gap-x-2.5",t.length>0?"opacity-100":"opacity-[0.01]",{"flex flex-wrap justify-center":!o}),children:e.jsx("ul",{className:B("relative overflow-hidden py-2 sm:gap-y-2",{"grid grid-cols-2 justify-items-center gap-4":o},{"flex flex-wrap justify-start gap-x-[60px] gap-y-4":!o}),children:t.map(({id:r,label:l,description:c,icon:u,systemHint:p},m)=>e.jsx(ne.li,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},children:e.jsx(Tu,{label:l,description:c,icon:u,onClick:()=>{p&&s({hint:p,enable:p.systemHint!==n})},disabled:a})},r??m))})})}const vg=t=>{const[s,a]=i.useState([]),o=i.useCallback(async()=>{const r=(await hs.generateTrendingSuggestions(t)).suggestions.map((l,c)=>({type:Wt.Trending,title:La(l),body:"",icon:e.jsx(ku,{}),prompt:La(l),id:`search-trending-${c}`,theme:Qn.Search}));a(r)},[t]);return{trendingSuggestions:s,fetchTrendingSuggestions:o}};function La(t){return t.split(" ").map(_u).join(" ")}const ls=pt({whatCanIHelpWith:{id:"SplashScreenV2.whatCanIHelpWith",defaultMessage:"What can I help with?"},whereShouldWeStart:{id:"SplashScreenV2.whereShouldWeStart",defaultMessage:"Where should we start?"},askChatgptAnything:{id:"SplashScreenV2.askChatgptAnything",defaultMessage:"Ask ChatGPT anything"},moreStarterPrompts:{id:"SplashScreenV2.moreStarterPrompts",defaultMessage:"More"}}),bg={HELP_WITH:ls.whatCanIHelpWith,WHERE_TO_START:ls.whereShouldWeStart,ASK_CHATGPT:ls.askChatgptAnything};function yg({clientThreadId:t,currentModelId:s,isModelLoaded:a,onRequestCompletion:o,showChatgptHomepage:n,chatgptHomepageDisclaimer:r}){const l=At();let c=e.jsx(uh,{}),u;return l?(u=e.jsx(wg,{}),c=e.jsx(ln,{className:"mb-6 h-12 w-12 brand:hidden"})):t!=null?(u=n?e.jsx(ug,{clientThreadId:t,currentModelId:s,isModelLoaded:a,onRequestCompletion:o,chatgptHomepageDisclaimer:r}):e.jsx(mh,{clientThreadId:t}),c=null):u=e.jsx(jg,{}),e.jsxs("div",{className:"flex h-full flex-col items-center justify-center text-token-text-primary",children:[c,u]})}function wg({gizmo:t}){const s=Hu(),a=t?Du(t.tools):!1,o=ds();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-5 text-2xl font-semibold","data-testid":"temporary-chat-label",children:[e.jsx(Bu,{id:"temporary-chat-checkbox",name:"temporary-chat-checkbox",checked:!0}),e.jsx(H,{...kt.temporaryChat})]}),e.jsxs("div",{className:"max-w-sm text-center text-sm font-normal text-token-text-tertiary",children:[e.jsx(H,{...o?.isWorkspaceAccount()?s?kt.temporaryChatBizMemoryAvailable:kt.temporaryChatBizMemoryUnavailable:s?kt.temporaryChatDescriptionMemoryAvailable:kt.temporaryChatDescriptionMemoryUnavailable}),a&&e.jsx("div",{className:"mt-3",children:e.jsx(H,{...kt.temporaryChatDescriptionGptActions,values:{link:n=>e.jsx("a",{href:"https://help.openai.com/en/articles/8914046-temporary-chat-faq",target:"_blank",className:"underline",rel:"noreferrer",children:n})}})})]})]})}function jg(){return e.jsx("div",{className:"mb-5 text-2xl font-semibold",children:e.jsx(H,{...kt.howCanIHelpYouToday})})}function Cg({clientThreadId:t,currentModelId:s,isModelLoaded:a,onRequestCompletion:o,showChatgptHomepage:n,chatgptHomepageDisclaimer:r}){const l=nt(t),c=ur(),u=go(),{data:p}=Nt(l),m=Iu(),d=or(()=>navigator.windowControlsOverlay);return(c!=null||l!=null)&&p==null?null:e.jsxs("div",{className:"relative h-full",children:[e.jsx("div",{className:d?.visible?B("absolute right-[calc(100dvw-env(titlebar-area-width,100dvw)-env(titlebar-area-x,0))]",m?"left-[env(titlebar-area-x,0)]":"left-0"):"absolute left-0 right-0",children:e.jsx(ni,{clientThreadId:t})}),p!=null?e.jsx(dh,{gizmo:p,showStarterPrompts:!0,disableStarterPrompts:u}):e.jsx(yg,{clientThreadId:t,currentModelId:s,isModelLoaded:a,onRequestCompletion:o,showChatgptHomepage:n,chatgptHomepageDisclaimer:r})]})}const kt=pt({temporaryChat:{id:"GizmoLanding.temporaryChat",defaultMessage:"Temporary Chat"},temporaryChatBizMemoryAvailable:{id:"g1opBW",defaultMessage:"This chat won't appear in your history and won't use or create memories."},temporaryChatBizMemoryUnavailable:{id:"fQmbtG",defaultMessage:"This chat won't appear your conversation history."},temporaryChatDescriptionMemoryAvailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryAvailable",defaultMessage:"This chat won't appear in history, use or create memories, or be used to train our models. For safety purposes, we may keep a copy for up to 30 days."},temporaryChatDescriptionMemoryUnavailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryUnavailable",defaultMessage:"This chat won't appear in history or be used to train our models. For safety purposes, we may keep a copy of this chat for up to 30 days."},temporaryChatDescriptionGptActions:{id:"GizmoLanding.temporaryChatDescriptionGptActions",defaultMessage:"Any data shared with a third party through GPT actions are subject to the third party's privacy policy. <link>Learn more</link>"},howCanIHelpYouToday:{id:"GizmoLanding.howCanIHelpYouToday",defaultMessage:"How can I help you today?"}});function Mg({modelSlug:t,animateModelLabelOnRender:s,isDropdownOpen:a,isRegenerateEnabled:o,isHovered:n,animateShortLabel:r}){const{data:l}=ht(),[c,u]=i.useState("initial");i.useEffect(()=>{if(s){const h=setTimeout(()=>u("show"),500),v=setTimeout(()=>u("initial"),2e3);return()=>{clearTimeout(h),clearTimeout(v)}}u("initial")},[s]);const{shorterLabel:p}=l?.categories.find(({defaultModel:h})=>h===t)??{},m={initial:{opacity:0,paddingLeft:0,width:"0"},show:{opacity:1,paddingLeft:2,width:"100%"},visible:{opacity:1,paddingLeft:2,width:"100%",transition:{delay:0,duration:0}}},d=a?"visible":n?"show":c;return e.jsxs(ne.div,{initial:"initial",animate:d,className:"flex items-center pb-0",children:[e.jsx(zr,{className:"icon-md"}),(o||r)&&e.jsx(ne.span,{className:"overflow-hidden text-clip whitespace-nowrap text-sm",variants:m,transition:{type:"tween",duration:.18},children:p}),o&&e.jsx(Mo,{className:"icon-sm"})]})}function oo(t,s){const{modelSwitcherDeny:a,subscriptionLevel:o}=t;return!!a&&a.reason===Pl.RATE_LIMIT&&o===Il.PLUS&&!s}const qs="rounded-lg radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed";function Tg({className:t,clientThreadId:s,message:a,onModelSelect:o,onDropdownChange:n,canRegenerateResponse:r}){const[l,c]=i.useState(null),[u,p]=i.useState(!1),[m,d]=i.useState(!1),h=nt(s),v=Fu({clientThreadId:s,message:a}),g=a.message.metadata?.model_slug,b=a.message.id,{modelOptions:C,modelSlug:S,animateModelLabelOnRender:w,messageModelEnabledTools:T}=v,_=Lu(a.message),M=T.includes(K.Search),L=i.useMemo(()=>C.find(f=>f.value===g),[C,g]),k=i.useRef(null),{data:x=null}=rn(),j=x&&ao(x),N=f=>{f||setTimeout(()=>{k.current&&k.current.blur()},10)};if(i.useEffect(()=>{N(u)},[u]),ae(s,zu))return null;const R=r&&C.some(f=>oo(f,j));return h?null:e.jsxs(ee.Root,{onOpenChange:f=>{r&&(p(f),n(f),N(f)),f&&W.logEvent(U.conversationOpenMessageModelSelector,{has_get_plus_button:R,is_new_regen_dropdown:!0})},children:[r?e.jsx(_g,{label:e.jsx(H,{id:"wDs5sz",defaultMessage:"Switch model"}),children:e.jsx(po,{ref:k,className:B("cursor-pointer",t),onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),children:e.jsx(Mg,{modelSlug:S,animateModelLabelOnRender:w,isDropdownOpen:u,isRegenerateEnabled:r,isHovered:m})})}):null,r&&e.jsx(ee.Portal,{children:e.jsxs(ee.Content,{className:"z-30 min-w-fit origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[e.jsx(ee.Item,{disabled:!0,className:"pb-0 pt-2",children:e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(H,{id:"bFLh5u",defaultMessage:"Switch model"})})}),e.jsx(kg,{clientThreadId:s,messageId:b,onModelSelect:o,messageModelSlug:g,modelOptions:C,setHoveredOption:c,hoveredOption:l,retryOption:L,lastResponseUsedSearch:_,modelSupportsSearch:M,doesUserHaveAnyAccountsWithPlusFeatures:j})]})})]})}function kg({clientThreadId:t,messageId:s,modelOptions:a,messageModelSlug:o,onModelSelect:n,setHoveredOption:r,hoveredOption:l,retryOption:c,lastResponseUsedSearch:u,modelSupportsSearch:p,doesUserHaveAnyAccountsWithPlusFeatures:m}){const d=we(),[h,v]=i.useMemo(()=>Ou(a,S=>S.subcategory),[a]),g=i.useMemo(()=>{const S=new Map;return h.forEach(w=>{const T=w.subcategory;T&&(S.has(T)||S.set(T,[]),S.get(T)?.push(w))}),S},[h]),b=B("icon-sm","order-10 ml-auto text-token-text-tertiary icon-md"),C=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:d.formatMessage(Gn.search),icon:e.jsx(Ar,{className:b}),condition:p&&!u,eventName:"chatgpt_regenerate_with_search_button_clicked"},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:d.formatMessage(Gn.nosearch),icon:e.jsx(Uu,{className:b}),condition:p&&u,eventName:"chatgpt_regenerate_without_search_button_clicked"}];return e.jsxs(e.Fragment,{children:[v.map(S=>{const{value:w,...T}=S;return e.jsx(Os,{value:w,onSelect:()=>{je.logEvent("chatgpt_regenerate_switch_model_button_clicked",w,{requestedModelId:w,...rs({clientThreadId:t,messageId:s})}),n({requestedModelId:w})},includeRegenerate:!1,onMouseEnter:()=>r(w),onMouseLeave:()=>r(null),isHovered:l===w,messageModelSlug:o,includeCheck:!1,shouldShowUpsell:oo(S,m),className:qs,...T,icon:e.jsx("span",{className:b})},w)}),[...g.entries()].map(([S,w])=>e.jsxs(ee.Sub,{children:[e.jsx(ee.SubMenuTrigger,{children:e.jsx("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:S})}),e.jsx(ee.Portal,{children:e.jsx(ee.SubContent,{className:"min-w-fit",children:w.map(T=>{const{value:_,...M}=T;return e.jsx(Os,{value:_,onSelect:()=>{je.logEvent("chatgpt_regenerate_switch_model_button_clicked",_,{requestedModelId:_,...rs({clientThreadId:t,messageId:s})}),n({requestedModelId:_})},includeRegenerate:!1,onMouseEnter:()=>r(_),onMouseLeave:()=>r(null),isHovered:l===_,messageModelSlug:o,includeCheck:!1,className:qs,...M,icon:null,shouldShowUpsell:oo(T,m)},S+"-"+_)})})})]},S)),!!c&&e.jsxs(e.Fragment,{children:[e.jsx(ee.Separator,{}),e.jsx(Os,{onSelect:()=>{je.logEvent("chatgpt_regenerate_try_again_button_clicked",c.value,{requestedModelId:c.value,...rs({clientThreadId:t,messageId:s})}),n({requestedModelId:c.value})},includeRegenerate:!0,onMouseEnter:()=>r(c.value),onMouseLeave:()=>r(null),messageModelSlug:o,includeCheck:!1,className:qs,...c,label:d.formatMessage(Gn.tryAgain),subtitle:c.label,icon:e.jsx(zr,{className:b})},c.value),C.filter(S=>S.condition).map(S=>e.jsx(Os,{onSelect:()=>{je.logEvent(S.eventName,c.value,{requestedModelId:c.value,...rs({clientThreadId:t,messageId:s})}),n({requestedModelId:c.value,extraStreamParams:S.extraStreamParams})},includeRegenerate:!1,onMouseEnter:()=>r(S.key),onMouseLeave:()=>r(null),isHovered:l===S.key,messageModelSlug:o,includeCheck:!1,className:qs,...c,label:S.label,subtitle:"",icon:S.icon},S.key))]})]})}function _g({children:t,label:s}){return e.jsx(us,{label:s,sideOffset:0,children:t})}const Gn=pt({tryAgain:{id:"VbsBGW",defaultMessage:"Try again"},search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),Ag=i.memo(Tg);function Ng({followups:t}){const s=fn();return e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 font-semibold",children:e.jsx(H,{id:"3UFIQc",defaultMessage:"Follow up"})}),e.jsx("div",{children:t.slice(0,4).map((a,o)=>e.jsx(ne.div,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:o*.03},exit:{opacity:0,translateY:4},children:e.jsx(Eg,{followUp:a,onSelectingSuggestedReply:s})},o))})]})}function Eg({followUp:t,onSelectingSuggestedReply:s}){return e.jsxs("button",{className:"-ml-3 flex w-full items-start gap-1 rounded-lg py-2.5 hover:bg-token-main-surface-secondary",onClick:()=>s(t,[],0),children:[e.jsx("div",{className:"pl-2 opacity-30",children:e.jsx(Po,{className:"h-6 w-6"})}),e.jsx("div",{className:"gap-0.5 pr-2 text-left",children:Gu(t)})]})}const Oa=Ve(()=>$e(()=>import("./j4xe1fdohr6xk09p.js").then(t=>t.sw),__vite__mapDeps([4,1,2,3,5])).then(t=>t.MemoryActionResult));function Ua(t,s,a){mr.updateTree(t,o=>{o.updateNodeMetadata(s,{inlineComparisonRating:a})})}const za=({messages:t})=>{for(const{message:{metadata:s}}of t){const{augmented_paragen_prompt_label:a}=s??{};if(a)return a}};function Rg(t){const s=i.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),a=i.useRef({left:null,right:null});return t.stubSideBySideFeedback?e.jsx(bi,{setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:s,firstVisibleTokenTimestampsRef:a,...t}):e.jsx(Pg,{...t,visibilityStateRef:s,firstVisibleTokenTimestampsRef:a})}function Pg(t){const{clientThreadId:s,variantIds:a,variantsInStreamInfo:o,turnIndex:n,firstVisibleTokenTimestampsRef:r}=t;if(a.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const l=Yo(),c=vo(),u=Hl(),[p,m]=i.useMemo(()=>Gr(a.join(""))()<.5?[0,1]:[1,0],[a[0],a[1]]),d=p<m?"left":"right",h=d==="left"?"right":"left",v=a[p],g=a[m],[b,C]=ae(s,j=>[Ft(j).tree.getLeafFromNode(v).id,Ft(j).tree.getLeafFromNode(g).id]),S=Ft(Vn(s,n,b)),w=Ft(Vn(s,n,C)),T=d==="left"?S:w,_=d==="left"?w:S,M=o.display_treatment==="unskippable",L=l?"skippable_parallel_2_in_stream:a:2.0":"skippable_parallel_2_in_stream:a:1.5";i.useEffect(()=>(Jn.setState({displayingSideBySideFeedback:!0,unskippable:M}),()=>{Jn.setState({displayingSideBySideFeedback:!1,unskippable:!1})}),[M]),Wu();const k=i.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null});i.useEffect(()=>Dl(Bl,{requestCompletion:()=>{const j=Qe(s),E=Q.getTree(Oe(s)).getParentPromptNode(b),R=[S,w].map((P,I)=>({messageId:P.messages[P.messages.length-1].message.id,loadFirstTokenTime:I===0?r.current.left:r.current.right,loadEndTime:cs(P.messages)?.completionSampleFinishTime})),f={},F=E.metadata?.variantsInStreamInfo==null&&E.message.metadata?.paragen_variants_info!=null;for(const P of R)f[P.messageId]=F?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:P.loadFirstTokenTime,load_end_time:P.loadEndTime};Ya({params:{conversation_id:j,displayed_message_ids:R.map(P=>P.messageId),message_metadatas:f,rating:"skipped",selected_message_id:null,source_timestamp:Date.now(),ui_variant:l?2:1,user_prompt_message_id:E.message.id}})}}),[S,w,b,s,t.conversationTurnMountTime,L,h,T?.messages,_?.messages,u,l,r]);const x=j=>{const N=Q.getTree(Oe(s)),E=N.getLeafFromNode(j);mr.setThreadCurrentLeafId(s,E.id);const R=j===v,f=R===(d==="left");T.messages.length>0&&Ua(s,T.messages[T.messages.length-1].nodeId,f?"original":"new"),_.messages.length>0&&Ua(s,_.messages[_.messages.length-1].nodeId,f?"original":"new");const F=Qe(s),P=[S,w].map((D,te)=>({messageId:D.messages[D.messages.length-1].message.id,loadFirstTokenTime:te===0?r.current.left:r.current.right,loadEndTime:cs(D.messages)?.completionSampleFinishTime})),I=R?P[0].messageId:P[1].messageId,A=N.getParentPromptNode(b),G={},Y=A.metadata?.variantsInStreamInfo==null&&A.message.metadata?.paragen_variants_info!=null;for(const D of P)G[D.messageId]=Y?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:D.loadFirstTokenTime,load_end_time:D.loadEndTime};Ya({params:{conversation_id:F,displayed_message_ids:P.map(D=>D.messageId),message_metadatas:G,rating:"selected",selected_message_id:I,source_timestamp:Date.now(),ui_variant:l?2:1,user_prompt_message_id:A.message.id}})};return e.jsx(bi,{...t,setPreferredFeedback:x,leftVariantId:v,rightVariantId:g,leftTurn:S,rightTurn:w,hasActiveRequest:c,originalTurn:T,visibilityStateRef:k})}function bi({setPreferredFeedback:t,leftVariantId:s,rightVariantId:a,leftTurn:o,rightTurn:n,hasActiveRequest:r,originalTurn:l,visibilityStateRef:c,...u}){const{defaultParagenLabel:p,shouldShowParagenLabels:m=!1}=jr(),d=o&&za(o)||p,h=n&&za(n)||p,v=i.useMemo(()=>o?.messages??[],[o?.messages]),g=i.useMemo(()=>n?.messages??[],[n?.messages]),{avatarClassName:b,firstVisibleTokenTimestampsRef:C}=u,S=i.useMemo(()=>an(v),[v]),w=i.useMemo(()=>an(g),[g]),T=yr(),_=_t(o?Zs.getRequestIdFromConversationTurn(o):""),M=_t(n?Zs.getRequestIdFromConversationTurn(n):""),L=o?.role===tt.User,k=n?.role===tt.User,x=i.useRef(null),j=i.useRef(null),N=i.useRef(null),E=!!u.stubSideBySideFeedback,R=!!u.stubSideBySideFeedback;!E&&C.current.left==null&&(C.current.left=Date.now()),!R&&C.current.right==null&&(C.current.right=Date.now()),i.useEffect(()=>{if(x.current&&j.current&&N.current){const A=Array(11).fill(0).map((Y,D)=>D/10),G=new IntersectionObserver(Y=>Y.forEach(D=>{D.target===j.current?(c.current.left_visibility_initial==null&&(c.current.left_visibility_initial=D.intersectionRatio),c.current.left_visibility_max=Math.max(c.current.left_visibility_max??0,D.intersectionRatio)):D.target===N.current&&(c.current.right_visibility_initial==null&&(c.current.right_visibility_initial=D.intersectionRatio),c.current.right_visibility_max=Math.max(c.current.right_visibility_max??0,D.intersectionRatio))}),{root:x.current,threshold:A});return G.observe(j.current),G.observe(N.current),()=>G.disconnect()}},[c]);const{data:f}=wr(void 0,!1,T),F=Yo(),P=e.jsx("div",{className:"text-pretty px-6 pb-5 pt-1 text-center text-sm text-token-text-secondary",children:e.jsx(H,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})}),I=st();return e.jsxs("div",{className:"relative flex flex-col",children:[e.jsxs("div",{className:B("sticky z-[1] text-pretty bg-token-main-surface-primary px-6 text-center text-lg",I&&"top-[var(--thread-leading-height)] pt-3",!I&&"top-[-1px]",F&&!I?"md:top-header-height":I?"":"md:static"),"data-testid":"paragen-feedback-title",children:[e.jsx(H,{id:"JgCHDY",defaultMessage:"You’re giving feedback on a new version of ChatGPT."}),F?P:null]}),F?null:P,e.jsx("div",{className:"relative -mb-2 snap-x snap-mandatory overflow-x-auto px-3 pb-4 md:px-5 lg:px-10",ref:x,children:e.jsx("div",{className:B(!I&&"min-w-fit"),children:e.jsxs("div",{className:B("mx-auto flex max-w-6xl items-start",F&&!I&&"divide-x divide-token-border-medium dark:divide-token-border-heavy",!F&&!I&&"gap-4 sm:gap-6",F&&I&&"divide-x divide-token-border-medium dark:divide-token-border-heavy",I&&!F&&"gap-4 sm:gap-6"),children:[e.jsxs(Ga,{horizontalScrollContainerRef:x,rootElementRef:j,onClick:()=>{t(s)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:E,children:[e.jsxs(Va,{children:[e.jsx(Xn,{messages:v,isUserTurn:L,avatarClassName:b}),e.jsx(qa,{children:m?e.jsx("span",{className:"font-bold text-token-text-primary",children:d}):e.jsx(H,{...Ka.responseNumber,values:{responseIndex:1}})})]}),F&&E?e.jsx(Wa,{}):e.jsxs(e.Fragment,{children:[f!=null&&!L&&e.jsx(Oa,{clientThreadId:u.clientThreadId,messages:v,isParagen:!0}),e.jsx(eo,{...u,allMessages:v,groupedMessagesToRender:S,allGroupedMessages:S,isEditing:!1,isUserTurn:L,isCompletionRequestInProgress:_,hasActiveRequest:r,handleEnterEdit:Ds,handleExitEdit:Ds,shouldGrowContainer:!1}),e.jsx($a,{clientThreadId:u.clientThreadId,conversationTurnMountTime:u.conversationTurnMountTime,turn:o,originalTurn:l})]})]}),e.jsxs(Ga,{horizontalScrollContainerRef:x,rootElementRef:N,onClick:()=>{t(a)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:R,children:[e.jsxs(Va,{children:[e.jsx(Xn,{messages:g,isUserTurn:k,avatarClassName:b}),e.jsx(qa,{children:m?e.jsx("span",{className:"font-bold text-token-text-primary",children:h}):e.jsx(H,{...Ka.responseNumber,values:{responseIndex:2}})})]}),F&&R?e.jsx(Wa,{}):e.jsxs(e.Fragment,{children:[f!=null&&!k&&e.jsx(Oa,{clientThreadId:u.clientThreadId,messages:g,isParagen:!0}),e.jsx(eo,{...u,allMessages:g,groupedMessagesToRender:w,allGroupedMessages:w,isEditing:!1,isUserTurn:k,isCompletionRequestInProgress:M,hasActiveRequest:r,handleEnterEdit:Ds,handleExitEdit:Ds,shouldGrowContainer:!1}),e.jsx($a,{clientThreadId:u.clientThreadId,conversationTurnMountTime:u.conversationTurnMountTime,turn:n,originalTurn:l})]})]})]})})})]})}function Ga({horizontalScrollContainerRef:t,rootElementRef:s,onClick:a,children:o,hasActiveRequest:n,isWaitingOnFirstUserVisibleToken:r}){const l=Yo(),c=st(),{scrollX:u}=Xl({layoutEffect:!1,container:t,target:s}),p=qu(),m=Vu(),d=i.useRef(null),h=i.useRef(null),v=i.useRef(null),[g,b]=i.useState(!1),[C,S]=i.useState(!1),[w,T]=i.useState(!1),[_,M]=i.useState(0);i.useEffect(()=>{if(!l)return;const R=new IntersectionObserver(f=>{for(const F of f)F.target===d.current?b(F.isIntersecting):F.target===v.current?T(F.isIntersecting):F.target===h.current&&S(F.isIntersecting)},{root:p?.current,rootMargin:c?`0px 0px -${_}px 0px`:void 0});return d.current&&h.current&&v.current&&(R.observe(d.current),R.observe(h.current),R.observe(v.current)),()=>{R.disconnect()}},[_,l,c,p]);const L=!w&&(C||g),k=Zl(u,R=>L?-1*R:0),x=va(0);i.useEffect(()=>{if(!l)return;const R=new ResizeObserver(f=>{Us(f.length===1,"entryList.length === 1");const F=f[0];Us(F.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),x.set(F.contentBoxSize[0].inlineSize)});return s.current&&R.observe(s.current),()=>{R.disconnect()}},[l,x,s]);const j=va(0);i.useEffect(()=>{if(!l)return;const R=new ResizeObserver(f=>{Us(f.length===1,"entryList.length === 1");const F=f[0];Us(F.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),j.set(F.contentBoxSize[0].blockSize+16),M(F.contentBoxSize[0].blockSize)});return m.current&&R.observe(m.current),()=>{R.disconnect()}},[l,j,m]);const N=e.jsx(qt,{className:l?"px-5":"mt-4 self-start",onClick:a,"data-testid":"paragen-prefer-response-button",children:e.jsx(H,{id:"U2EAH6",defaultMessage:"I prefer this response"})}),E=r;return e.jsxs("div",{"data-paragen-root":!0,className:B("relative flex w-full min-w-[min(450px,80vw)] snap-center flex-col gap-1 text-left",c&&l&&"pl-3 pr-5 sm:w-[calc(100cqw-62px)] sm:pl-3 sm:pr-5 md:px-10",!c&&l&&"px-10",l?"min-h-60 py-4":"rounded-2xl border border-token-main-surface-tertiary bg-white p-5 dark:bg-gray-700"),ref:s,children:[e.jsx("div",{className:B("absolute left-0 right-0 top-48 h-px","invisible"),ref:d}),e.jsx("div",{className:B("absolute bottom-0 left-0 right-0 top-48","invisible"),ref:h}),e.jsx("div",{className:B("absolute bottom-0 left-0 right-0 h-px","invisible"),ref:v}),o,l?e.jsx("div",{className:"flex-1"}):null,l?e.jsx("div",{className:"mt-4 min-h-10",children:E?null:e.jsx(ne.div,{style:{translateX:k,width:x,bottom:j},animate:{opacity:100},initial:{opacity:0},transition:{ease:"easeOut",duration:.2,delay:.5},className:B({fixed:L,"z-20 flex w-full justify-center":!0}),children:N})}):n?null:N]})}function Wa(){return e.jsxs("div",{className:"flex w-full flex-col gap-4 pb-5 pt-3",children:[e.jsx(Tt,{className:"h-4 w-[75%]"}),e.jsx(Tt,{className:"h-4 w-[50%]"}),e.jsx(Tt,{className:"h-4 w-[80%]"}),e.jsx(Tt,{className:"h-4 w-[55%]"}),e.jsx(Tt,{className:"h-4 w-[66%]"}),e.jsx(Tt,{className:"h-4 w-[64%]"}),e.jsx(Tt,{className:"h-4 w-[48%]"})]})}function Yo(){const{layer:t}=zt("3119715334");return t.get("should-enable-hojicha",!1)}const qa=Ce.div`text-sm text-token-text-secondary font-semibold`,Va=Ce.div`flex gap-4 items-center mb-1`,Tt=Ce.div`animate-pulse rounded-[4px] bg-token-main-surface-tertiary`;function $a({clientThreadId:t,conversationTurnMountTime:s,turn:a,originalTurn:o}){const n=Ho();if(!n.showParagenMetadata||!n.showDebugConversationTurns&&!n.forceParagen||a==null)return null;let r=a===o?"ORIGINAL":"NEW";const l=a.messages[a.messages.length-1],c=l?.message?.metadata?.__internal;if(c){const{model_id:d,model_definition_slug:h,model_definition_virtual_model_id:v,alternative_model_selection_rule:g,augmented_paragen_prompt_group_id:b,augmented_paragen_prompt_id:C,augmented_paragen_prompt:S}=c;d&&(r+=`
Model ID: ${d}`),h&&(r+=`
Model Slug: ${h}`),v&&(r+=`
Virtual Model ID: ${v}`),g&&(r+=`
Alternative Model Rule: ${g}`),b&&(r+=`
Prompt Group ID: ${b}`),C&&(r+=`
Prompt ID: ${C}`),S&&(r+=`
Prompt: ${S}`)}r+=`
Message ID: ${l.message.id}`;const p=Q.getTree(Oe(t)).getParentPromptNode(a.variantIds[0]),m=p.metadata?.variantsInStreamInfo==null&&p.message.metadata?.paragen_variants_info!=null;return r+=`
User prompt message ID: ${p.message.id}`,r+=`
Is Persisted Paragen? ${m}`,r+=`
Completion Sample Finish Time: ${m?`${s} (persisted)`:cs(a.messages)?.completionSampleFinishTime}`,e.jsx("div",{className:"whitespace-pre-wrap text-sm text-red-500",children:r})}async function Ya({params:t}){await hs.submitParagenSelectionV2(t)}const Ka=pt({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}"}});function Ig({handleShowRetrievalResults:t,clientThreadId:s,turnIndex:a,responseComplete:o=!1}){const[n,r]=ae(s,m=>[Q.getTurnContentReferences(m,a),io(m?.conversationTurns[a]?.messages??[])]),l=i.useMemo(()=>({turnIndex:a,clientThreadId:s,responseComplete:o}),[s,o,a]),c=i.useRef(!1);i.useEffect(()=>{c.current||(c.current=!0,W.logEvent(U.fileSourcesFooterShown,l))},[l]);const u=i.useCallback(()=>{W.logEvent(U.fileSourcesFooterClicked,l),t()},[t,l]),p=i.useMemo(()=>{const m=new Set,d=[];function h(g){!g||m.has(g)||(m.add(g),d.push(g))}if(n.forEach(g=>{g.type==="file"?h(g.cloud_doc_url??g.extra?.cloud_doc_url):g.type==="file_navlist"&&g.items.forEach(b=>{h(b.cloud_doc_url)})}),o){for(const g of r)if($u(g.message)){const b=Yu(g.message.content.result),C=g.message.metadata?.cloud_doc_urls??[],S=b.chunks;for(let w=0;w<S.length;w++){const T=S[w];if(!T.documentId)continue;if(w<C.length){h(C[w]);continue}const _=T.documentId.endsWith("--google")?T.documentId.split("--")[1]:void 0,M=T.metadata.cloud_doc_url??(_?`https://drive.google.com/file/d/${_}`:void 0);h(M?.toString())}break}}const v=[];for(let g=0;g<d.length;g++){const b=d[g],C=Ku(b);if(C&&v.push(C.Icon),v.length>=3)break}return v},[r,n,o]);return e.jsxs(e.Fragment,{children:[e.jsx(ne.div,{className:"absolute h-[60px]",initial:{opacity:0},animate:{opacity:1},children:e.jsxs("button",{className:B("not-prose group/footnote mb-2 mt-3 flex w-fit items-center gap-1.5 rounded-xl border border-token-border-light bg-token-main-surface-primary py-2 hover:bg-token-main-surface-secondary","pl-3 pr-2.5"),onClick:u,children:[e.jsx("div",{className:"flex items-center gap-0.5 text-sm font-medium",children:e.jsx(H,{id:"/48IOP",defaultMessage:"Sources"})}),p.length>0&&e.jsx("div",{className:"flex flex-row-reverse gap-1",children:p.reverse().map((m,d)=>e.jsx(ne.div,{className:B("flex items-center overflow-hidden rounded-full border-token-main-surface-primary bg-token-main-surface-primary","group-hover/footnote:border-token-main-surface-secondary","relative"),initial:{opacity:0},animate:{opacity:1},children:e.jsx(m,{className:"icon-md"})},d))})]})}),e.jsx("div",{className:"h-[60px]"})]})}const Ja=[1,2,3,4,10,20,30],Hg=.5;function Dg({clientThreadId:t,conversationLeafId:s}){const a=Wr(qr.isBusinessWorkspace),o=i.useRef(!1),n=ms(t),r=ae(t,j=>j?.mode),{isUnauthenticated:l}=ot(),c=i.useMemo(()=>{if(!n)return-1;const j=Gr(n);return j()>Hg?-1:Ja[Math.floor(j()*Ja.length)]},[n]),u=Fl(t,s),p=u[u.length-1],m=i.useMemo(()=>Zs.getRequestIdFromConversationTurn(p),[p]),d=_t(m),[h,v]=i.useState(null),[g,b]=i.useState(!1),[C,S]=i.useState(!1),[w,T]=i.useState(!1),_=j=>{const N=cs(u)?.messages[0]?.message.id;v(j),k(N,j)},M=u.filter(j=>j.role===tt.Assistant).length,L=p?.role===tt.Assistant,k=i.useMemo(()=>Or((j,N)=>{n&&j&&hs.submitConversationRating({conversation_id:n,message_id:j,rating:N,shown_at_assistant_turn:c}),W.logEvent(U.conversationRatingSubmitted,{rating:N,showAtAssistantTurn:c,conversationId:n}),b(!0),setTimeout(()=>{S(!0)},1500)},2e3),[n,c]),x=M!==c||d||!L||!!a||r?.kind!==Le.PrimaryAssistant||w||l;return i.useEffect(()=>{!x&&!o.current&&(W.logEvent(U.conversationRatingShown,{showAtAssistantTurn:c,conversationId:n}),o.current=!0)},[x]),w||x?null:e.jsxs("div",{className:"mx-auto",children:[e.jsx(ps,{children:g&&!C&&e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(Qa,{$padded:!0,children:e.jsx("span",{className:"text-sm text-token-text-tertiary",children:e.jsx(H,{id:"rating.thanks",defaultMessage:"Thanks for your feedback!"})})})},"submitted")}),!g&&e.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},children:e.jsxs(Qa,{$padded:!1,children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 px-4 py-3 text-sm text-token-text-secondary",children:[e.jsx(H,{id:"rating.instructions",defaultMessage:"Is this conversation helpful so far?"}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx(Wn,{$selected:h==="thumbsUp",onClick:()=>_("thumbsUp"),children:e.jsx(Vr,{className:"icon-md"})}),e.jsx(Wn,{$selected:h==="thumbsDown",onClick:()=>_("thumbsDown"),children:e.jsx($r,{className:"icon-md"})})]})]}),e.jsx("div",{className:"w-px flex-1 self-stretch bg-token-main-surface-tertiary"}),e.jsx(Wn,{className:"p-3",$selected:!1,onClick:()=>T(!0),children:e.jsx(Ll,{className:"icon-md text-token-text-secondary hover:text-token-text-primary"})})]})},"rating")]})}const Wn=Ce.button`
  ${t=>t.$selected?"text-token-text-primary":"text-token-text-secondary"}
  hover:text-token-text-primary
`,Qa=Ce.div`inline-flex rounded-xl border border-gray-100 dark:border-gray-700
${t=>t.$padded&&"py-3 px-4"}
`,Bg=Ve(()=>$e(()=>import("./n8jmpr6zz1wdkuah.js"),__vite__mapDeps([52,2,1,3,23,4,5,10,53])));function Fg({clientThreadId:t,conversationLeafId:s,canShowInlineMessageFeedback:a,messageForRating:o,allGroupedMessages:n,currentModelId:r}){let l=null;const c=hr(h=>{const v=Q.getConversationTurns(Oe(t,h),s);let g=0;for(let b=v.length-1;b>=0;b--){const C=v[b];if(C.messages.some(S=>S.message.metadata?.is_indepth_feedback))return!0;if(C.messages.some(S=>S.message.author.role===tt.Assistant)&&g++,g>=3)break}return!1}),u=ms(t),p=_o(h=>h.voiceFeedbackThread),m=u===p,{voiceName:d}=Ju();return c?null:(m&&u?(Ol.feedbackShown.success({voice:d}),l=e.jsx("div",{className:"text-center",children:e.jsx(Qu,{serverThreadId:u})})):o.rating&&a?l=e.jsx(Bg,{clientThreadId:t,conversationMessage:o,allGroupedMessages:n,currentModelId:r}):l=e.jsx("div",{className:"text-center",children:e.jsx(Dg,{clientThreadId:t,conversationLeafId:s})}),e.jsx("div",{className:"mt-3 w-full empty:hidden",children:l}))}const Lg=Ve(()=>$e(()=>import("./kagkxfhdgfecf5mj.js"),__vite__mapDeps([54,2,1,3,55,56,23,4,5,10,57,58,59])).then(t=>t.VoicePlayButton)),Og=Ve(()=>$e(()=>import("./fzmfci967s5k1wuo.js"),__vite__mapDeps([60,2,4,1,3,5,61,62])).then(t=>t.AutomationSourceHeader)),Xa=80,Ug=16,Za={minHeight:`calc(100dvh - ${Yr}px - ${ym}px - 100px)`};function zg(t){const{turnIndex:s,conversationLeafId:a,isFinalTurn:o,clientThreadId:n,onChangeRating:r,currentModelId:l,avatarClassName:c,showAvatar:u,scrollToMessageId:p,dateHeaderType:m}=t,d=we(),h=Io();ds()?.normalizedAccountUserId;const v=!!h&&Ul(h),g=uo(),b=Wr(qr.isBusinessWorkspace),C=ro(),{value:S}=Ee("2848981774"),{value:w}=Ee("1456513860"),T=u??!w,_=null,M=S&&_==null,{value:L}=Ee("1887864177"),k=Qe(n),x=Ft(Vn(n,s,a)),{messages:j,variantIds:N,variantsInStreamInfo:E}=x,R=an(j),f=Xu(),F=cs(j);let P=F;for(const O of R){const ge=kh(O);if(ge.some(lt=>f.has(lt.message.id))){P=ge[ge.length-1];break}}const I=F!==P,A=j.slice(0,P?j.indexOf(P)+1:0),G=!1,Y=fo(),[D,te]=i.useState(!1),[re,Me]=i.useState(!1),at=N.findIndex(O=>A.some(ge=>ge.nodeId===O)),Z=x.role===tt.User,Te=At(),fe=nt(n),ve=Nt(x.gizmoId??fe)?.data,ke=jo(l),Pe=Zu(l),xe=st(),he=i.useContext(cn),Ie=So(he),[Ue,ze,ue,Ge,z,q]=ae(n,O=>{const ge=O?.tree!=null&&N.some(lt=>{const Ct=O.tree.getLeafFromNode(lt);return O.tree.getHasErrorFromNode(Ct.id)});return[O?.async_status===cr.STREAMING,Q.isMessageTurnEnded(O,a),ge,wm(io(O?.mode),ve?.gizmo.id),O?.continuingFromSharedConversationId!=null,null]});let ie="default";const $=A.some(O=>O.message.content.content_type===zl.MultimodalText),{layer:X}=zt("1547743984"),le=k&&Y&&X.get("show_share_button_inline",!1),Se=null,{isUnauthenticated:Ye}=ot(),[be,Ke]=i.useState(!1),[He,_e]=i.useState(!1),rt=x.messages.map(O=>O.message.id),pe=i.useRef(null),ce=j[j.length-1],gt=ce.rating,Et=(p?.length??0)>2&&p!=="finalAgentTurn"&&o&&M,fs=()=>{A.length===1&&(W.logEvent(U.editPrompt,{id:A[0].message.id,threadId:Qe(n)}),je.logEvent("chatgpt_edit_prompt"),te(!0))},de=i.useCallback(()=>{te(!1)},[]),se=i.useCallback(O=>{em(n,s,C,O)},[n,s,C]),Xe=O=>{r({nodeId:ce.nodeId,messageId:ce.message.id,rating:O}),W.logEvent(O==="thumbsDown"?U.messageFeedbackThumbsDownClicked:U.messageFeedbackThumbsUpClicked,{id:ce.message.id,threadId:Qe(n),model:l,rating:O}),Me(!0)},[Rt]=i.useState(()=>Date.now()),Sn=i.useMemo(()=>Zs.getRequestIdFromConversationTurn(x),[x]),Ae=_t(Sn)&&!ze,xs=vo(),Ne=an(A),ft=i.useRef(!1),xt=tm(n,F);i.useEffect(()=>{if(ft.current||p===void 0||!M||!pe.current){p==="finalAgentTurn"&&o&&ft.current&&$s(n,O=>{O.scrollToMessageId=void 0});return}(rt.includes(p)||p==="finalAgentTurn"&&o)&&(ft.current=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(pe.current)if(p==="finalAgentTurn"&&o)pe.current.scrollIntoView({behavior:"instant",block:"end"}),$s(n,O=>{O.scrollToMessageId=void 0});else{const O=pe.current.offsetHeight;let ge;O>Xa?ge=Xa-O:ge=0,pe.current.style.scrollMarginTop=`${ge+Ug+Yr}px`,pe.current.scrollIntoView({behavior:"smooth"})}})}))},[p,pe.current]);const{showDebugConversationTurns:Ss}=Ho(),vn=sm(n,F),Vt=Mh({clientThreadId:n,conversationMode:Ge}),St=i.useCallback(({requestedModelId:O,systemMessage:ge,extraStreamParams:lt})=>{Vt({id:ce.nodeId,requestedModelId:O,systemMessage:ge,extraStreamParams:lt})},[ce,Vt]),$t=!g&&!z&&!Te&&!Z,De=nm(),Yt=P?.message.author.role===tt.Assistant?P.message:null,vs=P?.message.metadata?.system_hints?.includes(K.Research);om({isCompletionRequestInProgress:Ae,isUserTurn:Z,message:Yt});const{isOpen:it}=am(),Kt=Cr(),Pt=rm(Ge),It=!De&&!Pt&&$t&&o&&E?.num_variants_in_stream===2&&!ce.inlineComparisonRating&&!ue,Jt=im(x),Ze=It,bs=It&&!Jt,yt=!I&&!Z&&!g&&!z&&!Pt&&!Ue&&!Ae&&!it&&_==null,et=yt&&(!b||Pe||v)&&!Pt&&!Ye&&!Te&&!F?.message.metadata?.b1de6e2_s,wt=!g&&!((Ae||Ue)&&o)&&N.length>1&&!D&&!Ze&&_==null;let Qt=!1;if(Z&&A.length===1){const{shouldHideContent:O}=Th(A[0]);O&&(Qt=!0)}const ys=Z&&!Pt&&!g&&!$&&A.length===1&&!Qt&&!D&&!Ye&&_==null&&!vs,bn=i.useCallback(O=>{$s(n,ge=>{const lt=Q.getTree(ge).getLeafFromNode(N[O]);lr.setCurrentLeafId(ge,lt.id)}),W.logEvent(U.changeNode,{intent:"toggle_between"})},[n,N]),yn=lm(x,A,Ss),{toggleThreadSidebar:ws}=Gl(),Be=i.useMemo(()=>x.messages.length?x.messages[x.messages.length-1].nodeId:void 0,[x.messages]),js=i.useCallback(()=>{Be&&ws({type:"retrievalResults",clientThreadId:n,turnIndex:s,messageId:Be})},[Be,ws,n,s]),{value:jt}=Ee("2912660649"),Xt=i.useMemo(()=>jt&&cm(x,ke,!!fe),[jt,ke,fe,x]);if(!yn&&!Ze)return Et?e.jsx("div",{style:Za}):null;const Cs=o&&!Ae&&P?.message.metadata?.followup_prompts?P.message.metadata.followup_prompts.map(O=>({text:O,type:Wt.Reply})):[],wn=L&&Cs.length>0,Zt=A.some(({message:O})=>Wl.getAssetPointers(O).length>0)?null:e.jsx(Ag,{className:"h-[30px] rounded-md px-1 text-token-text-secondary hover:bg-token-main-surface-secondary",clientThreadId:n,message:ce,onModelSelect:St,onDropdownChange:Ke,canRegenerateResponse:vn}),es=!Z&&!Qt&&(!o||!Ae)?e.jsx(jm,{onClick:se}):null,Ts=!Z&&(!o||!Ae)&&(ce.disclaimers??[]).length===0&&ce.nodeId?e.jsx(Lg,{conversationId:n,message:ce,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-xs text-token-text-tertiary hover:text-token-text-primary"}):null,Ht=!Z&&ce&&(!o||!Ae)?e.jsx(Cm,{message:ce,isFinalTurn:o,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-token-text-tertiary hover:text-token-text-primary"}):null,Fe=xt&&e.jsx(Mm,{turn:x}),ks=et&&!Ae?e.jsxs("div",{className:"flex",children:[gt!=="thumbsDown"&&e.jsx(Ln,{onClick:()=>Xe("thumbsUp"),disabled:gt==="thumbsUp",icon:gt==="thumbsUp"?dm:Vr,label:d.formatMessage({id:"ConversationTurn.goodResponseTooltip",defaultMessage:"Good response"}),testId:"good-response-turn-action-button"},`thumbsUp:${ce.nodeId}`),gt!=="thumbsUp"&&e.jsx(Ln,{onClick:()=>Xe("thumbsDown"),disabled:gt==="thumbsDown",icon:gt==="thumbsDown"?um:$r,label:d.formatMessage({id:"ConversationTurn.badResponseTooltip",defaultMessage:"Bad response"}),testId:"bad-response-turn-action-button"},`thumbsDown:${ce.nodeId}`)]}):null,Cn=le&&e.jsx(Ln,{onClick:()=>{nn.openSharingModal(k)},label:d.formatMessage({id:"ConversationTurn.shareButtonTooltip",defaultMessage:"Share conversation"}),className:"sm:hidden",icon:mm});function Mn(O){return xe?O:e.jsx(Do,{clientThreadId:n,isStaticSharedThread:g,verticalPadding:ie,horizontalPadding:Ze?"none":Ie||T?"standard":"expanded",children:O})}const _s=!Ze;function Tn(O){return xe?O:e.jsx(on,{children:O})}return e.jsxs(e.Fragment,{children:[e.jsx(hm,{dateHeaderType:m,turn:x}),e.jsxs("article",{className:B("w-full text-token-text-primary focus-visible:outline-2 focus-visible:outline-offset-[-4px]",p==="finalAgentTurn"&&M?"opacity-0":""),style:Et?Za:void 0,ref:pe,dir:"auto","data-testid":`conversation-turn-${s}`,"data-scroll-anchor":o,onMouseEnter:()=>_e(!0),onMouseLeave:()=>_e(!1),children:[e.jsx(pm,{role:x.role}),Mn(e.jsx(e.Fragment,{children:Ze?e.jsx(Rg,{isFeedbackEnabled:et,variantIds:N,variantsInStreamInfo:E,conversationTurnMountTime:Rt,stubSideBySideFeedback:bs,...t}):Tn(e.jsxs(e.Fragment,{children:[G,!Z&&!G&&T&&e.jsx(Wg,{children:e.jsx(Xn,{messages:A,isUserTurn:Z,avatarClassName:c,gizmo:ve})}),e.jsx("div",{className:B("group/conversation-turn relative flex w-full min-w-0 flex-col",!Z&&gm,_s&&"@xs/thread:px-0 @sm/thread:px-1.5 @md/thread:px-4"),children:e.jsx("div",{className:"flex-col gap-1 md:gap-3",children:e.jsxs(e.Fragment,{children:[null,!Z&&!g&&e.jsx(fm,{messages:A,clientThreadId:n,gizmoId:ve?.gizmo.id}),Kt&&!Z&&e.jsx(Og,{clientThreadId:n,messages:A}),e.jsx(eo,{allMessages:j,groupedMessagesToRender:Ne,allGroupedMessages:R,...t,isEditing:D,isUserTurn:Z,isCompletionRequestInProgress:Ae,isFeedbackEnabled:et,isFinalTurn:o,hasActiveRequest:xs,showEditButton:ys,handleEnterEdit:fs,handleExitEdit:de}),ke&&!jt&&e.jsx("div",{className:"mb-4",children:e.jsx(xm,{messages:A})}),Xt&&e.jsx(Ig,{handleShowRetrievalResults:js,clientThreadId:n,turnIndex:s,responseComplete:!(Ae||Ue)}),(yt||wt)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:B("mb-2 flex gap-3 empty:hidden",Z?"mr-1 flex-row-reverse":"-ml-2"),children:e.jsx(Sm,{alwaysShow:o,showInline:o||wt,isHovered:He||be,pagination:wt&&e.jsx(vm,{showInline:o||wt,currentPage:at,onChangeIndex:bn,length:N.length,className:B("self-center",N.length>1?"visible":"!invisible")}),actions:yt&&e.jsxs(e.Fragment,{children:[Ts,es,ks,Fe,Ht,Cn,Se,Zt]})})}),yt&&!Ae?e.jsx("div",{className:"pr-2 lg:pr-0",children:e.jsx(bm,{message:ce,isFinalTurn:o})}):null,o&&!Ae&&e.jsxs(e.Fragment,{children:[e.jsx(Fg,{canShowInlineMessageFeedback:re,clientThreadId:n,conversationLeafId:a,messageForRating:ce,allGroupedMessages:R,currentModelId:l}),wn&&e.jsx(Ng,{followups:Cs})]})]})]})})})]}))}))]})]})}const Gg=yo.memo(zg),Wg=Ce.div`flex-shrink-0 flex flex-col relative items-end`;function qg({onChangeRating:t,onRequestCompletion:s,clientThreadId:a,conversationLeafId:o,hideHeader:n}){const[r,l,c,u,p]=ae(a,I=>[I?.mode,Q.getConversationTurns(I,o).length,Q.getThreadData(I).isArchived,I?.conversationOrigin===ql.APPLE,I?.scrollToMessageId]),m=Re(),d=xo(),h=Tm(),[v]=km(),g=_m(),[b]=Am(),C=ds(),S=mn(a),w=m.store.useContentAreaDimensions(Gt.Header,I=>I?.height?I.height:void 0),T=m.store.useIsHeaderContentAreaPopulated(),_=Nm(S.id),M=r?.kind===Le.GizmoMagicCreate?"bg-token-main-surface-primary text-token-text-primary":_,L=Em(),[k,x]=i.useState(0),[j,N]=i.useState(!1);i.useEffect(()=>{d&&(k===0?x(l):!j&&l>k&&(N(!0),je.logEvent("chatgpt_continue_conversation_first_message_sent"),W.logEvent(U.continueConversationFirstMessageSent)))},[l,k,j,d]),i.useEffect(()=>{d&&(je.logEvent("chatgpt_continue_conversation_page_loaded"),W.logEvent(U.continueConversationPageLoaded),je.logEvent("chatgpt_conversation_share_page_loaded"),W.logEvent(U.sharedConversationPageLoaded))},[d]);const E=i.useCallback(()=>{h({behavior:"smooth"})},[h]),R=Rm(a),f=L&&!c,F=Pm(a,o),P=(I,A,G,Y)=>[...new Array(A-I).keys()].map(D=>{const te=D+I;return e.jsx(Gg,{isFinalTurn:G(te),turnIndex:te,clientThreadId:a,conversationLeafId:o,onChangeRating:t,onRequestCompletion:s,currentModelId:S.id,avatarClassName:M,scrollToBottom:E,scrollToMessageId:Y,dateHeaderType:F(te),showAvatar:void 0},te)});return e.jsxs("div",{onCopy:R,className:B("flex flex-col text-sm",f&&"pb-[120px]",w||f?null:"md:pb-9"),style:{paddingBottom:f?void 0:w},children:[!n&&C?.data&&e.jsx(ni,{clientThreadId:a}),d&&e.jsxs(e.Fragment,{children:[e.jsx(on,{children:e.jsx("p",{className:"text-xs text-gray-500",children:e.jsx(H,{id:"threadLayout.sharedConversationCopyDisclaimer",defaultMessage:"This is a copy of a conversation between ChatGPT & Anonymous."})})}),l-k===0&&e.jsx("div",{className:"text-center text-xs font-semibold text-token-text-primary",children:e.jsx("button",{onClick:()=>{nn.openModal(Im.ReportConversation),je.logEvent("chatgpt_conversation_share_report_content_clicked",null,{location:"Static Shared Thread Page"}),W.logEvent(U.sharedConversationReportContentClicked,{location:"Dynamic Shared Thread Page"})},children:e.jsx(H,{id:"thread.reportSharedConversation",defaultMessage:"Report content"})})}),P(0,k,I=>I===k-1,p),e.jsx(on,{children:e.jsxs("p",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(Hm,{className:"icon-xs mr-2"}),e.jsx(H,{id:"threadLayout.sharedConversationPrivateDisclaimer",defaultMessage:"Messages beyond this point are only visible to you"})]})}),P(k,l,I=>I===l-1,p)]}),!d&&P(0,l,I=>I===l-1,p),u&&v&&!b&&e.jsx(er,{className:B("translate-y-[10px] md:translate-y-[30px]"),onClick:()=>{je.logEvent("chatgpt_thread_scroll_to_top"),g({behavior:"smooth"})},children:e.jsx(Dm,{className:"icon-md text-token-text-primary"})}),!v&&e.jsx(er,{className:B(w?null:"bottom-5",f?T?"translate-y-[-50px]":"translate-y-[-10px]":""),style:{bottom:L?"calc(var(--composer-bar_footer-current-height) + var(--composer-bar_current-height))":w},onClick:()=>{je.logEvent("chatgpt_thread_scroll_to_bottom"),h({behavior:"smooth"})},children:e.jsx(Bm,{className:"icon-md text-token-text-primary"})})]})}const er=Ce.button`cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-token-text-secondary border-token-border-light right-1/2 translate-x-1/2 bg-token-main-surface-primary w-8 h-8 flex items-center justify-center`,Vg=60,$g=({children:t,scrollViewClassName:s,scrollAnchorTopOffset:a=0})=>{const o=i.useRef(null);return e.jsx("div",{className:"h-full",ref:o,children:e.jsx(mo,{children:e.jsx(Ch,{className:"h-full",followButtonClassName:"hidden",initialScrollBehavior:"auto",scrollViewClassName:s,scroller:()=>Yg(o,a)?0:1/0,children:t})})})},Yg=(t,s)=>{const a=Kg(t.current);if(a==null)return!1;const o=a>s,n=a<s-Vg;return!o&&!n};function Kg(t){if(!t)return null;const s=t.querySelector('[data-scroll-anchor="true"]');if(!s)return null;const a=s.getBoundingClientRect().top,o=t.getBoundingClientRect().top;return a-o}const Jg=Ve(()=>$e(()=>import("./ced3w4iko87xbhmy.js"),__vite__mapDeps([63,1,2,3,4,5,14,64,65,66,67,57,68])).then(t=>t.OpenDebugSidebarButton)),Qg=Ve(()=>$e(()=>import("./mpssb3y10pcwu0wn.js"),__vite__mapDeps([69,2,4,1,3,5]))),tr=pt({doNotShareSensitive:{id:"thread.modal.onboarding.title",defaultMessage:"Do not share sensitive materials with this application"},somethingWentWrong:{id:"thread.modal.unrecoverableError.title",defaultMessage:"Something went wrong"},tryAgainLater:{id:"thread.modal.unrecoverableError.description",defaultMessage:"We're sorry, but something went wrong. Please try again later."},resetThread:{id:"thread.modal.unrecoverableError.resetThread",defaultMessage:"Reset thread"},sharedConversationReportConversation:{id:"thread.sharedConversation.report",defaultMessage:"Report conversation"},latencyButton:{id:"thread.latencyButton",defaultMessage:"Latency"},archivedConversationDescription:{id:"thread.archivedConversationDescription",defaultMessage:"This conversation is archived. To continue, please unarchive it first."},unarchiveButton:{id:"thread.unarchiveButton",defaultMessage:"Unarchive"}});function Xg({clientThreadId:t}){const s=pr(),a=ms(t),o=ae(t,Q.getGizmoId),n=async()=>{a&&(await hs.patchConversation(a,{is_archived:!1}),s.invalidateQueries({queryKey:["conversation",t]}),hr.setState(r=>{const l=r.threads[a];l!=null&&(l.initialThreadData.isArchived=!1)}),Zm(s,o))};return e.jsxs("div",{className:"my-6 flex flex-col items-center justify-center gap-4",children:[e.jsx("div",{className:"px-3 text-center text-sm text-token-text-secondary",children:e.jsx(H,{...tr.archivedConversationDescription})}),e.jsx("div",{children:e.jsx(qt,{disabled:!a,onClick:n,icon:Jm,children:e.jsx(H,{...tr.unarchiveButton})})})]})}const Zg=function({clientThreadId:t,preRequestCompletion:s,hideHeader:a,hideMessages:o,hideFooter:n,hideToolsOverlay:r,messagesVerticalAlign:l="top",prependThreadChildren:c,renderEmptyState:u,prefetchSearch:p}){const m=ir(),{data:d}=ht(),h=un(t),v=ur(),[g,b,C,S,w,T,_]=ae(t,ue=>[ue?.isLoading,Q.getCurrentLeafId(ue),Q.hasUserMessage(ue),ue?.conversationTurns.length??0,Q.getThreadData(ue).isArchived,ue?.modelId,ue?Q.getGizmoId(ue):v]);Vl(t),i.useEffect(()=>{g||(Lt(t)?Qs.addTiming("chatgpt.web.chatPage.renderNewConversation"):Qs.addTiming("chatgpt.web.chatPage.renderExistingConversation"))},[t,g]);const{setTargetedContent:M}=Br(),L=m?.includes($l),{value:k}=Ee("2848981774"),x=Fm(),N=k&&null==null,E=S>=2;Dr(E);const R=Lt(t)&&!E&&Ys(h),f=Lt(t)&&!C&&(Ys(h)||h?.kind===Le.GizmoTest),P=wo(d).id,I=T??P,A=!!T,G=jo(I),Y=is(d?.models,I),D=Lm(t,h),te=Hr();Om(S,t),i.useEffect(()=>{te||M(void 0)},[t,M,te,b]);const re=ec({clientThreadId:t,preRequestCompletion:s}),{caModal:Me,onChangeRating:at}=Um({clientThreadId:t,currentModelId:I}),Z=Ah({clientThreadId:t,handleRequestCompletion:re,prefetchSearchPromise:p}),Te=ue=>N?e.jsx(mo,{children:e.jsxs(i.Suspense,{fallback:null,children:[e.jsx(Qm,{}),e.jsx("div",{className:"flex h-full flex-col overflow-y-auto",children:ue})]})}):e.jsx($g,{scrollAnchorTopOffset:a?0:Xm,children:l==="bottom"?e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"flex-1"}),ue]}):ue});i.useEffect(()=>{document.title=D??"ChatGPT"},[D]);const fe=At(),ve=i.useContext(cn),ke=So(ve),Pe=ke,xe=f&&!u&&!_&&!G&&!fe,he=xo(),Ie=i.useRef(null),Ue=i.useRef(null),ze=i.useMemo(()=>({threadContentScrollContainerElementRef:Ie,footerRootContainerElementRef:Ue}),[]);return e.jsxs(lh,{clientThreadId:t,children:[L&&e.jsx(Qg,{}),e.jsx(zm,{children:D!=null&&e.jsx("title",{children:D})}),e.jsx(Yl.Provider,{value:re,children:e.jsxs(Gm,{children:[e.jsxs(Wm,{noKeyboard:!0,clientThreadId:t,currentModelConfig:Y,className:B("composer-parent flex flex-col focus-visible:outline-0",xe?"h-[calc(100%-2rem)]":"h-full"),children:[!o&&e.jsx(qm,{value:ze,children:e.jsx(ef,{ref:Ie,className:ke?"pb-[0.75rem]":"pb-[1.5rem]",children:!g&&!Z?f?u??e.jsx(Cg,{clientThreadId:t,currentModelId:I,isModelLoaded:A,onRequestCompletion:re,showChatgptHomepage:xe,chatgptHomepageDisclaimer:Pe?null:xe&&e.jsx(Ma,{clientThreadId:t})}):E?Te(e.jsxs(e.Fragment,{children:[c,e.jsx(qg,{onChangeRating:at,onRequestCompletion:re,clientThreadId:t,conversationLeafId:b,hideHeader:a},t)]})):null:null})}),e.jsx(tf,{ref:Ue,children:w?e.jsx(Xg,{clientThreadId:t}):e.jsxs("div",{children:[!xe&&e.jsx(ag,{clientThreadId:t,isNewThread:R,showPromptStarters:R||!C,currentModelId:I,onRequestCompletion:re}),!n&&!Pe&&e.jsx("div",{className:"relative w-full px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden md:px-[60px]",children:Ys(h)&&!xe&&e.jsx("div",{className:"min-h-4",children:e.jsx(Ma,{clientThreadId:t})})})]})})]}),!r&&!ke&&e.jsxs("div",{className:"group absolute bottom-2 end-2 z-20 flex flex-col gap-1 md:flex lg:bottom-3 lg:end-3",children:[x?e.jsxs(e.Fragment,{children:[e.jsx(Jg,{}),!1]}):null,e.jsx(Vm,{})]}),Me,e.jsx($m,{clientThreadId:t,isStaticSharedThread:!1,isDynamicSharedThread:he}),e.jsx(Ym,{}),e.jsx(Km,{conversationId:t,isActiveWindow:!0})]})})]})},gf=yo.memo(Zg),ef=Ce.div`grow flex-1 overflow-hidden @container/thread translate-y-[2rem] -mt-[2rem]`,tf=Ce.div`md:pt-0 dark:border-white/20 md:border-transparent md:dark:border-transparent w-full isolate has-[[data-has-thread-error]]:[box-shadow:var(--sharp-edge-bottom-shadow)] has-[[data-has-thread-error]]:pt-2`;export{Gg as C,Cg as E,gf as M,gi as P,ug as S,Gh as T,$g as W,ni as a,Ah as b,ag as c,qh as d,pf as e,si as u};
//# sourceMappingURL=nf2duydhbwllwb1z.js.map
