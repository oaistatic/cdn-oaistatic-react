import{j as n,r as u,aE as D,aw as C,au as P}from"./cg166fqqcxkeiosv.js";import{cr as w,cs as I,bT as E,ct as R,E as A,F as O,cu as W,cv as q}from"./j4xe1fdohr6xk09p.js";import{bh as G,df as Q,c3 as S,P as f,a as p,c as U,b9 as N,cv as B,bW as X,q as $,bN as H,r as J}from"./dze2l9y9kn6nwat0.js";import{S as K}from"./l1c6eu3d34hr9ksj.js";import{u as V,a as Y,g as Z,b as T}from"./i7nvm66tepgqj19n.js";function ee(e,t){const r=J.getTurnContentReferences(e,t);return q(r)}function te(e,t){const r=$(e),s=ee(r,t),o=ne(r,t);return W(s.concat(o),"content_url")}function ne(e,t){const r=e?.conversationTurns[t]?.messages;return r?H(r.flatMap(s=>s.message?.metadata?.image_results??[])).map(s=>({...s,thumbnail_url:s.thumbnail_url.replace(/^http:\/\//,"https://"),content_url:s.content_url.replace(/^http:\/\//,"https://")})):[]}function de({clientThreadId:e}){const t=w.useCurrentImage();if(!t)return null;const{image:r,source:s,analyticsMetadata:o}=t;if(s==null||e==null||o?.turnIndex==null)return n.jsx(h,{image:r,analyticsMetadata:{}});const l=te(e,o.turnIndex);return n.jsx(h,{image:r,group:l,analyticsMetadata:o,groupSource:s})}function xe(){const e=w.useCurrentImage();if(!e)return null;const{image:t,source:r}=e;if(r==null)return n.jsx(h,{image:t,analyticsMetadata:{}});switch(r){case I.ImagesTab:return n.jsx(se,{image:t});case I.Turn:return n.jsx(re,{image:t})}}function se({image:e}){const{imageResults:t}=V();return n.jsx(h,{image:e,group:t,groupSource:I.ImagesTab,analyticsMetadata:{}})}function re({image:e}){const{imageResults:t}=Y();return n.jsx(h,{image:e,group:t,groupSource:I.Turn,analyticsMetadata:{}})}const L=G.div`grow flex items-start p-8`,ae={enter:e=>({x:e>0?1e3:-1e3,opacity:0}),center:{zIndex:1,x:0,opacity:1},exit:e=>({zIndex:0,x:e<0?1e3:-1e3,opacity:0})},M=1e4,oe=(e,t)=>Math.abs(e)*t;function h({image:e,group:t,groupSource:r,analyticsMetadata:s}){const o=u.useRef(null),l=e.attribution??E(e.url),b=w.useCurrentImage(),i=w.useStore(),j=b?.mountDirection;u.useEffect(()=>{window?.history?.state?.imageModalOpen||window.history.pushState({imageModalOpen:!0},"",window.location.href);const a=()=>{window?.history?.state?.imageModalOpen||i.setCurrentImage(void 0)};return window.addEventListener("popstate",a),()=>window.removeEventListener("popstate",a)},[i]);const y=e.content_url.replace(/^http:\/\//,"https://"),c=t?.findIndex(a=>Q(e,a))??0,m=t?.length??1,g=c!=null&&m>1,v={...S(s),url:e.url,link_type:"text",section:"image",section_location:"response",section_index:(c+1).toString()};u.useEffect(()=>{o.current!==e.url&&(o.current=e.url,f.logEventWithStatsig(p.searchContentReferenceShown,"search_content_reference_shown",{...S(s),type:"full_screen_image",url:e.url,image_url:y}),f.logEventWithStatsig(p.linkAction,"link_action",{...v,action:"show"}))},[y]);const k=()=>{window.history.go(-1),i.setCurrentImage(void 0)},d=u.useCallback(()=>{!g||t==null||i.setCurrentImage({image:t[(c+1)%t.length],source:r,mountDirection:R.FromRight,analyticsMetadata:s})},[g,t,i,c,r,s]);D({queries:(t??[]).map(a=>Z(a.thumbnail_url))});const x=u.useCallback(()=>{!g||t==null||i.setCurrentImage({image:t[(c-1+t.length)%t.length],source:r,mountDirection:R.FromLeft,analyticsMetadata:s})},[g,t,i,c,r,s]);return u.useEffect(()=>U(document,{keydown:a=>{a.key==="ArrowRight"?d():a.key==="ArrowLeft"&&x()}}),[d,x]),n.jsx(C,{children:e&&n.jsx(N.Root,{isOpen:!0,onClose:k,children:n.jsx(N.Overlay,{children:n.jsxs(B,{className:"flex h-full w-full flex-col bg-black/95",children:[n.jsxs("div",{className:"relative flex w-full grow justify-center overflow-hidden",children:[n.jsxs("div",{className:"absolute right-4 top-4 flex items-center sm:right-6 sm:top-6",children:[g&&n.jsxs("div",{className:"shrink-0 px-4 py-2 text-token-text-tertiary",children:[c+1," / ",m]}),n.jsx("button",{onClick:a=>{a.stopPropagation(),k()},className:"flex h-9 w-9 items-center justify-center outline-none hover:opacity-70",children:n.jsx(X,{className:"h-6 w-6 text-gray-400"})})]}),m>1&&n.jsx(L,{className:"cursor-w-resize",onClick:a=>{a.stopPropagation(),x()}}),n.jsx(C,{initial:!1,custom:j,children:n.jsx(P.div,{variants:ae,custom:j??0,className:"absolute bottom-4 top-24",initial:"enter",animate:"center",exit:"exit",transition:{x:{type:"spring",stiffness:300,damping:30},opacity:{duration:.2}},drag:m>1?"x":!1,dragConstraints:{left:0,right:0},dragElastic:1,onDragEnd:(a,{offset:F,velocity:z})=>{const _=oe(F.x,z.x);_<-M?d():_>M&&x()},children:n.jsx(ie,{image:e,analyticsMetadata:s})},c)}),m>1&&n.jsx(L,{className:"cursor-e-resize",onClick:a=>{a.stopPropagation(),d()}})]}),n.jsx(A,{onClick:()=>{f.logEventWithStatsig(p.linkAction,"link_action",{...v,action:"click"})},onMouseEnter:()=>{f.logEventWithStatsig(p.linkAction,"link_action",{...v,action:"hover"})},href:e.url===""?e.content_url:e.url,className:"flex min-h-20 w-full shrink-0 items-center gap-8 px-6 pb-3 pt-8 text-sm hover:opacity-70 sm:px-8 sm:pb-8",children:n.jsxs("div",{className:"flex grow flex-col gap-0.5 overflow-hidden pr-2",children:[n.jsxs("div",{className:"flex items-center gap-2 truncate text-token-text-tertiary",children:[n.jsx(O,{url:e.content_url,className:"rounded",size:16}),l??E(e.url)]}),n.jsx("div",{className:"truncate font-semibold text-white",children:e.title})]})})]})})})})}function ie({image:e}){const t=e.base64_image,r=e.content_url.replace(/^http:\/\//,"https://"),s=e.thumbnail_url.replace(/^http:\/\//,"https://"),o=e.content_size.width/e.content_size.height,{isError:l}=T(r),{isError:b}=T(s),i=t??(l?s:r);return!b||!l||t?n.jsx(P.img,{src:i,alt:e.title,style:{backgroundImage:s?`url(${s})`:void 0,backgroundSize:"contain",aspectRatio:o,backgroundPosition:"center",backgroundRepeat:"no-repeat"},initial:{opacity:0},animate:{opacity:1},className:"h-full max-w-[100vw] object-contain sm:max-w-[calc(100vw-10rem)]"}):n.jsx("div",{className:"flex h-full grow items-center justify-center",children:n.jsx("div",{className:"flex h-96 w-96 items-center justify-center bg-white/10",children:n.jsx(K,{className:"h-12 w-12 text-token-text-tertiary"})})})}export{de as ImageLightbox,xe as ImageLightboxSearchGPT,h as ImageResultModal};
//# sourceMappingURL=gzbwd5slzko4wy04.js.map
