import{d as v,q as C,r as x,m as F,am as L,aL as w,s as z,aC as B,S as q,N as K,O as E,ab as G,w as V,M as H}from"./dze2l9y9kn6nwat0.js";import{dK as N,dL as P,dM as Q,dN as S,dO as W,dP as X,dQ as $,dR as J,dS as Y,dT as Z,ch as ee,ck as A,dU as ne}from"./j4xe1fdohr6xk09p.js";import{b as te,e as O}from"./h83rc28v2vsm5nda.js";import{r as p,j as m,aw as k,au as D}from"./cg166fqqcxkeiosv.js";const se=2e3,j=.4,re=.45,ie=.2,oe=.1,ae=.25;var T=(e=>(e[e.Running=0]="Running",e[e.Finished=1]="Finished",e[e.Error=2]="Error",e[e.Stopped=3]="Stopped",e[e.Paused=4]="Paused",e))(T||{});function he({conversationMessages:e,icon:r,status:n,text:i,estimatedToolDurationMs:a,animationLoopDurationMs:l=se,shouldPersistAfterFinished:c=!1}){const[o,t]=p.useState(n===0?0:n===1&&!c?7:1),[u,g]=p.useState(0);p.useEffect(()=>{n===2?t(8):n===3?t(9):n===4?t(10):n===1?t(o===2?3:7):n===0&&o===10&&(t(2),g(s=>s+1))},[n]);const d=de(o);return p.useEffect(()=>{const s=e[0].message.id;if(d)return N.addDelayedRenderingMessage(s),()=>{N.removeDelayedRenderingMessage(s)}},[d]),P(()=>{y(o)&&g(s=>s+1)},l),o===7&&!c?null:m.jsxs("div",{className:"my-2.5 flex items-center gap-2.5",children:[m.jsx(ce,{icon:r,status:n,uiState:o,estimatedToolDurationMs:a,animationLoopCounter:u,shouldPersistAfterFinished:c,onFillProgressBarAnimationComplete:()=>t(4),onFinishAnimationComplete:()=>{t(5),setTimeout(()=>{t(c?7:6)},oe*1e3)},onHideAnimationComplete:()=>t(7)}),m.jsx(le,{text:i,uiState:o,animationLoopCounter:u,onEnterAnimationComplete:()=>t(2)})]})}const b=50;function ce({icon:e,status:r,uiState:n,estimatedToolDurationMs:i,animationLoopCounter:a,shouldPersistAfterFinished:l,onFillProgressBarAnimationComplete:c,onFinishAnimationComplete:o,onHideAnimationComplete:t}){const[u,g]=p.useState(0);P(()=>{y(n)?g(U=>U+b):n===10&&g(0)},b);let d,s,f;y(n)||n===10?(d="running",s=m.jsx(e,{animationLoopCounter:a}),f="bg-transparent"):n===4||n===5||n===7&&l?(d="finished",s=m.jsx(S,{}),f="bg-brand-purple"):r===2?(d="error",s=m.jsx(W,{}),f="bg-orange-500"):r===3&&(d="stopped",s=m.jsx(X,{}),f="bg-gray-300");let M={opacity:0,scale:0,rotate:-180,x:0},_={type:"spring",bounce:.3,duration:re},I={opacity:0,scale:.6,rotate:0,x:0};n===0?(M={opacity:0,scale:.5,rotate:-180,x:-8},_={type:"spring",bounce:.3,duration:j}):n===1?M=!1:n===5&&(I={opacity:0,scale:0,rotate:0,x:0},_={type:"spring",bounce:.3,duration:ae});const R=$(u,i);return m.jsx("div",{className:"relative h-5 w-5 shrink-0",children:m.jsx(k,{onExitComplete:()=>{n===6&&t()},children:d!=null&&m.jsxs(D.div,{className:v("absolute left-0 top-0 flex h-full w-full items-center justify-center rounded-full text-white",f),initial:M,animate:{opacity:1,scale:1,rotate:0,x:0},exit:I,transition:_,onAnimationComplete:()=>{n===4&&o()},children:[s,(y(n)||n===10)&&m.jsx(Q,{percentage:n===3?100:R,thickness:1.5/23,className:"absolute left-1/2 top-1/2 h-[23px] w-[23px] -translate-x-1/2 -translate-y-1/2 text-brand-purple",backgroundStrokeClassName:"stroke-brand-purple/25 dark:stroke-brand-purple/50",transitionDuration:n===3?`${(100-R)/100*ie}s`:void 0,transitionTimingFunction:n===3?"cubic-bezier(0.55, 0, 1, 1)":void 0,onTransitionEnd:()=>{n===3&&c()}})]},d)})})}function le({text:e,uiState:r,animationLoopCounter:n,onEnterAnimationComplete:i}){const[a,l]=p.useState(e);p.useEffect(()=>{r===2&&l(e)},[n]),p.useEffect(()=>{y(r)||l(e)},[r,e]);let c={opacity:0,x:0,y:15},o={type:"spring",bounce:.3,opacity:{duration:.15},y:{duration:.3}};r===0?(c={opacity:0,x:-8,y:0},o={type:"spring",bounce:.3,duration:j,delay:.15}):r===1&&(c=!1);const t=a??void 0;return m.jsx("div",{className:v("relative h-5 w-full leading-5",r===8||r===9?"text-token-text-tertiary":"text-token-text-secondary"),children:m.jsx(k,{children:t!=null&&m.jsx(D.div,{className:"absolute left-0 top-0 line-clamp-1 overflow-visible",initial:c,animate:{opacity:1,x:0,y:0},exit:{opacity:0,x:0,y:-15},transition:o,onAnimationComplete:()=>{r===0&&i()},children:t},t.toString())})})}function y(e){return e===0||e===2||e===3}function de(e){return y(e)||e===4||e===5||e===6||e===10}const h={},me=(e,r)=>{const n=C(e);let i=x.getMessage(n,r);for(;i&&i.author.role!==F.User;){const a=i.metadata?.parent_id;if(!a)return null;i=x.getMessage(n,a)}return i||null};function pe({userMessageId:e,configuredLatencyMs:r,toolStatus:n}){const i=e&&h[e];if(i)switch(i.state){case"complete":return{percentStart:1,remainingMs:0};case"streaming":return{percentStart:(performance.now()-i.startTimeMs)/r,remainingMs:i.endTimeMs-performance.now()};default:return{percentStart:0,remainingMs:r}}return n===T.Finished?{percentStart:1,remainingMs:0}:{percentStart:0,remainingMs:r}}const xe=({toolStatus:e,userMessage:r})=>{const{config:n}=L("2892024882"),[i,a]=p.useState(!1),[l,c]=p.useState(!1),o=(n?.value.latency??0)*1e3,t=r?.id,{percentStart:u,remainingMs:g}=p.useMemo(()=>pe({userMessageId:t,configuredLatencyMs:o,toolStatus:e}),[o,t,e]);return p.useEffect(()=>{if(t&&o>0){a(!0);const d=h[t];d?e===T.Finished&&d.state==="tool-running"&&(c(!0),h[t]={startTimeMs:performance.now(),endTimeMs:performance.now()+o,lastKnownToolStatus:e,state:"streaming"},te(t)&&setTimeout(()=>{O(t),h[t].state="complete",c(!1)},g)):h[t]={startTimeMs:0,endTimeMs:0,lastKnownToolStatus:e,state:e===T.Running?"tool-running":"complete"}}},[o,g,e,t]),{isDelayedImage:i,isStreaming:l,percentStart:u,remainingMs:g}};function Te(e,r,n,i){let a=Y.getReadyFiles(e.getState());i?.kind===G.GizmoMagicCreate?a=a.filter(s=>s.gizmoId!=null):a=a.filter(s=>s.gizmoId==null);let l=r??"";const c=[],o=[],t=Z(n,i),g=ee(n,i).length>0,d=t===A.Interpreter||t===A.Retrieval||t===A.ContextConnector;return a.forEach(({fileSpec:s})=>{if(d){const f=s.contextConnectorInfo;c.push({id:s.id,size:s.size,name:s.name,context_connector_info:f?{context_connector:f?.contextConnector,source_url:f?.sourceUrl,synthetic_extension:f?.syntheticExtension??null,type:f?.type}:void 0,mime_type:s.mimeType,width:"width"in s?s.width:void 0,height:"height"in s?s.height:void 0,file_token_size:s.fileTokenSize})}g&&"width"in s&&"height"in s&&o.push({content_type:V.ImageAssetPointer,asset_pointer:ne(s.id),size_bytes:s.size,width:s.width,height:s.height})}),o.length>0&&(o.push(r??""),l={content_type:H.MultimodalText,parts:o}),{content:l,attachments:c}}async function Me({clientThreadId:e,currentRequestId:r,queryClient:n,isHistoryAndTrainingDisabled:i}){const a=z(e),l=me(e);if(l&&O(l.id))return;const c=x.getTree(C(e));!c.hasReceivedServerCompletion&&!i&&c.getParent(r).metadata?.errCode!==B.ContentPolicy&&setTimeout(()=>{J.onCreateFinished(n,a,i)},500),a&&q.checkGate("3922476776")&&await K.stopConversationProcess(a),w.abortRequest(r)&&E.updateTree(e,t=>{const u=E.getThreadCurrentLeafId(e);t.updateNodeMessageMetadata(u,{finish_details:{type:"interrupted"}})})}function _e(e){const r=x.getBranch(C(e)).map(n=>n.id);r.length>0&&w.abortRequests(r)}export{T,_e as a,he as b,Me as c,Te as d,me as g,xe as u};
//# sourceMappingURL=jky4nhpbj4n3xuh7.js.map
