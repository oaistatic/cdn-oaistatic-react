import{c as b,j as s,h as E,r as M,i as $}from"./mw35uwhq4g8r9eam.js";import{co as R,K as F,cp as A,A as k}from"./g2euln7v5pbm31qa.js";import{u as B,fg as D,aB as T,er as K,dp as I,bd as Y,W as q}from"./d0xa318sl7ywi0za.js";function z({accountUserId:l,onClose:e}){"use no forget";var j,v,C,P;const i=B(),t=R(l),r=F(i),n=E(),p=M.useRef(null),o=W(),a=O({accountUserId:l,calpicoState:r,onClose:e}),[c,g]=M.useState((j=t==null?void 0:t.name)!=null?j:""),[f,y]=M.useState((v=t==null?void 0:t.username)!=null?v:"");if(t==null)return null;const m=o.isPending,d=()=>{m||a.isPending||(a.error!=null&&a.reset(),a.mutate({currentDisplayName:t.name,currentUsername:t.username,nextDisplayName:c,nextUsername:f}))},_=a.error?(C=D(a.error))!=null?C:n.formatMessage({id:"HTYGke",defaultMessage:"We couldn't save your changes. Please try again."}):null,x=o.error?(P=D(o.error))!=null?P:n.formatMessage({id:"PrR4bZ",defaultMessage:"We couldn't update your profile photo. Please try again."}):null,N=x!=null?x:_;return s.jsx(T,{testId:"modal-edit-profile",isOpen:!0,onClose:()=>e(),type:"success",title:n.formatMessage({id:"sKwZJs",defaultMessage:"Edit profile"}),primaryButton:s.jsx(I.Button,{title:n.formatMessage({id:"I3Re7M",defaultMessage:"Save"}),color:"primary",disabled:c.length===0||f.length===0||a.isPending||m,onClick:()=>{d()},"data-testid":"save-profile-button"}),secondaryButton:s.jsx(I.Button,{title:n.formatMessage({id:"Q0/l4j",defaultMessage:"Cancel"}),color:"secondary",onClick:()=>e()}),children:s.jsxs("form",{className:"flex flex-col",onSubmit:u=>{u.preventDefault(),d()},children:[s.jsxs("div",{className:"flex flex-col items-center py-6",children:[s.jsx("div",{className:"mb-1",children:s.jsxs("button",{type:"button",className:"hover:bg-tertiary relative -m-1 rounded-full p-1",disabled:m,"aria-label":n.formatMessage({id:"oMMvTw",defaultMessage:"Update profile photo"}),"aria-busy":m,onClick:()=>{var u;(u=p.current)==null||u.click()},children:[s.jsx("img",{src:t.avatarUrl,alt:t.name,className:"gizmo-shadow-stroke h-32 w-32 rounded-full object-cover"}),s.jsx("div",{className:"absolute end-0 bottom-0 -translate-x-1/3 -translate-y-1/3",children:s.jsx("div",{className:"bg-token-interactive-bg-tertiary-default gizmo-shadow-stroke flex h-7 w-7 items-center justify-center rounded-full",children:m?s.jsx(K,{className:"icon-sm"}):s.jsx(A,{className:"text-token-text-secondary h-4.5 w-4.5"})})})]})}),s.jsx("input",{ref:p,type:"file",className:"sr-only",accept:"image/png,image/jpeg,image/webp,image/gif",onChange:async u=>{var U;const h=u.currentTarget,w=(U=h.files)==null?void 0:U[0];if(w==null){h.value="";return}o.error!=null&&o.reset();try{await o.mutateAsync({imageFile:w,updateProfileMutator:async({profileAssetPointer:S})=>{await r.updateSelfProfile$({profile_asset_pointer:S})}})}catch(S){}finally{h.value=""}}})]}),s.jsx(k,{displayName:n.formatMessage({id:"50qkqk",defaultMessage:"Display name"}),className:"my-1 px-3 py-2",inputClassName:"bg-token-bg-primary!",displayNameLabelClassName:"font-normal!",name:"display-name",type:"text",value:c,placeholder:t.name,autoComplete:"off","data-1p-ignore":!0,onChange:u=>{g(u.currentTarget.value),a.error!=null&&a.reset()}}),s.jsx(k,{displayName:n.formatMessage({id:"+hY83m",defaultMessage:"Username"}),className:"my-1 px-3 py-2",inputClassName:"bg-token-bg-primary!",displayNameLabelClassName:"font-normal!",name:"username",type:"text",value:f,placeholder:t.username,autoComplete:"off","data-1p-ignore":!0,onChange:u=>{y(u.currentTarget.value),a.error!=null&&a.reset()}}),N?s.jsx("p",{className:"text-interactive-label-warning-secondary mt-2 text-center text-xs",children:N}):null,s.jsx("p",{className:"text-token-text-tertiary mt-2 text-center text-xs",children:n.formatMessage({id:"4mADOv",defaultMessage:"Your profile helps people recognize you. Your name and username are also used in the Sora app."})})]})})}function O(l){"use forget";const e=b.c(11),{accountUserId:i,calpicoState:t,onClose:r}=l;let n;e[0]!==t?(n=async g=>{const{currentDisplayName:f,currentUsername:y,nextDisplayName:m,nextUsername:d}=g;d!==y&&await t.updateSelfUsername$({username:d}),m!==f&&await t.updateSelfProfile$({display_name:m})},e[0]=t,e[1]=n):n=e[1];const p=n;let o;e[2]!==i?(o=["calpico","profile","update",i],e[2]=i,e[3]=o):o=e[3];let a;e[4]!==t||e[5]!==r?(a=()=>{t.setUserOnboardingCompletion$(),r()},e[4]=t,e[5]=r,e[6]=a):a=e[6];let c;return e[7]!==p||e[8]!==o||e[9]!==a?(c={mutationKey:o,mutationFn:p,onSuccess:a},e[7]=p,e[8]=o,e[9]=a,e[10]=c):c=e[10],$(c)}function W(){"use forget";const l=b.c(1);let e;return l[0]===Symbol.for("react.memo_cache_sentinel")?(e={mutationKey:["calpico","profile-photo-upload"],mutationFn:H},l[0]=e):e=l[0],$(e)}async function H(l){const{imageFile:e,updateProfileMutator:i}=l,t=new FormData;t.append("file",e,e.name);const r=await Y.post("".concat(q,"/calpico/chatgpt/profile_files"),t);if(r==null)return;const{asset_pointer:n}=r;await i({profileAssetPointer:n})}function J(l){"use forget";const e=b.c(3),{accountUserId:i,onClose:t}=l;let r;return e[0]!==i||e[1]!==t?(r=s.jsx(z,{accountUserId:i,onClose:t}),e[0]=i,e[1]=t,e[2]=r):r=e[2],r}export{J as CalpicoEditProfileModal};
//# sourceMappingURL=n2h80qnwge2t04id.js.map
