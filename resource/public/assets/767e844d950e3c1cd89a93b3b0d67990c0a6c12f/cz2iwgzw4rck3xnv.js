var I=Object.defineProperty,S=Object.defineProperties;var D=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var w=(e,t,n)=>t in e?I(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,C=(e,t)=>{for(var n in t||(t={}))L.call(t,n)&&w(e,n,t[n]);if(j)for(var n of j(t))R.call(t,n)&&w(e,n,t[n]);return e},O=(e,t)=>S(e,D(t));import{h as y,j as r,e as U,b as A,r as h,q as P}from"./mw35uwhq4g8r9eam.js";import{fr as H,u as J,O as $,ft as m,fi as q,fs as K,rH as X,aw as g,D as f,ay as Q,b7 as V,e1 as M,cF as p}from"./d0xa318sl7ywi0za.js";import{hc as W,hd as G}from"./g2euln7v5pbm31qa.js";function T({jupyterMessage:e}){const t=y(),{width:n,height:a}=e;if(e.image_payload!=null)return r.jsx("img",{className:"my-1 max-h-full max-w-full object-contain",src:"data:image/png;base64,".concat(e.image_payload),alt:t.formatMessage(N.altText),width:n,height:a});if(e.image_url!=null){const o=H(e.image_url);return r.jsx(B,{fileId:o,width:n,height:a})}return null}const z=30*1e3,k=100,_=1.5,Y=Math.log(1-z*(1-_)/k)/Math.log(_);function Z(e,t){return P({queryKey:["getFileDownloadLink",e],queryFn:()=>K(e,void 0,t),staleTime:q,refetchInterval:n=>{var u;const a=n.state.dataUpdateCount;return((u=n.state.data)==null?void 0:u.status)===m.Success||a>Y||n.state.status===m.Error?!1:Math.pow(_,a)*k}})}function B({fileId:e,width:t,height:n}){const a=y(),o=J(),u=!$(o),{data:s,isLoading:l,refetch:i}=A(Z(e,u));return h.useEffect(()=>{if((s==null?void 0:s.status)===m.Success){const c=new URL(s.download_url,location.toString()).searchParams.get("se");c!=null&&!l&&new Date>new Date(c)&&i()}},[s,l,i]),(s==null?void 0:s.status)!==m.Success?null:r.jsx("img",{src:s.download_url,className:"my-1 max-h-64 max-w-full object-contain sm:max-h-80",alt:a.formatMessage(N.altText),width:t,height:n})}const N=U({altText:{id:"CodeExecutionOutputImage.altText",defaultMessage:"Output image"}});function ue({FormattedText:e,message:t,codeRendererClassName:n,forceDarkMode:a,removeTopBorderRadius:o,showActionBar:u,codeContainerClassName:s}){const l=M()||a,i=ee(t),d=h.useCallback(x=>r.jsx(W,O(C({},x),{wrapperClassName:n,codeContainerClassName:s,removeTopBorderRadius:o,showActionBar:u})),[n,s,o,u]),c=h.useMemo(()=>({code:d}),[d]);return i==null?null:r.jsx(G.Provider,{value:{isWithinDataAnalysisToolMessage:!0},children:r.jsx(e,{className:p("markdown prose dark:prose-invert w-full break-words",l?"dark":"light"),forceDarkMode:a,componentOverrides:c,children:i})})}function ee(e){var n,a,o,u,s,l,i,d;function t(c,x){return"```".concat(x,"\n").concat(c,"\n```")}if(e.author.name==="python"&&e.content.content_type===g.ExecutionOutput)return(a=(n=e.metadata)==null?void 0:n.aggregate_result)!=null&&a.code?t((u=(o=e.metadata)==null?void 0:o.aggregate_result)==null?void 0:u.code,"python"):null;if(e.author.name==="container.exec"&&e.author.role===Q.Tool)return(l=(s=e.metadata)==null?void 0:s.container_citation)!=null&&l.source_cmd?t((d=(i=e.metadata)==null?void 0:i.container_citation)==null?void 0:d.source_cmd,"bash"):null;if(e.content.content_type==="code")return t(e.content.text,"python");if(e.recipient==="python"){if(e.content.content_type!=="text")return f.addError("Unexpected content type for code message"),null;const c=e.content.parts;return c.length!==1||typeof c[0]!="string"?(f.addError("Unexpected parts for code message"),null):t(c[0],"python")}return V(3179801956,e.author.name)&&e.content.content_type===g.ExecutionOutput?t(e.content.text,"python"):(f.addAction("Unexpected code message format"),null)}function ce({message:e,showLabel:t=!0,wrapperClassName:n,codeContainerClassName:a,forceDarkMode:o}){var x;const u=y();if(e.content.content_type!==g.ExecutionOutput)return null;const s=(x=e.metadata)==null?void 0:x.aggregate_result;if(!s)return f.addError("Corrupt code execution result message"),null;const l=s.messages.filter(ne),i=l.length>0,d=s.final_expression_output!=null,c=s.in_kernel_exception!=null;return r.jsxs(r.Fragment,{children:[i&&r.jsx(v,{forceDarkMode:o,label:t?"STDOUT/STDERR":null,wrapperClassName:n,output:l.map((b,F)=>r.jsx("span",{className:b.stream_name==="stderr"?"text-red-500":"",children:b.text},"".concat(F)))}),d&&r.jsx(v,{forceDarkMode:o,wrapperClassName:n,codeContainerClassName:a,label:t?u.formatMessage({id:"codeInterpreterMessage.resultLabel",defaultMessage:"Result"}):null,output:s.final_expression_output}),c&&r.jsx(te,{traceback:s.in_kernel_exception.traceback.join("")})]})}function v({wrapperClassName:e,label:t,output:n,codeContainerClassName:a,forceDarkMode:o}){const u=M()||o;return r.jsxs("div",{className:p("bg-token-sidebar-surface-primary p-4 text-xs","overflow-x-auto",e),children:[t&&r.jsx("div",{className:"mb-1 text-gray-400",children:t}),r.jsx("div",{className:p("prose flex flex-col-reverse",u?"text-white":"text-black"),children:r.jsx("pre",{className:p("shrink-0 overflow-auto",a),children:n})})]})}function te({traceback:e}){return r.jsx("div",{className:"overflow-auto border-t border-gray-500 bg-black text-white",children:r.jsx("div",{className:"border-s-4 border-red-500 p-2 text-xs",children:r.jsx("div",{className:"scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-700 flex max-h-64 flex-col-reverse",children:r.jsx("pre",{className:"shrink-0",children:e})})})})}function le({message:e,isCoT:t=!1}){var a;if(e.content.content_type!==g.ExecutionOutput)return null;const n=(a=e.metadata)==null?void 0:a.aggregate_result;return n?t?n.messages.filter(E).map((o,u)=>r.jsx(T,{jupyterMessage:o},u)):r.jsx("div",{className:"flex flex-wrap gap-2",children:n.messages.filter(E).map((o,u)=>r.jsx("div",{className:"max-h-64 items-start justify-start sm:max-h-80",children:r.jsx(T,{jupyterMessage:o})},u))}):(f.addError("Corrupt code execution result message"),null)}function ne(e){return e.message_type==="stream"}function E(e){return e.message_type==="image"||"image_url"in e&&X(e.image_url+"")}function ie(e){var t,n,a;return(a=(n=(t=e.metadata)==null?void 0:t.aggregate_result)==null?void 0:n.messages.some(E))!=null?a:!1}export{le as C,ue as a,ce as b,v as c,B as d,Z as e,T as f,ee as g,ie as h,E as i};
//# sourceMappingURL=cz2iwgzw4rck3xnv.js.map
