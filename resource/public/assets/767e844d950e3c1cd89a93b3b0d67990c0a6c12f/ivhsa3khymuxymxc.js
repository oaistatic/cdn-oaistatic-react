var B=Object.freeze,O=Object.defineProperty;var D=(s,n)=>B(O(s,"raw",{value:B(n||s.slice())}));import{h as q,u as Q,r as v,d as W,b as H,j as e,M as u,i as J,n as Z}from"./mw35uwhq4g8r9eam.js";import{u as V,al as X,_ as w,aB as Y,aA as $,cB as z,p as ee,R as I,cw as se,f7 as j}from"./d0xa318sl7ywi0za.js";import{bD as te,bE as ae,bd as f,bF as U,bG as K,bn as re,be as ne,bH as oe,bI as ie,bJ as le}from"./g2euln7v5pbm31qa.js";import{M as de,R as me,t as ce}from"./nea9sowk1s9pzcpg.js";import"./ey0kaiz1v4k0znjj.js";function ue({gizmo:s,memory:n}){var b;const i=q(),l=ee(),d=Q(),{mutate:t,isPending:m}=J({mutationFn:async M=>{const{success:y}=await I.safeDelete("/memories/{memory_id}",{parameters:{path:{memory_id:M}},requestBody:{gizmo_id:s==null?void 0:s.id}});if(!y)throw new Error("An error occurred while deleting the memory")},onSettled:()=>{d.invalidateQueries({queryKey:U(s==null?void 0:s.id)}),d.invalidateQueries({queryKey:K()})},onError:()=>{l.danger(Z({id:"MemoriesModal.deleteFailed",defaultMessage:"Failed to forget memory"}),{id:"memoryDeleteFailed",toastId:"memory_delete_failed"})}}),[p,a]=v.useState(!1),c=i.formatMessage({id:"N0czuB",defaultMessage:"Remove"});return e.jsxs(e.Fragment,{children:[e.jsxs(f.Row,{disabled:m,children:[e.jsx(f.Cell,{children:e.jsx("div",{className:"py-2 whitespace-pre-wrap",children:n.content})}),e.jsx(f.Cell,{textAlign:"right",children:e.jsx(f.Actions,{children:e.jsx("button",{onClick:()=>{w.logEvent("Memory Manage Modal Memory Delete Clicked"),a(!0)},"aria-label":c,className:"text-token-text-tertiary hover:text-token-text-secondary",children:e.jsx(se,{className:"leading-none",label:c,side:"top",children:e.jsx(ne,{className:"icon-sm"})})})})})]}),p&&e.jsx(oe,{isOpen:!0,primaryButtonColor:"danger",title:c,confirmText:i.formatMessage({id:"fCn0ar",defaultMessage:"Forget"}),onConfirm:()=>{w.logEvent("Memory Manage Modal Memory Delete Confirmed"),t(n.id),a(!1)},onClose:()=>{a(!1)},children:e.jsx(u,{id:"j2cZHW",defaultMessage:'Remove "{title}" from {name}’s saved memories. This can’t be undone. <link>Learn more</link>',values:{name:(b=s==null?void 0:s.name)!=null?b:"ChatGPT",title:e.jsx("strong",{children:ce(n.content,{length:130,omission:"..."})}),link:M=>e.jsx("a",{href:"https://help.openai.com/en/articles/8590148-memory-faq",target:"_blank",className:"underline",rel:"noreferrer",children:M})}})})]})}function he({selectedGizmoId:s,onSelect:n,items:i}){const l=i.find(t=>t.id===s);function d(t){var m;return e.jsx(le,{isFirstParty:t.id===void 0,src:(m=t.iconUrl)!=null?m:null,className:"icon"})}return e.jsx("div",{className:"border-token-border-medium mb-2 inline-flex rounded-md border",children:e.jsxs(j.Root,{children:[e.jsx(j.Trigger,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[l?e.jsxs(e.Fragment,{children:[d(l),e.jsx("span",{className:"text-token-text-primary",children:l.name})]}):e.jsx(u,{id:"MemoriesModal.unknownGizmo",defaultMessage:"Unknown GPT"}),e.jsx(ie,{className:"icon-sm text-token-text-tertiary"})]})}),e.jsx(j.Portal,{children:e.jsx(j.Content,{children:i.map(t=>e.jsxs(j.Item,{className:"flex items-center gap-3",onClick:()=>{n(t.id)},children:[d(t),t.name]},t.id))})})]})})}var G;const P=z.div(G||(G=D(["flex h-full items-center justify-center pb-8 text-sm text-token-text-tertiary rounded-lg border border-token-border-default"])));function pe({onClose:s,initialGizmoId:n,contextScopes:i,memoryEntriesFilter:l,requiredContextScopes:d}){var E,R,S;const t=q(),m=Q(),p=te(),[a,c]=v.useState(n),b=V(),M=W(),y=X(b),F=y==null?void 0:y.hasPlusFeatures();v.useEffect(()=>{w.logEvent("Memory Modal Shown")},[]);const{data:h,isLoading:C,isError:N,refetch:T}=ae(a,!0,p,i,l,d),x=h==null?void 0:h.memories,{data:k,refetch:L}=H({queryKey:["memory_gizmos"],queryFn:()=>I.safeGet("/memories/gizmos"),refetchOnMount:"always"}),_=[{id:void 0,name:"ChatGPT",iconUrl:null},...(E=k==null?void 0:k.items.map(({gizmo:r})=>{var A;return{id:r.id,name:r.display.name,iconUrl:(A=r.display.profile_picture_url)!=null?A:null}}))!=null?E:[]],o=_.find(r=>r.id===a);v.useEffect(()=>{!C&&!N&&a!==void 0&&(!x||x.length===0)&&c(void 0)},[C,N,x,a]);let g;return C?g=e.jsx(P,{children:e.jsx(u,{id:"MemoriesModal.loading",defaultMessage:"Loading..."})}):N?g=e.jsx(P,{children:e.jsxs("div",{className:"max-w-sm text-center",children:[e.jsx("div",{className:"mb-4 text-red-500",children:e.jsx(u,{id:"MemoriesModal.somethingWentWrong",defaultMessage:"Something went wrong..."})}),e.jsx("div",{children:e.jsx($,{color:"secondary",onClick:()=>{T()},children:e.jsx(u,{id:"MemoriesModal.retry",defaultMessage:"Retry"})})})]})}):!x||x.length===0?g=e.jsx(P,{children:e.jsx("div",{className:"max-w-sm text-center",children:p?e.jsx(u,{id:"MemoriesModal.noMemories.1",defaultMessage:"As you chat with {name}, the details and preferences it saves will be shown here.",values:{name:(R=o==null?void 0:o.name)!=null?R:"ChatGPT"}}):e.jsx(u,{id:"MemoriesModal.noMemoriesAndDisabled",defaultMessage:"Memory is disabled. ChatGPT won't use or save memories."})})}):g=e.jsx(f.Root,{className:"border-token-border-default h-full",size:"compact",bordered:!0,children:e.jsx(f.Body,{children:x.map(r=>e.jsx(ue,{gizmo:o?{id:o.id,name:o.name}:void 0,memory:r},r.id))})}),e.jsxs(Y,{testId:"modal-memories",isOpen:!0,onClose:s,size:"custom",className:"max-w-5xl",type:"success",title:t.formatMessage({id:"MemoriesModal.title",defaultMessage:"Saved memories"}),showCloseButton:!0,children:[F&&_.length>1&&e.jsx("div",{className:"mb-4",children:e.jsx(he,{selectedGizmoId:a,items:_,onSelect:r=>{m.invalidateQueries({queryKey:U(r)}),m.invalidateQueries({queryKey:K()}),c(r)}})}),e.jsx(de,{memoryFullPct:h==null?void 0:h.memoryFullPct,isPaid:F,showUpgradeCTA:!1,onUpgrade:()=>{w.logEventWithStatsig("Memories Upgrade Button Clicked","chatgpt_memories_upgrade_button_clicked_settings"),re(M,"chatgpt_memories_upgrade_button")},className:"mb-5"}),e.jsx("div",{className:"h-[24rem]",children:g}),e.jsx("div",{className:"mt-5 flex justify-end",children:e.jsx(me,{onReset:()=>{T(),L(),a&&c(void 0)},gizmoId:a,memoryName:(S=o==null?void 0:o.name)!=null?S:"ChatGPT",contextScopes:i,requiredContextScopes:d,memoryEntriesFilter:l})})]})}export{pe as default};
//# sourceMappingURL=ivhsa3khymuxymxc.js.map
