var Oe=Object.defineProperty,He=Object.defineProperties;var Ge=Object.getOwnPropertyDescriptors;var ce=Object.getOwnPropertySymbols;var Ee=Object.prototype.hasOwnProperty,Ne=Object.prototype.propertyIsEnumerable;var Ce=(t,e,o)=>e in t?Oe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,de=(t,e)=>{for(var o in e||(e={}))Ee.call(e,o)&&Ce(t,o,e[o]);if(ce)for(var o of ce(e))Ne.call(e,o)&&Ce(t,o,e[o]);return t},fe=(t,e)=>He(t,Ge(e));var Me=(t,e)=>{var o={};for(var n in t)Ee.call(t,n)&&e.indexOf(n)<0&&(o[n]=t[n]);if(t!=null&&ce)for(var n of ce(t))e.indexOf(n)<0&&Ne.call(t,n)&&(o[n]=t[n]);return o};import{r as f,j as s,h as le,t as We,M as V,c as Ve,d as Ke}from"./mw35uwhq4g8r9eam.js";import{cw as ue,cF as te,er as ge,du as Ue,ml as qe,h8 as Ze,ik as ze,h2 as Xe,u as Ye,ro as $e,ee as ke,ei as Se,d as Je,ua as Qe,aA as he}from"./d0xa318sl7ywi0za.js";import{S as ye}from"./k6k3ilbqdb73kxkm.js";import{iw as es,bI as ss,dL as ts,bf as ns,b4 as Re,b5 as Pe,rA as Be,cw as os,lv as rs,A as Le,cg as as,E as ls}from"./g2euln7v5pbm31qa.js";import{C as _e}from"./ksb30nvrqfrocrgu.js";import{I as is}from"./h38m9m9rf2db1qpt.js";import{u as Ie}from"./mlgj7gsfvuk1e8bn.js";import{j as me,M as cs,N as ds,O as us,P as ms,f as fs}from"./ldtpmsnzn9ens47o.js";import{W as hs}from"./baz4b8nlf8t2lb95.js";import{i as xs}from"./mpk4drhv3szxuvkj.js";const pe=t=>f.createElement("svg",de({width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),f.createElement("path",{d:"M17.5 3C19.1569 3 20.5 4.34315 20.5 6C20.5 7.30574 19.6645 8.413 18.5 8.8252V9C18.5 11.2091 16.7091 13 14.5 13H9.5C8.39543 13 7.5 13.8954 7.5 15V15.1738C8.66468 15.5859 9.5 16.6941 9.5 18C9.5 19.6569 8.15685 21 6.5 21C4.84315 21 3.5 19.6569 3.5 18C3.5 16.6941 4.33532 15.5859 5.5 15.1738V8.8252C4.33548 8.413 3.5 7.30574 3.5 6C3.5 4.34315 4.84315 3 6.5 3C8.15685 3 9.5 4.34315 9.5 6C9.5 7.30574 8.66452 8.413 7.5 8.8252V11.5361C8.08845 11.1956 8.77125 11 9.5 11H14.5C15.6046 11 16.5 10.1046 16.5 9V8.8252C15.3355 8.413 14.5 7.30574 14.5 6C14.5 4.34315 15.8431 3 17.5 3ZM6.5 17C5.94772 17 5.5 17.4477 5.5 18C5.5 18.5523 5.94772 19 6.5 19C7.05228 19 7.5 18.5523 7.5 18C7.5 17.4477 7.05228 17 6.5 17ZM6.5 5C5.94772 5 5.5 5.44772 5.5 6C5.5 6.55228 5.94772 7 6.5 7C7.05228 7 7.5 6.55228 7.5 6C7.5 5.44772 7.05228 5 6.5 5ZM17.5 5C16.9477 5 16.5 5.44772 16.5 6C16.5 6.55228 16.9477 7 17.5 7C18.0523 7 18.5 6.55228 18.5 6C18.5 5.44772 18.0523 5 17.5 5Z",fill:"currentColor"}));function Ae({triggerText:t,toolTip:e,ariaLabel:o,Icon:n,truncate:l=!0,isLoading:i=!1}){return s.jsx(es,{className:"composer-btn px-2","aria-label":o,"aria-busy":i,children:s.jsx(ue,{label:e,className:"text-sm font-medium",children:s.jsxs("div",{className:"flex max-w-full items-center gap-1.5 ps-1",children:[n,s.jsx("span",{className:te("hidden sm:block",l?"max-w-[8rem] truncate md:max-w-[10rem]":"w-fit"),children:t}),i&&s.jsx(ge,{"aria-hidden":!0,className:"icon-sm"}),s.jsx(ss,{"aria-hidden":!0,className:"icon-sm"})]})})})}function ne(M){var x=M,{children:t,className:e,onClick:o,isSelected:n,isActive:l,isVirtualHover:i=!1,label:j,isDisabled:d,tooltipLabel:r,isSubMenuTrigger:m,noDefaultHoverState:b,as:a="button",truncateLabel:C,infoIcon:v,infoLink:E,icon:p}=x,g=Me(x,["children","className","onClick","isSelected","isActive","isVirtualHover","label","isDisabled","tooltipLabel","isSubMenuTrigger","noDefaultHoverState","as","truncateLabel","infoIcon","infoLink","icon"]);const w=le();let A=s.jsx(s.Fragment,{});t?A=s.jsx("div",{className:"flex flex-1 items-center gap-4",children:t}):j&&(A=s.jsxs("div",{className:te("flex items-center gap-3",C?"w-0 flex-1":"w-full"),children:[p&&(f.isValidElement(p)?p:s.jsx(ps,{icon:p})),j&&s.jsx("div",{className:te("flex flex-col items-start py-1",d&&"text-token-text-quaternary pointer-events-none",C&&"w-[100%]"),children:s.jsx("div",{className:te("flex items-center text-start text-sm",C&&"w-full"),children:s.jsx("span",{className:"w-full overflow-hidden text-ellipsis whitespace-nowrap",children:j})})})]}),r&&(A=s.jsx(ue,{sideOffset:-10,label:r,className:"w-full",children:A})));const T=s.jsxs("div",{className:te("flex items-center justify-center",(n||v&&E||m)&&"min-w-5"),children:[n&&s.jsx(Ue,{className:"icon color:var(--tint-color,#0285FF) icon-sm","aria-label":w.formatMessage({id:"wham.codexMenuRow.selected",defaultMessage:"Selected"})}),v&&E&&s.jsx("a",{href:E,target:"_blank",rel:"noopener noreferrer",children:v}),m&&s.jsx(ts,{className:"icon text-token-text-tertiary w-7","aria-label":w.formatMessage({id:"wham.codexMenuRow.openSubmenu",defaultMessage:"Open submenu"})})]}),y=te("flex cursor-pointer items-center rounded-[10px] px-2.5 py-1",(n||v&&E||m)&&"gap-4",l&&"bg-black/5 dark:bg-white/5",!b&&"hover:bg-black/5 dark:hover:bg-white/5",i&&"bg-black/5 dark:bg-white/5",e);if(a==="div"){const c=g;return s.jsxs("div",fe(de({},c),{className:y,children:[A,T]}))}const D=g;return s.jsxs("button",fe(de({type:"button"},D),{onClick:c=>{c.persist(),requestAnimationFrame(()=>{o==null||o(c)})},className:y,children:[A,T]}))}function ps({icon:t}){const e=t;return s.jsx("div",{className:"text-token-text-secondary flex h-5 w-5 items-center justify-center",children:s.jsx(e,{className:"h-5 w-5 shrink-0","aria-label":""})})}const xe="wham-environment-popover-event";function Te(t,e,o){f.useEffect(()=>{function l(i){i.detail.popover!==t&&o()}return window.addEventListener(xe,l),()=>{window.removeEventListener(xe,l)}},[t,o]);const n=f.useCallback(l=>{window.dispatchEvent(new CustomEvent(xe,{detail:{popover:l}}))},[]);f.useEffect(()=>{e&&n(t)},[e,n,t])}const De=({items:t,onSelect:e,keyExtractor:o})=>{const[n,l]=f.useState(null),[i]=f.useState(new Map);return{hoveredId:n,setHoveredId:l,getItemRef:d=>r=>{const m=o(d);return r&&i.set(m,r),()=>{i.delete(m)}},itemRefs:i,onKeyDown:d=>{var v;const r=d.key==="ArrowDown"||d.key==="n"&&d.ctrlKey,m=d.key==="ArrowUp"||d.key==="p"&&d.ctrlKey;if(!(r||m||d.key==="Enter"))return;if(d.preventDefault(),d.key==="Enter"){n&&e(n);return}const b=t.findIndex(E=>o(E)===n),a=ns(b-(m?1:-1),0,t.length-1),C=o(t[a]);(v=i.get(C))==null||v.scrollIntoView({behavior:"instant",block:"nearest"}),l(C)}}};function gs({environment:t,repository:e}){var E,p,g,M;const o=le(),{branch:n,setBranch:l}=me(),[i,j]=f.useState(""),[d,r]=f.useState(!1),m=f.useRef(null),b=()=>r(!1),a=(g=(p=(E=t==null?void 0:t.repos)==null?void 0:E[0])!=null?p:e==null?void 0:e.id)!=null?g:null,C=f.useRef(a),v=t?ws(t):(M=e==null?void 0:e.default_branch)!=null?M:"main";return f.useEffect(()=>{const x=C.current;if(C.current=a,!a){l(null);return}const w=cs(a);if(x!==a){if(w){l(w);return}l(v);return}n||l(w!=null?w:v)},[n,a,v,l]),Te("branch",d,()=>r(!1)),Ie([{key:"whamBranches",action:()=>r(!0),actionMessageDescriptor:o.formatMessage({id:"wham.keyboardActions.whamBranches",defaultMessage:"Branches"}),group:Pe.Chat,keyboardBinding:[Re.Mod,"b"]}]),s.jsx("div",{className:"items-center rounded-full",children:s.jsxs(Be,{open:d,onOpenChange:r,children:[s.jsx(Ae,{triggerText:n!=null?n:o.formatMessage({id:"wham.codexBranchPopover.selectABranch",defaultMessage:"Select a Branch"}),toolTip:n===""||d?"":n!=null&&n.length?n:o.formatMessage({id:"wham.codexBranchPopover.searchForYourBranchTooltip",defaultMessage:"Search for your branch"}),ariaLabel:o.formatMessage({id:"wham.codexBranchPopover.searchForYourBranchAria",defaultMessage:"Search for your branch"}),Icon:s.jsx(pe,{"aria-hidden":!0,className:"icon-sm"})}),s.jsx(_e,{align:"start",isOpen:d,closePopover:b,popoverContentRef:m,children:s.jsx(vs,{defaultBranch:v,repoId:a,searchQuery:i,setSearchQuery:j,setBranch:l,selectedBranch:n!=null?n:"",closePopover:b})})]})})}function vs({repoId:t,defaultBranch:e,setBranch:o,selectedBranch:n,searchQuery:l,setSearchQuery:i,closePopover:j}){const d=le(),r=f.useRef(null),m=os(l,300),b=f.useMemo(()=>t?ds(t):[],[t]),{data:a,isLoading:C,fetchNextPage:v,hasNextPage:E,isFetchingNextPage:p,error:g}=We({queryKey:["searchBranches",t,m],enabled:!!t,initialPageParam:null,queryFn:({pageParam:c})=>hs.searchBranchesByRepository(t!=null?t:"",m,rs,c!=null?c:null),getNextPageParam:c=>{var k;return(k=c==null?void 0:c.cursor)!=null?k:null}}),M=f.useMemo(()=>{var K,u,B;const c=(B=(u=(K=a==null?void 0:a.pages)==null?void 0:K.flat().map(R=>R.items.flatMap(F=>F.branch)))==null?void 0:u.flat())!=null?B:[],k=new Set,_=[];e&&!k.has(e)&&(k.add(e),_.push(e));for(const R of b)k.has(R)||(k.add(R),_.push(R));for(const R of c)k.has(R)||(k.add(R),_.push(R));return _},[a,e,b]),x=c=>{o(c),j()},w=f.useMemo(()=>l!=null&&l.trim()?M.filter(c=>c.toLowerCase().includes(l.toLowerCase())):M!=null?M:[],[l,M]),{hoveredId:A,setHoveredId:T,onKeyDown:y,getItemRef:D}=De({items:w,keyExtractor:c=>c,onSelect:x});return f.useEffect(()=>{r.current&&r.current.focus()},[]),s.jsxs("div",{className:"gap flex max-h-[280px] w-90 flex-col rounded-lg p-0 md:max-h-[360px]",onClick:c=>{c.stopPropagation()},children:[s.jsx(Le,{ref:r,className:"placeholder:text-token-text-tertiary !focus-within:ring-0 my-1.5 w-full border-0 bg-transparent ps-4 outline-none focus:border-0 focus:ring-0 focus:outline-none",type:"text",autoComplete:"off",inputClassName:"text-sm",name:"search-branch",value:l,suppressFocus:!0,onKeyDown:y,onChange:c=>i(c.target.value),placeholder:d.formatMessage({id:"wham.codexBranchPopover.branch",defaultMessage:"Search branches…"}),ariaLabel:d.formatMessage({id:"wham.codexBranchPopover.createBranchAria",defaultMessage:"Create a new branch"})}),s.jsx("div",{className:"bg-token-border-default h-px w-full"}),s.jsxs("div",{className:"min-h-18 w-full overflow-y-auto p-1.5",children:[w==null?void 0:w.map(c=>{const k=c===n;return s.jsx(ne,{className:"w-full max-w-full whitespace-nowrap",as:"button",onMouseEnter:()=>T(c),isVirtualHover:A===c,ref:D(c),onClick:()=>{x(c)},isSelected:k,label:c,truncateLabel:!0},c)}),g?s.jsx("div",{className:"flex items-center justify-center",children:s.jsx(V,{id:"wham.branchPopover.error",defaultMessage:"Error loading branches"})}):null,s.jsx(is,{bgColor:"dark:bg-token-bg-secondary",hasNextPage:E,fetchNextPage:v,isFetchingNextPage:p||C})]})]})}function ws(t){var e;for(const o of t.repos){const n=(e=t.repo_map)==null?void 0:e[o];if(n!=null&&n.default_branch)return n.default_branch}return"main"}function bs({repository:t,disabledRepositoryIds:e,isCreating:o,creatingRepositoryId:n,isSelected:l,onSelect:i}){var b,a;const j=(a=(b=t.repository_full_name)!=null?b:t.name)!=null?a:"",d=n===t.id,m=!!(e==null?void 0:e.has(t.id))||!!o&&!d||!!d;return s.jsx(ne,{as:"button",className:"w-full",onClick:()=>{m||i(t)},isSelected:l,isDisabled:m,label:j})}function js({repositories:t,isLoading:e,isError:o,search:n,onSelectRepository:l,existingEnvironmentRepositoryIds:i,showRepositoriesHeader:j}){"use no forget";const d=qe("installations/select_target"),r=me(a=>a.selectedRepositoryId),m=me(a=>a.useRepositoryAsEnvironment),b=f.useMemo(()=>t.length?t.filter(a=>{var E,p,g,M,x;if(!a.id||i.has(a.id))return!1;if(!n)return!0;const C=((p=(E=a.repository_full_name)!=null?E:a.name)!=null?p:"").toLowerCase(),v=(x=(M=(g=a.owner)==null?void 0:g.login)==null?void 0:M.toLowerCase())!=null?x:"";return C.includes(n)||v.includes(n)}).sort((a,C)=>{var p,g,M,x;const v=(g=(p=a.repository_full_name)!=null?p:a.name)!=null?g:"",E=(x=(M=C.repository_full_name)!=null?M:C.name)!=null?x:"";return v.localeCompare(E)}):[],[i,n,t]);return s.jsxs("div",{className:"text-token-text-primary flex flex-col gap-0.5",children:[j&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"bg-token-border-default mt-2 h-px w-full"}),s.jsx("div",{className:"px-1.5",children:s.jsx(ne,{as:"div",className:"text-token-text-tertiary pointer-events-none w-full text-sm",label:s.jsx("div",{className:"flex items-center gap-2",children:s.jsx(V,{id:"wham.codexEnvironmentPopover.repositoriesWithoutEnvironments",defaultMessage:"Repositories"})})})})]}),s.jsx("div",{className:"px-1.5",children:e?s.jsx("div",{className:"flex w-full items-center justify-center py-2",children:s.jsx(ge,{className:"ms-2"})}):o?s.jsx("div",{className:"p-5 text-center",children:s.jsx("p",{className:"text-token-text-tertiary text-sm",children:s.jsx(V,{id:"wham.codexEnvironmentPopover.repositoriesWithoutEnvironmentsError",defaultMessage:"Failed to load repositories"})})}):b.length===0?s.jsx("div",{className:"p-5 text-center",children:s.jsx("p",{className:"text-token-text-tertiary text-sm",children:s.jsx(V,{id:"wham.environmentPopover.noRepositories",defaultMessage:"No repositories found"})})}):b.map(a=>s.jsx(bs,{repository:a,isSelected:m&&r===a.id,onSelect:l},a.id))}),s.jsx("div",{className:"bg-token-border-default mt-1 h-px w-full"}),s.jsx("div",{className:"px-1.5 pb-1.5",children:s.jsx(ne,{as:"button",className:"mt-1 w-full",onClick:()=>{window.open(d,"_blank")},icon:s.jsx(as,{className:"icon-sm inline-block"}),label:s.jsx("div",{className:"flex items-center gap-2 text-sm",children:s.jsx(V,{id:"o1jiyf",defaultMessage:"Configure Repositories on GitHub"})})})})]})}function Fe({className:t}){return s.jsx(ls,{className:te("flex w-[8rem] items-center gap-1.5 rounded-full! md:w-[10rem]",t)})}function Cs(){const{data:t,isError:e}=ms(),{data:o,isLoading:n,isError:l}=fs();return{environments:o!=null?o:t,fullEnvironmentsLoading:n,isErrorEnvironments:l&&e}}function Es({onCreateEnvironment:t,showBranchSelector:e=!0,allowRepositorySelection:o=!0,filters:n=null}={}){"use no forget";var se,N,q,ie;const l=le(),{environmentId:i,setEnvironmentId:j,selectedRepositoryId:d,setSelectedRepositoryId:r,setBranch:m,setUseRepositoryAsEnvironment:b,useRepositoryAsEnvironment:a}=me(),[C,v]=f.useState(!1),E=f.useRef(null),[p,g]=f.useState(!1),M=f.useRef(i),[x,w]=f.useState(null),[A,T]=f.useState(""),{data:y,isLoading:D,isError:c}=us(A),{environments:k,fullEnvironmentsLoading:_,isErrorEnvironments:K}=Cs(),u=f.useMemo(()=>n!=null&&n.repos?k==null?void 0:k.filter(h=>xs(h.repos,n.repos).length>0):k,[k,n]),B=u==null?void 0:u.find(h=>h.id===i),R=f.useCallback(h=>{var I,O;if(!h)return null;const S=(O=h.repos)!=null?O:Object.keys((I=h.repo_map)!=null?I:{});if(!S.length)return null;const[P]=S;return P!=null?P:null},[]);Te("environment",C,()=>v(!1)),f.useEffect(()=>{M.current!==i&&(M.current=i,i!=null&&(g(!1),w(null)))},[i]),f.useEffect(()=>{if(!a){w(null);return}},[a]),f.useEffect(()=>{if(p||_)return;if(i&&!B){j(null),r(null);return}else if(!i&&(u!=null&&u.length)){const P=Ze(u,[O=>{var W;return!((W=O.is_pinned)!=null&&W)},O=>{var W;return-((W=O.task_count)!=null?W:0)}])[0];j(P.id);const I=R(P);r(I!=null?I:null);return}const h=R(B);h!=null&&h!==d?r(h):B&&h==null&&d!=null&&r(null)},[_,i,B,u,j,d,r,R,p]),f.useEffect(()=>{var S;if(K||p||_||((S=u==null?void 0:u.length)!=null?S:0)>0||!(y!=null&&y.repositories.length))return;const[h]=y.repositories;if(h!=null&&h.id&&o&&!i){if(d===h.id&&a){(x==null?void 0:x.id)!==h.id&&w(h);return}b(!0),r(h.id),w(h),m(null)}},[y,K,a,i,d,m,r,b,w,p,_,u==null?void 0:u.length,x==null?void 0:x.id,o]),Ie([{key:"whamEnvironments",action:()=>v(!0),actionMessageDescriptor:l.formatMessage({id:"wham.keyboardActions.whamEnvironments",defaultMessage:"Environments"}),group:Pe.Chat,keyboardBinding:[Re.Mod,"e"]}]);const F=f.useCallback(()=>v(!1),[]),Z=f.useCallback(h=>{h!=null&&h.id&&(g(!0),j(null),b(!0),r(h.id),w(h),m(null),F())},[F,m,j,r,b]),z=l.formatMessage({id:"wham.codexEnvironmentPopover.selectEnvironment",defaultMessage:"Select environment"}),X=l.formatMessage({id:"wham.codexEnvironmentPopover.selectRepository",defaultMessage:"Select repository"}),oe=l.formatMessage({id:"wham.codexEnvironmentPopover.viewAllCodeEnvironments",defaultMessage:"View all code environments"}),L=B==null?void 0:B.label,Y=((se=L==null?void 0:L.length)!=null?se:0)>16,H=o&&(a||(u==null?void 0:u.length)===0&&!_),G=(q=(N=x==null?void 0:x.repository_full_name)!=null?N:x==null?void 0:x.name)!=null?q:X,$=G.length>16,J=H?G:L!=null?L:z,re=H?$?G:"":Y?L!=null?L:"":L||C?"":oe,Q=H?s.jsx(ze,{"aria-hidden":!0,className:"icon-sm"}):s.jsx(ye,{"aria-hidden":!0,className:"icon-sm"}),ae=f.useMemo(()=>{const h=new Set;return u==null||u.forEach(S=>{var I,O;((O=S.repos)!=null?O:Object.keys((I=S.repo_map)!=null?I:{})).forEach(W=>{W&&h.add(W)})}),h},[u]),U=o&&a&&x?x:null,ee=e&&!!(B||U);return _&&!(u!=null&&u.length)?s.jsx("div",{className:"flex items-center gap-3 rounded-full",children:s.jsx(Fe,{})}):s.jsxs("div",{className:"flex items-center gap-2 rounded-full",children:[s.jsxs(Be,{open:C,onOpenChange:v,children:[s.jsx(Ae,{triggerText:J,toolTip:re,ariaLabel:l.formatMessage({id:"wham.codexEnvironmentPopover.viewAll",defaultMessage:"View all code environments"}),Icon:Q}),s.jsx(_e,{align:"start",isOpen:C,closePopover:F,popoverContentRef:E,children:s.jsx(Ns,{searchTerm:A,setSearchTerm:T,repositories:(ie=y==null?void 0:y.repositories)!=null?ie:[],isLoadingRepositories:D,isErrorRepositories:c,isLoading:_,environments:u!=null?u:[],environmentId:i,setEnvironmentId:h=>{j(h);const S=u==null?void 0:u.find(I=>I.id===h),P=R(S);r(P!=null?P:null)},closePopover:F,onSelectRepository:Z,disabledRepositoryIds:ae,onCreateEnvironment:t,allowRepositorySelection:o})})]}),ee&&s.jsx(gs,{environment:B,repository:U})]})}function Ns(t){"use forget";const e=Ve.c(77),{searchTerm:o,setSearchTerm:n,repositories:l,isLoadingRepositories:i,isErrorRepositories:j,isLoading:d,environments:r,environmentId:m,setEnvironmentId:b,closePopover:a,onSelectRepository:C,disabledRepositoryIds:v,onCreateEnvironment:E,allowRepositorySelection:p}=t,g=le(),M=f.useRef(null);let x;e[0]!==a||e[1]!==b?(x=N=>{b(N),a()},e[0]=a,e[1]=b,e[2]=x):x=e[2];const w=x,A=Ke(),T=r.length>0;let y;if(e[3]!==m||e[4]!==r||e[5]!==o){e:{let N;e[7]!==m?(N=S=>S.slice().sort((P,I)=>{var be,je;if(P.id===m)return-1;if(I.id===m)return 1;const O=!!P.is_pinned,W=!!I.is_pinned;if(O!==W)return O?-1:1;const ve=(be=P.task_count)!=null?be:0,we=(je=I.task_count)!=null?je:0;return ve!==we?we-ve:P.label.localeCompare(I.label)}),e[7]=m,e[8]=N):N=e[8];const q=N,ie=o.trim().toLowerCase();if(!ie){let S;e[9]!==r||e[10]!==q?(S=q(r),e[9]=r,e[10]=q,e[11]=S):S=e[11],y=S;break e}const h=r.filter(S=>{var P;return((P=S.label)!=null?P:"").toLowerCase().includes(ie)});y=q(h)}e[3]=m,e[4]=r,e[5]=o,e[6]=y}else y=e[6];const D=y;let c;e[12]!==D||e[13]!==w?(c={items:D,keyExtractor:ks,onSelect:w},e[12]=D,e[13]=w,e[14]=c):c=e[14];const{hoveredId:k,setHoveredId:_,onKeyDown:K,getItemRef:u}=De(c);let B,R;e[15]===Symbol.for("react.memo_cache_sentinel")?(B=()=>{var N;(N=M.current)==null||N.focus()},R=[],e[15]=B,e[16]=R):(B=e[15],R=e[16]),f.useEffect(B,R);let F;e[17]!==n?(F=N=>n(N.target.value),e[17]=n,e[18]=F):F=e[18];let Z;e[19]!==p||e[20]!==r.length||e[21]!==g?(Z=p?r.length>0?g.formatMessage({id:"wham.codexEnvironmentPopover.searchEnvironmentsTooltip.envless",defaultMessage:"Search environments and repos…"}):g.formatMessage({id:"wham.codexEnvironmentPopover.searchEnvironmentsTooltip.envlessRepos",defaultMessage:"Search repositories…"}):g.formatMessage({id:"wham.codexEnvironmentPopover.searchEnvironmentsTooltip.environmentsOnly",defaultMessage:"Search environments…"}),e[19]=p,e[20]=r.length,e[21]=g,e[22]=Z):Z=e[22];let z;e[23]!==p||e[24]!==g?(z=p?g.formatMessage({id:"wham.codexEnvironmentPopover.searchEnvironmentsAria.envless",defaultMessage:"Search environments and repos"}):g.formatMessage({id:"wham.codexEnvironmentPopover.searchEnvironmentsAria.environmentsOnly",defaultMessage:"Search environments"}),e[23]=p,e[24]=g,e[25]=z):z=e[25];let X;e[26]!==K||e[27]!==o||e[28]!==F||e[29]!==Z||e[30]!==z?(X=s.jsx(Le,{ref:M,className:"placeholder:text-token-text-tertiary !focus-within:ring-0 my-1.5 w-full border-0 bg-transparent ps-4 outline-none focus:border-0 focus:ring-0 focus:outline-none",inputClassName:"text-sm",type:"text",autoComplete:"off",name:"branch-to-add",value:o,onChange:F,onKeyDown:K,suppressFocus:!0,placeholder:Z,ariaLabel:z}),e[26]=K,e[27]=o,e[28]=F,e[29]=Z,e[30]=z,e[31]=X):X=e[31];let oe;e[32]===Symbol.for("react.memo_cache_sentinel")?(oe=s.jsx("div",{className:"bg-token-border-default h-px w-full"}),e[32]=oe):oe=e[32];let L;e[33]!==X?(L=s.jsxs("div",{className:"contents",onClick:Ms,children:[X,oe]}),e[33]=X,e[34]=L):L=e[34];let Y;e[35]!==r.length?(Y=r.length>0&&s.jsx(ne,{as:"div",className:"text-token-text-tertiary pointer-events-none w-full text-sm",label:s.jsx("div",{className:"flex items-center gap-2",children:s.jsx(V,{id:"wham.codexEnvironmentPopover.envlessModeRepositories",defaultMessage:"Environments"})})}),e[35]=r.length,e[36]=Y):Y=e[36];let H;e[37]!==Y?(H=s.jsx("div",{className:"px-1.5 pt-1.5",children:Y}),e[37]=Y,e[38]=H):H=e[38];let G;e[39]!==m||e[40]!==r.length||e[41]!==D||e[42]!==u||e[43]!==w||e[44]!==k||e[45]!==d||e[46]!==_?(G=d?s.jsx("div",{className:"px-1.5",children:s.jsx("div",{className:"flex w-full items-center justify-center py-2",children:s.jsx(ge,{className:"ms-2"})})}):r.length>0?D.length>0?s.jsx("div",{className:"px-1.5",children:D.map(N=>{const q=m===N.id;return s.jsx(ne,{as:"button",ref:u(N),onMouseEnter:()=>_(N.id),className:"w-full",truncateLabel:!0,onClick:()=>{w(N.id)},isVirtualHover:k===N.id,isSelected:q,label:N.label},N.id)})}):s.jsx("div",{className:"p-1.5 text-center",children:s.jsx("p",{className:"text-token-text-tertiary text-sm",children:s.jsx(V,{id:"wham.environmentPopover.noMatches",defaultMessage:"No environments found"})})}):null,e[39]=m,e[40]=r.length,e[41]=D,e[42]=u,e[43]=w,e[44]=k,e[45]=d,e[46]=_,e[47]=G):G=e[47];let $;e[48]!==p||e[49]!==v||e[50]!==r.length||e[51]!==j||e[52]!==i||e[53]!==C||e[54]!==l||e[55]!==o?($=p?s.jsx(js,{onSelectRepository:C,existingEnvironmentRepositoryIds:v,showRepositoriesHeader:r.length>0,search:o.trim().toLowerCase(),repositories:l,isLoading:i,isError:j}):null,e[48]=p,e[49]=v,e[50]=r.length,e[51]=j,e[52]=i,e[53]=C,e[54]=l,e[55]=o,e[56]=$):$=e[56];let J;e[57]!==H||e[58]!==G||e[59]!==$?(J=s.jsxs("div",{className:"flex min-h-0 flex-1 flex-col overflow-y-auto",children:[H,G,$]}),e[57]=H,e[58]=G,e[59]=$,e[60]=J):J=e[60];let re;e[61]===Symbol.for("react.memo_cache_sentinel")?(re=s.jsx("div",{className:"bg-token-border-default h-px w-full"}),e[61]=re):re=e[61];let Q;e[62]!==T||e[63]!==A||e[64]!==E?(Q=()=>{!T&&E?E():A("/codex/settings/environments")},e[62]=T,e[63]=A,e[64]=E,e[65]=Q):Q=e[65];let ae;e[66]===Symbol.for("react.memo_cache_sentinel")?(ae=s.jsx(Xe,{className:"icon-sm"}),e[66]=ae):ae=e[66];let U;e[67]!==T||e[68]!==g?(U=T?g.formatMessage({id:"wham.codexEnvironmentPopover.manageEnvironments",defaultMessage:"Manage environments"}):g.formatMessage({id:"wham.codexEnvironmentPopover.createEnvironment",defaultMessage:"Create environment"}),e[67]=T,e[68]=g,e[69]=U):U=e[69];let ee;e[70]!==Q||e[71]!==U?(ee=s.jsx("div",{className:"bg-token-bg-tertiary flex flex-shrink-0 flex-col gap-1 px-2 py-1.5",children:s.jsx(ne,{className:"w-full",noDefaultHoverState:!0,onClick:Q,isSelected:!1,icon:ae,label:U},"environment-action")}),e[70]=Q,e[71]=U,e[72]=ee):ee=e[72];let se;return e[73]!==L||e[74]!==J||e[75]!==ee?(se=s.jsxs("div",{className:"flex max-h-[280px] w-80 flex-col overflow-y-auto rounded-lg md:max-h-[360px]",children:[L,J,re,ee]}),e[73]=L,e[74]=J,e[75]=ee,e[76]=se):se=e[76],se}function Ms(t){t.stopPropagation()}function ks(t){return t.id}function Fs({onCreateEnvironment:t,showBranchSelector:e,filters:o,allowRepositorySelection:n}={}){const l=Ye(),i=le(),{isConnected:j,isLoading:d,openGithubModal:r,error:m,refetch:b}=$e(Se.GITHUB_CONNECTOR,"github","/codex",ke.CODEX),a=Je(()=>Qe(l,Se.GITHUB_CONNECTOR,{productSku:ke.CODEX}));return d?s.jsx(Fe,{className:"h-9"}):m?s.jsx(ue,{label:i.formatMessage({id:"wham.whamComposerEnvironmentsSelector.failedClickToRetry",defaultMessage:"Click to retry"}),children:s.jsx(he,{color:"secondary",type:"button",className:"border-token-border-default flex w-fit items-center gap-1.5 rounded-full! border",onClick:b,children:s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx(ye,{"aria-hidden":!0,className:"icon-sm"}),s.jsx(V,{id:"wham.environmentsSelector.retry",defaultMessage:"Failed to load environments"})]})})}):a?s.jsx(s.Fragment,{children:s.jsx("div",{className:"z-0 flex w-full justify-between",children:j?s.jsx("div",{className:"flex gap-4",children:s.jsx(Es,{onCreateEnvironment:t,showBranchSelector:e!=null?e:!0,allowRepositorySelection:n!=null?n:!0,filters:o!=null?o:null})}):s.jsx("div",{className:"flex gap-2",children:s.jsxs(he,{type:"button",color:"secondary",size:"small",onClick:r,children:[s.jsx(pe,{"aria-hidden":!0,className:"icon-sm me-1.5"}),s.jsx(V,{id:"wham.environmentsSelector.connectGithub",defaultMessage:"Connect GitHub"})]})})})}):s.jsx(ue,{label:i.formatMessage({id:"wham.whamComposerEnvironmentsSelector.disabledByWorkspaceAdmin",defaultMessage:"Disabled by workspace admin"}),children:s.jsxs(he,{type:"button",color:"secondary",onClick:r,disabled:!0,children:[s.jsx(pe,{"aria-hidden":!0,className:"icon-sm me-1.5"}),s.jsx(V,{id:"wham.environmentsSelector.connectGithub",defaultMessage:"Connect GitHub"})]})})}export{Ae as C,Fs as W,ne as a,ws as g};
//# sourceMappingURL=lw2hpe6y5hhfte4k.js.map
