const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jfmxxrawcp8pm844.js","assets/mw35uwhq4g8r9eam.js","assets/nxan4e3brpzak2la.js","assets/d0xa318sl7ywi0za.js","assets/root-kavs8piy.css","assets/i2f5gqqndy3iowkc.js","assets/g2euln7v5pbm31qa.js","assets/conversation-small-lq38g8zw.css","assets/ipoljkkwhes3fgxa.js","assets/jxdumrq8vfk5kk1c.js","assets/ansi-1f6vhsjh.css","assets/oftnd9rlobxeh2e2.js","assets/kx64af29hscb23w7.js","assets/ldtpmsnzn9ens47o.js","assets/ohau9tqj1fpdibg0.js","assets/iknugp00locgtve5.js","assets/h1em0bjkpkjv8ykw.js","assets/cv4afpu20gjb9dll.js","assets/h4yh1661qhhbu5v5.js","assets/hu1bt0oauegdhua6.js","assets/baz4b8nlf8t2lb95.js","assets/brzhn6w36e0ait35.js","assets/lptwpbjabrvjmhsj.js","assets/gkerdwj307fj3n4u.js","assets/h9z1eo55yfy9l6t8.js","assets/ee6pijsbu8dfevmi.js","assets/k6k3ilbqdb73kxkm.js","assets/dxkl0433k1u8ypnz.js","assets/ox7635ffwodpca7w.js","assets/nr9k12yditsrjrdm.js","assets/eder15khh2fy5wd2.js","assets/krfycj1ruc6rihlj.js","assets/lgfmpb0my7e1aj31.js","assets/wham-task-push-diff-dropdown-e50ctjec.css","assets/c8dilzb1umlthpuq.js","assets/mlgj7gsfvuk1e8bn.js","assets/hdw58d7g4tx8n6s4.js","assets/cmsg2ikilns8l0ug.js","assets/c5k9gv36gzuxi0am.js","assets/lw2hpe6y5hhfte4k.js","assets/ksb30nvrqfrocrgu.js","assets/h38m9m9rf2db1qpt.js","assets/mpk4drhv3szxuvkj.js","assets/fljft0gbsnm1ovqa.js","assets/k527f0oyvlppyfoy.js","assets/m4z0737cb20mwzwc.js","assets/ddina39kz3r81pp7.js","assets/w3hi9hzc7twqpn11.js","assets/ga8rhh96wttk8d8h.js","assets/f89v9mtyvakgmoul.js","assets/f3alhksm9dfhscbq.js"])))=>i.map(i=>d[i]);
var Rt=Object.defineProperty,Dt=Object.defineProperties;var Et=Object.getOwnPropertyDescriptors;var et=Object.getOwnPropertySymbols;var Ot=Object.prototype.hasOwnProperty,Bt=Object.prototype.propertyIsEnumerable;var tt=(t,e,o)=>e in t?Rt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,Me=(t,e)=>{for(var o in e||(e={}))Ot.call(e,o)&&tt(t,o,e[o]);if(et)for(var o of et(e))Bt.call(e,o)&&tt(t,o,e[o]);return t},Ce=(t,e)=>Dt(t,Et(e));import{r as g,j as s,c as Oe,h as ge,M as de,_ as mt,d as Je,n as ft,i as ye,b as Wt,u as Be}from"./mw35uwhq4g8r9eam.js";import{fj as ht,cF as we,er as qt,eu as Ht,aA as xe,bD as Ut,be as gt,iZ as Qt,aL as at,e5 as ve,ek as pt,aB as $t,u as wt,p as ke,f5 as Tt,lA as Kt,J as Ie,vU as Gt,f2 as Vt,R as Ze,cy as We,e7 as xt,xX as zt,cA as Yt,cw as _t,es as Xt,au as Jt,pj as Zt,h5 as At}from"./d0xa318sl7ywi0za.js";import{b9 as ea,hr as ta,b4 as Re,b5 as Ge,bf as aa,ba as sa,dt as oa,X as Ve,aB as ia,iv as ra,iw as na,U as st,ag as la,ah as ca,aC as Ue,aG as da,nO as ua,vv as ot,vw as it,y$ as ma,z0 as fa,kZ as ha,eG as ga}from"./g2euln7v5pbm31qa.js";import{M as Qe,a as ze,W as pa,D as wa,f as xa,P as _a,p as Le,b as ba,c as rt,d as va}from"./nxan4e3brpzak2la.js";import{_ as Pe,m as bt,s as ya,$ as ka,v as Ma,g as pe,j as De,a0 as Se,k as Ca,B as ja,b as Pa}from"./ldtpmsnzn9ens47o.js";import{u as Sa}from"./c8dilzb1umlthpuq.js";import{T as vt,a as yt,b as kt}from"./nr9k12yditsrjrdm.js";import{u as Mt}from"./mlgj7gsfvuk1e8bn.js";import{W as Ee}from"./hdw58d7g4tx8n6s4.js";import{S as Na}from"./cmsg2ikilns8l0ug.js";import{JsonViewer as La}from"./gkerdwj307fj3n4u.js";import{i as Fa,W as Ia}from"./c5k9gv36gzuxi0am.js";import{u as Ra,g as Da,N as Ea}from"./m4z0737cb20mwzwc.js";import{W as nt,O as Oa}from"./ga8rhh96wttk8d8h.js";import{s as $e}from"./krfycj1ruc6rihlj.js";import{W as he,a as Ye,w as Xe}from"./baz4b8nlf8t2lb95.js";import{S as Ba}from"./f89v9mtyvakgmoul.js";import{s as Fe,B as Wa}from"./f3alhksm9dfhscbq.js";import{W as qa}from"./kx64af29hscb23w7.js";const Ct=g.createContext(null);function Qs({value:t,children:e}){return s.jsx(Ct.Provider,{value:t,children:e})}function Ne(){const t=g.useContext(Ct);if(!t)throw new Error("useWhamTaskPageContext must be used within its provider");return t}function Ha(t){var c,d;const e={},o={};let a;for(const l of t)Pe(l)?l.previous_turn_id?o[l.previous_turn_id]=l:a=l:l.previous_turn_id&&((d=e[c=l.previous_turn_id])!=null?d:e[c]=[]).push(l);if(!a)return null;const r=l=>{var n;const u=(n=e[l.id])!=null?n:[],i={};for(const m of u){const v=o[m.id];v&&(i[m.id]=r(v))}return{userTurn:l,assistantTurns:u,children:i}};return r(a)}function Ua(t){for(let e=t.length-1;e>=0;e--){const o=t[e];if(Pe(o)&&o.previous_turn_id)return o.previous_turn_id}return null}function Qa(t,e){var r,c,d,l;if(!t)return[];const o=[];if(e){const u=n=>{for(const m of n.assistantTurns){if(m.id===e)return[{node:n,activeId:m.id}];const v=n.children[m.id],b=v&&u(v);if(b)return[{node:n,activeId:m.id},...b]}return null},i=u(t);i&&o.push(...i)}o.length===0&&o.push({node:t,activeId:(c=(r=t.assistantTurns[0])==null?void 0:r.id)!=null?c:null});let a=o[o.length-1];for(;a!=null&&a.activeId;){const u=a.node.children[a.activeId];if(!u)break;o.push({node:u,activeId:(l=(d=u.assistantTurns[0])==null?void 0:d.id)!=null?l:null}),a=o[o.length-1]}return o}function $a(t){return t==null?void 0:t.assistantTurns.some(e=>bt(e.turn_status))}function Ta(t){"use forget";var J,ee,T,oe,ne,K;const e=Oe.c(31),{className:o,focusedAssistantTurn:a,currentTab:r,permissions:c,task:d,turns:l,containerHeight:u,onClickFile:i,setFocusedAssistantTurnId:n,onTabChange:m,latestTurnRef:v,latestUserMessageRef:b,hasComments:w,clearComments:f,showFullDiff:C,loadingTurnMapping:x,reserveComposerSpace:h}=t,j=h===void 0?!0:h;let q,D;e[0]!==a||e[1]!==n||e[2]!==l?(q=()=>{if(!a){const k=Ua(l);k&&n(k)}},D=[a,l,n],e[0]=a,e[1]=n,e[2]=l,e[3]=q,e[4]=D):(q=e[3],D=e[4]),g.useEffect(q,D);let E;e[5]!==l?(E=Ha(l),e[5]=l,e[6]=E):E=e[6];const _=E;let O;e[7]!==(a==null?void 0:a.id)||e[8]!==_?(O=()=>{var k;return Qa(_,(k=a==null?void 0:a.id)!=null?k:null)},e[7]=a==null?void 0:a.id,e[8]=_,e[9]=O):O=e[9],a==null||a.id;let Y;e[10]!==O?(Y=O(),e[10]=O,e[11]=Y):Y=e[11];const A=Y,I=A.length-1,te=A.slice(0,I);let R,B;e[12]!==A||e[13]!==j?(R=ht(A),B=j&&$a(R==null?void 0:R.node),e[12]=A,e[13]=j,e[14]=R,e[15]=B):(R=e[14],B=e[15]);const ie=B,{data:N}=ya(d==null?void 0:d.id);N==null||N.current_assistant_turn;let U;e:{if(!x||!(N!=null&&N.current_assistant_turn)){U=null;break e}const k=N.current_assistant_turn,Q=((ee=(J=k.sibling_turn_ids)==null?void 0:J.length)!=null?ee:0)+1,G=(T=k.attempt_placement)!=null?T:0;let ae;if(e[16]!==Q||e[17]!==((oe=k.debug_metadata)==null?void 0:oe.shadow_turn_control_for)||e[18]!==k.id||e[19]!==G){let V;e[21]!==k.id||e[22]!==G?(V=(L,z)=>z===G?k.id:"placeholder-".concat(z),e[21]=k.id,e[22]=G,e[23]=V):V=e[23];const M=Array.from({length:Q},V),P={};M.forEach((L,z)=>P[L]=z),ae={attemptIds:M,idToIdxMap:P},e[16]=Q,e[17]=(ne=k.debug_metadata)==null?void 0:ne.shadow_turn_control_for,e[18]=k.id,e[19]=G,e[20]=ae}else ae=e[20];U=ae}const F=U;let H;e[24]!==o?(H=we("relative flex h-full w-full flex-col",o),e[24]=o,e[25]=H):H=e[25];const se="flex h-fit min-h-full shrink-0 flex-col gap-6 pt-6 text-sm",re=x&&d&&(N!=null&&N.current_user_turn)&&(N!=null&&N.current_assistant_turn)?s.jsxs("div",{ref:v,className:we("flex min-h-full shrink-0 flex-col gap-6",ie&&"pb-36"),style:{minHeight:u-24},children:[s.jsx("div",{className:"text-token-text-secondary flex w-full items-center justify-center gap-2",children:s.jsx(qt,{className:"text-xl"})}),s.jsx(Qe,{isLatest:!0,task:d,userTurn:N.current_user_turn,assistantTurns:[N.current_assistant_turn],selectedAssistantId:N.current_assistant_turn.id,focusedAssistantTurn:N.current_assistant_turn,setFocusedAssistantTurnId:n,onClickFile:i,currentTab:r,onTabChange:m,permissions:c,startOpen:!0,hasComments:w,clearComments:f,showFullDiff:C,attemptIdsOverride:F==null?void 0:F.attemptIds,idToIndexMapOverride:F==null?void 0:F.idToIdxMap,latestUserMessageRef:b})]}):s.jsxs(s.Fragment,{children:[te.length>0&&s.jsx("div",{className:"flex flex-col gap-6",children:te.map((k,Q)=>{const{node:G,activeId:ae}=k;return s.jsx(Qe,{isLatest:Q===I,task:d,userTurn:G.userTurn,assistantTurns:G.assistantTurns,selectedAssistantId:ae,focusedAssistantTurn:a,setFocusedAssistantTurnId:n,onClickFile:i,startOpen:Q===I,currentTab:r,onTabChange:m,permissions:c,hasComments:w,clearComments:f,showFullDiff:C},G.userTurn.id)})}),R&&s.jsx("div",{ref:v,className:we("flex min-h-full shrink-0 flex-col gap-6",ie&&"pb-36"),style:{minHeight:u-24},children:s.jsx(Qe,{isLatest:!0,task:d,userTurn:R.node.userTurn,assistantTurns:R.node.assistantTurns,selectedAssistantId:(K=a==null?void 0:a.id)!=null?K:null,focusedAssistantTurn:a,setFocusedAssistantTurnId:n,onClickFile:i,currentTab:r,onTabChange:m,permissions:c,startOpen:!0,hasComments:w,clearComments:f,showFullDiff:C,latestUserMessageRef:b})})]});let X;e[26]!==re?(X=s.jsx("div",{className:se,children:re}),e[26]=re,e[27]=X):X=e[27];let $;return e[28]!==X||e[29]!==H?($=s.jsx("div",{className:H,children:X}),e[28]=X,e[29]=H,e[30]=$):$=e[30],$}const jt=g.createContext(null);function $s({value:t,children:e}){return s.jsx(jt.Provider,{value:t,children:e})}function Ae(){const t=g.useContext(jt);if(!t)throw new Error("useTaskComments must be used within a TaskCommentsProvider");return t}function Ka({currentTab:t,permissions:e,onClickFile:o,onTabChange:a,showFullDiff:r,loadingTurnMapping:c,footer:d}){const{task:l,focusedAssistantTurn:u,pastTurns:i,setFocusedAssistantTurnId:n}=Ne(),{comments:m,clearComments:v}=Ae(),[{height:b},w]=Sa(),f=g.useRef(null),C=g.useRef(null),x=g.useRef(null);return Ht(()=>{const h=f.current,j=x.current;!h||!j||!h.contains(j)||j.scrollIntoView({block:"start",behavior:"auto"})},[i.length,c]),s.jsx("div",{ref:ea(w,f),className:"flex h-full w-full scroll-pt-3 flex-col items-center overflow-y-auto px-6",children:s.jsxs("div",{className:we("@container w-full",ze),children:[s.jsx(Ta,{focusedAssistantTurn:u,currentTab:t,permissions:e,task:l,turns:i,containerHeight:b,onClickFile:o,setFocusedAssistantTurnId:n,onTabChange:a,latestTurnRef:C,latestUserMessageRef:x,hasComments:m.length>0,clearComments:v,showFullDiff:r,loadingTurnMapping:c,reserveComposerSpace:d!=null}),d&&s.jsx("div",{className:"keyboard-open:fixed absolute start-0 end-0 bottom-0",children:d})]})})}function Ga(t){"use forget";const e=Oe.c(10),{onRetry:o,isRetrying:a}=t,r=ge();let c;e[0]!==r?(c=r.formatMessage({id:"wham.whamPreviewImageCarousel.retryAriaLabel",defaultMessage:"Retry loading preview images"}),e[0]=r,e[1]=c):c=e[1];const d=c;let l;e[2]===Symbol.for("react.memo_cache_sentinel")?(l=s.jsx("div",{className:"bg-token-bg-tertiary text-token-text-tertiary rounded-full p-3",children:s.jsx(Na,{className:"icon-lg"})}),e[2]=l):l=e[2];let u;e[3]===Symbol.for("react.memo_cache_sentinel")?(u=s.jsx("p",{className:"text-token-text-primary text-base font-medium",children:s.jsx(de,{id:"wham.whamPreviewImageCarousel.errorTitle",defaultMessage:"Preview unavailable"})}),e[3]=u):u=e[3];let i;e[4]===Symbol.for("react.memo_cache_sentinel")?(i=s.jsxs("div",{className:"flex flex-col gap-2",children:[u,s.jsx("p",{className:"text-token-text-secondary text-sm",children:s.jsx(de,{id:"wham.whamPreviewImageCarousel.errorSubtitle",defaultMessage:"We couldn't load the preview images. Please try again."})})]}),e[4]=i):i=e[4];let n;e[5]===Symbol.for("react.memo_cache_sentinel")?(n=s.jsx(de,{id:"wham.whamPreviewImageCarousel.retry",defaultMessage:"Retry"}),e[5]=n):n=e[5];let m;return e[6]!==a||e[7]!==o||e[8]!==d?(m=s.jsxs("div",{className:"flex h-full w-full flex-col items-center justify-center gap-4 px-6 text-center",children:[l,i,s.jsx(xe,{color:"secondary",onClick:o,loading:a,label:d,className:"mt-1",children:n})]}),e[6]=a,e[7]=o,e[8]=d,e[9]=m):m=e[9],m}function Va({previewImages:t}){"use no forget";var x;const e=ge(),o=ta(t.map(h=>{var j,q,D,E;return{content_type:Ut.ImageAssetPointer,asset_pointer:(j=h.asset_pointer)!=null?j:"",size_bytes:(q=h.size_bytes)!=null?q:0,width:(D=h.width)!=null?D:0,height:(E=h.height)!=null?E:0}})),a=g.useMemo(()=>o.filter(h=>h.data),[o]),r=a.length>0,c=g.useMemo(()=>o.some(h=>h.isError),[o]),d=g.useMemo(()=>o.some(h=>h.isFetching),[o]),[l,u]=g.useState(0),[i,n]=g.useState(!1),m=Math.min(Math.max(l,0),Math.max(a.length-1,0)),v=g.useCallback(()=>{a.length<=1||(u(h=>(h-1+a.length)%a.length),Ee.recordPreviewImagesCarouselPrev())},[a.length]),b=g.useCallback(()=>{a.length<=1||(u(h=>(h+1)%a.length),Ee.recordPreviewImagesCarouselNext())},[a.length]),w=g.useCallback(async()=>{n(!0);try{await Promise.all(o.map(h=>h.refetch({throwOnError:!1})))}finally{n(!1)}},[o]);Mt([{key:"previewCarouselPrev",action:v,actionMessageDescriptor:e.formatMessage({id:"wham.keyboardActions.previousPreviewImage",defaultMessage:"Select previous image"}),group:Ge.Chat,keyboardBinding:[Re.ArrowLeft],enabled:a.length>1},{key:"previewCarouselNext",action:b,actionMessageDescriptor:e.formatMessage({id:"wham.keyboardActions.nextPreviewImage",defaultMessage:"Select next image"}),group:Ge.Chat,keyboardBinding:[Re.ArrowRight],enabled:a.length>1}]);const f=(x=a[m])==null?void 0:x.data,C=!r&&c&&!d;return s.jsxs("div",{className:"relative flex h-full w-full items-center justify-center overflow-hidden p-4",children:[C?s.jsx(Ga,{isRetrying:i,onRetry:()=>{w()}}):f?s.jsx("div",{className:"flex h-full w-full items-start justify-center overflow-auto",children:s.jsx("img",{src:f.url,width:f.width,height:f.height,alt:e.formatMessage({id:"wham.whamTaskPageContentLoaded.previewImageAlt",defaultMessage:"Generated image"}),className:"h-auto max-w-full"},m)}):s.jsx("div",{className:"text-secondary flex h-full w-full items-center justify-center text-sm",children:s.jsx(de,{id:"wham.whamPreviewImageCarousel.loading",defaultMessage:"Loading preview…"})}),a.length>1&&s.jsxs(s.Fragment,{children:[s.jsx("button",{type:"button","aria-label":e.formatMessage({id:"wham.whamPreviewImageCarousel.prev",defaultMessage:"Previous image"}),onClick:v,className:"absolute start-2 top-1/2 -translate-y-1/2 rounded-md bg-black/40 px-2 py-1 text-white hover:bg-black/60 focus:ring-2 focus:ring-white/70 focus:outline-none",children:"‹"}),s.jsx("button",{type:"button","aria-label":e.formatMessage({id:"wham.whamPreviewImageCarousel.next",defaultMessage:"Next image"}),onClick:b,className:"absolute end-2 top-1/2 -translate-y-1/2 rounded-md bg-black/40 px-2 py-1 text-white hover:bg-black/60 focus:ring-2 focus:ring-white/70 focus:outline-none",children:"›"}),s.jsxs("div",{className:"pointer-events-none absolute start-1/2 bottom-2 -translate-x-1/2 rounded-md bg-black/40 px-2 py-0.5 text-xs text-white",children:[m+1," / ",a.length]})]})]})}function za(t){"use forget";const e=Oe.c(78),{task:o,userTurn:a,assistantTurn:r,rollout:c}=t,d=ge();let l;e[0]!==r||e[1]!==c||e[2]!==o||e[3]!==a?(l=()=>o?"task":a?"user_turn":r?"assistant_turn":c?"rollout":"task",e[0]=r,e[1]=c,e[2]=o,e[3]=a,e[4]=l):l=e[4];const u=l,[i,n]=g.useState(u);let m;e[5]!==d?(m=d.formatMessage({id:"wham.whamTaskPageContentLoaded.internalDataModels.noData",defaultMessage:"No data available for this view."}),e[5]=d,e[6]=m):m=e[6];const v=m;let b;e[7]!==d?(b=d.formatMessage({id:"wham.whamTaskPageContentLoaded.internalDataModels.noDataTooltip",defaultMessage:"No data available for this tab"}),e[7]=d,e[8]=b):b=e[8];const w=b;let f;e[9]!==v?(f=(le,y)=>le?s.jsx("div",{className:"flex h-full w-full overflow-auto p-4",children:s.jsx(La,{json:le,jsonFiltersKey:y,jsonViewProps:{collapsed:5}})}):s.jsx("div",{className:"text-token-text-tertiary flex h-full w-full items-center justify-center p-4 text-sm",children:v}),e[9]=v,e[10]=f):f=e[10];const C=f,x=!!o,h=!!a,j=!!r,q=!!c;let D;e[11]!==x||e[12]!==h||e[13]!==j||e[14]!==q?(D={task:x,user_turn:h,assistant_turn:j,rollout:q},e[11]=x,e[12]=h,e[13]=j,e[14]=q,e[15]=D):D=e[15];const E=D;let _;e[16]!==d?(_=d.formatMessage({id:"wham.whamTaskPageContentLoaded.internalDataModels.task",defaultMessage:"Task"}),e[16]=d,e[17]=_):_=e[17];let O;e[18]!==d?(O=d.formatMessage({id:"wham.whamTaskPageContentLoaded.internalDataModels.taskAriaLabel",defaultMessage:"Tab to view the task object"}),e[18]=d,e[19]=O):O=e[19];const Y=o?void 0:w,A=o;let I;e[20]!==C||e[21]!==A?(I=C(A,"internal-data-task"),e[20]=C,e[21]=A,e[22]=I):I=e[22];let te;e[23]!==_||e[24]!==O||e[25]!==Y||e[26]!==I?(te={key:"task",label:_,ariaLabel:O,tooltip:Y,children:I},e[23]=_,e[24]=O,e[25]=Y,e[26]=I,e[27]=te):te=e[27];let R;e[28]!==d?(R=d.formatMessage({id:"wham.whamTaskPageContentLoaded.internalDataModels.userTurn",defaultMessage:"User Turn"}),e[28]=d,e[29]=R):R=e[29];let B;e[30]!==d?(B=d.formatMessage({id:"wham.whamTaskPageContentLoaded.internalDataModels.userTurnAriaLabel",defaultMessage:"Tab to view the user turn object"}),e[30]=d,e[31]=B):B=e[31];const ie=a?void 0:w,N=a;let U;e[32]!==C||e[33]!==N?(U=C(N,"internal-data-user-turn"),e[32]=C,e[33]=N,e[34]=U):U=e[34];let F;e[35]!==R||e[36]!==B||e[37]!==ie||e[38]!==U?(F={key:"user_turn",label:R,ariaLabel:B,tooltip:ie,children:U},e[35]=R,e[36]=B,e[37]=ie,e[38]=U,e[39]=F):F=e[39];let H;e[40]!==d?(H=d.formatMessage({id:"wham.whamTaskPageContentLoaded.internalDataModels.assistantTurn",defaultMessage:"Assistant Turn"}),e[40]=d,e[41]=H):H=e[41];let se;e[42]!==d?(se=d.formatMessage({id:"wham.whamTaskPageContentLoaded.internalDataModels.assistantTurnAriaLabel",defaultMessage:"Tab to view the assistant turn object"}),e[42]=d,e[43]=se):se=e[43];const re=r?void 0:w,X=r;let $;e[44]!==C||e[45]!==X?($=C(X,"internal-data-assistant-turn"),e[44]=C,e[45]=X,e[46]=$):$=e[46];let J;e[47]!==H||e[48]!==se||e[49]!==re||e[50]!==$?(J={key:"assistant_turn",label:H,ariaLabel:se,tooltip:re,children:$},e[47]=H,e[48]=se,e[49]=re,e[50]=$,e[51]=J):J=e[51];let ee;e[52]!==d?(ee=d.formatMessage({id:"wham.whamTaskPageContentLoaded.internalDataModels.rollout",defaultMessage:"Rollout"}),e[52]=d,e[53]=ee):ee=e[53];let T;e[54]!==d?(T=d.formatMessage({id:"wham.whamTaskPageContentLoaded.internalDataModels.rolloutAriaLabel",defaultMessage:"Tab to view the rollout data"}),e[54]=d,e[55]=T):T=e[55];const oe=c?void 0:w,ne=c;let K;e[56]!==C||e[57]!==ne?(K=C(ne,"internal-data-rollout"),e[56]=C,e[57]=ne,e[58]=K):K=e[58];let k;e[59]!==ee||e[60]!==T||e[61]!==oe||e[62]!==K?(k={key:"rollout",label:ee,ariaLabel:T,tooltip:oe,children:K},e[59]=ee,e[60]=T,e[61]=oe,e[62]=K,e[63]=k):k=e[63];let Q;e[64]!==te||e[65]!==F||e[66]!==J||e[67]!==k?(Q=[te,F,J,k],e[64]=te,e[65]=F,e[66]=J,e[67]=k,e[68]=Q):Q=e[68];const ae=Q;let V,M;e[69]!==i||e[70]!==E?(V=()=>{var y;if(E[i])return;const le=(y=Object.entries(E).find(Xa))==null?void 0:y[0];le&&n(le)},M=[i,E],e[69]=i,e[70]=E,e[71]=V,e[72]=M):(V=e[71],M=e[72]),g.useEffect(V,M);let P,L;e[73]===Symbol.for("react.memo_cache_sentinel")?(P=s.jsx(vt,{className:"border-token-border-heavy border-b px-3",buttonClassName:"pb-2 pt-2"}),L=s.jsx(yt,{children:Ya}),e[73]=P,e[74]=L):(P=e[73],L=e[74]);let z;return e[75]!==i||e[76]!==ae?(z=s.jsx("div",{className:"flex h-full w-full flex-col",children:s.jsxs(kt,{tabs:ae,currentTab:i,onChange:n,withUnderline:!0,children:[P,L]})}),e[75]=i,e[76]=ae,e[77]=z):z=e[77],z}function Ya(t){const{content:e}=t;return s.jsx("div",{className:"flex h-full w-full",children:e})}function Xa(t){const[,e]=t;return e}const Pt=gt(()=>mt(()=>import("./jfmxxrawcp8pm844.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50])).then(t=>t.WhamTaskPageCodeDiffContent),{loading:()=>s.jsx("div",{className:"flex-1"})});function Ja(t){"use forget";var Z,ce;const e=Oe.c(95),{currentTab:o,setCurrentTab:a,defaultTab:r,isMobile:c,hasDiff:d,previewImages:l,diffFiles:u,unifiedDiff:i,handleDiffModeChange:n,showFullDiff:m,setShowFullDiff:v,isPreferencesLoading:b,isSharedExampleTask:w,focusedAssistantTurn:f,leftContent:C}=t,{taskId:x,task:h,canFollowUp:j,pastTurns:q}=Ne(),{comments:D,setComments:E}=Ae(),_=ge();let O;e[0]!==b?(O=[b],e[0]=b,e[1]=O):O=e[1],g.useEffect(es,O);let Y;if(e[2]!==f||e[3]!==q){e:{if(!f){Y=null;break e}const p=q!=null?q:[];let S;e[5]!==f?(S=W=>W.id===f.id,e[5]=f,e[6]=S):S=e[6];const ue=p.findIndex(S);if(ue>0)for(let W=ue-1;W>=0;W=W-1,W){const fe=p[W];if(Pe(fe)){Y=fe;break e}}if(f.previous_turn_id){let W;e[7]!==f.previous_turn_id?(W=be=>Pe(be)&&be.id===f.previous_turn_id,e[7]=f.previous_turn_id,e[8]=W):W=e[8];const fe=p.find(W);if(fe){Y=fe;break e}}const me=[...p].reverse().find(Aa);Y=me!=null?me:null}e[2]=f,e[3]=q,e[4]=Y}else Y=e[4];const A=Y,I=(Z=f==null?void 0:f.id)!=null?Z:x,te=!c;let R;e[9]!==_?(R=_.formatMessage({id:"wham.whamTaskPageContentLoaded.conversation",defaultMessage:"Conversation"}),e[9]=_,e[10]=R):R=e[10];let B;e[11]!==_?(B=_.formatMessage({id:"wham.whamTaskPageContentLoaded.conversationAriaLabel",defaultMessage:"Tab to view the conversation with the assistant"}),e[11]=_,e[12]=B):B=e[12];let ie;e[13]!==C||e[14]!==te||e[15]!==R||e[16]!==B?(ie={key:"chat",isHidden:te,label:R,ariaLabel:B,children:C},e[13]=C,e[14]=te,e[15]=R,e[16]=B,e[17]=ie):ie=e[17];const N=l.length===0;let U;e[18]!==_?(U=_.formatMessage({id:"wham.whamTaskPageContentLoaded.preview",defaultMessage:"Preview"}),e[18]=_,e[19]=U):U=e[19];let F;e[20]!==_?(F=_.formatMessage({id:"wham.whamTaskPageContentLoaded.previewAriaLabel",defaultMessage:"Tab to view preview images"}),e[20]=_,e[21]=F):F=e[21];let H;e[22]!==l?(H=s.jsx(Va,{previewImages:l}),e[22]=l,e[23]=H):H=e[23];let se;e[24]!==F||e[25]!==H||e[26]!==N||e[27]!==U?(se={key:"preview",isHidden:N,label:U,ariaLabel:F,children:H},e[24]=F,e[25]=H,e[26]=N,e[27]=U,e[28]=se):se=e[28];const re=!d;let X;e[29]!==_?(X=_.formatMessage({id:"wham.whamTaskPageContentLoaded.diff",defaultMessage:"Diff"}),e[29]=_,e[30]=X):X=e[30];let $;e[31]!==_?($=_.formatMessage({id:"wham.whamTaskPageContentLoaded.diffAriaLabel",defaultMessage:"Tab to view the code diff"}),e[31]=_,e[32]=$):$=e[32];let J;e[33]!==j||e[34]!==D||e[35]!==u||e[36]!==d||e[37]!==b||e[38]!==E||e[39]!==i?(J=!b&&d&&s.jsx(Pt,{diffFiles:u,unifiedDiff:i,enableComments:j,comments:D,setComments:E}),e[33]=j,e[34]=D,e[35]=u,e[36]=d,e[37]=b,e[38]=E,e[39]=i,e[40]=J):J=e[40];let ee;e[41]!==re||e[42]!==X||e[43]!==$||e[44]!==J?(ee={key:"diff",isHidden:re,label:X,ariaLabel:$,children:J},e[41]=re,e[42]=X,e[43]=$,e[44]=J,e[45]=ee):ee=e[45];let T;e[46]!==_?(T=_.formatMessage({id:"wham.whamTaskPageContentLoaded.logs",defaultMessage:"Logs"}),e[46]=_,e[47]=T):T=e[47];let oe;e[48]!==_?(oe=_.formatMessage({id:"wham.whamTaskPageContentLoaded.logsAriaLabel",defaultMessage:"Tab to view the work logs"}),e[48]=_,e[49]=oe):oe=e[49];const ne=(ce=f==null?void 0:f.environment)==null?void 0:ce.agent_network_access;let K;e[50]!==f||e[51]!==ne||e[52]!==x?(K=s.jsx(pa,{taskId:x,focusedAssistantTurn:f,agentNetworkAccess:ne}),e[50]=f,e[51]=ne,e[52]=x,e[53]=K):K=e[53];let k;e[54]!==w||e[55]!==T||e[56]!==oe||e[57]!==K?(k={key:"logs",isHidden:w,label:T,ariaLabel:oe,children:K},e[54]=w,e[55]=T,e[56]=oe,e[57]=K,e[58]=k):k=e[58];let Q;e[59]!==_?(Q=_.formatMessage({id:"wham.whamTaskPageContentLoaded.internalDataModels",defaultMessage:"Internal Data Models"}),e[59]=_,e[60]=Q):Q=e[60];let G;e[61]!==_?(G=_.formatMessage({id:"wham.whamTaskPageContentLoaded.internalDataModelsAriaLabel",defaultMessage:"Tab to view internal data models"}),e[61]=_,e[62]=G):G=e[62];const ae=f==null?void 0:f.internal_only_rollouts;let V;e[63]!==f||e[64]!==ae||e[65]!==h||e[66]!==A?(V=s.jsx(za,{task:h,userTurn:A,assistantTurn:f,rollout:ae}),e[63]=f,e[64]=ae,e[65]=h,e[66]=A,e[67]=V):V=e[67];let M;e[68]!==Q||e[69]!==G||e[70]!==V?(M={key:"internal_data_models",isHidden:!0,label:Q,ariaLabel:G,children:V},e[68]=Q,e[69]=G,e[70]=V,e[71]=M):M=e[71];let P;e[72]!==se||e[73]!==ee||e[74]!==k||e[75]!==M||e[76]!==ie?(P=[ie,se,ee,k,M],e[72]=se,e[73]=ee,e[74]=k,e[75]=M,e[76]=ie,e[77]=P):P=e[77];let L;e[78]!==n||e[79]!==d||e[80]!==v||e[81]!==m||e[82]!==i?(L=d&&s.jsx(wa,{unifiedDiff:i,setUnifiedDiff:n,showFullDiff:m,setShowFullDiff:v}),e[78]=n,e[79]=d,e[80]=v,e[81]=m,e[82]=i,e[83]=L):L=e[83];let z;e[84]!==c||e[85]!==L?(z=s.jsx(vt,{withUnderline:c,className:"items-center border-b p-3 pe-16 max-md:py-0",children:L}),e[84]=c,e[85]=L,e[86]=z):z=e[86];let le;e[87]===Symbol.for("react.memo_cache_sentinel")?(le=s.jsx(yt,{children:Za}),e[87]=le):le=e[87];let y;return e[88]!==o||e[89]!==r||e[90]!==a||e[91]!==P||e[92]!==I||e[93]!==z?(y=s.jsx("div",{className:"relative flex h-full w-full flex-col",children:s.jsxs(kt,{onChange:a,currentTab:o,defaultTab:r,tabs:P,children:[z,le]},I)}),e[88]=o,e[89]=r,e[90]=a,e[91]=P,e[92]=I,e[93]=z,e[94]=y):y=e[94],y}function Za(t){const{content:e}=t;return s.jsx("div",{className:"flex h-full w-full",children:e})}function Aa(t){return Pe(t)}function es(){Pt.prefetch()}const lt="oai/apps/wham-task-page-content-left-width",ct=672,Te=400,ts=({leftContent:t,rightContent:e=null})=>{const[o,a]=g.useState(()=>Qt(at.DANGER_SECRET_FOLDERS_ONLY_getItem(lt),400)),r=aa(o,Te,ct);g.useEffect(()=>{const i=setTimeout(()=>{at.DANGER_SECRET_FOLDERS_ONLY_setItem(lt,r)},500);return()=>clearTimeout(i)},[r]);const c=g.useRef(null);c.current=()=>{e&&a(r)};const d=g.useCallback(()=>{var i;return(i=c.current)==null?void 0:i.call(c)},[]),[l,u]=g.useState(!1);return s.jsxs("div",{className:"flex h-full min-h-0 w-full",children:[s.jsxs(ve.div,{className:"relative h-full shrink-0",animate:{width:e?r:"100%"},initial:!1,transition:{type:"tween",duration:l?0:.14,ease:"easeOut"},children:[s.jsx(ve.div,{className:"flex h-full w-full flex-col items-center",transition:{type:"tween",duration:l?0:.14,ease:"easeOut"},animate:{width:e?r:"100%"},children:s.jsx("div",{className:"flex h-full flex-col",style:{width:e?r:"100%"},children:t})}),e&&s.jsx(ve.div,{drag:"x",className:we("absolute end-[-1px] top-0 bottom-0 z-10 w-[1px] cursor-ew-resize after:absolute after:inset-0 after:-inset-x-2 after:content-['']",l?"bg-token-text-primary":"bg-token-border-light hover:bg-token-text-primary dark:bg-token-border-heavy transition-colors delay-0 hover:delay-300"),whileDrag:{width:"2px",end:"-1px"},transition:{type:"tween",duration:0},initial:!1,style:{x:0,y:0},dragMomentum:!1,dragElastic:!1,dragConstraints:{left:0,right:0,top:0,bottom:0},onDragStart:()=>u(!0),onDrag:(i,{delta:{x:n}})=>a(m=>m+n),onDragEnd:()=>{u(!1),d()},onDoubleClick:()=>a(r===Te?ct:Te)})]}),s.jsx(pt,{children:e&&s.jsx(ve.div,{className:"flex h-full min-w-0 flex-1",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:l?0:.04,ease:"easeOut",delay:.1},children:e})})]})};function St(t){const{outputDiffs:e}=qe(t==null?void 0:t.output_items);return{filesModified:$e(e,o=>{var a;return(a=o.files_modified)!=null?a:0}),linesAdded:$e(e,o=>{var a;return(a=o.lines_added)!=null?a:0}),linesRemoved:$e(e,o=>{var a;return(a=o.lines_removed)!=null?a:0})}}function qe(t){let e=!1;return t?{outputDiffs:t.map(a=>{switch(a.type){case"output_diff":return a;case"pr":return e=!!a.pre_apply_patch,a.output_diff;case"cr":return a.reviewed_diff;default:return null}}).filter(a=>a!=null),hasPreApplyPatch:e}:{outputDiffs:[],hasPreApplyPatch:e}}function as({isOpen:t,onConfirm:e,onClose:o,loading:a}){return s.jsx($t,{isOpen:t,onClose:o,testId:"modal-wham-retry-all-turns",type:"warning",title:s.jsx("p",{className:"text-token-text-primary font-semibold",children:s.jsx(de,{id:"wham.retryAllTurnsModal.title",defaultMessage:"Retry all turns"})}),primaryButton:s.jsx(xe,{color:"primary",loading:a,onClick:e,children:s.jsx(de,{id:"wham.retryAllTurnsModal.confirm",defaultMessage:"Retry all turns"})}),secondaryButton:s.jsx(xe,{color:"secondary",onClick:o,children:s.jsx(de,{id:"wham.retryAllTurnsModal.cancel",defaultMessage:"Cancel"})}),children:s.jsx("div",{className:"text-sm",children:s.jsx(de,{id:"wham.retryAllTurnsModal.message",defaultMessage:"All latest turns will restart, including any siblings turns that are in progress or completed."})})})}function ss({focusedAssistantTurn:t,lastTurn:e,siblings:o}){const a=(e==null?void 0:e.type)==="assistant"?e.turn_status:"completed";return t&&((e==null?void 0:e.id)===t.id||o.some(c=>c.id===(e==null?void 0:e.id)))?t.turn_status:a}function os({turnId:t,comments:e,clearComments:o,lastTurn:a,focusedAssistantTurn:r,retry:c,attemptIndex:d,siblings:l}){var ne,K,k,Q,G,ae,V;const u=wt(),{taskId:i,task:n,setFocusedAssistantTurnId:m}=Ne(),v=Je(),b=ge(),w=ke(),f=Tt(),C=Kt(),x=Fa(u),h=M=>{Gt(Vt(C)),o(),m(M.turn.id)},j=async()=>{var M,P;if(c){Y(!0);try{if(c.previousTurnId){const L=await he.createFollowUpTask(i,c.previousTurnId,c.prompt,(M=c.comments)!=null?M:[],!1,B?(P=c.bestOfN)!=null?P:1:void 0,x?c.attachments:[]);h(L)}else{const L=await he.createNewTask(c.environmentId,c.branch,c.prompt,!1,B?c.bestOfN:void 0,x?c.attachments:[]);v("/codex/tasks/".concat(L.task.id))}I(!1)}catch(L){L instanceof Ye?Xe(L,t,b,w):w.danger(ft({id:"wham.whamTaskPageFooter.errorRetryingTask",defaultMessage:"Error retrying task"}),{toastId:"wham_task_page_footer_error_retrying_task"})}finally{Y(!1)}}},q=!!r&&qe(r.output_items).outputDiffs.length>0,D=!a||!r||a.id===(r==null?void 0:r.id)||!q,E=c&&D&&(r==null?void 0:r.turn_status)==="failed",_=(r==null?void 0:r.previous_turn_id)&&(a==null?void 0:a.type)==="assistant"&&r.previous_turn_id===a.previous_turn_id,[O,Y]=g.useState(!1),[A,I]=g.useState(!1),te=Ie(u,"1406552515"),R=Ie(u,"879591222")||void 0,B=Ie(u,"3492040717"),ie=g.useMemo(()=>{var L,z,le,y,Z,ce,p;const M=[...(le=(z=(L=r==null?void 0:r.output_items)==null?void 0:L.find(S=>S.type==="review"))==null?void 0:z.suggested_followup_tasks)!=null?le:[],...(Z=(y=r==null?void 0:r.output_items)==null?void 0:y.filter(S=>S.type==="suggested_task"))!=null?Z:[]],P=xa((p=(ce=r==null?void 0:r.child_turns)==null?void 0:ce.filter(S=>S.source.type==="suggested_task"))==null?void 0:p.map(S=>[S.source.suggested_task_id,S]));return M.map(S=>{var ue,me,W,fe;return{suggestion:S,userTurnId:S.id&&(me=(ue=P[S.id])==null?void 0:ue.assistant_turn_id)!=null?me:null,assistantTurnId:S.id&&(fe=(W=P[S.id])==null?void 0:W.user_turn_id)!=null?fe:null}})},[r]),N=(ne=r==null?void 0:r.id)!=null?ne:t,U=g.useMemo(()=>{var M,P;return(P=(M=r==null?void 0:r.output_items)==null?void 0:M.filter(ka))!=null?P:[]},[r]),F=g.useMemo(()=>U.reduce((M,P)=>M+P.comments.filter(L=>L.priority===0||L.priority===1).length,0),[U]),H=((k=(K=n==null?void 0:n.task_status_display)==null?void 0:K.latest_turn_status_display)==null?void 0:k.intent)==="cr",se=(D||_)&&U.length>0,re=Ra({taskId:i,latestTurnId:N}),X=re.isPending||!N||F===0||te,$=ss({focusedAssistantTurn:r,lastTurn:a,siblings:l}),J=(Q=l==null?void 0:l.map(M=>M.turn_status))!=null?Q:[],ee=(G=l==null?void 0:l.map(M=>{var P;return(P=M.cancellation_requested_at)!=null?P:null}))!=null?G:[],T=(a==null?void 0:a.type)==="assistant"?a:null;return T&&["pending","in_progress"].includes(T.turn_status)&&!Ma(T)&&!R?null:s.jsxs(s.Fragment,{children:[s.jsxs("div",{id:"wham-message-modal-footer",className:"z-50 flex w-full justify-center",children:[(D||_)&&s.jsx("div",{className:"flex w-full justify-center px-4",children:s.jsx("div",{className:we("relative z-1 flex w-full flex-col pt-2 pb-4",ze),children:E?s.jsx(xe,{className:"w-full",color:"primary",size:"large",loading:O&&!A,onClick:()=>{var M;((M=c==null?void 0:c.bestOfN)!=null?M:1)>1?I(!0):j()},children:((ae=c.bestOfN)!=null?ae:1)>1?b.formatMessage({id:"wham.whamTaskPageFooter.retryAllTurns",defaultMessage:"Retry all turns"}):b.formatMessage({id:"wham.whamTaskPageFooter.retry",defaultMessage:"Retry"})}):se?s.jsxs("div",{className:"flex w-full flex-col gap-3",children:[s.jsx(nt,{}),s.jsx(xe,{className:"w-full",color:"primary",size:"large",disabled:X,loading:re.isPending,onClick:()=>{X||re.mutateAsync(void 0)},children:s.jsx(de,{id:"wham.whamTaskPageFooter.fixIssues",defaultMessage:"{count, plural, one {Fix issue} other {Fix issues}}",values:{count:F}})})]}):o&&!H&&s.jsxs("div",{className:"flex w-full flex-col gap-3",children:[s.jsx(nt,{}),!te&&s.jsx(Ia,{disableAutoFocus:!0,disableDuringSubmit:!0,onSuccess:h,onClearComments:o,followUp:{taskId:i,turnId:t,comments:e,turnStatus:$,siblingTurnStatuses:J,cancellationRequestedAt:(V=r==null?void 0:r.cancellation_requested_at)!=null?V:null,siblingCancellationRequestedAts:ee,followUpSuggestions:ie},attemptIndex:d,ariaLabel:b.formatMessage({id:"wham.whamTaskPageFooter.composerAriaLabel",defaultMessage:"Composer to enter a follow up prompt to the task"})})]})})}),!D&&!_&&s.jsx(ve.div,{layout:!0,className:we("dark mx-6 mb-6 w-full",ze),initial:{opacity:0,translateY:10},animate:{opacity:1,translateY:0},exit:{opacity:0,translateY:10},transition:{duration:f?0:.25},children:s.jsx(sa,{title:s.jsx(de,{id:"wham.whamTaskPageFooter.previousTurn",defaultMessage:"You are viewing a previous turn"}),primaryCtaText:s.jsx(de,{id:"wham.whamTaskPageFooter.viewLatestTurn",defaultMessage:"View latest"}),content:s.jsx(de,{id:"wham.whamTaskPageFooter.followUpsLatestTurn",defaultMessage:"Follow-ups are only available for the latest turn"}),icon:s.jsx(oa,{className:"icon"}),onPrimaryCtaClick:()=>m(a.id)})})]}),s.jsx(as,{isOpen:A,onClose:()=>I(!1),onConfirm:j,loading:O})]})}const Nt="https://chatgpt.com/s/";function is(t){return"".concat(Nt).concat(t)}function Lt(t){var e,o;return!t||!t.attachments||t.attachments.length===0||t.attachments[0].kind!=="codex"?null:{postId:t.id,permalink:(e=t.permalink)!=null?e:is(t.id),permissions:(o=t.permissions.share_setting)!=null?o:"public",codexTask:t.attachments[0].task,codexTurn:t.attachments[0].turns}}function je(t){return["codex_tasks","result","share",t]}function rs({taskId:t,enabled:e}){return Wt({enabled:!!t&&e,queryKey:je(t),queryFn:async()=>{const o=await Ze.safeGet("/share/post/by_codex_task/{codex_task_id}",{parameters:{path:{codex_task_id:t}}});return o.post?Lt(o.post):null}})}function ns({taskId:t,onSuccess:e,onError:o}){return ye({scope:{id:t},mutationFn:()=>he.forkSharedTask(t),onSuccess:e,onError:o})}function ls({taskId:t,turnId:e,onSuccess:o,onError:a}){return ye({scope:{id:t},mutationFn:async()=>{const r=await Ze.safePost("/share/post",{requestBody:{attachments_to_create:[{kind:"codex",codex_task_id:t,current_codex_turn_id:e}]}});return Lt(r.post)},onSuccess:o,onError:a})}function cs({taskId:t,sharedResult:e}){var a;const o=Be();return ye({scope:{id:(a=e==null?void 0:e.postId)!=null?a:""},mutationFn:async({sharedResultId:r,access:c})=>(await Ze.safePost("/share/post/update_access",{requestBody:{post_id:r,share_settings:c}})).share_setting,onMutate:({access:r})=>{const c=je(t),d=o.getQueryData(c);return o.setQueryData(c,d&&Ce(Me({},d),{permissions:r})),{previousAccess:d==null?void 0:d.permissions}},onSuccess:r=>{const c=je(t),d=o.getQueryData(c);d&&o.setQueryData(c,Ce(Me({},d),{permissions:r}))},onError:(r,c,d)=>{var i;const l=je(t),u=o.getQueryData(l);o.setQueryData(l,u&&Ce(Me({},u),{permissions:(i=d==null?void 0:d.previousAccess)!=null?i:"public"}))}})}function ds({taskId:t}){const e=ge(),o=ke(),a=Je(),{mutate:r}=ns({taskId:t,onSuccess:c=>{var d,l;(d=c==null?void 0:c.task)!=null&&d.id&&a("/codex/tasks/".concat((l=c==null?void 0:c.task)==null?void 0:l.id))},onError:()=>{o.danger(e.formatMessage({id:"wham.codexForkButton.failedToFork",defaultMessage:"Failed to fork task"}))}});return s.jsx(xe,{size:"small",color:"secondary",type:"button",className:"px-3 py-2",onClick:()=>r(),children:s.jsx(de,{id:"wham.share.taskForkButton",defaultMessage:"Fork"})})}const us="".concat(Nt,"...");function ms({taskId:t,turnId:e,isLoading:o,sharedResult:a,title:r}){const[c,d]=g.useState(!1),l=(x,h)=>{x&&da(x,void 0,h).then(()=>{d(!0),setTimeout(()=>d(!1),1500)}).catch(()=>{})},u=Be(),i=ke(),{mutate:n,isPending:m}=ls({taskId:t,turnId:e,onSuccess:x=>{if(!x){i.danger("Failed to create share link");return}u.setQueryData(je(t),x),l(x.permalink)}}),{mutate:v}=cs({taskId:t,sharedResult:a}),b=g.useRef(null),w=x=>{var h;(h=b.current)==null||h.focus(),a?l(a.permalink,x):n()},f=x=>{a&&v({sharedResultId:a.postId,access:x})},C=x=>{switch(x){case"public":return Ue.PUBLIC;case"private":return Ue.PRIVATE;case"workspace":return Ue.WORKSPACE}};return s.jsx(Wa,{inputRef:b,isLoading:o,isPublishedVersionLatest:!0,sharedObject:a&&{id:a.postId,title:r,access:C(a.permissions)},title:r,shareTextPlaceholder:us,shareUrl:a==null?void 0:a.permalink,isCopySuccessful:c,isCreateLinkRequestInProgress:m,handlePrivacyChange:f,handlePrimaryButtonClick:w})}function fs({taskId:t,turnId:e,isDisabled:o,title:a}){const r=We(),c=xt(),d=ge(),[l,u]=g.useState(!1),{data:i,isLoading:n}=rs({taskId:t,enabled:l&&!o}),{triggerRef:m,container:v}=zt({isOpen:l,onClose:()=>u(!1)}),b=(c==null?void 0:c.isWorkspaceAccount())&&!(c!=null&&c.features.includes(Yt.WorkspaceShareLinks));return o||b?s.jsx(_t,{label:b?d.formatMessage(Fe.workspaceSharingDisabled):d.formatMessage(Fe.share),children:s.jsx(Ve,{disabled:!0,icon:ia,"aria-label":d.formatMessage(b?Fe.workspaceSharingDisabled:Fe.share)})}):s.jsxs(ra,{open:l,onOpenChange:u,children:[s.jsx(na,{ref:m,asChild:!0,children:r?s.jsx(Ve,{icon:st,"aria-label":d.formatMessage({id:"wham.whamTaskPageHeader.shareAriaLabel",defaultMessage:"Share task"})}):s.jsx(xe,{icon:st,color:"ghost","aria-label":d.formatMessage({id:"wham.whamTaskPageHeader.shareAriaLabel",defaultMessage:"Share task"}),children:s.jsx(de,{id:"wham.whamTaskPageHeader.share",defaultMessage:"Share"})})}),s.jsx(pt,{children:l&&s.jsx(la,{forceMount:!0,container:v,children:s.jsx(ca,{align:"end",className:"z-50",sideOffset:8,collisionPadding:8,children:s.jsx(ms,{title:a,taskId:t,turnId:e,sharedResult:i,isLoading:n})})})})]})}function hs({assistantTurn:t}){var b,w,f,C,x,h;const e=ge(),o=ke(),a=We(),r=(f=(w=(b=t==null?void 0:t.pull_request_data)==null?void 0:b.head)!=null?w:t==null?void 0:t.branch)!=null?f:"",c=Da(r),d=r&&r!==c,{outputDiffs:l}=qe(t==null?void 0:t.output_items),u=l[0],i=(h=(x=t==null?void 0:t.base_commit_sha)!=null?x:(C=t==null?void 0:t.pull_request_data)==null?void 0:C.base_sha)!=null?h:u==null?void 0:u.base_commit_sha;if(a||!r)return null;const n=i!=null&&r!==i,v=n?s.jsx("span",{className:"text-token-text-secondary hover:text-token-text-primary cursor-pointer",onClick:()=>{navigator.clipboard.writeText(i!=null?i:""),o.success(e.formatMessage({id:"wham.baseSha.copied",defaultMessage:"Copied branch commit SHA to clipboard"}))},children:i}):d?r:void 0;return s.jsx(_t,{label:v,side:"bottom",disabled:!v,interactive:n,children:s.jsx("span",{className:"text-token-text-secondary hover:text-token-text-primary cursor-pointer truncate",onClick:()=>{navigator.clipboard.writeText(r),o.success(e.formatMessage({id:"wham.branchName.copied",defaultMessage:"Copied branch name to clipboard"}))},children:c})})}const gs=({assistantTurn:t})=>{const e=ge(),o=g.useMemo(()=>t!=null&&t.created_at?new Date(t.created_at*1e3):null,[t==null?void 0:t.created_at]),a=g.useMemo(()=>(o==null?void 0:o.getFullYear())===new Date().getFullYear(),[o]);return o?o.toLocaleDateString(e.locale,{month:"short",day:"numeric",year:a?void 0:"numeric"}):null},ps=" · ";function ws({title:t,assistantTurn:e}){var u,i,n,m;const{linesAdded:o,linesRemoved:a}=St(e),r=(u=e==null?void 0:e.environment)==null?void 0:u.label,c=(m=(n=(i=e==null?void 0:e.pull_request_data)==null?void 0:i.head)!=null?n:e==null?void 0:e.branch)!=null?m:"",l=[{key:"created-at",element:s.jsx("span",{className:"text-token-text-secondary truncate empty:hidden max-md:hidden",children:s.jsx(gs,{assistantTurn:e})}),hideOnMobile:!0,shouldShow:!!(e!=null&&e.created_at)},{key:"environment",element:s.jsx("span",{className:"text-token-text-secondary truncate",children:r}),hideOnMobile:!1,shouldShow:!!r},{key:"branch",element:s.jsx(hs,{assistantTurn:e}),hideOnMobile:!0,shouldShow:!!c,noSeparator:!0},{key:"stats",element:s.jsx("span",{className:"max-md:hidden",children:s.jsx(qa,{linesAdded:o,linesRemoved:a})}),hideOnMobile:!0,shouldShow:!!(o||a)}].filter(v=>v.shouldShow);return s.jsxs("div",{className:"flex min-w-0 flex-col text-sm",children:[s.jsx("div",{className:"flex items-center gap-1",children:s.jsx("span",{className:"truncate font-medium",children:t})}),s.jsx("div",{className:"flex gap-2 max-md:flex-wrap max-md:gap-1",children:l.map((v,b)=>{const w=l[b-1],f=(w==null?void 0:w.hideOnMobile)||v.hideOnMobile||v.noSeparator;return s.jsxs(g.Fragment,{children:[b>0&&s.jsx("span",{"aria-hidden":"true",className:we("text-token-text-secondary",f?"max-md:hidden":""),children:ps}),v.element]},v.key)})})]})}function xs({focusedAssistantTurn:t,onClose:e,shouldShowShare:o,shouldShowFork:a,permissions:r,title:c,isSharedExampleTask:d=!1}){"use no forget";var P,L,z,le;const{taskId:l,task:u,currentDiffTaskTurn:i}=Ne(),n=xt(),m=(P=n==null?void 0:n.id)!=null?P:null,v=(L=u==null?void 0:u.creator_workspace)!=null?L:null,[b,w]=g.useState((i==null?void 0:i.pull_request_status)==="creating"),[f,C]=g.useState(void 0),x=ke(),h=Be(),j=ge(),q=ua(pe(i)),D=r==="write",E=De(y=>y.getTurnsForTask(l).filter(Se)),_=De(y=>y.getTurnsForTask(l)),O=new Map(_.map(y=>[y.id,y])),Y=y=>{if(Se(y)){const ce=u==null?void 0:u.external_pull_requests;if(ce&&ce.length)for(let p=ce.length-1;p>=0;p--){const S=ce[p];if(S.assistant_turn_id===y.id)return S}}const Z=y.previous_turn_id?O.get(y.previous_turn_id):void 0;return Z?Y(Z):void 0},A=i!=null?i:t,I=A?Y(A):void 0,{linesAdded:te,linesRemoved:R}=St(i),{outputDiffs:B,hasPreApplyPatch:ie}=qe(i==null?void 0:i.output_items),N=D&&!ie,U=((le=(z=u==null?void 0:u.task_status_display)==null?void 0:z.latest_turn_status_display)==null?void 0:le.intent)==="cr",F=Je(),H=!!(t!=null&&t.id)&&D&&!U,re=E.filter(y=>{var Z;return(Z=i==null?void 0:i.sibling_turn_ids)==null?void 0:Z.includes(y.id)}).some(y=>{var Z;return(Z=y.pull_request_data)==null?void 0:Z.url}),X=r==="write"&&I&&!I.pull_request.merged&&I.pull_request.state!=="closed"&&I.codex_updated_sha!==""&&((i==null?void 0:i.id)!==I.assistant_turn_id||(i==null?void 0:i.pull_request_status)==="externally_created")&&!re,$=g.useRef(null),{mutate:J,isPending:ee}=ye({mutationFn:async()=>{l&&await he.archiveTask(l)},onSuccess:async()=>{await h.invalidateQueries({queryKey:["wham","tasks"]}),await h.invalidateQueries({queryKey:["wham","task",l]}),F("/codex")},onError:()=>{x.danger({id:"wham.whamTaskPageHeader.failedToArchiveTask",defaultMessage:"Failed to archive task",description:"Toast when archive request fails"},{toastId:"wham_task_page_header_failed_to_archive_task"})}}),{mutate:T,isPending:oe}=ye({mutationFn:async()=>{l&&await he.recoverTask(l)},onSuccess:async()=>{await h.invalidateQueries({queryKey:["wham","tasks"]}),await h.invalidateQueries({queryKey:["wham","task",l]})},onError:()=>{x.danger({id:"wham.whamTaskPageHeader.failedToArchiveTask",defaultMessage:"Failed to archive task",description:"Toast when archive request fails"},{toastId:"wham_task_page_header_failed_to_archive_task"})}}),ne=ee||oe;g.useEffect(()=>{(i==null?void 0:i.pull_request_status)==="creating"?(w(!0),h.invalidateQueries({queryKey:["wham","task",l,"turns"]})):w(!1)},[l,i==null?void 0:i.pull_request_status,h]),Mt([{key:"copyApplyToClipboard",action:()=>{K()},actionMessageDescriptor:j.formatMessage({id:"wham.keyboardActions.copyApplyToClipboard",defaultMessage:"Copy git apply"}),group:Ge.Chat,keyboardBinding:[Re.Mod,Re.Shift,";"],enabled:!!q}]);const K=async()=>{q&&(await navigator.clipboard.writeText(" (cd \"$(git rev-parse --show-toplevel)\" && git apply --3way <<'EOF' \n".concat(q," \nEOF\n)")),x.success(j.formatMessage({id:"wham.message.modal.footer.copiedToClipboard",defaultMessage:"Copied git apply command to clipboard"}),{duration:3,hasCloseButton:!0}),i!=null&&i.id&&(Ee.recordGitAction("diff-copied",te,R,l,i.id,"regular"),he.copyGitApply(l,i.id,!0)))},k=async()=>{q&&(await navigator.clipboard.writeText(q),x.success(j.formatMessage({id:"wham.whamTaskPageHeader.copiedPatchToClipboard",defaultMessage:"Copied patch to clipboard"}),{duration:3,hasCloseButton:!0}),i!=null&&i.id&&await he.copyGitApply(l,i.id,!1))},Q=async()=>{if(!I||!(i!=null&&i.id)){x.danger({id:"wham.whamTaskPageHeader.noPrToUpdate",defaultMessage:"No PR to update",description:"Toast when no PR is found to update"},{duration:3,hasCloseButton:!0,toastId:"wham_task_page_header_no_pr_to_update"});return}w(!0);try{await he.updatePr(l,i.id,I.id)}catch(y){w(!1),await he.getTaskTurnPR(l,I.assistant_turn_id),y instanceof Ye?Xe(y,i.id,j,x):x.danger({id:"wham.whamTaskPageHeader.failedToUpdatePr",defaultMessage:"Failed to update PR",description:"Toast when failed to update PR"},{duration:3,hasCloseButton:!0,toastId:"wham_task_page_header_failed_to_update_pr"})}finally{await h.refetchQueries({queryKey:["wham","tasks"]}),await h.refetchQueries({queryKey:["wham","task",l]}),w(!1)}},G=async y=>{if(!(i!=null&&i.id))return;C(y);const Z=$.current;try{w(!0),await he.createPr(l,i.id,y),await h.refetchQueries({queryKey:["wham","task"]}),await h.fetchQuery(Ca(l,i.id)).then(ce=>{const p=ce;p.turn.pull_request_data!=null&&(Z&&!Z.closed&&p.turn.pull_request_data.url&&Z.location.assign(p.turn.pull_request_data.url),ma({title:p.task.title,clientThreadId:p.turn.conversation_id,subtitle:j.formatMessage({id:"wham.message.modal.footer.prCreatedSuccess",defaultMessage:"Click to view your pull request."}),onClick:()=>{var S;window.open((S=p.turn.pull_request_data)==null?void 0:S.url,"_blank")}}))}),Ee.recordGitAction("pr-created",te,R,l,i.id,y!=null?y:"regular")}catch(ce){w(!1),Z==null||Z.close(),ce instanceof Ye?Xe(ce,i.id,j,x):x.danger({id:"wham.message.modal.footer.createPrError",defaultMessage:"Failed to create PR",description:"Error message for failed to create PR"},{duration:3,hasCloseButton:!0,toastId:"wham_task_page_header_failed_to_create_pr"})}},ae=()=>{if(!(i!=null&&i.id))return;const y=f?"?mode=".concat(f):"";$.current=window.open("/codex/tasks/".concat(l,"/turns/").concat(i.id,"/pr").concat(y),"_blank")},V=!!We(),M=!!m&&!!v&&m===v;return s.jsxs("div",{className:"border-b-token-border-default flex w-full justify-between gap-2 border-b p-3 transition-colors duration-50",children:[s.jsxs("div",{className:"flex min-w-0 flex-shrink max-md:gap-2",children:[e?s.jsxs(s.Fragment,{children:[s.jsx("button",{className:"hover:bg-token-bg-tertiary group-radix-state-open:bg-token-bg-tertiary rounded-sm p-2 font-semibold",onClick:e,"aria-label":j.formatMessage({id:"wham.taskPageHeader.goBack",defaultMessage:"Go back to tasks"}),children:s.jsx(Ba,{className:"icon-lg text-token-text-secondary"})}),s.jsx("div",{className:"bg-token-border-default my-auto ms-[11px] me-4 h-4 w-[1px] max-md:hidden"})]}):s.jsx("div",{className:"ms-3"}),s.jsx(ws,{title:c,assistantTurn:t})]}),s.jsxs("div",{className:"relative flex h-10 items-center gap-1.5",children:[!1,a&&(t==null?void 0:t.id)&&M&&s.jsx(ds,{taskId:l}),H&&(V?s.jsx(Ve,{icon:u!=null&&u.archived?ot:it,onClick:()=>u!=null&&u.archived?T():J(),disabled:ne,"aria-label":u!=null&&u.archived?j.formatMessage({id:"wham.whamTaskPageHeader.ariaLabelUnarchive",defaultMessage:"Unarchive Task"}):j.formatMessage({id:"wham.whamTaskPageHeader.ariaLabelArchive",defaultMessage:"Archive Task"})}):s.jsx(xe,{color:"ghost",icon:u!=null&&u.archived?ot:it,loading:ne,onClick:()=>u!=null&&u.archived?T():J(),"aria-label":u!=null&&u.archived?j.formatMessage({id:"wham.whamTaskPageHeader.ariaLabelUnarchive",defaultMessage:"Unarchive Task"}):j.formatMessage({id:"wham.whamTaskPageHeader.ariaLabelArchive",defaultMessage:"Archive Task"}),children:u!=null&&u.archived?s.jsx(de,{id:"wham.whamTaskPageHeader.unarchive",defaultMessage:"Unarchive"}):s.jsx(de,{id:"wham.whamTaskPageHeader.archive",defaultMessage:"Archive"})})),o&&(t==null?void 0:t.id)&&s.jsx(fs,{taskId:l,turnId:t==null?void 0:t.id,isDisabled:!1,title:c!=null?c:""}),r==="write"&&!V&&s.jsx(Oa,{taskId:l}),B.length>0&&!U&&s.jsx(_a,{isCreatingPr:b,assistantTurn:i,copyApplyToClipboard:K,copyPatchToClipboard:k,createPr:G,navigateToCreatingPrPage:ae,canCreatePr:N,updateBranch:X?Q:void 0,permissions:r,showOnlyViewPr:d}),!V&&!d&&s.jsx(Ea,{})]})]})}function _s({focusedAssistantTurn:t,showFullDiff:e,currentDiffTaskTurn:o}){if(!t)return[];const a=!e;if(pe(t,a).length>0)return Le({assistantTurn:t,followUp:a});if(pe(t,!1).length>0)return Le({assistantTurn:t,followUp:!1});if(pe(t,!0).length>0)return Le({assistantTurn:t,followUp:!0});if(!o||o.id===t.id)return[];const l=pe(o,!1),u=pe(o,!0);if(l.length===0&&u.length===0)return[];const i=l.length===0&&u.length>0;return Le({assistantTurn:o,followUp:i})}const dt=new Set,bs=gt(()=>mt(()=>import("./jfmxxrawcp8pm844.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50])).then(t=>t.WhamTaskPageCodeDiffContent),{loading:()=>s.jsx("div",{className:"flex-1"})});function Ts({turnId:t,permissions:e,confirmClose:o,setConfirmClose:a,handleClose:r,showForkButton:c,loadingTurnMapping:d,isSharedExampleTask:l=!1}){"use no forget";var y,Z,ce;const{taskId:u,task:i,focusedAssistantTurn:n,pastTurns:m,canFollowUp:v,currentDiffTaskTurn:b}=Ne(),{comments:w,clearComments:f,setComments:C}=Ae(),x=ge(),{data:h,isLoading:j}=ja(),q=Be(),[D,E]=g.useState(void 0),_=g.useMemo(()=>pe(n,!0).length>0,[n]),[O,Y]=Xt(Jt.WhamShowFullDiff,!_,fa),A=g.useMemo(()=>_s({focusedAssistantTurn:n,showFullDiff:O,currentDiffTaskTurn:b}),[n,O,b]),I=g.useMemo(()=>n?n.output_items.filter(p=>p.type==="message").flatMap(p=>p.content).filter(p=>p.content_type==="image_asset_pointer_citation").map(p=>({content_type:"image_asset_pointer_citation",asset_pointer:p.asset_pointer,width:p.width,height:p.height,size_bytes:p.size_bytes})):[],[n]),te=(n==null?void 0:n.turn_status)==="failed",R=I.length>0,B=A.length>0,ie=ht(m),N=i?(y=i.title)!=null?y:x.formatMessage({id:"wham.whamTaskPageContentLoaded.newTask",defaultMessage:"New Task"}):null,U=ke(),F=!!We(),H=F||(h==null?void 0:h.git_diff_mode)==="unified",se=wt(),re=Ie(se,"3673716873");g.useEffect(()=>{const p=n==null?void 0:n.id;p&&!dt.has(p)&&(n==null?void 0:n.turn_status)==="completed"&&(dt.add(p),he.markTurnViewed(u,p))},[n==null?void 0:n.id,u,n==null?void 0:n.turn_status]);const{mutate:X}=ye({mutationFn:p=>he.updateUserPreferences(p),onSuccess:async()=>{await Pa(q)},onError:()=>{U.danger(ft({id:"wham.whamTaskPageContentLoaded.failedToUpdatePreferences",defaultMessage:"Failed to update preferences"}),{toastId:"wham_task_page_content_loaded_failed_to_update_preferences"})}}),$=p=>{X({diffView:p?"unified":"split"})},J=R?"preview":F?"chat":B?"diff":void 0,[ee,T]=g.useState(!1);!ee&&i&&(T(!0),E(J));const oe=n!=null&&n.turn_status?bt(n==null?void 0:n.turn_status):null,ne=g.useRef(!1),K=g.useRef({}),k=(Z=n==null?void 0:n.id)!=null?Z:t,Q=g.useCallback(p=>K.current[p],[]),G=g.useCallback((p,S)=>{K.current[p]=S},[]),ae=g.useMemo(()=>({versionKey:k,getOpenState:Q,setOpenState:G}),[k,Q,G]);g.useEffect(()=>{oe===!1?ne.current=!0:oe===!0&&ne.current&&B&&E("diff")},[oe]);const V=g.useMemo(()=>{var p,S,ue,me;if(te&&(n!=null&&n.environment_id)&&(n!=null&&n.branch)){const W=[...m].reverse().find(_e=>_e.type==="user"),fe=(p=W==null?void 0:W.input_items.find(_e=>_e.type==="message"))==null?void 0:p.content.find(_e=>_e.content_type==="text"),be=fe==null?void 0:fe.text,He=W==null?void 0:W.input_items.filter(_e=>_e.type==="comment"),Ft=((ue=(S=n==null?void 0:n.sibling_turn_ids)==null?void 0:S.length)!=null?ue:0)+1,It=ba((me=W==null?void 0:W.input_items)!=null?me:[]);return{environmentId:n==null?void 0:n.environment_id,branch:n==null?void 0:n.branch,previousTurnId:W==null?void 0:W.previous_turn_id,prompt:be!=null?be:"",comments:He!=null?He:[],bestOfN:Ft,attachments:It}}},[te,n,m]),{attemptIndex:M,siblings:P}=g.useMemo(()=>{if(!n)return{attemptIndex:null,hasSiblingTurns:!1};const p=m.filter(ue=>{var me;return Se(ue)&&!!((me=ue.sibling_turn_ids)!=null&&me.includes(n.id))}),S=p.findIndex(ue=>ue.id===n.id);return{attemptIndex:S===-1?null:S+1,siblings:p}},[n,m]),L=e==="write"?s.jsx(os,{turnId:(ce=n==null?void 0:n.id)!=null?ce:t,comments:w,clearComments:f,focusedAssistantTurn:n,lastTurn:ie,retry:V,attemptIndex:M,siblings:P!=null?P:[]}):null,z=s.jsx(Ka,{currentTab:D,permissions:e,onClickFile:()=>E("diff"),onTabChange:p=>E(p),showFullDiff:O,loadingTurnMapping:d,footer:L}),le=s.jsx(rt.Provider,{value:ae,children:s.jsx(Ja,{currentTab:D,setCurrentTab:p=>E(p),defaultTab:J,isMobile:F,hasDiff:B,previewImages:I,diffFiles:A,unifiedDiff:H,handleDiffModeChange:$,showFullDiff:O,setShowFullDiff:Y,isPreferencesLoading:j,isSharedExampleTask:l,focusedAssistantTurn:n,leftContent:z})});return s.jsxs(s.Fragment,{children:[s.jsxs(ve.div,Ce(Me({className:we("relative flex size-full flex-1 flex-col items-center",F?"[--right-bg:var(--bg-primary)]":"[--right-bg:var(--bg-tertiary)] dark:[--right-bg:black]")},ha),{children:[s.jsx(xs,{title:N,focusedAssistantTurn:n,onClose:r?()=>r==null?void 0:r({force:!0}):void 0,permissions:e,shouldShowShare:re&&e==="write",shouldShowFork:!!c,isSharedExampleTask:l}),s.jsx("div",{className:"bg-token-bg-primary flex min-h-0 w-full flex-1",children:!i||!ee?s.jsx(Zt,{}):F?le:s.jsx(ts,{leftContent:z,rightContent:l&&B?s.jsx("div",{className:"relative h-full w-full bg-[var(--right-bg)]",children:s.jsx(rt.Provider,{value:ae,children:s.jsx(bs,{diffFiles:A,unifiedDiff:H,enableComments:v,comments:w,setComments:C})})}):D?s.jsxs("div",{className:"relative h-full w-full bg-[var(--right-bg)]",children:[le,s.jsx(ga,{className:"absolute end-3 top-2.5",icon:s.jsx(At,{}),label:x.formatMessage({id:"wham.whamTaskPageContentLoaded.close",defaultMessage:"Close"}),onClick:()=>E(void 0)})]}):void 0})})]})),o&&a&&r&&s.jsx(va,{setConfirmClose:a,handleClose:r})]})}function Ks({taskId:t,task:e,currentUserTurn:o,currentAssistantTurn:a}){var n,m,v,b;const r=De(w=>w.addTurnToTaskMap),c=De(w=>w.getTurnsForTask),[d,l]=g.useState((m=(n=a==null?void 0:a.id)!=null?n:e==null?void 0:e.current_turn_id)!=null?m:null);g.useEffect(()=>{var w;t&&(a&&["pending","in_progress","failed"].includes(a.turn_status)?l(a.id):l((w=a==null?void 0:a.id)!=null?w:null),o&&r(t,o),a&&r(t,a))},[a,o,t,r]);const u=c(t!=null?t:"");let i=(b=(v=u==null?void 0:u.filter(w=>w.type==="assistant"))==null?void 0:v.find(w=>w.id===d))!=null?b:null;return i||(i=a),{focusedAssistantTurn:i,setFocusedAssistantTurnId:l}}function Gs({focusedAssistantTurn:t,pastTurns:e,currentDiffTaskTurnId:o}){if(!t)return null;if(Ke(t))return t;const a=vs(e);if(o){const c=a.get(o);if(c&&Se(c)&&Ke(c))return c}let r=ut(t,a);for(;r;){const c=a.get(r);if(!c||!Se(c))return null;if(Ke(c))return c;r=ut(c,a)}return null}function Ke(t){return pe(t,!1).length>0||pe(t,!0).length>0}function vs(t){const e=new Map;for(const o of t)e.set(o.id,o);return e}function ut(t,e){var a,r;const o=e.get((a=t.previous_turn_id)!=null?a:"");return o&&(r=o.previous_turn_id)!=null?r:null}export{$s as T,Qs as W,Ne as a,Ks as b,Ts as c,Gs as g,Ae as u};
//# sourceMappingURL=lkt2qv7ib8tsqf90.js.map
