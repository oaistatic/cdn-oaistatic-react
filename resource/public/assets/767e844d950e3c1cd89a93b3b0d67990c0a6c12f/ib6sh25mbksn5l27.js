var Qe=Object.defineProperty,ze=Object.defineProperties;var Je=Object.getOwnPropertyDescriptors;var Ae=Object.getOwnPropertySymbols;var Xe=Object.prototype.hasOwnProperty,Ye=Object.prototype.propertyIsEnumerable;var ye=(r,e,t)=>e in r?Qe(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,fe=(r,e)=>{for(var t in e||(e={}))Xe.call(e,t)&&ye(r,t,e[t]);if(Ae)for(var t of Ae(e))Ye.call(e,t)&&ye(r,t,e[t]);return r},_e=(r,e)=>ze(r,Je(e));import{c as ke,h as Ze,r as x,e as et,v as Te,j as g}from"./mw35uwhq4g8r9eam.js";import{u as tt,g as st,b5 as nt,d as Ce,M as at,B as ve,aA as Pe,P as Ne,V as Re,a4 as Ee,a6 as ge,aw as ee,ay as U,bW as rt,m as ot,bj as it,k as lt,aN as ct,bQ as ut,cp as dt}from"./d0xa318sl7ywi0za.js";import{lN as ft,lO as gt,el as we,lP as Se,iz as pt,iA as mt,lQ as ht,lR as St,cO as xt,lS as Mt,lT as pe,lU as bt,lV as me,cB as he,lW as At,cC as yt}from"./g2euln7v5pbm31qa.js";import{g as _t}from"./of0vtq1gcmd3mc3z.js";function Tt(r){"use forget";const e=ke.c(66),{prompt:t,isComplete:p,clientThreadId:i,parentMessageId:m}=r,f=tt();let n;e[0]!==i||e[1]!==f?(n=st(f,i),e[0]=i,e[1]=f,e[2]=n):n=e[2];const a=n,c=Ze(),[l,B]=x.useState(!1),H=nt();let C;e[3]!==a?(C=()=>it(a).id,e[3]=a,e[4]=C):C=e[4];const M=Ce(C);let u;e[5]!==t?(u=()=>pt(t?[t]:[]),e[5]=t,e[6]=u):u=e[6];const[d,$]=x.useState(u),y=x.useRef(null),_=at(i,vt),D=Ce(ve.agentSafeModeHasSeenNux$),s=et({startDefault:{id:"auraAgentSuggestion.startDefault",defaultMessage:"Continue"},cancel:{id:"auraAgentSuggestion.cancel",defaultMessage:"No thanks"},accepted:{id:"auraAgentSuggestion.accepted",defaultMessage:"The user has asked for agent to complete their task."}}),G=x.useRef(!1);let S,b;e[7]===Symbol.for("react.memo_cache_sentinel")?(S=()=>(y.current||(y.current=new mt([],o=>{$(o)},!0)),()=>{var o;(o=y.current)==null||o.destroy(),y.current=null}),b=[],e[7]=S,e[8]=b):(S=e[7],b=e[8]),x.useEffect(S,b);let A,v;e[9]!==p||e[10]!==t?(A=()=>{var h;const o=t?[t]:[];o.length===0&&$([]),(h=y.current)==null||h.onMessagePartsUpdated(o,!p)},v=[t,p],e[9]=p,e[10]=t,e[11]=A,e[12]=v):(A=e[11],v=e[12]),x.useEffect(A,v);const[Fe,je]=x.useState(!1);let q;e[13]===Symbol.for("react.memo_cache_sentinel")?(q=()=>{var o,h;je((h=(o=y.current)==null?void 0:o.isComplete())!=null?h:!1)},e[13]=q):q=e[13];let V;e[14]!==d?(V=[d],e[14]=d,e[15]=V):V=e[15],x.useEffect(q,V);let W,K;e[16]!==i||e[17]!==M||e[18]!==_?(W=()=>{if(G.current||!M||_)return;G.current=!0;const o=h=>{lt(i,T=>{T.conduitToken=h,T.prepareState="success"})};ht(i,M,[ge.Agent],o,{isRegen:!1,isOnboardingConversation:!1,delayAfterCompletion:!1})},K=[i,M,_],e[16]=i,e[17]=M,e[18]=_,e[19]=W,e[20]=K):(W=e[19],K=e[20]),x.useEffect(W,K);const te=D===!1,Oe=Ct,Ie=()=>c.formatMessage(s.accepted);let Q;e[21]!==te?(Q=()=>{te&&St(!0)},e[21]=te,e[22]=Q):Q=e[22];const z=Q;let J;e[23]===Symbol.for("react.memo_cache_sentinel")?(J={isAgentHintActive:!0},e[23]=J):J=e[23];const{agentSessionModeNuxModal:se,ensureAgentSessionModeNux:Le,isAgentSessionModeNuxOpen:Ue}=ft(J),xe=async o=>{var be;if(l||!t)return;z();const h=Ne(i),T=h?Re.lastUserMessage(h):null;if(!T){Ee.error("AuraAgentSuggestion: Unable to find last user message",{clientThreadId:i,parentMessageId:m});return}B(!0),H(ge.Agent);const Me=o?Oe(o):void 0,qe={id:Te(),author:{role:U.Tool,name:Se},create_time:Date.now()/1e3,content:{content_type:ee.Text,parts:[Ie()]},recipient:"all",status:"finished_successfully",weight:0},Ve=fe(_e(fe({},(be=T.metadata)!=null?be:{}),{is_visually_hidden_from_conversation:!0}),Me!==void 0&&{n7jupd_local_safe_mode:Me}),We=rt("",Ve),Ke={systemHints:[ge.Agent],conversationMode:{kind:ot.PrimaryAssistant}};await we({conversation:a,promptMessage:We,eventSource:"mouse",prependMessages:[qe],completionMetadata:Ke})};let X;e[24]!==z||e[25]!==a||e[26]!==l?(X=async()=>{if(l)return;z(),B(!0);const o={id:Te(),author:{role:U.Tool,name:Se},create_time:Date.now()/1e3,content:{content_type:ee.Text,parts:["The user has declined to use Agent, answer their question directly"]},recipient:"all",status:"finished_successfully",weight:0};await we({conversation:a,promptMessage:o,eventSource:"mouse"})},e[24]=z,e[25]=a,e[26]=l,e[27]=X):X=e[27];const ne=X;if(!t)return null;let Y;e[28]!==d?(Y=gt(d),e[28]=d,e[29]=Y):Y=e[29];const ae=Y,re=c.formatMessage(s.startDefault),oe=()=>{const o=ve.agentSessionMode$();Le(T=>{xe(T)})||xe(o)},ie=D===!0&&!Ue;let P;e[30]===Symbol.for("react.memo_cache_sentinel")?(P=_t(!1),e[30]=P):P=e[30];const Be="text-token-text-primary mb-2 flex max-w-full flex-col gap-6",le=!p;let w;e[31]!==ae||e[32]!==le?(w=g.jsx(xt,{className:"text-token-text-primary text-base leading-6 break-words",isActivelyStreaming:le,children:ae}),e[31]=ae,e[32]=le,e[33]=w):w=e[33];const De="flex flex-col gap-3 transition-opacity duration-200",ce=Fe?1:0;let k;e[34]!==ce?(k={opacity:ce},e[34]=ce,e[35]=k):k=e[35];const He="flex flex-col gap-2 min-[420px]:flex-row min-[420px]:items-center min-[420px]:justify-end min-[420px]:gap-3",$e="flex flex-col-reverse gap-2 min-[420px]:flex-row min-[420px]:flex-wrap min-[420px]:gap-2",ue=Pe,Ge="secondary",de=c.formatMessage(s.cancel);let N;e[36]!==ue||e[37]!==ne||e[38]!==l||e[39]!==de?(N=g.jsx(ue,{color:Ge,onClick:ne,disabled:l,children:de}),e[36]=ue,e[37]=ne,e[38]=l,e[39]=de,e[40]=N):N=e[40];let R;e[41]!==oe||e[42]!==l||e[43]!==re?(R=g.jsx(Pe,{color:"primary",onClick:oe,disabled:l,children:re}),e[41]=oe,e[42]=l,e[43]=re,e[44]=R):R=e[44];let E;e[45]!==N||e[46]!==R?(E=g.jsxs("div",{className:$e,children:[N,R]}),e[45]=N,e[46]=R,e[47]=E):E=e[47];let F;e[48]!==l||e[49]!==ie?(F=ie?g.jsx(Mt,{disabled:l,showLeadingDivider:!0}):null,e[48]=l,e[49]=ie,e[50]=F):F=e[50];let j;e[51]!==E||e[52]!==F?(j=g.jsxs("div",{className:He,children:[E,F]}),e[51]=E,e[52]=F,e[53]=j):j=e[53];let O;e[54]!==k||e[55]!==j?(O=g.jsx("div",{className:De,style:k,children:j}),e[54]=k,e[55]=j,e[56]=O):O=e[56];let I;e[57]!==w||e[58]!==O?(I=g.jsxs("div",{className:Be,children:[w,O]}),e[57]=w,e[58]=O,e[59]=I):I=e[59];let L;e[60]!==P||e[61]!==I?(L=g.jsx("div",{className:P,children:I}),e[60]=P,e[61]=I,e[62]=L):L=e[62];let Z;return e[63]!==se||e[64]!==L?(Z=g.jsxs(g.Fragment,{children:[L,se]}),e[63]=se,e[64]=L,e[65]=Z):Z=e[65],Z}function Ct(r){return r==="incognito"}function vt(r){var e;return(e=r==null?void 0:r.prepareRequestBlocked)!=null?e:!1}const Pt={close_tabs:{inProgress:"Closing tabs",finished:"Closed tabs",error:"Failed to close tabs"},open_tabs:{inProgress:"Opening tabs",finished:"Opened tabs",error:"Failed to open tabs"},list_tabs:{inProgress:"Listing tabs",finished:"Listed tabs",error:"Failed to list tabs"},focus_tab:{inProgress:"Focusing tab",finished:"Focused tab",error:"Failed to focus tab"},navigate_current_tab:{inProgress:"Navigating current tab",finished:"Navigated current tab",error:"Failed to navigate current tab"},set_tab_pinned_state:{inProgress:"Updating tab pin state",finished:"Updated tab pin state",error:"Failed to update tab pin state"},set_preference:{inProgress:"Setting preference",finished:"Updated preference",error:"Failed to set preference"},add_bookmark:{inProgress:"Adding bookmark",finished:"Added bookmark",error:"Failed to add bookmark"},reorder_tabs:{inProgress:"Reordering tabs",finished:"Reordered tabs",error:"Failed to reorder tabs"},search_browsing_history:{inProgress:"Searching browser memories",finished:"Searching browser memories",error:"Failed to search browser memories"}},wt=Object.fromEntries(Object.entries(Pt).map(([r,e])=>["".concat(ct,".").concat(r),e])),kt={inProgress:"Running tool",finished:"Finished running tool",error:"Error running tool"};function Nt(r,e){const t=wt[r];return t?t[e]:kt[e]}function Rt({messages:r,isRequestActive:e,isLastMessageInTurn:t,clientThreadId:p}){"use no forget";var _,D;const i=r.filter(s=>s.author.role===U.Assistant&&s.recipient&&pe(s.recipient)),m=Ne(p),f=m?Re.getConversationTurns(m).flatMap(s=>s.messages):[],n=f.findLastIndex(s=>s.author.role===U.Assistant&&s.recipient&&pe(s.recipient)),a=n>=0?f[n]:void 0,c=a&&a.recipient,l=n>=0?f.slice(n+1).filter(s=>s.author.role===U.Tool&&s.author.name===c):[],B=n>=0?f.slice(n+1).find(s=>s.author.role===U.Assistant&&(!s.recipient||!pe(s.recipient))):void 0,H=B!=null&&ut(B),C=l.length>0,M=a==null?void 0:a.id,u=bt(s=>M?s.getToolState(p,M):void 0);let d=null;C||(u==null?void 0:u.status)===me.Finished?d={key:"finished",status:he.Finished}:(u==null?void 0:u.status)===me.Error?d={key:"error",status:he.Error}:((u==null?void 0:u.status)===me.Running||e&&t&&!u)&&(d={key:"inProgress",status:he.Running});const $=x.useMemo(()=>!c||!d?null:Nt(c,d.key),[c,d]);if(i.length===0||!c||!i.some(s=>s.id===(a==null?void 0:a.id)))return null;if(c===Se){if(!a||l.length>0||H)return null;let s="";a.content.content_type===ee.Text?s=(D=(_=a.content.parts)==null?void 0:_[0])!=null?D:"":a.content.content_type===ee.Code&&(s=a.content.text);const G=a.status==="finished_successfully",[S]=At(s,v=>dt(v)),b=!S&&s.trim().length>0?s:null;b&&Ee.error("BrowserToolMessage: failed to parse SuggestAgent arguments",{args:s});let A="";return typeof(S==null?void 0:S.prompt)=="string"?A=S.prompt:b&&(A=b),{type:"suggestion",prompt:A,isComplete:G,parentMessageId:a.id}}return H||!d?null:{type:"message",message:$,display:d}}function Lt(r){"use forget";const e=ke.c(13),{messages:t,isRequestActive:p,isLastMessageInTurn:i,clientThreadId:m}=r;let f;e[0]!==m||e[1]!==i||e[2]!==p||e[3]!==t?(f={messages:t,isRequestActive:p,isLastMessageInTurn:i,clientThreadId:m},e[0]=m,e[1]=i,e[2]=p,e[3]=t,e[4]=f):f=e[4];const n=Rt(f);if(!n)return null;if(n.type==="suggestion"){let c;return e[5]!==m||e[6]!==n.isComplete||e[7]!==n.parentMessageId||e[8]!==n.prompt?(c=g.jsx(Tt,{prompt:n.prompt,isComplete:n.isComplete,clientThreadId:m,parentMessageId:n.parentMessageId}),e[5]=m,e[6]=n.isComplete,e[7]=n.parentMessageId,e[8]=n.prompt,e[9]=c):c=e[9],c}let a;return e[10]!==n.display.status||e[11]!==n.message?(a=g.jsx(yt,{highlightedCommand:n.message,showWorkUserSetting:!1,status:n.display.status,children:null}),e[10]=n.display.status,e[11]=n.message,e[12]=a):a=e[12],a}export{Lt as BrowserToolMessage};
//# sourceMappingURL=ib6sh25mbksn5l27.js.map
