var q=Object.defineProperty,B=Object.defineProperties;var $=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var v=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var R=(o,t,s)=>t in o?q(o,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[t]=s,w=(o,t)=>{for(var s in t||(t={}))v.call(t,s)&&R(o,s,t[s]);if(y)for(var s of y(t))W.call(t,s)&&R(o,s,t[s]);return o},P=(o,t)=>B(o,$(t));import{y as K,h as z,d as Q,r as k,u as X,j as I,aa as M,e as Y}from"./mw35uwhq4g8r9eam.js";import{iY as u,u as J,pe as V,jh as Z,pf as ee,ml as te,R as h,iX as p,ef as ne,ei as se,dX as oe,d_ as d,lG as ce,dZ as ae,pg as N,_ as b,eb as U,ph as re,aV as ie}from"./d0xa318sl7ywi0za.js";import{g as ue}from"./ki6jbruunap4y9wd.js";import{C as le}from"./ddina39kz3r81pp7.js";const _e={OAUTH_SCOPES_MISMATCH:u.OAUTH_FAILED_SCOPE_MISMATCH,EMAIL_DOMAIN_CLAIMED_BY_ANOTHER_WORKSPACE:u.OAUTH_FAILED_EMAIL_DOMAIN_ENFORCEMENT},L=Y({genericSuccess:{id:"connectorPlatformOauthRedirect.genericSuccess",defaultMessage:"{connector} is now connected"},slackAiAppSuccess:{id:"connectorPlatformOauthRedirect.slackAiAppSuccess",defaultMessage:"AI App for Slack is now installed"}}),Ce=K(function(){const t=z(),s=J(),_=Q(),f=te("installations/select_target"),g=V(),H=Z(s),A=k.useRef(!1),{mutateAsync:D}=ee(),C=X();return k.useEffect(()=>{if(A.current===!0)return;A.current=!0;async function x(){var T,m,E,S;const O=ue()==="popup"||g,G=window.location.href;try{const e=await h.safePost("/aip/connectors/links/oauth/callback",{requestBody:{full_redirect_url:G}});if(await C.invalidateQueries({refetchType:"all",queryKey:["fetchConnectorLinkData"]}),!(e!=null&&e.post_auth_url)){_(p(u.OAUTH_FAILED_GENERIC));return}const n=new URL(e.post_auth_url,location.origin),r=((T=e==null?void 0:e.link)==null?void 0:T.connector_id)===ne[se.GITHUB_CONNECTOR],i=n.searchParams.get("github_onboarding")==="sync-repos";if(r&&i){const c=await h.safePost("/aip/connectors/github/search_repos",{requestBody:{query:"",limit:20,next_token:null,link_id:e.link.id}});if(!c||c.repos.length===0){window.open("".concat(f,"?state=").concat(encodeURIComponent(JSON.stringify({client_redirect_to:"".concat(window.location.origin,"/?github_onboarding=sync-repos")}))),"_self");return}}const l=oe(n.hash)===d.Connectors;if(!l){const c=ce[e.link.connector_id];c&&n.searchParams.set("add_source",c)}let a;if(l){const c=new URLSearchParams;c.set("connector",e.link.connector_id),r&&!i&&c.set("github_onboarding","configure-repos");const j=P(w({},n),{search:"",hash:ae(d.Connectors).hash+"?".concat(c.toString())});a=M(j)}else r&&!i&&n.searchParams.set("github_onboarding","configure-repos"),a=M({pathname:n.pathname,search:n.search,hash:n.hash});if(O){N({success:!0,connectorId:e.link.connector_id,linkId:e.link.id}),window.close();return}b.logEventWithStatsig("Connector OAuth Connect","chatgpt_connectors_oauth_connect_success",{success:!0,type:e.link.connector_id}),U.logOAuthCompleted({connector_id_metadata:U.createIdMetadataFromId(s,e.link.connector_id,"unknown_referrer"),referrer:"unknown_referrer",authType:"OAUTH",scopes:null,success:!0});const F=e.link.connector_id===re?t.formatMessage(L.slackAiAppSuccess):t.formatMessage(L.genericSuccess,{connector:e.link.name});_(p(u.CUSTOM_MSG,a,F))}catch(e){let n;try{const i=new URL(window.location.href),l=(m=i.searchParams.get("oauth_state_id"))!=null?m:i.searchParams.get("state");if(l){const a=await h.safeGet("/aip/connectors/links/oauth/state/{oauth_state_id}",{parameters:{path:{oauth_state_id:l}}});a!=null&&a.connector_id&&(n=a.connector_id)}}catch(i){}const r=e instanceof ie?(S=_e[(E=e.detail)==null?void 0:E.error_code])!=null?S:u.OAUTH_FAILED_GENERIC:u.OAUTH_FAILED_GENERIC;if(O){N({success:!1,connectorId:n!=null?n:"",errorType:r}),window.close();return}b.logEventWithStatsig("Connector OAuth Connect","chatgpt_connectors_oauth_connect_error",{errorType:r,success:!1,type:n!=null?n:"unknown"}),_(p(r,"#settings/".concat(d.Connectors)))}}x()},[s,g,f,t,_,H,D,C]),I.jsx("div",{className:"flex h-screen w-screen items-center justify-center",children:I.jsx(le,{size:36})})});export{Ce as default};
//# sourceMappingURL=i5jyn39e6e9b3s9k.js.map
