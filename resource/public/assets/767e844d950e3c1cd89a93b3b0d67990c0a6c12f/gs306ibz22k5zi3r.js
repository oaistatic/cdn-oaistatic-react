var oe=Object.defineProperty,re=Object.defineProperties;var se=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var Z=(e,t,n)=>t in e?oe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,C=(e,t)=>{for(var n in t||(t={}))$.call(t,n)&&Z(e,n,t[n]);if(O)for(var n of O(t))F.call(t,n)&&Z(e,n,t[n]);return e},D=(e,t)=>re(e,se(t));var T=(e,t)=>{var n={};for(var i in e)$.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&O)for(var i of O(e))t.indexOf(i)<0&&F.call(e,i)&&(n[i]=e[i]);return n};import{aw as N,n as ae,qv as de,P as ce,m as ue,ay as te,aa as fe}from"./d0xa318sl7ywi0za.js";import{cF as le,cB as g,cL as me}from"./g2euln7v5pbm31qa.js";import{e as _e,v as pe}from"./mw35uwhq4g8r9eam.js";const h=_e({starting:{id:"jitPluginMessage.starting",defaultMessage:"Starting action"},confirmingSimple:{id:"jitPluginMessage.confirming.simple",defaultMessage:"{gizmoName} wants to talk to {domain}"},confirmingSubtitle:{id:"jitPluginMessage.confirming.subtitle",defaultMessage:"Only allow sites you trust."},running:{id:"jitPluginMessage.runningV4",defaultMessage:"Talking to {domain}"},finished:{id:"jitPluginMessage.finishedV4",defaultMessage:"Talked to {domain}"},stopped:{id:"jitPluginMessage.stoppedV4",defaultMessage:"Stopped talking to {domain}"},error:{id:"jitPluginMessage.errorV5",defaultMessage:"Error talking to {domain}"},declined:{id:"jitPluginMessage.declined",defaultMessage:"You declined this action"},allowed:{id:"jitPluginMessage.allowed",defaultMessage:"You allowed this action"},ranTest:{id:"jitPluginMessage.ranTest",defaultMessage:"Tested {operationName}"},confirmParamsTitle:{id:"jitPluginMessage.confirmParamsTitleV3",defaultMessage:"{gizmoName} wants to share this info with {domain}"},sentParamsTitle:{id:"jitPluginMessage.sentParamsTitleV2",defaultMessage:"{gizmoName} sent this info to {domain}"},privacyPolicyLink:{id:"jitPluginMessage.privacyPolicyLinkV2",defaultMessage:"Privacy policy"},connectorDeclined:{id:"jitPluginMessage.connectorDeclined",defaultMessage:"Declined connection to {domain}"},rememberForThisConversation:{id:"jitPluginMessage.rememberForThisConversation",defaultMessage:"Remember for this conversation"},allow:{id:"jitPluginMessage.allow",defaultMessage:"Allow"},allowing:{id:"jitPluginMessage.allowing",defaultMessage:"Allowingâ€¦"}});var f=(e=>(e[e.Running=0]="Running",e[e.Finished=1]="Finished",e[e.Error=2]="Error",e[e.Stopped=3]="Stopped",e[e.OauthLogin=4]="OauthLogin",e[e.NoAuthLink=5]="NoAuthLink",e[e.UserConfirmation=6]="UserConfirmation",e[e.Denied=7]="Denied",e[e.Hidden=8]="Hidden",e[e.Allowed=9]="Allowed",e))(f||{});const ge=e=>{const[t,...n]=e,i=n.filter(l=>{var d;return l.author.role===te.Tool&&!((d=l.metadata)!=null&&d.is_visually_hidden_from_conversation)}),o=i.filter(l=>{var d,s,_;return((_=(s=(d=l.metadata)==null?void 0:d.jit_plugin_data)==null?void 0:s.from_server)==null?void 0:_.type)==="debug"}),r=i.filter(l=>!["debug","send_test"].some(d=>{var s,_,v;return d===((v=(_=(s=l.metadata)==null?void 0:s.jit_plugin_data)==null?void 0:_.from_server)==null?void 0:v.type)})),a=i[i.length-1];return{assistantMessage:t,toolMessages:i,debugMessages:o,actionableMessages:r,lastToolMessage:a}},U=new WeakMap,z=e=>{const t=U.get(e);if(t)return t;const n=ge(e);return U.set(e,n),n};function ve(e){if(e&&"user_action"in e){const t=e.user_action;e=C(C({},e),t.data),"target_message_id"in e&&t.target_message_id&&(e.target_message_id=t.target_message_id)}return e}function J(e,t){var n,i,o,r;return((n=e==null?void 0:e.from_server)==null?void 0:n.type)==="confirm_action"?(o=(i=e==null?void 0:e.from_server)==null?void 0:i.body)==null?void 0:o.operation:(r=t==null?void 0:t.parsed_function_call)==null?void 0:r.name}function Me(e,t){var r,a;const{jitPluginData:n,invokedPlugin:i,lastConfirmActionJitPluginData:o}=E(e,t);return(a=(r=J(n,i))!=null?r:J(o,void 0))!=null?a:""}function Ne(e,t){var n,i,o,r;return((n=e==null?void 0:e.from_server)==null?void 0:n.type)==="confirm_action"?(o=(i=e==null?void 0:e.from_server)==null?void 0:i.body)==null?void 0:o.params:(r=t==null?void 0:t.parsed_function_call)==null?void 0:r.kwargs}function E(e,t){var r,a,l,d,s,_,v,y,A,k,w,j,S,b,M,R,V,x,H,W,P,B,G,L;const{assistantMessage:n,actionableMessages:i}=z(e);let o;for(let p=i.length-1;p>=0;p--){const c=(r=i[p].metadata)==null?void 0:r.jit_plugin_data;if(((a=c==null?void 0:c.from_server)==null?void 0:a.type)==="confirm_action"){o=c;break}}if(((s=(d=(l=n.metadata)==null?void 0:l.jit_plugin_data)==null?void 0:d.from_server)==null?void 0:s.type)==="send_test")return{uiState:f.Hidden,lastConfirmActionJitPluginData:o,jitPluginData:void 0,invokedPlugin:void 0,fileAttachments:void 0};if(i.some(p=>p.content.content_type===N.SystemError))return{uiState:f.Error,lastConfirmActionJitPluginData:o,jitPluginData:void 0,invokedPlugin:void 0,fileAttachments:void 0};if(le(n))return{uiState:f.Stopped,lastConfirmActionJitPluginData:o,jitPluginData:void 0,invokedPlugin:void 0,fileAttachments:void 0};for(let p=i.length-1;p>=0;p--){const c=i[p];if((_=c.metadata)!=null&&_.invoked_plugin){const Y=[];return i.forEach(ne=>{var Q,X;const K=(X=(Q=ne.metadata)==null?void 0:Q.attachments)==null?void 0:X.filter(ie=>ie.display_files_from_actions_ext);K&&Y.push(...K)}),{uiState:f.Finished,lastConfirmActionJitPluginData:o,jitPluginData:c.metadata.jit_plugin_data,invokedPlugin:c.metadata.invoked_plugin,fileAttachments:Y}}const m=ve((y=(v=c.metadata)==null?void 0:v.jit_plugin_data)==null?void 0:y.from_client),q=i[p-1];if((w=(k=(A=q==null?void 0:q.metadata)==null?void 0:A.jit_plugin_data)==null?void 0:k.from_server)==null||w.type,m!=null){if((m==null?void 0:m.type)==="contact_gizmo")return{uiState:f.Finished,lastConfirmActionJitPluginData:o,jitPluginData:(S=(j=i[p-1])==null?void 0:j.metadata)==null?void 0:S.jit_plugin_data,invokedPlugin:void 0,fileAttachments:void 0};if((m==null?void 0:m.type)==="deny")return{uiState:f.Denied,lastConfirmActionJitPluginData:o,jitPluginData:void 0,invokedPlugin:void 0,fileAttachments:void 0};if((m==null?void 0:m.type)==="oauth_success")return{uiState:f.Running,lastConfirmActionJitPluginData:o,jitPluginData:(b=c.metadata)==null?void 0:b.jit_plugin_data,invokedPlugin:void 0,fileAttachments:void 0};if((m==null?void 0:m.type)==="link_success")return{uiState:f.Running,lastConfirmActionJitPluginData:o,jitPluginData:(M=c.metadata)==null?void 0:M.jit_plugin_data,invokedPlugin:void 0,fileAttachments:void 0};if((m==null?void 0:m.type)==="allow")return{uiState:f.Allowed,lastConfirmActionJitPluginData:o,jitPluginData:(R=c.metadata)==null?void 0:R.jit_plugin_data,invokedPlugin:void 0,fileAttachments:void 0};break}const u=(x=(V=c.metadata)==null?void 0:V.jit_plugin_data)==null?void 0:x.from_server;if((u==null?void 0:u.type)==="preview"&&t)return{uiState:f.Running,lastConfirmActionJitPluginData:o,jitPluginData:(H=c.metadata)==null?void 0:H.jit_plugin_data,invokedPlugin:void 0,fileAttachments:void 0};if((u==null?void 0:u.type)==="confirm_action"&&t)return{uiState:f.UserConfirmation,lastConfirmActionJitPluginData:o,jitPluginData:(W=c.metadata)==null?void 0:W.jit_plugin_data,invokedPlugin:void 0,fileAttachments:void 0};if((u==null?void 0:u.type)==="activate_scope"&&t)return{uiState:f.UserConfirmation,lastConfirmActionJitPluginData:o,jitPluginData:(P=c.metadata)==null?void 0:P.jit_plugin_data,invokedPlugin:void 0,fileAttachments:void 0};if((u==null?void 0:u.type)==="approve_tool_in_scope"&&t)return{uiState:f.UserConfirmation,lastConfirmActionJitPluginData:o,jitPluginData:(B=c.metadata)==null?void 0:B.jit_plugin_data,invokedPlugin:void 0,fileAttachments:void 0};if((u==null?void 0:u.type)==="oauth_required"&&t)return{uiState:f.OauthLogin,lastConfirmActionJitPluginData:o,jitPluginData:(G=c.metadata)==null?void 0:G.jit_plugin_data,invokedPlugin:void 0,fileAttachments:void 0};if((u==null?void 0:u.type)==="link_required"&&t)return{uiState:f.NoAuthLink,lastConfirmActionJitPluginData:o,jitPluginData:(L=c.metadata)==null?void 0:L.jit_plugin_data,invokedPlugin:void 0,fileAttachments:void 0}}return{uiState:t?f.Running:f.Stopped,lastConfirmActionJitPluginData:o,jitPluginData:void 0,invokedPlugin:void 0,fileAttachments:void 0}}function Ee(e,t,n,i){var _,v,y,A,k,w,j,S,b,M;const o=(_=de(e,n))!=null?_:void 0;if(!o)return{connectorId:void 0,connectorToolStatus:null,connectorStatusMessage:null,showConnectorConnect:!1};if(t===e)return{connectorId:o,connectorToolStatus:null,connectorStatusMessage:null,showConnectorConnect:!1};let r=g.Running,a=null,l=!1;const d=n[n.length-1],s=(v=d==null?void 0:d.metadata)==null?void 0:v.jit_plugin_data;return n.some(R=>R.content.content_type===N.SystemError)?(r=g.Error,a=h.error):d?((y=s==null?void 0:s.from_server)==null?void 0:y.type)==="oauth_required"&&i?(r=g.Paused,a=null,l=!0):((A=s==null?void 0:s.from_server)==null?void 0:A.type)==="link_required"&&i?(r=g.Paused,a=null,l=!0):(((k=s==null?void 0:s.from_server)==null?void 0:k.type)==="oauth_required"||((w=s==null?void 0:s.from_server)==null?void 0:w.type)==="link_required")&&!i?(r=g.Stopped,a=h.connectorDeclined):((j=s==null?void 0:s.from_client)==null?void 0:j.type)==="deny"?(r=g.Stopped,a=h.connectorDeclined):((S=s==null?void 0:s.from_client)==null?void 0:S.type)==="oauth_success"?(r=g.Stopped,a=null):((b=s==null?void 0:s.from_client)==null?void 0:b.type)==="link_success"?(r=g.Stopped,a=null):(M=d==null?void 0:d.metadata)!=null&&M.invoked_plugin?(r=g.Finished,a=h.finished):(r=g.Stopped,a=h.stopped):(r=g.Running,a=h.running),{connectorId:o,connectorToolStatus:r,connectorStatusMessage:a,showConnectorConnect:l}}function he({recipient:e,actionData:t,gizmoId:n,messageTextContent:i}){return{id:pe(),author:{role:te.Tool,name:e},content:{content_type:N.Text,parts:[i!=null?i:""]},recipient:"all",metadata:{jit_plugin_data:{from_client:t},gizmo_id:n},clientMetadata:{completionSampleFinishTime:Date.now()}}}function Re(a){var l=a,{clientThreadId:e,actionData:t,assistantMessage:n,onRequestCompletion:i,messageTextContent:o}=l,r=T(l,["clientThreadId","actionData","assistantMessage","onRequestCompletion","messageTextContent"]);var s;const d=(s=ce(e))==null?void 0:s.mode;i(D(C({},r),{promptMessage:he({recipient:n.recipient,actionData:t,gizmoId:d&&"gizmo_id"in d?d.gizmo_id:void 0,messageTextContent:o}),completionMetadata:{conversationMode:d!=null?d:{kind:ue.PrimaryAssistant}}}))}function Oe(e,t){if(e.type!==ae.JIT_PLUGIN||!e.metadata.json_schema)return!1;let n=!1;function i(o){for(const r in o)r==="operationId"&&o[r]===t&&(n=!0),o[r]&&typeof o[r]=="object"&&i(o[r])}return i(e.metadata.json_schema),n}function I(e){var t,n,i;if(e&&(((t=e.from_server)==null?void 0:t.type)==="confirm_action"||((n=e.from_server)==null?void 0:n.type)==="oauth_required"||((i=e.from_server)==null?void 0:i.type)==="preview"))return e.from_server.body.params}function ee(e){var t,n,i;if(e&&(((t=e.from_server)==null?void 0:t.type)==="confirm_action"||((n=e.from_server)==null?void 0:n.type)==="preview"))return(i=e.from_server.body.tool_call_safety_summary)!=null?i:void 0}function ye(e){const t=fe(e);if(t)try{return JSON.parse(t)}catch(n){return{text:t}}}function Ce(e,t){var r,a;const{assistantMessage:n}=z(e),{jitPluginData:i,lastConfirmActionJitPluginData:o}=E(e,t);return(a=(r=I(i))!=null?r:I(o))!=null?a:ye(n)}function qe(e,t){var o,r;const{jitPluginData:n,lastConfirmActionJitPluginData:i}=E(e,t);return(r=(o=ee(n))!=null?o:ee(i))!=null?r:void 0}function Ae(e){if(!e)return;const t=e.content.content_type===N.Text?e.content.parts[0]:e.content.content_type===N.Code?e.content.text:void 0;if(t)try{return JSON.parse(t)}catch(n){return t}}const ze=e=>{const{lastToolMessage:t}=z(e);return Ae(t)},Ve=(e,t)=>{var i,o,r,a;const{jitPluginData:n}=E(e,t);return((i=n==null?void 0:n.from_server)==null?void 0:i.type)==="confirm_action"?(a=(r=(o=n==null?void 0:n.from_server)==null?void 0:o.body)==null?void 0:r.offer_remember_answer)!=null?a:!0:!1},ke=(e,t)=>{var i,o;const{jitPluginData:n}=E(e,t);return((i=n==null?void 0:n.from_server)==null?void 0:i.type)!=="denied_by_user"&&!!((o=n==null?void 0:n.from_server)!=null&&o.body.actions.length)},xe=(e,t)=>me(e)&&ke(e,t);export{f as J,Ve as a,Ce as b,xe as c,Oe as d,Ee as e,ve as f,E as g,Re as h,h as i,qe as j,ze as k,Me as l,Ne as m,z as p};
//# sourceMappingURL=gs306ibz22k5zi3r.js.map
