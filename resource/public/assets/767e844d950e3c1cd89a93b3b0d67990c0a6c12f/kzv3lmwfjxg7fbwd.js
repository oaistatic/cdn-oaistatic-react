var de=Object.defineProperty,ue=Object.defineProperties;var pe=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var _e=Object.prototype.hasOwnProperty,fe=Object.prototype.propertyIsEnumerable;var D=(e,t,n)=>t in e?de(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,U=(e,t)=>{for(var n in t||(t={}))_e.call(t,n)&&D(e,n,t[n]);if(K)for(var n of K(t))fe.call(t,n)&&D(e,n,t[n]);return e},C=(e,t)=>ue(e,pe(t));import{r as T,j as o,M as W}from"./mw35uwhq4g8r9eam.js";import{u as Y,M as me,d as ee,bj as xe,g as he,mq as ge,J as ye,ay as Q,aw as z,ek as be,cF as P,bo as ve,cD as je,_ as te,V as oe}from"./d0xa318sl7ywi0za.js";import{d7 as Se,d8 as ae,d9 as Fe,da as Ee,db as Ie,dc as se,dd as H,cD as G,de as ke,df as we,dg as Me,cA as ne,dh as Te,bp as V,cE as Ne,d4 as Ae,cI as Re}from"./g2euln7v5pbm31qa.js";import{F as qe}from"./pe4e1ebqw6qlpge9.js";import{GlauxSearchQueryWithIcon as re,GlauxSearchQueryOverflow as Oe}from"./e237h6ukoc2vt16i.js";import{A as le}from"./idtxxq2b89y0p07a.js";import"./mfq2eda4qxrcz3ws.js";import"./m9dg467qzmmahw21.js";function X(e,t){const n=new RegExp("<\\s*".concat(t,"\\s*>([\\s\\S]*?)<\\s*/\\s*").concat(t,"\\s*>"),"i"),u=e.match(n);return u&&u[1]?u[1].trim():e}function Ue(e){if(e===void 0)return;const t="Content Snippet:",n=e.indexOf(t);return n===-1?e:e.substring(n+t.length).trim()}function Ce(e,t){var n,u,N,F,h;t.text=Ue(e.contents),(n=e.documentId)!=null&&n.includes("ks--slack")||(u=t.cloud_doc_url)!=null&&u.match(/^https:\/\/github\.com\/[^/]+\/[^/]+\/(issues|pull)\/\d+/)?(t.text=void 0,t.name="#".concat(t.name)):(N=t.cloud_doc_url)!=null&&N.startsWith("https://docs.google.com/spreadsheets/")&&t.text!==void 0?t.text=X(t.text,"sheet_summary"):(F=t.cloud_doc_url)!=null&&F.match(/^https:\/\/github\.com\/[^/]+\/[^/]+\/commit\//)&&t.text!==void 0?t.text=X(t.text,"git_summary"):(h=t.cloud_doc_url)!=null&&h.match(/^https:\/\/github\.com\/[^/]+\/[^/]+\/blob\//)&&t.text!==void 0&&(t.text=X(t.text,"code_summary")),t.text&&(t.text=t.text.slice(0,250))}function Ve({turnIndex:e,clientThreadId:t,variant:n="sidebar"}){const u=Y(),N=Se(),F=ae(u)||N,h=Fe(u),A=Ee(u),[q,i]=me(t,d=>[oe.getTurnContentReferences(d,e),oe.getConversationTurnAtIndex(d,e).messages]),R=ee(()=>xe(he(u,t))),E=Ie(R),I=ee(()=>{if(E)return ge(u,{skipLogos:!1})}),k=i.some(d=>{var p;return((p=d==null?void 0:d.metadata)==null?void 0:p.api_tool_type)==="glaux"}),O=k||ye(u,"2137702454"),L=T.useMemo(()=>({turnIndex:e,clientThreadId:t}),[t,e]),B=T.useMemo(()=>{const d=[],p=new Set,_=new Map;if(A.forEach(s=>{_.set(s,[])}),q.forEach(s=>{var a,l,f,c,y,m,w,x,g;if(s.type==="file"&&!p.has(s.id)){const{Icon:r,appName:b}=se({connectorId:(a=s.connector_id)!=null?a:void 0,cloud_doc_url:s.cloud_doc_url,availableConnectors:I}),v={id:s.id,name:b||s.name,subtitle:b?s.name:void 0,cloud_doc_url:(f=s.cloud_doc_url)!=null?f:(l=s.extra)==null?void 0:l.cloud_doc_url,text:O?s.snippet:void 0,authors:(c=s.medical_file_reference)==null?void 0:c.authors_display,publication_year:(y=s.medical_file_reference)==null?void 0:y.publication_year,journal_name:(m=s.medical_file_reference)==null?void 0:m.journal_name,doi:(w=s.medical_file_reference)==null?void 0:w.doi,journal_homepage_url:(x=s.medical_file_reference)==null?void 0:x.journal_homepage_url,Icon:r};if(!!!v.cloud_doc_url&&!H(v.id))return;d.push(v),_.has(s.type)&&((g=_.get(s.type))==null||g.push(v)),p.add(s.id)}else s.type==="file_navlist"?s.items.forEach(r=>{var b,v,M;if(!p.has(r.id)){const j=G((b=r.cloud_doc_url)!=null?b:""),S={name:(v=j==null?void 0:j.type)!=null?v:r.name,subtitle:j!=null&&j.type?r.name:void 0,cloud_doc_url:r.cloud_doc_url,text:O?r.description:void 0,id:r.id,lastModifiedTime:r.last_modified_time};if(!!!S.cloud_doc_url&&!H(S.id))return;d.push(S),_.has(s.type)&&((M=_.get(s.type))==null||M.push(S)),p.add(r.id)}}):s.type==="grouped_webpages"&&h&&s.items.forEach(r=>{var b,v,M,j;if(!p.has(r.url)){const S=G((b=r.url)!=null?b:""),J={name:(v=S==null?void 0:S.type)!=null?v:r.title,subtitle:S!=null&&S.type?r.title:void 0,cloud_doc_url:r.url,text:O&&(M=r.snippet)!=null?M:void 0,journal_name:r.attribution,id:r.url};d.push(J),_.has(s.type)&&((j=_.get(s.type))==null||j.push(J)),p.add(r.url)}})}),A.length>0){const s=[];return A.forEach(a=>{var l;_.has(a)&&s.push(...(l=_.get(a))!=null?l:[])}),s}return d},[A,q,O,h,I]),Z=T.useMemo(()=>{var _,s;if(!E||n==="bottom")return[];const d=[],p=new Set;for(const a of i)if(a.author.role===Q.Tool&&a.author.name==="file_search"&&a.content.content_type===z.TetherBrowsingDisplay){const l=ke(a.content.result),f=(s=(_=a.metadata)==null?void 0:_.cloud_doc_urls)!=null?s:[];l.chunks.forEach((c,y)=>{var r,b;if(!c.documentId||p.has(c.documentId))return;let m;if(c.metadata.cloud_doc_url)m=c.metadata.cloud_doc_url.toString();else if(y<f.length)m=f[y];else if(c.documentId.endsWith("--google")){const v=c.documentId.split("--")[1];m="https://drive.google.com/file/d/".concat(v)}if(!m)return;p.add(c.documentId);const w=(r=c.metadata["File last modified at"])!=null?r:c.metadata["File created at"],x=G(m!=null?m:""),g={id:c.documentId,name:(b=x==null?void 0:x.type)!=null?b:c.title,subtitle:x!=null&&x.type?c.title:void 0,cloud_doc_url:m,text:c.contents,lastModifiedTime:w?w.toString():void 0};Ce(c,g),d.push(g)})}return d},[E,i,n]),$=T.useMemo(()=>{var p,_,s;if(n==="bottom"||!k)return[];const d=[];for(const a of i)if(a.author.role===Q.Tool&&a.author.name==="api_tool.call_tool"&&a.content.content_type===z.MultimodalText){const l=(p=a.metadata)==null?void 0:p.citation_metadata,f=l==null?void 0:l.id;if(!l||!f||!l.url)continue;const m=a.content.parts[1].toString().split("\n").flatMap(g=>{const r=we.exec(g);return r?[r[1]]:[]}).flatMap(g=>{const r=Me.exec(g);return r?/^\s*[^()]+?\s*\(\s*display_name:\s*([^;]+);\s*real_name:\s*([^;]+);\s*username:\s*[^)]+\)\s*:/i.exec(r[2])?[r[2].trim().replace(/^\s*[^()]+?\s*\(\s*display_name:\s*([^;]+);\s*real_name:\s*([^;]+);\s*username:\s*[^)]+\)\s*:/i,(v,M,j)=>"".concat((j==null?void 0:j.trim())||(M==null?void 0:M.trim()),":")).replace(/\r/g,"")]:[r[2].trim()]:[]}),{Icon:w,appName:x}=se({connectorId:l.__connector_id,cloud_doc_url:l.url,availableConnectors:I});d.push(o.jsx(ie,{clientThreadId:t,item:{id:f,name:x||l.title,subtitle:x?l.title:void 0,cloud_doc_url:l.url,text:m.slice(0,3).join("\n"),lastModifiedTime:l.last_modified_at,Icon:w}},"".concat(a.id,"-").concat(f)))}else if(a.author.role===Q.Assistant&&a.recipient==="api_tool.call_tool"&&a.content.content_type===z.Code&&a.content.language==="json"){let l={};try{if(l=JSON.parse(a.content.text),typeof l.args=="string")try{l.args=JSON.parse(l.args)}catch(c){continue}}catch(c){continue}if(!l.path)continue;const f=[];if(l.path==="mixer://search"&&typeof((_=l.args)==null?void 0:_.sources)=="object"){const c=l.args.sources;for(const y in c){const m=c[y],w=ne(y);if(w){const x=new Set;m.forEach(g=>{g.query&&!x.has(g.query)&&(f.push(C(U({},w),{query:g.query})),x.add(g.query))})}}}else if((s=l.args)!=null&&s.query){const c=ne(l.path);c&&f.push(C(U({},c),{query:l.args.query}))}if(!f.length)continue;d.push(o.jsx("div",{className:"flex flex-row flex-wrap items-center gap-2 px-3 py-2.5",children:f.length<=3?f.map((c,y)=>o.jsx(re,{query:c.query},a.id+y)):o.jsxs(o.Fragment,{children:[f.slice(0,3).map((c,y)=>o.jsx(re,{query:c.query},a.id+y)),o.jsx(Oe,{maxResults:3,queries:f},a.id+"query-overflow")]})},a.id))}return d},[t,i,n,k,I]);return o.jsx(be,{children:o.jsxs("div",{className:P("bg-token-main-surface-primary flex w-full flex-col",n==="sidebar"&&"mt-[calc(var(--threadFlyOut-leading-height,57px)*-1)]"),children:[o.jsx(ce,{title:o.jsx(W,{id:"dlVlo6",defaultMessage:"Citations"}),items:B,clientThreadId:t,sectionId:"citations",analyticsMetadata:L}),!F&&o.jsx(ce,{title:o.jsx(W,{id:"njZblE",defaultMessage:"Search Results"}),items:Z,clientThreadId:t,sectionId:"search-results",analyticsMetadata:L,unstructuredResults:$})]})})}function ce({title:e,items:t,scrollToHeader:n,shouldAnimateScroll:u,clientThreadId:N,analyticsMetadata:F,sectionId:h,unstructuredResults:A=[]}){const q=Y(),i=ve(q),R=T.useRef(null),E=T.useMemo(()=>F?C(U({},F),{sectionId:h,numResultsInSection:t.length}):void 0,[F,t.length,h]);return T.useEffect(()=>{R.current&&n&&setTimeout(()=>{R.current&&R.current.scrollIntoView({behavior:u?"smooth":"instant"})},300)},[n,u]),A.length===0&&(!t||t.length===0)?null:o.jsxs("div",{ref:R,children:[o.jsx(le,{className:P("bg-token-main-surface-primary text-token-text-primary sticky top-0 z-1 flex items-center px-6 pt-4 pb-4 text-sm font-medium",i?"border-b-thin h-[var(--header-height,3.5rem)] border-(--bento-border-color)":"border-token-border-sharp h-[calc(var(--header-height,3.5rem)+1px)] border-b"),children:e}),o.jsxs("div",{className:"flex list-none flex-col px-3 py-2",children:[t.map((I,k)=>o.jsx(le,{index:k,children:o.jsx(ie,{positionInSection:k,item:I,analyticsMetadata:E,clientThreadId:N},k)},"".concat(e,"-").concat(k))),A]})]})}function ie({item:e,analyticsMetadata:t,positionInSection:n,clientThreadId:u}){var $,d,p;const N=Y(),F=je(),h=ae(N),A=Te(N),q=h&&e.journal_name!=null?e.journal_name:e.name,i=G(($=e.cloud_doc_url)!=null?$:"");let R=q!=null?q:o.jsx(W,{id:"bqY3sN",defaultMessage:"File"}),E=e.Icon?()=>e.Icon:(d=i==null?void 0:i.Icon)!=null?d:e.cloud_doc_url?V:Ne;!e.cloud_doc_url&&!H(e.id)&&(R=o.jsx(W,{id:"hGgoxF",defaultMessage:"Source"}),E=V);const[I,k]=T.useState(!1);let O=e.cloud_doc_url?e.cloud_doc_url:"";A&&e.journal_homepage_url&&(O=e.journal_homepage_url),h&&O.length>0&&(E=({className:_})=>o.jsx(Re,{url:O,className:P(_,"object-cover"),size:32,fallback:o.jsx(V,{className:_})}));const L=T.useCallback(()=>{t&&te.logEventWithStatsig("File Sources Sidebar Item Clicked","file_sources_sidebar_link_clicked",C(U({},t),{positionInSection:n,sourceType:i==null?void 0:i.type,hasUrl:!!e.cloud_doc_url}))},[t,e.cloud_doc_url,i==null?void 0:i.type,n]),B=T.useCallback(()=>{t&&te.logEventWithStatsig("File Source Sidebar Item Followup Clicked","file_sources_sidebar_item_followup_clicked",C(U({},t),{positionInSection:n,sourceType:i==null?void 0:i.type,hasUrl:!!e.cloud_doc_url}))},[t,e.cloud_doc_url,i==null?void 0:i.type,n]);return o.jsx(o.Fragment,{children:o.jsxs("a",{href:e.cloud_doc_url,target:"_blank",rel:"noreferrer",onClick:L,className:P("group relative flex flex-col gap-0.5 rounded-xl px-3 py-2.5","hover:bg-token-main-surface-secondary",I&&"bg-token-main-surface-secondary"),children:[o.jsxs("div",{className:"ellipses flex h-6 items-center gap-2 text-xs",children:[E&&o.jsx(E,{className:"icon-sm bg-primary flex-none rounded-full object-cover"}),o.jsx("p",{className:"text-token-text-secondary flex-auto truncate overflow-ellipsis",children:R})]}),h&&e.name!=null&&o.jsx("div",{className:"line-clamp-2 text-sm font-bold break-words",children:e.name}),h&&e.authors!=null&&e.publication_year!=null&&o.jsxs("div",{className:"line-clamp-2 text-sm break-words",children:[o.jsx("span",{className:"italic",children:e.authors}),o.jsx("span",{className:"ms-1 not-italic",children:e.publication_year})]}),h&&e.doi!=null&&o.jsx("div",{className:"line-clamp-2 text-sm break-words",children:e.doi}),e.subtitle&&o.jsx("div",{className:"text-token-text-primary line-clamp-1 text-sm font-semibold",children:e.subtitle}),((p=e.text)!=null?p:e.lastModifiedTime)&&o.jsxs("div",{className:"text-token-text-secondary line-clamp-2 text-sm leading-snug font-normal",children:[e.lastModifiedTime&&o.jsxs("span",{children:[o.jsx(Ae,{date:new Date(e.lastModifiedTime.trim())}),e.text&&" â€” "]}),e.text]}),F?null:o.jsx(qe,{className:P("absolute end-2 top-2 flex h-7 w-7 items-center justify-center rounded-sm p-1 transition","text-token-text-secondary group-hover:text-token-text-primary","invisible group-hover:visible","bg-token-main-surface-secondary hover:bg-token-main-surface-tertiary",I&&"bg-token-main-surface-tertiary text-token-text-primary visible"),clientThreadId:u,fileId:e.id,fileName:e.name,fileCloudDocUrl:e.cloud_doc_url,isFollowupMenuOpen:I,setIsFollowupMenuOpen:k,trackFileSourceFollowup:B})]})})}export{Ve as ChatScreenRetrievalResultsFlyoutContent,ce as SourcesListGroup,Ce as __hacky_maybe_enhance_ref};
//# sourceMappingURL=kzv3lmwfjxg7fbwd.js.map
