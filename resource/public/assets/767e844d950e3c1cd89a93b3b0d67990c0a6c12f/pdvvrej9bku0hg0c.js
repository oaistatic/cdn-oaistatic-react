var k=Object.defineProperty,S=Object.defineProperties;var b=Object.getOwnPropertyDescriptors;var a=Object.getOwnPropertySymbols;var _=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var w=(e,t,n)=>t in e?k(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,o=(e,t)=>{for(var n in t||(t={}))_.call(t,n)&&w(e,n,t[n]);if(a)for(var n of a(t))B.call(t,n)&&w(e,n,t[n]);return e},I=(e,t)=>S(e,b(t));var y=(e,t)=>{var n={};for(var r in e)_.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&a)for(var r of a(e))t.indexOf(r)<0&&B.call(e,r)&&(n[r]=e[r]);return n};import{cn as f,co as d,cp as W,D as s}from"./d0xa318sl7ywi0za.js";import{r as R}from"./mw35uwhq4g8r9eam.js";function m(e){const t=new TextEncoder().encode(e);let n="";for(let r=0;r<t.length;r++)n+=String.fromCharCode(t[r]);return btoa(n)}function T(e){const t=atob(e),n=new Uint8Array(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return new TextDecoder().decode(n)}const N=e=>W(e);var l=(e=>(e.SET_WRITING_BLOCK="SET_WRITING_BLOCK",e.RESET_WRITING_BLOCK="RESET_WRITING_BLOCK",e.FORCE_SAVE="FORCE_SAVE",e))(l||{});const O={SET_WRITING_BLOCK:f({message_id:d,writing_block:N,client_thread_id:d}),RESET_WRITING_BLOCK:f({}),FORCE_SAVE:f({message_id:d,writing_block_id:d})};var c=(e=>(e.WRITING_BLOCK_UPDATED="WRITING_BLOCK_UPDATED",e.WRITING_BLOCK_SAVED="WRITING_BLOCK_SAVED",e.WRITING_BLOCK_READY="WRITING_BLOCK_READY",e))(c||{});function C(e){let t;try{t=JSON.parse(e)}catch(K){return s.addError("[WritingBlockBridge] Invalid JSON received from native app"),null}if(typeof t!="object"||t==null||!("type"in t)||typeof t.type!="string")return s.addError("[WritingBlockBridge] Message missing required `type` field.",{raw:t}),null;const n=O[t.type];if(!n)return s.addError("[WritingBlockBridge] Unknown message type.",{raw:t}),null;const r=n(t);return o({type:t.type},r)}let i=null;const g=new Set;function p(){for(const e of g)e()}function h(e){return g.add(e),()=>g.delete(e)}function E(){return i}function U(){"use forget";return R.useSyncExternalStore(h,E,E)}function A(e){i=o({},e),p()}function v(){i=null,p()}function F(e){if(!i)return null;const r=e,{writingBlock:t}=r,n=y(r,["writingBlock"]);return i=I(o(o({},i),n),{writingBlock:t?o(o({},i.writingBlock),t):i.writingBlock}),p(),i}function u(){const e=L();return e==="android"?{platform:e,sendMessage:t=>{var n;(n=window.WritingBlockNativeApp)==null||n.sendMessage(m(t))}}:e==="ios"?{platform:e,sendMessage:t=>{var n,r;(r=(n=window.webkit)==null?void 0:n.messageHandlers.writingBlockNative)==null||r.postMessage(m(t))}}:{platform:"web",sendMessage:()=>{}}}function L(){return typeof window.WritingBlockNativeApp<"u"?"android":typeof window.webkit<"u"&&typeof window.webkit.messageHandlers.writingBlockNative<"u"?"ios":"web"}function G(){typeof window>"u"||(window.writingBlockWebApp={sendMessage:e=>{const t=T(e),n=C(decodeURIComponent(t));if(!n){console.warn("Invalid payload passed to sendMessageToWebApp");return}switch(n.type){case l.SET_WRITING_BLOCK:A({messageId:n.message_id,writingBlock:n.writing_block,clientThreadId:n.client_thread_id});break;case l.RESET_WRITING_BLOCK:v();break}}})}typeof window<"u"&&G();function P(e){if(!e||typeof window>"u")return;const t=u();if(t.platform==="web")return;const n={type:c.WRITING_BLOCK_UPDATED,message_id:e.messageId,writing_block:e.writingBlock,client_thread_id:e.clientThreadId};try{t.sendMessage(JSON.stringify(n))}catch(r){s.addError("[WritingBlockBridge] Failed to notify native app of update",{error:r,platform:t.platform})}}function V(e){if(!e||typeof window>"u")return;const t=u();if(t.platform==="web")return;const n={type:c.WRITING_BLOCK_SAVED,message_id:e.messageId,writing_block:e.writingBlock,client_thread_id:e.clientThreadId};try{t.sendMessage(JSON.stringify(n))}catch(r){s.addError("[WritingBlockBridge] Failed to notify native app of save",{error:r,platform:t.platform})}}function x(){if(typeof window>"u")return;const e=u();if(e.platform==="web")return;const t={type:c.WRITING_BLOCK_READY};try{e.sendMessage(JSON.stringify(t))}catch(n){s.addError("[WritingBlockBridge] Failed to notify native app that web app is ready",{error:n,platform:e.platform})}}export{F as a,P as b,x as c,V as n,A as s,U as u};
//# sourceMappingURL=pdvvrej9bku0hg0c.js.map
