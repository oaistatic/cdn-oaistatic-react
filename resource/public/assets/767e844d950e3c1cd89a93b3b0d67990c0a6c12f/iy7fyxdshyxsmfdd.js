var H=Object.defineProperty,J=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var A=(e,t,a)=>t in e?H(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,g=(e,t)=>{for(var a in t||(t={}))T.call(t,a)&&A(e,a,t[a]);if(w)for(var a of w(t))F.call(t,a)&&A(e,a,t[a]);return e},j=(e,t)=>J(e,X(t));var y=(e,t)=>{var a={};for(var n in e)T.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&w)for(var n of w(e))t.indexOf(n)<0&&F.call(e,n)&&(a[n]=e[n]);return a};import{h as C,j as s,r as l,M as O}from"./mw35uwhq4g8r9eam.js";import{qV as Q,cE as ee,lI as se,cO as B,jn as te,cI as ae,c$ as re,qW as ne,qX as ie,qY as V,ba as P,fV as le,qZ as oe,jP as ce,q_ as ue,aJ as de,q$ as me}from"./g2euln7v5pbm31qa.js";import{C as xe,a as fe,S as pe}from"./onzd13hqm91228av.js";import{cF as M,ek as D,e5 as U,gw as $,l_ as I,cw as he,u as W,uK as R,km as ge,M as je,jf as ye,V as be,fw as Ne,fx as Me,p as Se,gT as q,fq as we,k as ve}from"./d0xa318sl7ywi0za.js";import{S as z}from"./67527rwulsulsisq.js";import"./fhb510ji3eot09yv.js";import"./e237h6ukoc2vt16i.js";import"./cz2iwgzw4rck3xnv.js";import"./mpb8yfob3hqr4zw5.js";import"./e5bg4yzr7nht9sxr.js";import"./iue4s7sqsxkz98qq.js";import"./ejv9rjzfbwh1dn9a.js";import"./e1vcfcyx8u6zde85.js";import"./idtxxq2b89y0p07a.js";import"./mfq2eda4qxrcz3ws.js";import"./m9dg467qzmmahw21.js";function ke({label:e,tab:t,activeTab:a,setActiveTab:n,caterpillarHeaderRef:r}){const c=l.useCallback(()=>{n(t),r.current&&r.current.scrollIntoView({behavior:"instant",block:"center"})},[n,t,r]),o=a===t;return s.jsx("button",{onClick:c,className:M("btn text-token-text-primary min-h-[36px]! min-w-[100px] rounded-full px-2 py-1 select-none",o?"bg-token-main-surface-primary shadow-sm":"bg-token-main-surface-tertiary!"),children:e})}function _e({activeTab:e,setActiveTab:t,sourcesCount:a,showAuxTab:n=!1,caterpillarHeaderRef:r}){const c=C(),o=[{tab:"activity",label:c.formatMessage({id:"9lnBJU",defaultMessage:"Activity"})},{tab:"sources",label:a>1?c.formatMessage({id:"/Ucokx",defaultMessage:"{sourcesCount} Sources"},{sourcesCount:a}):a===1?c.formatMessage({id:"CCF0z+",defaultMessage:"1 Source"}):c.formatMessage({id:"twjHy3",defaultMessage:"Sources"})}];return n&&o.unshift({tab:"report",label:c.formatMessage({id:"zF7Fu5",defaultMessage:"Report"})}),s.jsx("div",{className:M("border-token-main-surface-tertiary bg-token-main-surface-tertiary flex items-center rounded-full border-[4px] transition-all"),children:o.map(({tab:d,label:u})=>s.jsx(ke,{activeTab:e,tab:d,setActiveTab:t,label:u,caterpillarHeaderRef:r},d))})}const v=({children:e,icon:t,fillIcon:a,className:n})=>s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx("div",{className:M("mt-[3px] inline-flex h-5 w-5 shrink-0 items-center justify-center gap-2.5 rounded-[30px]",a&&"border border-black/10 bg-white",n),children:t}),e]});function b({icon:e,message:t,iconClassName:a}){return s.jsx("div",{className:"loading-shimmer-pure-text flex h-8 gap-1 overflow-hidden",children:s.jsx(v,{fillIcon:!1,icon:e,className:a,children:s.jsx("div",{className:"mt-[.5px] flex h-10",children:t})})})}const Ce=({finalRow:e})=>{var n;const t=C(),a=e.type==="fileOpen"?(n=Q[e.iconType])!=null?n:ee:null;return s.jsx(D,{children:s.jsx(U.div,{layout:!0,transition:{type:"spring",stiffness:300,damping:30},className:"flex flex-col items-start justify-start gap-4",children:e.type==="search"?s.jsx(b,{icon:s.jsx($,{className:"text-token-text-primary relative h-5 w-5 opacity-50"}),message:t.formatMessage({id:"f9wsyE",defaultMessage:"Searching…"})}):e.type==="websiteOpen"?s.jsx(b,{icon:s.jsx(se,{className:"inline-flex h-5 w-5 items-center justify-center opacity-50"}),message:t.formatMessage({id:"8L6BBp",defaultMessage:"Reading…"})}):e.type==="fileOpen"?s.jsx(b,{icon:s.jsx(a,{className:"inline-flex h-5 w-5 items-center justify-center opacity-50"}),message:t.formatMessage({id:"h5M4/O",defaultMessage:"Reading file…"})}):e.type==="pythonAnalysis"?s.jsx(b,{icon:s.jsx(z,{className:"inline-flex h-5 w-5 items-center justify-center opacity-50"}),message:t.formatMessage({id:"jZ7gNw",defaultMessage:"Analyzing…"})}):s.jsx(b,{icon:s.jsx(I,{className:"inline-flex h-5 w-5 items-center justify-center opacity-50"}),message:t.formatMessage({id:"bSPYmC",defaultMessage:"Thinking…"})})})})},Ie=({children:e})=>s.jsxs("div",{className:"flex items-start gap-2 text-start text-wrap",children:[s.jsx("div",{className:"mt-[1px] inline-flex h-5 w-5 shrink-0 items-center justify-end gap-2.5 pt-[3px]",children:s.jsx(z,{className:"text-token-text-primary relative h-5 w-5"})}),e]}),Ee=({row:e})=>s.jsx(Ie,{children:s.jsx("div",{className:"text-token-text-primary flex text-base",children:e.analysisSummary})}),Ae=({children:e,showIcon:t})=>s.jsxs("div",{className:"flex items-start gap-2 text-start text-wrap",children:[s.jsx("div",{className:"mt-[1px] inline-flex h-5 w-5 shrink-0 items-center justify-end gap-2.5 pt-[3px]",children:t&&s.jsx($,{className:"text-token-text-primary relative h-5 w-5"})}),e]}),Te=({row:e,showIcon:t})=>{const a=e.query;return a?s.jsx(Ae,{showIcon:t,children:s.jsx("div",{className:"text-token-text-primary flex text-base",children:a})}):null};function Fe({children:e,showIcon:t=!0}){return s.jsx(v,{fillIcon:!1,icon:t?s.jsx(I,{className:"text-token-text-primary inline-flex h-5 w-5 items-center justify-center"}):null,children:e})}const Oe={strong:e=>{const r=e,{node:t,children:a}=r,n=y(r,["node","children"]);return s.jsx("strong",j(g({},n),{className:M(n.className,"text-token-text-primary font-semibold"),children:a}))},p:e=>{const r=e,{node:t,children:a}=r,n=y(r,["node","children"]);return s.jsx("p",j(g({},n),{className:M(n.className,"mb-0! text-base"),children:a}))}};function Re(e){return e.replace(/^#+\s*.*$/gm,"").replace(/^\*\*.*\*\*$/gm,"").trim()}function qe({row:e,showIcon:t=!0}){const a=e.summary;if(!a)return null;const n=Re(a);return n.length===0?null:s.jsx(Fe,{showIcon:t,children:s.jsx(B,{componentOverrides:Oe,className:"w-0! flex-1 leading-6",children:n})})}function Le(e){try{const{hostname:t}=new URL(e);return t}catch(t){return null}}const Be={p:e=>{const r=e,{node:t,children:a}=r,n=y(r,["node","children"]);return s.jsx("p",j(g({},n),{className:"text-token-text-primary text-start text-base",children:a}))},a:e=>{const r=e,{node:t,children:a}=r,n=y(r,["node","children"]);return s.jsx("a",j(g({},n),{className:"text-blue! text-base leading-6",children:a}))}},Ve=({website:e})=>{const t=Le(e.url);return t?s.jsxs("div",{className:"flex items-start justify-start gap-2",children:[s.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",children:s.jsx(he,{label:t,className:"bg-token-main-surface-primary mt-[3px] flex h-5 w-5 shrink-0 cursor-pointer items-center justify-center",children:s.jsx(te,{url:e.url,size:"xsmall",className:"h-5 w-5",fallback:s.jsx(ae,{url:e.url,className:"h-5 w-5 rounded-2xl border-[.5px] border-black/25",fallback:s.jsx(re,{className:"icon-sm text-token-text-quaternary"})})})})}),s.jsx("div",{className:"text-token-text-primary mt-[1px] flex flex-col text-base",children:s.jsx(B,{componentOverrides:Be,children:e.rowText})})]}):null};function N({children:e}){return s.jsx(U.div,{className:"w-full",initial:{opacity:0},animate:{opacity:1},transition:{duration:1},children:e})}const Pe=({previousRow:e,currentRow:t})=>s.jsx("div",{className:"flex flex-col items-start justify-start gap-4",children:t.type==="search"?s.jsx(N,{children:s.jsx(Te,{row:t,showIcon:!e||e.type!=="search"})},"search_".concat(t.id)):t.type==="summary"?s.jsx(N,{children:s.jsx(qe,{row:t,showIcon:!e||e.type!=="summary"})},"summary_".concat(t.id)):t.type==="websiteOpen"?s.jsx(N,{children:s.jsx(Ve,{website:t})},"website_".concat(t.id)):t.type==="fileOpen"?s.jsx(N,{children:s.jsx(ne,{row:t})},"file_".concat(t.id)):t.type==="pythonAnalysis"?s.jsx(N,{children:s.jsx(Ee,{row:t})},"python_".concat(t.id)):null}),De=120,Ue=1e3*60*2;function L(e){e==null||e.scrollIntoView({block:"center",behavior:"smooth"})}function $e({caterpillarStatusMessageTexts:e}){return s.jsx("div",{className:"p-4",children:s.jsx(P,{type:"error",title:e.failureMessage,content:e.failureBannerContentMessage})})}function We({caterpillarStatusMessageTexts:e}){return s.jsx("div",{className:"p-4",children:s.jsx(P,{title:e.cancelledMessage,content:""})})}function ze({sourcesCount:e,taskInfo:t}){const a=je(t.originalConversationId,r=>{var c,o;return(o=(c=be.findNode(r,d=>{var u,i;return((u=d.message.metadata)==null?void 0:u.b1de6e2_s)===!0&&((i=d.message.metadata)==null?void 0:i.async_task_id)===t.taskId}))==null?void 0:c.message.metadata)==null?void 0:o.async_task_status_messages}),n=l.useMemo(()=>{var r;return a!=null&&a.completed_no_time?s.jsxs(s.Fragment,{children:[(r=a==null?void 0:a.completed_with_time)!=null?r:a==null?void 0:a.completed_no_time,s.jsx(O,{id:"zxfmo/",defaultMessage:" · {sourcesCount} sources",values:{sourcesCount:e}})]}):s.jsx(O,{id:"YG7a0T",defaultMessage:"Completed · {sourcesCount} sources",values:{sourcesCount:e}})},[e,a]);return!t.updatedAt&&!(a!=null&&a.completed)?null:s.jsx(v,{icon:s.jsx(ye,{className:"text-token-text-secondary"}),fillIcon:!1,children:s.jsx("div",{className:"text-token-text-tertiary",children:n})})}function Ye({taskInfo:e,caterpillarStatusMessageTexts:t,sourcesCount:a,caterpillarHeaderRef:n}){const r=W(),[c,o]=l.useState(!1),d=l.useRef(!1),u=l.useRef(null),i=l.useMemo(()=>{var m;return d.current=!!u.current&&ie(u.current,De),(m=e.rows)!=null?m:[]},[e.rows]);l.useEffect(()=>{if(i.length===0){const m=new Date(e.createdAt).getTime(),f=Date.now()-m,S=Ue-f;if(S>0){const _=setTimeout(()=>{o(!0)},S);return()=>clearTimeout(_)}else o(!0)}else o(!1)},[i,e.createdAt]),l.useEffect(()=>{d.current&&L(u.current)},[i]),l.useEffect(()=>{R(e)||setTimeout(()=>{u.current&&L(u.current)},100)},[]);const x=R(e)||ge(e),h=V(r),k=l.useMemo(()=>i.length&&!x&&!h?i.slice(0,i.length-1):i,[i,x,h]);return s.jsxs("div",{className:"flex flex-col",children:[s.jsx("div",{ref:n},"task-header"),s.jsxs("div",{className:"flex w-full flex-col gap-4",children:[s.jsx("div",{className:"text-base font-medium",children:e.title}),i.length?s.jsxs(D,{initial:!1,children:[k.map((m,f)=>s.jsx(Pe,{previousRow:f>0?i[f-1]:null,currentRow:m},m.id)),!x&&s.jsx(Ce,{finalRow:i[i.length-1]})]}):c?s.jsx(v,{fillIcon:!1,icon:s.jsx(I,{className:"text-token-text-primary inline-flex h-5 w-5 items-center justify-center"}),children:t.waitingInQueueMessage}):s.jsx(xe,{}),e.status==="failed"?s.jsx($e,{caterpillarStatusMessageTexts:t}):e.status==="cancelled"?s.jsx(We,{caterpillarStatusMessageTexts:t}):e.status==="completed"?s.jsx(ze,{caterpillarStatusMessageTexts:t,taskInfo:e,sourcesCount:a}):null]}),s.jsx("div",{ref:u},"task-footer")]})}function us({taskId:e,setWidth:t=void 0,initialTab:a}){const n=W(),r=Ne(p=>Me.getTask(e,p)),{closeThreadSidebar:c}=le(),[o,d]=l.useState(a),u=oe(),i=l.useRef(null),x=!1;l.useEffect(()=>{d(a)},[a]),l.useEffect(()=>{},[r==null?void 0:r.taskId,r==null?void 0:r.status,x]),l.useEffect(()=>{},[r==null?void 0:r.taskId,r==null?void 0:r.status,o]),l.useEffect(()=>{},[t,r,x]);const h=C(),k=Se(),m=V(n),f=ce({taskId:r==null?void 0:r.taskId,intl:h,toaster:k}),S=()=>f.mutate(),_=()=>{r&&ve(r.originalConversationId,p=>{p.steeringAsyncTaskId=r.taskId})},{uniqueSources:Y,totalSources:E}=l.useMemo(()=>{if(!(r!=null&&r.rows))return{uniqueSources:[],totalSources:0};const p=ue(r.rows),G=p.reduce((K,Z)=>K+Z.count,0);return{uniqueSources:p,totalSources:G}},[r==null?void 0:r.rows]);return s.jsx(de,{ariaLabel:h.formatMessage({id:"region.sidebar.caterpillar",defaultMessage:"Tasks"}),handleClose:c,trailing:r&&m&&q(r)&&s.jsx(pe,{onAddContext:_,onStopTask:S,taskIsFinalizing:r.status===we.FINALIZING}),leading:s.jsx("div",{className:"flex w-full justify-center",children:s.jsx(_e,{activeTab:o,setActiveTab:d,showAuxTab:x,sourcesCount:E,caterpillarHeaderRef:i})}),children:r&&s.jsxs(fe,{children:[!1,o==="activity"&&s.jsx(Ye,{taskInfo:r,caterpillarStatusMessageTexts:u,sourcesCount:E,caterpillarHeaderRef:i}),o==="sources"&&s.jsx(me,{taskIsPending:q(r),finalMessage:r.finalMessage,sources:Y,caterpillarHeaderRef:i})]})})}export{us as CaterpillarSidebar};
//# sourceMappingURL=iy7fyxdshyxsmfdd.js.map
