var oe=Object.defineProperty,ie=Object.defineProperties;var le=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var ce=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var D=(t,e,n)=>e in t?oe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,S=(t,e)=>{for(var n in e||(e={}))ce.call(e,n)&&D(t,n,e[n]);if(F)for(var n of F(e))ue.call(e,n)&&D(t,n,e[n]);return t},R=(t,e)=>ie(t,le(e));import{r as m,h as me,j as a,w as de}from"./mw35uwhq4g8r9eam.js";import{bP as A,u as U,f5 as K,cy as X,d as P,kC as fe,eu as H,ot as he,iZ as xe,aP as ge,a as pe,dp as ve,h5 as we,aA as W,o5 as be,aJ as Ie,P as ye,fH as B,hC as Z,_ as C,iK as _e,cF as $,V as O,h9 as je,e5 as ke,cm as Se}from"./d0xa318sl7ywi0za.js";import{ej as Re,X as Le,dL as Ne,d3 as z,lF as L,c_ as Ee,cI as Ce,na as Me,nb as Te}from"./g2euln7v5pbm31qa.js";import{g as Ae}from"./fow8bkv2d2ka2w3o.js";import{g as qe,u as Pe,a as Oe,b as G}from"./i1lnixtvuwzfguvz.js";import{g as ze}from"./eder15khh2fy5wd2.js";const J=m.createContext({imageList:[],activeIndex:null,isInFocusMode$:A(!1),isZoomed$:A(!1)}),M=()=>m.useContext(J);function q(){for(var t,e=0,n="",s=arguments.length;e<s;e++)(t=arguments[e])&&typeof t=="string"&&(n+=(n&&" ")+t);return n}const Ve="_lightbox_1ruyj_1",Fe={lightbox:Ve};function De({imageList:t,forceDarkMode:e=!1,initialIndex:n,isInFocusMode$:s,onClose:i,onScrollToEnd:c,children:d}){var V;const h=U(),p=me(),x=m.useRef(null),I=Re(h),[u,b]=m.useState(n),j=K(),y=X(),[o]=m.useState(()=>{var r,l;return A(((l=(r=window.visualViewport)==null?void 0:r.scale)!=null?l:1)!==1)}),g=P(()=>o());m.useEffect(()=>{I.signalTransitionReady()},[I]),m.useEffect(()=>{if(g)return fe(()=>{o()||requestAnimationFrame(()=>{var l,f;(f=(l=x.current)==null?void 0:l.querySelector('[data-position="'.concat(u,'"]')))==null||f.scrollIntoView({behavior:"smooth",inline:"center",block:"center"})})})},[g,u,o]),m.useEffect(()=>{var l;const r=()=>{var f,_;return o.set(((_=(f=window.visualViewport)==null?void 0:f.scale)!=null?_:1)!==1)};return(l=window.visualViewport)==null||l.addEventListener("resize",r),()=>{var f;return(f=window.visualViewport)==null?void 0:f.removeEventListener("resize",r)}},[o]),H(()=>{var r,l;(l=(r=x.current)==null?void 0:r.querySelector('[data-position="'.concat(n,'"]')))==null||l.scrollIntoView({behavior:"instant",inline:"center",block:"center"})},[n]);const v=m.useCallback(r=>{b(r),requestAnimationFrame(()=>{var f;const l=(f=t[r])==null?void 0:f.title;l&&he.setLiveRegionPolite(l)}),r===t.length-1&&(c==null||c())},[t,c]);H(()=>{const r=x.current;if(!r)return;const l=new IntersectionObserver(f=>{const _=f.reduce((E,T)=>T.isIntersecting&&(!E||T.intersectionRatio>E.intersectionRatio)?T:E,null);_&&_.target instanceof HTMLElement&&v(xe(_.target.dataset.position))},{root:r,rootMargin:"0px -50% 0px -50%",threshold:0});for(const f of r.querySelectorAll(":scope > li"))l.observe(f);return()=>{l.disconnect()}},[t,v]);const w=t.length-1,k=m.useCallback(r=>{const l=Math.min(Math.max(u+r,0),w);v(l),requestAnimationFrame(()=>{var f,_;(_=(f=x.current)==null?void 0:f.querySelector('[data-position="'.concat(l,'"]')))==null||_.scrollIntoView({behavior:j?"instant":"smooth",block:"center",inline:"center"})})},[u,w,j,v]);m.useEffect(()=>{requestAnimationFrame(()=>{const r=document.querySelector("[data-lightbox-close-button]");r instanceof HTMLElement&&r.focus()})},[]),m.useEffect(()=>{const r=l=>{if(s!=null&&s()){l.key==="Escape"&&s.set(!1);return}l.key==="ArrowLeft"?u>0&&(l.preventDefault(),k(-1)):l.key==="ArrowRight"?u<w&&(l.preventDefault(),k(1)):l.key==="Escape"&&i(u)};return window.addEventListener("keydown",r),()=>{window.removeEventListener("keydown",r)}},[u,w,k,i,s]),m.useEffect(()=>{ge(pe(),"chatgpt_web_image_library_lightbox_image_viewed")},[u]);const{footer:ne,items:se,title:ae,headerActions:re}=ze(d,{title:Y,items:ee,footer:te,headerActions:He});return a.jsx(J.Provider,{value:{imageList:t,activeIndex:u,isInFocusMode$:s,isZoomed$:o},children:a.jsxs(ve.Root,{testId:"modal-image-gen-lightbox",isOpen:!0,onClose:()=>i(u),shouldIgnoreClickOutside:y,className:q(y||e?"dark bg-black":"bg-token-bg-primary","flex h-dvh max-h-full w-dvw max-w-full flex-col place-content-center",Fe.lightbox),children:[a.jsxs("section",{className:"grid grid-cols-[auto_1fr_auto] items-start px-1 pt-1 [view-transition-name:var(--vt-page-title)] max-md:absolute max-md:start-0 max-md:end-0 max-md:top-0 max-md:items-center md:grid-cols-[1fr_auto_1fr] md:px-2 md:pt-2",children:[a.jsx("div",{className:"w-fit",children:a.jsx(Le,{icon:we,"data-lightbox-close-button":!0,onClick:()=>i(u),"aria-label":p.formatMessage({id:"f08aLO",defaultMessage:"Close"})})}),!g&&ae,(V=!g&&re)!=null?V:a.jsx("div",{className:"w-8 shrink-0 basis-auto"})]}),a.jsxs("div",{className:"no-scrollbar flex h-full snap-y snap-mandatory flex-col overflow-y-scroll scroll-smooth",onScroll:r=>{r.target.scrollTop===0&&!o()&&i(u)},children:[a.jsx("div",{className:"h-[15dvh] flex-shrink-0"}),a.jsxs("ol",{ref:x,className:q("flex max-h-full min-h-0 flex-shrink-0 grow basis-full gap-[min(10dvw,_200px)] overflow-x-auto scroll-smooth [anchor-name:--carousel] [view-transition-name:var(--vt-image-carousel)] max-md:gap-0",y&&"no-scrollbar",!g&&"snap-x snap-mandatory snap-center snap-always py-15"),onClick:r=>{(r.target instanceof HTMLOListElement||r.target instanceof HTMLLIElement)&&(r.preventDefault(),i(u))},children:[a.jsx("li",{className:"w-[50vw] flex-shrink-0"}),se,a.jsx("li",{className:"w-[50vw] flex-shrink-0"})]}),a.jsx("div",{className:"h-[15dvh] flex-shrink-0"})]}),!g&&a.jsxs("div",{className:"pointer-events-none absolute inset-5 z-20 flex items-center justify-between [view-transition-name:var(--vt-scroll-buttons)] max-md:hidden",children:[a.jsx(W,{className:"pointer-events-auto aspect-square",disabled:u===0,color:"secondary",icon:be,onClick:()=>k(-1),"aria-label":p.formatMessage({id:"iQsFWe",defaultMessage:"Previous image"})}),a.jsx(W,{className:"pointer-events-auto aspect-square",color:"secondary",disabled:u===w,icon:Ne,onClick:()=>k(1),"aria-label":p.formatMessage({id:"W7vnD4",defaultMessage:"Next image"})})]}),!g&&ne]})})}function Y({children:t}){const{imageList:e,activeIndex:n}=M();if(n==null)return null;const s=e[n];return s?t(s):null}function ee({children:t}){const{imageList:e,isZoomed$:n,activeIndex:s}=M(),i=X(),c=K(),d=P(()=>n==null?void 0:n());return e.map((h,p)=>{var y;const{width:x,height:I}=h,u=x!=null&&I!=null&&x===I;let b=null;s!=null&&(p===s?b="current":p+1===s?b="before":p-1===s&&(b="after"));const j=!i&&b!=="current";return a.jsx("li",{role:j?"button":void 0,className:q("flex max-h-full max-w-[70dvw] flex-shrink-0 snap-center items-center justify-center transition-opacity duration-0 motion-safe:duration-300 max-md:w-[100dvw] max-md:max-w-[100dvw] max-md:snap-always max-md:opacity-100",u&&"aspect-square",b==="current"||d?"opacity-100":"opacity-40"),"data-position":p,onClick:j?({currentTarget:o})=>o.scrollIntoView({behavior:c?"instant":"smooth",block:"center",inline:"center"}):void 0,children:t(R(S({},h),{index:p,position:b}))},(y=h.id)!=null?y:h.url)})}function te({children:t}){const{imageList:e,activeIndex:n}=M();if(n==null)return null;const s=e[n];return s?a.jsx("footer",{className:"absolute bottom-0 z-10 flex w-full items-center justify-center px-5 pb-3 [view-transition-name:var(--vt-page-footer)] max-md:pb-6",children:t(s)}):null}function He({children:t}){const e=[];return m.Children.forEach(t,n=>{m.isValidElement(n)&&n.type===We&&e.push(n)}),a.jsx("div",{className:"flex items-center justify-end gap-2",children:e.map((n,s)=>a.jsx(m.Fragment,{children:n},s))})}function We({children:t}){const{imageList:e,activeIndex:n}=M();return n==null||e[n]==null?null:t(e[n])}function Be(t,e,n=!1){const s=O.getTurnContentReferences(t,e),i=Me(s),c=Ze(t,e),d=i.concat(c);if(n){const h=Ge(t,e);d.push(...h)}return je(d,"content_url")}function Ze(t,e){const n=O.getConversationTurnAtIndex(t,e).messages;return n?Se(n.flatMap(s=>{var i,c;return(c=(i=s.metadata)==null?void 0:i.image_results)!=null?c:[]})).map(s=>R(S({},s),{thumbnail_url:s.thumbnail_url.replace(/^http:\/\//,"https://"),content_url:s.content_url.replace(/^http:\/\//,"https://")})):[]}function Ge(t,e){return O.getSuperWidgetMessages(t,e).flatMap(s=>s.content.widgets.images)}function Qe(t,e,n,s){const{product:i}=Ae({thread:t,messageId:e,contentReferenceStartIndex:n,productIndex:s});return!i||!i.image_urls?[]:i.image_urls.map(c=>({url:c,content_url:c,thumbnail_url:c,title:i.title,content_size:{width:0,height:0},thumbnail_size:{width:0,height:0}}))}function at({clientThreadId:t}){const e=U(),n=P(()=>Ie(e)),s=z.useCurrentImage();if(!s)return null;const{image:i,source:c,analyticsMetadata:d,contentReferenceStartIndex:h,productIndex:p}=s;if(c==null||t==null||(d==null?void 0:d.turnIndex)==null)return a.jsx(N,{image:i,analyticsMetadata:{}});const x=ye(t),I=(function(){switch(c){case L.ProductDetails:return Qe(x,d.messageId,h,p);case L.SuperWidget:case L.ImageGroup:return s.imageResults;default:return Be(x,d.turnIndex,n)}})();return a.jsx(N,{image:i,group:I,analyticsMetadata:d})}function rt(){const t=z.useCurrentImage();if(!t)return null;const{image:e,source:n}=t;if(n==null)return a.jsx(N,{image:e,analyticsMetadata:{}});switch(n){case L.ImagesTab:return a.jsx(Ue,{image:e});case L.Turn:return a.jsx(Ke,{image:e});default:return null}}function Ue({image:t}){const{imageResults:e}=Oe();return a.jsx(N,{image:t,group:e,analyticsMetadata:{}})}function Ke({image:t}){const{imageResults:e}=Pe();return a.jsx(N,{image:t,group:e,analyticsMetadata:{}})}const Q="flex w-fit shrink-0 items-center gap-8 px-4 py-2 text-sm min-h-20";function N({image:t,group:e,analyticsMetadata:n}){var j,y;const s=m.useRef(null),i=z.useStore();m.useEffect(()=>{var g,v;(v=(g=window==null?void 0:window.history)==null?void 0:g.state)!=null&&v.imageModalOpen||window.history.pushState({imageModalOpen:!0},"",window.location.href);const o=()=>{var w,k;(k=(w=window==null?void 0:window.history)==null?void 0:w.state)!=null&&k.imageModalOpen||i.setCurrentImage(void 0)};return window.addEventListener("popstate",o),()=>window.removeEventListener("popstate",o)},[i]);const c=t.content_url.replace(/^http:\/\//,"https://"),d=(j=e==null?void 0:e.findIndex(o=>B(t,o)))!=null?j:0,h=(y=e==null?void 0:e.length)!=null?y:1,p=d!=null&&h>1,x=R(S({},Z(n)),{url:t.url,link_type:"text",section:"image",section_location:"response",section_index:(d+1).toString()});m.useEffect(()=>{s.current!==t.url&&(s.current=t.url,C.logEventWithStatsig("Search Content Reference Shown","search_content_reference_shown",R(S({},Z(n)),{type:"full_screen_image",url:t.url,image_url:c})),C.logEvent("link_action",R(S({},x),{action:"show"})))},[c]);const I=()=>{window.history.go(-1),i.setCurrentImage(void 0)},u=e!=null?e:[];de({queries:u.map(o=>qe(o.thumbnail_url,"ImageResultModal"))});const b=m.useMemo(()=>e!=null?e:[t],[e,t]);return a.jsxs(De,{forceDarkMode:!0,imageList:b,initialIndex:d,onClose:I,children:[p&&a.jsx(Y,{children:o=>{var g;return a.jsxs("div",{className:"text-token-text-tertiary -mt-0.25 shrink-0 px-4 md:mt-0 md:py-2",children:[((g=e==null?void 0:e.findIndex(v=>B(o,v)))!=null?g:0)+1," /"," ",h]})}}),a.jsx(ee,{children:o=>a.jsx(Xe,{image:o,isNewLightbox:!0})}),a.jsx(te,{children:o=>{var v,w;const g=(v=o.show_url)!=null?v:!0;return a.jsx("div",{className:"flex w-full justify-start",children:a.jsx("div",{className:"w-fit rounded-xl backdrop-blur-xl",children:g?a.jsx(_e,{onClick:()=>{C.logEvent("link_action",R(S({},x),{action:"click"}))},onMouseEnter:()=>{C.logEvent("link_action",R(S({},x),{action:"hover"}))},href:o.is_proxied_image?o.content_url:o.url,className:$(Q,"hover:opacity-70"),children:a.jsxs("div",{className:"flex grow flex-col gap-0.5 overflow-hidden pe-2",children:[a.jsxs("div",{className:"text-token-text-tertiary flex items-center gap-2 truncate",children:[a.jsx(Ce,{url:o.content_url,className:"rounded-sm",size:16}),(w=o.attribution)!=null?w:Ee(o.url)]}),a.jsx("div",{className:"truncate font-semibold text-white",children:o.title})]})}):a.jsx("div",{className:Q,children:a.jsx("div",{className:"truncate font-semibold text-white",children:o.title})})})})}})]})}function Xe({image:t,isNewLightbox:e=!1}){const n=t.content_url.replace(/^http:\/\//,"https://"),s=t.thumbnail_url.replace(/^http:\/\//,"https://"),i=t.content_size.width/t.content_size.height,{isError:c}=G(n,"ModalImage_main"),{isError:d}=G(s,"ModalImage_thumbnail"),h=t.is_proxied_image?t.url:c?s:n;return!d||!c||t.is_proxied_image?a.jsx(ke.img,{src:h,alt:t.title,style:{backgroundImage:s?"url(".concat(s,")"):void 0,backgroundSize:"contain",aspectRatio:i,backgroundPosition:"center",backgroundRepeat:"no-repeat"},initial:{opacity:0},animate:{opacity:1},className:$(e?"h-full max-w-full object-contain":"h-full max-w-[100vw] object-contain sm:max-w-[calc(100vw-10rem)]")}):a.jsx("div",{className:"flex h-full grow items-center justify-center",children:a.jsx("div",{className:"flex h-96 w-96 items-center justify-center bg-white/10",children:a.jsx(Te,{className:"text-token-text-tertiary h-12 w-12"})})})}export{at as ImageLightbox,rt as ImageLightboxSearchGPT};
//# sourceMappingURL=ht3mfxz6mrx45tha.js.map
