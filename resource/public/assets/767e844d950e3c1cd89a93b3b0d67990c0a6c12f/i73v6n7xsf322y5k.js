var ie=Object.defineProperty,le=Object.defineProperties;var ce=Object.getOwnPropertyDescriptors;var ht=Object.getOwnPropertySymbols;var de=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var xt=(t,o,s)=>o in t?ie(t,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[o]=s,bt=(t,o)=>{for(var s in o||(o={}))de.call(o,s)&&xt(t,s,o[s]);if(ht)for(var s of ht(o))ue.call(o,s)&&xt(t,s,o[s]);return t},Et=(t,o)=>le(t,ce(o));import{r as h,j as e,h as Dt,e as Ht,M as me}from"./mw35uwhq4g8r9eam.js";import{c as fe,a as pe,s as ge,g as he,b as xe,d as be,P as nt,T as Tt}from"./nl4yxhv48cbxowcu.js";import{cs as Ee,e1 as Te,cF as V,u as K,sZ as vt,uH as ve,eu as Ae,uI as At,rx as Ne,rz as Nt,e5 as H,iZ as Ie,bk as Vt,uz as Wt,mE as Oe,ek as J,D as Me,e as Ce,d as It,kh as _e,n0 as Ot}from"./d0xa318sl7ywi0za.js";import{g as Se,u as Xt,D as Pe}from"./fwz0otujtd6fpo4d.js";import{a as Re,T as we,A as Mt,u as ye,i as Le,C as je,g as Ct}from"./ccdelfl27o3fxeuu.js";import{c as ke}from"./krza42hj097hj350.js";import{M as Be,S as De,d as He,e as Ve,h as _t,i as We,C as at}from"./ixsv6fw3pmowsupe.js";import{h as lt,i as Xe,j as Ft,f as Z}from"./go83k4bw3m46lwwg.js";import{T as St,Z as Fe,C as Ge}from"./ce3hgmw4iyyhicud.js";import{b9 as Gt,g3 as zt,pw as C,qP as ze,b as Ue,px as j,ax as Ye,dM as $e,c8 as Ze,bY as Ut,lG as qe}from"./g2euln7v5pbm31qa.js";import{u as Yt}from"./c8dilzb1umlthpuq.js";import{a as Pt}from"./f5lfl2gmtl8dkh1o.js";import{t as Je,B as Ke,I as Qe}from"./l57v5lxkpqo9adh3.js";import{H as to,P as eo}from"./b9m0h1g72p9whl0h.js";import{D as oo,a as so}from"./bs910zydm18dg184.js";import{T as no,a as D}from"./ehv2vkvc6wjiqj3r.js";import{S as ao,a as ro}from"./e0d69s7tsq37k47r.js";import{e as io}from"./cz07pchyvxgswt7r.js";import"./fd8selpa9l1l2dzd.js";import"./juifnpcp74ymxcu2.js";import"./mojznsm1zll43nmv.js";import"./f76gy0b8ieo4s693.js";import"./mzril1pzbts3gz7n.js";import"./obs7vyhux2j83kng.js";import"./iknugp00locgtve5.js";import"./h1em0bjkpkjv8ykw.js";import"./lep2wptoy14cfe2w.js";import"./pvi9p0c51odp9xiw.js";import"./pe4e1ebqw6qlpge9.js";import"./ejv9rjzfbwh1dn9a.js";import"./bwg0lbtx0n9f11bn.js";import"./fwnz3uo9oosy1mt7.js";import"./dxkl0433k1u8ypnz.js";import"./ox7635ffwodpca7w.js";import"./ns51nblw8ziscsgd.js";import"./mstl8wgfzorpgdoe.js";import"./pcrw7exsshz05v7h.js";import"./kfdkis1zwf4ccfgg.js";import"./ol9d5wxhynx9q2is.js";import"./mbmcx8v24u1ao1ke.js";import"./cfgm997jt4en0fjd.js";import"./deakbbf27g8e7ba0.js";import"./d4h15g77ywnnjdmi.js";import"./kl7c6054usfnqmd4.js";import"./k97n0y6ba9c9h39c.js";import"./eg4jdclswoidzo1l.js";import"./iakh052vusklquwn.js";import"./i1lnixtvuwzfguvz.js";import"./gy1lpvuoewmzh42c.js";import"./h4yh1661qhhbu5v5.js";import"./hu1bt0oauegdhua6.js";import"./kbj1b07s2z6vxqkg.js";import"./oj9zwxa6l3kpv1x2.js";import"./cv4afpu20gjb9dll.js";import"./dpnr7xd5p38jb3gp.js";function lo(t,o){h.useEffect(()=>{const s=t==null?void 0:t.current;if(s!=null)return Ee(s,{mousedown:d=>{var u;((u=o.current)==null?void 0:u.maybeFocusOnEditor(d))===!0&&d.preventDefault()}})},[o,t])}const co=({wrapperClassName:t,value:o="",width:s,comments:d,paddingBottom:u})=>{const E=h.useRef(null),x=h.useRef(null),c=Te();return h.useEffect(()=>{const{current:n}=E;if(n)return x.current=fe({mount:n,comments:d,value:o,isDarkMode:c}),()=>{var r;(r=x.current)==null||r.destroy()}},[]),h.useEffect(()=>{var r;const n=pe(o,d);(r=x.current)==null||r.updateState(n)},[o,d]),e.jsx("div",{className:t,children:e.jsx("div",{ref:Gt(E),className:V(ge.main,"markdown prose dark:prose-invert focus:outline-hidden"),style:{width:s,paddingBottom:u}})})},$t=t=>!t||"docView"in t&&t.docView==null||Re(t.state.doc),q=100,uo={type:"spring",duration:1.5,bounce:.1},mo={type:"spring",duration:.5,bounce:0},Rt={type:"spring",duration:.2},wt={type:"spring",duration:1,delay:.1},fo={type:"spring",duration:1},po={type:"spring",duration:.5,bounce:0},go=({isRewriting:t=!1,value:o,previousValue:s,previousComments:d,documentWidth:u,paddingBottom:E,onStart:x})=>{const c=K(),n=lt(),r=vt(0),b=vt(-q),A=h.useRef(!1),[g,f]=ve(),[{height:I},P]=Yt(),i=zt(c);Ae(()=>{const a=n();return a&&(a.dom.style.clipPath="inset(0 0 100% 0)"),()=>{const l=n();l&&(l.dom.style.clipPath="")}},[]),h.useEffect(()=>{var l;const a=n();if(!a||$t(a))return g||f==null?void 0:f();try{const T=(l=Xe(a.state.doc))==null?void 0:l.end;if(T==null||T>o.length)return;const{top:N}=a.coordsAtPos(0),{top:_,bottom:M}=a.coordsAtPos(Math.max(a.state.doc.content.size-1,0),-1),v=M-N,O=_-N;if(r.set(v-O),!g){At(b,v+2*r.get(),mo).then(()=>f==null?void 0:f());return}At(b,v,uo)}catch(T){C.logError("Failed to set rewrite animation position",T),f==null||f()}},[g,o]);const p=Ne(b,a=>Ie(a)-q+2);return Nt(b,"change",a=>{const l=n();!l||!a||!A.current||(l.dom.style.clipPath="inset(0 0 calc(100% - ".concat(a,"px) 0)"))}),Nt(b,"animationStart",()=>{t&&(x==null||x())}),e.jsxs(e.Fragment,{children:[i&&e.jsx(H.div,{style:{visibility:"hidden",pointerEvents:"none",height:I},initial:!1,exit:{height:0},transition:{delay:.1,duration:.8,ease:"easeOut"}}),e.jsx(H.div,{className:"absolute top-0 z-10 w-full origin-bottom bg-linear-to-t from-[var(--canvas-bg,var(--bg-primary))] from-10% to-transparent",style:{translateY:p,height:q},initial:{opacity:0},animate:{opacity:1,transition:Rt},exit:{opacity:0,transition:wt},onAnimationComplete:()=>A.current=!0},"wash-top"),e.jsx(H.div,{className:"absolute top-0 z-10 w-full bg-linear-to-b from-[var(--canvas-bg,var(--bg-primary))] to-transparent",style:{translateY:b,height:q},initial:{opacity:0},animate:{opacity:1,transition:Rt},exit:{opacity:0,transition:wt}},"wash-bottom"),e.jsx(H.div,{ref:P,className:"pointer-events-none absolute z-0 max-w-full min-w-0",initial:{opacity:1},animate:{opacity:.3,transition:fo},exit:{opacity:0,transition:po},children:e.jsx(co,{value:s,width:u,comments:d,wrapperClassName:"h-fit flex",paddingBottom:E})},"previousValue")]})};function yt(t,o){if(t==null)return!1;const s=t.state.schema.marks[o];return s==null?!1:Je(t.state,t.dispatch,s)}function rt(t,o){if(t==null)return!1;const{state:s,dispatch:d}=t,u=Vt(s.schema.nodes[to.proseMirrorNodeName()]);return Wt(u,{level:o})(s,d)}function ho(t){if(t==null)return!1;const{state:o,dispatch:s}=t,d=Vt(o.schema.nodes[eo.proseMirrorNodeName()]);return Wt(d)(o,s)}const xo=({availableWidth:t,onAddComment:o,isSendDisabled:s=!1,isWaitingForCommentResponse:d=!1,onSubmitAccelerator:u,showAskChatGPT:E})=>{const x=K(),c=Dt(),n=lt(),r=Ft(),b=ze(x),A=h.useCallback(i=>{const{width:p,height:a}=i,l=n();if(!r||!l||$t(l))return null;const{to:T,empty:N,head:_}=r.selection,{platform:M}=Ue(),v=M==="web"?_:T,O=v===T;if(N||!Pt(l.state.doc,v))return null;const{right:Q,left:W,top:F}=l.coordsAtPos(0);let R=v,w=l.state.doc.nodeAt(R);const G=O?-1:1;for(;!(w!=null&&w.isText)&&Pt(l.state.doc,R+G);)R+=G,w=l.state.doc.nodeAt(R);const{left:z,bottom:k,top:U}=l.coordsAtPos(R,O?-1:1),tt=Q-W;function B(){if(O)return Math.max(z-W-p,0);let L=z-W;return L+p>tt&&(L=-(p-tt)),L}function y(){const L=window.innerHeight-k>a*2;return O&&L?{top:k-F+8,aboveOrBelow:Mt.BELOW}:{top:U-F-a-8,aboveOrBelow:Mt.ABOVE}}const X=y();return{left:B(),top:X.top,aboveOrBelow:X.aboveOrBelow,toolbarSize:i}},[r,n]),g=h.useCallback(()=>{var i,p;return(p=(i=n())==null?void 0:i.dom)!=null?p:null},[n]),f=[{label:c.formatMessage(S.heading1),className:"text-5xl font-semibold",onClick:()=>{C.logButtonClick(j.TOOLBAR_FORMAT_HEADER1),rt(n(),1)}},{label:c.formatMessage(S.heading2),className:"text-3xl font-semibold",onClick:()=>{C.logButtonClick(j.TOOLBAR_FORMAT_HEADER2),rt(n(),2)}},{label:c.formatMessage(S.heading3),className:"text-2xl font-semibold",onClick:()=>{C.logButtonClick(j.TOOLBAR_FORMAT_HEADER3),rt(n(),3)}},{label:c.formatMessage(S.body),className:"text-base",onClick:()=>{C.logButtonClick(j.TOOLBAR_FORMAT_PARAGRAPH),ho(n())}}],I=()=>{const i=n();if(!i)return null;const{state:p}=i,{from:a,to:l,sourceFrom:T,sourceTo:N}=Se(p);return a==null||l==null||T==null||N==null?(C.logError("Prosemirror getSelectionRange has null values",null,{from:a,to:l,sourceFrom:T,sourceTo:N}),null):{from:a,to:l,sourceFrom:T,sourceTo:N}},P=(i,p,a)=>{const l=n(),T=I();if(T==null)return;const{sourceFrom:N,sourceTo:_}=T,M={start:N,end:_};if(r&&l){const v=r.tr.setSelection(Oe.create(r.doc,r.selection.anchor));l.dispatch(v)}C.logButtonClick(j.TOOLBAR_FORMAT_STYLE,{action:{action:a.action,id:a.id,title:a.title},prompt:p,sourceFrom:N,sourceTo:_}),u==null||u(i,M,c.formatMessage(p),a)};return e.jsxs(we,{showAskChatGPT:E,isWaitingForCommentResponse:d,isSendDisabled:s,onAddComment:o,toolbarType:no.WRITING,getToolbarPosition:A,getEditorDom:g,getSelectionRange:I,children:[b&&e.jsxs(e.Fragment,{children:[e.jsx(D.Separator,{}),e.jsx(D.Popover,{label:c.formatMessage(S.format),hideLabel:t<=400,icon:Ye,align:"center",children:e.jsx("div",{className:V("bg-token-main-surface-primary flex w-48 flex-col items-stretch rounded-xl border p-1",St),children:oo.map(i=>{const{title:p,icon:a}=i;return e.jsxs("button",{onClick:l=>{"prompt"in i&&P(l,i.prompt,i)},className:"bg-token-main-surface-primary dark:hover:bg-token-main-surface-secondary flex flex-row items-center gap-x-2 rounded-md p-3 hover:bg-[#f5f5f5]",children:[e.jsx("div",{className:"flex",children:e.jsx(a,{className:"icon"})}),e.jsx("div",{className:"line-clamp-1 flex-auto text-start text-sm",children:c.formatMessage(p)})]},i.id)})})})]}),e.jsx(D.Separator,{}),e.jsx(D.Action,{label:c.formatMessage(S.bold),hideLabel:!0,icon:ao,onClick:()=>{C.logButtonClick(j.TOOLBAR_FORMAT_BOLD),yt(n(),Ke.proseMirrorMarkName())},onMouseDown:i=>i.preventDefault()}),e.jsx(D.Action,{label:c.formatMessage(S.italic),hideLabel:!0,icon:ro,onClick:()=>{C.logButtonClick(j.TOOLBAR_FORMAT_ITALIC),yt(n(),Qe.proseMirrorMarkName())},onMouseDown:i=>i.preventDefault()}),e.jsx(D.Popover,{label:c.formatMessage(S.format),hideLabel:!0,icon:io,children:e.jsx("div",{className:V("border-token-border-default bg-token-main-surface-primary flex flex-col items-stretch rounded-xl border p-1",St),children:f.map(({label:i,className:p,onClick:a})=>e.jsx("button",{onClick:a,className:"hover:bg-token-main-surface-secondary w-full rounded-xl p-4 text-start",children:e.jsx("div",{className:p,children:i})},i))})})]})},S=Ht({bold:{id:"qqbk91",defaultMessage:"Bold"},italic:{id:"5oh4LV",defaultMessage:"Italic"},format:{id:"z8IGv0",defaultMessage:"Transform"},heading1:{id:"AR5o30",defaultMessage:"Heading 1"},heading2:{id:"zb/wrc",defaultMessage:"Heading 2"},heading3:{id:"xZJvLM",defaultMessage:"Heading 3"},body:{id:"Hi6z3L",defaultMessage:"Body"},caption:{id:"VXpL7v",defaultMessage:"Caption"},bullets:{id:"2vznKX",defaultMessage:"Bullets"},outline:{id:"Xmbt6r",defaultMessage:"Outline"},table:{id:"0UjL6P",defaultMessage:"Table"}});function Lt({position:t,numEdits:o,closestEditId:s}){const d=Xt(),u=Dt(),E=t==="top"?$e:Ze,x=()=>{const n=d();if(!n||!s)return;const r=he(n,s);if(r.length===0){Me.addError("Edit could not be found while attempting to scroll",{closestEditId:s});return}r[t==="top"?0:r.length-1].scrollIntoView({behavior:"smooth",block:"center"})},c=t==="top"?-4:4;return e.jsx(J,{children:o>0&&e.jsx(H.div,{className:V("absolute start-1/2 z-20 select-none",{"bottom-[20px]":t==="bottom","top-[20px]":t==="top"}),initial:{scale:.95,translateY:c,translateX:"-50%",opacity:0},animate:{scale:1,translateY:0,translateX:"-50%",opacity:1},exit:{scale:.95,translateY:c,translateX:"-50%",opacity:0},transition:{type:"spring",duration:.3},children:e.jsxs("div",{className:V("flex items-center justify-center rounded-full border px-4 py-2","border-token-main-surface-tertiary bg-token-main-surface-primary hover:bg-token-main-surface-secondary shadow-md"),"aria-label":u.formatMessage(jt.ariaLabel),role:"button",onClick:x,children:[e.jsx(me,Et(bt({},jt.label),{values:{count:o}})),e.jsx(E,{className:"icon-sm ms-2"})]})})})}const jt=Ht({label:{id:"Pf30w4",defaultMessage:"{count, plural, one {1 more edit} other {{count} more edits}}"},ariaLabel:{id:"qTJjzl",defaultMessage:"Button to scroll the next edit into view."}});function bo({diff:t=null}){var n;const o=K(),s=Xt(),[d,u]=h.useState([]),[E,x]=h.useState([]),c=h.useCallback(()=>{const r=s();if(!r||!t)return;const b=[],A=[];for(const g of t.edits){const f=xe(r,g.id);if(f.length>0){const I=be(f);I.bottom<0?b.push([g.id,I]):I.top>Ut(o).height&&A.push([g.id,I])}}b.sort(([,g],[,f])=>g.bottom-f.bottom),A.sort(([,g],[,f])=>g.top-f.top),u(b.map(([g])=>g)),x(A.map(([g])=>g))},[o,t,s]);return ye((n=t==null?void 0:t.edits)!=null?n:[],c),h.useEffect(()=>{const r=setTimeout(c,500);return()=>{clearTimeout(r)}},[c]),e.jsxs(e.Fragment,{children:[e.jsx(Lt,{position:"top",numEdits:d.length,closestEditId:d[d.length-1]}),e.jsx(Lt,{position:"bottom",numEdits:E.length,closestEditId:E[0]})]})}const it=Ce(()=>({rejectedEdits:new Set,hoveredEditId:null})),{setState:Cs}=it,Eo=({pos:t})=>{var p;const o=lt()(),s=Ft();if(!o||!s||t==null)return null;const{doc:d}=s,{top:u,left:E}=o.coordsAtPos(0),{top:x,left:c}=o.coordsAtPos(t),n=d.nodeAt(t),r=t+((p=n==null?void 0:n.nodeSize)!=null?p:0)-1,{top:b}=o.coordsAtPos(t+1),{top:A,bottom:g,right:f}=o.coordsAtPos(r),P=(b>=A?f:o.dom.getBoundingClientRect().right)-c,i=g-x+4;return e.jsx(H.div,{style:{top:x-u,left:c-E,height:i,width:P},className:V("absolute after:absolute after:inset-x-[-4px] after:inset-y-0 after:z-0 after:rounded-md after:bg-[Highlight] after:content-[''] dark:after:bg-[Highlight]",Fe.blockCommentHover),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0}})},To=({pos:t})=>e.jsx(J,{children:t!=null&&e.jsx(Eo,{pos:t})}),kt=24,vo=16,Ao=0,No=8,Bt=4,_s=({comments:t,diff:o,readonlyReason:s,isDisabled:d=!1,isRewriting:u=!1,isSendDisabled:E=!1,previousComments:x,previousValue:c,isPreview:n=!1,isRequestActive:r=!1,isWaitingForCommentResponse:b=!1,targetedContent:A=null,onAcceleratorsExpandedChange:g,getAutocompleteSuggestion:f,getStableCommentId:I=qe,onBlur:P,onCancelRequest:i,onChange:p,onSave:a,onAddComment:l,onSubmitAccelerator:T,onAcceptComment:N,onDismissComment:_,onExitShowChanges:M,value:v,commentsMode:O=at.ENABLED,hideAccelerators:Q=!1,hideToolbar:W=!1,hideEditOverlay:F=!1,safeUrls:R,width:w,modelCursor:G,shouldResetSelection:z,metadata:k})=>{var ft,pt;const U=K(),B=zt(U)&&n,y=h.useRef(null),X=h.useRef(null);lo(X,y);const[{width:L},Zt]=Yt(),ct=h.useRef(null),[et,dt]=h.useState(!1),qt=ct.current,Jt=(ft=Le(qt))!=null?ft:!1,ut=It(()=>B?_e()?Be:De:Ot()?He:Ve),Y=(()=>{if(w==null){const m=Jt?0:Ct();return L-m}return w-ut*2-Ct()})(),ot=B?Y:Y>=_t+ke?_t:We,Kt=Y-ot,Qt=Z(({commentingOn:m})=>m),te=Z(({hoveredCommentId:m})=>m),ee=Z(({focusedCommentId:m})=>m),oe=Z(({hoveredBlockCommentLauncherPos:m})=>m),se=it(m=>m.hoveredEditId),ne=it(m=>m.rejectedEdits);h.useEffect(()=>{var m;A==null&&((m=y.current)==null||m.revertChanges())},[A]),h.useEffect(()=>{var m,$;(m=y.current)==null||m.flushChanges(),($=y.current)==null||$.UNSAFE_setValue(v)},[v]);const ae=It(()=>{if(B)return Bt;if(!Ot())return n?Ao:vo;if(n)return kt;const m=No/100*Ut(U).height;return Math.max(kt,m)}),re=({currentTarget:m,nativeEvent:$})=>{const gt=$.composedPath();for(const st of gt.slice(0,gt.indexOf(m)))if(st instanceof HTMLElement&&(st.id===Tt.PROSEMIRROR_EDITOR_CONTAINER||st.id===Tt.PROSEMIRROR_CONTEXT_CHILDREN))return;M==null||M()},mt=B?Bt:n?"1rem":"max(3rem,24vh)";return e.jsx("div",{className:"h-full w-full",ref:X,onClick:re,children:e.jsx("div",{className:Ge.document,style:{margin:"0 ".concat(ut,"px"),paddingTop:ae},children:e.jsx("div",{ref:Gt(Zt,ct),className:"z-0 flex w-full flex-col items-center",children:e.jsxs(nt,{comments:t,diff:o,editorRef:y,hoveredCommentId:te,focusedCommentId:ee,hoveredEditId:se,rejectedEdits:ne,value:u&&!et?"":v,commentingOn:Qt,isDisabled:d||u||et,onBlur:P,onChange:p,onSave:a,width:ot,safeUrls:R,wrapperClassName:"relative z-10 flex max-w-full h-fit",paddingBottom:mt,modelCursor:G,shouldResetSelection:z,transparentBackground:!et,contentReferences:(pt=k==null?void 0:k.contentReferences)!=null?pt:[],getAutocompleteSuggestion:f,children:[e.jsxs(nt.EditorChildren,{children:[e.jsx(J,{onExitComplete:()=>dt(!1),children:u&&e.jsx(go,{isRewriting:u,documentWidth:ot,previousValue:c,previousComments:x,value:v,paddingBottom:mt,onStart:()=>dt(!0)})}),!W&&e.jsx(xo,{availableWidth:Y,isWaitingForCommentResponse:b,isSendDisabled:E,onAddComment:l,onSubmitAccelerator:T}),O===at.ENABLED&&e.jsx(To,{pos:oe}),e.jsx(J,{children:O!==at.ALL_HIDDEN&&e.jsx(je,{availableWidth:Kt,comments:t,commentsMode:O,isRequestActive:r,onAddComment:l,onAcceptComment:N,onDismissComment:_,isWaitingForCommentResponse:b,disableBlockComments:r,getStableCommentId:I})})]}),e.jsxs(nt.ContextChildren,{children:[!F&&o&&e.jsx(bo,{diff:o}),!Q&&e.jsx(Pe,{isRequestActive:r,onSubmit:T,isVisuallyHidden:E||!!(s!=null&&s.isStreamingFromNative)||(s==null?void 0:s.isReadonly)&&!s.isStreaming,actions:so,onCancel:i,onExpandedChange:g})]})]})})})})};export{_s as DocumentComposer};
//# sourceMappingURL=i73v6n7xsf322y5k.js.map
