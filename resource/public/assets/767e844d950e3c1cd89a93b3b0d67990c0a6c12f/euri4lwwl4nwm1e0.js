import{r as f,j as l,h as M}from"./mw35uwhq4g8r9eam.js";import{fj as x,$ as d,a0 as T,u as C,J as _,aa as E}from"./d0xa318sl7ywi0za.js";import{CoTChunks as k}from"./luqq85m92bytr6zc.js";import{cP as h}from"./g2euln7v5pbm31qa.js";import"./mdh3gu2zvzp3cu8r.js";import"./mpb8yfob3hqr4zw5.js";import"./e5bg4yzr7nht9sxr.js";import"./iue4s7sqsxkz98qq.js";import"./fhb510ji3eot09yv.js";import"./e237h6ukoc2vt16i.js";import"./cz2iwgzw4rck3xnv.js";import"./ejv9rjzfbwh1dn9a.js";import"./of0vtq1gcmd3mc3z.js";import"./ck4rwz4bvjdsyeld.js";import"./e1vcfcyx8u6zde85.js";import"./fd8selpa9l1l2dzd.js";import"./juifnpcp74ymxcu2.js";import"./pbl95wx6493wq92j.js";import"./ddina39kz3r81pp7.js";import"./jybdx70geuzrnoab.js";import"./m1s7wxy82fhyl3zh.js";import"./m2d85ixk2zz51mk9.js";const y=(o,t)=>{if(t<=1)return o.formatMessage({id:"ZxhUq1",defaultMessage:"a second"});if(t<3)return o.formatMessage({id:"4GD7tD",defaultMessage:"a couple of seconds"});if(t<4)return o.formatMessage({id:"jx5V1u",defaultMessage:"a few seconds"});if(t>=60){const n=Math.floor(t/60),s=t%60;return"".concat(n,"m ").concat(s,"s")}return o.formatMessage({id:"p4/pTg",defaultMessage:"{seconds} seconds"},{seconds:t})},R=o=>{var n,s;let t=0;for(const e of o)t+=(s=(n=e.metadata)==null?void 0:n.finished_duration_sec)!=null?s:0;return t},I=(o,t,n)=>{var s,e,i;return t.length>1?o.formatMessage({id:"sdDgmZ",defaultMessage:"Thought for {timing}"},{timing:y(o,n)}):(i=(e=(s=x(t))==null?void 0:s.metadata)==null?void 0:e.finished_text)!=null?i:""},S=(o,t,n=!1)=>{var m;const s=[];let e={type:h.Thought,thought:{summary:"",content:""}};const i=()=>{e.thought.content.trim()&&(s.push(e),e={type:h.Thought,thought:{summary:e.thought.summary,content:""}})},u=o.split(/( {2}\n)|(\n\n)/).filter(a=>a!=null&&a.trim());if(!n&&u.length<2)return s;let c=!1;for(let a=0;a<u.length;a++){const r=u[a].trim();if(r.toLowerCase()==="none"){d.count(T.COT_SUMMARIZER,"num_none_chunks");continue}const g=r.match(/^\*\*(.*)\*\*$/);if(g)i(),e.thought.summary=(m=g[1])!=null?m:"";else if(r){if(r.startsWith("```")){if(c){e.thought.content+=e.thought.content?"\n".concat(r):r,i(),c=!1;continue}i(),c=!0}e.thought.content.trim()&&!r.startsWith("\\[")&&!r.startsWith("\\(")&&!c&&i(),e.thought.content+=e.thought.content?"\n".concat(r):r}}return e!=null&&e.thought.content.trim()&&s.push(e),n&&t&&s.push({type:h.Recap,content:t}),s},j=(o,t,n)=>{const s=!n,e=f.useMemo(()=>S(o,t,s),[o,t,s]);return f.useEffect(()=>{s&&d.hist(T.COT_SUMMARIZER,"num_cot_chunks",void 0,e.length)},[s]),e},N=({conversation:o,isStreaming:t,finishedText:n,summaryText:s,isFinalAssistantTurn:e,turnIndex:i})=>{const u=j(s,n,t),[c,m]=f.useState(!1);return l.jsx(k,{conversation:o,isStreaming:t,isFinalAssistantTurn:e,chunks:u,isExpanded:c,setIsExpanded:m,turnIndex:i})},O=8,$="\n\n",tt=({conversation:o,messages:t,isStreaming:n,isFinalAssistantTurn:s,turnIndex:e})=>{const i=M(),u=C(),c=_(u,"1214379119"),m=R(t);let a="";return t.forEach(p=>{const r=E(p);a+=a?$+r:r}),c&&!n&&!a&&m<O?null:l.jsx(N,{conversation:o,finishedText:I(i,t,m),summaryText:a,isStreaming:n,isFinalAssistantTurn:s,turnIndex:e})};export{N as LegacyCoT,tt as LegacyCoTMessage};
//# sourceMappingURL=euri4lwwl4nwm1e0.js.map
