var Ie=Object.defineProperty,Ne=Object.defineProperties;var Be=Object.getOwnPropertyDescriptors;var re=Object.getOwnPropertySymbols;var Re=Object.prototype.hasOwnProperty,De=Object.prototype.propertyIsEnumerable;var ie=(n,t,s)=>t in n?Ie(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s,y=(n,t)=>{for(var s in t||(t={}))Re.call(t,s)&&ie(n,s,t[s]);if(re)for(var s of re(t))De.call(t,s)&&ie(n,s,t[s]);return n},le=(n,t)=>Ne(n,Be(t));import{h as Y,j as e,e as ye,r as d,M as z,R as Te}from"./mw35uwhq4g8r9eam.js";import{f7 as L,er as W,_ as U,p as Ae,u as de,al as me,J as We,P as Q,V as q,Q as Ue,cF as T,ek as Ve,e4 as $e,R as Fe,D as J}from"./d0xa318sl7ywi0za.js";import{dE as K,jT as B,h as Ge,jU as Xe,bj as ze,jV as x,jW as A,aB as Je,em as He}from"./g2euln7v5pbm31qa.js";import{X as Qe,L as qe,R as Ke}from"./nlbf1hgfq5fc7tvs.js";import{d as ce}from"./kl7c6054usfnqmd4.js";import{g as Ye}from"./k97n0y6ba9c9h39c.js";import{u as Ze}from"./enpkwo0k2mfqjlio.js";const H=ye({download:{id:"postSharingModal.download",defaultMessage:"Download"},downloadPdfButtonMenu:{id:"postSharingModal.download-pdf-button.menu",defaultMessage:"PDF Document (.pdf)"},downloadDocxButtonMenu:{id:"postSharingModal.download-docx-button.menu",defaultMessage:"Microsoft Word Document (.docx)"}}),Oe=({downloading:n,onOdysseyFileDownload:t,disabled:s,icon:o,label:i,odysseyShareIntent:a})=>{const l=Y();return a.fileName.endsWith("md")?e.jsxs(L.Root,{open:!s&&!n?void 0:!1,children:[e.jsx(L.BasicTrigger,{asChild:!0,children:e.jsxs("button",{onClick:()=>{U.logEventWithStatsig("Share Post: Social Clicked","chatgpt_post_share_link_social_clicked",{platform:"download"})},disabled:s,className:"relative flex flex-col gap-y-4 disabled:opacity-50 max-sm:gap-y-2",children:[e.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-full shadow-lg max-sm:h-12 max-sm:w-12 max-sm:shadow-md dark:shadow-md",children:e.jsx("div",{className:"pointer-events-none flex h-8 w-8 items-center justify-center max-sm:h-6 max-sm:w-6",children:n?e.jsx(W,{}):o})}),e.jsx("div",{className:"w-full text-center text-xs",children:i})]})}),e.jsx(L.Portal,{children:e.jsxs(L.Content,{align:"end",children:[e.jsx(L.Item,{onClick:c=>{c.preventDefault(),t==null||t(a.fileName,a.fileId,a.messageId,"pdf")},children:l.formatMessage(H.downloadPdfButtonMenu)}),e.jsx(L.Item,{onClick:c=>{c.preventDefault(),t==null||t(a.fileName,a.fileId,a.messageId,"docx")},children:l.formatMessage(H.downloadDocxButtonMenu)})]})})]},"download"):e.jsxs("button",{onClick:()=>{t==null||t(a.fileName,a.fileId,a.messageId,null),U.logEventWithStatsig("Share Post: Social Clicked","chatgpt_post_share_link_social_clicked",{platform:"download"})},disabled:s,className:"relative flex flex-col gap-y-4 disabled:opacity-50 max-sm:gap-y-2",children:[e.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-full shadow-lg max-sm:h-12 max-sm:w-12 max-sm:shadow-md dark:shadow-md",children:e.jsx("div",{className:"pointer-events-none flex h-8 w-8 items-center justify-center max-sm:h-6 max-sm:w-6",children:e.jsx(K,{})})}),e.jsx("div",{className:"w-full text-center text-xs",children:l.formatMessage(H.download)})]},"download")};function fe(n){const t=d.useCallback(o=>B.subscribe(o),[]),s=d.useCallback(()=>{if(n)return B.get(n)},[n]);return d.useSyncExternalStore(t,s,s)}function es(n){const{shareTargetId:t,shareType:s,generateShareLinkFn:o}=n,i=fe(t),a=d.useCallback(async()=>{if(!t||!o){const l=new Error("Share target not ready");return Promise.reject(l)}return(i==null?void 0:i.status)==="processing"||(i==null?void 0:i.status)==="succeeded"?i.promise:B.start(t,s,o)},[o,i,t,s]);return{request:i,ensureShareRequest:a}}function ss({shareTargetId:n,durationMs:t=3e3}={}){const s=fe(n),[o,i]=d.useState(!1),a=d.useDeferredValue(o),l=d.useRef(null),c=d.useCallback(p=>{d.startTransition(()=>{i(p)})},[]),m=d.useCallback(()=>{l.current!=null&&(clearTimeout(l.current),l.current=null)},[]);return d.useEffect(()=>{if(!n||!(s!=null&&s.copiedAt)){m(),c(!1);return}const p=Date.now()-s.copiedAt,w=Math.max(0,t-p);if(m(),w<=0){c(!1);return}return c(!0),l.current=window.setTimeout(()=>{i(!1),l.current=null},w),()=>{m(),c(!1)}},[s==null?void 0:s.copiedAt,n,t,m,c]),d.useEffect(()=>m(),[m]),a}function ts({showLinkCopied:n,isGeneratingShareLink:t,onClick:s,postText:o,showDownloadButton:i,odysseyShareIntent:a,isDownloadingOdyssey:l,onOdysseyFileDownload:c,disabled:m,downloadVariant:p,isConversationDownloading:w}){const k=Y(),j=de(),g=me(j),V=g==null?void 0:g.isWorkspaceAccount();let _=[{id:"copy",icon:t?e.jsx(W,{}):e.jsx(Je,{}),label:n?k.formatMessage(x.linkCopied):k.formatMessage(x.copyLink),action:"copy"}];V?i&&_.push({id:"download",icon:p==="conversation"&&w?e.jsx(W,{}):e.jsx(K,{}),label:k.formatMessage({id:"postSharingModal.download",defaultMessage:"Download"}),action:"download",downloadVariant:p}):_=_.concat({id:"x",href:u=>"https://twitter.com/intent/tweet?url=".concat(encodeURIComponent(u),"&text=").concat(o?encodeURIComponent(o):""),icon:e.jsx(Qe,{initialFillColor:"var(--text-primary)"}),label:k.formatMessage({id:"postSharingModal.x",defaultMessage:"X"}),action:"share"},{id:"linkedin",href:u=>"https://www.linkedin.com/shareArticle?url=".concat(encodeURIComponent(u),"&text=").concat(o?encodeURIComponent(o):""),icon:e.jsx(qe,{initialFillColor:"var(--text-primary)"}),label:k.formatMessage({id:"postSharingModal.linkedin",defaultMessage:"LinkedIn"}),action:"share"},{id:"reddit",href:u=>"https://www.reddit.com/submit?url=".concat(encodeURIComponent(u),"&title=").concat(o?encodeURIComponent(o):""),icon:e.jsx(Ke,{initialFillColor:"var(--text-primary)"}),label:k.formatMessage({id:"postSharingModal.reddit",defaultMessage:"Reddit"}),action:"share"},...i?[{id:"download",icon:p==="conversation"&&w?e.jsx(W,{}):e.jsx(K,{}),label:"[oai] Download as PDF",action:"download",downloadVariant:p}]:[]);const R=!!l;return e.jsx(e.Fragment,{children:_.map(u=>u.id==="download"&&a?e.jsx(Oe,{downloading:R,onOdysseyFileDownload:c,disabled:m!=null?m:!1,icon:u.icon,label:u.label,odysseyShareIntent:a},u.id):e.jsxs("button",{onClick:async()=>{try{await s(u)}finally{U.logEventWithStatsig("Share Post: Social Clicked","chatgpt_post_share_link_social_clicked",{platform:u.id})}},disabled:m||u.downloadVariant==="conversation"&&w,className:"relative flex flex-col gap-y-4 disabled:opacity-50 max-sm:gap-y-2",children:[e.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-full shadow-lg max-sm:h-12 max-sm:w-12 max-sm:shadow-md dark:shadow-md",children:e.jsx("div",{className:"pointer-events-none flex h-8 w-8 items-center justify-center max-sm:h-6 max-sm:w-6",children:u.icon})}),e.jsx("div",{className:"w-full max-w-16 text-center text-xs",children:u.label})]},u.id))})}function as(n,t){const s=Q(n);return s?{id:"tmp",kind:"message_slice",messages:t.map(i=>{const a=q.findNode(s,({message:l})=>l.id===i);return a?a.message:null}).filter(Boolean)}:null}function ns(n){return{id:"tmp",kind:"message_slice",messages:[n.previewMessage]}}function xs({postSharingData:n,onClose:t}){const{clientThreadId:s,postText:o,generateShareLinkFn:i,coverImageUrl:a,messageSliceIds:l,odysseyShareIntent:c,shareTargetId:m,shareType:p}=n,[w,k]=d.useState(!1),j=Y(),g=Ae(),[V,_]=d.useState(!0),R=de(),u=me(R),$=u==null?void 0:u.isWorkspaceAccount();We(R,"3453150529");const{request:P,ensureShareRequest:Z}=es({shareTargetId:m,shareType:p,generateShareLinkFn:i}),ue=(P==null?void 0:P.status)==="processing",he=ss({shareTargetId:m});d.useEffect(()=>{U.logEventWithStatsig("Share Post: Post Sharing Modal Shown","chatgpt_post_share_modal_shown")},[]);const E=d.useMemo(()=>c?ns(c):a||!l||l.length===0?null:as(s,l),[a,s,l,c]),I=d.useMemo(()=>{const r=Q(s);return r?q.getConversationTurns(r).flatMap(h=>h.messages):[]},[s]),ge=d.useMemo(()=>{if(!l||l.length===0)return[];const r=new Set(l);return I.filter(h=>typeof h.id=="string"&&r.has(h.id))},[I,l]),pe=!1;d.useEffect(()=>{if(!l||l.length===0)return;const r=Q(s);l.filter(S=>!q.findNode(r,({message:C})=>C.id===S)).length>0&&Ge(s)},[s,l]);const{hasImage:xe,hasScreenshot:we}=d.useMemo(()=>{let r=!1,h=!1;if(I.length){const S=I,C=/\.(jpe?g|png|gif|webp|bmp|tiff)$/i,N=M=>{if(!Array.isArray(M))return!1;for(const f of M)if(f.type==="image_inline"&&f.clicked_from_url&&(h=!0),f.type==="file"&&"file_name"in f){const b=f.file_name.toLowerCase();(b.endsWith(".pptx")||C.test(b))&&(r=!0)}};S.forEach(M=>{var D,ae,ne,oe;const f=M.metadata;if(!f)return;const b=[...Object.values((D=f.n7jupd_crefs_by_file)!=null?D:{}).flat(),...Object.values((ae=f.content_references_by_file)!=null?ae:{}).flat()],X=[...(ne=f.n7jupd_crefs)!=null?ne:[],...(oe=f.content_references)!=null?oe:[]];N(b),N(X)})}return{hasImage:r,hasScreenshot:h}},[I]),O=Ue(s),ee=d.useCallback(()=>{var h;if(!m)return Promise.reject(new Error("Missing share target"));const r=(h=B.get(m))!=null?h:P;return(r==null?void 0:r.status)==="processing"?r.promise:(r==null?void 0:r.status)==="succeeded"?Promise.resolve(r):Z()},[P,Z,m]),F=d.useCallback(async r=>{await os({shareTargetId:m,resolveShareRequest:ee,toaster:g,intl:j,setIsResolvingShareLink:k,task:r})},[j,ee,m,g]),ke=d.useCallback(async()=>{m&&await F(r=>rs({link:r,shareTargetId:m,toaster:g,intl:j}))},[j,F,m,g]),je=async r=>{if(O){if(r.action==="download"){if(r.downloadVariant==="conversation"){await be();return}r.downloadVariant==="image"&&a&&He({url:a,fileName:"".concat(o,".png")});return}if(r.action==="copy"){await ke();return}if(r.action==="share"&&r.href){const h=r.href;await F(S=>{window.open(h(S),"_blank","noopener,noreferrer")});return}}},_e=e.jsx("div",{className:T("flex w-full justify-center rounded-xl",a||E&&(c!=null&&c.isStandaloneAttachment)?"max-xs:max-h-[260px] h-[30vh] max-h-[550px] max-sm:max-h-[300px]":"aspect-[1200/630]",!a&&!(c!=null&&c.isStandaloneAttachment)&&"outline-token-border-light overflow-hidden shadow-sm outline outline-1"),children:a?e.jsx("img",{src:a,alt:o}):c!=null&&c.isStandaloneAttachment&&E?e.jsx(Xe,{attachments:[E],variant:"unfurl",className:"h-full w-full",clientThreadId:s}):E?e.jsx(ze,{attachments:[E],clientThreadId:s,className:"h-full"}):null}),ve="normal",[Se,G]=d.useState(!1),{presentationMap:Ce}=Ze(),v=j.formatMessage(x.downloadFileError),[Me,ls]=d.useState(!1),be=d.useCallback(async()=>{},[ge,pe,o,j,g,v]),Le=async(r,h,S,C)=>{var M;const N=O;if(!(!r||!h||!N))if(G(!0),r.endsWith("md")){if(!C)return;try{const f=await Fe.safePost("/export_doc/n7jupd",{requestBody:{conversation_id:N,message_id:S,file_id:h,export_type:C},skipJsonTransform:!0});f.ok||(g.danger(v,{toastId:"post_sharing_modal_download_error",loggingTitle:v,loggingDescription:"Error message when a file download fails"}),J.addError("post_sharing_modal_download_error",{statusText:f.statusText,status:f.status}));const b=await f.blob(),X=f.headers.get("Content-Disposition"),D=(M=Ye(X))!=null?M:"Agent.".concat(C);ce(b,D)}catch(f){g.danger(v,{toastId:"post_sharing_modal_download_error",loggingTitle:v,loggingDescription:"Error message when a file download fails"}),J.addError(f)}finally{G(!1)}}else{const f=Ce[h];if(!f||!f.fileBlob){g.danger(v,{toastId:"post_sharing_modal_download_error",loggingTitle:v,loggingDescription:"Error message when a file download fails"}),J.addError("post_sharing_modal_download_error"),G(!1);return}ce(f.fileBlob,r)}},se=a?"image":void 0,Pe=!!se||!!c,te=ue||w,Ee=e.jsxs(e.Fragment,{children:[e.jsx("div",{className:T("flex flex-wrap justify-center space-y-4 space-x-12 max-sm:space-x-6","mt-12 max-sm:mt-6"),children:e.jsx(ts,{showLinkCopied:he,isGeneratingShareLink:te,disabled:te,onClick:je,postText:o,showDownloadButton:Pe,odysseyShareIntent:c,isDownloadingOdyssey:Se,onOdysseyFileDownload:Le,downloadVariant:se,isConversationDownloading:Me})}),is(xe,we,$!=null?$:!1)]});return e.jsx(Ve,{onExitComplete:t,children:V&&e.jsx(A.Root,{isOpen:!0,onClose:()=>{_(!1)},className:"max-w-[664px] px-4",children:e.jsx(A.Overlay,{showBackground:!0,children:e.jsxs(A.Content,{size:"normal",position:"center",className:T("flex flex-col pb-4 focus:outline-hidden",{"max-w-[640px]":ve==="normal"}),removePopoverStyling:!1,shadow:"normal",children:[e.jsx(A.Header,{title:o,type:"success",closeButton:e.jsx($e,{onClick:()=>_(!1)})}),e.jsxs("div",{children:[e.jsx("div",{className:T("flex justify-center",!c&&"pointer-events-none"),children:_e}),Ee]})]})})})})}async function os(n){const{shareTargetId:t,resolveShareRequest:s,toaster:o,intl:i,setIsResolvingShareLink:a,task:l}=n;if(t){a(!0);try{let c;try{({link:c}=await s())}catch(m){o.danger(i.formatMessage(x.failedToGenerateShareLink),{toastId:"failed_to_generate_share_link",hasCloseButton:!0});return}await l(c)}finally{a(!1)}}}async function rs(n){const{link:t,shareTargetId:s,toaster:o,intl:i}=n;if(s)try{await navigator.clipboard.writeText(t),B.setCopied(s),o.success(i.formatMessage(x.linkCopied),{hasCloseButton:!0})}catch(a){o.danger(i.formatMessage(x.failedToCopyShareLink),{toastId:"failed_to_copy_share_link",hasCloseButton:!0})}}function is(n,t,s){const o=[];return s&&o.push(e.jsx(z,y({},x.shareLinkVisibleToWorkspaceOnly),"workspace")),t&&o.push(e.jsx(z,y({},x.screenshotDisclaimer),"screenshot")),n&&o.push(e.jsx(z,le(y({},x.imageLicenseDisclaimer),{values:{nbsp:" ",link:i=>e.jsx("a",{href:"https://help.openai.com/",target:"_blank",rel:"noopener noreferrer",className:"underline",children:i})}}),"image")),o.length?e.jsx("p",{className:"text-token-text-tertiary text-center text-sm sm:mt-2",children:o.map((i,a)=>e.jsxs(Te.Fragment,{children:[a>0&&e.jsx(e.Fragment,{children:" "}),i]},a))},"image-disclaimer"):null}export{xs as PostSharingModal};
//# sourceMappingURL=gwra7p6qcaij4lh1.js.map
