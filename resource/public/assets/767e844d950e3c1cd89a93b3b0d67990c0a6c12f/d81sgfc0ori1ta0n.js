const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/gkerdwj307fj3n4u.js","assets/mw35uwhq4g8r9eam.js","assets/d0xa318sl7ywi0za.js","assets/root-kavs8piy.css","assets/h9z1eo55yfy9l6t8.js","assets/ee6pijsbu8dfevmi.js","assets/g2euln7v5pbm31qa.js","assets/conversation-small-lq38g8zw.css"])))=>i.map(i=>d[i]);
var X=Object.freeze,Y=Object.defineProperty,xe=Object.defineProperties;var pe=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var H=(s,n,t)=>n in s?Y(s,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[n]=t,se=(s,n)=>{for(var t in n||(n={}))Z.call(n,t)&&H(s,t,n[t]);if(y)for(var t of y(n))ee.call(n,t)&&H(s,t,n[t]);return s},ne=(s,n)=>xe(s,pe(n));var te=(s,n)=>{var t={};for(var l in s)Z.call(s,l)&&n.indexOf(l)<0&&(t[l]=s[l]);if(s!=null&&y)for(var l of y(s))n.indexOf(l)<0&&ee.call(s,l)&&(t[l]=s[l]);return t};var oe=(s,n)=>X(Y(s,"raw",{value:X(n||s.slice())}));import{j as e,r as g,_ as ue}from"./mw35uwhq4g8r9eam.js";import{aB as fe,n$ as he,o0 as je,o2 as C,aA as ge,e4 as _e,o1 as N,cF as P,be as ve,cB as be,p as we,u as Ce,d as le,mq as Ne,fP as ke,g4 as ye}from"./d0xa318sl7ywi0za.js";import{dE as Se,f3 as Le,aG as Fe,aF as Me}from"./g2euln7v5pbm31qa.js";import{u as Oe,D as Pe}from"./n1y6l9sf1j5k5tbv.js";import{u as De,U as Ee,a as ae}from"./n5xkgyvdnxkh67ko.js";import{s as $e}from"./h9z1eo55yfy9l6t8.js";import{S as F}from"./igahr13r672ordw9.js";import{S as M}from"./bhvk929w0gb4odci.js";import"./pcrw7exsshz05v7h.js";import"./kfdkis1zwf4ccfgg.js";import"./ol9d5wxhynx9q2is.js";import"./mbmcx8v24u1ao1ke.js";import"./i1lnixtvuwzfguvz.js";import"./bn9ckrhizgss6u36.js";import"./nc5snhuo5k648r43.js";import"./eq347oxkmgs4si5r.js";import"./cfgm997jt4en0fjd.js";const Te=ve(()=>ue(()=>import("./gkerdwj307fj3n4u.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(s=>s.JsonViewer));function as({threadId:s,threadUserId:n}){return De(Ee.isDebugModalOpen)&&e.jsx(fe,{testId:"modal-sonic-debug",isOpen:!0,onClose:()=>ae.toggleDebugModalOpen(),type:"success",size:"fullscreen",noPadding:!0,rootClassName:"z-50",children:e.jsx(Ve,{threadId:s,threadUserId:n!=null?n:void 0,onClose:()=>ae.toggleDebugModalOpen()})})}const ze=(s,n)=>{const t=JSON.stringify(n,null,2),l=new Blob([t],{type:"application/json"}),a=window.URL.createObjectURL(l),c=document.createElement("a");c.href=a,c.download=s,c.click(),window.URL.revokeObjectURL(a)},re="<|im_start|>",ce="<|im_sep|>",ie="<|im_end|>",Ae="<|fim_suffix|>",Re="<|meta_sep|>";function de({prompt:s}){const[n,t]=g.useState({}),l=[],a=[];let c=0;for(;;){const r=s.indexOf(re,c);if(r===-1)break;const i=s.indexOf(ce,r);if(i===-1)break;let o=s.indexOf(ie,i);const m=s.indexOf(Ae,i);if(m!==-1&&(o===-1||m<o)&&(o=m),o===-1)break;const d=s.substring(r+re.length,i).replace(Re," channel="),u=s.substring(i+ce.length,o);a.push(r);const k=n[r];l.push(e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>t(_=>ne(se({},_),{[r]:!_[r]})),children:k?e.jsx(M,{size:14}):e.jsx(F,{size:14})}),e.jsxs("span",{className:"font-semibold",children:["[",d,"]"]})]}),e.jsx("div",{className:P("whitespace-pre-wrap",k&&"line-clamp-2 truncate"),children:u})]},r)),c=o+ie.length}function p(r){const i={};for(const o of a)i[o]=r;t(i)}return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"absolute end-0 top-0 flex items-center gap-2 text-xs font-semibold",children:[e.jsxs("button",{className:"flex items-center gap-1 underline",onClick:()=>p(!0),children:[e.jsx(F,{size:14})," Collapse All"]}),"/",e.jsxs("button",{className:"flex items-center gap-1 underline",onClick:()=>p(!1),children:[e.jsx(M,{size:14})," Expand All"]})]}),e.jsx("div",{className:"flex flex-col gap-3",children:l})]})}var me;const j=be.div(me||(me=oe(["mb-[-5px] pb-0.5 font-semibold uppercase border-b-2 ",""])),({$isSelected:s})=>s?"border-black dark:border-white":"border-transparent");function Ve({threadId:s,threadUserId:n,message:t,onClose:l}){var E,$,T,z,A,R,V,B,J,U,K;const[a,c]=g.useState(t?"message":"json"),{data:p,isLoading:r,refetch:i}=Oe({threadId:s,threadUserId:n,refetchOnMount:"always"}),o=p==null?void 0:p.thread;if(g.useEffect(()=>{c(t?"message":o!=null&&o.turns.length?"turn".concat((o==null?void 0:o.turns.length)-1):"thread")},[o==null?void 0:o.turns.length,t]),!r&&!o&&!t)return e.jsxs(Pe,{onClickRetry:()=>i(),children:["Failed to load."," "]});if(r)return e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:"Loading..."});const m=o==null?void 0:o.turns,d=o==null?void 0:o.turns[o.turns.length-1],u=($=(E=d==null?void 0:d.artifacts__)==null?void 0:E.model_snapshots)==null?void 0:$.default_id,k=(R=(A=(z=(T=d==null?void 0:d.artifacts__)==null?void 0:T.settings)==null?void 0:z.model_response)==null?void 0:A.completion_model)==null?void 0:R.model,_=u!=null?u:k,S=(V=d==null?void 0:d.artifacts__)==null?void 0:V.eval_preset,D=n&&s?Le(n,s):null,v=(U=(J=(B=t==null?void 0:t.metadata)==null?void 0:B.__internal)==null?void 0:J.debug)==null?void 0:U.render_for_completion_result_decoded;return e.jsx("div",{className:"flex flex-col gap-2 font-mono text-xs break-words",children:e.jsxs(he,{orientation:"vertical",value:a,onValueChange:f=>c(f),children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs(je,{className:"flex items-center justify-start gap-3 p-2",children:[t&&e.jsx(C,{value:"message",children:e.jsx(j,{$isSelected:a==="message",children:"Message"})},"message"),v&&e.jsx(C,{value:"render_for_completion",children:e.jsx(j,{$isSelected:a==="render_for_completion",children:"Prompt"})},"render_for_completion"),o&&e.jsx(C,{value:"thread",children:e.jsx(j,{$isSelected:a==="thread",children:"Thread"})},"thread"),e.jsx(C,{value:"connectors",children:e.jsx(j,{$isSelected:a==="connectors",children:"Connectors"})},"connectors"),m==null?void 0:m.map((f,x)=>{var h,b;return e.jsxs(g.Fragment,{children:[e.jsx(C,{value:"turn".concat(x),children:e.jsxs(j,{$isSelected:a==="turn".concat(x),children:["Turn[",x,"]"]})},x),(b=(h=f.artifacts__)==null?void 0:h.debug_ddtrace_urls)==null?void 0:b.map(w=>e.jsx(j,{$isSelected:!1,children:e.jsxs("a",{target:"_blank",href:w,className:"text-nowrap",rel:"noreferrer",children:["Trace[",x,"] â†—"]})},w))]},x)})]}),e.jsxs("div",{className:"flex items-center justify-end",children:[o&&e.jsxs(ge,{size:"small",color:"secondary",onClick:()=>ze("thread.json",o),children:[e.jsx(Se,{className:"icon-sm"})," thread.json"]}),e.jsx(_e,{onClick:l})]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-2",children:[_&&e.jsxs(e.Fragment,{children:[e.jsx(L,{name:"Model",id:_,className:"shrink-0"})," ",e.jsx("span",{className:"text-gray-500 dark:text-white",children:"|"})]}),S&&S!=="production"&&e.jsxs(e.Fragment,{children:[e.jsx(L,{name:"Eval Preset",id:S,className:"shrink-0"}),e.jsx("span",{className:"text-gray-500 dark:text-white",children:"|"})]}),D&&e.jsx(e.Fragment,{children:e.jsx(L,{name:"Permalink",id:D,className:"flex-shrink-1"})})]}),m==null?void 0:m.map((f,x)=>{var b,w,I,q,G,Q,W;const h=(b=f.model_response)==null?void 0:b.text;return e.jsxs(N,{value:"turn".concat(x),className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth",children:[e.jsxs("div",{className:P("flex flex-col gap-2 p-2",((w=f.index)!=null?w:0)%2===1&&"bg-token-main-surface-secondary"),children:[e.jsx(de,{prompt:(Q=(G=(q=(I=f.artifacts__)==null?void 0:I.debug_info)==null?void 0:q.main_model_response)==null?void 0:G.prompt_string)!=null?Q:""}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"[assistant]"}),e.jsx("div",{"data-testid":"assistant-response",className:"whitespace-pre-wrap",children:(W=$e(h!=null?h:""))!=null?W:h})]})]})," "]},x)}),o&&e.jsx(N,{value:"thread",className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth p-2",children:e.jsx(O,{data:o,collapsed:4,jsonFiltersKey:"thread"})}),t&&e.jsx(N,{value:"message",className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth p-2",children:e.jsx(O,{data:t,collapsed:4,jsonFiltersKey:"message"})}),v&&e.jsx(N,{value:"render_for_completion",className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth p-2",children:e.jsx(de,{prompt:v!=null?v:""})}),e.jsx(N,{value:"connectors",className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth p-2",children:e.jsx(Be,{})})]},(K=o==null?void 0:o.turns.length)!=null?K:"message")})}function O({data:s,collapsed:n,jsonFiltersKey:t}){const[l,a]=g.useState(n!=null?n:!0);return e.jsxs("div",{className:"flex flex-col items-start gap-1",children:[e.jsx("button",{onClick:()=>a(!l),className:"flex items-center gap-1",children:l?e.jsxs(e.Fragment,{children:[e.jsx(M,{size:14})," Expand all"]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{size:14})," Collapse all"]})}),e.jsx("div",{className:"w-full",children:e.jsx(Te,{jsonFiltersKey:t,json:s,jsonViewProps:{collapsed:l,shortenTextAfterLength:0}},String(l))})]})}function Be(){const s=Ce(),n=le(()=>Ne(s)),t=n===void 0,{data:l,isLoading:a}=le(()=>ke(s)),{connectorLinks:c,isLoading:p}=ye({fetchValidLinksOnly:!0});if(t||a||p)return e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:"Loading connectors..."});const r=n.map(i=>{const u=i,{logo_url:o,logo_url_dark:m}=u;return te(u,["logo_url","logo_url_dark"])});return e.jsx(O,{data:{availableConnectors:r,syncConnectors:l,accessConnectors:c},collapsed:2,jsonFiltersKey:"connectors"})}function L({name:s,id:n,className:t}){const l=we(),a=g.useCallback(c=>{Fe(n,l,c)},[n,l]);return e.jsxs("div",{className:P("flex items-center gap-2 truncate",t),children:[e.jsxs("span",{className:"font-semibold text-nowrap",children:[s,":"]}),e.jsx("span",{title:n,className:"truncate text-gray-500 dark:text-white",children:n}),e.jsx(Me,{onCopy:a})]})}export{O as DebugJsonViewer,as as DebugModal,Ve as DebugModalContents};
//# sourceMappingURL=d81sgfc0ori1ta0n.js.map
