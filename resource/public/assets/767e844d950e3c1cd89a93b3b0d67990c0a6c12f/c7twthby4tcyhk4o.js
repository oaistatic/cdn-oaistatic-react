import{r as L,j as l}from"./mw35uwhq4g8r9eam.js";import{C as k}from"./pubq154p96h0wzc4.js";import{D as X}from"./fwz0otujtd6fpo4d.js";import{T as Y,A as P,u as Z,i as $,C as y,g as z}from"./ccdelfl27o3fxeuu.js";import{C as tt,c as et}from"./krza42hj097hj350.js";import{C as M}from"./ixsv6fw3pmowsupe.js";import{b as ot,d as rt,e as nt,f as U}from"./go83k4bw3m46lwwg.js";import{C as it}from"./ce3hgmw4iyyhicud.js";import{T as st}from"./ehv2vkvc6wjiqj3r.js";import{b as lt,g3 as ct,b9 as R,lG as mt}from"./g2euln7v5pbm31qa.js";import{bk as at,u as ut}from"./d0xa318sl7ywi0za.js";import{u as dt}from"./c8dilzb1umlthpuq.js";import{C as pt}from"./dvfkv7rxjyuaocsc.js";import"./juifnpcp74ymxcu2.js";import"./je2fy8gnwj5wx4yy.js";import"./fd8selpa9l1l2dzd.js";import"./f5lfl2gmtl8dkh1o.js";import"./b9m0h1g72p9whl0h.js";import"./f76gy0b8ieo4s693.js";import"./fwnz3uo9oosy1mt7.js";import"./dxkl0433k1u8ypnz.js";import"./ox7635ffwodpca7w.js";import"./ns51nblw8ziscsgd.js";import"./mstl8wgfzorpgdoe.js";import"./pcrw7exsshz05v7h.js";import"./kfdkis1zwf4ccfgg.js";import"./ol9d5wxhynx9q2is.js";import"./mbmcx8v24u1ao1ke.js";import"./cfgm997jt4en0fjd.js";import"./deakbbf27g8e7ba0.js";import"./d4h15g77ywnnjdmi.js";import"./obs7vyhux2j83kng.js";import"./kl7c6054usfnqmd4.js";import"./k97n0y6ba9c9h39c.js";import"./eg4jdclswoidzo1l.js";import"./67527rwulsulsisq.js";import"./deqlmsdlrzobu92w.js";function ft(t,e){const s=t.doc.lineAt(e.from);return e.from===s.from&&e.to-1===s.to}function gt(t){const e=t.dom.querySelector(".cm-gutters");return e?e.offsetWidth:0}const Ct=({onAddComment:t,isSendDisabled:e=!1,isWaitingForCommentResponse:s=!1})=>{const n=ot(),p=rt(),o=nt(),O=L.useCallback(r=>{const{height:i,width:u}=r,c=n();if(!p||!c)return null;const m=p.selection.asSingle();if(m.ranges.length===0)return null;const a=m.ranges[0],{empty:H,to:v}=a;let{head:g}=a;const{platform:I}=lt();g=I==="web"?g:v;const C=g===v;let w=g;if(C&&ft(p,a)&&(w-=1),H)return null;const{left:h,top:A,bottom:N}=c.contentDOM.getBoundingClientRect(),{left:W,top:_,bottom:b}=at(c.coordsAtPos(w,C?-1:1)),E=gt(c);function G(){if(C)return Math.max(W-h+E-u,E);let f=W-h+E;return f+u>o&&(f=-(u-o)),f}function j(f){const S=i*2,B=f.contentHeight-(b-N)>S&&window.innerHeight-b>S,V=b-A+8,x=_-A-i-8;return C&&B||x<0?{top:V,aboveOrBelow:P.BELOW}:{top:x,aboveOrBelow:P.ABOVE}}const T=j(c);return{left:G(),top:T.top,aboveOrBelow:T.aboveOrBelow,toolbarSize:r}},[p,n,o]),D=L.useCallback(()=>{var r,i;return(i=(r=n())==null?void 0:r.dom)!=null?i:null},[n]);return l.jsx(Y,{onAddComment:t,isWaitingForCommentResponse:s,isSendDisabled:e,toolbarType:st.CODE,getToolbarPosition:O,getEditorDom:D,getSelectionRange:()=>{const r=n();if(!r)return null;const{state:i}=r,u=i.selection.asSingle();if(u.ranges.length===0)return null;const c=u.ranges[0],{from:m,to:a}=c;return m==null||a==null?null:{from:m,to:a,sourceFrom:m,sourceTo:a}}})};function ht({diff:t}){var e;return Z((e=t==null?void 0:t.edits)!=null?e:[]),null}function Et(t,e,s){const n=s?z():0;return t<=1e3-n?t-(e?tt:0):t-(e?et:0)}const oe=({comments:t,currentlyStreamingLineIndex:e,isPreview:s=!1,isWaitingForCommentResponse:n=!1,isSendDisabled:p=!1,readonlyReason:o,isRequestActive:O=!1,language:D,value:r,textdocDiff:i,maxLength:u,onAcceleratorsExpandedChange:c,onAddComment:m,onAcceptComment:a,onDismissComment:H,onBlur:v,onSave:g,onChange:I,onCancelRequest:C,getStableCommentId:w=mt,commentsMode:h=M.ENABLED,hideToolbar:A,hideAccelerators:N=!1,onSubmitAccelerator:W,modelCursor:_,codemirrorRef:b})=>{var F;const E=L.useRef(null),G=ut(),j=ct(G),[{width:T},f]=dt(),S=L.useRef(null),B=t.length>0,V=S.current,x=Et(T,B,(F=$(V))!=null?F:!1),q=U(({commentingOn:d})=>d),J=U(({hoveredCommentId:d})=>d),K=U(({focusedCommentId:d})=>d);L.useEffect(()=>{var d;(d=E.current)==null||d.UNSAFE_setValue(r||"")},[r]);const Q=T-x;return l.jsx("div",{className:it.code,ref:R(f,S),style:j&&s?{margin:"0 16px"}:{},children:l.jsxs(k,{id:"codemirror",comments:h===M.ALL_HIDDEN?void 0:t,commentingOn:q,currentlyStreamingLineIndex:e,hoveredCommentId:J,focusedCommentId:K,language:D,readonlyReason:o,onChange:I,maxLength:u,value:r,textdocDiff:i,editorRef:R(E,b),width:x,modelCursor:_,isPreview:s,hideLineNumbers:j&&s,onBlur:v,onSave:g,children:[l.jsxs(k.EditorChildren,{children:[!A&&l.jsx(Ct,{onAddComment:m,isSendDisabled:p,isWaitingForCommentResponse:n}),h!==M.ALL_HIDDEN&&l.jsx("div",{className:B?"me-4":"",children:l.jsx(y,{getStableCommentId:w,availableWidth:Q,comments:t,commentsMode:h,onAddComment:m,onAcceptComment:a,onDismissComment:H,isWaitingForCommentResponse:n,isRequestActive:O,disableBlockComments:!0})})]}),l.jsxs(k.ContextChildren,{children:[i&&l.jsx(ht,{diff:i}),!N&&l.jsx(X,{isRequestActive:O,isVisuallyHidden:p||!!(o!=null&&o.isStreamingFromNative)||(o==null?void 0:o.isReadonly)&&!o.isStreaming,onSubmit:W,onCancel:C,actions:pt,onExpandedChange:c})]})]})})};export{oe as CodeComposer};
//# sourceMappingURL=c7twthby4tcyhk4o.js.map
