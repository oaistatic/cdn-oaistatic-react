var be=Object.defineProperty;var ue=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,Se=Object.prototype.propertyIsEnumerable;var de=(f,e,l)=>e in f?be(f,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):f[e]=l,pe=(f,e)=>{for(var l in e||(e={}))he.call(e,l)&&de(f,l,e[l]);if(ue)for(var l of ue(e))Se.call(e,l)&&de(f,l,e[l]);return f};import{c as ye,r as V,h as Me,u as _e,e as Ce,j as a,M as F}from"./mw35uwhq4g8r9eam.js";import{p as ve,u as xe,qS as Pe,er as we,eT as ae,_ as h,lq as me,J as ke,D as Ee,aB as De}from"./d0xa318sl7ywi0za.js";import{dn as Fe,ey as je,ez as Ne,cv as Oe,bO as Te}from"./g2euln7v5pbm31qa.js";import{u as Be}from"./bhddfysaujog4sdc.js";import{g as Ie}from"./m2xec4gtk8ypy5ff.js";function qe(f){"use forget";var le,re;const e=ye.c(96),{isOpen:l,onClose:c,onClaimOfferButtonClicked:$,currentAccount:i}=f,[j,ce]=V.useState(!1),o=Me(),p=ve(),_=xe(),{data:C}=Fe(),m=je(i.id),H=Ne(i.id);let N;e[0]!==i.id||e[1]!==o||e[2]!==p||e[3]!==H?(N=async(s,g)=>{ce(!0);const k=g?d.successfullyUpdatedSubscriptionWithFreePromo:d.successfullyUpdatedSubscriptionWithScheduledDiscountPromo;let ne=null;try{await H.mutateAsync({accountId:i.id,updatedPromoId:s}),h.logEventWithStatsig("Claim Subscription Cancellation Promotion Success","chatgpt_claim_subscription_cancellation_promotion_success",{promo_id:s}),p.success(o.formatMessage(k),{hasCloseButton:!0})}catch(Ge){ne=new Error("Failed to update subscription with zero dollar promo"),h.logEventWithStatsig("Claim Subscription Cancellation Promotion Error","chatgpt_claim_subscription_cancellation_promotion_error",{promo_id:s})}if(ce(!1),ne)throw ne},e[0]=i.id,e[1]=o,e[2]=p,e[3]=H,e[4]=N):N=e[4];const X=N;let v;e[5]!==i?(v=i.mustGetSubscriptionBillingCurrency("GlobalSettingsModal"),e[5]=i,e[6]=v):v=e[6];let O;e[7]!==_||e[8]!==v?(O={currency:v,ctx:_},e[7]=_,e[8]=v,e[9]=O):O=e[9];const{data:T,isLoading:Z,error:ee}=Oe(O),x=i.data.subscriptionStatus.planType;let B;e[10]!==i?(B=i.getLastActiveSubscription(),e[10]=i,e[11]=B):B=e[11];const I=B.subscription_id,u=i.data.subscriptionStatus.discount;let W;e[12]!==x?(W=Te(x.toLowerCase()),e[12]=x,e[13]=W):W=e[13];const n=W,S=_e();let G;e[14]!==i?(G=i.isEligibleForCancellationPromotion(),e[14]=i,e[15]=G):G=e[15];const fe=G,{cancellationPromoMetadata:t,isCancelPromoLoading:y}=Be(i.id,fe),U=(t==null?void 0:t.discount)&&!(t!=null&&t.is_immediately_invoiced),P=U&&"percentage"in t.discount&&t.discount.percentage===100;let L;e[16]!==t||e[17]!==P||e[18]!==U||e[19]!==$||e[20]!==c||e[21]!==S||e[22]!==p||e[23]!==X?(L=()=>{U?X(t.campaign_id,P).then(()=>{S.invalidateQueries(me()),S.invalidateQueries({refetchType:"all",queryKey:["cancellationPromotion"]}),c()}).catch(()=>{p.danger(d.claimPromoFailure,{duration:5,toastId:"cancel_subscription_modal"})}):$()},e[16]=t,e[17]=P,e[18]=U,e[19]=$,e[20]=c,e[21]=S,e[22]=p,e[23]=X,e[24]=L):L=e[24];const te=L;let E;if(e[25]!==t||e[26]!==T||e[27]!==ee||e[28]!==i||e[29]!==o||e[30]!==Z||e[31]!==x){e:{const s=i.mustGetSubscriptionBillingCurrency("GlobalSettingsModal");if(!t||!T||Z||ee){let k;e[33]===Symbol.for("react.memo_cache_sentinel")?(k={numPeriods:0,formattedDiscountedCost:""},e[33]=k):k=e[33],E=k;break e}const g=(re=(le=t.duration)==null?void 0:le.num_periods)!=null?re:1;E=pe({numPeriods:g},Ie(o,g,t.discount,s,T,x))}e[25]=t,e[26]=T,e[27]=ee,e[28]=i,e[29]=o,e[30]=Z,e[31]=x,e[32]=E}else E=e[32];const{numPeriods:r,formattedDiscountedCost:A}=E,M=(u==null?void 0:u.cancellation_policy)===Pe.IMMEDIATE&&!(u!=null&&u.discount_start_in_num_periods);let z;e[34]!==m||e[35]!==i||e[36]!==o||e[37]!==c||e[38]!==S||e[39]!==_||e[40]!==I||e[41]!==p?(z=async()=>{if(!i||!I)throw new Error("Missing current account or subscription id");await m.mutateAsync(i.id,{onError:()=>{p.danger(d.cancelFailure,{duration:5,toastId:"cancel_subscription_modal"}),h.logEventWithStatsig("Cancel Subscription Modal Cancel Failed","chatgpt_cancel_subscription_modal_cancel_failed")},onSuccess:async()=>{if(S.invalidateQueries(me()),p.info(o.formatMessage(d.cancelSuccess),{duration:5}),h.logEventWithStatsig("Cancel Subscription Modal Cancel Success","chatgpt_cancel_subscription_modal_cancel_success"),ke(_,"3376055906")){const g=new URL("https://openai.qualtrics.com/jfe/form/SV_eW3mdeRdMrpnPLw");g.searchParams.append("subscription_id",I),g.searchParams.append("plan_type",i.planType),i.authUserId?g.searchParams.append("oai_user",i.authUserId):Ee.addError("authUserId missing from currentAccount"),window.open(g.toString(),"_blank"),h.logEventWithStatsig("Subscription Cancellation Survey Shown","chatgpt_subscription_cancellation_survey_shown")}setTimeout(()=>{c()},5e3)}})},e[34]=m,e[35]=i,e[36]=o,e[37]=c,e[38]=S,e[39]=_,e[40]=I,e[41]=p,e[42]=z):z=e[42];const oe=z;let R,Y;e[43]!==m.isSuccess||e[44]!==c?(R=()=>{m.isSuccess&&c()},Y=[m.isSuccess,c],e[43]=m.isSuccess,e[44]=c,e[45]=R,e[46]=Y):(R=e[45],Y=e[46]),V.useEffect(R,Y),V.useEffect(We);let q,Q;e[47]!==t||e[48]!==y?(q=()=>{t&&!y&&h.logEventWithStatsig("Cancel Subscription Modal with Cancellation Promo Shown","chatgpt_cancel_subscription_modal_with_cancellation_promo_shown",{promo_id:t.campaign_id})},Q=[t,y],e[47]=t,e[48]=y,e[49]=q,e[50]=Q):(q=e[49],Q=e[50]),V.useEffect(q,Q);let D;e:{if(t!=null&&t.discount&&"percentage"in t.discount)if(t.discount.percentage===100){let s;e[51]!==o||e[52]!==r||e[53]!==n?(s=o.formatMessage(d.freeTitle,{numPeriods:r,planName:n}),e[51]=o,e[52]=r,e[53]=n,e[54]=s):s=e[54],D=s;break e}else{let s;e[55]!==t.discount.percentage||e[56]!==o||e[57]!==r||e[58]!==n?(s=o.formatMessage(d.percentageOffTitle,{percentage:t.discount.percentage,numPeriods:r,planName:n}),e[55]=t.discount.percentage,e[56]=o,e[57]=r,e[58]=n,e[59]=s):s=e[59],D=s;break e}else if(t!=null&&t.discount&&"value"in t.discount){let s;e[60]!==t.discount.currency_code||e[61]!==t.discount.value||e[62]!==o||e[63]!==r||e[64]!==n?(s=o.formatMessage(d.valueOffTitle,{valueOff:t.discount.value,currency:t.discount.currency_code,numPeriods:r,planName:n}),e[60]=t.discount.currency_code,e[61]=t.discount.value,e[62]=o,e[63]=r,e[64]=n,e[65]=s):s=e[65],D=s;break e}D=void 0}const ge=D;let K;e[66]!==o||e[67]!==C?(K=C!=null&&C.active_until?new Date(C.active_until).toLocaleDateString(o.locale,{year:"numeric",month:"short",day:"numeric"}):"",e[66]=o,e[67]=C,e[68]=K):K=e[68];const b=K;let ie;if(t)ie=ge;else{let s;e[69]!==b||e[70]!==u||e[71]!==o||e[72]!==M||e[73]!==n?(s=u?M?o.formatMessage({id:"cancelSubscriptionModal.hasDiscount.titleImmediate",defaultMessage:"End {planName} access immediately?"},{planName:n}):o.formatMessage({id:"cancelSubscriptionModal.hasDiscount.title",defaultMessage:"End {planName} access on {expirationDate}?"},{planName:n,expirationDate:b}):o.formatMessage({id:"cancelSubscriptionModal.title",defaultMessage:"Subscription Cancellation"}),e[69]=b,e[70]=u,e[71]=o,e[72]=M,e[73]=n,e[74]=s):s=e[74],ie=s}const se=ie;let w;e[75]!==oe||e[76]!==m.isPending||e[77]!==t||e[78]!==b||e[79]!==A||e[80]!==u||e[81]!==o||e[82]!==y||e[83]!==P||e[84]!==M||e[85]!==j||e[86]!==r||e[87]!==c||e[88]!==te||e[89]!==n?(w=y?a.jsx("div",{className:"flex items-center justify-center p-6",children:a.jsx(we,{})}):a.jsxs("div",{className:"flex flex-col gap-4 p-5",children:[t?a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"text-token-text-secondary font-[350]",children:"percentage"in t.discount&&t.discount.percentage!==100?n==="pro"?o.formatMessage(d.percentOffProSummary,{numPeriods:r,planName:n,formattedDiscountedCost:A}):o.formatMessage(d.percentOffPlusSummary,{numPeriods:r,planName:n,formattedDiscountedCost:A}):t.summary}),a.jsx("p",{className:"text-token-text-secondary",children:M?a.jsx(F,{id:"cancelSubscriptionModal.promo.canceledSubscriptionBottomImmediate",defaultMessage:"If you'd rather cancel now, your access to advanced features will end immediately."}):a.jsx(F,{id:"cancelSubscriptionModal.promo.canceledSubscriptionBottom",defaultMessage:"If you'd rather cancel now, your access to advanced features will end on {expirationDate}.",values:{expirationDate:b}})})]}):a.jsx("p",{className:"text-token-text-secondary",children:u?M?a.jsx(F,{id:"cancelSubscriptionModal.hasDiscount.canceledSubscriptionImmediate",defaultMessage:"If you cancel your subscription now, your {planName} access will end immediately. Any discounts applied will be removed, and can't be used again.",values:{planName:n}}):a.jsx(F,{id:"cancelSubscriptionModal.hasDiscount.canceledSubscription",defaultMessage:"If you cancel your subscription now, your {planName} access will end on {expirationDate}. Any discounts applied will be removed, and can't be used again.",values:{planName:n,expirationDate:b}}):a.jsx(F,{id:"cancelSubscriptionModal.canceledSubscription",defaultMessage:"Your {planName} subscription will be canceled but will remain active until the end of your billing period on {expirationDate}.",values:{planName:n,expirationDate:b}})}),a.jsxs("div",{className:"mt-5 flex justify-end gap-2",children:[a.jsx(ae,{title:o.formatMessage({id:"cancelSubscriptionModal.cancel",defaultMessage:"Cancel subscription"}),color:"danger-outline",onClick:()=>{h.logEventWithStatsig("Cancel Subscription Modal Confirmation Button Clicked","chatgpt_cancel_subscription_modal_confirmation_button_clicked"),oe()},loading:m.isPending,disabled:j}),t?a.jsx(ae,{title:P?o.formatMessage(d.keepPlanForFreeButton,{planName:n}):o.formatMessage(d.getOfferButton),color:"primary",onClick:te,loading:j,className:"px-4"}):a.jsx(ae,{title:o.formatMessage({id:"cancelSubscriptionModal.goBack",defaultMessage:"Go back"}),color:"primary",onClick:c})]})]}),e[75]=oe,e[76]=m.isPending,e[77]=t,e[78]=b,e[79]=A,e[80]=u,e[81]=o,e[82]=y,e[83]=P,e[84]=M,e[85]=j,e[86]=r,e[87]=c,e[88]=te,e[89]=n,e[90]=w):w=e[90];let J;return e[91]!==l||e[92]!==se||e[93]!==c||e[94]!==w?(J=a.jsx(De,{testId:"modal-cancel-subscription",type:"success",isOpen:l,hasSeparator:!0,onClose:c,size:"custom",rootClassName:"border-none",noPadding:!0,className:"max-w-[596px]",headerClassName:"border-b-[rgba(0,0,0,0.10)] [&_h2]:font-semibold! p-3 ps-5",showCloseButton:!0,title:se,removePopoverStyling:!0,closeButtonClassName:"focus-visible:outline focus-visible:outline-[2px] focus-visible:outline-black focus-visible:outline-offset-[2.5px] focus-visible:outline-black bg-transparent!",children:w}),e[91]=l,e[92]=se,e[93]=c,e[94]=w,e[95]=J):J=e[95],J}function We(){h.logEventWithStatsig("Cancel Subscription Modal Shown","chatgpt_cancel_subscription_modal_shown")}const d=Ce({cancelSuccess:{id:"cancelSubscriptionModal.cancelSuccess",defaultMessage:"Your subscription has been canceled."},getOfferButton:{id:"cancelSubscriptionModal.getOfferButton",defaultMessage:"Get offer"},keepPlanForFreeButton:{id:"cancelSubscriptionModal.keepPlanForFreeButton",defaultMessage:"Keep {planName} for free"},cancelFailure:{id:"cancelSubscriptionModal.cancelFailure",defaultMessage:"Something went wrong while canceling your subscription."},claimPromoFailure:{id:"cancelSubscriptionModal.claimPromoFailure",defaultMessage:"Something went wrong while claiming the promotion, please try again."},freeTitle:{id:"cancelSubscriptionModal.freeTitle",defaultMessage:"Get {numPeriods, plural, one {one month} other {{numPeriods} months}} of {planName}, free"},percentageOffTitle:{id:"cancelSubscriptionModal.percentageOffTitle",defaultMessage:"Get {percentage}% off {planName} for {numPeriods, plural, one {one month} other {{numPeriods} months}}"},valueOffTitle:{id:"cancelSubscriptionModal.valueOffTitle",defaultMessage:"Get {valueOff} off {planName} for {numPeriods, plural, one {one month} other {{numPeriods} months}}"},percentOffProSummary:{id:"cancelSubscriptionModal.percentOffSummary",defaultMessage:"We’d love for you to stay — how about {formattedDiscountedCost} for {numPeriods, plural, one {one month} other {{numPeriods} months}} on us? You'll keep maximizing your productivity with the most advanced Pro models, unlimited messages, and maximum memory."},percentOffPlusSummary:{id:"cancelSubscriptionModal.percentOffPlusSummary",defaultMessage:"We’d love for you to stay — how about {formattedDiscountedCost} for {numPeriods, plural, one {one month} other {{numPeriods} months}} on us? You'll keep the full experience - advanced models for complex problems, extended limits, and more memory to pick up right where you left off"},successfullyUpdatedSubscriptionWithFreePromo:{id:"cancelSubscriptionModal.successfullyUpdatedSubscriptionWithFreePromo",defaultMessage:"Your subscription has been updated and will auto-renew for free during your next billing cycle."},successfullyUpdatedSubscriptionWithScheduledDiscountPromo:{id:"cancelSubscriptionModal.successfullyUpdatedSubscriptionWithScheduledDiscountPromo",defaultMessage:"Your subscription has been updated and will auto-renew at the discounted rate during your next billing cycle."}});export{qe as CancelSubscriptionModal};
//# sourceMappingURL=mqrqjv7zx52ao0js.js.map
