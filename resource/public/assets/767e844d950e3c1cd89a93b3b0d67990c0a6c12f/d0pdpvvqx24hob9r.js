var A=Object.defineProperty,_=Object.defineProperties;var D=Object.getOwnPropertyDescriptors;var g=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable;var L=(e,t,o)=>t in e?A(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,m=(e,t)=>{for(var o in t||(t={}))E.call(t,o)&&L(e,o,t[o]);if(g)for(var o of g(t))C.call(t,o)&&L(e,o,t[o]);return e},f=(e,t)=>_(e,D(t));import{r as d,b as I}from"./mw35uwhq4g8r9eam.js";import{ag as r,ah as c,cH as O,aS as w}from"./d0xa318sl7ywi0za.js";import{u as N}from"./nc5snhuo5k648r43.js";import{bC as S}from"./g2euln7v5pbm31qa.js";const s="last_checked_loc",b=1440*60*1e3,u="last_denied_loc",p=3600*1e3;function q(){const[e,t]=N(),{data:o}=O(w.PreciseLocationEnabledForDevice);d.useEffect(()=>{typeof o=="boolean"&&e.useLocation!==o&&t(n=>f(m({},n),{useLocation:o}))},[o,t,e.useLocation]);const{data:a}=I({queryKey:["userLocation",e.useLocation],queryFn:({queryKey:[n,i]})=>y({enabled:i}),initialData:k(e.useLocation),networkMode:"always",refetchOnMount:"always",refetchOnWindowFocus:"always",staleTime:0});return a}function k(e){if(e){const t=r.getCookie(c.LastLocation);if(t)try{return JSON.parse(t)}catch(o){return l(),null}}return null}async function y({enabled:e}){var o;if(!e)return l();if(((o=await T())==null?void 0:o.state)!=="granted"){const a=localStorage.getItem(s);if(a){const n=Number(a),i=r.getCookie(c.LastLocation);if(i&&Date.now()-b<n)try{return JSON.parse(i)}catch(P){}}}const t=localStorage.getItem(u);if(t){const a=Number(t);if(Date.now()-p<a)return null}return await new Promise(a=>{navigator.geolocation.getCurrentPosition(n=>{const i={latitude:n.coords.latitude,longitude:n.coords.longitude,locationAccuracy:n.coords.accuracy};r.setCookie(c.LastLocation,JSON.stringify(i),{maxAge:S}),localStorage.setItem(s,Date.now().toString()),a(i)},()=>{localStorage.setItem(u,Date.now().toString()),a(l())},{enableHighAccuracy:!0,maximumAge:0})})}function J(){return y({enabled:!0})}async function T(){return navigator!=null&&navigator.permissions?await navigator.permissions.query({name:"geolocation"}):null}const h={latitude:null,longitude:null,locationAccuracy:null};function l(){return r.setCookie(c.LastLocation,JSON.stringify(h),{maxAge:S}),localStorage.removeItem(s),localStorage.removeItem(u),null}d.createContext(null);export{l as c,J as r,q as u};
//# sourceMappingURL=d0pdpvvqx24hob9r.js.map
