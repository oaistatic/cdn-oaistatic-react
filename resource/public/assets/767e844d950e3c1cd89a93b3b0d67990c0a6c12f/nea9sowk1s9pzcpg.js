var ts=Object.freeze,as=Object.defineProperty,Us=Object.defineProperties;var Ls=Object.getOwnPropertyDescriptors;var rs=Object.getOwnPropertySymbols;var Ps=Object.prototype.hasOwnProperty,zs=Object.prototype.propertyIsEnumerable;var os=(t,s,r)=>s in t?as(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r,R=(t,s)=>{for(var r in s||(s={}))Ps.call(s,r)&&os(t,r,s[r]);if(rs)for(var r of rs(s))zs.call(s,r)&&os(t,r,s[r]);return t},te=(t,s)=>Us(t,Ls(s));var Te=(t,s)=>ts(as(t,"raw",{value:ts(s||t.slice())}));import{g as qs,h as oe,u as ye,i as Me,e as ve,r as c,j as e,M as i,d as ys,b as vs,c as Is,n as Bs}from"./mw35uwhq4g8r9eam.js";import{el as Ws,em as Vs,sv as Qs,wM as Ks,wN as $s,wO as Ys,hR as Js,iJ as Xs,jm as Zs,p as be,u as je,R as Z,wP as pe,lr as et,wQ as st,cF as ee,f7 as x,fJ as qe,_ as Q,iK as xe,aS as Pe,al as bs,aA as re,aB as we,e5 as tt,cw as ze,mk as rt,e1 as ot,J as ns,cH as at,cG as nt,gw as is,cB as js,dp as ls}from"./d0xa318sl7ywi0za.js";import{vx as ws,vy as it,vz as lt,vA as ks,bF as ce,bG as ue,bd as X,dM as dt,be as Ie,bH as me,nm as Cs,vB as _s,vC as ct,vD as mt,bD as Ns,hP as Ss,bE as Rs,tC as ut,aG as ft,vE as ht,vF as gt,bn as Ts,aZ as xt,bu as Mt,z as pt,ec as yt,bI as vt,bJ as bt}from"./g2euln7v5pbm31qa.js";import{S as jt}from"./ey0kaiz1v4k0znjj.js";var He,ds;function wt(){if(ds)return He;ds=1;var t=Ws(),s=Vs(),r="[object RegExp]";function o(a){return s(a)&&t(a)==r}return He=o,He}var De,cs;function kt(){if(cs)return De;cs=1;var t=wt(),s=Qs(),r=Ks(),o=r&&r.isRegExp,a=o?s(o):t;return De=a,De}var Ge,ms;function Ct(){if(ms)return Ge;ms=1;var t=$s(),s=t("length");return Ge=s,Ge}var Ee,us;function _t(){if(us)return Ee;us=1;var t="\\ud800-\\udfff",s="\\u0300-\\u036f",r="\\ufe20-\\ufe2f",o="\\u20d0-\\u20ff",a=s+r+o,n="\\ufe0e\\ufe0f",f="["+t+"]",w="["+a+"]",m="\\ud83c[\\udffb-\\udfff]",v="(?:"+w+"|"+m+")",G="[^"+t+"]",_="(?:\\ud83c[\\udde6-\\uddff]){2}",k="[\\ud800-\\udbff][\\udc00-\\udfff]",S="\\u200d",p=v+"?",C="["+n+"]?",M="(?:"+S+"(?:"+[G,_,k].join("|")+")"+C+p+")*",y=C+p+M,d="(?:"+[G+w+"?",w,_,k,f].join("|")+")",h=RegExp(m+"(?="+m+")|"+d+y,"g");function T(N){for(var H=h.lastIndex=0;h.test(N);)++H;return H}return Ee=T,Ee}var Oe,fs;function Nt(){if(fs)return Oe;fs=1;var t=Ct(),s=ws(),r=_t();function o(a){return s(a)?r(a):t(a)}return Oe=o,Oe}var Ae,hs;function St(){if(hs)return Ae;hs=1;var t=Ys(),s=it(),r=ws(),o=Js(),a=kt(),n=Nt(),f=lt(),w=Xs(),m=Zs(),v=30,G="...",_=/\w*$/;function k(S,p){var C=v,M=G;if(o(p)){var y="separator"in p?p.separator:y;C="length"in p?w(p.length):C,M="omission"in p?t(p.omission):M}S=m(S);var d=S.length;if(r(S)){var h=f(S);d=h.length}if(C>=d)return S;var T=C-n(M);if(T<1)return M;var N=h?s(h,0,T).join(""):S.slice(0,T);if(y===void 0)return N+M;if(h&&(T+=N.length-T),a(y)){if(S.slice(T).search(y)){var H,F=N;for(y.global||(y=RegExp(y.source,m(_.exec(y))+"g")),y.lastIndex=0;H=y.exec(F);)var g=H.index;N=N.slice(0,g===void 0?T:g)}}else if(S.indexOf(t(y),T)!=T){var B=N.lastIndexOf(y);B>-1&&(N=N.slice(0,B))}return N+M}return Ae=k,Ae}var Rt=St();const Hs=qs(Rt),Tt="https://help.openai.com/en/articles/8590148-memory-faq";function Ds({memory:t,gizmo:s,className:r,readOnly:o,showDivider:a}){var ae,V;const n=oe(),f=be(),w=ye(),m=je(),v=ks(m),{mutate:G,isPending:_}=Me({mutationFn:async({memoryId:O,status:Y})=>{const{success:se}=await Z.safePatch("/memories/{memory_id}/status",{parameters:{path:{memory_id:O}},requestBody:{status:Y}});if(!se)throw new Error("An error occurred while updating the memory status")},onSettled:()=>{w.invalidateQueries({queryKey:ce(s==null?void 0:s.id)}),w.invalidateQueries({queryKey:ue()})},onError:()=>{f.danger(z.somethingWentWrong,{id:"memoryUpdateStatusFailed",toastId:"memory_update_status_failed"})}}),{mutate:k,isPending:S}=Me({mutationFn:async O=>{const{success:Y}=await Z.safeDelete("/memories/{memory_id}",{parameters:{path:{memory_id:O}},requestBody:{gizmo_id:s==null?void 0:s.id}});if(!Y)throw new Error("An error occurred while deleting the memory")},onSettled:()=>{w.invalidateQueries({queryKey:ce(s==null?void 0:s.id)}),w.invalidateQueries({queryKey:ue()})},onError:()=>{f.danger(z.deleteFailed,{id:"memoryDeleteFailed",toastId:"memory_delete_failed"})}}),[p,C]=c.useState(!1);function M(O){const Y=new Date,se=O.getFullYear()===Y.getFullYear();try{return n.formatDate(O,R({month:"long",day:"numeric"},se?{}:{year:"numeric"}))}catch(ne){const u={month:"long",day:"numeric"};return se||(u.year="numeric"),O.toLocaleDateString(void 0,u)}}const y=n.formatMessage(z.moreOptions),h=((ae=t.status)!=null?ae:pe)==="cold",T=h?()=>{Q.logEvent("Memory Manage Modal Memory Unarchive Clicked"),G({memoryId:t.id,status:"warm"},{onSuccess:()=>{f.successNeutral(n.formatMessage(z.memoryPrioritized),{duration:4,hasCloseButton:!1})}})}:void 0,N=()=>{Q.logEvent("Memory Manage Modal Memory Delete Clicked"),C(!0)},H=h&&t.last_updated?z.deprioritizedOnNoReason:null,F=h&&t.last_updated?{actor:t.last_updated.actor==="user"?n.formatMessage(z.you):"ChatGPT",date:t.last_updated.timestamp!=null?(()=>{const O=et(t.last_updated.timestamp);return M(O)})():n.formatMessage(z.unknownDate)}:void 0,g=t.conversation_id,B=g?"/c/".concat(g):void 0,W=t.updated_at?(()=>{const O=st(t.updated_at);return M(O)})():void 0,U=h?null:B?W?z.savedOnFromChat:z.savedFromChat:W?z.savedOnNoChat:null,K=h?void 0:B?{date:W,link:O=>e.jsx("a",{href:B,className:"underline",target:"_blank",rel:"noreferrer",children:O})}:W?{date:W}:void 0;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:ee("group border-token-border-default flex w-full flex-row items-center gap-3 border-b px-3",a===!1&&"border-b-0",(S||_)&&"pointer-events-none opacity-50",r),children:[e.jsx("div",{className:ee("min-w-0 flex-1 py-3 whitespace-pre-wrap",h&&"text-token-text-tertiary"),children:t.content}),e.jsx("div",{className:"flex shrink-0 justify-end",children:e.jsx(X.Actions,{children:!o&&e.jsxs(x.Root,{children:[e.jsx(x.Trigger,{asChild:!0,children:e.jsx("button",{"aria-label":y,className:"text-token-text-tertiary hover:text-token-text-secondary pointer-events-none size-8! opacity-0 group-hover:pointer-events-auto group-hover:opacity-100",children:e.jsx(qe,{className:"icon"})})}),e.jsx(x.Portal,{children:e.jsxs(x.Content,{align:"start",size:"small",className:"max-w-[280px] min-w-0",children:[T&&v&&e.jsx(x.Item,{icon:dt,onClick:T,children:n.formatMessage(z.prioritizeThisMemory)}),e.jsx(x.Item,{icon:Ie,color:"danger",onClick:N,children:n.formatMessage(z.delete)}),H&&F&&e.jsx(x.Group,{children:e.jsx("div",{className:"text-token-text-tertiary px-4 py-2 text-[13px] leading-4",children:e.jsx(i,te(R({},H),{values:F}))})}),U&&K&&e.jsx(x.Group,{children:e.jsx("div",{className:"text-token-text-tertiary px-4 py-2 text-[13px] leading-4",children:e.jsx(i,te(R({},U),{values:K}))})})]})})]})})})]}),!o&&p&&e.jsx(me,{isOpen:!0,primaryButtonColor:"danger",title:n.formatMessage(z.deleteConfirmTitle),confirmText:n.formatMessage(z.delete),onConfirm:()=>{Q.logEvent("Memory Manage Modal Memory Delete Confirmed"),k(t.id,{onSuccess:()=>{f.successNeutral(n.formatMessage(z.memoryDeleted),{duration:4,hasCloseButton:!1})}}),C(!1)},onClose:()=>{C(!1)},children:e.jsx("div",{className:"mb-2 text-sm",children:n.formatMessage(z.deleteConfirmDescription,{name:(V=s==null?void 0:s.name)!=null?V:"ChatGPT",title:e.jsx("strong",{children:Hs(t.content,{length:130,omission:"..."})}),link:O=>e.jsx("a",{href:Tt,target:"_blank",rel:"noreferrer",className:"underline",children:O})})})})]})}const z=ve({deprioritizedOnNoReason:{id:"MemoryRow.deprioritizedOnNoReason",defaultMessage:"Deprioritized by {actor} on {date}."},deprioritizedOnWithReason:{id:"MemoryRow.deprioritizedOnWithReason",defaultMessage:"Deprioritized by {actor} on {date} because {reason}."},delete:{id:"MemoryRow.delete",defaultMessage:"Delete"},deleteConfirmTitle:{id:"MemoryRow.deleteConfirmTitle",defaultMessage:"Delete this memory?"},deleteConfirmDescription:{id:"MemoryRow.deleteConfirmDescription",defaultMessage:'"{title}" will be deleted. {name} may not remember this information going forward. <link>Learn more</link>'},deleteFailed:{id:"MemoryRow.deleteFailed",defaultMessage:"Failed to forget memory"},moreOptions:{id:"MemoryRow.moreOptions",defaultMessage:"More options"},savedFromChat:{id:"MemoryRow.savedFromChat",defaultMessage:"Saved from a <link>chat</link>."},savedOnFromChat:{id:"MemoryRow.savedOnFromChat",defaultMessage:"Saved on {date} from a <link>chat</link>."},savedOnNoChat:{id:"MemoryRow.savedOnNoChat",defaultMessage:"Saved on {date}."},somethingWentWrong:{id:"MemoryRow.somethingWentWrong",defaultMessage:"Something went wrong..."},memoryPrioritized:{id:"MemoryRow.memoryPrioritized",defaultMessage:"Memory prioritized"},memoryDeleted:{id:"MemoryRow.memoryDeleted",defaultMessage:"Memory deleted"},prioritizeThisMemory:{id:"MemoryRow.prioritizeThisMemory",defaultMessage:"Prioritize this memory"},unknownDate:{id:"MemoryRow.unknownDate",defaultMessage:"Unknown date"},you:{id:"MemoryRow.you",defaultMessage:"You"}}),Ht=80,Dt=100;function Gt(t){const s=Cs(),r=_s();return s&&!r&&t!=null&&t>Ht}function Et({memoryFullPct:t,className:s}){if(!Gt(t))return null;const o=t;return e.jsx("div",{className:ee("flex items-center justify-center",s),children:e.jsx("div",{className:ee("flex items-center justify-center gap-0.5 rounded-[8px] p-1 text-sm leading-4 font-semibold whitespace-nowrap",o>=Dt?"bg-token-bg-status-error text-token-interactive-label-danger-secondary-default":"bg-token-bg-status-warning text-token-text-status-warning"),children:e.jsx(i,{id:"R17Ykc",defaultMessage:"{memoryFullPct}% full",values:{memoryFullPct:o}})})})}const Fe=ve({disableOptimizeTitle:{id:"personalizationSettings.disableOptimizeTitle",defaultMessage:"Turn off automatic memory management?"},turnOff:{id:"common.turnOff",defaultMessage:"Turn off"},disableOptimizeDescription:{id:"personalizationSettings.disableOptimizeDescription",defaultMessage:"Once memory is full, ChatGPT won't save new memories, and responses may feel less personal. {link}"}}),Ot=({isOpen:t=!1,setShowDisableOMConfirm:s,goldenHourMutation:r})=>{const o=oe();return e.jsx(me,{isOpen:t,title:o.formatMessage(Fe.disableOptimizeTitle),confirmText:o.formatMessage(Fe.turnOff),primaryButtonColor:"danger",onConfirm:()=>{r.mutate({setting:Pe.GoldenHour,value:!1}),s(!1)},onClose:()=>{s(!1)},children:e.jsx("div",{className:"mb-2 text-sm",children:e.jsx(i,te(R({},Fe.disableOptimizeDescription),{values:{link:a=>e.jsx(xe,{href:"https://help.openai.com/en/articles/8590148-memory-faq",className:"underline",children:a})}}))})})};function At({label:t,active:s,onClick:r}){return e.jsx("button",{onClick:r,className:"rounded-lg px-3 py-2.5 text-start text-sm "+(s?"dark:bg-token-interactive-bg-secondary-press dark:hover:bg-token-interactive-bg-secondary-hover bg-[#0000000f] hover:bg-[#0000000a]":"dark:hover:bg-token-interactive-bg-secondary-hover hover:bg-[#0000000a]"),children:e.jsx("div",{className:"font-semibold text-wrap",children:t})})}function Ft({isOpen:t,onClose:s}){const r=oe(),o=je();bs(o);const a=ye(),{data:n,isLoading:f,isFetching:w,refetch:m}=ct(50,t),v=c.useMemo(()=>Array.isArray(n==null?void 0:n.history)?n.history:[],[n]),G=f||w&&!n,[_,k]=c.useState(null),[S,p]=c.useState(!1),[C,M]=c.useState(!1),[y,d]=c.useState(!1),[h,T]=c.useState(!1),N=c.useCallback(async()=>{await m()},[m]),H=c.useCallback(u=>{const b=new Date((u||0)*1e3),j=b.getFullYear()===new Date().getFullYear();try{const A=r.formatDate(b,R({month:"long",day:"numeric"},j?{}:{year:"numeric"})),L=r.formatTime(b,{hour:"numeric",minute:"2-digit"});return"".concat(A,", ").concat(L)}catch(A){const L={month:"long",day:"numeric"};j||(L.year="numeric");const q=b.toLocaleDateString(void 0,L),D=b.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit"});return"".concat(q,", ").concat(D)}},[r]),F=c.useMemo(()=>v.map(u=>{var b;return{id:(b=u.id)!=null?b:"__current__",label:H(u.snapshot_time)}}),[v,H]),g=c.useMemo(()=>{var b,j,A;if(v.length===0)return null;if(_==null)return(j=(b=v.find(L=>L.id==null))!=null?b:v[0])!=null?j:null;const u=_==="__current__"?null:_;return(A=v.find(L=>{var q;return((q=L.id)!=null?q:"__current__")===(u!=null?u:"__current__")}))!=null?A:null},[v,_]),B=c.useMemo(()=>g?H(g.snapshot_time):"",[g,H]),W=c.useCallback(()=>{!g||g.id==null||d(!0)},[g]),U=c.useCallback(async()=>{if(!(!g||g.id==null)){T(!0);try{const{success:u}=await Z.safeDelete("/memories/history/{memory_history_id}",{parameters:{path:{memory_history_id:g.id}}});if(!u)throw new Error("failed");await N(),k(null)}catch(u){}finally{T(!1),d(!1)}}},[g,N]),K=(_!=null?_:"__current__")==="__current__",ae=(g==null?void 0:g.id)!=null&&!K;c.useEffect(()=>{if(!t||G)return;if(v.length===0){k(j=>j===null?j:null);return}const u=new Set(v.map(j=>{var A;return(A=j.id)!=null?A:"__current__"})),b=u.has("__current__");k(j=>{var L,q;const A=j!=null?j:"__current__";return u.has(A)?j:b?null:(q=(L=v[0])==null?void 0:L.id)!=null?q:null})},[t,G,v]);function V(u){var q,D;const b=u.updated_at!=null?Date.parse(u.updated_at):NaN;let j=(q=u.last_updated)==null?void 0:q.timestamp;j=j!=null?j:(D=u.created_timestamp)!=null?D:void 0;const A=j!=null?j*1e3:NaN,L=Math.max(Number.isFinite(b)?b:-1/0,Number.isFinite(A)?A:-1/0);return Number.isFinite(L)?L:0}const{currentMemories:O,deprioritizedMemories:Y}=c.useMemo(()=>{var L,q;const u=(L=g==null?void 0:g.memories)!=null?L:[],b=[],j=[];for(const D of u)((q=D.status)!=null?q:pe)==="cold"?j.push(D):b.push(D);const A=(D,ie)=>V(ie)-V(D);return{currentMemories:b.sort(A),deprioritizedMemories:j.sort(A)}},[g]),se=c.useMemo(()=>[...O,...Y],[O,Y]);let ne=null;return G?ne=e.jsxs("div",{className:"border-token-border-default flex w-full flex-col rounded-lg border",children:[e.jsxs("div",{className:"border-token-border-default relative flex flex-row items-center justify-between gap-3 px-4 py-5",children:[e.jsxs("div",{className:"flex w-48 flex-col gap-2 px-3",children:[e.jsx("div",{className:"bg-token-bg-tertiary h-5 w-48 animate-pulse rounded"}),e.jsx("div",{className:"bg-token-bg-tertiary h-3 w-28 animate-pulse rounded"})]}),e.jsx("div",{className:"bg-token-bg-tertiary h-8 w-36 animate-pulse rounded-full"}),e.jsx("span",{className:"sr-only",children:e.jsx(i,R({},I.loading))})]}),e.jsx("div",{className:"flex flex-1 overflow-y-auto px-4",children:e.jsx("div",{className:"w-full",children:Array.from({length:6}).map((u,b)=>{const j=Math.floor(Math.random()*193)+128;return e.jsx("div",{className:"border-token-border-default flex items-start gap-3 border-b py-4",children:e.jsx("div",{className:"bg-token-bg-tertiary h-6 animate-pulse rounded",style:{width:"".concat(j,"px")}})},b)})})})]}):g?ne=e.jsxs("div",{className:"border-token-border-default flex w-full flex-col rounded-lg border",children:[e.jsxs("div",{className:"border-token-border-default group relative flex flex-row items-center justify-between gap-2 px-4 py-5",children:[e.jsx("div",{className:"min-w-0 flex-1 px-3",children:e.jsx("div",{className:"text-lg font-semibold",children:B})}),e.jsxs("div",{className:"flex h-full shrink-0 items-start gap-2 pe-1",children:[ae?e.jsxs(x.Root,{children:[e.jsx(x.Trigger,{asChild:!0,children:e.jsx("button",{"aria-label":r.formatMessage(I.moreOptions),className:"text-token-text-tertiary hover:text-token-text-secondary size-8!",children:e.jsx(qe,{className:"icon"})})}),e.jsx(x.Portal,{children:e.jsx(x.Content,{align:"start",size:"small",className:"max-w-[200px] min-w-0",children:e.jsx(x.Item,{icon:Ie,color:"danger",onClick:W,className:"gap-2.5! pe-3!",children:r.formatMessage(I.deleteSnapshot)})})})]}):null,e.jsx(re,{color:"secondary",onClick:()=>p(!0),disabled:K,style:{pointerEvents:K?"none":void 0},children:g.id==null?e.jsx(i,R({},I.currentVersion)):e.jsx(i,R({},I.restoreThisVersion))})]})]}),O.length+Y.length===0?e.jsx("div",{className:"text-token-text-tertiary flex flex-1 items-center justify-center p-4 text-sm",children:e.jsx(i,R({},I.noMemories))}):e.jsx("div",{className:"flex flex-1 overflow-y-auto px-4",children:e.jsx("div",{className:"w-full text-sm",children:se.map((u,b)=>e.jsx(Ds,{memory:u,gizmo:void 0,readOnly:!0,showDivider:b!==se.length-1},u.id))})})]}):ne=e.jsx("div",{className:"border-token-border-default text-token-text-tertiary flex h-full w-full items-center justify-center rounded-lg border p-4 text-sm",children:e.jsx(i,R({},I.noMemories))}),e.jsxs(e.Fragment,{children:[e.jsx(we,{testId:"modal-saved-memories-history",isOpen:t,onClose:s,size:"custom",className:"max-h-[85vh] max-md:min-h-[60vh] md:h-[740px] md:max-w-[960px]",type:"success",title:r.formatMessage(I.title),showCloseButton:!0,children:e.jsxs("div",{className:"flex h-full min-h-0 gap-4",children:[e.jsx("div",{className:"w-60 shrink-0 overflow-y-auto",children:e.jsx("div",{className:"flex flex-col pb-2",children:G?Array.from({length:6}).map((u,b)=>e.jsx("div",{className:"rounded px-3 py-2.5",children:e.jsx("div",{className:"bg-token-bg-tertiary h-4 w-40 animate-pulse rounded"})},b)):e.jsxs(e.Fragment,{children:[F.map(u=>{const b=(_!=null?_:"__current__")===u.id;return e.jsx(At,{label:u.label,active:b,onClick:()=>k(u.id)},u.id)}),F.length===0?e.jsx("div",{className:"text-sm",children:e.jsx(i,R({},I.noHistory))}):null]})})}),e.jsx("div",{className:"flex min-w-0 flex-1 overflow-hidden",children:ne})]})}),y&&(g==null?void 0:g.id)!=null&&e.jsx(me,{isOpen:!0,title:r.formatMessage(I.confirmDeleteTitle),confirmText:r.formatMessage(I.confirmDeleteCta),primaryButtonColor:"danger",loading:h,onConfirm:U,onClose:()=>{h||d(!1)},children:e.jsx("div",{className:"text-token-text-secondary mb-2 text-sm",children:e.jsx(i,R({},I.confirmDeleteBody))})}),S&&e.jsx(me,{isOpen:!0,title:r.formatMessage(I.confirmRestoreTitle),confirmText:r.formatMessage(I.confirmRestoreCta),primaryButtonColor:"danger",loading:C,onConfirm:async()=>{if(!(!g||g.id==null)){M(!0);try{const{success:u}=await Z.safePost("/memories/history/{memory_history_id}/revert",{parameters:{path:{memory_history_id:g.id}}});if(!u)throw new Error("failed");await N(),k(null),a.invalidateQueries({queryKey:["memories"]})}catch(u){}finally{p(!1),M(!1)}}},onClose:()=>p(!1),children:e.jsx("div",{className:"mb-2 text-sm",children:e.jsx(i,R({},I.confirmRestoreBody))})})]})}const I=ve({title:{id:"SavedMemoriesHistoryModal.title",defaultMessage:"Saved memories history"},loading:{id:"SavedMemoriesHistoryModal.loading",defaultMessage:"Loading..."},noHistory:{id:"SavedMemoriesHistoryModal.noHistory",defaultMessage:"No checkpoints"},noMemories:{id:"SavedMemoriesHistoryModal.noMemories",defaultMessage:"No memories"},currentVersion:{id:"SavedMemoriesHistoryModal.currentVersion",defaultMessage:"Current version"},restoreThisVersion:{id:"SavedMemoriesHistoryModal.restoreThisVersion",defaultMessage:"Restore this version"},confirmRestoreTitle:{id:"SavedMemoriesHistoryModal.confirmRestoreTitle",defaultMessage:"Restore this version?"},confirmRestoreBody:{id:"SavedMemoriesHistoryModal.confirmRestoreBody",defaultMessage:"This will replace your current saved memories."},confirmRestoreCta:{id:"SavedMemoriesHistoryModal.confirmRestoreCta",defaultMessage:"Restore"},cancel:{id:"common.cancel",defaultMessage:"Cancel"},moreOptions:{id:"SavedMemoriesHistoryModal.moreOptions",defaultMessage:"More options"},deleteSnapshot:{id:"SavedMemoriesHistoryModal.deleteSnapshot",defaultMessage:"Delete this version"},confirmDeleteTitle:{id:"SavedMemoriesHistoryModal.confirmDeleteTitle",defaultMessage:"Delete this version?"},confirmDeleteBody:{id:"SavedMemoriesHistoryModal.confirmDeleteBody",defaultMessage:"This cannot be undone."},confirmDeleteCta:{id:"SavedMemoriesHistoryModal.confirmDeleteCta",defaultMessage:"Delete"}}),Ut=80,ke=100;function Gs(t){return t<ke?"bg-token-bg-status-warning text-token-text-status-warning":"bg-token-bg-status-error text-token-interactive-label-danger-secondary-default"}function Es(t){return Cs()&&t!=null&&t>Ut}function Xt({memoryFullPct:t,className:s,children:r,showInfoLabel:o,onManageMemories:a}){return Es(t)?e.jsx("div",{className:ee("border-token-border-default rounded-lg border p-1 text-sm",s),children:e.jsxs(tt.div,{className:ee("flex h-7 items-center gap-1 overflow-hidden rounded-sm px-1.5 font-medium whitespace-nowrap",Gs(t)),initial:{width:0},animate:{width:"".concat(t,"%")},transition:{duration:.5},children:[e.jsx(mt,{className:"icon-sm ms-1"}),e.jsx(i,{id:"6D2etG",defaultMessage:"{memoryFullPct}% full",values:{memoryFullPct:t}}),r,o&&e.jsx(ze,{interactive:!0,label:t<ke?e.jsx("div",{className:"whitespace-normal",children:e.jsx(i,{id:"gxY4wi",defaultMessage:"ChatGPT's almost out of space for new saved memories. <memoryModalLink>Manage saved memories</memoryModalLink> to create more space.",values:{memoryModalLink:f=>e.jsx("a",{href:"#",className:"cursor-pointer underline",onClick:w=>{w.preventDefault(),a==null||a()},children:f})}})}):e.jsx("div",{className:"whitespace-normal",children:e.jsx(i,{id:"1JxMf3",defaultMessage:"ChatGPT's out of space for saved memories. <memoryModalLink>Manage saved memories</memoryModalLink> to create more space.",values:{memoryModalLink:f=>e.jsx("a",{href:"#",className:"cursor-pointer underline",onClick:w=>{w.preventDefault(),a==null||a()},children:f})}})}),children:e.jsx(rt,{className:"icon-sm ms-1"})})]})}):null}function Lt({memoryFullPct:t,className:s,showUpgradeCTA:r=!1,isPaid:o=!1,onUpgrade:a}){return Es(t)?e.jsxs("div",{className:ee("border-token-border-default bg-token-main-surface-primary flex items-center justify-between gap-4 rounded-lg border p-[14px]",s),children:[e.jsxs("div",{className:"inline-block gap-1",children:[e.jsx("div",{className:ee("mb-1 inline-block rounded-[6px] px-[6px] py-[2px] text-sm font-semibold",Gs(t!=null?t:0)),children:e.jsx(i,{id:"56hzv4",defaultMessage:"{memoryFullPct}% full",values:{memoryFullPct:t}})}),e.jsx("div",{className:"text-token-text-secondary text-sm",children:(t!=null?t:0)>=ke?o?e.jsx(i,{id:"HaCKNx",defaultMessage:"New memories can't be saved, so responses may feel less personalized. Delete existing memories to free up space."}):e.jsx(i,{id:"MXPinw",defaultMessage:"New memories can't be saved, so responses may feel less personalized. Upgrade to expand memory, or delete existing memories."}):o?e.jsx(i,{id:"obgK9b",defaultMessage:"Once memory is full, responses may feel less personalized. Delete existing memories to free up space."}):e.jsx(i,{id:"PDLzFM",defaultMessage:"Once memory is full, responses may feel less personalized. Upgrade to expand memory, or delete existing memories."})})]}),r&&!o&&e.jsx(re,{color:"primary",size:"medium",onClick:a,children:e.jsx(i,{id:"1rRvWt",defaultMessage:"Upgrade"})})]}):null}function Pt({memoryFullPct:t,className:s,onUpgrade:r}){const o=(t!=null?t:0)>=ke,a=o?"bg-token-bg-status-error text-token-interactive-label-danger-secondary-default":"bg-token-bg-status-warning text-token-text-status-warning";return e.jsxs("div",{className:ee("border-token-border-default bg-token-main-surface-primary flex items-center justify-between gap-4 rounded-2xl border p-[14px]",s),children:[e.jsxs("div",{className:"inline-block gap-1",children:[e.jsx("div",{className:ee("mb-1 inline-block rounded-[6px] px-[6px] py-[2px] text-sm font-semibold",a),children:e.jsx(i,{id:"56hzv4",defaultMessage:"{memoryFullPct}% full",values:{memoryFullPct:t}})}),e.jsx("div",{className:"text-token-text-secondary text-xs",children:o?e.jsx(i,{id:"MXPinw",defaultMessage:"New memories can't be saved, so responses may feel less personalized. Upgrade to expand memory, or delete existing memories."}):e.jsx(i,{id:"PDLzFM",defaultMessage:"Once memory is full, responses may feel less personalized. Upgrade to expand memory, or delete existing memories."})})]}),e.jsx(re,{color:"primary",size:"medium",onClick:r,children:e.jsx(i,{id:"1rRvWt",defaultMessage:"Upgrade"})})]})}var Ms;const ge=js.div(Ms||(Ms=Te(["flex h-full items-center justify-center pb-8 text-sm text-token-text-tertiary rounded-lg border border-token-border-default"])));function gs(t){var n,f;const s=t.updated_at!=null?Date.parse(t.updated_at):NaN;let r=(n=t.last_updated)==null?void 0:n.timestamp;r=r!=null?r:(f=t.created_timestamp)!=null?f:void 0;const o=r!=null?r*1e3:NaN,a=Math.max(Number.isFinite(s)?s:-1/0,Number.isFinite(o)?o:-1/0);return Number.isFinite(a)?a:0}function Zt({isOpen:t,onClose:s,initialGizmoId:r,contextScopes:o,memoryEntriesFilter:a,requiredContextScopes:n}){var $e,Ye,Je,Xe,Ze,es,ss;const f=je(),w=ys(),m=oe(),v=ot(),G=be(),_=Ns(),[k,S]=c.useState(r),[p,C]=c.useState(!1),[M,y]=c.useState(""),[d,h]=c.useState(!1),[T,N]=c.useState(!1),[H,F]=c.useState(!1),[g,B]=c.useState(!1),[W,U]=c.useState(!1),[K,ae]=c.useState(!1),V=c.useRef(null),O=Ss(),Y=($e=ns(f,"3453210147"))!=null?$e:!1;ns(f,"1900515849");const se=ks(f),{data:ne,isLoading:u}=at(Pe.GoldenHour),b=ne!==void 0&&se,j=_s(),A=nt(!0),L=c.useCallback(l=>{if(!l&&j){U(!0);return}A.mutate({setting:Pe.GoldenHour,value:l}),Q.logEventWithStatsig("Personalization Settings Automatic Memory Management ".concat(l?"Enabled":"Disabled"),"chatgpt_personalization_settings_automatic_memory_management_".concat(l?"enabled":"disabled"))},[A,j]),q=u||A.isPending,{data:D,isLoading:ie,isError:Ce,refetch:Be}=Rs(k,!0,_,o,a,n),We=(Ye=D==null?void 0:D.memories)!=null?Ye:[],_e=We.length,fe=[...We].sort((l,P)=>(p?1:-1)*(gs(l)-gs(P))),Ne=(()=>{const l=M.trim();if(l==="")return fe;const P=new Set(ut(fe,l,J=>({targets:[J.content]}),{locale:m.locale,maxResults:fe.length}).map(J=>J.id));return fe.filter(J=>P.has(J.id))})(),Ve=Ne.filter(l=>{var P;return((P=l.status)!=null?P:pe)!=="cold"}),Qe=Ne.filter(l=>{var P;return((P=l.status)!=null?P:pe)==="cold"}),le=c.useMemo(()=>[...Ve,...Qe],[Ve,Qe]);c.useEffect(()=>()=>{V.current&&(clearTimeout(V.current),V.current=null)},[]);const Os=c.useCallback(async l=>{if(le.length===0)return;const P=le.map(J=>{var he;return(he=J.content)!=null?he:""}).join("\n");try{await ft(P,G,l),ae(!0),V.current&&clearTimeout(V.current),V.current=setTimeout(()=>{ae(!1),V.current=null},2e3)}catch(J){}},[le,G]),{data:Se,refetch:Wt}=vs({queryKey:["memory_gizmos"],queryFn:()=>Z.safeGet("/memories/gizmos"),refetchOnMount:"always"}),Re=ht(f,(Je=D==null?void 0:D.memoryFullPct)!=null?Je:0)!=="control",$=[{id:void 0,name:"ChatGPT",iconUrl:null},...(Xe=Se==null?void 0:Se.items.map(({gizmo:l})=>{var P;return{id:l.id,name:l.display.name,iconUrl:(P=l.display.profile_picture_url)!=null?P:null}}))!=null?Xe:[]].find(l=>l.id===k);c.useEffect(()=>{!ie&&!Ce&&k!==void 0&&_e===0&&S(void 0)},[ie,Ce,k,_e]);const As=O&&j?E.descriptionOptimizeOn:O&&b?E.descriptionPaid:O?E.descriptionFreeMoonshine:E.descriptionFree,Ke=m.formatMessage(K?E.copiedAll:E.copyAll),Fs=l=>e.jsx(xe,{href:Ue,className:"underline",children:l});let de;return ie?de=e.jsx(ge,{className:"border-none",children:e.jsx(i,R({},E.loading))}):Ce?de=e.jsx(ge,{className:"border-none",children:e.jsxs("div",{className:"max-w-sm text-center",children:[e.jsx("div",{className:"mb-4 text-red-500",children:e.jsx(i,{id:"MemoriesModal.somethingWentWrong",defaultMessage:"Something went wrong..."})}),e.jsx("div",{children:e.jsx(re,{color:"secondary",size:"small",onClick:()=>{Be()},children:e.jsx(i,{id:"MemoriesModal.retry",defaultMessage:"Retry"})})})]})}):_e===0?de=e.jsx(ge,{className:"text-token-text-primary border-none",children:_?e.jsxs("div",{className:"flex h-full max-w-sm flex-col items-center justify-center gap-0.5 text-center text-base",children:[e.jsx(gt,{className:"icon-xl"}),e.jsx(i,te(R({},E.noMemories),{values:{name:(Ze=$==null?void 0:$.name)!=null?Ze:"ChatGPT"}}))]}):e.jsx("div",{className:"flex h-full max-w-sm items-center justify-center text-center",children:e.jsx(i,R({},E.noMemoriesAndDisabled))})}):M.trim()!==""&&Ne.length===0?de=e.jsx(ge,{className:"text-token-text-tertiary border-none",children:e.jsxs("div",{className:"flex h-full max-w-sm flex-col items-center justify-center gap-2 text-center text-base",children:[e.jsx(is,{className:"icon-lg"}),e.jsx("div",{children:e.jsx(i,te(R({},E.searchNoResults),{values:{query:M.trim()}}))}),e.jsx("div",{children:e.jsx(re,{color:"secondary",size:"small",onClick:()=>{F(!0)},children:e.jsx(i,R({},E.viewHistory))})})]})}):de=e.jsx(X.Root,{size:"compact",children:e.jsx(X.Body,{children:le.map((l,P)=>{const J=$?{id:$.id,name:$.name}:void 0,he={memory:l,gizmo:J,showDivider:P!==le.length-1};return e.jsx(Ds,R({},he),l.id)})})}),e.jsxs(e.Fragment,{children:[e.jsxs(we,{testId:"modal-golden-hour-memories",isOpen:t,size:"custom",className:"max-h-[85vh] px-2 py-2 max-md:min-h-[60vh] md:h-[740px] md:max-w-[680px]",headerClassName:"shrink-0",contentClassName:"h-full flex flex-col",type:"success",onClose:s,title:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{children:m.formatMessage(E.title)}),!Re&&e.jsx(Et,{memoryFullPct:D==null?void 0:D.memoryFullPct})]}),description:!Re&&e.jsx("div",{className:"text-token-text-secondary",children:m.formatMessage(As,{link:Fs})}),showCloseButton:!0,isScrollable:!1,children:[e.jsxs("div",{className:"border-token-border-default w-full border-b pb-4",children:[Re&&e.jsx(Pt,{memoryFullPct:D==null?void 0:D.memoryFullPct,onUpgrade:()=>{var l;Q.logEventWithStatsig("Memories Upgrade Button Clicked","chatgpt_memories_upgrade_button_clicked_settings",{memory_full_pct:(l=D==null?void 0:D.memoryFullPct)!=null?l:0}),Ts(w,"chatgpt_memories_upgrade_button")},className:"mb-6"}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"relative min-w-0 flex-1",children:[e.jsx("div",{className:"pointer-events-none absolute start-3 top-1/2 flex h-5 w-5 -translate-y-1/2 items-center justify-center",children:e.jsx(is,{className:"icon text-token-text-tertiary"})}),e.jsx("input",{type:"text",id:"memories-search",name:"memories-search",placeholder:m.formatMessage(E.searchPlaceholder),className:"border-token-border-default placeholder:text-token-text-tertiary/70 h-9.5 w-full max-w-[320px] rounded-full border bg-transparent ps-10 pe-3 text-sm outline-none focus:shadow-none focus:ring-0 focus:outline-none",value:M,onChange:l=>y(l.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-0.5",children:[Y&&e.jsx("button",{type:"button","aria-label":Ke,title:Ke,disabled:le.length===0,onClick:Os,className:"text-token-text-tertiary hover:text-token-text-secondary hover:bg-token-interactive-bg-tertiary-hover inline-flex size-8! items-center justify-center rounded-md disabled:cursor-not-allowed disabled:opacity-40",children:K?e.jsx(xt,{className:"icon"}):e.jsx(Mt,{className:"icon"})}),e.jsxs(x.Root,{children:[e.jsx(x.Trigger,{asChild:!0,children:e.jsx("button",{"aria-label":m.formatMessage(E.sortAria),className:"text-token-text-tertiary hover:text-token-text-secondary hover:bg-token-interactive-bg-tertiary-hover inline-flex size-8! items-center justify-center rounded-md",children:e.jsx(jt,{className:"icon"})})}),e.jsx(x.Portal,{children:e.jsxs(x.Content,{align:"start",size:"auto",className:"max-w-[280px] min-w-[165px]",children:[e.jsx(x.Group,{children:e.jsx("div",{className:"text-token-text-tertiary px-4 pt-2.5 pb-2 text-[13px] leading-4",children:e.jsx(i,R({},E.sortHeader))})}),e.jsxs(x.RadioGroup,{value:p?"oldest":"newest",onValueChange:l=>C(l==="oldest"),children:[e.jsx(x.RadioItem,{value:"newest",children:e.jsx(i,R({},E.newestFirst))}),e.jsx(x.RadioItem,{value:"oldest",children:e.jsx(i,R({},E.oldestFirst))})]})]})})]}),e.jsxs(x.Root,{children:[e.jsx(x.Trigger,{asChild:!0,children:e.jsx("button",{"aria-label":m.formatMessage(E.moreOptionsAria),className:"text-token-text-tertiary hover:text-token-text-secondary hover:bg-token-interactive-bg-tertiary-hover inline-flex size-8! items-center justify-center rounded-md",children:e.jsx(qe,{className:"icon"})})}),e.jsx(x.Portal,{children:e.jsxs(x.Content,{align:"start",size:"small",className:"max-w-[280px] min-w-0",children:[b&&e.jsx(x.Group,{children:e.jsx(x.CheckboxItem,{label:m.formatMessage(E.autoManageTitle),checked:j,disabled:q,onCheckedChange:l=>{L(l===!0)}})}),e.jsxs(x.Group,{children:[e.jsx(x.Item,{onClick:()=>{F(!0)},children:e.jsx(i,R({},E.viewHistory))}),e.jsx(x.Item,{color:"danger",onClick:()=>{N(!1),h(!0)},children:e.jsx(i,R({},E.deleteAllMemories))})]})]})})]})]})]})]}),e.jsx("div",{className:"h-full min-w-sm overflow-y-auto",children:de}),d&&e.jsx(me,{isOpen:!0,primaryButtonColor:"danger",title:m.formatMessage(E.deleteAllConfirmTitle),confirmText:m.formatMessage(E.deleteAllConfirmCta),loading:g,onConfirm:async()=>{B(!0);try{const l={gizmo_id:k,context_scopes:o,required_context_scopes:n,memory_entries_filter:a,delete_history:T};k===void 0&&(l.delete_history=T),await Z.safeDelete("/settings/clear_account_user_memory",{requestBody:l}),await Be()}catch(l){}finally{B(!1),h(!1)}},onClose:()=>h(!1),children:e.jsxs("div",{className:"mb-2 flex flex-col gap-5 text-sm",children:[e.jsx("div",{className:"text-sm",children:O?e.jsx(i,te(R({},E.deleteAllConfirmDescriptionUpdated),{values:{name:(es=$==null?void 0:$.name)!=null?es:"ChatGPT",link:l=>e.jsx(xe,{href:Ue,className:"underline",children:l})}})):e.jsx(i,te(R({},E.deleteAllConfirmDescription),{values:{name:(ss=$==null?void 0:$.name)!=null?ss:"ChatGPT",link:l=>e.jsx(xe,{href:Ue,className:"underline",children:l})}}))}),e.jsxs("div",{className:"border-token-border-default flex flex-row gap-3 rounded-2xl border px-4 py-4 text-sm",children:[e.jsx(pt,{id:"delete-past-versions",checked:T,onChange:l=>N(l.target.checked),className:"border-token-border-default! h-5 w-5 shrink-0 rounded-full! border ring-0 ring-offset-0 focus:ring-0 focus:ring-offset-0 focus:outline-none",style:{backgroundColor:T?v?"transparent":"black":"transparent"}}),e.jsx("span",{children:m.formatMessage(E.alsoDeletePastVersions)})]})]})})]}),e.jsx(Ft,{isOpen:H,onClose:()=>F(!1)}),b&&W&&e.jsx(Ot,{isOpen:W,setShowDisableOMConfirm:U,goldenHourMutation:A})]})}const Ue="https://help.openai.com/en/articles/8983136-what-is-memory",E=ve({descriptionFree:{id:"GoldenHourMemoriesModalFree.description",defaultMessage:"ChatGPT remembers useful details about you and your preferences so it can be more helpful. <link>Learn more</link>"},descriptionFreeMoonshine:{id:"GoldenHourMemoriesModal.description.freeMoonshine",defaultMessage:"ChatGPT tries to remember your recent chats, but it may forget things over time. Saved memories are never forgotten. <link>Learn more</link>"},descriptionPaid:{id:"GoldenHourMemoriesModal.description",defaultMessage:"ChatGPT automatically remembers useful information from chats, making responses more relevant and personal. <link>Learn more</link>"},descriptionOptimizeOn:{id:"GoldenHourMemoriesModal.description.optimizeOn",defaultMessage:"ChatGPT remembers and automatically manages useful information from chats, making responses more relevant and personal. <link>Learn more</link>"},copyAll:{id:"GoldenHourMemoriesModal.copyAll",defaultMessage:"Copy all"},copiedAll:{id:"GoldenHourMemoriesModal.copiedAll",defaultMessage:"Copied"},delete:{id:"GoldenHourMemoriesModal.delete",defaultMessage:"Delete"},deleteDescription:{id:"GoldenHourMemoriesModal.deleteDescription",defaultMessage:'"{title}" will be deleted. {name} may not remember this information going forward. <link>Learn more</link>'},history:{id:"GoldenHourMemoriesModal.history",defaultMessage:"History"},historyIntro:{id:"GoldenHourMemoriesModal.historyIntro",defaultMessage:"Revert to a previous version of your saved memories."},historyModalTitle:{id:"GoldenHourMemoriesModal.historyModalTitle",defaultMessage:"Saved memories history"},loading:{id:"GoldenHourMemoriesModal.loading",defaultMessage:"Loading..."},noHistory:{id:"GoldenHourMemoriesModal.noHistory",defaultMessage:"No checkpoints"},noMemories:{id:"GoldenHourMemoriesModal.noMemories",defaultMessage:"No saved memories"},noMemoriesAndDisabled:{id:"GoldenHourMemoriesModal.noMemoriesAndDisabled",defaultMessage:"Memory is disabled. ChatGPT won't use or save memories."},autoManageTitle:{id:"GoldenHourMemoriesModal.autoManageTitle",defaultMessage:"Automatically manage"},remove:{id:"GoldenHourMemoriesModal.remove",defaultMessage:"Remove"},retry:{id:"GoldenHourMemoriesModal.retry",defaultMessage:"Retry"},somethingWentWrong:{id:"GoldenHourMemoriesModal.somethingWentWrong",defaultMessage:"Something went wrong..."},title:{id:"GoldenHourMemoriesModal.title",defaultMessage:"Saved memories"},unknownGizmo:{id:"GoldenHourMemoriesModal.unknownGizmo",defaultMessage:"Unknown GPT"},viewHistoryTooltip:{id:"GoldenHourMemoriesModal.viewHistoryTooltip",defaultMessage:"View saved memories history"},viewingSnapshot:{id:"GoldenHourMemoriesModal.viewingSnapshot",defaultMessage:"Viewing snapshot from {date}"},searchPlaceholder:{id:"GoldenHourMemoriesModal.searchPlaceholder",defaultMessage:"Search memories"},searchNoResults:{id:"GoldenHourMemoriesModal.searchNoResults",defaultMessage:'No results found for "{query}"'},sortAria:{id:"GoldenHourMemoriesModal.sortAria",defaultMessage:"Sort"},sortHeader:{id:"GoldenHourMemoriesModal.sortHeader",defaultMessage:"Sort"},newestFirst:{id:"GoldenHourMemoriesModal.newestFirst",defaultMessage:"Newest first"},oldestFirst:{id:"GoldenHourMemoriesModal.oldestFirst",defaultMessage:"Oldest first"},moreOptionsAria:{id:"GoldenHourMemoriesModal.moreOptionsAria",defaultMessage:"More options"},viewHistory:{id:"GoldenHourMemoriesModal.viewHistory",defaultMessage:"View history"},deleteAllMemories:{id:"GoldenHourMemoriesModal.deleteAllMemories",defaultMessage:"Delete all memories"},deleteAllConfirmTitle:{id:"GoldenHourMemoriesModal.deleteAllConfirmTitle",defaultMessage:"Delete all memories?"},deleteAllConfirmCta:{id:"GoldenHourMemoriesModal.deleteAllConfirmCta",defaultMessage:"Delete all"},deleteAllConfirmDescription:{id:"GoldenHourMemoriesModal.deleteAllConfirmDescription",defaultMessage:"{name} may not remember this information going forward. To fully remove this information from memory, also delete any related chats. <link>Learn more</link>"},deleteAllConfirmDescriptionUpdated:{id:"GoldenHourMemoriesModal.deleteAllConfirmDescriptionUpdated",defaultMessage:"{name} may not remember this information going forward. To fully remove this information from memory, also delete any related chats. <link>Learn more</link>"},alsoDeletePastVersions:{id:"GoldenHourMemoriesModal.alsoDeletePastVersions",defaultMessage:"Also delete all past versions of saved memories. This cannot be undone."}});function xs({description:t,onClose:s,onConfirm:r}){const o=oe();return e.jsx(we,{testId:"modal-confirm-reset-memory",isOpen:!0,onClose:s,type:"success",title:o.formatMessage({id:"MemoriesModal.resetModalTitle",defaultMessage:"Are you sure?"}),description:t,primaryButton:e.jsx(ls.Button,{title:o.formatMessage({id:"MemoriesModal.resetModalConfirm",defaultMessage:"Clear memory"}),color:"danger",onClick:r,"data-testid":"confirm-reset-memories-button"}),secondaryButton:e.jsx(ls.Button,{title:o.formatMessage({id:"MemoriesModal.resetModalCancel",defaultMessage:"Cancel"}),color:"secondary",onClick:s})})}function zt(t){"use forget";const s=Is.c(20),{onReset:r,gizmoId:o,memoryName:a,contextScopes:n,requiredContextScopes:f,memoryEntriesFilter:w}=t,[m,v]=c.useState(!1),G=oe(),_=be(),k=Ss();let S;s[0]!==n||s[1]!==o||s[2]!==G||s[3]!==w||s[4]!==r||s[5]!==f||s[6]!==_?(S=async()=>{Q.logEvent("Memory Manage Reset Button Confirmed");try{const h={context_scopes:n,required_context_scopes:f,memory_entries_filter:w};o&&(h.gizmo_id=o),await Z.safeDelete("/settings/clear_account_user_memory",{requestBody:h}),_.success(G.formatMessage({id:"ResetMemoriesButton.resetSuccess",defaultMessage:"Memory cleared."})),r&&r(),v(!1)}catch(h){_.danger(Bs({id:"ResetMemoriesButton.resetFailed",defaultMessage:"Failed to clear memory."}),{toastId:"reset_memories_button_reset_failed"})}},s[0]=n,s[1]=o,s[2]=G,s[3]=w,s[4]=r,s[5]=f,s[6]=_,s[7]=S):S=s[7];const p=S;let C;s[8]===Symbol.for("react.memo_cache_sentinel")?(C=()=>{Q.logEvent("Memory Manage Reset Button Clicked"),v(!0)},s[8]=C):C=s[8];let M;s[9]!==o?(M=e.jsx(re,{color:"danger-outline",onClick:C,"data-testid":"reset-memories-button",children:o?e.jsx(i,{id:"ResetMemoriesButton.resetGizmo",defaultMessage:"Clear this GPT's memory"}):e.jsx(i,{id:"ResetMemoriesButton.resetChatGPT",defaultMessage:"Delete all"})}),s[9]=o,s[10]=M):M=s[10];let y;s[11]!==p||s[12]!==k||s[13]!==G||s[14]!==a||s[15]!==m?(y=m&&(k?e.jsx(xs,{description:G.formatMessage({id:"MemoriesModal.resetGizmoModalDescriptionUpdated",defaultMessage:"Deleting your saved memories means {name} may not remember this information going forward. To fully remove this information from {name}'s memory, please delete any related chats. <link>Learn more</link>"},{name:a,link:qt}),onClose:()=>v(!1),onConfirm:p}):e.jsx(xs,{description:G.formatMessage({id:"MemoriesModal.resetGizmoModalDescription",defaultMessage:"{name} will forget everything it has remembered from your chats. This cannot be undone."},{name:a}),onClose:()=>v(!1),onConfirm:p})),s[11]=p,s[12]=k,s[13]=G,s[14]=a,s[15]=m,s[16]=y):y=s[16];let d;return s[17]!==M||s[18]!==y?(d=e.jsxs(e.Fragment,{children:[M,y]}),s[17]=M,s[18]=y,s[19]=d):d=s[19],d}function qt(t){return e.jsx("a",{className:"underline",href:"https://help.openai.com/en/articles/8983136-what-is-memory",children:t})}function It({gizmo:t,memory:s}){var y;const r=oe(),o=be(),a=ye(),[n,f]=c.useState(!1),[w,m]=c.useState(s.content),v=c.useRef(null);c.useEffect(()=>{if(n&&v.current){const d=v.current,h=d.value.length;d.focus(),d.setSelectionRange(h,h)}},[n]);const{mutate:G,isPending:_}=Me({mutationFn:async d=>{const{success:h}=await Z.safeDelete("/memories/{memory_id}",{parameters:{path:{memory_id:d}},requestBody:{gizmo_id:t==null?void 0:t.id}});if(!h)throw new Error("An error occurred while deleting the memory")},onSettled:()=>{a.invalidateQueries({queryKey:ce(t==null?void 0:t.id)}),a.invalidateQueries({queryKey:ue()})},onError:()=>{o.danger({id:"MemoriesModal.deleteFailed",defaultMessage:"Failed to forget memory",description:"Toast message when deleting memory fails"},{id:"memoryDeleteFailed",toastId:"memory_delete_failed"})}}),{mutate:k,isPending:S}=Me({mutationFn:async()=>await Z.safePatch("/memories/{memory_id}",{parameters:{path:{memory_id:s.id}},requestBody:{gizmo_id:t==null?void 0:t.id,content:w}}),onSuccess:d=>{const{memory_max_tokens:h,memory_num_tokens:T}=d;a.setQueryData(ce(t==null?void 0:t.id),N=>{if(!N||typeof N!="object")return N;const H=N,F=Math.min(Math.floor(100*T/h),100);return te(R({},H),{memory_max_tokens:h,memory_num_tokens:T,memoryFullPct:F})}),a.invalidateQueries({queryKey:ce(t==null?void 0:t.id)}),a.invalidateQueries({queryKey:ue()}),f(!1)},onError:()=>{o.danger({id:"MemoriesModal.editFailed",defaultMessage:"Failed to update memory",description:"Toast message when editing memory fails"},{id:"memoryEditFailed",toastId:"memory_edit_failed"})}}),[p,C]=c.useState(!1),M=r.formatMessage({id:"N0czuB",defaultMessage:"Remove"});return e.jsxs(e.Fragment,{children:[e.jsx(X.Row,{disabled:_||S,children:n?e.jsxs(X.Cell,{colSpan:2,className:"relative pe-0",children:[e.jsx("input",{ref:v,autoFocus:!0,value:w,onChange:d=>m(d.target.value),className:"w-full rounded border-2 border-transparent py-2 pe-36 focus:outline-none",maxLength:500,onKeyDown:d=>{if(!d.nativeEvent.isComposing&&d.key==="Enter"){if(w.trim()===""){Q.logEvent("Memory Manage Modal Memory Delete Clicked"),C(!0);return}k()}}}),e.jsxs("div",{className:"absolute end-1 top-1/2 flex -translate-y-1/2 gap-1",children:[e.jsx(re,{color:"secondary",size:"small",onClick:()=>{m(s.content),f(!1)},children:e.jsx(i,{id:"TTo8Tw",defaultMessage:"Cancel"})}),e.jsx(re,{size:"small",onClick:()=>{if(w.trim()===""){Q.logEvent("Memory Manage Modal Memory Delete Clicked"),C(!0);return}k()},disabled:S,children:e.jsx(i,{id:"mDcKbU",defaultMessage:"Save"})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(X.Cell,{className:"pe-0",divClassName:"min-h-[40px] items-center w-full",children:e.jsx("div",{className:"border-2 border-transparent py-2 whitespace-pre-wrap",children:s.content})}),e.jsx(X.Cell,{textAlign:"right",children:e.jsxs(X.Actions,{children:[(()=>{const d=r.formatMessage({id:"EditableMemoriesModal.edit",defaultMessage:"Edit"});return e.jsx("button",{onClick:()=>f(!0),"aria-label":d,className:"text-token-text-tertiary hover:text-token-text-secondary",children:e.jsx(ze,{label:d,side:"top",className:"leading-none",children:e.jsx(yt,{className:"icon-sm"})})})})(),e.jsx("button",{onClick:()=>{Q.logEvent("Memory Manage Modal Memory Delete Clicked"),C(!0)},"aria-label":M,className:"text-token-text-tertiary hover:text-token-text-secondary",children:e.jsx(ze,{className:"leading-none",label:M,side:"top",children:e.jsx(Ie,{className:"icon-sm"})})})]})})]})}),p&&e.jsx(me,{isOpen:!0,primaryButtonColor:"danger",title:M,confirmText:r.formatMessage({id:"fCn0ar",defaultMessage:"Forget"}),onConfirm:()=>{Q.logEvent("Memory Manage Modal Memory Delete Confirmed"),G(s.id),C(!1)},onClose:()=>{C(!1),m(s.content),f(!1)},children:e.jsx(i,{id:"j2cZHW",defaultMessage:'Remove "{title}" from {name}’s saved memories. This can’t be undone. <link>Learn more</link>',values:{name:(y=t==null?void 0:t.name)!=null?y:"ChatGPT",title:e.jsx("strong",{children:Hs(s.content,{length:130,omission:"..."})}),link:d=>e.jsx("a",{href:"https://help.openai.com/en/articles/8590148-memory-faq",target:"_blank",className:"underline",rel:"noreferrer",children:d})}})})]})}function Bt({selectedGizmoId:t,onSelect:s,items:r}){const o=r.find(n=>n.id===t);function a(n){var f;return e.jsx(bt,{isFirstParty:n.id===void 0,src:(f=n.iconUrl)!=null?f:null,className:"icon"})}return e.jsx("div",{className:"border-token-border-medium mb-2 inline-flex rounded-md border",children:e.jsxs(x.Root,{children:[e.jsx(x.Trigger,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[o?e.jsxs(e.Fragment,{children:[a(o),e.jsx("span",{className:"text-token-text-primary",children:o.name})]}):e.jsx(i,{id:"MemoriesModal.unknownGizmo",defaultMessage:"Unknown GPT"}),e.jsx(vt,{className:"icon-sm text-token-text-tertiary"})]})}),e.jsx(x.Portal,{children:e.jsx(x.Content,{children:r.map(n=>e.jsxs(x.Item,{className:"flex items-center gap-3",onClick:()=>{s(n.id)},children:[a(n),n.name]},n.id))})})]})})}var ps;const Le=js.div(ps||(ps=Te(["flex h-full items-center justify-center pb-8 text-sm text-token-text-tertiary rounded-lg border border-token-border-default"])));function er({onClose:t,initialGizmoId:s,contextScopes:r,memoryEntriesFilter:o,requiredContextScopes:a}){var g,B,W;const n=oe(),f=ye(),w=Ns(),[m,v]=c.useState(s),G=je(),_=ys(),k=bs(G),S=k==null?void 0:k.hasPlusFeatures();c.useEffect(()=>{Q.logEvent("Memory Modal Shown")},[]);const{data:p,isLoading:C,isError:M,refetch:y}=Rs(m,!0,w,r,o,a),d=p==null?void 0:p.memories,{data:h,refetch:T}=vs({queryKey:["memory_gizmos"],queryFn:()=>Z.safeGet("/memories/gizmos"),refetchOnMount:"always"}),N=[{id:void 0,name:"ChatGPT",iconUrl:null},...(g=h==null?void 0:h.items.map(({gizmo:U})=>{var K;return{id:U.id,name:U.display.name,iconUrl:(K=U.display.profile_picture_url)!=null?K:null}}))!=null?g:[]],H=N.find(U=>U.id===m);c.useEffect(()=>{!C&&!M&&m!==void 0&&(!d||d.length===0)&&v(void 0)},[C,M,d,m]);let F;return C?F=e.jsx(Le,{children:e.jsx(i,{id:"MemoriesModal.loading",defaultMessage:"Loading..."})}):M?F=e.jsx(Le,{children:e.jsxs("div",{className:"max-w-sm text-center",children:[e.jsx("div",{className:"mb-4 text-red-500",children:e.jsx(i,{id:"MemoriesModal.somethingWentWrong",defaultMessage:"Something went wrong..."})}),e.jsx("div",{children:e.jsx(re,{color:"secondary",onClick:()=>{y()},children:e.jsx(i,{id:"MemoriesModal.retry",defaultMessage:"Retry"})})})]})}):!d||d.length===0?F=e.jsx(Le,{children:e.jsx("div",{className:"max-w-sm text-center",children:w?e.jsx(i,{id:"MemoriesModal.noMemories.1",defaultMessage:"As you chat with {name}, the details and preferences it saves will be shown here.",values:{name:(B=H==null?void 0:H.name)!=null?B:"ChatGPT"}}):e.jsx(i,{id:"MemoriesModal.noMemoriesAndDisabled",defaultMessage:"Memory is disabled. ChatGPT won't use or save memories."})})}):F=e.jsx(X.Root,{className:"border-token-border-default h-full",size:"compact",bordered:!0,children:e.jsx(X.Body,{children:d.map(U=>e.jsx(It,{gizmo:H?{id:H.id,name:H.name}:void 0,memory:U},U.id))})}),e.jsxs(we,{testId:"modal-memories",isOpen:!0,onClose:t,size:"custom",className:"max-w-5xl",type:"success",title:n.formatMessage({id:"MemoriesModal.title",defaultMessage:"Saved memories"}),showCloseButton:!0,children:[S&&N.length>1&&e.jsx("div",{className:"mb-4",children:e.jsx(Bt,{selectedGizmoId:m,items:N,onSelect:U=>{f.invalidateQueries({queryKey:ce(U)}),f.invalidateQueries({queryKey:ue()}),v(U)}})}),e.jsx(Lt,{memoryFullPct:p==null?void 0:p.memoryFullPct,className:"mb-5",showUpgradeCTA:!1,isPaid:S,onUpgrade:()=>{Q.logEventWithStatsig("Memories Upgrade Button Clicked","chatgpt_memories_upgrade_button_clicked_settings"),Ts(_,"chatgpt_memories_upgrade_button")}}),e.jsx("div",{className:"h-[24rem]",children:F}),e.jsx("div",{className:"mt-5 flex justify-end",children:e.jsx(zt,{onReset:()=>{y(),T(),m&&v(void 0)},gizmoId:m,memoryName:(W=H==null?void 0:H.name)!=null?W:"ChatGPT",contextScopes:r,requiredContextScopes:a,memoryEntriesFilter:o})})]})}export{er as E,Zt as G,Lt as M,zt as R,Xt as a,Et as b,Hs as t};
//# sourceMappingURL=nea9sowk1s9pzcpg.js.map
