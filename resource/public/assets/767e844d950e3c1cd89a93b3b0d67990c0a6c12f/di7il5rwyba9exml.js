var ot=Object.defineProperty,at=Object.defineProperties;var it=Object.getOwnPropertyDescriptors;var We=Object.getOwnPropertySymbols;var rt=Object.prototype.hasOwnProperty,lt=Object.prototype.propertyIsEnumerable;var He=(t,e,s)=>e in t?ot(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Oe=(t,e)=>{for(var s in e||(e={}))rt.call(e,s)&&He(t,s,e[s]);if(We)for(var s of We(e))lt.call(e,s)&&He(t,s,e[s]);return t},Ue=(t,e)=>at(t,it(e));import{r as h,k as ct,h as dt,j as u,c as Ke}from"./mw35uwhq4g8r9eam.js";import{u as Z,d as Le,iZ as ut,aL as ze,u6 as mt,M as $e,V as J,iO as pt,gb as ft,j8 as ht,ci as xt,ja as Xe,fE as gt,cd as Ge,ek as Ct,u7 as Tt,e5 as I,m$ as vt}from"./d0xa318sl7ywi0za.js";import{bY as Pe,pz as yt,pA as Je,f6 as _t,C as S,pB as bt,pC as It,m4 as St,pD as wt,pE as Et,pF as At,pG as Nt,py as Rt,pH as Dt,pI as Ft,pJ as Ot,pK as Ve,pL as Qe,pw as jt,u as Lt,g3 as ke,pM as qe,pN as Be,pO as Pt,pP as kt,pQ as Mt}from"./g2euln7v5pbm31qa.js";import{L as Wt}from"./ixsv6fw3pmowsupe.js";import{T as Ht}from"./o2byzwyeejp0u9wz.js";import{g as Ut}from"./bj1ejin6tzi0v3v8.js";import"./ce3hgmw4iyyhicud.js";import"./mstl8wgfzorpgdoe.js";import"./pcrw7exsshz05v7h.js";import"./kfdkis1zwf4ccfgg.js";import"./ol9d5wxhynx9q2is.js";import"./mbmcx8v24u1ao1ke.js";import"./cfgm997jt4en0fjd.js";import"./krza42hj097hj350.js";import"./ns51nblw8ziscsgd.js";import"./c8dilzb1umlthpuq.js";import"./deakbbf27g8e7ba0.js";import"./d4h15g77ywnnjdmi.js";import"./obs7vyhux2j83kng.js";import"./kl7c6054usfnqmd4.js";import"./k97n0y6ba9c9h39c.js";import"./je2fy8gnwj5wx4yy.js";import"./go83k4bw3m46lwwg.js";import"./eg4jdclswoidzo1l.js";import"./f76gy0b8ieo4s693.js";import"./juifnpcp74ymxcu2.js";import"./dvfkv7rxjyuaocsc.js";import"./67527rwulsulsisq.js";import"./deqlmsdlrzobu92w.js";import"./byy90pmw2kt2bmil.js";import"./mtsxj0469osb30cx.js";import"./nc9vr5q4g3rosm9u.js";import"./bwg0lbtx0n9f11bn.js";import"./bs910zydm18dg184.js";import"./cz07pchyvxgswt7r.js";import"./dpnr7xd5p38jb3gp.js";import"./fwz0otujtd6fpo4d.js";import"./dxkl0433k1u8ypnz.js";import"./ox7635ffwodpca7w.js";import"./kc32gem4l2t3hnxt.js";import"./of0vtq1gcmd3mc3z.js";import"./irqko7c1s7qpl41n.js";import"./f3alhksm9dfhscbq.js";import"./kubdgxu3crk3gqem.js";import"./kne35xckmmfq3xx6.js";import"./ojmli062couj7r3v.js";import"./lv7ytt0l14b17ows.js";import"./c340ncgh31fwqkpk.js";import"./m3aipoogd94oudzg.js";const Ye="oai/apps/canmoreSidebarWidth",zt=.25,Gt=400,Ze=400;function et(t){return t-Gt}function Te(t,e){return mt(Ze,et(t),e!=null?e:zt*t)}function Vt(){const t=Z(),e=Le(()=>Pe(t).width),s=Te(e,ut(ze.DANGER_SECRET_FOLDERS_ONLY_getItem(Ye))),r=tt(),[n,i]=h.useState(s);h.useEffect(()=>{(n<Ze||n>et(e))&&i(Te(e,n))},[e]);function o(d){i(p=>Te(e,p+=d.delta.x))}function a(d){i(d),ze.DANGER_SECRET_FOLDERS_ONLY_setItem(Ye,d)}function l(){const d=Te(e,void 0);a(d)}const c="calc(100vw - ".concat(n,"px)");return r?{chatWidth:n,canvasWidth:e-n,canvasWidthCalc:c,viewportWidth:e,handleDrag:o,handleDoubleClick:l,persist:a}:{chatWidth:0,canvasWidth:e,canvasWidthCalc:"100vw",viewportWidth:e,handleDrag:()=>{},handleDoubleClick:()=>{},persist:()=>{}}}function tt(t){const e=Z();return Le(()=>(t!=null?t:Pe(e).width)>1e3)}const je="sharedCanvas";function qt(){const[t,e]=ct(),s=t.get(je),r=dt();h.useEffect(()=>{const n=s&&yt.createRemixTempTextdoc(s,r);if(!n)return;requestAnimationFrame(()=>{Je(n)});const i=new URLSearchParams(t);i.delete(je),e(i);const o=new URL(window.location.href);o.searchParams.delete(je),history.replaceState(null,"",o)},[s,t,e,r])}const Bt="textdocId",Yt=t=>{const s=new URLSearchParams(window.location.search).get(Bt),r=$e(t,n=>{var i,o,a;return(a=(o=(i=J.findNode(n,({message:l})=>{var d;const c=(d=l.metadata)==null?void 0:d.canvas;return(c==null?void 0:c.create_source)===_t.HIVE&&(s?(c==null?void 0:c.textdoc_id)===s:!0)}))==null?void 0:i.message.metadata)==null?void 0:o.canvas)==null?void 0:a.textdoc_id});h.useEffect(()=>{r&&requestAnimationFrame(()=>{Je(r)})},[r])};function Kt(t,e){let s;return(e==null?void 0:e.type)===S.Textdoc&&(e.textdocId.startsWith(bt)||(s={type:"canvas_textdoc",id:e.textdocId})),It(t,{promptMessage:{metadata:{open_in_canvas_view:s}}})}const st=({isFullScreen:t=!1,clientThreadId:e,focusedObject:s,onClose:r,isAnimating:n=!1,width:i})=>{const{setTargetedContent:o}=St(),a=h.useRef(!1);if(h.useEffect(()=>(a.current&&o(void 0),a.current=!0,()=>{a.current=!1}),[s]),s==null)return null;switch(s.type){case S.Textdoc:return u.jsx(Ht,{isFullScreen:t,onClose:r,clientThreadId:e,focusedTextdoc:s,isAnimating:n,width:i});case S.ADAVisualization:return null}},$t=300,Xt=t=>{switch(t==null?void 0:t.type){case S.Textdoc:return t.textdocId;default:return null}};function Jt({clientThreadId:t,isDisabled:e,disabledTypes:s}){const[r,n,i,o,a]=$e(t,x=>[J.getRequestId(x),J.getConversationLastTurn(x),J.isMessageTurnEnded(x),J.getVariantIds(x).length>1,J.lastUserMessage(x)],{disablePerfDetector:!0}),l=pt(r),c=wt(),[d,p]=h.useMemo(()=>{if(n&&o)return[void 0,null];if(e===!0)return[void 0,null];if(a!=null){const C=Et(a);if(C)return[a.id,{type:S.Textdoc,textdocId:C}]}let x;return!i&&n&&(x=ft(n.messageGroups,C=>C.type!==ht)),Qt({groupedMessage:x,isRequestActive:l,latestTextdocId:c,disabledTypes:s})},[i,n,o,e,l,c,s,a]),m=p!=null,ye=Xt(p),_e=At("canvas");h.useEffect(()=>{if(p&&d&&!xt()&&(_e(),Nt(p,d),p.type===S.Textdoc)){const{textdocId:x}=p,C=Ut(x);Rt(document.getElementById(C))}},[m,ye])}function Qt({groupedMessage:t,isRequestActive:e,latestTextdocId:s,disabledTypes:r}){var n,i;if(t!=null&&t.type&&r.includes(t.type))return[void 0,null];switch(t==null?void 0:t.type){case Xe.Canmore:{const[o,a]=t.messages;if(!Dt(o))break;const l=Ft(e,o,a!=null?a:null),c=(n=l.textdocId)!=null?n:s;if(c&&(l.function===Ot.CreateTextdoc?((i=l.content)!=null?i:"").length>$t||l.status===Ve.WAITING:l.status===Ve.STREAMING))return[l.messageId,{type:S.Textdoc,textdocId:c}];break}}return[void 0,null]}const ve={type:"spring",bounce:.12},Zt={type:"spring",bounce:0},b={duration:0},es=t=>{"use forget";const e=Ke.c(112),{clientThreadId:s,focusedObject:r,onClose:n}=t,i=Z(),{chatWidth:o,canvasWidthCalc:a,handleDrag:l,handleDoubleClick:c,persist:d}=Vt();let p;e[0]!==i?(p=ke(i),e[0]=i,e[1]=p):p=e[1];const m=p,[ye,_e]=h.useState(!m),[x,C]=h.useState(!1),be=m?b:ve,Ie=m?b:Zt,T=Pt(os);let ee;e[2]!==i?(ee=()=>Pe(i),e[2]=i,e[3]=ee):ee=e[3];const{height:v,width:w}=Le(ee);let te;e[4]!==o||e[5]!==v||e[6]!==T||e[7]!==w?(te=T!=null?T:{top:0,left:o,width:w-o,height:v},e[4]=o,e[5]=v,e[6]=T,e[7]=w,e[8]=te):te=e[8];let f=te,Me=!1;if(T&&(f.top<0||f.top+f.height>v)){Me=!0;const xe=(w-o)*.75,Q=v*.75;let ge;e[9]!==xe||e[10]!==Q?(ge={width:xe,height:Q},e[9]=xe,e[10]=Q,e[11]=ge):ge=e[11];const _=ge,De=v/2-_.height/2,Fe=(w-o-_.width)/2+o;let Ce;e[12]!==_.height||e[13]!==_.width||e[14]!==De||e[15]!==Fe?(Ce={top:De,left:Fe,width:_.width,height:_.height},e[12]=_.height,e[13]=_.width,e[14]=De,e[15]=Fe,e[16]=Ce):Ce=e[16],f=Ce}const g=T==null?void 0:T.borderRadius,y=kt(),Se=(y==null?void 0:y.history)!=null||(y==null?void 0:y.showChangesAtVersion)!=null,nt=vt();let E;e[17]!==y||e[18]!==Se?(E=Se&&u.jsx(Wt,{onClick:()=>Mt(y.textdocId),zIndexKey:"chatOverlay"}),e[17]=y,e[18]=Se,e[19]=E):E=e[19];const we=nt?-260:0;let A;e[20]!==we?(A={marginInlineEnd:we},e[20]=we,e[21]=A):A=e[21];let se;e[22]===Symbol.for("react.memo_cache_sentinel")?(se={marginInlineEnd:0},e[22]=se):se=e[22];let ne,oe,ae;e[23]===Symbol.for("react.memo_cache_sentinel")?(oe={opacity:1},ae={opacity:0},ne={opacity:[1,0]},e[23]=ne,e[24]=oe,e[25]=ae):(ne=e[23],oe=e[24],ae=e[25]);let N;e[26]!==m?(N=m?b:Ue(Oe({},ve),{delay:.22}),e[26]=m,e[27]=N):N=e[27];let R;e[28]!==N?(R=u.jsx(I.div,{initial:oe,animate:ae,exit:ne,transition:N,className:"bg-token-main-surface-primary pointer-events-none absolute start-0 top-0 z-20 h-full w-full"}),e[28]=N,e[29]=R):R=e[29];let D;e[30]!==a?(D={width:a},e[30]=a,e[31]=D):D=e[31];let ie;e[32]===Symbol.for("react.memo_cache_sentinel")?(ie={width:0},e[32]=ie):ie=e[32];let F;e[33]!==m?(F=m?b:{type:"spring",bounce:0},e[33]=m,e[34]=F):F=e[34];let O;e[35]!==D||e[36]!==F?(O=u.jsx(I.div,{className:"relative z-20 h-full",style:D,exit:ie,transition:F}),e[35]=D,e[36]=F,e[37]=O):O=e[37];let j;e[38]!==Ie||e[39]!==R||e[40]!==O||e[41]!==A?(j=u.jsxs(I.div,{initial:A,animate:se,transition:Ie,children:[R,O]}),e[38]=Ie,e[39]=R,e[40]=O,e[41]=A,e[42]=j):j=e[42];const Ee=Me?0:1;let L;e[43]!==g||e[44]!==f.height||e[45]!==f.left||e[46]!==f.top||e[47]!==f.width||e[48]!==Ee?(L={borderRadius:g,opacity:Ee,x:f.left,y:f.top,height:f.height,width:f.width},e[43]=g,e[44]=f.height,e[45]=f.left,e[46]=f.top,e[47]=f.width,e[48]=Ee,e[49]=L):L=e[49];let P;e[50]!==a||e[51]!==o||e[52]!==v?(P={opacity:1,x:o,y:0,width:a,height:v,borderRadius:0},e[50]=a,e[51]=o,e[52]=v,e[53]=P):P=e[53];let k;e[54]!==m?(k=m?b:{opacity:{type:"spring",bounce:.1}},e[54]=m,e[55]=k):k=e[55];let M;e[56]!==g||e[57]!==k?(M={scale:.64,opacity:0,filter:"blur(12px)",transition:k,borderRadius:g},e[56]=g,e[57]=k,e[58]=M):M=e[58];const Ae=x||m?b:ve;let re;e[59]===Symbol.for("react.memo_cache_sentinel")?(re=()=>_e(!1),e[59]=re):re=e[59];let W;e[60]!==g?(W={borderRadius:g},e[60]=g,e[61]=W):W=e[61];let le;e[62]===Symbol.for("react.memo_cache_sentinel")?(le={borderRadius:0},e[62]=le):le=e[62];let H;e[63]!==g?(H={borderRadius:g},e[63]=g,e[64]=H):H=e[64];let ce,de;e[65]===Symbol.for("react.memo_cache_sentinel")?(ce={opacity:.5},de={opacity:.75,width:"8px",left:"-4px"},e[65]=ce,e[66]=de):(ce=e[65],de=e[66]);let U;e[67]!==m?(U=m?b:{type:"tween",duration:.1},e[67]=m,e[68]=U):U=e[68];let ue;e[69]===Symbol.for("react.memo_cache_sentinel")?(ue={x:0,y:0,transform:"translateX(0px)"},e[69]=ue):ue=e[69];let me,pe,fe;e[70]===Symbol.for("react.memo_cache_sentinel")?(me={left:0,right:0,top:0,bottom:0},pe=()=>C(!0),fe=()=>C(!1),e[70]=me,e[71]=pe,e[72]=fe):(me=e[70],pe=e[71],fe=e[72]);let z;e[73]!==l?(z=(xe,Q)=>l(Q),e[73]=l,e[74]=z):z=e[74];let G;e[75]!==o||e[76]!==d?(G=()=>{C(!1),d(o)},e[75]=o,e[76]=d,e[77]=G):G=e[77];let V;e[78]!==c?(V=()=>c(),e[78]=c,e[79]=V):V=e[79];let q;e[80]!==U||e[81]!==z||e[82]!==G||e[83]!==V?(q=u.jsx(I.div,{drag:"x",className:"bg-token-text-quaternary absolute start-[-2px] z-10 h-full w-[4px] cursor-ew-resize opacity-0",whileHover:ce,whileDrag:de,transition:U,style:ue,dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:me,onPointerDown:pe,onPointerUp:fe,onDrag:z,onDragEnd:G,onDoubleClick:V}),e[80]=U,e[81]=z,e[82]=G,e[83]=V,e[84]=q):q=e[84];let B;e[85]!==x?(B=x&&u.jsx("div",{className:"absolute inset-0 z-10"}),e[85]=x,e[86]=B):B=e[86];const Ne=!m&&ye,Re=w-o;let Y;e[87]!==s||e[88]!==r||e[89]!==n||e[90]!==Ne||e[91]!==Re?(Y=u.jsx(st,{onClose:n,clientThreadId:s,isAnimating:Ne,focusedObject:r,width:Re}),e[87]=s,e[88]=r,e[89]=n,e[90]=Ne,e[91]=Re,e[92]=Y):Y=e[92];let K;e[93]!==q||e[94]!==B||e[95]!==Y?(K=u.jsxs("div",{className:"h-full",children:[q,B,Y]}),e[93]=q,e[94]=B,e[95]=Y,e[96]=K):K=e[96];let $;e[97]!==W||e[98]!==H||e[99]!==K||e[100]!==be?($=u.jsx(I.div,{className:"dark:border-token-border-light border-token-border-medium h-full overflow-hidden border-s",initial:W,animate:le,exit:H,transition:be,children:K}),e[97]=W,e[98]=H,e[99]=K,e[100]=be,e[101]=$):$=e[101];let X;e[102]!==L||e[103]!==P||e[104]!==M||e[105]!==Ae||e[106]!==$?(X=u.jsx(I.div,{className:"bg-token-bg-primary absolute start-0 z-20 h-full overflow-hidden shadow-[0_0_18px_rgba(0,0,0,0.12)] dark:shadow-[0_0_18px_rgba(0,0,0,0.48)]",initial:L,animate:P,exit:M,transition:Ae,onAnimationComplete:re,children:$}),e[102]=L,e[103]=P,e[104]=M,e[105]=Ae,e[106]=$,e[107]=X):X=e[107];let he;return e[108]!==j||e[109]!==E||e[110]!==X?(he=u.jsxs(u.Fragment,{children:[E,j,X]}),e[108]=j,e[109]=E,e[110]=X,e[111]=he):he=e[111],he},ts=h.memo(es),ss=t=>{"use forget";const e=Ke.c(9),{clientThreadId:s,focusedObject:r,onClose:n}=t,i=Z(),o=ke(i);let a,l;e[0]===Symbol.for("react.memo_cache_sentinel")?(a={scale:.98},l={scale:1},e[0]=a,e[1]=l):(a=e[0],l=e[1]);const c=o?b:ve;let d;e[2]!==s||e[3]!==r||e[4]!==n?(d=u.jsx(st,{isFullScreen:!0,clientThreadId:s,focusedObject:r,onClose:n}),e[2]=s,e[3]=r,e[4]=n,e[5]=d):d=e[5];let p;return e[6]!==c||e[7]!==d?(p=u.jsx(Tt,{open:!0,className:"fixed inset-0 z-50 h-full w-full",children:u.jsx(I.div,{className:"z-40 h-full w-full overflow-hidden shadow-xl md:border-gray-100 md:dark:border-gray-700",initial:a,animate:l,transition:c,children:d})}),e[6]=c,e[7]=d,e[8]=p):p=e[8],p},ns=({clientThreadId:t,overrideWidth:e,isAutoFocusDisabled:s=!1})=>{const r=Z(),n=Lt(),i=tt(e),o=ke(r);Jt({clientThreadId:t,isDisabled:s,disabledTypes:o?[Xe.Canmore]:[]}),qt(),Yt(t);const a=h.useRef(!1);h.useEffect(()=>{a.current?Qe():a.current=!0},[t]);const l=n&&(i?u.jsx(ts,{clientThreadId:t,onClose:Be,focusedObject:n},"canvas-sidebar"):u.jsx(ss,{clientThreadId:t,onClose:Be,focusedObject:n},"canvas-modal"));h.useEffect(()=>{if(n)return qe(d=>Kt(d,n)),()=>qe(null)},[n]);const c=l!=null;return h.useEffect(()=>(Ge.setActiveStageSidebar(c),()=>{c&&Ge.setActiveStageSidebar(!1)}),[c]),o?l:u.jsx(Ct,{children:l},t)},tn=t=>{const e=h.useRef(null);return u.jsx(gt,{ref:e,onError:(s,r)=>{Qe(),setTimeout(()=>{var n;(n=e.current)==null||n.resetErrorBoundary()}),jt.logError("Error boundary hit",s,{componentStack:r})},name:"canmore-focused-view",children:u.jsx(ns,Oe({},t))})};function os(t){const{rect:e}=t;return e}export{tn as CanvasFocusedViewManager};
//# sourceMappingURL=di7il5rwyba9exml.js.map
