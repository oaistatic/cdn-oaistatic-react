const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/czdlmmywear3zja2.js","assets/mw35uwhq4g8r9eam.js","assets/d0xa318sl7ywi0za.js","assets/root-kavs8piy.css","assets/g2euln7v5pbm31qa.js","assets/conversation-small-lq38g8zw.css","assets/jy8ajjjwfhv86rlc.js","assets/bymjh2zr7tar40cn.js","assets/g27fx97bikhm8miq.js","assets/di7il5rwyba9exml.js","assets/ixsv6fw3pmowsupe.js","assets/ce3hgmw4iyyhicud.js","assets/mstl8wgfzorpgdoe.js","assets/pcrw7exsshz05v7h.js","assets/kfdkis1zwf4ccfgg.js","assets/ol9d5wxhynx9q2is.js","assets/mbmcx8v24u1ao1ke.js","assets/cfgm997jt4en0fjd.js","assets/krza42hj097hj350.js","assets/ns51nblw8ziscsgd.js","assets/c8dilzb1umlthpuq.js","assets/deakbbf27g8e7ba0.js","assets/d4h15g77ywnnjdmi.js","assets/obs7vyhux2j83kng.js","assets/kl7c6054usfnqmd4.js","assets/k97n0y6ba9c9h39c.js","assets/o2byzwyeejp0u9wz.js","assets/je2fy8gnwj5wx4yy.js","assets/go83k4bw3m46lwwg.js","assets/eg4jdclswoidzo1l.js","assets/f76gy0b8ieo4s693.js","assets/juifnpcp74ymxcu2.js","assets/dvfkv7rxjyuaocsc.js","assets/67527rwulsulsisq.js","assets/deqlmsdlrzobu92w.js","assets/byy90pmw2kt2bmil.js","assets/mtsxj0469osb30cx.js","assets/nc9vr5q4g3rosm9u.js","assets/bwg0lbtx0n9f11bn.js","assets/bs910zydm18dg184.js","assets/cz07pchyvxgswt7r.js","assets/dpnr7xd5p38jb3gp.js","assets/fwz0otujtd6fpo4d.js","assets/dxkl0433k1u8ypnz.js","assets/ox7635ffwodpca7w.js","assets/kc32gem4l2t3hnxt.js","assets/of0vtq1gcmd3mc3z.js","assets/irqko7c1s7qpl41n.js","assets/f3alhksm9dfhscbq.js","assets/kubdgxu3crk3gqem.js","assets/kne35xckmmfq3xx6.js","assets/ojmli062couj7r3v.js","assets/lv7ytt0l14b17ows.js","assets/c340ncgh31fwqkpk.js","assets/m3aipoogd94oudzg.js","assets/bj1ejin6tzi0v3v8.js","assets/c2283m6u0f991rnp.js","assets/ksx53yee0j91izt6.js","assets/d3gl9smdb5iqto0t.js","assets/hfid7en6iik0sftd.js","assets/m89x2zftpo6hrypr.js","assets/j723eutw6lfomm01.js","assets/gl4f6lge29au0ljx.js","assets/iio0zgk2sqlxbcjy.js","assets/obpubb7ugisfu36u.js","assets/ggvjblnzoirafiyl.js","assets/5uqv5sdajcdsdc3v.js","assets/kl0a548ohmz3fby2.js","assets/fe4yarxdk4eko5w6.js","assets/fu64xefk2hnpyz5v.js","assets/i7r4wl87p2jcc43e.js","assets/bhvk929w0gb4odci.js","assets/ed0bizt17izxg8xb.js","assets/dbnl40ahcmx1rqbw.js","assets/jc1wlz3ym1r6tf2l.js","assets/dhyn0hpw8j3dzdrv.js","assets/erh4gpcetv5nybn0.js"])))=>i.map(i=>d[i]);
var Ze=Object.freeze,es=Object.defineProperty,Zs=Object.defineProperties;var Js=Object.getOwnPropertyDescriptors;var Je=Object.getOwnPropertySymbols;var Ds=Object.prototype.hasOwnProperty,et=Object.prototype.propertyIsEnumerable;var De=(t,e,n)=>e in t?es(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,v=(t,e)=>{for(var n in e||(e={}))Ds.call(e,n)&&De(t,n,e[n]);if(Je)for(var n of Je(e))et.call(e,n)&&De(t,n,e[n]);return t},N=(t,e)=>Zs(t,Js(e));var ge=(t,e)=>Ze(es(t,"raw",{value:Ze(e||t.slice())}));import{R as hs,r as j,j as s,_ as be,d as Me,M as x,F as st,c as de,e as ue,h as D,u as tt,y as nt,a9 as ot,k as it}from"./mw35uwhq4g8r9eam.js";import{cf as le,fH as Ee,V as oe,P as me,fs as $e,ft as Be,D as Re,ai as rt,ax as at,fr as lt,u as Z,g as xs,mh as ct,mC as V,cm as We,li as vs,c as js,bc as dt,u_ as ys,oU as bs,oE as Ms,d as ye,gC as ut,rM as ws,gL as Ue,m as ce,k as He,l as mt,lF as ft,ay as pt,aw as gt,ab as ht,by as xt,be as we,cB as qe,cF as ie,o5 as vt,u$ as jt,qL as Ps,dl as ae,p as fe,tO as yt,gZ as bt,f7 as ne,h4 as Mt,e7 as wt,qP as se,qO as Ve,v0 as Le,sa as Pt,qQ as _t,qR as Tt,dh as _s,bq as Ct,fJ as St,fK as Qe,r3 as Ts,r6 as kt,r4 as Cs,c7 as It,v1 as Gt,df as ze,v2 as Nt,lT as Ss,r2 as At,rO as Se,rP as ke,n as Q,_ as ks,lS as Rt,aB as Ut,v3 as Is,v4 as Lt,al as Pe,cA as ve,gK as Gs,gQ as zt,tI as Ft,v5 as Ot,qq as Et,v6 as $t,h5 as Bt,a7 as Wt,v7 as ss,cw as Ns,ek as Ht,e5 as As,aV as qt,er as Rs,fG as Vt,fg as Us,gm as Qt,pd as je,Q as Kt,J as Ls,kv as zs,bW as Yt,v8 as Xt,cd as ts,sk as Zt,v9 as Jt,di as Dt,dz as en,gY as sn,cz as tn,H as nn,va as on,vb as rn,L as an,vc as ln,ao as cn,aL as ns,au as os,kC as dn,fC as is,vd as rs,ve as un,rm as mn,i as as,oT as fn}from"./d0xa318sl7ywi0za.js";import{a as Fs,bJ as Os,aB as Es,ew as pn,dt as gn,bu as hn,be as xn,jq as te,jo as vn,aE as jn,b$ as yn,e6 as bn,rB as Mn,jF as wn,at as Pn,rC as ls,i0 as cs,gS as $s,rD as Bs,gT as _n,gV as Tn,T as Cn,fE as Sn,rE as kn,rF as In,mb as Gn,bI as Nn,el as An,jr as Rn,hi as ds,bY as Un,ev as Ln,et as zn,ae as Fn,e4 as On,r as En,lc as $n,ld as Bn,le as Wn}from"./g2euln7v5pbm31qa.js";import{b as us,s as Hn,c as qn,g as Vn,A as he,d as Qn,M as Kn}from"./czdlmmywear3zja2.js";import{f as Ws}from"./m89x2zftpo6hrypr.js";import{M as Hs}from"./j723eutw6lfomm01.js";import{i as Fe}from"./fu64xefk2hnpyz5v.js";import{G as Yn}from"./jy8ajjjwfhv86rlc.js";import{C as Xn}from"./i7r4wl87p2jcc43e.js";import{S as Zn}from"./bhvk929w0gb4odci.js";import{h as Jn}from"./gl4f6lge29au0ljx.js";import{u as qs}from"./iio0zgk2sqlxbcjy.js";import{a as Dn,G as eo}from"./ed0bizt17izxg8xb.js";import{F as K,a as Y,b as Ie,c as so,G as to}from"./hfid7en6iik0sftd.js";import{b as no}from"./dbnl40ahcmx1rqbw.js";import{u as oo}from"./erh4gpcetv5nybn0.js";function io(t,e){const n=me(t),o=oe.getTree(n),i=[];let r=oe.getCurrentNode(n);for(;r!=null&&(e==null||r.id!==e);)i.unshift(r.message),r=r.parentId!==""?o.getNodeByIdOrMessageId(r.parentId):void 0;return i}function ro(t){return t.filter(o=>o.recipient==="gizmo_editor.update_behavior").flatMap(o=>o.content.content_type==="text"?o.content.parts:o.content.content_type==="code"?[o.content.text]:[]).map(o=>JSON.parse(o)).reduce((o,i)=>v(v({},o),i),{})}async function ao(t){let e;for(const n of t)if(n.author.name==="gizmo_editor.generate_profile_pic"){const o=at.getImageAssetPointers(n);o.length>0&&(e=o.at(-1))}if(e!=null){const n=lt(e.asset_pointer),o=await $e(n);if(o.status===Be.Success)return{id:n,permalink:o.download_url}}}async function lo(t,e,n,o){const i=io(e,o),r=ro(i);let a=await ao(i);if(Fe(r)&&a==null)return;const{name:f,context:l,description:d,profile_pic_file_id:w,prompt_starters:c}=r;if(w!=null)try{const p=await $e(w,t.id);p.status===Be.Success&&(a={id:w,permalink:p.download_url})}catch(p){Re.addError(new Error("Error while retrieving profile pic in update",{cause:p})),n.warning("Something went wrong updating your GPT's profile picture.",{duration:3})}const k={name:typeof f=="string"?f:void 0,description:typeof d=="string"?d:void 0,instructions:typeof l=="string"?l:void 0,promptStarters:Array.isArray(c)?c:void 0,profilePictureId:a==null?void 0:a.id,profilePictureUrl:a==null?void 0:a.permalink};return rt(k,p=>p!=null)}function co(t){var l,d,w;const e=new Set;for(const c of t.tools)e.add(c.type);const n=(l=t.name)!=null?l:"",o=(d=t.description)!=null?d:"",i=(w=t.instructions)!=null?w:"",r=Array.from(e).join(","),a=n===""&&o===""&&i==="",f=t.profilePictureUrl!=null;return a?"The GPT you are about to has the following abilities: ".concat(r,"."):"This is the GPT's current set of fields:\n\nname: ".concat(n,"\n\ndescription: ").concat(o,"\n\ncontext: ").concat(i,"\n\nabilities: ").concat(r,"\n\n").concat(f?"The GPT has a profile picture.":"This GPT does not have a profile picture. You must generate a profile picture when you next update your behavior.","\n")}const uo=10;function mo(t,e){var w,c,k,p,g,u,h,A,_,T,y;const n=t.current,o=e.current;if(Ee(n,o))return;const i={};n.name!==(o==null?void 0:o.name)&&(i.name=n.name),((w=n.description)!=null?w:"")!==((c=o==null?void 0:o.description)!=null?c:"")&&(i.description=(k=n.description)!=null?k:""),n.instructions!==((p=o==null?void 0:o.instructions)!=null?p:"")&&(i.context=(g=n.instructions)!=null?g:"");const r=new Set((h=(u=o==null?void 0:o.files)==null?void 0:u.map(b=>b.file_id))!=null?h:[]),a=new Set((_=(A=n.files)==null?void 0:A.map(b=>b.file_id))!=null?_:[]),f=((T=n.files)!=null?T:[]).filter(b=>!r.has(b.file_id)),l=((y=o==null?void 0:o.files)!=null?y:[]).filter(b=>!a.has(b.file_id));if(Fe(i)&&f.length===0&&l.length===0)return;const d=[];if(!Fe(i)){const b="Explicitly update the GPT's behavior to the following exact fields:\n\n    ".concat(JSON.stringify(i,null,2),'\n\n    "Do not call update_behavior yet. Instead, use these updated fields as the GPT\'s current behavior, and in the next call to update_behavior, incorporate these changes."\n    ');d.push(le(b))}if(l.length>0&&d.push(le("The user has removed the following files from the GPT. You can no longer reference these files: ".concat(l.map(b=>b.file_id).join(", ")))),f.length>0){const b=f.slice(0,uo);d.push(le("The user is adding these files to the GPT. The GPT may reference these files. The file IDs are: ".concat(b.map(R=>R.file_id).join(", ")),{attachments:b.map(R=>({id:R.file_id,name:R.name,size:R.size}))}))}return d}function fo(t){if(t.length===0)return;const e="The user is uploading files in their next message. If you need to reference these in calls to update_behavior, you will use the following File ID(s), in order: ".concat(t.map(n=>'"'.concat(n.fileId,'"')).join(", "));return[le(e)]}function po(t){const e="Remember, you should be calling either update_behavior or generate_profile_pic after most messages from the user. Your personality should be neutral and separate from the GPT you are creating.";if(!oe.findNode(me(t),o=>o.message.content.content_type==="text"&&o.message.content.parts[0]===e))return[le(e)]}function go(t,e){j.useEffect(()=>{oe.findNode(me(t),o=>ft(o.message)||o.message.author.role===pt.System&&o.message.content.content_type===gt.Text)||He(t,o=>{ht.updateTree(o,(i,r)=>{const a=i.findNode(f=>{var l;return((l=f.message.clientMetadata)==null?void 0:l.isPlaceholderTemplateAssistantWelcomeMessage)===!0},r);return a&&(a.id===r&&(r=i.rootId),i.deleteNode(a.id)),e?i.addMessageNode(r,xt(e,void 0,{isPlaceholderTemplateAssistantWelcomeMessage:!0})):r})})},[t,e])}function ho(t,e,n){var l;const o=Z(),i=xs(o,t),r=ye(()=>ut(i)),a=(l=r.models.get(ws))!=null?l:r&&Ws(r.models.values(),d=>d.tags.includes(Ue.GPT_4o));Fs(t,{kind:ce.GizmoMagicCreate,gizmo_id:e.id,behavior_overrides:n},{forcedModelId:a==null?void 0:a.id}),j.useEffect(()=>{He(t,d=>{d.mode={kind:ce.GizmoMagicCreate,gizmo_id:e.id,behavior_overrides:mt(n)}})},[o,t,e.id,n,a,r]);const[f]=j.useState(()=>{const d=e.id==null,w=e.id!=null&&e.name!==""&&e.description!=null&&e.instructions!==""&&e.profilePictureUrl!=null;return d?'Hi! I\'ll help you build a new GPT. You can say something like, "make a creative who helps generate visuals for new products" or "make a software engineer who helps format my code."\n\nWhat would you like to make?':w?"Welcome back! Is there anything ".concat(e.name," should be doing better? Anything you'd like to change?"):"You're back! Let's continue where we left off..."});go(t,f)}function xo({gizmoEditorData:t,updateGizmo:e,clientThreadId:n,gizmoEditorDataRef:o,magicMakerBehaviorOverrides:i,magicMakerConversationGizmoEditorDataRef:r,requireGizmoId:a}){const f=Z(),l=xs(f,n),d=j.useRef(a);d.current=a;const w=j.useMemo(()=>({gizmoEditorData:t,gizmoId:t.id,mode:"magic",behaviorOverrides:i,getGizmoId:d.current}),[t,i]),c=ct(p=>p.files.filter(g=>g.status===V.Ready&&g.gizmoId!=null)),k=j.useCallback(p=>{var g,u,h,A,_;if(e(T=>{var y;return N(v({},T),{files:[...(y=T.files)!=null?y:[],...We(c.map(b=>{var R;return b.fileId!=null&&{file_id:b.fileId,name:b.file.name,size:b.file.size,type:vs(b.file),last_modified:b.file.lastModified,file_size_tokens:(R=b.fileSpec)==null?void 0:R.fileTokenSize}}))]})}),r.current=js(o.current),!p.completionType||p.completionType===dt.Next){const T=oe.getCurrentNode(me(n)),y=(g=T.message.clientMetadata)!=null&&g.isPlaceholderTemplateAssistantWelcomeMessage?T.message:void 0;y&&(p.existingMessages=[y]),p.prependMessages=[...(u=fo(c))!=null?u:[],...(h=mo(o,r))!=null?h:[],...(A=po(n))!=null?A:[],...(_=p.prependMessages)!=null?_:[]]}return p},[n,c,o,r,e]);return s.jsx(ys.Provider,{value:w,children:s.jsx("div",{className:"relative flex h-full grow overflow-auto",children:s.jsx("div",{className:"grow",children:s.jsx(bs,{conversation:l,children:s.jsx(Ms,{conversation:l,children:s.jsx(Hs,{conversation:l,withCustomCompletionParams:k,hideHeader:!0})})})})})})}const vo=hs.memo(xo),jo=we(()=>be(()=>import("./czdlmmywear3zja2.js").then(t=>t.e),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(t=>t.ShareGizmoModal)),yo=we(()=>be(()=>import("./g27fx97bikhm8miq.js"),__vite__mapDeps([8,1,2,3,4,5,0,6,7])).then(t=>t.SimpleShareGizmoModal));function Oe(t){return!!(t&&typeof t=="object"&&"gizmo"in t)}function Vs(t){window.history.length>1?t(-1):t(jt())}function bo(t){"use forget";var E;const e=de.c(38),{gizmo:n,publishedGizmo:o,isUpsertLoading:i,isPromoteLoading:r,isUploadingProfilePic:a,updateGizmo:f,promoteGizmo:l,appealGizmo:d,setAppealState:w,showActionsModal:c}=t,k=Z(),p=wt();let g;if(e[0]!==n||e[1]!==r||e[2]!==a||e[3]!==i){if(g=[],(n==null||r||i)&&g.push(se.Loading),n!=null){let S;e[5]!==n?(S=Ve(n),e[5]=n,e[6]=S):S=e[6],g.push(...S)}a&&g.push(se.UploadingProfilePic),e[0]=n,e[1]=r,e[2]=a,e[3]=i,e[4]=g}else g=e[4];const u=g;let h;e[7]!==n?(h=Ps(n),e[7]=n,e[8]=h):h=e[8];const A=h;let _;e[9]!==p||e[10]!==d||e[11]!==k||e[12]!==n||e[13]!==l||e[14]!==o||e[15]!==w||e[16]!==c||e[17]!==f?(_=S=>{requestAnimationFrame(()=>Ct(k,p!=null&&p.isWorkspaceAccount()?jo:yo,{gizmo:n,publishedGizmo:o,promoteGizmo:l,appealGizmo:d,setAppealState:w,showActionsModal:c,updateGizmo:f,shareOnly:S==="share"}))},e[9]=p,e[10]=d,e[11]=k,e[12]=n,e[13]=l,e[14]=o,e[15]=w,e[16]=c,e[17]=f,e[18]=_):_=e[18];const T=_,[y,b]=j.useState(!1),R=n.sharingRecipient?us[n.sharingRecipient]:us.private,F=r||i;let P;e[19]!==R||e[20]!==u||e[21]!==n.id||e[22]!==n.sharing||e[23]!==T||e[24]!==F||e[25]!==A||e[26]!==r||e[27]!==i||e[28]!==l||e[29]!==o?(P=A?s.jsx(te,{color:"primary",onClick:()=>T("promote"),loading:u.length>0&&u.every(Mo),disabled:F||n.id===void 0||u.length>0,tooltip:u.length>0?u.map(Le).join("\n"):void 0,"data-testid":"gizmo-editor-create-gpt-button",children:s.jsx(x,{id:"svUGIb",defaultMessage:"Create"})}):s.jsxs(s.Fragment,{children:[s.jsx(te,{color:"secondary",loading:r||!o,disabled:F,icon:R,onClick:()=>T("share"),children:s.jsx(x,{id:"aXKW4G",defaultMessage:"Share"})}),s.jsx(te,{color:"primary",onClick:async()=>{var L;let S=n.sharing.subjects.map(Hn);const B=Pt(n.sharing.subjects);S=_t(n.sharing.recipient,S,(L=B==null?void 0:B.capabilities)!=null?L:Tt);const m=o&&Oe(o)?o.gizmo.display.categories[0]:void 0;await l({recipient:n.sharing.recipient,subjects:S},m)&&b(!0)},loading:i||!o,disabled:F||u.length>0,tooltip:u.length>0?u.map(Le).join("\n"):void 0,children:s.jsx(x,{id:"84QVoj",defaultMessage:"Update"})})]}),e[19]=R,e[20]=u,e[21]=n.id,e[22]=n.sharing,e[23]=T,e[24]=F,e[25]=A,e[26]=r,e[27]=i,e[28]=l,e[29]=o,e[30]=P):P=e[30];let C;e[31]!==(p==null?void 0:p.data)||e[32]!==y||e[33]!==o?(C=y&&o&&s.jsx(qn,{publishedGizmo:o,sharing:Oe(o)?o.gizmo.sharing:void 0,onClose:()=>b(!1),workspaceName:(E=p==null?void 0:p.data.name)!=null?E:""}),e[31]=p==null?void 0:p.data,e[32]=y,e[33]=o,e[34]=C):C=e[34];let I;return e[35]!==P||e[36]!==C?(I=s.jsxs(s.Fragment,{children:[P,C]}),e[35]=P,e[36]=C,e[37]=I):I=e[37],I}function Mo(t){return[se.Loading,se.UploadingProfilePic].includes(t)}function wo(t){"use forget";var R;const e=de.c(26),{gizmoEditorData:n,publishedGizmo:o,revertDraft:i}=t,r=Z(),a=D(),f=fe(),l=Me(),[d,w]=j.useState(!1),{canDelete:c}=yt(o),{canCreate:k}=bt();if(!!!(o||i||n!=null&&n.id&&n.liveVersion>0||c))return null;let g;e[0]===Symbol.for("react.memo_cache_sentinel")?(g=s.jsx(te,{color:"ghost",icon:St}),e[0]=g):g=e[0];let u;e[1]!==r||e[2]!==o||e[3]!==f?(u=o!=null&&s.jsxs(ne.Item,{onClick:F=>{pn(r,o,f,F)},children:[s.jsx(Es,{className:"icon-sm"}),s.jsx(x,v({},X.copyLink))]}),e[1]=r,e[2]=o,e[3]=f,e[4]=u):u=e[4];let h;e[5]!==a||e[6]!==i?(h=i!=null&&s.jsxs(ne.Item,{onClick:()=>{window.confirm(a.formatMessage(X.revertConfirm))&&i()},children:[s.jsx(yn,{className:"icon-sm"}),s.jsx(x,{id:"W2blnV",defaultMessage:"Revert..."})]}),e[5]=a,e[6]=i,e[7]=h):h=e[7];let A;e[8]!==k||e[9]!==n||e[10]!==l?(A=(n==null?void 0:n.id)!=null&&n.liveVersion>0&&s.jsxs(s.Fragment,{children:[s.jsxs(ne.Item,{onClick:()=>{l("/g/".concat(n.id,"/view"))},children:[s.jsx(gn,{className:"icon-sm"}),s.jsx(x,{id:"gizmo.versionHistory",defaultMessage:"Version History"})]}),k&&s.jsxs(ne.Item,{onClick:async()=>{const F=await Mt.copyGizmo({gizmoId:n.id});F.gizmo.id&&l("/gpts/editor/".concat(F.gizmo.id))},children:[s.jsx(hn,{className:"icon-sm"}),s.jsx(x,{id:"GizmoInformation.copyGizmoLabel",defaultMessage:"Duplicate GPT"})]})]}),e[8]=k,e[9]=n,e[10]=l,e[11]=A):A=e[11];let _;e[12]!==o?(_=o&&Oe(o)&&((R=o.gizmo.current_user_permission)==null?void 0:R.can_delete)&&s.jsxs(ne.Item,{color:"danger",onClick:()=>{w(!0)},children:[s.jsx(xn,{className:"icon-sm"}),s.jsx(x,{id:"tNrOLG",defaultMessage:"Delete GPT"})]}),e[12]=o,e[13]=_):_=e[13];let T;e[14]!==u||e[15]!==h||e[16]!==A||e[17]!==_?(T=s.jsxs(Qe,{side:"top",contentAlign:"end",sideOffset:8,triggerButton:g,children:[u,h,A,_]}),e[14]=u,e[15]=h,e[16]=A,e[17]=_,e[18]=T):T=e[18];let y;e[19]!==(n==null?void 0:n.id)||e[20]!==l||e[21]!==d?(y=d&&s.jsx(Yn,{gizmoId:(n==null?void 0:n.id)||"",onSuccess:()=>Vs(l),onClose:()=>{w(!1)}}),e[19]=n==null?void 0:n.id,e[20]=l,e[21]=d,e[22]=y):y=e[22];let b;return e[23]!==T||e[24]!==y?(b=s.jsxs(s.Fragment,{children:[T,y]}),e[23]=T,e[24]=y,e[25]=b):b=e[25],b}var fs;const xe=qe.div(fs||(fs=ge(["flex items-center gap-1"])));function Po(t){"use forget";const e=de.c(7),{gizmoEditorData:n}=t,o=_s(_o);switch(n.sharingRecipient){case ae.Private:{let i;return e[0]===Symbol.for("react.memo_cache_sentinel")?(i=s.jsxs(xe,{children:[s.jsx(jn,{className:"icon-xs"}),s.jsx(x,v({},X.onlyMe))]}),e[0]=i):i=e[0],i}case ae.Link:{let i;return e[1]===Symbol.for("react.memo_cache_sentinel")?(i=s.jsxs(xe,{children:[s.jsx(Es,{className:"icon-xs"}),s.jsx(x,v({},X.anyoneWithLink))]}),e[1]=i):i=e[1],i}case ae.Workspace:{let i;e[2]===Symbol.for("react.memo_cache_sentinel")?(i=s.jsx(bn,{className:"icon-xs"}),e[2]=i):i=e[2];let r;return e[3]!==o?(r=s.jsxs(xe,{children:[i,o]}),e[3]=o,e[4]=r):r=e[4],r}case ae.Marketplace:{let i;return e[5]===Symbol.for("react.memo_cache_sentinel")?(i=s.jsxs(xe,{children:[s.jsx(vn,{className:"icon-xs"}),s.jsx(x,v({},X.public))]}),e[5]=i):i=e[5],i}default:{let i;return e[6]===Symbol.for("react.memo_cache_sentinel")?(i=s.jsx("div",{}),e[6]=i):i=e[6],i}}}function _o(t){var e;return(e=t.currentWorkspace)==null?void 0:e.name}function To(t){"use forget";const e=de.c(14),{gizmoEditorData:n}=t;let o;e[0]!==n.profilePictureUrl?(o=n.profilePictureUrl!=null?s.jsx(Os,{isFirstParty:!1,src:n.profilePictureUrl,className:"h-8 w-8"}):s.jsx("div",{className:"border-token-border-medium h-8 w-8 rounded-full border-2 border-dashed"}),e[0]=n.profilePictureUrl,e[1]=o):o=e[1];let i;e[2]!==n.name?(i=n.name||s.jsx(x,v({},X.newGPT)),e[2]=n.name,e[3]=i):i=e[3];let r;e[4]!==i?(r=s.jsx("div",{className:"text-sm font-semibold",children:i}),e[4]=i,e[5]=r):r=e[5];let a;e[6]!==n?(a=s.jsx("div",{className:"text-token-text-secondary text-xs",children:Ps(n)?s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("div",{className:"bg-token-text-tertiary h-1.5 w-1.5 rounded-full"}),s.jsx(x,v({},X.draft))]}):s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("div",{className:"bg-brand-green h-1.5 w-1.5 rounded-full"}),n.sharingRecipient===ae.Marketplace?s.jsx(x,v({},X.published)):s.jsx(x,{id:"gizmoEditorHeader.live",defaultMessage:"Live"}),s.jsx(x,N(v({},X.dotSeparator),{tagName:"span"})),s.jsx(Po,{gizmoEditorData:n})]})}),e[6]=n,e[7]=a):a=e[7];let f;e[8]!==r||e[9]!==a?(f=s.jsxs("div",{children:[r,a]}),e[8]=r,e[9]=a,e[10]=f):f=e[10];let l;return e[11]!==o||e[12]!==f?(l=s.jsxs("div",{className:"flex items-center gap-2",children:[o,f]}),e[11]=o,e[12]=f,e[13]=l):l=e[13],l}var ps;const Co=qe.div(ps||(ps=ge(["\n  cursor-pointer\n  border-b\n  pb-[1px]\n  pt-[2px]\n  text-sm\n  text-token-text-secondary\n  hover:border-token-border-xheavy\n  hover:text-token-text-primary\n  mx-2\n"])));function So({gizmoEditorData:t,isUpsertLoading:e,isPromoteLoading:n,isUploadingProfilePic:o,publishedGizmo:i,updateGizmo:r,promoteGizmo:a,appealGizmo:f,setAppealState:l,revertDraft:d,draftMessage:w,className:c,hasUnpublishedChanges:k,showActionsModal:p}){var u,h;const g=Me();return s.jsxs("div",{className:ie("border-token-border-medium relative flex h-14 w-full items-center justify-between gap-2 border-b px-3",c),children:[s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx("a",{className:"text-token-text-primary cursor-pointer",onClick:()=>Vs(g),children:s.jsx(vt,{className:"icon"})}),s.jsx(To,{gizmoEditorData:t})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[i&&((h=(u=i==null?void 0:i.gizmo)==null?void 0:u.live_version)!=null?h:0)>1&&s.jsx(Co,{onClick:()=>g("/g/".concat(t.id,"/view")),children:s.jsx(x,{id:"P0Ri/k",defaultMessage:"Last edited {date}",values:{date:s.jsx(st,{value:i.gizmo.updated_at,day:"numeric",month:"short",year:new Date(i.gizmo.updated_at).getFullYear()===new Date().getFullYear()?void 0:"numeric"})}})}),w,s.jsx(wo,{gizmoEditorData:t,publishedGizmo:i,revertDraft:d}),s.jsx(bo,{gizmo:t,publishedGizmo:i,isUpsertLoading:e,isPromoteLoading:n,isUploadingProfilePic:o,updateGizmo:r,promoteGizmo:a,appealGizmo:f,setAppealState:l,hasUnpublishedChanges:k,showActionsModal:p})]})]})}const X=ue({onlyMe:{id:"gizmo.onlyMe",defaultMessage:"Only me"},anyoneWithLink:{id:"gizmo.anyoneWithLink",defaultMessage:"Anyone with a link"},public:{id:"gizmo.public",defaultMessage:"Everyone"},newGPT:{id:"gizmo.newGPT",defaultMessage:"New GPT"},draft:{id:"gizmo.draft",defaultMessage:"Draft"},published:{id:"gizmo.published",defaultMessage:"Published"},revertConfirm:{id:"gizmo.revertConfirm",defaultMessage:"Are you sure you want to revert to the last saved version?"},copyLink:{id:"gizmo.copyLink",defaultMessage:"Copy link"},dotSeparator:{id:"gizmo.dotSeparator",defaultMessage:"Â·"}}),ko=512;function Io({gizmoEditorData:t,onFileChange:e}){const n=D(),o=fe(),[i,r]=j.useState(void 0),a=j.useRef(e);j.useEffect(()=>{a.current=e});async function f(w){if(w.length>0){const c=await Gt(w[0],ko),k=ze(c);r({tempId:k,file:c,status:V.Uploading,progress:1,fileId:null,cdnUrl:null}),a.current("uploading"),Nt(k,c,n,o,Ss.ProfilePicture,{onFileCreated(p,g,u){r(h=>h!=="initial"&&(h==null?void 0:h.tempId)===p&&h.status===V.Uploading?N(v({},h),{progress:10,fileId:g,cdnUrl:u}):h)},onFileUploadProgress(p,g){r(u=>u!=="initial"&&(u==null?void 0:u.tempId)===p&&u.status===V.Uploading?N(v({},u),{progress:g}):u)},onFileUploaded(p,g,u){r(h=>h!=="initial"&&(h==null?void 0:h.tempId)===p?(a.current(h),N(v({},h),{status:V.Ready,progress:100,fileSpec:v({name:h.file.name,id:h.fileId,size:h.file.size},u!=null?u:{})})):h)},onError(p){r(g=>{if(g!=="initial"&&(g==null?void 0:g.tempId)===p){a.current(void 0);return}return g})}})}}const{open:l,getInputProps:d}=qs(v({disabled:!1,noClick:!0,onDropAccepted:f,onDropRejected:w=>Jn(w,n,o,It.ProfilePicture),multiple:!0,maxSize:Cs},Ts(kt)));return s.jsxs("div",{className:"flex w-full items-center justify-center gap-4",children:[s.jsx(Qe,{sideOffset:8,triggerButton:s.jsx("button",{className:"h-20 w-20",children:i!=null&&i!="initial"&&i.status!=V.Ready?s.jsxs("div",{className:"relative h-full w-full overflow-hidden rounded-full",children:[s.jsx(Mn,{file:i.file}),i.status===V.Uploading&&i.progress<90?s.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/5 text-white",children:s.jsx(wn,{percentage:i.progress,className:"h-6 w-6"})}):null]}):(t==null?void 0:t.profilePictureUrl)!=null&&(t==null?void 0:t.profilePictureUrl)!==""?s.jsx(Os,{isFirstParty:!1,src:t.profilePictureUrl}):s.jsx("div",{className:"border-token-border-medium flex h-full w-full items-center justify-center rounded-full border-2 border-dashed",children:s.jsx(Pn,{className:"text-4xl"})})}),children:s.jsx(ne.Item,{onClick:l,children:s.jsx(x,{id:"ERQwXg",defaultMessage:"Upload Photo"})})}),s.jsx("input",v({},d()))]})}function Go({gizmoEditorData:t,requireGizmoId:e,currentModelConfig:n,updateGizmo:o}){var F;const i=D(),r=fe(),[a,f]=j.useState(0),l=j.useRef(new Map),d=At(n,void 0),w=(t==null||t.firstPartyProjectType,void 0),c=async P=>{ks.logEvent("Upload File",{client:"web",eventSource:"mouse",intent:"gizmo"});const C=await e();P.length>0&&await Promise.all(P.map(I=>{const E=ze(I);l.current.set(E,{tempId:E,gizmoId:C,file:I,status:V.Uploading,progress:1,fileId:null,cdnUrl:null}),Rt(ze(I),I,i,r,{kind:Ss.Gizmo,gizmoId:C},{onFileUploaded:(S,B,m,G)=>{const L=l.current.get(S);L==null||L.fileId==null||(o($=>{var J,W;return N(v({},$),{files:[...(J=$.files)!=null?J:[],{file_id:L.fileId,name:L.file.name,size:L.file.size,type:(W=G==null?void 0:G.mimeType)!=null?W:vs(I),last_modified:L.file.lastModified,file_size_tokens:G==null?void 0:G.fileTokenSize}]})}),l.current.delete(S),f($=>$+1))},onFileCreated:(S,B,m)=>{l.current.set(S,N(v({tempId:S,gizmoId:C,file:I,status:V.Uploading,progress:1},l.current.get(S)),{fileId:B,cdnUrl:m})),f(G=>G+1)},onFileUploadProgress:(S,B)=>{const m=l.current.get(S);(m==null?void 0:m.status)===V.Uploading&&l.current.set(S,N(v({},m),{progress:B})),f(G=>G+1)},onError:S=>{l.current.delete(S)}},{usesRetrievalIndex:n!=null&&Se(n,I.type,I.name)===ke.Retrieval,contextScopes:w})}))},{getInputProps:k,open:p}=qs(v({disabled:!1,noClick:!0,onDropAccepted:c,multiple:!0,maxSize:Cs,maxFiles:10},Ts(d))),g=(F=t==null?void 0:t.files)!=null?F:[];function u(P){return s.jsx(cs,{onRemoveFileClick:()=>{l.current.delete(P.tempId),f(C=>C+1)},file:P.file,loadingPercentage:P.status===V.Uploading?P.progress:void 0},P.tempId)}function h(P){return s.jsx(cs,{file:P.name,fileId:P.file_id,onRemoveFileClick:()=>o(C=>{var I;return N(v({},C),{files:(I=C==null?void 0:C.files)==null?void 0:I.filter(E=>E.file_id!==P.file_id)})}),gizmoId:t==null?void 0:t.id},P.file_id)}const A=Array.from(l.current.values()).filter(P=>g.every(C=>C.file_id!==P.fileId)),[_,T]=ls(A,P=>n!=null&&Se(n,P.file.type,P.file.name)===ke.CodeInterpreter),[y,b]=ls(g,P=>n!=null&&P.type!=null&&Se(n,P.type,P.name)===ke.CodeInterpreter),R=j.useRef(y.length);return j.useEffect(()=>{y.length>R.current&&o(P=>{var C,I;return(C=P.tools)!=null&&C.some(E=>E.type===Q.PYTHON)?P:N(v({},P),{tools:[...(I=P.tools)!=null?I:[],{type:Q.PYTHON}]})}),R.current=y.length},[y.length]),s.jsxs("div",{className:"flex flex-col gap-4",children:[s.jsx("div",{className:"text-token-text-tertiary rounded-lg text-xs",children:s.jsx(x,v({},No.knowledgeWarning))}),T.length>0||b.length>0?s.jsxs("div",{className:"flex flex-wrap gap-2",children:[T.map(u),b.map(h)]}):null,_.length>0||y.length>0?s.jsxs("div",{children:[s.jsx("div",{className:"text-token-text-tertiary mb-2 text-xs",children:s.jsx(x,{id:"i/QurZ",defaultMessage:"The following files are only available for Code Interpreter:"})}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[_.map(u),y.map(h)]})]}):null,s.jsx("div",{children:s.jsxs(te,{onClick:p,children:[s.jsx("input",v({},k())),s.jsx(x,{id:"sr8Qp/",defaultMessage:"Upload files"})]})})]})}const No=ue({knowledgeWarning:{id:"gizmo.knowledgeWarning",defaultMessage:"Conversations with your GPT can potentially reveal part or all of the files uploaded."}});function Ao({placeholder:t,text:e,onChange:n,onClose:o}){return s.jsxs(Ut,{testId:"modal-gizmo-editor-form",className:"max-h-[100vh]! max-w-[80vw]!",type:"success",isOpen:!0,onClose:o,primaryButton:s.jsx(te,{onClick:o,children:s.jsx(x,{id:"FeFVdS",defaultMessage:"Close"})}),children:[s.jsx("textarea",{className:"bg-token-main-surface-primary h-[70vh] w-full resize-none rounded-lg dark:border-gray-700",value:e,onChange:i=>{n(i.target.value)},placeholder:t}),s.jsx("div",{className:"text-token-text-tertiary text-xs",children:s.jsx(x,v({},Is.instructionsWarning))})]})}var gs;const Ge=qe.div(gs||(gs=ge(["text-sm text-red-500"])));function Ro({children:t,collapsed:e,initial:n}){return s.jsx(Ht,{initial:n,children:!e&&s.jsx(As.div,{initial:"collapsed",animate:"open",exit:"collapsed",variants:{open:{opacity:1,height:"auto"},collapsed:{opacity:0,height:0}},children:t})})}function Uo({gizmo:t,onShowActionsEditor:e,isDisabled:n}){var a,f,l;const o=D(),i=fe(),r=s.jsxs("div",{className:"space-y-1",children:[(a=t==null?void 0:t.tools)==null?void 0:a.map((d,w)=>{var c;return d.type!==Q.JIT_PLUGIN?null:s.jsxs("div",{children:[s.jsx(to,{isDisabled:n,actionTool:d,onShowActionsEditor:()=>e(d.metadata.domain)}),((c=d.metadata.auth)==null?void 0:c.type)==="oauth"&&s.jsx(Xn,{label:o.formatMessage(O.callbackUrlLabel),value:"https://chat.openai.com/aip/".concat(d.metadata.action_id,"/oauth/callback"),onCopied:()=>{i.success("Copied to clipboard",{duration:3})}})]},w)}),((l=(f=t==null?void 0:t.tools)==null?void 0:f.filter(d=>d.type===Q.JIT_PLUGIN))!=null?l:[]).length>=ss?s.jsx("div",{children:o.formatMessage(O.maxActionsReached,{number:ss})}):s.jsx(te,{disabled:n,onClick:()=>{e("Unknown domain")},className:"mt-2",children:s.jsx(x,v({},O.createActionLabel))})]});return n?s.jsx(Ns,{side:"top",label:o.formatMessage(O.disabledCustomActionsTooltip),children:r}):r}function Lo(t){var e,n,o;return((n=(e=t.files)==null?void 0:e.length)!=null?n:0)>0||((o=t==null?void 0:t.tools)==null?void 0:o.some(i=>i.type===Q.JIT_PLUGIN))}function zo({gizmoEditorData:t,updateGizmo:e,currentModelConfig:n,setIsUploadingProfilePic:o,requireGizmoId:i,onShowActionsEditor:r}){var F,P,C,I,E,S,B;const a=(F=t==null?void 0:t.tools)!=null?F:[],[f,l]=j.useState(!1),[d,w]=j.useState(!0),c=(P=t==null?void 0:t.promptStarters)!=null?P:[],k=[...c,...c.length<Lt?[""]:[]],p=Ve(t),g=Z(),u=Pe(g),h=u==null?void 0:u.isWorkspaceAccount(),A=$s(ve.WorkspaceGPTCustomActions),_=D(),T=ye(()=>Gs(g,{isGizmo:!0})),y=u==null?void 0:u.hasPaidFeatures(),{data:b}=ye(()=>zt(g)),R=b!=null&&b.editor?Bs((C=t==null?void 0:t.tools)!=null?C:[])?b.editor.models_list_with_custom_actions:b.editor.models_list:[];return s.jsxs("div",{className:"flex h-full grow flex-col overflow-y-auto px-2 pt-6 text-sm",children:[s.jsxs("div",{className:"grow",children:[s.jsxs(K,{children:[s.jsx(Io,{gizmoEditorData:t,onFileChange:async m=>{if(m!=null&&m!=="uploading"&&m.fileId!=null){const G=await $e(m.fileId);G.status===Be.Success&&e({profilePictureId:m.fileId!=null?m.fileId:void 0,profilePictureUrl:G.download_url})}else e({profilePictureId:void 0,profilePictureUrl:void 0});o(m==="uploading")}}),s.jsx(Y,{label:s.jsx(x,{id:"M4dZms",defaultMessage:"Name"}),description:s.jsx(x,{id:"+Gkni2",defaultMessage:"The name of your GPT"})}),s.jsx(Ie,{type:"text",placeholder:_.formatMessage(O.gptNamePlaceholder),value:(I=t==null?void 0:t.name)!=null?I:"",onChange:m=>{e({name:m.target.value})},onBlurCapture:()=>e(m=>N(v({},m),{name:m.name.trim()})),"data-testid":"gizmo-name-input"}),p.includes(se.GizmoNameTooLong)?s.jsx(Ge,{className:"mt-1",children:s.jsx(x,N(v({},O.nameTooLong),{values:{length:Ft}}))}):null]}),s.jsxs(K,{className:"mt-4",children:[s.jsx(Y,{label:s.jsx(x,{id:"YDzNvf",defaultMessage:"Description"}),description:s.jsx(x,{id:"dpxCw8",defaultMessage:"Short description of what this GPT does"})}),s.jsx(Ie,{type:"text",placeholder:_.formatMessage(O.descriptionPlaceholder),value:(E=t==null?void 0:t.description)!=null?E:"",onChange:m=>e({description:m.target.value}),onBlurCapture:()=>e(m=>{var G,L;return N(v({},m),{description:(L=(G=m.description)==null?void 0:G.trim())!=null?L:""})}),"data-testid":"gizmo-description-input"}),p.includes(se.GizmoDescriptionTooLong)?s.jsx(Ge,{className:"mt-1",children:s.jsx(x,N(v({},O.descriptionTooLong),{values:{length:Ot}}))}):null]}),s.jsxs(K,{children:[s.jsx(Y,{label:s.jsx(x,{id:"2SO0RJ",defaultMessage:"Instructions"}),description:_.formatMessage(O.instructionsSubtitle)}),s.jsxs("div",{className:"relative",children:[s.jsx(so,{className:"resize-none",rows:8,value:t==null?void 0:t.instructions,onChange:m=>e({instructions:m.target.value}),onBlurCapture:()=>e(m=>N(v({},m),{instructions:m.instructions.trim()})),placeholder:_.formatMessage(O.instructionsSubtitle),"data-testid":"gizmo-instructions-input"}),s.jsx("button",{className:"text-token-text-tertiary absolute end-2 bottom-3",onClick:()=>l(!0),children:s.jsx(Zn,{className:"icon-sm"})})]}),s.jsx("div",{className:"text-token-text-tertiary text-xs",children:s.jsx(x,v({},Is.instructionsWarning))}),p.includes(se.GizmoInstructionsTooLong)?s.jsx(Ge,{className:"mt-1",children:s.jsx(x,N(v({},O.instructionsTooLong),{values:{length:Et}}))}):null]}),s.jsxs(K,{children:[s.jsx(Y,{label:s.jsx(x,{id:"6rfYOX",defaultMessage:"Conversation starters"}),description:s.jsx(x,{id:"OSOIpd",defaultMessage:"Examples for the user to start the conversation"})}),s.jsx("div",{className:"flex flex-col gap-1",children:k.map((m,G)=>s.jsxs("div",{className:"flex items-center",children:[s.jsx(Ie,{className:"rounded-e-none",value:m,type:"text",maxLength:$t,onChange:L=>{const $=L.target.value;e(J=>{var W;return N(v({},J),{promptStarters:We(G>=((W=c.length)!=null?W:0)?[...c!=null?c:[],$]:c.map((pe,_e)=>_e===G?$===""?void 0:$:pe))})})}}),s.jsx("button",{className:"border-token-border-medium flex h-9 w-9 items-center justify-center rounded-lg rounded-s-none border border-s-0",onClick:()=>e(L=>N(v({},L),{promptStarters:c.filter(($,J)=>J!==G)})),children:s.jsx(Bt,{className:"icon-sm"})})]},G))})]}),s.jsxs(K,{children:[s.jsx(Y,{label:s.jsx(x,{id:"bwXSkU",defaultMessage:"Knowledge"}),description:_.formatMessage(O.knowledgeExplanation)}),s.jsx(Go,{gizmoEditorData:t,requireGizmoId:i,currentModelConfig:n,updateGizmo:e})]}),y&&s.jsxs(K,{children:[s.jsx(Y,{label:s.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:4},children:[s.jsx(x,{id:"wnVs4X",defaultMessage:"Recommended Model"}),s.jsx(Dn,{description:s.jsx(x,v({},O.recommendedModelExplainer))})]})}),s.jsx("div",{style:{fontSize:"12px",color:"var(--gray-600)",marginTop:"4px",marginBottom:"8px"},children:s.jsx(x,v({},O.recommendedModelDescriberUnderTitle))}),s.jsxs("select",{className:"border-token-border-medium bg-token-main-surface-primary w-full rounded-lg border px-3 py-2 text-sm",value:(S=t.defaultModel)!=null?S:"",onChange:m=>{Wt.logEvent("gizmo_recommended_model_selected",m.target.value),e({defaultModel:m.target.value===""?null:m.target.value})},children:[s.jsx("option",{value:"",children:_.formatMessage({id:"gizmoEditor.noneOption",defaultMessage:"No Recommended Model - Users will use any model they prefer"})}),[...T.models.values()].filter(m=>R.includes(m.id)).sort((m,G)=>m.title.localeCompare(G.title)).map(m=>s.jsx("option",{value:m.id,children:m.title},m.id))]})]}),s.jsxs(K,{children:[s.jsx(Y,{label:s.jsx(x,{id:"mcAwDU",defaultMessage:"Capabilities"}),description:s.jsx(x,{id:"2exQT6",defaultMessage:"Functionality this GPT can use"})}),s.jsx(eo,{enabledTools:a,onEnabledToolsChange:m=>e({tools:m})})]}),s.jsxs(K,{children:[s.jsx(Y,{label:s.jsx(x,{id:"7r7v+u",defaultMessage:"Actions"}),description:s.jsx(x,{id:"fBln7I",defaultMessage:"APIs this GPT can use"})}),s.jsx(Uo,{isDisabled:!!(h&&!A),gizmo:t,onShowActionsEditor:r})]}),!h&&Lo(t)&&s.jsxs(K,{children:[s.jsx(Y,{label:s.jsx(x,{id:"R3KeU7",defaultMessage:"Additional Settings"}),collapsed:!!d,onClick:()=>{w(m=>!m)}}),s.jsx(Ro,{collapsed:d,initial:!1,children:s.jsx(_n,{className:"mx-3 my-1",labelClassName:"w-full cursor-pointer",label:s.jsx(x,{id:"tZgwFW",defaultMessage:"Use conversation data in your GPT to improve our models"}),id:"improve-chatgpt",checked:!t.trainingDisabled,onChange:()=>{e({trainingDisabled:!t.trainingDisabled})}})})]})]}),f&&s.jsx(Ao,{text:(B=t.instructions)!=null?B:"",onChange:m=>{e({instructions:m})},onClose:()=>l(!1),placeholder:_.formatMessage(O.instructionsSubtitle)})]})}const O=ue({recommendedModelDescriberUnderTitle:{id:"gizmo.recommendedModelDescriberUnderTitle",defaultMessage:"Recommend a model to the user, which should be used by default for best results."},recommendedModelExplainer:{id:"gizmo.recommendedModelExplainer",defaultMessage:"When the user loads a new conversation with the GPT the recommended model will be used. If the model is not available to the user, a similar model may be automatically selected."},nameTooLong:{id:"gizmo.nameTooLong",defaultMessage:"GPT names cannot be longer than {length} characters."},knowledgeExplanation:{id:"gizmo.knowledgeExplanation",defaultMessage:"Additional files for this GPT to reference."},descriptionTooLong:{id:"gizmo.descriptionTooLong",defaultMessage:"GPT descriptions cannot be longer than {length} characters."},instructionsTooLong:{id:"gizmo.instructionsTooLong",defaultMessage:"GPT instructions cannot be longer than {length} characters. If you need to provide more context, you may want to attach a file or knowledge document."},disabledCustomActionsTooltip:{id:"gizmo.disabledCustomActionsTooltip",defaultMessage:"Custom actions are disabled for your workspace. Contact your admin to enable them."},createActionLabel:{id:"gizmo.createActionLabel",defaultMessage:"Create new action"},maxActionsReached:{id:"gizmo.maxActionsReached",defaultMessage:"GPTs can have a maximum of {number} actions"},descriptionPlaceholder:{id:"gizmo.descriptionPlaceholder",defaultMessage:"Add a short description about what this GPT does"},instructionsSubtitle:{id:"gizmo.instructionsSubtitle",defaultMessage:"What does this GPT do? How does it behave? What should it avoid doing?"},gptNamePlaceholder:{id:"gizmo.gptNamePlaceholder",defaultMessage:"Name your GPT"},callbackUrlLabel:{id:"gizmo.callbackUrlLabel",defaultMessage:"Callback URL"}});function Fo(t,e){const n=Us(t);if(!Array.isArray(t.detail))return n;const o=We(t.detail.map(i=>{if(i.type==="value_error.any_str.max_length")switch(i.loc[1]){case"display":{switch(i.loc[2]){case"name":return e.formatMessage(O.nameTooLong,{length:i.ctx.limit_value});case"description":return e.formatMessage(O.descriptionTooLong,{length:i.ctx.limit_value})}break}case"instructions":return e.formatMessage(O.instructionsTooLong,{length:i.ctx.limit_value})}if(typeof i.msg=="string")return i.msg}));return o.length>0?o.join("\n"):n}function Oo({upsertDraftError:t}){const e=D(),n=Fo(t,e);return s.jsxs("div",{className:"flex items-center gap-2 text-red-500",children:[s.jsx("div",{children:s.jsx(x,v({},Qs.errorSavingDraft))}),n!=null&&s.jsx(Ns,{label:n,children:s.jsx(Vt,{className:"icon-sm"})})]})}function Eo({isPublished:t,isSavingDraft:e,hasUnpublishedChanges:n,upsertDraftError:o,className:i}){return o instanceof qt?s.jsx(Oo,{upsertDraftError:o}):n?s.jsxs("div",{className:ie("flex items-center gap-2",i),children:[s.jsx("span",{className:"text-token-text-secondary",children:t?s.jsx(x,{id:"gizmoEditor.draftUnpublished",defaultMessage:"Unpublished changes"}):s.jsx(x,{id:"gizmoEditor.draftPending",defaultMessage:"Updates pending"})}),s.jsx("div",{className:"text-token-text-tertiary w-4",children:e&&s.jsx(Rs,{})})]}):null}const Qs=ue({errorSavingDraft:{id:"gizmo.errorSavingDraft",defaultMessage:"Error saving draft"}}),$o=we(()=>be(()=>import("./di7il5rwyba9exml.js"),__vite__mapDeps([9,1,2,3,4,5,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55])).then(t=>t.CanvasFocusedViewManager));var Bo=(t=>(t.TestGizmoAction="test_gizmo_action",t))(Bo||{});const Wo=new Qt;function Ho({conversation:t,gizmoHasCustomActions:e,preferredModelId:n}){const{modelLabel:o,dropdownSections:i}=kn(t,e,n),r=s.jsxs(Gn,{children:[s.jsx(x,{id:"IhcP1l",defaultMessage:"Model"}),s.jsx("span",{className:"text-token-text-secondary text-xs font-medium",children:o}),s.jsx(Nn,{className:"icon-sm text-token-text-tertiary"})]});return s.jsx(Qe,{size:"small",alignOffset:-4,triggerButton:r,children:s.jsx(In,{sections:i})})}function qo({gizmoEditorData:t,isSavingDraft:e,showTitle:n=!0}){var A,_,T;const o=Z(),[i,r]=j.useState(()=>je(o,{urlGizmoId:t.id}));Fs(i.id,{kind:ce.GizmoTest,gizmo_id:t.id}),j.useEffect(()=>{He(i.id,y=>{y.mode={kind:ce.GizmoTest,gizmo_id:t.id}})},[i.id,t.id]);const a=(A=t.files)==null?void 0:A.map(y=>y.file_id).join();j.useEffect(()=>{Kt(i.id)!=null&&r(je(o,{urlGizmoId:t.id}))},[o,t.id,t.instructions,t.tools,a,i.id]);const f=j.useMemo(()=>({gizmoEditorData:t,mode:"test"}),[t]),l=Ls(o,"1213809372"),d=(_=Pe(o))==null?void 0:_.hasPaidFeatures(),w=l||d,[c,k]=j.useState(0),p=()=>{k(y=>y-360)},g=t.id,u=Vo(i);j.useEffect(()=>zs(Wo,{test_gizmo_action:({rootDomain:y,operationName:b})=>{g&&u(g,y,b)}}),[u,g]);const h=j.useCallback(()=>s.jsx("div",{className:"h-full w-full",children:s.jsx(Tn,{gizmo:t,hideOwner:!0,showStarterPrompts:!0})}),[t]);return s.jsx(ys.Provider,{value:f,children:s.jsx(bs,{conversation:i,children:s.jsx(Ms,{conversation:i,children:s.jsx(Cn,{clientThreadId:i.id,children:s.jsx("div",{className:ie("flex h-full w-full",e&&"cursor-wait opacity-80 transition"),children:s.jsxs("div",{className:"flex grow flex-col",children:[s.jsx("div",{className:"relative mb-2 shrink-0",children:s.jsx("div",{className:"flex justify-center py-1",children:n&&s.jsxs("div",{className:"group flex items-center gap-2 text-lg font-semibold",children:[s.jsx("div",{className:"icon"}),s.jsxs("button",{onClick:()=>{p(),r(je(o,{urlGizmoId:t.id}))},className:"flex items-center gap-2",children:[s.jsx(x,{id:"2u/6Ja",defaultMessage:"Preview"}),s.jsx(As.div,{className:"text-token-text-primary",animate:{rotate:c},transition:{duration:.3},children:s.jsx(Sn,{className:"icon invisible group-hover:visible"})})]}),w&&s.jsx(Ho,{conversation:i,gizmoHasCustomActions:!!Bs(t.tools),preferredModelId:(T=t.defaultModel)!=null?T:void 0})]})})}),s.jsxs("div",{className:ie("relative grow overflow-auto px-2",e&&"pointer-events-none"),children:[s.jsx(Hs,{conversation:i,hideHeader:!0,renderEmptyState:h()}),s.jsx(no.Sidebars,{children:s.jsx($o,{clientThreadId:i.id,overrideWidth:0,isAutoFocusDisabled:!0})})]})]})})})})})})}const ms=hs.memo(qo);function Vo(t){"use forget";const e=de.c(2);let n;return e[0]!==t?(n=(o,i,r)=>{An({conversation:t,eventSource:"url",promptMessage:Yt("Call the ".concat(i," API with the ").concat(r," operation"),{jit_plugin_data:{from_client:{type:"test",operation:r,tool_name:Xt(i)}}}),completionMetadata:{conversationMode:{kind:ce.GizmoTest,gizmo_id:o}}})},e[0]=t,e[1]=n):n=e[1],n}const Qo=we(()=>be(()=>import("./c2283m6u0f991rnp.js"),__vite__mapDeps([56,1,2,3,57,4,5,58,59,0,6,7,60,61,62,63,64,51,52,53,46,65,45,66,50,67,68,49,69,70,71,72,73,74,75,76])).then(t=>t.GizmoActionsEditor));var Ks=(t=>(t.MAGIC_MAKER="magic",t.ADVANCED="advanced",t.PREVIEW="preview",t))(Ks||{});function Ne({value:t,label:e,testId:n}){return s.jsx(zn,{value:t,className:"text-md border-token-border-default text-token-text-tertiary hover:text-token-text-primary radix-state-checked:border radix-state-checked:bg-token-main-surface-primary radix-state-checked:text-token-text-primary radix-state-checked:shadow-[0_0_2px_rgba(0,0,0,.03)] w-1/3 grow rounded-lg p-1.5 font-semibold transition md:w-1/2","data-testid":n,children:e})}function Ko({className:t,editorTab:e,setEditorTab:n}){const o=D();return s.jsxs(Ln,{className:ie("bg-token-main-surface-secondary flex w-full overflow-hidden rounded-xl p-1.5 md:w-1/2",t),value:e,onValueChange:i=>{n(i)},children:[s.jsx(Ne,{value:"magic",label:o.formatMessage(Ae.magicMakerLabel)}),s.jsx(Ne,{value:"advanced",label:o.formatMessage(Ae.configureLabel),testId:"gizmo-editor-configure-button"}),s.jsx("div",{className:"flex w-1/3 md:hidden",children:s.jsx(Ne,{value:"preview",label:o.formatMessage(Ae.previewLabel)})})]})}function Yo(t,e){return t.length!==e.length?!1:t.every(n=>e.some(o=>o.type===n.type))}function Xo(t,e){var n,o,i,r;return t.name===e.gizmo.display.name&&t.description===e.gizmo.display.description&&t.instructions===e.gizmo.instructions&&Yo(t.tools,e.tools)&&Ee((o=(n=t.files)==null?void 0:n.map(a=>a.file_id))!=null?o:[],(r=(i=e.files)==null?void 0:i.map(a=>a.file_id))!=null?r:[])&&t.profilePictureUrl==e.gizmo.display.profile_picture_url&&t.profilePictureId==e.gizmo.display.profile_pic_id}const Ys=({gizmo:t,onNewGizmoId:e})=>{var Ye;const n=tt(),o=tn(),i=$s(ve.BrowsingAvailable),r=(o==null?void 0:o.includes(ve.GizmoCanvasToggle))&&(o==null?void 0:o.includes(ve.Canvas)),a=Z(),f=Ls(a,"4148168517"),l=D(),d=fe(),w=()=>{const M=[];i&&M.push({type:Q.BROWSER}),r&&M.push({type:Q.CANVAS});const U=N(v({},rs),{tools:[...rs.tools,...M]});return f?N(v({},U),{tools:[...U.tools.filter(z=>z.type!==Q.DALLE),{type:Q.IMAGE_GEN}]}):U},c=j.useRef(t!=null?ds(t):w()),k=j.useRef(t),p=j.useRef(c.current),[g,u]=j.useState(()=>c.current),[h]=j.useState(()=>je(a)),[A]=j.useState(()=>({context_message:co(c.current),model_slug:Ue.GPT_4o,enabled_tools:[{tool_id:t!=null?"gizmo_editor":"gizmo_creator"}]}));ho(h.id,p.current,A);const _=ye(()=>Gs(a,{isGizmo:!0})),T=(Ye=_.models.get(ws))!=null?Ye:_&&Ws(_.models.values(),M=>M.tags.includes(Ue.GPT_4o)),{data:y}=nn(c.current.id),b=on(),{isPending:R,error:F}=b,P=rn(),C=j.useMemo(()=>y!=null&&!Xo(g,y),[g,y]),I=async()=>{var U;const M=c.current;try{const z=await b.mutateAsync({editorData:M,gizmoId:M.id});if(k.current=z,c.current.id==null){const H=z.gizmo.id;c.current=N(v({},c.current),{id:H,sharingTargets:z.gizmo.sharing_targets}),u(c.current),e==null||e(H)}for(const H of z.tools.filter(q=>q.type===Q.JIT_PLUGIN)){const q=c.current.tools.find(re=>re.type===Q.JIT_PLUGIN&&re.metadata.domain===H.metadata.domain);q&&q.metadata.action_id!==H.metadata.action_id&&(q.metadata=N(v({},q.metadata),{action_id:H.metadata.action_id}),u(c.current))}return z}catch(z){const H=(U=Us(z))!=null?U:l.formatMessage(Qs.errorSavingDraft);throw d.warning(H,{duration:2}),z}},E=j.useRef(void 0),S=async()=>c.current.id!=null?c.current.id:(E.current==null&&(E.current=I().then(M=>M.gizmo.id).catch(M=>{throw E.current=void 0,M})),E.current),[B]=j.useState(()=>an(()=>I(),2e3,{trailing:!0})),m=j.useCallback((M,U=!0)=>{const z=typeof M=="function"?M(c.current):ln(c.current,M);Ee(z,c.current)||(c.current=z,u(c.current),U&&B())},[B]),G=j.useRef(void 0);j.useEffect(()=>zs(cn,{completionFinished:async M=>{const U=M.serverThreadId;if(U!=null)try{const z=await lo(c.current,U,d,G.current);z!=null&&(m(z),p.current=js(c.current))}catch(z){Re.addError(z),d.warning("Something went wrong generating your GPT",{duration:3})}finally{G.current=oe.getCurrentNode(me(U)).message.id}}}),[d,m]);const[L,$]=j.useState(void 0);j.useEffect(()=>{$(Vn(t))},[t==null?void 0:t.gizmo.id]);const J=async(M,U)=>{var re,Xe;const z=Ve(c.current,M.recipient,U);if(z.length>0){d.warning("Could not save GPT:\n\n".concat(z.map(ee=>"- ".concat(Le(ee))).join("\n")),{duration:3});return}const H=await I(),q=H.gizmo.id;try{return ks.logEvent("Promote Gizmo",{gizmo_id:H.gizmo.id,sharing_recipient:M.recipient,editor_tab:W}),await P.mutateAsync({gizmoId:H.gizmo.id,data:{sharingSubjects:M.subjects,sharingRecipient:M.recipient,categories:U==null?void 0:[U]}},{onSuccess(Ce){n.setQueryData(is(n,q).queryKey,Ce),n.invalidateQueries({queryKey:["gizmos"]}),n.invalidateQueries({queryKey:["gizmo",{gizmoId:q}]}),n.invalidateQueries({queryKey:["gizmo","userActionSettings",{gizmoId:q}]})}})}catch(ee){if(ee instanceof un)$({gizmoId:q,sharingRecipient:M.recipient,moderationType:Kn.PublishBlocked,sharingTargets:(re=ee.response)==null?void 0:re.sharing_targets,showModal:he.AppealAvailable});else{Re.addError(ee);const Ce=(Xe=ee.detail)!=null?Xe:"An unknown error occurred";d.warning("Error saving GPT - "+Ce,{duration:6})}}},[W,pe]=j.useState(()=>{const M=ns.getItem(os.GizmoEditorTab);return Object.values(Ks).includes(M)?M:"magic"});j.useEffect(()=>dn(()=>{const M=Un(a).width;M!=null&&M>=768&&W==="preview"&&pe("magic")}),[a,W]);const[_e,Xs]=j.useState(!1),[Ke,Te]=j.useState(void 0);return s.jsxs("div",{className:"flex h-screen w-full flex-col items-center",children:[s.jsx(So,{gizmoEditorData:g,isUpsertLoading:b.isPending,isPromoteLoading:P.isPending,hasUnpublishedChanges:C,isUploadingProfilePic:_e,publishedGizmo:y,updateGizmo:m,promoteGizmo:async(M,U)=>{const z=await J(M,U);return c.current=N(v({},c.current),{sharingRecipient:M.recipient}),u(c.current),ns.setItem(os.GizmoEditorTab,W),z},appealGizmo:async(M,U)=>{L!=null&&$(N(v({},L),{sharingRecipient:M,categories:U==null?void 0:[U],showModal:he.AppealAvailable}))},setAppealState:$,revertDraft:y!=null&&C?()=>{const M=n.getQueryData(is(n,c.current.id).queryKey);if(M!=null){const U=ds(M);c.current=U,u(U),I()}}:void 0,draftMessage:s.jsx(Eo,{isPublished:y!=null&&(y.gizmo.share_recipient==="marketplace"||y.gizmo.share_recipient==="workspace"),hasUnpublishedChanges:C,isSavingDraft:R,upsertDraftError:F,className:"text-sm"}),showActionsModal:M=>{Te(M)},className:"shrink-0"}),L&&s.jsx(Qn,{appealState:L,onAppealClose:()=>$(N(v({},L),{showModal:he.None})),onAppealSubmitted:()=>$(N(v({},L),{showModal:he.AppealSent}))}),s.jsxs("div",{className:"relative flex w-full grow overflow-hidden",children:[s.jsx("div",{className:"flex w-full justify-center md:w-1/2",children:s.jsx("div",{className:"h-full grow overflow-hidden",children:Ke!==void 0?s.jsx(Qo,{currentlyEditingActionDomain:Ke,gizmoEditorData:g,updateGizmo:m,onClose:()=>{Te(void 0)}}):s.jsxs("div",{className:"flex h-full flex-col px-2 pt-2",children:[s.jsx("div",{className:"flex w-full flex-row justify-center",children:s.jsx(Ko,{editorTab:W,setEditorTab:pe,className:"mb-2 shrink-0 self-center"})}),s.jsx("div",{className:"grow overflow-hidden",children:W==="magic"?s.jsx("div",{className:"h-full w-full",children:s.jsx(vo,{gizmoEditorData:g,updateGizmo:m,clientThreadId:h.id,gizmoEditorDataRef:c,magicMakerBehaviorOverrides:A,magicMakerConversationGizmoEditorDataRef:p,requireGizmoId:S},h.id)}):W==="advanced"?s.jsx(zo,{gizmoEditorData:g,updateGizmo:m,currentModelConfig:T,setIsUploadingProfilePic:Xs,requireGizmoId:S,onShowActionsEditor:M=>{Te(M)}}):s.jsx(ms,{gizmoEditorData:g,isSavingDraft:R,showTitle:!1})})]})})}),s.jsx("div",{className:ie("border-token-border-medium bg-token-main-surface-secondary hidden w-1/2 justify-center border-s pt-4",W!=="preview"&&"md:flex"),children:s.jsx("div",{className:"grow",children:s.jsx(ms,{gizmoEditorData:g,isSavingDraft:R})})})]})]})};function Zo({gizmoId:t,version:e}){const{data:n}=Jt({gizmoId:t,draft:!0,version:e}),o=_s(Dt.accountUserId),i=en(),r=i==null?void 0:i.id,a=sn(n)&&n!=null&&o!=null&&r!=null;return n==null||!a?null:s.jsx(Ys,{gizmo:n})}function Jo({onNewGizmoId:t}){return s.jsx(Ys,{onNewGizmoId:t})}const Do=({gizmoId:t,remixSourceId:e,version:n})=>{const o=Me(),i=Z(),r=Pe(i),a=j.useRef(void 0);j.useEffect(()=>(ts.enterGizmoEditor(),()=>{ts.exitGizmoEditor()}),[]);let f=t;return t!=null&&a.current===t&&(f=void 0),Rn({newChatAction:l=>{Fn(i,l,{location:"Keyboard command"}),l.defaultPrevented||On(o)}}),r?f!==void 0?s.jsx(Zo,{gizmoId:f,version:n},f):s.jsx(Jo,{remixSourceId:e,onNewGizmoId:l=>{a.current=l,window.history.replaceState(window.history.state,"",Zt(l))}}):s.jsx("div",{className:"flex min-h-screen items-center justify-center",children:s.jsx(Rs,{})})},Ae=ue({magicMakerLabel:{id:"gizmo.magicMakerLabel",defaultMessage:"Create"},configureLabel:{id:"gizmo.advancedLabel",defaultMessage:"Configure"},previewLabel:{id:"gizmo.previewLabel",defaultMessage:"Preview"}}),xi=()=>(En(),null),vi=nt(function(){const e=Z(),n=Pe(e),o=!!(n!=null&&n.hasPlusFeatures());oo(n==null||o);const i=ot(),[r]=it(),a=Me(),f=i.slug,l=r.get("version"),d=f?mn(f):void 0,w=r.get("remixFrom");return j.useEffect(()=>{$n(!0).then(c=>{Bn.initializeAndGatherData(c),Wn.initializeAndGatherData(c)})},[]),j.useEffect(()=>{n!=null&&!o&&a("/")},[n,a,o]),j.useEffect(()=>{d&&as(d)&&a("/g/".concat(f,"/project"))},[d,a,f]),!o||d&&as(d)?null:s.jsx(fn,{children:s.jsx(Do,{gizmoId:d,remixSourceId:w!=null?w:void 0,version:l!=null?Number(l):void 0})})});export{Wo as G,Bo as a,xi as c,vi as g};
//# sourceMappingURL=hotk56nr0htaktpx.js.map
