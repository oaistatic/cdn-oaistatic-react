const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ii6qhpkhs6vyylw8.js","assets/mw35uwhq4g8r9eam.js","assets/d0xa318sl7ywi0za.js","assets/root-kavs8piy.css","assets/eder15khh2fy5wd2.js","assets/g2euln7v5pbm31qa.js","assets/conversation-small-lq38g8zw.css","assets/gkerdwj307fj3n4u.js","assets/h9z1eo55yfy9l6t8.js","assets/ee6pijsbu8dfevmi.js"])))=>i.map(i=>d[i]);
var Nt=Object.freeze,Tt=Object.defineProperty,Rs=Object.defineProperties;var As=Object.getOwnPropertyDescriptors;var Ve=Object.getOwnPropertySymbols;var wt=Object.prototype.hasOwnProperty,kt=Object.prototype.propertyIsEnumerable;var tt=(o,e,t)=>e in o?Tt(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,ie=(o,e)=>{for(var t in e||(e={}))wt.call(e,t)&&tt(o,t,e[t]);if(Ve)for(var t of Ve(e))kt.call(e,t)&&tt(o,t,e[t]);return o},ve=(o,e)=>Rs(o,As(e));var It=(o,e)=>{var t={};for(var s in o)wt.call(o,s)&&e.indexOf(s)<0&&(t[s]=o[s]);if(o!=null&&Ve)for(var s of Ve(o))e.indexOf(s)<0&&kt.call(o,s)&&(t[s]=o[s]);return t};var He=(o,e,t)=>tt(o,typeof e!="symbol"?e+"":e,t);var st=(o,e)=>Nt(Tt(o,"raw",{value:Nt(e||o.slice())}));import{c as A,j as n,r as N,h as te,e as ss,_ as ns,b as os,M as ce,a9 as $s,y as Ds}from"./mw35uwhq4g8r9eam.js";import{u as W,bq as ne,h7 as Et,J as Je,b9 as Ps,uO as Fs,ux as Ls,hg as Us,nL as zs,al as Ze,d as z,y2 as dt,vw as Bs,vu as Rt,bP as Ue,j1 as Os,R as Hs,uE as Gs,y3 as qs,y4 as Ws,y5 as Ks,y6 as Ys,y7 as Vs,uR as Qs,y8 as Xs,y9 as Js,ya as At,yb as Zs,uP as $t,cF as V,jh as en,mD as tn,lO as sn,f7 as re,a6 as Se,e5 as Le,mx as nn,vV as on,r6 as ut,h5 as ln,bd as an,W as rn,be as ls,gh as cn,aa as dn,aA as as,q4 as un,rW as mn,qZ as fn,_ as pn,pd as gn,T as Dt,ay as hn,pQ as is,cw as xn,fK as yn,h2 as bn,cd as jn,ek as vn,yc as nt,gi as rs,nD as Sn,eu as Cn,fj as Mn,bg as cs,L as _n,er as Nn,kn as Tn,gK as wn}from"./d0xa318sl7ywi0za.js";import{z9 as ds,za as kn,zb as In,K as he,zc as us,bc as En,zd as Pt,ai as Rn,ze as An,t_ as $n,zf as Dn,zg as Pn,zh as Fn,qN as Ln,xe as Un,ha as zn,r5 as ms,zi as fs,dE as Bn,cO as ps,bY as On,im as Hn,dw as Ft,g1 as Gn,aG as qn,dv as Lt,be as gs,ck as hs,cl as xs,fK as ys,zj as Ut,at as Wn,zk as Kn,zl as Yn,iv as Vn,iw as Qn,ag as Xn,ah as Jn,zm as zt,aB as Zn,cn as bs,ec as eo,zn as to,zo as so,cm as no,zp as oo,zq as lo,mb as Bt,bv as ao,zr as io,bb as ro,gx as co,zs as uo,ak as mo,al as Ot,zt as fo}from"./g2euln7v5pbm31qa.js";import{LightboxNew as po}from"./ii6qhpkhs6vyylw8.js";import{C as go}from"./kc32gem4l2t3hnxt.js";import{markdownToClipboardContent as ho}from"./h7tudz5piofu9rem.js";import{T as xo}from"./mtn6t8uzit6jedow.js";import{B as Ht}from"./i073mgdf5dhgfu0q.js";import yo from"./mpgnyimgf2yo26od.js";import{S as bo}from"./gqanr8vlwjugs7ou.js";import{S as jo}from"./fe4yarxdk4eko5w6.js";import{b as vo}from"./j723eutw6lfomm01.js";import{D as So}from"./gl4f6lge29au0ljx.js";import{u as Co}from"./iio0zgk2sqlxbcjy.js";import{r as Mo}from"./kcex4rnzaebpwef1.js";import{M as js}from"./i693kfbch8smq86y.js";import{ProductFlyout as _o}from"./m7z1a21pqpuh0vyi.js";import{a as No}from"./fow8bkv2d2ka2w3o.js";import{S as To}from"./dhyn0hpw8j3dzdrv.js";import"./eder15khh2fy5wd2.js";import"./of0vtq1gcmd3mc3z.js";import"./iakh052vusklquwn.js";import"./i1lnixtvuwzfguvz.js";import"./gy1lpvuoewmzh42c.js";import"./h4yh1661qhhbu5v5.js";import"./hu1bt0oauegdhua6.js";import"./kbj1b07s2z6vxqkg.js";import"./h1em0bjkpkjv8ykw.js";import"./oj9zwxa6l3kpv1x2.js";import"./ohau9tqj1fpdibg0.js";import"./iknugp00locgtve5.js";import"./cv4afpu20gjb9dll.js";import"./lep2wptoy14cfe2w.js";import"./fna9z31n721lpf9f.js";import"./kubdgxu3crk3gqem.js";import"./kne35xckmmfq3xx6.js";import"./ojmli062couj7r3v.js";import"./lv7ytt0l14b17ows.js";import"./c340ncgh31fwqkpk.js";import"./obpubb7ugisfu36u.js";import"./ggvjblnzoirafiyl.js";import"./5uqv5sdajcdsdc3v.js";import"./kl0a548ohmz3fby2.js";import"./h1bi47sw480gxt9x.js";import"./nwl9s9haealsfe5d.js";import"./la79eh1q1qxrfcxi.js";import"./ktjtg3fnpomr03qk.js";import"./fkrqr6nqq2852orb.js";import"./exovct07932vem5e.js";import"./pvi9p0c51odp9xiw.js";import"./pe4e1ebqw6qlpge9.js";import"./ejv9rjzfbwh1dn9a.js";import"./ck4rwz4bvjdsyeld.js";function vs(o){"use forget";const e=A.c(15),{accountUserId:t,size:s,allowViewingProfile:i}=o,l=W(),a=ds(t),r=kn(t);let u;e[0]!==r||e[1]!==a?(u=a!=null&&r!=null?{name:a,picture:r}:void 0,e[0]=r,e[1]=a,e[2]=u):u=e[2];const m=u;if(i){let c;e[3]!==t||e[4]!==l?(c=()=>{ne(l,In,{accountUserId:t})},e[3]=t,e[4]=l,e[5]=c):c=e[5];let g;e[6]!==s||e[7]!==m?(g=n.jsx(Et,{user:m,size:s}),e[6]=s,e[7]=m,e[8]=g):g=e[8];let y;return e[9]!==c||e[10]!==g?(y=n.jsx("button",{onClick:c,className:"relative z-10",children:g}),e[9]=c,e[10]=g,e[11]=y):y=e[11],y}let f;return e[12]!==s||e[13]!==m?(f=n.jsx(Et,{user:m,size:s}),e[12]=s,e[13]=m,e[14]=f):f=e[14],f}const wo=1024*1024,ot=5;function ht(o){var e;return(e=Je(o,"4123826335"))!=null?e:!1}function ko(o){var i;const t=(i=Ps(o,"216497991").get("max_file_size_mb",ot))!=null?i:ot;return(Number.isFinite(t)?Math.max(t,1):ot)*wo}function Io(o){var e;return(e=Je(o,"3525904070"))!=null?e:!1}const mt=new Fs("calpicoMentionPlugin");function xt(){return{queryText:"",active:!1,range:void 0}}function yt(o,e){return o.setMeta(mt,e),o}function Eo(o){o.dispatch(yt(o.state.tr,xt()))}function Ro(o,e,t,s){const i=o.state.tr;yt(i,xt()),i.insertText(e+" ",t,s),o.dispatch(i)}function Ao(o){var s,i;if(o.depth===0)return;const t=((i=(s=o.nodeBefore)==null?void 0:s.text)!=null?i:"").match(/(?:^|\s)@(\w*)$/);if(t){const l=o.pos-t[1].length-1,a=o.pos;return{range:{from:l,to:a},queryText:t[1]}}}function $o(){return new Ls({key:mt,state:{init(){return xt()},apply(o,e,t,s){var l;const i=ie(ie({},e),o.getMeta(mt));if(o.selection.from===o.selection.to&&!s.doc.eq(t.doc)){const a=Ao(o.selection.$from);i.active=!!a,a&&(i.range=a.range,i.queryText=a.queryText)}return(l=i.onMentionMatch)==null||l.call(i,i.active&&i.range?{text:i.queryText,range:i.range}:void 0),i}}})}function Do(o,e,t){"use no forget";var h,j;const s=W(),i=te(),l=he(s),a=(j=(h=Ze(s))==null?void 0:h.normalizedAccountUserId)!=null?j:null,r=z(()=>{var x,S;return(S=(x=l.rooms$().get(o))==null?void 0:x.members$())!=null?S:[]}),[u,m]=N.useState(void 0),[f,c]=N.useState(0),g=Io(s);N.useEffect(()=>{e.dispatch(yt(e.state.tr,{onMentionMatch(x){m(x)}}))},[e]);const y=i.formatMessage({id:"NiduaL",defaultMessage:"Ask anything"}),p=N.useMemo(()=>{if(!u)return[];const x=u.text.trim().toLowerCase(),S=x.length===0,_={kind:"assistant",text:"@ChatGPT",displayName:"ChatGPT",description:y},T=S||_.text.replace(/^@/,"").toLowerCase().includes(x)||_.displayName.toLowerCase().includes(x),w=[];if(T&&w.push(_),!g)return w;const k=r.filter(M=>M.accountUserId!==a).flatMap(M=>{const C=M.username.trim().toLowerCase();if(!C)return[];const E="@".concat(C),D=M.name.trim().toLowerCase();return S||E.includes(x)||D.includes(x)?[{kind:"member",text:E,displayName:M.name,description:E,accountUserId:M.accountUserId}]:[]}).sort((M,C)=>M.displayName.localeCompare(C.displayName));return w.concat(k)},[u,y,r,a,g]),b=u!=null&&p.length>0;N.useEffect(()=>{c(0)},[p]);const d=dt(()=>{var S;if(!u)return!1;const x=(S=p[f])!=null?S:p[0];return x?(Ro(e,x.text,u.range.from,u.range.to),!0):!1}),v=dt(x=>{c(S=>{const _=p.length;return _===0?0:(x(S)%_+_)%_})});return N.useEffect(()=>{if(b)return Bs(e,x=>{if(x==="up")t(),v(S=>S-1);else if(x==="down")t(),v(S=>S+1);else if(x==="cancel")Rt(e),Eo(e);else if(x==="submit"||x==="checkMatch")return d()}),()=>{e.isDestroyed||Rt(e)}},[b,e,t]),{suggestions:p,isSuggestorOpen:b,selectedIndex:f,setSelectedIndex:v,saveMention:d}}function Po(o){"use forget";const e=A.c(10),{roomId:t,editorView:s}=o,i=N.useRef("mouse");let l;e[0]===Symbol.for("react.memo_cache_sentinel")?(l=()=>{i.current="keyboard"},e[0]=l):l=e[0];const a=l,{suggestions:r,isSuggestorOpen:u,selectedIndex:m,setSelectedIndex:f,saveMention:c}=Do(t,s,a);if(!u)return null;let g;e[1]===Symbol.for("react.memo_cache_sentinel")?(g=()=>{i.current="mouse"},e[1]=g):g=e[1];let y;e[2]!==s||e[3]!==c||e[4]!==m||e[5]!==f||e[6]!==r?(y=r.map((b,d)=>n.jsx(Us,{as:"div",autoFocus:!1,className:"rounded-lg px-3 py-2",highlighted:d===m,hasManagedFocus:!0,icon:b.kind==="assistant"?n.jsx(zs,{iconName:"openai",size:"small"}):n.jsx(vs,{accountUserId:b.accountUserId,size:"small"}),onMouseOver:()=>{i.current==="mouse"&&f(()=>d)},onClick:()=>{c(),s.focus()},children:n.jsxs("span",{children:[n.jsx("span",{className:"font-medium",children:b.displayName}),n.jsxs("span",{className:"text-token-text-secondary",children:[" · ",b.description]})]})},b.kind==="member"?b.accountUserId:"assistant-"+b.text)),e[2]=s,e[3]=c,e[4]=m,e[5]=f,e[6]=r,e[7]=y):y=e[7];let p;return e[8]!==y?(p=n.jsx("div",{className:"shadow-long popover bg-token-bg-primary absolute start-0 end-0 bottom-full z-20 mb-2 max-h-56 max-w-xs overflow-y-auto rounded-2xl py-1.5",onMouseDown:Fo,onMouseMove:g,children:y}),e[8]=y,e[9]=p):p=e[9],p}function Fo(o){o.preventDefault()}class Lo{constructor(e){He(this,"roomId");He(this,"attachments$");He(this,"replyTo$");He(this,"focusComposer$");this.roomId=e,this.attachments$=Ue([]),this.replyTo$=Ue(null),this.focusComposer$=Ue(!1)}setReplyToImage(e,t){this.replyTo$.set({messageId:e,messageType:"object",previewText:t.formatMessage({id:"n6PU6i",defaultMessage:"Image"})})}setReplyToMessage(e,t){const s=us(e,200);s.length===0?this.setReplyToImage(e.id,t):this.replyTo$.set({messageId:e.id,messageType:"text",previewText:s}),this.focusComposer$.set(!0)}clearReplyTo(){this.replyTo$.set(null)}}const Ss=N.createContext({});function Cs(o){const[e]=N.useState(()=>"controller"in o?o.controller:new Lo(o.roomId));if(!e)throw new Error("CalpicoRoomControllerProvider: roomId or controller is required");return n.jsx(Ss.Provider,{value:e,children:o.children})}function qe(){return N.use(Ss)}const Uo="image/*",Qe=["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain"],Ms=[".pdf",".docx",".txt"],zo=[Uo,...Qe,...Ms].join(",");function bt(o){return o!=null&&o.startsWith("image/")}function _s(o,e){switch(o){case"application/pdf":return e.formatMessage({id:"eEaagW",defaultMessage:"PDF"});case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":return e.formatMessage({id:"0BrFKi",defaultMessage:"Document"});case"text/plain":return e.formatMessage({id:"C0VVm2",defaultMessage:"Text"});case"image/png":case"image/jpeg":case"image/gif":case"image/webp":return e.formatMessage({id:"3NDFKD",defaultMessage:"Image"});default:return e.formatMessage({id:"65WvIM",defaultMessage:"File"})}}const Bo=2e3;async function Oo({roomId:o}){return await Hs.safePost("/calpico/chatgpt/rooms/{room_id}/responding_heartbeat",{parameters:{path:{room_id:o}}})}const Ho=Os(Oo,Bo,{trailing:!1});function Go({editorValue$:o,intl:e}){const t=new Gs(null,{state:qs.create({schema:Js,plugins:[Ws(),Ks(),$o(),Ys(e.formatMessage({id:"3MYRWW",defaultMessage:"Send a message or @ChatGPT"})),Vs(),Qs(ve(ie({},$t),{"Shift-Enter":$t.Enter,"Mod-z":Zs,"Mod-y":At,"Mod-Shift-z":At})),Xs()]}),dispatchTransaction(s){const i=t.state.apply(s);t.updateState(i),o.set(i.doc.textContent)}});return t}function ft(o,e){const t=Ue({file:o,state:"pending"});return(async function(){try{const i=await e(o);t.set(ve(ie({},i),{file:o,state:"complete"}))}catch(i){t.set({file:o,state:"error"})}})(),t}function qo({file:o,className:e}){const t=te(),s=N.useMemo(()=>URL.createObjectURL(o),[o]);return n.jsx("img",{src:s,alt:t.formatMessage({id:"H7BtDz",defaultMessage:"Image preview"}),className:V("h-10 w-10 rounded-lg object-cover",e)})}const Wo=1024*1024,Ko=1,Ge=ss({addPhotosAndFiles:{defaultMessage:"Add photos & files",id:"calpico.composer.plusMenu.addPhotosAndFiles"},webSearch:{defaultMessage:"Web search",id:"calpico.composer.plusMenu.webSearch"},createImage:{defaultMessage:"Create image",id:"calpico.composer.plusMenu.createImage"}});async function pt(o,e){const t=new FormData;return t.append("file",e),{calpicoFileId:(await an.post("".concat(rn,"/calpico/chatgpt/rooms/").concat(o,"/files"),t)).id}}function Ns({roomId:o,scrollToBottom:e}){const t=W(),s=te(),i=en(t),l=he(t),a=ht(t),r=ko(t),u=z(()=>l.rooms$().get(o)),m=N.useRef(null),f=N.useRef(null),[c,g]=N.useState(null),[y]=N.useState(()=>Ue("")),[p]=N.useState(()=>Ue(null)),b=qe(),d=z(()=>b.replyTo$()),v=z(()=>y()),h=z(()=>p()),j=h!=null,x=Yo(c,m,v),S=j||x,T=z(tn)?Rn:An,w=N.useCallback(()=>{i.danger(s.formatMessage({id:"eMW6kP",defaultMessage:"Documents must be {maxSize} MB or smaller."},{maxSize:s.formatNumber(r/Wo,{maximumFractionDigits:1,minimumFractionDigits:0})}),{id:"calpico_file_upload_size_limit",toastId:"calpico_file_upload_size_limit"})},[s,r,i]),k=N.useCallback(R=>{var q,Y,de,Z;const I=(q=R.type)!=null?q:"";if(bt(I)||I.startsWith("image/"))return!0;const U=(Z=(de=(Y=R.name)==null?void 0:Y.toLowerCase)==null?void 0:de.call(Y))!=null?Z:"";return!(Qe.includes(I)||Ms.some(ee=>U.endsWith(ee)))||R.size<=r?!0:(w(),!1)},[r,w]),M=N.useCallback(R=>{b.attachments$.set(I=>[...I,{kind:"fileUpload",calpicoFileId:"",state:R}])},[b]),C=N.useCallback(R=>{if(R)for(const I of Array.from(R)){if(!k(I))continue;const U=ft(I,G=>pt(o,G));M(U)}},[M,o,k]),E=N.useCallback(R=>{C(R.target.files),R.target.value=""},[C]),D=N.useCallback(()=>{var R;(R=f.current)==null||R.click()},[]),B=N.useCallback(R=>{p.set(I=>I===R?I:R)},[p]),O=N.useCallback(R=>{p.set(I=>I===R?null:I)},[p]),L=z(()=>b.attachments$()),F=L.length>0||S?"-mb-2.5":"-my-2.5",H=z(()=>!L.some(I=>I.kind==="fileUpload"&&I.state().state!=="complete")&&(y().trim()!==""||L.length>0)),se=dt(()=>{if(c==null)return;const R=on(c.state.doc).content;if(H){const I=[];for(const U of L)switch(U.kind){case"fileUpload":{const G=U.state();G.state==="complete"&&I.push({attachment:{type:"file",file_id:G.calpicoFileId},metadata:null});break}case"link":I.push({attachment:{type:"link",url:U.attachment.url},metadata:null});break;case"post":I.push({attachment:{type:"post",post_id:U.attachment.post_id},metadata:null});break;case"sticker":I.push({attachment:{type:"sticker",sticker_id:U.stickerId},metadata:{type:"sticker",sticker_id:U.stickerId,image_url:U.imageUrl,image_metadata:null,file_id:null}});break}l.sendMessage$(o,{content:ve(ie({text:R===""?null:R},I.length>0&&{attachments:I.map(U=>U.attachment)}),{system_hints:h?[h]:[]}),reply_to:d!=null&&d.messageId?{message_id:d.messageId}:void 0,request_id:crypto.randomUUID()},I.map(U=>U.metadata)),c&&c.dispatch(c.state.tr.delete(0,c.state.doc.content.size)),b.attachments$.set([]),b.clearReplyTo(),p.set(null),e({animation:"instant"})}});N.useEffect(()=>{const R=m.current;if(!R)return;const I=Go({editorValue$:y,intl:s});g(I);const U=sn(I,{Enter:Y=>Y.shiftKey?!1:(Y.preventDefault(),se(),!0)});R.appendChild(I.dom);const G=()=>{Ho({roomId:o})},q=Y=>{var ee,ue;const Z=Array.from((ue=(ee=Y.clipboardData)==null?void 0:ee.files)!=null?ue:[]).filter(Q=>ut.includes(Q.type)||a&&Qe.includes(Q.type)?k(Q):!1);Z.length===0||Z.length>16||(Y.preventDefault(),Z.forEach(Q=>{const fe=ft(Q,le=>pt(o,le));M(fe)}))};return I.dom.addEventListener("keydown",G),I.dom.addEventListener("paste",q),I.focus(),()=>{I.dom.removeEventListener("keydown",G),I.dom.removeEventListener("paste",q),U(),I.destroy(),g(null)}},[o,u,y,s,b,k,a,M]);const K=z(()=>b.focusComposer$());N.useEffect(()=>{K&&c&&(c.focus(),b.focusComposer$.set(!1))},[K,c,b]);const X=Pt(Se.Research),J=Pt(Se.PictureV2),oe=n.jsxs(n.Fragment,{children:[n.jsx(re.Group,{separator:!1,className:"content-sheet:content-sheet-inset-section",children:n.jsx(re.Item,{icon:n.jsx(En,{className:"icon"}),label:s.formatMessage(Ge.addPhotosAndFiles),onClick:D},"add-files")}),n.jsxs(re.Group,{className:"content-sheet:content-sheet-inset-section",children:[n.jsx(re.Item,{icon:X?n.jsx(X,{className:"icon"}):void 0,label:s.formatMessage(Ge.webSearch),onClick:()=>B(Se.Search)},Se.Search),n.jsx(re.Item,{icon:J?n.jsx(J,{className:"icon"}):void 0,label:s.formatMessage(Ge.createImage),onClick:()=>B(Se.PictureV2)},Se.PictureV2)]})]}),me=S||L.length>0||d;return n.jsx(n.Fragment,{children:n.jsxs("div",{className:"relative w-full",children:[c!=null&&n.jsx(Po,{editorView:c,roomId:o}),n.jsxs(Le.div,{layout:!0,transition:T,className:V("shadow-short bg-token-bg-elevated-primary overflow-hidden",me?"rounded-3xl":"rounded-full"),children:[d!=null&&n.jsx("div",{children:n.jsx($n,{replyRegions:[{type:d.messageType,value:d.previewText,onRemoveRegion:()=>b.clearReplyTo()}]})}),L.length>0&&n.jsx("div",{className:"px-4 pt-4 pb-2",children:n.jsx(Jo,{attachments:L,onRemove:R=>b.attachments$.set(I=>I.filter(U=>U!==R)),render:R=>{switch(R.kind){case"fileUpload":return n.jsx(Qo,{fileAttachment:R,documentUploadEnabled:a});case"sticker":return null;default:return null}}})}),n.jsx("input",{ref:f,type:"file",accept:a?zo:"image/*",className:"hidden",onChange:E}),n.jsxs(Le.div,{layout:"position",transition:T,className:V("grid grid-cols-[auto_1fr_auto] gap-x-2 px-3 py-2.5",S?j?"gap-y-2 [grid-template-areas:'primary_primary_primary'_'leading_tools_trailing']":"gap-y-2 [grid-template-areas:'primary_primary_primary'_'leading_._trailing']":"items-center [grid-template-areas:'leading_primary_trailing']"),children:[n.jsx(Le.div,{layout:"position",transition:T,className:"flex items-center [grid-area:leading]",children:n.jsx(Dn,{items:oe,children:n.jsx(Pn,{onDoubleClick:D})})}),n.jsx(Le.div,{layout:"position",transition:T,className:V(F,"flex min-h-14 flex-1 items-center [grid-area:primary]"),children:n.jsx("div",{ref:m,className:V("bg-token-bg-elevated-primary min-h-12 w-full rounded-2xl px-2",Fn["prosemirror-parent"],nn()?"firefox":"default-browser")})}),n.jsx(Le.div,{layout:"position",transition:T,className:"flex items-center justify-end [grid-area:trailing]",children:n.jsx("button",{className:"composer-submit-btn composer-submit-button-color h-9 w-9",disabled:!H,onClick:()=>{se()},children:n.jsx(Ln,{className:"icon-sm"})})}),j&&n.jsx(Le.div,{layout:"position",transition:T,className:"min-w-0 [grid-area:tools]",initial:{opacity:0,y:-6},animate:{opacity:1,y:0},children:n.jsx("div",{className:"flex flex-wrap gap-2",children:h&&n.jsx(Un,{icon:h===Se.Search?X&&n.jsx(X,{className:"icon"}):J&&n.jsx(J,{className:"icon"}),label:h===Se.Search?s.formatMessage(Ge.webSearch):s.formatMessage(Ge.createImage),removable:!0,onRemove:()=>O(h)},h)})})]})]})]})})}function Yo(o,e,t){"use forget";const s=A.c(5),[i,l]=N.useState(!1),a=t!=="";let r,u;return s[0]!==e||s[1]!==o||s[2]!==a?(r=()=>{const m=e.current,f=o&&o.dom?o.dom:null;if(!m||!f)return;const c=y=>{if(!m.isConnected||!f.isConnected){l(!1);return}const p=y!=null?y:f.offsetHeight,b=Vo(m,f),d=p-b>Ko;l(v=>d?!0:a?v:!1)},g=zn({axis:"height",debounce:!0,target:f,onChange:y=>{const{height:p}=y;return c(p)}});return c(f.offsetHeight),()=>{g==null||g()}},u=[o,e,a],s[0]=e,s[1]=o,s[2]=a,s[3]=r,s[4]=u):(r=s[3],u=s[4]),N.useEffect(r,u),i}function Vo(o,e){var u,m;const t=getComputedStyle(e),s=(u=Number.parseFloat(t.paddingTop))!=null?u:0,i=(m=Number.parseFloat(t.paddingBottom))!=null?m:0,l=Number.parseFloat(t.lineHeight);if(!Number.isNaN(l))return l+s+i;const a=o.ownerDocument.createElement("span");a.textContent=" ",a.style.visibility="hidden",a.style.position="absolute",a.style.font=t.font,a.style.lineHeight=t.lineHeight,a.style.paddingTop=t.paddingTop,a.style.paddingBottom=t.paddingBottom,o.appendChild(a);const r=a.offsetHeight;return o.removeChild(a),r}function Qo(o){"use forget";const e=A.c(8),{fileAttachment:t,documentUploadEnabled:s}=o;let i;e[0]!==t?(i=()=>t.state(),e[0]=t,e[1]=i):i=e[1];const l=z(i);if(bt(l.file.type)||l.file.type.startsWith("image/")||!s){const u=l.state==="complete"?void 0:"opacity-50";let m;return e[2]!==u||e[3]!==l.file?(m=n.jsx(qo,{file:l.file,className:u}),e[2]=u,e[3]=l.file,e[4]=m):m=e[4],m}let r;return e[5]!==l.file||e[6]!==l.state?(r=n.jsx(Xo,{file:l.file,state:l.state}),e[5]=l.file,e[6]=l.state,e[7]=r):r=e[7],r}function Xo(o){"use forget";const e=A.c(19),{file:t,state:s}=o,i=te(),l=s==="complete";let a;e[0]!==t.type||e[1]!==i?(a=t.type&&t.type!==""?_s(t.type,i):i.formatMessage({id:"6+b7GT",defaultMessage:"Unknown file type"}),e[0]=t.type,e[1]=i,e[2]=a):a=e[2];const r=a,u=!l&&"opacity-50";let m;e[3]!==u?(m=V("border-token-border-light bg-token-bg-tertiary flex max-w-xs items-center gap-2 rounded-lg border px-3 py-2 text-start",u),e[3]=u,e[4]=m):m=e[4];let f;e[5]===Symbol.for("react.memo_cache_sentinel")?(f=n.jsx(ms,{className:"icon-sm"}),e[5]=f):f=e[5];let c;e[6]!==t.name||e[7]!==i?(c=t.name||i.formatMessage({id:"pMikPF",defaultMessage:"Document"}),e[6]=t.name,e[7]=i,e[8]=c):c=e[8];let g;e[9]!==c?(g=n.jsx("div",{className:"text-token-text-primary truncate text-sm font-medium",children:c}),e[9]=c,e[10]=g):g=e[10];let y;e[11]!==r?(y=n.jsx("div",{className:"text-token-text-secondary truncate text-xs",children:r}),e[11]=r,e[12]=y):y=e[12];let p;e[13]!==g||e[14]!==y?(p=n.jsxs("div",{className:"min-w-0",children:[g,y]}),e[13]=g,e[14]=y,e[15]=p):p=e[15];let b;return e[16]!==m||e[17]!==p?(b=n.jsxs("div",{className:m,children:[f,p]}),e[16]=m,e[17]=p,e[18]=b):b=e[18],b}function Jo({attachments:o,onRemove:e,render:t}){return o.length===0?null:n.jsx("div",{className:"flex gap-2",children:o.map((s,i)=>n.jsxs("div",{className:"group relative",children:[t(s),n.jsx("button",{type:"button",onClick:()=>e(s),className:"bg-token-bg-primary text-token-text-secondary border-token-border-heavy invisible absolute -end-2 -top-2 flex h-4 w-4 items-center justify-center rounded-full border group-hover:visible",children:n.jsx(ln,{className:"icon-xs"})})]},i))})}const gt=ls(()=>ns(()=>import("./ii6qhpkhs6vyylw8.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(o=>o.LightboxNew.Root));function jt(o){"use forget";var C,E,D,B,O,L,F;const e=A.c(33),{calpicoFileId:t,attachment:s,roomId:i,messageId:l}=o,a=W();let r;e[0]!==a?(r=he(a),e[0]=a,e[1]=r):r=e[1];const u=r,m=te(),f=t!=null?t:"";let c;e[2]!==f?(c=fs(f),e[2]=f,e[3]=c):c=e[3];const g=u.hasAccess&&t!=null;let y;e[4]!==c||e[5]!==g?(y=ve(ie({},c),{enabled:g}),e[4]=c,e[5]=g,e[6]=y):y=e[6];const{data:p}=os(y),b=qe();let d,v,h,j,x;if(e[7]!==s||e[8]!==t||e[9]!==p){if(v=void 0,x=0,h=0,j=(C=t!=null?t:s==null?void 0:s.post_id)!=null?C:"image",p!=null&&p.download_url){const{image_metadata:H}=p;H&&(x=(E=H.width)!=null?E:0,h=(D=H.height)!=null?D:0),v=p.download_url}else s!=null&&s.thumbnail_url&&(x=(O=(B=s.thumbnail_metadata)==null?void 0:B.width)!=null?O:0,h=(F=(L=s.thumbnail_metadata)==null?void 0:L.height)!=null?F:0,v=s.thumbnail_url);e[7]=s,e[8]=t,e[9]=p,e[10]=v,e[11]=h,e[12]=j,e[13]=x}else v=e[10],h=e[11],j=e[12],x=e[13];if(d=x&&h?x/h:null,v==null)return null;let S;e[14]!==m?(S=m.formatMessage({id:"rLelSU",defaultMessage:"Image attachment"}),e[14]=m,e[15]=S):S=e[15];const _=S;let T;e[16]!==b||e[17]!==a||e[18]!==v||e[19]!==h||e[20]!==_||e[21]!==j||e[22]!==l||e[23]!==i||e[24]!==x?(T=()=>{const H=[{id:j,archived:!1,transformationId:null,url:v,assetPointer:null,thumbnail:null,width:x,height:h,title:_}];gt.prefetch(),ne(a,gt,{images:H,initialIndex:0,children:i&&l?n.jsx(po.Footer,{children:n.jsx(Cs,{controller:b,children:n.jsx(Zo,{roomId:i,messageId:l})})}):null})},e[16]=b,e[17]=a,e[18]=v,e[19]=h,e[20]=_,e[21]=j,e[22]=l,e[23]=i,e[24]=x,e[25]=T):T=e[25];const w=T;let k;e[26]!==d?(k=d?{aspectRatio:d}:{},e[26]=d,e[27]=k):k=e[27];let M;return e[28]!==v||e[29]!==w||e[30]!==_||e[31]!==k?(M=n.jsx("img",{src:v,className:"max-h-64 min-w-0 flex-1 cursor-pointer rounded-lg object-fill",style:k,alt:_,onClick:w}),e[28]=v,e[29]=w,e[30]=_,e[31]=k,e[32]=M):M=e[32],M}function Zo(o){"use forget";const e=A.c(10),{roomId:t,messageId:s}=o,i=W(),l=qe(),a=te();let r;e[0]!==i?(r=()=>(cn(i,gt),!1),e[0]=i,e[1]=r):r=e[1];const u=r;let m,f;e[2]!==a||e[3]!==s||e[4]!==l?(m=()=>(l.setReplyToImage(s,a),()=>{l.clearReplyTo()}),f=[l,s,a],e[2]=a,e[3]=s,e[4]=l,e[5]=m,e[6]=f):(m=e[5],f=e[6]),N.useEffect(m,f);let c;return e[7]!==u||e[8]!==t?(c=n.jsx("div",{className:"px-0",children:n.jsx(Ns,{roomId:t,scrollToBottom:u})}),e[7]=u,e[8]=t,e[9]=c):c=e[9],c}function el(o){"use forget";var u;const e=A.c(14),{attachment:t}=o;let s;e[0]!==t.thumbnail_url||e[1]!==t.title?(s=t.thumbnail_url&&n.jsx("img",{className:"object-cover",src:t.thumbnail_url,alt:(u=t.title)!=null?u:void 0}),e[0]=t.thumbnail_url,e[1]=t.title,e[2]=s):s=e[2];let i;e[3]!==t.title?(i=n.jsx("div",{className:"font-medium",children:t.title}),e[3]=t.title,e[4]=i):i=e[4];let l;e[5]!==t.description?(l=n.jsx("div",{className:"text-sm",children:t.description}),e[5]=t.description,e[6]=l):l=e[6];let a;e[7]!==i||e[8]!==l?(a=n.jsxs("div",{className:"p-2",children:[i,l]}),e[7]=i,e[8]=l,e[9]=a):a=e[9];let r;return e[10]!==t.url||e[11]!==s||e[12]!==a?(r=n.jsxs("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"border-token-border-default block max-w-sm overflow-hidden rounded-2xl border",children:[s,a]}),e[10]=t.url,e[11]=s,e[12]=a,e[13]=r):r=e[13],r}function Ts(o){"use forget";const e=A.c(2),{label:t}=o;let s;return e[0]!==t?(s=n.jsx("div",{className:"text-token-text-secondary mb-1 text-xs",children:t}),e[0]=t,e[1]=s):s=e[1],s}function vt(o){"use forget";const e=A.c(15),{previewContent:t,attachment:s,onOpen:i}=o;let l;e[0]!==s.url||e[1]!==i?(l=g=>{(i==null?void 0:i(s.url))&&(g.preventDefault(),g.stopPropagation())},e[0]=s.url,e[1]=i,e[2]=l):l=e[2];let a;e[3]!==s.title?(a=n.jsx("div",{className:"font-medium",children:s.title}),e[3]=s.title,e[4]=a):a=e[4];const r=t!=null?t:"";let u;e[5]!==r?(u=n.jsx("div",{className:"text-sm",children:n.jsx(ps,{size:"small",children:r})}),e[5]=r,e[6]=u):u=e[6];let m;e[7]!==a||e[8]!==u?(m=n.jsxs("div",{className:"space-y-1",children:[a,u]}),e[7]=a,e[8]=u,e[9]=m):m=e[9];let f;e[10]===Symbol.for("react.memo_cache_sentinel")?(f=n.jsx("div",{className:"pointer-events-none absolute start-0 end-0 bottom-0 z-10 h-12 bg-gradient-to-b from-transparent from-20% to-[var(--bg-primary)] to-100%"}),e[10]=f):f=e[10];let c;return e[11]!==s.url||e[12]!==l||e[13]!==m?(c=n.jsxs("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"border-token-border-light relative block max-h-64 max-w-sm overflow-hidden rounded-2xl border p-4",onClick:l,children:[m,f]}),e[11]=s.url,e[12]=l,e[13]=m,e[14]=c):c=e[14],c}function tl(o){"use forget";const e=A.c(14),{attachment:t,roomId:s}=o;let i;e[0]!==t?(i=n.jsx(vt,{attachment:t}),e[0]=t,e[1]=i):i=e[1];let l=i;if(t.messages.length>0){const u=t.messages[t.messages.length-1];e:switch(u.content.content_type){case"text":{let m;e[2]!==t||e[3]!==u?(m=n.jsx(ws,{message:u,attachment:t}),e[2]=t,e[3]=u,e[4]=m):m=e[4],l=m;break e}case"multimodal_text":{let m;e[5]!==t||e[6]!==u||e[7]!==s?(m=n.jsx(nl,{message:u,attachment:t,roomId:s,messageId:u.id}),e[5]=t,e[6]=u,e[7]=s,e[8]=m):m=e[8],l=m;break e}}}let a;e[9]!==t.label?(a=t.label&&n.jsx(Ts,{label:t.label}),e[9]=t.label,e[10]=a):a=e[10];let r;return e[11]!==l||e[12]!==a?(r=n.jsxs("div",{children:[a,l]}),e[11]=l,e[12]=a,e[13]=r):r=e[13],r}function sl(o){"use forget";var r;const e=A.c(8),{attachment:t}=o;let s;e[0]!==t.label?(s=t.label&&n.jsx(Ts,{label:t.label}),e[0]=t.label,e[1]=s):s=e[1];const i=(r=t.preview)!=null?r:void 0;let l;e[2]!==t||e[3]!==i?(l=n.jsx(vt,{previewContent:i,attachment:t}),e[2]=t,e[3]=i,e[4]=l):l=e[4];let a;return e[5]!==s||e[6]!==l?(a=n.jsxs("div",{children:[s,l]}),e[5]=s,e[6]=l,e[7]=a):a=e[7],a}function ws(o){"use forget";const e=A.c(6),{message:t,attachment:s,onOpen:i}=o;let l;e[0]!==t?(l=dn(t,{shouldGetTextFromContentReferences:!0,shouldGetVisibleText:!0}),e[0]=t,e[1]=l):l=e[1];const a=l;let r;return e[2]!==s||e[3]!==i||e[4]!==a?(r=n.jsx(vt,{previewContent:a,attachment:s,onOpen:i}),e[2]=s,e[3]=i,e[4]=a,e[5]=r):r=e[5],r}function nl(o){"use forget";const e=A.c(7),{message:t,attachment:s,roomId:i,messageId:l}=o;if(t.content.content_type==="multimodal_text"&&t.content.parts.some(ol)&&(s.thumbnail_url||s.thumbnail_metadata)){let u;return e[0]!==s||e[1]!==l||e[2]!==i?(u=n.jsx(jt,{attachment:s,roomId:i,messageId:l},s.post_id),e[0]=s,e[1]=l,e[2]=i,e[3]=u):u=e[3],u}let r;return e[4]!==s||e[5]!==t?(r=n.jsx(ws,{message:t,attachment:s}),e[4]=s,e[5]=t,e[6]=r):r=e[6],r}function ol(o){return typeof o=="object"&&o!=null&&"content_type"in o&&o.content_type==="image_asset_pointer"}function ll(o){"use forget";var u,m;const e=A.c(6),{attachment:t}=o,s=t.video_metadata?"".concat(t.video_metadata.width," / ").concat(t.video_metadata.height):void 0,i=(u=t.video_url)!=null?u:void 0,l=(m=t.thumbnail_url)!=null?m:void 0;let a;e[0]!==s?(a=s?{aspectRatio:s}:void 0,e[0]=s,e[1]=a):a=e[1];let r;return e[2]!==i||e[3]!==l||e[4]!==a?(r=n.jsx("video",{src:i,poster:l,controls:!0,autoPlay:!0,muted:!0,playsInline:!0,className:"max-h-64 w-full rounded-lg object-contain",style:a}),e[2]=i,e[3]=l,e[4]=a,e[5]=r):r=e[5],r}function Xe(o){"use forget";const e=A.c(13),{message:t,roomId:s}=o,i=W();let l;e[0]!==i?(l=ht(i),e[0]=i,e[1]=l):l=e[1];const a=l,r=t.role==="assistant"?t.attachments:t.content.attachments;if(r==null||r.length===0)return null;let u;if(e[2]!==r||e[3]!==a||e[4]!==t.id||e[5]!==s){let f;e[7]!==a||e[8]!==t.id||e[9]!==s?(f=c=>{switch(c.type){case"file":return a?n.jsx("div",{children:n.jsx(al,{attachment:c,roomId:s,messageId:t.id})},c.file_id):n.jsx("div",{children:n.jsx(jt,{calpicoFileId:c.file_id,roomId:s,messageId:t.id})},c.file_id);case"link":return n.jsx("div",{className:"mb-2",children:n.jsx(el,{attachment:c},c.url)});case"post":return n.jsx("div",{className:"mb-2",children:n.jsx(tl,{attachment:c,roomId:s,messageId:t.id},c.post_id)});case"conversation":return n.jsx("div",{className:"mb-2",children:n.jsx(sl,{attachment:c,roomId:s,messageId:t.id},c.conversation_id)});case"media":return n.jsx("div",{className:"mb-2",children:n.jsx(ll,{attachment:c},c.post_id)});case"sticker":return null;case"sticker_pack":return null}return null},e[7]=a,e[8]=t.id,e[9]=s,e[10]=f):f=e[10],u=r.map(f),e[2]=r,e[3]=a,e[4]=t.id,e[5]=s,e[6]=u}else u=e[6];let m;return e[11]!==u?(m=n.jsx("div",{className:"mb-2 flex max-w-full items-end gap-2",children:u}),e[11]=u,e[12]=m):m=e[12],m}function al(o){"use forget";var D,B,O,L;const e=A.c(36),{attachment:t,roomId:s,messageId:i}=o,l=W();let a;e[0]!==l?(a=he(l),e[0]=l,e[1]=a):a=e[1];const r=a,u=te();let m;e[2]!==t.file_id?(m=fs(t.file_id),e[2]=t.file_id,e[3]=m):m=e[3];const f=r.hasAccess&&t.file==null;let c;e[4]!==m||e[5]!==f?(c=ve(ie({},m),{enabled:f}),e[4]=m,e[5]=f,e[6]=c):c=e[6];const{data:g,status:y}=os(c),p=(D=t.file)!=null?D:g;if(p==null&&y==="pending"){let F;e[7]!==u?(F=u.formatMessage({id:"k1r+7h",defaultMessage:"Loading…"}),e[7]=u,e[8]=F):F=e[8];let H;return e[9]!==F?(H=n.jsx("div",{className:"border-token-border-light bg-token-bg-tertiary text-token-text-secondary flex max-w-sm items-center gap-2 rounded-lg border px-3 py-2 text-sm",children:F}),e[9]=F,e[10]=H):H=e[10],H}if(!p)return null;if(bt((B=p.mime_type)!=null?B:void 0)){let F;return e[11]!==t.file_id||e[12]!==i||e[13]!==s?(F=n.jsx(jt,{calpicoFileId:t.file_id,roomId:s,messageId:i}),e[11]=t.file_id,e[12]=i,e[13]=s,e[14]=F):F=e[14],F}const d=(O=p.download_url)!=null?O:void 0;let v;e[15]!==p.name||e[16]!==u?(v=(L=p.name)!=null?L:u.formatMessage({id:"yBlMBy",defaultMessage:"Document"}),e[15]=p.name,e[16]=u,e[17]=v):v=e[17];const h=v;let j;e[18]!==p.mime_type||e[19]!==u?(j=_s(p.mime_type,u),e[18]=p.mime_type,e[19]=u,e[20]=j):j=e[20];const x=j;let S;e[21]!==d?(S=()=>{d&&window.open(d,"_blank","noopener,noreferrer")},e[21]=d,e[22]=S):S=e[22];const _=!d;let T;e[23]===Symbol.for("react.memo_cache_sentinel")?(T=n.jsx(ms,{className:"icon-md shrink-0"}),e[23]=T):T=e[23];let w;e[24]!==h?(w=n.jsx("div",{className:"text-token-text-primary line-clamp-2 font-medium",children:h}),e[24]=h,e[25]=w):w=e[25];let k;e[26]!==x?(k=n.jsx("div",{className:"text-token-text-secondary truncate text-xs",children:x}),e[26]=x,e[27]=k):k=e[27];let M;e[28]!==w||e[29]!==k?(M=n.jsxs("div",{className:"min-w-0 flex-1",children:[w,k]}),e[28]=w,e[29]=k,e[30]=M):M=e[30];let C;e[31]===Symbol.for("react.memo_cache_sentinel")?(C=n.jsx(Bn,{className:"icon-sm shrink-0"}),e[31]=C):C=e[31];let E;return e[32]!==M||e[33]!==S||e[34]!==_?(E=n.jsxs("button",{type:"button",onClick:S,className:"border-token-border-light bg-token-bg-tertiary flex w-full max-w-sm items-center gap-3 rounded-lg border px-3 py-3 text-start transition disabled:cursor-not-allowed disabled:opacity-60",disabled:_,children:[T,M,C]}),e[32]=M,e[33]=S,e[34]=_,e[35]=E):E=e[35],E}const il=300,rl=600,Gt=60;function cl(o){"use forget";const e=A.c(26),{children:t,contentHeight:s,messageId:i,stopMainScroll:l,mainScrollRef:a}=o,r=W();let u;e[0]!==r?(u=()=>On(r),e[0]=r,e[1]=u):u=e[1];const{height:m}=z(u),f=(m-52-104-44-80)*.8,c=Math.min(rl,Math.max(il,f)),[g,y]=N.useState(!1),p="collapsible-chatgpt-message-".concat(i),b=s>c+Gt,d=b?"mb-2":"";let v;e[2]!==d?(v=V("relative",d),e[2]=d,e[3]=v):v=e[3];const h=b&&!g?"overflow-y-hidden":"overflow-visible";let j;e[4]!==h?(j=V(h),e[4]=h,e[5]=j):j=e[5];const x=b?g?s+Gt:c:"auto";let S;e[6]!==x?(S={maxHeight:x},e[6]=x,e[7]=S):S=e[7];const _=b?!g:!1;let T;e[8]!==p||e[9]!==t||e[10]!==j||e[11]!==S||e[12]!==_?(T=n.jsx("div",{className:j,style:S,id:p,"aria-hidden":_,children:t}),e[8]=p,e[9]=t,e[10]=j,e[11]=S,e[12]=_,e[13]=T):T=e[13];let w;e[14]!==p||e[15]!==c||e[16]!==s||e[17]!==g||e[18]!==a||e[19]!==b||e[20]!==l?(w=b?n.jsxs(n.Fragment,{children:[g?null:n.jsx("div",{className:V("pointer-events-none absolute start-0 end-0 h-[66px]","from-token-bg-primary bg-gradient-to-t to-transparent","bottom-9")}),n.jsx("div",{children:n.jsx(as,{color:"ghost",onClick:()=>{if(y(!g),l(),g){const M=a.current;if(M==null)return;const C=s-c;M.scrollTop=M.scrollTop-C}else return},className:"-mx-3","aria-expanded":g,"aria-controls":p,children:g?n.jsx(ce,{id:"g//l+q",defaultMessage:"Show less"}):n.jsx(ce,{id:"VgASqq",defaultMessage:"Show more"})})})]}):null,e[14]=p,e[15]=c,e[16]=s,e[17]=g,e[18]=a,e[19]=b,e[20]=l,e[21]=w):w=e[21];let k;return e[22]!==w||e[23]!==v||e[24]!==T?(k=n.jsxs("div",{className:v,children:[T,w]}),e[22]=w,e[23]=v,e[24]=T,e[25]=k):k=e[25],k}function dl(o){"use forget";var b,d,v;const e=A.c(17),{message:t}=o;if(t.content.content_type!=="text")return null;const s=String(t.content.parts[0]||""),i=(b=t.metadata)==null?void 0:b.content_references;let l;e[0]!==s||e[1]!==i?(l=fn(s,i),e[0]=s,e[1]=i,e[2]=l):l=e[2];const{processedText:a,displayedContentReferences:r}=l;let u;e[3]!==((d=t.metadata)==null?void 0:d.content_references)?(u=(h,j)=>{var x,S,_;pn.logEvent("ChatGPT Table Copy Clicked"),qn(ho((x=h.markdownSource)!=null?x:"",(_=(S=t.metadata)==null?void 0:S.content_references)!=null?_:[]),void 0,j)},e[3]=(v=t.metadata)==null?void 0:v.content_references,e[4]=u):u=e[4];const m=u;let f;e[5]===Symbol.for("react.memo_cache_sentinel")?(f={turnIndex:0},e[5]=f):f=e[5];let c;e[6]!==r||e[7]!==t?(c={message:t,contentReferences:r,isActivelyStreaming:!1,onShowSearchResults:ul,useSafeUrls:!0,analyticsMetadata:f},e[6]=r,e[7]=t,e[8]=c):c=e[8];let g;e[9]!==m?(g={table:h=>{const S=h,{node:j}=S,x=It(S,["node"]);return n.jsx("div",{className:"w-full max-w-full overflow-x-auto",style:{scrollbarWidth:"none"},children:n.jsx(xo,ve(ie({},x),{unstyledContainer:!0,onClickCopy:_=>m(j,_)}))})}},e[9]=m,e[10]=g):g=e[10];let y;e[11]!==a||e[12]!==g?(y=n.jsx(ps,{className:"[&>p:last-child]:mb-0!",componentOverrides:g,children:a}),e[11]=a,e[12]=g,e[13]=y):y=e[13];let p;return e[14]!==c||e[15]!==y?(p=n.jsx(Gn.Provider,{value:c,children:y}),e[14]=c,e[15]=y,e[16]=p):p=e[16],p}function ul(){}function ml(o,e){var l;const t=un.createRootNode("calpico-root-".concat(o)),s={[t.id]:{id:t.id,parent:t.parentId,children:[],message:t.message}};let i=t.id;for(const a of e)s[a.id]={id:a.id,parent:i,children:[],message:a},(l=s[i])==null||l.children.push(a.id),i=a.id;return{conversation_id:o,mapping:s,current_node:i,moderation_results:[],title:null}}function ks(o){"use forget";const e=A.c(44),{message:t,roomId:s}=o,i=W();let l;e[0]!==i?(l=()=>gn(i),e[0]=i,e[1]=l):l=e[1];const[a]=N.useState(l),r=t.rawMessages,[u,m]=N.useState(xl),f=r.every(k=>u.has(k.id));let c;e[2]!==r||e[3]!==a.id?(c=ml(a.id,r),e[2]=r,e[3]=a.id,e[4]=c):c=e[4];const g=c;let y,p;e[5]!==r||e[6]!==a.id||e[7]!==g?(y=()=>{Dt.updateThreadFromServer(a.id,g,{skipIfExisting:!1}),m(new Set(r.map(hl)))},p=[r,a.id,g],e[5]=r,e[6]=a.id,e[7]=g,e[8]=y,e[9]=p):(y=e[8],p=e[9]),N.useEffect(y,p);let b,d;e[10]!==a.id?(b=()=>()=>{Dt.deleteThread(a.id)},d=[a.id],e[10]=a.id,e[11]=b,e[12]=d):(b=e[11],d=e[12]),N.useEffect(b,d);let v;e[13]!==r?(v=r.reduce(gl,[]),e[13]=r,e[14]=v):v=e[14];const h=v;if(!f||h.length===0){const k=a.id;let M;e[15]!==r?(M=r.map(pl),e[15]=r,e[16]=M):M=e[16];let C;e[17]!==t||e[18]!==s?(C=t.attachments&&n.jsx(Xe,{roomId:s,message:t}),e[17]=t,e[18]=s,e[19]=C):C=e[19];let E;e[20]!==a.id?(E=n.jsx(Ft,{clientThreadId:a.id}),e[20]=a.id,e[21]=E):E=e[21];let D;return e[22]!==a.id||e[23]!==C||e[24]!==E||e[25]!==M?(D=n.jsxs(Lt,{clientThreadId:k,children:[M,C,E]}),e[22]=a.id,e[23]=C,e[24]=E,e[25]=M,e[26]=D):D=e[26],D}const j=h.length-1,x=a.id;let S;if(e[27]!==a||e[28]!==h||e[29]!==j){let k;e[31]!==a||e[32]!==j?(k=(M,C)=>{const E=C===j,D=M.role===hn.Assistant&&E;return n.jsx(go,{groupedMessagesToRender:M.messageGroups,allMessages:M.messages,allGroupedMessages:M.messageGroups,conversation:a,isUserTurn:!1,isCompletionRequestInProgress:!1,isFeedbackEnabled:!1,isFinalTurn:E,isFinalUserTurn:!1,isFinalAssistantTurn:D,hasActiveRequest:!1,onRequestCompletion:fl,turnIndex:C},M.id)},e[31]=a,e[32]=j,e[33]=k):k=e[33],S=h.map(k),e[27]=a,e[28]=h,e[29]=j,e[30]=S}else S=e[30];let _;e[34]!==t||e[35]!==s?(_=t.attachments&&n.jsx(Xe,{roomId:s,message:t}),e[34]=t,e[35]=s,e[36]=_):_=e[36];let T;e[37]!==a.id?(T=n.jsx(Ft,{clientThreadId:a.id}),e[37]=a.id,e[38]=T):T=e[38];let w;return e[39]!==a.id||e[40]!==_||e[41]!==T||e[42]!==S?(w=n.jsxs(Lt,{clientThreadId:x,children:[S,_,T]}),e[39]=a.id,e[40]=_,e[41]=T,e[42]=S,e[43]=w):w=e[43],w}function fl(){}function pl(o){return n.jsx("div",{className:"mb-3 last:mb-0",children:n.jsx(dl,{message:o})},o.id)}function gl(o,e){return mn(o,e)}function hl(o){return o.id}function xl(){return new Set}function yl(o){"use forget";const e=A.c(8),{message:t,roomId:s,stopMainScroll:i,mainScrollRef:l}=o,a=W();if(Je(a,"3552088870")){let u;return e[0]!==l||e[1]!==t||e[2]!==s||e[3]!==i?(u=n.jsx(bl,{message:t,roomId:s,stopMainScroll:i,mainScrollRef:l}),e[0]=l,e[1]=t,e[2]=s,e[3]=i,e[4]=u):u=e[4],u}let r;return e[5]!==t||e[6]!==s?(r=n.jsx(ks,{message:t,roomId:s}),e[5]=t,e[6]=s,e[7]=r):r=e[7],r}function bl(o){"use forget";const e=A.c(10),{message:t,roomId:s,stopMainScroll:i,mainScrollRef:l}=o,[a,r]=N.useState(0);let u;e[0]===Symbol.for("react.memo_cache_sentinel")?(u=Hn({axis:"height",onChange:g=>{const{height:y}=g;r(p=>y)}}),e[0]=u):u=e[0];const m=u;let f;e[1]!==t||e[2]!==s?(f=n.jsx("div",{ref:m,children:n.jsx(ks,{message:t,roomId:s})}),e[1]=t,e[2]=s,e[3]=f):f=e[3];let c;return e[4]!==a||e[5]!==l||e[6]!==t.id||e[7]!==i||e[8]!==f?(c=n.jsx(cl,{contentHeight:a,messageId:t.id,stopMainScroll:i,mainScrollRef:l,children:f}),e[4]=a,e[5]=l,e[6]=t.id,e[7]=i,e[8]=f,e[9]=c):c=e[9],c}function qt({actions:o,className:e}){return n.jsx("div",{className:V("flex min-h-6 items-center gap-1",e),children:o.map((t,s)=>t.popoverContent?n.jsxs(Vn,{children:[n.jsx(Qn,{asChild:!0,children:n.jsx("button",{type:"button",onClick:t.onClick,title:t.title,className:"radix-state-open:bg-token-bg-tertiary hover:bg-token-bg-tertiary radix-state-open:text-token-icon-primary hover:text-token-icon-primary text-token-icon-secondary flex h-6 w-6 items-center justify-center rounded-full transition",children:t.icon})}),n.jsx(Xn,{children:n.jsx(Jn,{side:"top",sideOffset:8,align:"center",className:"bg-token-bg-primary rounded-full p-1.5 shadow-[0_4px_64px_0_rgba(0,0,0,0.2)]",children:t.popoverContent})})]},s):n.jsx("button",{type:"button",onClick:t.onClick,title:t.title,className:"radix-state-open:bg-token-bg-tertiary hover:bg-token-bg-tertiary radix-state-open:text-token-icon-primary hover:text-token-icon-primary text-token-icon-secondary flex h-6 w-6 items-center justify-center rounded-full transition",children:t.icon},s))})}function lt(o){"use forget";const e=A.c(6),{roomId:t,message:s,className:i,enabledActions:l}=o,a=W(),r=he(a),u=qe(),m=s.id,f=te();if(s.role==="user"&&(s.deliveryState==="pending"||s.deliveryState==="failed")){let p;e[0]===Symbol.for("react.memo_cache_sentinel")?(p=[],e[0]=p):p=e[0];let b;return e[1]!==i?(b=n.jsx(qt,{className:i,actions:p}),e[1]=i,e[2]=b):b=e[2],b}const g=l.map(p=>{var b;switch(p){case"addReaction":{const d=(b=Ze(a))==null?void 0:b.normalizedAccountUserId,v=d?s.reactions[d]:null,h=v?Ht.includes(v):!1;return{icon:n.jsx(yo,{className:"icon-sm"}),popoverContent:n.jsxs(n.Fragment,{children:[Ht.map(j=>n.jsx(Ut,{asChild:!0,children:n.jsx("button",{className:V("inline-flex h-10 w-10 items-center justify-center rounded-full text-2xl",v===j&&"bg-token-bg-secondary"),onClick:async()=>{v===j?await r.removeMessageReaction$(t,m):await r.addMessageReaction$(t,m,{reaction:j})},children:j})},j)),n.jsx(Ut,{asChild:!0,children:v==null||h?n.jsx("button",{className:"inline-flex h-10 w-10 items-center justify-center text-2xl",onClick:()=>{ne(a,Kn,{onSelect:async x=>{await r.addMessageReaction$(t,m,{reaction:x})}})},children:n.jsx("div",{className:"bg-token-bg-secondary flex h-7 w-7 items-center justify-center rounded-full",children:n.jsx(Wn,{className:"icon-sm text-token-icon-primary"})})},"more_emojis"):n.jsx("button",{className:V("bg-token-bg-secondary inline-flex h-10 w-10 items-center justify-center rounded-full text-2xl"),onClick:async()=>{await r.removeMessageReaction$(t,m)},children:v},v)})]}),title:f.formatMessage({id:"o7T6ns",defaultMessage:"Add reaction"})}}case"reply":return{icon:n.jsx(ys,{className:"icon-sm"}),title:f.formatMessage({id:"67Ys9k",defaultMessage:"Reply"}),onClick:()=>{u.setReplyToMessage(s,f)}};case"report":return{icon:n.jsx(xs,{className:"icon-sm"}),title:f.formatMessage({id:"5Z3K6i",defaultMessage:"Report"}),onClick:()=>{ne(a,hs,{entityId:s.id,entityType:is.Message,title:f.formatMessage({id:"32LaLp",defaultMessage:"Report message"})})}};case"delete":{const d=()=>{r.deleteMessage$(t,m)},v=()=>{ne(a,Yn,{handleDelete:d})};return{icon:n.jsx(gs,{className:"icon-sm"}),title:f.formatMessage({id:"8SVfHI",defaultMessage:"Delete"}),onClick:v}}case"inspectorLog":return null;default:return null}}).filter(jl);let y;return e[3]!==g||e[4]!==i?(y=n.jsx(qt,{className:i,actions:g}),e[3]=g,e[4]=i,e[5]=y):y=e[5],y}function jl(o){return o!=null}function at(o){"use forget";var f;const e=A.c(15),{message:t,className:s}=o;let i,l,a,r;if(e[0]!==s||e[1]!==t.reactions){r=Symbol.for("react.early_return_sentinel");e:{const c=Object.entries(t.reactions);if(c.length===0){r=null;break e}const g=new Map;for(const[y,p]of c)g.has(p)||g.set(p,[]),(f=g.get(p))==null||f.push(y);e[6]!==s?(l=V("flex items-center gap-1",s),e[6]=s,e[7]=l):l=e[7],e[8]===Symbol.for("react.memo_cache_sentinel")?(i=V("bg-token-bg-tertiary outline-token-bg-primary flex items-center rounded-full px-1 text-sm outline-2"),e[8]=i):i=e[8],a=Array.from(g.entries()).map(vl)}e[0]=s,e[1]=t.reactions,e[2]=i,e[3]=l,e[4]=a,e[5]=r}else i=e[2],l=e[3],a=e[4],r=e[5];if(r!==Symbol.for("react.early_return_sentinel"))return r;let u;e[9]!==i||e[10]!==a?(u=n.jsx("div",{className:i,children:a}),e[9]=i,e[10]=a,e[11]=u):u=e[11];let m;return e[12]!==l||e[13]!==u?(m=n.jsx("div",{className:l,children:u}),e[12]=l,e[13]=u,e[14]=m):m=e[14],m}function vl(o){const[e,t]=o;return n.jsx(Sl,{emoji:e,userIds:t},e)}function Sl({emoji:o,userIds:e}){const t=W(),s=he(t),i=z(()=>e.map(u=>{var f,c;if(u==="assistant")return"ChatGPT";const m=(f=s.users$().get(u))==null?void 0:f.name;return m==null?(c=s.userProfileSnapshots$().get(u))==null?void 0:c.name:m})),l=e.length,a=i.map((u,m)=>u!=null?u:e[m]),r=n.jsx("div",{className:"flex flex-col items-center gap-0.5",children:a.map((u,m)=>n.jsx("span",{children:u},"".concat(e[m],"-").concat(m)))});return n.jsx(xn,{label:r,side:"top",withArrow:!0,sideOffset:0,theme:"default",className:"inline-flex cursor-default items-center gap-1 rounded-full px-1 py-0.5",children:n.jsxs("span",{className:"inline-flex items-center gap-1",children:[n.jsx("span",{children:o}),l>1?n.jsx("span",{className:"text-token-text-secondary text-xs",children:l}):null]})})}function Cl(o){"use forget";var x;const e=A.c(26),{room:t}=o,s=W();let i;e[0]!==t?(i=()=>t==null?void 0:t.name$(),e[0]=t,e[1]=i):i=e[1];const l=z(i);let a;e[2]!==t?(a=()=>t==null?void 0:t.creatorAccountUserId$(),e[2]=t,e[3]=a):a=e[3];const r=z(a);let u;e[4]!==s?(u=(x=Ze(s))==null?void 0:x.normalizedAccountUserId,e[4]=s,e[5]=u):u=e[5];const m=u===r;let f;e[6]!==t?(f=()=>{var S;return(S=t==null?void 0:t.members$().length)!=null?S:0},e[6]=t,e[7]=f):f=e[7];const c=z(f),g=m||c===1,y=c>1,p=te();let b;e[8]!==l?(b=l==null?null:n.jsx(_l,{roomName:l}),e[8]=l,e[9]=b):b=e[9];let d;e[10]!==s||e[11]!==p||e[12]!==t||e[13]!==l||e[14]!==g||e[15]!==y?(d=t==null||l==null?n.jsx("div",{}):n.jsxs("div",{className:"flex w-2/3 items-center",children:[n.jsx("div",{className:"md:hidden",children:n.jsx(jo,{onClick:Ml})}),n.jsxs(yn,{alignOffset:-4,size:"small",triggerButton:n.jsxs(Bt,{children:[n.jsx("span",{className:"truncate overflow-hidden text-start text-lg",children:l}),n.jsx(ao,{className:"icon-sm text-token-icon-tertiary"})]}),testId:"calpico-room-settings-dropdown",children:[n.jsx(re.Item,{icon:bo,onClick:()=>{ne(s,zt,{room:t})},children:n.jsx(ce,{id:"MlDLlK",defaultMessage:"People"})}),n.jsx(re.Item,{icon:Zn,onClick:()=>{ne(s,bs,{room:t})},children:n.jsx(ce,{id:"C+QPSB",defaultMessage:"Manage group link"})}),n.jsx(re.Item,{icon:eo,onClick:()=>{ne(s,to,{room:t})},children:n.jsx(ce,{id:"S+Al8v",defaultMessage:"Rename group"})}),n.jsx(re.Item,{icon:bn,onClick:()=>{ne(s,so,{room:t})},children:n.jsx(ce,{id:"iQoNfK",defaultMessage:"Customize ChatGPT"})}),n.jsx(re.Separator,{}),n.jsx(re.Item,{icon:xs,onClick:()=>{ne(s,hs,{entityId:t.id,entityType:is.CalpicoRoom,title:p.formatMessage({id:"o7lr8d",defaultMessage:"Report group chat"})})},color:"danger",children:n.jsx(ce,{id:"rGTGQC",defaultMessage:"Report"})}),y?n.jsx(re.Item,{icon:no,onClick:()=>{ne(s,oo,{room:t})},color:"danger",children:n.jsx(ce,{id:"/E3t8l",defaultMessage:"Leave group"})}):null,g?n.jsx(re.Item,{icon:gs,onClick:()=>{ne(s,lo,{room:t})},color:"danger",children:n.jsx(ce,{id:"c7EK/q",defaultMessage:"Delete group"})}):null]})]}),e[10]=s,e[11]=p,e[12]=t,e[13]=l,e[14]=g,e[15]=y,e[16]=d):d=e[16];let v;e[17]!==s||e[18]!==t?(v=t==null?null:n.jsx("div",{className:"px-2.5",children:n.jsx(Bt,{className:"-me-1 rounded-full px-1 py-1",onClick:()=>{ne(s,zt,{room:t})},children:n.jsx(io,{room:t,baseSize:32,variant:"horizontal-stack"})})}),e[17]=s,e[18]=t,e[19]=v):v=e[19];let h;e[20]!==d||e[21]!==v?(h=n.jsxs(vo,{id:"calpico-page-header",shouldHideHeaderOnSmallScreens:!1,shouldUseEmptyStateLayout:!1,shouldStickSnorlaxNewThread:!1,shouldUseDefaultHeaderPositioning:!0,shouldUseTransparentDefaultHeaderBackground:!0,shouldForceTransparentBackground:!1,shouldShowUpgradeStyles:!1,edgeShadowClass:"[box-shadow:var(--sharp-edge-top-shadow)]",shouldDisableTransition:!0,children:[d,v]}),e[20]=d,e[21]=v,e[22]=h):h=e[22];let j;return e[23]!==b||e[24]!==h?(j=n.jsxs(n.Fragment,{children:[b,h]}),e[23]=b,e[24]=h,e[25]=j):j=e[25],j}function Ml(){return jn.setSidebarOpen(!0)}function _l(o){"use forget";const e=A.c(2),{roomName:t}=o;let s;return e[0]!==t?(s=n.jsx(ro,{children:n.jsx("title",{children:t})}),e[0]=t,e[1]=s):s=e[1],s}function it(o){"use forget";const e=A.c(6),{targetMessage:t}=o,s=te();let i;e[0]!==s||e[1]!==t?(i=t?us(t,100)||s.formatMessage({id:"PnfKiD",defaultMessage:"Attachment"}):s.formatMessage({id:"y3kg1o",defaultMessage:"Loading message"}),e[0]=s,e[1]=t,e[2]=i):i=e[2];const l=i;let a;e[3]===Symbol.for("react.memo_cache_sentinel")?(a=n.jsx(ys,{className:"icon-sm me-1 flex-shrink-0"}),e[3]=a):a=e[3];let r;return e[4]!==l?(r=n.jsx(vn,{children:n.jsxs("div",{className:"text-token-text-secondary mb-1 flex items-start text-xs font-medium",children:[a,n.jsx("span",{className:"line-clamp-2 break-words",children:l})]})}),e[4]=l,e[5]=r):r=e[5],r}function Nl({children:o,className:e}){const t=W(),s=qe(),i=ht(t),l=te(),{getRootProps:a,isDragActive:r}=Co({onDropAccepted:u=>{const m=Array.from(u).map(f=>ft(f,c=>pt(s.roomId,c)));s.attachments$.set(f=>[...f,...m.map(c=>({kind:"fileUpload",calpicoFileId:"",state:c}))])},multiple:!0,accept:i?ie(ie({},nt(ut)),nt(Qe)):nt(ut)});return n.jsxs("div",ve(ie({},a()),{className:V("relative",e),children:[o,r?n.jsxs(So,{children:[n.jsx(co,{}),n.jsx("div",{className:"font-medium",children:i?l.formatMessage({id:"4GdYBD",defaultMessage:"Drop a file to upload"}):l.formatMessage({id:"tUo5fR",defaultMessage:"Drop an image to upload"})})]}):null]}))}const Tl=ss({user:{id:"9vw5O1",defaultMessage:"User"}});function wl(o){"use forget";const e=A.c(20),{roomId:t}=o,s=W();let i;e[0]!==s?(i=he(s),e[0]=s,e[1]=i):i=e[1];const l=i,a=te();let r;e[2]!==l||e[3]!==t?(r=()=>{var v;return(v=l.rooms$().get(t))==null?void 0:v.assistantHeartbeats$()},e[2]=l,e[3]=t,e[4]=r):r=e[4];const u=z(r);let m;e[5]!==a?(m=a.formatMessage(Tl.user),e[5]=a,e[6]=m):m=e[6];const f=m;let c;e[7]!==l||e[8]!==f||e[9]!==t?(c=()=>{var h,j;return((j=(h=l.rooms$().get(t))==null?void 0:h.userHeartbeats$())!=null?j:[]).map(x=>{var _,T;const{accountUserId:S}=x;return(T=(_=l.users$().get(S))==null?void 0:_.name)!=null?T:f})},e[7]=l,e[8]=f,e[9]=t,e[10]=c):c=e[10];const g=z(c);let y;e[11]!==u?(y=u!=null?u:[],e[11]=u,e[12]=y):y=e[12];let p;e[13]!==y?(p=y.map(kl),e[13]=y,e[14]=p):p=e[14];let b;e[15]!==g?(b=g.length>0?n.jsx(Al,{typingUserDisplayNames:g}):null,e[15]=g,e[16]=b):b=e[16];let d;return e[17]!==p||e[18]!==b?(d=n.jsxs("div",{className:"flex flex-col gap-4",children:[p,b]}),e[17]=p,e[18]=b,e[19]=d):d=e[19],d}function kl(o){return n.jsx(Il,{message:o.message},o.modelSlug)}function Il(o){"use forget";const e=A.c(4),{message:t}=o;let s,i;e[0]===Symbol.for("react.memo_cache_sentinel")?(s=[Mo],i={p:Rl,strong:El},e[0]=s,e[1]=i):(s=e[0],i=e[1]);const l=t!=null?t:"";let a;return e[2]!==l?(a=n.jsx("div",{className:"flex items-center gap-3",children:n.jsx(js,{remarkPlugins:s,components:i,className:"markdown [&>p:last-child]:mb-0!",children:l})}),e[2]=l,e[3]=a):a=e[3],a}function El(o){const{children:e}=o;return n.jsx("strong",{className:"font-semibold",children:e})}function Rl(o){const{children:e}=o;return n.jsx("p",{className:"text-token-text-secondary loading-shimmer-pure-text text-sm leading-tight wrap-anywhere",children:e})}function Al(o){"use forget";const e=A.c(14),{typingUserDisplayNames:t}=o,s=t.length;if(s===0)return null;let i;e[0]!==s||e[1]!==t[0]?(i=s===1&&n.jsx(ce,{id:"7izLl8",defaultMessage:"{userDisplayName} is typing",values:{userDisplayName:n.jsx("strong",{className:"font-semibold",children:t[0]})}}),e[0]=s,e[1]=t[0],e[2]=i):i=e[2];let l;e[3]!==s||e[4]!==t[0]||e[5]!==t[1]?(l=s===2&&n.jsx(ce,{id:"nVUHou",defaultMessage:"{primaryUserDisplayName} & {secondaryUserDisplayName} are typing",values:{primaryUserDisplayName:n.jsx("strong",{className:"font-semibold",children:t[0]}),secondaryUserDisplayName:n.jsx("strong",{className:"font-semibold",children:t[1]})}}),e[3]=s,e[4]=t[0],e[5]=t[1],e[6]=l):l=e[6];let a;e[7]!==s||e[8]!==t[0]?(a=s>2&&n.jsx(ce,{id:"k+PAM5",defaultMessage:"{primaryUserDisplayName} & <strong>{remainingCount} more</strong> are typing",values:{primaryUserDisplayName:n.jsx("strong",{className:"font-semibold",children:t[0]}),remainingCount:s-1,strong:$l}}),e[7]=s,e[8]=t[0],e[9]=a):a=e[9];let r;return e[10]!==i||e[11]!==l||e[12]!==a?(r=n.jsx("div",{className:"flex items-center gap-3",children:n.jsxs("p",{className:"text-token-text-secondary loading-shimmer-pure-text items-baseline text-sm leading-tight",children:[i,l,a]})}),e[10]=i,e[11]=l,e[12]=a,e[13]=r):r=e[13],r}function $l(o){return n.jsx("strong",{className:"font-semibold",children:o},"typing-indicator-strong")}const Is=String.raw;var Xt;const Wt=Is(Xt||(Xt=st(["p{Emoji}(?:p{EMod}|[󠀠-󠁾]+󠁿|️?⃣?)"],["\\p{Emoji}(?:\\p{EMod}|[\\u{E0020}-\\u{E007E}]+\\u{E007F}|\\uFE0F?\\u20E3?)"])));var Jt;const Dl=()=>new RegExp(Is(Jt||(Jt=st(["p{RI}{2}|(?![#*d](?!️?⃣))","(?:‍",")*"],["\\p{RI}{2}|(?![#*\\d](?!\\uFE0F?\\u20E3))","(?:\\u200D",")*"])),Wt,Wt),"gu"),Pl=5;function Fl(o){if(o.includes("\n"))return!1;const e=Dl();if(!new RegExp("^(?:".concat(e.source,"| )+$"),"u").test(o))return!1;const s=Array.from(o.matchAll(e)).length;return!(s===0||s>Pl)}function Kt(o){"use forget";const e=A.c(4),{text:t}=o;if(Fl(t)){let i;return e[0]!==t?(i=n.jsx("p",{className:"text-2xl",children:t}),e[0]=t,e[1]=i):i=e[1],i}let s;return e[2]!==t?(s=n.jsx("p",{className:"m-0 wrap-anywhere whitespace-pre-wrap",children:t}),e[2]=t,e[3]=s):s=e[3],s}function Ll(o){"use forget";const e=A.c(8),{room:t}=o;let s;e[0]!==t?(s=()=>t.threadSidebar$(),e[0]=t,e[1]=s):s=e[1];const i=z(s),l=i!=null;let a;e[2]!==i||e[3]!==t?(a=n.jsx(Ul,{room:t,activeSidebar:i}),e[2]=i,e[3]=t,e[4]=a):a=e[4];let r;return e[5]!==l||e[6]!==a?(r=n.jsx(rs,{children:n.jsx(To,{isExpanded:l,children:a})}),e[5]=l,e[6]=a,e[7]=r):r=e[7],r}function Ul({room:o,activeSidebar:e}){const t=z(Sn);if(!e)return null;switch(e.type){case"product":return n.jsx(zl,{room:o,activeSidebar:e,type:t?"sidebar":"modal"})}return null}function zl(o){"use forget";const e=A.c(25),{activeSidebar:t,room:s,type:i}=o,l=i===void 0?"sidebar":i,a=W(),r=s.id,{calpicoMessageId:u,messageId:m,contentReferenceStartIndex:f,productIndex:c}=t;let g;e[0]!==u||e[1]!==f||e[2]!==m||e[3]!==s?(g=()=>{var w,k;const _=s.messages$().find(M=>M.id===u);if(!_||_.role!=="assistant")return null;const T=_.rawMessages.find(M=>M.id===m);return T?(k=(w=T.metadata)==null?void 0:w.content_references)==null?void 0:k.find(M=>M.start_idx===f):null},e[0]=u,e[1]=f,e[2]=m,e[3]=s,e[4]=g):g=e[4];const y=z(g);let p;e[5]!==m||e[6]!==r?(p={clientThreadId:r,messageId:m},e[5]=m,e[6]=r,e[7]=p):p=e[7];const b=p;let d;e[8]!==a||e[9]!==s?(d=()=>{he(a).closeThreadSidebar$(s)},e[8]=a,e[9]=s,e[10]=d):d=e[10];const v=d;if(!y)return null;let h;e[11]!==y||e[12]!==c?(h=No({contentReference:y,productIndex:c}),e[11]=y,e[12]=c,e[13]=h):h=e[13];const{product:j}=h;if(!j)return null;let x;e[14]!==f||e[15]!==m||e[16]!==c?(x={messageId:m,contentReferenceStartIndex:f,productIndex:c},e[14]=f,e[15]=m,e[16]=c,e[17]=x):x=e[17];let S;return e[18]!==b||e[19]!==v||e[20]!==j||e[21]!==r||e[22]!==x||e[23]!==l?(S=n.jsx(_o,{clientThreadId:r,product:j,sidebar:x,handleCloseThreadSidebar:v,analyticsMetadata:b,type:l}),e[18]=b,e[19]=v,e[20]=j,e[21]=r,e[22]=x,e[23]=l,e[24]=S):S=e[24],S}/*!---------------------------------------------------------------------------------------------
 *  Copyright (c) StackBlitz. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/const Bl={damping:.7,stiffness:.05,mass:1.25},Ol=70,Hl=1e3/60,Gl=350;let et=!1;var Zt;(Zt=globalThis.document)==null||Zt.addEventListener("mousedown",()=>{et=!0});var es;(es=globalThis.document)==null||es.addEventListener("mouseup",()=>{et=!1});var ts;(ts=globalThis.document)==null||ts.addEventListener("click",()=>{et=!1});const ql=(o={})=>{const[e,t]=N.useState(!1),[s,i]=N.useState(o.initial!==!1),[l,a]=N.useState(!1),r=N.useRef(null);r.current=o;const u=N.useCallback(()=>{var x;if(!et)return!1;const h=window.getSelection();if(!h||!h.rangeCount)return!1;const j=h.getRangeAt(0);return j.commonAncestorContainer.contains(d.current)||((x=d.current)==null?void 0:x.contains(j.commonAncestorContainer))},[]),m=N.useCallback(h=>{c.isAtBottom=h,i(h)},[]),f=N.useCallback(h=>{c.escapedFromLock=h,t(h)},[]),c=N.useMemo(()=>{let h;return{escapedFromLock:e,isAtBottom:s,resizeDifference:0,accumulated:0,velocity:0,listeners:new Set,get scrollTop(){var j,x;return(x=(j=d.current)==null?void 0:j.scrollTop)!=null?x:0},set scrollTop(j){d.current&&(d.current.scrollTop=j,c.ignoreScrollToTop=d.current.scrollTop)},get targetScrollTop(){return!d.current||!v.current?0:d.current.scrollHeight-1-d.current.clientHeight},get calculatedTargetScrollTop(){if(!d.current||!v.current)return 0;const{targetScrollTop:j}=this;if(!o.targetScrollTop)return j;if((h==null?void 0:h.targetScrollTop)===j)return h.calculatedScrollTop;const x=Math.max(Math.min(o.targetScrollTop(j,{scrollElement:d.current,contentElement:v.current}),j),0);return h={targetScrollTop:j,calculatedScrollTop:x},requestAnimationFrame(()=>{h=void 0}),x},get scrollDifference(){return this.calculatedTargetScrollTop-this.scrollTop},get isNearBottom(){return this.scrollDifference<=Ol}}},[]),g=N.useCallback((h={})=>{var k,M;typeof h=="string"&&(h={animation:h}),h.preserveScrollPosition||m(!0);const j=Date.now()+(Number(h.wait)||0),x=ct(r.current,h.animation),{ignoreEscapes:S=!1}=h;let _,T=c.calculatedTargetScrollTop;h.duration instanceof Promise?h.duration.finally(()=>{_=Date.now()}):_=j+((k=h.duration)!=null?k:0);const w=async()=>{const C=new Promise(requestAnimationFrame).then(()=>{var O,L;if(!c.isAtBottom)return c.animation=void 0,!1;const{scrollTop:E}=c,D=performance.now(),B=(D-((O=c.lastTick)!=null?O:D))/Hl;if(c.animation||(c.animation={behavior:x,promise:C,ignoreEscapes:S}),c.animation.behavior===x&&(c.lastTick=D),u()||j>Date.now())return w();if(E<Math.min(T,c.calculatedTargetScrollTop)){if(((L=c.animation)==null?void 0:L.behavior)===x){if(x==="instant")return c.scrollTop=c.calculatedTargetScrollTop,w();c.velocity=(x.damping*c.velocity+x.stiffness*c.scrollDifference)/x.mass,c.accumulated+=c.velocity*B,c.scrollTop+=c.accumulated,c.scrollTop!==E&&(c.accumulated=0)}return w()}return _>Date.now()?(T=c.calculatedTargetScrollTop,w()):(c.animation=void 0,c.scrollTop<c.calculatedTargetScrollTop?g({animation:ct(r.current,r.current.resize),ignoreEscapes:S,duration:Math.max(0,_-Date.now())||void 0}):c.isAtBottom)});return C.then(E=>(requestAnimationFrame(()=>{c.animation||(c.lastTick=void 0,c.velocity=0)}),E))};return h.wait!==!0&&(c.animation=void 0),((M=c.animation)==null?void 0:M.behavior)===x?c.animation.promise:w()},[m,u,c]),y=N.useCallback(()=>{f(!0),m(!1)},[f,m]),p=N.useCallback(({target:h})=>{if(h!==d.current)return;const{scrollTop:j,ignoreScrollToTop:x}=c;let{lastScrollTop:S=j}=c;c.lastScrollTop=j,c.ignoreScrollToTop=void 0,x&&x>j&&(S=x),a(c.isNearBottom),setTimeout(()=>{var w;if(c.resizeDifference||j===x)return;if(u()){f(!0),m(!1);return}const _=j>S,T=j<S;if((w=c.animation)!=null&&w.ignoreEscapes){c.scrollTop=S;return}T&&(f(!0),m(!1)),_&&f(!1),!c.escapedFromLock&&c.isNearBottom&&m(!0)},1)},[f,m,u,c]),b=N.useCallback(({target:h,deltaY:j})=>{var S;let x=h;for(;!["scroll","auto"].includes(getComputedStyle(x).overflow);){if(!x.parentElement)return;x=x.parentElement}x===d.current&&j<0&&d.current.scrollHeight>d.current.clientHeight&&!((S=c.animation)!=null&&S.ignoreEscapes)&&(f(!0),m(!1))},[f,m,c]),d=Yt(h=>{var j,x;(j=d.current)==null||j.removeEventListener("scroll",p),(x=d.current)==null||x.removeEventListener("wheel",b),h==null||h.addEventListener("scroll",p,{passive:!0}),h==null||h.addEventListener("wheel",b,{passive:!0})},[]),v=Yt(h=>{var x,S;if((x=c.resizeObserver)==null||x.disconnect(),!h)return;let j;c.resizeObserver=new ResizeObserver(([_])=>{const{height:T}=_.contentRect,w=T-(j!=null?j:T);if(c.resizeDifference=w,c.scrollTop>c.targetScrollTop&&(c.scrollTop=c.targetScrollTop),a(c.isNearBottom),w>=0){const k=ct(r.current,j?r.current.resize:r.current.initial);g({animation:k,wait:!0,preserveScrollPosition:!0,duration:k==="instant"?void 0:Gl})}else c.isNearBottom&&(f(!1),m(!0));j=T,requestAnimationFrame(()=>{setTimeout(()=>{c.resizeDifference===w&&(c.resizeDifference=0)},1)})}),(S=c.resizeObserver)==null||S.observe(h)},[]);return{contentRef:v,scrollRef:d,scrollToBottom:g,stopScroll:y,isAtBottom:s||l,isNearBottom:l,escapedFromLock:e,state:c}};function Yt(o,e){const t=N.useCallback(s=>(t.current=s,o(s)),e);return t}const rt=new Map;function ct(...o){var i,l,a;const e=ie({},Bl);let t=!1;for(const r of o){if(r==="instant"){t=!0;continue}typeof r=="object"&&(t=!1,e.damping=(i=r.damping)!=null?i:e.damping,e.stiffness=(l=r.stiffness)!=null?l:e.stiffness,e.mass=(a=r.mass)!=null?a:e.mass)}const s=JSON.stringify(e);return rt.has(s)||rt.set(s,Object.freeze(e)),t?"instant":rt.get(s)}ls(()=>ns(()=>import("./gkerdwj307fj3n4u.js"),__vite__mapDeps([7,1,2,3,8,9,5,6])).then(o=>o.JsonViewer));function Vt(o,e){return o.role!==e.role?!1:o.role==="user"&&e.role==="user"?o.accountUserId===e.accountUserId:(o.role==="assistant"&&e.role==="assistant",!1)}function Qt(o,e){return Tn(e.createdAt,o.createdAt)>30}function Es(o){"use forget";const e=A.c(15),{date:t}=o,s=W();let i;if(e[0]!==s||e[1]!==t){const g=cs(s).locale;i=fo(t,g),e[0]=s,e[1]=t,e[2]=i}else i=e[2];const{date:l,time:a}=i;let r;e[3]!==t?(r=t.toISOString(),e[3]=t,e[4]=r):r=e[4];let u;e[5]!==l?(u=n.jsx("span",{className:"font-semibold",children:l}),e[5]=l,e[6]=u):u=e[6];let m;e[7]!==a?(m=n.jsx("span",{children:a}),e[7]=a,e[8]=m):m=e[8];let f;e[9]!==u||e[10]!==m?(f=n.jsx(ce,{id:"Bn2rwA",defaultMessage:"{date} {time}",values:{date:u,time:m}}),e[9]=u,e[10]=m,e[11]=f):f=e[11];let c;return e[12]!==r||e[13]!==f?(c=n.jsx("time",{className:"text-token-text-secondary block w-full px-2 py-0.5 text-center text-xs",dateTime:r,children:f}),e[12]=r,e[13]=f,e[14]=c):c=e[14],c}function Wl(){"use forget";var l;const o=A.c(2),e=W(),t=(l=$s().id)!=null?l:null,s=he(e);if(t==null||!s.hasAccess)return null;let i;return o[0]!==t?(i=n.jsx(Kl,{roomId:t}),o[0]=t,o[1]=i):i=o[1],i}function Kl(o){"use forget";var St;const e=A.c(120),{roomId:t}=o,s=W();let i;e[0]!==s?(i=he(s),e[0]=s,e[1]=i):i=e[1];const l=i;let a;e[2]!==l||e[3]!==t?(a=()=>l.rooms$().get(t),e[2]=l,e[3]=t,e[4]=a):a=e[4];const r=z(a);let u;e[5]!==r?(u=()=>{var $;return($=r==null?void 0:r.fetchSource$())!=null?$:null},e[5]=r,e[6]=u):u=e[6];const m=z(u),f=r==null,c=f||m==="summary";let g;e[7]===Symbol.for("react.memo_cache_sentinel")?(g={initial:"instant",resize:"instant"},e[7]=g):g=e[7];const{contentRef:y,scrollRef:p,scrollToBottom:b,isNearBottom:d,stopScroll:v}=ql(g);let h;e[8]===Symbol.for("react.memo_cache_sentinel")?(h=new Set([]),e[8]=h):h=e[8];const j=N.useRef(h);let x,S;e[9]!==l||e[10]!==t||e[11]!==c?(x=()=>{!c||j.current.has(t)||(j.current.add(t),l.fetchRoom$(t))},S=[l,c,t],e[9]=l,e[10]=t,e[11]=c,e[12]=x,e[13]=S):(x=e[12],S=e[13]),N.useEffect(x,S);let _;e[14]===Symbol.for("react.memo_cache_sentinel")?(_=new Set([]),e[14]=_):_=e[14];const T=N.useRef(_);let w,k;e[15]!==l||e[16]!==f||e[17]!==t?(k=()=>{f||T.current.has(t)||(T.current.add(t),l.fetchMessages$({roomId:t}))},w=[l,f,t],e[15]=l,e[16]=f,e[17]=t,e[18]=w,e[19]=k):(w=e[18],k=e[19]),N.useEffect(k,w);let M;e[20]!==l||e[21]!==t?(M=()=>{var $;return($=l.rooms$().get(t))==null?void 0:$.viewMessages$()},e[20]=l,e[21]=t,e[22]=M):M=e[22];const C=z(M),E=N.useRef(null);let D;e[23]!==l||e[24]!==t?(D=()=>{var $,P;return(P=($=l.rooms$().get(t))==null?void 0:$.isFetchingMessages$())!=null?P:!1},e[23]=l,e[24]=t,e[25]=D):D=e[25];const B=z(D);let O;e[26]!==l||e[27]!==t?(O=()=>{var $,P;return(P=($=l.rooms$().get(t))==null?void 0:$.hasFetchedBeginning$())!=null?P:!1},e[26]=l,e[27]=t,e[28]=O):O=e[28];const L=z(O);let F;e[29]!==l||e[30]!==t?(F=()=>{var P,ae,ge;const $=(P=l.rooms$().get(t))==null?void 0:P.viewMessages$();return(ge=(ae=$==null?void 0:$[0])==null?void 0:ae.id)!=null?ge:null},e[29]=l,e[30]=t,e[31]=F):F=e[31];const H=z(F);let se;e[32]!==l||e[33]!==H||e[34]!==t||e[35]!==p?(se=$=>{const P=p.current;if(!P)return;const ae=l.rooms$().get(t);if(!ae||ae.isFetchingMessages$()||ae.hasFetchedBeginning$()||$==="scroll"&&!(P.scrollTop<=200))return;const ge=H!=null?H:null,ze=P.getBoundingClientRect(),Be=ge?P.querySelector('[data-message-id="'.concat(ge,'"]')):null,Ye=Be?Be.getBoundingClientRect().top-ze.top:null;E.current={previousScrollHeight:P.scrollHeight,anchorId:ge,anchorOffset:Ye},l.fetchMoreMessages$(t,"before")},e[32]=l,e[33]=H,e[34]=t,e[35]=p,e[36]=se):se=e[36];const K=se;let X,J;e[37]!==K||e[38]!==p?(X=()=>{const $=p.current;if($==null)return;const P=_n(()=>{K("scroll")},100);return $.addEventListener("scroll",P,{passive:!0}),()=>{$.removeEventListener("scroll",P),P.cancel()}},J=[p,K],e[37]=K,e[38]=p,e[39]=X,e[40]=J):(X=e[39],J=e[40]),N.useEffect(X,J);let oe;e[41]!==K||e[42]!==p?(oe=()=>{const $=p.current;if(!$)return;const P=requestAnimationFrame(()=>{$.scrollHeight<=$.clientHeight+1&&K("underflow")});return()=>cancelAnimationFrame(P)},e[41]=K,e[42]=p,e[43]=oe):oe=e[43];let me;e[44]!==K||e[45]!==C||e[46]!==p?(me=[C,p,K],e[44]=K,e[45]=C,e[46]=p,e[47]=me):me=e[47],N.useEffect(oe,me);let R;e[48]!==p?(R=()=>{const $=E.current;if(!$)return;const P=p.current;if(!P){E.current=null;return}const{anchorId:ae,anchorOffset:ge,previousScrollHeight:ze}=$,Be=function(Oe,Mt){Oe.scrollTop=Oe.scrollTop+Mt};if(ae&&ge!=null){const Ct=P.getBoundingClientRect(),Oe=P.querySelector('[data-message-id="'.concat(ae,'"]'));if(Oe){const _t=Oe.getBoundingClientRect().top-Ct.top-ge;_t&&Be(P,_t),E.current=null;return}}const Ye=P.scrollHeight-ze;Ye&&Be(P,Ye),E.current=null},e[48]=p,e[49]=R):R=e[49];let I;e[50]!==C||e[51]!==p?(I=[C,p],e[50]=C,e[51]=p,e[52]=I):I=e[52],Cn(R,I);let U;e[53]!==C?(U=Mn(C),e[53]=C,e[54]=U):U=e[54];const G=U,q=G==null?void 0:G.id,Y=G==null?void 0:G.createdAt;let de;e[55]===Symbol.for("react.memo_cache_sentinel")?(de=new Set,e[55]=de):de=e[55];const Z=N.useRef(de);let ee,ue;e[56]!==l||e[57]!==d||e[58]!==Y||e[59]!==q||e[60]!==t?(ee=()=>{q==null||Y==null||!d||Z.current.has(q)||(Z.current.add(q),l.markRoomRead$(t,Y))},ue=[q,Y,t,l,d],e[56]=l,e[57]=d,e[58]=Y,e[59]=q,e[60]=t,e[61]=ee,e[62]=ue):(ee=e[61],ue=e[62]),N.useEffect(ee,ue);let Q;e[63]===Symbol.for("react.memo_cache_sentinel")?(Q=new Set,e[63]=Q):Q=e[63];const fe=N.useRef(Q);let le,pe;e[64]!==d||e[65]!==q||e[66]!==b?(le=()=>{q==null||!d||fe.current.has(q)||(fe.current.add(q),requestAnimationFrame(()=>{b("instant")}))},pe=[q,b,d],e[64]=d,e[65]=q,e[66]=b,e[67]=le,e[68]=pe):(le=e[67],pe=e[68]),N.useEffect(le,pe);const be=!B&&((St=C==null?void 0:C.length)!=null?St:0)<uo,xe=B&&!L&&!be,ye=te(),je=r!=null?r:null;let Ce;e[69]!==je?(Ce=n.jsx(Cl,{room:je}),e[69]=je,e[70]=Ce):Ce=e[70];let We;e[71]===Symbol.for("react.memo_cache_sentinel")?(We={scrollbarGutter:"stable both-edges"},e[71]=We):We=e[71];let Me;e[72]!==xe?(Me=xe?n.jsx("div",{className:"flex items-center justify-center",children:n.jsx(Nn,{className:"text-token-text-secondary"})}):null,e[72]=xe,e[73]=Me):Me=e[73];let _e;e[74]!==t||e[75]!==C||e[76]!==p||e[77]!==v?(_e=(C!=null?C:[]).map(($,P)=>{const ae=P>0&&C!=null&&Qt(C[P-1],$),ge=P>0&&C!=null&&Vt($,C[P-1])&&!ae,ze=C!=null&&P<C.length-1&&Vt($,C[P+1])&&!Qt($,C[P+1]);return[ae?n.jsx(Es,{date:$.createdAt},"ts-".concat($.id)):null,n.jsx(Vl,{calpicoMessage:$,roomId:t,groupWithPrevious:ge,groupWithNext:ze,stopMainScroll:v,mainScrollRef:p},$.id)]}),e[74]=t,e[75]=C,e[76]=p,e[77]=v,e[78]=_e):_e=e[78];let Ne;e[79]!==G||e[80]!==t?(Ne=G!=null?n.jsx(wl,{roomId:t}):null,e[79]=G,e[80]=t,e[81]=Ne):Ne=e[81];let Te;e[82]!==y||e[83]!==Me||e[84]!==_e||e[85]!==Ne?(Te=n.jsx(mo,{fullHeight:!0,horizontalPadding:"standard",children:n.jsx(Ot,{children:n.jsxs("div",{className:"relative flex min-h-full grow flex-col justify-start gap-2 py-6",style:We,ref:y,children:[Me,_e,Ne]})})}),e[82]=y,e[83]=Me,e[84]=_e,e[85]=Ne,e[86]=Te):Te=e[86];let we;e[87]!==p||e[88]!==Te?(we=n.jsx("div",{className:"thread-xl:pt-(--header-height) flex-1 overflow-y-scroll",ref:p,children:Te}),e[87]=p,e[88]=Te,e[89]=we):we=e[89];let ke;e[90]!==t||e[91]!==b?(ke=n.jsx(Ns,{roomId:t,scrollToBottom:b}),e[90]=t,e[91]=b,e[92]=ke):ke=e[92];let Ie;e[93]!==ye?(Ie=ye.formatMessage({id:"ISN8OO",defaultMessage:"ChatGPT can make mistakes. Check important info. Your personal ChatGPT memory is never used in group chats."}),e[93]=ye,e[94]=Ie):Ie=e[94];let Ee;e[95]!==Ie?(Ee=n.jsx("div",{className:"text-token-text-secondary relative mt-auto flex min-h-8 w-full items-center justify-center p-2 text-center text-xs text-pretty",children:n.jsx("p",{children:Ie})}),e[95]=Ie,e[96]=Ee):Ee=e[96];let Re;e[97]!==ke||e[98]!==Ee?(Re=n.jsx("div",{children:n.jsxs(Ot,{children:[ke,Ee]})}),e[97]=ke,e[98]=Ee,e[99]=Re):Re=e[99];let Ae;e[100]!==Ce||e[101]!==we||e[102]!==Re?(Ae=n.jsx(Nl,{className:"min-w-0 grow",children:n.jsxs("section",{className:"flex h-screen flex-col",children:[Ce,we,Re]})}),e[100]=Ce,e[101]=we,e[102]=Re,e[103]=Ae):Ae=e[103];let $e;e[104]!==l||e[105]!==(r==null?void 0:r._oai_internal_roomSystemInstructions)||e[106]!==(r==null?void 0:r._oai_internal_speakDecisionToolDescription)||e[107]!==t?($e=null,e[104]=l,e[105]=r==null?void 0:r._oai_internal_roomSystemInstructions,e[106]=r==null?void 0:r._oai_internal_speakDecisionToolDescription,e[107]=t,e[108]=$e):$e=e[108];let De;e[109]!==r?(De=r?n.jsx(Ll,{room:r}):null,e[109]=r,e[110]=De):De=e[110];let Pe;e[111]!==De?(Pe=n.jsx(rs,{children:De}),e[111]=De,e[112]=Pe):Pe=e[112];let Fe;e[113]!==Ae||e[114]!==$e||e[115]!==Pe?(Fe=n.jsxs("div",{className:"@container/thread flex h-screen",children:[Ae,$e,Pe]}),e[113]=Ae,e[114]=$e,e[115]=Pe,e[116]=Fe):Fe=e[116];let Ke;return e[117]!==t||e[118]!==Fe?(Ke=n.jsx(Cs,{roomId:t,children:Fe},t),e[117]=t,e[118]=Fe,e[119]=Ke):Ke=e[119],Ke}function Yl(o){"use forget";const e=A.c(2),{accountUserId:t}=o,s=ds(t);let i;return e[0]!==s?(i=n.jsx("span",{className:"text-token-text-secondary text-xs",children:s}),e[0]=s,e[1]=i):i=e[1],i}function Vl(o){"use forget";var j,x,S,_,T,w,k;const e=A.c(116),{calpicoMessage:t,roomId:s,groupWithPrevious:i,groupWithNext:l,stopMainScroll:a,mainScrollRef:r}=o,u=W(),m=cs(u).locale,f=te();let c;e[0]!==u?(c=he(u),e[0]=u,e[1]=c):c=e[1];const g=c;let y;e[2]!==g?(y=()=>g.messageDebugMode$(),e[2]=g,e[3]=y):y=e[3],z(y);let p;e[4]!==g||e[5]!==s?(p=()=>{const M=g.rooms$().get(s);return M?M.shouldInsertHeader$():!1},e[4]=g,e[5]=s,e[6]=p):p=e[6];const b=z(p),d=t,v=Ze(u),h=(j=v==null?void 0:v.normalizedAccountUserId)!=null?j:null;switch(d.role){case"user":{const M=d.accountUserId===h,C=!!((x=d.content.attachments)!=null&&x.length);let E;e[10]!==d.reactions?(E=Object.keys(d.reactions),e[10]=d.reactions,e[11]=E):E=e[11];const D=E.length>0;if(M){const q=(S=d.requestId)!=null?S:d.id,Y=!l&&"mb-4",de=D&&"mb-2";let Z;e[12]!==Y||e[13]!==de?(Z=V("group/message relative flex flex-col items-end gap-1",Y,de),e[12]=Y,e[13]=de,e[14]=Z):Z=e[14];let ee;e[15]!==d.replyTo?(ee=d.replyTo?n.jsx(it,{targetMessage:(_=d.replyTo.message)!=null?_:null}):null,e[15]=d.replyTo,e[16]=ee):ee=e[16];let ue;e[17]===Symbol.for("react.memo_cache_sentinel")?(ue=["addReaction","reply","delete"],e[17]=ue):ue=e[17];let Q;e[18]!==d||e[19]!==s?(Q=n.jsx(lt,{roomId:s,message:d,className:"radix-state-open:opacity-100 opacity-0 group-hover/message:opacity-100",enabledActions:ue}),e[18]=d,e[19]=s,e[20]=Q):Q=e[20];let fe;e[21]!==C||e[22]!==d||e[23]!==s?(fe=C?n.jsx(Xe,{message:d,roomId:s}):null,e[21]=C,e[22]=d,e[23]=s,e[24]=fe):fe=e[24];let le;e[25]!==C||e[26]!==d.content.text?(le=d.content.text?n.jsx("div",{className:V("group/message user-message-bubble-color relative max-w-full rounded-ss-3xl rounded-b-3xl px-4 py-2.5",C?"rounded-se-lg":"rounded-se-3xl"),children:n.jsx(Kt,{text:d.content.text})}):null,e[25]=C,e[26]=d.content.text,e[27]=le):le=e[27];let pe;e[28]!==d||e[29]!==s?(pe=n.jsx(at,{roomId:s,message:d,className:"absolute end-3 -bottom-4 z-10"}),e[28]=d,e[29]=s,e[30]=pe):pe=e[30];let be;e[31]!==f||e[32]!==d.deliveryErrorMessage||e[33]!==d.deliveryState?(be=d.deliveryState==="failed"?n.jsx("p",{className:"text-token-text-error mt-1 text-end text-xs",role:"alert",children:(T=d.deliveryErrorMessage)!=null?T:f.formatMessage({id:"PTNnih",defaultMessage:"Failed to send message."})}):null,e[31]=f,e[32]=d.deliveryErrorMessage,e[33]=d.deliveryState,e[34]=be):be=e[34];let xe;e[35]!==fe||e[36]!==le||e[37]!==pe||e[38]!==be?(xe=n.jsxs("div",{className:"relative flex max-w-4/5 flex-col items-end justify-end",children:[fe,le,pe,be]}),e[35]=fe,e[36]=le,e[37]=pe,e[38]=be,e[39]=xe):xe=e[39];let ye;e[40]!==Q||e[41]!==xe?(ye=n.jsxs("div",{className:"flex w-full flex-row items-center justify-end gap-2",children:[Q,xe]}),e[40]=Q,e[41]=xe,e[42]=ye):ye=e[42];let je;return e[43]!==d.id||e[44]!==ye||e[45]!==q||e[46]!==Z||e[47]!==ee?(je=n.jsxs("div",{className:Z,"data-message-id":d.id,children:[ee,ye]},q),e[43]=d.id,e[44]=ye,e[45]=q,e[46]=Z,e[47]=ee,e[48]=je):je=e[48],je}const B=!l&&"mb-4",O=D&&"mb-3";let L;e[49]!==B||e[50]!==O?(L=V("group/message flex gap-2",B,O),e[49]=B,e[50]=O,e[51]=L):L=e[51];let F;e[52]!==l||e[53]!==d.accountUserId?(F=l?n.jsx("div",{className:"h-7 w-7 flex-shrink-0"}):n.jsx("div",{className:"gizmo-shadow-stroke h-7 w-7 flex-shrink-0 self-end rounded-full",children:n.jsx(vs,{accountUserId:d.accountUserId,allowViewingProfile:!0,size:"medium"})}),e[52]=l,e[53]=d.accountUserId,e[54]=F):F=e[54];const H=i?null:n.jsx("div",{className:"flex w-full items-center ps-4",children:n.jsxs("div",{children:[n.jsx(Yl,{accountUserId:d.accountUserId}),n.jsx("span",{className:"text-token-text-secondary ms-2 text-xs opacity-0 group-hover/message:opacity-100",title:d.createdAt.toLocaleString(m),children:d.createdAt.toLocaleTimeString(m,{hour:"numeric",minute:"2-digit"})})]})});let se;e[55]!==d.replyTo?(se=d.replyTo?n.jsx(it,{targetMessage:(w=d.replyTo.message)!=null?w:null}):null,e[55]=d.replyTo,e[56]=se):se=e[56];let K;e[57]!==C||e[58]!==d||e[59]!==s?(K=C?n.jsx(Xe,{message:d,roomId:s}):null,e[57]=C,e[58]=d,e[59]=s,e[60]=K):K=e[60];let X;e[61]!==C||e[62]!==d.content.text?(X=d.content.text?n.jsx("div",{className:V("group/message bg-token-bg-tertiary relative max-w-full rounded-ss-3xl rounded-b-3xl px-4 py-2.5",C?"rounded-se-lg":"rounded-se-3xl"),children:n.jsx(Kt,{text:d.content.text})}):null,e[61]=C,e[62]=d.content.text,e[63]=X):X=e[63];let J;e[64]!==d||e[65]!==s?(J=n.jsx(at,{roomId:s,message:d,className:"absolute end-3 -bottom-4 z-10"}),e[64]=d,e[65]=s,e[66]=J):J=e[66];let oe;e[67]!==K||e[68]!==X||e[69]!==J?(oe=n.jsxs("div",{className:"relative flex max-w-4/5 flex-col justify-start",children:[K,X,J]}),e[67]=K,e[68]=X,e[69]=J,e[70]=oe):oe=e[70];let me;e[71]===Symbol.for("react.memo_cache_sentinel")?(me=["addReaction","reply","report"],e[71]=me):me=e[71];let R;e[72]!==d||e[73]!==s?(R=n.jsx(lt,{roomId:s,message:d,className:"radix-state-open:opacity-100 opacity-0 group-hover/message:opacity-100",enabledActions:me}),e[72]=d,e[73]=s,e[74]=R):R=e[74];let I;e[75]!==oe||e[76]!==R?(I=n.jsxs("div",{className:"flex w-full flex-row items-center justify-start gap-2",children:[oe,R]}),e[75]=oe,e[76]=R,e[77]=I):I=e[77];let U;e[78]!==se||e[79]!==I||e[80]!==H?(U=n.jsxs("div",{className:"flex grow flex-col items-start gap-1",children:[H,se,I]}),e[78]=se,e[79]=I,e[80]=H,e[81]=U):U=e[81];let G;return e[82]!==d.id||e[83]!==U||e[84]!==L||e[85]!==F?(G=n.jsxs("div",{className:L,"data-message-id":d.id,children:[F,U]}),e[82]=d.id,e[83]=U,e[84]=L,e[85]=F,e[86]=G):G=e[86],G}case"assistant":{const M=i?null:n.jsx("div",{className:"mb-1 flex w-full items-center justify-between",children:n.jsxs("div",{children:[n.jsx(Ql,{modelSlug:d.modelSlug}),n.jsx("span",{className:"text-token-text-secondary ms-2 text-xs opacity-0 group-hover/message:opacity-100",title:d.createdAt.toLocaleString(m),children:d.createdAt.toLocaleTimeString(m,{hour:"numeric",minute:"2-digit"})})]})});let C;e[87]!==d.replyTo?(C=d.replyTo?n.jsx(it,{targetMessage:(k=d.replyTo.message)!=null?k:null}):null,e[87]=d.replyTo,e[88]=C):C=e[88];let E;e[89]!==r||e[90]!==d||e[91]!==s||e[92]!==a?(E=n.jsx("div",{className:"relative max-w-full min-w-0 shrink",children:n.jsx(yl,{message:d,roomId:s,stopMainScroll:a,mainScrollRef:r})}),e[89]=r,e[90]=d,e[91]=s,e[92]=a,e[93]=E):E=e[93];let D;e[94]!==M||e[95]!==C||e[96]!==E?(D=n.jsxs("div",{className:"relative flex grow flex-col",children:[M,C,E]}),e[94]=M,e[95]=C,e[96]=E,e[97]=D):D=e[97];let B;e[98]!==d||e[99]!==s?(B=Object.keys(d.reactions).length>0?n.jsx("div",{className:"flex",children:n.jsx(at,{roomId:s,message:d})}):null,e[98]=d,e[99]=s,e[100]=B):B=e[100];let O;e[101]===Symbol.for("react.memo_cache_sentinel")?(O=["addReaction","reply","delete"],e[101]=O):O=e[101];let L;e[102]!==d||e[103]!==s?(L=n.jsx(lt,{roomId:s,message:d,className:"radix-state-open:opacity-100 opacity-0 group-hover/message:opacity-100",enabledActions:O}),e[102]=d,e[103]=s,e[104]=L):L=e[104];let F;return e[105]!==d.id||e[106]!==L||e[107]!==D||e[108]!==B?(F=n.jsxs("div",{className:"group/message","data-message-id":d.id,children:[D,B,L]}),e[105]=d.id,e[106]=L,e[107]=D,e[108]=B,e[109]=F):F=e[109],F}case"system":{let M;return e[110]!==g||e[111]!==u||e[112]!==d||e[113]!==s||e[114]!==b?(M=n.jsx(Xl,{message:d,roomId:s,ctx:u,calpicoState:g,shouldInsertHeader:b}),e[110]=g,e[111]=u,e[112]=d,e[113]=s,e[114]=b,e[115]=M):M=e[115],M}}}function Ql(o){"use forget";const e=A.c(11),{modelSlug:t}=o,s=W();let i;e[0]!==s?(i=()=>wn(s,{isGizmo:!1}),e[0]=s,e[1]=i):i=e[1];const l=z(i);let a;e:{if(t!=null){let f;if(e[2]!==t||e[3]!==l.categories){let y;e[5]!==t?(y=p=>{const{defaultModel:b}=p;return b===t},e[5]=t,e[6]=y):y=e[6],f=l.categories.find(y),e[2]=t,e[3]=l.categories,e[4]=f}else f=e[4];const c=f,g=c==null?void 0:c.shortLabel;if(g){a="ChatGPT ".concat(g);break e}}a="ChatGPT"}const r=a;if(Je(s,"1987254067")){let f;return e[7]!==r?(f=n.jsx("span",{className:"text-token-text-secondary text-xs",children:r}),e[7]=r,e[8]=f):f=e[8],f}let m;return e[9]!==r?(m=n.jsx("span",{className:"text-token-text-secondary text-xs",title:r,children:"ChatGPT"}),e[9]=r,e[10]=m):m=e[10],m}function Xl(o){"use forget";const e=A.c(23),{message:t,roomId:s,ctx:i,calpicoState:l,shouldInsertHeader:a}=o,r=t.content.type==="create_magic_link"||t.content.type==="create_chat"&&!a,u=te();let m;e[0]!==u?(m=u.formatMessage({id:"HYPzFm",defaultMessage:"Invite with link"}),e[0]=u,e[1]=m):m=e[1];const f=m;let c;e[2]!==u?(c=u.formatMessage({id:"e7LaZn",defaultMessage:"Your personal ChatGPT memory is never used in group chats."}),e[2]=u,e[3]=c):c=e[3];const g=c;let y;e[4]!==t.content.type||e[5]!==t.createdAt||e[6]!==t.id?(y=t.content.type==="create_chat"?n.jsx("div",{className:"mb-3",children:n.jsx(Es,{date:t.createdAt},"ts-".concat(t.id))}):null,e[4]=t.content.type,e[5]=t.createdAt,e[6]=t.id,e[7]=y):y=e[7];let p;e[8]===Symbol.for("react.memo_cache_sentinel")?(p={p:Zl,strong:Jl},e[8]=p):p=e[8];let b;e[9]!==t.content.text?(b=n.jsx("div",{className:"self-center",children:n.jsx("div",{className:"flex items-center justify-center gap-1.5",children:n.jsx(js,{components:p,children:t.content.text})})}),e[9]=t.content.text,e[10]=b):b=e[10];let d;e[11]!==l||e[12]!==i||e[13]!==g||e[14]!==s||e[15]!==f||e[16]!==r?(d=r?n.jsxs("div",{className:"mt-4 self-center text-center",children:[n.jsx("p",{className:"text-token-text-secondary text-xs",children:g}),n.jsx(as,{color:"secondary",className:"mt-4 mb-2",contentWrapperClassName:"text-xs font-semibold",label:f,onClick:()=>{const h=l.rooms$().get(s);h&&ne(i,bs,{room:h})},children:f})]}):null,e[11]=l,e[12]=i,e[13]=g,e[14]=s,e[15]=f,e[16]=r,e[17]=d):d=e[17];let v;return e[18]!==t.id||e[19]!==y||e[20]!==b||e[21]!==d?(v=n.jsxs("div",{className:"self-center","data-message-id":t.id,children:[y,b,d]}),e[18]=t.id,e[19]=y,e[20]=b,e[21]=d,e[22]=v):v=e[22],v}function Jl(o){const{children:e}=o;return n.jsx("strong",{className:"font-semibold",children:e})}function Zl(o){const{children:e}=o;return n.jsx("p",{className:"text-token-text-secondary text-center text-xs wrap-anywhere",children:e})}const ei=()=>null,ti=()=>!1,si=Ds(function(){"use forget";const e=A.c(1);let t;return e[0]===Symbol.for("react.memo_cache_sentinel")?(t=n.jsxs(n.Fragment,{children:[n.jsx("meta",{name:"robots",content:"noindex,nofollow"}),n.jsx(Wl,{})]}),e[0]=t):t=e[0],t});export{ei as clientLoader,si as default,ti as shouldRevalidate};
//# sourceMappingURL=vdespolxdiu4r404.js.map
