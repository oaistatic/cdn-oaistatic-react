var no=Object.freeze,oo=Object.defineProperty,jr=Object.defineProperties;var zr=Object.getOwnPropertyDescriptors;var so=Object.getOwnPropertySymbols;var Hr=Object.prototype.hasOwnProperty,$r=Object.prototype.propertyIsEnumerable;var Rs=(t,e,n)=>e in t?oo(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,me=(t,e)=>{for(var n in e||(e={}))Hr.call(e,n)&&Rs(t,n,e[n]);if(so)for(var n of so(e))$r.call(e,n)&&Rs(t,n,e[n]);return t},qe=(t,e)=>jr(t,zr(e));var ro=(t,e,n)=>Rs(t,typeof e!="symbol"?e+"":e,n);var Ts=(t,e)=>no(oo(t,"raw",{value:no(e||t.slice())}));import{r as g,i as Gr,c as tt,h as At,j as k,e as xs,o as Wr,M as Yo}from"./mw35uwhq4g8r9eam.js";import{P as Ur,S as qr,a as Kr,h as Yr,r as io,u as Xr}from"./mojznsm1zll43nmv.js";import{fd as Xo,bP as Ze,ux as Lt,mE as Sn,pr as Ge,uO as Wt,uY as yt,uZ as ln,ur as he,y1 as Vr,a as Qr,yy as Zr,yE as Jr,pq as dn,R as ei,A as ti,u as _n,p as Vo,cC as Qo,d as js,J as bn,aV as ni,fg as cs,cB as Zo,cF as ue,L as si,eu as fn,a4 as oi,yF as ri,gr as ii,k1 as Jo,k3 as er,k2 as tr,k0 as nr,k8 as sr,mn as ai,na as li,yG as ci,du as ui,eG as di,is as or,cA as rr,sZ as ao,yH as lo,e5 as fi,yI as gi,ek as mi,kh as hi,mx as pi,uR as bi,uP as yi,y3 as Ei,uE as xi}from"./d0xa318sl7ywi0za.js";import{As as ds,At as Gt,Au as Mi,Av as Si,Aw as ki,iv as wi,iw as Ii,ag as _i,ah as Ri,Ax as zs,bI as Ti,hw as Ci,qN as ir,Ay as ar,b5 as co,Az as Ni,AA as Pi,AB as vi,AC as Ai,AD as Li,AE as Di,b4 as Oi,eB as Fi,hQ as Cs,bs as sn,br as Ns,AF as uo}from"./g2euln7v5pbm31qa.js";import{f as Bi,P as lr,H as yn,L as ji,R as zi,T as Hi}from"./b9m0h1g72p9whl0h.js";import{M as $i,N as Gi,E as Wi,S as Ui}from"./f76gy0b8ieo4s693.js";import{c as qi,d as Ki,B as As,e as Yi,b as Xi,H as Vi,f as Qi,I as Ls,L as Zi,O as Hs,U as $s,S as Ji,T as ea,g as ta,h as na,C as sa,s as oa,i as ra,t as ia}from"./l57v5lxkpqo9adh3.js";import{f as aa}from"./obs7vyhux2j83kng.js";import{r as la,c as ca,d as ua,e as da}from"./kcex4rnzaebpwef1.js";import{r as fa}from"./kbj1b07s2z6vxqkg.js";import{r as ga}from"./oj9zwxa6l3kpv1x2.js";import{a as ma}from"./iakh052vusklquwn.js";import{S as ha,a as pa}from"./e0d69s7tsq37k47r.js";import{b as fs,S as cr,R as ur,a as fo}from"./ehv2vkvc6wjiqj3r.js";import{Z as Ms,T as Gs}from"./ce3hgmw4iyyhicud.js";import{u as ba}from"./c8dilzb1umlthpuq.js";import{c as ya}from"./e1t6unu3olubcgkg.js";var dr=(t=>(t.STANDARD="standard",t.EMAIL="email",t.CREATIVE="creative",t.CHAT_MESSAGE="chat_message",t.SOCIAL_POST="social_post",t.UNKNOWN="unknown",t))(dr||{});function lu(t){return Object.values(dr).includes(t)?t:"unknown"}var kn=(t=>(t.TOOLBAR="toolbar",t.FULLSCREEN_COMPOSER="fullscreen-composer",t))(kn||{});const Ea=g.createContext(void 0);function xa(){"use forget";const t=g.useContext(Ea);if(!t)throw new Error("useWritingBlockMessageContext must be used within a WritingBlockMessageContext");return t}const fr=Xo(()=>{const t=Ze(!1),e=Ze(null);return{isLoading$:t,currentAIOperation$:e}}),Ma=t=>fr(t).currentAIOperation$,Sa=t=>fr(t).isLoading$,go=(t,e)=>{Ma(t).set(e)},mo=(t,e)=>{Sa(t).set(e)},ka=new Set(["list","ordered_list"]);function wa(t){var n;const e=t.nodes.regular_list_item;if(e)return e;for(const s of Object.values(t.nodes))if(((n=s.spec.group)!=null?n:"").split(/\s+/).filter(Boolean).includes("list_item"))return s;return null}function gr(t){const{selection:e}=t;return e.empty&&e.$from.parent.isTextblock&&e.$from.parentOffset===0}function mr(t){return t?ka.has(t.type.name):!1}function hr(t,e,n){var a;if(!e||n===0)return t;const s=l=>l.map(c=>{if(c.type!==e)return c;const d=Number(c.attrs.start),f=Number(c.attrs.end),h=me({},c.attrs);return Number.isFinite(d)&&(h.start=d+n),Number.isFinite(f)&&(h.end=f+n),e.create(h)});if(t.isText)return t.mark(s(t.marks));const o=(a=t.marks)!=null?a:[];if(t.isInline&&o.length>0)return t.mark(s(o));if(t.childCount===0)return t;let r=!1;const i=[];for(let l=0;l<t.childCount;l+=1){const c=t.child(l),d=hr(c,e,n);d!==c&&(r=!0),i.push(d)}return r?t.copy(Ge.fromArray(i)):t}function Ia(t,e){let n=!1;return t.descendants(s=>{if(!s.isText)return!n;for(const o of s.marks)if(o.type!==e)return n=!0,!1;return!n}),n}function ho(t,e){let n=null,s=null;return t.descendants(o=>{if(!o.isText)return!0;for(const r of o.marks){if(r.type!==e)continue;const i=Number(r.attrs.start),a=Number(r.attrs.end);if(!(!Number.isFinite(i)||!Number.isFinite(a))){n=n==null?i:Math.min(n,i),s=s==null?a:Math.max(s,a);break}}return!0}),n==null||s==null?null:{start:n,end:s}}function _a(t,e,n){if(!gr(t))return!1;const{$from:s}=t.selection;for(let o=s.depth;o>0;o-=1)if(s.node(o).type===n)return Bi(n)(t,e);return!1}function pr(t,e,n){let s=t+1;for(let o=0;o<n;o+=1)s+=e.child(o).nodeSize;return s}function Ra(t,e){for(let n=t.childCount-1;n>=0;n-=1){const s=t.child(n),o=pr(e,t,n);if(s.type.isTextblock)return{node:s,start:o};if(mr(s)){const r=br(s,o);if(r)return r}}return null}function br(t,e){for(let n=t.childCount-1;n>=0;n-=1){const s=t.child(n),o=pr(e,t,n),r=Ra(s,o);if(r)return r}return null}function Ta(t,e){var D,K,H;const{selection:n,schema:s}=t;if(!gr(t))return!1;const o=s.nodes.paragraph;if(!o)return!1;const{$from:r}=n;if(r.parent.type!==o||r.depth!==1)return!1;const i=r.before(1),a=r.after(1),l=t.doc.childBefore(i);if(!l.node||!mr(l.node))return!1;const c=l.node,d=i-c.nodeSize,f=br(c,d);if(!f)return!1;const{node:h,start:u}=f,E=u+h.nodeSize-1,m=r.parent,p=(D=s.marks.startend)!=null?D:null,S=p!=null?ho(h,p):null,x=p!=null?ho(m,p):null,N=x!=null&&S!=null?Math.max(0,x.end-x.start):m.textContent.length,A=a-i,R=N-A,T=x!=null?x.start+R:null,b=x!=null?x.end+R:S!=null?S.end+N:null,y=t.tr;y.delete(i,a);const I=y.mapping.map(E,-1);if(m.content.size===0)return e&&(y.setSelection(Sn.create(y.doc,I)),e(y.scrollIntoView())),!0;let v=m.content;if(R!==0&&p!=null){const j=[];for(let B=0;B<m.childCount;B+=1)j.push(hr(m.child(B),p,R));v=Ge.fromArray(j)}y.insert(I,v);const w=y.mapping.map(u+1,-1),L=y.doc.resolve(w),_=L.parent,F=[];S&&Number.isFinite(S.end)&&F.push(S.end),typeof b=="number"&&Number.isFinite(b)&&F.push(b);const G=F.length>0?Math.max(...F):null;if(G!=null){for(let B=1;B<=L.depth;B+=1){const z=L.node(B),W=(K=z.attrs)!=null?K:{},J=L.before(B);y.setNodeMarkup(J,z.type,qe(me({},W),{end:G}))}const j=Number((H=y.doc.attrs)==null?void 0:H.end);if(Number.isFinite(j)&&R!==0?y.setDocAttribute("end",j+R):!Number.isFinite(j)&&G!=null&&y.setDocAttribute("end",G),p!=null&&S!=null&&b!=null&&!Ia(_,p)){const B=_.content.size;if(B>0){const z=w+B,W=[];Number.isFinite(S.start)&&W.push(S.start),typeof T=="number"&&Number.isFinite(T)&&W.push(T);const J=W.length>0?Math.min(...W):S.start,U=p.create({start:J,end:Math.max(S.end,b)});y.removeMark(w,z,p),y.addMark(w,z,U)}}}return e&&(y.setSelection(Sn.create(y.doc,I)),e(y.scrollIntoView())),!0}const Ca=(t,e)=>{const n=wa(t.schema);return n?_a(t,e,n)||Ta(t,e):!1};function Na(){return new Lt({props:{handleKeyDown(t,e){return e.defaultPrevented||e.key!=="Backspace"||e.metaKey||e.ctrlKey||e.altKey?!1:Ca(t.state,t.dispatch)}}})}const Pa="data-writing-block-empty-placeholder",va="paragraph",En=new Wt("writingBlockEmptyNodePlaceholder");function Aa(t,e){return new Lt({key:En,state:{init(n,s){return{decorations:bo(s.doc,s.selection,t,e),isDisabled:t,placeholderText:e}},apply(n,s){var a,l,c,d;const o=n.getMeta(En),r=(l=(a=po(o)?o.isDisabled:void 0)!=null?a:s.isDisabled)!=null?l:t,i=(d=(c=po(o)?o.placeholderText:void 0)!=null?c:s.placeholderText)!=null?d:e;return!n.docChanged&&!n.selectionSet&&r===s.isDisabled&&i===s.placeholderText?s:{decorations:bo(n.doc,n.selection,r,i),isDisabled:r,placeholderText:i}}},props:{decorations(n){var s,o;return(o=(s=En.getState(n))==null?void 0:s.decorations)!=null?o:null}}})}function La(t,e){return t.setMeta(En,e)}function po(t){return typeof t=="object"&&t!=null&&(Object.prototype.hasOwnProperty.call(t,"isDisabled")||Object.prototype.hasOwnProperty.call(t,"placeholderText"))}function bo(t,e,n,s){if(n||!e.empty)return yt.empty;const o=Da(e,s);return o?yt.create(t,[o]):yt.empty}function Da(t,e){const n=t.$from.parent;if(!n.isTextblock||n.type.name!==va||n.content.size>0)return null;const s=t.$from.before();if(typeof s!="number")return null;const o=s+n.nodeSize;return ln.node(s,o,{[Pa]:e})}const cn="generateSuggestionId";class Ws extends $i{static proseMirrorMarkName(){return"generate_suggestion"}unistNodeName(){return Ws.proseMirrorMarkName()}unistToProseMirrorTest(){return!1}unistNodeToProseMirrorNodes(e){return[null]}proseMirrorMarkSpec(){return{inclusive:!0,attrs:{[cn]:{default:null}},parseDOM:[{tag:"span.writing-block-generate-suggestion",getAttrs:e=>e instanceof HTMLElement?{[cn]:e.getAttribute("data-generate-suggestion")}:!1}],toDOM(e){var r;const n=(r=e.attrs)==null?void 0:r[cn];return["span",{class:"writing-block-generate-suggestion","data-generate-suggestion":typeof n=="string"?n:""}]}}}processConvertedUnistNode(e){return e}}const Je=new Wt("writingBlockGenerate"),Ds=yt.empty,Oa={input:null,suggestion:null,decorations:Ds,lastResolvedSuggestionId:null,lastResolvedReason:null},Us=t=>typeof t=="object"&&t!=null,Fa=t=>Us(t)&&typeof t.anchorPos=="number"&&typeof t.caretPos=="number"&&typeof t.blockFrom=="number"&&typeof t.blockTo=="number"&&typeof t.triggerPos=="number",Ba=t=>Us(t)&&typeof t.id=="string"&&typeof t.from=="number"&&typeof t.to=="number",ja=t=>t==="accept"||t==="reject"||t==="cancel",za=t=>{if(!Us(t)||typeof t.type!="string")return!1;switch(t.type){case"set-suggestion":return Ba(t.suggestion);case"clear-suggestion":return ja(t.reason)&&(t.suggestionId==null||typeof t.suggestionId=="string");case"open-input":return Fa(t.input);case"close-input":return!0;default:return!1}},Ha=(t,e,n)=>{if(!e)return null;const s=t.map(e.anchorPos,1),o=t.map(e.caretPos,1),r=t.map(e.blockFrom,-1),i=t.map(e.blockTo,1),a=t.map(e.triggerPos,-1);return r<0||r>=n.content.size||i<r?null:{anchorPos:s,caretPos:o,blockFrom:r,blockTo:i,triggerPos:a}},$a=(t,e,n)=>{if(!e)return null;const s=n.type.schema.marks.generate_suggestion;if(!s)return null;const o=t.map(e.from,-1);if(o<0||o>=n.content.size)return null;const r=n.nodeAt(o);if(!r||!r.isText||!s.isInSet(r.marks))return null;const i=o+r.nodeSize;return i<=o?null:{id:e.id,from:o,to:i}},yo=t=>{const e=t.type.schema.marks.generate_suggestion;if(!e)return null;let n=null;return t.descendants((s,o)=>{var r;if(n)return!1;if(s.isText){const i=e.isInSet(s.marks);if(i){const a=(r=i.attrs)==null?void 0:r[cn];if(typeof a=="string"&&a.length>0)return n={id:a,from:o,to:o+s.nodeSize},!1}}return!0}),n},Ga=()=>new Lt({key:Je,state:{init:(t,e)=>{const n=yo(e.doc);return qe(me({},Oa),{suggestion:n})},apply(t,e){let n=e.decorations.map(t.mapping,t.doc),s=Ha(t.mapping,e.input,t.doc),o=$a(t.mapping,e.suggestion,t.doc),r=e.lastResolvedSuggestionId,i=e.lastResolvedReason;t.docChanged&&e.suggestion&&!o&&(r=e.suggestion.id,i="reject");const a=t.getMeta(Je),l=za(a)?a:null;t.docChanged&&(l==null?void 0:l.type)!=="set-suggestion"&&s&&(s=null),(l==null?void 0:l.type)==="open-input"?(s=l.input,r=null,i=null):(l==null?void 0:l.type)==="close-input"?s=null:(l==null?void 0:l.type)==="set-suggestion"?(o=l.suggestion,n=Ds,s=null,r=null,i=null):(l==null?void 0:l.type)==="clear-suggestion"&&(o?(r=o.id,i=l.reason):l.suggestionId&&(r=l.suggestionId,i=l.reason),o=null,n=Ds);const c=yo(t.doc);return c?(o=c,(l==null?void 0:l.type)!=="set-suggestion"&&(r=null,i=null)):(l==null?void 0:l.type)!=="set-suggestion"&&(l==null?void 0:l.type)!=="clear-suggestion"&&(o=null),{input:s,suggestion:o,decorations:n,lastResolvedSuggestionId:r,lastResolvedReason:i}}},props:{decorations(t){var e;return(e=Je.getState(t))==null?void 0:e.decorations}}}),Wa=(t,e)=>{const n={type:"open-input",input:e},s=t.state.tr.setMeta(Je,n);t.dispatch(s)},Eo=t=>{var r,i;const e=Je.getState(t.state);let n=t.state.tr;const s=(r=e==null?void 0:e.input)!=null?r:null;if(s){const a=n.doc,l=Math.max(0,Math.min(s.caretPos,a.content.size)),c=(i=he.findFrom(a.resolve(l),1,!0))!=null?i:he.near(a.resolve(l),1);n.selection.eq(c)||(n=n.setSelection(c))}const o={type:"close-input"};n=n.setMeta(Je,o),t.dispatch(n),t.hasFocus()||t.focus()},Ua=({view:t,pmu:e,suggestionId:n,text:s})=>{var I,v,w;const o=Je.getState(t.state);if(!(o!=null&&o.input))return!1;const i=(I=t.state.schema.marks.generate_suggestion)!=null?I:null;if(!i)return!1;const{caretPos:a,triggerPos:l,anchorPos:c}=o.input,d=e.parse(s!=null?s:"");if(d.content.size===0)return!1;let f=t.state.tr;const h=Math.max(c,a);l<h&&(f=f.delete(l,h));const u=L=>Math.max(0,Math.min(f.mapping.map(L),f.doc.content.size)),E=Math.min(c,a),m=Math.max(c,a),p=u(E),S=u(m);p<S&&(f=f.delete(p,S));const x=p,N=f.doc.resolve(x),A=d.childCount===1&&((v=d.firstChild)==null?void 0:v.type.name)==="paragraph",R=A?d.firstChild.content:d.content,T=N.parent.isTextblock&&N.parent.content.size===0;let b=x,y=0;if(T&&!A){const L=N.before(),_=N.after();f=f.replaceWith(L,_,R),b=L,y=R.size}else f=f.insert(x,R),b=x,y=R.size;if(y>0){const L=i.create({[cn]:n});f=f.addMark(b,b+y,L);const _=(w=he.findFrom(f.doc.resolve(b+y),1,!0))!=null?w:he.near(f.doc.resolve(b+y),1);f=f.setSelection(_),f.setMeta(ds,!0);const F={type:"set-suggestion",suggestion:{id:n,from:b,to:b+y}};return f.setMeta(Je,F),t.dispatch(f),!0}return!1},qa=(t,e)=>Va(t,e,"accept"),Ka=(t,e)=>{const n=yr(t.state,e).sort((r,i)=>i.from-r.from);if(n.length===0)return!1;let s=t.state.tr;n.forEach(({from:r,to:i})=>{const a=s.mapping.map(r),l=s.mapping.map(i);a>=l||(s=s.delete(a,l),Xa(s,a))});const o={type:"clear-suggestion",reason:"reject",suggestionId:e};return s=s.setMeta(Je,o),t.dispatch(s),!0},Ya=t=>{if(t.isLeaf)return!0;let e=!1;return t.descendants(n=>{var s;return e?!1:n.isLeaf||n.isText&&((s=n.text)!=null&&s.length)?(e=!0,!1):!0}),e},Xa=(t,e)=>{let n=e;for(;;){const s=Math.min(Math.max(n,0),t.doc.content.size),o=t.doc.resolve(s);if(o.depth===0)break;let r=!1;for(let i=o.depth;i>0;i--){const a=o.node(i);if(Ya(a))continue;const l=o.before(i),c=o.after(i);t.delete(l,c),n=Math.max(0,l),r=!0;break}if(!r)break}},Va=(t,e,n)=>{const s=t.state.schema.marks.generate_suggestion;if(!s)return!1;const o=yr(t.state,e);if(o.length===0)return!1;let r=t.state.tr;o.forEach(({from:l,to:c})=>{r=r.removeMark(l,c,s)});const i={type:"clear-suggestion",reason:n,suggestionId:e};r=r.setMeta(Je,i);const a=o[o.length-1];return a&&(r=r.setSelection(he.near(r.doc.resolve(a.to))),r=r.scrollIntoView()),t.dispatch(r),!0},yr=(t,e)=>{const n=t.schema.marks.generate_suggestion;if(!n)return[];const s=[];return t.doc.descendants((o,r)=>{var a;if(!o.isText)return!0;const i=n.isInSet(o.marks);return i&&((a=i.attrs)==null?void 0:a[cn])===e&&s.push({from:r,to:r+o.nodeSize}),!0}),s},gn="magicEditId",gs="magicEditHighlightFrom",ms="magicEditHighlightTo",wn="magicEditSegmentIndex",hs="magicEditSegmentStartOffset",ps="magicEditSegmentEndOffset";class Er extends Gi{unistToProseMirrorTest(){return!1}unistNodeToProseMirrorNodes(e){return[null]}createNodeSpec({role:e,contentEditable:n}){return{attrs:{[gn]:{default:null},[gs]:{default:null},[ms]:{default:null},[wn]:{default:null},[hs]:{default:null},[ps]:{default:null}},group:"block",content:"block*",isolating:!0,defining:!0,selectable:!1,allowGapCursor:!1,parseDOM:[],toDOM(s){var c,d;const o=(c=s.attrs)==null?void 0:c[gn],r=typeof o=="string"?o:"",i=(d=s.attrs)==null?void 0:d[wn],a=typeof i=="number"?String(i):typeof i=="string"?i:"",l={"data-me-role":e,"data-me-id":r,"data-magic-edit-block":"true"};return a!==""&&(l["data-me-segment"]=a),n||(l.contenteditable="false",l["aria-readonly"]="true"),["div",l,0]}}}}class qs extends Er{static proseMirrorNodeName(){return"magic_edit_original_block"}unistNodeName(){return qs.proseMirrorNodeName()}proseMirrorNodeSpec(){return this.createNodeSpec({role:"orig",contentEditable:!1})}proseMirrorNodeToUnistNodes(e,n){return n}}class Ks extends Er{static proseMirrorNodeName(){return"magic_edit_suggested_block"}unistNodeName(){return Ks.proseMirrorNodeName()}proseMirrorNodeSpec(){return this.createNodeSpec({role:"sugg",contentEditable:!0})}proseMirrorNodeToUnistNodes(){return[]}}class Qa extends Wi{constructor(n={}){super();ro(this,"options");this.options=n}dependencies(){let n=!1;try{n=Vr(Qr())}catch(s){}return[new qi,new lr,new Ki,new As,new Yi,new Xi,new yn,new Vi,new Qi,new Ls,new Zi,new ji,new Hs,new zi,new Hi,new $s,new Ji,new Ui,new ea,new ta,new na,new qs,new Ks,new Ws,...n?[new sa]:[]]}unifiedInitializationHook(n){var o;const s=(o=this.options.contentReferences)!=null?o:[];return n.use(fa).use(la).use(ga,{singleTilde:!1}).use(ma).use([[ca,s]]).use(ua).use(aa).use(da).use(oa).use(ra)}}const xo=new Map;function Za(t={}){var o,r;const e={shouldStripDirectives:(o=t.shouldStripDirectives)!=null?o:!1,contentReferences:(r=t.contentReferences)!=null?r:[]},n=JSON.stringify(e);let s=xo.get(n);if(s==null){const i=[new Qa({contentReferences:e.contentReferences})];t.shouldStripDirectives&&i.push(new qr),s=new Ur(i),xo.set(n,s)}return s}function Ja(t){return typeof t=="object"&&t!=null&&Object.prototype.hasOwnProperty.call(t,"maxLength")}const rn=new Wt("writingBlockInputConstraints");function el(t){return new Lt({key:rn,state:{init(){return{maxLength:t}},apply(e,n){const s=e.getMeta(rn);return Ja(s)?{maxLength:typeof s.maxLength=="number"?s.maxLength:null}:n}},props:{handleTextInput(e,n,s,o){var c;const r=rn.getState(e.state),i=(c=r==null?void 0:r.maxLength)!=null?c:null;if(i==null)return!1;const a=Mo(e.state,i,n,s);if(a<=0)return!0;if(o.length<=a)return!1;const l=o.slice(0,a);return l.length>0&&e.dispatch(e.state.tr.insertText(l,n,s)),!0},handlePaste(e,n){var h,u,E;const s=rn.getState(e.state),o=(h=s==null?void 0:s.maxLength)!=null?h:null;if(o==null)return!1;const r=n.clipboardData;if(!r)return!1;const i=r.getData("text/html"),a=(u=r.getData("text/plain"))!=null?u:"",{from:l,to:c}=e.state.selection,d=Mo(e.state,o,l,c);if(i){if(n.preventDefault(),d<=0)return!0;const m=new window.DOMParser().parseFromString(i,"text/html");ol(m.body);const p=(E=m.body.innerText)!=null?E:"";p.length>d&&(m.body.innerHTML="",m.body.append(document.createTextNode(p.slice(0,d))));const S=e.state.schema,x=Zr.fromSchema(S).parseSlice(m.body,{preserveWhitespace:!0});return e.dispatch(e.state.tr.replaceSelection(x)),!0}if(a.length===0)return!1;if(d<=0)return n.preventDefault(),!0;if(a.length<=d)return!1;n.preventDefault();const f=a.slice(0,d);return e.dispatch(e.state.tr.insertText(f,l,c)),!0}}})}function tl(t,e){return t.setMeta(rn,{maxLength:typeof e=="number"?e:null})}function Mo(t,e,n,s){const o=nl(t.doc),r=sl(t,n,s);return e-(o-r)}function nl(t){return t.textBetween(0,t.content.size,"\n","\n").length}function sl(t,e,n){return e===n?0:t.doc.textBetween(e,n,"\n","\n").length}function ol(t){const e=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT),n=[];for(;e.nextNode();){const s=e.currentNode;if(!(s instanceof HTMLElement))continue;const o=s;o.style&&(o.style.color="",o.style.backgroundColor="",o.style.fontFamily="",o.style.fontSize="",o.style.lineHeight="",o.style.textDecoration="",o.style.textShadow=""),(o.tagName==="SPAN"||o.tagName==="FONT")&&!o.hasAttributes()&&n.push(o)}for(const s of n.reverse()){const o=s.parentNode;if(o){for(;s.firstChild;)o.insertBefore(s.firstChild,s);o.removeChild(s)}}}function In(t,e){return rl(t)(e)}const rl=Xo(()=>Jr(t=>{const e=Ze(t),n=Ze(null),s=Ze(null),o=Ze(null),r=Ze(null),i=Ze(null),a=Ze(null),l=Ze(null),c=Ze([]),d=Ze("pending"),f=Ze(null),h=Ze([]);return{magicEditId$:e,domAnchor$:n,textAnchor$:s,baseBlockVersion$:o,freeformFeedback$:r,fullBlockBodyMarkdown$:i,startIndex$:a,endIndex$:l,replacements$:c,status$:d,modelSlug$:f,segmentDiffs$:h}})),il="_keyBindingTight_zq3qv_110",bs={"magic-edit-selection":"_magic-edit-selection_zq3qv_1",keyBindingTight:il};function al(t,e){var i;const s=((i=t.dom.ownerDocument)!=null?i:document).createRange(),o=t.domAtPos(e.from),r=t.domAtPos(e.to);return s.setStart(o.node,o.offset),s.setEnd(r.node,r.offset),s}function ll(t,e,n){const s=t.resolve(e);if(s.parent.inlineContent)return e;const o=he.findFrom(s,n,!0);return o?n<0?o.to:o.from:null}function Os(t,e,n,s,o){const r=ll(t,s,o);if(r==null)throw new Error("Unable to place selection marker.");const i=new dn(Ge.from(t.type.schema.text(n)),0,0),a=t.replace(r,r,i),c=e.serialize(a).indexOf(n);if(c===-1)throw new Error("Failed to locate selection marker in markdown.");return c}function cl(t,e){let n=null,s=null;return t.forEach((o,r)=>{const i=r,a=r+o.nodeSize,l=i+1,c=a-1;e.from<=c&&e.to>=l&&(n!=null||(n=i),s=a)}),n==null||s==null?{from:0,to:t.content.size}:{from:n,to:s}}function ul(t,e){const n=t.slice(e.from,e.to),s=t.type.create(null,n.content);if(!s)throw new Error("Failed to build document segment for magic edit selection.");return s}function xr({view:t,pmu:e,range:n}){const{state:s}=t,o=s.doc,r=cl(o,n),i={from:Math.max(0,n.from-r.from),to:Math.max(0,n.to-r.from)},a=ul(o,r),l=a.content.size,c=e.serialize(a),d=i.from<=0,f=i.to>=l,h=d?0:Os(a,e,"⟦MAGICSTART⟧",i.from,1),u=f?c.length:Os(a,e,"⟦MAGICEND⟧",i.to,-1);if(h>u)throw new Error("Failed to locate selection markers in markdown.");return{fullMarkdown:c,startIndex:h,endIndex:u,blockRange:r}}const et=new Wt("writingBlockMagicEdit");function xn(t,e,n){return Math.max(e,Math.min(n,t))}function So(t){return typeof t=="object"&&t!=null}function dl(t){if(t===void 0)return!0;if(!So(t))return!1;const{setPinnedRange:e,removeEntryId:n}=t,s=e==null||So(e)&&typeof e.from=="number"&&typeof e.to=="number",o=n==null||typeof n=="string";return s&&o}function Mr(t,e){if(!e)return null;const n=t.map(e.from,-1),s=t.map(e.to,1);return{from:n,to:s}}function ko(t,e){if(!e)return null;const n=Mr(t,e);return!n||n.to<=n.from?null:n}function Sr(t){var s,o;const e=(s=t.nodes.magic_edit_original_block)!=null?s:null,n=(o=t.nodes.magic_edit_suggested_block)!=null?o:null;return!e||!n?null:{originalType:e,suggestedType:n}}function wo(t){if(typeof t=="number")return Number.isFinite(t)?t:null;if(typeof t=="string"&&t.trim()!==""){const e=Number(t);return Number.isFinite(e)?e:null}return null}function Io(t){if(typeof t=="number")return Number.isFinite(t)?t:null;if(typeof t=="string"&&t.trim()!==""){const e=Number(t);return Number.isFinite(e)?e:null}return null}function fl(t,e){var i,a;const n=wo((i=t.attrs)==null?void 0:i[gs]),s=wo((a=t.attrs)==null?void 0:a[ms]);if(n==null||s==null)return null;const o=e+1+Math.max(0,n),r=e+1+Math.max(0,s);return r<=o?null:{from:o,to:r}}function Fs(t,e){if(!t)return null;const n=e.pos+1,s=e.pos+e.nodeSize-1,o=Math.max(n,t.from),r=Math.min(s,t.to);return r<=o?null:{from:o,to:r}}function _o(t){const e=Sr(t.type.schema);if(!e)return new Map;const n=new Map,s=r=>{if(typeof r=="number"&&Number.isFinite(r))return r;if(typeof r=="string"&&r.trim()!==""){const i=Number(r);if(Number.isFinite(i))return i}return 0};t.descendants((r,i)=>{var a,l,c,d;if(r.type===e.originalType||r.type===e.suggestedType){const f=(a=r.attrs)==null?void 0:a[gn];if(!f)return!1;const h=s((l=r.attrs)==null?void 0:l[wn]);let u=n.get(f);u||(u=new Map,n.set(f,u));let E=u.get(h);E||(E={},u.set(h,E));const m={pos:i,nodeSize:r.nodeSize},p=Fs(fl(r,i),m),S={position:m,highlight:p,selectionStartOffset:Io((c=r.attrs)==null?void 0:c[hs]),selectionEndOffset:Io((d=r.attrs)==null?void 0:d[ps])};return r.type===e.originalType?E.original=S:E.suggested=S,!1}return!0});const o=new Map;return n.forEach((r,i)=>{const a=[];if(r.forEach((d,f)=>{var h,u,E,m,p,S,x,N,A,R,T,b,y,I,v,w;!d.original&&!d.suggested||a.push({index:f,original:(u=(h=d.original)==null?void 0:h.position)!=null?u:null,suggested:(m=(E=d.suggested)==null?void 0:E.position)!=null?m:null,originalHighlight:(S=(p=d.original)==null?void 0:p.highlight)!=null?S:null,suggestedHighlight:(N=(x=d.suggested)==null?void 0:x.highlight)!=null?N:null,selectionStartOffset:(b=(T=(A=d.original)==null?void 0:A.selectionStartOffset)!=null?T:(R=d.suggested)==null?void 0:R.selectionStartOffset)!=null?b:0,selectionEndOffset:(w=(v=(y=d.original)==null?void 0:y.selectionEndOffset)!=null?v:(I=d.suggested)==null?void 0:I.selectionEndOffset)!=null?w:0})}),a.length===0)return;a.sort((d,f)=>d.index-f.index);let l=1/0,c=-1/0;a.forEach(d=>{d.original&&(l=Math.min(l,d.original.pos),c=Math.max(c,d.original.pos+d.original.nodeSize)),d.suggested&&(l=Math.min(l,d.suggested.pos),c=Math.max(c,d.suggested.pos+d.suggested.nodeSize))}),o.set(i,{id:i,from:l===1/0?0:l,to:c===-1/0?0:c,segments:a})}),o}function kr(t,e,n){const s=t.topNodeType.createAndFill({},Ge.from(n));return s?e.serialize(s):""}function Ro(t,e,n){if(!n||n.size===0)return"";const s=t.topNodeType.createAndFill({},n);return s?e.serialize(s):""}function To(t,e,n,s){try{return Os(t,e,"⟦MAGICSEG⟧",n,s)}catch(o){return-1}}const gl=new RegExp("\\s+(?=\\r?\\n|$)","gu");function wr(t){return t&&t.replace(gl,"")}function ml(t,e,n,s){const o=[];let r=e;for(let i=0;i<t.content.childCount;i++){const a=t.content.child(i),l=a.nodeSize,c=r,d=r+l,f=kr(s,n,a);o.push({node:a,from:c,to:d,normalizedText:wr(f),textLength:f.length}),r=d}return o}function hl(t,e,n){const s=[];for(let o=0;o<t.content.childCount;o++){const r=t.content.child(o),i=kr(n,e,r);s.push({node:r,normalizedText:wr(i)})}return s}function pl(t,e){const n=t.length,s=e.length;if(n===0&&s===0)return[];const o=Array.from({length:n+1},()=>Array(s+1).fill(0));for(let d=n-1;d>=0;d--)for(let f=s-1;f>=0;f--)t[d].normalizedText===e[f].normalizedText?o[d][f]=o[d+1][f+1]+1:o[d][f]=Math.max(o[d+1][f],o[d][f+1]);const r=[];let i=0,a=0,l=null;const c=()=>{l&&(r.push(l),l=null)};for(;i<n||a<s;){if(i<n&&a<s&&t[i].normalizedText===e[a].normalizedText){c(),i++,a++;continue}(a>=s||i<n&&o[i+1][a]>=o[i][a+1])&&i<n?(l||(l={origStart:i,origEnd:i,suggStart:a,suggEnd:a}),l.origEnd=i+1,i++):(l||(l={origStart:i,origEnd:i,suggStart:a,suggEnd:a}),l.suggEnd=Math.min(a+1,s),a++)}return c(),r}function bl(t,e,n,s){if(t.length===0)return[];const o=[0];for(const r of e){const i=o[o.length-1];o.push(i+r.textLength)}return t.map((r,i)=>{var u,E;const a=e.slice(r.origStart,r.origEnd),l=n.slice(r.suggStart,r.suggEnd);let c,d;if(a.length>0)c=a[0].from,d=a[a.length-1].to;else{const m=r.origStart<e.length?e[r.origStart].from:e.length>0?e[e.length-1].to:s;c=m,d=m}const f=a.length>0?Ge.fromArray(a.map(m=>m.node)):null,h=l.length>0?Ge.fromArray(l.map(m=>m.node)):null;return{from:c,to:d,originalFragment:f,suggestedFragment:h,index:i,selectionStartOffset:(u=o[r.origStart])!=null?u:0,selectionEndOffset:(E=o[r.origEnd])!=null?E:0}})}function yl({segmentStart:t,originalSize:e,suggestedSize:n,selectionStart:s,selectionEnd:o}){if(e<=0)return{originalHighlight:null,suggestedHighlight:null};const r=t,i=t+e,a=Math.max(r,s),l=Math.min(i,o);if(l<=a)return{originalHighlight:null,suggestedHighlight:null};const c={from:a-r,to:l-r};if(n<=0)return{originalHighlight:c,suggestedHighlight:null};const d=c.to-c.from,f=n-e,h=xn(c.from,0,Math.max(0,n)),u=xn(h+Math.max(0,d+f),h,Math.max(h,n));return{originalHighlight:c,suggestedHighlight:u>h?{from:h,to:u}:null}}function Co(t,e,n){const s=[];return e&&s.push(ln.inline(e.from,e.to,{class:"magic-edit-selection ".concat(bs["magic-edit-selection"])})),n.forEach(o=>{o.segments.forEach(r=>{r.originalHighlight&&s.push(ln.inline(r.originalHighlight.from,r.originalHighlight.to,{nodeName:"span","data-me-change":"delta"})),r.suggestedHighlight&&s.push(ln.inline(r.suggestedHighlight.from,r.suggestedHighlight.to,{nodeName:"span","data-me-change":"delta"}))})}),s.length===0?yt.empty:yt.create(t,s)}function El(){return new Lt({key:et,state:{init:(t,e)=>{const n=_o(e.doc);return{pinnedRange:null,entries:n,decorations:Co(e.doc,null,n)}},apply(t,e,n,s){let o=Mr(t.mapping,e.pinnedRange);const r=new Map;e.entries.forEach((f,h)=>{const u=new Map;f.segments.forEach(E=>{u.set(E.index,{originalHighlight:ko(t.mapping,E.originalHighlight),suggestedHighlight:ko(t.mapping,E.suggestedHighlight)})}),r.set(h,u)});const i=t.getMeta(et),a=dl(i)?i:void 0;a&&a.setPinnedRange!==void 0&&(o=a.setPinnedRange),a!=null&&a.removeEntryId&&r.delete(a.removeEntryId);const l=_o(s.doc),c=new Map;l.forEach((f,h)=>{if(a!=null&&a.removeEntryId&&a.removeEntryId===h)return;const u=r.get(h),E=f.segments.map(m=>{var N,A;const p=u==null?void 0:u.get(m.index);let S=null;m.original&&(S=Fs((N=p==null?void 0:p.originalHighlight)!=null?N:m.originalHighlight,m.original));let x=null;return m.suggested&&(x=Fs((A=p==null?void 0:p.suggestedHighlight)!=null?A:m.suggestedHighlight,m.suggested)),{index:m.index,original:m.original,suggested:m.suggested,originalHighlight:S,suggestedHighlight:x,selectionStartOffset:m.selectionStartOffset,selectionEndOffset:m.selectionEndOffset}});c.set(h,{id:f.id,from:f.from,to:f.to,segments:E})});const d=Co(s.doc,o,c);return{pinnedRange:o,entries:c,decorations:d}}},props:{decorations(t){var e,n;return(n=(e=et.getState(t))==null?void 0:e.decorations)!=null?n:yt.empty}}})}function xl(t){const{from:e,to:n}=t.state.selection;if(e===n)return!1;const s=t.state.tr;return s.setMeta(et,{setPinnedRange:{from:e,to:n}}),t.dispatch(s),!0}function Ml(t){const e=t.state.tr;e.setMeta(et,{setPinnedRange:null}),t.dispatch(e)}function Sl({ctx:t,view:e,pmu:n,magicEditId:s,replacementDoc:o,selection:r}){var T,b;const{state:i}=e,a=Sr(i.schema),l=In(t,s);if(!a)return!1;const c=xn(r.from,0,i.doc.content.size),d=xn(r.to,c,i.doc.content.size),f=i.doc.slice(0,i.doc.content.size),h=new dn(o.content,0,0),u=ml(f,0,n,i.schema),E=hl(h,n,i.schema),m=bl(pl(u,E),u,E,0);if(m.length===0)return!1;let p=i.tr,S=null;const x=[],N=c,A=d;let R=null;if(m.forEach(y=>{var U,P,$,X,M,Q,ne,q;const I=(U=y.originalFragment)==null?void 0:U.size,v=(P=y.suggestedFragment)==null?void 0:P.size,w=p.mapping.map(y.from,-1),L=I?p.mapping.map(y.to,1):w,_=R!=null&&!I?Math.max(w,R):w,F=I?L:_,G=(X=($=y.originalFragment)==null?void 0:$.size)!=null?X:0,D=(Q=(M=y.suggestedFragment)==null?void 0:M.size)!=null?Q:0,{originalHighlight:K,suggestedHighlight:H}=yl({segmentStart:y.from,originalSize:G,suggestedSize:D,selectionStart:N,selectionEnd:A}),j=[];if(I){const oe=a.originalType.create({[gn]:s,[wn]:y.index,[gs]:K?Math.floor(K.from):null,[ms]:K?Math.floor(K.to):null,[hs]:y.selectionStartOffset,[ps]:y.selectionEndOffset},y.originalFragment);j.push(oe)}if(v){const oe=a.suggestedType.create({[gn]:s,[wn]:y.index,[gs]:H?Math.floor(H.from):null,[ms]:H?Math.floor(H.to):null,[hs]:y.selectionStartOffset,[ps]:y.selectionEndOffset},y.suggestedFragment);j.push(oe)}if(j.length===0)return;const B=new dn(Ge.fromArray(j),0,0);p=p.replaceRange(_,F,B);const z=j.reduce((oe,ae)=>oe+ae.nodeSize,0);if(R=_+z,S==null&&v&&D>0){const oe=_+(I?j[0].nodeSize:0);S=Math.min(p.doc.content.size,oe+1)}const W=Ro(i.schema,n,(ne=y.originalFragment)!=null?ne:Ge.empty),J=Ro(i.schema,n,(q=y.suggestedFragment)!=null?q:Ge.empty);x.push({segmentIndex:y.index,startIndex:To(i.doc,n,y.from,1),endIndex:To(i.doc,n,y.to,-1),originalMarkdown:W,suggestedMarkdown:J})}),p.setMeta(ds,!0),p.setMeta(et,{setPinnedRange:null}),S!=null){const y=(T=he.findFrom(p.doc.resolve(S),1,!0))!=null?T:he.near(p.doc.resolve(S),1);p.setSelection(y)}else{const y=xn(c,0,p.doc.content.size),I=(b=he.findFrom(p.doc.resolve(y),-1,!0))!=null?b:he.near(p.doc.resolve(y),-1);p.setSelection(I)}return p.scrollIntoView(),e.dispatch(p),l.segmentDiffs$.set(x),!0}function kl(t,e,n){var d,f,h;const s=et.getState(t.state);if(!s)return;const o=s.entries.get(e);if(!o)return;const r=t.state.doc,i=o.segments.map(u=>{var x,N,A,R,T,b,y,I,v,w,L,_,F,G;const E=u.original?r.nodeAt(u.original.pos):null,m=u.suggested?r.nodeAt(u.suggested.pos):null;if(!E&&!m)return null;const p=Math.min((R=(A=(x=u.original)==null?void 0:x.pos)!=null?A:(N=u.suggested)==null?void 0:N.pos)!=null?R:0,(I=(y=(T=u.suggested)==null?void 0:T.pos)!=null?y:(b=u.original)==null?void 0:b.pos)!=null?I:0),S=Math.max(((v=u.original)==null?void 0:v.pos)!=null?u.original.pos+((w=E==null?void 0:E.nodeSize)!=null?w:0):p,((L=u.suggested)==null?void 0:L.pos)!=null?u.suggested.pos+((_=m==null?void 0:m.nodeSize)!=null?_:0):p);return{from:p,to:S,originalContent:(F=E==null?void 0:E.content)!=null?F:Ge.empty,suggestedContent:(G=m==null?void 0:m.content)!=null?G:Ge.empty}}).filter(u=>u!=null);if(i.length===0)return;let a=t.state.tr;i.forEach(u=>{const E=a.mapping.map(u.from,-1),m=a.mapping.map(u.to,1),p=n==="keep"?u.originalContent:u.suggestedContent;a=a.replaceRange(E,m,new dn(p,0,0))}),a.setMeta(et,{setPinnedRange:null,removeEntryId:e});const l=Math.min(a.doc.content.size,(f=(d=i[0])==null?void 0:d.from)!=null?f:0),c=(h=he.findFrom(a.doc.resolve(l),-1,!0))!=null?h:he.near(a.doc.resolve(l),-1);a.setSelection(c),a.scrollIntoView(),t.dispatch(a)}function wl(t,e,n,s){var N,A,R,T,b,y,I,v,w,L,_,F,G,D,K;const o=et.getState(t.state);if(!o)return!1;const r=o.entries.get(e);if(!r)return!1;const i=r.segments.find(H=>H.index===n);if(!i)return!1;const a=t.state.doc,l=i.original?a.nodeAt(i.original.pos):null,c=i.suggested?a.nodeAt(i.suggested.pos):null;if(!l&&!c)return!1;const d=Math.min((T=(R=(N=i.original)==null?void 0:N.pos)!=null?R:(A=i.suggested)==null?void 0:A.pos)!=null?T:0,(v=(I=(b=i.suggested)==null?void 0:b.pos)!=null?I:(y=i.original)==null?void 0:y.pos)!=null?v:0),f=Math.max(((w=i.original)==null?void 0:w.pos)!=null?i.original.pos+((L=l==null?void 0:l.nodeSize)!=null?L:0):d,((_=i.suggested)==null?void 0:_.pos)!=null?i.suggested.pos+((F=c==null?void 0:c.nodeSize)!=null?F:0):d);let h=t.state.tr;const u=h.mapping.map(d,-1),E=h.mapping.map(f,1),m=s==="keep"?(G=l==null?void 0:l.content)!=null?G:Ge.empty:(D=c==null?void 0:c.content)!=null?D:Ge.empty;h=h.replaceRange(u,E,new dn(m,0,0));const p={setPinnedRange:null};r.segments.length===1&&(p.removeEntryId=e),h.setMeta(et,p);const S=Math.min(h.doc.content.size,u),x=(K=he.findFrom(h.doc.resolve(S),-1,!0))!=null?K:he.near(h.doc.resolve(S),-1);return h.setSelection(x),h.scrollIntoView(),t.dispatch(h),!0}function Ir(t){const e=et.getState(t.state);if(!e)return!1;const{from:n,to:s}=t.state.selection;if(n===s)return!1;for(const o of e.entries.values())if(n>=o.from&&s<=o.to)return!0;return!1}function Il(t){var e,n;return(n=(e=et.getState(t.state))==null?void 0:e.pinnedRange)!=null?n:null}function No(t){var r,i;const e=new Map,{nodes:n}=t.type.schema,s=(r=n.magic_edit_original_block)!=null?r:null,o=(i=n.magic_edit_suggested_block)!=null?i:null;return!s||!o||t.descendants((a,l)=>{var f,h;if(a.type!==s&&a.type!==o)return!0;const c=(f=a.attrs)==null?void 0:f[gn];if(!c)return!1;const d=(h=e.get(c))!=null?h:{hasOriginal:!1,hasSuggested:!1};return a.type===s?d.hasOriginal=!0:d.hasSuggested=!0,e.set(c,d),!1}),e}function _l(t){if(!t)return new Set;const e=t,n=new Set;return typeof e.removeEntryId=="string"&&n.add(e.removeEntryId),n}const Rl=new Wt("writingBlockMagicEditGuard");function Tl(){return new Lt({key:Rl,filterTransaction(t,e){if(!t.docChanged||t.getMeta(Kr))return!0;const n=_l(t.getMeta(et)),s=No(e.doc),o=No(t.doc);for(const[r,i]of s){const a=o.get(r),l=n.has(r);if(!a){if(!l)return!1;continue}if(i.hasOriginal&&!a.hasOriginal&&!l||i.hasSuggested&&!a.hasSuggested&&!l)return!1}return!0}})}const Cl="\\[[^\\[\\]]+\\]";function Nl(t){var o;const e=new RegExp(Cl,"g"),n=[];let s=e.exec(t);for(;s;){const r=(o=s.index)!=null?o:-1;r>=0&&n.push({start:r,end:r+s[0].length,text:s[0]}),s=e.exec(t)}return n}const Pl={class:"text-token-text-primary cursor-text","data-placeholder-token":"true",style:"background-color: color-mix(in srgb, var(--selection) 20%, transparent); padding-top: 4px; padding-bottom: 4px;"};function vl(t){return typeof t=="object"&&t!=null&&Object.prototype.hasOwnProperty.call(t,"isDisabled")}const an=new Wt("writingBlockPlaceholder");function Al(t){return new Lt({key:an,state:{init(e,n){return{decorations:Po(n.doc,t),isDisabled:t}},apply(e,n){var r,i;const s=e.getMeta(an),o=(i=(r=vl(s)?s.isDisabled:void 0)!=null?r:n.isDisabled)!=null?i:t;return!e.docChanged&&o===n.isDisabled?n:{isDisabled:o,decorations:Po(e.doc,o)}}},props:{decorations(e){var n,s;return(s=(n=an.getState(e))==null?void 0:n.decorations)!=null?s:null},handleDOMEvents:{mousedown(e,n){const s=n.target;if(!(s instanceof HTMLElement))return!1;const o=s.closest("[data-placeholder-token]");if(!(o instanceof HTMLElement))return!1;const r=an.getState(e.state);if(r!=null&&r.isDisabled)return!1;n.preventDefault(),e.hasFocus()||e.focus();const i=e.posAtDOM(o,0),a=e.posAtDOM(o,o.childNodes.length),l=Sn.create(e.state.doc,i,a);return e.dispatch(e.state.tr.setSelection(l)),!0}}}})}function Ll(t,e){return t.setMeta(an,{isDisabled:e})}function Po(t,e){if(e)return yt.empty;const n=[];return t.descendants((s,o)=>{if(!s.type.isText||!s.text)return;const r=Nl(s.text);for(const i of r){const a=o+i.start,l=o+i.end;n.push(ln.inline(a,l,Pl))}}),yt.create(t,n)}const Ys=[{id:"paragraph",command:"text paragraph normal",messageKey:"text"},{id:"heading1",command:"heading1 h1 heading 1",messageKey:"heading1"},{id:"heading2",command:"heading2 h2 heading 2",messageKey:"heading2"},{id:"heading3",command:"heading3 h3 heading 3",messageKey:"heading3"},{id:"orderedList",command:"ordered list numbered",messageKey:"orderedList"},{id:"unorderedList",command:"unordered list bulleted",messageKey:"unorderedList"}];new Map(Ys.map(t=>[t.id,t]));const Dl=Ys.map(t=>t.id),Ol=()=>Ys,Fl=t=>({id:t.id,command:t.command,disabled:!1,messageKey:t.messageKey,kind:"text-style"}),Bl=Ol().map(Fl),Xs=[{id:"generate",command:"magic text generate",disabled:!1,messageKey:"generate",kind:"generate"},{id:"divider",command:"divider hr horizontal rule",disabled:!1,messageKey:"divider",kind:"divider"},...Bl],_r=new Map(Xs.map(t=>[t.id,t])),jl=["generate","divider",...Dl],Rr=t=>{var e;return(e=t==null?void 0:t.includeMagicTextOption)!=null?e:!0},Tr=(t,e)=>Rr(e)?t:t.filter(n=>n.id!=="generate"),zl=(t,e)=>Rr(e)?[...t]:t.filter(n=>n!=="generate"),Hl=t=>Tr(Xs,t),$l=t=>{var e;return(e=_r.get(t))!=null?e:null},Gl=t=>{var e,n;return(n=(e=_r.get(t))==null?void 0:e.disabled)!=null?n:!0},Wl=t=>{const e=t.trim().toLowerCase();return e.startsWith("/")?e.slice(1):e},Ul=(t,e)=>t===""?zl(jl,e):Tr(Xs,e).filter(n=>n.command.includes(t)).map(n=>n.id),Ke=new Wt("writingBlockSlashMenu"),ql=t=>typeof t=="object"&&t!=null&&"type"in t,un={triggerPos:null,anchorPos:null,query:"",normalizedQuery:"",visibleOptionIds:[],highlightedOptionId:null},bt=t=>(t==null?void 0:t.triggerPos)!=null&&(t==null?void 0:t.anchorPos)!=null,Kl=(t,e)=>{const n=t.selection;if(!n.empty||n.from<e||t.doc.textBetween(e,e+1,"\0","\0")!=="/")return!1;const o=t.doc.resolve(e),r=t.selection.$from;return o.parent===r.parent},vo=(t,e,n)=>{var S,x,N,A,R,T;const s=t.doc,o=s.content.size,r=Math.min(e+1,o),i=(S=n==null?void 0:n.previousState)!=null?S:null,a=(N=(x=n==null?void 0:n.anchorOverride)!=null?x:i==null?void 0:i.anchorPos)!=null?N:null,l=a!=null?a:r,c=t.selection.from,d=c>=r?c:l,f=Math.min(Math.max(d,r),o),h=f<=r?"":s.textBetween(r,f,"\0","\0"),u=Wl(h),E=Ul(u,{includeMagicTextOption:n==null?void 0:n.includeMagicTextOption}),m=(A=i==null?void 0:i.highlightedOptionId)!=null?A:null,p=m&&E.length>0?E.includes(m)?m:(R=E[0])!=null?R:null:(T=E[0])!=null?T:null;return{triggerPos:e,anchorPos:f,query:h,normalizedQuery:u,visibleOptionIds:E,highlightedOptionId:p}},Yl=t=>new Lt({key:Ke,state:{init:()=>un,apply(e,n,s,o){var c,d;const r=e.getMeta(Ke),i=ql(r)?r:void 0;if((i==null?void 0:i.type)==="open")return vo(o,i.triggerPos,{previousState:n,anchorOverride:i.anchorPos,includeMagicTextOption:t==null?void 0:t.includeMagicTextOption});if((i==null?void 0:i.type)==="close")return un;if((i==null?void 0:i.type)==="highlight"){if(!bt(n))return n;const f=i.commandId;return f==null?qe(me({},n),{highlightedOptionId:(c=n.visibleOptionIds[0])!=null?c:null}):n.visibleOptionIds.includes(f)?n.highlightedOptionId===f?n:qe(me({},n),{highlightedOptionId:f}):n}if((i==null?void 0:i.type)==="navigate"){if(!bt(n))return n;const f=n.visibleOptionIds;if(f.length===0)return n.highlightedOptionId==null?n:qe(me({},n),{highlightedOptionId:null});const h=i.direction==="previous"?-1:1,u=n.highlightedOptionId?f.indexOf(n.highlightedOptionId):-1,m=((u>=0?u:0)+h+f.length)%f.length;return f[m]===n.highlightedOptionId?n:qe(me({},n),{highlightedOptionId:(d=f[m])!=null?d:null})}if((i==null?void 0:i.type)==="execute"||!bt(n))return n;const a=n.triggerPos!=null?e.mapping.map(n.triggerPos,-1):null,l=n.anchorPos!=null?e.mapping.map(n.anchorPos,1):null;return a==null||l==null||!Kl(o,a)?un:vo(o,a,{previousState:qe(me({},n),{triggerPos:a,anchorPos:l}),includeMagicTextOption:t==null?void 0:t.includeMagicTextOption})}},props:{handleTextInput(e,n,s,o){const r=o.lastIndexOf("/");if(r===-1)return!1;const i=e.state.tr;i.insertText(o,n,s);const a=n+r,l=n+o.length;return e.dispatch(i.setMeta(Ke,{type:"open",triggerPos:a,anchorPos:l})),!0},handleKeyDown(e,n){const s=Ke.getState(e.state);if(n.key==="Escape"&&bt(s)){n.preventDefault(),n.stopPropagation();const o=e.state.tr.setMeta(Ke,{type:"close"});return e.dispatch(o),!0}if(!s||!bt(s))return!1;if((n.key==="ArrowUp"||n.key==="ArrowDown")&&s.visibleOptionIds.length>0){n.preventDefault(),n.stopPropagation();const o=e.state.tr.setMeta(Ke,{type:"navigate",direction:n.key==="ArrowUp"?"previous":"next"});return e.dispatch(o),!0}if(n.key==="Enter"){n.preventDefault(),n.stopPropagation();const o=s.highlightedOptionId;if(!o||Gl(o))return!0;const r=e.state.tr.setMeta(Ke,{type:"execute",commandId:o});return e.dispatch(r),!0}return!1}}}),Mn=t=>{const e=Ke.getState(t.state);if(!bt(e))return;const n=t.state.tr.setMeta(Ke,{type:"close"});t.dispatch(n)},Cr="<|magic_edit_start|>",Nr="<|magic_edit_end|>";function Pr(t,e,n){if(e<0||n<e||n>t.length)throw new Error("Selection indices must satisfy 0 <= start <= end <= len(md)");return t.slice(0,e)+Cr+t.slice(e,n)+Nr+t.slice(n)}function vr(){"use no forget";const t=g.useRef(null),e=Gr({mutationFn:async({payload:s})=>{var r;(r=t.current)==null||r.abort(new DOMException("Request canceled","AbortError"));const o=new AbortController;t.current=o;try{return await ei.safePost("/conversation/message/writing-blocks/magic-edit",{requestBody:s,authOption:ti.SendIfAvailable,signal:o.signal})}finally{t.current===o&&(t.current=null)}}}),n=g.useCallback(()=>{var s;(s=t.current)==null||s.abort(new DOMException("Request canceled","AbortError")),t.current=null},[]);return me({cancel:n},e)}function Xl({fullMarkdown:t,startIndex:e,endIndex:n}){if(!(e>=0&&n>=e&&n<=t.length)){console.warn("[MagicEdit] Invalid selection indices",{startIndex:e,endIndex:n,fullMarkdownLength:t.length});return}const o=t.slice(0,e)+Cr+t.slice(e,n)+Nr+t.slice(n);console.warn("[MagicEdit] Marked selection preview",{startIndex:e,endIndex:n,marked:o})}function Vl(t){console.warn("[MagicEdit] Request payload",t)}function Ql(t,e){const n=Math.max(0,Math.min(t.from,e)),s=Math.max(n,Math.min(t.to,e));return{from:n,to:s}}function Ao(t,e){return t.state.doc.textBetween(e.from,e.to,"\n","\n").endsWith("\n")&&e.to>e.from?qe(me({},e),{to:e.to-1}):e}async function Zl({view:t,pmu:e,ctx:n,range:s,instruction:o,numVariations:r,magicEditId:i,conversationId:a,mode:l,shouldLogMagicEditDebug:c}){let d;try{d=xr({view:t,pmu:e,range:s}),c&&Xl(d)}catch(x){throw new Error("Unable to serialize the current selection for magic edit.")}const f=al(t,s),h=Mi(t.dom,f),u=Si(d.fullMarkdown,d.startIndex,d.endIndex),E=Pr(d.fullMarkdown,d.startIndex,d.endIndex),m=await ki(d.fullMarkdown),p=In(n,i);p.domAnchor$.set(h),p.textAnchor$.set(u),p.baseBlockVersion$.set(m),p.freeformFeedback$.set(o),p.fullBlockBodyMarkdown$.set(d.fullMarkdown),p.startIndex$.set(d.startIndex),p.endIndex$.set(d.endIndex),p.segmentDiffs$.set([]);const S={conversation_id:a,full_block_body_markdown:d.fullMarkdown,start_index:d.startIndex,end_index:d.endIndex,marked_block_body_markdown:E,instruction:o,num_variations:r,mode:l};return c&&Vl(S),{payload:S,snapshot:{domAnchor:h,textAnchor:u,baseBlockVersion:m,blockRange:d.blockRange}}}function Lo(t){"use forget";const e=tt.c(37),{view:n,pmu:s,mode:o}=t,r=o===void 0?"edit":o,i=_n(),a=Vo(),l=At(),c=Qo();let d;e[0]!==c?(d=()=>c==null?void 0:c.serverId$(),e[0]=c,e[1]=d):d=e[1];const f=js(d);let h;e[2]!==i?(h=bn(i,"2671346616"),e[2]=i,e[3]=h):h=e[3];const u=h,E=g.useRef(null),m=g.useRef(null),p=g.useRef(null),[S,x]=g.useState(null),{mutateAsync:N,isPending:A,cancel:R}=vr();let T;e[4]!==R?(T=()=>{R(),x(null)},e[4]=R,e[5]=T):T=e[5];const b=T;let y;e[6]!==i||e[7]!==N?(y=async(j,B)=>{const z=await N({payload:j}),W=z.choices,J=In(i,B);return J.replacements$.set(W),J.modelSlug$.set(z.model_slug),J.status$.set("ready"),{replacements:W,magicEditId:B}},e[6]=i,e[7]=N,e[8]=y):y=e[8];const I=y;let v;e[9]!==f||e[10]!==i||e[11]!==I||e[12]!==l||e[13]!==r||e[14]!==s||e[15]!==u||e[16]!==a||e[17]!==n?(v=async j=>{var $;const{instruction:B,numVariations:z,range:W,submissionSource:J}=j,U=z===void 0?1:z;if(!n)return null;if(!W){const X=l.formatMessage({id:"zpmbDf",defaultMessage:"Highlight text in the block to use magic edit."});return a.danger(X,{duration:2}),null}const P=Ao(n,W);x(J);try{const X=crypto.randomUUID();p.current=X;const{payload:M,snapshot:Q}=await Zl({view:n,pmu:s,ctx:i,range:P,instruction:B,numVariations:U,magicEditId:X,conversationId:f,mode:r,shouldLogMagicEditDebug:u});E.current=Q,m.current=M;const ne=await I(M,X);return Gt("ChatGPT Writing Block Magic Edit Submitted","chatgpt_writing_block_magic_edit_submitted",{magicEditId:X,submissionSource:J}),x(null),ne}catch(X){const M=X;if(x(null),M instanceof ni&&M.rawError.name==="AbortError")return null;const Q=($=cs(M))!=null?$:l.formatMessage({id:"oSt4Kz",defaultMessage:"An error occured during magic edit."});return a.danger(Q,{duration:2}),Gt("ChatGPT Writing Block Magic Edit Failed","chatgpt_writing_block_magic_edit_failed",qe(me({},p.current?{magicEditId:p.current}:{}),{error:M instanceof Error?M.message:"Unknown error"})),null}},e[9]=f,e[10]=i,e[11]=I,e[12]=l,e[13]=r,e[14]=s,e[15]=u,e[16]=a,e[17]=n,e[18]=v):v=e[18];const w=v;let L;e[19]!==I?(L=()=>!m.current||!p.current?Promise.resolve(null):I(m.current,p.current),e[19]=I,e[20]=L):L=e[20];const _=L;let F;e[21]!==i||e[22]!==l||e[23]!==s||e[24]!==a||e[25]!==n?(F=j=>{var Q,ne;const{magicEditId:B,replacement:z,range:W}=j;if(!n)return!1;const J=E.current;if(!J||!W)return!1;const U=Ao(n,W);let P;const $=z!=null?z:"";try{P=s.parse($)}catch(q){const ae=(Q=cs(q))!=null?Q:l.formatMessage({id:"wh4sET",defaultMessage:"We couldn’t apply magic edit because the suggestion was invalid."});return a.danger(ae,{duration:3}),!1}let X;try{const q=Ql(J.blockRange,n.state.doc.content.size);X=n.state.doc.replace(q.from,q.to,new dn(P.content,0,0))}catch(q){const ae=(ne=cs(q))!=null?ne:l.formatMessage({id:"wh4sET",defaultMessage:"We couldn’t apply magic edit because the suggestion was invalid."});return a.danger(ae,{duration:3}),!1}const M=Sl({ctx:i,view:n,pmu:s,selection:U,magicEditId:B,replacementDoc:X});return M&&(E.current=null),M},e[21]=i,e[22]=l,e[23]=s,e[24]=a,e[25]=n,e[26]=F):F=e[26];const G=F;let D;e[27]!==n?(D=()=>n?Ir(n):!1,e[27]=n,e[28]=D):D=e[28];const K=D;let H;return e[29]!==G||e[30]!==b||e[31]!==A||e[32]!==S||e[33]!==_||e[34]!==K||e[35]!==w?(H={isLoading:A,submitMagicEdit:w,cancelMagicEdit:b,applyMagicEditResult:G,isSelectionInsideMagicEdit:K,retry:_,magicEditSubmissionSource:S},e[29]=G,e[30]=b,e[31]=A,e[32]=S,e[33]=_,e[34]=K,e[35]=w,e[36]=H):H=e[36],H}const Jl="shadow-[0_8px_12px_0_rgba(0,0,0,0.16),0_0_1px_0_rgba(0,0,0,0.60)] dark:shadow-[0_8px_16px_0_rgba(0,0,0,0.40),inset_0_0_1px_0_rgba(255,255,255,0.25),0_0_1px_0_rgba(0,0,0,0.60)]",ys=({children:t})=>k.jsx(ur,{className:ue("bg-token-main-surface-primary m-0 flex h-9 w-fit min-w-0 shrink items-center overflow-hidden rounded-xl px-1 dark:bg-[#353535]",Jl,"py-1"),children:t}),Ar=({icon:t,hideLabel:e,isActive:n,label:s,subLabel:o,iconClassName:r,labelClassName:i})=>k.jsxs(k.Fragment,{children:[t&&k.jsx(t,{className:ue("icon-sm",{"me-0.5":!e,"text-token-text-tertiary":!e&&!n,"text-token-text-primary":e&&!n,"text-token-interactive-label-accent-default hover:text-token-interactive-label-accent-hover":n},r)}),!e&&k.jsx("span",{className:ue("truncate text-sm",{"text-token-text-primary":!n,"text-token-interactive-label-accent-default hover:text-token-interactive-label-accent-hover":n},i),children:s}),o]});var qo;const ec=Zo(fs)(qo||(qo=Ts(["flex h-full items-center rounded-lg gap-1 px-2 hover:bg-black/5 dark:hover:bg-token-interactive-bg-secondary-hover disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-transparent"]))),Es=({label:t,subLabel:e,icon:n,isDisabled:s=!1,isActive:o=!1,hideLabel:r=!1,onClick:i,onMouseDown:a,iconClassName:l,labelClassName:c})=>k.jsx(ec,{onClick:i,"aria-label":r?t:void 0,onMouseDown:a,disabled:s,"aria-pressed":o||void 0,"data-state":o?"on":void 0,children:k.jsx(Ar,{icon:n,hideLabel:r,label:t,subLabel:e,isActive:o,iconClassName:l,labelClassName:c})});var Ko;const tc=Zo(cr)(Ko||(Ko=Ts(["mx-1 p-0 list-none h-3 w-[1px] bg-token-border-default"])));function nc({buttonText:t,triggerLabel:e,options:n,selectedOptionId:s,isOpen:o,onOpenChange:r,onSelect:i,preserveSelection:a,editorRef:l}){"use no forget";const c=g.useRef(null),[d,f]=g.useState(null);g.useEffect(()=>{const u=c.current;!u||typeof document>"u"||f(u.closest('[aria-hidden="true"]')!=null)},[]);const h=k.jsxs(k.Fragment,{children:[k.jsx("span",{className:"text-sm font-medium",children:t}),k.jsx(Ti,{"aria-hidden":!0,className:"icon-xs text-current"})]});return d!==!1?k.jsx("div",{ref:c,"data-toolbar-surface":"true",className:"h-full",children:k.jsx(fo.Button,{type:"button","aria-label":e,"aria-haspopup":"menu","aria-expanded":o,tabIndex:-1,"data-state":o?"open":"closed",className:ue("text-token-text-primary flex h-full items-center gap-1 rounded-lg px-2.5","dark:hover:bg-token-interactive-bg-secondary-hover hover:bg-black/5",o&&"bg-token-interactive-bg-secondary-selected"),children:h})}):k.jsx("div",{ref:c,"data-toolbar-surface":"true",className:"h-full",children:k.jsxs(wi,{open:o,onOpenChange:u=>{u&&a(),r(u)},children:[k.jsx(Ii,{asChild:!0,children:k.jsx(fo.Button,{type:"button","aria-label":e,"aria-haspopup":"menu","aria-expanded":o,className:ue("text-token-text-primary flex h-full items-center gap-1 rounded-lg px-2.5","dark:hover:bg-token-interactive-bg-secondary-hover hover:bg-black/5","data-[state=open]:bg-token-interactive-bg-secondary-selected"),onMouseDown:u=>u.preventDefault(),onPointerDownCapture:a,onKeyDownCapture:u=>{(u.key===" "||u.key==="Enter")&&a()},children:h})}),k.jsx(_i,{children:k.jsx(Ri,{align:"start",alignOffset:-8,sideOffset:8,className:ue(Ms.toolbar,"popover","bg-token-main-surface-primary w-fit rounded-2xl p-1.5",Gs),"data-toolbar-surface":"true",onOpenAutoFocus:u=>u.preventDefault(),onCloseAutoFocus:u=>{var E;u.preventDefault(),(E=l.current)==null||E.focus({preventScroll:!0})},children:k.jsx("div",{className:"flex flex-col gap-0.5",role:"menu",children:n.map(u=>{const E=u.id===s;return k.jsx("button",{type:"button",role:"menuitemradio","aria-checked":E,"data-selected":E?"true":void 0,className:ue("text-token-text-primary dark:hover:bg-token-main-surface-secondary rounded-[10px] py-1.5 ps-3 pe-1 text-start text-sm hover:bg-[#f5f5f5]",E&&"dark:bg-token-main-surface-secondary bg-[#f5f5f5] font-medium"),onPointerDown:m=>m.preventDefault(),onClick:()=>i(u.id),children:k.jsxs("span",{className:"flex w-full items-center justify-between gap-8",children:[k.jsx("span",{className:u.className,children:u.label}),k.jsx("span",{className:"text-token-text-tertiary",children:k.jsx(zs,{binding:u.shortcut})})]})},u.id)})})})})]})})}const sc=({getEditorDom:t,getToolbarPosition:e,children:n,fixToolbarPositionOnInteraction:s=!1,savedSelection:o=!1,toolbarContentRef:r,setIsToolbarOpen:i,forceClose:a=!1,fullscreenMode:l=!1})=>{"use no forget";const[{height:c,width:d},f]=ba(),[h,u]=g.useState(!0),[E,m]=g.useState(!1),[p,S]=g.useState(!0),x=t(),[N,A]=g.useState(null),R=g.useCallback(()=>{const b=t(),y=document.getSelection();return!y||y.type!=="Range"||y.isCollapsed||!(b!=null&&b.contains(y.anchorNode))},[t]);g.useEffect(()=>{const b=si(()=>{m(!0)},200,{leading:!0}),y=()=>{b.cancel(),m(!1)};return x==null||x.addEventListener("pointerdown",b,{passive:!0}),document.addEventListener("pointerup",y,{passive:!0}),()=>{x==null||x.removeEventListener("pointerdown",b),document.removeEventListener("pointerup",y)}},[x]),g.useEffect(()=>{if(E){S(!1);return}const b=setTimeout(()=>S(!0),100);return()=>{clearTimeout(b)}},[E]),g.useEffect(()=>{const b=()=>{u(R())};return document.addEventListener("selectionchange",b,{passive:!0}),()=>{document.removeEventListener("selectionchange",b)}},[R]),fn(()=>{if(h||R())return u(!0);try{const b=e({width:d,height:c});b!=null&&!s&&A(b)}catch(b){oi.error("Invalid position in getToolbarPosition",{error:b})}},[c,d,h,R,e,s]);const T=!a&&(!h||o)&&N!=null&&p;return g.useEffect(()=>{i==null||i(T)},[T,i]),k.jsxs(k.Fragment,{children:[k.jsx("div",{"aria-hidden":"true",className:"pointer-events-none invisible fixed start-0 top-0 h-0 overflow-clip",children:k.jsx("div",{ref:f,children:k.jsx(ys,{children:n})})}),T&&k.jsx("div",{style:{top:N.top,left:N.left,height:N.height},className:"pointer-events-none absolute",ref:r,children:k.jsx("div",{className:ue("sticky",l?"top-2":"thread-xl:top-2 top-[calc(var(--header-height,48px)+8px)]",E?"pointer-events-none":"pointer-events-auto"),children:k.jsx(ys,{children:n})})})]})};function Lr({onDismiss:t,editorView:e,toolbarContentRef:n,isToolbarOpen:s,dismissOnPointerDown:o=!0}){const r=g.useCallback(l=>{if(!(l instanceof Node))return!1;const c=n.current;return c&&c.contains(l)?!0:l instanceof Element?l.closest('[data-toolbar-surface="true"]')!=null:!1},[n]),i=g.useCallback(l=>{if(l.key!=="Escape"||!s)return;t();const c=e.dom;c&&c.focus({preventScroll:!0})},[e,s,t]),a=g.useCallback(l=>{r(l.target)||!s||t()},[r,s,t]);return g.useEffect(()=>{var c,d;const l=(d=(c=e.dom)==null?void 0:c.ownerDocument)!=null?d:typeof document<"u"?document:null;if(l)return l.addEventListener("keydown",i),o&&l.addEventListener("pointerdown",a,{capture:!0}),()=>{l.removeEventListener("keydown",i),o&&l.removeEventListener("pointerdown",a,!0)}},[o,e,i,a]),{handleKeyDown:i}}const Dr=({size:t=48,className:e,backgroundStrokeClassName:n,spinnerColorClassName:s,onClick:o,disabled:r=!1,ariaLabel:i="Stop",percentage:a=25})=>{const l=t,c=1/20,d=l*c,f=(l-d)/2,h=2*Math.PI*f,u=h-a/100*h,E=t*.625;return k.jsxs("button",{type:"button","aria-label":i,onClick:o,disabled:r,className:ue("relative inline-flex items-center justify-center rounded-full","disabled:cursor-not-allowed disabled:opacity-50","composer-secondary-button-color",e),style:{width:t,height:t},children:[k.jsxs("svg",{width:l,height:l,viewBox:"0 0 ".concat(l," ").concat(l),className:ue("animate-spin",s),children:[k.jsx("circle",{className:ue("origin-[50%_50%] -rotate-90",n),strokeWidth:d,fill:"transparent",r:f,cx:l/2,cy:l/2}),k.jsx("circle",{className:"origin-[50%_50%] -rotate-90",stroke:"currentColor",strokeWidth:d,strokeDashoffset:u,strokeDasharray:"".concat(h," ").concat(h),fill:"transparent",r:f,cx:l/2,cy:l/2,style:{strokeLinecap:"round"}})]}),k.jsx(Ci,{className:ue("absolute flex items-center justify-center","rounded-[2px]","composer-secondary-button-color"),style:{width:E,height:E}})]})};function Or(t){"use forget";const e=tt.c(36),{value:n,onChange:s,placeholder:o,onSubmit:r,onCancel:i,isLoading:a,submitAriaLabel:l,cancelAriaLabel:c,name:d,autoFocus:f,disabled:h,selectAllOnFocus:u,inputRef:E,inputClassName:m,onKeyDownCapture:p,isSubmitDisabled:S}=t,x=u===void 0?!1:u;let N;e[0]!==a||e[1]!==S||e[2]!==n?(N=!a&&(S!=null?S:n.trim()===""),e[0]=a,e[1]=S,e[2]=n,e[3]=N):N=e[3];const A=N;let R;e[4]!==s?(R=_=>s(_.target.value),e[4]=s,e[5]=R):R=e[5];let T;e[6]!==a||e[7]!==i||e[8]!==r?(T=()=>{if(a){i();return}r()},e[6]=a,e[7]=i,e[8]=r,e[9]=T):T=e[9];let b;e[10]!==m?(b=ue("mx-0! min-w-[300px]! ps-2.5! pe-9!",m),e[10]=m,e[11]=b):b=e[11];const y=h!=null?h:a;let I;e[12]!==p?(I=_=>{p==null||p(_)},e[12]=p,e[13]=I):I=e[13];let v;e[14]!==f||e[15]!==E||e[16]!==d||e[17]!==o||e[18]!==x||e[19]!==R||e[20]!==T||e[21]!==b||e[22]!==y||e[23]!==I||e[24]!==n?(v=k.jsx(ri,{ref:E,value:n,onChange:R,placeholder:o,onSubmit:T,border:!1,className:b,name:d,autoFocus:f,disabled:y,selectAllOnFocus:x,onKeyDownCapture:I}),e[14]=f,e[15]=E,e[16]=d,e[17]=o,e[18]=x,e[19]=R,e[20]=T,e[21]=b,e[22]=y,e[23]=I,e[24]=n,e[25]=v):v=e[25];let w;e[26]!==c||e[27]!==a||e[28]!==i||e[29]!==r||e[30]!==A||e[31]!==l?(w=k.jsx("div",{className:"absolute end-1.5 top-1/2 flex -translate-y-1/2 items-center justify-center",children:a?k.jsx(Dr,{ariaLabel:c,size:20,onClick:i}):k.jsx("button",{className:ue("icon","composer-submit-btn composer-submit-button-color"),onClick:r,disabled:A,"aria-label":l,children:k.jsx(ir,{className:"icon-xs"})})}),e[26]=c,e[27]=a,e[28]=i,e[29]=r,e[30]=A,e[31]=l,e[32]=w):w=e[32];let L;return e[33]!==v||e[34]!==w?(L=k.jsxs("div",{className:"relative",children:[v,w]}),e[33]=v,e[34]=w,e[35]=L):L=e[35],L}function oc(t){"use forget";const e=tt.c(44),{editorView:n,intl:s,isMagicEditOpen:o,toggleMagicEdit:r,isMagicEditDisabled:i,handleKeyDown:a,highlightMagicEdit:l,isMagicEditLoading:c,submitMagicEdit:d,applyMagicEditResult:f,cancelMagicEdit:h,magicEditSubmissionSource:u}=t,E=l===void 0?!1:l,[m,p]=g.useState(""),S=g.useRef(null),x=g.useRef(!1);let N;e[0]!==f||e[1]!==n||e[2]!==m||e[3]!==d||e[4]!==r?(N=async j=>{var P;x.current=!1,j==null||j.preventDefault(),j==null||j.stopPropagation();const B=m.trim(),z=Il(n);if(!B)return;const W=await d({instruction:B,range:z,submissionSource:kn.TOOLBAR});if(!W||x.current)return;const J=(P=W.replacements[0])!=null?P:"";f({magicEditId:W.magicEditId,replacement:J,range:z})&&(p(""),r(!1))},e[0]=f,e[1]=n,e[2]=m,e[3]=d,e[4]=r,e[5]=N):N=e[5];const A=N;let R;e[6]!==h?(R=()=>{x.current=!0,h()},e[6]=h,e[7]=R):R=e[7];const T=R;let b;e[8]!==s?(b=s.formatMessage({id:"5zZNwD",defaultMessage:"Describe edits"}),e[8]=s,e[9]=b):b=e[9];const y=b;let I;e[10]!==s?(I=s.formatMessage({defaultMessage:"Submit",id:"aria.submit"}),e[10]=s,e[11]=I):I=e[11];const v=I;let w;e[12]!==s?(w=s.formatMessage({defaultMessage:"Cancel",id:"aria.cancel"}),e[12]=s,e[13]=w):w=e[13];const L=w;let _;e[14]!==s?(_=s.formatMessage({id:"L9RYdR",defaultMessage:"Quick edit"}),e[14]=s,e[15]=_):_=e[15];const F=_;if(!o){const j=E?"font-semibold text-[#007aff] dark:text-[#4fa6f7]":"font-medium";let B;e[16]!==j?(B=ue(j),e[16]=j,e[17]=B):B=e[17];const z=B,W=E?"".concat(bs.keyBindingTight," [&_kbd]:text-[#007aff]! dark:[&_kbd]:text-[#4fa6f7]!"):bs.keyBindingTight;let J;e[18]!==W?(J=k.jsx(zs,{binding:ar,className:W}),e[18]=W,e[19]=J):J=e[19];let U;e[20]!==r?(U=()=>r(!0),e[20]=r,e[21]=U):U=e[21];let P;e[22]!==i||e[23]!==z||e[24]!==F||e[25]!==J||e[26]!==U?(P=k.jsx(Es,{label:F,labelClassName:z,subLabel:J,onClick:U,onMouseDown:rc,isDisabled:i}),e[22]=i,e[23]=z,e[24]=F,e[25]=J,e[26]=U,e[27]=P):P=e[27];let $;e[28]===Symbol.for("react.memo_cache_sentinel")?($=k.jsx(tc,{}),e[28]=$):$=e[28];let X;return e[29]!==P?(X=k.jsxs(k.Fragment,{children:[P,$]}),e[29]=P,e[30]=X):X=e[30],X}const G=u===kn.TOOLBAR&&c;let D;e[31]!==m?(D=m.trim(),e[31]=m,e[32]=D):D=e[32];const K=D==="";let H;return e[33]!==L||e[34]!==a||e[35]!==T||e[36]!==A||e[37]!==c||e[38]!==m||e[39]!==y||e[40]!==v||e[41]!==K||e[42]!==G?(H=k.jsx(Or,{inputRef:S,value:m,onChange:p,placeholder:y,onSubmit:A,onCancel:T,isLoading:G,submitAriaLabel:v,cancelAriaLabel:L,name:"writing-block-magic-edit-instruction",autoFocus:!0,disabled:c,selectAllOnFocus:!1,onKeyDownCapture:a,isSubmitDisabled:K}),e[33]=L,e[34]=a,e[35]=T,e[36]=A,e[37]=c,e[38]=m,e[39]=y,e[40]=v,e[41]=K,e[42]=G,e[43]=H):H=e[43],H}function rc(t){return t.preventDefault()}const Bs=(t,e)=>{const n=t.state.schema,s=r=>{r(t.state,t.dispatch)};let o=null;switch(e){case"paragraph":o=lr.paragraphStyleCommand(n);break;case"heading1":o=yn.headingStyleCommand(n,1);break;case"heading2":o=yn.headingStyleCommand(n,2);break;case"heading3":o=yn.headingStyleCommand(n,3);break;case"orderedList":o=Hs.orderedListCommand(n);break;case"unorderedList":o=$s.unorderedListCommand(n);break}o&&s(o)},ic=(t,e)=>{var c,d;const n=Ke.getState(t.state),s=(c=n==null?void 0:n.triggerPos)!=null?c:null,o=(d=n==null?void 0:n.anchorPos)!=null?d:null;if(s==null){Bs(t,e),Mn(t);return}const r=Math.max(s+1,o!=null?o:s+1);let i=t.state.tr.delete(s,r);const a=Math.max(Math.min(s,i.doc.content.size),0),l=Sn.create(i.doc,a);i=i.setSelection(l),t.dispatch(i),Bs(t,e),Mn(t)},is=t=>({left:t.left,top:t.top,width:t.width,height:t.height}),as=.5,us=(t,e)=>Math.abs(t.left-e.left)<as&&Math.abs(t.top-e.top)<as&&Math.abs(t.width-e.width)<as&&Math.abs(t.height-e.height)<as,ac=(t,e)=>t==null&&e==null?!0:t==null||e==null?!1:us(t,e),lc=12,cc=250,pt=xs({bold:{id:"Z0FJiE",defaultMessage:"Bold"},italic:{id:"Ros0Mw",defaultMessage:"Italic"},textStylesTrigger:{id:"hngz+P",defaultMessage:"Text styles"},text:{id:"fGeL2E",defaultMessage:"Text"},heading1:{id:"Z1ugOp",defaultMessage:"Heading 1"},heading2:{id:"lVfGMg",defaultMessage:"Heading 2"},heading3:{id:"c55YcX",defaultMessage:"Heading 3"},heading1Glyph:{id:"QzkS3/",defaultMessage:"H1"},heading2Glyph:{id:"F2BLPp",defaultMessage:"H2"},heading3Glyph:{id:"SVuVmp",defaultMessage:"H3"},numberedList:{id:"IGi1BS",defaultMessage:"Numbered list"},bulletedList:{id:"EkLnA6",defaultMessage:"Bulleted list"},magicEditSelectNux:{id:"p7nU1a",defaultMessage:"Quick edit to ask ChatGPT for changes"}}),uc=({editorView:t,intl:e,isMagicEditEnabled:n,shouldDisableMagicEdit:s,toolbarContentRef:o,onToolbarOpenChange:r,onMagicEditInvoked:i,highlightMagicEdit:a=!1,isMagicEditLoading:l,submitMagicEdit:c,applyMagicEditResult:d,cancelMagicEdit:f,magicEditSubmissionSource:h,fullscreenMode:u})=>{"use no forget";const E=_n(),m=g.useRef(null),p=o!=null?o:m,[S,x]=g.useState(!1);g.useEffect(()=>{r==null||r(S)},[S,r]);const[N,A]=g.useState(!1),[R,T]=g.useState(!1),b=s||R,[y,I]=g.useState(!1),v=g.useRef(null),w=g.useCallback(()=>t.dom,[t]),L=g.useRef(null),_=g.useRef(null),[F,G]=g.useState(0),D=g.useRef(!1),K=g.useRef(null),[H,j]=g.useState(!1),[B,z]=g.useState(!1),[W,J]=g.useState("paragraph"),U=g.useCallback(O=>{const Z=L.current;Z==null&&O==null||Z!=null&&O!=null&&us(Z.selectionRect,O.selectionRect)&&us(Z.editorRect,O.editorRect)&&us(Z.containerRect,O.containerRect)&&ac(Z.caretRect,O.caretRect)&&Z.isFocusAtEnd===O.isFocusAtEnd||(L.current=O,G(le=>le+1))},[]),P=g.useCallback(()=>{var ve,Ne,Te,He,Ve;const O=t.state,{from:Z,to:re,empty:le,$from:Ee}=O.selection,Ie=O.schema.marks[As.proseMirrorMarkName()],fe=O.schema.marks[Ls.proseMirrorMarkName()];if(le){const pe=(ve=O.storedMarks)!=null?ve:Ee.marks(),be=!!Ie&&!!(pe!=null&&pe.find(We=>We.type===Ie)),Fe=!!fe&&!!(pe!=null&&pe.find(We=>We.type===fe));j(be),z(Fe)}else{const pe=O.doc.textBetween(Z,re,"\n","\n"),be=(Te=(Ne=pe.match(/^\s*/))==null?void 0:Ne[0].length)!=null?Te:0,Fe=(Ve=(He=pe.match(/\s*$/))==null?void 0:He[0].length)!=null?Ve:0,We=Z+be,dt=re-Fe;if(We>=dt)j(!1),z(!1);else{let ct=!1,nt=!0,Ae=!0;O.doc.nodesBetween(We,dt,st=>{var ft;if(st.isText){if(!((ft=st.text)!=null?ft:"").trim())return!0;ct=!0;const Et=!!Ie&&st.marks.some(Be=>Be.type===Ie),gt=!!fe&&st.marks.some(Be=>Be.type===fe);if(Et||(nt=!1),gt||(Ae=!1),!nt&&!Ae)return!1}return!0}),j(ct&&nt),z(ct&&Ae)}}let Ce="paragraph";const _e=O.schema.nodes[yn.proseMirrorNodeName()],Oe=O.schema.nodes[Hs.proseMirrorNodeName()],xe=O.schema.nodes[$s.proseMirrorNodeName()];for(let pe=Ee.depth;pe>=0;pe--){const be=Ee.node(pe);if(be.type===Oe){Ce="orderedList";break}if(be.type===xe){Ce="unorderedList";break}if(be.type===_e){const Fe=Number(be.attrs.level);Fe===1?Ce="heading1":Fe===2?Ce="heading2":Ce="heading3";break}}J(Ce)},[t]),$=g.useCallback(()=>{if(typeof window>"u")return;_.current!=null&&window.cancelAnimationFrame(_.current);const O=D.current;_.current=window.requestAnimationFrame(()=>{var Ne;if(_.current=null,O)return;const Z=t.dom;if(!Z){U(null);return}T(Ir(t));const re=window.getSelection();if(!re||re.rangeCount===0||re.isCollapsed){P(),U(null);return}const le=re.getRangeAt(0);if(!le||!Z.contains(le.commonAncestorContainer)){P(),U(null);return}P();const Ee=le.getBoundingClientRect();if(!Ee||Ee.width===0&&Ee.height===0){U(null);return}const Ie=Z.getBoundingClientRect(),Ce=((Ne=Z.offsetParent instanceof HTMLElement?Z.offsetParent:Z.parentElement)!=null?Ne:Z).getBoundingClientRect();let _e=null,Oe=!1;const{focusNode:xe,focusOffset:ve}=re;if(xe!=null){try{const Te=document.createRange();Te.setStart(xe,ve),Te.setEnd(xe,ve);const He=Te.getBoundingClientRect();He&&(_e=is(He))}catch(Te){_e=null}try{Oe=xe===le.endContainer&&ve===le.endOffset}catch(Te){Oe=!1}}U({selectionRect:is(Ee),caretRect:_e,editorRect:is(Ie),containerRect:is(Ce),isFocusAtEnd:Oe})})},[U,t,P]);g.useEffect(()=>{if(typeof document>"u"||typeof window>"u")return;const O=()=>{$()},Z=()=>{$()};return document.addEventListener("selectionchange",O),window.addEventListener("resize",Z),window.addEventListener("scroll",Z,!0),$(),()=>{document.removeEventListener("selectionchange",O),window.removeEventListener("resize",Z),window.removeEventListener("scroll",Z,!0),_.current!=null&&(window.cancelAnimationFrame(_.current),_.current=null)}},[$]);const X=g.useCallback(O=>{const Z=L.current;if(!Z)return null;const{selectionRect:re,editorRect:le,containerRect:Ee}=Z,Ie=8,fe=re.height>0?re.height:O.height,Ce=re.left-le.left,_e=re.width>0?re.width:O.width,Oe=le.width,xe=le.left-Ee.left,ve=Ce+_e/2-O.width/2,Te=Math.min(Math.max(ve,0),Math.max(Oe-O.width,0))+xe,He=re.top-le.top,Ve=le.top-Ee.top,be=He-O.height-Ie+Ve,Fe=fe+O.height*2+Ie*2;return{left:Te,top:be,height:Fe}},[t,F]),M=g.useCallback(()=>{const{state:O,dispatch:Z}=t,{selection:re}=O;if(re.empty)return;const le=Math.min(re.to,O.doc.content.size),Ee=O.doc.resolve(le),Ie=he.near(Ee,-1);Ie.eq(re)||Z(O.tr.setSelection(Ie))},[t]),Q=g.useCallback(()=>{var re,le,Ee;const O=(le=(re=t.dom)==null?void 0:re.ownerDocument)!=null?le:typeof document<"u"?document:null,Z=(Ee=O==null?void 0:O.getSelection)==null?void 0:Ee.call(O);Z&&Z.removeAllRanges()},[t]),ne=g.useCallback(()=>{M(),Q()},[M,Q]),q=g.useCallback(O=>{O?(N||i==null||i(),xl(t),I(!0),A(!0)):(Ml(t),I(!1),A(!1))},[t,N,i]),oe=g.useCallback(()=>{q(!1),ne()},[q,ne]),{handleKeyDown:ae}=Lr({editorView:t,toolbarContentRef:p,isToolbarOpen:S,onDismiss:oe}),se=g.useCallback((O,Z)=>{const re=t.dom;if(!re)return;const le=(Z==null?void 0:Z.maintainToolbarPosition)===!0;D.current=!0,typeof window<"u"&&K.current&&(window.clearTimeout(K.current),K.current=null),re.focus({preventScroll:!0});try{O(),P()}finally{typeof window<"u"?K.current=window.setTimeout(()=>{D.current=!1,K.current=null,le||$()},0):D.current=!1}},[t,$,P]),we=g.useCallback(O=>{se(()=>{const{state:Z,dispatch:re}=t,le=Z.schema.marks[O];le&&ia(Z,re,le)},{maintainToolbarPosition:!0})},[t,se]);g.useEffect(()=>()=>{typeof window<"u"&&K.current!=null&&(window.clearTimeout(K.current),K.current=null)},[]),g.useEffect(()=>{if(!n)return;const O=()=>{v.current&&(v.current.action(),v.current.limitToGroups(),v.current=null)};if(S&&!b){const{addAction:Z,limitActionGroups:re}=ii(E);v.current={action:Z({key:"magicEdit",action:()=>q(!0),actionMessageDescriptor:e.formatMessage({id:"MWHvyw",defaultMessage:"Toggle magic edit"}),group:co.Chat,keyboardBinding:ar}),limitToGroups:re([co.Chat])}}else O();return()=>{O()}},[E,e,n,S,b,q]);const Dt=g.useCallback(O=>{se(()=>{Bs(t,O)})},[t,se]),it=g.useMemo(()=>[{id:"paragraph",label:e.formatMessage(pt.text),shortcut:Ni},{id:"heading1",label:e.formatMessage(pt.heading1),className:"font-semibold text-[16px]",shortcut:Pi},{id:"heading2",label:e.formatMessage(pt.heading2),className:"font-semibold text-[15px]",shortcut:vi},{id:"heading3",label:e.formatMessage(pt.heading3),className:"font-semibold text-[14px]",shortcut:Ai},{id:"orderedList",label:e.formatMessage(pt.numberedList),shortcut:Li},{id:"unorderedList",label:e.formatMessage(pt.bulletedList),shortcut:Di}],[e]),Re=e.formatMessage(pt.textStylesTrigger),[de,at]=g.useState(!1),Ye=g.useRef(null),Xe=g.useCallback(()=>{if(typeof window>"u"){Ye.current=null;return}const O=window.getSelection();if(!O||O.rangeCount===0){Ye.current=null;return}Ye.current=O.getRangeAt(0).cloneRange()},[]),Ht=g.useCallback(()=>{if(typeof window>"u")return;const O=Ye.current;if(!O)return;const Z=window.getSelection();Z&&(Z.removeAllRanges(),Z.addRange(O))},[]);g.useEffect(()=>{de||(Ye.current=null)},[de]);const Ot=g.useMemo(()=>{const O=it.find(Z=>Z.id===W);return O?O.label:e.formatMessage(pt.text)},[W,e,it]),kt=e.formatMessage(pt.magicEditSelectNux),lt=a&&S&&!N;return k.jsxs(k.Fragment,{children:[k.jsxs(sc,{showAskChatGPT:!1,getEditorDom:w,getSelectionRange:()=>null,getToolbarPosition:X,savedSelection:y,toolbarContentRef:p,setIsToolbarOpen:x,isSendDisabled:!0,fullscreenMode:u,children:[n&&k.jsx(oc,{editorView:t,intl:e,isMagicEditOpen:N,toggleMagicEdit:q,isMagicEditDisabled:b,handleKeyDown:ae,highlightMagicEdit:a,isMagicEditLoading:l,magicEditSubmissionSource:h,submitMagicEdit:c,applyMagicEditResult:d,cancelMagicEdit:f}),!N&&k.jsxs(k.Fragment,{children:[k.jsx(Es,{label:e.formatMessage(pt.bold),hideLabel:!0,icon:ha,onClick:()=>we(As.proseMirrorMarkName()),onMouseDown:O=>O.preventDefault(),isActive:H}),k.jsx(Es,{label:e.formatMessage(pt.italic),hideLabel:!0,icon:pa,onClick:()=>we(Ls.proseMirrorMarkName()),onMouseDown:O=>O.preventDefault(),isActive:B}),k.jsx(nc,{buttonText:Ot,editorRef:{current:t.dom},selectedOptionId:W,isOpen:de,onOpenChange:O=>{O?Xe():Ye.current=null,at(O)},onSelect:O=>{Ht(),Dt(O),at(!1),oe()},options:it,preserveSelection:Xe,triggerLabel:Re})]})]}),k.jsx(dc,{toolbarRef:p,message:kt,isVisible:lt})]})},dc=t=>{"use forget";const e=tt.c(22),{toolbarRef:n,message:s,isVisible:o,transitionDurationMs:r}=t,i=r===void 0?cc:r,[a,l]=g.useState(null);let c;e[0]!==o?(c=()=>o,e[0]=o,e[1]=c):c=e[1];const[d,f]=g.useState(c);let h;e[2]!==o?(h=()=>o,e[2]=o,e[3]=h):h=e[3];const[u,E]=g.useState(h);let m,p;e[4]!==o||e[5]!==i?(m=()=>{if(typeof window>"u")return;if(o){let v=null;const w=window.requestAnimationFrame(()=>{f(!0),v=window.requestAnimationFrame(()=>{E(!0)})});return()=>{v!=null&&window.cancelAnimationFrame(v),window.cancelAnimationFrame(w)}}const y=window.requestAnimationFrame(()=>{E(!1)}),I=window.setTimeout(()=>{f(!1),l(null)},i);return()=>{window.cancelAnimationFrame(y),window.clearTimeout(I)}},p=[o,i],e[4]=o,e[5]=i,e[6]=m,e[7]=p):(m=e[6],p=e[7]),g.useEffect(m,p);let S,x;if(e[8]!==o||e[9]!==n?(S=()=>{if(!o||typeof window>"u"||typeof document>"u")return;const y=n.current;if(!y){const L=()=>{l(null)};typeof queueMicrotask=="function"?queueMicrotask(L):window.requestAnimationFrame(L);return}const I=()=>{const L=y.getBoundingClientRect();l({left:L.left+L.width/2,top:L.top-lc})};typeof queueMicrotask=="function"?queueMicrotask(I):I(),window.addEventListener("resize",I),document.addEventListener("scroll",I,!0);let v=null;typeof ResizeObserver<"u"&&(v=new ResizeObserver(()=>{I()}),v.observe(y));let w=null;return typeof MutationObserver<"u"&&(w=new MutationObserver(()=>{I()}),w.observe(y,{attributes:!0,attributeFilter:["style","class"]})),()=>{window.removeEventListener("resize",I),document.removeEventListener("scroll",I,!0),v==null||v.disconnect(),w==null||w.disconnect()}},x=[o,n],e[8]=o,e[9]=n,e[10]=S,e[11]=x):(S=e[10],x=e[11]),g.useEffect(S,x),!d||a==null||typeof document>"u"||!document.body)return null;const N="pointer-events-none fixed z-[60] -translate-x-1/2 -translate-y-full transition-opacity ".concat(u?"opacity-100":"opacity-0"),A="".concat(i,"ms");let R;e[12]!==a.left||e[13]!==a.top||e[14]!==A?(R={left:a.left,top:a.top,transitionDuration:A},e[12]=a.left,e[13]=a.top,e[14]=A,e[15]=R):R=e[15];let T;e[16]!==s?(T=k.jsx("div",{className:"max-w-[320px] rounded-lg bg-blue-400 px-2 py-1 text-center text-xs font-semibold text-white shadow-[0_4px_12px_rgba(0,0,0,0.16)] dark:shadow-[0_4px_12px_rgba(0,0,0,0.4)]",children:s}),e[16]=s,e[17]=T):T=e[17];let b;return e[18]!==R||e[19]!==T||e[20]!==N?(b=Wr.createPortal(k.jsx("div",{className:N,style:R,children:T}),document.body),e[18]=R,e[19]=T,e[20]=N,e[21]=b):b=e[21],b},fc="calc(300px + 1rem)",Ps=xs({placeholder:{id:"Qk8WA/",defaultMessage:"Tell ChatGPT what to write"},cancelLabel:{id:"dFfo1P",defaultMessage:"Cancel"},submitLabel:{id:"4jyv9s",defaultMessage:"Submit"}});function gc(t){"use forget";const e=tt.c(48),{value:n,onChange:s,onSubmit:o,onCancel:r,isLoading:i,anchorPos:a,editorView:l,editorRootRef:c}=t,d=At(),f=g.useRef(null),h=g.useRef(null);let u;e[0]!==c?(u=($,X,M)=>{var Q;return sr((Q=c.current)!=null?Q:$,X,M,{ancestorResize:!0,ancestorScroll:!0})},e[0]=c,e[1]=u):u=e[1];const E=u;let m;e[2]===Symbol.for("react.memo_cache_sentinel")?(m=[Jo(8),er({fallbackPlacements:["top-start"]}),tr({padding:8})],e[2]=m):m=e[2];let p;e[3]!==E?(p={placement:"bottom-start",middleware:m,whileElementsMounted:E},e[3]=E,e[4]=p):p=e[4];const{refs:S,floatingStyles:x,update:N,x:A,y:R}=nr(p),T=A!==0&&R!==0;let b,y;e[5]!==T?(b=()=>{var $;T&&(($=h.current)==null||$.focus())},y=[T],e[5]=T,e[6]=b,e[7]=y):(b=e[6],y=e[7]),g.useEffect(b,y);const I=S.setReference,v=S.setFloating;let w,L;e[8]!==a||e[9]!==c||e[10]!==l||e[11]!==I||e[12]!==N?(w=()=>{var X;if(!l||a==null){I(null);return}const $={contextElement:(X=c.current)!=null?X:void 0,getBoundingClientRect:()=>{try{const M=l.coordsAtPos(a);return new DOMRect(M.left,M.bottom,0,0)}catch(M){return new DOMRect}}};return I($),N(),()=>{I(null)}},L=[a,c,l,I,N],e[8]=a,e[9]=c,e[10]=l,e[11]=I,e[12]=N,e[13]=w,e[14]=L):(w=e[13],L=e[14]),g.useEffect(w,L);let _,F;e[15]!==r?(_=()=>{const $=M=>{const Q=f.current;Q&&(M.target instanceof Node&&Q.contains(M.target)||r())},X=M=>{const Q=f.current;if(!Q){r();return}M.target instanceof Node&&Q.contains(M.target)||r()};return document.addEventListener("pointerdown",$,!0),document.addEventListener("focusin",X,!0),()=>{document.removeEventListener("pointerdown",$,!0),document.removeEventListener("focusin",X,!0)}},F=[r],e[15]=r,e[16]=_,e[17]=F):(_=e[16],F=e[17]),g.useEffect(_,F);let G;e[18]!==v?(G=$=>{f.current=$,v($)},e[18]=v,e[19]=G):G=e[19];let D;e[20]===Symbol.for("react.memo_cache_sentinel")?(D=ue(Ms.toolbar,"absolute"),e[20]=D):D=e[20];let K;e[21]!==x?(K=qe(me({},x),{width:"max-content",minWidth:fc}),e[21]=x,e[22]=K):K=e[22];let H;e[23]!==d?(H=d.formatMessage(Ps.placeholder),e[23]=d,e[24]=H):H=e[24];let j;e[25]!==d?(j=d.formatMessage(Ps.submitLabel),e[25]=d,e[26]=j):j=e[26];let B;e[27]!==d?(B=d.formatMessage(Ps.cancelLabel),e[27]=d,e[28]=B):B=e[28];let z;e[29]!==r?(z=$=>{$.key==="Escape"&&($.preventDefault(),r())},e[29]=r,e[30]=z):z=e[30];let W;e[31]!==n?(W=n.trim(),e[31]=n,e[32]=W):W=e[32];const J=W==="";let U;e[33]!==i||e[34]!==r||e[35]!==s||e[36]!==o||e[37]!==H||e[38]!==j||e[39]!==B||e[40]!==z||e[41]!==J||e[42]!==n?(U=k.jsx(ys,{children:k.jsx("div",{className:"flex min-w-0 flex-1",children:k.jsx(Or,{inputRef:h,value:n,onChange:s,placeholder:H,onSubmit:o,onCancel:r,isLoading:i,submitAriaLabel:j,cancelAriaLabel:B,disabled:i,selectAllOnFocus:!1,onKeyDownCapture:z,isSubmitDisabled:J,inputClassName:"w-full"})})}),e[33]=i,e[34]=r,e[35]=s,e[36]=o,e[37]=H,e[38]=j,e[39]=B,e[40]=z,e[41]=J,e[42]=n,e[43]=U):U=e[43];let P;return e[44]!==G||e[45]!==K||e[46]!==U?(P=k.jsx("div",{ref:G,className:D,style:K,children:U}),e[44]=G,e[45]=K,e[46]=U,e[47]=P):P=e[47],P}const ls=xs({accept:{id:"J+eMXp",defaultMessage:"Accept edit"},acceptAll:{id:"C+wqRb",defaultMessage:"Accept all edits"},reject:{id:"ClnYCK",defaultMessage:"Undo"},rejectAll:{id:"niZJIE",defaultMessage:"Undo all"}}),mc=[Oi.Mod,"Enter"],Do=36;function Oo(t){"use forget";const e=tt.c(64),{editorView:n,editorRootRef:s,activeEntryId:o,onAccept:r,onReject:i,findSuggestionElements:a,fullscreenMode:l}=t,c=At(),d=g.useRef(null),[f,h]=g.useState(0),[u,E]=g.useState(null),m=_n(),p=f>1;let S;e[0]===Symbol.for("react.memo_cache_sentinel")?(S=q=>{E(oe=>{const ae=oe==null,se=q==null;return ae&&se||!ae&&!se&&oe.top===q.top&&oe.height===q.height?oe:q})},e[0]=S):S=e[0];const x=S;let N;e[1]!==o||e[2]!==a||e[3]!==s?(N=()=>{if(a)return a(s.current,o);const q=s.current;if(!q||!o)return h(0),[];const oe=q.querySelectorAll("[data-me-role='sugg']"),ae=[];for(let se=0;se<oe.length;se++){const we=oe[se];we&&we.dataset.meId===o&&ae.push(we)}return h(ae.length),ae},e[1]=o,e[2]=a,e[3]=s,e[4]=N):N=e[4];const A=N,R=g.useRef(null);let T;e[5]!==o||e[6]!==s||e[7]!==A?(T=()=>{var de,at,Ye,Xe;if(!o)return;const q=s.current,oe=Array.from((at=(de=s.current)==null?void 0:de.querySelectorAll("[data-me-role='orig']"))!=null?at:[]),ae=A(),se=(Ye=oe[0])!=null?Ye:ae[0],we=(Xe=ae[ae.length-1])!=null?Xe:oe[oe.length-1];if(!q||!we||!se){x(null);return}const Dt=q.getBoundingClientRect(),{top:it}=se.getBoundingClientRect(),{bottom:Re}=we.getBoundingClientRect();x({top:it-Dt.top-Do,height:Re-it+Do*2})},e[5]=o,e[6]=s,e[7]=A,e[8]=T):T=e[8];const b=T;let y,I;e[9]!==b?(y=()=>{b()},I=[b],e[9]=b,e[10]=y,e[11]=I):(y=e[10],I=e[11]),fn(y,I);let v,w;e[12]!==o||e[13]!==b?(v=()=>{if(o)return window.addEventListener("resize",b),()=>{window.removeEventListener("resize",b)}},w=[o,b],e[12]=o,e[13]=b,e[14]=v,e[15]=w):(v=e[14],w=e[15]),g.useEffect(v,w);const L=o!=null&&u!=null;let _;e[16]!==n||e[17]!==L||e[18]!==i?(_={editorView:n,toolbarContentRef:d,isToolbarOpen:L,onDismiss:i,dismissOnPointerDown:!1},e[16]=n,e[17]=L,e[18]=i,e[19]=_):_=e[19],Lr(_);let F;e[20]!==o||e[21]!==s||e[22]!==r?(F=()=>{var ae,se;if(!o)return;const q=(se=(ae=s.current)==null?void 0:ae.ownerDocument)!=null?se:document,oe=we=>{ai(we)||li(we)!==ci()||we.key!=="Enter"||(we.preventDefault(),r())};return q.addEventListener("keydown",oe,!0),()=>{q.removeEventListener("keydown",oe,!0)}},e[20]=o,e[21]=s,e[22]=r,e[23]=F):F=e[23];let G;e[24]!==o||e[25]!==m||e[26]!==s||e[27]!==c||e[28]!==r?(G=[o,s,r,m,c],e[24]=o,e[25]=m,e[26]=s,e[27]=c,e[28]=r,e[29]=G):G=e[29],g.useEffect(F,G);const D=p?ls.acceptAll:ls.accept,K=p?ls.rejectAll:ls.reject;let H;e[30]!==c||e[31]!==K?(H=c.formatMessage(K),e[30]=c,e[31]=K,e[32]=H):H=e[32];let j;e[33]===Symbol.for("react.memo_cache_sentinel")?(j=k.jsx("span",{className:"text-token-text-tertiary ms-1.5 text-sm font-medium",children:k.jsx(Yo,{id:"R6HH9/",defaultMessage:"ESC"})}),e[33]=j):j=e[33];let B;e[34]!==i||e[35]!==H?(B=k.jsx(Es,{label:H,onClick:i,labelClassName:"font-semibold text-black! dark:text-white!",iconClassName:"text-black! dark:text-gray-400!",subLabel:j}),e[34]=i,e[35]=H,e[36]=B):B=e[36];let z;e[37]!==D||e[38]!==c?(z=c.formatMessage(D),e[37]=D,e[38]=c,e[39]=z):z=e[39];let W;e[40]!==D||e[41]!==c?(W=c.formatMessage(D),e[40]=D,e[41]=c,e[42]=W):W=e[42];let J;e[43]===Symbol.for("react.memo_cache_sentinel")?(J=k.jsx("span",{className:ue(bs.keyBindingTight,"ms-1.5 [&_kbd]:text-blue-100! dark:[&_kbd]:text-white/40!"),children:k.jsx(zs,{binding:mc})}),e[43]=J):J=e[43];let U;e[44]!==W?(U=k.jsx(Ar,{label:W,subLabel:J,labelClassName:"font-semibold text-white"}),e[44]=W,e[45]=U):U=e[45];let P;e[46]!==r||e[47]!==z||e[48]!==U?(P=k.jsx(fs,{onClick:r,"aria-label":z,className:"bg-token-interactive-label-accent-default ms-1 flex h-full items-center gap-1 rounded-lg px-2 dark:bg-blue-500",children:U}),e[46]=r,e[47]=z,e[48]=U,e[49]=P):P=e[49];let $;e[50]!==B||e[51]!==P?($=k.jsxs(ys,{children:[B,P]}),e[50]=B,e[51]=P,e[52]=$):$=e[52];const X=$;if(!L)return null;let M;e[53]!==o||e[54]!==X?(M=o&&k.jsx("div",{"aria-hidden":"true",className:"pointer-events-none invisible fixed start-0 top-0 h-0 overflow-clip",children:k.jsx("div",{ref:R,children:X})}),e[53]=o,e[54]=X,e[55]=M):M=e[55];let Q;e[56]!==l||e[57]!==L||e[58]!==u||e[59]!==X?(Q=L&&k.jsx("div",{ref:d,style:{top:u.top,height:u.height},className:"pointer-events-none absolute start-1/2 -translate-x-1/2",children:k.jsx("div",{className:ue("pointer-events-auto sticky",l?"top-2":"thread-xl:top-2 top-[calc(var(--header-height,48px)+8px)]"),children:X})}),e[56]=l,e[57]=L,e[58]=u,e[59]=X,e[60]=Q):Q=e[60];let ne;return e[61]!==M||e[62]!==Q?(ne=k.jsxs(k.Fragment,{children:[M,Q]}),e[61]=M,e[62]=Q,e[63]=ne):ne=e[63],ne}const Fo=8;function hc(t){"use forget";var L;const e=tt.c(35),{editorRootRef:n,activeEntry:s,onAccept:o,onReject:r,focusEditor:i}=t;let a;e[0]===Symbol.for("react.memo_cache_sentinel")?(a=[],e[0]=a):a=e[0];const[l,c]=g.useState(a),d=At(),f=(L=s==null?void 0:s.id)!=null?L:null,h=g.useRef(!1);let u;e[1]!==s||e[2]!==n?(u=()=>{const _=n.current,F=s;if(!_||!F){c([]);return}F.segments.length>1&&(h.current=!0);const G=_.getBoundingClientRect(),D=[];F.segments.forEach(K=>{const H=K.index,j=_.querySelector("[data-me-role='sugg'][data-me-id='".concat(F.id,"'][data-me-segment='").concat(H,"']")),B=_.querySelector("[data-me-role='orig'][data-me-id='".concat(F.id,"'][data-me-segment='").concat(H,"']")),z=j!=null?j:B;if(!z)return;const W=z.getBoundingClientRect();D.push({segmentIndex:H,top:W.bottom-G.top-Fo})}),D.length>1||h.current?c(D):c([])},e[1]=s,e[2]=n,e[3]=u):u=e[3];const E=u;let m,p;e[4]!==E?(m=()=>{E()},p=[E],e[4]=E,e[5]=m,e[6]=p):(m=e[5],p=e[6]),fn(m,p);let S,x;e[7]!==s||e[8]!==E?(S=()=>{if(!s)return;const _=()=>{E()};return window.addEventListener("resize",_),window.addEventListener("scroll",_,!0),()=>{window.removeEventListener("resize",_),window.removeEventListener("scroll",_,!0)}},x=[s,E],e[7]=s,e[8]=E,e[9]=S,e[10]=x):(S=e[9],x=e[10]),g.useEffect(S,x);let N;e:{if(!f){let F;e[11]===Symbol.for("react.memo_cache_sentinel")?(F=[],e[11]=F):F=e[11],N=F;break e}let _;if(e[12]!==f||e[13]!==l){let F;e[15]!==f?(F=G=>qe(me({},G),{key:"".concat(f,"-").concat(G.segmentIndex)}),e[15]=f,e[16]=F):F=e[16],_=l.map(F),e[12]=f,e[13]=l,e[14]=_}else _=e[14];N=_}const A=N;let R;e[17]!==i||e[18]!==o?(R=_=>{o(_),i()},e[17]=i,e[18]=o,e[19]=R):R=e[19];const T=R;let b;e[20]!==i||e[21]!==r?(b=_=>{r(_),i()},e[20]=i,e[21]=r,e[22]=b):b=e[22];const y=b;if(!f||A.length===0)return null;let I;e[23]===Symbol.for("react.memo_cache_sentinel")?(I=ue("pointer-events-none absolute inset-0",Ms.toolbar),e[23]=I):I=e[23];let v;if(e[24]!==T||e[25]!==y||e[26]!==d||e[27]!==A){let _;e[29]!==T||e[30]!==y||e[31]!==d?(_=F=>{const G={top:F.top,right:Fo};return k.jsxs(ur,{className:ue("bg-primary text-token-text-primary pointer-events-auto m-0 flex h-9 items-center gap-0.5 rounded-xl px-1 py-1.5 dark:bg-[#353535]","pointer-events-auto absolute",Gs),style:G,children:[k.jsx(fs,{type:"button","aria-label":d.formatMessage({id:"0VTqgn",defaultMessage:"Undo segment"}),className:"dark:hover:bg-token-interactive-bg-secondary-hover focus-visible:outline-token-interactive-label-accent-default text-token-text-primary flex h-7 w-7 items-center justify-center rounded-lg hover:bg-black/5 focus-visible:outline-2 focus-visible:outline-offset-2",onClick:()=>y(F.segmentIndex),children:k.jsx(Fi,{className:"h-4 w-4"})}),k.jsx(cr,{className:"bg-token-border-default h-4 w-[1px] list-none p-0"}),k.jsx(fs,{type:"button","aria-label":d.formatMessage({id:"oV/UED",defaultMessage:"Accept segment"}),className:ue("focus-visible:outline-token-interactive-label-accent-default dark:hover:bg-token-interactive-bg-secondary-hover flex h-7 w-7 items-center justify-center rounded-lg text-[rgba(2,133,255,1)] hover:bg-black/5 focus-visible:outline-2 focus-visible:outline-offset-2"),onClick:()=>T(F.segmentIndex),children:k.jsx(ui,{className:"h-4 w-4"})})]},F.key)},e[29]=T,e[30]=y,e[31]=d,e[32]=_):_=e[32],v=A.map(_),e[24]=T,e[25]=y,e[26]=d,e[27]=A,e[28]=v}else v=e[28];let w;return e[33]!==v?(w=k.jsx("div",{className:I,children:v}),e[33]=v,e[34]=w):w=e[34],w}const Bo=xs({text:{id:"+lD8Gj",defaultMessage:"Text"},heading1:{id:"rIYI87",defaultMessage:"Heading 1"},heading2:{id:"TDeCdX",defaultMessage:"Heading 2"},heading3:{id:"g1V+cN",defaultMessage:"Heading 3"},orderedList:{id:"rCWWta",defaultMessage:"Numbered list"},unorderedList:{id:"TxDV7n",defaultMessage:"Bulleted list"},divider:{id:"5lM+d4",defaultMessage:"Divider"},generate:{id:"xa7JTa",defaultMessage:"Generate text"},menuLabel:{id:"ZmuIH8",defaultMessage:"Insert options"}}),pc="text-token-text-primary hover:text-token-text-primary dark:hover:bg-token-main-surface-secondary rounded-[10px] px-2.5 py-1.5 text-left text-sm hover:bg-[#f5f5f5] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-token-border-strong";function Fr(t){"use forget";var P,$,X;const e=tt.c(46),{state:n,style:s,floatingRef:o,dispatchSlashMenuMeta:r,disabledOptionIds:i}=t,a=At(),l=g.useRef(null);let c;e[0]!==n?(c=bt(n),e[0]=n,e[1]=c):c=e[1];const d=c;n==null||n.visibleOptionIds;let f;e[2]!==(n==null?void 0:n.visibleOptionIds)?(f=(P=n==null?void 0:n.visibleOptionIds)!=null?P:[],e[2]=n==null?void 0:n.visibleOptionIds,e[3]=f):f=e[3];const h=f,u=($=n==null?void 0:n.highlightedOptionId)!=null?$:null;let E;e[4]!==r?(E=()=>{r({type:"close"})},e[4]=r,e[5]=E):E=e[5];const m=E;let p;e[6]!==r?(p=M=>{r({type:"highlight",commandId:M})},e[6]=r,e[7]=p):p=e[7];const S=p;let x;e[8]!==r?(x=M=>{r({type:"execute",commandId:M})},e[8]=r,e[9]=x):x=e[9];const N=x;let A;e[10]!==i||e[11]!==N?(A=new Map,Hl().forEach(M=>{var ne;const Q=M.disabled||((ne=i==null?void 0:i.includes(M.id))!=null?ne:!1);A.set(M.id,{id:M.id,messageKey:M.messageKey,disabled:Q,onSelect:()=>{N(M.id)}})}),e[10]=i,e[11]=N,e[12]=A):A=e[12];const R=A;let T;if(e[13]!==R||e[14]!==h){let M;e[16]!==R?(M=Q=>{var ne;return(ne=R.get(Q))!=null?ne:null},e[16]=R,e[17]=M):M=e[17],T=h.map(M).filter(Ec),e[13]=R,e[14]=h,e[15]=T}else T=e[15];const b=T;let y;e[18]!==S||e[19]!==u||e[20]!==b.length?(y=M=>{const Q=M.id===u;return k.jsx("button",{type:"button",role:"menuitem","data-highlighted":Q?"true":void 0,className:ue(pc,M.disabled&&"cursor-not-allowed opacity-50",Q&&"dark:bg-token-main-surface-secondary bg-[#f5f5f5]"),disabled:M.disabled,"aria-disabled":M.disabled?"true":void 0,onClick:()=>{M.disabled||(S(M.id),M.onSelect())},onPointerDown:ne=>{ne.preventDefault(),ne.stopPropagation(),M.disabled||(S(M.id),M.onSelect())},onMouseEnter:()=>{b.length>0&&S(M.id)},onFocus:()=>{b.length>0&&S(M.id)},children:k.jsx(Yo,me({},Bo[M.messageKey]))},M.id)},e[18]=S,e[19]=u,e[20]=b.length,e[21]=y):y=e[21];const I=y,v=(X=b.find(yc))!=null?X:null,w=b.filter(bc);let L,_;e[22]!==m||e[23]!==d||e[24]!==b.length?(L=()=>{d&&(b.length>0||m())},_=[d,m,b.length],e[22]=m,e[23]=d,e[24]=b.length,e[25]=L,e[26]=_):(L=e[25],_=e[26]),g.useEffect(L,_);let F,G;e[27]!==m||e[28]!==d?(F=()=>{if(!d)return;const M=Q=>{l.current&&(Q.target instanceof Node&&l.current.contains(Q.target)||m())};return document.addEventListener("pointerdown",M,!0),()=>{document.removeEventListener("pointerdown",M,!0)}},G=[d,m],e[27]=m,e[28]=d,e[29]=F,e[30]=G):(F=e[29],G=e[30]),g.useEffect(F,G);let D,K;if(e[31]!==m||e[32]!==d?(D=()=>{if(!d)return;const M=ne=>{if(!l.current){m();return}ne.target instanceof Node&&l.current.contains(ne.target)||m()},Q=()=>{m()};return window.addEventListener("blur",Q),document.addEventListener("focusin",M,!0),()=>{window.removeEventListener("blur",Q),document.removeEventListener("focusin",M,!0)}},K=[d,m],e[31]=m,e[32]=d,e[33]=D,e[34]=K):(D=e[33],K=e[34]),g.useEffect(D,K),!d)return null;let H;e[35]!==o?(H=M=>{l.current=M,o==null||o(M)},e[35]=o,e[36]=H):H=e[36];const j="menu";let B;e[37]!==a?(B=a.formatMessage(Bo.menuLabel),e[37]=a,e[38]=B):B=e[38];let z;e[39]===Symbol.for("react.memo_cache_sentinel")?(z=ue(Ms.toolbar,Gs,"writing-block-slash-menu popover bg-token-main-surface-primary absolute w-fit rounded-2xl p-1.5","flex flex-col gap-1"),e[39]=z):z=e[39];const W=-1,J=b.length===0?null:k.jsxs(k.Fragment,{children:[v?I(v):null,v&&w.length>0?k.jsx("div",{"aria-hidden":"true",role:"separator",className:"border-token-border-subtle w-full border-t opacity-100"}):null,w.map(M=>I(M))]});let U;return e[40]!==s||e[41]!==H||e[42]!==B||e[43]!==z||e[44]!==J?(U=k.jsx("div",{ref:H,role:j,"aria-label":B,className:z,style:s,tabIndex:W,children:J}),e[40]=s,e[41]=H,e[42]=B,e[43]=z,e[44]=J,e[45]=U):U=e[45],U}function bc(t){return t.id!=="generate"}function yc(t){return t.id==="generate"}function Ec(t){return t!=null}Fr.displayName="WritingBlockSlashMenu";const jo=10,zo=-35,on=8,Ho=(t,e,n)=>Math.max(e,Math.min(n,t)),$o={pointer:0,caret:1,select:2},xc=t=>{"use forget";const e=tt.c(97),{editorAreaRef:n,isInlineWritingBlockEditEnabled:s,docChangeCount:o,selectionIsCollapsed:r,isFormatToolbarOpen:i,magicEditTriggerCount:a,onSelectNuxVisibilityChange:l,analyticsMetadata:c}=t,d=i===void 0?!1:i,f=a===void 0?0:a,h=_n(),u=At();let E;e[0]===Symbol.for("react.memo_cache_sentinel")?(E=di(),e[0]=E):E=e[0];const m=E,p=or(rr.WritingBlockNux),{eligible:S,isLoading:x}=Cs(sn.hasSeenWritingInlineEditNux),{eligible:N}=Cs(sn.hasSeenWritingInlineEditCaretNux),{eligible:A,isLoading:R}=Cs(sn.hasSeenWritingInlineEditSelectNux),[T,b]=g.useState(!1),[y,I]=g.useState(null),[v,w]=g.useState(null),[L,_]=g.useState(!1),[F,G]=g.useState(!1),[D,K]=g.useState(!1),H=g.useRef(!1),j=g.useRef(!1),B=g.useRef(!1),z=g.useRef(null),W=g.useRef(null),J=g.useRef(o),U=g.useRef(f),P=g.useRef(null),$=g.useRef(!1);let X;e[1]!==c.blockId||e[2]!==c.clientThreadId||e[3]!==c.messageId?(X={writingBlockId:c.blockId},c.clientThreadId&&(X.clientThreadId=c.clientThreadId),c.messageId&&(X.messageId=c.messageId),e[1]=c.blockId,e[2]=c.clientThreadId,e[3]=c.messageId,e[4]=X):X=e[4];const M=X;let Q,ne;e[5]===Symbol.for("react.memo_cache_sentinel")?(Q=()=>{P.current=gi()},ne=[],e[5]=Q,e[6]=ne):(Q=e[5],ne=e[6]),g.useEffect(Q,ne);let q;e[7]===Symbol.for("react.memo_cache_sentinel")?(q=()=>{z.current=null,$.current=!1},e[7]=q):q=e[7];let oe;e[8]!==c.blockId?(oe=[c.blockId],e[8]=c.blockId,e[9]=oe):oe=e[9],g.useEffect(q,oe);let ae;e[10]!==n?(ae=()=>{var Ct;const V=n.current;if(!V){w(null);return}const te=document.getSelection();if(!te||te.rangeCount===0||!te.anchorNode||!te.focusNode||!te.isCollapsed||!V.contains(te.anchorNode)&&!V.contains(te.focusNode)){w(null);return}const ye=te.getRangeAt(0),ge=V.getBoundingClientRect();let ce=ye.getBoundingClientRect();if(!Number.isFinite(ce.left)||!Number.isFinite(ce.top)||ce.width===0&&ce.height===0||ce.left===0&&ce.top===0){const $t=ye.getClientRects();if($t.length>0)ce=$t[0];else{let ot=null;const Nt=te.anchorNode;for(Nt&&(ot=Nt instanceof Element?Nt:(Ct=Nt.parentElement)!=null?Ct:null);ot&&ot!==V&&!V.contains(ot);)ot=ot.parentElement;ce=ot&&V.contains(ot)?ot.getBoundingClientRect():ge}}let De=ce.left-ge.left+jo,ht=ce.top-ge.top+zo;const mn=Math.max(on,ge.width-on),Ut=Math.max(on,ge.height-on);De=Ho(De,on,mn),ht=Ho(ht,on,Ut),w({x:De,y:ht})},e[10]=n,e[11]=ae):ae=e[11];const se=ae;let we;e[12]!==h?(we=bn(h,"2862575767"),e[12]=h,e[13]=we):we=e[13];const it=!m&&s&&(we||p),Re=it&&S&&!T,de=it&&!S&&!x&&N&&!L,at=de&&F&&v!=null,Ye=Re&&y!=null,Xe=at&&v!=null,Ot=it&&!x&&!R&&!S&&!N&&A&&!D&&d,kt=Xe&&T&&!L;let lt;e:{if(Ye){lt="pointer";break e}if(Xe){lt="caret";break e}if(Ot){lt="select";break e}lt=null}const O=lt;let Z;e[14]!==M?(Z=V=>{const te=P.current;Gt("ChatGPT Writing Block Inline Edit NUX Shown","chatgpt_writing_block_inline_edit_nux_shown",me(qe(me({},M),{phase:V}),te?{sessionLoggingId:te}:{}));const ye=z.current;ye!=null&&$o[V]===$o[ye]+1&&Gt("ChatGPT Writing Block Inline Edit NUX Advanced","chatgpt_writing_block_inline_edit_nux_advanced",me(qe(me({},M),{fromPhase:ye,toPhase:V}),te?{sessionLoggingId:te}:{})),z.current=V},e[14]=M,e[15]=Z):Z=e[15];const re=Z;let le,Ee;e[16]!==O||e[17]!==re?(le=()=>{O&&re(O)},Ee=[O,re],e[16]=O,e[17]=re,e[18]=le,e[19]=Ee):(le=e[18],Ee=e[19]),g.useEffect(le,Ee);let Ie;e[20]===Symbol.for("react.memo_cache_sentinel")?(Ie=()=>{H.current=!1},e[20]=Ie):Ie=e[20];let fe;e[21]!==Re?(fe=[Re],e[21]=Re,e[22]=fe):fe=e[22],g.useEffect(Ie,fe);let Ce;e[23]!==h?(Ce=()=>{b(!0),I(null),Ns(h,sn.hasSeenWritingInlineEditNux)},e[23]=h,e[24]=Ce):Ce=e[24];const _e=Ce;let Oe;e[25]!==h?(Oe=()=>{j.current||(j.current=!0,_(!0),w(null),Ns(h,sn.hasSeenWritingInlineEditCaretNux))},e[25]=h,e[26]=Oe):Oe=e[26];const xe=Oe;let ve;e[27]!==h?(ve=()=>{B.current||(B.current=!0,K(!0),Ns(h,sn.hasSeenWritingInlineEditSelectNux))},e[27]=h,e[28]=ve):ve=e[28];const Ne=ve;let Te;e[29]!==n?(Te=V=>{const te=n.current;if(!te)return!1;if(V.composedPath().includes(te))return!0;const ge=V.target;if(ge instanceof Node&&te.contains(ge))return!0;const ce=te.getBoundingClientRect(),{clientX:mt,clientY:De}=V;return mt>=ce.left&&mt<=ce.right&&De>=ce.top&&De<=ce.bottom},e[29]=n,e[30]=Te):Te=e[30];const He=Te;let Ve,pe;e[31]!==_e||e[32]!==n||e[33]!==He||e[34]!==Re?(Ve=()=>{if(!Re)return;const V=n.current;if(!V)return;const te=()=>{W.current!=null&&(window.clearTimeout(W.current),W.current=null)},ye=De=>{te(),He(De)||I(null)},ge=De=>{if(te(),!He(De)){I(null);return}H.current=!0;const ht=V.getBoundingClientRect();I({x:De.clientX-ht.left+jo,y:De.clientY-ht.top+zo})},ce=()=>{te(),W.current=window.setTimeout(()=>{I(null)},80)},mt=De=>{te(),He(De)&&H.current&&_e()};return V.addEventListener("pointerenter",ye),V.addEventListener("pointermove",ge),V.addEventListener("pointerleave",ce),V.addEventListener("pointercancel",ce),V.addEventListener("pointerdown",mt),()=>{te(),V.removeEventListener("pointerenter",ye),V.removeEventListener("pointermove",ge),V.removeEventListener("pointerleave",ce),V.removeEventListener("pointercancel",ce),V.removeEventListener("pointerdown",mt)}},pe=[n,_e,He,Re],e[31]=_e,e[32]=n,e[33]=He,e[34]=Re,e[35]=Ve,e[36]=pe):(Ve=e[35],pe=e[36]),g.useEffect(Ve,pe);let be,Fe;e[37]!==_e||e[38]!==Re?(be=()=>{if(!Re)return;const V=te=>{te.key==="Escape"&&_e()};return window.addEventListener("keydown",V),()=>window.removeEventListener("keydown",V)},Fe=[_e,Re],e[37]=_e,e[38]=Re,e[39]=be,e[40]=Fe):(be=e[39],Fe=e[40]),g.useEffect(be,Fe);let We,dt;e[41]!==n||e[42]!==de||e[43]!==se?(We=()=>{const V=n.current;if(!V)return;const te=()=>{G(!0),de&&se()},ye=ge=>{const ce=ge.relatedTarget;ce instanceof Node&&V.contains(ce)||(G(!1),w(null))};return V.addEventListener("focusin",te),V.addEventListener("focusout",ye),()=>{V.removeEventListener("focusin",te),V.removeEventListener("focusout",ye)}},dt=[n,de,se],e[41]=n,e[42]=de,e[43]=se,e[44]=We,e[45]=dt):(We=e[44],dt=e[45]),g.useEffect(We,dt);let ct,nt;e[46]!==de||e[47]!==se?(ct=()=>{if(de)return queueMicrotask(()=>{se()}),document.addEventListener("selectionchange",se),window.addEventListener("resize",se),document.addEventListener("scroll",se,!0),()=>{document.removeEventListener("selectionchange",se),window.removeEventListener("resize",se),document.removeEventListener("scroll",se,!0)}},nt=[de,se],e[46]=de,e[47]=se,e[48]=ct,e[49]=nt):(ct=e[48],nt=e[49]),g.useEffect(ct,nt);let Ae,st;e[50]!==xe||e[51]!==o||e[52]!==de?(Ae=()=>{if(!de){J.current=o;return}o!==J.current&&(J.current=o,queueMicrotask(()=>{xe()}))},st=[xe,o,de],e[50]=xe,e[51]=o,e[52]=de,e[53]=Ae,e[54]=st):(Ae=e[53],st=e[54]),g.useEffect(Ae,st);let ft,wt;e[55]!==xe||e[56]!==de||e[57]!==r?(ft=()=>{de&&(r||queueMicrotask(()=>{xe()}))},wt=[xe,de,r],e[55]=xe,e[56]=de,e[57]=r,e[58]=ft,e[59]=wt):(ft=e[58],wt=e[59]),g.useEffect(ft,wt);let Et,gt;e[60]!==Ne||e[61]!==f?(Et=()=>{if(f===U.current||f===0){U.current=f;return}U.current=f,queueMicrotask(()=>{Ne()})},gt=[Ne,f],e[60]=Ne,e[61]=f,e[62]=Et,e[63]=gt):(Et=e[62],gt=e[63]),g.useEffect(Et,gt);let Be,Ft;e[64]!==l||e[65]!==Ot?(Be=()=>{l==null||l(Ot)},Ft=[l,Ot],e[64]=l,e[65]=Ot,e[66]=Be,e[67]=Ft):(Be=e[66],Ft=e[67]),g.useEffect(Be,Ft);let $e,It;e[68]!==M||e[69]!==D?($e=()=>{if($.current||!D)return;const V=P.current;Gt("ChatGPT Writing Block Inline Edit NUX Completed","chatgpt_writing_block_inline_edit_nux_completed",me(me({},M),V?{sessionLoggingId:V}:{})),$.current=!0},It=[M,D],e[68]=M,e[69]=D,e[70]=$e,e[71]=It):($e=e[70],It=e[71]),g.useEffect($e,It);let _t;e[72]!==u?(_t=u.formatMessage({id:"sN5Jyl",defaultMessage:"Click to edit"}),e[72]=u,e[73]=_t):_t=e[73];const Le=_t;let je;e[74]!==u?(je=u.formatMessage({id:"z5OrYQ",defaultMessage:"Start typing or select text"}),e[74]=u,e[75]=je):je=e[75];const Me=je;let Bt;e:{if(!Ye||!y){Bt=null;break e}let V;e[76]!==u?(V=u.formatMessage({id:"HJxwKm",defaultMessage:"New!"}),e[76]=u,e[77]=V):V=e[77];let te;e[78]!==V?(te=k.jsx("span",{className:"text-white/75",children:V}),e[78]=V,e[79]=te):te=e[79];let ye;e[80]!==Le?(ye=k.jsx("span",{children:Le}),e[80]=Le,e[81]=ye):ye=e[81];let ge;e[82]!==te||e[83]!==ye?(ge=k.jsxs(k.Fragment,{children:[te,ye]}),e[82]=te,e[83]=ye,e[84]=ge):ge=e[84];let ce;e[85]!==y||e[86]!==ge?(ce={key:"writing-inline-edit-nux",position:y,message:ge},e[85]=y,e[86]=ge,e[87]=ce):ce=e[87],Bt=ce}const xt=Bt;let jt;e:{if(!Xe||!v){jt=null;break e}const V=kt?"writing-inline-edit-nux":"writing-inline-edit-nux-caret";let te;e[88]!==Me||e[89]!==v||e[90]!==V?(te={key:V,position:v,message:Me},e[88]=Me,e[89]=v,e[90]=V,e[91]=te):te=e[91],jt=te}const Rt=jt,ut=xt!=null?xt:Rt;if(m)return null;let Mt;e[92]!==ut||e[93]!==Xe?(Mt=ut&&k.jsx(Mc,{position:ut.position,message:ut.message,interactive:Xe,anchor:ut.anchor},ut.key),e[92]=ut,e[93]=Xe,e[94]=Mt):Mt=e[94];let Tt;return e[95]!==Mt?(Tt=k.jsx(mi,{children:Mt}),e[95]=Mt,e[96]=Tt):Tt=e[96],Tt},Mc=t=>{"use forget";const e=tt.c(36),{position:n,message:s,interactive:o,anchor:r}=t,i=o===void 0?!1:o,a=r===void 0?"top-left":r,l=g.useRef(null);let c;e[0]===Symbol.for("react.memo_cache_sentinel")?(c={width:0,height:0},e[0]=c):c=e[0];const[d,f]=g.useState(c),h=ao(n.x),u=ao(n.y);let E;e[1]===Symbol.for("react.memo_cache_sentinel")?(E={stiffness:160,damping:20,mass:.6},e[1]=E):E=e[1];const m=lo(h,E);let p;e[2]===Symbol.for("react.memo_cache_sentinel")?(p={stiffness:160,damping:20,mass:.6},e[2]=p):p=e[2];const S=lo(u,p);let x;e[3]===Symbol.for("react.memo_cache_sentinel")?(x=()=>{const B=l.current;if(!B){f({width:0,height:0});return}const z=()=>{const J=B.getBoundingClientRect();f({width:J.width,height:J.height})};if(z(),typeof ResizeObserver>"u")return;const W=new ResizeObserver(()=>{z()});return W.observe(B),()=>{W.disconnect()}},e[3]=x):x=e[3];let N;e[4]!==s?(N=[s],e[4]=s,e[5]=N):N=e[5],fn(x,N);let A=n.x,R=n.y;(a==="top-center"||a==="bottom-center")&&(A=A-d.width/2),a==="bottom-center"&&(R=R-d.height);let T;e[6]!==A||e[7]!==R?(T={x:A,y:R},e[6]=A,e[7]=R,e[8]=T):T=e[8];const b=T;let y,I;e[9]!==b.x||e[10]!==b.y||e[11]!==m||e[12]!==S||e[13]!==h||e[14]!==u?(I=()=>{m.set(b.x),S.set(b.y),h.set(b.x),u.set(b.y)},y=[b.x,b.y,m,S,h,u],e[9]=b.x,e[10]=b.y,e[11]=m,e[12]=S,e[13]=h,e[14]=u,e[15]=y,e[16]=I):(y=e[15],I=e[16]),fn(I,y);let v,w;e[17]!==b.x||e[18]!==b.y||e[19]!==h||e[20]!==u?(v=()=>{h.set(b.x),u.set(b.y)},w=[b.x,b.y,h,u],e[17]=b.x,e[18]=b.y,e[19]=h,e[20]=u,e[21]=v,e[22]=w):(v=e[21],w=e[22]),g.useEffect(v,w);let L,_,F,G;e[23]===Symbol.for("react.memo_cache_sentinel")?(L={opacity:0,scale:.95},_={opacity:1,scale:1},F={opacity:0,scale:.95},G={type:"spring",stiffness:500,damping:45,mass:.5},e[23]=L,e[24]=_,e[25]=F,e[26]=G):(L=e[23],_=e[24],F=e[25],G=e[26]);let D;e[27]!==m||e[28]!==S?(D={x:m,y:S},e[27]=m,e[28]=S,e[29]=D):D=e[29];const K=(i?"pointer-events-auto ":"pointer-events-none ")+"flex items-center gap-1 rounded-lg bg-blue-400 px-2 py-1 text-xs font-semibold text-white shadow-[0_4px_12px_rgba(0,0,0,0.16)] dark:shadow-[0_4px_12px_rgba(0,0,0,0.4)]";let H;e[30]!==s||e[31]!==K?(H=k.jsx("div",{className:K,"data-testid":"writing-inline-edit-nux",children:s}),e[30]=s,e[31]=K,e[32]=H):H=e[32];let j;return e[33]!==D||e[34]!==H?(j=k.jsx(fi.div,{className:"pointer-events-none fixed z-30",initial:L,animate:_,exit:F,transition:G,style:D,ref:l,children:H}),e[33]=D,e[34]=H,e[35]=j):j=e[35],j};function Sc(t){"use forget";const e=tt.c(48),{disabled:n,editorView:s,isMagicEditLoading:o,submitMagicEdit:r,cancelMagicEdit:i,applyMagicEditResult:a,magicEditSubmissionSource:l}=t,c=n===void 0?!1:n,d=At(),[f,h]=g.useState(""),u=g.useRef(null),E=g.useRef(!1);let m;e[0]!==a||e[1]!==c||e[2]!==s.state.doc.content.size||e[3]!==f||e[4]!==r?(m=async M=>{var se;if(c)return;E.current=!1,M==null||M.preventDefault(),M==null||M.stopPropagation();const Q={from:0,to:s.state.doc.content.size},ne=f.trim();if(!ne)return;const q=await r({instruction:ne,range:Q,submissionSource:kn.FULLSCREEN_COMPOSER});if(!q||E.current)return;const oe=(se=q.replacements[0])!=null?se:"";a({magicEditId:q.magicEditId,replacement:oe,range:Q})&&h("")},e[0]=a,e[1]=c,e[2]=s.state.doc.content.size,e[3]=f,e[4]=r,e[5]=m):m=e[5];const p=m,[S,x]=g.useState(null);let N,A;e[6]!==S?(N=()=>{if(u.current&&S==null){const M=parseFloat(getComputedStyle(u.current).lineHeight);x(M)}},A=[S],e[6]=S,e[7]=N,e[8]=A):(N=e[7],A=e[8]),g.useEffect(N,A);const[R,T]=g.useState(1),[b,y]=g.useState(!1);let I,v;e[9]!==b||e[10]!==S||e[11]!==f||e[12]!==R?(I=()=>{const M=u.current;if(!M||S==null)return;M.style.height="auto";const Q=M.scrollHeight;M.style.height="".concat(Q,"px");const ne=Math.max(1,Math.floor(Q/S));if(R!==ne&&T(ne),ne>1){b||y(!0);return}b&&f.length===0&&y(!1)},v=[f,S,b,R],e[9]=b,e[10]=S,e[11]=f,e[12]=R,e[13]=I,e[14]=v):(I=e[13],v=e[14]),fn(I,v);let w;e[15]!==i?(w=()=>{E.current=!0,i()},e[15]=i,e[16]=w):w=e[16];const L=w;let _;e[17]!==c||e[18]!==p?(_=M=>{if(M.key==="Enter"&&!M.shiftKey&&!M.nativeEvent.isComposing){if(M.preventDefault(),c){M.stopPropagation();return}p(M)}},e[17]=c,e[18]=p,e[19]=_):_=e[19];const F=_,G=R>1||b,D=G?"flex-wrap items-stretch":"flex-nowrap items-center gap-2";let K;e[20]!==D?(K=ue("bg-token-bg-primary shadow-short fixed start-1/2 z-20 flex h-auto w-[min(90vw,40rem)] -translate-x-1/2 transform items-center rounded-[28px] dark:dark:bg-[#303030] dark:shadow-[0px_4px_12px_0px_var(--shadow-color-1,rgba(0,_0,_0,_0.24)),inset_0px_0px_1px_0px_var(--shadow-color-2,rgba(255,_255,_255,_0.3))]","bottom-6 py-2 ps-3 pe-2.5 sm:bottom-8",D),e[20]=D,e[21]=K):K=e[21];let H;e[22]===Symbol.for("react.memo_cache_sentinel")?(H=M=>h(M.target.value),e[22]=H):H=e[22];let j;e[23]!==d?(j=d.formatMessage({id:"o/23xf",defaultMessage:"Describe edits"}),e[23]=d,e[24]=j):j=e[24];const B=G?"w-full":"min-w-0 flex-1";let z;e[25]!==B?(z=ue("text-token-text-primary placeholder:text-token-text-tertiary resize-none overflow-hidden border-none bg-transparent py-1 outline-none focus:border-transparent focus:ring-0 focus:outline-none",B),e[25]=B,e[26]=z):z=e[26];let W;e[27]!==F||e[28]!==f||e[29]!==j||e[30]!==z?(W=k.jsx("textarea",{value:f,rows:1,onChange:H,onKeyDown:F,placeholder:j,ref:u,className:z}),e[27]=F,e[28]=f,e[29]=j,e[30]=z,e[31]=W):W=e[31];const J=G?"w-full justify-end":"justify-center";let U;e[32]!==J?(U=ue("flex flex-shrink-0",J),e[32]=J,e[33]=U):U=e[33];let P;e[34]!==c||e[35]!==L||e[36]!==p||e[37]!==o||e[38]!==f||e[39]!==l?(P=l===kn.FULLSCREEN_COMPOSER&&o?k.jsx(Dr,{size:36,onClick:L}):k.jsx("button",{onClick:p,disabled:f.trim().length===0||c,id:"writing-block-fullscreen-composer-submit-button",className:ue("composer-submit-btn","composer-submit-button-color","flex","h-9","w-9","items-center","justify-center"),children:k.jsx(ir,{className:"icon"})}),e[34]=c,e[35]=L,e[36]=p,e[37]=o,e[38]=f,e[39]=l,e[40]=P):P=e[40];let $;e[41]!==U||e[42]!==P?($=k.jsx("div",{className:U,children:P}),e[41]=U,e[42]=P,e[43]=$):$=e[43];let X;return e[44]!==K||e[45]!==W||e[46]!==$?(X=k.jsxs("div",{className:K,children:[W,$]}),e[44]=K,e[45]=W,e[46]=$,e[47]=X):X=e[47],X}const kc=new Lt({props:{decorations(t){const{doc:e,selection:n}=t;if(n.empty)return yt.empty;const{from:s,to:o}=n,r=[];return e.nodesBetween(s,o,(i,a)=>{if(!i.isBlock||i.type.name!=="paragraph")return;const l=a+i.nodeSize-1;o>l&&s<=l&&r.push(ln.node(a,a+i.nodeSize,{class:"isSelectedEnd"}))}),yt.create(e,r)}}}),wc=({view:t,pmu:e,prompt:n,input:s,conversationId:o})=>{const{anchorPos:r,caretPos:i,triggerPos:a}=s,l={from:Math.min(a,r,i),to:Math.max(r,i)},c=xr({view:t,pmu:e,range:l}),d=Pr(c.fullMarkdown,c.startIndex,c.endIndex);return{conversation_id:o,full_block_body_markdown:c.fullMarkdown,start_index:c.startIndex,end_index:c.endIndex,marked_block_body_markdown:d,instruction:n,num_variations:1,mode:"generate"}};function Ic(t){"use forget";const e=tt.c(13),{view:n,pmu:s}=t,o=Vo(),r=At(),i=g.useRef(!1),a=Qo();let l;e[0]!==a?(l=()=>a==null?void 0:a.serverId$(),e[0]=a,e[1]=l):l=e[1];const c=js(l),{mutateAsync:d,isPending:f}=vr();let h;e[2]!==c||e[3]!==d||e[4]!==r||e[5]!==s||e[6]!==o||e[7]!==n?(h=async S=>{var R;if(!n||!s)return!1;i.current=!1;const x=S.trim();if(x==="")return!1;const N=Je.getState(n.state);if(!(N!=null&&N.input))return!1;let A;try{A=wc({view:n,pmu:s,prompt:x,input:N.input,conversationId:c})}catch(T){const b=r.formatMessage({id:"afsmrO",defaultMessage:"Unable to prepare generate request."});return o.danger(b,{duration:2}),!1}try{const T=await d({payload:A});if(i.current)return!1;let b="";const y=T.choices;if(Array.isArray(y)){const w=y[0];if(typeof w=="string")b=w;else if(w!=null){if(typeof w=="object"){const L=w;if("text"in L){const _=L.text;typeof _=="string"&&(b=_)}}}}const I=crypto.randomUUID();if(!Ua({view:n,pmu:s,suggestionId:I,text:b})){const w=r.formatMessage({id:"FckTpR",defaultMessage:"Unable to insert generated text."});return o.danger(w,{duration:2}),!1}return!0}catch(T){const b=T;if(!i.current){const y=(R=cs(b))!=null?R:r.formatMessage({id:"6QyguR",defaultMessage:"An error occurred while generating text."});o.danger(y,{duration:2})}return!1}},e[2]=c,e[3]=d,e[4]=r,e[5]=s,e[6]=o,e[7]=n,e[8]=h):h=e[8];const u=h;let E;e[9]===Symbol.for("react.memo_cache_sentinel")?(E=()=>{i.current=!0},e[9]=E):E=e[9];const m=E;let p;return e[10]!==f||e[11]!==u?(p={isLoading:f,submitGenerate:u,cancelGenerate:m},e[10]=f,e[11]=u,e[12]=p):p=e[12],p}const _c=(t,e)=>{if(t===e)return!0;if(!t||!e)return t===e;const n=t.input,s=e.input,o=!n&&!s||n!=null&&s!=null&&n.anchorPos===s.anchorPos&&n.caretPos===s.caretPos&&n.blockFrom===s.blockFrom&&n.blockTo===s.blockTo&&n.triggerPos===s.triggerPos,r=t.suggestion,i=e.suggestion,a=!r&&!i||r!=null&&i!=null&&r.id===i.id&&r.from===i.from&&r.to===i.to;return o&&a&&t.lastResolvedSuggestionId===e.lastResolvedSuggestionId&&t.lastResolvedReason===e.lastResolvedReason},Rc=(t,e)=>t===e?!0:t.triggerPos!==e.triggerPos||t.anchorPos!==e.anchorPos||t.query!==e.query||t.normalizedQuery!==e.normalizedQuery||t.highlightedOptionId!==e.highlightedOptionId||t.visibleOptionIds.length!==e.visibleOptionIds.length?!1:t.visibleOptionIds.every((n,s)=>n===e.visibleOptionIds[s]),Go=(t,e)=>t===e?!0:!t||!e?t===e:t.pos===e.pos&&t.nodeSize===e.nodeSize,Wo=(t,e)=>t===e?!0:!t||!e?t===e:t.from===e.from&&t.to===e.to,Tc=(t,e)=>t===e?!0:!t||!e?t===e:t.index===e.index&&Go(t.original,e.original)&&Go(t.suggested,e.suggested)&&Wo(t.originalHighlight,e.originalHighlight)&&Wo(t.suggestedHighlight,e.suggestedHighlight)&&t.selectionStartOffset===e.selectionStartOffset&&t.selectionEndOffset===e.selectionEndOffset,Cc=(t,e)=>{if(t===e)return!0;if(!t||!e)return t===e;if(t.id!==e.id||t.from!==e.from||t.to!==e.to||t.segments.length!==e.segments.length)return!1;for(let n=0;n<t.segments.length;n++)if(!Tc(t.segments[n],e.segments[n]))return!1;return!0},Nc=t=>{if(!t||t.entries.size===0)return null;const e=t.entries.values().next().value;return e!=null?e:null},Pc={editorView:null,slashMenuState:un,generatePluginState:null,activeMagicEditEntry:null,selectionSummary:{isCollapsed:!0},docChangeCount:0},vc=(t,e)=>t.editorView===e.editorView&&Rc(t.slashMenuState,e.slashMenuState)&&_c(t.generatePluginState,e.generatePluginState)&&Cc(t.activeMagicEditEntry,e.activeMagicEditEntry)&&t.selectionSummary.isCollapsed===e.selectionSummary.isCollapsed&&t.docChangeCount===e.docChangeCount,Ac=()=>{let t=Pc;const e=new Set,n=()=>{e.forEach(o=>o())},s=o=>{const r=me(me({},t),o);vc(t,r)||(t=r,n())};return{getSnapshot:()=>t,subscribe:o=>(e.add(o),()=>{e.delete(o)}),setView:o=>{if(!o){s({editorView:null,slashMenuState:un,generatePluginState:null,activeMagicEditEntry:null,selectionSummary:{isCollapsed:!0},docChangeCount:0});return}s({editorView:o})},syncFromState:(o,r,i)=>{var u,E;const a=(u=Ke.getState(o))!=null?u:un,l=(E=Je.getState(o))!=null?E:null,c=r.isMagicEditEnabled?et.getState(o):null,d=r.isMagicEditEnabled?Nc(c):null,f={isCollapsed:o.selection.empty},h=i!=null&&i.docChanged?1:0;s({slashMenuState:a,generatePluginState:l,activeMagicEditEntry:d,selectionSummary:f,docChangeCount:t.docChangeCount+h})}}},Lc=t=>{"use forget";return g.useSyncExternalStore(t.subscribe,t.getSnapshot,t.getSnapshot)},Dc=t=>typeof t=="object"&&t!=null,Oc=t=>{if(!Dc(t)||typeof t.type!="string")return!1;switch(t.type){case"open":return typeof t.triggerPos=="number"&&typeof t.anchorPos=="number";case"close":return!0;case"navigate":return t.direction==="previous"||t.direction==="next";case"highlight":return typeof t.commandId=="string"||t.commandId==null;case"execute":return typeof t.commandId=="string";default:return!1}},zt=(t,e)=>typeof t=="number"&&Number.isFinite(t)?t:e,vs={accept:{applyAction:"use",eventName:"ChatGPT Writing Block Magic Edit Accepted",eventType:"chatgpt_writing_block_magic_edit_accepted"},reject:{applyAction:"keep",eventName:"ChatGPT Writing Block Magic Edit Rejected",eventType:"chatgpt_writing_block_magic_edit_rejected"}};function Uo(t,e,n,s){var i;const o=zt(t.startIndex$(),-1),r=zt(t.endIndex$(),-1);return{writing_block_id:e.blockId,magic_edit_id:n,freeform_feedback:t.freeformFeedback$(),full_block_body_markdown:t.fullBlockBodyMarkdown$(),start_index:zt(s==null?void 0:s.startIndex,o),end_index:zt(s==null?void 0:s.endIndex,r),suggested_content:(i=s==null?void 0:s.suggestedContent)!=null?i:t.replacements$()[0]}}function Fc(t,e,n){var x,N;const{schema:s}=t.state,o=s.nodes.horizontal_rule,r=s.nodes.paragraph;if(!o)return!1;let i=t.state.tr;const a=Math.max(n!=null?n:e+1,e+1);i=i.delete(e,a);const l=i.mapping.map(e,-1),c=i.doc.childBefore(l+1),d=c.node,f=c.offset;if(r&&(d==null?void 0:d.type)===r&&d.isTextblock&&(d==null?void 0:d.content.size)===0){const A=o.create(),R=f+d.nodeSize;i=i.replaceRangeWith(f,R,A);const T=f+A.nodeSize,b=i.doc.childAfter(T);if(!!r&&!b.node&&r){const v=r.create();i=i.insert(T,Ge.from(v));const w=(x=he.findFrom(i.doc.resolve(T+1),1,!0))!=null?x:he.near(i.doc.resolve(T+1),1);return t.dispatch(i.setSelection(w).scrollIntoView()),!0}const I=b!=null&&b.node?he.near(i.doc.resolve(b.offset+1),1):he.near(i.doc.resolve(T),1);return t.dispatch(i.setSelection(I).scrollIntoView()),!0}const u=o.create();i=i.insert(l,Ge.from(u));const E=l+u.nodeSize,m=i.doc.childAfter(E);if(!!r&&!m.node&&r){const A=r.create(),R=E;i=i.insert(R,Ge.from(A));const T=(N=he.findFrom(i.doc.resolve(R+1),1,!0))!=null?N:he.near(i.doc.resolve(R+1),1);return t.dispatch(i.setSelection(T).scrollIntoView()),!0}const S=m!=null&&m.node?he.near(i.doc.resolve(m.offset+1),1):he.near(i.doc.resolve(E),1);return t.dispatch(i.setSelection(S).scrollIntoView()),!0}function Bc(t){"use forget";const e=tt.c(2);let n;return e[0]!==t?(n=Za({shouldStripDirectives:!0,contentReferences:t}),e[0]=t,e[1]=n):n=e[1],n}const cu=t=>{"use forget";var Vs,Qs,Zs,Js,eo;const e=tt.c(227),{analyticsMetadata:n,markdown:s,onChange:o,isDisabled:r,isInlineWritingBlockEditEnabled:i,className:a,wrapperClassName:l,maxLength:c,contentReferences:d,setDirty:f,flushPendingChanges:h,editorViewRef:u,fullscreenMode:E,disableOnChangeDebounce:m}=t,p=E===void 0?!1:E,S=m===void 0?!1:m,x=_n(),N=js(hi),A=At();let R;e[0]!==A?(R=A.formatMessage({id:"IohtFB",defaultMessage:"Write or type ‘/’ for commands..."}),e[0]=A,e[1]=R):R=e[1];const T=R,b=g.useRef(T),y=or(rr.MagicEditEnabled);let I;e[2]!==x?(I=bn(x,"2459982630"),e[2]=x,e[3]=I):I=e[3];const w=y||I;let L;e[4]!==x?(L=bn(x,"3539089402"),e[4]=x,e[5]=L):L=e[5];const _=L;let F;e[6]!==x?(F=bn(x,"1629932585"),e[6]=x,e[7]=F):F=e[7];const G=!1,D=Bc(d),K=zc;let H;e[8]!==n||e[9]!==x?(H=(C,Y,ee,ie,Se)=>{const ke=ie.modelSlug$(),Pe=Uo(ie,n,Y,{startIndex:ee.startIndex,endIndex:ee.endIndex,suggestedContent:ee.suggestedMarkdown});uo(C,Pe,n.clientThreadId,n.messageId,ke,x);const{eventName:Ue,eventType:ze}=vs[C];Gt(Ue,ze,me({magicEditId:Y,magicEditSegmentIndex:ee.index.toString(),magicEditSegmentStartIndex:ee.startIndex.toString(),magicEditSegmentEndIndex:ee.endIndex.toString(),segmentOriginalMarkdown:ee.originalMarkdown,segmentSuggestedMarkdown:ee.suggestedMarkdown,decisionSource:Se},ke?{modelSlug:ke}:{}))},e[8]=n,e[9]=x,e[10]=H):H=e[10];const j=H,B=g.useRef(null),z=g.useRef(null),W=g.useRef(null);let J;e[11]===Symbol.for("react.memo_cache_sentinel")?(J=Ac(),e[11]=J):J=e[11];const U=J,{editorView:P,slashMenuState:$,generatePluginState:X,activeMagicEditEntry:M,selectionSummary:Q,docChangeCount:ne}=Lc(U),q=(Vs=M==null?void 0:M.id)!=null?Vs:null,[oe,ae]=g.useState(""),[se,we]=g.useState(!1),[Dt,it]=g.useState(0),[Re,de]=g.useState(!1);let at;e[12]===Symbol.for("react.memo_cache_sentinel")?(at=()=>{it(Hc)},e[12]=at):at=e[12];const Ye=at,Xe=ya(o,300);let Ht;e[13]!==o?(Ht=C=>{o(C)},e[13]=o,e[14]=Ht):Ht=e[14];const kt=S?Ht:Xe,lt=g.useRef(kt),O=g.useRef(f),Z=g.useRef(h);let re;e[15]===Symbol.for("react.memo_cache_sentinel")?(re={placement:"bottom-start",middleware:[Jo(8),er({fallbackPlacements:["top-start"]}),tr({padding:8})],whileElementsMounted:(C,Y,ee)=>{var ie;return sr((ie=B.current)!=null?ie:C,Y,ee,{ancestorResize:!0,ancestorScroll:!0})}},e[15]=re):re=e[15];const{refs:le,floatingStyles:Ee,update:Ie}=nr(re),fe=le.setReference,Ce=le.setFloating,_e=g.useRef(null);let Oe;e[16]!==u||e[17]!==fe||e[18]!==Ie?(Oe=(C,Y)=>{var Se;const ee=u.current;if(!ee||C==null){Y.current=null,fe(null);return}const ie={contextElement:(Se=B.current)!=null?Se:void 0,getBoundingClientRect:()=>{try{const ke=ee.coordsAtPos(C);return new DOMRect(ke.left,ke.bottom,0,0)}catch(ke){return new DOMRect}}};Y.current=ie,fe(ie),Ie()},e[16]=u,e[17]=fe,e[18]=Ie,e[19]=Oe):Oe=e[19];const xe=Oe;let ve;e[20]!==a?(ve=ue("markdown","prose","dark:prose-invert","w-full","min-h-6","break-words","focus:outline-none",a),e[20]=a,e[21]=ve):ve=e[21];const Ne=ve;let Te;e[22]!==Ne||e[23]!==r||e[24]!==s||e[25]!==c?(Te={markdown:s,maxLength:c,isDisabled:r,editorClassName:Ne},e[22]=Ne,e[23]=r,e[24]=s,e[25]=c,e[26]=Te):Te=e[26];const He=g.useRef(Te),Ve=g.useRef(s);let pe;e[27]!==P||e[28]!==D?(pe={view:P,pmu:D},e[27]=P,e[28]=D,e[29]=pe):pe=e[29];const{isLoading:be,submitMagicEdit:Fe,cancelMagicEdit:We,applyMagicEditResult:dt,magicEditSubmissionSource:ct}=Lo(pe);let nt;e[30]!==P||e[31]!==D?(nt={view:P,pmu:D,mode:"full-edit"},e[30]=P,e[31]=D,e[32]=nt):nt=e[32];const{isLoading:Ae,submitMagicEdit:st,cancelMagicEdit:ft,applyMagicEditResult:wt,magicEditSubmissionSource:Et}=Lo(nt);let gt;e[33]!==P||e[34]!==D?(gt={view:P,pmu:D},e[33]=P,e[34]=D,e[35]=gt):gt=e[35];const{isLoading:Be,submitGenerate:Ft,cancelGenerate:$e}=Ic(gt);let It,_t;e[36]!==x||e[37]!==Ae||e[38]!==Be||e[39]!==be?(It=()=>(mo(x,Be||be||Ae),()=>{mo(x,!1)}),_t=[Be,be,Ae,x],e[36]=x,e[37]=Ae,e[38]=Be,e[39]=be,e[40]=It,e[41]=_t):(It=e[40],_t=e[41]),g.useEffect(It,_t);const Le=(Qs=X==null?void 0:X.input)!=null?Qs:null,je=Le!=null,Me=(Js=(Zs=X==null?void 0:X.suggestion)==null?void 0:Zs.id)!=null?Js:null;let Bt;e[42]!==u?(Bt=C=>{const Y=u.current;if(!Y)return;const ee=Y.state.tr.setMeta(Ke,C);Y.dispatch(ee)},e[42]=u,e[43]=Bt):Bt=e[43];const xt=Bt;let jt;e[44]!==xt?(jt=()=>{xt({type:"close"})},e[44]=xt,e[45]=jt):jt=e[45];const Rt=jt;let ut;e[46]!==u||e[47]!==Rt?(ut=()=>{const C=u.current;if(!C)return;const Y=Ke.getState(C.state);if(!bt(Y))return;const{triggerPos:ee,anchorPos:ie}=Y;if(!Fc(C,ee,ie)){Rt();return}Mn(C)},e[46]=u,e[47]=Rt,e[48]=ut):ut=e[48];const Mt=ut;let Tt;e[49]!==u?(Tt=()=>{var pn,rs;const C=u.current;if(!C)return;const Y=(pn=Je.getState(C.state))!=null?pn:null;if(Y!=null&&Y.input||Y!=null&&Y.suggestion)return;const ee=Ke.getState(C.state);if(!bt(ee))return;const ie=ee.triggerPos;if(ie==null)return;const Se=(rs=ee.anchorPos)!=null?rs:ie+1,ke=Math.max(ie+1,Se);let Pe=C.state.tr.delete(ie,ke);const Ue=Math.max(Math.min(ie,Pe.doc.content.size),0);Pe=Pe.setSelection(Sn.create(Pe.doc,Ue)),C.dispatch(Pe);const ze=C.state,Pt=ze.selection.to,Qe=ze.doc.resolve(Pt),St=Qe.start(),vt=Qe.end();Wa(C,{anchorPos:Pt,caretPos:Pt,blockFrom:St,blockTo:vt,triggerPos:Pt}),ae(""),Mn(C)},e[49]=u,e[50]=Tt):Tt=e[50];const V=Tt;let te;e[51]!==$e||e[52]!==u?(te=()=>{var ie,Se,ke;$e(),ae("");const C=u.current;if(!C)return;const Y=Je.getState(C.state),ee=(Se=(ie=Y==null?void 0:Y.input)==null?void 0:ie.triggerPos)!=null?Se:null;if(Eo(C),ee!=null){const Pe=C.state.doc,Ue=Math.max(0,Math.min(ee,Pe.content.size)),ze=Pe.resolve(Ue),nn=(ke=he.findFrom(ze,1,!0))!=null?ke:he.near(ze,1);if(!C.state.selection.eq(nn)){const Pt=C.state.tr.setSelection(nn);C.dispatch(Pt)}}C.hasFocus()||C.focus()},e[51]=$e,e[52]=u,e[53]=te):te=e[53];const ye=te;let ge;e[54]!==oe||e[55]!==Ft?(ge=async()=>{await Ft(oe)&&ae("")},e[54]=oe,e[55]=Ft,e[56]=ge):ge=e[56];const ce=ge;let mt;e[57]!==Me||e[58]!==u?(mt=()=>{if(!Me)return;const C=u.current;C&&(qa(C,Me),C.hasFocus()||C.focus())},e[57]=Me,e[58]=u,e[59]=mt):mt=e[59];const De=mt;let ht;e[60]!==Me||e[61]!==u?(ht=()=>{if(!Me)return;const C=u.current;C&&(Ka(C,Me),C.hasFocus()||C.focus())},e[60]=Me,e[61]=u,e[62]=ht):ht=e[62];const mn=ht;let Ut;e[63]!==q||e[64]!==n||e[65]!==x||e[66]!==P?(Ut=C=>{if(!q||!P)return;P.focus();const Y=In(x,q),ee=Y.modelSlug$(),ie=Uo(Y,n,q);uo(C,ie,n.clientThreadId,n.messageId,ee,x);const Se=zt(Y.startIndex$(),-1),ke=zt(Y.endIndex$(),-1),{applyAction:Pe,eventName:Ue,eventType:ze}=vs[C];Gt(Ue,ze,me({magicEditId:q,magicEditSegmentStartIndex:Se.toString(),magicEditSegmentEndIndex:ke.toString(),decisionSource:"toolbar"},ee?{modelSlug:ee}:{})),kl(P,q,Pe)},e[63]=q,e[64]=n,e[65]=x,e[66]=P,e[67]=Ut):Ut=e[67];const Ct=Ut;let $t;e[68]!==Ct?($t=()=>Ct("accept"),e[68]=Ct,e[69]=$t):$t=e[69];const ot=$t;let Nt;e[70]!==Ct?(Nt=()=>Ct("reject"),e[70]=Ct,e[71]=Nt):Nt=e[71];const Rn=Nt;let Tn;e[72]!==x||e[73]!==P||e[74]!==j?(Tn=(C,Y,ee)=>{if(!P)return;const ie=In(x,Y),[Se]=K(ie,ee);Se&&j(C,Y,Se,ie,"segment"),wl(P,Y,ee,vs[C].applyAction),P.focus()},e[72]=x,e[73]=P,e[74]=j,e[75]=Tn):Tn=e[75];const Cn=Tn;let Nn;e[76]!==u||e[77]!==V||e[78]!==Mt?(Nn=C=>{if(C==="divider"){Mt();return}if(C==="generate"){V();return}const Y=$l(C);if((Y==null?void 0:Y.kind)==="text-style"){const ee=u.current;if(!ee)return;ee.focus(),ic(ee,Y.id)}},e[76]=u,e[77]=V,e[78]=Mt,e[79]=Nn):Nn=e[79];const Pn=Nn;let vn,An;e[80]!==kt?(vn=()=>{lt.current=kt},An=[kt],e[80]=kt,e[81]=vn,e[82]=An):(vn=e[81],An=e[82]),g.useEffect(vn,An);let Ln,Dn;e[83]!==f?(Ln=()=>{O.current=f},Dn=[f],e[83]=f,e[84]=Ln,e[85]=Dn):(Ln=e[84],Dn=e[85]),g.useEffect(Ln,Dn);let On,Fn;e[86]!==h?(On=()=>{Z.current=h},Fn=[h],e[86]=h,e[87]=On,e[88]=Fn):(On=e[87],Fn=e[88]),g.useEffect(On,Fn);let Bn,jn;e[89]!==$e||e[90]!==u||e[91]!==Pn||e[92]!==Rt||e[93]!==w||e[94]!==_||e[95]!==D||e[96]!==fe||e[97]!==G?(Bn=()=>{const C=z.current;if(!C)return;const{markdown:Y,maxLength:ee,isDisabled:ie,editorClassName:Se}=He.current,ke=D.parse(Y!=null?Y:"");Ve.current=Y;const Pe=[Yr(),D.inputRulesPlugin(),..._?[Yl({includeMagicTextOption:w})]:[],..._?[Ga()]:[],Na(),D.keymapPlugin(),bi(qe(me({},yi),{"Mod-z":Xr,"Mod-shift-z":io,"Mod-y":io})),Al(ie),Aa(ie,b.current),el(typeof ee=="number"?ee:null),kc];w&&(Pe.push(El()),Pe.push(Tl()));const Ue=Ei.create({doc:ke,schema:D.schema(),plugins:Pe}),ze=new xi({mount:C},{state:Ue,scrollThreshold:120,scrollMargin:130,editable:()=>!ie,attributes:{class:ue("ProseMirror",Se),"aria-disabled":String(ie)},dispatchTransaction(Qe){const St=Qe.getMeta(Ke),vt=Oc(St)?St:null,pn=(vt==null?void 0:vt.type)==="execute"?vt.commandId:null,rs=Qe.getMeta(ds)===!0,_s=ze.state.apply(Qe);if(ze.updateState(_s),U.syncFromState(_s,{isMagicEditEnabled:w},{docChanged:Qe.docChanged}),pn&&Pn(pn),!Qe.docChanged||rs)return;const to=D.serialize(_s.doc);Ve.current=to,O.current(!0),lt.current({content:to})}});u.current=ze,U.setView(ze),U.syncFromState(ze.state,{isMagicEditEnabled:w});const nn=ze.dom,Pt=()=>{var Qe,St,vt;(St=(Qe=lt.current).flush)==null||St.call(Qe),(vt=Z.current)==null||vt.call(Z),Rt()};return nn.addEventListener("blur",Pt,!0),()=>{var Qe,St;nn.removeEventListener("blur",Pt,!0),(St=(Qe=lt.current).flush)==null||St.call(Qe),ze.destroy(),u.current=null,U.setView(null),_e.current=null,fe(null),$e(),ae("")}},jn=[D,Rt,fe,w,_,G,Pn,$e,U,u],e[89]=$e,e[90]=u,e[91]=Pn,e[92]=Rt,e[93]=w,e[94]=_,e[95]=D,e[96]=fe,e[97]=G,e[98]=Bn,e[99]=jn):(Bn=e[98],jn=e[99]),g.useEffect(Bn,jn);let zn,Hn;e[100]!==Ne||e[101]!==u||e[102]!==T||e[103]!==je||e[104]!==r?(zn=()=>{const C=u.current;if(!C)return;C.setProps({editable:()=>!r,attributes:{class:ue("ProseMirror",Ne),"aria-disabled":String(r)}});const Y=an.getState(C.state),ee=En.getState(C.state),ie=(Y==null?void 0:Y.isDisabled)!==r,Se=r||je,ke=(ee==null?void 0:ee.isDisabled)!==Se,Pe=(ee==null?void 0:ee.placeholderText)!==T;if(ie||ke||Pe){let Ue=C.state.tr;ie&&(Ue=Ll(Ue,r)),(ke||Pe)&&(Ue=La(Ue,{isDisabled:Se,placeholderText:T})),C.dispatch(Ue)}},Hn=[Ne,T,je,r,u],e[100]=Ne,e[101]=u,e[102]=T,e[103]=je,e[104]=r,e[105]=zn,e[106]=Hn):(zn=e[105],Hn=e[106]),g.useEffect(zn,Hn);let $n,Gn;e[107]!==u||e[108]!==w?($n=()=>{const C=u.current;C&&U.syncFromState(C.state,{isMagicEditEnabled:w})},Gn=[w,U,u],e[107]=u,e[108]=w,e[109]=$n,e[110]=Gn):($n=e[109],Gn=e[110]),g.useEffect($n,Gn);let Wn,Un;e[111]!==Le||e[112]!==fe||e[113]!==$||e[114]!==xe?(Wn=()=>{if(Le){_e.current=null,fe(null);return}if(bt($)){xe($.anchorPos,_e);return}_e.current=null,fe(null)},Un=[Le,$,fe,xe],e[111]=Le,e[112]=fe,e[113]=$,e[114]=xe,e[115]=Wn,e[116]=Un):(Wn=e[115],Un=e[116]),g.useEffect(Wn,Un);let qn,Kn;e[117]!==$e||e[118]!==u||e[119]!==r?(qn=()=>{if(!r)return;const C=u.current;C&&(Mn(C),Eo(C)),$e()},Kn=[$e,r,u],e[117]=$e,e[118]=u,e[119]=r,e[120]=qn,e[121]=Kn):(qn=e[120],Kn=e[121]),g.useEffect(qn,Kn);let Yn,Xn;e[122]!==Me||e[123]!==q||e[124]!==x?(Yn=()=>(go(x,q?{type:"magic-edit",id:q}:Me?{type:"generate",id:Me}:null),()=>{go(x,null)}),Xn=[Me,q,x],e[122]=Me,e[123]=q,e[124]=x,e[125]=Yn,e[126]=Xn):(Yn=e[125],Xn=e[126]),g.useEffect(Yn,Xn);let Vn,Qn;e[127]!==u||e[128]!==c?(Vn=()=>{var ke;const C=u.current;if(!C)return;const Y=rn.getState(C.state),ee=(ke=Y==null?void 0:Y.maxLength)!=null?ke:null,ie=typeof c=="number"?c:null;if(ee===ie)return;const Se=tl(C.state.tr,ie);C.dispatch(Se)},Qn=[c,u],e[127]=u,e[128]=c,e[129]=Vn,e[130]=Qn):(Vn=e[129],Qn=e[130]),g.useEffect(Vn,Qn);let Zn,Jn;e[131]!==u||e[132]!==s||e[133]!==D?(Zn=()=>{const C=u.current;if(!C||s===Ve.current)return;Ve.current=s;const Y=D.parse(s!=null?s:""),ee=C.state.tr.replaceWith(0,C.state.doc.content.size,Y.content);ee.setMeta(ds,!0),C.dispatch(ee)},Jn=[s,D,u],e[131]=u,e[132]=s,e[133]=D,e[134]=Zn,e[135]=Jn):(Zn=e[134],Jn=e[135]),g.useEffect(Zn,Jn);const Br=bt($),rt=je||q!=null||Me!=null||Be||be||Ae,{setShouldBlockDialogEscapeKeyDown:es}=xa();let ts,ns;e[136]!==se||e[137]!==es||e[138]!==rt?(ts=()=>{es(rt||se)},ns=[rt,se,es],e[136]=se,e[137]=es,e[138]=rt,e[139]=ts,e[140]=ns):(ts=e[139],ns=e[140]),g.useEffect(ts,ns);let ss;e[141]!==rt?(ss=rt?["generate"]:void 0,e[141]=rt,e[142]=ss):ss=e[142];const Ss=ss,ks=!je&&Br?Ee:void 0;let hn;e:{if(!P){hn=null;break e}if(w&&q){let C;e[143]!==q||e[144]!==P||e[145]!==p||e[146]!==ot||e[147]!==Rn?(C=k.jsx(Oo,{editorView:P,editorRootRef:B,activeEntryId:q,onAccept:ot,onReject:Rn,fullscreenMode:p}),e[143]=q,e[144]=P,e[145]=p,e[146]=ot,e[147]=Rn,e[148]=C):C=e[148],hn=C;break e}if(Me){const C=$c;let Y;e[149]!==Me||e[150]!==P||e[151]!==p||e[152]!==De||e[153]!==mn?(Y=k.jsx(Oo,{editorView:P,editorRootRef:B,activeEntryId:Me,onAccept:De,onReject:mn,findSuggestionElements:C,fullscreenMode:p}),e[149]=Me,e[150]=P,e[151]=p,e[152]=De,e[153]=mn,e[154]=Y):Y=e[154],hn=Y;break e}hn=null}const ws=hn;let qt,Kt;if(e[155]!==p||e[156]!==l){const C=pi();qt=B,Kt=ue("writing-block-editor markdown-new-styling relative",p&&"pb-32! md:pb-32!",C&&"firefox",l||"pt-4 pb-2 md:pt-12 md:pb-10  px-5 [--writing-block-editor-left-padding:theme(spacing.5)] [--writing-block-editor-right-padding:theme(spacing.5)] md:px-14 md:[--writing-block-editor-left-padding:theme(spacing.14)] md:[--writing-block-editor-right-padding:theme(spacing.14)]"),e[155]=p,e[156]=l,e[157]=qt,e[158]=Kt}else qt=e[157],Kt=e[158];let Yt;e[159]!==n||e[160]!==ne||e[161]!==se||e[162]!==i||e[163]!==Dt||e[164]!==Q.isCollapsed?(Yt=k.jsx(xc,{editorAreaRef:z,isInlineWritingBlockEditEnabled:i,docChangeCount:ne,selectionIsCollapsed:Q.isCollapsed,isFormatToolbarOpen:se,magicEditTriggerCount:Dt,onSelectNuxVisibilityChange:de,analyticsMetadata:n}),e[159]=n,e[160]=ne,e[161]=se,e[162]=i,e[163]=Dt,e[164]=Q.isCollapsed,e[165]=Yt):Yt=e[165];const Is=p&&"min-h-[75vh]";let Xt;e[166]!==Is?(Xt=ue(Is),e[166]=Is,e[167]=Xt):Xt=e[167];let Vt;e[168]!==Xt?(Vt=k.jsx("div",{ref:z,className:Xt}),e[168]=Xt,e[169]=Vt):Vt=e[169];let Qt;e[170]!==Ss||e[171]!==xt||e[172]!==je||e[173]!==_||e[174]!==Ce||e[175]!==$||e[176]!==ks?(Qt=_&&!je&&k.jsx(Fr,{state:$,floatingRef:Ce,style:ks,dispatchSlashMenuMeta:xt,disabledOptionIds:Ss}),e[170]=Ss,e[171]=xt,e[172]=je,e[173]=_,e[174]=Ce,e[175]=$,e[176]=ks,e[177]=Qt):Qt=e[177];let Zt;e[178]!==P||e[179]!==je||e[180]!==(Le==null?void 0:Le.anchorPos)||e[181]!==oe||e[182]!==ye||e[183]!==ce||e[184]!==Be?(Zt=je&&P&&k.jsx(gc,{value:oe,onChange:ae,onSubmit:()=>{ce()},onCancel:ye,isLoading:Be,anchorPos:(eo=Le==null?void 0:Le.anchorPos)!=null?eo:null,editorView:P,editorRootRef:B}),e[178]=P,e[179]=je,e[180]=Le==null?void 0:Le.anchorPos,e[181]=oe,e[182]=ye,e[183]=ce,e[184]=Be,e[185]=Zt):Zt=e[185];let Jt;e[186]!==M||e[187]!==q||e[188]!==P||e[189]!==Cn||e[190]!==w?(Jt=w&&M&&q&&k.jsx(hc,{editorRootRef:B,activeEntry:M,onAccept:C=>Cn("accept",q,C),onReject:C=>Cn("reject",q,C),focusEditor:()=>{P==null||P.focus()}}),e[186]=M,e[187]=q,e[188]=P,e[189]=Cn,e[190]=w,e[191]=Jt):Jt=e[191];let en;e[192]!==dt||e[193]!==We||e[194]!==P||e[195]!==p||e[196]!==ct||e[197]!==A||e[198]!==r||e[199]!==be||e[200]!==w||e[201]!==Re||e[202]!==rt||e[203]!==Fe?(en=!r&&P&&k.jsx(uc,{editorView:P,intl:A,isMagicEditEnabled:w,shouldDisableMagicEdit:rt,toolbarContentRef:W,onToolbarOpenChange:we,onMagicEditInvoked:Ye,highlightMagicEdit:Re,isMagicEditLoading:be,submitMagicEdit:Fe,applyMagicEditResult:dt,magicEditSubmissionSource:ct,fullscreenMode:p,cancelMagicEdit:We}),e[192]=dt,e[193]=We,e[194]=P,e[195]=p,e[196]=ct,e[197]=A,e[198]=r,e[199]=be,e[200]=w,e[201]=Re,e[202]=rt,e[203]=Fe,e[204]=en):en=e[204];let tn;e[205]!==wt||e[206]!==ft||e[207]!==P||e[208]!==Et||e[209]!==p||e[210]!==N||e[211]!==Ae||e[212]!==w||e[213]!==rt||e[214]!==st?(tn=p&&w&&P&&N&&k.jsx(Sc,{disabled:rt||Ae,editorView:P,isMagicEditLoading:Ae,submitMagicEdit:st,cancelMagicEdit:ft,applyMagicEditResult:wt,magicEditSubmissionSource:Et}),e[205]=wt,e[206]=ft,e[207]=P,e[208]=Et,e[209]=p,e[210]=N,e[211]=Ae,e[212]=w,e[213]=rt,e[214]=st,e[215]=tn):tn=e[215];let os;return e[216]!==ws||e[217]!==qt||e[218]!==Kt||e[219]!==Yt||e[220]!==Vt||e[221]!==Qt||e[222]!==Zt||e[223]!==Jt||e[224]!==en||e[225]!==tn?(os=k.jsxs("div",{ref:qt,className:Kt,children:[Yt,Vt,Qt,Zt,ws,Jt,en,tn]}),e[216]=ws,e[217]=qt,e[218]=Kt,e[219]=Yt,e[220]=Vt,e[221]=Qt,e[222]=Zt,e[223]=Jt,e[224]=en,e[225]=tn,e[226]=os):os=e[226],os};function jc(t){var e,n;return{index:t.segmentIndex,startIndex:zt(t.startIndex,-1),endIndex:zt(t.endIndex,-1),originalMarkdown:(e=t.originalMarkdown)!=null?e:"",suggestedMarkdown:(n=t.suggestedMarkdown)!=null?n:""}}function zc(t,e){const n=t.segmentDiffs$();return!Array.isArray(n)||n.length===0?[]:n.filter(s=>e==null?!0:s.segmentIndex===e).map(jc)}function Hc(t){return t+1}function $c(t,e){var n;return Array.from((n=t==null?void 0:t.querySelectorAll("[data-generate-suggestion='".concat(e,"']")))!=null?n:[])}export{dr as W,Ea as a,cu as b,Ma as c,Sa as g,lu as p,xa as u};
//# sourceMappingURL=g09bc254e08nnz5p.js.map
