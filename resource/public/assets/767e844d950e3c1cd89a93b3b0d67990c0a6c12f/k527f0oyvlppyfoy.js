var q=Object.defineProperty,B=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var L=(r,e,t)=>e in r?q(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,c=(r,e)=>{for(var t in e||(e={}))K.call(e,t)&&L(r,t,e[t]);if(A)for(var t of A(e))V.call(e,t)&&L(r,t,e[t]);return r},E=(r,e)=>B(r,G(e));import{u as Z,I as $,pC as R,pD as b,jV as k,dZ as x,d_ as C,dj as z,pE as J,pF as Q}from"./d0xa318sl7ywi0za.js";import{d as X,r as m,A as y}from"./mw35uwhq4g8r9eam.js";const Y=new Set(["google-oauth2","windowslive","apple"]),ee="password";function S(){var e;return typeof window<"u"&&!!((e=window.location)!=null&&e.origin)?window.location.origin:"https://chatgpt.com"}const te=240;function v(r,e){return e!=null&&e.idp&&Y.has(e.idp)?c({connection:e.idp},e.email&&{login_hint:e.email}):(e==null?void 0:e.idp)==="auth0"?c({connection:ee},e.email?{login_hint:e.email}:{[Q]:"true"}):e!=null&&e.email?c({},e.email&&{login_hint:e.email}):{}}function p(r){if(!r)throw new Error("No session found, cannot enable MFA");if(r.authProvider==="mocked")throw new Error("Mock users can't enable MFA! Please setup Auth0 following the instructions in the README")}function M(r){try{return z(r)}catch(e){throw new Error("Unable to decode access token")}}function re(r){return r.pwd_auth_time}function D(r){const e=re(r);if(!e)return!0;const t=e/1e3;return Date.now()/1e3-t>te}function O(r){var e;return((e=r[J])==null?void 0:e.required)==="yes"}var ae=(r=>(r.PushAuth="push_auth",r.Totp="totp",r.Sms="sms",r))(ae||{}),ne=(r=>(r.Enable="enable",r.Disable="disable",r))(ne||{});function N(){var h;const r=S(),e=new URL("/",r);if(typeof window<"u"&&((h=window.location)==null?void 0:h.pathname)==="/security-settings")e.pathname="/security-settings",e.hash="";else{const g=x(C.Security).hash;e.hash=g||"settings"}return e}function _(r){const e=N(),t=new URLSearchParams;return t.set("action","enable"),t.set("factor",r),e.search=t.toString(),e.toString()}function I(r){const e=N(),t=new URLSearchParams;return t.set("action","disable"),t.set("factor_id",r),e.search=t.toString(),e.toString()}function ue(r){var T,U;const e=Z(),{session:t}=$(e),h=X(),[g,o]=m.useState(!1),H=((T=t==null?void 0:t.user)==null?void 0:T.idp)==="auth0",F=!!((U=t==null?void 0:t.user)!=null&&U.mfa),s=m.useCallback(async(n,i=!1)=>{var d;p(t);let l=!0;if(t!=null&&t.accessToken){const u=M(t.accessToken);l=D(u)||i&&!O(u)}if(l){o(!0);const u=(d=t==null?void 0:t.authProvider)!=null?d:R(e,typeof window<"u"?new URLSearchParams(window.location.search):new URLSearchParams);return y.signIn(u,{callbackUrl:n},c(c({max_age:"0"},b(k())),v(e,t==null?void 0:t.user))),!0}return!1},[e,t]),W=m.useCallback(async(n="totp",i)=>{p(t),o(!0);const l=S();if(n==="totp"){if(!(i!=null&&i.native_modal)){const w=new URL("/auth/enroll_mfa",l);w.searchParams.set("factor",n),r.redirectUrl&&w.searchParams.set("redirect_path",r.redirectUrl);const P=w.toString();return await s(P)?!0:(window.location.href=P,o(!1),!1)}const a=_("totp");return await s(a)?!0:(o(!1),!1)}if(n==="passkey"){const a=new URL("/auth/enroll_mfa",l);a.searchParams.set("factor",n),r.redirectUrl&&a.searchParams.set("redirect_path",r.redirectUrl);const f=a.toString();return await s(f)?!0:(window.location.href=f,o(!1),!1)}if(n==="push_auth"){const a=_("push_auth");return await s(a)?!0:(o(!1),!1)}const d=_("sms");return await s(d)?!0:(o(!1),!1)},[t,r.redirectUrl,s]),j=m.useCallback(async(n="totp",i="")=>{var u;if(p(t),n==="push_auth"||n==="sms"||n==="totp"){if(!i)throw new Error("Factor ID is required for MFA factor removal");const a=I(i);return await s(a,!0)?!0:(o(!1),!1)}if(n==="passkey"){if(!i)throw new Error("Factor ID is required for MFA factor removal");const a=new URL(I(i));return a.searchParams.set("factor","passkey"),await s(a.toString(),!0)?!0:(o(!1),!1)}const l=new URL("/auth/disable_mfa",S()).toString();let d=!0;if(t!=null&&t.accessToken){const a=M(t.accessToken);d=D(a)||!O(a)}if(d){const a=(u=t==null?void 0:t.authProvider)!=null?u:R(e,typeof window<"u"?new URLSearchParams(window.location.search):new URLSearchParams);return y.signIn(a,{callbackUrl:l},c(c({max_age:"0"},v(e,t==null?void 0:t.user)),b(k()))),!0}return h(E(c({},x(C.Security)),{pathname:"/",search:"disable_mfa=true"})),!1},[e,t,h,s]);return{setupMfa:W,isUsernamePassword:H,isLoggedInWithMfa:F,removeMfa:j,isLoadingRedirect:g}}export{ne as M,ae as a,ue as u};
//# sourceMappingURL=k527f0oyvlppyfoy.js.map
