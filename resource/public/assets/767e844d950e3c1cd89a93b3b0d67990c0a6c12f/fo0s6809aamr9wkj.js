import{c as T,r as M,j as t,M as h,d as q,h as F,i as D,b as Y,y as K}from"./mw35uwhq4g8r9eam.js";import{u as z,al as H,h7 as J,bq as E,aA as S,d as Q,jh as V,at as R,fg as X,dv as Z,_ as w,er as ee,go as te,kl as ae,R as se,A as ne,cd as ie,pG as I}from"./d0xa318sl7ywi0za.js";import{a as oe,P as re}from"./h9qkafdoh6xf4qdv.js";import{K as B,co as le,cj as ce,ec as me,ba as ue,jB as pe,jC as G,jD as de}from"./g2euln7v5pbm31qa.js";import{S as he}from"./fe4yarxdk4eko5w6.js";import"./jmvdol9htnc5efkv.js";import"./kubdgxu3crk3gqem.js";import"./kne35xckmmfq3xx6.js";import"./ojmli062couj7r3v.js";import"./lv7ytt0l14b17ows.js";import"./c340ncgh31fwqkpk.js";import"./of0vtq1gcmd3mc3z.js";function ge(){"use forget";var d,j;const e=T.c(27),a=z();let s;e[0]!==a?(s=(j=(d=H(a))==null?void 0:d.normalizedAccountUserId)!=null?j:null,e[0]=a,e[1]=s):s=e[1];const n=s;let i;e[2]!==a?(i=B(a),e[2]=a,e[3]=i):i=e[3];const o=i,l=le(n!=null?n:""),[u,C]=M.useState(!1);if(!o.hasAccess||!n||u||!l)return null;let m;e[4]!==l.avatarUrl||e[5]!==l.name?(m={name:l.name,picture:l.avatarUrl},e[4]=l.avatarUrl,e[5]=l.name,e[6]=m):m=e[6];const y=m;let k;e[7]!==o?(k=()=>{C(!0),o.setUserOnboardingCompletion$()},e[7]=o,e[8]=k):k=e[8];const N=k;let g;e[9]!==y?(g=t.jsx(J,{user:y,size:"large"}),e[9]=y,e[10]=g):g=e[10];let _;e[11]!==l.name?(_=t.jsx("p",{className:"text-token-text-primary text-base font-semibold",children:l.name}),e[11]=l.name,e[12]=_):_=e[12];let c;e[13]===Symbol.for("react.memo_cache_sentinel")?(c=t.jsx("p",{className:"text-token-text-secondary text-sm",children:t.jsx(h,{id:"c3PR7x",defaultMessage:"Set up your profile"})}),e[13]=c):c=e[13];let f;e[14]!==_?(f=t.jsxs("div",{className:"leading-tight",children:[_,c]}),e[14]=_,e[15]=f):f=e[15];let x;e[16]!==a||e[17]!==n?(x=()=>{E(a,ce,{accountUserId:n})},e[16]=a,e[17]=n,e[18]=x):x=e[18];let v;e[19]===Symbol.for("react.memo_cache_sentinel")?(v=t.jsx("p",{className:"text-token-text-primary",children:t.jsx(h,{id:"RutgIh",defaultMessage:"Set up"})}),e[19]=v):v=e[19];let p;e[20]!==x?(p=t.jsx(S,{color:"secondary",size:"large",icon:me,className:"rounded-full px-4",onClick:x,children:v}),e[20]=x,e[21]=p):p=e[21];let b;return e[22]!==N||e[23]!==p||e[24]!==g||e[25]!==f?(b=t.jsx("div",{className:"w-full px-4 sm:px-6 lg:px-8",children:t.jsx("div",{className:"mx-auto w-full max-w-2xl",children:t.jsx(ue,{icon:g,content:f,contentClassName:"flex-row items-center justify-between gap-8",closeButtonContainerClassName:"items-center!",customCtas:p,verticalCta:!1,onDismiss:N})})}),e[22]=N,e[23]=p,e[24]=g,e[25]=f,e[26]=b):b=e[26],b}const O=5e3;function fe({loaderData:e}){"use no forget";var U;const{id:a,token:s,authStatus:n}=e,i=z(),o=B(i),l=q(),u=te(),C=ae(),m=xe({authStatus:n,id:a,token:s}),y=Q(()=>o==null?void 0:o.userAttributes$()),k=F(),N=V(i),g=M.useRef(!1),_=M.useRef(!1),c=(U=m.data)==null?void 0:U.content.room_id,f=o!=null&&n===R.LoggedIn&&o.hasAccess&&!u&&!C,x=D({mutationKey:["calpico","magic-link","accept",a],mutationFn:()=>o.acceptMagicLink$({magic_link_id:a,token:s}),onSuccess:r=>{r!=null&&r.roomId&&(w.logEventWithStatsig("Calpico - invite - accepted","chatgpt_web_calpico_invite_accepted",{room_id:r.roomId}),l("/gg/".concat(r.roomId)))},onError:r=>{var $;N.danger(($=X(r))!=null?$:k.formatMessage(Z.somethingWentWrong))}});if(M.useEffect(()=>{c==null||_.current||(_.current=!0,w.logEventWithStatsig("Calpico - invite - page shown","chatgpt_web_calpico_invite_page_shown",{room_id:c}))},[c]),M.useEffect(()=>{if(!(f&&o!=null&&y==null&&!g.current))return;g.current=!0,(async()=>{try{await o.fetchUserAttributes$()}catch(ye){}finally{g.current=!1}})()},[o,f,y]),m.isLoading)return t.jsx(P,{children:t.jsx("div",{className:"flex h-full w-full items-center justify-center",children:t.jsx(ee,{})})});if(m.error!=null)return t.jsx(P,{children:t.jsx("div",{className:"flex h-full w-full items-center justify-center",children:t.jsx("p",{className:"max-w-2xl px-8 text-center text-lg text-balance",children:m.error.message})})});if(m.data==null)return t.jsx(P,{children:null});const v=e.type==="ok"?e.roomName:null,p=m.data.content.member_count,b=p<=3,d=b?m.data.content.members:m.data.content.members.slice(0,2);let j=null;b?p===1?j=t.jsx(h,{id:"siksc7",defaultMessage:"<emphasis>ChatGPT</emphasis> with <emphasis>{name}</emphasis>",values:{emphasis:r=>t.jsx(A,{children:r}),name:d[0].name}}):p===2?j=t.jsx(h,{id:"Rvrtg/",defaultMessage:"<emphasis>ChatGPT</emphasis> with <emphasis>{name1} and {name2}</emphasis>",values:{emphasis:r=>t.jsx(A,{children:r}),name1:d[0].name,name2:d[1].name}}):p===3&&(j=t.jsx(h,{id:"nooFua",defaultMessage:"<emphasis>ChatGPT</emphasis> with <emphasis>{name1}, {name2}, and {name3}</emphasis>",values:{emphasis:r=>t.jsx(A,{children:r}),name1:d[0].name,name2:d[1].name,name3:d[2].name}})):j=t.jsx(h,{id:"My6mmz",defaultMessage:"<emphasis>ChatGPT</emphasis> with <emphasis>{name1}, {name2}, and {remainingCount} more</emphasis>",values:{emphasis:r=>t.jsx(A,{children:r}),name1:d[0].name,name2:d[1].name,remainingCount:p-2}});const L=t.jsx(h,{id:"a17r/Y",defaultMessage:"Join group chat"}),W=f&&y!=null&&y.onboardedAt==null;return t.jsxs(P,{children:[t.jsx("div",{className:"flex h-full flex-col items-center justify-center text-center",children:t.jsxs("div",{className:"flex max-w-3xl flex-col items-center text-center",children:[t.jsx(pe,{list:m.data.content.members.map(r=>({id:r.account_user_id,avatarUrl:r.avatar_url,name:r.name})),excludeViewer:!1,variant:"horizontal-stack"}),t.jsx("h3",{className:"text-token-text-tertiary mt-3 mb-1 text-xl font-normal text-balance",children:j}),t.jsx("p",{className:"text-token-text-secondary text-balance",children:v!=null?v:t.jsx(h,{id:"z7w9u0",defaultMessage:"Share, collaborate, and get creative — with some help from ChatGPT."})}),t.jsxs("div",{className:"mt-6 flex flex-col items-center space-y-1",children:[u?t.jsx(S,{color:"primary",size:"large",as:"a",openNewTab:!0,to:"chatgpt://gg/v/".concat(a,"?token=").concat(s),onClick:()=>{w.logEventWithStatsig("Calpico - invite - manually deeplink to mobile","chatgpt_web_calpico_invite_manually_deeplink_to_mobile",{room_id:c}),setTimeout(()=>{E(i,G,{roomId:c})},O)},children:L}):C?t.jsx(S,{color:"primary",size:"large",as:"a",openNewTab:!0,to:"chatgpt://chatgpt.com/gg/v/".concat(a,"?token=").concat(s),onClick:()=>{w.logEventWithStatsig("Calpico - invite - manually deeplink to mobile","chatgpt_web_calpico_invite_manually_deeplink_to_mobile",{room_id:c}),setTimeout(()=>{E(i,G,{roomId:c})},O)},children:L}):t.jsx(S,{color:"primary",size:"large",loading:x.isPending,onClick:()=>{if(n===R.LoggedOut){w.logEventWithStatsig("Calpico - invite - auth redirect","chatgpt_web_calpico_invite_auth_redirect",{room_id:c});const r=new URLSearchParams([["next","/gg/v/".concat(a,"?token=").concat(s)]]);l("/auth/login/?".concat(r.toString()));return}if(o.hasAccess){if(x.isPending)return;x.mutate()}else w.logEventWithStatsig("Calpico - invite - no access yet modal shown","chatgpt_web_calpico_invite_no_access_yet_modal_shown",{room_id:c}),E(i,de)},children:L}),t.jsx(S,{color:"ghost",size:"large",onClick:()=>{w.logEventWithStatsig("Calpico - invite - ignored","chatgpt_web_calpico_invite_ignored",{room_id:c}),l("/")},children:t.jsx(h,{id:"tILHmH",defaultMessage:"Ignore"})})]})]})}),t.jsxs("div",{className:"absolute inset-x-0 bottom-4 flex w-full flex-col items-center space-y-2 px-6",children:[u||C?t.jsxs("div",{className:"mb-6",children:[u?t.jsx(oe,{}):null,C?t.jsx(re,{referrer:"groupChatInvitation"}):null]}):null,W?t.jsx("div",{className:"mb-8 w-full",children:t.jsx(ge,{})}):null,t.jsx("p",{className:"text-caption-regular text-token-text-tertiary text-center text-pretty",children:t.jsx(h,{id:"ytzRfA",defaultMessage:"Your personal ChatGPT memory is never used in group chats."})}),t.jsx(S,{color:"secondary",size:"small",as:"a",to:"https://help.openai.com/en/articles/12703475-group-chats",openNewTab:!0,children:t.jsx("p",{className:"text-footnote-regular text-token-text-secondary font-medium",children:t.jsx(h,{id:"ds1qjK",defaultMessage:"Learn more"})})})]})]})}function A(e){"use forget";const a=T.c(2),{children:s}=e;let n;return a[0]!==s?(n=t.jsx("span",{className:"text-token-text-primary",children:s}),a[0]=s,a[1]=n):n=a[1],n}function xe({authStatus:e,id:a,token:s}){"use no forget";return Y({queryKey:["calpico-group-link",e,a,s],queryFn:async()=>await se.safeGet("/calpico/chatgpt/links/{magic_link_id}",{parameters:{path:{magic_link_id:a},query:{token:s}},authOption:ne.SendIfAvailable})})}function P(e){"use forget";const a=T.c(4),{children:s}=e;let n;a[0]===Symbol.for("react.memo_cache_sentinel")?(n=t.jsx("div",{className:"absolute start-2 top-2 md:hidden",children:t.jsx(he,{onClick:_e})}),a[0]=n):n=a[0];let i;a[1]===Symbol.for("react.memo_cache_sentinel")?(i=null,a[1]=i):i=a[1];let o;return a[2]!==s?(o=t.jsxs("div",{className:"relative mx-auto h-full w-full max-w-5xl px-6 sm:px-12",children:[n,s,i]}),a[2]=s,a[3]=o):o=a[3],o}function _e(){return ie.setSidebarOpen(!0)}const Te=({currentUrl:e,nextUrl:a})=>!(e.pathname===a.pathname&&e.searchParams.get("token")===a.searchParams.get("token")),Le=({loaderData:e})=>{const a=[{name:"robots",content:"noindex,nofollow"},{property:"og:type",content:"website"},{property:"og:image",content:I.src},{property:"og:image:secure_url",content:I.src},{property:"og:image:width",content:"1600"},{property:"og:image:height",content:"900"},{property:"og:site_name",content:"ChatGPT"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:I.src},{name:"twitter:site",content:"@ChatGPTapp"}];switch(e.type){case"ok":{const{senderName:s,roomName:n,ogTitle:i,ogDescription:o}=e;let l="Join my group chat on ChatGPT",u="".concat(s," invited you to a ChatGPT group chat");return n&&(u="".concat(s," invited you to join “").concat(n,"” on ChatGPT")),i&&(l=i),o&&(u=o),[...a,{title:l},{name:"description",content:u},{property:"og:title",content:l},{property:"og:description",content:u},{property:"og:image:alt",content:l},{name:"twitter:title",content:l},{name:"twitter:description",content:u},{name:"twitter:image:alt",content:l}]}case"workspace-mismatch":{const s="Join my group chat on ChatGPT";return[...a,{title:s},{property:"og:title",content:s},{property:"og:image:alt",content:s},{name:"twitter:title",content:s},{name:"twitter:image:alt",content:s}]}}},$e=K(function(a){"use forget";const s=T.c(2),{loaderData:n}=a;let i;return s[0]!==n?(i=t.jsx(fe,{loaderData:n}),s[0]=n,s[1]=i):i=s[1],i});export{$e as default,Le as meta,Te as shouldRevalidate};
//# sourceMappingURL=fo0s6809aamr9wkj.js.map
