var oe=Object.defineProperty;var z=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable;var q=(s,a,t)=>a in s?oe(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t,W=(s,a)=>{for(var t in a||(a={}))ie.call(a,t)&&q(s,t,a[t]);if(z)for(var t of z(a))de.call(a,t)&&q(s,t,a[t]);return s};import{h as P,r as g,j as e,M as o,e as F,ag as le,u as ce,d as K,F as ue}from"./mw35uwhq4g8r9eam.js";import{p as D,aB as L,aA as G,u as H,al as J,dn as Y,R as ee,er as I,D as me,e7 as se,eS as ge,mk as pe,J as xe,cF as he}from"./d0xa318sl7ywi0za.js";import{ch as fe,V as je,B as Me,lv as U,lt as te,bd as r,aZ as we,at as ae,lu as re,b_ as Se,bZ as be,bb as V,cw as ye}from"./g2euln7v5pbm31qa.js";import{a as Z,c as $}from"./g6gtv3p57f0esi65.js";import{f as ne,i as O,u as ke,R as Ne}from"./eg4jvzq610bzilv3.js";import{F as ve}from"./bkgcomfvnpye3vr8.js";import{G as Ge}from"./dzciepzlrexlt6ar.js";import{e as Ce,f as Ae,M as Q}from"./la8lelg2j64ilvfd.js";function Ee({defaultName:s,placeholder:a,onSave:t,onClose:n}){const i=P(),f=s==null,[u,p]=g.useState(s||""),[c,w]=g.useState(!1),[j,M]=g.useState(null),x=D(),h=async()=>{if(u.trim()===""){M(i.formatMessage({id:"workspaceSettings.groups.emptyName",defaultMessage:"Group name cannot be empty"}));return}w(!0);try{await t(u),x.success(f?i.formatMessage({id:"workspaceSettings.groups.createdGroup",defaultMessage:"Group created successfully"}):i.formatMessage({id:"workspaceSettings.groups.nameChanged",defaultMessage:"Group name changed successfully"})),n()}catch(S){M(i.formatMessage({id:"workspaceSettings.groups.duplicateName",defaultMessage:"Group with this name already exists"}))}finally{w(!1)}};return e.jsx(L,{isOpen:!0,type:"success",onClose:n,title:f?i.formatMessage(X.newGroupTitle):i.formatMessage(X.updateNameTitle),testId:"modal-change-group-name",showCloseButton:!0,primaryButton:e.jsx(G,{color:"primary",onClick:()=>h(),loading:c,children:e.jsx(o,{id:"workspaceSettings.groups.save",defaultMessage:"Save"})}),secondaryButton:e.jsx(G,{onClick:n,color:"secondary",children:e.jsx(o,{id:"workspaceSettings.groups.cancel",defaultMessage:"Cancel"})}),children:e.jsxs("div",{className:"mb-3 flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:e.jsx(o,{id:"workspaceSettings.groups.groupNameLabel",defaultMessage:"Group Name"})}),e.jsx("input",{autoFocus:!0,type:"text",value:u,placeholder:a,onChange:S=>{p(S.target.value),M(null)},className:"border-token-border-secondary focus:border-token-accent bg-token-bg-primary w-full rounded border px-3 py-2 text-sm focus:outline-none",onKeyDown:S=>{S.key==="Enter"&&h()}}),j&&e.jsx("p",{className:"text-xs text-red-500",children:j})]})})}const X=F({newGroupTitle:{id:"workspaceSettings.groups.newGroup",defaultMessage:"New group"},updateNameTitle:{id:"workspaceSettings.groups.updateNameTitle",defaultMessage:"Update group name"}}),Pe=F({bulkAddMembersError:{id:"workspaceSettings.groups.bulkAddMembers.error",defaultMessage:"Unable to add some members to the group."}}),B=1e3;function _e({group:s,isOpen:a,onClose:t}){const n=P(),i=D(),f=n.formatMessage({id:"workspaceSettings.groups.addMember",defaultMessage:"Add members to the {groupName} group"},{groupName:s.name}),u=H(),p=J(u),[c,w]=g.useState([]),[j,M]=g.useState(!1);async function x(){var N;const h=p==null?void 0:p.getWorkspaceId();if(!h)throw new Error("No workspace ID found");M(!0);const S=[],y=50;for(let m=0;m<c.length;m+=y)S.push(c.slice(m,m+y));const C=async m=>ee.safePost("/accounts/{account_id}/group/{group_id}/users",{parameters:{path:{account_id:h,group_id:s.id}},requestBody:{email_addresses:m}});try{const v=(await Promise.all(S.map(b=>C(b)))).reduce((b,d)=>b+d.added_group_users.length,0);i.success(n.formatMessage({id:"yU4Zf0",defaultMessage:"Added {numUsers} users to the group"},{numUsers:v})),t==null||t()}catch(m){const v=(N=ne(n,m,{targetIsRestrictedSafeModeGroup:O(s)}))!=null?N:n.formatMessage(Pe.bulkAddMembersError);i.danger(v,{duration:3})}finally{M(!1)}}return e.jsxs(L,{testId:"modal-bulk-add-group-members",isOpen:a,onClose:t!=null?t:Y,title:f,type:"success",showCloseButton:!0,primaryButton:e.jsx(G,{onClick:x,disabled:c.length===0||c.length>B,loading:j,children:e.jsx(o,{id:"EpbOzA",defaultMessage:"Add users to group"})}),children:[e.jsx(Fe,{onChange:w}),c.length>B&&e.jsx("div",{className:"text-token-text-error mt-2 text-sm",children:e.jsx(o,{id:"9lp0Tc",defaultMessage:"Email list is limited to {maxEmails} users at once",values:{maxEmails:B}})})]})}function Fe({onChange:s}){const[a,t]=g.useState("");return e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsxs("label",{htmlFor:"group-email-paste",children:[e.jsx(o,{id:"qvGcSC",defaultMessage:"Emails"}),e.jsx("br",{}),e.jsx("span",{className:"text-token-text-tertiary text-sm",children:e.jsx(o,{id:"Fhd+5h",defaultMessage:"Paste email addresses here, one per line:"})})]}),e.jsx(fe,{id:"group-email-paste",className:"h-[250px] text-sm",value:a,onChange:n=>{t(n.target.value),s(Re(n.target.value))},placeholder:"jean@example.com\njoohyun@example.com\nmuhammed@example.com\nsusan@example.com"})]})}function Re(s){return s.split("\n").map(a=>a.trim()).filter(a=>a.length>0).filter(a=>je.test(a))}function Ue({group:s,isOpen:a,onClose:t}){var _;const n=P(),i=D(),f=n.formatMessage({id:"workspaceSettings.addGroupsMembersModal.title",defaultMessage:"Add members to the {groupName} group"},{groupName:s.name}),u=H(),p=J(u),c=p==null?void 0:p.getWorkspaceId(),[w,j]=g.useState(""),[M,x]=g.useState(0),{data:h,isLoading:S}=Me(c,M*U,w,U,le),[y,C]=g.useState([]),[N,m]=g.useState([]),[v,b]=g.useState("interactive"),d=h?Math.ceil(((_=h.total)!=null?_:0)/U):0;async function A(l){var T;m(k=>[...k,l]);try{await Be(c,s.id,l),C(k=>[...k,l])}catch(k){me.addError(k);const R=(T=ne(n,k,{targetIsRestrictedSafeModeGroup:O(s)}))!=null?T:n.formatMessage(De.addMemberError);i.danger(R,{duration:3})}finally{m(k=>k.filter(R=>R!==l))}}return v==="batch"?e.jsx(_e,{group:s,isOpen:a,onClose:t}):e.jsx(L,{testId:"modal-add-group-member",type:"warning",isOpen:a,onClose:t!=null?t:Y,title:f,size:"custom",className:"max-w-(--breakpoint-md)",showCloseButton:!0,primaryButton:e.jsx(G,{onClick:t,children:e.jsx(o,{id:"0NAzDq",defaultMessage:"Done"})}),children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex flex-row justify-between",children:[e.jsx("p",{children:f}),e.jsx(G,{onClick:()=>{b("batch")},color:"secondary",children:e.jsx(o,{id:"5GPldp",defaultMessage:"Bulk add users"})})]}),e.jsx(te,{value:w,inputClassName:"w-full",onChange:l=>{j(l.target.value)}}),e.jsxs(r.Root,{className:"min-w-full",children:[e.jsxs(r.Header,{children:[e.jsx(r.HeaderCell,{children:e.jsx(o,{id:"workspaceSettings.groups.addMember.name",defaultMessage:"Name"})}),e.jsx(r.HeaderCell,{children:e.jsx(o,{id:"workspaceSettings.groups.addMember.email",defaultMessage:"Email"})}),e.jsx(r.HeaderCell,{})]}),e.jsxs(r.Body,{children:[!h&&S&&e.jsx(r.Row,{children:e.jsx(r.Cell,{colSpan:3,children:e.jsx(I,{})})}),h==null?void 0:h.items.map(l=>e.jsxs(r.Row,{children:[e.jsx(r.Cell,{children:l.name}),e.jsx(r.Cell,{children:l.email}),e.jsx(r.Cell,{textAlign:"right",className:"pe-1",children:e.jsx(G,{size:"small",color:"secondary",disabled:N.includes(l.id),onClick:()=>{y.includes(l.id)||A(l.id)},icon:y.includes(l.id)?we:ae,children:y.includes(l.id)?e.jsx(o,{id:"workspaceSettings.groups.addMember.addButton",defaultMessage:"Added"}):e.jsx(o,{id:"workspaceSettings.groups.addMember.addedButton",defaultMessage:"Add"})})})]},l.id))]})]}),e.jsx("div",{className:"flex flex-row justify-center",children:e.jsx(re,{currentPage:M,onChangeIndex:l=>{x(l)},length:d})})]})})}async function Be(s,a,t){await ee.safePatch("/accounts/{account_id}/group/{group_id}",{parameters:{path:{account_id:s,group_id:a}},requestBody:{user_id:t}})}const De=F({addMemberError:{id:"EnX2ZH",defaultMessage:"Unable to add member to the group."}});function Le({workspaceId:s}){const a=P(),t=ce(),n=se(),i=!(n!=null&&n.isAdminOfAccount()||n!=null&&n.isOwnerOfAccount()),f=H(),[u,p]=g.useState(""),c=ye(u,300),w=K(),[j,M]=g.useState(0),{groups:x,isLoading:h,isPlaceholderData:S}=Ce({workspaceId:s,currPage:j,groupFilter:c}),[y,C]=g.useState(!1),{data:N}=ke(s,xe(f,"3020999601")),m=d=>{d&&(M(0),p("")),C(d)},{createGroup:v}=Ae({workspaceId:s,currentGroups:x});let b=x?[...x.items]:[];if(N&&x){const d=N.group;if(d){const A=b.filter(({id:_})=>_!==d.id);b=j===0?[d].concat(A):b}}return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-6 mb-3 flex flex-row justify-between gap-2",children:[e.jsx(te,{inputClassName:"w-[250px] rounded-full! text-sm",value:u,onChange:d=>{p(d.target.value),M(0)},placeholder:a.formatMessage({id:"workspaceSettings.groups.search",defaultMessage:"Search group name"})}),!i&&e.jsx(G,{onClick:()=>m(!0),icon:ae,children:e.jsx(o,{id:"workspaceSettings.groups.create",defaultMessage:"Create group"})})]}),e.jsxs("div",{children:[e.jsxs(r.Root,{className:"min-w-full",children:[e.jsxs("colgroup",{children:[e.jsx("col",{className:"w-[60%]"}),e.jsx("col",{className:"w-[20%]"}),e.jsx("col",{className:"w-[20%]"}),e.jsx("col",{className:"w-16"})]}),e.jsxs(r.Header,{children:[e.jsx(r.HeaderCell,{children:e.jsx(o,{id:"workspaceSettings.groups.groupName",defaultMessage:"Group name"})}),e.jsx(r.HeaderCell,{children:e.jsx(o,{id:"workspaceSettings.groups.members",defaultMessage:"Members"})}),e.jsx(r.HeaderCell,{children:e.jsx(o,{id:"workspaceSettings.groups.created",defaultMessage:"Created"})}),e.jsx(r.HeaderCell,{})]}),e.jsx(r.Body,{className:he((h||S)&&"opacity-50"),children:x==null?e.jsx(r.Row,{children:e.jsx(r.Cell,{colSpan:5,textAlign:"center",children:e.jsx(I,{})})}):b.length===0?e.jsx(r.Row,{children:e.jsx(r.Cell,{colSpan:5,textAlign:"center",children:u===""?e.jsx(o,{id:"workspaceSettings.groups.noGroups",defaultMessage:"No groups found."}):e.jsx(o,{id:"workspaceSettings.groups.noGroupsWithFIlter",defaultMessage:"No groups found. Try changing the search query."})})}):b.map(d=>e.jsx(He,{group:d,workspaceId:s,onAddMember:()=>{t.invalidateQueries({queryKey:[s,"groups"]})},readOnly:i},d.id))})]}),x&&e.jsx("div",{className:"text-center",children:e.jsx(re,{length:Math.ceil(x.total/Q),currentPage:Math.min(j,Math.ceil(x.total/Q)),onChangeIndex:d=>M(d)})})]}),y&&e.jsx(Ee,{onClose:()=>m(!1),onSave:async d=>{const{id:A}=await v({name:d,workspaceId:s});w("/admin/groups/".concat(A))},placeholder:a.formatMessage({id:"workspaceSettings.groups.placeholder",defaultMessage:"E.g. marketing team"})})]})}function Qe({currentWorkspaceId:s}){var j;const a=P(),t=se(),n=!!(t!=null&&t.isFreeWorkspace());let i=!1;const f=t!=null?Se(t.data.role):void 0,u=t!=null?be(t.data.role):void 0,p=t==null?void 0:t.isEnterprisey(),{data:c,isLoading:w}=ge(s);return n?e.jsxs(e.Fragment,{children:[e.jsx(V,{children:e.jsx("title",{children:a.formatMessage(E.title)})}),e.jsx(Z,{title:a.formatMessage(E.title),subtitle:e.jsx(o,{id:"NDDzzF",defaultMessage:"Only workspace admins can edit these settings."})}),e.jsx($,{children:e.jsx(ve,{})})]}):(u||f||!p?i=!0:i=!!((j=c==null?void 0:c.permissions)!=null&&j.includes("chatgpt.workspace.member.role.view")),w?e.jsx("div",{className:"mt-6 flex min-h-[40vh] items-center justify-center",children:e.jsx(I,{})}):i?e.jsxs(e.Fragment,{children:[e.jsx(V,{children:e.jsx("title",{children:a.formatMessage(E.title)})}),e.jsx(Z,{title:a.formatMessage(E.title),subtitle:e.jsx(o,{id:"NDDzzF",defaultMessage:"Only workspace admins can edit these settings."})}),e.jsx($,{showSpinner:!1,children:e.jsx(Le,{workspaceId:s})})]}):e.jsx("div",{className:"m-6",children:e.jsxs("div",{className:"border-token-border-medium bg-token-main-surface-secondary text-token-text-primary flex items-center gap-3 rounded-md border px-4 py-3",children:[e.jsx(pe,{className:"icon-sm interactive-label-warning-secondary shrink-0"}),e.jsx(o,W({},E.groupsPagePermissionDenied))]})}))}function He({group:s,onAddMember:a,readOnly:t}){const[n,i]=g.useState(!1),f=K(),u=O(s);return e.jsxs(e.Fragment,{children:[e.jsxs(r.Row,{className:"[&>td]:py-2",onClick:()=>f("/admin/groups/".concat(s.id)),children:[e.jsxs(r.Cell,{children:[e.jsx(Ge,{group:s}),e.jsx("div",{className:"flex flex-col gap-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s.name}),u&&e.jsx(Ne,{})]})})]}),e.jsx(r.Cell,{children:e.jsx(o,{id:"workspaceSettings.groups.memberCount",defaultMessage:"{count} members",values:{count:s.num_members}})}),e.jsx(r.Cell,{children:s.created_time&&e.jsx(ue,{value:s.created_time,year:"numeric",month:"short",day:"numeric"})})]}),n&&!t&&!s.is_scim_managed&&e.jsx(Ue,{isOpen:!0,onClose:()=>{a(s.id),i(!1)},group:s})]})}const E=F({title:{id:"admin.groupsSettings.title",defaultMessage:"Groups"},groupsPagePermissionDenied:{id:"adminPage.groupsPagePermissionDenied",defaultMessage:"You don't have permission to view this groups list."}});export{Ue as A,Ee as U,Qe as W,E as m};
//# sourceMappingURL=l6vfg6gk09o1j3zb.js.map
