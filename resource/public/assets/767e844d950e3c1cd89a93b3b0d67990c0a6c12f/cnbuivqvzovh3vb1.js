var G=Object.defineProperty,H=Object.defineProperties;var D=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var U=(e,o,n)=>o in e?G(e,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[o]=n,w=(e,o)=>{for(var n in o||(o={}))W.call(o,n)&&U(e,n,o[n]);if(C)for(var n of C(o))q.call(o,n)&&U(e,n,o[n]);return e},B=(e,o)=>H(e,D(o));var Q=(e,o)=>{var n={};for(var r in e)W.call(e,r)&&o.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&C)for(var r of C(e))o.indexOf(r)<0&&q.call(e,r)&&(n[r]=e[r]);return n};import{j as v,k as J,h as I,r as ee,e as te,v as ne}from"./mw35uwhq4g8r9eam.js";import{ay as b,qu as z,g3 as oe,ee as se,lE as ie,ca as re,m as E,g4 as ae,lG as ce,Q as de,as as ue,ec as le,qv as me,aw as K}from"./d0xa318sl7ywi0za.js";import{cJ as fe,cK as ge,cC as pe,cL as _e,cB as y,cM as he}from"./g2euln7v5pbm31qa.js";import{C as ye}from"./lqx184c6v77q7gok.js";import"./gs306ibz22k5zi3r.js";function Le({messages:e,nextMessage:o,clientThreadId:n,isLastTurnInConversation:r,isLastMessageInTurn:d,onRequestCompletion:a}){var l,m,u,f,g;const t=e.find(c=>c.author.role===b.Tool&&c.recipient==="assistant"||c.author.role===b.Assistant&&c.recipient==="user");if(!t)return null;const i=(m=(l=t.metadata)==null?void 0:l.elicitation_metadata)==null?void 0:m.tool_call_message;if(!i)return null;const s=(f=(u=t.metadata)==null?void 0:u.elicitation_metadata)==null?void 0:f.plugin_data;return!s||!s.from_server||!("body"in((g=s.from_server)!=null?g:{}))?null:v.jsx(Me,{messages:e,nextMessage:o,clientThreadId:n,isLastTurnInConversation:r,isLastMessageInTurn:d,onRequestCompletion:a,serverActionMessage:s.from_server,toolCallMessage:i})}function Me({messages:e,nextMessage:o,clientThreadId:n,isLastTurnInConversation:r,isLastMessageInTurn:d,onRequestCompletion:a,serverActionMessage:t,toolCallMessage:i}){var s;if(!("body"in t))return null;if(t.type=="oauth_required"){const m=((s=t.body.actions)!=null?s:[]).find(ve);return m?v.jsx(Se,{messages:e,nextMessage:o,clientThreadId:n,isLastTurnInConversation:r,isLastMessageInTurn:d,onRequestCompletion:a,toolCallMessage:i,oauthTargetMessageId:m.oauth_redirect.target_message_id}):null}}function Se({messages:e,nextMessage:o,clientThreadId:n,isLastTurnInConversation:r,isLastMessageInTurn:d,onRequestCompletion:a,toolCallMessage:t,oauthTargetMessageId:i}){var x;const[s,l]=J(),m=I(),u=e.find(M=>{var _,S,k;return(k=(S=(_=M.metadata)==null?void 0:_.elicitation_metadata)==null?void 0:S.plugin_data)==null?void 0:k.from_client}),f=z(t==null?void 0:t.recipient),g=(x=z(o==null?void 0:o.recipient))==null?void 0:x.namespace,{connectorId:c,connectorToolStatus:A,connectorStatusMessage:j}=Pe(f==null?void 0:f.namespace,g,e,r),h=oe(!0,se.JIT_PLUGIN).platformConnectors.get(c!=null?c:""),N=!!(c&&h&&!u&&d),Y=ie(),p=re();ee.useEffect(()=>{var _,S,k,F;if(((F=(k=(S=(_=u==null?void 0:u.metadata)==null?void 0:_.elicitation_metadata)==null?void 0:S.plugin_data)==null?void 0:k.from_client)==null?void 0:F.type)==="oauth_success")return;s.get("oauth_success")&&(l(V=>(V.delete("oauth_success"),V),{replace:!0}),T({eventSource:"url",assistantMessage:t,onRequestCompletion:a,actionData:{type:"oauth_success",target_message_id:i},conversationMode:{kind:E.PrimaryAssistant},activeSystemHint:p!=null?p:void 0,messageTextContent:"Login successful."}))},[t,e,n,a,r,s,l,p,i,u]);const X=ae({skip:!1,fetchValidLinksOnly:!0,productSku:"n7jupd"}),Z=Array.from(X.connectorLinks.values()).some(M=>M.some(_=>_.connector_id===c)),{addSource:$,selectedSources:R}=fe(n),{selectedRepos:O}=ge(n);return v.jsxs(v.Fragment,{children:[j&&v.jsx(pe,{highlightedCommand:h?m.formatMessage(j,{domain:h.name}):v.jsx("br",{}),status:A,showWorkUserSetting:!1}),N&&h&&v.jsx("div",{className:"mb-2 flex gap-2",children:v.jsx(ye,{connector:h,hasWidget:_e(e),onConnect:M=>{if(Z){$(ce[c!=null?c:""]),T({sourceEvent:M,assistantMessage:t,onRequestCompletion:a,actionData:{type:"oauth_success",target_message_id:i},conversationMode:{kind:E.PrimaryAssistant},activeSystemHint:p!=null?p:void 0,messageTextContent:"Login successful.",selectedSources:R,selectedRepos:O});return}const _=de(n),S=_?new URL(ue(_),window.location.origin):new URL(window.location.href);S.searchParams.set("oauth_success","true"),Y({connectorId:h.id,redirectAfter:S.toString(),referrer:le.JitPluginMessage})},onProceedWithoutConnecting:M=>{T({sourceEvent:M,assistantMessage:t,onRequestCompletion:a,actionData:{type:"deny",target_message_id:i},messageTextContent:"Login declined.",conversationMode:{kind:E.PrimaryAssistant},activeSystemHint:p!=null?p:void 0,selectedSources:R,selectedRepos:O})}})})]})}function ve(e){var o;return(e==null?void 0:e.type)==="oauth_redirect"&&typeof((o=e==null?void 0:e.oauth_redirect)==null?void 0:o.target_message_id)=="string"}function Pe(e,o,n,r){var m,u,f,g,c,A,j,L,h;var d=(m=me(e))!=null?m:void 0;const a=n[n.length-1],t=(u=a==null?void 0:a.metadata)==null?void 0:u.jit_plugin_data;if(!d&&((f=t==null?void 0:t.from_server)==null?void 0:f.type)==="oauth_required"&&(d=(g=t==null?void 0:t.from_server)==null?void 0:g.body.connector_id),!d)return{connectorId:void 0,connectorToolStatus:null,connectorStatusMessage:null,showConnectorConnect:!1};if(o===e)return{connectorId:d,connectorToolStatus:null,connectorStatusMessage:null,showConnectorConnect:!1};var i=y.Running,s=null,l=!1;return n.some(N=>N.content.content_type===K.SystemError)?(i=y.Error,s=P.error):a?((c=t==null?void 0:t.from_server)==null?void 0:c.type)==="oauth_required"&&r?(i=y.Paused,s=null,l=!0):((A=t==null?void 0:t.from_server)==null?void 0:A.type)==="oauth_required"&&!r?(i=y.Stopped,s=P.connectorDeclined):((j=t==null?void 0:t.from_client)==null?void 0:j.type)==="deny"?(i=y.Stopped,s=P.connectorDeclined):((L=t==null?void 0:t.from_client)==null?void 0:L.type)==="oauth_success"?(i=y.Stopped,s=P.connectorAccepted):(h=a==null?void 0:a.metadata)!=null&&h.invoked_plugin?(i=y.Finished,s=P.finished):(i=y.Stopped,s=P.stopped):(i=y.Running,s=P.running),{connectorId:d,connectorToolStatus:i,connectorStatusMessage:s,showConnectorConnect:l}}function T(m){var u=m,{actionData:e,assistantMessage:o,turnGizmo:n,onRequestCompletion:r,conversationMode:d,activeSystemHint:a,messageTextContent:t,selectedSources:i,selectedRepos:s}=u,l=Q(u,["actionData","assistantMessage","turnGizmo","onRequestCompletion","conversationMode","activeSystemHint","messageTextContent","selectedSources","selectedRepos"]);var g;const f={id:ne(),author:{role:b.Tool,name:o.recipient},content:{content_type:K.Text,parts:[t!=null?t:""]},recipient:"all",metadata:w(w({jit_plugin_data:{from_client:e},gizmo_id:n==null?void 0:n.gizmo.id,elicitation_metadata:{plugin_data:{from_client:e}}},i&&{selected_sources:he(i)}),s&&{selected_github_repos:[...(g=s.selectedRepos)!=null?g:[]],selected_all_github_repos:s.selectedAllRepos}),clientMetadata:{completionSampleFinishTime:Date.now()}};r(B(w({},l),{promptMessage:f,completionMetadata:{conversationMode:d!=null?d:{kind:E.PrimaryAssistant},systemHints:a?[a]:void 0}}))}const P=te({starting:{id:"jitPluginMessage.starting",defaultMessage:"Starting action"},confirmingSimple:{id:"jitPluginMessage.confirming.simple",defaultMessage:"{gizmoName} wants to talk to {domain}"},confirmingSubtitle:{id:"jitPluginMessage.confirming.subtitle",defaultMessage:"Only allow sites you trust."},running:{id:"jitPluginMessage.runningV4",defaultMessage:"Talking to {domain}"},finished:{id:"jitPluginMessage.finishedV4",defaultMessage:"Talked to {domain}"},stopped:{id:"jitPluginMessage.stoppedV4",defaultMessage:"Stopped talking to {domain}"},error:{id:"jitPluginMessage.errorV5",defaultMessage:"Error talking to {domain}"},declined:{id:"jitPluginMessage.declined",defaultMessage:"You declined this action"},ranTest:{id:"jitPluginMessage.ranTest",defaultMessage:"Tested {operationName}"},confirmParamsTitle:{id:"jitPluginMessage.confirmParamsTitleV3",defaultMessage:"{gizmoName} wants to share this info with {domain}"},sentParamsTitle:{id:"jitPluginMessage.sentParamsTitleV2",defaultMessage:"{gizmoName} sent this info to {domain}"},privacyPolicyLink:{id:"jitPluginMessage.privacyPolicyLinkV2",defaultMessage:"Privacy policy"},connectorAccepted:{id:"jitPluginMessage.connectorAccepted",defaultMessage:"Accepted using {domain}"},connectorDeclined:{id:"jitPluginMessage.connectorDeclined",defaultMessage:"Declined connection to {domain}"},rememberForThisConversation:{id:"jitPluginMessage.rememberForThisConversation",defaultMessage:"Remember for this conversation"}});export{Le as APIToolElicitationMessage};
//# sourceMappingURL=cnbuivqvzovh3vb1.js.map
