const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/e68sl8hljick9cm0.js","assets/mw35uwhq4g8r9eam.js","assets/d0xa318sl7ywi0za.js","assets/root-kavs8piy.css"])))=>i.map(i=>d[i]);
var ve=Object.defineProperty,be=Object.defineProperties;var _e=Object.getOwnPropertyDescriptors;var ee=Object.getOwnPropertySymbols;var Fe=Object.prototype.hasOwnProperty,Ie=Object.prototype.propertyIsEnumerable;var se=(s,t,n)=>t in s?ve(s,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[t]=n,u=(s,t)=>{for(var n in t||(t={}))Fe.call(t,n)&&se(s,n,t[n]);if(ee)for(var n of ee(t))Ie.call(t,n)&&se(s,n,t[n]);return s},_=(s,t)=>be(s,_e(t));import{r as w,j as e,M as F,d as Se,v as ie,_ as Ne,h as we}from"./mw35uwhq4g8r9eam.js";import{u as O,ht as Pe,cF as G,fn as ke,fB as h,al as Me,rK as Te,am as E,qx as R,aA as Ue,qp as le,rL as oe,iw as ae,mC as B,er as Ce,bq as Ae,gh as De,be as Le,jh as Ee,d as Re,gK as ze,rM as Be,r2 as Ge,r3 as Oe,hq as qe,r4 as Ve,n4 as Ke,_ as Ze,df as He,rN as A,lS as We,rO as q,rP as V,lT as Xe,gL as $e,li as Je}from"./d0xa318sl7ywi0za.js";import{g as Qe,D as te}from"./gl4f6lge29au0ljx.js";import{bc as Ye,bn as es,hf as ce,hg as de,hh as ss,be as ts,hi as ns,go as ne,gx as rs}from"./g2euln7v5pbm31qa.js";import{f as is}from"./m89x2zftpo6hrypr.js";import{u as ls}from"./iio0zgk2sqlxbcjy.js";const re=Le(()=>Ne(()=>import("./e68sl8hljick9cm0.js"),__vite__mapDeps([0,1,2,3])).then(s=>s.FilePreviewModal));function os({gizmoResource:s,canEdit:t,pendingFiles:n,files:a,interpreterOnlyFileIds:d,onAddFiles:p,removePendingFile:j,pendingFileUpsertMutationsRef:c,onFileDeletedOptimistic:o}){const m=O(),y=s.gizmo.id,I=s.gizmo.display.name,P=Pe(m),[i,S]=w.useState(()=>new Set),k=a.filter(v=>!i.has(v.file_id)),r=v=>{S(M=>{if(M.has(v))return M;const D=new Set(M);return D.add(v),D}),o==null||o(v)};return n.length===0&&k.length===0?e.jsx("div",{className:"h-full pb-4",children:e.jsx(ps,{gizmoName:I,onAddFiles:p,canEdit:t})}):e.jsxs("div",{className:"pb-6",children:[e.jsx(as,{numFiles:k.length+n.length}),e.jsx(cs,{canEdit:t,projectId:y,files:k,pendingFiles:n,interpreterOnlyFileIds:d,removePendingFile:j,pendingFileUpsertMutationsRef:c,className:G("border-token-border-light overflow-hidden rounded-lg border",P&&"max-h-75 overflow-y-auto"),onFileDeletedOptimistic:r})]})}function as({numFiles:s}){const t=O(),n=Me(t),a=Se();if(!Te({ctx:t,accountPlanType:n==null?void 0:n.planType,numFiles:s}))return null;let d;return(n==null?void 0:n.planType)===E.FREE?d=e.jsx(F,_(u({},h.projectFileRateLimitBannerPlusDescription),{values:{freeFileLimit:R(t,E.FREE),paidFileLimit:R(t,E.PLUS)}})):d=e.jsx(F,_(u({},h.projectFileRateLimitBannerProDescription),{values:{paidFileLimit:R(t,E.PLUS),proFileLimit:R(t,E.PRO),planType:n==null?void 0:n.planType.valueOf()}})),e.jsxs("div",{className:"bg-token-bg-tertiary mb-3 flex flex-row items-center justify-between gap-3 rounded-xl p-3 text-sm",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-token-text-primary",children:e.jsx(F,u({},h.projectFileRateLimitBannerTitle))}),e.jsx("span",{className:"text-token-text-secondary",children:d})]}),e.jsx(Ue,{color:"secondary",className:"bg-token-bg-tertiary",onClick:()=>{es(a,"projects file upsell banner")},children:e.jsx(F,u({},h.upgradeToPlus))})]})}function cs({projectId:s,files:t,pendingFiles:n,interpreterOnlyFileIds:a,removePendingFile:d,pendingFileUpsertMutationsRef:p,canEdit:j,className:c,onFileDeletedOptimistic:o}){const m=le(),[y,I]=w.useState(()=>new Set),P=t.filter(i=>!y.has(i.file_id));return P.length===0&&n.length===0?null:e.jsxs("div",{className:c,children:[P.map(i=>e.jsx(us,{gizmoId:s,gizmoFile:i,interpreterOnly:a.includes(i.file_id),canEdit:j,onDelete:()=>{i.file_id&&I(r=>{if(r.has(i.file_id))return r;const l=new Set(r);return l.add(i.file_id),l}),i.file_id&&(o==null||o(i.file_id));const S=new Promise(r=>{p.current.push({id:s,mutationId:ie(),update:l=>{const v=l.files.filter(M=>M.file_id!==i.file_id);return _(u({},l),{files:v})},onSuccess:r})});return oe(s)({projectId:s,upsertProjectMutation:m,pendingFileUpsertMutationsRef:p}),S}},i.file_id)),n.map(i=>e.jsx(ds,{canEdit:j,interpreterOnly:a.includes(i.tempId),pendingFile:i,onDelete:async()=>d(i.tempId)},i.tempId))]})}function ue(){return e.jsx("div",{className:"truncate",children:e.jsx(F,u({},h.interpreterOnlyLabel))})}function ds({pendingFile:s,onDelete:t,interpreterOnly:n,canEdit:a}){var c,o,m;const d=s.file.name,j=(ss(s.file)&&((c=s.file)==null?void 0:c.type.startsWith("image/"))||ae(d))&&e.jsx(ce,{file:s.file,fileName:d,fileId:(o=s.fileId)!=null?o:void 0,gizmoId:(m=s.gizmoId)!=null?m:void 0});return e.jsx(pe,{interpreterOnly:n,onDelete:t,canEdit:a,children:e.jsx(de,{icon:j,fileName:s.file.name,loadingPercentage:s.status===B.Uploading?s.progress:void 0,customFileDescription:n?e.jsx(ue,{}):void 0})})}function us({gizmoFile:s,gizmoId:t,interpreterOnly:n,onDelete:a,canEdit:d}){const p=s.name,c=ae(p)&&s.file_id!=null&&e.jsx(ce,{fileName:p,fileId:s.file_id,gizmoId:t}),o=O(),m=()=>{const y=s.file_id;y&&Ae(o,re,{gizmoId:t,fileId:y,fileName:s.name,onClose:()=>De(o,re)})};return e.jsx(pe,{interpreterOnly:n,onDelete:a,canEdit:d,children:e.jsx("div",{className:"cursor-pointer",onClick:m,children:e.jsx(de,{icon:c,fileName:s.name,customFileDescription:n?e.jsx(ue,{}):void 0})})})}function pe({children:s,onDelete:t,canEdit:n,interpreterOnly:a}){const[d,p]=w.useState(!1);return e.jsxs("div",{className:G("group/file-row border-token-border-light flex w-full items-center gap-3 border-b p-3 text-sm last:border-b-0",n?"hover:bg-token-interactive-bg-primary-selected/5":"hover:bg-transparent",a),children:[e.jsx("div",{className:"min-w-0 flex-1",children:s}),n&&e.jsx("button",{type:"button",onClick:async()=>{t&&(p(!0),await t(),p(!1))},className:G("group/file-layout -m-2 flex aspect-square shrink-0 grow-0 items-center justify-center bg-transparent p-2",!d&&"can-hover:opacity-0 group-hover/file-row:opacity-100 focus-visible:opacity-100"),children:e.jsx("div",{className:"group-hover/file-layout:bg-token-interactive-bg-primary-selected/5 group-active/file-layout:bg-token-interactive-bg-primary-selected/15 h-full w-full rounded-md p-[5px]",children:d?e.jsx("div",{className:"flex h-full w-6 items-center justify-center",children:e.jsx(Ce,{})}):e.jsx(ts,{className:"icon-sm text-token-secondary"})})})]})}function ps({gizmoName:s,onAddFiles:t,canEdit:n}){return e.jsx("div",{className:"border-token-border-default active:bg-token-bg-tertiary flex h-full cursor-pointer items-center justify-center rounded-lg border px-4 py-3 pb-6",onClick:t,children:e.jsxs("div",{className:"text-token-text-secondary flex flex-col items-center gap-2 py-4 text-sm",children:[n?e.jsx(Ye,{}):e.jsx(ke,{}),e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-token-text-secondary max-w-100",children:e.jsx(F,_(u({},h.emptyFileInstructions),{values:{gizmoNameText:e.jsx("span",{className:"font-bold",children:e.jsx(F,_(u({},h.emptyFileGizmoName),{values:{gizmoName:s}}))},"gizmoNameText")}}))})})]})})}const ms=({ctx:s,gizmoResource:t,canEdit:n,gizmoEditorData:a,openFileDialog:d,pendingFiles:p,setVersion:j,pendingFileUpsertMutationsRef:c,currentModelConfig:o})=>{"use no forget";var k;const m=t.gizmo.id,y=(k=a==null?void 0:a.files)!=null?k:[],I=Array.from(p.current.values()).filter(r=>y.every(l=>l.file_id!==r.fileId)),P=I.filter(r=>o!=null&&q(o,r.file.type,r.file.name)===V.CodeInterpreter),i=y.filter(r=>o!=null&&r.type!=null&&q(o,r.type,r.name)===V.CodeInterpreter),S=[...P.map(r=>r.tempId),...i.map(r=>r.file_id)];return e.jsx(os,{gizmoResource:t,canEdit:n,pendingFiles:I,pendingFileUpsertMutationsRef:c,files:y,interpreterOnlyFileIds:S,onAddFiles:d,removePendingFile:r=>{p.current.delete(r),A({ctx:s,id:m,pendingFiles:{key:r,value:null}}),j(l=>l+1)}})},_s=w.forwardRef(function({gizmo:t,accountPlanType:n,onPendingFilesChange:a,className:d},p){"use no forget";var $;const j=we(),c=O(),o=Ee(c),m=R(c,n),y=le(),I=ns(t),P=void 0,i=Re(()=>ze(c,{isGizmo:!1})),S=($=i.models.get(Be))!=null?$:i&&is(i.models.values(),C=>C.tags.includes($e.GPT_4o)),[k,r]=w.useState(0),l=w.useRef(new Map),v=w.useRef([]),M=Ge(S,void 0),D=l.current.size>0;w.useEffect(()=>{a==null||a(D)},[D,a]);const me=C=>{C.some(({errors:b})=>{var N;return b.length!==1||((N=b[0])==null?void 0:N.code)!==ne.TooManyFiles})?o.danger(h.unknownError,{duration:2,toastId:"snorlax_handle_file_rejected"}):o.danger(j.formatMessage(h.dragTooManyFilesError,{maxFileLimit:m}),{duration:2,toastId:"snorlax_handle_file_rejected",loggingTitle:"drag_too_many_files_error"})},fe=async C=>{Ze.logEvent("Upload File",{client:"web",eventSource:"mouse",intent:"gizmo"});const b=I.id;C.length>0&&await Promise.all(C.map(N=>{const z=He(N),J={tempId:z,gizmoId:b,file:N,status:B.Uploading,progress:1,fileId:null,cdnUrl:null};l.current.set(z,J),A({ctx:c,id:b,pendingFiles:{key:z,value:J}}),We(z,N,j,o,{kind:Xe.Gizmo,gizmoId:b},{onFileUploaded:(f,T,U,x)=>{const g=l.current.get(f);g!=null&&g.fileId&&g!=null&&g.fileId&&(v.current.push({id:t.gizmo.id,mutationId:ie(),update:L=>{var Q,Y;if(!g.fileId)return L;const ye=[...(Q=L.files)!=null?Q:[],{file_id:g.fileId,name:g.file.name,size:g.file.size,type:(Y=x==null?void 0:x.mimeType)!=null?Y:Je(g.file),last_modified:g.file.lastModified,file_size_tokens:x==null?void 0:x.fileTokenSize}];return _(u({},L),{files:ye})},onSuccess:()=>{l.current.delete(f),A({ctx:c,id:b,pendingFiles:{key:f,value:null}}),r(L=>L+1)}}),oe(t.gizmo.id)({projectId:t.gizmo.id,upsertProjectMutation:y,pendingFileUpsertMutationsRef:v}))},onFileCreated:(f,T,U)=>{const x=_(u({tempId:f,gizmoId:b,file:N,status:B.Uploading,progress:1},l.current.get(f)),{fileId:T,cdnUrl:U});l.current.set(f,x),A({ctx:c,id:b,pendingFiles:{key:f,value:x}}),r(g=>g+1)},onFileUploadProgress:(f,T)=>{const U=l.current.get(f);if((U==null?void 0:U.status)===B.Uploading){const x=_(u({},U),{progress:T>95?95:T});l.current.set(f,x),A({ctx:c,id:b,pendingFiles:{key:f,value:x}})}r(x=>x+1)},onError:f=>{l.current.delete(f),A({ctx:c,id:b,pendingFiles:{key:f,value:null}}),r(T=>T+1)}},{usesRetrievalIndex:S!=null&&q(S,N.type,N.name)===V.Retrieval,contextScopes:P})}))},K=Oe(M),Z=Qe(K),H=l.current.size+I.files.length,{canEdit:W}=qe(t),{open:X,getInputProps:xe,getRootProps:ge,isDragAccept:he,isDragReject:je}=ls(u({noClick:!0,noKeyboard:!0,noDragEventsBubbling:!0,onDropAccepted:fe,onDropRejected:me,multiple:!0,maxSize:Ve,maxFiles:m-H,validator:()=>H>=m?{code:ne.TooManyFiles,message:"Too many files"}:null,disabled:!W},K));return w.useImperativeHandle(p,()=>({openFileDialog:X,hasPendingFiles:()=>l.current.size>0})),e.jsxs("div",_(u({},ge({className:G("h-full px-4 min-w-0",d)})),{children:[e.jsx("input",u({},xe())),e.jsx(ms,{ctx:c,gizmoResource:t,canEdit:W,gizmoEditorData:I,openFileDialog:X,pendingFiles:l,pendingFileUpsertMutationsRef:v,setVersion:r,currentModelConfig:S}),he&&e.jsxs(te,{children:[e.jsx(rs,{}),e.jsx("h3",{children:e.jsx(F,u({},h.dragInstructions))}),e.jsx("h4",{className:"w-2/3 text-center",children:Z.length>0?Z.join(", "):e.jsx(F,u({},h.dragAllAccepted))})]}),je&&e.jsxs(te,{children:[e.jsx(Ke,{className:"icon-2xl"}),e.jsx("h3",{children:e.jsx(F,u({},h.dragTooManyFiles))}),e.jsx("h4",{className:"w-2/3 text-center",children:e.jsx(F,_(u({},h.dragTooManyFilesDescription),{values:{maxFileLimit:m}}))})]})]}))});export{_s as S};
//# sourceMappingURL=cso97771s1xclnnu.js.map
