var ge=Object.defineProperty,ve=Object.defineProperties;var je=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var ye=Object.prototype.hasOwnProperty,Me=Object.prototype.propertyIsEnumerable;var H=(s,t,o)=>t in s?ge(s,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[t]=o,T=(s,t)=>{for(var o in t||(t={}))ye.call(t,o)&&H(s,o,t[o]);if(K)for(var o of K(t))Me.call(t,o)&&H(s,o,t[o]);return s},V=(s,t)=>ve(s,je(t));import{r as d,j as e,h as Ce}from"./mw35uwhq4g8r9eam.js";import{m8 as be,m9 as Se,ma as I,mb as we,mc as ke,bv as Ne,ih as Ie,md as te,me as R,bI as z,cp as De,mf as _e,mg as W}from"./g2euln7v5pbm31qa.js";import{S as $e}from"./fntq0a1i1nl7pah6.js";import{eu as Ee,cu as Q,V as Y,P as G,fK as Te,er as se,aB as ne,f7 as Ve,e5 as oe,ek as ae,cF as ie,ax as Oe}from"./d0xa318sl7ywi0za.js";import{g as Ae}from"./ep9fotatx7vn0ew6.js";import{u as Be}from"./lmjej3aac0uhz664.js";import{u as Fe,g as Le}from"./ehb03yyzqhj5ry6r.js";import{M as Pe}from"./i693kfbch8smq86y.js";import"./ftef8970ba1zoykr.js";import"./iiok29s29bpdre61.js";import"./cvtbni005816i9ea.js";import"./laafg2mog1bp1gmd.js";import"./kcp2yv1bqmcmvayq.js";import"./jq5arodfofi7kok7.js";import"./gy1lpvuoewmzh42c.js";import"./iknugp00locgtve5.js";import"./h1em0bjkpkjv8ykw.js";import"./kbj1b07s2z6vxqkg.js";import"./hu1bt0oauegdhua6.js";const We=s=>s>=1e3?"".concat((s/1e3).toFixed(2),"s"):"".concat(s.toFixed(0),"ms");function Re(s,t){const o={},i=(n,r="")=>{Object.entries(n).forEach(([h,g])=>{const m=r?"".concat(r,".").concat(h):h;g&&typeof g=="object"&&!Array.isArray(g)?i(g,m):g&&(typeof g=="number"||typeof g=="string"||g==null)&&(o[m]=g)})};i(s);const c={},l=n=>c[n]||(c[n]={}),f=n=>{if(n!=null){if(typeof n=="number")return n;if(typeof n=="string")return new Date(n).getTime()}};Object.keys(o).forEach(n=>{const r=o[n];if(r==null)return;const h=n.split(".").pop(),g=[[/^(.*)_start_time$/,"start",m=>m[1]],[/^(.*)_end_time$/,"end",m=>m[1]],[/^(.*)_sent_time$/,"start",m=>m[1]],[/^(.*)_success_time$/,"end",m=>m[1]],[/^(.*)_time$/,"start",m=>m[1]]];for(const[m,S,M]of g){const C=h.match(m);if(C){const j=M(C),_=l(j);_[S]=f(r);break}}});const u=[];Object.entries(c).forEach(([n,{start:r,end:h}])=>{r!==void 0&&h!==void 0?u.push({name:n,start:r,end:h,duration:h-r}):r!==void 0&&u.push({name:n,start:r,end:r,duration:0,noEnd:!0})});let x=u;if(t&&t.length){const n=new Set(t);x=x.filter(r=>n.has(r.name))}return x.sort((n,r)=>n.start-r.start||n.name.localeCompare(r.name)),x}const ee=["text-blue-400","text-green-400","text-purple-400","text-orange-400","text-red-400","text-pink-400","text-yellow-400","text-gray-500","text-blue-300","text-green-300"],ze=({json:s,focusNames:t,width:o,barHeight:i=18,rowGap:c=6,paddingX:l=50,paddingTop:f=20})=>{const u=d.useRef(null),[x,n]=d.useState(o||600);Ee(()=>{if(!o){const a=()=>{if(u.current){const p=u.current.clientWidth;n(Math.max(300,p))}};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)}},[o]);const r=d.useMemo(()=>Re(s,t),[s,t]),[h,g]=d.useState({}),m=d.useCallback(a=>h[a]!==!1,[h]),S=d.useCallback(a=>g(p=>V(T({},p),{[a]:p[a]===!1})),[]),M=d.useMemo(()=>r.filter(a=>m(a.name)),[r,m]),C=M.length>0,j=C?Math.min(...M.map(a=>a.start)):0,_=C?Math.max(...M.map(a=>a.end)):1,k=Math.max(_-j,1),w=f+r.length*(i+c)+c+32,re=(r.length?Math.max(...r.map(a=>a.name.length)):0)*7+16+16,O=Math.max(l,re),le=l,L=(x-O-le)/k,[de,q]=d.useState(null),[A,J]=d.useState({visible:!1,x:0,y:0,lines:[]}),X=(a,p)=>{if(!u.current)return;const v=u.current.getBoundingClientRect(),y=p.clientX-v.left,B=p.clientY-v.top,$=(a.start-j).toFixed(2),E=a.noEnd?void 0:(a.end-j).toFixed(2),P=E?["start: ".concat($," ms"),"end: ".concat(E," ms"),"dur: ".concat(a.duration.toFixed(2)," ms")]:["start: ".concat($," ms")];J({visible:!0,x:y+10,y:B+10,lines:P})},me=()=>J(a=>V(T({},a),{visible:!1})),ue=d.useMemo(()=>{if(!C)return[0,k];const a=new Set;M.forEach(v=>{a.add(v.start-j),a.add(v.end-j)});const p=Array.from(a).sort((v,y)=>v-y);return p[0]!==0&&p.unshift(0),p[p.length-1]!==k&&p.push(k),p},[M,j,k,C]);return e.jsxs("div",{ref:u,className:"relative w-full",style:o?{width:"".concat(o,"px")}:void 0,children:[e.jsxs("svg",{width:x,height:w,className:"font-sans",children:[r.map((a,p)=>{const v=f+p*(i+c),y=m(a.name)?O+(a.start-j)*L:0,B=m(a.name)?Math.max(a.duration*L,1):0,$=ee[p%ee.length],E=de===p?"opacity-80":"opacity-100",P=a.duration===0,Z=!!a.noEnd,xe=N=>{m(a.name)&&(q(p),X(a,N))},fe=N=>{m(a.name)&&X(a,N)},pe=()=>{q(null),me()};return e.jsxs("g",{onMouseEnter:xe,onMouseMove:fe,onMouseLeave:pe,children:[e.jsx("foreignObject",{x:0,y:v,width:O-8,height:i,requiredExtensions:"http://www.w3.org/1999/xhtml",children:e.jsx("div",{className:"pointer-events-auto box-border flex h-full items-center justify-end gap-1 pe-1 text-[12px] text-neutral-900 select-none",children:e.jsxs("label",{className:"flex cursor-default items-center gap-1",children:[e.jsx("input",{type:"checkbox",checked:m(a.name),onChange:()=>S(a.name),className:"cursor-pointer"}),e.jsx("span",{children:a.name})]})})}),m(a.name)&&(Z?(()=>{const N=v+i/2,F=i*.6/2,he=["".concat(y,",").concat(N-F),"".concat(y+F,",").concat(N),"".concat(y,",").concat(N+F),"".concat(y-F,",").concat(N)].join(" ");return e.jsx("polygon",{points:he,fill:"currentColor",className:"".concat($," ").concat(E)})})():P?e.jsx("line",{x1:y,x2:y,y1:v,y2:v+i,stroke:"currentColor",strokeWidth:2,className:$}):e.jsx("rect",{x:y,y:v,width:B,height:i,fill:"currentColor",className:"".concat($," ").concat(E)})),m(a.name)&&e.jsxs("text",{x:y+(Z?i*.6:B)+4,y:v+i/2+4,fill:"currentColor",className:"text-xs text-neutral-700",children:[a.duration.toFixed(2)," ms"]})]},a.name)}),ue.map(a=>{const p=O+a*L;return e.jsx("line",{x1:p,x2:p,y1:f-3,y2:w-32,stroke:"currentColor",strokeWidth:1,className:"text-gray-200"},a)}),e.jsx("text",{x:x/2,y:w-6,textAnchor:"middle",fill:"currentColor",className:"text-xs text-neutral-600",children:"Time since first event (ms)"})]}),A.visible&&e.jsx("div",{className:"pointer-events-none absolute z-10 rounded bg-black/90 px-1.5 py-1 font-mono text-xs whitespace-nowrap text-white",style:{left:A.x,top:A.y},children:A.lines.map((a,p)=>e.jsx("div",{children:a},p))})]})};function Ue({conversationId:s}){var l;const t=Q(s),o=(l=Y.getCurrentNode(G(s)))==null?void 0:l.id,i=be();return Se()?e.jsx(D,{conversationId:t!=null?t:s,parentMessageId:o,status:i}):null}function D(s){var n;const t=(n=s==null?void 0:s.status)==null?void 0:n.modes,[o,i]=d.useState(!1),[c,l]=d.useState(),f=d.useCallback(r=>{l(r),i(!0)},[]),u=Ce(),x=d.useCallback(()=>i(!1),[]);return e.jsxs(e.Fragment,{children:[e.jsx(Te,{contentAlign:"center",triggerButton:e.jsx(D.Trigger,{}),children:t?t.map(r=>d.createElement(D.Item,V(T({},s),{key:r.display_name,voiceStatusMode:r,onShowModal:f}))):e.jsx("div",{role:"progressbar","aria-valuetext":u.formatMessage({defaultMessage:"Loading voice modes",id:"voiceModeButton.loadingModes"}),"aria-busy":"true","aria-live":"assertive","aria-valuemin":0,"aria-valuemax":100,children:e.jsx(se,{"aria-hidden":"true",className:"my-4 min-w-full"})})}),e.jsx(D.Modal,{conversationId:s.conversationId,disabledModeMetadata:c,isOpen:o,onClose:x})]})}D.Modal=function(t){var l,f,u,x;const o=(f=(l=t.disabledModeMetadata)==null?void 0:l.buttons)!=null?f:[],i=Be({buttons:o,conversationId:t.conversationId,onClick:t.onClose}),c=e.jsx(Pe,{children:(u=t.disabledModeMetadata)==null?void 0:u.description_markdown});return e.jsx(ne,{testId:"modal-voice-mode",title:(x=t.disabledModeMetadata)==null?void 0:x.title,description:c,isOpen:t.isOpen,onClose:t.onClose,type:"success",primaryButton:i.primary,secondaryButton:i.secondary})};D.Trigger=d.forwardRef(function(t,o){var c;const i=I(l=>l.voiceMode);return e.jsxs(we,V(T({ref:o},t),{children:[(c=ke(i))!=null?c:e.jsx(se,{}),e.jsx(Ne,{className:"icon text-token-text-tertiary"})]}))});D.Item=function({conversationId:t,parentMessageId:o,voiceStatusMode:i,onShowModal:c}){const{disabled_mode_metadata:l,mode:f}=i,{startVoiceMode:u}=Fe(),x=Q(t),n=d.useCallback(async()=>{l?c(l.disabled_message):u(Le({serverThreadId:x,parentMessageId:o,isAdvancedMode:f==="advanced"&&!l,eventSource:"voice_mode_picker",clientThreadId:t,gizmoId:Y.getGizmoId(G(t)),skipCacheReason:"debug-button-clicked"}))},[t,l,f,c,o,x,u]);return e.jsx(Ve.Item,{onClick:n,children:e.jsxs("div",{children:[i.display_name,e.jsx("div",{className:"text-token-text-tertiary text-xs",children:i.description})]})})};function yt({conversationId:s}){const t=I(i=>i.voiceSessionId),o=I(i=>{const{sessionCreateTime:c,sessionConnectedTime:l}=i.metrics;return c&&l?l.getTime()-c.getTime():null});return e.jsx("div",{className:"relative h-full",children:e.jsx(oe.div,{className:"border-s-token-sidebar-surface-secondary bg-token-main-surface-secondary absolute hidden h-full max-w-[500px] overflow-y-auto rounded-xl border-s pt-4 shadow-inner md:block",initial:{opacity:0,x:520,width:"0px"},animate:{opacity:1,x:0,width:"500px",left:"-520px"},exit:{opacity:0,x:520,width:"0px",left:"0px"},transition:{type:"tween"},children:e.jsx(ae,{children:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex w-full items-center justify-center",children:e.jsx(Ue,{conversationId:s})}),e.jsxs("div",{className:"p-4 py-2 text-sm",children:[e.jsx(b,{name:"Voice Session ID",text:t!=null?t:"n/a"}),e.jsx(Qe,{conversationId:s}),e.jsx(b,{name:"Connect Latency",text:o!==null?We(o):"n/a"}),e.jsx(Ye,{})]}),e.jsxs("div",{className:"flex h-full w-full flex-col flex-nowrap gap-4",children:[e.jsx("div",{className:"px-4",children:e.jsxs("div",{className:"flex flex-col flex-nowrap gap-4",children:[e.jsx(Ge,{}),e.jsx(qe,{})]})}),!1]})]})})})})}function Qe({conversationId:s}){var r,h,g;const t=Q(s),o=t&&G(t),i=Y.getTree(o),c=I(m=>m.server.messages.findLast(S=>S.type===te.ConversationUpdate)),l=c==null?void 0:c.payload.parent_message_id,f=l?i.findNode(m=>m.message.author.role==="assistant"&&Oe.isMultimodalTextMessage(m.message),l):void 0,{model_definition_slug:u,model_definition_virtual_model_id:x}=(h=(r=f==null?void 0:f.message.metadata)==null?void 0:r.__internal)!=null?h:{},n=(g=[u,x].filter(Boolean).join(", "))!=null?g:"pending model response";return e.jsx(b,{name:"Model ID",text:n,allowWrap:!0})}function Ye(){const[s,t]=d.useState(!1),[o,i]=d.useState({}),c=Ie(),l=d.useCallback(()=>{t(f=>!f)},[]);return d.useEffect(()=>{s&&Ae(c).then(i)},[s,c]),e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"cursor-pointer font-semibold text-blue-500 hover:underline dark:text-blue-300",onClick:l,children:s?"Hide Client Metrics Chart":"Show Client Metrics Chart"}),e.jsxs(ne,{testId:"modal-client-metrics",title:"Client Metrics",isOpen:s,onClose:()=>t(!1),size:"fullscreen",showCloseButton:!0,children:[e.jsx(ze,{json:o}),e.jsx("pre",{className:"bg-token-bg-tertiary text-token-text-secondary m-4 overflow-x-auto rounded-md p-2 text-[10px] font-semibold",children:JSON.stringify(o,null,2)})]})]})}function Ge(){const[s,t]=d.useState("timestamp"),[o,i]=d.useState("asc"),c=I(n=>n.server.messages.filter(r=>r.type===te.Performance)),l=c[c.length-1],f=d.useCallback(n=>n>=1e3?"".concat((n/1e3).toFixed(2),"s"):"".concat(n.toFixed(1),"ms"),[]),u=d.useMemo(()=>l?[...l.payload.metrics].sort((n,r)=>{const h=s==="name"?n.name.localeCompare(r.name):n.ms-r.ms;return o==="asc"?h:-h}):[],[l,s,o]),x=n=>{n===s?i(o==="asc"?"desc":"asc"):(t(n),i("asc"))};return e.jsx(ce,{title:"Performance",open:!1,children:l?e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsxs("div",{className:"flex flex-row items-center",children:[e.jsx(U,{text:"Metric"}),s==="name"?o==="asc"?e.jsx(R,{}):e.jsx(z,{}):null]}),e.jsxs("div",{className:"flex cursor-pointer flex-row items-center",onClick:()=>x("timestamp"),children:[e.jsx(U,{text:"Timestamp"}),s==="timestamp"?o==="asc"?e.jsx(R,{}):e.jsx(z,{}):null]}),u.map(n=>e.jsxs(e.Fragment,{children:[e.jsx("span",{title:n.name,className:"line-clamp-1 block min-w-0 truncate text-sm",children:n.name},n.name),e.jsx("span",{className:"bg-token-main-surface-tertiary line-clamp-1 rounded-lg p-0.5 px-1 font-mono text-xs",children:f(n.ms)},n.name+n.ms)]}))]}):null})}function qe(){var u,x;const s=I(n=>n.server.connectionState),t=I(n=>n.dev.room),[o,i]=d.useState("Unknown"),c=t==null?void 0:t.localParticipant,l=(u=t==null?void 0:t.numParticipants)!=null?u:"Unknown",f=(x=t==null?void 0:t.activeSpeakers)!=null?x:[];return d.useEffect(()=>{if(c){const n=r=>{i(r)};return c.on("connectionQualityChanged",n),()=>{c.off("connectionQualityChanged",n)}}},[c]),e.jsxs(ce,{title:"Room",open:!1,children:[e.jsx(b,{name:"Connection Quality",text:String(o)}),e.jsx(b,{name:"Connection State",text:String(s)}),e.jsx(b,{name:"Participants",text:l}),e.jsx(b,{name:"Speakers",text:f.length}),e.jsx(Je,{})]})}function Je(){const s=I(r=>r.dev.room),[t,o]=d.useState(null),[i,c]=d.useState(null),[l,f]=d.useState(null),u=s==null?void 0:s.getActiveDevice("audioinput"),x=s==null?void 0:s.getActiveDevice("audiooutput"),n=s==null?void 0:s.getActiveDevice("videoinput");return d.useEffect(()=>{async function r(){var j,_,k;const h=await W.getLocalDevices("audioinput"),g=await W.getLocalDevices("audiooutput"),m=await W.getLocalDevices("videoinput"),S=h.find(w=>w.deviceId===u),M=g.find(w=>w.deviceId===x),C=m.find(w=>w.deviceId===n);o((j=S==null?void 0:S.label)!=null?j:"Unknown"),c((_=M==null?void 0:M.label)!=null?_:"Unknown"),f((k=C==null?void 0:C.label)!=null?k:null)}r()},[u,x,n]),e.jsxs(e.Fragment,{children:[e.jsx(U,{text:"Devices"}),l?e.jsx(b,{icon:De,name:"Video Input",text:l}):null,e.jsx(b,{icon:_e,name:"Audio Input",text:t!=null?t:"Unknown"}),e.jsx(b,{icon:$e,name:"Audio Output",text:i!=null?i:"Unknown"})]})}function ce({title:s,titleClassName:t,children:o,open:i}){const[c,l]=d.useState(i!=null?i:!0);return e.jsxs("div",{children:[e.jsxs("h3",{className:ie("text-token-text-secondary flex cursor-pointer items-center py-2 text-lg font-semibold",t),onClick:()=>l(!c),children:[e.jsx("span",{children:s}),e.jsx("span",{className:"ms-2",children:c?e.jsx(z,{className:"icon-sm"}):e.jsx(R,{className:"icon-sm"})})]}),e.jsx(ae,{initial:!1,children:c&&e.jsx(oe.div,{initial:"collapsed",animate:"open",exit:"collapsed",variants:{open:{height:"auto",opacity:1},collapsed:{height:0,opacity:0}},transition:{duration:.3,ease:"easeInOut"},layout:!0,children:o},"content")})]})}function U({text:s}){return e.jsx("h4",{className:"py-2 text-sm font-semibold",children:s})}function b(s){var t;return e.jsxs("div",{className:"flex flex-row flex-nowrap items-center gap-2",children:[e.jsx("span",{className:"opacity-85",children:s.icon?e.jsx(s.icon,{className:"h-[0.75rem] w-[0.75rem]"}):e.jsxs("span",{className:"text-sm",children:[s.name,":"]})}),(t=s.content)!=null?t:e.jsx("span",{className:ie(["bg-token-main-surface-tertiary rounded-lg p-0.5 px-1 font-mono text-xs",!s.allowWrap&&"line-clamp-1"]),children:s.text})]})}export{Ye as ClientMetrics,Ge as PerformanceStats,b as Stat,yt as VoiceModeDevPanel};
//# sourceMappingURL=d5om74bd7i4oukg9.js.map
