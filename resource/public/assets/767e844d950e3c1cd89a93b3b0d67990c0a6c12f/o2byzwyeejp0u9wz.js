var Ks=Object.defineProperty,zs=Object.defineProperties;var Gs=Object.getOwnPropertyDescriptors;var Ht=Object.getOwnPropertySymbols;var Qs=Object.prototype.hasOwnProperty,Ws=Object.prototype.propertyIsEnumerable;var Ft=(e,n,s)=>n in e?Ks(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s,X=(e,n)=>{for(var s in n||(n={}))Qs.call(n,s)&&Ft(e,s,n[s]);if(Ht)for(var s of Ht(n))Ws.call(n,s)&&Ft(e,s,n[s]);return e},J=(e,n)=>zs(e,Gs(n));import{h as V,j as t,M as ct,r as m,u as qe,i as de,b as ls,e as Zs,t as Ys}from"./mw35uwhq4g8r9eam.js";import{gv as Xs,gz as Js,yw as Ke,pw as D,px as U,pz as He,yx as us,yy as $s,yz as Vs,qN as en,qM as Ut,xH as tn,pT as sn,pU as nn,pW as an,yA as on,yB as rn,ec as cn,a3 as qt,bI as ln,X as Te,dE as Kt,U as zt,iv as un,iw as dn,ag as mn,ah as fn,yC as Be,aG as gn,aC as pn,fB as hn,pB as Cn,dt as xn,yD as yn,fK as vn,g8 as ye,yE as bn,yF as ds,yG as Sn,yH as Tn,yI as lt,yJ as En,w6 as wn,yK as An,pQ as ve,yL as _n,yM as In,m4 as kn,yN as jn,c as Pn,yO as Rn,yP as Mn,yQ as Dn,yR as Nn,g4 as On,g5 as Ln,g6 as Bn,ra as Gt,nl as Qt,g7 as Wt,yS as Hn,yT as Fn,b as Un,yU as qn,hv as Kn,mQ as zn,iI as Gn,yV as Zt,f6 as Yt,yW as ot,yX as Xt,yY as Oe,yZ as Le,y_ as Jt}from"./g2euln7v5pbm31qa.js";import{nk as ms,aB as Qn,e4 as Wn,dp as $t,bW as Zn,e5 as ae,aA as Vt,th as Yn,dn as Xn,M as ut,ek as ze,V as fs,ay as es,u as Ge,g as Jn,d as $n,iC as Vn,cF as Se,D as gs,R as $,cu as ps,xX as hs,f7 as k,qH as ea,n_ as ts,cw as Fe,e7 as ta,cA as sa,cy as na,J as Cs,fJ as aa,ij as oa,L as ra,cs as ss,fj as ia,iZ as ca,iO as la,lA as ua,f2 as da,m0 as ma,_ as fa}from"./d0xa318sl7ywi0za.js";import{O as ga,b as oe,u as pa,c as ha,j as Ca,g as xa,A as ya,a as va,f as ns,C as le,D as ba}from"./ixsv6fw3pmowsupe.js";import{e as Sa}from"./je2fy8gnwj5wx4yy.js";import{C as Ta}from"./dvfkv7rxjyuaocsc.js";import{i as Ea,d as wa,e as Aa,b as _a,a as Ia,g as ka}from"./krza42hj097hj350.js";import{C as Ue,k as as,S as os}from"./go83k4bw3m46lwwg.js";import{u as ja,C as Pa,a as Ra,H as Ma,T as Da}from"./byy90pmw2kt2bmil.js";import{a as Na}from"./bs910zydm18dg184.js";import{D as Oa}from"./fwz0otujtd6fpo4d.js";import{i as La}from"./dxkl0433k1u8ypnz.js";import{C as Ba}from"./kc32gem4l2t3hnxt.js";import{g as rt,S as Ha}from"./irqko7c1s7qpl41n.js";import{s as it,B as Fa}from"./f3alhksm9dfhscbq.js";import{N as Ua}from"./ce3hgmw4iyyhicud.js";import{L as qa}from"./kubdgxu3crk3gqem.js";import{i as rs}from"./m3aipoogd94oudzg.js";import{g as Ka}from"./bwg0lbtx0n9f11bn.js";var xs=(e=>(e.Close="close",e.Loaded="loaded",e.Streaming="streaming",e.Download="download",e))(xs||{});const za=({isOpen:e,dismissModal:n,closeTextdocEditor:s,textdocVersion:a,clientThreadId:i})=>{const r=V(),o=Xs(i),l=Js(i),p=ms(),c=Ke(a==null?void 0:a.textdocId),u=async y=>{D.logButtonClick(U.SAVE_TO_CHAT_ON_EDITOR_CLOSE),!((a==null?void 0:a.versionInt)==null||p)&&(l({sourceEvent:y,promptMessage:Zn("",{canvas:{user_created_textdocs:a!=null&&a.status===us.ATTACHED_PENDING&&c!=null?[{user_created_temp_textdoc_id:a.textdocId,type:a.type,title:a.title,content:a.content,create_source:c.create_source}]:void 0},open_in_canvas_view:{type:"canvas_textdoc",id:a.textdocId}}),completionMetadata:o?{conversationMode:o}:void 0}),c&&He.markAsSent(c.tempTextdocId),n(),s())};return t.jsx(Qn,{testId:"modal-confirm-close-editor",isOpen:e,size:"custom",className:"max-w-xl",onClose:n,type:"warning",hideSeparator:!0,title:t.jsx("span",{className:"text-xl",children:t.jsx(ct,{id:"jgd5rD",defaultMessage:"Are you sure you want to close?"})}),primaryButton:t.jsx($t.Button,{title:r.formatMessage({id:"XE+GiU",defaultMessage:"Save to chat"}),color:"primary",onClick:u}),secondaryButton:t.jsx($t.Button,{title:r.formatMessage({id:"MbWco5",defaultMessage:"Donâ€™t save and close"}),color:"secondary",onClick:()=>{D.logButtonClick(U.CLOSE_WITHOUT_SAVING),c&&He.removeTempTextdoc(c.tempTextdocId),n(),s()}}),showCloseButton:!0,closeButton:t.jsx(Wn,{onClick:n}),children:t.jsx("div",{className:"text-md text-token-text-secondary -mt-6 pb-2",children:t.jsx(ct,{id:"q9rJ+Y",defaultMessage:"Changes will not be saved unless you save this canvas to your chat."})})})};function ys(e){const n=$s();if(!e)return{isCodePreviewable:!1,isCodeExecutable:!1,hasCanvasCodeExecution:n};const s=Ea(e==null?void 0:e.type,e==null?void 0:e.content),a=wa(e.type);return{isCodePreviewable:s,isCodeExecutable:a,hasCanvasCodeExecution:n}}const Ga=({isTextdocStreaming:e,isRequestActive:n,value:s,comments:a})=>{const[i,r]=m.useState(!1);return m.useEffect(()=>{e&&i&&(r(!1),Ue.reset())},[s,a]),m.useEffect(()=>{n||(r(!1),Ue.reset())},[n]),[i,r]};function Qa({onClickRestore:e,onClickResetLatest:n}){const s=V();return t.jsx(ae.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},transition:{type:"spring",bounce:0},className:"bg-token-main-surface-primary z-30",children:t.jsx(ae.div,{className:"bg-token-main-surface-primary dark:border-token-border-xlight @container w-full items-center border-t border-gray-100 p-6 shadow-[0_-4px_32px_rgba(0,0,0,0.08)] lg:border-s dark:shadow-[0_-4px_32px_rgba(0,0,0,0.12)]",children:t.jsxs("div",{className:"mx-auto flex max-w-[48rem] flex-col flex-wrap justify-center gap-5 @2xl:flex-row @2xl:justify-between",children:[t.jsxs("div",{className:"flex flex-col px-2 text-center @2xl:text-start",children:[t.jsx("span",{className:"text-md text-token-text-primary font-semibold text-wrap",children:s.formatMessage({id:"gt23pb",defaultMessage:"You are viewing a previous version"})}),t.jsx("span",{className:"text-token-text-secondary text-sm text-wrap",children:s.formatMessage({id:"sAlUJn",defaultMessage:"Restore this version to make edits"})})]}),t.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-4",children:[t.jsx(Vt,{as:"button",color:"primary",onClick:e,children:s.formatMessage({id:"+cddAb",defaultMessage:"Restore this version"})}),t.jsx(Vt,{as:"button",color:"secondary",onClick:n,children:s.formatMessage({id:"qCD3eu",defaultMessage:"Back to latest version"})})]})]})})})}const Wa={type:"spring",bounce:.2,duration:.56},Za=({conversation:e,turn:n})=>{const s=Yn();return t.jsxs(ae.div,{className:"absolute start-0 end-0 top-0 z-10 -translate-y-full",children:[t.jsx(ae.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"bg-vert-light-gradient dark:from-token-main-surface-primary absolute inset-0 -top-5 dark:bg-linear-to-t dark:to-transparent"}),t.jsx(ae.div,{className:"flex items-center py-2",initial:{opacity:.75,translateX:-50,translateY:"100%"},animate:{opacity:1,translateX:0,translateY:"0"},exit:{opacity:0,filter:"blur(8px)",transition:{delay:.4,duration:.72}},transition:Wa,children:t.jsx(Ba,{conversation:e,onRequestCompletion:Xn,groupedMessagesToRender:n.messageGroups,allGroupedMessages:n.messageGroups,allMessages:n.messages,isUserTurn:!0,isFinalUserTurn:!1,isFinalAssistantTurn:!1,turnIndex:0,isCompletionRequestInProgress:!1,isFeedbackEnabled:!1,isFinalTurn:!1,hasActiveRequest:s})})]},"user-message")},Ya=({conversation:e})=>{const n=e.id,{lastUserTurn:s,lastAssistantTurn:a}=ut(n,r=>{const o=fs.getConversationTurns(r);let l=null,p=null;for(let c=o.length-1;c>0;c--){const u=o[c];if(!l&&u.role===es.User?l=u:!p&&u.role===es.Assistant&&(p=u),l&&p)break}return{lastUserTurn:l,lastAssistantTurn:p}}),i=s&&!(a!=null&&a.messages.some(r=>{var o;return(o=r.recipient)==null?void 0:o.startsWith(Vs)}));return t.jsx(ze,{initial:!1,children:i&&t.jsx(Za,{turn:s,conversation:e})})},Xa=({isRequestActive:e=!1,clientThreadId:n,readonlyReason:s,onCancel:a,onSubmit:i,onSubmitAccelerator:r,acceleratorActions:o=[]})=>{var P;const l=Ge(),p=Jn(l,n),[c,u]=m.useState(!1),[y,S]=m.useState(""),[f,E]=m.useState(!0),_=V(),[T,g]=m.useState(!1),x=$n(Vn),b=d=>{i==null||i(d,y),S("")},w=d=>{if(d.nativeEvent.isComposing)return;const{metaKey:A,shiftKey:I,key:j}=d;j==="Enter"&&y.trim()&&!(I||A)&&(b(d),d.preventDefault())};return t.jsxs(t.Fragment,{children:[c&&!x&&t.jsx(ga,{zIndexKey:"acceleratorsOverlay",className:"bg-white/95 dark:bg-black/85"}),t.jsx("div",{className:"relative mb-3 flex items-end justify-center",children:t.jsxs("div",{className:"relative mx-6 max-w-2xl flex-1",children:[t.jsx(Ya,{conversation:p}),t.jsx("div",{className:"flex flex-auto items-start",children:t.jsx("div",{className:Se("dark:bg-token-main-surface-secondary flex min-h-12 flex-auto items-center bg-[#f4f4f4] py-1 ps-6 pe-2",{"rounded-full":f,"rounded-2xl":!f,"bg-transparent":T}),children:t.jsxs("div",{className:"relative flex flex-auto items-center self-stretch",children:[t.jsx(La,{placeholder:_.formatMessage({id:"zrUbTJ",defaultMessage:"Ask ChatGPT to edit"}),disabled:e,value:y,className:Se("text-token-text-primary placeholder:text-token-text-secondary w-full resize-none border-0 bg-transparent p-0 outline-0 focus:ring-0 focus-visible:ring-0",{"opacity-0":T}),maxRows:4,onChange:({target:{value:d}})=>S(d),onKeyDown:w,onHeightChange:(d,{rowHeight:A})=>E(Math.floor(d/A)<=1)}),y?t.jsx(ae.button,{className:Se("dark bg-token-main-surface-primary h-8 w-8 rounded-full text-center disabled:bg-[#D7D7D7]",{"self-end":!f}),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.1},onMouseDown:b,children:t.jsx(en,{className:"text-token-text-primary h-8 w-8"})}):((P=o==null?void 0:o.length)!=null?P:0)>0&&t.jsx(Oa,{disableHint:!0,isVisuallyHidden:(s==null?void 0:s.isReadonly)&&!s.isStreaming,disableOverlay:!0,isEmbeddedInPromptArea:!0,isRequestActive:e,actions:o,onCancel:a,onExpandedChange:d=>{x||g(d),u(d)},onSubmit:r,right:0,bottom:4})]})})})]})})]})};function Ja(e,n){const s=new Set(e.map(l=>l.id)),a=new Set(n.map(l=>l.id)),i=e.filter(l=>!a.has(l.id)).map(l=>J(X({},l),{diffStatus:Ut.REMOVED})),r=n.filter(l=>!s.has(l.id)).map(l=>J(X({},l),{diffStatus:Ut.ADDED})),o=e.filter(l=>a.has(l.id));return i.concat(r,o)}const $a=e=>{const{textdocId:n}=e,s=tn(a=>{var i;return(i=a==null?void 0:a.resolveTempTextdocId[n])!=null?i:n});return m.useMemo(()=>J(X({},e),{textdocId:s}),[s,e])};async function Va({textdocId:e,newTitle:n}){n!=null&&await $.safePost("/textdoc/{textdoc_id}/rename",{parameters:{path:{textdoc_id:e}},requestBody:{title:n}}).catch(s=>{gs.addError("renameCanvasTitle Error:",s)})}const eo=({serverThreadId:e,textdocVersion:n,initialTitle:s="Untitled Document",isEditingTitle:a,setIsEditingTitle:i})=>{const r=qe(),{mutateAsync:o}=de({mutationKey:[e,"textdocs"],mutationFn:Va,onMutate:async({textdocId:g,newTitle:x})=>{await r.cancelQueries({queryKey:[e,"textdocs"]});const b=r.getQueryData([e,"textdocs"]);return r.setQueryData([e,"textdocs"],w=>{if(!w)return w;const P=new Map(w.persistedTextdocVersionById),d=P.get(g);if(d){const R=J(X({},d),{title:x!=null?x:""});P.set(g,R)}const A=w.persistedTextdocVersions.map(R=>R.textdocId===g?J(X({},R),{title:x!=null?x:""}):R),I=new Map(w.persistedTextdocById),j=I.get(g);if(j){const R=J(X({},j),{title:x!=null?x:""});I.set(g,R)}return J(X({},w),{persistedTextdocVersionById:P,persistedTextdocVersions:A,persistedTextdocById:I})}),{previousTextDocData:b}},retry:2,onError:(g,x,b)=>{b!=null&&b.previousTextDocData&&r.setQueryData([e,"textdocs"],b.previousTextDocData),gs.addError("Error updating title:",g)},onSettled:()=>{r.invalidateQueries({queryKey:[e,"textdocs"]})}}),l=async g=>{var x;n&&await o({textdocId:(x=n.textdocId)!=null?x:"",newTitle:g})},[p,c]=m.useState(s),u=m.useRef(null),y=m.useRef(p),S=m.useRef(!1);m.useEffect(()=>{a&&u.current&&(u.current.focus(),u.current.select())},[a]);const f=g=>{c(g.target.value)},E=()=>{y.current=p},_=async()=>{S.current||await l(p),S.current=!1,i(!1)},T=g=>{(g.key==="Enter"||g.key==="Escape")&&g.preventDefault(),g.key==="Enter"?g.currentTarget.blur():g.key==="Escape"&&(c(y.current),S.current=!0,g.currentTarget.blur())};return t.jsx("input",{className:"w-[300px] rounded-lg border-none px-3 py-2 outline-hidden focus:ring-0",ref:u,value:p,onChange:f,onFocus:E,onBlur:_,onKeyDown:T,style:{fontSize:"1.125rem",boxSizing:"border-box",backgroundColor:"var(--global-states-light-element-hover, rgba(0, 0, 0, 0.05))"}})};function to(e){const{voiceName:n}=sn(),s=e?()=>so(e.textdocId,n,an()):null,a="".concat(e==null?void 0:e.textdocId,".").concat(e==null?void 0:e.versionInt,".").concat(n);return nn(s,a)}function so(e,n,s){return $.safeGet("/textdoc/{textdoc_id}/synthesize",{parameters:{path:{textdoc_id:e},query:{voice:n,format:s}},skipJsonTransform:!0})}const no=({textdocVersion:e,isPersisting:n=!1,isTextdocAttachedPending:s,isTextdocStreaming:a,hasDebug:i,shouldShowPlayButton:r=!1,hideRenameButton:o=!1,toggleDebugView:l,isDebugVisible:p,toggleConsoleVisibility:c,isConsoleOpen:u,clientThreadId:y})=>{var B,G;const S=Ge(),f=V();on(S),to(e);const[E,_]=m.useState(!1),T=(B=e==null?void 0:e.title)!=null?B:"",g=(G=ps(y))!=null?G:"",x=Ke(e==null?void 0:e.textdocId),b=!T||(x==null?void 0:x.status)===rn.INFERRING,w=()=>{_(!0)},[P,d]=m.useState(!1),{container:A,triggerRef:I}=hs({isOpen:P,onClose:()=>d(!1)}),j=[!x&&!o&&!a?t.jsx(k.Item,{icon:cn,onClick:w,children:f.formatMessage({id:"z/PT9T",defaultMessage:"Rename"})},"rename"):null,null,r?t.jsx(k.Item,{icon:ea,onClick:c,children:u?f.formatMessage({id:"owGHqE",defaultMessage:"Close console"}):f.formatMessage({id:"GPb4WX",defaultMessage:"Open console"})},"console"):null,null].filter(Boolean);if(j.length===0)return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"flex h-6 grow items-center overflow-hidden",children:t.jsx(oe.Title,{className:"@[0px]:hidden @[150px]:block",children:b?t.jsx("div",{className:"w-52",children:t.jsx(ts,{lines:1,size:"base",width:100,widthVariance:0})}):T})}),n&&t.jsx(qt,{size:12,className:"text-token-text-tertiary ps-1"})]});const R=e&&t.jsx(k.Portal,{container:A,children:t.jsx(k.Content,{onCloseAutoFocus:te=>te.preventDefault(),children:j})});return t.jsx(t.Fragment,{children:E?t.jsx(eo,{serverThreadId:g,textdocVersion:e,initialTitle:T,isEditingTitle:E,setIsEditingTitle:_}):t.jsxs(t.Fragment,{children:[!1,t.jsxs(k.Root,{open:P,onOpenChange:d,children:[t.jsxs(k.Trigger,{ref:I,className:"hover:bg-token-surface-hover grid grid-cols-[1fr_auto] border-none bg-transparent! pe-2",children:[t.jsx(oe.Title,{className:"max-w-[270px] truncate overflow-hidden",children:b?t.jsx("div",{className:"w-52",children:t.jsx(ts,{lines:1,size:"base",width:100,widthVariance:0})}):T}),t.jsx("div",{className:"flex items-center ps-1",children:n?t.jsx(qt,{size:12,className:"text-token-text-tertiary"}):t.jsx(ln,{className:"icon-sm text-token-text-tertiary"})})]}),R]})]})})};function ao({textdocVersion:e,clientThreadId:n,color:s}){const{handleCopy:a,Icon:i,copyLabel:r}=pa({textdocVersion:e,clientThreadId:n});return t.jsx(Fe,{label:r,children:t.jsx(Te,{icon:i,onClick:a,color:s})})}function oo({textdocVersion:e,disabled:n,clientThreadId:s}){const a=V(),{handleFileDownload:i,handleBlobDownload:r,isLoading:o,downloadCopyLabel:l,isDocument:p}=ha({textdocVersion:e,clientThreadId:s});return p?t.jsxs(k.Sub,{children:[t.jsx(k.SubMenuTrigger,{icon:Kt,label:l,disabled:o||n}),t.jsx(k.Portal,{children:t.jsxs(k.SubContent,{align:"end",children:[t.jsx(k.Item,{onClick:c=>{c.preventDefault(),i("pdf")},children:a.formatMessage({id:"canvas.download-pdf-button.menu",defaultMessage:"PDF Document (.pdf)"})}),t.jsx(k.Item,{onClick:c=>{c.preventDefault(),i("docx")},children:a.formatMessage({id:"canvas.download-docx-button.menu",defaultMessage:"Microsoft Word Document (.docx)"})}),t.jsx(k.Item,{onClick:c=>{c.preventDefault(),i("md")},children:a.formatMessage({id:"canvas.download-md-button.menu",defaultMessage:"Markdown Document (.md)"})})]})})]}):t.jsx(k.Item,{label:l,icon:Kt,disabled:o||n,onClick:r})}function ro(e){for(const n of io){const s=e.match(n);if(s)return s[0]}return null}const io=[/AKIA[0-9A-Z]{16}/,/AIza[0-9A-Za-z_-]{35}/,/^(?:ghp_[A-Za-z0-9]{36}|github_pat_[A-Za-z0-9]{22}_[A-Za-z0-9]{59}|gho_[A-Za-z0-9]{36}|ghu_[A-Za-z0-9]{36}|ghs_[A-Za-z0-9]{36}|ghr_[A-Za-z0-9]{36})$/,/xox[baprs]-[0-9A-Za-z-]+/,/sk-[A-Za-z0-9]{48}/,/SK[0-9a-fA-F]{32}/,/(sk_live_[0-9a-zA-Z]{24})|(sk_test_[0-9a-zA-Z]{24})/,/-----BEGIN PRIVATE KEY-----/],co="".concat(Ha,"...");function ue(e){return["canvas","textdoc","share",e]}function lo({isLoading:e,isPublishedVersionLatest:n,sharedTextdoc:s,textdocVersion:a,title:i}){const{textdocId:r}=a,[o,l]=m.useState(!1),p=ro(a.content),c=(d,A)=>{d&&gn(d,void 0,A).then(()=>{l(!0),setTimeout(()=>{l(!1)},1500)}).catch(()=>{})},u=qe(),{mutate:y,isPending:S}=de({scope:{id:r},mutationFn:d=>$.safePost("/textdoc/{textdoc_id}/share",{parameters:{path:{textdoc_id:d}}}).then(A=>Be(A.shared_textdoc)),onSuccess:d=>{u.setQueryData(ue(r),d),c(rt(d.sharedTextdocId))}}),{mutate:f,isSuccess:E}=de({scope:{id:r},mutationFn:d=>$.safePost("/textdoc/shared/{shared_textdoc_id}/update_to_latest",{parameters:{path:{shared_textdoc_id:d}}}).then(A=>Be(A.shared_textdoc)),onSuccess:d=>{u.setQueryData(ue(r),d)}}),{mutate:_}=de({scope:{id:r},mutationFn:({sharedTextdocId:d,access:A})=>$.safePost("/textdoc/shared/{shared_textdoc_id}/update_access",{parameters:{path:{shared_textdoc_id:d}},requestBody:{shared_textdoc_access:A}}).then(I=>Be(I.shared_textdoc)),onMutate:({access:d})=>{const A=ue(r),I=u.getQueryData(A);return u.setQueryData(A,I&&J(X({},I),{access:d})),{previousAccess:I==null?void 0:I.access}},onSuccess:d=>{u.setQueryData(ue(r),d)},onError:(d,A,I)=>{const j=ue(r),R=u.getQueryData(j);u.setQueryData(j,R&&J(X({},R),{access:I==null?void 0:I.previousAccess}))}}),T=m.useRef(null),g=d=>{var A;(A=T.current)==null||A.focus(),s?(D.logButtonClick(U.COPY_SHARE_LINK,be(a)),c(rt(s.sharedTextdocId),d)):(D.logButtonClick(U.CREATE_SHARE_LINK,be(a)),y(r))},x=d=>{s&&(D.logButtonClick(d===pn.PUBLIC?U.UPDATE_SHARE_LINK_PUBLIC:U.UPDATE_SHARE_LINK_PRIVATE,be(a)),_({sharedTextdocId:s.sharedTextdocId,access:d}))},b=s?rt(s.sharedTextdocId):void 0,w=()=>{s&&(D.logButtonClick(U.UPDATE_SHARE_LINK_TO_LATEST,be(a)),f(s.sharedTextdocId))},P=p||(s==null?void 0:s.isAnonifyApiKeyDetected);return t.jsx(Fa,{inputRef:T,isLoading:e,isPublishedVersionLatest:n,sharedObject:s&&{id:s.sharedTextdocId,title:i,access:s.access,versionInt:s.versionInt,isModerationBlocked:s.isModerationBlocked,isAnonifyApiKeyDetected:s.isAnonifyApiKeyDetected},title:i,shareTextPlaceholder:co,shareUrl:b,isCopySuccessful:o,didPublishUpdates:E,isCreateLinkRequestInProgress:S,handleUpdateLatestSharedVersion:w,handlePrivacyChange:x,handlePrimaryButtonClick:g,maybeRenderWarndingContent:()=>t.jsx(t.Fragment,{children:P&&t.jsx(mo,{})})})}function be(e){return{textdocType:e.type,textdocId:e.textdocId}}function uo({textdocVersion:e,isDisabled:n,title:s}){const a=ta(),i=V(),r=e==null?void 0:e.textdocId,{data:o,isLoading:l}=ls({enabled:!!r&&!n,queryKey:ue(r),queryFn:()=>!r||r.startsWith(Cn)?Promise.resolve(null):$.safeGet("/textdoc/{textdoc_id}/share",{parameters:{path:{textdoc_id:r}}}).then(T=>T.shared_textdoc&&Be(T.shared_textdoc))}),[p,c]=m.useState(!1),{triggerRef:u,container:y}=hs({isOpen:p,onClose:()=>c(!1)}),S=(a==null?void 0:a.isWorkspaceAccount())&&!(a!=null&&a.features.includes(sa.WorkspaceShareLinks));if(n||S||!e)return t.jsx(Fe,{label:S?i.formatMessage(it.workspaceSharingDisabled):i.formatMessage(it.share),children:t.jsx(Te,{disabled:!0,icon:zt})});const f=()=>{D.logButtonClick(U.OPEN_SHARE_MENU,be(e))},E=(o==null?void 0:o.versionInt)===e.versionInt&&(o==null?void 0:o.title)===e.title,_=({className:T})=>t.jsxs("div",{className:"relative h-fit w-fit",children:[t.jsx(zt,{className:T}),!E&&o&&t.jsx("div",{className:"absolute end-0 top-[1px] flex items-center gap-1.5",children:t.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-blue-400"})})]});return t.jsxs(un,{open:p,onOpenChange:c,children:[t.jsx(Fe,{label:i.formatMessage(it.share),children:t.jsx(dn,{ref:u,asChild:!0,children:t.jsx(Te,{icon:_,onClick:f})})}),t.jsx(ze,{children:p&&t.jsx(mn,{forceMount:!0,container:y,children:t.jsx(fn,{align:"end",className:"z-50",sideOffset:8,collisionPadding:8,children:t.jsx(lo,{title:s,sharedTextdoc:o,isLoading:l,isPublishedVersionLatest:E,textdocVersion:e})})})})]})}function mo(){return t.jsx(hn,{type:"danger",className:"w-auto md:p-3",children:t.jsx(ct,{id:"8NG6sN",defaultMessage:"There may be an API key in your canvas. If you share the canvas, anyone with the link can see its contents."})})}function fo({disabled:e=!1,isShowingChanges:n,onMouseEnter:s,onClick:a,onEsc:i}){const r=V(),o=m.useRef(null);return m.useEffect(()=>{if(n){const l=p=>{p.key==="Escape"&&(i==null||i(),o.current&&o.current===document.activeElement&&o.current.blur())};return window.document.addEventListener("keydown",l),()=>{window.document.removeEventListener("keydown",l)}}},[n,i]),t.jsx(Fe,{label:!e&&r.formatMessage(n?is.hideChanges:is.showChanges),children:t.jsx(Te,{icon:xn,ref:o,disabled:e,onClick:a,onMouseEnter:s,className:Se("transition-colors enabled:hover:bg-black/5 dark:enabled:hover:bg-white/10",n&&Ua)})})}const is=Zs({showChanges:{id:"3jMGNS",defaultMessage:"Show changes"},hideChanges:{id:"HWiQSk",defaultMessage:"Hide changes"}}),go=({clientThreadId:e,isHistoricalVersion:n,textdocVersion:s,readonlyReason:a,hasDebug:i,isEmbedded:r,isPersisting:o,isShowingChanges:l,hideRunCode:p=!1,hideHistoryActions:c=!1,hideRenameButton:u=!1,onHoverPrevious:y,onHoverShowChanges:S,onToggleShowChanges:f,onClickPrevious:E,onClickNext:_,onClickCodePreview:T,onClose:g,toggleDebugView:x,toggleConsoleVisibility:b,isCodeRunning:w,isTextdocAttachedPending:P,isTextdocStreaming:d,isConsoleOpen:A,isDebugVisible:I})=>{var he,Q;const j=V(),R=na(),B=Ke(s==null?void 0:s.textdocId),G=(he=s==null?void 0:s.title)!=null?he:"",{isCodePreviewable:te,isCodeExecutable:H,hasCanvasCodeExecution:O}=ys(s),se=(Q=s==null?void 0:s.metadata)==null?void 0:Q.hive_id,q=Ge(),me=se!=null&&Cs(q,"292227286"),{mutate:Ee,isPending:Qe}=de({scope:{id:se!=null?se:""},mutationFn:_e=>$.safePost("/hive/{hive_id}/send_summary_to_slack",{parameters:{path:{hive_id:_e}}})}),We=()=>{se&&Ee(se)},fe=!p&&(te||H),F=s==null?void 0:s.versionInt,ee=F!=null&&F>1,re=n,ge=!c,pe=te&&w,we=s==null||B!=null||n||a.isStreaming,Ae=s==null||a.isStreaming;return t.jsxs(oe.Header,{className:Se("@container",te&&w&&"bg-transparent!"),children:[t.jsx(oe.CloseButton,{onClick:g}),t.jsx("div",{className:"@container flex flex-1 basis-0 items-center truncate leading-[0]",children:t.jsx(no,{hasDebug:i,isConsoleOpen:A,isDebugVisible:I,toggleConsoleVisibility:b,toggleDebugView:x,isPersisting:o,textdocVersion:s,isTextdocAttachedPending:P,isTextdocStreaming:d,shouldShowPlayButton:fe,hideRenameButton:u,clientThreadId:e})}),t.jsxs("div",{className:"flex min-w-0 basis-auto items-center leading-[0] select-none",children:[t.jsx(ao,{clientThreadId:e,textdocVersion:s}),t.jsx(uo,{isDisabled:we,textdocVersion:s,title:G}),ge&&t.jsx(ze,{children:t.jsx(ae.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,width:0},transition:{type:"spring",bounce:.24,duration:.4},children:t.jsx(fo,{disabled:pe||a.isStreaming||!ee,isShowingChanges:l,onMouseEnter:S,onClick:f,onEsc:f})})}),t.jsxs(k.Root,{children:[t.jsx(k.BasicTrigger,{children:t.jsx(Te,{icon:aa})}),t.jsx(k.Portal,{children:t.jsxs(k.Content,{align:"end",children:[t.jsx(k.Item,{icon:yn,disabled:!ee,onClick:E,onMouseOver:y,label:j.formatMessage({id:"PoD5+8",defaultMessage:"Previous version"})}),t.jsx(k.Item,{icon:vn,disabled:!re,onClick:_,label:j.formatMessage({id:"PJ8YVJ",defaultMessage:"Next version"})}),t.jsxs(k.Group,{children:[s&&s.type!==ye.LOADING&&B==null&&t.jsx(oo,{disabled:Ae,textdocVersion:s,clientThreadId:e}),me&&t.jsx(k.Item,{icon:oa,disabled:Qe,onClick:We,label:j.formatMessage({id:"CRHbjv",defaultMessage:"Send to Slack"})})]})]})})]}),fe&&t.jsx(Aa,{clientThreadId:e,isCodePreviewable:te,isDisabled:!O||a.isTextdocStreaming&&!w,disabledTooltip:O?void 0:j.formatMessage({id:"NTZRWe",defaultMessage:"Code execution for canvas is disabled for your workspace. Contact your admin to enable."}),onClick:T,isCodeRunning:w}),!r&&!R&&t.jsx(qa,{clientThreadId:e})]})]})};function po(e){const n=/\[([^\]]+)\]\((https?:\/\/[^\s)]+|www\.[^\s)]+)\)/gi,s=new Set,a=e.matchAll(n);for(const i of a){const r=i[2];try{let o=r;o.startsWith("www.")&&(o="http://"+r),new URL(o),s.add(r)}catch(o){}}return s}const ho=async({lastVersion:e,textdocId:n,content:s,comments:a})=>{const i=bn(a,s);return(await $.safePost("/textdoc/{textdoc_id}",{parameters:{path:{textdoc_id:n}},requestBody:{version:e,content:s,comments:i}})).version},Co=()=>{const e=m.useRef([]),n=m.useRef(null),{mutateAsync:s,isPending:a}=de({mutationKey:["canvas","textdoc","persist"],mutationFn:ho});return[m.useCallback(async(r,o,l)=>{const p=new AbortController,u=(async()=>{var _,T;const[E]=e.current;try{await(E==null?void 0:E.promise)}catch(g){D.logError("Saving document",g)}if(!p.signal.aborted)try{const g=Math.max((_=n.current)!=null?_:0,(T=r.versionInt)!=null?T:ds);let x="";try{rs(o)?x=o():x=o}catch(d){D.logError("Serializing document",d)}let b=[];try{rs(l)?b=l():b=l}catch(d){D.logError("Adjusting comments",d)}const{textdocId:w}=r;Sn({textdocId:w,basedOnVersionInt:g,content:x,comments:b});const P=await s({textdocId:w,lastVersion:g,content:x,comments:b});Tn({textdocId:w,basedOnVersionInt:g,newVersion:P}),n.current=P}catch(g){D.logError("Error saving document",g)}finally{e.current.shift()}})(),y={abort:()=>p.abort(),promise:u},[S,f]=e.current;return f&&(f.abort(),e.current=S?[S]:[]),e.current=S?[S,y]:[y],u},[s]),e,a]},xo=3e3,yo=e=>{const[n,s,a]=Co(),i=V(),r=m.useRef(null),o=m.useCallback(ra(async(c,u,y)=>{if(!lt(c))return n(c,u,y);He.replaceTempTextdocContent(c.textdocId,typeof u=="string"?u:u())},xo,{leading:!1}),[n]),l=En(e);return m.useEffect(()=>{if(!l)return;const c=ss(window,{pagehide:()=>o.flush(),beforeunload:y=>{o.flush(),y.returnValue=i.formatMessage({id:"QZrKwi",defaultMessage:"You have a canvas save in progress."})}}),u=ss(document,{visibilitychange:()=>o.flush(),keydown:()=>{r.current="keyboard"},mousemove:()=>{r.current!=="mouse"&&o.flush(),r.current="mouse"}});return()=>{r.current=null,u(),c()}},[i,l,o]),m.useEffect(()=>()=>{o.flush()},[e,o]),wn(async()=>{var c,u;await o.flush(),await Promise.allSettled((u=(c=s.current)==null?void 0:c.map(({promise:y})=>y))!=null?u:[])}),[m.useCallback((c,u,y)=>{const{textdocId:S}=c;return lt(c)||An(S),o(c,u,y)},[o]),o.flush,a||l]};function vo(e,n,s){const a=qe(),i=s!=null&&n!=null,{data:r,error:o,fetchNextPage:l,hasNextPage:p,isFetching:c}=Ys(cs(e,n,i)),u=m.useCallback(async()=>{const _=n!=null;await a.prefetchInfiniteQuery(cs(e,n,_))},[a,e,n]);m.useEffect(()=>{const _=n;return()=>{a.removeQueries({queryKey:vs(e,_),exact:!0})}},[a,e,n]);const[y,S,f,E]=m.useMemo(()=>{var T;if(r&&s){const g=r.pages.flatMap(b=>b),x=g.findIndex(b=>{var w;return"beforeVersion"in s?((w=b.versionInt)!=null?w:ds)<s.beforeVersion:b.versionInt===s.version});if(x!==-1)return[x===g.length-1,g[x],x>0?g[x-1]:null,x<g.length-1?g[x+1]:null]}const _=(T=r==null?void 0:r.pages.flatMap(g=>g))!=null?T:[];return[!0,null,null,_.length===0?null:_[0]]},[r,s]);return m.useEffect(()=>{!c&&i&&p&&y&&l()},[c,i,p,y,l]),m.useEffect(()=>{!S&&o&&ve(e)},[S,o,e]),{historicalTextdocVersion:S,nextHistoricalTextdocVersion:f,prefetchHistoricalTextdocVersion:u,previousHistoricalTextdocVersion:E}}function vs(e,n=null){return["textdocHistory",e,n]}function cs(e,n,s=!0){return{queryKey:vs(e,n),queryFn:({pageParam:a})=>bo(e,a),initialPageParam:n!=null?n:void 0,getNextPageParam:a=>{var r;const i=(r=ia(a))==null?void 0:r.versionInt;if(i&&i>1)return i},enabled:s,staleTime:1/0,retry:2}}async function bo(e,n){return n===void 0||n<=1?[]:(await $.safeGet("/textdoc/{textdoc_id}/history",{parameters:{path:{textdoc_id:e},query:{before_version:n}}})).previous_doc_states.map(({id:a,version:i,textdoc_type:r,title:o,content:l,updated_at:p,comments:c,metadata:u})=>({textdocId:a,versionInt:i,messageId:null,title:o,type:In(r),content:l,status:us.COMPLETE,createdAt:ca(p),comments:_n(c,l),metadata:{content_references:u==null?void 0:u.content_references,hive_id:u==null?void 0:u.hive_id}}))}const zo=({isFullScreen:e=!1,isEmbedded:n=!1,hideHeader:s=!1,hideRunCode:a=!1,isReadonlyFromQueryParam:i=!1,hideRenameButton:r=!1,clientThreadId:o,focusedTextdoc:l,onClose:p,isAnimating:c=!1,width:u,hideBottomComposer:y=!1})=>{"use no forget";var Nt,Ot,Lt,Bt;const S=Ge(),{textdocId:f,history:E,showChangesAtVersion:_=null,shouldRunCodeOnOpen:T=!1}=$a(l),g=V(),[x,b,w]=yo(f),{targetedContent:P}=kn(),d=jn(S),[A,I]=m.useState(!1),[j,R]=m.useState(!1),B=Pn(f),G=Rn(),te=ut(o,fs.getRequestId),H=la(te),{data:O,isLoading:se}=ls(ot(f,_)),[q,me]=m.useState(!1),[Ee,Qe]=m.useState(null),We=Mn(o),fe=m.useRef(null),F=(Nt=B==null?void 0:B.versions)!=null?Nt:[],ee=(Ot=F[0])==null?void 0:Ot.versionInt,{historicalTextdocVersion:re,nextHistoricalTextdocVersion:ge,previousHistoricalTextdocVersion:pe,prefetchHistoricalTextdocVersion:we}=vo(f,ee,E),Ae=qe();m.useEffect(()=>{Ue.reset()},[f]);const he=F.length>0?F[F.length-1]:null,Q=F.length>1?F[F.length-2]:null,_e=ps(o),{restoreHistoricalTextdocVersion:bs,optimisticRestoredTextdocVersion:Ss}=Dn(_e,he,re),ie=E!=null,h=ie?re:he,W=_!=null,Ce=ja(o,h),Ie=c?null:O,ke=(()=>{if(c||h==null)return[];const C=ns(h.comments);return!W&&re!=null?re.comments:!W||O==null?C:O.contentBefore!==O.contentAfter?[]:Ja(O.commentsBefore,O.commentsAfter)})(),N=(Lt=h==null?void 0:h.type)!=null?Lt:ye.LOADING,dt=Ca({textdocVersion:h,clientThreadId:o}),Ts=m.useCallback(()=>{var v,M;const C=(M=(v=window.getSelection())==null?void 0:v.toString())!=null?M:"";dt({source:"keyboard",selectedText:C,productLogOnly:!0})},[dt]),Ze=Nn(),mt=lt(h),ne=On(h),Ye=Ln(h),ft=Bn(h),Es=ft&&!n,ws=Gt(G),As=Gt(H);m.useEffect(()=>{!mt&&F.length===0&&Ze!==Qt.NATIVE&&(!G&&ws.current||!H&&As.current||!G&&!H)&&(p==null||p())},[F.length,G,H]);const{content:L,currentlyStreamingLineIndex:je}=(O==null?void 0:O.contentBefore)!=null&&!Wt(N)?{content:O.contentBefore,currentlyStreamingLineIndex:null}:xa(h,Q),_s=Hn(_e,Array.from(po(L))),[Pe,Xe]=Ga({value:L,isRequestActive:H,isTextdocStreaming:ne,comments:ke}),gt=Fn(h),pt=Ze===Qt.LAST_TURN||Pe||w;m.useEffect(()=>{Un().sendMessage({type:xs.Streaming,streaming:pt})},[pt]);const Is=({getSerializedDocument:C,getAdjustedComments:v})=>{h&&x(h,C,v)},ks=C=>{var M;if(!h)return;const v=C.doc.toString();x(h,v,(M=C.field(Sa,!1))!=null?M:[])},ht=(C,v,M,Y,ce)=>{Xe(!0),Ce({sourceEvent:C,action:M,content:v,userMessageType:Oe.ASK_CHATGPT,sourceRange:Y,selectionMetadata:{selection_type:ce,selection_position_range:Y}})},Ct=({id:C})=>{gt(C,Xt.DISMISS),Ue.reset()},xt=async(C,v)=>{Xe(!0);const{id:M,at:Y,content:ce}=v;if(await gt(M,Xt.ACCEPT)===!1)return Xe(!1);Ce({sourceEvent:C,content:ce,userMessageType:Oe.ACCEPT_COMMENT,sourceRange:Y,action:os.EDIT,selectionMetadata:{selection_type:as.SELECTION,selection_position_range:Y}})},Je=(C,v,M,Y)=>{const{action:ce}=Y;Ce({sourceEvent:C,action:ce,content:M,sourceRange:v,userMessageType:Oe.ACCELERATOR,acceleratorMetadata:{action:ce,id:Y.id,prompt:M},selectionMetadata:v!=null?{selection_type:as.SELECTION,selection_position_range:v}:void 0})},js=(C,v)=>{Ce({sourceEvent:C,action:os.EDIT,content:v,userMessageType:Oe.FULL_SCREEN_SUBMIT})},$e=qn(),yt=C=>{var v;return(v=$e==null?void 0:$e[C])!=null?v:C},Ve=()=>Kn(o,void 0,{clientInitiated:!0,reason:"textdoc_canvas_cancel"}),Ps=()=>{E?Le(f,E):ve(f)},K=_a({streamingSource:Ze,isRestoring:Ss!=null,isRequestActive:H,isTextdocStreaming:ne,isReadonlyFromQueryParam:i,isHistoricalVersion:ie,isShowingChanges:W});let Re=null;const vt=c||K.isReadonly||Pe,Me=ms()||We||i||mt,bt=()=>c&&ke.length>0?le.ALL_HIDDEN:Me?le.COMMENTS_READONLY:K.isReadonly?K.isStreaming?le.ENABLED:K.isReadonlyFromQueryParam||K.isShowingChanges||K.isHistoricalVersion?le.COMMENTS_READONLY:le.ALL_HIDDEN:le.ENABLED,Rs=m.useCallback(async C=>{const{suggestion:v}=await $.safePost("/textdoc/{textdoc_id}/autocomplete",{parameters:{path:{textdoc_id:f}},requestBody:{content:C}});return v},[f]),St=e||c||i;let et=[];switch(N){case ye.LOADING:Re=t.jsx(ba,{});break;case ye.DOCUMENT:Re=t.jsx(va,{value:L,comments:ke,previousValue:Q==null?void 0:Q.content,getAutocompleteSuggestion:Rs,previousComments:ns(Q==null?void 0:Q.comments),isRewriting:Ye,isAnimatingFromPreview:c,isSendDisabled:Me,getStableCommentId:yt,diff:Ie,isRequestActive:H,isDisabled:K.isReadonly||G,isWaitingForCommentResponse:Pe,hideAccelerators:St,hideToolbar:vt,hideEditOverlay:c,commentsMode:bt(),readonlyReason:K,onBlur:b,onSave:b,onChange:Is,onCancelRequest:Ve,targetedContent:P,onAddComment:ht,onAcceptComment:xt,onDismissComment:Ct,onSubmitAccelerator:Je,onExitShowChanges:Ps,safeUrls:_s,width:u,modelCursor:ft||ne&&!Ye?h==null?void 0:h.modelCursor:void 0,shouldResetSelection:(h==null?void 0:h.versionInt)===1,metadata:B==null?void 0:B.metadata}),et=Na;break;default:Wt(N)&&(Re=t.jsx(ya,{id:"codemirror",getStableCommentId:yt,language:Ia(N),value:L,comments:ke,hideAccelerators:St,commentsMode:bt(),hideToolbar:vt,onSubmitAccelerator:Je,currentlyStreamingLineIndex:je!=null?je:null,readonlyReason:K,isRequestActive:H,isSendDisabled:Me,isWaitingForCommentResponse:Pe,onChange:ks,onCancelRequest:Ve,onAddComment:ht,onBlur:b,onSave:b,codemirrorRef:fe,onDismissComment:Ct,onAcceptComment:xt,textdocDiff:Ie!=null?Ie:void 0,modelCursor:ne&&je==null?h==null?void 0:h.modelCursor:void 0}),et=Ta)}const xe=m.useRef(null),tt=m.useRef(null),{hasCanvasCodeExecution:st,isCodeExecutable:Tt,isCodePreviewable:Z}=ys(h),Et=st&&Z,wt=st&&Tt,Ms=zn(),At=m.useCallback(()=>{var C,v;!q&&(Et||wt)?(me(!0),(C=xe.current)==null||C.runCode(N,L)):((v=xe.current)==null||v.stopCode(),me(!1))},[Et,wt,q,L,N]),_t=Gn(()=>{At()});m.useEffect(()=>{T&&_t()},[T,_t]);const z=h==null?void 0:h.versionInt,Ds=z!=null&&z>1,Ns=ie,De=pe==null?void 0:pe.versionInt,nt=ge==null?void 0:ge.versionInt,Os=()=>{W?E?Le(f,E):ve(f):(D.logButtonClick(U.SHOW_CHANGES,{textdocType:N,textdocId:f,versionInt:z,latestVersionInt:ee}),z&&Jt(f,z,E))},Ls=()=>{D.logButtonClick(U.HISTORY_PREVIOUS,{textdocType:N,textdocId:f,versionInt:z,latestVersionInt:ee,isShowingChanges:W}),f&&z&&Ds&&Le(f,{beforeVersion:z},W&&De!=null?De:void 0)},Bs=()=>{D.logButtonClick(U.HISTORY_NEXT,{textdocType:N,textdocId:f,versionInt:z,latestVersionInt:ee,isShowingChanges:W}),Ns&&(nt?Le(f,{version:nt},W?nt:void 0):W&&ee?Jt(f,ee,null):ve(f))},Hs=Cs(S,"1804926979"),It=ut(o,Ka(f)),Fs=ua(),kt=Ke(h==null?void 0:h.textdocId),Us=!s&&t.jsx(go,{hideRunCode:a,clientThreadId:o,isHistoricalVersion:ie,textdocVersion:h,readonlyReason:K,hasDebug:d,isEmbedded:n,isPersisting:w,isShowingChanges:W,isConsoleOpen:j,isDebugVisible:A,hideHistoryActions:i,hideRenameButton:r,onHoverPrevious:()=>{we(),De&&Ae.prefetchQuery(ot(f,De))},onHoverShowChanges:()=>{we(),z&&Ae.prefetchQuery(ot(f,z))},onToggleShowChanges:Os,onClickPrevious:Ls,onClickNext:Bs,toggleDebugView:()=>I(C=>!C),toggleConsoleVisibility:()=>{j||fa.logEvent("Canvas Open Console Clicked"),R(C=>!C)},onClose:()=>{if(D.logButtonClick(U.CLOSE_TEXTDOC,{textdocType:h==null?void 0:h.type}),kt&&!e){const{create_source:C,hasUserEdits:v,tempTextdocId:M}=kt;if(v&&C!==Yt.USER_CREATED_COMPOSER){Rt(!0);return}if(He.removeTempTextdoc(M),C===Yt.USER_CREATED_COMPOSER){const Y=da(Fs);ma(Y,L)}}p==null||p()},onClickCodePreview:At,isCodeRunning:q,isTextdocStreaming:ne,isTextdocAttachedPending:Zt(h)});let jt=null;const Ne=!a&&st&&(Tt||Z),at=ka(N,L);m.useEffect(()=>{var C;Ne&&at&&((C=tt.current)==null||C.prepareEnvironment(L,at))},[Ne,at]),m.useEffect(()=>{var C;Z&&q&&!ne&&((C=xe.current)==null||C.runCode(N,L))},[Z,ne,L,N]);const Pt=(Bt=h==null?void 0:h.title)!=null?Bt:"";Ne&&(jt=t.jsx(Pa,{id:f,title:Pt,onChangeBackgroundColor:Qe,onCodeRunComplete:()=>me(!1),visuallyHidden:!Z||!q,disableNetworkRequests:!Ms,networkAccessDeniedMessage:g.formatMessage({id:"GE4AJf",defaultMessage:"Network requests in canvas are disabled for your workspace. Contact your admin to enable this feature."}),enableTransition:Z&&N!==ye.CODE_HTML,isCodeUpdating:ne,ref:tt,onRetryCodeRun:()=>{var C;return(C=xe.current)==null?void 0:C.runCode(N,L)}}));const[qs,Rt]=m.useState(!1),Mt=t.jsx(za,{isOpen:qs,dismissModal:()=>Rt(!1),closeTextdocEditor:()=>{p==null||p()},textdocVersion:h,clientThreadId:o}),Dt=t.jsxs(t.Fragment,{children:[Us,t.jsx(oe.Content,{scrollToBottomMode:Es?"bottom":"top",shouldScrollToTop:Ye,isLoading:se,hideChildren:Z&&q,overlay:jt,onCopy:Ts,children:Re}),Ne&&t.jsx(Ra,{ref:xe,sandboxRef:tt,textdocId:f,textdocTitle:Pt,textdocContent:L,isTextdocAttachedPending:Zt(h),highlightLine:C=>{var v;return(v=fe.current)==null?void 0:v.highlightLine(C)},isRequestActive:H,createTextdocTurn:Ce,isOpen:j,onOpenChange:R}),t.jsx(ze,{children:ie&&!i&&t.jsx(Qa,{onClickRestore:bs,onClickResetLatest:()=>ve(f)})}),e&&!ie&&!y&&!(q&&Z)&&!Me&&t.jsx(Xa,{isRequestActive:H,clientThreadId:o,onSubmitAccelerator:Je,onSubmit:js,onCancel:Ve,readonlyReason:K,acceleratorActions:et})]});if(Hs&&It&&h){const v=new URLSearchParams(window.location.search).get(Ma),M=v==null?void 0:parseInt(v);return t.jsxs(t.Fragment,{children:[Mt,t.jsx(oe,{previewBackgroundColor:Ee,isPreviewingCode:Z&&q,children:t.jsxs("div",{className:"flex h-full",children:[t.jsx("div",{className:"relative flex h-full min-h-0 flex-auto grow flex-col",children:Dt}),t.jsx(Da,{hiveId:It,clientThreadId:o,textdocVersion:h,ts:M})]})})]})}return t.jsxs(t.Fragment,{children:[Mt,t.jsx(oe,{previewBackgroundColor:Ee,isPreviewingCode:Z&&q,children:Dt})]})};export{xs as C,zo as T};
//# sourceMappingURL=o2byzwyeejp0u9wz.js.map
