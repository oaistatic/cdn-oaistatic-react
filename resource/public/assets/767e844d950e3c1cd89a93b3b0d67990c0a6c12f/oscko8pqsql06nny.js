var Ge=Object.defineProperty,Fe=Object.defineProperties;var Pe=Object.getOwnPropertyDescriptors;var we=Object.getOwnPropertySymbols;var $e=Object.prototype.hasOwnProperty,He=Object.prototype.propertyIsEnumerable;var Ee=(m,e,a)=>e in m?Ge(m,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):m[e]=a,te=(m,e)=>{for(var a in e||(e={}))$e.call(e,a)&&Ee(m,a,e[a]);if(we)for(var a of we(e))He.call(e,a)&&Ee(m,a,e[a]);return m},pe=(m,e)=>Fe(m,Pe(e));import{c as Z,h as ne,j as s,M as L,r as w,i as Ue,d as Ve}from"./mw35uwhq4g8r9eam.js";import{b as Ke}from"./kcex4rnzaebpwef1.js";import{eA as We,cF as z,_ as se,hC as ae,$ as _e,a0 as be,ev as ze,f7 as Q,fK as qe,cw as oe,R as Re,A as Je,k as Ye,ab as Qe,cC as Xe,d as Se,M as Ze,cD as et,V as tt,h5 as Be,dJ as st,u as Ae,p as De,Q as nt,og as at,D as Oe,cu as ot,j5 as lt,dK as it,ox as rt,B as ct,aA as dt,J as Me,y as ut}from"./d0xa318sl7ywi0za.js";import{S as xe}from"./bzxitjpdx1z6hpbp.js";import{S as ft}from"./t4u99i3y1xwqt0zb.js";import{vG as mt,f7 as gt,aZ as pt,bu as xt,vH as ht,aG as _t,aF as bt,fs as Ie,vI as St,vJ as kt,vK as yt,ax as jt,pw as Ct,px as vt,py as wt,g8 as Et,f6 as Bt}from"./g2euln7v5pbm31qa.js";import{c as Le}from"./e1t6unu3olubcgkg.js";import{b as Mt,W as It}from"./g09bc254e08nnz5p.js";import{s as Nt}from"./d4h15g77ywnnjdmi.js";import{markdownToClipboardContent as Tt}from"./h7tudz5piofu9rem.js";import{C as Ne}from"./ddina39kz3r81pp7.js";import{d as Wt}from"./kl7c6054usfnqmd4.js";import{g as Rt}from"./k97n0y6ba9c9h39c.js";import{S as At}from"./bhvk929w0gb4odci.js";import{gdocRegex as Dt}from"./bhdyjo7ybkqcriof.js";const xs=["group my-4 w-full overflow-visible rounded-2xl relative z-0","bg-token-bg-primary","dark:bg-[#2a2a2a]","shadow-[0px_0px_0px_1px_rgba(0,0,0,0.08),0px_2px_2px_rgba(0,0,0,0.08),0px_4px_80px_rgba(0,0,0,0.03)]","dark:shadow-[0px_0px_0px_1px_rgba(255,255,255,0.12),0px_2px_2px_rgba(0,0,0,0.2)]"].join(" "),Ot="bg-token-bg-primary/98 dark:bg-[#2a2a2a]/98",Te="placeholder:text-token-text-tertiary min-w-0 flex-1 shrink-0 truncate border-none bg-transparent focus:border-transparent focus:ring-0 focus:outline-hidden",ke="text-sm font-medium",le=0,hs="bg-token-bg-primary fixed inset-0 z-30 cursor-zoom-out",_s="bg-token-bg-primary dark:bg-[#2a2a2a] fixed inset-y-0 start-1/2 z-30 flex w-full w-[100%] lg:max-w-[50rem] -translate-x-1/2 cursor-auto flex-col outline-none dark:shadow-[0px_0px_0.5px_rgba(255,255,255,1)] shadow-[0px_0px_0px_1px_rgba(0,0,0,0.1),0px_8px_480px_rgba(0,0,0,0.04)]";function Lt(m){"use forget";const e=Z.c(59),{onClick:a,clientThreadId:o,messageId:l}=m,n=ne();let t;e[0]!==n?(t=n.formatMessage({id:"EmailSendButton.tooltip",defaultMessage:"Open in email"}),e[0]=n,e[1]=t):t=e[1];const r=t;let d;e[2]!==o||e[3]!==l||e[4]!==a?(d=O=>{se.logEventWithStatsig("ChatGPT Writing Block Email Send Button Clicked","chatgpt_writing_block_email_send_button_clicked",pe(te({},ae({clientThreadId:o,messageId:l})),{provider:O})),_e.count(be.WRITING_BLOCKS,"chatgpt_writing_block_email_send_button_clicked"),a(O)},e[2]=o,e[3]=l,e[4]=a,e[5]=d):d=e[5];const g=d,i=!We();let k;e[6]!==n?(k=n.formatMessage({id:"BnHAsh",defaultMessage:"Open email in app"}),e[6]=n,e[7]=k):k=e[7];let b;e[8]===Symbol.for("react.memo_cache_sentinel")?(b=s.jsx(xe,{}),e[8]=b):b=e[8];let x;e[9]!==k?(x=s.jsx("button",{className:"flex items-center gap-1 px-2 py-2 text-sm select-none","aria-label":k,children:b}),e[9]=k,e[10]=x):x=e[10];let f;e[11]!==g?(f=()=>g("gmail"),e[11]=g,e[12]=f):f=e[12];let u;e[13]===Symbol.for("react.memo_cache_sentinel")?(u=s.jsx(ze,{}),e[13]=u):u=e[13];let N;e[14]!==n?(N=n.formatMessage({id:"2cYA6Z",defaultMessage:"Open email using Gmail"}),e[14]=n,e[15]=N):N=e[15];let p;e[16]===Symbol.for("react.memo_cache_sentinel")?(p=s.jsx(L,{id:"N+/ksm",defaultMessage:"Gmail"}),e[16]=p):p=e[16];let v;e[17]!==f||e[18]!==N?(v=s.jsx(Q.Item,{onSelect:f,icon:u,"aria-label":N,label:p}),e[17]=f,e[18]=N,e[19]=v):v=e[19];let E;e[20]!==g?(E=()=>g("outlook"),e[20]=g,e[21]=E):E=e[21];let B;e[22]===Symbol.for("react.memo_cache_sentinel")?(B=s.jsx(mt,{}),e[22]=B):B=e[22];let _;e[23]!==n?(_=n.formatMessage({id:"puDMOA",defaultMessage:"Open email using Outlook"}),e[23]=n,e[24]=_):_=e[24];let j;e[25]===Symbol.for("react.memo_cache_sentinel")?(j=s.jsx(L,{id:"0Laq6P",defaultMessage:"Outlook"}),e[25]=j):j=e[25];let y;e[26]!==E||e[27]!==_?(y=s.jsx(Q.Item,{onSelect:E,icon:B,"aria-label":_,label:j}),e[26]=E,e[27]=_,e[28]=y):y=e[28];let M;e[29]!==g?(M=()=>g("default"),e[29]=g,e[30]=M):M=e[30];let C;e[31]===Symbol.for("react.memo_cache_sentinel")?(C=s.jsx(ft,{}),e[31]=C):C=e[31];let T;e[32]!==n?(T=n.formatMessage({id:"aW6dXc",defaultMessage:"Open email using default email app"}),e[32]=n,e[33]=T):T=e[33];let I;e[34]===Symbol.for("react.memo_cache_sentinel")?(I=s.jsx(L,{id:"DcalRY",defaultMessage:"Default email app"}),e[34]=I):I=e[34];let A;e[35]!==M||e[36]!==T?(A=s.jsx(Q.Item,{onSelect:M,icon:C,"aria-label":T,label:I}),e[35]=M,e[36]=T,e[37]=A):A=e[37];let W;e[38]!==r||e[39]!==v||e[40]!==y||e[41]!==A||e[42]!==x?(W=s.jsx("div",{className:"hidden md:block",children:s.jsxs(qe,{alignOffset:-8,size:"small",tooltip:r,tooltipSideOffset:le,triggerButton:x,children:[v,y,A]})}),e[38]=r,e[39]=v,e[40]=y,e[41]=A,e[42]=x,e[43]=W):W=e[43];let R;e[44]===Symbol.for("react.memo_cache_sentinel")?(R=z("px-2 py-2",ke),e[44]=R):R=e[44];let c;e[45]!==n?(c=n.formatMessage({id:"5fZEc+",defaultMessage:"Open in email"}),e[45]=n,e[46]=c):c=e[46];let S;e[47]!==g?(S=()=>g("default"),e[47]=g,e[48]=S):S=e[48];let h;e[49]!==r||e[50]!==i?(h=i?s.jsx(oe,{label:r,children:s.jsx(xe,{})}):s.jsx("div",{className:"flex items-center gap-1",children:s.jsx(xe,{})}),e[49]=r,e[50]=i,e[51]=h):h=e[51];let D;e[52]!==c||e[53]!==S||e[54]!==h?(D=s.jsx("div",{className:"block md:hidden",children:s.jsx("button",{className:R,"aria-label":c,onClick:S,children:h})}),e[52]=c,e[53]=S,e[54]=h,e[55]=D):D=e[55];let $;return e[56]!==W||e[57]!==D?($=s.jsxs(s.Fragment,{children:[W,D]}),e[56]=W,e[57]=D,e[58]=$):$=e[58],$}const he="my-0! border-0 border-t !border-token-border-light",bs="pt-3 pb-1 ps-5 [--writing-block-editor-left-padding:theme(spacing.5)] pe-2 [--writing-block-editor-right-padding:theme(spacing.2)] md:pe-10 md:[--writing-block-editor-right-padding:theme(spacing.10)]";function Ss(m){"use forget";var ye,je,Ce;const e=Z.c(61),{writingBlock:a,clientThreadId:o,messageId:l,onChange:n,setDirty:t,flushPendingChanges:r,isStreaming:d,streamingTitle:g,streamingRecipient:i,isInlineWritingBlockEditEnabled:k}=m,b=ne(),[x,f]=w.useState((ye=a.title)!=null?ye:""),[u,N]=w.useState(String((Ce=(je=a.metadata)==null?void 0:je.recipient)!=null?Ce:"")),p=Le(n,300);let v;e[0]!==p||e[1]!==t?(v=P=>{t(!0),f(P.target.value),p({title:P.target.value})},e[0]=p,e[1]=t,e[2]=v):v=e[2];const E=v;let B;e[3]!==p||e[4]!==t?(B=P=>{t(!0),N(P.target.value),p({metadata:{recipient:P.target.value}})},e[3]=p,e[4]=t,e[5]=B):B=e[5];const _=B;let j;e[6]!==p||e[7]!==r||e[8]!==t?(j=P=>{t(!0),p({title:P.target.value}),p.flush(),r==null||r()},e[6]=p,e[7]=r,e[8]=t,e[9]=j):j=e[9];const y=j;let M;e[10]!==p||e[11]!==r||e[12]!==t?(M=P=>{t(!0),p({metadata:{recipient:P.target.value}}),p.flush(),r==null||r()},e[10]=p,e[11]=r,e[12]=t,e[13]=M):M=e[13];const C=M;let T;e[14]!==u||e[15]!==x||e[16]!==a.content?(T=P=>{const me=encodeURIComponent(Ke(a.content)),ve=encodeURIComponent(u),ge=encodeURIComponent(x);switch(P){case"gmail":return"https://mail.google.com/mail/u/0/?tf=cm&to=".concat(ve,"&su=").concat(ge,"&body=").concat(me);case"outlook":return"https://outlook.office.com/mail/deeplink/compose?to=".concat(ve,"&subject=").concat(ge,"&body=").concat(me);case"default":return"mailto:".concat(u,"?subject=").concat(ge,"&body=").concat(me)}},e[14]=u,e[15]=x,e[16]=a.content,e[17]=T):T=e[17];const I=T;let A;e[18]===Symbol.for("react.memo_cache_sentinel")?(A=s.jsx(L,{id:"PrFQxx",defaultMessage:"Email"}),e[18]=A):A=e[18];const W=A;let R;e[19]!==I?(R=P=>window.open(I(P),"_blank"),e[19]=I,e[20]=R):R=e[20];let c;e[21]!==o||e[22]!==l||e[23]!==R?(c=s.jsx(Lt,{clientThreadId:o,messageId:l,onClick:R}),e[21]=o,e[22]=l,e[23]=R,e[24]=c):c=e[24];const S=c;let h;e[25]===Symbol.for("react.memo_cache_sentinel")?(h=z("text-s flex w-full min-w-0 items-center px-5 py-1.5 font-sans"),e[25]=h):h=e[25];let D;e[26]===Symbol.for("react.memo_cache_sentinel")?(D=s.jsx("div",{className:"text-sm font-medium",children:s.jsx(L,{id:"NPvnYL",defaultMessage:"To"})}),e[26]=D):D=e[26];const $=d||!k;let O;e[27]===Symbol.for("react.memo_cache_sentinel")?(O=z(Te,"text-sm"),e[27]=O):O=e[27];let G;e[28]!==b?(G=b.formatMessage({id:"12HHUV",defaultMessage:"name@email.com"}),e[28]=b,e[29]=G):G=e[29];const q=d?i!=null?i:"":u;let H;e[30]!==C||e[31]!==_||e[32]!==$||e[33]!==G||e[34]!==q?(H=s.jsxs("div",{className:h,children:[D,s.jsx("input",{disabled:$,className:O,maxLength:240,placeholder:G,value:q,onChange:_,onBlur:C,onCopy:Ft})]}),e[30]=C,e[31]=_,e[32]=$,e[33]=G,e[34]=q,e[35]=H):H=e[35];const F=H;let U;e[36]===Symbol.for("react.memo_cache_sentinel")?(U=z("flex w-full min-w-0 items-center px-5 py-1.5 font-sans text-sm"),e[36]=U):U=e[36];let V;e[37]===Symbol.for("react.memo_cache_sentinel")?(V=s.jsx("div",{className:"text-sm font-medium",children:s.jsx(L,{id:"eQGtfX",defaultMessage:"Subject"})}),e[37]=V):V=e[37];const J=d||!k;let K;e[38]===Symbol.for("react.memo_cache_sentinel")?(K=z(Te,"text-sm"),e[38]=K):K=e[38];const Y=d?g!=null?g:"":x;let X;e[39]!==y||e[40]!==E||e[41]!==J||e[42]!==Y?(X=s.jsxs("div",{className:U,children:[V,s.jsx("input",{disabled:J,className:K,value:Y,maxLength:240,onChange:E,onBlur:y,onCopy:Gt})]}),e[39]=y,e[40]=E,e[41]=J,e[42]=Y,e[43]=X):X=e[43];const ee=X;let ie;e[44]===Symbol.for("react.memo_cache_sentinel")?(ie=s.jsx("hr",{className:he}),e[44]=ie):ie=e[44];let re;e[45]===Symbol.for("react.memo_cache_sentinel")?(re=s.jsx("hr",{className:he}),e[45]=re):re=e[45];let ce;e[46]===Symbol.for("react.memo_cache_sentinel")?(ce=s.jsx("hr",{className:he}),e[46]=ce):ce=e[46];let de;e[47]!==ee||e[48]!==F?(de=s.jsxs("div",{children:[ie,F,re,ee,ce]}),e[47]=ee,e[48]=F,e[49]=de):de=e[49];const fe=de;let ue;return e[50]!==S||e[51]!==fe||e[52]!==C||e[53]!==_||e[54]!==y||e[55]!==E||e[56]!==u||e[57]!==ee||e[58]!==x||e[59]!==F?(ue={headerLabel:W,emailSendButton:S,toField:F,subjectField:ee,fullScreenEmailHeader:fe,titleState:x,recipientState:u,handleOnTitleChange:E,handleOnTitleBlur:y,handleOnRecipientChange:_,handleOnRecipientBlur:C},e[50]=S,e[51]=fe,e[52]=C,e[53]=_,e[54]=y,e[55]=E,e[56]=u,e[57]=ee,e[58]=x,e[59]=F,e[60]=ue):ue=e[60],ue}function Gt(m){return m.stopPropagation()}function Ft(m){return m.stopPropagation()}function Pt({serverThreadId:m,index:e,messageId:a,writingBlock:o,dirty:l,setDirty:n,onSave:t,delay:r=2e3}){const[d,g]=w.useState(!1),[i,k]=w.useState(null),[b,x]=w.useState(null),[f,u]=w.useState(!1),[N,p]=w.useState(!1),v=w.useRef(0),E=w.useRef(o.content),B=w.useRef(o.title),_=w.useRef(o.metadata),j=w.useRef(!1),y=w.useRef(!1),M=w.useRef(0),C=w.useRef(null),{mutate:T}=Ue({mutationFn:async({content:c,title:S,metadata:h})=>{v.current+=1,v.current>1&&p(!0),!(!m||!a)&&await Re.safePost("/conversation/message/writing-blocks",{requestBody:{message_id:a,conversation_id:m,index:String(e),id:o.id,writing_block:{content:c,index:String(e),variant:o.variant.toString(),metadata:h,title:S,id:o.id},updated_at:new Date().toISOString()},authOption:Je.SendIfAvailable})},onSuccess:(c,S,h)=>{C.current===(h==null?void 0:h.myVersion)&&(n(!1),x(new Date),t==null||t())},onMutate:()=>{v.current=0,p(!1);const c=++M.current;return C.current=c,g(!0),k(null),{myVersion:c}},onError:(c,S,h)=>{k(c.message),n(!0)},onSettled:(c,S,h,D)=>{v.current=0,p(!1),C.current===(D==null?void 0:D.myVersion)&&(g(!1),C.current=null,j.current&&I.flush())},retry:1,retryDelay:3e3}),I=Le(({content:c,title:S,metadata:h})=>{j.current=!1,u(!1),T({content:c,title:S,metadata:h})},r);w.useEffect(()=>{var c;if(o.content===E.current&&o.title===B.current&&o.metadata===_.current){y.current=!1;return}E.current=o.content,B.current=o.title,_.current=o.metadata,j.current=!0,u(!0),I({content:o.content,title:o.title,metadata:(c=o.metadata)!=null?c:{}}),y.current&&(Promise.resolve().then(()=>{I.flush()}),y.current=!1)},[o.content,o.title,o.metadata,I]),w.useEffect(()=>()=>{I.cancel(),y.current=!1,u(!1)},[I]);const A=w.useCallback(()=>{if(!l&&!j.current){y.current=!1,u(!1);return}y.current=!0,j.current&&(I.flush(),y.current=!1,u(!1))},[l,I]),W=w.useMemo(()=>!!b&&!l&&!d,[b,l,d]);return{status:w.useMemo(()=>N?"retrying":d?"saving":i?"error":f?"queued":l?"dirty":W?"saved":"idle",[N,d,i,f,l,W]),savedAt:b,error:i,flushPendingChanges:A}}const $t=()=>({editWritingBlock:w.useCallback(({content:e,clientThreadId:a,message:o,index:l,variant:n,metadata:t,title:r,id:d})=>{var g,i;(i=(g=o.metadata)==null?void 0:g.writing_blocks)!=null&&i[d]||se.logEventWithStatsig("ChatGPT Writing Block First Edit","chatgpt_writing_block_first_edit",te({},ae({clientThreadId:a,messageId:o.id}))),Ye(a,k=>Qe.updateTree(k,b=>{var x,f;return b.updateNodeMessageMetadata(o.id,{writing_blocks:pe(te({},(f=(x=o.metadata)==null?void 0:x.writing_blocks)!=null?f:{}),{[d]:{id:d,index:l,content:e,variant:n,title:r,metadata:t}})})}))},[])});function ks({conversation:m,messageId:e,id:a,originalContent:o,index:l,variant:n,title:t,recipient:r,onSave:d}){var W,R;const g=Xe(),i=m!=null?m:g,[k,b]=w.useState(!1),x=Se(()=>i==null?void 0:i.serverId$()),f=Ze(i==null?void 0:i.id,c=>{if(!e||!c)return;const h=tt.getTree(c).getNodeIfExists(e);return h==null?void 0:h.message},{disablePerfDetector:!0}),u=(R=(W=f==null?void 0:f.metadata)==null?void 0:W.writing_blocks)==null?void 0:R[a],N=w.useMemo(()=>{var c;return(c=u==null?void 0:u.metadata)!=null?c:{recipient:r!=null?r:null}},[r,u==null?void 0:u.metadata]),p=!!u,{editWritingBlock:v}=$t(),E=et(),B=x!=null&&!E,_=w.useMemo(()=>{var c,S,h;return(h=(S=(c=f==null?void 0:f.metadata)==null?void 0:c.writing_blocks)==null?void 0:S[a])!=null?h:{id:a,content:o,index:l,variant:n,title:t,metadata:N}},[f,a,o,l,n,t,N]),j=w.useMemo(()=>{var c,S;return(S=(c=f==null?void 0:f.metadata)==null?void 0:c.content_references)!=null?S:[]},[f]),{status:y,flushPendingChanges:M}=Pt({serverThreadId:x,index:l,messageId:e,dirty:k,setDirty:b,writingBlock:_,onSave:d}),C=w.useCallback(({content:c,title:S,metadata:h})=>{!(i!=null&&i.id)||!f||!f.id||v({content:c!=null?c:_.content,clientThreadId:i==null?void 0:i.id,message:f,index:l,variant:n,metadata:Object.assign({},N,h),title:S!=null?S:_.title,id:a})},[i==null?void 0:i.id,f,l,n,v,a,_,N]),T=w.useRef(null),I=w.useRef(null),A=w.useMemo(()=>{var c;return{serverThreadId:x,messageId:e,blockId:(c=_.id)!=null?c:String(_.index)}},[x,e,_.id,_.index]);return{conversation:i,writingBlock:_,contentReferences:j,autosaveStatus:y,flushPendingChanges:M,handleOnChange:C,messageRef:T,editorViewRef:I,analyticsMetadata:A,hasBeenEdited:p,isWritingBlockEditingAllowed:B,setDirty:b,dirty:k}}const Ht=2e4,Ut=m=>{"use forget";const e=Z.c(12),{editorViewRef:a,analyticsMetadata:o,isInlineWritingBlockEditEnabled:l,writingBlock:n,onChange:t,isStreaming:r,setDirty:d,flushPendingChanges:g,contentReferences:i,editorWrapperClassName:k,fullscreenMode:b}=m,x=b===void 0?!1:b,f=r||!l;let u;return e[0]!==o||e[1]!==i||e[2]!==a||e[3]!==k||e[4]!==g||e[5]!==x||e[6]!==l||e[7]!==t||e[8]!==d||e[9]!==f||e[10]!==n.content?(u=s.jsx(Mt,{editorViewRef:a,setDirty:d,analyticsMetadata:o,markdown:n.content,onChange:t,isDisabled:f,isInlineWritingBlockEditEnabled:l,maxLength:Ht,flushPendingChanges:g,contentReferences:i,wrapperClassName:k,fullscreenMode:x}),e[0]=o,e[1]=i,e[2]=a,e[3]=k,e[4]=g,e[5]=x,e[6]=l,e[7]=t,e[8]=d,e[9]=f,e[10]=n.content,e[11]=u):u=e[11],u};function Vt(m){"use forget";const e=Z.c(6),{clientThreadId:a,permalink:o,isStreaming:l}=m,n=Ve();let t;e[0]===Symbol.for("react.memo_cache_sentinel")?(t=s.jsx(L,{id:"WritingBlockCloseButton.closeTooltip",defaultMessage:"Close"}),e[0]=t):t=e[0];let r;return e[1]!==a||e[2]!==l||e[3]!==n||e[4]!==o?(r=s.jsx(oe,{sideOffset:le,label:t,children:o?s.jsx("button",{onClick:()=>n("/c/".concat(a)),className:"flex items-center px-2 py-2 select-none",children:s.jsx(Be,{})}):s.jsx(st,{asChild:!0,children:s.jsx("button",{className:"flex items-center px-2 py-2 select-none",disabled:l,children:s.jsx(Be,{})})})}),e[1]=a,e[2]=l,e[3]=n,e[4]=o,e[5]=r):r=e[5],r}function Kt({content:m,clientThreadId:e,messageId:a,contentReferences:o}){const l=Ae(),n=ne(),t=De(),[r,d]=w.useState(!1),g=gt();return{handleCopy:async k=>{if(r)return;se.logEventWithStatsig("ChatGPT Writing Block Copy Button Clicked","chatgpt_writing_block_copy_button_clicked",te({},ae({clientThreadId:e,messageId:a}))),_e.count(be.WRITING_BLOCKS,"chatgpt_writing_block_copy_button_clicked");const b=await Nt(m,{preserveContentReferences:!0}),x=nt(e);m!=null&&x!=null&&a!=null&&(se.logStructuredEvent(at,{conversationId:x,messageId:a}),ht(l,{type:"copy",source:"mouse",location:"writing-block",selectedText:b,messageId:a,serverThreadId:x,contentType:"text"}));let f={"text/plain":b};try{f=Tt(b,o)}catch(u){Oe.addError(u)}_t(f,t,k),d(!0),g(()=>d(!1),2e3)},Icon:r?pt:xt,copyLabel:n.formatMessage({id:"D5UU6P",defaultMessage:"Copy"})}}function zt(m){"use forget";const e=Z.c(8),{clientThreadId:a,messageId:o,content:l,contentReferences:n}=m;let t;e[0]!==a||e[1]!==l||e[2]!==n||e[3]!==o?(t={clientThreadId:a,messageId:o,content:l,contentReferences:n},e[0]=a,e[1]=l,e[2]=n,e[3]=o,e[4]=t):t=e[4];const{handleCopy:r}=Kt(t);let d;e[5]===Symbol.for("react.memo_cache_sentinel")?(d=z(ke,"font-normal","px-2 py-2"),e[5]=d):d=e[5];let g;return e[6]!==r?(g=s.jsx(bt,{onCopy:r,iconClassName:"icon-md",className:d,iconOnly:!0,tooltipSideOffset:le}),e[6]=r,e[7]=g):g=e[7],g}function qt({clientThreadId:m,messageId:e,index:a,title:o,isStreaming:l}){"use no forget";const n=De(),t=ne(),[r,d]=w.useState(!1),g=!We(),i=ot(m);if(!m)return null;const k=t.formatMessage({id:"writingblock.downloadFileError",defaultMessage:"Download failed. Please try again."});async function b(x){var f;if(i){d(!0);try{const u=await Re.safePost("/export_doc/writing_block",{requestBody:{conversation_id:i.toString(),message_id:e,index:a,export_type:x},skipJsonTransform:!0});u.ok||n.danger(k);const N=await u.blob(),p=u.headers.get("Content-Disposition"),v=(f=Rt(p))!=null?f:"".concat((o!=null?o:"Export").replaceAll("/","-"),".").concat(x);Wt(N,v)}catch(u){Oe.addError(u,{tags:["type:writing_block_download_button","export_type:".concat(x)]}),n.danger(k)}finally{d(!1)}}}return s.jsxs(Q.Root,{children:[s.jsx(oe,{sideOffset:le,label:s.jsx(L,{id:"WritingBlockDownloadButton.downloadTooltip",defaultMessage:"Download"}),children:s.jsx(Q.BasicTrigger,{asChild:!0,children:s.jsx("button",{className:z("flex items-center gap-1 px-2 py-2 select-none",(!i||l)&&"text-token-text-secondary"),disabled:r||!i||l,children:g?r?s.jsx(Ne,{size:16}):s.jsx(Ie,{className:"block"}):s.jsx("div",{className:z("flex items-center gap-1",ke,"font-normal"),children:r?s.jsx(Ne,{size:20}):s.jsx(Ie,{className:"block"})})})})}),s.jsx(Q.Portal,{children:s.jsxs(Q.Content,{align:"end",children:[s.jsx(Q.Label,{children:s.jsx(L,{id:"WritingBlockDownloadButton.menuTitle",defaultMessage:"Download"})}),s.jsx(Q.Item,{onSelect:()=>{b("pdf")},icon:St,label:t.formatMessage({id:"WritingBlockDownloadButton.downloadPdf.label",defaultMessage:"PDF document"}),trailing:s.jsx("span",{children:t.formatMessage({id:"WritingBlockDownloadButton.downloadPdf.ext",defaultMessage:".pdf"})})}),s.jsx(Q.Item,{onSelect:()=>{b("docx")},icon:lt,label:t.formatMessage({id:"WritingBlockDownloadButton.downloadDocx.label",defaultMessage:"Microsoft Word"}),trailing:s.jsx("span",{children:t.formatMessage({id:"WritingBlockDownloadButton.downloadDocx.ext",defaultMessage:".docx"})})})]})})]})}function Jt(m){"use forget";const e=Z.c(4),{isStreaming:a}=m;let o;e[0]===Symbol.for("react.memo_cache_sentinel")?(o=s.jsx(L,{id:"WritingBlockExpandButton.expandTooltip",defaultMessage:"Expand"}),e[0]=o):o=e[0];let l;e[1]===Symbol.for("react.memo_cache_sentinel")?(l=s.jsx(At,{}),e[1]=l):l=e[1];let n;return e[2]!==a?(n=s.jsx(oe,{sideOffset:le,label:o,children:s.jsx(it,{asChild:!0,children:s.jsx("button",{className:"flex items-center px-2 py-2 select-none",disabled:a,children:l})})}),e[2]=a,e[3]=n):n=e[3],n}function Yt(m){"use forget";var T,I,A,W;const e=Z.c(22),{content:a,clientThreadId:o,messageId:l}=m,n=rt(),t=Se(Qt),r=t==null?void 0:t.selectionIsEditable;let d;e[0]!==(t==null?void 0:t.selection)?(d=(T=t==null?void 0:t.selection)==null?void 0:T.trim(),e[0]=t==null?void 0:t.selection,e[1]=d):d=e[1];const g=!!d,i=(I=t==null?void 0:t.url)!=null?I:"";let k,b;if(e[2]!==i){const R=(A=(()=>{try{return new URL(i).host}catch(c){return""}})())!=null?A:"";k=!!i.match(Dt),b=R.includes("notion.so"),e[2]=i,e[3]=k,e[4]=b}else k=e[3],b=e[4];const x=b,u=!!(k||x||r),N=!!(!x&&g);let p;e[5]!==o||e[6]!==a||e[7]!==n||e[8]!==l?(p=()=>{if(!n)return;const R=o||l?ae({clientThreadId:o,messageId:l}):void 0;se.logEventWithStatsig("ChatGPT Writing Block Insert Button Clicked","chatgpt_writing_block_insert_button_clicked",R),_e.count(be.WRITING_BLOCKS,"chatgpt_writing_block_insert_button_clicked"),n.insertTextFromWebContent(a)},e[5]=o,e[6]=a,e[7]=n,e[8]=l,e[9]=p):p=e[9];const v=p;if(!n)return null;const E=!u,B=t==null?void 0:t.base64favicon,_=(W=t==null?void 0:t.title)!=null?W:i;let j;e[10]!==B||e[11]!==_?(j=s.jsx(kt,{base64:B,title:_,className:"not-prose h-3 w-3 flex-shrink-0 rounded-[4px]"}),e[10]=B,e[11]=_,e[12]=j):j=e[12];let y;e[13]!==N?(y=N?s.jsx(L,{id:"SjFYnK",defaultMessage:"Update"}):s.jsx(L,{id:"8SKT1J",defaultMessage:"Insert"}),e[13]=N,e[14]=y):y=e[14];let M;e[15]!==j||e[16]!==y?(M=s.jsxs("span",{className:"flex items-center gap-1.5",children:[j,y]}),e[15]=j,e[16]=y,e[17]=M):M=e[17];let C;return e[18]!==v||e[19]!==E||e[20]!==M?(C=s.jsx(dt,{color:"secondary",type:"button",onClick:v,disabled:E,size:"small",children:M}),e[18]=v,e[19]=E,e[20]=M,e[21]=C):C=e[21],C}function Qt(){return ct.context$()}function Xt({content:m,clientThreadId:e,title:a,messageId:o,messageRef:l}){const n=ne(),t=yt(e);function r(){Ct.logButtonClick(vt.OPEN_IN_CANVAS_WRITING_BLOCK),l.current&&wt(l.current);const d=Et.DOCUMENT;se.logEventWithStatsig("ChatGPT Writing Block Edit in Canvas Button Clicked","chatgpt_writing_block_edit_in_canvas_button_clicked",te({},ae({clientThreadId:e,messageId:o}))),t({title:a!=null?a:n.formatMessage({id:"2V9CtJ",defaultMessage:"New document"}),textdocType:d,content:m,createSource:Bt.MESSAGE_WRITING_BLOCK})}return s.jsx("button",{className:"flex items-center px-1.5 py-1 select-none",onClick:r,children:s.jsx(oe,{label:s.jsx(L,{id:"WritingBlockOpenCanvasButton.openTooltip",defaultMessage:"Edit in Canvas"}),children:s.jsx(jt,{className:"icon-md block"})})})}const Zt=m=>{"use forget";const e=Z.c(68),{primaryLabel:a,primaryAction:o,writingBlock:l,clientThreadId:n,messageId:t,isInlineWritingBlockExportEnabled:r,isWritingBlockFocusedModeEnabled:d,shouldShowWritingBlockCanvasEdit:g,title:i,index:k,messageRef:b,autosaveStatus:x,hideDownloadButton:f,contentReferences:u,fullscreenMode:N,isStreaming:p,permalink:v,className:E}=m,B=f===void 0?!1:f,_=N===void 0?!1:N,j=Ae();let y;e[0]!==j?(y=()=>ut(j),e[0]=j,e[1]=y):y=e[1];const M=Se(y);let C;e[2]!==j?(C=Me(j,"1600402835"),e[2]=j,e[3]=C):C=e[3];let T;e[4]!==j?(T=Me(j,"3877999974"),e[4]=j,e[5]=T):T=e[5];const I=T,A=!1,W="idle";let R;e:{R="text-token-text-primary/35";break e}const c=R;let S;e[6]!==_||e[7]!==I||e[8]!==M||e[9]!==l?(S=!_&&M&&l.content.trim().length>0&&I,e[6]=_,e[7]=I,e[8]=M,e[9]=l,e[10]=S):S=e[10];const h=S,D=_?"rounded-none":"rounded-t-2xl",$=h?"ps-3.5 pe-2.5":"ps-5 pe-2";let O;e[11]!==E||e[12]!==D||e[13]!==$?(O=z(Ot,"flex w-full items-center justify-between gap-3 py-1.5 font-sans",D,$,E),e[11]=E,e[12]=D,e[13]=$,e[14]=O):O=e[14];let G;e[15]!==a?(G=a!=null?a:s.jsx(L,{id:"Ui6xge",defaultMessage:"Writing"}),e[15]=a,e[16]=G):G=e[16];let q;e[17]!==c||e[18]!==W||e[19]!==A?(q=A,e[17]=c,e[18]=W,e[19]=A,e[20]=q):q=e[20];let H;e[21]!==G||e[22]!==q?(H=s.jsxs("div",{className:"text-token-text-primary flex max-w-[75%] flex-grow cursor-default items-center gap-2 text-sm font-medium",children:[G,q]}),e[21]=G,e[22]=q,e[23]=H):H=e[23];let F;e[24]!==n||e[25]!==u||e[26]!==t||e[27]!==l?(F=n&&t&&s.jsx(zt,{content:l.content,clientThreadId:n,messageId:t,contentReferences:u}),e[24]=n,e[25]=u,e[26]=t,e[27]=l,e[28]=F):F=e[28];let U;e[29]!==n||e[30]!==B||e[31]!==k||e[32]!==r||e[33]!==p||e[34]!==t||e[35]!==i?(U=!B&&r&&n&&t&&s.jsx(qt,{clientThreadId:n,messageId:t,title:i,index:k,isStreaming:p}),e[29]=n,e[30]=B,e[31]=k,e[32]=r,e[33]=p,e[34]=t,e[35]=i,e[36]=U):U=e[36];let V;e[37]!==n||e[38]!==t||e[39]!==b||e[40]!==g||e[41]!==i||e[42]!==l?(V=n&&t&&g&&s.jsx(Xt,{content:l.content,clientThreadId:n,messageId:t,title:i,messageRef:b}),e[37]=n,e[38]=t,e[39]=b,e[40]=g,e[41]=i,e[42]=l,e[43]=V):V=e[43];let J;e[44]!==n||e[45]!==t||e[46]!==h||e[47]!==l?(J=h&&n&&t&&s.jsx("div",{className:"ps-2",children:s.jsx(Yt,{content:l.content,clientThreadId:n,messageId:t})}),e[44]=n,e[45]=t,e[46]=h,e[47]=l,e[48]=J):J=e[48];let K;e[49]!==n||e[50]!==_||e[51]!==p||e[52]!==d||e[53]!==t||e[54]!==v||e[55]!==h?(K=n&&t&&d&&!h&&s.jsx("div",{className:z(p&&"pointer-events-none",!p&&"dark:hover:text-token-text-primary hover:text-token-text-primary"),children:_?s.jsx(Vt,{clientThreadId:n,permalink:v,isStreaming:p}):s.jsx(Jt,{isStreaming:p})}),e[49]=n,e[50]=_,e[51]=p,e[52]=d,e[53]=t,e[54]=v,e[55]=h,e[56]=K):K=e[56];let Y;e[57]!==o||e[58]!==F||e[59]!==U||e[60]!==V||e[61]!==J||e[62]!==K?(Y=s.jsxs("div",{className:"flex items-center justify-between",children:[F,U,V,o,J,K]}),e[57]=o,e[58]=F,e[59]=U,e[60]=V,e[61]=J,e[62]=K,e[63]=Y):Y=e[63];let X;return e[64]!==O||e[65]!==H||e[66]!==Y?(X=s.jsx("div",{className:"thread-xl:-top-[var(--header-height)] sticky top-0 z-1",children:s.jsxs("div",{className:O,children:[H,Y]})}),e[64]=O,e[65]=H,e[66]=Y,e[67]=X):X=e[67],X};function ys(m){"use forget";const e=Z.c(36),{analyticsMetadata:a,primaryLabel:o,primaryAction:l,subHeader:n,showHeader:t,headerClassName:r,hasBeenEdited:d,autosaveStatus:g,clientThreadId:i,messageId:k,isInlineWritingBlockExportEnabled:b,isWritingBlockFocusedModeEnabled:x,shouldShowWritingBlockCanvasEdit:f,title:u,index:N,messageRef:p,editorViewRef:v,isInlineWritingBlockEditEnabled:E,writingBlock:B,onChange:_,isStreaming:j,setDirty:y,flushPendingChanges:M,contentReferences:C,permalink:T,editorWrapperClassName:I}=m,A=t===void 0?!0:t;let W;e[0]!==g||e[1]!==i||e[2]!==C||e[3]!==d||e[4]!==r||e[5]!==N||e[6]!==b||e[7]!==x||e[8]!==k||e[9]!==p||e[10]!==T||e[11]!==l||e[12]!==o||e[13]!==f||e[14]!==A||e[15]!==u||e[16]!==B?(W=A&&s.jsx(Zt,{primaryLabel:o,primaryAction:l,hasBeenEdited:d,autosaveStatus:g,writingBlock:B,clientThreadId:i,messageId:k,isInlineWritingBlockExportEnabled:b,isWritingBlockFocusedModeEnabled:x,shouldShowWritingBlockCanvasEdit:f,title:u,index:N,messageRef:p,contentReferences:C,fullscreenMode:!0,hideDownloadButton:B.variant===It.EMAIL,permalink:T,className:r}),e[0]=g,e[1]=i,e[2]=C,e[3]=d,e[4]=r,e[5]=N,e[6]=b,e[7]=x,e[8]=k,e[9]=p,e[10]=T,e[11]=l,e[12]=o,e[13]=f,e[14]=A,e[15]=u,e[16]=B,e[17]=W):W=e[17];let R;e[18]===Symbol.for("react.memo_cache_sentinel")?(R=z("flex-1 overflow-y-auto"),e[18]=R):R=e[18];let c;e[19]!==a||e[20]!==C||e[21]!==v||e[22]!==I||e[23]!==M||e[24]!==E||e[25]!==j||e[26]!==_||e[27]!==y||e[28]!==B?(c=s.jsx(Ut,{editorViewRef:v,analyticsMetadata:a,setDirty:y,isInlineWritingBlockEditEnabled:E,writingBlock:B,onChange:_,isStreaming:j,flushPendingChanges:M,contentReferences:C,editorWrapperClassName:I,fullscreenMode:!0}),e[19]=a,e[20]=C,e[21]=v,e[22]=I,e[23]=M,e[24]=E,e[25]=j,e[26]=_,e[27]=y,e[28]=B,e[29]=c):c=e[29];let S;e[30]!==n||e[31]!==c?(S=s.jsxs("div",{className:R,children:[n,c]}),e[30]=n,e[31]=c,e[32]=S):S=e[32];let h;return e[33]!==W||e[34]!==S?(h=s.jsxs("div",{className:"writing-block-focused-view flex flex-1 flex-col overflow-y-auto",children:[W,S]}),e[33]=W,e[34]=S,e[35]=h):h=e[35],h}export{bs as E,_s as W,Ss as a,ys as b,hs as c,Zt as d,he as e,Ut as f,xs as g,ks as u};
//# sourceMappingURL=oscko8pqsql06nny.js.map
