var P=Object.defineProperty,E=Object.defineProperties;var F=Object.getOwnPropertyDescriptors;var f=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,w=Object.prototype.propertyIsEnumerable;var b=(t,e,a)=>e in t?P(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,p=(t,e)=>{for(var a in e||(e={}))N.call(e,a)&&b(t,a,e[a]);if(f)for(var a of f(e))w.call(e,a)&&b(t,a,e[a]);return t},g=(t,e)=>E(t,F(e));var k=(t,e)=>{var a={};for(var n in t)N.call(t,n)&&e.indexOf(n)<0&&(a[n]=t[n]);if(t!=null&&f)for(var n of f(t))e.indexOf(n)<0&&w.call(t,n)&&(a[n]=t[n]);return a};import{j as s,M as v,b as q,d as O,r as T}from"./mw35uwhq4g8r9eam.js";import{R as x,A as m,D as R,rq as H,_,hC as y,aA as j,o5 as I,as as W,cF as z,mk as G,d_ as $,rr as S}from"./d0xa318sl7ywi0za.js";import{cI as B,c$ as U,gY as A,dL as Q}from"./g2euln7v5pbm31qa.js";import{M as K}from"./i693kfbch8smq86y.js";import{r as X}from"./oj9zwxa6l3kpv1x2.js";const oe=async t=>await x.safePost("/shopping/customer",{requestBody:{items:t.map(e=>({id:e.id,value:e.value,quantity:e.quantity}))},authOption:m.SendIfAvailable}),le=async c=>{var r=c,{conversationId:t,sharedConversationUrl:e,existing_customer_session_client_secret:a}=r,n=k(r,["conversationId","sharedConversationUrl","existing_customer_session_client_secret"]);const l=async()=>await x.safePost("/shopping/checkout",{requestBody:{items:n.items.map(d=>({id:d.id,value:d.value,quantity:d.quantity})),conversation_id:t,shared_conversation_url:e,existing_customer_session_client_secret:a},authOption:m.SendIfAvailable});try{return await l()}catch(d){return await l()}},ce=async(t,{shippingMethodId:e,shippingAddress:a,items:n})=>{var d,h,i;const c=performance.now(),r={items:n.map(o=>({id:o.id,value:o.value,quantity:o.quantity}))};e!=null&&(r.shipping_option_id=e),a!=null&&(r.shipping_address={name:(d=a.name)!=null?d:void 0,line_one:(h=a.addressLine1)!=null?h:void 0,line_two:a.addressLine2,city:a.city,state:a.state,postal_code:a.postalCode,country:a.country,phone_number:(i=a.phoneNumber)!=null?i:void 0}),r.items=n.map(o=>({id:o.id,value:o.value,quantity:o.quantity}));const l=await x.safePatch("/shopping/checkout/{checkout_session_id}/update",{parameters:{path:{checkout_session_id:t}},requestBody:r,authOption:m.SendIfAvailable});return R.addAction("shopping_checkout.update",{durationMs:performance.now()-c}),l},de=async(t,e,a,n,c)=>await x.safePost("/shopping/checkout/{checkout_session_id}/complete",{parameters:{path:{checkout_session_id:t}},requestBody:{items:e.map(r=>({id:r.id,value:r.value,quantity:r.quantity})),payment_method:a,attempt_id:n,shipping_address:c},authOption:m.SendIfAvailable}),Y=async()=>(await x.safeGet("/shopping/orders",{authOption:m.SendIfAvailable})).orders,J=async t=>await x.safeGet("/shopping/order/{order_id}",{parameters:{path:{order_id:t}},authOption:m.SendIfAvailable}),C=1e3*5*60;function xe(){const t=ee();return t?s.jsx(D,{orderId:t}):s.jsx(H,{title:s.jsx(v,{id:"xdSD9Q",defaultMessage:"Orders"}),children:s.jsx(V,{})})}const L=()=>s.jsxs("div",{className:"flex w-full gap-3 py-2",children:[s.jsx("div",{className:"bg-token-bg-tertiary h-20 w-20 rounded-xl"}),s.jsxs("div",{className:"flex flex-1 flex-col items-start justify-start gap-1",children:[s.jsx(S,{index:0,width:50,heightSize:"sm"}),s.jsx(S,{index:0,width:70,heightSize:"sm"})]})]});function V(){const t=O(),{data:e,isLoading:a,isError:n,error:c}=q({queryKey:["orders"],queryFn:Y,staleTime:C,refetchOnMount:"always",refetchOnWindowFocus:"always"});return a?s.jsx(L,{}):n?s.jsxs("div",{className:"flex min-h-[400px] w-full flex-col items-center justify-center py-6 text-sm",children:[s.jsx(G,{className:"icon-xl"}),s.jsx("div",{className:"text-base font-medium",children:s.jsx(v,{id:"/GqhEc",defaultMessage:"Error loading orders"})}),!1]}):e&&(e!=null&&e.length)?s.jsx("div",{className:"flex flex-col",children:e==null?void 0:e.map((r,l)=>s.jsxs(s.Fragment,{children:[s.jsx(Z,{order:r,onClick:()=>{M(t,r.order.id)}},r.order.id),l!==e.length-1&&s.jsx("div",{className:"bg-token-border-light h-px"})]}))}):s.jsxs("div",{className:"flex min-h-[400px] w-full flex-col items-center justify-center py-6 text-sm",children:[s.jsx(A,{className:"icon-xl"}),s.jsx("div",{className:"text-base font-medium",children:s.jsx(v,{id:"2XILkl",defaultMessage:"No orders yet"})}),s.jsx("div",{className:"text-token-text-secondary text-xs",children:s.jsx(v,{id:"LwFNFv",defaultMessage:"Products you buy with ChatGPT will show here."})})]})}const Z=({order:t,onClick:e})=>{var a;return s.jsxs("button",{className:"my-3",onClick:e,children:[s.jsxs("div",{className:"flex gap-3",children:[s.jsx("div",{children:s.jsx("img",{className:"border-token-border-default bg-token-bg-primary shadow-xxs relative h-14 w-14 rounded-[10px] border border-[.5px]",src:(a=t.image_url)!=null?a:"",alt:t.title})}),s.jsxs("div",{className:"flex flex-1 flex-col items-start justify-start gap-0.5",children:[s.jsx("div",{className:"-mt-1 line-clamp-2 text-start text-base",children:t.title}),s.jsx("div",{className:"text-token-text-secondary text-xs",children:t.subtitle})]}),s.jsx("div",{className:"me-2 flex items-center justify-center",children:s.jsx(Q,{className:"icon"})})]}),t.error_message&&s.jsx("div",{className:"bg-token-bg-status-error text-token-interactive-label-danger-secondary-default mt-3 flex items-center rounded-lg px-3 py-1 text-sm",children:t.error_message})]})},D=({orderId:t})=>{var c,r,l,d,h;const{data:e,isLoading:a}=q({queryKey:["order",t],queryFn:()=>J(t),staleTime:C,refetchOnMount:"always",refetchOnWindowFocus:"always"}),n=O();return T.useEffect(()=>{(e!=null&&e.order.conversation_id||e!=null&&e.order.shared_conversation_url)&&t&&_.logEventWithStatsig("product_order_history","product_order_history",g(p({},y({clientThreadId:e==null?void 0:e.order.conversation_id})),{action:"shown",order_id:t,shared_conversation_url:e.order.shared_conversation_url}))},[e==null?void 0:e.order.conversation_id,e==null?void 0:e.order.shared_conversation_url,t]),s.jsxs("div",{children:[s.jsxs("div",{className:"h-header-height my-1 -ms-1 flex flex-shrink-0 items-center gap-2",children:[s.jsx(j,{color:"ghost",size:"medium",onClick:()=>M(n,void 0),contentWrapperClassName:"gap-[6px]",className:"w-9 rounded-lg",children:s.jsx(I,{className:"icon icon-sm"})}),s.jsxs("div",{className:"flex flex-col",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(B,{className:"icon h-[18px] w-[18px] rounded-full",url:(c=e==null?void 0:e.merchant_logo_url)!=null?c:"",size:128,minSize:16,fallback:s.jsx(U,{className:"text-token-text-tertiary"})}),s.jsx("div",{className:"text-sm font-normal",children:e==null?void 0:e.merchant_title})]}),s.jsx("div",{className:"text-token-text-secondary text-xs",children:e==null?void 0:e.merchant_subtitle})]})]}),a?s.jsx(L,{}):e?s.jsxs("div",{className:"flex flex-col pt-1 pb-4",children:[s.jsxs("div",{className:"flex gap-4",children:[s.jsx("div",{className:"bg-token-bg-tertiary dark:bg-token-main-surface-primary-inverse overflow-clip rounded-lg",children:s.jsx("img",{className:"m-0 aspect-square h-32 w-32 object-cover mix-blend-darken",src:(r=e==null?void 0:e.image_url)!=null?r:"",alt:(l=e==null?void 0:e.title)!=null?l:""})}),s.jsxs("div",{className:"flex flex-1 flex-col gap-0.5",children:[s.jsx("div",{className:"text-normal line-clamp-2 text-[17px] font-medium",children:e.title}),s.jsx("div",{className:"text-token-text-secondary text-sm",children:e==null?void 0:e.subtitle}),s.jsxs("div",{className:"mt-2 flex w-full flex-1 items-end gap-2",children:[((d=e.order.conversation_id)!=null?d:e.order.shared_conversation_url)&&s.jsx(j,{as:"a",to:e.order.shared_conversation_url||W(e.order.conversation_id),onClick:i=>{i.stopPropagation(),_.logEventWithStatsig("product_order_history","product_order_history",g(p({},y({clientThreadId:e==null?void 0:e.order.conversation_id})),{action:"open_conversation_button_clicked",order_id:t,shared_conversation_url:e.order.shared_conversation_url}))},color:"ghost",className:"border-token-border-light rounded-2xl border px-4",children:s.jsx(v,{id:"bLLnUh",defaultMessage:"Open in ChatGPT"})}),e.external_buttons.map((i,o)=>s.jsx(s.Fragment,{children:s.jsx(j,{as:"a",to:i.url,openNewTab:!0,onClick:u=>{u.stopPropagation(),_.logEventWithStatsig("product_order_history","product_order_history",g(p({},y({clientThreadId:e==null?void 0:e.order.conversation_id})),{action:"external_link_button_clicked",url:i.url,order_id:t}))},color:"ghost",className:"border-token-border-light rounded-2xl border px-4",children:i.title},"".concat(i.title,"-").concat(o))}))]})]})]}),e.error_message&&s.jsx("div",{className:"bg-token-bg-status-error text-token-interactive-label-danger-secondary-default mt-4 flex items-center rounded-lg px-3 py-1 text-sm",children:e.error_message}),s.jsx("div",{className:"mt-8 flex flex-col gap-8",children:(h=e==null?void 0:e.sections)==null?void 0:h.map(i=>s.jsxs("div",{className:"flex flex-col",children:[s.jsx("div",{className:"border-token-border-light border-b pb-2.5 text-base font-medium",children:i.title}),s.jsx("dl",{className:"divide-token-border-light divide-y",children:i.items.map(o=>s.jsxs("div",{className:"text-token-text-primary flex items-start gap-2 py-2.5 text-sm",children:[s.jsx("dt",{className:"flex-grow text-sm",children:o.label}),s.jsx("dd",{className:"text-end text-sm font-medium whitespace-pre",children:s.jsx(K,{remarkPlugins:[[X,{singleTilde:!1}]],components:{a:u=>s.jsx("a",g(p({},u),{className:z(u.className,"underline"),target:"_blank",children:u.children}))},children:o.value})})]},o.label))})]},i.title))})]}):null]})},M=(t,e)=>{const a=window.location.hash,[n,c]=a.split("?"),r=new URLSearchParams(c);e?r.set("order",e):r.delete("order");const l="#settings/".concat($.Orders).concat(r.toString()?"?".concat(r.toString()):"");t(l,{replace:!0})},ee=()=>{const t=window.location.hash,[e,a]=t.split("?");return new URLSearchParams(a).get("order")};export{xe as O,oe as a,de as c,le as g,M as s,ce as u};
//# sourceMappingURL=la79eh1q1qxrfcxi.js.map
