const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/njqluqt5n8il73qx.js","assets/mw35uwhq4g8r9eam.js","assets/d0xa318sl7ywi0za.js","assets/root-kavs8piy.css","assets/mdis9jpkwxdjqigv.js","assets/joa8jajuiu4xqpzn.js"])))=>i.map(i=>d[i]);
var R=Object.defineProperty,L=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var b=(e,t,n)=>t in e?R(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,A=(e,t)=>{for(var n in t||(t={}))W.call(t,n)&&b(e,n,t[n]);if(S)for(var n of S(t))H.call(t,n)&&b(e,n,t[n]);return e},D=(e,t)=>L(e,O(t));import{r as c,j as a,M as v,u as V,h as G,n as U,_ as z}from"./mw35uwhq4g8r9eam.js";import{fG as Z,o5 as q,e5 as K,cF as Q,M as B,bL as y,bK as N,aw as J,ax as X,D as Y,p as $,be as ee,V as te}from"./d0xa318sl7ywi0za.js";import{F as ne}from"./dukfeuga0ipvcx0b.js";import{dL as se,kZ as ae,cF as oe,m3 as ie,ee as C,ef as T,m4 as re,m5 as ce,m6 as de,m7 as ue,hm as le,jI as me}from"./g2euln7v5pbm31qa.js";import"./dtmprrbw2fxa7u08.js";import"./j6o92bx1q4qhetyv.js";import"./ojmli062couj7r3v.js";import"./lv7ytt0l14b17ows.js";import"./cvl54rj7bbx1877e.js";import"./i8gmt89kig8ue44v.js";import"./dejzmw8nrz6tr491.js";import"./5uqv5sdajcdsdc3v.js";import"./kc32gem4l2t3hnxt.js";import"./of0vtq1gcmd3mc3z.js";import"./kne35xckmmfq3xx6.js";import"./c340ncgh31fwqkpk.js";import"./kl0a548ohmz3fby2.js";import"./obpubb7ugisfu36u.js";import"./gl4f6lge29au0ljx.js";import"./iio0zgk2sqlxbcjy.js";import"./kbwy95pwpw3ze3en.js";import"./dbnl40ahcmx1rqbw.js";import"./j723eutw6lfomm01.js";import"./ggvjblnzoirafiyl.js";import"./fe4yarxdk4eko5w6.js";import"./kubdgxu3crk3gqem.js";import"./jc1wlz3ym1r6tf2l.js";import"./dhyn0hpw8j3dzdrv.js";import"./ft92xq3wp8rdw7y4.js";function fe(){const[e,t]=c.useState({undoStack:[],currentIndex:-1});function n(s){t(r=>({undoStack:[...r.undoStack.slice(0,r.currentIndex+1),s],currentIndex:r.currentIndex+1}))}function d(){t(s=>({undoStack:s.undoStack,currentIndex:Math.max(s.currentIndex-1,-1)}))}function o(){t(s=>({undoStack:s.undoStack,currentIndex:Math.min(s.currentIndex+1,s.undoStack.length-1)}))}function i(){t({undoStack:[],currentIndex:-1})}return{currentDrawnShape:e.undoStack.length>0?e.undoStack[e.currentIndex]:null,onNewDrawnShape:n,canUndoDrawing:e.currentIndex>=0,undoDrawing:d,canRedoDrawing:e.currentIndex<e.undoStack.length-1,redoDrawing:o,clearAllDrawings:i}}function ge({mode:e,imageIndex:t,allImages:n,onSwitchImage:d,isLoadingNewImage:o}){const i=t>0,s=c.useCallback(()=>{i&&d(n[t-1])},[i,n,t,d]),r=t<n.length-1,l=c.useCallback(()=>{r&&d(n[t+1])},[r,n,t,d]);return c.useEffect(()=>{function f(u){u.target instanceof HTMLTextAreaElement||e==="default"&&(u.key==="ArrowLeft"?s():u.key==="ArrowRight"&&l())}return document.addEventListener("keydown",f),()=>{document.removeEventListener("keydown",f)}},[e,s,l]),a.jsx("div",{className:"text-token-text-secondary flex h-16 w-full items-center justify-center gap-3 font-semibold",children:e==="inpaint"?!o&&a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx(v,{id:"imageEditor.selectArea",defaultMessage:"Select an area to edit"}),a.jsx("a",{href:"https://help.openai.com/en/articles/9055440",target:"_blank",rel:"noreferrer",children:a.jsx(Z,{className:"icon"})})]}):n.length>1?a.jsxs(a.Fragment,{children:[a.jsx("button",{disabled:!i,className:"disabled:text-token-text-tertiary",onClick:s,children:a.jsx(q,{className:"icon"})}),a.jsx("div",{children:a.jsx(v,{id:"imageEditor.imageNumber",defaultMessage:"Image {num} of {numImages}",values:{num:t+1,numImages:n.length}})}),a.jsx("button",{disabled:!r,className:"disabled:text-token-text-tertiary",onClick:l,children:a.jsx(se,{className:"icon"})})]}):null})}const he=0,pe=64;function we({imageAsset:e,children:t,containerDimensions:n,isLoadingNewImage:d}){return a.jsxs(K.div,D(A({className:"absolute",style:xe(e,n)},ae),{children:[t,a.jsx("div",{className:Q("bg-token-main-surface-primary absolute inset-0 flex items-center justify-center transition-opacity duration-1000",d?"pointer-events-auto opacity-60":"pointer-events-none opacity-0")})]}))}function xe(e,t){const{width:n,height:d}=e,{width:o,height:i}=t,s=o-2*he,r=i-2*pe,l=n/d,f=s/r,u=l>f,w=u?s:r*l,h=u?s/l:r,p=(i-h)/2,I=(o-w)/2;return{top:p,left:I,width:w,height:h}}const ye=ee(()=>z(()=>import("./njqluqt5n8il73qx.js"),__vite__mapDeps([0,1,2,3,4,5])).then(e=>e.DynamicDrawingCanvas));function Xe({clientThreadId:e,messageId:t,image:n,allImages:d}){const o=B(e,te.getCurrentNode),i=[y.Dalle,y.t2uay3k].includes(N(o.message))&&!oe(o.message),s=V();return c.useEffect(()=>{async function r(l,f){try{const u=await ie(s,l);C.setFocusedObject({type:T.Image,image:u[0],allImages:u,messageId:f})}catch(u){Y.addError(new Error("Failed to load newly created images:",{cause:u}))}}if(o!=null&&[y.Dalle,y.t2uay3k].includes(N(o.message))&&o.message.content.content_type===J.MultimodalText){const l=X.getImageAssetPointers(o.message);r(l,o.id)}},[s,o]),a.jsx(Ie,{image:n,allImages:d,isLoadingNewImage:i,clientThreadId:e,messageId:t})}function Ie({image:e,allImages:t,isLoadingNewImage:n,clientThreadId:d,messageId:o}){const[i,s]=c.useState("default"),[r,l]=c.useState({width:window.innerWidth-ne,height:window.innerHeight}),f=c.useRef(null),[u,w]=c.useState(136),h=fe(),{currentDrawnShape:p,onNewDrawnShape:I,clearAllDrawings:M}=h,k=c.useRef(null),E=G(),j=$(),{setTargetedContent:x}=re();c.useEffect(()=>{const m=new ResizeObserver(g=>{const{width:F,height:P}=g[0].contentRect;l({width:F,height:P})});return f.current&&m.observe(f.current),()=>{m.disconnect()}},[]),c.useEffect(()=>{function m(g){g.key==="Escape"&&(i==="inpaint"?s("default"):C.close())}return document.addEventListener("keydown",m),()=>{document.removeEventListener("keydown",m)}},[i]),c.useEffect(()=>(p==null?x({type:"object",placeholderTextOverride:U({id:"imageEditor.transformationTextareaPlaceholder",defaultMessage:"Edit imageâ€¦"}),shouldPersistAcrossMessages:!0,isFocusedViewContent:!0,createNewCompletionParams:m=>ce(m,e)}):x({type:"object",label:E.formatMessage({id:"imageEditor.inpaintingTargetedContentLabel",defaultMessage:"Edit selection"}),isFocusedViewContent:!0,createNewCompletionParams:async m=>{var g;return await de(m,e,(g=k.current)==null?void 0:g.getImageData(),E,j)},onCleared:()=>s("default")}),()=>{x(void 0)}),[e,E,x,p,j]),c.useEffect(()=>{i!=="inpaint"&&M()},[i]),c.useEffect(()=>{s("default")},[e]);const _=t.findIndex(m=>m.asset_pointer===e.asset_pointer);return a.jsxs("div",{ref:f,className:"flex h-full w-full flex-col justify-between",children:[a.jsx(ue,{imageAsset:e,mode:i,setMode:s,clientThreadId:d,messageId:o,cursorWidth:u,setCursorWidth:w,inpaintingDrawingState:h,isLoadingNewImage:n}),a.jsx(ge,{mode:i,imageIndex:_,allImages:t,onSwitchImage:m=>{C.setFocusedObject({type:T.Image,image:m,allImages:t,messageId:o})},isLoadingNewImage:n}),a.jsxs(we,{imageAsset:e,containerDimensions:r,isLoadingNewImage:n,children:[a.jsx(le,{className:"h-full w-full",alt:me(e),src:e.url,width:e.width,height:e.height,fadeIn:!1}),i==="inpaint"&&a.jsx("div",{className:"absolute inset-0",children:a.jsx(ye,{drawingCanvasRef:k,color:"rgba(0, 122, 255, 0.5)",dashedOutlineColor:"rgba(255, 255, 255, 0.65)",cursorWidth:u,canvasWidth:e.width,canvasHeight:e.height,currentDrawnShape:p,onNewDrawnShape:I})})]})]})}export{Xe as ImageEditor};
//# sourceMappingURL=oaa54w4iawect3nk.js.map
