var q=Object.defineProperty;var w=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var I=(s,t,n)=>t in s?q(s,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[t]=n,A=(s,t)=>{for(var n in t||(t={}))H.call(t,n)&&I(s,n,t[n]);if(w)for(var n of w(t))z.call(t,n)&&I(s,n,t[n]);return s};import{j as e,M as i,r as o,h as D,u as Q}from"./mw35uwhq4g8r9eam.js";import{ik as E,h2 as F,aA as R,ml as V,fN as Y,u as $,rS as J,e7 as K,g3 as W,g4 as X,ef as O,ei as P,rT as Z,am as ee,aB as se,rU as L,pf as te,rV as ne,gw as ae,dv as oe}from"./d0xa318sl7ywi0za.js";import{cg as B,i1 as p,cw as re,i2 as ie,A as le}from"./g2euln7v5pbm31qa.js";import{G as ce}from"./lcy2t692punsnn4q.js";function de({onClose:s}){const t=V("installations/select_target");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-0 mb-4 flex justify-center",children:e.jsx("div",{className:"bg-tertiary border-token-border-subtle rounded-lg border p-3",children:e.jsx(E,{className:"h-10 w-10"})})}),e.jsx("h2",{className:"mb-6 text-center text-xl font-semibold",children:e.jsx(i,{id:"e7S220",defaultMessage:"One last step"})}),e.jsxs("div",{className:"bg-tertiary border-token-border-subtle mb-6 flex items-start gap-3 rounded-lg border p-4",children:[e.jsx(F,{className:"icon mt-0.5"}),e.jsxs("div",{className:"flex flex-grow flex-col gap-1",children:[e.jsx("span",{className:"font-medium",children:e.jsx(i,{id:"MQhj3s",defaultMessage:"Configure your repositories"})}),e.jsx("span",{className:"text-token-text-tertiary text-sm",children:e.jsx(i,{id:"ZvosJF",defaultMessage:"You still need to choose the repositories ChatGPT can access."})})]})]}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs(R,{className:"w-full",size:"large",onClick:()=>{window.open(t,"_blank"),s(!1)},children:[e.jsx(i,{id:"o1jiyf",defaultMessage:"Configure Repositories on GitHub"}),e.jsx(B,{className:"icon-sm ms-2 inline-block"})]})})]})}const ue=({connectorLink:s,isLoading:t,onClose:n,onContinue:l})=>{var j,m;const S=D(),x=Q(),[u,c]=o.useState(""),[g,N]=o.useState(new Map),b=re(u,500),{data:f,isLoading:_,isFetchingNextPage:k,hasNextPage:v,fetchNextPage:M}=ie({enabled:!!s,debouncedSearchTerm:b,linkId:(j=s==null?void 0:s.id)!=null?j:""}),{mutateAsync:C,isPending:G}=te(),h=(m=ne())!=null?m:"unknown_referrer",y=o.useCallback(async()=>{if(s)try{await C({link:s,user_extension:{type:"GithubUserApiExtension",opted_in_repository_ids:Array.from(g.keys())},referrer:h!=null?h:"unknown_referrer"}),x.invalidateQueries({queryKey:["user_connection_sync_configuration"]}),l({reposToIndex:Array.from(g.values()).filter(a=>!a.is_code_search_indexed).map(a=>a.repository_full_name)})}catch(a){}},[s,C,g,x,l,h]),d=o.useMemo(()=>{var a;return(a=f==null?void 0:f.pages.flatMap(U=>U.repos))!=null?a:[]},[f]),r=d.length>5||!!b,T=_||t;return e.jsxs(e.Fragment,{children:[e.jsx(L,{title:e.jsx(i,{id:"BhSDq8",defaultMessage:"Which repositories do you use?"}),connectorIcon:e.jsx("div",{className:"rounded-xl border-[0.5px] p-2 shadow-sm",children:e.jsx(E,{className:"icon-2xl"})}),onClose:()=>n(!1)}),e.jsx("div",{className:"text-token-text-secondary mt-2 mb-6 text-center text-sm",children:r?e.jsx(i,{id:"o+DCDE",defaultMessage:"Choose up to 5. These repositories will sync with ChatGPT for improved speed and quality. Not seeing a repository? <link>Learn more</link>",values:{link:a=>e.jsx("a",{href:"https://help.openai.com/en/articles/11145903-chatgpt-connectors",target:"_blank",rel:"noopener noreferrer",className:"underline",children:a})}}):e.jsx(i,{id:"8FVBwU",defaultMessage:"These repositories will sync with ChatGPT for improved speed and quality. Not seeing a repository? <link>Learn more</link>",values:{link:a=>e.jsx("a",{href:"https://help.openai.com/en/articles/11145903-chatgpt-connectors",target:"_blank",rel:"noopener noreferrer",className:"underline",children:a})}})}),r&&e.jsx(le,{ariaLabel:S.formatMessage({id:"D2Xhv1",defaultMessage:"Search repositories"}),autoComplete:"off",className:"mb-2",icon:ae,iconPosition:"left",name:"search-repos",onChange:a=>{c(a.target.value)},placeholder:S.formatMessage({id:"jYgjAb",defaultMessage:"Search repositories"})}),e.jsx(ce,{allRepos:d,fetchNextPage:M,hasNextPage:v,isFetchingNextPage:k,isLoading:T,onChange:N,searchTerm:b,selectedRepos:g}),e.jsx(R,{className:"mt-2 w-full",disabled:T,loading:G,onClick:()=>{g.size===0?l({reposToIndex:[]}):y()},size:"large",children:e.jsx(i,A({},oe.continueButtonText))})]})},pe=({isLoading:s,onClose:t,reposToIndex:n})=>e.jsxs(e.Fragment,{children:[e.jsx(L,{title:e.jsx(i,{id:"hxqAFz",defaultMessage:"Complete setup"}),connectorIcon:e.jsx("div",{className:"rounded-xl border-[0.5px] p-2 shadow-sm",children:e.jsx(E,{className:"icon-2xl"})}),onClose:()=>t(!1)}),e.jsx("div",{className:"text-token-text-secondary mt-2 mb-6 text-center text-sm",children:e.jsx(i,{id:"IQqMC0",defaultMessage:"Your repositories must be indexed by GitHub before they can be accessed by ChatGPT. GitHub will open in a new tab, and automatically close. Indexing should complete in 5-10 minutes."})}),e.jsxs(R,{className:"mt-2 w-full",loading:s,onClick:()=>{window.open("https://github.com/search?q=".concat(n.map(l=>"repo:".concat(l)).join("+"),"&type=code"),"_blank"),t(!1)},size:"large",children:[e.jsx(i,{id:"CfvY9y",defaultMessage:"Start indexing on GitHub"}),e.jsx(B,{className:"icon-sm ms-2 inline-block"})]})]});function be({initialState:s=p.ConfigureRepos,onClose:t,onFinishFlow:n}){var j;const l=Y(),S=$(),x=J(S),u=K(),[c,g]=o.useState(s),[N,b]=o.useState([]),{platformConnectors:f,isLoading:_}=W(!0),{connectorLinks:k,isLoading:v}=X({fetchValidLinksOnly:!0}),M=f.get(O[P.GITHUB_CONNECTOR]),C=(j=k.get(O[P.GITHUB_CONNECTOR]))==null?void 0:j[0],{isLoading:G,isEnabled:h}=Z(),y=_||v||G,d=o.useCallback(m=>{t(m)},[t]),r=o.useCallback(()=>{d(!1),n==null||n()},[d,n]),T=o.useMemo(()=>{switch(c){case p.ConfigureRepos:return e.jsx(de,{onClose:()=>d(!1)});case p.SyncRepos:return l&&!x&&e.jsx(ue,{connector:M,connectorLink:C,isLoading:y,onContinue:({reposToIndex:m})=>{m.length>0?(b(m),g(p.IndexRepos)):r()},onClose:r});case p.IndexRepos:return e.jsx(pe,{isLoading:y,onClose:r,reposToIndex:N})}},[c,N,d,M,C,y,l,x,r]);return o.useEffect(()=>{!l&&c===p.SyncRepos&&d(!1)},[l,c,d]),o.useEffect(()=>{x&&c===p.SyncRepos&&r()},[x,c,r]),o.useEffect(()=>{!(u!=null&&u.isPersonalAccount())&&(u==null?void 0:u.planType)!==ee.SELF_SERVE_BUSINESS&&!h&&r()},[u,r,h]),e.jsx(se,{className:"max-w-[400px] px-2",hideSeparator:!0,isOpen:!0,onClose:()=>d(!1),showCloseButton:c===p.ConfigureRepos,title:c===p.ConfigureRepos?e.jsx("span",{}):void 0,testId:"modal-github-onboarding",type:"success",children:T})}export{be as GithubOnboardingModal};
//# sourceMappingURL=kzofw8o6635b70gi.js.map
