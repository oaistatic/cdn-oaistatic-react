import{h as j,u as Q,d as W,i as I,j as e,M as i,a9 as Z,ah as G,r as T,F as J,y as K}from"./mw35uwhq4g8r9eam.js";import{p as L,aB as $,dp as p,cF as Y,dz as ee,e7 as ae,er as te,cw as w,aA as f,hi as se}from"./d0xa318sl7ywi0za.js";import{f4 as ne,af as ie}from"./g2euln7v5pbm31qa.js";import{N as re}from"./cl2i3iqpmcb4wvd9.js";import{W as oe}from"./msmm4s2uspal1mht.js";import{W as le}from"./hdw58d7g4tx8n6s4.js";import{R as me,I as F,S as de}from"./mp1v4mj1e9tsamhf.js";import{u as ce}from"./o8muva2a6y8pvlji.js";import{j as h,r as ue,i as ge,c as fe}from"./ldtpmsnzn9ens47o.js";import{W as z}from"./baz4b8nlf8t2lb95.js";import{E as he}from"./mqc69l7lxl03rgi2.js";import{P as pe,a as xe}from"./lptwpbjabrvjmhsj.js";import"./dtmprrbw2fxa7u08.js";import"./j6o92bx1q4qhetyv.js";import"./ojmli062couj7r3v.js";import"./lv7ytt0l14b17ows.js";import"./cvl54rj7bbx1877e.js";import"./i8gmt89kig8ue44v.js";import"./dejzmw8nrz6tr491.js";import"./e5bg4yzr7nht9sxr.js";import"./kubdgxu3crk3gqem.js";import"./kne35xckmmfq3xx6.js";import"./c340ncgh31fwqkpk.js";import"./of0vtq1gcmd3mc3z.js";import"./m4z0737cb20mwzwc.js";import"./ddina39kz3r81pp7.js";import"./ksb30nvrqfrocrgu.js";import"./kx64af29hscb23w7.js";import"./w3hi9hzc7twqpn11.js";import"./mozvd7p01wv3j6u2.js";import"./sbrp17m0bwny70wh.js";import"./ohau9tqj1fpdibg0.js";import"./iknugp00locgtve5.js";import"./h1em0bjkpkjv8ykw.js";import"./cv4afpu20gjb9dll.js";import"./h4yh1661qhhbu5v5.js";import"./hu1bt0oauegdhua6.js";function ve({environmentId:s,onClose:a}){const n=j(),o=L(),l=Q(),d=W(),g=h(c=>c.setEnvironmentId),x=h(c=>c.setBranch),{mutate:t,isPending:v}=I({mutationFn:()=>z.deleteEnvironment(s),onSuccess:async()=>{ue(l,s),await ge(l),h.getState().environmentId===s&&(g(null),x(null)),o.success(n.formatMessage({id:"wham.deleteEnvironmentModal.environmentDeletedSuccessfully",defaultMessage:"Environment deleted successfully"})),a(),d("/codex/settings/environments")},onError:()=>{o.danger(n.formatMessage({id:"wham.deleteEnvironmentModal.failedToDeleteEnvironment",defaultMessage:"Failed to delete environment"}))}});return e.jsx($,{testId:"modal-wham-delete-environment",isOpen:!0,type:"danger",title:e.jsx(i,{id:"wham.deleteEnvironmentModal.title",defaultMessage:"Delete environment"}),onClose:a,primaryButton:e.jsx(p.Button,{title:n.formatMessage({id:"wham.deleteEnvironmentModal.delete",defaultMessage:"Delete"}),color:"danger",loading:v,onClick:()=>{t()}}),secondaryButton:e.jsx(p.Button,{title:n.formatMessage({id:"wham.deleteEnvironmentModal.cancel",defaultMessage:"Cancel"}),color:"secondary",onClick:a}),children:e.jsx("div",{className:"text-sm",children:e.jsx(i,{id:"wham.deleteEnvironmentModal.message",defaultMessage:"Tasks that use it will remain, but users wonâ€™t be able to create follow-up tasks."})})})}function r({label:s,children:a,className:n}){return e.jsxs("div",{className:Y("flex flex-col gap-1",n),children:[e.jsx("dt",{className:"text-token-text-primary text-sm font-medium",children:s}),e.jsx("dd",{className:"text-token-text-primary text-sm font-normal",children:a})]})}function Me({environmentId:s,onClose:a}){const n=j(),o=L(),{mutate:l,isPending:d}=I({mutationFn:()=>z.invalidateEnvironmentCache(s),onSuccess:()=>{o.success(n.formatMessage({id:"wham.resetCacheModal.cacheResetSuccessfully",defaultMessage:"Cache reset successfully"})),a()},onError:()=>{o.danger(n.formatMessage({id:"wham.resetCacheModal.failedToResetCache",defaultMessage:"Failed to reset cache"}))}});return e.jsx($,{testId:"modal-wham-delete-environment",isOpen:!0,type:"danger",title:e.jsx(i,{id:"wham.resetEnvironmentCacheModal.title",defaultMessage:"Reset cache"}),onClose:a,primaryButton:e.jsx(p.Button,{title:n.formatMessage({id:"wham.resetEnvironmentCacheModal.delete",defaultMessage:"Reset"}),color:"danger",loading:d,onClick:()=>{l()}}),secondaryButton:e.jsx(p.Button,{title:n.formatMessage({id:"wham.resetEnvironmentCacheModal.cancel",defaultMessage:"Cancel"}),color:"secondary",onClick:a}),children:e.jsx("div",{className:"text-sm",children:e.jsx(i,{id:"wham.resetEnvironmentCacheModal.message",defaultMessage:"All currently cached containers will be invalidated. The cache will be cleared for all users."})})})}function we(){const{environmentId:s}=Z(),{eligible:a}=ne();return a?e.jsx(G,{to:"/codex"}):s?e.jsx(De,{environmentId:s}):e.jsx(re,{})}function je(s){return s==null||s.setup==null?!1:Array.isArray(s.setup)?s.setup.length>0&&s.setup.every(a=>a!==""):s.setup!==""}function be(s,a,n){var o,l;return s?!!((l=(o=s.permissions)==null?void 0:o.can_write)!=null&&l||n!=null&&n.isAdminOfAccount()||(a==null?void 0:a.email)===s.creator.email):!1}function Ee(s,a,n){var o,l;return s?!!((l=(o=s==null?void 0:s.permissions)==null?void 0:o.can_delete)!=null&&l||n!=null&&n.isAdminOfAccount()||(a==null?void 0:a.email)===s.creator.email):!1}function De({environmentId:s}){var _,P,y,N,C,k,S,A,O,B;const a=j(),n=W(),[o,l]=T.useState(!1),[d,g]=T.useState(!1),x=h(m=>m.setEnvironmentId),{data:t,isLoading:v,isError:c}=fe(s),b=ee(),u=ae(),E=be(t,b,u),D=Ee(t,b,u),V=ce(),M=u==null?void 0:u.name,q=M!=null?M:a.formatMessage({id:"wham.environmentDetailsPage.workspace",defaultMessage:"Workspace"}),U=!je(t)&&(t==null?void 0:t.auto_setup_settings)==null,X=(P=(_=t==null?void 0:t.auto_setup_settings)==null?void 0:_.use_auto_setup)!=null?P:U;return e.jsxs(oe,{topPadding:!0,showSidebar:!1,children:[e.jsx("div",{className:"flex flex-col px-8 md:px-16",children:v?e.jsx("div",{className:"flex h-full items-center justify-center",children:e.jsx(te,{})}):c?e.jsx(he,{title:a.formatMessage({id:"wham.environmentDetailsPage.errorLoadingEnvironment",defaultMessage:"Error loading environment"}),description:a.formatMessage({id:"wham.environmentDetailsPage.errorLoadingEnvironmentDescription",defaultMessage:"Error loading environment description"})}):t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-token-border-default flex flex-col justify-between gap-2 border-b pb-4",children:e.jsxs("div",{className:"flex flex-row items-center justify-between",children:[e.jsxs(me,{children:[e.jsx(F,{label:a.formatMessage({id:"wham.environmentDetailsPage.environments",defaultMessage:"Environments"}),url:"/codex/settings/environments",className:"text-token-text-tertiary"}),e.jsx(de,{}),e.jsx(F,{label:t.label,url:"/codex/settings/environment/".concat(s),className:"text-token-text-primary font-medium"})]}),e.jsxs("div",{className:"flex flex-row gap-2",children:[e.jsx(w,{label:D?void 0:a.formatMessage({id:"wham.environmentDetailsPage.deleteEnvironmentTooltip",defaultMessage:"Only creators or editors of the environment, or an admin, can delete an environment"}),children:e.jsx(f,{color:"danger-outline",onClick:()=>l(!0),disabled:!D,"aria-label":a.formatMessage({id:"wham.environmentDetailsPage.deleteEnvironmentAriaLabel",defaultMessage:"Button to delete {environmentName}"},{environmentName:t.label}),children:e.jsx(i,{id:"wham.environmentDetailsPage.deleteEnvironment",defaultMessage:"Delete"})})}),e.jsx(w,{label:E?void 0:a.formatMessage({id:"wham.environmentDetailsPage.editEnvironmentTooltip",defaultMessage:"Only creators or editors of the environment, or an admin, can edit an environment"}),children:e.jsx(f,{icon:ie,onClick:()=>{n("/codex/settings/environment/".concat(s,"/edit"))},color:"secondary",disabled:!E,"aria-label":a.formatMessage({id:"wham.environmentDetailsPage.editEnvironmentAriaLabel",defaultMessage:"Button to edit {environmentName}"},{environmentName:t.label}),children:e.jsx(i,{id:"wham.environmentDetailsPage.editEnvironment",defaultMessage:"Edit"})})}),e.jsx(f,{size:"small",color:"secondary",onClick:()=>{x(s),le.recordClickEnv(),n("/codex")},"aria-label":a.formatMessage({id:"wham.environmentDetailsPage.useEnvironmentAriaLabel",defaultMessage:"Button to use environment {environmentName} in a codex task"},{environmentName:t.label}),children:e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx(i,{id:"wham.turnInfoRow.useEnvironment",defaultMessage:"Use this"}),e.jsx(se,{className:"icon-sm"})]})})]})]})}),e.jsx("div",{className:"text-token-text-primary py-8 text-xl",children:t.label}),e.jsxs("div",{className:"grid gap-x-12 gap-y-6 md:grid-cols-2",children:[e.jsx(r,{label:a.formatMessage({id:"wham.environmentDetailsPage.creator",defaultMessage:"Creator"}),children:t.creator.email}),e.jsx(r,{label:a.formatMessage({id:"wham.environmentDetailsPage.image",defaultMessage:"Image"}),children:t.machine.label||e.jsx(i,{id:"wham.environmentDetailsPage.noImage",defaultMessage:"No image"})}),e.jsx(r,{label:a.formatMessage({id:"wham.environmentDetailsPage.description",defaultMessage:"Description"}),children:(y=t.description)!=null?y:e.jsx(i,{id:"wham.environmentDetailsPage.noDescription",defaultMessage:"N/A"})}),e.jsx(r,{label:a.formatMessage({id:"wham.environmentDetailsPage.agentNetworkAccess",defaultMessage:"Agent internet access"}),children:((N=t.agent_network_access)==null?void 0:N.mode)==="on"?t.agent_network_access.preset_allowlist===pe?e.jsx(i,{id:"wham.environmentDetailsPage.agentNetworkAccess.unrestricted",defaultMessage:"On: unrestricted"}):t.agent_network_access.preset_allowlist===xe?e.jsx(i,{id:"wham.environmentDetailsPage.agentNetworkAccess.codex",defaultMessage:"On: common dependencies"}):e.jsx(i,{id:"wham.environmentDetailsPage.agentNetworkAccess.custom",defaultMessage:"On: custom domains"}):t.agent_network_access==null||t.agent_network_access.mode==="off"?e.jsx(i,{id:"wham.environmentDetailsPage.agentNetworkAccess.off",defaultMessage:"Off"}):null}),e.jsx(r,{label:a.formatMessage({id:"wham.environmentDetailsPage.postSetupCaching",defaultMessage:"Post setup caching"}),children:e.jsxs("div",{className:"flex items-center gap-2",children:[((C=t.cache_settings)==null?void 0:C.post_setup_cache_enabled)===!0?e.jsx(i,{id:"wham.environmentDetailsPage.postSetupCaching.on",defaultMessage:"On"}):e.jsx(i,{id:"wham.environmentDetailsPage.postSetupCaching.off",defaultMessage:"Off"}),((k=t.cache_settings)==null?void 0:k.post_setup_cache_enabled)&&e.jsx(w,{label:a.formatMessage({id:"wham.environmentDetailsPage.resetCacheTooltip",defaultMessage:"Invalidate any currently cached containers"}),children:e.jsx(f,{size:"small",onClick:()=>g(!0),color:"secondary","aria-label":a.formatMessage({id:"wham.environmentDetailsPage.resetCacheAriaLabel",defaultMessage:"Button to invalidate cache for {environmentName}"},{environmentName:t.label}),children:e.jsx(i,{id:"wham.environmentDetailsPage.resetCache",defaultMessage:"Reset cache"})})})]})}),((S=t.cache_settings)==null?void 0:S.post_setup_cache_enabled)&&e.jsx(r,{label:a.formatMessage({id:"wham.environmentDetailsPage.maintenanceSetupScript",defaultMessage:"Maintenance setup script"}),children:e.jsx("pre",{className:"mono text-xs leading-5 break-all whitespace-pre-wrap",children:(Array.isArray(t.maintenance_setup)?t.maintenance_setup:[t.maintenance_setup]).filter(Boolean).join("\n")})}),e.jsx(r,{label:a.formatMessage({id:"wham.environmentDetailsPage.environmentVariables",defaultMessage:"Environment variables"}),children:e.jsx("pre",{className:"mono text-xs leading-5 break-all whitespace-pre-wrap",children:Object.keys((A=t.env_vars)!=null?A:{}).filter(m=>!m.startsWith("CODEX_ENV_")).join("\n")})}),e.jsx(r,{label:a.formatMessage({id:"wham.environmentDetailsPage.secrets",defaultMessage:"Secrets"}),children:e.jsx("pre",{className:"mono text-xs leading-5 break-all whitespace-pre-wrap",children:Object.keys((O=t.secrets)!=null?O:{}).join("\n")})}),e.jsx(r,{label:a.formatMessage({id:"wham.environmentDetailsPage.createdAt",defaultMessage:"Created at"}),children:t.created_at?e.jsx(J,{value:new Date(t.created_at*1e3),year:"numeric",month:"long",day:"numeric"}):e.jsx(i,{id:"wham.environmentDetailsPage.noCreationDate",defaultMessage:"No creation date"})}),e.jsx(r,{label:a.formatMessage({id:"wham.environmentDetailsPage.setupScript",defaultMessage:"Setup script"}),children:X?e.jsx(i,{id:"wham.environmentDetailsPage.autoSetup.automatic",defaultMessage:"Automatic"}):e.jsx("pre",{className:"mono text-xs leading-5 break-all whitespace-pre-wrap",children:(Array.isArray(t.setup)?t.setup:[t.setup]).filter(Boolean).join("\n")})}),e.jsx(r,{label:a.formatMessage({id:"wham.environmentDetailsPage.repository",defaultMessage:"Repository"}),children:t.repo_map?Object.values(t.repo_map).map(m=>m.repository_full_name):e.jsx(i,{id:"wham.environmentDetailsPage.noRepository",defaultMessage:"No repository"})}),e.jsx(r,{label:a.formatMessage({id:"wham.environmentDetailsPage.numTasks",defaultMessage:"No. of tasks"}),children:(B=t.task_count)!=null?B:0}),V&&e.jsxs(e.Fragment,{children:[e.jsx(r,{label:a.formatMessage({id:"94ZVks",defaultMessage:"Share"}),children:t.share_settings==="workspace"?a.formatMessage({id:"wham.environmentDetailsPage.sharedWithWorkspace",defaultMessage:"Shared with {workspaceName}"},{workspaceName:q}):a.formatMessage({id:"wham.environmentDetailsPage.private",defaultMessage:"Private"})}),t.share_settings!=="private"&&e.jsx(r,{label:a.formatMessage({id:"wham.environmentDetailsPage.shareTargets",defaultMessage:"Additional editors"}),children:t.share_targets&&t.share_targets.length>0?e.jsx("div",{className:"flex flex-col gap-1",children:t.share_targets.map((m,H)=>{var R;return e.jsx("span",{children:m.email},"".concat((R=m.type)!=null?R:"user","-").concat(m.email,"-").concat(H))})}):e.jsx(i,{id:"wham.environmentDetailsPage.shareTargetsNone",defaultMessage:"None"})})]})]})]}):e.jsx("div",{className:"flex h-full items-center justify-center",children:e.jsx(i,{id:"wham.environmentDetailsPage.environmentNotFound",defaultMessage:"Environment not found"})})}),o&&e.jsx(ve,{environmentId:s,onClose:()=>l(!1)}),d&&e.jsx(Me,{environmentId:s,onClose:()=>g(!1)})]})}const la=()=>[{title:"Codex"}],ma=K(function(){return e.jsx(we,{})});export{ma as default,la as meta};
//# sourceMappingURL=ouk7ffjm0i9kju40.js.map
