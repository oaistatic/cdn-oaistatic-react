var Ht=Object.defineProperty,Bt=Object.defineProperties;var Ut=Object.getOwnPropertyDescriptors;var It=Object.getOwnPropertySymbols;var Qt=Object.prototype.hasOwnProperty,Jt=Object.prototype.propertyIsEnumerable;var Et=(n,t)=>(t=Symbol[n])?t:Symbol.for("Symbol."+n);var At=(n,t,e)=>t in n?Ht(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,p=(n,t)=>{for(var e in t||(t={}))Qt.call(t,e)&&At(n,e,t[e]);if(It)for(var e of It(t))Jt.call(t,e)&&At(n,e,t[e]);return n},$=(n,t)=>Bt(n,Ut(t));var Y=function(n,t){this[0]=n,this[1]=t},Rt=(n,t,e)=>{var d=(s,r,c,f)=>{try{var v=e[s](r),o=(r=v.value)instanceof Y,G=v.done;Promise.resolve(o?r[0]:r).then(y=>o?d(s==="return"?s:"next",r[1]?{done:y.done,value:y.value}:y,c,f):c({value:y,done:G})).catch(y=>d("throw",y,c,f))}catch(y){f(y)}},i=s=>a[s]=r=>new Promise((c,f)=>d(s,r,c,f)),a={};return e=e.apply(n,t),a[Et("asyncIterator")]=()=>a,i("next"),i("throw"),i("return"),a};var nt=(n,t,e)=>(t=n[Et("asyncIterator")])?t.call(n):(n=n[Et("iterator")](),t={},e=(d,i)=>(i=n[d])&&(t[d]=a=>new Promise((s,r,c)=>(a=i.call(n,a),c=a.done,Promise.resolve(a.value).then(f=>s({value:f,done:c}),r)))),e("next"),e("return"),t);import{c as $t,r as u,h as Xt,j as m}from"./mw35uwhq4g8r9eam.js";import{o5 as Lt,cF as jt,Q as Vt,jg as zt,b3 as vt,W as bt,u as Ft,J as mt,bo as Yt,rr as St,sM as Zt}from"./d0xa318sl7ywi0za.js";import{dL as Kt,lz as Gt,lA as Wt,f0 as yt,lB as Ot,f1 as Tt,lC as te,l as ee,lD as ne,d3 as oe,lE as se,lF as Dt}from"./g2euln7v5pbm31qa.js";import{I as ie,P as ae,a as re,b as ce,c as le,d as de}from"./nwl9s9haealsfe5d.js";function ue(n){"use forget";const t=$t.c(58),{images:e,initialIndex:d,className:i,aspect:a,objectPosition:s,showDots:r,showArrows:c,imageClassName:f,allowLoop:v,onClick:o}=n,G=d===void 0?0:d,y=i===void 0?"":i,C=a===void 0?"aspect-[16/9]":a,W=s===void 0?"object-cover":s,Q=r===void 0?!0:r,k=c===void 0?!0:c,D=f===void 0?"":f,R=v===void 0?!0:v,[_,et]=u.useState(G),[X,E]=u.useState(!1),[q,H]=u.useState(!1),M=u.useRef(null),j=Xt();let x;t[0]===Symbol.for("react.memo_cache_sentinel")?(x={active:!1,startX:0,lastX:0,dx:0,width:1,lastTime:0,velocity:0,captured:!1,programmaticTargetIndex:null},t[0]=x):x=t[0];const g=u.useRef(x),h=e.length;let b;t[1]!==R||t[2]!==h?(b=(S,O)=>{const l=O===void 0?"smooth":O,T=M.current;if(!T)return;const F=R?fe(S,0,h-1):Pt(S,0,h-1),tt=g.current.width||T.clientWidth||1;g.current.programmaticTargetIndex=F,T.scrollTo({left:F*tt,behavior:l}),et(F)},t[1]=R,t[2]=h,t[3]=b):b=t[3];const I=b;let N,U;t[4]!==k?(N=()=>{if(!k)return;H(!0);const S=window.setTimeout(()=>H(!1),2e3);return()=>window.clearTimeout(S)},U=[k],t[4]=k,t[5]=N,t[6]=U):(N=t[5],U=t[6]),u.useEffect(N,U);const V=X,A=X||q;let B;t[7]!==I?(B=S=>{I(S,"smooth")},t[7]=I,t[8]=B):B=t[8];const w=B;let z;t[9]!==w||t[10]!==_?(z=()=>w(_+1),t[9]=w,t[10]=_,t[11]=z):z=t[11];const wt=z;let ot;t[12]!==w||t[13]!==_?(ot=()=>w(_-1),t[12]=w,t[13]=_,t[14]=ot):ot=t[14];const Z=ot;let K,st;t[15]===Symbol.for("react.memo_cache_sentinel")?(K=()=>{const S=M.current;if(!S)return;const O=new ResizeObserver(l=>{for(const T of l)g.current.width=T.contentRect.width||S.clientWidth||1});return O.observe(S),g.current.width=S.clientWidth||1,()=>O.disconnect()},st=[],t[15]=K,t[16]=st):(K=t[15],st=t[16]),u.useEffect(K,st);let L,P;t[17]!==_||t[18]!==h?(L=()=>{const S=M.current;if(!S)return;const O=()=>{const l=g.current.width||S.clientWidth||1,T=S.scrollLeft||0,F=T/l,tt=g.current.programmaticTargetIndex;if(tt!=null){const xt=tt*l;Math.abs(T-xt)<=2&&(g.current.programmaticTargetIndex=null);return}let ht=_;F>_+.5?ht=Pt(_+1,0,h-1):F<_-.5&&(ht=Pt(_-1,0,h-1)),ht!==_&&et(ht)};return S.addEventListener("scroll",O,{passive:!0}),()=>S.removeEventListener("scroll",O)},P=[h,_],t[17]=_,t[18]=h,t[19]=L,t[20]=P):(L=t[19],P=t[20]),u.useEffect(L,P);const J="select-none ".concat(y," relative");let dt,ut;t[21]===Symbol.for("react.memo_cache_sentinel")?(dt=()=>E(!0),ut=()=>E(!1),t[21]=dt,t[22]=ut):(dt=t[21],ut=t[22]);const gt="relative w-full ".concat(C," overflow-clip");let it;if(t[23]!==D||t[24]!==e||t[25]!==j||t[26]!==W||t[27]!==o){let S;t[29]!==D||t[30]!==j||t[31]!==W||t[32]!==o?(S=(O,l)=>{var T;return m.jsx("div",{onClick:()=>o==null?void 0:o(O,l),className:"relative h-full w-full shrink-0 grow-0 basis-full snap-center",children:O.content?O.content:m.jsx("img",{src:O.src,alt:(T=O.alt)!=null?T:j.formatMessage({id:"wHCsqa",defaultMessage:"Slide {index}"},{index:l+1}),className:"h-full w-full ".concat(W," ").concat(D)})},l)},t[29]=D,t[30]=j,t[31]=W,t[32]=o,t[33]=S):S=t[33],it=e.map(S),t[23]=D,t[24]=e,t[25]=j,t[26]=W,t[27]=o,t[28]=it}else it=t[28];let at;t[34]!==it?(at=m.jsx("div",{ref:M,className:"no-scrollbar flex h-full w-full touch-pan-x snap-x snap-mandatory overflow-x-scroll scroll-smooth",children:it}),t[34]=it,t[35]=at):at=t[35];let rt;t[36]!==e.length||t[37]!==j||t[38]!==V||t[39]!==wt||t[40]!==Z||t[41]!==A||t[42]!==k?(rt=k&&e.length>1&&m.jsxs(m.Fragment,{children:[m.jsx(Nt,{ariaLabel:j.formatMessage({id:"l9pylv",defaultMessage:"Previous slide"}),onClick:Z,side:"start",visible:V,children:m.jsx(Lt,{className:"icon-md"})}),m.jsx(Nt,{ariaLabel:j.formatMessage({id:"L0pbQh",defaultMessage:"Next slide"}),onClick:wt,side:"end",visible:A,children:m.jsx(Kt,{className:"icon-md"})})]}),t[36]=e.length,t[37]=j,t[38]=V,t[39]=wt,t[40]=Z,t[41]=A,t[42]=k,t[43]=rt):rt=t[43];let ct;t[44]!==gt||t[45]!==at||t[46]!==rt?(ct=m.jsxs("div",{className:gt,children:[at,rt]}),t[44]=gt,t[45]=at,t[46]=rt,t[47]=ct):ct=t[47];let lt;t[48]!==w||t[49]!==e||t[50]!==_||t[51]!==j||t[52]!==Q?(lt=Q&&e.length>1&&e.length<=20&&m.jsx("div",{className:"absolute start-0 end-0 bottom-3 flex items-center justify-center gap-2",children:e.map((S,O)=>m.jsx("button",{onClick:()=>w(O),"aria-label":j.formatMessage({id:"PUV+4+",defaultMessage:"Go to slide {index}"},{index:O+1}),className:"h-1.5 w-1.5 rounded-full transition-opacity ".concat(O===_?"bg-black":"bg-gray-400 opacity-60 dark:bg-gray-600")},O))}),t[48]=w,t[49]=e,t[50]=_,t[51]=j,t[52]=Q,t[53]=lt):lt=t[53];let ft;return t[54]!==J||t[55]!==ct||t[56]!==lt?(ft=m.jsxs("div",{className:J,"aria-roledescription":"carousel",onMouseEnter:dt,onMouseLeave:ut,children:[ct,lt]}),t[54]=J,t[55]=ct,t[56]=lt,t[57]=ft):ft=t[57],ft}const Pt=(n,t,e)=>Math.min(Math.max(n,t),e),fe=(n,t,e)=>n>e?t:n<t?e:n;function Nt(n){"use forget";const t=$t.c(8),{ariaLabel:e,onClick:d,side:i,visible:a,children:s}=n,r=i==="start"?"start-3":"end-3",c=a?"opacity-90 pointer-events-auto":"opacity-0 pointer-events-none";let f;t[0]!==r||t[1]!==c?(f=jt("btn-secondary border-token-border-default active:bg-token-bg-tertiary hover:bg-token-bg-primary absolute top-1/2 flex h-8 w-8 -translate-y-1/2 items-center justify-center rounded-full bg-clip-padding backdrop-blur transition-opacity duration-300 hover:shadow-[0px_4px_16px_0px_rgba(0,0,0,0.05)] active:opacity-100!",c,r),t[0]=r,t[1]=c,t[2]=f):f=t[2];let v;return t[3]!==e||t[4]!==s||t[5]!==d||t[6]!==f?(v=m.jsx("button",{"aria-label":e,onClick:d,className:f,children:s}),t[3]=e,t[4]=s,t[5]=d,t[6]=f,t[7]=v):v=t[7],v}const _t=new Map;async function _e({productLookupKey:n}){const t=yt("".concat(bt,"/search/product_info_variants"),{method:"POST",headers:p({},vt({isAuthOptional:!0})),body:{product_lookup_key:n}});let e;try{for(var d=nt(t),i,a,s;i=!(a=await d.next()).done;i=!1){const r=a.value;"data"in r&&(e=r.data)}}catch(a){s=[a]}finally{try{i&&(a=d.return)&&await a.call(d)}finally{if(s)throw s[0]}}return e}const Ct=new Map;function pe({clientThreadId:n,messageId:t,product:e,isInitialLoad:d}){var et,X,E,q;const i=(et=Vt(n))!=null?et:n,a=zt(),s=qt({conversationId:i,messageId:t,productQuery:e.title}),r=[i,t,e.title].join(":"),[c,f]=u.useState((X=_t.get(r))==null?void 0:X.productReviews),[v,o]=u.useState((E=_t.get(r))==null?void 0:E.productRationale),[G,y]=u.useState((q=_t.get(r))==null?void 0:q.__debug),[C,W]=u.useState(Ct.get(s)),[Q,k]=u.useState(!1),[D,R]=u.useState(!0),_=u.useRef(null);return u.useEffect(()=>{async function H({profiler:x,conversationId:g,messageId:h,productQuery:b,productLookupKey:I,updatePartial:N}){try{for(var U=nt(ge({conversationId:g,messageId:h,productQuery:b,productLookupKey:I,persistConversationToUser:a.showDebugConversationTurns})),V,A,B;V=!(A=await U.next()).done;V=!1){const w=A.value;switch(w.type){case"product_reviews":{f(w),N({productReviews:w}),x.logTimingOnce("time_to_first_review"),k(!1);break}case"product_rationale":{o(w),N({productRationale:w}),x.logTimingOnce("time_to_rationale"),k(!1);break}case"__debug":{N({__debug:w}),y(w);break}}}}catch(A){B=[A]}finally{try{V&&(A=U.return)&&await A.call(U)}finally{if(B)throw B[0]}}k(!1)}async function M({profiler:x,productQuery:g,productLookupKey:h,updatePartial:b}){try{for(var I=nt(he({productQuery:g,productLookupKey:h})),N,U,V;N=!(U=await I.next()).done;N=!1){const A=U.value;switch(A.type){case"product_entity":{if(s===_.current){const B=$(p({},A),{product:$(p({},A.product),{product_lookup_key:$(p({},A.product.product_lookup_key),{variant_options_query:h==null?void 0:h.variant_options_query})})});b({productEntity:B}),W(B),R(!1),x.logTimingOnce("time_to_product_entity")}break}case"__debug":{b({__debug:A}),y(A);break}}}}catch(U){V=[U]}finally{try{N&&(U=I.return)&&await U.call(I)}finally{if(V)throw V[0]}}}async function j({conversationId:x,messageId:g,productQuery:h,productLookupKey:b}){var V;const I=new Gt(Wt.ProductSidebar,{context:{version:"v2"}});let N={};function U(A){N=p(p({},N),A)}try{d&&k(!0),await Promise.allSettled([H({profiler:I,conversationId:x,messageId:g,productQuery:h,productLookupKey:b,updatePartial:U}),M({profiler:I,productQuery:h,productLookupKey:b,updatePartial:U})])}finally{d&&I.logTimingOnce("sidebar_loaded"),s===_.current&&(_.current=null,R(!1));const{productReviews:A,productRationale:B,__debug:w}=N;(A||B||w)&&_t.set(r,p(p(p(p({},(V=_t.get(r))!=null?V:{}),A&&{productReviews:A}),B&&{productRationale:B}),w&&{__debug:w})),N.productEntity!==void 0&&Ct.set(qt({conversationId:x,messageId:g,productQuery:h}),N.productEntity)}}(async function(){const g=_t.get(r);g&&(g.productReviews&&f(g.productReviews),g.productRationale&&o(g.productRationale),g.__debug&&y(g.__debug));const h=Ct.get(s);if(h){W(h),R(!1);return}i&&t&&_.current!==s&&(_.current=s,await j({conversationId:i,messageId:t,productQuery:e.title,productLookupKey:e.product_lookup_key}))})()},[t,e.title,s,i,d]),{productInfo:{productReviews:c,productRationale:v,productEntity:C,__debug:G},isLoadingReviewsOrRationale:Q,isLoadingProductEntity:D,isCached:_t.has(r)}}function ge(a){return Rt(this,arguments,function*({conversationId:n,messageId:t,productQuery:e,productLookupKey:d,persistConversationToUser:i}){var c;const s=yt("".concat(bt,"/sidebar/conversation"),{method:"POST",headers:$(p({},vt({isAuthOptional:!0})),{"Content-Type":"application/json"}),body:p({conversation_id:n,message_id:t,supported_encodings:[Ot.V1],category:"product",product_params:p({product_query:e},d?{product_lookup_key:d}:{})},i?{debug_params:{persist_conversation_to_user:i}}:{})});let r=!1;try{for(var f=nt(Tt(s)),v,o,G;v=!(o=yield new Y(f.next())).done;v=!1){const y=o.value;if(!("data"in y))continue;const{type:C,data:W}=y.data;if(!r&&C==="__debug")r=!0,yield{type:"__debug",data:{conversation_link:"/c/".concat(W.conversation_id)}};else if(C==="message"){const k=(c=W.metadata)==null?void 0:c.content_references;if(!k)continue;for(const D of k){const R=D;if(!(d!=null&&d.variant_options_query&&R.type==="product_entity"&&!R.product.variants))switch(R.type){case"product_reviews":case"product_rationale":yield R;break;default:continue}}}}}catch(o){G=[o]}finally{try{v&&(o=f.return)&&(yield new Y(o.call(f)))}finally{if(G)throw G[0]}}})}function he(e){return Rt(this,arguments,function*({productQuery:n,productLookupKey:t}){const d=yt("".concat(bt,"/search/product_update"),{method:"POST",headers:$(p({},vt({isAuthOptional:!0})),{"Content-Type":"application/json"}),body:p({product_query:n},t?{product_lookup_key:t}:{})});try{for(var i=nt(d),a,s,r;a=!(s=yield new Y(i.next())).done;a=!1){const c=s.value;"data"in c&&(yield c.data)}}catch(s){r=[s]}finally{try{a&&(s=i.return)&&(yield new Y(s.call(i)))}finally{if(r)throw r[0]}}})}function qt({conversationId:n,messageId:t,productQuery:e}){return[n,t,e].join(":")}const pt=new Map,kt=new Map;function me({clientThreadId:n,messageId:t,product:e,isInitialLoad:d}){var q,H,M,j;const i=(q=Vt(n))!=null?q:n,a=Ft(),s=mt(a,"966859370"),r=mt(a,"1146160621"),c=i==n,f=Mt({conversationId:i,messageId:t,productQuery:e.title,product:e}),v=[i,t,e.title].join(":"),[o,G]=u.useState((H=pt.get(v))==null?void 0:H.productReviews),[y,C]=u.useState((M=pt.get(v))==null?void 0:M.productRationale),[W,Q]=u.useState((j=pt.get(v))==null?void 0:j.__debug),[k,D]=u.useState(kt.get(f)),[R,_]=u.useState(!1),[et,X]=u.useState(!0),E=u.useRef(null);return u.useEffect(()=>{async function x(){const{chatReq:h,turnstileToken:b,proofToken:I}=await te(a,void 0);return ee(h,b,I,null)}async function g({conversationId:h,isClientThread:b,messageId:I,isGenericEndpoint:N,productQuery:U,productLookupKey:V,sentinelHeaders:A,isProductInfoVariantsEndpointEnabled:B}){var st;const w=new Gt(Wt.ProductSidebar,{context:{version:"v1"}}),z={};try{d&&_(!0);const L=ve({conversationId:h,isClientThread:b,messageId:I,isGenericEndpoint:N,productQuery:U,productLookupKey:V,sentinelHeaders:A,isProductInfoVariantsEndpointEnabled:B});try{for(var wt=nt(L),ot,Z,K;ot=!(Z=await wt.next()).done;ot=!1){const P=Z.value;switch(P.type){case"product_reviews":{G(P),z.productReviews=P,w.logTimingOnce("time_to_first_review");break}case"product_rationale":{C(P),z.productRationale=P,w.logTimingOnce("time_to_rationale");break}case"product_entity":{if(f===E.current){const J=$(p({},P),{product:$(p({},P.product),{product_lookup_key:$(p({},P.product.product_lookup_key),{variant_options_query:V==null?void 0:V.variant_options_query})})});z.productEntity=J,D(J),w.logTimingOnce("time_to_product_entity"),X(!1)}break}case"__debug":{z.__debug=P,Q(P);break}}(P.type==="product_reviews"||P.type==="product_rationale")&&_(!1)}}catch(Z){K=[Z]}finally{try{ot&&(Z=wt.return)&&await Z.call(wt)}finally{if(K)throw K[0]}}}finally{d&&w.logTimingOnce("sidebar_loaded"),f===E.current&&(E.current=null,X(!1),_(!1));const{productReviews:L,productRationale:P,__debug:J}=z;(L||P||J)&&pt.set(v,p(p(p(p({},(st=pt.get(v))!=null?st:{}),L&&{productReviews:L}),P&&{productRationale:P}),J&&{__debug:J})),z.productEntity!==void 0&&kt.set(Mt({conversationId:h,messageId:I,productQuery:U,product:z.productEntity.product}),z.productEntity)}}(async function(){const b=pt.get(v);b&&(b.productReviews&&G(b.productReviews),b.productRationale&&C(b.productRationale),b.__debug&&Q(b.__debug));const I=kt.get(f);if(I){D(I),X(!1);return}i&&t&&E.current!==f&&(E.current=f,await g({conversationId:i,isClientThread:c,messageId:t,isGenericEndpoint:s,productQuery:e.title,productLookupKey:e.product_lookup_key,sentinelHeaders:s?await x():null,isProductInfoVariantsEndpointEnabled:r}))})()},[t,e.title,f,i,d]),{productInfo:{productReviews:o,productRationale:y,productEntity:k,__debug:W},isLoadingReviewsOrRationale:R,isLoadingProductEntity:et,isCached:pt.has(v)}}function ve(c){return Rt(this,arguments,function*({conversationId:n,isClientThread:t,messageId:e,isGenericEndpoint:d,productQuery:i,productLookupKey:a,sentinelHeaders:s,isProductInfoVariantsEndpointEnabled:r}){var C;const f=!!(a!=null&&a.variant_options_query);if(r&&f){const E=yt("".concat(bt,"/search/product_info_variants"),{method:"POST",headers:p({},vt({isAuthOptional:!0})),body:{product_lookup_key:a}});try{for(var v=nt(E),o,G,y;o=!(G=yield new Y(v.next())).done;o=!1){const q=G.value;"data"in q&&(yield q.data)}}catch(G){y=[G]}finally{try{o&&(G=v.return)&&(yield new Y(G.call(v)))}finally{if(y)throw y[0]}}}else if(d){const E=yt("".concat(bt,"/sidebar/conversation"),{method:"POST",headers:$(p(p({},vt({isAuthOptional:!0})),s!=null?s:{}),{"Content-Type":"application/json"}),body:{conversation_id:n,message_id:e,supported_encodings:[Ot.V1],is_client_thread:t,category:"product",product_params:p({product_query:i},a?{product_lookup_key:a}:{})}});let q=!1;try{for(var W=nt(Tt(E)),Q,k,D;Q=!(k=yield new Y(W.next())).done;Q=!1){const H=k.value;if(!("data"in H))continue;const{type:M,data:j}=H.data;if(!q&&M==="__debug")q=!0,yield{type:"__debug",data:{conversation_link:"/c/".concat(j.conversation_id)}};else if(M==="message"){const g=(C=j.metadata)==null?void 0:C.content_references;if(!g)continue;for(const h of g){const b=h;if(!(a!=null&&a.variant_options_query&&b.type=="product_entity"&&!b.product.variants))switch(b.type){case"product_reviews":case"product_rationale":case"product_entity":yield b;break;default:continue}}}}}catch(k){D=[k]}finally{try{Q&&(k=W.return)&&(yield new Y(k.call(W)))}finally{if(D)throw D[0]}}}else{const E=yt("".concat(bt,"/search/product_info"),{method:"POST",headers:$(p({},vt({isAuthOptional:!0})),{"Content-Type":"application/json"}),body:p({conversation_id:n,is_client_thread:t,message_id:e,product_query:i,supported_encodings:[Ot.V1]},a?{product_lookup_key:a}:{})}),q=Tt(E);try{for(var R=nt(q),_,et,X;_=!(et=yield new Y(R.next())).done;_=!1){const H=et.value;"data"in H&&(yield H.data)}}catch(et){X=[et]}finally{try{_&&(et=R.return)&&(yield new Y(et.call(R)))}finally{if(X)throw X[0]}}}})}function Mt({conversationId:n,messageId:t,productQuery:e,product:d}){var i;return[n,t,e,JSON.stringify((i=d.product_lookup_key)==null?void 0:i.variant_options_query)].join(":")}function Pe({product:n,setUpdatedProduct:t,clientThreadId:e,messageId:d,contentReferenceStartIndex:i,productIndex:a,analyticsMetadata:s,offsetTopMargin:r=!1}){var P,J,dt,ut,gt,it,at,rt,ct,lt,ft,S,O;const c=Ft(),f=Yt(c),v=ne(s),[o,G]=u.useState(n),y=((P=o.product_lookup_key)==null?void 0:P.variant_options_query)==null,[C,W]=u.useState(null),[Q,k]=u.useState(!1),[D,R]=u.useState(!1),{showDebugConversationTurns:_}=zt(),et=oe.useStore(),X=u.useRef(!1),E=mt(c,"3375735072"),q=mt(c,"232003972"),H=mt(c,"4170238021"),M=mt(c,"966859370"),j=M?pe:me,x=se({namespace:"shopping_checkout"});u.useEffect(()=>{x==null||x.reset()},[n.id,x]);const{productInfo:g,isLoadingReviewsOrRationale:h,isLoadingProductEntity:b,isCached:I}=j({clientThreadId:e,messageId:d,product:o,isInitialLoad:y}),N=u.useRef(!1);u.useEffect(()=>{var T,F;const l=(T=g.productEntity)==null?void 0:T.product;l&&(!M&&((F=o.product_lookup_key)!=null&&F.variant_options_query)&&l.variants,X.current||G(tt=>$(p({},l),{title:tt.title}))),g.productEntity&&!N.current&&(N.current=!0,v("Product Sidebar Entity Loaded","product_sidebar_entity_loaded","product_entity"))},[g.productEntity,v]),u.useEffect(()=>{v("Product Detail Shown","product_detail_shown","product_entity",{product_id:n.id,product_url:n.url})},[]),u.useEffect(()=>{o&&t(o)},[o,t]),u.useEffect(()=>{var T;if(!M)return;async function l(){R(!0),x==null||x.startBlock("offer_variant_reload");try{const F=await _e({productLookupKey:o.product_lookup_key}),tt=F==null?void 0:F.product;tt&&tt.variants&&(G(ht=>{var xt;return $(p({},tt),{title:(xt=tt.title)!=null?xt:ht.title})}),X.current=!0)}catch(F){}finally{x==null||x.endBlock("offer_variant_reload"),R(!1)}}(T=o.product_lookup_key)!=null&&T.variant_options_query&&l()},[(J=o.product_lookup_key)==null?void 0:J.variant_options_query]);const U=u.useRef([]),V=u.useRef([]),A=(ut=(dt=o==null?void 0:o.offers)!=null?dt:n.offers)!=null?ut:[];for(const l of A)U.current.some(T=>T.merchant_name===l.merchant_name)||U.current.push(l);const B=(it=(gt=o==null?void 0:o.image_urls)!=null?gt:n.image_urls)!=null?it:[];for(const l of B)V.current.includes(l)||V.current.push(l);const w=o.num_reviews,z=o.rating,wt=o.rating_grouped_citation,ot=(at=o==null?void 0:o.variants)!=null?at:[],Z=E?o.image_urls:(rt=V.current)!=null?rt:[],K=Z==null?void 0:Z.map(l=>({url:l,content_url:l,thumbnail_url:l,title:o.title,content_size:{width:0,height:0},thumbnail_size:{width:0,height:0}})),st=!E||!b,L=E?D:!1;return m.jsxs("div",{className:jt("bg-token-bg-primary flex w-full flex-col",r?f?"mt-[calc(var(--threadFlyOut-leading-height,var(--header-height))*-1)] min-h-screen":"mt-[calc(var(--threadFlyOut-leading-height,53px)*-1)] min-h-screen":"mt-0"),children:[H?m.jsx(ue,{images:(ct=Z==null?void 0:Z.map(l=>({src:l})))!=null?ct:[],aspect:"aspect-square",objectPosition:"object-contain",imageClassName:"mix-blend-darken dark:mix-blend-lighten cursor-zoom-in",onClick:l=>{et.setCurrentImage({image:{url:l.src,content_url:l.src,thumbnail_url:l.src,title:n.title,content_size:{width:0,height:0},thumbnail_size:{width:0,height:0}},source:Dt.ImageGroup,analyticsMetadata:s,contentReferenceStartIndex:i,productIndex:a,imageResults:K!=null?K:[]})}}):m.jsx(ie,{imageUrls:Z,title:n.title,onImageClick:l=>{et.setCurrentImage({image:{url:l,content_url:l,thumbnail_url:l,title:n.title,content_size:{width:0,height:0},thumbnail_size:{width:0,height:0}},source:Dt.ImageGroup,analyticsMetadata:s,contentReferenceStartIndex:i,productIndex:a,imageResults:K!=null?K:[]})}}),m.jsxs("div",{className:"border-token-border-light flex flex-col border-t px-6 pt-4",children:[m.jsx("h2",{className:"text-xl",children:o.title}),w!=null&&w>0&&z!=null&&q&&m.jsx(ae,{rating:z,numReviews:w,ratingGroupedCitation:wt,trackContentReferenceEvent:v,analyticsMetadata:s})]}),E&&!b&&(ot==null?void 0:ot.length)>0&&m.jsx("div",{className:jt("px-6 pt-4",D&&"pointer-events-none opacity-50"),"aria-busy":D,children:m.jsx(re,{options:ot,showErrors:Q,updateOption:(l,T,F)=>be({optionGroupId:l,selectedId:T,variant_index:F,statefulProduct:o,setStatefulProduct:G,trackContentReferenceEvent:v,productIndex:a,productId:n.id})})}),C&&m.jsx("div",{className:"text-token-interactive-label-danger-secondary-default text-center",children:C}),st&&m.jsx(ce,{className:"border-token-border-light -mx-3 flex flex-col px-6 pt-4",offers:E?(lt=o.offers)!=null?lt:[]:(ft=U.current)!=null?ft:[],profiler:x,contentReferenceStartIndex:i,productIndex:a,product:o,trackContentReferenceEvent:v,analyticsMetadata:s,imageUrls:E?(S=o.image_urls)!=null?S:[]:(O=V.current)!=null?O:[],isLoading:L,onOpenCheckout:()=>k(!0)}),h?m.jsxs("div",{className:"flex flex-col gap-4 px-6 py-6",children:[m.jsx(St,{index:0,width:50,heightSize:"sm"}),m.jsxs(Zt,{children:[m.jsx(St,{index:1,width:100,heightSize:"sm"}),m.jsx(St,{index:2,width:100,heightSize:"sm"}),m.jsx(St,{index:3,width:30,heightSize:"sm"})]})]}):m.jsxs("div",{className:"bg-token-bg-primary flex flex-col pt-4",children:[m.jsx(le,{contentReference:g.productRationale,trackContentReferenceEvent:v,disableAnimation:I}),m.jsx(de,{contentReference:g.productReviews,trackContentReferenceEvent:v,disableAnimation:I})]}),!1]})}function be({optionGroupId:n,selectedId:t,variant_index:e,statefulProduct:d,setStatefulProduct:i,trackContentReferenceEvent:a,productIndex:s,productId:r}){var f,v,o,G;const c=(f=d.variants)==null?void 0:f.find(y=>y.id===n);a("product_detail","product_detail","product_entity",{product_index:s,product_id:r,action:"variant_selected",section:"product_detail",section_location:"sidebar",variant_name:(v=c==null?void 0:c.label)!=null?v:"",variant_value:(G=(o=c==null?void 0:c.options.find(y=>y.id===t))==null?void 0:o.label)!=null?G:"",variant_index:e}),i(y=>{var k,D;const C=(D=(k=y.variants)==null?void 0:k.map(R=>R.id===n?$(p({},R),{options:R.options.map(_=>$(p({},_),{selected:_.id===t})),selected_option_id:t}):R))!=null?D:y.variants,Q=(C==null?void 0:C.every(R=>R.selected_option_id))?C==null?void 0:C.reduce((R,_)=>(_.selected_option_id&&(R[_.id]=_.selected_option_id),R),{}):null;return $(p({},y),{variants:C,product_lookup_key:$(p({},y.product_lookup_key),{variant_options_query:Q,last_variant_selection_group_id:n})})})}export{Pe as P};
//# sourceMappingURL=h1bi47sw480gxt9x.js.map
