var at=Object.freeze,ot=Object.defineProperty,qt=Object.defineProperties;var Rt=Object.getOwnPropertyDescriptors;var Ge=Object.getOwnPropertySymbols;var rt=Object.prototype.hasOwnProperty,nt=Object.prototype.propertyIsEnumerable;var st=(a,e,s)=>e in a?ot(a,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[e]=s,u=(a,e)=>{for(var s in e||(e={}))rt.call(e,s)&&st(a,s,e[s]);if(Ge)for(var s of Ge(e))nt.call(e,s)&&st(a,s,e[s]);return a},F=(a,e)=>qt(a,Rt(e));var ve=(a,e)=>{var s={};for(var o in a)rt.call(a,o)&&e.indexOf(o)<0&&(s[o]=a[o]);if(a!=null&&Ge)for(var o of Ge(a))e.indexOf(o)<0&&nt.call(a,o)&&(s[o]=a[o]);return s};var it=(a,e)=>at(ot(a,"raw",{value:at(e||a.slice())}));import{b as X,h as le,r as h,e as ee,j as t,M as g,L as Bt,g as Ht,c as Kt,y as $t}from"./mw35uwhq4g8r9eam.js";import{u as Qt,V as Vt,O as be}from"./fkjhta71fmme40r8.js";import{bd as P,dL as Yt,bB as Jt,ip as Y,hS as yt,bI as Zt,x$ as vt,A as Xt,ra as ea,cg as bt,cw as ta,lt as aa,lu as sa,bb as oa}from"./g2euln7v5pbm31qa.js";import{_ as U,er as Te,cF as G,R as Q,xE as ue,xF as Mt,aA as K,o5 as ra,lR as R,sJ as We,sF as na,xG as ia,xH as $e,xw as Me,kq as _e,e5 as _t,dh as la,xI as kt,aB as wt,xJ as ie,xK as Pe,xL as Fe,xM as Re,sG as Ie,xN as lt,xO as jt,xP as ca,xQ as Ct,cw as St,fG as da,L as ua,gw as ma,hD as ga,oe as pa,u as Qe,b9 as Ut,lC as ha,xR as fa,J as xa,cB as ya,e7 as va,iK as ba}from"./d0xa318sl7ywi0za.js";import{r as Ma}from"./gb86rk5iguj309wb.js";import{S as _a}from"./mdhx8v0rk5lzwfyg.js";import{d as ka}from"./o4m46p2hmbpmbw32.js";import{f as I,p as Tt}from"./og1ftjb0zeoepdz3.js";import{L as wa}from"./lrkt6qiveter6omk.js";import{S as ja}from"./icplq4r4g4m9zwmv.js";import{S as Ca}from"./eq347oxkmgs4si5r.js";import{G as Sa}from"./dzciepzlrexlt6ar.js";import{e as Ua,M as He}from"./la8lelg2j64ilvfd.js";import{S as Lt}from"./l47aaylm7ckwvgfa.js";import{a as Dt,c as Ta}from"./g6gtv3p57f0esi65.js";import{F as La}from"./bkgcomfvnpye3vr8.js";import{u as Da,b as Na}from"./jds242fqj1w4n5ig.js";import"./j29baj0apaw4vezi.js";import"./m3aipoogd94oudzg.js";import"./ee6pijsbu8dfevmi.js";import"./galyil7vygq0i5a6.js";import"./hwa6pbq6i57ntwuh.js";import"./mfq2eda4qxrcz3ws.js";import"./m9dg467qzmmahw21.js";import"./o4syhzyam6fzccjl.js";import"./e9wj7nd5g5h0l9yg.js";import"./tffc42bs0etu9v3l.js";import"./dbnl40ahcmx1rqbw.js";import"./j723eutw6lfomm01.js";import"./gl4f6lge29au0ljx.js";import"./iio0zgk2sqlxbcjy.js";import"./obpubb7ugisfu36u.js";import"./ojmli062couj7r3v.js";import"./lv7ytt0l14b17ows.js";import"./c340ncgh31fwqkpk.js";import"./of0vtq1gcmd3mc3z.js";import"./ggvjblnzoirafiyl.js";import"./kc32gem4l2t3hnxt.js";import"./5uqv5sdajcdsdc3v.js";import"./kne35xckmmfq3xx6.js";import"./kl0a548ohmz3fby2.js";import"./fe4yarxdk4eko5w6.js";import"./kubdgxu3crk3gqem.js";import"./jc1wlz3ym1r6tf2l.js";import"./dhyn0hpw8j3dzdrv.js";import"./kubovzlwgxdy8km7.js";import"./ffo9fz3385kae4ff.js";const $=(a,{toastId:e="chatgpt.usageAnalytics.defaultErrorToastId",message:s}={})=>Qt(a,{toastId:e,message:s}),Oe="--",ne=ee({tableWorkspaceColumn:{id:"workspaceUsage.benchmark.tableWorkspaceColumn",defaultMessage:"{workspaceName}"},tableMetricColumn:{id:"workspaceUsage.benchmark.tableMetricColumn",defaultMessage:"Metric"},tableIndustryColumn:{id:"workspaceUsage.benchmark.tableIndustryColumn",defaultMessage:"Industry mean"},tableIndustryColumnNamed:{id:"workspaceUsage.benchmark.tableIndustryColumnNamed",defaultMessage:"Industry mean ({industry})"},tableDifferenceColumn:{id:"workspaceUsage.benchmark.tableDifferenceColumn",defaultMessage:"Difference"},activationRate:{id:"workspaceUsage.benchmark.activationRate",defaultMessage:"User activation rate"},wauPerActivatedUser:{id:"workspaceUsage.benchmark.wauPerActivatedUser",defaultMessage:"Weekly active users per activated user"},weeklyMessagesPerWau:{id:"workspaceUsage.benchmark.weeklyMessagesPerWau",defaultMessage:"Weekly messages per weekly active user"},industryMeanFootnote:{id:"workspaceUsage.benchmark.industryMeanFootnote",defaultMessage:"Industry mean based on data for {month}"},noData:{id:"workspaceUsage.benchmark.noData",defaultMessage:"No benchmark data available"}}),Ea=new Intl.NumberFormat(void 0,{style:"percent",minimumFractionDigits:0,maximumFractionDigits:0}),Aa=new Intl.NumberFormat(void 0,{maximumFractionDigits:0}),Pa=new Intl.NumberFormat(void 0,{style:"percent",minimumFractionDigits:0,maximumFractionDigits:0,signDisplay:"always"}),Oa=new Intl.NumberFormat(void 0,{maximumFractionDigits:0,signDisplay:"always"});function ct(a){return a==null?Oe:Ea.format(a)}function Ga(a){return a==null?Oe:Aa.format(a)}function Wa(a){return a==null?Oe:Pa.format(a)}function za(a){return a==null?Oe:Oa.format(a)}function Nt(a,e){var s;return X({queryKey:["workspace-analytics-benchmark",{workspaceId:a}],queryFn:$(({queryKey:[o,i]})=>Q.safeGet("/accounts/{account_id}/analytics/benchmark",{parameters:{path:{account_id:i.workspaceId}}})),enabled:(s=e==null?void 0:e.enabled)!=null?s:!0})}const Fa=[{key:"activation_rate",label:"activationRate",formatter:ct},{key:"wau_per_activated_user",label:"wauPerActivatedUser",formatter:ct},{key:"total_messages_per_wau",label:"weeklyMessagesPerWau",formatter:Ga}];function Et({currentWorkspaceId:a,workspaceName:e}){var f,C,y,w,b,x;const s=le(),o=Nt(a),i=h.useRef(null),r=(C=(f=o.data)==null?void 0:f.workspace_metrics)!=null?C:null,n=(w=(y=o.data)==null?void 0:y.industry_benchmark_metrics)!=null?w:null,d=o.data?Fa.map(({key:m,label:M,formatter:j})=>{const D=r==null?void 0:r[m],v=n==null?void 0:n[m],L=D!=null&&v!=null?D-v:null;return{key:m,label:M,workspaceDisplay:j(D),industryDisplay:j(v),differenceDisplay:m==="total_messages_per_wau"?za(L):Wa(L),differenceValue:L}}):[],c=e!=null?e:s.formatMessage(ne.tableWorkspaceColumn,{workspaceName:a}),p=(x=(b=r==null?void 0:r.industry)!=null?b:n==null?void 0:n.industry)!=null?x:null,l=p?s.formatMessage(ne.tableIndustryColumnNamed,{industry:p}):s.formatMessage(ne.tableIndustryColumn),k=n!=null&&n.partition_date?s.formatDate(new Date(n.partition_date),{year:"numeric",month:"long"}):Oe;return h.useEffect(()=>{var M,j,D,v;if(!o.isSuccess||!r||d.length===0)return;const m="".concat((M=r.partition_date)!=null?M:"unknown","|").concat((j=r.industry)!=null?j:"unknown");i.current!==m&&(U.logEvent("Workspace Usage: Benchmark Table Rendered",{metric_partition_date:(D=r.partition_date)!=null?D:null,industry_average_date:(v=n==null?void 0:n.partition_date)!=null?v:null,industry:p,activation_rate_metric_displayed:r.activation_rate!=null,activation_rate_industry_average_displayed:(n==null?void 0:n.activation_rate)!=null,wau_per_activated_user_metric_displayed:r.wau_per_activated_user!=null,wau_per_activated_user_industry_average_displayed:(n==null?void 0:n.wau_per_activated_user)!=null,total_messages_per_wau_metric_displayed:r.total_messages_per_wau!=null,total_messages_per_wau_industry_average_displayed:(n==null?void 0:n.total_messages_per_wau)!=null}),i.current=m)},[o.isSuccess,n,p,d.length,r]),o.isLoading?t.jsx("div",{className:"flex min-h-[240px] items-center justify-center",children:t.jsx(Te,{})}):t.jsx("div",{className:"mt-6",children:d.length===0?t.jsx("div",{className:"text-token-text-tertiary text-sm",children:t.jsx(g,u({},ne.noData))}):t.jsxs(t.Fragment,{children:[t.jsxs(P.Root,{className:"border-token-border-medium border-b-[0.5px]",children:[t.jsxs(P.Header,{children:[t.jsx(P.HeaderCell,{className:"text-[13px] font-medium text-nowrap",children:t.jsx(g,u({},ne.tableMetricColumn))}),t.jsx(P.HeaderCell,{className:"text-[13px] font-medium text-nowrap",children:t.jsx(g,F(u({},ne.tableWorkspaceColumn),{values:{workspaceName:c}}))}),t.jsx(P.HeaderCell,{className:"text-[13px] font-medium text-nowrap",children:l}),t.jsx(P.HeaderCell,{className:"text-[13px] font-medium text-nowrap",children:t.jsx(g,u({},ne.tableDifferenceColumn))})]}),t.jsx(P.Body,{children:d.map(m=>t.jsxs(P.Row,{children:[t.jsx(P.Cell,{className:"font-normal",children:t.jsx("div",{className:"leading-tight",children:t.jsx(g,u({},ne[m.label]))})}),t.jsx(P.Cell,{textAlign:"left",className:"font-normal",children:m.workspaceDisplay}),t.jsx(P.Cell,{textAlign:"left",className:"font-normal",children:m.industryDisplay}),t.jsx(P.Cell,{textAlign:"left",className:G("font-normal",typeof m.differenceValue=="number"&&(m.differenceValue>0?"text-green-600":m.differenceValue<0?"text-red-600":"")),children:m.differenceDisplay})]},m.key))})]}),t.jsx("div",{className:"text-token-text-tertiary mt-3 text-sm",children:t.jsx(g,F(u({},ne.industryMeanFootnote),{values:{month:k}}))})]})})}const Z=ue(Mt(new Date,1)),de=new Date;function Be({onLeft:a,leftDisabled:e,onRight:s,rightDisabled:o,children:i,className:r,borderLess:n=!1,surpressChildrenWrapper:d=!1}){return t.jsxs("div",{className:G("flex items-stretch",r),children:[t.jsx(K,{className:G("disabled:text-token-text-quaternary pe-1",!n&&"border-token-border-medium rounded-e-none border-e-0 disabled:opacity-100"),color:n?"ghost":"secondary",size:"small",onClick:a,disabled:e,icon:ra}),d?i:t.jsx("span",{className:G("flex grow items-center justify-center px-1 text-sm",!n&&"border-token-border-medium border-t border-b"),children:i}),t.jsx(K,{className:G("disabled:text-token-text-quaternary ps-1",!n&&"border-token-border-medium rounded-s-none border-s-0 disabled:opacity-100"),color:n?"ghost":"secondary",size:"small",onClick:s,disabled:o,icon:Yt})]})}const Ia=Ma(12);function At({referenceDate:a,setReferenceDate:e,earliestValidDate:s,latestValidDate:o,motionLayoutId:i}){return t.jsxs(t.Fragment,{children:[t.jsx(Be,{className:"mb-2 w-full",borderLess:!0,onLeft:()=>e(Mt(a,1),"subYear"),onRight:()=>e(na(a,1),"addYear"),leftDisabled:We(new Date)>=We(a)+1,rightDisabled:We(new Date)<=We(a),children:R(a,"y")}),t.jsx("div",{className:"grid grid-cols-3 gap-1",children:Ia.map(r=>{const n=ue(ia(a,r)),d=$e(n,a),c=Me(n,s)||_e(n,o);return t.jsxs("button",{disabled:c,onClick:()=>e(n,"select"),className:G("relative h-8 w-full rounded-md",!c&&"hover:bg-token-surface-hover"),children:[d&&t.jsx(_t.div,{layoutId:i,className:"bg-token-main-surface-primary-inverse absolute inset-0 rounded-md",transition:{duration:.15}}),t.jsx("span",{className:G("relative z-10 transition-colors duration-75",d&&"text-token-main-surface-primary delay-75",!d&&"text-token-text-primary delay-0",c&&"text-token-text-quaternary"),children:R(n,"MMM")})]},r)})})]})}function qa({currentWorkspaceId:a,currentTab:e,onClose:s}){var w;const o=le(),[i,r]=h.useState(!1),[n,d]=h.useState(e==="gptsTab"?"gpt":"user"),[c,p]=h.useState("thisMonth"),[l,k]=h.useState(),f=(w=la(b=>{var x;return(x=b.currentWorkspace)==null?void 0:x.name}))!=null?w:a,C=new Date,y=kt(new Date,1);return t.jsxs(wt,{testId:"modal-export",isOpen:!0,onClose:()=>{s(),U.logEvent("Workspace Usage: Export Modal Closed Without Generation")},type:"success",title:t.jsx(g,u({},O.title)),showCloseButton:!0,primaryButton:t.jsx(K,{loading:i,onClick:async()=>{var b,x;r(!0);try{const m=c==="customRange"?{period:(b=l==null?void 0:l.period)!=null?b:Ae.period,period_start:I((x=l==null?void 0:l.referenceDate)!=null?x:Ae.referenceDate)}:Ha(c);U.logEvent("Workspace Usage: Export Generate CSV Clicked",{reportType:n,dateRangeType:c,period:m.period,periodStart:m.period_start});const M=await Q.safeGet("/accounts/{account_id}/reporting",{parameters:{path:{account_id:a},query:F(u({},m),{report_type:n})}});ka({data:M.csv_content,mimeType:"text/csv",filename:o.formatMessage(O.filename,{workspaceName:f,period:m.period,reportType:n,date:m.period_start})})}finally{r(!1)}s()},children:t.jsx(g,u({},O.generateCsvButton))}),children:[t.jsxs(wa,{className:"font-medium",children:[t.jsx(g,u({},O.dataTypeDropdownLabel)),t.jsx(Jt,{triggerClassName:"flex mt-2 border border-token-border-default text-base focus-visible:border-token-border-default w-full justify-between",value:n,onValueChange:b=>d(b),options:[{label:o.formatMessage(O.dataTypeDropdownUsers),value:"user"},{label:o.formatMessage(O.dataTypeDropdownGpts),value:"gpt"}]})]}),t.jsx("div",{className:"mt-6 mb-2 font-medium",children:t.jsx(g,u({},O.dateRangeLabel))}),t.jsxs(Y.Root,{className:"flex flex-col gap-3",value:c,onValueChange:b=>{p(b),U.logEvent("Workspace Usage: Export Date Range Type Changed",{dateRangeType:b})},children:[t.jsx(Y.Item,{value:"thisMonth",label:t.jsx(g,F(u({},O.thisMonthLabel),{values:{date:R(C,"MMMM y")}})),children:t.jsx(Y.Indicator,{})}),t.jsx(Y.Item,{value:"lastMonth",label:t.jsx(g,F(u({},O.lastMonthLabel),{values:{date:R(ie(C,1),"MMMM y")}})),children:t.jsx(Y.Indicator,{})}),t.jsx(Y.Item,{value:"thisWeek",label:t.jsx(g,F(u({},O.thisWeekLabel),{values:{date:"".concat(R(Pe(C),"MMM d")," – ").concat(R(Fe(C),"MMM d"))}})),children:t.jsx(Y.Indicator,{})}),t.jsx(Y.Item,{value:"lastWeek",label:t.jsx(g,F(u({},O.lastWeekLabel),{values:{date:"".concat(R(Pe(y),"MMM d")," – ").concat(R(Fe(y),"MMM d"))}})),children:t.jsx(Y.Indicator,{})}),t.jsx(Y.Item,{value:"customRange",label:t.jsx(Ra,{customRange:l,setCustomRange:k,onClick:()=>p("customRange")}),children:t.jsx(Y.Indicator,{})})]})]})}const Ae={period:"monthly",referenceDate:new Date};function Ra({customRange:a,setCustomRange:e,onClick:s}){const o=le(),i=(a!=null?a:Ae).period,r=(a!=null?a:Ae).referenceDate,n=i==="monthly"?Re(r):Fe(r),d=({period:c,referenceDate:p})=>e((l=Ae)=>{const k=c!=null?c:l.period,f=p!=null?p:l.referenceDate,C=k==="monthly"?ue:Pe,y=_e(f,de)?de:Me(f,Z)?Z:f;return{period:k,referenceDate:C(y)}});return t.jsx(yt,{className:"z-50",alignAgainstAnchor:"start",triggerButton:t.jsxs(K,{size:"small",color:"secondary",contentsFullWidth:!0,onClick:s,children:[a?t.jsx(g,F(u({},O.customRangeDisplay),{values:{start:lt(a.referenceDate),end:lt(n)}})):t.jsx(g,u({},O.chooseMonthOrWeekButton)),t.jsx("div",{className:"grow"}),t.jsx(Zt,{})]}),children:t.jsxs("div",{className:"w-[210px] p-1 text-xs",children:[t.jsx(_a,{className:"mb-4 rounded-md",value:i,onChange:c=>{d({period:c}),U.logEvent("Workspace Usage: Export Custom Period Changed",{period:c})},ariaLabel:o.formatMessage(O.customRangePeriodToggleAria),leftItem:{className:"rounded-md",ariaLabel:o.formatMessage(O.chooseDateMonthlyLabel),label:o.formatMessage(O.chooseDateMonthlyLabel),value:"monthly"},rightItem:{className:"rounded-md",ariaLabel:o.formatMessage(O.chooseDateWeeklyLabel),label:o.formatMessage(O.chooseDateWeeklyLabel),value:"weekly"}}),i==="monthly"?t.jsx(At,{referenceDate:r,setReferenceDate:(c,p)=>{d({referenceDate:c}),U.logEvent("Workspace Usage: Export Custom Reference Date Changed",{period:"monthly",change:p})},earliestValidDate:Z,latestValidDate:de,motionLayoutId:"workspaceUsage.exportModal.customRange.monthHighlight"}):t.jsxs(t.Fragment,{children:[t.jsx(Be,{className:"mb-2 w-full",borderLess:!0,onLeft:()=>{d({referenceDate:ie(r,1)}),U.logEvent("Workspace Usage: Export Custom Reference Date Changed",{period:"weekly",change:"subMonth"})},onRight:()=>{d({referenceDate:Ie(r,1)}),U.logEvent("Workspace Usage: Export Custom Reference Date Changed",{period:"weekly",change:"addMonth"})},leftDisabled:Me(ie(r,1),Z),rightDisabled:_e(Ie(r,1),de),children:R(r,"MMMM y")}),t.jsx(Ba,{referenceDate:r,setReferenceDate:c=>d({referenceDate:c})})]})]})})}const Ba=({referenceDate:a,setReferenceDate:e})=>{const s=ue(a),o=jt({start:s,end:Re(a)});return t.jsx("div",{className:"flex flex-col gap-1",children:o.map(i=>{const r=ca(i,a),n=Me(i,Z)||_e(i,new Date);return t.jsxs("button",{disabled:n,onClick:()=>{e(i),U.logEvent("Workspace Usage: Export Custom Reference Date Changed",{period:"weekly",change:"select"})},className:G("relative h-8 w-full rounded-full",!n&&"hover:bg-token-surface-hover"),children:[r&&t.jsx(_t.div,{layoutId:"workspaceUsage.exportModal.customRange.weekHighlight.".concat(s.toISOString()),className:"bg-token-main-surface-primary-inverse absolute inset-0 rounded-full",transition:{duration:.15}}),t.jsx("div",{className:G("relative z-10 flex w-full justify-around transition-colors duration-75",r&&"text-token-main-surface-primary delay-75",!r&&"text-token-text-primary delay-0"),children:Ct({start:i,end:Fe(i)}).map(d=>t.jsx("div",{className:G("w-0 grow",{"text-token-text-quaternary":!$e(d,a)||_e(d,new Date)||Me(d,Z)}),children:R(d,"d")},d.toISOString()))})]},i.toISOString())})})};function Ha(a){const e=new Date;return a==="thisWeek"||a==="lastWeek"?{period:"weekly",period_start:I(Pe(a==="thisWeek"?e:kt(e,1)))}:{period:"monthly",period_start:I(ue(a==="thisMonth"?e:ie(e,1)))}}const O=ee({title:{id:"workspaceUsage.exportModal.title",defaultMessage:"Export data"},dataTypeDropdownLabel:{id:"workspaceUsage.exportModal.dataTypeDropdownLabel",defaultMessage:"Data type"},dataTypeDropdownUsers:{id:"workspaceUsage.exportModal.dataTypeDropdownUsers",defaultMessage:"Users"},dataTypeDropdownGpts:{id:"workspaceUsage.exportModal.dataTypeDropdownGpts",defaultMessage:"GPTs"},dateRangeLabel:{id:"workspaceUsage.exportModal.dateRangeLabel",defaultMessage:"Date range"},thisMonthLabel:{id:"workspaceUsage.exportModal.thisMonthLabel",defaultMessage:"This month ({date})"},lastMonthLabel:{id:"workspaceUsage.exportModal.lastMonthLabel",defaultMessage:"Last month ({date})"},thisWeekLabel:{id:"workspaceUsage.exportModal.thisWeekLabel",defaultMessage:"This week ({date})"},lastWeekLabel:{id:"workspaceUsage.exportModal.lastWeekLabel",defaultMessage:"Last week ({date})"},chooseMonthOrWeekButton:{id:"workspaceUsage.exportModal.chooseMonthOrWeekButton",defaultMessage:"Choose month or week"},customRangeDisplay:{id:"workspaceUsage.exportModal.customRangeDisplay",defaultMessage:"{start} – {end}"},generateCsvButton:{id:"workspaceUsage.exportModal.generateCsvButton",defaultMessage:"Generate CSV"},customRangePeriodToggleAria:{id:"workspaceUsage.exportModal.customRangePeriodToggleAria",defaultMessage:"Date range period choice"},chooseDateMonthlyLabel:{id:"workspaceUsage.exportModal.chooseDateMonthlyLabel",defaultMessage:"Monthly"},chooseDateWeeklyLabel:{id:"workspaceUsage.exportModal.chooseDateWeeklyLabel",defaultMessage:"Weekly"},filename:{id:"workspaceUsage.exportModal.filename",defaultMessage:"{workspaceName} {period} {reportType} report {date}.csv"}});function Ve({startDate:a,statsSpec:e,data:s,previousData:o}){return t.jsx("div",{className:"border-token-border-default my-6 flex min-h-[80px] w-full rounded-lg border px-2 py-4",children:e.map(({dataKey:i,label:r,helpText:n})=>{const d=s==null?"loading":s[i],c=o==null?"loading":o[i];return t.jsxs("div",{className:"border-token-border-default flex w-0 grow flex-col justify-between border-e px-4 last:me-0 last:border-e-0",children:[t.jsxs("div",{className:"text-token-text-secondary text-sm",children:[t.jsx(g,u({},r)),t.jsx(vt,{}),n&&t.jsx(St,{label:t.jsx("span",{className:"text-token-main-surface-primary font-normal",children:t.jsx(g,u({},n))}),side:"top",customBackgroundColorClassName:"bg-token-main-surface-primary-inverse",children:t.jsx(da,{className:"icon-sm inline"})})]}),t.jsx(Vt,{value:d,previousValue:c,hideTrend:$e(a,new Date),className:"h-[28px]"})]},i)})})}function Ye({handleSearch:a,clientEventSource:e,className:s}){const i=le().formatMessage(Ka.filterListInputLabel),r=h.useCallback(ua(n=>{a(n),U.logEvent("Workspace Usage: Filter Searched",{queryLength:n.length,trigger:"debouncedTyping",source:e})},250),[]);return t.jsx(Xt,{className:G("max-w-[300px]",s),ariaLabel:i,placeholder:i,type:"text",name:"search",icon:ma,iconPosition:"left",saveOnBlur:!0,value:"",onChange:n=>r(n.target.value.trim()),onPressEnter:n=>{var c;const d=(c=n==null?void 0:n.trim())!=null?c:"";a(d),U.logEvent("Workspace Usage: Filter Searched",{queryLength:d.length,trigger:"enterKey",source:e})}})}const Ka=ee({filterListInputLabel:{id:"workspaceUsage.filterListInputLabel",defaultMessage:"Search"}}),dt=20,ut=[{cursor:void 0,queryId:void 0}];function Je({getQueryKey:a,loader:e,initialSortDirection:s,spec:o,getData:i,clientEventSource:r}){var j,D;const[n,d]=h.useState(s),[c,p]=h.useState(ut),[l,k]=h.useState(0),[f,C]=h.useState(),y=X({queryKey:a({order_by_field:n.metric,order_by_direction:n.direction,cursor:(j=c[l])==null?void 0:j.cursor,query_id:(D=c[l])==null?void 0:D.queryId,page_size:dt}),queryFn:({queryKey:v})=>e(v)}),w=y.data?i(y.data):"loading",b=ea(w),x=w==="loading"&&b.current!=="loading",m=x?b.current:w;h.useEffect(()=>{var v,L;(v=y.data)!=null&&v.next_cursor&&((L=y.data)!=null&&L.query_id)&&c.length===l+1&&p(N=>{var S,E;return[...N,{cursor:(S=y.data)==null?void 0:S.next_cursor,queryId:(E=y.data)==null?void 0:E.query_id}]})},[y.data,c,l]),h.useEffect(()=>{f==null&&y.data&&(y.data.total_count!=null?C(Math.ceil(y.data.total_count/dt)):C(1))},[y.data,c,f]);const M=n.direction==="ASC"?Ca:ja;return t.jsxs("div",{className:"mt-4",children:[t.jsxs(P.Root,{className:"border-token-border-medium mb-4 border-b-[0.5px]",children:[t.jsx(P.Header,{children:o.map(({metric:v,label:L,defaultSortDirection:N="ASC"})=>t.jsxs(P.HeaderCell,{className:"text-[13px] font-medium text-nowrap",onClick:()=>{k(0),p(ut),d(S=>{let E;return v===S.metric?E=S.direction==="ASC"?"DESC":"ASC":E=N,U.logEvent("Workspace Usage: Table Sort Clicked",{metric:v,direction:E,source:r}),{direction:E,metric:v}})},children:[L,n.metric===v&&t.jsx(M,{className:"icon text-token-icon-secondary ms-1 inline"})]},v))}),t.jsx(P.Body,{children:m&&m!=="loading"&&m.map((v,L)=>t.jsx(P.Row,{children:o.map(({metric:N,render:S},E)=>t.jsx(P.Cell,{className:G(x&&"pt-0 pb-0 [&]:border-0"),divClassName:G("items-center",E>0&&"text-token-text-secondary",!x&&"min-h-[40px]",x&&"h-0 overflow-hidden"),children:S(v[N],v)},N))},L))})]}),w==="loading"&&t.jsx("div",{className:"flex h-[860px] items-center justify-center",children:t.jsx(Te,{})}),w!=="loading"&&w.length===0&&t.jsx("div",{className:"flex h-[100px] items-center justify-center",children:t.jsx(g,u({},$a.zeroStateMessage))}),t.jsx("div",{className:"flex justify-end",children:t.jsxs(Be,{onLeft:()=>{k(v=>{const L=v-1;return U.logEvent("Workspace Usage: Pagination Clicked",{direction:"left",pageIndex:L,source:r}),L})},leftDisabled:l<=0,onRight:()=>{k(v=>{const L=v+1;return U.logEvent("Workspace Usage: Pagination Clicked",{direction:"right",pageIndex:L,source:r}),L})},rightDisabled:c[l+1]==null,children:[l+1,"/",f!=null?f:t.jsx(Te,{})]})})]})}const $a=ee({zeroStateMessage:{id:"workspaceUsage.table.zeroStateMessage",defaultMessage:"No results found"}});function qe(a,e,s){return X({queryKey:["workspace-analytics-gizmo-stats",{workspaceId:a,startDate:e,gizmoType:s!=null?s:null}],queryFn:$(({queryKey:[o,i]})=>{const r={start_date:i.startDate};return i.gizmoType&&(r.gizmo_type=i.gizmoType),Q.safeGet("/accounts/{account_id}/analytics/gizmo_stats",{parameters:{query:r,path:{account_id:i.workspaceId}}})})})}async function Pt(o){var[a,i]=o,r=i,{workspaceId:e}=r,s=ve(r,["workspaceId"]);return Q.safeGet("/accounts/{account_id}/analytics/gizmo_list",{parameters:{path:{account_id:e},query:s}})}const Ot={direction:"DESC",metric:"active_users"};function Qa({currentWorkspaceId:a,startDate:e}){const[s,o]=h.useState(""),i=I(e),r=h.useCallback(l=>["workspace-analytics-gizmos-list",u({workspaceId:a,start_date:i,filter_query:s,gizmo_type:"gpt"},l)],[i,s,a]),n=qe(a,i,"gpt"),d=I(ie(e,1)),c=qe(a,d,"gpt"),p=$(Pt);return t.jsxs("div",{className:"mb-8",children:[t.jsx(Ve,{startDate:e,data:n.data,previousData:c.data,statsSpec:Ya}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx(Ye,{className:"grow",handleSearch:o,clientEventSource:"gizmoList"}),t.jsx(K,{as:"link",to:"/admin/gpts",size:"small",color:"secondary",children:t.jsxs("div",{className:"flex items-center justify-center gap-1",children:[t.jsx(g,u({},H.manageGPTs)),t.jsx(bt,{className:"icon-sm"})]})})]}),t.jsx(Je,{getQueryKey:r,loader:p,getData:l=>l.gizmos,spec:Gt,initialSortDirection:Ot,clientEventSource:"gizmoList"},"".concat(a,".gpt.").concat(i,".").concat(s))]})}function Va({currentWorkspaceId:a,startDate:e}){const[s,o]=h.useState(""),i=I(e),r=h.useCallback(l=>["workspace-analytics-gizmos-list",u({workspaceId:a,start_date:i,filter_query:s,gizmo_type:"project"},l)],[i,s,a]),n=qe(a,i,"project"),d=I(ie(e,1)),c=qe(a,d,"project"),p=$(Pt);return t.jsxs("div",{className:"mb-8",children:[t.jsx(Ve,{startDate:e,data:n.data,previousData:c.data,statsSpec:Ja}),t.jsx("div",{className:"flex justify-between",children:t.jsx(Ye,{className:"grow",handleSearch:o,clientEventSource:"projectList"})}),t.jsx(Je,{getQueryKey:r,loader:p,getData:l=>l.gizmos,spec:Gt,initialSortDirection:Ot,clientEventSource:"projectList"},"".concat(a,".project.").concat(i,".").concat(s))]})}const H=ee({totalGpts:{id:"workspaceUsage.gizmoList.stats.totalGpts",defaultMessage:"Total GPTs"},gptsCreatedThisMonth:{id:"workspaceUsage.gizmoList.stats.gptsCreatedThisMonth",defaultMessage:"GPTs Created This Month"},gptsActive:{id:"workspaceUsage.gizmoList.stats.gptsActive",defaultMessage:"GPTs active"},gptsActiveHelpText:{id:"workspaceUsage.gizmoList.stats.gptsActiveHelpText",defaultMessage:"GPTs that have sent at lease one message during this month"},nameColumnLabel:{id:"workspaceUsage.gizmoList.tableHeader.name",defaultMessage:"Name"},messagesColumnLabel:{id:"workspaceUsage.gizmoList.tableHeader.messages",defaultMessage:"Total Messages"},creatorNameColumnLabel:{id:"workspaceUsage.gizmoList.tableHeader.creatorName",defaultMessage:"Creator Name"},activeUsersColumnLabel:{id:"workspaceUsage.gizmoList.tableHeader.activeUsersColumnLabel",defaultMessage:"Active Users"},draftFlag:{id:"workspaceUsage.gizmoList.draftFlag",defaultMessage:"Draft"},manageGPTs:{id:"workspaceUsage.gizmoList.manageGPTs",defaultMessage:"Manage GPTs"},totalProjects:{id:"workspaceUsage.gizmoList.stats.totalProjects",defaultMessage:"Total Projects"},projectsCreatedThisMonth:{id:"workspaceUsage.gizmoList.stats.projectsCreatedThisMonth",defaultMessage:"Projects Created This Month"},projectsActive:{id:"workspaceUsage.gizmoList.stats.projectsActive",defaultMessage:"Projects active"},projectsActiveHelpText:{id:"workspaceUsage.gizmoList.stats.projectsActiveHelpText",defaultMessage:"Projects with at least one message during this month"}}),Ya=[{dataKey:"total_gpt_count",label:H.totalGpts},{dataKey:"gpt_created",label:H.gptsCreatedThisMonth},{dataKey:"active_gpt_count",label:H.gptsActive,helpText:H.gptsActiveHelpText}],Ja=[{dataKey:"total_gpt_count",label:H.totalProjects},{dataKey:"gpt_created",label:H.projectsCreatedThisMonth},{dataKey:"active_gpt_count",label:H.projectsActive,helpText:H.projectsActiveHelpText}],Za=new Intl.NumberFormat(void 0,{notation:"compact",maximumSignificantDigits:3});function mt(a){return typeof a=="number"?Za.format(a):null}const Gt=[{metric:"gpt_name",label:t.jsx(g,u({},H.nameColumnLabel)),render:(a,{config_type:e})=>t.jsxs("div",{className:"flex grow items-center justify-between",children:[t.jsx("span",{children:a}),e==="draft"&&t.jsx("span",{className:"text-token-text-secondary text-xs",children:t.jsx(g,u({},H.draftFlag))})]})},{label:t.jsx(g,u({},H.creatorNameColumnLabel)),metric:"creator_name",render:a=>a},{metric:"messages",label:t.jsx(g,u({},H.messagesColumnLabel)),render:mt,defaultSortDirection:"DESC"},{metric:"active_users",label:t.jsx(g,u({},H.activeUsersColumnLabel)),render:mt,defaultSortDirection:"DESC"}];function Xa({startDate:a,setStartDate:e}){return t.jsx(Be,{onLeft:()=>{e(s=>{const o=ie(s,1);return U.logEvent("Workspace Usage: Month Changed",{direction:"left",startDate:I(o)}),o})},leftDisabled:Me(ie(a,1),Z),onRight:()=>{e(s=>{const o=Ie(s,1);return U.logEvent("Workspace Usage: Month Changed",{direction:"right",startDate:I(o)}),o})},rightDisabled:_e(Ie(a,1),de),surpressChildrenWrapper:!0,children:t.jsx(es,{startDate:a,setStartDate:e})})}function es({startDate:a,setStartDate:e}){return t.jsx(yt,{triggerButton:t.jsx(K,{size:"small",color:"secondary",className:"rounded-none border-x-0 border-e-0 px-1",children:R(a,"MMM y")}),children:t.jsx("div",{className:"w-[210px] p-1 text-xs",children:t.jsx(At,{referenceDate:a,setReferenceDate:(s,o)=>{const i=ue(_e(s,de)?de:Me(s,Z)?Z:s);e(i),U.logEvent("Workspace Usage: Month Changed",{direction:o,startDate:I(i)})},earliestValidDate:Z,latestValidDate:de,motionLayoutId:"workspaceUsage.monthSelector.monthHighlight"})})})}function ts({currentWorkspaceId:a,selectedGroup:e,onSelect:s,onClose:o}){var x;const i=le(),[r,n]=h.useState(""),d=ta(r,300),[c,p]=h.useState(0),{groups:l,isLoading:k,isPlaceholderData:f}=Ua({workspaceId:a,currPage:c,groupFilter:d}),C=((x=l==null?void 0:l.items)!=null?x:[]).filter(m=>!m.system_use_case),y=l&&l.total>0?Math.ceil(l.total/He):1;h.useEffect(()=>{if(!l)return;const m=l.total>0?Math.ceil(l.total/He):1,M=Math.max(m-1,0);p(j=>j>M?M:j)},[l]);const w=m=>{var M;s(m),U.logEvent("Workspace Usage: Group Modal Selection",{groupId:(M=m==null?void 0:m.id)!=null?M:null})},b=k&&!l;return t.jsx(wt,{testId:"modal-group-selection",isOpen:!0,onClose:()=>o(),showCloseButton:!0,title:t.jsx(g,u({},V.title)),description:t.jsx(g,F(u({},V.description),{values:{br:t.jsx("br",{})}})),footerContent:t.jsxs("div",{className:"mt-4 flex w-full flex-col gap-3 sm:mt-3 sm:flex-row sm:items-center sm:justify-between",children:[t.jsx(K,{as:"link",to:"/admin/groups",color:"secondary",size:"small",className:"self-start sm:self-auto",onClick:()=>{U.logEvent("Workspace Usage: Group Modal Manage Groups Clicked"),o()},children:t.jsx(g,u({},V.manageGroupsCta))}),t.jsxs("div",{className:"flex items-center gap-2",children:[e&&t.jsx(K,{color:"ghost",size:"small",onClick:()=>w(null),children:t.jsx(g,u({},V.clearSelection))}),t.jsx(K,{color:"secondary",size:"small",onClick:()=>o(),children:t.jsx(g,u({},V.closeButton))})]})]}),children:t.jsxs("div",{className:"flex flex-col gap-4",children:[t.jsx(aa,{value:r,onChange:m=>{const M=m.target.value;n(M),p(0),U.logEvent("Workspace Usage: Group Modal Search Updated",{queryLength:M.length})},placeholder:i.formatMessage(V.searchPlaceholder),inputClassName:"w-full rounded-full! text-sm"}),t.jsx("div",{className:G("border-token-border-subtle max-h-[360px] min-h-[180px] overflow-y-auto rounded-lg border"),children:b?t.jsx("div",{className:"flex h-full items-center justify-center p-6",children:t.jsx(Te,{})}):C.length===0?t.jsxs("div",{className:"flex h-full flex-col items-center justify-center gap-2 p-6 text-center",children:[t.jsx("span",{className:"text-token-text-secondary text-sm font-medium",children:t.jsx(g,u({},V.emptyStateTitle))}),t.jsx("span",{className:"text-token-text-tertiary text-xs",children:t.jsx(g,u({},V.emptyStateSubtitle))})]}):t.jsx("ul",{className:G("divide-token-border-subtle divide-y",f&&"opacity-50"),children:C.map(m=>{var v;const M=(e==null?void 0:e.id)===m.id,j=Number((v=m.num_members)!=null?v:0),D=Number.isFinite(j)?j:0;return t.jsxs("li",{className:G("flex flex-col gap-3 p-4 sm:flex-row sm:items-center sm:justify-between",M&&"bg-token-main-surface-secondary"),children:[t.jsxs("div",{className:"flex flex-1 items-start gap-3",children:[t.jsx(Sa,{group:m}),t.jsxs("div",{children:[t.jsx(Bt,{to:"/admin/groups/".concat(m.id),className:"text-token-text-primary text-sm font-medium hover:underline focus:outline-none focus-visible:underline",onClick:()=>{U.logEvent("Workspace Usage: Group Modal View Group Clicked",{groupId:m.id})},children:m.name}),t.jsx("div",{className:"text-token-text-tertiary text-xs",children:t.jsx(g,F(u({},V.memberCount),{values:{count:D}}))})]})]}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsx(K,{color:M?"primary":"secondary",size:"small",onClick:()=>w({id:m.id,name:m.name}),children:M?t.jsx(g,u({},V.selectedLabel)):t.jsx(g,u({},V.selectLabel))})})]},m.id)})})}),l&&l.total>He&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"text-token-text-tertiary text-xs",children:t.jsx(g,F(u({},V.paginationSummary),{values:{page:c+1,totalPages:y}}))}),t.jsx(sa,{currentPage:c,onChangeIndex:m=>p(m),length:y})]})]})})}const V=ee({title:{id:"workspaceUsage.groupModal.title",defaultMessage:"Select a group"},description:{id:"workspaceUsage.groupModal.description",defaultMessage:"Filter analytics for members within a workspace group."},searchPlaceholder:{id:"workspaceUsage.groupModal.searchPlaceholder",defaultMessage:"Search groups"},emptyStateTitle:{id:"workspaceUsage.groupModal.emptyStateTitle",defaultMessage:"No groups found"},emptyStateSubtitle:{id:"workspaceUsage.groupModal.emptyStateSubtitle",defaultMessage:"Try a different search or create a new group from settings."},memberCount:{id:"workspaceUsage.groupModal.memberCount",defaultMessage:"{count, plural, one {# member} other {# members}}"},selectLabel:{id:"workspaceUsage.groupModal.selectLabel",defaultMessage:"Select"},selectedLabel:{id:"workspaceUsage.groupModal.selectedLabel",defaultMessage:"Selected"},paginationSummary:{id:"workspaceUsage.groupModal.paginationSummary",defaultMessage:"Page {page} of {totalPages}"},manageGroupsCta:{id:"workspaceUsage.groupModal.manageGroupsCta",defaultMessage:"Manage groups"},clearSelection:{id:"workspaceUsage.groupModal.clearSelection",defaultMessage:"Clear selection"},closeButton:{id:"workspaceUsage.groupModal.closeButton",defaultMessage:"Close"}});var Ke,gt;function as(){if(gt)return Ke;gt=1;var a=ga(),e=pa(),s=e(function(o,i,r){a(o,r,i)});return Ke=s,Ke}var ss=as();const os=Ht(ss);async function rs({queryKey:[a,{workspaceId:e,startDate:s,groupId:o}]}){return Q.safeGet("/accounts/{account_id}/analytics/overview",{parameters:{path:{account_id:e},query:{start_date:s,group_id:o!=null?o:void 0}}})}function ns(a,e,s){return X({queryKey:["workspace-analytics-overview",{workspaceId:a,startDate:e,groupId:s}],queryFn:$(rs)})}async function is({queryKey:[a,{workspaceId:e,startDate:s,groupId:o}]}){return Q.safeGet("/accounts/{account_id}/analytics/gizmo_overview",{parameters:{path:{account_id:e},query:{start_date:s,group_id:o!=null?o:void 0}}})}function ls(a,e,s){return X({queryKey:["workspace-analytics-gizmo-overview",{workspaceId:a,startDate:e,groupId:s}],queryFn:$(is)})}async function cs({queryKey:[a,{workspaceId:e,startDate:s,groupId:o}]}){return Q.safeGet("/accounts/{account_id}/analytics/tool_overview",{parameters:{path:{account_id:e},query:{start_date:s,group_id:o!=null?o:void 0}}})}function ds(a,e,s){return X({queryKey:["workspace-analytics-tool-overview",{workspaceId:a,startDate:e,groupId:s}],queryFn:$(cs)})}async function us({queryKey:[a,{workspaceId:e,startDate:s,groupId:o}]}){return Q.safeGet("/accounts/{account_id}/analytics/project_overview",{parameters:{query:{start_date:s,group_id:o!=null?o:void 0},path:{account_id:e}}})}function ms(a,e,s){return X({queryKey:["workspace-analytics-project-overview",{workspaceId:a,startDate:e,groupId:s}],queryFn:$(us)})}async function gs({queryKey:[a,{workspaceId:e,startDate:s,groupId:o}]}){return Q.safeGet("/accounts/{account_id}/analytics/connector_overview",{parameters:{path:{account_id:e},query:{start_date:s,group_id:o!=null?o:void 0}}})}function ps(a,e,s){return X({queryKey:["workspace-analytics-connector-overview",{workspaceId:a,startDate:e,groupId:s}],queryFn:$(gs)})}function Se(a,e,s){return h.useMemo(()=>{if(!e)return;const o=os(e,"date");return Ct({start:a,end:Re(a)}).map(i=>{var d;const r=I(i),n=o[r];return n&&n.total>0?{date:n.date,total:n.total,values:(d=n[s])!=null?d:{}}:{date:r,blank:0}})},[a,e,s])}function hs(a,e,s){var z,Le,ke,we,me,ge,te,J,je,pe,ae,se,oe,re,he,De,Ne,Ee,_,fe,Ze,Xe;const o=I(e),i=ns(a,o,s),r=h.useMemo(()=>{var T,A;return(A=(T=i.data)==null?void 0:T.active_user_data)==null?void 0:A.daily_data.map(({date:Ce,active_users:xe})=>({date:Ce,total:xe,values:{active_users:xe}}))},[(Le=(z=i.data)==null?void 0:z.active_user_data)==null?void 0:Le.daily_data]),n=Se(e,r,"values"),d=Se(e,(we=(ke=i.data)==null?void 0:ke.messages_data)==null?void 0:we.daily_data,"messages_by_model"),c=ls(a,o,s),p=Se(e,(me=c.data)==null?void 0:me.daily_gizmo_messages_data,"messages_by_gpt"),l=ds(a,o,s),k=Se(e,(ge=l.data)==null?void 0:ge.daily_tool_messages_data,"messages_by_tool"),f=ms(a,o,s),C=h.useMemo(()=>{var T,A;return(A=(T=f.data)==null?void 0:T.project_names)!=null?A:null},[f.data]),y=Se(e,(te=f.data)==null?void 0:te.daily_project_messages_data,"messages_by_project"),w=ps(a,o,s),b=Se(e,(J=w.data)==null?void 0:J.daily_connector_messages_data,"messages_by_connector"),x=le(),m=h.useMemo(()=>{var T;return n&&((T=i.data)!=null&&T.active_user_data)?{data:n,metrics:{active_users:{displayName:x.formatMessage(pt.activeUsers)}},monthOverMonth:i.data.active_user_data.month_to_month_data}:"loading"},[n,x,(je=i.data)==null?void 0:je.active_user_data]),M=h.useMemo(()=>{var T;return d&&((T=i.data)!=null&&T.messages_data)?{data:d,metrics:ze(i.data.messages_data.models),monthOverMonth:i.data.messages_data.month_to_month_data}:"loading"},[d,(pe=i.data)==null?void 0:pe.messages_data]),j=h.useMemo(()=>{var et,tt;const T=(tt=(et=i.data)==null?void 0:et.active_user_data)==null?void 0:tt.weekly_data;if(!T)return;const A=new Map,Ce=(()=>{if(T.length>0){const q=Tt(T[0].period_start_date).getDay();if(q>=0&&q<=6)return q}return 0})(),xe=jt({start:Pe(e,{weekStartsOn:Ce}),end:Re(e)},{weekStartsOn:Ce}),It=new Set(xe.map(q=>I(q)));return xe.forEach(q=>{const ye=I(q);A.set(ye,{date:ye,blank:0})}),T.forEach(({period_start_date:q,active_users:ye})=>{It.has(q)&&A.set(q,{date:q,total:ye,values:{active_users:ye}})}),Array.from(A.entries()).sort(([q],[ye])=>q.localeCompare(ye)).map(([,q])=>q)},[(se=(ae=i.data)==null?void 0:ae.active_user_data)==null?void 0:se.weekly_data,e]),D=(re=(oe=i.data)==null?void 0:oe.active_user_data)==null?void 0:re.month_to_month_data,v=h.useMemo(()=>j&&D?{data:j,metrics:{active_users:{displayName:x.formatMessage(pt.weeklyActiveUsers)}},monthOverMonth:D}:"loading",[x,j,D]),L=h.useMemo(()=>{var T,A;return p&&((T=c.data)!=null&&T.metrics)&&((A=c.data)!=null&&A.month_to_month_data)?{data:p,metrics:Object.fromEntries(Object.entries(c.data.metrics).map(([Ce,xe])=>[Ce,{displayName:xe}])),monthOverMonth:c.data.month_to_month_data}:"loading"},[p,(he=c.data)==null?void 0:he.metrics,(De=c.data)==null?void 0:De.month_to_month_data]),N=h.useMemo(()=>{var T,A;return y&&((T=f.data)!=null&&T.project_list)&&((A=f.data)!=null&&A.month_to_month_data)?{data:y,metrics:ze(f.data.project_list,C),monthOverMonth:f.data.month_to_month_data}:"loading"},[y,(Ne=f.data)==null?void 0:Ne.month_to_month_data,(Ee=f.data)==null?void 0:Ee.project_list,C]),S=h.useMemo(()=>{var T,A;return k&&((T=l.data)!=null&&T.tool_list)&&((A=l.data)!=null&&A.month_to_month_data)?{data:k,metrics:ze(l.data.tool_list),monthOverMonth:l.data.month_to_month_data}:"loading"},[k,(_=l.data)==null?void 0:_.month_to_month_data,(fe=l.data)==null?void 0:fe.tool_list]),E=h.useMemo(()=>{var T,A;return b&&((T=w.data)!=null&&T.connector_list)&&((A=w.data)!=null&&A.month_to_month_data)?{data:b,metrics:ze(w.data.connector_list),monthOverMonth:w.data.month_to_month_data}:"loading"},[b,(Ze=w.data)==null?void 0:Ze.connector_list,(Xe=w.data)==null?void 0:Xe.month_to_month_data]);return{dailyActiveUsers:m,weeklyActiveUsers:v,dailyMessages:M,dailyProjectMessages:N,dailyGizmoMessages:L,dailyConnectorMessages:E,dailyToolMessages:S}}function ze(a,e){return Object.entries(a).sort(([,s],[,o])=>s-o).reduce((s,[o,i])=>{var r;return i>0&&(s[o]={displayName:(r=e==null?void 0:e[o])!=null?r:o,total:i}),s},{})}const pt=ee({activeUsers:{id:"workspaceUsage.activeUsersMetric",defaultMessage:"Daily unique active users"},weeklyActiveUsers:{id:"workspaceUsage.weeklyActiveUsersMetric",defaultMessage:"Weekly unique active users"}}),fs=3;function xs(a,e){const s=a.trim().split(/\s+/);return s.length<=e?a:"".concat(s.slice(0,e).join(" "),"...")}function Wt({currentWorkspaceId:a,startDate:e,selectedGroup:s,setSelectedGroup:o,showGroupFilter:i}){var m;const r=le(),n=Qe(),[d,c]=h.useState(!1),p=(m=s==null?void 0:s.id)!=null?m:null,l=hs(a,e,p),k=(s==null?void 0:s.name)&&xs(s.name,fs);h.useEffect(()=>{i||c(!1)},[i]);const f=Ut(n,"3528236309"),C=f.get("show_weekly_active_users_chart",!1),y=f.get("show_connector_overview_chart",!1),w=f.get("show_project_overview_chart",!1),b=h.useCallback(M=>{const j=Tt(M),D=ha(j,6),v=j.getMonth()===D.getMonth(),L=R(j,"MMM d"),N=v?R(D,"d"):R(D,"MMM d");return"".concat(L," – ").concat(N)},[]),x=!fa(e,ue(new Date));return t.jsxs("div",{className:"mt-5",children:[i&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"mb-4 flex justify-end",children:t.jsx(K,{className:G(s&&"max-w-[240px]"),color:"secondary",size:"small",title:s==null?void 0:s.name,onClick:()=>{c(!0),U.logEvent("Workspace Usage: Group Modal Opened")},children:s?t.jsx("span",{className:"truncate",children:t.jsx(g,F(u({},B.groupButtonSelected),{values:{groupName:k}}))}):t.jsx(g,u({},B.groupButton))})}),d&&t.jsx(ts,{currentWorkspaceId:a,selectedGroup:s,onSelect:M=>{var j;o(M),c(!1),U.logEvent("Workspace Usage: Group Selected",{groupId:(j=M==null?void 0:M.id)!=null?j:null})},onClose:()=>{c(!1),U.logEvent("Workspace Usage: Group Modal Closed")}})]}),t.jsx(be,{title:B.activeUsersChartTitle,data:l.dailyActiveUsers,displayMoM:x,clientEventSource:"activeUsers",hideLegend:!0}),C&&t.jsx(be,{title:B.weeklyActiveUsersChartTitle,data:l.weeklyActiveUsers,displayMoM:!1,clientEventSource:"weeklyActiveUsers",hideLegend:!0,hideTopValue:!0,tooltipLabelFormatter:b}),t.jsx(be,{title:B.messagesChartTitle,data:l.dailyMessages,otherGroupLabel:r.formatMessage(B.otherModels),displayMoM:x,clientEventSource:"totalMessages"}),t.jsx(be,{title:B.gptMessagesChartTitle,data:l.dailyGizmoMessages,otherGroupLabel:r.formatMessage(B.otherGizmos),displayMoM:x,clientEventSource:"gizmoMessages"}),t.jsx(be,{title:B.toolMessagesChartTitle,data:l.dailyToolMessages,otherGroupLabel:r.formatMessage(B.otherTools),displayMoM:x,clientEventSource:"toolMessages"}),w&&t.jsx(be,{title:B.projectMessagesChartTitle,data:l.dailyProjectMessages,otherGroupLabel:r.formatMessage(B.otherProjects),displayMoM:x,clientEventSource:"projectMessages"}),y&&t.jsx(be,{title:B.connectorMessagesChartTitle,data:l.dailyConnectorMessages,otherGroupLabel:r.formatMessage(B.otherConnectors),displayMoM:x,clientEventSource:"connectorMessages"})]})}const B=ee({activeUsersChartTitle:{id:"workspaceUsage.overview.activeUsersChartTitle",defaultMessage:"Daily unique active users"},weeklyActiveUsersChartTitle:{id:"workspaceUsage.overview.weeklyActiveUsersChartTitle",defaultMessage:"Weekly unique active users"},messagesChartTitle:{id:"workspaceUsage.overview.messagesChartTitle",defaultMessage:"Total messages sent"},gptMessagesChartTitle:{id:"workspaceUsage.overview.gptMessagesChartTitle",defaultMessage:"GPT messages sent"},projectMessagesChartTitle:{id:"workspaceUsage.overview.projectMessagesChartTitle",defaultMessage:"Project messages sent"},connectorMessagesChartTitle:{id:"workspaceUsage.overview.connectorMessagesChartTitle",defaultMessage:"Connector messages received"},toolMessagesChartTitle:{id:"workspaceUsage.overview.toolMessagesChartTitle",defaultMessage:"Tool messages received"},otherModels:{id:"workspaceUsage.overview.otherModels",defaultMessage:"Other models"},otherGizmos:{id:"workspaceUsage.overview.otherGizmos",defaultMessage:"Other GPTs"},otherProjects:{id:"workspaceUsage.overview.otherProjects",defaultMessage:"Other Projects"},otherConnectors:{id:"workspaceUsage.overview.otherConnectors",defaultMessage:"Other Connectors"},otherTools:{id:"workspaceUsage.overview.otherTools",defaultMessage:"Other Tools"},groupButton:{id:"workspaceUsage.groupButton",defaultMessage:"Filter by Group"},groupButtonSelected:{id:"workspaceUsage.groupButtonSelected",defaultMessage:"Group: {groupName}"}});function ys(s){var o=s,{className:a}=o,e=ve(o,["className"]);return t.jsx(Lt,F(u({},e),{className:a}))}function ht(a,e){return X({queryKey:["workspace-analytics-user-stats",{workspaceId:a,startDate:e}],queryFn:$(({queryKey:[s,o]})=>Q.safeGet("/accounts/{account_id}/analytics/user_stats",{parameters:{query:{start_date:o.startDate},path:{account_id:o.workspaceId}}}))})}async function vs(o){var[a,i]=o,r=i,{workspaceId:e}=r,s=ve(r,["workspaceId"]);const p=s,{view_mode:n,limit:d}=p,c=ve(p,["view_mode","limit"]);return Q.safeGet("/accounts/{account_id}/analytics/user_list",{parameters:{path:{account_id:e},query:c}})}const bs={direction:"DESC",metric:"messages"};async function Ms(o){var[a,i]=o,r=i,{workspaceId:e}=r,s=ve(r,["workspaceId"]);const f=s,{page_size:n,cursor:d,query_id:c,limit:p,view_mode:l}=f,k=ve(f,["page_size","cursor","query_id","limit","view_mode"]);return Q.safeGet("/accounts/{account_id}/analytics/user_list/power_users",{parameters:{path:{account_id:e},query:u({},k)}})}function zt({currentWorkspaceId:a,startDate:e,showAiChampionsButton:s,showConnectorProjectColumns:o}){const i=le(),[r,n]=h.useState(""),[d,c]=h.useState(!1),p=s&&d;h.useEffect(()=>{!s&&d&&c(!1)},[s,d]);const l=Qe(),k=xa(l,"2861925050"),f=h.useCallback((S,E)=>{const z=S!=null?S:E.email;return t.jsxs("div",{className:"group flex items-center gap-2",children:[p&&t.jsx(Lt,{className:"icon-sm"}),t.jsx("span",{children:z})]})},[p]),C=h.useMemo(()=>{const S=k?[...ft,{label:t.jsx(g,u({},W.creditsUsedColumnLabel)),metric:"credits_used",render:Ue,defaultSortDirection:"DESC"}]:ft;return(o?S:S.filter(z=>z.metric!=="project_messages"&&z.metric!=="connector_messages")).map(z=>z.metric==="name"?F(u({},z),{render:f}):z)},[k,f,o]),y=I(e),w=h.useCallback(S=>["workspace-analytics-users-list",F(u({workspaceId:a,start_date:y,filter_query:r},S),{view_mode:p?"power":"default"})],[y,r,a,p]),b=ht(a,y),x=I(ie(e,1)),m=ht(a,x),M=$(vs),j=$(Ms),D=h.useCallback(S=>p?j(S):M(S),[p,M,j]),v=h.useCallback(()=>{s&&c(S=>{const E=!S;return U.logEvent("Workspace Usage: AI Champions Clicked",{source:"userList",state:E?"enabled":"disabled"}),E})},[s]),L=h.useMemo(()=>"".concat(a,".").concat(y,".").concat(r,".").concat(p?"champions":"default"),[p,a,r,y]),N=p?ws:bs;return t.jsxs("div",{className:"mb-8",children:[t.jsx(Ve,{startDate:e,data:b.data,previousData:m.data,statsSpec:_s}),t.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[t.jsx(Ye,{className:"grow md:max-w-xs",handleSearch:n,clientEventSource:"userList"}),t.jsxs("div",{className:"flex items-center gap-2",children:[s&&t.jsx(St,{label:i.formatMessage(W.aiChampionsButtonTooltip),side:"top",children:t.jsx(K,{size:"small",color:d?"primary":"secondary",icon:ys,onClick:v,"aria-pressed":d,className:"group transition-colors",iconClassName:"icon-sm",children:t.jsx(g,u({},W.aiChampionsButtonLabel))})}),t.jsx(K,{as:"link",to:"/admin/members",size:"small",color:"secondary",children:t.jsxs("div",{className:"flex items-center justify-center gap-1",children:[t.jsx(g,u({},W.manageUsersLink)),t.jsx(bt,{className:"icon-sm"})]})})]})]}),t.jsx(Je,{getQueryKey:w,loader:D,getData:S=>S.users,spec:C,initialSortDirection:N,clientEventSource:"userList"},L)]})}const W=ee({purchasedSeats:{id:"workspaceUsage.userList.stats.purchasedSeats",defaultMessage:"Seats purchased"},claimedSeats:{id:"workspaceUsage.userList.stats.claimedSeats",defaultMessage:"Seats enabled"},claimedSeatsHelpText:{id:"workspaceUsage.userList.stats.claimedSeatsHelpText",defaultMessage:"Users who have accepted their invite and logged in"},activeUsers:{id:"workspaceUsage.userList.stats.activeUsers",defaultMessage:"Active users"},activeUsersHelpText:{id:"workspaceUsage.userList.stats.activeUsersHelpText",defaultMessage:"Users who have sent at least one message during this time period"},pendingInvites:{id:"workspaceUsage.userList.stats.pendingInvites",defaultMessage:"Pending invites"},nameColumnLabel:{id:"workspaceUsage.userList.tableHeader.name",defaultMessage:"Name"},emailColumnLabel:{id:"workspaceUsage.userList.tableHeader.email",defaultMessage:"Email"},messagesColumnLabel:{id:"workspaceUsage.userList.tableHeader.messages",defaultMessage:"Total Messages"},gptMessagesColumnLabel:{id:"workspaceUsage.userList.tableHeader.gptMessages",defaultMessage:"GPT Messages"},toolMessagesColumnLabel:{id:"workspaceUsage.userList.tableHeader.toolMessages",defaultMessage:"Tool Messages"},projectMessagesColumnLabel:{id:"workspaceUsage.userList.tableHeader.projectMessages",defaultMessage:"Project Messages"},connectorMessagesColumnLabel:{id:"workspaceUsage.userList.tableHeader.connectorMessages",defaultMessage:"Connector Messages"},creditsUsedColumnLabel:{id:"workspaceUsage.userList.tableHeader.creditsUsed",defaultMessage:"Credits Used"},manageUsersLink:{id:"workspaceUsage.userList.tableHeader.manageUsersLink",defaultMessage:"Manage users"},aiChampionsButtonLabel:{id:"workspaceUsage.userList.aiChampions.buttonLabel",defaultMessage:"Show AI power users"},aiChampionsButtonTooltip:{id:"workspaceUsage.userList.aiChampions.buttonTooltip",defaultMessage:"Your most engaged users: top 20% message senders with 75+ messages per week and 3+ different tools used per month."}}),_s=[{dataKey:"purchased_seats",label:W.purchasedSeats},{dataKey:"claimed_seat",label:W.claimedSeats,helpText:W.claimedSeatsHelpText},{dataKey:"active_users",label:W.activeUsers,helpText:W.activeUsersHelpText},{dataKey:"pending_invites",label:W.pendingInvites}],ks=new Intl.NumberFormat(void 0,{notation:"compact",maximumSignificantDigits:3});function Ue(a){return typeof a=="number"?ks.format(a):null}const ft=[{metric:"name",label:t.jsx(g,u({},W.nameColumnLabel)),render:a=>a},{metric:"email",label:t.jsx(g,u({},W.emailColumnLabel)),render:a=>a},{metric:"messages",label:t.jsx(g,u({},W.messagesColumnLabel)),render:Ue,defaultSortDirection:"DESC"},{label:t.jsx(g,u({},W.gptMessagesColumnLabel)),metric:"gpt_messages",render:Ue,defaultSortDirection:"DESC"},{label:t.jsx(g,u({},W.toolMessagesColumnLabel)),metric:"tool_messages",render:Ue,defaultSortDirection:"DESC"},{label:t.jsx(g,u({},W.projectMessagesColumnLabel)),metric:"project_messages",render:Ue,defaultSortDirection:"DESC"},{label:t.jsx(g,u({},W.connectorMessagesColumnLabel)),metric:"connector_messages",render:Ue,defaultSortDirection:"DESC"}],ws={direction:"DESC",metric:"messages"};function js(a){return Object.keys(a)}var xt;const Cs=ya.div(xt||(xt=it(["flex space-x-4"]))),Ft={overviewTab:Wt,usersTab:zt,gptsTab:Qa,projectsTab:Va,benchmarkTab:Et};function Ss(a){return X({queryKey:["workspace-analytics-last-updated",{workspaceId:a}],queryFn:$(({queryKey:[e,s]})=>Q.safeGet("/accounts/{account_id}/analytics/last_updated_time",{parameters:{path:{account_id:s.workspaceId}}}))})}const Us=js(Ft);function Ts({currentWorkspaceId:a,startDate:e,setStartDate:s,currentTab:o,setTab:i,tabs:r,dataUpdatedDateOverride:n,isDataUpdatedOverrideLoading:d}){var y,w;const c=Ss(a),[p,l]=h.useState(!1),k=n!==void 0,f=k?n:(w=(y=c.data)==null?void 0:y.last_updated_time)!=null?w:null,C=k?d:c.isLoading;return t.jsx(Dt,{title:t.jsx(g,u({},ce.title)),actions:t.jsxs(t.Fragment,{children:[t.jsx(Xa,{startDate:e,setStartDate:s}),t.jsx(K,{className:"ms-2",color:"secondary",size:"small",onClick:()=>{l(!0),U.logEvent("Workspace Usage: Export Modal Opened")},children:t.jsx(g,u({},ce.exportButton))}),p&&t.jsx(qa,{currentWorkspaceId:a,currentTab:o,onClose:()=>l(!1)})]}),tabsHeader:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(Cs,{children:r.map(b=>t.jsx("a",{className:G("pb-2",o===b?"border-token-text-secondary text-token-text-primary border-b font-medium":"text-token-text-tertiary cursor-pointer font-normal"),onClick:()=>{i(b),U.logEvent("Workspace Usage: Tab Clicked",{tab:b})},children:t.jsx(g,u({},ce[b]))},b))}),t.jsxs("div",{className:"text-token-text-tertiary flex items-center gap-1 text-xs",children:[C?t.jsx(Te,{}):t.jsxs("span",{children:[t.jsx(g,u({},ce.dataLastUpdatedLabel)),t.jsx(vt,{}),f?R(new Date(f),"MMM d, yyyy"):t.jsx(g,u({},ce.dataLastUpdatedUnknown))]}),"·",t.jsx(ba,{href:"https://help.openai.com/en/articles/10875114-user-analytics-for-chatgpt-enterprise",className:"hover:text-token-link-hover underline",children:t.jsx(g,u({},ce.helpCenterLinkText))})]})]})})}function Ls(a){"use forget";var De,Ne,Ee;const e=Kt.c(60),{currentWorkspaceId:s}=a,o=le(),i=Qe(),r=va();let n;e[0]!==r?(n=r==null?void 0:r.isFreeWorkspace(),e[0]=r,e[1]=n):n=e[1];const d=!!n;let c,p,l,k,f;if(e[2]!==i){const _=Ut(i,"3528236309");l=_.get("show_group_filter",!1),k=_.get("show_project_tab",!1),c=_.get("show_ai_champions_button",!1),p=_.get("show_connector_project_cols",!1),f=_.get("show_benchmark_tab",!1),e[2]=i,e[3]=c,e[4]=p,e[5]=l,e[6]=k,e[7]=f}else c=e[3],p=e[4],l=e[5],k=e[6],f=e[7];const C=f,[y,w]=h.useState("overviewTab");let b;e[8]===Symbol.for("react.memo_cache_sentinel")?(b=ue(new Date),e[8]=b):b=e[8];const[x,m]=h.useState(b),[M,j]=h.useState(null);let D;e[9]!==C||e[10]!==k?(D=Us.filter(_=>_==="projectsTab"?k:_==="benchmarkTab"?C:!0),e[9]=C,e[10]=k,e[11]=D):D=e[11];const v=D;let L;e[12]!==v||e[13]!==y?(L=v.includes(y)?y:"overviewTab",e[12]=v,e[13]=y,e[14]=L):L=e[14];const N=L,S=N==="benchmarkTab",E=C&&S;let z;e[15]!==E?(z={enabled:E},e[15]=E,e[16]=z):z=e[16];const Le=Nt(s,z),ke=S?(Ee=(Ne=(De=Le.data)==null?void 0:De.workspace_metrics)==null?void 0:Ne.partition_date)!=null?Ee:null:void 0,we=S?Le.isLoading:void 0;let me,ge;e[17]!==l?(me=()=>{l||j(null)},ge=[l],e[17]=l,e[18]=me,e[19]=ge):(me=e[18],ge=e[19]),h.useEffect(me,ge);const te=l?M:null;let J;const je=Ft[N];if(N==="overviewTab"){let _;e[20]!==s||e[21]!==te||e[22]!==l||e[23]!==x?(_=t.jsx(Wt,{currentWorkspaceId:s,startDate:x,selectedGroup:te,setSelectedGroup:j,showGroupFilter:l}),e[20]=s,e[21]=te,e[22]=l,e[23]=x,e[24]=_):_=e[24],J=_}else if(N==="usersTab"){let _;e[25]!==s||e[26]!==c||e[27]!==p||e[28]!==x?(_=t.jsx(zt,{currentWorkspaceId:s,startDate:x,showAiChampionsButton:c,showConnectorProjectColumns:p}),e[25]=s,e[26]=c,e[27]=p,e[28]=x,e[29]=_):_=e[29],J=_}else if(N==="benchmarkTab"){const _=r==null?void 0:r.name;let fe;e[30]!==s||e[31]!==_?(fe=t.jsx(Et,{currentWorkspaceId:s,workspaceName:_}),e[30]=s,e[31]=_,e[32]=fe):fe=e[32],J=fe}else{let _;e[33]!==je||e[34]!==s||e[35]!==te||e[36]!==x?(_=t.jsx(je,{currentWorkspaceId:s,startDate:x,showAiChampionsButton:!1,selectedGroup:te,setSelectedGroup:j,showGroupFilter:!1,showConnectorProjectColumns:!1}),e[33]=je,e[34]=s,e[35]=te,e[36]=x,e[37]=_):_=e[37],J=_}let pe;if(e[38]===Symbol.for("react.memo_cache_sentinel")?(pe=[],e[38]=pe):pe=e[38],h.useEffect(Ds,pe),!r){let _;return e[39]===Symbol.for("react.memo_cache_sentinel")?(_=t.jsx("div",{className:"flex min-h-[60vh] items-center justify-center",children:t.jsx(Te,{})}),e[39]=_):_=e[39],_}let ae;e[40]!==o?(ae=o.formatMessage(ce.title),e[40]=o,e[41]=ae):ae=e[41];let se;e[42]!==ae?(se=t.jsx(oa,{children:t.jsx("title",{children:ae})}),e[42]=ae,e[43]=se):se=e[43];let oe;e[44]!==v||e[45]!==ke||e[46]!==we||e[47]!==s||e[48]!==o||e[49]!==N||e[50]!==d||e[51]!==x?(oe=d?t.jsx(Dt,{title:o.formatMessage(ce.title)}):t.jsx(Ts,{currentWorkspaceId:s,startDate:x,setStartDate:m,currentTab:N,setTab:w,tabs:v,dataUpdatedDateOverride:ke,isDataUpdatedOverrideLoading:we}),e[44]=v,e[45]=ke,e[46]=we,e[47]=s,e[48]=o,e[49]=N,e[50]=d,e[51]=x,e[52]=oe):oe=e[52];let re;e[53]!==d||e[54]!==J?(re=t.jsx(Ta,{children:d?t.jsx(La,{}):J}),e[53]=d,e[54]=J,e[55]=re):re=e[55];let he;return e[56]!==se||e[57]!==oe||e[58]!==re?(he=t.jsxs(t.Fragment,{children:[se,oe,re]}),e[56]=se,e[57]=oe,e[58]=re,e[59]=he):he=e[59],he}function Ds(){U.logPageView(),U.logEvent("Workspace Usage: Page Viewed")}const ce=ee({title:{id:"workspaceUsage.title",defaultMessage:"User Analytics"},overviewTab:{id:"workspaceUsage.overviewTab",defaultMessage:"Overview"},usersTab:{id:"workspaceUsage.usersTab",defaultMessage:"Users"},gptsTab:{id:"workspaceUsage.gptsTab",defaultMessage:"GPTs"},projectsTab:{id:"workspaceUsage.projectsTab",defaultMessage:"Projects"},benchmarkTab:{id:"workspaceUsage.benchmarkTab",defaultMessage:"Benchmark"},creditsTab:{id:"workspaceUsage.creditsTab",defaultMessage:"Credits"},exportButton:{id:"workspaceUsage.exportButton",defaultMessage:"Export..."},dataLastUpdatedLabel:{id:"workspaceUsage.dataLastUpdatedLabel",defaultMessage:"Data updated"},dataLastUpdatedUnknown:{id:"workspaceUsage.dataLastUpdatedUnknown",defaultMessage:"Unknown"},helpCenterLinkText:{id:"workspaceUsage.helpCenterLinkText",defaultMessage:"Learn more about analytics"}}),So=$t(function(){const e=Da();return Na(),t.jsx(Ls,u({},e))});export{So as default};
//# sourceMappingURL=dobiv20u3g0b3g9l.js.map
