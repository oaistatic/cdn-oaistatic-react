var D=Object.defineProperty,O=Object.defineProperties;var $=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var k=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var T=(t,e,r)=>e in t?D(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,_=(t,e)=>{for(var r in e||(e={}))k.call(e,r)&&T(t,r,e[r]);if(I)for(var r of I(e))N.call(e,r)&&T(t,r,e[r]);return t},w=(t,e)=>O(t,$(e));var p=(t,e,r)=>T(t,typeof e!="symbol"?e+"":e,r);import{r as R,b as j,q as Q,j as z}from"./mw35uwhq4g8r9eam.js";import{ap as x,na as U}from"./g2euln7v5pbm31qa.js";import{bd as h,u8 as d,e as V,f as W,L as S,D as b,cm as P,bT as L,fH as X,j1 as Y,e5 as J}from"./d0xa318sl7ywi0za.js";const C={width:1,height:1};function Et(t,e,r=C){if(!t||!e)return null;const{width:n,height:s}=e;if(n===0||s===0)return null;const o=n/s,a=r.width/r.height;if(Math.abs(o-a)<1e-6)return null;let i=50,l=50;const{center_x_percent:c,center_y_percent:m}=t;if(o>a){const g=o-a;i=(c*o-a/2)/g*100,i=Math.max(0,Math.min(100,i))}else{const g=1/o,E=1/a,v=g-E;l=(m*g-E/2)/v*100,l=Math.max(0,Math.min(100,l))}return"".concat(i.toFixed(1),"% ").concat(l.toFixed(1),"%")}var M=(t=>(t.SCALLION="scallion",t.SCALLION_RC="scallion-rc",t.SCALLION_RC0="scallion-rc0",t.SCALLION_RC1="scallion-rc1",t.SCALLION_RC2="scallion-rc2",t.CHIVE="chive",t.CHIVE_RC="chive-rc",t.CHIVE_RC0="chive-rc0",t.CHIVE_RC1="chive-rc1",t))(M||{});const Tt=async({queryKey:t})=>{const[e,r]=t;if(r.length<2)return[];const n=new URLSearchParams({query_fragment:r});return h.get("".concat(d,"/suggestions?").concat(n.toString())).then(s=>s.suggestions).catch(()=>[])};function K(t){var e;return{settings_overrides:{search_results:{search_engines:t.use_labrador?{bing:{}}:{bing:{ranking_model:null,rrf_alpha:1,rrf_input_threshold:0},labrador:null}},model_response:{enable_multimodal:t.show_image_to_model,completion_model:t.completion_model&&t.completion_model!=="production"?{model:t.completion_model,clip_model:"@mmapi",direct_connection_urls:[]}:{}}},base_config:(e=t.base_config)!=null?e:M.SCALLION,eval_preset:t.eval_preset}}async function wt({threadId:t,threadUserId:e,routePrefix:r}){let n=d;r&&(n=n+r);const s=new URL("".concat(n,"/threads/").concat(t,"/with_turns"));return e&&s.searchParams.append("thread_user_id",e),await h.get(s.toString())}async function yt(t){const e=new FormData;return e.append("feedback",JSON.stringify({thread_id:t.threadId,turn_index:t.turnIndex,rating:t.rating,search_query:t.searchQuery,text:t.text,model_instructions:t.modelInstructions,tags:t.tags,user_email:t.userEmail})),t.screenshot&&e.append("file",new File([t.screenshot],"screenshot.jpeg",{type:"image/jpeg"})),h.post("".concat(d,"/feedback/turns"),e)}async function G(t,e){return h.post("".concat(d,"/threads/").concat(t,"/turns/").concat(e,"/images_try_hard"))}async function Rt(t){const e=new FormData;return t.screenshot&&e.append("file",new File([t.screenshot],"screenshot.jpeg",{type:"image/jpeg"})),e.append("feedback",JSON.stringify({thread_id:t.threadId,url:t.url,title:t.title,snippet:t.snippet,rating:t.rating,search_query:t.searchQuery,text:t.text,tags:t.tags,user_email:t.userEmail,turn_index:t.turnIndex})),h.post("".concat(d,"/feedback/links"),e)}function It(t){const e=K(t.agentSettingsOverrides);h.post("".concat(d,"/prefetch"),w(_({},e),{turn:{user_query:t.query},user_metadata:t.metadata}))}class q extends Error{constructor(e){super(e),this.name="TurnError"}}function Z(t){var e;return t?((e=t.model_response)==null?void 0:e.text)!=null&&t.model_response.text.length>0:!1}function y(t){return t.execution_status==="fatal_system_error"}function B(t){return t.execution_status==="in_progress"||t.execution_status===null}function tt(t){return u(e=>{var r,n;return(n=(r=e.thread)==null?void 0:r.turns.map(s=>t.reduce((o,a)=>(o[a]=s[a],o),{})))!=null?n:[]},(e,r)=>{if(e.length!==r.length)return!1;for(let n=0;n<e.length;n++)if(!L(e[n],r[n]))return!1;return!0})}function et(){return u(t=>{var e;return P((e=t.thread)==null?void 0:e.turns.flatMap(r=>{var n;return(n=r.model_response)==null?void 0:n.citations}))},L)}const A={thread:null,error:void 0},u=V(W(()=>_({},A))),rt=S(()=>{b.addError(new q("got updateTurn with no current thread"))},1e3),nt=S(t=>{b.addError(new q("turn not found"),{turnIndex:t})},1e3),f={threadId:t=>{var e,r;return(r=(e=t.thread)==null?void 0:e.id)!=null?r:null},turns:t=>{var e,r;return(r=(e=t.thread)==null?void 0:e.turns)!=null?r:[]},turnCitations:t=>e=>{var r,n,s;return(s=(n=(r=e.thread)==null?void 0:r.turns[t].model_response)==null?void 0:n.citations)!=null?s:[]},hasResponse:t=>{var e;return Z((e=t.thread)==null?void 0:e.turns[0])},firstTurn:t=>t.thread!=null?t.thread.turns[0]:void 0,lastTurn:t=>t.thread!=null?t.thread.turns[t.thread.turns.length-1]:void 0,numTurns:t=>{var e,r;return(r=(e=t.thread)==null?void 0:e.turns.length)!=null?r:0},isLastTurnStreaming:t=>{const e=t.thread!=null?t.thread.turns[t.thread.turns.length-1]:void 0;return e!=null&&B(e)},hasModelResponseText:t=>{var r,n;const e=(r=t.thread)==null?void 0:r.turns[0];return((n=e==null?void 0:e.model_response)==null?void 0:n.text)!=null},hasFirstTurnError:t=>{var r;const e=(r=t.thread)==null?void 0:r.turns[0];return!!e&&y(e)},hasTurnError:t=>{var e,r;return(r=(e=t.thread)==null?void 0:e.turns.some(y))!=null?r:!1},threadError:t=>t.error,__deprecated_sportsWidget:t=>{var r,n;const e=(r=t.thread)==null?void 0:r.turns[0];return(n=e==null?void 0:e.sports_widget)!=null?n:null}},xt={appendTurn(t,e,r){u.setState(n=>{var s;((s=n.thread)==null?void 0:s.id)!==t&&(r==null||r(t),n.thread={id:t,turns:[]}),n.thread.turns.push(e)})},updateTurn(t,e){u.setState(r=>{const n=r.thread;if(!n){rt();return}const s=n.turns[t];if(!s){nt(t);return}e(s)})},clearThread(){u.setState(()=>_({},A))},setError(t){u.setState(e=>{e.error=t})},setThread(t,e){u.setState(r=>{r.thread={id:t,turns:e}})}};class st{constructor(){p(this,"queue",[]);p(this,"attempted",new Set);p(this,"isProcessing",!1)}enqueue(e){this.queue.push(e),this._processQueue()}async _processQueue(){if(!this.isProcessing){for(this.isProcessing=!0;this.queue.length>0;)try{const e=this.queue.shift();if(!e)continue;await this._preload(e)}catch(e){}this.isProcessing=!1}}_preload(e){return new Promise(r=>{this.attempted.has(e)&&r();const n=new Image;n.onload=()=>{this.attempted.add(e),r()},n.onerror=()=>{this.attempted.add(e),r()},n.src=e})}}const ot=new st;function at(t){const e=R.useRef(t);return X(e.current,t)||(e.current=t),e.current}function it(t,{enabled:e=!0}={}){const r=at(t);R.useEffect(()=>{if(!e||"connection"in navigator&&navigator.connection.type==="cellular")return;const s=setTimeout(()=>{r.forEach(o=>{o&&ot.enqueue(o)})},1e3);return()=>{clearTimeout(s)}},[e,r])}function St(){const{imageResults:t}=ct();it([...t.map(e=>H(e))])}const ut=Y((...t)=>G(...t),5e3);function ct(t=!1){var i,l;const e=tt(["image_results","image_try_hard_status","execution_status"]),r=u(f.threadId),n=P(e.toReversed().flatMap(c=>{var m;return(m=c.image_results)==null?void 0:m.entries})).map(c=>w(_({},c),{thumbnail_url:c.thumbnail_url.replace(/^http:\/\//,"https://"),content_url:c.content_url.replace(/^http:\/\//,"https://")})),s=u(f.hasModelResponseText),o=e.some(c=>y(c));let a=n.length===0&&!s;return r!=null&&t&&!a&&n.length===0&&((i=e[0])==null?void 0:i.image_try_hard_status)==="not_attempted"&&(ut(r,0),a=!0),t&&((l=e[0])==null?void 0:l.image_try_hard_status)==="in_progress"&&(a=!0),{imageResults:n,isLoading:a,isErrored:n.length===0&&o}}function bt(){const t=et(),e=u(f.hasTurnError),r=u(f.hasModelResponseText),n=U(t);return{imageResults:n,isLoading:n.length===0&&!r,isErrored:n.length===0&&e}}function lt(t,e){return Q({queryKey:["downloadImage",{imageUrl:t,downloadType:e}],queryFn:()=>new Promise((r,n)=>{if(!t){n();return}const s=performance.now(),o=new Image;o.onload=()=>{x.logEvent("Search Tool Image Download Latency",{type:e,image_url:t,latency_ms:Math.round(performance.now()-s),error:!1}),r({width:o.width,height:o.height})},o.onerror=()=>{x.logEvent("Search Tool Image Download Latency",{type:e,image_url:t,latency_ms:Math.round(performance.now()-s),error:!0}),n()},o.src=t}),enabled:!!t})}function Pt(t,e){return j(lt(t,e))}const ht=474,F={width:ht,aspectRatio:C};function H(t,e=F){if(t==null||t.is_proxied_image)return;const r=new URL(t.thumbnail_url);if(r.hostname.indexOf(".bing.")===-1)return t.thumbnail_url;const{width:n,height:s,aspectRatio:o}=e;let a=Math.min(n,t.content_size.width),i=s!=null?s:Math.floor(o?a*(o.height/o.width):a*t.content_size.height/t.content_size.width);return!s&&o&&o.width===o.height&&(a=i=Math.min(a,i)),r.searchParams.delete("pid"),r.searchParams.set("w",a.toString()),r.searchParams.set("h",i.toString()),r.searchParams.set("c","7"),r.searchParams.set("p","0"),r.toString()}function Lt(t,e=F){return R.useMemo(()=>H(t,e),[t,e])}const dt={type:"spring",stiffness:700,damping:82};function Ct({children:t,className:e}){return z.jsx(J.div,{animate:{opacity:1},initial:{width:"100%",height:"100%",translateX:0,translateY:0,opacity:0},whileHover:{width:"103%",height:"103%",translateX:"-1.5%",translateY:"-1.5%"},transition:dt,className:e,children:t})}export{C as A,M as B,ht as D,Ct as I,f as T,ct as a,Pt as b,u as c,y as d,Rt as e,Tt as f,lt as g,tt as h,B as i,St as j,xt as k,wt as l,Lt as m,dt as n,Et as o,yt as p,It as r,bt as u};
//# sourceMappingURL=i1lnixtvuwzfguvz.js.map
