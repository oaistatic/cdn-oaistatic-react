var E=Object.defineProperty,L=Object.defineProperties;var Z=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var G=(s,e,t)=>e in s?E(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,q=(s,e)=>{for(var t in e||(e={}))z.call(e,t)&&G(s,t,e[t]);if(A)for(var t of A(e))B.call(e,t)&&G(s,t,e[t]);return s},g=(s,e)=>L(s,Z(e));import{b as w,w as W,c as F,u as h,i as K,h as P}from"./mw35uwhq4g8r9eam.js";import{rt as M,R as m,ru as f,rv as R,p as v,qV as b,rw as U}from"./d0xa318sl7ywi0za.js";const k=(s,e)=>[s,"role-metadata",e],$=(s,e)=>[s,"role-credit-recommendation",e],V=({workspaceId:s,roleId:e})=>w({queryKey:[s,"role",e],enabled:!!e,queryFn:async()=>(await m.safeGet("/rbac/workspace/{workspace_id}/roles/{role_id}",{parameters:{query:{account_id:s,consistency:"strong"},path:{workspace_id:s,role_id:e}}})).role,staleTime:1e3*60*5}),J=({workspaceId:s,enabled:e=!0})=>w({queryKey:[s,"roles"],queryFn:()=>m.safeGet("/rbac/workspace/{workspace_id}/roles",{parameters:{query:{account_id:s,consistency:"strong"},path:{workspace_id:s}}}),enabled:e}),X=({workspaceId:s,roleId:e})=>w({queryKey:[s,e,"role-groups"],queryFn:async()=>(await m.safeGet("/rbac/workspace/{workspace_id}/roles/{role_id}/principals",{parameters:{query:{account_id:s,consistency:"strong"},path:{workspace_id:s,role_id:e}}})).groups}),Y=({accountId:s,workspaceId:e,roleId:t,enabled:a=!0})=>{var l;const{data:n,isLoading:r,isFetching:i,error:c,refetch:o}=w({queryKey:f(e,t),queryFn:()=>m.safeGet("/rbac/workspace/{workspace_id}/roles/{role_id}/connectors",{parameters:{query:{account_id:s,consistency:"strong"},path:{workspace_id:e,role_id:t}}}),enabled:a});return{connectorsWithPermission:new Map((l=n==null?void 0:n.connectors_with_permissions)==null?void 0:l.map(y=>[y.connector.id,y])),isLoading:r,isFetching:i,error:c,refetch:o}},x=({workspaceId:s,roleId:e,enabled:t=!0})=>w({queryKey:k(s,e),enabled:t&&!!e,queryFn:()=>m.safeGet("/rbac/workspace/{workspace_id}/roles/{role_id}/metadata",{parameters:{query:{account_id:s},path:{workspace_id:s,role_id:e}}})}),I=({workspaceId:s,roleId:e,enabled:t=!0})=>w({queryKey:$(s,e),enabled:t&&!!e,queryFn:()=>m.safeGet("/rbac/workspace/{workspace_id}/roles/{role_id}/credit-recommendation",{parameters:{query:{account_id:s},path:{workspace_id:s,role_id:e}}})}),ee=s=>{"use forget";const e=F.c(10),{workspaceId:t,connectorId:a,enabled:n}=s,r=n===void 0?!0:n;let i;e[0]!==a||e[1]!==t?(i=R(t,a),e[0]=a,e[1]=t,e[2]=i):i=e[2];let c;e[3]!==a||e[4]!==t?(c=()=>m.safeGet("/rbac/workspace/{workspace_id}/connector/{connector_id}/roles",{parameters:{query:{account_id:t,consistency:"strong"},path:{workspace_id:t,connector_id:a}}}),e[3]=a,e[4]=t,e[5]=c):c=e[5];let o;return e[6]!==r||e[7]!==i||e[8]!==c?(o={queryKey:i,queryFn:c,enabled:r},e[6]=r,e[7]=i,e[8]=c,e[9]=o):o=e[9],w(o)},se=s=>{"use forget";const e=F.c(4),{workspaceId:t,connectorId:a}=s,n=h();let r;return e[0]!==a||e[1]!==n||e[2]!==t?(r=()=>n.invalidateQueries({queryKey:R(t,a)}),e[0]=a,e[1]=n,e[2]=t,e[3]=r):r=e[3],r},O=({workspaceId:s,roleId:e,connectorId:t})=>m.safeGet("/rbac/workspace/{workspace_id}/roles/{role_id}/connectors/{connector_id}",{parameters:{query:{account_id:s,consistency:"strong"},path:{workspace_id:s,role_id:e,connector_id:t}}}),te=({workspaceId:s,roleId:e,connectorIds:t,enabled:a=!0})=>W({queries:t.map(n=>({queryKey:M(s,n,e),queryFn:async()=>{var r,i,c;try{return await O({workspaceId:s,connectorId:n,roleId:e})}catch(o){if(((c=(i=o==null?void 0:o.status)!=null?i:(r=o==null?void 0:o.response)==null?void 0:r.status)!=null?c:o==null?void 0:o.code)===404)return{permissions:[]};throw o}},enabled:a})),combine:n=>{const r={};return n.forEach((i,c)=>{const o=t[c];i.data?r[o]=i.data.permissions:r[o]=[]}),{results:r,isLoading:n.some(i=>i.isLoading),isFetching:n.some(i=>i.isFetching),isError:n.some(i=>{var c;return i.isError&&((c=i.error)==null?void 0:c.status)!==404}),errors:n.map(i=>i.error).filter(i=>(i==null?void 0:i.status)!==404)}}}),re=s=>{"use forget";const e=F.c(22),{workspaceId:t,currentRoles:a,bootstrapResources:n}=s,r=h(),i=v(),c=P();let o;e[0]!==n||e[1]!==t?(o=Q=>m.safePost("/rbac/workspace/{workspace_id}/roles",{parameters:{query:{account_id:t},path:{workspace_id:t}},requestBody:{role_name:Q.name,description:Q.description,bootstrap_resources:n}}),e[0]=n,e[1]=t,e[2]=o):o=e[2];let u;e[3]!==a||e[4]!==r||e[5]!==t?(u=Q=>{const{name:T,description:C}=Q;r.cancelQueries({queryKey:[t,"roles"]});const S=a;return r.setQueryData([t,"roles"],D=>(D||(D={data:[],object:"list",has_more:!1}),g(q({},D),{data:[{id:"new",name:T,permissions:[],resource_type:"workspace",predefined_role:!1,description:C,created_at:Date.now(),updated_at:Date.now(),created_by:"system",metadata:{}},...D.data]}))),{previousRoles:S}},e[3]=a,e[4]=r,e[5]=t,e[6]=u):u=e[6];let l;e[7]!==c||e[8]!==r||e[9]!==i||e[10]!==t?(l=(Q,T,C)=>{r.setQueryData([t,"roles"],C==null?void 0:C.previousRoles),r.invalidateQueries({refetchType:"all",queryKey:[t,"roles"]}),Q.message==="Role with this name already exists."&&i.warning(c.formatMessage({id:"Hn9Qxu",defaultMessage:"Role with this name already exists"}),{duration:1})},e[7]=c,e[8]=r,e[9]=i,e[10]=t,e[11]=l):l=e[11];let y;e[12]!==r||e[13]!==t?(y=()=>{r.invalidateQueries({refetchType:"all",queryKey:[t,"roles"]}),r.invalidateQueries({refetchType:"all",queryKey:f(t)})},e[12]=r,e[13]=t,e[14]=y):y=e[14];let d;e[15]!==o||e[16]!==u||e[17]!==l||e[18]!==y?(d={mutationFn:o,onMutate:u,onError:l,onSuccess:y},e[15]=o,e[16]=u,e[17]=l,e[18]=y,e[19]=d):d=e[19];const{mutateAsync:p}=K(d);let _;return e[20]!==p?(_={createRole:p},e[20]=p,e[21]=_):_=e[21],_},ae=s=>{"use forget";const e=F.c(10),{workspaceId:t}=s,a=h();let n;e[0]!==t?(n=async u=>await m.safeDelete("/rbac/workspace/{workspace_id}/roles/{role_id}",{parameters:{query:{account_id:t},path:{workspace_id:t,role_id:u}}}),e[0]=t,e[1]=n):n=e[1];let r;e[2]!==a||e[3]!==t?(r=()=>{a.invalidateQueries({refetchType:"all",queryKey:[t,"roles"]}),a.invalidateQueries({refetchType:"all",queryKey:f(t)})},e[2]=a,e[3]=t,e[4]=r):r=e[4];let i;e[5]!==n||e[6]!==r?(i={mutationFn:n,onSuccess:r},e[5]=n,e[6]=r,e[7]=i):i=e[7];const{mutateAsync:c}=K(i);let o;return e[8]!==c?(o={deleteRole:c},e[8]=c,e[9]=o):o=e[9],o},ie=({workspaceId:s})=>{const e=h(),t=v(),a=P(),{mutateAsync:n}=K({mutationFn:async r=>(r.permissions.includes(b.SearchAccess)||(r.permissions=r.permissions.filter(i=>i!==b.AgentModeAccess&&i!==b.DeepResearchAccess)),r.permissions.includes(b.GPT5ThinkingAccess)||r.permissions.includes(b.GPT5ThinkingMiniAccess)||r.permissions.push(b.GPT5ThinkingMiniAccess),await m.safePatch("/rbac/workspace/{workspace_id}/roles/{role_id}",{parameters:{query:{account_id:s},path:{workspace_id:s,role_id:r.id}},requestBody:{role_name:r.name,description:r.description,permissions:r.permissions}})),onMutate:({id:r,name:i,permissions:c})=>{const o=e.getQueryData([s,"role",r]);return e.setQueryData([s,"role",r],u=>g(q({},u),{name:i,permissions:c})),{previousRoles:o}},onError:(r,i,c)=>{e.setQueryData([s,"role",i.id],c==null?void 0:c.previousRoles),r.message==="Role with this name already exists."?t.warning(a.formatMessage({id:"EDzkz/",defaultMessage:"Role with this name already exists"}),{duration:1}):t.danger(a.formatMessage({id:"ezIZZO",defaultMessage:"Failed to update permission"}),{duration:1})},onSuccess:()=>{e.invalidateQueries({refetchType:"all",queryKey:[s,"roles"]}),t.success(a.formatMessage({id:"L59KWu",defaultMessage:"Successfully updated permission"}),{duration:1})}});return{updateRole:n}},ne=s=>{"use forget";const e=F.c(17),{workspaceId:t,roleId:a}=s,n=h();let r;e[0]!==a||e[1]!==t?(r=k(t,a),e[0]=a,e[1]=t,e[2]=r):r=e[2];const i=r;let c;e[3]!==a||e[4]!==t?(c=async p=>await m.safePut("/rbac/workspace/{workspace_id}/roles/{role_id}/metadata",{parameters:{query:{account_id:t},path:{workspace_id:t,role_id:a}},requestBody:p}),e[3]=a,e[4]=t,e[5]=c):c=e[5];let o,u;e[6]!==n||e[7]!==i?(o=p=>{n.setQueryData(i,_=>{var Q;return _?!_.metadata||!p.metadata?g(q({},_),{metadata:(Q=p.metadata)!=null?Q:null}):g(q({},_),{metadata:g(q({},_.metadata),{soft_alert_credit_limit:p.metadata.soft_alert_credit_limit,hard_cap_credit_limit:p.metadata.hard_cap_credit_limit})}):p})},u=()=>{n.invalidateQueries({queryKey:i})},e[6]=n,e[7]=i,e[8]=o,e[9]=u):(o=e[8],u=e[9]);let l;e[10]!==c||e[11]!==o||e[12]!==u?(l={mutationFn:c,onSuccess:o,onSettled:u},e[10]=c,e[11]=o,e[12]=u,e[13]=l):l=e[13];const y=K(l);let d;return e[14]!==y.isPending||e[15]!==y.mutateAsync?(d={upsertRoleMetadata:y.mutateAsync,isPending:y.isPending},e[14]=y.isPending,e[15]=y.mutateAsync,e[16]=d):d=e[16],d},oe=({workspaceId:s,roleId:e})=>{const t=h(),{mutateAsync:a}=K({mutationFn:async({id:n})=>await m.safePost("/rbac/workspace/{workspace_id}/role-assignments",{parameters:{query:{account_id:s},path:{workspace_id:s}},requestBody:{role_id:e,principal_id:n,principal_type:"group"}}),onSuccess:(n,r)=>{const i=[s,e,"role-groups"];t.setQueryData(i,c=>{var o,u;return[...c,{id:r.id,name:(o=r.name)!=null?o:"",num_members:(u=r.num_members)!=null?u:0,created_time:new Date().toDateString()}]}),t.invalidateQueries({refetchType:"all",queryKey:i})}});return{assignGroup:a}},ce=({workspaceId:s,roleId:e})=>{const t=h(),{mutateAsync:a}=K({mutationFn:async n=>await m.safeDelete("/rbac/workspace/{workspace_id}/role-assignments",{parameters:{query:{account_id:s,role_id:e,principal_id:n,principal_type:"group"},path:{workspace_id:s}}}),onSuccess:(n,r)=>{const i=[s,e,"role-groups"];t.setQueryData(i,c=>c?c.filter(o=>o.id!==r):[]),t.invalidateQueries({refetchType:"all",queryKey:i})}});return{unassignGroup:a}},ue=({workspaceId:s,roleId:e,showToast:t=!0})=>{const a=h(),n=v(),r=P(),{mutateAsync:i,isPending:c,variables:o}=K({mutationFn:async u=>await m.safePatch("/rbac/workspace/{workspace_id}/roles/{role_id}/connectors/{connector_id}",{parameters:{query:{account_id:s},path:{workspace_id:s,role_id:e,connector_id:u.connectorId}},requestBody:{permissions:u.permissions}}),onMutate:({connectorId:u,permissions:l})=>{a.cancelQueries({queryKey:f(s,e)}),a.cancelQueries({queryKey:R(s,u)}),a.cancelQueries({queryKey:M(s,u,e)});const y=a.getQueryData(f(s,e));return a.setQueryData(f(s,e),d=>g(q({},d),{connectors_with_permissions:d==null?void 0:d.connectors_with_permissions.map(p=>p.connector.id===u?g(q({},p),{permissions:l}):p)})),{previousConnectors:y}},onError:(u,l,y)=>{a.setQueryData(f(s,e),y==null?void 0:y.previousConnectors),t&&n.danger(r.formatMessage({id:"ezIZZO",defaultMessage:"Failed to update permission"}),{duration:1})},onSuccess:(u,l)=>{a.invalidateQueries({refetchType:"all",queryKey:f(s,e)}),a.invalidateQueries({refetchType:"all",queryKey:R(s,l.connectorId)}),a.invalidateQueries({refetchType:"all",queryKey:M(s,l.connectorId,e)}),t&&n.success(r.formatMessage({id:"L59KWu",defaultMessage:"Successfully updated permission"}),{duration:1})}});return{updateRoleConnectorPermission:i,isPending:c,variables:o}},le=({workspaceId:s,connectorId:e,showToast:t=!0})=>{const a=h(),n=v(),r=P(),{mutateAsync:i,isPending:c,variables:o}=K({mutationFn:async u=>await m.safePatch("/rbac/workspace/{workspace_id}/roles/{role_id}/connectors/{connector_id}",{parameters:{query:{account_id:s},path:{workspace_id:s,role_id:u.roleId,connector_id:e}},requestBody:{permissions:u.permissions}}),onMutate:({roleId:u,permissions:l})=>{a.cancelQueries({queryKey:R(s,e)}),a.cancelQueries({queryKey:f(s,u)}),a.cancelQueries({queryKey:M(s,e,u)});const y=a.getQueryData(R(s,e));return a.setQueryData(R(s,e),d=>{var p;return g(q({},d),{roles_with_permissions:(p=d==null?void 0:d.roles_with_permissions)==null?void 0:p.map(_=>_.role.id===u?g(q({},_),{connector_permissions:l}):_)})}),{previousRoles:y}},onError:(u,l,y)=>{a.setQueryData(R(s,e),y==null?void 0:y.previousRoles),t&&n.danger(r.formatMessage({id:"ezIZZO",defaultMessage:"Failed to update permission"}),{duration:1})},onSuccess:(u,l)=>{a.invalidateQueries({refetchType:"all",queryKey:R(s,e)}),a.invalidateQueries({refetchType:"all",queryKey:f(s,l.roleId)}),a.invalidateQueries({refetchType:"all",queryKey:M(s,e,l.roleId)}),t&&n.success(r.formatMessage({id:"L59KWu",defaultMessage:"Successfully updated permission"}),{duration:1})}});return{updateConnectorRolePermission:i,isPending:c,variables:o}},ye=({workspaceId:s,showToast:e=!0})=>{const t=v(),a=P(),n=h(),r=U(),{mutateAsync:i,isPending:c,variables:o}=K({mutationFn:async u=>await m.safePatch("/rbac/workspace/{workspace_id}/roles/{role_id}/connectors",{parameters:{query:{account_id:s},path:{workspace_id:s,role_id:u.id}},requestBody:{state:u.state}}),onError:()=>{e&&t.danger(a.formatMessage({id:"ezIZZO",defaultMessage:"Failed to update permission"}),{duration:1})},onSuccess:(u,l)=>{n.invalidateQueries({refetchType:"all",queryKey:f(s,l.id)}),n.invalidateQueries({refetchType:"all",queryKey:["permissions",s]}),r(),e&&t.success(a.formatMessage({id:"L59KWu",defaultMessage:"Successfully updated permission"}),{duration:1})}});return{toggleAllConnectorsPermissionForRole:i,isPending:c,variables:o}};export{oe as a,ce as b,ye as c,Y as d,te as e,V as f,ae as g,ie as h,J as i,re as j,ue as k,x as l,I as m,ne as n,ee as o,le as p,se as q,X as u};
//# sourceMappingURL=ftmb8i4ic3k5d37m.js.map
