import{j as n,c as et,h as ls,r as w,e as os,M as Xe}from"./mw35uwhq4g8r9eam.js";import{fq as Lt,ek as rs,u as as,M as Fe,iO as cs,bw as ds,fj as qt,ja as us,je as ms,fw as Pt,fx as Dt,j8 as Wt,aw as Bt,km as fs,eu as $t,p as gs,d as xs,gT as hs,cF as Qt,nD as ps,V as J,k as Ze,q9 as q,aA as Ot}from"./d0xa318sl7ywi0za.js";import{jM as ee,cP as Mt,jN as vs,jO as Ss,jP as js,jQ as Ts,jR as ys,aI as Ut,aJ as bs,hw as Cs,fK as Ns}from"./g2euln7v5pbm31qa.js";import{C as ws,a as _s}from"./fhb510ji3eot09yv.js";import{p as As}from"./e1vcfcyx8u6zde85.js";import{u as ks,S as zt}from"./idtxxq2b89y0p07a.js";function Ks({children:d}){return n.jsx("div",{className:"bg-token-main-surface-primary h-full w-full px-[22px] py-4",children:d})}function Rs(){return n.jsxs("div",{className:"flex w-full gap-2",children:[n.jsx("div",{className:"h-6 w-6",children:n.jsx(ee,{className:"h-full w-full rounded-full!"})}),n.jsxs("div",{className:"flex w-full flex-col gap-2",children:[n.jsx(ee,{}),n.jsx(ee,{}),n.jsx(ee,{}),n.jsx(ee,{})]})]})}function Kt({chunks:d,isFinishedThinking:e,taskInfo:i}){var c,p,a;const N=d.some(S=>S.type===Mt.Glaux),y=d.length===0||d.length===1&&((c=d[0])==null?void 0:c.type)===Mt.Thought&&!((a=(p=d[0])==null?void 0:p.thought)!=null&&a.content),v=!i||i.status===Lt.CREATED||i.status===Lt.RUNNING;return y&&v?n.jsx(Rs,{}):n.jsx("div",{className:"relative isolate my-3 flex flex-col",children:n.jsx(rs,{children:d.map((S,m)=>n.jsx(ws,{index:m,chunk:S,gap:_s,isLast:m===d.length-1,isExpanded:!0,isAnimationComplete:e,showBullet:!0,onClick:()=>{},isKAUR1BR5:!1,hasGlauxMessages:N,onAnimationComplete:()=>{},onMeasure:()=>{}},"cot-sidebar-".concat(m)))})})}const Vt=" Â· ",Ht=d=>{"use forget";const e=et.c(8),{title:i,children:N,className:y}=d;let v;e[0]!==y?(v=Qt("pt-2 pb-4",y),e[0]=y,e[1]=v):v=e[1];let c;e[2]!==i?(c=n.jsx("div",{className:"text-token-text-secondary text-md mb-2 font-medium",children:i}),e[2]=i,e[3]=c):c=e[3];let p;return e[4]!==N||e[5]!==v||e[6]!==c?(p=n.jsxs("div",{className:v,children:[c,N]}),e[4]=N,e[5]=v,e[6]=c,e[7]=p):p=e[7],p};function Is(d){"use forget";var ft,gt,xt,ht,pt,vt,St,jt,Tt,yt,bt,Ct,Nt,wt,_t,At,kt,Rt,It,Et,Ft,Gt;const e=et.c(154),{conversation:i,sidebar:N}=d,{reasoningGroupIndex:y,turnIndex:v,scrollTo:c}=N,p=y===void 0?-1:y,a=v===void 0?-1:v,S=as(),m=ls(),Ge=w.useRef(null),tt=w.useRef(null),_=Fe(i.id,Ds);let te;e[0]!==_.length?(te=s=>J.getConversationTurnAtIndex(s,Math.max(0,_.length-1)),e[0]=_.length,e[1]=te):te=e[1];const R=Fe(i.id,te);let se;e[2]!==(R==null?void 0:R.messageGroups)?(se=(ft=R==null?void 0:R.messageGroups)==null?void 0:ft.findIndex(Ps),e[2]=R==null?void 0:R.messageGroups,e[3]=se):se=e[3];const E=se,st=w.useRef(Math.max(0,_.length-1));let ne;e[4]!==i||e[5]!==E||e[6]!==_.length||e[7]!==a?(ne=()=>{const s=Math.max(0,_.length-1);a!==s&&E>=0&&st.current!==s&&(ys(i,{type:"cot",turnIndex:s,reasoningGroupIndex:E}),st.current=s)},e[4]=i,e[5]=E,e[6]=_.length,e[7]=a,e[8]=ne):ne=e[8];let ie;e[9]!==i||e[10]!==E||e[11]!==_||e[12]!==a?(ie=[i,_,a,E],e[9]=i,e[10]=E,e[11]=_,e[12]=a,e[13]=ie):ie=e[13],w.useEffect(ne,ie);let le;e[14]!==a?(le=s=>{var L;const r=J.getConversationTurns(s);if(a<0||a>=r.length)return[void 0,void 0,!0];const o=J.getConversationTurnAtIndex(s,a),x=(L=o==null?void 0:o.messages)!=null?L:[],f=x[x.length-1],C=(f==null?void 0:f.id)!=null?J.getRequestId(s,f.id):void 0;return[o,C,!!(f!=null&&f.end_turn)]},e[14]=a,e[15]=le):le=e[15];const[l,nt,Jt]=Fe(i.id,le),Xt=cs(nt),A=!!(nt&&Xt&&!Jt);let oe;e[16]!==(l==null?void 0:l.messages)?(oe=l==null?void 0:l.messages.find(qs),e[16]=l==null?void 0:l.messages,e[17]=oe):oe=e[17];const k=oe;let re;e[18]!==S||e[19]!==(l==null?void 0:l.messages)?(re=l==null?void 0:l.messages.some(s=>{var r,o,x;return((r=s==null?void 0:s.metadata)==null?void 0:r.api_tool_type)==="glaux"||ds({id:(x=(o=s==null?void 0:s.metadata)==null?void 0:o.model_slug)!=null?x:""},S)}),e[18]=S,e[19]=l==null?void 0:l.messages,e[20]=re):re=e[20];const Le=re;let j=p>=0?(gt=l==null?void 0:l.messageGroups)==null?void 0:gt[p]:void 0;const F=(xt=qt((j==null?void 0:j.type)===us.a8km123?j.messages:[]))!=null?xt:k,I=(ht=F==null?void 0:F.metadata)==null?void 0:ht.async_task_id;vs(I,F,i.id),ms(I);const qe=Pt(s=>Dt.getTask(I!=null?I:"",s)),u=qe==null?void 0:qe.finalMessage;let ae;e[21]!==(u==null?void 0:u.id)?(ae=s=>{var r;return J.getConversationTurnIndex(s,(r=u==null?void 0:u.id)!=null?r:"")},e[21]=u==null?void 0:u.id,e[22]=ae):ae=e[22];const b=Fe(i.id,ae);let ce;e[23]!==u||e[24]!==(l==null?void 0:l.messages)?(ce=u!=null?u:qt(l==null?void 0:l.messages),e[23]=u,e[24]=l==null?void 0:l.messages,e[25]=ce):ce=e[25];const g=ce,t=Pt(s=>Dt.getTask(I!=null?I:"",s));let de;e[26]!==(t==null?void 0:t.taskId)?(de=(pt=t==null?void 0:t.taskId)==null?void 0:pt.startsWith("thinking"),e[26]=t==null?void 0:t.taskId,e[27]=de):de=e[27];const Pe=!de;if(t){let s;e[28]!==t.rows?(s=(vt=t.rows)!=null?vt:[],e[28]=t.rows,e[29]=s):s=e[29],j=Ss(s)}let De;e:{if(!j||j.type!==Wt){let r;e[30]===Symbol.for("react.memo_cache_sentinel")?(r={chunks:[]},e[30]=r):r=e[30],De=r;break e}let s;e[31]!==S||e[32]!==Le||e[33]!==j.groups?(s=As(S,j.groups,Le),e[31]=S,e[32]=Le,e[33]=j.groups,e[34]=s):s=e[34],De=s}const{chunks:ue}=De;let me;e[35]!==ue?(me=ue===void 0?[]:ue,e[35]=ue,e[36]=me):me=e[36];const T=me;let X;if(e[37]!==j){e:{const s={startReasoningMessage:void 0,endReasoningMessage:void 0};if(!j||!Array.isArray(j.groups)){X=s;break e}for(const r of j.groups)for(const o of r.messages)((St=o.content)==null?void 0:St.content_type)===Bt.StructuredThoughts&&!s.startReasoningMessage&&(s.startReasoningMessage=o),((jt=o.content)==null?void 0:jt.content_type)===Bt.ReasoningRecap&&((Tt=o.metadata)==null?void 0:Tt.reasoning_status)!=="reasoning_skipped"&&(s.endReasoningMessage=o);X=s}e[37]=j,e[38]=X}else X=e[38];const{startReasoningMessage:Be,endReasoningMessage:fe}=X,h=!!fe;let ge;e[39]!==t?(ge=t&&fs(t),e[39]=t,e[40]=ge):ge=e[40];const $e=ge,it=w.useRef(null),lt=w.useRef(T.length),ot=w.useRef(!1);let xe;e[41]===Symbol.for("react.memo_cache_sentinel")?(xe=function(r){var x;let o=(x=r==null?void 0:r.parentElement)!=null?x:null;for(;o;){const{overflowY:f}=getComputedStyle(o);if(f==="auto"||f==="scroll"||f==="overlay")return o;o=o.parentElement}return document.scrollingElement},e[41]=xe):xe=e[41];const Zt=xe,rt=w.useRef(null),he=w.useRef(null);let pe,ve;e[42]!==h?(pe=()=>{rt.current=Zt(Ge.current);const s=rt.current;if(!s)return;he.current==null&&(he.current=s.scrollTop);const r=o=>{var C;if(!(o.currentTarget instanceof HTMLElement))return;const x=o.currentTarget.scrollTop,f=(C=he.current)!=null?C:x;x<f&&(ot.current=!0,s.removeEventListener("scroll",r)),he.current=x};if(h){s.removeEventListener("scroll",r);return}return s.addEventListener("scroll",r,{passive:!0}),()=>s.removeEventListener("scroll",r)},ve=[h],e[42]=h,e[43]=pe,e[44]=ve):(pe=e[43],ve=e[44]),$t(pe,ve);let Se;e[45]!==T.length||e[46]!==h||e[47]!==A||e[48]!==c?(Se=()=>{const s=it.current===!0;it.current=A;let r=0,o=0;return r=requestAnimationFrame(()=>{o=requestAnimationFrame(()=>{var x,f;!h&&!ot.current?(x=Ge.current)==null||x.scrollIntoView({behavior:lt.current!==T.length?"smooth":void 0,block:"end"}):(c==="sources"||s&&!A)&&((f=tt.current)==null||f.scrollIntoView({block:"start"})),lt.current=T.length})}),()=>{r&&cancelAnimationFrame(r),o&&cancelAnimationFrame(o)}},e[45]=T.length,e[46]=h,e[47]=A,e[48]=c,e[49]=Se):Se=e[49];let je;e[50]!==T.length||e[51]!==i.id||e[52]!==A||e[53]!==c?(je=[i.id,T.length,c,A],e[50]=T.length,e[51]=i.id,e[52]=A,e[53]=c,e[54]=je):je=e[54],$t(Se,je);const[es,ts]=w.useState(Ls);let Te,ye;e[55]!==h?(Te=()=>{if(h)return;const s=window.setInterval(()=>ts(Date.now()),1e3);return()=>clearInterval(s)},ye=[h],e[55]=h,e[56]=Te,e[57]=ye):(Te=e[56],ye=e[57]),w.useEffect(Te,ye);const Oe=gs(),Me=t==null?void 0:t.taskId;let be;e[58]!==m||e[59]!==Me||e[60]!==Oe?(be={taskId:Me,intl:m,toaster:Oe},e[58]=m,e[59]=Me,e[60]=Oe,e[61]=be):be=e[61];const Ue=js(be),at=t!=null&&t.createdAt?Date.parse(t.createdAt)/1e3:Be==null?void 0:Be.create_time,ct=h?fe==null?void 0:fe.create_time:es/1e3,ss=at!=null&&ct!=null?Math.max(0,ct-at):0,dt=Math.floor(ss),ut=Math.floor(dt/60),ze=dt%60;let Ce;e[62]!==ze?(Ce=ze.toString(),e[62]=ze,e[63]=Ce):Ce=e[63];const mt=Ce,Ke=ut>0?"".concat(ut,"m ").concat(mt,"s"):"".concat(mt,"s");let Ne;e[64]!==Pe||e[65]!==(t==null?void 0:t.originalConversationId)||e[66]!==(t==null?void 0:t.taskId)?(Ne=Pe?()=>{Ze(t==null?void 0:t.originalConversationId,s=>{s.steeringAsyncTaskId=t==null?void 0:t.taskId})}:void 0,e[64]=Pe,e[65]=t==null?void 0:t.originalConversationId,e[66]=t==null?void 0:t.taskId,e[67]=Ne):Ne=e[67];const Ve=Ne;let we;e[68]!==Ue?(we=()=>{Ue.mutate()},e[68]=Ue,e[69]=we):we=e[69];const He=we;let _e;e[70]!==((yt=k==null?void 0:k.metadata)==null?void 0:yt.async_task_title)||e[71]!==(t==null?void 0:t.title)||e[72]!==(l==null?void 0:l.messages)?(_e=(At=(Ct=t==null?void 0:t.title)!=null?Ct:(bt=k==null?void 0:k.metadata)==null?void 0:bt.async_task_title)!=null?At:(_t=(wt=(Nt=l==null?void 0:l.messages)==null?void 0:Nt.find(Gs))==null?void 0:wt.metadata)==null?void 0:_t.async_task_title,e[70]=(kt=k==null?void 0:k.metadata)==null?void 0:kt.async_task_title,e[71]=t==null?void 0:t.title,e[72]=l==null?void 0:l.messages,e[73]=_e):_e=e[73];const P=_e;let Ae;e[74]!==m||e[75]!==P?(Ae=P&&typeof P=="string"&&P.length>0?P:m.formatMessage(Y.activity),e[74]=m,e[75]=P,e[76]=Ae):Ae=e[76];const G=Ae;let ke;e[77]!==m||e[78]!==(t==null?void 0:t.taskId)?(ke=(Rt=t==null?void 0:t.taskId)!=null&&Rt.startsWith("promode")?m.formatMessage(Y.proThinkingTitle):m.formatMessage(Y.placeholderTitle),e[77]=m,e[78]=t==null?void 0:t.taskId,e[79]=ke):ke=e[79];const We=ke,ns=xs(Fs),{hasSources:Qe}=Ts(i.id,b>=0?b:a,g),{sourcesCount:Ye}=ks(i.id,b>=0?b:a,(It=g==null?void 0:g.id)!=null?It:"");let Re;e[80]!==t?(Re=t&&hs(t),e[80]=t,e[81]=Re):Re=e[81];const Ie=Re;if(ns){let s;e[82]!==i?(s=()=>{Ut(i)},e[82]=i,e[83]=s):s=e[83];let r;e[84]===Symbol.for("react.memo_cache_sentinel")?(r=n.jsx(q.Backdrop,{}),e[84]=r):r=e[84];let o;e[85]!==m||e[86]!==c||e[87]!==G?(o=c==="sources"?m.formatMessage(Y.sourcesTitle):G,e[85]=m,e[86]=c,e[87]=G,e[88]=o):o=e[88];let x;e[89]!==o?(x=n.jsx("div",{className:"text-token-text-secondary text-md mb-2 truncate font-medium",children:o}),e[89]=o,e[90]=x):x=e[90];let f;e[91]!==T||e[92]!==i.id||e[93]!==b||e[94]!==h||e[95]!==(g==null?void 0:g.id)||e[96]!==c||e[97]!==a?(f=c==="sources"?n.jsx(zt,{clientThreadId:i.id,turnIndex:b>=0?b:a,messageId:(Et=g==null?void 0:g.id)!=null?Et:"",isInSidebar:!0,combineSections:!0}):n.jsx(Kt,{chunks:T,isFinishedThinking:h}),e[91]=T,e[92]=i.id,e[93]=b,e[94]=h,e[95]=g==null?void 0:g.id,e[96]=c,e[97]=a,e[98]=f):f=e[98];let C;e[99]!==x||e[100]!==f?(C=n.jsx(q.Content,{size:"fit",children:n.jsx(q.ScrollRoot,{className:"h-[80vh]",children:n.jsx(q.ContentSection,{"data-content-sheet-content-section":!0,children:n.jsxs("div",{className:"bg-primary px-6 py-4",children:[x,f]})})})}),e[99]=x,e[100]=f,e[101]=C):C=e[101];let L;return e[102]!==s||e[103]!==C?(L=n.jsx(q.Root,{defaultPresented:!0,children:n.jsx(q.Portal,{children:n.jsxs(q.View,{onCloseComplete:s,children:[r,C]})})}),e[102]=s,e[103]=C,e[104]=L):L=e[104],L}const is=(Ft=F==null?void 0:F.metadata)==null?void 0:Ft.async_task_original_message_id,Z=h?u==null?void 0:u.id:is;let D;e[105]!==m?(D=m.formatMessage(Y.cotDetails),e[105]=m,e[106]=D):D=e[106];let B;e[107]!==i.id||e[108]!==(u==null?void 0:u.id)||e[109]!==G||e[110]!==Z?(B=Z?n.jsx("button",{className:"before:bg-token-surface-hover dark:before:bg-token-main-surface-tertiary relative min-h-9 rounded-md before:absolute before:inset-y-0 before:-right-2.5 before:-left-2.5 before:rounded-md before:opacity-0 before:transition-opacity before:content-[''] hover:before:opacity-100",onClick:()=>{Z&&(Ze(i.id,s=>{s.scrollToMessageId=Z,s.scrollToMessageIsAssistant=!!(u!=null&&u.id)}),requestAnimationFrame(()=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{Ze(i.id,Es)})})}))},children:n.jsx("div",{className:"relative z-10 max-w-[220px] truncate",children:G})}):n.jsx("div",{className:"max-w-[220px] truncate",children:G}),e[107]=i.id,e[108]=u==null?void 0:u.id,e[109]=G,e[110]=Z,e[111]=B):B=e[111];let $;e[112]!==Ke||e[113]!==$e?($=!$e&&n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"text-token-text-tertiary",children:Vt}),n.jsx("span",{className:"text-token-text-tertiary whitespace-nowrap",children:Ke})]}),e[112]=Ke,e[113]=$e,e[114]=$):$=e[114];let O;e[115]!==B||e[116]!==$?(O=n.jsxs("div",{className:"flex w-full items-center gap-2.5 px-0.5 text-lg",children:[B,$]}),e[115]=B,e[116]=$,e[117]=O):O=e[117];let M;e[118]!==i?(M=()=>Ut(i),e[118]=i,e[119]=M):M=e[119];let U;e[120]!==Ie||e[121]!==Ve||e[122]!==He?(U=Ie&&n.jsx(Yt,{onAddContext:Ve,onStopTask:He}),e[120]=Ie,e[121]=Ve,e[122]=He,e[123]=U):U=e[123];let z;e[124]!==T||e[125]!==h||e[126]!==t?(z=n.jsx(Kt,{chunks:T,isFinishedThinking:h,taskInfo:t}),e[124]=T,e[125]=h,e[126]=t,e[127]=z):z=e[127];const Je=Ie&&"pb-12";let K;e[128]!==Je?(K=Qt("scroll-mb-4",Je),e[128]=Je,e[129]=K):K=e[129];let V;e[130]!==K?(V=n.jsx("div",{ref:Ge,className:K}),e[130]=K,e[131]=V):V=e[131];let H;e[132]!==z||e[133]!==V||e[134]!==We?(H=n.jsxs(Ht,{title:We,className:"px-3",children:[z,V]}),e[132]=z,e[133]=V,e[134]=We,e[135]=H):H=e[135];let W;e[136]!==i.id||e[137]!==b||e[138]!==Qe||e[139]!==m||e[140]!==A||e[141]!==(g==null?void 0:g.id)||e[142]!==Ye||e[143]!==a?(W=!A&&Qe&&n.jsxs(Ht,{title:n.jsxs("div",{className:"flex items-center gap-1 px-3",children:[n.jsx("span",{children:m.formatMessage(Y.sourcesTitle)}),n.jsx("span",{className:"text-token-text-tertiary",children:Vt}),n.jsx("span",{className:"text-token-text-tertiary",children:Ye})]}),children:[n.jsx("div",{ref:tt,className:"scroll-mt-24"}),n.jsx(zt,{clientThreadId:i.id,turnIndex:b>=0?b:a,messageId:(Gt=g==null?void 0:g.id)!=null?Gt:"",isInSidebar:!0,combineSections:!0})]}),e[136]=i.id,e[137]=b,e[138]=Qe,e[139]=m,e[140]=A,e[141]=g==null?void 0:g.id,e[142]=Ye,e[143]=a,e[144]=W):W=e[144];let Q;e[145]!==H||e[146]!==W?(Q=n.jsx("div",{className:"bg-primary flex h-full flex-col",children:n.jsxs("div",{className:"flex-1 px-2 py-3",children:[H,W]})}),e[145]=H,e[146]=W,e[147]=Q):Q=e[147];let Ee;return e[148]!==D||e[149]!==O||e[150]!==M||e[151]!==U||e[152]!==Q?(Ee=n.jsx(bs,{ariaLabel:D,leading:O,scrollMode:"content-only",handleClose:M,trailing:U,children:Q}),e[148]=D,e[149]=O,e[150]=M,e[151]=U,e[152]=Q,e[153]=Ee):Ee=e[153],Ee}function Es(d){d.scrollToMessageId=void 0,d.scrollToMessageIsAssistant=void 0}function Fs(){return!ps()}function Gs(d){var e;return(e=d.metadata)==null?void 0:e.async_task_title}function Ls(){return Date.now()}function qs(d){var e;return(e=d.metadata)==null?void 0:e.async_task_id}function Ps(d){return d.type===Wt}function Ds(d){return J.getConversationTurnIds(d)}const Y=os({cotDetails:{id:"GKVpeP",defaultMessage:"Reasoning details"},placeholderTitle:{id:"w0RKFn",defaultMessage:"Thinking"},proThinkingTitle:{id:"wOEgCa",defaultMessage:"Pro thinking"},queries:{id:"8HonUQ",defaultMessage:"{count, plural, one {# query} other {# queries}}"},sources:{id:"YC7OAc",defaultMessage:"{count, plural, one {# source} other {# sources}}"},activity:{id:"1TpF7a",defaultMessage:"Activity"},sourcesTitle:{id:"XUf3jw",defaultMessage:"Sources"}});function Yt(d){"use forget";const e=et.c(10),{onAddContext:i,onStopTask:N,taskIsFinalizing:y}=d;let v,c;e[0]===Symbol.for("react.memo_cache_sentinel")?(v=n.jsx(Cs,{}),c=n.jsx(Xe,{id:"hVKG6H",defaultMessage:"Stop"}),e[0]=v,e[1]=c):(v=e[0],c=e[1]);let p;e[2]!==N?(p=n.jsxs(Ot,{onClick:N,color:"secondary",className:"flex flex-1 items-center justify-center gap-2",children:[v,c]}),e[2]=N,e[3]=p):p=e[3];let a;e[4]!==i||e[5]!==y?(a=i&&n.jsxs(Ot,{onClick:i,className:"flex flex-1 items-center justify-center gap-2",disabled:y,children:[n.jsx(Ns,{className:"me-1"}),y?n.jsx(Xe,{id:"WhS0Hs",defaultMessage:"Finalizing"}):n.jsx(Xe,{id:"d3wD0e",defaultMessage:"Update"})]}),e[4]=i,e[5]=y,e[6]=a):a=e[6];let S;return e[7]!==p||e[8]!==a?(S=n.jsx("div",{className:"bg-token-bg-primary border-t p-4",children:n.jsxs("div",{className:"flex gap-2",children:[p,a]})}),e[7]=p,e[8]=a,e[9]=S):S=e[9],S}const Vs=Object.freeze(Object.defineProperty({__proto__:null,ChatScreenCoTFlyout:Is,SidebarButtons:Yt},Symbol.toStringTag,{value:"Module"}));export{Rs as C,Yt as S,Ks as a,Vs as c};
//# sourceMappingURL=onzd13hqm91228av.js.map
