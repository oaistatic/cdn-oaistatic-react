var ce=Object.defineProperty,de=Object.defineProperties;var ue=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var ge=Object.prototype.hasOwnProperty,pe=Object.prototype.propertyIsEnumerable;var K=(t,s,i)=>s in t?ce(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i,P=(t,s)=>{for(var i in s||(s={}))ge.call(s,i)&&K(t,i,s[i]);if(W)for(var i of W(s))pe.call(s,i)&&K(t,i,s[i]);return t},b=(t,s)=>de(t,ue(s));import{r as d,j as e,h as Z,u as fe,e as me,M as u}from"./mw35uwhq4g8r9eam.js";import{cw as xe,jf as he,u as D,dh as z,di as ye,p as X,qL as ve,qM as Me,qN as je,j1 as ke,h4 as J,dl as n,qO as Se,qP as Te,n as we,cz as Ce,J as Pe,aB as $,aA as k,qQ as R,qR as L}from"./d0xa318sl7ywi0za.js";import{et as be,eu as Re,ev as Le,ew as ee,ex as Ie,bu as Be}from"./g2euln7v5pbm31qa.js";import{S as Ne,i as qe,G as _e,A as Ae,M as Ue}from"./czdlmmywear3zja2.js";import"./jy8ajjjwfhv86rlc.js";import"./bymjh2zr7tar40cn.js";function Je({gizmo:t,updateGizmo:s,publishedGizmo:i,promoteGizmo:g,appealGizmo:p,setAppealState:f,showActionsModal:y,shareOnly:S,onClose:M}){const[m,j]=d.useState({type:"privacy"});return m.type==="privacy"?e.jsx(Qe,{gizmo:t,updateGizmo:s,publishedGizmo:i,promoteGizmo:g,appealGizmo:p,setAppealState:f,setStep:j,showActionsModal:y,shareOnly:S,onClose:M}):e.jsx(Ge,{publishedGizmo:m.publishedGizmo,onClose:M})}function Fe(t){return t?n.Workspace:n.Link}function Qe({gizmo:t,publishedGizmo:s,updateGizmo:i,promoteGizmo:g,appealGizmo:p,setAppealState:f,setStep:y,showActionsModal:S,shareOnly:M,onClose:m}){var G,H,O,V,Y;const j=D(),[se,B]=d.useState(!1),N=z(ye.isBusinessWorkspace),o=Z(),x=X(),[r,q]=d.useState(ve(t)?Fe(!!N):t.sharingRecipient),ae=fe(),_=qe(r,t.sharingTargets),{data:T,isLoading:te}=Me(),A=je(),[c,w]=d.useState(s!=null&&s.gizmo.display.categories.length>0?(H=(G=A.data)==null?void 0:G.categories.find(a=>a.id===s.gizmo.display.categories[0]))==null?void 0:H.id:void 0);d.useEffect(()=>{w(s==null?void 0:s.gizmo.display.categories[0])},[s==null?void 0:s.gizmo.display.categories]);const[ie,U]=d.useState(void 0),re=d.useRef(ke((a,l)=>J.generateCategory(a,l),1e3)),v=T!=null&&T.is_verified?void 0:o.formatMessage({id:"qUMu4e",defaultMessage:"To publish your GPTs to the Explore GPTs page, set up your builder profile in the user settings page."});r===n.Marketplace&&v!=null&&!te&&q(n.Link);const ne=N&&!((O=t.sharingTargets)!=null&&O.some(a=>a.recipient===n.Link)),F=Se(t,r,c),le=F.includes(Te.MissingPublicActionPrivacyPolicyURL),C=t.tools.find(a=>a.type===we.JIT_PLUGIN&&!a.metadata.privacy_policy_url),h=z(a=>a.currentWorkspace),oe=Ce();d.useEffect(()=>{let a=!0;return(async()=>{try{if(c!=null)return;const l=await re.current(t.name,t.instructions);a&&c==null&&(l?w(l.id):U(!0))}catch(l){a&&c==null&&U(!0)}})(),()=>{a=!1}},[t.instructions,t.name,oe,c]);const Q=Pe(j,"4226692983");return e.jsx($,{testId:"modal-simple-share-gizmo",type:"success",isOpen:!0,onClose:m,title:e.jsx(u,{id:"9viumf",defaultMessage:"Share GPT"}),showCloseButton:!0,primaryButton:_?e.jsx(k,{color:"primary",disabled:F.length>0,loading:se,onClick:async()=>{try{if(B(!0),M){if(!(s!=null&&s.gizmo.id)){x.danger(o.formatMessage({id:"QYVEx8",defaultMessage:"Error sharing GPT"}),{toastId:"simple_share_gizmo_modal",loggingTitle:"Error sharing GPT",loggingDescription:"Error message when GPT ID is missing (shouldn't happen)"});return}const a=await J.shareGizmo(s.gizmo.id,c?{sharing:R(r,[],L),categories:[c]}:{sharing:R(r,[],L)});a.error?(x.warning(o.formatMessage({id:"tmIKmp",defaultMessage:"Unable to share GPT"})),i({sharingTargets:a.sharing_targets}),f({gizmoId:s.gizmo.id,sharingRecipient:r,categories:s.gizmo.display.categories,moderationType:Ue.PublishBlocked,sharingTargets:a.sharing_targets,showModal:Ae.AppealAvailable})):(ae.setQueryData(["gizmo",{gizmoId:s.gizmo.id},{draft:!1}],l=>a.resource),i(l=>b(P({},l),{sharingRecipient:r})),x.success(o.formatMessage({id:"SWSzcY",defaultMessage:"Sharing settings updated"})),m())}else{const a=await g({recipient:r,subjects:R(r,[],L)},c);a?(y({type:"published",publishedGizmo:a}),i(l=>b(P({},l),{id:a.gizmo.id,sharingRecipient:r})),a.gizmo.live_version!=null&&i({liveVersion:a.gizmo.live_version}),x.success(o.formatMessage({id:"R5zko1",defaultMessage:"GPT published"}),{testId:"gpt-published-toast"})):(x.warning(o.formatMessage({id:"uf7WYw",defaultMessage:"Unable to publish GPT"})),m())}}finally{B(!1)}},"data-testid":"save-gizmo-button",children:e.jsx(u,{id:"SW4DG4",defaultMessage:"Save"})}):Q?e.jsx(e.Fragment,{children:e.jsx(k,{color:"primary",onClick:async()=>{await p(r,c)},children:e.jsx(u,{id:"bBmLUr",defaultMessage:"Appeal"})})}):null,secondaryButton:s?e.jsx(k,{color:"secondary",onClick:a=>ee(j,s,x,a,o.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"})),children:e.jsx(u,{id:"wvL15a",defaultMessage:"Copy link"})}):null,children:e.jsxs("div",{className:"mx-[-16px] flex flex-col gap-3 text-sm",children:[e.jsx("div",{className:"space-y-1.5",children:e.jsxs(Le,{value:r,onValueChange:a=>q(a),children:[t.sharingTargets&&t.sharingTargets.map((a,l)=>e.jsx(I,{value:a.recipient,disabled:a.recipient===n.Marketplace&&v!=null,tooltipText:a.recipient===n.Marketplace?v!=null?v:o.formatMessage({id:"0Rcb4e",defaultMessage:"Your GPT will appear in the Explore GPTs page"}):void 0,shareLevel:a.recipient},l)),ne&&e.jsxs(e.Fragment,{children:[e.jsx(I,{value:n.Link,disabled:!0,tooltipText:o.formatMessage(E.workspaceDisabledHint),shareLevel:n.Link,workspaceName:h==null?void 0:h.name}),e.jsx(I,{value:n.Link,disabled:!0,tooltipText:o.formatMessage(E.workspaceDisabledHint),shareLevel:n.Marketplace,workspaceName:h==null?void 0:h.name})]})]})}),le&&e.jsx("div",{className:"text-xs text-red-500",children:e.jsx(u,{id:"/iw1Iv",defaultMessage:"Public actions require valid privacy policy URLs. Click <fixlink>here</fixlink> to update.",values:{fixlink:a=>e.jsx("button",{onClick:()=>{S(C==null?void 0:C.metadata.action_id)},className:"underline",children:a})}})}),r!==n.Private&&e.jsx(_e,{gizmo:t,category:c,categories:r===n.Marketplace?(Y=(V=A.data)==null?void 0:V.categories)!=null?Y:[]:void 0,onCategoryChange:r===n.Marketplace?a=>w(a.id):void 0}),r===n.Marketplace&&(ie?e.jsx("div",{className:"text-xs text-red-500",children:e.jsx(u,{id:"tpC3ui",defaultMessage:"There was an error updating the list of categories"})}):null),!_&&Q&&e.jsx("div",{className:"text-token-text-secondary flex items-center justify-between text-sm",children:e.jsx(u,{id:"jLCMMV",defaultMessage:"Because this GPT previously may have violated our policies, you will have to submit an appeal to make it available at this level."})})]})})}function Ge({publishedGizmo:t,onClose:s}){const i=D(),g=Ie(i,t),p=Z(),f=X();return e.jsx($,{testId:"modal-simple-share-published",type:"success",isOpen:!0,onClose:s,title:e.jsx(u,{id:"rCRRmx",defaultMessage:"Settings Saved"}),showCloseButton:!0,primaryButton:e.jsx(k,{color:"primary",as:"link",to:g,children:e.jsx(u,{id:"lyZz44",defaultMessage:"View GPT"})}),children:e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"bg-token-main-surface-secondary flex gap-1 rounded-sm px-2 py-1",children:[e.jsx("div",{className:"line-clamp-1 break-all text-ellipsis",children:g}),e.jsx("button",{onClick:y=>{ee(i,t,f,y,p.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"}))},className:"text-token-text-secondary hover:text-token-text-primary transition","data-testid":"copy-saved-gpt-url-button",children:e.jsx(Be,{className:"icon-sm"})})]})})})}const E=me({workspaceDisabledHint:{id:"gizmo.workspaceDisabledHint",defaultMessage:"Your workspace administrator has disabled this setting"}});function I({shareLevel:t,workspaceName:s,value:i,disabled:g=!1,tooltipText:p}){const f=d.useId();return e.jsx(xe,{disabled:p==null,label:p,side:"top",triggerAs:null,children:e.jsxs(be,{id:f,value:i,disabled:g,className:"hover:bg-token-main-surface-secondary flex h-14 w-full cursor-pointer flex-row items-center justify-between gap-2 rounded-md px-3 py-4 font-semibold",children:[e.jsx("label",{htmlFor:f,className:"flex cursor-pointer items-center gap-1",children:e.jsx(Ne,{shareLevel:t,workspaceName:s!=null?s:"",hasInviteSharing:!1})}),e.jsx(Re,{children:e.jsx(he,{className:"icon-lg me-1"})})]})})}export{I as ShareLevelRadioOption,Je as SimpleShareGizmoModal};
//# sourceMappingURL=g27fx97bikhm8miq.js.map
