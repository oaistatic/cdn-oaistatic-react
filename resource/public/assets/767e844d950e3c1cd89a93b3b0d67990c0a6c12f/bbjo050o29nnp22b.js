var pe=Object.defineProperty,be=Object.defineProperties;var Ee=Object.getOwnPropertyDescriptors;var de=Object.getOwnPropertySymbols;var Me=Object.prototype.hasOwnProperty,je=Object.prototype.propertyIsEnumerable;var me=(a,i,o)=>i in a?pe(a,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[i]=o,r=(a,i)=>{for(var o in i||(i={}))Me.call(i,o)&&me(a,o,i[o]);if(de)for(var o of de(i))je.call(i,o)&&me(a,o,i[o]);return a},Q=(a,i)=>be(a,Ee(i));import{h as ae,r as d,j as e,M as E,e as Ce,u as Ie,i as we}from"./mw35uwhq4g8r9eam.js";import{cw as Se,aA as U,mk as ye,cF as O,u as ve,jh as fe,e7 as xe,_ as q,dk as re,cm as ke,aP as Re,R as Ne}from"./d0xa318sl7ywi0za.js";import{bc as Te,bd as T,A as Ae,as as _,be as De,z as _e,at as Ve,bf as Fe,bg as Be,bh as Le,V as ie}from"./g2euln7v5pbm31qa.js";import{E as Pe}from"./c50t1cee4z886ma0.js";import{I as We}from"./0vzw4aujxrcpkx50.js";import{c as Oe,d as He}from"./ojmli062couj7r3v.js";const he=25,ce=[],ue=a=>{const i=a.trim();if(!ie.test(i))return null;const[,o=""]=i.split("@");return o.toLowerCase()||null},ze=({workspace:a,onSuccess:i,seatCount:o})=>{"use no forget";var G;const f=ae(),M=ve(),l=fe(M),u=xe(),x=a.isOwnerOfAccount(),[h,y]=d.useState(!1),p=d.useRef(null),[b,k]=d.useState(!1),[v,j]=d.useState(!0),[C,I]=d.useState(!1),[c,w]=d.useState([]),[R,S]=d.useState([]),[V,te]=d.useState(o?Array(o).fill(""):[]),{mutateAsync:X}=Ge(a.id,i),F=Be(),Z=(G=Le())!=null?G:!0,[se,B]=d.useState(ce),N=d.useMemo(()=>u==null?void 0:u.subscriptionAnalyticsParams,[u]);d.useEffect(()=>{if(!(c!=null&&c.length)||!(F!=null&&F.length)||Z){B(ce);return}const g=F.map(t=>"@"+t.hostname.toLowerCase()),n=c.map(({email:t})=>t.toLowerCase()).filter(t=>!g.some(m=>t.endsWith(m)));B(n)},[F,Z,c]);const A=Qe(x),L=d.useMemo(()=>{var n;const g=a.isFreeWorkspace()?"owner":"member";return(n=A[g])!=null?n:A.member},[A,a]),J=d.useCallback(g=>{const n={numEmailsAdded:g,uploadType:"Bulk"};q.logEvent("Account Pay: Collaborator Emails Added",r(r({},N),n))},[N]),ee=d.useCallback(async g=>{var t;k(!0);const n=(t=g.target.files)==null?void 0:t[0];if(n){const m=await Ye(n,A,L,h,a.isFreeWorkspace());m.status==="success"?(w(m.newRows),S(m.newRows.map(D=>({label:D.email,value:D.email,isValid:ie.test(D.email)}))),y(m.hasWarning),J(m.newRows.length),g.target.files=null):m.reason==="file_too_large"?l.danger(f.formatMessage(s.fileTooLargeWarning,{maxSize:"".concat(he,"MB")}),{duration:5,loggingTitle:"CSV Upload: File too large"}):m.reason==="invalid_file_type"&&l.danger(f.formatMessage(s.fileIncorrectTypeWarning),{duration:5,loggingTitle:"CSV Upload: File incorrect type",toastId:"csv_upload",loggingDescription:s.fileIncorrectTypeWarning.defaultMessage})}},[A,L,f,h,l,J,a]),K=(g,n,t)=>{const m=[...c];m[g]=Q(r({},m[g]),{[n]:t}),w(m)},ne=d.useCallback(g=>{q.logEvent("Account Pay: Add Collaborators Modal Clicked",r(r({},N),g))},[N]),H=d.useCallback(()=>{q.logEvent("Account Pay: Add Collaborators Upload Clicked",N)},[N]),le=d.useCallback(()=>{q.logEvent("Account Pay: Collaborator Email Removed",N)},[N]),W=g=>{const n=[...c.slice(0,g),...c.slice(g+1)];w(n),le()},P=d.useCallback(()=>{w([]),I(!1),S([])},[]),$=d.useCallback(async()=>{I(!0);try{c.length>5&&l.info(f.formatMessage(s.inviteMessageLoading,{numRows:c.length}),{hasCloseButton:!0});const g=[["admin",re.ADMIN],["owner",re.OWNER],["member",re.STANDARD]],t=(await Promise.all(ke(g.map(([m,D])=>{const z=c.filter(Y=>Y.role===m).map(Y=>Y.email);return z.length>0&&X({emails:z,role:D,resendEmails:v})})))).flat().length;t>0&&l.success(f.formatMessage(s.inviteSuccessToast,{numRows:t,userStr:t===1?"user":"users",workspaceName:Oe(f,a)})),Re(M,"chatgpt_invite_users_to_workspace",c.length,{action:"SubmitEmails",location:"modal-submit-button",text:"Submit",step:"AdminModal-CollectEmails-Submit"}),i==null||i(),P()}finally{I(!1)}},[c,M,i,P,l,f,X,v,a]),oe=d.useCallback(()=>{var g,n;(g=p.current)!=null&&g.value&&(p.current.value=""),(n=p.current)==null||n.click(),typeof document<"u"&&document.activeElement&&setTimeout(()=>{var m;const t=document.activeElement;(m=t==null?void 0:t.blur)==null||m.call(t)},0),H()},[p,H]);return{INVITE_ROLES:A,defaultInviteRole:L,clearState:P,emailInputList:V,emailTableRows:c,emailTextAreaValue:R,emailsOutsideOfDomain:se,fileInputRef:p,handleClickImportCSV:oe,handleDeleteRow:W,handleInputChange:K,handleSubmit:$,handleUploadCSV:ee,hasUploadedCsv:b,isInviting:C,resendEmails:v,setEmailInputList:te,setEmailTableRows:w,setEmailTextAreaValue:S,setResendEmails:j,shouldShowWarning:h,trackNavigationClick:ne,trackUploadClick:H}},Ue=({email:a,index:i,emailInputList:o,setEmailInputList:f,setEmailTableRows:M,defaultInviteRole:l,shouldCheckDomainMismatch:u})=>{const x=ae(),[h,y]=d.useState(!1),[p,b]=d.useState(!1),k=He(),v=d.useMemo(()=>k?ue(k):null,[k]),j=!!a&&!h&&!p&&i>0&&o.indexOf(a)<i;return e.jsxs("div",{className:"flex w-full flex-col gap-1",children:[e.jsx(We,{className:O((h||p||j)&&"border-token-text-error"),type:"email",value:a,onBlur:()=>{const C=!!a&&!ie.test(a);if(y(C),!a||C||!v||!u){b(!1);return}const I=ue(a);b(I!==null&&I!==v)},placeholder:x.formatMessage(s.emailInputPlaceholder),onChange:C=>{b(!1),f(I=>{const c=[...I];return c[i]=C.target.value,M(c.filter(Boolean).map(w=>({email:w,role:l}))),c})}},i),h&&e.jsx("div",{className:"interactive-label-warning-secondary ms-1 flex text-xs",children:e.jsx(E,r({},s.invalidEmailWarning))}),p&&e.jsx("div",{className:"interactive-label-warning-secondary ms-1 flex text-xs",children:e.jsx(E,Q(r({},s.mismatchedDomainWarning),{values:{domain:v!=null?v:""}}))}),j&&e.jsx("div",{className:"interactive-label-warning-secondary ms-1 flex text-xs",children:e.jsx(E,r({},s.duplicateEmailWarning))})]})},ge=25,qe=10;function Ke(a,i,o,f){const M=Math.max(0,f),l=Math.min(Math.max(0,o),i),u=Math.max(i-l,0),x=Math.min(M,u),h=Math.max(M-x,0);if(a<l)return"bg-black/30 dark:bg-white/30";if(a<l+x)return"bg-black dark:bg-white";if(a<l+x+h)return"bg-blue-200 dark:bg-blue-500 border border-blue-600 dark:border-blue-300"}function sa({workspace:a,canResendInviteEmails:i,onCancel:o,cancelButtonText:f,onSuccess:M,fullWidthButtons:l=!1,seatCount:u,seatsUsedBaseline:x=0,enableRoleSelectionStep:h=!1,showCancelButton:y=!0,csvButtonAlignedWithPrimary:p=!1}){"use no forget";const b=ae(),[k,v]=d.useState(u>qe),[j,C]=d.useState(!1),I=a.isK12(),{clearState:c,emailInputList:w,emailTableRows:R,emailTextAreaValue:S,emailsOutsideOfDomain:V,fileInputRef:te,handleClickImportCSV:X,handleSubmit:F,handleUploadCSV:Z,hasUploadedCsv:se,isInviting:B,resendEmails:N,setEmailInputList:A,setEmailTableRows:L,setEmailTextAreaValue:J,setResendEmails:ee,trackNavigationClick:K,shouldShowWarning:ne,handleInputChange:H,handleDeleteRow:le,INVITE_ROLES:W,defaultInviteRole:P}=ze({workspace:a,onSuccess:M,seatCount:u}),$=e.jsx(Se,{label:b.formatMessage(s.importCSVTooltip),contentClassName:"w-[280px]",side:"top",delayDuration:200,children:e.jsx(U,{color:p?"ghost":"secondary",icon:Te,onClick:X,children:e.jsx(E,r({},se?s.reimportCSVButton:s.importCSVButton))})}),oe=n=>{const t=n.filter((m,D,z)=>z.findIndex(Y=>Y.value===m.value)===D);J(t),L(t.map(m=>({email:m.value,role:P})))};d.useEffect(()=>{const n=S.filter((t,m,D)=>D.findIndex(z=>z.value===t.value)===m);L(n.map(t=>({email:t.value,role:P})))},[P,S,L]);const G=n=>e.jsx(U,{className:O(n,l&&"w-full"),color:"primary",size:l?"large":"medium",loading:h?!1:B,disabled:(h?!1:B)||R.length===0||V.length>0,onClick:()=>{h?C(!0):(F(),K({buttonType:"Send"}))},children:h?b.formatMessage(s.inviteMemberInviteNextButton):b.formatMessage(B?s.inviteMemberInviteSubmitButtonLoading:s.inviteMemberInviteSubmitButton)}),g=()=>y?e.jsx(U,{color:"ghost",size:l?"large":"medium",onClick:()=>{c(),o(),K({buttonType:"Skip"})},children:f}):null;return h&&j?e.jsxs("div",{className:"flex flex-col gap-2",children:[!a.isFreeWorkspace()&&ne&&e.jsxs("div",{className:"flex w-full items-center rounded-xl bg-yellow-100 p-4",children:[e.jsx(ye,{className:"icon-sm me-2 text-yellow-700"}),e.jsx("div",{className:"grow text-yellow-700",children:e.jsx(E,r({},s.unspecifiedRoleDescription))})]}),V.length>0&&e.jsx("div",{className:"flex w-full items-center bg-red-100 p-4",children:e.jsxs("div",{className:"grow text-red-700",children:[e.jsx(E,r({},s.prohibitedExternalEmailDescription)),e.jsx("pre",{className:"my-1",children:V.join(", ")}),e.jsx(E,r({},s.prohibitedExternalEmailResolution))]})}),e.jsxs(T.Root,{size:"normal",children:[e.jsxs(T.Header,{children:[e.jsx(T.HeaderCell,{children:e.jsx(E,r({},s.inviteTableHeaderEmail))}),e.jsx(T.HeaderCell,{className:"w-32 ps-3",children:e.jsx(E,r({},s.inviteTableHeaderRole))}),e.jsx(T.HeaderCell,{})]}),e.jsx(T.Body,{children:R.map((n,t)=>e.jsxs(T.Row,{children:[e.jsx(T.Cell,{children:e.jsx(Ae,{ariaLabel:b.formatMessage(s.inviteTableHeaderEmail),name:"email",type:"email",value:n.email,onChange:m=>H(t,"email",m.target.value),color:"neutral"})}),e.jsx(T.Cell,{children:e.jsxs(_.Root,{value:n.role,onValueChange:m=>H(t,"role",m),disabled:a.isFreeWorkspace(),children:[e.jsxs(_.Trigger,{className:"w-32 justify-between",children:[e.jsx(_.Value,{}),e.jsx(_.Icon,{})]}),e.jsx(_.Portal,{children:e.jsxs(_.Content,{className:"border-token-main-surface-secondary border",children:[e.jsx(_.Item,{value:W.member,children:e.jsx(E,r({},s.inviteRoleMember))}),W.admin&&e.jsx(_.Item,{value:W.admin,children:e.jsx(E,r({},s.inviteRoleAdmin))}),W.owner&&e.jsx(_.Item,{value:W.owner,children:e.jsx(E,r({},s.inviteRoleOwner))})]})})]})}),e.jsx(T.Cell,{textAlign:"right",children:e.jsx(De,{onClick:()=>le(t),className:"icon-sm text-token-text-secondary me-2 cursor-pointer"})})]},t))})]}),i&&ee&&e.jsx("div",{className:"text-token-text-secondary mt-2 flex items-center text-start",children:e.jsx(_e,{id:"resend-emails",checked:N,onChange:n=>ee(n.currentTarget.checked),label:b.formatMessage(s.resendEmailsFieldName)})}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx(U,{color:"secondary",size:l?"large":"medium",onClick:()=>C(!1),children:b.formatMessage(s.inviteMemberInviteBackButton)}),e.jsx(U,{color:"primary",size:l?"large":"medium",disabled:B||R.length===0||V.length>0,onClick:()=>{F(),K({buttonType:"Send"})},children:B?b.formatMessage(s.inviteMemberInviteSubmitButtonLoading):b.formatMessage(s.inviteMemberInviteSubmitButton)})]})]}):e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("input",{ref:te,type:"file",accept:".csv,text/csv",id:"upload-csv",className:"hidden",onChange:n=>{Z(n),v(!0)}}),V.length>0&&e.jsx("div",{className:"flex w-full items-center bg-red-100 p-4",children:e.jsxs("div",{className:"grow text-red-700",children:[e.jsx(E,r({},s.prohibitedExternalEmailDescription)),e.jsx("pre",{className:"my-1",children:V.join(", ")}),e.jsx(E,r({},s.prohibitedExternalEmailResolution))]})}),k?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-8 flex w-full items-center gap-3",children:[Math.max(u,Math.min(x,u)+S.length)<=ge&&e.jsx("div",{className:"bg-token-main-surface-secondary flex h-2 grow overflow-hidden rounded-3xl",children:Array(Fe(Math.max(u,Math.min(x,u)+S.length),0,ge)).fill(0).map((n,t)=>e.jsx("div",{className:O("border-token-bg-primary h-full grow border-e-2 last-of-type:border-0",Ke(t,u,x,S.length))},t))}),e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(E,Q(r({},s.seatsInvited),{values:{seatCount:u,enteredCount:Math.max(0,x)+S.length}}))})]}),e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx("label",{htmlFor:"add-member-emails",id:"add-emails-label",className:"sr-only",children:e.jsx(E,r({},s.addEmailsFieldName))}),!p&&$]}),e.jsx($e,{value:S,onChange:oe})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col gap-4",children:w.map((n,t)=>e.jsx(Ue,{email:n,index:t,emailInputList:w,setEmailInputList:A,setEmailTableRows:L,defaultInviteRole:P,shouldCheckDomainMismatch:a.isFreeWorkspace()},t))}),e.jsxs("div",{className:"align-center mb-4 flex justify-between",children:[e.jsx(U,{color:"secondary",onClick:()=>{A(n=>[...n,""])},icon:Ve,children:e.jsx(E,r({},s.addEmailButton))}),!p&&$]})]}),Math.max(0,x)+R.length-u>0&&!I&&!a.isFreeWorkspace()&&e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(E,Q(r({},s.seatsExceeded),{values:{exceeded:Math.max(0,x)+R.length-u}}))})]}),e.jsx("div",{className:O("flex w-full flex-shrink-0 flex-col gap-2",p?"mt-0":"mt-8"),children:p?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:O("flex w-full gap-2",l?"flex-col":"items-center justify-between"),children:[e.jsx("div",{className:O(l?"w-full":"flex-shrink-0"),children:$}),e.jsx("div",{className:O(l?"w-full":"flex-shrink-0"),children:G()})]}),g()]}):e.jsxs(e.Fragment,{children:[G(),g()]})})]})}function $e(a){const i=xe(),o=d.useMemo(()=>i==null?void 0:i.subscriptionAnalyticsParams,[i]),f=d.useCallback(l=>{q.logEvent("Account Pay: Collaborator Emails Added",r(r({},o),l))},[o]),M=d.useCallback(l=>{q.logEvent("Account Pay: Collaborator Email Removed",r(r({},o),l))},[o]);return e.jsx(Pe,r({trackEmailsAdded:f,trackEmailRemoved:M},a))}function Ge(a,i){"use no forget";const o=ae(),f=ve(),M=fe(f),l=Ie();return we({mutationFn:async({emails:u,role:x,resendEmails:h})=>{const y=[],p=Math.max(5,Math.round(u.length/10));for(let v=0;v<u.length;v+=p)y.push(u.slice(v,v+p));const b=async v=>Ne.safePost("/accounts/{account_id}/invites",{parameters:{path:{account_id:a}},requestBody:{email_addresses:v,role:x,resend_emails:h}}).then(j=>(j.errored_emails.length>0&&M.danger(o.formatMessage(s.inviteMessageFailure,{emailsStr:j.errored_emails.map(({email_address:C,error:I})=>"".concat(C,": ").concat(I)).join(", ")}),{loggingTitle:"Failed to invite members",toastId:"admin_invite",loggingDescription:s.inviteMessageFailure.defaultMessage}),j.account_invites)).catch(j=>{throw M.danger(j.message,{toastId:"admin_invite",loggingTitle:"Failed to invite members",loggingDescription:j.message}),j});return(await Promise.all(y.map(v=>b(v)))).flat()},onSuccess:()=>{l.invalidateQueries({queryKey:["workspace","invites",a]}),i==null||i()}})}function Ye(a,i,o,f,M){return new Promise(l=>{if(a.size/1048576>he)l({status:"error",reason:"file_too_large"});else if(a.type!=="text/csv")l({status:"error",reason:"invalid_file_type"});else{const x=new FileReader;x.readAsText(a),x.onload=function(h){var j;let y=f;const b=((j=h.target)==null?void 0:j.result).split("\n"),k=new Set,v=b.reduce((C,I)=>{var R;const[c,w]=I.split(",").map(S=>S.trim());return ie.test(c)&&!k.has(c)&&(i[w]===void 0&&!y&&(y=!0),C.push({email:c,role:M?o:(R=i[w])!=null?R:o})),k.add(c),C},[]);l({status:"success",newRows:v,hasWarning:y})}}})}const Qe=a=>{const i={member:"member"};return a&&(i.admin="admin",i.owner="owner"),i},s=Ce({addEmailsFieldName:{id:"admin-invite.addEmailsFieldName.0",defaultMessage:"Emails"},unspecifiedRoleDescription:{id:"admin-invite.unspecifiedRoleDescription",defaultMessage:"Roles that were unspecified have been changed to Member."},prohibitedExternalEmailDescription:{id:"admin-invite.prohibitedExternalEmailDescription",defaultMessage:"The following emails are not a part of your organization's verified domains:"},prohibitedExternalEmailResolution:{id:"admin-invite.prohibitedExternalEmailResolution",defaultMessage:'Either remove these emails, enable "Allow External Domain Invites" from your workspace settings, or verify these email domains.'},inviteTableHeaderEmail:{id:"admin-invite.inviteTableHeaderEmail",defaultMessage:"Email"},inviteTableHeaderRole:{id:"admin-invite.inviteTableHeaderRole",defaultMessage:"Role"},inviteRoleMember:{id:"admin-invite.inviteRoleMember",defaultMessage:"Member"},inviteRoleAdmin:{id:"admin-invite.inviteRoleAdmin",defaultMessage:"Admin"},inviteRoleOwner:{id:"admin-invite.inviteRoleOwner",defaultMessage:"Owner"},fileTooLargeWarning:{id:"admin-invite.fileTooLargeWarning",defaultMessage:"File is too large. Please upload a CSV file smaller than {maxSize}."},fileIncorrectTypeWarning:{id:"admin-invite.fileIncorrectTypeWarning",defaultMessage:"Please upload a CSV file."},resendEmailsFieldName:{id:"admin-invite.resendEmailsFieldName",defaultMessage:"Resend emails for existing invites"},inviteMessageLoading:{id:"admin-invite.inviteMessageLoading",defaultMessage:"Sending out {numRows} invites, this may take a minute..."},inviteSuccessToast:{id:"admin-invite.inviteSuccessToast",defaultMessage:"Invited {numRows} {userStr} to {workspaceName}"},inviteMemberInviteNextButton:{id:"admin-invite.inviteMemberInviteNextButton",defaultMessage:"Next"},inviteMemberInviteSubmitButton:{id:"admin-invite.inviteMemberInviteSubmitButton",defaultMessage:"Send invites"},inviteMemberInviteSubmitButtonLoading:{id:"admin-invite.inviteMemberInviteSubmitButtonLoading",defaultMessage:"Sending invites..."},inviteMemberInviteBackButton:{id:"admin-invite.inviteMemberInviteBackButton",defaultMessage:"Back"},inviteMessageFailure:{id:"admin-invite.inviteMessageFailure",defaultMessage:"Unable to invite {emailsStr}"},importCSVButton:{id:"admin-invite.importCSVButton",defaultMessage:"Upload CSV"},reimportCSVButton:{id:"admin-invite.reimportCSVButton",defaultMessage:"Re-upload CSV"},importCSVTooltip:{id:"admin-invite.importCSVTooltip",defaultMessage:"Upload a CSV file. Your file must include an email on each line."},seatsInvited:{id:"admin-invite.seatsInvited",defaultMessage:"{enteredCount} of {seatCount} users"},seatsExceeded:{id:"admin-invite.seatsExceeded",defaultMessage:"Inviting these users will bill {exceeded} additional {exceeded, plural, one {user} other {users}} on your workspace."},emailInputPlaceholder:{id:"admin-invite.emailInputPlaceholder",defaultMessage:"Email"},addEmailButton:{id:"admin-invite.addEmailButton",defaultMessage:"Add more"},duplicateEmailWarning:{id:"admin-invite.duplicateEmailWarning",defaultMessage:"This email is a duplicate."},invalidEmailWarning:{id:"admin-invite.invalidEmailWarning",defaultMessage:"Please enter a valid email address."},mismatchedDomainWarning:{id:"admin-invite.mismatchedDomainWarning",defaultMessage:"Enter an email address with the {domain} domain."}});export{sa as A};
//# sourceMappingURL=bbjo050o29nnp22b.js.map
