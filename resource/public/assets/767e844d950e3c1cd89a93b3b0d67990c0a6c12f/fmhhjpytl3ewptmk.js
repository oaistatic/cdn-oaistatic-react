var re=Object.freeze,ce=Object.defineProperty,Ee=Object.defineProperties;var Ve=Object.getOwnPropertyDescriptors;var oe=Object.getOwnPropertySymbols;var De=Object.prototype.hasOwnProperty,Te=Object.prototype.propertyIsEnumerable;var de=(e,t,n)=>t in e?ce(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,J=(e,t)=>{for(var n in t||(t={}))De.call(t,n)&&de(e,n,t[n]);if(oe)for(var n of oe(t))Te.call(t,n)&&de(e,n,t[n]);return e},Q=(e,t)=>Ee(e,Ve(t));var te=(e,t)=>re(ce(e,"raw",{value:re(t||e.slice())}));import{h as ae,r as w,j as a,e as ve,M as ge}from"./mw35uwhq4g8r9eam.js";import{n1 as Ae,eF as Fe,dB as Oe,dK as Pe,dC as Le,dD as Ge,dF as Re,cF as V,dJ as Be,h5 as ze,aA as K,fG as We,ek as $e,e5 as ee,ax as me,cu as je,u as He,O as Ue,aw as Ke,cB as be,dh as qe,di as Je,M as Qe,m as Ye,a7 as Y,_ as X,fr as Z,p as Xe}from"./d0xa318sl7ywi0za.js";import{S as Ze}from"./f89v9mtyvakgmoul.js";import{S as ea}from"./oftnd9rlobxeh2e2.js";import{jE as aa,jF as ta,cF as sa,jG as na,cB as D,hr as ia,jH as la,jI as q,ee as ra,ef as _e,e1 as oa,hl as da,jJ as ca,hm as ga,jK as ma,eT as ye,eV as Me,dE as ke,jL as ua,bu as fa,aG as xa}from"./g2euln7v5pbm31qa.js";import{D as Ce,u as ha,I as se}from"./mn6hno74yixdlr64.js";import{D as pa}from"./jybdx70geuzrnoab.js";import"./e5bg4yzr7nht9sxr.js";const Ia={enter:e=>({zIndex:0,x:e===-1?"10%":"-10%",opacity:0}),center:{zIndex:1,x:0,opacity:1},exit:e=>({zIndex:0,x:e===1?"10%":"-10%",opacity:0})},wa={enter:{opacity:0,y:"10%"},visible:{opacity:1,y:0},exit:{opacity:0,y:"10%"}},ue=1e3,fe=1e3,xe=(e,t)=>Math.abs(e)*t;function va(e){var v,M;const t=ae(),n=Ae(),r=Fe(),[u,b]=w.useState({width:0,height:0}),[m,c]=w.useState(!1),[o,f]=w.useState(e.image),[I,C]=w.useState(!1),N=u.width>0&&u.height>0,y=w.useRef(null),[S,j]=w.useState(0);w.useEffect(()=>{if(!o.url)throw new Error("ExpandableImage requires a src");const s=new Image;s.onload=()=>{b({width:s.naturalWidth,height:s.naturalHeight})},s.onerror=()=>{},s.src=o.url},[o.url]),w.useEffect(()=>{const s=y.current;if(I)return s==null||s.addEventListener("keydown",d),()=>{s==null||s.removeEventListener("keydown",d)};f(e.image)},[I]);function l(){f(s=>{const h=(e.images.findIndex(p=>p.url===s.url)+1)%e.images.length;return e.images[h]}),j(-1)}function x(){f(s=>{const g=e.images.findIndex(p=>p.url===s.url),h=g>0?(g-1)%e.images.length:e.images.length-1;return e.images[h]}),j(1)}function i(s){var g;C(s),s&&((g=e.onOpen)==null||g.call(e,o))}function d(s){s.key==="ArrowLeft"?x():s.key==="ArrowRight"&&l()}const _=e.images.findIndex(s=>s.url===o.url);return a.jsxs(Oe,{onOpenChange:i,children:[a.jsx(Pe,{disabled:!N,className:e.className,"aria-label":t.formatMessage(E.showImage),children:e.children}),a.jsx(Le,{container:n==null?void 0:n.document.body,children:a.jsx(Ge,{className:"radix-state-open:animate-show fixed inset-0 z-20 flex items-center justify-center bg-black/90 backdrop-blur-xl",children:a.jsxs(Re,{className:V("radix-state-open:animate-contentShow relative flex h-[100dvh] w-screen justify-stretch divide-x divide-white/10 focus:outline-hidden"),ref:y,children:[a.jsx("div",{className:V("flex flex-1 transition-[flex-basis]",!m&&"md:basis-[75vw]"),children:a.jsxs("div",{className:"flex flex-1 flex-col md:p-6",children:[a.jsxs("div",{className:"flex justify-between px-6 py-2 pt-6 text-white sm:mb-4 md:mt-2 md:px-0 md:py-2",children:[a.jsx(Be,{asChild:!0,children:a.jsx("button",{"aria-label":t.formatMessage(E.closeModal),children:a.jsx(ze,{})})}),a.jsx("div",{children:r&&a.jsxs(a.Fragment,{children:[(M=(v=e.getActions)==null?void 0:v.call(e,o))==null?void 0:M.map((s,g)=>a.jsx(K,{color:"ghost",size:"small",onClick:s.onClick,"aria-label":s.ariaLabel,disabled:s.disabled,icon:s.icon},g)),a.jsx(K,{color:"ghost",size:"small",onClick:()=>c(s=>!s),"aria-label":t.formatMessage(E.toggleSidebar),className:"md:inline-flex",icon:We})]})})]}),a.jsx("div",{className:"relative flex flex-1 flex-col items-center justify-center overflow-hidden",children:a.jsx($e,{initial:!1,custom:S,children:a.jsxs(ee.div,{className:"absolute grid h-full w-full grid-rows-2",custom:S,variants:Ia,drag:"x",dragConstraints:{left:0,right:0},dragElastic:1,onDragEnd:(s,{offset:g,velocity:h})=>{const p=xe(g.x,h.x);p<-ue?l():p>ue&&x()},children:[a.jsx(ee.img,{src:o.url,alt:o.alt,className:"row-span-4 mx-auto h-full object-scale-down",onPanEnd:(s,{offset:g,velocity:h})=>{const p=xe(g.y,h.y);p<-fe?c(!0):p>fe&&c(!1)}},o.url),!r&&m&&a.jsx(ee.div,{className:"flex text-white",variants:wa,initial:"enter",animate:"visible",exit:"exit",transition:{y:{type:"spring",stiffness:300,damping:30},opacity:{duration:.2}},children:e.metadataRenderer(o)})]},o.url)})}),e.images.length>1?a.jsxs("div",{className:"flex items-center justify-center gap-4 p-8 text-white",children:[a.jsx(K,{color:"ghost",size:"small",onClick:x,"aria-label":t.formatMessage(E.previousImage),icon:Ze}),e.images.map((s,g)=>{var h;return a.jsx("img",{src:s.url,alt:(h=s.alt)!=null?h:"",className:V("h-12 w-12 cursor-pointer rounded-sm object-cover transition duration-300 hover:opacity-100",s.url===o.url?"ring-2 ring-white ring-offset-4 ring-offset-black":"opacity-25"),onClick:()=>{f(s),j(g<_?1:-1)},"aria-label":t.formatMessage(E.showImage),role:"button"},s.url)}),a.jsx(K,{color:"ghost",size:"small",onClick:l,"aria-label":t.formatMessage(E.nextImage),icon:ea})]}):null]})}),a.jsx("div",{className:V("hidden items-center justify-start overflow-hidden bg-gray-900 text-white transition-[flex-basis] duration-500 md:flex",m?"md:basis-[25vw]":"md:basis-0"),children:a.jsx("div",{className:"w-[25vw] min-w-[25vw]",children:e.metadataRenderer(o)})})]})})})]})}const E=ve({showImage:{id:"imageViewer.showImage",defaultMessage:"Show Image"},closeModal:{id:"imageViewer.closeModal",defaultMessage:"Close Modal"},toggleSidebar:{id:"imageViewer.toggleSidebar",defaultMessage:"Toggle Sidebar"},nextImage:{id:"imageViewer.nextImage",defaultMessage:"Next Image"},previousImage:{id:"imageViewer.previousImage",defaultMessage:"Previous Image"}});function ja({withLottie:e}){return a.jsxs("div",{className:"absolute start-0 top-0 flex h-full w-full items-center justify-center rounded-full",children:[a.jsx(pa,{animate:e,matchTextColor:!0,className:"h-6 w-6"}),a.jsx(ba,{})]})}function ba(){const[t,n]=w.useState(new Date);w.useEffect(()=>{n(new Date)},[]);const r=aa(+t,25e3);return a.jsx(ta,{percentage:r,thickness:1.25/23,className:"absolute start-1/2 top-1/2 h-10 w-10 -translate-x-1/2 -translate-y-1/2",backgroundStrokeClassName:"stroke-token-main-surface-tertiary",transitionDuration:"".concat((100-r)/100*.2,"s"),transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)"})}function La({messages:e,clientThreadId:t,disableClickThru:n=!1}){const[r,u]=e,b=sa(r),m=na(),c=e.some(I=>m.has(I.id));let o=null;u!=null&&me.isMultimodalTextMessage(u)&&(o=me.getImageAssetPointers(u));let f=D.Running;return o!=null?f=D.Finished:u!=null?f=D.Error:b&&(f=D.Stopped),a.jsx(Ce.Provider,{value:n,children:!c&&a.jsx(ya,{imageAssets:o!=null?o:[],clientThreadId:t,toolStatus:f,toolMessage:u,messageId:r.id})})}const _a="https://help.openai.com/en/articles/8932459",ya=({imageAssets:e,clientThreadId:t,toolMessage:n,toolStatus:r,messageId:u})=>{const b=ae(),m=je(t),c=ia(e,void 0,m),o=He(),f=Ue(o),I=la(t),C=w.useMemo(()=>r===D.Finished&&c.every(l=>!!l.data),[r,c]);if((n==null?void 0:n.content.content_type)===Ke.SystemError)return null;const N=Ne(e[0]),y=c.map(l=>l.data).filter(l=>l!=null),S=y.map(l=>Q(J({},l),{alt:q(l)})),j=(l=0)=>"".concat(u,"-image-").concat(l);return a.jsxs("div",{children:[a.jsxs(Na,{$numItems:c.length,className:"my-1 transition-opacity duration-300",children:[c.length===0&&r===D.Running&&a.jsx(he,{layoutId:"loading:placeholder",shape:N,isToolRunning:!0},"loading"),c.map((l,x)=>{const{isLoading:i,data:d,error:_}=l;if(i)return a.jsx(he,{shape:N,layoutId:j(x)},x);if(_!=null||(d==null?void 0:d.url)==null)return a.jsx(ne,{layoutId:j(x),className:"text-token-text-tertiary text-sm",shape:N,children:a.jsx("div",{className:"flex min-h-full flex-col items-center justify-center gap-3 px-4 pb-5",children:b.formatMessage(k.imageLoadError)})},x);if(n&&d){const v=Q(J({},d),{alt:q(d)});return a.jsx(Ma,{image:v,allImages:S,clientThreadId:t,toolMessage:n,index:x,onOpenImageEditor:()=>{ra.setFocusedObject({type:_e.Image,image:v,allImages:y,messageId:n.id})}},x)}})]}),f&&C&&a.jsx("div",{className:"text-md text-token-text-tertiary flex flex-row items-center py-2",children:a.jsx("span",{className:"me-2",children:I?a.jsx(ge,{id:"xQcNUs",defaultMessage:"Made with the old version of image generation. <link>Learn more</link>",values:{link:l=>a.jsx("a",{className:"text-token-text-tertiary underline underline-offset-4",href:_a,target:"_blank",rel:"noopener noreferrer",children:l})}}):a.jsx(ge,{id:"hyynYz",defaultMessage:"Made with the old version of image generation. New version <link>available now</link>.",values:{link:l=>a.jsx("a",{className:"text-token-text-tertiary underline underline-offset-4",href:"https://openai.com/index/introducing-4o-image-generation/",target:"_blank",rel:"noopener noreferrer",children:l})}})})})]})};function Ma({toolMessage:e,clientThreadId:t,allImages:n,image:r,index:u,onOpenImageEditor:b}){const m=ae(),c=je(t),o=Ne(r),f=w.useContext(Ce),[I,C]=w.useState({}),N=ha({clientThreadId:t});async function y(i){ua(i,c,e.id,f)}function S(i){var d,_,v,M,s,g,h,p,T,A,F,O,P,L,G,R,B,z,W,$,H,U;Y.logEvent("chatgpt_dalle_image_view_full",null,{sourceOperation:(v=(_=(d=i.metadata)==null?void 0:d.dalle)==null?void 0:_.edit_op)!=null?v:"none",hasParent:(s=(M=i.metadata)==null?void 0:M.dalle)!=null&&s.parent_gen_id?"true":"false",model:"dalle"}),X.logEvent("chatgpt_dalle_image_view_full",{conversationId:c,messageId:e.id,generationId:(h=(g=i.metadata)==null?void 0:g.dalle)==null?void 0:h.gen_id,parentGenerationId:(T=(p=i.metadata)==null?void 0:p.dalle)==null?void 0:T.parent_gen_id,fileId:Z(i.asset_pointer),sourceOperation:(F=(A=i.metadata)==null?void 0:A.dalle)==null?void 0:F.edit_op,model:"dalle"}),Y.logEvent("chatgpt_image_view_full",null,{sourceOperation:(L=(P=(O=i.metadata)==null?void 0:O.dalle)==null?void 0:P.edit_op)!=null?L:"none",hasParent:(R=(G=i.metadata)==null?void 0:G.dalle)!=null&&R.parent_gen_id?"true":"false",model:"dalle"}),X.logEvent("chatgpt_image_view_full",{conversationId:c,messageId:e.id,generationId:(z=(B=i.metadata)==null?void 0:B.dalle)==null?void 0:z.gen_id,parentGenerationId:($=(W=i.metadata)==null?void 0:W.dalle)==null?void 0:$.parent_gen_id,fileId:Z(i.asset_pointer),sourceOperation:(U=(H=i.metadata)==null?void 0:H.dalle)==null?void 0:U.edit_op,model:"dalle"})}function j(i,d){var v,M,s,g,h,p,T,A,F,O,P,L,G,R,B,z,W,$,H,U,ie,le;C(Se=>Q(J({},Se),{[i.asset_pointer]:d}));const _=f?"chatgpt_dalle_image_captioning_rating":"chatgpt_dalle_image_rating";Y.logEvent(_,d?"like":"dislike",{liked:d?"true":"false",sourceOperation:(s=(M=(v=i.metadata)==null?void 0:v.dalle)==null?void 0:M.edit_op)!=null?s:"none",hasParent:(h=(g=i.metadata)==null?void 0:g.dalle)!=null&&h.parent_gen_id?"true":"false",model:"dalle"}),X.logEvent(_,{liked:d,conversationId:c,messageId:e.id,generationId:(T=(p=i.metadata)==null?void 0:p.dalle)==null?void 0:T.gen_id,parentGenerationId:(F=(A=i.metadata)==null?void 0:A.dalle)==null?void 0:F.parent_gen_id,fileId:Z(i.asset_pointer),sourceOperation:(P=(O=i.metadata)==null?void 0:O.dalle)==null?void 0:P.edit_op,model:"dalle"}),Y.logEvent("chatgpt_image_rating",d?"like":"dislike",{liked:d?"true":"false",sourceOperation:(R=(G=(L=i.metadata)==null?void 0:L.dalle)==null?void 0:G.edit_op)!=null?R:"none",hasParent:(z=(B=i.metadata)==null?void 0:B.dalle)!=null&&z.parent_gen_id?"true":"false",model:"dalle"}),X.logEvent("chatgpt_image_rating",{liked:d,conversationId:c,messageId:e.id,generationId:($=(W=i.metadata)==null?void 0:W.dalle)==null?void 0:$.gen_id,parentGenerationId:(U=(H=i.metadata)==null?void 0:H.dalle)==null?void 0:U.parent_gen_id,fileId:Z(i.asset_pointer),sourceOperation:(le=(ie=i.metadata)==null?void 0:ie.dalle)==null?void 0:le.edit_op,model:"dalle"})}function l(i){const d=I[i.asset_pointer],_={label:m.formatMessage(k.likeImage),onClick:()=>j(i,!0),disabled:d===!0,ariaLabel:m.formatMessage(k.likeImage),icon:ye},v={label:m.formatMessage(k.dislikeImage),onClick:()=>j(i,!1),disabled:d===!1,ariaLabel:m.formatMessage(k.dislikeImage),icon:Me},M={label:m.formatMessage(k.downloadImage),onClick:()=>y(i),ariaLabel:m.formatMessage(k.downloadImage),icon:ke};return[d!==!1&&_,d!==!0&&v,M].filter(Boolean)}let x=a.jsx(Ca,{image:r,shape:o,rating:I[r.asset_pointer],onDownload:()=>y(r),onRate:(i,d)=>j(i,d),clientThreadId:t,layoutId:void 0});return N?x=a.jsx("div",{role:"button",onClick:b,children:x}):f||(x=a.jsx(va,{image:r,images:n,metadataRenderer:i=>a.jsx(ka,{image:i}),onOpen:S,getActions:l,children:x})),a.jsx("div",{className:"flex",children:x},u)}function he({shape:e,layoutId:t,isToolRunning:n=!1}){const{isOpen:r}=oa();return a.jsx(ne,{shape:e,layoutId:r?void 0:t,children:a.jsx("div",{className:"flex min-h-full items-center justify-center",children:a.jsx(ja,{withLottie:n})})},"loading")}function ka({image:e}){const t=ae(),[n,r]=w.useState(!1),u=Xe();function b(m){const c=q(e);r(!0),xa(c,u,m),setTimeout(()=>{r(!1)},2e3)}return a.jsxs("div",{className:"flex flex-col items-start gap-3 p-6",children:[a.jsx("div",{className:"text-sm text-gray-300 sm:text-base",children:t.formatMessage(k.imageViewerMetadataTitle)}),a.jsx("div",{className:"max-h-32 overflow-y-auto text-sm md:max-h-[80vh] md:text-lg",children:q(e)}),a.jsx(K,{color:"primary",onClick:b,disabled:n,className:"hidden sm:block",icon:fa,children:n?t.formatMessage(k.imageViewerMetadataCopyButtonCopied):t.formatMessage(k.imageViewerMetadataCopyButton)})]})}function ne({children:e,shape:t,className:n,layoutId:r}){return a.jsxs(ee.div,{layoutId:r,className:V("relative",n,t==="1792x1024"&&"aspect-7/4",t==="1024x1024"&&"aspect-square max-w-[400px]",t==="1024x1792"&&"aspect-4/7 max-w-xs","overflow-hidden rounded-2xl"),children:[a.jsx("div",{className:"bg-token-main-surface-secondary pointer-events-none absolute inset-0"}),a.jsx("div",{className:"relative h-full",children:e})]})}function Ca({image:e,shape:t,rating:n,onDownload:r,onRate:u,clientThreadId:b,layoutId:m}){const c=qe(Je.isBusinessWorkspace),o=Qe(b,l=>l==null?void 0:l.mode),f=da(),I=ca(),C=(I==null?void 0:I.type)===_e.Image&&I.image.asset_pointer===e.asset_pointer,{url:N,width:y,height:S}=e,j=!c&&(o==null?void 0:o.kind)!==Ye.GizmoMagicCreate;return a.jsxs(ne,{shape:t,className:"group/dalle-image",layoutId:C?void 0:m,children:[a.jsx(ga,{alt:q(e),src:N,width:y,height:S}),a.jsx("div",{className:V("pointer-events-none absolute inset-0 rounded-2xl shadow-[inset_0_0_0_1px_rgba(0,0,0,0.1)] dark:shadow-[inset_0_0_0_1px_rgba(255,255,255,0.1)]",C?"bg-black/50 group-hover/dalle-image:bg-black/70":"group-hover/dalle-image:bg-transparent")}),f?!C&&a.jsx("div",{className:"pointer-events-none invisible absolute end-3 top-3 text-white group-hover/dalle-image:visible",children:a.jsx(ma,{})}):a.jsxs(a.Fragment,{children:[j&&a.jsxs(pe,{children:[n!==!1&&a.jsx(se,{icon:ye,selected:n===!0,onClick:l=>{l.stopPropagation(),u(e,!0)}}),n!==!0&&a.jsx(se,{icon:Me,selected:n===!1,onClick:l=>{l.stopPropagation(),u(e,!1)}})]}),a.jsx(pe,{$rightAlign:!0,children:a.jsx(se,{icon:ke,onClick:l=>{l.stopPropagation(),r()}})})]})]})}var Ie;const pe=be.div(Ie||(Ie=te(["invisible absolute top-3 flex gap-1 group-hover/dalle-image:visible z-2\n",""])),({$rightAlign:e})=>e?"end-3":"start-3");var we;const Na=be.div(we||(we=te(["grid gap-2\n",""])),({$numItems:e})=>e<=1?"grid-cols-1":"grid-cols-2");function Ne(e){if(!e)return"1024x1024";const{width:t,height:n}=e;return t>n?"1792x1024":t<n?"1024x1792":"1024x1024"}const k=ve({creatingImages:{id:"dalleMessage.creatingImagesV2",defaultMessage:"Creating image"},stopped:{id:"dalleMessage.stoppedV3",defaultMessage:"Stopped creating image"},errorCreating:{id:"dalleMessage.errorCreatingV2",defaultMessage:"Error creating image"},imageLoadError:{id:"dalleMessage.imageLoadError",defaultMessage:"Error loading image"},imageViewerMetadataTitle:{id:"dalleMessage.imageViewerMetadataTitle",defaultMessage:"Prompt"},imageViewerMetadataCopyButton:{id:"dalleMessage.imageViewerMetadataCopyButton",defaultMessage:"Copy"},imageViewerMetadataCopyButtonCopied:{id:"dalleMessage.imageViewerMetadataCopyButtonCopied",defaultMessage:"Copied!"},imageEditButton:{id:"dalleMessage.imageEditButton",defaultMessage:"Edit"},downloadImage:{id:"imageViewer.downloadImage",defaultMessage:"Download Image"},likeImage:{id:"imageViewer.likeImage",defaultMessage:"Like Image"},dislikeImage:{id:"imageViewer.dislikeImage",defaultMessage:"Dislike Image"}});export{La as default};
//# sourceMappingURL=fmhhjpytl3ewptmk.js.map
