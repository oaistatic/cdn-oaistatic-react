var E=Object.defineProperty,k=Object.defineProperties;var T=Object.getOwnPropertyDescriptors;var _=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,w=Object.prototype.propertyIsEnumerable;var m=(e,t,a)=>t in e?E(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,R=(e,t)=>{for(var a in t||(t={}))U.call(t,a)&&m(e,a,t[a]);if(_)for(var a of _(t))w.call(t,a)&&m(e,a,t[a]);return e},S=(e,t)=>k(e,T(t));import{y as $,a9 as y,d as L,r as c}from"./mw35uwhq4g8r9eam.js";import{p as A,iX as p,iY as f,R as P}from"./d0xa318sl7ywi0za.js";import{a as G}from"./ci57adu98ddr6ebh.js";async function I(e,t,a,o){const n=await P.safeGet("/connectors/{id}/oauth/callback",{parameters:{path:{id:e},query:{code:t,redirect_uri:a,state:o}}});return S(R({},n),{redirect_path:G(n.redirect_path).toString()})}const H=$(function(){const{pluginId:t}=y(),a=L(),o=c.useRef(!1),[n,C]=c.useState(""),{code:i,error:u,error_description:r,state:l}=Object.fromEntries(new URLSearchParams(n.substring(1)).entries());c.useEffect(()=>{C(window.location.hash)},[]),c.useEffect(()=>{if(o.current)return;if(t&&i&&l)o.current=!0;else{a("/");return}async function O(){var g;const b=window.location.origin+"/ccc/".concat(t,"/oauth/callback");if(!(!t||!i||!l))try{const s=await I(t,i,b,l);if(s.success){const h=new URL(p(f.OAUTH_SUCCESS,s.redirect_path),location.origin);h.searchParams.set("oauth_success","true"),a(h.pathname+h.search+h.hash)}else a(p(f.CUSTOM_ERROR,s.redirect_path,(g=s.error)!=null?g:s.message))}catch(s){a(p(f.CUSTOM_ERROR))}}O()},[t,i,l,a]);const d=A();return c.useEffect(()=>{u&&d.danger("".concat(u).concat(r?": ".concat(r):""),{duration:5,toastId:"oauth_callback: CCCOauth",loggingTitle:u,loggingDescription:r!=null?r:""})},[u,r,d]),null});export{H as default};
//# sourceMappingURL=n39nhdlhftenm2y1.js.map
