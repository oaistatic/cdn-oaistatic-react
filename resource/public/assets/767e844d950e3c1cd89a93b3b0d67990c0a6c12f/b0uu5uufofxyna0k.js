var Nt=Object.defineProperty;var at=Object.getOwnPropertySymbols;var yt=Object.prototype.hasOwnProperty,_t=Object.prototype.propertyIsEnumerable;var it=(e,s,a)=>s in e?Nt(e,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[s]=a,D=(e,s)=>{for(var a in s||(s={}))yt.call(s,a)&&it(e,a,s[a]);if(at)for(var a of at(s))_t.call(s,a)&&it(e,a,s[a]);return e};import{j as t,h as ut,M as rt,r as h}from"./mw35uwhq4g8r9eam.js";import{u as F,J as _,x as Tt,aJ as Pt,cF as b,aA as Ct,d as Et,a2 as vt,Q as It,fj as At,aa as $t,p as zt,je as Dt,fw as Ft,fx as Ot,gT as nt,_ as R,k as st,ab as ot,R as Bt,V as Lt,P as Wt,M as Rt,fq as Gt,fo as Ht}from"./d0xa318sl7ywi0za.js";import{jE as pt,jF as xt,m_ as ft,m$ as qt,dL as Jt,hU as Kt,n0 as Qt,jN as Vt,n1 as lt,n2 as Xt,jR as Yt,n3 as Zt,iE as Ut,jO as Mt}from"./g2euln7v5pbm31qa.js";import{CoT as te}from"./luqq85m92bytr6zc.js";import{M as dt}from"./of0vtq1gcmd3mc3z.js";import"./mdh3gu2zvzp3cu8r.js";import"./mpb8yfob3hqr4zw5.js";import"./e5bg4yzr7nht9sxr.js";import"./iue4s7sqsxkz98qq.js";import"./fhb510ji3eot09yv.js";import"./e237h6ukoc2vt16i.js";import"./cz2iwgzw4rck3xnv.js";import"./ejv9rjzfbwh1dn9a.js";import"./ck4rwz4bvjdsyeld.js";import"./e1vcfcyx8u6zde85.js";import"./fd8selpa9l1l2dzd.js";import"./juifnpcp74ymxcu2.js";import"./pbl95wx6493wq92j.js";import"./ddina39kz3r81pp7.js";import"./jybdx70geuzrnoab.js";import"./m1s7wxy82fhyl3zh.js";import"./m2d85ixk2zz51mk9.js";function ct({message:e,isCircular:s=!1}){var m,f,k;const a=5.333333333333334;let r=(f=(m=e==null?void 0:e.metadata)==null?void 0:m.pro_progress)!=null?f:0;const p=((k=e==null?void 0:e.metadata)==null?void 0:k.model_slug)==="o1-pro"?480*1e3:1200*1e3,l=e!=null&&e.create_time?e.create_time*1e3:Date.now(),u=pt(l,p);r=Math.max(u,r);const n=F(),c=_(n,"3208967109");return c&&(r=Math.max(r,a)),s?t.jsx(xt,{percentage:r,className:"me-4 w-full!",sizeOverride:20,thickness:1/8,transitionDuration:"".concat((100-r)/100*5,"s"),transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)"}):t.jsx(ft,{percentage:r,className:"me-4 w-full!",backgroundClassName:"bg-token-sidebar-surface-secondary dark:bg-token-border-default rounded-full",barClassName:"bg-token-text-secondary rounded-full",transitionDuration:"".concat((100-r)/100*5,"s"),transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)",height:c?4:8})}function mt({message:e,simulatedDuration:s=480*1e3,maxFill:a=100,isCircular:r=!1}){var c;((c=e==null?void 0:e.metadata)==null?void 0:c.model_slug)!=="o1-pro"&&(s=1200*1e3);const p=e!=null&&e.create_time?new Date(e.create_time*1e3):Date.now(),l=pt(+p,s),u=F(),n=_(u,"3208967109");return r?t.jsx(xt,{percentage:l,className:"me-4 w-full!",transitionDuration:"".concat((100-l)/100*5,"s"),transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)"}):t.jsx(ft,{percentage:Math.min(l,a),className:"me-4 w-full!",backgroundClassName:"bg-token-sidebar-surface-secondary rounded-full",barClassName:"bg-token-text-secondary rounded-full",transitionDuration:"".concat((100-l)/100*.2,"s"),transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)",height:n?4:8})}function ee({title:e,content:s,buttons:a,time:r,icon:p,size:l="default",progressBar:u,disabled:n=!1,onClick:c}){const m=l==="small"?"w-full flex max-w-[calc(0.8*var(--thread-content-max-width,40rem))] ps-[20px] pt-[13px] pb-[10px] ".concat(n?"":"gap-4"):"w-full gap-4 px-[22px] pb-[22px] pt-[18px]",f=c?"cursor-pointer":"",k=l==="small"?"text-[15px]":"",j=Tt(Pt);return t.jsxs("div",{className:b("relative inline-flex flex-col items-start justify-start rounded-2xl border","bg-token-bg-primary border-token-border-default box-content rounded-2xl border bg-clip-padding px-5 py-4",!j&&"mx-[calc(--spacing(-2)-1px)] -my-[1px] @max-3xl:-top-2 @3xl:-start-3 @3xl:-top-4",m,f,k),onClick:c,children:[t.jsxs("div",{className:b("flex flex-col items-start justify-start self-stretch",l!=="small"&&"gap-1.5"),children:[t.jsxs("div",{className:b("inline-flex items-start justify-start self-stretch",l!=="small"&&"gap-2"),children:[t.jsx("div",{className:b("shrink grow basis-0 leading-normal font-medium","text-token-text-secondary hover:text-token-text-primary"),children:e}),t.jsx("div",{className:"relative h-6 w-6"}),!n&&(p||t.jsx(qt,{className:"relative h-6 w-6"}))]}),t.jsx("div",{className:b("flex w-full flex-col items-start justify-start",l==="small"&&"mt-[-2px]"),children:t.jsx("div",{className:b("inline-flex w-full items-start justify-start self-stretch rounded-sm",l==="small"?"gap-1":"gap-2.5 py-1"),children:t.jsx("div",{className:b("w-full leading-relaxed font-normal",n?"text-token-text-tertiary":"text-token-text-secondary"),children:s})})})]}),u?t.jsxs("div",{className:b("mb-2 inline-flex items-center justify-between self-stretch",(a==null?void 0:a.length)&&"mt-[-10px]"),children:[u,a]}):t.jsxs("div",{className:"inline-flex items-center justify-end self-stretch",children:[r&&t.jsx("div",{className:"text-token-text-tertiary shrink grow basis-0 text-[15px] leading-normal font-normal",children:r}),t.jsx("div",{className:"flex gap-2",children:a})]})]})}function ae({errorNotice:e,onOpenSidebarSummarizer:s,isReceivingUpdates:a,lastMessage:r,latestTitle:p,summarizationHeadline:l,handleSkipClick:u}){var T,P,g,I,A,i,C;const n=F(),c=ut(),m=_(n,"4094234945"),f=_(n,"3208967109"),k=_(n,"3327816228"),j=m?ct:mt,w=a&&k&&((T=r==null?void 0:r.metadata)==null?void 0:T.pro_progress),O=(((P=r==null?void 0:r.metadata)==null?void 0:P.pro_skipped)||((g=r==null?void 0:r.clientMetadata)==null?void 0:g.proSkipPending))&&a;if(f){if(O)return t.jsx("span",{className:"result-streaming pulse relative pt-1",children:t.jsx("span",{})});const S=(A=a?p:(I=r==null?void 0:r.metadata)==null?void 0:I.finished_text)!=null?A:c.formatMessage({id:"hgnsat",defaultMessage:"Thinking"});return t.jsxs("div",{className:"flex items-start gap-3 pb-2",children:[t.jsxs("div",{className:"flex w-full flex-col",children:[t.jsxs("div",{className:"flex w-full items-center justify-between",children:[t.jsx("button",{type:"button",onClick:s,className:"group inline-flex max-w-full items-center rounded-md focus:outline-none",children:t.jsxs("span",{className:a?"loading-shimmer text-token-text-secondary inline-flex max-w-full items-center gap-0.5 truncate text-base leading-5 font-medium md:text-base":"text-token-text-tertiary hover:text-token-text-primary inline-flex max-w-full items-center gap-0.5 truncate text-base leading-5 font-medium md:text-base",children:[S,t.jsx(Jt,{className:"icon-xs text-token-text-tertiary group-hover:text-token-text-primary"})]})}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:u,className:"text-token-text-tertiary hover:text-token-text-primary whitespace-nowrap transition-opacity duration-1000 ease-out ".concat(w?"pointer-events-auto opacity-100":"pointer-events-none opacity-0"),"aria-hidden":!w,tabIndex:w?0:-1,children:t.jsx("span",{className:"flex items-center gap-0.5 underline decoration-dotted decoration-[8%]",children:t.jsx(rt,{id:"xMM6dg",defaultMessage:"Answer now"})})}),a&&t.jsx("div",{className:"ms-1 shrink-0 self-start md:hidden",children:t.jsx(j,{message:r,isCircular:!0})})]})]}),a&&t.jsx("div",{className:"mt-[22px] mb-2 hidden self-stretch md:inline-flex",children:t.jsx("div",{className:"w-full max-w-[150px]",children:t.jsx(j,{message:r,isCircular:!1})})})]}),e]})}return t.jsxs("div",{className:"flex pb-2",children:[t.jsx(ee,{buttons:a?[t.jsx(Ct,{onClick:S=>{S.stopPropagation(),s()},color:"secondary",className:"text-token-text-secondary h-[38px]! text-[15px] font-normal",children:t.jsx("div",{className:"px-1",children:t.jsx(rt,{id:"wQcuK8",defaultMessage:"Details"})})},"Details")]:[],time:null,title:l,icon:a?t.jsx("div",{className:""}):null,content:a?"".concat(p,"..."):(C=(i=r==null?void 0:r.metadata)==null?void 0:i.finished_text)!=null?C:"",size:"small",disabled:!a,onClick:s,progressBar:a?m?t.jsx(ct,{message:r}):t.jsx(mt,{message:r}):null}),e]})}const ie=/\*\*(.*?)(?:\*\*|\n|$)/g,re=e=>{let s=null,a;for(;(a=ie.exec(e))!=null;)s=a[1].trim();return s};function Ce({messages:e,isStreaming:s,isCompletionRequestInProgress:a,hasActiveRequest:r,isLastMessage:p,isFinalTurn:l,isFeedbackEnabled:u,conversation:n,currentGroupedMessageIndex:c,turnIndex:m}){var J,K,Q,V,X,Y,Z,U,M,tt,et;const f=F(),[k,j]=h.useState(""),[w,O]=h.useState(!1),[T,P]=h.useState(!1),g=Et(n.serverId$),I=((J=Kt(n.id))==null?void 0:J.value)===vt.STREAMING,A=Qt(It(n.id)),i=At(e),C=i==null?void 0:i.id,S=(K=i==null?void 0:i.metadata)==null?void 0:K.initial_text,$=(Q=i==null?void 0:i.metadata)==null?void 0:Q.summarization_headline,z=e.map(d=>$t(d)).join("\n\n"),B=ut(),L=zt(),x=(V=i==null?void 0:i.metadata)==null?void 0:V.async_task_id;Vt(x,i,n.id),Dt(x);const o=Ft(d=>Ot.getTask(x!=null?x:"",d)),G=h.useCallback(()=>{x?lt(n,{type:"cot",turnIndex:m,reasoningGroupIndex:c}):lt(n,{type:"summarizer",currentGroupedMessageIndex:c,turnIndex:m})},[n,c,m,x]),ht=Xt(f),kt=(X=o==null?void 0:o.taskId)==null?void 0:X.startsWith("thinking"),H=ht&&o&&nt(o)&&!kt;h.useEffect(()=>{if(!H){P(!1);return}T||(Yt(n,{type:"cot",turnIndex:m,reasoningGroupIndex:c}),P(!0))},[n,H,G,T,c,m]);const jt=h.useCallback(()=>{if(!g||!(i!=null&&i.id))return;R.logEventWithStatsig("chatgpt_web_pro_skip_clicked","chatgpt_web_pro_skip_clicked",{conversationId:g,messageId:i.id});const d=i.id,y=i.clientMetadata?D({},i.clientMetadata):void 0,E=i.metadata?D({},i.metadata):void 0;st(n.id,W=>{ot.updateTree(W,v=>{v.updateNodeMetadata(d,{proSkipPending:!0}),v.updateNodeMessageMetadata(d,{pro_skipped:!0})})}),Bt.safePost("/pro_mode/{conversation_id}/skip",{parameters:{path:{conversation_id:g}}}).catch(()=>{L.danger(B.formatMessage({id:"summmarizer.skip.toast",defaultMessage:"Failed to answer now. Please try again."}),{hasCloseButton:!0,toastId:"summarizer_skip_failed"}),st(n.id,W=>{ot.updateTree(W,v=>{v.updateNodeMetadata(d,{proSkipPending:y==null?void 0:y.proSkipPending}),v.updateNodeMessageMetadata(d,{pro_skipped:E==null?void 0:E.pro_skipped})})})})},[n.id,g,B,i,L]),q=_(f,"3208967109"),bt=Zt({taskId:o==null?void 0:o.taskId,intl:B,toaster:L});h.useEffect(()=>{const d=re(z);if(d){j(d);return}if(q&&$!=null){j($);return}S!=null&&j(S)},[z,$,q,S]),h.useEffect(()=>{z.length>0&&O(!0)},[z]),h.useEffect(()=>{w&&R.logEvent("Tool: Received a8km123 message",{client_thread_id:n.id,message_id:C,conversationId:n.serverId$()})},[w]);const gt=l&&p&&(I||s),St=Lt.isLastActorMessage(Wt(n.id),e[0].id),wt=!!Rt(n.id,d=>d==null?void 0:d.sharedConversationMetadata),N=Ut(e[0],St,a||r,wt);if(x){const d=o?nt(o):!1,y=(x.startsWith("thinking")||x.startsWith("pro"))&&d&&(o==null?void 0:o.status)!==Gt.SKIPPING,E=()=>{R.logEventWithStatsig("chatgpt_web_pro_skip_clicked","chatgpt_web_pro_skip_clicked",{conversationId:n.id,messageId:C}),bt.mutate()};return t.jsx(te,{isStreaming:d,isFinalAssistantTurn:l,isAgentTurn:!1,taskType:o?Ht(o):void 0,activeTask:o,messageGroups:Mt((Y=o==null?void 0:o.rows)!=null?Y:[]).groups,conversation:n,turnIndex:m,currentGroupedMessageIndex:c,latestError:N?D({messageId:e[0].id,conversation:n},N):void 0,isAutoswitchOptOutEnabled:y,handleSkipClick:y?E:void 0})}return!A&&((U=(Z=i==null?void 0:i.metadata)==null?void 0:Z.finish_details)==null?void 0:U.type)==="interrupted"&&((tt=(M=i==null?void 0:i.metadata)==null?void 0:M.finish_details)==null?void 0:tt.reason)!=="server_timeout"||(et=i==null?void 0:i.clientMetadata)!=null&&et.err?t.jsx("div",{children:N&&t.jsx(dt,{errorState:N,nodeId:e[0].id,isFeedbackEnabled:u,conversation:n,isUserTurn:!1})}):t.jsx(ae,{errorNotice:N&&t.jsx(dt,{errorState:N,nodeId:e[0].id,isFeedbackEnabled:u,conversation:n,isUserTurn:!1}),onOpenSidebarSummarizer:G,isReceivingUpdates:gt,lastMessage:i,latestTitle:k,summarizationHeadline:$,handleSkipClick:jt})}export{Ce as default};
//# sourceMappingURL=b0uu5uufofxyna0k.js.map
