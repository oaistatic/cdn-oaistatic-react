var dn=Object.defineProperty,fn=Object.defineProperties;var pn=Object.getOwnPropertyDescriptors;var Re=Object.getOwnPropertySymbols;var lt=Object.prototype.hasOwnProperty,dt=Object.prototype.propertyIsEnumerable;var Ke=(e,n,t)=>n in e?dn(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,de=(e,n)=>{for(var t in n||(n={}))lt.call(n,t)&&Ke(e,t,n[t]);if(Re)for(var t of Re(n))dt.call(n,t)&&Ke(e,t,n[t]);return e},ke=(e,n)=>fn(e,pn(n));var ft=(e,n)=>{var t={};for(var r in e)lt.call(e,r)&&n.indexOf(r)<0&&(t[r]=e[r]);if(e!=null&&Re)for(var r of Re(e))n.indexOf(r)<0&&dt.call(e,r)&&(t[r]=e[r]);return t};var j=(e,n,t)=>Ke(e,typeof n!="symbol"?n+"":n,t);import{p as hn,aZ as vn,aT as Le,a as mn,w as bn,uC as yn,aL as Sn,au as gn,uD as pt,jv as ee,m as ht,mw as wn}from"./d0xa318sl7ywi0za.js";import{ih as Qe,ne as V,qb as Tn,qc as kn,lY as De,qd as ve,qe as Cn,qf as _n,qg as En,qh as In,qi as vt,qj as Mn,qk as xn,ql as Pn,qm as An,qn as On,qo as Rn,qp as Rt,qq as tt,qr as Ln,qs as Dn,qt as Nn,pT as qn,ma as Un,qu as Vn,qv as $n,qw as Fn,qx as Ne,qy as jn,qz as Wn,qA as mt,qB as bt,qC as zn,qD as Yn,qE as yt,le as Qn,qF as Gn,qG as Bn,qH as Jn}from"./g2euln7v5pbm31qa.js";import{r as a,j as nt,h as Kn}from"./mw35uwhq4g8r9eam.js";import{L as Hn,R as w,T as Q,P as I,a as re,C as W}from"./ftef8970ba1zoykr.js";const Zn=()=>{const e=hn(),n=Qe(),t=a.useCallback(()=>n.getState().isVoiceModeActive,[n]);return a.useMemo(()=>new Proxy(e,{get(r,o){const i=r[o];return t()||o==="closeAll"?i:()=>{}}}),[t,e])};var Xn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function er(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Lt={exports:{}};(function(e){(function(n,t){e.exports?e.exports=t():n.log=t()})(Xn,function(){var n=function(){},t="undefined",r=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),o=["trace","debug","info","warn","error"],i={},c=null;function u(f,x){var m=f[x];if(typeof m.bind=="function")return m.bind(f);try{return Function.prototype.bind.call(m,f)}catch(g){return function(){return Function.prototype.apply.apply(m,[f,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(f){return f==="debug"&&(f="log"),typeof console===t?!1:f==="trace"&&r?s:console[f]!==void 0?u(console,f):console.log!==void 0?u(console,"log"):n}function h(){for(var f=this.getLevel(),x=0;x<o.length;x++){var m=o[x];this[m]=x<f?n:this.methodFactory(m,f,this.name)}if(this.log=this.debug,typeof console===t&&f<this.levels.SILENT)return"No console available for logging"}function C(f){return function(){typeof console!==t&&(h.call(this),this[f].apply(this,arguments))}}function _(f,x,m){return l(f)||C.apply(this,arguments)}function y(f,x){var m=this,g,P,U,O="loglevel";typeof f=="string"?O+=":"+f:typeof f=="symbol"&&(O=void 0);function oe(E){var A=(o[E]||"silent").toUpperCase();if(!(typeof window===t||!O)){try{window.localStorage[O]=A;return}catch(z){}try{window.document.cookie=encodeURIComponent(O)+"="+A+";"}catch(z){}}}function G(){var E;if(!(typeof window===t||!O)){try{E=window.localStorage[O]}catch(L){}if(typeof E===t)try{var A=window.document.cookie,z=encodeURIComponent(O),b=A.indexOf(z+"=");b!==-1&&(E=/^([^;]+)/.exec(A.slice(b+z.length+1))[1])}catch(L){}return m.levels[E]===void 0&&(E=void 0),E}}function H(){if(!(typeof window===t||!O)){try{window.localStorage.removeItem(O)}catch(E){}try{window.document.cookie=encodeURIComponent(O)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(E){}}}function F(E){var A=E;if(typeof A=="string"&&m.levels[A.toUpperCase()]!==void 0&&(A=m.levels[A.toUpperCase()]),typeof A=="number"&&A>=0&&A<=m.levels.SILENT)return A;throw new TypeError("log.setLevel() called with invalid level: "+E)}m.name=f,m.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},m.methodFactory=x||_,m.getLevel=function(){var E;return(E=U!=null?U:P)!=null?E:g},m.setLevel=function(E,A){return U=F(E),A!==!1&&oe(U),h.call(m)},m.setDefaultLevel=function(E){P=F(E),G()||m.setLevel(E,!1)},m.resetLevel=function(){U=null,H(),h.call(m)},m.enableAll=function(E){m.setLevel(m.levels.TRACE,E)},m.disableAll=function(E){m.setLevel(m.levels.SILENT,E)},m.rebuild=function(){if(c!==m&&(g=F(c.getLevel())),h.call(m),c===m)for(var E in i)i[E].rebuild()},g=F(c?c.getLevel():"WARN");var B=G();B!=null&&(U=F(B)),h.call(m)}c=new y,c.getLogger=function(f){if(typeof f!="symbol"&&typeof f!="string"||f==="")throw new TypeError("You must supply a name when creating a logger.");var x=i[f];return x||(x=i[f]=new y(f,c.methodFactory)),x};var M=typeof window!==t?window.log:void 0;return c.noConflict=function(){return typeof window!==t&&window.log===c&&(window.log=M),c},c.getLoggers=function(){return i},c.default=c,c})})(Lt);var tr=Lt.exports;const nr=er(tr);var rt=function(e,n){return rt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])},rt(e,n)};function te(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");rt(e,n);function t(){this.constructor=e}e.prototype=n===null?Object.create(n):(t.prototype=n.prototype,new t)}function rr(e,n,t,r){function o(i){return i instanceof t?i:new t(function(c){c(i)})}return new(t||(t=Promise))(function(i,c){function u(h){try{l(r.next(h))}catch(C){c(C)}}function s(h){try{l(r.throw(h))}catch(C){c(C)}}function l(h){h.done?i(h.value):o(h.value).then(u,s)}l((r=r.apply(e,[])).next())})}function Dt(e,n){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,c=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return c.next=u(0),c.throw=u(1),c.return=u(2),typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function u(l){return function(h){return s([l,h])}}function s(l){if(r)throw new TypeError("Generator is already executing.");for(;c&&(c=0,l[0]&&(t=0)),t;)try{if(r=1,o&&(i=l[0]&2?o.return:l[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,l[1])).done)return i;switch(o=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,o=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){t.label=l[1];break}if(l[0]===6&&t.label<i[1]){t.label=i[1],i=l;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(l);break}i[2]&&t.ops.pop(),t.trys.pop();continue}l=n.call(e,t)}catch(h){l=[6,h],o=0}finally{r=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function ye(e){var n=typeof Symbol=="function"&&Symbol.iterator,t=n&&e[n],r=0;if(t)return t.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}function Fe(e,n){var t=typeof Symbol=="function"&&e[Symbol.iterator];if(!t)return e;var r=t.call(e),o,i=[],c;try{for(;(n===void 0||n-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(u){c={error:u}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(c)throw c.error}}return i}function je(e,n,t){if(arguments.length===2)for(var r=0,o=n.length,i;r<o;r++)(i||!(r in n))&&(i||(i=Array.prototype.slice.call(n,0,r)),i[r]=n[r]);return e.concat(i||Array.prototype.slice.call(n))}function be(e){return this instanceof be?(this.v=e,this):new be(e)}function or(e,n,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(e,n||[]),o,i=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),u("next"),u("throw"),u("return",c),o[Symbol.asyncIterator]=function(){return this},o;function c(y){return function(M){return Promise.resolve(M).then(y,C)}}function u(y,M){r[y]&&(o[y]=function(f){return new Promise(function(x,m){i.push([y,f,x,m])>1||s(y,f)})},M&&(o[y]=M(o[y])))}function s(y,M){try{l(r[y](M))}catch(f){_(i[0][3],f)}}function l(y){y.value instanceof be?Promise.resolve(y.value.v).then(h,C):_(i[0][2],y)}function h(y){s("next",y)}function C(y){s("throw",y)}function _(y,M){y(M),i.shift(),i.length&&s(i[0][0],i[0][1])}}function ir(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=e[Symbol.asyncIterator],t;return n?n.call(e):(e=typeof ye=="function"?ye(e):e[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(i){t[i]=e[i]&&function(c){return new Promise(function(u,s){c=e[i](c),o(u,s,c.done,c.value)})}}function o(i,c,u,s){Promise.resolve(s).then(function(l){i({value:l,done:u})},c)}}function R(e){return typeof e=="function"}function it(e){var n=function(r){Error.call(r),r.stack=new Error().stack},t=e(n);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var He=it(function(e){return function(n){e(this),this.message=n?n.length+" errors occurred during unsubscription:\n"+n.map(function(t,r){return r+1+") "+t.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=n}});function We(e,n){if(e){var t=e.indexOf(n);0<=t&&e.splice(t,1)}}var _e=(function(){function e(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var n,t,r,o,i;if(!this.closed){this.closed=!0;var c=this._parentage;if(c)if(this._parentage=null,Array.isArray(c))try{for(var u=ye(c),s=u.next();!s.done;s=u.next()){var l=s.value;l.remove(this)}}catch(f){n={error:f}}finally{try{s&&!s.done&&(t=u.return)&&t.call(u)}finally{if(n)throw n.error}}else c.remove(this);var h=this.initialTeardown;if(R(h))try{h()}catch(f){i=f instanceof He?f.errors:[f]}var C=this._finalizers;if(C){this._finalizers=null;try{for(var _=ye(C),y=_.next();!y.done;y=_.next()){var M=y.value;try{St(M)}catch(f){i=i!=null?i:[],f instanceof He?i=je(je([],Fe(i)),Fe(f.errors)):i.push(f)}}}catch(f){r={error:f}}finally{try{y&&!y.done&&(o=_.return)&&o.call(_)}finally{if(r)throw r.error}}}if(i)throw new He(i)}},e.prototype.add=function(n){var t;if(n&&n!==this)if(this.closed)St(n);else{if(n instanceof e){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(n)}},e.prototype._hasParent=function(n){var t=this._parentage;return t===n||Array.isArray(t)&&t.includes(n)},e.prototype._addParent=function(n){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(n),t):t?[t,n]:n},e.prototype._removeParent=function(n){var t=this._parentage;t===n?this._parentage=null:Array.isArray(t)&&We(t,n)},e.prototype.remove=function(n){var t=this._finalizers;t&&We(t,n),n instanceof e&&n._removeParent(this)},e.EMPTY=(function(){var n=new e;return n.closed=!0,n})(),e})(),Nt=_e.EMPTY;function qt(e){return e instanceof _e||e&&"closed"in e&&R(e.remove)&&R(e.add)&&R(e.unsubscribe)}function St(e){R(e)?e():e.unsubscribe()}var cr={Promise:void 0},sr={setTimeout:function(e,n){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];return setTimeout.apply(void 0,je([e,n],Fe(t)))},clearTimeout:function(e){return clearTimeout(e)},delegate:void 0};function Ut(e){sr.setTimeout(function(){throw e})}function gt(){}function Ue(e){e()}var ct=(function(e){te(n,e);function n(t){var r=e.call(this)||this;return r.isStopped=!1,t?(r.destination=t,qt(t)&&t.add(r)):r.destination=lr,r}return n.create=function(t,r,o){return new ot(t,r,o)},n.prototype.next=function(t){this.isStopped||this._next(t)},n.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},n.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},n.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},n.prototype._next=function(t){this.destination.next(t)},n.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},n.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},n})(_e),ar=(function(){function e(n){this.partialObserver=n}return e.prototype.next=function(n){var t=this.partialObserver;if(t.next)try{t.next(n)}catch(r){qe(r)}},e.prototype.error=function(n){var t=this.partialObserver;if(t.error)try{t.error(n)}catch(r){qe(r)}else qe(n)},e.prototype.complete=function(){var n=this.partialObserver;if(n.complete)try{n.complete()}catch(t){qe(t)}},e})(),ot=(function(e){te(n,e);function n(t,r,o){var i=e.call(this)||this,c;return R(t)||!t?c={next:t!=null?t:void 0,error:r!=null?r:void 0,complete:o!=null?o:void 0}:c=t,i.destination=new ar(c),i}return n})(ct);function qe(e){Ut(e)}function ur(e){throw e}var lr={closed:!0,next:gt,error:ur,complete:gt},st=(function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"})();function Vt(e){return e}function dr(e){return e.length===0?Vt:e.length===1?e[0]:function(n){return e.reduce(function(t,r){return r(t)},n)}}var $=(function(){function e(n){n&&(this._subscribe=n)}return e.prototype.lift=function(n){var t=new e;return t.source=this,t.operator=n,t},e.prototype.subscribe=function(n,t,r){var o=this,i=pr(n)?n:new ot(n,t,r);return Ue(function(){var c=o,u=c.operator,s=c.source;i.add(u?u.call(i,s):s?o._subscribe(i):o._trySubscribe(i))}),i},e.prototype._trySubscribe=function(n){try{return this._subscribe(n)}catch(t){n.error(t)}},e.prototype.forEach=function(n,t){var r=this;return t=wt(t),new t(function(o,i){var c=new ot({next:function(u){try{n(u)}catch(s){i(s),c.unsubscribe()}},error:i,complete:o});r.subscribe(c)})},e.prototype._subscribe=function(n){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(n)},e.prototype[st]=function(){return this},e.prototype.pipe=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return dr(n)(this)},e.prototype.toPromise=function(n){var t=this;return n=wt(n),new n(function(r,o){var i;t.subscribe(function(c){return i=c},function(c){return o(c)},function(){return r(i)})})},e.create=function(n){return new e(n)},e})();function wt(e){var n;return(n=e!=null?e:cr.Promise)!==null&&n!==void 0?n:Promise}function fr(e){return e&&R(e.next)&&R(e.error)&&R(e.complete)}function pr(e){return e&&e instanceof ct||fr(e)&&qt(e)}function hr(e){return R(e==null?void 0:e.lift)}function Ee(e){return function(n){if(hr(n))return n.lift(function(t){try{return e(t,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function ze(e,n,t,r,o){return new vr(e,n,t,r,o)}var vr=(function(e){te(n,e);function n(t,r,o,i,c,u){var s=e.call(this,t)||this;return s.onFinalize=c,s.shouldUnsubscribe=u,s._next=r?function(l){try{r(l)}catch(h){t.error(h)}}:e.prototype._next,s._error=i?function(l){try{i(l)}catch(h){t.error(h)}finally{this.unsubscribe()}}:e.prototype._error,s._complete=o?function(){try{o()}catch(l){t.error(l)}finally{this.unsubscribe()}}:e.prototype._complete,s}return n.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),!r&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},n})(ct),mr=it(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),$t=(function(e){te(n,e);function n(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return n.prototype.lift=function(t){var r=new Tt(this,this);return r.operator=t,r},n.prototype._throwIfClosed=function(){if(this.closed)throw new mr},n.prototype.next=function(t){var r=this;Ue(function(){var o,i;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var c=ye(r.currentObservers),u=c.next();!u.done;u=c.next()){var s=u.value;s.next(t)}}catch(l){o={error:l}}finally{try{u&&!u.done&&(i=c.return)&&i.call(c)}finally{if(o)throw o.error}}}})},n.prototype.error=function(t){var r=this;Ue(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=t;for(var o=r.observers;o.length;)o.shift().error(t)}})},n.prototype.complete=function(){var t=this;Ue(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var r=t.observers;r.length;)r.shift().complete()}})},n.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(n.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),n.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},n.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},n.prototype._innerSubscribe=function(t){var r=this,o=this,i=o.hasError,c=o.isStopped,u=o.observers;return i||c?Nt:(this.currentObservers=null,u.push(t),new _e(function(){r.currentObservers=null,We(u,t)}))},n.prototype._checkFinalizedStatuses=function(t){var r=this,o=r.hasError,i=r.thrownError,c=r.isStopped;o?t.error(i):c&&t.complete()},n.prototype.asObservable=function(){var t=new $;return t.source=this,t},n.create=function(t,r){return new Tt(t,r)},n})($),Tt=(function(e){te(n,e);function n(t,r){var o=e.call(this)||this;return o.destination=t,o.source=r,o}return n.prototype.next=function(t){var r,o;(o=(r=this.destination)===null||r===void 0?void 0:r.next)===null||o===void 0||o.call(r,t)},n.prototype.error=function(t){var r,o;(o=(r=this.destination)===null||r===void 0?void 0:r.error)===null||o===void 0||o.call(r,t)},n.prototype.complete=function(){var t,r;(r=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||r===void 0||r.call(t)},n.prototype._subscribe=function(t){var r,o;return(o=(r=this.source)===null||r===void 0?void 0:r.subscribe(t))!==null&&o!==void 0?o:Nt},n})($t);(function(e){te(n,e);function n(t){var r=e.call(this)||this;return r._value=t,r}return Object.defineProperty(n.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),n.prototype._subscribe=function(t){var r=e.prototype._subscribe.call(this,t);return!r.closed&&t.next(this._value),r},n.prototype.getValue=function(){var t=this,r=t.hasError,o=t.thrownError,i=t._value;if(r)throw o;return this._throwIfClosed(),i},n.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},n})($t);var br={now:function(){return Date.now()}},yr=(function(e){te(n,e);function n(t,r){return e.call(this)||this}return n.prototype.schedule=function(t,r){return this},n})(_e),kt={setInterval:function(e,n){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];return setInterval.apply(void 0,je([e,n],Fe(t)))},clearInterval:function(e){return clearInterval(e)},delegate:void 0},Sr=(function(e){te(n,e);function n(t,r){var o=e.call(this,t,r)||this;return o.scheduler=t,o.work=r,o.pending=!1,o}return n.prototype.schedule=function(t,r){var o;if(r===void 0&&(r=0),this.closed)return this;this.state=t;var i=this.id,c=this.scheduler;return i!=null&&(this.id=this.recycleAsyncId(c,i,r)),this.pending=!0,this.delay=r,this.id=(o=this.id)!==null&&o!==void 0?o:this.requestAsyncId(c,this.id,r),this},n.prototype.requestAsyncId=function(t,r,o){return o===void 0&&(o=0),kt.setInterval(t.flush.bind(t,this),o)},n.prototype.recycleAsyncId=function(t,r,o){if(o===void 0&&(o=0),o!=null&&this.delay===o&&this.pending===!1)return r;r!=null&&kt.clearInterval(r)},n.prototype.execute=function(t,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var o=this._execute(t,r);if(o)return o;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},n.prototype._execute=function(t,r){var o=!1,i;try{this.work(t)}catch(c){o=!0,i=c||new Error("Scheduled action threw falsy error")}if(o)return this.unsubscribe(),i},n.prototype.unsubscribe=function(){if(!this.closed){var t=this,r=t.id,o=t.scheduler,i=o.actions;this.work=this.state=this.scheduler=null,this.pending=!1,We(i,this),r!=null&&(this.id=this.recycleAsyncId(o,r,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},n})(yr),Ct=(function(){function e(n,t){t===void 0&&(t=e.now),this.schedulerActionCtor=n,this.now=t}return e.prototype.schedule=function(n,t,r){return t===void 0&&(t=0),new this.schedulerActionCtor(this,n).schedule(r,t)},e.now=br.now,e})(),gr=(function(e){te(n,e);function n(t,r){r===void 0&&(r=Ct.now);var o=e.call(this,t,r)||this;return o.actions=[],o._active=!1,o}return n.prototype.flush=function(t){var r=this.actions;if(this._active){r.push(t);return}var o;this._active=!0;do if(o=t.execute(t.state,t.delay))break;while(t=r.shift());if(this._active=!1,o){for(;t=r.shift();)t.unsubscribe();throw o}},n})(Ct);new gr(Sr);function wr(e){return e&&R(e.schedule)}function Tr(e){return e[e.length-1]}function Ft(e){return wr(Tr(e))?e.pop():void 0}var jt=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function Wt(e){return R(e==null?void 0:e.then)}function zt(e){return R(e[st])}function Yt(e){return Symbol.asyncIterator&&R(e==null?void 0:e[Symbol.asyncIterator])}function Qt(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function kr(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Gt=kr();function Bt(e){return R(e==null?void 0:e[Gt])}function Jt(e){return or(this,arguments,function(){var n,t,r,o;return Dt(this,function(i){switch(i.label){case 0:n=e.getReader(),i.label=1;case 1:i.trys.push([1,,9,10]),i.label=2;case 2:return[4,be(n.read())];case 3:return t=i.sent(),r=t.value,o=t.done,o?[4,be(void 0)]:[3,5];case 4:return[2,i.sent()];case 5:return[4,be(r)];case 6:return[4,i.sent()];case 7:return i.sent(),[3,2];case 8:return[3,10];case 9:return n.releaseLock(),[7];case 10:return[2]}})})}function Kt(e){return R(e==null?void 0:e.getReader)}function Ie(e){if(e instanceof $)return e;if(e!=null){if(zt(e))return Cr(e);if(jt(e))return _r(e);if(Wt(e))return Er(e);if(Yt(e))return Ht(e);if(Bt(e))return Ir(e);if(Kt(e))return Mr(e)}throw Qt(e)}function Cr(e){return new $(function(n){var t=e[st]();if(R(t.subscribe))return t.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function _r(e){return new $(function(n){for(var t=0;t<e.length&&!n.closed;t++)n.next(e[t]);n.complete()})}function Er(e){return new $(function(n){e.then(function(t){n.closed||(n.next(t),n.complete())},function(t){return n.error(t)}).then(null,Ut)})}function Ir(e){return new $(function(n){var t,r;try{for(var o=ye(e),i=o.next();!i.done;i=o.next()){var c=i.value;if(n.next(c),n.closed)return}}catch(u){t={error:u}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}n.complete()})}function Ht(e){return new $(function(n){xr(e,n).catch(function(t){return n.error(t)})})}function Mr(e){return Ht(Jt(e))}function xr(e,n){var t,r,o,i;return rr(this,void 0,void 0,function(){var c,u;return Dt(this,function(s){switch(s.label){case 0:s.trys.push([0,5,6,11]),t=ir(e),s.label=1;case 1:return[4,t.next()];case 2:if(r=s.sent(),!!r.done)return[3,4];if(c=r.value,n.next(c),n.closed)return[2];s.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return u=s.sent(),o={error:u},[3,11];case 6:return s.trys.push([6,,9,10]),r&&!r.done&&(i=t.return)?[4,i.call(t)]:[3,8];case 7:s.sent(),s.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return n.complete(),[2]}})})}function fe(e,n,t,r,o){r===void 0&&(r=0),o===void 0&&(o=!1);var i=n.schedule(function(){t(),o?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(i),!o)return i}function Zt(e,n){return n===void 0&&(n=0),Ee(function(t,r){t.subscribe(ze(r,function(o){return fe(r,e,function(){return r.next(o)},n)},function(){return fe(r,e,function(){return r.complete()},n)},function(o){return fe(r,e,function(){return r.error(o)},n)}))})}function Xt(e,n){return n===void 0&&(n=0),Ee(function(t,r){r.add(e.schedule(function(){return t.subscribe(r)},n))})}function Pr(e,n){return Ie(e).pipe(Xt(n),Zt(n))}function Ar(e,n){return Ie(e).pipe(Xt(n),Zt(n))}function Or(e,n){return new $(function(t){var r=0;return n.schedule(function(){r===e.length?t.complete():(t.next(e[r++]),t.closed||this.schedule())})})}function Rr(e,n){return new $(function(t){var r;return fe(t,n,function(){r=e[Gt](),fe(t,n,function(){var o,i,c;try{o=r.next(),i=o.value,c=o.done}catch(u){t.error(u);return}c?t.complete():t.next(i)},0,!0)}),function(){return R(r==null?void 0:r.return)&&r.return()}})}function en(e,n){if(!e)throw new Error("Iterable cannot be null");return new $(function(t){fe(t,n,function(){var r=e[Symbol.asyncIterator]();fe(t,n,function(){r.next().then(function(o){o.done?t.complete():t.next(o.value)})},0,!0)})})}function Lr(e,n){return en(Jt(e),n)}function Dr(e,n){if(e!=null){if(zt(e))return Pr(e,n);if(jt(e))return Or(e,n);if(Wt(e))return Ar(e,n);if(Yt(e))return en(e,n);if(Bt(e))return Rr(e,n);if(Kt(e))return Lr(e,n)}throw Qt(e)}function Nr(e,n){return n?Dr(e,n):Ie(e)}it(function(e){return function(n){n===void 0&&(n=null),e(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=n}});function Me(e,n){return Ee(function(t,r){var o=0;t.subscribe(ze(r,function(i){r.next(e.call(n,i,o++))}))})}function qr(e,n,t,r,o,i,c,u){var s=[],l=0,h=0,C=!1,_=function(){C&&!s.length&&!l&&n.complete()},y=function(f){return l<r?M(f):s.push(f)},M=function(f){l++;var x=!1;Ie(t(f,h++)).subscribe(ze(n,function(m){n.next(m)},function(){x=!0},void 0,function(){if(x)try{l--;for(var m=function(){var g=s.shift();c||M(g)};s.length&&l<r;)m();_()}catch(g){n.error(g)}}))};return e.subscribe(ze(n,y,function(){C=!0,_()})),function(){}}function tn(e,n,t){return t===void 0&&(t=1/0),R(n)?tn(function(r,o){return Me(function(i,c){return n(r,i,o,c)})(Ie(e(r,o)))},t):(typeof n=="number"&&(t=n),Ee(function(r,o){return qr(r,o,e,t)}))}function Ur(e){return tn(Vt,e)}function Vr(){return Ur(1)}function _t(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return Vr()(Nr(e,Ft(e)))}function xe(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var t=Ft(e);return Ee(function(r,o){(t?_t(e,r,t):_t(e,r)).subscribe(o)})}var $r="lk";function nn(e){return typeof e>"u"?!1:Fr(e)||jr(e)}function Fr(e){var n;return e?e.hasOwnProperty("participant")&&e.hasOwnProperty("source")&&e.hasOwnProperty("track")&&typeof((n=e.publication)==null?void 0:n.track)<"u":!1}function jr(e){return e?e.hasOwnProperty("participant")&&e.hasOwnProperty("source")&&e.hasOwnProperty("publication")&&typeof e.publication<"u":!1}function Wr(e){return e?e.hasOwnProperty("participant")&&e.hasOwnProperty("source")&&typeof e.publication>"u":!1}function ko(e){if(typeof e=="string"||typeof e=="number")return"".concat(e);if(Wr(e))return"".concat(e.participant.identity,"_").concat(e.source,"_placeholder");if(nn(e))return"".concat(e.participant.identity,"_").concat(e.publication.source,"_").concat(e.publication.trackSid);throw new Error("Can't generate a id for the given track reference: ".concat(e))}function Co(e){return e instanceof Hn}var zr=[w.ConnectionStateChanged,w.RoomMetadataChanged,w.ActiveSpeakersChanged,w.ConnectionQualityChanged,w.ParticipantConnected,w.ParticipantDisconnected,w.ParticipantPermissionsChanged,w.ParticipantMetadataChanged,w.ParticipantNameChanged,w.ParticipantAttributesChanged,w.TrackMuted,w.TrackUnmuted,w.TrackPublished,w.TrackUnpublished,w.TrackStreamStateChanged,w.TrackSubscriptionFailed,w.TrackSubscriptionPermissionChanged,w.TrackSubscriptionStatusChanged],Yr=[...zr,w.LocalTrackPublished,w.LocalTrackUnpublished];I.TrackPublished,I.TrackUnpublished,I.TrackMuted,I.TrackUnmuted,I.TrackStreamStateChanged,I.TrackSubscribed,I.TrackUnsubscribed,I.TrackSubscriptionPermissionChanged,I.TrackSubscriptionFailed,I.LocalTrackPublished,I.LocalTrackUnpublished;var Qr=[I.ConnectionQualityChanged,I.IsSpeakingChanged,I.ParticipantMetadataChanged,I.ParticipantPermissionsChanged,I.TrackMuted,I.TrackUnmuted,I.TrackPublished,I.TrackUnpublished,I.TrackStreamStateChanged,I.TrackSubscriptionFailed,I.TrackSubscriptionPermissionChanged,I.TrackSubscriptionStatusChanged];[...Qr,I.LocalTrackPublished,I.LocalTrackUnpublished];var Ye=nr.getLogger("lk-components-js");Ye.setDefaultLevel("WARN");function rn(e){return typeof e=="object"}function on(e){return Array.isArray(e)&&e.filter(rn).length>0}function Gr(e){return"".concat($r,"-").concat(e)}function _o(e){const n=Et(e),t=cn(e.participant).pipe(Me(()=>Et(e)),xe(n));return{className:Gr(e.source===Q.Source.Camera||e.source===Q.Source.ScreenShare?"participant-media-video":"participant-media-audio"),trackObserver:t}}function Et(e){if(nn(e))return e.publication;{const{source:n,name:t,participant:r}=e;if(n&&t)return r.getTrackPublications().find(o=>o.source===n&&o.trackName===t);if(t)return r.getTrackPublicationByName(t);if(n)return r.getTrackPublication(n);throw new Error("At least one of source and name needs to be defined")}}function Br(e,...n){return new $(t=>{const r=()=>{t.next(e)};return n.forEach(o=>{e.on(o,r)}),()=>{n.forEach(o=>{e.off(o,r)})}}).pipe(xe(e))}function Jr(e,n){return new $(t=>{const r=(...o)=>{t.next(o)};return e.on(n,r),()=>{e.off(n,r)}})}function Kr(e){return Jr(e,w.ConnectionStateChanged).pipe(Me(([n])=>n),xe(e.state))}function Hr(e,...n){return new $(t=>{const r=()=>{t.next(e)};return n.forEach(o=>{e.on(o,r)}),()=>{n.forEach(o=>{e.off(o,r)})}}).pipe(xe(e))}function cn(e){return Hr(e,I.TrackMuted,I.TrackUnmuted,I.ParticipantPermissionsChanged,I.TrackPublished,I.TrackUnpublished,I.LocalTrackPublished,I.LocalTrackUnpublished,I.MediaDevicesError,I.TrackSubscriptionStatusChanged).pipe(Me(n=>{const{isMicrophoneEnabled:t,isCameraEnabled:r,isScreenShareEnabled:o}=n,i=n.getTrackPublication(Q.Source.Microphone),c=n.getTrackPublication(Q.Source.Camera);return{isCameraEnabled:r,isMicrophoneEnabled:t,isScreenShareEnabled:o,cameraTrack:c,microphoneTrack:i,participant:n}}))}new TextEncoder;new TextDecoder;function Eo(){return{className:"lk-room-container"}}function It(e,n,t=!0){const r=[e.localParticipant,...Array.from(e.remoteParticipants.values())],o=[];return r.forEach(i=>{n.forEach(c=>{const u=Array.from(i.trackPublications.values()).filter(s=>s.source===c&&(!t||s.track)).map(s=>({participant:i,publication:s,source:s.source}));o.push(...u)})}),{trackReferences:o,participants:r}}function Zr(e,n,t){var r,o;const i=(r=t.additionalRoomEvents)!=null?r:Yr,c=(o=t.onlySubscribed)!=null?o:!0,u=Array.from(new Set([w.ParticipantConnected,w.ParticipantDisconnected,w.ConnectionStateChanged,w.LocalTrackPublished,w.LocalTrackUnpublished,w.TrackPublished,w.TrackUnpublished,w.TrackSubscriptionStatusChanged,...i]).values());return Br(e,...u).pipe(Me(s=>{const l=It(s,n,c);return Ye.debug("TrackReference[] was updated. (length ".concat(l.trackReferences.length,")"),l),l}),xe(It(e,n,c)))}a.createContext(void 0);const Xr=a.createContext(void 0);function eo(){return a.useContext(Xr)}function Io(e){const n=eo(),t=e!=null?e:n;if(!t)throw new Error("No TrackRef, make sure you are inside a TrackRefContext or pass the TrackRef explicitly");return t}a.createContext(void 0);const to=a.createContext(void 0);function sn(){return a.useContext(to)}function at(e){const n=sn(),t=e!=null?e:n;if(!t)throw new Error("No room provided, make sure you are inside a Room context or pass the room explicitly");return t}const Mo=a.createContext(void 0);function no(e,n,t=!0){const[r,o]=a.useState(n);return a.useEffect(()=>{if(t&&o(n),typeof window>"u"||!e)return;const i=e.subscribe(o);return()=>i.unsubscribe()},[e,t]),r}function ro(e){const n=at(e),t=a.useMemo(()=>Kr(n),[n]);return no(t,n.state)}function xo(e={}){const n=at(e.room),[t,r]=a.useState(n.localParticipant),[o,i]=a.useState(t.isMicrophoneEnabled),[c,u]=a.useState(t.isMicrophoneEnabled),[s,l]=a.useState(t.lastMicrophoneError),[h,C]=a.useState(t.lastCameraError),[_,y]=a.useState(t.isMicrophoneEnabled),[M,f]=a.useState(void 0),[x,m]=a.useState(void 0),g=P=>{u(P.isCameraEnabled),i(P.isMicrophoneEnabled),y(P.isScreenShareEnabled),m(P.cameraTrack),f(P.microphoneTrack),l(P.participant.lastMicrophoneError),C(P.participant.lastCameraError),r(P.participant)};return a.useEffect(()=>{const P=cn(n.localParticipant).subscribe(g);return()=>P.unsubscribe()},[n]),{isMicrophoneEnabled:o,isScreenShareEnabled:_,isCameraEnabled:c,microphoneTrack:M,cameraTrack:x,lastMicrophoneError:s,lastCameraError:h,localParticipant:t}}function oo(e=[Q.Source.Camera,Q.Source.Microphone,Q.Source.ScreenShare,Q.Source.ScreenShareAudio,Q.Source.Unknown],n={}){const t=at(n.room),[r,o]=a.useState([]),[i,c]=a.useState([]),u=a.useMemo(()=>e.map(s=>rn(s)?s.source:s),[JSON.stringify(e)]);return a.useEffect(()=>{const s=Zr(t,u,{additionalRoomEvents:n.updateOnlyOn,onlySubscribed:n.onlySubscribed}).subscribe(({trackReferences:l,participants:h})=>{Ye.debug("setting track bundles",l,h),o(l),c(h)});return()=>s.unsubscribe()},[t,JSON.stringify(n.onlySubscribed),JSON.stringify(n.updateOnlyOn),JSON.stringify(e)]),a.useMemo(()=>{if(on(e)){const s=co(e,i),l=Array.from(r);return i.forEach(h=>{var C;s.has(h.identity)&&((C=s.get(h.identity))!=null?C:[]).forEach(_=>{if(r.find(({participant:M,publication:f})=>h.identity===M.identity&&f.source===_))return;Ye.debug("Add ".concat(_," placeholder for participant ").concat(h.identity,"."));const y={participant:h,source:_};l.push(y)})}),l}else return r},[r,i,e])}function io(e,n){const t=new Set(e);for(const r of n)t.delete(r);return t}function co(e,n){const t=new Map;if(on(e)){const r=e.filter(o=>o.withPlaceholder).map(o=>o.source);n.forEach(o=>{const i=o.getTrackPublications().map(u=>{var s;return(s=u.track)==null?void 0:s.source}).filter(u=>u!==void 0),c=Array.from(io(new Set(r),new Set(i)));c.length>0&&t.set(o.identity,c)})}return t}var Ve=(e=>(e.Local="local",e.Remote="remote",e))(Ve||{}),an=(e=>(e.Audio="audio",e.Video="video",e))(an||{}),Ce=(e=>(e.Camera="camera",e.Microphone="microphone",e.ScreenShare="screen_share",e))(Ce||{});const so=e=>e.flatMap(n=>{const t=[],r=n.publication.trackName,o=n.participant.identity,i=n.participant.isLocal?"local":"remote";let c;n.publication.source===Q.Source.Camera?c="camera":n.publication.source===Q.Source.ScreenShare?c="screen_share":c="microphone";const u=(s,l)=>{s&&t.push({id:s.mediaStreamTrack.id,source:c,name:r,userName:o,origin:i,media:l,track:s.mediaStreamTrack,isMuted:s.isMuted,isSystemMuted:s.mediaStreamTrack.muted,setMuted:h=>{s.mediaStreamTrack.enabled=!h},onEnded:h=>{s.on("ended",h)},offEnded:h=>{s.off("ended",h)}})};return u(n.publication.audioTrack,"audio"),u(n.publication.videoTrack,"video"),t}),Ze=(e,n)=>{var r;const t={id:e.id,source:n.source,name:n.name,userName:n.userName,media:e.kind==="audio"?"audio":"video",origin:n.origin,track:e,get isMuted(){return!e.enabled||e.muted},get isSystemMuted(){return e.muted},setMuted:o=>{var i;e.enabled=!o,(i=n.mutedCb)==null||i.call(n,t.isMuted,t.isSystemMuted)},onEnded:o=>{e.onended=o},offEnded:o=>{e.onended=null}};return e.onmute=()=>{var o;(o=n.mutedCb)==null||o.call(n,t.isMuted,t.isSystemMuted)},e.onunmute=()=>{var o;(o=n.mutedCb)==null||o.call(n,t.isMuted,t.isSystemMuted)},(r=n.mutedCb)==null||r.call(n,t.isMuted,t.isSystemMuted),t},ao=500,uo=1e3,lo=3,fo=2e3;function Mt({packets:e,packetsLost:n,fractionLost:t,rtt:r}){let o;if(e!==void 0&&n!==void 0?o=n*100/e:t!==void 0&&(o=t*100),o===void 0||r===void 0||isNaN(o))return;const i=r*1e3/2;let c=i/40;i>160&&(c=(i-120)/10);const u=100-c-o;return Math.max(u,0)}function xt(e){if(e===void 0)return re.Unknown;let n;return e<=0?n=1:e>=100?n=4.5:n=1+.035*e+7e-6*e*(e-60)*(100-e),n>4?re.Excellent:n>3.5?re.Good:re.Poor}class me{constructor(n,t){j(this,"size");j(this,"type");j(this,"buf");this.size=n,this.type=t,this.buf=[]}push(n){n!==void 0&&(this.buf.length===this.size&&this.buf.shift(),this.buf.push(n))}get(){if(this.buf.length!==0)switch(this.type){case"cumulative":{const n=this.buf[0];return(this.buf[this.buf.length-1]-n)/this.buf.length}case"individual":return this.buf.reduce((n,t)=>n+t,0)/this.buf.length}}}class po{constructor(n,t){j(this,"pc");j(this,"cb");j(this,"reportTimerId");j(this,"pollingTimerId");j(this,"localWindow");j(this,"remoteWindow");j(this,"reportTimestamps");j(this,"stale",!1);const r=lo;this.pc=n,this.cb=t,this.reportTimerId=void 0,this.localWindow={packetsLost:new me(r,"cumulative"),fractionLost:new me(r,"individual"),rtt:new me(r,"individual")},this.remoteWindow={packetsSent:new me(r,"cumulative"),packetsLost:new me(r,"cumulative"),rtt:new me(r,"individual")},this.reportTimestamps={}}start(){this.reportTimerId||this.pollingTimerId||(this.reportTimerId=window.setInterval(this.report.bind(this),ao),this.pollingTimerId=window.setInterval(this.poll.bind(this),uo))}stop(){window.clearInterval(this.reportTimerId),window.clearInterval(this.pollingTimerId),this.reportTimerId=void 0,this.pollingTimerId=void 0}isFresh(n){let t=!0;if(this.reportTimestamps[n.type]!==void 0){const o=Date.now()-this.reportTimestamps[n.type]<fo;t=n.timestamp!==this.reportTimestamps[n.type]||o}return this.reportTimestamps[n.type]=n.timestamp,t}async poll(){const n=await this.pc.getStats();let t;const r={};let o=!1;n.forEach(c=>{const u=c.kind||c.mediaType;c.type==="transport"&&c.selectedCandidatePairId&&(t=c.selectedCandidatePairId),c.type==="remote-inbound-rtp"&&u==="audio"&&(o||(o=!this.isFresh(c)),this.localWindow.packetsLost.push(c.packetsLost),this.localWindow.fractionLost.push(c.fractionLost)),c.type==="inbound-rtp"&&u==="audio"&&(o||(o=!this.isFresh(c)),this.remoteWindow.packetsSent.push(c.packetsReceived+c.packetsLost),this.remoteWindow.packetsLost.push(c.packetsLost)),c.type==="candidate-pair"&&(r[c.id]=c)}),this.stale=o;const i=t!==void 0&&r[t];i?(this.remoteWindow.rtt.push(i.currentRoundTripTime),this.localWindow.rtt.push(i.currentRoundTripTime)):V.error("QualityMonitor no candidate-pair found!")}report(){if(this.stale)return this.cb({local:re.Unknown,general:re.Unknown});const n=Mt({packets:void 0,packetsLost:this.localWindow.packetsLost.get(),fractionLost:this.localWindow.fractionLost.get(),rtt:this.localWindow.rtt.get()}),t=Mt({packets:this.remoteWindow.packetsSent.get(),packetsLost:this.remoteWindow.packetsLost.get(),fractionLost:void 0,rtt:this.remoteWindow.rtt.get()}),r=[n,t].filter(u=>u!==void 0),o=r.length>0?Math.min(...r):void 0,i=xt(n),c=xt(o);this.cb({local:i,general:c})}}class $e{static abortPendingNegotiation(n){this._controller&&(this._controller.abort("[abort] ".concat(n)),this._controller=null)}static clearNegotiation(){this._controller=null}static beginNegotiation(){this._controller&&this._controller.abort("[abort] Starting new negotiation");const n=new AbortController;return this._controller=n,n.signal}}j($e,"_controller",null);const Pt="User",At="Assistant",Ot=0,ho=[],ut=a.createContext({room:void 0,getTracks:()=>ho,getConnectionState:()=>null,selectVoiceModeMetadata:()=>{throw new Error("Null implementation - please provide a proper context")},getTokenSetup:()=>{},initVoiceMode:()=>Promise.reject(new Error("Null implementation - please provide a proper context"))}),un=()=>a.useContext(ut),Po=({children:e})=>{const n=sn(),t=oo(),r=ro(n),o=Qe(),i=a.useCallback(h=>{const C=so(t);return h?C.filter(_=>h.includes(_.source)):C},[t]),c=a.useCallback(()=>r,[r]),u=a.useCallback(h=>{const{default_voice_mode:C,modes:_}=h,y=_.find(M=>M.mode===C);if(!y)throw new Error("No voice status mode found for default mode "+C);return y},[]),s=a.useCallback(async(h,C)=>{var y;const _=await Rt.startLivekitSession(h,C.eventSource,C.proofOfWorkAnswer);return _.token&&_.url&&_.e2ee_key?(tt({conversationId:(y=h.conversation_id)!=null?y:C.clientThreadId,voiceSessionId:h.voice_session_id,voiceMode:_.voice_mode_decision.voice_mode,credentials:ke(de({},_),{e2eeKey:_.e2ee_key})},o),{type:"livekit",success:!0}):{type:"livekit",success:!1,error:"get_token failed to return expected fields .token, .url and .e2ee_key",response:_}},[o]),l=a.useMemo(()=>({room:n,getTracks:i,getConnectionState:c,getTokenSetup:()=>{},initVoiceMode:s,selectVoiceModeMetadata:u}),[n,i,c,s,u]);return nt.jsx(ut.Provider,{value:l,children:e})};let Xe;const vo=()=>(Xe===void 0&&(Xe=new TextEncoder),Xe);function mo(e){switch(e){case"checking":return W.Connecting;case"connected":case"completed":return W.Connected;case"disconnected":return W.Reconnecting;case"new":case"failed":case"closed":return W.Disconnected}}const Ao=({children:e})=>{const n=Qe(),t=vn(mn()),r=a.useRef(null),o=a.useRef(void 0),i=a.useRef(void 0),c=a.useCallback(async({avmTrack:S,initialSetup:p=!1})=>{const d=S.media===an.Audio?o:i;if(d.current&&!d.current.stopped)await d.current.sender.replaceTrack(S.track);else if(p)d.current=ae().addTransceiver(S.track);else throw new Error("Cannot replace track on ".concat(S.media," transceiver that was not initialized."))},[]),[u,s]=a.useState(void 0),[l,h]=a.useState(void 0),[C,_]=a.useState(void 0),y=a.useRef(void 0),M=a.useRef(void 0),f=a.useRef(void 0),x=n(S=>S.voiceMode),[m,g]=a.useState(null),P=a.useCallback(()=>m,[m]),U=a.useCallback(S=>{K(p=>Le(p,d=>{d&&(d.activeSpeakers.some(v=>v.identity===S)||d.activeSpeakers.push({identity:S}))}))},[]),O=a.useCallback(S=>{K(p=>Le(p,d=>{d&&(d.activeSpeakers=d.activeSpeakers.filter(v=>v.identity!==S))}))},[]),oe=a.useRef(null),G=a.useRef([]),H=a.useRef([]),F=a.useRef([]),B=a.useRef([]),E=a.useRef([]),A=a.useRef(!1),z=a.useRef([]),b=a.useCallback(S=>{z.current.forEach(p=>p(S))},[]),L=a.useRef(m);a.useEffect(()=>{L.current=m},[m]);const J=a.useRef(void 0);a.useEffect(()=>{J.current=u},[u]);const D=a.useRef(void 0);a.useEffect(()=>{D.current=C},[C]);const ie=a.useRef(void 0),ce=a.useRef(void 0),Z=a.useRef(void 0),[Se,K]=a.useState(()=>({localParticipant:{isMicrophoneEnabled:!1,setMicrophoneEnabled:function(p){var d;return(d=J.current)==null||d.setMuted(!p),Promise.resolve(void 0)},setCameraEnabled:async function(p,d,v){if(p)try{const T=await Ae("camera");await c({avmTrack:T}),b(T)}catch(T){throw V.error("[transceiver] Error acquiring camera input",T),T}else await pe();return Promise.resolve(void 0)},setScreenShareEnabled:async function(p,d,v){if(p)try{const T=await Ae("screenshare");await c({avmTrack:T}),b(T)}catch(T){throw V.error("[transceiver] Error acquiring screen share input",T),T}else await pe();return Promise.resolve(void 0)},publishData:async function(p,d){const v=oe.current;if(!v||v.readyState!=="open")throw new Error("Data channel is not open");const T=new TextDecoder().decode(p),k=JSON.stringify({type:"data_message",data:T});v.send(k)},on:function(p,d){p===w.ConnectionQualityChanged&&H.current.push(d)},off:function(p,d){p===w.ConnectionQualityChanged&&(H.current=H.current.filter(v=>v!==d))}},getActiveDevice:p=>{switch(p){case"audioinput":return y.current;case"videoinput":return M.current;case"audiooutput":return f.current}},disconnect:async function(){var p;$e.abortPendingNegotiation("Disconnecting"),(p=ie.current)==null||p.stop(),A.current=!0,De.closeAllStreams(),Y.current&&(Y.current.close(),Y.current=void 0),r.current&&(r.current.srcObject=null),await pe(),g(W.Disconnected),L.current=W.Disconnected,E.current.forEach(d=>d())},name:"",switchActiveDevice:async(p,d,v)=>{var T;if(L.current!==W.Connected)return V.debug("[transceiver] Attempt to switch device when not connected, current state is",L.current),!1;try{switch(p){case"audioinput":{const k=await Pe(d);return await c({avmTrack:k}),b(k),!0}case"videoinput":{const k=await Ae("camera",d);return await c({avmTrack:k}),b(k),!0}case"audiooutput":return await((T=r.current)==null?void 0:T.setSinkId(d)),f.current=d,!0}}catch(k){return V.error("[transceiver] Failed to switch ".concat(p," device"),k),!1}},on:function(p,d){switch(p){case w.DataReceived:F.current.push(d);break;case w.Disconnected:E.current.push(d);break;case w.Connected:B.current.push(d);break;case w.TrackPublished:z.current.push(d);break;case w.ConnectionQualityChanged:G.current.push(d);break}},off:function(p,d){switch(p){case w.DataReceived:F.current=F.current.filter(v=>v!==d);break;case w.Disconnected:E.current=E.current.filter(v=>v!==d);break;case w.Connected:B.current=B.current.filter(v=>v!==d);break;case w.TrackPublished:z.current=z.current.filter(v=>v!==d);break;case w.ConnectionQualityChanged:G.current=G.current.filter(v=>v!==d);break}},state:W.Disconnected,numParticipants:0,activeSpeakers:[]})),se=a.useRef(!1),Y=a.useRef(void 0),ae=()=>(Y.current===void 0&&(Y.current=Tn.getFreshPeerConnection("voice-mode")),Y.current),ue=a.useCallback((S,p)=>{K(d=>Le(d,v=>{v&&(v.localParticipant.isMicrophoneEnabled=!S,v.localParticipant.isMicrophoneForceMuted=p,S?O(Pt):U(Pt))}))},[U,O]),Ge=a.useCallback(S=>{const p=[u,l,C].filter(d=>d!==void 0);return S?p.filter(d=>S.includes(d.source)):p},[u,l,C]),Pe=a.useCallback(async S=>{S||(S=await kn());const d=(await De.getUserMedia({audio:S?{deviceId:{exact:S}}:!0})).getTracks();if(d.length!==1)throw V.error("[transceiver] Only one input is supported for now, detected these tracks",d),new Error("Only one input is supported for now");const[v]=d;y.current=v.getSettings().deviceId,J.current&&J.current.track!==v&&J.current.track.stop();const T=Ze(v,{source:Ce.Microphone,name:"user",userName:"User",origin:Ve.Local,mutedCb:ue});return s(T),ue(T.isMuted,T.isSystemMuted),T},[ue]),Ae=a.useCallback(async(S,p)=>{const v=(S==="camera"?await De.getUserMedia({video:p?{deviceId:{exact:p}}:!0}):await De.getDisplayMedia()).getTracks();if(v.length!==1)throw V.error("[transceiver] Only one video input is supported for now, detected these tracks",v),new Error("Only one video input is supported for now");const[T]=v;S==="camera"&&(M.current=T.getSettings().deviceId),D.current&&D.current.track!==T&&D.current.track.stop();const k=Ze(T,{source:S==="camera"?Ce.Camera:Ce.ScreenShare,name:"user",userName:"User",origin:Ve.Local});return _(k),k},[]),pe=a.useCallback(async()=>{if(D.current&&(V.debug("[transceiver] Stop and clear video track"),D.current.track.stop(),_(void 0),i.current&&!i.current.stopped)){V.debug("[transceiver] Stop the video transceiver");try{await i.current.sender.replaceTrack(null)}catch(S){V.debug("[transceiver] Failed to stop transceiver on disconnect due to",S)}}},[]),Be=a.useCallback(S=>{const{default_voice_mode:p,modes:d}=S,v=d.find(T=>T.mode===p);if(!v)throw new Error("No voice status mode found for default mode ".concat(p));return v},[]),le=a.useCallback(async()=>{const S=performance.now(),p=ve(Cn,()=>ae()),d=ve(_n,()=>ae().createDataChannel("",{negotiated:!0,id:Ot}));oe.current=d,ve(En,()=>{d.onopen=()=>{n.setState(k=>{k.metrics.dataChannelOpenTime||(k.metrics.dataChannelOpenTime=new Date)})},d.onmessage=k=>{const q=JSON.parse(k.data);if(q.type==="data_message"){const X=vo().encode(q.data);F.current.forEach(he=>he(X))}},d.onclose=()=>{A.current?A.current=!1:E.current.forEach(k=>k()),O(At)},p.oniceconnectionstatechange=()=>{const k=ae().iceConnectionState,q=mo(k);q===W.Connected&&B.current.forEach(X=>X()),g(q),n.setState(X=>{X.server.connectionState=q})},p.ontrack=k=>{if(r.current!=null){r.current.srcObject=k.streams[0];const q=k.streams[0].getTracks();if(q.length!==1)throw V.error("[transceiver] Only one remote track is supported for now, detected these tracks",q),new Error("Only one remote track is supported for transceiver");const[X]=q,he=Ze(X,{source:Ce.Microphone,name:x==="advanced"?"audio":"shout",userName:"Assistant",origin:Ve.Remote});h(he),b(he),K(we=>Le(we,Te=>{Te&&(Te.numParticipants=2)})),U(At)}}}),ve(In,()=>{o.current=p.addTransceiver("audio"),i.current&&!i.current.stopped&&(i.current.stop(),p.removeTrack(i.current.sender)),i.current=p.addTransceiver("video",{direction:"sendonly"})});const v=await vt(Ln,async()=>{const k=await p.createOffer();return p.setLocalDescription(k),k}),T=performance.now();return Mn.set({start_time:S,end_time:T}),{offer:v}},[U,b,O,x,n]),ne=a.useCallback(()=>{const S=performance.now(),p=Pe();return p.then(()=>{const v=performance.now();xn.set({start_time:S,end_time:v})}),{completeAudioSetup:async()=>{const v=await p,T=performance.now();await c({avmTrack:v,initialSetup:!0});const k=performance.now();return Dn.set({start_time:T,end_time:k}),{microphoneTrack:v}}}},[Pe,c]),ge=a.useCallback(()=>{const S=performance.now(),p=ae();ie.current&&ie.current.stop(),ie.current=new po(p,v=>{const T=L.current&&[W.Disconnected,W.Reconnecting,W.SignalReconnecting].includes(L.current);G.current.forEach(k=>k(T?re.Lost:v.general)),H.current.forEach(k=>k(T?re.Lost:v.local))}),ie.current.start();const d=performance.now();Pn.set({start_time:S,end_time:d})},[]),Oe=a.useCallback(()=>{Z.current=ne(),ce.current=le()},[le,ne]),Je=a.useCallback(async(S,p,d)=>{const v=performance.now(),T=await vt(Nn,()=>d.text()),k=ae();ve(An,()=>{k.setRemoteDescription({sdp:T,type:"answer"})}),Z.current||(V.error("[transceiver] Audio input setup step not executed for initial TC offer!"),Z.current=ne());const{completeAudioSetup:q}=Z.current,{microphoneTrack:X}=await q();b(X),n.setState(we=>{var Te;we.conversationId=(Te=S.conversation_id)!=null?Te:p.clientThreadId,we.voiceSessionId=S.voice_session_id,we.voiceMode=S.voice_mode}),se.current=!1,g(W.Connected);const he=performance.now();On.set({start_time:v,end_time:he})},[ne,Z,b,n]),N=a.useCallback(async(S,p)=>{var k,q;if(se.current)throw new Error("Not ready to connect, ".concat(JSON.stringify({isConnecting:se.current})));se.current=!0,(k=ce.current)!=null||(ce.current=le()),(q=Z.current)!=null||(Z.current=ne());const{offer:d}=await ce.current,v=ve(Rn,()=>$e.beginNegotiation()),T=await Rt.startTransceiverSession({payload:S,accessToken:t,proofOfWorkAnswer:p.proofOfWorkAnswer,eventSource:p.eventSource,signal:v,dataChannelId:Ot,offer:d});return $e.clearNegotiation(),ge(),Je(S,p,T),{type:"transceiver",success:!0}},[le,ne,t,ge,Je]),ln=a.useMemo(()=>({room:Se,getTracks:Ge,getConnectionState:P,initVoiceMode:N,selectVoiceModeMetadata:Be,getTokenSetup:Oe}),[Se,Ge,P,N,Be,Oe]);return nt.jsxs(ut.Provider,{value:ln,children:[nt.jsx("audio",{ref:r,autoPlay:!0,playsInline:!0}),e]})};function bo(){const{room:e}=un(),n=a.useRef({debug:(...t)=>{var r;return V.debug("[".concat((r=e==null?void 0:e.name)!=null?r:"no room","]"),...t)},encoder:new TextEncoder,decoder:new TextDecoder}).current;return de({room:e},n)}function et(e){return[...e].sort().join(", ")}function Oo(e){return de({conversation_id:e.serverThreadId,parent_message_id:e.parentMessageId,voice_mode:e.isAdvancedMode?"advanced":"standard",eventSource:e.eventSource,clientThreadId:e.clientThreadId,gizmo_id:e.gizmoId,voice:e.voice},e.skipCacheReason?{useVoiceStatusCache:!1,skipCacheReason:e.skipCacheReason}:{useVoiceStatusCache:!0})}function Ro({requestMicPermissions:e}={requestMicPermissions:!1}){const n=Kn(),t=Qe(),r=Zn(),{voiceName:o,voiceMainLanguage:i}=qn(),c=Un(g=>g.isVoiceModeActive),u=Vn(),{room:s}=bo(),{initVoiceMode:l,selectVoiceModeMetadata:h,getTokenSetup:C}=un(),_=$n(),y=Fn(),M=bn(),f=n.formatMessage({id:"useVoiceModeButtonAction.error",defaultMessage:"Failed to start voice mode"}),x=a.useCallback(async()=>{u&&(await(s==null?void 0:s.disconnect()),tt(null,t),t.setState(g=>{g.server.remoteState=Ne.Halted}))},[u,s,t]);return{startVoiceMode:a.useCallback(async g=>{var oe,G,H,F,E,A,z;yn(),Sn.setItem(gn.VoiceLastUsed,new Date().toUTCString());let P="unset-".concat(jn());pt.set(P),(u||g.forceDisconnect)&&(await(s==null?void 0:s.disconnect()),tt(null,t)),e&&await y();const U=await Wn("audioinput");C(),t.setState(b=>{b.audioInputDevice=U,b.isVoiceModeActive=!0,b.voiceMode=g.voice_mode,b.server.remoteState=Ne.Connecting,b.metrics.sessionCreateTime=new Date,b.metrics.totalLatencyMs=[],b.metrics.currentRttMs=[],b.metrics.numSpeaking=0,b.metrics.numThinking=0,b.metrics.numListening=0,b.metrics.getStatusSentTime=void 0,b.metrics.getStatusSuccessTime=void 0,b.metrics.getStatusFailedTime=void 0,b.metrics.proofOfWorkStartTime=void 0,b.metrics.proofOfWorkEndTime=void 0,b.metrics.getTokenSentTime=void 0,b.metrics.getTokenSuccessTime=void 0,b.metrics.getTokenFailedTime=void 0,b.metrics.livekitConnectTime=void 0,b.metrics.livekitConnectSuccessTime=void 0,b.metrics.livekitConnectFailTime=void 0,b.metrics.conversationStartSuccessTime=void 0,b.metrics.conversationStartFailTime=void 0,b.metrics.sessionConnectedTime=void 0});const O=performance.now();try{ee.livekit.connectCalled(),t.setState(N=>{N.metrics.getStatusSentTime=new Date});const b=mt(),L=et(bt()),J=et(zn()),D=et(Yn()),ie=L.length>0,ce=J.length>0;!g.useVoiceStatusCache?(ee.voiceStatusCache.skipped({reason:g.skipCacheReason}),yt.set(g.skipCacheReason)):(yt.set(void 0),ce?ee.voiceStatusCache.ineligible({reason:J}):ie?ee.voiceStatusCache.failed({reason:L}):b?ee.voiceStatusCache.hit({allowlisted:D||!1}):bt.set(["unexpected-empty-cache"]));const Se=b==null?void 0:b.proofOfWorkPromise,K=g.useVoiceStatusCache&&b?b:await _({conversation_id:(oe=g.conversation_id)!=null?oe:null,requested_voice_mode:(G=g.voice_mode)!=null?G:null,gizmo_id:(H=g.gizmo_id)!=null?H:null,voice:g.voice,requested_default_model:(F=g.requested_default_model)!=null?F:null},g.eventSource);P=K.voice_session_id,pt.set(K.voice_session_id),t.setState(N=>{N.metrics.getStatusSuccessTime=new Date,N.metrics.proofOfWorkStartTime=new Date});const{default_voice_mode:se,chatreq:Y}=K;performance.mark("livekit.start"),performance.mark("voice_mode.start");const B=g,{eventSource:ae,voice:ue,clientThreadId:Ge,voice_mode:Pe,gizmo_id:Ae}=B,pe=ft(B,["eventSource","voice","clientThreadId","voice_mode","gizmo_id"]),le=h(K).default_model_slug,ne=se==="advanced"?le:void 0,ge=g.useVoiceStatusCache&&Se?await Se:Y?await Qn.getEnforcementToken(Y):null,Oe=g.gizmo_id?{kind:ht.GizmoInteraction,gizmo_id:g.gizmo_id}:{kind:ht.PrimaryAssistant};t.setState(N=>{N.metrics.proofOfWorkEndTime=new Date,N.metrics.getTokenSentTime=new Date}),mt.set(ke(de({},K),{proofOfWorkPromise:Promise.resolve(ge)})),Gn(pe),(await l(ke(de({},pe),{voice:ue!=null?ue:o,language_code:i,voice_session_id:P,timezone_offset_min:new Date().getTimezoneOffset(),timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,voice_mode:se,model_slug:le,model_slug_advanced:ne,chatreq_token:Y==null?void 0:Y.token,history_and_training_disabled:M,conversation_mode:Oe}),{eventSource:g.eventSource,clientThreadId:g.clientThreadId,proofOfWorkAnswer:ge})).success&&(t.setState(N=>{N.metrics.getTokenSuccessTime=new Date,N.metrics.livekitConnectTime=new Date}),wn({lastVoiceSessionStartTime:new Date}),t.setState(N=>{N.server.remoteState=Ne.Listening}),performance.mark("livekit.end"),ee.livekit.success({durationMs:performance.measure("livekit","livekit.start","livekit.end").duration.toFixed(0),voice_session_id:P}),ee.connectionLatency.success({durationMs:performance.now()-O}))}catch(b){const L=Bn(b);t.setState(D=>{L||(D.metrics.getStatusSuccessTime||(D.metrics.getStatusFailedTime=new Date),D.metrics.getTokenSuccessTime||(D.metrics.getTokenFailedTime=new Date))});const J=Jn(t.getState());throw ee.livekit.failure(b,ke(de({},J),{voice_session_id:P,eventSource:g.eventSource,voice:(E=g.voice)!=null?E:"(undefined)",requested_voice_mode:(A=g.voice_mode)!=null?A:"(undefined)",gizmo_id:(z=g.gizmo_id)!=null?z:"(undefined)",user_aborted:L})),V.debug("failed to get voice token",b),t.setState(D=>{D.server.remoteState=Ne.Halted}),ee.connectionLatency.failure(b,{durationMs:performance.now()-O,voice_session_id:P,user_aborted:L}),r.danger(f,{toastId:"start_voice_mode_failure"}),b}},[y,f,_,u,M,e,s,r,i,o,t,l,h,C]),stopVoiceMode:x,isConnected:u,isVoiceModeActive:c}}export{to as $,Ce as A,Mo as C,nn as F,Io as I,Po as L,ko as N,Co as O,Et as R,Xn as S,Ao as T,oo as W,_o as Y,Ye as _,un as a,Ve as b,Zn as c,bo as d,xo as e,Oo as g,Ro as u,Eo as y};
//# sourceMappingURL=ehb03yyzqhj5ry6r.js.map
