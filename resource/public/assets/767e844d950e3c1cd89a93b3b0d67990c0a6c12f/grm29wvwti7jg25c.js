import{r as E,h as $,j as o,e as q}from"./mw35uwhq4g8r9eam.js";import{u as V,bg as B,O as J,iy as K,fr as Q,lc as X,iz as Y,iA as Z,cF as I,er as D,mk as ee,gF as O}from"./d0xa318sl7ywi0za.js";import{hj as R,hk as se,hl as ae,e1 as te,d2 as ne,hm as oe,hn as re,ho as ie}from"./g2euln7v5pbm31qa.js";function le({asset:s,contextConnectorSourceUrl:r,disableExpandable:d=!1,isSingle:c,isUserTurn:u,className:i}){var A,b;const t=V(),l=B(t).flags,[f,e]=E.useState(!1),n=!J(t),m=l==null?void 0:l.includes(K.NoAuthEnableFileUploads),h=Q(s.asset_pointer),a=R.useState(W=>R.selectFile(W,h)),M=se((A=a==null?void 0:a.file)!=null?A:null,a==null?void 0:a.file.name,(b=a==null?void 0:a.fileId)!=null?b:void 0,a==null?void 0:a.gizmoId,a==null?void 0:a.contextConnectorInfo,!0),N=n&&a&&m,{gizmoEditorData:x}=X(),v=ae(),U=E.useContext(Y),G=(U==null?void 0:U.serverSharedThreadId)&&u,_=Z(),{isOpen:k}=te(),j=$(),{data:y,isLoading:P,error:H}=ne({asset:s,gizmoId:x==null?void 0:x.id,getServerUrl:!N}),{url:S,width:w,height:C}=M&&m?{width:s.width,height:s.height,url:M}:y!=null?y:{},T=P||!f,p=w&&C?{Landscape:w>C,Portrait:w<C}:void 0,g=["overflow-hidden rounded-lg"];if(c&&(g.push("w-full h-full"),p!=null&&p.Landscape?g.push("max-w-96 max-h-64"):p!=null&&p.Portrait?g.push("max-h-96 max-w-64"):g.push("max-w-64 max-h-64")),i&&g.unshift(i),G&&_())return null;let L;return S!=null&&(L=o.jsx(oe,{alt:j.formatMessage(F.imageAltText),className:I(k?"max-w-[88px]":"max-w-full",!c&&"aspect-square","object-cover object-center",g),src:S,width:w,height:C,onLoad:()=>e(!0)}),!v&&!d&&(L=o.jsx(re,{src:S,alt:j.formatMessage(F.imageAltText),contextConnectorSourceUrl:r,className:I(g),children:L}))),o.jsx("div",{className:I(g),children:o.jsx("div",{className:I("bg-token-main-surface-secondary text-token-text-tertiary relative flex h-auto w-full max-w-lg items-center justify-center overflow-hidden",!c&&"aspect-square"),children:S!=null?L:o.jsx("div",{className:"flex items-center justify-center",style:{aspectRatio:"".concat(w," / ").concat(C),width:w},title:T?j.formatMessage(F.loadingImage):j.formatMessage(F.errorLoadingImage),children:T?o.jsx(D,{}):H?o.jsx(ee,{className:"icon-sm"}):null})})})}const F=q({loadingImage:{id:"textMessage.loadingImage",defaultMessage:"Loading..."},errorLoadingImage:{id:"textMessage.errorLoadingImage",defaultMessage:"Could not load image"},imageAltText:{id:"textMessage.imageAltText",defaultMessage:"Uploaded image"},targetedReply:{id:"textMessage.targetedReply",defaultMessage:"Replying to:"}});function z({assets:s,attachments:r,isUserTurn:d=!0,clientThreadId:c}){const u=s.length===1,{containerClassname:i,imageClassnames:t}=z.computeClassnames(s.length);let l=O.ATTACHMENT;return s&&!(r&&r.length>0)&&(l=O.IMAGE),o.jsxs("div",{className:"flex w-[var(--user-chat-width,70%)] flex-col items-end",children:[o.jsx("div",{className:I("flex flex-row items-center justify-end gap-1",i),children:s.map((f,e)=>{var m;const n=r==null?void 0:r.find(h=>h.id&&f.asset_pointer.includes(h.id));return o.jsx(le,{asset:f,isSingle:u,isUserTurn:d,contextConnectorSourceUrl:(m=n==null?void 0:n.context_connector_info)==null?void 0:m.source_url,className:t[e]},e)})}),o.jsx(ie,{featureType:l,isUserTurn:d,clientThreadId:c})]})}z.computeClassnames=s=>{if(s<2)return{containerClassname:null,imageClassnames:[]};let r=s>=4?"flex-wrap":"";const d=Array(s),c=e=>{d.fill(e)},u=e=>{r+=" ".concat(e)},i=(e,n)=>{d[e]=I(d[e],n)},t=s<=4&&s%2===0?2:3,l=Math.ceil(s/t),f=s%t!==0;t===2?(c("h-32 w-32"),u("max-w-72")):l<=2?(c("h-24 w-24 sm:h-32 sm:w-32"),u("max-w-80 sm:max-w-100")):(c("h-16 w-16"),u("max-w-52"));for(let e=0;e<s;e++){const n=Math.floor(e/t),m=e%t,h=Math.min(s-n*t,t),a=n===0,M=n===l-1,N=n===l-2,x=m===0,v=m===h-1;a&&x&&i(e,"rounded-ss-2xl"),a&&v&&i(e,"rounded-se-2xl"),M&&x&&i(e,"rounded-es-2xl"),M&&v&&i(e,"rounded-ee-sm"),f&&x&&N&&i(e,"rounded-es-2xl")}return{containerClassname:r,imageClassnames:d}};export{z as TextMessageImageGroup};
//# sourceMappingURL=grm29wvwti7jg25c.js.map
