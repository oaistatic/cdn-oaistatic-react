import{r as w,h as Ce,R as Ze,a as et,e as q,j as e,b as tt,M as d}from"./cs7toih8jegb7teq.js";import{e5 as at,e6 as te,e7 as A,e8 as D,e9 as Q,ea as z,eb as J,d$ as ae,ec as _e,ed as Z,ee as Ee,ef as we,eg as Me,eh as je,ei as Ne,ej as v,ek as k,b8 as st,el as nt,em as ve,bo as G,en as _,b1 as fe,eo as pe,ep as Y,eq as xe,er as Ae,es as ke,et as ot,eu as ye}from"./hnw079jsdm76umup.js";import{e as W,bQ as se,br as Se,bh as Le,bV as Be,A as lt,gs as rt,bm as it,P as U,c2 as ct,C as Te,bP as mt,z as ee,cT as K,i as Re,W as Oe,a0 as ne,cx as dt}from"./dmck639k4dv7claj.js";import{c as Fe}from"./iej0cupg2dqkmejt.js";import{u as oe,P as ut}from"./kyjth308quztvz31.js";import{u as gt}from"./f9bnpe34l2c3c1sm.js";import{u as Ie}from"./de0xekdnf43rd5ny.js";import{a as ht,b as ft,u as pt}from"./lox5zdwgg3gy3k4z.js";const xt=Fe(J),yt=({promoData:l,initialPromoCoupon:m,initialSeats:y}={})=>{const P=W(),f=ae(),s=at(P),t=te()??m,{data:g}=oe(t??"");let r=l;!l&&g&&(r=g);const a=r?.coupon===A&&r.state==="eligible",i=r&&D(r.coupon)&&r.state==="eligible",n=typeof window<"u"?new URLSearchParams(window?.location.search):new URLSearchParams,p=n.get(Q),u=n.get(z),S=a?J.FLEXIBLE:u&&xt(u)?u:J.FLEXIBLE,[T,x]=w.useState(S),[C,c]=w.useState(y??(p&&!isNaN(parseInt(p,10))?parseInt(p,10):Math.max(s,f)));return{promoData:r,selectedPlan:T,setSelectedPlan:x,numSeats:C,setNumSeats:c,minTeamSeats:f,TEAM1DOLLAR_COUPON_IsEligible:a,TEAM_FREE_TRIAL_COUPON_IsEligible:i}};var Ue=(l=>(l.FLEXIBLE="month",l.ANNUAL="year",l))(Ue||{});const be=Fe(Ue),vt=l=>{const m=w.useRef(!1),y=Ce(),P=y.hash.split("#")[1]===_e||y.hash.split("#")[1]===Z,f=se(),s=!m.current&&P&&f&&!l,{country:t}=ht(),g=ft({country:t,currentAccount:f,location:"team-workspace-purchase-modal"}),r=te(),{data:a,isLoading:i}=oe(r??"");W();const n=ae(),p=Ze.useRef(void 0);w.useEffect(()=>{s&&(Se.setPurchaseWorkspaceData({minimumSeats:n,billingDetails:g,promoData:a}),m.current=!0)},[f,g,n,P,l,r,a,s]),w.useEffect(()=>{const u=p.current;p.current=i,!(i||!m.current)&&u&&Se.setPurchaseWorkspaceData({minimumSeats:n,billingDetails:g,promoData:a})},[a,i,n,g])},Pe=dt.p`text-base font-medium mb-3`,De=({isOpen:l,onClose:m,onSubmit:y,minimumSeats:P,billingDetails:f,isDirectFlow:s=!1,promoData:t=void 0})=>{const g=se(),{trackSelectedPixels:r}=gt({key:lt.SELF_SERVE_BUSINESS}),{selectedPlan:a,setSelectedPlan:i,numSeats:n,setNumSeats:p,minTeamSeats:u,TEAM1DOLLAR_COUPON_IsEligible:S,TEAM_FREE_TRIAL_COUPON_IsEligible:T}=yt({promoData:t}),[x,C]=w.useState(!1),c=q(),h=f.currency,b=Math.max(P,u),{flexibleBillingPlan:M,annualBillingPlan:le}=Me(h);let j=M,re=null;if(S||T){re=t?.coupon===A?je(h):Ne(h);let o,E;S?(o={...h===rt?v.team1dollarMonthlyCostINR:v.team1dollarMonthlyCost},E={...v.team1dollarMonthlyStructure,defaultMessage:`Then ${c.formatMessage(j.currencySign)}${j.monthlyCost} seat/mo after 1 month`,id:"promo.team1dollar.monthlyPlanStructure",description:"Subsequent pricing description for team1dollar promo. Describing the monthly then the annual price after."}):(o={...k.teamFreeTrialMonthlyCost},E={...k.teamFreeTrialMonthlyStructure,defaultMessage:`Then ${c.formatMessage(j.currencySign)}${j.monthlyCost} seat/mo after 1 month`,id:"promo.teamFreeTrial.monthlyPlanStructure",description:"Subsequent pricing description for teamFreeTrial promo. Describing the monthly then the annual price after."}),j={...j,cost:o,costStructure:E,discountedMonthlyCost:re??j.discountedMonthlyCost}}const L=t?.coupon===A,We=t&&D(t?.coupon),F=L||We,ie=t?.state==="not_eligible"&&F,ce=t?.state==="temporary_disabled"&&F,He=t?.state==="offline"&&F,B=st(isNaN(n)?0:n,b,nt),R=w.useMemo(()=>g?.subscriptionAnalyticsParams,[g]),H=it(o=>o.purchaseWorkspaceData);w.useEffect(()=>{const o=H?.referrer??document.referrer;U.logEvent("Account Pay: Select Team Plan Modal Show",{...R,referrer:o})},[R,H?.referrer]);const me=o=>{switch(o){case"month":U.logEvent("Account Pay: Team Plan Selection Clicked",{...R,buttonType:"Continue",numberOfSeats:n,planLength:ye.MONTHLY});break;case"year":U.logEvent("Account Pay: Select Team Plan Modal Clicked",{...R,buttonType:"Continue",numberOfSeats:n,planLength:ye.ANNUAL});break}},$e=(o,E)=>{U.logEventWithStatsig("Account Pay: Select Team Plan Modal Clicked","chatgpt_select_team_plan_modal_continue_to_billing_clicked",{...R,buttonType:"Continue",numberOfSeats:E,planLength:o}),ne.addAction("chatgpt_funnel.team_plan_modal_checkout_initiated",{planLength:o,numberOfSeats:E.toString(),accountId:g?.id}),t?.state==="eligible"&&F&&ut.logCouponApplied(t.coupon)},Ve=()=>{U.logEvent("Account Pay: Select Team Plan Modal Dismiss",R)},N=Ce(),$=w.useMemo(()=>N.hash.split("#")[1]===Z,[N.hash]);w.useEffect(()=>{const o=new URLSearchParams;o.set(Q,B.toString()),o.set(z,a),o.set("referrer",H?.referrer??document.referrer);const E=t?.coupon&&t.coupon!==ve?t.coupon:null;E&&o.set(G,E);const he=s||$?`#${Z}`:`#${_e}`,Ge=`${N.pathname}?${o.toString()}${he}`,V=new URL(window.location.href).searchParams,Ke=V.get(Q)===B.toString(),Qe=V.get(z)===a,ze=E==null&&!V.has(G)||V.get(G)===E,Je=window.location.hash===he;(!Ke||!Qe||!ze||!Je)&&window.history.pushState({from:N.pathname+N.search},"",Ge)},[B,s,$,N.pathname,N.search,N.hash,a,t?.coupon,H?.referrer]);let I;ie?I=L?v.team1dollarNotEligible:k.teamFreeTrialNotEligible:ce?I=L?v.team1dollarTemporarilyDisabled:k.teamFreeTrialTemporarilyDisabled:I=L?v.team1dollarOffline:k.teamFreeTrialOffline;const de=ie||ce||He,ue=async()=>{C(!0),$e(a,B),r(),await y(a,B),C(!1)},Ye=()=>{m(),Ve()},qe=W(),X=!(s||$)&&ct(qe,"2307162844").get("enabled",!1),ge=e.jsx(St,{numSeats:B,selectedPlan:a,billingDetails:f,totalLabel:_.allPlansTodayTotal,billDate:e.jsx(d,{..._.today}),promoData:t}),O=S||T;if(s||$||X)return e.jsx(Te,{testId:"modal-workspace-purchase",type:"success",isOpen:l,onClose:m,size:"fullscreen",noPadding:!0,removePopoverStyling:!0,showCloseButton:!0,children:e.jsxs("div",{className:"grid grid-flow-row grid-cols-1 md:h-full md:grid-cols-2",children:[e.jsx("div",{className:"flex-column col-span-1 flex justify-center p-5 md:grid-cols-2",children:e.jsxs("div",{className:"flex w-full max-w-[400px] flex-col items-center md:max-w-[600px]",children:[e.jsx(mt,{className:"mt-8 mb-6 h-8 w-8 md:fixed md:start-4 md:top-4 md:mt-0 md:h-6 md:w-6"}),de&&e.jsx("div",{className:"mb-4 w-full","data-testid":"team-promo-banner",children:e.jsx(fe,{content:c.formatMessage(I),type:"info"})}),e.jsx("div",{className:"mb-8 text-3xl font-medium md:mt-[120px]",children:e.jsx(d,{id:"selectTeamPlanModal.title",defaultMessage:"Pick your plan"})}),e.jsxs(pe,{className:ee("col-span-3 mb-6 grid w-full gap-4 md:col-span-2 md:grid-cols-2"),defaultValue:a,onValueChange:o=>{be(o)&&(i(o),me(o))},children:[e.jsx(Y,{billingType:"year",...le,selectedValue:a,hideSavingsMessage:O,hideDetails:!X}),e.jsx(Y,{billingType:"month",...j,selectedValue:a,hideDetails:!X,hideSavingsMessage:O,showWelcomeOfferLabel:O})]}),e.jsx(xe,{numSeats:n,minSeats:b,setNumSeats:p}),e.jsx("div",{className:"text-token-text-secondary self-start text-xs",children:c.formatMessage({id:"selectTeamPlanModal.seatsDescription",defaultMessage:"Add more seats at any time. Minimum of {minSeats} seats."},{minSeats:u})})]})}),e.jsx("div",{className:"col-span-3 flex h-full flex-col items-center overflow-hidden p-6 md:col-span-1 md:shadow-lg",children:e.jsxs("div",{className:"flex w-full max-w-[400px] flex-col md:mt-[120px]",children:[e.jsx(Pe,{className:"mb-8 text-xl font-medium",children:e.jsx(d,{..._.summaryTitle})}),ge,e.jsx(K,{title:c.formatMessage(_.continueToBillingButton),onClick:ue,loading:x,color:"green",className:"mt-8 w-full rounded-xl"}),e.jsx(K,{title:c.formatMessage(_.cancel),onClick:Ye,color:"ghost",className:"mt-4 w-full rounded-xl"})]})})]})});const Xe=L?Ae:ke;return e.jsxs(Te,{testId:"modal-select-team-plan",type:"success",isOpen:l,onClose:m,size:"custom",noPadding:!0,removePopoverStyling:!0,className:"max-w-4xl",showCloseButton:!0,hasSeparator:!0,title:c.formatMessage(_.selectTeamPlanModalTitle),children:[de&&e.jsx("div",{className:"px-5 pt-4","data-testid":"team-promo-banner",children:e.jsx(fe,{content:c.formatMessage(I),type:"info"})}),e.jsxs("div",{className:"grid grid-flow-row grid-cols-3",children:[e.jsxs("div",{className:"flex-column col-span-3 p-5 md:col-span-2 md:grid-cols-2",children:[e.jsx(xe,{numSeats:n,minSeats:b,setNumSeats:p}),F&&t?.state==="eligible"&&a==="month"&&n>Xe&&e.jsx("div",{className:"text-token-text-secondary mt-1 self-start text-xs","data-testid":"team-promo-overseats-disclaimer",children:e.jsx(d,{...L?v.team1dollarOverSeatsDisclaimer:k.teamFreeTrialOverSeatsDisclaimer})}),e.jsxs(pe,{className:ee("col-span-3 mt-5 grid gap-4 md:col-span-2 md:grid-cols-2"),defaultValue:a,onValueChange:o=>{be(o)&&(i(o),me(o))},children:[e.jsx(Y,{billingType:"year",...le,selectedValue:a,hideSavingsMessage:O}),e.jsx(Y,{billingType:"month",...j,selectedValue:a,hideSavingsMessage:O,showWelcomeOfferLabel:O})]})]}),e.jsxs("div",{className:"border-token-main-surface-tertiary bg-token-bg-elevated-secondary col-span-3 flex h-full flex-col overflow-hidden border-s p-6 md:col-span-1",children:[e.jsx(Pe,{children:e.jsx(d,{..._.summaryTitle})}),ge,e.jsx(K,{title:c.formatMessage(_.continueToBillingButton),onClick:ue,loading:x,color:"primary",className:"mt-8 w-full rounded-xl"})]})]})]})},St=({numSeats:l,selectedPlan:m,billingDetails:y,totalLabel:P,billDate:f,promoData:s})=>{const t=q(),{flexibleBillingPlan:g,annualBillingPlan:r}=Me(y.currency),a=g,i=m==="month"?a:r,n=ot[m],p=(l||0)*(m==="year"?r.monthlyCost*12:a.monthlyCost);let u=(l||0)*i.unitCost,S=p-u,T=0,x=p,C=!1;if(s!=null&&(s.coupon===A||D(s.coupon))&&s.state==="eligible"&&m==="month"){C=!0;const h=s?.coupon===A?je(y.currency):Ne(y.currency),b=s?.coupon===A?Ae:ke;l<=b?(T=h,x=l*a.monthlyCost,S=x-T,u=T):(T=h+(l-b)*a.monthlyCost,x=l*a.monthlyCost,S=x-T,u=T)}let c;return s!=null&&D(s.coupon)&&s.coupon!==ve&&s.state==="eligible"&&m==="month"&&(c={title:{id:"promo.teamFreeTrial.temporaryCardHold",defaultMessage:"Temporary card hold",description:"Label for the temporary card hold line item in the billing summary"},description:{id:"promo.teamFreeTrial.temporaryCardHoldDescription",defaultMessage:"Used to verify payment — we'll refund it",description:"Description for the temporary card hold line item in the billing summary"},amount:1},u+=1),e.jsxs("div",{className:"flex grow flex-col text-sm",children:[e.jsxs("div",{className:"text-token-text-secondary flex w-full justify-between text-sm",children:[e.jsx("div",{className:"flex",children:e.jsx(d,{...n.name})}),e.jsx("div",{className:"flex",children:e.jsx(d,{..._.allPlansPreDiscountTotal,values:{currencySign:t.formatMessage(i.currencySign),preDiscountTotalAmount:p.toLocaleString()}})})]}),e.jsxs("div",{className:"text-token-text-tertiary flex w-full justify-between text-xs",children:[e.jsx("div",{className:"flex",children:e.jsx(d,{...n.breakdown,values:{numSeats:l}})}),e.jsx("div",{className:"flex",children:e.jsx(d,{..._.breakdownAmount,values:{currencySign:t.formatMessage(i.currencySign),amount:i.monthlyCost}})})]}),c&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-token-text-secondary mt-3 flex w-full justify-between text-sm",children:[e.jsx("div",{className:"flex",children:e.jsx(d,{...c.title})}),e.jsx("div",{className:"flex",children:e.jsx(d,{id:"promo.teamFreeTrial.temporaryCardHoldAmount",defaultMessage:"{currencySign}{amount}",description:"Amount for the temporary card hold line item (e.g., $1). Keep the currency sign and numeric amount placeholders; translators may reorder them per locale.",values:{currencySign:t.formatMessage(i.currencySign),amount:c.amount.toLocaleString()}})})]}),c.description&&e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(d,{...c.description})})]}),e.jsxs("div",{className:"text-token-text-secondary mt-3 flex w-full justify-between text-sm",children:[e.jsx("div",{className:"flex",children:e.jsx(d,{..._.planDiscountLabel})}),e.jsx("div",{className:ee("flex",S>0&&"font-medium text-[#10A37F]"),children:e.jsx(d,{...n.discountAmount,values:{currencySign:t.formatMessage(a.currencySign),discountAmount:S.toLocaleString()}})})]}),s!=null&&(s.coupon===A||D(s.coupon))&&s.state==="eligible"&&m==="month"&&e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(d,{...s?.coupon===A?v.team1dollarBelowDiscount:k.teamFreeTrialBelowDiscount})}),n.discountDescription&&r.discountedMonthlyCost<r.monthlyCost&&m==="year"&&e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(d,{...n.discountDescription,values:{discountPercentage:Math.floor((1-r.discountedMonthlyCost/r.monthlyCost)*100)}})}),e.jsx("hr",{className:"border-token-border-default my-3"}),e.jsxs("div",{className:"flex w-full justify-between text-base font-medium",children:[e.jsx("div",{className:"flex",children:e.jsx(d,{...P})}),e.jsx("div",{className:"flex",children:C?e.jsxs(e.Fragment,{children:[t.formatMessage(i.currencyCode)," ",t.formatMessage(i.currencySign),u.toLocaleString()]}):e.jsx(d,{...n.total,values:{currencyCode:t.formatMessage(i.currencyCode),currencySign:t.formatMessage(i.currencySign),totalAmount:u.toLocaleString()}})})]}),e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx("div",{className:"text-token-text-tertiary mt-2 text-xs",children:C?e.jsx(d,{id:"ngnBJG",defaultMessage:"After promotional period {currencySign}{amount} per month",values:{currencySign:t.formatMessage(a.currencySign),amount:x.toLocaleString()}}):e.jsx(d,{...n.billed,values:{billDate:f}})})})]})};function At(){const l=se(),m=et(),{prepareCheckoutSession:y,navigateToCheckout:P}=Ie(),f=W(),s=ae(),{initialBillingDetails:t}=pt(l,!0),g=q(),r=Le(),a=Ee(g,void 0,r),i=Be(),n=te(),{data:p}=oe(n??""),{eligible:u,campaignId:S}=we(),x=p??(!n&&u?{coupon:S,state:"eligible"}:void 0),C=async(h,b)=>{if(!Re(f)){Oe(f,{fallbackScreenHint:"login",callbackUrl:window.location.href});return}try{const M=await y({plan_name:"chatgptteamplan",team_plan_data:{workspace_name:a,price_interval:h,seat_quantity:b},billing_details:t,promo_campaign:h==="month"?x?.coupon:null});await P(M)}catch(M){ne.addError(M),i.warning(g.formatMessage(_.paymentErrorWarning),{hasCloseButton:!0})}},c=()=>{m("/")};return e.jsx(De,{isOpen:!0,onClose:c,onSubmit:(h,b)=>C(h,b),isDirectFlow:!0,minimumSeats:s,billingDetails:t,promoData:x})}const kt=({isOpen:l,onClose:m,minimumSeats:y,billingDetails:P,existingAccount:f=void 0,promoData:s=void 0})=>{const t=q(),g=Be(),r=Le(),{prepareCheckoutSession:a,navigateToCheckout:i}=Ie(),n=W(),[p]=tt(),u=p.get("from_webview")==="ios",S=Ee(t,f,r),{eligible:T,campaignId:x}=we(),C=s??(T?{coupon:x,state:"eligible"}:void 0),c=async(h,b)=>{if(!Re(n)){Oe(n,{fallbackScreenHint:"login",callbackUrl:window.location.href});return}try{const M=await a({plan_name:"chatgptteamplan",team_plan_data:{workspace_name:S,price_interval:h,seat_quantity:b,existing_workspace_id:f?.id},billing_details:P,cancel_url:window.location.href,promo_campaign:h==="month"?C?.coupon:null},{fromiOSWebview:u});await i(M)}catch(M){ne.addError(M),g.warning(t.formatMessage(_.paymentErrorWarning),{hasCloseButton:!0})}};return e.jsx(De,{isOpen:l,onClose:m,onSubmit:(h,b)=>c(h,b),minimumSeats:y,billingDetails:P,promoData:C})};export{St as B,At as T,kt as a,yt as b,vt as u};
//# sourceMappingURL=c6yb6cmc50jj0xn1.js.map
