import{hR as j,qW as v,f$ as V,cx as R,hH as H,P,de as W,qX as X,m6 as d}from"./dmck639k4dv7claj.js";import{i as O,dy as Y,jH as J,k4 as U,ka as G}from"./hnw079jsdm76umup.js";import{r as B,j as y,m as K,M as Q}from"./cs7toih8jegb7teq.js";import{c as Z,b as tt,i as et}from"./owiiott81wvonpc1.js";const Ct=()=>t=>{j(t,e=>{if(!O(e)||e.name!==v)return;const u=e.data??(e.data={}),r=e.attributes?.index;if(r==null)return;u.hName=v,u.hProperties={index:r};let a="inline";switch(e.type){case"textDirective":a="inline";break;case"leafDirective":a="block";break;case"containerDirective":a="container";break}u.hProperties.displayLayout=a})},N="contextList";function qt(){return t=>{j(t,e=>{if(!O(e)||e.name!==N)return;const u=e.data??(e.data={});u.hName=N})}}function nt(t){if(typeof t!="object"||t==null||!("props"in t)||t.props==null)return;const e=t.props;if(e.node?.tagName===v)return parseInt(e.index)}const D=R.div`gap-6 border-b pb-4 my-4 context-list border-token-border-default`;function zt({children:t}){const e=B.useContext(Y),u=Array.isArray(t)?t:V([t]);if(u.length===0||e?.analyticsMetadata.turnIndex===void 0)return null;const[r,...a]=u,h=nt(r);if(h!=null&&e!=null){const c=e?.contentReferences?.[h],g=c?.type==="image_v2",l=c?.type==="optimistic_image_citation";if(g||l)return y.jsxs(D,{className:"flex w-full",children:[y.jsx("div",{className:"grow leading-normal",children:a}),y.jsxs("div",{className:"mt-2 flex w-24 shrink-0",children:[g&&c.images[0]&&y.jsx(it,{imageRef:c,analyticsMetadata:e.analyticsMetadata}),l&&y.jsx(rt,{optimisticRef:c})]})]})}return y.jsx(D,{className:"leading-normal",children:u})}const A=R.button`not-prose flex w-full h-fit	items-center justify-center overflow-hidden rounded-lg max-h-48`;function it({imageRef:t,analyticsMetadata:e}){const u=t.images[0],r=u.thumbnail_size.width/u.thumbnail_size.height,a=Z(u,{width:200,height:Math.max(Math.round(200/r),112)}),{isSuccess:h}=tt(a,"ContextListImage"),c=J.useStore(),g=B.useRef(!1),l={...H(e),type:"context_list_image_thumbnail",image_url:a};return g.current||(g.current=!0,P.logEventWithStatsig("Search Content Reference Shown","search_content_reference_shown",l)),y.jsx(A,{onClick:()=>{c.setCurrentImage({image:u,source:U.Turn,analyticsMetadata:e}),P.logEventWithStatsig("Search Content Reference Clicked","search_content_reference_clicked",l)},children:y.jsx(K.img,{src:a,className:"w-full object-cover",alt:u.title,initial:{opacity:0},animate:h?{opacity:1}:{},whileHover:{scale:1.1,transition:et}})})}function rt({optimisticRef:t}){return y.jsx(A,{children:t.status==="done"?y.jsx(W,{label:y.jsx(Q,{id:"8JYwCi",defaultMessage:"Error fetching image"}),children:y.jsx(G,{className:"text-token-text-tertiary h-24 w-12"})}):y.jsx("div",{className:"bg-token-main-surface-tertiary h-24 w-full animate-pulse"})})}function at(){return{enter:{mathFlow:t,mathFlowFenceMeta:e,mathText:h},exit:{mathFlow:a,mathFlowFence:r,mathFlowFenceMeta:u,mathFlowValue:g,mathText:c,mathTextData:g}};function t(l){const x={type:"element",tagName:"code",properties:{className:["language-math","math-display"]},children:[]};this.enter({type:"math",meta:null,value:"",data:{hName:"pre",hChildren:[x]}},l)}function e(){this.buffer()}function u(){const l=this.resume(),x=this.stack[this.stack.length-1];d(x.type==="math"),x.meta=l}function r(){this.data.mathFlowInside||(this.buffer(),this.data.mathFlowInside=!0)}function a(l){const x=this.resume().replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),p=this.stack[this.stack.length-1];d(p.type==="math"),this.exit(l),p.value=x;const w=p.data.hChildren[0];d(w.type==="element"),d(w.tagName==="code"),w.children.push({type:"text",value:x}),this.data.mathFlowInside=void 0}function h(l){this.enter({type:"inlineMath",value:"",data:{hName:"code",hProperties:{className:["language-math","math-inline"]},hChildren:[]}},l),this.buffer()}function c(l){const x=this.resume(),p=this.stack[this.stack.length-1];d(p.type==="inlineMath"),this.exit(l),p.value=x,p.data.hChildren.push({type:"text",value:x})}function g(l){this.config.enter.data.call(this,l),this.config.exit.data.call(this,l)}}function ut(t){let e={}.singleDollarTextMath;return e==null&&(e=!0),r.peek=a,{unsafe:[{character:"\r",inConstruct:"mathFlowMeta"},{character:`
`,inConstruct:"mathFlowMeta"},{character:"$",after:e?void 0:"\\$",inConstruct:"phrasing"},{character:"$",inConstruct:"mathFlowMeta"},{atBreak:!0,character:"$",after:"\\$"}],handlers:{math:u,inlineMath:r}};function u(h,c,g,l){const x=h.value||"",p=g.createTracker(l),w="$".repeat(Math.max(X(x,"$")+1,2)),s=g.enter("mathFlow");let i=p.move(w);if(h.meta){const k=g.enter("mathFlowMeta");i+=p.move(g.safe(h.meta,{after:`
`,before:i,encode:["$"],...p.current()})),k()}return i+=p.move(`
`),x&&(i+=p.move(x+`
`)),i+=p.move(w),s(),i}function r(h,c,g){let l=h.value||"",x=1;for(e||x++;new RegExp("(^|[^$])"+"\\$".repeat(x)+"([^$]|$)").test(l);)x++;const p="$".repeat(x);/[^ \r\n]/.test(l)&&(/^[ \r\n]/.test(l)&&/[ \r\n]$/.test(l)||/^\$|\$$/.test(l))&&(l=" "+l+" ");let w=-1;for(;++w<g.unsafe.length;){const s=g.unsafe[w];if(!s.atBreak)continue;const i=g.compilePattern(s);let k;for(;k=i.exec(l);){let T=k.index;l.codePointAt(T)===10&&l.codePointAt(T-1)===13&&T--,l=l.slice(0,T)+" "+l.slice(k.index+1)}}return p+l+p}function a(){return"$"}}const o={eof:null,space:32,dollarSign:36,leftParenthesis:40,rightParenthesis:41,leftSquareBracket:91,backslash:92,rightSquareBracket:93};function S(t){return t!==null&&t<-2}function $(t){return t===-2||t===-1||t===32}function f(t,e,u,r){const a=r?r-1:Number.POSITIVE_INFINITY;let h=0;return c;function c(l){return $(l)?(t.enter(u),g(l)):e(l)}function g(l){return $(l)&&h++<a?(t.consume(l),g):(t.exit(u),e(l))}}const C={contentTypeString:"string",tabSize:4},m={whitespace:"whitespace",lineEnding:"lineEnding",linePrefix:"linePrefix",characterEscape:"characterEscape",chunkString:"chunkString"};const lt={tokenize:st,concrete:!0},ot={tokenize:ht,partial:!0};function st(t,e,u){const r=this,a=this.events[this.events.length-1],h=a&&a[1].type===m.linePrefix?a[2].sliceSerialize(a[1],!0).length:0,c=[];return g;function g(n){return t.enter("mathFlow"),t.enter("mathFlowFence"),t.enter("mathFlowFenceSequence"),l(n)}function l(n){return n===o.backslash||n===o.leftSquareBracket&&c[0]===o.backslash?(t.consume(n),c.push(n),l):(t.exit("mathFlowFenceSequence"),c.length<2?u(n):f(t,x,m.whitespace)(n))}function x(n){return n===o.eof||S(n)?w(n):(t.enter("mathFlowFenceMeta"),t.enter(m.chunkString,{contentType:C.contentTypeString}),p(n))}function p(n){return n===o.eof||S(n)?(t.exit(m.chunkString),t.exit("mathFlowFenceMeta"),w(n)):n===o.rightSquareBracket?u(n):(t.consume(n),p)}function w(n){return t.exit("mathFlowFence"),r.interrupt?e(n):s(n)}function s(n){return n===o.eof?k(n):S(n)?t.attempt(ot,t.attempt({tokenize:T,partial:!0},k,h?f(t,s,m.linePrefix,h+1):s),k)(n):(t.enter("mathFlowValue"),i(n))}function i(n){return n===o.eof||S(n)?(t.exit("mathFlowValue"),s(n)):(t.consume(n),i)}function k(n){return t.exit("mathFlow"),e(n)}function T(n,q,M){const E=[];return f(n,z,m.linePrefix,C.tabSize);function z(F){return n.enter("mathFlowFence"),n.enter("mathFlowFenceSequence"),b(F)}function b(F){return F===o.backslash&&E.length===0||F===o.rightSquareBracket&&E[0]===o.backslash?(n.consume(F),E.push(F),b):E<c?M(F):(n.exit("mathFlowFenceSequence"),f(n,I,m.whitespace)(F))}function I(F){return F===o.eof||S(F)?(n.exit("mathFlowFence"),q(F)):M(F)}}}function ht(t,e,u){const r=this;return a;function a(c){return t.enter(m.lineEnding),t.consume(c),t.exit(m.lineEnding),h}function h(c){return r.parser.lazy[r.now().line]?u(c):e(c)}}const ct={tokenize:pt,concrete:!0},mt={tokenize:xt,partial:!0};function pt(t,e,u){const r=this,a=r.events[r.events.length-1],h=a&&a[1].type===m.linePrefix?a[2].sliceSerialize(a[1],!0).length:0;let c=0;return g;function g(n){return t.enter("mathFlow"),t.enter("mathFlowFence"),t.enter("mathFlowFenceSequence"),l(n)}function l(n){return n===o.dollarSign?(t.consume(n),c++,l):(t.exit("mathFlowFenceSequence"),c<2?u(n):f(t,x,m.whitespace)(n))}function x(n){return n===o.eof||S(n)?w(n):(t.enter("mathFlowFenceMeta"),t.enter(m.chunkString,{contentType:C.contentTypeString}),p(n))}function p(n){return n===o.eof||S(n)?(t.exit(m.chunkString),t.exit("mathFlowFenceMeta"),w(n)):n===o.dollarSign?u(n):(t.consume(n),p)}function w(n){return t.exit("mathFlowFence"),r.interrupt?e(n):s(n)}function s(n){return n===o.eof?k(n):S(n)?t.attempt(mt,t.attempt({tokenize:T,partial:!0},k,h?f(t,s,m.linePrefix,h+1):s),k)(n):(t.enter("mathFlowValue"),i(n))}function i(n){return n===o.eof||S(n)?(t.exit("mathFlowValue"),s(n)):(t.consume(n),i)}function k(n){return t.exit("mathFlow"),e(n)}function T(n,q,M){let E=0;return f(n,z,m.linePrefix,C.tabSize);function z(F){return n.enter("mathFlowFence"),n.enter("mathFlowFenceSequence"),b(F)}function b(F){return F===o.dollarSign?(n.consume(F),E++,b):E<c?M(F):(n.exit("mathFlowFenceSequence"),f(n,I,m.whitespace)(F))}function I(F){return F===o.eof||S(F)?(n.exit("mathFlowFence"),q(F)):M(F)}}}function xt(t,e,u){const r=this;return a;function a(c){return t.enter(m.lineEnding),t.consume(c),t.exit(m.lineEnding),h}function h(c){return r.parser.lazy[r.now().line]?u(c):e(c)}}function gt(){return{tokenize:t,resolve:wt,previous:L};function t(e,u,r){const a=[];let h=[],c;const g=this;return l;function l(i){return L.call(g,g.previous)&&(g.previous,void 0),e.enter("mathText"),e.enter("mathTextSequence"),x(i)}function x(i){return i===o.backslash&&a.length===0||i===o.leftParenthesis&&a.length===1?(e.consume(i),a.push(i),x):a.length<2?r(i):(e.exit("mathTextSequence"),p(i))}function p(i){return i===o.eof?r(i):i===o.backslash?(c=e.enter("mathTextSequence"),h=[],s(i)):i===o.space?(e.enter("space"),e.consume(i),e.exit("space"),p):S(i)?(e.enter(m.lineEnding),e.consume(i),e.exit(m.lineEnding),p):(e.enter("mathTextData"),w(i))}function w(i){return i===o.eof||i===o.space||i===o.backslash||S(i)?(e.exit("mathTextData"),p(i)):(e.consume(i),w)}function s(i){return i===o.backslash&&h.length===0||i===o.rightParenthesis&&h.length===1?(e.consume(i),h.push(i),s):h.length===a.length?(e.exit("mathTextSequence"),e.exit("mathText"),u(i)):(c.type="mathTextData",w(i))}}}function wt(t){let e=t.length-4,u=3,r,a;if((t[u][1].type===m.lineEnding||t[u][1].type==="space")&&(t[e][1].type===m.lineEnding||t[e][1].type==="space")){for(r=u;++r<e;)if(t[r][1].type==="mathTextData"){t[e][1].type="mathTextPadding",t[u][1].type="mathTextPadding",u+=2,e-=2;break}}for(r=u-1,e++;++r<=e;)a===void 0?r!==e&&t[r][1].type!==m.lineEnding&&(a=r):(r===e||t[r][1].type===m.lineEnding)&&(t[a][1].type="mathTextData",r!==a+2&&(t[a][1].end=t[r-1][1].end,t.splice(a+2,r-a-2),e-=r-a-2,r=a+2),a=void 0);return t}function L(t){return t!==o.backslash||this.events[this.events.length-1][1].type===m.characterEscape}function Ft(){return{tokenize:t,resolve:St,previous:kt};function t(e,u,r){let a=0,h,c;return g;function g(s){return e.enter("mathText"),e.enter("mathTextSequence"),l(s)}function l(s){return s===o.dollarSign?(e.consume(s),a++,l):a<2?r(s):(e.exit("mathTextSequence"),x(s))}function x(s){return s===o.eof?r(s):s===o.dollarSign?(c=e.enter("mathTextSequence"),h=0,w(s)):s===o.space?(e.enter("space"),e.consume(s),e.exit("space"),x):S(s)?(e.enter(m.lineEnding),e.consume(s),e.exit(m.lineEnding),x):(e.enter("mathTextData"),p(s))}function p(s){return s===o.eof||s===o.space||s===o.dollarSign||S(s)?(e.exit("mathTextData"),x(s)):(e.consume(s),p)}function w(s){return s===o.dollarSign?(e.consume(s),h++,w):h===a?(e.exit("mathTextSequence"),e.exit("mathText"),u(s)):(c.type="mathTextData",p(s))}}}function St(t){let e=t.length-4,u=3,r,a;if((t[u][1].type===m.lineEnding||t[u][1].type==="space")&&(t[e][1].type===m.lineEnding||t[e][1].type==="space")){for(r=u;++r<e;)if(t[r][1].type==="mathTextData"){t[e][1].type="mathTextPadding",t[u][1].type="mathTextPadding",u+=2,e-=2;break}}for(r=u-1,e++;++r<=e;)a===void 0?r!==e&&t[r][1].type!==m.lineEnding&&(a=r):(r===e||t[r][1].type===m.lineEnding)&&(t[a][1].type="mathTextData",r!==a+2&&(t[a][1].end=t[r-1][1].end,t.splice(a+2,r-a-2),e-=r-a-2,r=a+2),a=void 0);return t}function kt(t){return t!==o.dollarSign||this.events[this.events.length-1][1].type===m.characterEscape}function yt(){return{tokenize:t,resolve:Tt,previous:_};function t(e,u,r){const a=[];let h=[],c;const g=this;return l;function l(i){return _.call(g,g.previous)&&(g.previous,void 0),e.enter("mathText"),e.enter("mathTextSequence"),x(i)}function x(i){return i===o.backslash&&a.length===0||i===o.leftSquareBracket&&a.length===1?(e.consume(i),a.push(i),x):a.length<2?r(i):(e.exit("mathTextSequence"),p(i))}function p(i){return i===o.eof?r(i):i===o.backslash?(c=e.enter("mathTextSequence"),h=[],s(i)):i===o.space?(e.enter("space"),e.consume(i),e.exit("space"),p):S(i)?(e.enter(m.lineEnding),e.consume(i),e.exit(m.lineEnding),p):(e.enter("mathTextData"),w(i))}function w(i){return i===o.eof||i===o.space||i===o.backslash||S(i)?(e.exit("mathTextData"),p(i)):(e.consume(i),w)}function s(i){return i===o.backslash&&h.length===0||i===o.rightSquareBracket&&h.length===1?(e.consume(i),h.push(i),s):h.length===a.length?(e.exit("mathTextSequence"),e.exit("mathText"),u(i)):(c.type="mathTextData",w(i))}}}function Tt(t){let e=t.length-4,u=3,r,a;if((t[u][1].type===m.lineEnding||t[u][1].type==="space")&&(t[e][1].type===m.lineEnding||t[e][1].type==="space")){for(r=u;++r<e;)if(t[r][1].type==="mathTextData"){t[e][1].type="mathTextPadding",t[u][1].type="mathTextPadding",u+=2,e-=2;break}}for(r=u-1,e++;++r<=e;)a===void 0?r!==e&&t[r][1].type!==m.lineEnding&&(a=r):(r===e||t[r][1].type===m.lineEnding)&&(t[a][1].type="mathTextData",r!==a+2&&(t[a][1].end=t[r-1][1].end,t.splice(a+2,r-a-2),e-=r-a-2,r=a+2),a=void 0);return t}function _(t){return t!==o.backslash||this.events[this.events.length-1][1].type===m.characterEscape}function Et(){return{flow:{[o.dollarSign]:ct,[o.backslash]:lt},text:{[o.dollarSign]:Ft(),[o.backslash]:[gt(),yt()]}}}function It(){const t=this.data();e("micromarkExtensions",Et()),e("fromMarkdownExtensions",at()),e("toMarkdownExtensions",ut());function e(u,r){(t[u]?t[u]:t[u]=[]).push(r)}}export{zt as C,Ct as a,qt as b,N as c,It as r};
//# sourceMappingURL=ci3idol558isr68b.js.map
