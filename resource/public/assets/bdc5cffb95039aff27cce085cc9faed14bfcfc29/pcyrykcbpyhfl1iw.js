import{S as $,qs as pe,q1 as me,B as O,z as fe,gd as De,hz as Le,cK as he,cM as xe,e as V,og as Oe,p as G,qt as u,de as be,C as ke,R as Z,bQ as q,bV as ae,cS as Ce,cW as Se,mB as Ge,s9 as We,sa as Fe,iL as J,aH as Ke,k as He,m as de,qv as Ve,gL as ue,qJ as qe,qF as ze,pg as Y,nP as Ue,gA as Be,sb as Ye,sc as Qe,lU as Xe}from"./dmck639k4dv7claj.js";import{r as k,j as e,e as E,a as ne,M as d,d as W,p as x,L as $e,u as Ze,f as oe,i as ie,s as Je,b as es}from"./cs7toih8jegb7teq.js";import{jV as ss,Z as ts,cc as as,qd as ns,qe as os,cw as is,aj as D,hr as rs}from"./hnw079jsdm76umup.js";import{R as ls,i as je,U as cs,u as ds,a as us,P as gs}from"./jrghdhu2ph383v8i.js";import{j as re,c as we,e as Me,k as ps,g as ms,h as fs,i as hs}from"./ou991750qr9yzoff.js";import{T}from"./jowyjrirlo5h1pme.js";import{C}from"./ldikwabuatbmeus0.js";import{S as xs}from"./if861sq56k12kkjx.js";import{E as bs}from"./ec6gizbh044so065.js";import{W as ks,B as y}from"./i9ydvgbivdm8euag.js";import{e as A,A as Cs,a as Ss,b as js,d as ye,c as f}from"./b5m6pkropmlgxhpi.js";import{W as _}from"./bzq41qkdlic4f3pg.js";import{T as ws,a as Ms}from"./jj5p4w29ttp35ubu.js";import{a as ys,c as _s,u as Ts,d as As}from"./hwrbhfwvlxz8ucwy.js";import"./ecchxv5wz55k703w.js";import"./oasstlv4rvegny2a.js";import"./m9o58vphd3ndk69b.js";import"./kizn5m1hr7kdjf9n.js";import"./nfubiloo9rdxk3kj.js";import"./hsurwbv79wrpc9dg.js";import"./lxgn8k46ba24438b.js";import"./k4ghje9xipg90eb2.js";import"./lox5zdwgg3gy3k4z.js";import"./itn5frgf3bcgdkwm.js";import"./l1m3l5lbmhuctzw6.js";import"./mahhuo4zclh446vl.js";import"./dfhgw8mxn1h3ecpw.js";import"./kbe4rf7g0jwp6hai.js";import"./jd17yzpadn74fmtb.js";import"./liqaqj2w179grtbv.js";const vs=({workspaceId:t})=>{const{data:s}=re({workspaceId:t}),[a,n]=k.useState("");k.useEffect(()=>{const o=()=>{const h=s?.data.find(b=>je(b));h&&n(h.id)};s?.data&&o()},[s]);const{data:l,refetch:i}=we({workspaceId:t,roleId:a??""}),{updateRole:c}=Me({workspaceId:t}),m=k.useCallback(async o=>{const h=await c(o);h.id!==a&&n(h.id),i()},[a,i,c]);return e.jsx("div",{className:"mt-6",children:l?e.jsx(ls,{role:l,onSave:m}):e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:e.jsx($,{})})})};function Ps({workspaceId:t}){const s=E(),a=ne(),[n,l]=k.useState(""),{data:i,isLoading:c,isPlaceholderData:m}=re({workspaceId:t}),[o,h]=k.useState(!1),b=k.useMemo(()=>i?.data.filter(S=>!S.predefined_role&&(S.name.toLowerCase().includes(n.toLowerCase())||S.description?.toLowerCase().includes(n.toLowerCase()))),[i?.data,n]),g=S=>{S&&l(""),h(S)},v=pe(),{createRole:P}=ps({workspaceId:t,currentRoles:b,bootstrapResources:v?["connectors"]:void 0});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-6 mb-3 flex flex-row justify-between gap-2",children:[e.jsx(me,{inputClassName:"w-[250px] rounded-full! text-sm",value:n,onChange:S=>{l(S.target.value)},placeholder:s.formatMessage({id:"workspaceSettings.roles.search",defaultMessage:"Search role name"})}),e.jsx(O,{onClick:()=>g(!0),icon:ss,children:e.jsx(d,{id:"workspaceSettings.roles.create",defaultMessage:"Create role"})})]}),e.jsx("div",{children:e.jsxs(T.Root,{className:"min-w-full",children:[e.jsxs("colgroup",{children:[e.jsx("col",{className:"w-[70%]"}),e.jsx("col",{className:"w-[30%]"})]}),e.jsxs(T.Header,{children:[e.jsx(T.HeaderCell,{children:e.jsx(d,{id:"workspaceSettings.roles.roleName",defaultMessage:"Role name"})}),e.jsx(T.HeaderCell,{children:e.jsx(d,{id:"workspaceSettings.roles.created",defaultMessage:"Last updated by"})}),e.jsx(T.HeaderCell,{})]}),e.jsx(T.Body,{className:fe((c||m)&&"opacity-50"),children:b==null?e.jsx(T.Row,{children:e.jsx(T.Cell,{colSpan:5,textAlign:"center",children:e.jsx($,{})})}):b.length===0?e.jsx(T.Row,{children:e.jsx(T.Cell,{colSpan:5,textAlign:"center",children:n===""?e.jsx(d,{id:"workspaceSettings.roles.noRoles",defaultMessage:"No roles found."}):e.jsx(d,{id:"workspaceSettings.roles.noRolesWithFilter",defaultMessage:"No roles found. Try changing the search query."})})}):b.map(S=>e.jsx(Es,{role:S},S.id))})]})}),o&&e.jsx(cs,{onClose:()=>g(!1),onSave:async S=>{const R=await P(S);a(`/admin/permissions/roles/${R.role.id}`)},isCreate:!0})]})}function Es({role:t}){const s=ne();return e.jsx(e.Fragment,{children:e.jsxs(T.Row,{className:"[&>td]:py-2",onClick:()=>{s(`/admin/permissions/roles/${t.id}`)},children:[e.jsx(T.Cell,{children:e.jsxs("div",{className:"flex flex-row items-center gap-3",children:[e.jsx("div",{children:t.predefined_role?e.jsx(ts,{className:"icon"}):e.jsx(De,{className:"icon"})}),e.jsxs("div",{children:[e.jsx("div",{children:t.name}),e.jsx("div",{className:"text-token-text-tertiary text-sm",children:t.description})]})]})}),e.jsx(T.Cell,{className:"truncate lowercase",children:t.created_by_user_obj?.email??""})]})})}function Rs({workspaceId:t,tooltip:s,tooltipValues:a,description:n,disabled:l}){return e.jsx(ks,{connectorId:he[xe.GITHUB_CONNECTOR],disabled:l,label:Ns.platformConnectorsGithub,labelValues:{badge:i=>e.jsx("span",{className:"bg-token-bg-tertiary text-token-text-secondary mx-2 rounded-md px-1.5 py-0.5 text-xs",children:i})},tooltip:s,tooltipValues:a,description:n,Icon:Le,workspaceId:t})}const Ns=W({platformConnectorsGithub:{id:"workspaceSettings.platformConnectorsGithub",defaultMessage:"GitHub <badge>Beta</badge>"}});function Is(t){return!!t&&typeof t=="object"&&"id"in t}function Ds({title:t,description:s,children:a,upsellEnterprise:n=!1,isQuorum:l=!1,descriptionValues:i={}}){return e.jsx(be,{label:e.jsx(d,{...L.enterpriseRequiredMessage}),side:"top",disabled:!n,triggerAs:null,children:e.jsxs(Cs,{className:fe(n&&"text-token-text-tertiary"),children:[e.jsxs(Ss,{className:"flex items-center gap-3",children:[e.jsx(d,{...t}),n&&e.jsx("span",{className:"bg-token-bg-tertiary rounded-xl px-2 pb-0.5 text-sm",children:e.jsx(d,{...L.enterpriseUpsellPill})}),l&&e.jsx("span",{className:"bg-token-bg-tertiary rounded-xl px-2 pb-0.5 text-sm font-normal",children:e.jsx(d,{...L.thisFeatureDisabledForOrg})})]}),s&&e.jsx(js,{className:"text-token-text-secondary py-2",children:Is(s)?e.jsx(d,{...s,values:i}):s}),a]})})}const Ls=({upsellEnterprise:t,isQuorum:s,whamAccess:a,whamLocalAccess:n,codexAgentNetworkAccess:l,workspaceId:i})=>{const c=V(),{enabled:m,isLoading:o}=Oe(he[xe.GITHUB_CONNECTOR]),h=G(c,"3507761600"),b=G(c,"2995560103");return e.jsx(Ds,{title:x({id:"d4cT9L",defaultMessage:"Codex"}),description:x({id:"ffT+eO",defaultMessage:"Manage whether members can use Codex."}),upsellEnterprise:t,isQuorum:s,children:e.jsxs(A,{children:[e.jsx(Rs,{disabled:!0,workspaceId:i,description:L.codexGitHubToggleLinkToConnectorSettings}),e.jsx(y,{disabled:t||s||o||!a&&!m,label:x({id:"qfXuT1",defaultMessage:"Allow members to use Codex"}),tooltip:a&&!m&&!o?L.codexMustEnableGitHub:void 0,feature:u.ALLOW_CODEX_ACCESS,value:a,workspaceId:i}),b&&e.jsx(y,{disabled:t||s||o,label:x({id:"wdPl2u",defaultMessage:"Allow members to use Codex CLI and IDE Extension"}),feature:u.ALLOW_CODEX_LOCAL_ACCESS,value:n,workspaceId:i}),a&&h&&e.jsx(y,{disabled:t||s||o||!a&&!m,label:L.agentInternetAccess,description:L.agentInternetAccessDescription,feature:u.CODEX_AGENT_NETWORK_ACCESS,value:l,workspaceId:i})]})})},L=W({enterpriseUpsellPill:{id:"workspaceSettings.enterpriseUpsellPill",defaultMessage:"Enterprise"},enterpriseRequiredMessage:{id:"workspaceSettings.enterpriseRequiredMessage",defaultMessage:"Only workspaces with the Enterprise plan can change these settings"},thisFeatureDisabledForOrg:{id:"workspaceSettings.thisFeatureDisabledForOrg",defaultMessage:"This feature is disabled in HIPAA compliant workspaces"},codexGitHubToggleLinkToConnectorSettings:{id:"workspaceSettings.codex.githubConnectorSettings",defaultMessage:"Codex requires the GitHub connector.{br}You can enable or disable it in <settingsLink>Connector Settings</settingsLink>",values:{br:e.jsx("br",{}),settingsLink:t=>e.jsx($e,{to:"/admin/ca",className:"underline",children:t})}},codexMustEnableGitHub:{id:"workspaceSettings.codex.mustEnableGitHub",defaultMessage:"You must enable the GitHub connector in connector settings for Codex to work."},agentInternetAccess:{id:"workspaceSettings.agentInternetAccess",defaultMessage:"Allow Codex agent to access the internet"},agentInternetAccessDescription:{id:"workspaceSettings.agentInternetAccessDescription",defaultMessage:"Allows environments to be created with agent internet access enabled"}}),Os=({onClose:t,content:s})=>{const a=E();return e.jsx(ke,{testId:"modal-workspace-policy-preview",isOpen:!0,onClose:t,type:"success",title:a.formatMessage(Gs.title),size:"xlarge",shouldIgnoreClickOutside:!0,showCloseButton:!0,className:"h-[50vh]! min-h-[500px]!",children:e.jsx("div",{className:"flex flex-col gap-6",children:e.jsx(as,{size:"small",className:"px-4 md:px-6",children:s})})})},Gs=W({title:{id:"Jf/LUp",defaultMessage:"Workspace Policy Preview"}});function Ws(t){return Ze({queryKey:["workspace-system-instruction",t],queryFn:t?()=>Z.safeGet("/accounts/{account_id}/system_instruction",{parameters:{path:{account_id:t}}}):Je})}function Fs(t){const s=oe();return ie({mutationFn:a=>Z.safePost("/accounts/{account_id}/system_instruction",{parameters:{path:{account_id:t}},requestBody:{system_instruction:a}}),onSuccess:()=>{s.invalidateQueries({queryKey:["workspace-system-instruction",t]})}})}function Ks(){return q()?.data.ekmConfig!=null}function Hs(){const t=q();return t?.data.computeResidency!==""&&t?.data.computeResidency!=="no_constraint"}const ee=({workspaceId:t})=>{const s=ae(),a=oe(),n=E();return ie({mutationFn:({feature:l,enabled:i})=>Z.safePost("/accounts/{account_id}/beta_features",{parameters:{path:{account_id:t}},requestBody:{feature:l,value:i}}),onSettled:()=>{a.invalidateQueries({queryKey:["workspace-settings"]})},onError:()=>{s.danger(n.formatMessage(_e.featureSettingsUpdateFailed,{toastId:"workspace_settings"}))}})},Vs=({workspaceId:t})=>{const s=ae(),a=oe(),n=E();return ie({mutationFn:({setting:l,value:i})=>Z.safePost("/accounts/{account_id}/settings/share_settings",{parameters:{path:{account_id:t}},requestBody:{setting:l,value:i}}),onSettled:()=>{a.invalidateQueries({queryKey:["workspace-settings"]})},onError:()=>{s.danger(n.formatMessage(_e.featureSettingsUpdateFailed,{toastId:"share_settings_row"}))}})},_e=W({featureSettingsUpdateFailed:{id:"workspaceSettings.featureSettingsUpdateFailed",defaultMessage:"Failed to update feature setting"}});function qs({workspaceId:t}){const{data:s,isLoading:a}=Ce(t),n=V(),l=q(),i=!l?.isEnterprisey(),c=Se(),m=l?.residencyRegion==="no_constraint"&&!c,o=G(n,"417039829"),h=l?.isEnterprisey(),b=G(n,"2509278897");if(a)return e.jsx($,{});if(!s)return null;const g={workspaceId:t,data:s,upsellEnterprise:i,shouldDisableForQuorum:c};return e.jsxs(ye,{children:[e.jsx(Te,{...g}),e.jsx(Us,{...g}),e.jsx(Bs,{...g}),s.beta_settings.canvas&&e.jsx(Ys,{...g}),e.jsx(Qs,{...g,shouldDisableForQuorum:!1}),e.jsx(Xs,{...g}),h&&e.jsx(Ls,{upsellEnterprise:i,isQuorum:c,whamAccess:s.beta_settings.wham_access,whamLocalAccess:s.beta_settings.wham_local_access,codexAgentNetworkAccess:s.beta_settings.codex_agent_network_access,workspaceId:t}),o&&e.jsx($s,{...g}),e.jsx(Zs,{...g}),e.jsx(st,{...g}),b&&m&&e.jsx(tt,{...g}),e.jsx(zs,{...g})]})}const zs=({shouldDisableForQuorum:t,data:s,workspaceId:a})=>e.jsx(_,{title:x({id:"RG4GVO",defaultMessage:"Models"}),description:x({id:"DrP1L6",defaultMessage:"Choose which models this role can access"}),shouldDisableForQuorum:t,children:e.jsx(A,{children:e.jsx(y,{label:x({id:"NiCZh1",defaultMessage:"Enable additional models"}),description:x({id:"oeg/Kq",defaultMessage:"Allow members to use additional models. This is a global setting for the workspace."}),feature:u.LEGACY_MODELS,value:s.beta_settings.legacy_models??!1,workspaceId:a,disabled:t})})}),Te=({workspaceId:t,upsellEnterprise:s,data:a})=>{const n=E(),l=V(),i=ae(),c=Ge(),m=Hs(),o=q(),h=o&&o.features.includes(We),b=o&&o.features.includes(Fe),{data:g}=Ws(t),{data:v}=ns({workspaceId:t}),[P,S]=k.useState(""),[R,Q]=k.useState("");k.useEffect(()=>{g&&h&&S(g.system_instruction)},[g,h]),k.useEffect(()=>{v&&b&&Q(v.workspace_policy)},[v,b]);const z=Fs(t),U=os(t),se=Ks(),{mutate:B}=ee({workspaceId:t});return e.jsxs(e.Fragment,{children:[e.jsx(_,{title:r.workspaceDetails,children:e.jsxs(A,{children:[e.jsxs(f,{children:[e.jsx(d,{id:"SgdcRQ",defaultMessage:"Organization ID"}),e.jsx(C,{value:o?.data.organizationId??"",onCopied:()=>i.success(n.formatMessage({id:"Ctw3o0",defaultMessage:"Copied organization ID"}))})]}),e.jsxs(f,{children:[e.jsx(d,{id:"yFldxx",defaultMessage:"Workspace ID"}),e.jsx(C,{value:t,onCopied:()=>i.success(n.formatMessage({id:"CqDpiM",defaultMessage:"Copied workspace ID"}))})]}),c&&e.jsxs(f,{children:[e.jsx(d,{id:"ql2W8E",defaultMessage:"Data Residency Region"}),e.jsx(C,{value:o?.data.residencyRegion??"",onCopied:()=>i.success(n.formatMessage({id:"gL43UM",defaultMessage:"Copied data residency"}))})]}),m&&e.jsxs(f,{children:[e.jsx(d,{id:"0l7rYd",defaultMessage:"Inference Residency Region"}),e.jsx(C,{value:o?.data.computeResidencyDisplayName??"",onCopied:()=>i.success(n.formatMessage({id:"DbwXiz",defaultMessage:"Copied inference residency"})),tooltip:o?.data.computeResidencyDescription})]}),se&&e.jsxs(e.Fragment,{children:[e.jsxs(f,{children:[e.jsx(d,{...r.ekmSettingsLabel}),e.jsx("p",{className:"text-md inline-flex items-center",children:e.jsx(d,{...r.ekmSettingsEnabled})})]}),o?.data.ekmConfig&&e.jsxs(e.Fragment,{children:[e.jsxs(f,{children:[e.jsx(d,{...r.ekmTypeLabel}),e.jsxs("p",{className:"text-md inline-flex items-center",children:[o?.data.ekmConfig.type==="aws"&&e.jsx(d,{...r.ekmTypeAws}),o?.data.ekmConfig.type==="gcp"&&e.jsx(d,{...r.ekmTypeGcp}),o?.data.ekmConfig.type==="azure"&&e.jsx(d,{...r.ekmTypeAzure}),o?.data.ekmConfig.type==="development"&&e.jsx(d,{...r.ekmTypeDevelopment})]})]}),o?.data.ekmConfig.type==="aws"&&e.jsxs(e.Fragment,{children:[e.jsxs(f,{children:[e.jsx(d,{...r.ekmNameLabel}),e.jsx(C,{value:o?.data.ekmConfig.name??"",onCopied:()=>i.success(n.formatMessage({id:"6LvE2Y",defaultMessage:"Copied EKM name"}))})]}),e.jsxs(f,{children:[e.jsx(d,{...r.ekmAwsRoleArn}),e.jsx(C,{value:o?.data.ekmConfig.role_arn??"",onCopied:()=>i.success(n.formatMessage({id:"4bdi09",defaultMessage:"Copied AWS role ARN"}))})]}),e.jsxs(f,{children:[e.jsx(d,{...r.ekmAwsExternalId}),e.jsx(C,{value:o?.data.ekmConfig.external_id??"",onCopied:()=>i.success(n.formatMessage({id:"vA49q7",defaultMessage:"Copied AWS external ID"}))})]}),e.jsxs(f,{children:[e.jsx(d,{...r.ekmAwsKmsArn}),e.jsx(C,{value:o?.data.ekmConfig.kms_arn??"",onCopied:()=>i.success(n.formatMessage({id:"OrGb/E",defaultMessage:"Copied AWS KMS ARN"}))})]})]}),o?.data.ekmConfig.type==="gcp"&&e.jsxs(e.Fragment,{children:[e.jsxs(f,{children:[e.jsx(d,{...r.ekmNameLabel}),e.jsx(C,{value:o?.data.ekmConfig.name??"",onCopied:()=>i.success(n.formatMessage({id:"6LvE2Y",defaultMessage:"Copied EKM name"}))})]}),e.jsxs(f,{children:[e.jsx(d,{...r.ekmGcpWorkloadIdentityProjectNumber}),e.jsx(C,{value:o?.data.ekmConfig.workload_identity_project_number??"",onCopied:()=>i.success(n.formatMessage({id:"YqzX4K",defaultMessage:"Copied GCP workload identity project number"}))})]}),e.jsxs(f,{children:[e.jsx(d,{...r.ekmGcpWorkloadIdentityPoolId}),e.jsx(C,{value:o?.data.ekmConfig.workload_identity_pool_id??"",onCopied:()=>i.success(n.formatMessage({id:"chEtMi",defaultMessage:"Copied GCP workload identity pool ID"}))})]}),e.jsxs(f,{children:[e.jsx(d,{...r.ekmGcpWorkloadIdentityProviderId}),e.jsx(C,{value:o?.data.ekmConfig.workload_identity_provider_id??"",onCopied:()=>i.success(n.formatMessage({id:"/T7kiu",defaultMessage:"Copied GCP workload identity provider ID"}))})]}),e.jsxs(f,{children:[e.jsx(d,{...r.ekmGcpAudience}),e.jsx(C,{value:o?.data.ekmConfig.audience??"",onCopied:()=>i.success(n.formatMessage({id:"/uFjyv",defaultMessage:"Copied GCP audience"}))})]}),e.jsxs(f,{children:[e.jsx(d,{...r.ekmGcpKmsProjectId}),e.jsx(C,{value:o?.data.ekmConfig.kms_project_id??"",onCopied:()=>i.success(n.formatMessage({id:"gjI8eK",defaultMessage:"Copied GCP KMS project ID"}))})]}),e.jsxs(f,{children:[e.jsx(d,{...r.ekmGcpKmsKeyRingName}),e.jsx(C,{value:o?.data.ekmConfig.kms_key_ring_name??"",onCopied:()=>i.success(n.formatMessage({id:"3dwsVC",defaultMessage:"Copied GCP KMS key ring"}))})]}),e.jsxs(f,{children:[e.jsx(d,{...r.ekmGcpKmsKeyName}),e.jsx(C,{value:o?.data.ekmConfig.kms_key_name??"",onCopied:()=>i.success(n.formatMessage({id:"gHjKrz",defaultMessage:"Copied GCP KMS key name"}))})]}),e.jsxs(f,{children:[e.jsx(d,{...r.ekmGcpKmsKeyLocation}),e.jsx(C,{value:o?.data.ekmConfig.kms_key_location??"",onCopied:()=>i.success(n.formatMessage({id:"0GOofF",defaultMessage:"Copied GCP KMS key location"}))})]})]}),o?.data.ekmConfig.type==="azure"&&e.jsxs(e.Fragment,{children:[e.jsxs(f,{children:[e.jsx(d,{...r.ekmNameLabel}),e.jsx(C,{value:o?.data.ekmConfig.name??"",onCopied:()=>i.success(n.formatMessage({id:"6LvE2Y",defaultMessage:"Copied EKM name"}))})]}),e.jsxs(f,{children:[e.jsx(d,{...r.ekmAzureTenantId}),e.jsx(C,{value:o?.data.ekmConfig.tenant_id??"",onCopied:()=>i.success(n.formatMessage({id:"vH6cbU",defaultMessage:"Copied Azure tenant ID"}))})]}),e.jsxs(f,{children:[e.jsx(d,{...r.ekmAzureVaultUri}),e.jsx(C,{value:o?.data.ekmConfig.vault_uri??"",onCopied:()=>i.success(n.formatMessage({id:"riTMZV",defaultMessage:"Copied Azure Key Vault URI"}))})]}),e.jsxs(f,{children:[e.jsx(d,{...r.ekmAzureKeyName}),e.jsx(C,{value:o?.data.ekmConfig.key_name??"",onCopied:()=>i.success(n.formatMessage({id:"+LPUTz",defaultMessage:"Copied Azure key name"}))})]})]}),o?.data.ekmConfig.type==="development"&&e.jsxs(f,{children:[e.jsx(d,{...r.ekmNameLabel}),e.jsx(C,{value:o?.data.ekmConfig.name??"",onCopied:()=>i.success(n.formatMessage({id:"6LvE2Y",defaultMessage:"Copied EKM name"}))})]})]})]})]})}),b&&e.jsxs(_,{title:r.workspacePolicySection,upsellEnterprise:s,description:r.workspacePolicySectionDescription,children:[e.jsxs(f,{className:"justify-start py-6",children:[e.jsx(J,{label:"",enabled:a.beta_settings.workspace_policy,onChange:N=>{B({feature:u.WORKSPACE_POLICY,enabled:N})}}),e.jsx("p",{className:"text-md inline-flex items-center",children:e.jsx(d,{...r.workspacePolicyToggleLabel})})]}),a.beta_settings.workspace_policy&&e.jsxs(f,{className:"flex-col gap-2",children:[e.jsx(is,{className:"border-token-border-default focus-within:border-token-border-heavy focus-within:ring-token-text-secondary bg-token-bg-primary w-full resize-y rounded-md border px-3 py-2 font-mono text-xs shadow-none focus-within:ring-1",value:R,placeholder:n.formatMessage(r.workspacePolicyTextareaPlaceholder),onChange:N=>Q(N.target.value),rows:5}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(O,{size:"small",color:"secondary",onClick:()=>Ke(l,Os,{content:R}),disabled:!R,children:e.jsx(d,{...r.workspacePolicyPreview})}),e.jsx(O,{size:"small",onClick:()=>U.mutate(R),disabled:U.isPending||R===v?.workspace_policy,children:e.jsx(d,{...r.workspacePolicySave})})]})]})]}),h&&e.jsx(_,{title:r.workspaceInstructionSection,upsellEnterprise:s,description:r.systemInstructionDescription,children:e.jsxs(f,{className:"flex-col gap-2",children:[e.jsx(bs,{className:"border-token-border-default focus-within:border-token-border-heavy focus-within:ring-token-text-secondary bg-token-bg-primary w-full resize-y rounded-md border px-3 py-2 font-mono text-xs shadow-none focus-within:ring-1",value:P,placeholder:"How should ChatGPT behave? What traits should it have? What should it know about your company?",onChange:N=>S(N.target.value),rows:5}),e.jsx("div",{className:"flex justify-end",children:e.jsx(O,{size:"small",onClick:()=>z.mutate(P),disabled:z.isPending||P===g?.system_instruction,children:e.jsx(d,{...r.workspaceInstructionSave})})})]})})]})},Us=({workspaceId:t,data:s,upsellEnterprise:a,shouldDisableForQuorum:n})=>{const l=V(),i=G(l,"773249106"),c=a||n;return e.jsx(_,{title:r.sharingSettingsTitle,upsellEnterprise:a,shouldDisableForQuorum:n,children:e.jsx(A,{children:e.jsxs(f,{children:[e.jsx("p",{className:"text-md inline-flex items-center",children:e.jsx(d,{...i?r.chatCanvasProjectSharingTitle:r.chatCanvasSharingTitle})}),e.jsx(ve,{workspaceId:t,disabled:c,defaultValue:s.share_settings.chat_share_setting})]})})})},Bs=({workspaceId:t,shouldDisableForQuorum:s,upsellEnterprise:a,data:n})=>{const[l,i]=k.useState(!1),{variables:c,mutate:m}=ee({workspaceId:t}),o=a||s;return e.jsxs(e.Fragment,{children:[l&&e.jsx(Pe,{onConfirm:()=>{m({feature:u.MEMORY,enabled:!1}),i(!1)},onClose:()=>{i(!1)}}),e.jsx(_,{title:r.memoryFeatureSettingsTitle,description:r.workspaceMemoryDescription,descriptionValues:{link:h=>e.jsx("a",{href:"https://help.openai.com/en/articles/8590148-memory-in-chatgpt-faq",target:"_blank",className:"underline",rel:"noreferrer",children:h})},upsellEnterprise:a,shouldDisableForQuorum:s,children:e.jsx(A,{children:e.jsxs(f,{className:"justify-start py-6",children:[e.jsx(J,{label:"",disabled:o,enabled:c?.enabled??n.beta_settings.sunshine,onChange:h=>{h?m({feature:u.MEMORY,enabled:h}):i(!0)}}),e.jsx("p",{className:"text-md inline-flex items-center",children:e.jsx(d,{...r.memoryOptionTitle})})]})})})]})},Ys=({upsellEnterprise:t,data:s,workspaceId:a})=>e.jsx(_,{title:x({id:"SyabKs",defaultMessage:"Canvas"}),description:x({id:"pPFCur",defaultMessage:"Control how users in this workspace can use the ChatGPT canvas feature."}),upsellEnterprise:t,shouldDisableForQuorum:!1,children:e.jsxs(A,{children:[e.jsx(y,{disabled:t,label:x({id:"wlG5ZH",defaultMessage:"Canvas code execution"}),feature:u.CANVAS_CODE_EXECUTION,tooltip:x({id:"qMiLv3",defaultMessage:"Support for running canvas code within the browser."}),value:s.beta_settings.canvas_code_execution,workspaceId:a}),e.jsx(y,{disabled:t,label:x({id:"XwHFHi",defaultMessage:"Allow canvas code to access the network"}),feature:u.CANVAS_CODE_NETWORK_ACCESS,tooltip:x({id:"ujHQEU",defaultMessage:"Learn more about network requests in canvas"}),onClickInfo:()=>window.open("https://help.openai.com/en/articles/9930697-what-is-the-canvas-feature-in-chatgpt-and-how-do-i-use-it#h_cd52fdbc16"),value:s.beta_settings.canvas_code_network_access,workspaceId:a})]})}),Qs=({upsellEnterprise:t,shouldDisableForQuorum:s,data:a,workspaceId:n})=>{const l=t,i=He(),c=i?.includes(de.SearchTool)&&!i.includes(de.SearchToolHoldout),m=V(),o=G(m,"3940160259");let h=r.deepResearchTooltipDisabled;return s?h=r.deepResearchTooltipDisabledQuorum:a.beta_settings.browsing&&(h=r.deepResearchTooltip),e.jsx(_,{title:r.searchTitle,description:r.searchDescription,descriptionValues:{link:b=>e.jsx("a",{href:"https://help.openai.com/en/articles/10093903-chatgpt-search-for-enterprise-and-edu",target:"_blank",className:"underline",rel:"noreferrer",children:b})},upsellEnterprise:t,shouldDisableForQuorum:!1,children:e.jsxs(A,{children:[e.jsx(y,{label:c?r.searchOptionTitle:r.browseOptionTitle,feature:u.BROWSING,value:a.beta_settings.browsing,workspaceId:n,tooltip:c?r.searchTooltip:r.browseTooltip,disabled:l}),o===!0&&e.jsx(y,{label:r.deepResearchTitle,feature:u.DEEP_RESEARCH,messageAfterTooltip:h,value:a.beta_settings.deep_research,workspaceId:n,tooltip:h,disabled:t||!a.beta_settings.browsing||s,onClickInfo:()=>window.open("https://help.openai.com/en/articles/10500283-deep-research-faq")})]})})},Xs=({upsellEnterprise:t,data:s,workspaceId:a})=>{const n=t;return e.jsx(_,{title:x({id:"/1YXN0",defaultMessage:"Voice"}),description:x({id:"3jvok6",defaultMessage:"Manage whether members can share their screen or video while having a voice conversation. <link>Learn more</link>"}),descriptionValues:{link:l=>e.jsx("a",{href:"https://help.openai.com/en/articles/8400625-voice-mode-faq",target:"_blank",className:"underline",rel:"noreferrer",children:l})},upsellEnterprise:t,shouldDisableForQuorum:!1,children:e.jsx(A,{children:e.jsx(y,{disabled:n,label:x({id:"9usJzG",defaultMessage:"Allow members to share their screen or video while using voice mode"}),feature:u.VIDEO_SCREEN_SHARING,value:s.beta_settings.video_screen_sharing,workspaceId:a})})})},$s=({shouldDisableForQuorum:t,data:s,workspaceId:a})=>{const n=Ve();return e.jsx(_,{title:x({id:"aVKeFK",defaultMessage:"Record"}),description:x({id:"l0y0CK",defaultMessage:"Manage whether users can use ChatGPT to record, transcribe, and summarize longform audio. Recordings will be used solely for transcription purposes and will not be stored by OpenAI. <link>Learn more</link>"}),descriptionValues:{link:l=>e.jsx("a",{href:"https://help.openai.com/en/articles/11487532",target:"_blank",className:"underline",rel:"noreferrer",children:l})},shouldDisableForQuorum:t,children:e.jsxs(A,{children:[e.jsx(y,{label:x({id:"03rxwg",defaultMessage:"Allow members to use ChatGPT Record"}),feature:u.HIVE,value:s.beta_settings.hive,workspaceId:a,disabled:t}),e.jsx(y,{label:x({id:"ooMyTF",defaultMessage:"Allow ChatGPT to reference past notes and transcripts"}),tooltip:n?x({id:"CuaZot",defaultMessage:"ChatGPT can reference a user's own past notes and transcripts from record, to help provide more context across chats."}):r.unsupportedDrTooltip,feature:u.HIVE_KNOWLEDGE_RETRIEVAL,value:s.beta_settings.hive_knowledge_retrieval,workspaceId:a,disabled:t||!n})]})})},Zs=({upsellEnterprise:t,shouldDisableForQuorum:s,data:a,workspaceId:n})=>{const l=t||s;return e.jsx(_,{title:x({id:"wgrfi/",defaultMessage:"Work with Apps"}),description:r.workspaceAppPairingDescription,descriptionValues:{link:i=>e.jsx("a",{href:"https://help.openai.com/en/articles/10119604",target:"_blank",className:"underline",rel:"noreferrer",children:i})},upsellEnterprise:t,shouldDisableForQuorum:s,children:e.jsx(A,{children:e.jsx(y,{disabled:l,label:x({id:"j8pJeQ",defaultMessage:"Work with Apps"}),feature:u.APP_PAIRING,value:a.beta_settings.app_pairing,workspaceId:n})})})},le=60*60*24,Js=le*90,et=le*365,st=({upsellEnterprise:t,data:s})=>e.jsx(_,{title:r.retentionPolicyTitle,description:r.retentionChange,upsellEnterprise:t,children:e.jsxs(f,{children:[e.jsx("p",{className:"inline-flex items-center text-base",children:e.jsx(d,{...r.conversationRetention})}),e.jsx(Ae,{data:s})]})}),Ae=({data:t})=>{const s=E(),a=t.conversation_ttl??null;let n;return a==null?n=s.formatMessage(r.retentionInfinite):a===Js?n=s.formatMessage(r.retentionNinetyDays):a===et?n=s.formatMessage(r.retentionOneYear):n=s.formatMessage(r.retentionCustomDays,{num:Math.floor(a/le)}),e.jsx(be,{label:s.formatMessage(r.retentionSettingTooltip),children:n})},tt=({upsellEnterprise:t,shouldDisableForQuorum:s,data:a,workspaceId:n})=>{const l=E(),i=q(),c=V(),m=G(c,"614413305")&&i?.residencyRegion==="no_constraint";return e.jsx(_,{title:r.appleIntelligenceTitle,upsellEnterprise:t,shouldDisableForQuorum:s,description:l.formatMessage(r.appleIntelligenceDescription),children:e.jsxs(f,{className:"flex-col",children:[e.jsx(y,{hasPadding:!1,disabled:!1,label:x({id:"mcLjLe",defaultMessage:"Beta: Apple Intelligence"}),Icon:xs,feature:u.CLIENT_APPLICATION_APPLE,value:a.beta_settings.client_application_apple,workspaceId:n,tooltip:x({id:"mp2Kmk",defaultMessage:"Beta: Enable linking with Apple Intelligence"})}),m&&e.jsx(y,{className:"ms-6",hasPadding:!1,disabled:!a.beta_settings.client_application_apple,label:x({id:"64jjqZ",defaultMessage:"Enable on managed devices only"}),feature:u.CLIENT_APPLICATION_APPLE_MDM_REQUIRED,value:a.beta_settings.client_application_apple_mdm_required,workspaceId:n,tooltip:x({id:"7Afc2K",defaultMessage:"Only allow linking this workspace with Apple Intelligence on MDM managed devices"})})]})})};function ve({workspaceId:t,defaultValue:s,disabled:a=!1}){const{variables:n,mutate:l}=Vs({workspaceId:t}),i=[{display:r.workspaceMembersOnlySelect,value:ue.WORKSPACE_ONLY},{display:r.noOneSelect,value:ue.NO_ONE}],c=qe.CHAT_SHARE_SETTINGS;return e.jsxs(D.Root,{defaultValue:n?.value??s,onValueChange:m=>{l({setting:c,value:m})},disabled:a,children:[e.jsxs(D.Trigger,{className:"text-md focus-visible:border-none",children:[e.jsx(D.Value,{}),e.jsx(D.Icon,{})]}),e.jsx(D.Portal,{children:e.jsx(D.Content,{children:i.map((m,o)=>e.jsx(D.Item,{className:"text-md",value:m.value,children:e.jsx(d,{...m.display})},o))})})]})}function Pe({onConfirm:t,onClose:s}){const a=E();return e.jsx(ke,{testId:"modal-disable-workspace-memory",type:"warning",isOpen:!0,onClose:s,title:a.formatMessage(r.deleteWorkspaceMemoryModalTitle),showCloseButton:!0,primaryButton:e.jsx(O,{color:"danger",onClick:t,children:e.jsx(d,{...r.deleteWorkspaceMemoryModalConfirm})}),secondaryButton:e.jsx(O,{onClick:s,color:"secondary",children:e.jsx(d,{...r.deleteWorkspaceMemoryModalCancel})}),children:e.jsx("div",{className:"text-token-text-primary mb-2 text-sm",children:e.jsx(d,{...r.deleteWorkspaceMemoryModalInfo,values:{b:n=>e.jsx("b",{children:n})}})})})}const r=W({appleIntelligenceTitle:{id:"workspaceSettings.appleIntelligenceTitle",defaultMessage:"Apple Intelligence"},appleIntelligenceDescription:{id:"workspaceSettings.appleIntelligenceDescription",defaultMessage:"Manage whether members can link with Apple Intelligence."},retentionPolicyTitle:{id:"workspaceSettings.retentionPolicyTitle",defaultMessage:"Retention policy"},sharingSettingsTitle:{id:"workspaceSettings.sharingSettingsTitle",defaultMessage:"Sharing"},memoryFeatureSettingsTitle:{id:"workspaceSettings.memoryFeatureSettingsTitle",defaultMessage:"Memory"},memoryOptionTitle:{id:"workspaceSettings.memoryOptionTitle",defaultMessage:"Allow members to use memory"},deepResearchTitle:{id:"workspaceSettings.deepResearchTitle",defaultMessage:"Deep Research"},workspaceMemoryDescription:{id:"workspaceSettings.workspaceMemoryDescription",defaultMessage:"Manage whether members can enable memory. This allows ChatGPT to become more helpful by remembering details and preferences across chats. <link>Learn more</link>"},workspaceAppPairingDescription:{id:"workspaceSettings.workspaceAppPairingDescription",defaultMessage:"Control whether users in this workspace can enable ChatGPT to work with apps. This allows ChatGPT to read and edit the content of specific apps on their desktop to provide better responses. <link>Learn more</link>"},deleteWorkspaceMemoryModalTitle:{id:"workspaceSettings.deleteWorkspaceMemoryModalTitle",defaultMessage:"Are you sure?"},deleteWorkspaceMemoryModalConfirm:{id:"workspaceSettings.deleteWorkspaceMemoryModalConfirm",defaultMessage:"Disable and delete memories"},deleteWorkspaceMemoryModalCancel:{id:"workspaceSettings.deleteWorkspaceMemoryModalCancel",defaultMessage:"Cancel"},deleteWorkspaceMemoryModalInfo:{id:"workspaceSettings.groups.deleteWorkspaceMemoryModalInfo",defaultMessage:"If you disable memory for your workspace, <b>members' existing memories will be forgotten</b>. This can't be undone."},chatCanvasSharingTitle:{id:"workspaceSettings.chatCanvasSharingTitle",defaultMessage:"Allow members to share a chat or canvas with..."},chatCanvasProjectSharingTitle:{id:"workspaceSettings.chatCanvasProjectSharingTitle",defaultMessage:"Allow members to share a chat, canvas, or project with..."},workspaceDetails:{id:"workspaceSettings.workspaceDetails",defaultMessage:"Workspace details"},ekmSettingsLabel:{id:"workspaceSettings.ekmSettingsLabel",defaultMessage:"Enterprise key management"},ekmSettingsEnabled:{id:"workspaceSettings.ekmSettingsEnabled",defaultMessage:"Enabled"},ekmTypeLabel:{id:"workspaceSettings.ekmTypeLabel",defaultMessage:"EKM type"},ekmTypeAws:{id:"workspaceSettings.ekmTypeAws",defaultMessage:"AWS"},ekmTypeGcp:{id:"workspaceSettings.ekmTypeGcp",defaultMessage:"GCP"},ekmTypeAzure:{id:"workspaceSettings.ekmTypeAzure",defaultMessage:"Azure"},ekmTypeDevelopment:{id:"workspaceSettings.ekmTypeDevelopment",defaultMessage:"Development"},ekmNameLabel:{id:"workspaceSettings.ekmNameLabel",defaultMessage:"Name"},ekmAwsRoleArn:{id:"workspaceSettings.ekmAwsRoleArn",defaultMessage:"AWS role ARN"},ekmAwsExternalId:{id:"workspaceSettings.ekmAwsExternalId",defaultMessage:"AWS external ID"},ekmAwsKmsArn:{id:"workspaceSettings.ekmAwsKmsArn",defaultMessage:"AWS KMS ARN"},ekmGcpWorkloadIdentityProjectNumber:{id:"workspaceSettings.ekmGcpWorkloadIdentityProjectNumber",defaultMessage:"GCP workload identity project number"},ekmGcpWorkloadIdentityPoolId:{id:"workspaceSettings.ekmGcpWorkloadIdentityPoolId",defaultMessage:"GCP workload identity pool ID"},ekmGcpWorkloadIdentityProviderId:{id:"workspaceSettings.ekmGcpWorkloadIdentityProviderId",defaultMessage:"GCP workload identity provider ID"},ekmGcpAudience:{id:"workspaceSettings.ekmGcpAudience",defaultMessage:"GCP audience"},ekmGcpKmsProjectId:{id:"workspaceSettings.ekmGcpKmsProjectId",defaultMessage:"GCP KMS project ID"},ekmGcpKmsKeyRingName:{id:"workspaceSettings.ekmGcpKmsKeyRingName",defaultMessage:"GCP KMS key ring"},ekmGcpKmsKeyName:{id:"workspaceSettings.ekmGcpKmsKeyName",defaultMessage:"GCP KMS key name"},ekmGcpKmsKeyLocation:{id:"workspaceSettings.ekmGcpKmsKeyLocation",defaultMessage:"GCP KMS key location"},ekmAzureTenantId:{id:"workspaceSettings.ekmAzureTenantId",defaultMessage:"Azure tenant ID"},ekmAzureVaultUri:{id:"workspaceSettings.ekmAzureVaultUri",defaultMessage:"Azure Key Vault URI"},ekmAzureKeyName:{id:"workspaceSettings.ekmAzureKeyName",defaultMessage:"Azure key name"},workspaceMembersOnlySelect:{id:"workspaceSettings.workspaceMembersOnlySelect",defaultMessage:"Workspace members only"},noOneSelect:{id:"workspaceSettings.noOneSelect",defaultMessage:"No one"},conversationRetention:{id:"workspaceSettings.conversationRetention",defaultMessage:"Chat retention"},retentionInfinite:{id:"workspaceSettings.retentionInfinite",defaultMessage:"Infinite"},retentionNinetyDays:{id:"workspaceSettings.retentionNinetyDays",defaultMessage:"90 days"},retentionOneYear:{id:"workspaceSettings.retentionOneYear",defaultMessage:"1 year"},retentionCustomDays:{id:"workspaceSettings.retentionCustomDays",defaultMessage:"{num} days"},retentionChange:{id:"workspaceSettings.retentionChange",defaultMessage:"Contact your account manager to change this setting."},retentionSettingTooltip:{id:"workspaceSettings.retentionSettingTooltip",defaultMessage:"Contact your account manager to change this setting"},connectionsTitle:{id:"workspaceSettings.connectionsTitle",defaultMessage:"Connectors"},contextConnectorsSubtitle:{id:"workspaceSettings.contextConnectorsSubtitle",defaultMessage:"Manage which apps users in this workspace can connect to directly from ChatGPT. For more information, refer to the {helpCenterLink}."},contextConnectorsHelpCenterLink:{id:"workspaceSettings.contextConnectorsHelpCenterLink",defaultMessage:"Help Center"},contextConnectorsGoogleDrive:{id:"workspaceSettings.contextConnectorsGoogleDrive",defaultMessage:"Google Drive"},contextConnectorsO365PersonalTooltip:{id:"workspaceSettings.contextConnectorsO365PersonalTooltip",defaultMessage:"This includes personal OneDrive accounts but not OneDrive for Business or SharePoint accounts."},contextConnectorsO365BusinessTooltip:{id:"workspaceSettings.contextConnectorsO365BusinessTooltip",defaultMessage:"This includes OneDrive for Business and SharePoint accounts but not personal accounts."},platformConnectorsGithubTooltip:{id:"workspaceSettings.platformConnectorsGithubTooltip",defaultMessage:"Controls access to GitHub across ChatGPT"},searchTitle:{id:"workspaceSettings.searchTitle",defaultMessage:"Web Search"},searchDescription:{id:"workspaceSettings.workspaceGPTsDescription",defaultMessage:"Manage whether ChatGPT and GPTs created in this workspace can browse the internet. When enabled, it may send search queries and general location information to Bing, but this data is not linked to or associated with user accounts. This does not apply to third-party GPTs. <link>Learn more</link>"},webSearchDescriptionOfflineOnly:{id:"d1wF1k",defaultMessage:"ChatGPT web search may send queries to third-party search providers based on your inputs to ChatGPT. You should ensure your use of ChatGPT search complies with your compliance obligations."},deepResearchDescription:{id:"workspaceSettings.workspaceDeepResearchDescription",defaultMessage:"Deep Research utilizes web search & reasoning to respond to research queries. <link>Learn more</link>"},searchTooltip:{id:"workspaceSettings.searchTooltip",defaultMessage:"Web search allows ChatGPT and GPTs to answer questions on recent topics."},searchOptionTitle:{id:"workspaceSettings.searchOptionTitle",defaultMessage:"Web Search"},browseOptionTitle:{id:"workspaceSettings.browseOptionTitle",defaultMessage:"Browsing with Bing"},browseTooltip:{id:"workspaceSettings.browseTooltip",defaultMessage:"Allow ChatGPT and GPTs to browse the internet to answer questions about recent topics and events."},deepResearchTooltip:{id:"workspaceSettings.deepResearchTooltip",defaultMessage:"Deep research uses web search and reasoning to handle complex research requests."},deepResearchTooltipDisabled:{id:"workspaceSettings.deepResearchTooltipDisabled",defaultMessage:"Deep research uses web search and reasoning to handle complex research requests. Turn web search on to allow deep research."},deepResearchTooltipDisabledQuorum:{id:"workspaceSettings.deepResearchTooltipDisabledQuorum",defaultMessage:"This feature is disabled in HIPAA compliant workspaces"},deepResearchTooltipDisabledWarning:{id:"workspaceSettings.deepResearchTooltipDisabledWarning",defaultMessage:"Requires web search"},unsupportedDrTooltip:{id:"workspaceSettings.unsupportedDrTooltip",defaultMessage:"This feature is currently not available in your data residency region."},workspacePolicySection:{id:"workspaceSettings.workspacePolicySection",defaultMessage:"Workspace Policy"},workspacePolicySectionDescription:{id:"workspaceSettings.workspacePolicySectionDescription",defaultMessage:"Add anything that would show up to users before they start chatting. Markdown is supported."},workspacePolicySave:{id:"workspaceSettings.workspacePolicySave",defaultMessage:"Save"},workspacePolicyPreview:{id:"workspaceSettings.workspacePolicyPreview",defaultMessage:"Preview"},workspacePolicyToggleLabel:{id:"workspaceSettings.workspacePolicyToggleLabel",defaultMessage:"Show policy to users in this workspace"},workspacePolicyTextareaPlaceholder:{id:"workspaceSettings.workspacePolicyTextareaPlaceholder",defaultMessage:"Enter workspace policy"},workspaceInstructionSection:{id:"workspaceSettings.workspaceInstructionSection",defaultMessage:"Workspace Instructions"},workspaceInstructionSave:{id:"workspaceSettings.workspaceInstructionSave",defaultMessage:"Save"},systemInstructionDescription:{id:"workspaceSettings.workspaceInstruction",defaultMessage:"Add anything you'd like ChatGPT to consider in its response. These instructions will be added to every new conversation for users in your workspace going forward"},lockedSettingTooltip:{id:"workspaceSettings.lockedSettingTooltip",defaultMessage:"This setting is locked for your workspace"}}),at=({workspaceId:t})=>{const{data:s,isLoading:a}=re({workspaceId:t}),[n,l]=k.useState("");k.useEffect(()=>{const b=()=>{const g=s?.data.find(v=>je(v));g&&l(g.id)};s?.data&&b()},[s]);const{data:i,refetch:c,isLoading:m}=we({workspaceId:t,roleId:n??""}),{updateRole:o}=Me({workspaceId:t}),h=k.useCallback(async b=>{const g=await o(b);g.id!==n&&l(g.id),c()},[n,c,o]);return{defaultRole:i,handleSaveRole:h,isLoading:a||m}};function nt({workspaceId:t}){const s=E(),{data:a,isLoading:n}=Ce(t),l=q(),i=!l?.isEnterprisey(),c=Se(),m=ds(),{defaultRole:o,handleSaveRole:h,isLoading:b}=at({workspaceId:t}),[g,v]=k.useState(""),P=pe(),{filteredSections:S,totalPermissionsCount:R}=k.useMemo(()=>{const j=ze({isCanvasEnabled:a?.beta_settings.canvas??!1,isSearchEnabled:o?.permissions.includes(Y.SearchAccess)??!1,isEnterprisey:l?.isEnterprisey()??!1,isQuorum:c,legacyModelsEnabled:a?.beta_settings.legacy_models??!1,...m,includeConnectorPermissions:P,isCodexEnabledInRBACRole:o?.permissions.includes(Y.AllowCodexAccess)??!1}),I=j.flatMap(p=>p.entries).length,F=j.map(p=>({...p,entries:p.entries.filter(w=>{const K=typeof w.title=="string"?w.title:s.formatMessage(w.title),X=w.description?typeof w.description=="string"?w.description:s.formatMessage(w.description,w.descriptionValues):"";return[K,X].join(" ").toLowerCase().includes(g.toLowerCase())||w.rbac&&w.permissionName.toLowerCase().includes(g.toLowerCase())||!w.rbac&&w.settingName.toLowerCase().includes(g.toLowerCase())})})).filter(p=>p.entries.length>0);return{permissionsBySection:j,totalPermissionsCount:I,filteredSections:F}},[l,a?.beta_settings.canvas,o?.permissions,m,s,g,c,a?.beta_settings.legacy_models,P]),{toggleAllConnectorsPermissionForRole:Q,isPending:z}=ms({workspaceId:l?.getWorkspaceId()??""}),{connectorsWithPermission:U,isLoading:se}=fs({accountId:l?.id??"",workspaceId:l?.getWorkspaceId()??"",roleId:o?.id??"",enabled:P&&!!o?.id}),B=Array.from(U.values()??[]).filter(j=>j.connector.status!=="DISABLED_BY_ADMIN"),N=k.useMemo(()=>[u.CONTEXT_CONNECTOR_GDRIVE,u.CONTEXT_CONNECTOR_O365_PERSONAL,u.CONTEXT_CONNECTOR_O365_BUSINESS].filter(j=>!!a?.beta_settings[j]),[a?.beta_settings]),te=hs({workspaceId:l?.getWorkspaceId()??"",roleId:o?.id??"",connectorIds:N,enabled:P&&!!o?.id}),Ee=k.useMemo(()=>{const I=Array.from(B.values()??[]).filter(p=>p.permissions.includes(Y.UseConnector)),F=Object.entries(te.results??{}).filter(([p,w])=>w.includes(Y.UseConnector));return[...I,...F]},[B,te.results]),[Re,ce]=k.useState(!1);return n||b?e.jsx(Ue,{}):!a||!o?null:e.jsxs(ye,{children:[e.jsx("div",{className:"text-token-text-secondary text-sm",children:s.formatMessage(ge.defaultSettingDescription)}),e.jsx("div",{className:"flex flex-row items-center justify-between",children:e.jsx(me,{inputClassName:"w-[250px] rounded-full! text-sm",value:g,onChange:j=>{v(j.target.value)},placeholder:s.formatMessage({id:"hRuTvi",defaultMessage:"Search {count} permissions"},{count:R})})}),e.jsxs("div",{className:"flex flex-col gap-12",children:[e.jsx(Te,{workspaceId:t,upsellEnterprise:i,data:a}),S.map(j=>{const I=i&&!j.availableForEnterprise,F=c&&!j.availableForQuorum;return e.jsx(_,{title:j.title,description:j.description,descriptionValues:j.descriptionValues,upsellEnterprise:I,shouldDisableForQuorum:F,children:e.jsx(A,{children:j.entries.map(p=>{const w=p.rbac?p.permissionName:p.settingName,K=typeof p.title=="string"?p.title:s.formatMessage(p.title),X=c&&p.rbac&&p.disabledForQuorum;if(p.rbac&&p.permissionName===Y.UseConnector){const Ne=Ee.length>0;return e.jsxs(e.Fragment,{children:[Re&&e.jsx(us,{platformConnectorsWithPermission:U,contextConnectorsWithPermission:te.results,workspaceId:l?.getWorkspaceId()??"",roleId:o?.id??"",onClose:()=>ce(!1)}),e.jsx(f,{children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-md",children:K}),p.description&&e.jsx("span",{className:"text-token-text-tertiary text-sm",children:typeof p.description=="string"?p.description:s.formatMessage(p.description,p.descriptionValues)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[(se||z)&&e.jsx($,{}),p.nestedKey&&(N.length>0||B.length>0)&&e.jsx("div",{className:"text-token-text-tertiary text-sm",children:e.jsx(O,{color:"primary-inverse",onClick:()=>ce(!0),children:e.jsx(d,{id:"workspaceSettings.roles.selectNestedPermission",defaultMessage:"Select..."})})}),e.jsx(Be,{size:"normal","aria-label":K,checked:Ne,onCheckedChange:Ie=>Q({id:o?.id??"",state:Ie}),disabled:z})]})]})},w)]})}return e.jsx(f,{children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-md flex gap-2",children:[K,X&&e.jsx("span",{className:"bg-token-bg-tertiary text-token-text-secondary rounded-xl px-3 ps-3 pt-1 pb-1 text-sm font-normal",children:e.jsx(d,{...ge.thisFeatureDisabledForOrg})})]}),p.description&&e.jsx("span",{className:"text-token-text-tertiary text-xs",children:typeof p.description=="string"?p.description:s.formatMessage(p.description,p.descriptionValues)})]}),p.rbac?e.jsx(gs,{ariaLabel:K,role:o,permissionName:p.permissionName,handleSaveRole:h,disabled:p.disabled||I||F||X,disabledReason:p.disabledReason}):e.jsx(ot,{entry:p,workspaceId:t,data:a,upsellEnterprise:I,isQuorum:c})]})},w)})})},String(j.title.defaultMessage))})]})]})}const ot=({entry:t,workspaceId:s,data:a,upsellEnterprise:n,isQuorum:l})=>k.useMemo(()=>{const c=n;switch(t.settingName){case"share_chat":return e.jsx(ve,{workspaceId:s,disabled:c||l,defaultValue:a.share_settings.chat_share_setting});case"rentention_policy":return e.jsx(Ae,{data:a});case"memory_access":return e.jsx(it,{data:a,workspaceId:s,disabled:c});case"apps_access":return e.jsx(M,{workspaceId:s,enabled:a.beta_settings[u.APP_PAIRING],feature:u.APP_PAIRING,disabled:c});case"apple_intelligence_access":return e.jsx(M,{workspaceId:s,enabled:a.beta_settings[u.CLIENT_APPLICATION_APPLE],feature:u.CLIENT_APPLICATION_APPLE,disabled:c});case"apple_intelligence_mdm_access":return e.jsx(M,{workspaceId:s,enabled:a.beta_settings[u.CLIENT_APPLICATION_APPLE_MDM_REQUIRED],feature:u.CLIENT_APPLICATION_APPLE_MDM_REQUIRED,disabled:c});case"canvas_code_execution":return e.jsx(M,{workspaceId:s,enabled:a.beta_settings[u.CANVAS_CODE_EXECUTION],feature:u.CANVAS_CODE_EXECUTION,disabled:c});case"canvas_code_network_access":return e.jsx(M,{workspaceId:s,enabled:a.beta_settings[u.CANVAS_CODE_NETWORK_ACCESS],feature:u.CANVAS_CODE_NETWORK_ACCESS,disabled:c});case"web_search":return e.jsx(M,{workspaceId:s,enabled:a.beta_settings[u.BROWSING],feature:u.BROWSING,disabled:c});case"deep_research":return e.jsx(M,{workspaceId:s,enabled:a.beta_settings[u.DEEP_RESEARCH],feature:u.DEEP_RESEARCH,disabled:c});case"video_screen_sharing":return e.jsx(M,{workspaceId:s,enabled:a.beta_settings[u.VIDEO_SCREEN_SHARING],feature:u.VIDEO_SCREEN_SHARING,disabled:c});case"codex_access":return e.jsx(M,{workspaceId:s,enabled:a.beta_settings[u.ALLOW_CODEX_ACCESS],feature:u.ALLOW_CODEX_ACCESS,disabled:c});case"codex_local_access":return e.jsx(M,{workspaceId:s,enabled:a.beta_settings[u.ALLOW_CODEX_LOCAL_ACCESS],feature:u.ALLOW_CODEX_LOCAL_ACCESS,disabled:c});case"codex_agent_network":return e.jsx(M,{workspaceId:s,enabled:a.beta_settings[u.CODEX_AGENT_NETWORK_ACCESS],feature:u.CODEX_AGENT_NETWORK_ACCESS,disabled:c});case"record_access":return e.jsx(M,{workspaceId:s,enabled:a.beta_settings[u.HIVE],feature:u.HIVE,disabled:!1});case"record_reference_past_transcripts":return e.jsx(M,{workspaceId:s,enabled:a.beta_settings[u.HIVE_KNOWLEDGE_RETRIEVAL],feature:u.HIVE_KNOWLEDGE_RETRIEVAL,disabled:!1});case"legacy_models":return e.jsx(M,{workspaceId:s,enabled:a.beta_settings[u.LEGACY_MODELS],feature:u.LEGACY_MODELS,disabled:c})}},[a,t.settingName,l,n,s]),it=({workspaceId:t,data:s,disabled:a})=>{const{variables:n,mutate:l}=ee({workspaceId:t}),[i,c]=k.useState(!1);return e.jsxs(e.Fragment,{children:[i&&e.jsx(Pe,{onConfirm:()=>{l({feature:u.MEMORY,enabled:!1}),c(!1)},onClose:()=>{c(!1)}}),e.jsx(J,{label:"",disabled:a,enabled:n?.enabled??s.beta_settings[u.MEMORY],onChange:m=>{m?l({feature:u.MEMORY,enabled:m}):c(!0)}})]})},M=({workspaceId:t,disabled:s,enabled:a,feature:n})=>{const{variables:l,mutate:i}=ee({workspaceId:t});return e.jsx(J,{label:"",disabled:s,enabled:l?.enabled??a,onChange:c=>{i({feature:n,enabled:c})}})},ge=W({defaultSettingDescription:{id:"1IUdGa",defaultMessage:"This page controls the default experience for members who don't have a custom role."},thisFeatureDisabledForOrg:{id:"npt/Lq",defaultMessage:"This feature is disabled in HIPAA compliant workspaces"}}),rt=t=>t==="general"||t==="permissions"||t==="roles";function lt({currentWorkspaceId:t}){const s=E(),a=Ye(),n=Qe(),l=k.useMemo(()=>{const g=[{key:"general",label:s.formatMessage(H.generalTab),children:n?e.jsx(nt,{workspaceId:t}):e.jsx(qs,{workspaceId:t})}];return a&&(n||g.push({key:"permissions",label:s.formatMessage(H.workspacePermissionsTab),children:e.jsx(vs,{workspaceId:t})}),g.push({key:"roles",label:s.formatMessage(H.customRolesTab),children:e.jsx(Ps,{workspaceId:t})})),g},[t,s,n,a]),i=ne(),[c]=es(),m=c.get("tab"),[o,h]=k.useState(m&&rt(m)?m:l[0].key),b=g=>{h(g),i({pathname:window.location.pathname,search:new URLSearchParams({tab:g}).toString()})};return e.jsxs(e.Fragment,{children:[e.jsx(rs,{children:e.jsx("title",{children:s.formatMessage(H.title)})}),e.jsx(ys,{title:s.formatMessage(H.title),subtitle:s.formatMessage(H.subtitle),tabsHeader:e.jsx(ws,{items:l,activeTab:o,onTabChange:b})}),e.jsx(_s,{children:e.jsx(Ms,{items:l,activeTab:o})})]})}const H=W({title:{id:"842i2c",defaultMessage:"Settings & permissions"},subtitle:{id:"s0ozLO",defaultMessage:"Configure baseline permissions for your workspace and tailor access with custom roles."},generalTab:{id:"bNJn8S",defaultMessage:"Workspace"},workspacePermissionsTab:{id:"9EpK0x",defaultMessage:"Workspace permissions"},customRolesTab:{id:"0SIrmV",defaultMessage:"Custom roles"}}),Wt=Xe(function(){const s=Ts();return As(),e.jsx(lt,{...s})});export{Wt as default};
//# sourceMappingURL=pcyrykcbpyhfl1iw.js.map
