import{r as f,u as q,j as A,m as F,q as v}from"./cs7toih8jegb7teq.js";import{de as p,k7 as H}from"./hnw079jsdm76umup.js";import{dL as c,qM as l,d3 as D,dp as N,f$ as T,ik as w,gT as E,a0 as y,dO as $,dV as O}from"./dmck639k4dv7claj.js";const R={width:1,height:1};function ie(e,t,n=R){if(!e||!t)return null;const{width:r,height:s}=t;if(r===0||s===0)return null;const o=r/s,a=n.width/n.height;if(Math.abs(o-a)<1e-6)return null;let i=50,h=50;const{center_x_percent:L,center_y_percent:C}=e;if(o>a){const d=o-a;i=(L*o-a/2)/d*100,i=Math.max(0,Math.min(100,i))}else{const d=1/o,m=1/a,M=d-m;h=(C*d-m/2)/M*100,h=Math.max(0,Math.min(100,h))}return`${i.toFixed(1)}% ${h.toFixed(1)}%`}var I=(e=>(e.SCALLION="scallion",e.SCALLION_RC="scallion-rc",e.SCALLION_RC0="scallion-rc0",e.SCALLION_RC1="scallion-rc1",e.SCALLION_RC2="scallion-rc2",e.CHIVE="chive",e.CHIVE_RC="chive-rc",e.CHIVE_RC0="chive-rc0",e.CHIVE_RC1="chive-rc1",e))(I||{});const ue=async({queryKey:e})=>{const[t,n]=e;if(n.length<2)return[];const r=new URLSearchParams({query_fragment:n});return c.get(`${l}/suggestions?${r.toString()}`).then(s=>s.suggestions).catch(()=>[])};function k(e){return{settings_overrides:{search_results:{search_engines:e.use_labrador?{bing:{}}:{bing:{ranking_model:null,rrf_alpha:1,rrf_input_threshold:0},labrador:null}},model_response:{enable_multimodal:e.show_image_to_model,completion_model:e.completion_model&&e.completion_model!=="production"?{model:e.completion_model,clip_model:"@mmapi",direct_connection_urls:[]}:{}}},base_config:e.base_config??I.SCALLION,eval_preset:e.eval_preset}}async function ce({threadId:e,threadUserId:t,routePrefix:n}){let r=l;n&&(r=r+n);const s=new URL(`${r}/threads/${e}/with_turns`);return t&&s.searchParams.append("thread_user_id",t),await c.get(s.toString())}async function le(e){const t=new FormData;return t.append("feedback",JSON.stringify({thread_id:e.threadId,turn_index:e.turnIndex,rating:e.rating,search_query:e.searchQuery,text:e.text,model_instructions:e.modelInstructions,tags:e.tags,user_email:e.userEmail})),e.screenshot&&t.append("file",new File([e.screenshot],"screenshot.jpeg",{type:"image/jpeg"})),c.post(`${l}/feedback/turns`,t)}async function j(e,t){return c.post(`${l}/threads/${e}/turns/${t}/images_try_hard`)}async function he(e){const t=new FormData;return e.screenshot&&t.append("file",new File([e.screenshot],"screenshot.jpeg",{type:"image/jpeg"})),t.append("feedback",JSON.stringify({thread_id:e.threadId,url:e.url,title:e.title,snippet:e.snippet,rating:e.rating,search_query:e.searchQuery,text:e.text,tags:e.tags,user_email:e.userEmail,turn_index:e.turnIndex})),c.post(`${l}/feedback/links`,t)}function de(e){const t=k(e.agentSettingsOverrides);c.post(`${l}/prefetch`,{...t,turn:{user_query:e.query},user_metadata:e.metadata})}class x extends Error{constructor(t){super(t),this.name="TurnError"}}function Q(e){return e?e.model_response?.text!=null&&e.model_response.text.length>0:!1}function g(e){return e.execution_status==="fatal_system_error"}function V(e){return e.execution_status==="in_progress"||e.execution_status===null}function z(e){return u(t=>t.thread?.turns.map(n=>e.reduce((r,s)=>(r[s]=n[s],r),{}))??[],(t,n)=>{if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(!w(t[r],n[r]))return!1;return!0})}function U(){return u(e=>T(e.thread?.turns.flatMap(t=>t.model_response?.citations)),w)}const S={thread:null,error:void 0},u=D(N(()=>({...S}))),W=E(()=>{y.addError(new x("got updateTurn with no current thread"))},1e3),X=E(e=>{y.addError(new x("turn not found"),{turnIndex:e})},1e3),_={threadId:e=>e.thread?.id??null,turns:e=>e.thread?.turns??[],turnCitations:e=>t=>t.thread?.turns[e].model_response?.citations??[],hasResponse:e=>Q(e.thread?.turns[0]),firstTurn:e=>e.thread!=null?e.thread.turns[0]:void 0,lastTurn:e=>e.thread!=null?e.thread.turns[e.thread.turns.length-1]:void 0,numTurns:e=>e.thread?.turns.length??0,isLastTurnStreaming:e=>{const t=e.thread!=null?e.thread.turns[e.thread.turns.length-1]:void 0;return t!=null&&V(t)},hasModelResponseText:e=>e.thread?.turns[0]?.model_response?.text!=null,hasFirstTurnError:e=>{const t=e.thread?.turns[0];return!!t&&g(t)},hasTurnError:e=>e.thread?.turns.some(g)??!1,threadError:e=>e.error,__deprecated_sportsWidget:e=>e.thread?.turns[0]?.sports_widget??null},_e={appendTurn(e,t,n){u.setState(r=>{r.thread?.id!==e&&(n?.(e),r.thread={id:e,turns:[]}),r.thread.turns.push(t)})},updateTurn(e,t){u.setState(n=>{const r=n.thread;if(!r){W();return}const s=r.turns[e];if(!s){X(e);return}t(s)})},clearThread(){u.setState(()=>({...S}))},setError(e){u.setState(t=>{t.error=e})},setThread(e,t){u.setState(n=>{n.thread={id:e,turns:t}})}};class Y{queue=[];attempted=new Set;isProcessing=!1;enqueue(t){this.queue.push(t),this._processQueue()}async _processQueue(){if(!this.isProcessing){for(this.isProcessing=!0;this.queue.length>0;)try{const t=this.queue.shift();if(!t)continue;await this._preload(t)}catch{}this.isProcessing=!1}}_preload(t){return new Promise(n=>{this.attempted.has(t)&&n();const r=new Image;r.onload=()=>{this.attempted.add(t),n()},r.onerror=()=>{this.attempted.add(t),n()},r.src=t})}}const J=new Y;function K(e){const t=f.useRef(e);return $(t.current,e)||(t.current=e),t.current}function G(e,{enabled:t=!0}={}){const n=K(e);f.useEffect(()=>{if(!t||"connection"in navigator&&navigator.connection.type==="cellular")return;const s=setTimeout(()=>{n.forEach(o=>{o&&J.enqueue(o)})},1e3);return()=>{clearTimeout(s)}},[t,n])}function me(){const{imageResults:e}=B();G([...e.map(t=>b(t))])}const Z=O((...e)=>j(...e),5e3);function B(e=!1){const t=z(["image_results","image_try_hard_status","execution_status"]),n=u(_.threadId),r=T(t.toReversed().flatMap(i=>i.image_results?.entries)).map(i=>({...i,thumbnail_url:i.thumbnail_url.replace(/^http:\/\//,"https://"),content_url:i.content_url.replace(/^http:\/\//,"https://")})),s=u(_.hasModelResponseText),o=t.some(i=>g(i));let a=r.length===0&&!s;return n!=null&&e&&!a&&r.length===0&&t[0]?.image_try_hard_status==="not_attempted"&&(Z(n,0),a=!0),e&&t[0]?.image_try_hard_status==="in_progress"&&(a=!0),{imageResults:r,isLoading:a,isErrored:r.length===0&&o}}function ge(){const e=U(),t=u(_.hasTurnError),n=u(_.hasModelResponseText),r=H(e);return{imageResults:r,isLoading:r.length===0&&!n,isErrored:r.length===0&&t}}function ee(e,t){return v({queryKey:["downloadImage",{imageUrl:e,downloadType:t}],queryFn:()=>new Promise((n,r)=>{if(!e){r();return}const s=performance.now(),o=new Image;o.onload=()=>{p.logEvent("Search Tool Image Download Latency",{type:t,image_url:e,latency_ms:Math.round(performance.now()-s),error:!1}),n({width:o.width,height:o.height})},o.onerror=()=>{p.logEvent("Search Tool Image Download Latency",{type:t,image_url:e,latency_ms:Math.round(performance.now()-s),error:!0}),r()},o.src=e}),enabled:!!e})}function fe(e,t){return q(ee(e,t))}const te=474,P={width:te,aspectRatio:R};function b(e,t=P){if(e==null||e.is_proxied_image)return;const n=new URL(e.thumbnail_url);if(n.hostname.indexOf(".bing.")===-1)return e.thumbnail_url;const{width:r,height:s,aspectRatio:o}=t;let a=Math.min(r,e.content_size.width),i=s??Math.floor(o?a*(o.height/o.width):a*e.content_size.height/e.content_size.width);return!s&&o&&o.width===o.height&&(a=i=Math.min(a,i)),n.searchParams.delete("pid"),n.searchParams.set("w",a.toString()),n.searchParams.set("h",i.toString()),n.searchParams.set("c","7"),n.searchParams.set("p","0"),n.toString()}function pe(e,t=P){return f.useMemo(()=>b(e,t),[e,t])}const re={type:"spring",stiffness:700,damping:82};function Te({children:e,className:t}){return A.jsx(F.div,{animate:{opacity:1},initial:{width:"100%",height:"100%",translateX:0,translateY:0,opacity:0},whileHover:{width:"103%",height:"103%",translateX:"-1.5%",translateY:"-1.5%"},transition:re,className:t,children:e})}export{R as A,I as B,te as D,Te as I,_ as T,B as a,fe as b,pe as c,u as d,g as e,ue as f,ee as g,he as h,re as i,V as j,z as k,me as l,_e as m,ce as n,ie as o,le as p,de as r,ge as u};
//# sourceMappingURL=owiiott81wvonpc1.js.map
