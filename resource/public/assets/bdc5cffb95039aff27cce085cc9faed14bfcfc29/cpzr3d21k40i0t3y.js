import{r as g,j as p,e as T}from"./cs7toih8jegb7teq.js";import{dq as M,v as l,N as d,e as C,p as x,e8 as k}from"./dmck639k4dv7claj.js";import{CoTChunks as _}from"./102lf40gtygmryn9.js";import{i6 as m}from"./hnw079jsdm76umup.js";import"./ijbbvzexsuset1g7.js";import"./j016trxwqzgsccq0.js";import"./dupxx6qfa09nz1fw.js";import"./l32pbw1kg88xu4to.js";import"./dfhgw8mxn1h3ecpw.js";import"./ljj1p3s92okaif60.js";import"./mgmoe87nocb640xb.js";import"./o12mkc4t9o2t0ta8.js";import"./lflgzlgfd348gvw6.js";import"./dtz2gnda2vx03dil.js";import"./pbl95wx6493wq92j.js";import"./mcuu3cegz8rmschr.js";import"./kftq93ifet8ii8nr.js";import"./nsa6r7grrfqk0ahy.js";import"./djjpj5f1idix1hxg.js";const y=(e,t)=>{if(t<=1)return e.formatMessage({id:"ZxhUq1",defaultMessage:"a second"});if(t<3)return e.formatMessage({id:"4GD7tD",defaultMessage:"a couple of seconds"});if(t<4)return e.formatMessage({id:"jx5V1u",defaultMessage:"a few seconds"});if(t>=60){const n=Math.floor(t/60),o=t%60;return`${n}m ${o}s`}return e.formatMessage({id:"p4/pTg",defaultMessage:"{seconds} seconds"},{seconds:t})},E=e=>{let t=0;for(const n of e)t+=n.metadata?.finished_duration_sec??0;return t},R=(e,t,n)=>t.length>1?e.formatMessage({id:"sdDgmZ",defaultMessage:"Thought for {timing}"},{timing:y(e,n)}):M(t)?.metadata?.finished_text??"",I=(e,t,n=!1)=>{const o=[];let s={type:m.Thought,thought:{summary:"",content:""}};const a=()=>{s.thought.content.trim()&&(o.push(s),s={type:m.Thought,thought:{summary:s.thought.summary,content:""}})},u=e.split(/( {2}\n)|(\n\n)/).filter(i=>i!=null&&i.trim());if(!n&&u.length<2)return o;let c=!1;for(let i=0;i<u.length;i++){const r=u[i].trim();if(r.toLowerCase()==="none"){l.count(d.COT_SUMMARIZER,"num_none_chunks");continue}const f=r.match(/^\*\*(.*)\*\*$/);if(f)a(),s.thought.summary=f[1]??"";else if(r){if(r.startsWith("```")){if(c){s.thought.content+=s.thought.content?`
${r}`:r,a(),c=!1;continue}a(),c=!0}s.thought.content.trim()&&!r.startsWith("\\[")&&!r.startsWith("\\(")&&!c&&a(),s.thought.content+=s.thought.content?`
${r}`:r}}return s?.thought.content.trim()&&o.push(s),n&&t&&o.push({type:m.Recap,content:t}),o},N=(e,t,n)=>{const o=!n,s=g.useMemo(()=>I(e,t,o),[e,t,o]);return g.useEffect(()=>{o&&l.hist(d.COT_SUMMARIZER,"num_cot_chunks",void 0,s.length)},[o]),s},S=({isStreaming:e,finishedText:t,summaryText:n,isFinalAssistantTurn:o})=>{const s=N(n,t,e);return p.jsx(_,{isStreaming:e,isFinalAssistantTurn:o,chunks:s})},O=8,j=`

`,K=({messages:e,isStreaming:t,isFinalAssistantTurn:n})=>{const o=T(),s=C(),a=x(s,"1214379119"),u=E(e);let c="";return e.forEach(i=>{const h=k(i);c+=c?j+h:h}),a&&!t&&!c&&u<O?null:p.jsx(S,{finishedText:R(o,e,u),summaryText:c,isStreaming:t,isFinalAssistantTurn:n})};export{S as LegacyCoT,K as LegacyCoTMessage};
//# sourceMappingURL=cpzr3d21k40i0t3y.js.map
