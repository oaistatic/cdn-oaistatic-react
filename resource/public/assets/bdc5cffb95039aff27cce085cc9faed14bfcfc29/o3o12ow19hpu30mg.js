import{e as X,j as t,d as ee,r as _,M as S,u as rt,v as Ie,p as D,b as it}from"./cs7toih8jegb7teq.js";import{D as lt,B as z,cx as H,r_ as ct,g as Oe,aI as $e,bi as Ge,eh as Ve,eP as dt,dv as mt,eA as ut,hq as We,eg as ft,il as gt,fB as pt,m5 as ht,fL as xt,jG as yt,dd as be,eo as U,d_ as _t,e as bt,bR as vt,ep as jt,bv as wt,r$ as Mt,z as kt,c3 as Se,v as ve,N as je,P as qe,T as Ct,s0 as Nt,a0 as St,fD as Q,bt as ke,hg as Tt,R as Pt,k8 as Ft,aF as Et,f1 as At,pq as Te,hr as Dt,rd as zt,cL as Lt,ig as Rt,dx as Bt,mU as It,s1 as Ot,e8 as $t,dE as Gt,hA as Vt,b$ as Wt,cy as qt,pL as Ut}from"./dmck639k4dv7claj.js";import{L as we,i as Ht,a as Kt}from"./n8303igkzlzv9639.js";import{eM as Ue,jG as Yt,X as Qt,jC as de,jk as Jt,pY as Zt,pZ as Xt,aM as es,p2 as ts,p3 as ss,gC as ns,c4 as C,b3 as as,c3 as Pe,fp as He,by as Ke,hz as os}from"./hnw079jsdm76umup.js";import{S as rs}from"./lyxm37ljpwg11a5m.js";import{S as is}from"./dvi0n1hal1hb8zit.js";import{b as Fe}from"./g61ghrdmm0y010eo.js";import{M as ls,E as cs}from"./ns51nblw8ziscsgd.js";const ds=H.div`h-px bg-token-border-default`,O=H.div`text-sm font-medium py-3 leading-6`,ms=H.div`my-4 p-5 w-full rounded-2xl popover bg-token-main-surface-primary shadow-lg border border-token-border-default`,ye=":",us=({to:e,cc:s,bcc:n,subject:r,body:a,onClick:o,isDraft:i=!0,isCanceled:m=!1})=>{const u=X(),d=[];return e&&d.push(t.jsx("div",{children:t.jsxs("div",{className:"flex",children:[t.jsxs(O,{className:"text-token-text-tertiary me-1",children:[u.formatMessage(q.draftToFieldLabel),ye]}),t.jsx(O,{children:e})]})},"to")),s&&d.push(t.jsx("div",{children:t.jsxs("div",{className:"flex",children:[t.jsxs(O,{className:"text-token-text-tertiary me-1",children:[u.formatMessage(q.draftCcFieldLabel),ye]}),t.jsx(O,{children:s})]})},"cc")),n&&d.push(t.jsx("div",{children:t.jsxs("div",{className:"flex",children:[t.jsxs(O,{className:"text-token-text-tertiary me-1",children:[u.formatMessage(q.draftBccFieldLabel),ye]}),t.jsx(O,{children:n})]})},"bcc")),r&&d.push(t.jsx(O,{children:r},"subject")),a&&d.push(t.jsx(O,{className:"whitespace-pre-line",children:a},"body")),t.jsxs(ms,{children:[t.jsxs("div",{className:"mb-4 flex items-center",children:[t.jsx(lt,{className:"icon-sm me-4"}),t.jsx("div",{className:"font-semibold",children:i?u.formatMessage(q.draftMessageLabel):u.formatMessage(q.sentMessageLabel)})]}),d.map((p,y)=>t.jsxs(_.Fragment,{children:[t.jsx(ds,{}),p]},y)),i&&!m&&t.jsx("div",{className:"mt-2 flex justify-end gap-4",children:t.jsx(z,{color:"primary",className:"py-2",onClick:o,children:u.formatMessage(q.sendButton)})}),m&&t.jsx("div",{className:"mt-2 flex justify-end gap-4",children:t.jsx(z,{color:"primary",className:"py-2",disabled:!0,children:u.formatMessage(q.canceledButton)})})]})},q=ee({draftMessageLabel:{id:"emailView.draftMessageLabel",defaultMessage:"Draft Message"},sentMessageLabel:{id:"emailView.sentMessageLabel",defaultMessage:"Sent Message"},sendButton:{id:"emailView.sendButton",defaultMessage:"Send"},draftToFieldLabel:{id:"emailView.draftToLabel",defaultMessage:"To"},draftCcFieldLabel:{id:"emailView.draftCcLabel",defaultMessage:"Cc"},draftBccFieldLabel:{id:"emailView.draftBccLabel",defaultMessage:"Bcc"},canceledButton:{id:"emailView.canceledButton",defaultMessage:"Canceled"}});function fs({action:e,handleUserAction:s,userActionParams:n,displayParams:r,rememberAnswer:a}){return e.type==="deny"?t.jsx(z,{color:"secondary",size:"small",onClick:o=>{s({sourceEvent:o,...n,actionData:{type:"deny",...e.deny,remember_answer:a}})},children:t.jsx(S,{...e.name==="decline"?$.decline:$.deny})}):e.type==="allow"?t.jsx(z,{color:"primary",size:"small",onClick:o=>{s({sourceEvent:o,...n,actionData:{type:"allow",...e.allow,remember_answer:a}})},children:t.jsx(S,{...e.name==="allow"?$.allow:$.confirm})}):e.type==="always_allow"?t.jsx(z,{color:"secondary",size:"small",onClick:o=>{s({sourceEvent:o,...n,actionData:{type:"always_allow",...e.always_allow}})},children:t.jsx(S,{...$.alwaysAllow})}):e.type==="oauth_redirect"?t.jsx(z,{color:"primary",size:"small",onClick:()=>{ps(e.oauth_redirect,n.clientThreadId,n.turnGizmo)},children:t.jsx(S,{...$.signInButton,values:{domain:r.domain}})}):e.type==="contact_gizmo"?t.jsx(z,{color:"secondary",size:"small",onClick:o=>{s({sourceEvent:o,...n,actionData:{type:"contact_gizmo",...e.contact_gizmo}})},children:t.jsx(S,{...$.allow})}):null}function gs({connector:e,onClick:s}){const n=X();return e&&t.jsxs("div",{className:"flex w-80 flex-col items-center rounded-xl border p-6 text-center",children:[t.jsx(Ue,{connector:e,size:"large",className:"bg-primary shadow-xxs max-h-fit rounded-2xl border bg-clip-padding p-2"}),t.jsx("div",{className:"text-token-text-primary mt-3 text-lg font-semibold",children:ct(e.name,n)}),t.jsx("div",{className:"text-token-text-secondary mt-1 text-sm",children:e.description}),t.jsx(z,{className:"mt-4 w-full",color:"secondary",onClick:s,children:t.jsx(S,{...$.connectButton})})]})}function ps(e,s,n){const r=Oe(s),a=$e(s),o=r?.mode?.kind===Ge.GizmoTest,i=a&&!o?Ve(a,n):window.location.href;e.gizmo_id==="FAKE_PLUGIN_GIZMO"?dt({id:e.gizmo_action_id},i):mt.doOAuthRedirect(e.gizmo_id,e.gizmo_action_id,e.domain,i,o)}const $=ee({alwaysAllow:{id:"jitPluginMessage.alwaysAllow",defaultMessage:"Always Allow"},allow:{id:"jitPluginMessage.allow",defaultMessage:"Allow"},decline:{id:"jitPluginMessage.decline",defaultMessage:"Decline"},confirm:{id:"jitPluginMessage.confirm",defaultMessage:"Confirm"},deny:{id:"jitPluginMessage.deny",defaultMessage:"Deny"},signInButton:{id:"jitPluginMessage.signInButton",defaultMessage:"Sign in with {domain}"},connectButton:{id:"jitPluginMessage.connectButton",defaultMessage:"Connect"}});function hs({functionName:e,params:s,result:n,isWrite:r}){const a=ut(),o=We(),{namespace:i,actionName:m}=xs(e);if(i==="api_tool"&&m==="call_tool"&&s&&"path"in s&&"args"in s&&typeof s.path=="string"&&(typeof s.args=="object"||typeof s.args=="string")&&s.args!=null){const[u,d,p]=s.path.split("/").filter(Boolean);if(u&&d&&p){const y=[...a.connectorLinks.values()].flat().find(b=>b.id===d),l=y&&o.platformConnectors.get(y.connector_id);return t.jsx(Ee,{connector:{name:l?.name??u,logo_url:l?.logo_url??null},actionName:p,isWrite:r,params:typeof s.args=="object"?s.args:JSON.parse(s.args),result:n})}}return t.jsx(Ee,{connector:{name:i,logo_url:null},actionName:m,isWrite:r,params:s,result:n})}function xs(e){const s=e.indexOf("."),n=s===-1?e:e.slice(0,s),r=s===-1?"":e.slice(s+1);return{namespace:n,actionName:r}}function Ee({connector:e,actionName:s,params:n,result:r,isWrite:a}){return t.jsxs("div",{className:"border-token-border-default bg-token-bg-default mt-1 mb-4 grid max-w-xl gap-4 rounded-xl border p-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Ue,{connector:{name:e.name,logo_url:e.logo_url},size:"large"}),t.jsxs("div",{className:"flex flex-1 flex-col",children:[t.jsx("div",{className:"text-token-text-secondary text-xs",children:e.name}),t.jsx("div",{className:"text-token-text-primary text-sm",children:s})]}),a&&t.jsx("div",{className:"border-token-text-quartenary text-token-text-secondary dark:border-token-border-heavy dark:text-token-text-tertiary items-center rounded-full border px-1 py-0.5 text-[8px] leading-3 font-semibold uppercase",children:t.jsx(S,{id:"APIToolCallCard.write",defaultMessage:"Write"})})]}),n!=null&&t.jsx(Ae,{name:De.request,params:n}),r!=null&&t.jsx(Ae,{name:De.response,params:r}),a&&t.jsxs("div",{className:"text-token-text-secondary text-sm",children:[t.jsx(ft,{className:"icon-sm me-1 mb-0.5 inline-block"}),t.jsx(S,{id:"APIToolCallCard.writeWarning",defaultMessage:"Write actions come with risks. <link>Learn more</link>",values:{link:o=>t.jsx("a",{href:"https://platform.openai.com/docs/mcp#risks-and-safety",className:"underline underline-offset-2",target:"_blank",rel:"noopener noreferrer",children:o},"link")}})]})]})}function Ae({name:e,params:s}){const n=X();return t.jsxs("div",{className:"bg-token-bg-secondary/30 max-w-full min-w-0 space-y-3 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center justify-between gap-3",children:[t.jsx("div",{className:"text-token-text-secondary text-xs",children:n.formatMessage(e)}),t.jsx(Yt,{buttonText:!0,className:"text-token-text-secondary text-xs",onCopy:()=>Qt(typeof s=="string"?s:JSON.stringify(s))})]}),typeof s=="string"?t.jsx("div",{className:"text-token-text-primary line-clamp-3 font-mono text-sm",children:s}):t.jsx(we,{value:s})]})}const De=ee({request:{id:"APIToolCallCard.request",defaultMessage:"Request"},response:{id:"APIToolCallCard.response",defaultMessage:"Response"}}),ys=e=>{const{r:s,g:n,b:r}=Fe.toRGBA(Fe.parse(e));return(s*299+n*587+r*114)/1e3<125};function Ye(e){return e.modelPreferences?.hints?.[0]?.name||"unknown-model"}function Qe(e,s,n){const r=window.location.origin+"/backend-api/ecosystem/completion",a=new AbortController,o=gt(r,{ctx:pt(),method:"POST",body:{method:"sampling/createMessage",params:{messages:e.messages,modelPreferences:e.modelPreferences,systemPrompt:e.systemPrompt,metadata:{...e.metadata??{},app_uri:s}}},signal:a.signal,accessToken:n});return{stream:_s(ht(o)),controller:a}}async function*_s(e){for await(const s of e)s&&typeof s=="object"&&"data"in s&&s.data&&typeof s.data=="object"&&"content"in s.data&&(yield s.data.content)}async function*bs(e,s,n){const r=Ye(e),{stream:a,controller:o}=Qe(e,s,n);try{for await(const i of a)i.type==="text"&&(yield{content:{type:"text",text:i.text},model:r,role:"assistant"})}finally{try{o.abort("Widget canceled reading completion stream")}catch{}}}async function vs(e,s,n){const r=Ye(e),{stream:a,controller:o}=Qe(e,s,n);try{let i="";for await(const m of a)m.type==="text"&&(i=m.text);return{content:{type:"text",text:i},model:r,role:"assistant"}}finally{try{o.abort("Widget canceled reading completion call stream")}catch{}}}const js=(e,s)=>"?"+["",`app=${e}`,`locale=${s}`].filter(Boolean).join("&"),ws=({host:e="chatgpt",isInert:s=!1,title:n,ref:r,api:a,locale:o})=>{const[i]=_.useState(()=>xt(null)),m=de(async(y,...l)=>(await yt(()=>!!i()),be(i()?.[y],`Method ${String(y)} not found`)(...l))),u=U(()=>i());_.useImperativeHandle(r,()=>new Proxy({},{get:(y,l)=>(...b)=>m(l,...b)}),[m,u]);const d=de((y,...l)=>{const b=a[y];if(!b){console.warn("HostAPI method not found",y);return}return b(...l)}),p=de(y=>y?(Ht(y,{drawBoundingBoxes:(...l)=>d("drawBoundingBoxes",...l),notifyBackgroundColor:(...l)=>d("notifyBackgroundColor",...l),notifyIntrinsicHeight:(...l)=>d("notifyIntrinsicHeight",...l),sendInstrument:(...l)=>d("sendInstrument",...l),getDownloadURL:(...l)=>d("getDownloadURL",...l),callTool:(...l)=>d("callTool",...l),streamCompletion:async function*(...b){yield*d("streamCompletion",...b)},callCompletion:(...l)=>d("callCompletion",...l),notifySecurityPolicyViolation:(...l)=>d("notifySecurityPolicyViolation",...l),notifyEnvironmentError:(...l)=>d("notifyEnvironmentError",...l),updateWidgetState:(...l)=>d("updateWidgetState",...l),sendFollowUpMessage:(...l)=>d("sendFollowUpMessage",...l),requestDisplayMode:(...l)=>d("requestDisplayMode",...l),notifyNavigation:(...l)=>d("notifyNavigation",...l)},["runUserCode","runWidgetCode"]).then(l=>{i.set(l)}),()=>{i.set(null)}):i.set(null));return t.jsx(_t,{children:t.jsx("iframe",{title:n,inert:s,src:`${Kt}/index.html${js(e,o)}`,ref:p,sandbox:"allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox allow-forms",className:"h-full w-full max-w-full"},"sandbox")})},Ms=({host:e,ref:s,html:n,accessToken:r,widgetId:a,widgetParent:o,widgetState:i=null,widgetProps:m=null,maxHeight:u,theme:d,title:p,api:y,locale:l,displayMode:b,onReady:J})=>{const P=_.useRef(null);_.useEffect(()=>{(async()=>{if(!n||!a)return;const L=P.current?.runWidgetCode({html:n,widgetId:a,widgetState:i,widgetProps:m,maxHeight:u,theme:d,csp:null});if(L)for await(const R of await L)R.type===ls.ENVIRONMENT_STATUS&&R.status===cs.RUNNING_CODE&&J?.()})()},[n]);const M=de(F=>{P.current?.setAdditionalGlobals({additionalGlobals:F})});return _.useEffect(()=>{a&&P.current?.setWidgetProps({widgetId:a,widgetState:i,widgetProps:m})},[M,a,i,m]),_.useEffect(()=>{M({maxHeight:u})},[M,u]),_.useEffect(()=>{M({displayMode:b})},[M,b]),t.jsx(ws,{title:p,host:e,api:{...y,streamCompletion:async function*(F){yield*bs(F,be(o),r)},callCompletion:async function(F){return await vs(F,be(o),r)}},ref:Jt(P,s),locale:l})};function ks({namespace:e,functionName:s}){e==="ecosystem_demo"&&(ve.count(je.ECOSYSTEM_DEMO,"ecosystem_demo.tool_impression",{tool:s}),qe.logEvent("Ecosystem Demo: Tool Impression",{tool:s}))}const Cs=({messageId:e,clientThreadId:s,chatSDKMetadata:n,html:r,htmlAssetPointer:a,message:o,title:i,toolInfo:m,onRequestCompletion:u})=>{const[d,p]=_.useState(null),y=bt(),{locale:l}=vt(y),b=_.useRef(null),J=Zt(n),P=Xt(n),M=_.useRef(!1);_.useEffect(()=>{m&&!M.current&&(ks(m),M.current=!0)},[m,M]);const F=f=>{const w=Ct.getRequestId(Oe(s));if(!Nt(w)){if(!f.prompt){St.addError("No prompt provided to sendFollowUpMessage");return}u({completionType:Tt.Next,promptMessage:{id:Ie(),author:{role:ke.User,name:"user"},content:{content_type:Q.Text,parts:[f.prompt]},recipient:"all",metadata:{is_visually_hidden_from_conversation:!0}},eventSource:"mouse"})}},L=f=>{const w=[m?.namespace,m?.functionName].filter(Boolean).join(".");switch(f.type){case"hist":{ve.hist(je.ECOSYSTEM,`${w}.${f.label}`,f.tags,f.value);break}case"count":{const ie=`${w}.${f.label}`;ve.count(je.ECOSYSTEM,ie,f.tags,f.count),qe.logEvent("Ecosystem Demo: Tool Clicked",{name:ie});break}}},{data:R}=rt({queryKey:["htmlAsset",a],queryFn:()=>a&&Pt.safeGet("/kanzi/__internal__/app/html_asset",{parameters:{query:{file_id:a.split("://")[1]}}}),enabled:!!a}),T=es(jt(y,s)),E=U(()=>T.title$()),B=U(()=>T.isPinned$(o)),te=U(()=>T.isActivePinnedMessage$(e)),A=U(()=>T.isActivePinnedMessage$(e)?T.displayMode$():"inline"),h=U(()=>T.getActiveMessage$(o).id),[v,se]=_.useState(!1),G=(f,w)=>(se(!0),ts({forceFlushSync:!0,className:ss["pinned-widget"],update:()=>{T.setDisplayMode$(o,f,w)}}).finished.then(()=>{se(!1)}),{mode:f}),[ue,ne]=U(()=>T.getWidgetStateAndPropsForMessage$(o)),ae=wt(({windowHeight:f})=>A==="pip"?f/2:A==="fullscreen"?f-164:f),[oe,fe]=_.useState(!1),[ge,V]=_.useState(!1),[pe,K]=_.useState(!1),[k,re]=_.useState(!1),he=Mt();if(B&&!te)return null;const j=A==="fullscreen",I=f=>{j||v||(p(f),T.setPinnedWidgetHeight(f))},W=t.jsxs("div",{className:kt("no-scrollbar overflow-hidden rounded-2xl shadow-[0px_0px_0px_1px_var(--border-heavy),0px_4px_10px_rgba(0,0,0,0.06)] transition-[opacity,transform] duration-500 ease-out sm:rounded-3xl",k&&"dark",v&&"[view-transition-name:pinned-kanzi-widget]",!te&&"relative my-2",A==="inline"&&"w-full",A==="pip"&&"thread-xl:top-4 fixed start-0 end-0 top-(--header-height) z-50 mx-auto w-full max-w-(--thread-content-max-width)",j&&"fixed start-4 end-4 top-(--header-height) bottom-[164px] z-50 mx-auto w-auto",oe?"scale-100 opacity-100":"scale-90 opacity-0"),style:{maxHeight:ae,height:j?"100%":d?`${d}px`:"auto"},children:[B&&!j&&t.jsx("button",{className:"absolute start-4 top-4 rounded-full bg-black/20 p-1.5 text-white backdrop-blur-lg hover:bg-black/50 dark:bg-white/20 dark:hover:bg-white/50",onClick:()=>G("inline"),children:t.jsx(Se,{})}),!B&&!1,B&&j&&t.jsxs("div",{className:"border-token-border-secondary flex h-10 items-center gap-3 border-b p-5",children:[t.jsx("button",{className:"hover:bg-token-main-surface-secondary start-4 top-4 rounded-full p-1.5 backdrop-blur-lg",onClick:()=>G("inline"),children:t.jsx(Se,{className:"icon"})}),t.jsx("div",{className:"text-base",children:E})]}),t.jsx(Ms,{ref:b,host:"chatgpt",title:i,locale:l,html:R??r??null,widgetId:h,widgetType:J,widgetParent:P,widgetState:ne,widgetProps:ue,maxHeight:ae,theme:he??"light",displayMode:A??"inline",onReady:()=>fe(!0),api:{notifyBackgroundColor:f=>re(ys(f)),notifyNavigation:({canGoBack:f,canGoForward:w})=>{V(f),K(w)},notifyIntrinsicHeight:I,sendInstrument:L,sendFollowUpMessage:F,updateWidgetState:(f,w)=>T.setWidgetState$(f,w),requestDisplayMode:({mode:f,title:w})=>G(f,w),callTool:(f,w)=>T.callTool$(P,f,w)}}),j&&t.jsx("div",{className:"pointer-events-none absolute start-2 end-2 bottom-2 z-10 flex justify-end",children:t.jsxs("div",{className:"pointer-events-auto mx-auto flex gap-2",children:[t.jsx("button",{className:"rounded-full bg-black/20 p-1.5 text-white hover:enabled:bg-black/50 disabled:opacity-50 dark:bg-white/20 dark:hover:enabled:bg-white/50",onClick:()=>{ge?b.current?.navigate({delta:-1}):G("inline")},children:t.jsx(rs,{})}),t.jsx("button",{disabled:!pe,className:"rounded-full bg-black/20 p-1.5 text-white hover:enabled:bg-black/50 disabled:opacity-50 dark:bg-white/20 dark:hover:enabled:bg-white/50",onClick:()=>b.current?.navigate({delta:1}),children:t.jsx(is,{})})]})})]});return t.jsxs(t.Fragment,{children:[j&&t.jsx("div",{className:"bg-token-bg-primary fixed start-0 end-0 top-0 bottom-0 z-10"}),W]})},Ns=H.div`h-px bg-token-border-default`,ze=H.div`text-sm font-medium py-3 leading-6`,Ss=H.div`my-4 p-5 w-full rounded-2xl popover bg-token-main-surface-primary shadow-lg border border-token-border-default`,Ts=":",Ps=({functionName:e,parameters:s,onClick:n,isDraft:r=!0,isCanceled:a=!1})=>{const o=X(),i=Object.entries(s).filter(([m,u])=>!u||m==="timezone_str"&&u===Intl.DateTimeFormat().resolvedOptions().timeZone?!1:u.length>0);return t.jsxs(Ss,{children:[t.jsx("div",{className:"mb-4 flex items-center font-semibold",children:t.jsx("div",{children:r?Me(e):Fs(e,o)})}),i.map(([m,u])=>t.jsxs("div",{children:[t.jsx(Ns,{}),t.jsxs("div",{className:"flex",children:[t.jsxs(ze,{className:"text-token-text-tertiary me-1",children:[Me(m),Ts]}),t.jsx(ze,{className:"whitespace-pre-line",children:Je(u,o)})]})]},m)),r&&!a&&t.jsx("div",{className:"mt-2 flex justify-end gap-4",children:t.jsx(z,{color:"primary",className:"py-2",onClick:n,children:o.formatMessage(me.approveButton)})}),a&&t.jsx("div",{className:"mt-2 flex justify-end gap-4",children:t.jsx(z,{color:"primary",className:"py-2",disabled:!0,children:o.formatMessage(me.canceledButton)})})]})},Fs=(e,s)=>{switch(e){case"create_event":return"Created Event ✅";default:return`${Me(e)} ${s.formatMessage(me.completedAction)} ✅`}},Me=e=>{switch(e){case"timezone_str":return"Timezone";default:return e.split("_").map(s=>s.charAt(0).toUpperCase()+s.slice(1).toLowerCase()).join(" ")}},Je=(e,s)=>{if(Array.isArray(e))return e.map(a=>Je(a,s)).join(s.formatMessage(me.valueSeparator));if(typeof e=="object")return JSON.stringify(e);if(e.match(/^\s*\d{4}-\d{2}-\d{2}/)==null)return e;const r=new Date(e);return Number.isNaN(r.getTime())?e:s.formatDate(r,{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"numeric"})},me=ee({approveButton:{id:"ParametersView.approveButton",defaultMessage:"Approve"},completedAction:{id:"ParametersView.completedAction",defaultMessage:"Completed"},canceledButton:{id:"ParametersView.canceledButton",defaultMessage:"Canceled"},valueSeparator:{id:"ParametersView.valueSeparator",defaultMessage:","}});var c=(e=>(e[e.Running=0]="Running",e[e.Finished=1]="Finished",e[e.Error=2]="Error",e[e.Stopped=3]="Stopped",e[e.OauthLogin=4]="OauthLogin",e[e.UserConfirmation=5]="UserConfirmation",e[e.Denied=6]="Denied",e[e.Hidden=7]="Hidden",e))(c||{});function Es(e,s,n,r,a){return s=As(s,r,a),s?e.formatMessage(s,n):null}function As(e,s,n){if(![c.Finished,c.Running,c.Stopped].includes(n)||!s)return e;switch(s){case"ecosystem_demo.daw":case"ecosystem_demo.daw_drums":return n===c.Finished||n===c.Stopped?D({id:"BYgUCC",defaultMessage:"Composed track"}):D({id:"9n1xDI",defaultMessage:"Composing track"});case"ecosystem_demo.flashcards":return n===c.Finished||n===c.Stopped?D({id:"szZeVr",defaultMessage:"Created flashcards"}):D({id:"NYOjya",defaultMessage:"Creating flashcards"});case"api_tool.list_resources":return n===c.Finished||n===c.Stopped?D({id:"OdEouq",defaultMessage:"Looked for available tools"}):D({id:"hSyoq0",defaultMessage:"Looking for available tools"});case"api_tool.search_tools":return n===c.Finished||n===c.Stopped?D({id:"4et5qC",defaultMessage:"Searched tools"}):D({id:"V0IDh0",defaultMessage:"Searching tools"});case"api_tool.call_tool":return n===c.Finished||n===c.Stopped?D({id:"NTASw4",defaultMessage:"Called tool"}):D({id:"gc64KQ",defaultMessage:"Calling tool"})}return e}const Ze="openaiFileIdRefs",Ds=["send_email","batch_modify_email","create_event","update_event","delete_event"];function Js({messages:e,nextMessage:s,clientThreadId:n,isLastMessageInTurn:r,isLastTurnInConversation:a,connectorFixture:o,allowInspectingArguments:i,onRequestCompletion:m}){const[u,d]=it(),[p,...y]=e;let l=y;l.length===0&&p.author.role===ke.Tool&&(l=[p]);const b=X(),J=Ft(n),P=p.metadata?.gizmo_id??J,M=Et(n,g=>Ut(g?.mode,P)),F=ns(M)&&M.gizmo_id===P,L=At(P,F)?.data,[R,T]=_.useState(!1),E=Te(p.recipient);let B;if(E?.functionName!=null&&L?.tools!=null){for(const g of L.tools)if(Is(g,E.functionName)){B=g;break}}const te=l.filter(g=>g.metadata?.jit_plugin_data?.from_server?.type==="debug"),A=l.filter(g=>!["debug","send_test"].some(x=>x===g.metadata?.jit_plugin_data?.from_server?.type)),{uiState:h,jitPluginData:v,fileAttachments:se,invokedPlugin:G}=Rs(p,A,r),ue=Te(s?.recipient)?.namespace,{connectorId:ne,connectorToolStatus:ae,connectorStatusMessage:oe,showConnectorConnect:fe}=Bs(E?.namespace,ue,l,a),ge=We(!0,Dt.JIT_PLUGIN),V=o??ge.platformConnectors.get(ne??""),pe=zt();let K;for(let g=A.length-1;g>=0;g--){const x=A[g].metadata?.jit_plugin_data;if(x?.from_server?.type==="confirm_action"){K=x;break}}let k=v?.from_server?.type!=="denied_by_user"?v?.from_server?.body.domain:B?.metadata?.domain,re=null;if(!k&&E?.functionName&&E.namespace==="kanzi_app"){const[g,x]=E.functionName.split("/");k=g.replace(/_/g," "),re=t.jsx(qt,{openNewTab:!0,className:"text-token-text-secondary pt-1 opacity-0 transition-opacity duration-200 group-hover/tool-message:opacity-100",href:`/kanzi/studio/c/${x}`,children:t.jsx(os,{})})}k?k.endsWith("__jit_plugin")&&(k=k.slice(0,-12)):k="connector";const he=B?.metadata?.privacy_policy_url;_.useEffect(()=>{if(Xe(v?.from_client)?.type==="oauth_success")return;const g=u.get("oauth_success");if(v?.from_server?.type==="oauth_required"&&g){d(x=>(x.delete("oauth_success"),x),{replace:!0});for(const x of v.from_server.body.actions)if(x.type==="oauth_redirect"){_e({eventSource:"url",assistantMessage:p,onRequestCompletion:m,actionData:{type:"oauth_success",target_message_id:x.oauth_redirect.target_message_id},conversationMode:M});return}}},[M,p,e,n,m,v,a,u,d]);const j=l[l.length-1];j?.metadata?.chatgpt_sdk?.tool_domain&&(k=j.metadata.chatgpt_sdk.tool_domain);let I=C.Running,W=k?N.running:N.starting,f={domain:k};if(h===c.Hidden)return null;h===c.OauthLogin||h===c.UserConfirmation?(I=C.Paused,W=N.confirmingSimple,f={...{gizmoName:L?.gizmo.display.name??"ChatGPT",domain:k},title:x=>t.jsxs("div",{className:"inline-flex items-center gap-1 text-sm",children:[x,t.jsx(Ke,{className:"icon-sm"})]}),subtitle:x=>t.jsx("div",{className:"text-xs",children:x})}):h===c.Finished?(I=C.Finished,W=N.finished,f={domain:k}):h===c.Error?(I=C.Error,W=N.error):(h===c.Stopped||h===c.Denied)&&(I=C.Stopped,W=h===c.Denied?N.declined:N.stopped);const w={assistantMessage:p,allMessages:e,clientThreadId:n,turnGizmo:L,onRequestCompletion:m,conversationMode:M},ie={domain:k},Ce=v?.from_server?.type!=="denied_by_user"?v?.from_server?.body.actions.map((g,x)=>t.jsx(fs,{action:g,displayParams:ie,handleUserAction:_e,userActionParams:w,rememberAnswer:R},x)):null,et=Es(b,W,f,p.recipient??"",h),tt=H.div`flex gap-2 flex-wrap mt-1 empty:hidden`,le=Be(v)??Be(K)??Os(p),xe=$s(j),st=le?.[Ze]??[],nt=i&&(!!le||!!xe||st.length>0);let ce=t.jsx(t.Fragment,{});const Z=Le(v,G)??Le(K,void 0)??"";if(Ds.includes(Z)&&(h===c.UserConfirmation||h===c.Finished||h===c.Stopped||h===c.Denied)){const g=h!==c.Finished,x=(h===c.Stopped||h===c.Denied)&&!a,Y=Re(v,G)??Re(K,void 0),Ne=at=>{v?.from_server?.type==="confirm_action"&&v?.from_server?.body?.actions?.[0].type==="allow"&&(_e({...w,sourceEvent:at,actionData:{type:"allow",...v?.from_server?.body?.actions?.[0].allow,remember_answer:R}}),Gt(n,ot=>{ot.scrollToMessageId=n}))};switch(Z){case"send_email":ce=t.jsx(us,{to:Y?.to,cc:Y?.cc,bcc:Y?.bcc,subject:Y?.subject,body:Y?.body,onClick:h===c.UserConfirmation?Ne:()=>{},isDraft:g,isCanceled:x});break;default:ce=t.jsx(Ps,{functionName:Z??"",parameters:Y??{},onClick:h===c.UserConfirmation?Ne:()=>{},isDraft:g,isCanceled:x});break}}else(h===c.UserConfirmation||h===c.OauthLogin)&&Ce&&(ce=t.jsx(t.Fragment,{children:t.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[Ce,v?.from_server?.type==="confirm_action"&&(v?.from_server?.body?.offer_remember_answer||!0)?t.jsx("div",{className:"flex gap-2 text-sm",children:t.jsx(as,{id:"dont-ask-again",label:t.jsx(S,{...N.rememberForThisConversation}),checked:R,onChange:g=>T(g.target.checked)})}):null]})}));return ne?t.jsxs(t.Fragment,{children:[oe&&t.jsx(Pe,{highlightedCommand:V?b.formatMessage(oe,{domain:V.name}):t.jsx("br",{}),status:ae,showWorkUserSetting:!1}),fe&&V&&t.jsx("div",{className:"mb-2 flex gap-2",children:t.jsx(gs,{connector:V,onClick:()=>{const g=$e(n),x=g?new URL(Ve(g),window.location.origin):new URL(window.location.href);x.searchParams.set("oauth_success","true"),pe({connectorId:V.id,redirectAfter:x.toString(),referrer:Lt.JitPluginMessage})}})})]}):t.jsxs(t.Fragment,{children:[t.jsx(Ls,{debugMessages:te}),t.jsx("span",{className:"group/tool-message",children:t.jsx(Pe,{highlightedCommand:et,status:I,showWorkUserSetting:!1,accessory:re,forceExpanded:h===c.UserConfirmation,children:nt?E?.namespace==="api_tool"?t.jsx(hs,{isWrite:h===c.UserConfirmation,functionName:p.recipient??Z,params:le,result:xe}):t.jsx(Gs,{privacyPolicyUrl:he,name:p.recipient??Z,params:le,result:xe,isPromptingForPermission:I===C.Paused}):null})}),t.jsx(tt,{children:se?.map(g=>t.jsx(He,{file:g.name,fileId:g.id,width:"wide",alwaysShowData:!0,showDownloadButton:!0,downloadLink:g.download_url,contextConnectorInfo:Rt(g.context_connector_info)},g.id))}),j&&(j.metadata?.chatgpt_sdk?.rendered_template||j.metadata?.chatgpt_sdk?.html_asset_pointer)&&t.jsx(Cs,{chatSDKMetadata:j.metadata.chatgpt_sdk,clientThreadId:n,message:j,html:j.metadata.chatgpt_sdk.rendered_template,htmlAssetPointer:j.metadata.chatgpt_sdk.html_asset_pointer,title:"",messageId:j.id,onRequestCompletion:m,toolInfo:E}),ce]})}function zs({messageMetadata:e}){const[s,n]=_.useState(!1);return t.jsxs("div",{className:"my-2 flex flex-col text-sm",children:[t.jsxs("div",{className:"flex flex-row items-center hover:cursor-pointer",onClick:()=>{n(!s)},children:[s?t.jsx(Ke,{className:"icon-sm"}):t.jsx(Wt,{className:"icon-sm"}),t.jsx("div",{className:"font-semibold",children:e.display_message})]}),s&&t.jsx("pre",{children:JSON.stringify(e.data,null,2)})]})}function Ls({debugMessages:e}){return e.length===0?null:t.jsx("div",{children:e.map((s,n)=>{const r=s.metadata?.jit_plugin_data?.from_server;return r&&r.type==="debug"?t.jsx(zs,{messageMetadata:r.body},n):null})})}function Le(e,s){return e?.from_server?.type==="confirm_action"?e?.from_server?.body?.operation:s?.parsed_function_call?.name}function Re(e,s){return e?.from_server?.type==="confirm_action"?e?.from_server?.body?.params:s?.parsed_function_call?.kwargs}function Rs(e,s,n){if(e.metadata?.jit_plugin_data?.from_server?.type==="send_test")return{uiState:c.Hidden};if(s.some(r=>r.content.content_type===Q.SystemError))return{uiState:c.Error};if(It(e))return{uiState:c.Stopped};for(let r=s.length-1;r>=0;r--){const a=s[r];if(a.metadata?.invoked_plugin){const m=[];return s.forEach(u=>{const d=u.metadata?.attachments?.filter(p=>p.display_files_from_actions_ext);d&&m.push(...d)}),{uiState:c.Finished,jitPluginData:a.metadata.jit_plugin_data,invokedPlugin:a.metadata.invoked_plugin,fileAttachments:m}}const o=Xe(a.metadata?.jit_plugin_data?.from_client);if(o!=null){if(o?.type==="contact_gizmo")return{uiState:c.Finished,jitPluginData:s[r-1]?.metadata?.jit_plugin_data};if(o?.type==="deny")return{uiState:c.Denied};if(o?.type==="oauth_success")return{uiState:c.Running,jitPluginData:a.metadata?.jit_plugin_data};break}const i=a.metadata?.jit_plugin_data?.from_server;if(i?.type==="preview"&&n)return{uiState:c.Running,jitPluginData:a.metadata?.jit_plugin_data};if(i?.type==="confirm_action"&&n)return{uiState:c.UserConfirmation,jitPluginData:a.metadata?.jit_plugin_data};if(i?.type==="oauth_required"&&n)return{uiState:c.OauthLogin,jitPluginData:a.metadata?.jit_plugin_data}}return{uiState:n?c.Running:c.Stopped}}function Bs(e,s,n,r){var a=Ot(e)??void 0;if(!a)return{connectorId:void 0,connectorToolStatus:null,connectorStatusMessage:null,showConnectorConnect:!1};if(s===e)return{connectorId:a,connectorToolStatus:null,connectorStatusMessage:null,showConnectorConnect:!1};var o=C.Running,i=null,m=!1;const u=n[n.length-1],d=u?.metadata?.jit_plugin_data;return n.some(p=>p.content.content_type===Q.SystemError)?(o=C.Error,i=N.error):u?d?.from_server?.type==="oauth_required"&&r?(o=C.Paused,i=null,m=!0):d?.from_server?.type==="oauth_required"&&!r?(o=C.Stopped,i=N.connectorDeclined):d?.from_client?.type==="deny"?(o=C.Stopped,i=N.connectorDeclined):d?.from_client?.type==="oauth_success"?(o=C.Stopped,i=null):u?.metadata?.invoked_plugin?(o=C.Finished,i=N.finished):(o=C.Stopped,i=N.stopped):(o=C.Running,i=N.running),{connectorId:a,connectorToolStatus:o,connectorStatusMessage:i,showConnectorConnect:m}}function _e({actionData:e,assistantMessage:s,turnGizmo:n,onRequestCompletion:r,conversationMode:a,...o}){const i={id:Ie(),author:{role:ke.Tool,name:s.recipient},content:{content_type:Q.Text,parts:[""]},recipient:"all",metadata:{jit_plugin_data:{from_client:e},gizmo_id:n?.gizmo.id},clientMetadata:{completionSampleFinishTime:Date.now()}};r({...o,promptMessage:i,completionMetadata:{conversationMode:a??{kind:Ge.PrimaryAssistant}}})}function Is(e,s){if(e.type!==Bt.JIT_PLUGIN||!e.metadata.json_schema)return!1;let n=!1;function r(a){for(const o in a)o==="operationId"&&a[o]===s&&(n=!0),a[o]&&typeof a[o]=="object"&&r(a[o])}return r(e.metadata.json_schema),n}function Be(e){if(e&&(e.from_server?.type==="confirm_action"||e.from_server?.type==="oauth_required"||e.from_server?.type==="preview"))return e.from_server.body.params}function Os(e){const s=$t(e);if(s)try{return JSON.parse(s)}catch{return{text:s}}}function $s(e){if(!e)return;const s=e.content.content_type===Q.Text?e.content.parts[0]:e.content.content_type===Q.Code?e.content.text:void 0;if(s)try{return JSON.parse(s)}catch{return s}}function Gs({name:e,params:s,result:n,privacyPolicyUrl:r,isPromptingForPermission:a}){const i=(s?.[Ze]??[]).map((m,u)=>{const d=m.name.startsWith("dalle-");let p=m.name;return d&&(p=`${p}.webp`),t.jsx(He,{file:p,fileId:m.id},u)});return t.jsxs("div",{className:"divide-token-border-default border-token-border-default mt-1 mb-4 divide-y overflow-hidden rounded-xl border",children:[e&&t.jsx("div",{className:"bg-token-bg-tertiary text-token-text-secondary px-4 py-2 text-sm",children:t.jsx(S,{id:"JITPluginMessage.params.toolCall",defaultMessage:"Tool call: {name}",values:{name:t.jsx("span",{className:"text-token-text-primary",children:e})}})}),s&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"bg-token-bg-tertiary text-token-text-secondary flex justify-between px-4 py-2 text-sm",children:[a?t.jsx(S,{id:"JITPluginMessage.params.sharing.present",defaultMessage:"The following will be shared:"}):t.jsx(S,{id:"JITPluginMessage.params.sharing.past",defaultMessage:"The following was shared:"}),r&&t.jsx("a",{href:Vt(r),className:"text-token-text-primary",target:"_blank",rel:"noreferrer",children:t.jsx(S,{...N.privacyPolicyLink})})]}),t.jsx("div",{className:"px-4 py-2",children:t.jsx(we,{value:s})}),i.length>0&&t.jsx("div",{className:"px-4 py-2",children:i})]}),n&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"bg-token-bg-tertiary text-token-text-secondary flex justify-between px-4 py-2 text-sm",children:t.jsx(S,{id:"JITPluginMessage.params.result",defaultMessage:"Result:"})}),t.jsx("div",{className:"px-4 py-2",children:t.jsx(we,{value:n})})]})]})}function Xe(e){if(e&&"user_action"in e){const s=e.user_action;e={...e,...s.data},"target_message_id"in e&&s.target_message_id&&(e.target_message_id=s.target_message_id)}return e}const N=ee({starting:{id:"jitPluginMessage.starting",defaultMessage:"Starting action"},confirmingSimple:{id:"jitPluginMessage.confirming.simple",defaultMessage:"{gizmoName} wants to talk to {domain}"},confirmingSubtitle:{id:"jitPluginMessage.confirming.subtitle",defaultMessage:"Only allow sites you trust."},running:{id:"jitPluginMessage.runningV4",defaultMessage:"Talking to {domain}"},finished:{id:"jitPluginMessage.finishedV4",defaultMessage:"Talked to {domain}"},stopped:{id:"jitPluginMessage.stoppedV4",defaultMessage:"Stopped talking to {domain}"},error:{id:"jitPluginMessage.errorV5",defaultMessage:"Error talking to {domain}"},declined:{id:"jitPluginMessage.declined",defaultMessage:"You declined this action"},ranTest:{id:"jitPluginMessage.ranTest",defaultMessage:"Tested {operationName}"},confirmParamsTitle:{id:"jitPluginMessage.confirmParamsTitleV3",defaultMessage:"{gizmoName} wants to share this info with {domain}"},sentParamsTitle:{id:"jitPluginMessage.sentParamsTitleV2",defaultMessage:"{gizmoName} sent this info to {domain}"},privacyPolicyLink:{id:"jitPluginMessage.privacyPolicyLinkV2",defaultMessage:"Privacy policy"},connectorDeclined:{id:"jitPluginMessage.connectorDeclined",defaultMessage:"Declined connection to {domain}"},rememberForThisConversation:{id:"jitPluginMessage.rememberForThisConversation",defaultMessage:"Remember for this conversation"}});export{Js as JITPluginMessage};
//# sourceMappingURL=o3o12ow19hpu30mg.js.map
