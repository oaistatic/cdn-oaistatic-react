import{r as d,j as e,e as Le,M as a,d as De,L as A,R as Ie}from"./cs7toih8jegb7teq.js";import{i0 as Ne,h$ as we,g as V,T as _,pG as Ee,R as ie,e0 as ne,br as oe,e as Ae,bV as Pe,by as Re,cR as Te,aF as Q,f0 as Be,aG as Ue,C as ee,av as Fe,S as qe,be as He,eg as Oe,z as ze,bc as P,bd as R,P as F,aq as q,mF as $e}from"./dmck639k4dv7claj.js";import{c8 as Ge,d as We,bg as Xe,ak as Ye,b1 as Je,X as se}from"./hnw079jsdm76umup.js";import{L as Ke,R as Ze,X as Ve}from"./o2irc1i5e2v5m1br.js";const Qe=()=>Ne((s,o)=>({title:void 0,highlightedMessageId:void 0,initiallyHighlightedMessageId:void 0,currentNodeId:void 0,shareLinkId:void 0,shareLinkUrl:void 0,isPublic:!1,isDeleted:!1,isAnonymous:!0,isDiscoverable:!1,canDisableDiscoverability:!1,linkAlreadyExisted:!1,linkAlreadyPublic:!1,linkError:void 0,moderationState:void 0,piiDetected:!1})),H=d.createContext(),v=s=>we(d.useContext(H),s),es=()=>v(s=>s.shareLinkId),ss=()=>v(s=>s.shareLinkUrl),ts=()=>v(s=>s.currentNodeId),as=()=>v(s=>s.linkAlreadyPublic);function is(s){return s.metadata?.aggregate_result?.messages?.some(Ge)===!0}function ns(s){const o=s.content;return("parts"in o?o.parts.join(""):"").includes("sandbox:")}function os(s){return is(s)||ns(s)}const h=De({moderationBlocked:{id:"sharingModal.moderationBlocked",defaultMessage:"This shared link has been disabled by moderation."},confirmDeleteLink:{id:"sharingModal.confirmDeleteLink",defaultMessage:"Are you sure you want to delete the share link?"},advancedDataAnalysisSupportDisclaimer:{id:"sharingModal.advancedDataAnalysisSupportDisclaimer",defaultMessage:"Recipients won’t be able to view Advanced Data Analysis images or download files."},imageLicenseDisclaimer:{id:"sharingModal.imageLicenseDisclaimer",defaultMessage:"Only use images you have confirmed you have the license to use."},screenshotDisclaimer:{id:"sharingModal.screenshotDisclaimer",defaultMessage:"Screenshots may contain sensitive information."},copying:{id:"thread.sharingModal.copying",defaultMessage:"Copying..."},failedToCopyLink:{id:"thread.sharingModal.failedToCopyLink",defaultMessage:"Failed to copy link to clipboard"},failedToDeleteSharedLink:{id:"thread.sharingModal.failedToDeleteSharedLink",defaultMessage:"Failed to delete shared link"},plusProjectDescription:{id:"sharingModal.plusProjectDescription",defaultMessage:"Your name, uploaded files, custom instructions, and any messages you add after sharing stay private."},enterpriseProjectDescription:{id:"sharingModal.enterpriseProjectDescription",defaultMessage:"Any messages you add after sharing will be visible to members of your workspace. Project files and custom instructions won’t be accessible via the shared link."}}),rs=e.jsx(a,{id:"HuCdJn",defaultMessage:"This conversation may include personal information."}),ls=e.jsx(a,{id:"AEHBcL",defaultMessage:"Take a moment to check the content before sharing the link."});function ys({serverThreadId:s}){const o=We(s),p=V(s)!=null?_.getCurrentNode(V(s)).message.id:o?.current_node,[r]=d.useState(()=>Qe()),g=!Ee()&&p,[I,M]=d.useState(!0),j=d.useRef(!1);return d.useEffect(()=>{g&&(j.current||(j.current=!0,ie.safePost("/share/create",{requestBody:{current_node_id:p,conversation_id:s,is_anonymous:!0}}).then(n=>{r.setState({shareLinkId:n.share_id,shareLinkUrl:n.share_url,isPublic:n.is_public,isDeleted:!n.is_visible,title:n.title,highlightedMessageId:n.highlighted_message_id??void 0,initiallyHighlightedMessageId:n.highlighted_message_id??void 0,currentNodeId:n.current_node_id,linkAlreadyExisted:n.already_exists,linkAlreadyPublic:n.is_public,isAnonymous:n.is_anonymous,isDiscoverable:n.is_discoverable,canDisableDiscoverability:n.can_disable_discoverability,moderationState:n.moderation_state??void 0,piiDetected:n.pii_detected??!1})}).catch(n=>{const x=ne(n);x?r.setState({linkError:x}):oe.closeSharingModal()}).finally(()=>{M(!1)})))},[g]),e.jsx(H.Provider,{value:r,children:e.jsx(us,{serverThreadId:s,isLoading:I})})}function te(s){return s.has_been_auto_blocked===!0||s.has_been_auto_moderated===!0||s.has_been_blocked===!0}const ds="https://help.openai.com/en/articles/7925741-chatgpt-shared-links-faq",cs="https://help.openai.com/en/articles/8474715-chatgpt-enterprise-shared-links-faq";function us({serverThreadId:s,isLoading:o}){const p=Ae(),r=Le(),[S,g]=d.useState(!1),[I,M]=d.useState(!1),[j,n]=d.useState(!1),x=Pe(),C=d.useContext(H),L=es(),y=ss(),re=ts(),m=as(),O=v(t=>t.linkError),D=v(t=>t.moderationState),le=D!=null&&te(D),de=v(t=>t.piiDetected),N=Re(Te.isBusinessWorkspace),[z,ce,ue,he,ge]=Q(s,t=>[_.getCurrentNode(t),_.hasUserContextPrompt(t),_.hasModelEditableContext(t),_.findNode(t,i=>os(i.message))!=null,_.getGizmoId(t)]),me=z?.message.id,T=Be(ge),$=Q(s,t=>t?_.getConversationTurns(t).flatMap(i=>i.messages):[]),{hasImage:G,hasScreenshot:W}=d.useMemo(()=>{let t=!1,i=!1;const l=/(\.jpe?g|\.png|\.gif|\.webp|\.bmp|\.tiff)$/i;return $.forEach(f=>{const u=f.metadata;if(!u)return;const k=E=>{if(Array.isArray(E)){for(const b of E)if(b.type==="image_inline"&&b.clicked_from_url&&(i=!0),b.type==="file"&&"file_name"in b){const Z=b.file_name?.toLowerCase?.()??"";(Z.endsWith(".pptx")||l.test(Z))&&(t=!0)}}};k(Object.values(u.n7jupd_crefs_by_file??{}).flat()),k(Object.values(u.content_references_by_file??{}).flat()),k([...u.n7jupd_crefs??[],...u.content_references??[]])}),{hasImage:t,hasScreenshot:i}},[$]),X=Ue(p,"1547743984"),fe=X.get("show_copylink_state_if_no_updates",!1),pe=!m&&X.get("is_one_click_sharing_enabled",!1),xe=async t=>{const{highlightedMessageId:i,title:l,isDeleted:f,isAnonymous:u}=C.getState(),{moderation_state:k,is_discoverable:E,can_disable_discoverability:b}=await ie.safePatch("/share/{shared_conversation_id}",{parameters:{path:{shared_conversation_id:t}},requestBody:{highlighted_message_id:i,title:l??void 0,is_public:!f,is_visible:!f,is_anonymous:u,current_node_id:z?.message.id}});if(te(k)){C.setState({moderationState:k});return}C.setState({isPublic:!0,moderationState:k,isDiscoverable:E??void 0,canDisableDiscoverability:b})},Y=ce||ue;if(o)return e.jsx(ee,{isOpen:!0,testId:"modal-sharing",onClose:Fe,size:"custom",className:"max-w-[550px]",type:"success",showCloseButton:!0,children:e.jsx("div",{className:"flex h-full items-center justify-center py-4",children:e.jsx(qe,{className:"icon text-token-text-secondary"})})});const ye=async(t,i,l)=>{try{se(i,x,l)}catch{x.danger(h.failedToCopyLink,{toastId:"failed_to_copy_link"}),g(!1);return}if(j){try{se(i,x,l)}catch{x.danger(h.failedToCopyLink,{toastId:"failed_to_copy_link"});return}M(!0),setTimeout(()=>{M(!1)},1500);return}g(!0);try{await xe(t),M(!0),setTimeout(()=>{M(!1)},1500)}catch(f){const u=ne(f);u&&C.setState({linkError:u})}finally{g(!1)}n(!0)},J=pe&&!m,c=J||j||N&&m||m&&re===me&&fe,K=!c||J&&!j,ke=K;function be(){oe.closeSharingModal()}const _e=()=>{let t,i;return N?(t=e.jsx(a,{id:"IR+p6G",defaultMessage:"Share link to chat"}),i=T?r.formatMessage(h.enterpriseProjectDescription):e.jsx(a,{id:"ZKoPTp",defaultMessage:"Any messages you add after sharing will be visible to members of your workspace."}),c&&(t=e.jsx(a,{id:"AX5quN",defaultMessage:"Link created"}),i=e.jsx(a,{id:"OmpNr/",defaultMessage:"A link to your chat has been created. Manage previously shared chats at any time via <settingsLink>Settings</settingsLink>.",values:{settingsLink:l=>e.jsx(A,{to:P(R.DataControls),className:"underline",children:l})}})),{modalTitle:t,modalDescription:ae(i,G,W)}):(c?m?(t=e.jsx(a,{id:"DD6oDE",defaultMessage:"Public link updated"}),i=e.jsx(a,{id:"sJl/nl",defaultMessage:"The public link to your chat has been updated. Manage previously shared chats via <settingsLink>Settings</settingsLink>.",values:{settingsLink:l=>e.jsx(A,{to:P(R.DataControls),className:"underline",children:l})}})):(t=e.jsx(a,{id:"7xzg3Y",defaultMessage:"Public link created"}),i=e.jsx(a,{id:"LZ5EAo",defaultMessage:"A public link to your chat has been created. Manage previously shared chats at any time via <settingsLink>Settings</settingsLink>.",values:{settingsLink:l=>e.jsx(A,{to:P(R.DataControls),className:"underline",children:l})}})):m?(t=e.jsx(a,{id:"FyIlHR",defaultMessage:"Update public link to chat"}),i=T?r.formatMessage(h.plusProjectDescription):Y?e.jsx(a,{id:"091Z/H",defaultMessage:"Your name, custom instructions, and any messages you add after sharing stay private."}):e.jsx(a,{id:"U7wOdx",defaultMessage:"Your name and any messages you add after sharing stay private."})):(t=e.jsx(a,{id:"xgkjrq",defaultMessage:"Share public link to chat"}),i=T?r.formatMessage(h.plusProjectDescription):Y?e.jsx(a,{id:"091Z/H",defaultMessage:"Your name, custom instructions, and any messages you add after sharing stay private."}):e.jsx(a,{id:"U7wOdx",defaultMessage:"Your name and any messages you add after sharing stay private."})),{modalTitle:t,modalDescription:ae(i,G,W)})},ve=()=>S?e.jsx(a,{...h.copying}):I?e.jsx(a,{id:"zMndTF",defaultMessage:"Copied"}):c?e.jsx(a,{id:"F+gzqW",defaultMessage:"Copy link"}):m?e.jsx(a,{id:"SviHx3",defaultMessage:"Update link"}):e.jsx(a,{id:"Ns/mpl",defaultMessage:"Create link"}),{modalTitle:Se,modalDescription:Me}=_e(),B=ve(),je=e.jsx(He.Button,{onClick:t=>ye(L,y,t),color:"primary",disabled:S||I||L==null||y==null||O!=null||le,className:"ms-4 me-0 mt-0 rounded-full px-4 py-1 text-base font-bold sm:py-3",loading:S,icon:c?Xe:Ye,"data-testid":B.props.defaultMessage==="Create link"?"create-link-shared-chat-button":B.props.defaultMessage==="Copied"?"copied-shared-chat-button":void 0,children:B});let w=O;w==null&&(D?.has_been_auto_blocked||D?.has_been_auto_moderated||D?.has_been_blocked)&&(w=e.jsx(a,{...h.moderationBlocked}));const Ce=c?y:window.location.origin+"/share/…",U=C.getState().title??"My ChatGPT conversation";return e.jsxs(ee,{isOpen:!0,testId:"modal-sharing",onClose:()=>{be()},size:"custom",className:"max-w-[550px]",type:"success",title:Se,showCloseButton:!0,children:[de&&e.jsx("div",{className:"mb-4",children:e.jsx(Je,{title:rs,content:ls,icon:e.jsx(Oe,{"aria-hidden":!0}),type:"info"})}),w!=null&&e.jsx("div",{className:"mb-4 rounded-md bg-red-500 p-4 text-white",children:w}),e.jsx("div",{className:"w-full",children:e.jsx("p",{className:"text-token-text-secondary mb-6",children:e.jsxs("span",{children:[Me," ",!K&&e.jsx("a",{href:N?cs:ds,className:"text-token-text-secondary hover:text-token-text-tertiary inline-flex items-center gap-2 underline",target:"_blank",rel:"noreferrer",children:e.jsx(a,{id:"TKNIin",defaultMessage:"Learn more"})})]})})}),!ke&&e.jsx(hs,{shouldShowCodeInterpreterDisclaimer:he}),e.jsxs("div",{className:"border-token-border-medium bg-token-main-surface-primary text-token-text-secondary has-focus-visible:border-token-border-xheavy mb-2 flex items-center justify-between rounded-full border p-1.5 last:mb-2 sm:p-2",children:[e.jsxs("div",{className:"relative ms-1 grow",children:[e.jsx("input",{type:"text",readOnly:!0,value:Ce,disabled:!c,className:ze("bg-token-main-surface-primary w-full rounded-xl border-0 px-2 py-1 text-lg focus:ring-0 sm:py-2.5",c?"text-token-text-primary":"text-token-text-tertiary")}),e.jsx("div",{className:"from-token-main-surface-primary pointer-events-none absolute end-0 top-0 bottom-0 w-12 bg-linear-to-l"})]}),je]}),!1,m&&!c&&e.jsx("div",{className:"w-full",children:e.jsx("p",{className:"text-token-text-tertiary mb-3 text-sm",children:e.jsx(a,{id:"A9Jgr5",defaultMessage:"A past version of this chat has already been shared. Manage previously shared chats via <settingsLink>Settings</settingsLink>.",values:{settingsLink:t=>e.jsx(A,{to:P(R.DataControls),className:"underline",children:t})}})})}),!N&&c&&y&&e.jsxs("div",{className:"mt-6 flex justify-center space-x-14",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("a",{href:`https://www.linkedin.com/shareArticle?url=${encodeURIComponent(y)}&text=${encodeURIComponent(U)}`,target:"_blank",rel:"noopener noreferrer",onClick:()=>{F.logEvent("Share Public Chat: LinkedIn Social Clicked",{shareLinkId:L}),q.logEvent("chatgpt_conversation_share_link_social_clicked","linkedin")},children:e.jsx(Ke,{initialBackgroundColor:"var(--main-surface-secondary)",initialFillColor:"var(--text-secondary)"})}),e.jsx("span",{className:"text-token-text-secondary mt-1 text-xs font-semibold",children:e.jsx(a,{id:"YtW6Uh",defaultMessage:"LinkedIn"})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("a",{href:`https://www.reddit.com/submit?url=${encodeURIComponent(y)}&title=${encodeURIComponent(U)}`,target:"_blank",rel:"noopener noreferrer",onClick:()=>{F.logEvent("Share Public Chat: Reddit Social Clicked",{shareLinkId:L}),q.logEvent("chatgpt_conversation_share_link_social_clicked","reddit")},children:e.jsx(Ze,{initialBackgroundColor:"var(--main-surface-secondary)",initialFillColor:"var(--text-secondary)"})}),e.jsx("span",{className:"text-token-text-secondary mt-1 text-xs font-semibold",children:e.jsx(a,{id:"VLrIK1",defaultMessage:"Reddit"})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("a",{href:`https://twitter.com/intent/tweet?url=${encodeURIComponent(y)}&text=${encodeURIComponent(U)}`,target:"_blank",rel:"noopener noreferrer",onClick:()=>{F.logEvent("Share Public Chat: X Social Clicked",{shareLinkId:L}),q.logEvent("chatgpt_conversation_share_link_social_clicked","x")},children:e.jsx(Ve,{initialBackgroundColor:"var(--main-surface-secondary)",initialFillColor:"var(--text-secondary)"})}),e.jsx("span",{className:"text-token-text-secondary mt-1 text-xs font-semibold",children:e.jsx(a,{id:"CgECe/",defaultMessage:"X"})})]})]})]})}const hs=({shouldShowCodeInterpreterDisclaimer:s})=>e.jsx(e.Fragment,{children:s&&e.jsx(gs,{icon:$e,children:e.jsx(a,{id:"iEl3pV",defaultMessage:"Images and files in this chat won't be shown in the public link."})})}),gs=({children:s,icon:o})=>e.jsxs("div",{className:"bg-token-main-surface-secondary text-token-text-secondary mb-4 flex items-center justify-between rounded-2xl p-4 last:mb-0",children:[s,o!=null&&e.jsx(o,{className:"icon-sm mt-1 shrink-0"})]});function ae(s,o,p){const r=[];return p&&r.push(e.jsx(a,{...h.screenshotDisclaimer},"screenshot-note")),o&&r.push(e.jsx(a,{...h.imageLicenseDisclaimer},"image-note")),r.length?e.jsxs(e.Fragment,{children:[s,r.map((S,g)=>e.jsxs(Ie.Fragment,{children:[e.jsx(e.Fragment,{children:" "}),S]},g))]}):s}export{ds as SHARED_LINKS_HELP_URL,ys as default};
//# sourceMappingURL=k445sp62us48o5gz.js.map
