import{j as s,e as L,r as l,M as B,a as K,n as Z,v as z,R as ee,c as R}from"./cs7toih8jegb7teq.js";import{be as D,z as j,y as te,ck as se,P as ne,aE as Y,br as ae,e3 as oe,e as q,w as G,eh as U,R as re,gT as ce,p as Q,bN as le,C as ie,G as ue,c3 as de}from"./dmck639k4dv7claj.js";import{u as fe,F as $}from"./fhmbfrqqfncxraqv.js";import{u as C,F as k,a as N,b as me}from"./etto4cxdmq45jwpe.js";import{hA as V,x as he,rl as xe,rm as ge,bh as ye}from"./hnw079jsdm76umup.js";import{e as ve}from"./mpeahdafp45cy7gg.js";function pe({children:t,rootClassName:e,className:a,description:n,icon:c,isOpen:o=!1,onClose:r,primaryButton:u,secondaryButton:i,size:g="normal",title:f,type:x,noPadding:m=!1,hideSeparator:p=!1,showCloseButton:y=!1,shouldIgnoreClickOutside:d=!1,closeButton:v,isScrollable:w=!0,position:S="center",removePopoverStyling:M=!1,showOverlayBackground:T=!0,shadow:I="normal"}){const _=!!f,A=!!t,h=_&&A&&!p;return s.jsx(D.Root,{testId:"modal-fanny-pack",isOpen:o,onClose:r,shouldIgnoreClickOutside:d,className:e,children:s.jsx(D.Overlay,{showBackground:T,children:s.jsxs(ke,{size:g,position:S,className:j("flex flex-col focus:outline-hidden",{"max-w-md":g==="normal"},a),removePopoverStyling:M,shadow:I,children:[s.jsx(D.Header,{icon:c,title:f,type:x,closeButton:y&&(v??s.jsx(te,{onClick:()=>r(!0)})),description:n,hasSeparator:h}),s.jsxs("div",{className:j("grow",w?"overflow-y-auto":"overflow-y-hidden",{"p-4 sm:p-6":g!=="fullscreen"&&!m,"md:pt-0!":!A}),children:[t,u!=null||i!=null?s.jsx(D.Actions,{primaryButton:u,secondaryButton:i,modalHasContent:A}):null]})]})})})}function ke({className:t,children:e,position:a="center",size:n,removePopoverStyling:c=!1,shadow:o="normal"}){return s.jsx("div",{className:j("z-50 h-full w-full overflow-y-auto",n!=="fullscreen"&&"grid grid-cols-[10px_1fr_10px]",n!=="fullscreen"&&a==="center"&&"grid-rows-[minmax(10px,1fr)_auto_minmax(10px,1fr)] md:grid-rows-[minmax(20px,1fr)_auto_minmax(20px,1fr)]",n!=="fullscreen"&&a==="bottom"&&"grid-rows-[minmax(10px,1fr)_auto_10px] md:grid-rows-[minmax(20px,1fr)_auto_20px]"),children:s.jsx(se,{className:j(!c&&"popover","bg-token-main-surface-primary relative start-1/2 col-auto col-start-2 row-auto row-start-2 h-full w-full text-start ltr:-translate-x-1/2 rtl:translate-x-1/2",n!=="fullscreen"&&"rounded-2xl",o==="normal"&&"shadow-xl",t),children:e})})}function we(){const t=L(),e=C(n=>n.query),a=l.useRef(null);return s.jsx("input",{className:"placeholder:text-token-text-tertiary w-full border-none bg-transparent focus:border-transparent focus:ring-0 focus:outline-hidden",placeholder:t.formatMessage({id:"FannyPack.SearchPlaceholder",defaultMessage:"Search chats..."}),onChange:n=>k.setQuery(n.target.value),onKeyDown:n=>{!n.shiftKey&&(n.key==="ArrowUp"||n.key==="ArrowDown")&&n.preventDefault()},value:e,ref:a})}function F({className:t,isActive:e=!1,icon:a,children:n,onClick:c,onMouseEnter:o,onMouseLeave:r}){const u=C(i=>i.mouseInteractionsDisabled);return s.jsx("div",{className:j("cursor-pointer",t),onMouseEnter:u?void 0:o,onMouseLeave:u?void 0:r,onClick:c,children:s.jsxs("div",{className:j("group relative flex items-center rounded-xl px-4 py-3",e&&"dark:bg-token-main-surface-secondary bg-[#f4f4f4]"),children:[a,s.jsx("div",{className:j("relative grow overflow-hidden whitespace-nowrap",a?"ps-2":""),children:n})]})})}function J(t){return t.formatMessage({id:"fannyPack.DefaultChatTitle",defaultMessage:"New chat"})}function be({historyResult:t,index:e}){const a=L(),{item:n,onSelect:c}=t,o=C(r=>r.activeIndex);return s.jsx(F,{isActive:o===e,icon:s.jsx(V,{className:"icon"}),onClick:()=>{N.logClick(n.id,e,"history"),c&&c()},onMouseEnter:()=>k.setActiveIndex(e),onMouseLeave:()=>k.setActiveIndex(void 0),children:s.jsx("div",{className:"text-sm",children:n.title??J(a)})})}function je({labelResult:t}){return s.jsx("div",{className:"group text-token-text-tertiary relative my-2 px-4 pt-2 text-xs leading-4",children:t.text})}function Ne({newChatResult:t,query:e=void 0,index:a}){const{onSelect:n}=t,c=C(o=>o.activeIndex);return s.jsx(F,{isActive:c===a,onClick:()=>{ne.logNewChatButtonClicked({location:"Fanny Pack"}),n&&n()},onMouseEnter:()=>k.setActiveIndex(a),onMouseLeave:()=>k.setActiveIndex(void 0),icon:s.jsx(he,{className:"icon"}),children:s.jsx("div",{className:"text-sm",children:e?s.jsx(B,{id:"iQsutJ",defaultMessage:'New chat "{query}"',values:{query:e}}):s.jsx(B,{id:"FannyPack.NewChat",defaultMessage:"New chat"})})})}function Ce(t){return l.useMemo(()=>{if(!t)return null;const e=new Date(t*1e3),a=new Date;return e.toDateString()===a.toDateString()?"Today":new Date(new Date().setDate(a.getDate()-1)).toDateString()===e.toDateString()?"Yesterday":e.getFullYear()===a.getFullYear()?e.toLocaleDateString(void 0,{month:"short",day:"numeric"}):e.toLocaleDateString(void 0,{year:"2-digit",month:"numeric",day:"numeric"})},[t])}const Se=8;function Me(t){return t.isArchived?{titleClassName:"text-sm text-token-text-tertiary",titleHighlightedClassName:"text-token-text-secondary font-semibold",messageClassName:"text-xs text-token-text-tertiary",messageHighlightedClassName:"text-token-text-secondary font-medium"}:{titleClassName:"text-sm text-token-text-primary",titleHighlightedClassName:"text-token-text-primary font-semibold",messageClassName:"text-xs text-token-text-secondary",messageHighlightedClassName:"text-token-text-primary font-medium"}}function H({text:t,textToHighlight:e,shouldAdjustStart:a=!1,highlightClassName:n}){const c=l.useMemo(()=>{if(!a||!e)return t;const r=t.toLowerCase().indexOf(e?.toLowerCase());if(r===-1)return t;const u=Math.max(r-Se,0),i=t.substring(u);return u===0?i:"â€¦"+i},[t,e,a]),o=l.useMemo(()=>{const r=new RegExp(`(${ve(e)})`,"gi");return c.split(r)},[c,e]);return!e||e.length===0?s.jsx("span",{children:t}):s.jsx("div",{className:"truncate",children:o.map((r,u)=>r.toLowerCase()===e.toLowerCase()?s.jsx("span",{className:n,children:r},u):r)})}function Pe({searchResult:t,index:e,elementRef:a}){const{item:n,onSelect:c,query:o}=t,r=L(),u=Ce(n.updateTime),i=Me(n),f=C(m=>m.activeIndex)===e,x=l.useRef(null);return l.useEffect(()=>{let m;const p=setTimeout(()=>{m=new IntersectionObserver(y=>{y.forEach(d=>{d.isIntersecting&&(N.logImpression(n.source,e,n.conversationId),m&&m.disconnect())})},{threshold:.5}),x.current&&m.observe(x.current)},250);return()=>{m&&m.disconnect(),clearTimeout(p)}},[x,n,o,e]),s.jsx("div",{ref:x,children:s.jsx(F,{isActive:f,icon:n.isArchived?s.jsx(xe,{className:"icon text-token-text-tertiary"}):s.jsx(V,{className:"icon"}),onClick:()=>{N.logClick(n.conversationId,e,n.source),c&&c()},onMouseEnter:()=>k.setActiveIndex(e),onMouseLeave:()=>k.setActiveIndex(void 0),children:s.jsxs("div",{className:"flex items-center",ref:a,children:[s.jsxs("div",{className:"relative grow overflow-hidden whitespace-nowrap",children:[s.jsx("div",{className:i.titleClassName,children:s.jsx(H,{text:n.title&&n.title.length>0?n.title:J(r),textToHighlight:o.length>=3?o:void 0,highlightClassName:i.titleHighlightedClassName})}),s.jsx("div",{className:j("pt-1",i.messageClassName),children:s.jsx(H,{text:n.snippet??"",textToHighlight:o.length>=3?o:void 0,shouldAdjustStart:!0,highlightClassName:i.messageHighlightedClassName})})]}),f&&s.jsx("div",{className:"text-token-text-secondary ps-6 text-xs",children:u})]})})})}function E(){return l.useMemo(()=>({closeFannyPackModal:t=>{N.logClose(t),k.setIsActive(!1)}}),[])}function O(){const t=K(),e=Y(),{closeFannyPackModal:a}=E();return l.useCallback(n=>{e&&ae.closeActiveSidebar(),t(n),a("click")},[t,a,e])}function Re(){const{conversations:t}=oe(l.useMemo(()=>({}),[])),e=q(),{closeFannyPackModal:a}=E(),n=G(e,"550560761").value,c=Number(n?.history_results_limit??6),o=l.useMemo(()=>t.slice(0,Math.min(t.length,c)),[t,c]),r=ge(o,0),u=O(),i=K(),g=l.useMemo(()=>({kind:"newChat",onSelect:()=>{ye(i),a("button")}}),[i,a]);return l.useMemo(()=>{const x=[g];return x.push(...[r.recent,r.dynamicMonths,r.dynamicYears].reduce((m,p)=>(Object.entries(p).forEach(([y,{items:d,label:v}])=>{d.length>0&&(m.push({kind:"label",text:v}),d.forEach(w=>{m.push({kind:"history",onSelect:()=>{u(U(w.id))},item:w})}))}),m),[])),x},[g,r,u])}async function Fe({query:t,cursor:e}){return re.safeGet("/conversations/search",{parameters:{query:{query:t,cursor:e}}})}function Ee(){const t=C(h=>h.query),e=O(),[a,n]=l.useState(""),[c,o]=l.useState(!1),r=l.useRef(ce(h=>{o(!1),n(h)},250)).current,u=l.useCallback(h=>{h!==a&&(o(!0),r(h))},[a,r]);l.useEffect(()=>{u(t)},[t,u]);const{data:i,isError:g,isLoading:f,isFetchingNextPage:x,hasNextPage:m,fetchNextPage:p}=Z({queryKey:["conversationSearch",{query:a}],queryFn:({pageParam:h})=>Fe({query:a,cursor:h}),initialPageParam:"",getNextPageParam:h=>h.cursor??void 0,enabled:!!a});l.useEffect(()=>{f&&N.logQuery()},[f]),l.useEffect(()=>{g&&N.logQueryError()},[g]),l.useEffect(()=>{x&&N.logQueryMore()},[x]);const y=l.useMemo(()=>i?.pages.flatMap(h=>h.items)??[],[i]),d=l.useCallback(h=>{if(f||h==null)return;const b=new IntersectionObserver(W=>{W[0].isIntersecting&&!x&&m&&p()});return b.observe(h),()=>{b.disconnect()}},[f,x,m,p]),v=y&&a===t,w=t.length>0&&(c||f||x),S=q(),M=G(S,"550560761").value,T=Number(M?.local_results_limit??0),I=fe(t,T),_=l.useMemo(()=>{const h=I;return v&&y.forEach(b=>{h.has(b.conversation_id)||h.set(b.conversation_id,{conversationId:b.conversation_id,nodeId:b.current_node_id,title:b.title,isArchived:b.is_archived,updateTime:b.update_time,snippet:b.payload.snippet,source:"remote"})}),Array.from(h.values())},[I,y,v]);return{searchResults:l.useMemo(()=>_.map(h=>({kind:"search",onSelect:()=>{e(`${U(h.conversationId)}?src=history_search`)},item:h,query:t})),[_,e,t]),shouldShowLoading:w,infiniteScrollTriggerElementRef:d}}function Ie(t,e,a){switch(t.kind){case"history":return s.jsx(be,{historyResult:t,index:e});case"label":return s.jsx(je,{labelResult:t});case"loading":return s.jsx(Le,{loadingResults:t});case"newChat":return s.jsx(Ne,{newChatResult:t,query:t.query,index:e});case"noResults":return s.jsx(De,{});case"search":return s.jsx(Pe,{searchResult:t,index:e,elementRef:a})}}function _e(t,e){const a=l.useCallback(()=>{for(let o=(t??-1)+1;o<e.length;o++)if(e[o].onSelect)return o;return t},[t,e]),n=l.useCallback(()=>{for(let o=(t??e.length)-1;o>=0;o--)if(e[o].onSelect)return o;return t},[t,e]),c=l.useCallback(()=>{t!==void 0&&e[t]&&e[t].onSelect&&e[t].onSelect()},[t,e]);l.useEffect(()=>{const o=r=>{r.isComposing||(r.key==="ArrowUp"&&!r.shiftKey?k.setActiveIndex(n()):r.key==="ArrowDown"&&!r.shiftKey?k.setActiveIndex(a()):(r.key==="Enter"||r.key==="Return")&&(r.preventDefault(),c()))};return window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)}},[n,a,c]),l.useEffect(()=>{const o=()=>{me.getMouseInteractionsDisabled()&&k.setMouseInteractionsDisabled(!1)};return window.addEventListener("mousemove",o),()=>{window.removeEventListener("mousemove",o)}},[])}function Ae(t,e){const a=l.useRef([]);return l.useEffect(()=>{a.current=e.map(()=>ee.createRef())},[e]),l.useEffect(()=>{a.current.forEach((n,c)=>{t===c&&n?.current&&n.current.scrollIntoView({behavior:"instant",block:"nearest"})})},[t,a]),a}function De(){return s.jsx(F,{className:"text-token-text-tertiary text-sm",icon:s.jsx(le,{className:"icon"}),children:s.jsx(B,{id:"FannyPack.Noresults",defaultMessage:"No results"})})}function P(){return s.jsx(F,{icon:s.jsx("div",{className:"loading-results-shimmer bg-token-main-surface-secondary h-[14px] w-[14px] rounded-full"}),children:s.jsxs("div",{className:"flex min-h-[40px] flex-col justify-center",children:[s.jsx("div",{className:"loading-results-shimmer bg-token-main-surface-secondary h-2 w-1/4 rounded-full"}),s.jsx("div",{className:"loading-results-shimmer bg-token-main-surface-secondary mt-3 h-2 w-1/2 rounded-full"})]})})}function Le({loadingResults:t}){return t.shouldShowMultiple?s.jsxs(s.Fragment,{children:[s.jsx(P,{}),s.jsx(P,{}),s.jsx(P,{}),s.jsx(P,{}),s.jsx(P,{})]}):s.jsx(P,{})}function qe(){const t=O(),{searchResults:e,shouldShowLoading:a,infiniteScrollTriggerElementRef:n}=Ee(),c=Re(),o=C(d=>d.query),r=o.length>0,u=q(),i=Q(u,"1741586789");l.useEffect(()=>{N.setQuerySessionId(z())},[o]);const g=l.useMemo(()=>({kind:"newChat",query:o,onSelect:()=>{t(`/?q=${o}`)}}),[o,t]),f=l.useMemo(()=>{const d=[];return o&&i&&d.push(g),r?d.push(...e):d.push(...c),a?d.push({kind:"loading",shouldShowMultiple:d.length===0}):d.length===0&&d.push({kind:"noResults"}),d},[o,i,g,r,a,e,c]),x=C(d=>d.activeIndex);_e(x,f);const m=Ae(x,f),p=l.useRef(null);l.useEffect(()=>{k.setActiveIndex(0),p.current&&(p.current.scrollTop=0)},[o]);const y=l.useRef(!0);return l.useEffect(()=>{y.current&&!a&&f.length===1&&f[0].kind==="noResults"&&N.logNoResults(),y.current=a},[a,f]),s.jsx("div",{ref:p,children:s.jsx("ol",{className:"mx-2",children:f.map((d,v)=>s.jsx("li",{ref:m.current[v],children:Ie(d,v,v===f.length-1?n:void 0)},v))})})}function Ve(){"use forget";const t=R.c(3),e=C(Te),a=Y();let n;return t[0]!==e||t[1]!==a?(n=a?s.jsx(Qe,{isOpen:e}):s.jsx(Oe,{isOpen:e}),t[0]=e,t[1]=a,t[2]=n):n=t[2],n}function Te(t){return t.isActive}function Be(t){"use forget";const e=R.c(9),{onClick:a,className:n}=t,c=L();let o;e[0]!==n?(o=j("hover:bg-token-main-surface-secondary focus-visible:ring-token-text-quaternary dark:hover:bg-token-main-surface-tertiary flex items-center justify-center rounded-full bg-transparent p-1 focus-visible:ring-2 focus-visible:ring-offset-1 focus-visible:ring-offset-transparent focus-visible:outline-hidden",n),e[0]=n,e[1]=o):o=e[1];let r;e[2]!==c?(r=c.formatMessage({id:"Px7S/2",defaultMessage:"Close"}),e[2]=c,e[3]=r):r=e[3];let u;e[4]===Symbol.for("react.memo_cache_sentinel")?(u=s.jsx(de,{className:"icon text-token-text-tertiary hover:text-token-text-primary"}),e[4]=u):u=e[4];let i;return e[5]!==a||e[6]!==o||e[7]!==r?(i=s.jsx("button",{className:o,"aria-label":r,onClick:a,children:u}),e[5]=a,e[6]=o,e[7]=r,e[8]=i):i=e[8],i}function X(t){"use forget";const e=R.c(21),{className:a}=t,{closeFannyPackModal:n}=E(),c=q();let o;e[0]!==c?(o=ue(c),e[0]=c,e[1]=o):o=e[1];const r=o,u=l.useRef(!1);let i;e[2]!==c?(i=Q(c,"3678527908"),e[2]=c,e[3]=i):i=e[3];const g=i;let f;e[4]!==c?(f=Q(c,"1422501431"),e[4]=c,e[5]=f):f=e[5];const x=f;let m,p;e[6]!==r||e[7]!==g||e[8]!==x?(m=()=>{!u.current&&g&&r&&(x?$.setCurrentAccountV2(r):$.setCurrentAccount(r),u.current=!0)},p=[g,r,x],e[6]=r,e[7]=g,e[8]=x,e[9]=m,e[10]=p):(m=e[9],p=e[10]),l.useEffect(m,p);let y;e[11]!==a?(y=j("flex flex-col",a),e[11]=a,e[12]=y):y=e[12];let d;e[13]===Symbol.for("react.memo_cache_sentinel")?(d=s.jsx(we,{}),e[13]=d):d=e[13];let v;e[14]!==n?(v=s.jsxs("div",{className:"ms-3 me-4 flex max-h-[64px] min-h-[64px] items-center justify-between",children:[d,s.jsx(Be,{className:"ms-4",onClick:()=>{n("button")}})]}),e[14]=n,e[15]=v):v=e[15];let w;e[16]===Symbol.for("react.memo_cache_sentinel")?(w=s.jsx("hr",{className:"border-token-border-default"}),e[16]=w):w=e[16];let S;e[17]===Symbol.for("react.memo_cache_sentinel")?(S=s.jsx("div",{className:"my-2 grow overflow-y-auto",children:s.jsx(qe,{})}),e[17]=S):S=e[17];let M;return e[18]!==y||e[19]!==v?(M=s.jsxs("div",{className:y,children:[v,w,S]}),e[18]=y,e[19]=v,e[20]=M):M=e[20],M}function Qe(t){"use forget";const e=R.c(6),{isOpen:a}=t,{closeFannyPackModal:n}=E();let c;e[0]!==n?(c=()=>{n("modal")},e[0]=n,e[1]=c):c=e[1];let o;e[2]===Symbol.for("react.memo_cache_sentinel")?(o=s.jsx(X,{}),e[2]=o):o=e[2];let r;return e[3]!==a||e[4]!==c?(r=s.jsx(ie,{testId:"modal-fanny-pack-mobile",isOpen:a,onClose:c,size:"fullscreen",showCloseButton:!0,type:"success",noPadding:!0,children:o}),e[3]=a,e[4]=c,e[5]=r):r=e[5],r}function Oe(t){"use forget";const e=R.c(6),{isOpen:a}=t,{closeFannyPackModal:n}=E();let c;e[0]!==n?(c=()=>{n("modal")},e[0]=n,e[1]=c):c=e[1];let o;e[2]===Symbol.for("react.memo_cache_sentinel")?(o=s.jsx(X,{className:"max-h-[440px] min-h-[440px]"}),e[2]=o):o=e[2];let r;return e[3]!==a||e[4]!==c?(r=s.jsx(pe,{className:"border-token-border-default border bg-clip-padding shadow-[0_14px_62px_0_rgba(0,0,0,0.25)] md:max-w-[680px] md:min-w-[680px]",isOpen:a,onClose:c,showCloseButton:!0,type:"success",noPadding:!0,showOverlayBackground:!1,shadow:"custom",children:o}),e[3]=a,e[4]=c,e[5]=r):r=e[5],r}export{Ve as FannyPackModalContainer};
//# sourceMappingURL=ikxbgsi4dgnqcp3n.js.map
