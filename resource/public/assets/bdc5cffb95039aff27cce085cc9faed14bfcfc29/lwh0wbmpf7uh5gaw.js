const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/nbfwjt2tjaxib537.js","assets/dmck639k4dv7claj.js","assets/cs7toih8jegb7teq.js","assets/root-mdlgku96.css","assets/hnw079jsdm76umup.js","assets/conversation-small-b5ztx8w5.css","assets/mchhvm2d4el3keo0.js","assets/gt1ksg7rjkl5obl2.js","assets/jowyjrirlo5h1pme.js","assets/icf9zxqo8pqfufc0.js","assets/j016trxwqzgsccq0.js","assets/lrrqf1wrtr1tx2vp.js","assets/dm5zsc5m2410ngxk.js","assets/ec6gizbh044so065.js"])))=>i.map(i=>d[i]);
import{r as i,j as e,M as V,d as ut,R as Oa,b as La,A as Ba}from"./cs7toih8jegb7teq.js";import{aw as ge,ax as me,cx as as,g as Fe,dq as x,h3 as gt,T as y,nb as Hs,bt as D,kw as Wa,z as O,pG as mt,t as qa,nd as $a,aF as oe,dE as X,eJ as ns,aI as ue,j5 as za,e1 as ht,B as pt,hI as ft,R as Ka,aA as Qa,dd as Vs,a0 as Os,e as Ne,ep as Ls,bh as Ja,q as bt,gf as Xa,F as xt,ot as Ya,by as Za,cR as en,u as sn,d as tn,nW as Xe,h_ as an,aL as nn,mj as on,p as ae,aZ as rn,H as Ae,b6 as ln,k8 as dn,f1 as cn,dI as un,b5 as gn,m_ as mn,mX as hn,m$ as pn,nc as fn,mY as bn,eo as os,fD as Bs,aG as xn,aM as Tn,P as Ye,eD as vn,oG as _n,f6 as In,iU as Mn,gG as Pe,pH as Sn,bm as yn,pI as wn,h7 as Cn,h8 as En,cG as Rn,c2 as kn,jJ as je,km as Pn,pJ as rs,hi as jn,b3 as An,aK as Fn,pK as Ws,gg as is,e8 as Ze,mV as Nn,pL as Un,gF as Dn,r as Gn,hG as Hn,a$ as Vn}from"./dmck639k4dv7claj.js";import{gn as On,go as qs,gp as Ln,gq as $s,gr as Bn,gs as Wn,gt as qn,gu as $n,gv as zn,gw as Kn,gx as Qn,gy as zs,gz as Jn,cp as Ks,gA as Xn,aM as Yn,gB as Zn,am as eo,gC as so,gD as Qs,gE as to,aN as Js,gF as ao,gG as no,gH as oo,gI as ro,gJ as io,gK as lo,gL as co,gM as uo,gN as go,gO as mo,gP as ho,gQ as Tt,gR as po,gS as fo,gT as bo,gU as xo,gV as To,gW as vo,gX as _o,gY as Io,gZ as Mo,g_ as So,g$ as Xs,h0 as yo,h1 as wo,h2 as Co,h3 as Eo,h4 as Ro,h5 as ko,h6 as Po,h7 as jo,h8 as Ao,h9 as Fo,ha as No,hb as Uo,hc as Do,aq as Ys,hd as Go,he as Ho,hf as Vo,hg as vt,hh as _t,hi as It,hj as Oo,hk as Lo,hl as Bo,hm as Wo,hn as qo,ho as $o,hp as es}from"./hnw079jsdm76umup.js";import{C as ss}from"./nlxagrvvx9r77jf7.js";const Zs=ge(()=>me(()=>import("./nbfwjt2tjaxib537.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(n=>n.MemoryActionResult));function et(n,t,o){X(n,s=>{ns.updateTree(s,r=>{r.updateNodeMetadata(t,{inlineComparisonRating:o})})})}const st=({messages:n})=>{for(const{metadata:t}of n){const{paragen_display_label:o}=t??{};if(o)return o;const{augmented_paragen_prompt_label:s}=t??{};if(s)return s}};function zo(n){const t=i.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),o=i.useRef({left:null,right:null});return n.variantIds.length<2?e.jsx(Mt,{setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:t,firstVisibleTokenTimestampsRef:o,...n}):e.jsx(Ko,{...n,visibilityStateRef:t,firstVisibleTokenTimestampsRef:o})}function Ko(n){const{clientThreadId:t,variantIds:o,turnIndex:s,firstVisibleTokenTimestampsRef:r}=n;if(o.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const g=mt(),m=qa(),[l,c]=o,u=i.useMemo(()=>$a(l+c)()>=.5,[l,c]),[p,C]=u?[c,l]:[l,c],[R,k,T]=oe(t,P=>{const G=Vs(P).tree.getLeafFromNode(p).id,M=Vs(P).tree.getLeafFromNode(C).id,b=y.getConversationTurns(P,G),I=y.getConversationTurns(P,M),F=s<b.length?b[s]:null,d=s<I.length?I[s]:null;return F||Os.addError(`Paragen Left turn index ${s} out of bounds`,{turnIndex:s,turnCount:b.length,lastTurnRole:x(b)?.role,lastMessageAuthor:x(x(b)?.messages)?.author,lastMessageContentType:x(x(b)?.messages)?.content.content_type,lastMessageMetadata:x(x(b)?.messages)?.metadata,altTurnCount:I.length,altLastTurnRole:x(I)?.role,altLastMessageRole:x(x(I)?.messages)?.author.role}),d||Os.addError(`Paragen Right turn index ${s} out of bounds`,{turnIndex:s,turnCount:I.length,lastTurnRole:x(I)?.role,lastMessageAuthor:x(x(I)?.messages)?.author,lastMessageContentType:x(x(I)?.messages)?.content.content_type,lastMessageMetadata:x(x(I)?.messages)?.metadata,altTurnCount:b.length,altLastTurnRole:x(b)?.role,altLastMessageRole:x(x(b)?.messages)?.author.role}),[G,F,d]}),[N,A]=u?[T,k]:[k,T],$="skippable_parallel_2_in_stream:a:1.5";i.useEffect(()=>($s.setState({displayingSideBySideFeedback:!0}),()=>{$s.setState({displayingSideBySideFeedback:!1})}),[]);const re=i.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),h=i.useCallback((P,{shouldSubmitParagenFeedback:G=!0}={})=>{if(!k||!T||!N||!A)throw new Error("Expected both turns to exist");X(t,v=>{ns.setCurrentBranch(v,P)});const M=P===p,b=P===l;N.messages.length>0&&et(t,N.messages[N.messages.length-1].id,b?"original":"new"),A.messages.length>0&&et(t,A.messages[A.messages.length-1].id,b?"original":"new");const I=ue(t),F=[k,T].map((v,z)=>({messageId:v.messages[v.messages.length-1].id,loadFirstTokenTime:z===0?r.current.left:r.current.right,loadEndTime:x(v.messages)?.clientMetadata?.completionSampleFinishTime})),d=M?F[0].messageId:F[1].messageId,S=y.getParentPromptNode(Fe(t),R);if(!S)throw new Error("Expected prompt for side by side feedback");const B={},Y=S.message.clientMetadata?.variantsInStreamInfo==null&&S.message.metadata?.paragen_variants_info!=null;for(const v of F)B[v.messageId]=Y?{load_first_token_time:n.conversationTurnMountTime,load_end_time:n.conversationTurnMountTime}:{load_first_token_time:v.loadFirstTokenTime,load_end_time:v.loadEndTime};G&&rt({params:{conversation_id:I,displayed_message_ids:F.map(v=>v.messageId),message_metadatas:B,rating:"selected",selected_message_id:d,source_timestamp:Date.now(),ui_variant:1,user_prompt_message_id:S.message.id}})},[t,p,l,N,A,k,T,R,r,n.conversationTurnMountTime]);return i.useEffect(()=>za(ht,{requestCompletion:P=>{const G=ue(t),M=y.getParentPromptNode(Fe(t),R);if(!M)throw new Error("Expected prompt for side by side feedback");if(!k||!T)throw new Error("Expected both turns to exist");const b=[k,T].map((S,B)=>({messageId:S.messages[S.messages.length-1].id,loadFirstTokenTime:B===0?r.current.left:r.current.right,loadEndTime:x(S.messages)?.clientMetadata?.completionSampleFinishTime})),I={},F=M.message.clientMetadata?.variantsInStreamInfo==null&&M.message.metadata?.paragen_variants_info!=null;for(const S of b)I[S.messageId]=F?{load_first_token_time:n.conversationTurnMountTime,load_end_time:n.conversationTurnMountTime}:{load_first_token_time:S.loadFirstTokenTime,load_end_time:S.loadEndTime};const d=P.isForSkippingParagen;rt({params:{conversation_id:G,displayed_message_ids:b.map(S=>S.messageId),message_metadatas:I,rating:d?"explicit_skipped":"skipped",selected_message_id:null,source_timestamp:Date.now(),ui_variant:d?3:1,user_prompt_message_id:M.message.id}}),d&&h(p,{shouldSubmitParagenFeedback:!1})}}),[k,T,R,t,n.conversationTurnMountTime,$,N?.messages,A?.messages,m,r,h,p]),e.jsx(Mt,{...n,setPreferredFeedback:h,leftVariantId:p,rightVariantId:C,leftTurn:k,rightTurn:T,hasActiveRequest:g,originalTurn:N,visibilityStateRef:re})}function Mt({setPreferredFeedback:n,leftVariantId:t,rightVariantId:o,leftTurn:s,rightTurn:r,hasActiveRequest:g,originalTurn:m,visibilityStateRef:l,...c}){const u=(s&&st(s))??null,p=(r&&st(r))??null,C=i.useMemo(()=>s?.messages??[],[s?.messages]),R=i.useMemo(()=>r?.messages??[],[r?.messages]),{avatarClassName:k,firstVisibleTokenTimestampsRef:T}=c,N=i.useMemo(()=>s?.messageGroups??[],[s?.messageGroups]),A=i.useMemo(()=>r?.messageGroups??[],[r?.messageGroups]),$=On(),re=Fe(c.clientThreadId),h=x(s?.messages),P=x(r?.messages),G=gt(y.getRequestId(re,h?.id??P?.id)),M=G&&!h?.end_turn,b=G&&!P?.end_turn,I=h!=null&&Hs(h),F=P!=null&&Hs(P),d=I??F,S=s?.role===D.User,B=r?.role===D.User,Y=i.useRef(null),v=i.useRef(null),z=i.useRef(null),he=s!=null,j=r!=null;!he&&T.current.left==null&&(T.current.left=Date.now()),!j&&T.current.right==null&&(T.current.right=Date.now()),i.useEffect(()=>{if(Y.current&&v.current&&z.current){const Ue=Array(11).fill(0).map((pe,W)=>W/10),H=new IntersectionObserver(pe=>pe.forEach(W=>{W.target===v.current?(l.current.left_visibility_initial==null&&(l.current.left_visibility_initial=W.intersectionRatio),l.current.left_visibility_max=Math.max(l.current.left_visibility_max??0,W.intersectionRatio)):W.target===z.current&&(l.current.right_visibility_initial==null&&(l.current.right_visibility_initial=W.intersectionRatio),l.current.right_visibility_max=Math.max(l.current.right_visibility_max??0,W.intersectionRatio))}),{root:Y.current,threshold:Ue});return H.observe(v.current),H.observe(z.current),()=>H.disconnect()}},[l]);const{data:ie}=Wa(void 0,!1,$);return e.jsxs("div",{className:"relative flex flex-col",children:[e.jsx("div",{className:"bg-token-main-surface-primary sticky top-[-1px] z-1 px-(--thread-content-margin) text-center text-lg text-pretty md:static","data-testid":"paragen-feedback-title",children:e.jsx(V,{id:"KKeSJV",defaultMessage:"You're giving feedback on a new version of ChatGPT."})}),e.jsx("div",{className:"text-token-text-secondary px-(--thread-content-margin) pt-1 pb-5 text-center text-sm text-pretty",children:e.jsx(V,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})}),e.jsx("div",{className:O(Ln("default"),"horzScrollShadows relative -mb-2 snap-x snap-mandatory overflow-x-auto overflow-y-clip pb-4"),ref:Y,children:e.jsxs("div",{className:O("mx-auto box-content max-w-[calc(2*var(--thread-content-max-width))] min-w-min px-(--thread-content-margin)","flex items-start gap-4 sm:gap-6"),children:[e.jsxs(tt,{rootElementRef:v,onClick:()=>{n(t)},hasActiveRequest:g,isImageGenInProgress:d,children:[e.jsxs(nt,{children:[e.jsx(qs,{messages:C,isUserTurn:S,avatarClassName:k}),e.jsx(at,{children:e.jsx(V,{...it.responseNumber,values:{responseIndex:1,display_label:u?` ${u}`:""}})})]}),e.jsxs(e.Fragment,{children:[ie!=null&&!S&&e.jsx(Zs,{clientThreadId:c.clientThreadId,messages:C,isParagen:!0}),e.jsx(ss,{...c,allMessages:C,groupedMessagesToRender:N,allGroupedMessages:N,isUserTurn:S,isFinalUserTurn:!1,isFinalAssistantTurn:!1,isCompletionRequestInProgress:M,hasActiveRequest:g,shouldGrowContainer:!1,isParagen:!0}),e.jsx(ot,{clientThreadId:c.clientThreadId,conversationTurnMountTime:c.conversationTurnMountTime,turn:s,originalTurn:m})]})]}),e.jsxs(tt,{rootElementRef:z,onClick:()=>{n(o)},hasActiveRequest:g,isImageGenInProgress:d,children:[e.jsxs(nt,{children:[e.jsx(qs,{messages:R,isUserTurn:B,avatarClassName:k}),e.jsx(at,{children:e.jsx(V,{...it.responseNumber,values:{responseIndex:2,display_label:p?` ${p}`:""}})})]}),e.jsxs(e.Fragment,{children:[ie!=null&&!B&&e.jsx(Zs,{clientThreadId:c.clientThreadId,messages:R,isParagen:!0}),e.jsx(ss,{...c,allMessages:R,groupedMessagesToRender:A,allGroupedMessages:A,isFinalUserTurn:!1,isFinalAssistantTurn:!1,isUserTurn:B,isCompletionRequestInProgress:b,hasActiveRequest:g,shouldGrowContainer:!1,isParagen:!0}),e.jsx(ot,{clientThreadId:c.clientThreadId,conversationTurnMountTime:c.conversationTurnMountTime,turn:r,originalTurn:m})]})]})]})})]})}function tt({rootElementRef:n,onClick:t,children:o,hasActiveRequest:s,isImageGenInProgress:r}){const g=i.useRef(null),m=i.useRef(null),l=i.useRef(null);return e.jsx("div",{"data-paragen-root":!0,className:"border-token-border-tertiary @container relative flex min-w-[min(450px,80cqw,80vw)] flex-1 snap-center flex-col gap-1 rounded-xl border text-start shadow-lg shadow-black/3",ref:n,children:e.jsxs("div",{className:O(Bn,"px-(--thread-content-margin) py-4"),children:[e.jsx("div",{className:O("absolute top-48 right-0! left-0! h-px","invisible"),ref:g}),e.jsx("div",{className:O("absolute top-48 right-0! bottom-0 left-0!","invisible"),ref:m}),e.jsx("div",{className:O("absolute right-0! bottom-0 left-0! h-px","invisible"),ref:l}),o,s||r?null:e.jsx(pt,{className:"mt-4 self-start",onClick:t,"data-testid":"paragen-prefer-response-button",children:e.jsx(V,{id:"U2EAH6",defaultMessage:"I prefer this response"})})]})})}const at=as.div`text-sm text-token-text-secondary font-semibold`,nt=as.div`flex gap-4 items-center mb-1`;function ot({clientThreadId:n,conversationTurnMountTime:t,turn:o,originalTurn:s}){const r=ft();if(!r.showParagenMetadata||!r.showDebugConversationTurns&&!r.forceParagen||o==null)return null;let g=o===s?"ORIGINAL":"NEW";const m=o.messages[o.messages.length-1],l=m?.metadata?.__internal,c=m?.metadata?.paragen_display_label;if(l){const{model_id:C,model_definition_slug:R,model_definition_virtual_model_id:k,alternative_model_selection_rule:T,augmented_paragen_prompt_group_id:N,augmented_paragen_prompt_id:A,augmented_paragen_prompt:$}=l;C&&(g+=`
Model ID: ${C}`),R&&(g+=`
Model Slug: ${R}`),k&&(g+=`
Virtual Model ID: ${k}`),T&&(g+=`
Alternative Model Rule: ${T}`),N&&(g+=`
Prompt Group ID: ${N}`),A&&(g+=`
Prompt ID: ${A}`),$&&(g+=`
Prompt: ${$}`),c&&(g+=`
Display Label: ${c}`)}g+=`
Message ID: ${m.id}`;const u=y.getParentPromptNode(Fe(n),o.messages[0].id);if(!u)throw new Error("Expected prompt for side by side feedback");const p=u.message.clientMetadata?.variantsInStreamInfo==null&&u.message.metadata?.paragen_variants_info!=null;return g+=`
User prompt message ID: ${u.message.id}`,g+=`
Is Persisted Paragen? ${p}`,g+=`
Completion Sample Finish Time: ${p?`${t} (persisted)`:x(o.messages)?.clientMetadata?.completionSampleFinishTime}`,e.jsx("div",{className:"text-sm whitespace-pre-wrap text-red-500",children:g})}async function rt({params:n}){await Ka.safePost("/paragen_submission",{requestBody:n,authOption:Qa.SendIfAvailable})}const it=ut({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}{display_label}"}}),Qo=ge(()=>me(()=>import("./nbfwjt2tjaxib537.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(n=>n.MemoryActionResult)),Jo=ge(()=>me(()=>import("./icf9zxqo8pqfufc0.js"),__vite__mapDeps([9,2,1,3,10,4,5,11])).then(n=>n.AutomationSourceHeader)),lt=ge(()=>me(()=>import("./dm5zsc5m2410ngxk.js"),__vite__mapDeps([12,2,1,3,4,5,13])).then(n=>n.TextMessageEditor)),Xo=ge(()=>me(()=>import("./hnw079jsdm76umup.js").then(n=>n.wj),__vite__mapDeps([4,1,2,3,5])).then(n=>n.ChatScreenRetrievalResultsFlyoutContent)),dt=80,ct=16;function ts(){return{minHeight:`calc(100dvh - ${Do}px - 120px)`}}function Yo(n){const{turnIndex:t,isFinalTurn:o,clientThreadId:s,onRequestCompletion:r,currentModelId:g,scrollToMessageId:m,dateHeaderType:l,hideUserActions:c}=n,u=Ne(),p=Ls(u,s),C=Wn(u),R=Ja(),[k,T]=bt(a=>[Xa(a),xt(a)]),N=!!R&&Ya(R),A=Za(en.isBusinessWorkspace),$=Uo(),{eligible:re}=sn(tn.hasSeenAudioParagenPrompt),[h,P,G]=oe(s,a=>{const _=y.getConversationTurnAtIndex(a,t),w=t>0?y.getConversationTurnAtIndex(a,t-1):null,f=w?.role===D.User&&w.messages.some(U=>U.metadata?.visually_hide_response_from_conversation);return[_,f,w]},{disablePerfDetector:o}),{messages:M,messageGroups:b}=h,I=qn(a=>a.size===0?-1:b.findIndex(_=>_.type===Xe?_.groups.some(w=>w.messages.some(f=>a.has(f?.id))):_.messages.some(w=>a.has(w?.id)))),F=M[0],d=x(M),S=i.useMemo(()=>b.some(a=>a.type===an.SearchGPTQuery),[b]),[B,Y]=i.useState(!1),v=i.useMemo(()=>M.some(a=>a.metadata?.n7jupd_message),[M]),z=i.useMemo(()=>v?nn(M,a=>a.author.name==="n7jupd.metadata"):null,[M,v]),he=!!z?.metadata?.kaur1br5_mode,{messages:j,visibleMessages:ie,messageGroups:Ue,lastMessageToRender:H}=i.useMemo(()=>{const a=I!==-1&&I+1<b.length,_=a?b.slice(0,I+1):b,w=a?_.flatMap(f=>f.type===Xe?f.groups.flatMap(U=>U.messages):f.messages):M;return{messages:w,visibleMessages:w.filter(on),messageGroups:_,lastMessageToRender:x(w)}},[M,b,I]),pe=I!==-1,W=ae(u,"1887864177"),St=$n(),fe=oe(s,a=>y.getLastMessageSystemHints(a)),yt=rn(),De=fe?.includes(Ae.Tatertot)&&ae(u,"28816792")&&yt,{capabilitySuggestionsEnabled:wt}=zn(De),ls=i.useMemo(()=>({clientThreadId:s,turnIndex:t,messageId:d?.id}),[s,t,d?.id]),[ds,cs]=i.useState(!1),[us,Ct]=i.useState(!1),Et=i.useContext(Kn)!=null,E=h.role===D.User,gs=ln(),Z=dn(s),Ge=h.gizmoId??Z,He=cn(Ge).data,Ve=Ge&&!un(Ge)?He:void 0,Rt=Ve&&h.gizmoId!=null&&h.gizmoId!==Z&&ae(u,"1418300125"),Oe=gn(s),kt=mn(s),be=hn(Oe),Pt=pn(Oe,kt),Le=fn(),[Be,jt,At,ms,We,Ft,qe,Nt,hs,Ut,K,xe,Te,Dt,Gt,Q]=oe(s,a=>{const _=y.getParentPromptNode(a,F.id),w=_?.message.clientMetadata?.variantsInStreamInfo??(_?.message.metadata?.paragen_variant_choice?void 0:_?.message.metadata?.paragen_variants_info),f=y.getVariantIds(a,F.id),U=y.getCurrentVariantId(a,F.id),te=U?f.indexOf(U):0,Ha=w&&a?.tree!=null&&f.some(J=>{const{errType:Gs}=a.tree.getLeafFromNode(J).message.clientMetadata??{};return Gs!=null&&Gs!=="info"}),ke=y.getConversationTurns(a),Va=Ys(ke,J=>J.role===D.Assistant);return[_,y.isMessageTurnEnded(a,d?.id),Ha,Un(a?.mode,He?.gizmo.id),ke.findIndex(J=>J.role===D.User)===t,Ys(ke,J=>J.role===D.User)===t,ke.findIndex(J=>J.role===D.Assistant)===t,Va===t,y.getRequestId(a,d?.id),w,f,te,!!a?.continuingFromSharedPostId,a?.currentLeafId,y.getSuperWidgetMessages(a,t)[0],y.lastUserMessage(a)]},{disablePerfDetector:o}),ve=bn(),_e=os(()=>{const a=Dn(p);return a?.value===Pe.STREAMING||a?.value===Pe.REALTIME}),Ht=j.some(a=>a.content.content_type===Bs.MultimodalText),Vt=xn(u,"3119715334").get("should-enable-skip",!1),{isUnauthenticated:ps}=Tn(),fs=h.messages.map(a=>a.id),L=i.useRef(null);Zo({clientThreadId:s,turn:h,turnIndex:t,conversationTurnWrapperRef:L});const bs=!C&&(m?.length??0)>2&&m!=="finalAgentTurn"&&o&&$,Ie=E?x(ie):void 0,$e=Ie?.id,Ot=i.useCallback(()=>{$e&&(Ye.logEvent("Edit Prompt",{id:$e,threadId:ue(s)}),vn(u,"chatgpt_edit_prompt"),cs(!0))},[u,$e,s]),Lt=i.useCallback(()=>{cs(!1)},[]),{hasConnections:xs}=_n(),{onChangeRating:Bt}=Qn({clientThreadId:s,currentModelConfig:Oe}),Wt=a=>{if(!d)return;const _=d.clientMetadata?.rating,f=(_==="thumbs_up"?"thumbsUp":_==="thumbs_down"?"thumbsDown":_)===a?null:a;if(Bt({nodeId:d.id,messageId:d.id,rating:f}),f){const U=xs&&b.some(te=>te.type!==Xe&&te.messages?.some(Nn));Ye.logEventWithStatsig(f==="thumbsDown"?"Message Feedback Thumbs Down Clicked":"Message Feedback Thumbs Up Clicked","chatgpt_thumb_feedback",{id:d.id,threadId:ue(s),model:g,rating:f,...xs?{isCATriggered:U}:{},...T?{isSidebar:!0}:{}})}Ct(f==="thumbsDown")},[qt]=i.useState(()=>Date.now()),$t=In(s),Ts=Mn(s)?.value,zt=Ts===Pe.STREAMING,Kt=Ts===Pe.REALTIME,Qt=hs!=null,Jt=gt(hs),Xt=zs.useState(a=>zs.isReplayInProgress(a,Dt)),q=!jt&&Jt||pe||Kt||Xt&&o,vs=mt(),_s=i.useRef(!1),Yt=Sn({clientThreadId:s}),Zt=Jn(s,d)&&!Yt,[,ea]=La(),{isOpen:Me}=Ks(),Is=Xn();i.useEffect(()=>{const _=new URLSearchParams(window.location.search).get("message");!(_!=null&&fs.includes(_))||!L.current||(L.current.scrollIntoView({behavior:"instant"}),ea(f=>(f.delete("message"),f),{replace:!0,preventScrollReset:!0}))},[]),i.useEffect(()=>{if(C)return;const w=new URLSearchParams(window.location.search).get("message")!=null;if(_s.current||w||m===void 0||!L.current||Is){m==="finalAgentTurn"&&o&&X(s,f=>{f.scrollToMessageId=void 0});return}(fs.includes(m)||m==="finalAgentTurn"&&o)&&(_s.current=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(L.current)if(m==="finalAgentTurn"&&o)L.current.scrollIntoView({behavior:"instant",block:"end"}),X(s,f=>{f.scrollToMessageId=void 0});else{const f=L.current.offsetHeight;let U=0;Me?U=-8:f>dt&&(U=dt-f);const te=Yn(Ls(u,s)).pinnedWidgetHeight$();te!=null&&(U+=te+ct),L.current.style.scrollMarginTop=`${U+ct}px`,L.current.scrollIntoView({behavior:"smooth"})}})}))},[m,L.current,Me,Is]);const{showDebugConversationTurns:sa}=ft(),ta=!ve&&!Te&&!gs&&!E,aa=H?.author.role===D.Assistant?H:null,na=H?.metadata?.system_hints?.includes(Ae.Research);Zn({isCompletionRequestInProgress:q,isUserTurn:E,message:aa});const{isOpen:oa}=Ks(),ra=eo(),Se=so(ms),ia=yn(a=>a.voiceFeedbackThread),Ms=$t===ia,la=d?.metadata?.async_source,ye=o&&Qt,ee=_e||q||zt,Ss=ie.length===0&&j.some(wn),we=!ds&&!Ss&&!ve&&!Te&&!Se&&!oa&&h.role!==D.Developer&&!(h.role===D.User&&c)&&!(o&&Ms&&ee)&&!(ye&&ee)&&!(o&&_e&&la)&&!(ee&&v)&&!d?.metadata?.is_auto_proceed_message&&!d?.metadata?.is_takeover_ended_message&&d?.content?.content_type!==Bs.SuperWidget,da=!we&&!(ye&&ee)&&(ve||Te)&&!T,ca=j.some(a=>Cn(a)===En.l1239dk1),ze=oe(s,a=>{const _=new Set;return y.getParentPromptNode(a,F.id)?.message.metadata?.attachments?.forEach(f=>{f.mime_type?.startsWith("image/")||_.add(f.context_connector_info?.context_connector??"file")}),_}),Ke=Rn(),Qe=kn(u,"110789670");let se;Ke.isLoading?se=void 0:Ke.canUpgradeGDrive&&ze.has(je.GDRIVE)&&Qe.get("enabled",!1)?se=je.GDRIVE:Ke.canUpgradeSharepoint&&ze.has(je.O365_BUSINESS)&&Qe.get("enabled",!1)?se=je.O365_BUSINESS:ze.has("file")&&Qe.get("enabled",!1)&&(se="general");const ua=ye&&!q&&!T&&!ve&&!Te&&!ca&&(W||St||wt||De||!!se),le=d!=null&&(!A||Pt||N||Le)&&!Se&&!ps&&!gs&&!d.metadata?.b1de6e2_s,ys=_e||q,[ga,ma]=i.useState(!1),ha=!!(Q?.metadata?.dictation&&Q?.metadata?.dictation_asset_pointer&&!Q?.metadata?.dictation_edited),pa=!!(!re||ga||Q?.metadata?.audio_paragen_result||Qs(Q?.id)),ws=ha&&!pa,Cs=ws&&(!A||Le)&&le&&!ys&&!T&&!Me&&Q!=null&&qe&&ae(u,"51772912"),fa=to(Q?.id,Cs),Es=Cs&&fa,Ce=!Se&&ta&&o&&Ut?.num_variants_in_stream===2&&K.length<=2&&!d?.clientMetadata?.inlineComparisonRating&&!At&&!ws&&!Qs(Q?.id),Rs=!Es&&(!A||Le)&&le&&(ye||o&&Ms)&&!ys&&!T&&!Me&&!v,ks=!((q||_e)&&o)&&K.length>1&&!Ce,Ps=E&&j.some(a=>Js(a)?.shouldHideContent),ba=E&&Ie!=null&&!Se&&!Ht&&!Ps&&!ps&&!na&&!T,xa=d!=null&&(d.clientMetadata?.disclaimers??[]).length===0&&!T,Ee=x(G?.messages.filter(Pn)),Ta=rs(u)&&qe&&(!fe||fe.length===0||fe.includes(Ae.Search)),js=i.useCallback(a=>{X(s,_=>{ns.setCurrentBranch(_,K[a])}),Ye.logEvent("Change Active Node",{intent:"toggle_between"}),ae(u,"4126691920")&&ao({parent_prompt_id:Be?.id??"",prev_branch_id:K[xe],next_branch_id:K[a]},ue(s))},[s,K,xe,Be?.id,u]),va=no(h,j,sa),{toggleThreadSidebar:As}=jn(),Re=d?.id,Fs=i.useCallback(()=>{Re&&As({type:"retrievalResults",clientThreadId:s,turnIndex:t,messageId:Re})},[Re,As,s,t]),_a=i.useMemo(()=>oo(h,be,!!Z),[be,Z,h]),Ia=i.useMemo(()=>ro(h,!!Z),[Z,h]),Ns=!1,Us=ae(u,"2137702454"),Ma=i.useMemo(()=>h.role!==D.User&&be&&Us||Ns,[h,be,Us,Ns]),Sa=i.useMemo(()=>j.some(a=>Js(a)?.canRetry===!1),[j]),ya=d?.metadata?.n7jupd_button_type,wa=v&&d!=null&&d.id!=null&&!ya,Ca=v&&o&&ee,Ea=v&&o;if(!va&&!Ce)return bs?e.jsx("div",{style:ts()}):null;if(P)return null;const Ra=H?.metadata?.followup_prompts?H.metadata.followup_prompts.map(a=>({text:a,type:An.Reply})):[],ka=H?.metadata?.category_suggestions,Pa=H?.metadata?.action_suggestions,ja=H?.metadata?.pineapple_tool_suggestions,Aa=!j.some(a=>Fn.getAudioAssetPointers(a).length>0)&&!Z&&!Sa,Fa=!q&&j.some(a=>a.author.role===D.Assistant&&a.metadata?.onboarding?.main_usages),Je=j.find(a=>!!a.metadata?.onboarding?.examples)?.metadata?.onboarding?.examples,Ds=!Ps&&(!o||!q),Na=j.filter(Ws);if(!o&&Na.length===0&&!v)return null;let de="none";E&&We&&(de="first");const Ua=G?.messages.some(Ws);E&&!We&&(Ua?de="large":de="none"),o&&(de="last");const Da=(()=>{if(E&&!we&&is(u)&&k)return"mb-4";if(E&&!we&&!T)return"mb-10";if(!E&&T&&o)return"pb-[40px]"})(),Ga=ae(u,"1424158285");return e.jsx(io.Provider,{value:qe,children:e.jsxs(lo,{children:[e.jsx(co,{dateHeaderType:l,turn:h}),e.jsxs("article",{className:O("text-token-text-primary w-full focus:outline-none",!C&&m==="finalAgentTurn"&&$?"opacity-0":"",{hidden:Et&&We},E?"scroll-mt-(--header-height)":"scroll-mt-[calc(var(--header-height)+min(200px,max(70px,20svh)))]"),tabIndex:-1,style:bs?ts():void 0,ref:L,dir:"auto","data-turn-id":h.id,"data-testid":`conversation-turn-${t}`,"data-scroll-anchor":!C&&o,"data-turn":E?"user":"assistant",children:[e.jsx(uo,{role:h.role,gizmo:Ve}),e.jsx(go,{role:h.role,children:e.jsxs(mo,{horizontalPadding:Ce?"none":"standard",verticalPadding:de,children:[Ce?e.jsxs(e.Fragment,{children:[e.jsx(zo,{isFeedbackEnabled:le,variantIds:K,conversationTurnMountTime:qt,...n}),Vt&&e.jsx("div",{className:"mt-4 flex w-full justify-center",children:e.jsxs(pt,{color:"secondary",className:"text-token-text-primary","data-testid":"paragen-skip-button",onClick:()=>{ht.publish({kind:"requestCompletion",isForSkippingParagen:!0})},children:[e.jsx(ho,{className:"text-token-text-secondary me-1"}),e.jsx(V,{id:"IuTr+b",defaultMessage:"Skip"})]})})]}):e.jsxs(Tt,{tabIndex:-1,className:O("group/turn-messages focus-visible:outline-hidden",B&&"super-widget-visible",Da,jo({isUserTurn:E})),children:[Rt&&e.jsx(po,{gizmo:Ve}),Ta&&e.jsx(fo,{clientThreadId:s,threadContent:Gt?.content??null,query:Ee?Ze(Ee):null,triggeredSearch:S,onNavLinksWidgetDidShow:a=>{a&&Y(!0)},className:"mb-4.5!"}),Ma&&e.jsx(bo,{handleShowRetrievalResults:Fs,clientThreadId:s,turnIndex:t,responseComplete:!ee,className:"mb-6"}),!E&&e.jsx(Qo,{messages:j,clientThreadId:s,gizmoId:He?.gizmo.id}),ra&&E&&e.jsx(Jo,{clientThreadId:s,messages:j}),ds&&Ie?e.jsx(lt,{message:Ie,clientThreadId:s,onRequestCompletion:r,onExitEdit:Lt,disabled:vs}):e.jsx(ss,{allMessages:M,groupedMessagesToRender:Ue,allGroupedMessages:b,...n,isUserTurn:E,isFinalUserTurn:Ft,isFinalAssistantTurn:Nt,isCompletionRequestInProgress:q,isFeedbackEnabled:le,isFinalTurn:o,hasActiveRequest:vs,isAgentTurn:v,isKAUR1BR5:he,query:Ee?Ze(Ee):null,wasInterrupted:Ss,lastAgentMetadataNode:z}),_a&&(Ga&&Ia?e.jsx(Xo,{turnIndex:t,clientThreadId:s,variant:"bottom"}):e.jsx(xo,{handleShowRetrievalResults:Fs,clientThreadId:s,turnIndex:t,responseComplete:!ee})),wa&&e.jsx(To,{message:d,clientThreadId:s,turnIndex:t,referenceMessageId:d.id,responseComplete:!o||!q}),Fa&&e.jsx(vo,{clientThreadId:s}),Je&&Je.length>0&&!q&&e.jsx(_o,{clientThreadId:s,examples:Je}),we&&e.jsx(Io,{isUserTurn:E,alwaysShow:!0,children:E?T?null:e.jsx(Mo,{activeVariantIndex:xe,clientThreadId:s,numVariants:K.length,onAnticipateEdit:lt.prefetch,onChangeIndex:js,onEnterEdit:Ot,showCopyButton:Ds,showEditMessageButton:ba,showPagination:ks,turnIndex:t}):e.jsxs(e.Fragment,{children:[e.jsx(So,{activeVariantIndex:xe,clientThreadId:s,conversationMode:ms,lastMessage:d,messages:j,numVariants:K.length,onChangeIndex:js,onRate:Wt,showCanvasButton:Zt,showCopyButton:Ds,showPagination:ks,showPlayButton:xa,showRatingButtons:le,showRegenerateButton:Aa,turn:h,turnIndex:t,parentPrompt:Be,isAgentTurn:v,isKAUR1BR5:he}),e.jsx(Xs,{clientThreadId:s,message:d,turnIndex:t}),Rs&&e.jsx(yo,{canShowInlineMessageFeedback:us,clientThreadId:s,messageForRating:d}),!1]})}),Ca&&e.jsx(wo,{clientThreadId:s}),Ea&&e.jsx(Co,{clientThreadId:s,messages:j}),da&&e.jsx(Xs,{clientThreadId:s,message:d,turnIndex:t}),Rs&&e.jsx(Eo,{canShowInlineMessageFeedback:us,clientThreadId:s,messageForRating:d,allGroupedMessages:b,currentModelId:g}),e.jsx(Ba,{mode:"wait",children:Es&&e.jsx(Ro,{lastUserMessageId:Q.id,setIsDismissed:ma})}),ua&&(se?e.jsx(ko,{clientThreadId:s,connectorToUpsell:se,analyticsMetadata:ls}):e.jsx(Po,{followups:Ra,actionSuggestions:Pa,pineappleToolSuggestions:ja,categorySuggestions:ka,clientThreadId:s,lastMessageId:Re,analyticsMetadata:ls,isTatertotFollowupsEnabled:De}))]}),e.jsx(Ao,{clientThreadId:s,turn:h,isFinalTurn:o}),e.jsx(Fo,{clientThreadId:s,turn:h})]})})]})]})})}const Zo=({clientThreadId:n,turn:t,turnIndex:o,conversationTurnWrapperRef:s})=>{const r=No();i.useEffect(()=>{if(!r)return;const g=new IntersectionObserver(m=>{m.forEach(l=>{l.isIntersecting?X(n,c=>{c.turnIdsInViewpoint=[...c.turnIdsInViewpoint??[],{turnId:t.id,turnIndex:o,role:t.role}]}):X(n,c=>{c.turnIdsInViewpoint=c.turnIdsInViewpoint?.filter(({turnId:u})=>u!==t.id)})})},{root:null,threshold:.1});return s.current&&g.observe(s.current),()=>{X(n,m=>{m.turnIdsInViewpoint=m.turnIdsInViewpoint?.filter(({turnId:l})=>l!==t.id)}),g.disconnect()}},[n,s,r,t.id,t.role,o])},ur=Oa.memo(Yo);function gr(){const[n,t]=bt(r=>[Gn(r),xt(r)]),o=Go(),s=Ho();return n&&!t&&!o&&!s}function mr({className:n,textClassName:t}){const o=Ne(),s=is(o),r=os(()=>es()),g=Hn.useStore(),m=Vn(),l=rs(o);function c(u){if(es.set(u),u!=="answer"){const p=g.getActiveSystemHintType();p&&p!==Ae.Search&&m(null)}}return l?s?e.jsx(Bo,{selectedTab:r,selectTab:c,className:n,textClassName:t}):e.jsxs("div",{className:O("flex gap-8.5",n),children:[e.jsx(ce,{className:t,$selected:r==="answer",onClick:()=>c("answer"),children:e.jsx(V,{...ne.chatTab})}),e.jsx(ce,{className:t,$selected:r==="web",onClick:()=>c("web"),children:e.jsx(V,{...ne.linksTab})}),e.jsx(ce,{className:t,$selected:r==="images",onClick:()=>c("images"),children:e.jsx(V,{...ne.imagesTab})}),e.jsx(ce,{className:t,$selected:r==="videos",onClick:()=>c("videos"),children:e.jsx(V,{...ne.videosTab})}),e.jsx(ce,{className:t,$selected:r==="news",onClick:()=>c("news"),children:e.jsx(V,{...ne.newsTab})})]}):null}const ce=as.button`
  ${({$selected:n})=>n?"text-token-text-primary font-medium":"text-token-text-tertiary hover:text-token-text-secondary"}
`,er={answer:()=>null,web:Lo,images:It,videos:_t,news:vt},sr={answer:()=>null,web:Oo,images:It,videos:_t,news:vt};function tr({userMessages:n,superWidgetMessageContents:t,tab:o,scrollToMessageId:s}){const r=Ne(),g=i.useRef({});function m(p,C="smooth"){const R=g.current[p];R&&R.scrollIntoView({behavior:C,block:"start"})}i.useEffect(()=>{requestAnimationFrame(()=>{if(n.length>0){const p=n[n.length-1];p&&m(p.id,"instant")}})},[]),i.useEffect(()=>{setTimeout(()=>{s&&m(s)},50)},[s]);const l=is(r),c=l?sr[o]:er[o],u=o==="web"||o==="videos"||o==="news";return e.jsx("div",{className:O("flex w-full flex-col pt-2",l&&"thread-sm:px-2 px-4",u?"gap-4":"gap-10"),children:Vo(n.length,p=>e.jsxs("div",{className:"w-full",children:[p>0&&e.jsx("hr",{className:O("border-heavy w-full",l?"pb-4.5":"pb-1.5")}),e.jsx("div",{className:O(l?u?"mb-4":"mb-6":u?"mb-2.5":"mb-6","flex items-center text-base",l?"scroll-mt-6":"scroll-mt-4",p>0&&"mt-2.5"),ref:C=>{g.current[n[p].id]=C},children:e.jsx(ar,{userMessage:n[p],tab:o,isKirklandEnabled:l})}),t[p]?e.jsx(c,{content:t[p],turnIndex:p}):e.jsx("div",{style:ts(),children:e.jsx("div",{className:"result-streaming pulse",children:e.jsx("span",{})})})]},p))})}function ar({userMessage:n,tab:t,isKirklandEnabled:o}){const s=Ze(n);return s?o?e.jsx(Wo,{queryText:s,tabType:t,searchIt:e.jsx(qo,{href:$o(s,t)})}):e.jsx("div",{dir:"auto",className:"text-token-text-tertiary flex max-w-[var(--user-chat-width,70%)] min-w-0 text-start text-sm",children:e.jsx(V,{...ne.resultsFor,values:{prefix:r=>e.jsx("span",{className:"shrink-0",children:r}),query:e.jsx("span",{className:"min-w-0 flex-1 truncate",children:s}),trailingQuote:r=>e.jsx("span",{"aria-hidden":"true",className:"shrink-0",children:r})}})}):null}function hr({clientThreadId:n,children:t}){const o=Ne(),s=os(()=>es()),[r,g,m]=oe(n,l=>[y.getUserMessages(l).filter(c=>!c.metadata?.is_visually_hidden_from_conversation),y.getSuperWidgetMessages(l),l?.scrollToMessageId]);return rs(o)?e.jsxs("div",{children:[e.jsx("div",{id:"mini-chat-content",className:s==="answer"?"block":"hidden",children:t}),e.jsx(Tt,{children:s!=="answer"&&e.jsx(tr,{userMessages:r,superWidgetMessageContents:g.map(l=>l.content),tab:s,scrollToMessageId:m},s)})]}):t}const ne=ut({chatTab:{id:"CSsJbp",defaultMessage:"Chat"},linksTab:{id:"U43uU/",defaultMessage:"Links"},imagesTab:{id:"ZY9oIP",defaultMessage:"Images"},videosTab:{id:"C8mH8+",defaultMessage:"Videos"},newsTab:{id:"RxIkHj",defaultMessage:"News"},resultsFor:{id:"V5ZXix",defaultMessage:"<prefix>Results for “</prefix>{query}<trailingQuote>”</trailingQuote>"}});export{ur as C,hr as S,mr as a,gr as u};
//# sourceMappingURL=lwh0wbmpf7uh5gaw.js.map
