import{e as fe,r as o,j as e,M as a,A as Me,m as be,L as je}from"./cs7toih8jegb7teq.js";import{bN as ve,bO as te,bP as ye,bQ as t,bR as Te,bS as B,bT as E,bU as k,bV as c,bW as Ue,bX as Se,bY as _e,bZ as D,b_ as Ne,by as Ee,B as ke}from"./hnw079jsdm76umup.js";import{e as Le,bV as Ie,bm as we,aG as ae,nk as Pe,bh as ze,h as Oe,j as Ae,nl as Be,dO as De,aq as F,P as G,C as oe,be as L,S as Fe,gA as Ge}from"./dmck639k4dv7claj.js";import{u as Re,a as He,U as Qe,T as Ve,G as Xe}from"./k0vsfnhj46wtdqkf.js";import"./nubxp7c1wy66c1tg.js";import"./g4tl5lt9yqf20m4s.js";function es({onClose:I}){const R=Le(),l=fe(),w=Ie(),le=Re(),re=we(s=>s.autoHighlightNicknameInput),ie=ae(R,"1922342873").get("can-select-personality",!1),[ne,ce]=o.useState(!1),[H,Q]=o.useState(!0),{isLoading:de,data:i}=Pe(H),{personalityTypeMessage:V,nameUserMessage:b,roleUserMessage:g,traitsModelMessage:h,otherUserMessage:j,disabledTools:X,enabled:q}=ve(i),[r,n]=o.useState({...te}),{aboutUserMessage:J,aboutModelMessage:K,nameUserMessage:p,roleUserMessage:m,traitsModelMessage:u,otherUserMessage:C,disabledTools:v,enabled:f,personalityTypeMessage:y}=r,d=f??!!q,[T,P]=o.useState(null),U=o.useCallback(()=>{n(te),P(null),Q(!1),I?.()},[I]),me=ae(R,"1704793646").get("full_name_llm",!1),ue=ze(),{isPending:z,mutate:W}=He({onSuccess:s=>{Oe.setCookie(Ae.GreetingName,Be(s,ue,me)),window.dispatchEvent(new Event("refreshGreeting")),U()},onError:s=>(s.response?.reason==="content_policy"&&s.response?.field?P(s.response?.field):w.danger(l.formatMessage({id:"userContextModal.saveError",defaultMessage:"Failed to update settings"}),{loggingTitle:"Failed to update settings",toastId:"user_context_modal"}),s)}),[$,Y]=o.useState(!1),[S,xe]=o.useState(!1),[_,ge]=o.useState([]),O=[p,m,u,C].some(s=>ye(s??"")),A=[{local:p,server:b},{local:m,server:g},{local:u,server:h},{local:C,server:j},{local:y,server:V}].some(({local:s,server:x})=>s!==void 0&&s!==x)||v!==void 0&&!De(v,X)||f!==void 0&&f!==q,Z=o.useCallback(()=>{F.logEvent("chatgpt_user_context_cancel_clicked"),G.logEvent("User Context Cancel Clicked"),A?Y(!0):U()},[U,A]),ee=o.useCallback(()=>{if(!z){P(null);const s={aboutUserMessage:J??"",aboutModelMessage:K??"",nameUserMessage:p??"",roleUserMessage:m??"",traitsModelMessage:u??"",otherUserMessage:C??"",disabledTools:v??[],enabled:!!f,personalityTypeMessage:y??""},x={name:b,role:g,traits:h,other:j,traitPillsSelected:_},N={name:s.nameUserMessage,role:s.roleUserMessage,traits:s.traitsModelMessage,other:s.otherUserMessage,personality:s.personalityTypeMessage,traitPillsSelected:_};G.logEvent("User Context Save Customize ChatGPT",{previousState:x,newState:N}),F.logEvent("chatgpt_user_context_save_custom_instructions",void 0,{previousState:JSON.stringify(x),newState:JSON.stringify(N)}),W({userContext:s})}},[z,J,K,p,m,u,C,v,f,y,b,g,h,j,_,W]),M=o.useCallback(()=>{if(O){w.danger(l.formatMessage(t.messageLimitError,{limit:Te}),{duration:4,hasCloseButton:!0,loggingTitle:"Message limit error",toastId:"user_context_modal",loggingDescription:t.messageLimitError.defaultMessage});return}ee()},[l,O,ee,w]),[se,he]=o.useState(0),[pe,Ce]=o.useState(!0);if(o.useEffect(()=>{const s=setTimeout(()=>{Ce(!1)},1e3),x=setInterval(()=>{he(N=>(N+1)%B.length)},5500);return()=>{clearInterval(x),clearTimeout(s)}},[]),le&&!ne)return e.jsx(Qe,{onClose:()=>{ce(!0)}});if($){const s=()=>{Y(!1),Q(!0),F.logEvent("chatgpt_user_context_confirm_close_clicked"),G.logEvent("User Context Confirm Close Clicked")};return e.jsx(oe,{testId:"modal-user-context-confirm-close",isOpen:$,onClose:()=>{s(),I?.()},type:"success",title:l.formatMessage(t.confirmCloseTitle),primaryButton:e.jsx(L.Button,{title:l.formatMessage(t.confirmCloseOk),color:"danger",onClick:()=>{U(),s()}}),secondaryButton:e.jsx(L.Button,{title:l.formatMessage(t.confirmCloseCancel),color:"secondary",onClick:()=>{s()}}),children:e.jsx("div",{className:"text-sm",children:e.jsx(a,{...t.confirmCloseBody})})},"confirm-close")}return e.jsxs(oe,{testId:"modal-user-context",isOpen:H,onClose:Z,contentClassName:"!p-0",type:"success",size:"custom",showCloseButton:!0,className:"max-w-lg",title:e.jsx(a,{...t.profileTitle}),description:e.jsxs("div",{className:"text-token-text-secondary flex flex-row items-center",children:[e.jsx("div",{className:"me-1",children:e.jsx(a,{...t.profileSubtitle})}),e.jsx(D,{primaryLabel:e.jsx("div",{className:"text-muted mx-3 mt-2 mb-2 text-sm font-normal",children:e.jsx(a,{...t.profileSubtitleTooltip,values:{link:s=>e.jsx(je,{className:"underline",target:"_blank",rel:"noreferrer",to:t.profileSubtitleTooltip.link??"",children:s},"profile-subtitle-tooltip-link")}})}),icon:e.jsx(ke,{className:"text-token-text-tertiary h-4 w-4"})})]}),children:[e.jsxs("div",{className:"flex max-h-[60vh] flex-col gap-5 overflow-y-auto px-4 md:max-h-[calc(100vh-300px)]",children:[de&&e.jsx(Fe,{}),e.jsx(E,{title:e.jsx(a,{...t.customizeName}),children:e.jsx(k,{onSubmit:M,disabled:!d,name:"name_user_message",hasModError:T==="name_user_message",value:p??b,placeholder:l.formatMessage(t.customizeNamePlaceholder),onChange:s=>c({userContextData:i,updates:{nameUserMessage:s.target.value},localUserContext:r,setLocalUserContext:n}),size:"sm",showCharacterCount:!1,autoHighlight:re})}),e.jsx(E,{title:e.jsx(a,{...t.customizeRole}),children:e.jsxs("div",{className:"relative overflow-clip",children:[!(m??g)&&e.jsx(Me,{mode:"wait",children:e.jsx(be.span,{variants:Ue,initial:pe?!1:"initial",animate:"animate",exit:"exit",className:"pointer-events-none absolute start-[0.81rem] top-[0.55rem] text-sm text-gray-400",children:l.formatMessage(Se[B[se]])},B[se])}),e.jsx(k,{onSubmit:M,name:"role_user_message",disabled:!d,hasModError:T==="role_user_message",value:m??g,placeholder:"",onChange:s=>c({userContextData:i,updates:{roleUserMessage:s.target.value},localUserContext:r,setLocalUserContext:n}),size:"sm",showCharacterCount:!1})]})}),ie&&e.jsx(_e,{enabled:d,personalityType:y??V,updateLocalUserContext:s=>c({userContextData:i,updates:s,localUserContext:r,setLocalUserContext:n})}),e.jsxs(E,{className:"pb-2",title:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(a,{...t.customizeTraits}),e.jsx(D,{primaryLabel:e.jsx("div",{className:"text-muted mx-3 mt-3 mb-[6px] text-sm font-medium",children:e.jsx(a,{...t.traitsTooltipTitle})}),side:"bottom",secondaryLabel:e.jsxs("ul",{className:"text-muted text-token-text-primary mx-2 mb-3 list-disc justify-start space-y-[6px] ps-5 text-sm",children:[e.jsx("li",{children:e.jsx(a,{...t.traitsTooltipBodyItem1})}),e.jsx("li",{children:e.jsx(a,{...t.traitsTooltipBodyItem2})}),e.jsx("li",{children:e.jsx(a,{...t.traitsTooltipBodyItem3})})]})})]}),children:[e.jsx(k,{onSubmit:M,name:"traits_model_message",disabled:!d,hasModError:T==="traits_model_message",value:u??h,placeholder:l.formatMessage(t.customizeTraitsPlaceholder),onChange:s=>c({userContextData:i,updates:{traitsModelMessage:s.target.value},localUserContext:r,setLocalUserContext:n}),size:"md",showCharacterCount:!1,isNewCustomInstructionsUIEnabled:!0}),e.jsx(Ve,{onSelect:s=>{c({userContextData:i,updates:{traitsModelMessage:`${u??h} ${s}`.trim()},localUserContext:r,setLocalUserContext:n})},selectedTraits:_,setSelectedTraits:ge})]}),e.jsx(E,{title:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(a,{...t.customizeOther}),e.jsx(D,{primaryLabel:e.jsx("div",{className:"text-muted mx-3 mt-3 mb-2 text-sm font-medium",children:e.jsx(a,{...t.otherTooltipTitle})}),secondaryLabel:e.jsxs("ul",{className:"text-muted text-token-text-primary mx-2 mb-3 list-disc justify-start space-y-[6px] ps-5 text-sm",children:[e.jsx("li",{children:e.jsx(a,{...t.otherTooltipBodyItem1})}),e.jsx("li",{children:e.jsx(a,{...t.otherTooltipBodyItem2})}),e.jsx("li",{children:e.jsx(a,{...t.otherTooltipBodyItem3})})]})})]}),children:e.jsx(k,{onSubmit:M,disabled:!d,name:"other_user_message",hasModError:T==="other_user_message",value:C??j,placeholder:l.formatMessage(t.customizeOtherPlaceholder),onChange:s=>c({userContextData:i,updates:{otherUserMessage:s.target.value},localUserContext:r,setLocalUserContext:n}),size:"md",showCharacterCount:!1,isNewCustomInstructionsUIEnabled:!0})}),e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>xe(s=>!s),"aria-label":l.formatMessage(S?t.advancedClose:t.advancedOpen),"data-testid":"advanced-toggle","aria-expanded":S,className:"text-body-small-emphasized flex items-center justify-between gap-1 pb-2 [font-weight:500]",children:[e.jsx(a,{...t.advanced}),S?e.jsx(Ne,{className:"icon-sm"}):e.jsx(Ee,{className:"icon-sm"})]}),S&&e.jsx("div",{className:"mt-2",children:e.jsx(Xe,{disabledTools:r.disabledTools??X??[],onDisabledToolsChanged:s=>c({userContextData:i,updates:{disabledTools:s},localUserContext:r,setLocalUserContext:n})})})]})]}),e.jsx("div",{className:"border-t",children:e.jsxs("div",{className:"flex min-h-21 items-center justify-between px-4",children:[e.jsxs("label",{className:"flex cursor-pointer flex-row items-center justify-between gap-2 pe-1",children:[e.jsx(Ge,{checked:d,onCheckedChange:s=>{c({userContextData:i,updates:{enabled:s},localUserContext:r,setLocalUserContext:n})},"aria-label":d?l.formatMessage(t.disableToggleLabel):l.formatMessage(t.enableToggleLabel)}),e.jsx("div",{className:"text-token-text-primary self-center text-sm",children:e.jsx(a,{...t.chatPreferencesEnable})})]}),e.jsxs("footer",{className:"flex justify-end gap-2",children:[e.jsx(L.Button,{onClick:Z,children:e.jsx(a,{...t.cancel})}),e.jsx(L.Button,{loading:z,onClick:M,color:"primary",visuallyDisabled:O,disabled:!A,children:e.jsx(a,{...t.save})})]})]})})]},"user-context")}export{es as UserContextModal};
//# sourceMappingURL=hnrku8kz40c6n3rj.js.map
