const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/neucn3y91ovuy5qs.js","assets/cs7toih8jegb7teq.js","assets/dmck639k4dv7claj.js","assets/root-mdlgku96.css","assets/m3ewnmekk6smaetu.js","assets/joa8jajuiu4xqpzn.js"])))=>i.map(i=>d[i]);
import{eg as M,z as _,aF as P,h8 as x,h7 as S,mU as R,fD as F,aK as L,a0 as O,bV as W,aw as H,ax as V,T as U}from"./dmck639k4dv7claj.js";import{r as c,j as n,M as A,m as z,f as G,e as B,p as Z}from"./cs7toih8jegb7teq.js";import{F as q}from"./dlvfyfqn731e6hy3.js";import{ct as K,cH as Q,iP as J,jx as X,cB as j,cC as b,jy as Y,jz as $,jA as ee,jB as te,eZ as ne,i3 as se}from"./hnw079jsdm76umup.js";import"./m45qhi5lpgsvsv3e.js";import"./lwh0wbmpf7uh5gaw.js";import"./nlxagrvvx9r77jf7.js";import"./gqxnaj28dwt74usv.js";import"./dfhgw8mxn1h3ecpw.js";import"./kizn5m1hr7kdjf9n.js";import"./nfubiloo9rdxk3kj.js";import"./lxgn8k46ba24438b.js";import"./k4ghje9xipg90eb2.js";import"./lox5zdwgg3gy3k4z.js";import"./itn5frgf3bcgdkwm.js";import"./hsurwbv79wrpc9dg.js";import"./k8zvpcbe8ny3hcd9.js";import"./cm813h9bptrniota.js";import"./mahhuo4zclh446vl.js";import"./l1m3l5lbmhuctzw6.js";import"./k3ulfqwluwevik5m.js";import"./oasstlv4rvegny2a.js";import"./m9o58vphd3ndk69b.js";function ae(){const[e,s]=c.useState({undoStack:[],currentIndex:-1});function a(t){s(r=>({undoStack:[...r.undoStack.slice(0,r.currentIndex+1),t],currentIndex:r.currentIndex+1}))}function d(){s(t=>({undoStack:t.undoStack,currentIndex:Math.max(t.currentIndex-1,-1)}))}function o(){s(t=>({undoStack:t.undoStack,currentIndex:Math.min(t.currentIndex+1,t.undoStack.length-1)}))}function i(){s({undoStack:[],currentIndex:-1})}return{currentDrawnShape:e.undoStack.length>0?e.undoStack[e.currentIndex]:null,onNewDrawnShape:a,canUndoDrawing:e.currentIndex>=0,undoDrawing:d,canRedoDrawing:e.currentIndex<e.undoStack.length-1,redoDrawing:o,clearAllDrawings:i}}function oe({mode:e,imageIndex:s,allImages:a,onSwitchImage:d,isLoadingNewImage:o}){const i=s>0,t=c.useCallback(()=>{i&&d(a[s-1])},[i,a,s,d]),r=s<a.length-1,l=c.useCallback(()=>{r&&d(a[s+1])},[r,a,s,d]);return c.useEffect(()=>{function g(u){u.target instanceof HTMLTextAreaElement||e==="default"&&(u.key==="ArrowLeft"?t():u.key==="ArrowRight"&&l())}return document.addEventListener("keydown",g),()=>{document.removeEventListener("keydown",g)}},[e,t,l]),n.jsx("div",{className:"text-token-text-secondary flex h-16 w-full items-center justify-center gap-3 font-semibold",children:e==="inpaint"?!o&&n.jsxs("div",{className:"flex items-center gap-1.5",children:[n.jsx(A,{id:"imageEditor.selectArea",defaultMessage:"Select an area to edit"}),n.jsx("a",{href:"https://help.openai.com/en/articles/9055440",target:"_blank",rel:"noreferrer",children:n.jsx(M,{className:"icon"})})]}):a.length>1?n.jsxs(n.Fragment,{children:[n.jsx("button",{disabled:!i,className:"disabled:text-token-text-tertiary",onClick:t,children:n.jsx(K,{className:"icon"})}),n.jsx("div",{children:n.jsx(A,{id:"imageEditor.imageNumber",defaultMessage:"Image {num} of {numImages}",values:{num:s+1,numImages:a.length}})}),n.jsx("button",{disabled:!r,className:"disabled:text-token-text-tertiary",onClick:l,children:n.jsx(Q,{className:"icon"})})]}):null})}const ie=0,re=64;function ce({imageAsset:e,children:s,containerDimensions:a,isLoadingNewImage:d}){return n.jsxs(z.div,{className:"absolute",style:de(e,a),...J,children:[s,n.jsx("div",{className:_("bg-token-main-surface-primary absolute inset-0 flex items-center justify-center transition-opacity duration-1000",d?"pointer-events-auto opacity-60":"pointer-events-none opacity-0")})]})}function de(e,s){const{width:a,height:d}=e,{width:o,height:i}=s,t=o-2*ie,r=i-2*re,l=a/d,g=t/r,u=l>g,p=u?t:r*l,f=u?t/l:r,h=(i-f)/2,y=(o-p)/2;return{top:h,left:y,width:p,height:f}}const ue=H(()=>V(()=>import("./neucn3y91ovuy5qs.js"),__vite__mapDeps([0,1,2,3,4,5])).then(e=>e.DynamicDrawingCanvas));function Re({clientThreadId:e,messageId:s,image:a,allImages:d}){const o=P(e,U.getCurrentNode),i=[x.Dalle,x.t2uay3k].includes(S(o.message))&&!R(o.message),t=G();return c.useEffect(()=>{async function r(l,g){try{const u=await X(t,l);j.setFocusedObject({type:b.Image,image:u[0],allImages:u,messageId:g})}catch(u){O.addError(new Error("Failed to load newly created images:",{cause:u}))}}if(o!=null&&[x.Dalle,x.t2uay3k].includes(S(o.message))&&o.message.content.content_type===F.MultimodalText){const l=L.getImageAssetPointers(o.message);r(l,o.id)}},[t,o]),n.jsx(le,{image:a,allImages:d,isLoadingNewImage:i,clientThreadId:e,messageId:s})}function le({image:e,allImages:s,isLoadingNewImage:a,clientThreadId:d,messageId:o}){const[i,t]=c.useState("default"),[r,l]=c.useState({width:window.innerWidth-q,height:window.innerHeight}),g=c.useRef(null),[u,p]=c.useState(136),f=ae(),{currentDrawnShape:h,onNewDrawnShape:y,clearAllDrawings:D}=f,C=c.useRef(null),E=B(),k=W(),{setTargetedContent:w}=Y();c.useEffect(()=>{const m=new ResizeObserver(I=>{const{width:T,height:N}=I[0].contentRect;l({width:T,height:N})});return g.current&&m.observe(g.current),()=>{m.disconnect()}},[]),c.useEffect(()=>{function m(I){I.key==="Escape"&&(i==="inpaint"?t("default"):j.close())}return document.addEventListener("keydown",m),()=>{document.removeEventListener("keydown",m)}},[i]),c.useEffect(()=>(h==null?w({type:"object",placeholderTextOverride:Z({id:"imageEditor.transformationTextareaPlaceholder",defaultMessage:"Edit imageâ€¦"}),shouldPersistAcrossMessages:!0,isFocusedViewContent:!0,createNewCompletionParams:m=>$(m,e)}):w({type:"object",label:E.formatMessage({id:"imageEditor.inpaintingTargetedContentLabel",defaultMessage:"Edit selection"}),isFocusedViewContent:!0,createNewCompletionParams:async m=>await ee(m,e,C.current?.getImageData(),E,k),onCleared:()=>t("default")}),()=>{w(void 0)}),[e,E,w,h,k]),c.useEffect(()=>{i!=="inpaint"&&D()},[i]),c.useEffect(()=>{t("default")},[e]);const v=s.findIndex(m=>m.asset_pointer===e.asset_pointer);return n.jsxs("div",{ref:g,className:"flex h-full w-full flex-col justify-between",children:[n.jsx(te,{imageAsset:e,mode:i,setMode:t,clientThreadId:d,messageId:o,cursorWidth:u,setCursorWidth:p,inpaintingDrawingState:f,isLoadingNewImage:a}),n.jsx(oe,{mode:i,imageIndex:v,allImages:s,onSwitchImage:m=>{j.setFocusedObject({type:b.Image,image:m,allImages:s,messageId:o})},isLoadingNewImage:a}),n.jsxs(ce,{imageAsset:e,containerDimensions:r,isLoadingNewImage:a,children:[n.jsx(ne,{className:"h-full w-full",alt:se(e),src:e.url,width:e.width,height:e.height,fadeIn:!1}),i==="inpaint"&&n.jsx("div",{className:"absolute inset-0",children:n.jsx(ue,{drawingCanvasRef:C,color:"rgba(0, 122, 255, 0.5)",dashedOutlineColor:"rgba(255, 255, 255, 0.65)",cursorWidth:u,canvasWidth:e.width,canvasHeight:e.height,currentDrawnShape:h,onNewDrawnShape:y})})]})]})}export{Re as ImageEditor};
//# sourceMappingURL=kv4zmfer8jhuryuz.js.map
