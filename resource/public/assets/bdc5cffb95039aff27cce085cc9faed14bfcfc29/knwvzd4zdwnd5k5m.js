import{r as g,e as re,j as e,d as Se,M as m,L as Pe,f as Ca,u as Ue,a as Ut,b as Ot,h as Sa,ar as Ma}from"./cs7toih8jegb7teq.js";import{P as S,aG as _e,A as f,f as he,B as pe,dY as xa,e as ve,p as He,z as F,sD as gt,C as je,gy as ba,be as wt,d3 as wa,bV as ze,bQ as ka,l as va,lY as et,aq as kt,l_ as ja,V as lt,L as ct,go as Lt,gp as Rt,gq as Gt,gr as Bt,gs as Yt,gt as Ea,gu as Ht,S as Ie,cT as Fe,sE as Be,qO as Ta,qP as Na,f5 as Da,i as Ia,k5 as ke,sF as Fa,ku as Ae,sG as Aa,sH as zt,sI as Wt,sJ as $t,de as xe,sK as tt,eD as ge,sL as Ua,R as Vt,bT as at,G as Oa,c2 as vt,k6 as La,iN as Ra,br as Ga,sM as Ba,sN as Ya,je as Ha,a0 as qt,bh as za,aX as Wa,c3 as $a,gv as Va,aN as qa,sO as Ka,sP as Qa,iO as Ja,v as Za,N as Xa}from"./dmck639k4dv7claj.js";import{S as es}from"./lo4bvml5ypzzx0bg.js";import{ad as ts,rA as We,rB as be,rr as as,lw as ss,rt as ns,ru as Kt,r1 as fe,rC as le,rD as Me,dS as dt,dQ as ut,dM as mt,dO as jt,dK as os,ae as rs,rE as is,rF as Ge,rG as De,rH as Xe,lO as Qt,rI as ls,e6 as cs,ef as ds,e7 as us,e8 as ms,ej as we,ek as Ee,rJ as me,d$ as ps,af as gs,rK as Et,pL as fs,dJ as hs,ai as ye,qW as ys,rL as Ps}from"./hnw079jsdm76umup.js";import{u as ft}from"./f9bnpe34l2c3c1sm.js";import{u as ht}from"./de0xekdnf43rd5ny.js";import{u as Jt}from"./kyjth308quztvz31.js";import{C as Tt}from"./ngfdozy6ucqfmo6o.js";import{a as _s,b as Cs,M as Ss}from"./lox5zdwgg3gy3k4z.js";const Ms=t=>g.createElement("svg",{width:21,height:20,viewBox:"0 0 21 20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...t},g.createElement("path",{d:"M10.2441 10.7759C12.7597 10.8965 14.8838 12.8648 14.8838 15.0601C14.8838 15.4273 14.586 15.7251 14.2188 15.7251H5.78125C5.41399 15.7251 5.11623 15.4273 5.11621 15.0601C5.11621 12.7959 7.37906 10.77 10 10.77L10.2441 10.7759Z"}),g.createElement("path",{d:"M0 14.436C0 11.5616 3.13043 10.5652 5.2998 11.4478C4.37179 12.4185 3.78619 13.6736 3.78613 15.0601L3.78809 15.1011H0.665039C0.298096 15.1011 0.000527744 14.8029 0 14.436Z"}),g.createElement("path",{d:"M14.7988 11.5532C16.969 10.4969 20.3301 11.4561 20.3301 14.436C20.3295 14.8029 20.032 15.1011 19.665 15.1011H16.2119L16.2139 15.0601C16.2138 13.7223 15.6689 12.5079 14.7988 11.5532Z"}),g.createElement("path",{d:"M3.4248 5.00146C4.85516 5.00146 6.01454 6.16098 6.01465 7.59131C6.01454 9.02164 4.85516 10.1812 3.4248 10.1812C1.99454 10.181 0.835068 9.02157 0.834961 7.59131C0.835066 6.16105 1.99454 5.00157 3.4248 5.00146Z"}),g.createElement("path",{d:"M16.5703 5.00146C18.0006 5.00157 19.1601 6.16105 19.1602 7.59131C19.16 9.02157 18.0006 10.181 16.5703 10.1812C15.14 10.1812 13.9806 9.02164 13.9805 7.59131C13.9806 6.16098 15.14 5.00146 16.5703 5.00146Z"}),g.createElement("path",{d:"M10 4.27002C11.6099 4.27002 12.915 5.57515 12.915 7.18506C12.915 8.79497 11.6099 10.1001 10 10.1001C8.39009 10.1001 7.08496 8.79497 7.08496 7.18506C7.08496 5.57515 8.39009 4.27002 10 4.27002Z"}));function xs({value:t,onChange:a}){const s=re();return e.jsx(es,{value:t,onChange:a,ariaLabel:s.formatMessage(Le.toggleArialabel),leftItem:{ariaLabel:s.formatMessage(Le.togglePersonalArialabel),label:s.formatMessage(Le.togglePersonalLabel),value:"personal"},rightItem:{ariaLabel:s.formatMessage(Le.toggleBusinessArialabel),label:s.formatMessage(Le.toggleBusinessLabel),value:"business"}})}const Le=Se({toggleArialabel:{id:"U4v2Gf",defaultMessage:"Toggle for switching between Personal and Business plans"},togglePersonalArialabel:{id:"6Wikht",defaultMessage:"Toggle for switching to Personal plans"},toggleBusinessArialabel:{id:"uzlEV0",defaultMessage:"Toggle for switching to Business plans"},togglePersonalLabel:{id:"cGDsaD",defaultMessage:"Personal"},toggleBusinessLabel:{id:"sgisa2",defaultMessage:"Business"}}),st=()=>{S.logEvent("Account Portal: Click Get Help")};function bs(t){if(xa(t))return"secondary";switch(t){case f.FREE:return"green";case f.GO:return"green";case f.PLUS:return"green";case f.SELF_SERVE_BUSINESS:return"primary";case f.PRO:return"primary"}}function pt({isCurrentPlan:t=!1,planType:a,disabled:s,loading:n=!1,onClick:o,children:l,testId:r,activeColor:c,...i}){return e.jsx(pe,{fullWidth:!0,size:"large",color:t?"secondary":c||bs(a),disabled:s,loading:n,onClick:o,"data-testid":r,className:s?"bg-token-sidebar-surface-tertiary text-token-text-primary hover:bg-token-sidebar-surface-tertiary dark:bg-token-text-tertiary border-none font-semibold":"font-semibold",...i,children:l})}function yt(t,a){const[s,n]=g.useState(!1);g.useEffect(()=>{if(!s){n(!0);return}t?S.logEventWithStatsig("Email Verify Popup Shown","chatgpt_email_verify_popup_shown",a):S.logEventWithStatsig("Email Verify Popup Hidden","chatgpt_email_verify_popup_hidden",a)},[t])}function Zt({ctx:t,shouldLogExposure:a}){return _e(t,"2273762597",{disableExposureLog:!a})}function ws({ctx:t,shouldLogExposure:a}){return Zt({ctx:t,shouldLogExposure:a}).get("web_plus_intro_offer_coupon","none")}function ks({ctx:t,shouldLogExposure:a}){return Zt({ctx:t,shouldLogExposure:a}).get("is_plus_intro_offer_enabled",!1)}function Ze({ctx:t,planType:a}){const n=_e(t,"978971143").get("cta_type","default");if(a===f.PLUS)switch(n){case"long_ctas":return he.longCtaPlus;case"upgrade_to_x":return he.upgradeToPlus;case"join_x":return he.joinPlus;case"unlock_x":return he.unlockPlus;default:return he.getPlus}else switch(n){case"long_ctas":return he.longCtaPro;case"upgrade_to_x":return he.upgradeToPro;case"join_x":return he.joinPro;case"unlock_x":return he.unlockPro;default:return he.getPro}}const vs=({billingDetails:t,isWebRedesign:a,shouldUseComparisonSpacing:s})=>{const n=ve(),o=He(n,"1627380539"),l=ts({isWebRedesign:a,inGPT5Gate:o});return e.jsx(We,{planType:f.FREE,pricingPlan:l,shouldUseComparisonSpacing:s,callToActionButton:e.jsx(pe,{color:"secondary",disabled:!0,size:"large",className:F(a?"btn-secondary disabled:bg-token-bg-primary w-[100%]":"bg-token-sidebar-surface-tertiary text-token-text-primary hover:bg-token-sidebar-surface-tertiary dark:bg-token-text-tertiary dark:text-token-text-primary dark:hover:bg-token-text-tertiary w-[100%] border-none font-semibold"),children:e.jsx(m,{...l.callToAction.inactive})}),additionalLinks:[e.jsx(m,{...js.haveExistingPlan,values:{link:r=>e.jsx(Pe,{target:"_blank",to:gt,onClick:st,className:F("underline",a&&"font-medium"),children:r},"row-plus-plan-help-link")}},"existing-plan-help")],billingDetails:t,isWebRedesign:a})},js=Se({haveExistingPlan:{id:"FreeColumn.haveExistingPlan",defaultMessage:"Have an existing plan? <link>See billing help</link>"}});function Pt({isOpen:t,onClose:a,onContinue:s,analyticsParams:n}){g.useEffect(()=>{t&&S.logEventWithStatsig("Mobile Subscription Warning Modal Shown","chatgpt_mobile_subscription_warning_modal_shown",n)},[n,t]);const o=()=>{S.logEventWithStatsig("Mobile Subscription Warning Modal Continue Clicked","chatgpt_mobile_subscription_warning_modal_continue_clicked",n),s()},l=()=>{S.logEventWithStatsig("Mobile Subscription Warning Modal Close Clicked","chatgpt_mobile_subscription_warning_modal_close_clicked",n),a()};return e.jsx(je,{testId:"modal-mobile-subscription-warning",isOpen:t,onClose:l,type:"warning",icon:ba,title:e.jsx(m,{...Qe.checkSubscriptionHeader}),primaryButton:e.jsx(wt.Button,{title:Qe.dismissModal.defaultMessage,color:"primary",onClick:l}),secondaryButton:e.jsx(wt.Button,{title:Qe.continueToNextStep.defaultMessage,color:"secondary",onClick:o}),children:e.jsx("span",{className:"gap-2 text-gray-600",children:Qe.checkSubscriptionBody.defaultMessage})})}const Qe=Se({checkSubscriptionHeader:{id:"mobileSubscriptionWarningModal.checkSubscriptionHeader",defaultMessage:"Check your App Store subscription"},checkSubscriptionBody:{id:"mobileSubscriptionWarningModal.checkSubscriptionBody",defaultMessage:"Your subscription through the Apple App Store is currently on pause due to a payment issue. Please resolve that issue to resume using ChatGPT Plus and avoid duplicate charges."},dismissModal:{id:"mobileSubscriptionWarningModal.dismissModal",defaultMessage:"Cancel"},continueToNextStep:{id:"mobileSubscriptionWarningModal.continueToNextStep",defaultMessage:"I understand, continue anyways"}}),nt=wa(t=>({recentlyDowngraded:!1,recentlyUpgraded:!1,recentlyCanceled:!1,setRecentlyDowngraded:a=>t({recentlyDowngraded:a}),setRecentlyUpgraded:a=>t({recentlyUpgraded:a}),setRecentlyCanceled:a=>t({recentlyCanceled:a})}));function Xt(t){switch(t){case f.FREE:return"chatgptfreeplan";case f.GO:return"chatgptgoplan";case f.PLUS:return"chatgptplusplan";case f.PRO:return"chatgptpro";case f.SELF_SERVE_BUSINESS:return"chatgptteamplan";default:throw new Error(`Invalid plan type: ${t}`)}}function _t({isOpen:t,onClose:a,accountId:s,initialPlanType:n,updatedPlanType:o,billingDetails:l}){const r=re(),c=ze(),i=ka(),[u,_]=g.useState(!1),d=n===o,y=be(n)<be(o),N=Xt(o);g.useEffect(()=>{S.logTogglePlanManagementModal({isOpen:!0})},[]);const C=()=>{S.logTogglePlanManagementModal({isOpen:!1}),a()},p=as(s),v=ss(s),L=ns(s),{data:P,isError:x,isLoading:M}=Kt(s,void 0,N);!d&&x&&(i?.planType===f.SELF_SERVE_BUSINESS?c.warning(r.formatMessage({id:"planManagement.errorUpgradingTeam",defaultMessage:"Updates to {capitalizedUpdatedPlanType} aren't yet supported for users with Team subscriptions"},{capitalizedUpdatedPlanType:fe(o.toLowerCase())}),{hasCloseButton:!0}):c.warning(r.formatMessage({id:"planManagement.errorFetchingPreview",defaultMessage:"There was a problem updating your subscription"}),{hasCloseButton:!0}),a());const R=$=>{const Y=et(new Date,$);return new Intl.DateTimeFormat(r.locale,{year:"numeric",month:"short",day:"numeric"}).format(Y)},j=i?.getDaysUntilPlanRenews();let D=j?R(j):"";const E=i?.getDaysUntilSubscriptionCancelAt();j&&E&&E>j&&(D=R(E));const{recentlyCanceled:h,setRecentlyUpgraded:A,setRecentlyDowngraded:b}=nt(),I=i?.willRenewSubscription()||h,[T,w]=g.useState(!1),U=Ca();if(!i)return null;const G=async $=>{_(!0);try{if(d)await v.mutateAsync(s),c.success(D===""?r.formatMessage({id:"planManagement.successfullyRenewedSubscription2",defaultMessage:"Your subscription has been renewed."}):r.formatMessage({id:"planManagement.successfullyRenewedSubscription",defaultMessage:"Your subscription has been renewed. Your subscription will auto-renew on {renewalDate}."},{renewalDate:D}),{hasCloseButton:!0}),S.logEvent("Renew Plan Success",{planType:$}),kt.logEvent("chatgpt_renew_plan_success",null,{planType:$});else{if(I||(await v.mutateAsync(s),w(!0)),await p.mutateAsync({accountId:s,updatedPlan:N,updatedPriceInterval:void 0,updatedSeats:void 0}),$!==o){const de=y?"Upgrade Plan Success":"Downgrade Plan Success",X=y?"chatgpt_upgrade_plan_success":"chatgpt_downgrade_plan_success";S.logEvent(de,{fromPlan:$,toPlan:o}),kt.logEvent(X,null,{fromPlan:$,toPlan:o}),y?A(!0):b(!0)}const B=P?.renewal_date?new Date(P?.renewal_date).toLocaleDateString(r.locale,{year:"numeric",month:"long",day:"numeric"}):"N/A",ce=y?r.formatMessage({id:"planManagement.successfullyUpdatedSubscription",defaultMessage:"You're now subscribed to ChatGPT {capitalizedUpdatedPlanType}"},{capitalizedUpdatedPlanType:fe(o.toLowerCase())}):r.formatMessage({id:"planManagement.updatedSubscriptionToPlus",defaultMessage:"Your subscription has been updated. Your subscription will change to {capitalizedUpdatedPlanType} on {renewalDateFormatted}."},{renewalDateFormatted:B,capitalizedUpdatedPlanType:fe(o.toLowerCase())});localStorage.setItem(`subscriptionUpdateMessage_${i.id}`,ce)}U.invalidateQueries(ja());const Y=lt.getItem(ct.CheckoutFrom);Y&&Tt[Y]&&(lt.removeItem(ct.CheckoutFrom),window.location.href=Tt[Y]),a()}catch(Y){Y?.detail?.error_type==="card_declined"?c.warning(r.formatMessage({id:"planManagement.cardDeclinedError",defaultMessage:"Payment error. Your card may be invalid or authentication may be needed."}),{hasCloseButton:!0}):c.warning(r.formatMessage({id:"planManagement.errorUpdatingSubscription",defaultMessage:"There was a problem updating your subscription"}),{hasCloseButton:!0}),T&&await L.mutateAsync(s),a()}finally{_(!1)}},{goCost:Z,plusCost:se,proCost:H,currencySymbol:Q}=Os(l.currency);let ne=se;return o===f.GO?ne=Z:o===f.PRO?ne=H:o!==f.PLUS&&va.error(`Invalid target plan type: ${o}`),e.jsx(je,{testId:"modal-plan-management",type:"success",isOpen:t,onClose:C,size:"custom",noPadding:!0,className:"max-w-xl",showCloseButton:!0,title:r.formatMessage({id:"planManagementModal.title",defaultMessage:"Confirm changes"}),removePopoverStyling:!0,children:M?e.jsx(ea,{}):d&&i?e.jsx(Us,{account:i,renewalDate:D,handleUpdate:()=>G(n),isUpdating:u,onClose:C,targetPlanCost:ne,currencySymbol:Q}):x||!P?null:y?e.jsx(Ts,{accountId:s,handleUpdate:()=>G(n),isUpdating:u,onClose:C,initialPlanType:n,updatedPlanType:o,currencySymbol:Q}):e.jsx(As,{renewalDate:P.renewal_date,handleUpdate:()=>G(n),isUpdating:u,onClose:C,targetPlanCost:ne,currentPlanType:n,updatedPlanType:o,currencySymbol:Q})})}function ea(){return e.jsx("div",{className:"flex items-center justify-center p-6",children:e.jsx(Ie,{})})}function Es({adjustmentMessage:t,proratedCreditMessage:a,proratedCreditInfoMessage:s}){return e.jsxs("div",{children:[e.jsxs("div",{className:"mt-4 flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:t}),e.jsx("span",{className:"font-semibold text-green-600",children:a})]}),e.jsx("span",{className:"text-token-text-secondary text-sm",children:s})]})}function Ts({accountId:t,handleUpdate:a,isUpdating:s,onClose:n,currencySymbol:o,updatedPlanType:l,initialPlanType:r}){const c=re(),{data:i,isError:u,isLoading:_}=Kt(t,void 0,Xt(l));if(_)return e.jsx(ea,{});if(u||!i)return null;const d=Ns({data:i,intl:c,currencySymbol:o,currentPlanType:r});return e.jsxs("div",{className:"p-6",children:[e.jsx(Ds,{data:i,currencySymbol:o,updatedPlanType:l}),d.filter(y=>y.value!==0).map((y,N)=>e.jsx(Es,{adjustmentMessage:y.adjustmentMessage,proratedCreditMessage:y.proratedCreditMessage,proratedCreditInfoMessage:y.proratedCreditInfoMessage},N)),e.jsx("hr",{className:"mt-4 mb-4"}),e.jsx(Is,{data:i,currencySymbol:o}),i.default_payment_method&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"mt-4 mb-4"}),e.jsx(Fs,{defaultPaymentMethod:i.default_payment_method})]}),e.jsxs("div",{className:"mt-8 flex justify-end gap-2",children:[e.jsx(Fe,{title:c.formatMessage({id:"planUpgradeModal.cancel",defaultMessage:"Cancel"}),color:"secondary",onClick:n}),e.jsx(Fe,{title:c.formatMessage({id:"planUpgradeModal.payNow",defaultMessage:"Pay now"}),color:"primary",onClick:a,loading:s})]})]})}function Ns({data:t,intl:a,currencySymbol:s,currentPlanType:n}){return[{adjustmentMessage:e.jsx(m,{id:"planUpgradeModal.adjustment",defaultMessage:"Adjustment"}),proratedCreditMessage:e.jsx(m,{id:"planUpgradeModal.proratedCredit",defaultMessage:"-{currencySign}{adjustment}",values:{currencySign:a.formatMessage(s.sign),adjustment:(-t.negative_line_item_total/100).toFixed(2)}}),proratedCreditInfoMessage:e.jsx(m,{id:"planUpgradeModal.proratedCreditInfo",defaultMessage:"Prorated credit for the remainder of your {currentPlanType} subscription",values:{currentPlanType:n}}),value:t.negative_line_item_total},{adjustmentMessage:e.jsx(m,{id:"planUpgradeModal.discount",defaultMessage:"Adjustment"}),proratedCreditMessage:e.jsx(m,{id:"planUpgradeModal.discountAmount",defaultMessage:"-{currencySign}{discount}",values:{currencySign:a.formatMessage(s.sign),discount:(t.discount_amount/100).toFixed(2)}}),proratedCreditInfoMessage:e.jsx(m,{id:"planUpgradeModal.discountInfo",defaultMessage:"Account discount applied"}),value:t.discount_amount},{adjustmentMessage:e.jsx(m,{id:"planUpgradeModal.credits",defaultMessage:"Adjustments"}),proratedCreditMessage:e.jsx(m,{id:"planUpgradeModal.creditsAmount",defaultMessage:"-{currencySign}{credits}",values:{currencySign:a.formatMessage(s.sign),credits:(t.applied_balance/100).toFixed(2)}}),proratedCreditInfoMessage:e.jsx(m,{id:"planUpgradeModal.creditsInfo",defaultMessage:"Credits applied"}),value:t.applied_balance}]}function Ds({data:t,currencySymbol:a,updatedPlanType:s}){const n=re();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:e.jsx(m,{id:"planUpgradeModal.subscription",defaultMessage:"ChatGPT {capitalizedUpdatedPlanType} subscription",values:{capitalizedUpdatedPlanType:fe(s.toLowerCase())}})}),e.jsx("span",{className:"font-semibold",children:e.jsx(m,{id:"planUpgradeModal.subscriptionCost",defaultMessage:"{currencySign}{totalCost}",values:{currencySign:n.formatMessage(a.sign),totalCost:(t.positive_line_item_total/100).toFixed(2)}})})]}),e.jsx("span",{className:"text-token-text-secondary text-sm",children:e.jsx(m,{id:"planUpgradeModal.billingCycle",defaultMessage:"Billed monthly, starting today"})})]})}function Is({data:t,currencySymbol:a}){const s=re();return e.jsxs(e.Fragment,{children:[t.amount_due.tax_amount>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-4 flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:e.jsx(m,{id:"planUpgradeModal.subTotal",defaultMessage:"Subtotal"})}),e.jsx("span",{children:e.jsx(m,{id:"planUpgradeModal.subtotalPrice",defaultMessage:"{currencySign}{totalCost}",values:{currencySign:s.formatMessage(a.sign),totalCost:(t.amount_due.amount_excluding_tax/100).toFixed(2)}})})]}),e.jsxs("div",{className:"mt-2 flex justify-between",children:[e.jsxs("span",{className:"font-semibold",children:[e.jsx(m,{id:"planUpgradeModal.tax",defaultMessage:"Tax"}),e.jsx("span",{className:"text-token-text-secondary font-normal",children:e.jsx(m,{id:"planUpgradeModal.taxPercent",defaultMessage:" {taxPercent}%",values:{taxPercent:(t.amount_due.tax_amount/t.amount_due.amount_excluding_tax*100).toFixed(0)}})})]}),e.jsx("span",{children:e.jsx(m,{id:"planUpgradeModal.taxAmount",defaultMessage:"{currencySign}{tax}",values:{currencySign:s.formatMessage(a.sign),tax:(t.amount_due.tax_amount/100).toFixed(2)}})})]})]}),e.jsxs("div",{className:"mt-2 flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:e.jsx(m,{id:"planUpgradeModal.totalDueToday",defaultMessage:"Total due today"})}),e.jsx("span",{className:"font-semibold",children:e.jsx(m,{id:"planUpgradeModal.totalDueTodayAmount",defaultMessage:"{currencySign}{totalCost}",values:{currencySign:s.formatMessage(a.sign),totalCost:(t.amount_due.amount/100).toFixed(2)}})})]})]})}function Fs({defaultPaymentMethod:t}){return e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:e.jsx(m,{id:"planUpgradeModal.paymentMethod",defaultMessage:"Payment Method"})}),e.jsxs("span",{className:"text-token-text-secondary",children:[t.card_brand?.toUpperCase()," *",t.card_last4]})]})}function As({renewalDate:t,handleUpdate:a,isUpdating:s,onClose:n,targetPlanCost:o,currentPlanType:l,currencySymbol:r,updatedPlanType:c}){const i=re(),u=t?new Date(t).toLocaleDateString(i.locale,{year:"numeric",month:"long",day:"numeric"}):"N/A";return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"p-6",children:[e.jsx("p",{className:"text-token-text-secondary",children:e.jsx(m,{id:"planDowngradeModal.currentSubscription",defaultMessage:"Your current {currentPlanType} subscription will remain active until {renewalDateFormatted}, when it will change to Plus.",values:{renewalDateFormatted:u,currentPlanType:fe(l.toLowerCase())}})}),e.jsxs("div",{className:"bg-token-main-surface-secondary mt-4 rounded-md p-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:e.jsx(m,{id:"planDowngradeModal.newPlan",defaultMessage:"ChatGPT {capitalizedUpdatedPlanType}",values:{capitalizedUpdatedPlanType:fe(c.toLowerCase())}})}),e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(m,{id:"planDowngradeModal.newPlanCost",defaultMessage:"{currencyCode} {currencySign}{planCost}/month",values:{currencyCode:i.formatMessage(r.code),currencySign:i.formatMessage(r.sign),planCost:i.formatMessage(o)}})})]}),e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(m,{id:"planDowngradeModal.billingStart",defaultMessage:"Billing will start on {renewalDateFormatted}",values:{renewalDateFormatted:u}})})]}),e.jsxs("div",{className:"mt-8 flex justify-end gap-2",children:[e.jsx(Fe,{title:i.formatMessage({id:"planDowngradeModal.cancel",defaultMessage:"Cancel"}),color:"secondary",onClick:n}),e.jsx(Fe,{title:i.formatMessage({id:"planDowngradeModal.confirm",defaultMessage:"Confirm"}),color:"primary",onClick:a,loading:s})]})]})})}function Us({account:t,renewalDate:a,handleUpdate:s,isUpdating:n,onClose:o,targetPlanCost:l,currencySymbol:r}){const c=re(),i=t.data.subscriptionStatus.planType,u=fe(i.toLowerCase());return e.jsxs("div",{className:"p-6",children:[e.jsx("p",{className:"text-token-text-secondary",children:e.jsx(m,{id:"planRenewalModal.currentSubscription",defaultMessage:"Your current {planName} subscription will auto-renew on {renewalDate}.",values:{planName:u,renewalDate:a}})}),e.jsxs("div",{className:"bg-token-main-surface-secondary mt-4 rounded-md p-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:e.jsx(m,{id:"planRenewalModal.newPlan",defaultMessage:"ChatGPT {planName}",values:{planName:u}})}),e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(m,{id:"planRenewalModal.newPlanCost",defaultMessage:"{currencyCode} {currencySign}{planCost}/month",values:{currencyCode:c.formatMessage(r.code),currencySign:c.formatMessage(r.sign),planCost:c.formatMessage(l)}})})]}),e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(m,{id:"planRenewalModal.billingStart",defaultMessage:"Billing will auto-renew on {renewalDate}",values:{renewalDate:a}})})]}),e.jsxs("div",{className:"mt-8 flex justify-end gap-2",children:[e.jsx(Fe,{title:c.formatMessage({id:"planRenewalModal.cancel",defaultMessage:"Cancel"}),color:"secondary",onClick:o}),e.jsx(Fe,{title:c.formatMessage({id:"planRenewalModal.confirm",defaultMessage:"Confirm"}),color:"primary",onClick:s,loading:n})]})]})}function Os(t){return t===Lt?{goCost:le.go.goCostInEuros,plusCost:le.plus.plusCostInEuros,proCost:le.pro.proCostInEuros,currencySymbol:Rt}:t===Gt?{goCost:le.go.goCostInPounds,plusCost:le.plus.plusCostInPounds,proCost:le.pro.proCostInPounds,currencySymbol:Bt}:t===Yt?{goCost:le.go.goCostInINR,plusCost:le.plus.plusCostInINR,proCost:le.pro.proCostInINR,currencySymbol:Ea}:{goCost:le.go.goCost,plusCost:le.plus.plusCost,proCost:le.pro.proCost,currencySymbol:Ht}}function Nt(t,a,s,n){let o,l;n===Lt?(o=dt,l=Rt):n===Gt?(o=ut,l=Bt):(o=mt,l=Ht);const r=o*a;let c;if("percentage"in s)c=r*(1-s.percentage/100);else if("value"in s)c=r-s.value;else throw new Error("Invalid discount type");return{formattedDiscountedCost:t.formatNumber(c,{style:"currency",currency:n,minimumFractionDigits:0,maximumFractionDigits:2}),currencySymbol:l}}function ta(t,a,s,n){const o={...a};let l;if(n&&(n.period==="year"?n.num_periods===1?l=t.formatMessage({id:"pricingPlanConstants.promoCostSubtitleForSingleYear",defaultMessage:"for the first year"}):l=t.formatMessage({id:"pricingPlanConstants.promoCostSubtitleForPluralYears",defaultMessage:"for the first {num_years} years"},{num_years:n.num_periods}):n.num_periods===1?l=t.formatMessage({id:"pricingPlanConstants.promoCostSubtitleForSingleMonth",defaultMessage:"for the first month"}):l=t.formatMessage({id:"pricingPlanConstants.promoCostSubtitleForPluralMonths",defaultMessage:"for the first {num_months} months"},{num_months:n.num_periods})),o.costDuration={id:"promoCostDuration",defaultMessage:l,description:"Cost duration for promo plan"},"percentage"in s||"discount_type"in s&&s.discount_type===Be.PERCENTAGE){const r=("percentage"in s?s.percentage:s.amount)/100;o.costInDollars={id:"discountedCost",defaultMessage:Me((1-r)*mt).toString()},o.costInEuros={id:"discountedCostEuros",defaultMessage:Me((1-r)*dt).toString()},o.costInPounds={id:"discountedCostPounds",defaultMessage:Me((1-r)*ut).toString()},o.costInINR={id:"discountedCostInr",defaultMessage:Me((1-r)*jt).toString()}}else if("value"in s||s.discount_type===Be.FIXED){const r="value"in s?s.value:s.amount;o.costInDollars={id:"discountedCost",defaultMessage:Me(mt-r).toString()},o.costInEuros={id:"discountedCostEuros",defaultMessage:Me(dt-r).toString()},o.costInPounds={id:"discountedCostPounds",defaultMessage:Me(ut-r).toString()},o.costInINR={id:"discountedCostInr",defaultMessage:Me(jt-r).toString()}}return o}function Dt(t,a){const s=et(new Date,t);return new Intl.DateTimeFormat(a,{year:"numeric",month:"short",day:"numeric"}).format(s)}function aa({isWebRedesign:t,currentAccount:a,intl:s,billingDetails:n,pricingPlan:o,promoMetadata:l}){if(l||!a.data.subscriptionStatus.discount)return{activeDiscountMetadata:null,scheduledAdditionalLink:null};const r=a.getDaysUntilPlanDiscountExpires(),c=a.data.subscriptionStatus.discount,i=c.discount_start_in_num_periods??0,u=s.formatNumber(c.amount,{style:"currency",currency:n.currency,minimumFractionDigits:0,maximumFractionDigits:2});return i>0?{activeDiscountMetadata:null,scheduledAdditionalLink:e.jsx("div",{className:"mb-3 w-full",children:e.jsx("div",{className:F(t?"font-medium text-[#615EEB]":"text-green-600","px-1 text-sm"),children:c.discount_type===Be.PERCENTAGE?e.jsx(m,{id:"PlusColumn.scheduledPercentDiscount",defaultMessage:"Your {discountPercent}% discount will apply in {numPeriods, plural, one {the next billing period} other {# billing periods}}.",values:{discountPercent:c.amount,numPeriods:i}}):e.jsx(m,{id:"PlusColumn.scheduledFixedDiscount",defaultMessage:"Your {discountFixed} discount will apply in {numPeriods, plural, one {the next billing period} other {# billing periods}}.",values:{discountFixed:u,numPeriods:i}})})})}:(o.cost=ta(s,o.cost,c),c.discount_type===Be.PERCENTAGE?{activeDiscountMetadata:{discount:{percentage:c.amount,expires_at:r?Dt(r,s.locale):void 0}},scheduledAdditionalLink:null}:c.discount_type===Be.FIXED?{activeDiscountMetadata:{discount:{value:c.amount,expires_at:r?Dt(r,s.locale):void 0}},scheduledAdditionalLink:null}:{activeDiscountMetadata:null,scheduledAdditionalLink:null})}function It(t,a,s){let n;switch(t){case"month":n=Na(new Date,a);break;case"year":n=Ta(new Date,a);break}return new Intl.DateTimeFormat(s,{year:"numeric",month:"short",day:"numeric"}).format(n)}function sa({intl:t,pricingPlan:a,planName:s,promoMetadata:n,currency:o}){const{costTitle:l,currencySymbol:r}=os(a,o),c=l?.defaultMessage?.toString()??"20",i=fe(s.toLowerCase()),{schedule:u}=n,_=n.duration?.period??"month",d=n.duration?.num_periods??1,y=u?.start_after_num_periods??0,N=u?.period??_,C=y>0?It(N,y,t.locale):void 0,p=It(_,d+(y>0?y:0),t.locale),v=ta(t,a.cost,n.discount,n.duration??{num_periods:1,period:"month"}),L=r.code.defaultMessage?.toString()??"USD",P=t.formatNumber(parseFloat(c)||0,{style:"currency",currency:L,minimumFractionDigits:0,maximumFractionDigits:2}),x=n?.no_auto_renewal_at_discount_end===!0;let M;switch(_){case"month":y>0?d===1?M=t.formatMessage(O.promoPlanDisclaimerScheduledForSingleMonth,{start_date:C,end_date:p,cost:P,plan_name:i}):M=t.formatMessage(O.promoPlanDisclaimerScheduledForPluralMonths,{num_months:d,start_date:C,end_date:p,cost:P,plan_name:i}):d===1?M=x?t.formatMessage(O.promoPlanDisclaimerNoRenewForSingleMonth,{}):t.formatMessage(O.promoPlanDisclaimerForSingleMonth,{date:p,cost:P,plan_name:i}):M=x?t.formatMessage(O.promoPlanDisclaimerNoRenewForPluralMonths,{num_months:d}):t.formatMessage(O.promoPlanDisclaimerForPluralMonths,{num_months:d,date:p,cost:P,plan_name:i});break;case"year":y>0?d===1?M=t.formatMessage(O.promoPlanDisclaimerScheduledForSingleYear,{start_date:C,end_date:p,cost:P,plan_name:i}):M=t.formatMessage(O.promoPlanDisclaimerScheduledForPluralYears,{num_years:d,start_date:C,end_date:p,cost:P,plan_name:i}):d===1?M=x?t.formatMessage(O.promoPlanDisclaimerNoRenewForSingleYear,{}):t.formatMessage(O.promoPlanDisclaimerForSingleYear,{date:p,cost:P,plan_name:i}):M=x?t.formatMessage(O.promoPlanDisclaimerNoRenewForPluralYears,{num_years:d}):t.formatMessage(O.promoPlanDisclaimerForPluralYears,{num_years:d,date:p,cost:P,plan_name:i});break;case"hour":throw new Error("Period 'hour' is not supported")}const R="<article>"+t.formatMessage(O.termsApply)+"</article> "+M;let j=n.summary;if(y>0){const{formattedDiscountedCost:E}=Nt(t,1,n.discount,o),h=E;switch(_){case"month":d===1?j=t.formatMessage(O.promoSummaryScheduledForSingleMonth,{discounted_cost:h}):j=t.formatMessage(O.promoSummaryScheduledForPluralMonths,{discounted_cost:h,num_months:d});break;case"year":d===1?j=t.formatMessage(O.promoSummaryScheduledForSingleYear,{discounted_cost:h}):j=t.formatMessage(O.promoSummaryScheduledForPluralYears,{discounted_cost:h,num_years:d});break}}let D=v;if(y>0){const{formattedDiscountedCost:E}=Nt(t,1,n.discount,o);let h;switch(_){case"month":d===1?h=t.formatMessage(O.promoCostSubtitleScheduledForSingleMonth,{start_date:C,discounted_cost:E}):h=t.formatMessage(O.promoCostSubtitleScheduledForPluralMonths,{start_date:C,discounted_cost:E,num_months:d});break;case"year":d===1?h=t.formatMessage(O.promoCostSubtitleScheduledForSingleYear,{start_date:C,discounted_cost:E}):h=t.formatMessage(O.promoCostSubtitleScheduledForPluralYears,{start_date:C,discounted_cost:E,num_years:d});break}D={...a.cost,costDuration:{id:"promoCostDurationScheduled",defaultMessage:h,description:"Cost duration subtitle for scheduled promo indicating when discount starts and for how long"}}}return a={...a,summary:{id:"promoSummary",defaultMessage:j},disclaimer:{id:"promoDisclaimer",defaultMessage:R,article:"https://help.openai.com/en/articles/10492689-chatgpt-plus-promotions-referrals"},cost:D,callToAction:{...a.callToAction,promo:{id:"pricingPlanConstants.promo.callToAction",defaultMessage:"Apply to My Subscription",description:"Payment call to action for existing subscribers adding a discount to their plan"}}},a}const O=Se({specialOffer:{id:"pricingPlanConstants.specialOffer",defaultMessage:"SPECIAL OFFER"},promoPlanDisclaimerForPluralMonths:{id:"pricingPlanConstants.promoPlanDisclaimerForPluralMonths",defaultMessage:"Promo pricing applies for {num_months} months. Starting {date}, ChatGPT {plan_name} will continue at {cost}/month. Cancel anytime."},promoPlanDisclaimerScheduledForPluralMonths:{id:"pricingPlanConstants.promoPlanDisclaimerScheduledForPluralMonths",defaultMessage:"Promo pricing applies for {num_months} months starting {start_date}. Starting {end_date}, ChatGPT {plan_name} will continue at {cost}/month. Cancel anytime."},promoPlanDisclaimerScheduledForSingleMonth:{id:"pricingPlanConstants.promoPlanDisclaimerScheduledForSingleMonth",defaultMessage:"Promo pricing applies for 1 month starting {start_date}. Starting {end_date}, ChatGPT {plan_name} will continue at {cost}/month. Cancel anytime."},promoPlanDisclaimerScheduledForPluralYears:{id:"pricingPlanConstants.promoPlanDisclaimerScheduledForPluralYears",defaultMessage:"Promo pricing applies for {num_years} years starting {start_date}. Starting {end_date}, ChatGPT {plan_name} will continue at {cost}/year. Cancel anytime."},promoPlanDisclaimerScheduledForSingleYear:{id:"pricingPlanConstants.promoPlanDisclaimerScheduledForSingleYear",defaultMessage:"Promo pricing applies for 1 year starting {start_date}. Starting {end_date}, ChatGPT {plan_name} will continue at {cost}/year. Cancel anytime."},promoPlanDisclaimerForSingleMonth:{id:"pricingPlanConstants.promoPlanDisclaimerForSingleMonth",defaultMessage:"Promo pricing applies for 1 month. Starting {date}, ChatGPT {plan_name} will continue at {cost}/month. Cancel anytime."},promoPlanDisclaimerNoRenewForPluralMonths:{id:"pricingPlanConstants.promoPlanDisclaimerNoRenewForPluralMonths",defaultMessage:"Promo pricing applies for {num_months} months."},promoPlanDisclaimerNoRenewForSingleMonth:{id:"pricingPlanConstants.promoPlanDisclaimerNoRenewForSingleMonth",defaultMessage:"Promo pricing applies for 1 month."},promoCostSubtitleScheduledForPluralMonths:{id:"pricingPlanConstants.promoCostSubtitleScheduledForPluralMonths",defaultMessage:"Starting {start_date}: {discounted_cost}/month for {num_months} months"},promoCostSubtitleScheduledForSingleMonth:{id:"pricingPlanConstants.promoCostSubtitleScheduledForSingleMonth",defaultMessage:"Starting {start_date}: {discounted_cost}/month for 1 month"},promoCostSubtitleScheduledForPluralYears:{id:"pricingPlanConstants.promoCostSubtitleScheduledForPluralYears",defaultMessage:"Starting {start_date}: {discounted_cost}/year for {num_years} years"},promoCostSubtitleScheduledForSingleYear:{id:"pricingPlanConstants.promoCostSubtitleScheduledForSingleYear",defaultMessage:"Starting {start_date}: {discounted_cost}/year for 1 year"},promoPlanDisclaimerForPluralYears:{id:"pricingPlanConstants.promoPlanDisclaimerForPluralYears",defaultMessage:"Promo pricing applies for {num_years} years. Starting {date}, ChatGPT {plan_name} will continue at {cost}/year. Cancel anytime."},promoPlanDisclaimerForSingleYear:{id:"pricingPlanConstants.promoPlanDisclaimerForSingleYear",defaultMessage:"Promo pricing applies for 1 year. Starting {date}, ChatGPT {plan_name} will continue at {cost}/year. Cancel anytime."},promoPlanDisclaimerNoRenewForPluralYears:{id:"pricingPlanConstants.promoPlanDisclaimerNoRenewForPluralYears",defaultMessage:"Promo pricing applies for {num_years} years."},promoPlanDisclaimerNoRenewForSingleYear:{id:"pricingPlanConstants.promoPlanDisclaimerNoRenewForSingleYear",defaultMessage:"Promo pricing applies for 1 year."},termsApply:{id:"pricingPlanConstants.termsApply",defaultMessage:"Terms apply."},promoSummaryScheduledForPluralMonths:{id:"pricingPlanConstants.promoSummaryScheduledForPluralMonths",defaultMessage:"Pay for the first month, then the next {num_months} months are {discounted_cost}."},promoSummaryScheduledForSingleMonth:{id:"pricingPlanConstants.promoSummaryScheduledForSingleMonth",defaultMessage:"Pay for the first month, then the next month is {discounted_cost}."},promoSummaryScheduledForPluralYears:{id:"pricingPlanConstants.promoSummaryScheduledForPluralYears",defaultMessage:"Pay for the first year, then the next {num_years} years are {discounted_cost}."},promoSummaryScheduledForSingleYear:{id:"pricingPlanConstants.promoSummaryScheduledForSingleYear",defaultMessage:"Pay for the first year, then the next year is {discounted_cost}."}}),Te=f.PLUS,Ls=()=>Ue({queryKey:["has-app-store-subscription-in-billing-retry"],queryFn:async()=>await Vt.safeGet("/subscriptions/has_app_store_subscription_in_billing_retry")});function na(t,a){const s=t.data.subscriptionStatus.planType,n=t.getNextPlanType();let o=t.getDaysUntilPlanChanges(),l=n===f.PLUS&&s===f.PRO||n===f.GO&&[f.PRO,f.PLUS].includes(s);return a&&!l&&(o=t.getDaysUntilPlanRenews(),l=!0),{daysUntilPlanChanges:o,isDowngradeScheduled:l,nextPlanType:n}}function oa(t,a){const s=et(new Date,t);return new Intl.DateTimeFormat(a,{year:"numeric",month:"short",day:"numeric"}).format(s)}function Ft(t){return Ua.includes(t)?t:"USD"}function Rs(t,a,s,n){if(t==="plus-10-for-3-months")switch(s.currency){case"USD":{const o={value:10,currency_code:Ft(s.currency)};return{plan_name:ke.PLUS,title:"",summary:a.formatMessage(n?Ge.headline:De.plusSummary),discount:o,duration:{num_periods:3,period:"month"},price_period:"recurring",promotion_type:"discount",promotion_type_label:null}}case"EUR":case"GBP":return{plan_name:ke.PLUS,title:"",summary:a.formatMessage(n?Ge.headline:De.plusSummary),discount:{percentage:52.18},duration:{num_periods:3,period:"month"},price_period:"recurring",promotion_type:"discount",promotion_type_label:null};case"INR":return null}else if(t==="plus-10-for-12-mos")switch(s.currency){case"USD":{const o={value:10,currency_code:Ft(s.currency)};return{plan_name:ke.PLUS,title:"",summary:a.formatMessage(n?Ge.headline:De.plusSummary),discount:o,duration:{num_periods:12,period:"month"},price_period:"recurring",promotion_type:"discount",promotion_type_label:null}}case"EUR":case"GBP":return{plan_name:ke.PLUS,title:"",summary:a.formatMessage(n?Ge.headline:De.plusSummary),discount:{percentage:52.18},duration:{num_periods:12,period:"month"},price_period:"recurring",promotion_type:"discount",promotion_type_label:null};case"INR":return null}return null}const Gs=({analyticsParams:t,className:a,currentAccount:s,planLoading:n,isPromoLoading:o,onUpgradeButtonClick:l,setPlanLoading:r,plusPricingPlan:c=null,shouldShowAdditionalLinks:i=!0,billingDetails:u,promoCode:_=null,promoMetadata:d=null,onClose:y,disableForMobile:N=!1,type:C,isWebRedesign:p,shouldUseComparisonSpacing:v,autoUpgrade:L=!1,fromiOSWebview:P=!1})=>{const{data:x}=Da(),{data:M,refetch:R}=Ue(at),{data:{value:j}={}}=Ls(),{trackSelectedPixels:D}=ft({key:f.PLUS}),E=s.features,h=ve(),A=!Ia(h),b=re(),I=ze(),T=He(h,"1627380539");let w=c||rs({isWebRedesign:p,inGPT5Gate:T});const U=ws({ctx:h,shouldLogExposure:!1}),{data:G}=Jt(U);d==null&&G?.coupon===U&&G?.state==="eligible"&&ks({ctx:h,shouldLogExposure:!0})&&(d=Rs(U,b,u,p),_=U);const{eligible:Z,campaignId:se}=is();let H;d==null&&Z&&(!_&&se&&(H=se),d={plan_name:ke.PLUS,title:"",summary:b.formatMessage(p?Ge.headline:De.plusSummary),discount:{percentage:100},duration:{num_periods:1,period:"month"},price_period:"recurring",promotion_type:"discount",promotion_type_label:b.formatMessage(K.specialOffer)});const Q=g.useRef(!1),ne=g.useRef(!1),[$,Y]=g.useState(!1),[B,ce]=g.useState(!1),[de,X]=g.useState(!1),{recentlyDowngraded:ue}=nt();let z=[];const V=s.isOrWasPaidCustomer(),q=s.hasPaidSubscription(),W=q&&s.isPlus(),k=q&&s.isPro(),ee=s.getLastActiveSubscription(),J=_e(h,"3950229590"),{prepareCheckoutSession:te,navigateToCheckout:ia}=ht(),la=Fa(x),ot=E.includes("disable_plus_upgrade_ui")&&!V,{daysUntilPlanChanges:Ct,isDowngradeScheduled:ca,nextPlanType:St}=na(s,ue),ie=g.useMemo(()=>({...t,promoCode:_,promoCampaign:H,planType:Te,isUpgradeUiDisabled:ot}),[t,_,H,ot]),da=!!M?.email,Oe=g.useRef(new Map),rt=g.useRef(null);g.useEffect(()=>{if(!W&&J.get("enabled_prefetch_checkout_for_plus",!1)){const oe={plan_name:ke.PLUS,billing_details:u,promo_code:_,promo_campaign:H},ae=JSON.stringify(oe);if(!Oe.current.has(ae)){S.logEventWithStatsig("Account Pay: Prefetch Checkout Session","chatgpt_account_payment_modal_prefetch_checkout_session",ie),Oe.current.clear();const Ce=J.get("skip_sentinel_checkout",!1),Ke=te(oe,{skipSentinelCheckout:Ce,fromiOSWebview:P});Oe.current.set(ae,Ke)}}},[te,ie,u,_,E,W,J,se,H,P]);const ua=()=>{const oe={plan_name:ke.PLUS,billing_details:u,promo_code:_,promo_campaign:H},ae=Oe.current.get(JSON.stringify(oe));if(ae)return S.logEventWithStatsig("Account Pay: Using Prefetched Checkout Session","chatgpt_account_payment_modal_using_prefetched_checkout_session",ie),ae;S.logEventWithStatsig("Account Pay: Click to Fetch Checkout Session","chatgpt_account_payment_modal_click_to_fetch_checkout_session",ie),Oe.current.clear();const Ce=J.get("skip_sentinel_checkout",!1);return te(oe,{skipSentinelCheckout:Ce,fromiOSWebview:P})},ma=async({skipEmailCheck:oe})=>{if(!da&&!oe){X(!0);return}r(f.PLUS),S.logEvent("Account Pay: Payment Checkout Clicked",ie),ge(h,"chatgpt_account_payment_modal_upgrade_button_click",Te),rt.current=Date.now();try{const ae=await ua();let Ce;rt.current&&(Ce=Date.now()-rt.current),S.logEvent("Account Pay: Navigating to Payment Checkout",{...ie,url:ae.url??"",latency_ms:Ce});const Ke={url:String(ae.url??"")};Ce!==void 0&&(Ke.latency_ms=Ce.toString()),ge(h,"chatgpt_account_payment_modal_navigating_to_checkout",Te,Ke),await ia(ae)}catch{I.warning(b.formatMessage(K.paymentErrorWarning),{hasCloseButton:!0})}r(null)},pa=()=>{S.logEvent("Account Portal: Click iOS Manage Subscription",ie)},ga=()=>{S.logEvent("Account Portal: Click Android Manage Subscription",ie)},fa=W&&ee.purchase_origin_platform===Ae.MOBILE_IOS,ha=W&&ee.purchase_origin_platform===Ae.MOBILE_ANDROID;la&&!W&&z.push(e.jsx(Pe,{to:Aa,target:"_blank",className:F(p?"px-1 font-medium":"px-2","underline"),children:e.jsx(m,{...K.limitsApply})},"row-plus-plan-usage-limits")),fa&&z.push(e.jsx(Pe,{to:zt,target:"_blank",onClick:pa,className:F(p?"px-1 font-medium":"px-2","underline"),children:b.formatMessage(Xe.manageSubscriptionIos.callToAction)},"row-plus-plan-manage-ios")),ha&&z.push(e.jsx(Pe,{to:Wt,target:"_blank",onClick:ga,className:F(p?"px-1 font-medium":"px-2","underline"),children:b.formatMessage(Xe.manageSubscriptionAndroid.callToAction)},"row-plus-plan-manage-android")),W&&V&&z.push(e.jsx(Pe,{target:"_blank",to:gt,onClick:st,className:F(p?"px-1 font-medium":"px-2","underline"),children:e.jsx(m,{...K.billingHelp})},"row-plus-plan-help-link"));const $e=({skipAppStoreSubscriptionInBillingRetryCheck:oe=!1,skipEmailCheck:ae=!1}={})=>{if(j&&!oe)return Y(!0);if(l)return l(u,ie);q&&!W&&!s.isActiveSubscriptionGratis()?(S.logEvent("Account Pay: Payment Checkout Clicked",ie),ge(h,"chatgpt_account_payment_modal_upgrade_button_click",Te),ce(!0)):(D(),ma({skipEmailCheck:ae}))};g.useEffect(()=>{!L||ne.current||(ne.current=!0,$e())},[L]);const Ve=(oe,ae)=>e.jsx(pt,{planType:Te,isCurrentPlan:W&&!qe,disabled:oe,onClick:ae,testId:"select-plan-button-plus-upgrade",activeColor:k?"secondary":p&&C==="highlight"||C==="promo"?"purple":C==="standard"||ya?"primary":void 0,children:n===f.PLUS&&!B?e.jsx(Ie,{}):qe&&W&&w.callToAction.promo?b.formatMessage(w.callToAction.promo):W?b.formatMessage(w.callToAction.active):Mt&&A&&w.callToAction.inactiveUnauthenticated?b.formatMessage(w.callToAction.inactiveUnauthenticated):b.formatMessage(Ze({ctx:h,planType:f.PLUS}))});yt(de,{plan:ie});const qe=d!=null,ya=d?.promotion_type==="student_discount",Mt=d!=null&&"referrer_name"in d,Pa=(!W||qe)&&n==null;z=qe?[]:z;const{activeDiscountMetadata:xt,scheduledAdditionalLink:bt}=aa({isWebRedesign:p,currentAccount:s,intl:b,billingDetails:u,pricingPlan:w,promoMetadata:d});if(bt&&z.unshift(bt),xt&&(w.summary=De.plusSummaryWithDiscount),d&&(w=sa({intl:b,pricingPlan:w,promoMetadata:d,currency:u.currency,planName:f.PLUS})),o!=null&&o)return null;const _a=Bs(s);return e.jsxs(e.Fragment,{children:[e.jsx(We,{planType:Te,elementId:$t,pricingPlan:w,shouldUseComparisonSpacing:v,callToActionButton:ot?e.jsx("div",{className:"relative w-full",children:e.jsx(xe,{side:"bottom",sideOffset:20,label:b.formatMessage(K.highDemandDisabledText),children:Ve(!0,()=>{})})}):N&&_a?e.jsx("div",{children:e.jsx(xe,{side:"top",sideOffset:20,label:b.formatMessage({id:"I2JCGZ",defaultMessage:"Mobile subscriptions are currently not eligible for this promotion."}),onOpenChange:oe=>{oe&&!Q.current&&(Mt&&Qt.logMobileSubscriptionTooltipOpen(),Q.current=!0)},children:e.jsx("div",{children:Ve(!0,()=>{})})})}):e.jsxs("div",{children:[Ct&&ca&&St?e.jsx(xe,{side:"top",sideOffset:20,label:e.jsx(m,{id:"Rd9wuM",defaultMessage:"Your subscription will change to {nextPlanType} on {date}.",values:{date:oa(Ct,b.locale),nextPlanType:fe(St.toLowerCase())}}),children:Ve(!0,()=>{})}):Ve(!Pa,$e),e.jsx(Pt,{isOpen:$,onClose:()=>Y(!1),onContinue:()=>$e({skipAppStoreSubscriptionInBillingRetryCheck:!0}),analyticsParams:ie}),B&&e.jsx(_t,{isOpen:B,onClose:()=>ce(!1),accountId:s.id,initialPlanType:s.planType,updatedPlanType:f.PLUS,billingDetails:u})]}),secondaryCallToActionButton:C==="promo"?e.jsx(pe,{size:"large",color:"secondary",onClick:y,children:e.jsx(m,{...K.notNow})}):null,additionalLinks:i?z:[],type:C,promoMetadata:d,activeDiscountMetadata:xt,billingDetails:u,className:a,isWebRedesign:p}),e.jsx(je,{testId:"modal-add-email",isOpen:de,onClose:()=>X(!1),type:"success",className:"max-w-sm",children:e.jsx(tt,{enterEmailTitle:b.formatMessage(K.addEmailTitle),enterEmailDescription:b.formatMessage(K.addEmailDescription),onVerified:()=>{R(),X(!1),$e({skipEmailCheck:!0})},cancelFlowButton:e.jsx(pe,{className:"w-full rounded-md",color:"secondary",onClick:()=>X(!1),children:e.jsx(m,{...K.cancelAddEmail})})})})]})};function Bs(t){const a=t.hasPaidSubscription(),s=t.getLastActiveSubscription(),n=a&&s.purchase_origin_platform===Ae.MOBILE_IOS,o=a&&s.purchase_origin_platform===Ae.MOBILE_ANDROID;return n||o}const K=Se({specialOffer:{id:"pricingPlanConstants.specialOffer",defaultMessage:"SPECIAL OFFER"},addEmailTitle:{id:"AccountPaymentModal.addEmailTitle",defaultMessage:"Email required"},addEmailDescription:{id:"AccountPaymentModal.addEmailDescription",defaultMessage:"You'll be able to login with this email. It will also be used for account updates (like password resets) and information about OpenAI services."},cancelAddEmail:{id:"AccountPaymentModal.cancelAddEmail",defaultMessage:"Cancel"},haveExistingPlan:{id:"AccountPaymentModal.haveExistingPlan",defaultMessage:"Have an existing plan?"},billingHelp:{id:"AccountPaymentModel.billingHelp",defaultMessage:"I need help with a billing issue"},paymentErrorWarning:{id:"AccountPaymentModal.paymentErrorWarning",defaultMessage:"The payments page encountered an error. Please try again. If the problem continues, please visit help.openai.com."},accountErrorWarning:{id:"AccountPaymentModal.accountErrorWarning",defaultMessage:"The account management page encountered an error. Please try again. If the problem continues, please visit help.openai.com."},limitsApply:{id:"xda4i3",defaultMessage:"Limits apply"},notNow:{id:"AccountPaymentModal.notNow",defaultMessage:"Not Now"},highDemandDisabledText:{id:"AccountPaymentModal.highDemandDisabledText",defaultMessage:"Due to high demand, we've temporarily paused upgrades."}}),Re=f.SELF_SERVE_BUSINESS,Ys=({analyticsParams:t,planLoading:a,billingDetails:s,isWebRedesign:n,type:o=me.standard,shouldUseComparisonSpacing:l})=>{const{data:r,refetch:c}=Ue(at),i=re(),u=ve(),_=He(u,"1627380539"),d=Oa(u),y=Ut(),N=ps(),[C,p]=g.useState(!1),v=d?.isTeam(),L=d?.isPlus(),P={...t,planType:Re},x=!!r?.email,M=vt(u,"4293611158").get("enabled",!1),D=La().includes("de-DE")&&vt(u,"433209173").get("enabled",!1),E=!D&&_e(u,"111733276").get("show_upgrade_page_v2_copy",!1);let h=ls(M,n,_,D,E);const A=cs(),{data:b}=Jt(A??""),I=ds(),T=b??(I.eligible?{coupon:I.campaignId,state:"eligible"}:void 0),w=T?.coupon===us&&T?.state==="eligible",U=T&&ms(T?.coupon)&&T?.state==="eligible";let G=null;(w||U)&&(G={plan_name:"chatgptteamplan",title:"",summary:"",discount:{value:0,currency_code:"USD"},duration:{num_periods:1,period:"month"},price_period:"recurring",promotion_type:"discount",promotion_type_label:null}),w?h={...h,cost:{...h.cost,costInDollars:we.promoCost,costInPounds:we.promoCost,costInEuros:we.promoCost,costInINR:we.promoCostINR,costDuration:we.promoCostDuration},disclaimer:s.currency===Yt?we.team1dollarPromoDisclaimerINR:we.team1dollarPromoDisclaimer}:U&&(h={...h,cost:{...h.cost,costInDollars:Ee.promoCost,costInPounds:Ee.promoCost,costInEuros:Ee.promoCost,costInINR:Ee.promoCostINR,costDuration:Ee.promoCostDuration},disclaimer:Ee.teamFreeTrialPromoDisclaimerWithPerSeatMonthlyPrice});const Z=se=>{if(!x&&!se){p(!0);return}S.logEvent("Account Pay: Payment Checkout Clicked",P),ge(u,"chatgpt_account_payment_modal_upgrade_button_click",Re);const Q=new URLSearchParams(window.location.search).get("referrer")??document.referrer;Ga.setPurchaseWorkspaceData({minimumSeats:N,billingDetails:s,promoData:T?.state==="eligible"?T:void 0,referrer:Q}),Ba(y)};return yt(C,{plan:P}),e.jsxs(e.Fragment,{children:[e.jsx(We,{planType:Re,isWebRedesign:n,className:`${n?"md:max-w-117":""}`,elementId:Ra,pricingPlan:h,promoData:T,promoMetadata:G,type:o,shouldUseComparisonSpacing:l,isBusinessUpgradeV2CopyEnabled:E,useRecommendedBadge:o===me.highlight,callToActionButton:e.jsxs("div",{className:"flex flex-col gap-2",children:[v&&e.jsx(pt,{planType:Re,isCurrentPlan:!0,disabled:a!=null||v,onClick:()=>Z(),testId:"select-plan-button-teams-upgrade",children:i.formatMessage(h.callToAction.active)}),e.jsx("div",{className:"w-full",children:e.jsx(pt,{planType:Re,disabled:a!=null,activeColor:o===me.highlight?"purple":void 0,onClick:()=>Z(),testId:"select-plan-button-teams-create",children:v||L?i.formatMessage(h.callToAction.create):i.formatMessage(h.callToAction.inactive)})})]}),billingDetails:s}),e.jsx(je,{testId:"modal-add-email",isOpen:C,onClose:()=>p(!1),type:"success",className:"max-w-sm",children:e.jsx(tt,{enterEmailTitle:i.formatMessage(K.addEmailTitle),enterEmailDescription:i.formatMessage(K.addEmailDescription),onVerified:async()=>{p(!1),await c(),Z(!0)}})})]})},Ne=f.PRO,ra=()=>Ue({queryKey:["has-app-store-subscription-in-billing-retry"],queryFn:async()=>await Vt.safeGet("/subscriptions/has_app_store_subscription_in_billing_retry")}),Hs=({analyticsParams:t,currentAccount:a,planLoading:s,onSubmit:n,setPlanLoading:o,billingDetails:l,isWebRedesign:r,autoUpgrade:c=!1,shouldUseComparisonSpacing:i=!1,fromiOSWebview:u=!1})=>{const{data:_,isError:d}=ra(),y=ve(),{data:N,refetch:C}=Ue(at),p=re(),v=ze(),[L]=Ot(),{trackSelectedPixels:P}=ft({key:f.PRO}),x=L.get("checkout_from"),[M,R]=g.useState(!1),[j,D]=g.useState(!1),[E,h]=g.useState(!1),A=g.useRef(!1),b=a.getLastActiveSubscription(),I=a.isOrWasPaidCustomer(),T=a.hasPaidSubscription(),w=T&&a.isPro(),U=!!N?.email,{prepareCheckoutSession:G,navigateToCheckout:Z}=ht(),{recentlyDowngraded:se}=nt(),{daysUntilPlanChanges:H,isDowngradeScheduled:Q}=na(a,se),ne=He(y,"1627380539"),$=gs({isWebRedesign:r,inGPT5Gate:ne}),Y=[],B={...t,planType:Ne},ce=T&&b.purchase_origin_platform===Ae.MOBILE_IOS,de=T&&b.purchase_origin_platform===Ae.MOBILE_ANDROID,X=async J=>{if(!U&&!J){h(!0);return}o(f.PRO),S.logEvent("Account Pay: Payment Checkout Clicked",B),ge(y,"chatgpt_account_payment_modal_upgrade_button_click",Ne);try{const te=await G({plan_name:"chatgptpro",billing_details:l},{fromiOSWebview:u});n?.(),P(),S.logEvent("Account Pay: Navigating to Payment Checkout",{...B,url:te.url??""}),ge(y,"chatgpt_account_payment_modal_navigating_to_checkout",Ne,{url:te.url??""}),x==="vza493q"&&lt.setItem(ct.CheckoutFrom,x),await Z(te)}catch{v.warning(p.formatMessage(K.paymentErrorWarning),{hasCloseButton:!0})}o(null)};g.useEffect(()=>{!c||A.current||(A.current=!0,k())},[c]);const ue=()=>{S.logEvent("Account Portal: Click iOS Manage Subscription",B)},z=()=>{S.logEvent("Account Portal: Click Android Manage Subscription",B)};w&&ce&&Y.push(e.jsx(Pe,{to:zt,target:"_blank",onClick:ue,className:F(r?"px-1 font-medium":"px-2","underline"),children:p.formatMessage(Xe.manageSubscriptionIos.callToAction)},"row-plus-plan-manage-ios")),w&&de&&Y.push(e.jsx(Pe,{to:Wt,target:"_blank",onClick:z,className:F(r?"px-1 font-medium":"px-2","underline"),children:p.formatMessage(Xe.manageSubscriptionAndroid.callToAction)},"row-plus-plan-manage-android")),I&&Y.push(e.jsx(Pe,{target:"_blank",to:gt,onClick:st,className:F(r?"px-1 font-medium":"px-2","underline"),children:e.jsx(m,{...K.billingHelp})},"row-plus-plan-help-link"));const V=function(){R(!M)},q=function(){D(!j)},W=He(y,"1382475798"),k=async()=>{const J=a.hasPaidSubscription(),te=W&&a.isActiveSubscriptionGratis();J&&!te?(S.logEvent("Account Pay: Payment Checkout Clicked",B),ge(y,"chatgpt_account_payment_modal_upgrade_button_click",Ne),D(!0)):await X()},ee=d||!_||!_.value?k:()=>{V()};return yt(E,{plan:B}),e.jsxs(e.Fragment,{children:[e.jsx(We,{planType:Ne,pricingPlan:$,callToActionButton:e.jsxs("div",{children:[ce||de?e.jsx(xe,{side:"top",sideOffset:20,label:p.formatMessage(zs.switchToMobile),onOpenChange:J=>{J&&(S.logEvent("Account Pay: Show Mobile Subscription Tooltip",B),ge(y,"chatgpt_account_payment_modal_show_mobile_subscription_tooltip",Ne))},children:e.jsx(pe,{fullWidth:!0,size:"large",color:"primary",disabled:!0,"data-testid":"select-plan-button-pro-upgrade",children:p.formatMessage(Ze({ctx:y,planType:f.PRO}))})}):Q&&H?e.jsx(xe,{side:"top",sideOffset:20,label:e.jsx(m,{id:"MUQGzU",defaultMessage:"Your subscription will remain active until {date}, when it will change to {nextPlanType}.",values:{date:oa(H,p.locale),nextPlanType:fe(a.getNextPlanType()?.toLowerCase()??"")}}),children:e.jsx(pe,{fullWidth:!0,size:"large",color:"primary",disabled:w||s!=null,"data-testid":"select-plan-button-pro-upgrade",className:w||s!=null?"bg-token-sidebar-surface-tertiary text-token-text-primary hover:bg-token-sidebar-surface-tertiary dark:bg-token-text-tertiary dark:text-token-text-primary dark:hover:bg-token-text-tertiary border-none font-semibold":"",children:s===f.PRO&&!j?e.jsx(Ie,{}):w?p.formatMessage($.callToAction.active):p.formatMessage(Ze({ctx:y,planType:f.PRO}))})}):e.jsx(pe,{fullWidth:!0,size:"large",color:"primary",disabled:w||s!=null,onClick:ee,"data-testid":"select-plan-button-pro-upgrade",className:w||s!=null?"bg-token-sidebar-surface-tertiary text-token-text-primary hover:bg-token-sidebar-surface-tertiary dark:bg-token-text-tertiary dark:text-token-text-primary dark:hover:bg-token-text-tertiary border-none font-semibold":"",children:s===f.PRO&&!j?e.jsx(Ie,{}):w?p.formatMessage($.callToAction.active):p.formatMessage(Ze({ctx:y,planType:f.PRO}))}),e.jsx(Pt,{isOpen:M,onClose:V,onContinue:X,analyticsParams:B}),j&&e.jsx(_t,{isOpen:j,onClose:q,accountId:a.id,initialPlanType:a.planType,updatedPlanType:f.PRO,billingDetails:l})]}),additionalLinks:Y,className:"bg-token-main-surface-primary",billingDetails:l,isWebRedesign:r,shouldUseComparisonSpacing:i}),e.jsx(je,{testId:"modal-add-email",isOpen:E,onClose:()=>h(!1),type:"success",className:"max-w-sm",children:e.jsx(tt,{enterEmailTitle:p.formatMessage(K.addEmailTitle),enterEmailDescription:p.formatMessage(K.addEmailDescription),onVerified:()=>{C(),h(!1),X(!0)},cancelFlowButton:e.jsx(pe,{className:"w-full rounded-md",color:"secondary",onClick:()=>h(!1),children:e.jsx(m,{...K.cancelAddEmail})})})})]})},zs=Se({switchToPersonalAccount:{id:"y5FjSF",defaultMessage:"Switch to a personal account to upgrade"},switchToMobile:{id:"gbjsg6",defaultMessage:"It looks like you already have an active mobile subscription. Switch to your mobile app to upgrade"}});function Ws(t,a){const s=et(new Date,t);return new Intl.DateTimeFormat(a,{year:"numeric",month:"short",day:"numeric"}).format(s)}function $s({testId:t,activeColor:a,children:s,...n}){return e.jsx(pe,{fullWidth:!0,size:"large",color:a??"primary","data-testid":t,...n,children:s})}function Vs(t,a){const s=t.planType,n=t.getNextPlanType(),o=t.getDaysUntilPlanChanges(),l=n&&be(n)<be(s);return a?{daysUntilPlanChanges:t.getDaysUntilPlanRenews(),isDowngradeScheduled:!0}:{daysUntilPlanChanges:o,isDowngradeScheduled:l}}function qs({currentAccount:t,children:a,disableForMobile:s,promoMetadata:n,planType:o,downgradeToGoDisabled:l}){const{recentlyDowngraded:r}=nt(),c=re(),{daysUntilPlanChanges:i,isDowngradeScheduled:u}=Vs(t,r),_=g.useRef(!1),d=n!=null&&"referrer_name"in n,y=fs(t);return s&&!y?e.jsx(xe,{side:"top",sideOffset:20,label:c.formatMessage({id:"I2JCGZ",defaultMessage:"Mobile subscriptions are currently not eligible for this promotion."}),onOpenChange:C=>{C&&!_.current&&(d&&Qt.logMobileSubscriptionTooltipOpen(),_.current=!0)},children:a}):l?e.jsx(xe,{side:"top",labelTextAlign:"left",sideOffset:20,label:c.formatMessage({id:"AccountPaymentModal.primaryCTA.downgradeToGoDisabledTooltip",defaultMessage:"Downgrading to Go is not yet available. To purchase, you must first cancel your current plan."}),children:a}):u&&i?e.jsx(xe,{side:"top",sideOffset:20,label:e.jsx(m,{id:"3UZynm",defaultMessage:"Your subscription will change to {planType} on {date}.",values:{date:Ws(i,c.locale),planType:fe(o.toLowerCase())}}),children:a}):e.jsx(e.Fragment,{children:a})}function Ks({analyticsParams:t,billingDetails:a,currentAccount:s,planType:n,planLoading:o,setPlanLoading:l,testId:r,activeColor:c,disableForMobile:i=!1,disabled:u,downgradeToGoDisabled:_=!1,inhouseCheckoutExperimentEnabled:d=!1,loading:y=!1,overrideOnClick:N,promoCode:C,promoMetadata:p,autoUpgrade:v=!1,fromiOSWebview:L=!1,children:P,...x}){const{data:M,refetch:R}=Ue(at),{trackSelectedPixels:j}=ft({key:n}),D=ve(),{data:{value:E}={}}=ra(),[h,A]=g.useState(!1),[b,I]=g.useState(!1),T=g.useRef(null),[w,U]=g.useState(!1),G=g.useRef(!1),Z=g.useRef(new Map),se=ze(),H=re(),Q=s.planType,ne=be(n)<be(Q),$=p?.plan_name===Et(n)&&p?.plan_type_change==="equal",Y=_e(D,"3950229590"),{prepareCheckoutSession:B,navigateToCheckout:ce}=ht(),de=()=>{const z={plan_name:Et(n),billing_details:a,promo_code:C},V=Z.current.get(JSON.stringify(z));if(V)return S.logEventWithStatsig("Account Pay: Using Prefetched Checkout Session","chatgpt_account_payment_modal_using_prefetched_checkout_session",t),V;S.logEventWithStatsig("Account Pay: Click to Fetch Checkout Session","chatgpt_account_payment_modal_click_to_fetch_checkout_session",t);let q=!1;return d&&(Z.current.clear(),q=Y.get("skip_sentinel_checkout",!1)),B(z,{skipSentinelCheckout:q,fromiOSWebview:L})},X=async({skipEmailCheck:z})=>{if(!M?.email&&!z){U(!0);return}l(n),S.logEvent("Account Pay: Payment Checkout Clicked",t),ge(D,"chatgpt_account_payment_modal_upgrade_button_click",n),T.current=performance.now();try{const V=await de();let q;T.current&&(q=performance.now()-T.current),S.logEvent("Account Pay: Navigating to Payment Checkout",{...t,url:V.url??"",latency_ms:q});const W={url:String(V.url??"")};q!==void 0&&(W.latency_ms=q.toString()),ge(D,"chatgpt_account_payment_modal_navigating_to_checkout",n,W),await ce(V)}catch{se.warning(H.formatMessage(Je.paymentErrorWarning),{hasCloseButton:!0})}l(null)},ue=({skipAppStoreSubscriptionInBillingRetryCheck:z=!1,skipEmailCheck:V=!1}={})=>{if(E&&!z)return A(!0);if(N)return N();ne||$?(S.logEvent("Account Pay: Payment Checkout Clicked",t),ge(D,"chatgpt_account_payment_modal_upgrade_button_click",n),I(!0)):(j(),X({skipEmailCheck:V}))};return g.useEffect(()=>{!v||G.current||(G.current=!0,ue())},[v]),e.jsxs(e.Fragment,{children:[e.jsx(qs,{currentAccount:s,disableForMobile:i,promoMetadata:p,planType:n,downgradeToGoDisabled:_,children:e.jsx($s,{disabled:u,loading:y,onClick:()=>ue(),testId:r,activeColor:c,...x,children:o===n?e.jsx(Ie,{}):P})}),e.jsx(Pt,{isOpen:h,onClose:()=>A(!1),onContinue:()=>ue({skipAppStoreSubscriptionInBillingRetryCheck:!0}),analyticsParams:t}),b&&e.jsx(_t,{isOpen:b,onClose:()=>I(!1),accountId:s.id,initialPlanType:Q,updatedPlanType:n,billingDetails:a}),e.jsx(je,{testId:"modal-add-email",isOpen:w,onClose:()=>U(!1),type:"success",className:"max-w-sm",children:e.jsx(tt,{enterEmailTitle:H.formatMessage(Je.addEmailTitle),enterEmailDescription:H.formatMessage(Je.addEmailDescription),onVerified:()=>{R(),U(!1),ue({skipEmailCheck:!0})},cancelFlowButton:e.jsx(pe,{className:"w-full rounded-md",color:"secondary",onClick:()=>U(!1),children:e.jsx(m,{...Je.cancelAddEmail})})})})]})}const Je=Se({paymentErrorWarning:{id:"AccountPaymentModal.primaryCTA.paymentErrorWarning",defaultMessage:"The payments page encountered an error. Please try again. If the problem continues, please visit help.openai.com."},addEmailTitle:{id:"AccountPaymentModal.primaryCTA.addEmailTitle",defaultMessage:"Email required"},addEmailDescription:{id:"AccountPaymentModal.primaryCTA.addEmailDescription",defaultMessage:"You'll be able to login with this email. It will also be used for account updates (like password resets) and information about OpenAI services."},cancelAddEmail:{id:"AccountPaymentModal.primaryCTA.cancelAddEmail",defaultMessage:"Cancel"},highDemandDisabledText:{id:"AccountPaymentModal.primaryCTA.highDemandDisabledText",defaultMessage:"Due to high demand, we've temporarily paused upgrades."}}),At=f.GO,Qs=({analyticsParams:t,billingDetails:a,setPlanLoading:s,isWebRedesign:n,currentAccount:o,planLoading:l,promoMetadata:r,type:c,autoUpgrade:i,fromiOSWebview:u,promoCode:_,onClose:d,shouldUseComparisonSpacing:y=!1,className:N})=>{const C={...t,planType:f.GO},p=re(),v=hs({isWebRedesign:n}),L=o.hasPaidSubscription(),P=L&&o.isGo(),x=!P&&!l,M=c==="promo"&&r?.plan_type_change==="equal",R=o.getNextPlanType()===f.GO,D=!(x||M)||R,E=L&&be(f.GO)<be(o.planType),h=["promo","highlight"].includes(c)?"purple":"primary",A=r&&sa({intl:p,planName:f.GO,pricingPlan:v,promoMetadata:r,currency:a.currency}),{activeDiscountMetadata:b,scheduledAdditionalLink:I}=aa({isWebRedesign:n,currentAccount:o,intl:p,billingDetails:a,pricingPlan:v,promoMetadata:r}),T=[];return I&&T.push(I),r||T.push(e.jsx(m,{...it.limitsApplyLink,values:{link:w=>e.jsx(Pe,{target:"_blank",rel:"noopener noreferrer",to:Ya,onClick:st,className:F("underline",n&&"font-medium"),children:w},"row-go-plan-help-link")}},"limits-apply-link")),e.jsx(We,{className:N,isGoColumn:!0,type:c,planType:At,activeDiscountMetadata:b,pricingPlan:A??v,promoMetadata:r,secondaryCallToActionButton:c==="promo"?e.jsx(pe,{size:"large",color:"secondary",onClick:d,children:e.jsx(m,{...it.notNow})}):null,callToActionButton:e.jsx(Ks,{currentAccount:o,analyticsParams:C,billingDetails:a,planLoading:l,promoCode:_,setPlanLoading:s,planType:At,disabled:D,testId:"select-plan-button-go-upgrade",activeColor:E&&c!=="promo"?"secondary":h,promoMetadata:r,autoUpgrade:i,fromiOSWebview:u,children:c==="promo"&&P?e.jsx(m,{...v.callToAction.promo}):P?e.jsx(m,{...v.callToAction.active}):E?e.jsx(m,{...it.switchToGo}):e.jsx(m,{...v.callToAction.inactive})}),additionalLinks:T,billingDetails:a,isWebRedesign:n,shouldUseComparisonSpacing:y})},it=Se({limitsApplyLink:{id:"GoColumn.limitsApplyLink",defaultMessage:"Only available in certain regions. <link>Limits apply</link>"},switchToGo:{id:"GoColumn.switchToGo",defaultMessage:"Switch to Go"},notNow:{id:"GoColumn.notNow",defaultMessage:"Not Now"}});function Js({analyticsParams:t,currentAccount:a,planLoading:s,selectedTab:n,setPlanLoading:o,shouldSplitBetweenPersonalAndBusiness:l,billingDetails:r,scrollExperimentVariant:c,onClose:i,isWebRedesign:u,ctx:_,businessComparisonEnabled:d=!1,eligibleComparisonPlans:y,autoUpgradePlanType:N,fromiOSWebview:C}){const p=a.hasPaidSubscription(),v=Ha(_),L=c==="move_free_to_bottom",P=Xs(n,d,y,a),x=Zs({selectedTab:n,shouldSplitBetweenPersonalAndBusiness:l,hasPaidSubscription:p,moveFreeToBottom:L,isGoEnabled:v,isTeamAccount:a.isTeam(),isComparisonExperiment:!!d,comparisonPlanName:P});return x.length===0&&qt.addError(new Error("Account payment modal missing columns")),x.map(M=>{switch(M){case"free":return e.jsx(vs,{billingDetails:r,isWebRedesign:u,shouldUseComparisonSpacing:P==="free"},M);case"go":{const R=n==="business"&&P==="go"?me.standard:v&&a.isFree()?me.highlight:me.standard;return e.jsx(Qs,{analyticsParams:t,setPlanLoading:o,billingDetails:r,isWebRedesign:u,currentAccount:a,planLoading:s,type:R,autoUpgrade:N===f.GO,fromiOSWebview:C,shouldUseComparisonSpacing:P==="go"},M)}case"plus":{const R=n==="business"&&P==="plus"?me.standard:a.isFree()&&!v?me.highlight:me.standard;return e.jsx(Gs,{analyticsParams:t,currentAccount:a,setPlanLoading:o,planLoading:s,billingDetails:r,onClose:i,isWebRedesign:u,type:R,shouldUseComparisonSpacing:P==="plus",autoUpgrade:N===f.PLUS,fromiOSWebview:C},M)}case"team":return e.jsx(Ys,{analyticsParams:t,billingDetails:r,currentAccount:a,planLoading:s,isWebRedesign:u,type:d===!0?me.highlight:me.standard,shouldUseComparisonSpacing:P!==void 0},M);case"pro":return e.jsx(Hs,{analyticsParams:t,currentAccount:a,setPlanLoading:o,planLoading:s,billingDetails:r,isWebRedesign:u,autoUpgrade:N===f.PRO,fromiOSWebview:C,shouldUseComparisonSpacing:P==="pro"},M)}return null})}function Zs({selectedTab:t,shouldSplitBetweenPersonalAndBusiness:a,hasPaidSubscription:s,moveFreeToBottom:n,isGoEnabled:o,isTeamAccount:l,isComparisonExperiment:r,comparisonPlanName:c}){const i=[];return t==="personal"?(!s&&!n&&i.push("free"),o&&i.push("go"),i.push("plus"),i.push("pro"),n&&i.push("free")):(r&&!l&&c&&i.push(c),i.push("team")),i}function Xs(t,a,s,n){if(t==="business"&&!(!a||!s)){if(n.isFree())return s.has("free")?"free":void 0;if(n.isGo())return s.has("go")?"go":void 0;if(n.isPlus())return s.has("plus")?"plus":void 0;if(n.isPro())return s.has("pro")?"pro":void 0}}const en=({className:t})=>{const a="relative flex flex-1 flex-col justify-center gap-3 rounded-2xl px-6 pt-6 pb-8 text-sm",s=F("border border-token-border-default","md:min-h-[30rem] md:max-w-96 md:pb-6");return e.jsxs("div",{className:F(a,s,"bg-token-main-surface-primary","w-full",t),role:"status","aria-busy":"true",children:[e.jsxs("div",{className:"mt-2 mb-5 flex items-center justify-between gap-4",children:[e.jsx(ye,{className:"h-8 w-15"}),e.jsx(ye,{className:"h-5 w-20 rounded-full"})]}),e.jsxs("div",{className:"mb-2 flex items-end gap-4",children:[e.jsx(ye,{className:"h-15 w-20"}),e.jsxs("div",{className:"flex w-44 flex-col gap-2",children:[e.jsx(ye,{className:"h-5 w-10"}),e.jsx(ye,{className:"h-5 w-20"})]})]}),e.jsx(ye,{className:"mb-3 h-5 w-2/3"}),e.jsx(ye,{className:"mb-5 h-10 w-full rounded-full"}),e.jsx("div",{className:"flex flex-col gap-5",children:Array.from({length:7}).map((o,l)=>e.jsxs("div",{className:"grid grid-cols-[20px_1fr] items-center gap-3",children:[e.jsx(ye,{className:"h-5 w-5 rounded"}),e.jsx(ye,{className:F("h-5",["w-[88%]","w-[92%]","w-[86%]","w-[90%]","w-[84%]","w-[96%]","w-[85%]"][l])})]},l))}),e.jsx("div",{className:"mt-8 flex flex-col gap-1",children:e.jsx(ye,{className:"h-3 w-5/6"})})]})};function tn({ctx:t,currentAccount:a,selectedTab:s,isWebRedesign:n,user:o}){const l={comparisonEnabled:!1,eligiblePlans:new Set};if(s!=="business"||!n)return l;const c=o!=null&&Ka(o)&&(a.isFree()||a.isPlus()),i=_e(t,"2762630623"),u=c?i.get("variant","control"):"control",_=a.isFree()||a.isGo()||a.isPlus()||a.isPro(),d=_e(t,"4105912492");return(_?d.get("variant","control"):"control")!=="control"?{comparisonEnabled:!0,eligiblePlans:new Set(["free","go","plus","pro"])}:u!=="control"?{comparisonEnabled:!0,eligiblePlans:new Set(["free","plus"])}:l}const an=({defaultTab:t})=>{const s=!qa(),n=ve();return s&&t==="personal"?_e(n,"2675205028").get("scroll_to_plus_variant","control"):null};function fn({currentAccount:t,defaultTab:a="personal",onClose:s,subtitle:n,title:o,isDefaultTabLoading:l=!1}){const[r,c]=g.useState(null),i=Sa(),[u]=Ot(),_=u.get("plan"),d=u.get("from_webview"),y=!t.hasPaidSubscription()&&d==="ios"&&!!_,N=_===f.PLUS||_===f.PRO||_===f.GO?_:null,C=u.get("from_webview")==="ios",p=za(),v=Ma(),L=Wa(),P=ve(),x=_e(P,"2675205028").get("show_web_redesign",!1),M=an({defaultTab:a});g.useEffect(()=>{const k=performance.now();return()=>{if(k){const ee=performance.now()-k;S.logValueEventWithStatsig({segmentEventName:"Account Pay: Account Payment Modal Time Spent",statsigEventName:"chatgpt_web_account_payment_modal_time_spent",value:Math.round(ee)})}}},[]);const R=!0,j=g.useMemo(()=>({...t.subscriptionAnalyticsParams,referrer:document.referrer}),[t]),D=Ut(),E=ze(),h=g.useCallback(()=>{S.logEvent("Account Pay: Close Account Payment Modal",j),s()},[j,s]);g.useEffect(()=>{const k=localStorage.getItem(`subscriptionUpdateMessage_${t.id}`);if(k){localStorage.removeItem(`subscriptionUpdateMessage_${t.id}`),E.success(k,{hasCloseButton:!0});const ee=setTimeout(()=>{h()},5e3);return()=>{clearTimeout(ee)}}},[t.id,E,h]);const[A,b]=g.useState(a),{country:I,setCountry:T,userCountry:w}=_s(),U=sn({currentAccount:t,selectedTab:A}),G=Cs({country:U?I:Qa,currentAccount:t,location:"AccountPaymentModal",shouldUsePaidSubscriptionBillingCurrency:A==="personal"}),{comparisonEnabled:Z,eligiblePlans:se}=tn({ctx:P,currentAccount:t,selectedTab:A,isWebRedesign:x,user:p});ys(()=>{const k=i.state?.[Ja],ee=i.key;k&&D({hash:i.hash,search:i.search},{replace:!0,state:{}});const te=new URLSearchParams(window.location.search).get("referrer")??document.referrer;Za.count(Xa.DEFAULT,"chatgpt_account_payment_modal_show",[{key:"location",value:k},{key:"locationKey",value:ee},{key:"navigationType",value:v},{key:"initialTab",value:a},{key:"initialCountrySelectorCountry",value:I},{key:"selectedCountry",value:G.country??""},{key:"selectedCurrency",value:G.currency??""},{key:"userCountry",value:w??""},{key:"isCountrySelectorEnabled",value:String(U)}]),S.logEventWithStatsig("Account Pay: Account Payment Modal Show","chatgpt_account_payment_modal_show",{...j,initialTab:a,location:k,locationKey:ee,navigationType:v,initialCountrySelectorCountry:I,selectedCountry:G.country??"",selectedCurrency:G.currency??"",userCountry:w??"",isCountrySelectorEnabled:U,referrer:te})});const H=g.useCallback(k=>{qt.addAction("chatgpt_selected_country_changed_in_pricing_modal",{old_selected_country:I,new_selected_country:k}),S.logEventWithStatsig("Selected country changed in pricing modal","chatgpt_selected_country_changed_in_pricing_modal",{old_selected_country:I,new_selected_country:k}),T(k)},[I,T]),Q=k=>{b(k);const J=new URLSearchParams(window.location.search).get("referrer")??document.referrer;S.logEventWithStatsig("Account Pay: Account Payment Modal Toggle Clicked","chatgpt_account_payment_modal_toggle_clicked",{selectedTab:k,referrer:J})},ne=136,[$,Y]=g.useState(),B=g.useRef(null);g.useEffect(()=>{const k=()=>{if(B.current){const ee=document.documentElement.clientHeight,J=B.current.getBoundingClientRect().height,te=ee-J;Y(Math.max(te,ne))}};return k(),window.addEventListener("resize",k),()=>window.removeEventListener("resize",k)},[A]);const ce=Js({analyticsParams:j,currentAccount:t,planLoading:r,selectedTab:A,setPlanLoading:c,shouldSplitBetweenPersonalAndBusiness:R,billingDetails:G,scrollExperimentVariant:M,onClose:s,isWebRedesign:x,ctx:P,businessComparisonEnabled:Z,eligibleComparisonPlans:se,autoUpgradePlanType:N,fromiOSWebview:C}),de=Ps(),X=nn({defaultTitle:o,showPlusFreeTrialTitle:de&&A==="personal",hasProSubscription:t.isPro()}),ue=g.useRef(!1);g.useEffect(()=>{const k=document.getElementById($t);k?.scrollIntoView&&!ue.current&&M==="scroll_to_plus"&&(k.scrollIntoView({behavior:"smooth"}),ue.current=!0)},[M]);const q=x?"flex justify-center gap-6 flex-col md:flex-row px-4":"flex flex-col justify-center gap-4 px-3 py-3 md:min-h-[30rem] md:flex-row md:gap-0 md:py-0",W=_e(P,"3432045939").get("hide_on_click_outside_payment_modal",!0);return e.jsxs(je,{testId:"modal-account-payment",size:"fullscreen",isOpen:!0,onClose:h,type:"success",className:"flex flex-col",removePopoverStyling:!0,shouldIgnoreClickOutside:!W,children:[e.jsxs("div",{ref:B,className:F(x&&"bg-token-bg-elevated-secondary"),children:[e.jsxs("div",{className:F("relative grid grid-cols-[1fr_auto_1fr] px-6 py-4 md:pt-[4.5rem]",x?"md:pb-6":"md:pb-10"),children:[e.jsx("div",{}),e.jsxs("div",{className:"my-1 flex flex-col items-center justify-center md:mt-0 md:mb-0",children:[e.jsx("h2",{className:"text-page-header",children:e.jsx(m,{...X})}),n?e.jsx("div",{className:"text-token-text-secondary mt-3 mb-1",children:e.jsx(m,{...n})}):null]}),!C&&e.jsx("button",{className:"text-token-text-primary justify-self-end opacity-50 transition hover:opacity-75 md:absolute md:end-6 md:top-6",onClick:()=>{h()},children:e.jsx($a,{className:F({"h-5 w-5":!L,"icon-lg":L})})})]}),!C&&t.isPersonalAccount()&&R?e.jsx("div",{className:F("mb-3 flex justify-center",x?"md:mb-6":"md:mb-10"),children:e.jsx("div",{className:"w-[fit-content]",children:e.jsx(xs,{value:A,onChange:Q})})}):null,l?e.jsx("div",{className:q,children:e.jsx(en,{})}):e.jsx("div",{className:q,children:ce})]}),e.jsxs("div",{className:F("relative grid grid-cols-[1fr_auto_1fr]",x&&"bg-token-bg-elevated-secondary"),style:{height:`${$}px`},children:[e.jsx("div",{}),e.jsxs("span",{className:F("text-token-text-secondary mt-8 mb-12 flex flex-col items-center justify-start gap-2 text-sm md:mt-8 md:mb-8",x&&"md:mt-10"),children:[e.jsx(Ms,{}),e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(m,{...Ye.needMoreCapabilities}),e.jsx("div",{children:e.jsx(m,{...Ye.seeChatGptEnterprise,values:{link:k=>e.jsx(Pe,{target:"_blank",to:Va,onClick:()=>{S.logEventWithStatsig("Account Pay: Click see enterprise link from Modal","chatgpt_account_payment_modal_enterprise_link_clicked")},className:F("mx-1 underline",x&&"font-medium"),children:k})}})})]})]}),e.jsx("span",{"data-testid":"country-selector-in-pricing-modal",className:F({hidden:!U},"text-token-text-primary justify-self-end opacity-50 transition hover:opacity-75 md:absolute md:end-4 md:bottom-4"),children:e.jsx(Ss,{onChange:H,value:I})})]}),y&&e.jsx("div",{className:"bg-token-bg-primary absolute inset-0 z-[9999] grid place-items-center dark:bg-[#1B1B1D]","data-testid":"account-payment-modal-loading",children:e.jsx(Ie,{className:"icon-xl text-token-text-primary"})})]})}function sn({currentAccount:t,selectedTab:a}){return!!(!t.hasPaidSubscription()||(t.isPlus()||t.isPro())&&a==="business"||t.isTeam())}function nn({defaultTitle:t,hasProSubscription:a,showPlusFreeTrialTitle:s}){return s?Ye.plusFreeTrialModalTitle:t||(a?Ye.proModalTitle:Ye.modalTitle)}const Ye=Se({modalTitle:{id:"AccountPaymentModal.modalTitle",defaultMessage:"Upgrade your plan"},plusFreeTrialModalTitle:{id:"AccountPaymentModal.plusFreeTrialModalTitle",defaultMessage:"Try Plus free for 1 month"},proModalTitle:{id:"AccountPaymentModal.proModalTitle",defaultMessage:"Choose your plan"},modalFooterCapabilities:{id:"AccountPaymentModal.modalFooterCapabilities",defaultMessage:"Need more capabilities? See <link> ChatGPT Enterprise </link>"},needMoreCapabilities:{id:"SdJWr7",defaultMessage:"Need more capabilities for your business?"},seeChatGptEnterprise:{id:"7C5fuF",defaultMessage:"See<link>ChatGPT Enterprise</link>"},promoNotEligibleMessage:{id:"AccountPaymentModal.promoNotEligibleMessage",defaultMessage:"Thanks for being a susbcriber. Since you already use ChatGPT Plus, you're not eligible for this offer."}});export{fn as A,Qs as G,Gs as P,Is as T,Os as a,Es as b,Fs as c,_t as d,Nt as g,st as h};
//# sourceMappingURL=knwvzd4zdwnd5k5m.js.map
