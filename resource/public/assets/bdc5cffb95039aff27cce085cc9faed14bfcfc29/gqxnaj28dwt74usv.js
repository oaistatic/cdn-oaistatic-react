import{r as o,j as d,R as y}from"./cs7toih8jegb7teq.js";import{d6 as x,d7 as M,d8 as v,d9 as T,da as C,aF as R}from"./hnw079jsdm76umup.js";import{T as h}from"./dfhgw8mxn1h3ecpw.js";import{h2 as P,e8 as D,T as S,g as A,aF as p,oO as B}from"./dmck639k4dv7claj.js";function E(e){const{bufferType:f,isActivelyStreaming:r,messages:c,parts:s,...n}=e,a=c[c.length-1].id,[u,i]=o.useState(P(s)),t=o.useRef(void 0);if(t.current===void 0)switch(f){case"Adaptive":t.current=new v(s,i,r);break;case"ChunkedCatchup":t.current=new M(s,i,r);break;case"Punctuation":t.current=new x(s,i,r);break}return o.useEffect(()=>{t.current!=null&&(t.current.onMessagePartsUpdated(s,r),t.current.isBuffering()&&T.addDelayedRenderingMessage(a))},[s,a,r]),o.useEffect(()=>{t.current!=null&&t.current.removeDelayedRender()&&T.removeDelayedRenderingMessage(a)},[u,a]),o.useEffect(()=>()=>T.removeDelayedRenderingMessage(a),[a]),o.useEffect(()=>()=>{t.current?.destroy(),t.current=void 0},[]),d.jsx(h,{...n,messages:c,parts:s,displayParts:u,isActivelyStreaming:r||!!t.current?.isBuffering()})}function I({message:e,isCompletionInProgress:f,hasActiveRequest:r,clientThreadId:c,className:s,isUserTurn:n,isFinalUserTurn:a,turnIndex:u,isFeedbackEnabled:i,prevGroupedMessageType:t,prevGroupedMessages:g,citableMessages:m}){const l=o.useMemo(()=>"parts"in e.content?e.content.parts:[D(e)],[e]);return d.jsxs(d.Fragment,{children:[d.jsx(F,{parts:l,messages:[e],hasActiveRequest:r,isCompletionInProgress:f,className:s,citations:e.metadata?.citations,contentReferences:e.metadata?.content_references,attachments:e.metadata?.attachments,isUserTurn:n,isFinalUserTurn:a,turnIndex:u,id:e.id,isFeedbackEnabled:i,clientThreadId:c,prevGroupedMessageType:t,prevGroupedMessages:g,citableMessages:m}),!1]})}const G=y.memo(I),j=()=>null;function F(e){const f=j()!=null,r=e.messages.length>1,c=S.isLastActorMessage(A(e.clientThreadId),e.messages[0].id),s=!!p(e.clientThreadId,l=>l?.sharedConversationMetadata),n=r?void 0:C(e.messages[0],c,f,e.isCompletionInProgress||e.hasActiveRequest,s),a=n?.flagSeverity!=="danger"&&e.isCompletionInProgress,u=!e.parts.some(l=>l!==""),{bufferType:i,wordFadeType:t}=R(),[g,m]=o.useState(()=>t!=="indexed"&&i!=="none"&&!e.isUserTurn&&(e.isCompletionInProgress||u&&!n));return n&&g&&m(!1),g?d.jsx(E,{...e,bufferType:i,isActivelyStreaming:a,errorState:n}):d.jsx(h,{...e,displayParts:B({isUserTurn:e.isUserTurn,parts:e.parts}),isActivelyStreaming:a,errorState:n})}export{G as T,F as a};
//# sourceMappingURL=gqxnaj28dwt74usv.js.map
