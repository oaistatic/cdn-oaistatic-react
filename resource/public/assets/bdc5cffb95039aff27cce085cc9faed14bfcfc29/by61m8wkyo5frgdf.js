import{e as R,j as e,d as ie,m as z,aj as le,r as u,A as de,M as A,R as ce}from"./cs7toih8jegb7teq.js";import{d1 as y,S as V,P as E,cg as me,ch as fe,iM as ue,z as h,t as xe,ci as ge,ck as he,co as pe,cx as we,cm as je,cn as _e,bV as be,e as q,G as J,g as W,T as O,aI as ke,y as ve,R as Me,a0 as T}from"./dmck639k4dv7claj.js";import{cX as $,f as ye,hR as Se,ba as Ce,hS as j,ak as Ne,cO as Ie}from"./hnw079jsdm76umup.js";import{X as De,L as Ee,R as Re}from"./o2irc1i5e2v5m1br.js";import{u as Pe}from"./juhpprtcv8tvp5w6.js";import{d as H}from"./kl7c6054usfnqmd4.js";import{g as Be}from"./mia7qmdupqoji40k.js";const U=ie({download:{id:"postSharingModal.download",defaultMessage:"Download"},downloadPdfButtonMenu:{id:"postSharingModal.download-pdf-button.menu",defaultMessage:"PDF Document (.pdf)"},downloadDocxButtonMenu:{id:"postSharingModal.download-docx-button.menu",defaultMessage:"Microsoft Word Document (.docx)"}}),Le=({downloading:n,onOdysseyFileDownload:o,disabled:s,icon:a,label:i,odysseyShareIntent:t})=>{const r=R();return t.fileName.endsWith("md")?e.jsxs(y.Root,{open:!s&&!n?void 0:!1,children:[e.jsx(y.BasicTrigger,{asChild:!0,children:e.jsxs("button",{onClick:()=>{E.logEventWithStatsig("Share Post: Social Clicked","chatgpt_post_share_link_social_clicked",{platform:"download"})},disabled:s,className:"relative flex flex-col gap-y-4 disabled:opacity-50 max-sm:gap-y-2",children:[e.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-full shadow-lg max-sm:h-12 max-sm:w-12 max-sm:shadow-md dark:shadow-md",children:e.jsx("div",{className:"pointer-events-none flex h-8 w-8 items-center justify-center max-sm:h-6 max-sm:w-6",children:n?e.jsx(V,{}):a})}),e.jsx("div",{className:"w-full text-center text-xs",children:i})]})}),e.jsx(y.Portal,{children:e.jsxs(y.Content,{align:"end",children:[e.jsx(y.Item,{onClick:l=>{l.preventDefault(),o?.(t.fileName,t.fileId,t.messageId,"pdf")},children:r.formatMessage(U.downloadPdfButtonMenu)}),e.jsx(y.Item,{onClick:l=>{l.preventDefault(),o?.(t.fileName,t.fileId,t.messageId,"docx")},children:r.formatMessage(U.downloadDocxButtonMenu)})]})})]},"download"):e.jsxs("button",{onClick:()=>{o?.(t.fileName,t.fileId,t.messageId,null),E.logEventWithStatsig("Share Post: Social Clicked","chatgpt_post_share_link_social_clicked",{platform:"download"})},disabled:s,className:"relative flex flex-col gap-y-4 disabled:opacity-50 max-sm:gap-y-2",children:[e.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-full shadow-lg max-sm:h-12 max-sm:w-12 max-sm:shadow-md dark:shadow-md",children:e.jsx("div",{className:"pointer-events-none flex h-8 w-8 items-center justify-center max-sm:h-6 max-sm:w-6",children:e.jsx($,{})})}),e.jsx("div",{className:"w-full text-center text-xs",children:r.formatMessage(U.download)})]},"download")};function Fe({className:n,children:o,position:s="center",size:a,removePopoverStyling:i=!1,shadow:t="normal"}){const r=le(),l=R(),x=Math.random()*40-20;return u.useEffect(()=>{r.start({x:0,y:0,rotate:0,opacity:1,transition:{type:"spring",duration:.6,bounce:.15}})},[r]),e.jsx(z.div,{initial:{x:0,y:"100%",rotate:0,opacity:1},animate:r,exit:{x:0,y:"100%",rotate:x,opacity:1},transition:{type:"spring",duration:.6,bounce:.15},className:h("z-50 h-full w-full overflow-y-auto",a!=="fullscreen"&&"grid grid-cols-[10px_1fr_10px]",a!=="fullscreen"&&s==="center"&&"grid-rows-[minmax(10px,1fr)_auto_minmax(10px,1fr)] md:grid-rows-[minmax(20px,1fr)_auto_minmax(20px,1fr)]",a!=="fullscreen"&&s==="bottom"&&"grid-rows-[minmax(10px,1fr)_auto_10px] md:grid-rows-[minmax(20px,1fr)_auto_20px]"),children:e.jsx(he,{className:h(!i&&"popover","bg-token-sidebar-surface relative start-1/2 col-auto col-start-2 row-auto row-start-2 h-full w-full min-w-0 gap-4 p-4 text-start ltr:-translate-x-1/2 rtl:translate-x-1/2 dark:bg-[#171717]",a!=="fullscreen"&&"rounded-[36px]",t==="normal"&&"shadow-[0_32px_48px_rgba(0,0,0,0.175),_0_0_1px_rgba(0,0,0,0.2)] dark:shadow-[0_32px_48px_rgba(0,0,0,0.175),_0_0_1px_rgba(255,255,255,0.4)]",n),"aria-description":l.formatMessage({id:"slide-up-modal.share-sheet.description",defaultMessage:"Share sheet"}),"aria-describedby":"",children:o})})}function Ae({isOpen:n,onClose:o,children:s,shouldIgnoreClickOutside:a=!1,className:i}){return e.jsx(me,{open:n,onOpenChange:t=>{a||t===!1&&o(!1)},children:e.jsx(fe,{container:ue()?.document.body,children:e.jsx("div",{className:h("absolute inset-0",i),children:s})})})}function Te({className:n,children:o,showBackground:s=!0}){const a=xe(),i=s?a?"rgba(0, 0, 0, 0.8)":"rgba(249,249,249,0.8)":"rgba(0, 0, 0, 0)";return e.jsx(ge,{asChild:!0,children:e.jsx(z.div,{initial:{backdropFilter:"blur(0px)",backgroundColor:a?"rgba(0, 0, 0, 0)":"rgba(255, 255, 255, 0)"},animate:{backdropFilter:s?"blur(4px)":"blur(0px)",backgroundColor:i},exit:{backdropFilter:"blur(0px)",backgroundColor:a?"rgba(0, 0, 0, 0)":"rgba(255, 255, 255, 0)"},className:h("fixed inset-0 z-50",n),children:o})})}function Ue({title:n,description:o,icon:s,type:a}){return e.jsxs("div",{className:"flex max-w-full min-w-0 items-center",children:[e.jsx(Oe,{icon:s,type:a}),e.jsxs("div",{className:"flex max-w-full min-w-0 grow flex-col gap-1",children:[n!=null&&e.jsx(je,{className:"text-token-text-primary text-3xl leading-6 font-semibold tracking-tight max-sm:text-xl",children:n}),o!=null&&e.jsx(_e,{className:"text-token-text-tertiary text-sm",children:o})]})]})}function We({title:n,accessory:o,description:s,withSeparator:a=!0,icon:i,type:t,closeButton:r,textCenter:l}){return!n&&!s?null:e.jsxs($e,{$hasSeparator:a,children:[e.jsx("div",{className:h("flex max-w-full",l&&"flex-1 justify-center text-center"),children:e.jsx(Ue,{title:n,description:s,icon:i,type:t})}),e.jsxs("div",{className:"flex items-center gap-5",children:[o,r!=null&&e.jsx(pe,{asChild:!0,className:"sm:mt-0",children:r})]})]})}const Oe=({type:n,icon:o})=>o==null?null:e.jsx("div",{className:h("me-4 flex h-12 w-12 shrink-0 items-center justify-center rounded-full sm:h-10 sm:w-10",n==="danger"&&"bg-red-100",n==="warning"&&"bg-yellow-100",n==="success"&&"bg-green-100"),children:e.jsx(o,{className:h("icon-lg",n==="danger"&&"text-red-600",n==="warning"&&"text-yellow-700",n==="success"&&"text-green-700"),"aria-hidden":"true"})}),$e=we.div`px-4 pb-2 sm:p-6 flex items-center justify-between ${({$hasSeparator:n})=>n&&"border-b border-black/10 dark:border-white/10"}`,D={Root:Ae,Overlay:Te,Content:Fe,Header:We};function Ge({showLinkCopied:n,isGeneratingShareLink:o,onClick:s,postText:a,showDownloadButton:i,odysseyShareIntent:t,isDownloadingOdyssey:r,onOdysseyFileDownload:l,disabled:x}){const g=R(),N=q(),I=J(N)?.isWorkspaceAccount();let _=[{id:"copy",icon:o?e.jsx(V,{}):e.jsx(Ne,{}),label:n?g.formatMessage(j.linkCopied):g.formatMessage(j.copyLink),action:"copy"}];I?i&&_.push({id:"download",icon:e.jsx($,{}),label:g.formatMessage({id:"postSharingModal.download",defaultMessage:"Download"}),action:"download"}):_=_.concat({id:"x",href:d=>`https://twitter.com/intent/tweet?url=${encodeURIComponent(d)}&text=${a?encodeURIComponent(a):""}`,icon:e.jsx(De,{initialFillColor:"var(--text-primary)"}),label:g.formatMessage({id:"postSharingModal.x",defaultMessage:"X"}),action:"share"},{id:"linkedin",href:d=>`https://www.linkedin.com/shareArticle?url=${encodeURIComponent(d)}&text=${a?encodeURIComponent(a):""}`,icon:e.jsx(Ee,{initialFillColor:"var(--text-primary)"}),label:g.formatMessage({id:"postSharingModal.linkedin",defaultMessage:"LinkedIn"}),action:"share"},{id:"reddit",href:d=>`https://www.reddit.com/submit?url=${encodeURIComponent(d)}&title=${a?encodeURIComponent(a):""}`,icon:e.jsx(Re,{initialFillColor:"var(--text-primary)"}),label:g.formatMessage({id:"postSharingModal.reddit",defaultMessage:"Reddit"}),action:"share"},...i?[{id:"download",icon:e.jsx($,{}),label:g.formatMessage({id:"postSharingModal.download",defaultMessage:"Download"}),action:"download"}]:[]);const b=!!r;return e.jsx(e.Fragment,{children:_.map(d=>d.id==="download"&&t?e.jsx(Le,{downloading:b,onOdysseyFileDownload:l,disabled:x??!1,icon:d.icon,label:d.label,odysseyShareIntent:t},d.id):e.jsxs("button",{onClick:()=>{s(d),E.logEventWithStatsig("Share Post: Social Clicked","chatgpt_post_share_link_social_clicked",{platform:d.id})},disabled:x,className:"relative flex flex-col gap-y-4 disabled:opacity-50 max-sm:gap-y-2",children:[e.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-full shadow-lg max-sm:h-12 max-sm:w-12 max-sm:shadow-md dark:shadow-md",children:e.jsx("div",{className:"pointer-events-none flex h-8 w-8 items-center justify-center max-sm:h-6 max-sm:w-6",children:d.icon})}),e.jsx("div",{className:"w-full text-center text-xs",children:d.label})]},d.id))})}function Xe(n,o){const s=W(n);return s?{id:"tmp",kind:"message_slice",messages:o.map(i=>{const t=O.findNode(s,({message:r})=>r.id===i);return t?t.message:null}).filter(Boolean)}:null}function He(n){return{id:"tmp",kind:"message_slice",messages:[n.previewMessage]}}function ss({postSharingData:n,onClose:o}){const{clientThreadId:s,postText:a,generateShareLinkFn:i,coverImageUrl:t,messageSliceIds:r,odysseyShareIntent:l}=n,x=u.useRef(void 0),[g,N]=u.useState(!1),[G,I]=u.useState(!1),_=R(),b=be(),[d,X]=u.useState(!0),K=q(),Q=J(K)?.isWorkspaceAccount();u.useEffect(()=>{E.logEventWithStatsig("Share Post: Post Sharing Modal Shown","chatgpt_post_share_modal_shown")},[]),u.useEffect(()=>{x.current=void 0},[s]);const S=u.useMemo(()=>l?He(l):t||!r||r.length===0?null:Xe(s,r),[t,s,r,l]),P=u.useMemo(()=>{const c=W(s);return c?O.getConversationTurns(c).flatMap(p=>p.messages):[]},[s]);u.useEffect(()=>{if(!r||r.length===0)return;const c=W(s);r.filter(w=>!O.findNode(c,({message:k})=>k.id===w)).length>0&&ye(s)},[s,r]);const{hasImage:Y,hasScreenshot:Z}=u.useMemo(()=>{let c=!1,p=!1;if(P.length){const w=P,k=/\.(jpe?g|png|gif|webp|bmp|tiff)$/i,C=m=>{if(!Array.isArray(m))return!1;for(const f of m)if(f.type==="image_inline"&&f.clicked_from_url&&(p=!0),f.type==="file"&&"file_name"in f){const M=f.file_name.toLowerCase();(M.endsWith(".pptx")||k.test(M))&&(c=!0)}};w.forEach(m=>{const f=m.metadata;if(!f)return;const M=[...Object.values(f.n7jupd_crefs_by_file??{}).flat(),...Object.values(f.content_references_by_file??{}).flat()],F=[...f.n7jupd_crefs??[],...f.content_references??[]];C(M),C(F)})}return{hasImage:c,hasScreenshot:p}},[P]),B=ke(s),ee=async(c,p)=>{if(!(g||!B)&&B){if(!x.current){N(!0);try{const w=await i();w&&(x.current=w)}catch{b.danger(j.failedToGenerateShareLink,{toastId:"failed_to_generate_share_link"})}finally{N(!1)}}if(x.current){if(c.action==="copy")navigator.clipboard.writeText(x.current),I(!0),b.success(_.formatMessage(j.linkCopied)),setTimeout(()=>{I(!1)},3e3);else if(c.action==="share"&&c.href)window.open(c.href(x.current),"_blank","noopener,noreferrer");else if(c.action==="download"){if(!t)return;Ie({url:t,fileName:`${a}.png`})}}}},se=e.jsx("div",{className:h("flex w-full justify-center rounded-xl",t||S&&l?.isStandaloneAttachment?"max-xs:max-h-[260px] h-[30vh] max-h-[550px] max-sm:max-h-[300px]":"aspect-[1200/630]",!t&&!l?.isStandaloneAttachment&&"outline-token-border-light overflow-hidden shadow-sm outline outline-1"),children:t?e.jsx("img",{src:t,alt:a}):l?.isStandaloneAttachment&&S?e.jsx(Se,{attachments:[S],variant:"unfurl",className:"h-full w-full",clientThreadId:s}):S?e.jsx(Ce,{attachments:[S],clientThreadId:s,className:"h-full"}):null}),ae="normal",[te,L]=u.useState(!1),{presentationMap:ne}=Pe(),v=_.formatMessage(j.downloadFileError),oe=async(c,p,w,k)=>{const C=B;if(!(!c||!p||!C))if(L(!0),c.endsWith("md")){if(!k)return;try{const m=await Me.safePost("/export_doc/n7jupd",{requestBody:{conversation_id:C,message_id:w,file_id:p,export_type:k},skipJsonTransform:!0});m.ok||(b.danger(v,{toastId:"post_sharing_modal_download_error",loggingTitle:v,loggingDescription:"Error message when a file download fails"}),T.addError("post_sharing_modal_download_error",{statusText:m.statusText,status:m.status}));const f=await m.blob(),M=m.headers.get("Content-Disposition"),F=Be(M)??`Agent.${k}`;H(f,F)}catch(m){b.danger(v,{toastId:"post_sharing_modal_download_error",loggingTitle:v,loggingDescription:"Error message when a file download fails"}),T.addError(m)}finally{L(!1)}}else{const m=ne[p];if(!m||!m.fileBlob){b.danger(v,{toastId:"post_sharing_modal_download_error",loggingTitle:v,loggingDescription:"Error message when a file download fails"}),T.addError("post_sharing_modal_download_error"),L(!1);return}H(m.fileBlob,c)}},re=e.jsxs(e.Fragment,{children:[e.jsx("div",{className:h("flex flex-wrap justify-center space-y-4 space-x-12 max-sm:space-x-6","mt-12 max-sm:mt-6"),children:e.jsx(Ge,{showLinkCopied:G,isGeneratingShareLink:g,disabled:g,onClick:ee,postText:a,showDownloadButton:!!(t||l),odysseyShareIntent:l,isDownloadingOdyssey:te,onOdysseyFileDownload:oe})}),ze(Y,Z,Q??!1)]});return e.jsx(de,{onExitComplete:o,children:d&&e.jsx(D.Root,{isOpen:!0,onClose:()=>{X(!1)},className:"max-w-[664px] px-4",children:e.jsx(D.Overlay,{showBackground:!0,children:e.jsxs(D.Content,{size:"normal",position:"center",className:h("flex flex-col pb-4 focus:outline-hidden",{"max-w-[640px]":ae==="normal"}),removePopoverStyling:!1,shadow:"normal",children:[e.jsx(D.Header,{title:a,type:"success",closeButton:e.jsx(ve,{onClick:()=>X(!1)})}),e.jsxs("div",{children:[e.jsx("div",{className:h("flex justify-center",!l&&"pointer-events-none"),children:se}),re]})]})})})})}function ze(n,o,s){const a=[];return s&&a.push(e.jsx(A,{...j.shareLinkVisibleToWorkspaceOnly},"workspace")),o&&a.push(e.jsx(A,{...j.screenshotDisclaimer},"screenshot")),n&&a.push(e.jsx(A,{...j.imageLicenseDisclaimer,values:{nbsp:" ",link:i=>e.jsx("a",{href:"https://help.openai.com/",target:"_blank",rel:"noopener noreferrer",className:"underline",children:i})}},"image")),a.length?e.jsx("p",{className:"text-token-text-tertiary text-center text-sm sm:mt-2",children:a.map((i,t)=>e.jsxs(ce.Fragment,{children:[t>0&&e.jsx(e.Fragment,{children:" "}),i]},t))},"image-disclaimer"):null}export{ss as PostSharingModal};
//# sourceMappingURL=by61m8wkyo5frgdf.js.map
