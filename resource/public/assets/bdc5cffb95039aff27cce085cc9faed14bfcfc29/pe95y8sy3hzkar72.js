import{e as ne,r as l,j as s,M as L,A as ce,m as R,v as Oe,d as Me,au as Ht,c as $t,aq as Ut,u as Ue}from"./cs7toih8jegb7teq.js";import{C as it,be as Ze,de as Te,B as Q,eg as Ft,hF as Gt,a0 as Fe,v as ee,N as te,z as S,bV as qt,V as Ge,L as qe,tZ as Vt,db as Wt,gW as zt,d8 as Ve,fL as Xt,e as lt,d_ as Yt,eD as ct,ed as Kt,bA as Zt,jl as Qt,lu as Jt,it as es,u7 as ts,jG as ss,dd as le,g$ as dt,d3 as ut,c3 as We,fU as ns,gK as rs,dc as as,dq as Ae,gj as os,R as ye,ao as is,fZ as ls,hh as cs,bj as ds,p as mt,fB as us,T as ms,c as fs,cx as G,aX as ps,y as xs,d2 as hs}from"./dmck639k4dv7claj.js";import{l6 as gs,l7 as ys,lG as Cs,dZ as ft,u5 as vs,tD as Se,u6 as Es,dr as bs,hE as ws,lu as Ss,bF as Ns,hC as js,hD as ks,cH as Ms,jX as Ts,b2 as _s,u2 as $,d3 as pt,p_ as Is,lb as Rs,hz as xt,N as Qe}from"./hnw079jsdm76umup.js";import{u as Ls}from"./kwms1ugj73bjxgnk.js";import{T as _e,E as Os,o as As,j as Ds,g as Bs,i as Ps,d as Hs}from"./zpmtm193hf9al87a.js";import{C as $s,i as Us,a as Fs,L as Gs}from"./n8303igkzlzv9639.js";import{E as Z,M as N}from"./ns51nblw8ziscsgd.js";import{a as qs,D as Vs,H as Ws,Z as Ee}from"./jy1u8exw8iz2slve.js";import{d as Ie,c as de,E as Ne,D as ie}from"./dtz2gnda2vx03dil.js";import{L as zs}from"./gy64pge8qevmvg7e.js";const ht=({origin:e,url:t})=>s.jsxs("div",{"aria-label":t,className:"w-full min-w-0 pe-4 text-start whitespace-nowrap",children:[s.jsx("span",{"aria-hidden":!0,className:"text-token-text-primary",children:e}),s.jsx("span",{"aria-hidden":!0,className:"text-token-text-tertiary",children:t.replace(e,"")})]}),Xs=({request:e,isDenied:t=!1,onClick:n})=>{const[{width:r},a]=Ls();return s.jsxs("button",{ref:a,className:"group relative z-0 my-1 flex w-full items-center",onClick:n,children:[s.jsx("div",{className:"sticky start-0 z-[-1] w-0",children:s.jsx("div",{className:"absolute top-0 hidden h-8 -translate-y-1/2 bg-gray-100 group-hover:block",style:{width:r}})}),s.jsx("div",{className:"bg-token-main-surface-primary text-token-text-secondary sticky start-0 z-10 flex h-8 shrink-0 items-center px-2 group-hover:bg-gray-100",children:t?s.jsx(Cs,{className:"icon text-red-500"}):s.jsx(Gt,{className:"icon text-green-500"})}),s.jsx(ht,{...e})]})},Ys=({title:e,requests:t,onConfirm:n})=>{const r=ne(),[a,o]=l.useState(()=>new Set),i=()=>{for(const{requestId:u,approve:m,deny:x}of t)a.has(u)?x():m();n?.()},c=()=>{for(const u of t)u.deny()},f=u=>{o(m=>{const x=new Set(m);return x.has(u)?x.delete(u):x.add(u),x})},d=t.length-a.size;return s.jsx(it,{testId:"modal-confirm-fetch-request",isOpen:!0,shouldIgnoreClickOutside:!0,onClose:i,type:"success",title:s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-xl",children:s.jsx(L,{id:"VmMpF1",defaultMessage:"Allow network access?"})}),s.jsx(Te,{side:"top",contentClassName:"max-w-2xs!",label:s.jsx(L,{id:"WT7tgj",defaultMessage:"Learn more about network requests in canvas"}),children:s.jsx(Q,{icon:Ft,openNewTab:!0,onClick:()=>gs.logButtonClick(ys.LEARN_MODE_ABOUT_NETWORK_REQUESTS),as:"a",color:"ghost",size:"small",className:"text-token-text-secondary aspect-square p-1!",to:"https://help.openai.com/en/articles/9930697-what-is-the-canvas-feature-in-chatgpt-and-how-do-i-use-it#h_cd52fdbc16"})})]}),description:s.jsxs("div",{className:"mt-3 flex flex-col gap-3",children:[s.jsx("span",{className:"text-token-text-primary block",children:s.jsx(L,{id:"qk11AX",defaultMessage:"{title} is trying to connect to the network. If you don’t recognize {numRequests, plural, one {this request} other {any of these requests}}, don’t allow this app access to the network.",values:{title:`"${e}"`,numRequests:t.length}})}),s.jsx("div",{className:"flex max-w-full flex-col",children:t.length>1?s.jsx("ul",{className:"border-token-border-default relative flex max-h-48 flex-col overflow-x-auto overflow-y-auto rounded-lg border",children:t.map(u=>{const{requestId:m}=u;return s.jsx("li",{children:s.jsx(Xs,{request:u,isDenied:a.has(m),onClick:()=>f(m)})},m)})}):s.jsx("div",{className:"no-scrollbar bg-token-main-surface-secondary overflow-x-auto rounded-lg p-2",children:s.jsx(ht,{...t[0]})})})]}),primaryButton:s.jsx(Ze.Button,{disabled:d===0,title:t.length>1?r.formatMessage({id:"xpKkWv",defaultMessage:"Allow selected ({count})"},{count:d}):r.formatMessage({id:"ZeMrpd",defaultMessage:"Allow"}),color:"primary",onClick:i}),secondaryButton:s.jsx(Ze.Button,{title:r.formatMessage({id:"TjJzqR",defaultMessage:"{count, plural, one {Deny} other {Deny all}}"},{count:t.length}),color:"secondary",onClick:c})})},Ks=e=>{switch(e.type){case"hist":return ee.hist(te.WEB_SANDBOX,e.label,e.tags,e.value);case"count":return ee.count(te.WEB_SANDBOX,e.label,e.tags,e.count);case"error":return Fe.addError(e.error)}},gt=({size:e=60,thickness:t=1/16,checkpoints:n,activeCheckpointId:r,isComplete:a=!1,onTransitionComplete:o,color:i})=>{const[c,f]=l.useState(0),d=n.findIndex(p=>p.id===r),u=l.useRef(null),m=n[d];l.useEffect(()=>{if(!m||a)return;const p=n.length,h=d*100/p,y=(d+1)*100/p;f(h);let C=null,g=null;const E=5/m.estimatedTime,b=T=>{g==null&&(g=T);const j=T-g;if(j!==0){const O=y-h,P=h+O*(1-Math.exp(-E*j));f(Math.min(P,y-1e-4))}C=window.setTimeout(()=>{u.current=requestAnimationFrame(b)},16)};return u.current=requestAnimationFrame(b),()=>{C!=null&&window.clearTimeout(C),u.current!=null&&cancelAnimationFrame(u.current)}},[d,a]);const x=()=>{a&&o?.()};return s.jsx(ft,{sizeOverride:e,className:S(i==null&&"text-primary",i==="dark"&&"text-back",i==="light"&&"text-white"),thickness:t,backgroundStrokeClassName:S(i==null&&"stroke-[rgba(0,0,0,0.1)] dark:stroke-[rgba(0,0,0,0.32)]",i==="dark"&&"stroke-[rgba(0,0,0,0.32)]",i==="light"&&"stroke-[rgba(0,0,0,0.1)] "),percentage:a?100:c,onTransitionEnd:x,transitionDuration:"50ms",transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)"})},Zs=({checkpoints:e,activeCheckpointId:t,isIndeterminate:n=!1,isComplete:r})=>{const[a,o]=l.useState(r);return l.useEffect(()=>{o(r)},[t]),s.jsx(ce,{children:(t!=null&&!a||n)&&s.jsxs(R.div,{initial:{opacity:0},exit:{opacity:0},animate:{opacity:1},className:"bg-token-bg-primary absolute end-2 bottom-2 flex items-center gap-2 rounded-full px-3 py-1.5 shadow-lg",children:[n?s.jsx(ft,{percentage:30,thickness:1/12,className:"text-primary animate-spin",backgroundStrokeClassName:"dark:stroke-[rgba(255,255,255,0.4)] stroke-[rgba(0,0,0,0.1)]",sizeOverride:12}):t&&s.jsx(gt,{size:12,thickness:1/12,checkpoints:e,activeCheckpointId:t,isComplete:r,onTransitionComplete:()=>o(!0)}),s.jsxs("span",{className:"text-token-text-secondary flex items-baseline text-sm",children:[s.jsx(L,{id:"zfcWbe",defaultMessage:"Updating"}),s.jsx(_e,{gap:1.5,padding:2,size:2})]})]})})},ze=()=>Vt(Ge.getItem(qe.CODE_EXECUTION_DOMAIN_ALLOW_LIST),t=>Wt(t,{origin:Ve,expiresAt:zt}),[]).filter(({expiresAt:t})=>t>=Date.now()),Qs=()=>{Ge.removeItem(qe.CODE_EXECUTION_DOMAIN_ALLOW_LIST)},Js=(e,t)=>{const{origin:n}=new URL(e);let r=[...$s];const a=ze().map(({origin:o})=>o);return t&&(r=r.concat(a)),r.includes(n)},en=({networkAccessDeniedMessage:e,disableNetworkRequests:t})=>{const n=qt(),r=ne(),[a,o]=l.useState([]);return{onViolation:l.useCallback(c=>{const{blockedURI:f}=c;try{if(t)return n.danger(e??r.formatMessage({id:"Lp7cKY",defaultMessage:"Network access is disabled."}),{loggingTitle:"Network access is disabled.",toastId:"network_access_denied"});ee.count(te.WEB_SANDBOX,"network_access_requested");const{origin:d}=new URL(f),u=x=>{ee.count(te.WEB_SANDBOX,`network_access_request.${x?"allow":"deny"}`),o(p=>p.filter(h=>!Js(h.url,!t)&&h.url!==f))},m=()=>{Ge.setItem(qe.CODE_EXECUTION_DOMAIN_ALLOW_LIST,[...ze(),{origin:d,expiresAt:Date.now()+90*24*60*60*1e3}]),u(!0)};o(x=>[...x,{requestId:Oe(),url:f,origin:d,approve:m,deny:()=>u(!1)}])}catch(d){Fe.addError(d)}},[t,n,e,r]),pendingFetchRequests:a}},tn="https://persistent.oaistatic.com/canvas/loop-swirl.mp4",sn="https://persistent.oaistatic.com/canvas/loop-swirl-poster.jpg",me=90,nn=({title:e,checkpoints:t,activeCheckpointId:n,isComplete:r,onTransitionComplete:a})=>{const[o,i]=l.useState(!1),c=t.findIndex(u=>u.id===n),f=t[c],d=()=>{a?.(),i(!0)};return s.jsx(R.div,{className:"relative flex h-full w-full items-center justify-center",transition:{type:"spring",bounce:0},children:s.jsxs(R.div,{className:"flex -translate-y-12 flex-col items-center gap-3",style:{minWidth:me,height:me},initial:{opacity:0},animate:{opacity:1},transition:{type:"spring",duration:.5,bounce:0},children:[s.jsxs(R.div,{className:"bg-token-main-surface-primary absolute overflow-hidden rounded-3xl shadow-2xl",initial:!1,animate:{width:me,height:me,opacity:o?0:1},transition:{type:"spring",duration:.56,bounce:0},children:[s.jsx("video",{muted:!0,loop:!0,autoPlay:!0,playsInline:!0,src:tn,poster:sn,className:S("absolute inset-0 z-0 h-full w-full object-cover transition-opacity duration-200")}),s.jsx("div",{className:S("relative z-10 flex h-full w-full items-center justify-center",o?"opacity-0":"opacity-100"),children:s.jsx(gt,{color:"light",checkpoints:t,activeCheckpointId:n,isComplete:r,onTransitionComplete:d,thickness:1/12})})]}),s.jsxs(R.div,{className:S("flex flex-col items-center transition-opacity duration-200",r?"opacity-0":"opacity-100"),style:{translateY:me+20},children:[s.jsx("span",{className:"text-token-text-primary font-semibold",children:e}),f&&s.jsx(R.span,{className:"text-token-text-secondary flex items-baseline",children:s.jsx("span",{className:"loading-shimmer",children:f.label})})]})]})})},rn=()=>"?"+[""].filter(Boolean).join("&"),Je=[{id:Z.INITIALIZING,label:"Initializing environment",estimatedTime:1e3},{id:Z.INSTALLING_PACKAGES,label:"Installing packages",estimatedTime:2e3},{id:Z.RUNNING_CODE,label:"Ready",estimatedTime:1}],an=()=>Kt()?"ios":Zt()?"windows":Qt()?"android":Jt()?"safari":es()||ts()?"chrome":"unknown",on=(e,t)=>{ee.count(te.WEB_SANDBOX,`${t}.eval`),ct(e,"chatgpt_web_sandbox_code_run",`${t}`)},ln=(e,t)=>{ct(e,"chatgpt_web_sandbox_environment_error",`${t.error.name}: ${t.error.message}`),Fe.addError("Code execution environment error",{...t.error,errorMessage:`${t.error.name}: ${t.error.message}`}),t.error.name==="ServiceWorker"&&ee.count(te.WEB_SANDBOX,"service_worker_connection_failure",[{key:"agent",value:an()},{key:"is_share",value:String(t.isShare)}]),t.activeRun?.runId!=null&&t.activeRun.runId===t.activeRun?.runId&&ee.count(te.WEB_SANDBOX,`${t.activeRun.language}.environment_error`)},Qr=({ref:e,id:t,title:n,visuallyHidden:r,disablePermissions:a,isCodeUpdating:o,onCodeRunComplete:i,disableNetworkRequests:c=!1,networkAccessDeniedMessage:f,unsafeAllowAllNetworkRequests:d,enableTransition:u,onChangeBackgroundColor:m,onRetryCodeRun:x})=>{const[p,h]=l.useState(0),[y]=l.useState(()=>Xt(null)),C=l.useRef(null),g=l.useRef(null),E=l.useRef(!1),[b,T]=l.useState(null),[j,O]=l.useState(!1),{onViolation:P,pendingFetchRequests:D}=en({disableNetworkRequests:c,networkAccessDeniedMessage:f});l.useEffect(()=>{const w=g.current;if(w)return E.current=!0,Us(w,{sendInstrument:Ks,notifyEnvironmentError:k=>{ln(q,{error:k,isShare:!1,activeRun:C.current}),Qs(),h(H=>H+1),W()},notifyBackgroundColor:m,notifySecurityPolicyViolation:P},["runUserCode"]).then(k=>{y.set(k)}),()=>{y.set(null),E.current=!1}},[p]);const F=async()=>(await ss(()=>y()!=null),le(y())),W=()=>{C.current=null,T(null),O(!1),i?.()},q=lt(),z=async function*({code:w,language:k}){T(Z.INITIALIZING),on(q,k);const H=await F(),Y=Oe();C.current={runId:Y,language:k};const v=ze().map(({origin:I})=>I),M=d?null:c?{resourceDomains:[],connectDomains:[]}:{connectDomains:v,resourceDomains:v};for await(const I of await H.runUserCode({code:w,id:t,language:k,csp:M})){const B={timestamp:Date.now(),id:Oe(),runId:Y};switch(I.type){case N.ERROR:ee.count(te.WEB_SANDBOX,`${k}.error`),yield{...I,...B};break;case N.ENVIRONMENT_STATUS:T(I.status),u||O(I.status===Z.RUNNING_CODE),yield{...I,...B};break;case N.RUN_COMPLETE:I.type===N.RUN_COMPLETE&&I.wasFatalError&&ee.count(te.WEB_SANDBOX,`${k}.fatal_runtime_error`),yield{...I,...B},C.current?.runId===Y&&W();break;case N.LOG:yield{...I,...B};break;default:continue}}},X=async(w,k)=>{(await F()).prepareEnvironment({code:w,language:k,id:t})},A=async()=>{(await F()).stop()};l.useImperativeHandle(e,()=>({stop:A,evalAsync:z,prepareEnvironment:X}));const _={type:"spring",duration:j&&u?.56:0,delay:j?.12:0,bounce:0},re=a?"":"midi";return s.jsxs(Yt,{children:[s.jsxs("div",{className:S("relative flex",r?"fixed h-0 w-0":"h-full w-full"),children:[!r&&b!=null&&u&&s.jsx(nn,{isComplete:b===Z.RUNNING_CODE,onTransitionComplete:()=>O(!0),activeCheckpointId:b,title:n,checkpoints:Je}),s.jsx(R.div,{className:S("bg-token-main-surface-primary absolute inset-0 m-auto origin-center overflow-hidden",j?"pointer-events-auto":"pointer-events-none"),animate:{opacity:j?1:0,...j?{scale:1}:{scale:.95}},transition:_,children:s.jsx(R.iframe,{title:n,className:"h-full w-full overflow-hidden",transition:_,"aria-hidden":r?"true":void 0,allow:re,src:`${Fs}/index.html${rn()}`,sandbox:"allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox allow-forms",ref:g,tabIndex:-1},`sandbox-${p}`)}),j&&s.jsx(Zs,{isIndeterminate:o,isComplete:b===Z.RUNNING_CODE,activeCheckpointId:b,checkpoints:Je})]}),D.length>0&&s.jsx(Ys,{title:n,requests:D,onConfirm:()=>{h(w=>w+1),T(null),O(!1),setTimeout(()=>{x?.()})}})]})};function cn(e,t,n){const r=new Map;return e.forEach((a,o)=>{const i=vs(a,t,n);i&&r.set(o,i)}),r}function dn(e,t){const n=fn(e);if(n.length===0)return t;let r=t;return n.forEach(a=>{r=un(a,r)}),r}function un(e,t){return cn(t,{start:e.fromA,end:e.toA},mn(e))}function mn(e){const{fromA:t,toA:n,fromB:r,toB:a}=e;return a-r-(n-t)}function fn(e){const t=[],n=(r,a,o,i)=>{t.push({fromA:r,toA:a,fromB:o,toB:i})};return e.changes.iterChangedRanges(n,!0),t}function pn(e,t){const n=Array.from(e.keys()),r=Array.from(t.keys());if(n.length!==r.length)return!1;n.sort(),r.sort();for(let a=0;a<n.length;a++)if(n[a]!==r[a])return!1;for(const a of n){const o=e.get(a),i=t.get(a);if(!o||!i||o.start!==i.start||o.end!==i.end)return!1}return!0}function xn(e,t){return{"bg-yellow-100 dark:bg-yellow-400":!0,"bg-yellow-400/40 dark:bg-yellow-400/50":e&&!t,"bg-yellow-400/60 dark:bg-yellow-500/70":t,"bg-yellow-100 dark:bg-yellow-400/30":!e&&!t}}const hn={"bg-transparent!":!0};function gn({isHovered:e,isFocused:t,isCode:n,diffStatus:r}){return S(n?qs:Vs,"cursor-text group is-comment transition-colors",{...r===Se.REMOVED?hn:xn(e,t)},"group-[.is-comment]:bg-opacity-40")}function yn(e,t){return e.map(n=>{const r=t.get(n.id);return r?{...n,at:r}:null}).filter(dt)}var ae=(e=>(e.ASK="ask",e.CREATE_TEXTDOC="create_textdoc",e.COMMENT="comment",e.EDIT="edit",e))(ae||{}),Cn=(e=>(e.SELECTION="selection",e.BLOCK="block",e))(Cn||{});function Jr(e){return e?.type==="selection"}const vn=ut(()=>({commentingOn:null,hoveredCommentId:null,focusedCommentId:null,visibleBlockCommentLauncher_DEBUG_ONLY:null,hoveredBlockCommentLauncherPos:null})),{setState:K,getInitialState:En}=vn,je={reset:()=>K(En()),startCommentingOn:e=>K(t=>({...t,commentingOn:e})),cancelCommentingOn:()=>K(e=>({...e,commentingOn:null})),focusComment:e=>K(t=>({...t,focusedCommentId:e})),blurComment:()=>K(e=>({...e,focusedCommentId:null})),mouseEnterComment:e=>K(t=>({...t,hoveredCommentId:e})),mouseLeaveComment:()=>K(e=>({...e,hoveredCommentId:null})),mouseEnterBlock:e=>K(t=>({...t,hoveredBlockCommentLauncherPos:e})),mouseLeaveBlock:()=>K(e=>({...e,hoveredBlockCommentLauncherPos:null})),setVisibleBlockComment_DEBUG_ONLY:e=>K(t=>({...t,visibleBlockCommentLauncher_DEBUG_ONLY:e}))},yt=Ie.define(),bn=Ie.define(),wn=Ie.define(),Sn=Ie.define();function Nn(e){return new Map(e.map(t=>[t.id,t.at]))}const De=de.define({create(){return null},update(e,t){for(const n of t.effects)if(n.is(yt))return n.value;return e}}),Be=de.define({create(){return[]},update(e,t){for(const i of t.effects)if(i.is(bn))return i.value;const n=e,r=Nn(n),a=dn(t,r);return pn(r,a)?n:yn(n,a)}}),Pe=de.define({create(){return null},update(e,t){for(const n of t.effects)if(n.is(wn))return n.value;return e}}),He=de.define({create(){return null},update(e,t){for(const n of t.effects)if(n.is(Sn))return n.value;return e}});function et(e){if(!e||e.to-e.from===0)return ie.none;const t=ie.mark({class:Ws.code});return ie.set([t.range(e.from,e.to)])}function tt(e,t,n){if(e.length===0)return ie.none;const a=[...e].sort((o,i)=>o.at.start-i.at.start).map(o=>{if(o.at.end-o.at.start===0)return null;const i=o.id===t,c=o.id===n,f=gn({isHovered:i,isFocused:c,isCode:!0,diffStatus:o.diffStatus});return ie.mark({class:f,attributes:{"data-comment-id":o.id}}).range(o.at.start,o.at.end)}).filter(dt);return ie.set(a)}const jn=de.define({create(e){const t=e.field(De,!1);return et(t??null)},update(e,t){const n=t.state.field(De,!1);return et(n??null)},provide:e=>Ne.decorations.from(e)}),kn=de.define({create(e){const t=e.field(Be,!1),n=e.field(Pe,!1),r=e.field(He,!1);return tt(t??[],n??null,r??null)},update(e,t){const n=t.state.field(Be,!1),r=t.state.field(Pe,!1),a=t.state.field(He,!1);return tt(n??[],r??null,a??null)},provide:e=>Ne.decorations.from(e)});function Mn(e){e.state.selection.main.empty&&e.dispatch({effects:yt.of(null)})}function Ct(e){let t=e.dataset.commentId;for(let n=0;n<10&&!t&&e.parentElement;n++)e=e.parentElement,t=e.dataset.commentId;return t}function Tn(e){const t=e.target,n=Ct(t);n&&je.focusComment(n)}function _n(e){const t=e.target,n=Ct(t);n?je.mouseEnterComment(n):je.mouseLeaveComment()}function ea(e,t=null,n=null){return[Be.init(()=>e),De,Pe.init(()=>t),He.init(()=>n),jn,kn,Ne.updateListener.of(r=>{r.selectionSet&&Mn(r.view)}),Ne.domEventHandlers({click:Tn,mouseover:_n})]}const In=({onClose:e,title:t,actions:n,showBorder:r=!1})=>s.jsxs("div",{className:S("bg-token-bg-primary flex items-center justify-between border-b py-2 ps-2 pe-2.5",{"border-token-border-light":r,"border-transparent":!r}),children:[s.jsx("div",{className:"text-token-text-primary flex items-center gap-2 ps-4 text-sm select-none",children:t}),s.jsxs("div",{className:"flex items-center gap-2",children:[n.map(({tooltip:a,icon:o,onClick:i},c)=>{const f=s.jsx(Q,{size:"small",color:"ghost",as:"button",className:"text-token-text-primary aspect-square p-1!",icon:o,onClick:i},c);return a?s.jsx(Te,{label:a,children:f},c):f}),s.jsx(Q,{size:"small",color:"ghost",as:"button",className:"text-token-text-primary aspect-square p-1!",onClick:e,icon:We})]})]}),vt=e=>ns([N.ERROR,N.LOG,N.OUTPUT],e.type),Et=e=>e.type===N.OUTPUT&&bt(e.output),bt=e=>typeof e=="string"&&e.startsWith("data:image/png;"),fe=({as:e="li",contentBefore:t,contentAfter:n,disableEntryAnimation:r=!1,hasHint:a=!1,bottomBorder:o=!1,isHintOpen:i=!1,isSticky:c=!1,onClick:f,children:d})=>{const u=!!f,m=e==="div"?R.div:R.li;return s.jsxs(m,{initial:r?!1:{opacity:0},animate:{opacity:1},transition:{duration:.32},role:u?"button":void 0,className:S("bg-token-bg-primary flex items-start justify-between py-1.5 ps-6 pe-4 font-mono text-sm whitespace-pre",o&&"border-token-border-xlight border-b",c&&"sticky top-0 z-10",u&&"cursor-pointer",u&&a&&"hover:bg-red-500/10",u&&!a&&"hover:bg-gray-50 dark:hover:bg-gray-700",a&&i&&"bg-red-500/10"),onClick:u?f:void 0,children:[t&&s.jsx("div",{className:"me-3 flex h-6 w-5 items-start",children:t}),s.jsx("div",{className:"flex min-h-6 min-w-0 flex-1 items-start justify-start gap-2 leading-6",children:d}),n&&s.jsx("div",{className:"ms-3 flex min-h-6 items-start leading-6",children:n})]})},Rn=e=>l.createElement("svg",{width:20,height:20,viewBox:"0 0 20 20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg","data-rtl-flip":"",...e},l.createElement("path",{d:"M3.16504 9.99969C3.16523 6.49039 6.18893 3.58173 10 3.58173C13.8111 3.58173 16.8348 6.49039 16.835 9.99969C16.835 11.4535 16.3206 12.7965 15.4473 13.8766C15.3248 14.0282 15.2747 14.2262 15.3105 14.4177C15.4061 14.9255 15.5407 15.4197 15.6953 15.904C15.068 15.8203 14.4632 15.6959 13.8721 15.528L13.7461 15.5056C13.6191 15.4949 13.4909 15.5208 13.377 15.5817C12.3827 16.1135 11.2308 16.4186 10 16.4186C6.18881 16.4186 3.16504 13.5091 3.16504 9.99969ZM1.83496 9.99969C1.83496 14.3143 5.52692 17.7487 10 17.7487C11.356 17.7487 12.6371 17.4332 13.7656 16.8757C14.6851 17.118 15.6308 17.2694 16.626 17.3307C16.8517 17.3446 17.0693 17.2426 17.2031 17.0602C17.337 16.8778 17.3682 16.6397 17.2871 16.4284L17.0801 15.863C16.9176 15.3953 16.7809 14.9297 16.6777 14.4606C17.6128 13.202 18.165 11.6626 18.165 9.99969C18.1649 5.68526 14.473 2.25165 10 2.25165C5.52703 2.25165 1.83515 5.68526 1.83496 9.99969Z"}),l.createElement("path",{d:"M10 6.33499C9.63277 6.33503 9.33496 6.63279 9.33496 7.00003V9.33499L7 9.34866L6.86621 9.36234C6.56317 9.42429 6.33504 9.69237 6.33496 10.0137C6.33504 10.335 6.56319 10.6031 6.86621 10.6651L7 10.6787L9.33496 10.6651V13C9.33505 13.3672 9.63282 13.665 10 13.6651C10.3672 13.6651 10.665 13.3672 10.665 13V10.6651L13 10.6787C13.3672 10.6787 13.665 10.3809 13.665 10.0137C13.665 9.64651 13.3672 9.34866 13 9.34866L10.665 9.33499V7.00003C10.665 6.63276 10.3673 6.33499 10 6.33499Z"})),Ln=e=>l.createElement("svg",{width:20,height:20,viewBox:"0 0 20 20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg","data-rtl-flip":"",...e},l.createElement("path",{d:"M3.16504 9.99969C3.16523 6.49039 6.18893 3.58173 10 3.58173C13.8111 3.58173 16.8348 6.49039 16.835 9.99969C16.835 11.4535 16.3206 12.7965 15.4473 13.8766C15.3248 14.0282 15.2747 14.2262 15.3105 14.4177C15.4061 14.9255 15.5407 15.4197 15.6953 15.904C15.068 15.8203 14.4632 15.6959 13.8721 15.528L13.7461 15.5056C13.6191 15.4949 13.4909 15.5208 13.377 15.5817C12.3827 16.1135 11.2308 16.4186 10 16.4186C6.18881 16.4186 3.16504 13.5091 3.16504 9.99969ZM1.83496 9.99969C1.83496 14.3143 5.52692 17.7487 10 17.7487C11.356 17.7487 12.6371 17.4332 13.7656 16.8757C14.6851 17.118 15.6308 17.2694 16.626 17.3307C16.8517 17.3446 17.0693 17.2426 17.2031 17.0602C17.337 16.8778 17.3682 16.6397 17.2871 16.4284L17.0801 15.863C16.9176 15.3953 16.7809 14.9297 16.6777 14.4606C17.6128 13.202 18.165 11.6626 18.165 9.99969C18.1649 5.68526 14.473 2.25165 10 2.25165C5.52703 2.25165 1.83515 5.68526 1.83496 9.99969Z"}));function On(e){switch(e){case"dark_gray":return{normal:"text-token-text-secondary dark:text-white-400",hover:"cursor-pointer hover:text-token-text-primary group-hover:text-token-text-primary"};case"light_gray":return{normal:"text-gray-400",hover:"cursor-pointer hover:text-token-text-secondary group-hover:text-token-text-secondary"};case"error":return{normal:"text-red-500",hover:"cursor-pointer hover:text-red-500 group-hover:text-red-500"}}}function Xe({children:e,className:t,onClick:n,isClickable:r=!1,theme:a="dark_gray"}){const o=On(a),i=(n!=null||r)&&o.hover;return s.jsxs("div",{className:S("icon relative inline-block transition-opacity",t,i,o.normal),onClick:n,children:[e?s.jsx(Ln,{className:"icon"}):s.jsx(Rn,{className:"icon"}),s.jsx("span",{className:S("absolute inset-0 flex items-center justify-center text-[8px] font-black",i,o.normal),children:e})]})}function Ye(){return s.jsx(Xe,{theme:"light_gray",children:s.jsx(_e,{})})}function An({count:e,isLoading:t,onClick:n,isError:r=!1}){return t?s.jsx(Ye,{}):s.jsx(Xe,{onClick:n,theme:r?"error":"dark_gray",children:e})}function ta({isLoading:e=!1,onClick:t}){return e?s.jsx(Ye,{}):s.jsx(Xe,{isClickable:!0,onClick:t,theme:"light_gray"})}const wt={type:"spring",bounce:.12,duration:.5},St="opacity-50",Dn=({position:e="absolute",count:t,offsetY:n,isLoading:r=!1,onClick:a,isError:o=!1})=>s.jsx(R.div,{className:S("flex",e,Ee.collapsedComment),initial:{opacity:0},animate:{opacity:1},style:{translateY:n},transition:wt,exit:{opacity:0},children:s.jsx(An,{count:t,isLoading:r,onClick:a,isError:o})}),Bn=({isFocused:e,isHovered:t})=>{const n=e||t?"grow font-medium text-token-text-primary transition-colors":"grow font-medium text-token-text-secondary transition-colors",r=e||t?"opacity-100 transition":"opacity-75 transition";return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:r,children:s.jsx("div",{className:"gizmo-bot-avatar rounded-full",children:s.jsx(Es,{iconName:"openai"})})}),s.jsx("span",{className:n,children:"ChatGPT"})]})},Pn=({comment:{diffStatus:e,content:t},isFocused:n,isSomeCommentFocused:r,isHovered:a})=>{const o=e===Se.REMOVED;return s.jsx("div",{className:S("text-token-text-primary mt-2 transition-all",{"opacity-80":!n&&!r&&!a&&!o,"opacity-40":!n&&r&&!a&&!o,[St]:o}),children:s.jsx(bs,{text:t})})},Hn=({acceptButtonLabel:e,position:t="absolute",left:n,right:r,comment:a,disableAnimations:o=!1,onClick:i,onMouseEnter:c,onMouseLeave:f,onAccept:d,onDismiss:u,translateY:m,isFocused:x=!1,isSomeCommentFocused:p=!1,disableActions:h=!1,isHovered:y=!1},C)=>{const[g,E]=l.useState(!1),b=a.diffStatus===Se.ADDED,T=a.diffStatus===Se.REMOVED,j=a.diffStatus!=null,O=()=>{E(!0),c?.()},P=()=>{E(!1),f?.()},D=ne(),F=x||g&&!p;return s.jsx(R.div,{ref:C,className:S(t,Ee.expandedComment,{"cursor-default":x,"cursor-pointer":!x,[Ee.expandedCommentFocused]:x,[Ee.expandedCommentHovered]:y}),style:{left:n,right:r},initial:o?!1:{translateY:m,scale:.85,opacity:0},animate:o?void 0:{translateY:m,scale:x?1:.97,opacity:1},exit:o?void 0:{scale:.85,opacity:0,filter:"blur(16px)"},transition:wt,onClick:i,onMouseEnter:h?void 0:O,onMouseLeave:h?void 0:P,"data-comment-id":a.id,children:s.jsxs("div",{className:S("flex min-h-8 flex-col overflow-hidden rounded-2xl border p-4 pt-2 text-start text-sm transition-all",{"border-transparent bg-gray-50 dark:bg-gray-800":!x&&!y,"border-token-border-default bg-token-main-surface-primary":y&&!x,"border-token-border-default bg-token-main-surface-primary shadow-xl":x||g&&!p,"relative after:absolute after:start-0 after:top-0 after:bottom-0 after:w-1":j,"after:bg-green-500":b,"after:bg-red-500":T}),style:{width:Os},children:[s.jsxs("div",{className:S("flex h-8 flex-row items-center gap-2.5",{[St]:T}),children:[s.jsx(Bn,{isFocused:x,isHovered:y}),s.jsx("button",{className:S("text-token-text-secondary -me-1 rounded-full bg-transparent p-1",{"hover:text-token-text-primary cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700":!h,"cursor-not-allowed":h}),onClick:u,disabled:h,"aria-label":D.formatMessage({id:"fYDa3C",defaultMessage:"Dismiss comment"}),children:s.jsx(rs,{className:"icon-sm"})})]}),s.jsx(Pn,{comment:a,isFocused:x,isHovered:y,isSomeCommentFocused:p}),s.jsx(ce,{initial:!1,children:F&&s.jsx(R.div,{initial:o?!1:{opacity:0,height:0},animate:{opacity:1,height:"auto",transition:{opacity:{delay:.14,duration:.2},height:{bounce:0,duration:.2}}},exit:o?void 0:{opacity:0,height:0,transition:{opacity:{duration:.08},height:{bounce:0,duration:.2}}},className:"flex items-center justify-start",children:s.jsx("div",{className:"mt-2.5",children:s.jsx(Q,{color:"secondary",onClick:d,disabled:h,children:e??D.formatMessage({id:"WIW5OL",defaultMessage:"Apply"})})})})})]})})},Nt=l.forwardRef(Hn),sa=({offsetY:e,opensOverDocument:t=!1,disableActions:n=!1,isFocused:r=!1,isSomeCommentFocused:a=!1,onAccept:o,onClick:i,onDismiss:c,onMouseEnter:f,onMouseLeave:d,comment:u,isHovered:m=!1})=>{const x=l.useRef(null);return l.useEffect(()=>as(document,{mousedown:({target:p})=>{p instanceof HTMLElement&&!p.closest("[data-comment-id]")&&!x.current?.contains(p)&&je.blurComment()}})),s.jsx(Nt,{ref:x,comment:u,disableActions:n,onAccept:o,onDismiss:c,onMouseEnter:f,onMouseLeave:d,isSomeCommentFocused:a,isHovered:m,onClick:i,translateY:e,isFocused:r,left:t?void 0:Ds,right:t?As:void 0})};var J=(e=>(e.LOADING="loading",e.READY="ready",e.RESOLVED="resolved",e))(J||{});const jt=({hint:e,onClickFix:t,isOpen:n,onOpenChange:r})=>{const a=l.useRef(null),o=ne();return e?s.jsx("div",{className:"relative flex items-center font-sans",onClick:i=>i.stopPropagation(),children:s.jsxs(ws,{open:n,onOpenChange:r,children:[s.jsx(Ss,{asChild:!0,ref:a,children:e.status==="resolved"?s.jsx("div",{className:"flex h-5 w-5 items-center",children:s.jsx(Ns,{className:"text-token-text-tertiary",size:16})}):s.jsx("button",{className:"h-5 w-5",disabled:e.status==="loading",children:e.status==="loading"?s.jsx(Ye,{}):s.jsx(Dn,{position:"static",isError:!0,count:1,offsetY:0})})}),s.jsx(ce,{children:n&&s.jsx(js,{forceMount:!0,container:a.current?.ownerDocument.body,children:s.jsx(ks,{side:"top",align:"start",alignOffset:-4,sideOffset:10,children:s.jsx(Nt,{position:"static",translateY:0,right:0,isFocused:!0,onDismiss:()=>r?.(!1),onAccept:i=>{r?.(!1),t?.(i)},comment:e,acceptButtonLabel:o.formatMessage({id:"Dl9vBh",defaultMessage:"Fix bug"})})})})})]})}):s.jsx("div",{className:"w-5"})},$n="module:",$e=({log:e,isDisabled:t=!1,onClick:n})=>s.jsx("div",{className:"flex items-center",children:"line"in e&&e.line!=null&&s.jsxs("button",{onClick:()=>e.line!=null&&n?.(e.line),className:"text-token-text-tertiary select-none enabled:hover:underline",disabled:t,children:[$n,e.line]})}),Un=({isPreview:e=!1,log:t,level:n})=>s.jsxs("span",{className:S("text-token-text-primary flex min-w-0 flex-wrap gap-1",e?"shrink truncate":"whitespace-pre-wrap",n==="warn"&&"text-yellow-600"),children:[n==="warn"&&"[warn]: ",typeof t=="string"?t:t.map((r,a)=>s.jsx(Gs,{isPreview:e,value:r},a))]}),kt=({error:e,isPreview:t=!1,isResolved:n=!1})=>{const r=e.name+":";return s.jsxs("span",{className:S("whitespace-pre-wrap",n?"text-token-text-primary":"text-red-500"),children:[s.jsx("span",{className:"font-semibold",children:r})," ",e.message,s.jsx("div",{children:e.stack.length>0&&!t?e.stack.join(`
`):""})]})},Fn=({output:e,isPreview:t=!1})=>{const n=ne();return e==null?null:bt(e)?s.jsx("img",{alt:n.formatMessage(qn.imgAlt),className:S(t&&"border-token-border-xlight h-6 rounded-lg border"),src:e}):s.jsx("span",{className:"flex items-center gap-2",children:Ve(e)})},Ke=({log:e,isHintResolved:t,isPreview:n=!1})=>{switch(e.type){case N.LOG:return s.jsx(Un,{isPreview:n,...e});case N.ERROR:return s.jsx(kt,{isPreview:n,isResolved:t,...e});case N.OUTPUT:return s.jsx(Fn,{isPreview:n,...e});default:return null}},Gn=({log:e,isStale:t=!1,onClickFix:n,onClickLineNumber:r,hint:a})=>{const[o,i]=l.useState(!1);if(e.type===N.RUN_COMPLETE)return null;const c=a?.status===J.RESOLVED,f=e.type===N.ERROR&&a?.status===J.READY;return s.jsx(fe,{hasHint:f,isHintOpen:o,bottomBorder:!0,onClick:a&&!c&&(()=>i(!0)),contentBefore:s.jsx(jt,{hint:a,isOpen:o,onOpenChange:i,onClickFix:d=>e.type===N.ERROR&&a&&n?.(d,a.id,e.error)}),contentAfter:s.jsx($e,{log:e,isDisabled:t,onClick:r}),children:s.jsx(Ke,{log:e,isHintResolved:c})})},qn=Me({imgAlt:{id:"L6t7Yb",defaultMessage:"Plot"},ranCode:{id:"ffa9Nt",defaultMessage:"Ran code"},askForHelp:{id:"wMZco9",defaultMessage:"Ask ChatGPT for help"},askForFix:{id:"A9pxgT",defaultMessage:"Fix it for me"}}),Vn=({timestamp:e,duration:t})=>{const[,n]=l.useState(0);l.useEffect(()=>{setInterval(()=>{n(o=>o+1)},5e3)},[]);const r=Date.now(),a=Math.round((r-e)/1e3);return s.jsx(Te,{label:s.jsx(L,{id:"bFO21A",defaultMessage:"Code ran {count, plural, =0 {instantly} one {in # second} other {in # seconds}}",values:{count:Math.floor(t/1e3)}}),children:s.jsx("span",{className:"text-token-text-tertiary",children:a>=60?s.jsx(Ht,{value:-a,updateIntervalInSeconds:60,numeric:"auto"}):s.jsx(L,{id:"bRCEFN",defaultMessage:"Just now"})})})},Mt=({isComplete:e,timestamp:t,duration:n})=>e&&t!=null&&n!=null?s.jsx(Vn,{timestamp:t,duration:n}):e&&n==null?s.jsx("span",{className:"text-token-text-tertiary",children:s.jsx(L,{id:"EMebM9",defaultMessage:"Stopped"})}):s.jsx(_e,{gap:2}),Wn=e=>{switch(e){case Z.INITIALIZING:return s.jsx(L,{id:"J183Z0",defaultMessage:"initializing environment"});case Z.INSTALLING_PACKAGES:return s.jsx(L,{id:"21sQ8o",defaultMessage:"installing packages"});case Z.RUNNING_CODE:return s.jsx(L,{id:"nHITHk",defaultMessage:"running code"})}},be=e=>{"use forget";const t=$t.c(6),{message:n,isComplete:r,statusLogs:a}=e;let o;if(t[0]!==r||t[1]!==n||t[2]!==a){const i=Ae(a);let c;t[4]!==n?(c=s.jsx("span",{className:"text-token-text-secondary font-semibold",children:s.jsx(L,{...n})}),t[4]=n,t[5]=c):c=t[5],o=s.jsxs("span",{className:"flex items-center",children:[c,!r&&i&&s.jsxs(R.span,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{delay:.3,duration:.1},className:"text-token-text-tertiary ms-2 flex items-baseline",children:[Wn(i.status),s.jsx(_e,{gap:2,size:2})]})]}),t[0]=r,t[1]=n,t[2]=a,t[3]=o}else o=t[3];return o},zn=({children:e,firstLog:t,lastLog:n,isHintResolved:r,duration:a,isComplete:o=!1,isLast:i=!1,statusLogs:c})=>{const[f,d]=l.useState(!0),[u,m]=l.useState(!1),x=()=>{d(!f)},p=l.useCallback(h=>{if(!h)return;const y=new IntersectionObserver(C=>{m(C[0].intersectionRatio===0)},{threshold:0});return y.observe(h),()=>{y.disconnect()}},[]);return s.jsxs("li",{className:"relative flex flex-col",children:[s.jsx("div",{"aria-hidden":"true",className:"pointer-events-none absolute h-[1px] bg-transparent",ref:p}),s.jsxs(fe,{as:"div",disableEntryAnimation:!0,isSticky:!0,bottomBorder:u||!i&&!f,contentAfter:s.jsx(Mt,{isComplete:o,duration:a,timestamp:t?.timestamp}),contentBefore:s.jsx("button",{className:"text-token-text-tertiary",onClick:()=>x(),children:s.jsx(Ms,{className:S("icon transition-transform",f&&"rotate-90")})}),onClick:()=>x(),children:[s.jsx(be,{isComplete:o,message:we.run,statusLogs:c}),!f&&n&&s.jsx(Ke,{isPreview:!0,isHintResolved:r,log:n})]}),f&&e]})},Xn=({runMessages:e,onClickFix:t,onClickLineNumber:n,hints:r,isLast:a,includeContentBefore:o=!1})=>{const[i,c]=l.useState(!1),f=e.filter(g=>g.type===N.ENVIRONMENT_STATUS),d=e.filter(vt),u=Ae(e),m=u?.type===N.RUN_COMPLETE,x=m?u.duration:null,p=d[0];if(m){if(d.length===0)return s.jsx(fe,{isHintOpen:i,bottomBorder:!0,contentBefore:o,contentAfter:s.jsx(Mt,{isComplete:m,duration:x,timestamp:p?.timestamp}),children:s.jsx(be,{isComplete:m,message:we.success,statusLogs:f})});if(d.length===1&&p?.type===N.ERROR){const g=r.get(p.id);return s.jsxs(fe,{hasHint:!!g,isHintOpen:i,bottomBorder:!0,contentBefore:(o||!!g)&&s.jsx(jt,{hint:g,isOpen:i,onOpenChange:c,onClickFix:E=>t?.(E,p.id,p.error)}),contentAfter:s.jsx($e,{log:p,onClick:n}),onClick:g&&g.status!==J.RESOLVED&&(()=>c(!0)),children:[s.jsx(be,{isComplete:m,message:we.run,statusLogs:f}),s.jsx(kt,{isResolved:g?.status===J.RESOLVED,...p})]})}else if(d.length===1&&p&&!Et(d[0]))return s.jsxs(fe,{bottomBorder:!0,contentBefore:o,contentAfter:s.jsx($e,{log:p,onClick:n}),children:[s.jsx(be,{isComplete:m,message:we.run,statusLogs:f}),s.jsx(Ke,{log:p})]})}const h=Ae(d.filter(g=>g.type!==N.RUN_COMPLETE)),C=(h&&r.get(h.id))?.status===J.RESOLVED;return s.jsx(zn,{statusLogs:f,firstLog:e[0]??null,lastLog:h??null,duration:x,isComplete:m,isHintResolved:C,isLast:a,children:s.jsx("ol",{children:d.map(g=>s.jsx(Gn,{log:g,onClickLineNumber:n,onClickFix:t,hint:r.get(g.id)},g.id))})})},we=Me({success:{id:"laZI5H",defaultMessage:"Run successfully"},run:{id:"o7dgBT",defaultMessage:"Run"}}),Yn=({messages:e,scrollRef:t,onClose:n,onClickLineNumber:r,onClickFix:a,title:o,headerActions:i,hints:c,paddingBottom:f})=>{const d=c.size>0,u=l.useMemo(()=>Object.entries(os(e,"runId")),[e]),m=u.some(([,x])=>{const p=x.filter(vt);return p.length>1||p.length===1&&Et(p[0])});return s.jsxs(s.Fragment,{children:[s.jsx(In,{title:o,actions:i,onClose:n,showBorder:e.length>0}),s.jsx("div",{ref:t,className:"bg-token-bg-primary flex flex-1 flex-col-reverse overflow-auto",children:s.jsx("ol",{className:"flex flex-1 flex-col justify-start pb-4",style:{paddingBottom:f},children:s.jsx(ce,{children:u.map(([x,p],h)=>s.jsx(Xn,{runMessages:p,includeContentBefore:m||d,onClickFix:a,onClickLineNumber:r,hints:c,isLast:h===u.length-1},x))})})})]})},Kn=({onDrag:e,onDragEnd:t,onDoubleClick:n})=>s.jsx(R.div,{drag:"y",className:"bg-token-text-quaternary absolute top-[-2px] z-10 h-[4px] w-full cursor-ns-resize opacity-0",whileHover:{opacity:.5},whileDrag:{opacity:.75,height:"8px",top:"-4px"},transition:{type:"tween",duration:.1},style:{x:0,y:0,transform:"translateY(0px)"},dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:{left:0,right:0,top:0,bottom:0},onDrag:(r,a)=>{e?.(a)},onDragEnd:t,onDoubleClick:n}),Zn=({textdocTitle:e,onClickViewConsole:t,onClickFix:n,onDismiss:r})=>s.jsxs(R.div,{initial:{scale:.95,opacity:0},exit:{scale:.95,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",bounce:.12,duration:.3},className:"border-token-border-default bg-token-main-surface-primary absolute end-2 bottom-2 flex w-fit max-w-80 flex-col gap-4 rounded-xl border px-4 py-4 shadow-xl",children:[s.jsxs("div",{className:"flex items-start",children:[s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsx("div",{className:"text-sm font-semibold",children:s.jsx(L,{id:"ObCQBq",defaultMessage:"Cannot preview your code"})}),s.jsx("div",{className:"text-sm",children:s.jsx(L,{id:"3ZeoP8",defaultMessage:"An error occured while trying to run {name}",values:{name:e}})})]}),s.jsx(Q,{size:"small",color:"ghost",as:"button",className:"text-token-text-tertiary -m-1! aspect-square p-0!",onClick:r,icon:We})]}),s.jsxs("div",{className:"flex items-center justify-end gap-2",children:[s.jsx(Q,{size:"small",color:"secondary",onClick:t,children:s.jsx(L,{id:"Fch32I",defaultMessage:"View console"})}),s.jsx(Q,{size:"small",color:"primary",onClick:n,children:s.jsx(L,{id:"HRfYX0",defaultMessage:"Fix bug"})})]})]}),Tt=(e,{name:t,message:n,line:r,stack:a})=>{const o=r!=null?`

Error occured in:
${e.split(`
`).slice(r-1,r+1).join(`
`)}`:"";return`${t}: ${n}

Stack:
${a.join("")}${o}`},Le=new zs({capacity:5}),Qn=async(e,t,n)=>{const r=Tt(t,n.error),a=Ve(Le.get(r));if(Le.get(r))return a;const{hint:o}=await ye.safePost("/textdoc/{textdoc_id}/code/hint",{parameters:{path:{textdoc_id:e}},requestBody:{error:r,line:n.error.line??-1}});return Le.set(r,o),o},Jn=`You're a professional developer highly skilled in debugging. The user ran the textdoc's code, and an error was thrown.
Please think carefully about how to fix the error`,er=(e,t,n)=>{const r=Tt(e,n);return`
${Jn}, and then rewrite the textdoc to fix it.

- NEVER change existing test cases unless they're clearly wrong.
- ALWAYS add more test cases if there aren't any yet.
- ALWAYS ask the user what the expected behavior is in the chat if the code is not clear.

${t?`# Hint

${t}

`:""}
# Error

${r}`.trim()},tr=({sandboxRef:e,textdocContent:t,textdocTitle:n,textdocId:r,isOpen:a,isTextdocAttachedPending:o,headerActions:i=[],highlightLine:c,createTextdocTurn:f,onOpenChange:d},u)=>{const[m,x]=l.useState(!1),[p,h]=l.useState(!1),[y,C]=l.useState([]),[g,E]=l.useState(0),[b,T]=l.useState(null),[j,O]=l.useState(null),[P,D]=l.useState(()=>new Map),[F,W]=l.useState(320),q=l.useRef(null),z=ne();l.useEffect(()=>O(null),[t]);const X=y.filter(v=>[N.LOG,N.ERROR,N.OUTPUT].includes(v.type)).length;l.useEffect(()=>{a&&E(X)},[a]);const A=l.useMemo(()=>{for(let v=y.length-1;v>=0;v--){const M=y[v];if(M.runId!==j)return null;if(M.type===N.ERROR)return M}return null},[y,j]),_=(v,M,I)=>{const B=P.get(M);if(B){const{id:V,content:Ce}=B;D(Re=>{const U=new Map(Re);return U.set(V,{id:V,content:Ce,status:J.RESOLVED}),U})}T(M),f({sourceEvent:v,action:ae.EDIT,userMessageType:$.CONSOLE,content:er(t,B?.content??null,I)})},re=async(v,M)=>{if(!o){D(I=>{const B=new Map(I);return B.set(v,{id:v,status:J.LOADING,content:""}),B});try{const I=await Qn(r,t,M);D(B=>{const V=new Map(B);return V.set(v,{id:v,status:J.READY,content:I}),V})}catch{D(B=>{const V=new Map(B);return V.delete(v),V})}}},w=async(v,M)=>{const I=Bs(v,M),B=Ps(v,M),V=Hs(v);if(!I||!V&&!B)return;V&&d?.(!0),h(!0),C(U=>U.map(ue=>({...ue,isStale:!0})));let Ce=!1;const Re=le(e.current).evalAsync({code:M,language:I});for await(const U of Re){if(U.type===N.RUN_START&&requestAnimationFrame(()=>{q.current?.scrollTo({top:0,behavior:"smooth"})}),U.type===N.ERROR){if(U.line!=null){const{line:ue}=U;requestAnimationFrame(()=>c(ue))}Ce=!0,re(U.id,U)}O(U.runId),C(ue=>[...ue,{...U,isStale:!1}])}Ce&&d?.(!0),h(!1)};l.useImperativeHandle(u,()=>({runCode:w,stopCode:()=>e.current?.stop()}));const k=!a&&p,H=k&&A&&A.id!==b,Y=!H&&k&&X>g;return s.jsxs(ce,{children:[m&&s.jsx("div",{className:"pointer-events-auto absolute inset-0 bg-transparent"},"drag-overlay"),Y&&s.jsx(R.button,{initial:{scale:.95,opacity:0},exit:{scale:.95,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",bounce:.12,duration:.3},className:"bg-token-bg-primary hover:bg-token-bg-secondary absolute end-2 bottom-2 flex items-center gap-2 rounded-full px-3 py-1.5 shadow-lg",onClick:()=>d?.(!0),children:s.jsxs("span",{className:"text-token-text-secondary flex items-center gap-1 text-sm",children:[s.jsx(Ts,{className:"icon-sm"}),s.jsx(L,{id:"etzFTa",defaultMessage:"{numLogs, plural, one {{numLogs} message} other {{numLogs} messages}}",values:{numLogs:X}})]})},"view-console"),H&&s.jsx(Zn,{textdocTitle:n,onClickViewConsole:()=>d?.(!0),onDismiss:()=>T(A.id),onClickFix:v=>{_(v,A.id,A.error)}},"error-modal"),a&&s.jsxs(R.div,{initial:{translateY:"100%",opacity:0},animate:{translateY:"0%",opacity:1},exit:{translateY:"100%",opacity:0},transition:{type:"spring",bounce:0,duration:.48},className:"border-token-border-default relative z-10 w-full border-t shadow-[0px_0px_32px_rgba(0,0,0,0.08)]",children:[s.jsx(Kn,{onDragEnd:()=>x(!1),onDrag:({delta:{y:v}})=>{x(!0),W(M=>M-v)}}),s.jsx("div",{className:"flex flex-col",style:{height:F},children:s.jsx(Yn,{scrollRef:q,messages:y,onClose:()=>d?.(!1),onClickLineNumber:c,onClickFix:_,title:z.formatMessage({id:"P9VJDk",defaultMessage:"Console"}),headerActions:[...i,{tooltip:z.formatMessage({id:"gAICYK",defaultMessage:"Clear console"}),icon:_s,onClick:()=>{E(0),C([]),D(new Map)}}],hints:P})})]},"console")]})},na=l.forwardRef(tr);class sr{dependencies(){return[]}unifiedInitializationHook(t){return t}}class _t extends sr{unistToProseMirrorTest(t){return t.type===this.unistNodeName()}proseMirrorInputRules(t){return[]}proseMirrorKeymap(t){return{}}postUnistToProseMirrorHook(t){}customDirectiveName(){return null}}class ra extends _t{proseMirrorToUnistTest(t){return this.proseMirrorNodeName()===t.type.name}proseMirrorNodeView(){return null}proseMirrorNodeName(){return this.constructor.proseMirrorNodeName()}static proseMirrorNodeName(){throw new Error("Method not implemented.")}}class nr extends _t{proseMirrorMarkName(){return this.constructor.proseMirrorMarkName()}static proseMirrorMarkName(){throw new Error("Method not implemented.")}}class rr extends nr{unistNodeName(){return"startend"}static proseMirrorMarkName(){return"startend"}proseMirrorMarkSpec(){return{attrs:{start:{},end:{}},toDOM(){return["span",0]}}}unistNodeToProseMirrorNodes({schema:t,convertedChildren:n,attrs:r}){return n.map(a=>a.mark(a.marks.concat([t.marks[this.proseMirrorMarkName()].create(r)])))}processConvertedUnistNode(t){return{type:this.unistNodeName(),children:[t]}}}function ke(e){if(e.type.name!=="text"){const{start:a,end:o}=e.attrs;return a==null||o==null?null:{start:a,end:o}}const t=e.marks.find(a=>a.type.name===rr.proseMirrorMarkName());if(!t)return null;const{start:n,end:r}=t.attrs;return n==null||r==null?null:{start:n,end:r}}function ar(e,t){const{parent:n,textOffset:r}=t,a=e.nodeAt(t.pos);if(!a)return le(ke(n)).end;const{start:o}=le(ke(a));return o+r}function or(e,t){const n=e.nodeAt(t.pos);if(n){const{start:r}=le(ke(n));return r+t.textOffset}return le(ke(t.parent)).end}function aa(e,t){const n=new Map;for(const[r,a]of t){const o=ar(e,e.resolve(a.start)),i=or(e,e.resolve(a.end));n.set(r,{start:o,end:i})}return n}const ir=l.createContext(()=>null),lr=l.createContext(null),cr=l.createContext(0),oa=()=>l.useContext(ir),ia=()=>l.useContext(lr),la=()=>l.useContext(cr),dr=l.createContext(()=>null),ur=l.createContext(null),ca=l.createContext(0),da=()=>l.useContext(dr),ua=()=>l.useContext(ur),mr=/\s/,fr=30;function st(e,t){const n=e.indexOf(t);return n===-1?!1:e.indexOf(t,n+t.length)===-1}function se(e,t){return mr.test(e[t])}function nt(e,t,n=!1){if(t===0||n&&se(e,t-1))return t;for(;t>0&&se(e,t-1);)t--;for(;t>0&&!se(e,t-1);)t--;return se(e,t)&&t++,t}function rt(e,t,n=!1){if(t===e.length||n&&se(e,t))return t;for(;t<e.length&&se(e,t);)t++;for(;t<e.length&&!se(e,t);)t++;return se(e,t-1)&&t--,t}function pr(e,t,n=!0,r=fr){if(e.start<0||e.end>t.length||e.start>e.end)throw new Error("Invalid commentSourceRange provided.");const a=t.substring(e.start,e.end);let o=e.start,i=e.end;n&&(o=nt(t,o,!0),i=rt(t,i,!0));let c=t.substring(o,e.start),f=t.substring(e.end,i),d=`${c}${a}${f}`;if(st(t,d)&&(r==null||d.length>=r))return{before:c,after:f,allSurrounding:d};let u=o,m=i,x=!0;for(;x&&(r==null||d.length<r);){let p=!1;const h=u>0?nt(t,u):u;h<u&&(u=h,p=!0);const y=m<t.length?rt(t,m):m;if(y>m&&(m=y,p=!0),p){const C=t.substring(u,e.start),g=t.substring(e.end,m),E=`${C}${a}${g}`;if(st(t,E)&&(r==null||E.length>=r))return{before:C,after:g,allSurrounding:E};c=C,f=g,d=E}else x=!1}return{before:c,after:f,allSurrounding:d}}const pe="# Context",xe="# Instructions";function he(e,t,n){if(t==null||n==null)return`The user is referring to the entire text of "${e}".`;const r=`
## Selected Text
The user has selected this text in "${e}" in particular:
${t}
`.trim();return n.allSurrounding===t?r:`
${r}

## Surrounding Context
Here is the surrounding context:
${n.allSurrounding}
`.trim()}function It(e,t){return e==null||t==null?"entire document":e===t.allSurrounding?"selected text":"surrounding context"}function Rt(e){return`For the update pattern, create a regex which exactly matches the ${e}. Edit just this string in order to fullfill the user's request. NEVER rewrite the entire document. Instead, ALWAYS edit ONLY the ${e}. The only exception to this rule is if the ${e} includes markdown lists or tables. In that case, fully rewrite the document using ".*" as the regex update pattern.`.trim()}function xr(e,t,n,r){if(!pt(t)&&n&&r){const a=It(n,r);return`
${pe}
The user requests that you directly edit the document.

${he(e,n,r)}

${xe}
Use the update_textdoc tool to make this edit. ${Rt(a)}`.trim()}return`
${pe}
The user requests that you directly edit the document.

${he(e,n,r)}

${xe}
Use the update_textdoc tool to make this edit. You MUST fully rewrite the entire document by using ".*" as the update regex pattern.`.trim()}function hr(e,t,n){return`
${pe}
The user requests that you add comments about some text.

${he(e,t,n)}

${xe}
Do not respond to the user's question directly, just leave comments.`.trim()}function gr(e,t){return pt(e)?t==="entire document"?` If you choose to update the ${t}, you MUST fully rewrite the ${t} by using ".*" as the update regex pattern.`:` If you choose to update the ${t}, you MUST fully rewrite the entire document by using ".*" as the update regex pattern. When you do so, ONLY modify the ${t} and rewrite other sections exactly as is, except for parts that must change based on this update`:t==="entire document"?"":` If you choose to update the ${t}, follow these instructions: ${Rt(t)}`}function yr(e,t,n,r){const a=It(n,r),o=gr(t,a);return`
${pe}
${he(e,n,r)}

${xe}
The user would like you perform one of the following actions:
- Update the ${a} via the \`update_textdoc\` tool.${o}
- Explain the selected text via chat, or answer a general question about the selected text (no tool call required).
- Comment on the ${a} with feedback via the \`comment_textdoc\` tool. This should only be used if the user very explicitly asks for feedback, critique, or comments.

Based on the user's request, choose the appropriate action.
`.trim()}function Cr(e,t,n){return`
${pe}
${he(e,t,n)}

${xe}
The user would like you to create a new textdoc.
`.trim()}function vr(e,t,n,r=null,a=null){switch(n){case ae.ASK:return yr(e,t,r,a);case ae.CREATE_TEXTDOC:return Cr(e,r,a);case ae.EDIT:return xr(e,t,r,a);case ae.COMMENT:return hr(e,r,a)}}function Er(e){switch(e){case $.ACCELERATOR:case $.CONSOLE:case $.ACCEPT_COMMENT:case $.HIVE_SPEAKER_EDIT:return!0;case $.ASK_CHATGPT:case $.FULL_SCREEN_SUBMIT:return!1}}function br(e,t){switch(t){case $.ASK_CHATGPT:case $.ACCEPT_COMMENT:case $.FULL_SCREEN_SUBMIT:return e.formatMessage(Sr.askChatGPT);case $.ACCELERATOR:case $.CONSOLE:case $.HIVE_SPEAKER_EDIT:return}}const wr=(e,t)=>{const n=ne(),r=is(e),a=Is(e),o=ls();return l.useCallback(async({content:i,sourceRange:c,action:f,userMessageType:d,acceleratorMetadata:u,selectionMetadata:m,sourceEvent:x})=>{if(t?.versionInt==null||o)return;const{textdocId:p,type:h,versionInt:y,content:C}=t;let g,E=null;c&&c.start!==c.end&&(g=C.slice(c.start,c.end),E=pr(c,C));const b=vr(p,h,f,g,E),j=cs(b,{exclude_after_next_user_message:!0});a({sourceEvent:x,promptMessage:ds(i,{canvas:{textdoc_id:p,textdoc_type:h,version:y,textdoc_content_length:C.length,user_message_type:d,accelerator_metadata:u,selection_metadata:m},is_visually_hidden_from_conversation:Er(d),targeted_reply:g,targeted_reply_label:br(n,d),open_in_canvas_view:{type:"canvas_textdoc",id:p}}),completionMetadata:r?{conversationMode:r}:void 0,appendMessages:[j]})},[t,o,a,r,n])},Sr=Me({askChatGPT:{id:"h5ANdM",defaultMessage:"Asked ChatGPT"}}),ge=ut(e=>({currentTime:0,setCurrentTime:t=>e(()=>({currentTime:t})),isOpen:!1,openSidebar:()=>e({isOpen:!0}),closeSidebar:()=>e({isOpen:!1}),hoveringSpeakerId:null,setHoveringSpeakerId:t=>e({hoveringSpeakerId:t}),editingSpeaker:null,setEditingSpeaker:t=>e({editingSpeaker:t}),speakers:new Map,setSpeakers:t=>e({speakers:t}),enableDebugger:!1,setEnableDebugger:t=>e(()=>({enableDebugger:t})),selectedFilters:["default","revive"],setSelectedFilters:t=>e(()=>({selectedFilters:t}))})),ma=e=>t=>ms.findNode(t,({message:n})=>{const r=n.metadata?.canvas;return r?.create_source===Rs.HIVE&&r.textdoc_id===e&&!!r.hive_id})?.message.metadata?.canvas?.hive_id,Nr=e=>{const t=Math.floor(e/3600),n=Math.floor(e%3600/60),r=e%60,a=t.toString().padStart(2,"0"),o=n.toString().padStart(2,"0"),i=r.toString().padStart(2,"0");return t>0?`${a}:${o}:${i}`:`${o}:${i}`},Lt=e=>{const{setSpeakers:t}=ge.getState(),n=e.compact_transcript,r=Object.values(e.compact_transcript?.speakers??{}),a=new Map(r?.map(c=>[c.id,{name:void 0,storedName:c.updated_name,placeholderName:c.name,isEdited:!1}]));return t(a),(n?.segments??[]).map(c=>({speakerId:c.speaker_id,range:{min:c.start_seconds,max:c.end_seconds},content:c.content,filterDecision:c.filter_decision}))},fa=()=>mt(us(),"1804926979"),jr=(e,t,n=1)=>{Ut(e.scrollTop,t,{duration:n,ease:"easeInOut",onUpdate:r=>{e.scrollTop=r}})},Ot=G.div`flex w-full grow flex-col gap-1 rounded-xl p-2 pe-5 text-sm`,kr=G.input`ms-[-2px] w-auto rounded-none border-none bg-[#E5F3FF] p-0 px-0.5 text-sm font-semibold outline-none focus:outline-none`,Mr=G(R.span)`start border-token-text-tertiary absolute -bottom-0.5 w-full origin-left border-b border-solid`,Tr=G(R.span)`start border-token-text-tertiary absolute -bottom-0.5 w-full border-b border-dashed`,ve=G.div`w-full loading-results-shimmer bg-token-bg-secondary h-2 rounded-full`,_r=()=>s.jsxs(Ot,{className:"gap-2",children:[" ",s.jsx(ve,{className:"w-[48px]"})," ",s.jsx(ve,{})," ",s.jsx(ve,{})," ",s.jsx(ve,{className:"w-1/2"})]}),Ir={initial:{scaleX:0,opacity:1},animate:{scaleX:1,opacity:0,transition:{scaleX:{duration:.85,ease:[.65,0,.35,1]},opacity:{delay:.85,duration:.1}}}},Rr={initial:{opacity:0},animate:{opacity:1,transition:{delay:.85,duration:.1}}};G.div`ms-2 rounded-full px-2 py-0.5 text-xs font-medium`;const At=({speakerId:e,content:t,range:n,filterDecision:r,isEditing:a,isSaving:o,containerRef:i,measuredTextContainerRef:c,isEditingEnabled:f})=>{const d=l.useRef(null),{setSpeakers:u,setEditingSpeaker:m,hoveringSpeakerId:x,setHoveringSpeakerId:p,speakers:h,editingSpeaker:y,enableDebugger:C}=ge.getState(),g=ge(_=>_.currentTime),E=n.max==null?g===n.min:g>=n.min&&g<=n.max;l.useEffect(()=>{if(E&&d.current&&i.current){const _=i.current,re=d.current,w=_.getBoundingClientRect().top,H=re.getBoundingClientRect().top-w+_.scrollTop-20;jr(_,H,.3)}},[n.min,n.max,E,i]);const b=h.get(e),T=!!b?.storedName&&b.storedName!==b?.placeholderName||(b?.isEdited??!1),j=b?.name??b?.storedName??b?.placeholderName??"Unidentified Speaker",O=l.useRef(null),P=e===y?.id,D=e===x,[F,W]=l.useState(!1),[q,z]=l.useState(!1);l.useEffect(()=>{O.current&&(!P||!q||(O.current?.focus(),T&&(O.current.value=j)))},[T,P,q,j]),fs(()=>{if(c?.current&&O.current){const _=c.current.offsetWidth;O.current.style.width=`${_}px`}},[y?.name]);const X=l.useCallback(()=>{if(!y||!b)return;m(null),z(!1),W(!1),p(null);const _=h.set(e,{...b,name:y.name?y.name:b.placeholderName,isEdited:!!y.name});u(_)},[y,b,m,p,h,e,u]),A=!a||o;return s.jsxs(Ot,{ref:d,className:S(E&&"animate-[hive-log-fadeout_0.3s_1.5s_forwards] bg-blue-500/10",!1,!1),children:[!1,s.jsxs("div",{className:"mb-[1px] flex w-full items-center justify-between",children:[f&&(P?s.jsx(kr,{ref:O,disabled:!q,onBlur:X,className:S(!P&&"hidden w-0"),placeholder:b?.isEdited?void 0:b?.placeholderName,value:y?.name,onKeyDown:_=>{_.key==="Enter"&&X()},onChange:_=>m({id:e,name:_.target.value})}):s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsxs("div",{onClick:()=>{A||(m({id:e,name:T?j:""}),z(!0))},onMouseEnter:()=>{A||(p(e),W(!0))},onMouseLeave:()=>{A||(p(null),W(!1))},className:S("relative flex font-semibold transition-colors",{"text-blue-400!":D&&!A},{"cursor-pointer":!A},{"text-token-text-tertiary":!A&&!T}),children:[j,!A&&!T&&s.jsxs(s.Fragment,{children:[s.jsx(Mr,{...Ir}),s.jsx(Tr,{...Rr,className:S(D&&!A&&"border-blue-400!")})]})]}),F&&!A&&s.jsx(xt,{className:"h-4 w-4 text-blue-400"}),!1]})),s.jsx("div",{className:"text-xs text-[#5D5D5D]",children:Nr(n.min)})]}),s.jsx("div",{className:"flex",children:t})]})},Lr=e=>Ue({queryKey:["sharedHiveLog",e],queryFn:()=>ye.safeGet("/hive/textdoc/shared/{shared_textdoc_id}/transcript",{parameters:{path:{shared_textdoc_id:e}}}),select:Lt}),Or=e=>Ue({queryKey:["hiveLog",e],queryFn:()=>ye.safeGet("/hive/{hive_id}/transcript",{parameters:{path:{hive_id:e}}}),enabled:!!e,select:Lt}),Ar=()=>Ue({queryKey:["hiveLogPrompts"],queryFn:()=>ye.safeGet("/hive/prompts"),enabled:!0}),Dr=(e,t)=>ye.safePost("/hive/{hive_id}/speakers",{parameters:{path:{hive_id:e}},requestBody:{speakers:t}}),Br=G.div`invisible absolute start-0 top-0 rounded-md border px-0.5 text-sm font-semibold whitespace-pre`,Pr=(e,t)=>!t||!e?"":t.isEdited||e.name&&e.name!==t.placeholderName?e.name:t.placeholderName,Dt=()=>s.jsx(hs,{children:s.jsx(L,{...oe.researchPreview})}),Hr=G.div`flex h-full w-full max-w-[360px] min-w-[240px] flex-col border-l border-gray-200`,$r=G.div`flex w-full max-w-[360px] min-w-[240px] flex-col border-l border-gray-200`,Ur=G.div`bg-token-bg-primary mt-[0.5px] flex h-18 w-full items-center justify-between border-b-[0.5px] border-gray-200 p-4`,Bt=G.div`flex h-full w-full flex-col gap-2 overflow-y-auto p-2`,at=G(R.div)`flex items-center gap-2`,ot={initial:{opacity:0,y:-4},animate:{opacity:1,y:0,transition:{duration:.2}},exit:{opacity:0,y:-4,transition:{duration:.2}}},pa="ts",xa=({sharedTextDocId:e})=>{const t=Lr(e),n=l.useRef(null),r=ps(),{selectedFilters:a,isOpen:o,currentTime:i,closeSidebar:c}=ge(),f=l.useMemo(()=>t.data?.filter(({filterDecision:m})=>!m||a?.includes(m)),[t.data,a]);if(t.isError)return null;const d=s.jsxs("div",{className:"text-token-text-secondary flex items-center gap-1.5 px-2 py-2 text-base font-medium md:px-0",children:[s.jsx(L,{...oe.transcript}),s.jsx(Dt,{})]}),u=s.jsxs(s.Fragment,{children:[t.isLoading&&Array.from({length:16}).map((m,x)=>s.jsx(_r,{},`loading-${x}`)),f?.map(m=>s.jsx(At,{isEditingEnabled:!1,containerRef:n,...m},Pt(m)))]});return!o||!i?null:r?s.jsxs($r,{children:[s.jsxs(Ur,{children:[d,s.jsx(xs,{onClick:c})]}),s.jsx(Bt,{ref:n,children:u})]}):s.jsx(it,{contentRef:n,testId:"modal-shared-canvas-transcript-modal",isOpen:o,title:d,contentClassName:"overflow-y-auto gap-2 p-2 flex flex-col",showCloseButton:!0,onClose:c,children:u})},ha=({hiveId:e,clientThreadId:t,ts:n,textdocVersion:r})=>{const a=Or(e),o=Ar(),i=ne(),[c,f]=l.useState(!1),d=l.useRef(null),u=lt(),m=mt(u,"2986567482"),{isOpen:x,closeSidebar:p,openSidebar:h,setCurrentTime:y,speakers:C,setSpeakers:g,editingSpeaker:E,enableDebugger:b,setEnableDebugger:T,selectedFilters:j,setSelectedFilters:O}=ge();l.useEffect(()=>{n!==void 0&&(h(),y(n))},[n,h,y]);const P=l.useRef(null),[D,F]=l.useState(!1),W=wr(t,r);if(a.isLoading||o.isLoading||a.isError||o.isError||!a.data||!o.data)return null;const q=E?C.get(E.id):null,z=Array.from(C.values()).some(({isEdited:w})=>w),X=()=>{const w=new Map(Array.from(C.entries()).map(([k,H])=>[k,{...H,name:void 0,isEdited:!1}]));g(w),f(!1)},A=w=>{if(!o.data.speaker_edits)return;const k=o.data.speaker_edits.replace("{speakers}",JSON.stringify(Array.from(C.entries())));return W({sourceEvent:w,action:ae.EDIT,content:k,userMessageType:$.HIVE_SPEAKER_EDIT,selectionMetadata:void 0})},_=async w=>{if(z){F(!0);try{const k=[];Array.from(C.entries()).forEach(([v,M])=>{!M.isEdited||!M.name||k.push({id:v,updated_name:M.name})});const H=await Dr(e,k);if(!H)throw new Error("Failed to update hive content");const Y=new Map(C);for(const v of H.updated_speakers){if(!Y.has(v.id))continue;const M=Y.get(v.id);M&&Y.set(v.id,{...M,storedName:v.updated_name,isEdited:!1})}await A(w),g(Y),f(!1)}catch{}finally{F(!1)}}},re=a.data.filter(({filterDecision:w})=>!w||j?.includes(w));return s.jsxs(Hr,{className:S(x?"visible":"invisible hidden"),children:[s.jsxs("div",{className:"flex h-14 w-full items-center justify-between border-b border-gray-200 p-4",children:[s.jsxs("div",{className:"text-token-text-secondary group/debug flex items-center gap-1.5 py-2 text-base font-medium",children:[s.jsx(L,{...oe[c?"edit":"transcript"]}),s.jsx(Dt,{}),!1]}),s.jsx("div",{className:"flex h-10 items-center gap-2",children:s.jsx(ce,{mode:"wait",children:c?s.jsxs(at,{...ot,children:[s.jsx(Q,{onClick:X,color:"secondary",disabled:D,children:s.jsx(L,{...oe.cancelButton})}),s.jsx(Q,{color:"primary",onClick:_,disabled:!z,loading:D,children:s.jsx(L,{...oe.saveButton})})]},"edit-buttons"):s.jsxs(at,{...ot,children:[m&&s.jsx(Te,{className:"h-10",label:i.formatMessage(oe.editButtonTooltip),children:s.jsx(Qe,{icon:xt,onClick:()=>f(!0)})}),s.jsx(Qe,{icon:We,onClick:()=>p()})]},"non-edit-buttons")})})]}),!1,s.jsxs(Bt,{ref:d,children:[m&&E&&s.jsx(Br,{ref:P,children:Pr(E,q)}),re.map(w=>s.jsx(At,{isEditingEnabled:m,measuredTextContainerRef:P,containerRef:d,isEditing:c,isSaving:D,...w},Pt(w)))]})]})},Pt=e=>{const{speakerId:t,content:n,range:r}=e;return`${t}-${r.min}-${r.max}-${n.slice(0,2)}`},oe=Me({researchPreview:{id:"HiveLogSidebar.researchPreview",defaultMessage:"Research Preview"},edit:{id:"HiveLogSidebar.edit",defaultMessage:"Edit"},transcript:{id:"HiveLogSidebar.transcript",defaultMessage:"Transcript"},editButtonTooltip:{id:"HiveLogSidebar.editButtonTooltip",defaultMessage:"Edit speakers"},cancelButton:{id:"HiveLogSidebar.cancelButton",defaultMessage:"Cancel"},saveButton:{id:"HiveLogSidebar.saveButton",defaultMessage:"Save"}});export{Ye as A,Nt as B,Qr as C,rr as D,sa as E,sr as F,fa as G,Nr as H,aa as I,dr as J,ur as K,ca as L,nr as M,ra as N,ar as O,or as P,wr as Q,pa as R,xa as S,ha as T,Be as U,ma as V,ia as a,la as b,vn as c,ge as d,na as e,cn as f,ke as g,je as h,yn as i,Cn as j,gn as k,da as l,ua as m,ea as n,Jr as o,yt as p,wn as q,Sn as r,bn as s,ir as t,oa as u,lr as v,cr as w,ta as x,ae as y,Dn as z};
//# sourceMappingURL=pe95y8sy3hzkar72.js.map
