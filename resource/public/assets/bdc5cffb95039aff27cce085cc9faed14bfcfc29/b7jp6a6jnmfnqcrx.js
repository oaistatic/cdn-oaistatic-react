import{r as S,j as n}from"./cs7toih8jegb7teq.js";import{C as G}from"./zjr0ak67r0xufzni.js";import{D as q,a as J}from"./c070u4alslgy7i5z.js";import{T as K,a as Q,A as M,u as X,i as Y,C as Z,g as z}from"./nt3v8cmtxrtlj5zl.js";import{C as tt,c as et}from"./zpmtm193hf9al87a.js";import{C as V}from"./de5hn4293vtnpm6c.js";import{u as ot,a as rt,b as nt,c as k}from"./pe95y8sy3hzkar72.js";import{C as it}from"./jy1u8exw8iz2slve.js";import{b as st,c$ as lt,jk as U,jl as at}from"./hnw079jsdm76umup.js";import{dd as ct}from"./dmck639k4dv7claj.js";import{u as mt}from"./kwms1ugj73bjxgnk.js";import"./dtz2gnda2vx03dil.js";import"./lflgzlgfd348gvw6.js";import"./j47f0ykepflvhgdz.js";import"./dfzcxyl9lkh9bhhc.js";import"./op8kqjb1v00a035k.js";import"./icwejktgx2db5g2x.js";import"./epuqxu07prihsdka.js";import"./nlxagrvvx9r77jf7.js";import"./gqxnaj28dwt74usv.js";import"./dfhgw8mxn1h3ecpw.js";import"./nxes2g8vblrs3vjj.js";import"./gy64pge8qevmvg7e.js";import"./bk8slwxjkdlmxjxm.js";import"./na0t6wj09rfp0awn.js";import"./liqaqj2w179grtbv.js";import"./d0qctmhgeexj40hp.js";import"./mahhuo4zclh446vl.js";import"./l1m3l5lbmhuctzw6.js";import"./ljj1p3s92okaif60.js";import"./fq8kbeg5idktxg5a.js";import"./bt87x1jkl52wwxat.js";import"./ns51nblw8ziscsgd.js";import"./g61ghrdmm0y010eo.js";import"./cm813h9bptrniota.js";import"./kl7c6054usfnqmd4.js";import"./mia7qmdupqoji40k.js";import"./dfaaf8463nahnfzk.js";import"./n8303igkzlzv9639.js";function dt(t,e){const r=t.doc.lineAt(e.from);return e.from===r.from&&e.to-1===r.to}function ut(t){const e=t.dom.querySelector(".cm-gutters");return e?e.offsetWidth:0}const pt=({onAddComment:t,isSendDisabled:e=!1,isWaitingForCommentResponse:r=!1})=>{const o=ot(),p=rt(),c=nt(),L=S.useCallback(i=>{const{height:m,width:d}=i,s=o();if(!p||!s)return null;const l=p.selection.asSingle();if(l.ranges.length===0)return null;const a=l.ranges[0],{empty:H,to:O}=a;let{head:f}=a;const{platform:R}=st();f=R==="web"?f:O;const g=f===O;let v=f;if(g&&dt(p,a)&&(v-=1),H)return null;const{left:C,top:x,bottom:N}=s.contentDOM.getBoundingClientRect(),{left:w,top:_,bottom:E}=ct(s.coordsAtPos(v,g?-1:1)),h=ut(s);function j(){if(g)return Math.max(w-C+h-d,h);let u=w-C+h;return u+d>c&&(u=-(d-c)),u}function A(u){const b=m*2,y=u.contentHeight-(E-N)>b&&window.innerHeight-E>b,B=E-x+8,I=_-x-m-8;return g&&y||I<0?{top:B,aboveOrBelow:M.BELOW}:{top:I,aboveOrBelow:M.ABOVE}}const W=A(s);return{left:j(),top:W.top,aboveOrBelow:W.aboveOrBelow,toolbarSize:i}},[p,o,c]),D=S.useCallback(()=>o()?.dom??null,[o]);return n.jsx(K,{onAddComment:t,isWaitingForCommentResponse:r,isSendDisabled:e,toolbarType:Q.CODE,getToolbarPosition:L,getEditorDom:D,getSelectionRange:()=>{const i=o();if(!i)return null;const{state:m}=i,d=m.selection.asSingle();if(d.ranges.length===0)return null;const s=d.ranges[0],{from:l,to:a}=s;return l==null||a==null?null:{from:l,to:a,sourceFrom:l,sourceTo:a}}})};function ft({diff:t}){return X(t?.edits??[]),null}function gt(t,e,r){const o=r?z():0;return t<=1e3-o?t-(e?tt:0):t-(e?et:0)}const ee=({comments:t,currentlyStreamingLineIndex:e,isPreview:r=!1,isWaitingForCommentResponse:o=!1,isSendDisabled:p=!1,readonlyReason:c,isRequestActive:L=!1,language:D,value:i,textdocDiff:m,maxLength:d,onAcceleratorsExpandedChange:s,onAddComment:l,onAcceptComment:a,onDismissComment:H,onBlur:O,onSave:f,onChange:R,onCancelRequest:g,getStableCommentId:v=at,commentsMode:C=V.ENABLED,hideToolbar:x,hideAccelerators:N=!1,onSubmitAccelerator:w,modelCursor:_,codemirrorRef:E})=>{const h=S.useRef(null),j=lt(),[{width:A},W]=mt(),u=S.useRef(null),b=t.length>0,y=u.current,B=gt(A,b,Y(y)??!1),I=k(({commentingOn:T})=>T),F=k(({hoveredCommentId:T})=>T),P=k(({focusedCommentId:T})=>T);S.useEffect(()=>{h.current?.UNSAFE_setValue(i||"")},[i]);const $=A-B;return n.jsx("div",{className:it.code,ref:U(W,u),style:j&&r?{margin:"0 16px"}:{},children:n.jsxs(G,{id:"codemirror",comments:C===V.ALL_HIDDEN?void 0:t,commentingOn:I,currentlyStreamingLineIndex:e,hoveredCommentId:F,focusedCommentId:P,language:D,readonlyReason:c,onChange:R,maxLength:d,value:i,textdocDiff:m,editorRef:U(h,E),width:B,modelCursor:_,isPreview:r,hideLineNumbers:j&&r,onBlur:O,onSave:f,children:[n.jsxs(G.EditorChildren,{children:[!x&&n.jsx(pt,{onAddComment:l,isSendDisabled:p,isWaitingForCommentResponse:o}),C!==V.ALL_HIDDEN&&n.jsx("div",{className:b?"me-4":"",children:n.jsx(Z,{getStableCommentId:v,availableWidth:$,comments:t,commentsMode:C,onAddComment:l,onAcceptComment:a,onDismissComment:H,isWaitingForCommentResponse:o,isRequestActive:L,disableBlockComments:!0})})]}),n.jsxs(G.ContextChildren,{children:[m&&n.jsx(ft,{diff:m}),!N&&n.jsx(q,{isRequestActive:L,isVisuallyHidden:p||!!c?.isStreamingFromNative||c?.isReadonly&&!c.isStreaming,onSubmit:w,onCancel:g,actions:J,onExpandedChange:s})]})]})})};export{ee as CodeComposer};
//# sourceMappingURL=b7jp6a6jnmfnqcrx.js.map
