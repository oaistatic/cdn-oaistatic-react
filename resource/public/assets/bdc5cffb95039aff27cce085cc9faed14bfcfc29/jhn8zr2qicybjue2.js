import{bV as Y,R as T,c as ke,z as O,gA as je,B as te,lU as Pe}from"./dmck639k4dv7claj.js";import{u as re,f as Z,i as G,s as ce,e as ue,r,j as a,d as Ne,M as j,N as Se}from"./cs7toih8jegb7teq.js";import{hr as De}from"./hnw079jsdm76umup.js";import{a as _e,c as Te,u as Be,d as Re}from"./hwrbhfwvlxz8ucwy.js";import{W as se}from"./bzq41qkdlic4f3pg.js";import"./oasstlv4rvegny2a.js";import"./m9o58vphd3ndk69b.js";import"./kizn5m1hr7kdjf9n.js";import"./nfubiloo9rdxk3kj.js";import"./hsurwbv79wrpc9dg.js";import"./lxgn8k46ba24438b.js";import"./k4ghje9xipg90eb2.js";import"./lox5zdwgg3gy3k4z.js";import"./itn5frgf3bcgdkwm.js";import"./l1m3l5lbmhuctzw6.js";import"./mahhuo4zclh446vl.js";import"./dfhgw8mxn1h3ecpw.js";import"./kbe4rf7g0jwp6hai.js";import"./jd17yzpadn74fmtb.js";import"./liqaqj2w179grtbv.js";import"./b5m6pkropmlgxhpi.js";function We(n){return re({queryKey:["workspace-ip-allowlist",n],queryFn:n?()=>T.safeGet("/accounts/{account_id}/ip-allowlist",{parameters:{path:{account_id:n}}}):ce})}function Ee(n){return re({queryKey:["workspace-compliance-ip-allowlist",n],queryFn:n?()=>T.safeGet("/accounts/{account_id}/compliance-ip-allowlist",{parameters:{path:{account_id:n}}}):ce})}function Fe(n){const i=Z(),s=Y();return G({mutationFn:t=>T.safePost("/accounts/{account_id}/compliance-ip-allowlist",{parameters:{path:{account_id:n}},requestBody:t}),onSuccess:()=>{i.invalidateQueries({queryKey:["workspace-compliance-ip-allowlist",n]})},onError:t=>{s.danger(t.message,{toastId:"compliance_ip_allowlist_create",loggingTitle:t.message,loggingDescription:"Failed to update Compliance API IP Allowlist"})}})}function Ve(n){const i=Z(),s=Y();return G({mutationFn:t=>T.safePost("/accounts/{account_id}/ip-allowlist",{parameters:{path:{account_id:n}},requestBody:t}),onSuccess:()=>{i.invalidateQueries({queryKey:["workspace-ip-allowlist",n]})},onError:t=>{s.danger(t.message,{toastId:"ip_allowlist_create",loggingTitle:t.message,loggingDescription:"Failed to update IP allowlist"})}})}function qe(n){const i=Z(),s=Y();return G({mutationFn:t=>T.safePatch("/accounts/{account_id}/ip-allowlist",{parameters:{path:{account_id:n}},requestBody:t}),onSuccess:()=>{i.invalidateQueries({queryKey:["workspace-ip-allowlist",n]})},onError:t=>{s.danger(t.message,{toastId:"ip_allowlist_toggle",loggingTitle:t.message,loggingDescription:"Failed to toggle IP allowlist"})}})}const ne={md:{font:14,h:18,gap:6},lg:{font:14,h:20,gap:6},xl:{font:14,h:24,gap:6},"2xl":{font:16,h:24,gap:8},"3xl":{font:16,h:32,gap:8}};function ae({value:n,defaultValue:i=[],onChange:s,validator:t,placeholder:l="",disabled:c=!1,size:g="xl",rows:v=1,maxTags:h,delimiters:u=[","," "],autoFocus:x=!1,showCount:C}){const b=ue(),A=n!==void 0,[q,L]=r.useState(i),d=n??q,P=r.useRef(null),I=r.useRef(null),m=r.useRef(null),[B,R]=r.useState(x),[y,N]=r.useState(""),[S,M]=r.useState(null),[de,J]=r.useState(new Set),[pe,fe]=r.useState(16),W=!h||d.length<h,E=d.length===0,ge=r.useMemo(()=>{const e=ne[g];return v*e.h+(v+1)*e.gap},[v,g]),K=r.useMemo(()=>new Set(d.map(e=>e.value)),[d]),D=r.useCallback(e=>{s?.(e),A||L(e)},[s,A]),Q=r.useCallback(e=>t?t(e):!0,[t]),H=r.useCallback(e=>{J(o=>new Set(o).add(e)),window.setTimeout(()=>{J(o=>{const p=new Set(o);return p.delete(e),p})},500)},[]),z=r.useCallback(e=>{const o=e.trim();if(!o)return;if(K.has(o)){H(o);return}const p=[...d,{value:o,valid:Q(o)}];D(p)},[d,K,Q,D,H]),X=r.useCallback(e=>{const o=[...d];o.splice(e,1),D(o),M(null)},[d,D]),ee=()=>{const e=P.current;return!e||e.selectionStart===0&&e.selectionEnd===0},me=e=>{if(W)if(e.key==="ArrowLeft"||e.key==="ArrowUp")ee()&&(e.preventDefault(),M(o=>o==null?d.length-1:Math.max(0,o-1)));else if(e.key==="ArrowRight"||e.key==="ArrowDown"){if(S!=null){e.preventDefault();const o=S+1;M(o>=d.length?null:o)}}else e.key==="Backspace"&&(S!=null?(e.preventDefault(),X(S)):ee()&&d.length&&(e.preventDefault(),M(d.length-1)))},he=e=>{e.key==="Enter"||u.includes(e.key)?(e.preventDefault(),y&&(z(y),N(""))):e.key==="Tab"&&y&&(e.preventDefault(),z(y),N(""))},xe=e=>{let p=[e.clipboardData.getData("text")];for(const w of u){const _=[];for(const $ of p)_.push(...$.split(w));p=_}if(p=p.flatMap(w=>w.split(/\r?\n/)).map(w=>w.trim()).filter(Boolean),p.length>1){e.preventDefault();const w=[...d],_=new Set(K);for(const $ of p){const k=$.trim();if(k){if(_.has(k)){H(k);continue}if(h&&w.length>=h)break;w.push({value:k,valid:Q(k)}),_.add(k)}}w.length!==d.length&&D(w),N("")}},we=()=>R(!0),ve=e=>{I.current&&e.relatedTarget instanceof Node&&I.current.contains(e.relatedTarget)||(R(!1),M(null),y.trim()&&(z(y),N("")))},ye=e=>{if(c)return;const o=e.target instanceof Element?e.target.closest("[data-tag]"):null;if(o){const p=Number(o.getAttribute("data-index"));M(isNaN(p)?null:p);return}e.preventDefault(),P.current?.focus(),M(null)};ke(()=>{if(!W)return;const e=m.current,o=I.current;if(!e||!o)return;e.textContent=y||(E?l:"")||"";const p=e.getBoundingClientRect().width,w=o.getBoundingClientRect().width-32;fe(Math.max(16,Math.min(p+4,w)))},[y,l,W,E]);const U=ne[g],be={"--input-font-size":`${U.font}px`,"--input-height":`${U.h}px`,"--input-tag-spacing":`${U.gap}px`,minHeight:`${ge}px`},Ie="flex items-center rounded px-[6px] py-[4px] text-[var(--input-font-size)] leading-none transition-colors select-none",Me="bg-green-50 text-green-800 hover:bg-green-100",Ce="bg-red-50 text-red-800 hover:bg-red-100",Ae="font-bold";return a.jsxs(a.Fragment,{children:[a.jsx("div",{ref:I,className:O("relative mb-[8px] cursor-text overflow-x-hidden overflow-y-auto rounded-xl border-2 px-4 py-2",c?"cursor-not-allowed border-neutral-200 bg-neutral-50 opacity-60":"border-neutral-300 hover:border-neutral-400"),style:be,"data-size":g,"data-focused":B?"":void 0,"data-empty":E?"":void 0,"data-disabled":c?"":void 0,onKeyDown:me,onMouseDown:ye,onFocus:we,onBlur:ve,tabIndex:-1,children:a.jsxs("div",{className:"flex flex-wrap items-start gap-x-[var(--input-tag-spacing)] gap-y-[var(--input-tag-spacing)]",children:[d.map((e,o)=>{const p=S===o,w=de.has(e.value);return a.jsxs("div",{"data-tag":e.value,"data-index":o,className:O(Ie,e.valid?Me:Ce,p&&Ae,w&&"animate-pulse"),children:[a.jsx("span",{title:e.value,children:e.value}),!c&&a.jsx("button",{type:"button","aria-label":b.formatMessage({id:"4LMrjM",defaultMessage:"Remove"}),onClick:()=>X(o),className:"ms-[2px] inline-flex h-3.5 w-3.5 items-center justify-center rounded text-xs text-neutral-500 hover:text-neutral-900",children:b.formatMessage({id:"3pDUsa",defaultMessage:"x"})})]},e.value)}),W&&a.jsxs("div",{className:"inline-flex items-center",children:[a.jsx("span",{ref:m,className:"invisible absolute -z-10 whitespace-pre text-[var(--input-font-size)]"}),a.jsx("input",{ref:P,type:"text",value:y,placeholder:E?l:void 0,disabled:c,onChange:e=>N(e.currentTarget.value),onKeyDown:he,onPaste:xe,className:O("m-0 border-none bg-transparent p-0","leading-[1.4] text-[var(--input-font-size)] caret-current","outline-none focus:outline-none focus-visible:outline-none","ring-0 focus:ring-0 focus-visible:ring-0","placeholder:text-neutral-400"),style:{width:pe},autoFocus:x})]})]})}),(h||C)&&a.jsxs("div",{className:"mt-1 w-full text-end font-mono text-[12px] tracking-widest text-neutral-500",children:[d.length,h?`/${h}`:null]})]})}const ie=n=>n.split(".").reduce((i,s)=>(i<<8)+parseInt(s,10),0),F=n=>{const[i,s]=n.split("::"),t=i?i.split(":"):[],l=s?s.split(":"):[],c=new Array(8-(t.length+l.length)).fill("0");return[...t,...c,...l].reduce((v,h)=>v*BigInt(65536)+BigInt(parseInt(h||"0",16)),BigInt(0))},Le=(n,i)=>{const[s,t]=i.split("/"),l=parseInt(t,10);return ie(n)>>32-l===ie(s)>>32-l},Ke=(n,i)=>{const[s,t]=i.split("/"),l=parseInt(t,10);return F(n)>>BigInt(128-l)===F(s)>>BigInt(128-l)},le=(n,i)=>{const s=n.trim();return s?i.some(t=>{const l=t.trim();if(l.includes("/"))return l.includes(":")?Ke(s,l):Le(s,l);if(l.includes(":"))try{return F(s)===F(l)}catch{return!1}return s===l}):!1},V=n=>{const i=n.trim();if(!i)return!1;const s=i.split("/");if(s.length>2)return!1;const[t,l]=s;if(l==="")return!1;let c;return l!==void 0&&(c=parseInt(l,10),isNaN(c))?!1:t.includes(":")?!(!Qe(t)||c!==void 0&&(c<0||c>128)):!(!/^(\d{1,3}\.){3}\d{1,3}$/.test(t)||c!==void 0&&(c<0||c>32))},Qe=n=>{const i=n.split("::");if(i.length>2)return!1;const s=i[0]?i[0].split(":"):[],t=i.length===2&&i[1]?i[1].split(":"):[],l=/^[0-9a-fA-F]{1,4}$/;return s.some(c=>!l.test(c))||t.some(c=>!l.test(c))?!1:i.length===1?s.length===8:s.length+t.length<8},f=Ne({title:{id:"BQ70ZO",defaultMessage:"IP allowlists"},apiSectionTitle:{id:"UoxlHB",defaultMessage:"Workspace IP Allowlist"},complianceSectionTitle:{id:"n0UHsk",defaultMessage:"Compliance API IP Allowlist"},apiHelperText:{id:"hb/u6V",defaultMessage:"When enabled, only requests from the IP addresses or ranges you specify are allowed. You can toggle the allowlist on or off for the entire workspace. Changes may take up to 15 minutes to take effect."},complianceHelperText:{id:"Kog1O7",defaultMessage:"Always enforced for Compliance API keys: usage is restricted to the specified IP addresses or ranges. There is no global on/off toggle—add or remove IPs to change access. This does not impact other API keys or workspace permissions. Changes may take up to 15 minutes to take effect."},editIpsLabel:{id:"eoBlQ3",defaultMessage:"Allowed IPs / CIDR ranges"},emptyMessage:{id:"ynbWU8",defaultMessage:"Add IP address or CIDR range…"},saveButton:{id:"8c8mEa",defaultMessage:"Save"},invalidNotice:{id:"vwaoU9",defaultMessage:"One or more IP / CIDR entries are invalid."},emptyWarning:{id:"tus3/6",defaultMessage:"You are enabling an IP allowlist with no entries. This will block all traffic. Continue?"},currentIpNotInAllowlistWarning:{id:"NxwZWj",defaultMessage:"Your current IP address ({ip}) is not in this allowlist or in any of the allowed CIDR ranges. You may lose access after changes take effect. Continue?"},toggleLabel:{id:"eIKgW3",defaultMessage:"Enable IP allowlist"}});function oe(n){const i=r.useMemo(()=>new Set(n?.allowed_ips??[]),[n]),[s,t]=r.useState(n?.allowed_ips??[]);r.useEffect(()=>{n&&t(n.allowed_ips)},[n]);const l=r.useMemo(()=>s.filter(u=>!V(u)),[s]),c=l.length===0,g=r.useMemo(()=>{if(!n)return s.length>0;if((n.allowed_ips?.length??0)!==s.length)return!0;for(const u of s)if(!i.has(u))return!0;return!1},[n,s,i]),v=r.useMemo(()=>s.map(u=>({value:u,valid:V(u)})),[s]),h=r.useCallback(u=>{t(u.map(x=>x.value))},[]);return{ips:s,setIps:t,tagValues:v,invalidEntries:l,isValid:c,isDirty:g,handleTagChange:h}}function He({currentWorkspaceId:n,readonly:i=!1,clientIp:s=""}){const t=ue(),l=We(n),c=Ee(n),g=r.useMemo(()=>{const m=l.data;if(m)return{allowed_ips:Array.isArray(m.allowed_ips)?m.allowed_ips:[],enabled:!!m.enabled}},[l.data]),v=!!g?.enabled,h=r.useMemo(()=>{const m=c.data;if(m)return{allowed_ips:Array.isArray(m.allowed_ips)?m.allowed_ips:[]}},[c.data]),u=oe(g),x=oe(h),C=Ve(n),b=Fe(n),A=qe(n),q=r.useCallback(()=>{u.isValid&&(v&&s&&!le(s,u.ips)&&!window.confirm(t.formatMessage(f.currentIpNotInAllowlistWarning,{ip:s}))||C.mutate({allowed_ips:u.ips}))},[u.isValid,u.ips,C,s,t,v]),L=r.useCallback(()=>{x.isValid&&b.mutate({allowed_ips:x.ips})},[x.isValid,x.ips,b]),d=r.useCallback(m=>{if(m){const B=g?.allowed_ips??[];if(B.length===0){if(!window.confirm(t.formatMessage(f.emptyWarning)))return}else if(s&&!le(s,B)&&!window.confirm(t.formatMessage(f.currentIpNotInAllowlistWarning,{ip:s})))return}A.mutate({enabled:m})},[A,g?.allowed_ips,t,s]),P=l.isLoading||c.isLoading,I=l.isFetching||c.isFetching;return a.jsxs(a.Fragment,{children:[a.jsx(De,{children:a.jsx("title",{children:t.formatMessage(f.title)})}),a.jsx(_e,{title:t.formatMessage(f.title)}),a.jsx(Te,{showSpinner:P,children:a.jsxs("div",{className:"space-y-10 pt-6",children:[g&&a.jsx(se,{title:f.apiSectionTitle,children:a.jsxs("div",{className:"max-w-4xl space-y-6 pb-6",children:[a.jsx("p",{className:"text-sm text-neutral-500",children:t.formatMessage(f.apiHelperText)}),a.jsx("label",{className:"block text-sm font-medium text-neutral-700",children:a.jsx(j,{...f.editIpsLabel})}),a.jsx(ae,{value:u.tagValues,onChange:u.handleTagChange,validator:V,placeholder:t.formatMessage(f.emptyMessage),disabled:i||C.isPending,size:"xl",rows:3}),a.jsxs("div",{className:"mt-2 flex w-full items-center",children:[u.invalidEntries.length>0&&a.jsx("div",{className:"text-sm text-red-600",role:"alert",children:t.formatMessage(f.invalidNotice)}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(je,{checked:!!g.enabled,disabled:i||A.isPending,onCheckedChange:d,"aria-label":t.formatMessage(f.toggleLabel)}),a.jsx("span",{className:"text-sm text-neutral-600",children:g.enabled?a.jsx(j,{id:"0eFOl8",defaultMessage:"Allowlist is active."}):a.jsx(j,{id:"4N2jsY",defaultMessage:"Allowlist is inactive."})})]}),a.jsx(te,{className:"ms-auto",onClick:q,disabled:i||!u.isDirty||!u.isValid||C.isPending||I,children:a.jsx(j,{...f.saveButton})})]})]})}),h&&a.jsx(se,{title:f.complianceSectionTitle,children:a.jsxs("div",{className:"max-w-4xl space-y-6 pb-6",children:[a.jsx("p",{className:"text-sm text-neutral-500",children:t.formatMessage(f.complianceHelperText)}),a.jsx("label",{className:"block text-sm font-medium text-neutral-700",children:a.jsx(j,{...f.editIpsLabel})}),a.jsx(ae,{value:x.tagValues,onChange:x.handleTagChange,validator:V,placeholder:t.formatMessage(f.emptyMessage),disabled:i||b.isPending,size:"xl",rows:3}),a.jsxs("div",{className:"mt-2 flex w-full items-center",children:[x.invalidEntries.length>0&&a.jsx("div",{className:"text-sm text-red-600",role:"alert",children:t.formatMessage(f.invalidNotice)}),a.jsx(te,{className:"ms-auto",onClick:L,disabled:i||!x.isDirty||!x.isValid||b.isPending||I,children:a.jsx(j,{...f.saveButton})})]})]})})]})})]})}const ze=r.memo(He),ft=Pe(function(){const i=Be(),{clientIp:s}=Se();return Re(),a.jsx(ze,{...i,clientIp:s})});export{ft as default};
//# sourceMappingURL=jhn8zr2qicybjue2.js.map
