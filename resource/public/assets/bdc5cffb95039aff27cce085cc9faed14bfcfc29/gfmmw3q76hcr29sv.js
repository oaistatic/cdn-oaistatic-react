import{j as e,e as Q,M as E,r as g}from"./cs7toih8jegb7teq.js";import{e as N,p as j,q as Z,gf as J,z as x,c2 as V,B as X,aI as S,iU as Y,gG as U,dq as ee,e8 as te,hi as se,P as M,R as ae,T as ne,g as re,aF as ie}from"./dmck639k4dv7claj.js";import{i1 as z,dZ as B,k1 as F,cH as le,k2 as oe,da as ce}from"./hnw079jsdm76umup.js";import{S as de}from"./lablqthzph6rqii3.js";import{M as P}from"./dfhgw8mxn1h3ecpw.js";function A({message:n,simulatedDuration:i=8*60*1e3,maxFill:t=100,isCircular:s=!1}){n?.metadata?.model_slug!=="o1-pro"&&(i=20*60*1e3);const o=n?.create_time?new Date(n.create_time*1e3):Date.now(),r=z(+o,i),l=N(),a=j(l,"3208967109");return s?e.jsx(B,{percentage:r,className:"me-4 w-full!",transitionDuration:`${(100-r)/100*5}s`,transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)"}):e.jsx(F,{percentage:Math.min(r,t),className:"me-4 w-full!",backgroundClassName:"bg-token-sidebar-surface-secondary rounded-full",barClassName:"bg-token-text-secondary rounded-full",transitionDuration:`${(100-r)/100*.2}s`,transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)",height:a?4:8})}function me({title:n,content:i,buttons:t,time:s,icon:o,size:r="default",progressBar:l,disabled:a=!1,onClick:c}){const u=r==="small"?`w-full flex max-w-[calc(0.8*var(--thread-content-max-width,40rem))] ps-[20px] pt-[13px] pb-[10px] ${a?"":"gap-4"}`:"w-full gap-4 px-[22px] pb-[22px] pt-[18px]",b=c?"cursor-pointer":"",f=r==="small"?"text-[15px]":"",p=Z(J);return e.jsxs("div",{className:x("relative inline-flex flex-col items-start justify-start rounded-2xl border","bg-token-bg-primary border-token-border-default box-content rounded-2xl border bg-clip-padding px-5 py-4",!p&&"mx-[calc(--spacing(-2)-1px)] -my-[1px] @max-3xl:-top-2 @3xl:-start-3 @3xl:-top-4",u,b,f),onClick:c,children:[e.jsxs("div",{className:x("flex flex-col items-start justify-start self-stretch",r!=="small"&&"gap-1.5"),children:[e.jsxs("div",{className:x("inline-flex items-start justify-start self-stretch",r!=="small"&&"gap-2"),children:[e.jsx("div",{className:x("shrink grow basis-0 leading-normal font-medium","text-token-text-secondary hover:text-token-text-primary"),children:n}),e.jsx("div",{className:"relative h-6 w-6"}),!a&&(o||e.jsx(de,{className:"relative h-6 w-6"}))]}),e.jsx("div",{className:x("flex w-full flex-col items-start justify-start",r==="small"&&"mt-[-2px]"),children:e.jsx("div",{className:x("inline-flex w-full items-start justify-start self-stretch rounded-sm",r==="small"?"gap-1":"gap-2.5 py-1"),children:e.jsx("div",{className:x("w-full leading-relaxed font-normal",a?"text-token-text-tertiary":"text-token-text-secondary"),children:i})})})]}),l?e.jsxs("div",{className:x("mb-2 inline-flex items-center justify-between self-stretch",t?.length&&"mt-[-10px]"),children:[l,t]}):e.jsxs("div",{className:"inline-flex items-center justify-end self-stretch",children:[s&&e.jsx("div",{className:"text-token-text-tertiary shrink grow basis-0 text-[15px] leading-normal font-normal",children:s}),e.jsx("div",{className:"flex gap-2",children:t})]})]})}function D({message:n,isCircular:i=!1}){const t=5.333333333333334;let s=n?.metadata?.tournament_progress??0;const o=n?.metadata?.model_slug==="o1-pro"?8*60*1e3:20*60*1e3,r=n?.create_time?n.create_time*1e3:Date.now(),l=z(r,o);s=Math.max(l,s);const a=N(),c=j(a,"3208967109");return c&&(s=Math.max(s,t)),i?e.jsx(B,{percentage:s,className:"me-4 w-full!",sizeOverride:20,thickness:1/8,transitionDuration:`${(100-s)/100*5}s`,transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)"}):e.jsx(F,{percentage:s,className:"me-4 w-full!",backgroundClassName:"bg-token-sidebar-surface-secondary rounded-full",barClassName:"bg-token-text-secondary rounded-full",transitionDuration:`${(100-s)/100*5}s`,transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)",height:c?4:8})}function xe({errorNotice:n,onOpenSidebarSummarizer:i,isReceivingUpdates:t,lastMessage:s,latestTitle:o,summarizationHeadline:r,handleSkipClick:l}){const a=N(),c=Q(),u=j(a,"4094234945"),b=j(a,"3208967109"),f=V(a,"242574110").get("can_skip","default"),p=u?D:A,w=f!=="default"&&s?.metadata?.can_skip_bon;if(b){const m=(t?o:s?.metadata?.finished_text)??c.formatMessage({id:"hgnsat",defaultMessage:"Thinking"});return e.jsxs("div",{className:"flex items-start gap-3 pb-2",children:[e.jsxs("div",{className:"flex w-full flex-col",children:[e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx("button",{type:"button",onClick:i,className:"group inline-flex max-w-full items-center rounded-md focus:outline-none",children:e.jsxs("span",{className:t?"loading-shimmer text-token-text-secondary inline-flex max-w-full items-center gap-0.5 truncate text-base leading-5 font-medium md:text-base":"text-token-text-tertiary hover:text-token-text-primary inline-flex max-w-full items-center gap-0.5 truncate text-base leading-5 font-medium md:text-base",children:[m,e.jsx(le,{className:"icon-xs text-token-text-tertiary group-hover:text-token-text-primary"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[t&&w&&e.jsx("button",{onClick:l,className:"text-token-text-tertiary hover:text-token-text-primary whitespace-nowrap",children:e.jsx("span",{className:"flex items-center gap-0.5 underline decoration-dotted decoration-[8%]",children:e.jsx(E,{id:"xMM6dg",defaultMessage:"Answer now"})})}),t&&e.jsx("div",{className:"ms-1 shrink-0 self-start md:hidden",children:e.jsx(p,{message:s,isCircular:!0})})]})]}),t&&e.jsx("div",{className:"mt-[22px] mb-2 hidden self-stretch md:inline-flex",children:e.jsx("div",{className:"w-full max-w-[150px]",children:e.jsx(p,{message:s,isCircular:!1})})})]}),n]})}return e.jsxs("div",{className:"flex pb-2",children:[e.jsx(me,{buttons:t?[e.jsx(X,{onClick:m=>{m.stopPropagation(),i()},color:"secondary",className:"text-token-text-secondary h-[38px]! text-[15px] font-normal",children:e.jsx("div",{className:"px-1",children:e.jsx(E,{id:"wQcuK8",defaultMessage:"Details"})})},"Details")]:[],time:null,title:r,icon:t?e.jsx("div",{className:""}):null,content:t?`${o}...`:s?.metadata?.finished_text??"",size:"small",disabled:!t,onClick:i,progressBar:t?u?e.jsx(D,{message:s}):e.jsx(A,{message:s}):null}),n]})}const ue=/\*\*(.*?)(?:\*\*|\n|$)/g,fe=n=>{let i=null,t;for(;(t=ue.exec(n))!=null;)i=t[1].trim();return i},pe=()=>null;function ve({messages:n,isStreaming:i,isCompletionRequestInProgress:t,hasActiveRequest:s,isLastMessage:o,isFinalTurn:r,isFeedbackEnabled:l,clientThreadId:a,currentGroupedMessageIndex:c,turnIndex:u}){const[b,f]=g.useState(""),[p,w]=g.useState(!1),m=S(a),$=Y(a)?.value===U.STREAMING,G=oe(S(a)),d=ee(n),L=d?.id,_=d?.metadata?.initial_text,k=d?.metadata?.summarization_headline,v=n.map(h=>te(h)).join(`

`),{toggleThreadSidebar:C}=se(),R=g.useCallback(()=>{C({type:"summarizer",clientThreadId:a,currentGroupedMessageIndex:c,turnIndex:u})},[C,a,c,u]),q=g.useCallback(()=>{d?.metadata?.can_skip_bon&&m&&(M.logEventWithStatsig("chatgpt_web_pro_skip_clicked","chatgpt_web_pro_skip_clicked",{conversationId:m,messageId:d?.id}),ae.safePost("/bon/{conversation_id}/skip",{parameters:{path:{conversation_id:m}}}))},[m,d]),H=N(),T=j(H,"3208967109");g.useEffect(()=>{const h=fe(v);if(h){f(h);return}if(T&&k!=null){f(k);return}_!=null&&f(_)},[v,k,T,_]),g.useEffect(()=>{v.length>0&&w(!0)},[v]),g.useEffect(()=>{p&&M.logEvent("Tool: Received a8km123 message",{client_thread_id:a,message_id:L,conversationId:S(a)})},[p]);const I=r&&o&&($||i),W=pe()!=null,O=ne.isLastActorMessage(re(a),n[0].id),K=!!ie(a,h=>h?.sharedConversationMetadata),y=ce(n[0],O,W,t||s,K);return!G&&d?.metadata?.finish_details?.type==="interrupted"&&d?.metadata?.finish_details?.reason!=="server_timeout"||d?.clientMetadata?.err?e.jsx("div",{children:y&&e.jsx(P,{errorState:y,nodeId:n[0].id,isFeedbackEnabled:l,clientThreadId:a,isUserTurn:!1})}):e.jsx(xe,{errorNotice:y&&e.jsx(P,{errorState:y,nodeId:n[0].id,isFeedbackEnabled:l,clientThreadId:a,isUserTurn:!1}),onOpenSidebarSummarizer:R,isReceivingUpdates:I,lastMessage:d,latestTitle:b,summarizationHeadline:k,handleSkipClick:q})}export{ve as default};
//# sourceMappingURL=gfmmw3q76hcr29sv.js.map
