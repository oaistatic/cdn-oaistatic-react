import{r as l,e as V,j as e,M as d}from"./cs7toih8jegb7teq.js";import{ls as _,lt as K,cH as U}from"./hnw079jsdm76umup.js";import{z as y,B as S,ej as q,d1 as B,t as G,bV as J,de as Q}from"./dmck639k4dv7claj.js";import{C as X,S as Y,i as Z,g as ee,D as te,N as oe}from"./foi4i86wi4yrq0wp.js";import{i as se}from"./icwejktgx2db5g2x.js";import{F as ne}from"./fsblv7a42b4xl30f.js";import{k as ie}from"./crerkmhvihiw48az.js";function O({filePath:t,side:s,lineNumber:m,onSubmit:c,onDelete:a,onClose:r,initialComment:o}){const p=o?E(o):"",[i,j]=l.useState(o?E(o):""),[F,x]=l.useState(!o),[g,v]=l.useState(!1),N=l.useRef(null),M=V(),k=()=>{if(!i)return;const f=o?{...o,content:[{content_type:"text",text:i}]}:{id:crypto.randomUUID(),type:"comment",content:[{content_type:"text",text:i}],position:{side:s===Y.old?"left":"right",path:t,line:m}};c?.(f),x(!1),N.current?.blur(),r?.()};return l.useEffect(()=>{!g&&o&&i===p&&setTimeout(()=>{x(!1)},100),g&&(x(!0),N.current?.focus())},[g,o,i,p]),e.jsx("div",{className:"gap-2 bg-gray-100/50 p-4 font-sans dark:bg-gray-900",id:o?.id,children:e.jsxs("div",{className:y("flex flex-col gap-2",X),children:[e.jsx(se,{ref:N,className:"border-token-border-medium bg-token-main-surface-primary text-token-text-primary border-1.5 w-full resize-none rounded-lg p-4 text-sm ring-0 focus:border-black focus:outline-hidden dark:focus:border-white","data-wham-comment-textarea":!0,onFocus:()=>v(!0),onBlur:()=>v(!1),placeholder:M.formatMessage({id:"code.diff.addComment",defaultMessage:"Add a comment"}),minRows:1,maxRows:10,autoFocus:!o,onSubmit:()=>{},value:i,onChange:f=>j(f.target.value),onKeyDown:f=>{f.key==="Enter"&&f.metaKey&&(f.preventDefault(),k()),f.key==="Escape"&&(f.preventDefault(),r?.())}}),F&&e.jsxs("div",{className:y("mt-2 flex items-center justify-between gap-2",!a&&"justify-end"),children:[a&&e.jsx(S,{color:"danger",onClick:()=>a?.(),children:e.jsx(d,{id:"code.diffComment.delete",defaultMessage:"Delete"})}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(S,{color:"secondary",onClick:()=>{r?.(),x(!1),o&&j(E(o))},children:e.jsx(d,{id:"code.diffComment.cancel",defaultMessage:"Cancel"})}),e.jsx(S,{color:"primary",disabled:!i,onClick:k,children:o?e.jsx(d,{id:"code.diffComment.save",defaultMessage:"Save"}):e.jsx(d,{id:"code.diffComment.comment",defaultMessage:"Comment"})})]})]})]})})}function E(t){return t.content.map(s=>s.content_type==="text"?s.text:"").join("")}function ae(t){return t.content.map(s=>s.content_type==="text"?s.text:"").filter(s=>s.length>0).join(`
`).trim()}function re({comment:t}){const s=l.useMemo(()=>ae(t),[t]),m=t.priority,c=Math.round(t.confidence_score*100),a=t.position.start_line,r=t.position.line,o=!!a&&!!r,p=t.position.side==="left"?"-":"+",i=j=>`${p}${j}`;return e.jsxs("div",{className:"border-token-border-default bg-token-bg-secondary rounded-lg border px-4 py-3 text-sm",children:[o&&e.jsx("div",{className:"text-token-text-tertiary border-token-border-subtle mb-3 border-b pb-2 text-xs font-medium",children:a===r?e.jsx(d,{id:"wham.codeDiffReadonlyComment.commentOnSingleLine",defaultMessage:"Comment on line {line}",values:{line:e.jsx("span",{className:"font-semibold",children:i(a)})}}):e.jsx(d,{id:"wham.codeDiffReadonlyComment.commentOnMultipleLines",defaultMessage:"Comment on lines {start} to {end}",values:{start:e.jsx("span",{className:"font-semibold",children:i(a)}),end:e.jsx("span",{className:"font-semibold",children:i(r)})}})}),e.jsxs("div",{className:"text-token-text-tertiary flex flex-wrap items-center gap-2 text-xs",children:[m!=null&&e.jsx("span",{className:"bg-token-bg-tertiary text-token-text-tertiary rounded px-1 py-0.5 font-medium",children:e.jsx(d,{id:"wham.codeDiffReadonlyComment.priority",defaultMessage:"Priority {priority}",values:{priority:m}})}),t.title&&e.jsx("span",{className:"text-token-text-primary font-medium",children:t.title}),c!=null&&e.jsx("span",{className:y("ms-auto",!t.title&&"font-medium"),"data-testid":"codex-comment-confidence",children:e.jsx(d,{id:"wham.codeDiffReadonlyComment.confidence",defaultMessage:"{confidence}% confidence",values:{confidence:c}})})]}),s&&e.jsx("div",{className:"text-token-text-primary mt-2 leading-5 whitespace-pre-wrap",children:s})]})}function le({copyDiffToClipboard:t,copyPatchToClipboard:s}){const[m,c]=l.useState(!1),a=V(),r=o=>p=>{p.preventDefault(),p.stopPropagation(),o==="diff"?t():s()};return e.jsxs(q,{open:m,onOpenChange:c,contentAlign:"end",sideOffset:8,modal:!0,triggerButton:e.jsx("button",{type:"button",onClick:o=>{o.preventDefault(),o.stopPropagation(),c(!0)},className:"hover:bg-token-border-light rounded p-1","aria-label":a.formatMessage({id:"wham.copyFileActionDropdown.openMenu",defaultMessage:"Open copy menu"}),children:e.jsx(K,{className:"icon"})}),children:[e.jsx(B.Item,{icon:_,onClick:r("diff"),children:e.jsx(d,{id:"wham.copyFile.apply",defaultMessage:"Copy git apply"})}),e.jsx(B.Item,{icon:_,onClick:r("patch"),children:e.jsx(d,{id:"wham.copyFile.patch",defaultMessage:"Copy patch"})})]})}const de="_diffView_avtz7_1",ce={diffView:de},L="wham-toggle-all-diffs";function fe(t){return l.useEffect(()=>{function s(m){t(m.detail.open)}return window.addEventListener(L,s),()=>{window.removeEventListener(L,s)}},[t]),l.useCallback(s=>{window.dispatchEvent(new CustomEvent(L,{detail:{open:s}}))},[])}function we({diff:t,viewType:s,stickyHeader:m,enableComments:c=!1,comments:a,buttonClassName:r,onCommentCreate:o,onCommentDelete:p,onCommentUpdate:i,readonlyComments:j}){const F=G(),x=V(),[g,v]=l.useState(()=>!Z(t.diffFile)),[N,M]=l.useState(!1),k=J(),f=fe(v);l.useEffect(()=>{t.diffFile.initTheme(F?"dark":"light")},[t.diffFile,F]);const R=n=>"id"in n,P=[...a??[],...j??[]].reduce((n,u)=>{const b=u.position,w=b.side,C=b.line,h=b.path;if(C==null||!h)return n;n[h]||(n[h]={oldFile:{},newFile:{}});const D=w==="left"?n[h].oldFile:n[h].newFile,H=D[C]?.data??[],W=R(u)?{kind:"editable",comment:u}:{kind:"readonly",comment:u};return D[C]={data:[...H,W]},n},{}),T=ee(t.diffFile),A=()=>{const n=t.diffFile._newFileName===oe?t.diffFile._oldFileName:t.diffFile._newFileName;navigator.clipboard.writeText(n),M(!0),setTimeout(()=>{M(!1)},1e3)},I=async()=>{t.hunksText&&(await navigator.clipboard.writeText(` (cd "$(git rev-parse --show-toplevel)" && git apply --3way <<'EOF' 
${t.hunksText} 
EOF
)`),k.success(x.formatMessage({id:"wham.message.modal.footer.copiedToClipboard",defaultMessage:"Copied git apply command to clipboard"}),{duration:3,hasCloseButton:!0}))},$=async()=>{t.hunksText&&(await navigator.clipboard.writeText(t.hunksText),k.success(x.formatMessage({id:"wham.codeDiff.copiedPatchToClipboard",defaultMessage:"Copied patch to clipboard"}),{duration:3,hasCloseButton:!0}))},z=!t.diffFile.unifiedLineLength&&!t.diffFile.splitLineLength;return e.jsxs("div",{"data-diff-header":T,className:y("flex flex-col pt-1",ce.diffView),children:[e.jsx("div",{role:"button",onClick:n=>{const u=!g;n.altKey?f(u):v(u)},className:y("focus-visible:outline-none",m&&"sticky top-0 z-1",r),children:e.jsxs("div",{className:y("bg-token-bg-primary border-token-border-default relative flex items-center rounded-t-2xl border px-4 py-3 text-sm font-medium before:absolute before:inset-x-[-1px] before:top-[-1px] before:bottom-0 before:z-[-1] before:bg-[var(--right-bg)] before:content-['']",!g&&"rounded-b-2xl"),children:[e.jsx(U,{className:y("icon me-3 transition-transform duration-200",g&&"rotate-90")}),e.jsx("span",{className:"me-1 truncate text-start select-text",title:T,children:T}),e.jsx(ne,{diffFile:t.diffFile}),e.jsx(Q,{label:x.formatMessage({id:"wham.codeDiff.copiedFileName",defaultMessage:"Copied File Name"}),open:N,children:e.jsx("div",{role:"button",onClick:n=>{n.preventDefault(),n.stopPropagation(),A()},className:"hover:bg-token-border-light rounded p-1","aria-label":x.formatMessage({id:"wham.codeDiff.copyFileName",defaultMessage:"Copy file name"}),children:e.jsx(_,{className:"icon-xs"})})}),e.jsxs("div",{className:"ms-auto flex items-center gap-1 ps-1",children:[e.jsx(ie,{linesAdded:t.diffFile.additionLength,linesRemoved:t.diffFile.deletionLength}),!t.isBinary&&e.jsx(le,{copyDiffToClipboard:I,copyPatchToClipboard:$})]})]})}),g&&(z||t.isBinary?e.jsx("div",{className:"text-token-text-secondary bg-token-bg-secondary flex h-full justify-center rounded-b-2xl py-4 text-sm font-medium",children:t.isBinary?e.jsx(d,{id:"wham.diff.binaryFile",defaultMessage:"Binary file not shown"}):e.jsx(d,{id:"wham.diff.noContent",defaultMessage:"No content"})}):e.jsx(te,{className:y("relative overflow-clip rounded-b-2xl transition-opacity duration-300","after:border-token-border-default after:pointer-events-none after:absolute after:inset-0 after:rounded-b-2xl after:border-s after:border-e after:border-b after:content-['']"),diffViewFontSize:12,diffFile:t.diffFile,diffViewTheme:F?"dark":"light",diffViewHighlight:!0,diffViewMode:s==="split"?3:4,diffViewWrap:!0,diffViewAddWidget:c,extendData:P[t.diffFile._newFileName],renderExtendLine:({lineNumber:n,side:u,data:b})=>b.length?e.jsx("div",{className:"flex flex-col gap-2",children:b.map((w,C)=>{if(w.kind==="readonly")return e.jsx(re,{comment:w.comment},`readonly-${w.comment.position.path}-${w.comment.position.line}-${C}`);if(!c)return null;const h=w.comment;return e.jsx(O,{initialComment:h,onSubmit:D=>i?.(D),onDelete:()=>p?.(h),filePath:t.diffFile._newFileName,side:u,lineNumber:n},h.id)})}):null,renderWidgetLine:({onClose:n,lineNumber:u,side:b})=>!c||!o?null:e.jsx(O,{onSubmit:o,onClose:n,filePath:t.diffFile._newFileName,side:b,lineNumber:u})}))]})}export{we as C};
//# sourceMappingURL=iu45eaes85w805k2.js.map
