import{jz as S,bV as E,q5 as O,d_ as R,lU as I}from"./dmck639k4dv7claj.js";import{f as K,r as e,e as L,a as W,j as i,ah as U,h as q,O as B}from"./cs7toih8jegb7teq.js";import{W as H}from"./o2jw2vp6wnsz2uvz.js";import{s as N,t as Q,h as z,W as $,l as G,v as V,x as J,j as X}from"./crerkmhvihiw48az.js";import{jH as Y,hP as _,hQ as M}from"./hnw079jsdm76umup.js";import{u as Z}from"./yf0i1e6tgcrdg1ll.js";import{a as tt,T as st,W as et,b as rt}from"./e2yc8higqjump39r.js";import{u as ot}from"./foi4i86wi4yrq0wp.js";import{u as nt}from"./jjprqojduzf2gfkc.js";import"./kizn5m1hr7kdjf9n.js";import"./nfubiloo9rdxk3kj.js";import"./mcpubm63u255wsr6.js";import"./g9gr3l5lwhb3z8y8.js";import"./d2w9ht1jp4bj9t28.js";import"./ig3euz6ql417cw29.js";import"./g0qqcme5h04p667m.js";import"./isvc0syyvbx2i79u.js";import"./mntlin6h4lg868yr.js";import"./mcuu3cegz8rmschr.js";import"./o12mkc4t9o2t0ta8.js";import"./dr58d0qi3ke74zcr.js";import"./kwms1ugj73bjxgnk.js";import"./cvjqnnll0s8g7pb7.js";import"./c9fo3bbas9eanfzk.js";import"./fzrn137102spawew.js";import"./h3nlvxow81w42tha.js";import"./lg7g3n7e6pizuyzp.js";import"./gl21c0qqyu3lkg8e.js";import"./d0qctmhgeexj40hp.js";import"./b72akmtywhypzcgo.js";import"./lyxm37ljpwg11a5m.js";import"./na0t6wj09rfp0awn.js";import"./liqaqj2w179grtbv.js";import"./21ei6cu23fdeusdh.js";import"./gu3kz9694iumz76j.js";import"./dvi0n1hal1hb8zit.js";import"./mggn820eodl8mh7p.js";import"./dp7t1jmnbbend843.js";import"./g7h4esjesus5ngav.js";import"./cm813h9bptrniota.js";function at(s){const r=K(),n=S(),a=ot(),{data:t,error:m}=N(s,{refetchOnWindowFocus:!0,refetchOnMount:!0}),{isLoading:p}=Q(s),c=z(({getTurnsForTask:u})=>u(s))??[],{focusedAssistantTurn:o,setFocusedAssistantTurnId:k}=tt({taskId:s,task:t?.task,currentUserTurn:t?.current_user_turn??null,currentAssistantTurn:t?.current_assistant_turn??null}),C=t?.task?.current_turn_id,l=!!t?.task.has_unread_turn&&C===t?.current_assistant_turn?.id,f=t?.current_assistant_turn?.turn_status==="completed";e.useEffect(()=>{if(!n)return;const u=t?.task?.title;if(!u)return;const d=document.title;return document.title=u,()=>{document.title=d}},[n,t?.task?.title]),e.useEffect(()=>{!l||!f||$.markTurnAsRead(s).then(()=>{r.invalidateQueries({queryKey:["wham","tasks"]}),r.invalidateQueries({queryKey:["wham","task",s]})})},[l,f,s,r]);const g=e.useMemo(()=>{const u=o?G(o.turn_status):!1,d=o?.sibling_turn_ids?.includes(t?.current_assistant_turn?.id??"")||o?.id===t?.current_assistant_turn?.id,h=!t?.current_diff_task_turn;return u&&(d||h)},[o,t?.current_assistant_turn,t?.current_diff_task_turn]);return{taskDetails:t,taskDetailsError:m,loadingTurnMapping:p,turns:c,focusedAssistantTurn:o,setFocusedAssistantTurnId:k,canFollowUp:g,isCommentFocused:a}}function it(){const[s,r]=e.useState([]),[n,a]=e.useState(!1),t=e.useCallback(()=>{r([])},[]),m=e.useCallback(({onClose:p,isComposerEmpty:c})=>({force:o=!1}={})=>{if(o||s.length===0&&c){t(),p();return}a(!0)},[s.length,t]);return{comments:s,setComments:r,confirmClose:n,setConfirmClose:a,clearComments:t,createCloseHandler:m}}function ut({taskId:s,onClose:r}){const n=E(),a=L(),t=W(),{composerController:m,isComposerEmpty:p}=nt(),{taskDetails:c,taskDetailsError:o,loadingTurnMapping:k,turns:C,focusedAssistantTurn:l,setFocusedAssistantTurnId:f,canFollowUp:g,isCommentFocused:u}=at(s),d=e.useMemo(()=>V(l),[l]),h=e.useMemo(()=>({taskId:s,task:c?.task,pastTurns:C,canFollowUp:g,focusedAssistantTurn:l,setFocusedAssistantTurnId:f}),[s,c,C,g,l,f]),{comments:T,setComments:x,confirmClose:w,setConfirmClose:j,clearComments:b,createCloseHandler:v}=it(),P=e.useMemo(()=>({comments:T,setComments:x,clearComments:b,readonlyComments:d}),[T,x,b,d]),A=Y.useCurrentImage()!=null,y=v({onClose:r,isComposerEmpty:p});Z(),J([{key:"newTask",action:()=>{t("/codex",{state:{focusComposer:!0}})},actionMessageDescriptor:a.formatMessage({id:"wham.keyboardActions.newTask",defaultMessage:"New task"}),group:M.Chat,keyboardBinding:[_.Mod,_.Shift,"o"]},{key:"closeTask",action:()=>{t("/codex")},actionMessageDescriptor:a.formatMessage({id:"wham.keyboardActions.closeTask",defaultMessage:"Close task"}),group:M.Chat,keyboardBinding:[_.Escape],enabled:!A&&!u}]);const D=e.useCallback(({force:F=!1}={})=>{y({force:F})},[y]);return o?(n.danger({id:"wham.task-details.error",defaultMessage:"Error loading task",description:"Error message for failed to load task details"},{id:`wham-task-details-error-${s}`,hasCloseButton:!0,duration:3,toastId:"wham_task_page_content_error"}),i.jsx(U,{to:"/codex"})):i.jsx(O.Provider,{value:m,children:i.jsx(st,{value:P,children:i.jsx(et,{value:h,children:i.jsx(rt,{permissions:"write",turnId:c?.current_assistant_turn?.id??"",confirmClose:w,setConfirmClose:j,handleClose:D,loadingTurnMapping:k})})})})}function mt(){const s=W(),r=q(),{taskId:n}=B();X();const a=r.state??{},{backgroundLocation:t}=a,m=e.useCallback(()=>{s(t?-1:"/codex")},[t,s]);return n?i.jsx(R,{children:i.jsx(H,{children:i.jsx(ut,{taskId:n,onClose:m})})}):null}const Jt=()=>[{title:"Codex"}],Xt=I(function(){return i.jsx(mt,{})});export{Xt as default,Jt as meta};
//# sourceMappingURL=jyxkkang0xcg1xt8.js.map
