import{bV as _,bh as v}from"./dmck639k4dv7claj.js";import{W as f}from"./crerkmhvihiw48az.js";import{f as g,e as l,i as R}from"./cs7toih8jegb7teq.js";function y(i){return!!i&&typeof i=="object"&&"pages"in i}function M({showToast:i=!0}={}){const a=g(),u=l(),m=_(),w=v();return R({mutationFn:s=>f.updateCodeReviewRepositories(s),onMutate:async s=>{await a.cancelQueries({queryKey:["wham","codeReviewRepositories"]});const n=a.getQueryData(["wham","codeReviewRepositories"]);return a.setQueryData(["wham","codeReviewRepositories"],e=>{if(!e)return e;const o=new Map((s?.repo_review_settings??[]).map(t=>[t.repository,t.review_preference])),p=w?.email??null;if(y(e))return{...e,pages:e.pages.map(t=>({...t,repo_review_settings:t.repo_review_settings.map(r=>{const d=o.get(r.repository.id);return d!==void 0?{...r,review_preference:d,updated_at:new Date().toISOString(),last_updated_user_email:p}:r})}))};const c=e;return{...c,repo_review_settings:c.repo_review_settings.map(t=>{const r=o.get(t.repository.id);return r!==void 0?{...t,review_preference:r,updated_at:new Date().toISOString(),last_updated_user_email:p}:t})}}),{previous:n}},onError:(s,n,e)=>{e?.previous&&a.setQueryData(["wham","codeReviewRepositories"],e.previous)},onSuccess:s=>{const e=s.repo_review_settings.some(o=>o.review_preference==="team")?u.formatMessage({id:"wham.codeReviewPage.teamAutomations.toast.enabled",defaultMessage:"Enabled code review"}):u.formatMessage({id:"wham.codeReviewPage.teamAutomations.toast.disabled",defaultMessage:"Disabled code review"});i&&m.success(e,{duration:2,hasCloseButton:!0})}})}export{M as u};
//# sourceMappingURL=jyhehpfhizgr7mgi.js.map
