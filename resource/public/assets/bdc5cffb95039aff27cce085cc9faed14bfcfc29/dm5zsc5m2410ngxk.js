import{r,j as t,M as y}from"./cs7toih8jegb7teq.js";import{aX as A,hG as I,fI as _,g as H,T as F,bj as B,P as x,dE as G,eJ as L,aI as R,ig as z,B as j,cx as J,e8 as K}from"./dmck639k4dv7claj.js";import{fo as U,fp as V}from"./hnw079jsdm76umup.js";import{E as D}from"./ec6gizbh044so065.js";function O({initialText:c,clientThreadId:n,currentLeaf:i,onExitEdit:d,onRequestCompletion:p,disabled:C,attachments:o}){const[l,E]=r.useState(c??""),u=r.useRef(null),M=A(),h=I.useStore(),g=l.trim()==="",b=r.useCallback(e=>{E(e.currentTarget.value)},[]),m=r.useCallback(e=>{if(g)return;const s={},a=_();o&&(s.attachments=o),a&&(s.__internal={search_settings:a});const v=h.getActiveSystemHintType(),{systemHints:N,extraStreamParams:P}=U(v?[v]:[]),S=H(n),w=F.getParentNode(S,i).message.id;p({sourceEvent:e,parentMessageId:w,promptMessage:B(l,Object.keys(s).length>0?s:void 0),extraStreamParams:P,completionMetadata:{conversationMode:S?.mode,systemHints:N}}),d(),x.logEvent("Change Active Node",{intent:"edit_save"})},[g,o,n,h,p,d,i,l]),f=r.useCallback(()=>{G(n,e=>{L.setCurrentBranch(e,i)}),x.logEvent("Change Active Node",{intent:"edit_cancel"}),d(),x.logEvent("Cancel Edit Prompt",{threadId:R(n)})},[i,d,n]);r.useEffect(()=>{const e=u.current;if(e){e.focus();const s=e.value.length;e.setSelectionRange(s,s)}},[]),r.useEffect(()=>{const e=u.current,s=a=>{a.isComposing||(a.key==="Enter"&&a.metaKey?m(a):a.key==="Escape"&&f())};return e&&e.addEventListener("keydown",s),()=>{e&&e.removeEventListener("keydown",s)}},[f,m]);const T=o&&o.length>0&&t.jsx(W,{children:o.map(e=>t.jsx(V,{width:M?"wide":"normal",file:e.name,contextConnectorInfo:z(e.context_connector_info)},e.id))}),k=t.jsx("div",{className:"m-2 max-h-[25dvh] overflow-auto",children:t.jsx(D,{ref:u,value:l,onChange:b,className:"m-0 w-full resize-none border-0 bg-transparent focus:ring-0 focus-visible:ring-0"})});return t.jsxs("div",{className:"bg-token-main-surface-tertiary rounded-3xl px-3 py-3",children:[T,k,t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx(j,{as:"button",color:"secondary",onClick:f,children:t.jsx(y,{id:"D9gbPp",defaultMessage:"Cancel"})}),t.jsx(j,{as:"button",onClick:m,disabled:C||g,children:t.jsx(y,{id:"KGxIJG",defaultMessage:"Send"})})]})]})}const W=J.div`flex gap-2 flex-wrap`;function ee({message:c,...n}){return t.jsx(O,{currentLeaf:c.id,initialText:K(c),attachments:c.metadata?.attachments,...n})}export{ee as TextMessageEditor};
//# sourceMappingURL=dm5zsc5m2410ngxk.js.map
