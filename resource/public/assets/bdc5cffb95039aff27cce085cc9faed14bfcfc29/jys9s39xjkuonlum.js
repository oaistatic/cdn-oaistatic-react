import{e as g,j as e,M as m,r as c}from"./cs7toih8jegb7teq.js";import{gA as W,e as N,k_ as q,p as k,B as j}from"./dmck639k4dv7claj.js";import{g as D}from"./d2w9ht1jp4bj9t28.js";import{u as U,A as V,R as z,N as G,a as L}from"./oru2fxqyndtwb7c5.js";import{F as C}from"./bti9u69vji4jff3k.js";import{u as Y}from"./lco7biunzadofjpa.js";import{u as H}from"./fba6r4282q3hco9o.js";import{W as u}from"./g9gr3l5lwhb3z8y8.js";import{C as J}from"./905wlitl49jr06xl.js";import{u as K,m as Q}from"./crerkmhvihiw48az.js";import{h as X}from"./ceo93mq020icv1xq.js";import{P as Z}from"./dp7t1jmnbbend843.js";import{u as $}from"./jyhehpfhizgr7mgi.js";import{u as ee}from"./fthj90769o63ez5l.js";import{u as se}from"./b6qetqbp7rfswxdc.js";import{dT as te}from"./hnw079jsdm76umup.js";function oe({shouldTurnOn:n,onChange:o}){const{data:t}=K(),a=g();return t?e.jsx("div",{className:"border-token-border-heavy bg-token-bg-primary flex w-full flex-col items-center rounded-lg border p-4",children:e.jsxs("div",{className:"flex w-full justify-between",children:[e.jsxs("div",{className:"flex w-full flex-col items-start justify-start gap-2",children:[e.jsx("p",{className:"text-token-text-primary text-sm leading-tight font-medium",children:e.jsx(m,{id:"wham.enableCodeReviewsToggle.label",defaultMessage:"Code reviews"})}),e.jsx("p",{className:"text-token-text-secondary justify-start text-xs leading-none font-normal",children:e.jsx(m,{id:"wham.enableCodeReviewsToggle.description",defaultMessage:"Automatically run reviews on new pull requests in this repo."})})]}),e.jsx("div",{className:"flex items-center",children:e.jsx(W,{checked:n,onCheckedChange:o,className:"radix-state-checked:bg-black!","aria-label":a.formatMessage({id:"wham.enableCodeReviewsToggle.ariaLabel",defaultMessage:"Enable code reviews by Codex"})})})]})}):null}function ae(){const n=N(),o=q("installations/select_target"),{data:t,isLoading:a}=Q();c.useEffect(()=>{if(a)return;[...t?.memberships??[],...t?.other??[]].length===0&&X(o)},[a,t,n,o])}function Ce({handleGoBack:n,handleSelectEnvironment:o,goToNextPage:t,lockPageView:a}){const r=g();return c.useEffect(()=>{u.recordEnvironmentsView()},[]),e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsx(J,{title:r.formatMessage({id:"wham.codexOnboardingEnvironments.createYourFirstEnvironment",defaultMessage:"Create your starting environment"}),description:r.formatMessage({id:"wham.codexOnboardingEnvironments.createYourFirstEnvironment.description",defaultMessage:"Pick a repo to set up the basics. You can customize your environment later."})}),e.jsx(ne,{backCta:r.formatMessage({id:"wham.codexOnboardingEnvironments.back",defaultMessage:"Back"}),handleGoBack:n,handleSelectEnvironment:o,goToNextPage:t,lockPageView:a})]})}function ne({backCta:n,handleGoBack:o,handleSelectEnvironment:t,goToNextPage:a,lockPageView:r,shouldDisableRow:S,disablePill:y}){const E=Y(),f=g(),p=N(),h=H(),[x,A]=c.useState(""),[w,R]=c.useState(null),[b,I]=c.useState(!E),{mutate:M,isPending:O}=se({onSuccess:s=>{u.recordCreateEnvSuccess(),t(s.id,D(s)),a()}}),{mutate:T}=$({showToast:!1}),{mutate:_}=ee({showToast:!1}),d=k(p,"2134057841"),P=k(p,"1535847699");ae();const i=te({defaultValues:{repositoryId:"",agentNetworkAccess:d?{mode:"off"}:null},validators:{onSubmit:({value:s})=>{const l={};return(!s.repositoryId||s.repositoryId==="")&&(l.repositoryId=f.formatMessage({id:"wham.codexOnboardingEnvironments.repositoryIsRequired",defaultMessage:"Repository is required"})),d&&s.agentNetworkAccess?.mode==="on"&&s.agentNetworkAccess.preset_allowlist===Z&&(!s.agentNetworkAccess.allowlist_domains||s.agentNetworkAccess.allowlist_domains.length===0)&&(l.agentNetworkAccess=f.formatMessage({id:"wham.environmentsForm.agentNetworkAccessAllowlistRequired",defaultMessage:"At least one domain is required"})),{fields:l}}},onSubmit:({value:s})=>{u.recordEnvironmentsSubmit(),r(),h&&b&&(_({codeReviewPreference:"repo_default"}),T({repo_review_settings:[{repository:s.repositoryId,review_preference:"team"}]})),M({...s,label:x,description:"",machine:"wham-public/wham-universal",workspaceDirectory:"/workspace",share_settings:"workspace",setupCommands:"",maintenanceSetupCommands:"",envVars:[],secrets:[],autoSetupSettings:P?{use_auto_setup:!0}:null})}}),F=s=>{s.preventDefault(),s.stopPropagation(),i.handleSubmit()},v=U();return e.jsx("form",{onSubmit:F,className:"flex flex-col gap-6",children:e.jsxs("div",{className:"flex w-full flex-col gap-4",children:[e.jsx(V,{selectedInstallationId:w,setSelectedInstallationId:R}),e.jsx(i.Field,{name:"repositoryId",children:s=>e.jsxs("div",{className:"flex w-full flex-col gap-4",children:[e.jsx(z,{installationId:w,selectedRepository:s.state.value,onSelect:(l,B)=>{s.handleChange(l),A(B)},shouldDisableRow:S,disablePill:y}),e.jsx(C,{field:s})]})}),h&&e.jsx(oe,{shouldTurnOn:b,onChange:I}),d&&e.jsx(i.Field,{name:"agentNetworkAccess",children:s=>e.jsxs("div",{className:"flex flex-col gap-4",children:[v!=null&&e.jsx(G,{disabledByWorkspaceSettings:v,agentNetworkAccess:s.state.value,onChange:s.handleChange}),e.jsx(C,{field:s}),s.state.value?.mode==="on"&&e.jsx(L,{})]})}),e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx(j,{color:"secondary",size:"medium",type:"button",onClick:o,children:n}),e.jsx(i.Subscribe,{selector:s=>s.values,children:s=>e.jsx(j,{color:"primary",size:"medium",loading:O,disabled:!x||d&&!s.agentNetworkAccess,onClick:()=>i.handleSubmit(),children:e.jsx(m,{id:"wham.codexOnboardingEnvironments.createEnvironment",defaultMessage:"Create environment"})})})]})]})})}export{ne as O,Ce as a,ae as u};
//# sourceMappingURL=jys9s39xjkuonlum.js.map
