import{r as u,e as C,j as e,i as w,M as x}from"./cs7toih8jegb7teq.js";import{aX as k,z as _,nP as N,c3 as A,C as T,R as v,B as j}from"./dmck639k4dv7claj.js";import{cG as R}from"./hnw079jsdm76umup.js";import{JsonViewer as F}from"./cvjqnnll0s8g7pb7.js";import{T as D,a as U,b as W}from"./lg7g3n7e6pizuyzp.js";import{C as B}from"./iu45eaes85w805k2.js";import{p as H,W as E,b as z,M as q}from"./foi4i86wi4yrq0wp.js";import{W as b}from"./g9gr3l5lwhb3z8y8.js";import{g as G,W as V,u as J}from"./crerkmhvihiw48az.js";import"./c9fo3bbas9eanfzk.js";import"./fzrn137102spawew.js";import"./h3nlvxow81w42tha.js";import"./d2w9ht1jp4bj9t28.js";import"./ig3euz6ql417cw29.js";import"./icwejktgx2db5g2x.js";import"./epuqxu07prihsdka.js";import"./fsblv7a42b4xl30f.js";import"./21ei6cu23fdeusdh.js";import"./gu3kz9694iumz76j.js";import"./dvi0n1hal1hb8zit.js";import"./mggn820eodl8mh7p.js";import"./dr58d0qi3ke74zcr.js";import"./dp7t1jmnbbend843.js";import"./mcpubm63u255wsr6.js";import"./g0qqcme5h04p667m.js";import"./isvc0syyvbx2i79u.js";import"./g7h4esjesus5ngav.js";import"./cm813h9bptrniota.js";import"./mntlin6h4lg868yr.js";const M=new Set;function Ce({taskId:a,suggestion:s,index:l,assistantTurn:t,isOpen:i,onClose:r}){const d=u.useMemo(()=>G(t,!0).length>0,[t]),f=u.useMemo(()=>H({assistantTurn:t,followUp:d}),[t,d]),c=!d,o=C(),m=k(),[L,y]=u.useState("diff"),P="diff";u.useEffect(()=>{const n=t.id;i&&n&&!M.has(n)&&(M.add(n),V.viewSpeculativeTurn(a,n))},[i,t.id,a]);const h=e.jsx(K,{taskId:a,suggestion:s,index:l,assistantTurn:t,showFullDiff:c}),S=e.jsx("div",{className:"relative flex h-full w-full flex-col",children:e.jsxs(D,{onChange:y,currentTab:L,defaultTab:P,tabs:[{key:"chat",isHidden:m,label:o.formatMessage({id:"wham.whamTaskPageContentLoaded.conversation",defaultMessage:"Conversation"}),ariaLabel:o.formatMessage({id:"wham.whamTaskPageContentLoaded.conversationAriaLabel",defaultMessage:"Tab to view the conversation with the assistant"}),children:h},{key:"diff",isHidden:!1,label:o.formatMessage({id:"wham.whamTaskPageContentLoaded.diff",defaultMessage:"Diff"}),ariaLabel:o.formatMessage({id:"wham.whamTaskPageContentLoaded.diffAriaLabel",defaultMessage:"Tab to view the code diff"}),children:e.jsx(X,{taskId:a,assistantTurn:t,index:l,diffFiles:f})},{key:"logs",label:o.formatMessage({id:"wham.whamTaskPageContentLoaded.logs",defaultMessage:"Logs"}),ariaLabel:o.formatMessage({id:"wham.whamTaskPageContentLoaded.logsAriaLabel",defaultMessage:"Tab to view the work logs"}),children:e.jsx(u.Suspense,{fallback:e.jsx("div",{className:"flex h-full w-full items-center justify-center py-8",children:e.jsx(N,{})}),children:e.jsx(E,{taskId:a,focusedAssistantTurn:t,agentNetworkAccess:t?.environment?.agent_network_access,footer:e.jsx("div",{className:"block md:hidden",children:e.jsx(p,{taskId:a,assistantTurn:t,index:l})})})})},{key:"internal_rollout",isHidden:t?.internal_only_rollouts==null||!0,label:o.formatMessage({id:"wham.whamTaskPageContentLoaded.internalRollout",defaultMessage:"Internal Rollout"}),ariaLabel:o.formatMessage({id:"wham.whamTaskPageContentLoaded.internalRolloutAriaLabel",defaultMessage:"Tab to view the internal rollout information"}),children:e.jsx("div",{className:"flex h-full w-full overflow-auto p-4",children:e.jsx(F,{json:t?.internal_only_rollouts??void 0,jsonViewProps:{collapsed:5}})})}],children:[e.jsx(U,{withUnderline:!m,className:_("p-3 max-md:py-0",!m&&"border-b"),skipTabUnderlineAnimation:!0}),e.jsx(W,{children:({content:n})=>e.jsx("div",{className:"flex h-full w-full",children:n})})]},t?.id??a)}),g=e.jsxs("div",{className:"relative flex h-full w-full flex-col",children:[S,e.jsx(R,{className:"absolute end-3 top-0 md:top-3",icon:e.jsx(A,{}),label:o.formatMessage({id:"wham.whamTaskPageContentLoaded.close",defaultMessage:"Close"}),onClick:r})]});return e.jsx(T,{testId:`modal-speculative-task-content-${t.id}`,isOpen:i,visuallyHiddenHeader:!0,size:"custom",className:"h-full w-full",contentClassName:"h-screen",noPadding:!0,onClose:r,onEscapeKeyDown:n=>{n.preventDefault(),n.stopPropagation(),r()},showCloseButton:!0,children:e.jsx("div",{className:"bg-token-bg-tertiary flex h-full w-full",children:m?e.jsx(z,{leftContent:h,rightContent:g}):g})})}function K({taskId:a,suggestion:s,index:l,assistantTurn:t,showFullDiff:i}){return e.jsxs("div",{className:"flex h-full w-full flex-col",children:[e.jsx("span",{className:"p-6 text-sm font-medium",children:s.title}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6",children:e.jsx(q,{isLatest:!0,assistantTurns:[t],selectedAssistantId:t.id,focusedAssistantTurn:t,setFocusedAssistantTurnId:()=>{},onClickFile:()=>{},startOpen:!0,currentTab:void 0,onTabChange:()=>{},permissions:"read",flushHeaderSeparator:!0,showFullDiff:i},t.id)}),e.jsx(p,{taskId:a,assistantTurn:t,index:l})]})}function X({taskId:a,assistantTurn:s,index:l,diffFiles:t}){const i=t.length>0,{data:r}=J(),f=!k()||r?.git_diff_mode==="unified";return e.jsxs("div",{className:"flex h-full w-full flex-col",children:[i&&e.jsx("div",{className:"flex w-full flex-1 flex-col gap-6 overflow-y-auto px-6 pb-6",children:t.map(c=>e.jsx(B,{diff:c,stickyHeader:!0,viewType:f?"unified":"split",enableComments:!1,buttonClassName:"bg-token-bg-tertiary"},c.diffFile._newFileName))}),e.jsx("div",{className:"block md:hidden",children:e.jsx(p,{taskId:a,assistantTurn:s,index:l})})]})}function p({taskId:a,assistantTurn:s,index:l}){const t=C(),i=()=>{window.location.reload()},{mutate:r,isPending:d}=w({mutationFn:()=>(b.recordSpeculativeSuggestionRejected(a,s.id,l),v.safePost("/wham/tasks/{task_id}/speculative_turns/{task_turn_id}/reject",{parameters:{path:{task_id:a,task_turn_id:s.id}}})),onSuccess:i}),{mutate:f,isPending:c}=w({mutationFn:()=>(b.recordSpeculativeSuggestionAccepted(a,s.id,l),v.safePost("/wham/tasks/{task_id}/speculative_turns/{task_turn_id}/accept",{parameters:{path:{task_id:a,task_turn_id:s.id}}})),onSuccess:i}),o=d||c;return e.jsxs("div",{className:"flex w-full justify-center gap-3 py-10",children:[e.jsx(j,{color:"primary",onClick:()=>f(),disabled:o,loading:c,"aria-label":t.formatMessage({id:"wham.speculative.followUp.applyAriaLabel",defaultMessage:"Button to apply the speculative follow up suggestion"}),children:e.jsx(x,{id:"wham.speculative.followUp.apply",defaultMessage:"Apply"})}),e.jsx(j,{color:"secondary",onClick:()=>r(),disabled:o,loading:d,"aria-label":t.formatMessage({id:"wham.speculative.followUp.rejectAriaLabel",defaultMessage:"Button to reject the speculative follow up suggestion"}),children:e.jsx(x,{id:"wham.speculative.followUp.reject",defaultMessage:"Reject"})})]})}export{Ce as SpeculativeTaskContentModal};
//# sourceMappingURL=jk774k4ex9bn6otd.js.map
