import{lU as R,bV as S,gU as h,gV as f,R as C}from"./dmck639k4dv7claj.js";import{a as O}from"./bcan8xe3gkb6tcfp.js";import{O as b,a as E,r}from"./cs7toih8jegb7teq.js";async function U(p,t,e,s){const c=await C.safeGet("/connectors/{id}/oauth/callback",{parameters:{path:{id:p},query:{code:t,redirect_uri:e,state:s}}});return{...c,redirect_path:O(c.redirect_path).toString()}}const $=R(function(){const{pluginId:t}=b(),e=E(),s=r.useRef(!1),[c,g]=r.useState(""),{code:o,error:n,error_description:i,state:u}=Object.fromEntries(new URLSearchParams(c.substring(1)).entries());r.useEffect(()=>{g(window.location.hash)},[]),r.useEffect(()=>{if(s.current)return;if(t&&o&&u)s.current=!0;else{e("/");return}async function _(){const m=window.location.origin+`/ccc/${t}/oauth/callback`;if(!(!t||!o||!u))try{const a=await U(t,o,m,u);if(a.success){const l=new URL(h(f.OAUTH_SUCCESS,a.redirect_path),location.origin);l.searchParams.set("oauth_success","true"),e(l.pathname+l.search+l.hash)}else e(h(f.CUSTOM_ERROR,a.redirect_path,a.error??a.message))}catch{e(h(f.CUSTOM_ERROR))}}_()},[t,o,u,e]);const d=S();return r.useEffect(()=>{n&&d.danger(`${n}${i?`: ${i}`:""}`,{duration:5,toastId:"oauth_callback: CCCOauth",loggingTitle:n,loggingDescription:i??""})},[n,i,d]),null});export{$ as default};
//# sourceMappingURL=dmc54s6nr6c7r22z.js.map
