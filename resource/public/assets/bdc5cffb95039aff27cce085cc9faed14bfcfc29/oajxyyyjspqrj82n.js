import{r as l,am as J,b as Q,e as Z,j as i,A as ee,m as C}from"./cs7toih8jegb7teq.js";import{bw as _,gW as te,V as W,aF as H,T as w,h3 as se,aL as ae,nW as ne,fJ as oe,h_ as U,ee as ie,br as j,qL as re,bv as ce,lV as de}from"./dmck639k4dv7claj.js";import{l9 as le,la as V,lb as ue,C as v,lc as me,ld as he,jy as pe,le as fe,lf as ge,lg as xe,lh as Ce,l8 as ve,li as Te,lj as we,lk as Ie,ll as O,lm as G,l6 as be,u as ye,c$ as D,ln as L,lo as P,lp as Se,lq as Ee,lr as _e}from"./hnw079jsdm76umup.js";import{L as Ae}from"./de5hn4293vtnpm6c.js";import{T as Re}from"./c070u4alslgy7i5z.js";import{g as Ne}from"./btagl6w1gub4aw61.js";import"./jy1u8exw8iz2slve.js";import"./g61ghrdmm0y010eo.js";import"./cm813h9bptrniota.js";import"./zpmtm193hf9al87a.js";import"./ns51nblw8ziscsgd.js";import"./kwms1ugj73bjxgnk.js";import"./kl7c6054usfnqmd4.js";import"./mia7qmdupqoji40k.js";import"./dfaaf8463nahnfzk.js";import"./pe95y8sy3hzkar72.js";import"./n8303igkzlzv9639.js";import"./dtz2gnda2vx03dil.js";import"./gy64pge8qevmvg7e.js";import"./op8kqjb1v00a035k.js";import"./icwejktgx2db5g2x.js";import"./epuqxu07prihsdka.js";import"./nlxagrvvx9r77jf7.js";import"./gqxnaj28dwt74usv.js";import"./dfhgw8mxn1h3ecpw.js";import"./nxes2g8vblrs3vjj.js";import"./bk8slwxjkdlmxjxm.js";import"./na0t6wj09rfp0awn.js";import"./liqaqj2w179grtbv.js";import"./d0qctmhgeexj40hp.js";import"./mahhuo4zclh446vl.js";import"./l1m3l5lbmhuctzw6.js";import"./ljj1p3s92okaif60.js";import"./fq8kbeg5idktxg5a.js";const k="oai/apps/canmoreSidebarWidth",Me=.25,De=400,z=400;function q(e){return e-De}function S(e,a){return J(z,q(e),a??Me*e)}function Fe(){const e=_.useState(_.selectWindowWidth),a=S(e,te(W.DANGER_SECRET_FOLDERS_ONLY_getItem(k))),s=B(),[t,o]=l.useState(a);l.useEffect(()=>{(t<z||t>q(e))&&o(S(e,t))},[e]);function c(m){o(T=>S(e,T+=m.delta.x))}function n(m){o(m),W.DANGER_SECRET_FOLDERS_ONLY_setItem(k,m)}function r(){const m=S(e,void 0);n(m)}const d=`calc(100vw - ${t}px)`;return s?{chatWidth:t,canvasWidth:e-t,canvasWidthCalc:d,viewportWidth:e,handleDrag:c,handleDoubleClick:r,persist:n}:{chatWidth:0,canvasWidth:e,canvasWidthCalc:"100vw",viewportWidth:e,handleDrag:()=>{},handleDoubleClick:()=>{},persist:()=>{}}}function B(e){const a=_.useState(_.selectWindowWidth);return(e??a)>1e3}const M="sharedCanvas";function We(){const[e,a]=Q(),s=e.get(M),t=Z();l.useEffect(()=>{const o=s&&le.createRemixTempTextdoc(s,t);if(!o)return;requestAnimationFrame(()=>{V(o)});const c=new URLSearchParams(e);c.delete(M),a(c);const n=new URL(window.location.href);n.searchParams.delete(M),history.replaceState(null,"",n)},[s,e,a,t])}const je="textdocId",Oe=e=>{const s=new URLSearchParams(window.location.search).get(je),t=H(e,o=>w.findNode(o,({message:c})=>{const n=c.metadata?.canvas;return n?.create_source===ue.HIVE&&(s?n?.textdoc_id===s:!0)})?.message.metadata?.canvas?.textdoc_id);l.useEffect(()=>{t&&requestAnimationFrame(()=>{V(t)})},[t])};function Le(e,a){let s;return a?.type===v.Textdoc&&(a.textdocId.startsWith(me)||(s={type:"canvas_textdoc",id:a.textdocId})),he(e,{promptMessage:{metadata:{open_in_canvas_view:s}}})}const Y=({isFullScreen:e=!1,clientThreadId:a,focusedObject:s,onClose:t,isAnimating:o=!1,width:c})=>{const{setTargetedContent:n}=pe(),r=l.useRef(!1);if(l.useEffect(()=>(r.current&&n(void 0),r.current=!0,()=>{r.current=!1}),[s]),s==null)return null;switch(s.type){case v.Textdoc:return i.jsx(Re,{isFullScreen:e,onClose:t,clientThreadId:a,focusedTextdoc:s,isAnimating:o,width:c});case v.ADAVisualization:return null}},Pe=300,ke=e=>{switch(e?.type){case v.Textdoc:return e.textdocId;default:return null}};function He({clientThreadId:e,isDisabled:a,disabledTypes:s}){const[t,o,c,n,r]=H(e,u=>[w.getRequestId(u),w.getConversationLastTurn(u),w.isMessageTurnEnded(u),w.getVariantIds(u).length>1,w.lastUserMessage(u)],{disablePerfDetector:!0}),d=se(t),m=fe(),[T,p]=l.useMemo(()=>{if(o&&n)return[void 0,null];if(a===!0)return[void 0,null];if(r!=null){const h=ge(r);if(h)return[r.id,{type:v.Textdoc,textdocId:h}]}let u;return!c&&o&&(u=ae(o.messageGroups,h=>h.type!==ne)),Ue({groupedMessage:u,isRequestActive:d,latestTextdocId:m,disabledTypes:s})},[c,o,n,a,d,m,s,r]),I=p!=null,A=ke(p),R=xe("canvas");l.useEffect(()=>{if(p&&T&&!oe()&&(R(),Ce(p,T),p.type===v.Textdoc)){const{textdocId:u}=p,h=Ne(u);ve(document.getElementById(h))}},[I,A])}function Ue({groupedMessage:e,isRequestActive:a,latestTextdocId:s,disabledTypes:t}){if(e?.type&&t.includes(e.type))return[void 0,null];switch(e?.type){case U.Canmore:{const[o,c]=e.messages;if(!Te(o))break;const n=we(a,o,c??null),r=n.textdocId??s;if(r&&(n.function===Ie.CreateTextdoc?(n.content??"").length>Pe||n.status===O.WAITING:n.status===O.STREAMING))return[n.messageId,{type:v.Textdoc,textdocId:r}];break}}return[void 0,null]}const E={type:"spring",bounce:.12,duration:.64},Ve={type:"spring",bounce:0,duration:.58},x={duration:0},Ge=({clientThreadId:e,focusedObject:a,onClose:s})=>{const{chatWidth:t,canvasWidthCalc:o,handleDrag:c,handleDoubleClick:n,persist:r}=Fe(),d=D(),[m,T]=l.useState(!d),[p,I]=l.useState(!1),A=d?x:E,R=d?x:Ve,u=Se(({rect:f})=>f),{windowHeight:h,windowWidth:b}=ce(f=>f,{windowWidth:0,windowHeight:0});let g=u??{top:0,left:t,width:b-t,height:h},F=!1;if(u&&(g.top<0||g.top+g.height>h)){F=!0;const f={width:(b-t)*.75,height:h*.75};g={top:h/2-f.height/2,left:(b-t-f.width)/2+t,width:f.width,height:f.height}}const y=u?.borderRadius,N=Ee(),K=N?.history!=null||N?.showChangesAtVersion!=null,X=de();return i.jsxs(i.Fragment,{children:[K&&i.jsx(Ae,{onClick:()=>_e(N.textdocId),zIndexKey:"chatOverlay"}),i.jsxs(C.div,{initial:{marginInlineEnd:X?-260:0},animate:{marginInlineEnd:0},transition:R,children:[i.jsx(C.div,{initial:{opacity:1},animate:{opacity:0},exit:{opacity:[1,0]},transition:d?x:{...E,delay:.22},className:"bg-token-main-surface-primary pointer-events-none absolute start-0 top-0 z-20 h-full w-full"}),i.jsx(C.div,{className:"relative z-20 h-full",style:{width:o},exit:{width:0},transition:d?x:{type:"spring",bounce:0,duration:.1}})]}),i.jsx(C.div,{className:"bg-token-bg-primary absolute start-0 z-20 h-full overflow-hidden shadow-[0_0_18px_rgba(0,0,0,0.12)] dark:shadow-[0_0_18px_rgba(0,0,0,0.48)]",initial:{borderRadius:y,opacity:F?0:1,x:g.left,y:g.top,height:g.height,width:g.width},animate:{opacity:1,x:t,y:0,width:o,height:h,borderRadius:0},exit:{scale:.64,opacity:0,filter:"blur(12px)",transition:d?x:{opacity:{duration:.14,bounce:.1}},borderRadius:y},transition:p||d?x:E,onAnimationComplete:()=>T(!1),children:i.jsx(C.div,{className:"dark:border-token-border-light border-token-border-medium h-full overflow-hidden border-s",initial:{borderRadius:y},animate:{borderRadius:0},exit:{borderRadius:y},transition:A,children:i.jsxs("div",{className:"h-full",children:[i.jsx(C.div,{drag:"x",className:"bg-token-text-quaternary absolute start-[-2px] z-10 h-full w-[4px] cursor-ew-resize opacity-0",whileHover:{opacity:.5},whileDrag:{opacity:.75,width:"8px",left:"-4px"},transition:d?x:{type:"tween",duration:.1},style:{x:0,y:0,transform:"translateX(0px)"},dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:{left:0,right:0,top:0,bottom:0},onPointerDown:()=>I(!0),onPointerUp:()=>I(!1),onDrag:(f,$)=>c($),onDragEnd:()=>{I(!1),r(t)},onDoubleClick:()=>n()}),p&&i.jsx("div",{className:"absolute inset-0 z-10"}),i.jsx(Y,{onClose:s,clientThreadId:e,isAnimating:!d&&m,focusedObject:a,width:b-t})]})})})]})},ze=l.memo(Ge),qe=({clientThreadId:e,focusedObject:a,onClose:s})=>{const t=D();return i.jsx(re,{open:!0,className:"fixed inset-0 z-50 h-full w-full",children:i.jsx(C.div,{className:"z-40 h-full w-full overflow-hidden shadow-xl md:border-gray-100 md:dark:border-gray-700",initial:{scale:.98},animate:{scale:1},transition:t?x:E,children:i.jsx(Y,{isFullScreen:!0,clientThreadId:e,focusedObject:a,onClose:s})})})},Be=({clientThreadId:e,overrideWidth:a,isAutoFocusDisabled:s=!1})=>{const t=ye(),o=B(a),c=D();He({clientThreadId:e,isDisabled:s,disabledTypes:c?[U.Canmore]:[]}),We(),Oe(e);const n=l.useRef(!1);l.useEffect(()=>{n.current?G():n.current=!0},[e]);const r=t&&(o?i.jsx(ze,{clientThreadId:e,onClose:P,focusedObject:t},"canvas-sidebar"):i.jsx(qe,{clientThreadId:e,onClose:P,focusedObject:t},"canvas-modal"));l.useEffect(()=>{if(t)return L(m=>Le(m,t)),()=>L(null)},[t]);const d=r!=null;return l.useEffect(()=>(j.setActiveStageSidebar(d),()=>{d&&j.setActiveStageSidebar(!1)}),[d]),c?r:i.jsx(ee,{children:r},e)},_t=e=>{const a=l.useRef(null);return i.jsx(ie,{ref:a,onError:(s,t)=>{G(),setTimeout(()=>{a.current?.resetErrorBoundary()}),be.logError("Error boundary hit",s,{componentStack:t})},name:"canmore-focused-view",children:i.jsx(Be,{...e})})};export{_t as CanvasFocusedViewManager};
//# sourceMappingURL=oajxyyyjspqrj82n.js.map
