const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/fzpqiqufpsm289jo.js","assets/l6lryjpkt8rv0lpy.js","assets/cal7wpbc1bdlnwfh.js","assets/mnkup87aq6tfilq5.js","assets/root-lwz5toux.css","assets/bj9d14lm2vt5tl41.js","assets/dvllb5fed1b4y7k1.js","assets/conversation-small-ga20ijz2.css","assets/dssqb33wed4i78fb.js","assets/cbms2jcglp4b707f.js","assets/1e3kywkhcjn5spyo.js","assets/gdfo3ssr4wtmu0zr.js","assets/gldfucpsw1kp2i7m.js","assets/lt5e1h6sol447h24.js","assets/d5w25xgxcglldc4u.js","assets/lucbyjmrypsebwwd.js","assets/mlpy7pekkz4vj5ih.js","assets/eivflkxhgemu4u0k.js","assets/mhw2wjge8ypdrzdr.js","assets/m1wuuk5evqjakuq1.js","assets/ho2y7kcwhu81ia5j.js","assets/nxg0mr2frwehg6na.js","assets/4wfwbvmzqu7tbfmg.js","assets/jnjzqafy9dn7o7ce.js","assets/jfsira8wttdjvr2l.js","assets/v3p6blfrrdmvstxq.js","assets/lyd95dn7bnbdrbqw.js","assets/f1dy6s5rgmlk5jz4.js","assets/c2aqrtizhx0h7af2.js","assets/lj8vn5ziwxf900b0.js","assets/jp7faoq86x90e5wt.js","assets/gffbkcdjbbbnp8kb.js","assets/mjk2tmzbeggshn4d.js","assets/kz4w238t2tuvnfm1.js","assets/chwpaxfxk9st7eq2.js","assets/jm8zus0mi88xmv2y.js","assets/b4zl6usbni9k59c7.js","assets/hklpkipqhzi68oi6.js","assets/i822scwyjyzhmdym.js","assets/h4jw8c63q447uotc.js","assets/fzmi0zkr0dvmhwns.js","assets/no74ca53mzecj421.js","assets/o8w0b09azms3av0p.js","assets/cu56xogs1b4sjtcp.js","assets/jse5gib798yh273j.js","assets/FormattedText-jylmsdb6.css","assets/ffxduo863rikjmz1.js","assets/cot-message-bxmx4p0i.css","assets/f7kcplevtek6bok0.js","assets/cj02dauuftw44t5d.js","assets/jo193ziz36hqdgh1.js","assets/g0y3jk4ws9sr9t5q.js","assets/c0exwobgz2x0o6pg.js"])))=>i.map(i=>d[i]);
import{c6 as ve,U,s as z,ak as Te,d5 as je,fo as Ce,W as be,T as de,r as le,a as Q,F as ke,aG as me,c2 as Ie,d as w,bP as ue,E as Ae,bC as q,eU as Ne,n as ge,Q as we,bT as K,fp as Le,ac as J,P as De,c7 as Re,bh as fe,gW as X,ej as Fe,ek as Oe,bO as Pe,e6 as Ve,eg as He,e5 as Be,ap as xe,D as Ue,gr as We,bl as C,bm as I,ea as ze,ex as Je}from"./mnkup87aq6tfilq5.js";import{j as s,M as k,a as he,c as Y,r as x,aw as $,au as B}from"./l6lryjpkt8rv0lpy.js";import{ka as qe,iw as Ye,dy as pe,kb as Ke,kc as Qe,im as Xe,io as $e,ih as Ge,kd as Ze,ds as es,ke as ss,kf as ts,kg as as,kh as ns,ki as os,kj as is,iH as rs,iq as S,ik as Ee,ip as V,kk as ee,kl as W,ie as se,km as cs,kn as ds,ko as ls,kp as ms,kq as us,dv as gs,dw as fs,c4 as xs,kr as hs,ks as ps,kt as P,ei as Es,ku as G,kv as Ss,kw as _s,kx as ys,ky as Ms,kz as vs,kA as te,kB as Ts,kC as js,kD as Cs,aJ as bs,aI as ks,aj as Is,F as As,eg as Ns,hc as ws,kE as Ls,kF as Ds,cD as r,k4 as Rs,jj as Fs,kG as Os,kH as Ps,kI as Vs,eY as Hs,kJ as Bs,hp as Us,kK as Ws,kL as zs,kM as Js,kN as qs,kO as Ys,fS as Ks}from"./dvllb5fed1b4y7k1.js";import{c as Qs,T as H}from"./dssqb33wed4i78fb.js";import{u as Xs,a as $s}from"./d5w25xgxcglldc4u.js";import{a as Gs,u as Zs}from"./1e3kywkhcjn5spyo.js";import{u as et}from"./cbms2jcglp4b707f.js";import{N as st}from"./nxg0mr2frwehg6na.js";import{g as tt}from"./4wfwbvmzqu7tbfmg.js";const at=e=>{for(const a of e.concat().reverse()){if("messages"in a)return a.messages[a.messages.length-1].nodeId;if("message"in a)return a.message.nodeId}},nt=(e,a)=>{const[t,n,c]=U(e,p=>[z.getRequestId(p),Te(p?.mode),z.getLastMessageSystemHints(p).includes(je.CANVAS)]),i=Xs({clientThreadId:e,conversationMode:n}),m=qe(e),u=he(),o=Ce(),g=be(t),l=at(a),f=a.some(p=>"messages"in p&&p.messages.some(_=>_.message.metadata?.canvas?.canvas_opt_in));return{isVisible:!c&&!m&&!f&&!!l,onClick:async p=>{if(!l)return;p.stopPropagation(),Ye();const _=[de.CANMORE];g&&await Qs({clientThreadId:e,currentRequestId:t,queryClient:u,isHistoryAndTrainingDisabled:o}),requestAnimationFrame(()=>i({id:l,systemMessage:"The user has requested the canvas tool be disabled for this conversation. You should not call the tool again.",systemMessageMetadata:{disable_tool_ids:_}}));const T=z.getTree(le(e)),A=T.getConversationTurns(l,!1).length,N=T.getParentPromptNode(l).message.id;pe.logEventWithStatsig(Q.canvasOptOutClicked,"chatgpt_canvas_opt_out_clicked",{num_turns:String(A),conversation_id:ke(e),message_id:N}),me(e,j=>{j.disabledToolIds=_})}}},ot=({clientThreadId:e,groupedMessages:a})=>{const{isVisible:t,onClick:n}=nt(e,a);return t?s.jsx("button",{onClick:n,className:"mb-2 w-full text-token-text-secondary hover:text-token-text-primary",children:s.jsxs("div",{className:"flex items-center rounded-xl",children:[s.jsx(k,{id:"aa5Dyk",defaultMessage:"Answer in chat instead"}),s.jsx(ve,{className:"icon-md text-token-text-secondary"})]})}):null},it=(e,a)=>e?.textdocId?e.textdocId:e?.function===V.CreateTextdoc?ds(e.messageId):a??void 0,rt=({messages:e,isRequestActive:a,isFinalTurn:t,allGroupedMessages:n,clientThreadId:c})=>{const i=Y(),m=Ke(e),u=Qe(e),o=x.useMemo(()=>{if(Xe(m?.message))return $e(a,m.message,u?.message??null)},[a,m,u]),g=Ge(),l=it(o,g),f=Ze(l),h=es(),p=ss(l),_=ts(),T=as(),A=ns(),N=os(),j=is({textdocId:l,assistantMessage:m}),L=rs(()=>{const v=le(c)?.modelId;pe.logError("Textdoc missing from conversation",null,{clientThreadId:c,modelId:v,textdocId:l,latestTextdocId:g,toolCallTextdocId:o?.textdocId,toolCallStatus:o?.status,toolCallFunction:o?.function})});x.useEffect(()=>{!a&&o?.status===S.COMPLETE&&!N&&!f&&L()},[o,f,a,N,L]);const M=Ee("canvas");if(!o)return null;const D=o.status===S.REDACTED||!N&&!f&&o.status!==S.STREAMING&&o.status!==S.WAITING;let F,O;if(o.status!==S.REDACTED&&o.status!==S.FAILED&&!D&&l){const v=o.function===V.UpdateTextdoc&&o.status===S.COMPLETE;F=()=>{M(),v&&o.versionInt?ls(l,o.versionInt,_):se(l)},O=()=>{v&&o.versionInt&&A(l,o.versionInt)}}const d=ct(o,f);if(o.function===V.CreateTextdoc){if(o.status===S.STREAMING||o.status===S.WAITING||o.status===S.COMPLETE){const R=N===!0&&(o.status===S.STREAMING||o.status===S.WAITING);return s.jsxs(s.Fragment,{children:[s.jsx(ee,{textdocId:l,name:d,tag:o.type,icon:W(o.type,!1),iconSelected:W(o.type,!0),isCanvasOpen:h,isInlinePreview:j,isFetching:R,isFocused:p,isStreaming:o.status===S.STREAMING,onClick:F}),t&&s.jsx(ot,{clientThreadId:c,groupedMessages:n})]})}let v;switch(o.status){case S.FAILED:v=i.formatMessage({id:"SNarKX",defaultMessage:"Failed to generate"});break;case S.CANCELED:v=i.formatMessage({id:"1A6W36",defaultMessage:"Stopped generating"});break;case S.REDACTED:v=s.jsx(Ie,{align:"start",label:i.formatMessage({id:"F6q1k7",defaultMessage:"Removed from shared conversation"}),children:i.formatMessage({id:"BqyYDu",defaultMessage:"Created document"})});break}return s.jsx(ae,{children:v})}const E=D||o.status===S.REDACTED,b=T&&!E?d:null,y=s.jsx(ae,{onClick:F,onMouseOver:O,isStreaming:o.status===S.STREAMING,children:o.function===V.CommentTextdoc?lt(i,o,b):dt(i,o,b)});return j&&!h&&!D&&l?s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx(ee,{textdocId:l,name:d,tag:f?.type,icon:W(f?.type,!1),iconSelected:W(f?.type,!0),isCanvasOpen:h,isFetching:!1,isFocused:p,isInlinePreview:!0,isStreaming:o.status===S.STREAMING,onClick:l!=null?()=>{M(),se(l)}:void 0}),y]}):y};function ct(e,a){return a?.title?a.title:e.function===V.CreateTextdoc&&e.title?cs(e.title):null}const ae=({isStreaming:e=!1,onClick:a,onMouseOver:t,children:n})=>s.jsx("button",{disabled:!a,className:w(e&&"loading-shimmer","flex min-h-5 w-fit select-none pt-[3px] text-start text-token-text-secondary",a&&"hover:text-token-text-primary"),onClick:a,onMouseOver:t,children:n}),Se=9;function dt(e,a,t){if(a.status===S.STREAMING)return t?e.formatMessage({id:"W2xN1Z",defaultMessage:"Editing {documentTitle}"},{documentTitle:t}):e.formatMessage({id:"8taq8v",defaultMessage:"Editing"});if(a.status===S.FAILED)return t?e.formatMessage({id:"UjJKYZ",defaultMessage:"Failed to edit {documentTitle}"},{documentTitle:t}):e.formatMessage({id:"kWUVkg",defaultMessage:"Failed to edit"});if(a.status===S.CANCELED)return t?e.formatMessage({id:"TmSrCd",defaultMessage:"Stopped editing {documentTitle}"},{documentTitle:t}):e.formatMessage({id:"bYV7xA",defaultMessage:"Stopped editing"});const n=a.updates?.length;return a.status===S.REDACTED||!n||n>Se?t?e.formatMessage({id:"n+G/ct",defaultMessage:"Edited {documentTitle}"},{documentTitle:t}):e.formatMessage({id:"aegqpL",defaultMessage:"Edited"}):t?e.formatMessage({id:"osYMSb",defaultMessage:"{numEdits, plural, one {Edited {documentTitle}} other {Made {numEdits} edits to {documentTitle}}}"},{numEdits:n,documentTitle:t}):e.formatMessage({id:"xJD3WR",defaultMessage:"{numEdits, plural, one {Edited} other {Made {numEdits} edits}}"},{numEdits:n})}function lt(e,a,t){if(a.status===S.STREAMING)return t?e.formatMessage({id:"8xQH/P",defaultMessage:"Commenting on {documentTitle}"},{documentTitle:t}):e.formatMessage({id:"5yqLeN",defaultMessage:"Commenting"});if(a.status===S.FAILED)return t?e.formatMessage({id:"Rl821S",defaultMessage:"Failed to comment on {documentTitle}"},{documentTitle:t}):e.formatMessage({id:"W007jt",defaultMessage:"Failed to comment"});if(a.status===S.CANCELED)return t?e.formatMessage({id:"bozPdq",defaultMessage:"Stopped commenting on {documentTitle}"},{documentTitle:t}):e.formatMessage({id:"hyBGa7",defaultMessage:"Stopped commenting"});const n=a.comments?.length;return a.status===S.REDACTED||!n||n>Se?t?e.formatMessage({id:"LXEzK7",defaultMessage:"Commented on {documentTitle}"},{documentTitle:t}):e.formatMessage({id:"KeMYhy",defaultMessage:"Commented"}):t?e.formatMessage({id:"Ql5lPq",defaultMessage:"{numComments, plural, one {Commented on {documentTitle}} other {Added {numComments} comments on {documentTitle}}}"},{numComments:n,documentTitle:t}):e.formatMessage({id:"FHtyJQ",defaultMessage:"{numComments, plural, one {Commented} other {Added {numComments} comments}}"},{numComments:n})}const mt={div:e=>{const{node:a,children:t,...n}=e;return s.jsx("div",{...n,className:"text-red-500",children:t})},p:e=>{const{node:a,children:t,...n}=e;return s.jsx("p",{...n,className:"text-start leading-6 text-token-text-primary",children:t})},a:e=>{const{node:a,children:t,...n}=e;return s.jsx("a",{...n,className:"font-sm leading-6 !text-token-text-primary",children:t})}},ut=1e3*60*2,gt=15;function _e({onClick:e,statusMessage:a,showSources:t,includeMargin:n,sources:c,progressBar:i}){const m=ue();return s.jsx("button",{onClick:()=>m&&e(),className:w("mt-4 flex w-4/5 max-w-[416px] items-start justify-start gap-[18px] rounded-2xl border border-black/10 bg-token-main-surface-primary px-5 py-4 shadow dark:border-white/10",m?"cursor-pointer hover:bg-token-main-surface-secondary":"cursor-auto"),children:s.jsxs("div",{className:"flex w-full flex-col gap-3",children:[s.jsxs("div",{className:w("flex flex-col items-start justify-start self-stretch md:h-7 md:flex-row md:items-center md:justify-between",t?"h-12":"h-6"),children:[s.jsx("div",{className:w("font-sm w-full flex-1 truncate text-start leading-7 text-token-text-primary md:w-0",n&&"mr-[30px]"),children:a}),t&&c]}),s.jsx("div",{className:"flex w-full items-center justify-start gap-4 self-stretch pb-2",children:i})]})})}function Z({toggleSidebar:e,openSidebar:a,startTime:t}){const n=Y(),[c,i]=x.useState(!1),m=ms();return x.useEffect(()=>{if(!t)return;const u=Date.now()-t,o=ut-u;if(o>0){const g=setTimeout(()=>{i(!0),a()},o);return()=>clearTimeout(g)}else i(!0),a()},[t,a]),s.jsx(_e,{onClick:e,statusMessage:c?n.formatMessage({id:"T2SbxC",defaultMessage:"Waiting…"}):s.jsx("div",{className:"text-pretty text-sm font-medium text-token-text-primary",children:m.startingMessage}),progressBar:s.jsx(us,{className:"h-2 w-full"}),showSources:!1})}function ft(e,a,t){const n=e.formatMessage({id:"Bs+OcV",defaultMessage:"Thinking…"});if(a.length<2)return t?.initial??n;const c=a[a.length-2];if(c.type==="summary")return c.title;if(c.type==="search")return c.query;if(c?.type==="websiteOpen")return s.jsx(xs,{componentOverrides:mt,children:c.active_row_text})}function xt({task:e,clientThreadId:a,caterpillarRows:t,messageWithTaskMetadata:n,totalSources:c,handleToggleCaterpillarSidebar:i}){const m=Y(),u=ue(),o=ft(m,t,n.metadata?.async_task_status_messages),g=(e?.expectedDurationMinutes??gt)*60*1e3,l=gs(t[1]?.created_at?t[1].created_at*1e3:Date.now(),g),f=t[1]&&t[1].created_at?l:0;x.useEffect(()=>{me(a,_=>{_.async_status=Ae.STREAMING})},[a]);const{openThreadSidebar:h}=q();x.useEffect(()=>{t.length===2&&u&&h({type:"caterpillar",caterpillarId:e.taskId,initialTab:"activity",clientThreadId:a})},[t.length,h,e.taskId,a,u]);const p=x.useCallback(()=>{h({type:"caterpillar",caterpillarId:e.taskId,initialTab:"activity",clientThreadId:a})},[h,e.taskId,a]);return t.length<=1?s.jsx(Z,{toggleSidebar:()=>i("activity"),openSidebar:p,startTime:new Date(e.createdAt).getTime()}):s.jsx(_e,{onClick:()=>i("activity"),statusMessage:o,showSources:!0,includeMargin:c>0,sources:c===0?s.jsx("div",{className:"text-pretty text-sm text-token-text-tertiary",children:s.jsx(k,{id:"zfwUjs",defaultMessage:"Looking for sources…"})}):s.jsxs("button",{onClick:_=>{_.stopPropagation(),i("sources")},className:w("flex shrink-0 gap-1 text-[13px] leading-[18px] text-[#0285ff]",u?"cursor-pointer hover:text-[#0285ff]/80":"cursor-auto"),children:[s.jsx("div",{className:"relative",children:s.jsx($,{initial:!1,children:s.jsx(B.span,{initial:{opacity:0,rotateX:-90,translateY:20},animate:{opacity:1,rotateX:0,translateY:0},exit:{opacity:0,rotateX:90,translateY:-20},transition:{duration:.35},className:"absolute left-0 md:right-0",children:c},c)})}),s.jsx("div",{className:w("md:pr-0",c>0&&"pl-2",c>9&&"pl-[14px]",c>99&&"pl-[22px]"),children:c>1?s.jsx(k,{id:"zN+MuO",defaultMessage:" sources"}):s.jsx(k,{id:"dMowmJ",defaultMessage:" source"})})]}),progressBar:s.jsx("div",{className:"flex h-2 shrink grow basis-0 items-start justify-start gap-2.5 overflow-hidden rounded-[10px] bg-token-main-surface-tertiary",children:s.jsx(fs,{percentage:f,barClassName:"bg-token-text-primary",backgroundClassName:"bg-token-main-surface-tertiary"})})})}function ne({task:e,clientThreadId:a,messageWithTaskMetadata:t,totalSources:n,handleToggleCaterpillarSidebar:c}){const i=hs(e),m=!1,u=U(a,g=>ps(g,e?.taskId)),{clearSystemHintModeTrigger:o}=Gs();return x.useEffect(()=>{e?.status===P.COMPLETED&&!u&&!m&&(i(),o(Es.Research))},[e?.status,m,u,i,o]),s.jsx(G,{message:s.jsxs(s.Fragment,{children:[t.metadata?.async_task_status_messages?.completed_with_time??t.metadata?.async_task_status_messages?.completed_no_time??s.jsx(k,{id:"4d0xZc",defaultMessage:"Completed"}),n===0?s.jsx(k,{id:"VggF2B",defaultMessage:" · 0 sources"}):n===1?s.jsx(k,{id:"zkkdKV",defaultMessage:" · 1 source"}):s.jsx(k,{id:"qcKt3q",defaultMessage:" · {sourcesCount} sources",values:{sourcesCount:n}})]}),handleToggleCaterpillarSidebar:()=>c("activity")})}function ht({messages:e,clientThreadId:a}){const t=e.find(g=>g.message.metadata?.b1de6e2_s&&g.message.metadata?.async_task_id)?.message,n=t?.metadata?.async_task_id,c=e.find(g=>g.message.recipient===de.START_RESEARCH_TASK),i=U(a,g=>Ss(g,c?.message.id)),m=Ne({clientThreadId:a}),[u,o]=x.useState(m);return x.useEffect(()=>{const g=setTimeout(()=>{o(i&&m)},3e3);return()=>clearTimeout(g)},[m,i]),!t||!n?u?s.jsx(Z,{toggleSidebar:()=>{},openSidebar:()=>{},startTime:new Date().getTime()}):null:s.jsx(pt,{clientThreadId:a,payloadTaskId:n,messageWithTaskMetadata:t})}function pt({payloadTaskId:e,messageWithTaskMetadata:a,clientThreadId:t}){_s(e,a,t);const n=ys(f=>e?f.tasks[e]:null),c=Y(),i=n?.status,m=x.useMemo(()=>n?.rows?n.rows:[],[n?.rows]),{toggleThreadSidebar:u}=q(),{totalSources:o}=x.useMemo(()=>{if(!m)return{uniqueSources:[],totalSources:0};const f=Ms(m),h=f.reduce((p,_)=>p+_.count,0);return{uniqueSources:f,totalSources:h}},[m]),g=Ee("caterpillar"),l=x.useCallback(f=>{e&&u({type:"caterpillar",caterpillarId:e,initialTab:f,clientThreadId:t},g)},[u,e,g,t]);return vs(e),a.metadata?.async_task_status_messages?.completed_with_time?s.jsx(ne,{task:n,clientThreadId:t,messageWithTaskMetadata:a,totalSources:o,handleToggleCaterpillarSidebar:l}):!n||!i||i===P.UNDETERMINED?s.jsx(Z,{toggleSidebar:()=>{},openSidebar:()=>{},startTime:new Date().getTime()}):n.status===P.COMPLETED?s.jsx(ne,{task:n,clientThreadId:t,messageWithTaskMetadata:a,totalSources:o,handleToggleCaterpillarSidebar:l}):n.status===P.FAILED?s.jsx(G,{message:a.metadata?.async_task_status_messages?.error??c.formatMessage({id:"at6zk8",defaultMessage:"Failed to think"}),handleToggleCaterpillarSidebar:()=>l("activity")}):n.status===P.CANCELLED?s.jsx(G,{message:a.metadata?.async_task_status_messages?.cancelled??c.formatMessage({id:"u1rIr5",defaultMessage:"Task Cancelled"}),handleToggleCaterpillarSidebar:()=>l("activity")}):s.jsx(xt,{task:n,clientThreadId:t,caterpillarRows:m,messageWithTaskMetadata:a,totalSources:o,handleToggleCaterpillarSidebar:l})}function Et(e,a,t){const n=a.elements.length;if(n===0)return;const c=Object.entries(e).reduce((i,[m,u])=>Array.isArray(u)?u.length>0?i+1:i:u!==""?i+1:i,0);De.logEventWithStatsig("dynamic-form-submission","chatgpt_dyanmic_form_submission",{...Re({clientThreadId:t}),totalItems:n.toString(),completedItems:c.toString(),ratio:(c/n).toString()})}function St(e,a){let t="";return a.elements.forEach(n=>{const c=n.scope.split("/").pop(),i=c&&e[c],m=i?Array.isArray(i)?i.join(", "):i:"Any",u=n.label??c;t+=`${u}: ${m}
`}),t}function _t({messages:e,clientThreadId:a,isLastMessage:t}){const n=e.find(M=>M.message.author.role===ge.Assistant),c=e.find(M=>M.message.metadata?.json_form),i=c?.message.metadata?.json_form,[m,u]=x.useState({}),[o,g]=x.useState(),[l,f]=x.useState(),h=Zs(),p=et({clientThreadId:a});x.useEffect(()=>{i&&(g(i.json_form_ui),f(i.json_form_data))},[i]);const _=x.useCallback(()=>{if(u({}),o){const M={...o,elements:o.elements.filter(D=>D.scope!=="#/properties/AdditionalInfo")};g(M)}l&&(delete l.properties.AdditionalInfo,f(l))},[u,g,f,o,l]),T=x.useCallback(()=>{if(o){const M={...o,elements:[...o.elements,{type:"Control",scope:"#/properties/AdditionalInfo",label:"Additional Info",placeholder:"Any other details..."}]};g(M)}if(l){const M={...l.properties,AdditionalInfo:{type:"string"}};f({...l,properties:M})}},[g,f,o,l]),A=o?.elements.some(M=>M.scope.endsWith("#/properties/AdditionalInfo")),N=we.getThreadCurrentLeafId(a),j=c?.nodeId!==N;if(!c||!l||!o)return n?.message.status==="in_progress"&&t?s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx(te,{className:"h-[26px] w-full"}),s.jsx(te,{className:"h-[26px] w-3/4"}),s.jsx(Ts,{})]}):null;if(j)return null;const L=async()=>{const M=St(m,o);Et(m,o,a),p({promptMessage:Le(M),completionMetadata:{systemHints:[...h],conversationMode:{kind:J.PrimaryAssistant}}})};return s.jsxs(js,{children:[s.jsx(yt,{formData:m,dataSchema:l,uiSchema:o,setData:u,readOnly:j}),s.jsxs("div",{className:"flex w-full justify-between",children:[A?s.jsx("div",{}):s.jsx(K,{disabled:j,onClick:T,color:"secondary",className:"text-token-text-secondary",children:s.jsx(k,{id:"Sen69P",defaultMessage:"Add a detail"})}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(K,{disabled:j,onClick:_,color:"secondary",className:"text-token-text-secondary",children:s.jsx(k,{id:"Uqo7UD",defaultMessage:"Reset"})}),s.jsx(K,{disabled:j,onClick:L,children:s.jsx(k,{id:"FVou++",defaultMessage:"Start"})})]})]})]})}function yt({dataSchema:e,uiSchema:a,setData:t,readOnly:n,formData:c}){return s.jsx("div",{children:s.jsx(Cs,{formData:c,readOnly:n,schema:e,uiSchema:a,onChange:i=>t(i)})})}const oe=fe.div`group left-0 top-0 mr-1.5 overflow-hidden mt-1 text-start`,Mt=({highlightedCommand:e,status:a,children:t,showWorkUserSetting:n=!1,hideOnlyIfNotInteractedWith:c=!1,defaultExpanded:i=!1,onOpenAnalytics:m,onClick:u,...o},g)=>{const l=t!=null||u!=null,[f]=x.useState(n),[h,p]=x.useState(n||i),[_,T]=x.useState(!1),A=a===H.Finished||a===H.Error,N=c?f?!1:!_:!1,j=a===H.Running&&"loading-shimmer";return A&&N?null:l?s.jsxs(s.Fragment,{children:[s.jsx(ie,{ref:g,$canShowWork:!0,...o,children:s.jsx($,{children:s.jsx(oe,{children:s.jsx(B.button,{onClick:L=>{h||m?.(),p(M=>!M),T(!0),u?.(L)},initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:w(j),children:s.jsxs("div",{className:"flex items-center justify-start gap-1",children:[s.jsx("span",{className:"text-start",children:e}),!u&&(h?s.jsx(bs,{className:"icon-md"}):s.jsx(ks,{className:"icon-md"}))]})},e?.toString())})})}),s.jsx($,{children:h&&t&&s.jsx(B.div,{initial:"collapsed",animate:"reveal",exit:"collapsed",variants:{collapsed:{translateY:-20,opacity:0,height:0},reveal:{translateY:0,opacity:1,height:"auto"}},transition:{duration:.3,ease:"easeInOut"},className:"overflow-hidden",children:t})})]}):s.jsx(ie,{ref:g,$canShowWork:!1,...o,children:s.jsx(oe,{className:w(j),children:e})})},ie=fe.span`block first:mt-0 relative
${({$canShowWork:e})=>e?"text-token-text-secondary hover:text-token-text-primary my-1.5":"text-token-text-secondary"}`,vt=x.forwardRef(Mt),Tt=3,jt=.1,re=[0,.26,.4];function Ct({nextMessage:e,isLastMessage:a,isRequestActive:t,isLastTurnInConversation:n,clientThreadId:c,turnIndex:i}){let m=a||!e||e&&!X(e.message);const u=x.useRef(!1),o=he(),g=U(c,z.getGizmoId);x.useEffect(()=>{e&&X(e.message)&&!u.current&&(u.current=!0,Is(o,g))},[e,o,g]);const l=Fe(e?.message),f=Oe(e?.message);e?.message.id&&tt(e?.message.id);const h=[];if(f?.[0]?.type==="navigation"&&e&&h.push(s.jsx(bt,{clientThreadId:c,turnIndex:i,nextMessage:e,isRequestActive:t,isLastTurnInConversation:n,navigationCitation:f[0]},"fast-nav")),m){const p=Pe(l.slice(0,Tt).map(T=>T.entries[0].url)),_=t?s.jsxs("div",{className:"flex items-center gap-1",children:[p.map((T,A)=>s.jsx(B.div,{className:w("-ml-1.5 first:ml-0 last:mr-1.5","relative"),initial:{width:A===0?0:6,opacity:0},animate:{width:20,opacity:1},transition:{duration:jt,delay:re[Math.min(A,re.length-1)]},children:s.jsx("div",{className:w("flex h-[22px] w-[22px] items-center overflow-hidden rounded-full","border-2 border-token-main-surface-primary bg-token-main-surface-primary"),children:s.jsx(As,{url:T,size:32,minSize:16,className:"icon-md rounded-full"})})},T)),s.jsx(k,{id:"jjx8Qg",defaultMessage:"Searching the web"})]}):s.jsx(k,{id:"fssXGM",defaultMessage:"Error while searching"});h.push(s.jsx(vt,{highlightedCommand:_,status:t?H.Running:H.Error},"search-gpt-query"))}return h.length?s.jsx(s.Fragment,{children:h}):null}const bt=({clientThreadId:e,turnIndex:a,nextMessage:t,isRequestActive:n,isLastTurnInConversation:c,navigationCitation:i})=>{const{scrollToHeader:m}=Ve("searchSources")??{},u=He(),o=Be()&&u?.type==="searchSources",{openThreadSidebar:g}=q(),{value:l}=xe("756982148");return x.useEffect(()=>{Ue.addFirstTiming("render.fastNavigation")},[]),x.useEffect(()=>{o&&g({type:"searchSources",scrollToHeader:m,clientThreadId:e,turnIndex:a,messageId:t?.message.id??""})},[]),x.useEffect(()=>{const f=t.message,h=f.metadata?.search_source,p=i.domains.map(_=>_.url);Ns.logEvent(Q.searchToolRequestTimeToFastNav,e,f.id,{search_source:h,urls:p},()=>{h===We.InstantQuery&&ws.logEvent(Q.searchToolPageLoadTimeToFastNav,{message_id:f.id,urls:p,search_source:h})})},[e,t,i]),n&&c&&l?s.jsx(B.div,{initial:{opacity:n?0:1,height:n?0:"auto"},animate:{opacity:1,height:"auto"},children:s.jsx(ce,{clientThreadId:e,turnIndex:a,nextMessage:t,navigationCitation:i})}):s.jsx(ce,{clientThreadId:e,turnIndex:a,nextMessage:t,navigationCitation:i})},ce=({clientThreadId:e,turnIndex:a,nextMessage:t,navigationCitation:n})=>{const{toggleThreadSidebar:c}=q(),{value:i}=xe("756982148"),m=x.useMemo(()=>({clientThreadId:e,turnIndex:a,messageId:t?.message.id}),[e,a,t?.message.id]),u=x.useCallback((g,l)=>{c({type:"searchSources",scrollToHeader:l,clientThreadId:e,turnIndex:a,messageId:t?.message.id??""})},[c,e,a,t?.message.id]),o=Ls(m);return i?s.jsx(st,{navigation:n,onShowSearchResults:u,trackContentReferenceEvent:o}):s.jsx(Ds,{tldr:{type:"tldr",display_title:n.domains[0].title,url:n.domains[0].url,matched_text:"",start_idx:0,end_idx:0,page_title:"",breadcrumbs:[n.domains[0].domain],refs:[]},trackContentReferenceEvent:o})},kt=C(()=>I(()=>import("./fzpqiqufpsm289jo.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]))),It=C(()=>I(()=>import("./gdfo3ssr4wtmu0zr.js"),__vite__mapDeps([11,1,3,4,12]))),At=C(()=>I(()=>import("./lt5e1h6sol447h24.js"),__vite__mapDeps([13,1,3,4,14,6,7,10]))),Nt=C(()=>I(()=>import("./lucbyjmrypsebwwd.js"),__vite__mapDeps([15,1,3,4,8,6,7,9,10])).then(e=>e.TextMessageEditor)),wt=C(()=>I(()=>import("./mlpy7pekkz4vj5ih.js"),__vite__mapDeps([16,1,3,4,17,6,7,18,2,5,19,9,10,8]))),Lt=C(async()=>()=>null),Dt=C(async()=>()=>null),Rt=C(()=>I(()=>import("./ho2y7kcwhu81ia5j.js"),__vite__mapDeps([20,1,3,4,8,6,7,9,10,14,21,22,23]))),Ft=C(()=>I(()=>import("./jfsira8wttdjvr2l.js"),__vite__mapDeps([24,1,3,4,6,7,8,9,10,14,21,22,23])).then(e=>e.BrowsingMessage)),Ot=C(()=>I(()=>import("./v3p6blfrrdmvstxq.js"),__vite__mapDeps([25,1,3,4,6,7])).then(e=>e.SearchResultMessage)),Pt=C(()=>I(()=>import("./lyd95dn7bnbdrbqw.js"),__vite__mapDeps([26,1,3,4,6,7,8,9,10,14,21,22,23])).then(e=>e.JITPluginMessage)),Vt=C(()=>I(()=>import("./f1dy6s5rgmlk5jz4.js"),__vite__mapDeps([27,3,1,4,6,7,8,9,10,14,21,22,23])).then(e=>e.DataAnalysisMessage)),Ht=C(()=>I(()=>import("./c2aqrtizhx0h7af2.js"),__vite__mapDeps([28,1,3,4,6,7,29,8,9,10,30,31,14,21,22,23]))),Bt=C(()=>I(()=>import("./mjk2tmzbeggshn4d.js"),__vite__mapDeps([32,1,3,4,33,6,7,34,8,9,10,35,36,37,38,39,17,40,41,42,21,43,44,45,29,46,47])).then(e=>e.CoTMessage)),Ut=C(()=>I(()=>import("./f7kcplevtek6bok0.js"),__vite__mapDeps([48,1,6,3,4,7,49,50,51,52])).then(e=>e.JawboneMessage));function sa(e){switch(e.type){case r.Text:case r.Debug:return[e.message];case r.MultiText:case r.Browsing:case r.CodeInterpreter:case r.JITPlugin:case r.RetrievalBrowsing:case r.ParallelBrowsing:case r.Dalle:case r.t2uay3k:case r.GizmoEditor:case r.SearchResult:case r.a8km123:case r.f959b8c:case r.b1de6e2_c:case r.b1de6e2_s:case r.b1de6e2_d:case r.is_loading_message:case r.Canmore:case r.SonicCanvas:case r.de1d73e:case r.SearchGPTQuery:case r.l1p9k3u:case r.oiw209h:case r.c12k321:return e.messages;default:throw new Error("Bad")}}function ta({groupedMessagesToRender:e,allMessages:a,allGroupedMessages:t,clientThreadId:n,isEditing:c,isUserTurn:i,isCompletionRequestInProgress:m,isFeedbackEnabled:u,isFinalTurn:o,turnIndex:g,hasActiveRequest:l,handleEnterEdit:f,handleExitEdit:h,onRequestCompletion:p,shouldGrowContainer:_=!0,showEditButton:T=!1,showCopyButton:A=!1}){const N=Rs(),{showDebugConversationTurns:j}=Fs(),[L]=U(n,d=>[d?.mode]),M=ze(n),D=Os(),F=t.some(d=>Ps.includes(d.type)),O=e.map((d,E)=>{const b=E===t.length-1;switch(d.type){case r.Text:case r.MultiText:{const y=e[E-1],v=y?.type,R=y&&"messages"in y?y.messages:void 0;if(d.type===r.Text){const ye=d?.message&&!X(d.message.message),Me=c?s.jsx(Nt,{message:d.message,clientThreadId:n,onRequestCompletion:p,onExitEdit:h,disabled:l}):F&&ye?null:s.jsx($s,{className:"min-h-8",message:d.message,isFeedbackEnabled:u,isCompletionInProgress:b&&m,turnIndex:g,clientThreadId:n,showEditButton:T,showCopyButton:A,onEnterEdit:f,isUserTurn:i,isFinalMessage:o&&b,prevGroupedMessageType:v,prevGroupedMessages:R});return s.jsxs(x.Fragment,{children:[Me,s.jsx(Bs,{isUserTurn:i,message:d.message.message})]},"group-"+d.message.nodeId)}else return d.type===r.MultiText?s.jsx(At,{clientThreadId:n,messages:d.messages,isCompletionInProgress:b&&m,isFeedbackEnabled:u,prevGroupedMessageType:v,prevGroupedMessages:R},"multitext-"+(d.messages[0]?.nodeId??E)):d.type}case r.Browsing:case r.RetrievalBrowsing:{const y=L!=null&&[J.GizmoInteraction,J.GizmoMagicCreate,J.GizmoTest].includes(L.kind),v=M?Hs(M):!1;return s.jsx(Ft,{messages:d.messages,isRequestActive:l,isLastMessageInTurn:b,isUsingGizmo:y,isUsingSnorlax:v,isRetrieval:d.type===r.RetrievalBrowsing},"browsing-"+(d.messages[0]?.nodeId??E))}case r.SearchGPTQuery:{const y=t.slice(E+1).find(({type:R})=>R===r.Text||R===r.SonicCanvas),v=y?.type===r.Text?y.message:y?.type===r.SonicCanvas?y.messages[0]:void 0;return s.jsx(Ct,{clientThreadId:n,turnIndex:g,isRequestActive:l,isLastMessage:b,isLastTurnInConversation:o,nextMessage:v},"searchquery-"+(d.messages[0]?.nodeId??E))}case r.a8km123:if(N?.isEnabled&&d.messages.find(({message:y})=>y.metadata?.model_slug?.includes("o3-mini"))){const y=a.findLastIndex(({message:v})=>v.author.role===ge.Assistant&&v.recipient==="all");return s.jsx(Bt,{isStreaming:(b||y<E)&&m,messages:d.messages},"sum-"+(d.messages[0]?.nodeId??E))}return s.jsx(Ht,{messages:d.messages,isStreaming:b&&m,isLastMessage:b,clientThreadId:n,currentGroupedMessageIndex:E,turnIndex:g},"sum-"+(d.messages[0]?.nodeId??E));case r.f959b8c:return null;case r.is_loading_message:return b&&m?s.jsx(Vs,{},"loading-message-"+E):null;case r.c12k321:return null;case r.l1p9k3u:return null;case r.b1de6e2_c:return s.jsx(_t,{messages:d.messages,clientThreadId:n,isLastMessage:b},"b1de6e2-"+(d.messages[0]?.nodeId??E));case r.b1de6e2_s:return s.jsx(ht,{messages:d.messages,clientThreadId:n},"b1de6e2_s-"+(d.messages[0]?.nodeId??E));case r.b1de6e2_d:return null;case r.de1d73e:if(D){const y=E+1<t.length?t[E+1]:void 0;return s.jsx(Ut,{clientThreadId:n,currentGroupedMessage:d,nextMessage:y&&y.type===r.Text?y.message:void 0,isLastMessage:b,isRequestActive:l},"jawbone-"+(d.messages[0]?.nodeId??E))}else return null;case r.ParallelBrowsing:return s.jsx(Rt,{messages:d.messages},"parallel-"+(d.messages[0]?.nodeId??E));case r.CodeInterpreter:return s.jsx(Vt,{messages:d.messages,isRequestActive:l,clientThreadId:n},"ada-"+(d.messages[0]?.nodeId??E));case r.JITPlugin:return s.jsx(Pt,{messages:d.messages,clientThreadId:n,isLastTurnInConversation:o,onRequestCompletion:p},"jit-"+(d.messages[0]?.nodeId??E));case r.t2uay3k:return s.jsx(Dt,{messages:d.messages,clientThreadId:n},"t2uay3k-"+(d.messages[0]?.nodeId??E));case r.Dalle:return s.jsx(wt,{messages:d.messages,clientThreadId:n},"dalle-"+(d.messages[0]?.nodeId??E));case r.GizmoEditor:return s.jsx(kt,{messages:d.messages},"gizmo-editor-"+(d.messages[0]?.nodeId??E));case r.oiw209h:return s.jsx(Lt,{messages:d.messages,clientThreadId:n},"oiw209h-"+(d.messages[0]?.nodeId??E));case r.Canmore:return s.jsx(rt,{messages:d.messages,allGroupedMessages:e,isFinalTurn:o,isRequestActive:l,clientThreadId:n},"canmore-"+(d.messages[0]?.nodeId??E));case r.SonicCanvas:return d.messages[0],!1;case r.Debug:return j?s.jsx(It,{message:d.message},"debug-"+d.message.nodeId):null;case r.SearchResult:return s.jsx(Ot,{messages:d.messages},"search-result-"+(d.messages[0]?.nodeId??E))}});return s.jsx(zt,{shouldGrowContainer:_,children:Us()?s.jsxs(Ws,{isDisabled:i||!o||!m,children:[zs()&&!i&&o&&s.jsx(Js,{isWordByWordEnabled:qs(),isStreaming:m,debug:Ys()}),O]}):O})}function Wt(){return s.jsx(Ks,{type:"danger",children:s.jsx(k,{id:"5eGo3w",defaultMessage:"Unable to display this message due to an error."})})}function zt({children:e,shouldGrowContainer:a}){return s.jsx("div",{className:w({"flex max-w-full flex-col":!0,"flex-grow":a}),children:s.jsx(Je,{name:"GroupedMessages",fallback:Wt,children:e})})}export{ta as C,vt as T,sa as g};
//# sourceMappingURL=ipgaseve9xp2bi1a.js.map
