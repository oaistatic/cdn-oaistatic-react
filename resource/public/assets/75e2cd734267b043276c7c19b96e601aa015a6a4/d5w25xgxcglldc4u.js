const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/b4zl6usbni9k59c7.js","assets/l6lryjpkt8rv0lpy.js","assets/dvllb5fed1b4y7k1.js","assets/mnkup87aq6tfilq5.js","assets/root-lwz5toux.css","assets/conversation-small-ga20ijz2.css","assets/kzts48l18dfza7r7.js","assets/cal7wpbc1bdlnwfh.js","assets/bj9d14lm2vt5tl41.js"])))=>i.map(i=>d[i]);
import{a as Ee,r as h,v as Pe,j as s,M as g,c as we,R as De}from"./l6lryjpkt8rv0lpy.js";import{fo as ke,am as xe,s as Se,r as U,gf as Ne,n as ie,M as Le,bl as he,bm as pe,ap as Ae,aD as H,d as O,aE as q,U as ye,ac as Me,bT as Fe,S as le,c7 as ce,T as He,a as W,gr as Oe,C as Ge,bC as Be,b8 as qe,h as Qe,gs as Ie,gt as Ve,D as Ue,gu as We,gv as Ye,gw as ze,ae as Ke,gx as Ze,o as $e}from"./mnkup87aq6tfilq5.js";import{h7 as Je,f4 as Xe,h1 as es,aa as de,f5 as ss,bM as ts,fS as as,h8 as ns,h9 as ve,ha as os,hb as rs,ab as is,gW as ls,eg as ue,hc as cs,cD as Z,dG as ds,hd as us,he as gs,hf as ms,hg as fs,hh as xs,hi as hs,hj as ps,hk as Y,hl as z,hm as ys,hn as Ms,ho as vs,hp as js,c4 as Ts,hq as Rs,hr as Cs,hs as bs,ht as _s,hu as Es,dP as K,hv as Ps,hw as ws}from"./dvllb5fed1b4y7k1.js";import{u as Ds,g as ks}from"./1e3kywkhcjn5spyo.js";function Ss({clientThreadId:e,conversationMode:t}){const l=Je(e),r=Ee(),a=ke(),n=Ds(),u=Xe.useIsEnabled(e),{data:d}=es(),{data:o}=xe(),f=h.useCallback(p=>{if(!p)return[];const m=de(o?.models,p),i=ks({modelConfig:m,systemHints:d??[]}).map(y=>y.systemHint);return Array.from(n).filter(y=>i.includes(y))},[n,o?.models,d]);return({id:p,eventSource:m,requestedModelId:i,systemMessage:y,systemMessageMetadata:M,extraStreamParams:c})=>{const _=Se.getTree(U(e)).getConversationTurns(p,!1),S=_?.[_?.length-1].variantIds?.length===1&&c?.forceUseSearch===void 0,T=Ne(r,a),N=U(e),E=de(T?.models,N?.modelId),P=f(i);u&&(c={...c??{},enableMessageFollowups:!0});const{systemHints:w,extraStreamParams:D}=ss(P,c);l({id:p,requestedModelId:i,eventSource:m,variantPurpose:S?"comparison_implicit":"none",conversationMode:t??U(e)?.mode,appendMessages:y?[{id:Pe(),author:{role:E?.tags.includes("o1")?ie.Developer:ie.System},content:{content_type:Le.Text,parts:[y]},metadata:{exclude_after_next_user_message:!0,...M}}]:void 0,extraStreamParams:D,systemHints:w})}}const Ns=he(()=>pe(()=>import("./b4zl6usbni9k59c7.js").then(e=>e.F),__vite__mapDeps([0,1,2,3,4,5]))),Ls=({errorState:e,nodeId:t,clientThreadId:l,isFeedbackEnabled:r,isUserTurn:a,isFinalMessage:n})=>{const{value:u}=Ae("3779321121"),d=e.canRetry&&n&&(u||e.errCode===H.ModelCapExceeded);if(a){const o=e?.flagSeverity;return s.jsxs("div",{className:"flex w-full flex-col items-end justify-between gap-2",children:[s.jsxs("div",{className:O("flex max-w-[var(--user-chat-width,70%)] flex-row-reverse items-start gap-1 text-start text-sm",o==="danger"&&"text-token-text-error",o==="warning"&&"text-orange-600",(o==="info"||!o)&&"text-token-text-secondary"),children:[s.jsx(ts,{className:O("icon-md mt-[0.0625em] shrink-0")}),s.jsx(ge,{errorState:e,clientThreadId:l,isFeedbackEnabled:r})]}),d&&s.jsx(fe,{clientThreadId:l,nodeId:t,errorState:e})]})}return s.jsx(as,{type:e?.flagSeverity,className:"mb-2 w-fit self-start",primaryAction:d&&s.jsx(fe,{clientThreadId:l,nodeId:t,errorState:e}),children:s.jsx("div",{className:"flex flex-row items-center justify-between gap-4",children:s.jsx(ge,{errorState:e,clientThreadId:l,isFeedbackEnabled:r})})})},ge=({errorState:e,clientThreadId:t,isFeedbackEnabled:l})=>{const{errCode:r,errMessage:a}=e;switch(r){case q.ContentPolicy:return s.jsx(Os,{isFeedbackEnabled:l});case q.ModelIncompatibility:return s.jsx(g,{id:"cyOWhN",defaultMessage:"Your request was flagged as potentially violating our usage policy. Please try again with a different prompt."});case q.ContentOrTos:return s.jsx(Fs,{isFeedbackEnabled:l});case q.ContentRegurgitation:return s.jsx(Hs,{});case H.ModelCapExceeded:return s.jsx(As,{clientThreadId:t});case H.HistoryDisabledConversationNotFound:return s.jsx(g,{id:"TextMessageDisplay.historyDisabledConversationMissing",defaultMessage:"Sorry, conversations created when Chat History is off expire after 6 hours of inactivity. Please start a new conversation to continue using ChatGPT."});case H.MissingLastCompletion:return s.jsx(g,{id:"TextMessageDisplay.somethingWentWrong",defaultMessage:"Something went wrong."});default:return a?s.jsx(Ns,{rehypePlugins:[[ns,{target:"_new",rel:"noopener noreferrer"}]],className:"markdown prose w-full break-words dark:prose-invert",children:a}):null}};function As({clientThreadId:e}){const t=ve(n=>n.isoDate),l=os(t),r=ye(e,n=>n?.mode),a=r&&r.kind!==Me.PrimaryAssistant;return t?s.jsx(g,{id:"TextMessageDisplay.gptUsageCapExceededExpired",defaultMessage:"You previously reached your usage cap for GPT-4, but you can now try sending your message again"}):s.jsx("span",{children:a!=null?s.jsx(g,{id:"TextMessageDisplay.gptUsageCapExceededCustomFeature",defaultMessage:"You've reached the current usage cap for GPT-4, please try again {formattedTime}. <link>Learn more</link>",values:{link:me,formattedTime:l}}):s.jsx(g,{id:"TextMessageDisplay.gptUsageCapExceeded",defaultMessage:"You've reached the current usage cap for GPT-4. You can continue with the default model now, or try again {formattedTime}. <link>Learn more</link>",values:{link:me,formattedTime:l}})})}const me=e=>s.jsx("a",{href:"https://share.hsforms.com/16d0ZZVM3QZirXnCD_q7u1Q4sk30",target:"_blank",rel:"noreferrer",className:"underline hover:no-underline",children:e});function Fs({isFeedbackEnabled:e}){return s.jsxs("div",{children:[s.jsx("div",{className:e?"font-semibold":"",children:s.jsx(g,{id:"TextMessageDisplay.contentOrTosViolationNoFeedback",defaultMessage:"This content may violate our <termsLink>Terms of Use</termsLink> or <contentPolicyLink>usage policies</contentPolicyLink>.",values:{contentPolicyLink:je,termsLink:Gs}})}),s.jsx("div",{children:e&&s.jsx(g,{id:"TextMessageDisplay.contentPolicyFeedback",defaultMessage:"Did we get it wrong? Please tell us by giving this response a thumbs down."})})]})}function Hs(){return s.jsxs("div",{children:[s.jsx("div",{className:"font-semibold",children:s.jsx(g,{id:"kAMQnd",defaultMessage:"ChatGPT isn't designed to provide this type of content."})}),s.jsx("div",{children:s.jsx(g,{id:"fQ0JYv",defaultMessage:"Read the <modelSpecLink>Model Spec</modelSpecLink> for more on how ChatGPT handles creators' content.",values:{modelSpecLink:Bs}})})]})}function Os({isFeedbackEnabled:e}){return s.jsxs("div",{children:[s.jsx("div",{className:e?"font-semibold":"",children:s.jsx(g,{id:"TextMessageDisplay.contentPolicyViolationNoFeedback",defaultMessage:"This content may violate our <contentPolicyLink>usage policies</contentPolicyLink>.",values:{contentPolicyLink:je}})}),s.jsx("div",{children:e&&s.jsx(g,{id:"TextMessageDisplay.contentPolicyFeedback",defaultMessage:"Did we get it wrong? Please tell us by giving this response a thumbs down."})})]})}const je=e=>s.jsx($,{href:"https://openai.com/policies/usage-policies",children:e}),Gs=e=>s.jsx($,{href:"https://openai.com/policies/terms-of-use",children:e}),Bs=e=>s.jsx($,{href:"https://cdn.openai.com/spec/model-spec-2024-05-08.html",children:e}),$=({href:e,children:t})=>s.jsx("a",{target:"_blank",rel:"noreferrer",href:e,className:"underline hover:no-underline",children:t}),fe=({clientThreadId:e,nodeId:t,errorState:l})=>{const r=Ss({clientThreadId:e}),a=l?.errCode===H.ModelCapExceeded,n=ve(M=>M.isoDate),u=a&&!!n,d=ye(e,M=>M?.mode),o=d&&d.kind!==Me.PrimaryAssistant,f=u&&!o,R=u&&o,p=rs(),{data:m}=xe(),i=is(m)?.id,y=()=>{a?le.logEvent("chatgpt_regenerate_due_to_rate_limit_button_clicked",void 0,{...ce({clientThreadId:e}),useDefaultModel:f?"true":"false"}):le.logEvent("chatgpt_regenerate_due_to_error_button_clicked",void 0,{...ce({clientThreadId:e}),inlineButton:"true"}),f?(p({modelId:i,location:"Model switcher menu item"}),r({id:t,requestedModelId:i})):r({id:t})};return s.jsx(Fe,{as:"button",color:"secondary",disabled:R,onClick:y,icon:ls,"data-testid":"regenerate-thread-error-button",children:f?s.jsx(g,{id:"MessageError.buttonUseDefaultModel",defaultMessage:"Use default model"}):s.jsx(g,{id:"MessageError.buttonRetryResponse",defaultMessage:"Retry"})})},qs=he(()=>pe(()=>import("./kzts48l18dfza7r7.js"),__vite__mapDeps([6,1,3,4,2,5,7,8])).then(e=>e.TextMessageImageGroup));function Te({attachments:e,citations:t,contentReferences:l,className:r,clientThreadId:a,displayParts:n,isCompletionInProgress:u,id:d,isActivelyStreaming:o,isUserTurn:f,isFinalMessage:R,turnIndex:p,isFeedbackEnabled:m,messages:i,parts:y,prevGroupedMessageType:M,prevGroupedMessages:c,showEditButton:G,showCopyButton:_,onEnterEdit:B,size:S="medium",errorState:T}){const N=i.length>1,E=y.some(C=>C!==""),P=!E&&i[0].message.metadata?.content_references?.length===0,w=i[0].message.metadata?.targeted_reply_label??i[0].message.metadata?.targeted_reply,D=i[0].message.metadata?.targeted_reply_image;return h.useEffect(()=>{const C=i[0].message;if(C.author.metadata?.real_author===`tool:${He.SEARCHGPT}`&&E){const k=C.metadata?.search_source;ue.logEvent(W.searchToolRequestTimeToFirstTextToken,a,C.id,{search_source:k},()=>{k===Oe.InstantQuery&&cs.logEvent(W.searchToolPageLoadTimeToFirstTextToken,{message_id:C.id,search_source:k})})}},[a,E,i]),h.useEffect(()=>{if(!P)switch(M){case Z.Browsing:ue.logEvent(W.browsingTimeToFirstTextToken,a,i[0].message.id);break}},[P,i,a,M]),s.jsxs("div",{"data-message-author-role":i[0].message.author.role,"data-message-id":i[0].message.id,dir:"auto",className:O(r,"text-message flex w-full flex-col items-end gap-2 whitespace-normal break-words text-start [.text-message+&]:mt-5"),"data-message-model-slug":i[0].message.metadata?.model_slug,children:[w&&s.jsxs("div",{className:"mb-1 ml-6 mt-1 flex items-center gap-1.5 text-sm font-normal text-token-text-tertiary sm:ml-7 lg:ml-8",children:[D?s.jsx("img",{className:"h-6 rounded border border-token-border-light object-contain",src:D,alt:w}):s.jsx(ds,{className:"icon-md shrink-0"}),s.jsx("p",{className:"mr-2 line-clamp-3",children:w})]}),f&&s.jsx(us,{messages:i}),!1,s.jsx(gs,{messages:i}),s.jsx(Qs,{parts:y,attachments:e,isUserTurn:f,isCompletionInProgress:u,turnIndex:p,displayParts:n,isActivelyStreaming:o,shouldHideContent:!!T?.shouldHideContent&&!m,showEditButton:G,showCopyButton:_,onEnterEdit:B,clientThreadId:a,id:d,isEmpty:P,prevGroupedMessageType:M,prevGroupedMessages:c,flagSeverity:T?.flagSeverity,messages:i,citations:t,contentReferences:l,size:S}),T&&s.jsx(Ls,{errorState:T,nodeId:d,isFeedbackEnabled:m,clientThreadId:a,isUserTurn:f,isFinalMessage:R}),s.jsx(ms,{message:N?void 0:i[0]}),!f&&!o&&c&&M===Z.SearchResult&&s.jsx(fs,{messages:c})]})}function Qs({clientThreadId:e,id:t,displayParts:l,turnIndex:r,isActivelyStreaming:a,shouldHideContent:n,showEditButton:u=!1,showCopyButton:d=!1,onEnterEdit:o,isEmpty:f,prevGroupedMessageType:R,prevGroupedMessages:p,messages:m,citations:i,contentReferences:y,size:M,isUserTurn:c,parts:G,attachments:_}){const B=we(),S=Ge(),T=h.useRef(!1),N=xs(l),E=m[0].message.metadata?.serialization_metadata,P=m[0].message.metadata?.image_results?.length??0,w=h.useMemo(()=>({clientThreadId:e,messageId:t,turnIndex:r}),[e,t,r]),{toggleThreadSidebar:D}=Be(),C=h.useCallback((x,j)=>{D({type:"searchSources",scrollToHeader:j,clientThreadId:e,turnIndex:r,messageId:t})},[e,r,t,D]),k=h.useCallback(x=>{hs(e,r,S,x)},[e,r,S]),J=s.jsx(ys,{parts:G,attachments:_,isUserTurn:c,clientThreadId:e},"files-and-tables"),I=!!(_?.length||l.some(x=>x.type==="images")),Re=ps();function X(x,j,v){const A=R===Z.CodeInterpreter?p?.map(b=>b.message):void 0,{text:se,contentReferences:te}=Ms(j,i,y);let ae=te;Re&&(ae=te.filter(b=>b.type!=="attribution"));let{processedText:F,displayedContentReferences:ne}=Ie(se,ae,a?void 0:A,!1,a);F.includes(Ve)&&!T.current&&(T.current=!0,Ue.addError(new Error("Failed replaceTextWithDirectives"),{text:F,displayedContentReferences:ne}));const oe=m[0].message,re=oe.metadata?.message_locale,Ce=m.find(b=>b.message.id===t),be=vs(Ce?.message),_e=!F&&We("630821311")?"result-thinking":js()?"streaming-animation":"result-streaming";let V=s.jsx(Ts,{clientThreadId:e,componentOverrides:be?Rs:null,messageId:t,size:M,isActivelyStreaming:a,className:O(a&&_e),children:F===""?"&#8203;":F});if(re!=null){const b=Ye(re);b!=null&&(V=s.jsx(ze,{locale:b,children:V}))}return s.jsx(Cs.Provider,{value:{analyticsMetadata:w,message:oe,contentReferences:ne,onShowSearchResults:C,numImageResults:P,isActivelyStreaming:a,useSafeUrls:!0,clientThreadId:e},children:V},x)}const L=l.map((x,j)=>{if(x.type==="transcription"){const v=n?null:x.text;let A=null;if(c&&n)A=s.jsx("span",{className:"italic opacity-30",children:s.jsx(g,{...Q.contentRemoved})});else if(c&&v!=null)A=v.trim().length===0?s.jsx("span",{className:"italic opacity-30",children:s.jsx(Y,{text:B.formatMessage(Q.transcriptUnavailable),customSymbolOffsets:void 0})}):s.jsx("span",{className:"italic opacity-65",children:s.jsx(Y,{text:`“${v.trim()}”`,customSymbolOffsets:void 0})});else if(!c&&v!=null)return X(j,v);return s.jsx(z,{containsImagesOrAttachments:I,isUserTurn:c,showEditButton:u,showCopyButton:d,onEnterEdit:o,handleCopyToClipboard:k,children:A},j)}else if(x.type==="text"){const v=n?null:x.text;return!f&&!n&&!c?X(j,N):f&&a&&!c?s.jsx("div",{className:"result-streaming",children:s.jsx("span",{children:s.jsx("pre",{})})},j):s.jsx(z,{containsImagesOrAttachments:I,isUserTurn:c,showEditButton:u,showCopyButton:d,onEnterEdit:o,handleCopyToClipboard:k,children:c&&n?s.jsx("span",{className:"italic opacity-30",children:s.jsx(g,{...Q.contentRemoved})}):v?s.jsx(Y,{text:v,customSymbolOffsets:E?.custom_symbol_offsets}):null},j)}else if(x.type==="images"){const v=m[0].message.metadata?.attachments??[];return s.jsx(qs,{assets:x.imageAssets,attachments:v},j)}else return null}),ee=l.findIndex(x=>x.type==="text");if(ee!==-1?L.splice(ee,0,J):L.push(J),n&&c)L.length=0,L.push(s.jsx(z,{containsImagesOrAttachments:I,isUserTurn:c,showEditButton:!1,showCopyButton:!1,onEnterEdit:qe,handleCopyToClipboard:k,children:s.jsx("span",{className:"italic opacity-30",children:s.jsx(g,{...Q.contentRemoved})})}));else if(n&&!c)return null;return s.jsx("div",{className:O("flex w-full flex-col gap-1 empty:hidden",c&&"items-end rtl:items-start",!c&&"first:pt-[3px]"),children:L})}const Q=Qe({contentRemoved:{id:"textMessage.contentRemoved",defaultMessage:"Content removed"},transcriptUnavailable:{id:"textMessage.transcriptUnavailable",defaultMessage:"Transcript Unavailable"}});function Is(e){const{isActivelyStreaming:t,...l}=e,r=Ke(),a=r?.includes("debug")??!1,n=e.messages[e.messages.length-1].message.id,[u,d]=h.useState(bs(e.parts)),o=h.useRef(void 0);return o.current===void 0&&(o.current=r?.includes(Ze)??!1?new _s(e.parts,d,t,void 0,{debug:a}):new Es(e.parts,d,t)),h.useEffect(()=>{o.current!=null&&(o.current.onMessagePartsUpdated(e.parts,t),o.current.isBuffering()&&K.addDelayedRenderingMessage(n))},[e.parts,n,t]),h.useEffect(()=>{o.current!=null&&!o.current.isBuffering()&&K.removeDelayedRenderingMessage(n)},[u,n]),h.useEffect(()=>()=>K.removeDelayedRenderingMessage(n),[n]),h.useEffect(()=>()=>{o.current!=null&&(o.current.destroy(),o.current=void 0)},[]),s.jsx(Te,{...l,displayParts:u,isActivelyStreaming:t||o.current?.isBuffering()})}function Vs({message:e,isCompletionInProgress:t,clientThreadId:l,className:r,isUserTurn:a,isFinalMessage:n,turnIndex:u,isFeedbackEnabled:d,prevGroupedMessageType:o,prevGroupedMessages:f,showEditButton:R,showCopyButton:p,onEnterEdit:m}){const i=h.useMemo(()=>"parts"in e.message.content?e.message.content.parts:[$e(e.message)],[e]);return s.jsx(Us,{parts:i,messages:[e],isCompletionInProgress:t,className:r,citations:e.message.metadata?.citations,contentReferences:e.message.metadata?.content_references,attachments:e.message.metadata?.attachments,isUserTurn:a,isFinalMessage:n,turnIndex:u,id:e.nodeId,isFeedbackEnabled:d,clientThreadId:l,showEditButton:R,showCopyButton:p,onEnterEdit:m,prevGroupedMessageType:o,prevGroupedMessages:f})}const Zs=De.memo(Vs);function Us(e){const r=e.messages.length>1?void 0:Ps(e.messages[0],!!e.isFinalMessage,!1,e.isCompletionInProgress),a=r?.flagSeverity!=="danger"&&e.isCompletionInProgress,n=!e.parts.some(d=>d!==""),[u]=h.useState(()=>!e.isUserTurn&&(e.isCompletionInProgress||n));return u?s.jsx(Is,{...e,isActivelyStreaming:a}):s.jsx(Te,{...e,displayParts:ws({isUserTurn:e.isUserTurn,parts:e.parts}),isActivelyStreaming:a,errorState:r})}export{Us as T,Zs as a,Ss as u};
//# sourceMappingURL=d5w25xgxcglldc4u.js.map
