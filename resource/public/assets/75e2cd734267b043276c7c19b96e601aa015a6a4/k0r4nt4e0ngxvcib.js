const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/gmef5oj8cqxmaxml.js","assets/mnkup87aq6tfilq5.js","assets/l6lryjpkt8rv0lpy.js","assets/root-lwz5toux.css","assets/dvllb5fed1b4y7k1.js","assets/conversation-small-ga20ijz2.css","assets/pc32gvx0zuzynmfl.js","assets/1e3kywkhcjn5spyo.js","assets/o0ruvxo2l2807vcb.js","assets/gmo2p487z675vgyc.js","assets/f651cyqvxf3m7zo6.js","assets/ll5ad5t40w01fypo.js","assets/oftd8yvle59zqu13.js","assets/hli3paxjs6c9ftyy.js","assets/mc77hi6aghwo7h20.js","assets/hjvhqy8z9mtcdx24.js"])))=>i.map(i=>d[i]);
import{bl as pe,bm as ve,aw as Se,fx as Ce,C as Ee,fy as Z,O as E,S as O,P as y,a as x,c2 as ye,aF as xe,dU as be,aj as F,U as Te,s as Ne,W as Re,E as c,H as w,df as _e,d as D,Z as Ae,aN as we,Q as De}from"./mnkup87aq6tfilq5.js";import{c as $,r as o,a as W,d as Ie,j as t,L as K}from"./l6lryjpkt8rv0lpy.js";import{r as je,v as ke,aj as M,ah as B,ak as Oe,al as Me,am as ze,an as ee,ao as Pe,ap as Le,aq as Ue,ar as Ge,as as X,at as He,au as qe,av as Ve,aw as Q,ax as Fe,ay as Ke,az as Be,aA as Xe,aB as Y,aC as Qe,aD as Ye,aE as Je,aF as Ze}from"./dvllb5fed1b4y7k1.js";import{G as te}from"./pc32gvx0zuzynmfl.js";const $e=pe(()=>ve(()=>import("./gmef5oj8cqxmaxml.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15])).then(e=>e.GizmoConversationOptionsDropdown)),We=new Date(2024,9,11,0);function J(e){O.checkGate("3922476776")||we.abortAllRequests(),y.logEvent(x.loadThread,{threadId:e})}function et({conversation:e,conversationTitle:d,onOpenChange:m,testId:a,inMainScreen:n=!1}){const r=$(),{isUnauthenticated:h}=Se(),{eligible:p,markAsViewed:b}=je(ke.ArchiveConversationOnboarding),u=Ce(e.id),[v,T]=o.useState(!1),l=W(),g=Ie(),S=Ee();if(o.useEffect(()=>Z(te,{deleteChat:({serverThreadId:i})=>{i===e.id&&T(!0)},archiveChat:async({serverThreadId:i})=>{i===e.id&&(await E.patchConversation(e.id,{is_archived:!0}),M(l,e.gizmo_id),O.logEvent("chatgpt_conversation_archived"),y.logEvent(x.conversationArchived),p&&(S.info(r.formatMessage({defaultMessage:"You can view archived chats in Settings",id:"HistoryGizmoItem.archiveChatOnboarding"}),{duration:10,hasCloseButton:!0}),b()),u&&B(g))}}),[g,S,l,p,e.id,e.gizmo_id,r,u,b]),h)return null;const N=t.jsx($e,{conversation:e,onOpenChange:m,inMainScreen:n,children:t.jsx("button",{className:"flex items-center justify-center text-token-text-secondary transition hover:text-token-text-primary radix-state-open:text-token-text-secondary","data-testid":a,"aria-label":r.formatMessage({id:"idEcXk",defaultMessage:"Open conversation options"}),children:t.jsx(Oe,{className:"icon-md"})})});return t.jsxs(t.Fragment,{children:[t.jsx(ye,{label:r.formatMessage({id:"tJPHEQ",defaultMessage:"Options"}),sideOffset:4,side:"top",children:N}),v&&t.jsx(Me,{title:d,handleDelete:()=>{E.patchConversation(e.id,{is_visible:!1}).then(()=>{M(l,e.gizmo_id),O.logEvent("chatgpt_conversation_deleted"),y.logEvent(x.conversationDeleted),xe.publish({kind:"deleteConversation",serverThreadId:e.id})}),u&&B(g)},onClose:()=>{T(!1)}})]})}const se=5,tt=3e3;function st({threadId:e}){const d=W(),m=o.useRef(!1),a=o.useRef(null);return o.useEffect(()=>{async function n(){m.current=!0;const r=await Ze(e);if(r.async_status===c.UNREAD){M(d,r.gizmo_id),De.initThreadFromServerData(e,r,!0,void 0,!0);return}if(r.async_status!==c.STREAMING)return;const h=r.update_time??0;ee(new Date,new Date(h*1e3))<se?a.current=window.setTimeout(n,tt):E.setConversationStatus(e)}return m.current||(y.logEvent(x.conversationPollingStarted),n()),()=>{a.current&&window.clearTimeout(a.current)}},[d,e]),null}function it({conversation:e,className:d,hideOverflowMenu:m=!1,isActiveInMainWindow:a,isActive:n,elementRef:r,testId:h}){const p=$(),[b,u]=o.useState(!1),[v,T]=o.useState(!1),[l,g]=o.useState(!1),S=be(),{value:N}=F("3922476776"),{value:i}=F("232791851"),ae=ze(e.id),{value:f=null,source:R=null}=ae??{},oe=Te(e.id,Ne.getRequestId),C=Re(oe),z=ee(new Date,new Date(e.update_time??0))<se,P=Pe(e.id),ne=e.update_time&&Le(new Date(e.update_time),We),L=f===c.STREAMING&&z,re=i&&!n&&!C&&ne&&!l&&f===c.UNREAD,U=i&&(C||L)&&!l,ie=i&&!a&&P.length>0&&!l,le=i&&!a&&(C||L),ce=i&&f===c.STREAMING&&R===w.SERVER&&!C&&z,I=o.useRef(!1);o.useEffect(()=>{I.current||N&&(async()=>(I.current=!0,n&&f===c.UNREAD&&(R===w.SERVER&&await E.setConversationStatus(e.id),Y(e.id,null)),!n&&R===w.CLIENT&&f===c.UNREAD&&(await E.setConversationStatus(e.id,f),Y(e.id,{value:c.UNREAD,source:w.SERVER})),I.current=!1))()},[N,n,e.id,f,R,C]),o.useEffect(()=>Z(te,{editTitle:({serverThreadId:s})=>{(s?s===e.id:a)&&u(!0)}}),[e.id,a]);const j=p.formatMessage({id:"mpXAeu",defaultMessage:"New chat"}),{resolvedTitle:_,isTypingEffect:de}=Ue(e.id,e.title,n),ue=_e(),fe=de&&n&&ue,{data:me}=Ge(),G=e.conversation_template_id!=null?me?.gizmos.find(s=>s.resource.gizmo.id===e.conversation_template_id)?.resource:void 0,H=o.useRef(null),ge=t.jsx("div",{className:D("absolute bottom-0 top-0 inline-flex items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",a||v?"flex":"invisible can-hover:group-hover:visible"),ref:H,children:t.jsx(et,{conversation:e,conversationTitle:_??e.title,onOpenChange:s=>{T(s),s&&y.logEvent(x.conversationHistoryItemOpenMenu,{conversationId:e.id})},testId:`${h}-options`})}),q=S?Qe:Ye,he=(a||v)&&Je,V=o.useRef(null);return t.jsxs("div",{draggable:X(e.gizmo_id),onDragStart:s=>{if(!X(e.gizmo_id))return;const k=Ae(V.current),A=H.current;A&&(A.style.display="none"),s.dataTransfer.setDragImage(k,k.clientWidth/3,k.clientHeight/2),A&&requestAnimationFrame(()=>{A.style.display=""}),s.dataTransfer.effectAllowed="move",He({kind:"conversation",conversation:e,gizmoId:e.gizmo_id})},onDragEnd:()=>{qe()},ref:V,style:{"--item-background-color":Ve(l,n,v)},className:D(q,"relative screen-arch:bg-transparent",d),onMouseEnter:()=>{g(!0)},onMouseLeave:()=>{g(!1)},children:[S&&t.jsx("div",{className:D(q,he,"pointer-events-none absolute inset-0 group-hover:bg-transparent motion-safe:group-active:scale-[98%] motion-safe:group-active:transition-transform motion-safe:group-active:duration-100")}),ce&&t.jsx(st,{threadId:e.id}),t.jsx(K,{to:Q(e.id,G),onClick:s=>{s.metaKey||s.ctrlKey||a||J(e.id)},onDoubleClick:()=>{u(!0)},ref:r,className:"flex items-center gap-2 p-2 screen-arch:motion-safe:group-active:scale-[98%] screen-arch:motion-safe:group-active:transition-transform screen-arch:motion-safe:group-active:duration-100",style:{maskImage:"var(--sidebar-mask)"},children:t.jsx("div",{className:D("relative grow overflow-hidden whitespace-nowrap",le&&!U&&"loading-shimmer"),dir:"auto",title:_??j,children:fe?t.jsx(Fe,{text:_||j}):_||j})}),b?t.jsx("div",{className:"absolute bottom-0 left-[7px] right-2 top-0 flex items-center bg-token-sidebar-surface-secondary",children:t.jsx(Ke,{conversation:e,onClose:()=>{u(!1)}})}):re?t.jsx(K,{to:Q(e.id,G),onClick:s=>{s.metaKey||s.ctrlKey||a||J(e.id)},children:t.jsx("div",{className:"absolute bottom-0 top-0 flex items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",children:t.jsx("div",{className:"h-2 w-2 rounded-full bg-blue-selection"})})}):ie?t.jsx("div",{className:"absolute bottom-0 top-0 flex items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",children:t.jsx(Be,{task:P[0]})}):U?t.jsx("div",{className:"absolute bottom-0 top-0 flex items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",children:t.jsx(Xe,{size:16,className:"text-token-text-primary"})}):!m&&ge]})}export{et as G,it as H};
//# sourceMappingURL=k0r4nt4e0ngxvcib.js.map
