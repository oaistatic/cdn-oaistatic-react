import{e_ as N,bo as P,fm as v,R as E,A as M,P as u,a as d,bT as L}from"./mnkup87aq6tfilq5.js";import{r as g,A as b,b as T,j as e,c as _,M as o}from"./l6lryjpkt8rv0lpy.js";import{N as x,U as r,W as R,S as j,C as U,a as W}from"./c1zc05u15ttfpkmi.js";import{i as I,A as O}from"./dvllb5fed1b4y7k1.js";function $(s,n){setTimeout(()=>{window.location.href=n},s*1e3)}const K=N(function(){const[n,h]=g.useState(!1),{phoneNumber:t,proof:l,nextAction:c}=b(),{session:m,isLoading:S}=P(),k=I(),p=c===x.Authenticate,C=c===x.LinkAccount&&!n,y=c===x.LinkAccount&&n,{mutate:A,isPending:w}=T({mutationFn:async a=>{try{if(a===r.Cancel)return{success:!1};if(!m||S)return{success:!1,errorCode:v.SessionExpired};const{success:f,error_code:i}=await E.safePost("/moodeng/account_linking",{requestBody:{proof:l,identifier:t},authOption:M.Required});return{success:f,errorCode:i}}catch{return{success:!1}}},onSuccess:(a,f)=>{if(!a.success&&f===r.Cancel){window.location.href=R;return}else if(!a.success){const i=new URLSearchParams;i.set("reason",a.errorCode??""),i.set("phone_number",t??""),window.location.href=`/account-link/error?${i.toString()}`;return}return h(!0),$(2,W)}});return g.useEffect(()=>{if(p){if(!t)return;u.logEventWithStatsig(d.chatgptAccountLinkRedirectAuthenticate,"chatgpt_account_link_redirect_authenticate",{phoneNumber:t}),k({authType:"login",callbackUrl:`${location.pathname}${location.search}${location.hash}`,additionalAuthParams:{[O]:"true"}})}},[p,k,t]),e.jsxs("div",{className:"mx-auto w-full max-w-sm sm:max-w-md",children:[C&&e.jsx(H,{phoneNumber:t,onAllowClick:()=>A(r.Allow),onCancelClick:()=>A(r.Cancel),isOnAllowClickPending:w,isOnCancelClickPending:w}),y&&e.jsx(q,{phoneNumber:t})]})});function H({phoneNumber:s,onAllowClick:n,onCancelClick:h,isOnAllowClickPending:t,isOnCancelClickPending:l}){const c=_();return e.jsxs("div",{className:"flex w-full flex-col items-center justify-center px-4 py-10",children:[e.jsx("header",{className:"oai-header",children:e.jsx(j,{alt:c.formatMessage({id:"login.openAiLogo",defaultMessage:"OpenAI Logo"}),className:"h-10 w-10"})}),e.jsx("h1",{className:"mt-10 text-center text-3xl font-semibold",children:e.jsx(o,{id:"account-link.confirm.title",defaultMessage:"Confirm account linking"})}),e.jsx("p",{className:"mt-6 text-center text-token-text-secondary",children:e.jsx(o,{id:"account-link.confirm-link.description",defaultMessage:'By clicking "Allow", your WhatsApp number {phoneValue} and conversations will be linked to your ChatGPT account and subject to data cotrols in your account settings. <learnMoreLink>Learn more.</learnMoreLink>',values:{phoneValue:s,learnMoreLink:m=>e.jsx("a",{href:U,target:"_blank",rel:"noopener noreferrer",className:"text-token-link hover:text-token-link-hover",children:m})}})}),e.jsxs("div",{className:"mt-6 flex w-full flex-col gap-3",children:[e.jsx(L,{className:"w-full rounded-md",color:"green",type:"submit",onClick:()=>{u.logEventWithStatsig(d.chatgptAccountLinkAllowClicked,"chatgpt_account_link_allow_clicked",{phoneNumber:s}),n()},disabled:t||l,loading:t,children:e.jsx(o,{id:"account-link.confirm.button",defaultMessage:"Allow"})}),e.jsx(L,{className:"w-full rounded-md",color:"secondary",onClick:()=>{u.logEventWithStatsig(d.chatgptAccountLinkCancelClicked,"chatgpt_account_link_cancel_clicked",{phoneNumber:s}),h()},disabled:l||t,children:e.jsx(o,{id:"account-link.confirm.cancel",defaultMessage:"Cancel"})})]})]})}function q({phoneNumber:s}){const n=_();return g.useEffect(()=>{u.logEventWithStatsig(d.chatgptAccountLinkSuccess,"chatgpt_account_link_success",{phoneNumber:s??void 0})},[s]),e.jsxs("div",{className:"flex w-full flex-col items-center justify-center px-4 py-10",children:[e.jsx("header",{className:"oai-header",children:e.jsx(j,{alt:n.formatMessage({id:"login.openAiLogo",defaultMessage:"OpenAI Logo"}),className:"h-10 w-10"})}),e.jsx("h1",{className:"mt-10 text-center text-3xl font-semibold",children:e.jsx(o,{id:"account-link.success.title",defaultMessage:"Successfully linked your ChatGPT account"})}),e.jsx("p",{className:"mt-6 text-center text-token-text-secondary",children:e.jsx(o,{id:"account-link.success.description",defaultMessage:"You can now close this window and return to WhatsApp, or you will be automatically redirected momentarily."})})]})}export{K as default};
//# sourceMappingURL=k9h23cpmfnhdjhxs.js.map
