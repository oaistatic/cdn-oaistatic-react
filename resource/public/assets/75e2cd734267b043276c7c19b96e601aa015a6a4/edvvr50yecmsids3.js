import{aj as P,bh as y,gz as V,d as g,fM as T,c3 as R,dg as U,d5 as j,c9 as G,b8 as $,b7 as J,bT as E,gA as W,e_ as Z,fi as Y,a6 as q,fT as Q}from"./mnkup87aq6tfilq5.js";import{r as x,j as e,M as d,d as F,au as D,u as K,z as X}from"./l6lryjpkt8rv0lpy.js";import{N as ee}from"./l4ce2zdnnawhaijx.js";import{hP as se,hQ as te,m as ae,hR as ie,hS as ne,hT as L,gW as oe,dn as re,dl as le,fZ as de,eY as ce}from"./dvllb5fed1b4y7k1.js";import{G as ue}from"./hli3paxjs6c9ftyy.js";import{G as me}from"./n0uc03yiz1ifva8y.js";import{F as C,a as h,b as k,c as xe,G as fe}from"./g9t9gdlptuqlckd3.js";const ge=x.memo(function({onSelectVersion:s,selectedVersion:t,currentVersion:r,gizmoVersions:i}){const{value:n}=P("3645668434");return n?e.jsx(pe,{selectedVersion:t,onSelectVersion:s,currentVersion:r,gizmoVersions:i}):null}),Ce=y.div`flex h-full w-full max-w-3xs flex-col overflow-y-scroll bg-token-sidebar-surface-primary px-2 py-6`;function pe({onSelectVersion:a,selectedVersion:s,currentVersion:t,gizmoVersions:r}){const i=r?.items.reduce((n,m)=>{const l=new Date(m.updated_at),c=`${l.getFullYear()}-${l.getMonth()+1}-${l.getDate()}`;return n[c]||(n[c]=[]),n[c].push(m),n},{});return i?e.jsx(Ce,{children:Object.keys(i).map((n,m)=>e.jsx(we,{date:n,entries:i[n],selectedVersion:s,onSelectVersion:a,currentVersion:t},m))}):null}const O=({name:a,userId:s,showName:t=!1})=>e.jsxs("div",{className:"flex items-center gap-1.5",children:[t&&e.jsx("span",{className:"max-w-[100px] text-ellipsis text-xs text-token-text-secondary",children:a}),e.jsx("div",{className:g("flex h-[18px] w-[18px] items-center justify-center rounded-full text-[8px] text-white",se(s)),children:te(a)})]}),he=y.div`flex w-full flex-col rounded-lg px-3 py-2 text-base hover:cursor-pointer hover:bg-token-sidebar-surface-tertiary`,je=y.div`px-3 text-sm font-medium text-token-text-secondary`,ye=y.div`flex flex-col space-y-1`,be=y.div`mb-8 flex flex-col space-y-2`,ve=y.span` text-xs text-token-text-secondary`,we=({date:a,entries:s,onSelectVersion:t,selectedVersion:r,currentVersion:i})=>e.jsxs(be,{children:[e.jsx(je,{children:e.jsx(V,{value:a,dateStyle:"medium"})}),e.jsx(ye,{children:s.map(({version:n,updated_at:m,author:l},c)=>e.jsxs(he,{className:g(r===n&&"bg-token-sidebar-surface-tertiary"),onClick:()=>t(n),children:[i===n&&e.jsx(ve,{children:e.jsx(d,{id:"gizmo.version.current",defaultMessage:"Current"})}),e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx("div",{className:"text-base",children:e.jsx(V,{value:m,timeStyle:"short"})}),l&&e.jsx(O,{showName:!0,name:l.user_name,userId:l.user_id})]})]},c))})]}),ze=a=>x.createElement("svg",{width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...a},x.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.33359 1.33325C7.70178 1.33325 8.00025 1.63173 8.00025 1.99992V13.9999C8.00025 14.3681 7.70178 14.6666 7.33359 14.6666C6.96539 14.6666 6.66692 14.3681 6.66692 13.9999V13.3333H5.17273C4.63608 13.3333 4.19317 13.3333 3.83237 13.3038C3.45764 13.2732 3.11317 13.2075 2.78961 13.0426C2.28785 12.7869 1.8799 12.379 1.62423 11.8772C1.45937 11.5537 1.39366 11.2092 1.36305 10.8345C1.34434 10.6055 1.33751 10.3435 1.33502 10.0455C1.33319 10.0186 1.33302 9.99171 1.33445 9.96494C1.33358 9.81672 1.33358 9.65989 1.33359 9.49412V6.50572C1.33358 5.96907 1.33357 5.52617 1.36305 5.16537C1.39366 4.79064 1.45937 4.44617 1.62423 4.12261C1.8799 3.62085 2.28785 3.2129 2.78961 2.95723C3.11317 2.79237 3.45764 2.72666 3.83237 2.69605C4.19316 2.66657 4.63607 2.66658 5.17272 2.66658L6.66692 2.66659V1.99992C6.66692 1.63173 6.96539 1.33325 7.33359 1.33325Z",fill:"currentColor"}),x.createElement("path",{d:"M10.8278 2.66658C11.3644 2.66658 11.8073 2.66657 12.1681 2.69605C12.5429 2.72666 12.8873 2.79237 13.2109 2.95723C13.7127 3.2129 14.1206 3.62085 14.3763 4.12261C14.5411 4.44617 14.6068 4.79064 14.6375 5.16537C14.6669 5.52617 14.6669 5.96907 14.6669 6.50572V9.49412C14.6669 10.0308 14.6669 10.4737 14.6375 10.8345C14.6068 11.2092 14.5411 11.5537 14.3763 11.8772C14.1206 12.379 13.7127 12.7869 13.2109 13.0426C12.8873 13.2075 12.5429 13.2732 12.1681 13.3038C11.8073 13.3333 11.3644 13.3333 10.8278 13.3333H10.0003C9.63206 13.3333 9.33359 13.0348 9.33359 12.6666C9.33359 12.2984 9.63206 11.9999 10.0003 11.9999H10.8003C11.3713 11.9999 11.7595 11.9994 12.0596 11.9749C12.3518 11.951 12.5013 11.9077 12.6056 11.8546C12.8565 11.7268 13.0604 11.5228 13.1883 11.2719C13.2414 11.1676 13.2847 11.0182 13.3086 10.7259C13.3331 10.4258 13.3336 10.0376 13.3336 9.46659V6.53325C13.3336 5.9622 13.3331 5.574 13.3086 5.27394C13.2847 4.98167 13.2414 4.8322 13.1883 4.72793C13.0604 4.47705 12.8565 4.27307 12.6056 4.14524C12.5013 4.09212 12.3518 4.04883 12.0596 4.02495C11.7595 4.00044 11.3713 3.99992 10.8003 3.99992H10.0003C9.63206 3.99992 9.33359 3.70144 9.33359 3.33325C9.33359 2.96506 9.63206 2.66659 10.0003 2.66659L10.8278 2.66658Z",fill:"currentColor"})),Ne=a=>x.createElement("svg",{width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...a},x.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8.00074 1.99967C8.00074 1.63148 7.70226 1.33301 7.33407 1.33301C6.96588 1.33301 6.66741 1.63148 6.66741 1.99967V2.66634L5.17321 2.66634H5.1732H5.1732H5.1732C4.63656 2.66633 4.19365 2.66633 3.83286 2.6958C3.45812 2.72642 3.11366 2.79213 2.7901 2.95699C2.28833 3.21265 1.88039 3.6206 1.62472 4.12237C1.45986 4.44592 1.39415 4.79039 1.36354 5.16512C1.33406 5.52592 1.33406 5.96883 1.33407 6.50548V9.49387C1.33407 9.65965 1.33407 9.81647 1.33493 9.9647C1.33351 9.99147 1.33368 10.0184 1.3355 10.0453C1.338 10.3433 1.34483 10.6053 1.36354 10.8342C1.39415 11.209 1.45986 11.5534 1.62472 11.877C1.88039 12.3787 2.28833 12.7867 2.7901 13.0424C3.11366 13.2072 3.45812 13.2729 3.83286 13.3035C4.19366 13.333 4.63657 13.333 5.17322 13.333H6.66741V13.9997C6.66741 14.3679 6.96588 14.6663 7.33407 14.6663C7.70226 14.6663 8.00074 14.3679 8.00074 13.9997V1.99967ZM12.1686 2.6958C11.8078 2.66633 11.3649 2.66633 10.8283 2.66634L10.0007 2.66634C9.63255 2.66634 9.33407 2.96482 9.33407 3.33301C9.33407 3.7012 9.63255 3.99967 10.0007 3.99967H10.8007C11.3718 3.99967 11.76 4.00019 12.06 4.02471C12.3523 4.04859 12.5018 4.09187 12.6061 4.145C12.8569 4.27283 13.0609 4.4768 13.1887 4.72769C13.2419 4.83195 13.2852 4.98142 13.309 5.2737C13.3336 5.57376 13.3341 5.96196 13.3341 6.53301V9.46634C13.3341 10.0374 13.3336 10.4256 13.309 10.7256C13.2852 11.0179 13.2419 11.1674 13.1887 11.2717C13.0609 11.5225 12.8569 11.7265 12.6061 11.8544C12.5018 11.9075 12.3523 11.9508 12.06 11.9746C11.76 11.9992 11.3718 11.9997 10.8007 11.9997H10.0007C9.63255 11.9997 9.33407 12.2982 9.33407 12.6663C9.33407 13.0345 9.63255 13.333 10.0007 13.333H10.8283C11.3649 13.333 11.8078 13.333 12.1686 13.3035C12.5434 13.2729 12.8878 13.2072 13.2114 13.0424C13.7131 12.7867 14.1211 12.3787 14.3768 11.877C14.5416 11.5534 14.6073 11.209 14.6379 10.8342C14.6674 10.4734 14.6674 10.0305 14.6674 9.49387V6.50548C14.6674 5.96883 14.6674 5.52592 14.6379 5.16512C14.6073 4.79039 14.5416 4.44592 14.3768 4.12237C14.1211 3.6206 13.7131 3.21265 13.2114 2.95699C12.8878 2.79213 12.5434 2.72642 12.1686 2.6958ZM2.69251 10.7257C2.68373 10.6182 2.67803 10.4994 2.67433 10.365L2.66748 8.79692V6.53309C2.66748 5.96204 2.668 5.57384 2.69251 5.27378C2.71639 4.9815 2.75968 4.83204 2.81281 4.72777C2.94064 4.47689 3.14461 4.27291 3.39549 4.14508C3.49976 4.09195 3.64923 4.04867 3.94151 4.02479C4.24157 4.00027 4.62976 3.99976 5.20081 3.99976H6.66748V9.90973V11.9998H5.20081C4.62976 11.9998 4.24157 11.9992 3.94151 11.9747C3.64923 11.9508 3.49976 11.9076 3.39549 11.8544C3.14461 11.7266 2.94064 11.5226 2.81281 11.2717C2.75968 11.1675 2.71639 11.018 2.69251 10.7257Z",fill:"currentColor"})),_e=({gizmoId:a,version:s,skip:t=!1})=>K({queryFn:async()=>le.getVersion({gizmoId:a,version:s}),queryKey:["gizmo","version",{gizmoId:a,version:s}],enabled:!t}),B=(a,s)=>`/gpts/editor/${a}?version=${s}`;function Me({gizmoId:a}){const{data:s,isLoading:t}=ae(a),{data:r}=ie({gizmoId:a}),i=s?.gizmo.live_version;return!s||!r||t||i==null?null:e.jsx(Ve,{gizmoResource:s,currentVersion:i,gizmoVersions:r})}function Ve({gizmoResource:a,currentVersion:s,gizmoVersions:t}){const r=F(),i=a.gizmo.id,n=a.gizmo.current_user_permission?.can_write,m=ne(),[l,c]=x.useState(s),[u,b]=x.useState(!1),[_,M]=x.useState(!1),w=()=>{r(l?B(i,l):de(i))},o=()=>{if(l!==s&&a.tools.find(N=>N.type===j.JIT_PLUGIN&&N.metadata.auth?.type!==W.None)){M(!0);return}r(B(i,l))},f=()=>{l===s&&s>1&&c(s-1),u&&c(s),b(!u)},v=s>1;x.useEffect(()=>{l===s&&b(!1)},[l,s]);const{data:p,isLoading:z}=_e({gizmoId:i,version:l});return e.jsxs("div",{className:"flex h-screen w-full flex-col items-center",children:[e.jsxs("div",{className:"sticky top-0 flex h-16 w-full items-center justify-between gap-2 border-b border-token-border-medium bg-token-main-surface-primary px-3 py-3",children:[e.jsxs("div",{className:"flex cursor-pointer items-center gap-2",onClick:()=>r(-1),children:[e.jsx(T,{className:"icon-lg"}),e.jsx("div",{className:"font-semibold",children:n?e.jsx(d,{id:"gizmoReadOnly.versionHistoryTitle",defaultMessage:"Version History"}):e.jsx(d,{id:"gizmoReadOnly.configurationTitle",defaultMessage:"Configuration"})})]}),e.jsxs("div",{className:"mr-4 flex gap-2",children:[v&&e.jsx(R,{label:e.jsx(d,{id:"gizmo.readonly.compareTooltip",defaultMessage:"Compare to the previous version"}),disabled:!v||u,children:e.jsx(L,{color:u?"primary":"secondary",className:g("btn rounded-full border transition-colors",u?g(ee,"border-transparent"):"border-token-border-light bg-transparent hover:bg-token-surface-hover"),onClick:f,icon:u?ze:Ne,children:u?e.jsx(d,{id:"gizmo.readonly.comparing",defaultMessage:"Comparing changes"}):e.jsx(d,{id:"gizmo.readonly.compare",defaultMessage:"Compare changes"})})}),n?e.jsx(R,{label:e.jsx(d,{id:"gizmo.readonly.restoreVersionTooltip",defaultMessage:"You will be able to edit before publishing"}),disabled:l===s,children:e.jsx(L,{color:"secondary",disabled:l===s,icon:oe,onClick:o,children:e.jsx(d,{id:"gizmo.readonly.restoreVersion",defaultMessage:"Restore this version"})})}):e.jsx(L,{color:"secondary",loading:m.isPending,onClick:async()=>{const N=await m.mutateAsync({gizmoId:i});N.gizmo.id&&r(`/gpts/editor/${N.gizmo.id}`)},children:e.jsx(d,{id:"gizmo.readonly.duplicate",defaultMessage:"Duplicate"})})]})]}),e.jsxs("div",{className:"flex w-full grow overflow-hidden",children:[n&&e.jsx(ge,{selectedVersion:l,currentVersion:s,onSelectVersion:c,gizmoVersions:t}),z&&e.jsx("div",{className:"flex h-full w-full grow flex-col items-center justify-center",children:e.jsx(U,{})}),p&&e.jsxs("div",{className:"flex h-full grow flex-wrap items-start justify-between gap-4 overflow-auto",children:[e.jsx(H,{displayGizmo:p,isComparing:u,gizmoVersions:t}),u&&e.jsx(H,{displayGizmo:a,compareToGizmo:p,setIsComparing:b,isComparing:!0,gizmoVersions:t})]})]}),_&&e.jsx(Ie,{onClose:()=>{M(!1)},onContinue:w})]})}const I=(a,s=[],t=[],r)=>a?[...t,...s.filter(r)]:s,S=(a,s)=>g(a&&s?"bg-blue-1000/10":"bg-token-main-surface-secondary");function H({isComparing:a,displayGizmo:s,compareToGizmo:t,setIsComparing:r,gizmoVersions:i}){const n=s.gizmo.display.name!==t?.gizmo.display.name,m=s.gizmo.display.description!==t?.gizmo.display.description,l=s.gizmo.instructions!==t?.gizmo.instructions,c=a&&!!t,u=I(c,s.gizmo.display.prompt_starters??[],t?.gizmo.display.prompt_starters??[],o=>!t?.gizmo.display.prompt_starters?.includes(o)),b=I(c,s.files??[],t?.files??[],o=>!t?.files?.find(f=>f.id===o.id)),_=I(c,s.tools?.filter(o=>o.type===j.JIT_PLUGIN)??[],t?.tools?.filter(o=>o.type===j.JIT_PLUGIN)??[],o=>o.type===j.JIT_PLUGIN&&!t?.tools.find(f=>f.type===j.JIT_PLUGIN&&f.metadata.action_id===o.metadata.action_id)),M=s.gizmo.display.profile_picture_url!==t?.gizmo.display.profile_picture_url,w=i.items.find(o=>o.version===s.gizmo.version)?.author;return e.jsx(D.div,{initial:{opacity:0,x:10},animate:{opacity:1,x:0},exit:{opacity:0,x:10},transition:{duration:.2},className:g("relative flex min-w-0 flex-1 flex-grow justify-center overflow-auto",c&&"border-l"),children:e.jsxs("div",{className:"flex w-full max-w-2xl flex-col px-4 py-8 text-sm",children:[e.jsxs(D.div,{initial:{opacity:a?0:1},animate:{opacity:a?1:0},transition:{duration:.2},className:"mb-4 flex w-full items-center justify-between",children:[e.jsx("div",{className:"text-base text-token-text-tertiary",children:t?e.jsx(d,{id:"gizmo.readonly.currentVersion",defaultMessage:"Current"}):e.jsx(d,{id:"gizmo.readonly.previousVersion",defaultMessage:"Previous version"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.gizmo.version_updated_at&&e.jsx("div",{className:"text-xs text-token-text-tertiary",children:e.jsx(d,{id:"gizmo.readonly.updatedAt",defaultMessage:"{date} at {time}",values:{date:e.jsx(V,{value:new Date(s.gizmo.version_updated_at),year:"numeric",month:"short",day:"numeric"}),time:e.jsx(V,{value:new Date(s.gizmo.version_updated_at),hour:"numeric",minute:"numeric"})}})}),w&&e.jsx(O,{name:w.user_name,userId:w.user_id}),t&&r&&e.jsx(G,{onClick:()=>r(!1)})]})]}),e.jsx(C,{className:"self-center",children:e.jsx(ue,{src:s.gizmo.display.profile_picture_url,isFirstParty:!1,className:g("h-20 w-20",M&&t&&"rounded-full border-4 border-blue-1000 border-opacity-10"),showLoading:!0})}),e.jsxs(C,{children:[e.jsx(h,{label:e.jsx(d,{id:"gizmo.readonly.nameLabel",defaultMessage:"Name"})}),e.jsx(k,{type:"text",value:s.gizmo.display.name??"",disabled:!0,className:S(c,n)})]}),e.jsxs(C,{children:[e.jsx(h,{label:e.jsx(d,{id:"gizmo.readonly.descriptionLabel",defaultMessage:"Description"})}),e.jsx(k,{type:"text",value:s.gizmo.display.description??"",disabled:!0,className:S(c,m)})]}),e.jsxs(C,{children:[e.jsx(h,{label:e.jsx(d,{id:"gizmo.readonly.instructionsLabel",defaultMessage:"Instructions"})}),e.jsx(xe,{rows:8,value:s.gizmo.instructions??"",disabled:!0,className:g("resize-none",S(c,l))})]}),u.length>0&&e.jsxs(C,{children:[e.jsx(h,{label:e.jsx(d,{id:"gizmo.readonly.conversationStartersLabel",defaultMessage:"Conversation starters"})}),u.map((o,f)=>{const v=!t?.gizmo.display.prompt_starters?.includes(o),p=!s.gizmo.display.prompt_starters?.includes(o);return e.jsx(k,{type:"text",value:o,disabled:!0,className:g("mb-2 resize-none bg-token-main-surface-secondary",A(c,v,p))},f)})]}),b.length>0&&e.jsxs(C,{children:[e.jsx(h,{label:e.jsx(d,{id:"gizmo.readonly.knowledgeLabel",defaultMessage:"Knowledge"})}),e.jsx("div",{className:"flex flex-wrap gap-1",children:b.map((o,f)=>{const v=!t?.files?.find(z=>z.id===o.id),p=!s.files?.find(z=>z.id===o.id);return e.jsx(re,{file:o.name,fileId:o.id,className:A(c,v,p)},f)})})]}),e.jsxs(C,{children:[e.jsx(h,{label:e.jsx(d,{id:"gizmo.readonly.capabilitiesLabel",defaultMessage:"Capabilities"})}),e.jsx(me,{enabledTools:s.tools,diffedEnabledTools:t?.tools,onEnabledToolsChange:$})]}),!!_.length&&e.jsxs(C,{children:[e.jsx(h,{label:e.jsx(d,{id:"gizmo.readonly.actionsLabel",defaultMessage:"Actions"})}),e.jsx("div",{className:"flex flex-col gap-1",children:_.map((o,f)=>e.jsx(ke,{tool:o,isDiffed:c,compareToGizmo:t,displayGizmo:s},f))})]})]})})}const Le=y.textarea`mb-8 rounded-lg block h-96 w-full border-token-main-surface-tertiary bg-transparent p-2 font-mono text-xs text-token-text-primary`,ke=({tool:a,compareToGizmo:s,displayGizmo:t,isDiffed:r})=>{const i=a,[n,m]=x.useState(!1),l=!s?.tools?.find(u=>u.type===j.JIT_PLUGIN&&u.metadata.action_id===i.metadata.action_id),c=!t.tools.find(u=>u.type===j.JIT_PLUGIN&&u.metadata.action_id===i.metadata.action_id);return e.jsxs(e.Fragment,{children:[e.jsx(fe,{isDisabled:!1,actionTool:i,className:A(r,l,c),onShowActionsEditor:()=>m(u=>!u)}),n&&e.jsx(Le,{readOnly:!0,value:i.metadata.raw_spec??""})]})},A=(a,s,t)=>g(a&&s&&"!bg-blue-1000/10",a&&t&&"!bg-blue-1000/10 text-token-text-secondary line-through opacity-50");function Ie({onClose:a,onContinue:s}){const[t,r]=x.useState(!1);return e.jsx(J,{isOpen:!0,onClose:a,type:"warning",showCloseButton:!0,title:e.jsx(d,{id:"gizmoReadOnly.authModalWarningTitle",defaultMessage:"Reset Authentication for Custom Actions"}),primaryButton:e.jsx(E,{onClick:()=>{r(!0),s()},loading:t,color:"secondary",children:e.jsx(d,{id:"gizmoReadOnly.authModalContinueButton",defaultMessage:"Continue"})}),secondaryButton:e.jsx(E,{onClick:a,color:"secondary",children:e.jsx(d,{id:"gizmoReadOnly.authModalCancelButton",defaultMessage:"Cancel"})}),size:"normal",children:e.jsx(d,{id:"gizmoReadOnly.authModalWarningBody",defaultMessage:"Restoring this version will reset authentication of your custom actions. You may need to reconfigure each custom action afterwards."})})}const Pe=()=>(Y(),null),Fe=Z(function(){const s=q(),t=F(),i=X().gizmoId??"",n=Q(i),{value:m}=P("3645668434");return x.useEffect(()=>{s!=null&&s.isFree()&&t("/")},[s,t]),x.useEffect(()=>{n&&ce(n)&&t(`/g/${i}/project`)},[n,t,i]),m?e.jsx(Me,{gizmoId:n}):null});export{Pe as clientLoader,Fe as default};
//# sourceMappingURL=edvvr50yecmsids3.js.map
