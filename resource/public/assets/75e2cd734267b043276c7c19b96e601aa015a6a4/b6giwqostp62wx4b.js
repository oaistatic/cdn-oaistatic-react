import{r as h,aZ as K,h as X,c as Z,j as i,au as f,aw as $}from"./l6lryjpkt8rv0lpy.js";import{ic as J,id as Q,ie as ee,C as g,ig as te,hz as se,ih as ae,ds as oe,ii as ie,ij as ne,ik as re,il as ce,dA as de,cD as N,im as le,io as ue,ip as he,iq as M,ir as U,dy as me,w as W,is as pe,it as fe,iu as ge,u as xe,iv as D,U as j,iw as F}from"./dvllb5fed1b4y7k1.js";import{gG as E,a0 as O,U as ve,s as k,W as Ce,ei as we,q as Se,gH as Te,ex as be,dU as L,fV as ye,d as Ie,gI as Ee}from"./mnkup87aq6tfilq5.js";import{L as Ae}from"./d6vtla9za6od171e.js";import{u as Re}from"./ffxduo863rikjmz1.js";import{T as _e}from"./byuiu3x6cts4tfgw.js";import{g as Ne}from"./btagl6w1gub4aw61.js";import"./l4ce2zdnnawhaijx.js";import"./gffbkcdjbbbnp8kb.js";import"./no74ca53mzecj421.js";import"./oik4rnml2048h1rb.js";import"./za47cv3m73qs1c5u.js";import"./gy64pge8qevmvg7e.js";import"./h4jw8c63q447uotc.js";import"./ele1ib7knnne85uk.js";import"./cbms2jcglp4b707f.js";import"./1e3kywkhcjn5spyo.js";import"./f651cyqvxf3m7zo6.js";import"./0b2acbvk15dg7sha.js";import"./jnjzqafy9dn7o7ce.js";import"./cgqlugpygnveiuks.js";import"./fzrn137102spawew.js";import"./gry6c7en9b8uaktm.js";import"./ipgaseve9xp2bi1a.js";import"./dssqb33wed4i78fb.js";import"./d5w25xgxcglldc4u.js";import"./nxg0mr2frwehg6na.js";import"./4wfwbvmzqu7tbfmg.js";import"./lrbwp2trsv9othld.js";import"./bk8slwxjkdlmxjxm.js";import"./hjvhqy8z9mtcdx24.js";import"./bec9qm8zi6ffweg0.js";import"./jm8zus0mi88xmv2y.js";const P="oai/apps/canmoreSidebarWidth",Me=.25,We=400,H=400;function V(e){return e-We}function y(e,t){return K(H,V(e),t??Me*e)}function De(){const e=E.useState(E.selectWindowWidth),t=y(e,J(O.DANGER_SECRET_FOLDERS_ONLY_getItem(P))),a=z(),[s,c]=h.useState(t);h.useEffect(()=>{(s<H||s>V(e))&&c(y(e,s))},[e]);function o(l){c(x=>y(e,x+=l.delta.x))}function d(l){c(l),O.DANGER_SECRET_FOLDERS_ONLY_setItem(P,l)}function n(){const l=y(e,void 0);d(l)}const r=`calc(100vw - ${s}px)`;return a?{chatWidth:s,canvasWidth:e-s,canvasWidthCalc:r,viewportWidth:e,handleDrag:o,handleDoubleClick:n,persist:d}:{chatWidth:0,canvasWidth:e,canvasWidthCalc:"100vw",viewportWidth:e,handleDrag:()=>{},handleDoubleClick:()=>{},persist:()=>{}}}function z(e){const t=E.useState(E.selectWindowWidth);return(e??t)>1e3}const R="sharedCanvas";function je(){const[e,t]=X(),a=e.get(R),s=Z();h.useEffect(()=>{const c=a&&Q.createRemixTempTextdoc(a,s);if(!c)return;requestAnimationFrame(()=>{ee(c)});const o=new URLSearchParams(e);o.delete(R),t(o);const d=new URL(window.location.href);d.searchParams.delete(R),history.replaceState(null,"",d)},[a,e,t,s])}function Fe(e,t){let a;return t?.type===g.Textdoc&&(t.textdocId.startsWith(te)||(a={type:"canvas_textdoc",id:t.textdocId})),{...e,messageMetadata:{...e.messageMetadata,open_in_canvas_view:a}}}const G=({isFullScreen:e=!1,clientThreadId:t,focusedObject:a,onClose:s,isAnimating:c=!1,width:o})=>{const{setTargetedContent:d}=se(),n=h.useRef(!1);if(h.useEffect(()=>(n.current&&d(void 0),n.current=!0,()=>{n.current=!1}),[a]),a==null)return null;switch(a.type){case g.Textdoc:return i.jsx(_e,{isFullScreen:e,onClose:s,clientThreadId:t,focusedTextdoc:a,isAnimating:c,width:o});case g.ADAVisualization:return null;case g.Sonic:return!1}},Oe=300,ke=e=>{switch(e?.type){case g.Textdoc:return e.textdocId;case g.Sonic:return e.messageId;default:return null}};function Pe(e,t){const[a,s]=ve(e,p=>[k.getRequestId(p),k.isMessageTurnEnded(p)]),c=Ce(a),o=we(e),d=ae(),n=oe(),[r,l]=h.useMemo(()=>{if(o&&ie(o))return[void 0,null];if(t===!0)return[void 0,null];let p;return!s&&o&&(p=Se(ne(o.messages))),Ue({clientThreadId:e,groupedMessage:p,isRequestActive:c,isCanvasOpen:n,latestTextdocId:d})},[s,o,t,e,c,n,d]),x=l!=null,T=ke(l),v=re("canvas");h.useEffect(()=>{if(l&&r&&!Te()&&(v(),ce(l,r),l.type===g.Textdoc)){const{textdocId:p}=l,C=Ne(p);de(document.getElementById(C))}},[x,T])}function Ue({clientThreadId:e,groupedMessage:t,isRequestActive:a,isCanvasOpen:s,latestTextdocId:c}){switch(t?.type){case N.Canmore:{const[o,d]=t.messages;if(!le(o?.message))break;const n=ue(a,o.message,d?.message??null),r=n.textdocId??c;if(r&&(n.function===he.CreateTextdoc?(n.content??"").length>Oe||n.status===M.WAITING:n.status===M.STREAMING))return[n.messageId,{type:g.Textdoc,textdocId:r}];break}case N.SonicCanvas:break}return[void 0,null]}const Le=260,I={type:"spring",bounce:.12,duration:.64},He={type:"spring",bounce:0,duration:.58},Ve=({clientThreadId:e,focusedObject:t,onClose:a})=>{const{chatWidth:s,canvasWidthCalc:c,handleDrag:o,handleDoubleClick:d,persist:n}=De(),r=L(),[l,x]=h.useState(!0),[T,v]=h.useState(!1),p=W(u=>u.activeSidebar),C=pe(({rect:u})=>u),{windowHeight:w,windowWidth:S}=ye(u=>u,{windowWidth:0,windowHeight:0});let m=C??{top:0,left:s,width:S-s,height:w},_=!1;if(C&&(m.top<0||m.top+m.height>w)){_=!0;const u={width:(S-s)*.75,height:w*.75};m={top:w/2-u.height/2,left:(S-s-u.width)/2+s,width:u.width,height:u.height}}if(r){const u=S-m.width-m.left;m={...m,left:-u}}const b=C?.borderRadius,A=fe(),q=A?.history!=null||A?.showChangesAtVersion!=null,B=W(u=>u.isDesktopNavCollapsed);return i.jsxs(i.Fragment,{children:[q&&i.jsx(Ae,{onClick:()=>ge(A.textdocId),zIndexKey:"chatOverlay"}),i.jsxs(f.div,{initial:!r&&{marginRight:B?0:-Le},animate:!r&&{marginRight:0},transition:He,children:[i.jsx(f.div,{initial:{opacity:1},animate:{opacity:0},exit:{opacity:[1,0]},transition:{...I,delay:.22},className:"pointer-events-none absolute left-0 top-0 z-20 h-full w-full bg-token-main-surface-primary"}),!r&&i.jsx(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"pointer-events-none absolute left-0 top-0 z-10 h-full w-full bg-black/[0.025] dark:bg-transparent"}),i.jsx(f.div,{className:"relative z-20 h-full",style:{width:c},exit:{width:0},transition:{type:"spring",bounce:0,duration:.1}})]}),i.jsx(f.div,{className:Ie("absolute z-20 h-full transition-shadow",r&&"right-0 max-h-[100cqh] max-w-[var(--available-details-width)] overflow-y-auto overflow-x-clip",!r&&"overflow-hidden",!r&&(p==="debug"?"md:left-[-250px] lg:left-[-300px] xl:left-[-350px] 2xl:left-[-400px]":"left-0")),initial:{borderRadius:b,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)",opacity:_?0:1,x:m.left,y:m.top,height:m.height,width:m.width},animate:{opacity:1,x:r?0:s,y:0,width:c,height:w,borderRadius:0,boxShadow:"0px 0px 18px rgba(0,0,0,0.075)"},exit:{scale:.64,opacity:0,filter:"blur(12px)",transition:{opacity:{duration:.14,bounce:.1}},borderRadius:b,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)"},transition:T?{duration:0}:I,onAnimationComplete:()=>x(!1),children:i.jsx(f.div,{className:"h-full overflow-hidden border-l border-gray-100 dark:border-token-border-medium",initial:{borderRadius:b},animate:{borderRadius:0},exit:{borderRadius:b},transition:I,children:i.jsxs("div",{className:"h-full",children:[i.jsx(f.div,{drag:"x",className:"absolute left-[-2px] z-10 h-full w-[4px] cursor-ew-resize bg-token-text-quaternary opacity-0",whileHover:{opacity:.5},whileDrag:{opacity:.75,width:"8px",left:"-4px"},transition:{type:"tween",duration:.1},style:{x:0,y:0,transform:"translateX(0px)"},dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:{left:0,right:0,top:0,bottom:0},onPointerDown:()=>v(!0),onPointerUp:()=>v(!1),onDrag:(u,Y)=>o(Y),onDragEnd:()=>{v(!1),n(s)},onDoubleClick:()=>d()}),T&&i.jsx("div",{className:"absolute inset-0 z-10"}),i.jsx(G,{onClose:a,clientThreadId:e,isAnimating:l,focusedObject:t,width:S-s})]})})})]})},ze=h.memo(Ve),Ge=({clientThreadId:e,focusedObject:t,onClose:a})=>i.jsx(Ee,{children:i.jsx(f.div,{className:"fixed inset-0 z-40 overflow-hidden shadow-xl md:border-gray-100 md:dark:border-gray-700",initial:{scale:.98},animate:{scale:1},transition:I,children:i.jsx(G,{isFullScreen:!0,clientThreadId:e,focusedObject:t,onClose:a})})}),qe=({clientThreadId:e,overrideWidth:t,isAutoFocusDisabled:a=!1})=>{const s=z(t),c=Re(e);Pe(e,a),je();const o=xe();h.useEffect(()=>{U()},[e]);const d=o&&(s?i.jsx(ze,{clientThreadId:e,onClose:F,focusedObject:o},"canvas-sidebar"):i.jsx(Ge,{clientThreadId:e,onClose:F,focusedObject:o},"canvas-modal"));h.useEffect(()=>{if(o)return D(x=>Fe(x,o)),()=>D(null)},[o]);const n=L(),r=d!=null;return h.useEffect(()=>{if(!n)return j.setActiveStageSidebar(r),()=>{r&&j.setActiveStageSidebar(!1)}},[r,n]),c!==e?null:i.jsx($,{children:d})},It=e=>{const t=h.useRef(null);return i.jsx(be,{ref:t,onError:(a,s)=>{U(),setTimeout(()=>{t.current?.resetErrorBoundary()}),me.logError("Error boundary hit",a,{componentStack:s})},name:"canmore-focused-view",children:i.jsx(qe,{...e})})};export{It as CanvasFocusedViewManager};
//# sourceMappingURL=b6giwqostp62wx4b.js.map
