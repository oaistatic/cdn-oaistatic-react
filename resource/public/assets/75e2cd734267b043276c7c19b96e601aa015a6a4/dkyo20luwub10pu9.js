import{r as c,j as e,a$ as ft,b0 as Yt,b1 as pt,b2 as $t,b3 as gt,au as k,c as Nt,aw as U,M as Jt}from"./l6lryjpkt8rv0lpy.js";import{c as qt,a as Kt,s as Qt,t as te,B as ee,I as oe,g as se,b as ne,d as ae,P as et,T as ht}from"./l3oey80jne0m4i7r.js";import{c as re,bw as ie,d as L,ba as le,h as St,Z as It,D as ce,gG as at,e as de,c1 as me,f as ue}from"./mnkup87aq6tfilq5.js";import{b as fe,S as pe,g as ge,u as yt,D as he,c as be}from"./byuiu3x6cts4tfgw.js";import{b as xe,T as Ee,a as Te,c as j,A as bt,u as Ce,i as ve,C as Ae,g as xt}from"./ns08nk6gry8lf6yi.js";import{b as we}from"./oik4rnml2048h1rb.js";import{C as ot,M as Re,c as Oe,d as Et,e as Me}from"./d6vtla9za6od171e.js";import{h as rt,j as Ne,k as Pt,d as X}from"./za47cv3m73qs1c5u.js";import{T as Tt,Z as Se,C as Ie}from"./l4ce2zdnnawhaijx.js";import{gM as _t,dy as A,ic as ye,lI as Pe,g as _e,dz as I,lJ as je,j8 as ke,j9 as Le,gL as Be}from"./dvllb5fed1b4y7k1.js";import{u as Ct,H as He,v as De}from"./j0lbvh7yyn1vzttk.js";import{T as Ve,s as jt}from"./jnjzqafy9dn7o7ce.js";import"./chwpaxfxk9st7eq2.js";import"./dssqb33wed4i78fb.js";import"./cbms2jcglp4b707f.js";import"./1e3kywkhcjn5spyo.js";import"./jm8zus0mi88xmv2y.js";import"./b4zl6usbni9k59c7.js";import"./hklpkipqhzi68oi6.js";import"./i822scwyjyzhmdym.js";import"./h4jw8c63q447uotc.js";import"./eivflkxhgemu4u0k.js";import"./f651cyqvxf3m7zo6.js";import"./0b2acbvk15dg7sha.js";import"./cgqlugpygnveiuks.js";import"./fzrn137102spawew.js";import"./gry6c7en9b8uaktm.js";import"./ipgaseve9xp2bi1a.js";import"./d5w25xgxcglldc4u.js";import"./nxg0mr2frwehg6na.js";import"./4wfwbvmzqu7tbfmg.js";import"./no74ca53mzecj421.js";import"./lrbwp2trsv9othld.js";import"./gy64pge8qevmvg7e.js";import"./bk8slwxjkdlmxjxm.js";import"./hjvhqy8z9mtcdx24.js";import"./bec9qm8zi6ffweg0.js";import"./ffxduo863rikjmz1.js";import"./gaz67n36d71l6yif.js";import"./gffbkcdjbbbnp8kb.js";import"./ele1ib7knnne85uk.js";function We(t,s){c.useEffect(()=>{const n=t?.current;if(n!=null)return re(n,{mousedown:d=>{s.current?.maybeFocusOnEditor(d)===!0&&d.preventDefault()}})},[s,t])}const Fe=({wrapperClassName:t,value:s="",width:n,comments:d,paddingBottom:p})=>{const l=c.useRef(null),a=c.useRef(null),i=ie();return c.useEffect(()=>{const{current:f}=l;if(f)return a.current=qt({mount:f,comments:d,value:s,isDarkMode:i}),()=>{a.current?.destroy()}},[]),c.useEffect(()=>{const f=Kt(s,d);a.current?.updateState(f)},[s,d]),e.jsx("div",{className:t,children:e.jsx("div",{ref:_t(l),className:L(Qt.main,"markdown prose dark:prose-invert focus:outline-none"),style:{width:n,paddingBottom:p}})})},kt=t=>!t||"docView"in t&&t.docView==null||xe(t.state.doc),z=100,Ge={type:"spring",duration:1.5,bounce:.1},Xe={type:"spring",duration:.5,bounce:0},vt={type:"spring",duration:.2},At={type:"spring",duration:1,delay:.1},ze={type:"spring",duration:1},Ue={type:"spring",duration:.5,bounce:0},Ze=({isRewriting:t=!1,value:s,previousValue:n,previousComments:d,documentWidth:p,paddingBottom:l,onStart:a})=>{const i=rt(),f=ft(0),m=ft(-z),E=c.useRef(!1),[u,b]=Yt();le(()=>{const o=i();return o&&(o.dom.style.clipPath="inset(0 0 100% 0)"),()=>{const r=i();r&&(r.dom.style.clipPath="")}},[]),c.useEffect(()=>{const o=i();if(!o||kt(o))return u?void 0:b?.();try{const r=Ne(o.state.doc)?.end;if(r==null||r>s.length)return;const{top:g}=o.coordsAtPos(0),{top:h,bottom:C}=o.coordsAtPos(Math.max(o.state.doc.content.size-1,0),-1),T=C-g,w=h-g;if(f.set(T-w),!u){pt(m,T+2*f.get(),Xe).then(()=>b?.());return}pt(m,T,Ge)}catch(r){A.logError("Failed to set rewrite animation position",r),b?.()}},[u,s]);const v=$t(m,o=>ye(o)-z+2);return gt(m,"change",o=>{const r=i();!r||!o||!E.current||(r.dom.style.clipPath=`inset(0 0 calc(100% - ${o}px) 0)`)}),gt(m,"animationStart",()=>{t&&a?.()}),e.jsxs(e.Fragment,{children:[e.jsx(k.div,{className:"absolute top-0 z-10 w-full origin-bottom bg-gradient-to-t from-token-main-surface-primary from-10% to-transparent",style:{translateY:v,height:z},initial:{opacity:0},animate:{opacity:1,transition:vt},exit:{opacity:0,transition:At},onAnimationComplete:()=>E.current=!0},"wash-top"),e.jsx(k.div,{className:"absolute top-0 z-10 w-full bg-gradient-to-b from-token-main-surface-primary to-transparent",style:{translateY:m,height:z},initial:{opacity:0},animate:{opacity:1,transition:vt},exit:{opacity:0,transition:At}},"wash-bottom"),e.jsx(k.div,{className:"pointer-events-none absolute z-0 min-w-0 max-w-full",initial:{opacity:1},animate:{opacity:.3,transition:ze},exit:{opacity:0,transition:Ue},children:e.jsx(Fe,{value:n,width:p,comments:d,wrapperClassName:"h-fit flex",paddingBottom:l})},"previousValue")]})},Ye=t=>c.createElement("svg",{width:16,height:17,viewBox:"0 0 16 17",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},c.createElement("path",{d:"M5.11619 13.8334C4.41395 13.8334 4 13.4047 4 12.6655V4.32729C4 3.59548 4.41395 3.16675 5.11619 3.16675H8.64218C10.6454 3.16675 11.9021 4.19424 11.9021 5.82787C11.9021 6.99581 11.0298 7.97155 9.89882 8.14157V8.20071C11.3477 8.31158 12.4121 9.36864 12.4121 10.7805C12.4121 12.6581 11.0002 13.8334 8.72349 13.8334H5.11619ZM6.23239 7.60195H7.83645C9.02657 7.60195 9.70663 7.07712 9.70663 6.1753C9.70663 5.31782 9.10788 4.82995 8.0656 4.82995H6.23239V7.60195ZM6.23239 12.1702H8.15431C9.44052 12.1702 10.1354 11.6232 10.1354 10.6031C10.1354 9.60519 9.41834 9.07296 8.10256 9.07296H6.23239V12.1702Z",fill:"currentColor"})),$e=t=>c.createElement("svg",{width:16,height:17,viewBox:"0 0 16 17",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},c.createElement("path",{d:"M9.94587 13.3511C9.89814 13.6297 9.6566 13.8334 9.37393 13.8334H4.95078C4.59259 13.8334 4.31994 13.5121 4.37824 13.1587C4.42447 12.8785 4.66675 12.6729 4.95077 12.6729H6.60855L8.09599 4.32729H6.62967C6.27148 4.32729 5.99883 4.00598 6.05714 3.65257C6.10337 3.37234 6.34565 3.16675 6.62967 3.16675H11.054C11.4108 3.16675 11.683 3.4856 11.6271 3.83793C11.5824 4.11979 11.3394 4.32729 11.054 4.32729H9.39198L7.90454 12.6729H9.37393C9.73357 12.6729 10.0066 12.9967 9.94587 13.3511Z",fill:"currentColor"}));function wt(t,s){if(t==null)return!1;const n=t.state.schema.marks[s];return n==null?!1:te(t.state,t.dispatch,n)}function st(t,s){if(t==null)return!1;const{state:n,dispatch:d}=t,p=It(n.schema.nodes[He.proseMirrorNodeName()]);return jt(p,{level:s})(n,d)}function Je(t){if(t==null)return!1;const{state:s,dispatch:n}=t,d=It(s.schema.nodes[De.proseMirrorNodeName()]);return jt(d)(s,n)}const qe=({availableWidth:t,onAddComment:s,isSendDisabled:n=!1,isWaitingForCommentResponse:d=!1,onSubmitAccelerator:p})=>{const l=Nt(),a=rt(),i=Pt(),f=Pe(),m=c.useCallback(o=>{const{width:r,height:g}=o,h=a();if(!i||!h||kt(h))return null;const{to:C,empty:T,head:w}=i.selection,{platform:y}=_e(),B=y==="web"?w:C,P=B===C;if(T||!Ct(h.state.doc,B))return null;const{right:Z,left:R,top:_}=h.coordsAtPos(0);let M=B,V=h.state.doc.nodeAt(M);const W=P?-1:1;for(;!V?.isText&&Ct(h.state.doc,M+W);)M+=W,V=h.state.doc.nodeAt(M);const{left:F,bottom:H,top:Y}=h.coordsAtPos(M,P?-1:1),G=Z-R;function $(){if(P)return Math.max(F-R-r,0);let S=F-R;return S+r>G&&(S=-(r-G)),S}function N(){const S=window.innerHeight-H>g*2;return P&&S?{top:H-_+8,aboveOrBelow:bt.BELOW}:{top:Y-_-g-8,aboveOrBelow:bt.ABOVE}}const D=N();return{left:$(),top:D.top,aboveOrBelow:D.aboveOrBelow,toolbarSize:o}},[i,a]),E=c.useCallback(()=>a()?.dom??null,[a]),u=[{label:l.formatMessage(O.heading1),className:"text-5xl font-semibold",onClick:()=>{A.logButtonClick(I.TOOLBAR_FORMAT_HEADER1),st(a(),1)}},{label:l.formatMessage(O.heading2),className:"text-3xl font-semibold",onClick:()=>{A.logButtonClick(I.TOOLBAR_FORMAT_HEADER2),st(a(),2)}},{label:l.formatMessage(O.heading3),className:"text-2xl font-semibold",onClick:()=>{A.logButtonClick(I.TOOLBAR_FORMAT_HEADER3),st(a(),3)}},{label:l.formatMessage(O.body),className:"text-base",onClick:()=>{A.logButtonClick(I.TOOLBAR_FORMAT_PARAGRAPH),Je(a())}}],b=()=>{const o=a();if(!o)return null;const{state:r}=o,{from:g,to:h,sourceFrom:C,sourceTo:T}=ge(r);return g==null||h==null||C==null||T==null?(A.logError("Prosemirror getSelectionRange has null values",null,{from:g,to:h,sourceFrom:C,sourceTo:T}),null):{from:g,to:h,sourceFrom:C,sourceTo:T}},v=(o,r)=>{const g=a(),h=b();if(h==null)return;const{sourceFrom:C,sourceTo:T}=h,w={start:C,end:T};if(i&&g){const y=i.tr.setSelection(Ve.create(i.doc,i.selection.anchor));g.dispatch(y)}A.logButtonClick(I.TOOLBAR_FORMAT_STYLE,{action:{action:r.action,id:r.id,title:r.title},prompt:o,sourceFrom:C,sourceTo:T}),p?.(w,l.formatMessage(o),r)};return e.jsxs(Ee,{isWaitingForCommentResponse:d,isSendDisabled:n,onAddComment:s,toolbarType:Te.WRITING,getToolbarPosition:m,getEditorDom:E,getSelectionRange:b,children:[f&&e.jsxs(e.Fragment,{children:[e.jsx(j.Separator,{}),e.jsx(j.Popover,{label:l.formatMessage(O.format),hideLabel:t<=400,icon:je,align:"center",children:e.jsx("div",{className:L("flex w-48 flex-col items-stretch rounded-xl border border-token-border-light bg-token-main-surface-primary p-1",Tt),children:fe.map(o=>{const{title:r,icon:g}=o;return e.jsxs("button",{onClick:()=>{"prompt"in o&&v(o.prompt,o)},className:"flex flex-row items-center gap-x-2 rounded-md bg-token-main-surface-primary p-3 hover:bg-[#f5f5f5] dark:hover:bg-token-main-surface-secondary",children:[e.jsx("div",{className:"flex",children:e.jsx(g,{className:"icon-md"})}),e.jsx("div",{className:"line-clamp-1 flex-auto text-start text-sm",children:l.formatMessage(r)})]},o.id)})})})]}),e.jsx(j.Separator,{}),e.jsx(j.Action,{label:l.formatMessage(O.bold),hideLabel:!0,icon:Ye,onClick:()=>{A.logButtonClick(I.TOOLBAR_FORMAT_BOLD),wt(a(),ee.proseMirrorMarkName())},onMouseDown:o=>o.preventDefault()}),e.jsx(j.Action,{label:l.formatMessage(O.italic),hideLabel:!0,icon:$e,onClick:()=>{A.logButtonClick(I.TOOLBAR_FORMAT_ITALIC),wt(a(),oe.proseMirrorMarkName())},onMouseDown:o=>o.preventDefault()}),e.jsx(j.Popover,{label:l.formatMessage(O.format),hideLabel:!0,icon:pe,children:e.jsx("div",{className:L("flex flex-col items-stretch rounded-xl border border-token-border-light bg-token-main-surface-primary p-1",Tt),children:u.map(({label:o,className:r,onClick:g})=>e.jsx("button",{onClick:g,className:"w-full rounded-xl p-4 text-start hover:bg-token-main-surface-secondary",children:e.jsx("div",{className:r,children:o})},o))})})]})},O=St({bold:{id:"qqbk91",defaultMessage:"Bold"},italic:{id:"5oh4LV",defaultMessage:"Italic"},format:{id:"z8IGv0",defaultMessage:"Transform"},heading1:{id:"AR5o30",defaultMessage:"Heading 1"},heading2:{id:"zb/wrc",defaultMessage:"Heading 2"},heading3:{id:"xZJvLM",defaultMessage:"Heading 3"},body:{id:"Hi6z3L",defaultMessage:"Body"},caption:{id:"VXpL7v",defaultMessage:"Caption"},bullets:{id:"2vznKX",defaultMessage:"Bullets"},outline:{id:"Xmbt6r",defaultMessage:"Outline"},table:{id:"0UjL6P",defaultMessage:"Table"}});function Rt({position:t,numEdits:s,closestEditId:n}){const d=yt(),p=Nt(),l=t==="top"?ke:Le,a=()=>{const f=d();if(!f||!n)return;const m=se(f,n);if(m.length===0){ce.addError("Edit could not be found while attempting to scroll",{closestEditId:n});return}m[t==="top"?0:m.length-1].scrollIntoView({behavior:"smooth",block:"center"})},i=t==="top"?-4:4;return e.jsx(U,{children:s>0&&e.jsx(k.div,{className:L("absolute left-1/2 z-20 select-none",{"bottom-[20px]":t==="bottom","top-[20px]":t==="top"}),initial:{scale:.95,translateY:i,translateX:"-50%",opacity:0},animate:{scale:1,translateY:0,translateX:"-50%",opacity:1},exit:{scale:.95,translateY:i,translateX:"-50%",opacity:0},transition:{type:"spring",duration:.3},children:e.jsxs("div",{className:L("flex items-center justify-center rounded-full border px-4 py-2","border-token-main-surface-tertiary bg-token-main-surface-primary shadow-md hover:bg-token-main-surface-secondary"),"aria-label":p.formatMessage(Ot.ariaLabel),role:"button",onClick:a,children:[e.jsx(Jt,{...Ot.label,values:{count:s}}),e.jsx(l,{className:"icon-sm ml-2"})]})})})}const Ot=St({label:{id:"Pf30w4",defaultMessage:"{count, plural, one {1 more edit} other {{count} more edits}}"},ariaLabel:{id:"qTJjzl",defaultMessage:"Button to scroll the next edit into view."}});function Ke({diff:t=null}){const s=yt(),[n,d]=c.useState([]),[p,l]=c.useState([]),a=at.useState(at.selectWindowHeight),i=c.useCallback(()=>{const f=s();if(!f||!t)return;const m=[],E=[];for(const u of t.edits){const b=ne(f,u.id);if(b.length>0){const v=ae(b);v.bottom<0?m.push([u.id,v]):v.top>a&&E.push([u.id,v])}}m.sort(([,u],[,b])=>u.bottom-b.bottom),E.sort(([,u],[,b])=>u.top-b.top),d(m.map(([u])=>u)),l(E.map(([u])=>u))},[t,a,s]);return Ce(t?.edits??[],i),c.useEffect(()=>{const f=setTimeout(i,500);return()=>{clearTimeout(f)}},[i]),e.jsxs(e.Fragment,{children:[e.jsx(Rt,{position:"top",numEdits:n.length,closestEditId:n[n.length-1]}),e.jsx(Rt,{position:"bottom",numEdits:p.length,closestEditId:p[0]})]})}const Mt=de(()=>({rejectedEdits:new Set,hoveredEditId:null})),Qe=({pos:t})=>{const s=rt()(),n=Pt();if(!s||!n||t==null)return null;const{doc:d}=n,{top:p,left:l}=s.coordsAtPos(0),{top:a,left:i}=s.coordsAtPos(t),f=d.nodeAt(t),m=t+(f?.nodeSize??0)-1,{top:E}=s.coordsAtPos(t+1),{top:u,bottom:b,right:v}=s.coordsAtPos(m),r=(E>=u?v:s.dom.getBoundingClientRect().right)-i,g=b-a+4;return e.jsx(k.div,{style:{top:a-p,left:i-l,height:g,width:r},className:L("absolute after:absolute after:inset-x-[-4px] after:inset-y-0 after:z-0 after:rounded-md after:bg-[Highlight] after:content-[''] dark:after:bg-[Highlight]",Se.blockCommentHover),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0}})},to=({pos:t})=>e.jsx(U,{children:t!=null&&e.jsx(Qe,{pos:t})}),eo={type:"spring",bounce:.12,duration:.64},nt=24,oo=16,so=0,no=8,Yo=({comments:t,diff:s,readonlyReason:n,isDisabled:d=!1,isRewriting:p=!1,isAnimatingFromPreview:l=!1,isSendDisabled:a=!1,previousComments:i,previousValue:f,isPreview:m=!1,isRequestActive:E=!1,isWaitingForCommentResponse:u=!1,targetedContent:b=null,onAcceleratorsExpandedChange:v,getAutocompleteSuggestion:o,getStableCommentId:r=ue,onBlur:g,onCancelRequest:h,onChange:C,onSave:T,onAddComment:w,onSubmitAccelerator:y,onAcceptComment:B,onDismissComment:P,onExitShowChanges:Z,value:R,commentsMode:_=ot.ENABLED,hideAccelerators:M=!1,hideToolbar:V=!1,hideEditOverlay:W=!1,safeUrls:F,width:H,modelCursor:Y,shouldResetSelection:G,metadata:$})=>{const N=c.useRef(null),D=c.useRef(null);We(D,N);const[{width:S},Lt]=Be(),it=me(),lt=c.useRef(null),[J,ct]=c.useState(!1),Bt=lt.current,Ht=ve(Bt)??!1,dt=it?Re:Oe,q=(()=>{if(H==null){const x=Ht?0:xt();return S-x}return H-dt*2-xt()})(),K=q>=Et+we?Et:Me,Dt=q-K,Vt=X(({commentingOn:x})=>x),Wt=X(({hoveredCommentId:x})=>x),Ft=X(({focusedCommentId:x})=>x),Gt=X(({hoveredBlockCommentLauncherPos:x})=>x),Xt=Mt(x=>x.hoveredEditId),zt=Mt(x=>x.rejectedEdits);c.useEffect(()=>{b==null&&N.current?.revertChanges()},[b]),c.useEffect(()=>{N.current?.flushChanges(),N.current?.UNSAFE_setValue(R)},[R]);const Ut=at.useState(({windowHeight:x})=>{if(it)return m?so:oo;if(m)return nt;const Q=no/100*x;return Math.max(nt,Q)}),Zt=({currentTarget:x,nativeEvent:Q})=>{const ut=Q.composedPath();for(const tt of ut.slice(0,ut.indexOf(x)))if(tt instanceof HTMLElement&&(tt.id===ht.PROSEMIRROR_EDITOR_CONTAINER||tt.id===ht.PROSEMIRROR_CONTEXT_CHILDREN))return;Z?.()},mt=m?"1rem":"max(3rem,24vh)";return e.jsx("div",{className:"h-full w-full",ref:D,onClick:Zt,children:e.jsx(k.div,{className:Ie.document,style:{margin:`0 ${dt}px`},initial:l?{paddingTop:nt}:!1,animate:{paddingTop:Ut},transition:eo,children:e.jsx("div",{ref:_t(Lt,lt),className:"z-0 flex w-full flex-col items-center",children:e.jsxs(et,{comments:t,diff:s,editorRef:N,hoveredCommentId:Wt,focusedCommentId:Ft,hoveredEditId:Xt,rejectedEdits:zt,value:p&&!J?"":R,commentingOn:Vt,isDisabled:d||p||J,onBlur:g,onChange:C,onSave:T,width:K,safeUrls:F,wrapperClassName:"relative z-10 flex max-w-full h-fit",paddingBottom:mt,modelCursor:Y,shouldResetSelection:G,transparentBackground:!J,contentRefereces:$?.contentReferences??[],getAutocompleteSuggestion:o,children:[e.jsxs(et.EditorChildren,{children:[e.jsx(U,{onExitComplete:()=>ct(!1),children:p&&e.jsx(Ze,{isRewriting:p,documentWidth:K,previousValue:f,previousComments:i,value:R,paddingBottom:mt,onStart:()=>ct(!0)})}),!V&&e.jsx(qe,{availableWidth:q,isWaitingForCommentResponse:u,isSendDisabled:a,onAddComment:w,onSubmitAccelerator:y}),_===ot.ENABLED&&e.jsx(to,{pos:Gt}),e.jsx(U,{children:_!==ot.ALL_HIDDEN&&e.jsx(Ae,{availableWidth:Dt,comments:t,commentsMode:_,isRequestActive:E,onAddComment:w,onAcceptComment:B,onDismissComment:P,isWaitingForCommentResponse:u,disableBlockComments:E,getStableCommentId:r})})]}),e.jsxs(et.ContextChildren,{children:[!W&&s&&e.jsx(Ke,{diff:s}),!M&&e.jsx(he,{isRequestActive:E,onSubmit:y,isVisuallyHidden:a||!!n?.isStreamingFromNative||n?.isReadonly&&!n.isStreaming,actions:be,onCancel:h,onExpandedChange:v})]})]})})})})};export{Yo as DocumentComposer};
//# sourceMappingURL=dkyo20luwub10pu9.js.map
