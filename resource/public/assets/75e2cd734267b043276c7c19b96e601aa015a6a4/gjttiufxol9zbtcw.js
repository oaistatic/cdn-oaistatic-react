const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/kgd2o05yxn6dbxrp.js","assets/mnkup87aq6tfilq5.js","assets/l6lryjpkt8rv0lpy.js","assets/root-lwz5toux.css","assets/dvllb5fed1b4y7k1.js","assets/conversation-small-ga20ijz2.css","assets/nha7i667i9vx96u4.js","assets/o8noabc2ok2qmjvd.js","assets/gmef5oj8cqxmaxml.js","assets/pc32gvx0zuzynmfl.js","assets/1e3kywkhcjn5spyo.js","assets/o0ruvxo2l2807vcb.js","assets/gmo2p487z675vgyc.js","assets/f651cyqvxf3m7zo6.js","assets/ll5ad5t40w01fypo.js","assets/oftd8yvle59zqu13.js","assets/hli3paxjs6c9ftyy.js","assets/mc77hi6aghwo7h20.js","assets/hjvhqy8z9mtcdx24.js","assets/cbms2jcglp4b707f.js","assets/dssqb33wed4i78fb.js","assets/m1wuuk5evqjakuq1.js","assets/4wfwbvmzqu7tbfmg.js","assets/jnjzqafy9dn7o7ce.js","assets/gffbkcdjbbbnp8kb.js","assets/d5w25xgxcglldc4u.js","assets/ipgaseve9xp2bi1a.js","assets/nxg0mr2frwehg6na.js","assets/0vzxd2t639wdmhvq.js","assets/mtfnwb571mbq6ji5.js","assets/lurgjwdeumqr5obb.js","assets/jvbzf1d67o78h9n2.js","assets/eivflkxhgemu4u0k.js","assets/oprcb0x0apbum2rw.js","assets/knwgusg2qgb1dca0.js","assets/khfeyjk7s03xesjl.js","assets/llh8t5ckv1lpc2n1.js","assets/h30lmxihx79lh0e9.js","assets/k0r4nt4e0ngxvcib.js","assets/lpa0sb8hkyi7pmml.js","assets/b389eodcyywjf70s.js","assets/h4yt26kg7q4972c8.js","assets/e0sg4zczsdh89yb1.js","assets/ouo7t9nb3e24niv7.js","assets/g9c9v7rwqsjun8by.js","assets/eczaxf4h98ckuoff.js","assets/jgib05q17kv44o5m.js","assets/cu56xogs1b4sjtcp.js","assets/c0exwobgz2x0o6pg.js","assets/d5ytdt4rjczl9j4v.js","assets/mhw2wjge8ypdrzdr.js","assets/kuqyt40s0ygp9s3v.js","assets/g9t9gdlptuqlckd3.js","assets/m89x2zftpo6hrypr.js","assets/fsw3jr6twb9frdxl.js","assets/f45iqe0dpjfhl82a.js","assets/owc9f1cvmrdg7wny.js","assets/ele1ib7knnne85uk.js","assets/j2hm9a8aikgw6z16.js","assets/bj9d14lm2vt5tl41.js","assets/lrbwp2trsv9othld.js","assets/gy64pge8qevmvg7e.js","assets/d92a9jypjbtn5sjn.js","assets/cj02dauuftw44t5d.js","assets/g0y3jk4ws9sr9t5q.js","assets/denmuc242cu8qwp5.js","assets/c9vn66xkba075dtq.js","assets/fzrn137102spawew.js","assets/e9lafxuzyeh4418f.js","assets/gry6c7en9b8uaktm.js","assets/h4jw8c63q447uotc.js","assets/ddgwwmuht3gj4qcb.js"])))=>i.map(i=>d[i]);
import{am as ft,cQ as xn,du as Bo,U as ne,s as K,a5 as Fr,C as ts,fp as Br,cR as Dr,ak as Do,r as $e,F as pt,ch as on,bB as Ho,D as an,a6 as Pt,d6 as So,eO as rc,eP as ic,eQ as lc,eB as cc,eR as dc,c2 as Ft,df as Hr,ew as Ua,bT as gt,P as O,h as He,hN as vn,a as G,bk as Sn,dj as Cs,bh as Ce,I as Bt,N as Kt,ac as De,dU as ot,ag as uc,c6 as mc,bR as $,dg as Lo,bl as Qe,bm as Xe,ea as at,hO as za,u as Dt,aw as rt,hP as hc,d as B,hQ as pc,S as Re,c0 as sn,J as Oo,c9 as Ga,dn as gc,hR as Lr,hS as bo,aj as Ie,bj as bn,W as It,hT as Or,aH as Wa,e as fc,j as xc,a1 as Qt,a0 as co,ba as yo,ap as Ae,bD as Uo,dm as rn,aq as Jt,n as Ye,ah as vc,et as zo,cu as Sc,cs as bc,bS as yc,di as Ur,cm as jc,c1 as ws,ep as qa,el as Tt,gl as Cc,K as yn,gp as wc,ae as zr,hU as Mc,gm as Go,gd as kc,ge as Tc,bv as _c,gH as Ac,hV as Nc,gu as Ec,o as Gr,hW as Rc,hX as Ic,cP as Pc,eU as Fc,fo as Bc,aM as Dc,aG as fs,bA as Wr,fP as Hc,fO as Wo,hY as qo,gD as Vo,aD as Lc,c7 as gs,E as qr,aE as Va,bP as Oc,O as Ms,er as Vr,Z as Yt,bb as $r,be as Uc,hZ as zc,bw as Gc,e7 as jo,fy as Wc,q as bs,aF as qc,e8 as ln,b8 as Vs,Q as Yr,V as Vc,bW as $c,fN as Yc,eH as Kc,M as Qc,bC as Xc,h_ as Jc,bV as Zc,dQ as ed,gy as td,h$ as sd,bz as nd}from"./mnkup87aq6tfilq5.js";import{r as i,h as $o,c as oe,j as e,aw as xt,au as ee,d as ks,M as E,L as cn,R as Yo,b6 as od,a as Kr,z as ad,v as rd,b7 as id,b2 as ld,a$ as $a}from"./l6lryjpkt8rv0lpy.js";import{u as cd}from"./cbms2jcglp4b707f.js";import{f4 as jn,gf as Qr,p3 as dd,p4 as ud,ab as Ko,ei as Q,h6 as dn,p5 as uo,h4 as md,p6 as hd,p7 as pd,p8 as gd,p9 as fd,pa as xd,pb as vd,pc as Sd,pd as bd,i6 as Cn,v as tt,bu as yd,pe as Ve,i as Xr,gn as Jr,bE as Zr,pf as ei,cM as wn,jA as Ya,ac as Ts,dY as un,cl as Rt,lK as Co,pg as Qo,ph as Xo,dB as Mn,ch as ti,ci as si,j0 as ni,jz as oi,i_ as ai,i$ as ri,jC as jd,pi as Cd,cf as kn,cj as xs,ck as wd,cF as Jo,hJ as nn,a2 as _s,pj as Zo,m as Ht,jO as Md,bT as wo,aq as kd,o as Ka,ag as Td,aw as _d,fI as Ad,ax as Nd,aI as ea,cg as Tn,jo as ta,go as Ed,h3 as Rd,pk as kt,bM as ii,pl as Mo,pm as mo,pn as Id,po as $s,pp as Pd,gT as Fd,eX as Ke,mj as Bd,m5 as Qa,gS as Dd,eY as Hd,pq as Ld,iU as Ys,pr as Od,w as sa,db as Ud,u as zd,ps as Gd,fY as Wd,a4 as As,D as qd,pt as Vd,hX as $d,pu as Yd,pv as Kd,cz as Qd,fk as na,i4 as Xd,dI as Jd,fO as Zd,pw as eu,px as tu,py as li,pz as su,pA as nu,r as nt,c4 as ou,pB as oa,pC as _n,pD as mn,jy as ci,fa as Xt,pE as di,pF as ui,f3 as Le,pG as qe,gW as mi,lu as hi,lx as pi,gq as au,B as aa,g8 as ru,lt as iu,pH as gi,e9 as lu,pI as cu,pJ as Zt,kG as fi,pK as V,pL as xi,pM as vi,pN as du,pO as uu,pP as mu,pQ as hu,pR as pu,pS as gu,pT as fu,pU as xu,pV as vu,pW as Su,pX as bu,pY as yu,pZ as ju,p_ as Cu,p$ as wu,q0 as Mu,q1 as ku,q2 as Tu,q3 as _u,q4 as Au,q5 as Nu,q6 as Eu,q7 as Ru,q8 as Iu,q9 as Si,aa as vs,qa as bi,kX as yi,qb as hn,E as Pu,qc as ji,qd as ps,qe as Fu,qf as Bu,lR as ys,qg as Ci,qh as Du,qi as Hu,qj as Xa,qk as Lu,ql as Ou,j1 as Uu,qm as zu,qn as Gu,qo as Wu,Q as wi,f$ as qu,gV as Mi,e1 as es,qp as Vu,cK as ki,qq as Ti,qr as $u,qs as Yu,L as Ku,dG as ra,qt as Qu,ak as _i,qu as Xu,ce as An,dC as Ai,qv as Ju,qw as Ni,qx as Zu,qy as em,qz as tm,hy as Ei,hz as Ri,jj as ia,ea as sm,qA as nm,id as om,qB as am,qC as rm,qD as im,qE as lm,U as pn,hb as cm,ds as dm,qF as um,qG as mm,jg as hm,gX as pm,mH as gm,qH as fm,gZ as xm,g_ as vm,qI as Sm,qJ as bm,qK as ym,qL as jm,qM as Cm,dn as wm,j2 as Mm,gM as km,dX as Tm,oW as _m,mK as Am,qN as Nm,qO as Em,qP as ko,qQ as Rm,f5 as Im,f8 as Ii,qR as Pm,qS as Fm,qT as Pi,jJ as la,fb as gn,h7 as Bm,h9 as Dm,i5 as Hm,qU as To,d as Fi,qV as Ja,qW as Lm,nJ as Om,f6 as Um,qX as zm,lF as Bi,f7 as Gm,qY as Wm,qZ as qm,fU as Vm,oQ as $m,q_ as Ym,q$ as Km,iK as _o,ft as Qm,r0 as Xm,r1 as Jm,r2 as Zm,r3 as Ks,lD as Di,r4 as eh,r5 as Hi,r6 as th,ij as fn,r7 as sh,r8 as nh,r9 as Qs,ra as oh,cG as ah,cH as rh,e0 as ih,bL as Li,cY as Oi,gF as Ui,gH as zi,d9 as lh,rb as ch,ja as dh,rc as uh,hi as mh,e8 as hh,rd as ph,re as Gi,rf as gh,rg as fh,rh as xh,dm as vh,ii as Sh,cE as bh,ri as yh,rj as jh,gm as ho,gE as Ch,gG as wh,i0 as Mh,rk as kh,rl as Th,rm as _h,rn as Ah,ro as Nh,rp as Eh,rq as Rh,rr as Ih,rs as Ph,dr as Fh,rt as Bh,ru as Dh,rv as Hh,lB as Lh,lC as Oh,lA as Uh,rw as zh,i9 as Gh,rx as Wh,hA as qh,hC as Vh,J as $h,gC as Yh,j8 as Kh,j9 as Qh,nA as Xh,hO as Jh,hB as Zh,n7 as ep,c_ as tp,cZ as sp,ry as np,hD as Za,f_ as op,cN as ap,cO as rp,iO as ip,mF as lp,hG as cp,rz as dp,aj as up}from"./dvllb5fed1b4y7k1.js";import{b as Wi,d as mp,c as hp}from"./dssqb33wed4i78fb.js";import{a as qi,m as js,c as Vi,u as pp}from"./m1wuuk5evqjakuq1.js";import{e as $i,a as Nn,f as gp,u as Yi,t as Ao,c as Ki,h as Qi,b as ca,i as En,T as fp,j as xp,k as er,l as vp,s as Sp,m as bp,P as yp}from"./1e3kywkhcjn5spyo.js";import{S as jp,u as Rn,G as Cp,L as wp,a as Mp}from"./mc77hi6aghwo7h20.js";import{u as kp,j as Tp,i as _p,S as Ap,k as Np,l as Ep,m as Rp,n as da,s as Ip,o as Pp,p as Xs,q as Fp,r as Bp,t as In,C as Xi}from"./4wfwbvmzqu7tbfmg.js";import{G as ua,a as Dp}from"./hli3paxjs6c9ftyy.js";import{B as Hp}from"./gffbkcdjbbbnp8kb.js";import{u as Lp}from"./d5w25xgxcglldc4u.js";import{C as No,g as Op}from"./ipgaseve9xp2bi1a.js";const po="m",Up=2e3;function zp(t){const{clientThreadId:s,handleRequestCompletion:o}=t,n=i.useRef(!1),a=i.useRef(null),{isLoading:r,data:l}=ft(),d=jn.useIsEnabled(s),{isLoading:m,data:p}=xn(),u=p&&Bo(p),c=ne(s,K.hasUserMessage),h=Fr(p),[x,g]=$o(),b=ts(),w=i.useCallback(async({content:L,attachments:P},f,T)=>{const U=Qr(),R=P.length>0?{attachments:P}:{};R.system_hints=f.systemHints,Object.keys(U).length>0&&(R.__internal={search_settings:U}),Wi(s),o({promptMessage:Br(L,R),requestedModelId:T,eventSource:"url",completionMetadata:f,extraStreamParams:{enableMessageFollowups:d}})},[s,o,d]),S=Dr(()=>window.location.pathname)??null,C=dd();let k=!r&&!m&&S!=null;const[_,M]=i.useState(!0);return i.useEffect(()=>{if(!_||n.current)return;const L=Do($e(s)?.mode);if(!k||L==null)return;if(!Wp(S)||Gp(S)&&C===void 0||pt(s)!=null){M(!1);return}const P=(()=>{try{return Object.fromEntries(new URLSearchParams(location.hash.slice(1)).entries())}catch{return{}}})(),f={...Object.fromEntries(x),...P},{[uo]:T,[po]:U,[md]:R}=f,N=(typeof T=="string"?T:null)??(typeof U=="string"?U:null);if(!N||!N.trim()){M(!1);return}else a.current=Date.now();const v=ud(R);n.current=!0;let F=Ko(l);if(v.has(Q.Search)&&!dn(F,on.Search)&&l)for(const H of l.models.values())dn(H,on.Search)&&(F=H);const A=R?.includes(Q.Search);(t.prefetchSearchPromise??Promise.resolve(null)).then(H=>{g(I=>{const W=new URLSearchParams(I);return W.delete(uo),W.delete(po),W.append("model",F.id),W}),w({content:N,attachments:[]},{conversationMode:L,source:"instant-query",systemHints:R?Array.from(v):void 0,prefetchIds:H!=null?[H]:void 0,searchSource:A?Ho.URL_SEARCH_HINT:void 0},F?.id),H!=null&&an.addFirstTiming("createCompletion.prefetchSearch")})},[r,m,k,S,l,u,h,w,_,s,C,b,t.prefetchSearchPromise,x,g]),_&&(t.prefetchSearchPromise!=null||x.has(uo)||x.has(po)?!0:a.current?c||Date.now()-a.current>Up?(a.current=null,M(!1),!1):!0:!1)}function Gp(t){return Ji(t)}function Ji(t){return t==null?!1:/^\/g\/[\w-]+$/.test(t)}function Wp(t){return t==null?!1:t==="/"||Ji(t)}function qp({usage:t}){const s={work:{icon:fd,color:"#35AE47"},school:{icon:xd,color:"#E937D1"},personalTasks:{icon:vd,color:"#EA8444"},funAndEntertainment:{icon:Sd,color:"#6C71FF"},justCurious:{icon:bd,color:"#FFCC00"}},o=s[t].icon,n=s[t].color;return e.jsx(o,{className:"icon-md",style:{color:n}})}function Vp({clientThreadId:t}){const s=oe(),o=qi({clientThreadId:t});return e.jsx(xt,{mode:"wait",children:e.jsx(ee.div,{className:"mx-[-2.125rem] mt-2 flex flex-wrap gap-2 px-[2.125rem]",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:["school","work","personalTasks","funAndEntertainment","justCurious"].map(n=>e.jsxs("button",{className:"inline-flex h-[42px] items-center justify-start gap-2 rounded-[25px] border border-token-border-light bg-token-main-surface-primary px-4 py-3 hover:bg-token-main-surface-secondary",onClick:()=>o({stepPrompt:s.formatMessage(js[`${n}Prompt`]),messageMetadata:{onboarding:{main_usages:[n]}}}),children:[e.jsx("div",{"data-svg-wrapper":!0,className:"relative",children:e.jsx(qp,{usage:n})}),e.jsx("div",{className:"font-['SF Pro'] text-[13px] font-normal leading-[18px] text-token-text-primary opacity-90",children:s.formatMessage(js[n])})]},n))})})}function $p({clientThreadId:t,examples:s}){const o=qi({clientThreadId:t}),n=[hd,pd,gd],a=oe();return e.jsx(xt,{mode:"wait",children:e.jsxs("div",{children:[e.jsx(ee.p,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:"text-base text-token-text-primary",children:a.formatMessage(js.tryAnExample)}),e.jsx("ul",{className:"mx-[-2.125rem] flex list-none flex-nowrap gap-6 overflow-auto px-[2.125rem] py-4",children:s.map((r,l)=>e.jsx(ee.li,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:(l+1)*.2,duration:.3},children:e.jsxs("button",{className:"inline-flex h-60 w-[222px] flex-col items-center justify-start overflow-hidden rounded-2xl bg-token-main-surface-primary shadow-[0px_2px_12px_0px] shadow-token-border-light hover:bg-token-main-surface-secondary",onClick:()=>{o({stepPrompt:r.example_prompt,messageMetadata:{onboarding:{triggered_tools:[r.feature]}}})},children:[e.jsx("img",{src:n[l%n.length].src,className:"h-[160px] w-full object-cover",alt:a.formatMessage({id:"chatgpt.new-onboarding.example-prompt",defaultMessage:"Example prompt"})}),e.jsx("div",{className:"inline-flex h-20 w-full gap-1 p-4",children:e.jsx("div",{className:"line-clamp-2 shrink grow basis-0 text-start text-base leading-normal text-token-text-secondary",title:r.example_prompt_title,children:r.example_prompt_title})})]})},r.feature))})]})})}function Yp({clientThreadId:t,children:s}){const{isEligible:o,markAsViewed:n}=Vi(t),a=oe();return o?e.jsx(Cn,{announcementKey:tt.hasSeenCanvasShareButtonNux,show:!0,side:"top",align:"start",theme:"bright",dismissOnOutsideClick:!0,badge:"none",title:a.formatMessage(js.tryUploadingAFile),description:a.formatMessage(js.uploadFileExample),onDismiss:n,sideOffset:0,children:s}):s}const Zi=({clientThreadId:t,rateLimitPopup:s,children:o,disabled:n,highlightTooltip:a=!1,disabledReason:r,currentModelName:l})=>{const d=oe(),m=ne(t,K.getIsNewConversation),p=Pt(),u=g=>{s!=null&&g&&O.logPopoverHover({type:"rate_limit",location:"file_upload",plan_type:p?.planType??"unknown"})},c=yd(So.signUpButtonText),{isEligible:h}=Vi(t),x=!!s;return e.jsx(e.Fragment,{children:x?e.jsx("div",{className:"h-8",children:e.jsxs(rc,{delayDuration:150,onOpenChange:u,children:[e.jsx(ic,{asChild:!0,children:o}),e.jsx(lc,{children:e.jsx(cc,{$as:dc,side:"left",sideOffset:0,align:"start",alignOffset:-12,className:"max-w-[320px]",children:e.jsx(Kp,{isNewConversation:m,rateLimitPopup:s,signUpButtonText:c})})})]})}):!n&&h?e.jsx(Yp,{clientThreadId:t,children:o}):e.jsx(Ft,{sideOffset:0,label:n?r===Ve.ModelNotSupported?d.formatMessage({id:"pEB4vw",defaultMessage:"Attachments disabled for {modelName}"},{modelName:`${l}`}):r===Ve.ThinkModeInUse?d.formatMessage({id:"NRk4QL",defaultMessage:"Attachments disabled for Reason mode"}):r===Ve.SearchModeInUse?d.formatMessage({id:"YlO80p",defaultMessage:"Attachments disabled for Search mode"}):d.formatMessage({id:"9Wgi7B",defaultMessage:"Attach files is unavailable"}):d.formatMessage({id:"wkpQmi",defaultMessage:"Upload files and more"}),className:"flex",open:a?!0:void 0,side:"bottom",children:o})})},Kp=({isNewConversation:t=!1,rateLimitPopup:s,signUpButtonText:o})=>{const n=Pt(),a=ks(),r=Xr(),l=Jr(),d=Hr();if(s==null)return null;const{call_to_action:m,description:p}=s,u=p||e.jsx(E,{...tr.defaultDescription}),c=m?.includes(Ua.GET_PLUS),h=m?.includes(Ua.AUTHENTICATE),x=h&&d;return e.jsxs("div",{className:"p-2 text-sm text-token-text-primary",children:[e.jsx("div",{className:"mb-3",children:u}),c?e.jsx(gt,{size:"small",color:"secondary",onClick:()=>{Zr(a,"Rate limited file upload popover"),O.logRateLimitGetPlusButtonClicked({type:"file_upload",location:"popover",plan_type:n?.planType??"unknown",is_hard_block:!1,is_new_conversation:t,hard_block_reason:""})},children:e.jsx(E,{...tr.getPlus})}):null,h?e.jsx(gt,{size:"small",color:"primary",onClick:()=>{r({authType:l?"login":"signup",callback:g=>{l?O.logLogInButtonClicked({location:"File picker rate limit tooltip",provider:g}):O.logSignUpButtonClicked({location:"File picker rate limit tooltip",provider:g})}})},children:l?e.jsx(E,{...So.logInButtonText}):e.jsx(E,{...o})}):null,x?e.jsx(gt,{size:"small",color:"secondary",className:"ml-2",onClick:()=>{r({authType:l?"signup":"login",callback:g=>{l?O.logSignUpButtonClicked({location:"File picker rate limit tooltip",provider:g}):O.logLogInButtonClicked({location:"File picker rate limit tooltip",provider:g})}})},children:l?e.jsx(E,{...o}):e.jsx(E,{...So.logInButtonText})}):null]})},tr=He({defaultDescription:{id:"U5qAWP",defaultMessage:"You've reached your daily upload limit. Get ChatGPT Plus to unlock more."},getPlus:{id:"TeyLcp",defaultMessage:"Get Plus"}});function Qp({clientThreadId:t,getInputProps:s,openFileDialog:o,uploadType:n,icon:a,isDisabled:r=!1,showLabel:l=!1,showUpsell:d=!1,highlightTooltip:m=!1,disabledReason:p,currentModelName:u}){const c=oe(),h=vn();r=(r||!!h)&&!d;const x=e.jsxs(ei,{disabled:r,$showLabel:l,onClick:w=>{if(w.preventDefault(),d){O.logNoAuthAttachButtonClicked({location:"No auth upsell"});return}O.logEvent(G.openFileViewer,{intent:n.toString()}),o()},"aria-label":r?p===Ve.ModelNotSupported?c.formatMessage({id:"pEB4vw",defaultMessage:"Attachments disabled for {modelName}"},{modelName:`${u}`}):p===Ve.ThinkModeInUse?c.formatMessage({id:"NRk4QL",defaultMessage:"Attachments disabled for Reason mode"}):p===Ve.SearchModeInUse?c.formatMessage({id:"YlO80p",defaultMessage:"Attachments disabled for Search mode"}):c.formatMessage({id:"PromptFilePicker.attachFilesUnavailable",defaultMessage:"Attach files is unavailable"}):c.formatMessage({id:"PromptFilePicker.attachFiles",defaultMessage:"Upload files and more"}),children:[a,l&&e.jsx("span",{className:"whitespace-nowrap pr-1 [display:--force-hide-label]",children:c.formatMessage({id:"PromptFilePicker.attachFilesLabel",defaultMessage:"Attach"})})]}),g=e.jsx("input",{disabled:r,...s({className:"hidden"})}),b=e.jsxs("div",{className:"flex",children:[x,g]});return d?e.jsx(Sn,{children:e.jsx(Ft,{sideOffset:0,label:e.jsx(E,{id:"wkpQmi",defaultMessage:"Upload files and more"}),side:"bottom",open:m||void 0,children:e.jsx(Cs,{triggerButton:b,sideOffset:0,alignOffset:0,children:e.jsx(wn,{location:"attach",statsig_login_event:"chatgpt_composer_upsell_login_button_clicked",statsig_signup_event:"chatgpt_composer_upsell_signup_button_clicked"})})})}):e.jsx(Zi,{disabled:r,clientThreadId:t,rateLimitPopup:h,highlightTooltip:m,children:b})}function Xp({code:t,message:s}){switch(t){case Ya.FileTooLarge:return sr.errorFileTooLarge;case Ya.TooManyFiles:return O.logEvent(G.uploadedMaxFilesError),sr.errorTooManyFiles;default:return s}}const sr=He({attachImages:{id:"PromptFilePicker.attachImages",defaultMessage:"Attach images"},attachFiles:{id:"PromptFilePicker.attachFiles",defaultMessage:"Upload files and more"},errorFileTooLarge:{id:"PromptFilePicker.errorFileTooLarge",defaultMessage:"Your file is too large. The maximum file size is {size}MB."},errorTooManyFiles:{id:"PromptFilePicker.errorTooManyFiles",defaultMessage:"You may only upload {maxNum} files at a time."},defaultFileUploadRateLimited:{id:"U5qAWP",defaultMessage:"You've reached your daily upload limit. Get ChatGPT Plus to unlock more."},getPlusButton:{id:"TeyLcp",defaultMessage:"Get Plus"}}),nr=He({dragInstructions:{id:"FileDropZone.dragInstructions",defaultMessage:"Add anything"},dragAllAccepted:{id:"FileDropZone.dragAllAccepted",defaultMessage:"Drop any file here to add it to the conversation"}});function Jp(t){if(!t.accept||Object.keys(t.accept).length===0)return[];const s=[];return Object.values(t.accept).forEach(o=>s.push(...o)),s.sort()}function Zp(t){const{className:s,children:o,clientThreadId:n,currentModelConfig:a,noKeyboard:r}=t,l=oe(),d=ts(),m=Ts(n),p=un(a,m),u=p!==Rt.None,c=Co(M=>M.files),h=(p===Rt.Multimodal?Qo:Xo)-c.length,x=h<=0,{getGizmoId:g}=Mn(),{handleFileAccepted:b}=tl(l,un(a,m),si(a,m),"drag",g,ti(a,m)?.attachments),w=vn(),S=ni(oi(a,m)),{getRootProps:C,isDragActive:k}=ai({maxFiles:h,disabled:!u||x||w!=null,noClick:!0,noKeyboard:r,onDropAccepted:b,onDropRejected:M=>el(M,l,d,p),multiple:!0,maxSize:ri,...S}),_=Jp(S);return e.jsxs("div",{...C({className:s}),children:[o,k&&e.jsxs(eg,{children:[e.jsx(jd,{}),e.jsx("h3",{children:e.jsx(E,{...nr.dragInstructions})}),e.jsx("h4",{className:"w-2/3 text-center",children:_.length>0?_.join(", "):e.jsx(E,{...nr.dragAllAccepted})})]})]})}function el(t,s,o,n){const{errors:a}=t[0];a.forEach(r=>{const l=Xp(r);typeof l=="string"?o.danger(l,{hasCloseButton:!0}):o.danger(s.formatMessage(l,{size:Cd,maxNum:n===Rt.Multimodal?Qo:Xo}),{hasCloseButton:!0})})}function tl(t,s,o,n,a,r){const l=ts(),d=kn();return{handleFileAccepted:i.useCallback(async(p,u)=>{O.logEvent(G.uploadFile,{client:"web",eventSource:n,intent:s.toString()});const c=a!=null?await a():void 0;p.length>0&&p.forEach(h=>{xs.uploadFile(d,wd(h),h,s,o,t,l,{gizmoId:c},r)})},[n,s,a,d,o,t,l,r])}}const eg=Ce.div`absolute inset-0 opacity-80 flex gap-2 flex-col justify-center items-center bg-token-main-surface-primary text-token-text-primary`;function sl(t){const{currentModelId:s}=kp(),o=Ts(t),[n,a]=ne(t,c=>[K.hasUserMessage(c),K.getGizmoId(c)]),r=Bt(),l=Jo(s),d=Kt(t)&&!n&&(nn(o)||o?.kind===De.GizmoTest),m=_s(a);return{showEmptyState:d,canUseNewHomepage:d&&m||d&&!a&&!l&&!r}}const or=Ce.button`max-w-28 xs:max-w-40 sm:max-w-60 md:max-w-none group flex cursor-pointer items-center gap-1 rounded-lg py-1.5 ${({$shimmer:t})=>t?"loading-shimmer":""} ${({$isScreenArch:t})=>t?"text-md px-1":"px-1 text-lg"} hover:bg-token-main-surface-secondary radix-state-open:bg-token-main-surface-secondary font-semibold text-token-text-secondary overflow-hidden whitespace-nowrap`;function tg({conversation:t,gizmoResource:s,elementRef:o}){const a=ne(t.id,r=>r?.title??null)??t.title;return e.jsx(cn,{to:_d(t.id,s),children:e.jsx($.Item,{onSelect:()=>{O.logEvent(G.projectsBreadcrumbPickerPickConversation)},icon:Ad,children:e.jsx("div",{ref:o,children:a})},t.id)})}function sg({gizmoId:t,clientThreadId:s,inMobileHeader:o,modelLabel:n,modelPickerContent:a}){const r=oe(),d=!Zo(t),{data:m}=Ht(t),{items:p,hasNextPage:u,fetchNextPage:c,isLoading:h,isFetchingNextPage:x}=Md(t),g=i.useRef(null),b=i.useCallback(R=>{h||R==null||(g.current?.disconnect(),g.current=new IntersectionObserver(N=>{N[0].isIntersecting&&u&&c()}),g.current.observe(R))},[h,u,c]);i.useEffect(()=>()=>{g.current?.disconnect()},[]);const[w,S,C]=ne(s,R=>[R?.isLoading,R?.title??null,K.getThreadTitleSource(R)]),k=ot(),{showEmptyState:_}=sl(s),M=r.formatMessage(wo.newChatTitle),{resolvedTitle:L,isTypingEffect:P}=kd(s,S,!0);if(!m||_)return null;const f=L==null&&(Kt(s)||C===uc.NewChat),T=w?e.jsx(e.Fragment,{}):e.jsxs(or,{$isScreenArch:k,$shimmer:f,children:[e.jsxs("div",{className:"truncate",children:[P?e.jsx(Nd,{text:L??""}):L??M,d&&e.jsx("span",{className:"relative bottom-[1px] mx-1 inline-block rounded-md bg-token-main-surface-secondary px-1 text-xs leading-4 text-token-text-secondary",children:n})]}),e.jsx(ea,{className:"icon-md text-token-text-tertiary"})]}),U=m.gizmo.display.name;return e.jsxs("div",{className:"flex items-center gap-0 overflow-hidden whitespace-nowrap px-2 py-1.5",children:[e.jsx(or,{$isScreenArch:k,children:e.jsx(cn,{className:"truncate",to:Ka(m),children:U})}),e.jsxs(e.Fragment,{children:[e.jsx(mc,{className:"icon-md text-token-text-tertiary"}),e.jsxs(Cs,{contentAlign:o?"center":"start",size:"small",onOpenChange:R=>{R&&O.logEvent(G.projectsBreadcrumbPickerOpen)},triggerButton:T,contentClassName:"max-h-[50dvh] overflow-y-scroll",children:[d&&e.jsxs($.Sub,{onOpenChange:R=>{R&&O.logEvent(G.projectsBreadcrumbPickerModelPickerOpen)},children:[e.jsx($.SubMenuTrigger,{children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-1",children:[e.jsx(E,{id:"ilkdMh",defaultMessage:"Model"}),e.jsx("span",{className:"text-xs font-medium text-token-text-secondary",children:n})]})}),e.jsx($.Portal,{children:e.jsx($.SubContent,{onClick:()=>{O.logEvent(G.projectsBreadcrumbPickerModelPickerSelect)},children:a})})]}),e.jsx(cn,{to:Ka(m),children:e.jsx($.Item,{onSelect:()=>{O.logEvent(G.projectsBreadcrumbPickerPickNewChat)},icon:Td,children:e.jsx(E,{...wo.newChatProjectDropdownItem,values:{name:`"${m.gizmo.display.name}"`}})},"new-chat")}),p.filter(R=>R.id!==s).map((R,N)=>{const v=u&&N===p.length-4?b:void 0;return e.jsx(tg,{elementRef:v,conversation:R,gizmoResource:m},R.id)}),x&&e.jsx("div",{className:"m-4 mb-5 flex justify-center",children:e.jsx(Lo,{})})]})]})]})}const ng=Qe(()=>Xe(()=>import("./kgd2o05yxn6dbxrp.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(t=>t.ThreadHeaderGizmoDropdown)),og=Qe(()=>Xe(()=>import("./o8noabc2ok2qmjvd.js"),__vite__mapDeps([7,2,4,1,3,5,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27])).then(t=>t.ConversationHeaderMenuItems));function ag({clientThreadId:t}){const s=oe(),o=Bt(),n=ne(t,K.getIsNewConversation),a=ks(),[,r]=$o(),l=()=>{!n&&!o?a({pathname:"/",search:new URLSearchParams({[Ys]:"true"}).toString()}):r(d=>(d.get(Ys)==="true"?d.delete(Ys):d.set(Ys,"true"),d),{replace:n,state:Od()})};return e.jsx($.Item,{size:"large",className:"!pr-3",onClick:l,icon:Pd,children:e.jsxs("div",{className:"flex grow items-center justify-between gap-2",children:[e.jsx("div",{className:"flex flex-1 items-center gap-3",children:e.jsx(E,{...ga.temporaryChat})}),e.jsx(Fd,{enabled:o,label:s.formatMessage({defaultMessage:"Temporary",id:"temporaryChatToggleLabel"}),testId:"temporary-chat-toggle"})]})})}function rg(t){return t.title?t.title:t.shortLabel}function ma(t,s){let o=t;if(t===za.AUTO){const r=s?.categories.filter(({defaultModel:l})=>l!==za.AUTO);r?.length===1&&(o=r[0].defaultModel)}const n=s?.categories.find(({defaultModel:r})=>r===o);if(n){const{categoryId:r}=n,l=rg(n);return{selectedCategory:r,modelLabel:l,omitPrefix:!!n.title}}const a=s?.groups.find(({modelIds:r})=>r.includes(o));if(a){const{group:r,shortLabel:l}=a;return{selectedCategory:r,modelLabel:l}}return{selectedCategory:null,modelLabel:null}}function ig({modelLabel:t}){return e.jsx("span",{className:"overflow-x-clip text-ellipsis text-token-text-secondary",children:t})}function lg({clientThreadId:t,inMobileHeader:s}){const{isLoading:o,data:n}=ft(),a=pc(),l=Tn(t).id,d=ta();Ke.markStart("ThreadModelSelector");const{modelLabel:m,omitPrefix:p}=ma(l,n),u=ha(t,d),c=oe(),{isUnauthenticated:h}=rt(),x=!h&&!a;m&&Ke.markRendered("ThreadModelSelector");const g=ot(),b=e.jsxs("div",{className:B(g?"overflow-x-hidden text-ellipsis":"text-token-text-secondary"),children:[p?null:`${Bd} `,x?e.jsx("span",{className:"text-token-text-secondary",children:m}):h&&m?e.jsx(ig,{modelLabel:m}):null]});return u.length?o?null:e.jsx(Cs,{sideOffset:8,size:"large",triggerButton:e.jsxs(Qa,{$isScreenArch:g,style:{viewTransitionName:"var(--vt-thread-model-switcher)"},"aria-label":m?c.formatMessage({id:"JrtGPQ",defaultMessage:"Model selector, current model is {modelLabel}"},{modelLabel:m}):"",children:[b,g?e.jsx(Dd,{className:"icon-md text-token-text-tertiary"}):e.jsx(ea,{className:"icon-md text-token-text-tertiary"})]}),onOpenChange:w=>{O.logEvent(G.toggleModelSwitcher,{isOpen:w}),Re.logEvent("toggle_model_switcher",null,{isOpen:String(w)})},contentAlign:s?"center":"start",testId:"model-switcher-dropdown",children:e.jsx(pa,{sections:u})}):e.jsx(Qa,{className:"cursor-default",children:b})}function cg({category:t,modelSwitcherDenialsBySlug:s,currentGizmoId:o,currentModelId:n,testId:a}){const{defaultModel:r,label:l,description:d,isBeta:m,isAlpha:p}=t,u=Hd(o??"");return e.jsx(Mo,{value:r,currentModelId:n,modelSwitcherDenialsBySlug:s,renderName:c=>e.jsx(Eo,{name:l,description:d,isDisabled:c,isBeta:m,isAlpha:p}),isSelected:(!o||u)&&n===r,testId:a},r)}function ha(t,s,o=!1){const n=Tn(t),a=n.id,r=at(t),{data:l}=ft(),{data:d}=xn(),m=Ed(r),p=d&&Bo(d),u=Dt(t),c=Rd({clientThreadId:t}),h=oe(),x=!u,{isUnauthenticated:g}=rt(),b=Xr(),w=s.find(({categoryId:I})=>I===kt.ALPHA),S=s.find(({categoryId:I})=>I===kt.DATA_CAMPAIGNS),C=s.find(({categoryId:I})=>I===kt.EXPERIMENTS),k=s.find(({categoryId:I})=>I===kt.MAINLINE),_=!!w?.options?.length,M=!!S?.options?.length,L=!!C?.options?.length,P=!!k?.options?.length,f=ks(),T=i.useCallback(()=>{O.logEvent(G.accountPayOpenPaymentFromModelPicker,{content:"gizmo-button"}),Zr(f,"Thread header dropdown")},[f]),U=()=>{Re.logEvent("chatgpt_model_switcher_plus_upgrade_button_clicked"),O.logEvent(G.modelSwitcherPlusUpgradeButtonClicked),g?b({shouldOpenPaymentModalOnAuth:!0,callback:I=>{O.logSignUpButtonClicked({location:"Model switcher GPT-4 upsell",provider:I})}}):T()},R=[],[N,v]=i.useState(!1),F=e.jsxs(e.Fragment,{children:[o&&e.jsx(hc,{setIsScrolledToEdge:v}),e.jsxs("div",{className:B("mb-1 flex items-center justify-between px-5 pt-2",{"sticky top-0 z-10 bg-token-main-surface-primary py-2":o},{"[box-shadow:--sharp-edge-top-shadow]":o&&N},{"[box-shadow:--sharp-edge-top-shadow-placeholder]":o&&!N}),children:[e.jsx("span",{className:"text-sm text-token-text-tertiary",children:e.jsx(E,{id:"ilkdMh",defaultMessage:"Model"})}),e.jsx("a",{href:"https://help.openai.com/en/articles/7864572-what-is-the-chatgpt-model-selector",target:"_blank",rel:"noreferrer",children:e.jsx(ii,{className:"icon-md h-5 w-5 pl-0.5 text-token-text-tertiary"})})]},"header")]});if(g){const I={id:"modelSection",content:[]};I.content.push(e.jsx(wn,{location:"model-switcher",statsig_login_event:"chatgpt_modelswitcher_login_button_clicked",statsig_signup_event:"chatgpt_modelswitcher_signup_button_clicked"},"noAuthUpsell")),R.push(I)}else if(!p&&!r){const I={id:"modelSection",content:[]};I.content.push(e.jsx(Mo,{value:"",currentModelId:a,onClick:U,modelSwitcherDenialsBySlug:c,isUpgradeUpsell:!0,renderName:W=>e.jsx(Eo,{icon:Ld,isDisabled:W,name:h.formatMessage({id:"mzDzkX",defaultMessage:"ChatGPT Plus"}),description:h.formatMessage({id:"bqTHri",defaultMessage:"Our smartest model & more"})}),isSelected:!1,showNewChatHint:!1},"plusUpgrade")),I.content.push(e.jsx(Mo,{value:mo.AUTO,currentModelId:a,modelSwitcherDenialsBySlug:c,renderName:W=>e.jsx(Eo,{icon:Id,name:h.formatMessage({id:"U9E7Rx",defaultMessage:"ChatGPT"}),description:h.formatMessage({id:"n96qML",defaultMessage:"Great for everyday tasks"}),isDisabled:W}),isSelected:!r&&a===mo.AUTO,showNewChatHint:!0},mo.AUTO)),R.push(I)}else{const I={id:"modelSection",content:[]};l?.categories.length&&I.content.push(F);const W=new Map;l?.categories.forEach(Y=>{const D=e.jsx(cg,{category:Y,currentGizmoId:r,currentModelId:a,modelSwitcherDenialsBySlug:c,testId:`model-switcher-${Y.defaultModel}`},Y.categoryId);Y.subcategory?(W.has(Y.subcategory)||W.set(Y.subcategory,[]),W.get(Y.subcategory)?.push(D)):I.content.push(D)}),W.forEach((Y,D)=>{const te=l?.categories.find(re=>re.subcategory===D&&re.defaultModel===n.id);I.content.push(e.jsxs($.Sub,{children:[e.jsx($.SubMenuTrigger,{"data-testid":D==="More models"?"more-models-submenu":void 0,children:e.jsxs("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:[D,!!te&&e.jsx("div",{className:"truncate text-token-text-tertiary",children:te.label})]})}),e.jsx($.Portal,{children:e.jsx($.SubContent,{className:"min-w-72",children:Y})})]},D))}),R.push(I)}const A={id:"otherOptionsSection",content:[]},{selectedCategory:H}=ma(a,l);return x&&(_&&A.content.push(e.jsx($s,{isSelected:H===kt.ALPHA,currentModel:n,option:w,modelSwitcherDenialsBySlug:c,displayInFull_INTERNAL_USE_ONLY:!0},w.value)),M&&A.content.push(e.jsx($s,{isSelected:H===kt.DATA_CAMPAIGNS,currentModel:n,option:S,modelSwitcherDenialsBySlug:c,displayInFull_INTERNAL_USE_ONLY:!0},S.value)),L&&A.content.push(e.jsx($s,{currentModel:n,isSelected:H===kt.EXPERIMENTS,option:C,modelSwitcherDenialsBySlug:c,displayInFull_INTERNAL_USE_ONLY:!0},C.value)),P&&A.content.push(e.jsx($s,{isSelected:H===kt.MAINLINE,currentModel:n,option:k,modelSwitcherDenialsBySlug:c,displayInFull_INTERNAL_USE_ONLY:!0},k.value))),A.content.length&&R.push(A),!g&&!r&&!m&&R.push({id:"temporaryChatSection",content:[e.jsx(ag,{clientThreadId:t},"tempChat")]}),R}function dg(){const t=oe();return e.jsx("div",{className:"border-token-text-quartenary items-center rounded-full border px-1 py-0.5 text-[8px] font-semibold uppercase leading-3 text-token-text-secondary dark:border-token-border-heavy dark:text-token-text-tertiary",children:t.formatMessage(ga.beta)})}function ug(){const t=oe();return e.jsx("div",{className:"border-token-text-quartenary items-center rounded-full border px-1 py-0.5 text-[8px] font-semibold uppercase leading-3 text-token-text-secondary dark:border-token-border-heavy dark:text-token-text-tertiary",children:t.formatMessage(ga.alpha)})}function Eo({isDisabled:t,name:s,icon:o,description:n,extra:a,isBeta:r=!1,isAlpha:l=!1}){let d=s;return r&&(d=e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s}),e.jsx(dg,{})]})),l&&(d=e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s}),e.jsx(ug,{})]})),e.jsxs("div",{className:"flex items-center gap-3",children:[o&&e.jsx("span",{className:"flex h-7 w-7 flex-shrink-0 items-center justify-center rounded-full bg-token-main-surface-secondary",children:e.jsx(o,{className:"h-4 w-4 text-token-text-primary"})}),e.jsxs("div",{children:[d,e.jsxs("div",{className:B(!t&&"text-token-text-secondary","text-xs"),children:[n,a]})]})]})}function pa({sections:t}){return e.jsx(e.Fragment,{children:t.map((s,o)=>e.jsxs(Yo.Fragment,{children:[o!==0?e.jsx($.Separator,{}):null,s.content]},s.id))})}function mg({clientThreadId:t,inMobileHeader:s=!1}){const o=at(t),n=_s(o),a=Zo(o),{showEmptyState:r}=sl(t),{data:l}=Ht(o),{data:d}=ft(),p=Tn(t).id,{modelLabel:u}=ma(p,d),c=ta(),h=ha(t,c,a),x=e.jsx(lg,{clientThreadId:t,inMobileHeader:s});return o==null?a?e.jsx(og,{clientThreadId:t}):x:n?r&&l&&!a?x:e.jsx(sg,{modelLabel:u??"",modelPickerContent:e.jsx(pa,{sections:h}),gizmoId:o,clientThreadId:t,inMobileHeader:s}):e.jsx(ng,{clientThreadId:t,gizmoId:o,inMobileHeader:s})}const ga=He({alpha:{id:"o5FsPB",defaultMessage:"Alpha"},beta:{id:"XZwFET",defaultMessage:"Beta"},gpt35ShortExplainer:{defaultMessage:"Great for everyday tasks",id:"ModelSwitcher.gpt35ShortExplainer"},modelTunerSmartSelectionTitle:{id:"czjW8I",defaultMessage:"Dynamic"},modelTunerSmartSelectionExplainer:{id:"gp/YH1",defaultMessage:"Optimized for speed and intelligence"},gpt4ShortExplainer:{defaultMessage:"With DALL·E, browsing and analysis",id:"ModelSwitcher.gpt4ShortExplainer"},gpt4ShortExplainerWithoutBrowse:{defaultMessage:"With DALL·E and analysis",id:"ModelSwitcher.gpt4ShortExplainerWithoutBrowse"},gpt4UpsellExplainer:{id:"ModelSwitcher.gpt4Upsell",defaultMessage:"Our smartest and most capable model. Includes DALL·E, browsing and more."},userUpgrade:{id:"ModelSwithcer.upgradeButton",defaultMessage:"Upgrade to Plus"},userUpgradeSignup:{id:"ModelSwitcher.signupUpgradeButton",defaultMessage:"Sign up for ChatGPT Plus"},temporaryChat:{id:"ModelSwitcher.temporaryChat",defaultMessage:"Temporary chat"},shareChat:{id:"ModelSwitcher.shareChat",defaultMessage:"Share chat"}}),hg=Qe(()=>Xe(()=>import("./0vzxd2t639wdmhvq.js"),__vite__mapDeps([28,2,1,3,29,30,4,5,31,32,33,34,35,22,10,19,23,36,16,37,38,9,39,40,41,42,17,6,43,15,18,44])).then(t=>t.GizmoUsingAsOwnerNotice)),pg=({clientThreadId:t})=>{const s=sa(h=>h.activeStageSidebar),o=Dt(t),n=Ud(sn.WorkspaceShareLinks),{isUnauthenticated:a}=rt(),r=Bt(),l=at(t),d=_s(l),m=zd(),p=n&&o&&!a&&!r&&!d&&!m,u=ot(),c=!s&&!(!a&&u);return e.jsx("div",{className:B(!u&&"gap-2",u&&"@lg/screen-composer:gap-1","flex items-center pr-1 leading-[0]"),children:e.jsx(Tp,{showShareButton:p,showProfileDropdown:c,clientThreadId:t})})};function gg({clientThreadId:t,gizmoId:s}){const o=Gd(),{data:n}=Ht(s),a=Pt();return e.jsxs(e.Fragment,{children:[e.jsxs(Wd,{className:"max-md:hidden",children:[e.jsxs("div",{className:"absolute start-1/2 ltr:-translate-x-1/2 rtl:translate-x-1/2",children:[n!=null&&a?.isWorkspaceAccount()&&n.gizmo.tags?.includes(As.WorkspaceDisabled)&&e.jsx(hg,{gizmo:n}),e.jsx(qd,{gizmoId:s,clientThreadId:t})]}),e.jsxs("div",{className:"flex items-center gap-0 overflow-hidden",children:[e.jsx(_p,{clientThreadId:t}),e.jsx(mg,{clientThreadId:t})]}),e.jsx(pg,{clientThreadId:t})]}),o&&e.jsx(Vd,{})]})}function nl({clientThreadId:t}){const s=at(t),o=Oo(),n=ot();return o||n?null:e.jsx(gg,{gizmoId:s,clientThreadId:t})}const ar=Ce.div`m-8 flex flex-col items-center`;function rr(t){return e.jsx(ee.div,{initial:{opacity:0,translateY:20},animate:{opacity:1,translateY:0,transition:{duration:.5,ease:"easeIn"}},...t})}function fg({clientThreadId:t}){const o=ne(t,a=>a?.promptGptRating)?.gizmoId,{data:n}=Ht(o);return o==null||n==null||!$d(n)?null:e.jsx(xg,{gizmoId:o})}function xg({gizmoId:t}){const[s,o]=i.useState(!1),[n,a]=i.useState(!1),r=Yd(t),l=async m=>{o(!0),setTimeout(()=>{a(!0)},5e3),O.logEvent(G.submitInlineRating,{gizmo_id:t,rating:m}),await r.mutateAsync({rating:m})},d=async()=>{a(!0),O.logEvent(G.dismissInlineRating,{gizmo_id:t}),await r.mutateAsync({})};return i.useEffect(()=>{n||O.logEvent(G.showInlineRating,{gizmo_id:t})},[n,t]),n?null:s?e.jsx(ar,{children:e.jsxs(rr,{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"rounded-lg border border-token-border-heavy p-4",children:e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(E,{id:"gizmo.inlineReview.reviewLeft",defaultMessage:"Feedback sent"}),e.jsx(Ga,{onClick:()=>{a(!0)}})]})}),e.jsx("div",{className:"text-xs text-token-text-tertiary",children:e.jsx(E,{id:"gizmo.inlineReview.reviewLeftSubtext",defaultMessage:'To update your rating, click "Send Feedback" in the GPT Menu'})})]})}):e.jsx(ar,{children:e.jsxs(rr,{className:"flex flex-col items-center gap-4 rounded-lg border border-token-border-heavy p-4",children:[e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(E,{id:"gizmo.inlineReview.prompt",defaultMessage:"How would you rate this GPT so far?"}),e.jsx(Ga,{onClick:d})]}),e.jsx(Kd,{rating:void 0,onRating:l})]})})}const ol=Ce.div`group flex h-10 items-center gap-2 rounded-lg px-2 hover:bg-token-main-surface-secondary text-sm text-token-text-primary`;function vg(){const{data:t,isLoading:s}=Zd({cutId:"recent",limit:8}),{data:o,isLoading:n}=eu();return{isLoading:s||n,recent:t,pinned:o}}function Sg({query:t,onSelectGizmo:s,selectedIdx:o},n){const a=gc(),r=i.useRef([]),{isLoading:l,recent:d,pinned:m}=vg();i.useImperativeHandle(n,()=>({handleEnterOnIndex:c=>{if(!u[c])return c<p.length?p[c].resource:"create"},getResultsLength:()=>p.length+1,scrollToItem:c=>{const h=r.current[c];h&&h.scrollIntoView({behavior:"instant",block:"nearest"})}}));let p=[];if(l)return e.jsx("div",{className:"absolute right-4 top-0 flex h-full items-center justify-center",children:e.jsx(Lo,{})});d&&p.push(...d.pages.flatMap(c=>c.list.items).map(c=>({resource:c.resource,from:"recent"}))),m&&p.push(...m.items.map(c=>({resource:c,from:"pinned"}))),p=Qd(p,c=>c.resource.gizmo.id);const u=p.map(c=>c.resource.gizmo.tags?.includes(As.WorkspaceDisabled));return t&&t!==""&&(p=p.filter(c=>(c.resource.gizmo.display.name.toLowerCase()+c.resource.gizmo.display.description?.toLowerCase()+c.resource.gizmo.author.display_name?.toLowerCase()).includes(t?.toLowerCase()))),e.jsxs("div",{className:"max-h-40 overflow-y-auto",children:[p.map((c,h)=>e.jsx("div",{ref:x=>{r.current[h]=x},tabIndex:h,onClick:()=>{u[h]||s(c.resource)},children:e.jsx(wg,{gizmoResource:c.resource,from:c.from,showDescription:a,isSelected:o===h,grayedOut:u[h]})},c.resource.gizmo.id)),e.jsx("div",{ref:c=>{r.current[p.length]=c},tabIndex:p.length,onClick:()=>{s("create")},children:e.jsx(yg,{isSelected:o===p.length})},"create")]})}const bg=i.forwardRef(Sg),yg=({isSelected:t})=>e.jsx(ol,{className:t?"bg-token-main-surface-secondary":"",children:e.jsxs(cn,{to:"/gpts/editor",target:"_blank",className:"flex flex-row space-x-2 font-semibold",children:[e.jsx("span",{className:"self-center",children:e.jsx(na,{className:"icon-sm"})}),e.jsx("span",{children:e.jsx(E,{...al.dropdownCreateLabel})})]})}),jg=({onClick:t,onClose:s})=>{const[o,n]=i.useState(null),a=i.useRef(null),r=i.useRef(null),[l,d]=i.useState(0),m=oe(),p=u=>{O.logEvent(G.mentionsClickGizmo,{gizmo_id:u==="create"?"create":u.gizmo.id}),u!=="create"&&t(u)};return e.jsxs(e.Fragment,{children:[e.jsx("input",{autoFocus:!0,placeholder:m.formatMessage(al.searchPlaceholder),ref:a,onKeyDown:u=>{if(u.nativeEvent.isComposing)return;const c=r.current?.getResultsLength()??0;if((u.key==="Escape"||u.key==="Backspace"&&!o)&&(u.preventDefault(),s()),u.key==="Enter"||u.key==="Tab"){u.preventDefault();const h=r.current?.handleEnterOnIndex(l);if(!h)return;h==="create"?(window.open("/gpts/editor","_blank"),s()):p(h)}if(u.key==="ArrowDown"&&l<c-1){u.preventDefault();const h=l+1;r.current?.scrollToItem(h),d(h)}if(u.key==="ArrowUp"&&l>0){u.preventDefault();const h=l-1;r.current?.scrollToItem(h),d(h)}},onChange:u=>{n(u.target.value),d(0)},className:"w-full border-0 bg-token-main-surface-primary p-2 text-sm focus:outline-none"}),e.jsx(bg,{ref:r,query:o,selectedIdx:l,onSelectGizmo:p})]})},Cg=({onClick:t,onClose:s})=>{const o=Lr(),n=!!o;return tu(()=>{O.logEvent(G.mentionsOpened,{gizmo_selector_disabled:n})}),n?e.jsx(li,{clientThreadId:bo,rateLimitInfo:o}):e.jsx("div",{onBlur:a=>{a.currentTarget.contains(a.relatedTarget)||s()},className:"popover rounded-2xl border border-token-border-light bg-token-main-surface-primary p-2 shadow-lg",children:e.jsx(jg,{onClick:t,onClose:s})})};function wg({gizmoResource:t,from:s,showDescription:o,isSelected:n,grayedOut:a}){const r=!!t.gizmo.tags?.includes(As.FirstParty);return e.jsxs(ol,{className:B(n?"bg-token-main-surface-secondary":"",a&&"opacity-50"),children:[e.jsx(ua,{isFirstParty:r,src:t.gizmo.display.profile_picture_url,className:B("icon-xl h-7 w-7 flex-shrink-0",a&&"grayscale group-hover:grayscale-0")}),e.jsxs("div",{className:"flex h-fit grow flex-row justify-between space-x-2 overflow-hidden text-ellipsis whitespace-nowrap",children:[e.jsxs("div",{className:"flex flex-row space-x-2",children:[e.jsx("span",{className:"shrink-0 truncate font-semibold",children:t.gizmo.display.name}),o&&e.jsx("span",{className:"flex-grow truncate text-sm text-token-text-tertiary sm:max-w-xs lg:max-w-md",children:t.gizmo.display.description})]}),e.jsx("span",{className:"shrink-0 self-center",children:s==="recent"?e.jsx(Xd,{className:"icon-sm"}):e.jsx(Jd,{className:"icon-sm"})})]})]})}const al=He({talkingTo:{id:"TaggingDropdown.talkingTo",defaultMessage:"Talking to"},dropdownCreateLabel:{id:"TaggingDropdown.dropdownCreateLabel",defaultMessage:"Create a GPT"},searchPlaceholder:{id:"TaggingDropdown.searchPlaceholder",defaultMessage:"Search recent and pinned GPTs"}}),Mg={p:t=>{const{node:s,children:o,...n}=t;return e.jsx("p",{...n,className:"text-start !text-sm !leading-6 text-white",children:o})},a:t=>{const{node:s,children:o,...n}=t;return e.jsx("a",{...n,className:"!text-sm !leading-6 !text-white !underline",children:o})}};function kg(t){const s=oa(),o=nt(t);return!o.isLoading&&o.eligible&&!s}function rl(t,s){const o=su(),n=nu(),a=$i(s);return kg(t)&&!o&&!a&&!n}function il(t,s){const o=nt(t.announcementKey);return e.jsx(Cn,{announcementKey:t.announcementKey,side:"top",show:!0,theme:"bright",dismissOnOutsideClick:!0,badge:"new",title:t.nuxTitle,onDismiss:o.markAsViewed,sideOffset:0,className:"!max-w-2xs xs:!max-w-sm",description:e.jsx(ou,{componentOverrides:Mg,children:t.nuxDescription}),children:e.jsx("div",{children:s})})}const ll=new Map([[Q.Think,{hover:[G.composerThinkButtonHovered,"composer_think_button_hovered"],enable:[G.composerThinkButtonEnabled,"composer_think_button_enabled"],disable:[G.composerThinkButtonDisabled,"composer_think_button_disabled"]}],[Q.Research,{hover:[G.composerResearchButtonHovered,"composer_research_button_hovered"],enable:[G.composerResearchButtonEnabled,"composer_research_button_enabled"],disable:[G.composerResearchButtonDisabled,"composer_research_button_disabled"]}]]);function cl({systemHint:t,logo:s,highlightTooltip:o,isPinnedActive:n=!1,isDisabled:a=!1,composerController:r,analyticsMetadata:l,onClick:d,showLabel:m=!1}){const{name:p,systemHint:u}=t,c=u,{setThreadSystemHintMode:h,clearAllSystemHintModeTriggers:x}=Nn(),g=$i(c),b=!!t.composerBarButtonInfo?.upsell,w=gp.useStore(),[S,C]=i.useState(!1),{value:k}=Ie("2454940646"),_=od(),M=a||n,L=Yi(),P=[Q.Search,Q.Think].includes(c);i.useEffect(()=>{a&&L.has(c)&&h(c,!1,l)},[a,c,l,h,L,P]);const f=!a&&(g||o),T=e.jsxs("button",{className:B("flex h-9 min-w-8 items-center justify-center rounded-full border border-token-border-light p-2 text-[13px] font-medium radix-state-open:bg-black/10",{"transition-all duration-75":S},{"text-token-text-secondary":!g&&!o&&!n},{"bg-blue-250 text-blue-1000 dark:bg-[#2A4A6D] dark:text-[#48AAFF]":!!f||n,"can-hover:hover:bg-[#BDDCF4] dark:hover:bg-[#1A416A]":f&&!n||n,"can-hover:hover:bg-token-main-surface-secondary dark:can-hover:hover:bg-gray-700":!n&&!f},{"focus-visible:outline-black can-hover:hover:bg-black/10 dark:focus-visible:outline-white":!f&&!n},{"opacity-30":a&&!n,"opacity-50":n}),"aria-pressed":g,"aria-label":p,disabled:M,onTransitionEnd:()=>C(!1),onClick:U=>{if(U.stopPropagation(),U.preventDefault(),b&&c!==Q.Search)return;C(!0);let R=!0;k&&P&&(w.getState().persistedSystemHints.has(Q.Search)||w.getState().persistedSystemHints.has(Q.Think))&&(R=!1),R&&x(),h(c,!g,l),g||(r.removeSystemHints(),r.focus());const{enable:N,disable:v}=ll.get(c)??{},[F,A]=(g?v:N)??[];F&&A&&O.logEventWithStatsig(F,A,l),d?.(U)},children:[s,m&&e.jsx("div",{className:"whitespace-nowrap pl-1 pr-1 [display:--force-hide-label]",children:p}),e.jsx(xt,{children:!m&&g&&e.jsx(ee.span,{initial:{x:-10,width:0,opacity:0},animate:{x:0,width:"fit-content",opacity:1},exit:{x:-10,width:0,opacity:0},transition:{ease:"easeOut",duration:_?0:.15},children:e.jsx("div",{className:"whitespace-nowrap pl-1 pr-2 [display:--force-hide-label]",children:p})})})]});return b?e.jsx(Sn,{children:e.jsx(Cs,{triggerButton:T,sideOffset:0,alignOffset:0,children:e.jsx(wn,{location:c,statsig_login_event:"chatgpt_composer_upsell_login_button_clicked",statsig_signup_event:"chatgpt_composer_upsell_signup_button_clicked"})})}):T}function Tg({composerController:t,systemHint:s,highlightTooltip:o,composerBarButtonInfo:n,isDisabled:a,clientThreadId:r,showLabel:l,isPinnedActive:d,currentModelName:m,disabledReason:p}){const u={clientThreadId:r};return e.jsx(_g,{composerBarButtonInfo:n,highlightTooltip:o,isDisabled:a,isPinnedActive:d,analyticsMetadata:u,systemHint:s.systemHint,currentModelName:m,disabledReason:p,children:e.jsx(cl,{highlightTooltip:o,isDisabled:a,isPinnedActive:d,systemHint:s,logo:e.jsx(_n,{svgString:s.logo,className:"h-[18px] w-[18px]"}),composerController:t,analyticsMetadata:u,showLabel:l})})}function _g({children:t,highlightTooltip:s,isDisabled:o,isPinnedActive:n,systemHint:a,composerBarButtonInfo:r,analyticsMetadata:l,currentModelName:d,disabledReason:m}){const p=rl(r.announcementKey,a),u=il(r,t),c=oe();return p?u:e.jsx("div",{children:e.jsx(Ft,{sideOffset:0,label:o?m===mn.HasAttachedFiles?c.formatMessage({id:"z7E1Px",defaultMessage:"Reason disabled for attachments"}):m===mn.DeepResearchHighLoad?c.formatMessage({id:"UrDtrS",defaultMessage:"Deep research is temporarily unavailable"}):r.disabledText:n?c.formatMessage({id:"gFCsls",defaultMessage:"You've selected a thinking model {modelName}"},{modelName:`(${d})`}):r.tooltipText,side:"bottom",open:s||void 0,onOpenChange:h=>{if(h){const{hover:x}=ll.get(a)??{},[g,b]=x??[];g&&b&&O.logEventWithStatsig(g,b,l)}},children:t})})}function ir({logo:t,onClick:s,showLabel:o,label:n,showRemoveIcon:a=!1}){return e.jsxs("button",{type:"button",className:"flex h-9 items-center gap-2 overflow-hidden rounded-full border border-token-border-light bg-blue-250 px-2 text-blue-1000 focus-visible:outline-black can-hover:hover:bg-[#BDDCF4] dark:bg-[#2A4A6D] dark:text-[#48AAFF] dark:hover:bg-[#1A416A] dark:focus-visible:outline-white","aria-label":o?void 0:n,onClick:s,children:[e.jsxs("div",{className:"flex h-full items-center justify-center text-[13px] font-semibold",children:[t,o&&e.jsx("div",{className:"pl-1 [display:--force-hide-label]",children:n})]}),a&&e.jsx("div",{className:"flex h-full items-center justify-center",children:e.jsx(ci,{className:"h-[16px] w-[16px] text-blue-1000 dark:text-[#48AAFF]"})})]})}const Js={initial:{opacity:0,y:20,scale:.9},animate:{opacity:1,y:0,scale:1},transition:{delay:.1},exit:{opacity:0,scale:.5,transition:{duration:.2}}},Ag=({suggestions:t,onSelectingSuggestedReply:s})=>e.jsx("div",{className:"absolute bottom-full flex w-full max-w-[100vw] grow gap-2 overflow-auto px-1 pb-1 contain-inline-size sm:mb-0 sm:justify-start sm:px-2 sm:pb-0 md:static md:mb-2 md:max-w-none md:justify-center md:overflow-visible",children:t.slice(0,2).map((o,n)=>e.jsx(ee.div,{initial:Js.initial,animate:Js.animate,transition:{delay:(n-1)*Js.transition.delay},exit:Js.exit,children:e.jsx(gt,{as:"button",color:"secondary",size:"small",onClick:()=>{s(o,t,n)},className:"group whitespace-nowrap md:whitespace-normal",children:e.jsx(Eg,{suggestion:o})},n)},n))});function Ng({suggestions:t,onSelectingSuggestedReply:s,clientThreadId:o}){const n=t?.length>0;i.useEffect(()=>{n&&Xt(t,o)},[n,o]);const{isUnauthenticated:a}=rt();return n?t.every(di)?e.jsxs(ee.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:"flex flex-col items-center",children:[a&&e.jsx(bn,{className:"mb-6 h-12 w-12 sm:hidden"}),e.jsx(jp,{starterPrompts:t,onSelectStarterPrompt:s})]}):t.every(ui)?e.jsx(Ag,{suggestions:t,onSelectingSuggestedReply:s}):null:null}function Eg({suggestion:t}){return ui(t)?e.jsx(e.Fragment,{children:t.text}):di(t)?e.jsxs("div",{className:"flex flex-col overflow-hidden",children:[t.title&&e.jsx("div",{className:"truncate font-semibold",children:t.title}),e.jsx("div",{className:B("truncate font-normal",t.title?"opacity-50":""),children:t.body})]}):null}function Rg(){const{store:t}=Le(),s=t.useSharedProps();return s?e.jsx(Ig,{...s}):null}function Ig({clientThreadId:t,suggestions:s}){const o=Rn();return s===void 0||s.length===0?null:e.jsx("div",{children:e.jsx(Pg,{children:e.jsx("div",{className:"grow",children:s!==void 0&&e.jsx(Ng,{suggestions:s,onSelectingSuggestedReply:o,clientThreadId:t})})})})}const Pg=Ce.div`h-full flex ml-1 md:w-full md:m-auto gap-0 md:gap-2 justify-center`,dl=({className:t,children:s})=>e.jsx(ee.div,{className:t,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,transition:{duration:.1,delay:0}},transition:{type:"tween",duration:.3,delay:.2},children:s});function Fg({canContinue:t,onContinueGenerating:s}){const o=i.useCallback(()=>{s(),Ao()},[s]);let n=null;return t&&(n=e.jsx(Dg,{onHandleContinueGenerating:o})),n&&e.jsx("div",{className:"flex h-full w-full items-center justify-end gap-0 py-4 md:gap-2",children:n})}function Bg({className:t}){return e.jsx(mi,{className:B("-rotate-180",t)})}const Dg=({onHandleContinueGenerating:t})=>e.jsx(dl,{children:e.jsx(gt,{as:"button",color:"secondary",onClick:t,className:"whitespace-nowrap py-2",icon:Bg,size:"small",children:e.jsx(E,{...qe.continueGenerating})})}),Hg=({clientThreadId:t})=>{const s=Or(),o=ne(t,K.getRequestId),n=It(o);i.useEffect(()=>{n&&Wa.dismissBanner()},[n]);const a=s?.is_dismissible?()=>Wa.dismissBanner():void 0;return e.jsx(xt,{children:s&&e.jsx(ee.div,{transition:{type:"tween",ease:"easeInOut",duration:.1},initial:{opacity:0,transform:"translateY(8px)"},animate:{opacity:1,transform:"translateY(0px)"},exit:{opacity:0,transform:"translateY(8px)"},children:e.jsx(li,{clientThreadId:t,rateLimitInfo:s,onDismiss:a})})})};function Lg(t){const s=ne(t,K.getRequestId),o=It(s),n=Or();return!o&&n!=null}const Ro=window.sessionStorage,Io=fc(xc(()=>({memoryFullBannerDismissed:!!Ro?.getItem(Qt.MemoryFullBannerDismissed)}))),ul={dismissBanner(){Io.setState(t=>{t.memoryFullBannerDismissed=!0}),Ro?.setItem(Qt.MemoryFullBannerDismissed,"true")},clearDismissedBanner(){Io.setState(t=>{t.memoryFullBannerDismissed=!1}),Ro?.removeItem(Qt.MemoryFullBannerDismissed)}};function Og(t){const s=at(t),o=hi(),{data:n}=pi(s,!1,o),a=n!=null,r=a&&n.memoryFullPct>=100,[l,d]=i.useState(!1);i.useEffect(()=>{!r&&a&&(d(!0),ul.clearDismissedBanner())},[r,a]);const m=Io(p=>p.memoryFullBannerDismissed);return r&&l&&!m}function Ug(){const t=oe(),{openSettings:s}=au();return e.jsx(ee.div,{initial:{opacity:0},animate:{opacity:1},children:e.jsx(aa,{title:t.formatMessage(Zs.memoryFullTitle),content:t.formatMessage(Zs.memoryFullTooltip,Zs.memoryFullTooltip.values),primaryCtaText:t.formatMessage(Zs.memoryManageButton),onPrimaryCtaClick:()=>s(ru.Personalization),onDismiss:()=>ul.dismissBanner()})})}const Zs=He({memoryFullTitle:{id:"yRGU2/",defaultMessage:"Memory is full."},memoryManageButton:{id:"a5A88o",defaultMessage:"Manage"},memoryFullTooltip:{id:"neUc+N",defaultMessage:"New memories won’t be created until you make space. <a>Learn more</a>",values:{a:t=>e.jsx("a",{href:iu,target:"_blank",rel:"noopener noreferrer",className:"underline",children:t})}}}),fa=tt.hasSeenMemoryInSearch;function zg(){const t=ks();i.useEffect(()=>{O.logEventWithStatsig(G.chatgptMemoryInSearchAnnouncementShown,"chatgpt_memory_in_search_announcement_shown")},[]);const{markAsViewed:s}=nt(fa),o=i.useCallback(()=>{O.logEventWithStatsig(G.chatgptMemoryInSearchAnnouncementClosed,"chatgpt_memory_in_search_announcement_closed"),s()},[s]),n=i.useCallback(()=>{O.logEventWithStatsig(G.chatgptMemoryInSearchAnnouncementCTAClicked,"chatgpt_memory_in_search_announcement_cta_clicked"),t("#settings/Personalization"),s()},[s,t]);return e.jsx(aa,{onPrimaryCtaClick:n,primaryCtaText:e.jsx(E,{id:"8MwdJw",defaultMessage:"Settings"}),onDismiss:o,content:e.jsxs("div",{className:"flex-grow",children:[e.jsx("div",{className:"mb-0.5 font-semibold",children:e.jsx(E,{id:"Sdp8JT",defaultMessage:"Search, now with memory"})}),e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(E,{id:"a4czFu",defaultMessage:"ChatGPT can now use memories to shape searches it sends to search providers, to give you more relevant answers. You can turn this off at any time in settings. {learnMoreLink}",values:{learnMoreLink:e.jsx("a",{href:"https://help.openai.com/en/articles/9237897-chatgpt-search",target:"_blank",rel:"noopener noreferrer",className:"underline",children:e.jsx(E,{id:"JMsjZT",defaultMessage:"Learn more"})},"learn-more-link")}})})]})})}function ml(){const t=nt(fa),{userIsInSearchHoldoutWithWebDisabled:s}=Ki();return t.eligible&&!t.isLoading&&!s}function Gg(){const{markAsViewed:t,eligible:s}=nt(fa);return s?t:void 0}const Wg=()=>{const{shouldShowSkipButton:t}=gi();return t?e.jsx(dl,{className:"flex justify-center",children:e.jsx(gt,{as:"button",color:"secondary",onClick:()=>lu.skipParagen(),children:e.jsx(E,{...qg.skip})})}):null},qg=He({skip:{id:"dvcUbp",defaultMessage:"Skip"}}),Vg=Qe(()=>Xe(()=>import("./eczaxf4h98ckuoff.js"),__vite__mapDeps([45,2,4,1,3,5,46,47,48])).then(t=>t.JawboneNotificationsBanner)),hl=i.memo(function({className:s}){const{store:o}=Le(),n=o.useIsHeaderContentAreaPopulated();return e.jsx("div",{className:B(s??"absolute bottom-full left-0 right-0",vi.PromptTextareaHeader),children:e.jsx(cu,{shouldRender:n,contentArea:Zt.Header,children:e.jsxs("div",{className:"mb-2 flex flex-col gap-3.5 pt-2",children:[e.jsx(pl,{}),e.jsx(gl,{})]})})})});function pl(){const{store:t}=Le(),s=t.useSharedProps(r=>r?.clientThreadId),o=t.useContentAreaId(Zt.HeaderTop),n=fi();let a;switch(o){case V.ProjectConversationTaskNoFileAccess:a=e.jsx(Qg,{});break;case V.AdvancedVoiceOnMobileAnnouncement:a=e.jsx(fu,{clientThreadId:s});break;case V.S09KM1:a=null;break;case V.ParagenControls:a=e.jsx(Wg,{});break;case V.ItemActions:a=e.jsx(Rg,{});break;case V.BannerSignup:a=e.jsx(Kg,{});break;case V.BannerTermsDisclaimer:a=e.jsx(Xg,{});break;case V.PromptTextareaAction:a=e.jsx(Jg,{});break;case V.BannersRateLimit:a=e.jsx(Zg,{});break;case V.BannerSidekickAnnouncement:a=e.jsx(gu,{});break;case V.SearchBrowserExtensionAnnouncement:a=e.jsx(Np,{});break;case V.MemoryInSearchAnnouncement:a=e.jsx(zg,{});break;case V.MoonshineAnnouncement:a=e.jsx(pu,{});break;case V.CustomizeChatGPTAnnouncement:a=e.jsx(hu,{});break;case V.SearchBrowserExtensionReactiveAnnouncement:a=e.jsx(Ap,{});break;case V.BannerMemoryFull:a=e.jsx(Ug,{});break;case V.Box:a=e.jsxs("div",{className:"flex h-20 w-full items-center justify-center gap-2 bg-red-500 p-2",children:["box",e.jsxs("div",{className:"flex h-full w-full items-center justify-center gap-2 bg-blue-500 p-2",children:["inner",e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-yellow-400 text-center",children:"actual content"})]})]});break;case V.JawboneAnnouncement:n?a=e.jsx(Vg,{}):a=null;break;case V.JawboneMaxActiveAnnouncement:n?a=e.jsx(mu,{}):a=null;break;case V.PromoRedemptionAnnouncement:a=e.jsx(uu,{});break;case V.OperatorAnnouncement:a=e.jsx(du,{});break;default:a=null;break}return a}function gl(){const{store:t}=Le(),s=t.useContentAreaId(Zt.HeaderBottom);let o;switch(s){case xi.DallePromptControls:o=e.jsx(Yg,{});break;default:o=null;break}return o}const $g=Qe(()=>Xe(()=>import("./d5ytdt4rjczl9j4v.js"),__vite__mapDeps([49,2,1,3,4,5,10,50])).then(t=>t.default));function Yg(){const{store:t}=Le(),s=t.useSharedProps(o=>o?.composerController);return s?e.jsx($g,{composerController:s}):null}function Kg(){const{store:t}=Le(),s=t.useSharedProps(a=>a?.clientThreadId),o=Jr(),n=xu();return s?o?e.jsx(vu,{threadId:s,showSignUp:n}):e.jsx(Su,{threadId:s,showLogin:n}):null}function Qg(){return i.useEffect(()=>()=>{co.getItem(Qt.TasksHasSeenProjectDisclaimerBanner)||co.setItem(Qt.TasksHasSeenProjectDisclaimerBanner,!0)},[]),e.jsx(aa,{icon:e.jsx(ii,{}),title:e.jsx(E,{id:"ibX3g7",defaultMessage:"Tasks can’t access project files"}),content:e.jsx(E,{id:"fm94Tm",defaultMessage:"There’s a task in this conversation — just FYI, it won’t be able to access project files."}),onDismiss:()=>{co.setItem(Qt.TasksHasSeenProjectDisclaimerBanner,!0)}})}function Xg(){const{store:t}=Le(),s=t.useSharedProps(o=>o?.clientThreadId);return s?e.jsx(bu,{threadId:s}):null}function Jg(){const{store:t}=Le(),s=t.useSharedProps();return s?e.jsx(Fg,{...s}):null}function Zg(){const{store:t}=Le(),s=t.useSharedProps(o=>o?.clientThreadId);return s?e.jsx(Hg,{clientThreadId:s}):null}const ef=5,tf=i.memo(function(s){return sf(s),nf(s),of(),null});function sf(t){const{store:s}=Le(),o=s.useSetSharedProps();yo(()=>{o(t)},[t,o])}function nf(t){const{clientThreadId:s,canContinue:o}=t,{store:n}=Le(),a=i.useRef({top:n.useContentAreaApi(Zt.HeaderTop),bottom:n.useContentAreaApi(Zt.HeaderBottom)}).current,r=lf(t),l=yu(s),{shouldShowBannerSignup:d,shouldShowBannerTermsDisclaimer:m}=cf(s),p=Lg(s),u=ju(t),c=Ep(t),h=ml(),x=oa(),g=Cu(),b=Rp(t),w=Og(s),S=wu(),C=Mu(t),k=ku(s),_=Tu(s),M=_u(),L=Au(),P=ne(s,T=>T?.modelId),f=Ts(s);yo(()=>{P&&f?.kind===De.GizmoInteraction&&f.gizmo&&Iu(P,f.gizmo)?a.top.set(V.ProjectConversationTaskNoFileAccess):C.eligible?a.top.set(V.AdvancedVoiceOnMobileAnnouncement):S?a.top.set(V.ParagenControls):m?a.top.set(V.BannerTermsDisclaimer):p?a.top.set(V.BannersRateLimit):k?a.top.set(V.JawboneAnnouncement):_?a.top.set(V.JawboneMaxActiveAnnouncement):u.eligible?a.top.set(V.BannerSidekickAnnouncement):h?a.top.set(V.MemoryInSearchAnnouncement):x?a.top.set(V.MoonshineAnnouncement):g?a.top.set(V.CustomizeChatGPTAnnouncement):c?a.top.set(V.SearchBrowserExtensionAnnouncement):b?a.top.set(V.SearchBrowserExtensionReactiveAnnouncement):M?a.top.set(V.PromoRedemptionAnnouncement):L()?a.top.set(V.OperatorAnnouncement):r?a.top.set(V.ItemActions):o?a.top.set(V.PromptTextareaAction):d?a.top.set(V.BannerSignup):w?a.top.set(V.BannerMemoryFull):a.top.set(null)},[a,r,o,m,d,p,u,w,S,C]),yo(()=>{l&&a.bottom.set(xi.DallePromptControls)},[a,l])}function of(){const{store:t}=Le();i.useEffect(()=>()=>{t.reset()},[t])}function af(t){const s=Si(),o=Uo(t),n=K.getTree($e(t)).getLastValidNode(o)?.message?.id;return s?.messageId===n?s.suggestions:[]}function rf(t){return af(t).length>0}function lf(t){const{value:s}=Ae("1887864177"),o=Nu(t.clientThreadId),n=rf(t.clientThreadId);return t.isDisabled||s?!1:t.isNewThread||o||n}function cf(t){const{isUnauthenticated:s}=rt(),o=Uo(t),{layer:n}=rn("3637408529"),{layer:a}=Jt("3637408529"),r=a.get("no_auth_banner_signup_rate_limit",ef),l=n.get("should_show_no_auth_signup_banner",!0),d=Eu(g=>g.bannerDisclaimerClientThreadId),m=Ru(),p={shouldShowBannerTermsDisclaimer:!1,shouldShowBannerSignup:!1};if(!t)return p;const u=K.getTree($e(t)),c=u.countMessagesByAuthor(Ye.User),h=u.getNodeByIdOrMessageId(o),x=h?.message?.author.role===Ye.Assistant&&vc(h.message);return p.shouldShowBannerTermsDisclaimer=x&&s&&c===1&&!m&&(d==null||d===t),p.shouldShowBannerSignup=l&&x&&s&&c>0&&c%r===0,p}const df=({disabled:t,clientThreadId:s})=>{Ke.markStart("ComposerModelSelectorButton",Ke.NS_COMPOSER);const o={clientThreadId:s},n=ta(),a=ha(s,n,!0),{isLoading:r,data:l}=ft(),d=ne(s,x=>x?.modelId),m=vs(l?.models,d);if(r||!m)return null;const u=l?.categories.find(x=>x.defaultModel===m.id)?.shortLabel??m.title;Ke.markRendered("ComposerModelSelectorButton",Ke.NS_COMPOSER);function c(){O.logEventWithStatsig(G.composerSystemHintButtonHovered,"composer_model_selector_button_hovered",o)}function h(){O.logEventWithStatsig(G.composerSystemHintButtonClicked,"composer_model_selector_button_clicked",o)}return e.jsx(uf,{disabled:t,modelLabel:u,onHover:c,onOpen:h,children:e.jsx(pa,{sections:a})})},uf=({disabled:t,children:s,modelLabel:o,onHover:n,onOpen:a})=>{const r=oe(),[l,d]=i.useState(!1);return e.jsxs($.Root,{open:l,onOpenChange:m=>{d(m),m&&a?.()},children:[e.jsx(mf,{disabled:!!t,children:e.jsx(zo,{className:B(bi.toolsButton,"flex h-8 min-w-8 items-center justify-center gap-1 rounded-lg p-1 px-2 text-sm font-semibold text-token-text-secondary hover:bg-black/10 focus-visible:outline-black disabled:opacity-30 radix-state-open:bg-black/10 dark:focus-visible:outline-white"),"aria-label":r.formatMessage({id:"njhg2P",defaultMessage:"Choose a model"}),disabled:t,onPointerOver:n,onClick:m=>{m.preventDefault()},onFocusCapture:m=>{m.stopPropagation()},children:o})}),e.jsx($.Portal,{children:e.jsx($.Content,{alignOffset:-16,onCloseAutoFocus:m=>{m.preventDefault()},className:"[--radix-popper-available-height:40dvh]",removeVerticalPadding:!0,addBottomGradient:!0,children:e.jsx("div",{className:"flex flex-col",children:s})})})]})},mf=({disabled:t,children:s})=>e.jsx(Ft,{side:"right",sideOffset:0,label:t?e.jsx(E,{id:"WU1XH1",defaultMessage:"Model selector unavailable"}):e.jsx(E,{id:"7bVJwH",defaultMessage:"Choose a model"}),children:s});function hf({composerController:t,isDisabled:s,disabledReason:o,highlightTooltip:n,isPinnedActive:a,clientThreadId:r,showLabel:l,currentModelName:d}){const m=Qi(),p=oe(),u=i.useMemo(()=>({clientThreadId:r}),[r]),c=i.useCallback(()=>{O.logEventWithStatsig(G.composerSearchButtonClicked,"composer_search_button_clicked",u),m&&t.trimLeadingText(/^search\b/i)},[u,t,m]),h=i.useMemo(()=>({systemHint:Q.Search,description:p.formatMessage({id:"m/oaZE",defaultMessage:"Find on the web"}),logo:"",requiredFeatures:["search"],requiredModels:[],requiredConversationModes:[De.PrimaryAssistant],name:p.formatMessage({id:"TbHx8d",defaultMessage:"Search"})}),[p]);return e.jsx(gf,{highlightTooltip:n,analyticsMetadata:u,isThreadUsingSearchMode:m,isDisabled:s||a,disabledReason:o,currentModelName:d,children:e.jsx(cl,{highlightTooltip:n,isDisabled:s||a,isPinnedActive:a,systemHint:h,logo:e.jsx(yi,{className:"h-[18px] w-[18px]"}),composerController:t,analyticsMetadata:u,onClick:c,showLabel:l})})}function pf(){const t=ml(),s=oa(),o=nt(tt.hasSeenComposerSearchButtonTooltip);return!o.isLoading&&o.eligible&&!t&&!s}function gf({children:t,highlightTooltip:s,analyticsMetadata:o,isThreadUsingSearchMode:n,isDisabled:a,disabledReason:r,currentModelName:l}){const d=pf()&&!n,m=nt(tt.hasSeenComposerSearchButtonTooltip);return d?e.jsx(Cn,{announcementKey:tt.hasSeenComposerSearchButtonTooltip,side:"right",show:!0,theme:"bright",dismissOnOutsideClick:!0,badge:"new",title:e.jsx(E,{id:"Yjduqi",defaultMessage:"Search the web"}),onDismiss:m.markAsViewed,sideOffset:0,className:"!max-w-2xs xs:!max-w-sm",description:e.jsx(E,{id:"W51Aei",defaultMessage:"Get fast answers with trusted sources. {learnMore}",values:{learnMore:e.jsx(Pu,{href:"https://openai.com/index/introducing-chatgpt-search",className:"underline",children:e.jsx(E,{id:"stA7F4",defaultMessage:"Learn more"})})}}),children:e.jsx("div",{children:t})}):e.jsx("div",{children:e.jsx(Ft,{sideOffset:0,label:a?r===hn.ModelNotSupported?e.jsx(E,{id:"GZemJe",defaultMessage:"Search disabled for {modelName}",values:{modelName:`${l}`}}):r===hn.HasAttachedFiles?e.jsx(E,{id:"Wd1fc2",defaultMessage:"Search disabled for attachments"}):e.jsx(E,{id:"GpDAWD",defaultMessage:"Search is unavailable"}):e.jsx(E,{id:"c+4o2s",defaultMessage:"Search the web"}),side:"bottom",open:s||void 0,onOpenChange:p=>{p&&O.logEventWithStatsig(G.composerSearchButtonHovered,"composer_search_button_hovered",o)},children:t})})}function ff({composerController:t,clientThreadId:s}){const o=Dt(s),n=ca(),{setThreadSystemHintMode:a,clearAllSystemHintModeTriggers:r}=Nn(),{value:l}=Ae("1416952492"),{value:d}=Ie("1325692000"),m=En(s).filter(f=>f.systemHint!==Q.Think&&(f.systemHint!==Q.Research||!l)&&!f.composerBarButtonInfo?.upsell),[p,u]=i.useState([]),[c,h]=i.useState(void 0),[x,g]=i.useState(0);i.useEffect(()=>{u(c?m.filter(f=>f.name.toLocaleLowerCase().startsWith(c.text.toLocaleLowerCase())||f.systemHint.toLocaleLowerCase().startsWith(c.text.toLocaleLowerCase())):[])},[c]),i.useEffect(()=>{t.view.dispatch(Ip(t.view.state.tr,{onHintMatch(f){h(T=>Ur(T,f)?T:f)}}))},[t]);const b=!m.length||!p.length||!c;i.useEffect(()=>{b&&g(0)},[b]);const w=p.length,S=i.useCallback(f=>{g(T=>(f(T)%w+w)%w)},[w]),C=p[x],k=({hintToSave:f=C,expectPerfectMatch:T})=>{if(!c||!C||T&&f.name.toLowerCase()!==c.text.toLowerCase())return!1;O.logEvent(G.systemHintSelected,{system_hint:f.systemHint,conversation_id:o??bo});const U=c.range.from===1?f.name:c.text+f.name.slice(c.text.length),R={clientThreadId:s};Xs(t.view),n.size>0&&r();const N=!!f.composerBarButtonInfo,v=f.systemHint===Q.Search;return d||N||v?(a(f.systemHint,!0,R,v?Ho.CONVERSATION_COMPOSER_SLASH_SEARCH:void 0),c.range&&t.delete(c.range.from,c.range.to),t.removeSystemHints(),!0):(t.addSystemHint(f.systemHint,U,c.range.from,c.range.to),!0)},_=i.useRef(k);_.current=k;const M=i.useRef(S);M.current=S;const L=i.useRef(c);L.current=c;const P=t.view;return i.useEffect(()=>(b||Pp(P,f=>{if(f==="up")M.current(T=>T-1);else if(f==="down")M.current(T=>T+1);else if(f==="cancel")Xs(P),Fp(P);else{if(f==="submit")return Xs(P),_.current({expectPerfectMatch:!1});if(f==="checkMatch")return _.current({expectPerfectMatch:!0})}}),()=>Xs(P)),[b,P]),i.useEffect(()=>{b||O.logEvent(G.systemHintListOpened,{conversation_id:o??bo})},[b]),b?null:e.jsx(Sc,{className:"max-w-60",onMouseDown:f=>{f.preventDefault()},children:p.map((f,T)=>e.jsx("div",{onMouseOver:()=>g(T),onClick:()=>{k({hintToSave:f,expectPerfectMatch:!1}),t.focus()},children:e.jsx(bc,{autoFocus:!1,className:"rounded-lg px-1 py-2",$spoofHovered:T===x,children:e.jsx(fl,{title:f.name,description:f.description,logo:f.logo})})},f.systemHint))})}function fl({title:t,description:s,logo:o,checked:n}){return e.jsxs("div",{className:"group inline-flex w-full items-center justify-start gap-2 pl-1.5 pr-3",children:[e.jsx("div",{className:"flex h-7 w-7 items-center justify-center gap-2.5",children:e.jsx(_n,{svgString:o,className:"icon-lg text-token-text-secondary"})}),e.jsxs("div",{className:"shrink grow basis-0",children:[e.jsx("p",{className:"text-sm font-normal leading-tight text-token-text-primary",children:t}),!!s&&e.jsx("p",{className:"text-[13px] font-normal leading-[18px] text-token-text-secondary",children:s})]}),n&&e.jsx(yc,{className:B("icon-md text-token-text-primary",{"group-hover:hidden":!n})})]})}function xf({composerController:t,clientThreadId:s}){return t instanceof da?e.jsx(ff,{composerController:t,clientThreadId:s}):null}function vf({children:t,className:s,showBackground:o}){return e.jsxs("div",{className:"relative",children:[t,o&&e.jsx(ee.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:B("pointer-events-none absolute bottom-0 top-0 h-9 w-9 rounded-full",s)})]})}function Sf({clientThreadId:t,icon:s,setOpen:o,open:n,isDisabled:a=!1,highlightTooltip:r=!1,disabledReason:l,currentModelName:d}){const m=vn(),p=oe();return a=a||!!m,e.jsxs(e.Fragment,{children:[e.jsx($.Trigger,{className:"m-0 h-0 w-0 border-none bg-transparent p-0"}),e.jsx(Zi,{clientThreadId:t,rateLimitPopup:m,highlightTooltip:r,disabled:a,disabledReason:l,currentModelName:d,children:e.jsx(ei,{disabled:a,"aria-disabled":a,"aria-label":a?p.formatMessage({id:"NTwThg",defaultMessage:"Attach files is unavailable"}):p.formatMessage({id:"ixBxc3",defaultMessage:"Upload files and more"}),onClick:u=>{u.preventDefault(),o(!0)},$open:n,children:s})})]})}function bf(){const{connectorConfig:t}=ji(),s=ws(),o=wi(),[n,a]=ys(Ci([...t.values()],u=>!!u.access_token),u=>!!u.access_token),[r,l]=ys(a,u=>u.type===Tt.O365_PERSONAL||u.type===Tt.O365_BUSINESS),d=!s&&!o&&n.length>0,m=!s&&!o&&!d&&r.length>1;return{unconnectedConnectors:o?[]:m?l:a,showUnconnectedInSubmenu:d,showOneDriveInSubmenu:m}}function yf({clientThreadId:t,icon:s,modelAcceptedMimeTypes:o,modelSupportedImageMimeTypes:n,attachmentsProductFeature:a,onOauthRedirect:r,uploadType:l,getInputProps:d,openFileDialog:m,isDisabled:p=!1,isNested:u=!1,highlightTooltip:c=!1,showLabel:h,disabledReason:x,currentModelName:g}){const b=jc().locale,w=oe(),S=ts(),C=kn(),k=ws(),{connectorConfig:_,isLoading:M}=ji(),L=nt(tt.ContextConnectors),{getGizmoId:P}=Mn(),[f,T]=i.useState();i.useEffect(()=>{P?P().then(y=>T(y)):T(void 0)},[P]);const U=i.useRef(null),[R,N]=i.useState(!1),v=i.useRef(!1),F=i.useCallback(()=>{const y=U.current?.files;Array.from(y??[]).forEach(q=>ps.uploadFile(C,q,n,w,S,a))},[C,n,w,S,a]),[A,H]=i.useState(null),I=i.useCallback(()=>H(null),[H]),W=i.useCallback((y,q)=>ps.uploadPickedFile(C,y,q,n,o,a,f,w,S),[C,n,o,a,f,w,S]),{openMenu:Y,confirmMenuOpened:D}=Fu();i.useEffect(()=>{Y&&(N(!0),D())},[Y,D,N]);const te=i.useCallback(y=>{ps.doContextConnectorOauthRedirect(location.pathname+location.search+location.hash,y,r,qa.Picker),r()},[r]),re=i.useCallback(y=>{ps.uploadPickedFile(C,y,Tt.GDRIVE,n,o,a,f,w,S)},[C,n,o,a,f,w,S]),Se=i.useCallback(async y=>{const{access_token:q}=y;if(!q){te(y);return}switch(ps.logAttemptIfAccessTokenIsExpired(y,qa.Picker),y.type){case Tt.GDRIVE:Bu(b,y.type,q,ae=>ae.forEach(re));break;case Tt.O365_PERSONAL:case Tt.O365_BUSINESS:H(y.type);break}},[re,te,H,b]),be=()=>{O.logEvent(G.openFileViewer,{intent:l.toString()}),m()},J=y=>{if(!y&&v.current&&!M)be();else if(y&&Ne&&!M){be();return}N(y),y&&(L.eligible&&L.markAsViewed(),O.logEvent(G.composerOpenContextConnectorPicker),v.current=!0,setTimeout(()=>{v.current=!1},250))},[xe,we]=ys(Ci([..._.values()],y=>!!y.access_token),y=>!!y.access_token);jf(xe,Se);const[ye]=ys(we,y=>y.type===Tt.O365_PERSONAL||y.type===Tt.O365_BUSINESS),{unconnectedConnectors:ie,showUnconnectedInSubmenu:Me,showOneDriveInSubmenu:ve}=bf(),{desktopConnectors:ge}=Du(n),Ne=!xe.length&&!ie.length&&!ge.length,ke=e.jsxs(e.Fragment,{children:[Me&&ie.length>0&&e.jsx(Hu,{connectorEntries:ie,onOauthRedirect:y=>te(y),isNested:u}),!Me&&ie.map(y=>e.jsx(Xa,{entry:y,onClick:()=>Se(y),isNested:u},y.id)),ve&&e.jsx(Lu,{connectors:ye,onOauthRedirect:te,isNested:u}),M&&e.jsx($.Item,{icon:e.jsx(Lo,{className:"text-token-text-secondary"})}),(ie.length>0||M)&&!u&&e.jsx($.Separator,{}),xe.map(y=>e.jsx(Xa,{entry:y,onClick:()=>Se(y),isNested:u},y.id)),ge.map(y=>e.jsx(Ou,{entry:y,isNested:u},y.key)),e.jsx($.Item,{className:B(u&&"mx-0 rounded-xl p-1.5 px-2 py-2.5"),onClick:be,icon:Uu,children:e.jsx(E,{...k?lr.uploadFileMobile:lr.uploadFile})},"upload")]}),Te=u?e.jsx("div",{className:"relative flex flex-col",children:ke}):e.jsxs("div",{className:"flex flex-col",children:[e.jsx(zu,{type:A,onClose:I,uploadPickedFile:W}),e.jsx("input",{onChange:F,...d({className:"hidden"})}),e.jsxs($.Root,{open:R,onOpenChange:J,children:[e.jsx(Sf,{clientThreadId:t,icon:s,setOpen:J,open:R,isDisabled:p,highlightTooltip:c,showLabel:h,disabledReason:x,currentModelName:g}),e.jsx($.Portal,{children:e.jsx($.Content,{alignOffset:-16,side:"top",children:ke})})]}),e.jsx(Gu,{hasConnectors:!M&&!Ne})]});return{dropdownItems:ke,mainComponent:Te}}function jf(t,s){const{connector:o,clearParam:n}=Wu(),a=t.find(r=>r.type===o&&!!r.access_token);i.useEffect(()=>{a&&(s(a),n())},[a,s,n])}function Cf(t){const{mainComponent:s}=yf(t);return s}const lr=He({attachFiles:{id:"ContextConnectorPicker.attachFiles",defaultMessage:"Upload files and more"},uploadFile:{id:"LocalFileDropdownItem.uploadFile",defaultMessage:"Upload from computer"},uploadFileMobile:{id:"LocalFileDropdownItem.uploadFileMobile",defaultMessage:"Upload file"}});function cr({clientThreadId:t,uploadType:s,modelAcceptedMimeTypes:o,modelSupportedImageMimeTypes:n,attachmentsProductFeature:a,getInputProps:r,openFileDialog:l,onOauthRedirect:d,historyDisabled:m,isNested:p,isDisabled:u,highlightTooltip:c,disabledReason:h,currentModelName:x,showLabel:g,showUpsell:b}){const w=wi(),{gdriveStatus:S,o365Status:C}=qu(),k="h-[18px] w-[18px]",_=m?"text-white":c?"text-brand-blue-800":"",M=b?e.jsx(Mi,{"aria-label":"",className:B(k,_)}):e.jsx(na,{"aria-label":"",className:B(k,_)}),P=(S!=="false"||C!=="false"||w)&&!b?e.jsx(Cf,{clientThreadId:t,icon:M,modelAcceptedMimeTypes:o,modelSupportedImageMimeTypes:n,attachmentsProductFeature:a,onOauthRedirect:d,uploadType:s,openFileDialog:l,isNested:p,getInputProps:r,isDisabled:u,highlightTooltip:c,disabledReason:h,currentModelName:x}):e.jsx(Qp,{clientThreadId:t,uploadType:s,openFileDialog:l,getInputProps:r,showLabel:g,showUpsell:b,icon:M,isDisabled:u,highlightTooltip:c,disabledReason:h,currentModelName:x});return p?P:e.jsx("div",{className:"relative",children:e.jsx(vf,{showBackground:c,className:"bg-brand-blue-800/20",children:P})})}function wf({suggestions:t,composerController:s,onSelect:o,onChange:n}){const a=Rn(),r=i.useCallback((u,c,h)=>{o?.(u,c,h),a(u,c,h)},[o,a]),[l,d]=i.useState(-1),[m,p]=i.useState(!1);return i.useEffect(()=>{const u=c=>{if(!c.isComposing)if(c.key==="ArrowDown"){const h=l===t.length-1?0:l+1;d(h),n?.(h,!0,t[h])}else if(c.key==="ArrowUp"){c.preventDefault();const h=l<=0?t.length-1:l-1;d(h),n?.(h,!0,t[h])}else c.key==="Enter"&&!c.shiftKey&&t[l]&&r(t[l],t,l)};return s.subscribe("keydown",u)},[t,l,n,r,s]),i.useEffect(()=>s.subscribe("blur",()=>{d(-1),n?.(-1,!1)}),[s,n]),i.useEffect(()=>{if(!m){const u=()=>{p(!0),window.removeEventListener("mousemove",u)};return window.addEventListener("mousemove",u),()=>{window.removeEventListener("mousemove",u)}}},[m]),i.useEffect(()=>{d(-1),n?.(-1,!1),p(!1)},[t,n]),e.jsx(ee.ul,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"hidden w-full flex-col p-2.5 group-focus-within:flex group-focus-within:max-lg:flex-col-reverse",children:t.map((u,c)=>e.jsxs(ee.li,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:c*.03},exit:{opacity:0,translateY:4},className:"w-full",children:[c>0&&e.jsx("div",{className:B("h-[1px] opacity-60 max-lg:hidden",l===c||l===c-1?"mx-2 bg-token-main-surface-secondary":"bg-token-border-light")}),e.jsxs("button",{className:B("flex w-full cursor-pointer items-center justify-start whitespace-pre-wrap rounded-lg px-2.5 py-3 text-start",l===c?"bg-token-main-surface-secondary":"bg-token-main-surface-primary"),onClick:h=>{h.preventDefault(),r(u,t,c)},onMouseDown:h=>{h.preventDefault()},onMouseEnter:()=>{m&&(d(c),n?.(c,!1,u))},onMouseLeave:()=>{d(-1),n?.(-1,!1,u)},children:[u.icon?e.jsx("span",{className:"mr-4 h-6 w-6 text-token-text-secondary",children:u.icon}):null,e.jsx("span",{className:"whitespace-pre-wrap",children:u.autocompletionChunks&&u.autocompletionChunks.length>0?e.jsx(e.Fragment,{children:u.autocompletionChunks.map((h,x)=>e.jsx("span",{className:B(h.isMatched?"text-token-text-tertiary":"text-token-text-primary"),children:h.text},x))}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:B(u.type===es.Starter||u.type===es.Trending?"text-token-text-secondary":"text-token-text-tertiary"),children:u.title}),e.jsx("span",{className:"text-token-text-primary",children:u.body})]})})]}),c>0&&e.jsx("div",{className:B("h-[1px] opacity-60 lg:hidden",l===c||l===c-1?"mx-2 bg-token-main-surface-secondary":"bg-token-border-light")})]},u.id??c))})}function Mf(t,s){t=t.toLocaleLowerCase();const o=s;s=s.toLocaleLowerCase();const n=[];let a=0;for(let d=0;d<s.length&&(a<t.length&&t[a]===s[d]&&(n.push(d),a++),a!==t.length);d++);const r=[];let l=0;if(n.forEach(d=>{if(d>l){const m=o.slice(l,d);m&&r.push({text:m,isMatched:!1})}r.push({text:o[d],isMatched:!0}),l=d+1}),l<s.length){const d=o.slice(l);d&&r.push({text:d,isMatched:!1})}return kf(r)}function kf(t){if(t.length===0)return t;let s=[t[0]];for(let n=1;n<t.length;n++){const a=s[s.length-1],r=t[n];a.isMatched===r.isMatched?a.text+=r.text:s.push(r)}const o=s.filter(n=>n.isMatched).reduce((n,a)=>n+a.text.trim().length,0);return s.length<=4&&o>=2?s:[{text:s.map(n=>n.text).join(""),isMatched:!1}]}const Tf=i.forwardRef(function({type:s,placeholder:o,replyRegions:n,state:a,renderFiles:r,leftSideActions:l,topRightAction:d,onSubmit:m,setIsComposerOverflowing:p,inputState:u,currentLeafId:c,composerController:h,clientThreadId:x,gizmoId:g,disableReason:b,controlsDisabled:w,setControlsDisabled:S},C){const k=ot(),_=Vu();i.useState(void 0);let M=null;const{isLoading:L}=_;L||(M=_.modelId);const P=i.useRef(null),[f,T]=i.useState(300);i.useEffect(()=>{P.current&&T(P.current.offsetWidth)},[]),i.useEffect(()=>{L||Cc()||h.focus()},[M,h,L]);const{value:U}=Ie("3780975974"),{getShowUpsellReason:R}=ki(),N=U||R(),v=H=>{If({target:H.target,rootId:"composer-background",additonalInteractiveIds:["reply-regions"]})||h.focus()},F=i.useCallback(()=>h instanceof Ti?e.jsx(_f,{composerController:h,currentLeafId:c,placeholder:o,inputState:u}):e.jsx(Bp,{composerController:h,placeholder:o}),[h,c,o,u]),A=i.useCallback(()=>e.jsx($u,{inputState:u,state:a,onSubmit:m,composerController:h,clientThreadId:x,gizmoId:g,disableReason:b}),[u,a,m,h,x,g,b]);return e.jsxs("div",{id:"composer-background",ref:C,className:B("flex w-full cursor-text flex-col rounded-3xl border border-token-border-light px-3 py-1 duration-150 ease-in-out contain-inline-size motion-safe:transition-[color,background-color,border-color,text-decoration-color,fill,stroke,box-shadow] dark:border-none dark:shadow-none",s!=="temporary"&&"shadow-[0_9px_9px_0px_rgba(0,0,0,0.01),_0_2px_5px_0px_rgba(0,0,0,0.06)] has-[:focus]:shadow-[0_2px_12px_0px_rgba(0,0,0,0.04),_0_9px_9px_0px_rgba(0,0,0,0.01),_0_2px_5px_0px_rgba(0,0,0,0.06)]",k&&"backdrop-blur-2xl no-transparency:backdrop-blur-none",k&&s!=="temporary"&&"bg-token-composer-surface",!k&&s!=="temporary"&&"bg-token-main-surface-primary dark:bg-[#303030]",s==="temporary"&&"dark bg-[#303030]"),onClick:v,style:{viewTransitionName:"var(--vt-composer)"},children:[e.jsx(xt,{initial:!1,children:n.length>0&&e.jsx(ee.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0,transition:{duration:.06}},transition:{ease:"easeOut",duration:.1},id:"reply-regions",children:e.jsx(Af,{replyRegions:n})})}),e.jsxs(e.Fragment,{children:[r,e.jsxs("div",{className:"flex min-h-[44px] items-start pl-1",ref:P,children:[e.jsx("div",{className:"min-w-0 max-w-full flex-1",children:F()}),e.jsx("div",{className:"w-[32px] pt-1",children:d})]}),e.jsxs("div",{className:"mb-2 mt-1 flex items-center justify-between sm:mt-5",ref:H=>{if(!N||!("ResizeObserver"in window))return;let I=new AbortController,W=window.innerWidth;const Y=Yu({axis:"width",debounce:!0,target:H,onChange:()=>{if(!H)return;H.scrollWidth>H.clientWidth?p?.(!0):Math.abs(W-window.innerWidth)>40&&(p?.(!1),W=window.innerWidth)}});return()=>{Y?.(),I.abort()}},children:[e.jsx("div",{className:"flex gap-x-1.5 text-token-text-primary",children:l}),e.jsx("div",{className:"flex gap-x-1.5",children:A()})]})]})]})});function _f({composerController:t,currentLeafId:s,placeholder:o,inputState:n}){const a=i.useContext(yn);return e.jsxs(e.Fragment,{children:[e.jsx(Ku,{id:fp,autoFocus:!0,tabIndex:0,"data-id":s,dir:"auto",ref:r=>{if(!(t instanceof Ti))throw new Error("Expected TextAreaComposerController");r!=null&&(t.textArea=r,t.logPageMount())},rows:1,placeholder:o,disabled:n!=="default",className:B("m-0 resize-none border-0 bg-transparent px-0 text-token-text-primary focus:ring-0 focus-visible:ring-0",n==="disabled"&&"text-center",["max-h-[25dvh]","max-h-52"])}),e.jsx("script",{nonce:a.cspScriptNonce,suppressHydrationWarning:!0,children:"requestAnimationFrame((function(){window.__oai_logTTI?window.__oai_logTTI():window.__oai_SSR_TTI=window.__oai_SSR_TTI??Date.now()}))"})]})}function Af({replyRegions:t}){return e.jsx("div",{className:"-mx-2 flex cursor-auto flex-col divide-y divide-token-border-light overflow-hidden rounded-b-lg rounded-t-[20px] bg-token-main-surface-primary",children:t.map((s,o)=>{switch(s.type){case"text":return e.jsx(Nf,{value:s.value,onRemoveRegion:s.onRemoveRegion},o);case"object":return e.jsx(Ef,{value:s.value,onRemoveRegion:s.onRemoveRegion},o);case"mention":case"system_hint":return e.jsx(Rf,{value:s.value,icon:s.icon,onRemoveRegion:s.onRemoveRegion},o)}})})}function Nf({value:t,onRemoveRegion:s}){return e.jsxs(va,{className:"text-token-text-secondary",children:[e.jsx(Sa,{children:e.jsx(ra,{className:"icon-lg-heavy"})}),e.jsx(ba,{children:`“${t}”`}),e.jsx(xa,{onClick:s})]})}function Ef({value:t,onRemoveRegion:s}){return e.jsxs(va,{className:"text-blue-selection",children:[e.jsx(Sa,{children:e.jsx(ra,{className:"icon-lg-heavy"})}),e.jsx(ba,{className:"font-semibold",children:t}),e.jsx(xa,{onClick:s})]})}function Rf({value:t,icon:s,onRemoveRegion:o}){return e.jsxs(va,{children:[e.jsx(Sa,{className:"mt-0",children:s}),e.jsx(ba,{className:"font-semibold text-token-text-primary",children:t}),e.jsx(xa,{onClick:o})]})}function xa({onClick:t}){return e.jsx("button",{onClick:t,type:"button",className:"flex-shrink-0 text-token-text-secondary",children:e.jsx(ci,{className:"icon-lg"})})}const va=Ce.div`bg-token-main-surface-secondary dark:bg-token-main-surface-tertiary flex items-start py-2.5 gap-3 pl-3 pr-1.5 text-sm`,Sa=Ce.span`flex-shrink-0 mt-0.5 w-7 h-6 flex justify-center items-center`,ba=Ce.span`flex-1 line-clamp-3 py-0.5`;function If({target:t,rootId:s,additonalInteractiveIds:o}){let n=t;for(;n&&n!=null;){if(n.tagName==="BUTTON"||n.tagName==="INPUT"||n.tagName==="TEXTAREA"||n.isContentEditable||o.includes(n.id))return!0;if(n.id===s)return!1;n=n.parentElement}return!1}function xl(t){const s=ca(),o=t.useState(a=>a.getSystemHints()[0]);return s.size?s.values().next().value:o}function vl(t,s){const{clearAllSystemHintModeTriggers:o,setThreadSystemHintMode:n}=Nn(),{value:a}=Ie("1325692000");return i.useCallback(({hint:r,enable:l})=>{o();const d=!!r.composerBarButtonInfo;l?d||a?(n(r.systemHint,!0,{clientThreadId:s}),t.removeSystemHints()):(t.addSystemHint(r.systemHint,r.name),setTimeout(()=>{t.focus()},0)):t.removeSystemHints()},[o,t,n,s,a])}const dr=({composerController:t,disabled:s,clientThreadId:o,isComposerV2Mode:n,uploadButtons:a,showLabel:r,showUpsell:l})=>{const{value:d}=Ie("1325692000"),m=En(o).filter(S=>S.systemHint===Q.Research&&(n||d)?!0:!S.composerBarButtonInfo&&S.systemHint!==Q.Search),p=xl(t),{value:u}=Ie("3780975974"),c=vl(t,o),[h,x]=i.useState(!1);if(i.useEffect(()=>{const S=Math.random(),C=setInterval(()=>{const k=new Date,_=k.getHours()+k.getMinutes()/60+k.getSeconds()/3600,M=Math.abs((6+_)%12-6)/6;x(Math.pow(M,15)>S)},1e3);return()=>clearInterval(C)},[]),!(t instanceof da)||m.length===0&&!n)return null;const g={clientThreadId:o};function b(){O.logEventWithStatsig(G.composerSystemHintButtonHovered,"composer_system_hint_button_hovered",g)}function w(){O.logEventWithStatsig(G.composerSystemHintButtonClicked,"composer_system_hint_button_clicked",g)}return e.jsx(Pf,{systemHints:m,selectedHint:p,showJack:u?!1:h,disabled:s,isComposerV2Mode:n,onHover:b,onOpen:w,onSelect:c,uploadButtons:a,showLabel:r,showUpsell:l})},Pf=({systemHints:t,selectedHint:s,showJack:o,disabled:n,isComposerV2Mode:a,onHover:r,onOpen:l,onSelect:d,uploadButtons:m,showLabel:p,showUpsell:u})=>{const c=oe(),[h,x]=i.useState(!1),g=t.find(M=>M.systemHint==="contextual_answers")?.name,{value:b}=Ie("3780975974"),w=t.length>0,S=!1;if(!wc())return null;const k=u?e.jsx(wn,{location:"tools",statsig_login_event:"chatgpt_composer_upsell_login_button_clicked",statsig_signup_event:"chatgpt_composer_upsell_signup_button_clicked"}):e.jsxs(e.Fragment,{children:[w&&e.jsxs(e.Fragment,{children:[S,t.map(M=>e.jsx($.Item,{className:B(!a&&"px-1 py-2",a&&"mx-0 rounded-xl p-1.5 px-2 py-2.5"),onClick:()=>d?.({hint:M,enable:M.systemHint!==s}),children:a?e.jsx(Qu,{title:M.name,description:M.description,icon:M.logo,checked:M.systemHint===s}):e.jsx(fl,{title:M.name,description:M.description,logo:M.logo,checked:M.systemHint===s})},M.systemHint))]}),w&&m&&e.jsx($.Separator,{className:"mx-2 my-1",noMargin:!0}),m]}),_=u&&p?e.jsx(Mi,{"aria-label":"",className:"pointer-events-none h-[18px] w-[18px]"}):e.jsx(na,{"aria-label":"",className:"pointer-events-none h-5 w-5"});return e.jsxs($.Root,{open:h,onOpenChange:M=>{x(M),M&&l?.()},children:[e.jsx(Ff,{disabled:!!n,contextualAnswersHintNameIfPresent:g,children:e.jsxs(zo,{className:B(bi.toolsButton,"flex h-9 min-w-9 items-center justify-center rounded-full border border-token-border-light p-1 text-xs font-semibold text-token-text-secondary focus-visible:outline-black disabled:opacity-30 radix-state-open:bg-black/10 can-hover:hover:bg-token-main-surface-secondary dark:focus-visible:outline-white dark:can-hover:hover:bg-gray-700"),"data-opened":ur(h),"data-jack":ur(!!o),"aria-label":a?c.formatMessage({id:"9xVxsA",defaultMessage:"Upload files and more"}):c.formatMessage({id:"oDAnGy",defaultMessage:"Use a tool"}),disabled:n,onPointerOver:r,onClick:M=>{M.preventDefault()},onFocusCapture:M=>{M.stopPropagation()},children:[a?_:b?e.jsx(_i,{className:"pointer-events-none h-5 w-5"}):e.jsx(Xu,{className:"pointer-events-none h-5 w-5"}),u&&p&&e.jsx("span",{className:"whitespace-nowrap pr-2 text-[13px] font-semibold [display:--force-hide-label]",children:c.formatMessage({id:"AlZBxR",defaultMessage:"Tools"})})]})}),e.jsx($.Portal,{children:e.jsx($.Content,{alignOffset:-16,className:B(a&&"flex flex-col justify-start gap-2",a&&!u&&"p-1.5"),onCloseAutoFocus:M=>{M.preventDefault()},removeVerticalPadding:a||u,children:k})})]})},Ff=({disabled:t,children:s,contextualAnswersHintNameIfPresent:o})=>{const n=nt(tt.hasSeenComposerSystemHintButtonTooltip),a=nt(tt.hasSeenCaSystemHint),r=!t&&!n.isLoading&&n.eligible,l=!t&&!n.isLoading&&o&&!a.isLoading&&a.eligible,d=r?{announcementKey:tt.hasSeenComposerSystemHintButtonTooltip,title:e.jsx(E,{id:"tTydhk",defaultMessage:"All your tools, in one handy place"}),onDismiss:n.markAsViewed,description:e.jsx(E,{id:"S+BFNe",defaultMessage:"Create a canvas, generate a picture, and more."})}:l?{announcementKey:tt.hasSeenCaSystemHint,title:e.jsx(E,{id:"uaC1JM",defaultMessage:"Not finding internal information?"}),onDismiss:a.markAsViewed,description:e.jsx(E,{id:"TL/S+W",defaultMessage:"If ChatGPT didn't search your files automatically, type {hintName} or select it from the menu.",values:{hintName:e.jsx("span",{className:"whitespace-nowrap font-bold",children:'"/'+o+'"'})}})}:void 0;return d?e.jsx(Cn,{show:!0,side:"bottom",theme:"bright",dismissOnOutsideClick:!0,badge:"new",sideOffset:0,className:"!max-w-2xs xs:!max-w-sm",...d,children:s}):e.jsx(Ft,{side:"top",sideOffset:0,label:t?e.jsx(E,{id:"uw9x80",defaultMessage:"Tools unavailable"}):e.jsx(E,{id:"mrYNGk",defaultMessage:"View tools"}),children:s})};function ur(t){return t?"":null}const Bf=1,Df=3e3;function Hf({files:t,className:s}){const o=ws(),n=kn(),a=jm();return e.jsxs("div",{className:s,children:[a.map(r=>e.jsx(Cm,{textdocId:r.tempTextdocId,userCreatedTextdoc:r},r.tempTextdocId)),t.map(r=>e.jsx(wm,{borderRadius:"2xl",useV2Style:!0,width:o?"normal":"wide",onRemoveFileClick:()=>xs.remove(n,r.tempId,"none"),file:r.file,fileId:r.fileId??void 0,contextConnectorInfo:r.contextConnectorInfo,loadingPercentage:r.status===Mm.Uploading?r.progress:void 0},r.tempId))]})}const mr="search-button",hr="active-hint-tag";function Lf({onAbortCompletion:t,onCreateNewCompletion:s,onContinueGenerating:o,currentModelId:n,clientThreadId:a,isNewThread:r,isCompletionInProgress:l,className:d,disabled:m=!1,disabledReason:p,canPause:u=!1,canContinue:c=!1,suggestions:h,isInteractableSharedThread:x,composerContainerRef:g,autocompletions:b,requiresFileUpload:w,onComposerInput:S,onComposerChange:C,onAutocompleteSelect:k,headerClassName:_,hideHeader:M,setComposerBarElement:L,onTaggingDropdownOpen:P,onTaggingDropdownClose:f}){Ke.markStart("PromptTextarea"),Ke.markRendered("PromptTextarea");const T=i.useRef(null),U=km(T,L),{data:R}=xn(),{data:N}=ft(),v=In(),F=An(),A=Fr(R),H=A?.isFree(),{isUnauthenticated:I}=rt(),W=oe(),Y=ts(),D=kn(),[te,re]=ne(a,j=>[K.getCurrentLeafId(j),K.getRequestId(j)]),[Se]=$o(),be=ks(),{gizmoEditorData:J,mode:xe,getGizmoId:we}=Mn(),ye=zr(),ie=Hr(),Me=Bt(),ve=Ai(),ge=Dt(a),Ne=!!Lr(),ke=!!Mc(),Te=jn.useIsEnabled(a),y=!!Go(),[q,ae]=i.useState({}),{setThreadSystemHintMode:pe,clearSystemHintModeTrigger:Z,getSystemHintModeTrigger:le}=Nn(),ue=Yi(),je=ue.has(Q.Search),Je=ue.has(Q.Think),Pe=En(a),it=Pe.length>0,Ee=ue.size===1&&ue.values().next().value,Oe=Ee&&Ee!==Q.Search&&Ee!==Q.Think,Ue=Pe.find(j=>j.systemHint===Ee),[lt,Ze]=i.useState(!1),[ce,st]=i.useState(!1),Ns=ot(),ss=i.useRef(!1),Es=null,me=vs(N?.models,n);let se=Ts(a),vt=se&&"gizmo"in se?se.gizmo:void 0;const St=_s(vt?.gizmo.id),Pn=Gg(),Fe=Ju(),Lt=Ni(),Rs=Zo(vt?.gizmo.id),[_e,Ot]=i.useState(null);_e!==null&&(se={gizmo:_e,gizmo_id:_e.gizmo.id,kind:De.GizmoInteraction},vt=_e);const bt=un(me,se),Fn=vn(),Is=!m&&bt!==Rt.None&&!I,ct=si(me,se),ns=oi(me,se);let ze=Co(j=>j.files);const[os]=i.useState(()=>Zu());xe==="magic"?ze=ze.filter(j=>j.gizmoId!=null):ze=ze.filter(j=>j.gizmoId==null);const Ps=em(),dt=ze.length>0||Ps,as=Co(Tm.hasUploadInProgress),Bn=tm(a),yt=v.useState(j=>{const X=xp(j);return typeof me?.maxTokens=="number"&&X>me.maxTokens}),Ut=v.useState(j=>!j.isEmpty()),zt=!yt&&!as&&(Ut||dt);Ei(ze.length>0||as||Ut);const jt=(bt===Rt.Multimodal?Qo:Xo)-ze.length,Fs=jt<=0,et=zt&&!m&&!y&&(!l||Lt),[Gt,Wt]=i.useState(!1),{value:rs,isLoading:Dn}=Ie("3780975974"),{value:Hn}=Ie("759329447"),{value:Ln}=Ie("2223246572"),{value:Ge}=Ie("1325692000"),qt=n??Ko(N).id,is=vs(N?.models,qt),Ct=dn(is,on.Search),{value:On}=Ae("2603280534"),{userIsInSearchHoldoutWithWebDisabled:Un}=Ki(),zn=I&&!Ct,ls=!m&&(!vt||St&&On)&&ye?.includes(sn.SearchTool)&&!ye?.includes(sn.SearchToolHoldout)&&!Un&&(ye?.includes(sn.BrowsingAvailable)||!A?.isEnterprisey())&&(!Ge||!Oe)&&!zn,{value:Bs}=Ae("1416952492"),{value:Ds}=Ae("4239853523"),_t=ls&&Ct,{targetedContent:Gn,setTargetedContent:Vt}=Ri(),Be=Gn?.isFocusedViewContent&&!ve?void 0:Gn,{rebaseSystemMessageContent:Hs}=ia(),Wn=se?.kind===De.PrimaryAssistant||se?.kind===De.GizmoInteraction&&St,qn=se?.kind===De.PrimaryAssistant||se?.kind===De.GizmoInteraction&&St,Vn=Pe.find(j=>j.systemHint===Q.Think),{getUpsellLabelType:Ls,getUpsellShowsAttach:$n,getShowUpsellReason:Os}=ki(),Yn=rs&&Vn&&Es==null&&se?.kind===De.PrimaryAssistant&&(Hn||Ge)&&(!Ge||!Oe),Kn=se?.kind===De.PrimaryAssistant&&!Me&&!Ge&&!Ds,z=it&&Wn,[fe,ut]=i.useState(!1),Qn=!H&&z&&!Ln,[cs,kl]=i.useState(!1);i.useEffect(()=>{if(!F?.id)return;const j=er.getAndReset(F?.id,ge);j&&v.setText(j.inputText)},[F?.id,ge,v]),i.useEffect(()=>{const j=Se.get("prompt")??"";v.getCurrentText().length===0&&j.length>0&&v.setText(j)},[v,Se]),i.useEffect(()=>{Gt!==et&&(Wt(et),et&&kc(!0).then(j=>{sm.startEnforcement(j),Tc.startEnforcement(j)}))},[et,Gt,se?.kind,ye]);const Xn=ti(me,se),{handleFileAccepted:Tl}=tl(W,un(me,se),ct,"mouse",we,Xn?.attachments),{getInputProps:_l,open:Al}=ai({disabled:m||!Is||Fs,noClick:!0,onDropAccepted:Tl,onDropRejected:j=>el(j,W,Y,bt),multiple:!0,maxSize:ri,maxFiles:jt,...ni(ns)}),ja=_c(os),{value:Nl}=Ie("1988730211"),Ca=i.useCallback(()=>{v.eraseContent(),ja.clearMessages(),v.resize(Bf),v.usedDictation=!1,nm();for(const j of ze)xs.remove(D,j.tempId,"none");om.markAllAsSent()},[v,ja,ze,D]),Us=async(j,X)=>{if(j?.preventDefault(),m||!zt&&!X||!se||$e(a)?.isLoading!==!1)return;if(Lt&&ms==="streaming"){const We=K.getMessage($e(a)),lo=We?Gr(We).length:0;O.logEventWithStatsig(G.conversationStreamInterrupted,"chatgpt_web_conversation_stream_interrupted",{client_thread_id:a,interrupted_message_length:lo})}const he=Rc(re);if(Lt&&he&&!he.turnTracker.isStreamOpen)return;Ze(!0),Pn?.(),Fe?.();const de=v.getContentToSend(),mt=Sp(de.content),Mt=_m({namespace:Am.CompletionRequest,opts:{expectedTimingLogs:[{name:"prompt_submitted",expectedInMs:3e3}]}});Mt.reset();const{content:oo,attachments:Ba}=mp(D,mt,me,se),Da=[],ao=[];Hs&&ao.push(Ic(Hs));const ro={...se};"gizmo"in ro&&delete ro.gizmo;let qs=v.getSystemHints();ue.size>0&&(qs=Array.from(ue));const Ha=le(Q.Search),oc=je?Ha??Ho.CONVERSATION_COMPOSER_WEB_ICON:void 0,La=Nm(),Oa=Qr(),ac=v.usedDictation;let ht={content:oo,eventSource:j?"mouse":"keyboard",completionMetadata:{suggestions:h,conversationMode:ro,systemHints:qs,searchSource:oc},messageMetadata:{...Ba.length>0&&{attachments:Ba},..._e&&{gizmo_id:_e?.gizmo.id},...q,...qs.length>0&&{system_hints:qs},...!!de.metadata&&{serialization_metadata:de.metadata},...La.length>0&&{canvas:{user_created_textdocs:La.map(We=>({user_created_temp_textdoc_id:We.tempTextdocId,type:We.type,title:We.title,content:We.content,create_source:We.create_source,remix_shared_textdoc_id:We.remixSharedTextdocId}))}},...Object.keys(Oa).length>0&&{__internal:{search_settings:Oa}},dictation:ac},prependMessages:Da.length>0?Da:void 0,appendMessages:ao.length>0?ao:void 0,profiler:Mt};const io={};if(ht=Em(ht),Nl&&ht.completionMetadata.systemHints){let We=!1;ht.completionMetadata.systemHints=ht.completionMetadata.systemHints.filter(lo=>lo===Q.Search?(We=!0,!1):!0),We&&(io.forceUseSearch=!0)}Te&&(io.enableMessageFollowups=!0),ht.extraStreamParams=io,Be?.createNewCompletionParams&&(ht=await Be.createNewCompletionParams(ht)),Mt.logTiming("request_params_ready"),await s(ht),Be?.onCreateCompletion?.({serverThreadId:ge,currentLeafId:te}),Be?.shouldPersistAcrossMessages!==!0&&Vt(void 0),pn.hideThreadHeader(),Ca(),Ze(!1),Mt.logTiming("prompt_submitted"),h!==void 0&&(Re.logEvent("chatgpt_prompt_ignore_suggestions"),O.logEvent(G.promptIgnoreSuggestions)),je&&Ha&&Z(Q.Search)},El=i.useRef(Us);i.useEffect(()=>{El.current=Us});const Rl=j=>{Vt(j.targetedReply),j.targetedReply&&(v.focus(),O.logEventWithStatsig(G.targetedReplyButtonClicked,"chatgpt_targeted_reply_button_clicked",{conversationId:ge,sourceMessageId:j.messageId}))},wa=i.useCallback(()=>{Be?.onCleared?.({serverThreadId:ge,currentLeafId:te}),Vt(void 0),v.focus()},[te,ge,Be,Vt,v]),Ma={Enter:{validator:j=>{const X=j.isComposing||j.keyCode===229;return!(ce&&ss.current)&&(j.metaKey||(ie||Pc)&&!j.shiftKey&&!X)},handler:j=>{if(!et){yt&&Y.danger("The message you submitted was too long, please submit something shorter.",{hasCloseButton:!0});return}j.preventDefault(),Us()}},Escape:{validator:j=>!j.isComposing,handler:j=>{u&&l&&(t(re),O.logEvent(G.pauseCompletion,{threadId:pt(a),currentLeafId:K.getMessageId($e(a)),eventSource:"keyboard"})),j.target.value===""&&wa()}}},ds=i.useRef(Ma);ds.current=Ma;const zs=am(is?.tags,se?.kind),[Jn,Gs]=i.useState(!1),[Zn,ka]=i.useState(!1),us=zs&&Jn&&!St,Ta=v.isReady();i.useEffect(()=>v.subscribe("keydown",j=>{v.acceptLegacyKeydown()&&ds.current[j.key]?.validator(j)&&ds.current[j.key].handler(j);const he=v.getCurrentText();if(j.key==="@"){const de=v.getSelectionStart(),mt=he.substring(0,de);(!mt||/\s$/.test(mt)||de===0)&&setTimeout(()=>Gs(!0),10)}else Jn&&Gs(!1);if(j.key==="Escape"&&(Ot(null),st(!1)),_t&&!je){let de;j.key==="Backspace"?de=he.substring(0,he.length-1):de=he+j.key,/^search\s?$/i.test(de)?ka(!0):Zn&&ka(!1)}je&&j.key==="Escape"&&pe(Q.Search,!1,{clientThreadId:a})}),[v,Ta,Jn,Zn,_t,ue,je,pe,a]),i.useEffect(()=>{const j=Object.fromEntries(Object.keys(ds.current).map(X=>[X,de=>{const mt=ds.current[X];if(!mt||v.acceptLegacyKeydown())return!1;const{validator:Mt,handler:oo}=mt;return Mt(de)?(oo(de),!0):!1}]));v.registerKeyHandlers(j)},[v,Ta]),i.useEffect(()=>v.subscribe("paste",j=>{rm({filePickerStore:D,event:j,intl:W,toaster:Y,clientThreadId:a,conversationMode:se,currentModelConfig:me,getEditorGizmoId:we,modelSupportedImageMimeTypes:ct})}),[W,a,se,me,we,ct,v,Y,D]);const Il=j=>{Ne||Ot(j),v.trimLeadingText("@"),Ao(),Gs(!1)},Pl=im(a,os,ct,Xn?.attachments),Fl=i.useCallback(j=>{j?.preventDefault(),t(re),O.logEvent(G.pauseCompletion,{threadId:pt(a),currentLeafId:K.getMessageId($e(a)),eventSource:"mouse"}),Ao()},[t,a,re]),_a=i.useCallback(()=>{er.set(F?.id,ge,v.getCurrentText())},[ge,F?.id,v]);i.useEffect(()=>{J||!lt&&!Ac()&&v.focus()},[lt,v]),i.useEffect(()=>{if(ct.length>0)for(const X of ze)vp(X.fileSpec?.mimeType,ns)||xs.remove(D,X.tempId,"none");else xs.reset(D)},[n,D]),i.useEffect(()=>{(!zs&&_e||Ne)&&Ot(null)},[zs,_e,Ne]);const{layer:Bl}=Jt("4031588851"),{layer:Aa}=Jt("3637408529"),Dl=Aa.get("is_in_composer_text_exp",!1),Hl=Aa.get("composer_text","MESSAGE_CHATGPT"),Ll=Bl.get("composer_text","MESSAGE_CHATGPT"),Ol=Dl?Hl:Ll,[Ws,Ul]=(()=>{switch(p){case"workspaceDisallowsGizmo":return[qe.disallowedByWorkspacePlaceholder,!0];case"feedbackRequired":return[qe.disabledFeedbackPlaceholder,!0];case"noModelsAvailable":return[qe.noModelsAvailablePlaceholder,!0];case"requiresPluginsToBeInstalled":return[qe.requiresPluginsToBeInstalled,!0];case"loadingPlugins":return[qe.loading,!0];case"noTestGizmoId":return[qe.noTestGizmoId,!0];default:{if(x)return[qe.placeholderWithName,!1];if(Be?.placeholderTextOverride!=null)return[Be.placeholderTextOverride,!1];switch(Ol){case"BLANK":return[null,!1];case"ASK_ANYTHING":return[qe.placeholderAskAnythingVariant,!1];case"ASK_CHATGPT_ANYTHING":return[qe.placeholderAskNameAnythingVariant,!1];default:return[qe.placeholderWithName,!1]}}}})(),zl=St?r?W.formatMessage(wo.newChatInProject):Ws?W.formatMessage(Ws,{name:"ChatGPT"}):"​":Ws?W.formatMessage(Ws,{name:J!=null?xe==="magic"?lm:J.name||"GPT":vt?.gizmo.display.name??"ChatGPT"}):"​";i.useEffect(()=>v.subscribe("input",()=>{sa.getState().isThreadHeaderVisible&&pn.hideThreadHeader(),st(!0)}),[v]),i.useEffect(()=>{if(S)return v.subscribe("input",()=>{S?.()})},[v,S]),i.useEffect(()=>{if(C)return v.subscribe("change",()=>{C?.()})},[v,C]),i.useEffect(()=>v.subscribe("focus",()=>{st(!0)}),[v]),i.useEffect(()=>{Ge&&Ee&&Oe&&!Pe.some(({systemHint:j})=>j===Ee)&&!I&&pe(Ee,!1,{clientThreadId:a})},[a,pe,Ee,Oe,Pe,I,Ge]);const Na=rs||Dn||Os(),Ea={clientThreadId:a,uploadType:bt,modelAcceptedMimeTypes:ns,modelSupportedImageMimeTypes:ct,attachmentsProductFeature:Xn?.attachments,getInputProps:_l,openFileDialog:Al,historyDisabled:Me,onOauthRedirect:_a,highlightTooltip:w&&!dt},eo=Pe.some(({systemHint:j,requiredModels:X})=>j===Q.Think&&X.some(he=>{const de=vs(N?.models,he);return de?de.product_features.attachments:!1})),At=[],Ra=!m&&!Fs&&(Is||Fn!=null)&&!je&&(!Je||eo),to=$n(),Ia=to||!I;!Ds&&Ia?At.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-attach-file-action)"},children:e.jsx(cr,{...Ea,showLabel:Ls()==="all",showUpsell:to,isDisabled:!Ra||cs,disabledReason:bt===Rt.None?Ve.ModelNotSupported:Je?Ve.ThinkModeInUse:je?Ve.SearchModeInUse:void 0,currentModelName:me?.title??""})},"file-upload-button")):At.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-system-hint-action)"},children:e.jsx(dr,{composerController:v,clientThreadId:a,disabled:!Ia,showLabel:Ls()==="all",showUpsell:to,isComposerV2Mode:!0,uploadButtons:e.jsx(cr,{...Ea,isDisabled:!Ra,isNested:!0,disabledReason:bt===Rt.None?Ve.ModelNotSupported:Je?Ve.ThinkModeInUse:je?Ve.SearchModeInUse:void 0,currentModelName:me?.title??""})})},"system-hint-button"));const wt=[];Ue&&Oe&&Ge&&wt.push(e.jsx("div",{style:{viewTransitionName:`var(--vt-composer-${Ue}-action)`},children:e.jsx(ir,{logo:e.jsx(_n,{svgString:Ue.logo,className:"h-[18px] w-[18px] text-blue-1000 dark:text-[#48AAFF]"}),label:Ue.name,showRemoveIcon:!0,onClick:()=>{pe(Ue.systemHint,!1,{clientThreadId:a})},showLabel:Na})},hr)),ls&&wt.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-search-action)"},children:e.jsx(hf,{composerController:v,highlightTooltip:Zn,clientThreadId:a,isDisabled:!_t||dt||cs,disabledReason:Ct?dt?hn.HasAttachedFiles:void 0:hn.ModelNotSupported,showLabel:!fe,currentModelName:me?.title??""})},mr)),Pe.forEach(j=>{const X=j.systemHint===Q.Think,he=j.systemHint===Q.Research;if(X&&!Yn||j.systemHint===Q.Search&&ls||he&&!Kn)return;const mt=X&&(ke||!eo&&dt)||he&&Bs;if(j.composerBarButtonInfo){const Mt=me?.tags.includes("reasoning")||me?.id.includes("o1")||me?.id.includes("o3");wt.push(e.jsx("div",{style:{viewTransitionName:`var(--vt-composer-${j.systemHint}-action)`},children:e.jsx(Tg,{composerController:v,systemHint:j,composerBarButtonInfo:j.composerBarButtonInfo,clientThreadId:a,isDisabled:!z||mt||cs,isPinnedActive:Mt&&X,showLabel:Na,currentModelName:me?.title??"",disabledReason:X&&!eo&&dt?mn.HasAttachedFiles:he&&Bs?mn.DeepResearchHighLoad:void 0})},`system-hint-${j.systemHint}`))}}),Rs&&wt.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-system-model-selector)"},children:e.jsx(df,{clientThreadId:a})},"model-selector-button")),Qn&&!Os()&&!Ds&&wt.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-system-hint-action)"},children:e.jsx(dr,{composerController:v,clientThreadId:a,disabled:!z||cs})},"system-hint-button"));const Gl=cm(!1),so=N?.defaultModelSlug;if(!Ge||n===so||!qn)At.push(...wt);else if(Ge&&me&&so&&N?.categories){const j=N.categories.find(X=>X.defaultModel===me.id);if(j){At.push(e.jsx(ir,{showLabel:!0,logo:null,label:j.shortLabel,onClick:()=>Gl({location:"PromptTextArea",modelId:so}),showRemoveIcon:!0}));const X=wt.find(de=>de.key===mr);Ct&&X?At.push(X):ue.has(Q.Search)&&pe(Q.Search,!1,{clientThreadId:a}),ue.has(Q.Think)&&pe(Q.Think,!1,{clientThreadId:a});const he=wt.find(de=>de.key===hr);At.push(he)}}const Wl=dt&&e.jsxs(e.Fragment,{children:[xe==="magic"&&e.jsx("div",{className:"m-2 mb-0 rounded-lg bg-token-main-surface-secondary p-2 text-xs text-token-text-secondary",children:e.jsx(E,{...qe.gizmoKnowledgeWarning})}),e.jsx(Hf,{files:ze,className:"-ml-1.5 flex flex-nowrap gap-2 overflow-x-auto p-1.5"})]}),ql=Ul?"disabled":"default",Vl=l&&u,$l=Nc(),Yl=!et||lt||$l,Kl=bp(as,Ut,yt,Bn),ms=Vl?"streaming":Yl?"disabled":"idle",hs=i.useRef(null),$t=i.useRef(null),{value:Ql}=Ae("222560275"),Xl=Ql||n&&!n.startsWith("o1")&&!n.startsWith("o3");i.useEffect(()=>{const j=()=>{hs.current!=null&&an.addAction("composer_state_disabled",{threadId:pt(a),disabledReason:hs.current})};if(zt&&ms==="disabled"){let X="unknown";m?X=p??"component_disabled_unknown":l?X="completion_in_progress":y?X="thread_hard_blocked":lt&&(X="starting_new_completion_request"),hs.current!==X&&($t.current&&clearTimeout($t.current),$t.current=setTimeout(j,Df)),hs.current=X}else hs.current=null;return()=>{$t.current&&(clearTimeout($t.current),$t.current=null)}},[a,zt,ms,m,p,l,y,lt]);const no=[];if(Be?.label&&no.push({type:Be.type,value:Be.label,onRemoveRegion:wa}),_e!==null){const j=!!_e.gizmo.tags?.includes(As.FirstParty);no.push({type:"mention",value:_e.gizmo.display.name,icon:e.jsx(ua,{isFirstParty:j,src:_e.gizmo.display.profile_picture_url,className:"icon-md"}),onRemoveRegion:()=>{Ot(null),v.focus()}})}i.useEffect(()=>{(!b||b.length===0||!ce)&&(ss.current=!1)},[b,ce]);const Jl=(j,X,he)=>{ss.current=j>=0,X&&v.setText(he?`${he.title}${he.body}`:"")},Pa=ce&&b&&b.length>0&&!us&&!v.hasMultipleLines()&&v.canShowAutocompletion();i.useEffect(()=>{us?P?.():f?.()},[us,P,f]);const Fa=j=>{ms==="streaming"&&(!Lt||v.isEmpty())?Fl(j):Us(j)},Zl=dn(is,on.Canvas),{value:ec}=Ie("61299031"),tc=ws(),sc=dm(),nc=Zl&&ec&&!sc&&!Ps&&!tc;return i.useEffect(()=>{},[Es,v]),e.jsxs(um.Provider,{value:os,children:[e.jsx(mm,{onOauthRedirect:_a,children:e.jsx("form",{className:d,onSubmit:Fa,children:e.jsxs("div",{className:"relative z-[1] flex h-full max-w-full flex-1 flex-col",children:[!M&&!Ns&&e.jsx(hl,{className:_}),e.jsxs("div",{ref:g,className:"group relative z-[1] flex w-full items-center",style:{"--force-hide-label":fe?"none":"block"},children:[r&&Se.has("from_template_row")&&e.jsx("button",{type:"button",onClick:()=>{be("/")},className:"mr-2 flex h-8 w-8 items-center justify-center text-token-text-tertiary hover:text-token-text-secondary",children:e.jsx(hm,{className:"icon-lg"})}),e.jsxs(pm,{open:us||z||Rs,children:[e.jsx(gm,{className:"w-full",children:e.jsx(Tf,{type:Me?"temporary":"default",ref:U,replyRegions:no,placeholder:zl,inputState:ql,setIsComposerOverflowing:ut,composerController:v,leftSideActions:At,topRightAction:nc&&e.jsx(fm,{composerRef:T,composerController:v,clientThreadId:a}),state:ms,onSubmit:Fa,renderFiles:Wl,currentLeafId:te,clientThreadId:a,gizmoId:vt?.gizmo.id,disableReason:Kl,modelId:qt,controlsDisabled:cs,setControlsDisabled:kl})}),e.jsx(xm,{children:e.jsxs(vm,{side:"bottom",align:"start",sideOffset:12,onOpenAutoFocus:j=>{Ec("2713687629")&&j.preventDefault()},children:[us&&e.jsx(Cg,{onClick:j=>Il(j),onClose:()=>{Gs(!1),v.focus()}}),z&&e.jsx(xf,{composerController:v,clientThreadId:a})]})})]}),Pa&&e.jsx("div",{className:"absolute left-0 z-[-1] box-border w-full bg-token-main-surface-primary pl-0 max-lg:bottom-full lg:top-full",children:e.jsx(wf,{suggestions:b,composerController:v,onSelect:k,onChange:Jl})})]}),e.jsx(Sm,{composerController:v,parsedDocumentHandler:Pl})]})})}),e.jsx(tf,{canUseInlineTagging:zs,isDisabled:m,clientThreadId:a,currentLeafId:te,currentRequestId:re,canContinue:c,composerController:v,setPromptInputMetadata:ae,suggestions:h,isNewThread:r,onCreateNewCompletion:s,onContinueGenerating:o,onResetState:Ca,conversationMode:se,isShowingAutocomplete:!!Pa}),se!=null&&Xl&&bm.includes(se.kind)&&e.jsx(ym,{clientThreadId:a,onTargetedReply:Rl})]})}function Of(t,s){const o=!s&&t.message?.author.role===Ye.User&&t.message.status==="in_progress",n=t.metadata?.err!=null&&t.metadata?.errCode!==Va.ContentPolicy,a=t.metadata?.errCode===Va.ModelIncompatibility;return t.metadata?.canRetry===!1||a?!1:o||n}function Uf(t){return e.jsx(Xi,{clientThreadId:t.clientThreadId,children:e.jsx(zf,{...t})})}function zf({clientThreadId:t,isNewThread:s,currentModelId:o,showPromptStarters:n,noWrap:a,onRequestCompletion:r,composerContainerRef:l}){const m=In(),p=i.useContext(yn),u=qo(p),c=Oo(),h=Vo(),x=ne(t,w=>Of(K.getCurrentNode(w),!1));Pi(m);const{value:g}=Ae("3779321121");if(!g&&!h&&x)return e.jsx(Gf,{clientThreadId:t});const b=e.jsx(e.Fragment,{children:e.jsx(Sl,{composerContainerRef:l,clientThreadId:t,currentModelId:o,isNewThread:s,showPromptStarters:n,onRequestCompletion:r})});return a?b:e.jsxs(e.Fragment,{children:[e.jsx(fg,{clientThreadId:t}),e.jsx(la,{clientThreadId:t,isStaticSharedThread:c,verticalPadding:u?"last-standard":"none",horizontalPadding:"standard",children:e.jsx(gn,{children:b})})]})}function Gf({clientThreadId:t}){const s=Bm(t),o=ne(t,r=>K.getCurrentNode(r).metadata?.errCode===Lc.ModelCapExceeded),n=Dm(r=>r.isoDate),a=Uo(t);return o&&n!=null&&n!==""?null:e.jsxs("div",{children:[e.jsx("div",{className:"mb-3 text-center text-xs","data-has-thread-error":!0,children:e.jsx(E,{...pr.errorGeneratingResponse})}),e.jsx("div",{className:"flex items-center md:mb-4",children:e.jsx(gt,{as:"button",color:"primary",onClick:()=>{Re.logEvent("chatgpt_regenerate_due_to_error_button_clicked",void 0,gs({clientThreadId:t})),s({id:a,conversationMode:$e(t)?.mode})},className:"m-auto",icon:mi,"data-testid":"regenerate-thread-error-button",children:e.jsx(E,{...pr.regenerateResponse})})})]})}function Sl({clientThreadId:t,currentModelId:s,isNewThread:o,onRequestCompletion:n,showPromptStarters:a,composerContainerRef:r,autocompletions:l,requiresFileUpload:d,onComposerInput:m,onComposerChange:p,onAutocompleteSelect:u,headerClassName:c,hideHeader:h,onTaggingDropdownClose:x,onTaggingDropdownOpen:g}){const{data:b}=ft(),[w,S,C,k,_,M,L,P]=ne(t,Z=>{const le=K.getCurrentLeafId(Z);return[K.getRequestId(Z),Z?.isLoading,Z?.async_status===qr.STREAMING,K.isMessageTurnEnded(Z),Z?.tree.getHasErrorFromNode(le)??!1,Z?.tree.isMessageIncomplete(le)??!1,Z?.mode,Z?.continuingFromSharedConversationId!=null]}),f=Pt(),T=ko(),{isUnauthenticated:U}=rt(),R=It(w),N=Fc({clientThreadId:t}),v=!U,F=Bc(),{isOpen:A,onClose:H}=Rm({type:"just-hit-rate-limit"}),{value:I}=Ie("1988730211"),W=ca(),Y=i.useCallback(()=>{O.logEvent(G.continueCompletion);const Z=Array.from(W),{systemHints:le,extraStreamParams:ue}=I?Im(Z):{systemHints:Z,extraStreamParams:{}};n({completionType:Dc.Continue,extraStreamParams:ue,completionMetadata:{conversationMode:$e(t)?.mode,systemHints:le}})},[W,I,n,t]),D=Kr(),te=i.useCallback(async Z=>hp({clientThreadId:t,currentRequestId:Z,isHistoryAndTrainingDisabled:F,queryClient:D}),[t,F,D]),Se=i.useCallback(async({content:Z,eventSource:le,extraStreamParams:ue,completionMetadata:je,messageMetadata:Je,prependMessages:Pe,appendMessages:it,profiler:Ee,requestedModelId:Oe})=>{let Ue;fs(t,lt=>{Wr.appendMessage(lt,Br(Z,Je,Ue))}),Wi(t),await n({eventSource:le,completionMetadata:je,extraStreamParams:ue,prependMessages:Pe,appendMessages:it,profiler:Ee,...Oe?{requestedModelId:Oe}:{}})},[t,n,null,f?.normalizedAccountUserId]),be=!k&&(R||C),J=i.useMemo(()=>be?!1:!_&&M,[_,M,be]),xe=be,we=at(t),ye=Ht(we).data,{promptStarters:ie,isSuccess:Me}=Ii(o&&!S,t,4),ve=Si(),ge=ne(t,K.getLastValidNode),Ne=(()=>{if(ve?.messageId===ge?.message?.id)return ve?.suggestions;if(a&&!S&&Me&&!v)return ie})(),ke=Hc(),Te=ye?.gizmo.tags?.includes(As.WorkspaceDisabled)&&!ke?"workspaceDisallowsGizmo":b?.models.size===0?"noModelsAvailable":T.displayingSideBySideFeedback&&T.unskippable?"feedbackRequired":L?.kind===De.GizmoTest&&L.gizmo_id==null?"noTestGizmoId":null,y=ad(),q=Wo(),ae=y.action==="moderate",{value:pe}=Ae("1860647109");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-center empty:hidden",children:q&&ae&&pe?e.jsx(Pm,{}):null}),A?e.jsx(Fm,{onClose:H}):null,e.jsx(Lf,{composerContainerRef:r,clientThreadId:t,onCreateNewCompletion:Se,onAbortCompletion:te,onContinueGenerating:Y,currentModelId:s,isNewThread:o,isCompletionInProgress:N,className:"w-full",canContinue:J,suggestions:Ne??[],disabled:!!Te,disabledReason:Te??void 0,canPause:xe,isInteractableSharedThread:P,autocompletions:l,requiresFileUpload:d,onComposerInput:m,onComposerChange:p,onAutocompleteSelect:u,headerClassName:c,hideHeader:h,onTaggingDropdownClose:x,onTaggingDropdownOpen:g},t)]})}const pr=He({errorGeneratingResponse:{id:"PromptTextarea.errorGeneratingResponse",defaultMessage:"There was an error generating a response"},regenerateResponse:{id:"PromptTextarea.regenerateResponse",defaultMessage:"Regenerate"}}),bl=i.memo(function(){return e.jsxs("div",{className:`mb-2 flex flex-col gap-2 empty:hidden ${vi.PromptTextareaHeader}`,children:[e.jsx(pl,{}),e.jsx(gl,{})]})}),av=Object.freeze(Object.defineProperty({__proto__:null,ChatScreenComposerAlerts:bl},Symbol.toStringTag,{value:"Module"}));function Wf({label:t,description:s,icon:o,badge:n,onClick:a,disabled:r=!1}){return e.jsxs("button",{type:"button",disabled:r,onClick:a,className:"group relative flex flex-col items-start gap-2 rounded-3xl border border-token-border-light py-3 pl-3 pr-4 text-start text-[13px] leading-[18px] transition enabled:hover:bg-token-main-surface-secondary disabled:cursor-not-allowed",children:[e.jsxs("div",{className:"flex w-full items-center justify-between",children:[o&&e.jsx("div",{className:"mr-2",children:o}),n&&e.jsx("span",{className:"rounded bg-blue-400 px-1 text-[10px] font-semibold text-white",children:n})]}),e.jsxs("span",{className:"block max-w-full select-none font-medium text-token-text-secondary",children:[t,s&&e.jsx("p",{className:"font-normal text-gray-500",children:s})]})]})}function qf({composerBarButtonInfo:t,systemHintType:s,mobileLayout:o,children:n}){const a=rl(t.announcementKey,s),r=!o&&a,l=il(t,n);return r?l:n}function Vf(t){const{value:s}=Ie("2223246572"),o=En(t),n=i.useMemo(()=>o.filter(a=>a.suggestedPrompt).sort((a,r)=>(a.suggestedPrompt?.sortOrder??0)-(r.suggestedPrompt?.sortOrder??0)).map(a=>({id:a.systemHint,label:a.suggestedPrompt?.title??"",description:a.suggestedPrompt?.subtitle??"",icon:e.jsx(_n,{svgString:a.logo,className:"h-[22px] w-[22px]",color:a.suggestedPrompt?.theme??""}),badge:a.suggestedPrompt?.badge,systemHint:a})),[o]);return{replaceStarterPromptsWithToolChips:s,toolChips:n}}const gr=Qe(()=>Xe(()=>import("./kuqyt40s0ygp9s3v.js"),__vite__mapDeps([51,2,4,1,3,5,38,9,10,47,52,53,19,20,21,17,16,22,23,24,25,26,27])).then(t=>t.SnorlaxSplashScreen)),go=4;function $f(){const{layer:t}=rn("4031588851"),s=t.get("autocomplete_qualified_start_date","2099-09-13T00:00:00Z"),o=An();return!!o&&o.created*1e3>=new Date(s).getTime()}const fo=t=>`${t.title}${t.body}`.toLocaleLowerCase();function Yf(t){const s=at(t.clientThreadId),o=_s(s);return e.jsx(Xi,{clientThreadId:t.clientThreadId,children:o&&s&&gr?e.jsx(gr,{clientThreadId:t.clientThreadId,gizmoId:s,currentModelId:t.currentModelId,onRequestCompletion:t.onRequestCompletion}):e.jsx(Jf,{...t})})}function Kf({children:t}){const{store:s}=Le(),[o,n]=i.useState(!1),a=In();i.useEffect(()=>a.subscribe("focus",()=>{n(!0)}),[a]),i.useEffect(()=>a.subscribe("blur",()=>{n(!1)}),[a]);const l=!!s.useSharedProps()?.isShowingAutocomplete;return t(l&&o)}function Qf({isSendBlocked:t,clientThreadId:s,headlineOption:o,shouldShowStarterPrompts:n,promptChips:a,onSelectStarterPrompt:r,starterPromptExpanded:l,setStarterPromptExpanded:d,replaceStarterPromptsWithToolChips:m,toolChips:p,onSelectToolChip:u,selectedHint:c}){const h=Vr();return e.jsx(Kf,{children:x=>e.jsxs(ee.div,{initial:{opacity:0},animate:{opacity:x?0:1},exit:{opacity:0},transition:{duration:.1},className:B("justify-center",x?"pointer-events-none":"","mt-[var(--screen-optical-compact-offset-amount)] h-full flex-shrink flex-col items-center overflow-hidden text-token-text-primary [display:var(--display-hidden-until-loaded,flex)]",h?"@lg/thread:hidden":"lg:hidden"),children:[o==="CHATGPT_LOGO"?e.jsx(bn,{className:"inline-block h-12 w-12"}):e.jsx(yl,{headlineOption:o}),e.jsxs(ee.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:B(!l&&!m&&"h-[116px]"),children:[n&&e.jsx(jl,{starterPrompts:a,onSelectStarterPrompt:r,disabled:t,clientThreadId:s,onExpand:()=>d(!0),mobileLayout:!0}),m&&e.jsx(Cl,{toolChips:p,onSelectToolChip:u,disabled:t,mobileLayout:!0,selectedHint:c})]})]})})}function Xf(t){const s=Ae("1468311859").value,o=Ae("3664702598").value,{layer:n}=Jt("4031588851"),a=$f(),r=s,l=o&&a;let d="HARDCODED";if(t){const m=n.get("search_autocomplete_mode","");r&&m&&(d=m)}else l&&(d=n.get("autocomplete_mode","HARDCODED"));return d}function Jf({clientThreadId:t,currentModelId:s,isModelLoaded:o,onRequestCompletion:n,chatgptHomepageDisclaimer:a}){const r=In(),l=Kt(t),d=Go(),[m,p]=i.useState([]),u=i.useCallback(y=>{p(q=>{const ae=typeof y=="function"?y(q):y;return Ur(ae,q)?q:ae})},[]),{trendingSuggestions:c,fetchTrendingSuggestions:h}=sx(go),x=i.useRef(!1),{isUnauthenticated:g}=rt(),b=Oc(),[w,S]=i.useState(!1),C=Qi(),k=ot();Pi(r);const _=Ae("589604007").value,{layer:M}=rn("4031588851"),{layer:L}=rn("3533083032"),{replaceStarterPromptsWithToolChips:P,toolChips:f}=Vf(t),T=vl(r,t),U=xl(r),{prospectiveModelId:R}=Hm(t),N=o?s:R??"auto",{promptStarters:v,isSuccess:F}=Ii(l,t,8,_,!0,N),A=b&&!!m.find(y=>!!y.requires_file_upload),H=i.useCallback(y=>{const q=r.getCurrentText();return q&&fo(y).startsWith(q.toLocaleLowerCase())},[r]),I=i.useCallback(y=>{const q=r.getCurrentText(),ae=y.title+y.body;return H(y)?{...y,title:q,body:ae.slice(q.length)}:{...y,title:ae,body:""}},[r,H]),W=i.useCallback((y=!1)=>{u(q=>!q.some(H)&&q.length>0?[]:y?q:q.map(I))},[H,I,u]),Y=(y,q,ae)=>{const pe=y.title;u([]),r.focus(),r.setText(pe),requestAnimationFrame(()=>{const Z=(v?.filter(le=>le.theme===y.theme)??[]).map(le=>{const ue=Yt(le.oneliner),je=ue.startsWith(le.title);return{...le,title:je?`${le.title} `:"",body:je?le.body:ue,autocompletionChunks:Mf(pe,ue),type:es.Autocomplete}});u(Z),Z.length>0&&Xt(Z,t),Um(y,ae,t)})};i.useEffect(()=>{const y=m.some(q=>q.theme===To.Search);C&&r.getCurrentText()===""?c.length>0?u(c):h():y&&!C&&u(q=>q.filter(ae=>ae.theme!==To.Search))},[m,C,c,h,r,u]),i.useEffect(()=>{C&&r.getCurrentText()===""&&c.length>0&&Xt(c,t)},[C,r,c,t]);const D=v?.reduce((y,q)=>(q.theme&&!y[q.theme]&&(y[q.theme]=q),y),{}),te=[];if(D)for(const y in D)y!=="For you"&&te.push(D[y]);const re=te&&te.length>0,Se=!!(F&&re&&o&&!P);Ke.markStart("StarterPromptChips",Ke.NS_COMPOSER),Se&&Ke.markRendered("StarterPromptChips",Ke.NS_COMPOSER);const be=go-m.filter(H).length,J=Xf(C),xe=g?L.get("headline_option","HELP_WITH"):M.get("headline_option","HELP_WITH"),we=M.get("autocomplete_min_char",4),ye=M.get("autocomplete_fetch_interval",200),ie=i.useRef(null),Me=i.useCallback(Fi(async y=>{const q=r.getCurrentText();if(!q||q.length<we||q.length>80||r.hasMultipleLines()){u([]);return}if(!x.current&&!(ie.current&&ie.current.length>we&&q.startsWith(ie.current)))try{const ae=await Ms.generateAutocompletions(q,y,C);if(ae.completions.length===0){ie.current=q;return}const pe=ae.completions.map(Z=>({id:rd(),type:es.Autocomplete,title:Z.slice(0,q.length),body:Z.slice(q.length),oneliner:Z,prompt:Z,source:J})).filter(H).map(I);u(Z=>{const le=Z.filter(H),ue=pe.filter(je=>{const Je=fo(je);return!le.some(Pe=>{const it=fo(Pe);if(Je===it)return!0;const Ee=/[\p{P}\p{S}]$/u,Oe=Je.replace(Ee,""),Ue=it.replace(Ee,"");return Oe===it||Je===Ue||Oe===Ue})}).slice(0,go-le.length);return[...le,...ue]}),pe.length>0&&Xt(pe,t)}catch{}},J==="BING"?150:ye),[r,J,I,ye]),ve=i.useCallback(()=>{W(),be>0&&Me(be)},[Me,W,be]);i.useEffect(()=>{x.current&&u([])},[x,u]);const ge=i.useMemo(()=>J==="HARDCODED"?W:ve,[J,ve,W]),Ne=i.useCallback(()=>{r instanceof da&&W(!0),r.getCurrentText().indexOf(`
`)>0&&u([])},[r,u,W]),ke=i.useCallback((y,q,ae)=>{q.forEach(pe=>{pe.id===y.id&&(pe.userInput=r.getCurrentText())}),u([q[ae]])},[r,u]),Te=Vr();return e.jsx(e.Fragment,{children:e.jsx(xt,{children:e.jsx("div",{className:B("h-full w-full",Te?"@lg/thread:py-[18px]":"lg:py-[18px]"),children:e.jsx(la,{isStaticSharedThread:!1,verticalPadding:"none",horizontalPadding:"standard",clientThreadId:t,fullHeight:!0,children:e.jsxs(Ja,{className:"relative",children:[e.jsx("div",{className:B("mb-7 hidden text-center",Te?"@lg/thread:block":"lg:block"),children:xe==="CHATGPT_LOGO"?e.jsx(bn,{className:"inline-block h-12 w-12"}):e.jsx(yl,{headlineOption:xe})}),e.jsx(Qf,{headlineOption:xe,shouldShowStarterPrompts:Se,promptChips:te,onSelectStarterPrompt:Y,starterPromptExpanded:w,setStarterPromptExpanded:S,isSendBlocked:d,clientThreadId:t,replaceStarterPromptsWithToolChips:P,toolChips:f,onSelectToolChip:T,selectedHint:U}),e.jsx("div",{className:B(Te?"@lg/thread:absolute @lg/thread:bottom-8 @lg/thread:left-0 @lg/thread:w-full":"[display:var(--display-hidden-until-loaded,block)] lg:absolute lg:bottom-8 lg:left-0 lg:w-full"),children:e.jsx(Ja,{className:"relative @lg/thread:pb-0",children:k?e.jsx(bl,{}):e.jsx(hl,{className:"block"})})}),e.jsx("div",{className:"w-full",children:e.jsx(Sl,{clientThreadId:t,isNewThread:l,currentModelId:s,onRequestCompletion:n,showPromptStarters:!1,autocompletions:m,requiresFileUpload:A,onComposerInput:ge,onComposerChange:Ne,onAutocompleteSelect:ke,onTaggingDropdownClose:()=>{x.current=!1},onTaggingDropdownOpen:()=>{x.current=!0},hideHeader:!0})}),e.jsxs(ee.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:B("hidden",Te?"@lg/thread:block":"lg:block",a&&g&&w?"":!P&&"h-[70px]"),children:[Se&&e.jsx(jl,{starterPrompts:te,onSelectStarterPrompt:Y,disabled:d,clientThreadId:t,onExpand:()=>S(!0)}),P&&e.jsx(Cl,{toolChips:f,onSelectToolChip:T,disabled:d,selectedHint:U})]}),a&&e.jsx("div",{className:B("w-full translate-y-4 px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden xs:translate-y-8 md:px-[60px]",Te?"@lg/thread:absolute @lg/thread:bottom-0 @lg/thread:left-0":"lg:absolute lg:bottom-0 lg:left-0"),children:e.jsx("div",{className:B("min-h-4"),children:a})})]})})})})})}function yl({headlineOption:t}){const o=oe().formatMessage(nx[t]||Ss.whatCanIHelpWith);return e.jsx("div",{className:"relative inline-flex justify-center text-center text-2xl font-semibold leading-9",children:e.jsx("h1",{style:{viewTransitionName:"var(--vt-splash-screen-headline)"},children:o})})}function Zf({starterPrompt:t,starterPrompts:s,index:o,disabled:n,onSelectStarterPrompt:a}){const r=t.theme??t.title,l=Rn(),{mutate:d}=zm(),m=t.category==="onboarding"?()=>{d({key:tt.hasUsedConversationalOnboardingStarterPrompt}),l(t,s,o)}:()=>a(t,s,o);return e.jsx(Bi,{disabled:n,onClick:m,icon:e.jsx(Gm,{category:t.category,useV2Colors:!0}),label:r})}function fr({clientThreadId:t,onClick:s}){i.useEffect(()=>{Wm(t)},[t]);const o=oe();return e.jsx(ee.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},className:"inline-block",children:e.jsx(Bi,{onClick:()=>{qm(t),s()},label:o.formatMessage(Ss.moreStarterPrompts)})})}const ex=5,tx=3;function jl({starterPrompts:t,onSelectStarterPrompt:s,disabled:o,clientThreadId:n,onExpand:a,mobileLayout:r=!1}){const l=r?tx:ex,[d,m]=i.useState(l),[p,u]=i.useState(!1),c=i.useRef(null),h=t.length<=d;i.useEffect(()=>{Xt(t.slice(0,l),n)},[n]),i.useEffect(()=>{if(!p&&!h&&c.current){const g=c.current,b=g.getBoundingClientRect(),w=b.width,S=Array.from(g.children);let C=0;for(let k=0;k<S.length&&S[k].getBoundingClientRect().right-b.left<=w;k++)C++;m(C),u(!0)}},[t,h,p]);const x=()=>{const g=t.slice(d,t.length).map(b=>({...b,isAdditional:!0}));g.length>0&&Xt(g,n),m(t.length),a()};return e.jsxs("div",{className:B("mt-5 flex items-center justify-center gap-x-2 transition-opacity xl:gap-x-2.5",p&&t.length>0?"opacity-100":"opacity-[0.01]",r?"flex-wrap":"flex-nowrap"),children:[e.jsxs("ul",{className:B("relative flex items-stretch gap-x-2 gap-y-4 overflow-hidden py-2 sm:gap-y-2 xl:gap-x-2.5 xl:gap-y-2.5",h||r?"flex-wrap justify-center":"flex-nowrap justify-start"),ref:c,children:[t.slice(0,d).map((g,b)=>e.jsx(ee.li,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},children:e.jsx(Zf,{starterPrompt:g,starterPrompts:t,index:b,disabled:o,onSelectStarterPrompt:s})},g.id??b)),r&&t.length>d&&e.jsx(fr,{clientThreadId:n,onClick:x})]}),!r&&t.length>d&&e.jsx(fr,{clientThreadId:n,onClick:x})]})}function Cl({toolChips:t,onSelectToolChip:s,disabled:o,mobileLayout:n=!1,selectedHint:a}){return e.jsx("div",{className:B("mt-5 gap-x-2 transition-opacity xl:gap-x-2.5",t.length>0?"opacity-100":"opacity-[0.01]",{"flex flex-wrap justify-center":!n}),children:e.jsx("ul",{className:B("relative gap-4 overflow-hidden py-2 sm:gap-y-2",{"grid grid-cols-2 justify-items-center":n},{"flex flex-wrap justify-start":!n}),children:t.map(({id:r,label:l,description:d,icon:m,systemHint:p,badge:u},c)=>{const h=e.jsx(Wf,{label:l,description:d,icon:m,badge:u,onClick:()=>{p&&s({hint:p,enable:p.systemHint!==a})},disabled:o});return e.jsx(ee.li,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},children:p.composerBarButtonInfo?e.jsx(qf,{composerBarButtonInfo:p.composerBarButtonInfo,systemHintType:p.systemHint,mobileLayout:n,children:h}):h},r??c)})})})}const sx=t=>{const[s,o]=i.useState([]),n=i.useCallback(async()=>{const r=(await Ms.generateTrendingSuggestions(t)).suggestions.map((l,d)=>({type:es.Trending,title:xr(l),body:"",icon:e.jsx(Lm,{}),prompt:xr(l),id:`search-trending-${d}`,theme:To.Search}));o(r)},[t]);return{trendingSuggestions:s,fetchTrendingSuggestions:n}};function xr(t){return t.split(" ").map(Om).join(" ")}const Ss=He({whatCanIHelpWith:{id:"SplashScreenV2.whatCanIHelpWith",defaultMessage:"What can I help with?"},whereShouldWeStart:{id:"SplashScreenV2.whereShouldWeStart",defaultMessage:"Where should we start?"},askChatgptAnything:{id:"SplashScreenV2.askChatgptAnything",defaultMessage:"Ask ChatGPT anything"},moreStarterPrompts:{id:"SplashScreenV2.moreStarterPrompts",defaultMessage:"More"}}),nx={HELP_WITH:Ss.whatCanIHelpWith,WHERE_TO_START:Ss.whereShouldWeStart,ASK_CHATGPT:Ss.askChatgptAnything};function ox({clientThreadId:t,currentModelId:s,isModelLoaded:o,onRequestCompletion:n,showChatgptHomepage:a,chatgptHomepageDisclaimer:r}){const l=Bt();let d=e.jsx(wp,{}),m;return l?(m=e.jsx(ax,{}),d=e.jsx(bn,{className:"mb-6 h-12 w-12 brand:hidden"})):t!=null?(m=a?e.jsx(Yf,{clientThreadId:t,currentModelId:s,isModelLoaded:o,onRequestCompletion:n,chatgptHomepageDisclaimer:r}):e.jsx(Mp,{clientThreadId:t}),d=null):m=e.jsx(rx,{}),e.jsxs("div",{className:"flex h-full flex-col items-center justify-center text-token-text-primary",children:[d,m]})}function ax({gizmo:t}){const s=$m(),o=t?Ym(t.tools):!1,n=Pt();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-5 text-2xl font-semibold","data-testid":"temporary-chat-label",children:[e.jsx(Km,{id:"temporary-chat-checkbox",name:"temporary-chat-checkbox",checked:!0}),e.jsx(E,{...Et.temporaryChat})]}),e.jsxs("div",{className:"max-w-sm text-center text-sm font-normal text-token-text-tertiary",children:[e.jsx(E,{...n?.isWorkspaceAccount()?s?Et.temporaryChatBizMemoryAvailable:Et.temporaryChatBizMemoryUnavailable:s?Et.temporaryChatDescriptionMemoryAvailable:Et.temporaryChatDescriptionMemoryUnavailable}),o&&e.jsx("div",{className:"mt-3",children:e.jsx(E,{...Et.temporaryChatDescriptionGptActions,values:{link:a=>e.jsx("a",{href:"https://help.openai.com/en/articles/8914046-temporary-chat-faq",target:"_blank",className:"underline",rel:"noreferrer",children:a})}})})]})]})}function rx(){return e.jsx("div",{className:"mb-5 text-2xl font-semibold",children:e.jsx(E,{...Et.howCanIHelpYouToday})})}function ix({clientThreadId:t,currentModelId:s,isModelLoaded:o,onRequestCompletion:n,showChatgptHomepage:a,chatgptHomepageDisclaimer:r}){const l=at(t),d=$r(),m=Go(),{data:p}=Ht(l),u=Vm(),c=Dr(()=>navigator.windowControlsOverlay);return(d!=null||l!=null)&&p==null?null:e.jsxs("div",{className:"relative h-full",children:[e.jsx("div",{className:c?.visible?B("absolute right-[calc(100dvw-env(titlebar-area-width,100dvw)-env(titlebar-area-x,0))]",u?"left-[env(titlebar-area-x,0)]":"left-0"):"absolute left-0 right-0",children:e.jsx(nl,{clientThreadId:t})}),p!=null?e.jsx(Cp,{gizmo:p,showStarterPrompts:!0,disableStarterPrompts:m}):e.jsx(ox,{clientThreadId:t,currentModelId:s,isModelLoaded:o,onRequestCompletion:n,showChatgptHomepage:a,chatgptHomepageDisclaimer:r})]})}const Et=He({temporaryChat:{id:"GizmoLanding.temporaryChat",defaultMessage:"Temporary Chat"},temporaryChatBizMemoryAvailable:{id:"g1opBW",defaultMessage:"This chat won't appear in your history and won't use or create memories."},temporaryChatBizMemoryUnavailable:{id:"fQmbtG",defaultMessage:"This chat won't appear your conversation history."},temporaryChatDescriptionMemoryAvailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryAvailable",defaultMessage:"This chat won't appear in history, use or create memories, or be used to train our models. For safety purposes, we may keep a copy for up to 30 days."},temporaryChatDescriptionMemoryUnavailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryUnavailable",defaultMessage:"This chat won't appear in history or be used to train our models. For safety purposes, we may keep a copy of this chat for up to 30 days."},temporaryChatDescriptionGptActions:{id:"GizmoLanding.temporaryChatDescriptionGptActions",defaultMessage:"Any data shared with a third party through GPT actions are subject to the third party's privacy policy. <link>Learn more</link>"},howCanIHelpYouToday:{id:"GizmoLanding.howCanIHelpYouToday",defaultMessage:"How can I help you today?"}}),lx="bg-token-main-surface-primary text-token-text-primary",cx="openai",vr=["bg-blue-300 text-white"];function dx(t){return vr[(t?.charCodeAt(0)??0)%vr.length]}const en=({children:t})=>e.jsx("div",{className:"pt-0",children:e.jsx("div",{className:B(i.isValidElement(t)&&t.type===_o?"gizmo-bot-avatar":"gizmo-shadow-stroke","flex h-8 w-8 items-center justify-center overflow-hidden rounded-full"),children:t})});function Po(t){const{messages:s,isUserTurn:o,avatarClassName:n,gizmo:a}=t,r="medium",d=s[0]?.message.metadata?.shared_conversation_id,m=d!=null,p=An(),{gizmoEditorData:u,mode:c}=Mn();let h=e.jsx(en,{children:e.jsx(_o,{className:n??lx,iconName:cx,size:r})});return a?h=e.jsx(en,{children:e.jsx(Dp,{gizmoId:a.gizmo.id,className:"h-full w-full"})}):u!=null&&c==="test"&&(h=e.jsx(ua,{isFirstParty:!1,src:u.profilePictureUrl,className:"h-8 w-8 first:pt-[3px]"})),e.jsx("div",{className:void 0,children:o?m?e.jsx(en,{children:e.jsx(_o,{className:dx(d),iconName:"user",size:r})}):e.jsx(en,{children:e.jsx(Qm,{user:p,size:r})}):h})}function ux({modelSlug:t,animateModelLabelOnRender:s,isDropdownOpen:o,isRegenerateEnabled:n,isHovered:a,animateShortLabel:r}){const{data:l}=ft(),[d,m]=i.useState("initial");i.useEffect(()=>{if(s){const h=setTimeout(()=>m("show"),500),x=setTimeout(()=>m("initial"),2e3);return()=>{clearTimeout(h),clearTimeout(x)}}m("initial")},[s]);const{shorterLabel:p}=l?.categories.find(({defaultModel:h})=>h===t)??{},u={initial:{opacity:0,paddingLeft:0,width:"0"},show:{opacity:1,paddingLeft:2,width:"100%"},visible:{opacity:1,paddingLeft:2,width:"100%",transition:{delay:0,duration:0}}},c=o?"visible":a?"show":d;return e.jsxs(ee.div,{initial:"initial",animate:c,className:"flex items-center pb-0",children:[e.jsx(Di,{className:"icon-md"}),(n||r)&&e.jsx(ee.span,{className:"overflow-hidden text-clip whitespace-nowrap text-sm",variants:u,transition:{type:"tween",duration:.18},children:p}),n&&e.jsx(ea,{className:"icon-sm"})]})}function Fo(t,s){const{modelSwitcherDeny:o,subscriptionLevel:n}=t;return!!o&&o.reason===Uc.RATE_LIMIT&&n===zc.PLUS&&!s}const tn="rounded-lg radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed";function mx({className:t,clientThreadId:s,message:o,onModelSelect:n,onDropdownChange:a,canRegenerateResponse:r}){const[l,d]=i.useState(null),[m,p]=i.useState(!1),[u,c]=i.useState(!1),h=at(s),x=Xm({clientThreadId:s,message:o}),g=o.message.metadata?.model_slug,b=o.message.id,{modelOptions:w,modelSlug:S,animateModelLabelOnRender:C,messageModelEnabledTools:k}=x,_=Jm(o.message),M=k.includes(Q.Search),L=i.useMemo(()=>w.find(v=>v.value===g),[w,g]),P=i.useRef(null),{data:f=null}=xn(),T=f&&Bo(f),U=v=>{v||setTimeout(()=>{P.current&&P.current.blur()},10)};if(i.useEffect(()=>{U(m)},[m]),ne(s,eh))return null;const N=r&&w.some(v=>Fo(v,T));return h?null:e.jsxs($.Root,{onOpenChange:v=>{r&&(p(v),a(v),U(v)),v&&O.logEvent(G.conversationOpenMessageModelSelector,{has_get_plus_button:N,is_new_regen_dropdown:!0})},children:[r?e.jsx(px,{label:e.jsx(E,{id:"wDs5sz",defaultMessage:"Switch model"}),children:e.jsx(zo,{ref:P,className:B("cursor-pointer",t),onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),children:e.jsx(ux,{modelSlug:S,animateModelLabelOnRender:C,isDropdownOpen:m,isRegenerateEnabled:r,isHovered:u})})}):null,r&&e.jsx($.Portal,{children:e.jsxs($.Content,{className:"z-30 min-w-fit origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[e.jsx($.Item,{disabled:!0,className:"pb-0 pt-2",children:e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(E,{id:"bFLh5u",defaultMessage:"Switch model"})})}),e.jsx(hx,{clientThreadId:s,messageId:b,onModelSelect:n,messageModelSlug:g,modelOptions:w,setHoveredOption:d,hoveredOption:l,retryOption:L,lastResponseUsedSearch:_,modelSupportsSearch:M,doesUserHaveAnyAccountsWithPlusFeatures:T})]})})]})}function hx({clientThreadId:t,messageId:s,modelOptions:o,messageModelSlug:n,onModelSelect:a,setHoveredOption:r,hoveredOption:l,retryOption:d,lastResponseUsedSearch:m,modelSupportsSearch:p,doesUserHaveAnyAccountsWithPlusFeatures:u}){const c=oe(),[h,x]=i.useMemo(()=>ys(o,S=>S.subcategory),[o]),g=i.useMemo(()=>{const S=new Map;return h.forEach(C=>{const k=C.subcategory;k&&(S.has(k)||S.set(k,[]),S.get(k)?.push(C))}),S},[h]),b=B("icon-sm","order-10 ml-auto text-token-text-tertiary icon-md"),w=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:c.formatMessage(xo.search),icon:e.jsx(yi,{className:b}),condition:p&&!m,eventName:"chatgpt_regenerate_with_search_button_clicked"},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:c.formatMessage(xo.nosearch),icon:e.jsx(Zm,{className:b}),condition:p&&m,eventName:"chatgpt_regenerate_without_search_button_clicked"}];return e.jsxs(e.Fragment,{children:[x.map(S=>{const{value:C,...k}=S;return e.jsx(Ks,{value:C,onSelect:()=>{Re.logEvent("chatgpt_regenerate_switch_model_button_clicked",C,{requestedModelId:C,...gs({clientThreadId:t,messageId:s})}),a({requestedModelId:C})},includeRegenerate:!1,onMouseEnter:()=>r(C),onMouseLeave:()=>r(null),isHovered:l===C,messageModelSlug:n,includeCheck:!1,shouldShowUpsell:Fo(S,u),className:tn,...k,icon:e.jsx("span",{className:b})},C)}),[...g.entries()].map(([S,C])=>e.jsxs($.Sub,{children:[e.jsx($.SubMenuTrigger,{children:e.jsx("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:S})}),e.jsx($.Portal,{children:e.jsx($.SubContent,{className:"min-w-fit",children:C.map(k=>{const{value:_,...M}=k;return e.jsx(Ks,{value:_,onSelect:()=>{Re.logEvent("chatgpt_regenerate_switch_model_button_clicked",_,{requestedModelId:_,...gs({clientThreadId:t,messageId:s})}),a({requestedModelId:_})},includeRegenerate:!1,onMouseEnter:()=>r(_),onMouseLeave:()=>r(null),isHovered:l===_,messageModelSlug:n,includeCheck:!1,className:tn,...M,icon:null,shouldShowUpsell:Fo(k,u)},S+"-"+_)})})})]},S)),!!d&&e.jsxs(e.Fragment,{children:[e.jsx($.Separator,{}),e.jsx(Ks,{onSelect:()=>{Re.logEvent("chatgpt_regenerate_try_again_button_clicked",d.value,{requestedModelId:d.value,...gs({clientThreadId:t,messageId:s})}),a({requestedModelId:d.value})},includeRegenerate:!0,onMouseEnter:()=>r(d.value),onMouseLeave:()=>r(null),messageModelSlug:n,includeCheck:!1,className:tn,...d,label:c.formatMessage(xo.tryAgain),subtitle:d.label,icon:e.jsx(Di,{className:b})},d.value),w.filter(S=>S.condition).map(S=>e.jsx(Ks,{onSelect:()=>{Re.logEvent(S.eventName,d.value,{requestedModelId:d.value,...gs({clientThreadId:t,messageId:s})}),a({requestedModelId:d.value,extraStreamParams:S.extraStreamParams})},includeRegenerate:!1,onMouseEnter:()=>r(S.key),onMouseLeave:()=>r(null),isHovered:l===S.key,messageModelSlug:n,includeCheck:!1,className:tn,...d,label:S.label,subtitle:"",icon:S.icon},S.key))]})]})}function px({children:t,label:s}){return e.jsx(Ft,{label:s,sideOffset:0,children:t})}const xo=He({tryAgain:{id:"VbsBGW",defaultMessage:"Try again"},search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),gx=i.memo(mx),Sr=Qe(()=>Xe(()=>import("./dvllb5fed1b4y7k1.js").then(t=>t.t8),__vite__mapDeps([4,1,2,3,5])).then(t=>t.MemoryActionResult));function br(t,s,o){Yr.updateTree(t,n=>{n.updateNodeMetadata(s,{inlineComparisonRating:o})})}const yr=({messages:t})=>{for(const{message:{metadata:s}}of t){const{augmented_paragen_prompt_label:o}=s??{};if(o)return o}};function fx(t){const s=i.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),o=i.useRef({left:null,right:null});return t.stubSideBySideFeedback?e.jsx(wl,{setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:s,firstVisibleTokenTimestampsRef:o,...t}):e.jsx(xx,{...t,visibilityStateRef:s,firstVisibleTokenTimestampsRef:o})}function xx(t){const{clientThreadId:s,variantIds:o,variantsInStreamInfo:n,turnIndex:a,firstVisibleTokenTimestampsRef:r}=t;if(o.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const l=ya(),d=Vo(),m=Gc(),[p,u]=i.useMemo(()=>Hi(o.join(""))()<.5?[0,1]:[1,0],[o[0],o[1]]),c=p<u?"left":"right",h=c==="left"?"right":"left",x=o[p],g=o[u],[b,w]=ne(s,T=>[Yt(T).tree.getLeafFromNode(x).id,Yt(T).tree.getLeafFromNode(g).id]),S=Yt(jo(s,a,b)),C=Yt(jo(s,a,w)),k=c==="left"?S:C,_=c==="left"?C:S,M=n.display_treatment==="unskippable",L=l?"skippable_parallel_2_in_stream:a:2.0":"skippable_parallel_2_in_stream:a:1.5";i.useEffect(()=>(ko.setState({displayingSideBySideFeedback:!0,unskippable:M}),()=>{ko.setState({displayingSideBySideFeedback:!1,unskippable:!1})}),[M]),th();const P=i.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null});i.useEffect(()=>Wc(qc,{requestCompletion:()=>{const T=pt(s),R=K.getTree($e(s)).getParentPromptNode(b),N=[S,C].map((A,H)=>({messageId:A.messages[A.messages.length-1].message.id,loadFirstTokenTime:H===0?r.current.left:r.current.right,loadEndTime:bs(A.messages)?.completionSampleFinishTime})),v={},F=R.metadata?.variantsInStreamInfo==null&&R.message.metadata?.paragen_variants_info!=null;for(const A of N)v[A.messageId]=F?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:A.loadFirstTokenTime,load_end_time:A.loadEndTime};Tr({params:{conversation_id:T,displayed_message_ids:N.map(A=>A.messageId),message_metadatas:v,rating:"skipped",selected_message_id:null,source_timestamp:Date.now(),ui_variant:l?2:1,user_prompt_message_id:R.message.id}})}}),[S,C,b,s,t.conversationTurnMountTime,L,h,k?.messages,_?.messages,m,l,r]);const f=T=>{const U=K.getTree($e(s)),R=U.getLeafFromNode(T);Yr.setThreadCurrentLeafId(s,R.id);const N=T===x,v=N===(c==="left");k.messages.length>0&&br(s,k.messages[k.messages.length-1].nodeId,v?"original":"new"),_.messages.length>0&&br(s,_.messages[_.messages.length-1].nodeId,v?"original":"new");const F=pt(s),A=[S,C].map((D,te)=>({messageId:D.messages[D.messages.length-1].message.id,loadFirstTokenTime:te===0?r.current.left:r.current.right,loadEndTime:bs(D.messages)?.completionSampleFinishTime})),H=N?A[0].messageId:A[1].messageId,I=U.getParentPromptNode(b),W={},Y=I.metadata?.variantsInStreamInfo==null&&I.message.metadata?.paragen_variants_info!=null;for(const D of A)W[D.messageId]=Y?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:D.loadFirstTokenTime,load_end_time:D.loadEndTime};Tr({params:{conversation_id:F,displayed_message_ids:A.map(D=>D.messageId),message_metadatas:W,rating:"selected",selected_message_id:H,source_timestamp:Date.now(),ui_variant:l?2:1,user_prompt_message_id:I.message.id}})};return e.jsx(wl,{...t,setPreferredFeedback:f,leftVariantId:x,rightVariantId:g,leftTurn:S,rightTurn:C,hasActiveRequest:d,originalTurn:k,visibilityStateRef:P})}function wl({setPreferredFeedback:t,leftVariantId:s,rightVariantId:o,leftTurn:n,rightTurn:a,hasActiveRequest:r,originalTurn:l,visibilityStateRef:d,...m}){const{defaultParagenLabel:p,shouldShowParagenLabels:u=!1}=gi(),c=n&&yr(n)||p,h=a&&yr(a)||p,x=i.useMemo(()=>n?.messages??[],[n?.messages]),g=i.useMemo(()=>a?.messages??[],[a?.messages]),{avatarClassName:b,firstVisibleTokenTimestampsRef:w}=m,S=i.useMemo(()=>fn(x),[x]),C=i.useMemo(()=>fn(g),[g]),k=hi(),_=It(n?ln.getRequestIdFromConversationTurn(n):""),M=It(a?ln.getRequestIdFromConversationTurn(a):""),L=n?.role===Ye.User,P=a?.role===Ye.User,f=i.useRef(null),T=i.useRef(null),U=i.useRef(null),R=!!m.stubSideBySideFeedback,N=!!m.stubSideBySideFeedback;!R&&w.current.left==null&&(w.current.left=Date.now()),!N&&w.current.right==null&&(w.current.right=Date.now()),i.useEffect(()=>{if(f.current&&T.current&&U.current){const I=Array(11).fill(0).map((Y,D)=>D/10),W=new IntersectionObserver(Y=>Y.forEach(D=>{D.target===T.current?(d.current.left_visibility_initial==null&&(d.current.left_visibility_initial=D.intersectionRatio),d.current.left_visibility_max=Math.max(d.current.left_visibility_max??0,D.intersectionRatio)):D.target===U.current&&(d.current.right_visibility_initial==null&&(d.current.right_visibility_initial=D.intersectionRatio),d.current.right_visibility_max=Math.max(d.current.right_visibility_max??0,D.intersectionRatio))}),{root:f.current,threshold:I});return W.observe(T.current),W.observe(U.current),()=>W.disconnect()}},[d]);const{data:v}=pi(void 0,!1,k),F=ya(),A=e.jsx("div",{className:"text-pretty px-6 pb-5 pt-1 text-center text-sm text-token-text-secondary",children:e.jsx(E,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})}),H=ot();return e.jsxs("div",{className:"relative flex flex-col",children:[e.jsxs("div",{className:B("sticky z-[1] text-pretty bg-token-main-surface-primary px-6 text-center text-lg",H&&"top-[var(--thread-leading-height)] pt-3",!H&&"top-[-1px]",F&&!H?"md:top-header-height":H?"":"md:static"),"data-testid":"paragen-feedback-title",children:[e.jsx(E,{id:"JgCHDY",defaultMessage:"You’re giving feedback on a new version of ChatGPT."}),F?A:null]}),F?null:A,e.jsx("div",{className:"relative -mb-2 snap-x snap-mandatory overflow-x-auto px-3 pb-4 md:px-5 lg:px-10",ref:f,children:e.jsx("div",{className:B(!H&&"min-w-fit"),children:e.jsxs("div",{className:B("mx-auto flex max-w-6xl items-start",F&&!H&&"divide-x divide-token-border-medium dark:divide-token-border-heavy",!F&&!H&&"gap-4 sm:gap-6",F&&H&&"divide-x divide-token-border-medium dark:divide-token-border-heavy",H&&!F&&"gap-4 sm:gap-6"),children:[e.jsxs(jr,{horizontalScrollContainerRef:f,rootElementRef:T,onClick:()=>{t(s)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:R,children:[e.jsxs(Mr,{children:[e.jsx(Po,{messages:x,isUserTurn:L,avatarClassName:b}),e.jsx(wr,{children:u?e.jsx("span",{className:"font-bold text-token-text-primary",children:c}):e.jsx(E,{..._r.responseNumber,values:{responseIndex:1}})})]}),F&&R?e.jsx(Cr,{}):e.jsxs(e.Fragment,{children:[v!=null&&!L&&e.jsx(Sr,{clientThreadId:m.clientThreadId,messages:x,isParagen:!0}),e.jsx(No,{...m,allMessages:x,groupedMessagesToRender:S,allGroupedMessages:S,isEditing:!1,isUserTurn:L,isCompletionRequestInProgress:_,hasActiveRequest:r,handleEnterEdit:Vs,handleExitEdit:Vs,shouldGrowContainer:!1,showEditButton:!1,showCopyButton:!1}),e.jsx(kr,{clientThreadId:m.clientThreadId,conversationTurnMountTime:m.conversationTurnMountTime,turn:n,originalTurn:l})]})]}),e.jsxs(jr,{horizontalScrollContainerRef:f,rootElementRef:U,onClick:()=>{t(o)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:N,children:[e.jsxs(Mr,{children:[e.jsx(Po,{messages:g,isUserTurn:P,avatarClassName:b}),e.jsx(wr,{children:u?e.jsx("span",{className:"font-bold text-token-text-primary",children:h}):e.jsx(E,{..._r.responseNumber,values:{responseIndex:2}})})]}),F&&N?e.jsx(Cr,{}):e.jsxs(e.Fragment,{children:[v!=null&&!P&&e.jsx(Sr,{clientThreadId:m.clientThreadId,messages:g,isParagen:!0}),e.jsx(No,{...m,allMessages:g,groupedMessagesToRender:C,allGroupedMessages:C,isEditing:!1,isUserTurn:P,isCompletionRequestInProgress:M,hasActiveRequest:r,handleEnterEdit:Vs,handleExitEdit:Vs,shouldGrowContainer:!1,showEditButton:!1,showCopyButton:!1}),e.jsx(kr,{clientThreadId:m.clientThreadId,conversationTurnMountTime:m.conversationTurnMountTime,turn:a,originalTurn:l})]})]})]})})})]})}function jr({horizontalScrollContainerRef:t,rootElementRef:s,onClick:o,children:n,hasActiveRequest:a,isWaitingOnFirstUserVisibleToken:r}){const l=ya(),d=ot(),{scrollX:m}=id({layoutEffect:!1,container:t,target:s}),p=sh(),u=nh(),c=i.useRef(null),h=i.useRef(null),x=i.useRef(null),[g,b]=i.useState(!1),[w,S]=i.useState(!1),[C,k]=i.useState(!1),[_,M]=i.useState(0);i.useEffect(()=>{if(!l)return;const N=new IntersectionObserver(v=>{for(const F of v)F.target===c.current?b(F.isIntersecting):F.target===x.current?k(F.isIntersecting):F.target===h.current&&S(F.isIntersecting)},{root:p?.current,rootMargin:d?`0px 0px -${_}px 0px`:void 0});return c.current&&h.current&&x.current&&(N.observe(c.current),N.observe(h.current),N.observe(x.current)),()=>{N.disconnect()}},[_,l,d,p]);const L=!C&&(w||g),P=ld(m,N=>L?-1*N:0),f=$a(0);i.useEffect(()=>{if(!l)return;const N=new ResizeObserver(v=>{Qs(v.length===1,"entryList.length === 1");const F=v[0];Qs(F.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),f.set(F.contentBoxSize[0].inlineSize)});return s.current&&N.observe(s.current),()=>{N.disconnect()}},[l,f,s]);const T=$a(0);i.useEffect(()=>{if(!l)return;const N=new ResizeObserver(v=>{Qs(v.length===1,"entryList.length === 1");const F=v[0];Qs(F.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),T.set(F.contentBoxSize[0].blockSize+16),M(F.contentBoxSize[0].blockSize)});return u.current&&N.observe(u.current),()=>{N.disconnect()}},[l,T,u]);const U=e.jsx(gt,{className:l?"px-5":"mt-4 self-start",onClick:o,"data-testid":"paragen-prefer-response-button",children:e.jsx(E,{id:"U2EAH6",defaultMessage:"I prefer this response"})}),R=r;return e.jsxs("div",{"data-paragen-root":!0,className:B("relative flex w-full min-w-[min(450px,80vw)] snap-center flex-col gap-1 text-left",d&&l&&"pl-3 pr-5 sm:w-[calc(100cqw-62px)] sm:pl-3 sm:pr-5 md:px-10",!d&&l&&"px-10",l?"min-h-60 py-4":"rounded-2xl border border-token-main-surface-tertiary bg-white p-5 dark:bg-gray-700"),ref:s,children:[e.jsx("div",{className:B("absolute left-0 right-0 top-48 h-px","invisible"),ref:c}),e.jsx("div",{className:B("absolute bottom-0 left-0 right-0 top-48","invisible"),ref:h}),e.jsx("div",{className:B("absolute bottom-0 left-0 right-0 h-px","invisible"),ref:x}),n,l?e.jsx("div",{className:"flex-1"}):null,l?e.jsx("div",{className:"mt-4 min-h-10",children:R?null:e.jsx(ee.div,{style:{translateX:P,width:f,bottom:T},animate:{opacity:100},initial:{opacity:0},transition:{ease:"easeOut",duration:.2,delay:.5},className:B({fixed:L,"z-20 flex w-full justify-center":!0}),children:U})}):a?null:U]})}function Cr(){return e.jsxs("div",{className:"flex w-full flex-col gap-4 pb-5 pt-3",children:[e.jsx(Nt,{className:"h-4 w-[75%]"}),e.jsx(Nt,{className:"h-4 w-[50%]"}),e.jsx(Nt,{className:"h-4 w-[80%]"}),e.jsx(Nt,{className:"h-4 w-[55%]"}),e.jsx(Nt,{className:"h-4 w-[66%]"}),e.jsx(Nt,{className:"h-4 w-[64%]"}),e.jsx(Nt,{className:"h-4 w-[48%]"})]})}function ya(){const{layer:t}=Jt("3119715334");return t.get("should-enable-hojicha",!1)}const wr=Ce.div`text-sm text-token-text-secondary font-semibold`,Mr=Ce.div`flex gap-4 items-center mb-1`,Nt=Ce.div`animate-pulse rounded-[4px] bg-token-main-surface-tertiary`;function kr({clientThreadId:t,conversationTurnMountTime:s,turn:o,originalTurn:n}){const a=ia();if(!a.showParagenMetadata||!a.showDebugConversationTurns&&!a.forceParagen||o==null)return null;let r=o===n?"ORIGINAL":"NEW";const l=o.messages[o.messages.length-1],d=l?.message?.metadata?.__internal;if(d){const{model_id:c,model_definition_slug:h,model_definition_virtual_model_id:x,alternative_model_selection_rule:g,augmented_paragen_prompt_group_id:b,augmented_paragen_prompt_id:w,augmented_paragen_prompt:S}=d;c&&(r+=`
Model ID: ${c}`),h&&(r+=`
Model Slug: ${h}`),x&&(r+=`
Virtual Model ID: ${x}`),g&&(r+=`
Alternative Model Rule: ${g}`),b&&(r+=`
Prompt Group ID: ${b}`),w&&(r+=`
Prompt ID: ${w}`),S&&(r+=`
Prompt: ${S}`)}r+=`
Message ID: ${l.message.id}`;const p=K.getTree($e(t)).getParentPromptNode(o.variantIds[0]),u=p.metadata?.variantsInStreamInfo==null&&p.message.metadata?.paragen_variants_info!=null;return r+=`
User prompt message ID: ${p.message.id}`,r+=`
Is Persisted Paragen? ${u}`,r+=`
Completion Sample Finish Time: ${u?`${s} (persisted)`:bs(o.messages)?.completionSampleFinishTime}`,e.jsx("div",{className:"whitespace-pre-wrap text-sm text-red-500",children:r})}async function Tr({params:t}){await Ms.submitParagenSelectionV2(t)}const _r=He({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}"}});function vx({handleShowRetrievalResults:t,clientThreadId:s,turnIndex:o,responseComplete:n=!1}){const[a,r]=ne(s,u=>[K.getTurnContentReferences(u,o),Do(u?.conversationTurns[o]?.messages??[])]),l=i.useMemo(()=>({turnIndex:o,clientThreadId:s,responseComplete:n}),[s,n,o]),d=i.useRef(!1);i.useEffect(()=>{d.current||(d.current=!0,O.logEvent(G.fileSourcesFooterShown,l))},[l]);const m=i.useCallback(()=>{O.logEvent(G.fileSourcesFooterClicked,l),t()},[t,l]),p=i.useMemo(()=>{const u=new Set,c=[];function h(g){!g||u.has(g)||(u.add(g),c.push(g))}if(a.forEach(g=>{g.type==="file"?h(g.cloud_doc_url??g.extra?.cloud_doc_url):g.type==="file_navlist"&&g.items.forEach(b=>{h(b.cloud_doc_url)})}),n){for(const g of r)if(oh(g.message)){const b=ah(g.message.content.result),w=g.message.metadata?.cloud_doc_urls??[],S=b.chunks;for(let C=0;C<S.length;C++){const k=S[C];if(!k.documentId)continue;if(C<w.length){h(w[C]);continue}const _=k.documentId.endsWith("--google")?k.documentId.split("--")[1]:void 0,M=k.metadata.cloud_doc_url??(_?`https://drive.google.com/file/d/${_}`:void 0);h(M?.toString())}break}}const x=[];for(let g=0;g<c.length;g++){const b=c[g],w=rh(b);if(w&&x.push(w.Icon),x.length>=3)break}return x},[r,a,n]);return e.jsxs(e.Fragment,{children:[e.jsx(ee.div,{className:"absolute h-[60px]",initial:{opacity:0},animate:{opacity:1},children:e.jsxs("button",{className:B("not-prose group/footnote mb-2 mt-3 flex w-fit items-center gap-1.5 rounded-xl border border-token-border-light bg-token-main-surface-primary py-2 hover:bg-token-main-surface-secondary","pl-3 pr-2.5"),onClick:m,children:[e.jsx("div",{className:"flex items-center gap-0.5 text-sm font-medium",children:e.jsx(E,{id:"/48IOP",defaultMessage:"Sources"})}),p.length>0&&e.jsx("div",{className:"flex flex-row-reverse gap-1",children:p.reverse().map((u,c)=>e.jsx(ee.div,{className:B("flex items-center overflow-hidden rounded-full border-token-main-surface-primary bg-token-main-surface-primary","group-hover/footnote:border-token-main-surface-secondary","relative"),initial:{opacity:0},animate:{opacity:1},children:e.jsx(u,{className:"icon-md"})},c))})]})}),e.jsx("div",{className:"h-[60px]"})]})}function Sx({clientThreadId:t,followups:s}){const[o,n]=i.useState(null),a=jn.useIsEnabled(t);return e.jsxs(e.Fragment,{children:[e.jsx(Cx,{visible:o==="conversation"}),e.jsx(wx,{visible:o==="global"}),a&&s.length>0&&e.jsx(bx,{clientThreadId:t,followups:s,setDisableMessage:n})]})}function bx({clientThreadId:t,followups:s,setDisableMessage:o}){const n=Rn();return e.jsxs("div",{className:"group",children:[e.jsxs("div",{className:"mb-1 flex items-center text-sm font-semibold",children:[e.jsx(E,{id:"AXj+ek",defaultMessage:"Suggested"}),e.jsx(jx,{clientThreadId:t,setDisableMessage:o})]}),e.jsx("div",{children:s.slice(0,4).map((a,r)=>e.jsx(ee.div,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:r*.03},exit:{opacity:0,translateY:4},children:e.jsx(yx,{followUp:a,onSelectingSuggestedReply:n,isLastItem:r===s.length-1})},r))})]})}function yx({followUp:t,onSelectingSuggestedReply:s,isLastItem:o}){return e.jsxs(ee.button,{whileHover:"hover",className:"flex w-full items-start gap-2",onClick:()=>s(t,[],0),children:[e.jsx(ee.div,{className:"flex w-6 items-center justify-center pt-3.5 opacity-70",variants:{hover:{x:4}},initial:{x:0},transition:{duration:.1},children:e.jsx(ra,{className:"h-4 w-4 text-token-text-secondary"})}),e.jsx("div",{className:B("flex-1 gap-0.5 border-b border-token-border-xlight py-2.5 pr-2 text-left",o&&"border-b-0"),children:ih(t)})]})}function jx({clientThreadId:t,setDisableMessage:s}){const o=jn.useStore(),[n,a]=i.useState(!1);return e.jsxs(Cs,{size:"small",onOpenChange:r=>a(r),contentClassName:"min-w-[200px]",triggerButton:e.jsx("button",{className:"ml-2 flex h-6 w-6 items-center justify-center rounded-md text-token-text-tertiary hover:bg-token-main-surface-tertiary focus:outline-none focus:ring-0",children:e.jsx(_i,{className:B("h-4 w-4 opacity-0 group-hover:opacity-100",n&&"opacity-100")})}),children:[e.jsx($.Item,{onClick:()=>{o.setDisabledConversation(t,!0),s("conversation"),setTimeout(()=>s(null),3e3)},className:"text-token-text-primary",children:e.jsx(E,{id:"GZYofd",defaultMessage:"Hide for this chat"})}),e.jsx($.Item,{onClick:()=>{o.setDisabledGlobally(!0),s("global"),setTimeout(()=>s(null),5e3)},className:"text-token-text-primary",children:e.jsx(E,{id:"dtAOq4",defaultMessage:"Hide everywhere"})})]})}const Ml={initial:{opacity:1},animate:{opacity:1},exit:{opacity:0,transition:{duration:.2}}};function Cx({visible:t}){return e.jsx(xt,{children:t&&e.jsx(ee.div,{...Ml,className:"flex justify-center py-6 text-sm text-token-text-tertiary",children:e.jsx(E,{id:"Ntz6wG",defaultMessage:"Suggestions are turned off for this conversation"})})})}function wx({visible:t}){return e.jsx(xt,{children:t&&e.jsxs(ee.div,{id:"disableForAllConvos",...Ml,className:"flex flex-col items-center py-3 text-sm",children:[e.jsx("div",{children:e.jsx(E,{id:"w3puuP",defaultMessage:"Suggestions have been turned off"})}),e.jsx("div",{className:"pt-1 text-token-text-tertiary",children:e.jsx(E,{id:"LYaBNe",defaultMessage:"You can re-enable them in settings"})})]})})}const Ar=[1,2,3,4,10,20,30],Mx=.5;function kx({clientThreadId:t}){const s=Li(Oi.isBusinessWorkspace),o=i.useRef(!1),n=Dt(t),a=ne(t,f=>f?.mode),{isUnauthenticated:r}=rt(),l=i.useMemo(()=>{if(!n)return-1;const f=Hi(n);return f()>Mx?-1:Ar[Math.floor(f()*Ar.length)]},[n]),d=Vc(t),m=d[d.length-1],p=i.useMemo(()=>ln.getRequestIdFromConversationTurn(m),[m]),u=It(p),[c,h]=i.useState(null),[x,g]=i.useState(!1),[b,w]=i.useState(!1),[S,C]=i.useState(!1),k=f=>{const T=bs(d)?.messages[0]?.message.id;h(f),L(T,f)},_=d.filter(f=>f.role===Ye.Assistant).length,M=m?.role===Ye.Assistant,L=i.useMemo(()=>Fi((f,T)=>{n&&f&&Ms.submitConversationRating({conversation_id:n,message_id:f,rating:T,shown_at_assistant_turn:l}),O.logEvent(G.conversationRatingSubmitted,{rating:T,showAtAssistantTurn:l,conversationId:n}),g(!0),setTimeout(()=>{w(!0)},1500)},2e3),[n,l]),P=_!==l||u||!M||!!s||a?.kind!==De.PrimaryAssistant||S||r;return i.useEffect(()=>{!P&&!o.current&&(O.logEvent(G.conversationRatingShown,{showAtAssistantTurn:l,conversationId:n}),o.current=!0)},[P]),S||P?null:e.jsxs("div",{className:"mx-auto",children:[e.jsx(xt,{children:x&&!b&&e.jsx(ee.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(Nr,{$padded:!0,children:e.jsx("span",{className:"text-sm text-token-text-tertiary",children:e.jsx(E,{id:"rating.thanks",defaultMessage:"Thanks for your feedback!"})})})},"submitted")}),!x&&e.jsx(ee.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},children:e.jsxs(Nr,{$padded:!1,children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 px-4 py-3 text-sm text-token-text-secondary",children:[e.jsx(E,{id:"rating.instructions",defaultMessage:"Is this conversation helpful so far?"}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx(vo,{$selected:c==="thumbsUp",onClick:()=>k("thumbsUp"),children:e.jsx(Ui,{className:"icon-md"})}),e.jsx(vo,{$selected:c==="thumbsDown",onClick:()=>k("thumbsDown"),children:e.jsx(zi,{className:"icon-md"})})]})]}),e.jsx("div",{className:"w-px flex-1 self-stretch bg-token-main-surface-tertiary"}),e.jsx(vo,{className:"p-3",$selected:!1,onClick:()=>C(!0),children:e.jsx($c,{className:"icon-md text-token-text-secondary hover:text-token-text-primary"})})]})},"rating")]})}const vo=Ce.button`
  ${t=>t.$selected?"text-token-text-primary":"text-token-text-secondary"}
  hover:text-token-text-primary
`,Nr=Ce.div`inline-flex rounded-xl border border-gray-100 dark:border-gray-700
${t=>t.$padded&&"py-3 px-4"}
`,Tx=Qe(()=>Xe(()=>import("./fsw3jr6twb9frdxl.js"),__vite__mapDeps([54,2,1,3,4,5,55])));function _x({clientThreadId:t,canShowInlineMessageFeedback:s,messageForRating:o,allGroupedMessages:n,currentModelId:a}){let r=null;const l=ne(t,c=>{const h=K.getConversationTurns(c);let x=0;for(let g=h.length-1;g>=0;g--){const b=h[g];if(b.messages.some(w=>w.message.metadata?.is_indepth_feedback))return!0;if(b.messages.some(w=>w.message.author.role===Ye.Assistant)&&x++,x>=3)break}return!1}),d=Dt(t),m=sa(c=>c.voiceFeedbackThread),p=d===m,{voiceName:u}=lh();return l?null:(p&&d?(Yc.feedbackShown.success({voice:u}),r=e.jsx("div",{className:"text-center",children:e.jsx(ch,{serverThreadId:d})})):o.rating&&s?r=e.jsx(Tx,{clientThreadId:t,conversationMessage:o,allGroupedMessages:n,currentModelId:a}):r=e.jsx("div",{className:"text-center",children:e.jsx(kx,{clientThreadId:t})}),e.jsx("div",{className:"mt-3 w-full empty:hidden",children:r}))}const Ax=Qe(()=>Xe(()=>import("./owc9f1cvmrdg7wny.js"),__vite__mapDeps([56,2,1,3,57,58,4,5,59,60,61])).then(t=>t.VoicePlayButton)),Nx=Qe(()=>Xe(()=>import("./d92a9jypjbtn5sjn.js"),__vite__mapDeps([62,2,4,1,3,5,63,64])).then(t=>t.AutomationSourceHeader)),Er=80,Ex=16,Rr={minHeight:`calc(100dvh - ${Gi}px - ${Ph}px - 100px)`};function Rx(t){const{turnIndex:s,isFinalTurn:o,clientThreadId:n,onChangeRating:a,currentModelId:r,avatarClassName:l,showAvatar:d,scrollToMessageId:m,dateHeaderType:p}=t,u=oe(),c=An();Pt()?.normalizedAccountUserId;const h=!!c&&Kc(c),x=Oo(),g=Li(Oi.isBusinessWorkspace),b=ts(),{value:w}=Ae("2848981774"),{value:S}=Ae("1456513860"),C=d??!S,_=null!=null,M=w&&!_,{value:L}=Ae("1887864177"),P=pt(n),f=Yt(jo(n,s)),{messages:T,variantIds:U,variantsInStreamInfo:R}=f,N=fn(T),v=dh(),F=bs(T);let A=F;for(const z of N){const fe=Op(z);if(fe.some(ut=>v.has(ut.message.id))){A=fe[fe.length-1];break}}const H=F!==A,I=T.slice(0,A?T.indexOf(A)+1:0),W=!1,Y=ws(),[D,te]=i.useState(!1),[re,Se]=i.useState(!1),be=U.findIndex(z=>I.some(fe=>fe.nodeId===z)),J=f.role===Ye.User,xe=Bt(),we=at(n),ye=Ht(f.gizmoId??we)?.data,ie=Jo(r),Me=uh(r),ve=ot(),ge=i.useContext(yn),Ne=qo(ge),[ke,Te,y,q,ae,pe]=ne(n,z=>{const fe=z?.tree!=null&&U.some(ut=>{const Qn=z.tree.getLeafFromNode(ut);return z.tree.getHasErrorFromNode(Qn.id)});return[z?.async_status===qr.STREAMING,K.isMessageTurnEnded(z),fe,Fh(Do(z?.mode),ye?.gizmo.id),z?.continuingFromSharedConversationId!=null,null]});let Z="default";const le=I.some(z=>z.message.content.content_type===Qc.MultimodalText),{layer:ue}=Jt("1547743984"),je=P&&Y&&ue.get("show_share_button_inline",!1),Je=null,{isUnauthenticated:Pe}=rt(),[it,Ee]=i.useState(!1),[Oe,Ue]=i.useState(!1),lt=f.messages.map(z=>z.message.id),Ze=i.useRef(null),ce=T[T.length-1],st=ce.rating,Ns=(m?.length??0)>2&&m!=="finalAgentTurn"&&o&&M,ss=()=>{I.length===1&&(O.logEvent(G.editPrompt,{id:I[0].message.id,threadId:pt(n)}),Re.logEvent("chatgpt_edit_prompt"),te(!0))},Es=i.useCallback(()=>{te(!1)},[]),me=i.useCallback(z=>{mh(n,s,b,z)},[n,s,b]),se=z=>{a({nodeId:ce.nodeId,messageId:ce.message.id,rating:z}),O.logEvent(z==="thumbsDown"?G.messageFeedbackThumbsDownClicked:G.messageFeedbackThumbsUpClicked,{id:ce.message.id,threadId:pt(n),model:r,rating:z}),Se(!0)},[vt]=i.useState(()=>Date.now()),St=hh(n),Pn=i.useMemo(()=>ln.getRequestIdFromConversationTurn(f),[f]),Fe=It(Pn)&&!Te,Lt=Vo(),Rs=fn(I),_e=i.useRef(!1),Ot=ph(n,F);i.useEffect(()=>{if(_e.current||m===void 0||!M||!Ze.current){m==="finalAgentTurn"&&o&&_e.current&&fs(n,z=>{z.scrollToMessageId=void 0});return}(lt.includes(m)||m==="finalAgentTurn"&&o)&&(_e.current=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(Ze.current)if(m==="finalAgentTurn"&&o)Ze.current.scrollIntoView({behavior:"instant",block:"end"}),fs(n,z=>{z.scrollToMessageId=void 0});else{const z=Ze.current.offsetHeight;let fe;z>Er?fe=Er-z:fe=0,Ze.current.style.scrollMarginTop=`${fe+Ex+Gi}px`,Ze.current.scrollIntoView({behavior:"smooth"})}})}))},[m,Ze.current]);const{showDebugConversationTurns:bt}=ia(),Fn=Ni(),Is=gh(n,F),ct=Lp({clientThreadId:n,conversationMode:q}),ns=i.useCallback(({requestedModelId:z,systemMessage:fe,extraStreamParams:ut})=>{ct({id:ce.nodeId,requestedModelId:z,systemMessage:fe,extraStreamParams:ut})},[ce,ct]),ze=!x&&!ae&&!xe&&!J,os=fh(),Ps=A?.message.author.role===Ye.Assistant?A.message:null,dt=A?.message.metadata?.system_hints?.includes(Q.Research);xh({isCompletionRequestInProgress:Fe,isUserTurn:J,message:Ps});const{isOpen:as}=pp(),Bn=fi(),yt=vh(q),Ut=!os&&!yt&&ze&&o&&R?.num_variants_in_stream===2&&!ce.inlineComparisonRating&&!y,zt=Sh(f),jt=Ut,Fs=Ut&&!zt,et=!H&&!J&&!x&&!ae&&!yt&&!ke&&!Fe&&!as&&!_&&!St,Gt=et&&(!g||Me||h)&&!yt&&!Pe&&!xe&&!F?.message.metadata?.b1de6e2_s,Wt=!x&&!((Fe||ke)&&o)&&U.length>1&&!D&&!jt&&!_,rs=J&&I.length===1&&bh(I[0])?.shouldHideContent,Dn=J&&!yt&&!x&&!le&&I.length===1&&!rs&&!D&&!Pe&&!_&&!dt,Hn=i.useCallback(z=>{fs(n,fe=>{const ut=K.getTree(fe).getLeafFromNode(U[z]);Wr.setCurrentLeafId(fe,ut.id)}),O.logEvent(G.changeNode,{intent:"toggle_between"})},[n,U]),Ln=yh(f,I,bt),{toggleThreadSidebar:Ge}=Xc(),qt=i.useMemo(()=>f.messages.length?f.messages[f.messages.length-1].nodeId:void 0,[f.messages]),is=i.useCallback(()=>{qt&&Ge({type:"retrievalResults",clientThreadId:n,turnIndex:s,messageId:qt})},[qt,Ge,n,s]),{value:Ct}=Ae("2912660649"),On=i.useMemo(()=>Ct&&jh(f,ie,!!we),[Ct,ie,we,f]),Un=Jc(n,s);if(!Ln&&!jt)return Ns?e.jsx("div",{style:Rr}):null;const zn=A?.message.metadata?.followup_prompts?A.message.metadata.followup_prompts.map(z=>({text:z,type:es.Reply})):[],ls=I.some(({message:z})=>Zc.getAssetPointers(z).length>0),Bs=St&&!Fe&&f.role===Ye.Assistant&&Un===1||I.some(({message:z})=>z.author.role===Ye.Assistant&&z.metadata?.onboarding?.main_usages),_t=I.find(({message:z})=>!!z.metadata?.onboarding?.examples)?.message.metadata?.onboarding?.examples,Vt=ls?null:e.jsx(gx,{className:"h-[30px] rounded-md px-1 text-token-text-secondary hover:bg-token-main-surface-secondary",clientThreadId:n,message:ce,onModelSelect:ns,onDropdownChange:Ee,canRegenerateResponse:Is}),Be=!rs&&(!J||!D)&&(!o||!Fe),Hs=Be?e.jsx(Bh,{onClick:me}):null,Wn=!J&&(!o||!Fe)&&(ce.disclaimers??[]).length===0&&ce.nodeId?e.jsx(Ax,{conversationId:n,message:ce,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-xs text-token-text-tertiary hover:text-token-text-primary"}):null,qn=!J&&ce&&(!o||!Fe)?e.jsx(Dh,{message:ce,isFinalTurn:o,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-token-text-tertiary hover:text-token-text-primary"}):null,Vn=Ot&&e.jsx(Hh,{turn:f}),Ls=Gt&&!Fe?e.jsxs("div",{className:"flex",children:[st!=="thumbsDown"&&e.jsx(ho,{onClick:()=>se("thumbsUp"),disabled:st==="thumbsUp",icon:st==="thumbsUp"?Ch:Ui,label:u.formatMessage({id:"ConversationTurn.goodResponseTooltip",defaultMessage:"Good response"}),testId:"good-response-turn-action-button"},`thumbsUp:${ce.nodeId}`),st!=="thumbsUp"&&e.jsx(ho,{onClick:()=>se("thumbsDown"),disabled:st==="thumbsDown",icon:st==="thumbsDown"?wh:zi,label:u.formatMessage({id:"ConversationTurn.badResponseTooltip",defaultMessage:"Bad response"}),testId:"bad-response-turn-action-button"},`thumbsDown:${ce.nodeId}`)]}):null,$n=je&&e.jsx(ho,{onClick:()=>{pn.openSharingModal(P)},label:u.formatMessage({id:"ConversationTurn.shareButtonTooltip",defaultMessage:"Share conversation"}),className:"sm:hidden",icon:Mh});function Os(z){return ve?z:e.jsx(la,{clientThreadId:n,isStaticSharedThread:x,verticalPadding:Z,horizontalPadding:jt?"none":Ne||C?"standard":"expanded",children:z})}const Yn=!jt;function Kn(z){return ve?z:e.jsx(gn,{shouldRemoveGap:_,children:z})}return Fn&&!o&&f.messages.every(({message:z})=>Gr(z).length===0)?null:e.jsxs(e.Fragment,{children:[e.jsx(kh,{dateHeaderType:p,turn:f}),e.jsxs("article",{className:B("w-full text-token-text-primary focus-visible:outline-2 focus-visible:outline-offset-[-4px]",m==="finalAgentTurn"&&M?"opacity-0":""),style:Ns?Rr:void 0,ref:Ze,dir:"auto","data-testid":`conversation-turn-${s}`,"data-scroll-anchor":o,onMouseEnter:()=>Ue(!0),onMouseLeave:()=>Ue(!1),children:[e.jsx(Th,{role:f.role}),Os(e.jsx(e.Fragment,{children:jt?e.jsx(fx,{isFeedbackEnabled:Gt,variantIds:U,variantsInStreamInfo:R,conversationTurnMountTime:vt,stubSideBySideFeedback:Fs,...t}):Kn(e.jsxs(e.Fragment,{children:[W,!J&&!W&&C&&e.jsx(Px,{children:e.jsx(Po,{messages:I,isUserTurn:J,avatarClassName:l,gizmo:ye})}),e.jsx("div",{className:B("group/conversation-turn relative flex w-full min-w-0 flex-col",!J&&_h,Yn&&"@xs/thread:px-0 @sm/thread:px-1.5 @md/thread:px-4"),children:e.jsx("div",{className:"flex-col gap-1 md:gap-3",children:e.jsxs(e.Fragment,{children:[null,!J&&!x&&e.jsx(Ah,{messages:I,clientThreadId:n,gizmoId:ye?.gizmo.id}),Bn&&!J&&e.jsx(Nx,{clientThreadId:n,messages:I}),e.jsx(No,{allMessages:T,groupedMessagesToRender:Rs,allGroupedMessages:N,...t,isEditing:D,isUserTurn:J,isCompletionRequestInProgress:Fe,isFeedbackEnabled:Gt,isFinalTurn:o,hasActiveRequest:Lt,showEditButton:Dn,showCopyButton:Be,handleEnterEdit:ss,handleExitEdit:Es}),ie&&!Ct&&e.jsx("div",{className:"mb-4",children:e.jsx(Nh,{messages:I})}),On&&e.jsx(vx,{handleShowRetrievalResults:is,clientThreadId:n,turnIndex:s,responseComplete:!(Fe||ke)}),Bs&&e.jsx(Vp,{clientThreadId:n}),_t&&_t.length>0&&e.jsx($p,{clientThreadId:n,examples:_t}),(et||Wt)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:B("mb-2 flex gap-3 empty:hidden",J?"mr-1 flex-row-reverse":"-ml-2"),children:e.jsx(Eh,{alwaysShow:o,showInline:o||Wt,isHovered:Oe||it,pagination:Wt&&e.jsx(Rh,{showInline:o||Wt,currentPage:be,onChangeIndex:Hn,length:U.length,className:B("self-center",U.length>1?"visible":"!invisible")}),actions:et&&e.jsxs(e.Fragment,{children:[Hs,Ls,Wn,Vn,qn,$n,Je,Vt]})})}),et&&!Fe?e.jsx("div",{className:"pr-2 lg:pr-0",children:e.jsx(Ih,{message:ce,isFinalTurn:o})}):null,o&&!Fe&&e.jsxs(e.Fragment,{children:[e.jsx(_x,{canShowInlineMessageFeedback:re,clientThreadId:n,messageForRating:ce,allGroupedMessages:N,currentModelId:r}),L&&e.jsx(Sx,{followups:zn,clientThreadId:n})]})]})]})})})]}))}))]})]})}const Ix=Yo.memo(Rx),Px=Ce.div`flex-shrink-0 flex flex-col relative items-end`;function Fx({onChangeRating:t,onRequestCompletion:s,clientThreadId:o,hideHeader:n}){const[a,r,l,d,m]=ne(o,A=>[A?.mode,K.getConversationTurns(A).length,K.getThreadData(A).isArchived,A?.conversationOrigin===ed.APPLE,A?.scrollToMessageId]),p=Le(),u=Wo(),c=Lh(),[h]=Oh(),x=Uh(),[g]=zh(),b=Pt(),w=Tn(o),S=p.store.useContentAreaDimensions(Zt.Header,A=>A?.height?A.height:void 0),C=p.store.useIsHeaderContentAreaPopulated(),k=Gh(w.id),_=a?.kind===De.GizmoMagicCreate?"bg-token-main-surface-primary text-token-text-primary":k,M=Wh(),[L,P]=i.useState(0),[f,T]=i.useState(!1);i.useEffect(()=>{u&&(L===0?P(r):!f&&r>L&&(T(!0),Re.logEvent("chatgpt_continue_conversation_first_message_sent"),O.logEvent(G.continueConversationFirstMessageSent)))},[r,L,f,u]),i.useEffect(()=>{u&&(Re.logEvent("chatgpt_continue_conversation_page_loaded"),O.logEvent(G.continueConversationPageLoaded),Re.logEvent("chatgpt_conversation_share_page_loaded"),O.logEvent(G.sharedConversationPageLoaded))},[u]);const U=i.useCallback(()=>{c({behavior:"smooth"})},[c]),R=qh(o),N=M&&!l,v=Vh(o),F=(A,H,I,W)=>[...new Array(H-A).keys()].map(Y=>{const D=Y+A;return e.jsx(Ix,{isFinalTurn:I(D),turnIndex:D,clientThreadId:o,onChangeRating:t,onRequestCompletion:s,currentModelId:w.id,avatarClassName:_,scrollToBottom:U,scrollToMessageId:W,dateHeaderType:v(D),showAvatar:void 0},D)});return e.jsxs("div",{onCopy:R,className:B("flex flex-col text-sm",N&&"pb-[120px]",S||N?null:"md:pb-9"),style:{paddingBottom:N?void 0:S},children:[!n&&b?.data&&e.jsx(nl,{clientThreadId:o}),u&&e.jsxs(e.Fragment,{children:[e.jsx(gn,{children:e.jsx("p",{className:"text-xs text-gray-500",children:e.jsx(E,{id:"threadLayout.sharedConversationCopyDisclaimer",defaultMessage:"This is a copy of a conversation between ChatGPT & Anonymous."})})}),r-L===0&&e.jsx("div",{className:"text-center text-xs font-semibold text-token-text-primary",children:e.jsx("button",{onClick:()=>{pn.openModal($h.ReportConversation),Re.logEvent("chatgpt_conversation_share_report_content_clicked",null,{location:"Static Shared Thread Page"}),O.logEvent(G.sharedConversationReportContentClicked,{location:"Dynamic Shared Thread Page"})},children:e.jsx(E,{id:"thread.reportSharedConversation",defaultMessage:"Report content"})})}),F(0,L,A=>A===L-1,m),e.jsx(gn,{children:e.jsxs("p",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(Yh,{className:"icon-xs mr-2"}),e.jsx(E,{id:"threadLayout.sharedConversationPrivateDisclaimer",defaultMessage:"Messages beyond this point are only visible to you"})]})}),F(L,r,A=>A===r-1,m)]}),!u&&F(0,r,A=>A===r-1,m),d&&h&&!g&&e.jsx(Ir,{className:B("translate-y-[10px] md:translate-y-[30px]"),onClick:()=>{Re.logEvent("chatgpt_thread_scroll_to_top"),x({behavior:"smooth"})},children:e.jsx(Kh,{className:"icon-md text-token-text-primary"})}),!h&&e.jsx(Ir,{className:B(S?null:"bottom-5",N?C?"translate-y-[-50px]":"translate-y-[-10px]":""),style:{bottom:M?"calc(var(--composer-bar_footer-current-height) + var(--composer-bar_current-height))":S},onClick:()=>{Re.logEvent("chatgpt_thread_scroll_to_bottom"),c({behavior:"smooth"})},children:e.jsx(Qh,{className:"icon-md text-token-text-primary"})})]})}const Ir=Ce.button`cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-token-text-secondary border-token-border-light right-1/2 translate-x-1/2 bg-token-main-surface-primary w-8 h-8 flex items-center justify-center`,Bx=60,Dx=({children:t,scrollViewClassName:s,scrollAnchorTopOffset:o=0})=>{const n=i.useRef(null);return e.jsx("div",{className:"h-full",ref:n,children:e.jsx(Sn,{children:e.jsx(Hp,{className:"h-full",followButtonClassName:"hidden",initialScrollBehavior:"auto",scrollViewClassName:s,scroller:()=>Hx(n,o)?0:1/0,children:t})})})},Hx=(t,s)=>{const o=Lx(t.current);if(o==null)return!1;const n=o>s,a=o<s-Bx;return!n&&!a};function Lx(t){if(!t)return null;const s=t.querySelector('[data-scroll-anchor="true"]');if(!s)return null;const o=s.getBoundingClientRect().top,n=t.getBoundingClientRect().top;return o-n}const Ox=Qe(()=>Xe(()=>import("./denmuc242cu8qwp5.js"),__vite__mapDeps([65,1,2,3,4,5,14,66,67,68,69,59,70])).then(t=>t.OpenDebugSidebarButton)),Ux=Qe(()=>Xe(()=>import("./ddgwwmuht3gj4qcb.js"),__vite__mapDeps([71,2,4,1,3,5]))),Pr=He({doNotShareSensitive:{id:"thread.modal.onboarding.title",defaultMessage:"Do not share sensitive materials with this application"},somethingWentWrong:{id:"thread.modal.unrecoverableError.title",defaultMessage:"Something went wrong"},tryAgainLater:{id:"thread.modal.unrecoverableError.description",defaultMessage:"We're sorry, but something went wrong. Please try again later."},resetThread:{id:"thread.modal.unrecoverableError.resetThread",defaultMessage:"Reset thread"},sharedConversationReportConversation:{id:"thread.sharedConversation.report",defaultMessage:"Report conversation"},latencyButton:{id:"thread.latencyButton",defaultMessage:"Latency"},archivedConversationDescription:{id:"thread.archivedConversationDescription",defaultMessage:"This conversation is archived. To continue, please unarchive it first."},unarchiveButton:{id:"thread.unarchiveButton",defaultMessage:"Unarchive"}});function zx({clientThreadId:t}){const s=Kr(),o=Dt(t),n=ne(t,K.getGizmoId),a=async()=>{o&&(await Ms.patchConversation(o,{is_archived:!1}),s.invalidateQueries({queryKey:["conversation",t]}),fs(o,r=>{r.initialThreadData.isArchived=!1}),up(s,n))};return e.jsxs("div",{className:"my-6 flex flex-col items-center justify-center gap-4",children:[e.jsx("div",{className:"px-3 text-center text-sm text-token-text-secondary",children:e.jsx(E,{...Pr.archivedConversationDescription})}),e.jsx("div",{children:e.jsx(gt,{disabled:!o,onClick:a,icon:lp,children:e.jsx(E,{...Pr.unarchiveButton})})})]})}const Gx=function({clientThreadId:t,preRequestCompletion:s,hideHeader:o,hideMessages:n,hideFooter:a,hideToolsOverlay:r,messagesVerticalAlign:l="top",prependThreadChildren:d,renderEmptyState:m,prefetchSearch:p}){const u=zr(),{data:c}=ft(),h=Ts(t),x=$r(),[g,b,w,S,C,k,_]=ne(t,y=>[y?.isLoading,K.getCurrentLeafId(y),K.hasUserMessage(y),y?.conversationTurns.length??0,K.getThreadData(y).isArchived,y?.modelId,y?K.getGizmoId(y):x]);td(t),i.useEffect(()=>{g||(Kt(t)?an.addTiming("chatgpt.web.chatPage.renderNewConversation"):an.addTiming("chatgpt.web.chatPage.renderExistingConversation"))},[t,g]);const{setTargetedContent:M}=Ri(),L=u?.includes(sd),{value:P}=Ae("2848981774"),f=Xh(),U=P&&null==null,R=S>=2;Ei(R);const N=Kt(t)&&!R&&nn(h),v=Kt(t)&&!w&&(nn(h)||h?.kind===De.GizmoTest),A=Ko(c).id,H=k??A,I=!!k,W=Jo(H),Y=vs(c?.models,H),D=Jh(t,h),te=Ai();Zh(S,t),i.useEffect(()=>{te||M(void 0)},[t,M,te,b]);const re=cd({clientThreadId:t,preRequestCompletion:s}),{caModal:Se,onChangeRating:be}=ep({clientThreadId:t,currentModelId:H}),J=zp({clientThreadId:t,handleRequestCompletion:re,prefetchSearchPromise:p}),xe=y=>U?e.jsx(Sn,{children:e.jsxs(i.Suspense,{fallback:null,children:[e.jsx(cp,{}),e.jsx("div",{className:"flex h-full flex-col overflow-y-auto",children:y})]})}):e.jsx(Dx,{scrollAnchorTopOffset:o?0:dp,children:l==="bottom"?e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"flex-1"}),y]}):y});i.useEffect(()=>{document.title=D??"ChatGPT"},[D]);const we=Bt(),ye=i.useContext(yn),ie=qo(ye),Me=ie,ve=v&&!m&&!_&&!W&&!we,ge=Wo(),Ne=i.useRef(null),ke=i.useRef(null),Te=i.useMemo(()=>({threadContentScrollContainerElementRef:Ne,footerRootContainerElementRef:ke}),[]);return e.jsxs(yp,{clientThreadId:t,children:[L&&e.jsx(Ux,{}),e.jsx(tp,{children:D!=null&&e.jsx("title",{children:D})}),e.jsx(nd.Provider,{value:re,children:e.jsxs(sp,{children:[e.jsxs(Zp,{noKeyboard:!0,clientThreadId:t,currentModelConfig:Y,className:B("composer-parent flex flex-col focus-visible:outline-0",ve?"h-[calc(100%-2rem)]":"h-full"),children:[!n&&e.jsx(np,{value:Te,children:e.jsx(Wx,{ref:Ne,className:ie?"pb-[0.75rem]":"pb-[1.5rem]",children:!g&&!J?v?m??e.jsx(ix,{clientThreadId:t,currentModelId:H,isModelLoaded:I,onRequestCompletion:re,showChatgptHomepage:ve,chatgptHomepageDisclaimer:Me?null:ve&&e.jsx(Za,{clientThreadId:t})}):R?xe(e.jsxs(e.Fragment,{children:[d,e.jsx(Fx,{onChangeRating:be,onRequestCompletion:re,clientThreadId:t,hideHeader:o},t)]})):null:null})}),e.jsx(qx,{ref:ke,children:C?e.jsx(zx,{clientThreadId:t}):e.jsxs("div",{children:[!ve&&e.jsx(Uf,{clientThreadId:t,isNewThread:N,showPromptStarters:N||!w,currentModelId:H,onRequestCompletion:re}),!a&&!Me&&e.jsx("div",{className:"relative w-full px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden md:px-[60px]",children:nn(h)&&!ve&&e.jsx("div",{className:"min-h-4",children:e.jsx(Za,{clientThreadId:t})})})]})})]}),!r&&!ie&&e.jsxs("div",{className:"group absolute bottom-2 end-2 z-20 flex flex-col gap-1 md:flex lg:bottom-3 lg:end-3",children:[f?e.jsxs(e.Fragment,{children:[e.jsx(Ox,{}),!1]}):null,e.jsx(op,{})]}),Se,e.jsx(ap,{clientThreadId:t,isStaticSharedThread:!1,isDynamicSharedThread:ge}),e.jsx(rp,{}),e.jsx(ip,{conversationId:t,isActiveWindow:!0})]})})]})},rv=Yo.memo(Gx),Wx=Ce.div`grow flex-1 overflow-hidden @container/thread translate-y-[2rem] -mt-[2rem]`,qx=Ce.div`md:pt-0 dark:border-white/20 md:border-transparent md:dark:border-transparent w-full isolate has-[[data-has-thread-error]]:[box-shadow:var(--sharp-edge-bottom-shadow)] has-[[data-has-thread-error]]:pt-2`;export{Ix as C,eg as D,ix as E,Zp as F,rv as M,Sl as P,Yf as S,mg as T,Dx as W,nl as a,zp as b,Uf as c,pg as d,av as e,Jp as g,el as h,sl as u};
//# sourceMappingURL=gjttiufxol9zbtcw.js.map
