import{r as L,j as n}from"./l6lryjpkt8rv0lpy.js";import{C as G}from"./fb3bizq0bxm0zvn3.js";import{D as F,a as Z}from"./byuiu3x6cts4tfgw.js";import{T as q,a as J,A as P,u as K,i as Q,C as X,g as Y}from"./ns08nk6gry8lf6yi.js";import{C as $,b as z}from"./oik4rnml2048h1rb.js";import{C as V}from"./d6vtla9za6od171e.js";import{u as tt,b as ot,c as et,d as M}from"./za47cv3m73qs1c5u.js";import{C as rt}from"./l4ce2zdnnawhaijx.js";import{g as nt,gL as it,gM as k}from"./dvllb5fed1b4y7k1.js";import{Z as st,f as lt}from"./mnkup87aq6tfilq5.js";import"./j0lbvh7yyn1vzttk.js";import"./fzrn137102spawew.js";import"./jnjzqafy9dn7o7ce.js";import"./iymdu606svzw61cb.js";import"./cbms2jcglp4b707f.js";import"./1e3kywkhcjn5spyo.js";import"./f651cyqvxf3m7zo6.js";import"./0b2acbvk15dg7sha.js";import"./cgqlugpygnveiuks.js";import"./gry6c7en9b8uaktm.js";import"./ipgaseve9xp2bi1a.js";import"./dssqb33wed4i78fb.js";import"./d5w25xgxcglldc4u.js";import"./nxg0mr2frwehg6na.js";import"./4wfwbvmzqu7tbfmg.js";import"./no74ca53mzecj421.js";import"./lrbwp2trsv9othld.js";import"./gy64pge8qevmvg7e.js";import"./bk8slwxjkdlmxjxm.js";import"./hjvhqy8z9mtcdx24.js";import"./bec9qm8zi6ffweg0.js";import"./jm8zus0mi88xmv2y.js";import"./ffxduo863rikjmz1.js";import"./gaz67n36d71l6yif.js";import"./gffbkcdjbbbnp8kb.js";import"./h4jw8c63q447uotc.js";import"./ele1ib7knnne85uk.js";function ct(t,o){const l=t.doc.lineAt(o.from);return o.from===l.from&&o.to-1===l.to}function at(t){const o=t.dom.querySelector(".cm-gutters");return o?o.offsetWidth:0}const mt=({onAddComment:t,isSendDisabled:o=!1,isWaitingForCommentResponse:l=!1})=>{const e=tt(),u=ot(),c=et(),w=L.useCallback(i=>{const{height:a,width:m}=i,r=e();if(!u||!r)return null;const d=u.selection.asSingle();if(d.ranges.length===0)return null;const s=d.ranges[0],{empty:D,to:O}=s;let{head:p}=s;const{platform:H}=nt();p=H==="web"?p:O;const g=p===O;let h=p;if(g&&ct(u,s)&&(h-=1),D)return null;const{left:v,top:x,bottom:R}=r.contentDOM.getBoundingClientRect(),{left:A,top:I,bottom:C}=st(r.coordsAtPos(h,g?-1:1)),E=at(r);function N(){if(g)return Math.max(A-v+E-m,E);let f=A-v+E;return f+m>c&&(f=-(m-c)),f}function W(f){const T=a*2,_=f.contentHeight-(C-R)>T&&window.innerHeight-C>T,y=C-x+8,j=I-x-a-8;return g&&_||j<0?{top:y,aboveOrBelow:P.BELOW}:{top:j,aboveOrBelow:P.ABOVE}}const b=W(r);return{left:N(),top:b.top,aboveOrBelow:b.aboveOrBelow,toolbarSize:i}},[u,e,c]),B=L.useCallback(()=>e()?.dom??null,[e]);return n.jsx(q,{onAddComment:t,isWaitingForCommentResponse:l,isSendDisabled:o,toolbarType:J.CODE,getToolbarPosition:w,getEditorDom:B,getSelectionRange:()=>{const i=e();if(!i)return null;const{state:a}=i,m=a.selection.asSingle();if(m.ranges.length===0)return null;const r=m.ranges[0],{from:d,to:s}=r;return d==null||s==null?null:{from:d,to:s,sourceFrom:d,sourceTo:s}}})};function dt({diff:t}){return K(t?.edits??[]),null}function ut(t,o,l){const e=l?Y():0;return t<=1e3-e?t-(o?$:0):t-(o?z:0)}const Xt=({comments:t,currentlyStreamingLineIndex:o,isPreview:l=!1,isWaitingForCommentResponse:e=!1,isSendDisabled:u=!1,readonlyReason:c,isRequestActive:w=!1,language:B,value:i,textdocDiff:a,onAcceleratorsExpandedChange:m,onAddComment:r,onAcceptComment:d,onDismissComment:s,onBlur:D,onSave:O,onChange:p,onCancelRequest:H,getStableCommentId:g=lt,commentsMode:h=V.ENABLED,hideToolbar:v,hideAccelerators:x=!1,onSubmitAccelerator:R,modelCursor:A,codemirrorRef:I})=>{const C=L.useRef(null),[{width:E},N]=it(),W=L.useRef(null),b=t.length>0,f=W.current,T=ut(E,b,Q(f)??!1),_=M(({commentingOn:S})=>S),y=M(({hoveredCommentId:S})=>S),j=M(({focusedCommentId:S})=>S);L.useEffect(()=>{C.current?.UNSAFE_setValue(i||"")},[i]);const U=E-T;return n.jsx("div",{className:rt.code,ref:k(N,W),children:n.jsxs(G,{id:"codemirror",comments:h===V.ALL_HIDDEN?void 0:t,commentingOn:_,currentlyStreamingLineIndex:o,hoveredCommentId:y,focusedCommentId:j,language:B,readonlyReason:c,onChange:p,value:i,textdocDiff:a,editorRef:k(C,I),width:T,modelCursor:A,isPreview:l,onBlur:D,onSave:O,children:[n.jsxs(G.EditorChildren,{children:[!v&&n.jsx(mt,{onAddComment:r,isSendDisabled:u,isWaitingForCommentResponse:e}),h!==V.ALL_HIDDEN&&n.jsx("div",{className:b?"mr-4":"",children:n.jsx(X,{getStableCommentId:g,availableWidth:U,comments:t,commentsMode:h,onAddComment:r,onAcceptComment:d,onDismissComment:s,isWaitingForCommentResponse:e,isRequestActive:w,disableBlockComments:!0})})]}),n.jsxs(G.ContextChildren,{children:[a&&n.jsx(dt,{diff:a}),!x&&n.jsx(F,{isRequestActive:w,isVisuallyHidden:u||!!c?.isStreamingFromNative||c?.isReadonly&&!c.isStreaming,onSubmit:R,onCancel:H,actions:Z,onExpandedChange:m})]})]})})};export{Xt as CodeComposer};
//# sourceMappingURL=91py5v8kf77uu1nh.js.map
