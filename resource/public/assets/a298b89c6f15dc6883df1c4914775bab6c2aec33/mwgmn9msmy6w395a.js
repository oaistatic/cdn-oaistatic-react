const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/dehe28ju87ci5mom.js","assets/n75kuy1cx6f5mogg.js","assets/ny10lj7zpuz89fvf.js","assets/ewse8exzafeu10ji.js","assets/root-l2v84m1w.css","assets/conversation-small-hotcas67.css","assets/ce2i59offcjvzu0m.js","assets/e0z6030ycsi62lhu.js"])))=>i.map(i=>d[i]);
var V=Object.defineProperty,D=Object.defineProperties;var K=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var w=(t,e,o)=>e in t?V(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,k=(t,e)=>{for(var o in e||(e={}))Q.call(e,o)&&w(t,o,e[o]);if(S)for(var o of S(e))Y.call(e,o)&&w(t,o,e[o]);return t},A=(t,e)=>D(t,K(e));import{R as b,i as v,q as F,j as z,ej as H,br as _,aY as X,bq as C,d9 as $,e5 as Z,f as J,aT as ee,e as q,B as O,O as te,nA as oe,r as ne,P as T,ek as se,aV as N,aZ as R,A as re}from"./ewse8exzafeu10ji.js";import{r as p,u as L,f as ie,j as n,M as u,a as ae}from"./n75kuy1cx6f5mogg.js";import{gS as le,gT as de,aU as ue,gU as ce,b2 as me,b1 as U,gV as fe,gW as ye,dF as he}from"./ny10lj7zpuz89fvf.js";import{S as pe}from"./g7mxjj0ktl5g8wm5.js";import"./ce2i59offcjvzu0m.js";import"./e0z6030ycsi62lhu.js";const j="memories/current_memory_undo_id",W={async getCurrentMemoryUndoId(t){return await b.safeGet("/memories/current_memory_undo_id",{parameters:{query:{gizmo_id:t}}})},async undoMemoryWrite(t,e){return await b.safePost("/memories/undo_memory_write",{requestBody:{gizmo_id:t,memory_undo_id:e}})}},ge=H(()=>se(()=>import("./dehe28ju87ci5mom.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])));let E=!1;function G(t){return t.find(e=>{var o;return e.author.role===_.Tool&&((o=e.metadata)==null?void 0:o.pending_memory_info)})}function xe(t){return t.filter((e,o)=>{const s=t[o+1],a=(s==null?void 0:s.recipient)==="assistant"&&(s==null?void 0:s.author.role)===_.Tool&&(s==null?void 0:s.author.name)==="bio"&&X(s).startsWith("Model set context");return e.author.role===_.Assistant&&e.recipient==="bio"&&a}).flatMap(e=>{const o=e.content.content_type;return o===C.Text?e.content.parts:o===C.Code?[e.content.text]:[]}).map(we)}function Me(t){return t.some(e=>e.author.role===_.Assistant&&e.recipient==="bio"&&e.status==="in_progress")}function _e(t){var o;const e=t.find(s=>s.author.role===_.Tool&&s.author.name==="bio"&&s.recipient===_.Assistant);return(o=e==null?void 0:e.metadata)==null?void 0:o.current_memory_undo_id}function be(t){const{eligible:e,isLoading:o}=de(),s=p.useMemo(()=>t.length>0,[t]);p.useEffect(()=>{s&&e&&!o&&$.openModal(Z.GlobalMemoryOnboarding)},[s,e,o])}function je(t){const[e,o]=p.useState(!1);return{isPopoverOpen:e,setIsPopoverOpen:o,handleTogglePopover:r=>{const a=r!=null?r:!e;o(a),a&&T.logEvent("Memory Update Popover Shown",{updateCount:t.length})}}}function I({memoryWrites:t,popoverState:e,triggerButton:o,isParagen:s,gizmoId:r,memoryUndoId:a,setShowMemoriesModal:d}){return n.jsxs(ye,{open:e.isPopoverOpen,sideOffset:4,side:"bottom",alignAgainstAnchor:"start",size:"none",className:"z-10 max-w-96 min-w-60 text-sm",onOpenChange:i=>e.handleTogglePopover(i),disableAutofocus:!0,triggerButton:o,children:[n.jsx("div",{className:"border-token-border-default bg-token-main-surface-secondary mb-2 rounded-sm border",children:t.map((i,l)=>n.jsx("div",{className:"border-token-border-default border-b px-3 py-2 first-letter:uppercase last:border-b-0",children:i},l))}),s?n.jsx("div",{className:"text-token-text-tertiary text-xs",children:n.jsx(u,{id:"MemoryActionResult.paragenMessage",defaultMessage:"This memory will be saved if you choose this response."})}):n.jsxs(n.Fragment,{children:[n.jsx(Se,{gizmoId:r,memoryUndoId:a}),n.jsx(B,{onClick:()=>{d(!0),T.logEvent("Memory Update Popover Manage Button Clicked",{updateCount:t.length})},children:n.jsx(u,{id:"MemoryActionResult.manageMemories",defaultMessage:"Manage"})})]})]})}function ve({clientThreadId:t,pendingMessage:e,memoryWrites:o,popoverState:s,setShowMemoriesModal:r}){const a=J(),d=ee(t),i=ue({clientThreadId:t}),l=o.join(" ");let g=l.slice(0,50).replace(new RegExp("^\\p{L}","u"),f=>f.toLocaleUpperCase()).replace(/\.$/,"");l.length>50&&(g+="...");const x=async f=>{var y;if(!d)throw new Error("Failed to confirm or reject memory update: serverThreadId is not found");const c=(y=e.metadata)==null?void 0:y.pending_memory_info;N(t,h=>{R.updateTree(h,m=>{m.updateNodeMessageMetadata(e.id,{pending_memory_info:A(k({},c),{is_pending:!1,confirm_result:f})})})});try{await b.safePost("/memories/confirm_or_reject",{requestBody:{message_id:e.id,conversation_id:d,is_confirm:f},authOption:re.SendIfAvailable})}catch(h){a.danger({id:"memory.confirmOrDenyFail",defaultMessage:"Failed to confirm or reject memory update",description:"Error message when confirming or rejecting memory update fails"},{toastId:"memory_confirm_or_deny_fail"}),N(t,m=>{R.updateTree(m,M=>{M.updateNodeMessageMetadata(e.id,{pending_memory_info:c})})})}};return n.jsxs("div",{className:"flex items-start",children:[n.jsx("div",{className:"text-token-text-tertiary inline-block text-sm font-semibold outline-hidden",children:n.jsx(u,{id:"MemoryActionResult.memoryConfirmation",defaultMessage:"Update memory? {memoryText}",values:{memoryText:n.jsx("div",{className:"inline-block py-1",onMouseOver:()=>s.handleTogglePopover(!0),onMouseOut:()=>s.handleTogglePopover(!1),children:n.jsx(I,{memoryWrites:o,popoverState:s,triggerButton:n.jsx("button",{className:q("text-start font-normal",s.isPopoverOpen?"text-token-text-secondary":"text-token-text-tertiary"),children:n.jsx(u,{id:"MemoryActionResult.memoryWrapper",defaultMessage:"“{memoryWrites}”",values:{memoryWrites:g}})}),setShowMemoriesModal:r})})}})}),n.jsx(O,{className:"text-token-text-tertiary hover:text-token-text-primary ms-3",size:"small",color:"secondary",disabled:i,onClick:()=>{x(!0)},children:n.jsx(u,{id:"MemoryActionResult.confirm",defaultMessage:"Yes"})}),n.jsx(O,{className:"text-token-text-tertiary hover:text-token-text-primary ms-2",size:"small",color:"secondary",disabled:i,onClick:()=>{x(!1)},children:n.jsx(u,{id:"MemoryActionResult.deny",defaultMessage:"No"})})]})}function Te({memoryWrites:t,popoverState:e,isParagen:o,memoryUndoId:s,gizmoId:r,setShowMemoriesModal:a,showTooltip:d}){const i=ce(),{eligible:l,markAsViewed:g,isLoading:x}=me(U.hasSeenMemoryUpdatedTooltip),f=!te(oe),[c,y]=p.useState(!1),h=v(),m=ne(h),M=m==null?void 0:m.hasPlusFeatures();return p.useEffect(()=>{!x&&l&&i&&d===!0&&!E?(y(!0),E=!0):!x&&!l&&y(!1)},[d,x,l,i]),t.length===0?null:n.jsxs("div",{className:"flex items-center",children:[n.jsx(fe,{announcementKey:U.hasSeenMemoryUpdatedTooltip,show:c,onDismiss:()=>{g(),T.logEventWithStatsig("Memory Updated Tooltip Dismissed","memory_updated_tooltip_dismissed")},dismissOnOutsideClick:!0,side:f?"bottom":"left",sideOffset:4,theme:"bright",badge:"none",title:n.jsx(u,{id:"MoonshineV2Tooltip.heading",defaultMessage:"Memory in ChatGPT has changed"}),description:n.jsxs(n.Fragment,{children:[M?n.jsx(u,{id:"MoonshineV2Tooltip.description",defaultMessage:"ChatGPT can now reference all chats, but you can still manage individual saved memories."}):n.jsx(u,{id:"MoonshineV2Tooltip.description.freeMoonshine",defaultMessage:"ChatGPT can now reference recent chats, but you can still manage individual saved memories."}),n.jsx("br",{}),n.jsx("a",{href:"https://help.openai.com/en/articles/10303002-how-does-memory-use-past-conversations",target:"_blank",rel:"noopener noreferrer",className:"underline",children:n.jsx(u,{id:"MoonshineV2Tooltip.learnMoreLink",defaultMessage:"Learn more"})},"learn-more-link")]}),children:n.jsx("div",{style:{width:1,height:1}})}),n.jsx("div",{className:"inline-block",onMouseOver:()=>e.handleTogglePopover(!0),onMouseOut:()=>e.handleTogglePopover(!1),children:n.jsx(I,{memoryWrites:t,popoverState:e,isParagen:o,gizmoId:r,memoryUndoId:s,triggerButton:n.jsxs("button",{className:q("my-1 flex items-center gap-1 text-sm font-semibold outline-hidden",e.isPopoverOpen?"text-token-text-secondary":"text-token-text-tertiary"),children:[n.jsx(pe,{className:"mb-[-1px]"}),t.length===1?n.jsx(u,{id:"MemoryActionResult.memoryWriteSingular.New",defaultMessage:"Updated saved memory"}):n.jsx(u,{id:"MemoryActionResult.memoryWritePlural.New",defaultMessage:"Updated saved memories"})]}),setShowMemoriesModal:a})})]})}function Pe(t){var s,r;const e=G(t),o=(r=(s=e==null?void 0:e.metadata)==null?void 0:s.pending_memory_info)==null?void 0:r.confirm_result;return e==null?null:o===!0?"confirmed":o===!1?"denied":"pending"}function Ee({messages:t,clientThreadId:e,gizmoId:o,isParagen:s}){const r=xe(t),a=je(r),d=Me(t),i=_e(t);be(r);const l=G(t),g=v(),f=F(g,"3983984123").get("is_memory_undo_enabled",!1);z(g,"1900515849"),le();const c=p.useRef(!1),y=L();p.useEffect(()=>{d&&c.current===!1&&(c.current=!0),!d&&!l&&i&&c.current&&y.invalidateQueries({queryKey:[j,o]})},[d,l,i,o,y]);const{data:h}=ie({queryKey:[j,o],queryFn:()=>W.getCurrentMemoryUndoId(o),enabled:f&&!d&&!l}),[m,M]=p.useState(!1),P=Pe(t);return P==="denied"?null:n.jsxs(n.Fragment,{children:[P==="pending"?n.jsx(ve,{clientThreadId:e,memoryWrites:r,popoverState:a,setShowMemoriesModal:M,pendingMessage:l}):n.jsx(Te,{memoryWrites:r,popoverState:a,isParagen:s,memoryUndoId:(h==null?void 0:h.current_memory_undo_id)===i?i:void 0,setShowMemoriesModal:M,showTooltip:c.current&&r.length>0}),m&&n.jsx(ge,{initialGizmoId:o,onClose:()=>M(!1)})]})}function B({children:t,disabled:e,onClick:o}){return n.jsxs("button",{className:"hover:bg-token-main-surface-secondary flex w-full items-center justify-between rounded-sm px-3 py-2 font-semibold",disabled:e,onClick:o,children:[t,n.jsx(he,{className:"icon text-token-text-tertiary -me-1"})]})}function Se({gizmoId:t,memoryUndoId:e}){const o=v(),r=F(o,"3983984123").get("is_memory_undo_enabled",!1),a=L(),{isPending:d,mutate:i}=ae({mutationFn:l=>W.undoMemoryWrite(t,l),onSuccess:()=>{a.invalidateQueries({queryKey:[j,t]})}});return!r||!e?null:n.jsx(B,{disabled:d,onClick:()=>{e&&i(e)},children:n.jsx(u,{id:"qeyS8G",defaultMessage:"Undo"})})}function we(t){const e=["The user ","The user's ","User ","User's "];for(const o of e)if(t.startsWith(o))return t.slice(o.length);return t}export{Ee as MemoryActionResult};
//# sourceMappingURL=mwgmn9msmy6w395a.js.map
