import{b as te,r as C,j as e,M as s,L as xe,c as pe,t as ge,D as he}from"./n75kuy1cx6f5mogg.js";import{n as we,hC as ve,lO as je,i as ye,j as be,fA as se,B as Re,ik as Pe,dv as Ne,b as _e,I as Me,e as h,T as U,rm as Ae,E as Ce}from"./ewse8exzafeu10ji.js";import{W as Se}from"./lg0bckqp15rzbs79.js";import{nv as Ee,cg as Te,ao as O,ap as A}from"./ny10lj7zpuz89fvf.js";import{z as ae,A as ke,C as G,u as Ie}from"./fmsmhem5hrm2cxrs.js";import{T as o}from"./e0z6030ycsi62lhu.js";import{S as Be}from"./e4ownbpid351j1fr.js";import{I as Le}from"./e2tpmvaykwot5faa.js";import{u as Oe,a as Ue,b as Ve,c as De}from"./2o5l1tfalaiecrv0.js";import{u as Ge,o as We}from"./jnesdzvnbqlanb03.js";import{u as qe}from"./gbkq4bf2fni3ski9.js";import"./chdemz4xlfbm1987.js";import"./kj8rd4pu8k32z2dy.js";import"./d65yyyom1modmtdi.js";import"./fh2tsu8ocsi22jc3.js";import"./nyfr63odztw7y2ja.js";import"./heyok871zyju5auh.js";import"./ltsv6em2m484o9yy.js";import"./kas18igmwglc2mb4.js";import"./e0y2s8usszg014s2.js";import"./jocaiq9wugboh64i.js";function Fe({isSaving:i,initialScope:t,onChange:d}){const n=te(),[f,u]=C.useState(t),l=e.jsx(s,{id:"wham.codeReviewPage.autoReviewMyPRs.titleV2",defaultMessage:"Personal preferences"}),m=e.jsx(s,{id:"wham.codeReviewPage.autoReviewMyPRs.descriptionV2",defaultMessage:"Review all my pull requests."});return e.jsx("section",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"flex w-full flex-wrap items-start justify-between gap-4 sm:flex-nowrap",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("p",{className:"text-sm font-medium",children:l}),e.jsx("p",{className:"text-token-text-secondary text-xs",children:m})]}),e.jsx("div",{className:"flex h-full items-center pe-2 sm:w-auto",children:e.jsx(we,{"aria-label":n.formatMessage({id:"wham.codeReviewPage.personalPreferences.toggleRepoCodeReviewAria",defaultMessage:"Toggle code review for personal preferences"}),checked:f==="always",disabled:i,onCheckedChange:r=>{const x=r?"always":"repo_default";u(x),d(x)}})})]})})}function He(){return e.jsxs("section",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex w-full flex-wrap items-start justify-between gap-4 sm:flex-nowrap",children:e.jsx("div",{className:"flex w-full flex-col gap-2",children:e.jsx(ve,{type:"info",className:"bg-token-bg-tertiary! rounded-2xl!",icon:e.jsx(Ee,{className:"icon-md text-token-text-tertiary"}),isElevated:!1,content:e.jsx("p",{className:"text-token-text-secondary text-sm leading-tight font-normal",children:e.jsx(s,{id:"wham.codeReviewPage.infoBannerV2.bannertext",defaultMessage:"When code review is turned on, Codex automatically suggests improvements to the pull request, or react with üëç.{br}Mention @<b>codex</b> in your pull request to start a task or manually request a review.",values:{br:e.jsx("br",{}),b:i=>e.jsx("span",{className:"font-medium",children:i})}})})})})}),e.jsx("div",{className:"bg-token-border-default h-px"})]})}function Ye(i,t){const d=je("installations/select_target");if(i.length>1)return d;const n=i[0];return t?n.account_type==="user"?"https://github.com/settings/installations/".concat(n.id,"/permissions/update"):"https://github.com/organizations/".concat(n.account_login,"/settings/installations/").concat(n.id,"/permissions/update"):"https://github.com/settings/installations/".concat(n.id)}function $e(){const i=ye(),t=be(i,"2782825951"),{data:d}=ae(),n=C.useMemo(()=>{var u;return(u=d==null?void 0:d.installations_without_events)!=null?u:[]},[d]);if(n.length===0)return null;const f=Ye(n,t);return e.jsx("div",{className:"pt-2",children:e.jsxs("div",{className:"bg-token-bg-status-warning outline-token-border-status-warning flex items-start justify-start gap-3 self-stretch rounded-2xl p-4 outline outline-offset-[-1px]",children:[e.jsx("div",{className:"text-token-text-status-warning relative h-5 w-5",children:e.jsx(se,{className:"icon-md"})}),e.jsxs("div",{className:"inline-flex flex-1 flex-col items-start justify-start gap-1",children:[e.jsx("div",{className:"text-token-text-status-warning text-sm leading-tight font-medium",children:e.jsx(s,{id:"wham.codeReviewPage.permissionsBanner.title",defaultMessage:"Action required"})}),e.jsx("div",{className:"justify-start self-stretch",children:e.jsx("p",{className:"text-token-text-status-warning text-sm leading-tight font-normal",children:n.length>1?e.jsx(s,{id:"wham.codeReviewPage.permissionsBanner.description.multiple",defaultMessage:"Some repos require updated GitHub permissions for code reviews to work"}):e.jsx(s,{id:"wham.codeReviewPage.permissionsBanner.description.single",defaultMessage:"Update your GitHub permissions to enable code reviews for <u>{installationName}</u>",values:{u:u=>e.jsx("span",{className:"underline",children:u}),installationName:n[0].account_login}})})})]}),e.jsx("div",{className:"inline-flex flex-col items-start justify-center gap-2 self-stretch",children:e.jsx(Re,{color:"secondary",icon:Pe,onClick:()=>{window.open(f,"_blank")},children:e.jsx("div",{className:"text-token-interactive-label-secondary-default justify-start text-sm leading-tight",children:e.jsx(s,{id:"wham.codeReviewPage.permissionsBanner.updateButton",defaultMessage:"Update"})})})})]})})}const ze=["everyone","team","default"];function Qe(i){return ze.some(t=>t===i)}const Ke={everyone:{globalReviewPreference:"review_everyone",reviewPreference:"team"},team:{globalReviewPreference:"review_if_enabled",reviewPreference:"team"},default:{globalReviewPreference:"review_if_enabled",reviewPreference:"never"}},Je=e.jsx(s,{id:"wham.codeReviewPage.teamAutomations.everyoneCostTooltip.plus",defaultMessage:"Upgrade to Pro."}),Xe=e.jsx(s,{id:"wham.codeReviewPage.teamAutomations.everyoneCostTooltip.pro",defaultMessage:"Free until October 20th, after which reviews will count against your plan's limits."}),Ze=e.jsx(s,{id:"wham.codeReviewPage.teamAutomations.everyoneCostTooltip.team",defaultMessage:"Free until October 20th, after which reviews will consume credits."}),et=e.jsx(s,{id:"wham.codeReviewPage.teamAutomations.everyoneCostTooltip.legacyEnterprisey",defaultMessage:"Ask your ChatGPT admin to upgrade to flexible pricing to enable."});function tt(i){return i.global_review_preference==="review_everyone"?"everyone":i.review_preference==="team"?"team":"default"}function st(i){"use forget";const t=pe.c(19),{columnClassName:d,lastUpdatedBy:n,lastUpdatedRelativeTime:f,tooltipLabel:u}=i;let l;t[0]!==d?(l=h(d,"min-w-0"),t[0]=d,t[1]=l):l=t[1];const m=!f;let r;t[2]!==m?(r=h("min-w-0 truncate text-start",{"col-span-2":m}),t[2]=m,t[3]=r):r=t[3];let x;t[4]!==n||t[5]!==r?(x=e.jsx("span",{className:r,children:n}),t[4]=n,t[5]=r,t[6]=x):x=t[6];let w;t[7]!==f?(w=f?e.jsx("span",{className:"text-token-text-tertiary min-w-0 truncate pe-2 text-end sm:min-w-[6rem]",children:f}):null,t[7]=f,t[8]=w):w=t[8];let y;t[9]!==x||t[10]!==w?(y=e.jsxs("div",{className:"hidden w-full min-w-0 items-center justify-between text-xs sm:text-sm md:flex",children:[x,w]}),t[9]=x,t[10]=w,t[11]=y):y=t[11];let b;t[12]===Symbol.for("react.memo_cache_sentinel")?(b=e.jsx(se,{className:"icon-sm text-token-text-secondary shrink-0"}),t[12]=b):b=t[12];let p;t[13]!==u?(p=e.jsx(U,{className:"flex w-full justify-end md:hidden",label:u,labelTextAlign:"left",labelClassName:"text-xs",align:"start",children:b}),t[13]=u,t[14]=p):p=t[14];let N;return t[15]!==l||t[16]!==y||t[17]!==p?(N=e.jsxs(o.Cell,{textAlign:"left",className:l,children:[y,p]}),t[15]=l,t[16]=y,t[17]=p,t[18]=N):N=t[18],N}function at({disabledInstallations:i=[]}){const t=te(),[d,n]=C.useState(""),u=Te(d,300).trim(),l=u.length>0,m=Oe(),r=Ue(),x=Ve(),w=De(),y=Ne(),b=_e(),{data:p,isLoading:N,isFetching:ie,fetchNextPage:ne,hasNextPage:W,isFetchingNextPage:q}=ke(u),{mutate:oe}=Ge(),V=C.useMemo(()=>{var a;return((a=p==null?void 0:p.pages)!=null?a:[]).flatMap(g=>{var R;return(R=g.repo_review_settings)!=null?R:[]}).filter(g=>!!g)},[p]),D=C.useMemo(()=>[...V].sort((a,g)=>{var S,_,P,k;const R=(_=(S=a.repository)==null?void 0:S.repository_full_name)!=null?_:"",T=(k=(P=g.repository)==null?void 0:P.repository_full_name)!=null?k:"";return R.localeCompare(T,void 0,{sensitivity:"base"})}),[V]),F=C.useMemo(()=>l?D.slice(0,G):D,[D,l]),le=l&&V.length>=G,re=!l&&!N&&(!!W||!!q),de=new Date,v=["w-[50%] sm:w-[40%]","w-[30%] sm:w-[35%]","w-[20%] sm:w-[25%] lg:w-[30%]"],H=[{value:"everyone",title:t.formatMessage({id:"wham.codeReviewPage.teamAutomations.option.always.title",defaultMessage:"Review all PRs"}),individual_title:void 0,description:t.formatMessage({id:"wham.codeReviewPage.teamAutomations.option.always.description",defaultMessage:"Run auto code reviews on every pull request, even from contributors outside this workspace"}),individual_description:t.formatMessage({id:"wham.codeReviewPage.teamAutomations.option.always.individual_description",defaultMessage:"Run on every pull request, even from other contributors"})},{value:"team",title:t.formatMessage({id:"wham.codeReviewPage.teamAutomations.option.team.title",defaultMessage:"Review team PRs"}),individual_title:t.formatMessage({id:"wham.codeReviewPage.teamAutomations.option.always.individual_title",defaultMessage:"Review my PRs"}),description:t.formatMessage({id:"wham.codeReviewPage.teamAutomations.option.team.description",defaultMessage:"Only run on pull requests opened by members of this workspace"}),individual_description:t.formatMessage({id:"wham.codeReviewPage.teamAutomations.option.team.individual_description",defaultMessage:"Only run on pull requests opened by me"})},{value:"default",title:t.formatMessage({id:"wham.codeReviewPage.teamAutomations.option.individuals.title",defaultMessage:"Follow personal preferences"}),individual_title:t.formatMessage({id:"wham.codeReviewPage.teamAutomations.option.individuals.individual_title",defaultMessage:"Follow personal preferences"}),description:t.formatMessage({id:"wham.codeReviewPage.teamAutomations.option.individuals.description",defaultMessage:"Let users opt in with their personal settings"}),individual_description:t.formatMessage({id:"wham.codeReviewPage.teamAutomations.option.individuals.individual_description",defaultMessage:"Run on your own pull requests based on your personal preference"})}];return e.jsxs("section",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"hidden flex-col gap-2 sm:flex",children:[e.jsx("p",{className:"text-sm font-medium",children:e.jsx(s,{id:"wham.codeReviewPage.teamAutomations.repoPreferences",defaultMessage:"Repository preferences"})}),e.jsx("p",{className:"text-token-text-secondary text-xs",children:m?e.jsx(s,{id:"wham.codeReviewPage.teamAutomations.repoPreferences.description.team",defaultMessage:"Configure code review for all contributors to a repository."}):e.jsx(s,{id:"wham.codeReviewPage.teamAutomations.repoPreferences.description.individual",defaultMessage:"Configure code review preferences for each repository. Reviews for your own PRs are free for a limited time."})})]}),e.jsx("div",{className:"flex items-center justify-between gap-4",children:e.jsx("div",{className:"w-84",children:e.jsx(Me,{name:"team-automations-search",containerInputClassName:"w-full",className:"text-token-text-primary flex h-8 w-full items-center rounded-md!",ariaLabel:t.formatMessage({id:"wham.codeReviewPage.teamAutomations.searchRepoAria",defaultMessage:"Search repos or enter a GitHub org/repo"}),placeholder:t.formatMessage({id:"wham.codeReviewPage.teamAutomations.searchRepoPlaceholder",defaultMessage:"Search repos or enter a GitHub org/repo"}),type:"search",color:"search",value:d,onChange:a=>n(a.target.value)})})}),e.jsx("div",{children:e.jsxs(o.Root,{size:"compact",disableScroll:!0,fixed:!0,children:[e.jsxs(o.Header,{children:[e.jsx(o.HeaderCell,{textAlign:"left",className:v[0],children:e.jsx(s,{id:"wham.codeReviewPage.teamAutomations.table.repository",defaultMessage:"Repository"})}),e.jsx(o.HeaderCell,{textAlign:"left",className:h(v[1],"ps-3"),children:e.jsx(s,{id:"wham.codeReviewPage.teamAutomations.table.codeReview",defaultMessage:"Auto code review"})}),e.jsx(o.HeaderCell,{textAlign:"left",className:h(v[2],"table-cell"),children:e.jsx(s,{id:"wham.codeReviewPage.teamAutomations.table.lastUpdated",defaultMessage:"Last updated by"})})]}),e.jsxs(o.Body,{children:[N?Array.from({length:6}).map((a,g)=>e.jsxs(o.Row,{children:[e.jsx(o.Cell,{className:h(v[0],"min-w-0"),children:e.jsxs("div",{className:"flex min-w-0 items-center gap-2",children:[e.jsx(O,{className:"h-4 w-4 rounded"}),e.jsx(O,{className:"h-4 w-48"})]})}),e.jsx(o.Cell,{textAlign:"left",className:h(v[1],"min-w-0"),children:e.jsx(O,{className:h("h-6 w-40 rounded-md")})}),e.jsx(o.Cell,{textAlign:"left",className:h(v[2],"min-w-0"),children:e.jsx(O,{className:"h-4 w-32"})})]},"skeleton-".concat(g))):F.length===0&&!ie?e.jsx(o.Row,{children:e.jsx(o.Cell,{colSpan:3,className:"text-token-text-tertiary",textAlign:"left",children:e.jsx(s,{id:"wham.codeReviewPage.teamAutomations.noRepositories",defaultMessage:"No repositories"})})}):F.map(a=>{var Q,K,J,X,Z;const g=(Q=a.repository.owner)==null?void 0:Q.login,R=g?i.includes(g):!1,T=((K=a.repository.permissions)==null?void 0:K.admin)||((J=a.repository.permissions)==null?void 0:J.push),S=tt(a),_=S==="everyone",P=_&&!T,k=_&&a.global_review_account_id!==We(y),j=H.find(c=>c.value===S),I=[];k&&(m?I.push(e.jsx(s,{id:"wham.codeReviewPage.teamAutomations.everyoneWarningTooltip.differentUser.team",defaultMessage:"This setting was set by a user in a different team."})):I.push(e.jsx(s,{id:"wham.codeReviewPage.teamAutomations.everyoneWarningTooltip.differentUser.individual",defaultMessage:"This setting was set by a different user."}))),P?I.push(e.jsx(s,{id:"wham.codeReviewPage.teamAutomations.everyoneWarningTooltip.noPermissions",defaultMessage:"You must have repo admin or push permissions to change this setting."})):I.push(e.jsx(s,{id:"wham.codeReviewPage.teamAutomations.everyoneWarningTooltip.changeWarning",defaultMessage:"Changing this setting affects auto code reviews for other contributors to this repository."}));const Y=e.jsx(e.Fragment,{children:I.map((c,M)=>e.jsxs("span",{children:[c," "]},M))}),$=e.jsxs(A.Root,{value:S,onValueChange:c=>{if(!Qe(c))return;const M=Ke[c];oe({repo_review_settings:[{repository:a.repository.id,review_preference:M.reviewPreference,global_review_preference:M.globalReviewPreference}]})},disabled:R||P,children:[e.jsxs(A.Trigger,{className:"w-full max-w-[250px] min-w-[150px] justify-between",children:[e.jsx(U,{label:Y,withArrow:!0,side:"top",sideOffset:0,disabled:!(_&&P)||R,children:e.jsx("div",{className:"flex items-center gap-2 truncate text-sm font-normal",children:m?j==null?void 0:j.title:(X=j==null?void 0:j.individual_title)!=null?X:j==null?void 0:j.title})}),P?null:e.jsx(A.Icon,{})]}),e.jsx(A.Portal,{children:e.jsxs(A.Content,{className:"max-w-[340px] min-w-[220px]","data-unbound-width":"",children:[_&&!P&&e.jsx(A.Item,{value:"unselectable",className:"items-start",disabled:!0,children:e.jsx("div",{className:"flex min-w-[220px] flex-col gap-1",children:e.jsx("span",{className:"text-token-text-tertiary text-xs whitespace-normal",children:Y})})},"unselectable"),H.map(c=>{var M,ee;return e.jsx(A.Item,{value:c.value,className:"items-start",disabled:c.value==="everyone"&&(!T||w||r),children:e.jsx(U,{label:T?e.jsxs(e.Fragment,{children:[m&&!w&&Ze,r&&Je,x&&Xe,m&&w&&et]}):e.jsx(s,{id:"wham.codeReviewPage.teamAutomations.everyoneDisabledTooltip",defaultMessage:"You must have repo admin or push permissions to select this option"}),disabled:c.value!=="everyone",withArrow:!0,side:"top",sideOffset:0,children:e.jsxs("div",{className:"flex min-w-[220px] flex-col gap-1",children:[e.jsx("span",{className:"text-sm font-normal",children:m?c.title:(M=c.individual_title)!=null?M:c.title}),e.jsx("span",{className:"text-token-text-tertiary text-xs whitespace-normal",children:m?c.description:(ee=c.individual_description)!=null?ee:c.description})]})})},c.value)})]})})]}),ce=R?e.jsx(U,{label:e.jsx(s,{id:"wham.codeReviewPage.teamAutomations.repoDisabledTooltip",defaultMessage:"Update the {installation} GitHub installation to enable code review",values:{installation:g}}),children:$}):$,E=a.updated_at?new Date(a.updated_at):null,z=!!(E&&!Number.isNaN(E.getTime())),me=z&&E?e.jsx(ge,{value:E,year:"numeric",month:"short",day:"2-digit"}):null,L=z&&E?Ae({givenDate:E,now:de,intl:t,format:"descriptive"}):null,ue=(Z=L!=null?L:me)!=null?Z:e.jsx(s,{id:"wham.codeReviewPage.teamAutomations.lastUpdatedUnknown",defaultMessage:"Not recorded"});let B=null;k?B=e.jsx(xe,{className:"font-medium",target:"_blank",to:"https://github.com/".concat(a.last_updated_by_github_id),children:a.last_updated_by_github_id}):a.last_updated_user_email===(b==null?void 0:b.email)?B=e.jsx(s,{id:"wham.codeReviewPage.teamAutomations.lastUpdatedByUser",defaultMessage:"me"}):m&&(B=a.last_updated_user_email);const fe=e.jsx(s,{id:"wham.codeReviewPage.teamAutomations.lastUpdatedBy",defaultMessage:"{date} by {user}",values:{date:ue,user:B}});return e.jsxs(o.Row,{children:[e.jsx(o.Cell,{className:h(v[0],"min-w-[150px]"),children:e.jsxs("div",{className:"flex min-w-0 items-center gap-2",children:[e.jsx(Be,{className:"icon-md shrink-0"}),e.jsx("p",{className:"truncate text-sm",children:a.repository.repository_full_name})]})}),e.jsx(o.Cell,{textAlign:"left",className:h(v[1],"min-w-0"),children:e.jsx("div",{className:"flex w-full max-w-[250px] items-center justify-end sm:justify-start",children:ce})}),e.jsx(st,{columnClassName:v[2],lastUpdatedBy:B,lastUpdatedRelativeTime:L,tooltipLabel:fe})]},a.repository.id)}),le&&e.jsx(o.Row,{children:e.jsx(o.Cell,{colSpan:4,className:"!border-b-0!",textAlign:"left",children:e.jsx("p",{className:"text-token-text-secondary text-xs",children:e.jsx(s,{id:"wham.codeReviewPage.teamAutomations.maxSuggestionsNote",defaultMessage:"Displaying maximum {count} suggestions",values:{count:G}})})})}),re&&e.jsx(o.Row,{children:e.jsx(o.Cell,{colSpan:3,className:"!border-b-0!",textAlign:"left",children:e.jsx(Le,{isFetchingNextPage:!!q,hasNextPage:!!W,fetchNextPage:()=>ne(),bgColor:"bg-transparent"})})})]})]})})]})}function it(){const{data:i,isLoading:t,isError:d}=Ie(),{mutate:n,isPending:f}=qe({showToast:!1}),u=t||d||!i,{data:l}=ae(),m=C.useMemo(()=>{var r;return(r=l==null?void 0:l.installations_without_events)!=null?r:[]},[l]);return e.jsx(Se,{topPadding:!0,children:e.jsxs("div",{className:"mx-auto flex h-full max-w-screen-xl flex-1 flex-col gap-2 ps-4 pe-12",children:[e.jsx("div",{className:h("border-token-border-heavy flex items-center justify-between border-b"),children:e.jsx("p",{className:"flex items-center gap-2 py-2 align-middle text-xl leading-7 font-medium",children:e.jsx(s,{id:"wham.codeReviewPage.header",defaultMessage:"Code review"})})}),e.jsx("p",{className:"text-token-text-secondary w-max text-sm",children:e.jsx(s,{id:"wham.codeReviewPage.infoBannerV2.subtitle",defaultMessage:"Set up Codex to automatically review pull requests"})}),e.jsx($e,{}),e.jsx(He,{}),u?e.jsx("div",{className:"flex items-center justify-center pt-2",children:e.jsx(Ce,{className:"icon me-1.5"})}):e.jsxs("div",{className:"flex flex-col gap-4 pt-2 pb-4",children:[e.jsx(Fe,{isSaving:f,initialScope:i.code_review_preference,onChange:r=>{n({codeReviewPreference:r})}}),e.jsx("div",{className:"bg-token-border-default h-px"}),e.jsx(at,{disabledInstallations:m.map(r=>r.account_login)})]})]})})}const _t=()=>[{title:"Codex"}],Mt=he(function(){return e.jsx(it,{})});export{Mt as default,_t as meta};
//# sourceMappingURL=jlklbs6u12s6bf55.js.map
