var X=Object.defineProperty,Z=Object.defineProperties;var $=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var ee=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var _=(t,e,a)=>e in t?X(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,b=(t,e)=>{for(var a in e||(e={}))ee.call(e,a)&&_(t,a,e[a]);if(D)for(var a of D(e))te.call(e,a)&&_(t,a,e[a]);return t},P=(t,e)=>Z(t,$(e));import{b as ae,r as k,j as se,e as s}from"./n75kuy1cx6f5mogg.js";import{ba as ne,i as oe,r as le,nS as ie,nu as de,i8 as ce,mR as re,ph as ge,bU as ue,bJ as he,bq as U,aT as O,P as A,an as fe,R as be,A as me,cA as B,ia as d,aY as pe,aR as ye,br as ke}from"./ewse8exzafeu10ji.js";import{au as Me,dx as Se,dy as we,aS as Te,cO as Ce,dz as Fe}from"./ny10lj7zpuz89fvf.js";const z=(...t)=>e=>t.some(a=>a(e)),L=({allGroupedMessages:t})=>t.some(e=>e.type===d.Browsing||e.type===d.RetrievalBrowsing||e.type===d.ParallelBrowsing),N=({allGroupedMessages:t})=>t.some(e=>e.type===d.SearchGPTQuery),ve=({allGroupedMessages:t})=>t.some(e=>e.type===d.Text&&e.messages.some(a=>{var o,r;return(r=(o=a.metadata)==null?void 0:o.content_references)==null?void 0:r.some(h=>h.type==="products"||h.type==="product_entity")})),xe=({allGroupedMessages:t})=>t.some(e=>{var a,o,r;return e.type===d.Text&&((r=(o=(a=e.messages[0])==null?void 0:a.metadata)==null?void 0:o.followup_prompts)==null?void 0:r.length)}),G=({allGroupedMessages:t})=>t.some(e=>e.type===d.CodeInterpreter),Ee=({allGroupedMessages:t})=>t.some(e=>e.type===d.JITPlugin);function Ie(t){return!t||!t.instructions?"":typeof t.instructions=="string"?t.instructions:t.instructions.filter(e=>typeof e=="string").join("")}const W={"Didn't fully follow instructions":{tag:"Didn't fully follow instructions",label:s({id:"Rdlt9V",defaultMessage:"Didn't fully follow instructions"})}},Re=[{match:ve,tag:"Shouldn't have shown products",label:s({id:"HMKFPm",defaultMessage:"Shouldn't have shown products"}),forceRefreshExcluding:"commerce"},{match:z(L,N),tag:"Shouldn't have searched the web",label:s({id:"kL047b",defaultMessage:"Shouldn't have searched the web"})},{match:xe,tag:"Don't like the followups",label:s({id:"xAFgPE",defaultMessage:"Don’t like the suggested follow ups"})},{match:z(L,N),tag:"Don't like the source it cited",label:s({id:"OWjzGX",defaultMessage:"Don't like the sources it cited"})},{match:G,tag:"Shouldn't have run code",label:s({id:"53w4ay",defaultMessage:"Shouldn't have run code"})},{match:G,tag:"Couldn't handle my file",label:s({id:"EkFTQ5",defaultMessage:"Couldn't handle my file"})},{match:({allGroupedMessages:t})=>t.some(e=>e.type===d.Dalle),tag:"Shouldn't have created an image",label:s({id:"S8FRsr",defaultMessage:"Shouldn't have created an image"})},{match:Ee,tag:"Tool call didn't work",label:s({id:"JvNV9L",defaultMessage:"Tool call didn't work"})},{match:({allGroupedMessages:t})=>t.some(e=>{if(e.type!==d.Text)return!1;const a=e.messages[0],{content:o}=a;return o.content_type===U.Text&&pe(a).match(/^```[\S]+\n/gm)}),tag:"Code was incorrect",label:s({id:"4EBdQk",defaultMessage:"Code was incorrect"})},{match:({systemContent:t})=>{var e;return(e=Ie(t).includes("Personality"))!=null?e:!1},tag:"Too chatty or casual",label:s({id:"ATzJKW",defaultMessage:"Too chatty or casual"})},{match:({isBusinessWorkspace:t})=>t,tag:"File upload not working as expected",label:s({id:"Pv0EgM",defaultMessage:"File upload not working as expected"})},{match:({isBusinessWorkspace:t,hasCaConnection:e})=>t&&e,tag:"Should have triggered Internal knowledge",label:s({id:"DJc0pt",defaultMessage:"Should have triggered Internal knowledge"})},{match:({features:t})=>t.includes(Ce.Sunshine),tag:"Shouldn't have used Memory",label:s({id:"yfUEiz",defaultMessage:"Shouldn't have used Memory"})},{tag:"Don’t like the personality",label:s({id:"6Yz27f",defaultMessage:"Don’t like the personality"})},{tag:"Don't like the style",label:s({id:"nGxjdj",defaultMessage:"Don't like the style"})},{tag:"Not factually correct",label:s({id:"Ke7JtQ",defaultMessage:"Not factually correct"})},P(b({},W["Didn't fully follow instructions"]),{match:({isBusinessWorkspace:t})=>!t}),{tag:"Refused when it shouldn't have",label:s({id:"2yRS/Q",defaultMessage:"Refused when it shouldn't have"})},{match:({isBusinessWorkspace:t})=>!t,tag:"Being lazy",label:s({id:"14MPmT",defaultMessage:"Being lazy"})},{tag:"Unsafe or problematic",label:s({id:"02pXBl",defaultMessage:"Unsafe or problematic"})},{tag:"Biased",label:s({id:"pK35DW",defaultMessage:"Biased"})},{tag:"Other",label:s({id:"WiIGE+",defaultMessage:"Other"})}],De=[{tag:"I disagree with the policy",label:s({id:"oKyDLz",defaultMessage:"I disagree with the policy"})},{tag:"This didn't violate the policy",label:s({id:"7fUkVF",defaultMessage:"This didn't violate the policy"})},{tag:"I don't understand the policy",label:s({id:"4Cdp6N",defaultMessage:"I don't understand the policy"})},{tag:"This didn't take the full context",label:s({id:"vnZJDP",defaultMessage:"This didn't take the full context"})}],_e=[{tag:"Shouldn't have triggered Internal knowledge",label:s({id:"ILVpD8",defaultMessage:"Shouldn't have triggered Internal knowledge"})},{tag:"I specified what data to use and it was wrong",label:s({id:"ziFYwZ",defaultMessage:"I specified what data to use and it was wrong"})},{tag:"Missing relevant Internal knowledge",label:s({id:"PobbBn",defaultMessage:"Missing relevant Internal knowledge"})},{tag:"Inaccurate information",label:s({id:"HbcEAV",defaultMessage:"Inaccurate information"})},{tag:"Response not relevant or helpful",label:s({id:"k2/tlU",defaultMessage:"Response not relevant or helpful"})},b({},W["Didn't fully follow instructions"]),{tag:"I don't like the model tone",label:s({id:"PT9XqK",defaultMessage:"I don't like the model tone"})}];function Pe(t,e,a){return e.filter(o=>!o.match||o.match(a)).map(o=>({value:o.tag,label:t.formatMessage(o.label),forceRefreshExcluding:o.forceRefreshExcluding}))}function Oe(t){const e=Te(t);return e!=null&&(e.errCode===B.ContentPolicy||e.errCode===B.ContentOrTos)}function Ne({clientThreadId:t,conversationMessage:e,currentModelId:a,allGroupedMessages:o}){var T,C,F,v;const r=ae(),h=(T=ne())!=null?T:[],i=(C=e.clientMetadata)==null?void 0:C.rating,j=oe(),m=le(j),f=(F=m==null?void 0:m.isWorkspacePlan())!=null?F:!1,M=ie(),S=de(),p=k.useMemo(()=>S&&o.some(n=>{var l;return n.type!==ce&&((l=n.messages)==null?void 0:l.some(re))}),[o,S]),{hasConnections:J,isLoading:K}=ge(),y=(v=J&&!K)!=null?v:!1,Q=Me({clientThreadId:t}),w=k.useRef(ue(n=>{Q(n)},500)).current,g=he(t,n=>ye.findNode(n,l=>l.message.author.role===ke.System&&l.message.content.content_type==="system_content")),q=(g==null?void 0:g.message.content.content_type)===U.SystemContent?g==null?void 0:g.message.content:null,V=k.useCallback(n=>{var E,I,R;const l=O(t);if(!l||n.tags.length===0&&!n.textFeedback)return;const c=n.tags.map(u=>u.value);A.logEvent(n.source==="inline"?"Message Feedback Inline Submitted":"Message Feedback Dialog Submitted",{id:e.id,threadId:l,tags:c,content:n.textFeedback,model:a,rating:i}),fe.logEvent(n.source==="inline"?"chatgpt_feedback_inline_submitted":"chatgpt_feedback_dialog_submitted",(E=c==null?void 0:c[0])!=null?E:null,b({id:e.id,threadId:l,tag:(I=c==null?void 0:c[0])!=null?I:"",content:(R=n.textFeedback)!=null?R:"",model:a!=null?a:"",rating:i!=null?i:""},y?{isCaTriggered:String(p)}:{})),i&&(f&&M?Se({rating:Fe(i),text:n.textFeedback,tags:c,tag_choices:n.tagChoices},l,e.id):f||be.safePost("/conversation/message_feedback",{requestBody:{message_id:e.id,conversation_id:l,rating:i,text:n.textFeedback,tags:c,tag_choices:n.tagChoices},authOption:me.SendIfAvailable}));const x=n.tags.map(u=>u.forceRefreshExcluding).filter(u=>!!u);x.length>0&&w({sourceEvent:n.event,nodeId:e.id,extraStreamParams:{forceDisableFeatures:x}})},[t,e.id,a,w,y,f,p,M,i]),Y=()=>{A.logEvent("Message Feedback More Options Clicked",{id:e.id,threadId:O(t),model:a,rating:i})},H=Pe(r,Oe(e)?De:p?_e:Re,{allGroupedMessages:o,features:h,currentModelId:a!=null?a:"",systemContent:q,isBusinessWorkspace:f,hasCaConnection:y});return i==="thumbsUp"?null:se.jsx(we,{tagOptions:H,onSubmit:V,onMoreClicked:Y})}export{Ne as default};
//# sourceMappingURL=kstbr9y1sfpz8kec.js.map
