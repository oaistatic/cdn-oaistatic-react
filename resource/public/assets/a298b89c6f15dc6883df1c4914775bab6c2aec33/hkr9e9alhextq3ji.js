var Pe=Object.defineProperty,ke=Object.defineProperties;var we=Object.getOwnPropertyDescriptors;var ne=Object.getOwnPropertySymbols;var Ae=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable;var ie=(s,a,t)=>a in s?Pe(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t,k=(s,a)=>{for(var t in a||(a={}))Ae.call(a,t)&&ie(s,t,a[t]);if(ne)for(var t of ne(a))ye.call(a,t)&&ie(s,t,a[t]);return s},F=(s,a)=>ke(s,we(a));import{b as D,r as g,j as e,d as W,M as T,g as ge,t as Fe,i as Ee,D as Te,ae as Le}from"./n75kuy1cx6f5mogg.js";import{a as De,b as Oe,c as _e,u as Ge}from"./6tgqoqudeah698zo.js";import{e as Be,M as re}from"./mf5xo39q7qs5a56k.js";import{u as pe,a as Ie,b as fe,c as We,d as Ue,e as He,f as Qe,g as ze,h as Ve}from"./drhq0hehfy1vqd5j.js";import{C as he,fA as Ze,qO as X,e as xe,E as J,B as L,f as je,ex as v,fC as $e,dv as Xe,io as Je,i as qe,j as V,m as Ye,ri as Ke,rj as es,pO as E,rk as $,rl as ss,s as ts,T as as,n as os,aF as le}from"./ewse8exzafeu10ji.js";import{lg as ns,ck as is,bv as Ce,ne as rs,nf as ls,ng as de,c0 as ds,js as cs,jk as ms}from"./ny10lj7zpuz89fvf.js";import{S as Me}from"./hjvye6kznkyvb97d.js";import{T as l}from"./e0z6030ycsi62lhu.js";import{G as be}from"./ox99k03vnvnrihmv.js";import{u as us,E as gs,C as ps,R as fs,P as hs,i as ce,U as xs}from"./ij1dm26l1s3erqz6.js";import{W as js}from"./ld5ldp4x9kp7pahk.js";import{T as Cs,a as Ms}from"./jfylj2lx3vqh7vyo.js";import{d as me}from"./l1ka89a9nbqv3utj.js";import"./3mp3j06lb1q5ttzm.js";import"./gy07ow2dyy5du4ny.js";import"./h2dwuj1m5ps9l7uv.js";import"./j2ui4c2m3nj8pqst.js";import"./lksc5q29mjlblqoo.js";import"./da0anzdj3bll2tbv.js";import"./mzj5jqjjpo006z7a.js";import"./nnb0v70g00lhjclz.js";import"./fh2tsu8ocsi22jc3.js";import"./jaupzjmp9wknd4io.js";import"./jtxj1xvdu5i7mvdh.js";import"./d65yyyom1modmtdi.js";import"./kj8rd4pu8k32z2dy.js";import"./em5q5yhbyv41ft0j.js";import"./n81diue0m3az0e3g.js";import"./ca7esdp3innmhgb2.js";import"./eblhjx87s4n4864h.js";import"./ga8p3rr9o0mc72h0.js";import"./cj802l28id0sdlgx.js";const bs=({onClose:s,workspaceId:a,roleId:t})=>{const n=D(),[m,i]=g.useState(""),[h,u]=g.useState(0),{groups:d,isLoading:M,isPlaceholderData:r}=Be({workspaceId:a,currPage:h,groupFilter:m}),{data:C}=pe({workspaceId:a,roleId:t}),{assignGroup:x}=Ie({workspaceId:a,roleId:t}),{unassignGroup:S}=fe({workspaceId:a,roleId:t});return e.jsxs(he,{testId:"modal-role-assignment-modal",isOpen:!0,onClose:s,showCloseButton:!0,size:"large",type:"success",title:n.formatMessage(j.title),primaryButton:e.jsx(L,{onClick:()=>s(),children:n.formatMessage(j.done)}),secondaryButton:e.jsx(L,{color:"secondary",onClick:()=>s(),children:n.formatMessage(j.cancel)}),children:[e.jsxs("div",{className:"bg-token-bg-tertiary text-token-text-primary flex w-full flex-row items-center gap-4 rounded-xl p-4",children:[e.jsx(Ze,{className:"icon-lg"}),e.jsx("div",{className:"text-token-text-secondary text-sm font-medium",children:n.formatMessage(j.information)})]}),e.jsx(X,{className:"mt-6 mb-6",inputClassName:"w-full",placeholder:n.formatMessage(j.searchPlaceholder),value:m,onChange:p=>i(p.target.value)}),e.jsxs("div",{className:"min-h-[18rem]",children:[e.jsxs(l.Root,{className:"min-w-full",children:[e.jsxs("colgroup",{children:[e.jsx("col",{className:"w-[80%]"}),e.jsx("col",{className:"w-[20%]"})]}),e.jsx(l.Body,{className:xe((M||r)&&"opacity-50"),children:d==null?e.jsx(l.Row,{children:e.jsx(l.Cell,{colSpan:5,textAlign:"center",children:e.jsx(J,{})})}):d.items.length===0?e.jsx(l.Row,{children:e.jsx(l.Cell,{colSpan:5,textAlign:"center",children:m===""?n.formatMessage(j.noGroupFound):n.formatMessage(j.noGroupFoundWithFilter)})}):d.items.filter(({system_use_case:p})=>!p).map(p=>e.jsx(vs,{group:p,assignedGroups:C||[],onAssign:()=>x(p),onUnassign:()=>S(p.id)},p.id))})]}),d&&e.jsx("div",{className:"text-center",children:e.jsx(ns,{length:Math.ceil(d.total/re),currentPage:Math.min(h,Math.ceil(d.total/re)),onChangeIndex:p=>u(p)})})]})]})},vs=({group:s,assignedGroups:a,onAssign:t,onUnassign:n})=>{const[m,i]=g.useState(!1),h=je(),u=D(),d=async()=>{i(!0);try{await t(),h.success(u.formatMessage(j.addSuccess),{duration:2})}catch(r){h.danger(j.addFailure,{duration:2,toastId:"role_assignment_modal"})}finally{i(!1)}},M=async()=>{i(!0);try{await n(),h.success(u.formatMessage(j.removedSuccess),{duration:2})}catch(r){h.danger(j.removeFailure,{duration:2,toastId:"role_assignment_modal"})}finally{i(!1)}};return e.jsxs(l.Row,{className:"[&>td]:py-2",children:[e.jsxs(l.Cell,{children:[e.jsx(be,{group:s}),e.jsxs("div",{children:[e.jsx("div",{children:s.name}),e.jsx("div",{className:"text-token-text-secondary text-xs",children:e.jsx(T,{id:"15cHOa",defaultMessage:"{count} members",values:{count:s.num_members}})})]})]}),e.jsx(l.Cell,{className:"flex items-center justify-end",children:a.some(r=>r.id===s.id)?e.jsx(L,{color:"primary",icon:is,onClick:M,loading:m,children:u.formatMessage(j.added)}):e.jsx(L,{color:"secondary",icon:Me,onClick:d,loading:m,children:u.formatMessage(j.add)})})]})},j=W({add:{id:"yso/RZ",defaultMessage:"Add"},added:{id:"O2kZcD",defaultMessage:"Added"},addSuccess:{id:"lQy6C+",defaultMessage:"Role has been successfully assigned to group."},removedSuccess:{id:"lINrRq",defaultMessage:"Role has been successfully removed from group."},addFailure:{id:"VoUYt8",defaultMessage:"Failed to assign role to group."},removeFailure:{id:"Q+GN8A",defaultMessage:"Failed to remove role from group."},noGroupFound:{id:"dE7Tu5",defaultMessage:"No groups found."},noGroupFoundWithFilter:{id:"OA7F5f",defaultMessage:"No groups found. Try changing the search query."},searchPlaceholder:{id:"sUDB3M",defaultMessage:"Search by name"},title:{id:"Rj8nZG",defaultMessage:"Assign groups to role"},information:{id:"J92l5s",defaultMessage:"Custom role permissions will override default permissions."},cancel:{id:"QykMkt",defaultMessage:"Cancel"},done:{id:"Zsm046",defaultMessage:"Done"}}),Rs=({workspaceId:s,roleId:a})=>{const t=D(),[n,m]=g.useState(""),{data:i,isLoading:h,isPlaceholderData:u}=pe({workspaceId:s,roleId:a}),d=i==null?void 0:i.filter(x=>x.name.toLowerCase().includes(n.toLowerCase())),[M,r]=g.useState(!1),{unassignGroup:C}=fe({workspaceId:s,roleId:a});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-6 mb-3 flex flex-row justify-between gap-2",children:[e.jsx(X,{inputClassName:"w-[250px] rounded-full! text-sm",value:n,onChange:x=>{m(x.target.value)},placeholder:t.formatMessage({id:"workspaceSettings.groups.search",defaultMessage:"Search group name"})}),e.jsx(L,{onClick:()=>r(!0),icon:Me,children:t.formatMessage(Z.add)})]}),e.jsx("div",{children:e.jsxs(l.Root,{className:"min-w-full",children:[e.jsxs("colgroup",{children:[e.jsx("col",{className:"w-[80%]"}),e.jsx("col",{className:"w-[20%]"})]}),e.jsxs(l.Header,{children:[e.jsx(l.HeaderCell,{children:t.formatMessage(Z.name)}),e.jsx(l.HeaderCell,{children:t.formatMessage(Z.dateAdded)})]}),e.jsx(l.Body,{className:xe((h||u)&&"opacity-50"),children:d==null?e.jsx(l.Row,{children:e.jsx(l.Cell,{colSpan:5,textAlign:"center",children:e.jsx(J,{})})}):d.length===0?e.jsx(l.Row,{children:e.jsx(l.Cell,{colSpan:5,textAlign:"center",children:n===""?e.jsx(T,{id:"workspaceSettings.groups.noGroups",defaultMessage:"No groups found."}):e.jsx(T,{id:"workspaceSettings.groups.noGroupsWithFIlter",defaultMessage:"No groups found. Try changing the search query."})})}):d.map(x=>e.jsx(Ns,{group:x,onRemoveAssignment:S=>C(S)},x.id))})]})}),M&&e.jsx(bs,{onClose:()=>r(!1),workspaceId:s,roleId:a})]})},Ns=({group:s,onRemoveAssignment:a})=>{const t=ge();return e.jsx(e.Fragment,{children:e.jsxs(l.Row,{className:"[&>td]:py-2",onClick:()=>t("/admin/groups/".concat(s.id)),children:[e.jsxs(l.Cell,{children:[e.jsx(be,{group:s}),e.jsxs("div",{children:[e.jsx("div",{children:s.name}),e.jsx("div",{className:"text-token-text-secondary text-xs",children:e.jsx(T,{id:"15cHOa",defaultMessage:"{count} members",values:{count:s.num_members}})})]})]}),e.jsx(l.Cell,{children:s.created_time&&e.jsx(Fe,{value:s.created_time,year:"numeric",month:"short",day:"numeric"})}),e.jsx(l.Cell,{className:"text-end",children:e.jsxs(v.Root,{children:[e.jsx(v.Trigger,{className:"-my-2",children:e.jsx($e,{className:"icon-sm"})}),e.jsx(v.Portal,{children:e.jsx(v.Content,{size:"small",children:e.jsx(v.Item,{onClick:()=>{a(s.id)},icon:e.jsx(Ce,{className:"text-token-text-status-error"}),className:"text-token-text-status-error",children:e.jsx(T,k({},Z.removeLabel))})})})]})})]})})},Z=W({add:{id:"floy3N",defaultMessage:"Add"},name:{id:"IP/+l1",defaultMessage:"Name"},dateAdded:{id:"6BJG0j",defaultMessage:"Date Added"},removeLabel:{id:"uut7wd",defaultMessage:"Remove group from role"}}),Ss="https://help.openai.com/en/articles/11750701-rbac",Ps=({role:s,onSave:a})=>{var Y,K,ee,se,te,ae,oe;const t=D(),n=Xe(),m=(Y=n==null?void 0:n.getWorkspaceId())!=null?Y:"",i=Je(),h=us(),u=qe(),d=V(u,"2913573978"),M=V(u,"820985683"),{data:r}=Ye((()=>{if(n==null)throw new Error("Account must not be null");const o=n.getWorkspaceId();if(o==null)throw new Error("Workspace ID must not be null");return o})()),C=Ke(),{permissionsBySection:x,totalPermissionsCount:S}=g.useMemo(()=>{var I,z;const o=V(u,"2968710568"),c=V(u,"1231102790"),N=es(F(k({isCanvasEnabled:!0,isSearchEnabled:s.permissions.includes(E.SearchAccess),isEnterprisey:(I=n==null?void 0:n.isEnterprisey())!=null?I:!1},h),{isQuorum:i,legacyModelsEnabled:(z=r==null?void 0:r.beta_settings.legacy_models)!=null?z:!1,includeConnectorPermissions:C,isCodexEnabledInRBACRole:s.permissions.includes(E.AllowCodexAccess),showProjectSharing:M,isRoleSpecificPage:!0,showDeviceCodeAuthToggle:o,gpt5ThinkingEnabled:s.permissions.includes(E.GPT5ThinkingAccess),isClinicianModeRolledOut:c})).map(y=>F(k({},y),{entries:y.entries.filter(Se=>Se.rbac)})).filter(y=>y.entries.length>0),A=N.flatMap(y=>y.entries).length;return{permissionsBySection:N,totalPermissionsCount:A}},[n,h,s.permissions,r==null?void 0:r.beta_settings,C,i,M,u]),[p,O]=g.useState(""),_=x.map(o=>F(k({},o),{entries:o.entries.filter(c=>{const R=typeof c.title=="string"?c.title:t.formatMessage(c.title),N=c.description?typeof c.description=="string"?c.description:t.formatMessage(c.description,c.descriptionValues):"";return c.rbac&&([R,N].join(" ").toLowerCase().includes(p.toLowerCase())||c.permissionName.toLowerCase().includes(p.toLowerCase()))})})).filter(o=>o.entries.length>0),{toggleAllConnectorsPermissionForRole:G,isPending:B}=We({workspaceId:(K=n==null?void 0:n.getWorkspaceId())!=null?K:""}),{connectorsWithPermission:U,isLoading:H}=Ue({accountId:(ee=n==null?void 0:n.id)!=null?ee:"",workspaceId:(se=n==null?void 0:n.getWorkspaceId())!=null?se:"",roleId:s.id,enabled:C}),P=Array.from((te=U.values())!=null?te:[]).filter(o=>o.connector.status!=="DISABLED_BY_ADMIN"),Q=g.useMemo(()=>[$.CONTEXT_CONNECTOR_GDRIVE,$.CONTEXT_CONNECTOR_O365_PERSONAL,$.CONTEXT_CONNECTOR_O365_BUSINESS].filter(o=>!!(r!=null&&r.beta_settings[o])),[r==null?void 0:r.beta_settings]),f=He({workspaceId:(ae=n==null?void 0:n.getWorkspaceId())!=null?ae:"",roleId:s.id,connectorIds:Q,enabled:C}),w=g.useMemo(()=>{var N,A;const c=Array.from((N=P.values())!=null?N:[]).filter(I=>I.permissions.includes(E.UseConnector)),R=Object.entries((A=f.results)!=null?A:{}).filter(([I,z])=>z.includes(E.UseConnector));return[...c,...R]},[P,f.results]),[ve,q]=g.useState(!1),Re=ss(i,d&&!M),Ne=o=>{const c=o.permissionName,R=typeof o.title=="string"?o.title:t.formatMessage(o.title);if(o.permissionName===E.UseConnector){const N=w.length>0;return e.jsxs(e.Fragment,{children:[ve&&e.jsx(fs,{platformConnectorsWithPermission:U,contextConnectorsWithPermission:f.results,workspaceId:m,roleId:s.id,onClose:()=>q(!1)}),e.jsx(de,{children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-md",children:R}),o.description&&e.jsx("span",{className:"text-token-text-tertiary text-sm",children:typeof o.description=="string"?o.description:t.formatMessage(o.description,o.descriptionValues)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[(H||B)&&e.jsx(J,{}),o.nestedKey&&(Q.length>0||P.length>0)&&e.jsx("div",{className:"text-token-text-tertiary text-sm",children:e.jsx(L,{color:"primary-inverse",onClick:()=>q(!0),children:e.jsx(T,{id:"workspaceSettings.roles.selectNestedPermission",defaultMessage:"Select..."})})}),e.jsx(as,{disabled:P.length!==0,label:t.formatMessage(ue.noConnectorsEnabled),children:e.jsx(os,{size:"normal","aria-label":R,checked:N,onCheckedChange:A=>G({id:s.id,state:A}),disabled:B||H||P.length===0})})]})]})},c)]})}return e.jsx(de,{children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-md",children:R}),o.description&&e.jsx("span",{className:"text-token-text-tertiary text-sm",children:typeof o.description=="string"?o.description:t.formatMessage(o.description,o.descriptionValues)})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(hs,{ariaLabel:R,role:s,permissionName:o.permissionName,handleSaveRole:a,disabled:o.disabled,disabledReason:o.disabledReason,additionalPermissionNames:o.additionalPermissionNames})})]})},c)};return e.jsxs(rs,{children:[e.jsx("div",{className:"text-token-text-secondary text-sm",children:t.formatMessage(ue.customRoleDescription,{link:o=>e.jsx(ts,{className:"underline",target:"_blank",rel:"noreferrer",href:Ss,children:o})})}),e.jsx("div",{className:"flex flex-row items-center justify-between",children:e.jsx(X,{inputClassName:"w-[250px] rounded-full! text-sm",value:p,onChange:o=>{O(o.target.value)},placeholder:t.formatMessage({id:"hRuTvi",defaultMessage:"Search {count} permissions"},{count:S})})}),r&&e.jsx(gs,{preReleases:Re,workspaceId:(oe=n==null?void 0:n.getWorkspaceId())!=null?oe:"",data:r,handleSaveRole:a,role:s,isCustomRole:!1}),m&&e.jsx(ps,{workspaceId:m,roleId:s.id}),_.map(o=>e.jsx(js,{title:o.title,description:o.description,descriptionValues:o.descriptionValues,shouldDisableForQuorum:!o.availableForQuorum,children:e.jsx(ls,{children:o.entries.map(c=>Ne(c))})},String(o.title.defaultMessage)))]})},ue=W({customRoleDescription:{id:"I9hJih",defaultMessage:"Custom role permissions override workplace-level settings. A userâ€™s effective permissions are the sum of all their assigned custom roles. Not all settings are available as role-based permissions. <link>Learn more</link>"},save:{id:"LE9GJk",defaultMessage:"Save"},searchPlaceholder:{id:"EaN6oB",defaultMessage:"Search permissions"},noConnectorsEnabled:{id:"MfYm5J",defaultMessage:"No connectors enabled for the workspace"}}),ks=W({permissionPageTitle:{id:"1Qw6mG",defaultMessage:"Roles & permissions"}}),ws=s=>s==="permissions"||s==="assignments";function As({currentWorkspaceId:s,roleId:a}){const t=D(),[n,m]=g.useState(!1),{data:i,refetch:h}=Qe({roleId:a!=null?a:"",workspaceId:s}),u=je(),d=ge(),[M]=Ee(),[r,C]=g.useState(!1),{deleteRole:x}=ze({workspaceId:s}),S=g.useCallback(async()=>{try{await x(a!=null?a:""),C(!1),u.success(t.formatMessage(b.removeSuccessMessage)),d("/admin/settings?tab=roles",{replace:!0})}catch(f){u.danger(t.formatMessage(b.removeErrorMessage))}},[x,t,a,u,d]),{updateRole:p}=Ve({workspaceId:s}),O=g.useCallback(async f=>{const w=await p(f);w.id!==a&&d({pathname:"/admin/permissions/roles/".concat(w.id)},{replace:!0}),h()},[d,h,a,p]),_=g.useMemo(()=>{const f=[{key:"permissions",label:t.formatMessage(b.rolePermissionsLabel),children:e.jsx(Ps,{role:i,onSave:O})}];return i&&!ce(i)&&f.push({key:"assignments",label:t.formatMessage(b.roleAssignmentsLabel),children:e.jsx(Rs,{workspaceId:s,roleId:a!=null?a:""})}),f},[s,t,i,O,a]),G=M.get("tab"),[B,U]=g.useState(G&&ws(G)?G:_[0].key),H=f=>{U(f),d({pathname:window.location.pathname,search:new URLSearchParams({tab:f}).toString()})},P=g.useMemo(()=>{var f;return[{label:t.formatMessage(ks.permissionPageTitle),href:"/admin/settings?tab=roles"},{label:(f=i==null?void 0:i.name)!=null?f:""}]},[t,i==null?void 0:i.name]),Q=e.jsxs(v.Root,{children:[e.jsx(v.Trigger,{asChild:!0,className:"border-token-border-default! border!",children:e.jsxs("div",{children:[t.formatMessage(b.manageLabel),e.jsx(ds,{className:"icon-sm ms-0.5"})]})}),e.jsx(v.Portal,{children:e.jsxs(v.Content,{children:[e.jsx(v.Item,{onClick:()=>me(m)(!0),icon:cs,label:t.formatMessage(b.editRoleLabel)}),e.jsx(v.Item,{onClick:()=>me(C)(!0),icon:Ce,label:t.formatMessage(b.deleteRoleLabel),color:"danger"})]})})]});return i?e.jsxs(e.Fragment,{children:[e.jsx(ms,{children:e.jsx("title",{children:i.name})}),e.jsx(De,{navigation:e.jsx(Oe,{items:P}),title:i.name,subtitle:i.description,actions:i&&!ce(i)?Q:void 0,tabsHeader:e.jsx(Cs,{items:_,activeTab:B,onTabChange:H})}),e.jsx(_e,{showSpinner:!1,children:e.jsx(Ms,{items:_,activeTab:B})}),n&&e.jsx(xs,{onSave:({name:f,description:w})=>O(F(k({},i),{name:f,description:w})),onClose:()=>m(!1),isCreate:!1,defaultData:{name:i.name,description:i.description}}),r&&e.jsx(ys,{onClose:()=>C(!1),onDeleteConfirm:()=>S()})]}):null}const ys=({onDeleteConfirm:s,onClose:a})=>{const t=D(),[n,m]=g.useState(!1);return e.jsx(he,{testId:"modal-remove-member",isOpen:!0,title:t.formatMessage(b.deleteRoleLabel),onClose:a,type:"success",primaryButton:e.jsx(le.Button,{title:t.formatMessage(b.confirm),color:"danger",onClick:async()=>{try{m(!0),await s()}finally{m(!1)}},loading:n}),secondaryButton:e.jsx(le.Button,{title:t.formatMessage(b.cancel),color:"secondary",onClick:a,loading:n}),children:e.jsx("div",{className:"flex flex-col items-center gap-2",children:e.jsx("div",{className:"text-token-text-tertiary",children:t.formatMessage(b.deleteConfirmationText)})})})},b=W({rolePermissionsLabel:{id:"PXsC8s",defaultMessage:"Role permissions"},manageLabel:{id:"zPUmjl",defaultMessage:"Manage"},editRoleLabel:{id:"6pHT9d",defaultMessage:"Edit role"},deleteRoleLabel:{id:"XfDjrE",defaultMessage:"Delete role"},confirm:{id:"mQb6kI",defaultMessage:"Confirm"},cancel:{id:"uNmzc2",defaultMessage:"Cancel"},deleteConfirmationText:{id:"tZZlFY",defaultMessage:"Are you sure you want to delete this role? This action cannot be undone."},removeSuccessMessage:{id:"aBZC2C",defaultMessage:"Role removed successfully."},removeErrorMessage:{id:"KthOn1",defaultMessage:"Failed to remove role."},roleAssignmentsLabel:{id:"sBMwFp",defaultMessage:"Role assignments"}}),ct=Te(function(){const a=Ge(),{roleId:t}=Le();return e.jsx(As,F(k({},a),{roleId:t}))});export{ct as default};
//# sourceMappingURL=hkr9e9alhextq3ji.js.map
