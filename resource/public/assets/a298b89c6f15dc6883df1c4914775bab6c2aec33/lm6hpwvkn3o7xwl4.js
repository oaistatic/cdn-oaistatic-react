var E=Object.freeze,j=Object.defineProperty;var m=Object.getOwnPropertySymbols;var k=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable;var M=(e,t,a)=>t in e?j(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,b=(e,t)=>{for(var a in t||(t={}))k.call(t,a)&&M(e,a,t[a]);if(m)for(var a of m(t))T.call(t,a)&&M(e,a,t[a]);return e};var N=(e,t)=>{var a={};for(var n in e)k.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&m)for(var n of m(e))t.indexOf(n)<0&&T.call(e,n)&&(a[n]=e[n]);return a};var P=(e,t)=>E(j(e,"raw",{value:E(t||e.slice())}));import{r as i,j as o,M as w}from"./n75kuy1cx6f5mogg.js";import{au as D,ce as J,gz as O,aS as W,aR as Y,mx as Z,aM as $,cS as Q,P as v,aV as X,aZ as q,aT as ee,iT as te,B as A,F as se,aY as ae}from"./ewse8exzafeu10ji.js";import{h3 as ne,h4 as oe,h5 as re}from"./ny10lj7zpuz89fvf.js";import{E as ce}from"./lkis5qusf3l3oysp.js";function ie({initialText:e,clientThreadId:t,currentLeaf:a,onExitEdit:n,onRequestCompletion:d,disabled:H,attachments:l}){const[g,F]=i.useState(e!=null?e:""),f=i.useRef(null),I=D(),S=J.useStore(),p=g.trim()==="",C=O(),R=i.useCallback(s=>{F(s.currentTarget.value)},[]),h=i.useCallback(s=>{if(p)return;const r={},c=ne();l&&(r.attachments=l),c&&(r.__internal={search_settings:c});const y=S.getActiveSystemHintType(),{systemHints:G,extraStreamParams:L}=oe(y?[y]:[]),u=W(t),V=Y.getParentNode(u,a).message.id,{composerThinkingEffort$:K}=Z(C),U=$(K);d({sourceEvent:s,parentMessageId:V,promptMessage:Q(g,Object.keys(r).length>0?r:void 0),extraStreamParams:L,completionMetadata:{conversationMode:u==null?void 0:u.mode,systemHints:G},thinkingEffort:U}),n(),v.logEvent("Change Active Node",{intent:"edit_save"})},[p,l,t,S,d,n,a,g,C]),x=i.useCallback(()=>{X(t,s=>{q.setCurrentBranch(s,a)}),v.logEvent("Change Active Node",{intent:"edit_cancel"}),n(),v.logEvent("Cancel Edit Prompt",{threadId:ee(t)})},[a,n,t]);i.useEffect(()=>{const s=f.current;if(s){s.focus();const r=s.value.length;s.setSelectionRange(r,r)}},[]),i.useEffect(()=>{const s=f.current,r=c=>{c.isComposing||(c.key==="Enter"&&c.metaKey?h(c):c.key==="Escape"&&x())};return s&&s.addEventListener("keydown",r),()=>{s&&s.removeEventListener("keydown",r)}},[x,h]);const z=l&&l.length>0&&o.jsx(le,{children:l.map(s=>o.jsx(re,{width:I?"wide":"normal",file:s.name,contextConnectorInfo:te(s.context_connector_info)},s.id))}),B=o.jsx("div",{className:"m-2 max-h-[25dvh] overflow-auto",children:o.jsx(ce,{ref:f,value:g,onChange:R,onCopy:s=>s.stopPropagation(),className:"m-0 w-full resize-none border-0 bg-transparent focus:ring-0 focus-visible:ring-0"})});return o.jsxs("div",{className:"bg-token-main-surface-tertiary rounded-3xl px-3 py-3",children:[z,B,o.jsxs("div",{className:"flex justify-end gap-2",children:[o.jsx(A,{as:"button",color:"secondary",onClick:x,children:o.jsx(w,{id:"D9gbPp",defaultMessage:"Cancel"})}),o.jsx(A,{as:"button",onClick:h,disabled:H||p,children:o.jsx(w,{id:"KGxIJG",defaultMessage:"Send"})})]})]})}var _;const le=se.div(_||(_=P(["flex gap-2 flex-wrap"])));function xe(a){var n=a,{message:e}=n,t=N(n,["message"]);var d;return o.jsx(ie,b({currentLeaf:e.id,initialText:ae(e),attachments:(d=e.metadata)==null?void 0:d.attachments},t))}export{xe as TextMessageEditor};
//# sourceMappingURL=lm6hpwvkn3o7xwl4.js.map
