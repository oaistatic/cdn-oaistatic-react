var A=Object.defineProperty,_=Object.defineProperties;var D=Object.getOwnPropertyDescriptors;var g=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var L=(e,t,o)=>t in e?A(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,m=(e,t)=>{for(var o in t||(t={}))E.call(t,o)&&L(e,o,t[o]);if(g)for(var o of g(t))I.call(t,o)&&L(e,o,t[o]);return e},f=(e,t)=>_(e,D(t));import{r as d,f as C}from"./n75kuy1cx6f5mogg.js";import{ao as r,ap as c,N as O,U as w}from"./ewse8exzafeu10ji.js";import{u as N}from"./byq2jfs2d5331lqi.js";import{c3 as y}from"./ny10lj7zpuz89fvf.js";const s="last_checked_loc",p=24*60*60*1e3,u="last_denied_loc",k=60*60*1e3;function q(){const[e,t]=N(),{data:o}=O(w.PreciseLocationEnabledForDevice);d.useEffect(()=>{typeof o=="boolean"&&e.useLocation!==o&&t(n=>f(m({},n),{useLocation:o}))},[o,t,e.useLocation]);const{data:a}=C({queryKey:["userLocation",e.useLocation],queryFn:({queryKey:[n,i]})=>S({enabled:i}),initialData:T(e.useLocation),networkMode:"always",refetchOnMount:"always",refetchOnWindowFocus:"always",staleTime:0});return a}function T(e){if(e){const t=r.getCookie(c.LastLocation);if(t)try{return JSON.parse(t)}catch(o){return l(),null}}return null}async function S({enabled:e}){var o;if(!e)return l();if(((o=await b())==null?void 0:o.state)!=="granted"){const a=localStorage.getItem(s);if(a){const n=Number(a),i=r.getCookie(c.LastLocation);if(i&&Date.now()-p<n)try{return JSON.parse(i)}catch(h){}}}const t=localStorage.getItem(u);if(t){const a=Number(t);if(Date.now()-k<a)return null}return await new Promise(a=>{navigator.geolocation.getCurrentPosition(n=>{const i={latitude:n.coords.latitude,longitude:n.coords.longitude,locationAccuracy:n.coords.accuracy};r.setCookie(c.LastLocation,JSON.stringify(i),{maxAge:y}),localStorage.setItem(s,Date.now().toString()),a(i)},()=>{localStorage.setItem(u,Date.now().toString()),a(l())},{enableHighAccuracy:!0,maximumAge:0})})}function U(){return S({enabled:!0})}async function b(){return navigator!=null&&navigator.permissions?await navigator.permissions.query({name:"geolocation"}):null}const P={latitude:null,longitude:null,locationAccuracy:null};function l(){return r.setCookie(c.LastLocation,JSON.stringify(P),{maxAge:y}),localStorage.removeItem(s),localStorage.removeItem(u),null}d.createContext(null);export{l as c,U as r,q as u};
//# sourceMappingURL=l7zwbn46b1xq4jpt.js.map
