var je=Object.defineProperty,ye=Object.defineProperties;var Ce=Object.getOwnPropertyDescriptors;var H=Object.getOwnPropertySymbols;var Me=Object.prototype.hasOwnProperty,Se=Object.prototype.propertyIsEnumerable;var ee=(s,t,a)=>t in s?je(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,T=(s,t)=>{for(var a in t||(t={}))Me.call(t,a)&&ee(s,a,t[a]);if(H)for(var a of H(t))Se.call(t,a)&&ee(s,a,t[a]);return s},O=(s,t)=>ye(s,Ce(t));import{r as d,j as e,h as be,b as we,m as ne,A as ae}from"./n75kuy1cx6f5mogg.js";import{mA as ke,mB as Ne,ga as Ee,dE as De,lE as E,mC as _e,c0 as Ie,mD as oe,lB as $e,mE as z,c8 as U,mF as Te,mG as Oe,mH as P}from"./ny10lj7zpuz89fvf.js";import{S as Ve}from"./c5nk1rbmunt9qtnd.js";import{x as Ae,eK as q,aR as G,aS as Y,fB as Fe,E as ie,C as re,ex as Be,e as ce,bp as Le}from"./ewse8exzafeu10ji.js";import{u as Re,g as Pe}from"./n83t8t0535fblt5w.js";import{u as We,g as ze}from"./ldmmdc11vyeyqhjq.js";import{r as Ue}from"./je40yyidw4ukzc9u.js";import"./kq6o2ff0g84prlfu.js";import"./dsuqrew0l7dkq40v.js";import"./kg55sov6c624o43c.js";import"./g7mxjj0ktl5g8wm5.js";import"./osbc865wp6mn5wpy.js";import"./iiok29s29bpdre61.js";function Qe(s,t){const a={},r=(n,c="")=>{Object.entries(n).forEach(([h,g])=>{const u=c?"".concat(c,".").concat(h):h;g&&typeof g=="object"&&!Array.isArray(g)?r(g,u):g&&(typeof g=="number"||typeof g=="string"||g==null)&&(a[u]=g)})};r(s);const o={},l=n=>o[n]||(o[n]={}),m=n=>{if(n!=null){if(typeof n=="number")return n;if(typeof n=="string")return new Date(n).getTime()}};Object.keys(a).forEach(n=>{const c=a[n];if(c==null)return;const h=n.split(".").pop(),g=[[/^(.*)_start_time$/,"start",u=>u[1]],[/^(.*)_end_time$/,"end",u=>u[1]],[/^(.*)_sent_time$/,"start",u=>u[1]],[/^(.*)_success_time$/,"end",u=>u[1]],[/^(.*)_time$/,"start",u=>u[1]]];for(const[u,b,C]of g){const M=h.match(u);if(M){const j=C(M),_=l(j);_[b]=m(c);break}}});const x=[];Object.entries(o).forEach(([n,{start:c,end:h}])=>{c!==void 0&&h!==void 0?x.push({name:n,start:c,end:h,duration:h-c}):c!==void 0&&x.push({name:n,start:c,end:c,duration:0,noEnd:!0})});let f=x;if(t&&t.length){const n=new Set(t);f=f.filter(c=>n.has(c.name))}return f.sort((n,c)=>n.start-c.start||n.name.localeCompare(c.name)),f}const te=["text-blue-400","text-green-400","text-purple-400","text-orange-400","text-red-400","text-pink-400","text-yellow-400","text-gray-500","text-blue-300","text-green-300"],qe=({json:s,focusNames:t,width:a,barHeight:r=18,rowGap:o=6,paddingX:l=50,paddingTop:m=20})=>{const x=d.useRef(null),[f,n]=d.useState(a||600);Ae(()=>{if(!a){const i=()=>{if(x.current){const p=x.current.clientWidth;n(Math.max(300,p))}};return i(),window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)}},[a]);const c=d.useMemo(()=>Qe(s,t),[s,t]),[h,g]=d.useState({}),u=d.useCallback(i=>h[i]!==!1,[h]),b=d.useCallback(i=>g(p=>O(T({},p),{[i]:p[i]===!1})),[]),C=d.useMemo(()=>c.filter(i=>u(i.name)),[c,u]),M=C.length>0,j=M?Math.min(...C.map(i=>i.start)):0,_=M?Math.max(...C.map(i=>i.end)):1,k=Math.max(_-j,1),w=m+c.length*(r+o)+o+32,de=(c.length?Math.max(...c.map(i=>i.name.length)):0)*7+16+16,V=Math.max(l,de),ue=l,L=(f-V-ue)/k,[me,J]=d.useState(null),[A,X]=d.useState({visible:!1,x:0,y:0,lines:[]}),Z=(i,p)=>{if(!x.current)return;const v=x.current.getBoundingClientRect(),y=p.clientX-v.left,F=p.clientY-v.top,I=(i.start-j).toFixed(2),$=i.noEnd?void 0:(i.end-j).toFixed(2),R=$?["start: ".concat(I," ms"),"end: ".concat($," ms"),"dur: ".concat(i.duration.toFixed(2)," ms")]:["start: ".concat(I," ms")];X({visible:!0,x:y+10,y:F+10,lines:R})},xe=()=>X(i=>O(T({},i),{visible:!1})),fe=d.useMemo(()=>{if(!M)return[0,k];const i=new Set;C.forEach(v=>{i.add(v.start-j),i.add(v.end-j)});const p=Array.from(i).sort((v,y)=>v-y);return p[0]!==0&&p.unshift(0),p[p.length-1]!==k&&p.push(k),p},[C,j,k,M]);return e.jsxs("div",{ref:x,className:"relative w-full",style:a?{width:"".concat(a,"px")}:void 0,children:[e.jsxs("svg",{width:f,height:w,className:"font-sans",children:[c.map((i,p)=>{const v=m+p*(r+o),y=u(i.name)?V+(i.start-j)*L:0,F=u(i.name)?Math.max(i.duration*L,1):0,I=te[p%te.length],$=me===p?"opacity-80":"opacity-100",R=i.duration===0,K=!!i.noEnd,pe=N=>{u(i.name)&&(J(p),Z(i,N))},he=N=>{u(i.name)&&Z(i,N)},ge=()=>{J(null),xe()};return e.jsxs("g",{onMouseEnter:pe,onMouseMove:he,onMouseLeave:ge,children:[e.jsx("foreignObject",{x:0,y:v,width:V-8,height:r,requiredExtensions:"http://www.w3.org/1999/xhtml",children:e.jsx("div",{className:"pointer-events-auto box-border flex h-full items-center justify-end gap-1 pe-1 text-[12px] text-neutral-900 select-none",children:e.jsxs("label",{className:"flex cursor-default items-center gap-1",children:[e.jsx("input",{type:"checkbox",checked:u(i.name),onChange:()=>b(i.name),className:"cursor-pointer"}),e.jsx("span",{children:i.name})]})})}),u(i.name)&&(K?(()=>{const N=v+r/2,B=r*.6/2,ve=["".concat(y,",").concat(N-B),"".concat(y+B,",").concat(N),"".concat(y,",").concat(N+B),"".concat(y-B,",").concat(N)].join(" ");return e.jsx("polygon",{points:ve,fill:"currentColor",className:"".concat(I," ").concat($)})})():R?e.jsx("line",{x1:y,x2:y,y1:v,y2:v+r,stroke:"currentColor",strokeWidth:2,className:I}):e.jsx("rect",{x:y,y:v,width:F,height:r,fill:"currentColor",className:"".concat(I," ").concat($)})),u(i.name)&&e.jsxs("text",{x:y+(K?r*.6:F)+4,y:v+r/2+4,fill:"currentColor",className:"text-xs text-neutral-700",children:[i.duration.toFixed(2)," ms"]})]},i.name)}),fe.map(i=>{const p=V+i*L;return e.jsx("line",{x1:p,x2:p,y1:m-3,y2:w-32,stroke:"currentColor",strokeWidth:1,className:"text-gray-200"},i)}),e.jsx("text",{x:f/2,y:w-6,textAnchor:"middle",fill:"currentColor",className:"text-xs text-neutral-600",children:"Time since first event (ms)"})]}),A.visible&&e.jsx("div",{className:"pointer-events-none absolute z-10 rounded bg-black/90 px-1.5 py-1 font-mono text-xs whitespace-nowrap text-white",style:{left:A.x,top:A.y},children:A.lines.map((i,p)=>e.jsx("div",{children:i},p))})]})};var W,se;function Ge(){if(se)return W;se=1;var s=Ue(),t=ke(),a=s(function(r,o,l){return r+(l?" ":"")+t(o)});return W=a,W}var Ye=Ge();const Je=be(Ye);function Xe({conversationId:s}){var l;const t=q(s),a=(l=G.getCurrentNode(Y(s)))==null?void 0:l.id,r=Ne();return Ee()?e.jsx(D,{conversationId:t!=null?t:s,parentMessageId:a,status:r}):null}function D(s){var n;const t=(n=s==null?void 0:s.status)==null?void 0:n.modes,[a,r]=d.useState(!1),[o,l]=d.useState(),m=d.useCallback(c=>{l(c),r(!0)},[]),x=we(),f=d.useCallback(()=>r(!1),[]);return e.jsxs(e.Fragment,{children:[e.jsx(Fe,{contentAlign:"center",triggerButton:e.jsx(D.Trigger,{}),children:t?t.map(c=>d.createElement(D.Item,O(T({},s),{key:c.display_name,voiceStatusMode:c,onShowModal:m}))):e.jsx("div",{role:"progressbar","aria-valuetext":x.formatMessage({defaultMessage:"Loading voice modes",id:"voiceModeButton.loadingModes"}),"aria-busy":"true","aria-live":"assertive","aria-valuemin":0,"aria-valuemax":100,children:e.jsx(ie,{"aria-hidden":"true",className:"my-4 min-w-full"})})}),e.jsx(D.Modal,{conversationId:s.conversationId,disabledModeMetadata:o,isOpen:a,onClose:f})]})}D.Modal=function(t){var l,m,x,f;const a=(m=(l=t.disabledModeMetadata)==null?void 0:l.buttons)!=null?m:[],r=We({buttons:a,conversationId:t.conversationId,onClick:t.onClose}),o=e.jsx(De,{children:(x=t.disabledModeMetadata)==null?void 0:x.description_markdown});return e.jsx(re,{testId:"modal-voice-mode",title:(f=t.disabledModeMetadata)==null?void 0:f.title,description:o,isOpen:t.isOpen,onClose:t.onClose,type:"success",primaryButton:r.primary,secondaryButton:r.secondary})};D.Trigger=d.forwardRef(function(t,a){var o;const r=E(l=>l.voiceMode);return e.jsxs(_e,O(T({ref:a},t),{children:[(o=Je(r))!=null?o:e.jsx(ie,{}),e.jsx(Ie,{className:"icon text-token-text-tertiary"})]}))});D.Item=function({conversationId:t,parentMessageId:a,voiceStatusMode:r,onShowModal:o}){const{disabled_mode_metadata:l,mode:m}=r,{startVoiceMode:x}=Re(),f=q(t),n=d.useCallback(async()=>{l?o(l.disabled_message):x(Pe({serverThreadId:f,parentMessageId:a,isAdvancedMode:m==="advanced"&&!l,eventSource:"voice_mode_picker",clientThreadId:t,gizmoId:G.getGizmoId(Y(t)),skipCacheReason:"debug-button-clicked"}))},[t,l,m,o,a,f,x]);return e.jsx(Be.Item,{onClick:n,children:e.jsxs("div",{children:[r.display_name,e.jsx("div",{className:"text-token-text-tertiary text-xs",children:r.description})]})})};function yt({conversationId:s}){const t=E(o=>o.voiceSessionId),a=E(o=>{const{sessionCreateTime:l,sessionConnectedTime:m}=o.metrics;return l&&m?m.getTime()-l.getTime():null}),r=d.useCallback(o=>o>=1e3?"".concat((o/1e3).toFixed(2),"s"):"".concat(o.toFixed(0),"ms"),[]);return e.jsx("div",{className:"relative h-full",children:e.jsx(ne.div,{className:"border-s-token-sidebar-surface-secondary bg-token-main-surface-secondary absolute hidden h-full max-w-[500px] overflow-y-auto rounded-xl border-s pt-4 shadow-inner md:block",initial:{opacity:0,x:520,width:"0px"},animate:{opacity:1,x:0,width:"500px",left:"-520px"},exit:{opacity:0,x:520,width:"0px",left:"0px"},transition:{type:"tween"},children:e.jsx(ae,{children:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex w-full items-center justify-center",children:e.jsx(Xe,{conversationId:s})}),e.jsxs("div",{className:"p-4 py-2 text-sm",children:[e.jsx(S,{name:"Voice Session ID",text:t!=null?t:"n/a"}),e.jsx(Ze,{conversationId:s}),e.jsx(S,{name:"Connect Latency",text:a!==null?r(a):"n/a"}),e.jsx(Ke,{})]}),e.jsxs("div",{className:"flex h-full w-full flex-col flex-nowrap gap-4",children:[e.jsx("div",{className:"px-4",children:e.jsxs("div",{className:"flex flex-col flex-nowrap gap-4",children:[e.jsx(He,{}),e.jsx(et,{})]})}),!1]})]})})})})}function Ze({conversationId:s}){var c,h,g;const t=q(s),a=t&&Y(t),r=G.getTree(a),o=E(u=>u.server.messages.findLast(b=>b.type===oe.ConversationUpdate)),l=o==null?void 0:o.payload.parent_message_id,m=l?r.findNode(u=>u.message.author.role==="assistant"&&Le.isMultimodalTextMessage(u.message),l):void 0,{model_definition_slug:x,model_definition_virtual_model_id:f}=(h=(c=m==null?void 0:m.message.metadata)==null?void 0:c.__internal)!=null?h:{},n=(g=[x,f].filter(Boolean).join(", "))!=null?g:"pending model response";return e.jsx(S,{name:"Model ID",text:n,allowWrap:!0})}function Ke(){const[s,t]=d.useState(!1),[a,r]=d.useState({}),o=$e(),l=d.useCallback(()=>{t(m=>!m)},[]);return d.useEffect(()=>{s&&ze(o).then(r)},[s,o]),e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"cursor-pointer font-semibold text-blue-500 hover:underline",onClick:l,children:s?"Hide Client Metrics Chart":"Show Client Metrics Chart"}),e.jsxs(re,{testId:"modal-client-metrics",title:"Client Metrics",isOpen:s,onClose:()=>t(!1),size:"fullscreen",showCloseButton:!0,children:[e.jsx(qe,{json:a}),e.jsx("pre",{className:"bg-token-bg-tertiary text-token-text-secondary m-4 overflow-x-auto rounded-md p-2 text-[10px] font-semibold",children:JSON.stringify(a,null,2)})]})]})}function He(){const[s,t]=d.useState("timestamp"),[a,r]=d.useState("asc"),o=E(n=>n.server.messages.filter(c=>c.type===oe.Performance)),l=o[o.length-1],m=d.useCallback(n=>n>=1e3?"".concat((n/1e3).toFixed(2),"s"):"".concat(n.toFixed(1),"ms"),[]),x=d.useMemo(()=>l?[...l.payload.metrics].sort((n,c)=>{const h=s==="name"?n.name.localeCompare(c.name):n.ms-c.ms;return a==="asc"?h:-h}):[],[l,s,a]);if(!l)return null;const f=n=>{n===s?r(a==="asc"?"desc":"asc"):(t(n),r("asc"))};return e.jsx(le,{title:"Performance",children:e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsxs("div",{className:"flex flex-row items-center",children:[e.jsx(Q,{text:"Metric"}),s==="name"?a==="asc"?e.jsx(z,{}):e.jsx(U,{}):null]}),e.jsxs("div",{className:"flex cursor-pointer flex-row items-center",onClick:()=>f("timestamp"),children:[e.jsx(Q,{text:"Timestamp"}),s==="timestamp"?a==="asc"?e.jsx(z,{}):e.jsx(U,{}):null]}),x.map(n=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm",children:n.name},n.name),e.jsx("span",{className:"bg-token-main-surface-tertiary line-clamp-1 rounded-lg p-0.5 px-1 font-mono text-xs",children:m(n.ms)},n.name+n.ms)]}))]})})}function et(){var x,f;const s=E(n=>n.server.connectionState),t=E(n=>n.dev.room),[a,r]=d.useState("Unknown"),o=t==null?void 0:t.localParticipant,l=(x=t==null?void 0:t.numParticipants)!=null?x:"Unknown",m=(f=t==null?void 0:t.activeSpeakers)!=null?f:[];return d.useEffect(()=>{if(o){const n=c=>{r(c)};return o.on("connectionQualityChanged",n),()=>{o.off("connectionQualityChanged",n)}}},[o]),e.jsxs(le,{title:"Room",open:!1,children:[e.jsx(S,{name:"Connection Quality",text:String(a)}),e.jsx(S,{name:"Connection State",text:String(s)}),e.jsx(S,{name:"Participants",text:l}),e.jsx(S,{name:"Speakers",text:m.length}),e.jsx(tt,{})]})}function tt(){const s=E(c=>c.dev.room),[t,a]=d.useState(null),[r,o]=d.useState(null),[l,m]=d.useState(null),x=s==null?void 0:s.getActiveDevice("audioinput"),f=s==null?void 0:s.getActiveDevice("audiooutput"),n=s==null?void 0:s.getActiveDevice("videoinput");return d.useEffect(()=>{async function c(){var j,_,k;const h=await P.getLocalDevices("audioinput"),g=await P.getLocalDevices("audiooutput"),u=await P.getLocalDevices("videoinput"),b=h.find(w=>w.deviceId===x),C=g.find(w=>w.deviceId===f),M=u.find(w=>w.deviceId===n);a((j=b==null?void 0:b.label)!=null?j:"Unknown"),o((_=C==null?void 0:C.label)!=null?_:"Unknown"),m((k=M==null?void 0:M.label)!=null?k:null)}c()},[x,f,n]),e.jsxs(e.Fragment,{children:[e.jsx(Q,{text:"Devices"}),l?e.jsx(S,{icon:Te,name:"Video Input",text:l}):null,e.jsx(S,{icon:Oe,name:"Audio Input",text:t!=null?t:"Unknown"}),e.jsx(S,{icon:Ve,name:"Audio Output",text:r!=null?r:"Unknown"})]})}function le({title:s,titleClassName:t,children:a,open:r}){const[o,l]=d.useState(r!=null?r:!0);return e.jsxs("div",{children:[e.jsxs("h3",{className:ce("text-token-text-secondary flex cursor-pointer items-center py-2 text-lg font-semibold",t),onClick:()=>l(!o),children:[e.jsx("span",{children:s}),e.jsx("span",{className:"ms-2",children:o?e.jsx(U,{className:"icon-sm"}):e.jsx(z,{className:"icon-sm"})})]}),e.jsx(ae,{initial:!1,children:o&&e.jsx(ne.div,{initial:"collapsed",animate:"open",exit:"collapsed",variants:{open:{height:"auto",opacity:1},collapsed:{height:0,opacity:0}},transition:{duration:.3,ease:"easeInOut"},layout:!0,children:a},"content")})]})}function Q({text:s}){return e.jsx("h4",{className:"py-2 text-sm font-semibold",children:s})}function S(s){var t;return e.jsxs("div",{className:"flex flex-row flex-nowrap items-center gap-2",children:[e.jsx("span",{className:"opacity-85",children:s.icon?e.jsx(s.icon,{className:"h-[0.75rem] w-[0.75rem]"}):e.jsxs("span",{className:"text-sm",children:[s.name,":"]})}),(t=s.content)!=null?t:e.jsx("span",{className:ce(["bg-token-main-surface-tertiary rounded-lg p-0.5 px-1 font-mono text-xs",!s.allowWrap&&"line-clamp-1"]),children:s.text})]})}export{yt as VoiceModeDevPanel};
//# sourceMappingURL=s6a68pbi217v47pd.js.map
