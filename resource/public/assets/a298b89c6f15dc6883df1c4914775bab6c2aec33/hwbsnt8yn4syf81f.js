var E=Object.defineProperty,k=Object.defineProperties;var T=Object.getOwnPropertyDescriptors;var m=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,w=Object.prototype.propertyIsEnumerable;var _=(e,t,a)=>t in e?E(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,R=(e,t)=>{for(var a in t||(t={}))U.call(t,a)&&_(e,a,t[a]);if(m)for(var a of m(t))w.call(t,a)&&_(e,a,t[a]);return e},S=(e,t)=>k(e,T(t));import{D as $,ae as L,g as y,r as c}from"./n75kuy1cx6f5mogg.js";import{f as A,fl as f,fm as p,R as P}from"./ewse8exzafeu10ji.js";import{a as G}from"./ci57adu98ddr6ebh.js";async function I(e,t,a,o){const n=await P.safeGet("/connectors/{id}/oauth/callback",{parameters:{path:{id:e},query:{code:t,redirect_uri:a,state:o}}});return S(R({},n),{redirect_path:G(n.redirect_path).toString()})}const H=$(function(){const{pluginId:t}=L(),a=y(),o=c.useRef(!1),[n,C]=c.useState(""),{code:i,error:u,error_description:r,state:l}=Object.fromEntries(new URLSearchParams(n.substring(1)).entries());c.useEffect(()=>{C(window.location.hash)},[]),c.useEffect(()=>{if(o.current)return;if(t&&i&&l)o.current=!0;else{a("/");return}async function O(){var g;const b=window.location.origin+"/ccc/".concat(t,"/oauth/callback");if(!(!t||!i||!l))try{const s=await I(t,i,b,l);if(s.success){const h=new URL(f(p.OAUTH_SUCCESS,s.redirect_path),location.origin);h.searchParams.set("oauth_success","true"),a(h.pathname+h.search+h.hash)}else a(f(p.CUSTOM_ERROR,s.redirect_path,(g=s.error)!=null?g:s.message))}catch(s){a(f(p.CUSTOM_ERROR))}}O()},[t,i,l,a]);const d=A();return c.useEffect(()=>{u&&d.danger("".concat(u).concat(r?": ".concat(r):""),{duration:5,toastId:"oauth_callback: CCCOauth",loggingTitle:u,loggingDescription:r!=null?r:""})},[u,r,d]),null});export{H as default};
//# sourceMappingURL=hwbsnt8yn4syf81f.js.map
