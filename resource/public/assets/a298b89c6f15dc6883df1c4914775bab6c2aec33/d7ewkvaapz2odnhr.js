var at=Object.defineProperty,ot=Object.defineProperties;var it=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var rt=Object.prototype.hasOwnProperty,ct=Object.prototype.propertyIsEnumerable;var U=(t,e,s)=>e in t?at(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,D=(t,e)=>{for(var s in e||(e={}))rt.call(e,s)&&U(t,s,e[s]);if(k)for(var s of k(e))ct.call(e,s)&&U(t,s,e[s]);return t},W=(t,e)=>ot(t,it(e));import{r as u,au as lt,i as dt,b as ut,j as c,A as mt,m as v}from"./n75kuy1cx6f5mogg.js";import{i as L,O,hJ as ht,L as H,bJ as B,aR as y,fZ as pt,i8 as ft,gp as xt,ia as Y,fy as Ct,d9 as G,rL as gt,mJ as Tt}from"./ewse8exzafeu10ji.js";import{eL as P,nD as vt,nE as J,k4 as It,C as I,nF as yt,nG as Et,lK as wt,df as St,nH as bt,nI as _t,nJ as At,nK as Rt,nC as Nt,nL as Dt,nM as Ft,nN as Lt,nO as z,nP as X,nA as Ot,u as Pt,eM as M,nQ as V,nR as q,nS as Mt,nT as jt,nU as kt}from"./ny10lj7zpuz89fvf.js";import{L as Ut}from"./fdv2df7jppwbz4po.js";import{T as Wt}from"./gvh5p107yczbfviz.js";import{g as Ht}from"./bj1ejin6tzi0v3v8.js";import"./ce3hgmw4iyyhicud.js";import"./d5vv6ct7n3prp63a.js";import"./ctddpbsbr3gj60l1.js";import"./j2tluvxda4ll72qx.js";import"./npn63o3tt9liv4y2.js";import"./kl7c6054usfnqmd4.js";import"./k97n0y6ba9c9h39c.js";import"./je40yyidw4ukzc9u.js";import"./o423tfdeb6azgv8l.js";import"./cg9mamkqgsk8mjh0.js";import"./ns51nblw8ziscsgd.js";import"./ibchrxf1juu2j0jw.js";import"./iqk1tse6yz14y9t9.js";import"./ly9hghfho7bi4z70.js";import"./hrsgt0zeavq3ouip.js";import"./gvudnmdzjyrmv9hw.js";import"./e52t6kvr8rhywzf0.js";import"./peahhkmucc5rd7ov.js";import"./jiz6zc3ys9fjr045.js";import"./cl7dmrzdmwy44poc.js";import"./d0p97pwfptqt3nvy.js";import"./hkwix64yhkotslv1.js";import"./5hoqitp3r2hkdtny.js";import"./czwq62q5rbh9b1yi.js";import"./gowyl4x2bs7hfi4a.js";import"./em5q5yhbyv41ft0j.js";import"./irqko7c1s7qpl41n.js";import"./i3bw46mavo9n01l8.js";import"./ga8p3rr9o0mc72h0.js";import"./gbvlxp0nrrwdd6eq.js";import"./kj8rd4pu8k32z2dy.js";import"./d65yyyom1modmtdi.js";import"./fh2tsu8ocsi22jc3.js";import"./ou1s0kowmldvhx32.js";import"./co6h42pxywtlg2op.js";const K="oai/apps/canmoreSidebarWidth",Gt=.25,zt=400,$=400;function Q(t){return t-zt}function A(t,e){return lt($,Q(t),e!=null?e:Gt*t)}function Vt(){const t=L(),e=O(()=>P(t).width),s=A(e,ht(H.DANGER_SECRET_FOLDERS_ONLY_getItem(K))),a=Z(),[n,r]=u.useState(s);u.useEffect(()=>{(n<$||n>Q(e))&&r(A(e,n))},[e]);function l(m){r(f=>A(e,f+=m.delta.x))}function i(m){r(m),H.DANGER_SECRET_FOLDERS_ONLY_setItem(K,m)}function d(){const m=A(e,void 0);i(m)}const o="calc(100vw - ".concat(n,"px)");return a?{chatWidth:n,canvasWidth:e-n,canvasWidthCalc:o,viewportWidth:e,handleDrag:l,handleDoubleClick:d,persist:i}:{chatWidth:0,canvasWidth:e,canvasWidthCalc:"100vw",viewportWidth:e,handleDrag:()=>{},handleDoubleClick:()=>{},persist:()=>{}}}function Z(t){const e=L();return O(()=>(t!=null?t:P(e).width)>1e3)}const F="sharedCanvas";function qt(){const[t,e]=dt(),s=t.get(F),a=ut();u.useEffect(()=>{const n=s&&vt.createRemixTempTextdoc(s,a);if(!n)return;requestAnimationFrame(()=>{J(n)});const r=new URLSearchParams(t);r.delete(F),e(r);const l=new URL(window.location.href);l.searchParams.delete(F),history.replaceState(null,"",l)},[s,t,e,a])}const Kt="textdocId",Bt=t=>{const s=new URLSearchParams(window.location.search).get(Kt),a=B(t,n=>{var r,l,i;return(i=(l=(r=y.findNode(n,({message:d})=>{var m;const o=(m=d.metadata)==null?void 0:m.canvas;return(o==null?void 0:o.create_source)===It.HIVE&&(s?(o==null?void 0:o.textdoc_id)===s:!0)}))==null?void 0:r.message.metadata)==null?void 0:l.canvas)==null?void 0:i.textdoc_id});u.useEffect(()=>{a&&requestAnimationFrame(()=>{J(a)})},[a])};function Yt(t,e){let s;return(e==null?void 0:e.type)===I.Textdoc&&(e.textdocId.startsWith(yt)||(s={type:"canvas_textdoc",id:e.textdocId})),Et(t,{promptMessage:{metadata:{open_in_canvas_view:s}}})}const tt=({isFullScreen:t=!1,clientThreadId:e,focusedObject:s,onClose:a,isAnimating:n=!1,width:r})=>{const{setTargetedContent:l}=wt(),i=u.useRef(!1);if(u.useEffect(()=>(i.current&&l(void 0),i.current=!0,()=>{i.current=!1}),[s]),s==null)return null;switch(s.type){case I.Textdoc:return c.jsx(Wt,{isFullScreen:t,onClose:a,clientThreadId:e,focusedTextdoc:s,isAnimating:n,width:r});case I.ADAVisualization:return null}},Jt=300,Xt=t=>{switch(t==null?void 0:t.type){case I.Textdoc:return t.textdocId;default:return null}};function $t({clientThreadId:t,isDisabled:e,disabledTypes:s}){const[a,n,r,l,i]=B(t,p=>[y.getRequestId(p),y.getConversationLastTurn(p),y.isMessageTurnEnded(p),y.getVariantIds(p).length>1,y.lastUserMessage(p)],{disablePerfDetector:!0}),d=St(a),o=bt(),[m,f]=u.useMemo(()=>{if(n&&l)return[void 0,null];if(e===!0)return[void 0,null];if(i!=null){const h=_t(i);if(h)return[i.id,{type:I.Textdoc,textdocId:h}]}let p;return!r&&n&&(p=pt(n.messageGroups,h=>h.type!==ft)),Qt({groupedMessage:p,isRequestActive:d,latestTextdocId:o,disabledTypes:s})},[r,n,l,e,d,o,s,i]),S=f!=null,E=Xt(f),N=At("canvas");u.useEffect(()=>{if(f&&m&&!xt()&&(N(),Rt(f,m),f.type===I.Textdoc)){const{textdocId:p}=f,h=Ht(p);Nt(document.getElementById(h))}},[S,E])}function Qt({groupedMessage:t,isRequestActive:e,latestTextdocId:s,disabledTypes:a}){var n,r;if(t!=null&&t.type&&a.includes(t.type))return[void 0,null];switch(t==null?void 0:t.type){case Y.Canmore:{const[l,i]=t.messages;if(!Dt(l))break;const d=Ft(e,l,i!=null?i:null),o=(n=d.textdocId)!=null?n:s;if(o&&(d.function===Lt.CreateTextdoc?((r=d.content)!=null?r:"").length>Jt||d.status===z.WAITING:d.status===z.STREAMING))return[d.messageId,{type:I.Textdoc,textdocId:o}];break}}return[void 0,null]}const R={type:"spring",bounce:.12,duration:.64},Zt={type:"spring",bounce:0,duration:.58},C={duration:0},te=({clientThreadId:t,focusedObject:e,onClose:s})=>{const a=L(),{chatWidth:n,canvasWidthCalc:r,handleDrag:l,handleDoubleClick:i,persist:d}=Vt(),o=M(),[m,f]=u.useState(!o),[S,E]=u.useState(!1),N=o?C:R,p=o?C:Zt,h=Mt(({rect:T})=>T),{height:w,width:b}=O(()=>P(a));let x=h!=null?h:{top:0,left:n,width:b-n,height:w},j=!1;if(h&&(x.top<0||x.top+x.height>w)){j=!0;const T={width:(b-n)*.75,height:w*.75};x={top:w/2-T.height/2,left:(b-n-T.width)/2+n,width:T.width,height:T.height}}const _=h==null?void 0:h.borderRadius,g=jt(),et=(g==null?void 0:g.history)!=null||(g==null?void 0:g.showChangesAtVersion)!=null,st=Tt();return c.jsxs(c.Fragment,{children:[et&&c.jsx(Ut,{onClick:()=>kt(g.textdocId),zIndexKey:"chatOverlay"}),c.jsxs(v.div,{initial:{marginInlineEnd:st?-260:0},animate:{marginInlineEnd:0},transition:p,children:[c.jsx(v.div,{initial:{opacity:1},animate:{opacity:0},exit:{opacity:[1,0]},transition:o?C:W(D({},R),{delay:.22}),className:"bg-token-main-surface-primary pointer-events-none absolute start-0 top-0 z-20 h-full w-full"}),c.jsx(v.div,{className:"relative z-20 h-full",style:{width:r},exit:{width:0},transition:o?C:{type:"spring",bounce:0,duration:.1}})]}),c.jsx(v.div,{className:"bg-token-bg-primary absolute start-0 z-20 h-full overflow-hidden shadow-[0_0_18px_rgba(0,0,0,0.12)] dark:shadow-[0_0_18px_rgba(0,0,0,0.48)]",initial:{borderRadius:_,opacity:j?0:1,x:x.left,y:x.top,height:x.height,width:x.width},animate:{opacity:1,x:n,y:0,width:r,height:w,borderRadius:0},exit:{scale:.64,opacity:0,filter:"blur(12px)",transition:o?C:{opacity:{duration:.14,bounce:.1}},borderRadius:_},transition:S||o?C:R,onAnimationComplete:()=>f(!1),children:c.jsx(v.div,{className:"dark:border-token-border-light border-token-border-medium h-full overflow-hidden border-s",initial:{borderRadius:_},animate:{borderRadius:0},exit:{borderRadius:_},transition:N,children:c.jsxs("div",{className:"h-full",children:[c.jsx(v.div,{drag:"x",className:"bg-token-text-quaternary absolute start-[-2px] z-10 h-full w-[4px] cursor-ew-resize opacity-0",whileHover:{opacity:.5},whileDrag:{opacity:.75,width:"8px",left:"-4px"},transition:o?C:{type:"tween",duration:.1},style:{x:0,y:0,transform:"translateX(0px)"},dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:{left:0,right:0,top:0,bottom:0},onPointerDown:()=>E(!0),onPointerUp:()=>E(!1),onDrag:(T,nt)=>l(nt),onDragEnd:()=>{E(!1),d(n)},onDoubleClick:()=>i()}),S&&c.jsx("div",{className:"absolute inset-0 z-10"}),c.jsx(tt,{onClose:s,clientThreadId:t,isAnimating:!o&&m,focusedObject:e,width:b-n})]})})})]})},ee=u.memo(te),se=({clientThreadId:t,focusedObject:e,onClose:s})=>{const a=M();return c.jsx(gt,{open:!0,className:"fixed inset-0 z-50 h-full w-full",children:c.jsx(v.div,{className:"z-40 h-full w-full overflow-hidden shadow-xl md:border-gray-100 md:dark:border-gray-700",initial:{scale:.98},animate:{scale:1},transition:a?C:R,children:c.jsx(tt,{isFullScreen:!0,clientThreadId:t,focusedObject:e,onClose:s})})})},ne=({clientThreadId:t,overrideWidth:e,isAutoFocusDisabled:s=!1})=>{const a=Pt(),n=Z(e),r=M();$t({clientThreadId:t,isDisabled:s,disabledTypes:r?[Y.Canmore]:[]}),qt(),Bt(t);const l=u.useRef(!1);u.useEffect(()=>{l.current?X():l.current=!0},[t]);const i=a&&(n?c.jsx(ee,{clientThreadId:t,onClose:q,focusedObject:a},"canvas-sidebar"):c.jsx(se,{clientThreadId:t,onClose:q,focusedObject:a},"canvas-modal"));u.useEffect(()=>{if(a)return V(o=>Yt(o,a)),()=>V(null)},[a]);const d=i!=null;return u.useEffect(()=>(G.setActiveStageSidebar(d),()=>{d&&G.setActiveStageSidebar(!1)}),[d]),r?i:c.jsx(mt,{children:i},t)},Ke=t=>{const e=u.useRef(null);return c.jsx(Ct,{ref:e,onError:(s,a)=>{X(),setTimeout(()=>{var n;(n=e.current)==null||n.resetErrorBoundary()}),Ot.logError("Error boundary hit",s,{componentStack:a})},name:"canmore-focused-view",children:c.jsx(ne,D({},t))})};export{Ke as CanvasFocusedViewManager};
//# sourceMappingURL=d7ewkvaapz2odnhr.js.map
