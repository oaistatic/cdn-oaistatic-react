var sn=Object.defineProperty,nn=Object.defineProperties;var an=Object.getOwnPropertyDescriptors;var Xt=Object.getOwnPropertySymbols;var on=Object.prototype.hasOwnProperty,rn=Object.prototype.propertyIsEnumerable;var $t=(t,n,s)=>n in t?sn(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s,he=(t,n)=>{for(var s in n||(n={}))on.call(n,s)&&$t(t,s,n[s]);if(Xt)for(var s of Xt(n))rn.call(n,s)&&$t(t,s,n[s]);return t},pe=(t,n)=>nn(t,an(n));import{b as F,j as e,M as yt,e as g,r as d,m as B,ay as ln,as as cn,H as un,A as _e,d as bs,u as st,a as De,f as ws,l as dn}from"./n75kuy1cx6f5mogg.js";import{p as mn,m as fn,n as gn,C as hn,a as pn,H as xn,T as vn,o as Cn}from"./o423tfdeb6azgv8l.js";import{ft as yn,gk as bn,wF as nt,nA as q,nB as te,nD as et,wG as Ss,wH as wn,vm as Sn,ul as Tn,rz as Mn,wI as En,gR as jn,c1 as kn,wJ as An,gi as In,o7 as at,bx as Rn,gA as Dn,wK as bt,i2 as _n,wL as Nn,wM as Vt,vL as Pn,uS as Ln,wN as On,wO as Bn,wP as Hn,wQ as Un,js as Fn,vt as Gn,c8 as qn,N as Fe,dW as es,cO as Kn,t as ts,jx as zn,o6 as Qn,jv as Wn,jw as Zn,wR as Ve,a3 as Jn,ar as Yn,aR as Xn,nF as $n,wS as Vn,f2 as ea,eR as Be,wT as ta,wU as Ts,wV as sa,wW as na,wX as wt,wY as aa,rV as oa,wZ as ia,nU as He,w_ as ra,w$ as la,lK as ca,x0 as ua,c as da,x1 as ma,df as fa,x2 as ga,x3 as ha,x4 as pa,eN as xa,eO as va,eP as Ca,lO as ss,eQ as ns,x5 as ya,x6 as ba,b as wa,x7 as Sa,gz as Ta,x8 as Ma,at as Ea,x9 as as,k4 as os,xa as xt,xb as is,xc as Ye,xd as Xe,xe as rs}from"./ny10lj7zpuz89fvf.js";import{gE as Ms,C as ja,J as ka,aF as ls,cS as Aa,B as cs,O as ot,iQ as it,e as ae,T as Ne,_ as Ia,c0 as St,mi as Ra,ai as Da,bJ as Tt,aR as Es,br as us,at as js,R as xe,eK as ks,tL as As,ex as H,lU as ds,dv as _a,eG as Na,i as Is,j as Rs,fC as Pa,ij as La,bU as Oa,bG as Ba,hJ as Ha,gz as Ua,gs as Fa,mp as Ga,P as qa}from"./ewse8exzafeu10ji.js";import{O as Ds,b as Ee,u as Ka,c as za,j as Qa,g as Wa,A as Za,a as Ja,f as ms,C as Ie,D as Ya}from"./fdv2df7jppwbz4po.js";import{S as J,C as tt,e as fs}from"./iqk1tse6yz14y9t9.js";import{S as Xa,a as $a,b as Va,c as eo,d as to,e as so,f as no,g as ao}from"./peahhkmucc5rd7ov.js";import{i as oo,c as io,d as ro,a as lo,b as co,g as uo}from"./cg9mamkqgsk8mjh0.js";import{S as mo}from"./jiz6zc3ys9fjr045.js";import{S as fo}from"./cl7dmrzdmwy44poc.js";import{Z as go,N as ho}from"./ce3hgmw4iyyhicud.js";import{u as po,i as xo}from"./d0p97pwfptqt3nvy.js";import{i as vo}from"./hkwix64yhkotslv1.js";import{C as Co}from"./czwq62q5rbh9b1yi.js";import{g as vt,S as yo}from"./irqko7c1s7qpl41n.js";import{s as Ct,B as bo}from"./i3bw46mavo9n01l8.js";import{S as wo}from"./gbvlxp0nrrwdd6eq.js";import{L as So}from"./kj8rd4pu8k32z2dy.js";import{u as gs}from"./ou1s0kowmldvhx32.js";import{i as hs}from"./co6h42pxywtlg2op.js";import{g as To}from"./e52t6kvr8rhywzf0.js";var _s=(t=>(t.Close="close",t.Loaded="loaded",t.Streaming="streaming",t.Download="download",t))(_s||{});const Mo=({isOpen:t,dismissModal:n,closeTextdocEditor:s,textdocVersion:a,clientThreadId:r})=>{const i=F(),o=yn(r),l=bn(r),c=Ms(),u=nt(a==null?void 0:a.textdocId),f=async b=>{q.logButtonClick(te.SAVE_TO_CHAT_ON_EDITOR_CLOSE),!((a==null?void 0:a.versionInt)==null||c)&&(l({sourceEvent:b,promptMessage:Aa("",{canvas:{user_created_textdocs:a!=null&&a.status===Ss.ATTACHED_PENDING&&u!=null?[{user_created_temp_textdoc_id:a.textdocId,type:a.type,title:a.title,content:a.content,create_source:u.create_source}]:void 0},open_in_canvas_view:{type:"canvas_textdoc",id:a.textdocId}}),completionMetadata:o?{conversationMode:o}:void 0}),u&&et.markAsSent(u.tempTextdocId),n(),s())};return e.jsx(ja,{testId:"modal-confirm-close-editor",isOpen:t,size:"custom",className:"max-w-xl",onClose:n,type:"warning",hideSeparator:!0,title:e.jsx("span",{className:"text-xl",children:e.jsx(yt,{id:"jgd5rD",defaultMessage:"Are you sure you want to close?"})}),primaryButton:e.jsx(ls.Button,{title:i.formatMessage({id:"XE+GiU",defaultMessage:"Save to chat"}),color:"primary",onClick:f}),secondaryButton:e.jsx(ls.Button,{title:i.formatMessage({id:"MbWco5",defaultMessage:"Don’t save and close"}),color:"secondary",onClick:()=>{q.logButtonClick(te.CLOSE_WITHOUT_SAVING),u&&et.removeTempTextdoc(u.tempTextdocId),n(),s()}}),showCloseButton:!0,closeButton:e.jsx(ka,{onClick:n}),children:e.jsx("div",{className:"text-md text-token-text-secondary -mt-6 pb-2",children:e.jsx(yt,{id:"q9rJ+Y",defaultMessage:"Changes will not be saved unless you save this canvas to your chat."})})})},Eo=[{id:"review",title:g({id:"upv1Y0",defaultMessage:"Code review"}),icon:wn,prompt:g({id:"t/Ghj2",defaultMessage:"Search for bugs and opportunities to improve the code—for example, ways that performance or code structure could be improved. Leave as few comments as possible, but add more comments if the text is long. DO NOT leave more than 5 comments. You may reply that you reviewed the code and left suggestions to improve the coding quality, but do not mention the prompt."}),action:J.COMMENT},{id:"comments",title:g({id:"sTWMBR",defaultMessage:"Add comments"}),icon:Sn,prompt:g({id:"yE/5uO",defaultMessage:"Add inline code comments to explain the code, especially parts that are more complex. Make sure to rewrite all the code. You may reply that you added inline comments, but do not mention the prompt."}),action:J.EDIT},{id:"logs",title:g({id:"+00vDz",defaultMessage:"Add logs"}),icon:Xa,prompt:g({id:"rrAJ7R",defaultMessage:"Insert logs/print statements in the code that will help debug its behavior. Do not make any other changes to the code."}),action:J.EDIT},{id:"bugs",title:g({id:"Uw2B/L",defaultMessage:"Fix bugs"}),icon:Tn,prompt:g({id:"8JI5Am",defaultMessage:"Find any bugs and rewrite all the code to fix the bugs. Do not add any new comments. If there are no bugs, reply that you reviewed the code and found no bugs."}),action:J.EDIT},{id:"port",title:g({id:"BotcNe",defaultMessage:"Port to a language"}),icon:Mn,action:J.CREATE_TEXTDOC,menu:[{prompt:g({id:"LGUTjb",defaultMessage:"Create a new document that rewrites the code in PHP"}),title:g({id:"oR7PqF",defaultMessage:"PHP"})},{prompt:g({id:"t6K8xn",defaultMessage:"Create a new document that rewrites the code in C++"}),title:g({id:"QbnHp2",defaultMessage:"C++"})},{prompt:g({id:"hmI7x6",defaultMessage:"Create a new document that rewrites the code in Python"}),title:g({id:"viPy6U",defaultMessage:"Python"})},{prompt:g({id:"oY48Xk",defaultMessage:"Create a new document that rewrites the code in JavaScript"}),title:g({id:"Mnbu7B",defaultMessage:"JavaScript"})},{prompt:g({id:"7H04sz",defaultMessage:"Create a new document that rewrites the code in TypeScript"}),title:g({id:"pot/GV",defaultMessage:"TypeScript"})},{prompt:g({id:"IFRMM/",defaultMessage:"Create a new document that rewrites the code in Java"}),title:g({id:"78tNyh",defaultMessage:"Java"})}]}];function Ns(t){const n=En();if(!t)return{isCodePreviewable:!1,isCodeExecutable:!1,hasCanvasCodeExecution:n};const s=oo(t==null?void 0:t.type,t==null?void 0:t.content),a=io(t.type);return{isCodePreviewable:s,isCodeExecutable:a,hasCanvasCodeExecution:n}}const jo=({isTextdocStreaming:t,isRequestActive:n,value:s,comments:a})=>{const[r,i]=d.useState(!1);return d.useEffect(()=>{t&&r&&(i(!1),tt.reset())},[s,a]),d.useEffect(()=>{n||(i(!1),tt.reset())},[n]),[r,i]};function ko({onClickRestore:t,onClickResetLatest:n}){const s=F();return e.jsx(B.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},transition:{bounce:0,duration:.24},className:"bg-token-main-surface-primary z-30",children:e.jsx(B.div,{className:"bg-token-main-surface-primary dark:border-token-border-xlight @container w-full items-center border-t border-gray-100 p-6 shadow-[0_-4px_32px_rgba(0,0,0,0.08)] lg:border-s dark:shadow-[0_-4px_32px_rgba(0,0,0,0.12)]",children:e.jsxs("div",{className:"mx-auto flex max-w-[48rem] flex-col flex-wrap justify-center gap-5 @2xl:flex-row @2xl:justify-between",children:[e.jsxs("div",{className:"flex flex-col px-2 text-center @2xl:text-start",children:[e.jsx("span",{className:"text-md text-token-text-primary font-semibold text-wrap",children:s.formatMessage({id:"gt23pb",defaultMessage:"You are viewing a previous version"})}),e.jsx("span",{className:"text-token-text-secondary text-sm text-wrap",children:s.formatMessage({id:"sAlUJn",defaultMessage:"Restore this version to make edits"})})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-4",children:[e.jsx(cs,{as:"button",color:"primary",onClick:t,children:s.formatMessage({id:"+cddAb",defaultMessage:"Restore this version"})}),e.jsx(cs,{as:"button",color:"secondary",onClick:n,children:s.formatMessage({id:"qCD3eu",defaultMessage:"Back to latest version"})})]})]})})})}const Ao=[{id:"suggest",title:g({id:"DJBCXv",defaultMessage:"Suggest edits"}),icon:jn,prompt:g({id:"BfBd/I",defaultMessage:"Suggest edits that would improve this text, like content to add or remove, places to rephrase so that the text flows more smoothly, or ways to reorganize the ideas to be more effective. Leave as few comments as possible, but add a few more comments if the text is long. DO NOT leave more than 5 comments. You can reply that you added comments and suggestions to help improve the writing quality, but do not mention the prompt."}),action:J.COMMENT},{id:"emoji",title:g({id:"nH2MaB",defaultMessage:"Add emojis"}),icon:mo,action:J.EDIT,grid:[{prompt:g({id:"JTAWur",defaultMessage:"Replace as many words as possible with emojis."}),icon:$a,title:g({id:"rADAL1",defaultMessage:"Words"})},{prompt:g({id:"AvWBKJ",defaultMessage:"Add three emojis at the start or end of every major section or paragraph to give subtle decoration. Do not change the structure of the original text. Do not add emojis to lists."}),icon:Va,title:g({id:"qoHmnu",defaultMessage:"Sections"})},{prompt:g({id:"Rzca6Y",defaultMessage:"Add emojis to lists for visual flair. Do not change the structure of the original text."}),icon:eo,title:g({id:"/iBeX+",defaultMessage:"Lists"})},{prompt:g({id:"YOtrrm",defaultMessage:"Remove emojis"}),icon:to,title:g({id:"Ex7XkT",defaultMessage:"Remove"})}]},{id:"polish",title:g({id:"q/wllh",defaultMessage:"Add final polish"}),icon:so,prompt:g({id:"qTOQqX",defaultMessage:"Add some final polish to the text. If relevant, add a large title or any section titles. Check grammar and mechanics, make sure everything is consistent and reads well. You can reply that you added some final polish and checked for grammar, but do not mention the prompt."}),action:J.EDIT},{id:"reading-level",title:g({id:"e1CNWE",defaultMessage:"Reading level"}),icon:kn,action:J.EDIT,scrub:[{prompt:g({id:"98kB8D",defaultMessage:"Rewrite this text at the reading level of a doctoral writer in this subject. You may reply that you adjusted the text to reflect a graduate school reading level, but do not mention the prompt."}),title:g({id:"zIN5xc",defaultMessage:"Graduate School"})},{prompt:g({id:"XfveZa",defaultMessage:"Rewrite this text at the reading level of a college student majoring in this subject"}),title:g({id:"lZ5ttG",defaultMessage:"College"})},{prompt:g({id:"ed5yE6",defaultMessage:"Rewrite this text at the reading level of a high school student who has taken a couple of classes in this subject."}),title:g({id:"KeBm6Z",defaultMessage:"High School"})},{title:g({id:"tO5EOl",defaultMessage:"Keep current reading level"}),isCancel:!0},{prompt:g({id:"YIIyU/",defaultMessage:"Rewrite this text at the reading level of a middle schooler."}),title:g({id:"FlwtZ0",defaultMessage:"Middle School"})},{prompt:g({id:"TQ0+4A",defaultMessage:"Rewrite this text at the reading level of a kindergartener."}),title:g({id:"4hQpWn",defaultMessage:"Kindergarten"})}]},{id:"length",title:g({id:"D+HIXi",defaultMessage:"Adjust the length"}),icon:An,action:J.EDIT,scrub:[{prompt:g({id:"CPELTR",defaultMessage:"Make this text 75% longer."}),title:g({id:"UMJQry",defaultMessage:"Longest"})},{prompt:g({id:"GfSrP9",defaultMessage:"Make this text 50% longer."}),title:g({id:"n3jwqb",defaultMessage:"Longer"})},{title:g({id:"+Vn3dN",defaultMessage:"Keep current length"}),isCancel:!0},{prompt:g({id:"oQnJVV",defaultMessage:"Make this text 50% shorter."}),title:g({id:"OP0SP3",defaultMessage:"Shorter"})},{prompt:g({id:"k5SZ0S",defaultMessage:"Make this text 75% shorter."}),title:g({id:"bMef50",defaultMessage:"Shortest"})}]}],Gi=[{id:"none",title:g({id:"XqUjk5",defaultMessage:"Plain text"}),icon:fo,prompt:g({id:"H2OFQy",defaultMessage:"Transform this into plain text. Remove any formatting."}),action:J.EDIT},{id:"bullets",title:g({id:"+qR+tC",defaultMessage:"Bulleted list"}),icon:no,prompt:g({id:"8Anlmq",defaultMessage:"Transform this into a bulleted list."}),action:J.EDIT},{id:"list",title:g({id:"Rm67Xw",defaultMessage:"Numbered list"}),icon:ao,prompt:g({id:"0pEdK3",defaultMessage:"Transform this into a numbered list."}),action:J.EDIT},{id:"table",title:g({id:"zUJNQu",defaultMessage:"Table"}),icon:In,prompt:g({id:"BX96Lh",defaultMessage:"Transform this into a table. Add any appropriate labels to the columns or rows headers."}),action:J.EDIT}];function Io(t){const{doc:n,selection:s}=t,{$from:a,$to:r}=s,{pos:i}=a,{pos:o}=r,l=n.textBetween(i,o);try{const c=mn(n,a),u=fn(n,r);return{sourceFrom:c,sourceTo:u,from:i,to:o,selectedText:l}}catch(c){q.logError("Getting source selection",c)}return{selectedText:l,from:i,to:o}}const Me={type:"spring",bounce:.2,duration:.5},Ps=({title:t,icon:n,size:s,opacity:a,initialHeight:r=s,initialScale:i=1,onClick:o,isConfirming:l,isSmall:c,onSubmit:u})=>{const f=F(),b=ln(),[S,m]=d.useState(!1),w=ot(it),k=()=>{m(!0)},j=()=>{m(!1)},h=e.jsx(B.div,{initial:{scale:i,opacity:0},animate:{scale:1,opacity:1,transition:{type:"spring",bounce:.24,duration:.52}},exit:{scale:.5,opacity:0,transition:{type:"spring",bounce:.24,duration:.52,opacity:{duration:.1}}},whileHover:{scale:1.15},transition:Me,children:e.jsx(B.div,{className:"flex cursor-pointer items-start overflow-hidden",initial:{width:s,height:s},animate:{width:s,height:s},transition:Me,onMouseEnter:k,onMouseLeave:j,children:l?e.jsx(B.button,{className:"m-auto flex h-8 w-8 items-center justify-center rounded-full bg-black text-center dark:bg-white",initial:{opacity:0,scale:.64},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.64},transition:{type:"spring",duration:.32,bounce:.14},onClick:u,children:e.jsx(at,{className:ae("animate-pulsing text-white dark:text-black",c?"icon":"icon-lg")})}):n})});return e.jsx(B.div,{role:"button",onClick:o,initial:{height:r},animate:{height:s,opacity:l?1:a!=null?a:.52},exit:{height:0},whileHover:{opacity:1},transition:Me,children:w?e.jsx(Ne,{open:b?!!(l||S):!1,label:f.formatMessage(t),side:"left",contentClassName:"pointer-events-none",children:h}):h})};function ps({accelerator:t,size:n,opacity:s,onClick:a,onSubmit:r,disableHeightAnimation:i=!1,disableLabel:o=!1,isCancelledScrubber:l=!1,isSmall:c=!1,isConfirming:u}){const{title:f,icon:b}=t,S=ot(it),m=F();return e.jsxs("div",{className:"relative",children:[!S&&!o&&e.jsx(B.div,{className:"text-token-text-secondary absolute end-full top-1/2 w-[160px] -translate-y-1/2 transform pe-4 text-end text-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:m.formatMessage(f)}),e.jsx(Ps,{size:n,onClick:a,opacity:s,initialHeight:l||i?"auto":0,initialScale:l?.88:.5,title:f,isSmall:c,isConfirming:u,onSubmit:r,icon:e.jsx(b,{className:ae("text-token-primary m-auto",c?"icon":"icon-lg")})})]})}function Ro({title:t,onSubmit:n,icon:s}){const a=F(),r=s;return e.jsxs(B.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:n,className:"text-token-text-secondary hover:text-token-text-primary flex aspect-square w-20 max-w-20 min-w-20 cursor-pointer flex-col items-center rounded-2xl p-3 transition-colors hover:bg-gray-100/75 dark:hover:bg-gray-700",children:[e.jsx(r,{className:"icon-2xl m-auto"}),e.jsx("div",{className:"line-clamp-1 w-16 max-w-16 overflow-hidden text-center text-xs",children:a.formatMessage(t)})]})}function Do({grid:t,onSubmit:n,title:s}){const a=F();return e.jsxs("div",{className:"flex h-full flex-col content-center gap-y-4 overflow-x-hidden px-3 py-4",children:[e.jsx("div",{className:"text-token-primary mt-1 text-center font-medium",children:s}),e.jsx("div",{className:"flex-auto",children:e.jsx("div",{className:"grid grid-cols-2 gap-1",children:t.map((r,i)=>e.jsx(Ro,{title:r.title,icon:r.icon,onSubmit:o=>{const l=t[i];"prompt"in l&&(n==null||n(o,a.formatMessage(l.prompt)))}},i))})})]})}function _o({title:t,onClick:n,isConfirming:s,onSubmit:a,isAnyItemConfirmed:r}){const i=F();return e.jsxs(B.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:n,className:ae("flex-item my-1 flex min-w-40 cursor-pointer items-center overflow-hidden rounded-2xl py-2 ps-4 pe-2 font-medium text-clip whitespace-nowrap transition-colors hover:bg-gray-100/75 dark:hover:bg-gray-700",{"bg-gray-100/50 dark:bg-gray-700/50":s,"text-token-text-secondary hover:text-token-text-primary":!s&&r}),children:[e.jsx("div",{className:"flex-auto",children:i.formatMessage(t)}),e.jsx(B.button,{className:ae("ms-3 h-6 w-6 rounded-full bg-black text-center dark:bg-white",{"pointer-events-none invisible":!s}),initial:{opacity:0,scale:.64},animate:{opacity:s?1:0,scale:s?1:.64},transition:{type:"spring",duration:.32,bounce:.14},onClick:a,children:e.jsx(at,{className:"icon-lg text-white dark:text-black"})})]})}function No({menu:t,onConfirm:n,onSubmit:s}){const[a,r]=d.useState(!1),i=F();return e.jsx("div",{className:"h-full flex-col content-center overflow-x-hidden px-3",children:t.map((o,l)=>e.jsx(_o,{title:o.title,isConfirming:a===l,isAnyItemConfirmed:a!==!1,onClick:()=>{r(l),n==null||n()},onSubmit:c=>{const u=t[l];"prompt"in u&&(s==null||s(c,i.formatMessage(u.prompt)))}},"menu-item-".concat(o.title)))})}const Po=t=>"isCancel"in t&&t.isCancel,xs=280;function Lo(t,n,s){if(s===n)return 1;const a=(t-n)/(s-n);return Rn(a,0,1)}function Oo({size:t,acceleratorScrubber:n,onConfirm:s,onCancel:a,onSubmit:r,onDragStart:i,isConfirming:o}){const{icon:l}=n,c="scrub"in n?n.scrub:[],u=6,f=t-u*2,b=F(),S=d.useRef(null),m=d.useRef(null),[w,k]=d.useState(c?Math.floor(c.length/2):0),j=Math.round(w),h=d.useRef(w),p=c?b.formatMessage(c[j].title):null,T=cn(0);un(T,"change",C=>{const _=-137+f/2,I=(xs-u)/2-f/2,L=Lo(C,_,I)*(c?c.length-1:0);h.current=L,k(L)});const x=()=>{if(!c||Po(c[j])||o)return a==null?void 0:a();c&&(s==null||s())},P=C=>{C.preventDefault(),!(!c||!o||!("prompt"in c[j]))&&(r==null||r(C,b.formatMessage(c[j].prompt)))};return e.jsx(B.div,{ref:S,className:"start-items relative z-20 flex w-full",style:{top:u,height:xs-u*2},children:e.jsx(B.div,{drag:"y",ref:m,dragConstraints:S,dragMomentum:!1,dragElastic:0,className:ae("border-token-border-default m-auto rounded-full border shadow-md transition-colors",o?"cursor-pointer bg-black dark:bg-white":"bg-token-main-surface-primary cursor-grab"),style:{y:T,width:f,height:f},onDragStart:i,onDragEnd:x,children:e.jsx(Ne,{open:!0,label:p,side:"right",children:e.jsx("div",{className:"flex h-full w-full items-center justify-center overflow-hidden",children:o?e.jsx(at,{onClick:P,className:"icon-xl animate-pulsing text-white dark:text-black"}):e.jsx(l,{className:"text-token-primary icon-lg m-auto"})})})})})}const $e=280,Bo=235,vs=1250,Ho=56,Uo=32,Fo=28;function Go({top:t}){return e.jsx(B.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute start-1/2 m-auto h-1 w-1 -translate-x-1/2 rounded-full bg-gray-300",style:{top:t}})}function qo({bottom:t=20,right:n=20,isEmbeddedInPromptArea:s=!1,disableHint:a=!1,disableOverlay:r=!1,onCancel:i,onExpandedChange:o,onSubmit:l,isRequestActive:c=!1,isVisuallyHidden:u=!1,actions:f}){const[b,S]=d.useState(!1),[m,w]=d.useState(!a&&!c),[k,j]=d.useState(!0),[h,p]=d.useState(null),[T,x]=d.useState(!1),[P,C]=d.useState(!1),[_,I]=d.useState(!1),[N,L]=d.useState(null),[U,X]=d.useState(null),[se,K]=d.useState(null),z=!k,oe=Ia(),Q=s&&!m,M=Q?Uo:Ho,be=F(),je=ot(it),Pe=po(),W=d.useRef(null),O=c||b,Y=c&&!m&&k;d.useEffect(()=>{m&&!P&&C(!0),o==null||o(m)},[m,P]),d.useEffect(()=>{T&&!O&&!N&&(W.current!=null&&clearTimeout(W.current),w(!0)),!T&&!O&&!N&&(W.current!=null&&clearTimeout(W.current),W.current=window.setTimeout(()=>{w(!1),p(null),I(!1)},vs))},[T,O,N,m]),d.useEffect(()=>{if(c){p(null);return}S(!1),!P&&!a&&(C(!0),w(!0),W.current!=null&&clearTimeout(W.current),W.current=window.setTimeout(()=>{w(!1),p(null),I(!1),C(!0)},vs))},[c,a,P]);const le=E=>{p(E)},ce=(E,R,D)=>{x(!1),S(!0),w(!1),p(null),I(!1),L(null),X(null),K(null);const Te=Pe(),qe=(me,ye)=>{q.logButtonClick(te.ACCELERATOR,{action:{action:D.action,id:D.id,title:D.title},prompt:R,sourceFrom:me,sourceTo:ye})};if(Te&&xo(Te)){const{state:me}=Te,{sourceFrom:ye,sourceTo:ne}=Io(me);if(qe(ye,ne),ye==null||ne==null){l==null||l(E,null,R,D);return}l==null||l(E,{start:ye,end:ne},R,D);const Le=me.tr.setSelection(Ra.create(me.doc,me.selection.anchor));Te.dispatch(Le);return}qe(),l==null||l(E,null,R,D)},ue=f[0],ke=f.slice(1),de=!!N&&f.find(({id:E})=>E===N),$=!!U&&f.find(({id:E})=>E===U),G=!!se&&f.find(({id:E})=>E===se),we=(E,R)=>{if(z)return;if(!T){x(!0);return}const{id:D}=R;if("scrub"in R)return L(D);if("menu"in R)return X(D);if("grid"in R)return K(D);le(D)},Ge=(E,R)=>{z||"prompt"in R&&ce(E,be.formatMessage(R.prompt),R)},rt=ke.map(E=>{if(!m)return null;const{id:R}=E;return e.jsx(ps,{accelerator:E,isConfirming:R===h,isCancelledScrubber:_,size:M,onClick:D=>we(D,E),onSubmit:D=>Ge(D,E)},R)}),ve=d.useRef(null);d.useEffect(()=>{const{current:E}=ve;if(E)return St(document,{mousedown:({target:R})=>{R instanceof HTMLElement&&!E.contains(R)&&(w(!1),p(null),I(!1),x(!1),L(null),X(null),K(null))}})},[N,U,se]);const v=Math.round($e/M)*2,V=[];let Ce=0;for(let E=0;E<v-1;E++)Ce+=$e/v,V.push(e.jsx(Go,{top:Ce}));const Se=e.jsx(B.div,{ref:ve,initial:{opacity:0,scale:.85,borderRadius:M/2},exit:{opacity:0,borderRadius:M/2},className:ae("border-token-border-default absolute overflow-visible border transition-colors select-none",go.accelerators,{"pointer-events-none":u,"bg-token-main-surface-primary shadow-xl":m&&!N&&!c,"bg-token-main-surface-primary shadow-lg":!m&&!N&&!c&&!s,"bg-token-main-surface-primary border-transparent shadow-sm":!m&&!N&&!c&&s,"bg-token-main-surface-secondary border-transparent":N&&!c,"bg-token-main-surface-primary":c&&!Y,"bg-black! text-white!":!oe&&Y,"bg-white! text-black!":oe&&Y}),style:{right:n,bottom:t},animate:{scale:O||Y||b?.85:1,opacity:u?0:1,borderRadius:U&&$&&!O||se&&G&&!O?Fo:M/2},onHoverStart:()=>{W.current!=null&&clearTimeout(W.current),x(!0)},onHoverEnd:()=>x(!1),children:e.jsx(_e,{children:U&&$&&"menu"in $&&!O?e.jsx(B.div,{initial:{height:M,width:M},transition:Me,animate:{height:$e,width:"auto"},exit:{height:M,width:M},children:e.jsx(No,{isConfirming:h===$.id,onConfirm:()=>le($.id),onSubmit:(E,R)=>ce(E,R,$),menu:$.menu})}):se&&G&&"grid"in G&&!O?e.jsx(B.div,{initial:{height:M,width:M},transition:Me,animate:{height:Bo,width:"auto"},exit:{height:M,width:M},children:e.jsx(Do,{title:be.formatMessage(G.title),onSubmit:(E,R)=>ce(E,R,G),grid:G.grid})}):N&&de&&!O?e.jsxs(B.div,{initial:{height:M,width:M},transition:Me,animate:{height:$e,width:M},exit:{height:M,width:M},onClick:()=>{p(null)},children:[e.jsx(Oo,{onDragStart:()=>p(null),isConfirming:h===de.id,onConfirm:()=>le(de.id),onSubmit:(E,R)=>ce(E,R,de),onCancel:()=>{L(null),I(!0)},size:M,acceleratorScrubber:de}),V]}):e.jsxs(B.div,{className:"flex flex-col",initial:s?!1:{height:M,width:M},transition:Me,animate:{height:m?M*f.length:M,width:M},exit:{height:M,width:M},onAnimationComplete:()=>j(!0),onAnimationStart:()=>j(!1),children:[e.jsx(_e,{children:rt}),e.jsx("div",{className:"flex items-center",style:{width:M,height:M},children:O?Y?e.jsx(Ps,{title:Ko.cancel,icon:e.jsx(Dn,{className:ae("animate-pulsing m-auto shrink-0",Q?"h-6 w-6":"h-10 w-10")}),isSmall:Q,opacity:1,size:M,onClick:()=>{p(null),i==null||i()}}):e.jsx(bt,{size:20,className:"text-token-text-secondary m-auto"}):e.jsx(ps,{disableHeightAnimation:s,disableLabel:je||!m,isCancelledScrubber:_,accelerator:ue,isConfirming:h===ue.id,opacity:m?void 0:1,isSmall:Q,size:M,onSubmit:E=>Ge(E,ue),onClick:E=>we(E,ue)})})]})})});return r||je?Se:e.jsxs(e.Fragment,{children:[m&&e.jsx(Ds,{zIndexKey:"acceleratorsOverlay",className:"bg-white/95 dark:bg-black/85"}),Se]})}const Ko=bs({cancel:{id:"Hov840",defaultMessage:"Cancel"}}),zo={type:"spring",bounce:.2,duration:.56},Qo=({clientThreadId:t,turn:n})=>{const s=_n();return e.jsxs(B.div,{className:"absolute start-0 end-0 top-0 z-10 -translate-y-full",children:[e.jsx(B.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"bg-vert-light-gradient dark:from-token-main-surface-primary absolute inset-0 -top-5 dark:bg-linear-to-t dark:to-transparent"}),e.jsx(B.div,{className:"flex items-center py-2",initial:{opacity:.75,translateX:-50,translateY:"100%"},animate:{opacity:1,translateX:0,translateY:"0"},exit:{opacity:0,filter:"blur(8px)",transition:{delay:.4,duration:.72}},transition:zo,children:e.jsx(Co,{clientThreadId:t,onRequestCompletion:Da,groupedMessagesToRender:n.messageGroups,allGroupedMessages:n.messageGroups,allMessages:n.messages,isUserTurn:!0,isFinalUserTurn:!1,isFinalAssistantTurn:!1,turnIndex:0,isCompletionRequestInProgress:!1,isFeedbackEnabled:!1,isFinalTurn:!1,hasActiveRequest:s})})]},"user-message")},Wo=({clientThreadId:t})=>{const{lastUserTurn:n,lastAssistantTurn:s}=Tt(t,r=>{const i=Es.getConversationTurns(r);let o=null,l=null;for(let c=i.length-1;c>0;c--){const u=i[c];if(!o&&u.role===us.User?o=u:!l&&u.role===us.Assistant&&(l=u),o&&l)break}return{lastUserTurn:o,lastAssistantTurn:l}}),a=n&&!(s!=null&&s.messages.some(r=>{var i;return(i=r.recipient)==null?void 0:i.startsWith(Nn)}));return e.jsx(_e,{initial:!1,children:a&&e.jsx(Qo,{turn:n,clientThreadId:t})})},Zo=({isRequestActive:t=!1,clientThreadId:n,readonlyReason:s,onCancel:a,onSubmit:r,onSubmitAccelerator:i,acceleratorActions:o=[]})=>{var T;const[l,c]=d.useState(!1),[u,f]=d.useState(""),[b,S]=d.useState(!0),m=F(),[w,k]=d.useState(!1),j=ot(it),h=x=>{r==null||r(x,u),f("")},p=x=>{if(x.nativeEvent.isComposing)return;const{metaKey:P,shiftKey:C,key:_}=x;_==="Enter"&&u.trim()&&!(C||P)&&(h(x),x.preventDefault())};return e.jsxs(e.Fragment,{children:[l&&!j&&e.jsx(Ds,{zIndexKey:"acceleratorsOverlay",className:"bg-white/95 dark:bg-black/85"}),e.jsx("div",{className:"relative mb-3 flex items-end justify-center",children:e.jsxs("div",{className:"relative mx-6 max-w-2xl flex-1",children:[e.jsx(Wo,{clientThreadId:n}),e.jsx("div",{className:"flex flex-auto items-start",children:e.jsx("div",{className:ae("dark:bg-token-main-surface-secondary flex min-h-12 flex-auto items-center bg-[#f4f4f4] py-1 ps-6 pe-2",{"rounded-full":b,"rounded-2xl":!b,"bg-transparent":w}),children:e.jsxs("div",{className:"relative flex flex-auto items-center self-stretch",children:[e.jsx(vo,{placeholder:m.formatMessage({id:"zrUbTJ",defaultMessage:"Ask ChatGPT to edit"}),disabled:t,value:u,className:ae("text-token-text-primary placeholder:text-token-text-secondary w-full resize-none border-0 bg-transparent p-0 outline-0 focus:ring-0 focus-visible:ring-0",{"opacity-0":w}),maxRows:4,onChange:({target:{value:x}})=>f(x),onKeyDown:p,onHeightChange:(x,{rowHeight:P})=>S(Math.floor(x/P)<=1)}),u?e.jsx(B.button,{className:ae("dark bg-token-main-surface-primary h-8 w-8 rounded-full text-center disabled:bg-[#D7D7D7]",{"self-end":!b}),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.1},onMouseDown:h,children:e.jsx(at,{className:"text-token-text-primary h-8 w-8"})}):((T=o==null?void 0:o.length)!=null?T:0)>0&&e.jsx(qo,{disableHint:!0,isVisuallyHidden:(s==null?void 0:s.isReadonly)&&!s.isStreaming,disableOverlay:!0,isEmbeddedInPromptArea:!0,isRequestActive:t,actions:o,onCancel:a,onExpandedChange:x=>{j||k(x),c(x)},onSubmit:i,right:0,bottom:4})]})})})]})})]})};function Jo(t,n){const s=new Set(t.map(l=>l.id)),a=new Set(n.map(l=>l.id)),r=t.filter(l=>!a.has(l.id)).map(l=>pe(he({},l),{diffStatus:Vt.REMOVED})),i=n.filter(l=>!s.has(l.id)).map(l=>pe(he({},l),{diffStatus:Vt.ADDED})),o=t.filter(l=>a.has(l.id));return r.concat(i,o)}const Yo=t=>{const{textdocId:n}=t,s=Pn(a=>{var r;return(r=a==null?void 0:a.resolveTempTextdocId[n])!=null?r:n});return d.useMemo(()=>pe(he({},t),{textdocId:s}),[s,t])};async function Xo({textdocId:t,newTitle:n}){n!=null&&await xe.safePost("/textdoc/{textdoc_id}/rename",{parameters:{path:{textdoc_id:t}},requestBody:{title:n}}).catch(s=>{js.addError("renameCanvasTitle Error:",s)})}const $o=({serverThreadId:t,textdocVersion:n,initialTitle:s="Untitled Document",isEditingTitle:a,setIsEditingTitle:r})=>{const i=st(),{mutateAsync:o}=De({mutationKey:[t,"textdocs"],mutationFn:Xo,onMutate:async({textdocId:h,newTitle:p})=>{await i.cancelQueries({queryKey:[t,"textdocs"]});const T=i.getQueryData([t,"textdocs"]);return i.setQueryData([t,"textdocs"],x=>{if(!x)return x;const P=new Map(x.persistedTextdocVersionById),C=P.get(h);if(C){const L=pe(he({},C),{title:p!=null?p:""});P.set(h,L)}const _=x.persistedTextdocVersions.map(L=>L.textdocId===h?pe(he({},L),{title:p!=null?p:""}):L),I=new Map(x.persistedTextdocById),N=I.get(h);if(N){const L=pe(he({},N),{title:p!=null?p:""});I.set(h,L)}return pe(he({},x),{persistedTextdocVersionById:P,persistedTextdocVersions:_,persistedTextdocById:I})}),{previousTextDocData:T}},retry:2,onError:(h,p,T)=>{T!=null&&T.previousTextDocData&&i.setQueryData([t,"textdocs"],T.previousTextDocData),js.addError("Error updating title:",h)},onSettled:()=>{i.invalidateQueries({queryKey:[t,"textdocs"]})}}),l=async h=>{var p;n&&await o({textdocId:(p=n.textdocId)!=null?p:"",newTitle:h})},[c,u]=d.useState(s),f=d.useRef(null),b=d.useRef(c),S=d.useRef(!1);d.useEffect(()=>{a&&f.current&&(f.current.focus(),f.current.select())},[a]);const m=h=>{u(h.target.value)},w=()=>{b.current=c},k=async()=>{S.current||await l(c),S.current=!1,r(!1)},j=h=>{(h.key==="Enter"||h.key==="Escape")&&h.preventDefault(),h.key==="Enter"?h.currentTarget.blur():h.key==="Escape"&&(u(b.current),S.current=!0,h.currentTarget.blur())};return e.jsx("input",{className:"w-[300px] rounded-lg border-none px-3 py-2 outline-hidden focus:ring-0",ref:f,value:c,onChange:m,onFocus:w,onBlur:k,onKeyDown:j,style:{fontSize:"1.125rem",boxSizing:"border-box",backgroundColor:"var(--global-states-light-element-hover, rgba(0, 0, 0, 0.05))"}})};function Vo(t){const{voiceName:n}=Ln(),s=t?()=>ei(t.textdocId,n,Bn()):null,a="".concat(t==null?void 0:t.textdocId,".").concat(t==null?void 0:t.versionInt,".").concat(n);return On(s,a)}function ei(t,n,s){return xe.safeGet("/textdoc/{textdoc_id}/synthesize",{parameters:{path:{textdoc_id:t},query:{voice:n,format:s}},skipJsonTransform:!0})}const ti=({textdocVersion:t,isPersisting:n=!1,isTextdocAttachedPending:s,isTextdocStreaming:a,hasDebug:r,shouldShowPlayButton:i=!1,hideRenameButton:o=!1,toggleDebugView:l,isDebugVisible:c,toggleConsoleVisibility:u,isConsoleOpen:f,clientThreadId:b})=>{var L,U;const S=F();Hn(),Vo(t);const[m,w]=d.useState(!1),k=(L=t==null?void 0:t.title)!=null?L:"",j=(U=ks(b))!=null?U:"",h=nt(t==null?void 0:t.textdocId),p=!k||(h==null?void 0:h.status)===Un.INFERRING,T=()=>{w(!0)},[x,P]=d.useState(!1),{container:C,triggerRef:_}=As({isOpen:x,onClose:()=>P(!1)}),I=[!h&&!o&&!a?e.jsx(H.Item,{icon:Fn,onClick:T,children:S.formatMessage({id:"z/PT9T",defaultMessage:"Rename"})},"rename"):null,null,i?e.jsx(H.Item,{icon:Gn,onClick:u,children:f?S.formatMessage({id:"owGHqE",defaultMessage:"Close console"}):S.formatMessage({id:"GPb4WX",defaultMessage:"Open console"})},"console"):null,null].filter(Boolean);if(I.length===0)return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex h-6 grow items-center overflow-hidden",children:e.jsx(Ee.Title,{className:"@[0px]:hidden @[150px]:block",children:p?e.jsx("div",{className:"w-52",children:e.jsx(ds,{lines:1,size:"base",width:100,widthVariance:0})}):k})}),n&&e.jsx(bt,{size:12,className:"text-token-text-tertiary ps-1"})]});const N=t&&e.jsx(H.Portal,{container:C,children:e.jsx(H.Content,{onCloseAutoFocus:X=>X.preventDefault(),children:I})});return e.jsx(e.Fragment,{children:m?e.jsx($o,{serverThreadId:j,textdocVersion:t,initialTitle:k,isEditingTitle:m,setIsEditingTitle:w}):e.jsxs(e.Fragment,{children:[!1,e.jsxs(H.Root,{open:x,onOpenChange:P,children:[e.jsxs(H.Trigger,{ref:_,className:"hover:bg-token-surface-hover grid grid-cols-[1fr_auto] border-none bg-transparent! pe-2",children:[e.jsx(Ee.Title,{className:"max-w-[270px] truncate overflow-hidden",children:p?e.jsx("div",{className:"w-52",children:e.jsx(ds,{lines:1,size:"base",width:100,widthVariance:0})}):k}),e.jsx("div",{className:"flex items-center ps-1",children:n?e.jsx(bt,{size:12,className:"text-token-text-tertiary"}):e.jsx(qn,{className:"icon-sm text-token-text-tertiary"})})]}),N]})]})})};function si({textdocVersion:t,clientThreadId:n,color:s}){const{handleCopy:a,Icon:r,copyLabel:i}=Ka({textdocVersion:t,clientThreadId:n});return e.jsx(Ne,{label:i,children:e.jsx(Fe,{icon:r,onClick:a,color:s})})}function ni({textdocVersion:t,disabled:n,clientThreadId:s}){const a=F(),{handleFileDownload:r,handleBlobDownload:i,isLoading:o,downloadCopyLabel:l,isDocument:c}=za({textdocVersion:t,clientThreadId:s});return c?e.jsxs(H.Sub,{children:[e.jsx(H.SubMenuTrigger,{icon:es,label:l,disabled:o||n}),e.jsx(H.Portal,{children:e.jsxs(H.SubContent,{align:"end",children:[e.jsx(H.Item,{onClick:u=>{u.preventDefault(),r("pdf")},children:a.formatMessage({id:"canvas.download-pdf-button.menu",defaultMessage:"PDF Document (.pdf)"})}),e.jsx(H.Item,{onClick:u=>{u.preventDefault(),r("docx")},children:a.formatMessage({id:"canvas.download-docx-button.menu",defaultMessage:"Microsoft Word Document (.docx)"})}),e.jsx(H.Item,{onClick:u=>{u.preventDefault(),r("md")},children:a.formatMessage({id:"canvas.download-md-button.menu",defaultMessage:"Markdown Document (.md)"})})]})})]}):e.jsx(H.Item,{label:l,icon:es,disabled:o||n,onClick:i})}function ai(t){for(const n of oi){const s=t.match(n);if(s)return s[0]}return null}const oi=[/AKIA[0-9A-Z]{16}/,/AIza[0-9A-Za-z_-]{35}/,/^(?:ghp_[A-Za-z0-9]{36}|github_pat_[A-Za-z0-9]{22}_[A-Za-z0-9]{59}|gho_[A-Za-z0-9]{36}|ghu_[A-Za-z0-9]{36}|ghs_[A-Za-z0-9]{36}|ghr_[A-Za-z0-9]{36})$/,/xox[baprs]-[0-9A-Za-z-]+/,/sk-[A-Za-z0-9]{48}/,/SK[0-9a-fA-F]{32}/,/(sk_live_[0-9a-zA-Z]{24})|(sk_test_[0-9a-zA-Z]{24})/,/-----BEGIN PRIVATE KEY-----/],ii="".concat(yo,"...");function Re(t){return["canvas","textdoc","share",t]}function ri({isLoading:t,isPublishedVersionLatest:n,sharedTextdoc:s,textdocVersion:a,title:r}){const{textdocId:i}=a,[o,l]=d.useState(!1),c=ai(a.content),u=(C,_)=>{C&&Jn(C,void 0,_).then(()=>{l(!0),setTimeout(()=>{l(!1)},1500)}).catch(()=>{})},f=st(),{mutate:b,isPending:S}=De({scope:{id:i},mutationFn:C=>xe.safePost("/textdoc/{textdoc_id}/share",{parameters:{path:{textdoc_id:C}}}).then(_=>Ve(_.shared_textdoc)),onSuccess:C=>{f.setQueryData(Re(i),C),u(vt(C.sharedTextdocId))}}),{mutate:m,isSuccess:w}=De({scope:{id:i},mutationFn:C=>xe.safePost("/textdoc/shared/{shared_textdoc_id}/update_to_latest",{parameters:{path:{shared_textdoc_id:C}}}).then(_=>Ve(_.shared_textdoc)),onSuccess:C=>{f.setQueryData(Re(i),C)}}),{mutate:k}=De({scope:{id:i},mutationFn:({sharedTextdocId:C,access:_})=>xe.safePost("/textdoc/shared/{shared_textdoc_id}/update_access",{parameters:{path:{shared_textdoc_id:C}},requestBody:{shared_textdoc_access:_}}).then(I=>Ve(I.shared_textdoc)),onMutate:({access:C})=>{const _=Re(i),I=f.getQueryData(_);return f.setQueryData(_,I&&pe(he({},I),{access:C})),{previousAccess:I==null?void 0:I.access}},onSuccess:C=>{f.setQueryData(Re(i),C)},onError:(C,_,I)=>{const N=Re(i),L=f.getQueryData(N);f.setQueryData(N,L&&pe(he({},L),{access:I==null?void 0:I.previousAccess}))}}),j=d.useRef(null),h=C=>{var _;(_=j.current)==null||_.focus(),s?(q.logButtonClick(te.COPY_SHARE_LINK,Ue(a)),u(vt(s.sharedTextdocId),C)):(q.logButtonClick(te.CREATE_SHARE_LINK,Ue(a)),b(i))},p=C=>{s&&(q.logButtonClick(C===Yn.PUBLIC?te.UPDATE_SHARE_LINK_PUBLIC:te.UPDATE_SHARE_LINK_PRIVATE,Ue(a)),k({sharedTextdocId:s.sharedTextdocId,access:C}))},T=s?vt(s.sharedTextdocId):void 0,x=()=>{s&&(q.logButtonClick(te.UPDATE_SHARE_LINK_TO_LATEST,Ue(a)),m(s.sharedTextdocId))},P=c||(s==null?void 0:s.isAnonifyApiKeyDetected);return e.jsx(bo,{inputRef:j,isLoading:t,isPublishedVersionLatest:n,sharedObject:s&&{id:s.sharedTextdocId,title:r,access:s.access,versionInt:s.versionInt,isModerationBlocked:s.isModerationBlocked,isAnonifyApiKeyDetected:s.isAnonifyApiKeyDetected},title:r,shareTextPlaceholder:ii,shareUrl:T,isCopySuccessful:o,didPublishUpdates:w,isCreateLinkRequestInProgress:S,handleUpdateLatestSharedVersion:x,handlePrivacyChange:p,handlePrimaryButtonClick:h,maybeRenderWarndingContent:()=>e.jsx(e.Fragment,{children:P&&e.jsx(ci,{})})})}function Ue(t){return{textdocType:t.type,textdocId:t.textdocId}}function li({textdocVersion:t,isDisabled:n,title:s}){const a=_a(),r=F(),i=t==null?void 0:t.textdocId,{data:o,isLoading:l}=ws({enabled:!!i&&!n,queryKey:Re(i),queryFn:()=>!i||i.startsWith($n)?Promise.resolve(null):xe.safeGet("/textdoc/{textdoc_id}/share",{parameters:{path:{textdoc_id:i}}}).then(j=>j.shared_textdoc&&Ve(j.shared_textdoc))}),[c,u]=d.useState(!1),{triggerRef:f,container:b}=As({isOpen:c,onClose:()=>u(!1)}),S=(a==null?void 0:a.isWorkspaceAccount())&&!(a!=null&&a.features.includes(Kn.WorkspaceShareLinks));if(n||S||!t)return e.jsx(Ne,{label:S?r.formatMessage(Ct.workspaceSharingDisabled):r.formatMessage(Ct.share),children:e.jsx(Fe,{disabled:!0,icon:ts})});const m=()=>{q.logButtonClick(te.OPEN_SHARE_MENU,Ue(t))},w=(o==null?void 0:o.versionInt)===t.versionInt&&(o==null?void 0:o.title)===t.title,k=({className:j})=>e.jsxs("div",{className:"relative h-fit w-fit",children:[e.jsx(ts,{className:j}),!w&&o&&e.jsx("div",{className:"absolute end-0 top-[1px] flex items-center gap-1.5",children:e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-blue-400"})})]});return e.jsxs(zn,{open:c,onOpenChange:u,children:[e.jsx(Ne,{label:r.formatMessage(Ct.share),children:e.jsx(Qn,{ref:f,asChild:!0,children:e.jsx(Fe,{icon:k,onClick:m})})}),e.jsx(_e,{children:c&&e.jsx(Wn,{forceMount:!0,container:b,children:e.jsx(Zn,{align:"end",className:"z-50",sideOffset:8,collisionPadding:8,children:e.jsx(ri,{title:s,sharedTextdoc:o,isLoading:l,isPublishedVersionLatest:w,textdocVersion:t})})})})]})}function ci(){return e.jsx(Xn,{type:"danger",className:"w-auto md:p-3",children:e.jsx(yt,{id:"8NG6sN",defaultMessage:"There may be an API key in your canvas. If you share the canvas, anyone with the link can see its contents."})})}function ui({disabled:t=!1,isShowingChanges:n,onMouseEnter:s,onClick:a,onEsc:r}){const i=F(),o=d.useRef(null);return d.useEffect(()=>{if(n){const l=c=>{c.key==="Escape"&&(r==null||r(),o.current&&o.current===document.activeElement&&o.current.blur())};return window.document.addEventListener("keydown",l),()=>{window.document.removeEventListener("keydown",l)}}},[n,r]),e.jsx(Ne,{label:!t&&i.formatMessage(n?Cs.hideChanges:Cs.showChanges),children:e.jsx(Fe,{icon:wo,ref:o,disabled:t,onClick:a,onMouseEnter:s,className:ae("transition-colors enabled:hover:bg-black/5 dark:enabled:hover:bg-white/10",n&&ho)})})}const Cs=bs({showChanges:{id:"3jMGNS",defaultMessage:"Show changes"},hideChanges:{id:"HWiQSk",defaultMessage:"Hide changes"}}),di=({clientThreadId:t,isHistoricalVersion:n,textdocVersion:s,readonlyReason:a,hasDebug:r,isEmbedded:i,isPersisting:o,isShowingChanges:l,hideRunCode:c=!1,hideHistoryActions:u=!1,hideRenameButton:f=!1,onHoverPrevious:b,onHoverShowChanges:S,onToggleShowChanges:m,onClickPrevious:w,onClickNext:k,onClickCodePreview:j,onClose:h,toggleDebugView:p,toggleConsoleVisibility:T,isCodeRunning:x,isTextdocAttachedPending:P,isTextdocStreaming:C,isConsoleOpen:_,isDebugVisible:I})=>{var $,G;const N=F(),L=Na(),U=nt(s==null?void 0:s.textdocId),X=($=s==null?void 0:s.title)!=null?$:"",{isCodePreviewable:se,isCodeExecutable:K,hasCanvasCodeExecution:z}=Ns(s),oe=(G=s==null?void 0:s.metadata)==null?void 0:G.hive_id,Q=Is(),M=oe!=null&&Rs(Q,"292227286"),{mutate:be,isPending:je}=De({scope:{id:oe!=null?oe:""},mutationFn:we=>xe.safePost("/hive/{hive_id}/send_summary_to_slack",{parameters:{path:{hive_id:we}}})}),Pe=()=>{oe&&be(oe)},W=!c&&(se||K),O=s==null?void 0:s.versionInt,Y=O!=null&&O>1,le=n,ce=!u,ue=se&&x,ke=s==null||U!=null||n||a.isStreaming,de=s==null||a.isStreaming;return e.jsxs(Ee.Header,{className:ae("@container",se&&x&&"bg-transparent!"),children:[e.jsx(Ee.CloseButton,{onClick:h}),e.jsx("div",{className:"@container flex flex-1 basis-0 items-center truncate leading-[0]",children:e.jsx(ti,{hasDebug:r,isConsoleOpen:_,isDebugVisible:I,toggleConsoleVisibility:T,toggleDebugView:p,isPersisting:o,textdocVersion:s,isTextdocAttachedPending:P,isTextdocStreaming:C,shouldShowPlayButton:W,hideRenameButton:f,clientThreadId:t})}),e.jsxs("div",{className:"flex min-w-0 basis-auto items-center leading-[0] select-none",children:[e.jsx(si,{clientThreadId:t,textdocVersion:s}),e.jsx(li,{isDisabled:ke,textdocVersion:s,title:X}),ce&&e.jsx(_e,{children:e.jsx(B.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,width:0},transition:{type:"spring",bounce:.24,duration:.4},children:e.jsx(ui,{disabled:ue||a.isStreaming||!Y,isShowingChanges:l,onMouseEnter:S,onClick:m,onEsc:m})})}),e.jsxs(H.Root,{children:[e.jsx(H.BasicTrigger,{children:e.jsx(Fe,{icon:Pa})}),e.jsx(H.Portal,{children:e.jsxs(H.Content,{align:"end",children:[e.jsx(H.Item,{icon:Vn,disabled:!Y,onClick:w,onMouseOver:b,label:N.formatMessage({id:"PoD5+8",defaultMessage:"Previous version"})}),e.jsx(H.Item,{icon:ea,disabled:!le,onClick:k,label:N.formatMessage({id:"PJ8YVJ",defaultMessage:"Next version"})}),e.jsxs(H.Group,{children:[s&&s.type!==Be.LOADING&&U==null&&e.jsx(ni,{disabled:de,textdocVersion:s,clientThreadId:t}),M&&e.jsx(H.Item,{icon:La,disabled:je,onClick:Pe,label:N.formatMessage({id:"CRHbjv",defaultMessage:"Send to Slack"})})]})]})})]}),W&&e.jsx(ro,{clientThreadId:t,isCodePreviewable:se,isDisabled:!z||a.isTextdocStreaming&&!x,disabledTooltip:z?void 0:N.formatMessage({id:"NTZRWe",defaultMessage:"Code execution for canvas is disabled for your workspace. Contact your admin to enable."}),onClick:j,isCodeRunning:x}),!i&&!L&&e.jsx(So,{clientThreadId:t})]})]})};function mi(t){const n=/\[([^\]]+)\]\((https?:\/\/[^\s)]+|www\.[^\s)]+)\)/gi,s=new Set,a=t.matchAll(n);for(const r of a){const i=r[2];try{let o=i;o.startsWith("www.")&&(o="http://"+i),new URL(o),s.add(i)}catch(o){}}return s}const fi=async({lastVersion:t,textdocId:n,content:s,comments:a})=>{const r=ta(a,s);return(await xe.safePost("/textdoc/{textdoc_id}",{parameters:{path:{textdoc_id:n}},requestBody:{version:t,content:s,comments:r}})).version},gi=()=>{const t=d.useRef([]),n=d.useRef(null),{mutateAsync:s,isPending:a}=De({mutationKey:["canvas","textdoc","persist"],mutationFn:fi});return[d.useCallback(async(i,o,l)=>{const c=new AbortController,f=(async()=>{var k,j;const[w]=t.current;try{await(w==null?void 0:w.promise)}catch(h){q.logError("Saving document",h)}if(!c.signal.aborted)try{const h=Math.max((k=n.current)!=null?k:0,(j=i.versionInt)!=null?j:Ts);let p="";try{hs(o)?p=o():p=o}catch(C){q.logError("Serializing document",C)}let T=[];try{hs(l)?T=l():T=l}catch(C){q.logError("Adjusting comments",C)}const{textdocId:x}=i;sa({textdocId:x,basedOnVersionInt:h,content:p,comments:T});const P=await s({textdocId:x,lastVersion:h,content:p,comments:T});na({textdocId:x,basedOnVersionInt:h,newVersion:P}),n.current=P}catch(h){q.logError("Error saving document",h)}finally{t.current.shift()}})(),b={abort:()=>c.abort(),promise:f},[S,m]=t.current;return m&&(m.abort(),t.current=S?[S]:[]),t.current=S?[S,b]:[b],f},[s]),t,a]},hi=3e3,pi=t=>{const[n,s,a]=gi(),r=F(),i=d.useRef(null),o=d.useCallback(Oa(async(u,f,b)=>{if(!wt(u))return n(u,f,b);et.replaceTempTextdocContent(u.textdocId,typeof f=="string"?f:f())},hi,{leading:!1}),[n]),l=aa(t);return d.useEffect(()=>{if(!l)return;const u=St(window,{pagehide:()=>o.flush(),beforeunload:b=>{o.flush(),b.returnValue=r.formatMessage({id:"QZrKwi",defaultMessage:"You have a canvas save in progress."})}}),f=St(document,{visibilitychange:()=>o.flush(),keydown:()=>{i.current="keyboard"},mousemove:()=>{i.current!=="mouse"&&o.flush(),i.current="mouse"}});return()=>{i.current=null,f(),u()}},[r,l,o]),d.useEffect(()=>()=>{o.flush()},[t,o]),oa(async()=>{var u,f;await o.flush(),await Promise.allSettled((f=(u=s.current)==null?void 0:u.map(({promise:b})=>b))!=null?f:[])}),[d.useCallback((u,f,b)=>{const{textdocId:S}=u;return wt(u)||ia(S),o(u,f,b)},[o]),o.flush,a||l]};function xi(t,n,s){const a=st(),r=s!=null&&n!=null,{data:i,error:o,fetchNextPage:l,hasNextPage:c,isFetching:u}=dn(ys(t,n,r)),f=d.useCallback(async()=>{const k=n!=null;await a.prefetchInfiniteQuery(ys(t,n,k))},[a,t,n]);d.useEffect(()=>{const k=n;return()=>{a.removeQueries({queryKey:Ls(t,k),exact:!0})}},[a,t,n]);const[b,S,m,w]=d.useMemo(()=>{var j;if(i&&s){const h=i.pages.flatMap(T=>T),p=h.findIndex(T=>{var x;return"beforeVersion"in s?((x=T.versionInt)!=null?x:Ts)<s.beforeVersion:T.versionInt===s.version});if(p!==-1)return[p===h.length-1,h[p],p>0?h[p-1]:null,p<h.length-1?h[p+1]:null]}const k=(j=i==null?void 0:i.pages.flatMap(h=>h))!=null?j:[];return[!0,null,null,k.length===0?null:k[0]]},[i,s]);return d.useEffect(()=>{!u&&r&&c&&b&&l()},[u,r,c,b,l]),d.useEffect(()=>{!S&&o&&He(t)},[S,o,t]),{historicalTextdocVersion:S,nextHistoricalTextdocVersion:m,prefetchHistoricalTextdocVersion:f,previousHistoricalTextdocVersion:w}}function Ls(t,n=null){return["textdocHistory",t,n]}function ys(t,n,s=!0){return{queryKey:Ls(t,n),queryFn:({pageParam:a})=>vi(t,a),initialPageParam:n!=null?n:void 0,getNextPageParam:a=>{var i;const r=(i=Ba(a))==null?void 0:i.versionInt;if(r&&r>1)return r},enabled:s,staleTime:1/0,retry:2}}async function vi(t,n){return n===void 0||n<=1?[]:(await xe.safeGet("/textdoc/{textdoc_id}/history",{parameters:{path:{textdoc_id:t},query:{before_version:n}}})).previous_doc_states.map(({id:a,version:r,textdoc_type:i,title:o,content:l,updated_at:c,comments:u,metadata:f})=>({textdocId:a,versionInt:r,messageId:null,title:o,type:la(i),content:l,status:Ss.COMPLETE,createdAt:Ha(c),comments:ra(u,l),metadata:{content_references:f==null?void 0:f.content_references,hive_id:f==null?void 0:f.hive_id}}))}const qi=({isFullScreen:t=!1,isEmbedded:n=!1,hideHeader:s=!1,hideRunCode:a=!1,isReadonlyFromQueryParam:r=!1,hideRenameButton:i=!1,clientThreadId:o,focusedTextdoc:l,onClose:c,isAnimating:u=!1,width:f,hideBottomComposer:b=!1})=>{"use no forget";var Wt,Zt,Jt,Yt;const S=Is(),{textdocId:m,history:w,showChangesAtVersion:k=null,shouldRunCodeOnOpen:j=!1}=Yo(l),h=F(),[p,T,x]=pi(m),{targetedContent:P}=ca(),C=ua(),[_,I]=d.useState(!1),[N,L]=d.useState(!1),U=da(m),X=ma(),se=Tt(o,Es.getRequestId),K=fa(se),{data:z,isLoading:oe}=ws(xt(m,k)),[Q,M]=d.useState(!1),[be,je]=d.useState(null),Pe=ga(o),W=d.useRef(null),O=(Wt=U==null?void 0:U.versions)!=null?Wt:[],Y=(Zt=O[0])==null?void 0:Zt.versionInt,{historicalTextdocVersion:le,nextHistoricalTextdocVersion:ce,previousHistoricalTextdocVersion:ue,prefetchHistoricalTextdocVersion:ke}=xi(m,Y,w),de=st();d.useEffect(()=>{tt.reset()},[m]);const $=O.length>0?O[O.length-1]:null,G=O.length>1?O[O.length-2]:null,we=ks(o),{restoreHistoricalTextdocVersion:Ge,optimisticRestoredTextdocVersion:rt}=ha(we,$,le),ve=w!=null,v=ve?le:$,V=k!=null,Ce=gn(o,v),Se=u?null:z,R=(()=>{if(u||v==null)return[];const y=ms(v.comments);return!V&&le!=null?le.comments:!V||z==null?y:z.contentBefore!==z.contentAfter?[]:Jo(z.commentsBefore,z.commentsAfter)})(),D=(Jt=v==null?void 0:v.type)!=null?Jt:Be.LOADING,Te=Qa({textdocVersion:v,clientThreadId:o}),qe=d.useCallback(()=>{var A,Z;const y=(Z=(A=window.getSelection())==null?void 0:A.toString())!=null?Z:"";Te({source:"keyboard",selectedText:y,productLogOnly:!0})},[Te]),me=pa(),ye=wt(v),ne=xa(v),Le=va(v),Mt=Ca(v),Os=Mt&&!n,Bs=gs(X),Hs=gs(K);d.useEffect(()=>{!ye&&O.length===0&&me!==ss.NATIVE&&(!X&&Bs.current||!K&&Hs.current||!X&&!K)&&(c==null||c())},[O.length,X,K]);const{content:ee,currentlyStreamingLineIndex:Ke}=(z==null?void 0:z.contentBefore)!=null&&!ns(D)?{content:z.contentBefore,currentlyStreamingLineIndex:null}:Wa(v,G),Us=ya(we,Array.from(mi(ee))),[ze,lt]=jo({value:ee,isRequestActive:K,isTextdocStreaming:ne,comments:R}),Et=ba(v),jt=me===ss.LAST_TURN||ze||x;d.useEffect(()=>{wa().sendMessage({type:_s.Streaming,streaming:jt})},[jt]);const Fs=({getSerializedDocument:y,getAdjustedComments:A})=>{v&&p(v,y,A)},Gs=y=>{var Z;if(!v)return;const A=y.doc.toString();p(v,A,(Z=y.field(Cn,!1))!=null?Z:[])},kt=(y,A,Z,ge,Ae)=>{lt(!0),Ce({sourceEvent:y,action:Z,content:A,userMessageType:Ye.ASK_CHATGPT,sourceRange:ge,selectionMetadata:{selection_type:Ae,selection_position_range:ge}})},At=({id:y})=>{Et(y,is.DISMISS),tt.reset()},It=async(y,A)=>{lt(!0);const{id:Z,at:ge,content:Ae}=A;if(await Et(Z,is.ACCEPT)===!1)return lt(!1);Ce({sourceEvent:y,content:Ae,userMessageType:Ye.ACCEPT_COMMENT,sourceRange:ge,action:J.EDIT,selectionMetadata:{selection_type:fs.SELECTION,selection_position_range:ge}})},ct=(y,A,Z,ge)=>{const{action:Ae}=ge;Ce({sourceEvent:y,action:Ae,content:Z,sourceRange:A,userMessageType:Ye.ACCELERATOR,acceleratorMetadata:{action:Ae,id:ge.id,prompt:Z},selectionMetadata:A!=null?{selection_type:fs.SELECTION,selection_position_range:A}:void 0})},qs=(y,A)=>{Ce({sourceEvent:y,action:J.EDIT,content:A,userMessageType:Ye.FULL_SCREEN_SUBMIT})},ut=Sa(),Rt=y=>{var A;return(A=ut==null?void 0:ut[y])!=null?A:y},dt=()=>Ta(o,void 0,{clientInitiated:!0,reason:"textdoc_canvas_cancel"}),Ks=()=>{w?Xe(m,w):He(m)},ie=lo({streamingSource:me,isRestoring:rt!=null,isRequestActive:K,isTextdocStreaming:ne,isReadonlyFromQueryParam:r,isHistoricalVersion:ve,isShowingChanges:V});let Qe=null;const Dt=u||ie.isReadonly||ze,We=Ms()||Pe||r||ye,_t=()=>u&&R.length>0?Ie.ALL_HIDDEN:We?Ie.COMMENTS_READONLY:ie.isReadonly?ie.isStreaming?Ie.ENABLED:ie.isReadonlyFromQueryParam||ie.isShowingChanges||ie.isHistoricalVersion?Ie.COMMENTS_READONLY:Ie.ALL_HIDDEN:Ie.ENABLED,zs=d.useCallback(async y=>{const{suggestion:A}=await xe.safePost("/textdoc/{textdoc_id}/autocomplete",{parameters:{path:{textdoc_id:m}},requestBody:{content:y}});return A},[m]),Nt=t||u||r;let mt=[];switch(D){case Be.LOADING:Qe=e.jsx(Ya,{});break;case Be.DOCUMENT:Qe=e.jsx(Ja,{value:ee,comments:R,previousValue:G==null?void 0:G.content,getAutocompleteSuggestion:zs,previousComments:ms(G==null?void 0:G.comments),isRewriting:Le,isAnimatingFromPreview:u,isSendDisabled:We,getStableCommentId:Rt,diff:Se,isRequestActive:K,isDisabled:ie.isReadonly||X,isWaitingForCommentResponse:ze,hideAccelerators:Nt,hideToolbar:Dt,hideEditOverlay:u,commentsMode:_t(),readonlyReason:ie,onBlur:T,onSave:T,onChange:Fs,onCancelRequest:dt,targetedContent:P,onAddComment:kt,onAcceptComment:It,onDismissComment:At,onSubmitAccelerator:ct,onExitShowChanges:Ks,safeUrls:Us,width:f,modelCursor:Mt||ne&&!Le?v==null?void 0:v.modelCursor:void 0,shouldResetSelection:(v==null?void 0:v.versionInt)===1,metadata:U==null?void 0:U.metadata}),mt=Ao;break;default:ns(D)&&(Qe=e.jsx(Za,{id:"codemirror",getStableCommentId:Rt,language:co(D),value:ee,comments:R,hideAccelerators:Nt,commentsMode:_t(),hideToolbar:Dt,onSubmitAccelerator:ct,currentlyStreamingLineIndex:Ke!=null?Ke:null,readonlyReason:ie,isRequestActive:K,isSendDisabled:We,isWaitingForCommentResponse:ze,onChange:Gs,onCancelRequest:dt,onAddComment:kt,onBlur:T,onSave:T,codemirrorRef:W,onDismissComment:At,onAcceptComment:It,textdocDiff:Se!=null?Se:void 0,modelCursor:ne&&Ke==null?v==null?void 0:v.modelCursor:void 0}),mt=Eo)}const Oe=d.useRef(null),ft=d.useRef(null),{hasCanvasCodeExecution:gt,isCodeExecutable:Pt,isCodePreviewable:fe}=Ns(v),Lt=gt&&fe,Ot=gt&&Pt,Qs=Ma(),Bt=d.useCallback(()=>{var y,A;!Q&&(Lt||Ot)?(M(!0),(y=Oe.current)==null||y.runCode(D,ee)):((A=Oe.current)==null||A.stopCode(),M(!1))},[Lt,Ot,Q,ee,D]),Ht=Ea(()=>{Bt()});d.useEffect(()=>{j&&Ht()},[j,Ht]);const re=v==null?void 0:v.versionInt,Ws=re!=null&&re>1,Zs=ve,Ze=ue==null?void 0:ue.versionInt,ht=ce==null?void 0:ce.versionInt,Js=()=>{V?w?Xe(m,w):He(m):(q.logButtonClick(te.SHOW_CHANGES,{textdocType:D,textdocId:m,versionInt:re,latestVersionInt:Y}),re&&rs(m,re,w))},Ys=()=>{q.logButtonClick(te.HISTORY_PREVIOUS,{textdocType:D,textdocId:m,versionInt:re,latestVersionInt:Y,isShowingChanges:V}),m&&re&&Ws&&Xe(m,{beforeVersion:re},V&&Ze!=null?Ze:void 0)},Xs=()=>{q.logButtonClick(te.HISTORY_NEXT,{textdocType:D,textdocId:m,versionInt:re,latestVersionInt:Y,isShowingChanges:V}),Zs&&(ht?Xe(m,{version:ht},V?ht:void 0):V&&Y?rs(m,Y,null):He(m))},$s=Rs(S,"1804926979"),Ut=Tt(o,To(m)),Vs=Ua(),Ft=nt(v==null?void 0:v.textdocId),en=!s&&e.jsx(di,{hideRunCode:a,clientThreadId:o,isHistoricalVersion:ve,textdocVersion:v,readonlyReason:ie,hasDebug:C,isEmbedded:n,isPersisting:x,isShowingChanges:V,isConsoleOpen:N,isDebugVisible:_,hideHistoryActions:r,hideRenameButton:i,onHoverPrevious:()=>{ke(),Ze&&de.prefetchQuery(xt(m,Ze))},onHoverShowChanges:()=>{ke(),re&&de.prefetchQuery(xt(m,re))},onToggleShowChanges:Js,onClickPrevious:Ys,onClickNext:Xs,toggleDebugView:()=>I(y=>!y),toggleConsoleVisibility:()=>{N||qa.logEvent("Canvas Open Console Clicked"),L(y=>!y)},onClose:()=>{if(q.logButtonClick(te.CLOSE_TEXTDOC,{textdocType:v==null?void 0:v.type}),Ft&&!t){const{create_source:y,hasUserEdits:A,tempTextdocId:Z}=Ft;if(A&&y!==os.USER_CREATED_COMPOSER){Kt(!0);return}if(et.removeTempTextdoc(Z),y===os.USER_CREATED_COMPOSER){const ge=Fa(Vs);Ga(ge,ee)}}c==null||c()},onClickCodePreview:Bt,isCodeRunning:Q,isTextdocStreaming:ne,isTextdocAttachedPending:as(v)});let Gt=null;const Je=!a&&gt&&(Pt||fe),pt=uo(D,ee);d.useEffect(()=>{var y;Je&&pt&&((y=ft.current)==null||y.prepareEnvironment(ee,pt))},[Je,pt]),d.useEffect(()=>{var y;fe&&Q&&!ne&&((y=Oe.current)==null||y.runCode(D,ee))},[fe,ne,ee,D]);const qt=(Yt=v==null?void 0:v.title)!=null?Yt:"";Je&&(Gt=e.jsx(hn,{id:m,title:qt,onChangeBackgroundColor:je,onCodeRunComplete:()=>M(!1),visuallyHidden:!fe||!Q,disableNetworkRequests:!Qs,networkAccessDeniedMessage:h.formatMessage({id:"GE4AJf",defaultMessage:"Network requests in canvas are disabled for your workspace. Contact your admin to enable this feature."}),enableTransition:fe&&D!==Be.CODE_HTML,isCodeUpdating:ne,ref:ft,onRetryCodeRun:()=>{var y;return(y=Oe.current)==null?void 0:y.runCode(D,ee)}}));const[tn,Kt]=d.useState(!1),zt=e.jsx(Mo,{isOpen:tn,dismissModal:()=>Kt(!1),closeTextdocEditor:()=>{c==null||c()},textdocVersion:v,clientThreadId:o}),Qt=e.jsxs(e.Fragment,{children:[en,e.jsx(Ee.Content,{scrollToBottomMode:Os?"bottom":"top",shouldScrollToTop:Le,isLoading:oe,hideChildren:fe&&Q,overlay:Gt,onCopy:qe,children:Qe}),Je&&e.jsx(pn,{ref:Oe,sandboxRef:ft,textdocId:m,textdocTitle:qt,textdocContent:ee,isTextdocAttachedPending:as(v),highlightLine:y=>{var A;return(A=W.current)==null?void 0:A.highlightLine(y)},isRequestActive:K,createTextdocTurn:Ce,isOpen:N,onOpenChange:L}),e.jsx(_e,{children:ve&&!r&&e.jsx(ko,{onClickRestore:Ge,onClickResetLatest:()=>He(m)})}),t&&!ve&&!b&&!(Q&&fe)&&!We&&e.jsx(Zo,{isRequestActive:K,clientThreadId:o,onSubmitAccelerator:ct,onSubmit:qs,onCancel:dt,readonlyReason:ie,acceleratorActions:mt})]});if($s&&Ut&&v){const A=new URLSearchParams(window.location.search).get(xn),Z=A==null?void 0:parseInt(A);return e.jsxs(e.Fragment,{children:[zt,e.jsx(Ee,{previewBackgroundColor:be,isPreviewingCode:fe&&Q,children:e.jsxs("div",{className:"flex h-full",children:[e.jsx("div",{className:"relative flex h-full min-h-0 flex-auto grow flex-col",children:Qt}),e.jsx(vn,{hiveId:Ut,clientThreadId:o,textdocVersion:v,ts:Z})]})})]})}return e.jsxs(e.Fragment,{children:[zt,e.jsx(Ee,{previewBackgroundColor:be,isPreviewingCode:fe&&Q,children:Qt})]})};export{_s as C,qo as D,qi as T,Eo as a,Gi as b,Ao as c,Io as g};
//# sourceMappingURL=gvh5p107yczbfviz.js.map
