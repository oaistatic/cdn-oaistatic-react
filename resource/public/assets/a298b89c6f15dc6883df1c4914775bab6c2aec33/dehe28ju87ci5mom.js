var A=Object.freeze,W=Object.defineProperty;var R=(t,a)=>A(W(t,"raw",{value:A(a||t.slice())}));import{b as B,u as D,r as v,g as K,f as H,j as e,M as u,a as V}from"./n75kuy1cx6f5mogg.js";import{c4 as Z,c5 as J,c6 as G,bv as X,c7 as Y,c8 as $,c9 as z}from"./ny10lj7zpuz89fvf.js";import{i as ee,r as se,P as b,a9 as U,C as te,H as re,B as oe,F as ae,f as ne,R as q,T as ie,ex as j}from"./ewse8exzafeu10ji.js";import{M as le,R as de,t as me}from"./ce2i59offcjvzu0m.js";import{T as x}from"./e0z6030ycsi62lhu.js";function ce({gizmo:t,memory:a}){var M;const l=B(),d=ne(),m=D(),{mutate:s,isPending:i}=V({mutationFn:async r=>{const{success:g}=await q.safeDelete("/memories/{memory_id}",{parameters:{path:{memory_id:r}},requestBody:{gizmo_id:t==null?void 0:t.id}});if(!g)throw new Error("An error occurred while deleting the memory")},onSettled:()=>{m.invalidateQueries({queryKey:G(t==null?void 0:t.id)})},onError:()=>{d.danger({id:"MemoriesModal.deleteFailed",defaultMessage:"Failed to forget memory",description:"Toast message when deleting memory fails"},{id:"memoryDeleteFailed",toastId:"memory_delete_failed"})}}),[f,y]=v.useState(!1),c=l.formatMessage({id:"N0czuB",defaultMessage:"Remove"});return e.jsxs(e.Fragment,{children:[e.jsxs(x.Row,{disabled:i,children:[e.jsx(x.Cell,{children:e.jsx("div",{className:"py-2 whitespace-pre-wrap",children:a.content})}),e.jsx(x.Cell,{textAlign:"right",children:e.jsx(x.Actions,{children:e.jsx("button",{onClick:()=>{b.logEvent("Memory Manage Modal Memory Delete Clicked"),y(!0)},"aria-label":c,className:"text-token-text-tertiary hover:text-token-text-secondary",children:e.jsx(ie,{className:"leading-none",label:c,side:"top",children:e.jsx(X,{className:"icon-sm"})})})})})]}),f&&e.jsx(Y,{isOpen:!0,primaryButtonColor:"danger",title:c,confirmText:l.formatMessage({id:"fCn0ar",defaultMessage:"Forget"}),onConfirm:()=>{b.logEvent("Memory Manage Modal Memory Delete Confirmed"),s(a.id),y(!1)},onClose:()=>{y(!1)},children:e.jsx(u,{id:"j2cZHW",defaultMessage:'Remove "{title}" from {name}’s saved memories. This can’t be undone. <link>Learn more</link>',values:{name:(M=t==null?void 0:t.name)!=null?M:"ChatGPT",title:e.jsx("strong",{children:me(a.content,{length:130,omission:"..."})}),link:r=>e.jsx("a",{href:"https://help.openai.com/en/articles/8590148-memory-faq",target:"_blank",className:"underline",rel:"noreferrer",children:r})}})})]})}function ue({selectedGizmoId:t,onSelect:a,items:l}){const d=l.find(s=>s.id===t);function m(s){var i;return e.jsx(z,{isFirstParty:s.id===void 0,src:(i=s.iconUrl)!=null?i:null,className:"icon"})}return e.jsx("div",{className:"border-token-border-medium mb-2 inline-flex rounded-md border",children:e.jsxs(j.Root,{children:[e.jsx(j.Trigger,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[d?e.jsxs(e.Fragment,{children:[m(d),e.jsx("span",{className:"text-token-text-primary",children:d.name})]}):e.jsx(u,{id:"MemoriesModal.unknownGizmo",defaultMessage:"Unknown GPT"}),e.jsx($,{className:"icon-sm text-token-text-tertiary"})]})}),e.jsx(j.Portal,{children:e.jsx(j.Content,{children:l.map(s=>e.jsxs(j.Item,{className:"flex items-center gap-3",onClick:()=>{a(s.id)},children:[m(s),s.name]},s.id))})})]})})}var L;const T=ae.div(L||(L=R(["flex h-full items-center justify-center pb-8 text-sm text-token-text-tertiary rounded-lg border border-token-border-default"])));function we({onClose:t,initialGizmoId:a}){var k,P,F,S;const l=B(),d=D(),m=Z(),[s,i]=v.useState(a),f=ee(),y=K(),c=se(f),M=c==null?void 0:c.hasPlusFeatures();v.useEffect(()=>{b.logEvent("Memory Modal Shown")},[]);const{data:r,isLoading:g,isError:w,refetch:_}=J(s,!0,m),h=r==null?void 0:r.memories,I=U(f,"684023316",{disableExposureLog:!0}).get("memory_almost_full_threshold",80),Q=(((k=r==null?void 0:r.memoryFullPct)!=null?k:0)>=I?U(f,"684023316").get("upsell_variant","control"):"control")!=="control",{data:C,refetch:O}=H({queryKey:["memory_gizmos"],queryFn:()=>q.safeGet("/memories/gizmos"),refetchOnMount:"always"}),N=[{id:void 0,name:"ChatGPT",iconUrl:null},...(P=C==null?void 0:C.items.map(({gizmo:o})=>{var E;return{id:o.id,name:o.display.name,iconUrl:(E=o.display.profile_picture_url)!=null?E:null}}))!=null?P:[]],n=N.find(o=>o.id===s);v.useEffect(()=>{!g&&!w&&s!==void 0&&(!h||h.length===0)&&i(void 0)},[g,w,h,s]);let p;return g?p=e.jsx(T,{children:e.jsx(u,{id:"MemoriesModal.loading",defaultMessage:"Loading..."})}):w?p=e.jsx(T,{children:e.jsxs("div",{className:"max-w-sm text-center",children:[e.jsx("div",{className:"mb-4 text-red-500",children:e.jsx(u,{id:"MemoriesModal.somethingWentWrong",defaultMessage:"Something went wrong..."})}),e.jsx("div",{children:e.jsx(oe,{color:"secondary",onClick:()=>{_()},children:e.jsx(u,{id:"MemoriesModal.retry",defaultMessage:"Retry"})})})]})}):!h||h.length===0?p=e.jsx(T,{children:e.jsx("div",{className:"max-w-sm text-center",children:m?e.jsx(u,{id:"MemoriesModal.noMemories.1",defaultMessage:"As you chat with {name}, the details and preferences it saves will be shown here.",values:{name:(F=n==null?void 0:n.name)!=null?F:"ChatGPT"}}):e.jsx(u,{id:"MemoriesModal.noMemoriesAndDisabled",defaultMessage:"Memory is disabled. ChatGPT won't use or save memories."})})}):p=e.jsx(x.Root,{className:"border-token-border-default h-full",size:"compact",bordered:!0,children:e.jsx(x.Body,{children:h.map(o=>e.jsx(ce,{gizmo:n?{id:n.id,name:n.name}:void 0,memory:o},o.id))})}),e.jsxs(te,{testId:"modal-memories",isOpen:!0,onClose:t,size:"custom",className:"max-w-5xl",type:"success",title:l.formatMessage({id:"MemoriesModal.title",defaultMessage:"Saved memories"}),showCloseButton:!0,children:[M&&N.length>1&&e.jsx("div",{className:"mb-4",children:e.jsx(ue,{selectedGizmoId:s,items:N,onSelect:o=>{d.invalidateQueries({queryKey:G(o)}),i(o)}})}),e.jsx(le,{memoryFullPct:r==null?void 0:r.memoryFullPct,isPaid:M,showUpgradeCTA:Q,onUpgrade:()=>{b.logEventWithStatsig("Memories Upgrade Button Clicked","chatgpt_memories_upgrade_button_clicked_settings"),re(y,"chatgpt_memories_upgrade_button")},className:"mb-5"}),e.jsx("div",{className:"h-[24rem]",children:p}),e.jsx("div",{className:"mt-5 flex justify-end",children:e.jsx(de,{onReset:()=>{_(),O(),s&&i(void 0)},gizmoId:s,memoryName:(S=n==null?void 0:n.name)!=null?S:"ChatGPT"})})]})}export{we as default};
//# sourceMappingURL=dehe28ju87ci5mom.js.map
