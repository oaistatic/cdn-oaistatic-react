var Q=Object.freeze,ae=Object.defineProperty,je=Object.defineProperties;var ve=Object.getOwnPropertyDescriptors;var Y=Object.getOwnPropertySymbols;var ke=Object.prototype.hasOwnProperty,be=Object.prototype.propertyIsEnumerable;var ee=(a,s,t)=>s in a?ae(a,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[s]=t,L=(a,s)=>{for(var t in s||(s={}))ke.call(s,t)&&ee(a,t,s[t]);if(Y)for(var t of Y(s))be.call(s,t)&&ee(a,t,s[t]);return a},se=(a,s)=>je(a,ve(s));var te=(a,s)=>Q(ae(a,"raw",{value:Q(s||a.slice())}));import{b as T,j as e,d as Me,m as oe,an as Ce,r as u,A as Se,M as G,R as Ne}from"./n75kuy1cx6f5mogg.js";import{ex as C,E as ie,P as A,dT as Ee,dU as Ie,jg as Re,e as g,_ as Pe,dV as Le,dX as Be,d$ as Ae,F as Te,dZ as Ue,d_ as ye,f as De,i as le,r as de,aS as q,aR as V,aT as We,J as $e,R as Fe,at as X}from"./ewse8exzafeu10ji.js";import{dW as z,f as Ge,k0 as Xe,bC as He,k1 as w,aq as qe,dN as Ve}from"./ny10lj7zpuz89fvf.js";import{X as ze,L as Je,R as Oe}from"./h8ubb8pbx4cc6fvw.js";import{u as Ze}from"./ggf5upe1rvhe0y6r.js";import{d as ne}from"./kl7c6054usfnqmd4.js";import{g as Ke}from"./k97n0y6ba9c9h39c.js";const H=Me({download:{id:"postSharingModal.download",defaultMessage:"Download"},downloadPdfButtonMenu:{id:"postSharingModal.download-pdf-button.menu",defaultMessage:"PDF Document (.pdf)"},downloadDocxButtonMenu:{id:"postSharingModal.download-docx-button.menu",defaultMessage:"Microsoft Word Document (.docx)"}}),Qe=({downloading:a,onOdysseyFileDownload:s,disabled:t,icon:r,label:d,odysseyShareIntent:n})=>{const o=T();return n.fileName.endsWith("md")?e.jsxs(C.Root,{open:!t&&!a?void 0:!1,children:[e.jsx(C.BasicTrigger,{asChild:!0,children:e.jsxs("button",{onClick:()=>{A.logEventWithStatsig("Share Post: Social Clicked","chatgpt_post_share_link_social_clicked",{platform:"download"})},disabled:t,className:"relative flex flex-col gap-y-4 disabled:opacity-50 max-sm:gap-y-2",children:[e.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-full shadow-lg max-sm:h-12 max-sm:w-12 max-sm:shadow-md dark:shadow-md",children:e.jsx("div",{className:"pointer-events-none flex h-8 w-8 items-center justify-center max-sm:h-6 max-sm:w-6",children:a?e.jsx(ie,{}):r})}),e.jsx("div",{className:"w-full text-center text-xs",children:d})]})}),e.jsx(C.Portal,{children:e.jsxs(C.Content,{align:"end",children:[e.jsx(C.Item,{onClick:i=>{i.preventDefault(),s==null||s(n.fileName,n.fileId,n.messageId,"pdf")},children:o.formatMessage(H.downloadPdfButtonMenu)}),e.jsx(C.Item,{onClick:i=>{i.preventDefault(),s==null||s(n.fileName,n.fileId,n.messageId,"docx")},children:o.formatMessage(H.downloadDocxButtonMenu)})]})})]},"download"):e.jsxs("button",{onClick:()=>{s==null||s(n.fileName,n.fileId,n.messageId,null),A.logEventWithStatsig("Share Post: Social Clicked","chatgpt_post_share_link_social_clicked",{platform:"download"})},disabled:t,className:"relative flex flex-col gap-y-4 disabled:opacity-50 max-sm:gap-y-2",children:[e.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-full shadow-lg max-sm:h-12 max-sm:w-12 max-sm:shadow-md dark:shadow-md",children:e.jsx("div",{className:"pointer-events-none flex h-8 w-8 items-center justify-center max-sm:h-6 max-sm:w-6",children:e.jsx(z,{})})}),e.jsx("div",{className:"w-full text-center text-xs",children:o.formatMessage(H.download)})]},"download")};function Ye({className:a,children:s,position:t="center",size:r,removePopoverStyling:d=!1,shadow:n="normal"}){const o=Ce(),i=T(),f=Math.random()*40-20;return u.useEffect(()=>{o.start({x:0,y:0,rotate:0,opacity:1,transition:{type:"spring",duration:.6,bounce:.15}})},[o]),e.jsx(oe.div,{initial:{x:0,y:"100%",rotate:0,opacity:1},animate:o,exit:{x:0,y:"100%",rotate:f,opacity:1},transition:{type:"spring",duration:.6,bounce:.15},className:g("z-50 h-full w-full overflow-y-auto",r!=="fullscreen"&&"grid grid-cols-[10px_1fr_10px]",r!=="fullscreen"&&t==="center"&&"grid-rows-[minmax(10px,1fr)_auto_minmax(10px,1fr)] md:grid-rows-[minmax(20px,1fr)_auto_minmax(20px,1fr)]",r!=="fullscreen"&&t==="bottom"&&"grid-rows-[minmax(10px,1fr)_auto_10px] md:grid-rows-[minmax(20px,1fr)_auto_20px]"),children:e.jsx(Be,{className:g(!d&&"popover","bg-token-sidebar-surface relative start-1/2 col-auto col-start-2 row-auto row-start-2 h-full w-full min-w-0 gap-4 p-4 text-start ltr:-translate-x-1/2 rtl:translate-x-1/2 dark:bg-[#171717]",r!=="fullscreen"&&"rounded-[36px]",n==="normal"&&"shadow-[0_32px_48px_rgba(0,0,0,0.175),_0_0_1px_rgba(0,0,0,0.2)] dark:shadow-[0_32px_48px_rgba(0,0,0,0.175),_0_0_1px_rgba(255,255,255,0.4)]",a),"aria-description":i.formatMessage({id:"slide-up-modal.share-sheet.description",defaultMessage:"Share sheet"}),"aria-describedby":"",children:s})})}function ea({isOpen:a,onClose:s,children:t,shouldIgnoreClickOutside:r=!1,className:d}){var n;return e.jsx(Ee,{open:a,onOpenChange:o=>{r||o===!1&&s(!1)},children:e.jsx(Ie,{container:(n=Re())==null?void 0:n.document.body,children:e.jsx("div",{className:g("absolute inset-0",d),children:t})})})}function aa({className:a,children:s,showBackground:t=!0}){const r=Pe(),d=t?r?"rgba(0, 0, 0, 0.8)":"rgba(249,249,249,0.8)":"rgba(0, 0, 0, 0)";return e.jsx(Le,{asChild:!0,children:e.jsx(oe.div,{initial:{backdropFilter:"blur(0px)",backgroundColor:r?"rgba(0, 0, 0, 0)":"rgba(255, 255, 255, 0)"},animate:{backdropFilter:t?"blur(4px)":"blur(0px)",backgroundColor:d},exit:{backdropFilter:"blur(0px)",backgroundColor:r?"rgba(0, 0, 0, 0)":"rgba(255, 255, 255, 0)"},className:g("fixed inset-0 z-50",a),children:s})})}function sa({title:a,description:s,icon:t,type:r}){return e.jsxs("div",{className:"flex max-w-full min-w-0 items-center",children:[e.jsx(na,{icon:t,type:r}),e.jsxs("div",{className:"flex max-w-full min-w-0 grow flex-col gap-1",children:[a!=null&&e.jsx(Ue,{className:"text-token-text-primary text-3xl leading-6 font-semibold tracking-tight max-sm:text-xl",children:a}),s!=null&&e.jsx(ye,{className:"text-token-text-tertiary text-sm",children:s})]})]})}function ta({title:a,accessory:s,description:t,withSeparator:r=!0,icon:d,type:n,closeButton:o,textCenter:i}){return!a&&!t?null:e.jsxs(ra,{$hasSeparator:r,children:[e.jsx("div",{className:g("flex max-w-full",i&&"flex-1 justify-center text-center"),children:e.jsx(sa,{title:a,description:t,icon:d,type:n})}),e.jsxs("div",{className:"flex items-center gap-5",children:[s,o!=null&&e.jsx(Ae,{asChild:!0,className:"sm:mt-0",children:o})]})]})}const na=({type:a,icon:s})=>s==null?null:e.jsx("div",{className:g("me-4 flex h-12 w-12 shrink-0 items-center justify-center rounded-full sm:h-10 sm:w-10",a==="danger"&&"bg-red-100",a==="warning"&&"bg-yellow-100",a==="success"&&"bg-green-100"),children:e.jsx(s,{className:g("icon-lg",a==="danger"&&"text-red-600",a==="warning"&&"text-yellow-700",a==="success"&&"text-green-700"),"aria-hidden":"true"})});var re;const ra=Te.div(re||(re=te(["px-4 pb-2 sm:p-6 flex items-center justify-between ",""])),({$hasSeparator:a})=>a&&"border-b border-black/10 dark:border-white/10"),B={Root:ea,Overlay:aa,Content:Ye,Header:ta};function oa({showLinkCopied:a,isGeneratingShareLink:s,onClick:t,postText:r,showDownloadButton:d,odysseyShareIntent:n,isDownloadingOdyssey:o,onOdysseyFileDownload:i,disabled:f}){const x=T(),I=le(),S=de(I),R=S==null?void 0:S.isWorkspaceAccount();let _=[{id:"copy",icon:s?e.jsx(ie,{}):e.jsx(qe,{}),label:a?x.formatMessage(w.linkCopied):x.formatMessage(w.copyLink),action:"copy"}];R?d&&_.push({id:"download",icon:e.jsx(z,{}),label:x.formatMessage({id:"postSharingModal.download",defaultMessage:"Download"}),action:"download"}):_=_.concat({id:"x",href:c=>"https://twitter.com/intent/tweet?url=".concat(encodeURIComponent(c),"&text=").concat(r?encodeURIComponent(r):""),icon:e.jsx(ze,{initialFillColor:"var(--text-primary)"}),label:x.formatMessage({id:"postSharingModal.x",defaultMessage:"X"}),action:"share"},{id:"linkedin",href:c=>"https://www.linkedin.com/shareArticle?url=".concat(encodeURIComponent(c),"&text=").concat(r?encodeURIComponent(r):""),icon:e.jsx(Je,{initialFillColor:"var(--text-primary)"}),label:x.formatMessage({id:"postSharingModal.linkedin",defaultMessage:"LinkedIn"}),action:"share"},{id:"reddit",href:c=>"https://www.reddit.com/submit?url=".concat(encodeURIComponent(c),"&title=").concat(r?encodeURIComponent(r):""),icon:e.jsx(Oe,{initialFillColor:"var(--text-primary)"}),label:x.formatMessage({id:"postSharingModal.reddit",defaultMessage:"Reddit"}),action:"share"},...d?[{id:"download",icon:e.jsx(z,{}),label:x.formatMessage({id:"postSharingModal.download",defaultMessage:"Download"}),action:"download"}]:[]);const j=!!o;return e.jsx(e.Fragment,{children:_.map(c=>c.id==="download"&&n?e.jsx(Qe,{downloading:j,onOdysseyFileDownload:i,disabled:f!=null?f:!1,icon:c.icon,label:c.label,odysseyShareIntent:n},c.id):e.jsxs("button",{onClick:()=>{t(c),A.logEventWithStatsig("Share Post: Social Clicked","chatgpt_post_share_link_social_clicked",{platform:c.id})},disabled:f,className:"relative flex flex-col gap-y-4 disabled:opacity-50 max-sm:gap-y-2",children:[e.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-full shadow-lg max-sm:h-12 max-sm:w-12 max-sm:shadow-md dark:shadow-md",children:e.jsx("div",{className:"pointer-events-none flex h-8 w-8 items-center justify-center max-sm:h-6 max-sm:w-6",children:c.icon})}),e.jsx("div",{className:"w-full text-center text-xs",children:c.label})]},c.id))})}function ia(a,s){const t=q(a);return t?{id:"tmp",kind:"message_slice",messages:s.map(d=>{const n=V.findNode(t,({message:o})=>o.id===d);return n?n.message:null}).filter(Boolean)}:null}function la(a){return{id:"tmp",kind:"message_slice",messages:[a.previewMessage]}}function wa({postSharingData:a,onClose:s}){const{clientThreadId:t,postText:r,generateShareLinkFn:d,coverImageUrl:n,messageSliceIds:o,odysseyShareIntent:i}=a,f=u.useRef(void 0),[x,I]=u.useState(!1),[S,R]=u.useState(!1),_=T(),j=De(),[c,J]=u.useState(!0),ce=le(),U=de(ce),y=U==null?void 0:U.isWorkspaceAccount();u.useEffect(()=>{A.logEventWithStatsig("Share Post: Post Sharing Modal Shown","chatgpt_post_share_modal_shown")},[]),u.useEffect(()=>{f.current=void 0},[t]);const N=u.useMemo(()=>i?la(i):n||!o||o.length===0?null:ia(t,o),[n,t,o,i]),D=u.useMemo(()=>{const m=q(t);return m?V.getConversationTurns(m).flatMap(h=>h.messages):[]},[t]);u.useEffect(()=>{if(!o||o.length===0)return;const m=q(t);o.filter(p=>!V.findNode(m,({message:v})=>v.id===p)).length>0&&Ge(t)},[t,o]);const{hasImage:me,hasScreenshot:fe}=u.useMemo(()=>{let m=!1,h=!1;if(D.length){const p=D,v=/\.(jpe?g|png|gif|webp|bmp|tiff)$/i,E=k=>{if(!Array.isArray(k))return!1;for(const l of k)if(l.type==="image_inline"&&l.clicked_from_url&&(h=!0),l.type==="file"&&"file_name"in l){const M=l.file_name.toLowerCase();(M.endsWith(".pptx")||v.test(M))&&(m=!0)}};p.forEach(k=>{var P,O,Z,K;const l=k.metadata;if(!l)return;const M=[...Object.values((P=l.n7jupd_crefs_by_file)!=null?P:{}).flat(),...Object.values((O=l.content_references_by_file)!=null?O:{}).flat()],F=[...(Z=l.n7jupd_crefs)!=null?Z:[],...(K=l.content_references)!=null?K:[]];E(M),E(F)})}return{hasImage:m,hasScreenshot:h}},[D]),W=We(t),ue=async(m,h)=>{if(!(x||!W)&&W){if(!f.current){I(!0);try{const p=await d();p&&(f.current=p)}catch(p){j.danger(w.failedToGenerateShareLink,{toastId:"failed_to_generate_share_link"})}finally{I(!1)}}if(f.current){if(m.action==="copy")navigator.clipboard.writeText(f.current),R(!0),j.success(_.formatMessage(w.linkCopied)),setTimeout(()=>{R(!1)},3e3);else if(m.action==="share"&&m.href)window.open(m.href(f.current),"_blank","noopener,noreferrer");else if(m.action==="download"){if(!n)return;Ve({url:n,fileName:"".concat(r,".png")})}}}},xe=e.jsx("div",{className:g("flex w-full justify-center rounded-xl",n||N&&(i!=null&&i.isStandaloneAttachment)?"max-xs:max-h-[260px] h-[30vh] max-h-[550px] max-sm:max-h-[300px]":"aspect-[1200/630]",!n&&!(i!=null&&i.isStandaloneAttachment)&&"outline-token-border-light overflow-hidden shadow-sm outline outline-1"),children:n?e.jsx("img",{src:n,alt:r}):i!=null&&i.isStandaloneAttachment&&N?e.jsx(Xe,{attachments:[N],variant:"unfurl",className:"h-full w-full",clientThreadId:t}):N?e.jsx(He,{attachments:[N],clientThreadId:t,className:"h-full"}):null}),ge="normal",[he,$]=u.useState(!1),{presentationMap:pe}=Ze(),b=_.formatMessage(w.downloadFileError),we=async(m,h,p,v)=>{var k;const E=W;if(!(!m||!h||!E))if($(!0),m.endsWith("md")){if(!v)return;try{const l=await Fe.safePost("/export_doc/n7jupd",{requestBody:{conversation_id:E,message_id:p,file_id:h,export_type:v},skipJsonTransform:!0});l.ok||(j.danger(b,{toastId:"post_sharing_modal_download_error",loggingTitle:b,loggingDescription:"Error message when a file download fails"}),X.addError("post_sharing_modal_download_error",{statusText:l.statusText,status:l.status}));const M=await l.blob(),F=l.headers.get("Content-Disposition"),P=(k=Ke(F))!=null?k:"Agent.".concat(v);ne(M,P)}catch(l){j.danger(b,{toastId:"post_sharing_modal_download_error",loggingTitle:b,loggingDescription:"Error message when a file download fails"}),X.addError(l)}finally{$(!1)}}else{const l=pe[h];if(!l||!l.fileBlob){j.danger(b,{toastId:"post_sharing_modal_download_error",loggingTitle:b,loggingDescription:"Error message when a file download fails"}),X.addError("post_sharing_modal_download_error"),$(!1);return}ne(l.fileBlob,m)}},_e=e.jsxs(e.Fragment,{children:[e.jsx("div",{className:g("flex flex-wrap justify-center space-y-4 space-x-12 max-sm:space-x-6","mt-12 max-sm:mt-6"),children:e.jsx(oa,{showLinkCopied:S,isGeneratingShareLink:x,disabled:x,onClick:ue,postText:r,showDownloadButton:!!(n||i),odysseyShareIntent:i,isDownloadingOdyssey:he,onOdysseyFileDownload:we})}),da(me,fe,y!=null?y:!1)]});return e.jsx(Se,{onExitComplete:s,children:c&&e.jsx(B.Root,{isOpen:!0,onClose:()=>{J(!1)},className:"max-w-[664px] px-4",children:e.jsx(B.Overlay,{showBackground:!0,children:e.jsxs(B.Content,{size:"normal",position:"center",className:g("flex flex-col pb-4 focus:outline-hidden",{"max-w-[640px]":ge==="normal"}),removePopoverStyling:!1,shadow:"normal",children:[e.jsx(B.Header,{title:r,type:"success",closeButton:e.jsx($e,{onClick:()=>J(!1)})}),e.jsxs("div",{children:[e.jsx("div",{className:g("flex justify-center",!i&&"pointer-events-none"),children:xe}),_e]})]})})})})}function da(a,s,t){const r=[];return t&&r.push(e.jsx(G,L({},w.shareLinkVisibleToWorkspaceOnly),"workspace")),s&&r.push(e.jsx(G,L({},w.screenshotDisclaimer),"screenshot")),a&&r.push(e.jsx(G,se(L({},w.imageLicenseDisclaimer),{values:{nbsp:" ",link:d=>e.jsx("a",{href:"https://help.openai.com/",target:"_blank",rel:"noopener noreferrer",className:"underline",children:d})}}),"image")),r.length?e.jsx("p",{className:"text-token-text-tertiary text-center text-sm sm:mt-2",children:r.map((d,n)=>e.jsxs(Ne.Fragment,{children:[n>0&&e.jsx(e.Fragment,{children:" "}),d]},n))},"image-disclaimer"):null}export{wa as PostSharingModal};
//# sourceMappingURL=girr22kubt30vfxv.js.map
