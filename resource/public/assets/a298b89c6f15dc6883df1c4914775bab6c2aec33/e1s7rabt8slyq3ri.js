import{r as f,j as p,b as T}from"./n75kuy1cx6f5mogg.js";import{bG as M,$ as l,a0 as d,i as C,j as x,aY as _}from"./ewse8exzafeu10ji.js";import{CoTChunks as E}from"./brsl39gvuuglwjj6.js";import{gC as m}from"./ny10lj7zpuz89fvf.js";import"./gdvi3vhnli0o4q8m.js";import"./em5q5yhbyv41ft0j.js";import"./ou1s0kowmldvhx32.js";import"./ltsv6em2m484o9yy.js";import"./j0qx0vaadhi6g6bi.js";import"./ly9hghfho7bi4z70.js";import"./pbl95wx6493wq92j.js";import"./heyok871zyju5auh.js";import"./mfyrsje6hk3w0xmg.js";import"./n1zi1frmhwo1ei8c.js";import"./ltq3thvd9yhrdk52.js";const k=(n,e)=>{if(e<=1)return n.formatMessage({id:"ZxhUq1",defaultMessage:"a second"});if(e<3)return n.formatMessage({id:"4GD7tD",defaultMessage:"a couple of seconds"});if(e<4)return n.formatMessage({id:"jx5V1u",defaultMessage:"a few seconds"});if(e>=60){const o=Math.floor(e/60),s=e%60;return"".concat(o,"m ").concat(s,"s")}return n.formatMessage({id:"p4/pTg",defaultMessage:"{seconds} seconds"},{seconds:e})},y=n=>{var o,s;let e=0;for(const t of n)e+=(s=(o=t.metadata)==null?void 0:o.finished_duration_sec)!=null?s:0;return e},R=(n,e,o)=>{var s,t,r;return e.length>1?n.formatMessage({id:"sdDgmZ",defaultMessage:"Thought for {timing}"},{timing:k(n,o)}):(r=(t=(s=M(e))==null?void 0:s.metadata)==null?void 0:t.finished_text)!=null?r:""},I=(n,e,o=!1)=>{var h;const s=[];let t={type:m.Thought,thought:{summary:"",content:""}};const r=()=>{t.thought.content.trim()&&(s.push(t),t={type:m.Thought,thought:{summary:t.thought.summary,content:""}})},u=n.split(/( {2}\n)|(\n\n)/).filter(i=>i!=null&&i.trim());if(!o&&u.length<2)return s;let c=!1;for(let i=0;i<u.length;i++){const a=u[i].trim();if(a.toLowerCase()==="none"){l.count(d.COT_SUMMARIZER,"num_none_chunks");continue}const g=a.match(/^\*\*(.*)\*\*$/);if(g)r(),t.thought.summary=(h=g[1])!=null?h:"";else if(a){if(a.startsWith("```")){if(c){t.thought.content+=t.thought.content?"\n".concat(a):a,r(),c=!1;continue}r(),c=!0}t.thought.content.trim()&&!a.startsWith("\\[")&&!a.startsWith("\\(")&&!c&&r(),t.thought.content+=t.thought.content?"\n".concat(a):a}}return t!=null&&t.thought.content.trim()&&s.push(t),o&&e&&s.push({type:m.Recap,content:e}),s},S=(n,e,o)=>{const s=!o,t=f.useMemo(()=>I(n,e,s),[n,e,s]);return f.useEffect(()=>{s&&l.hist(d.COT_SUMMARIZER,"num_cot_chunks",void 0,t.length)},[s]),t},j=({isStreaming:n,finishedText:e,summaryText:o,isFinalAssistantTurn:s})=>{const t=S(o,e,n),[r,u]=f.useState(!1);return p.jsx(E,{isStreaming:n,isFinalAssistantTurn:s,chunks:t,isExpanded:r,setIsExpanded:u})},N=8,O="\n\n",Y=({messages:n,isStreaming:e,isFinalAssistantTurn:o})=>{const s=T(),t=C(),r=x(t,"1214379119"),u=y(n);let c="";return n.forEach(h=>{const i=_(h);c+=c?O+i:i}),r&&!e&&!c&&u<N?null:p.jsx(j,{finishedText:R(s,n,u),summaryText:c,isStreaming:e,isFinalAssistantTurn:o})};export{j as LegacyCoT,Y as LegacyCoTMessage};
//# sourceMappingURL=e1s7rabt8slyq3ri.js.map
