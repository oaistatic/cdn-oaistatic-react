var F=Object.defineProperty,G=Object.defineProperties;var j=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var v=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var S=(o,t,n)=>t in o?F(o,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[t]=n,m=(o,t)=>{for(var n in t||(t={}))v.call(t,n)&&S(o,n,t[n]);if(E)for(var n of E(t))q.call(t,n)&&S(o,n,t[n]);return o},R=(o,t)=>G(o,j(t));import{D as B,b as $,g as W,r as I,j as P,af as k,d as z}from"./n75kuy1cx6f5mogg.js";import{fm as r,i as K,oh as J,f as Y,oi as Q,lO as V,R as N,fl as _,ec as X,ee as Z,oj as ee,aE as h,lg as te,aD as ne,ok as w,P as M,ol as se,k as oe}from"./ewse8exzafeu10ji.js";import{g as ce}from"./gmmcfvs186kwwp97.js";import{C as re}from"./heyok871zyju5auh.js";const ae={OAUTH_SCOPES_MISMATCH:r.OAUTH_FAILED_SCOPE_MISMATCH,EMAIL_DOMAIN_CLAIMED_BY_ANOTHER_WORKSPACE:r.OAUTH_FAILED_EMAIL_DOMAIN_ENFORCEMENT},b=z({genericSuccess:{id:"connectorPlatformOauthRedirect.genericSuccess",defaultMessage:"{connector} is now connected"},slackAiAppSuccess:{id:"connectorPlatformOauthRedirect.slackAiAppSuccess",defaultMessage:"AI App for Slack is now installed"}}),pe=B(function(){const t=$(),n=K(),a=W(),g=V("installations/select_target"),p=J(),y=Y(),d=I.useRef(!1),{mutateAsync:U}=Q();return I.useEffect(()=>{if(d.current===!0)return;d.current=!0;async function L(){var A,C,O;const f=ce()==="popup"||p,D=window.location.href;try{const e=await N.safePost("/aip/connectors/links/oauth/callback",{requestBody:{full_redirect_url:D}});if(!(e!=null&&e.post_auth_url)){a(_(r.OAUTH_FAILED_GENERIC));return}const s=new URL(e.post_auth_url,location.origin),i=((A=e==null?void 0:e.link)==null?void 0:A.connector_id)===X[Z.GITHUB_CONNECTOR],u=s.searchParams.get("github_onboarding")==="sync-repos";if(i&&u){const c=await N.safePost("/aip/connectors/github/search_repos",{requestBody:{query:"",limit:20,next_token:null,link_id:e.link.id}});if(!c||c.repos.length===0){window.open("".concat(g,"?state=").concat(encodeURIComponent(JSON.stringify({client_redirect_to:"".concat(window.location.origin,"/?github_onboarding=sync-repos")}))),"_self");return}}const T=ee(s.hash)===h.Connectors;if(!T){const c=te[e.link.connector_id];c&&s.searchParams.set("add_source",c)}let l;if(T){const c=new URLSearchParams;c.set("connector",e.link.connector_id),i&&!u&&c.set("github_onboarding","configure-repos");const x=R(m({},s),{search:"",hash:ne(h.Connectors).hash+"?".concat(c.toString())});l=k(x)}else i&&!u&&s.searchParams.set("github_onboarding","configure-repos"),l=k({pathname:s.pathname,search:s.search,hash:s.hash});if(f){w({success:!0,connectorId:e.link.connector_id,linkId:e.link.id}),window.close();return}M.logEventWithStatsig("Connector OAuth Connect","chatgpt_connectors_oauth_connect_success",{success:!0,type:e.link.connector_id});const H=e.link.connector_id===se?t.formatMessage(b.slackAiAppSuccess):t.formatMessage(b.genericSuccess,{connector:e.link.name});a(_(r.CUSTOM_MSG,l,H))}catch(e){const s=e instanceof oe?(O=ae[(C=e.detail)==null?void 0:C.error_code])!=null?O:r.OAUTH_FAILED_GENERIC:r.OAUTH_FAILED_GENERIC;if(f){w({success:!1,connectorId:"",errorType:s}),window.close();return}M.logEventWithStatsig("Connector OAuth Connect","chatgpt_connectors_oauth_connect_error",{errorType:s,success:!1,type:"unknown"}),a(_(s,"#settings/".concat(h.Connectors)))}}L()},[n,p,g,t,a,y,U]),P.jsx("div",{className:"flex h-screen w-screen items-center justify-center",children:P.jsx(re,{size:36})})});export{pe as default};
//# sourceMappingURL=kk21w7aj30dmwjz0.js.map
