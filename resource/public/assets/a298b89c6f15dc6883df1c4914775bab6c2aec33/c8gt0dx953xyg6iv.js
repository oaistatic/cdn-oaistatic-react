var re=Object.freeze,ce=Object.defineProperty,Ee=Object.defineProperties;var Ve=Object.getOwnPropertyDescriptors;var oe=Object.getOwnPropertySymbols;var Ae=Object.prototype.hasOwnProperty,Te=Object.prototype.propertyIsEnumerable;var de=(e,t,n)=>t in e?ce(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,X=(e,t)=>{for(var n in t||(t={}))Ae.call(t,n)&&de(e,n,t[n]);if(oe)for(var n of oe(t))Te.call(t,n)&&de(e,n,t[n]);return e},J=(e,t)=>Ee(e,Ve(t));var te=(e,t)=>re(ce(e,"raw",{value:re(t||e.slice())}));import{b as ae,r as w,j as a,d as ve,A as De,m as ee,M as ge}from"./n75kuy1cx6f5mogg.js";import{jg as Pe,au as Oe,dT as Le,e0 as Fe,dU as Re,dV as Ge,dX as Be,e as V,d$ as ze,dG as We,B as K,fA as Ue,bp as me,eK as be,i as $e,y as He,bq as Ke,F as je,d as qe,h as Xe,bJ as Je,f5 as Qe,bK as Ye,an as Q,P as Y,iy as Z,f as Ze}from"./ewse8exzafeu10ji.js";import{dH as ea,jT as aa,fC as ta,cA as sa,i7 as na,cz as A,gs as ia,jU as la,jV as q,dv as ra,dw as _e,dc as oa,j7 as da,gu as ca,jW as ga,dS as ye,dU as Me,dW as Ce,jX as ma,bJ as ua,a3 as fa}from"./ny10lj7zpuz89fvf.js";import{S as xa}from"./eq0refymwif7pcpz.js";import{D as ke,u as ha,I as se}from"./wxk4ecobz1qzi6ic.js";import{D as pa}from"./mfyrsje6hk3w0xmg.js";const Ia={enter:e=>({zIndex:0,x:e===-1?"10%":"-10%",opacity:0}),center:{zIndex:1,x:0,opacity:1},exit:e=>({zIndex:0,x:e===1?"10%":"-10%",opacity:0})},wa={enter:{opacity:0,y:"10%"},visible:{opacity:1,y:0},exit:{opacity:0,y:"10%"}},ue=1e3,fe=1e3,xe=(e,t)=>Math.abs(e)*t;function va(e){var v,M;const t=ae(),n=Pe(),r=Oe(),[u,j]=w.useState({width:0,height:0}),[m,c]=w.useState(!1),[o,f]=w.useState(e.image),[I,k]=w.useState(!1),N=u.width>0&&u.height>0,y=w.useRef(null),[S,b]=w.useState(0);w.useEffect(()=>{if(!o.url)throw new Error("ExpandableImage requires a src");const s=new Image;s.onload=()=>{j({width:s.naturalWidth,height:s.naturalHeight})},s.onerror=()=>{},s.src=o.url},[o.url]),w.useEffect(()=>{const s=y.current;if(I)return s==null||s.addEventListener("keydown",d),()=>{s==null||s.removeEventListener("keydown",d)};f(e.image)},[I]);function l(){f(s=>{const h=(e.images.findIndex(p=>p.url===s.url)+1)%e.images.length;return e.images[h]}),b(-1)}function x(){f(s=>{const g=e.images.findIndex(p=>p.url===s.url),h=g>0?(g-1)%e.images.length:e.images.length-1;return e.images[h]}),b(1)}function i(s){var g;k(s),s&&((g=e.onOpen)==null||g.call(e,o))}function d(s){s.key==="ArrowLeft"?x():s.key==="ArrowRight"&&l()}const _=e.images.findIndex(s=>s.url===o.url);return a.jsxs(Le,{onOpenChange:i,children:[a.jsx(Fe,{disabled:!N,className:e.className,"aria-label":t.formatMessage(E.showImage),children:e.children}),a.jsx(Re,{container:n==null?void 0:n.document.body,children:a.jsx(Ge,{className:"radix-state-open:animate-show fixed inset-0 z-20 flex items-center justify-center bg-black/90 backdrop-blur-xl",children:a.jsxs(Be,{className:V("radix-state-open:animate-contentShow relative flex h-[100dvh] w-screen justify-stretch divide-x divide-white/10 focus:outline-hidden"),ref:y,children:[a.jsx("div",{className:V("flex flex-1 transition-[flex-basis]",!m&&"md:basis-[75vw]"),children:a.jsxs("div",{className:"flex flex-1 flex-col md:p-6",children:[a.jsxs("div",{className:"flex justify-between px-6 py-2 pt-6 text-white sm:mb-4 md:mt-2 md:px-0 md:py-2",children:[a.jsx(ze,{asChild:!0,children:a.jsx("button",{"aria-label":t.formatMessage(E.closeModal),children:a.jsx(We,{})})}),a.jsx("div",{children:r&&a.jsxs(a.Fragment,{children:[(M=(v=e.getActions)==null?void 0:v.call(e,o))==null?void 0:M.map((s,g)=>a.jsx(K,{color:"ghost",size:"small",onClick:s.onClick,"aria-label":s.ariaLabel,disabled:s.disabled,icon:s.icon},g)),a.jsx(K,{color:"ghost",size:"small",onClick:()=>c(s=>!s),"aria-label":t.formatMessage(E.toggleSidebar),className:"md:inline-flex",icon:Ue})]})})]}),a.jsx("div",{className:"relative flex flex-1 flex-col items-center justify-center overflow-hidden",children:a.jsx(De,{initial:!1,custom:S,children:a.jsxs(ee.div,{className:"absolute grid h-full w-full grid-rows-2",custom:S,variants:Ia,drag:"x",dragConstraints:{left:0,right:0},dragElastic:1,onDragEnd:(s,{offset:g,velocity:h})=>{const p=xe(g.x,h.x);p<-ue?l():p>ue&&x()},children:[a.jsx(ee.img,{src:o.url,alt:o.alt,className:"row-span-4 mx-auto h-full object-scale-down",onPanEnd:(s,{offset:g,velocity:h})=>{const p=xe(g.y,h.y);p<-fe?c(!0):p>fe&&c(!1)}},o.url),!r&&m&&a.jsx(ee.div,{className:"flex text-white",variants:wa,initial:"enter",animate:"visible",exit:"exit",transition:{y:{type:"spring",stiffness:300,damping:30},opacity:{duration:.2}},children:e.metadataRenderer(o)})]},o.url)})}),e.images.length>1?a.jsxs("div",{className:"flex items-center justify-center gap-4 p-8 text-white",children:[a.jsx(K,{color:"ghost",size:"small",onClick:x,"aria-label":t.formatMessage(E.previousImage),icon:ea}),e.images.map((s,g)=>{var h;return a.jsx("img",{src:s.url,alt:(h=s.alt)!=null?h:"",className:V("h-12 w-12 cursor-pointer rounded-sm object-cover transition duration-300 hover:opacity-100",s.url===o.url?"ring-2 ring-white ring-offset-4 ring-offset-black":"opacity-25"),onClick:()=>{f(s),b(g<_?1:-1)},"aria-label":t.formatMessage(E.showImage),role:"button"},s.url)}),a.jsx(K,{color:"ghost",size:"small",onClick:l,"aria-label":t.formatMessage(E.nextImage),icon:xa})]}):null]})}),a.jsx("div",{className:V("hidden items-center justify-start overflow-hidden bg-gray-900 text-white transition-[flex-basis] duration-500 md:flex",m?"md:basis-[25vw]":"md:basis-0"),children:a.jsx("div",{className:"w-[25vw] min-w-[25vw]",children:e.metadataRenderer(o)})})]})})})]})}const E=ve({showImage:{id:"imageViewer.showImage",defaultMessage:"Show Image"},closeModal:{id:"imageViewer.closeModal",defaultMessage:"Close Modal"},toggleSidebar:{id:"imageViewer.toggleSidebar",defaultMessage:"Toggle Sidebar"},nextImage:{id:"imageViewer.nextImage",defaultMessage:"Next Image"},previousImage:{id:"imageViewer.previousImage",defaultMessage:"Previous Image"}});function ba({withLottie:e}){return a.jsxs("div",{className:"absolute start-0 top-0 flex h-full w-full items-center justify-center rounded-full",children:[a.jsx(pa,{animate:e,matchTextColor:!0,className:"h-6 w-6"}),a.jsx(ja,{})]})}function ja(){const[t,n]=w.useState(new Date);w.useEffect(()=>{n(new Date)},[]);const r=aa(+t,25e3);return a.jsx(ta,{percentage:r,thickness:1.25/23,className:"absolute start-1/2 top-1/2 h-10 w-10 -translate-x-1/2 -translate-y-1/2",backgroundStrokeClassName:"stroke-token-main-surface-tertiary",transitionDuration:"".concat((100-r)/100*.2,"s"),transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)"})}function Oa({messages:e,clientThreadId:t,disableClickThru:n=!1}){const[r,u]=e,j=sa(r),m=na(),c=e.some(I=>m.has(I.id));let o=null;u!=null&&me.isMultimodalTextMessage(u)&&(o=me.getImageAssetPointers(u));let f=A.Running;return o!=null?f=A.Finished:u!=null?f=A.Error:j&&(f=A.Stopped),a.jsx(ke.Provider,{value:n,children:!c&&a.jsx(ya,{imageAssets:o!=null?o:[],clientThreadId:t,toolStatus:f,toolMessage:u,messageId:r.id})})}const _a="https://help.openai.com/en/articles/8932459",ya=({imageAssets:e,clientThreadId:t,toolMessage:n,toolStatus:r,messageId:u})=>{const j=ae(),m=be(t),c=ia(e,void 0,m),o=$e(),f=He(o),I=la(t),k=w.useMemo(()=>r===A.Finished&&c.every(l=>!!l.data),[r,c]);if((n==null?void 0:n.content.content_type)===Ke.SystemError)return null;const N=Ne(e[0]),y=c.map(l=>l.data).filter(l=>l!=null),S=y.map(l=>J(X({},l),{alt:q(l)})),b=(l=0)=>"".concat(u,"-image-").concat(l);return a.jsxs("div",{children:[a.jsxs(Na,{$numItems:c.length,className:"my-1 transition-opacity duration-300",children:[c.length===0&&r===A.Running&&a.jsx(he,{layoutId:"loading:placeholder",shape:N,isToolRunning:!0},"loading"),c.map((l,x)=>{const{isLoading:i,data:d,error:_}=l;if(i)return a.jsx(he,{shape:N,layoutId:b(x)},x);if(_!=null||(d==null?void 0:d.url)==null)return a.jsx(ne,{layoutId:b(x),className:"text-token-text-tertiary text-sm",shape:N,children:a.jsx("div",{className:"flex min-h-full flex-col items-center justify-center gap-3 px-4 pb-5",children:j.formatMessage(C.imageLoadError)})},x);if(n&&d){const v=J(X({},d),{alt:q(d)});return a.jsx(Ma,{image:v,allImages:S,clientThreadId:t,toolMessage:n,index:x,onOpenImageEditor:()=>{ra.setFocusedObject({type:_e.Image,image:v,allImages:y,messageId:n.id})}},x)}})]}),f&&k&&a.jsx("div",{className:"text-md text-token-text-tertiary flex flex-row items-center py-2",children:a.jsx("span",{className:"me-2",children:I?a.jsx(ge,{id:"xQcNUs",defaultMessage:"Made with the old version of image generation. <link>Learn more</link>",values:{link:l=>a.jsx("a",{className:"text-token-text-tertiary underline underline-offset-4",href:_a,target:"_blank",rel:"noopener noreferrer",children:l})}}):a.jsx(ge,{id:"hyynYz",defaultMessage:"Made with the old version of image generation. New version <link>available now</link>.",values:{link:l=>a.jsx("a",{className:"text-token-text-tertiary underline underline-offset-4",href:"https://openai.com/index/introducing-4o-image-generation/",target:"_blank",rel:"noopener noreferrer",children:l})}})})})]})};function Ma({toolMessage:e,clientThreadId:t,allImages:n,image:r,index:u,onOpenImageEditor:j}){const m=ae(),c=be(t),o=Ne(r),f=w.useContext(ke),[I,k]=w.useState({}),N=ha({clientThreadId:t});async function y(i){ma(i,c,e.id,f)}function S(i){var d,_,v,M,s,g,h,p,T,D,P,O,L,F,R,G,B,z,W,U,$,H;Q.logEvent("chatgpt_dalle_image_view_full",null,{sourceOperation:(v=(_=(d=i.metadata)==null?void 0:d.dalle)==null?void 0:_.edit_op)!=null?v:"none",hasParent:(s=(M=i.metadata)==null?void 0:M.dalle)!=null&&s.parent_gen_id?"true":"false",model:"dalle"}),Y.logEvent("chatgpt_dalle_image_view_full",{conversationId:c,messageId:e.id,generationId:(h=(g=i.metadata)==null?void 0:g.dalle)==null?void 0:h.gen_id,parentGenerationId:(T=(p=i.metadata)==null?void 0:p.dalle)==null?void 0:T.parent_gen_id,fileId:Z(i.asset_pointer),sourceOperation:(P=(D=i.metadata)==null?void 0:D.dalle)==null?void 0:P.edit_op,model:"dalle"}),Q.logEvent("chatgpt_image_view_full",null,{sourceOperation:(F=(L=(O=i.metadata)==null?void 0:O.dalle)==null?void 0:L.edit_op)!=null?F:"none",hasParent:(G=(R=i.metadata)==null?void 0:R.dalle)!=null&&G.parent_gen_id?"true":"false",model:"dalle"}),Y.logEvent("chatgpt_image_view_full",{conversationId:c,messageId:e.id,generationId:(z=(B=i.metadata)==null?void 0:B.dalle)==null?void 0:z.gen_id,parentGenerationId:(U=(W=i.metadata)==null?void 0:W.dalle)==null?void 0:U.parent_gen_id,fileId:Z(i.asset_pointer),sourceOperation:(H=($=i.metadata)==null?void 0:$.dalle)==null?void 0:H.edit_op,model:"dalle"})}function b(i,d){var v,M,s,g,h,p,T,D,P,O,L,F,R,G,B,z,W,U,$,H,ie,le;k(Se=>J(X({},Se),{[i.asset_pointer]:d}));const _=f?"chatgpt_dalle_image_captioning_rating":"chatgpt_dalle_image_rating";Q.logEvent(_,d?"like":"dislike",{liked:d?"true":"false",sourceOperation:(s=(M=(v=i.metadata)==null?void 0:v.dalle)==null?void 0:M.edit_op)!=null?s:"none",hasParent:(h=(g=i.metadata)==null?void 0:g.dalle)!=null&&h.parent_gen_id?"true":"false",model:"dalle"}),Y.logEvent(_,{liked:d,conversationId:c,messageId:e.id,generationId:(T=(p=i.metadata)==null?void 0:p.dalle)==null?void 0:T.gen_id,parentGenerationId:(P=(D=i.metadata)==null?void 0:D.dalle)==null?void 0:P.parent_gen_id,fileId:Z(i.asset_pointer),sourceOperation:(L=(O=i.metadata)==null?void 0:O.dalle)==null?void 0:L.edit_op,model:"dalle"}),Q.logEvent("chatgpt_image_rating",d?"like":"dislike",{liked:d?"true":"false",sourceOperation:(G=(R=(F=i.metadata)==null?void 0:F.dalle)==null?void 0:R.edit_op)!=null?G:"none",hasParent:(z=(B=i.metadata)==null?void 0:B.dalle)!=null&&z.parent_gen_id?"true":"false",model:"dalle"}),Y.logEvent("chatgpt_image_rating",{liked:d,conversationId:c,messageId:e.id,generationId:(U=(W=i.metadata)==null?void 0:W.dalle)==null?void 0:U.gen_id,parentGenerationId:(H=($=i.metadata)==null?void 0:$.dalle)==null?void 0:H.parent_gen_id,fileId:Z(i.asset_pointer),sourceOperation:(le=(ie=i.metadata)==null?void 0:ie.dalle)==null?void 0:le.edit_op,model:"dalle"})}function l(i){const d=I[i.asset_pointer],_={label:m.formatMessage(C.likeImage),onClick:()=>b(i,!0),disabled:d===!0,ariaLabel:m.formatMessage(C.likeImage),icon:ye},v={label:m.formatMessage(C.dislikeImage),onClick:()=>b(i,!1),disabled:d===!1,ariaLabel:m.formatMessage(C.dislikeImage),icon:Me},M={label:m.formatMessage(C.downloadImage),onClick:()=>y(i),ariaLabel:m.formatMessage(C.downloadImage),icon:Ce};return[d!==!1&&_,d!==!0&&v,M].filter(Boolean)}let x=a.jsx(ka,{image:r,shape:o,rating:I[r.asset_pointer],onDownload:()=>y(r),onRate:(i,d)=>b(i,d),clientThreadId:t,layoutId:void 0});return N?x=a.jsx("div",{role:"button",onClick:j,children:x}):f||(x=a.jsx(va,{image:r,images:n,metadataRenderer:i=>a.jsx(Ca,{image:i}),onOpen:S,getActions:l,children:x})),a.jsx("div",{className:"flex",children:x},u)}function he({shape:e,layoutId:t,isToolRunning:n=!1}){const{isOpen:r}=oa();return a.jsx(ne,{shape:e,layoutId:r?void 0:t,children:a.jsx("div",{className:"flex min-h-full items-center justify-center",children:a.jsx(ba,{withLottie:n})})},"loading")}function Ca({image:e}){const t=ae(),[n,r]=w.useState(!1),u=Ze();function j(m){const c=q(e);r(!0),fa(c,u,m),setTimeout(()=>{r(!1)},2e3)}return a.jsxs("div",{className:"flex flex-col items-start gap-3 p-6",children:[a.jsx("div",{className:"text-sm text-gray-300 sm:text-base",children:t.formatMessage(C.imageViewerMetadataTitle)}),a.jsx("div",{className:"max-h-32 overflow-y-auto text-sm md:max-h-[80vh] md:text-lg",children:q(e)}),a.jsx(K,{color:"primary",onClick:j,disabled:n,className:"hidden sm:block",icon:ua,children:n?t.formatMessage(C.imageViewerMetadataCopyButtonCopied):t.formatMessage(C.imageViewerMetadataCopyButton)})]})}function ne({children:e,shape:t,className:n,layoutId:r}){return a.jsxs(ee.div,{layoutId:r,className:V("relative",n,t==="1792x1024"&&"aspect-7/4",t==="1024x1024"&&"aspect-square max-w-[400px]",t==="1024x1792"&&"aspect-4/7 max-w-xs","overflow-hidden rounded-2xl"),children:[a.jsx("div",{className:"bg-token-main-surface-secondary pointer-events-none absolute inset-0"}),a.jsx("div",{className:"relative h-full",children:e})]})}function ka({image:e,shape:t,rating:n,onDownload:r,onRate:u,clientThreadId:j,layoutId:m}){const c=qe(Xe.isBusinessWorkspace),o=Je(j,l=>l==null?void 0:l.mode),f=Qe(),I=da(),k=(I==null?void 0:I.type)===_e.Image&&I.image.asset_pointer===e.asset_pointer,{url:N,width:y,height:S}=e,b=!c&&(o==null?void 0:o.kind)!==Ye.GizmoMagicCreate;return a.jsxs(ne,{shape:t,className:"group/dalle-image",layoutId:k?void 0:m,children:[a.jsx(ca,{alt:q(e),src:N,width:y,height:S}),a.jsx("div",{className:V("pointer-events-none absolute inset-0 rounded-2xl shadow-[inset_0_0_0_1px_rgba(0,0,0,0.1)] dark:shadow-[inset_0_0_0_1px_rgba(255,255,255,0.1)]",k?"bg-black/50 group-hover/dalle-image:bg-black/70":"group-hover/dalle-image:bg-transparent")}),f?!k&&a.jsx("div",{className:"pointer-events-none invisible absolute end-3 top-3 text-white group-hover/dalle-image:visible",children:a.jsx(ga,{})}):a.jsxs(a.Fragment,{children:[b&&a.jsxs(pe,{children:[n!==!1&&a.jsx(se,{icon:ye,selected:n===!0,onClick:l=>{l.stopPropagation(),u(e,!0)}}),n!==!0&&a.jsx(se,{icon:Me,selected:n===!1,onClick:l=>{l.stopPropagation(),u(e,!1)}})]}),a.jsx(pe,{$rightAlign:!0,children:a.jsx(se,{icon:Ce,onClick:l=>{l.stopPropagation(),r()}})})]})]})}var Ie;const pe=je.div(Ie||(Ie=te(["invisible absolute top-3 flex gap-1 group-hover/dalle-image:visible z-2\n",""])),({$rightAlign:e})=>e?"end-3":"start-3");var we;const Na=je.div(we||(we=te(["grid gap-2\n",""])),({$numItems:e})=>e<=1?"grid-cols-1":"grid-cols-2");function Ne(e){if(!e)return"1024x1024";const{width:t,height:n}=e;return t>n?"1792x1024":t<n?"1024x1792":"1024x1024"}const C=ve({creatingImages:{id:"dalleMessage.creatingImagesV2",defaultMessage:"Creating image"},stopped:{id:"dalleMessage.stoppedV3",defaultMessage:"Stopped creating image"},errorCreating:{id:"dalleMessage.errorCreatingV2",defaultMessage:"Error creating image"},imageLoadError:{id:"dalleMessage.imageLoadError",defaultMessage:"Error loading image"},imageViewerMetadataTitle:{id:"dalleMessage.imageViewerMetadataTitle",defaultMessage:"Prompt"},imageViewerMetadataCopyButton:{id:"dalleMessage.imageViewerMetadataCopyButton",defaultMessage:"Copy"},imageViewerMetadataCopyButtonCopied:{id:"dalleMessage.imageViewerMetadataCopyButtonCopied",defaultMessage:"Copied!"},imageEditButton:{id:"dalleMessage.imageEditButton",defaultMessage:"Edit"},downloadImage:{id:"imageViewer.downloadImage",defaultMessage:"Download Image"},likeImage:{id:"imageViewer.likeImage",defaultMessage:"Like Image"},dislikeImage:{id:"imageViewer.dislikeImage",defaultMessage:"Dislike Image"}});export{Oa as default};
//# sourceMappingURL=c8gt0dx953xyg6iv.js.map
