const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/mwgmn9msmy6w395a.js","assets/ewse8exzafeu10ji.js","assets/n75kuy1cx6f5mogg.js","assets/root-l2v84m1w.css","assets/ny10lj7zpuz89fvf.js","assets/conversation-small-hotcas67.css","assets/g7mxjj0ktl5g8wm5.js","assets/ce2i59offcjvzu0m.js","assets/e0z6030ycsi62lhu.js","assets/o6atjo7ly76boc6z.js","assets/fzk9fwuo4wro7wsn.js","assets/bd7dj080szn1mr9h.js","assets/lm6hpwvkn3o7xwl4.js","assets/lkis5qusf3l3oysp.js","assets/ks571px5rt10uxm1.js","assets/bbwdjqfyrcn310kz.js"])))=>i.map(i=>d[i]);
var Yt=Object.freeze,Zt=Object.defineProperty,fi=Object.defineProperties;var pi=Object.getOwnPropertyDescriptors;var Ze=Object.getOwnPropertySymbols;var en=Object.prototype.hasOwnProperty,sn=Object.prototype.propertyIsEnumerable;var Jt=(n,e,a)=>e in n?Zt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[e]=a,W=(n,e)=>{for(var a in e||(e={}))en.call(e,a)&&Jt(n,a,e[a]);if(Ze)for(var a of Ze(e))sn.call(e,a)&&Jt(n,a,e[a]);return n},he=(n,e)=>fi(n,pi(e));var tn=(n,e)=>{var a={};for(var s in n)en.call(n,s)&&e.indexOf(s)<0&&(a[s]=n[s]);if(n!=null&&Ze)for(var s of Ze(n))e.indexOf(s)<0&&sn.call(n,s)&&(a[s]=n[s]);return a};var es=(n,e)=>Yt(Zt(n,"raw",{value:Yt(e||n.slice())}));import{r as g,j as t,M as ne,d as Fn,R as bi,i as vi,A as xi,c as Pn}from"./n75kuy1cx6f5mogg.js";import{ej as Ue,ek as De,F as Es,aS as os,bG as C,aR as L,br as Y,e as ae,_ as _i,nT as Ti,bJ as ke,aV as pe,aZ as ks,aT as Ne,jt as Ii,bj as Nn,B as Vn,it as Un,R as Si,A as yi,cq as nn,at as an,i as Ge,aP as on,b as wi,Y as Dn,gV as Ci,Z as Gn,iq as Hn,p4 as Ei,d as ki,h as ji,nG as Ri,i8 as Is,ia as Ai,fZ as Mi,aX as Fi,j as Ce,a3 as Pe,aw as Pi,eQ as Ni,hD as Vi,bL as Ui,b6 as Di,f2 as Gi,nE as Hi,nB as Li,nF as Oi,nS as qi,O as Ln,aO as ss,bq as On,a9 as Bi,a6 as Wi,P as Ss,t as $i,ph as zi,eK as Ki,qh as Qi,a8 as Xi,lf as Yi,aY as Ve,qi as js,qj as rn,d5 as Ji,qk as Zi,bo as eo,cL as so,cM as to,e7 as no,q as ln,kB as ts,bp as cn,iw as ao,h_ as io,kh as oo,gW as Rs,mR as ro,ql as lo,a2 as co,ce as uo,ay as mo}from"./ewse8exzafeu10ji.js";import{h_ as go,df as qn,h$ as dn,c5 as ho,i0 as un,i1 as fo,i2 as Bn,i3 as mn,i4 as po,i5 as bo,cX as vo,cY as xo,i6 as _o,b2 as To,b1 as Io,i7 as So,i8 as yo,i9 as wo,X as Co,j as Eo,ia as ko,gY as jo,ib as gn,ic as Ro,dc as hn,id as Ao,ie as Mo,ig as Fo,ih as Po,as as No,ii as Vo,ij as Uo,ik as fn,il as Do,aS as pn,im as Go,io as Ho,ip as Lo,iq as Oo,ir as qo,is as Bo,it as Wo,iu as $o,iv as zo,iw as Ko,ix as Qo,iy as Xo,iz as Yo,iA as Jo,iB as Wn,iC as Zo,iD as er,iE as sr,iF as tr,iG as nr,iH as ar,iI as ir,iJ as or,iK as rr,iL as lr,iM as cr,iN as bn,iO as dr,iP as ur,iQ as mr,iR as gr,iS as hr,iT as fr,iU as pr,iV as br,iW as vr,iX as xr,iY as _r,iZ as Tr,i_ as Ir,av as vn,i$ as Sr,j0 as p,j1 as $n,j2 as zn,j3 as Kn,j4 as yr,j5 as wr,j6 as Cr,j7 as Er,j8 as Qn,j9 as Xn,ja as kr,jb as jr,jc as Rr,jd as Ar,je as ns,jf as Mr,jg as Fr,jh as Pr,ji as as}from"./ny10lj7zpuz89fvf.js";import{C as ws}from"./czwq62q5rbh9b1yi.js";const xn=Ue(()=>De(()=>import("./mwgmn9msmy6w395a.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(n=>n.MemoryActionResult));function _n(n,e,a){pe(n,s=>{ks.updateTree(s,l=>{l.updateNodeMetadata(e,{inlineComparisonRating:a})})})}const Tn=({messages:n})=>{for(const{metadata:e}of n){const{paragen_display_label:a}=e!=null?e:{};if(a)return a;const{augmented_paragen_prompt_label:s}=e!=null?e:{};if(s)return s}};function Nr(n){const e=g.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),a=g.useRef({left:null,right:null});return n.variantIds.length<2?t.jsx(Yn,W({setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:e,firstVisibleTokenTimestampsRef:a},n)):t.jsx(Vr,he(W({},n),{visibilityStateRef:e,firstVisibleTokenTimestampsRef:a}))}function Vr(n){const{clientThreadId:e,variantIds:a,turnIndex:s,firstVisibleTokenTimestampsRef:l}=n;if(a.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const c=Bn(),o=_i(),[d,m]=a,T=g.useMemo(()=>Ti(d+m)()>=.5,[d,m]),[h,I]=T?[m,d]:[d,m],[M,f,E]=ke(e,V=>{var D,A,S,H,q,r,Q,N,J,Z,ie,R,de,B,w,be,ee,se,ue,He;const j=nn(V).tree.getLeafFromNode(h).id,k=nn(V).tree.getLeafFromNode(I).id,y=L.getConversationTurns(V,j),U=L.getConversationTurns(V,k),x=s<y.length?y[s]:null,K=s<U.length?U[s]:null;return x||an.addError("Paragen Left turn index ".concat(s," out of bounds"),{turnIndex:s,turnCount:y.length,lastTurnRole:(D=C(y))==null?void 0:D.role,lastMessageAuthor:(S=C((A=C(y))==null?void 0:A.messages))==null?void 0:S.author,lastMessageContentType:(q=C((H=C(y))==null?void 0:H.messages))==null?void 0:q.content.content_type,lastMessageMetadata:(Q=C((r=C(y))==null?void 0:r.messages))==null?void 0:Q.metadata,altTurnCount:U.length,altLastTurnRole:(N=C(U))==null?void 0:N.role,altLastMessageRole:(Z=C((J=C(U))==null?void 0:J.messages))==null?void 0:Z.author.role}),K||an.addError("Paragen Right turn index ".concat(s," out of bounds"),{turnIndex:s,turnCount:U.length,lastTurnRole:(ie=C(U))==null?void 0:ie.role,lastMessageAuthor:(de=C((R=C(U))==null?void 0:R.messages))==null?void 0:de.author,lastMessageContentType:(w=C((B=C(U))==null?void 0:B.messages))==null?void 0:w.content.content_type,lastMessageMetadata:(ee=C((be=C(U))==null?void 0:be.messages))==null?void 0:ee.metadata,altTurnCount:y.length,altLastTurnRole:(se=C(y))==null?void 0:se.role,altLastMessageRole:(He=C((ue=C(y))==null?void 0:ue.messages))==null?void 0:He.author.role}),[j,x,K]}),[v,F]=T?[E,f]:[f,E],X="skippable_parallel_2_in_stream:a:1.5";g.useEffect(()=>(mn.setState({displayingSideBySideFeedback:!0}),()=>{mn.setState({displayingSideBySideFeedback:!1})}),[]);const O=g.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),z=g.useCallback((V,{shouldSubmitParagenFeedback:j=!0}={})=>{var H,q;if(!f||!E||!v||!F)throw new Error("Expected both turns to exist");pe(e,r=>{ks.setCurrentBranch(r,V)});const k=V===h,y=V===d;v.messages.length>0&&_n(e,v.messages[v.messages.length-1].id,y?"original":"new"),F.messages.length>0&&_n(e,F.messages[F.messages.length-1].id,y?"original":"new");const U=Ne(e),x=[f,E].map((r,Q)=>{var N,J;return{messageId:r.messages[r.messages.length-1].id,loadFirstTokenTime:Q===0?l.current.left:l.current.right,loadEndTime:(J=(N=C(r.messages))==null?void 0:N.clientMetadata)==null?void 0:J.completionSampleFinishTime}}),K=k?x[0].messageId:x[1].messageId,D=L.getParentPromptNode(os(e),M);if(!D)throw new Error("Expected prompt for side by side feedback");const A={},S=((H=D.message.clientMetadata)==null?void 0:H.variantsInStreamInfo)==null&&((q=D.message.metadata)==null?void 0:q.paragen_variants_info)!=null;for(const r of x)A[r.messageId]=S?{load_first_token_time:n.conversationTurnMountTime,load_end_time:n.conversationTurnMountTime}:{load_first_token_time:r.loadFirstTokenTime,load_end_time:r.loadEndTime};j&&Cn({params:{conversation_id:U,displayed_message_ids:x.map(r=>r.messageId),message_metadatas:A,rating:"selected",selected_message_id:K,source_timestamp:Date.now(),ui_variant:1,user_prompt_message_id:D.message.id}})},[e,h,d,v,F,f,E,M,l,n.conversationTurnMountTime]);return g.useEffect(()=>Ii(Nn,{requestCompletion:V=>{var D,A;const j=Ne(e),k=L.getParentPromptNode(os(e),M);if(!k)throw new Error("Expected prompt for side by side feedback");if(!f||!E)throw new Error("Expected both turns to exist");const y=[f,E].map((S,H)=>{var q,r;return{messageId:S.messages[S.messages.length-1].id,loadFirstTokenTime:H===0?l.current.left:l.current.right,loadEndTime:(r=(q=C(S.messages))==null?void 0:q.clientMetadata)==null?void 0:r.completionSampleFinishTime}}),U={},x=((D=k.message.clientMetadata)==null?void 0:D.variantsInStreamInfo)==null&&((A=k.message.metadata)==null?void 0:A.paragen_variants_info)!=null;for(const S of y)U[S.messageId]=x?{load_first_token_time:n.conversationTurnMountTime,load_end_time:n.conversationTurnMountTime}:{load_first_token_time:S.loadFirstTokenTime,load_end_time:S.loadEndTime};const K=V.isForSkippingParagen;Cn({params:{conversation_id:j,displayed_message_ids:y.map(S=>S.messageId),message_metadatas:U,rating:K?"explicit_skipped":"skipped",selected_message_id:null,source_timestamp:Date.now(),ui_variant:K?3:1,user_prompt_message_id:k.message.id}}),K&&z(h,{shouldSubmitParagenFeedback:!1})}}),[f,E,M,e,n.conversationTurnMountTime,X,v==null?void 0:v.messages,F==null?void 0:F.messages,o,l,z,h]),t.jsx(Yn,he(W({},n),{setPreferredFeedback:z,leftVariantId:h,rightVariantId:I,leftTurn:f,rightTurn:E,hasActiveRequest:c,originalTurn:v,visibilityStateRef:O}))}function Yn(T){var h=T,{setPreferredFeedback:n,leftVariantId:e,rightVariantId:a,leftTurn:s,rightTurn:l,hasActiveRequest:c,originalTurn:o,visibilityStateRef:d}=h,m=tn(h,["setPreferredFeedback","leftVariantId","rightVariantId","leftTurn","rightTurn","hasActiveRequest","originalTurn","visibilityStateRef"]);var ie,R,de;const I=(ie=s&&Tn(s))!=null?ie:null,M=(R=l&&Tn(l))!=null?R:null,f=g.useMemo(()=>{var B;return(B=s==null?void 0:s.messages)!=null?B:[]},[s==null?void 0:s.messages]),E=g.useMemo(()=>{var B;return(B=l==null?void 0:l.messages)!=null?B:[]},[l==null?void 0:l.messages]),{avatarClassName:v,firstVisibleTokenTimestampsRef:F}=m,X=g.useMemo(()=>{var B;return(B=s==null?void 0:s.messageGroups)!=null?B:[]},[s==null?void 0:s.messageGroups]),O=g.useMemo(()=>{var B;return(B=l==null?void 0:l.messageGroups)!=null?B:[]},[l==null?void 0:l.messageGroups]),z=go(),V=os(m.clientThreadId),j=C(s==null?void 0:s.messages),k=C(l==null?void 0:l.messages),y=qn(L.getRequestId(V,(de=j==null?void 0:j.id)!=null?de:k==null?void 0:k.id)),U=y&&!(j!=null&&j.end_turn),x=y&&!(k!=null&&k.end_turn),K=j!=null&&dn(j),D=k!=null&&dn(k),A=K!=null?K:D,S=(s==null?void 0:s.role)===Y.User,H=(l==null?void 0:l.role)===Y.User,q=g.useRef(null),r=g.useRef(null),Q=g.useRef(null),N=s!=null,J=l!=null;!N&&F.current.left==null&&(F.current.left=Date.now()),!J&&F.current.right==null&&(F.current.right=Date.now()),g.useEffect(()=>{if(q.current&&r.current&&Q.current){const B=Array(11).fill(0).map((be,ee)=>ee/10),w=new IntersectionObserver(be=>be.forEach(ee=>{var se,ue;ee.target===r.current?(d.current.left_visibility_initial==null&&(d.current.left_visibility_initial=ee.intersectionRatio),d.current.left_visibility_max=Math.max((se=d.current.left_visibility_max)!=null?se:0,ee.intersectionRatio)):ee.target===Q.current&&(d.current.right_visibility_initial==null&&(d.current.right_visibility_initial=ee.intersectionRatio),d.current.right_visibility_max=Math.max((ue=d.current.right_visibility_max)!=null?ue:0,ee.intersectionRatio))}),{root:q.current,threshold:B});return w.observe(r.current),w.observe(Q.current),()=>w.disconnect()}},[d]);const{data:Z}=ho(void 0,!1,z);return t.jsxs("div",{className:"relative flex flex-col",children:[t.jsx("div",{className:"bg-token-main-surface-primary sticky top-[-1px] z-1 px-(--thread-content-margin) text-center text-lg text-pretty md:static","data-testid":"paragen-feedback-title",children:t.jsx(ne,{id:"KKeSJV",defaultMessage:"You're giving feedback on a new version of ChatGPT."})}),t.jsx("div",{className:"text-token-text-secondary px-(--thread-content-margin) pt-1 pb-5 text-center text-sm text-pretty",children:t.jsx(ne,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})}),t.jsx("div",{className:ae(fo("default"),"horzScrollShadows relative -mb-2 snap-x snap-mandatory overflow-x-auto overflow-y-clip pb-4"),ref:q,children:t.jsxs("div",{className:ae("mx-auto box-content max-w-[calc(2*var(--thread-content-max-width))] min-w-min px-(--thread-content-margin)","flex items-start gap-4 sm:gap-6"),children:[t.jsxs(In,{rootElementRef:r,onClick:()=>{n(e)},hasActiveRequest:c,isImageGenInProgress:A,children:[t.jsxs(yn,{children:[t.jsx(un,{messages:f,isUserTurn:S,avatarClassName:v}),t.jsx(Sn,{children:t.jsx(ne,he(W({},En.responseNumber),{values:{responseIndex:1,display_label:I?" ".concat(I):""}}))})]}),t.jsxs(t.Fragment,{children:[Z!=null&&!S&&t.jsx(xn,{clientThreadId:m.clientThreadId,messages:f,isParagen:!0}),t.jsx(ws,he(W({},m),{allMessages:f,groupedMessagesToRender:X,allGroupedMessages:X,isUserTurn:S,isFinalUserTurn:!1,isFinalAssistantTurn:!1,isCompletionRequestInProgress:U,hasActiveRequest:c,shouldGrowContainer:!1,isParagen:!0})),t.jsx(wn,{clientThreadId:m.clientThreadId,conversationTurnMountTime:m.conversationTurnMountTime,turn:s,originalTurn:o})]})]}),t.jsxs(In,{rootElementRef:Q,onClick:()=>{n(a)},hasActiveRequest:c,isImageGenInProgress:A,children:[t.jsxs(yn,{children:[t.jsx(un,{messages:E,isUserTurn:H,avatarClassName:v}),t.jsx(Sn,{children:t.jsx(ne,he(W({},En.responseNumber),{values:{responseIndex:2,display_label:M?" ".concat(M):""}}))})]}),t.jsxs(t.Fragment,{children:[Z!=null&&!H&&t.jsx(xn,{clientThreadId:m.clientThreadId,messages:E,isParagen:!0}),t.jsx(ws,he(W({},m),{allMessages:E,groupedMessagesToRender:O,allGroupedMessages:O,isFinalUserTurn:!1,isFinalAssistantTurn:!1,isUserTurn:H,isCompletionRequestInProgress:x,hasActiveRequest:c,shouldGrowContainer:!1,isParagen:!0})),t.jsx(wn,{clientThreadId:m.clientThreadId,conversationTurnMountTime:m.conversationTurnMountTime,turn:l,originalTurn:o})]})]})]})})]})}function In({rootElementRef:n,onClick:e,children:a,hasActiveRequest:s,isImageGenInProgress:l}){const c=g.useRef(null),o=g.useRef(null),d=g.useRef(null);return t.jsx("div",{"data-paragen-root":!0,className:"border-token-border-tertiary @container relative flex min-w-[min(450px,80cqw,80vw)] flex-1 snap-center flex-col gap-1 rounded-xl border text-start shadow-lg shadow-black/3",ref:n,children:t.jsxs("div",{className:ae(po,"px-(--thread-content-margin) py-4"),children:[t.jsx("div",{className:ae("absolute top-48 right-0! left-0! h-px","invisible"),ref:c}),t.jsx("div",{className:ae("absolute top-48 right-0! bottom-0 left-0!","invisible"),ref:o}),t.jsx("div",{className:ae("absolute right-0! bottom-0 left-0! h-px","invisible"),ref:d}),a,s||l?null:t.jsx(Vn,{className:"mt-4 self-start",onClick:e,"data-testid":"paragen-prefer-response-button",children:t.jsx(ne,{id:"U2EAH6",defaultMessage:"I prefer this response"})})]})})}var Rn;const Sn=Es.div(Rn||(Rn=es(["text-sm text-token-text-secondary font-semibold"])));var An;const yn=Es.div(An||(An=es(["flex gap-4 items-center mb-1"])));function wn({clientThreadId:n,conversationTurnMountTime:e,turn:a,originalTurn:s}){var I,M,f,E,v,F;const l=Un();if(!l.showParagenMetadata||!l.showDebugConversationTurns&&!l.forceParagen||a==null)return null;let c=a===s?"ORIGINAL":"NEW";const o=a.messages[a.messages.length-1],d=(I=o==null?void 0:o.metadata)==null?void 0:I.__internal,m=(M=o==null?void 0:o.metadata)==null?void 0:M.paragen_display_label;if(d){const{model_id:X,model_definition_slug:O,model_definition_virtual_model_id:z,alternative_model_selection_rule:V,augmented_paragen_prompt_group_id:j,augmented_paragen_prompt_id:k,augmented_paragen_prompt:y}=d;X&&(c+="\nModel ID: ".concat(X)),O&&(c+="\nModel Slug: ".concat(O)),z&&(c+="\nVirtual Model ID: ".concat(z)),V&&(c+="\nAlternative Model Rule: ".concat(V)),j&&(c+="\nPrompt Group ID: ".concat(j)),k&&(c+="\nPrompt ID: ".concat(k)),y&&(c+="\nPrompt: ".concat(y)),m&&(c+="\nDisplay Label: ".concat(m))}c+="\nMessage ID: ".concat(o.id);const T=L.getParentPromptNode(os(n),a.messages[0].id);if(!T)throw new Error("Expected prompt for side by side feedback");const h=((f=T.message.clientMetadata)==null?void 0:f.variantsInStreamInfo)==null&&((E=T.message.metadata)==null?void 0:E.paragen_variants_info)!=null;return c+="\nUser prompt message ID: ".concat(T.message.id),c+="\nIs Persisted Paragen? ".concat(h),c+="\nCompletion Sample Finish Time: ".concat(h?"".concat(e," (persisted)"):(F=(v=C(a.messages))==null?void 0:v.clientMetadata)==null?void 0:F.completionSampleFinishTime),t.jsx("div",{className:"text-sm whitespace-pre-wrap text-red-500",children:c})}async function Cn({params:n}){await Si.safePost("/paragen_submission",{requestBody:n,authOption:yi.SendIfAvailable})}const En=Fn({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}{display_label}"}}),Ur=Ue(()=>De(()=>import("./mwgmn9msmy6w395a.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(n=>n.MemoryActionResult)),Dr=Ue(()=>De(()=>import("./o6atjo7ly76boc6z.js"),__vite__mapDeps([9,2,1,3,10,4,5,11])).then(n=>n.AutomationSourceHeader)),kn=Ue(()=>De(()=>import("./lm6hpwvkn3o7xwl4.js"),__vite__mapDeps([12,2,1,3,4,5,13])).then(n=>n.TextMessageEditor)),Gr=Ue(()=>De(()=>import("./ks571px5rt10uxm1.js"),__vite__mapDeps([14,2,1,3,4,5,15])).then(n=>n.ChatScreenRetrievalResultsFlyoutContent)),jn=80,ys=16;function Cs(){return{minHeight:"calc(100dvh - ".concat(Ir,"px - 120px)")}}function Hr(n){"use forget";var gt,ht,ft,pt,bt,vt,xt,_t,Tt,It,St,yt,wt,Ct,Et,kt,jt,Rt,At,Mt,Ft,Pt,Nt,Vt,Ut,Dt,Gt,Ht,Lt,Ot,qt,Bt;const{turnIndex:e,isFinalTurn:a,clientThreadId:s,onRequestCompletion:l,currentModelId:c,scrollToMessageId:o,dateHeaderType:d,hideUserActions:m,disableHorizontalPadding:T}=n,h=Ge(),I=on(h,s),M=bo(h),f=wi(),[E,v,F]=Dn(i=>[Ci(i),Gn(i),Hn(i)]),X=!!f&&Ei(f),O=ki(ji.isBusinessWorkspace),z=Ri(),V=vo()||z,j=xo(),k=_o(),y=Tr(),{eligible:U}=To(Io.hasSeenAudioParagenPrompt),[x,K,D]=ke(s,i=>{const u=L.getConversationTurnAtIndex(i,e),b=e>0?L.getConversationTurnAtIndex(i,e-1):null,_=(b==null?void 0:b.role)===Y.User&&b.messages.some($=>{var te;return(te=$.metadata)==null?void 0:te.visually_hide_response_from_conversation});return[u,_,b]},{disablePerfDetector:a}),{messages:A,messageGroups:S}=x,H=So(i=>i.size===0?-1:S.findIndex(u=>u.type===Is?u.groups.some(b=>b.messages.some(_=>i.has(_==null?void 0:_.id))):u.messages.some(b=>i.has(b==null?void 0:b.id)))),q=A[0],r=C(A),Q=g.useMemo(()=>S.some(i=>i.type===Ai.SearchGPTQuery),[S]),N=g.useMemo(()=>A.some(i=>{var u;return(u=i.metadata)==null?void 0:u.n7jupd_message}),[A]),J=g.useMemo(()=>A.some(i=>{var u;return(u=i.metadata)==null?void 0:u.mercury_message}),[A]),Z=g.useMemo(()=>N?Mi(A,i=>i.author.name==="n7jupd.metadata"):null,[A,N]),ie=!!((gt=Z==null?void 0:Z.metadata)!=null&&gt.kaur1br5_mode),{messages:R,visibleMessages:de,messageGroups:B,lastMessageToRender:w}=g.useMemo(()=>{const i=H!==-1&&H+1<S.length,u=i?S.slice(0,H+1):S,b=i?u.flatMap(_=>_.type===Is?_.groups.flatMap($=>$.messages):_.messages):A;return{messages:b,visibleMessages:b.filter(Fi),messageGroups:u,lastMessageToRender:C(b)}},[A,S,H]),be=H!==-1,ee=Ce(h,"1887864177"),se=ke(s,i=>L.getLastMessageSystemHints(i)),ue=(se==null?void 0:se.includes(Pe.Tatertot))&&Ce(h,"28816792")&&Pi(h),{capabilitySuggestionsEnabled:He}=yo(ue),Ms=g.useMemo(()=>({clientThreadId:s,turnIndex:e,messageId:r==null?void 0:r.id}),[s,e,r==null?void 0:r.id]),[Fs,Ps]=g.useState(!1),[Ns,Zn]=g.useState(!1),ea=g.useContext(wo)!=null,G=x.role===Y.User,rs=Ni(),ve=Vi(s),ls=(ht=x.gizmoId)!=null?ht:ve,xe=Ui(ls).data,cs=ls&&!Di(ls)?xe:void 0,sa=cs&&x.gizmoId!=null&&x.gizmoId!==ve&&Ce(h,"1418300125"),ds=Gi(s),ta=Hi(s),Le=Li(ds),na=Oi(ds,ta),us=qi(),[_e,aa,ia,Vs,ms,oa,Oe,ra,la,Us,gs,me,qe,Be,ca,ye,P]=ke(s,i=>{var Wt,$t,zt,Kt;const u=L.getParentPromptNode(i,q.id),b=(Kt=(Wt=u==null?void 0:u.message.clientMetadata)==null?void 0:Wt.variantsInStreamInfo)!=null?Kt:($t=u==null?void 0:u.message.metadata)!=null&&$t.paragen_variant_choice||(zt=u==null?void 0:u.message.metadata)==null?void 0:zt.paragen_variants_info,_=L.getVariantIds(i,q.id),$=L.getCurrentVariantId(i,q.id),te=$?_.indexOf($):0,Se=b&&(i==null?void 0:i.tree)!=null&&_.some(le=>{var Xt;const{errType:Qt}=(Xt=i.tree.getLeafFromNode(le).message.clientMetadata)!=null?Xt:{};return Qt!=null&&Qt!=="info"}),re=L.getConversationTurns(i),Me=re.findIndex(le=>le.role===Y.Assistant),gi=vn(re,le=>le.role===Y.Assistant),hi=re.slice(Me,e+1).every(le=>le.role===Y.Assistant);return[u,r!=null&&!lo(r.id)&&L.isMessageTurnEnded(i,r.id),Se,Sr(i==null?void 0:i.mode,xe==null?void 0:xe.gizmo.id),re.findIndex(le=>le.role===Y.User)===e,vn(re,le=>le.role===Y.User)===e,Me===e,gi===e,hi,L.getRequestId(i,r==null?void 0:r.id),b,_,te,!!(i!=null&&i.continuingFromSharedPostId),i==null?void 0:i.currentLeafId,L.getSuperWidgetMessages(i,e)[0],L.lastUserMessage(i)]},{disablePerfDetector:a}),We=Co(),$e=Ln(()=>{const i=Eo(I);return(i==null?void 0:i.value)===ss.STREAMING||(i==null?void 0:i.value)===ss.REALTIME}),da=R.some(i=>i.content.content_type===On.MultimodalText),ua=Bi(h,"3119715334").get("should-enable-skip",!1),{isUnauthenticated:Ds}=Wi(),Gs=x.messages.map(i=>i.id),oe=g.useRef(null);Lr({clientThreadId:s,turn:x,turnIndex:e,conversationTurnWrapperRef:oe});const Hs=!M&&((ft=o==null?void 0:o.length)!=null?ft:0)>2&&o!=="finalAgentTurn"&&a&&y,ge=G?C(de):void 0,hs=ge==null?void 0:ge.id,ma=g.useCallback(()=>{hs&&(Ss.logEvent("Edit Prompt",{id:hs,threadId:Ne(s)}),$i(h,"chatgpt_edit_prompt"),Ps(!0))},[h,hs,s]),ga=g.useCallback(()=>{Ps(!1)},[]),{hasConnections:Ls}=zi(),{onChangeRating:ha}=ko({clientThreadId:s,currentModelConfig:ds}),fa=i=>{var $;if(!r)return;const u=($=r.clientMetadata)==null?void 0:$.rating,_=(u==="thumbs_up"?"thumbsUp":u==="thumbs_down"?"thumbsDown":u)===i?null:i;if(ha({nodeId:r.id,messageId:r.id,rating:_}),_){const te=Ls&&S.some(Se=>{var re;return Se.type!==Is&&((re=Se.messages)==null?void 0:re.some(ro))});Ss.logEventWithStatsig(_==="thumbsDown"?"Message Feedback Thumbs Down Clicked":"Message Feedback Thumbs Up Clicked","chatgpt_thumb_feedback",W(W({id:r.id,threadId:Ne(s),model:c,rating:_},Ls?{isCATriggered:te}:{}),v?{isSidebar:!0}:{}))}Zn(_==="thumbsDown")},[pa]=g.useState(()=>Date.now()),Os=Ki(s),qs=(pt=jo(s))==null?void 0:pt.value,ba=qs===ss.STREAMING,va=qs===ss.REALTIME,xa=Us!=null,_a=qn(Us),Ta=gn.useState(i=>gn.isReplayInProgress(i,ca)),ce=!aa&&_a||be||va||Ta&&a,Bs=Bn(),fs=g.useRef(!1),Ws=g.useRef(void 0),Ia=Qi({clientThreadId:s}),Sa=Ro(s,r)&&!Ia,[,ya]=vi(),{isOpen:ze}=hn(),$s=Xi(),we=C(D==null?void 0:D.messages.filter(Yi)),ps=Ao({clientThreadId:s,threadContent:(bt=ye==null?void 0:ye.content)!=null?bt:null,query:we?Ve(we):null,triggeredSearch:Q,messageGroups:B,allMessages:A}),zs=js(h)&&Oe&&(!se||se.length===0||se.includes(Pe.Search)),fe=zs&&ps.showNavlinksWidget,{onMountNavlinks:Ks}=Mo(h);g.useEffect(()=>{fe&&Ks()},[Ks,fe]);const Qs=R.filter(rn),wa=fe&&Qs.length===0&&!N,Xs=((vt=P==null?void 0:P.author.metadata)==null?void 0:vt.real_author)==="onboarding",Ys=F&&Oe&&fe&&ps.showLongList;g.useEffect(()=>{const u=new URLSearchParams(window.location.search).get("message");!(u!=null&&Gs.includes(u))||!oe.current||(oe.current.scrollIntoView({behavior:"instant"}),ya(_=>(_.delete("message"),_),{replace:!0,preventScrollReset:!0}))},[]),g.useEffect(()=>{o!==Ws.current&&(fs.current=!1,Ws.current=o)},[o]),g.useEffect(()=>{if(M)return;const b=new URLSearchParams(window.location.search).get("message")!=null;if(fs.current||b||o===void 0||!y||!oe.current||$s||Xs||Ys){o==="finalAgentTurn"&&a&&pe(s,_=>{_.scrollToMessageId=void 0});return}(Gs.includes(o)||o==="finalAgentTurn"&&a)&&(fs.current=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(oe.current)if(o==="finalAgentTurn"&&a)oe.current.scrollIntoView({behavior:"instant",block:"end"}),pe(s,_=>{_.scrollToMessageId=void 0});else{const _=oe.current.offsetHeight;let $=0;ze?$=-8:F?$=-1*ys:_>jn&&($=jn-_);const te=Fo(on(h,s)).pinnedWidgetHeight$();te!=null&&($+=te+ys),oe.current.style.scrollMarginTop="".concat($+ys,"px"),oe.current.scrollIntoView({behavior:"smooth"})}})}))},[o,oe.current,ze,$s,Xs,Ys]);const{showDebugConversationTurns:Ca}=Un(),Ea=!We&&!Be&&!rs&&!G,ka=(w==null?void 0:w.author.role)===Y.Assistant?w:null,ja=(_t=(xt=w==null?void 0:w.metadata)==null?void 0:xt.system_hints)==null?void 0:_t.includes(Pe.Research),Ra=(It=(Tt=w==null?void 0:w.metadata)==null?void 0:Tt.system_hints)==null?void 0:It.includes(Pe.Agent);Po({isCompletionRequestInProgress:ce,isUserTurn:G,message:ka});const{isOpen:Aa}=hn(),Ma=No(),Ke=Vo(Vs),Fa=Ji(i=>i.voiceFeedbackThread),Js=Os===Fa,Pa=(St=r==null?void 0:r.metadata)==null?void 0:St.async_source,Qe=a&&xa,Te=$e||ce||ba,Zs=de.length===0&&R.some(Zi),Na=((yt=C(de))==null?void 0:yt.author.name)===eo.A8KM123,Xe=!Fs&&!Zs&&!We&&!Be&&!Ke&&!Aa&&x.role!==Y.Developer&&!(x.role===Y.User&&m)&&!(a&&Js&&Te)&&!(Qe&&Te)&&!(a&&$e&&Pa)&&!(Te&&N)&&!(Na&&!a)&&!((wt=r==null?void 0:r.metadata)!=null&&wt.is_auto_proceed_message)&&!((Ct=r==null?void 0:r.metadata)!=null&&Ct.is_takeover_ended_message)&&!((Et=r==null?void 0:r.metadata)!=null&&Et.disable_turn_actions)&&!wa,Va=!Xe&&!(Qe&&Te)&&(We||Be)&&!v,Ua=R.some(i=>so(i)===to.l1239dk1),bs=ke(s,i=>{var _,$;const u=new Set,b=L.getParentPromptNode(i,q.id);return($=(_=b==null?void 0:b.message.metadata)==null?void 0:_.attachments)==null||$.forEach(te=>{var Se,re,Me;(Se=te.mime_type)!=null&&Se.startsWith("image/")||u.add((Me=(re=te.context_connector_info)==null?void 0:re.context_connector)!=null?Me:"file")}),u}),vs=no(),xs=ln(h,"110789670");let Ie;vs.isLoading?Ie=void 0:vs.canUpgradeGDrive&&bs.has(ts.GDRIVE)&&xs.get("enabled",!1)?Ie=ts.GDRIVE:vs.canUpgradeSharepoint&&bs.has(ts.O365_BUSINESS)&&xs.get("enabled",!1)?Ie=ts.O365_BUSINESS:bs.has("file")&&xs.get("enabled",!1)&&(Ie="general");const Da=Qe&&!ce&&!v&&!We&&!Be&&!Ua&&(ee||Uo(h)||He||ue||!!Ie),je=r!=null&&(!O||na||X||us)&&!Ke&&!Ds&&!rs&&!((kt=r.metadata)!=null&&kt.b1de6e2_s),et=$e||ce,[Ga,Ha]=g.useState(!1),La=!!((jt=P==null?void 0:P.metadata)!=null&&jt.dictation&&((Rt=P==null?void 0:P.metadata)!=null&&Rt.dictation_asset_pointer)&&!((At=P==null?void 0:P.metadata)!=null&&At.dictation_edited)),Oa=!!(!U||Ga||(Mt=P==null?void 0:P.metadata)!=null&&Mt.audio_paragen_result||fn(P==null?void 0:P.id)),st=La&&!Oa,tt=st&&(!O||us)&&je&&!et&&!v&&!ze&&P!=null&&Oe&&Ce(h,"51772912"),qa=Do(P==null?void 0:P.id,tt),nt=tt&&qa,Ye=!Ke&&Ea&&a&&(gs==null?void 0:gs.num_variants_in_stream)===2&&me.length<=2&&!((Ft=r==null?void 0:r.clientMetadata)!=null&&Ft.inlineComparisonRating)&&!ia&&!st&&!fn(P==null?void 0:P.id),at=!nt&&(!O||us)&&je&&(Qe||a&&Js)&&!et&&!v&&!ze&&!N,it=!((ce||$e)&&a)&&me.length>1&&!Ye,ot=G&&R.some(i=>{var u;return(u=pn(i))==null?void 0:u.shouldHideContent}),Ba=G&&ge!=null&&!((Pt=ge==null?void 0:ge.metadata)!=null&&Pt.async_task_title)&&Os!=null&&!Ke&&!da&&!ot&&!Ds&&!ja&&!Ra&&!v,Wa=r!=null&&cn.getAudioAssetPointers(r).length>0,$a=r!=null&&((Vt=(Nt=r.clientMetadata)==null?void 0:Nt.disclaimers)!=null?Vt:[]).length===0&&!v&&(!rs||Wa),za=ao(h)&&zs,rt=g.useCallback(i=>{var u;pe(s,b=>{ks.setCurrentBranch(b,me[i])}),Ss.logEvent("Change Active Node",{intent:"toggle_between"}),Ce(h,"4126691920")&&Go({parent_prompt_id:(u=_e==null?void 0:_e.id)!=null?u:"",prev_branch_id:me[qe],next_branch_id:me[i]},Ne(s))},[s,me,qe,_e==null?void 0:_e.id,h]),Ka=Ho(x,R,Ca),Qa=N&&Lo(R,a),{toggleThreadSidebar:lt}=io(),Je=r==null?void 0:r.id,ct=g.useCallback(()=>{Je&&lt({type:"retrievalResults",clientThreadId:s,turnIndex:e,messageId:Je})},[Je,lt,s,e]),Re=!1,dt=g.useMemo(()=>Oo(x,Le,!!ve),[x,Le,ve]),Xa=g.useMemo(()=>dt&&!Re,[dt,Re]),Ya=g.useMemo(()=>qo(x,!!ve,j),[j,ve,x]),ut=Ce(h,"2137702454"),Ja=g.useMemo(()=>x.role!==Y.User&&Le&&(ut||Re),[x,Le,ut,Re]),Za=oo()&&CSS.supports("content-visibility: auto")&&!G&&ln(h,"1011775750").get("enabled",!1)&&!Bo(R)&&!J,ei=g.useMemo(()=>R.some(i=>{var u;return((u=pn(i))==null?void 0:u.canRetry)===!1}),[R]),si=(Ut=r==null?void 0:r.metadata)==null?void 0:Ut.n7jupd_button_type,ti=N&&r!=null&&r.id!=null&&!si,ni=N&&a&&Te,ai=N&&a;if(!Ka&&!Ye&&!fe)return Hs?t.jsx("div",{style:Cs()}):null;if(Qa||K)return null;const ii=(Dt=w==null?void 0:w.metadata)!=null&&Dt.followup_prompts?w.metadata.followup_prompts.map(i=>({text:i,type:Wo.Reply})):[],oi=(Gt=w==null?void 0:w.metadata)==null?void 0:Gt.category_suggestions,ri=(Ht=w==null?void 0:w.metadata)==null?void 0:Ht.action_suggestions,li=(Lt=w==null?void 0:w.metadata)==null?void 0:Lt.pineapple_tool_suggestions,ci=!R.some(i=>cn.getAudioAssetPointers(i).length>0)&&!ve&&!ei,di=!ce&&R.some(i=>{var u,b;return i.author.role===Y.Assistant&&((b=(u=i.metadata)==null?void 0:u.onboarding)==null?void 0:b.main_usages)}),_s=R.find(i=>{var u,b;return!!((b=(u=i.metadata)==null?void 0:u.onboarding)!=null&&b.examples)}),Ts=(qt=(Ot=_s==null?void 0:_s.metadata)==null?void 0:Ot.onboarding)==null?void 0:qt.examples,mt=!ot&&(!a||!ce);if(!a&&Qs.length===0&&!N&&!fe)return null;let Ae="none";G&&ms&&(Ae="first");const ui=D==null?void 0:D.messages.some(rn);G&&!ms&&(ui?Ae="large":Ae="none"),a&&(Ae="last");const mi=(()=>{if(G&&!Xe&&Rs(h)&&E)return"mb-4";if(G&&!Xe&&!v)return"mb-10";if(!G&&v&&a)return"pb-[40px]"})();return t.jsx($o.Provider,{value:Oe,children:t.jsxs(zo,{children:[t.jsx(Ko,{dateHeaderType:d,turn:x}),t.jsxs("article",{className:ae("text-token-text-primary w-full focus:outline-none","[--shadow-height:45px] has-data-writing-block:pointer-events-none has-data-writing-block:-mt-(--shadow-height) has-data-writing-block:pt-(--shadow-height) [&:has([data-writing-block])>*]:pointer-events-auto",Za&&"[content-visibility:auto] supports-[content-visibility:auto]:[contain-intrinsic-size:auto_100lvh]",!M&&o==="finalAgentTurn"&&y?"opacity-0":"",{hidden:ea&&ms},G?"scroll-mt-(--header-height)":"scroll-mt-[calc(var(--header-height)+min(200px,max(70px,20svh)))]"),tabIndex:-1,style:Hs?Cs():void 0,ref:oe,dir:"auto","data-turn-id":x.id,"data-testid":"conversation-turn-".concat(e),"data-scroll-anchor":!M&&a,"data-turn":G?"user":"assistant",children:[t.jsx(Qo,{role:x.role,gizmo:cs}),t.jsx(Xo,{role:x.role,children:t.jsxs(Yo,{horizontalPadding:Ye||T?"none":"standard",verticalPadding:Ae,children:[Ye?t.jsxs(t.Fragment,{children:[t.jsx(Nr,W({isFeedbackEnabled:je,variantIds:me,conversationTurnMountTime:pa},n)),ua&&t.jsx("div",{className:"mt-4 flex w-full justify-center",children:t.jsxs(Vn,{color:"secondary",className:"text-token-text-primary","data-testid":"paragen-skip-button",onClick:()=>{Nn.publish({kind:"requestCompletion",isForSkippingParagen:!0})},children:[t.jsx(Jo,{className:"text-token-text-secondary me-1"}),t.jsx(ne,{id:"IuTr+b",defaultMessage:"Skip"})]})})]}):t.jsxs(Wn,{tabIndex:-1,className:ae("group/turn-messages focus-visible:outline-hidden",fe&&"super-widget-visible",mi,br({isUserTurn:G})),children:[sa&&t.jsx(Zo,{gizmo:cs}),fe&&t.jsx(er,{clientThreadId:s,query:we?Ve(we):null,state:ps}),Ja&&t.jsx(sr,{handleShowRetrievalResults:ct,clientThreadId:s,turnIndex:e,responseComplete:!Te,className:"mb-6"}),!G&&t.jsx(Ur,{messages:R,clientThreadId:s,gizmoId:xe==null?void 0:xe.gizmo.id}),R.some(i=>{var u,b,_;return(_=(u=i.metadata)==null?void 0:u.async_completion_id)!=null?_:G&&((b=i.metadata)==null?void 0:b.async_task_title)})&&t.jsx(tr,{message:R.find(i=>{var u,b,_;return(_=(u=i.metadata)==null?void 0:u.async_completion_id)!=null?_:G&&((b=i.metadata)==null?void 0:b.async_task_title)}),clientThreadId:s,isUserTurn:G}),Ma&&G&&t.jsx(Dr,{clientThreadId:s,messages:R}),Fs&&ge?t.jsx(kn,{message:ge,clientThreadId:s,onRequestCompletion:l,onExitEdit:ga,disabled:Bs}):t.jsx(ws,he(W({allMessages:A,groupedMessagesToRender:B,allGroupedMessages:S},n),{isUserTurn:G,isFinalUserTurn:oa,isFinalAssistantTurn:ra,isWithinFirstAssistantTurns:la,isCompletionRequestInProgress:ce,isFeedbackEnabled:je,isFinalTurn:a,isGlauxTurn:Re,hasActiveRequest:Bs,isAgentTurn:N,isMercuryTurn:J,isKAUR1BR5:ie,query:we?Ve(we):null,wasInterrupted:Zs,superWidgetImages:(Bt=ye==null?void 0:ye.content.widgets.images)!=null?Bt:null,lastAgentMetadataNode:Z,hideSearchGPTQuery:za})),Xa&&(V&&Ya?t.jsx(Gr,{turnIndex:e,clientThreadId:s,variant:"bottom"}):t.jsx(nr,{handleShowRetrievalResults:ct,clientThreadId:s,turnIndex:e,responseComplete:!Te})),ti&&t.jsx(ar,{message:r,clientThreadId:s,turnIndex:e,referenceMessageId:r.id,responseComplete:!a||!ce}),di&&t.jsx(ir,{clientThreadId:s}),Ts&&Ts.length>0&&!ce&&t.jsx(or,{clientThreadId:s,examples:Ts}),Xe&&t.jsx(rr,{isUserTurn:G,alwaysShow:!0,children:G?v?null:t.jsx(lr,{activeVariantIndex:qe,clientThreadId:s,numVariants:me.length,onAnticipateEdit:kn.prefetch,onChangeIndex:rt,onEnterEdit:ma,showCopyButton:mt,showEditMessageButton:Ba,showPagination:it,turnIndex:e}):t.jsxs(t.Fragment,{children:[t.jsx(cr,{activeVariantIndex:qe,clientThreadId:s,conversationMode:Vs,lastMessage:r,messages:R,numVariants:me.length,onChangeIndex:rt,onRate:fa,showCanvasButton:Sa,showCopyButton:mt,showPagination:it,showPlayButton:$a,showRatingButtons:je,showRegenerateButton:ci,turn:x,turnIndex:e,parentPrompt:_e,isAgentTurn:N,isKAUR1BR5:ie}),t.jsx(t.Fragment,{children:!k&&t.jsx(bn,{clientThreadId:s,message:r,turnIndex:e,isAgentTurn:N})}),at&&t.jsx(dr,{canShowInlineMessageFeedback:Ns,clientThreadId:s,messageForRating:r}),!1]})}),ni&&t.jsx(ur,{clientThreadId:s}),ai&&t.jsx(mr,{clientThreadId:s,messages:R}),Va&&t.jsx(bn,{clientThreadId:s,message:r,turnIndex:e,isAgentTurn:N}),at&&t.jsx(gr,{canShowInlineMessageFeedback:Ns,clientThreadId:s,messageForRating:r,allGroupedMessages:S,currentModelId:c}),t.jsx(xi,{mode:"wait",children:nt&&t.jsx(hr,{lastUserMessageId:P.id,setIsDismissed:Ha})}),Da&&(Ie?t.jsx(fr,{clientThreadId:s,connectorToUpsell:Ie,analyticsMetadata:Ms}):t.jsx(pr,{followups:ii,actionSuggestions:ri,pineappleToolSuggestions:li,categorySuggestions:oi,clientThreadId:s,lastMessageId:Je,analyticsMetadata:Ms,isTatertotFollowupsEnabled:ue}))]}),t.jsx(vr,{clientThreadId:s,turn:x,isFinalTurn:a}),t.jsx(xr,{clientThreadId:s,turn:x})]})})]})]})})}const Lr=({clientThreadId:n,turn:e,turnIndex:a,conversationTurnWrapperRef:s})=>{const l=_r();g.useEffect(()=>{if(!l)return;const c=new IntersectionObserver(o=>{o.forEach(d=>{d.isIntersecting?pe(n,m=>{var T;m.turnIdsInViewpoint=[...(T=m.turnIdsInViewpoint)!=null?T:[],{turnId:e.id,turnIndex:a,role:e.role}]}):pe(n,m=>{var T;m.turnIdsInViewpoint=(T=m.turnIdsInViewpoint)==null?void 0:T.filter(({turnId:h})=>h!==e.id)})})},{root:null,threshold:.1});return s.current&&c.observe(s.current),()=>{pe(n,o=>{var d;o.turnIdsInViewpoint=(d=o.turnIdsInViewpoint)==null?void 0:d.filter(({turnId:m})=>m!==e.id)}),c.disconnect()}},[n,s,l,e.id,e.role,a])},rl=bi.memo(Hr);function As(n,e,a){var s,l,c;return n===0?e[0]?Ve(e[0]):null:(c=(l=(s=a[n])==null?void 0:s.widgets)==null?void 0:l.query)!=null?c:null}function is(n,e,a){var s,l,c,o,d;return((c=(l=(s=n==null?void 0:n.widgets)==null?void 0:s[a])==null?void 0:l.length)!=null?c:0)>0||((d=(o=e==null?void 0:e[a])==null?void 0:o.length)!=null?d:0)>0?0:e&&Mr(e,a)?1:2}function Or(n,e,a,s,l){const c=s[n],o=As(n,a,s),d=o?l[o]:void 0;switch(e){case p.Search:return is(c,d,"navlinks");case p.Images:return is(c,d,"images");case p.Videos:return is(c,d,"videos");case p.News:return is(c,d,"news");default:return 2}}function qr(n,e,a,s,l){var T,h;const c={content_type:On.SuperWidget,widgets:W({},(h=(T=a[n])==null?void 0:T.widgets)!=null?h:{navlinks:[],images:[],videos:[],news:[],news_tab_enabled:!0})},o=As(n,l,a),d=o?s[o]:void 0;d&&(d.navlinks.length>0&&(c.widgets.navlinks=d.navlinks),d.images.length>0&&(c.widgets.images=d.images),d.videos.length>0&&(c.widgets.videos=d.videos),d.news.length>0&&(c.widgets.news=d.news));let m=!1;switch(e){case p.Search:m=c.widgets.navlinks.length>0?!1:ns(o,"navlinks");break;case p.Images:m=c.widgets.images.length>0?!1:ns(o,"images");break;case p.Videos:m=c.widgets.videos.length>0?!1:ns(o,"videos");break;case p.News:m=c.widgets.news.length>0?!1:ns(o,"news");break;case p.Chat:break}return[c,m]}function ll(){const[n,e]=Dn(l=>[Hn(l),Gn(l)]),a=Cr(),s=Er();return n&&!e&&!a&&!s}function Jn(){const n=Ge(),e=Ln(()=>Xn());return typeof e=="boolean"?e:co(n,"694761886").get("news_tab_enabled",!0)}function cl({className:n,textClassName:e}){const a=Ge(),s=Rs(a),[l,c]=Qn(),o=Jn(),d=uo.useStore(),m=mo(),T=js(a);g.useEffect(()=>{!o&&l===p.News&&c({tabType:p.Chat})},[o,c,l]);function h(I){if(c({tabType:I}),I!==p.Chat){const M=d.getActiveSystemHintType();M&&M!==Pe.Search&&m(null)}}return T?s?t.jsx(Rr,{selectedTab:l,selectTab:h,className:n,textClassName:e,showNewsTab:o}):t.jsxs("div",{className:ae("flex gap-8.5",n),children:[t.jsx(Fe,{className:e,$selected:l===p.Chat,onClick:()=>h(p.Chat),children:t.jsx(ne,W({},Ee.chatTab))}),t.jsx(Fe,{className:e,$selected:l===p.Search,onClick:()=>h(p.Search),children:t.jsx(ne,W({},Ee.linksTab))}),t.jsx(Fe,{className:e,$selected:l===p.Images,onClick:()=>h(p.Images),children:t.jsx(ne,W({},Ee.imagesTab))}),t.jsx(Fe,{className:e,$selected:l===p.Videos,onClick:()=>h(p.Videos),children:t.jsx(ne,W({},Ee.videosTab))}),o&&t.jsx(Fe,{className:e,$selected:l===p.News,onClick:()=>h(p.News),children:t.jsx(ne,W({},Ee.newsTab))})]}):null}var Mn;const Fe=Es.button(Mn||(Mn=es(["\n  ","\n"])),({$selected:n})=>n?"text-token-text-primary font-medium":"text-token-text-tertiary hover:text-token-text-secondary"),Br={[p.Chat]:()=>null,[p.Search]:yr,[p.Images]:Kn,[p.Videos]:zn,[p.News]:$n},Wr={[p.Chat]:()=>null,[p.Search]:wr,[p.Images]:Kn,[p.Videos]:zn,[p.News]:$n};function $r({userMessages:n,superWidgetMessageContents:e,tab:a,scrollToMessageId:s,isNewsTabEnabled:l}){"use forget";const c=Ge(),o=g.useRef({});function d(f,E="smooth"){const v=o.current[f];v&&v.scrollIntoView({behavior:E,block:"start"})}g.useEffect(()=>{requestAnimationFrame(()=>{if(n.length>0){const f=n[n.length-1];f&&d(f.id,"instant")}})},[]),g.useEffect(()=>{setTimeout(()=>{s&&d(s)},50)},[s]);const m=kr(f=>f.entries);if(a===p.News&&!l)return null;const T=Rs(c),h=T?Wr[a]:Br[a],I=a===p.Search||a===p.Videos||a===p.News,M=n.map((f,E)=>Or(E,a,n,e,m));return t.jsx("div",{className:ae("flex w-full flex-col pt-2",T&&"thread-sm:px-2 px-4",I?"gap-4":"gap-10"),children:jr(n.length,f=>{if(M[f]!==0&&f!==n.length-1)return null;const E=As(f,n,e);return t.jsxs("div",{className:"w-full",children:[f>0&&t.jsx("hr",{className:ae("border-heavy w-full",T?"pb-4.5":"pb-1.5")}),t.jsx("div",{className:ae(T?I?"mb-4":"mb-6":I?"mb-2.5":"mb-6","flex items-center text-base",T?"scroll-mt-6":"scroll-mt-4",f>0&&"mt-2.5"),ref:v=>{o.current[n[f].id]=v},children:t.jsx(zr,{queryText:E,tab:a,isKirklandEnabled:T})}),(()=>{var O,z;const[v,F]=qr(f,a,e,m,n),X=(f===0||((z=(O=e[f])==null?void 0:O.widgets)==null?void 0:z.query)!==void 0)&&!F;return v&&X?t.jsx(h,{content:v,turnIndex:f}):t.jsx("div",{style:Cs(),children:t.jsx("div",{className:"result-streaming pulse",children:t.jsx("span",{})})})})()]},f)})})}function zr(n){"use forget";const e=Pn.c(11),{queryText:a,tab:s,isKirklandEnabled:l}=n;if(!a)return null;if(l){let o;e[0]!==a||e[1]!==s?(o=Ar(a,s),e[0]=a,e[1]=s,e[2]=o):o=e[2];let d;e[3]!==o?(d=t.jsx(Fr,{href:o}),e[3]=o,e[4]=d):d=e[4];let m;return e[5]!==a||e[6]!==d||e[7]!==s?(m=t.jsx(Pr,{queryText:a,tabType:s,searchIt:d}),e[5]=a,e[6]=d,e[7]=s,e[8]=m):m=e[8],m}let c;return e[9]!==a?(c=t.jsx("div",{dir:"auto",className:"text-token-text-tertiary flex max-w-[var(--user-chat-width,70%)] min-w-0 text-start text-sm",children:t.jsx(ne,he(W({},Ee.resultsFor),{values:{prefix:Qr,query:t.jsx("span",{className:"min-w-0 flex-1 truncate",children:a}),trailingQuote:Kr}}))}),e[9]=a,e[10]=c):c=e[10],c}function Kr(n){return t.jsx("span",{"aria-hidden":"true",className:"shrink-0",children:n})}function Qr(n){return t.jsx("span",{className:"shrink-0",children:n})}function dl(n){"use forget";var U,x,K,D,A,S;const e=Pn.c(34),{clientThreadId:a,children:s}=n,l=Ge(),c=Jn(),[o,d]=Qn(),[m,T,h]=ke(a,Yr),I=T[T.length-1],M=(x=(U=I==null?void 0:I.content)==null?void 0:U.widgets)==null?void 0:x.news_tab_enabled;let f,E;e[0]!==M?(f=()=>{Xn.set(typeof M=="boolean"?M:void 0)},E=[M],e[0]=M,e[1]=f,e[2]=E):(f=e[1],E=e[2]),g.useEffect(f,E);let v,F;e[3]!==c||e[4]!==d||e[5]!==o?(v=()=>{!c&&o===p.News&&d({tabType:p.Chat})},F=[c,d,o],e[3]=c,e[4]=d,e[5]=o,e[6]=v,e[7]=F):(v=e[6],F=e[7]),g.useEffect(v,F);let X;e[8]!==l||e[9]!==c||e[10]!==((D=(K=I==null?void 0:I.content)==null?void 0:K.widgets)==null?void 0:D.query)||e[11]!==o||e[12]!==m[0]?(X=()=>{var N,J,Z,ie,R;const H=m[0],q=H?Ve(H):null,r=(Z=(J=(N=I==null?void 0:I.content)==null?void 0:N.widgets)==null?void 0:J.query)!=null?Z:"",Q=((R=(ie=r==null?void 0:r.trim())==null?void 0:ie.length)!=null?R:0)>0?r:q;Q&&(o==="search"?as(l,Q,"navlinks"):o==="images"?as(l,Q,"images"):o==="videos"?as(l,Q,"videos"):o==="news"&&c&&as(l,Q,"news"))},e[8]=l,e[9]=c,e[10]=(S=(A=I==null?void 0:I.content)==null?void 0:A.widgets)==null?void 0:S.query,e[11]=o,e[12]=m[0],e[13]=X):X=e[13];let O;if(e[14]!==l||e[15]!==c||e[16]!==I||e[17]!==o||e[18]!==m?(O=[l,o,m,c,I],e[14]=l,e[15]=c,e[16]=I,e[17]=o,e[18]=m,e[19]=O):O=e[19],g.useEffect(X,O),!js(l))return s;const z=o===p.Chat?"block":"hidden";let V;e[20]!==s||e[21]!==z?(V=t.jsx("div",{id:"mini-chat-content",className:z,children:s}),e[20]=s,e[21]=z,e[22]=V):V=e[22];let j;e[23]!==c||e[24]!==h||e[25]!==o||e[26]!==T||e[27]!==m?(j=o!==p.Chat&&(o!==p.News||c)&&t.jsx($r,{userMessages:m,superWidgetMessageContents:T.map(Xr),tab:o,scrollToMessageId:h,isNewsTabEnabled:c},o),e[23]=c,e[24]=h,e[25]=o,e[26]=T,e[27]=m,e[28]=j):j=e[28];let k;e[29]!==j?(k=t.jsx(Wn,{children:j}),e[29]=j,e[30]=k):k=e[30];let y;return e[31]!==k||e[32]!==V?(y=t.jsxs("div",{children:[V,k]}),e[31]=k,e[32]=V,e[33]=y):y=e[33],y}function Xr(n){return n.content}function Yr(n){return[L.getUserMessages(n).filter(Jr),L.getSuperWidgetMessages(n),n==null?void 0:n.scrollToMessageId]}function Jr(n){var e;return!((e=n.metadata)!=null&&e.is_visually_hidden_from_conversation)}const Ee=Fn({chatTab:{id:"CSsJbp",defaultMessage:"Chat"},linksTab:{id:"U43uU/",defaultMessage:"Links"},imagesTab:{id:"ZY9oIP",defaultMessage:"Images"},videosTab:{id:"C8mH8+",defaultMessage:"Videos"},newsTab:{id:"RxIkHj",defaultMessage:"News"},resultsFor:{id:"V5ZXix",defaultMessage:"<prefix>Results for “</prefix>{query}<trailingQuote>”</trailingQuote>"}});export{rl as C,cl as S,dl as a,ll as u};
//# sourceMappingURL=k5jwqq80a0png05z.js.map
