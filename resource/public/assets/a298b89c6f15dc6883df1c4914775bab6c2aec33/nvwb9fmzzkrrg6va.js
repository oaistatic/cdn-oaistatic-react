const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/nm0e6hmkl4nsh2d4.js","assets/n75kuy1cx6f5mogg.js","assets/ewse8exzafeu10ji.js","assets/root-l2v84m1w.css","assets/ny10lj7zpuz89fvf.js","assets/conversation-small-hotcas67.css","assets/hp56atvrtol0eb47.js","assets/ggf5upe1rvhe0y6r.js","assets/f8qcx5r3ombc6w5p.js","assets/iogh0tx5dnoufuv6.js","assets/ldq3nzd52ms5m3ld.js","assets/oxsttjlzxjfu1qdb.js","assets/l1bl9nxwf9lhfsng.js","assets/l7zwbn46b1xq4jpt.js","assets/byq2jfs2d5331lqi.js","assets/ou1s0kowmldvhx32.js","assets/ltsv6em2m484o9yy.js","assets/pa7wf55rjdocapqd.js","assets/jocaiq9wugboh64i.js","assets/idgulvc6m31b3k88.js","assets/lep2wptoy14cfe2w.js","assets/n1zi1frmhwo1ei8c.js","assets/em5q5yhbyv41ft0j.js","assets/f4bsrb68xtlmldi5.js","assets/l351nx0zzb742rw6.js","assets/iiok29s29bpdre61.js","assets/f1u8g9x7n87l0t74.js","assets/j4iu4cyxlby9nd33.js","assets/jx9lof8tzg97x4l9.js","assets/fmsmhem5hrm2cxrs.js","assets/e2tpmvaykwot5faa.js","assets/ne36kgu5w1zang50.js","assets/frf4c35l48b0bjrb.js","assets/h76aawyn0y8q6s6p.js","assets/ocpay82kuu2581xo.js","assets/jhe3wdj1wdglvpku.js","assets/ansi-1f6vhsjh.css","assets/ey5pnyyp5gz5jeun.js","assets/j91jff36pcuewy8o.js","assets/iqk1tse6yz14y9t9.js","assets/ce3hgmw4iyyhicud.js","assets/e79nci3z6bwkg1aw.js","assets/j2tluvxda4ll72qx.js","assets/d0p97pwfptqt3nvy.js","assets/ly9hghfho7bi4z70.js","assets/hkwix64yhkotslv1.js","assets/5hoqitp3r2hkdtny.js","assets/ctddpbsbr3gj60l1.js","assets/l4fgj5ewfyihgm1a.js","assets/cl7dmrzdmwy44poc.js","assets/kkcke7zkpz7m4enu.js","assets/npn63o3tt9liv4y2.js","assets/heyok871zyju5auh.js","assets/kl7c6054usfnqmd4.js","assets/k97n0y6ba9c9h39c.js","assets/ezgtgas8dtpm62t5.js","assets/fzk9fwuo4wro7wsn.js","assets/kivo09shwglpcqd0.js","assets/bbwdjqfyrcn310kz.js","assets/ehwaewo3sh746gw7.js","assets/dkl2thjm5w0efkns.js","assets/e0z6030ycsi62lhu.js","assets/ff22qitacijlmqi9.js","assets/fna9z31n721lpf9f.js","assets/table-components-iztk4amh.css"])))=>i.map(i=>d[i]);
var dn=Object.freeze,mn=Object.defineProperty,Fo=Object.defineProperties;var Oo=Object.getOwnPropertyDescriptors;var Pt=Object.getOwnPropertySymbols;var fn=Object.prototype.hasOwnProperty,hn=Object.prototype.propertyIsEnumerable;var rs=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t);var un=(t,e,s)=>e in t?mn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,B=(t,e)=>{for(var s in e||(e={}))fn.call(e,s)&&un(t,s,e[s]);if(Pt)for(var s of Pt(e))hn.call(e,s)&&un(t,s,e[s]);return t},G=(t,e)=>Fo(t,Oo(e));var pn=t=>typeof t=="symbol"?t:t+"",ye=(t,e)=>{var s={};for(var a in t)fn.call(t,a)&&e.indexOf(a)<0&&(s[a]=t[a]);if(t!=null&&Pt)for(var a of Pt(t))e.indexOf(a)<0&&hn.call(t,a)&&(s[a]=t[a]);return s};var ut=(t,e)=>dn(mn(t,"raw",{value:dn(e||t.slice())}));var At=function(t,e){this[0]=t,this[1]=e},gn=(t,e,s)=>{var a=(i,l,c,d)=>{try{var u=s[i](l),m=(l=u.value)instanceof At,x=u.done;Promise.resolve(m?l[0]:l).then(b=>m?a(i==="return"?i:"next",l[1]?{done:b.done,value:b.value}:b,c,d):c({value:b,done:x})).catch(b=>a("throw",b,c,d))}catch(b){d(b)}},o=i=>r[i]=l=>new Promise((c,d)=>a(i,l,c,d)),r={};return s=s.apply(t,e),r[rs("asyncIterator")]=()=>r,o("next"),o("throw"),o("return"),r};var is=(t,e,s)=>(e=t[rs("asyncIterator")])?e.call(t):(t=t[rs("iterator")](),e={},s=(a,o)=>(o=t[a])&&(e[a]=r=>new Promise((i,l,c)=>(r=o.call(t,r),c=r.done,Promise.resolve(r.value).then(d=>i({value:d,done:c}),l)))),s("next"),s("return"),e);import{j as n,M as z,b as K,r as f,v as Bo,a as Ta,m as Ut,c as ve,d as Qt,x as Wo,f as zo,h as Ho,o as Ea,g as Uo,R as $a,e as ls,A as xn}from"./n75kuy1cx6f5mogg.js";import{S as qo}from"./ltsv6em2m484o9yy.js";import{M as Go,r as Vo,a as Xo,f as Zo,b as Yo,c as Ko,m as Pa,u as Ss,R as Ns,d as Ms,S as Ts,e as Jo,I as Qo,g as er,C as tr,h as sr,i as nr,j as ar,k as or}from"./pa7wf55rjdocapqd.js";import{CK as rr,CL as ir,CM as cs,CN as qe,gW as Aa,aT as La,a3 as Ws,v4 as lr,o9 as cr,eG as es,CO as dr,dC as ur,t as mr,X as vt,fk as Oe,fi as fr,cM as hr,dW as Es,ld as pr,jx as zs,o6 as Hs,jv as Us,jw as qs,CP as gr,gK as Ra,gL as xr,gu as br,js as yr,h8 as wr,vt as vr,s_ as ds,ob as _r,CQ as jr,CR as kr,e as Cr,v8 as Sr,v9 as Nr,va as Mr,CS as Tr,wd as Er,ck as Ia,bJ as Da,CT as $r,vM as Pr,CU as Ar,CV as Lr,gR as Rr,nA as Ir,nB as Dr,nC as Fr,eR as Or,k4 as Br,CW as Wr,cO as zr,mq as Hr,mo as Ur,CX as Bt,ml as nt,CY as qr,CZ as Gr,mu as $s,le as Gs,C_ as Vr,C$ as Fa,D0 as Vs,e6 as Xr,dm as Oa,dF as Xs,D1 as Zs,D2 as Zr,mm as ts,cD as pt,lc as Yr,S as Kr,cq as Jr,tD as Ba,D3 as Wa,D4 as Qr,oy as ei,D5 as ti,h3 as si,D6 as za,lK as ni,nG as ai,D7 as oi,dE as Ys,D8 as Ha,aQ as Ua,D9 as ri,Da as ii,Db as li,cL as ci,cN as di,nJ as ui,jj as mi,Dc as fi,Dd as hi,De as pi,Df as gi,dZ as xi,c_ as bi,bG as Ps,d1 as qa,d2 as Ga,Dg as yi,Dh as wi,Di as vi,c8 as _i,mE as ji,Dj as ki,s$ as Ci,vu as Si,Dk as Ni,xH as Mi,Dl as Ti,Dm as Ei,Dn as $i,Do as Pi,cu as Ai,Dp as Li,aL as Ri,iY as Ii,Dq as Di,Dr as Lt,Ds as Fi,Dt as Oi,Du as Bi,Dv as Wi,vS as zi}from"./ny10lj7zpuz89fvf.js";import{e as F,x6 as Hi,aT as it,bJ as lt,bq as Ui,E as _t,f as ct,i as de,j as ce,bH as Ks,pq as qi,a8 as Gi,a2 as Vi,at as dt,ej as Va,ek as Js,fI as Xi,ay as Zi,a3 as bn,ik as Yi,gg as Xa,aj as Ki,L as Za,p as Ya,db as Ji,B as Se,aF as Ge,dO as Qi,dZ as el,d_ as tl,T as Ue,gv as sl,gs as nl,ra as al,aa as jt,P as Fe,bZ as kt,K as ol,ex as ke,fB as Ka,mD as rl,i3 as il,R as Qs,eK as Ct,A as Ja,aV as ll,aZ as cl,iI as dl,aR as Ye,eG as St,iq as Nt,gW as Qa,Z as ss,iV as $e,lL as ul,x7 as ml,hH as fl,h2 as hl,mK as pl,h_ as Mt,_ as Tt,S as gl,s3 as xl,bU as bl,fq as yl,it as wl,kA as vl,is as _l,aE as jl,j4 as kl,J as Cl,hn as us,bI as Sl,F as en,Y as Nl,x8 as Ml,lE as eo,b6 as Tl,nG as to,m$ as ft,au as so,nV as El,ip as $l,af as Pl,x9 as Al,mL as Ll,fy as no,br as Rl,gV as Il,x as Dl,b_ as ms,aS as yn,bY as Fl,a9 as Ol,t as Bl}from"./ewse8exzafeu10ji.js";import{u as tn}from"./n1zi1frmhwo1ei8c.js";import{N as Wl}from"./em5q5yhbyv41ft0j.js";import{g as wn,F as zl,i as Hl}from"./f4bsrb68xtlmldi5.js";import{S as Ul}from"./l351nx0zzb742rw6.js";import{v as ql,u as Gl,P as Vl,W as Xl}from"./ggf5upe1rvhe0y6r.js";import{L as Zl}from"./iiok29s29bpdre61.js";import{W as Yl,c as Kl,b as Jl,a as Ql}from"./jocaiq9wugboh64i.js";import{S as ec}from"./f1u8g9x7n87l0t74.js";import{W as ns}from"./j4iu4cyxlby9nd33.js";import{W as tc}from"./jx9lof8tzg97x4l9.js";import{n as ao,y as sc,W as nc,c as vn}from"./fmsmhem5hrm2cxrs.js";import{u as ac}from"./ocpay82kuu2581xo.js";import{A as oc}from"./jhe3wdj1wdglvpku.js";import{S as rc,c as ic,d as lc}from"./ey5pnyyp5gz5jeun.js";import{A as cc,T as dc,a as uc,b as Rt}from"./j91jff36pcuewy8o.js";import{S as mc,a as fc}from"./l4fgj5ewfyihgm1a.js";import{S as hc}from"./cl7dmrzdmwy44poc.js";import{c as sn}from"./kkcke7zkpz7m4enu.js";import{s as pc}from"./npn63o3tt9liv4y2.js";import{C as _n}from"./heyok871zyju5auh.js";import{d as gc}from"./kl7c6054usfnqmd4.js";import{g as xc}from"./k97n0y6ba9c9h39c.js";import{a as bc}from"./ezgtgas8dtpm62t5.js";import{u as yc}from"./byq2jfs2d5331lqi.js";import{u as wc}from"./ou1s0kowmldvhx32.js";import{S as vc}from"./fzk9fwuo4wro7wsn.js";import{S as _c}from"./kivo09shwglpcqd0.js";import{u as jc,a as kc}from"./bbwdjqfyrcn310kz.js";import{v as jn,C as Cc,A as Sc,h as Nc,j as Mc,f as Tc,p as Ec,k as $c,n as Pc,P as Ac,o as Lc,q as Rc,L as Ic}from"./ehwaewo3sh746gw7.js";import{u as gt,t as kn,r as As,g as Be}from"./dkl2thjm5w0efkns.js";import{T as we}from"./e0z6030ycsi62lhu.js";import{c as oo}from"./ff22qitacijlmqi9.js";import{t as Cn}from"./fna9z31n721lpf9f.js";const Dc=oo("ChevronDownFilled","1em",["M15.8 7.73c.28.3.27.78-.03 1.06l-5.25 5a.75.75 0 0 1-1.04 0l-5.25-5a.75.75 0 0 1 1.04-1.08L10 12.2l4.73-4.5a.75.75 0 0 1 1.06.02Z"]),Fc=oo("ChevronLeftFilled","1em",["M12.27 15.8a.75.75 0 0 1-1.06-.03l-5-5.25a.75.75 0 0 1 0-1.04l5-5.25a.75.75 0 1 1 1.08 1.04L7.8 10l4.5 4.73c.29.3.28.78-.02 1.06Z"]);function Oc(s){var a=s,{children:t}=a,e=ye(a,["children"]);return n.jsxs(Go,G(B({},e),{className:"decorated-link",children:[t,n.jsx("span",{"aria-hidden":!0,className:"ms-0.5 inline-block align-middle leading-none",children:n.jsx(qo,{className:"block h-[0.75em] w-[0.75em] stroke-current stroke-[0.75]"})})]}))}const Sn=({children:t,"data-start":e=null,"data-end":s=null,"data-is-last-node":a,"data-is-only-node":o,tag:r})=>{const{animationTiming:i,shouldAnimate:l,shouldHide:c,isDisabled:d,onComplete:u,onReady:m}=rr({isMarker:!0,tag:r,children:t,start:e,end:s,isLastNode:a,isOnlyNode:o});return d||c?n.jsx(r,{"data-start":e,"data-end":s,className:F(c&&"hidden"),children:t}):n.jsx(r,{"data-start":e,"data-end":s,className:F(cs.marker,l?cs.animate:cs.hidden),onAnimationStart:()=>m(0),onAnimationEnd:()=>u(0),style:ir(i),children:t})},Bc={p:t=>n.jsx(qe,B({tag:"p"},t)),h1:t=>n.jsx(qe,B({tag:"h1"},t)),h2:t=>n.jsx(qe,B({tag:"h2"},t)),h3:t=>n.jsx(qe,B({tag:"h3"},t)),h4:t=>n.jsx(qe,B({tag:"h4"},t)),h5:t=>n.jsx(qe,B({tag:"h5"},t)),h6:t=>n.jsx(qe,B({tag:"h6"},t)),li:t=>n.jsx(Sn,B({tag:"li",isListItem:!0},t)),hr:t=>n.jsx(Sn,B({tag:"hr"},t))};function Wc(t){const e=t.split("\n");Hc(e);const s=e.pop();if(s===":"||s==="::")e.push("");else{const a=zc(s).trimEnd();a&&e.push(a)}return e.join("\n")}function zc(t){if(!t||/^\s*-\s*([*_]+)?\s*$/.test(t))return"";const e=[];let s="",a=0;for(;a<t.length;){if(t[a]==="*"&&t[a+1]==="*"){s+="**",e.length&&e[e.length-1]==="**"?e.pop():e.push("**"),a+=2;continue}if(t[a]==="*"||t[a]==="_"){s+=t[a];const r=t[a];e.length&&e[e.length-1]===r?e.pop():e.push(r),a++;continue}if(t[a]==="["){const r=t[a];s+=r,e.push(r),a++;continue}if(t[a]==="]"){const r=t[a];s+=r,e.length&&e[e.length-1]==="["&&e.pop(),a++;continue}if(t[a]==="("&&t[a-1]==="]"){const r=t[a];s+=r,e.push(r),a++;continue}if(t[a]===")"){const r=t[a];s+=r,e.length&&e[e.length-1]==="("&&e.pop(),a++;continue}s+=t[a],a++}if(e.length===0)return t;let o=s.trimEnd();for(;e.length;){const r=e.pop();if(r==null)break;r==="("?o+=")":o.endsWith(r)?o=o.slice(0,-r.length).trimEnd():r==="["?o+="]()":o+=r}return o}function Hc(t){let e=!1;for(let s=0;s<t.length;s++){const a=t[s];if(Gc(a)){e=!e;continue}if(e)continue;const o=a.trim();if(o.startsWith(":::")&&o!==":::"){const r=o.indexOf("{");if(r===-1){const i=o.slice(3).trim();if(i.length>0&&!(i in Hi)){t[s]=":::";continue}const l=a.replace(/\s+$/,"");t[s]=l+"{}";continue}qc(o,r)||(t[s]=Uc(a,a.indexOf("{")))}t.length>1&&t[t.length-1]===":::"&&t[t.length-2]===":::"&&t.splice(-2)}}function Uc(t,e){const s=t.replace(/\s+$/,""),a=s.slice(0,e).replace(/\s+$/,""),o=s.slice(e+1);if(o.trim().length===0||!/=/.test(o))return a+"{}";let i=null,l=!1;for(let c=0;c<o.length;c++){const d=o[c];if(l){l=!1;continue}if(d==="\\"){l=!0;continue}if(i){d===i&&(i=null);continue}if(d==='"'||d==="'"){i=d;continue}}return i?s+i+"}":/=[\s]*$/.test(o)?s+'""}':s+"}"}function qc(t,e){let s=null,a=0,o=!1;for(let r=e;r<t.length;r++){const i=t[r];if(o){o=!1;continue}if(i==="\\"){o=!0;continue}if(s){i===s&&(s=null);continue}if(i==='"'||i==="'"){s=i;continue}if(i==="{"){a++;continue}if(i==="}"){if(a--,a===0)return!0;continue}}return!1}function Gc(t){return t.trimStart().startsWith("```")}function Vc({citation:t}){return n.jsx(Aa,{side:"top",triggerButton:n.jsx("span",{className:"inline-flex items-center font-bold",children:n.jsx(z,{id:"ZNWtPG",defaultMessage:"{startChar}clipboard {icon}{endChar}",values:{startChar:"「",icon:n.jsx(lr,{className:"mb-1 inline-block size-5"}),endChar:"」"}})}),className:"max-w-xl",children:n.jsxs("div",{className:"flex flex-col items-stretch gap-1",children:[n.jsx("div",{className:"flex justify-end border-b",children:n.jsx(La,{onCopy:e=>Ws(t.text,void 0,e),buttonText:!0,textPosition:"left"})}),n.jsx("div",{children:t.text})]})})}function Xc({citation:t,clientThreadId:e,nodeType:s}){const a=K(),o=it(e),r=cr(t.screenshot_asset_pointer,o);return s==="containerDirective"&&a.formatMessage({id:"4/Vs6a",defaultMessage:"Cited Screenshot"}),n.jsx(Aa,{side:"top",triggerButton:n.jsx("span",{className:"inline-flex items-center font-bold",children:n.jsx(z,{id:"qUxKU1",defaultMessage:"{startChar}screenshot {icon}{endChar}",values:{startChar:"「",icon:n.jsx(es,{className:"mb-1 inline-block size-5"}),endChar:"」"}})}),className:"max-w-xl",children:r?n.jsx("img",{className:"w-xl max-w-screen",src:r,alt:a.formatMessage({id:"4/Vs6a",defaultMessage:"Cited Screenshot"})}):n.jsx("div",{className:"text-sm",children:n.jsx(z,{id:"BUdJTR",defaultMessage:"Screenshot not available"})})})}function ro({clientThreadId:t,messageId:e,fileId:s,fileName:a,processedMarkdownInfo:o,isStandaloneAttachment:r}){const i=it(t),l=lt(t,h=>{var _;return e?(_=h==null?void 0:h.tree.getNodeIfExists(e))==null?void 0:_.message:void 0}),c=f.useMemo(()=>{var v;if(!l)return null;const h={content_type:Ui.Text,parts:["{{file:".concat(s,"}}")]},_=G(B({},l==null?void 0:l.metadata),{is_synthetic_share_message:!0,is_standalone_share_attachment:r});return _.content_references=(v=o==null?void 0:o.displayedContentReferences.filter(C=>C.type!=="debug"))!=null?v:[],_.citations=[],o&&(h.parts=[o.rawText],_.n7jupd_crefs=o.n7jupdCrefs),G(B({},l),{id:Bo(),content:h,metadata:_})},[l,s,o,r]),d=f.useMemo(()=>{if(!(!l||!c||!i))return{previewMessage:c,clientThreadId:t,fileId:s,messageId:l.id,serverThreadId:i,isStandaloneAttachment:r,fileName:a}},[c,t,s,l,i,r,a]),u=dr({odysseyShareIntent:d,clientThreadId:t}),[m,x]=f.useState(!1);return{onClick:f.useCallback(async()=>{x(!0),await u(),x(!1)},[x,u]),isLoading:m,isEnabled:!!d}}function Zc({clientThreadId:t,messageId:e,fileId:s,fileName:a,processedMarkdownInfo:o}){const r=K(),{onClick:i,isLoading:l,isEnabled:c}=ro({clientThreadId:t,messageId:e,fileId:s,fileName:a,processedMarkdownInfo:o,isStandaloneAttachment:!1});return c?n.jsx(ur,{onClick:i,label:r.formatMessage({id:"ConversationTurn.sharePostButtonTooltip",defaultMessage:"Share"}),icon:l?_t:mr}):null}function Yc(t){return t.endsWith(".md")}const Kc=({citation:t,clientThreadId:e,messageId:s})=>{const[a,o]=f.useState(!1),r=it(e),i=ct(),[l,c]=f.useState(null),d=f.useRef(null),u=f.useCallback(j=>{i.danger(j,{toastId:"ttom_file_citation_failed_to_download_file"})},[i]),m=t.file_id,x=de(),b=ce(x,"3154019201"),w=b,h=vt(),_=tn(!0,r,m,void 0,u),v=_==null?void 0:_.data,C=(_==null?void 0:_.isPending)||!1;f.useEffect(()=>{var j;if((v==null?void 0:v.status)==="success"&&v.download_url){(j=d.current)==null||j.abort();const S=new AbortController;d.current=S,o(!0),(async()=>{try{const g=await fetch(v.download_url,{headers:h?{}:Ks(),signal:S.signal});if(!g.ok)throw new Error("HTTP ".concat(g.status));c(await g.text())}catch(g){g.name!=="AbortError"&&i.danger("Failed to download file",{toastId:"ttom_file_citation_failed_to_download_file"})}finally{o(!1)}})()}return()=>{var S;(S=d.current)==null||S.abort()}},[v,i,h]);const k=f.useContext(Oe),y=f.useMemo(()=>{var R,T,M,p,D,W,$,I,O;if(l==null)return null;const S=(p=((M=(T=(R=k==null?void 0:k.message)==null?void 0:R.metadata)==null?void 0:T.content_references_by_file)!=null?M:{})[t.cite_key])!=null?p:[],g=qi(l,S);let N=g.processedText;const P=(D=g.displayedContentReferences)!=null?D:[],E=(O=((I=($=(W=k==null?void 0:k.message)==null?void 0:W.metadata)==null?void 0:$.n7jupd_crefs_by_file)!=null?I:{})[t.cite_key])!=null?O:[];return E.length>0&&(N=fr(N,E)),{processedText:N,displayedContentReferences:P,n7jupdCrefs:E,rawText:l}},[l,k,t.cite_key]);return C||a?n.jsx(_t,{className:"inline"}):!y||!(k!=null&&k.message)?"[Could not display report]":n.jsx(Oe.Provider,{value:G(B({},k),{contentReferences:y.displayedContentReferences,n7jupdCrefs:y.n7jupdCrefs}),children:n.jsxs("div",{className:"border-token-border-light dark:border-token-bg-tertiary @container relative mx-[-16px] mt-4 mb-4 flex cursor-text flex-col items-start overflow-hidden rounded-[14px] border px-4 pt-6 pb-6 contain-inline-size sm:mx-[-32px] sm:rounded-[28px] sm:px-8 sm:shadow-sm",children:[n.jsx("div",{className:"w-full pt-1 pb-1 sm:pt-4 sm:pb-3",children:n.jsx(hr,{clientThreadId:e,componentOverrides:Wl,children:y.processedText})}),w&&n.jsx("div",{className:"flex",children:b&&n.jsx(Zc,{clientThreadId:e,messageId:s,fileId:m,fileName:t.file_name,processedMarkdownInfo:y,isStandaloneAttachment:!1})})]})})},Nn=(t,e)=>{const s=new Zl(new URL("{{.assetPrefix}}/assets/walnut-worker-D0YBDB-v.js",import.meta.url),{type:"module"});return new Promise((a,o)=>{s.onmessage=r=>{var i;s.terminate(),r.data.error?o(new Error(r.data.error)):a((i=r.data.protoBytes)!=null?i:new Uint8Array)},s.onerror=r=>{s.terminate(),o(r)},s.postMessage({bytes:t.buffer,ext:e},[t.buffer])})},Jc="Walnut",Qc={hash:"sha256-cxFiGJTPH/YSMHl8CbBtO2YJSu/OO9llgx0UyKgIBCQ=",fingerprinting:{"DocumentFormat.OpenXml.Framework.zzrbdxy160.wasm":"DocumentFormat.OpenXml.Framework.wasm","DocumentFormat.OpenXml.9kx12hc5a3.wasm":"DocumentFormat.OpenXml.wasm","Google.Protobuf.ymcrlw7ls4.wasm":"Google.Protobuf.wasm","System.Collections.Concurrent.q7k9997daq.wasm":"System.Collections.Concurrent.wasm","System.Collections.NonGeneric.e29je1lh17.wasm":"System.Collections.NonGeneric.wasm","System.Collections.Specialized.za90e6uca4.wasm":"System.Collections.Specialized.wasm","System.Collections.l48alw8ik0.wasm":"System.Collections.wasm","System.ComponentModel.Primitives.o70rgbr7as.wasm":"System.ComponentModel.Primitives.wasm","System.ComponentModel.TypeConverter.83539jv8ad.wasm":"System.ComponentModel.TypeConverter.wasm","System.ComponentModel.0n5errmvx8.wasm":"System.ComponentModel.wasm","System.Diagnostics.DiagnosticSource.g8ajmpm5cd.wasm":"System.Diagnostics.DiagnosticSource.wasm","System.IO.Compression.y5glqpjnb8.wasm":"System.IO.Compression.wasm","System.IO.Packaging.8th4tkd3a0.wasm":"System.IO.Packaging.wasm","System.Linq.Expressions.biujz7ou20.wasm":"System.Linq.Expressions.wasm","System.Linq.6btt3su4oy.wasm":"System.Linq.wasm","System.Memory.m6pzfzg6nf.wasm":"System.Memory.wasm","System.Net.Http.5n712yykv5.wasm":"System.Net.Http.wasm","System.Net.Primitives.0h7y3g6nqf.wasm":"System.Net.Primitives.wasm","System.ObjectModel.7q79mw545v.wasm":"System.ObjectModel.wasm","System.Private.CoreLib.p01w1sybmx.wasm":"System.Private.CoreLib.wasm","System.Private.Uri.4o2ojye61w.wasm":"System.Private.Uri.wasm","System.Private.Xml.Linq.trt4nj2tpp.wasm":"System.Private.Xml.Linq.wasm","System.Private.Xml.fx4cl1bai1.wasm":"System.Private.Xml.wasm","System.Runtime.InteropServices.JavaScript.yoksv99ly5.wasm":"System.Runtime.InteropServices.JavaScript.wasm","System.Text.RegularExpressions.jeufitb0vn.wasm":"System.Text.RegularExpressions.wasm","System.m0fu6d0eya.wasm":"System.wasm","System.Xml.Linq.qsgzs1hc1j.wasm":"System.Xml.Linq.wasm","Walnut.u75jh9o819.wasm":"Walnut.wasm","dotnet.native.349ud2l9o5.js":"dotnet.native.js","dotnet.native.1m7zpjvglu.wasm":"dotnet.native.wasm","dotnet.js":"dotnet.js","dotnet.runtime.st3wwc8rqy.js":"dotnet.runtime.js","icudt_CJK.tjcz0u77k5.dat":"icudt_CJK.dat","icudt_EFIGS.tptq2av103.dat":"icudt_EFIGS.dat","icudt_no_CJK.lfu7j35m59.dat":"icudt_no_CJK.dat"},jsModuleNative:{"dotnet.native.349ud2l9o5.js":"sha256-XXFP8ueCRZ/9neduBaSJOons2XLlYXa2NlP5FnhUKNQ="},jsModuleRuntime:{"dotnet.runtime.st3wwc8rqy.js":"sha256-oBRKHAqZUsvCRnCzkQfB7zc45cpKLNq2NKyrG10IKx8="},wasmNative:{"dotnet.native.1m7zpjvglu.wasm":"sha256-SeYXztl9ztFuzCJUoLlFf/EtB8wHKOelu6wAJ3/gi+w="},icu:{"icudt_CJK.tjcz0u77k5.dat":"sha256-SZLtQnRc0JkwqHab0VUVP7T3uBPSeYzxzDnpxPpUnHk=","icudt_EFIGS.tptq2av103.dat":"sha256-8fItetYY8kQ0ww6oxwTLiT3oXlBwHKumbeP2pRF4yTc=","icudt_no_CJK.lfu7j35m59.dat":"sha256-L7sV7NEYP37/Qr2FPCePo5cJqRgTXRwGHuwF5Q+0Nfs="},coreAssembly:{"System.Private.CoreLib.p01w1sybmx.wasm":"sha256-18HeJL9OcGuyT9IVV5fEjllvMuAKwWG5goaCYZJDU6A=","System.Runtime.InteropServices.JavaScript.yoksv99ly5.wasm":"sha256-PpVo+nXFFVzcQmMcwj3t/pX3t8Gc+Y2rLawKTqz0jn8="},assembly:{"DocumentFormat.OpenXml.Framework.zzrbdxy160.wasm":"sha256-gewmYP6VBCfFJUjxGAmejSGxmz8pJfGHQf0NgrM6MZU=","DocumentFormat.OpenXml.9kx12hc5a3.wasm":"sha256-13lkooL5OK24XESOo9Cmv20rnNku0r0tWucBcL1Ljqw=","Google.Protobuf.ymcrlw7ls4.wasm":"sha256-ut3yq+p97V1SbQ9Zc0baUM07p9J1xZIfW02l4S3Vp5M=","System.Collections.Concurrent.q7k9997daq.wasm":"sha256-luuh8QlNVgtYEcAi6N+VXZUjrLjK5Mohr7YV2Qo44KI=","System.Collections.NonGeneric.e29je1lh17.wasm":"sha256-Wkm1IwLgktv0ufFAqQ2dmijAlJQmf+Fp4FmTlgILYXk=","System.Collections.Specialized.za90e6uca4.wasm":"sha256-5UpgSBxjmzatkMdip0WZHB3ZJJsd+zea3niJtfK/Xco=","System.Collections.l48alw8ik0.wasm":"sha256-pfzSuOk29FRrZOX567k+jaeA3dH92A/XVM7vtYtGhXg=","System.ComponentModel.Primitives.o70rgbr7as.wasm":"sha256-LDo5YlVF1j7HX6cIR9g2sO5xXkPw31mtOO8S6NnbqJc=","System.ComponentModel.TypeConverter.83539jv8ad.wasm":"sha256-fP45xSdHQOHnnNgF9GAkhkSdiLDsVHb3T/01W4ytVW8=","System.ComponentModel.0n5errmvx8.wasm":"sha256-DHujPeYswdt0JOBw03JC11hmqQ+Vtb1K9fkbgtDLtTM=","System.Diagnostics.DiagnosticSource.g8ajmpm5cd.wasm":"sha256-cMsx1BaqBdShCb2hCIIcg1cu8DpCR6mybVTUh61tCWM=","System.IO.Compression.y5glqpjnb8.wasm":"sha256-6mwr7Ug6Xh7nYE5sSoUjQtV7ehgyUiTuL+IETvfEL4U=","System.IO.Packaging.8th4tkd3a0.wasm":"sha256-1C+I5A7ESuL28X57RP+FiTL8ayuTe86SmJE6NSg4dQA=","System.Linq.Expressions.biujz7ou20.wasm":"sha256-M6AwJILP8bI0CD1p7jb1rT7DBE2E2SxUNiT+AArcV/A=","System.Linq.6btt3su4oy.wasm":"sha256-ouzI51Ta1wlktuj2h6VgfMn7RDDjWweSZ7nHHHRnV8k=","System.Memory.m6pzfzg6nf.wasm":"sha256-PsWHMVtxDG4tlLs5Ehnac6R7c/P12MhR2Hkn8UhYqfY=","System.Net.Http.5n712yykv5.wasm":"sha256-8QauHTjEWUMCHnUrtqi7oyjYh442Ih49nJaVLCyUNck=","System.Net.Primitives.0h7y3g6nqf.wasm":"sha256-rGIYM/g7mFHB4tUKXxzKAMTdeOGYJ8NmnYQ66r9vFwE=","System.ObjectModel.7q79mw545v.wasm":"sha256-XzW0DP5J4D5HhpBC9+IEXalmi7K0txtxRQRQloOFshI=","System.Private.Uri.4o2ojye61w.wasm":"sha256-fMF0tbuaB2aa9IXoBrucZrpL8wgrIr9KleX8BZeFpHE=","System.Private.Xml.Linq.trt4nj2tpp.wasm":"sha256-R42st1IgbrLRA1kwuI/YvAOjfn0pqcO7Y/eQZbtn1gg=","System.Private.Xml.fx4cl1bai1.wasm":"sha256-86zH8VBnIMhKsGkh8VEmfC3+Vm0QGzPiHxheWBPJLQQ=","System.Text.RegularExpressions.jeufitb0vn.wasm":"sha256-VSLyK4otYaCqpu8GYBmxEYokWbrAs9m/DliyakK7KMU=","System.m0fu6d0eya.wasm":"sha256-hkGLo/MuT/FJ0Xf4XUL0D2VA4dZV532GHNB1JicxLko=","System.Xml.Linq.qsgzs1hc1j.wasm":"sha256-yo+J3RWIIHIiwAhqsR9JizNkH/+hd3auB44RBmvvLoI=","Walnut.u75jh9o819.wasm":"sha256-1mn+BQUWdJi7VJm8/4GtlNyGXqc+zoIgl8EZ8bgguxg="}},ed=0,td=!0,sd="sharded",nd={mainAssemblyName:Jc,resources:Qc,debugLevel:ed,linkerEnabled:td,globalizationMode:sd};let fs=null;async function ad(){const t=await ql.withConfig(nd).withResourceLoader((s,a,o,r)=>s==="dotnetjs"?o:new URL(o,location.href).origin!==location.origin?fetch(o,{credentials:"omit",integrity:r}):o).create(),e=t.getConfig().mainAssemblyName;return e?t.getAssemblyExports(e):null}function od(){return f.useMemo(()=>(fs||(fs=ad()),fs),[])}const rd=Va(()=>Js(()=>import("./nm0e6hmkl4nsh2d4.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])).then(t=>t.WalnutMiniPlayer)),id=({citation:t,clientThreadId:e,messageId:s})=>{var A,q,U,H,re;const a=od(),[o,r]=f.useState(!1),[i,l]=f.useState(null),[c,d]=f.useState(!1),u=!!((q=(A=f.useContext(Oe))==null?void 0:A.message.metadata)!=null&&q.is_standalone_share_attachment),m=Gi(),{presentationMap:x,updatePresentationMap:b,open:w}=Gl(),h=de(),_=it(e),v=ce(h,"3154019201")&&!!_,C=ce(h,"638971034"),k=Vi(h,"2888003541").value,y=Number((U=k==null?void 0:k.max_bytes)!=null?U:3e7),j=ct(),S=f.useRef(null),g=f.useCallback(V=>{j.danger(V,{toastId:"w_failed_to_download_file"})},[j]),N=!!t.file_id,P=tn(!1,e,t.file_id,()=>{},g),L=(H=x[t.file_id])==null?void 0:H.presentation,E=(re=x[t.file_id])==null?void 0:re.workbook,R=f.useCallback(async V=>{if(e!==void 0){V.preventDefault();const{data:Z}=await P.refetch();if(Z===void 0||(Z==null?void 0:Z.status)!=="success"){j.danger("Failed to download file");return}const X=document.createElement("a");X.href=Z.download_url,X.click()}},[e,P,j]),{refetch:T}=P,M=vt();f.useEffect(()=>{var Z;(Z=S.current)==null||Z.abort();const V=new AbortController;return S.current=V,r(!0),(async()=>{var ae;let X=!1;try{const{data:J}=await T();if(J===void 0||(J==null?void 0:J.status)!=="success"){j.danger("Failed to download file");return}const Y=await fetch(J.download_url,{headers:M?{}:Ks(),signal:V.signal});if(!Y.ok)throw new Error("HTTP ".concat(Y.status));const te=await Y.blob();if(y!==0&&te.size>y){d(!0),l("fileTooLarge"),X=!0;return}const Q=new Uint8Array(await te.arrayBuffer()),ue=(ae=wn(t.file_name))!=null?ae:"pptx";if(ue==="pptx"){let ne;if(C)ne=await Nn(Q,ue);else{const he=await a;if(!he)return;ne=he.PptxReader.ExtractSlidesProto(Q,!1)}const xe=Vl.decode(ne);b(t.file_id,{fileBlob:te,fileName:t.file_name,presentation:xe,workbook:null,document:null,selectedSlideIdx:0,selectedSheetIdx:0})}else{let ne;if(C)ne=await Nn(Q,ue);else{const he=await a;if(!he)return;ne=he.XlsxReader.ExtractXlsxProto(Q,!1)}const xe=Xl.decode(ne);b(t.file_id,{fileBlob:te,fileName:t.file_name,presentation:null,workbook:xe,document:null,selectedSlideIdx:0,selectedSheetIdx:0})}}catch(J){J.name!=="AbortError"&&(d(!0),dt.addError(J,{file_id:t.file_id}))}finally{r(!1),m&&!X&&w(t.file_id)}})(),()=>{var X;(X=S.current)==null||X.abort()}},[T,j,b,t.file_name,t.file_id,m,w,y,M,a,C]);function p(V){V.preventDefault(),w(t.file_id)}const{onClick:D,isLoading:W,isEnabled:$}=ro({clientThreadId:e,messageId:s,fileId:t.file_id,fileName:t.file_name,processedMarkdownInfo:null,isStandaloneAttachment:!0}),I=u&&!m,O=wn(t.file_name);return n.jsxs("div",{className:F("border-token-border-light flex max-w-[calc(0.8*var(--thread-content-max-width,40rem))] flex-col overflow-hidden rounded-lg border",u&&"mx-auto my-0"),children:[n.jsxs("div",{className:"text-token-text-secondary border-token-border-light flex flex-row justify-between gap-4 border-b p-2",children:[n.jsxs("div",{className:"flex flex-row items-center gap-2 overflow-hidden",children:[n.jsx(zl,{fileName:t.file_name}),n.jsx("div",{className:"truncate text-sm font-medium",children:O==="pptx"?n.jsx(z,{id:"HTIcmf",defaultMessage:"Presentation"}):n.jsx(z,{id:"pftlup",defaultMessage:"Spreadsheet"})})]}),n.jsxs("div",{className:"text-token-text-tertiary flex flex-row items-center",children:[!I&&n.jsxs(n.Fragment,{children:[N&&n.jsx("button",{className:"hover:text-token-text-secondary hover:bg-token-bg-tertiary rounded-full p-1",onClick:R,children:n.jsx(Es,{})}),n.jsx("button",{className:"hover:text-token-text-secondary hover:bg-token-bg-tertiary disabled:text-token-text-tertiary rounded-full p-1 disabled:cursor-not-allowed disabled:bg-transparent",disabled:!L&&!E,onClick:p,children:n.jsx(Ul,{})})]}),v&&!!s&&$&&n.jsx("button",{className:"hover:text-token-text-secondary hover:bg-token-bg-tertiary rounded-full p-1",disabled:!$,onClick:D,children:W?n.jsx(_t,{}):n.jsx(ld,{})})]})]}),n.jsxs("div",{className:"bg-token-bg-secondary group relative p-2",children:[n.jsx(rd,{walnutId:t.file_id,isLoading:o,isError:c,isInShareModal:I,errorMessage:i,handleDownloadClick:R}),I&&n.jsx("div",{className:"absolute end-5 top-46 z-10 inline-flex flex-shrink-0 items-end justify-end",children:n.jsx(pr,{className:F("inline h-4 w-24 text-end")})})]})]})},ld=({className:t})=>n.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",className:t,children:[n.jsx("path",{d:"M3 12.4428V12.2806C3 11.9219 3.2843 11.631 3.63497 11.631C3.98563 11.631 4.26993 11.9219 4.26993 12.2806V12.4428C4.26993 13.1372 4.2708 13.6193 4.3007 13.994C4.33 14.3609 4.38426 14.5675 4.46108 14.7218L4.52821 14.8459C4.69655 15.1266 4.93812 15.3556 5.22657 15.5061L5.35059 15.5604C5.48786 15.6107 5.6688 15.6476 5.938 15.6701C6.30417 15.7008 6.77519 15.7007 7.45408 15.7007H12.546C13.2246 15.7007 13.6959 15.7008 14.0621 15.6701C14.4204 15.6402 14.6226 15.5846 14.7735 15.5061L14.8946 15.4364C15.169 15.2642 15.3929 15.0169 15.5399 14.7218L15.593 14.595C15.6421 14.4546 15.6782 14.2692 15.7003 13.994C15.7301 13.6193 15.73 13.1372 15.73 12.4428V12.2806C15.73 11.922 16.0145 11.6312 16.3651 11.631C16.7157 11.631 17 11.9219 17 12.2806V12.4428C17 13.1158 17.0006 13.6601 16.9655 14.0999C16.9342 14.4916 16.8722 14.8443 16.7343 15.1731L16.6709 15.3123C16.4174 15.8213 16.0318 16.2469 15.5585 16.544L15.3506 16.6632C14.9909 16.8507 14.6028 16.9281 14.1655 16.9646C13.7356 17.0006 13.2038 17 12.546 17H7.45408C6.79615 17 6.26438 17.0006 5.8345 16.9646C5.45207 16.9327 5.10749 16.8699 4.78649 16.729L4.65035 16.6632C4.1528 16.4038 3.73604 16.0094 3.44569 15.5251L3.32914 15.3123C3.14585 14.9444 3.07023 14.5473 3.03451 14.0999C2.9994 13.6601 3 13.1158 3 12.4428Z"}),n.jsx("path",{d:"M9.99993 13.2544C10.3505 13.2544 10.6348 12.9635 10.6348 12.6047V5.218L12.7337 7.36545L12.8335 7.44845C13.0799 7.61506 13.4146 7.58749 13.6316 7.36545C13.8486 7.14342 13.8756 6.80101 13.7127 6.54884L13.6316 6.44677L10.4493 3.19088C10.3302 3.06897 10.1683 3 9.99993 3C9.8316 3.0001 9.67044 3.06906 9.55138 3.19088L6.36815 6.44677C6.12048 6.70037 6.12057 7.11179 6.36815 7.36545C6.58526 7.58755 6.92077 7.61523 7.1673 7.44845L7.26707 7.36545L9.36491 5.21897V12.6047C9.36491 12.9634 9.64934 13.2542 9.99993 13.2544Z"})]}),cd=new Set(["jpg","jpeg","png","gif","webp","svg"]),dd=t=>{const e=t.split(".").pop();return e?cd.has(e):!1};function ud({citation:t,clientThreadId:e,messageId:s}){var l;const a=Xi(),o=Zi(),r=f.useRef(a!==bn.Research);f.useEffect(()=>{!r.current&&a===bn.Research&&(r.current=!0,o(null))},[a,o]);const i=de();return Hl(t.file_name)&&ce(i,"3392860057")?n.jsx(id,{citation:t,clientThreadId:e,messageId:s,children:(l=t.label)!=null?l:t.file_name}):Yc(t.file_name)?n.jsx(Kc,{citation:t,clientThreadId:e,messageId:s}):n.jsx(md,{citation:t,clientThreadId:e,messageId:s})}function md({citation:t,clientThreadId:e}){var i,l;const s=it(e),a=ct(),o=f.useCallback(c=>{a.danger(c,{toastId:"fcoa_renderer_failed_to_download_file"})},[a]),{data:r}=tn(!0,s,t.file_id,void 0,o);return dd(t.file_name)&&(r!=null&&r.download_url)?n.jsx("img",{src:r==null?void 0:r.download_url,alt:(i=t.label)!=null?i:t.file_name,className:"max-h-[350px] max-w-screen"}):n.jsx("a",{href:r==null?void 0:r.download_url,children:(l=t.label)!=null?l:t.file_name})}function fd({citationIndex:t,clientThreadId:e,nodeType:s,messageId:a}){var l;const o=parseInt(t,10),r=f.useContext(Oe);if(!r)return null;const i=(l=r.n7jupdCrefs)==null?void 0:l[o];if(!i)return null;switch(i.type){case"clipboard":return n.jsx(Vc,{citation:i});case"computer_output":return n.jsx(Xc,{citation:i,clientThreadId:e,nodeType:s});case"file":return n.jsx(ud,{citation:i,clientThreadId:e,messageId:a});case"invalid":return null}}function hd({path:t,lineRangeStart:e,lineRangeEnd:s,gitUrl:a}){const[o,r]=f.useState(!1),i=f.useContext(ns),l=f.useRef(null),c=f.useRef(null),d=f.useRef(null),u=()=>{d.current&&(clearTimeout(d.current),d.current=null),r(!0)},m=()=>{d.current=window.setTimeout(()=>{r(!1)},200)};if(!t)return null;const x=i==null?void 0:i.fileSnapshots.find(w=>w.path===t);if(!x)return null;const b=gd(e,s,x);return b.length?n.jsxs(zs,{open:o,onOpenChange:r,children:[n.jsx(Hs,{asChild:!0,onMouseEnter:u,onMouseLeave:m,children:n.jsx("span",{ref:l,className:"bg-token-bg-secondary text-token-text-secondary mx-0.5 inline-flex aspect-square size-min cursor-default items-center justify-center rounded-full p-1",children:n.jsx(ec,{className:"size-[10px]"})})}),n.jsx(Us,{children:n.jsx(qs,{ref:c,className:"z-50 focus:outline-none",side:"right",onMouseEnter:u,onMouseLeave:m,onOpenAutoFocus:w=>w.preventDefault(),children:n.jsx(pd,{snapshot:x,snippetLines:b,lineRangeStart:e,lineRangeEnd:s,gitUrl:a})})})]}):null}function pd({snapshot:t,snippetLines:e,lineRangeStart:s,lineRangeEnd:a,gitUrl:o}){var c;const r=(c=t.path.split(".").pop())!=null?c:"sh",i=e.reduce((d,u)=>{if(u.trim()==="")return d;const m=u.match(/^\s*/),x=m?m[0].length:0;return d===-1?x:Math.min(d,x)},-1),l=e.map(d=>i>0?d.slice(i):d).join("\n");return n.jsxs("div",{className:"bg-token-bg-primary border-token-border-default mx-4 flex max-h-[600px] flex-col rounded-2xl border px-2 pt-2 pb-4 shadow-[0px_4px_16px_0px_rgba(0,0,0,0.05)] focus:outline-none dark:shadow-none",children:[l&&n.jsx(gr,{wrapperClassName:"rounded-lg !bg-token-bg-tertiary !border-none mb-3 max-h-[400px] overflow-auto text-xs w-[600px] max-w-full",codeContainerClassName:"!p-2",language:r,content:l,showActionBar:!1}),n.jsxs("div",{className:"grid w-full grid-cols-[minmax(0,1fr)_auto] items-center justify-between gap-1 px-2 text-sm",children:[t.path,n.jsxs("div",{className:"text-token-text-tertiary flex items-center gap-1 whitespace-nowrap",children:[n.jsx(z,{id:"wham.citation.file.lineRange",defaultMessage:"Lines {lineRangeStart}-{lineRangeEnd}",values:{lineRangeStart:s,lineRangeEnd:a}}),o&&n.jsx("a",{className:"group flex w-full items-center gap-1 p-1",href:o,target:"_blank",rel:"noopener noreferrer",children:n.jsx(Yi,{className:"icon-xs hover:text-token-text-primary"})})]})]})]})}function gd(t,e,s){var i;if(s.contents){const l=s.contents.split("\n"),c=Math.max(0,t-1),d=e?Math.min(l.length,e):c+1;return l.slice(c,d)}const a=(i=s.line_range_contents)==null?void 0:i.find(l=>xd(l,t,e));if(!a)return[];const o=Math.max(t-a.line_range_start,0),r=o+(e-t+1);return a.content.slice(o,r)}function xd(t,e,s){return e<t.line_range_start?!1:!(s>t.line_range_end)}function bd({assetPointer:t}){var i,l,c,d,u;const e=f.useContext(ns),s=K(),a=e==null?void 0:e.imagePointers.find(m=>m.asset_pointer===t),o=Ra({asset:{content_type:Xa.ImageAssetPointer,asset_pointer:(i=a==null?void 0:a.asset_pointer)!=null?i:"",size_bytes:(l=a==null?void 0:a.size_bytes)!=null?l:0,width:(c=a==null?void 0:a.width)!=null?c:0,height:(d=a==null?void 0:a.height)!=null?d:0}});if(!a||!((u=o.data)!=null&&u.url))return null;const r=s.formatMessage({id:"wham.contentReference.imageAlt",defaultMessage:"Captured screenshot"});return n.jsx(xr,{src:o.data.url,alt:r,className:"max-h-[250px] max-w-[250px]",children:n.jsx(br,{src:o.data.url,alt:r,width:a.width,height:a.height,className:"max-h-[250px] max-w-[250px] object-contain"})})}function yd(){const t=Za.getItem(Ya.ProposedTasks);return t&&typeof t=="object"?t:{}}const Mn=Ki(t=>({tasks:yd(),store(e){t(s=>{const a=G(B({},s.tasks),{[e.contentId]:e});return Za.setItem(Ya.ProposedTasks,a),{tasks:a}})}}));function wd({title:t,prompt:e,environmentId:s,branch:a,contentId:o,hasHitRateLimit:r}){const[i,l]=f.useState(!1),c=Ji(),{setEnvironmentId:d,setBranch:u}=ao(),{refetch:m}=sc(),x=K(),b=ct(),w=Mn(y=>y.tasks[o]),h=Mn(y=>y.store),{mutate:_,isPending:v}=Ta({mutationFn:()=>nc.createNewTask(s,a,e,!1).catch(y=>{throw b.danger({id:"wham.whamComposer.failedToCreateTask",defaultMessage:"Failed to create task",description:"Toast text shown when a task failed to create."},{id:"suggestion-".concat(o),duration:5,hasCloseButton:!0,toastId:"wham_proposed_task_failed_to_create_task"}),y}),onSuccess:async y=>{await m(),C(y)}}),C=y=>{try{const j=y.task.id,S=y.turn.id,g="/codex/tasks/".concat(j);h({contentId:o,prompt:e,scheduledTaskId:j,turnId:S,url:g}),l(!1)}catch(j){}},k=!s||!a||v||r;return n.jsxs("div",{className:F("mt-1 mb-3 flex w-full items-center rounded-xl px-3 py-3",w?"bg-token-bg-secondary border border-transparent":"bg-token-bg-primary border-token-border-default border shadow-[0px_1px_1px_0px_rgba(0,0,0,0.05)]"),children:[n.jsxs("div",{className:F("group flex flex-1 items-center gap-1",!w&&"-my-3 py-3",!w&&!k&&"cursor-pointer"),onClick:()=>{k||w||(d(s),u(a),l(!0),vn.recordProposedTaskClicked("edit"))},children:[n.jsxs("div",{className:"flex flex-col gap-0.5",children:[n.jsx("span",{className:"text-token-text-tertiary text-xs",children:n.jsx(z,{id:"wham.whamProposedTask.title",defaultMessage:"Suggested task"})}),n.jsx("span",{className:F("text-sm font-medium",w&&"text-token-text-tertiary"),children:t})]}),!k&&!w&&n.jsx(yr,{className:"icon-sm text-token-text-secondary mb-0.5 cursor-pointer self-end opacity-0 transition-opacity group-hover:opacity-100"})]}),n.jsx("div",{className:"flex items-center justify-end gap-2 text-xs",children:w?n.jsx(Se,{size:"small",color:"secondary",as:"a",to:w==null?void 0:w.url,openNewTab:!0,children:n.jsx("span",{className:"text-token-text-primary font-medium",children:n.jsx(z,{id:"lwqFNG",defaultMessage:"View task"})})}):n.jsx(vd,{prompt:r?x.formatMessage({id:"wham.proposedTask.hitRateLimit",defaultMessage:"You have reached your rate limit"}):e,tooltipEnabled:!w&&!i,children:n.jsx(Se,{size:"small",color:"secondary",disabled:k,onClick:()=>{vn.recordProposedTaskClicked("create"),_()},children:n.jsxs("div",{className:"flex items-center gap-0.5",children:[n.jsx(z,{id:"b2N2Y8",defaultMessage:"Start task"}),v?n.jsx(_t,{className:"icon-xs me-[2px]"}):n.jsx(wr,{className:"icon-sm"})]})})})}),n.jsx(Ge.Root,{testId:"modal-task-stub-composer",isOpen:i,onClose:()=>l(!1),children:n.jsx(Ge.Overlay,{children:n.jsxs(Ge.Content,{className:"flex max-w-3xl! items-center justify-center px-12 py-4 focus:outline-hidden",size:"normal",removeBackground:!0,onEscapeKeyDown:y=>{y.stopPropagation(),l(!1)},children:[n.jsxs(Qi,{children:[n.jsx(el,{children:n.jsx(z,{id:"wham.proposedTaskModel.title",defaultMessage:"Kick off a new Codex task"})}),n.jsx(tl,{children:n.jsx(z,{id:"wham.proposedTaskModel.description",defaultMessage:"Codex can propose new follow up tasks"})})]}),n.jsx(Ut.div,{initial:{opacity:0,translateY:20},animate:{opacity:1,translateY:0},transition:{duration:c?0:.25},className:"w-full",children:n.jsxs("div",{className:"flex flex-col items-center gap-8",children:[n.jsx("h1",{className:"text-token-text-primary dark text-[28px] font-semibold",children:n.jsx(z,{id:"wham.proposedTaskModal.title",defaultMessage:"Edit suggested task"})}),n.jsx(_d,{prompt:e,onSuccess:C})]})})]})})})]})}function vd({prompt:t,tooltipEnabled:e,children:s}){return e?n.jsx(Ue,{side:"right",label:n.jsx("span",{className:"block p-2 text-start whitespace-pre-wrap",children:t}),wide:!0,children:s}):s}function _d({prompt:t,onSuccess:e}){const{composerController:s}=ac();return f.useEffect(()=>{sl(nl(s),t.trimEnd())},[s,t]),n.jsx(al.Provider,{value:s,children:n.jsx(tc,{isBigBoxMode:!0,expanded:!0,disableDuringSubmit:!0,onSuccess:e})})}function jd({title:t,prompt:e}){const s=f.useContext(ns),a=ao(r=>{var i;return((i=r.getRateLimit())==null?void 0:i.remaining)===0}),o=f.useMemo(()=>kd("".concat(s==null?void 0:s.taskId,":").concat(t,":").concat(e)),[s==null?void 0:s.taskId,t,e]);return!s||!s.environmentId||!s.branch?null:n.jsx(wd,{title:t,prompt:e,environmentId:s.environmentId,branch:s.branch,contentId:o,hasHitRateLimit:a})}function kd(t){let e=5381;for(let s=0;s<t.length;s++)e=(e<<5)+e^t.charCodeAt(s);return(e>>>0).toString(16).padStart(8,"0")}function Cd({chunkId:t,lineRangeStart:e,lineRangeEnd:s}){const[a,o]=f.useState(!1),r=f.useContext(ns),i=r==null?void 0:r.terminalMessageContents.find(w=>w.includes(t)),l=f.useRef(null),c=f.useRef(null),d=f.useRef(null);if(!i)return null;const u=Nd(i);if(!u)return null;const m=u.output.slice(e-1,s);if(!m.some(w=>!!w.length))return null;const x=()=>{d.current&&(clearTimeout(d.current),d.current=null),o(!0)},b=()=>{d.current=window.setTimeout(()=>{o(!1)},200)};return n.jsxs(zs,{open:a,onOpenChange:o,children:[n.jsx(Hs,{asChild:!0,onMouseEnter:x,onMouseLeave:b,children:n.jsx("span",{ref:l,className:"bg-token-bg-secondary text-token-text-secondary mx-0.5 inline-flex aspect-square size-min cursor-default items-center justify-center rounded-full p-1",children:n.jsx(vr,{className:"size-[10px]"})})}),n.jsx(Us,{children:n.jsx(qs,{ref:c,className:"z-50 focus:outline-none",side:"right",onMouseEnter:x,onMouseLeave:b,onOpenAutoFocus:w=>w.preventDefault(),children:n.jsx("div",{className:"max-h-[500px] max-w-screen px-4",children:n.jsx(Sd,{lines:m,lineRangeStart:e,lineRangeEnd:s})})})})]})}function Sd({lines:t,lineRangeStart:e,lineRangeEnd:s}){return n.jsxs("div",{className:"bg-token-bg-primary border-token-border-default mx-4 flex flex-col overflow-auto rounded-2xl border px-2 pt-2 pb-3 shadow-[0px_4px_16px_0px_rgba(0,0,0,0.05)] focus:outline-none dark:shadow-none",children:[n.jsx(oc,{className:"bg-token-sidebar-surface-primary dark mb-2.5 max-h-[200px] w-full overflow-auto rounded-lg p-3 font-mono text-xs whitespace-pre text-white dark:border dark:border-white/10",children:t.join("\n")}),n.jsx("div",{className:"flex w-full justify-end gap-1 px-2 text-sm",children:n.jsx("span",{className:"text-token-text-tertiary",children:n.jsx(z,{id:"wham.citation.terminal.lineRange",defaultMessage:"Lines {lineRangeStart}-{lineRangeEnd}",values:{lineRangeStart:e,lineRangeEnd:s}})})})]})}function Nd(t){try{const e=JSON.parse(t);return!("chunk_id"in e)||typeof e.chunk_id!="string"||!("session_name"in e)||typeof e.session_name!="string"||!("start_line_no"in e)||typeof e.start_line_no!="number"?null:"output"in e?e:null}catch(e){return null}}var qt=(t=>(t.STANDARD="standard",t.EMAIL="email",t.CREATIVE="creative",t.CHAT_MESSAGE="chat_message",t.SOCIAL_POST="social_post",t.UNKNOWN="unknown",t))(qt||{});function Md(t){return Object.values(qt).includes(t)?t:"unknown"}const Ls=["group my-4 w-full overflow-visible rounded-3xl","bg-token-bg-primary","dark:bg-[#2a2a2a]","shadow-[inset_0px_0px_0px_1px_rgba(0,0,0,0.08),0px_8px_480px_rgba(0,0,0,0.04)]","hover:shadow-[inset_0px_0px_0px_1px_rgba(0,0,0,0.16),0px_8px_480px_rgba(0,0,0,0.04)]","focus-within:shadow-[inset_0px_0px_0px_1px_rgba(0,0,0,0.24),0px_8px_480px_rgba(0,0,0,0.04)]","hover:focus-within:shadow-[inset_0px_0px_0px_1px_rgba(0,0,0,0.24),0px_8px_480px_rgba(0,0,0,0.04)]","dark:shadow-[inset_0px_0px_0px_1px_rgba(255,255,255,0.04)]","dark:hover:shadow-[inset_0px_0px_0px_1px_rgba(255,255,255,0.10)]","dark:focus-within:shadow-[inset_0px_0px_0px_1px_rgba(255,255,255,0.16)]","dark:hover:focus-within:shadow-[inset_0px_0px_0px_1px_rgba(255,255,255,0.16)]","dark:hover:bg-[#2a2a2a]","dark:focus-within:bg-[#2a2a2a]","dark:hover:focus-within:bg-[#2a2a2a]"].join(" "),Td="bg-token-bg-primary/90 dark:bg-[#2a2a2a]/90 group-hover:bg-token-bg-primary/90 dark:group-hover:bg-[#2a2a2a]/90 group-focus-within:bg-token-bg-primary/90 dark:group-focus-within:bg-[#2a2a2a]/90 group-hover:group-focus-within:bg-token-bg-primary/90 dark:group-hover:group-focus-within:bg-[#2a2a2a]/90",Tn="placeholder:text-token-text-tertiary min-w-0 flex-1 shrink-0 truncate border-none bg-transparent focus:border-transparent focus:ring-0 focus:outline-hidden",nn="text-sm font-medium";function Ed(t){"use forget";const e=ve.c(56),{onClick:s,clientThreadId:a,messageId:o}=t,r=K();let i;e[0]!==a||e[1]!==o||e[2]!==s?(i=I=>{Fe.logEventWithStatsig("ChatGPT Writing Block Email Send Button Clicked","chatgpt_writing_block_email_send_button_clicked",G(B({},kt({clientThreadId:a,messageId:o})),{provider:I})),s(I)},e[0]=a,e[1]=o,e[2]=s,e[3]=i):i=e[3];const l=i,c=!jt();let d;e[4]!==r?(d=r.formatMessage({id:"BnHAsh",defaultMessage:"Open email in app"}),e[4]=r,e[5]=d):d=e[5];let u,m;e[6]===Symbol.for("react.memo_cache_sentinel")?(u=n.jsx(ds,{className:"icon-md me-0.5"}),m=n.jsx(z,{id:"Ebr+Et",defaultMessage:"Open in email"}),e[6]=u,e[7]=m):(u=e[6],m=e[7]);let x;e[8]!==d?(x=n.jsxs("button",{className:"text-token-text-secondary dark:text-token-text-tertiary dark:hover:text-token-text-primary hover:text-token-text-primary flex items-center gap-1 px-2 py-2 text-sm select-none","aria-label":d,children:[u,m]}),e[8]=d,e[9]=x):x=e[9];let b;e[10]!==l?(b=()=>l("gmail"),e[10]=l,e[11]=b):b=e[11];let w;e[12]===Symbol.for("react.memo_cache_sentinel")?(w=n.jsx(ol,{}),e[12]=w):w=e[12];let h;e[13]!==r?(h=r.formatMessage({id:"2cYA6Z",defaultMessage:"Open email using Gmail"}),e[13]=r,e[14]=h):h=e[14];let _;e[15]===Symbol.for("react.memo_cache_sentinel")?(_=n.jsx(z,{id:"N+/ksm",defaultMessage:"Gmail"}),e[15]=_):_=e[15];let v;e[16]!==b||e[17]!==h?(v=n.jsx(ke.Item,{onSelect:b,icon:w,"aria-label":h,label:_}),e[16]=b,e[17]=h,e[18]=v):v=e[18];let C;e[19]!==l?(C=()=>l("outlook"),e[19]=l,e[20]=C):C=e[20];let k;e[21]===Symbol.for("react.memo_cache_sentinel")?(k=n.jsx(_r,{}),e[21]=k):k=e[21];let y;e[22]!==r?(y=r.formatMessage({id:"puDMOA",defaultMessage:"Open email using Outlook"}),e[22]=r,e[23]=y):y=e[23];let j;e[24]===Symbol.for("react.memo_cache_sentinel")?(j=n.jsx(z,{id:"0Laq6P",defaultMessage:"Outlook"}),e[24]=j):j=e[24];let S;e[25]!==C||e[26]!==y?(S=n.jsx(ke.Item,{onSelect:C,icon:k,"aria-label":y,label:j}),e[25]=C,e[26]=y,e[27]=S):S=e[27];let g;e[28]!==l?(g=()=>l("default"),e[28]=l,e[29]=g):g=e[29];let N;e[30]===Symbol.for("react.memo_cache_sentinel")?(N=n.jsx(rc,{}),e[30]=N):N=e[30];let P;e[31]!==r?(P=r.formatMessage({id:"aW6dXc",defaultMessage:"Open email using default email app"}),e[31]=r,e[32]=P):P=e[32];let L;e[33]===Symbol.for("react.memo_cache_sentinel")?(L=n.jsx(z,{id:"DcalRY",defaultMessage:"Default email app"}),e[33]=L):L=e[33];let E;e[34]!==g||e[35]!==P?(E=n.jsx(ke.Item,{onSelect:g,icon:N,"aria-label":P,label:L}),e[34]=g,e[35]=P,e[36]=E):E=e[36];let R;e[37]!==v||e[38]!==S||e[39]!==E||e[40]!==x?(R=n.jsx("div",{className:"hidden md:block",children:n.jsxs(Ka,{alignOffset:-8,size:"small",triggerButton:x,children:[v,S,E]})}),e[37]=v,e[38]=S,e[39]=E,e[40]=x,e[41]=R):R=e[41];let T;e[42]===Symbol.for("react.memo_cache_sentinel")?(T=F("text-token-text-secondary dark:text-token-text-tertiary dark:hover:text-token-text-primary hover:text-token-text-primary px-2 py-2",nn),e[42]=T):T=e[42];let M;e[43]!==r?(M=r.formatMessage({id:"5fZEc+",defaultMessage:"Open in email"}),e[43]=r,e[44]=M):M=e[44];let p;e[45]!==l?(p=()=>l("default"),e[45]=l,e[46]=p):p=e[46];let D;e[47]!==c?(D=c?n.jsx(Ue,{label:n.jsx(z,{id:"EmailSendButton.tooltip",defaultMessage:"Open in email"}),children:n.jsx(ds,{className:"icon-md"})}):n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(ds,{className:"icon-md"}),n.jsx(z,{id:"EmailSendButton.tooltip",defaultMessage:"Open in email"})]}),e[47]=c,e[48]=D):D=e[48];let W;e[49]!==M||e[50]!==p||e[51]!==D?(W=n.jsx("div",{className:"block md:hidden",children:n.jsx("button",{className:T,"aria-label":M,onClick:p,children:D})}),e[49]=M,e[50]=p,e[51]=D,e[52]=W):W=e[52];let $;return e[53]!==R||e[54]!==W?($=n.jsxs(n.Fragment,{children:[R,W]}),e[53]=R,e[54]=W,e[55]=$):$=e[55],$}const Rs={},hs=(t,e)=>{},ht=t=>{const e=Rs[t];e!=null&&e.parentNode&&e.parentNode.removeChild(e),delete Rs[t]},$d=()=>{Object.keys(Rs).forEach(t=>{ht(t)})},It=t=>({left:t.left,top:t.top,width:t.width,height:t.height}),Dt=.5,Wt=(t,e)=>Math.abs(t.left-e.left)<Dt&&Math.abs(t.top-e.top)<Dt&&Math.abs(t.width-e.width)<Dt&&Math.abs(t.height-e.height)<Dt,Pd=(t,e)=>t==null&&e==null?!0:t==null||e==null?!1:Wt(t,e),ps=Qt({bold:{id:"Z0FJiE",defaultMessage:"Bold"},italic:{id:"Ros0Mw",defaultMessage:"Italic"},textStylesPlaceholder:{id:"UqjWAZ",defaultMessage:"Text styles"}}),Ad=({editorRef:t,intl:e,isDebugEnabled:s})=>{"use forget";const a=f.useCallback(()=>t.current,[t]),o=f.useCallback(()=>null,[]),r=f.useRef(null),i=f.useRef(null),[l,c]=f.useState(0),d=f.useRef(!1),u=f.useRef(null),m=f.useCallback(h=>{const _=r.current;_==null&&h==null||_!=null&&h!=null&&Wt(_.selectionRect,h.selectionRect)&&Wt(_.editorRect,h.editorRect)&&Wt(_.containerRect,h.containerRect)&&Pd(_.caretRect,h.caretRect)&&_.isFocusAtEnd===h.isFocusAtEnd||(r.current=h,s&&(h?(hs("editor",h.editorRect),hs("selection",h.selectionRect)):(ht("editor"),ht("selection"),ht("toolbar"))),c(C=>C+1))},[s]),x=f.useCallback(()=>{if(typeof window>"u")return;i.current!=null&&window.cancelAnimationFrame(i.current);const h=d.current;i.current=window.requestAnimationFrame(()=>{var E;if(i.current=null,h)return;const _=t.current;if(!_){m(null);return}const v=window.getSelection();if(!v||v.rangeCount===0||v.isCollapsed){m(null);return}const C=v.getRangeAt(0);if(!C||!_.contains(C.commonAncestorContainer)){m(null);return}const k=C.getBoundingClientRect();if(!k||k.width===0&&k.height===0){m(null);return}const y=_.getBoundingClientRect(),S=((E=_.offsetParent instanceof HTMLElement?_.offsetParent:_.parentElement)!=null?E:_).getBoundingClientRect();let g=null,N=!1;const{focusNode:P,focusOffset:L}=v;if(P!=null){try{const R=document.createRange();R.setStart(P,L),R.setEnd(P,L);const T=R.getBoundingClientRect();T&&(g=It(T))}catch(R){g=null}try{N=P===C.endContainer&&L===C.endOffset}catch(R){N=!1}}m({selectionRect:It(k),caretRect:g,editorRect:It(y),containerRect:It(S),isFocusAtEnd:N})})},[m,t]);f.useEffect(()=>{if(typeof document>"u"||typeof window>"u")return;const h=()=>{x()},_=()=>{x()};return document.addEventListener("selectionchange",h),window.addEventListener("resize",_),window.addEventListener("scroll",_,!0),x(),()=>{document.removeEventListener("selectionchange",h),window.removeEventListener("resize",_),window.removeEventListener("scroll",_,!0),i.current!=null&&(window.cancelAnimationFrame(i.current),i.current=null)}},[x]);const b=f.useCallback(h=>{const _=r.current;if(!_)return s&&ht("toolbar"),null;const{selectionRect:v,editorRect:C,containerRect:k}=_,y=8,j=v.left-C.left,S=v.width>0?v.width:h.width,g=C.width,N=C.left-k.left,P=j+S/2-h.width/2,E=Math.min(Math.max(P,0),Math.max(g-h.width,0))+N,R=v.top-C.top,T=C.top-k.top,p=R-h.height-y+T,D=cc.ABOVE;return s&&hs("toolbar",{left:k.left+E,top:k.top+p,width:h.width,height:h.height}),{left:E,top:p,aboveOrBelow:D,toolbarSize:h}},[t,l,s]),w=f.useCallback(h=>{const _=t.current;if(_){d.current=!0,typeof window<"u"&&u.current&&(window.clearTimeout(u.current),u.current=null),_.focus({preventScroll:!0});try{document.execCommand(h)}finally{typeof window<"u"?u.current=window.setTimeout(()=>{d.current=!1,u.current=null},0):d.current=!1}}},[t]);return f.useEffect(()=>()=>{typeof window<"u"&&u.current!=null&&(window.clearTimeout(u.current),u.current=null)},[]),n.jsxs(dc,{showAskChatGPT:!1,toolbarType:uc.WRITING,getEditorDom:a,getSelectionRange:o,getToolbarPosition:b,children:[n.jsx(Rt.Action,{label:e.formatMessage(ps.bold),hideLabel:!0,icon:mc,onClick:()=>w("bold"),onMouseDown:h=>h.preventDefault()}),n.jsx(Rt.Action,{label:e.formatMessage(ps.italic),hideLabel:!0,icon:fc,onClick:()=>w("italic"),onMouseDown:h=>h.preventDefault()}),n.jsx(Rt.Separator,{}),n.jsx(Rt.Action,{label:e.formatMessage(ps.textStylesPlaceholder),hideLabel:!0,icon:hc,isDisabled:!0,onMouseDown:h=>h.preventDefault()})]})},Ld=({markdown:t,onChange:e,isDisabled:s,className:a,maxLength:o,contentReferences:r,setDirty:i,flushPendingChanges:l})=>{"use forget";const c=de(),d=K(),u=ce(c,"3905235728"),m=!1,x=sn(e,300),b=f.useRef(null),w=f.useRef(t),h=f.useRef(s),_=f.useMemo(()=>/\[[^\[\]]+\]/g,[]),v="[data-placeholder-token]",C=f.useMemo(()=>/^\[[^\[\]]+\]$/,[]),k=f.useMemo(()=>new RegExp("(?:\\u200B|\\u200C|\\u200D|\\uFEFF|\\u2060)","gu"),[]),y=f.useCallback($=>$?$.replace(k,"").trim().length:0,[k]),j=f.useCallback(($,I)=>{const O=I.cloneRange();O.collapsed||O.collapse(!1);const A=document.createRange();A.selectNodeContents($);try{A.setStart(O.endContainer,O.endOffset)}catch(U){return!0}const q=A.cloneContents().textContent||"";return y(q)===0},[y]),S=f.useCallback($=>{const I=document.createElement("br");$.insertNode(I);const O=document.createRange();O.setStartAfter(I),O.collapse(!0);const A=window.getSelection();A==null||A.removeAllRanges(),A==null||A.addRange(O)},[]),g=f.useCallback($=>{if($.querySelectorAll(v).forEach(U=>{const H=U.parentNode;if(H){for(;U.firstChild;)H.insertBefore(U.firstChild,U);H.removeChild(U)}}),s)return;const O=document.createTreeWalker($,NodeFilter.SHOW_TEXT),A=[];let q=O.nextNode();for(;q;)q.textContent&&_.test(q.textContent)&&A.push(q),_.lastIndex=0,q=O.nextNode();A.forEach(U=>{var X,ae;const H=(X=U.textContent)!=null?X:"";_.lastIndex=0;const re=H.matchAll(_),V=document.createDocumentFragment();let Z=0;for(const J of re){const Y=(ae=J.index)!=null?ae:-1;if(Y<0)continue;const te=J[0];Y>Z&&V.append(H.slice(Z,Y));const Q=document.createElement("span");Q.textContent=te,Q.dataset.placeholderToken="true",Q.className="text-token-text-primary cursor-text",Q.style.backgroundColor="color-mix(in srgb, var(--selection) 20%, transparent)",Q.style.paddingTop="4px",Q.style.paddingBottom="4px",V.append(Q),Z=Y+te.length}Z<H.length&&V.append(H.slice(Z)),U.replaceWith(V)})},[_,s]),N=f.useCallback($=>{$.querySelectorAll(v).forEach(O=>{var q;const A=(q=O.textContent)!=null?q:"";if(!C.test(A)){const U=O.parentNode;if(!U)return;for(;O.firstChild;)U.insertBefore(O.firstChild,O);U.removeChild(O)}})},[C]),P=f.useCallback($=>{const I=document.createTreeWalker($,NodeFilter.SHOW_ELEMENT),O=[];for(;I.nextNode();){const A=I.currentNode;A.style&&(A.style.color="",A.style.backgroundColor="",A.style.fontFamily="",A.style.fontSize="",A.style.lineHeight="",A.style.textDecoration="",A.style.textShadow=""),(A.tagName==="SPAN"||A.tagName==="FONT")&&!A.hasAttributes()&&O.push(A)}for(const A of O.reverse()){const q=A.parentNode;if(q){for(;A.firstChild;)q.insertBefore(A.firstChild,A);q.removeChild(A)}}},[]),L=f.useMemo(()=>{const $=new jr({codeBlockStyle:"fenced",headingStyle:"atx",bulletListMarker:"-"});return $.use(kr),$},[]),E=f.useCallback(async $=>{const I=await Cr().use(Sr).use(Nr,{singleTilde:!1}).use(Vo).use(Mr).use([[Xo,r!=null?r:[]]]).use(Tr).use(Zo).use(Yo).use(Er).use(Ko).process($!=null?$:"");return String(I)},[r]);f.useEffect(()=>{if(!b.current)return;const $=b.current,I=$.innerHTML.trim()!=="",O=t!==w.current||!I;if(!O&&s===h.current)return;let A=!1;return O?((async()=>{const U=await E(t),H=U.trim()===""?"<p><br></p>":U;!b.current||A||(b.current.innerHTML!==H&&(b.current.innerHTML=H),g(b.current),w.current=t,h.current=s)})(),()=>{A=!0}):(g($),h.current=s,()=>{A=!0})},[t,E,g,s]);const R=f.useCallback(()=>{const $=b.current;if(!$)return;i(!0),N($);const I=$.innerHTML,O=L.turndown(I);w.current=O,x({content:O})},[x,L,i,N]),T=f.useCallback(()=>{var $,I;return(I=($=window.getSelection())==null?void 0:$.toString().length)!=null?I:0},[]),M=f.useCallback($=>{const I=window.getSelection();if(I&&I.rangeCount>0){const O=I.getRangeAt(0);O.deleteContents(),O.insertNode(document.createTextNode($)),O.collapse(!1),I.removeAllRanges(),I.addRange(O)}},[]),p=f.useCallback($=>{var X,ae,J,Y,te,Q;const I=$.nativeEvent;if(s)return;const O=b.current;if(!O)return;const A=(X=I.inputType)!=null?X:"",q=(ae=I.data)!=null?ae:"";if(A==="insertParagraph"||A==="insertLineBreak"||q==="\n"){const ue=(Y=(J=I.getTargetRanges)==null?void 0:J.call(I))!=null?Y:[],ne=(()=>{if(ue.length>0){const oe=ue[0],pe=document.createRange();return pe.setStart(oe.startContainer,oe.startOffset),pe.setEnd(oe.endContainer,oe.endOffset),pe}const le=window.getSelection();return le&&le.rangeCount>0?le.getRangeAt(0).cloneRange():null})();if(!ne)return;const xe=ne.startContainer.nodeType===Node.ELEMENT_NODE?ne.startContainer:ne.startContainer.parentElement,he=xe==null?void 0:xe.closest("p");if(!he||!O.contains(he))return;const Ne=window.getSelection();if(!Ne)return;ne.collapsed||ne.deleteContents(),ne.collapse(!1),Ne.removeAllRanges(),Ne.addRange(ne);const Pe=A==="insertLineBreak",fe=j(he,ne);if(Pe||!fe){if($.preventDefault(),o!=null&&O.innerText.length-T()+1>o)return;S(ne),R();return}}if(o==null||A.startsWith("delete")||A.startsWith("insertComposition"))return;const H=O.innerText.length,re=T();let V=0;if(A==="insertText"?V=(Q=(te=I.data)==null?void 0:te.length)!=null?Q:0:A==="insertParagraph"?V=1:A==="insertFromPaste"&&(V=0),H-re+V>o){$.preventDefault();const ue=o-(H-re);if(ue>0&&A==="insertText"&&I.data){const ne=I.data.slice(0,ue);M(ne),R()}}},[T,R,M,s,o,j,S]),D=f.useCallback($=>{var re,V,Z;if(s||o==null)return;const I=b.current;if(!I)return;const O=(re=$.clipboardData)==null?void 0:re.getData("text/html"),A=(Z=(V=$.clipboardData)==null?void 0:V.getData("text/plain"))!=null?Z:"",q=I.innerText.length,U=T(),H=o-(q-U);if(H<=0){$.preventDefault();return}if(O){$.preventDefault();const X=new DOMParser().parseFromString(O,"text/html");P(X.body);const ae=X.body.innerText;ae.length>H&&(X.body.innerHTML="",X.body.appendChild(document.createTextNode(ae.slice(0,H))));const J=document.createRange().createContextualFragment(X.body.innerHTML),Y=window.getSelection();if(!Y||Y.rangeCount===0)return;const te=Y.getRangeAt(0);te.deleteContents(),te.insertNode(J),te.collapse(!1),Y.removeAllRanges(),Y.addRange(te),R();return}else if(A.length>H){$.preventDefault();const X=A.slice(0,H);M(X),R()}},[s,o,R,T,M,P]),W=f.useCallback(()=>{x.flush(),l==null||l()},[x,l]);return f.useEffect(()=>{const $=b.current;if(!$)return;const I=O=>{const A=O.target;if(!A)return;const q=A.closest(v);if(!q||!$.contains(q))return;O.preventDefault(),$.focus({preventScroll:!0});const U=window.getSelection();if(!U)return;U.removeAllRanges();const H=document.createRange();H.selectNodeContents(q),U.addRange(H)};return $.addEventListener("pointerdown",I),()=>{$.removeEventListener("pointerdown",I)}},[v]),f.useEffect(()=>{{$d();return}},[m]),n.jsxs("div",{className:"relative px-4 sm:px-5",children:[n.jsx("div",{ref:b,className:F(["markdown","prose","dark:prose-invert","w-full","min-h-6","break-words","focus:outline-none",a]),contentEditable:!s,suppressContentEditableWarning:!0,onBeforeInput:p,onPaste:D,onInput:R,onBlur:W}),!s&&u&&n.jsx(Ad,{editorRef:b,intl:d,isDebugEnabled:m})]})},Rd=2e4,io=({isInlineWritingBlockEditEnabled:t,writingBlock:e,onChange:s,isStreaming:a,setDirty:o,flushPendingChanges:r,contentReferences:i})=>n.jsx(Ld,{setDirty:o,markdown:e.content,onChange:s,isDisabled:a||!t,maxLength:Rd,flushPendingChanges:r,contentReferences:i});function Id({content:t,clientThreadId:e,messageId:s,contentReferences:a}){const o=de(),r=K(),i=ct(),[l,c]=f.useState(!1),d=rl();return{handleCopy:async m=>{if(l)return;Fe.logEventWithStatsig("ChatGPT Writing Block Copy Button Clicked","chatgpt_writing_block_copy_button_clicked",B({},kt({clientThreadId:e,messageId:s})));const x=await pc(t,{preserveContentReferences:!0}),b=it(e);t!=null&&b!=null&&s!=null&&(Fe.logStructuredEvent($r,{conversationId:b,messageId:s}),Pr(o,{type:"copy",source:"mouse",location:"writing-block",selectedText:x,messageId:s,serverThreadId:b,contentType:"text"}));let w={"text/plain":x};try{w=Pa(x,a)}catch(h){dt.addError(h)}Ws(w,i,m),c(!0),d(()=>c(!1),2e3)},Icon:l?Ia:Da,copyLabel:r.formatMessage({id:"D5UU6P",defaultMessage:"Copy"})}}function Dd(t){"use forget";const e=ve.c(10),{clientThreadId:s,messageId:a,content:o,contentReferences:r}=t;let i;e[0]!==s||e[1]!==o||e[2]!==r||e[3]!==a?(i={clientThreadId:s,messageId:a,content:o,contentReferences:r},e[0]=s,e[1]=o,e[2]=r,e[3]=a,e[4]=i):i=e[4];const{handleCopy:l,copyLabel:c}=Id(i),d=!jt();let u;e[5]===Symbol.for("react.memo_cache_sentinel")?(u=F(nn,"font-normal","px-2 py-2"),e[5]=u):u=e[5];const m=d?void 0:c;let x;return e[6]!==l||e[7]!==d||e[8]!==m?(x=n.jsx(La,{onCopy:l,iconClassName:"icon-md me-0.5",className:u,iconOnly:d,buttonText:m}),e[6]=l,e[7]=d,e[8]=m,e[9]=x):x=e[9],x}function Fd({serverThreadId:t,messageId:e,index:s,title:a}){const o=ct(),r=K(),[i,l]=f.useState(!1),c=!jt();if(!t)return null;const d=r.formatMessage({id:"writingblock.downloadFileError",defaultMessage:"Download failed. Please try again."});async function u(m){var x;l(!0);try{const b=await Qs.safePost("/export_doc/writing_block",{requestBody:{conversation_id:t,message_id:e,index:s,export_type:m},skipJsonTransform:!0});b.ok||o.danger(d);const w=await b.blob(),h=b.headers.get("Content-Disposition"),_=(x=xc(h))!=null?x:"".concat((a!=null?a:"Export").replaceAll("/","-"),".").concat(m);gc(w,_)}catch(b){dt.addError(b,{tags:["type:writing_block_download_button","export_type:".concat(m)]}),o.danger(d)}finally{l(!1)}}return n.jsxs(ke.Root,{children:[n.jsx(ke.BasicTrigger,{asChild:!0,children:n.jsx("button",{className:"flex items-center gap-1 px-2 py-2 select-none",disabled:i,children:c?i?n.jsx(_n,{size:16}):n.jsx(Ue,{label:n.jsx(z,{id:"WritingBlockDownloadButton.downloadTooltip",defaultMessage:"Download"}),children:n.jsx(Es,{className:"icon-md block"})}):n.jsxs("div",{className:F("flex items-center gap-1",nn,"font-normal"),children:[i?n.jsx(_n,{size:20}):n.jsx(Es,{className:"icon-md block"}),n.jsx(z,{id:"WritingBlockDownloadButton.downloadTooltip",defaultMessage:"Download"})]})})}),n.jsx(ke.Portal,{children:n.jsxs(ke.Content,{align:"end",children:[n.jsx(ke.Label,{children:n.jsx(z,{id:"WritingBlockDownloadButton.menuTitle",defaultMessage:"Download"})}),n.jsx(ke.Item,{onSelect:()=>{u("pdf")},icon:Ar,label:r.formatMessage({id:"WritingBlockDownloadButton.downloadPdf.label",defaultMessage:"PDF document"}),trailing:n.jsx("span",{children:r.formatMessage({id:"WritingBlockDownloadButton.downloadPdf.ext",defaultMessage:".pdf"})})}),n.jsx(ke.Item,{onSelect:()=>{u("docx")},icon:il,label:r.formatMessage({id:"WritingBlockDownloadButton.downloadDocx.label",defaultMessage:"Microsoft Word"}),trailing:n.jsx("span",{children:r.formatMessage({id:"WritingBlockDownloadButton.downloadDocx.ext",defaultMessage:".docx"})})})]})})]})}function Od({content:t,clientThreadId:e,title:s,messageId:a,messageRef:o}){const r=K(),i=Lr(e);function l(){Ir.logButtonClick(Dr.OPEN_IN_CANVAS_WRITING_BLOCK),o.current&&Fr(o.current);const c=Or.DOCUMENT;Fe.logEventWithStatsig("ChatGPT Writing Block Edit in Canvas Button Clicked","chatgpt_writing_block_edit_in_canvas_button_clicked",B({},kt({clientThreadId:e,messageId:a}))),i({title:s!=null?s:r.formatMessage({id:"2V9CtJ",defaultMessage:"New document"}),textdocType:c,content:t,createSource:Br.MESSAGE_WRITING_BLOCK})}return n.jsx("button",{className:"flex items-center px-1.5 py-1 select-none",onClick:l,children:n.jsx(Ue,{label:n.jsx(z,{id:"WritingBlockOpenCanvasButton.openTooltip",defaultMessage:"Edit in Canvas"}),children:n.jsx(Rr,{className:"icon-md block"})})})}const lo=t=>{"use forget";const e=ve.c(39),{primaryLabel:s,primaryAction:a,writingBlock:o,clientThreadId:r,messageId:i,isInlineWritingBlockExportEnabled:l,serverThreadId:c,shouldShowWritingBlockCanvasEdit:d,title:u,index:m,messageRef:x,autosaveStatus:b,hideDownloadButton:w,contentReferences:h}=t,_=w===void 0?!1:w,v=de();let C;e[0]!==v?(C=ce(v,"1600402835"),e[0]=v,e[1]=C):C=e[1];const k=!1,y="idle";let j;e:{j="text-token-text-tertiary";break e}const S=j;let g;e[2]===Symbol.for("react.memo_cache_sentinel")?(g=F(Td,"flex w-full items-center justify-between gap-3 rounded-t-[22px] px-3.5 py-1.5 font-sans sm:ps-4.5 sm:pe-3.5"),e[2]=g):g=e[2];let N;e[3]!==s?(N=s!=null?s:n.jsx(z,{id:"Ui6xge",defaultMessage:"Writing"}),e[3]=s,e[4]=N):N=e[4];let P;e[5]!==S||e[6]!==y||e[7]!==k?(P=k,e[5]=S,e[6]=y,e[7]=k,e[8]=P):P=e[8];let L;e[9]!==N||e[10]!==P?(L=n.jsxs("div",{className:"text-token-text-secondary dark:text-token-text-tertiary text-token-text-primary flex max-w-[75%] flex-grow cursor-default items-center gap-2 text-sm",children:[N,P]}),e[9]=N,e[10]=P,e[11]=L):L=e[11];let E;e[12]!==r||e[13]!==h||e[14]!==i||e[15]!==o?(E=r&&i&&n.jsx("div",{className:"text-token-text-secondary dark:text-token-text-tertiary dark:hover:text-token-text-primary hover:text-token-text-primary",children:n.jsx(Dd,{content:o.content,clientThreadId:r,messageId:i,contentReferences:h})}),e[12]=r,e[13]=h,e[14]=i,e[15]=o,e[16]=E):E=e[16];let R;e[17]!==_||e[18]!==m||e[19]!==l||e[20]!==i||e[21]!==c||e[22]!==u?(R=!_&&l&&c&&i&&n.jsx("div",{className:"text-token-text-secondary dark:text-token-text-tertiary dark:hover:text-token-text-primary hover:text-token-text-primary",children:n.jsx(Fd,{serverThreadId:c,messageId:i,title:u,index:m})}),e[17]=_,e[18]=m,e[19]=l,e[20]=i,e[21]=c,e[22]=u,e[23]=R):R=e[23];let T;e[24]!==r||e[25]!==i||e[26]!==x||e[27]!==d||e[28]!==u||e[29]!==o?(T=r&&i&&d&&n.jsx("div",{className:"text-token-text-secondary dark:text-token-text-tertiary dark:hover:text-token-text-primary hover:text-token-text-primary",children:n.jsx(Od,{content:o.content,clientThreadId:r,messageId:i,title:u,messageRef:x})}),e[24]=r,e[25]=i,e[26]=x,e[27]=d,e[28]=u,e[29]=o,e[30]=T):T=e[30];let M;e[31]!==a||e[32]!==T||e[33]!==E||e[34]!==R?(M=n.jsxs("div",{className:"flex items-center justify-between",children:[E,R,T,a]}),e[31]=a,e[32]=T,e[33]=E,e[34]=R,e[35]=M):M=e[35];let p;return e[36]!==M||e[37]!==L?(p=n.jsx("div",{className:"thread-xl:-top-[var(--header-height)] sticky top-0 z-1 mx-[1px] rounded-t-[22px] rounded-b-lg backdrop-blur-md",children:n.jsxs("div",{className:g,children:[L,M]})}),e[36]=M,e[37]=L,e[38]=p):p=e[38],p},gs={hr:"mx-4 my-0! border-0 border-t !border-token-border-light sm:mx-[1px]"},Bd=({children:t,hasBeenEdited:e,messageId:s,clientThreadId:a,messageRef:o,shouldShowWritingBlockCanvasEdit:r=!1,isInlineWritingBlockEditEnabled:i,isInlineWritingBlockExportEnabled:l,writingBlock:c,index:d,onChange:u,isStreaming:m,autosaveStatus:x,title:b,recipient:w,setDirty:h,flushPendingChanges:_,contentReferences:v})=>{var D,W,$;const C=Ct(a),[k,y]=f.useState((D=c.title)!=null?D:""),[j,S]=f.useState(String(($=(W=c.metadata)==null?void 0:W.recipient)!=null?$:"")),g=K(),N=sn(u,300),P=f.useCallback(I=>{h(!0),y(I.target.value),N({title:I.target.value})},[N,h]),L=f.useCallback(I=>{h(!0),S(I.target.value),N({metadata:{recipient:I.target.value}})},[N,h]),E=f.useCallback(I=>{h(!0),N({title:I.target.value}),N.flush(),_==null||_()},[N,_,h]),R=f.useCallback(I=>{h(!0),N({metadata:{recipient:I.target.value}}),N.flush(),_==null||_()},[N,_,h]),T=f.useCallback(I=>{const O=encodeURIComponent(Wr(c.content)),A=encodeURIComponent(j),q=encodeURIComponent(k);switch(I){case"gmail":return"https://mail.google.com/mail/u/0/?tf=cm&to=".concat(A,"&su=").concat(q,"&body=").concat(O);case"outlook":return"https://outlook.office.com/mail/deeplink/compose?to=".concat(A,"&subject=").concat(q,"&body=").concat(O);case"default":return"mailto:".concat(j,"?subject=").concat(q,"&body=").concat(O)}},[j,k,c.content]),M=n.jsx(z,{id:"PrFQxx",defaultMessage:"Email"}),p=n.jsx(Ed,{clientThreadId:a,messageId:s,onClick:I=>window.open(T(I),"_blank")});return n.jsxs("div",{ref:o,id:"writing-block-".concat(s),className:F(Ls,"pt-0.5 pb-3"),"data-writing-block":!0,children:[n.jsx(lo,{primaryLabel:M,primaryAction:p,writingBlock:c,clientThreadId:a,messageId:s,title:b,hideDownloadButton:!0,isInlineWritingBlockEditEnabled:i,hasBeenEdited:e,autosaveStatus:x,shouldShowWritingBlockCanvasEdit:r,isInlineWritingBlockExportEnabled:l,serverThreadId:C,index:d,messageRef:o,contentReferences:v}),n.jsx("hr",{className:gs.hr}),n.jsxs("div",{className:"flex w-full min-w-0 items-center px-4 py-1 font-sans sm:px-5",children:[n.jsx("div",{className:"font-medium",children:n.jsx(z,{id:"NPvnYL",defaultMessage:"To"})}),n.jsx("input",{disabled:m||!i,className:F(Tn),maxLength:240,placeholder:g.formatMessage({id:"12HHUV",defaultMessage:"name@email.com"}),value:m?w:j,onChange:L,onBlur:R,onCopy:I=>I.stopPropagation()})]}),n.jsx("hr",{className:gs.hr}),n.jsxs("div",{className:"flex w-full min-w-0 items-center px-4 py-1 font-sans sm:px-5",children:[n.jsx("div",{className:"font-medium",children:n.jsx(z,{id:"eQGtfX",defaultMessage:"Subject"})}),n.jsx("input",{disabled:m||!i,className:F(Tn),value:m?b:k,maxLength:240,onChange:P,onBlur:E,onCopy:I=>I.stopPropagation()})]}),n.jsx("hr",{className:F(gs.hr,"mb-4!")}),n.jsx(io,{isInlineWritingBlockEditEnabled:i,writingBlock:c,onChange:u,isStreaming:m,setDirty:h,flushPendingChanges:_,contentReferences:v,children:t})]})};function Wd({serverThreadId:t,index:e,messageId:s,writingBlock:a,dirty:o,setDirty:r,delay:i=2e3}){const[l,c]=f.useState(!1),[d,u]=f.useState(null),[m,x]=f.useState(null),[b,w]=f.useState(!1),[h,_]=f.useState(!1),v=f.useRef(0),C=f.useRef(a.content),k=f.useRef(a.title),y=f.useRef(a.metadata),j=f.useRef(!1),S=f.useRef(!1),g=f.useRef(0),N=f.useRef(null),{mutate:P}=Ta({mutationFn:async({content:M,title:p,metadata:D})=>{v.current+=1,v.current>1&&_(!0),!(!t||!s)&&await Qs.safePost("/conversation/message/writing-blocks",{requestBody:{message_id:s,conversation_id:t,index:String(e),id:a.id,writing_block:{content:M,index:String(e),variant:a.variant.toString(),metadata:D,title:p,id:a.id},updated_at:new Date().toISOString()},authOption:Ja.SendIfAvailable})},onSuccess:(M,p,D)=>{N.current===(D==null?void 0:D.myVersion)&&(r(!1),x(new Date))},onMutate:()=>{v.current=0,_(!1);const M=++g.current;return N.current=M,c(!0),u(null),{myVersion:M}},onError:(M,p,D)=>{u(M.message),r(!0)},onSettled:(M,p,D,W)=>{v.current=0,_(!1),N.current===(W==null?void 0:W.myVersion)&&(c(!1),N.current=null,j.current&&L.flush())},retry:1,retryDelay:3e3}),L=sn(({content:M,title:p,metadata:D})=>{j.current=!1,w(!1),P({content:M,title:p,metadata:D})},i);f.useEffect(()=>{var M;if(a.content===C.current&&a.title===k.current&&a.metadata===y.current){S.current=!1;return}C.current=a.content,k.current=a.title,y.current=a.metadata,j.current=!0,w(!0),L({content:a.content,title:a.title,metadata:(M=a.metadata)!=null?M:{}}),S.current&&(Promise.resolve().then(()=>{L.flush()}),S.current=!1)},[a.content,a.title,a.metadata,L]),f.useEffect(()=>()=>{L.cancel(),S.current=!1,w(!1)},[L]);const E=f.useCallback(()=>{if(!o&&!j.current){S.current=!1,w(!1);return}S.current=!0,j.current&&(L.flush(),S.current=!1,w(!1))},[o,L]),R=f.useMemo(()=>!!m&&!o&&!l,[m,o,l]);return{status:f.useMemo(()=>h?"retrying":l?"saving":d?"error":b?"queued":o?"dirty":R?"saved":"idle",[h,l,d,b,o,R]),savedAt:m,error:d,flushPendingChanges:E}}const zd=()=>({editWritingBlock:f.useCallback(({content:e,clientThreadId:s,message:a,index:o,variant:r,metadata:i,title:l,id:c})=>{var d,u;(u=(d=a.metadata)==null?void 0:d.writing_blocks)!=null&&u[c]||Fe.logEventWithStatsig("ChatGPT Writing Block First Edit","chatgpt_writing_block_first_edit",B({},kt({clientThreadId:s,messageId:a.id}))),ll(s,m=>cl.updateTree(m,x=>{var b,w;return x.updateNodeMessageMetadata(a.id,{writing_blocks:G(B({},(w=(b=a.metadata)==null?void 0:b.writing_blocks)!=null?w:{}),{[c]:{id:c,index:o,content:e,variant:r,title:l,metadata:i}})})}))},[])}),Hd=t=>{"use forget";var X,ae,J,Y,te,Q,ue,ne,xe,he,Ne,Pe;const e=ve.c(82),{title:s,children:a,originalContent:o,messageId:r,clientThreadId:i,variant:l,recipient:c,isStreaming:d,index:u,id:m}=t,[x,b]=f.useState(!1),w=dl(zr.EditInCanvas),h=de();let _;e[0]!==h?(_=ce(h,"2740339093"),e[0]=h,e[1]=_):_=e[1];const v=_;let C;e[2]!==h?(C=ce(h,"669593727"),e[2]=h,e[3]=C):C=e[3];const k=C,y=Ct(i);let j;e[4]!==r?(j=fe=>r?Ye.getNode(fe,r).message:void 0,e[4]=r,e[5]=j):j=e[5];let S;e[6]===Symbol.for("react.memo_cache_sentinel")?(S={disablePerfDetector:!0},e[6]=S):S=e[6];const g=lt(i,j,S),N=(ae=(X=g==null?void 0:g.metadata)==null?void 0:X.writing_blocks)==null?void 0:ae[m];N==null||N.metadata;let P,L;e[7]!==c||e[8]!==(N==null?void 0:N.metadata)?(L=(J=N==null?void 0:N.metadata)!=null?J:{recipient:c!=null?c:null},e[7]=c,e[8]=N==null?void 0:N.metadata,e[9]=L):L=e[9],P=L;const E=P,R=!!N,{editWritingBlock:T}=zd(),M=vt(),p=v&&y!=null&&!M;let D,W;e[10]!==m||e[11]!==u||e[12]!==((Y=g==null?void 0:g.metadata)==null?void 0:Y.writing_blocks)||e[13]!==E||e[14]!==o||e[15]!==s||e[16]!==l?(W=(ue=(Q=(te=g==null?void 0:g.metadata)==null?void 0:te.writing_blocks)==null?void 0:Q[m])!=null?ue:{id:m,content:o,index:u,variant:l,title:s,metadata:E},e[10]=m,e[11]=u,e[12]=(ne=g==null?void 0:g.metadata)==null?void 0:ne.writing_blocks,e[13]=E,e[14]=o,e[15]=s,e[16]=l,e[17]=W):W=e[17],D=W;const $=D;let I,O;e[18]!==((xe=g==null?void 0:g.metadata)==null?void 0:xe.content_references)?(O=(Ne=(he=g==null?void 0:g.metadata)==null?void 0:he.content_references)!=null?Ne:[],e[18]=(Pe=g==null?void 0:g.metadata)==null?void 0:Pe.content_references,e[19]=O):O=e[19],I=O;const A=I;let q;e[20]!==x||e[21]!==u||e[22]!==r||e[23]!==y||e[24]!==$?(q={serverThreadId:y,index:u,messageId:r,dirty:x,setDirty:b,writingBlock:$},e[20]=x,e[21]=u,e[22]=r,e[23]=y,e[24]=$,e[25]=q):q=e[25];const{status:U,flushPendingChanges:H}=Wd(q);let re;e[26]!==i||e[27]!==T||e[28]!==m||e[29]!==u||e[30]!==g||e[31]!==E||e[32]!==l||e[33]!==$?(re=fe=>{const{content:le,title:oe,metadata:pe}=fe;!i||!g||!g.id||T({content:le!=null?le:$.content,clientThreadId:i,message:g,index:u,variant:l,metadata:Object.assign({},E,pe),title:oe!=null?oe:$.title,id:m})},e[26]=i,e[27]=T,e[28]=m,e[29]=u,e[30]=g,e[31]=E,e[32]=l,e[33]=$,e[34]=re):re=e[34];const V=re,Z=f.useRef(null);switch(l){case qt.EMAIL:{const fe=s!=null?s:"",le=c!=null?c:"";let oe;return e[35]!==U||e[36]!==a||e[37]!==i||e[38]!==A||e[39]!==H||e[40]!==V||e[41]!==R||e[42]!==u||e[43]!==k||e[44]!==d||e[45]!==p||e[46]!==r||e[47]!==w||e[48]!==fe||e[49]!==le||e[50]!==$?(oe=n.jsx(Bd,{hasBeenEdited:R,messageRef:Z,clientThreadId:i,messageId:r,index:u,shouldShowWritingBlockCanvasEdit:w,isInlineWritingBlockEditEnabled:p,isInlineWritingBlockExportEnabled:k,onChange:V,writingBlock:$,isStreaming:d,autosaveStatus:U,title:fe,recipient:le,setDirty:b,flushPendingChanges:H,contentReferences:A,children:a}),e[35]=U,e[36]=a,e[37]=i,e[38]=A,e[39]=H,e[40]=V,e[41]=R,e[42]=u,e[43]=k,e[44]=d,e[45]=p,e[46]=r,e[47]=w,e[48]=fe,e[49]=le,e[50]=$,e[51]=oe):oe=e[51],oe}default:{if(d&&l===qt.UNKNOWN&&o===""){const Me="writing-block-".concat(r);let Ae;e[52]===Symbol.for("react.memo_cache_sentinel")?(Ae=F(Ls,"px-4 py-2","h-10"),e[52]=Ae):Ae=e[52];let ee;return e[53]!==Me?(ee=n.jsx("div",{ref:Z,id:Me,className:Ae,"data-writing-block":!0}),e[53]=Me,e[54]=ee):ee=e[54],ee}const fe="writing-block-".concat(r);let le;e[55]===Symbol.for("react.memo_cache_sentinel")?(le=F(Ls,"pt-0.5 pb-3"),e[55]=le):le=e[55];let oe;e[56]!==U||e[57]!==i||e[58]!==A||e[59]!==R||e[60]!==u||e[61]!==k||e[62]!==p||e[63]!==r||e[64]!==y||e[65]!==w||e[66]!==s||e[67]!==$?(oe=n.jsx(lo,{hasBeenEdited:R,autosaveStatus:U,writingBlock:$,clientThreadId:i,messageId:r,isInlineWritingBlockExportEnabled:k,isInlineWritingBlockEditEnabled:p,serverThreadId:y,shouldShowWritingBlockCanvasEdit:w,title:s,index:u,messageRef:Z,contentReferences:A}),e[56]=U,e[57]=i,e[58]=A,e[59]=R,e[60]=u,e[61]=k,e[62]=p,e[63]=r,e[64]=y,e[65]=w,e[66]=s,e[67]=$,e[68]=oe):oe=e[68];let pe;e[69]===Symbol.for("react.memo_cache_sentinel")?(pe=n.jsx("hr",{className:"border-token-border-light! mx-4 my-0! mb-3! border-0 border-t sm:mx-[1px]"}),e[69]=pe):pe=e[69];let _e;e[70]!==a||e[71]!==A||e[72]!==H||e[73]!==V||e[74]!==d||e[75]!==p||e[76]!==$?(_e=n.jsx(io,{setDirty:b,isInlineWritingBlockEditEnabled:p,writingBlock:$,onChange:V,isStreaming:d,flushPendingChanges:H,contentReferences:A,children:a}),e[70]=a,e[71]=A,e[72]=H,e[73]=V,e[74]=d,e[75]=p,e[76]=$,e[77]=_e):_e=e[77];let je;return e[78]!==fe||e[79]!==oe||e[80]!==_e?(je=n.jsxs("div",{ref:Z,id:fe,className:le,"data-writing-block":!0,children:[oe,pe,_e]}),e[78]=fe,e[79]=oe,e[80]=_e,e[81]=je):je=e[81],je}}};function Ud(t){return t&&/^turn[0-9]+ifs[0-9]+$/.test(t)}const En=4;function qd({metadata:t,analyticsMetadata:e,trackContentReferenceEvent:s,imageSource:a,superWidgetImages:o,isFirstAssistantContent:r}){const i=a!=null?a:nt.Turn,l=St(),c=de(),d=Nt(c)&&Qa(c),u=f.useMemo(()=>!d||!o?t.images:Hr(t.images.concat(o),v=>v.thumbnail_url),[t.images,d,o]),m=t.images.some(v=>v.is_proxied_image)?[]:u.map(v=>v.thumbnail_url),x=Wo({queries:m.map(v=>Ur(v,"_ImageCarousel")),combine:v=>{const C=new Set;return v.forEach((k,y)=>{k.isSuccess&&C.add(m[y])}),C}}),b=u.filter(v=>x.has(v.thumbnail_url)),w=t.images.length;if(t.images.some(v=>v.is_proxied_image)){const v=t.images.find(k=>k.is_proxied_image),C=F("mb-7 mt-1 min-w-32 max-w-[22%] rounded-xl border-[0.5px] border-token-border-default",v!=null&&v.float_top?"relative block":"float-image z-10 float-end clear-end ms-7 overflow-hidden");return n.jsx(ze,{image:v,imageSource:i,analyticsMetadata:e,trackContentReferenceEvent:s,eventMetadata:{imageUse:"deepResearch"},aspectRatio:Bt,className:C,contentReferenceType:"image_v2"},v==null?void 0:v.content_url)}if(w===0)return null;if(w===1){const v=t.images[0];return n.jsx(ze,{image:v,imageSource:i,analyticsMetadata:e,trackContentReferenceEvent:s,eventMetadata:{imageUse:"legacyCarousel"},aspectRatio:Bt,className:"float-image border-token-border-default float-end clear-end ms-7 mt-1 mb-7 max-w-[22%] min-w-32 overflow-hidden rounded-xl border-[0.5px]",contentReferenceType:"image_v2"},v.content_url)}const h=d?null:En,_=l||h==null?b.length:Math.min(b.length,h);return b.length>En&&d?n.jsx(Vd,{images:b.slice(0,_),imageSource:i,analyticsMetadata:e,trackContentReferenceEvent:s,isFirstAssistantContent:r}):n.jsx("div",{className:"no-scrollbar mt-1 mb-6 flex min-h-36 flex-nowrap gap-0.5 overflow-auto sm:gap-1 sm:overflow-hidden xl:min-h-44",children:b.slice(0,_).map((v,C)=>n.jsx("div",{className:F("border-token-border-default relative aspect-square w-32 shrink-0 overflow-hidden rounded-xl border-[0.5px] md:shrink","max-h-48 sm:w-[calc((100%-0.5rem)/4)]",C===0&&"rounded-s-xl",C===_-1&&"rounded-e-xl"),children:n.jsx(ze,{image:v,imageSource:i,analyticsMetadata:e,trackContentReferenceEvent:s,eventMetadata:{imageUse:"legacyCarousel"},aspectRatio:Bt,className:"h-full w-full",contentReferenceType:"image_v2"},v.thumbnail_url)},v.thumbnail_url))})}const an=f.memo(qd,(t,e)=>t.numImageResults===e.numImageResults&&t.analyticsMetadata===e.analyticsMetadata&&t.trackContentReferenceEvent===e.trackContentReferenceEvent&&t.metadata.images.length===e.metadata.images.length&&t.metadata.images.every((s,a)=>s.content_url===e.metadata.images[a].content_url));function ze({image:t,imageSource:e,className:s,imgClassName:a,style:o,analyticsMetadata:r,trackContentReferenceEvent:i,eventMetadata:l={},badge:c,lightboxImages:d,aspectRatio:u,enableHoverAnimation:m=!0,skeletonEl:x,contentReferenceType:b}){var L,E;const w=qr(t,{width:Gr,aspectRatio:u!=null?u:void 0}),h=t==null?void 0:t.content_url.replace(/^http:\/\//,"https://"),_=Yd(t),{isSuccess:v}=$s(w,"ImageCarousel_thumbnail"),{isSuccess:C,isError:k}=$s(_?h:void 0,"ImageCarousel_full"),y=f.useMemo(()=>B({image_url:w,title:t==null?void 0:t.title},l),[w,t==null?void 0:t.title,l]);f.useEffect(()=>{t&&v&&i("Search Content Reference Shown","search_content_reference_shown",b,y)},[i,t,v,y,b]),f.useEffect(()=>{h&&k&&dt.addAction("Failed to download full image",{url:h,thumbnailUrl:w})},[h,k,w]);const j=Gs.useStore(),S=Vr((L=t==null?void 0:t.thumbnail_crop_info)!=null?L:null,(E=t==null?void 0:t.thumbnail_size)!=null?E:null,u!=null?u:void 0),g=!t||!(v||C||t.is_proxied_image),N=(()=>{if(!g)return t.is_proxied_image?t.url:_&&C?h:w})(),P=B(B({},o),u?{aspectRatio:"".concat(u.width,"/").concat(u.height)}:{});return n.jsxs("button",{className:F("relative overflow-hidden",s),style:P,onClick:()=>{i("Search Content Reference Clicked","search_content_reference_clicked",b,y),j.setCurrentImage(t?{image:t,source:e,analyticsMetadata:r,imageResults:d}:void 0)},children:[Gd({isLoading:g,enableHoverAnimation:m,src:N,image:t,objectPosition:S,className:a,skeletonEl:x}),c&&n.jsx("div",{className:"pointer-events-none absolute end-2 bottom-2",children:c})]})}function Gd({isLoading:t,enableHoverAnimation:e,src:s,image:a,objectPosition:o,className:r,skeletonEl:i}){if(t)return i!=null?i:n.jsx("div",{className:"bg-token-main-surface-tertiary aspect-square h-full w-full animate-pulse"});const l=n.jsx("img",{src:s,alt:a==null?void 0:a.content_url,style:o?{objectPosition:o}:{},className:F("bg-token-main-surface-tertiary m-0 h-full w-full object-cover",r)});return e?n.jsx(Fa,{children:l}):l}function Vd(t){"use forget";const e=ve.c(13),{images:s,imageSource:a,analyticsMetadata:o,trackContentReferenceEvent:r,isFirstAssistantContent:i}=t,l=de(),c=ss(l),d=Zd,u=i&&"mt-2",m=c?"-mx-[var(--thread-content-margin)]":"-mx-6";let x;e[0]!==u||e[1]!==m?(x=F("relative mb-6",u,m),e[0]=u,e[1]=m,e[2]=x):x=e[2];let b;e[3]!==o||e[4]!==a||e[5]!==r?(b=_=>n.jsx(ze,{image:_,imageSource:a,analyticsMetadata:o,trackContentReferenceEvent:r,className:"aspect-auto h-full w-full",aspectRatio:null,contentReferenceType:"image_v2"}),e[3]=o,e[4]=a,e[5]=r,e[6]=b):b=e[6];let w;e[7]!==s||e[8]!==b?(w=n.jsx(Vs,{items:s,getItemKey:Xd,itemClassName:"max-w-[200px] min-w-[120px] sm:max-w-[calc((var(--thread-content-max-width)-2rem)/3)]",getItemStyle:d,onRenderItem:b,className:"h-48 min-h-48"}),e[7]=s,e[8]=b,e[9]=w):w=e[9];let h;return e[10]!==x||e[11]!==w?(h=n.jsx("div",{className:x,children:w}),e[10]=x,e[11]=w,e[12]=h):h=e[12],h}function Xd(t){return t.thumbnail_url}function Zd(t){const{width:e,height:s}=t.content_size;return{width:s?e/s*192:180}}function Yd(t){return!t||t.is_proxied_image?!1:t.thumbnail_url.includes("images.openai.com")}function co({numImages:t}){return n.jsxs("div",{className:"flex items-center gap-1 rounded-full px-2 py-1.5 text-white backdrop-blur-md backdrop-brightness-75",children:[n.jsx(Xr,{className:"h-4 w-4"}),n.jsx("span",{className:"text-xs font-semibold",children:t})]})}function Kd(t){"use forget";const e=ve.c(72),{images:s,className:a,aspect:o,objectPosition:r,showArrows:i,imageClassName:l,slideClassName:c,gap:d,peekPercent:u,onClick:m}=t,x=a===void 0?"":a,b=o===void 0?"aspect-[16/9]":o,w=r===void 0?"object-cover":r,h=i===void 0?!0:i,_=l===void 0?"":l,v=c===void 0?"":c,C=d===void 0?2:d,k=u===void 0?95:u,[y,j]=f.useState(0),[S,g]=f.useState(!1),[N,P]=f.useState(!1),L=f.useRef(null);let E;e[0]===Symbol.for("react.memo_cache_sentinel")?(E=[],e[0]=E):E=e[0];const R=f.useRef(E),T=f.useRef(null),M=K(),p=s.length,D=et(k,0,100),W="".concat(D,"%");let $;e[1]!==W?($={maxWidth:W},e[1]=W,e[2]=$):$=e[2];const I=$;let O;e[3]!==p?(O=(ee,se)=>{const ie=R.current[ee];if(!ie)return 0;const me=ie.offsetLeft,be=me+ie.offsetWidth,Qe=se.clientWidth,Le=Math.max(0,se.scrollWidth-Qe);if(p<=1||ee===0)return et(me,0,Le);if(ee===p-1){const $t=be-Qe;return et($t,0,Le)}const os=me-(Qe-ie.offsetWidth)/2;return et(os,0,Le)},e[3]=p,e[4]=O):O=e[4];const A=O;let q;e[5]!==A||e[6]!==p?(q=(ee,se)=>{const ie=se===void 0?"smooth":se;if(p===0||ee<0||ee>=p)return;const me=L.current;if(!me)return;const be=A(ee,me);if(Pn(me.scrollLeft,be)){ie!=="auto"&&me.scrollTo({left:be,behavior:"auto"}),T.current=null;return}T.current=be,me.scrollTo({left:be,behavior:ie})},e[5]=A,e[6]=p,e[7]=q):q=e[7];const U=q;let H,re;e[8]!==h?(H=()=>{if(!h)return;P(!0);const ee=window.setTimeout(()=>P(!1),2e3);return()=>window.clearTimeout(ee)},re=[h],e[8]=h,e[9]=H,e[10]=re):(H=e[9],re=e[10]),f.useEffect(H,re);const V=S&&y!==0,Z=S||N;let X;e[11]!==y||e[12]!==U||e[13]!==p?(X=ee=>{if(p===0)return;const se=et(ee,0,p-1);U(se,"smooth"),se!==y&&j(se)},e[11]=y,e[12]=U,e[13]=p,e[14]=X):X=e[14];const ae=X;let J;e[15]!==ae||e[16]!==y||e[17]!==p?(J=()=>{if(p!==0){if(y>=p-1){ae(0);return}ae(y+1)}},e[15]=ae,e[16]=y,e[17]=p,e[18]=J):J=e[18];const Y=J;let te;e[19]!==ae||e[20]!==y?(te=()=>ae(y-1),e[19]=ae,e[20]=y,e[21]=te):te=e[21];const Q=te;let ue,ne;e[22]!==A||e[23]!==y||e[24]!==p?(ue=()=>{const ee=L.current;if(!ee)return;const se=()=>{const ie=ee.scrollLeft||0,me=T.current;if(me!=null){Pn(ie,me)&&(T.current=null);return}let be=y,Qe=Number.POSITIVE_INFINITY;for(let Le=0;Le<p;Le++){const os=A(Le,ee),$t=Math.abs(os-ie);$t<Qe-.5&&(Qe=$t,be=Le)}be!==y&&j(be)};return ee.addEventListener("scroll",se,{passive:!0}),()=>ee.removeEventListener("scroll",se)},ne=[p,y,A],e[22]=A,e[23]=y,e[24]=p,e[25]=ue,e[26]=ne):(ue=e[25],ne=e[26]),f.useEffect(ue,ne);let xe,he;e[27]!==S||e[28]!==Y||e[29]!==Q||e[30]!==p?(xe=()=>{if(!S)return;const ee=se=>{if(se.defaultPrevented||se.altKey||se.ctrlKey||se.metaKey||se.shiftKey)return;const ie=se.target;if(ie instanceof HTMLElement){if(ie.isContentEditable)return;const me=ie.tagName;if(me==="INPUT"||me==="TEXTAREA"||me==="SELECT")return;const be=ie.getAttribute("role");if(be==="textbox"||be==="combobox")return}p<=1||(se.key==="ArrowRight"?(se.preventDefault(),Y()):se.key==="ArrowLeft"&&(se.preventDefault(),Q()))};return window.addEventListener("keydown",ee),()=>window.removeEventListener("keydown",ee)},he=[S,p,Y,Q],e[27]=S,e[28]=Y,e[29]=Q,e[30]=p,e[31]=xe,e[32]=he):(xe=e[31],he=e[32]),f.useEffect(xe,he);const Ne="select-none ".concat(x," relative");let Pe,fe;e[33]===Symbol.for("react.memo_cache_sentinel")?(Pe=()=>g(!0),fe=()=>g(!1),e[33]=Pe,e[34]=fe):(Pe=e[33],fe=e[34]);const le="relative w-full ".concat(b," overflow-clip");let oe;e[35]!==C?(oe={gap:C},e[35]=C,e[36]=oe):oe=e[36];let pe;if(e[37]!==_||e[38]!==s||e[39]!==M||e[40]!==w||e[41]!==m||e[42]!==v||e[43]!==p||e[44]!==I){let ee;e[46]!==_||e[47]!==M||e[48]!==w||e[49]!==m||e[50]!==v||e[51]!==p||e[52]!==I?(ee=(se,ie)=>{var me;return n.jsx("div",{onClick:()=>m==null?void 0:m(se,ie),ref:be=>{R.current[ie]=be},className:F("relative flex h-full shrink-0 grow-0 snap-always items-stretch",ie===0&&"snap-start",ie===p-1&&"snap-end",ie>0&&ie<p-1&&"snap-center",v),style:I,children:se.content?se.content:n.jsx("img",{src:se.src,alt:(me=se.alt)!=null?me:M.formatMessage({id:"wHCsqa",defaultMessage:"Slide {index}"},{index:ie+1}),className:"h-full w-auto ".concat(w," ").concat(_)})},ie)},e[46]=_,e[47]=M,e[48]=w,e[49]=m,e[50]=v,e[51]=p,e[52]=I,e[53]=ee):ee=e[53],pe=s.map(ee),e[37]=_,e[38]=s,e[39]=M,e[40]=w,e[41]=m,e[42]=v,e[43]=p,e[44]=I,e[45]=pe}else pe=e[45];let _e;e[54]!==oe||e[55]!==pe?(_e=n.jsx("div",{ref:L,className:"no-scrollbar flex h-full w-full touch-pan-x snap-x snap-mandatory overflow-x-scroll scroll-smooth",style:oe,children:pe}),e[54]=oe,e[55]=pe,e[56]=_e):_e=e[56];let je;e[57]!==s.length||e[58]!==M||e[59]!==V||e[60]!==Y||e[61]!==Q||e[62]!==Z||e[63]!==h?(je=h&&s.length>1&&n.jsxs(n.Fragment,{children:[n.jsx(An,{ariaLabel:M.formatMessage({id:"l9pylv",defaultMessage:"Previous slide"}),onClick:Q,side:"start",visible:V,children:n.jsx(Oa,{className:"icon-md"})}),n.jsx(An,{ariaLabel:M.formatMessage({id:"L0pbQh",defaultMessage:"Next slide"}),onClick:Y,side:"end",visible:Z,children:n.jsx(Xs,{className:"icon-md"})})]}),e[57]=s.length,e[58]=M,e[59]=V,e[60]=Y,e[61]=Q,e[62]=Z,e[63]=h,e[64]=je):je=e[64];let Me;e[65]!==le||e[66]!==_e||e[67]!==je?(Me=n.jsxs("div",{className:le,children:[_e,je]}),e[65]=le,e[66]=_e,e[67]=je,e[68]=Me):Me=e[68];let Ae;return e[69]!==Ne||e[70]!==Me?(Ae=n.jsx("div",{className:Ne,"aria-roledescription":"carousel",onMouseEnter:Pe,onMouseLeave:fe,children:Me}),e[69]=Ne,e[70]=Me,e[71]=Ae):Ae=e[71],Ae}const $n={width:4,height:5};function Jd(t){"use forget";const e=ve.c(7),{image:s}=t,a=$n.height/$n.width;let o;e[0]===Symbol.for("react.memo_cache_sentinel")?(o={maxHeight:"calc(100cqw * ".concat(a,")")},e[0]=o):o=e[0];let r;e[1]!==s.alt||e[2]!==s.content||e[3]!==s.src?(r=s.content?s.content:n.jsx("img",{src:s.src,alt:s.alt,className:"h-full w-full object-cover"}),e[1]=s.alt,e[2]=s.content,e[3]=s.src,e[4]=r):r=e[4];let i;return e[5]!==r?(i=n.jsx("div",{className:"[container-type:inline-size] w-full overflow-hidden [font-size:0] leading-none",style:o,children:r}),e[5]=r,e[6]=i):i=e[6],i}function Qd(t){"use forget";const e=ve.c(4);if(t.images.length===0)return null;if(t.images.length===1){let a;return e[0]!==t.images[0]?(a=n.jsx(Jd,{image:t.images[0]}),e[0]=t.images[0],e[1]=a):a=e[1],a}let s;return e[2]!==t?(s=n.jsx(Kd,B({},t)),e[2]=t,e[3]=s):s=e[3],s}const et=(t,e,s)=>Math.min(Math.max(t,e),s),Pn=(t,e,s=1)=>Math.abs(t-e)<=s;function An(t){"use forget";const e=ve.c(8),{ariaLabel:s,onClick:a,side:o,visible:r,children:i}=t,l=o==="start"?"start-3":"end-3",c=r?"opacity-90 pointer-events-auto":"opacity-0 pointer-events-none";let d;e[0]!==l||e[1]!==c?(d=F("btn-secondary border-token-border-default active:bg-token-bg-tertiary hover:bg-token-bg-primary absolute top-1/2 flex h-8 w-8 -translate-y-1/2 items-center justify-center rounded-full bg-clip-padding backdrop-blur transition-opacity duration-300 hover:shadow-[0px_4px_16px_0px_rgba(0,0,0,0.05)] active:opacity-100!",c,l),e[0]=l,e[1]=c,e[2]=d):d=e[2];let u;return e[3]!==s||e[4]!==i||e[5]!==a||e[6]!==d?(u=n.jsx("button",{"aria-label":s,onClick:a,className:d,children:i}),e[3]=s,e[4]=i,e[5]=a,e[6]=d,e[7]=u):u=e[7],u}const uo="mt-1 mb-5 [&:not(:first-child)]:mt-4",eu=/^image_group[\s\S]*$/;function tu({contentReference:t,trackContentReferenceEvent:e,analyticsMetadata:s}){var d;const{images:a,layout:o="carousel",aspect_ratio:r}=t,i=eu.test((d=t.matched_text)!=null?d:""),l=iu(r!=null?r:"1:1"),c={images:a,trackContentReferenceEvent:e,analyticsMetadata:s,aspectRatio:l,isReferenceComplete:i};return o==="carousel"?n.jsx(uu,B({},c)):o==="bento"?n.jsx(lu,B({},c)):o==="full_width"?n.jsx(fu,B({},c)):null}const at={width:9,height:5},su={width:at.width/3,height:at.height},nu={width:at.width/3,height:at.height/2};function au(t,e){if(e)switch(t){case 0:return"rounded-tr-md rounded-br-md rounded-tl-xl rounded-bl-xl";case 1:return"rounded-md";case 2:return"rounded-tr-xl rounded-br-md rounded-tl-md rounded-bl-md";case 3:return"rounded-tr-md rounded-br-xl rounded-tl-md rounded-bl-md";default:return""}switch(t){case 0:return"rounded-tr-md rounded-br-md rounded-tl-xl rounded-bl-xl";case 1:return"rounded-tr-xl rounded-br-md rounded-tl-md rounded-bl-md";case 2:return"rounded-tr-md rounded-br-xl rounded-tl-md rounded-bl-md";default:return""}}const ou=(t,e)=>{var s;return t.image_result?t.image_result.content_url:"".concat((s=t.image_search_query)!=null?s:t.image_ref_id,"-").concat(e)};function ru({images:t,aspectRatio:e,trackContentReferenceEvent:s,analyticsMetadata:a}){const o=e.height>e.width,r=o?4:3;return n.jsx("div",{className:F("grid grid-flow-dense grid-cols-3 grid-rows-2 gap-1",uo),style:{aspectRatio:"".concat(at.width,"/").concat(at.height)},children:t.map((i,l)=>{var m;if(l>=r)return null;const d=o&&[0,1].includes(l),u=l===Math.min(r,t.length)-1&&t.length>r;return n.jsx(ze,{image:(m=i.image_result)!=null?m:void 0,imageSource:nt.ImageGroup,className:F("border-token-border-default h-full w-full border-[0.5px]",d&&"col-span-1 row-span-2",!o&&l===0&&"col-span-2 row-span-2",au(l,o)),badge:u?n.jsx(co,{numImages:t.length}):void 0,lightboxImages:t.map(x=>x.image_result).filter(x=>!!x),aspectRatio:d?su:nu,trackContentReferenceEvent:s,eventMetadata:{imageUse:"imageGroup",layout:"bento"},analyticsMetadata:a,contentReferenceType:"image_group"},ou(i,l))})})}function iu(t){const[e,s]=t.split(":"),a=parseFloat(e),o=parseFloat(s);return a<=0||o<=0?{width:1,height:1}:{width:a,height:o}}const on=(t,e)=>t.images.length===e.images.length&&t.analyticsMetadata===e.analyticsMetadata&&t.trackContentReferenceEvent===e.trackContentReferenceEvent&&t.images.every((s,a)=>{var o,r;return((o=s.image_result)==null?void 0:o.content_url)===((r=e.images[a].image_result)==null?void 0:r.content_url)}),lu=f.memo(ru,on),cu=3,xs={width:5,height:4};function du({images:t,analyticsMetadata:e,trackContentReferenceEvent:s,isReferenceComplete:a}){var c;const o=St(),r=t.length,i=t.map(d=>d.image_result).filter(d=>!!d);if(r===0)return null;if(r===1){const d=t[0];return!d.image_result&&!a?null:n.jsxs(n.Fragment,{children:[n.jsx("span",{"aria-hidden":!0,className:"clear-both m-0 block h-0 p-0"}),n.jsx(ze,{image:(c=d==null?void 0:d.image_result)!=null?c:void 0,imageSource:nt.ImageGroup,analyticsMetadata:e,trackContentReferenceEvent:s,eventMetadata:{imageUse:"imageGroup",layout:"single"},aspectRatio:Bt,className:"float-image border-token-border-default float-end clear-end ms-7 mt-1 mb-7 w-[22%] min-w-32 overflow-hidden rounded-xl border-[0.5px]",contentReferenceType:"image_group"})]})}const l=o?t.length:Math.min(t.length,cu);return n.jsx("div",{className:F("no-scrollbar flex min-h-36 flex-nowrap gap-0.5 overflow-auto sm:gap-1 sm:overflow-hidden xl:min-h-44",uo),children:t.slice(0,l).map((d,u)=>{var x,b,w;const m=u===l-1;return n.jsx("div",{className:F("border-token-border-default relative w-32 shrink-0 overflow-hidden rounded-xl border-[0.5px] md:shrink","max-h-64 sm:w-[calc((100%-0.5rem)/3)]",u===0&&"rounded-s-xl",m&&"rounded-e-xl"),style:{aspectRatio:"".concat(xs.width,"/").concat(xs.height)},children:n.jsx(ze,{image:(x=d.image_result)!=null?x:void 0,imageSource:nt.ImageGroup,lightboxImages:i,analyticsMetadata:e,trackContentReferenceEvent:s,eventMetadata:{imageUse:"imageGroup",layout:"carousel"},className:"h-full w-full",badge:m&&t.length>l&&n.jsx(co,{numImages:t.length}),aspectRatio:xs,contentReferenceType:"image_group"})},(w=(b=d.image_result)==null?void 0:b.thumbnail_url)!=null?w:"".concat(d.image_search_query,"-").concat(d.image_ref_id,"-").concat(u))})})}const uu=f.memo(du,on);function mu({images:t,analyticsMetadata:e,trackContentReferenceEvent:s}){var d;const a=Zs(),[o,r]=Zr({track:"height"}),i=(d=o==null?void 0:o.height)!=null?d:null,l=a==null?void 0:a.onFullWidthImageHeightChange;f.useEffect(()=>{!l||i==null||l(i)},[l,i]);const c=t.map(u=>{var m;return{content:n.jsx(ze,{image:(m=u.image_result)!=null?m:void 0,imageSource:nt.ImageGroup,aspectRatio:null,enableHoverAnimation:!1,analyticsMetadata:e,trackContentReferenceEvent:s,skeletonEl:n.jsx("div",{className:"bg-token-main-surface-tertiary aspect-[3/2] h-full w-full animate-pulse"}),lightboxImages:t.map(x=>x.image_result).filter(x=>!!x),className:"h-full w-full",contentReferenceType:"image_group"})}});return n.jsx("div",{ref:r,className:"-mx-6 mt-[calc(-1rem-3px)] pb-2",children:n.jsx(Qd,{images:c,aspect:"aspect-[3/2]"})})}const fu=f.memo(mu,on),hu=200,pu=100,Ft={id:"imagePill.screenshot",defaultMessage:"screenshot",description:"Brief text to be placed in a pill as generic fallback when screenshot url is missing"},mo="m-0 p-[2px] pr-1",gu=F(mo,"h-full rounded-lg object-contain"),xu=F(mo,"p-[4px]");function Ln({image:t}){const[e,s]=f.useState(!1),a=Gs.useStore(),o=f.useRef(null),r=f.useRef(null),i=K(),l=t==null?void 0:t.content_url,c=f.useMemo(()=>l?ts(l,"hostname"):null,[l]),d=f.useCallback(()=>{o.current&&clearTimeout(o.current)},[]),u=f.useCallback(()=>{t&&(d(),s(!1),a.setCurrentImage({image:t}))},[a,t,d]),m=f.useCallback(()=>{r.current&&clearTimeout(r.current)},[]),x=f.useCallback(()=>{s(!1)},[s]),b=f.useCallback(_=>{_.stopPropagation(),m(),o.current=setTimeout(()=>{s(!0)},hu)},[m]),w=f.useCallback(_=>{_.stopPropagation(),d(),r.current=setTimeout(()=>{x()},pu)},[d,x]);f.useEffect(()=>{e&&m()},[e,m]);const h=f.useMemo(()=>({onBlur:w,onMouseLeave:w,onMouseEnter:b,onFocus:b}),[w,b]);return t?n.jsxs("span",G(B({onClick:u,className:"relative"},h),{children:[n.jsxs(Rn,{isOpen:e,children:[n.jsx("img",{className:gu,src:t.thumbnail_url}),n.jsx("span",{children:c!=null?c:i.formatMessage(Ft)})]}),e&&n.jsx("div",{className:"absolute start-0 z-50",children:n.jsxs("div",G(B({className:F("text-token-text-secondary border-token-border-light w-[256px] cursor-pointer px-3 pt-2 pb-3 text-sm shadow-md outline-[0.5px] outline-black/5",ul)},h),{children:[n.jsxs($e,{href:t.content_url,target:"_blank",rel:"noopener",className:"z-50 mb-2 flex items-center gap-2 hover:opacity-70",onClick:_=>_.stopPropagation(),children:[n.jsx(pt,{url:t.content_url,className:"m-0 size-4 p-0",size:32}),c!=null?c:i.formatMessage(Ft)]}),n.jsx("img",{className:"border-token-border-light m-0 cursor-pointer rounded-lg object-contain p-0 outline-[0.5px] outline-black/5",src:t.thumbnail_url,alt:c!=null?c:i.formatMessage(Ft),onClick:_=>{_.preventDefault(),u()}})]}))})]})):n.jsxs(Rn,{isOpen:!1,children:[n.jsx("span",{className:xu,children:n.jsx(_t,{})}),n.jsx("span",{children:c!=null?c:i.formatMessage(Ft)})]})}function Rn(a){var o=a,{children:t,isOpen:e}=o,s=ye(o,["children","isOpen"]);return n.jsx("span",G(B({className:F("ms-1 cursor-pointer","inline-flex max-w-full items-center","relative top-[0.2rem]","animate-[show_150ms_ease-in]")},s),{children:n.jsx("span",{className:F("text-token-text-secondary flex h-4.5 overflow-hidden rounded-xl bg-[#F4F4F4] pe-2 text-[0.5625em] font-medium dark:bg-[#303030]","hover:bg-token-text-primary! hover:text-token-text-inverted",e&&"bg-token-main-surface-tertiary text-token-text-secondary","transition-colors duration-150 ease-in-out","items-center justify-center"),children:t})}))}async function bu({conversationId:t,messageId:e,assetPointerLinks:s,sharedConversationLikeId:a}){return await Qs.safePost("/conversation/get_images_for_message",{requestBody:{conversation_id:t!=null?t:null,share_id:a!=null?a:null,message_id:e,asset_pointer_links:s},authOption:Ja.SendIfAvailable})}function yu({reference:t,conversationId:e,messageId:s,sharedConversationLikeId:a,isN7jupdMessage:o}){return zo(B({queryKey:["inline-images",t,e,s],queryFn:async()=>{if(!t.asset_pointer_links||t.asset_pointer_links.length===0||!e&&!a)return{images:[],formats:[]};const i=await bu({conversationId:e,messageId:s,assetPointerLinks:t.asset_pointer_links,sharedConversationLikeId:a});for(let l=0;l<i.images.length;l++){const c=i.images[l],d=i.formats[l],u="image/".concat(d),m=wu(c,u);i.images[l]=m}return i}},o?{retry:3,retryDelay:5e3}:{}))}function wu(t,e="",s=512){const a=atob(t),o=[];for(let i=0;i<a.length;i+=s){const l=a.slice(i,i+s),c=new Array(l.length);for(let u=0;u<l.length;u++)c[u]=l.charCodeAt(u);const d=new Uint8Array(c);o.push(d)}const r=new Blob(o,{type:e});return URL.createObjectURL(r)}const vu=200;function _u({reference:t,clientThreadId:e,message:s,trackContentReferenceEvent:a}){var x;const o=Ct(e),{postId:r}=f.useContext(Yr),{data:i,isLoading:l,isError:c,error:d}=yu({reference:t,conversationId:o,messageId:s.id,sharedConversationLikeId:r,isN7jupdMessage:(x=s.metadata)==null?void 0:x.n7jupd_message}),u=f.useRef([]);f.useEffect(()=>()=>{u.current.forEach(b=>{URL.revokeObjectURL(b)}),u.current=[]},[]);const m=fo(s,t);return d||c||i&&!("images"in i)||l||!(i!=null&&i.images.length)?null:(u.current=[],n.jsx(n.Fragment,{children:i==null?void 0:i.images.map((b,w)=>{const h=ho(t,b,m);return n.jsx(an,{metadata:h,analyticsMetadata:{clientThreadId:e,messageId:s.id},numImageResults:1,trackContentReferenceEvent:a},"image-carousel-inline-".concat(w))})}))}const ju=(t,e)=>{const s=new RegExp(e+"\\s*([^\\n]+)","m"),a=t.match(s);return a&&a[1]?a[1].trim().length:0};function fo(t,e){return f.useMemo(()=>{let s=-1;return t.content.content_type==="text"&&(s=ju(t.content.parts.join(""),e.matched_text)),s<vu||s===-1},[t,e.matched_text])}function ho(t,e,s){var a,o,r;return{matched_text:t.matched_text,start_idx:t.start_idx,end_idx:t.end_idx,safe_urls:t.safe_urls,alt:t.alt,prompt_text:t.prompt_text,type:"image_v2",refs:[],images:[{url:e,content_url:(a=t.clicked_from_url)!=null?a:"",thumbnail_url:e,title:(o=t.clicked_from_title)!=null?o:"",attribution:ts((r=t.clicked_from_url)!=null?r:e,"hostname"),content_size:{width:In,height:Dn},thumbnail_size:{width:In,height:Dn},is_proxied_image:!0,float_top:s}]}}const In=141,Dn=143;function ku({reference:t,clientThreadId:e,message:s,trackContentReferenceEvent:a}){var b,w,h,_,v;const o=((b=s.metadata)==null?void 0:b.n7jupd_message)&&t.matched_text.includes("screenshot"),r=Ct(e),i=(h=(w=f.useContext(Kr))==null?void 0:w.serverSharedThreadId)!=null?h:void 0,l=Jr(t.asset_pointer_links[0]),c=f.useMemo(()=>({content_type:Xa.ImageAssetPointer,size_bytes:0,width:0,height:0,asset_pointer:l}),[l]),d=Ra({asset:c,sharedThreadId:i,conversationId:r}),u=(_=d.data)==null?void 0:_.url,m=fo(s,t),x=f.useMemo(()=>u?ho(t,u,m):null,[u,t,m]);return d.error||d.isError?null:o&&!((v=d.data)!=null&&v.url)&&d.isLoading?n.jsx(Ln,{image:null},"image-pill-loading"):!o&&(d.isLoading||!d.data)||!x?null:o?n.jsx(Ln,{image:x.images[0]}):n.jsx(an,{metadata:x,analyticsMetadata:{clientThreadId:e,messageId:s.id},numImageResults:1,trackContentReferenceEvent:a})}const ge=1e-6;let ot=typeof Float32Array<"u"?Float32Array:Array;function Cu(){const t=new ot(2);return ot!=Float32Array&&(t[0]=0,t[1]=0),t}function Fn(t,e,s){return t[0]=e[0]+s[0],t[1]=e[1]+s[1],t}function Su(t,e){return t[0]=-e[0],t[1]=-e[1],t}function po(t,e,s,a){const o=e[0],r=e[1];return t[0]=o+a*(s[0]-o),t[1]=r+a*(s[1]-r),t}(function(){const t=Cu();return function(e,s,a,o,r,i){let l,c;for(s||(s=2),a||(a=0),o?c=Math.min(o*s+a,e.length):c=e.length,l=a;l<c;l+=s)t[0]=e[l],t[1]=e[l+1],r(t,t,i),e[l]=t[0],e[l+1]=t[1];return e}})();function Nu(){const t=new ot(3);return ot!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Mu(t,e,s){return t[0]=e[0]+s[0],t[1]=e[1]+s[1],t[2]=e[2]+s[2],t}function Tu(t,e,s){return t[0]=e[0]*s[0],t[1]=e[1]*s[1],t[2]=e[2]*s[2],t}function Eu(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}const $u=Tu;(function(){const t=Nu();return function(e,s,a,o,r,i){let l,c;for(s||(s=3),a||(a=0),o?c=Math.min(o*s+a,e.length):c=e.length,l=a;l<c;l+=s)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],r(t,t,i),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2];return e}})();function Pu(t,e){const s=e[0],a=e[1],o=e[2],r=e[3],i=e[4],l=e[5],c=e[6],d=e[7],u=e[8],m=e[9],x=e[10],b=e[11],w=e[12],h=e[13],_=e[14],v=e[15],C=s*l-a*i,k=s*c-o*i,y=s*d-r*i,j=a*c-o*l,S=a*d-r*l,g=o*d-r*c,N=u*h-m*w,P=u*_-x*w,L=u*v-b*w,E=m*_-x*h,R=m*v-b*h,T=x*v-b*_;let M=C*T-k*R+y*E+j*L-S*P+g*N;return M?(M=1/M,t[0]=(l*T-c*R+d*E)*M,t[1]=(o*R-a*T-r*E)*M,t[2]=(h*g-_*S+v*j)*M,t[3]=(x*S-m*g-b*j)*M,t[4]=(c*L-i*T-d*P)*M,t[5]=(s*T-o*L+r*P)*M,t[6]=(_*y-w*g-v*k)*M,t[7]=(u*g-x*y+b*k)*M,t[8]=(i*R-l*L+d*N)*M,t[9]=(a*L-s*R-r*N)*M,t[10]=(w*S-h*y+v*C)*M,t[11]=(m*y-u*S-b*C)*M,t[12]=(l*P-i*E-c*N)*M,t[13]=(s*E-a*P+o*N)*M,t[14]=(h*k-w*j-_*C)*M,t[15]=(u*j-m*k+x*C)*M,t):null}function bs(t,e,s){const a=e[0],o=e[1],r=e[2],i=e[3],l=e[4],c=e[5],d=e[6],u=e[7],m=e[8],x=e[9],b=e[10],w=e[11],h=e[12],_=e[13],v=e[14],C=e[15];let k=s[0],y=s[1],j=s[2],S=s[3];return t[0]=k*a+y*l+j*m+S*h,t[1]=k*o+y*c+j*x+S*_,t[2]=k*r+y*d+j*b+S*v,t[3]=k*i+y*u+j*w+S*C,k=s[4],y=s[5],j=s[6],S=s[7],t[4]=k*a+y*l+j*m+S*h,t[5]=k*o+y*c+j*x+S*_,t[6]=k*r+y*d+j*b+S*v,t[7]=k*i+y*u+j*w+S*C,k=s[8],y=s[9],j=s[10],S=s[11],t[8]=k*a+y*l+j*m+S*h,t[9]=k*o+y*c+j*x+S*_,t[10]=k*r+y*d+j*b+S*v,t[11]=k*i+y*u+j*w+S*C,k=s[12],y=s[13],j=s[14],S=s[15],t[12]=k*a+y*l+j*m+S*h,t[13]=k*o+y*c+j*x+S*_,t[14]=k*r+y*d+j*b+S*v,t[15]=k*i+y*u+j*w+S*C,t}function Is(t,e,s){const a=s[0],o=s[1],r=s[2];let i,l,c,d,u,m,x,b,w,h,_,v;return e===t?(t[12]=e[0]*a+e[4]*o+e[8]*r+e[12],t[13]=e[1]*a+e[5]*o+e[9]*r+e[13],t[14]=e[2]*a+e[6]*o+e[10]*r+e[14],t[15]=e[3]*a+e[7]*o+e[11]*r+e[15]):(i=e[0],l=e[1],c=e[2],d=e[3],u=e[4],m=e[5],x=e[6],b=e[7],w=e[8],h=e[9],_=e[10],v=e[11],t[0]=i,t[1]=l,t[2]=c,t[3]=d,t[4]=u,t[5]=m,t[6]=x,t[7]=b,t[8]=w,t[9]=h,t[10]=_,t[11]=v,t[12]=i*a+u*o+w*r+e[12],t[13]=l*a+m*o+h*r+e[13],t[14]=c*a+x*o+_*r+e[14],t[15]=d*a+b*o+v*r+e[15]),t}function go(t,e,s){const a=s[0],o=s[1],r=s[2];return t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t[3]=e[3]*a,t[4]=e[4]*o,t[5]=e[5]*o,t[6]=e[6]*o,t[7]=e[7]*o,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Au(t,e,s){const a=Math.sin(s),o=Math.cos(s),r=e[4],i=e[5],l=e[6],c=e[7],d=e[8],u=e[9],m=e[10],x=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=r*o+d*a,t[5]=i*o+u*a,t[6]=l*o+m*a,t[7]=c*o+x*a,t[8]=d*o-r*a,t[9]=u*o-i*a,t[10]=m*o-l*a,t[11]=x*o-c*a,t}function Lu(t,e,s){const a=Math.sin(s),o=Math.cos(s),r=e[0],i=e[1],l=e[2],c=e[3],d=e[4],u=e[5],m=e[6],x=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=r*o+d*a,t[1]=i*o+u*a,t[2]=l*o+m*a,t[3]=c*o+x*a,t[4]=d*o-r*a,t[5]=u*o-i*a,t[6]=m*o-l*a,t[7]=x*o-c*a,t}function Ru(t,e,s,a,o){const r=1/Math.tan(e/2);if(t[0]=r/s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,o!=null&&o!==1/0){const i=1/(a-o);t[10]=(o+a)*i,t[14]=2*o*a*i}else t[10]=-1,t[14]=-2*a;return t}const Iu=Ru;function On(t,e){const s=t[0],a=t[1],o=t[2],r=t[3],i=t[4],l=t[5],c=t[6],d=t[7],u=t[8],m=t[9],x=t[10],b=t[11],w=t[12],h=t[13],_=t[14],v=t[15],C=e[0],k=e[1],y=e[2],j=e[3],S=e[4],g=e[5],N=e[6],P=e[7],L=e[8],E=e[9],R=e[10],T=e[11],M=e[12],p=e[13],D=e[14],W=e[15];return Math.abs(s-C)<=ge*Math.max(1,Math.abs(s),Math.abs(C))&&Math.abs(a-k)<=ge*Math.max(1,Math.abs(a),Math.abs(k))&&Math.abs(o-y)<=ge*Math.max(1,Math.abs(o),Math.abs(y))&&Math.abs(r-j)<=ge*Math.max(1,Math.abs(r),Math.abs(j))&&Math.abs(i-S)<=ge*Math.max(1,Math.abs(i),Math.abs(S))&&Math.abs(l-g)<=ge*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(c-N)<=ge*Math.max(1,Math.abs(c),Math.abs(N))&&Math.abs(d-P)<=ge*Math.max(1,Math.abs(d),Math.abs(P))&&Math.abs(u-L)<=ge*Math.max(1,Math.abs(u),Math.abs(L))&&Math.abs(m-E)<=ge*Math.max(1,Math.abs(m),Math.abs(E))&&Math.abs(x-R)<=ge*Math.max(1,Math.abs(x),Math.abs(R))&&Math.abs(b-T)<=ge*Math.max(1,Math.abs(b),Math.abs(T))&&Math.abs(w-M)<=ge*Math.max(1,Math.abs(w),Math.abs(M))&&Math.abs(h-p)<=ge*Math.max(1,Math.abs(h),Math.abs(p))&&Math.abs(_-D)<=ge*Math.max(1,Math.abs(_),Math.abs(D))&&Math.abs(v-W)<=ge*Math.max(1,Math.abs(v),Math.abs(W))}function Du(){const t=new ot(4);return ot!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Fu(t,e,s){return t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s,t}function Ou(t,e,s){const a=e[0],o=e[1],r=e[2],i=e[3];return t[0]=s[0]*a+s[4]*o+s[8]*r+s[12]*i,t[1]=s[1]*a+s[5]*o+s[9]*r+s[13]*i,t[2]=s[2]*a+s[6]*o+s[10]*r+s[14]*i,t[3]=s[3]*a+s[7]*o+s[11]*r+s[15]*i,t}(function(){const t=Du();return function(e,s,a,o,r,i){let l,c;for(s||(s=4),a||(a=0),o?c=Math.min(o*s+a,e.length):c=e.length,l=a;l<c;l+=s)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],t[3]=e[l+3],r(t,t,i),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2],e[l+3]=t[3];return e}})();function zt(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function st(t,e){const s=Ou([],e,t);return Fu(s,s,1/s[3]),s}function Ds(t,e,s){return t<e?e:t>s?s:t}function Bu(t){return Math.log(t)*Math.LOG2E}const Wu=Math.log2||Bu;function He(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Ce=Math.PI,xo=Ce/4,Ee=Ce/180,Fs=180/Ce,yt=512,Bn=4003e4,Ot=85.051129,bo=1.5;function zu(t){return Math.pow(2,t)}function tt(t){const[e,s]=t;He(Number.isFinite(e)),He(Number.isFinite(s)&&s>=-90&&s<=90,"invalid latitude");const a=e*Ee,o=s*Ee,r=yt*(a+Ce)/(2*Ce),i=yt*(Ce+Math.log(Math.tan(xo+o*.5)))/(2*Ce);return[r,i]}function xt(t){const[e,s]=t,a=e/yt*(2*Ce)-Ce,o=2*(Math.atan(Math.exp(s/yt*(2*Ce)-Ce))-xo);return[a*Fs,o*Fs]}function Hu(t){const{latitude:e,longitude:s,highPrecision:a=!1}=t;He(Number.isFinite(e)&&Number.isFinite(s));const o=yt,r=Math.cos(e*Ee),i=o/360,l=i/r,c=o/Bn/r,d={unitsPerMeter:[c,c,c],metersPerUnit:[1/c,1/c,1/c],unitsPerDegree:[i,l,c],degreesPerUnit:[1/i,1/l,1/c]};if(a){const u=Ee*Math.tan(e*Ee)/r,m=i*u/2,x=o/Bn*u,b=x/l*c;d.unitsPerDegree2=[0,m,x],d.unitsPerMeter2=[b,0,b]}return d}function Uu(t){const{height:e,pitch:s,bearing:a,altitude:o,scale:r,center:i}=t,l=zt();Is(l,l,[0,0,-o]),Au(l,l,-s*Ee),Lu(l,l,a*Ee);const c=r/e;return go(l,l,[c,c,c]),i&&Is(l,l,Eu([],i)),l}function qu(t){const{width:e,height:s,altitude:a,pitch:o=0,offset:r,center:i,scale:l,nearZMultiplier:c=1,farZMultiplier:d=1}=t;let{fovy:u=Gt(bo)}=t;a!==void 0&&(u=Gt(a));const m=u*Ee,x=o*Ee,b=yo(u);let w=b;i&&(w+=i[2]*l/Math.cos(x)/s);const h=m*(.5+(r?r[1]:0)/s),_=Math.sin(h)*w/Math.sin(Ds(Math.PI/2-x-h,.01,Math.PI-.01)),v=Math.sin(x)*_+w,C=w*10,k=Math.min(v*d,C);return{fov:m,aspect:e/s,focalDistance:b,near:c,far:k}}function Gu(t){const{fov:e,aspect:s,near:a,far:o}=qu(t);return Iu([],e,s,a,o)}function Gt(t){return 2*Math.atan(.5/t)*Fs}function yo(t){return .5/Math.tan(.5*t*Ee)}function Vu(t,e){const[s,a,o=0]=t;return He(Number.isFinite(s)&&Number.isFinite(a)&&Number.isFinite(o)),st(e,[s,a,o,1])}function Wn(t,e,s=0){const[a,o,r]=t;if(He(Number.isFinite(a)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(r))return st(e,[a,o,r,1]);const i=st(e,[a,o,0,1]),l=st(e,[a,o,1,1]),c=i[2],d=l[2],u=c===d?0:((s||0)-c)/(d-c);return po([],i,l,u)}function Xu(t){const{width:e,height:s,bounds:a,minExtent:o=0,maxZoom:r=24,offset:i=[0,0]}=t,[[l,c],[d,u]]=a,m=Zu(t.padding),x=tt([l,Ds(u,-Ot,Ot)]),b=tt([d,Ds(c,-Ot,Ot)]),w=[Math.max(Math.abs(b[0]-x[0]),o),Math.max(Math.abs(b[1]-x[1]),o)],h=[e-m.left-m.right-Math.abs(i[0])*2,s-m.top-m.bottom-Math.abs(i[1])*2];He(h[0]>0&&h[1]>0);const _=h[0]/w[0],v=h[1]/w[1],C=(m.right-m.left)/2/_,k=(m.top-m.bottom)/2/v,y=[(b[0]+x[0])/2+C,(b[1]+x[1])/2+k],j=xt(y),S=Math.min(r,Wu(Math.abs(Math.min(_,v))));return He(Number.isFinite(S)),{longitude:j[0],latitude:j[1],zoom:S}}function Zu(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(He(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const zn=Math.PI/180;function Yu(t,e=0){const{width:s,height:a,unproject:o}=t,r={targetZ:e},i=o([0,a],r),l=o([s,a],r);let c,d;const u=t.fovy?.5*t.fovy*zn:Math.atan(.5/t.altitude),m=(90-t.pitch)*zn;return u>m-.01?(c=Hn(t,0,e),d=Hn(t,s,e)):(c=o([0,0],r),d=o([s,0],r)),[i,l,d,c]}function Hn(t,e,s){const{pixelUnprojectionMatrix:a}=t,o=st(a,[e,0,1,1]),r=st(a,[e,t.height,1,1]),l=(s*t.distanceScales.unitsPerMeter[2]-o[2])/(r[2]-o[2]),c=po([],o,r,l),d=xt(c);return d.push(s),d}class Vt{constructor(e={width:1,height:1}){this.equals=v=>v instanceof Vt?v.width===this.width&&v.height===this.height&&On(v.projectionMatrix,this.projectionMatrix)&&On(v.viewMatrix,this.viewMatrix):!1,this.project=(v,C={})=>{const{topLeft:k=!0}=C,y=this.projectPosition(v),j=Vu(y,this.pixelProjectionMatrix),[S,g]=j,N=k?g:this.height-g;return v.length===2?[S,N]:[S,N,j[2]]},this.unproject=(v,C={})=>{const{topLeft:k=!0,targetZ:y=void 0}=C,[j,S,g]=v,N=k?S:this.height-S,P=y&&y*this.distanceScales.unitsPerMeter[2],L=Wn([j,N,g],this.pixelUnprojectionMatrix,P),[E,R,T]=this.unprojectPosition(L);return Number.isFinite(g)?[E,R,T]:Number.isFinite(y)?[E,R,y]:[E,R]},this.projectPosition=v=>{const[C,k]=tt(v),y=(v[2]||0)*this.distanceScales.unitsPerMeter[2];return[C,k,y]},this.unprojectPosition=v=>{const[C,k]=xt(v),y=(v[2]||0)*this.distanceScales.metersPerUnit[2];return[C,k,y]};let{width:s,height:a,altitude:o=null,fovy:r=null}=e;const{latitude:i=0,longitude:l=0,zoom:c=0,pitch:d=0,bearing:u=0,position:m=null,nearZMultiplier:x=.02,farZMultiplier:b=1.01}=e;s=s||1,a=a||1,r===null&&o===null?(o=bo,r=Gt(o)):r===null?r=Gt(o):o===null&&(o=yo(r));const w=zu(c);o=Math.max(.75,o);const h=Hu({longitude:l,latitude:i}),_=tt([l,i]);_.push(0),m&&Mu(_,_,$u([],m,h.unitsPerMeter)),this.projectionMatrix=Gu({width:s,height:a,scale:w,center:_,pitch:d,fovy:r,nearZMultiplier:x,farZMultiplier:b}),this.viewMatrix=Uu({height:a,scale:w,center:_,pitch:d,bearing:u,altitude:o}),this.width=s,this.height=a,this.scale=w,this.latitude=i,this.longitude=l,this.zoom=c,this.pitch=d,this.bearing=u,this.altitude=o,this.fovy=r,this.center=_,this.meterOffset=m||[0,0,0],this.distanceScales=h,this._initMatrices(),Object.freeze(this)}_initMatrices(){const{width:e,height:s,projectionMatrix:a,viewMatrix:o}=this,r=zt();bs(r,r,a),bs(r,r,o),this.viewProjectionMatrix=r;const i=zt();go(i,i,[e/2,-s/2,1]),Is(i,i,[1,-1,0]),bs(i,i,r);const l=Pu(zt(),i);if(!l)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=i,this.pixelUnprojectionMatrix=l}projectFlat(e){return tt(e)}unprojectFlat(e){return xt(e)}getMapCenterByLngLatPosition({lngLat:e,pos:s}){const a=Wn(s,this.pixelUnprojectionMatrix),o=tt(e),r=Fn([],o,Su([],a)),i=Fn([],this.center,r);return xt(i)}fitBounds(e,s={}){const{width:a,height:o}=this,{longitude:r,latitude:i,zoom:l}=Xu(Object.assign({width:a,height:o,bounds:e},s));return new Vt({width:a,height:o,longitude:r,latitude:i,zoom:l})}getBounds(e){const s=this.getBoundingRegion(e),a=Math.min(...s.map(l=>l[0])),o=Math.max(...s.map(l=>l[0])),r=Math.min(...s.map(l=>l[1])),i=Math.max(...s.map(l=>l[1]));return[[a,r],[o,i]]}getBoundingRegion(e={}){return Yu(this,e.z||0)}getLocationAtPoint({lngLat:e,pos:s}){return this.getMapCenterByLngLatPosition({lngLat:e,pos:s})}}function Ku(t,e,s={}){const a={type:"Feature"};return(s.id===0||s.id)&&(a.id=s.id),s.bbox&&(a.bbox=s.bbox),a.properties=e||{},a.geometry=t,a}function wo(t,e,s={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Un(t[0])||!Un(t[1]))throw new Error("coordinates must contain numbers");return Ku({type:"Point",coordinates:t},e,s)}function Ju(t,e={}){const s={type:"FeatureCollection"};return e.id&&(s.id=e.id),e.bbox&&(s.bbox=e.bbox),s.features=t,s}function Un(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function vo(t,e,s){if(t!==null)for(var a,o,r,i,l,c,d,u=0,m=0,x,b=t.type,w=b==="FeatureCollection",h=b==="Feature",_=w?t.features.length:1,v=0;v<_;v++){d=w?t.features[v].geometry:h?t.geometry:t,x=d?d.type==="GeometryCollection":!1,l=x?d.geometries.length:1;for(var C=0;C<l;C++){var k=0,y=0;if(i=x?d.geometries[C]:d,i!==null){c=i.coordinates;var j=i.type;switch(u=0,j){case null:break;case"Point":if(e(c,m,v,k,y)===!1)return!1;m++,k++;break;case"LineString":case"MultiPoint":for(a=0;a<c.length;a++){if(e(c[a],m,v,k,y)===!1)return!1;m++,j==="MultiPoint"&&k++}j==="LineString"&&k++;break;case"Polygon":case"MultiLineString":for(a=0;a<c.length;a++){for(o=0;o<c[a].length-u;o++){if(e(c[a][o],m,v,k,y)===!1)return!1;m++}j==="MultiLineString"&&k++,j==="Polygon"&&y++}j==="Polygon"&&k++;break;case"MultiPolygon":for(a=0;a<c.length;a++){for(y=0,o=0;o<c[a].length;o++){for(r=0;r<c[a][o].length-u;r++){if(e(c[a][o][r],m,v,k,y)===!1)return!1;m++}y++}k++}break;case"GeometryCollection":for(a=0;a<i.geometries.length;a++)if(vo(i.geometries[a],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function _o(t,e={}){if(t.bbox!=null&&e.recompute!==!0)return t.bbox;const s=[1/0,1/0,-1/0,-1/0];return vo(t,a=>{s[0]>a[0]&&(s[0]=a[0]),s[1]>a[1]&&(s[1]=a[1]),s[2]<a[0]&&(s[2]=a[0]),s[3]<a[1]&&(s[3]=a[1])}),s}var Qu=_o;function em(t,e={}){const s=_o(t),a=(s[0]+s[2])/2,o=(s[1]+s[3])/2;return wo([a,o],e.properties,e)}var tm=em,ys,qn;function sm(){if(qn)return ys;qn=1;var t=ml(),e=fl(),s=hl(),a=pl(),o=t.isFinite,r=Math.min;function i(l){var c=Math[l];return function(d,u){if(d=s(d),u=u==null?0:r(e(u),292),u&&o(d)){var m=(a(d)+"e").split("e"),x=c(m[0]+"e"+(+m[1]+u));return m=(a(x)+"e").split("e"),+(m[0]+"e"+(+m[1]-u))}return c(d)}}return ys=i,ys}var ws,Gn;function nm(){if(Gn)return ws;Gn=1;var t=sm(),e=t("round");return ws=e,ws}var am=nm();const We=Ho(am),om=f.createContext(null);function rm(t,e){const s=Array.isArray(t)?t[0]:t?t.x:0,a=Array.isArray(t)?t[1]:t?t.y:0,o=Array.isArray(e)?e[0]:e?e.x:0,r=Array.isArray(e)?e[1]:e?e.y:0;return s===o&&a===r}function De(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let s=0;s<t.length;s++)if(!De(t[s],e[s]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const s=Object.keys(t),a=Object.keys(e);if(s.length!==a.length)return!1;for(const o of s)if(!e.hasOwnProperty(o)||!De(t[o],e[o]))return!1;return!0}return!1}function im(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function Vn(t,e){if(!t.getProjection)return;const s=t.getProjection(),a=e.getProjection();De(s,a)||e.setProjection(s)}function Xn(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function Zn(t,e){const s=e.viewState||e;let a=!1;if("longitude"in s&&"latitude"in s){const o=t.center;t.center=new o.constructor(s.longitude,s.latitude),a=a||o!==t.center}if("zoom"in s){const o=t.zoom;t.zoom=s.zoom,a=a||o!==t.zoom}if("bearing"in s){const o=t.bearing;t.bearing=s.bearing,a=a||o!==t.bearing}if("pitch"in s){const o=t.pitch;t.pitch=s.pitch,a=a||o!==t.pitch}return s.padding&&!t.isPaddingEqual(s.padding)&&(a=!0,t.padding=s.padding),a}const lm=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Yn(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const a of t.layers)e[a.id]=a;const s=t.layers.map(a=>{let o=null;"interactive"in a&&(o=Object.assign({},a),delete o.interactive);const r=e[a.ref];if(r){o=o||Object.assign({},a),delete o.ref;for(const i of lm)i in r&&(o[i]=r[i])}return o||a});return G(B({},t),{layers:s})}var Kn={};const Jn={version:8,sources:{},layers:[]},Qn={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},vs={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},ea={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},cm=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],dm=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class rt{constructor(e,s,a){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=o=>{const r=this.props[ea[o.type]];r?r(o):o.type==="error"&&console.error(o.error)},this._onPointerEvent=o=>{(o.type==="mousemove"||o.type==="mouseout")&&this._updateHover(o);const r=this.props[Qn[o.type]];r&&(this.props.interactiveLayerIds&&o.type!=="mouseover"&&o.type!=="mouseout"&&(o.features=this._hoveredFeatures||this._queryRenderedFeatures(o.point)),r(o),delete o.features)},this._onCameraEvent=o=>{if(!this._internalUpdate){const r=this.props[vs[o.type]];r&&r(o)}o.type in this._deferredEvents&&(this._deferredEvents[o.type]=!1)},this._MapClass=e,this.props=s,this._initialize(a)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const s=this.props;this.props=e;const a=this._updateSettings(e,s);a&&this._createShadowTransform(this._map);const o=this._updateSize(e),r=this._updateViewState(e,!0);this._updateStyle(e,s),this._updateStyleComponents(e,s),this._updateHandlers(e,s),(a||o||r&&!this._map.isMoving())&&this.redraw()}static reuse(e,s){const a=rt.savedMaps.pop();if(!a)return null;const o=a.map,r=o.getContainer();for(s.className=r.className;r.childNodes.length>0;)s.appendChild(r.childNodes[0]);o._container=s;const i=o._resizeObserver;i&&(i.disconnect(),i.observe(s)),a.setProps(G(B({},e),{styleDiffing:!1})),o.resize();const{initialViewState:l}=e;return l&&(l.bounds?o.fitBounds(l.bounds,G(B({},l.fitBoundsOptions),{duration:0})):a._updateViewState(l,!1)),o.isStyleLoaded()?o.fire("load"):o.once("styledata",()=>o.fire("load")),o._update(),a}_initialize(e){const{props:s}=this,{mapStyle:a=Jn}=s,o=G(B(B({},s),s.initialViewState),{accessToken:s.mapboxAccessToken||um()||null,container:e,style:Yn(a)}),r=o.initialViewState||o.viewState||o;if(Object.assign(o,{center:[r.longitude||0,r.latitude||0],zoom:r.zoom||0,pitch:r.pitch||0,bearing:r.bearing||0}),s.gl){const u=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=u,s.gl)}const i=new this._MapClass(o);r.padding&&i.setPadding(r.padding),s.cursor&&(i.getCanvas().style.cursor=s.cursor),this._createShadowTransform(i);const l=i._render;i._render=u=>{this._inRender=!0,l.call(i,u),this._inRender=!1};const c=i._renderTaskQueue.run;i._renderTaskQueue.run=u=>{c.call(i._renderTaskQueue,u),this._onBeforeRepaint()},i.on("render",()=>this._onAfterRepaint());const d=i.fire;i.fire=this._fireEvent.bind(this,d),i.on("resize",()=>{this._renderTransform.resize(i.transform.width,i.transform.height)}),i.on("styledata",()=>{this._updateStyleComponents(this.props,{}),Vn(i.transform,this._renderTransform)}),i.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const u in Qn)i.on(u,this._onPointerEvent);for(const u in vs)i.on(u,this._onCameraEvent);for(const u in ea)i.on(u,this._onEvent);this._map=i}recycle(){const s=this.map.getContainer().querySelector("[mapboxgl-children]");s==null||s.remove(),rt.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const s=im(e.transform);e.painter.transform=s,this._renderTransform=s}_updateSize(e){const{viewState:s}=e;if(s){const a=this._map;if(s.width!==a.transform.width||s.height!==a.transform.height)return a.resize(),!0}return!1}_updateViewState(e,s){if(this._internalUpdate)return!1;const a=this._map,o=this._renderTransform,{zoom:r,pitch:i,bearing:l}=o,c=a.isMoving();c&&(o.cameraElevationReference="sea");const d=Zn(o,B(B({},Xn(a.transform)),e));if(c&&(o.cameraElevationReference="ground"),d&&s){const u=this._deferredEvents;u.move=!0,u.zoom||(u.zoom=r!==o.zoom),u.rotate||(u.rotate=l!==o.bearing),u.pitch||(u.pitch=i!==o.pitch)}return c||Zn(a.transform,e),d}_updateSettings(e,s){const a=this._map;let o=!1;for(const r of cm)if(r in e&&!De(e[r],s[r])){o=!0;const i=a["set".concat(r[0].toUpperCase()).concat(r.slice(1))];i==null||i.call(a,e[r])}return o}_updateStyle(e,s){if(e.cursor!==s.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==s.mapStyle){const{mapStyle:a=Jn,styleDiffing:o=!0}=e,r={diff:o};return"localIdeographFontFamily"in e&&(r.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(Yn(a),r),!0}return!1}_updateStyleComponents(e,s){const a=this._map;let o=!1;return a.isStyleLoaded()&&("light"in e&&a.setLight&&!De(e.light,s.light)&&(o=!0,a.setLight(e.light)),"fog"in e&&a.setFog&&!De(e.fog,s.fog)&&(o=!0,a.setFog(e.fog)),"terrain"in e&&a.setTerrain&&!De(e.terrain,s.terrain)&&(!e.terrain||a.getSource(e.terrain.source))&&(o=!0,a.setTerrain(e.terrain))),o}_updateHandlers(e,s){var a,o;const r=this._map;let i=!1;for(const l of dm){const c=(a=e[l])!==null&&a!==void 0?a:!0,d=(o=s[l])!==null&&o!==void 0?o:!0;De(c,d)||(i=!0,c?r[l].enable(c):r[l].disable())}return i}_queryRenderedFeatures(e){const s=this._map,a=s.transform,{interactiveLayerIds:o=[]}=this.props;try{return s.transform=this._renderTransform,s.queryRenderedFeatures(e,{layers:o.filter(s.getLayer.bind(s))})}catch(r){return[]}finally{s.transform=a}}_updateHover(e){var s;const{props:a}=this;if(a.interactiveLayerIds&&(a.onMouseMove||a.onMouseEnter||a.onMouseLeave)){const r=e.type,i=((s=this._hoveredFeatures)===null||s===void 0?void 0:s.length)>0,l=this._queryRenderedFeatures(e.point),c=l.length>0;!c&&i&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=l,c&&!i&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=r}else this._hoveredFeatures=null}_fireEvent(e,s,a){const o=this._map,r=o.transform,i=typeof s=="string"?s:s.type;return i==="move"&&this._updateViewState(this.props,!1),i in vs&&(typeof s=="object"&&(s.viewState=Xn(r)),this._map.isMoving())?(o.transform=this._renderTransform,e.call(o,s,a),o.transform=r,o):(e.call(o,s,a),o)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const a in this._deferredEvents)this._deferredEvents[a]&&e.fire(a);this._internalUpdate=!1;const s=this._map.transform;e.transform=this._renderTransform,this._onAfterRepaint=()=>{Vn(this._renderTransform,s),e.transform=s}}}rt.savedMaps=[];function um(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||Kn.MapboxAccessToken}catch(e){}try{t=t||Kn.REACT_APP_MAPBOX_ACCESS_TOKEN}catch(e){}return t}const mm=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function fm(t){if(!t)return null;const e=t.map,s={getMap:()=>e,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:a=>{const o=e.transform;e.transform=t.transform;const r=e.project(a);return e.transform=o,r},unproject:a=>{const o=e.transform;e.transform=t.transform;const r=e.unproject(a);return e.transform=o,r},queryTerrainElevation:(a,o)=>{const r=e.transform;e.transform=t.transform;const i=e.queryTerrainElevation(a,o);return e.transform=r,i},queryRenderedFeatures:(a,o)=>{const r=e.transform;e.transform=t.transform;const i=e.queryRenderedFeatures(a,o);return e.transform=r,i}};for(const a of hm(e))!(a in s)&&!mm.includes(a)&&(s[a]=e[a].bind(e));return s}function hm(t){const e=new Set;let s=t;for(;s;){for(const a of Object.getOwnPropertyNames(s))a[0]!=="_"&&typeof t[a]=="function"&&a!=="fire"&&a!=="setEventedParent"&&e.add(a);s=Object.getPrototypeOf(s)}return Array.from(e)}const pm=typeof document<"u"?f.useLayoutEffect:f.useEffect,gm=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function xm(t,e){for(const a of gm)a in e&&(t[a]=e[a]);const{RTLTextPlugin:s="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=e;s&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(s,a=>{a&&console.error(a)},!0)}const as=f.createContext(null);function bm(t,e,s){const a=f.useContext(om),[o,r]=f.useState(null),i=f.useRef(),{current:l}=f.useRef({mapLib:null,map:null});f.useEffect(()=>{const u=t.mapLib;let m=!0,x;return Promise.resolve(u||s).then(b=>{if(!m)return;if(!b)throw new Error("Invalid mapLib");const w="Map"in b?b:b.default;if(!w.Map)throw new Error("Invalid mapLib");if(xm(w,t),!w.supported||w.supported(t))t.reuseMaps&&(x=rt.reuse(t,i.current)),x||(x=new rt(w.Map,t,i.current)),l.map=fm(x),l.mapLib=w,r(x),a==null||a.onMapMount(l.map,t.id);else throw new Error("Map is not supported by this browser")}).catch(b=>{const{onError:w}=t;w?w({type:"error",target:null,originalEvent:null,error:b}):console.error(b)}),()=>{m=!1,x&&(a==null||a.onMapUnmount(t.id),t.reuseMaps?x.recycle():x.destroy())}},[]),pm(()=>{o&&o.setProps(t)}),f.useImperativeHandle(e,()=>l.map,[o]);const c=f.useMemo(()=>B({position:"relative",width:"100%",height:"100%"},t.style),[t.style]),d={height:"100%"};return f.createElement("div",{id:t.id,ref:i,style:c},o&&f.createElement(as.Provider,{value:l},f.createElement("div",{"mapboxgl-children":"",style:d},t.children)))}const ym=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Ke(t,e){if(!t||!e)return;const s=t.style;for(const a in e){const o=e[a];Number.isFinite(o)&&!ym.test(a)?s[a]="".concat(o,"px"):s[a]=o}}function wm(t,e){const{map:s,mapLib:a}=f.useContext(as),o=f.useRef({props:t});o.current.props=t;const r=f.useMemo(()=>{let h=!1;f.Children.forEach(t.children,C=>{C&&(h=!0)});const _=G(B({},t),{element:h?document.createElement("div"):null}),v=new a.Marker(_);return v.setLngLat([t.longitude,t.latitude]),v.getElement().addEventListener("click",C=>{var k,y;(y=(k=o.current.props).onClick)===null||y===void 0||y.call(k,{type:"click",target:v,originalEvent:C})}),v.on("dragstart",C=>{var k,y;const j=C;j.lngLat=r.getLngLat(),(y=(k=o.current.props).onDragStart)===null||y===void 0||y.call(k,j)}),v.on("drag",C=>{var k,y;const j=C;j.lngLat=r.getLngLat(),(y=(k=o.current.props).onDrag)===null||y===void 0||y.call(k,j)}),v.on("dragend",C=>{var k,y;const j=C;j.lngLat=r.getLngLat(),(y=(k=o.current.props).onDragEnd)===null||y===void 0||y.call(k,j)}),v},[]);f.useEffect(()=>(r.addTo(s.getMap()),()=>{r.remove()}),[]);const{longitude:i,latitude:l,offset:c,style:d,draggable:u=!1,popup:m=null,rotation:x=0,rotationAlignment:b="auto",pitchAlignment:w="auto"}=t;return f.useEffect(()=>{Ke(r.getElement(),d)},[d]),f.useImperativeHandle(e,()=>r,[]),(r.getLngLat().lng!==i||r.getLngLat().lat!==l)&&r.setLngLat([i,l]),c&&!rm(r.getOffset(),c)&&r.setOffset(c),r.isDraggable()!==u&&r.setDraggable(u),r.getRotation()!==x&&r.setRotation(x),r.getRotationAlignment()!==b&&r.setRotationAlignment(b),r.getPitchAlignment()!==w&&r.setPitchAlignment(w),r.getPopup()!==m&&r.setPopup(m),Ea.createPortal(t.children,r.getElement())}const vm=f.memo(f.forwardRef(wm));function ta(t){return new Set(t?t.trim().split(/\s+/):[])}function _m(t,e){const{map:s,mapLib:a}=f.useContext(as),o=f.useMemo(()=>document.createElement("div"),[]),r=f.useRef({props:t});r.current.props=t;const i=f.useMemo(()=>{const l=B({},t),c=new a.Popup(l);return c.setLngLat([t.longitude,t.latitude]),c.once("open",d=>{var u,m;(m=(u=r.current.props).onOpen)===null||m===void 0||m.call(u,d)}),c},[]);if(f.useEffect(()=>{const l=c=>{var d,u;(u=(d=r.current.props).onClose)===null||u===void 0||u.call(d,c)};return i.on("close",l),i.setDOMContent(o).addTo(s.getMap()),()=>{i.off("close",l),i.isOpen()&&i.remove()}},[]),f.useEffect(()=>{Ke(i.getElement(),t.style)},[t.style]),f.useImperativeHandle(e,()=>i,[]),i.isOpen()&&((i.getLngLat().lng!==t.longitude||i.getLngLat().lat!==t.latitude)&&i.setLngLat([t.longitude,t.latitude]),t.offset&&!De(i.options.offset,t.offset)&&i.setOffset(t.offset),(i.options.anchor!==t.anchor||i.options.maxWidth!==t.maxWidth)&&(i.options.anchor=t.anchor,i.setMaxWidth(t.maxWidth)),i.options.className!==t.className)){const l=ta(i.options.className),c=ta(t.className);for(const d of l)c.has(d)||i.removeClassName(d);for(const d of c)l.has(d)||i.addClassName(d);i.options.className=t.className}return Ea.createPortal(t.children,o)}f.memo(f.forwardRef(_m));function Et(t,e,s,a){const o=f.useContext(as),r=f.useMemo(()=>t(o),[]);return f.useEffect(()=>{const i=e,l=null,c=typeof e=="function"?e:null,{map:d}=o;return d.hasControl(r)||(d.addControl(r,i==null?void 0:i.position),l&&l(o)),()=>{c&&c(o),d.hasControl(r)&&d.removeControl(r)}},[]),r}function jm(t){const e=Et(({mapLib:s})=>new s.AttributionControl(t),{position:t.position});return f.useEffect(()=>{Ke(e._container,t.style)},[t.style]),null}f.memo(jm);function km(t){const e=Et(({mapLib:s})=>new s.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return f.useEffect(()=>{Ke(e._controlContainer,t.style)},[t.style]),null}f.memo(km);function Cm(t,e){const s=f.useRef({props:t}),a=Et(({mapLib:o})=>{const r=new o.GeolocateControl(t),i=r._setupUI;return r._setupUI=l=>{r._container.hasChildNodes()||i(l)},r.on("geolocate",l=>{var c,d;(d=(c=s.current.props).onGeolocate)===null||d===void 0||d.call(c,l)}),r.on("error",l=>{var c,d;(d=(c=s.current.props).onError)===null||d===void 0||d.call(c,l)}),r.on("outofmaxbounds",l=>{var c,d;(d=(c=s.current.props).onOutOfMaxBounds)===null||d===void 0||d.call(c,l)}),r.on("trackuserlocationstart",l=>{var c,d;(d=(c=s.current.props).onTrackUserLocationStart)===null||d===void 0||d.call(c,l)}),r.on("trackuserlocationend",l=>{var c,d;(d=(c=s.current.props).onTrackUserLocationEnd)===null||d===void 0||d.call(c,l)}),r},{position:t.position});return s.current.props=t,f.useImperativeHandle(e,()=>a,[]),f.useEffect(()=>{Ke(a._container,t.style)},[t.style]),null}f.memo(f.forwardRef(Cm));function Sm(t){const e=Et(({mapLib:s})=>new s.NavigationControl(t),{position:t.position});return f.useEffect(()=>{Ke(e._container,t.style)},[t.style]),null}f.memo(Sm);function Nm(t){const e=Et(({mapLib:r})=>new r.ScaleControl(t),{position:t.position}),s=f.useRef(t),a=s.current;s.current=t;const{style:o}=t;return t.maxWidth!==void 0&&t.maxWidth!==a.maxWidth&&(e.options.maxWidth=t.maxWidth),t.unit!==void 0&&t.unit!==a.unit&&e.setUnit(t.unit),f.useEffect(()=>{Ke(e._container,o)},[o]),null}f.memo(Nm);const Mm=Js(()=>import("./oxsttjlzxjfu1qdb.js").then(t=>t.m),__vite__mapDeps([11,1])),Tm=f.forwardRef(function(e,s){return bm(e,s,Mm)}),Em=vm,$m="pk.eyJ1Ijoib2FpLWRhdGEiLCJhIjoiY20yYzRzZmFtMGNqNjJscHo2dThqdnkwNCJ9.rTosfWNn9lUu4slvYfMzHg",Pm=t=>f.createElement("svg",B({width:20,height:20,viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},t),f.createElement("path",{d:"M10.001 1.83594C13.9484 1.83594 17.1659 4.90441 17.166 8.9873C17.166 11.8368 15.3695 14.1317 13.7002 15.6592C12.8541 16.4334 12.0106 17.0381 11.3799 17.4492C11.0639 17.6552 10.7992 17.8141 10.6123 17.9219C10.5189 17.9757 10.4443 18.0166 10.3926 18.0449C10.3667 18.059 10.3463 18.0705 10.332 18.0781C10.3251 18.0818 10.3195 18.0848 10.3154 18.0869C10.3134 18.088 10.3118 18.0892 10.3105 18.0898L10.3086 18.0908L10.001 17.501L10.3076 18.0908C10.1144 18.1913 9.88417 18.1912 9.69141 18.0898L10.001 17.501L9.69043 18.0889L9.68848 18.0879C9.68724 18.0872 9.68554 18.086 9.68359 18.085C9.67954 18.0828 9.67396 18.0799 9.66699 18.0762C9.65272 18.0685 9.63232 18.0573 9.60645 18.043C9.55471 18.0144 9.48007 17.9733 9.38672 17.9189C9.19995 17.8102 8.93589 17.6498 8.62012 17.4424C7.98975 17.0283 7.14642 16.4199 6.30078 15.6436C4.63333 14.1126 2.83594 11.8176 2.83594 8.9873C2.83602 4.90441 6.05356 1.83594 10.001 1.83594Z",fill:"rgb(85, 84, 84)",stroke:"rgb(85, 84, 84)",strokeWidth:1,strokeLinejoin:"round",paintOrder:"stroke fill"}),f.createElement("circle",{cx:10,cy:9,r:3,fill:"white"})),Am=t=>f.createElement("svg",B({width:20,height:20,viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},t),f.createElement("path",{d:"M10.001 1.83594C13.9484 1.83594 17.1659 4.90441 17.166 8.9873C17.166 11.8368 15.3695 14.1317 13.7002 15.6592C12.8541 16.4334 12.0106 17.0381 11.3799 17.4492C11.0639 17.6552 10.7992 17.8141 10.6123 17.9219C10.5189 17.9757 10.4443 18.0166 10.3926 18.0449C10.3667 18.059 10.3463 18.0705 10.332 18.0781C10.3251 18.0818 10.3195 18.0848 10.3154 18.0869C10.3134 18.088 10.3118 18.0892 10.3105 18.0898L10.3086 18.0908L10.001 17.501L10.3076 18.0908C10.1144 18.1913 9.88417 18.1912 9.69141 18.0898L10.001 17.501L9.69043 18.0889L9.68848 18.0879C9.68724 18.0872 9.68554 18.086 9.68359 18.085C9.67954 18.0828 9.67396 18.0799 9.66699 18.0762C9.65272 18.0685 9.63232 18.0573 9.60645 18.043C9.55471 18.0144 9.48007 17.9733 9.38672 17.9189C9.19995 17.8102 8.93589 17.6498 8.62012 17.4424C7.98975 17.0283 7.14642 16.4199 6.30078 15.6436C4.63333 14.1126 2.83594 11.8176 2.83594 8.9873C2.83602 4.90441 6.05356 1.83594 10.001 1.83594Z",fill:"white",stroke:"rgb(85, 84, 84)",strokeWidth:1,strokeLinejoin:"round",paintOrder:"stroke fill"}),f.createElement("circle",{cx:10,cy:9,r:3,fill:"rgb(85, 84, 84)"})),sa=50,na=20,aa=20,oa=20,Lm=400;function Rm(t){"use forget";const e=ve.c(37),{contentReference:s,clientThreadId:a,messageId:o,trackContentReferenceEvent:r}=t,i=s.entities,l=f.useRef(!0),c=f.useRef(null),d=f.useRef(null);let u;e[0]===Symbol.for("react.memo_cache_sentinel")?(u={longitude:0,latitude:0,zoom:12,pitch:0,bearing:0},e[0]=u):u=e[0];const[m,x]=f.useState(u),[b,w]=f.useState(-1),h=f.useRef(b);let _;e[1]===Symbol.for("react.memo_cache_sentinel")?(_=O=>{h.current=O,w(O)},e[1]=_):_=e[1];const v=_,C=!jt(),k=f.useRef(!1);let y,j;e[2]!==r?(y=()=>{k.current||(r("Search Content Reference Shown","search_content_reference_shown","map"),k.current=!0)},j=[r],e[2]=r,e[3]=y,e[4]=j):(y=e[3],j=e[4]),f.useEffect(y,j);let S,g;e[5]===Symbol.for("react.memo_cache_sentinel")?(S=()=>{if(!c.current)return;const O=bl(()=>{var q;(q=d.current)==null||q.resize()},100),A=new ResizeObserver(O);return A.observe(c.current),()=>{A.disconnect()}},g=[],e[5]=S,e[6]=g):(S=e[5],g=e[6]),f.useEffect(S,g);let N,P;e[7]!==i||e[8]!==b?(N=()=>{const O=function(){var V;const q=function(X,ae){const J=d.current;if(!J)return!1;const{width:Y,height:te}=J.getContainer().getBoundingClientRect(),Q=J.unproject([na,sa]),ue=J.unproject([Y-aa,te-oa]);return We(X,5)>=We(ue.lat,5)&&We(X,5)<=We(Q.lat,5)&&We(ae,5)>=We(Q.lng,5)&&We(ae,5)<=We(ue.lng,5)},U=Ju(i.filter((Z,X)=>l.current||b===-1||X===b).map(Dm)),H=Qu(U),re=tm(U);if(c.current){const Z=c.current.clientWidth,X=c.current.clientHeight,ae=new Vt({width:Z,height:X,longitude:re.geometry.coordinates[0],latitude:re.geometry.coordinates[1]}),{zoom:J,latitude:Y,longitude:te}=ae.fitBounds([[H[0],H[1]],[H[2],H[3]]],{maxZoom:13.5,padding:{top:sa,left:na,right:aa,bottom:oa}});l.current?(x(Q=>G(B({},Q),{zoom:J,latitude:Y,longitude:te})),l.current=!1):q(Y,te)||(V=d.current)==null||V.flyTo({center:[te,Y]})}};i.length!==0&&(l.current?O():setTimeout(O,200))},P=[i,b],e[7]=i,e[8]=b,e[9]=N,e[10]=P):(N=e[9],P=e[10]),f.useEffect(N,P);const{openThreadSidebar:L}=Mt(),{resetSidebarHistory:E}=Ba(),R=Zs();let T;e[11]!==a||e[12]!==s.start_idx||e[13]!==R||e[14]!==o||e[15]!==L||e[16]!==E?(T=(O,A)=>{v(O),a&&(R||E(),L({type:"entity",clientThreadId:a,debugThreadId:void 0,messageId:o,contentReferenceStartIndex:s.start_idx,query:A.name,category:"local_business",extraParams:A.entity.location?{location:A.entity.location}:void 0}))},e[11]=a,e[12]=s.start_idx,e[13]=R,e[14]=o,e[15]=L,e[16]=E,e[17]=T):T=e[17];const M=T,p=Tt();let D;if(e[18]!==i||e[19]!==p||e[20]!==M||e[21]!==b||e[22]!==r){let O;e[24]!==b?(O=(q,U)=>q.idx===b?1:U.idx===b?-1:q.idx-U.idx,e[24]=b,e[25]=O):O=e[25];let A;e[26]!==p||e[27]!==M||e[28]!==b||e[29]!==r?(A=q=>{const{business:U,idx:H}=q,V=H==b?Pm:Am;return n.jsx(Em,{longitude:U.longitude,latitude:U.latitude,anchor:"bottom",children:n.jsx(Ue,{label:n.jsx(Fm,{business:U.entity,idx:H,trackContentReferenceEvent:r,onOpenEntity:()=>M(H,U)}),onOpenChange:Z=>v(Z?H:-1),delayDuration:150,theme:p?"default":"white",customPaddingClassName:"bg-clip-padding",cornerRadius:"2xl",customBorderClassName:"border-token-border-default border",contentClassName:"animate-show",side:"top",sideOffset:10,wide:!0,interactive:!0,children:n.jsxs("div",{className:"relative",children:[n.jsx(V,{className:"h-auto w-7"}),n.jsx("div",{className:"absolute start-1/2 top-full -translate-x-1/2 font-bold text-nowrap text-gray-700 [text-shadow:_-0.8px_-0.8px_0_#fff,_0.8px_-0.8px_0_#fff,_-0.8px_0.8px_0_#fff,_0.8px_0.8px_0_#fff]",children:U.name}),n.jsx("div",{className:"absolute inset-0 cursor-pointer rounded-xl",onClick:Z=>{Z.preventDefault(),v(H),M(H,U)}})]})},H)},H)},e[26]=p,e[27]=M,e[28]=b,e[29]=r,e[30]=A):A=e[30],D=i.map(Im).sort(O).map(A),e[18]=i,e[19]=p,e[20]=M,e[21]=b,e[22]=r,e[23]=D}else D=e[23];const W=D;let $;e[31]!==C||e[32]!==W||e[33]!==m?($=!C&&n.jsx("div",{className:"bg-token-bg-primary pt-2",children:n.jsxs("div",{style:{height:Lm},className:"bg-token-bg-primary relative w-full",ref:c,children:[n.jsx("div",{className:"relative h-full w-full overflow-hidden rounded-xl",children:n.jsx(Tm,G(B({},m),{mapboxAccessToken:$m,mapStyle:"mapbox://styles/mapbox/streets-v12",attributionControl:!1,renderWorldCopies:!1,onMove:O=>x(O.viewState),ref:d,keyboard:!1,children:W}))}),n.jsx("div",{className:"absolute start-3 top-3",children:n.jsx(Wm,{})})]})}),e[31]=C,e[32]=W,e[33]=m,e[34]=$):$=e[34];let I;return e[35]!==$?(I=n.jsx(yl,{children:n.jsx("div",{className:"not-prose","data-testid":"businesses-map-widget",children:$})}),e[35]=$,e[36]=I):I=e[36],I}function Im(t,e){return{business:t,idx:e}}function Dm(t){return wo([t.longitude,t.latitude])}function Fm({business:t,idx:e,trackContentReferenceEvent:s,onOpenEntity:a}){var d;const o=!jt(),r={section:"map",section_location:"response",section_index:e},i="https://www.google.com/maps/dir/?api=1&destination=".concat(encodeURIComponent([t.name,t.address].join(",")));t.address&&s("link_action",null,"map",G(B({},r),{url:i,link_type:"button",action:"show"})),t.website_url&&s("link_action",null,"map",G(B({},r),{url:t.website_url,link_type:"button",action:"show"}));function l(){return n.jsx(n.Fragment,{children:n.jsxs("div",{className:"text-token-text-primary mt-auto flex min-h-9 w-full min-w-0 flex-wrap justify-center gap-2 text-base",children:[t.address&&n.jsx(Se,{onClick:()=>{s("link_action",null,"map",G(B({},r),{url:i,link_type:"button",action:"click"}))},as:"link",to:i,openNewTab:!0,rel:"noreferrer",color:"secondary",size:"small",className:"min-w-25 flex-1 rounded-full border",contentWrapperClassName:"text-token-text-primary font-semibold",children:n.jsx(z,{id:"+a2f/C",defaultMessage:"Directions"})}),t.website_url&&n.jsx(Se,{onClick:()=>{s("link_action",null,"map",G(B({},r),{url:t.website_url,link_type:"button",action:"click"}))},as:"link",to:t.website_url,openNewTab:!0,rel:"noreferrer",color:"secondary",size:"small",className:"min-w-25 flex-1 rounded-full border",contentWrapperClassName:"text-token-text-primary font-semibold",children:n.jsx(z,{id:"r0oqXM",defaultMessage:"Website"})}),t.phone&&n.jsx(Se,{as:"link",to:"tel:"+t.phone,openNewTab:!0,rel:"noreferrer",color:"secondary",size:"small",className:"min-w-25 flex-1 rounded-full border",contentWrapperClassName:"text-token-text-primary font-semibold",children:n.jsx(z,{id:"B/an6M",defaultMessage:"Call"})})]})})}const c=(d=t.image_urls)==null?void 0:d[0];return n.jsx(Ut.div,{initial:{x:"0%",opacity:0,pointerEvents:"none",transition:{duration:.1,ease:"easeOut"}},animate:{x:"0%",opacity:1,pointerEvents:"auto",transition:{duration:.15,ease:"easeOut"}},children:n.jsxs("div",{className:F("bg-token-main-surface-primary relative rounded-xl text-start font-normal"),children:[n.jsxs("div",{className:"flex flex-col gap-2 p-3",children:[n.jsxs("div",{className:"flex gap-3",children:[n.jsx("div",{className:"h-23 w-23 shrink-0 cursor-pointer overflow-hidden rounded-lg",onClick:u=>{u.preventDefault(),a==null||a()},children:c?n.jsx("img",{className:"h-full w-full object-cover",src:c!=null?c:void 0,alt:t.name}):n.jsx("div",{className:"h-full w-full bg-gray-100"})}),n.jsxs("div",{className:"flex min-w-0 flex-1 flex-col",children:[n.jsx("div",{className:"hover:entity-accent line-clamp-2 inline w-full cursor-pointer align-baseline text-base font-medium",onClick:u=>{u.preventDefault(),a==null||a()},children:t.name}),n.jsx("div",{className:"text-token-text-secondary text-sm",children:n.jsx(Om,{business:t})})]})]}),!o&&n.jsx("div",{className:"mt-1",children:l()})]}),o&&l()]})})}function Om({business:t}){var c,d;const e=K(),s=(d=(c=t.categories)==null?void 0:c[0])!=null?d:null,a=t.next_open_hour;let o=null,r;t.is_open!=null&&(o=t.is_open?e.formatMessage({id:"rNSVso",defaultMessage:"Open now"}):e.formatMessage({id:"3WBPtG",defaultMessage:"Closed"}),a&&(r=a.day===new Date().getDay()?e.formatMessage({id:"3IYYo+",defaultMessage:"until {time}"},{time:ra(e,t.is_open?a.end:a.start)}):e.formatMessage({id:"R23xLn",defaultMessage:"until {day} {time}"},{day:Bm(e,a.day),time:ra(e,t.is_open?a.end:a.start)})));const i=t.rating,l=t.price!=null?"$".repeat(t.price):t.price_str!=null?t.price_str:null;return n.jsxs("div",{className:"flex flex-col gap-0.5",children:[s&&n.jsx("div",{className:"truncate",children:s}),o&&n.jsxs("div",{children:[n.jsx("span",{className:t.is_open?"text-green-600":"text-token-text-secondary",children:o}),r&&n.jsx("span",{className:"ms-1",children:r})]}),n.jsxs("div",{className:"flex items-center gap-1",children:[i!=null&&n.jsxs(n.Fragment,{children:[n.jsx(Wa,{className:"icon-sm text-token-text-secondary"}),n.jsx("span",{className:"text-token-text-primary",children:i.toFixed(1)})]}),l&&n.jsx("span",{className:"text-token-text-secondary font-black",children:n.jsx(z,{id:"IqwxqE",defaultMessage:"·"})}),l&&n.jsx("span",{className:"text-token-text-secondary",children:l})]})]})}function ra(t,e){const s=e.slice(0,2),a=e.slice(2,4),o=new Date(0,0,0,parseInt(s,10),parseInt(a,10));return t.formatTime(o,{hour:"numeric",minute:"2-digit"})}function Bm(t,e){return t.formatDate(new Date(0,0,e),{weekday:"short"})}function Wm(){const[t,e]=f.useState(!1),s=()=>e(o=>!o),a=t?gl:xl;return n.jsxs("div",{className:F("text-token-text-tertiary flex h-5 items-center justify-start overflow-hidden rounded-full text-[10px] font-light whitespace-nowrap transition-all",t?"w-full bg-white":"w-5 bg-white/50"),children:[n.jsx("button",{onClick:s,className:F("transition-all",t?"ms-1":"ms-[2px] mt-[1px]"),children:n.jsx(a,{className:"icon-sm hover:text-token-text-secondary transition-colors"})}),n.jsxs("div",{className:"ps-1 pe-2",children:["© ",n.jsx("a",{href:"https://www.mapbox.com/about/maps",target:"_blank",rel:"noreferrer",className:"text-[#2964aa]!",children:"Mapbox"})," ",n.jsx("a",{href:"https://www.mapbox.com/legal/end-user-terms",target:"_blank",rel:"noreferrer",className:"me-2 text-[#2964aa]!",children:n.jsx(z,{id:"u3dZJq",defaultMessage:"Terms"})}),"© ",n.jsx("a",{href:"http://www.openstreetmap.org/about",target:"_blank",rel:"noreferrer",className:"text-[#2964aa]!",children:"OpenStreetMap"})]})]})}const Ie={TTFP:"products.ttfp",TTLT:"products.ttlt",TTF_VISIBLE_CONTENT_TOKEN:"products.ttf_visible_content_token"},rn={[Ie.TTFP]:new Set,[Ie.TTLT]:new Set,[Ie.TTF_VISIBLE_CONTENT_TOKEN]:new Set};function _s({profiler:t,messageId:e,metric:s,overrideDurationMs:a}){rn[s].add(e);const o=si();t.logTimingOnce(s,{context:{eval_preset:o.eval_preset},overrideDurationMs:a})}function js({messageId:t,metric:e}){return rn[e].has(t)}function jo(t){"use forget";const e=ve.c(27),{clientThreadId:s,messageId:a,products:o}=t;let r;e[0]!==a?(r=y=>[Ye.getRequestId(y),Ye.isMessageTurnEnded(y,a)],e[0]=a,e[1]=r):r=e[1];const[i,l]=lt(s,r);let c;e[2]!==s?(c={namespace:ei.ProductsCompletionRequest,clientThreadId:s},e[2]=s,e[3]=c):c=e[3];const{profiler:d,isRequestActive:u}=Qr(c),m=u&&!l,x=wc(m);let b,w;e[4]!==m||e[5]!==a||e[6]!==o.length||e[7]!==d?(b=()=>{js({messageId:a,metric:Ie.TTFP})||d&&m&&o.length>0&&_s({profiler:d,messageId:a,metric:Ie.TTFP})},w=[m,a,o.length,d],e[4]=m,e[5]=a,e[6]=o.length,e[7]=d,e[8]=b,e[9]=w):(b=e[8],w=e[9]),f.useEffect(b,w);let h,_;e[10]!==m||e[11]!==a||e[12]!==x||e[13]!==d?(h=()=>{js({messageId:a,metric:Ie.TTLT})||d&&x.current&&!m&&_s({profiler:d,messageId:a,metric:Ie.TTLT})},_=[a,x,m,d],e[10]=m,e[11]=a,e[12]=x,e[13]=d,e[14]=h,e[15]=_):(h=e[14],_=e[15]),f.useEffect(h,_);const v=de();let C;e[16]!==v||e[17]!==a||e[18]!==d||e[19]!==i?(C=()=>{if(js({messageId:a,metric:Ie.TTF_VISIBLE_CONTENT_TOKEN}))return;const y=i?ti(v,i):null;if(d&&y){const j=Ie.TTF_VISIBLE_CONTENT_TOKEN;rn[j].add(a),_s({profiler:d,messageId:a,metric:j,overrideDurationMs:y.turnTracker.first_visible_content_token_lat})}},e[16]=v,e[17]=a,e[18]=d,e[19]=i,e[20]=C):C=e[20];let k;e[21]!==v||e[22]!==a||e[23]!==o.length||e[24]!==d||e[25]!==i?(k=[a,d,i,o.length,v],e[21]=v,e[22]=a,e[23]=o.length,e[24]=d,e[25]=i,e[26]=k):k=e[26],f.useEffect(C,k)}function zm({contentReference:t,clientThreadId:e,messageId:s,turnIndex:a,trackContentReferenceEvent:o}){const r=f.useCallback(()=>o("Search Content Reference Shown","search_content_reference_shown","product_entity",{content_reference_start_index:t.start_idx,product_id:t.product.id}),[o,t.start_idx,t.product.id]),i=f.useCallback(()=>o("Search Content Reference Clicked","search_content_reference_clicked","product_entity",{content_reference_start_index:t.start_idx,product_id:t.product.id}),[o,t.start_idx,t.product.id]),l=t.product;f.useEffect(()=>r(),[r]),jo({clientThreadId:e,messageId:s,products:[l]});const{openThreadSidebar:c}=Mt();return n.jsx("span",{className:"entity-underline hover:entity-accent inline cursor-pointer align-baseline",onClick:()=>{if(i(),l.offers||!l.url){if(!e)return;c({type:"product",clientThreadId:e,messageId:s,turnIndex:a,contentReferenceStartIndex:t.start_idx,productIndex:0,productUrl:l.url,interactionSource:"inline_link"})}else window.open(l.url,"_blank")},children:n.jsx("span",{className:"whitespace-normal",children:l.title})})}function ko({items:t,targetItemCount:e,onCardRender:s,onCardShown:a,onCardClicked:o,onReplyClicked:r,allowFullWidth:i=!1,cardClassName:l,showGradient:c=!0,arrowClassName:d}){const u=f.useRef(null),[m,x]=f.useState(null),b=f.useRef(null),w=()=>{b.current=setTimeout(()=>{x(null),b.current=null},200)},h=()=>{b.current&&(clearTimeout(b.current),b.current=null)},_=f.useRef(null),[v,C]=f.useState({left:0,top:0}),k=8;f.useEffect(()=>{const N=u.current,P=_.current;if(!r||!m||!N||!P)return;const L=()=>{const E=m.card.getBoundingClientRect(),R=N.getBoundingClientRect(),T=P.getBoundingClientRect(),M=E.bottom-R.top+k;var p=E.left-R.left;p=Math.max(0,p),p=Math.min(p,R.width-T.width),C({left:p,top:M})};return L(),N.addEventListener("scroll",L),()=>N.removeEventListener("scroll",L)},[m,t,r]);const y=St(),j=y?2:4;if(e===void 0)e=t.length;else if(!e&&t.length<j)return null;const S=(e!=null?e:t.length)>=j,g=S&&y;return n.jsxs("div",{className:"relative",children:[n.jsx("div",{ref:u,className:F("flex flex-row gap-4 py-2",g&&"mx-[-1rem] px-[1rem]",S&&"no-scrollbar snap-x snap-proximity scroll-ps-4 overflow-x-scroll scroll-smooth"),children:t.map((N,P)=>n.jsx("div",{className:F(S||!i?"thread-lg:w-61 w-50 shrink-0 snap-start":"min-w-0 flex-1"),children:n.jsx(Hm,{cardClassName:l,onShown:()=>a(N,P),onClick:()=>o(N,P),onHover:L=>{h(),L?x({card:L,item:N,index:P}):w()},children:s(N,!y&&e===1)})},P))}),S&&!g&&n.jsx(Um,{scrollableRef:u,units:t.length,showGradient:c,arrowClassName:d}),r&&n.jsx("div",{ref:_,className:F("absolute z-10",m?"pointer-events-auto opacity-100":"pointer-events-none opacity-0","transition-[transform,opacity] duration-200"),style:{willChange:"opacity, transform",left:v.left,top:v.top,transform:m?"translateY(0)":"translateY(".concat(-k,"px)")},onMouseEnter:h,onMouseLeave:w,children:n.jsx(Se,{className:F(m?"pointer-events-auto":"pointer-events-none","border-light bg-clip-padding px-4 py-2 shadow-md"),size:"small",color:"secondary",onClick:()=>m&&r(m.item,m.index),children:n.jsxs("div",{className:"flex flex-row items-center gap-1",children:[n.jsx(vc,{className:"icon-sm text-token-text-secondary"}),n.jsx(z,{id:"9TG7OR",defaultMessage:"Ask about this"})]})})})]})}function Hm({onShown:t,onClick:e,onHover:s,children:a,cardClassName:o}){const r=f.useRef(null),i=f.useRef(t);return f.useEffect(()=>{i.current=t},[t]),f.useEffect(()=>{if(!r.current)return;const l=new IntersectionObserver(([c])=>c.isIntersecting&&i.current(),{threshold:.5});return l.observe(r.current),()=>l.disconnect()},[]),n.jsx("div",{ref:r,className:F("h-full w-full","bg-token-bg-primary cursor-pointer",o),onClick:e,onMouseEnter:()=>r.current&&s(r.current),onMouseLeave:()=>s(null),children:a})}function Um({scrollableRef:t,units:e,showGradient:s,arrowClassName:a}){const[o,r]=f.useState({left:!1,right:!1}),[i,l]=f.useState(!1);f.useEffect(()=>{const d=t.current;if(!d)return;const u=()=>{const{scrollLeft:m,scrollWidth:x,clientWidth:b}=d,w=m/(x-b);r({left:w>0,right:w<1}),!i&&m>0&&l(!0)};return u(),d.addEventListener("scroll",u),()=>d.removeEventListener("scroll",u)},[t,e,i]);const c=d=>{if(!t.current)return;l(!0);const{clientWidth:u,scrollWidth:m}=t.current,x=m/e,b=Math.floor(u/x)*x;t.current.scrollBy({left:b*d,behavior:"smooth"})};return n.jsxs("div",{className:"pointer-events-none absolute start-0 top-0 flex h-full w-full flex-row",children:[n.jsx("div",{className:F("flex h-full w-9 items-center justify-start",i&&s&&"bg-linear-to-r from-(--bg-primary) to-transparent",o.left?"opacity-100":"opacity-0","transition-opacity duration-100"),children:n.jsx(Se,{color:"secondary",size:"small",className:F("border-token-border-default active:bg-token-bg-tertiary hover:bg-token-bg-primary h-8 w-8 translate-x-[-50%] rounded-full bg-clip-padding hover:shadow-[0px_4px_16px_0px_rgba(0,0,0,0.05)] active:opacity-100!",a),onClick:()=>c(-1),children:n.jsx(Oa,{className:"icon"})})}),n.jsx("div",{className:F("ms-auto flex h-full w-9 items-center justify-end",i&&s&&"bg-linear-to-l from-(--bg-primary) to-transparent",o.right?"opacity-100":"opacity-0","transition-opacity duration-200"),children:n.jsx(Se,{color:"secondary",size:"small",className:F("border-token-border-default active:bg-token-bg-tertiary hover:bg-token-bg-primary h-8 w-8 translate-x-[50%] rounded-full bg-clip-padding hover:shadow-[0px_4px_16px_0px_rgba(0,0,0,0.05)] active:opacity-100!",a),onClick:()=>c(1),children:n.jsx(Xs,{className:"icon"})})})]})}function qm({contentReference:t,clientThreadId:e,messageId:s,turnIndex:a,analyticsMetadata:o}){const r=t.products,i=t.target_product_count;jo({clientThreadId:e,messageId:s,products:r});const{showDebugConversationTurns:l}=wl(),c=lt(e,j=>{var N,P;const g=(P=(N=Ye.getNode(j,s).message.metadata)==null?void 0:N.content_references)==null?void 0:P.find(L=>L.type==="products");return t.start_idx===(g==null?void 0:g.start_idx)}),d=de(),u=ce(d,"3144771298"),m=Nt(d),x=ss(d),b=ce(d,"2212894775"),w=za(o),h=f.useCallback((j,S)=>w("Search Content Reference Shown","search_content_reference_shown","products",{content_reference_start_index:t.start_idx,product_index:S,product_id:j.id,product_url:j.url}),[w,t.start_idx]),_=f.useCallback((j,S)=>w("Search Content Reference Clicked","search_content_reference_clicked","products",{content_reference_start_index:t.start_idx,product_index:S,product_id:j.id}),[w,t.start_idx]),{openThreadSidebar:v}=Mt(),C=(j,S)=>{e&&(_(j,S),j.offers?v({type:"product",clientThreadId:e,messageId:s,turnIndex:a,contentReferenceStartIndex:t.start_idx,productIndex:S,productUrl:j.url,interactionSource:"carousel"}):window.open(j.url,"_blank"))},{setTargetedContent:k}=ni(),y=(j,S)=>{Fe.logEventWithStatsig("Product Targeted Reply Clicked","product_targeted_reply_clicked",G(B({},kt(o)),{content_reference_start_index:t.start_idx,product_index:(S+1).toString(),product_id:j.id})),k({type:"object",label:j.title,createNewCompletionParams:g=>{var P;const N=vl(j.title);return G(B({},g),{promptMessage:ai(g.promptMessage,{metadata:{targeted_reply:j.title,targeted_reply_label:j.title,targeted_reply_icon:"product_tag"}}),appendMessages:[...(P=g.appendMessages)!=null?P:[],N]})},onCreateCompletion:({serverThreadId:g,currentLeafId:N})=>{Fe.logEventWithStatsig("Targeted Reply Submitted","chatgpt_targeted_reply_submitted",{conversation_id:g,current_leaf_id:N,source_message_id:s,content_reference_start_index:t.start_idx,product_index:(S+1).toString(),product_id:j.id})},onCleared:({serverThreadId:g,currentLeafId:N})=>{Fe.logEventWithStatsig("Targeted Reply Cleared","chatgpt_targeted_reply_cleared",{conversation_id:g,current_leaf_id:N,source_message_id:s,content_reference_start_index:t.start_idx,product_index:(S+1).toString(),product_id:j.id})}})};if(t.inline_carousel&&r.length===1){const j=r[0];return n.jsx("div",{className:"flex flex-col","data-testid":"shopping-widget",children:n.jsx(Zm,{product:j,showDebug:l,onShown:()=>h(j,0),onClicked:()=>C(j,0)})})}return n.jsxs("div",{className:"flex flex-col","data-testid":"products-widget",children:[m?n.jsx("div",{className:F("relative mb-6",x?"-mx-[var(--thread-content-margin)]":"-mx-6"),children:n.jsx(Vs,{items:r,getItemKey:j=>j.id,onRenderItem:j=>n.jsx(ia,{product:j,wide:!1,showDebug:l,isProductV2CardEnabled:b}),className:"min-h-36",itemClassName:"max-w-[200px] min-w-[120px] sm:max-w-[calc((var(--thread-content-max-width)-2rem)/3)] thread-lg:w-61 w-50 shrink-0 border-none",arrowClassName:b?"translate-y-[-85%]!":"",onShown:h,onClick:C})}):n.jsx(ko,{items:r,targetItemCount:i,onCardRender:(j,S)=>n.jsx(ia,{product:j,wide:S,showDebug:l,isProductV2CardEnabled:b}),onCardShown:h,onCardClicked:C,onReplyClicked:b?void 0:y,arrowClassName:b?"translate-y-[-85%]":"",allowFullWidth:!0,showGradient:!b,cardClassName:F(b?"group":"transition-all duration-200 border-token-border-default hover:border-light border rounded-xl bg-clip-padding hover:shadow-md overflow-hidden")}),c&&u&&!b&&n.jsxs("div",{className:"text-token-text-tertiary flex text-xs hover:cursor-pointer hover:underline",onClick:()=>window.open("https://help.openai.com/en/articles/11128490","_blank"),children:[n.jsx(z,{id:"4Y5Zn5",defaultMessage:"ChatGPT chooses products independently. Learn more"}),n.jsx(Xs,{className:"icon -ms-0.5"})]})]})}function ia(t){"use forget";const e=ve.c(5),{product:s,wide:a,showDebug:o,isProductV2CardEnabled:r}=t,i=o===void 0?!1:o;let l;return e[0]!==r||e[1]!==s||e[2]!==i||e[3]!==a?(l=r?n.jsx(Vm,{product:s,wide:a,showDebug:i}):n.jsx(Gm,{product:s,wide:a,showDebug:i}),e[0]=r,e[1]=s,e[2]=i,e[3]=a,e[4]=l):l=e[4],l}function Gm({product:t,wide:e,showDebug:s=!1}){var l,c;const a=t.image_urls?t.image_urls[0]:void 0,[o,r]=f.useState("contain"),i=f.useRef(null);return n.jsxs("div",{className:F("flex",e?"flex-row":"flex-col"),children:[n.jsxs("div",{className:F("relative aspect-square",e?"w-1/3":"w-full","bg-token-main-surface-secondary dark:bg-token-main-surface-primary-inverse"),children:[a?n.jsx("img",{ref:i,className:"absolute inset-0 m-0 h-full w-full mix-blend-darken object-".concat(o),src:a,alt:t.title,onLoad:()=>{if(!i.current)return;const{naturalWidth:d,naturalHeight:u}=i.current,m=d/u;r(Math.abs(m-1)<.25?"cover":"contain")}}):n.jsx("div",{className:"flex aspect-square items-center justify-center",children:n.jsx(es,{className:"text-token-text-tertiary h-12 w-12"})}),t.featured_tag&&n.jsx("div",{className:"absolute start-3 end-3 bottom-3",children:n.jsxs("div",{className:"relative max-w-fit px-2 py-1",children:[n.jsx("div",{className:"absolute inset-0 rounded-full bg-white/60 backdrop-blur-xl"}),n.jsx("div",{className:"relative truncate text-xs font-semibold text-gray-950",children:t.featured_tag})]})})]}),n.jsxs("div",{className:"flex flex-1 flex-col p-4",children:[n.jsx("div",{className:"line-clamp-2 leading-snug font-semibold text-ellipsis",children:t.title}),t.description&&n.jsx("div",{className:"line-clamp-3 pt-3 text-sm text-ellipsis",children:t.description}),n.jsx("div",{className:"flex-1"}),n.jsxs("div",{className:"flex flex-row items-end pt-3",children:[n.jsxs("div",{className:"flex flex-col overflow-hidden",children:[n.jsx("div",{className:"text-md leading-snug font-semibold",children:t.price}),n.jsx("div",{className:"text-token-text-secondary overflow-hidden pt-0.5 text-xs text-ellipsis whitespace-nowrap",children:t.merchants})]}),n.jsx("div",{className:"flex-1"}),t.num_reviews&&t.num_reviews>0&&n.jsxs("div",{className:"text-token-text-secondary flex w-fit flex-row gap-1 text-sm",children:[n.jsx(oi,{rating:(l=t.rating)!=null?l:0/5}),((c=t.rating)!=null?c:0).toFixed(1)]})]}),!1]})]})}function Vm({product:t,wide:e,showDebug:s=!1}){const a=t.image_urls?t.image_urls[0]:void 0,[o,r]=f.useState("contain"),[i,l]=f.useState("top"),c=f.useRef(null);return n.jsxs("div",{className:F("flex pb-2",e?"flex-row gap-3":"flex-col gap-2"),children:[n.jsx("div",{className:F("relative",e?"aspect-square w-1/4":"aspect-[13/16] w-full","bg-token-bg-tertiary dark:bg-token-text-inverted overflow-clip rounded-xl"),children:n.jsx(Fa,{className:"mix-blend-darken dark:mix-blend-lighten",children:a?n.jsx("img",{ref:c,className:"absolute inset-0 m-0 h-full w-full object-".concat(o," object-").concat(i),src:a,alt:t.title,onLoad:()=>{if(!c.current)return;const{naturalWidth:d,naturalHeight:u}=c.current,m=d/u;r(Math.abs(m-1)<.4?"cover":"contain"),l(u>d?"top":"center")}}):n.jsx("div",{className:"flex aspect-square items-center justify-center",children:n.jsx(es,{className:"text-token-text-tertiary h-12 w-12"})})})}),n.jsxs("div",{className:"flex flex-col gap-1 px-1",children:[n.jsx("div",{className:F("line-clamp-2 font-medium text-ellipsis",e?"text-base":"text-sm"),children:t.title}),n.jsxs("div",{className:"text-token-text-secondary flex flex-row gap-0.25 text-sm",children:[n.jsx("div",{children:t.price}),n.jsx("div",{className:"mx-0.5",children:"•"}),n.jsx("div",{className:"truncate",children:t.merchants})]}),!1]})]})}function Xm({className:t,imageUrl:e,productTitle:s,onClicked:a}){const[o,r]=f.useState("contain"),i=f.useRef(null);return n.jsx("div",{className:F(t,"hover:scale-[1.005]","dark:bg-token-text-inverted bg-token-bg-primary","cursor-pointer overflow-hidden rounded-xl shadow-inner transition-all duration-200","relative aspect-square max-h-60"),onClick:a,children:e?n.jsx("img",{ref:i,className:"m-0 h-full w-full overflow-hidden object-".concat(o," mix-blend-darken"),src:e,alt:s,onLoad:()=>{if(!i.current)return;const{naturalWidth:l,naturalHeight:c}=i.current,d=l/c;r(Math.abs(d-1)<.5?"cover":"contain")}}):n.jsx("div",{className:"flex aspect-square items-center justify-center",children:n.jsx(es,{className:"text-token-text-tertiary h-12 w-12"})})})}function Zm({product:t,showDebug:e=!1,onShown:s,onClicked:a}){return f.useEffect(()=>{s()},[s]),n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"flex flex-row gap-2 py-2",children:t.image_urls&&t.image_urls.length>0&&t.image_urls.slice(0,3).map(o=>n.jsx(Xm,{imageUrl:o,productTitle:t.title,onClicked:a},o))}),!1]})}function Ym({metadata:t,trackContentReferenceEvent:e}){var i;const s=Uo(),a=de(),o=vt(),r=ce(a,"3375735072");return f.useEffect(()=>{e("Search Content Reference Shown","search_content_reference_shown",t.type,{checkout_id:t.checkout_id})},[e,t.type,t.checkout_id]),r?n.jsxs("div",{className:"border-token-border-default bg-token-bg-primary not-prose mb-6 flex max-w-[420px] flex-col gap-4 rounded-[20px] border py-4 shadow-[0px_4px_16px_0px_rgba(0,_0,_0,_0.05)]","data-order-id":t.checkout_id,role:"group",children:[n.jsxs("div",{className:"flex items-center gap-2 px-4 text-sm font-medium",children:[n.jsx(_l,{className:"icon-lg text-green-400"}),n.jsx(z,{id:"checkout_purchase_confirmation_status",defaultMessage:"Purchase complete"})]}),n.jsxs("div",{className:"border-token-border-light flex items-start gap-3 border-b px-4 pb-4",children:[n.jsx("div",{className:"flex-shrink-0 overflow-hidden rounded-xl bg-gray-100 dark:bg-gray-700",children:n.jsx("img",{src:t.product_image_urls[0],alt:t.title,className:"m-0 aspect-square h-32 w-32 object-cover mix-blend-darken dark:mix-blend-lighten"})}),n.jsxs("div",{className:"min-w-0 flex-1",children:[n.jsx("div",{className:"line-clamp-2 min-h-6 text-base leading-snug font-medium",title:t.title,children:t.title}),n.jsx("div",{className:"text-token-text-secondary text-[13px] leading-snug whitespace-pre-wrap",children:t.subtitle})]})]}),t.error_message&&n.jsx("div",{className:"bg-token-bg-status-error text-token-interactive-label-danger-secondary-default mx-4 flex items-center rounded-lg px-3 py-1 text-sm",children:t.error_message}),n.jsx("dl",{className:"space-y-1 px-4",children:(i=t.details)==null?void 0:i.map(l=>n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("dt",{className:"text-token-text-secondary flex-grow text-[13px] font-medium",children:l.label}),n.jsx("dd",{className:"text-token-text-primary text-[13px] font-medium",children:l.value})]},l.label))}),!o&&n.jsx("div",{className:"px-4",children:n.jsx(Se,{fullWidth:!0,color:"secondary",className:"rounded-2xl border",onClick:()=>{s("#settings/".concat(jl.Orders,"?order=").concat(t.checkout_id))},children:n.jsx(z,{id:"2Dn5nu",defaultMessage:"View details"})})})]}):null}function Km({attribution:t,wordFadeType:e}){var r;const s=f.useContext(Oe),a=ri(s==null?void 0:s.message.id,t.attributable_index),o=ii();return n.jsx(ef,{isHighlighted:a,isDebugMode:o&&!1,content:(r=t.alt)!=null?r:"",attributableIndex:t.attributable_index,attributions:void 0,attributionsDebug:void 0,wordFadeType:e})}const Jm=f.memo(Ys);function Qm({content:t,isHighlighted:e,isDebugMode:s,attributableIndex:a,attributions:o,attributionsDebug:r,wordFadeType:i}){const l=i==="indexed",c=Ha(),d=f.useMemo(()=>l?{handlers:{text:(x,b,w)=>{const h=[];for(const _ of c(b.value))h.push({type:"element",tagName:"span",properties:{className:Ua.fadeIn},children:[{type:"text",value:_}]});return h}}}:void 0,[l,c]),u=f.useMemo(()=>({p:({children:x})=>n.jsx(n.Fragment,{children:x})}),[]),m=n.jsx(Jm,{rehypePlugins:Ms,remarkPlugins:Ns,urlTransform:Ss,remarkRehypeOptions:d,components:u,children:t});return n.jsx(tf,{isHighlighted:e,children:m})}const ef=$a.memo(Qm);function tf({isHighlighted:t,className:e,children:s}){return n.jsx("span",{className:F("relative","-mx-px my-[-0.2rem] rounded px-px py-[0.2rem]",t&&"attribution-highlight-bg","transition-colors duration-100 ease-in-out",e),children:s})}function la(t,e){try{return BigInt(t).toLocaleString(e)}catch(s){const a=Number(t);return t.includes("e")||t.includes("E")?a.toExponential():a.toLocaleString(e,{maximumFractionDigits:6})}}function sf({data:t,trackContentReferenceEvent:e}){f.useEffect(()=>{e("Search Content Reference Shown","search_content_reference_shown",t.type)},[e,t.type]);const s=kl().locale;return t.expression&&t.result!=null?n.jsxs("div",{className:"no-scrollbar overflow-auto sm:overflow-hidden",children:[n.jsxs("div",{className:"pb-1 text-lg font-semibold",children:[t.prefix&&n.jsx("span",{children:t.prefix}),n.jsx("span",{children:la(t.result,s)}),t.suffix&&n.jsx("span",{children:t.suffix})]}),n.jsx("div",{className:"text-token-text-primary tracking-wide",children:"".concat(t.expression,"=").concat(la(t.result,s))})]}):null}function Co({ref:t,onClick:e,onMouseEnter:s,onMouseLeave:a}){const o=K();return n.jsx("button",{ref:t,"aria-label":o.formatMessage({id:"citation.icon.label",defaultMessage:"Coding Citation"}),onClick:e,onMouseEnter:s,onMouseLeave:a,className:F("rounded-xl px-1","bg-token-interactive-bg-tertiary-press text-token-text-secondary hover:text-token-text-inverted hover:bg-token-interactive-bg-primary-selected"),children:n.jsx(li,{className:"icon-sm"})})}function nf({codeMessage:t,codeExecutionOutputMessage:e,onDismiss:s,FormattedText:a}){const o=K();return n.jsx(Ge.Root,{isOpen:!0,onClose:s,testId:"modal-code-execution",children:n.jsx(Ge.Overlay,{children:n.jsxs(Ge.Content,{className:"flex max-h-[75vh] max-w-lg flex-col overflow-hidden",children:[n.jsx(Ge.Header,{title:o.formatMessage(af.title),type:"success",closeButton:n.jsx(Cl,{onClick:s})}),n.jsxs("div",{className:"flex flex-1 flex-col overflow-auto",children:[n.jsx("div",{children:n.jsx(ci,{FormattedText:a,message:t,codeRendererClassName:"border-none rounded-none",removeTopBorderRadius:!0})}),n.jsx("div",{children:n.jsx(di,{message:e})})]})]})})})}const af=Qt({title:{id:"CodeExecutionOutputModal.title",defaultMessage:"Analysis"}});function of({displayInfo:t,FormattedText:e,trackContentReferenceEvent:s}){const[a,o]=f.useState(!1),r=K();return f.useEffect(()=>{s("Search Content Reference Shown","search_content_reference_shown",t.type)},[s,t.type]),n.jsxs(n.Fragment,{children:[n.jsx(Ue,{label:r.formatMessage(rf.viewAnalysis),side:"top",delayDuration:150,className:"align-middle",children:n.jsx(Co,{onClick:()=>o(!0)})}),a&&n.jsx(nf,{FormattedText:e,codeMessage:t.codeMessage,codeExecutionOutputMessage:t.codeExecutionOutputMessage,onDismiss:()=>o(!1)})]})}const rf=Qt({viewAnalysis:{id:"viewAnalysis",defaultMessage:"View analysis"}});function lf({contentReference:t,clientThreadId:e,turnIndex:s}){var b,w,h,_,v,C,k;const{toggleThreadSidebar:a}=Mt(),o=ui("codingCitations"),[r,i]=f.useState(!1),l=f.useRef(null),c=()=>{l.current!=null&&window.clearTimeout(l.current),i(!0)},d=()=>{l.current=window.setTimeout(()=>i(!1),100)},u=f.useCallback(()=>{var y,j;e&&a({type:"codingCitations",clientThreadId:e,turnIndex:s||1,messageId:(j=(y=t.cited_message)==null?void 0:y.id)!=null?j:"",matchedText:t.matched_text},o)},[a,e,o,t,s]);if(!t.cited_message||!t.highlighted_text)return null;let m;t.type==="python"?m=(h=(w=(b=t.cited_message)==null?void 0:b.metadata)==null?void 0:w.aggregate_result)==null?void 0:h.code:t.type==="container"&&(m=(C=(v=(_=t.cited_message)==null?void 0:_.metadata)==null?void 0:v.container_citation)==null?void 0:C.source_cmd);const x=(k=m==null?void 0:m.split("\n").length)!=null?k:0;return n.jsx("span",{className:"relative top-[0.1rem] inline-block align-middle",children:n.jsx("span",{className:"inline-flex items-center",children:n.jsxs(zs,{open:r,onOpenChange:i,children:[n.jsx(Hs,{asChild:!0,children:n.jsx(Co,{onClick:u,onMouseEnter:c,onMouseLeave:d})}),n.jsx(Us,{children:n.jsx(qs,{align:"start",sideOffset:4,onMouseEnter:c,onMouseLeave:d,className:F("border-default bg-token-bg-primary rounded-2xl border p-3"),children:n.jsxs("aside",{className:"flex flex-col gap-3",children:[n.jsx("h2",{className:F("text-token-text-secondary text-xs font-medium"),children:t.type==="python"?n.jsx(z,{id:"citation.popover.label.python",defaultMessage:"Python script · {count, number} lines",values:{count:x}}):n.jsx(z,{id:"citation.popover.label.container",defaultMessage:"Bash script · {count, number} lines",values:{count:x}})}),n.jsx("hr",{}),n.jsx("h2",{className:F("text-sm font-medium","max-w-full break-words whitespace-pre-line sm:max-w-[300px]"),children:t.highlighted_text})]})})})]})})})}function cf({dil:t,trackContentReferenceEvent:e,widgetName:s}){return f.useEffect(()=>{const a=s==null?void 0:{widget_name:s};e("Search Content Reference Shown","search_content_reference_shown","dil",a)},[e,s]),null}function df({business:t,mapUrl:e,showTitle:s=!1,showActionButtons:a=!0,trackContentReferenceEvent:o}){const r=t.categories&&t.categories.length>0?t.categories[0]:"",i=f.useRef({directions:null,website:null,phone:null});f.useEffect(()=>{i.current={directions:null,website:null,phone:null}},[t.id]);const l=f.useMemo(()=>({section:"entity_metadata",section_location:"response",entity_type:"local_business",business_id:t.id,provider:t.provider}),[t.id,t.provider]),c=f.useCallback((d,u,m)=>{if(!o)return;const x=G(B({},l),{cta_type:d,url:m,link_type:"button",action:u});o("link_action",null,"entity_metadata",x),u==="show"?o("Entity Metadata Content Reference Shown","entity_metadata_content_reference_shown","entity_metadata",x):u==="click"&&o("Entity Metadata Content Reference Clicked","entity_metadata_content_reference_clicked","entity_metadata",x)},[l,o]);return f.useEffect(()=>{if(!(!o||!a)&&(e&&i.current.directions!==e&&(c("directions","show",e),i.current.directions=e),t.website_url&&i.current.website!==t.website_url&&(c("website","show",t.website_url),i.current.website=t.website_url),t.phone)){const d="tel:".concat(t.phone);i.current.phone!==d&&(c("phone","show",d),i.current.phone=d)}},[t.phone,t.website_url,e,a,o,c]),n.jsxs("div",{className:"text-token-text-primary bg-token-bg-primary max-w-md rounded-md py-1",children:[s&&t.name&&n.jsx("h2",{className:"mb-1 leading-tight",children:t.name}),n.jsx("div",{className:"flex flex-wrap items-center text-[15px] font-normal",children:[t.rating?n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(Wa,{className:"h-4 w-4"}),t.rating.toFixed(1)]},"rating"):null,r?n.jsx("span",{children:r},"category"):null,t.price_str?n.jsx("span",{children:t.price_str},"price"):null,t.is_open!==void 0&&t.is_open!=null?t.is_open?n.jsx("span",{className:"text-green-600",children:n.jsx(z,{id:"businessMetadata.openStatus",defaultMessage:"Open"})},"open"):n.jsx("span",{children:n.jsx(z,{id:"businessMetadata.closedStatus",defaultMessage:"Closed"})},"open"):null].filter(Boolean).map((d,u)=>n.jsxs($a.Fragment,{children:[u>0&&n.jsx("span",{className:"mx-1",children:"•"}),d]},u))}),a&&n.jsxs("div",{className:"justify-left mt-3 flex w-full flex-wrap gap-2",children:[e&&n.jsx(us,{type:"button",className:"btn btn-secondary btn-small text-token-text-primary relative m-0! w-25 px-2.5 py-1 text-xs font-medium",onClick:()=>{c("directions","click",e),window.open(e,"_blank","noopener,noreferrer")},children:n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(ic,{className:"text-token-text-primary h-4 w-4"}),n.jsx(z,{id:"businessMetadata.directions",defaultMessage:"Directions"})]},"rating")}),t.website_url&&n.jsx(us,{type:"button",className:"btn btn-secondary btn-small text-token-text-primary relative m-0! w-25 px-2.5 py-1 text-xs font-medium",onClick:()=>{const d=t.website_url;d&&(c("website","click",d),window.open(d,"_blank","noopener,noreferrer"))},children:n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(mi,{className:"text-token-text-primary h-4 w-4"}),n.jsx(z,{id:"businessMetadata.website",defaultMessage:"Website"})]},"rating")}),t.phone&&n.jsx(us,{type:"button",className:"btn btn-secondary btn-small text-token-text-primary relative m-0! w-25 px-2.5 py-1 text-xs font-medium",onClick:()=>{const d="tel:".concat(t.phone);c("phone","click",d),window.location.href=d},children:n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(_c,{className:"text-token-text-primary h-4 w-4"}),n.jsx(z,{id:"businessMetadata.phone",defaultMessage:"Phone"})]},"rating")})]})]})}function uf({product:t,clientThreadId:e,messageId:s,contentReferenceStartIndex:a,trackContentReferenceEvent:o,showTitle:r=!1,showImageGallery:i=!1}){var k,y,j,S;const l=de(),c=ce(l,"3375735072"),d=ce(l,"232003972"),u=f.useMemo(()=>({clientThreadId:e,messageId:s}),[e,s]),m=Gs.useStore(),[x,b]=f.useState(!1),[w,h]=f.useState(t),[_,v]=f.useState(!1),C=r||d||c;return f.useEffect(()=>{let g=!0;return(async P=>{v(!0);try{try{for(var L=is(mf(P)),E,R,T;E=!(R=await L.next()).done;E=!1){const M=R.value;g&&h(M)}}catch(R){T=[R]}finally{try{E&&(R=L.return)&&await R.call(L)}finally{if(T)throw T[0]}}}finally{g&&v(!1)}})(w),()=>{g=!1}},[(k=w.product_lookup_key)==null?void 0:k.variant_options_query]),w?n.jsxs("div",{className:"-mx-6",children:[i&&n.jsx(fi,{imageUrls:(y=w.image_urls)!=null?y:[],title:w.title,onImageClick:g=>{m.setCurrentImage({image:{url:g,content_url:g,thumbnail_url:g,title:w.title,content_size:{width:0,height:0},thumbnail_size:{width:0,height:0}},source:nt.ProductDetails,analyticsMetadata:u,contentReferenceStartIndex:a})}}),n.jsxs("div",{className:"bg-token-bg-primary flex w-full flex-col",children:[C&&n.jsxs("div",{className:"border-token-border-light flex flex-col border-b px-6 pb-3",children:[r&&n.jsx("div",{className:"text-token-text-primary text-xl font-medium capitalize",children:w.title}),d&&w.num_reviews&&w.rating&&n.jsx(hi,{rating:w.rating,numReviews:w.num_reviews,ratingGroupedCitation:w.rating_grouped_citation,trackContentReferenceEvent:()=>{},analyticsMetadata:u}),c&&w.variants&&w.variants.length>0&&n.jsx("div",{className:"mt-5 mb-2",children:n.jsx(pi,{options:w.variants,showErrors:x,updateOption:(g,N,P)=>h(L=>ff({optionGroupId:g,selectedId:N,variant_index:P,product:L,trackContentReferenceEvent:o}))})})]}),n.jsx(gi,{className:"border-token-border-light -pt-3 -mx-3 flex flex-col border-b px-6 pb-3",offers:(j=t.offers)!=null?j:[],contentReferenceStartIndex:a,productIndex:0,product:t,trackContentReferenceEvent:o,analyticsMetadata:u,imageUrls:(S=t.image_urls)!=null?S:[],isLoading:_,onOpenCheckout:()=>b(!0)})]})]}):null}function mf(t){return gn(this,null,function*(){const{product_lookup_key:e}=t;if(!!!(e!=null&&e.variant_options_query)){yield t;return}const a=xi("".concat(Sl,"/search/product_info_variants"),{method:"POST",headers:B({},Ks({isAuthOptional:!0})),body:{product_lookup_key:t.product_lookup_key}});try{for(var o=is(a),r,i,l;r=!(i=yield new At(o.next())).done;r=!1){const c=i.value;"data"in c&&(yield c.data.product)}}catch(i){l=[i]}finally{try{r&&(i=o.return)&&(yield new At(i.call(o)))}finally{if(l)throw l[0]}}})}function ff({optionGroupId:t,selectedId:e,variant_index:s,product:a,trackContentReferenceEvent:o}){var d,u,m,x,b,w;const r=(d=a.variants)==null?void 0:d.find(h=>h.id===t);o("product_detail","product_detail","product_entity",{product_id:a.id,action:"variant_selected",section:"product_detail",section_location:"sidebar",variant_name:(u=r==null?void 0:r.label)!=null?u:"",variant_value:(x=(m=r==null?void 0:r.options.find(h=>h.id===e))==null?void 0:m.label)!=null?x:"",variant_index:s});const i=(w=(b=a.variants)==null?void 0:b.map(h=>h.id===t?G(B({},h),{options:h.options.map(_=>G(B({},_),{selected:_.id===e})),selected_option_id:e}):h))!=null?w:a.variants,c=(i==null?void 0:i.every(h=>h.selected_option_id))?i==null?void 0:i.reduce((h,_)=>(_.selected_option_id&&(h[_.id]=_.selected_option_id),h),{}):null;return G(B({},a),{variants:i,product_lookup_key:G(B({},a.product_lookup_key),{variant_options_query:c})})}function hf({contentReference:t,clientThreadId:e,messageId:s,trackContentReferenceEvent:a}){var o,r;if(f.useEffect(()=>{var i,l;a("Entity Metadata Content Reference Shown","entity_metadata_content_reference_shown","entity_metadata",B({entity_type:t.entity_type},t.entity_type==="local_business"?{business_id:(i=t.entity_data)==null?void 0:i.id}:t.entity_type==="product"?{product_id:(l=t.entity_data)==null?void 0:l.id}:{}))},[a,t.entity_type,(o=t.entity_data)==null?void 0:o.id]),!(t!=null&&t.entity_data))return null;if(t.entity_type==="local_business"){const i=t.layout;return n.jsx(df,{business:t.entity_data,mapUrl:(r=t.metadata)==null?void 0:r.map_url,showActionButtons:i!=="one-line",showTitle:i!=="one-line",trackContentReferenceEvent:a})}else if(t.entity_type==="product")return n.jsx(uf,{product:t.entity_data,clientThreadId:e,messageId:s,contentReferenceStartIndex:t.start_idx,trackContentReferenceEvent:a});return null}function pf({iconRef:t,className:e,alt:s}){var o;const a=(o=t==null?void 0:t.vector_url)!=null?o:t==null?void 0:t.raster_url;return a?n.jsx("img",{src:a,className:e,alt:s}):n.jsx(qa,{className:e})}function Os(t,e,s,a,o=!1){var _,v,C,k,y,j,S,g,N,P,L,E,R,T,M,p,D,W,$;const r=ce(s,"3958255976"),i=o!=null?o:!1,l=ce(s,"1424158285")||i,c=bi((_=t.cloud_doc_url)!=null?_:""),d=(C=r?(v=t.fff_metadata)==null?void 0:v.name:void 0)!=null?C:t.name,u=(j=(y=r?(k=t.fff_metadata)==null?void 0:k.display_file_type_name:void 0)!=null?y:c==null?void 0:c.type)!=null?j:a.formatMessage({id:"bqY3sN",defaultMessage:"File"}),m=(P=(N=r&&((S=t.fff_metadata)!=null&&S.display_file_type_icon)?n.jsx(pf,{alt:u,className:e,iconRef:(g=t.fff_metadata)==null?void 0:g.display_file_type_icon}):void 0)!=null?N:c!=null&&c.Icon?n.jsx(c.Icon,{alt:u,className:e}):t.cloud_doc_url?l?n.jsx(pt,{url:t.cloud_doc_url,className:e,fallback:n.jsx(Ps,{alt:u,className:e})}):n.jsx(Ps,{alt:u,className:e}):void 0)!=null?P:n.jsx(qa,{alt:u,className:e}),x=(R=r?(E=(L=t.fff_metadata)==null?void 0:L.capabilities)==null?void 0:E.user_view:void 0)!=null?R:t.cloud_doc_url;let b;r&&((T=t.fff_metadata)!=null&&T.snippet)&&((M=t.fff_metadata)==null?void 0:M.snippet.content.content_type)==="text"?b=t.fff_metadata.snippet.content.text:b=(p=t.description)!=null?p:t.snippet;const w=(W=r?(D=t.fff_metadata)==null?void 0:D.file_last_modified_time:void 0)!=null?W:t.last_modified_time,h=r?($=t.fff_metadata)==null?void 0:$.file_created_time:void 0;return{fileName:d,fileTypeDisplayName:u,fileTypeIcon:m,url:x,snippet:b,fileLastModifiedTime:w,fileCreatedTime:h}}const ca=32;function So(t){const e=t.split(".");let s=t;return e.length>1&&e.slice(0,-1).some(a=>a.length>0)&&(s=e.slice(0,-1).join(".")),s.length>ca&&(s=s.slice(0,ca-1)+"…"),s}function No({additionalFileRefs:t,fileRef:e,index:s,trackContentReferenceEvent:a}){var b;const o=Nl(ss),r=Ml(),i=f.useContext(Oe),l=f.useMemo(()=>({source:e.source,index:s}),[e.source,s]);f.useEffect(()=>{a("File Citation Shown","file_citation_shown","file",l)},[]);const c=f.useCallback(w=>{w?a("File Citation Hovered","file_citation_hovered","file",l):a("File Citation Unhovered","file_citation_unhovered","file",l)},[l,a]),d=f.useCallback(()=>{a("File Citation Clicked","file_citation_clicked","file",l)},[l,a]),u=f.useCallback(()=>{a("File Citation Followup Clicked","file_citation_followup_clicked","file",l)},[l,a]),m=f.useCallback(()=>r(e.id,e.name),[r,e.id,e.name]),x=lt((b=i==null?void 0:i.analyticsMetadata.clientThreadId)!=null?b:eo,w=>w==null?void 0:w.mode);return o&&Ga(e.id)?null:yi(x)?x.gizmo_id&&Tl(x.gizmo_id)?n.jsx("span",{className:F(wi,"ms-1"),title:e.name,children:So(e.name)}):null:n.jsx(gf,{additionalFileRefs:t,fileItem:e,onClickDownloadFile:m,trackCloudLinkClick:d,trackFileCitationFollowup:u,trackTooltipOpenChange:c})}var Ca;const da=en.p(Ca||(Ca=ut(["not-prose mt-0! mb-0! flex-auto truncate"])));function gf({additionalFileRefs:t,className:e,fileItem:s,onClickDownloadFile:a,trackCloudLinkClick:o,trackFileCitationFollowup:r,trackTooltipOpenChange:i}){var g,N;const l=K(),c=de(),d=to(),u=ce(c,"1424158285")||d,{fileName:m,fileTypeDisplayName:x,fileTypeIcon:b,url:w,snippet:h}=Os(s,"h-[16px] w-[16px] object-contain text-token-text-primary! flex-none",c,l,d),_=f.useMemo(()=>{var E;const P={fileItem:s,fileName:m,fileTypeDisplayName:x,fileTypeIcon:b,url:w,snippet:h},L=(E=t==null?void 0:t.map(R=>{const T=Os(R,"h-[16px] w-[16px] object-contain",c,l,d);return{fileItem:R,fileName:T.fileName,fileTypeDisplayName:T.fileTypeDisplayName,fileTypeIcon:T.fileTypeIcon,url:T.url,snippet:T.snippet}}))!=null?E:[];return[P,...L]},[s,m,x,b,w,h,t,c,l,d]),v=f.useMemo(()=>{const P=new Map;for(const L of _){const E="".concat(L.fileName,"-").concat(L.url,"-").concat(L.snippet);P.set(E,L)}return Array.from(P.values())},[_]);let C=F("ms-1 flex h-[25px] text-[10px] leading-[13px] rounded-xl items-center justify-center gap-1 px-2 relative","text-token-text-secondary! hover:text-token-text-primary! hover:bg-token-bg-secondary dark:bg-token-main-surface-secondary dark:hover:bg-token-bg-secondary",e);u||(C+=" bg-[#f4f4f4] ");const k=u&&s.medical_file_reference!==null&&((g=s.medical_file_reference)==null?void 0:g.journal_name)!==null?(N=s.medical_file_reference)==null?void 0:N.journal_name:s.name,y=Math.max(v.length-1,0),j="".concat(So(k)).concat(y>0?" +".concat(y):""),S=n.jsx("span",{className:"relative inline-flex items-center",children:w?n.jsxs($e,{href:w,className:C,onClick:o,children:[b,n.jsx(da,{children:j})]}):Ga(s.id)?n.jsxs("button",{onClick:a,className:C,children:[b,n.jsx(da,{children:j})]}):n.jsx("span",{className:C,children:n.jsx(Ps,{})})});return n.jsx(xf,{items:v,contentType:x,trackFileCitationFollowup:r,trackTooltipOpenChange:i,children:S})}function xf({items:t,children:e,contentType:s,trackFileCitationFollowup:a,trackTooltipOpenChange:o}){var _;const r=Tt(),i=f.useContext(Oe),l=(_=i==null?void 0:i.clientThreadId)!=null?_:eo,c=vt(),d=de(),u=ce(d,"1424158285"),m=ce(d,"733205176"),x=ce(d,"2137702454"),b=jc(l,t[0].fileItem.id,t[0].fileName,t[0].url),w=f.useCallback((v,C)=>{C.length&&(b(v,C),a==null||a())},[b,a]),h=()=>{var v,C,k;return x?n.jsx("div",{className:"max-h-[420px] max-w-sm min-w-xs overflow-y-auto p-2",children:t.map(({fileItem:y,fileName:j,snippet:S,url:g})=>{var N,P,L;return n.jsxs($e,{href:g,className:F("text-token-text-primary hover:bg-token-bg-tertiary flex flex-col gap-1 rounded-md p-2 text-start text-xs font-normal no-underline!"),children:[n.jsxs("div",{className:"flex items-center gap-1.5",children:[n.jsx("div",{className:"icon-sm h-4 w-4 shrink-0 items-center overflow-hidden rounded-full",children:t[0].fileTypeIcon}),n.jsx("div",{className:"text-token-text-secondary line-clamp-1 text-sm",children:u?(N=t[0].fileItem.medical_file_reference)==null?void 0:N.journal_name:s})]}),n.jsx("div",{className:F("text-sm font-medium break-all",S?"line-clamp-1":"line-clamp-2"),children:j}),u&&n.jsxs("div",{className:"line-clamp-2 text-sm break-words",children:[n.jsx("span",{className:"italic",children:(P=y.medical_file_reference)==null?void 0:P.authors_display}),n.jsx("span",{className:"ms-1 not-italic",children:(L=y.medical_file_reference)==null?void 0:L.publication_year})]}),S&&n.jsx("div",{className:"text-token-text-secondary line-clamp-3 text-sm break-all",children:S})]},y.id)})}):n.jsxs(n.Fragment,{children:[n.jsxs($e,{href:t[0].url,className:F("text-token-text-primary flex max-w-80 flex-col gap-1 text-start text-xs font-normal no-underline!"),children:[n.jsxs("div",{className:"flex items-center justify-center gap-1.5",children:[t[0].fileTypeIcon,n.jsx("div",{className:"text-token-text-primary flex-auto truncate",children:u?(v=t[0].fileItem.medical_file_reference)==null?void 0:v.journal_name:s})]}),n.jsx("div",{className:"line-clamp-2 text-sm font-medium break-all",children:t[0].fileName}),u&&n.jsxs("div",{className:"line-clamp-2 text-sm break-words",children:[n.jsx("span",{className:"italic",children:(C=t[0].fileItem.medical_file_reference)==null?void 0:C.authors_display}),n.jsx("span",{className:"ms-1 not-italic",children:(k=t[0].fileItem.medical_file_reference)==null?void 0:k.publication_year})]})]}),c||m?null:n.jsx("div",{className:"flex w-full cursor-pointer flex-row items-center gap-2 pt-3 text-sm",children:n.jsx(kc,{sendReply:w})})]})};return n.jsx(Ue,{label:n.jsx(h,{}),align:"start",cornerRadius:"xl",customBorderClassName:"border-token-border-default border",customPaddingClassName:x?"p-0":"p-3",delayDuration:150,interactive:!0,onOpenChange:o,side:"bottom",theme:r?"default":"white",wide:!0,children:e})}function bf({contentReferences:t,fileRef:e,index:s,trackContentReferenceEvent:a}){const o=t[s-1];if((o==null?void 0:o.type)==="file"&&(o.end_idx===e.start_idx-1||o.end_idx===e.start_idx))return;const r=yf({contentReferences:t,fileRef:e,index:s});return Object.entries(r).map(([i,l])=>n.jsx(No,{additionalFileRefs:l.slice(1),fileRef:l[0],index:s,trackContentReferenceEvent:a},i))}const yf=({contentReferences:t,fileRef:e,index:s})=>{var c,d;const a=[];let o=s,r=e;for(let u=o+1;u<t.length;u++){const m=t[u];if((m==null?void 0:m.type)==="file"&&(r.end_idx===m.start_idx-1||r.end_idx===m.start_idx))a.push(m),r=m,o=u;else break}const i=[e,...a],l={};for(const u of i){const m=(d=vi((c=u.cloud_doc_url)!=null?c:""))!=null?d:"unknown";l[m]||(l[m]=[]),l[m].push(u)}return l};function wf(t,e){return new Date(t).toLocaleDateString(e,{month:"long",day:"numeric",year:"numeric"})}function vf({metadata:t,trackContentReferenceEvent:e}){return t.items.length===0?null:n.jsx("div",{className:"mt-6 flex flex-col gap-3",children:t.items.map((s,a)=>n.jsx(_f,{item:s,index:a,trackContentReferenceEvent:e},a))})}function _f({item:t,index:e,trackContentReferenceEvent:s}){const a=K(),o=de(),r=to(),{fileName:i,fileTypeDisplayName:l,fileTypeIcon:c,snippet:d,url:u,fileLastModifiedTime:m}=Os(t,"icon object-contain",o,a,r),x={title:i,description:d!=null?d:"",index:e};return f.useEffect(()=>{s("Contextual Answers Content Reference Shown","contextual_answers_content_reference_shown","file_navlist",x)},[]),n.jsxs($e,{className:"group/nav-list relative flex items-center gap-6 py-1.5",href:u!=null?u:"/",onClick:()=>{s("Contextual Answers Content Reference Clicked","contextual_answers_content_reference_clicked","file_navlist",x)},children:[n.jsx("div",{className:"absolute start-0 top-0 bottom-0 w-[3px] rounded-t-lg rounded-b-lg bg-black/10"}),n.jsxs("div",{className:"ms-4 flex grow flex-col gap-1 overflow-hidden text-ellipsis",children:[n.jsxs("div",{className:"not-prose text-token-text-primary flex items-center gap-1.5 text-sm",children:[c,n.jsx("div",{className:"text-token-text-primary line-clamp-2 text-sm",children:l})]}),n.jsx("div",{className:"text-token-link decoration-token-link line-clamp-2 font-semibold group-hover/nav-list:underline",children:i}),n.jsx("div",{className:"text-token-text-primary line-clamp-2 text-sm leading-snug font-normal",children:d}),m&&n.jsx("div",{className:"text-token-text-secondary text-sm",children:wf(m,a.locale)})]})]})}var ks={line:{color:"#F66",width:1,dashPattern:[]},sync:{enabled:!0,group:1,suppressTooltips:!1},zoom:{enabled:!0,zoomboxBackgroundColor:"rgba(66,133,244,0.2)",zoomboxBorderColor:"#48F",zoomButtonText:"Reset Zoom",zoomButtonClass:"reset-zoom"},snap:{enabled:!1},callbacks:{beforeZoom:function(t,e){return!0},afterZoom:function(t,e){}}},jf={id:"crosshair",afterInit:function(t){if(t.config.options.scales.x){var e=t.config.options.scales.x.type;if(!(e!=="linear"&&e!=="time"&&e!=="category"&&e!=="logarithmic")){t.options.plugins.crosshair===void 0&&(t.options.plugins.crosshair=ks),t.crosshair={enabled:!1,suppressUpdate:!1,x:null,originalData:[],originalXRange:{},dragStarted:!1,dragStartX:null,dragEndX:null,suppressTooltips:!1,ignoreNextEvents:0,reset:function(){this.resetZoom(t,!1,!1)}.bind(this)};var s=this.getOption(t,"sync","enabled");s&&(t.crosshair.syncEventHandler=function(a){this.handleSyncEvent(t,a)}.bind(this),t.crosshair.resetZoomEventHandler=function(a){var o=this.getOption(t,"sync","group");a.chartId!==t.id&&a.syncGroup===o&&this.resetZoom(t,!0)}.bind(this),window.addEventListener("sync-event",t.crosshair.syncEventHandler),window.addEventListener("reset-zoom-event",t.crosshair.resetZoomEventHandler)),t.panZoom=this.panZoom.bind(this,t)}}},afterDestroy:function(t){var e=this.getOption(t,"sync","enabled");e&&(window.removeEventListener("sync-event",t.crosshair.syncEventHandler),window.removeEventListener("reset-zoom-event",t.crosshair.resetZoomEventHandler))},panZoom:function(t,e){if(t.crosshair.originalData.length!==0){var s=t.crosshair.end-t.crosshair.start,a=t.crosshair.min,o=t.crosshair.max;e<0?(t.crosshair.start=Math.max(t.crosshair.start+e,a),t.crosshair.end=t.crosshair.start===a?a+s:t.crosshair.end+e):(t.crosshair.end=Math.min(t.crosshair.end+e,t.crosshair.max),t.crosshair.start=t.crosshair.end===o?o-s:t.crosshair.start+e),this.doZoom(t,t.crosshair.start,t.crosshair.end)}},getOption:function(t,e,s){return jn(t.options.plugins.crosshair[e]?t.options.plugins.crosshair[e][s]:void 0,ks[e][s])},getXScale:function(t){return t.data.datasets.length?t.scales[t.getDatasetMeta(0).xAxisID]:null},getYScale:function(t){return t.scales[t.getDatasetMeta(0).yAxisID]},handleSyncEvent:function(t,e){var s=this.getOption(t,"sync","group");if(e.chartId!==t.id&&e.syncGroup===s){var a=this.getXScale(t);if(a){var o=e.original.native.buttons===void 0?e.original.native.which:e.original.native.buttons;e.original.type==="mouseup"&&(o=0);var r={type:e.original.type=="click"?"mousemove":e.original.type,chart:t,x:a.getPixelForValue(e.xValue),y:e.original.y,native:{buttons:o},stop:!0};t._eventHandler(r)}}},afterEvent:function(t,e){if(t.config.options.scales.x.length==0)return;let s=e.event;var a=t.config.options.scales.x.type;if(!(a!=="linear"&&a!=="time"&&a!=="category"&&xscaleType!=="logarithmic")){var o=this.getXScale(t);if(o){if(t.crosshair.ignoreNextEvents>0){t.crosshair.ignoreNextEvents-=1;return}var r=s.native.buttons===void 0?s.native.which:s.native.buttons;s.native.type==="mouseup"&&(r=0);var i=this.getOption(t,"sync","enabled"),l=this.getOption(t,"sync","group");if(!s.stop&&i){var e=new CustomEvent("sync-event");e.chartId=t.id,e.syncGroup=l,e.original=s,e.xValue=o.getValueForPixel(s.x),window.dispatchEvent(e)}var c=this.getOption(t,"sync","suppressTooltips");if(t.crosshair.suppressTooltips=s.stop&&c,t.crosshair.enabled=s.type!=="mouseout"&&s.x>o.getPixelForValue(o.min)&&s.x<o.getPixelForValue(o.max),!t.crosshair.enabled&&!t.crosshair.suppressUpdate)return s.x>o.getPixelForValue(o.max)&&(t.crosshair.suppressUpdate=!0,t.update("none")),t.crosshair.dragStarted=!1,!1;t.crosshair.suppressUpdate=!1;var d=this.getOption(t,"zoom","enabled");if(r===1&&!t.crosshair.dragStarted&&d&&(t.crosshair.dragStartX=s.x,t.crosshair.dragStarted=!0),t.crosshair.dragStarted&&r===0){t.crosshair.dragStarted=!1;var u=o.getValueForPixel(t.crosshair.dragStartX),m=o.getValueForPixel(t.crosshair.x);Math.abs(t.crosshair.dragStartX-t.crosshair.x)>1&&this.doZoom(t,u,m),t.update("none")}t.crosshair.x=s.x,t.draw()}}},afterDraw:function(t){if(t.crosshair.enabled)return t.crosshair.dragStarted?this.drawZoombox(t):(this.drawTraceLine(t),this.interpolateValues(t),this.drawTracePoints(t)),!0},beforeTooltipDraw:function(t){return!t.crosshair.dragStarted&&!t.crosshair.suppressTooltips},resetZoom:function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(s){if(t.crosshair.originalData.length>0)for(var a=0;a<t.data.datasets.length;a++){var o=t.data.datasets[a];o.data=t.crosshair.originalData.shift(0)}t.crosshair.originalXRange.min?(t.options.scales.x.min=t.crosshair.originalXRange.min,t.crosshair.originalXRange.min=null):delete t.options.scales.x.min,t.crosshair.originalXRange.max?(t.options.scales.x.max=t.crosshair.originalXRange.max,t.crosshair.originalXRange.max=null):delete t.options.scales.x.max}t.crosshair.button&&t.crosshair.button.parentNode&&(t.crosshair.button.parentNode.removeChild(t.crosshair.button),t.crosshair.button=!1);var r=this.getOption(t,"sync","enabled");if(!e&&s&&r){var i=this.getOption(t,"sync","group"),l=new CustomEvent("reset-zoom-event");l.chartId=t.id,l.syncGroup=i,window.dispatchEvent(l)}s&&t.update("none")},doZoom:function(t,e,s){if(e>s){var a=e;e=s,s=a}var o=jn(t.options.plugins.crosshair.callbacks?t.options.plugins.crosshair.callbacks.beforeZoom:void 0,ks.callbacks.beforeZoom);if(!o(e,s))return!1;if(t.crosshair.dragStarted=!1,t.options.scales.x.min&&t.crosshair.originalData.length===0&&(t.crosshair.originalXRange.min=t.options.scales.x.min),t.options.scales.x.max&&t.crosshair.originalData.length===0&&(t.crosshair.originalXRange.max=t.options.scales.x.max),!t.crosshair.button){var r=document.createElement("button"),i=this.getOption(t,"zoom","zoomButtonText"),l=this.getOption(t,"zoom","zoomButtonClass"),c=document.createTextNode(i);r.appendChild(c),r.className=l,r.addEventListener("click",function(){this.resetZoom(t)}.bind(this)),t.canvas.parentNode.appendChild(r),t.crosshair.button=r}t.options.scales.x.min=e,t.options.scales.x.max=s;var d=t.crosshair.originalData.length===0,u=t.config.options.scales.x.type!=="category";if(u)for(var m=0;m<t.data.datasets.length;m++){var x=[],b=0,w=!1,h=!1;d&&(t.crosshair.originalData[m]=t.data.datasets[m].data);for(var _=t.crosshair.originalData[m],v=0;v<_.length;v++){var C=_[v],k=C.x!==void 0?C.x:NaN;k>=e&&!w&&b>0&&(x.push(_[b-1]),w=!0),k>=e&&k<=s&&x.push(C),k>s&&!h&&b<_.length&&(x.push(C),h=!0),b+=1}t.data.datasets[m].data=x}if(t.crosshair.start=e,t.crosshair.end=s,d){var y=this.getXScale(t);t.crosshair.min=y.min,t.crosshair.max=y.max}t.crosshair.ignoreNextEvents=2,t.update("none");var j=this.getOption(t,"callbacks","afterZoom");j(e,s)},drawZoombox:function(t){var e=this.getYScale(t),s=this.getOption(t,"zoom","zoomboxBorderColor"),a=this.getOption(t,"zoom","zoomboxBackgroundColor");t.ctx.beginPath(),t.ctx.rect(t.crosshair.dragStartX,e.getPixelForValue(e.max),t.crosshair.x-t.crosshair.dragStartX,e.getPixelForValue(e.min)-e.getPixelForValue(e.max)),t.ctx.lineWidth=1,t.ctx.strokeStyle=s,t.ctx.fillStyle=a,t.ctx.fill(),t.ctx.fillStyle="",t.ctx.stroke(),t.ctx.closePath()},drawTraceLine:function(t){var e=this.getYScale(t),s=this.getOption(t,"line","width"),a=this.getOption(t,"line","color"),o=this.getOption(t,"line","dashPattern"),r=this.getOption(t,"snap","enabled"),i=t.crosshair.x;r&&t._active.length&&(i=t._active[0].element.x),t.ctx.beginPath(),t.ctx.setLineDash(o),t.ctx.moveTo(i,e.getPixelForValue(e.max)),t.ctx.lineWidth=s,t.ctx.strokeStyle=a,t.ctx.lineTo(i,e.getPixelForValue(e.min)),t.ctx.stroke(),t.ctx.setLineDash([])},drawTracePoints:function(t){for(var e=0;e<t.data.datasets.length;e++){var s=t.data.datasets[e],a=t.getDatasetMeta(e),o=t.scales[a.yAxisID];a.hidden||!s.interpolate||(t.ctx.beginPath(),t.ctx.arc(t.crosshair.x,o.getPixelForValue(s.interpolatedValue),3,0,2*Math.PI,!1),t.ctx.fillStyle="white",t.ctx.lineWidth=2,t.ctx.strokeStyle=s.borderColor,t.ctx.fill(),t.ctx.stroke())}},interpolateValues:function(t){for(var e=0;e<t.data.datasets.length;e++){var s=t.data.datasets[e],a=t.getDatasetMeta(e),o=t.scales[a.xAxisID],r=o.getValueForPixel(t.crosshair.x);if(!(a.hidden||!s.interpolate)){var i=s.data,l=i.findIndex(function(m){return m.x>=r}),c=i[l-1],d=i[l];if(t.data.datasets[e].steppedLine&&c)s.interpolatedValue=c.y;else if(c&&d){var u=(d.y-c.y)/(d.x-c.x);s.interpolatedValue=c.y+(r-c.x)*u}else s.interpolatedValue=NaN}}}};const Xt=(t=1)=>"rgba(48, 166, 51, ".concat(t,")"),Zt=(t=1)=>"rgba(241, 77, 66, ".concat(t,")"),ua="text-[#30a633]",ma="text-[#f14d42]",kf=["1d","5d","1m","6m","ytd","1y","5y","max"];function Cf({histories:t,selectedInterval:e,onSelectHistoryInterval:s}){var o;const a=Object.keys((o=t==null?void 0:t.quotes)!=null?o:{});return n.jsx("div",{className:"text-token-text-tertiary inline-flex items-start justify-between rounded-[10px] bg-[#f4f4f4] p-[3px] text-xs font-semibold sm:justify-start sm:gap-1 dark:bg-[#393939]",children:a.map(r=>n.jsx("button",{onClick:()=>{s==null||s(r)},className:F("border border-transparent px-3 py-1.5 text-xs font-semibold uppercase",e===r?"border-token-border-default! bg-token-main-surface-primary text-token-text-primary shadow-xxs dark:border-token-border-medium! rounded-lg":"hover:text-token-text-secondary"),children:Mo[r].label},r))})}const Mo={"1d":{label:"1D",formatTimestampLabel:fa,formatTimestampTooltip:fa,maxTicksLimit:6,lineTension:.1},"5d":{label:"5D",formatTimestampLabel:ha,formatTimestampTooltip:Nf,maxTicksLimit:6,lineTension:.1},"1m":{label:"1M",formatTimestampLabel:ha,formatTimestampTooltip:Mf,maxTicksLimit:6,lineTension:.1,useUtc:!0},"6m":{label:"6M",formatTimestampLabel:Cs,formatTimestampTooltip:mt,maxTicksLimit:5,lineTension:.1,useUtc:!0},ytd:{label:"YTD",formatTimestampLabel:Cs,formatTimestampTooltip:mt,maxTicksLimit:5,lineTension:.1,useUtc:!0},"1y":{label:"1Y",formatTimestampLabel:Cs,formatTimestampTooltip:mt,maxTicksLimit:5,lineTension:.2,useUtc:!0},"5y":{label:"5Y",formatTimestampLabel:pa,formatTimestampTooltip:mt,maxTicksLimit:5,lineTension:.2,useUtc:!0},max:{label:"max",formatTimestampLabel:pa,formatTimestampTooltip:mt,maxTicksLimit:5,lineTension:.2,useUtc:!0}};function Sf(t){return t?kf.filter(s=>s in t.quotes).find(s=>t.quotes[s].length>0):void 0}function Je(t,e){return gt(new Date(t*1e3),e!=null?e:"America/New_York")}function fa(t,e,s){const a=Je(e,s);return t.formatTime(a,{hour:"numeric",minute:"numeric"})}function Nf(t,e,s){const a=Je(e,s);return t.formatDate(a,{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"numeric"})}function mt(t,e,s){const a=Je(e,s);return t.formatDate(a,{month:"short",day:"numeric",year:"numeric"})}function Cs(t,e,s){const a=Je(e,s);return t.formatDate(a,{month:"short",year:"numeric"})}function ha(t,e,s){const a=Je(e,s);return t.formatDate(a,{month:"short",day:"numeric"})}function Mf(t,e,s){const a=Je(e,s);return t.formatDate(a,{weekday:"short",month:"short",day:"numeric"})}function pa(t,e,s){const a=Je(e,s);return t.formatDate(a,{year:"numeric"})}Cc.register(Sc,Nc,Mc,Tc,Ec,$c,Pc,Ac,Lc,jf,Rc);const Tf=100,ga={color:"#b4b4b4",font:{size:10,weight:"600",family:"Menlo"}};function Ef({isUp:t,histories:e,selectedInterval:s,setHighlightedPrice:a,latestTradingPeriod:o,timezone:r}){return n.jsx(n.Fragment,{children:e&&s&&o?n.jsx($f,{isUp:t,histories:e,selectedInterval:s,latestTradingPeriod:o,timezone:r,setHighlightedPrice:a}):n.jsx(ft,{className:"h-full",index:1,width:100})})}function $f({isUp:t,histories:e,selectedInterval:s,latestTradingPeriod:a,timezone:o,setHighlightedPrice:r}){const[i,l]=f.useState(null),[c,d]=f.useState(!1),u=s==="1d",m=f.useMemo(()=>{let y=e.quotes[s].filter(j=>j.close>=0);if(u&&a){const j=a.regular.start_timestamp,S=a.regular.end_timestamp;if(y=y.filter(g=>g.timestamp>=j&&g.timestamp<=S),y.length===0||y[y.length-1].timestamp<S){let N=y.length>0?y[y.length-1].timestamp:j-600;for(;N<S;)N+=600,y.push({timestamp:N,close:null})}}return y},[e,s,u,a]),x=Mo[s],{formatTimestampTooltip:b,maxTicksLimit:w,useUtc:h=!1}=x,_=K(),v=so(),C=Tt(),k=f.useMemo(()=>{const{formatTimestampLabel:y,lineTension:j}=x;return{labels:m.map(S=>y(_,S.timestamp,h?"UTC":o)),datasets:[{data:m.map(S=>S.close),borderColor:t?Xt():Zt(),pointRadius:0,pointHoverRadius:4,pointStyle:"circle",pointBackgroundColor:t?Xt():Zt(),pointHoverBorderWidth:2,pointHoverBorderColor:"rgba(255, 255, 255, 1)",backgroundColor:function(S){const{ctx:g,chartArea:N}=S.chart;if(N)return Af(g,N,t)},fill:!0,borderWidth:2,lineTension:j!=null?j:.4}]}},[x,m,t,h,o,_]);return n.jsx("div",{className:"flex h-full flex-col gap-6",children:n.jsxs("div",{className:"relative h-full",onMouseEnter:()=>d(!0),onMouseLeave:()=>{d(!1),r(null)},children:[n.jsx(Ic,{options:{responsive:!0,maintainAspectRatio:!1,interaction:{intersect:!1,mode:"index"},hover:{mode:c?"index":"point"},animation:!1,scales:{x:{afterBuildTicks:y=>{if(y.ticks.length>w)if(u)y.ticks=y.ticks.filter((j,S)=>m[S].timestamp%(v?3600:7200)===0);else{const j=Math.ceil(y.ticks.length/(w-1));y.ticks=y.ticks.filter((S,g)=>g>0&&(g%j===0||g===y.ticks.length-1))}},grid:{display:!1},ticks:G(B({},ga),{align:"end"})},y:{ticks:G(B({},ga),{maxTicksLimit:7}),border:{display:!1},grid:{color:C?"rgba(255, 255, 255, 0.1)":"rgba(229, 229, 229, 0.5)"}}},plugins:{datalabels:{display:!1},legend:{display:!1},tooltip:{enabled:!1,animation:!1,displayColors:!1,callbacks:{title:function(y){var g;const j=y[0];if(!j)return"";const S=(g=m[j.dataIndex])==null?void 0:g.timestamp;return S?b(_,S,h?"UTC":o):""}},external:({tooltip:y})=>{var j,S,g,N;c&&y.opacity>0&&r(bt((N=(g=(S=(j=y.dataPoints)==null?void 0:j[0])==null?void 0:S.parsed)==null?void 0:g.y)!=null?N:0)),l(P=>{var R,T,M,p,D;const L=y.chart.width,E=y.caretX>L-Tf;return!P||P.x!==y.caretX||P.y!==y.caretY||P.opacity!==y.opacity||P.flip!==E?G(B({},P),{x:y.caretX,y:y.caretY,dateLabel:(R=y.title)==null?void 0:R[0],value:bt((D=(p=(M=(T=y.dataPoints)==null?void 0:T[0])==null?void 0:M.parsed)==null?void 0:p.y)!=null?D:0),opacity:y.opacity,flip:E}):P})}},dropShadow:!1,crosshair:{line:{color:C?"rgba(255, 255, 255, 0.3)":"rgba(0, 0, 0, 0.3)",width:.5},zoom:{enabled:!1}}}},data:k}),n.jsx(Pf,{tooltipData:i})]})})}function Pf({tooltipData:t}){return!t||!t.opacity?null:n.jsx("div",{style:{left:t.x-5,top:10,transform:"translate(-50%, -50%)"},className:F("text-token-main-surface-primary dark:bg-token-main-surface-secondary pointer-events-none absolute translate-y-[-100%] rounded-lg bg-black px-2 py-1 font-mono font-semibold whitespace-nowrap dark:text-white"),children:n.jsx("div",{className:"text-xs",children:t.dateLabel})})}function Af(t,e,s){const a=t.createLinearGradient(0,e.top,0,e.bottom);return a.addColorStop(0,s?Xt(.4):Zt(.4)),a.addColorStop(1,s?Xt(0):Zt(0)),a}function bt(t){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t)}function Re({label:t,value:e,className:s}){return n.jsxs("div",{className:F("flex w-full flex-1 flex-row justify-between text-sm",s),children:[n.jsx("span",{className:"text-token-text-secondary font-normal whitespace-nowrap",children:t}),n.jsx("span",{className:"text-token-text-primary font-normal whitespace-nowrap",children:e})]})}function Lf({metrics:t}){const e=K(),s=!!(t.marketCap&&t.peRatio&&t.eps);return n.jsx("div",{className:"border-token-border-default flex flex-col gap-1 rounded-b-lg border-t bg-[#f4f4f4] px-4 py-3 dark:bg-[#393939]",children:n.jsxs("div",{className:F("grid grid-cols-2 gap-x-10 gap-y-3 lg:grid-cols-3 lg:gap-x-6"),children:[n.jsx(Re,{label:e.formatMessage({id:"MDHEj7",defaultMessage:"Open"}),value:e.formatNumber(t.openPrice,{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}),className:"order-1"}),n.jsx(Re,{label:e.formatMessage({id:"PboNMC",defaultMessage:"Volume"}),value:e.formatNumber(t.intradayVolume,{notation:"compact",maximumFractionDigits:1}),className:F("order-2",!s&&"lg:order-last")}),n.jsxs("div",{className:"order-4 row-span-2 flex flex-col gap-3",children:[n.jsx(Re,{label:e.formatMessage({id:"bresUW",defaultMessage:"Day Low"}),value:e.formatNumber(t.intradayLow,{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})}),n.jsx(Re,{label:e.formatMessage({id:"oWyv5V",defaultMessage:"Day High"}),value:e.formatNumber(t.intradayHigh,{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})})]}),n.jsxs("div",{className:"order-5 row-span-2 flex flex-col gap-3",children:[n.jsx(Re,{label:e.formatMessage({id:"DcEYIK",defaultMessage:"Year Low"}),value:e.formatNumber(t.fiftyTwoWeekLow,{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})}),n.jsx(Re,{label:e.formatMessage({id:"ZfFtJ4",defaultMessage:"Year High"}),value:e.formatNumber(t.fiftyTwoWeekHigh,{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})})]}),t.marketCap&&n.jsx(Re,{label:e.formatMessage({id:"BzyP4Y",defaultMessage:"Market Cap"}),value:e.formatNumber(t.marketCap,{notation:"compact",maximumFractionDigits:2}),className:"order-last lg:order-3"}),t.peRatio&&t.eps&&n.jsxs(n.Fragment,{children:[n.jsx(Re,{label:e.formatMessage({id:"edGd+S",defaultMessage:"EPS (TTM)"}),value:e.formatNumber(t.eps,{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}),className:"order-last"}),n.jsx(Re,{label:e.formatMessage({id:"AhpCu1",defaultMessage:"P/E Ratio"}),value:e.formatNumber(t.peRatio,{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}),className:"order-last"})]})]})})}function Rf({data:t,priceChange:e,highlightedPrice:s,extendedPriceChange:a,url:o}){var i;function r(l,c="intraday",d=null){const{isUp:u,changePercentage:m,changeLabel:x,changeAmount:b}=l,w=Math.abs(m).toFixed(2),h=bt(b);return n.jsxs("span",{className:"flex min-w-0 items-center gap-1",children:[c==="extended_hours"&&d!=null&&n.jsx("span",{className:"font-semibold",children:n.jsx(z,{id:"HWwWpW",defaultMessage:"{price}",values:{price:d}})}),n.jsx("span",{className:F("font-semibold",u?ua:ma),children:n.jsx(z,{id:"3x4Lkl",defaultMessage:"{sign}{changeAmount}",values:{changeAmount:h,sign:u?"+":""}})}),n.jsx("span",{className:F("font-semibold",u?ua:ma),children:n.jsx(z,{id:"MbfF1T",defaultMessage:"({sign}{changePercentage}%)",values:{changePercentage:w,sign:u?"+":"-"}})}),c==="extended_hours"?n.jsx("span",{className:"text-token-text-primary min-w-0 truncate",children:x}):n.jsx("span",{className:"text-token-text-primary min-w-0 truncate",children:x})]})}return n.jsxs("div",{children:[n.jsx("div",{className:"mt-2 text-sm",children:t?n.jsx(z,{id:"+2WHuv",defaultMessage:"{name} ({ticker})",values:{name:t.asset.name,ticker:t.asset.ticker}}):n.jsx("div",{className:"w-32 font-medium",children:n.jsx(ft,{index:9,width:100})})}),n.jsx("div",{className:"text-token-text-tertiary text-sm",children:t?n.jsx(n.Fragment,{children:o!=null&&n.jsxs(n.Fragment,{children:[" · ",n.jsx($e,{href:o,className:"text-token-link hover:underline",children:ts(o,"hostname")})]})}):n.jsx("div",{className:"mt-2 w-36",children:n.jsx(ft,{index:6,width:100})})}),n.jsx("div",{className:"mt-2 flex text-4xl font-semibold",children:t?n.jsx(z,{id:"s+1uly",defaultMessage:"{price}",values:{price:s!=null?s:bt(t.price.price)}}):n.jsx("div",{className:"w-32",children:n.jsx(ft,{index:0,width:100})})}),n.jsx("div",{className:"mt-2 flex items-center justify-start gap-1 text-sm",children:e?r(e):n.jsx("div",{className:"mt-2 w-40",children:n.jsx(ft,{index:3,width:100})})}),n.jsx("div",{className:"mt-0.5 flex items-center justify-start gap-1 text-sm",children:((i=t==null?void 0:t.price)==null?void 0:i.extended_price)!=null&&a!=null&&r(a,"extended_hours",bt(t.price.extended_price))})]})}function If({contentReference:t,trackContentReferenceEvent:e}){var C,k,y,j,S,g,N,P,L,E,R,T,M,p,D;const s=K();f.useEffect(()=>{e("Search Content Reference Shown","search_content_reference_shown","stock")},[e]);const a=Sf((C=t==null?void 0:t.stock)==null?void 0:C.histories),o=t==null?void 0:t.stock,[r,i]=f.useState(a),[l,c]=f.useState(null),d=r==="1d",u=(j=(y=(k=o==null?void 0:o.histories)==null?void 0:k.quotes)==null?void 0:y[r!=null?r:""])==null?void 0:j[0],m=r&&r in Ht?r:void 0,x=o&&(u&&!d?{changePercentage:(o.price.price-u.close)/u.close*100,changeAmount:o.price.price-u.close,changeLabel:m?s.formatMessage(Ht[m]):"",isUp:o.price.price>u.close}:o.price.change_percent&&o.price.change?{changePercentage:o.price.change_percent*100,changeAmount:o.price.change,changeLabel:Ff(o.price.latest_trade_timestamp,o.asset.timezone,s),isUp:o.price.change?o.price.change>0:!1}:null),b=o&&o.price.extended_price!=null&&o.price.extended_change_percent!=null&&o.price.extended_change!=null?{changePercentage:o.price.extended_change_percent*100,changeAmount:o.price.extended_change,changeLabel:s.formatMessage((S=Df(o.price.market_status))!=null?S:Ht.extended),isUp:o.price.extended_change>0}:null,{fiftyTwoWeekHigh:w,fiftyTwoWeekLow:h}=f.useMemo(()=>{var O;const W=(O=o==null?void 0:o.histories)==null?void 0:O.quotes["1y"];if(!W)return{fiftyTwoWeekHigh:null,fiftyTwoWeekLow:null};const $=W.map(A=>A.high).filter(A=>A!=null),I=W.map(A=>A.low).filter(A=>A!=null);return{fiftyTwoWeekHigh:$.length>0?Math.max(...$):null,fiftyTwoWeekLow:I.length>0?Math.min(...I):null}},[(g=o==null?void 0:o.histories)==null?void 0:g.quotes]),_=o!=null&&o.price.open_price&&o.price.intraday_high&&o.price.intraday_low&&o.price.intraday_volume&&w&&h?{openPrice:o.price.open_price,intradayHigh:o.price.intraday_high,intradayLow:o.price.intraday_low,intradayVolume:o.price.intraday_volume,fiftyTwoWeekHigh:w,fiftyTwoWeekLow:h,marketCap:(P=(N=o.metrics)==null?void 0:N.market_cap)!=null?P:void 0,peRatio:(E=(L=o.metrics)==null?void 0:L.pe_ratio)!=null?E:void 0,eps:(T=(R=o.metrics)==null?void 0:R.eps)!=null?T:void 0}:null,v=_!=null;return n.jsxs("div",{"data-testid":"finance-widget",className:F("border-token-border-default mb-2 flex min-h-[480px] flex-col gap-8 rounded-lg border"),children:[n.jsxs("div",{className:"mx-6 flex flex-wrap items-end justify-between",children:[n.jsx(Rf,{data:o!=null?o:null,highlightedPrice:l,priceChange:x!=null?x:null,extendedPriceChange:b!=null?b:null,url:(M=t==null?void 0:t.url)!=null?M:null}),n.jsx("div",{className:"mt-4",children:n.jsx(Cf,{selectedInterval:r,onSelectHistoryInterval:i,histories:o==null?void 0:o.histories})})]}),n.jsx("div",{className:"mx-6 h-[340px]",children:n.jsx(Ef,{isUp:(p=x==null?void 0:x.isUp)!=null?p:!1,selectedInterval:r,histories:o==null?void 0:o.histories,setHighlightedPrice:c,onSelectHistoryInterval:W=>i(W),latestTradingPeriod:o==null?void 0:o.asset.latest_trading_period,timezone:(D=o==null?void 0:o.asset.timezone)!=null?D:null})}),v&&n.jsx("div",{className:"-mt-4",children:n.jsx(Lf,{metrics:_})})]})}function Df(t){if(t==null)return null;const e=t.toLowerCase();return e==="premarket"||e==="open"?ls({id:"By+pvF",defaultMessage:"Pre-Market"}):e==="afterhours"||e==="closed"?ls({id:"aLCg3c",defaultMessage:"After Hours"}):ls({id:"2p526c",defaultMessage:"Extended Hours"})}function Ff(t,e,s){function a(o,r){const l=gt(new Date,r),c=s.formatDate(l,{year:"numeric",month:"2-digit",day:"2-digit"}),d=kn(o*1e3),u=gt(d,r),m=s.formatDate(u,{year:"numeric",month:"2-digit",day:"2-digit"});return c===m}if(!t||!e||a(t,e))return s.formatMessage(Ht["1d"]);{const o=kn(t*1e3),r=gt(o,e);return s.formatDate(r,{month:"long",day:"numeric"})}}const Ht=Qt({"1d":{id:"SMdcuo",defaultMessage:"Today"},extended:{id:"2p526c",defaultMessage:"Extended Hours"},"5d":{id:"HCA6lr",defaultMessage:"Past 5 days"},"1m":{id:"DJpPMq",defaultMessage:"Past month"},"6m":{id:"1mUJ2L",defaultMessage:"Past 6 months"},ytd:{id:"b9KkhV",defaultMessage:"Year to date"},"1y":{id:"XnvD9A",defaultMessage:"Past year"},"5y":{id:"DfI1RB",defaultMessage:"Past 5 years"},max:{id:"WzOhuU",defaultMessage:"Max"}});function Of({metadata:t,trackContentReferenceEvent:e}){const s=f.useCallback(l=>{e("link_action",null,t.type,{url:t.url,title:t.title,pub_date:null,sub_pill_index:null,link_type:"link_title",action:l})},[t.title,t.type,t.url,e]);f.useEffect(()=>{s("show")},[s]);const[a,o]=f.useState(!1),r=()=>{a||(s("hover"),o(!0))},i=()=>{s("click")};return n.jsx($e,{href:t.url,onClick:i,onMouseEnter:r,onFocus:r,className:"underline",children:t.title})}const Bf={google_maps:{title:"Google Maps"}};function Wf({metadata:t,trackContentReferenceEvent:e}){var a,o;f.useEffect(()=>{e("Search Content Reference Shown","search_content_reference_shown",t.type)},[e,t.type]);const s=(o=(a=Bf[t.provider])==null?void 0:a.title)!=null?o:"Maps";return n.jsx("span",{children:n.jsx(z,{id:"ZSUz1k",defaultMessage:" ({link}) ",values:{link:n.jsx($e,{href:t.url,children:s})}})})}function zf(t){"use forget";const e=ve.c(29),{metadata:s,trackContentReferenceEvent:a,isFirstAssistantContent:o}=t,r=de();let i;e[0]!==r?(i=Nt(r),e[0]=r,e[1]=i):i=e[1];const l=i;let c;e[2]!==r?(c=ss(r),e[2]=r,e[3]=c):c=e[3];const d=c,u=s.items.length>0,m=f.useRef(a);let x,b;e[4]!==a?(x=()=>{m.current=a},b=[a],e[4]=a,e[5]=x,e[6]=b):(x=e[5],b=e[6]),f.useEffect(x,b);let w,h;e[7]!==u?(w=()=>{u&&m.current("Search Content Reference Shown","search_content_reference_shown","nav_list")},h=[u],e[7]=u,e[8]=w,e[9]=h):(w=e[8],h=e[9]),f.useEffect(w,h);let _;e[10]!==a?(_=(E,R)=>{a("link_action",null,"nav_list",G(B({},xa(E,R)),{action:"click"}))},e[10]=a,e[11]=_):_=e[11];const v=_;let C;e[12]!==a?(C=(E,R)=>{a("link_action",null,"nav_list",G(B({},xa(E,R)),{action:"show"}))},e[12]=a,e[13]=C):C=e[13];const k=C,y=l&&o,j=s.title&&!y;if(s.items.length===0)return null;const S=!y&&"mt-6";let g;e[14]!==S?(g=F("mb-1",S),e[14]=S,e[15]=g):g=e[15];let N;e[16]!==s.title||e[17]!==j?(N=j&&n.jsx("div",{className:"text-token-text-primary -mb-1 pb-3 font-semibold",children:s.title}),e[16]=s.title,e[17]=j,e[18]=N):N=e[18];let P;e[19]!==v||e[20]!==k||e[21]!==l||e[22]!==d||e[23]!==s.items?(P=l?n.jsx("div",{className:F("relative mb-6",d?"-mx-[var(--thread-content-margin)]":"-mx-6"),children:n.jsx(Vs,{items:s.items,getItemKey:qf,onRenderItem:Uf,className:"min-h-36",itemClassName:"max-w-[200px] min-w-[120px] sm:max-w-[calc((var(--thread-content-max-width)-2rem)/3)] thread-lg:w-61 w-50 shrink-0",onShown:k,onClick:v})}):n.jsx(ko,{items:s.items,onCardRender:Hf,onCardShown:k,onCardClicked:v,cardClassName:"transition-all duration-200 border-token-border-default hover:border-light border rounded-xl bg-clip-padding hover:shadow-md overflow-hidden"}),e[19]=v,e[20]=k,e[21]=l,e[22]=d,e[23]=s.items,e[24]=P):P=e[24];let L;return e[25]!==g||e[26]!==N||e[27]!==P?(L=n.jsxs("div",{className:g,"data-testid":"nav-list-widget",children:[N,P]}),e[25]=g,e[26]=N,e[27]=P,e[28]=L):L=e[28],L}function Hf(t){return n.jsx(To,{item:t})}function Uf(t){return n.jsx(To,{item:t})}function qf(t){return t.url}function To({item:t}){var i,l;const{isSuccess:e}=$s((i=t.thumbnail_url)!=null?i:void 0,"NavListItem"),s=K(),a=de(),o=Nt(a),r=El(s,t.pub_date);return n.jsxs($e,{className:"flex flex-col items-center gap-4 overflow-hidden pb-6",href:t.url,children:[e&&t.thumbnail_url?n.jsx("div",{className:"relative h-36 w-full overflow-hidden",children:n.jsx("img",{src:t.thumbnail_url,className:"m-0 h-full w-full",style:{objectFit:"cover"},alt:t.title})}):n.jsxs("div",{className:F("icon-bg relative flex h-36 w-full shrink-0 items-center justify-center overflow-hidden",o&&"bg-token-bg-secondary"),children:[n.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-cover bg-center bg-no-repeat blur-3xl",children:n.jsx(pt,{url:t.url,size:256,minSize:128,className:"mix-soft-light opacity-30 dark:opacity-20"})}),n.jsx("div",{className:"absolute flex h-10 w-10 items-center justify-center",children:n.jsx(pt,{url:t.url,size:128,minSize:80,className:"icon-xl rounded-full"})})]}),n.jsxs("div",{className:F("flex flex-col gap-2 overflow-hidden px-4 text-ellipsis",o&&"w-full items-start"),children:[n.jsxs("div",{className:"text-token-text-primary flex items-center gap-1.5 text-xs",children:[n.jsx(pt,{url:t.url,size:32,minSize:16,className:"icon-xs my-0 rounded-full"}),(l=t.attribution)!=null?l:ts(t.url)]}),n.jsx("div",{className:"text-token-text-primary decoration-token-link line-clamp-5 text-sm font-medium",children:t.title}),r&&n.jsx("div",{className:"text-token-text-secondary text-xs",children:r})]})]})}const xa=(t,e)=>({url:t.url,title:t.title,section_index:e,link_type:"text",section:"nav_list",section_location:"response"}),Gf="{{.assetPrefix}}/assets/missing-logo-h96s4tk9.webp",ba={src:Gf};function Eo({team:t,className:e}){var r;const[s,a]=f.useState((r=t.logo)!=null?r:ba.src),o=()=>{dt.addError("Unable to load sports widget logo",{name:t.name,logo:t.logo}),a(ba.src)};return n.jsx("img",{src:s,alt:t.name,className:e,onError:o})}const wt=["ipl"],ya=6,Ve="home",Xe="away";function Vf({scheduleRef:t,trackContentReferenceEvent:e}){var w,h,_,v;const[s,a]=f.useState(!0),o=K(),r=t.games.length>0,i=t.league.id,l=$l(),c=St();if(f.useEffect(()=>{r&&e("Search Content Reference Shown","search_content_reference_shown","sports",{hasSchedule:!0})},[r]),!r)return null;const u=((h=(w=o.formatDateToParts(new Date,{timeZoneName:"long"}).find(C=>C.type==="timeZoneName"))==null?void 0:w.value)!=null?h:Intl.DateTimeFormat().resolvedOptions().timeZone).replace(/Daylight|Standard/g,"");let m=t.games;const x=C=>Math.abs(new Date().getTime()-new Date(C.date).getTime());x(m[0])>x(m[m.length-1])&&(m=m.slice().reverse());const b=s?m.slice(0,ya):m;return n.jsxs("div",{className:"not-prose mb-3","data-testid":"sports-schedule-widget",children:[n.jsx("div",{className:"font-semibold",children:n.jsx(z,{id:"LA6z9q",defaultMessage:"{league} Schedule",values:{league:t.league.display_name}})}),n.jsx("div",{className:"text-token-text-secondary text-sm",children:u}),b.length===1?n.jsx("div",{children:n.jsx(xn,{children:n.jsx(Ut.div,{initial:{opacity:0,y:15},animate:{opacity:1,y:0},exit:{opacity:0,y:-15},transition:{duration:.2},children:n.jsx("div",{className:"border-token-border-medium mt-3 rounded-xl border py-3",children:n.jsx(Zf,{game:b[0],useAlias:wt.includes(i),leagueId:i,activeTeam:(v=(_=b[0])==null?void 0:_.active_team)!=null?v:null,isMobile:c})})})})}):n.jsx("div",{className:"grid grid-cols-1 pt-3 lg:grid-cols-2",children:n.jsx(xn,{children:b.map((C,k)=>{var y;return n.jsx(Ut.div,{initial:{opacity:0,y:15},animate:{opacity:1,y:0,transition:{delay:k*.04}},exit:{opacity:0,y:-15},transition:{duration:.2},children:n.jsx("div",{className:F("border-token-border-medium border-b py-3",k%2===0&&"lg:border-e lg:pe-4",k%2===1&&"lg:ps-4",Math.floor(k/2)===Math.ceil(m.length/2)-1&&"lg:border-b-0",k===m.length-1&&"border-b-0"),children:n.jsx(Xf,{game:C,useAlias:(l||c)&&wt.includes(i),leagueId:i,activeTeam:(y=C.active_team)!=null?y:null})})},k)})})}),m.length>ya&&n.jsx("div",{className:"mt-2 flex items-center justify-between",children:n.jsx("button",{className:"flex items-center text-sm font-semibold",onClick:()=>a(!s),children:s?n.jsx(z,{id:"BH/Ee5",defaultMessage:"Show more {icon}",values:{icon:n.jsx(_i,{className:"mb-[-2px]"})}}):n.jsx(z,{id:"Z9BlEu",defaultMessage:"Show less {icon}",values:{icon:n.jsx(ji,{className:"mb-[-2px]"})}})})})]})}function Xf({game:t,useAlias:e=!1,leagueId:s,activeTeam:a}){var u,m;const o=Po(t),r=[t.first_team_info,t.second_team_info],i=(u=r.find(x=>x.location===Ve))!=null?u:t.first_team_info,l=(m=r.find(x=>x.location===Xe))!=null?m:t.second_team_info,c=(o==null?void 0:o.team.name)===(i==null?void 0:i.team.name),d=(o==null?void 0:o.team.name)===(l==null?void 0:l.team.name);return n.jsxs("div",{className:"flex w-full gap-1.5 py-3 text-base",children:[n.jsxs("div",{className:"flex flex-auto flex-col items-start gap-1 pe-3",children:[n.jsx(Kt,{team:l.team,isWinner:d,isActive:a===Xe,logoSize:"small",useAlias:e}),n.jsx(Kt,{team:i.team,isWinner:c,isActive:a===Ve,logoSize:"small",useAlias:e})]}),n.jsxs("div",{className:F("flex flex-none flex-col items-start gap-1",wt.includes(s)&&"me-4"),children:[n.jsx(Jt,{score:l.score,scoreSuffix:l.score_suffix,scoreParenthetical:l.score_parenthetical?{message:l.score_parenthetical,position:"right"}:null,isWinner:d,negateScore:Yt(s,Xe,a)}),n.jsx(Jt,{score:i.score,scoreSuffix:i.score_suffix,scoreParenthetical:i.score_parenthetical?{message:i.score_parenthetical,position:"right"}:null,isWinner:c,negateScore:Yt(s,Ve,a)})]}),n.jsx("div",{className:"flex min-w-24 flex-none flex-col items-end justify-center gap-1 text-sm",children:n.jsx(Ao,{game:t})})]})}function Zf({game:t,useAlias:e=!1,leagueId:s,activeTeam:a,isMobile:o}){var m,x;const r=Po(t),i=[t.first_team_info,t.second_team_info],l=(m=i.find(b=>b.location===Ve))!=null?m:t.first_team_info,c=(x=i.find(b=>b.location===Xe))!=null?x:t.second_team_info,d=(r==null?void 0:r.team.name)===(l==null?void 0:l.team.name),u=(r==null?void 0:r.team.name)===(c==null?void 0:c.team.name);return n.jsxs("div",{className:"flex w-full py-3 text-base",children:[n.jsx("div",{className:"flex flex-1 items-center justify-center px-2",children:n.jsx(Kt,{team:c.team,isWinner:u,isActive:a===Xe,useAlias:e,layoutDirection:o?"column":"row"})}),n.jsx("div",{className:"ms-2 flex items-center justify-start sm:ms-8",children:n.jsx(Jt,{score:c.score,scoreSuffix:c.score_suffix,scoreParenthetical:c.score_parenthetical?{message:c.score_parenthetical,position:"bottom"}:null,isWinner:u,negateScore:Yt(s,Xe,a),className:"text-sm font-semibold sm:text-lg"})}),n.jsx("div",{className:"mx-2 flex w-24 shrink flex-col items-center justify-center gap-1 align-middle text-sm",children:n.jsx(Ao,{game:t})}),n.jsx("div",{className:"me-2 flex items-center justify-end sm:me-8",children:n.jsx(Jt,{score:l.score,scoreSuffix:l.score_suffix,scoreParenthetical:l.score_parenthetical?{message:l.score_parenthetical,position:"bottom"}:null,isWinner:d,negateScore:Yt(s,Ve,a),className:"text-sm font-semibold sm:text-lg"})}),n.jsx("div",{className:"flex flex-1 items-center justify-center md:px-2",children:n.jsx(Kt,{team:l.team,isWinner:d,isActive:a===Ve,useAlias:e,layoutDirection:o?"column":"row"})})]})}function $o(t){return t.live?"live":new Date(t.date)<new Date?"complete":"scheduled"}function Po(t){return $o(t)!=="complete"||t.first_team_info.score==null||t.second_team_info.score==null?null:t.first_team_info.score>t.second_team_info.score?t.first_team_info:t.second_team_info}function Yt(t,e,s){return wt.includes(t)&&e===Ve&&s===Xe}function Kt({team:t,isWinner:e,isActive:s,logoSize:a,useAlias:o=!1,layoutDirection:r="row"}){return n.jsxs("span",{className:F("flex items-center gap-1",e&&"font-semibold","max-w-64 lg:max-w-52 xl:max-w-64",r==="column"&&"flex-col"),children:[t.logo&&n.jsx(Eo,{team:{name:t.name,logo:t.logo},className:F(a==="small"?"w-6":"w-8")}),n.jsx("span",{className:"truncate",children:o?t.alias:t.name}),s&&n.jsx("span",{className:"bg-token-surface-error inline-block h-2 w-2 rounded-full"})]})}function Jt({score:t,scoreSuffix:e,scoreParenthetical:s,isWinner:a,negateScore:o=!1,className:r}){const i=K();return t==null?null:n.jsxs("span",{className:F(a&&"font-semibold",r),children:[o?i.formatMessage({id:"sports.dash",defaultMessage:"-"}):t,e&&!o&&n.jsx("span",{children:e}),s&&!o&&n.jsx("span",{className:F("text-token-text-secondary font-normal",s.position==="right"&&"ms-1",s.position==="bottom"&&"mx-auto block text-center"),children:"(".concat(s.message,")")})]})}function Ao({game:t}){const e=K();switch($o(t)){case"live":return n.jsxs(n.Fragment,{children:[n.jsx(Yf,{}),n.jsx("div",{children:t.details})]});case"complete":return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"font-semibold",children:n.jsx(z,{id:"q/iMZL",defaultMessage:"Final"})}),n.jsx("div",{className:"text-token-text-secondary",children:As(e,new Date(t.date))})]});case"scheduled":{const s=new Date(t.date);return isNaN(s.getTime())?null:n.jsxs(n.Fragment,{children:[n.jsx("div",{children:As(e,s)}),n.jsx("div",{className:"text-token-text-secondary",children:e.formatDate(s,{timeStyle:"short"})})]})}}}function Yf(){return n.jsx("div",{className:"bg-token-surface-error rounded-[4px] px-1.5 py-1 text-xs font-semibold text-white",children:n.jsx(z,{id:"vObALn",defaultMessage:"Live"})})}function Kf({standingsRef:t,trackContentReferenceEvent:e}){const[s,a]=f.useState(0),o=t.conferences.length>0,r=St(),i=t.league.id;f.useEffect(()=>{o&&e("Search Content Reference Shown","search_content_reference_shown","sports",{hasStandings:!0})},[o]);const l=t.conferences[s],c=t.conferences.length>1?t.conferences.map((d,u)=>n.jsx("button",{className:F(s===u?"text-token-text-primary":"text-token-text-tertiary","text-sm font-semibold"),onClick:()=>a(u),children:d.name},d.name)):null;return n.jsxs("div",{"data-testid":"sports-standings-widget",children:[c&&n.jsx("div",{className:"flex gap-4",children:c}),n.jsx("div",{className:"mt-3",children:l.divisions.map(d=>d.name?n.jsx("div",{className:"mt-3",children:n.jsx(wa,{division:d,teamsColumnHeader:d.name})},d.name):n.jsx(wa,{division:d,useAlias:r&&wt.includes(i)}))})]})}function wa({division:t,teamsColumnHeader:e,useAlias:s}){const a=t.headers.map(o=>o.key);return n.jsxs(we.Root,{size:"compact",className:"not-prose",children:[n.jsxs(we.Header,{children:[n.jsx(Jf,{children:e!=null?e:n.jsx(z,{id:"kKSGje",defaultMessage:"Team"})}),t.headers.map(o=>n.jsx(Lo,{textAlign:"center",className:"min-w-11 px-0!",children:n.jsx(va,{data:o})},o.key))]}),n.jsx(we.Body,{children:t.teams.map(({team:o,data:r},i)=>{const l=r.reduce((c,d)=>(c[d.key]=d,c),{});return n.jsxs(we.Row,{children:[n.jsx(we.Cell,{className:"w-full border-0! py-0! ps-0!",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:"text-token-text-tertiary me-2 w-4 whitespace-nowrap tabular-nums",children:i+1}),n.jsxs("div",{className:"flex items-center justify-start gap-2",children:[n.jsx(Eo,{team:o,className:"w-6"}),n.jsx("span",{className:"text-base whitespace-nowrap",children:s?o.alias:o.name})]})]})}),a.map(c=>n.jsx(we.Cell,{className:"min-w-11 border-0! px-0! py-0! text-start whitespace-nowrap tabular-nums",textAlign:"center",children:n.jsx(va,{data:l[c]})},c))]},o.name)})})]})}function va({data:t}){switch(t.type){case"text":return n.jsx(n.Fragment,{children:t.text});default:return n.jsx(n.Fragment,{children:t.alt})}}var Sa;const Lo=en(we.HeaderCell)(Sa||(Sa=ut(["text-token-text-secondary font-normal! text-sm static! bg-transparent! border-token-border-default! border-t-0! border-s-0! border-e-0!"])));var Na;const Jf=en(Lo)(Na||(Na=ut(["text-token-text-primary ps-0!"])));function Qf({metadata:t,trackContentReferenceEvent:e}){f.useEffect(()=>{e("Search Content Reference Shown","search_content_reference_shown",t.type)},[e,t.type]);const s=K(),a=gt(t.utc_time,t.utc_offset),o=s.formatDate(a,{hour:"numeric",minute:"numeric"});return n.jsx("span",{children:o})}function eh({metadata:t,trackContentReferenceEvent:e}){return f.useEffect(()=>{e("Search Content Reference Shown","search_content_reference_shown",t.type)},[e,t.type]),n.jsx("div",{children:t.url?n.jsx(ki,{webpageItem:{url:t.url,title:t.description,pub_date:null,snippet:"",attributions:null},className:"inline-flex flex-col",children:n.jsx($e,{href:t.url,className:"font-semibold!",children:t.description})}):n.jsx("div",{className:"font-semibold!",children:t.description})})}function th({videoId:t,title:e="YouTube video player",fallbackText:s,cookieLess:a=!0,timeoutMs:o=5e3,className:r=""}){const i=f.useRef(null),l=f.useRef(null),c=f.useRef(!1),[d,u]=f.useState("idle"),m=()=>{c.current=!0,l.current&&(clearTimeout(l.current),l.current=null)};if(f.useEffect(()=>{u("loading"),c.current=!1;let b=null;return sh().then(()=>{if(!i.current)return;i.current.textContent="",b=document.createElement("div"),b.style.width="200px",b.style.height="150px",i.current.appendChild(b),l.current=window.setTimeout(()=>{c.current||u("timeout")},o);const w=a?"https://www.youtube-nocookie.com":"https://www.youtube.com";new window.YT.Player(b,{width:200,height:150,videoId:t,host:w,playerVars:{rel:0,playsinline:1,origin:window.location.origin},events:{onReady:()=>{m(),u("ready")},onError:()=>{m(),u("error")}}})}).catch(()=>u("error")),()=>{m()}},[t,a,o]),d==="error"||d==="timeout")return n.jsx("a",{href:"https://www.youtube.com/watch?v=".concat(t),target:"_blank",rel:"noopener noreferrer",children:s});const x=a?"https://www.youtube-nocookie.com":"https://www.youtube.com";return n.jsxs(n.Fragment,{children:[n.jsx("div",{ref:i,"aria-hidden":!0,inert:!0,className:"hidden"}),n.jsx("iframe",{src:"".concat(x,"/embed/").concat(t),allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerPolicy:"strict-origin-when-cross-origin",allowFullScreen:!0,className:r,title:e})]})}function sh(){return new Promise(t=>{var s;if((s=window.YT)!=null&&s.Player)return t();const e=window.onYouTubeIframeAPIReady;if(window.onYouTubeIframeAPIReady=()=>{e==null||e(),t(),window.onYouTubeIframeAPIReady=e||(()=>{})},!document.querySelector("script[src*='youtube.com/iframe_api']")){const a=document.createElement("script");a.src="https://www.youtube.com/iframe_api",document.head.appendChild(a)}})}function nh({url:t,className:e,iframeClassName:s,iframeTitle:a}){let o;const r=F("aspect-video w-full",s),i=ah(t);i&&(o=n.jsx(th,{className:r,videoId:i,title:a,fallbackText:a!=null?a:n.jsx(z,{id:"sonic.video.youtube.title",defaultMessage:"YouTube video link"}),cookieLess:!1}));const l=oh(t);return l&&(o=n.jsx(rh,{videoId:l,className:r,iframeTitle:a})),o?n.jsx("div",{className:e,children:o}):null}function ah(t){const e=/^(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/(?:watch\?v=|shorts\/|embed\/|v\/|live\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/,s=t.match(e);return s?s[1]:null}function oh(t){const e=/vimeo\.com\/(?:channels\/(?:\w+\/)?|groups\/[^/]+\/videos\/|video\/|)(\d+)/,s=t.match(e);return s?s[1]:null}function rh({videoId:t,className:e,iframeTitle:s}){return n.jsx(n.Fragment,{children:n.jsx("iframe",{className:e,src:"https://player.vimeo.com/video/".concat(t),frameBorder:"0",allow:"autoplay; fullscreen; picture-in-picture",allowFullScreen:!0,title:s})})}function ih({video:t,trackContentReferenceEvent:e}){const s={url:t.url,title:t.title};return f.useEffect(()=>{e("Search Content Reference Shown","search_content_reference_shown",t.type,s)},[]),t.url==null||t.url===""?null:n.jsx("div",{className:"not-prose mb-3 flex flex-col gap-4 text-base","data-testid":"video-widget",children:n.jsx(nh,{url:t.url,iframeClassName:"rounded-lg"})})}const lh="webp",ch=96,dh=96,uh="srgb",mh=4,fh="uchar",hh=288,ph=!1,gh=!1,xh=!0,bh="{{.assetPrefix}}/assets/cloud-foggy-o4a3hmky.webp",yh={format:lh,width:ch,height:dh,space:uh,channels:mh,depth:fh,density:hh,isProgressive:ph,hasProfile:gh,hasAlpha:xh,src:bh},wh="webp",vh=96,_h=96,jh="srgb",kh=4,Ch="uchar",Sh=288,Nh=!1,Mh=!1,Th=!0,Eh="{{.assetPrefix}}/assets/cloudy-co8vwrk7.webp",$h={format:wh,width:vh,height:_h,space:jh,channels:kh,depth:Ch,density:Sh,isProgressive:Nh,hasProfile:Mh,hasAlpha:Th,src:Eh},Ph="webp",Ah=96,Lh=96,Rh="srgb",Ih=4,Dh="uchar",Fh=288,Oh=!1,Bh=!1,Wh=!0,zh="{{.assetPrefix}}/assets/heavy-snow-mke52kag.webp",Hh={format:Ph,width:Ah,height:Lh,space:Rh,channels:Ih,depth:Dh,density:Fh,isProgressive:Oh,hasProfile:Bh,hasAlpha:Wh,src:zh},Uh="webp",qh=96,Gh=96,Vh="srgb",Xh=4,Zh="uchar",Yh=288,Kh=!1,Jh=!1,Qh=!0,ep="{{.assetPrefix}}/assets/light-snow-mcy1l7t9.webp",tp={format:Uh,width:qh,height:Gh,space:Vh,channels:Xh,depth:Zh,density:Yh,isProgressive:Kh,hasProfile:Jh,hasAlpha:Qh,src:ep},sp="webp",np=96,ap=96,op="srgb",rp=4,ip="uchar",lp=288,cp=!1,dp=!1,up=!0,mp="{{.assetPrefix}}/assets/moon-drizzle-cplxr2ub.webp",fp={format:sp,width:np,height:ap,space:op,channels:rp,depth:ip,density:lp,isProgressive:cp,hasProfile:dp,hasAlpha:up,src:mp},hp="webp",pp=96,gp=96,xp="srgb",bp=4,yp="uchar",wp=288,vp=!1,_p=!1,jp=!0,kp="{{.assetPrefix}}/assets/moon-hazy-jvgt25bp.webp",Cp={format:hp,width:pp,height:gp,space:xp,channels:bp,depth:yp,density:wp,isProgressive:vp,hasProfile:_p,hasAlpha:jp,src:kp},Sp="webp",Np=96,Mp=96,Tp="srgb",Ep=4,$p="uchar",Pp=288,Ap=!1,Lp=!1,Rp=!0,Ip="{{.assetPrefix}}/assets/moon-mostly-cloudy-cia3do0v.webp",Dp={format:Sp,width:Np,height:Mp,space:Tp,channels:Ep,depth:$p,density:Pp,isProgressive:Ap,hasProfile:Lp,hasAlpha:Rp,src:Ip},Fp="webp",Op=96,Bp=96,Wp="srgb",zp=4,Hp="uchar",Up=288,qp=!1,Gp=!1,Vp=!0,Xp="{{.assetPrefix}}/assets/moon-mostly-sunny-n3mh1b6a.webp",Zp={format:Fp,width:Op,height:Bp,space:Wp,channels:zp,depth:Hp,density:Up,isProgressive:qp,hasProfile:Gp,hasAlpha:Vp,src:Xp},Yp="webp",Kp=96,Jp=96,Qp="srgb",eg=4,tg="uchar",sg=288,ng=!1,ag=!1,og=!0,rg="{{.assetPrefix}}/assets/moon-shower-ntzhti9o.webp",ig={format:Yp,width:Kp,height:Jp,space:Qp,channels:eg,depth:tg,density:sg,isProgressive:ng,hasProfile:ag,hasAlpha:og,src:rg},lg="webp",cg=96,dg=96,ug="srgb",mg=4,fg="uchar",hg=288,pg=!1,gg=!1,xg=!0,bg="{{.assetPrefix}}/assets/moon-sunny-eg2emh4d.webp",yg={format:lg,width:cg,height:dg,space:ug,channels:mg,depth:fg,density:hg,isProgressive:pg,hasProfile:gg,hasAlpha:xg,src:bg},wg="webp",vg=96,_g=96,jg="srgb",kg=4,Cg="uchar",Sg=288,Ng=!1,Mg=!1,Tg=!0,Eg="{{.assetPrefix}}/assets/rain-thunder-bx7a0l5g.webp",$g={format:wg,width:vg,height:_g,space:jg,channels:kg,depth:Cg,density:Sg,isProgressive:Ng,hasProfile:Mg,hasAlpha:Tg,src:Eg},Pg="webp",Ag=96,Lg=96,Rg="srgb",Ig=4,Dg="uchar",Fg=288,Og=!1,Bg=!1,Wg=!0,zg="{{.assetPrefix}}/assets/rain-cxs76xuj.webp",Hg={format:Pg,width:Ag,height:Lg,space:Rg,channels:Ig,depth:Dg,density:Fg,isProgressive:Og,hasProfile:Bg,hasAlpha:Wg,src:zg},Ug="webp",qg=96,Gg=96,Vg="srgb",Xg=4,Zg="uchar",Yg=288,Kg=!1,Jg=!1,Qg=!0,ex="{{.assetPrefix}}/assets/sleet-gc63vwmo.webp",tx={format:Ug,width:qg,height:Gg,space:Vg,channels:Xg,depth:Zg,density:Yg,isProgressive:Kg,hasProfile:Jg,hasAlpha:Qg,src:ex},sx="webp",nx=96,ax=96,ox="srgb",rx=4,ix="uchar",lx=288,cx=!1,dx=!1,ux=!0,mx="{{.assetPrefix}}/assets/snow-d0k6tmmc.webp",fx={format:sx,width:nx,height:ax,space:ox,channels:rx,depth:ix,density:lx,isProgressive:cx,hasProfile:dx,hasAlpha:ux,src:mx},hx="webp",px=96,gx=96,xx="srgb",bx=4,yx="uchar",wx=288,vx=!1,_x=!1,jx=!0,kx="{{.assetPrefix}}/assets/sun-drizzle-g94obr5e.webp",Cx={format:hx,width:px,height:gx,space:xx,channels:bx,depth:yx,density:wx,isProgressive:vx,hasProfile:_x,hasAlpha:jx,src:kx},Sx="webp",Nx=96,Mx=96,Tx="srgb",Ex=4,$x="uchar",Px=288,Ax=!1,Lx=!1,Rx=!0,Ix="{{.assetPrefix}}/assets/sun-hazy-c3z1j0hy.webp",Dx={format:Sx,width:Nx,height:Mx,space:Tx,channels:Ex,depth:$x,density:Px,isProgressive:Ax,hasProfile:Lx,hasAlpha:Rx,src:Ix},Fx="webp",Ox=96,Bx=96,Wx="srgb",zx=4,Hx="uchar",Ux=288,qx=!1,Gx=!1,Vx=!0,Xx="{{.assetPrefix}}/assets/sun-mostly-cloudy-d4o4zkga.webp",Zx={format:Fx,width:Ox,height:Bx,space:Wx,channels:zx,depth:Hx,density:Ux,isProgressive:qx,hasProfile:Gx,hasAlpha:Vx,src:Xx},Yx="webp",Kx=96,Jx=96,Qx="srgb",e1=4,t1="uchar",s1=288,n1=!1,a1=!1,o1=!0,r1="{{.assetPrefix}}/assets/sun-mostly-sunny-livrdkgu.webp",i1={format:Yx,width:Kx,height:Jx,space:Qx,channels:e1,depth:t1,density:s1,isProgressive:n1,hasProfile:a1,hasAlpha:o1,src:r1},l1="webp",c1=96,d1=96,u1="srgb",m1=4,f1="uchar",h1=288,p1=!1,g1=!1,x1=!0,b1="{{.assetPrefix}}/assets/sun-shower-lvtjthah.webp",y1={format:l1,width:c1,height:d1,space:u1,channels:m1,depth:f1,density:h1,isProgressive:p1,hasProfile:g1,hasAlpha:x1,src:b1},w1="webp",v1=96,_1=96,j1="srgb",k1=4,C1="uchar",S1=288,N1=!1,M1=!1,T1=!0,E1="{{.assetPrefix}}/assets/sun-sunny-kqjpjzd8.webp",$1={format:w1,width:v1,height:_1,space:j1,channels:k1,depth:C1,density:S1,isProgressive:N1,hasProfile:M1,hasAlpha:T1,src:E1},P1="webp",A1=96,L1=96,R1="srgb",I1=4,D1="uchar",F1=288,O1=!1,B1=!1,W1=!0,z1="{{.assetPrefix}}/assets/thunder-jgjqg9ai.webp",H1={format:P1,width:A1,height:L1,space:R1,channels:I1,depth:D1,density:F1,isProgressive:O1,hasProfile:B1,hasAlpha:W1,src:z1},U1="webp",q1=96,G1=96,V1="srgb",X1=4,Z1="uchar",Y1=288,K1=!1,J1=!1,Q1=!0,e0="{{.assetPrefix}}/assets/tornado-opa24tq3.webp",t0={format:U1,width:q1,height:G1,space:V1,channels:X1,depth:Z1,density:Y1,isProgressive:K1,hasProfile:J1,hasAlpha:Q1,src:e0},s0="webp",n0=96,a0=96,o0="srgb",r0=4,i0="uchar",l0=288,c0=!1,d0=!1,u0=!0,m0="{{.assetPrefix}}/assets/windy-mw0a3u21.webp",f0={format:s0,width:n0,height:a0,space:o0,channels:r0,depth:i0,density:l0,isProgressive:c0,hasProfile:d0,hasAlpha:u0,src:m0},h0="webp",p0=96,g0=96,x0="srgb",b0=4,y0="uchar",w0=288,v0=!1,_0=!1,j0=!0,k0="{{.assetPrefix}}/assets/cloud-foggy-fhg0jn0w.webp",C0={format:h0,width:p0,height:g0,space:x0,channels:b0,depth:y0,density:w0,isProgressive:v0,hasProfile:_0,hasAlpha:j0,src:k0},S0="webp",N0=96,M0=96,T0="srgb",E0=4,$0="uchar",P0=288,A0=!1,L0=!1,R0=!0,I0="{{.assetPrefix}}/assets/cloudy-disd26f3.webp",D0={format:S0,width:N0,height:M0,space:T0,channels:E0,depth:$0,density:P0,isProgressive:A0,hasProfile:L0,hasAlpha:R0,src:I0},F0="webp",O0=96,B0=96,W0="srgb",z0=4,H0="uchar",U0=288,q0=!1,G0=!1,V0=!0,X0="{{.assetPrefix}}/assets/heavy-snow-g6jjwo2d.webp",Z0={format:F0,width:O0,height:B0,space:W0,channels:z0,depth:H0,density:U0,isProgressive:q0,hasProfile:G0,hasAlpha:V0,src:X0},Y0="webp",K0=96,J0=96,Q0="srgb",eb=4,tb="uchar",sb=288,nb=!1,ab=!1,ob=!0,rb="{{.assetPrefix}}/assets/light-snow-iz0efpkh.webp",ib={format:Y0,width:K0,height:J0,space:Q0,channels:eb,depth:tb,density:sb,isProgressive:nb,hasProfile:ab,hasAlpha:ob,src:rb},lb="webp",cb=96,db=96,ub="srgb",mb=4,fb="uchar",hb=288,pb=!1,gb=!1,xb=!0,bb="{{.assetPrefix}}/assets/moon-drizzle-b1nfv39c.webp",yb={format:lb,width:cb,height:db,space:ub,channels:mb,depth:fb,density:hb,isProgressive:pb,hasProfile:gb,hasAlpha:xb,src:bb},wb="webp",vb=96,_b=96,jb="srgb",kb=4,Cb="uchar",Sb=288,Nb=!1,Mb=!1,Tb=!0,Eb="{{.assetPrefix}}/assets/moon-hazy-nfnzea7a.webp",$b={format:wb,width:vb,height:_b,space:jb,channels:kb,depth:Cb,density:Sb,isProgressive:Nb,hasProfile:Mb,hasAlpha:Tb,src:Eb},Pb="webp",Ab=96,Lb=96,Rb="srgb",Ib=4,Db="uchar",Fb=288,Ob=!1,Bb=!1,Wb=!0,zb="{{.assetPrefix}}/assets/moon-mostly-cloudy-e56e3z55.webp",Hb={format:Pb,width:Ab,height:Lb,space:Rb,channels:Ib,depth:Db,density:Fb,isProgressive:Ob,hasProfile:Bb,hasAlpha:Wb,src:zb},Ub="webp",qb=96,Gb=96,Vb="srgb",Xb=4,Zb="uchar",Yb=288,Kb=!1,Jb=!1,Qb=!0,ey="{{.assetPrefix}}/assets/moon-mostly-sunny-ffu4gzf4.webp",ty={format:Ub,width:qb,height:Gb,space:Vb,channels:Xb,depth:Zb,density:Yb,isProgressive:Kb,hasProfile:Jb,hasAlpha:Qb,src:ey},sy="webp",ny=96,ay=96,oy="srgb",ry=4,iy="uchar",ly=288,cy=!1,dy=!1,uy=!0,my="{{.assetPrefix}}/assets/moon-shower-e5dy9u48.webp",fy={format:sy,width:ny,height:ay,space:oy,channels:ry,depth:iy,density:ly,isProgressive:cy,hasProfile:dy,hasAlpha:uy,src:my},hy="webp",py=96,gy=96,xy="srgb",by=4,yy="uchar",wy=288,vy=!1,_y=!1,jy=!0,ky="{{.assetPrefix}}/assets/moon-sunny-d9o08xiw.webp",Cy={format:hy,width:py,height:gy,space:xy,channels:by,depth:yy,density:wy,isProgressive:vy,hasProfile:_y,hasAlpha:jy,src:ky},Sy="webp",Ny=96,My=96,Ty="srgb",Ey=4,$y="uchar",Py=288,Ay=!1,Ly=!1,Ry=!0,Iy="{{.assetPrefix}}/assets/rain-thunder-eplemvu1.webp",Dy={format:Sy,width:Ny,height:My,space:Ty,channels:Ey,depth:$y,density:Py,isProgressive:Ay,hasProfile:Ly,hasAlpha:Ry,src:Iy},Fy="webp",Oy=96,By=96,Wy="srgb",zy=4,Hy="uchar",Uy=288,qy=!1,Gy=!1,Vy=!0,Xy="{{.assetPrefix}}/assets/rain-ogayr6kt.webp",Zy={format:Fy,width:Oy,height:By,space:Wy,channels:zy,depth:Hy,density:Uy,isProgressive:qy,hasProfile:Gy,hasAlpha:Vy,src:Xy},Yy="webp",Ky=96,Jy=96,Qy="srgb",ew=4,tw="uchar",sw=288,nw=!1,aw=!1,ow=!0,rw="{{.assetPrefix}}/assets/sleet-o8noil7l.webp",iw={format:Yy,width:Ky,height:Jy,space:Qy,channels:ew,depth:tw,density:sw,isProgressive:nw,hasProfile:aw,hasAlpha:ow,src:rw},lw="webp",cw=96,dw=96,uw="srgb",mw=4,fw="uchar",hw=288,pw=!1,gw=!1,xw=!0,bw="{{.assetPrefix}}/assets/snow-lq4cl3uc.webp",yw={format:lw,width:cw,height:dw,space:uw,channels:mw,depth:fw,density:hw,isProgressive:pw,hasProfile:gw,hasAlpha:xw,src:bw},ww="webp",vw=96,_w=96,jw="srgb",kw=4,Cw="uchar",Sw=288,Nw=!1,Mw=!1,Tw=!0,Ew="{{.assetPrefix}}/assets/sun-drizzle-htsohv65.webp",$w={format:ww,width:vw,height:_w,space:jw,channels:kw,depth:Cw,density:Sw,isProgressive:Nw,hasProfile:Mw,hasAlpha:Tw,src:Ew},Pw="webp",Aw=96,Lw=96,Rw="srgb",Iw=4,Dw="uchar",Fw=288,Ow=!1,Bw=!1,Ww=!0,zw="{{.assetPrefix}}/assets/sun-hazy-nfj7clcd.webp",Hw={format:Pw,width:Aw,height:Lw,space:Rw,channels:Iw,depth:Dw,density:Fw,isProgressive:Ow,hasProfile:Bw,hasAlpha:Ww,src:zw},Uw="webp",qw=96,Gw=96,Vw="srgb",Xw=4,Zw="uchar",Yw=288,Kw=!1,Jw=!1,Qw=!0,ev="{{.assetPrefix}}/assets/sun-mostly-cloudy-e3pqqgs7.webp",tv={format:Uw,width:qw,height:Gw,space:Vw,channels:Xw,depth:Zw,density:Yw,isProgressive:Kw,hasProfile:Jw,hasAlpha:Qw,src:ev},sv="webp",nv=96,av=96,ov="srgb",rv=4,iv="uchar",lv=288,cv=!1,dv=!1,uv=!0,mv="{{.assetPrefix}}/assets/sun-mostly-sunny-o99k1c7a.webp",fv={format:sv,width:nv,height:av,space:ov,channels:rv,depth:iv,density:lv,isProgressive:cv,hasProfile:dv,hasAlpha:uv,src:mv},hv="webp",pv=96,gv=96,xv="srgb",bv=4,yv="uchar",wv=288,vv=!1,_v=!1,jv=!0,kv="{{.assetPrefix}}/assets/sun-shower-ldwl4jbp.webp",Cv={format:hv,width:pv,height:gv,space:xv,channels:bv,depth:yv,density:wv,isProgressive:vv,hasProfile:_v,hasAlpha:jv,src:kv},Sv="webp",Nv=96,Mv=96,Tv="srgb",Ev=4,$v="uchar",Pv=288,Av=!1,Lv=!1,Rv=!0,Iv="{{.assetPrefix}}/assets/sun-sunny-kqjpjzd8.webp",Dv={format:Sv,width:Nv,height:Mv,space:Tv,channels:Ev,depth:$v,density:Pv,isProgressive:Av,hasProfile:Lv,hasAlpha:Rv,src:Iv},Fv="webp",Ov=96,Bv=96,Wv="srgb",zv=4,Hv="uchar",Uv=288,qv=!1,Gv=!1,Vv=!0,Xv="{{.assetPrefix}}/assets/thunder-xzn1cku3.webp",Zv={format:Fv,width:Ov,height:Bv,space:Wv,channels:zv,depth:Hv,density:Uv,isProgressive:qv,hasProfile:Gv,hasAlpha:Vv,src:Xv},Yv="webp",Kv=96,Jv=96,Qv="srgb",e_=4,t_="uchar",s_=288,n_=!1,a_=!1,o_=!0,r_="{{.assetPrefix}}/assets/tornado-diqu61wg.webp",i_={format:Yv,width:Kv,height:Jv,space:Qv,channels:e_,depth:t_,density:s_,isProgressive:n_,hasProfile:a_,hasAlpha:o_,src:r_},l_="webp",c_=96,d_=96,u_="srgb",m_=4,f_="uchar",h_=288,p_=!1,g_=!1,x_=!0,b_="{{.assetPrefix}}/assets/windy-n2v8wtyp.webp",y_={format:l_,width:c_,height:d_,space:u_,channels:m_,depth:f_,density:h_,isProgressive:p_,hasProfile:g_,hasAlpha:x_,src:b_},w_={foggy:{default:yh},cloudy:{default:$h},"heavy-snow":{default:Hh},"light-snow":{default:tp},sleet:{default:tx},drizzle:{default:Cx,night:fp},hazy:{default:Dx,night:Cp},"mostly-cloudy":{default:Zx,night:Dp},"mostly-sunny":{default:i1,night:Zp},shower:{default:y1,night:ig},sunny:{default:$1,night:yg},"rain-thunder":{default:$g},rain:{default:Hg},snow:{default:fx},thunder:{default:H1},tornado:{default:t0},windy:{default:f0}},v_={foggy:{default:C0},cloudy:{default:D0},"heavy-snow":{default:Z0},"light-snow":{default:ib},sleet:{default:iw},drizzle:{default:$w,night:yb},hazy:{default:Hw,night:$b},"mostly-cloudy":{default:tv,night:Hb},"mostly-sunny":{default:fv,night:ty},shower:{default:Cv,night:fy},sunny:{default:Dv,night:Cy},"rain-thunder":{default:Dy},rain:{default:Zy},snow:{default:yw},thunder:{default:Zv},tornado:{default:i_},windy:{default:y_}};function __({weatherCode:t,isDarkMode:e,isNight:s}){const a=e?v_:w_,o=j_(t),r=a[o];return r.night&&s?r.night:r.default}function j_(t){switch(t){case 1:case 33:return"sunny";case 2:case 3:case 34:case 35:case 36:return"mostly-sunny";case 4:case 6:case 13:case 14:case 38:return"mostly-cloudy";case 5:case 37:return"hazy";case 7:case 8:return"cloudy";case 11:return"foggy";case 12:case 39:case 40:return"shower";case 15:case 16:case 17:case 41:case 42:return"thunder";case 18:return"rain";case 19:case 20:case 21:case 43:return"light-snow";case 22:case 23:case 44:return"snow";case 24:case 25:case 26:case 29:return"sleet";case 32:return"windy";default:return"cloudy"}}const k_="C";function C_(t,e){return Math.round(t==="F"?e*9/5+32:(e-32)*5/9)}function _a(t,e,s=k_){return t===s?"".concat(Math.round(e),"°"):"".concat(C_(t,e),"°")}const S_=7,ja=8,N_=f.memo(function({weatherResults:e,dateRange:s,turnIndex:a,trackContentReferenceEvent:o}){const[r,i]=F_(),l=E_(e);f.useEffect(()=>{o("Search Content Reference Shown","search_content_reference_shown","forecast")},[o]);const{daily:c,hourly:d,historical:u}=e;let m="daily";if(s||d&&c.length<2)m="hourly";else if(c.length>0)m="daily";else if(u&&(u==null?void 0:u.length)>0)m="historical";else return null;return n.jsxs("div",{className:"relative","data-testid":"weather-widget",children:[l?n.jsxs(n.Fragment,{children:[n.jsx(T_,{weatherResults:e}),n.jsx($_,{weatherResults:e,temperatureUnit:r,setTemperatureUnit:i})]}):n.jsx("div",{className:"bg-token-main-surface-primary absolute end-0 top-3 z-10 rounded-sm",children:n.jsx(Ro,{onTemperatureUnitChange:i,temperatureUnit:r})}),n.jsx(R_,{turnIndex:a}),m==="hourly"&&n.jsx(P_,{weatherResults:e,temperatureUnit:r,dateRange:s}),m==="daily"&&n.jsx(A_,{dailyForecast:c.slice(0,S_),temperatureUnit:r}),m==="historical"&&n.jsx(L_,{historical:u,temperatureUnit:r})]})});function M_({weatherAlert:t}){const[e,s]=f.useState(!1),a=K(),o=so(),r=Be(t.start_timestamp,t.utc_offset_sec),i=t.end_timestamp?Be(t.end_timestamp,t.utc_offset_sec):null,l=n.jsxs(n.Fragment,{children:[n.jsx("div",{children:n.jsx(z,{id:"JnuGPS",defaultMessage:"{start}{separator}{end}",values:{start:a.formatDate(r,{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"numeric"}),separator:i?" - ":"",end:i?a.formatDate(i,{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"numeric"}):""}})}),n.jsx("div",{children:t.summary})]});return n.jsxs("button",{className:"my-2 flex w-full flex-col gap-2 rounded-xl border border-red-200 bg-red-100 px-4 py-3 text-start text-sm text-red-800",onClick:()=>s(!e),children:[n.jsxs("div",{className:"flex w-full items-center gap-4",children:[n.jsx(Ll,{className:"h-9 w-9 shrink-0"}),n.jsxs("div",{className:"flex flex-col",children:[n.jsx("div",{className:"font-bold",children:n.jsx(z,{id:"y+fy/l",defaultMessage:"Severe Weather: {name}",values:{name:t.name}})}),o&&l]}),n.jsx("div",{className:"grow"}),n.jsx("div",{className:"opacity-30",children:e?n.jsx(Fc,{className:"icon-lg"}):n.jsx(Dc,{className:"icon-lg"})})]}),e&&t.details&&n.jsxs(n.Fragment,{children:[!o&&l,n.jsx("div",{className:"mt-1 whitespace-pre-wrap",children:t.details.trim()})]})]})}function T_({weatherResults:t}){const{severe:e}=t;return e?n.jsx("div",{className:"my-2",children:e.map((s,a)=>n.jsx(M_,{weatherAlert:s},a))}):null}function E_(t){const{historical:e,daily:s,hourly:a,current:o}=t;if(!o)return!1;let r=!1;const i=Be(o.timestamp,o.utc_offset_sec);for(const l of[e,s,a])l&&(r=r||(l==null?void 0:l.some(c=>Al(i,Be(c.timestamp,c.utc_offset_sec)))));return r}function $_({weatherResults:t,temperatureUnit:e,setTemperatureUnit:s}){const a=K(),{current:o}=t;if(!o)return null;const r=o.temperature.current,i=o.description,l=r!=null&&i&&" · ";return n.jsxs("div",{className:"not-prose flex items-center gap-4",children:[n.jsxs("div",{className:"grow",children:[n.jsxs("div",{className:"text-lg font-semibold",children:[r!=null&&n.jsx(z,{id:"FiwByI",defaultMessage:"Currently {temperature}",values:{temperature:Ze(a,r,e)}}),l,i.description]}),n.jsx("div",{className:"text-token-text-secondary",children:D_(t.location)})]}),n.jsxs("div",{className:"flex",children:[n.jsx(Ro,{onTemperatureUnitChange:s,temperatureUnit:e}),n.jsx(cn,{weatherDescriptionData:i,isNight:o.night})]})]})}function ln({children:t}){return n.jsx("div",{className:"no-scrollbar not-prose mt-1 overflow-auto sm:overflow-hidden",children:n.jsx(we.Root,{className:"min-w-0",children:n.jsx(we.Body,{className:"border-token-border-medium border-b-[0.5px] [&_tr:last-child]:border-b-0",children:t})})})}function P_({weatherResults:t,temperatureUnit:e,dateRange:s}){const a=K(),{hourly:o,current:r}=t;let i=o!=null?o:[];s&&(i=i.filter(u=>u.timestamp>=s.start_timestamp&&u.timestamp<s.end_timestamp));const[l,c]=f.useState(!1),d=i.length>ja;if(!l&&d){const u=i[0],m=Be(u.timestamp,u.utc_offset_sec);let x=!1;if(r){const b=Be(r.timestamp,r.utc_offset_sec);m.getTime()-b.getTime()>8*60*60*1e3&&i.length>18&&(i=i.slice(7,18),x=!0)}x||(i=i.slice(0,ja))}return n.jsxs(ln,{children:[i.map((u,m)=>n.jsxs(we.Row,{children:[n.jsxs(Te,{className:"w-44",children:[n.jsx(cn,{weatherDescriptionData:u.description,isNight:u.night,size:"small"}),n.jsx("div",{className:"ms-3 whitespace-nowrap",children:n.jsx("span",{className:"lowercase",children:I_(a,u)})})]}),n.jsx(Te,{className:"w-[60px] tabular-nums",children:n.jsx("div",{children:Ze(a,u.temperature.current,e)})}),n.jsx(Te,{children:u.description.description})]},m)),d&&n.jsx(we.Row,{children:n.jsx(Te,{className:"w-44",children:n.jsx(Se,{color:"secondary",onClick:()=>c(!l),size:"small",children:l?n.jsx(z,{id:"KoC8Ym",defaultMessage:"Show less"}):n.jsx(z,{id:"X8F8Y/",defaultMessage:"Show more"})})})})]})}function A_({dailyForecast:t,temperatureUnit:e}){const s=K();return n.jsx(ln,{children:t.map((a,o)=>n.jsxs(we.Row,{children:[n.jsxs(Te,{className:"w-[7.5rem] min-w-[7.5rem]",children:[n.jsx(cn,{weatherDescriptionData:a.description,isNight:a.night,size:"small"}),n.jsx("div",{className:"ms-3 whitespace-nowrap",children:As(s,Be(a.timestamp,a.utc_offset_sec))})]}),n.jsxs(Te,{className:"tabular-nums",children:[n.jsx("div",{children:Ze(s,a.temperature.max,e)}),n.jsx("div",{className:"text-token-text-secondary ms-1",children:Ze(s,a.temperature.min,e)})]}),n.jsx(Te,{className:"min-w-80",children:a.description.description})]},o))})}function L_({historical:t,temperatureUnit:e}){const s=K();return t?n.jsx(ln,{children:t.map((a,o)=>{const r=Be(a.timestamp,a.utc_offset_sec);return n.jsxs(we.Row,{children:[n.jsx(Te,{className:"w-[250px]",children:n.jsx("div",{className:"ms-3 whitespace-nowrap",children:s.formatDate(r,{weekday:"long",month:"short",day:"numeric"})})}),n.jsx(Te,{className:"tabular-nums",children:a.temperature.max&&a.temperature.min?n.jsxs(n.Fragment,{children:[n.jsx("div",{children:Ze(s,a.temperature.max,e)}),n.jsx("div",{className:"text-token-text-secondary ms-1",children:Ze(s,a.temperature.min,e)})]}):n.jsx("div",{children:Ze(s,a.temperature.current,e)})}),n.jsx(Te,{})]},o)})}):null}function Te({className:t,children:e}){return n.jsx(we.Cell,{className:F("border-token-border-xlight! border-s-0! border-e-0! py-2! ps-4! pe-3! first:ps-0! last:pe-0!",t),divClassName:"items-start leading-relaxed",children:e})}function R_({turnIndex:t}){const e=Si(a=>{var o,r;return(r=(o=a.thread)==null?void 0:o.turns[t])==null?void 0:r.use_location}),[s]=yc();return!s.useLocation&&e?n.jsx("div",{className:"mt-3",children:n.jsx(Se,{color:"secondary",icon:Ni,onClick:()=>{bc.setSettingsModalOpen(!0)},children:n.jsx(z,{id:"f47VEc",defaultMessage:"Share precise location"})})}):null}function Ro({temperatureUnit:t,onTemperatureUnitChange:e}){const s=a=>t===a?"font-bold":"font-light";return n.jsx(Ka,{size:"small",triggerButton:n.jsx("button",{className:"text-token-text-tertiary hover:text-token-text-primary flex items-center justify-center p-1.5",children:n.jsx(Ci,{className:"icon-sm"})}),children:n.jsxs(ke.Item,{onClick:()=>{e(t==="C"?"F":"C")},className:"text-token-text-primary",children:[n.jsx(z,{id:"bQIoe/",defaultMessage:"Temperature"}),n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:s("F"),children:n.jsx(z,{id:"bvDeBB",defaultMessage:"°F"})}),n.jsx("div",{className:"mx-1 h-4 border-s border-gray-300"}),n.jsx("div",{className:s("C"),children:n.jsx(z,{id:"iNiz6O",defaultMessage:"°C"})})]})]})})}function cn({weatherDescriptionData:t,isNight:e=!1,size:s="normal"}){const a=Tt(),o=s==="small"?30:50;return n.jsx("img",{draggable:!1,alt:t.description,src:__({weatherCode:t.id,isDarkMode:a,isNight:e}).src,width:o,height:o})}function I_(t,e){const s=Be(e.timestamp,e.utc_offset_sec);return t.formatDate(s,{hour:"numeric"})}function Ze(t,e,s){return e==null?"-":_a(s?s!=null?s:"F":Io(t),e)}function Io(t){const e=["en-US","en-BZ","en-BS","en-KY","en-PW"],s=t.locale||"en-US";return e.includes(s)?"F":"C"}function D_(t){const e=t.name.split(",").map(s=>s.trim());return t.country&&!e.includes(t.country)&&e.push(t.country),e.join(", ")}const F_=()=>{const t=K(),[e,s]=Pl("USER_TEMPERATURE_UNIT",Io(t),a=>["F","C"].includes(a));return[e,s]};function O_({contentReference:t,clientThreadId:e,messageId:s,trackContentReferenceEvent:a,contentReferenceIndex:o}){var x;const r=Zs(),i=r?"sidebar":"primary",l="metadata"in t&&((x=t.metadata)!=null&&x.location)?String(t.metadata.location):void 0,c=f.useMemo(()=>({content_reference_start_index:t.start_idx,entity_name:t.name,category:t.category,conversation_type:i,contentReferenceIndex:o,metadata_location:l}),[t.start_idx,t.name,t.category,i,o,l]);f.useEffect(()=>{a("Entity Anchor Content Reference Shown","entity_anchor_content_reference_shown","entity",c)},[a,c]);const{openThreadSidebar:d}=Mt(),{resetSidebarHistory:u}=Ba();let m=null;return t.category==="product_link"&&(m=n.jsx(lc,{className:"h-4 w-4"})),n.jsxs("span",{className:F("hover:entity-accent entity-underline inline cursor-pointer align-baseline",m&&"inline-flex items-center gap-1"),onClick:b=>{var w,h;b.preventDefault(),a("Entity Anchor Content Reference Clicked","entity_anchor_content_reference_clicked","entity",c),e&&(r||u(),d({type:"entity",clientThreadId:e,debugThreadId:void 0,messageId:s,contentReferenceStartIndex:t.start_idx,query:t.name,category:(w=t.category)!=null?w:void 0,extraParams:(h=t.extra_params)!=null?h:void 0}))},children:[m,n.jsx("span",{className:"whitespace-normal",children:t.name})]})}const B_=Va(()=>Js(()=>import("./l1bl9nxwf9lhfsng.js"),__vite__mapDeps([12,1,2,3,4,5,13,14,15,16,17,18,19,20,21,22,23,24,7,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64])).then(t=>t.BusinessesMap));function W_(t){"use forget";var M;const e=ve.c(158),{index:s,FormattedText:a,node:o,wordFadeType:r}=t,i=parseInt(s,10),l=f.useContext(Oe),c=de(),d=ce(c,"2137702454");let u;e[0]!==c?(u=Nt(c),e[0]=c,e[1]=u):u=e[1];const m=u;let x;e[2]!==(l==null?void 0:l.analyticsMetadata)||e[3]!==m?(x=p=>m?Ye.getConversationTurns(p).findIndex(U_)===(l==null?void 0:l.analyticsMetadata.turnIndex):void 0,e[2]=l==null?void 0:l.analyticsMetadata,e[3]=m,e[4]=x):x=e[4];const w=lt(l==null?void 0:l.clientThreadId,x)===!0&&i===0,h=za(l==null?void 0:l.analyticsMetadata),_=f.useRef(!1);if(l==null)return null;const{contentReferences:v,onShowSearchResults:C,numImageResults:k,analyticsMetadata:y,message:j,superWidgetImages:S}=l,g=v==null?void 0:v[i];if(!g||y.turnIndex===void 0||g.type===void 0)return null;let N;e[5]===Symbol.for("react.memo_cache_sentinel")?(N={img:H_},e[5]=N):N=e[5];let P;e[6]!==g.alt?(P=n.jsx(Ys,{components:N,children:g.alt}),e[6]=g.alt,e[7]=P):P=e[7];const L=P;let E=null;e:switch(g.type){case"title_citation":{let p;e[8]!==g||e[9]!==h?(p=n.jsx(eh,{metadata:g,trackContentReferenceEvent:h}),e[8]=g,e[9]=h,e[10]=p):p=e[10],E=p;break e}case"link_title":{let p;e[11]!==g||e[12]!==h?(p=n.jsx(Of,{metadata:g,trackContentReferenceEvent:h}),e[11]=g,e[12]=h,e[13]=p):p=e[13],E=p;break e}case"location_search":{let p;e[14]!==g||e[15]!==h?(p=n.jsx(Wf,{metadata:g,trackContentReferenceEvent:h}),e[14]=g,e[15]=h,e[16]=p):p=e[16],E=p;break e}case"time":{let p;e[17]!==g||e[18]!==h?(p=n.jsx(Qf,{metadata:g,trackContentReferenceEvent:h}),e[17]=g,e[18]=h,e[19]=p):p=e[19],E=p;break e}case"image_v2":{const p=k!=null?k:0;let D;e[20]!==y||e[21]!==g||e[22]!==h||e[23]!==w||e[24]!==S||e[25]!==p?(D=n.jsx(an,{metadata:g,numImageResults:p,analyticsMetadata:y,trackContentReferenceEvent:h,superWidgetImages:S,isFirstAssistantContent:w}),e[20]=y,e[21]=g,e[22]=h,e[23]=w,e[24]=S,e[25]=p,e[26]=D):D=e[26],E=D;break e}case"nav_list":{let p;e[27]!==g||e[28]!==h||e[29]!==w?(p=n.jsx(zf,{metadata:g,trackContentReferenceEvent:h,isFirstAssistantContent:w}),e[27]=g,e[28]=h,e[29]=w,e[30]=p):p=e[30],E=p;break e}case"file_navlist":{let p;e[31]!==g||e[32]!==h?(p=n.jsx(vf,{metadata:g,trackContentReferenceEvent:h}),e[31]=g,e[32]=h,e[33]=p):p=e[33],E=p;break e}case"file":{if(d){let p;e[34]!==g||e[35]!==v||e[36]!==h||e[37]!==i?(p=n.jsx(bf,{contentReferences:v,fileRef:g,index:i,trackContentReferenceEvent:h}),e[34]=g,e[35]=v,e[36]=h,e[37]=i,e[38]=p):p=e[38],E=p}else{let p;e[39]!==g||e[40]!==h||e[41]!==i?(p=n.jsx(No,{fileRef:g,index:i,trackContentReferenceEvent:h}),e[39]=g,e[40]=h,e[41]=i,e[42]=p):p=e[42],E=p}break e}case"grouped_webpages_model_predicted_fallback":{let p;e[43]!==g||e[44]!==l.message.id||e[45]!==h||e[46]!==i||e[47]!==o?(p=n.jsx(Ti,{webpageRef:g,node:o,trackContentReferenceEvent:h,messageId:l.message.id,index:i}),e[43]=g,e[44]=l.message.id,e[45]=h,e[46]=i,e[47]=o,e[48]=p):p=e[48],E=p;break e}case"grouped_webpages":{let p;e[49]!==g||e[50]!==l.message.id||e[51]!==h||e[52]!==i||e[53]!==o?(p=n.jsx(Mi,{webpageRef:g,node:o,trackContentReferenceEvent:h,messageId:l.message.id,index:i}),e[49]=g,e[50]=l.message.id,e[51]=h,e[52]=i,e[53]=o,e[54]=p):p=e[54],E=p;break e}case"tldr":break e;case"navigation":{let p;e[55]!==g||e[56]!==h||e[57]!==C?(p=n.jsx(Pi,{navigation:g,onShowSearchResults:C,trackContentReferenceEvent:h}),e[55]=g,e[56]=h,e[57]=C,e[58]=p):p=e[58],E=p;break e}case"stock":{let p;e[59]!==g||e[60]!==h?(p=n.jsx(If,{contentReference:g,trackContentReferenceEvent:h}),e[59]=g,e[60]=h,e[61]=p):p=e[61],E=p;break e}case"calculator":{let p;e[62]!==g||e[63]!==h?(p=n.jsx(sf,{data:g,trackContentReferenceEvent:h}),e[62]=g,e[63]=h,e[64]=p):p=e[64],E=p;break e}case"python":case"container":{let p;e[65]!==y.turnIndex||e[66]!==g||e[67]!==l.clientThreadId?(p=n.jsx(lf,{clientThreadId:l.clientThreadId,turnIndex:y.turnIndex,contentReference:g}),e[65]=y.turnIndex,e[66]=g,e[67]=l.clientThreadId,e[68]=p):p=e[68],E=p;break e}case"code_execution":{let p;e[69]!==a||e[70]!==g||e[71]!==h?(p=n.jsx(of,{FormattedText:a,displayInfo:g,trackContentReferenceEvent:h}),e[69]=a,e[70]=g,e[71]=h,e[72]=p):p=e[72],E=p;break e}case"forecast":{let p;e[73]!==y||e[74]!==g.date_range||e[75]!==g.forecast||e[76]!==h?(p=(g==null?void 0:g.forecast)&&n.jsx(N_,{weatherResults:g.forecast,dateRange:g.date_range,turnIndex:y.turnIndex,trackContentReferenceEvent:h}),e[73]=y,e[74]=g.date_range,e[75]=g.forecast,e[76]=h,e[77]=p):p=e[77],E=p;break e}case"businesses_map":{let p;e[78]!==g||e[79]!==h?(p=n.jsx(B_,{contentReference:g,trackContentReferenceEvent:h}),e[78]=g,e[79]=h,e[80]=p):p=e[80],E=p;break e}case"map":{let p;e[81]!==g||e[82]!==l.clientThreadId||e[83]!==l.message.id||e[84]!==h?(p=n.jsx(Rm,{contentReference:g,trackContentReferenceEvent:h,clientThreadId:l.clientThreadId,messageId:l.message.id}),e[81]=g,e[82]=l.clientThreadId,e[83]=l.message.id,e[84]=h,e[85]=p):p=e[85],E=p;break e}case"video":{let p;e[86]!==g||e[87]!==h?(p=n.jsx(ih,{video:g,trackContentReferenceEvent:h}),e[86]=g,e[87]=h,e[88]=p):p=e[88],E=p;break e}case"sports_standings":{let p;e[89]!==g||e[90]!==h?(p=n.jsx(Kf,{standingsRef:g,trackContentReferenceEvent:h}),e[89]=g,e[90]=h,e[91]=p):p=e[91],E=p;break e}case"sports_schedule":{let p;e[92]!==g||e[93]!==h?(p=n.jsx(Vf,{scheduleRef:g,trackContentReferenceEvent:h}),e[92]=g,e[93]=h,e[94]=p):p=e[94],E=p;break e}case"attribution":{let p;e[95]!==g||e[96]!==r?(p=n.jsx(Km,{attribution:g,wordFadeType:r}),e[95]=g,e[96]=r,e[97]=p):p=e[97],E=p;break e}case"debug":{let p;e[98]!==g?(p=Object.entries(g).map(z_),e[98]=g,e[99]=p):p=e[99];let D;e[100]!==p?(D=n.jsx(n.Fragment,{children:p}),e[100]=p,e[101]=D):D=e[101],E=D;break e}case"image_inline":{let p;e[102]!==g||e[103]!==l.clientThreadId||e[104]!==h||e[105]!==j?(p=(M=j.metadata)!=null&&M.b1de6e2_rm?n.jsx(_u,{reference:g,clientThreadId:l.clientThreadId,trackContentReferenceEvent:h,message:j}):n.jsx(ku,{reference:g,clientThreadId:l.clientThreadId,trackContentReferenceEvent:h,message:j}),e[102]=g,e[103]=l.clientThreadId,e[104]=h,e[105]=j,e[106]=p):p=e[106],E=p;break e}case"image_group":{let p;e[107]!==y||e[108]!==g||e[109]!==h?(p=n.jsx(tu,{contentReference:g,trackContentReferenceEvent:h,analyticsMetadata:y}),e[107]=y,e[108]=g,e[109]=h,e[110]=p):p=e[110],E=p;break e}case"product_entity":{let p;e[111]!==y.turnIndex||e[112]!==g||e[113]!==l.clientThreadId||e[114]!==l.message.id||e[115]!==h?(p=n.jsx(zm,{contentReference:g,clientThreadId:l.clientThreadId,messageId:l.message.id,turnIndex:y.turnIndex,trackContentReferenceEvent:h}),e[111]=y.turnIndex,e[112]=g,e[113]=l.clientThreadId,e[114]=l.message.id,e[115]=h,e[116]=p):p=e[116],E=p;break e}case"entity_metadata":{let p;e[117]!==g||e[118]!==l.clientThreadId||e[119]!==l.message.id||e[120]!==h?(p=n.jsx(hf,{contentReference:g,clientThreadId:l.clientThreadId,messageId:l.message.id,trackContentReferenceEvent:h}),e[117]=g,e[118]=l.clientThreadId,e[119]=l.message.id,e[120]=h,e[121]=p):p=e[121],E=p;break e}case"checkout_confirmation":{let p;e[122]!==g||e[123]!==h?(p=n.jsx(Ym,{metadata:g,trackContentReferenceEvent:h}),e[122]=g,e[123]=h,e[124]=p):p=e[124],E=p;break e}case"entity":{let p;e[125]!==y.turnIndex||e[126]!==g||e[127]!==l.clientThreadId||e[128]!==l.message.id||e[129]!==h||e[130]!==i?(p=n.jsx(O_,{contentReference:g,clientThreadId:l.clientThreadId,messageId:l.message.id,turnIndex:y.turnIndex,trackContentReferenceEvent:h,contentReferenceIndex:i}),e[125]=y.turnIndex,e[126]=g,e[127]=l.clientThreadId,e[128]=l.message.id,e[129]=h,e[130]=i,e[131]=p):p=e[131],E=p;break e}case"products":{let p;e[132]!==y||e[133]!==g||e[134]!==l.clientThreadId||e[135]!==l.message.id?(p=n.jsx(qm,{contentReference:g,clientThreadId:l.clientThreadId,messageId:l.message.id,turnIndex:y.turnIndex,analyticsMetadata:y}),e[132]=y,e[133]=g,e[134]=l.clientThreadId,e[135]=l.message.id,e[136]=p):p=e[136],E=p;break e}case"product_reviews":{let p;e[137]!==g||e[138]!==h?(p=n.jsx($i,{contentReference:g,disableAnimation:!0,trackContentReferenceEvent:h}),e[137]=g,e[138]=h,e[139]=p):p=e[139],E=p;break e}case"product_rationale":{let p;e[140]!==g||e[141]!==h?(p=n.jsx(Ei,{contentReference:g,trackContentReferenceEvent:h,disableAnimation:!0}),e[140]=g,e[141]=h,e[142]=p):p=e[142],E=p;break e}case"dil":{let p;e[143]!==g.dil||e[144]!==g.name||e[145]!==h?(p=n.jsx(cf,{dil:g.dil,trackContentReferenceEvent:h,widgetName:g.name}),e[143]=g.dil,e[144]=g.name,e[145]=h,e[146]=p):p=e[146],E=p;break e}case"sources_footnote":return null}"dil"in g&&g.dil;let R;e[151]!==L||e[152]!==g||e[153]!==h?(R=p=>(_.current||(h("Search Content Reference Failed","search_content_reference_failed",g.type),dt.addError("Error rendering content reference: ".concat(g.type),G(B({},p),{contentReference:g})),_.current=!0),g!=null&&g.alt?L:n.jsx("span",{className:"errored-object-".concat(g.type)})),e[151]=L,e[152]=g,e[153]=h,e[154]=R):R=e[154];let T;return e[155]!==E||e[156]!==R?(T=n.jsx(no,{name:"content-reference-renderer",fallback:R,children:E}),e[155]=E,e[156]=R,e[157]=T):T=e[157],T}function z_(t){const[e,s]=t;return n.jsx("sub",{className:"ms-1 w-fit rounded-md border-2 border-solid border-orange-500 px-1 leading-none",children:s},e)}function H_(t){const{src:e,alt:s}=t;return n.jsx("img",{src:e,alt:s,className:"max-h-28"})}function U_(t){return t.role===Rl.Assistant}var Ma;const q_=new RegExp(String.raw(Ma||(Ma=ut(["]((?!<)(","[^)\r\n]+?))"],["\\]\\((?!<)(","[^)\\r\\n]+?)\\)"])),Ts),"g"),G_=/\s/;function ka(t){return t.replace(q_,(e,s)=>G_.test(s)?"](".concat("<".concat(s,">"),")"):e)}const V_=({onClick:t})=>{const[e,s]=f.useState(!1),a=Ai(),o=K(),r=c=>{t(c),s(!0),setTimeout(()=>{a()&&s(!1)},2e3)},i=e?Ia:Da,l=o.formatMessage({id:"uG/ayY",defaultMessage:"Copy table"});return n.jsx(Ue,{label:l,side:"bottom",align:"center",alignOffset:0,children:n.jsx("button",{"aria-label":l,onClick:r,className:"hover:bg-token-bg-tertiary text-token-text-secondary my-1 rounded-sm p-1 transition-opacity group-[:not(:hover):not(:focus-within)]:pointer-events-none group-[:not(:hover):not(:focus-within)]:opacity-0",children:n.jsx(i,{className:"icon"})})})},X_=o=>{var r=o,{onClickCopy:t,children:e,unstyledContainer:s}=r,a=ye(r,["onClickCopy","children","unstyledContainer"]);const i=de(),l=f.useRef(null),c=f.useRef(null),u=Il(i)&&Qa(i);return Dl(()=>{var m;Li({axis:"height",target:(m=l.current)==null?void 0:m.firstElementChild,onChange:({height:x})=>{c.current&&(c.current.style.height="".concat(x,"px"))}})},[]),n.jsx("div",{className:F(s?void 0:u?"-mx-6":Cn.tableContainer),children:n.jsxs("div",{tabIndex:-1,className:F("group",u?"flex w-full max-w-full overflow-x-auto overscroll-x-contain px-6":F(s?void 0:Cn.tableWrapper,"flex w-fit flex-col-reverse")),children:[n.jsx("table",G(B({},a),{className:F(u?"w-full":"w-fit min-w-(--thread-content-width)"),ref:l,children:e})),n.jsx("div",{className:F("sticky h-0 select-none",u?"end-0 self-start":F(s?"end-0 self-end":"end-(--thread-content-margin) self-end")),children:n.jsx("div",{className:"absolute end-0 flex items-end",ref:c,children:n.jsx(V_,{onClick:t})})})]})})},Z_=a=>{var o=a,{node:t,children:e}=o,s=ye(o,["node","children"]);return n.jsx("td",G(B({},s),{children:f.Children.map(e,(r,i)=>r==="<br>"?n.jsx("br",{},i):r)}))};function Y_(t){const l=t,{src:e,clientThreadId:s}=l,a=ye(l,["src","clientThreadId"]),o=Ct(s),r=f.useContext(Oe),i=zi(o,e,r==null?void 0:r.useSafeUrls);return i==null?n.jsx("div",{}):n.jsx("img",G(B({},a),{src:i}))}function K_(t){return n.jsx(W_,G(B({},t),{FormattedText:Do}))}function Do({size:t="medium",children:e,className:s,clientThreadId:a,messageId:o,isActivelyStreaming:r=!1,componentOverrides:i,isDeepResearchResultMessage:l,forceDarkMode:c,disableWordFade:d}){const u=Tt()||c,{wordFadeType:m}=Ri(),x=Ii(),b=f.useRef(!1),w=f.useRef(!1);b.current=!1;const h=de(),_=f.useMemo(()=>{var p;if(!i)return;const D=i,{[p=ms]:T}=D;return ye(D,[pn(p)])},[i]),v=f.useMemo(()=>i==null?void 0:i[ms],[i]),C=f.useMemo(()=>B(B(G(B({pre:({children:T,"data-start":M,"data-end":p,"data-is-last-node":D})=>n.jsx("pre",{className:"overflow-visible!","data-start":M,"data-end":p,"data-is-last-node":D,children:T}),code:T=>n.jsx(Bi,G(B({},T),{clientThreadId:a})),[Fl]:T=>n.jsx(K_,B({wordFadeType:m},T)),[Oi]:T=>a==null?null:n.jsx(fd,G(B({},T),{clientThreadId:a,messageId:o})),[Fi]:Di,[Ql]:hd,[Jl]:Cd,[Kl]:jd,[Yl]:bd,a:T=>{var I,O,A,q;const $=T,{node:M,children:p}=$,D=ye($,["node","children"]),W=(I=M==null?void 0:M.properties)==null?void 0:I.href;if(typeof W=="string"&&W.startsWith(Ts))return a!=null&&o!=null?n.jsx(Jo,G(B({},D),{clientThreadId:a,messageId:o,href:W,children:p})):null;if(typeof W=="string"&&W===Qo){const U=(O=M==null?void 0:M.children)==null?void 0:O.map(H=>typeof H.value=="string"?H.value:"").join("").trim();return n.jsx(er,G(B({},T),{text:U,clientThreadId:a,messageId:o,className:"cursor-pointer"}))}if(typeof W=="string"&&W===tr){const U=(A=M==null?void 0:M.children)==null?void 0:A.map(H=>typeof H.value=="string"?H.value:"").join("").trim();return n.jsx(sr,G(B({},T),{text:U,clientThreadId:a,messageId:o}))}if(typeof W=="string"&&W===nr){const U=(q=M==null?void 0:M.children)==null?void 0:q.map(H=>typeof H.value=="string"?H.value:"").join("").trim();return n.jsx(ar,G(B({},T),{text:U,clientThreadId:a,messageId:o}))}return W&&typeof W=="string"&&Ud(W)?p:n.jsx(Oc,G(B({},T),{clientThreadId:a,messageId:o}))},table:p=>{var D=p,{node:T}=D,M=ye(D,["node"]);return n.jsx(X_,G(B({},M),{onClickCopy:W=>{var I;Fe.logEvent("ChatGPT Table Copy Clicked");const $=a!=null&&o!=null?Ye.getNode(yn(a),o).message:void 0;Ws(Pa(T.markdownSource,(I=$==null?void 0:$.metadata)==null?void 0:I.content_references),void 0,W)}}))},td:Z_},x?{h1:p=>{var D=p,{node:T}=D,M=ye(D,["node"]);return n.jsx("h1",B({"data-section-id":Lt(T.markdownSource)},M))},h2:p=>{var D=p,{node:T}=D,M=ye(D,["node"]);return n.jsx("h2",B({"data-section-id":Lt(T.markdownSource)},M))},h3:p=>{var D=p,{node:T}=D,M=ye(D,["node"]);return n.jsx("h3",B({"data-section-id":Lt(T.markdownSource)},M))},li:p=>{var D=p,{node:T}=D,M=ye(D,["node"]);return n.jsx("li",B({"data-section-id":Lt(T.markdownSource)},M))}}:{}),{img:p=>{var D=p,{node:T}=D,M=ye(D,["node"]);var $;const W=($=T==null?void 0:T.properties)==null?void 0:$.src;return typeof W=="string"&&(W.startsWith(Ts)||W.startsWith("attachment:"))?null:n.jsx(Y_,G(B({},M),{clientThreadId:a}))}}),m==="delay"?Bc:[]),_!=null?_:{}),[x,m,_,a,o]),k=f.useCallback((T,M)=>{var p,D,W,$;if(T==null||a==null||o==null)return M;try{const I=yn(a),O=Ye.getNode(I,o),A=($=(W=(D=(p=O==null?void 0:O.message)==null?void 0:p.metadata)==null?void 0:D.writing_blocks)==null?void 0:W[T])==null?void 0:$.content;return A!=null?A:M}catch(I){return M}},[a,o]),y=f.useCallback((T,M)=>T?n.jsx(Bs,{components:C,remarkPlugins:Ns,rehypePlugins:Ms,urlTransform:Ss,children:ka(T)}):n.jsx(n.Fragment,{children:M}),[C]),j=f.useCallback(T=>{var W,$,I,O;const M=(W=Ol(h,"1597818504"))!=null?W:null,p=($=M==null?void 0:M.get("disable_writing_block_rendering",!1))!=null?$:!1;if(b.current=!0,p){const A=(I=T.id)!=null?I:T.index!=null?String(T.index):void 0,q=k(A,T.content);return y(q,T.children)}if(typeof v=="function")return v(T);const D=Md(T.variant);return n.jsx(Hd,{clientThreadId:a,messageId:o,title:T.title,originalContent:T.content,variant:D,recipient:T.recipient,isStreaming:r,index:T.index,id:(O=T.id)!=null?O:String(T.index),children:T.children})},[h,k,y,v,a,o,r]),S=f.useMemo(()=>G(B({},C),{[ms]:j}),[C,j]),g=ce(h,"1839283687"),N=f.useMemo(()=>{const T=e!=null?e:"",M=r&&e?Wc(e):T;return ka(M)},[e,r]),P=Wi(N),L=Ha(),E=f.useMemo(()=>[...Ms,[or,N]],[N]),R=f.useMemo(()=>m==="indexed"&&!d?{handlers:{text:(T,M,p)=>{const D=[];for(const W of L(M.value))D.push({type:"element",tagName:"span",properties:{className:Ua.fadeIn},children:[{type:"text",value:W}]});return D}}}:void 0,[m,L,d]);return f.useEffect(()=>{if(!P){w.current=!1;return}if(r)return;if(b.current){w.current=!1;return}if(w.current)return;const T={contains_writing_directive:"true"};o!=null&&(T.message_id=o),a!=null&&(T.client_thread_id=String(a)),Bl(h,"chatgpt_writing_block_render_failed",void 0,T),w.current=!0},[h,a,r,o,P,N]),g?!1:n.jsx(no,{name:"formatted_text_error",fallback:()=>n.jsx(n.Fragment,{children:N}),children:n.jsx(Bs,{rehypePlugins:E,remarkPlugins:Ns,remarkRehypeOptions:R,className:F(s,"markdown prose dark:prose-invert w-full break-words",u?"dark":"light",t==="small"&&"prose-xs",l&&"deep-research-result","markdown-new-styling"),urlTransform:Ss,components:S,children:N})})}const Bs=f.memo(Ys),D2=Object.freeze(Object.defineProperty({__proto__:null,FormattedText:Do,ReactMarkdownMemo:Bs},Symbol.toStringTag,{value:"Module"}));export{D2 as F,Tm as M,Vt as W,$m as a,Em as b,tm as c,Ju as f,wo as p,We as r,Qu as t};
//# sourceMappingURL=nvwb9fmzzkrrg6va.js.map
