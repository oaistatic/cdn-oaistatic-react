import{R as A,r as u,j as s,M as j,m as g,A as M,b as T}from"./n75kuy1cx6f5mogg.js";import{dg as S,f4 as I,bN as v,bK as G,aS as q,aR as B,q2 as w,on as E,e as m,ho as z,_ as H}from"./ewse8exzafeu10ji.js";import{T as V}from"./kq6rvm8urk9sglfx.js";import{ei as O,gQ as D,gR as F,ch as K}from"./ny10lj7zpuz89fvf.js";import{C as U}from"./czwq62q5rbh9b1yi.js";import{c as W}from"./munzcsmgsqrfqkn8.js";import"./o423tfdeb6azgv8l.js";import"./j2tluvxda4ll72qx.js";import"./cg9mamkqgsk8mjh0.js";import"./ns51nblw8ziscsgd.js";import"./ce3hgmw4iyyhicud.js";import"./ibchrxf1juu2j0jw.js";import"./iqk1tse6yz14y9t9.js";import"./ly9hghfho7bi4z70.js";import"./hrsgt0zeavq3ouip.js";import"./ctddpbsbr3gj60l1.js";import"./gvudnmdzjyrmv9hw.js";import"./e52t6kvr8rhywzf0.js";import"./f7w0ep5soxjuc5hb.js";import"./j0qx0vaadhi6g6bi.js";import"./jwqkjcig49ehpyv5.js";import"./ooyih0iwl35v1a7o.js";import"./dmzl3n6ea4ax04tv.js";import"./czbf4ttx82qy2f0u.js";import"./idgulvc6m31b3k88.js";import"./c2p82diba60cggxu.js";import"./lep2wptoy14cfe2w.js";import"./kkz3rbw5udha6rc2.js";import"./ff22qitacijlmqi9.js";import"./gowyl4x2bs7hfi4a.js";import"./em5q5yhbyv41ft0j.js";function L({turn:e,turnIndex:t,clientThreadId:n,hasActiveRequest:r,isFinalTurn:o}){return s.jsx(U,{turnIndex:t,clientThreadId:n,groupedMessagesToRender:e.messageGroups,allGroupedMessages:e.messageGroups,allMessages:e.messages,isUserTurn:e.role==="user",isFinalUserTurn:!1,isFinalAssistantTurn:!1,isFinalTurn:o,isCompletionRequestInProgress:!1,isFeedbackEnabled:!1,hasActiveRequest:r,onRequestCompletion:()=>{},renderingView:"share-modal"})}function Q({messages:e,hasActiveRequest:t,clientThreadId:n,allowOrphanMessages:r}){const{session:o}=S(),d=u.useMemo(()=>{var i,c;if(n)return null;const a=I();return v.initThread({clientThreadId:a,conversationMode:{kind:G.PrimaryAssistant},userId:(i=o==null?void 0:o.user)==null?void 0:i.id,accountId:(c=o==null?void 0:o.account)==null?void 0:c.id}),a},[]),x=n!=null?n:d,l=u.useMemo(()=>{const a=q(x);if(a&&x===n){let p=[];for(const h of e){let b=h;const _=B.findNode(a,({message:R})=>h.id===R.id);!_&&!r||(_&&(b=_.message),p=w(p,b))}return p}const{allConversationMessages:i,threadResponse:c}=W(e);v.updateThreadFromServer(x,c);let f=[];for(const p of i)f=w(f,p.message);return f.filter(p=>p.role!=="root")},[e,x,n,r]);return s.jsx("div",{className:"space-y-2",children:l.map((a,i)=>s.jsx(L,{turn:a,turnIndex:i,clientThreadId:x,hasActiveRequest:t,isFinalTurn:i===l.length-1},a.messages[0].id))})}const $=A.memo(Q),J=u.memo(V,(e,t)=>e.sharedTextdoc.sharedTextdocId===t.sharedTextdoc.sharedTextdocId&&e.showHeader===t.showHeader&&e.disableNetworkRequests===t.disableNetworkRequests&&e.unsafeAllowAllNetworkRequests===t.unsafeAllowAllNetworkRequests&&e.disablePermissions===t.disablePermissions);function C({children:e,className:t,fullscreen:n}){const r=u.useRef(null),[o,d]=u.useState(!1),l=H()?"#353535":"#fff";return u.useEffect(()=>{const a=r.current;if(!a)return;const i=()=>d(a.scrollHeight>a.clientHeight);i();const c=new ResizeObserver(i);return c.observe(a),()=>{c.disconnect()}},[e]),s.jsxs("div",{ref:r,className:m(!n&&"relative",t,!o&&"pb-2"),children:[e,!n&&o&&s.jsx("div",{className:"pointer-events-none absolute start-0 end-0 bottom-0 h-40",style:{background:"linear-gradient(to top, ".concat(l,", transparent)")}})]})}function Ve(){return s.jsx("div",{className:"w-full",children:s.jsx("div",{className:"bg-token-main-surface-secondary mx-auto block h-[120px] rounded-3xl",children:s.jsx(E,{})})})}const k={deep_research:s.jsx(K,{title:"Deep Research",className:"h-[16px] w-[16px]"}),canvas:s.jsx(F,{title:"Canvas",className:"h-[16px] w-[16px]"}),image:s.jsx(D,{title:"Image",className:"h-[16px] w-[16px]"}),sora:s.jsx(O,{title:"Sora",className:"h-[16px] w-[16px]"})},X={deep_research:"Deep Research",canvas:"Canvas",image:"ImageGen",sora:"Sora"},Y=({icon:e,label:t})=>s.jsxs("div",{className:"flex items-center gap-1 rounded-full bg-white/80 px-2 py-1 text-xs text-black backdrop-blur-xs dark:bg-black/50 dark:text-white",children:[e,s.jsx("span",{className:"font-semibold",children:t})]}),Oe=({tags:e,badgeLabels:t})=>{const n=e.filter(r=>!!k[r]);return n.length===0?null:s.jsx("div",{className:"absolute end-3 top-3 z-10 flex gap-2",children:n.map(r=>{var o;return s.jsx(Y,{icon:k[r],label:(o=t==null?void 0:t[r])!=null?o:X[r]||r},r)})})};function Z({url:e,attachment_width:t,attachment_height:n,isFullscreen:r}){return s.jsx("video",{className:m(r?"mx-auto block max-h-screen max-w-full rounded-none object-contain":"mx-auto block w-full rounded-3xl object-cover object-center"),style:{aspectRatio:t/n},src:e,playsInline:!0,autoPlay:!0,muted:!0,loop:!0})}const P=u.memo(Z);function ee({attachment:e,isFullscreen:t,isInline:n,isComposer:r}){return s.jsx("div",{className:m(t&&"flex h-screen items-center justify-center",t&&"rounded-none",n&&"rounded-3xl",r&&"mx-24 rounded-3xl"),children:e.generation_type==="video_gen"?s.jsx(P,{url:e.url,attachment_width:e.width,attachment_height:e.height,isFullscreen:t,isInline:n}):s.jsxs("div",{className:"relative",children:[s.jsx("img",{className:m(t?"mx-auto block max-h-screen max-w-full rounded-none object-contain":"mx-auto block rounded-3xl object-cover object-center"),style:{aspectRatio:e.width/e.height},src:e.url,alt:e.kind}),e.output_blocked&&s.jsxs("div",{className:"text-token-text-error absolute start-0 bottom-0 flex h-1/4 w-full items-center justify-center gap-1 bg-transparent text-xs font-medium",children:[s.jsx(z,{className:"text-red-500"}),s.jsx(j,{id:"post-tree-attachment-output-blocked",defaultMessage:"Blocked by moderation"})]})]})})}const se=u.memo(ee);function te({url:e,isFullscreen:t,isInline:n,isComposer:r,isUnfurl:o}){const d=T();return s.jsx("div",{className:m(t&&"flex h-screen items-center justify-center",t&&"rounded-none",n&&"rounded-3xl",r&&"mx-24 rounded-3xl",o&&"h-full w-full"),children:s.jsx("img",{src:e,className:m(t?"mx-auto block max-h-screen max-w-full":"mx-auto block aspect-square",t?"rounded-none object-contain":o?"h-full w-full rounded-none object-cover object-top":"rounded-3xl object-center"),alt:d.formatMessage({id:"image-share-renderer-alt",defaultMessage:"User Shared Image"})})})}const N=u.memo(te);function ne({attachment:e,isFullscreen:t,isInline:n}){const r=u.useRef(null);return s.jsx("div",{ref:r,className:m("bg-token-main-surface-primary w-full",t?"h-[100vh] rounded-none":"",n?"h-[300px] cursor-zoom-in overflow-hidden rounded-3xl":"flex-1"),children:s.jsx(J,{disablePermissions:!t,sharedTextdoc:{sharedTextdocId:e.shared_textdoc_id,title:e.shared_textdoc.name,type:e.shared_textdoc.textdoc_type,content:e.shared_textdoc.content},showHeader:!1,unsafeAllowAllNetworkRequests:!0})})}const re=u.memo(ne);function oe({attachment:e,caption:t,variant:n,coverPhotoUrl:r,hasActiveRequest:o,clientThreadId:d}){var f;const x=(f=e.tags)==null?void 0:f.includes("deep_research"),l=n==="fullscreen",a=n==="inline",i=n==="composer",c=n==="unfurl";switch(e.kind){case"message_slice":return e.messages.length===0?null:s.jsx(y,{caption:t,variant:n,coverPhotoUrl:r,messages:e.messages,hasActiveRequest:o,hasCaption:!x,clientThreadId:d});case"conversation_share":{const p=e.share.linear_conversation.map(h=>h.message).filter(h=>h!=null);return p.length===0?null:s.jsx(y,{hasCaption:!1,caption:t,variant:n,coverPhotoUrl:r,messages:p,hasActiveRequest:o,clientThreadId:d})}case"image_share":return s.jsx(N,{url:e.file_public_url,isFullscreen:l,isInline:a,isComposer:i,isUnfurl:c});case"media_generation":return s.jsx(N,{url:e.url,isFullscreen:l,isInline:a,isComposer:i,isUnfurl:c});case"canvas":return s.jsx(re,{attachment:e,isFullscreen:l,isInline:a});case"sora":return s.jsx(se,{attachment:e,isFullscreen:l,isInline:a,isComposer:i});case"shared_post":return null;case"link":return s.jsx(ie,{url:e.url,ogData:e.og_data,isFullscreen:l,isInline:a,isComposer:i});case"error":return s.jsx("div",{children:s.jsx(j,{id:"post-tree-attachment-error",defaultMessage:"Error loading attachment"})});default:return null}}function ae({url:e,ogData:t,isFullscreen:n,isInline:r,isComposer:o}){var d;return s.jsx(g.div,{layout:"position",className:m("bg-token-main-surface-primary inline-block w-full rounded-3xl dark:bg-[#353535]",n&&"h-screen overflow-auto rounded-none",o&&"shadow-[0_12px_24px_-6px_rgb(0_0_0_/_0.1),0_0_1px_rgb(0_0_0_/_0.2)] dark:shadow-[0_10px_20px_-6px_rgb(20_20_20_/_0.5),inset_0_0_1px_rgb(255_255_255_/_0.3)]"),children:s.jsx(C,{fullscreen:!r,className:m("rounded-b-3xl",n&&"relative p-4 lg:px-24 lg:py-24"),children:s.jsx("div",{className:"flex flex-col gap-2 p-4",children:s.jsx("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"text-token-main-surface-secondary break-words hover:underline",children:s.jsxs("div",{className:"items-top flex flex-row gap-4",children:[t.og_image&&s.jsx("img",{className:"h-40 w-40 object-cover",src:t.og_image,alt:(d=t.og_title)!=null?d:void 0}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx("div",{className:"text-token-text-primary font-medium",children:t.og_title||e}),t.og_site_name&&s.jsx("div",{className:"text-token-text-tertiary",children:t.og_site_name}),t.og_description&&s.jsx("div",{className:"text-token-text-secondary",children:t.og_description})]})]})})})})})}const ie=u.memo(ae);function y({caption:e,variant:t,coverPhotoUrl:n,messages:r,hasActiveRequest:o,hasCaption:d,clientThreadId:x}){const l=t==="fullscreen",a=t==="inline",i=t==="composer",c=t==="unfurl";return s.jsxs(g.div,{layout:"position",className:m("bg-token-main-surface-primary inline-block w-full rounded-3xl dark:bg-[#353535]",l&&"h-screen overflow-auto rounded-none",i&&"shadow-[0_12px_24px_-6px_rgb(0_0_0_/_0.1),0_0_1px_rgb(0_0_0_/_0.2)] dark:shadow-[0_10px_20px_-6px_rgb(20_20_20_/_0.5),inset_0_0_1px_rgb(255_255_255_/_0.3)]",c&&"h-full"),children:[n&&s.jsx("img",{className:m("max-h-[300px] w-full object-cover object-center",{"rounded-t-3xl":t!=="fullscreen","rounded-none":l}),src:n,alt:e!=null?e:""}),s.jsx(C,{fullscreen:!a,className:m("rounded-b-3xl",l&&"relative p-4 lg:px-24 lg:py-24",a&&"max-h-[300px] overflow-hidden p-6",i&&"max-h-[300px] overflow-auto p-6",c&&"h-full overflow-hidden p-5"),children:s.jsxs(g.div,{layout:"position",transition:{type:"spring",duration:.45,bounce:.15},children:[s.jsx(M,{mode:"wait",children:d?e==null&&t==="composer"?s.jsx(g.div,{layout:"position",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},children:s.jsx("div",{className:"text-token-text-primary max-w-[460px] pb-8 text-2xl leading-[1.4] font-medium",children:s.jsx("span",{className:"animate-pulse opacity-30",children:s.jsx(j,{id:"placeholder.generatingTitle",defaultMessage:"Generating title..."})})})},"loading-caption"):e!==""?s.jsx(g.div,{layout:"position",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},children:s.jsx("div",{className:"text-token-text-primary max-w-[460px] pb-8 text-2xl leading-[1.4] font-medium",children:e})},"caption"):null:null}),s.jsx($,{messages:r,hasActiveRequest:o,clientThreadId:x,allowOrphanMessages:!0})]})})]})}const De=u.memo(oe);export{De as AttachmentContent,X as BADGE_LABELS,Y as Badge,Oe as BadgeContainer,Ve as LoadingAttachmentContent,oe as _AttachmentContent};
//# sourceMappingURL=ojos6prea3ls5zf1.js.map
