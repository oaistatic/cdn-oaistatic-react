var ee=Object.defineProperty,te=Object.defineProperties;var se=Object.getOwnPropertyDescriptors;var X=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var Y=(e,t,n)=>t in e?ee(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,U=(e,t)=>{for(var n in t||(t={}))oe.call(t,n)&&Y(e,n,t[n]);if(X)for(var n of X(t))ne.call(t,n)&&Y(e,n,t[n]);return e},G=(e,t)=>te(e,se(t));import{r as y,j as o,A as le,M as P}from"./n75kuy1cx6f5mogg.js";import{i as H,nG as re,bJ as ce,f2 as ie,j as ae,nB as de,br as ue,bq as pe,e as $,iq as _e,P as Z,aR as J}from"./ewse8exzafeu10ji.js";import{cX as D,cY as fe,cZ as xe,c_ as W,c$ as me,d0 as Q,X as he,bG as L,d1 as ge,d2 as ve,d3 as be,cD as je}from"./ny10lj7zpuz89fvf.js";import{F as ye}from"./bbwdjqfyrcn310kz.js";function q(e,t){const n=new RegExp("<\\s*".concat(t,"\\s*>([\\s\\S]*?)<\\s*/\\s*").concat(t,"\\s*>"),"i"),d=e.match(n);return d&&d[1]?d[1].trim():e}function Fe(e){if(e===void 0)return;const t="Content Snippet:",n=e.indexOf(t);return n===-1?e:e.substring(n+t.length).trim()}function Se(e,t){var n,d,F,a,p;t.text=Fe(e.contents),(n=e.documentId)!=null&&n.includes("ks--slack")||(d=t.cloud_doc_url)!=null&&d.match(/^https:\/\/github\.com\/[^/]+\/[^/]+\/(issues|pull)\/\d+/)?(t.text=void 0,t.name="#".concat(t.name)):(F=t.cloud_doc_url)!=null&&F.startsWith("https://docs.google.com/spreadsheets/")&&t.text!==void 0?t.text=q(t.text,"sheet_summary"):(a=t.cloud_doc_url)!=null&&a.match(/^https:\/\/github\.com\/[^/]+\/[^/]+\/commit\//)&&t.text!==void 0?t.text=q(t.text,"git_summary"):(p=t.cloud_doc_url)!=null&&p.match(/^https:\/\/github\.com\/[^/]+\/[^/]+\/blob\//)&&t.text!==void 0&&(t.text=q(t.text,"code_summary")),t.text&&(t.text=t.text.slice(0,250))}function Te({turnIndex:e,clientThreadId:t,variant:n="sidebar"}){const d=H(),F=re(),a=D()||F,p=fe(),r=xe(),[w,g]=ce(t,u=>[J.getTurnContentReferences(u,e),J.getConversationTurnAtIndex(u,e).messages]),m=ie(t),S=ae(d,"2137702454"),M=y.useMemo(()=>({turnIndex:e,clientThreadId:t}),[t,e]),k=y.useMemo(()=>{const u=[],_=new Set,i=new Map;if(r.forEach(s=>{i.set(s,[])}),w.forEach(s=>{var f,E,I,c,T,h,R,v,A;if(s.type==="file"&&!_.has(s.id)){const l=W((f=s.cloud_doc_url)!=null?f:""),x={id:s.id,name:(E=l==null?void 0:l.type)!=null?E:s.name,subtitle:l!=null&&l.type?s.name:void 0,cloud_doc_url:(c=s.cloud_doc_url)!=null?c:(I=s.extra)==null?void 0:I.cloud_doc_url,text:S?s.snippet:void 0,authors:(T=s.medical_file_reference)==null?void 0:T.authors_display,publication_year:(h=s.medical_file_reference)==null?void 0:h.publication_year,journal_name:(R=s.medical_file_reference)==null?void 0:R.journal_name,doi:(v=s.medical_file_reference)==null?void 0:v.doi};u.push(x),i.has(s.type)&&((A=i.get(s.type))==null||A.push(x)),_.add(s.id)}else s.type==="file_navlist"?s.items.forEach(l=>{var x,N,O;if(!_.has(l.id)){const b=W((x=l.cloud_doc_url)!=null?x:""),j={name:(N=b==null?void 0:b.type)!=null?N:l.name,subtitle:b!=null&&b.type?l.name:void 0,cloud_doc_url:l.cloud_doc_url,text:S?l.description:void 0,id:l.id,lastModifiedTime:l.last_modified_time};u.push(j),i.has(s.type)&&((O=i.get(s.type))==null||O.push(j)),_.add(l.id)}}):s.type==="grouped_webpages"&&p&&s.items.forEach(l=>{var x,N,O,b;if(!_.has(l.url)){const j=W((x=l.url)!=null?x:""),V={name:(N=j==null?void 0:j.type)!=null?N:l.title,subtitle:j!=null&&j.type?l.title:void 0,cloud_doc_url:l.url,text:S&&(O=l.snippet)!=null?O:void 0,journal_name:l.attribution,id:l.url};u.push(V),i.has(s.type)&&((b=i.get(s.type))==null||b.push(V)),_.add(l.url)}})}),r.length>0){const s=[];return r.forEach(f=>{var E;i.has(f)&&s.push(...(E=i.get(f))!=null?E:[])}),s}return u},[r,w,S,p]),B=de(m),z=y.useMemo(()=>{var i,s;if(!B||n==="bottom")return[];const u=[],_=new Set;for(const f of g)if(f.author.role===ue.Tool&&f.author.name==="file_search"&&f.content.content_type===pe.TetherBrowsingDisplay){const E=me(f.content.result),I=(s=(i=f.metadata)==null?void 0:i.cloud_doc_urls)!=null?s:[];E.chunks.forEach((c,T)=>{var l,x;if(!c.documentId||_.has(c.documentId))return;_.add(c.documentId);let h;if(c.metadata.cloud_doc_url)h=c.metadata.cloud_doc_url.toString();else if(T<I.length)h=I[T];else if(c.documentId.endsWith("--google")){const N=c.documentId.split("--")[1];h="https://drive.google.com/file/d/".concat(N)}const R=(l=c.metadata["File last modified at"])!=null?l:c.metadata["File created at"],v=W(h!=null?h:""),A={id:c.documentId,name:(x=v==null?void 0:v.type)!=null?x:c.title,subtitle:v!=null&&v.type?c.title:void 0,cloud_doc_url:h,text:c.contents,lastModifiedTime:R?R.toString():void 0};Se(c,A),u.push(A)})}return u},[B,g,n]),C=[];return o.jsx(le,{children:o.jsxs("div",{className:$("bg-token-main-surface-primary flex w-full flex-col",n==="sidebar"&&"mt-[calc(var(--threadFlyOut-leading-height,57px)*-1)]"),children:[o.jsx(K,{title:o.jsx(P,{id:"dlVlo6",defaultMessage:"Citations"}),items:k,clientThreadId:t,sectionId:"citations",analyticsMetadata:M}),!a&&o.jsx(K,{title:o.jsx(P,{id:"njZblE",defaultMessage:"Search Results"}),items:z,clientThreadId:t,sectionId:"search-results",analyticsMetadata:M,unstructuredResults:C})]})})}function K({title:e,items:t,scrollToHeader:n,shouldAnimateScroll:d,clientThreadId:F,analyticsMetadata:a,sectionId:p,unstructuredResults:r=[]}){const w=H(),g=_e(w),m=y.useRef(null),S=y.useMemo(()=>a?G(U({},a),{sectionId:p,numResultsInSection:t.length}):void 0,[a,t.length,p]);return y.useEffect(()=>{m.current&&n&&setTimeout(()=>{m.current&&m.current.scrollIntoView({behavior:d?"smooth":"instant"})},300)},[n,d]),r.length===0&&(!t||t.length===0)?null:o.jsxs("div",{ref:m,children:[o.jsx(Q,{className:$("bg-token-main-surface-primary text-token-text-primary sticky top-0 z-1 flex items-center px-6 pt-4 pb-4 text-sm font-medium",g?"border-b-thin h-[calc(var(--header-height,3.5rem))] border-(--bento-border-color)":"border-token-border-sharp h-[calc(var(--header-height,3.5rem)+1px)] border-b"),children:e}),o.jsxs("div",{className:"flex list-none flex-col px-3 py-2",children:[t.map((M,k)=>o.jsx(Q,{index:k,children:o.jsx(ke,{positionInSection:k,item:M,analyticsMetadata:S,clientThreadId:F},k)},"".concat(e,"-").concat(k))),r]})]})}function ke({item:e,analyticsMetadata:t,positionInSection:n,clientThreadId:d}){var C,u,_;const F=he(),a=D(),p=a&&e.journal_name!=null?e.journal_name:e.name,r=W((C=e.cloud_doc_url)!=null?C:"");let w=p!=null?p:o.jsx(P,{id:"bqY3sN",defaultMessage:"File"}),g=(u=r==null?void 0:r.Icon)!=null?u:e.cloud_doc_url?L:ge;!e.cloud_doc_url&&!ve(e.id)&&(w=o.jsx(P,{id:"hGgoxF",defaultMessage:"Source"}),g=L);const[m,S]=y.useState(!1),M=e.cloud_doc_url?e.cloud_doc_url:"";a&&M.length>0&&(g=({className:i})=>o.jsx(je,{url:M,className:$(i,"object-cover"),size:32,fallback:o.jsx(L,{className:i})}));const k=y.useCallback(()=>{t&&Z.logEventWithStatsig("File Sources Sidebar Item Clicked","file_sources_sidebar_link_clicked",G(U({},t),{positionInSection:n,sourceType:r==null?void 0:r.type,hasUrl:!!e.cloud_doc_url}))},[t,e.cloud_doc_url,r==null?void 0:r.type,n]),B=y.useCallback(()=>{t&&Z.logEventWithStatsig("File Source Sidebar Item Followup Clicked","file_sources_sidebar_item_followup_clicked",G(U({},t),{positionInSection:n,sourceType:r==null?void 0:r.type,hasUrl:!!e.cloud_doc_url}))},[t,e.cloud_doc_url,r==null?void 0:r.type,n]);return o.jsx(o.Fragment,{children:o.jsxs("a",{href:e.cloud_doc_url,target:"_blank",rel:"noreferrer",onClick:k,className:$("group relative flex flex-col gap-0.5 rounded-xl px-3 py-2.5","hover:bg-token-main-surface-secondary",m&&"bg-token-main-surface-secondary"),children:[o.jsxs("div",{className:"ellipses flex h-6 items-center gap-2 text-xs",children:[g&&o.jsx(g,{className:"icon-sm bg-primary flex-none rounded-full object-cover"}),o.jsx("p",{className:"text-token-text-secondary flex-auto truncate overflow-ellipsis",children:w})]}),a&&e.name!=null&&o.jsx("div",{className:"line-clamp-2 text-sm font-bold break-words",children:e.name}),a&&e.authors!=null&&e.publication_year!=null&&o.jsxs("div",{className:"line-clamp-2 text-sm break-words",children:[o.jsx("span",{className:"italic",children:e.authors}),o.jsx("span",{className:"ms-1 not-italic",children:e.publication_year})]}),a&&e.doi!=null&&o.jsx("div",{className:"line-clamp-2 text-sm break-words",children:e.doi}),e.subtitle&&o.jsx("div",{className:"text-token-text-primary line-clamp-1 text-sm font-semibold",children:e.subtitle}),((_=e.text)!=null?_:e.lastModifiedTime)&&o.jsxs("div",{className:"text-token-text-secondary line-clamp-2 text-sm leading-snug font-normal",children:[e.lastModifiedTime&&o.jsxs("span",{children:[o.jsx(be,{date:new Date(e.lastModifiedTime.trim())}),e.text&&" â€” "]}),e.text]}),F?null:o.jsx(ye,{className:$("absolute end-2 top-2 flex h-7 w-7 items-center justify-center rounded-sm p-1 transition","text-token-text-secondary group-hover:text-token-text-primary","invisible group-hover:visible","bg-token-main-surface-secondary hover:bg-token-main-surface-tertiary",m&&"bg-token-main-surface-tertiary text-token-text-primary visible"),clientThreadId:d,fileId:e.id,fileName:e.name,fileCloudDocUrl:e.cloud_doc_url,isFollowupMenuOpen:m,setIsFollowupMenuOpen:S,trackFileSourceFollowup:B})]})})}export{Te as ChatScreenRetrievalResultsFlyoutContent,K as SourcesListGroup,Se as __hacky_maybe_enhance_ref};
//# sourceMappingURL=ks571px5rt10uxm1.js.map
