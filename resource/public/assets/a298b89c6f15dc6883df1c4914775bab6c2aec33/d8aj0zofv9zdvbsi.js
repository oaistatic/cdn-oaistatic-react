var te=Object.defineProperty;var q=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var z=(s,t,a)=>t in s?te(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,W=(s,t)=>{for(var a in t||(t={}))re.call(t,a)&&z(s,a,t[a]);if(q)for(var a of q(t))ne.call(t,a)&&z(s,a,t[a]);return s};import{b as E,r as g,j as e,M as o,d as _,ai as oe,u as ie,g as Q,t as de}from"./n75kuy1cx6f5mogg.js";import{f as F,C as H,B as G,i as I,r as X,ai as Z,R as K,qO as Y,E as L,at as le,dv as J,m as ce,ho as ue,j as me,e as ge}from"./ewse8exzafeu10ji.js";import{dp as pe,jq as xe,lh as U,ck as fe,a2 as ee,lg as se,li as he,a7 as je,jk as Me,cg as we}from"./ny10lj7zpuz89fvf.js";import{a as Se,c as ye}from"./6tgqoqudeah698zo.js";import{T as n}from"./e0z6030ycsi62lhu.js";import{f as ae,i as O,u as be,R as ke}from"./noq3mkmgllmrw99g.js";import{V as Ne}from"./h2t8e4spzi3rf7zt.js";import{G as ve}from"./ox99k03vnvnrihmv.js";import{e as Ge,f as Ce,M as V}from"./mf5xo39q7qs5a56k.js";function Ae({defaultName:s,placeholder:t,onSave:a,onClose:r}){const d=E(),h=s==null,[u,c]=g.useState(s||""),[p,M]=g.useState(!1),[y,j]=g.useState(null),x=F(),f=async()=>{if(u.trim()===""){j(d.formatMessage({id:"workspaceSettings.groups.emptyName",defaultMessage:"Group name cannot be empty"}));return}M(!0);try{await a(u),x.success(h?d.formatMessage({id:"workspaceSettings.groups.createdGroup",defaultMessage:"Group created successfully"}):d.formatMessage({id:"workspaceSettings.groups.nameChanged",defaultMessage:"Group name changed successfully"})),r()}catch(w){j(d.formatMessage({id:"workspaceSettings.groups.duplicateName",defaultMessage:"Group with this name already exists"}))}finally{M(!1)}};return e.jsx(H,{isOpen:!0,type:"success",onClose:r,title:h?d.formatMessage($.newGroupTitle):d.formatMessage($.updateNameTitle),testId:"modal-change-group-name",showCloseButton:!0,primaryButton:e.jsx(G,{color:"primary",onClick:()=>f(),loading:p,children:e.jsx(o,{id:"workspaceSettings.groups.save",defaultMessage:"Save"})}),secondaryButton:e.jsx(G,{onClick:r,color:"secondary",children:e.jsx(o,{id:"workspaceSettings.groups.cancel",defaultMessage:"Cancel"})}),children:e.jsxs("div",{className:"mb-3 flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:e.jsx(o,{id:"workspaceSettings.groups.groupNameLabel",defaultMessage:"Group Name"})}),e.jsx("input",{autoFocus:!0,type:"text",value:u,placeholder:t,onChange:w=>{c(w.target.value),j(null)},className:"border-token-border-secondary focus:border-token-accent bg-token-bg-primary w-full rounded border px-3 py-2 text-sm focus:outline-none",onKeyDown:w=>{w.key==="Enter"&&f()}}),y&&e.jsx("p",{className:"text-xs text-red-500",children:y})]})})}const $=_({newGroupTitle:{id:"workspaceSettings.groups.newGroup",defaultMessage:"New group"},updateNameTitle:{id:"workspaceSettings.groups.updateNameTitle",defaultMessage:"Update group name"}}),Ee=_({bulkAddMembersError:{id:"workspaceSettings.groups.bulkAddMembers.error",defaultMessage:"Unable to add some members to the group."}}),B=1e3;function Pe({group:s,isOpen:t,onClose:a}){const r=E(),d=F(),h=r.formatMessage({id:"workspaceSettings.groups.addMember",defaultMessage:"Add members to the {groupName} group"},{groupName:s.name}),u=I(),c=X(u),[p,M]=g.useState([]),[y,j]=g.useState(!1);async function x(){var N;const f=c==null?void 0:c.getWorkspaceId();if(!f)throw new Error("No workspace ID found");j(!0);const w=[],b=50;for(let m=0;m<p.length;m+=b)w.push(p.slice(m,m+b));const C=async m=>K.safePost("/accounts/{account_id}/group/{group_id}/users",{parameters:{path:{account_id:f,group_id:s.id}},requestBody:{email_addresses:m}});try{const v=(await Promise.all(w.map(S=>C(S)))).reduce((S,i)=>S+i.added_group_users.length,0);d.success(r.formatMessage({id:"yU4Zf0",defaultMessage:"Added {numUsers} users to the group"},{numUsers:v})),a==null||a()}catch(m){const v=(N=ae(r,m,{targetIsRestrictedSafeModeGroup:O(s)}))!=null?N:r.formatMessage(Ee.bulkAddMembersError);d.danger(v,{duration:3})}finally{j(!1)}}return e.jsxs(H,{testId:"modal-bulk-add-group-members",isOpen:t,onClose:a!=null?a:Z,title:h,type:"success",showCloseButton:!0,primaryButton:e.jsx(G,{onClick:x,disabled:p.length===0||p.length>B,loading:y,children:e.jsx(o,{id:"EpbOzA",defaultMessage:"Add users to group"})}),children:[e.jsx(_e,{onChange:M}),p.length>B&&e.jsx("div",{className:"text-token-text-error mt-2 text-sm",children:e.jsx(o,{id:"9lp0Tc",defaultMessage:"Email list is limited to {maxEmails} users at once",values:{maxEmails:B}})})]})}function _e({onChange:s}){const[t,a]=g.useState("");return e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsxs("label",{htmlFor:"group-email-paste",children:[e.jsx(o,{id:"qvGcSC",defaultMessage:"Emails"}),e.jsx("br",{}),e.jsx("span",{className:"text-token-text-tertiary text-sm",children:e.jsx(o,{id:"Fhd+5h",defaultMessage:"Paste email addresses here, one per line:"})})]}),e.jsx(pe,{id:"group-email-paste",className:"h-[250px] text-sm",value:t,onChange:r=>{a(r.target.value),s(Re(r.target.value))},placeholder:"jean@example.com\njoohyun@example.com\nmuhammed@example.com\nsusan@example.com"})]})}function Re(s){return s.split("\n").map(t=>t.trim()).filter(t=>t.length>0).filter(t=>Ne.test(t))}function Ue({group:s,isOpen:t,onClose:a}){var P;const r=E(),d=F(),h=r.formatMessage({id:"workspaceSettings.addGroupsMembersModal.title",defaultMessage:"Add members to the {groupName} group"},{groupName:s.name}),u=I(),c=X(u),p=c==null?void 0:c.getWorkspaceId(),[M,y]=g.useState(""),[j,x]=g.useState(0),{data:f,isLoading:w}=xe(p,j*U,M,U,oe),[b,C]=g.useState([]),[N,m]=g.useState([]),[v,S]=g.useState("interactive"),i=f?Math.ceil(((P=f.total)!=null?P:0)/U):0;async function A(l){var T;m(k=>[...k,l]);try{await Be(p,s.id,l),C(k=>[...k,l])}catch(k){le.addError(k);const R=(T=ae(r,k,{targetIsRestrictedSafeModeGroup:O(s)}))!=null?T:r.formatMessage(De.addMemberError);d.danger(R,{duration:3})}finally{m(k=>k.filter(R=>R!==l))}}return v==="batch"?e.jsx(Pe,{group:s,isOpen:t,onClose:a}):e.jsx(H,{testId:"modal-add-group-member",type:"warning",isOpen:t,onClose:a!=null?a:Z,title:h,size:"custom",className:"max-w-(--breakpoint-md)",showCloseButton:!0,primaryButton:e.jsx(G,{onClick:a,children:e.jsx(o,{id:"0NAzDq",defaultMessage:"Done"})}),children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex flex-row justify-between",children:[e.jsx("p",{children:h}),e.jsx(G,{onClick:()=>{S("batch")},color:"secondary",children:e.jsx(o,{id:"5GPldp",defaultMessage:"Bulk add users"})})]}),e.jsx(Y,{value:M,inputClassName:"w-full",onChange:l=>{y(l.target.value)}}),e.jsxs(n.Root,{className:"min-w-full",children:[e.jsxs(n.Header,{children:[e.jsx(n.HeaderCell,{children:e.jsx(o,{id:"workspaceSettings.groups.addMember.name",defaultMessage:"Name"})}),e.jsx(n.HeaderCell,{children:e.jsx(o,{id:"workspaceSettings.groups.addMember.email",defaultMessage:"Email"})}),e.jsx(n.HeaderCell,{})]}),e.jsxs(n.Body,{children:[!f&&w&&e.jsx(n.Row,{children:e.jsx(n.Cell,{colSpan:3,children:e.jsx(L,{})})}),f==null?void 0:f.items.map(l=>e.jsxs(n.Row,{children:[e.jsx(n.Cell,{children:l.name}),e.jsx(n.Cell,{children:l.email}),e.jsx(n.Cell,{textAlign:"right",className:"pe-1",children:e.jsx(G,{size:"small",color:"secondary",disabled:N.includes(l.id),onClick:()=>{b.includes(l.id)||A(l.id)},icon:b.includes(l.id)?fe:ee,children:b.includes(l.id)?e.jsx(o,{id:"workspaceSettings.groups.addMember.addButton",defaultMessage:"Added"}):e.jsx(o,{id:"workspaceSettings.groups.addMember.addedButton",defaultMessage:"Add"})})})]},l.id))]})]}),e.jsx("div",{className:"flex flex-row justify-center",children:e.jsx(se,{currentPage:j,onChangeIndex:l=>{x(l)},length:i})})]})})}async function Be(s,t,a){await K.safePatch("/accounts/{account_id}/group/{group_id}",{parameters:{path:{account_id:s,group_id:t}},requestBody:{user_id:a}})}const De=_({addMemberError:{id:"EnX2ZH",defaultMessage:"Unable to add member to the group."}});function Fe({workspaceId:s}){const t=E(),a=ie(),r=J(),d=!(r!=null&&r.isAdminOfAccount()||r!=null&&r.isOwnerOfAccount()),h=I(),[u,c]=g.useState(""),p=we(u,300),M=Q(),[y,j]=g.useState(0),{groups:x,isLoading:f,isPlaceholderData:w}=Ge({workspaceId:s,currPage:y,groupFilter:p}),[b,C]=g.useState(!1),{data:N}=be(s,me(h,"3020999601")),m=i=>{i&&(j(0),c("")),C(i)},{createGroup:v}=Ce({workspaceId:s,currentGroups:x});let S=x?[...x.items]:[];if(N&&x){const i=N.group;if(i){const A=S.filter(({id:P})=>P!==i.id);S=y===0?[i].concat(A):S}}return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-6 mb-3 flex flex-row justify-between gap-2",children:[e.jsx(Y,{inputClassName:"w-[250px] rounded-full! text-sm",value:u,onChange:i=>{c(i.target.value),j(0)},placeholder:t.formatMessage({id:"workspaceSettings.groups.search",defaultMessage:"Search group name"})}),!d&&e.jsx(G,{onClick:()=>m(!0),icon:ee,children:e.jsx(o,{id:"workspaceSettings.groups.create",defaultMessage:"Create group"})})]}),e.jsxs("div",{children:[e.jsxs(n.Root,{className:"min-w-full",children:[e.jsxs("colgroup",{children:[e.jsx("col",{className:"w-[60%]"}),e.jsx("col",{className:"w-[20%]"}),e.jsx("col",{className:"w-[20%]"}),e.jsx("col",{className:"w-16"})]}),e.jsxs(n.Header,{children:[e.jsx(n.HeaderCell,{children:e.jsx(o,{id:"workspaceSettings.groups.groupName",defaultMessage:"Group name"})}),e.jsx(n.HeaderCell,{children:e.jsx(o,{id:"workspaceSettings.groups.members",defaultMessage:"Members"})}),e.jsx(n.HeaderCell,{children:e.jsx(o,{id:"workspaceSettings.groups.created",defaultMessage:"Created"})}),e.jsx(n.HeaderCell,{})]}),e.jsx(n.Body,{className:ge((f||w)&&"opacity-50"),children:x==null?e.jsx(n.Row,{children:e.jsx(n.Cell,{colSpan:5,textAlign:"center",children:e.jsx(L,{})})}):S.length===0?e.jsx(n.Row,{children:e.jsx(n.Cell,{colSpan:5,textAlign:"center",children:u===""?e.jsx(o,{id:"workspaceSettings.groups.noGroups",defaultMessage:"No groups found."}):e.jsx(o,{id:"workspaceSettings.groups.noGroupsWithFIlter",defaultMessage:"No groups found. Try changing the search query."})})}):S.map(i=>e.jsx(He,{group:i,workspaceId:s,onAddMember:()=>{a.invalidateQueries({queryKey:[s,"groups"]})},readOnly:d},i.id))})]}),x&&e.jsx("div",{className:"text-center",children:e.jsx(se,{length:Math.ceil(x.total/V),currentPage:Math.min(y,Math.ceil(x.total/V)),onChangeIndex:i=>j(i)})})]}),b&&e.jsx(Ae,{onClose:()=>m(!1),onSave:async i=>{const{id:A}=await v({name:i,workspaceId:s});M("/admin/groups/".concat(A))},placeholder:t.formatMessage({id:"workspaceSettings.groups.placeholder",defaultMessage:"E.g. marketing team"})})]})}function Xe({currentWorkspaceId:s}){var M;const t=E(),a=J();let r=!1;const d=a!=null?he(a.data.role):void 0,h=a!=null?je(a.data.role):void 0,u=a==null?void 0:a.isEnterprisey(),{data:c,isLoading:p}=ce(s);return h||d||!u?r=!0:r=!!((M=c==null?void 0:c.permissions)!=null&&M.includes("chatgpt.workspace.member.role.view")),p?e.jsx("div",{className:"mt-6 flex min-h-[40vh] items-center justify-center",children:e.jsx(L,{})}):r?e.jsxs(e.Fragment,{children:[e.jsx(Me,{children:e.jsx("title",{children:t.formatMessage(D.title)})}),e.jsx(Se,{title:t.formatMessage(D.title),subtitle:e.jsx(o,{id:"NDDzzF",defaultMessage:"Only workspace admins can edit these settings."})}),e.jsx(ye,{showSpinner:!1,children:e.jsx(Fe,{workspaceId:s})})]}):e.jsx("div",{className:"m-6",children:e.jsxs("div",{className:"border-token-border-medium bg-token-main-surface-secondary text-token-text-primary flex items-center gap-3 rounded-md border px-4 py-3",children:[e.jsx(ue,{className:"icon-sm interactive-label-warning-secondary shrink-0"}),e.jsx(o,W({},D.groupsPagePermissionDenied))]})})}function He({group:s,onAddMember:t,readOnly:a}){const[r,d]=g.useState(!1),h=Q(),u=O(s);return e.jsxs(e.Fragment,{children:[e.jsxs(n.Row,{className:"[&>td]:py-2",onClick:()=>h("/admin/groups/".concat(s.id)),children:[e.jsxs(n.Cell,{children:[e.jsx(ve,{group:s}),e.jsx("div",{className:"flex flex-col gap-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s.name}),u&&e.jsx(ke,{})]})})]}),e.jsx(n.Cell,{children:e.jsx(o,{id:"workspaceSettings.groups.memberCount",defaultMessage:"{count} members",values:{count:s.num_members}})}),e.jsx(n.Cell,{children:s.created_time&&e.jsx(de,{value:s.created_time,year:"numeric",month:"short",day:"numeric"})})]}),r&&!a&&!s.is_scim_managed&&e.jsx(Ue,{isOpen:!0,onClose:()=>{t(s.id),d(!1)},group:s})]})}const D=_({title:{id:"admin.groupsSettings.title",defaultMessage:"Groups"},groupsPagePermissionDenied:{id:"adminPage.groupsPagePermissionDenied",defaultMessage:"You don't have permission to view this groups list."}});export{Ue as A,Ae as U,Xe as W,D as m};
//# sourceMappingURL=d8aj0zofv9zdvbsi.js.map
