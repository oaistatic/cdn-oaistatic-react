var ie=Object.defineProperty,le=Object.defineProperties;var ce=Object.getOwnPropertyDescriptors;var pt=Object.getOwnPropertySymbols;var de=Object.prototype.hasOwnProperty,me=Object.prototype.propertyIsEnumerable;var gt=(t,o,s)=>o in t?ie(t,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[o]=s,ht=(t,o)=>{for(var s in o||(o={}))de.call(o,s)&&gt(t,s,o[s]);if(pt)for(var s of pt(o))me.call(o,s)&&gt(t,s,o[s]);return t},bt=(t,o)=>le(t,ce(o));import{r as E,j as e,as as Et,av as ue,aw as xt,G as fe,H as Tt,m as D,b as kt,d as Bt,A as $,M as pe}from"./n75kuy1cx6f5mogg.js";import{c as ge,a as he,s as be,g as Ee,b as xe,d as Te,P as tt,T as At}from"./dmzl3n6ea4ax04tv.js";import{c0 as Ae,_ as ve,e as H,x as Ie,hJ as Ne,cq as Dt,rg as Ht,mi as Oe,at as Me,i as Vt,aj as Ce,O as vt,s2 as _e,nR as It}from"./ewse8exzafeu10ji.js";import{b as Se,g as Re,D as Pe,c as we}from"./gvh5p107yczbfviz.js";import{a as Le,u as ye,i as je,C as ke,g as Nt}from"./bhfid1ryaups609y.js";import{T as Be}from"./ctddpbsbr3gj60l1.js";import{M as De,S as He,d as Ve,e as We,h as Ot,i as Ge,C as et}from"./fdv2df7jppwbz4po.js";import{u as nt,f as Wt,d as U}from"./iqk1tse6yz14y9t9.js";import{T as Mt,Z as Xe,C as Fe}from"./ce3hgmw4iyyhicud.js";import{bs as Gt,eM as Xt,nA as C,oq as ze,b as Ue,nB as y,gR as Ye,dG as $e,cn as qe,eL as Ft,lA as Je}from"./ny10lj7zpuz89fvf.js";import{g as Ze}from"./o423tfdeb6azgv8l.js";import{u as zt}from"./j2tluvxda4ll72qx.js";import{a as Ct}from"./jwqkjcig49ehpyv5.js";import{t as Ke,B as Qe,I as to}from"./czbf4ttx82qy2f0u.js";import{H as eo,P as oo}from"./ooyih0iwl35v1a7o.js";import{T as so,a as no,b as B,A as _t}from"./j91jff36pcuewy8o.js";import{S as ao,a as ro}from"./l4fgj5ewfyihgm1a.js";import{S as io}from"./cl7dmrzdmwy44poc.js";import{u as Ut}from"./d0p97pwfptqt3nvy.js";import"./j0qx0vaadhi6g6bi.js";import"./ly9hghfho7bi4z70.js";import"./e52t6kvr8rhywzf0.js";import"./c2p82diba60cggxu.js";import"./lep2wptoy14cfe2w.js";import"./peahhkmucc5rd7ov.js";import"./cg9mamkqgsk8mjh0.js";import"./ns51nblw8ziscsgd.js";import"./jiz6zc3ys9fjr045.js";import"./hkwix64yhkotslv1.js";import"./5hoqitp3r2hkdtny.js";import"./czwq62q5rbh9b1yi.js";import"./gowyl4x2bs7hfi4a.js";import"./em5q5yhbyv41ft0j.js";import"./irqko7c1s7qpl41n.js";import"./i3bw46mavo9n01l8.js";import"./ga8p3rr9o0mc72h0.js";import"./gbvlxp0nrrwdd6eq.js";import"./kj8rd4pu8k32z2dy.js";import"./d65yyyom1modmtdi.js";import"./fh2tsu8ocsi22jc3.js";import"./ou1s0kowmldvhx32.js";import"./co6h42pxywtlg2op.js";import"./d5vv6ct7n3prp63a.js";import"./npn63o3tt9liv4y2.js";import"./kl7c6054usfnqmd4.js";import"./k97n0y6ba9c9h39c.js";import"./je40yyidw4ukzc9u.js";import"./ibchrxf1juu2j0jw.js";import"./hrsgt0zeavq3ouip.js";import"./gvudnmdzjyrmv9hw.js";import"./idgulvc6m31b3k88.js";import"./e79nci3z6bwkg1aw.js";function lo(t,o){E.useEffect(()=>{const s=t==null?void 0:t.current;if(s!=null)return Ae(s,{mousedown:m=>{var u;((u=o.current)==null?void 0:u.maybeFocusOnEditor(m))===!0&&m.preventDefault()}})},[o,t])}const co=({wrapperClassName:t,value:o="",width:s,comments:m,paddingBottom:u})=>{const c=E.useRef(null),r=E.useRef(null),d=ve();return E.useEffect(()=>{const{current:f}=c;if(f)return r.current=ge({mount:f,comments:m,value:o,isDarkMode:d}),()=>{var i;(i=r.current)==null||i.destroy()}},[]),E.useEffect(()=>{var i;const f=he(o,m);(i=r.current)==null||i.updateState(f)},[o,m]),e.jsx("div",{className:t,children:e.jsx("div",{ref:Gt(c),className:H(be.main,"markdown prose dark:prose-invert focus:outline-hidden"),style:{width:s,paddingBottom:u}})})},Yt=t=>!t||"docView"in t&&t.docView==null||Le(t.state.doc),Y=100,mo={type:"spring",duration:1.5,bounce:.1},uo={type:"spring",duration:.5,bounce:0},St={type:"spring",duration:.2},Rt={type:"spring",duration:1,delay:.1},fo={type:"spring",duration:1},po={type:"spring",duration:.5,bounce:0},go=({isRewriting:t=!1,value:o,previousValue:s,previousComments:m,documentWidth:u,paddingBottom:c,onStart:r})=>{const d=nt(),f=Et(0),i=Et(-Y),T=E.useRef(!1),[A,l]=ue(),[{height:v},a]=zt(),g=Xt();Ie(()=>{const n=d();return n&&(n.dom.style.clipPath="inset(0 0 100% 0)"),()=>{const b=d();b&&(b.dom.style.clipPath="")}},[]),E.useEffect(()=>{var b;const n=d();if(!n||Yt(n))return A||l==null?void 0:l();try{const x=(b=Ze(n.state.doc))==null?void 0:b.end;if(x==null||x>o.length)return;const{top:O}=n.coordsAtPos(0),{top:R,bottom:M}=n.coordsAtPos(Math.max(n.state.doc.content.size-1,0),-1),I=M-O,_=R-O;if(f.set(I-_),!A){xt(i,I+2*f.get(),uo).then(()=>l==null?void 0:l());return}xt(i,I,mo)}catch(x){C.logError("Failed to set rewrite animation position",x),l==null||l()}},[A,o]);const h=fe(i,n=>Ne(n)-Y+2);return Tt(i,"change",n=>{const b=d();!b||!n||!T.current||(b.dom.style.clipPath="inset(0 0 calc(100% - ".concat(n,"px) 0)"))}),Tt(i,"animationStart",()=>{t&&(r==null||r())}),e.jsxs(e.Fragment,{children:[g&&e.jsx(D.div,{style:{visibility:"hidden",pointerEvents:"none",height:v},initial:!1,exit:{height:0},transition:{delay:.1,duration:.8,ease:"easeOut"}}),e.jsx(D.div,{className:"absolute top-0 z-10 w-full origin-bottom bg-linear-to-t from-[var(--canvas-bg,var(--bg-primary))] from-10% to-transparent",style:{translateY:h,height:Y},initial:{opacity:0},animate:{opacity:1,transition:St},exit:{opacity:0,transition:Rt},onAnimationComplete:()=>T.current=!0},"wash-top"),e.jsx(D.div,{className:"absolute top-0 z-10 w-full bg-linear-to-b from-[var(--canvas-bg,var(--bg-primary))] to-transparent",style:{translateY:i,height:Y},initial:{opacity:0},animate:{opacity:1,transition:St},exit:{opacity:0,transition:Rt}},"wash-bottom"),e.jsx(D.div,{ref:a,className:"pointer-events-none absolute z-0 max-w-full min-w-0",initial:{opacity:1},animate:{opacity:.3,transition:fo},exit:{opacity:0,transition:po},children:e.jsx(co,{value:s,width:u,comments:m,wrapperClassName:"h-fit flex",paddingBottom:c})},"previousValue")]})};function Pt(t,o){if(t==null)return!1;const s=t.state.schema.marks[o];return s==null?!1:Ke(t.state,t.dispatch,s)}function ot(t,o){if(t==null)return!1;const{state:s,dispatch:m}=t,u=Dt(s.schema.nodes[eo.proseMirrorNodeName()]);return Ht(u,{level:o})(s,m)}function ho(t){if(t==null)return!1;const{state:o,dispatch:s}=t,m=Dt(o.schema.nodes[oo.proseMirrorNodeName()]);return Ht(m)(o,s)}const bo=({availableWidth:t,onAddComment:o,isSendDisabled:s=!1,isWaitingForCommentResponse:m=!1,onSubmitAccelerator:u})=>{const c=kt(),r=nt(),d=Wt(),f=ze(),i=E.useCallback(a=>{const{width:g,height:h}=a,n=r();if(!d||!n||Yt(n))return null;const{to:b,empty:x,head:O}=d.selection,{platform:R}=Ue(),M=R==="web"?O:b,I=M===b;if(x||!Ct(n.state.doc,M))return null;const{right:_,left:P,top:W}=n.coordsAtPos(0);let w=M,j=n.state.doc.nodeAt(w);const G=I?-1:1;for(;!(j!=null&&j.isText)&&Ct(n.state.doc,w+G);)w+=G,j=n.state.doc.nodeAt(w);const{left:V,bottom:X,top:q}=n.coordsAtPos(w,I?-1:1),k=_-P;function J(){if(I)return Math.max(V-P-g,0);let N=V-P;return N+g>k&&(N=-(g-k)),N}function at(){const N=window.innerHeight-X>h*2;return I&&N?{top:X-W+8,aboveOrBelow:_t.BELOW}:{top:q-W-h-8,aboveOrBelow:_t.ABOVE}}const L=at();return{left:J(),top:L.top,aboveOrBelow:L.aboveOrBelow,toolbarSize:a}},[d,r]),T=E.useCallback(()=>{var a,g;return(g=(a=r())==null?void 0:a.dom)!=null?g:null},[r]),A=[{label:c.formatMessage(S.heading1),className:"text-5xl font-semibold",onClick:()=>{C.logButtonClick(y.TOOLBAR_FORMAT_HEADER1),ot(r(),1)}},{label:c.formatMessage(S.heading2),className:"text-3xl font-semibold",onClick:()=>{C.logButtonClick(y.TOOLBAR_FORMAT_HEADER2),ot(r(),2)}},{label:c.formatMessage(S.heading3),className:"text-2xl font-semibold",onClick:()=>{C.logButtonClick(y.TOOLBAR_FORMAT_HEADER3),ot(r(),3)}},{label:c.formatMessage(S.body),className:"text-base",onClick:()=>{C.logButtonClick(y.TOOLBAR_FORMAT_PARAGRAPH),ho(r())}}],l=()=>{const a=r();if(!a)return null;const{state:g}=a,{from:h,to:n,sourceFrom:b,sourceTo:x}=Re(g);return h==null||n==null||b==null||x==null?(C.logError("Prosemirror getSelectionRange has null values",null,{from:h,to:n,sourceFrom:b,sourceTo:x}),null):{from:h,to:n,sourceFrom:b,sourceTo:x}},v=(a,g,h)=>{const n=r(),b=l();if(b==null)return;const{sourceFrom:x,sourceTo:O}=b,R={start:x,end:O};if(d&&n){const M=d.tr.setSelection(Oe.create(d.doc,d.selection.anchor));n.dispatch(M)}C.logButtonClick(y.TOOLBAR_FORMAT_STYLE,{action:{action:h.action,id:h.id,title:h.title},prompt:g,sourceFrom:x,sourceTo:O}),u==null||u(a,R,c.formatMessage(g),h)};return e.jsxs(so,{isWaitingForCommentResponse:m,isSendDisabled:s,onAddComment:o,toolbarType:no.WRITING,getToolbarPosition:i,getEditorDom:T,getSelectionRange:l,children:[f&&e.jsxs(e.Fragment,{children:[e.jsx(B.Separator,{}),e.jsx(B.Popover,{label:c.formatMessage(S.format),hideLabel:t<=400,icon:Ye,align:"center",children:e.jsx("div",{className:H("bg-token-main-surface-primary flex w-48 flex-col items-stretch rounded-xl border p-1",Mt),children:Se.map(a=>{const{title:g,icon:h}=a;return e.jsxs("button",{onClick:n=>{"prompt"in a&&v(n,a.prompt,a)},className:"bg-token-main-surface-primary dark:hover:bg-token-main-surface-secondary flex flex-row items-center gap-x-2 rounded-md p-3 hover:bg-[#f5f5f5]",children:[e.jsx("div",{className:"flex",children:e.jsx(h,{className:"icon"})}),e.jsx("div",{className:"line-clamp-1 flex-auto text-start text-sm",children:c.formatMessage(g)})]},a.id)})})})]}),e.jsx(B.Separator,{}),e.jsx(B.Action,{label:c.formatMessage(S.bold),hideLabel:!0,icon:ao,onClick:()=>{C.logButtonClick(y.TOOLBAR_FORMAT_BOLD),Pt(r(),Qe.proseMirrorMarkName())},onMouseDown:a=>a.preventDefault()}),e.jsx(B.Action,{label:c.formatMessage(S.italic),hideLabel:!0,icon:ro,onClick:()=>{C.logButtonClick(y.TOOLBAR_FORMAT_ITALIC),Pt(r(),to.proseMirrorMarkName())},onMouseDown:a=>a.preventDefault()}),e.jsx(B.Popover,{label:c.formatMessage(S.format),hideLabel:!0,icon:io,children:e.jsx("div",{className:H("border-token-border-default bg-token-main-surface-primary flex flex-col items-stretch rounded-xl border p-1",Mt),children:A.map(({label:a,className:g,onClick:h})=>e.jsx("button",{onClick:h,className:"hover:bg-token-main-surface-secondary w-full rounded-xl p-4 text-start",children:e.jsx("div",{className:g,children:a})},a))})})]})},S=Bt({bold:{id:"qqbk91",defaultMessage:"Bold"},italic:{id:"5oh4LV",defaultMessage:"Italic"},format:{id:"z8IGv0",defaultMessage:"Transform"},heading1:{id:"AR5o30",defaultMessage:"Heading 1"},heading2:{id:"zb/wrc",defaultMessage:"Heading 2"},heading3:{id:"xZJvLM",defaultMessage:"Heading 3"},body:{id:"Hi6z3L",defaultMessage:"Body"},caption:{id:"VXpL7v",defaultMessage:"Caption"},bullets:{id:"2vznKX",defaultMessage:"Bullets"},outline:{id:"Xmbt6r",defaultMessage:"Outline"},table:{id:"0UjL6P",defaultMessage:"Table"}});function wt({position:t,numEdits:o,closestEditId:s}){const m=Ut(),u=kt(),c=t==="top"?$e:qe,r=()=>{const f=m();if(!f||!s)return;const i=Ee(f,s);if(i.length===0){Me.addError("Edit could not be found while attempting to scroll",{closestEditId:s});return}i[t==="top"?0:i.length-1].scrollIntoView({behavior:"smooth",block:"center"})},d=t==="top"?-4:4;return e.jsx($,{children:o>0&&e.jsx(D.div,{className:H("absolute start-1/2 z-20 select-none",{"bottom-[20px]":t==="bottom","top-[20px]":t==="top"}),initial:{scale:.95,translateY:d,translateX:"-50%",opacity:0},animate:{scale:1,translateY:0,translateX:"-50%",opacity:1},exit:{scale:.95,translateY:d,translateX:"-50%",opacity:0},transition:{type:"spring",duration:.3},children:e.jsxs("div",{className:H("flex items-center justify-center rounded-full border px-4 py-2","border-token-main-surface-tertiary bg-token-main-surface-primary hover:bg-token-main-surface-secondary shadow-md"),"aria-label":u.formatMessage(Lt.ariaLabel),role:"button",onClick:r,children:[e.jsx(pe,bt(ht({},Lt.label),{values:{count:o}})),e.jsx(c,{className:"icon-sm ms-2"})]})})})}const Lt=Bt({label:{id:"Pf30w4",defaultMessage:"{count, plural, one {1 more edit} other {{count} more edits}}"},ariaLabel:{id:"qTJjzl",defaultMessage:"Button to scroll the next edit into view."}});function Eo({diff:t=null}){var f;const o=Vt(),s=Ut(),[m,u]=E.useState([]),[c,r]=E.useState([]),d=E.useCallback(()=>{const i=s();if(!i||!t)return;const T=[],A=[];for(const l of t.edits){const v=xe(i,l.id);if(v.length>0){const a=Te(v);a.bottom<0?T.push([l.id,a]):a.top>Ft(o).height&&A.push([l.id,a])}}T.sort(([,l],[,v])=>l.bottom-v.bottom),A.sort(([,l],[,v])=>l.top-v.top),u(T.map(([l])=>l)),r(A.map(([l])=>l))},[o,t,s]);return ye((f=t==null?void 0:t.edits)!=null?f:[],d),E.useEffect(()=>{const i=setTimeout(d,500);return()=>{clearTimeout(i)}},[d]),e.jsxs(e.Fragment,{children:[e.jsx(wt,{position:"top",numEdits:m.length,closestEditId:m[m.length-1]}),e.jsx(wt,{position:"bottom",numEdits:c.length,closestEditId:c[0]})]})}const st=Ce(()=>({rejectedEdits:new Set,hoveredEditId:null})),{setState:Ns}=st,xo=({pos:t})=>{var n;const o=nt()(),s=Wt();if(!o||!s||t==null)return null;const{doc:m}=s,{top:u,left:c}=o.coordsAtPos(0),{top:r,left:d}=o.coordsAtPos(t),f=m.nodeAt(t),i=t+((n=f==null?void 0:f.nodeSize)!=null?n:0)-1,{top:T}=o.coordsAtPos(t+1),{top:A,bottom:l,right:v}=o.coordsAtPos(i),g=(T>=A?v:o.dom.getBoundingClientRect().right)-d,h=l-r+4;return e.jsx(D.div,{style:{top:r-u,left:d-c,height:h,width:g},className:H("absolute after:absolute after:inset-x-[-4px] after:inset-y-0 after:z-0 after:rounded-md after:bg-[Highlight] after:content-[''] dark:after:bg-[Highlight]",Xe.blockCommentHover),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0}})},To=({pos:t})=>e.jsx($,{children:t!=null&&e.jsx(xo,{pos:t})}),yt=24,Ao=16,vo=0,Io=8,jt=4,Os=({comments:t,diff:o,readonlyReason:s,isDisabled:m=!1,isRewriting:u=!1,isSendDisabled:c=!1,previousComments:r,previousValue:d,isPreview:f=!1,isRequestActive:i=!1,isWaitingForCommentResponse:T=!1,targetedContent:A=null,onAcceleratorsExpandedChange:l,getAutocompleteSuggestion:v,getStableCommentId:a=Je,onBlur:g,onCancelRequest:h,onChange:n,onSave:b,onAddComment:x,onSubmitAccelerator:O,onAcceptComment:R,onDismissComment:M,onExitShowChanges:I,value:_,commentsMode:P=et.ENABLED,hideAccelerators:W=!1,hideToolbar:w=!1,hideEditOverlay:j=!1,safeUrls:G,width:V,modelCursor:X,shouldResetSelection:q,metadata:k})=>{var mt,ut;const J=Vt(),L=Xt()&&f,N=E.useRef(null),rt=E.useRef(null);lo(rt,N);const[{width:$t},qt]=zt(),it=E.useRef(null),[Z,lt]=E.useState(!1),Jt=it.current,Zt=(mt=je(Jt))!=null?mt:!1,ct=vt(()=>L?_e()?De:He:It()?Ve:We),F=(()=>{if(V==null){const p=Zt?0:Nt();return $t-p}return V-ct*2-Nt()})(),K=L?F:F>=Ot+Be?Ot:Ge,Kt=F-K,Qt=U(({commentingOn:p})=>p),te=U(({hoveredCommentId:p})=>p),ee=U(({focusedCommentId:p})=>p),oe=U(({hoveredBlockCommentLauncherPos:p})=>p),se=st(p=>p.hoveredEditId),ne=st(p=>p.rejectedEdits);E.useEffect(()=>{var p;A==null&&((p=N.current)==null||p.revertChanges())},[A]),E.useEffect(()=>{var p,z;(p=N.current)==null||p.flushChanges(),(z=N.current)==null||z.UNSAFE_setValue(_)},[_]);const ae=vt(()=>{if(L)return jt;if(!It())return f?vo:Ao;if(f)return yt;const p=Io/100*Ft(J).height;return Math.max(yt,p)}),re=({currentTarget:p,nativeEvent:z})=>{const ft=z.composedPath();for(const Q of ft.slice(0,ft.indexOf(p)))if(Q instanceof HTMLElement&&(Q.id===At.PROSEMIRROR_EDITOR_CONTAINER||Q.id===At.PROSEMIRROR_CONTEXT_CHILDREN))return;I==null||I()},dt=L?jt:f?"1rem":"max(3rem,24vh)";return e.jsx("div",{className:"h-full w-full",ref:rt,onClick:re,children:e.jsx("div",{className:Fe.document,style:{margin:"0 ".concat(ct,"px"),paddingTop:ae},children:e.jsx("div",{ref:Gt(qt,it),className:"z-0 flex w-full flex-col items-center",children:e.jsxs(tt,{comments:t,diff:o,editorRef:N,hoveredCommentId:te,focusedCommentId:ee,hoveredEditId:se,rejectedEdits:ne,value:u&&!Z?"":_,commentingOn:Qt,isDisabled:m||u||Z,onBlur:g,onChange:n,onSave:b,width:K,safeUrls:G,wrapperClassName:"relative z-10 flex max-w-full h-fit",paddingBottom:dt,modelCursor:X,shouldResetSelection:q,transparentBackground:!Z,contentReferences:(ut=k==null?void 0:k.contentReferences)!=null?ut:[],getAutocompleteSuggestion:v,children:[e.jsxs(tt.EditorChildren,{children:[e.jsx($,{onExitComplete:()=>lt(!1),children:u&&e.jsx(go,{isRewriting:u,documentWidth:K,previousValue:d,previousComments:r,value:_,paddingBottom:dt,onStart:()=>lt(!0)})}),!w&&e.jsx(bo,{availableWidth:F,isWaitingForCommentResponse:T,isSendDisabled:c,onAddComment:x,onSubmitAccelerator:O}),P===et.ENABLED&&e.jsx(To,{pos:oe}),e.jsx($,{children:P!==et.ALL_HIDDEN&&e.jsx(ke,{availableWidth:Kt,comments:t,commentsMode:P,isRequestActive:i,onAddComment:x,onAcceptComment:R,onDismissComment:M,isWaitingForCommentResponse:T,disableBlockComments:i,getStableCommentId:a})})]}),e.jsxs(tt.ContextChildren,{children:[!j&&o&&e.jsx(Eo,{diff:o}),!W&&e.jsx(Pe,{isRequestActive:i,onSubmit:O,isVisuallyHidden:c||!!(s!=null&&s.isStreamingFromNative)||(s==null?void 0:s.isReadonly)&&!s.isStreaming,actions:we,onCancel:h,onExpandedChange:l})]})]})})})})};export{Os as DocumentComposer};
//# sourceMappingURL=ioti9og9mipkmwyd.js.map
