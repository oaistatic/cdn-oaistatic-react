var wt=Object.defineProperty;var nt=Object.getOwnPropertySymbols;var Tt=Object.prototype.hasOwnProperty,Ct=Object.prototype.propertyIsEnumerable;var at=(t,o,a)=>o in t?wt(t,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[o]=a,$=(t,o)=>{for(var a in o||(o={}))Tt.call(o,a)&&at(t,a,o[a]);if(nt)for(var a of nt(o))Ct.call(o,a)&&at(t,a,o[a]);return t};import{j as e,b as ft,M as rt,r as p}from"./n75kuy1cx6f5mogg.js";import{i as z,j as N,Y as gt,gV as Pt,e as k,B as Et,aT as O,aO as At,bG as Rt,aY as Dt,h_ as zt,f as Gt,P as it,aV as ot,R as Bt,aR as Ft,aS as $t,bJ as Ot,aZ as st,ia as lt,br as ct,bq as dt}from"./ewse8exzafeu10ji.js";import{jT as ht,fC as bt,fG as kt,dF as Wt,gY as Lt,m5 as Ht,m6 as Yt,m7 as qt,m8 as Vt,m9 as Jt,ma as Kt,eW as Qt,mb as ut,mc as Zt}from"./ny10lj7zpuz89fvf.js";import{S as Xt}from"./l5i1wpx91f7uj9ss.js";import{CoT as It}from"./brsl39gvuuglwjj6.js";import{M as xt}from"./em5q5yhbyv41ft0j.js";import"./gdvi3vhnli0o4q8m.js";import"./ou1s0kowmldvhx32.js";import"./ltsv6em2m484o9yy.js";import"./j0qx0vaadhi6g6bi.js";import"./ly9hghfho7bi4z70.js";import"./pbl95wx6493wq92j.js";import"./heyok871zyju5auh.js";import"./mfyrsje6hk3w0xmg.js";import"./n1zi1frmhwo1ei8c.js";import"./ltq3thvd9yhrdk52.js";function mt({message:t,simulatedDuration:o=8*60*1e3,maxFill:a=100,isCircular:r=!1}){var c;((c=t==null?void 0:t.metadata)==null?void 0:c.model_slug)!=="o1-pro"&&(o=20*60*1e3);const u=t!=null&&t.create_time?new Date(t.create_time*1e3):Date.now(),s=ht(+u,o),d=z(),i=N(d,"3208967109");return r?e.jsx(bt,{percentage:s,className:"me-4 w-full!",transitionDuration:"".concat((100-s)/100*5,"s"),transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)"}):e.jsx(kt,{percentage:Math.min(s,a),className:"me-4 w-full!",backgroundClassName:"bg-token-sidebar-surface-secondary rounded-full",barClassName:"bg-token-text-secondary rounded-full",transitionDuration:"".concat((100-s)/100*.2,"s"),transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)",height:i?4:8})}function Ut({title:t,content:o,buttons:a,time:r,icon:u,size:s="default",progressBar:d,disabled:i=!1,onClick:c}){const x=s==="small"?"w-full flex max-w-[calc(0.8*var(--thread-content-max-width,40rem))] ps-[20px] pt-[13px] pb-[10px] ".concat(i?"":"gap-4"):"w-full gap-4 px-[22px] pb-[22px] pt-[18px]",f=c?"cursor-pointer":"",m=s==="small"?"text-[15px]":"",j=gt(Pt);return e.jsxs("div",{className:k("relative inline-flex flex-col items-start justify-start rounded-2xl border","bg-token-bg-primary border-token-border-default box-content rounded-2xl border bg-clip-padding px-5 py-4",!j&&"mx-[calc(--spacing(-2)-1px)] -my-[1px] @max-3xl:-top-2 @3xl:-start-3 @3xl:-top-4",x,f,m),onClick:c,children:[e.jsxs("div",{className:k("flex flex-col items-start justify-start self-stretch",s!=="small"&&"gap-1.5"),children:[e.jsxs("div",{className:k("inline-flex items-start justify-start self-stretch",s!=="small"&&"gap-2"),children:[e.jsx("div",{className:k("shrink grow basis-0 leading-normal font-medium","text-token-text-secondary hover:text-token-text-primary"),children:t}),e.jsx("div",{className:"relative h-6 w-6"}),!i&&(u||e.jsx(Xt,{className:"relative h-6 w-6"}))]}),e.jsx("div",{className:k("flex w-full flex-col items-start justify-start",s==="small"&&"mt-[-2px]"),children:e.jsx("div",{className:k("inline-flex w-full items-start justify-start self-stretch rounded-sm",s==="small"?"gap-1":"gap-2.5 py-1"),children:e.jsx("div",{className:k("w-full leading-relaxed font-normal",i?"text-token-text-tertiary":"text-token-text-secondary"),children:o})})})]}),d?e.jsxs("div",{className:k("mb-2 inline-flex items-center justify-between self-stretch",(a==null?void 0:a.length)&&"mt-[-10px]"),children:[d,a]}):e.jsxs("div",{className:"inline-flex items-center justify-end self-stretch",children:[r&&e.jsx("div",{className:"text-token-text-tertiary shrink grow basis-0 text-[15px] leading-normal font-normal",children:r}),e.jsx("div",{className:"flex gap-2",children:a})]})]})}function pt({message:t,isCircular:o=!1}){var x,f,m;const a=5.333333333333334;let r=(f=(x=t==null?void 0:t.metadata)==null?void 0:x.tournament_progress)!=null?f:0;const u=((m=t==null?void 0:t.metadata)==null?void 0:m.model_slug)==="o1-pro"?8*60*1e3:20*60*1e3,s=t!=null&&t.create_time?t.create_time*1e3:Date.now(),d=ht(s,u);r=Math.max(d,r);const i=z(),c=N(i,"3208967109");return c&&(r=Math.max(r,a)),o?e.jsx(bt,{percentage:r,className:"me-4 w-full!",sizeOverride:20,thickness:1/8,transitionDuration:"".concat((100-r)/100*5,"s"),transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)"}):e.jsx(kt,{percentage:r,className:"me-4 w-full!",backgroundClassName:"bg-token-sidebar-surface-secondary dark:bg-token-border-default rounded-full",barClassName:"bg-token-text-secondary rounded-full",transitionDuration:"".concat((100-r)/100*5,"s"),transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)",height:c?4:8})}function Mt({errorNotice:t,onOpenSidebarSummarizer:o,isReceivingUpdates:a,lastMessage:r,latestTitle:u,summarizationHeadline:s,handleSkipClick:d}){var w,y,P,E,n,A,_;const i=z(),c=ft(),x=N(i,"4094234945"),f=N(i,"3208967109"),m=N(i,"3327816228"),j=x?pt:mt,v=a&&m&&((w=r==null?void 0:r.metadata)==null?void 0:w.tournament_progress),g=(((y=r==null?void 0:r.metadata)==null?void 0:y.bon_skipped)||((P=r==null?void 0:r.clientMetadata)==null?void 0:P.bonSkipPending))&&a;if(f){if(g)return e.jsx("span",{className:"result-streaming pulse relative pt-1",children:e.jsx("span",{})});const h=(n=a?u:(E=r==null?void 0:r.metadata)==null?void 0:E.finished_text)!=null?n:c.formatMessage({id:"hgnsat",defaultMessage:"Thinking"});return e.jsxs("div",{className:"flex items-start gap-3 pb-2",children:[e.jsxs("div",{className:"flex w-full flex-col",children:[e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx("button",{type:"button",onClick:o,className:"group inline-flex max-w-full items-center rounded-md focus:outline-none",children:e.jsxs("span",{className:a?"loading-shimmer text-token-text-secondary inline-flex max-w-full items-center gap-0.5 truncate text-base leading-5 font-medium md:text-base":"text-token-text-tertiary hover:text-token-text-primary inline-flex max-w-full items-center gap-0.5 truncate text-base leading-5 font-medium md:text-base",children:[h,e.jsx(Wt,{className:"icon-xs text-token-text-tertiary group-hover:text-token-text-primary"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:d,className:"text-token-text-tertiary hover:text-token-text-primary whitespace-nowrap transition-opacity duration-1000 ease-out ".concat(v?"pointer-events-auto opacity-100":"pointer-events-none opacity-0"),"aria-hidden":!v,tabIndex:v?0:-1,children:e.jsx("span",{className:"flex items-center gap-0.5 underline decoration-dotted decoration-[8%]",children:e.jsx(rt,{id:"xMM6dg",defaultMessage:"Answer now"})})}),a&&e.jsx("div",{className:"ms-1 shrink-0 self-start md:hidden",children:e.jsx(j,{message:r,isCircular:!0})})]})]}),a&&e.jsx("div",{className:"mt-[22px] mb-2 hidden self-stretch md:inline-flex",children:e.jsx("div",{className:"w-full max-w-[150px]",children:e.jsx(j,{message:r,isCircular:!1})})})]}),t]})}return e.jsxs("div",{className:"flex pb-2",children:[e.jsx(Ut,{buttons:a?[e.jsx(Et,{onClick:h=>{h.stopPropagation(),o()},color:"secondary",className:"text-token-text-secondary h-[38px]! text-[15px] font-normal",children:e.jsx("div",{className:"px-1",children:e.jsx(rt,{id:"wQcuK8",defaultMessage:"Details"})})},"Details")]:[],time:null,title:s,icon:a?e.jsx("div",{className:""}):null,content:a?"".concat(u,"..."):(_=(A=r==null?void 0:r.metadata)==null?void 0:A.finished_text)!=null?_:"",size:"small",disabled:!a,onClick:o,progressBar:a?x?e.jsx(pt,{message:r}):e.jsx(mt,{message:r}):null}),t]})}const te=/\*\*(.*?)(?:\*\*|\n|$)/g,ee=t=>{let o=null,a;for(;(a=te.exec(t))!=null;)o=a[1].trim();return o},ne=()=>null;function _e({messages:t,isStreaming:o,isCompletionRequestInProgress:a,hasActiveRequest:r,isLastMessage:u,isFinalTurn:s,isFeedbackEnabled:d,clientThreadId:i,currentGroupedMessageIndex:c,turnIndex:x}){var J,K,Q,Z,X,I,U,M,tt,et;const[f,m]=p.useState(""),[j,v]=p.useState(!1),[g,w]=p.useState(!1),y=O(i),P=((J=Lt(i))==null?void 0:J.value)===At.STREAMING,E=Ht(O(i)),n=Rt(t),A=n==null?void 0:n.id,_=(K=n==null?void 0:n.metadata)==null?void 0:K.initial_text,h=(Q=n==null?void 0:n.metadata)==null?void 0:Q.summarization_headline,R=t.map(l=>Dt(l)).join("\n\n"),{toggleThreadSidebar:G,openThreadSidebar:W}=zt(),L=ft(),H=Gt(),b=(Z=n==null?void 0:n.metadata)==null?void 0:Z.async_task_id;Yt(b,n,i),qt(b);const S=Vt(l=>Jt.getTask(b!=null?b:"",l)),Y=p.useCallback(()=>{G(b?{type:"cot",clientThreadId:i,messageWithTaskMetadata:n}:{type:"summarizer",clientThreadId:i,currentGroupedMessageIndex:c,turnIndex:x})},[G,i,c,x,b,n]),q=Kt()&&S&&ut(S);p.useEffect(()=>{if(!q){w(!1);return}g||(W({type:"cot",clientThreadId:i,messageWithTaskMetadata:n}),w(!0))},[q,Y,g,i,n,W]);const jt=p.useCallback(()=>{if(!y||!(n!=null&&n.id))return;it.logEventWithStatsig("chatgpt_web_pro_skip_clicked","chatgpt_web_pro_skip_clicked",{conversationId:y,messageId:n.id});const l=n.id,T=n.clientMetadata?$({},n.clientMetadata):void 0,B=n.metadata?$({},n.metadata):void 0;ot(i,F=>{st.updateTree(F,C=>{C.updateNodeMetadata(l,{bonSkipPending:!0}),C.updateNodeMessageMetadata(l,{bon_skipped:!0})})}),Bt.safePost("/pro_mode/{conversation_id}/skip",{parameters:{path:{conversation_id:y}}}).catch(()=>{H.danger(L.formatMessage({id:"summmarizer.skip.toast",defaultMessage:"Failed to answer now. Please try again."}),{hasCloseButton:!0,toastId:"summarizer_skip_failed"}),ot(i,F=>{st.updateTree(F,C=>{C.updateNodeMetadata(l,{bonSkipPending:T==null?void 0:T.bonSkipPending}),C.updateNodeMessageMetadata(l,{bon_skipped:B==null?void 0:B.bon_skipped})})})})},[i,y,L,n,H]),yt=z(),V=N(yt,"3208967109");p.useEffect(()=>{const l=ee(R);if(l){m(l);return}if(V&&h!=null){m(h);return}_!=null&&m(_)},[R,h,V,_]),p.useEffect(()=>{R.length>0&&v(!0)},[R]),p.useEffect(()=>{j&&it.logEvent("Tool: Received a8km123 message",{client_thread_id:i,message_id:A,conversationId:O(i)})},[j]);const St=s&&u&&(P||o),_t=ne()!=null,Nt=Ft.isLastActorMessage($t(i),t[0].id),vt=!!Ot(i,l=>l==null?void 0:l.sharedConversationMetadata),D=Qt(t[0],Nt,_t,a||r,vt);if(!E&&((I=(X=n==null?void 0:n.metadata)==null?void 0:X.finish_details)==null?void 0:I.type)==="interrupted"&&((M=(U=n==null?void 0:n.metadata)==null?void 0:U.finish_details)==null?void 0:M.reason)!=="server_timeout"||(tt=n==null?void 0:n.clientMetadata)!=null&&tt.err)return e.jsx("div",{children:D&&e.jsx(xt,{errorState:D,nodeId:t[0].id,isFeedbackEnabled:d,clientThreadId:i,isUserTurn:!1})});if(b){const l=S?ut(S):!1,T=l?Zt((et=S==null?void 0:S.rows)!=null?et:[]).groups:ae(n);return e.jsx(It,{isStreaming:l,isFinalAssistantTurn:s,isAgentTurn:!1,messageGroups:T,clientThreadId:i,turnIndex:x,currentGroupedMessageIndex:c,latestError:void 0})}return e.jsx(Mt,{errorNotice:D&&e.jsx(xt,{errorState:D,nodeId:t[0].id,isFeedbackEnabled:d,clientThreadId:i,isUserTurn:!1}),onOpenSidebarSummarizer:Y,isReceivingUpdates:St,lastMessage:n,latestTitle:f,summarizationHeadline:h,handleSkipClick:jt})}function ae(t){var o,a,r,u,s,d,i,c;return[{messages:[{id:(o=t==null?void 0:t.id)!=null?o:"",create_time:t==null?void 0:t.create_time,content:{content_type:dt.StructuredThoughts,thoughts:[{summary:(r=(a=t==null?void 0:t.metadata)==null?void 0:a.finished_text)!=null?r:"",content:(s=(u=t==null?void 0:t.metadata)==null?void 0:u.finished_text)!=null?s:""}]},author:{role:ct.Assistant}}],type:lt.StructuredThoughts},{messages:[{id:(d=t==null?void 0:t.id)!=null?d:"",create_time:t==null?void 0:t.create_time,content:{content_type:dt.ReasoningRecap,content:(c=(i=t==null?void 0:t.metadata)==null?void 0:i.finished_text)!=null?c:""},author:{role:ct.Assistant}}],type:lt.ReasoningRecap}]}export{_e as default};
//# sourceMappingURL=cyuzt9lx454bpdrm.js.map
