var E=Object.defineProperty,I=Object.defineProperties;var j=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var p=(e,s,t)=>s in e?E(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t,x=(e,s)=>{for(var t in s||(s={}))A.call(s,t)&&p(e,t,s[t]);if(y)for(var t of y(s))D.call(s,t)&&p(e,t,s[t]);return e},M=(e,s)=>I(e,j(s));var S=(e,s)=>{var t={};for(var a in e)A.call(e,a)&&s.indexOf(a)<0&&(t[a]=e[a]);if(e!=null&&y)for(var a of y(e))s.indexOf(a)<0&&D.call(e,a)&&(t[a]=e[a]);return t};import{r as u,j as g,R as U}from"./n75kuy1cx6f5mogg.js";import{eS as b,eT as w,eU as k,eV as v,eW as F,aL as L}from"./ny10lj7zpuz89fvf.js";import{T as B}from"./em5q5yhbyv41ft0j.js";import{hP as G,aY as X,aR as _,aS as q,bJ as J,pn as V}from"./ewse8exzafeu10ji.js";function W(e){var T;const o=e,{bufferType:s,isActivelyStreaming:t,messages:a,parts:d}=o,n=S(o,["bufferType","isActivelyStreaming","messages","parts"]),i=a[a.length-1].id,[l,f]=u.useState(G(d)),r=u.useRef(void 0),c=u.useMemo(()=>d,[d,!1]);if(r.current===void 0)switch(s){case"Adaptive":r.current=new k(c,f,t);break;case"ChunkedCatchup":r.current=new w(c,f,t);break;case"Punctuation":r.current=new b(c,f,t);break}return u.useEffect(()=>{r.current!=null&&(r.current.onMessagePartsUpdated(c,t),r.current.isBuffering()&&v.addDelayedRenderingMessage(i))},[c,i,t]),u.useEffect(()=>{r.current!=null&&r.current.removeDelayedRender()&&v.removeDelayedRenderingMessage(i)},[l,i]),u.useEffect(()=>()=>v.removeDelayedRenderingMessage(i),[i]),u.useEffect(()=>()=>{var h;(h=r.current)==null||h.destroy(),r.current=void 0},[]),g.jsx(B,M(x({},n),{messages:a,parts:d,displayParts:l,isActivelyStreaming:t||!!((T=r.current)!=null&&T.isBuffering())}))}function Y({message:e,isCompletionInProgress:s,hasActiveRequest:t,clientThreadId:a,className:d,isUserTurn:n,isFinalUserTurn:i,isWithinFirstAssistantTurns:l,turnIndex:f,isFeedbackEnabled:r,prevGroupedMessageType:m,prevGroupedMessages:c,citableMessages:o,superWidgetImages:T}){var P,R,C;const h=u.useMemo(()=>"parts"in e.content?e.content.parts:[X(e)],[e]);return g.jsxs(g.Fragment,{children:[g.jsx(z,{parts:h,messages:[e],hasActiveRequest:t,isCompletionInProgress:s,className:d,citations:(P=e.metadata)==null?void 0:P.citations,contentReferences:(R=e.metadata)==null?void 0:R.content_references,attachments:(C=e.metadata)==null?void 0:C.attachments,isUserTurn:n,isFinalUserTurn:i,isWithinFirstAssistantTurns:l,turnIndex:f,id:e.id,isFeedbackEnabled:r,clientThreadId:a,prevGroupedMessageType:m,prevGroupedMessages:c,citableMessages:o,superWidgetImages:T}),!1]})}const Z=U.memo(Y),$=()=>null;function z(e){const s=$()!=null,t=e.messages.length>1,a=_.isLastActorMessage(q(e.clientThreadId),e.messages[0].id),d=!!J(e.clientThreadId,o=>o==null?void 0:o.sharedConversationMetadata),n=t?void 0:F(e.messages[0],a,s,e.isCompletionInProgress||e.hasActiveRequest,d),i=(n==null?void 0:n.flagSeverity)!=="danger"&&e.isCompletionInProgress,l=!e.parts.some(o=>o!==""),{bufferType:f,wordFadeType:r}=L(),[m,c]=u.useState(()=>r!=="indexed"&&f!=="none"&&!e.isUserTurn&&(e.isCompletionInProgress||l&&!n));return n&&m&&c(!1),m?g.jsx(W,M(x({},e),{bufferType:f,isActivelyStreaming:i,errorState:n})):g.jsx(B,M(x({},e),{displayParts:V({isUserTurn:e.isUserTurn,parts:e.parts}),isActivelyStreaming:i,errorState:n}))}export{Z as T,z as a};
//# sourceMappingURL=gowyl4x2bs7hfi4a.js.map
