const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/bygkq777mc84o32a.js","assets/n75kuy1cx6f5mogg.js","assets/ny10lj7zpuz89fvf.js","assets/ewse8exzafeu10ji.js","assets/root-l2v84m1w.css","assets/conversation-small-hotcas67.css","assets/ca3g7gcaj954pu3h.js","assets/lksc5q29mjlblqoo.js","assets/da0anzdj3bll2tbv.js","assets/mzj5jqjjpo006z7a.js","assets/nnb0v70g00lhjclz.js","assets/fh2tsu8ocsi22jc3.js","assets/jaupzjmp9wknd4io.js","assets/jtxj1xvdu5i7mvdh.js","assets/j2ui4c2m3nj8pqst.js","assets/h2dwuj1m5ps9l7uv.js"])))=>i.map(i=>d[i]);
var ve=Object.freeze,Ve=Object.defineProperty;var pe=(e,t)=>ve(Ve(e,"raw",{value:ve(t||e.slice())}));import{e as W,B as Ke,H as Qe,z as Je,af as Ye,p as _e,l2 as je,tf as Xe,mM as be,jr as Ze,l3 as ke,i as Ee,dv as Le,a9 as Pe,q as Ae,F as et,_ as tt,a6 as De,iy as nt,iA as at,iB as st,k as it,at as oe,bJ as ot,P as rt,aR as re,aS as Ue,R as lt,aV as ct,aZ as ut,eK as dt,nQ as mt,f2 as gt,cw as ft,ej as ht,ek as xt}from"./ewse8exzafeu10ji.js";import{j as n,m as X,b as L,g as wt,r,A as St,u as Te,i as It,c as vt}from"./n75kuy1cx6f5mogg.js";import{I as se,D as Be,u as pt}from"./wxk4ecobz1qzi6ic.js";import{oh as _t,jT as jt,fC as bt,tT as kt,dS as yt,dL as Z,dU as Rt,dW as Mt,dN as Ct,tU as Nt,tV as Gt,tW as Et,cs as ze,dM as Oe,tX as At,tY as j,mN as Dt,tZ as le,df as Ut,t_ as Tt,t$ as ye,u0 as Bt,u1 as zt,l as Ot}from"./ny10lj7zpuz89fvf.js";import{C as Fe}from"./heyok871zyju5auh.js";import{D as Ft}from"./mfyrsje6hk3w0xmg.js";import{C as Ht}from"./gdvi3vhnli0o4q8m.js";const He=({children:e,isDimensionsUnknown:t})=>n.jsxs(X.div,{className:W(["relative max-w-[480px] rounded-2xl",t&&"aspect-square overflow-hidden"]),children:[n.jsx("div",{className:"bg-token-main-surface-secondary pointer-events-none absolute inset-0"}),n.jsx("div",{className:"relative h-full",children:e})]}),qt=({children:e,isDimensionsUnknown:t,width:a,height:s})=>n.jsxs(X.div,{layout:!0,transition:{duration:.3,ease:"easeInOut"},exit:{opacity:0,transition:{duration:.1,ease:"easeInOut"}},className:W(["relative max-w-[480px] overflow-hidden rounded-2xl",t&&"aspect-square"]),style:{width:a!=null?a:"auto",height:s!=null?s:"auto"},children:[n.jsx("div",{className:"bg-token-main-surface-secondary pointer-events-none absolute inset-0"}),n.jsx("div",{className:"relative h-full",children:e})]}),$t=()=>{const e=L(),t=wt();return n.jsxs("div",{className:"absolute start-0 bottom-0 flex w-full items-center justify-between bg-white/10 p-4",children:[n.jsxs("div",{className:"flex min-w-0 flex-col",children:[n.jsx("span",{className:"text-sm font-medium text-white",children:e.formatMessage({id:"PlfJ+x",defaultMessage:"Creation might take a moment"})}),n.jsx("span",{className:"text-sm font-normal text-white/80",children:e.formatMessage({id:"4JG8yC",defaultMessage:"Upgrade to create faster"})})]}),n.jsx(Ke,{size:"medium",color:"primary-inverse",onClick:()=>Qe(t,"Image Gen Latency Upsell"),children:e.formatMessage(Je.getPlus)})]})};function Wt(e){const[t,a]=Ye(_e.ImageGenProgressUpsellV2,null,o=>o!=null&&typeof o=="object"&&(typeof o.lastSeenUpsellAt=="number"||o.lastSeenUpsellAt==null)&&(typeof o.lastUsedImageGen=="number"||o.lastUsedImageGen==null)&&(typeof o.lastMessageId=="string"||o.lastMessageId==null)&&(typeof o.lastCanBeSeen=="boolean"||o.lastCanBeSeen==null)),s=t&&t.lastSeenUpsellAt?je(t.lastSeenUpsellAt):null,i=t&&t.lastUsedImageGen?je(t.lastUsedImageGen):null,m=e?t&&t.lastMessageId===e?t.lastCanBeSeen:(s==null||Xe(s,be(new Date,3)))&&i!=null&&Ze(i,be(new Date,1)):!1;return{canBeSeen:m,markImageGenUsed:()=>{var o;if(e){const d={lastSeenUpsellAt:m?ke(new Date):(o=t==null?void 0:t.lastSeenUpsellAt)!=null?o:null,lastUsedImageGen:ke(new Date),lastMessageId:e!=null?e:null,lastCanBeSeen:m};a(d),localStorage.setItem(_e.ImageGenProgressUpsellV2,JSON.stringify(d))}}}}function Vt(){const[t,a]=r.useState(new Date);r.useEffect(()=>{a(new Date)},[]);const s=jt(+t,12e4);return n.jsx(bt,{percentage:s,sizeOverride:30,thickness:1/15,className:"text-white",backgroundStrokeClassName:"stroke-white/20",transitionDuration:"".concat((100-s)/100*.2,"s"),transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)"})}const qe=({isGettingStarted:e,messageId:t})=>{var g;const a=Ee(),s=Le(),i=(g=s==null?void 0:s.isFree())!=null?g:!1,{canBeSeen:m,markImageGenUsed:l}=Wt(t),o=i&&m&&Pe(a,"1997515563").get("should_show_image_gen_latency_upsell",!1);_t(()=>{l()});const d=L(),h=r.useMemo(()=>e?d.formatMessage({id:"SxQKjt",defaultMessage:"Getting started"}):d.formatMessage({id:"Y3ETLn",defaultMessage:"Creating image"}),[e,d]),c=Ae(a,"3019066937").get("should_show_cot_header",!1),u=r.useMemo(()=>e?n.jsx(Fe,{size:30,arcPercentage:.2,strokeWidth:2}):n.jsx(Vt,{}),[e]);return n.jsxs("div",{className:W("absolute inset-0 flex justify-between px-6 py-6",o?"items-start":"items-end"),children:[n.jsxs(St,{mode:"popLayout",children:[c&&n.jsx(X.span,{className:W("flex items-center gap-1 align-middle text-lg",!e&&"text-white"),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,overflow:"hidden",whiteSpace:"nowrap"},transition:{duration:.1,ease:"easeInOut"},children:h},h),n.jsx("div",{className:"flex flex-1 items-center justify-end",children:u})]}),o&&n.jsx($t,{})]})};var Ge;const Re=et.div(Ge||(Ge=pe(["invisible absolute top-3 flex gap-1 group-hover/paragen-image:visible z-2\n  ","\n  ",""])),({$rightAlign:e})=>e?"end-3":"start-3",({$alwaysVisible:e})=>e?"visible":""),Kt=({imageUrl:e})=>{const[t,a]=r.useState(void 0),s=L(),i=kt(),m=r.useCallback(()=>{const l=new Date,o=s.formatDate(l,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"});return"".concat(o,".png")},[s]);return n.jsxs("div",{className:"group/paragen-image absolute inset-0 z-3",children:[n.jsxs(Re,{$alwaysVisible:!0,children:[t!==!1&&n.jsx(se,{icon:yt,selected:t===!0,variant:"large",onClick:l=>{l.stopPropagation(),Z.paragenImageRated({liked:!0,analyticsContext:i}),a(!0)}}),t!==!0&&n.jsx(se,{icon:Rt,selected:t===!1,variant:"large",onClick:l=>{l.stopPropagation(),Z.paragenImageRated({liked:!1,analyticsContext:i}),a(!1)}})]}),n.jsx(Re,{$alwaysVisible:!0,$rightAlign:!0,children:n.jsx(se,{icon:Mt,variant:"large",onClick:l=>{l.stopPropagation(),Z.paragenDownload({analyticsContext:i}),Ct({url:e,fileName:m()})}})})]})};function $e({withLottie:e}){const a=L().formatMessage({id:"imagegen.progressIndicator.ariaLabel",defaultMessage:"Generating image..."});return n.jsx("div",{className:"absolute start-0 top-0 flex h-full w-full items-center justify-center rounded-full","aria-label":a,children:n.jsx(Fe,{size:40,arcPercentage:.2,children:n.jsx(Ft,{animate:e,matchTextColor:!0,className:"h-6 w-6"})})})}const We=300,Qt=1.3,Me=.05,Jt=/blur\(([\d.]+)px\)/,Yt={duration:We/1e3,ease:"linear"};function ie(e,t,a){var l,o,d,h,c;e.sort((u,g)=>u.lastSrcReceivedTime-g.lastSrcReceivedTime);const s=new Array(e.length).fill(0);for(let u=0;u<=e.length;u+=1){const g=u-1,b=u,x=(o=(l=e[g])==null?void 0:l.availablePercentComplete)!=null?o:0,f=(h=(d=e[b])==null?void 0:d.availablePercentComplete)!=null?h:1;if(t>=x&&t<=f&&x!==f){const S=(t-x)/(f-x);s[g]=1-S,s[b]=S}}const i=s[s.length-1],m=s[s.length-2];return i===1&&m===0&&(s[s.length-2]=.01),a&&t<=((c=e[0])==null?void 0:c.availablePercentComplete)&&(s[0]=1),s}const Xt=({alt:e,src:t,availablePercentComplete:a,onAnimationUpdate:s,ignoreFirstChunk:i=!1,isTransparent:m=!1,dimensions:l,onError:o,unconstrainedWidth:d=!1,progressLoaderProps:h})=>{const c=tt(),u=r.useMemo(()=>"url(".concat(c?Nt:Gt,")"),[c]),[g,b]=r.useState(!1),[x,f]=r.useState(1e3),[S,G]=r.useState(a!=null?a:0),[w,I]=r.useState(a===1?1:0),p=r.useRef(performance.now()),M=r.useRef(0),v=r.useRef([]),[O,E]=r.useState([0]),[V,B]=r.useState(a===1),$=r.useRef(!1),F=r.useRef(null),A=S===1,C=a===1&&V,D=l?l.width/l.height:1;r.useEffect(()=>{!g&&a&&(b(!0),M.current=performance.now())},[g,a]),r.useEffect(()=>{var R;const k=(R=v.current[v.current.length-1])==null?void 0:R.src;if(t&&t!==k){const U=v.current.findIndex(_=>_.availablePercentComplete===a);U!==-1?v.current[U]={src:t,availablePercentComplete:a!=null?a:0,lastSrcReceivedTime:performance.now()}:v.current.push({src:t,availablePercentComplete:a!=null?a:0,lastSrcReceivedTime:performance.now()}),E(ie(v.current,S,i))}},[t,S,i,a]);const P=r.useCallback(()=>{F.current&&a&&(f(C?We:(performance.now()-p.current)*Qt),(!i||$.current||a>=Me)&&a!==1&&I(a),$.current=!0,p.current=performance.now(),h==null||h.setHasImageReady(!0))},[a,C,i,h]),ee=r.useCallback(k=>{const R=parseFloat(k.height)/100;s==null||s(R),G(R),E(ie(v.current,parseFloat(k.height)/100,i))},[s,i]),te=r.useCallback(k=>{var J,Y;const R=(Y=(J=k.filter.toString().match(Jt))==null?void 0:J[1])!=null?Y:"0",_=(16-parseFloat(R))/16,H=1-w,q=w+H*_;s==null||s(q),G(q),E(ie(v.current,q,i))},[i,w,s]);if(!g)return n.jsx(He,{isDimensionsUnknown:!0,children:n.jsx($e,{withLottie:!0})});const Q={duration:x/1e3,ease:"linear"},T=a!==1||!m;return n.jsxs("div",{className:W("relative z-0 cursor-pointer overflow-hidden",D<1?"max-w-[400px]":"max-w-[480px]",!A&&"pointer-events-none",!$.current&&"bg-token-main-surface-secondary",d&&"max-w-full"),"aria-label":e,style:{aspectRatio:D},children:[!(h!=null&&h.shouldHideDiagonalShimmer)&&a&&a<Me&&n.jsx("div",{className:"absolute inset-0 z-3 w-full overflow-hidden",children:n.jsx("div",{className:"absolute start-[-150%] top-[-150%] h-[400%] w-[400%]",children:n.jsx("div",{className:"diagonal-sweep-gradient h-full w-full"})})}),n.jsxs(X.div,{className:"absolute start-0 end-0 top-0 z-2 w-full overflow-hidden transition-[mask] ease-linear",initial:C?!1:{height:"0%"},animate:A?{height:"100%"}:{height:"".concat(w*100,"%")},onUpdate:C?void 0:ee,transition:C?{duration:0,ease:"linear"}:Q,style:A?void 0:{mask:"linear-gradient(rgb(0,0,0) 0%, rgb(0,0,0) calc(100% - 24px), rgba(0,0,0,0) 100%)"},children:[t&&n.jsx("img",{ref:F,src:t,onLoad:P,onError:o,alt:e,className:"absolute top-0 z-1 w-full",style:{aspectRatio:D}}),m&&n.jsx("div",{className:"absolute inset-0 z-0 w-full overflow-hidden opacity-0 transition-opacity duration-300 group-hover/imagegen-image:opacity-100 group-focus/imagegen-image:opacity-100",children:n.jsx("div",{className:"absolute inset-0 bg-repeat",style:{backgroundImage:u,backgroundSize:"auto"}})})]}),n.jsx(X.div,{className:"relative z-1 w-full overflow-hidden",initial:{filter:"blur(16px)"},animate:C?{filter:"blur(0px)"}:void 0,transition:C?Yt:void 0,onUpdate:C?te:void 0,style:{aspectRatio:D},children:v.current.map((k,R)=>{const U=O[R],_=k.availablePercentComplete===1;return U!==0||_?n.jsx("img",{src:k.src,alt:e,style:{opacity:U,willChange:"opacity",aspectRatio:D},className:!C&&(h!=null&&h.shouldShowPulseAnimation)?"bg-scale-pulse":"",onLoad:_?()=>B(!0):void 0},k.src):null})}),n.jsx(X.div,{className:"absolute inset-0 z-0 scale-110 overflow-hidden blur-2xl",style:{aspectRatio:D},children:T&&v.current.filter((k,R)=>O[R]!==0).map(k=>n.jsx("img",{src:k.src,alt:e,className:"absolute top-0 w-full"},k.src))})]})},Zt=({imageAssetPointer:e,serverThreadId:t})=>{var h;const[a,s]=r.useState(void 0),i=Et(),m=(h=e.metadata)==null?void 0:h.watermarked_asset_pointer,l=r.useRef(!1),{isUnauthenticated:o}=De();return r.useEffect(()=>{if(i&&m&&!l.current){l.current=!0;const c=nt(m);at(c,void 0,o,t,!1).then(u=>{u.status===st.Success&&s(u.download_url)}).catch(u=>{u instanceof it||oe.addError(new Error("Could not fetch watermarked image with ID ".concat(m," from file service"),{cause:u}))})}},[i,m,o,t,null]),a},Ce=2,ae=({pointer:e,altLabel:t,isEditorAvailable:a,onPercentageRendered:s,messageId:i,imageIndex:m,clientThreadId:l,serverThreadId:o,onEditorClick:d,compact:h,progressLoaderProps:c})=>{var R,U,_,H,q,J,Y;const u=Te(),[g,b]=r.useState(void 0),x=r.useRef(void 0),f=(U=(R=e.metadata)==null?void 0:R.generation)==null?void 0:U.gen_id,S=(q=(H=(_=e.metadata)==null?void 0:_.generation)==null?void 0:H.height)!=null?q:void 0,G=e.height,w=(S!=null?S:0)/G,I=r.useRef({}),[p]=It(),{isUnauthenticated:M}=De(),[v,O]=r.useState(!1),E=r.useContext(Be),V=e.width/e.height,B=Zt({imageAssetPointer:e,serverThreadId:o}),F=r.useCallback((y=!1)=>{!y&&x.current===e.asset_pointer||(x.current=e.asset_pointer,ze.fetch(u,{asset:e,conversationId:o,force:y,isUnauthenticated:M}).then(z=>{b(z)}).finally(()=>{x.current=void 0}))},[e,u,o,M,null]);r.useEffect(()=>{const y=e.asset_pointer!==(g==null?void 0:g.asset_pointer);(!g||y)&&F()},[g,e.asset_pointer,F]);const A=r.useMemo(()=>Oe({pointer:g,conversationId:o,messageId:i,source:E?"paragen":"chat",imageIndex:m.toString()}),[g,o,i,E,m]),C=r.useRef(w);r.useEffect(()=>{w===1&&C.current<1&&Z.renderingComplete({analyticsContext:A})},[w,A]);const D=r.useCallback(()=>{g&&(d==null||d({image:g,messageId:i,analyticsContext:A}))},[g,i,d,A]),P=r.useMemo(()=>({width:e.width,height:e.height}),[e]),ee=r.useCallback(()=>{var z;const y=((z=I.current[e.asset_pointer])!=null?z:0)+1;if(I.current[e.asset_pointer]=y,I.current[e.asset_pointer]>Ce)return oe.addAction("image-gen-asset-error",{name:"retries-exhausted",conversation_id:o,asset_pointer:e.asset_pointer,max_retries:Ce});oe.addAction("image-gen-asset-retry",{name:"retry-attempted",conversation_id:o,asset_pointer:e.asset_pointer,current_retry:y}),I.current[e.asset_pointer]=y,F(!0)},[e.asset_pointer,F,o]),te=r.useCallback(y=>{y===1&&O(!0),s==null||s(y)},[s]),K=r.useRef(null),Q=r.useRef(null);r.useEffect(()=>{if(K.current&&(c!=null&&c.setContainerSize)){const y=K.current.getBoundingClientRect(),z={width:y.width,height:y.height},ne=Q.current;(!ne||ne.width!==z.width||ne.height!==z.height)&&(Q.current=z,c.setContainerSize(z))}},[c]);const T=g==null?void 0:g.url,k=B!=null?B:T;return n.jsx(At.Provider,{value:A,children:n.jsxs("div",{ref:K,className:W("group/imagegen-image relative w-full overflow-hidden",V<1?"max-w-[400px]":"max-w-[480px]",h?"rounded-lg":"rounded-2xl",E&&"max-w-full",i===p.get("image")&&"[view-transition-name:var(--vt-active-image)]"),id:"image-".concat(i),style:{aspectRatio:V},onClick:a?D:void 0,tabIndex:0,children:[B&&n.jsx("img",{alt:t,className:"absolute inset-0 z-1 opacity-0",src:B}),n.jsx(Xt,{alt:t,src:T,availablePercentComplete:w,onAnimationUpdate:te,isEditorAvailable:a,ignoreFirstChunk:!0,isTransparent:(Y=(J=e.metadata)==null?void 0:J.generation)==null?void 0:Y.transparent_background,dimensions:P,onError:ee,unconstrainedWidth:E,progressLoaderProps:c},f),(c==null?void 0:c.state)&&(c==null?void 0:c.state)!==j.Complete&&!v&&(c==null?void 0:c.hasImageReady)&&n.jsx(qe,{isGettingStarted:!1,messageId:i}),v&&!h&&(E?n.jsx(Kt,{imageUrl:T!=null?T:""}):n.jsx(Dt,{imageAssetPointer:T,imageUrl:k,messageId:i,clientThreadId:l,serverThreadId:o,shouldShowOverflow:B!==void 0}))]},f)})},Lt=({imageGenerationState:e,isInterrupted:t,asyncMessage:a,imageAssetPointer:s,altLabel:i,clientThreadId:m,serverThreadId:l,onEditorClick:o,isEditorAvailable:d,setAnimationPercentage:h,messageId:c})=>{var w;const[u,g]=r.useState(null),b=u==null,[x,f]=r.useState(!0),S=e===j.Thinking||e===j.AsyncGenerating&&!((w=a==null?void 0:a.metadata)!=null&&w.is_visually_hidden_from_conversation),G=e===j.Generating||e===j.Complete;return r.useEffect(()=>{S&&f(!1)},[S]),t?null:n.jsxs("div",{className:G?"relative pb-2":"relative",children:[(S||!x)&&n.jsx(qt,{isDimensionsUnknown:b,width:u==null?void 0:u.width,height:u==null?void 0:u.height,children:b&&n.jsx(qe,{isGettingStarted:!0,messageId:c})}),G&&n.jsx(X.div,{className:x?"relative":"absolute inset-0 w-full",variants:{hidden:{opacity:0},visible:{opacity:1}},initial:"hidden",animate:x?"visible":"hidden",exit:"hidden",children:s&&n.jsx(ae,{pointer:s,altLabel:i,isEditorAvailable:d,onPercentageRendered:h,messageId:c,clientThreadId:m,serverThreadId:l,imageIndex:0,onEditorClick:o,progressLoaderProps:{state:e,setContainerSize:g,hasImageReady:x,setHasImageReady:f,shouldHideDiagonalShimmer:!0,shouldShowPulseAnimation:!0}})})]})};function Pt({title:e,description:t,shimmer:a}){return!e&&!t?null:n.jsxs("div",{className:"border-token-border-default my-2 max-w-[480px] min-w-72 rounded-2xl border p-6",children:[!!e&&n.jsx("p",{className:W("text-lg font-medium",a&&"loading-shimmer-pure-text-inverted",!!t&&"mb-1"),children:e}),!!t&&n.jsx("p",{children:t})]})}const en=e=>{"use forget";const t=vt.c(6),{cotMessages:a,visualPercentComplete:s,isInterrupted:i,state:m}=e,l=i===void 0?!1:i,o=L();let d;t[0]!==o?(d=o.formatMessage({id:"imagegen.thinkingHeader.interrupted",defaultMessage:"Stopped creating image"}),t[0]=o,t[1]=d):d=t[1];const h=d,c=m===j.Complete||s===1;let u;e:{if(l){u=h;break e}else if(!a){u=void 0;break e}if(c){u=a.complete;break e}if(s){const x=Object.keys(a.generating);for(let f=0;f<x.length;f=f+1,f){const S=parseFloat(x[f]);if(s<S){u=a.generating[x[f]];break e}}}else{u=a.thinking;break e}u=a.complete}const g=u;let b;return t[2]!==g||t[3]!==l||t[4]!==c?(b=g&&n.jsx(Ht,{latestHeadline:g,isComplete:c||l,showChunkIcon:!1,isExpandDisabled:!0}),t[2]=g,t[3]=l,t[4]=c,t[5]=b):b=t[5],b},tn=({pointersToRender:e,altLabel:t,isEditorAvailable:a,updatePercentageRendered:s,toolCallMessage:i,toolOutputMessageIds:m,clientThreadId:l,serverThreadId:o,handleEditorClick:d})=>{const h=le.useStore(),c=le.useSelectedIndex();r.useEffect(()=>{h.setSelectedIndex(Math.max(m.findIndex(w=>{var I;return w===((I=i==null?void 0:i.metadata)==null?void 0:I.selected_image_message_id)}),0))},[]);const u=r.useRef({}),g=r.useCallback(w=>I=>{u.current[w]=I;const p=Object.keys(u.current).length,M=Object.values(u.current).reduce((v,O)=>v+O,0);s==null||s(M/p)},[s]),[b,x]=r.useState(null),f=ot(l,re.getRequestId),S=Ut(f);r.useEffect(()=>{!S&&b!=null&&i!=null&&o!=null&&(Ne(i.id,m[b],l,o),x(null))},[S]);const G=r.useCallback(w=>{h.setSelectedIndex(w);const I=Object.values(u.current);rt.logEventWithStatsig("chatgpt_image_switched","chatgpt_image_switched",{conversationId:o,messageId:m[w],imageIndex:w.toString(),isLoading:(I.length===0||I.some(v=>v<1)).toString()});const p=re.getConversationLastTurn(Ue(l)),M=(p==null?void 0:p.messages.find(v=>v.id===(i==null?void 0:i.id)))!=null;i!=null&&o!=null&&(M&&S?x(w):Ne(i.id,m[w],l,o))},[i,m,l,o,h,S,x]);return n.jsxs("div",{className:"flex gap-2",children:[n.jsx(ae,{pointer:e[c],altLabel:t,isEditorAvailable:a,messageId:m[c],imageIndex:c,clientThreadId:l,serverThreadId:o,onEditorClick:d},m[c]),n.jsx("div",{className:"flex flex-col gap-2",children:e.map((w,I)=>{var p,M;return n.jsx(nn,{pointer:w,altLabel:t,isSelected:I===c,onClick:()=>G(I),onPercentageRendered:(M=(p=w.metadata)==null?void 0:p.generation)!=null&&M.gen_id?g(w.metadata.generation.gen_id):void 0,messageId:m[I],imageIndex:I,clientThreadId:l,serverThreadId:o},m[I])})})]})},nn=({pointer:e,altLabel:t,isSelected:a,onClick:s,onPercentageRendered:i,messageId:m,imageIndex:l,clientThreadId:o,serverThreadId:d})=>n.jsxs("button",{type:"button",onClick:s,className:"relative w-14 rounded-lg p-1",children:[n.jsx("div",{className:W(a&&"opacity-70"),children:n.jsx(ae,{pointer:e,altLabel:t,isEditorAvailable:!1,onPercentageRendered:i,messageId:m,imageIndex:l,clientThreadId:o,serverThreadId:d,compact:!0})}),a&&n.jsx("div",{className:"border-token-border-default pointer-events-none absolute inset-0 rounded-xl border-2"})]});async function Ne(e,t,a,s){const i=await lt.safePost("/image-gen/message-select",{requestBody:{message_id:e,selected_image_message_id:t,conversation_id:s}}),m=i.id;m!=null&&ct(a,l=>{ut.updateTree(l,o=>{o.updateNodeMessage(m,i)})})}function an(e){const t=e.find(l=>l.author.role==="tool"&&l.author.name===Tt&&l.content.content_type==="text"),[a,...s]=(t==null?void 0:t.content.content_type)==="text"?t.content.parts:[],i=s.pop(),m=s.length;return a&&i&&s.length>0?{thinking:a,complete:i,generating:s.reduce((l,o,d)=>{const h=(d+1)/m;return l[h.toFixed(2)]=o,l},{})}:void 0}const sn=e=>{const t=L(),{size:a="image",count:s=1}=e||{};return s>1?{thinking:t.formatMessage({id:"cdnmKo",defaultMessage:"Getting started"}),generating:{"0.33":t.formatMessage({id:"aTbInH",defaultMessage:"Creating images. May take a moment."}),"0.67":t.formatMessage({id:"WRM3Yw",defaultMessage:"Creating images. May take a moment."}),"1.00":t.formatMessage({id:"8ZydRG",defaultMessage:"Creating images. May take a moment."})},complete:t.formatMessage({id:"XQ81dl",defaultMessage:"Images created"})}:a==="xlimage"?{thinking:t.formatMessage({id:"y7op2E",defaultMessage:"Getting started"}),generating:{"0.33":t.formatMessage({id:"cdrDJH",defaultMessage:"Creating image. May take a moment."}),"0.67":t.formatMessage({id:"RP4bRn",defaultMessage:"Adding details"}),"1.00":t.formatMessage({id:"o36MSQ",defaultMessage:"Finishing touches"})},complete:t.formatMessage({id:"QsnnBN",defaultMessage:"Image created"})}:{thinking:t.formatMessage({id:"6c7+kN",defaultMessage:"Getting started"}),generating:{"0.33":t.formatMessage({id:"DP6/8y",defaultMessage:"Creating image"}),"0.67":t.formatMessage({id:"k9y1TT",defaultMessage:"Creating image"}),"1.00":t.formatMessage({id:"GpR7v3",defaultMessage:"Creating image"})},complete:t.formatMessage({id:"l2Izz4",defaultMessage:"Image created"})}},on=ht(()=>xt(()=>import("./bygkq777mc84o32a.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15])).then(e=>e.ImageGenConversationLightboxNew)),rn=[j.Empty,j.Errored],xn=({messages:e,clientThreadId:t,isLastTurnInConversation:a,isParagen:s=!1})=>{var P,ee,te,K,Q,T,k,R,U;const i=dt(t),l=L().formatMessage({id:"imagegen.message.altLabel",defaultMessage:"Generated image"}),{messageIds:o,imageAssetPointers:d}=r.useMemo(()=>ye(e),[e]),h=e.find(Bt),c=le.useSelectedIndex(),u=(te=(ee=(P=d==null?void 0:d[c])==null?void 0:P.metadata)==null?void 0:ee.generation)==null?void 0:te.gen_size,g=sn({size:u!=null?u:"image",count:(K=d==null?void 0:d.length)!=null?K:1}),b=r.useMemo(()=>{var _;return(_=an(e))!=null?_:g},[e,g]),x=e.find(_=>{var H;return(H=_.metadata)==null?void 0:H.image_gen_async}),f=r.useMemo(()=>zt(e,a),[e,a]),S=r.useRef(!1),G=r.useRef(!1),w=r.useRef(null),I=r.useMemo(()=>Oe({pointer:d[c],conversationId:i,messageId:o[c],source:s?"paragen":"chat",imageIndex:c.toString()}),[d,o,c,i,s]);r.useEffect(()=>{if(!S.current&&(f===j.Thinking||f===j.Generating))S.current=!0,w.current=performance.now();else if(S.current&&!G.current)if(f===j.Complete){const _=w.current?performance.now()-w.current:void 0;Z.generationSuccess({analyticsContext:I,durationMs:_}),G.current=!0}else f===j.Errored&&(Z.generationFailure({analyticsContext:I,errorReason:"assistant_error"}),G.current=!0)},[f,I]);const p=e[e.length-1],M=r.useMemo(()=>p&&mt(p),[p]),v=Ee(),{onRequestCompletion:O}=Ot(),E=gt(t),V=(Q=E==null?void 0:E.id)!=null?Q:null,B=Ae(v,"3019066937").get("should_use_new_ui",!1),$=pt({clientThreadId:t})&&f===j.Complete,[F,A]=r.useState(0),C=Te(),D=r.useCallback(async({image:_,analyticsContext:H})=>{var ue,de,me;const q=Ue(t),J=q?re.getConversationTurns(q).flatMap(N=>N.messages):e,{imageAssetPointers:Y,messageIds:y}=ye(J,{skipSort:!0}),ne=(s?[_]:await Promise.all(Y.map(N=>ze.fetch(C,{asset:N,conversationId:i})))).map((N,ge)=>{var fe,he,xe,we,Se,Ie;return{id:(xe=(he=(fe=N.metadata)==null?void 0:fe.generation)==null?void 0:he.gen_id)!=null?xe:y[ge],archived:!1,transformationId:(Ie=(Se=(we=N.metadata)==null?void 0:we.generation)==null?void 0:Se.gen_id)!=null?Ie:null,url:N.url,assetPointer:N.asset_pointer,thumbnail:null,width:N.width,height:N.height,title:null,conversationId:i,messageId:y[ge]}});Z.editorClick({sourceOperation:(me=(de=(ue=_.metadata)==null?void 0:ue.dalle)==null?void 0:de.edit_op)!=null?me:"none",analyticsContext:H});const ce=ne.findIndex(N=>N.assetPointer===_.asset_pointer);ft(v,({onClose:N})=>n.jsx(on,{images:ne,initialIndex:ce===-1?0:ce,onClose:N,onRequestCompletion:O,clientThreadId:t,currentModelId:V}))},[e,i,v,O,t,V,C,s]);return rn.includes(f)?null:n.jsx(Be.Provider,{value:s,children:n.jsx("div",{className:"flex flex-col",children:B?n.jsx(Lt,{imageGenerationState:f,isInterrupted:M,asyncMessage:x,imageAssetPointer:d[0],altLabel:l,clientThreadId:t,serverThreadId:i,onEditorClick:D,setAnimationPercentage:A,isEditorAvailable:$,messageId:o[0]}):n.jsxs(n.Fragment,{children:[f!==j.Unavailable&&f!==j.AsyncGenerating&&f!==j.AsyncHanging&&!((T=p==null?void 0:p.metadata)!=null&&T.async_completion_id)&&n.jsx("div",{className:"pb-3",children:n.jsx(en,{cotMessages:b,visualPercentComplete:F,isInterrupted:M,state:f})}),f===j.Thinking&&!M&&n.jsx(He,{isDimensionsUnknown:!0,children:n.jsx($e,{withLottie:!0})}),f===j.AsyncGenerating&&!((k=x==null?void 0:x.metadata)!=null&&k.is_visually_hidden_from_conversation)&&n.jsx(Pt,{shimmer:!0,title:(R=x==null?void 0:x.metadata)==null?void 0:R.ui_card_title,description:(U=x==null?void 0:x.metadata)==null?void 0:U.ui_card_description}),(f===j.Generating||f===j.Complete)&&!M&&n.jsx("div",{className:"pb-2",children:d.length>1?n.jsx(tn,{pointersToRender:d,altLabel:l,isEditorAvailable:$,updatePercentageRendered:A,toolCallMessage:h,toolOutputMessageIds:o,clientThreadId:t,serverThreadId:i,handleEditorClick:D}):n.jsx(ae,{pointer:d[0],altLabel:l,isEditorAvailable:$,onPercentageRendered:A,messageId:o[0],imageIndex:0,clientThreadId:t,serverThreadId:i,onEditorClick:D})})]})})})};export{xn as ImageGenMessage};
//# sourceMappingURL=ocm4jgis69nffnv1.js.map
