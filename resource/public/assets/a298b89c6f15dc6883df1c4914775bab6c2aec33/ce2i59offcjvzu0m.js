var ee=Object.freeze,te=Object.defineProperty,we=Object.defineProperties;var Se=Object.getOwnPropertyDescriptors;var se=Object.getOwnPropertySymbols;var ke=Object.prototype.hasOwnProperty,Ee=Object.prototype.propertyIsEnumerable;var re=(s,r,t)=>r in s?te(s,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[r]=t,ae=(s,r)=>{for(var t in r||(r={}))ke.call(r,t)&&re(s,t,r[t]);if(se)for(var t of se(r))Ee.call(r,t)&&re(s,t,r[t]);return s},ne=(s,r)=>we(s,Se(r));var ie=(s,r)=>ee(te(s,"raw",{value:ee(r||s.slice())}));import{h as Re,j as e,m as Te,M as u,r as S,b as F,u as ye,g as Ne,f as Ue,a as oe}from"./n75kuy1cx6f5mogg.js";import{om as ve,on as qe,oo as Le,h_ as Be,op as Ie,gU as De,c4 as Oe,c5 as le,c6 as I,js as Fe,bv as Ae,c7 as Ge,c8 as Pe,c9 as He}from"./ny10lj7zpuz89fvf.js";import{a4 as Ke,a5 as We,by as ze,r$ as Qe,s0 as Ve,s1 as Je,bE as $e,hH as Ze,mK as Xe,e as D,T as Q,ho as Ye,B as L,f as je,P as k,C as be,aF as de,R as O,i as es,r as ss,a9 as ce,H as rs,F as ts,ex as q}from"./ewse8exzafeu10ji.js";import{T}from"./e0z6030ycsi62lhu.js";var A,ue;function as(){if(ue)return A;ue=1;var s=Ke(),r=We(),t="[object RegExp]";function n(a){return r(a)&&s(a)==t}return A=n,A}var G,me;function ns(){if(me)return G;me=1;var s=as(),r=ze(),t=Qe(),n=t&&t.isRegExp,a=n?r(n):s;return G=a,G}var P,fe;function is(){if(fe)return P;fe=1;var s=Ve(),r=s("length");return P=r,P}var H,ge;function os(){if(ge)return H;ge=1;var s="\\ud800-\\udfff",r="\\u0300-\\u036f",t="\\ufe20-\\ufe2f",n="\\u20d0-\\u20ff",a=r+t+n,i="\\ufe0e\\ufe0f",l="["+s+"]",d="["+a+"]",h="\\ud83c[\\udffb-\\udfff]",M="(?:"+d+"|"+h+")",C="[^"+s+"]",E="(?:\\ud83c[\\udde6-\\uddff]){2}",_="[\\ud800-\\udbff][\\udc00-\\udfff]",x="\\u200d",j=M+"?",p="["+i+"]?",y="(?:"+x+"(?:"+[C,E,_].join("|")+")"+p+j+")*",c=p+j+y,o="(?:"+[C+d+"?",d,E,_,l].join("|")+")",m=RegExp(h+"(?="+h+")|"+o+c,"g");function g(f){for(var v=m.lastIndex=0;m.test(f);)++v;return v}return H=g,H}var K,he;function ls(){if(he)return K;he=1;var s=is(),r=ve(),t=os();function n(a){return r(a)?t(a):s(a)}return K=n,K}var W,xe;function ds(){if(xe)return W;xe=1;var s=Je(),r=qe(),t=ve(),n=$e(),a=ns(),i=ls(),l=Le(),d=Ze(),h=Xe(),M=30,C="...",E=/\w*$/;function _(x,j){var p=M,y=C;if(n(j)){var c="separator"in j?j.separator:c;p="length"in j?d(j.length):p,y="omission"in j?s(j.omission):y}x=h(x);var o=x.length;if(t(x)){var m=l(x);o=m.length}if(p>=o)return x;var g=p-i(y);if(g<1)return y;var f=m?r(m,0,g).join(""):x.slice(0,g);if(c===void 0)return f+y;if(m&&(g+=f.length-g),a(c)){if(x.slice(g).search(c)){var v,R=f;for(c.global||(c=RegExp(c.source,h(E.exec(c))+"g")),c.lastIndex=0;v=c.exec(R);)var B=v.index;f=f.slice(0,B===void 0?g:B)}}else if(x.indexOf(s(c),g)!=g){var N=f.lastIndexOf(c);N>-1&&(f=f.slice(0,N))}return f+y}return W=_,W}var cs=ds();const us=Re(cs),ms=80,V=100;function Ce(s){return s<V?"bg-token-bg-status-warning text-token-text-status-warning":"bg-token-bg-status-error text-token-interactive-label-danger-secondary-default"}function _e(s){return Be()&&s!=null&&s>ms}function bs({memoryFullPct:s,className:r,children:t,showInfoLabel:n,onManageMemories:a}){return _e(s)?e.jsx("div",{className:D("border-token-border-default rounded-lg border p-1 text-sm",r),children:e.jsxs(Te.div,{className:D("flex items-center gap-1 overflow-hidden rounded-sm px-1.5 py-[5px] font-medium whitespace-nowrap",Ce(s)),initial:{width:0},animate:{width:"".concat(s,"%")},transition:{duration:.5},children:[e.jsx(Ie,{className:"icon-sm ms-1"}),e.jsx(u,{id:"6D2etG",defaultMessage:"{memoryFullPct}% full",values:{memoryFullPct:s}}),t,n&&e.jsx(Q,{interactive:!0,label:s<V?e.jsx("div",{className:"whitespace-normal",children:e.jsx(u,{id:"gxY4wi",defaultMessage:"ChatGPT's almost out of space for new saved memories. <memoryModalLink>Manage saved memories</memoryModalLink> to create more space.",values:{memoryModalLink:l=>e.jsx("a",{href:"#",className:"cursor-pointer underline",onClick:d=>{d.preventDefault(),a==null||a()},children:l})}})}):e.jsx("div",{className:"whitespace-normal",children:e.jsx(u,{id:"1JxMf3",defaultMessage:"ChatGPT's out of space for saved memories. <memoryModalLink>Manage saved memories</memoryModalLink> to create more space.",values:{memoryModalLink:l=>e.jsx("a",{href:"#",className:"cursor-pointer underline",onClick:d=>{d.preventDefault(),a==null||a()},children:l})}})}),children:e.jsx(Ye,{className:"icon-sm ms-1"})})]})}):null}function fs({memoryFullPct:s,className:r,showUpgradeCTA:t=!1,isPaid:n=!1,onUpgrade:a}){return _e(s)?e.jsxs("div",{className:D("border-token-border-default bg-token-main-surface-primary flex items-center justify-between gap-4 rounded-lg border p-[14px]",r),children:[e.jsxs("div",{className:"inline-block gap-1",children:[e.jsx("div",{className:D("mb-1 inline-block rounded-[6px] px-[6px] py-[2px] text-sm font-semibold",Ce(s!=null?s:0)),children:e.jsx(u,{id:"56hzv4",defaultMessage:"{memoryFullPct}% full",values:{memoryFullPct:s}})}),e.jsx("div",{className:"text-token-text-primary text-sm",children:(s!=null?s:0)>=V?n?e.jsx(u,{id:"HaCKNx",defaultMessage:"New memories can't be saved, so responses may feel less personalized. Delete existing memories to free up space."}):e.jsx(u,{id:"MXPinw",defaultMessage:"New memories can't be saved, so responses may feel less personalized. Upgrade to expand memory, or delete existing memories."}):n?e.jsx(u,{id:"obgK9b",defaultMessage:"Once memory is full, responses may feel less personalized. Delete existing memories to free up space."}):e.jsx(u,{id:"PDLzFM",defaultMessage:"Once memory is full, responses may feel less personalized. Upgrade to expand memory, or delete existing memories."})})]}),t&&!n&&e.jsx(L,{color:"primary",size:"medium",onClick:a,children:e.jsx(u,{id:"1rRvWt",defaultMessage:"Upgrade"})})]}):null}function Me({description:s,onClose:r,onConfirm:t}){const n=F();return e.jsx(be,{testId:"modal-confirm-reset-memory",isOpen:!0,onClose:r,type:"success",title:n.formatMessage({id:"MemoriesModal.resetModalTitle",defaultMessage:"Are you sure?"}),description:s,primaryButton:e.jsx(de.Button,{title:n.formatMessage({id:"MemoriesModal.resetModalConfirm",defaultMessage:"Clear memory"}),color:"danger",onClick:t,"data-testid":"confirm-reset-memories-button"}),secondaryButton:e.jsx(de.Button,{title:n.formatMessage({id:"MemoriesModal.resetModalCancel",defaultMessage:"Cancel"}),color:"secondary",onClick:r})})}function gs({onReset:s,gizmoId:r,memoryName:t}){const[n,a]=S.useState(!1),i=F(),l=je(),d=De(),h=async()=>{k.logEvent("Memory Manage Reset Button Confirmed");try{await O.safeDelete("/settings/clear_account_user_memory",{requestBody:{gizmo_id:r}}),l.success(i.formatMessage({id:"ResetMemoriesButton.resetSuccess",defaultMessage:"Memory cleared."})),s==null||s(),a(!1)}catch(M){l.danger({id:"ResetMemoriesButton.resetFailed",defaultMessage:"Failed to clear memory.",description:"Error message for the reset memory modal"},{toastId:"reset_memories_button_reset_failed"})}};return e.jsxs(e.Fragment,{children:[e.jsx(L,{color:"danger-outline",onClick:()=>{k.logEvent("Memory Manage Reset Button Clicked"),a(!0)},"data-testid":"reset-memories-button",children:r?e.jsx(u,{id:"ResetMemoriesButton.resetGizmo",defaultMessage:"Clear this GPT's memory"}):e.jsx(u,{id:"ResetMemoriesButton.resetChatGPT",defaultMessage:"Delete all"})}),n&&(d?e.jsx(Me,{description:i.formatMessage({id:"MemoriesModal.resetGizmoModalDescriptionUpdated",defaultMessage:"Deleting your saved memories means {name} may not remember this information going forward. To fully remove this information from {name}'s memory, please delete any related chats. <link>Learn more</link>"},{name:t,link:M=>e.jsx("a",{className:"underline",href:"https://help.openai.com/en/articles/8983136-what-is-memory",children:M})}),onClose:()=>a(!1),onConfirm:h}):e.jsx(Me,{description:i.formatMessage({id:"MemoriesModal.resetGizmoModalDescription",defaultMessage:"{name} will forget everything it has remembered from your chats. This cannot be undone."},{name:t}),onClose:()=>a(!1),onConfirm:h}))]})}function hs({gizmo:s,memory:r}){var c;const t=F(),n=je(),a=ye(),[i,l]=S.useState(!1),[d,h]=S.useState(r.content),M=S.useRef(null);S.useEffect(()=>{if(i&&M.current){const o=M.current,m=o.value.length;o.focus(),o.setSelectionRange(m,m)}},[i]);const{mutate:C,isPending:E}=oe({mutationFn:async o=>{const{success:m}=await O.safeDelete("/memories/{memory_id}",{parameters:{path:{memory_id:o}},requestBody:{gizmo_id:s==null?void 0:s.id}});if(!m)throw new Error("An error occurred while deleting the memory")},onSettled:()=>{a.invalidateQueries({queryKey:I(s==null?void 0:s.id)})},onError:()=>{n.danger({id:"MemoriesModal.deleteFailed",defaultMessage:"Failed to forget memory",description:"Toast message when deleting memory fails"},{id:"memoryDeleteFailed",toastId:"memory_delete_failed"})}}),{mutate:_,isPending:x}=oe({mutationFn:async()=>await O.safePatch("/memories/{memory_id}",{parameters:{path:{memory_id:r.id}},requestBody:{gizmo_id:s==null?void 0:s.id,content:d}}),onSuccess:o=>{const{memory_max_tokens:m,memory_num_tokens:g}=o;a.setQueryData(I(s==null?void 0:s.id),f=>{if(!f||typeof f!="object")return f;const v=f,R=Math.min(Math.floor(100*g/m),100);return ne(ae({},v),{memory_max_tokens:m,memory_num_tokens:g,memoryFullPct:R})}),a.invalidateQueries({queryKey:I(s==null?void 0:s.id)}),l(!1)},onError:()=>{n.danger({id:"MemoriesModal.editFailed",defaultMessage:"Failed to update memory",description:"Toast message when editing memory fails"},{id:"memoryEditFailed",toastId:"memory_edit_failed"})}}),[j,p]=S.useState(!1),y=t.formatMessage({id:"N0czuB",defaultMessage:"Remove"});return e.jsxs(e.Fragment,{children:[e.jsx(T.Row,{disabled:E||x,children:i?e.jsxs(T.Cell,{colSpan:2,className:"relative pe-0",children:[e.jsx("input",{ref:M,autoFocus:!0,value:d,onChange:o=>h(o.target.value),className:"w-full rounded border-2 border-transparent py-2 pe-36 focus:outline-none",maxLength:500,onKeyDown:o=>{if(!o.nativeEvent.isComposing&&o.key==="Enter"){if(d.trim()===""){k.logEvent("Memory Manage Modal Memory Delete Clicked"),p(!0);return}_()}}}),e.jsxs("div",{className:"absolute end-1 top-1/2 flex -translate-y-1/2 gap-1",children:[e.jsx(L,{color:"secondary",size:"small",onClick:()=>{h(r.content),l(!1)},children:e.jsx(u,{id:"TTo8Tw",defaultMessage:"Cancel"})}),e.jsx(L,{size:"small",onClick:()=>{if(d.trim()===""){k.logEvent("Memory Manage Modal Memory Delete Clicked"),p(!0);return}_()},disabled:x,children:e.jsx(u,{id:"mDcKbU",defaultMessage:"Save"})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(T.Cell,{className:"pe-0",divClassName:"min-h-[40px] items-center w-full",children:e.jsx("div",{className:"border-2 border-transparent py-2 whitespace-pre-wrap",children:r.content})}),e.jsx(T.Cell,{textAlign:"right",children:e.jsxs(T.Actions,{children:[(()=>{const o=t.formatMessage({id:"EditableMemoriesModal.edit",defaultMessage:"Edit"});return e.jsx("button",{onClick:()=>l(!0),"aria-label":o,className:"text-token-text-tertiary hover:text-token-text-secondary",children:e.jsx(Q,{label:o,side:"top",className:"leading-none",children:e.jsx(Fe,{className:"icon-sm"})})})})(),e.jsx("button",{onClick:()=>{k.logEvent("Memory Manage Modal Memory Delete Clicked"),p(!0)},"aria-label":y,className:"text-token-text-tertiary hover:text-token-text-secondary",children:e.jsx(Q,{className:"leading-none",label:y,side:"top",children:e.jsx(Ae,{className:"icon-sm"})})})]})})]})}),j&&e.jsx(Ge,{isOpen:!0,primaryButtonColor:"danger",title:y,confirmText:t.formatMessage({id:"fCn0ar",defaultMessage:"Forget"}),onConfirm:()=>{k.logEvent("Memory Manage Modal Memory Delete Confirmed"),C(r.id),p(!1)},onClose:()=>{p(!1),h(r.content),l(!1)},children:e.jsx(u,{id:"j2cZHW",defaultMessage:'Remove "{title}" from {name}’s saved memories. This can’t be undone. <link>Learn more</link>',values:{name:(c=s==null?void 0:s.name)!=null?c:"ChatGPT",title:e.jsx("strong",{children:us(r.content,{length:130,omission:"..."})}),link:o=>e.jsx("a",{href:"https://help.openai.com/en/articles/8590148-memory-faq",target:"_blank",className:"underline",rel:"noreferrer",children:o})}})})]})}function xs({selectedGizmoId:s,onSelect:r,items:t}){const n=t.find(i=>i.id===s);function a(i){var l;return e.jsx(He,{isFirstParty:i.id===void 0,src:(l=i.iconUrl)!=null?l:null,className:"icon"})}return e.jsx("div",{className:"border-token-border-medium mb-2 inline-flex rounded-md border",children:e.jsxs(q.Root,{children:[e.jsx(q.Trigger,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[n?e.jsxs(e.Fragment,{children:[a(n),e.jsx("span",{className:"text-token-text-primary",children:n.name})]}):e.jsx(u,{id:"MemoriesModal.unknownGizmo",defaultMessage:"Unknown GPT"}),e.jsx(Pe,{className:"icon-sm text-token-text-tertiary"})]})}),e.jsx(q.Portal,{children:e.jsx(q.Content,{children:t.map(i=>e.jsxs(q.Item,{className:"flex items-center gap-3",onClick:()=>{r(i.id)},children:[a(i),i.name]},i.id))})})]})})}var pe;const z=ts.div(pe||(pe=ie(["flex h-full items-center justify-center pb-8 text-sm text-token-text-tertiary rounded-lg border border-token-border-default"])));function Cs({onClose:s,initialGizmoId:r}){var J,$,Z,X;const t=F(),n=ye(),a=Oe(),[i,l]=S.useState(r),d=es(),h=Ne(),M=ss(d),{data:C}=le(void 0,!1,a),_=ce(d,"684023316",{disableExposureLog:!0}).get("memory_almost_full_threshold",80),y=(((J=C==null?void 0:C.memoryFullPct)!=null?J:0)>=_?ce(d,"684023316").get("upsell_variant","control"):"control")!=="control",c=M==null?void 0:M.hasPlusFeatures();S.useEffect(()=>{k.logEvent("Memory Modal Shown")},[]);const{data:o,isLoading:m,isError:g,refetch:f}=le(i,!0,a),v=o==null?void 0:o.memories,{data:R,refetch:B}=Ue({queryKey:["memory_gizmos"],queryFn:()=>O.safeGet("/memories/gizmos"),refetchOnMount:"always"}),N=[{id:void 0,name:"ChatGPT",iconUrl:null},...($=R==null?void 0:R.items.map(({gizmo:b})=>{var Y;return{id:b.id,name:b.display.name,iconUrl:(Y=b.display.profile_picture_url)!=null?Y:null}}))!=null?$:[]],w=N.find(b=>b.id===i);S.useEffect(()=>{!m&&!g&&i!==void 0&&(!v||v.length===0)&&l(void 0)},[m,g,v,i]);let U;return m?U=e.jsx(z,{children:e.jsx(u,{id:"MemoriesModal.loading",defaultMessage:"Loading..."})}):g?U=e.jsx(z,{children:e.jsxs("div",{className:"max-w-sm text-center",children:[e.jsx("div",{className:"mb-4 text-red-500",children:e.jsx(u,{id:"MemoriesModal.somethingWentWrong",defaultMessage:"Something went wrong..."})}),e.jsx("div",{children:e.jsx(L,{color:"secondary",onClick:()=>{f()},children:e.jsx(u,{id:"MemoriesModal.retry",defaultMessage:"Retry"})})})]})}):!v||v.length===0?U=e.jsx(z,{children:e.jsx("div",{className:"max-w-sm text-center",children:a?e.jsx(u,{id:"MemoriesModal.noMemories.1",defaultMessage:"As you chat with {name}, the details and preferences it saves will be shown here.",values:{name:(Z=w==null?void 0:w.name)!=null?Z:"ChatGPT"}}):e.jsx(u,{id:"MemoriesModal.noMemoriesAndDisabled",defaultMessage:"Memory is disabled. ChatGPT won't use or save memories."})})}):U=e.jsx(T.Root,{className:"border-token-border-default h-full",size:"compact",bordered:!0,children:e.jsx(T.Body,{children:v.map(b=>e.jsx(hs,{gizmo:w?{id:w.id,name:w.name}:void 0,memory:b},b.id))})}),e.jsxs(be,{testId:"modal-memories",isOpen:!0,onClose:s,size:"custom",className:"max-w-5xl",type:"success",title:t.formatMessage({id:"MemoriesModal.title",defaultMessage:"Saved memories"}),showCloseButton:!0,children:[c&&N.length>1&&e.jsx("div",{className:"mb-4",children:e.jsx(xs,{selectedGizmoId:i,items:N,onSelect:b=>{n.invalidateQueries({queryKey:I(b)}),l(b)}})}),e.jsx(fs,{memoryFullPct:o==null?void 0:o.memoryFullPct,className:"mb-5",showUpgradeCTA:y,isPaid:c,onUpgrade:()=>{k.logEventWithStatsig("Memories Upgrade Button Clicked","chatgpt_memories_upgrade_button_clicked_settings"),rs(h,"chatgpt_memories_upgrade_button")}}),e.jsx("div",{className:"h-[24rem]",children:U}),e.jsx("div",{className:"mt-5 flex justify-end",children:e.jsx(gs,{onReset:()=>{f(),B(),i&&l(void 0)},gizmoId:i,memoryName:(X=w==null?void 0:w.name)!=null?X:"ChatGPT"})})]})}export{Cs as E,fs as M,gs as R,bs as a,us as t};
//# sourceMappingURL=ce2i59offcjvzu0m.js.map
