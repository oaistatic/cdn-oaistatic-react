const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/exmp9n2h3sabhuz6.js","assets/n75kuy1cx6f5mogg.js","assets/ewse8exzafeu10ji.js","assets/root-l2v84m1w.css","assets/ny10lj7zpuz89fvf.js","assets/conversation-small-hotcas67.css","assets/hm7mxp554vts8hxt.js","assets/fno7ypwqdtl0x211.js","assets/i70dhxk1j381usod.js","assets/j4iu4cyxlby9nd33.js","assets/jhe3wdj1wdglvpku.js","assets/ansi-1f6vhsjh.css","assets/eq0refymwif7pcpz.js","assets/iquhayvbn8ec35rz.js","assets/fmsmhem5hrm2cxrs.js","assets/jocaiq9wugboh64i.js","assets/kas18igmwglc2mb4.js","assets/lptwpbjabrvjmhsj.js","assets/jwsjryhasdl9p2nq.js","assets/go4mpxmt63qgntp4.js","assets/fzrn137102spawew.js","assets/dv12g54ivgixitjp.js","assets/d5vv6ct7n3prp63a.js","assets/hkwix64yhkotslv1.js","assets/5hoqitp3r2hkdtny.js","assets/wham-task-page-content-layout-ihk5sr3r.css","assets/e2tpmvaykwot5faa.js","assets/ne36kgu5w1zang50.js","assets/frf4c35l48b0bjrb.js","assets/h76aawyn0y8q6s6p.js"])))=>i.map(i=>d[i]);
var Sn=Object.defineProperty,jn=Object.defineProperties;var kn=Object.getOwnPropertyDescriptors;var wt=Object.getOwnPropertySymbols;var Bs=Object.prototype.hasOwnProperty,Fs=Object.prototype.propertyIsEnumerable;var Ns=(t,e,s)=>e in t?Sn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,re=(t,e)=>{for(var s in e||(e={}))Bs.call(e,s)&&Ns(t,s,e[s]);if(wt)for(var s of wt(e))Fs.call(e,s)&&Ns(t,s,e[s]);return t},Vt=(t,e)=>jn(t,kn(e));var _s=(t,e)=>{var s={};for(var n in t)Bs.call(t,n)&&e.indexOf(n)<0&&(s[n]=t[n]);if(t!=null&&wt)for(var n of wt(t))e.indexOf(n)<0&&Fs.call(t,n)&&(s[n]=t[n]);return s};import{r as C,h as zs,d as ls,j as r,b as $,u as Nn,a as Qs,M as T,l as Bn,c as us,f as Xs,g as Ys,A as Zs}from"./n75kuy1cx6f5mogg.js";import{i as be,j as ce,bx as Fn,f as Js,B as me,E as Ue,T as fe,e as ie,dC as _n,I as en,eG as In,a2 as Rn,dB as Dn,lO as Ln,ub as Tn,uc as Pn,bv as tn,by as On,ud as Wn,ue as Hn,ik as $n,gT as qn,qB as ds,i6 as St,ee as hs,sG as Gn,kM as Vn,gz as sn,O as Jt,me as nn,ex as Ce,dG as Un,jz as Kn,jA as zn,jB as Qn,jD as Xn,jH as Yn,gs as X,sb as Zn,bW as Jn,sc as er,se as Xe,sd as tr,sg as sr,g$ as nr,gB as es,C as rr,ej as ar,ek as or,R as ir,q as cr,gn as lr,md as Is,gh as Ut,mu as ur,jS as Mt,jT as dr,gk as hr,c0 as mr,sp as fr,gv as Rs,k as Et,sv as pr,gw as gr,gl as xr}from"./ewse8exzafeu10ji.js";import{xi as Cr,xj as vr,xk as br,gA as wr,o6 as Mr,c8 as Er,dF as yr,bx as Ar,jQ as Ge,jR as ms,xl as fs,cg as Sr,lh as jr,o7 as kr,xm as Nr,gV as rn,xn as Br,gN as Fr,ao as _r,xo as Ir,xp as Rr,xq as ts,rn as Dr,xr as Lr,xs as Tr,a2 as Pr,xt as Or,f2 as an,q3 as Wr,xu as Hr,q6 as $r,ke as qr,c0 as on,qv as Gr,mx as Vr,xv as Ur,xw as Kr,xx as zr,xy as Qr,xz as Ds,xA as Xr,xB as Yr,xC as Zr,xD as Jr,xE as ea}from"./ny10lj7zpuz89fvf.js";import{W as Ve,c as je,n as D,Y as ta,q as ps,Q as gs,Z as sa,_ as na,S as ra,L as aa,M as oa,N as ia,$ as ca,a0 as la,I as ua,J as da,j as ha,y as ma,v as fa,x as pa,l as Ls,w as Ts,H as ga}from"./fmsmhem5hrm2cxrs.js";import{I as xa}from"./e2tpmvaykwot5faa.js";import{u as Ca}from"./ne36kgu5w1zang50.js";import{u as va}from"./frf4c35l48b0bjrb.js";import{e as ba}from"./h76aawyn0y8q6s6p.js";function wa(){const t=be();return ce(t,"3651421897")}const cn=t=>C.createElement("svg",re({width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),C.createElement("path",{d:"M18 4C19.6569 4 21 5.34315 21 7V14.5H21.5L21.6025 14.5049C22.1067 14.5562 22.5 14.9823 22.5 15.5V17C22.5 18.6569 21.1569 20 19.5 20H4.5C2.89489 20 1.58421 18.7394 1.50391 17.1543L1.5 17V15.5L1.50488 15.3975C1.55621 14.8933 1.98232 14.5 2.5 14.5H3V7C3 5.34315 4.34315 4 6 4H18ZM3.5 17L3.50488 17.1025C3.55621 17.6067 3.98232 18 4.5 18H19.5C20.0523 18 20.5 17.5523 20.5 17V16.5H3.5V17ZM6 6C5.44772 6 5 6.44772 5 7V14.5H19V7C19 6.44772 18.5523 6 18 6H6Z",fill:"currentColor"}));var Kt,Ps;function Ma(){if(Ps)return Kt;Ps=1;var t=Fn(),e=Cr();function s(n,o){return n&&n.length?e(n,t(o,2)):0}return Kt=s,Kt}var Ea=Ma();const At=zs(Ea),qe=ls({codeLabel:{id:"wham.composer.tool.codeLabel",defaultMessage:"Code"},codeSubmitLabel:{id:"wham.composer.tool.codeSubmitLabel",defaultMessage:"Code"},codeDescription:{id:"wham.composer.tool.codeDescription",defaultMessage:"Generate and edit code with full environment setup."},planLabel:{id:"wham.composer.tool.planLabel",defaultMessage:"Plan"},planSubmitLabel:{id:"wham.composer.tool.askSubmitLabel",defaultMessage:"Plan"},planDescription:{id:"wham.composer.tool.planDescription",defaultMessage:"Get a quick answer without modifying the repository."}}),ya=[{key:"code",environmentMode:"code",runEnvironmentInQaMode:!1,slashCommand:"code",icon:r.jsx(vr,{className:"icon","aria-hidden":!0}),analyticsAction:"code",messages:{label:qe.codeLabel,submitLabel:qe.codeSubmitLabel,description:qe.codeDescription}},{key:"plan",environmentMode:"ask",runEnvironmentInQaMode:!0,slashCommand:"plan",slashAliases:["qa","ask"],icon:r.jsx(br,{className:"icon","aria-hidden":!0}),analyticsAction:"ask",messages:{label:qe.planLabel,submitLabel:qe.planSubmitLabel,description:qe.planDescription}}];function Aa({taskId:t,hasMultipleInProgressOrStreamingTurns:e}){const s=$(),n=Js(),o=Nn(),[i,a]=C.useState(!1),{mutate:c}=Qs({mutationFn:async()=>{a(!0),await Ve.cancelTask(t)},onError:()=>{n.danger(s.formatMessage({id:"wham.whamTaskRow.failedToCancelTask",defaultMessage:"Failed to cancel task"}))},onSuccess:()=>{o.refetchQueries({queryKey:["wham","task",t]}),o.invalidateQueries({queryKey:["wham","tasks"]})}});return r.jsx(me,{color:"primary",type:"button",size:"small",className:e?void 0:"h-9 w-9",icon:i?Ue:wr,onClick:()=>(je.recordCancel("task-details"),c()),disabled:i,"aria-label":s.formatMessage({id:"wham.composer.cancelTask",defaultMessage:"Cancel task"}),"data-testid":"stop-button",children:e&&r.jsx(T,{id:"wham.composer.stopButton.multipleInProgressOrStreamingTurns",defaultMessage:"Stop all"})})}const ss=t=>C.createElement("svg",re({width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),C.createElement("path",{d:"M17.5 3C19.1569 3 20.5 4.34315 20.5 6C20.5 7.30574 19.6645 8.413 18.5 8.8252V9C18.5 11.2091 16.7091 13 14.5 13H9.5C8.39543 13 7.5 13.8954 7.5 15V15.1738C8.66468 15.5859 9.5 16.6941 9.5 18C9.5 19.6569 8.15685 21 6.5 21C4.84315 21 3.5 19.6569 3.5 18C3.5 16.6941 4.33532 15.5859 5.5 15.1738V8.8252C4.33548 8.413 3.5 7.30574 3.5 6C3.5 4.34315 4.84315 3 6.5 3C8.15685 3 9.5 4.34315 9.5 6C9.5 7.30574 8.66452 8.413 7.5 8.8252V11.5361C8.08845 11.1956 8.77125 11 9.5 11H14.5C15.6046 11 16.5 10.1046 16.5 9V8.8252C15.3355 8.413 14.5 7.30574 14.5 6C14.5 4.34315 15.8431 3 17.5 3ZM6.5 17C5.94772 17 5.5 17.4477 5.5 18C5.5 18.5523 5.94772 19 6.5 19C7.05228 19 7.5 18.5523 7.5 18C7.5 17.4477 7.05228 17 6.5 17ZM6.5 5C5.94772 5 5.5 5.44772 5.5 6C5.5 6.55228 5.94772 7 6.5 7C7.05228 7 7.5 6.55228 7.5 6C7.5 5.44772 7.05228 5 6.5 5ZM17.5 5C16.9477 5 16.5 5.44772 16.5 6C16.5 6.55228 16.9477 7 17.5 7C18.0523 7 18.5 6.55228 18.5 6C18.5 5.44772 18.0523 5 17.5 5Z",fill:"currentColor"}));function xs({triggerText:t,toolTip:e,ariaLabel:s,Icon:n,truncate:o=!0,isLoading:i=!1}){return r.jsx(Mr,{className:"composer-btn px-2","aria-label":s,"aria-busy":i,children:r.jsx(fe,{label:e,className:"text-sm font-medium",children:r.jsxs("div",{className:"flex max-w-full items-center gap-1.5 ps-1",children:[n,r.jsx("span",{className:ie("hidden sm:block",o?"max-w-[8rem] truncate md:max-w-[10rem]":"w-fit"),children:t}),i&&r.jsx(Ue,{"aria-hidden":!0,className:"icon-sm"}),r.jsx(Er,{"aria-hidden":!0,className:"icon-sm"})]})})})}function ve(x){var M=x,{children:t,className:e,onClick:s,isSelected:n,isActive:o,isVirtualHover:i=!1,label:a,isDisabled:c,tooltipLabel:l,isSubMenuTrigger:u,noDefaultHoverState:d,as:m="button",truncateLabel:h,infoIcon:p,infoLink:g,icon:b}=M,f=_s(M,["children","className","onClick","isSelected","isActive","isVirtualHover","label","isDisabled","tooltipLabel","isSubMenuTrigger","noDefaultHoverState","as","truncateLabel","infoIcon","infoLink","icon"]);const v=$();let S=r.jsx(r.Fragment,{});t?S=r.jsx("div",{className:"flex flex-1 items-center gap-4",children:t}):a&&(S=r.jsxs("div",{className:ie("flex items-center gap-3",h?"w-0 flex-1":"w-full"),children:[b&&(C.isValidElement(b)?b:r.jsx(Sa,{icon:b})),a&&r.jsx("div",{className:ie("flex flex-col items-start py-1",c&&"text-token-text-quaternary pointer-events-none",h&&"w-[100%]"),children:r.jsx("div",{className:ie("flex items-center text-start text-sm",h&&"w-full"),children:r.jsx("span",{className:"w-full overflow-hidden text-ellipsis whitespace-nowrap",children:a})})})]}),l&&(S=r.jsx(fe,{sideOffset:-10,label:l,className:"w-full",children:S})));const E=r.jsxs("div",{className:ie("flex items-center justify-center",(n||p&&g||u)&&"min-w-5"),children:[n&&r.jsx(_n,{className:"icon color:var(--tint-color,#0285FF) icon-sm","aria-label":v.formatMessage({id:"wham.codexMenuRow.selected",defaultMessage:"Selected"})}),p&&g&&r.jsx("a",{href:g,target:"_blank",rel:"noopener noreferrer",children:p}),u&&r.jsx(yr,{className:"icon text-token-text-tertiary w-7","aria-label":v.formatMessage({id:"wham.codexMenuRow.openSubmenu",defaultMessage:"Open submenu"})})]}),y=ie("flex cursor-pointer items-center rounded-[10px] px-2.5 py-1",(n||p&&g||u)&&"gap-4",o&&"bg-black/5 dark:bg-white/5",!d&&"hover:bg-black/5 dark:hover:bg-white/5",i&&"bg-black/5 dark:bg-white/5",e);if(m==="div"){const w=f;return r.jsxs("div",Vt(re({},w),{className:y,children:[S,E]}))}const F=f;return r.jsxs("button",Vt(re({type:"button"},F),{onClick:w=>{w.persist(),requestAnimationFrame(()=>{s==null||s(w)})},className:y,children:[S,E]}))}function Sa({icon:t}){const e=t;return r.jsx("div",{className:"text-token-text-secondary flex h-5 w-5 items-center justify-center",children:r.jsx(e,{className:"h-5 w-5 shrink-0","aria-label":""})})}const zt="wham-environment-popover-event";function ln(t,e,s){C.useEffect(()=>{function o(i){i.detail.popover!==t&&s()}return window.addEventListener(zt,o),()=>{window.removeEventListener(zt,o)}},[t,s]);const n=C.useCallback(o=>{window.dispatchEvent(new CustomEvent(zt,{detail:{popover:o}}))},[]);C.useEffect(()=>{e&&n(t)},[e,n,t])}const un=({items:t,onSelect:e,keyExtractor:s})=>{const[n,o]=C.useState(null),[i]=C.useState(new Map);return{hoveredId:n,setHoveredId:o,getItemRef:c=>l=>{const u=s(c);return l&&i.set(u,l),()=>{i.delete(u)}},itemRefs:i,onKeyDown:c=>{var p;const l=c.key==="ArrowDown"||c.key==="n"&&c.ctrlKey,u=c.key==="ArrowUp"||c.key==="p"&&c.ctrlKey;if(!(l||u||c.key==="Enter"))return;if(c.preventDefault(),c.key==="Enter"){n&&e(n);return}const d=t.findIndex(g=>s(g)===n),m=Ar(d-(u?1:-1),0,t.length-1),h=s(t[m]);(p=i.get(h))==null||p.scrollIntoView({behavior:"instant",block:"nearest"}),o(h)}}};function ja({environment:t,repository:e}){var g,b,f,x;const s=$(),{branch:n,setBranch:o}=D(),[i,a]=C.useState(""),[c,l]=C.useState(!1),u=C.useRef(null),d=()=>l(!1),m=(f=(b=(g=t==null?void 0:t.repos)==null?void 0:g[0])!=null?b:e==null?void 0:e.id)!=null?f:null,h=C.useRef(m),p=t?dn(t):(x=e==null?void 0:e.default_branch)!=null?x:"main";return C.useEffect(()=>{const M=h.current;if(h.current=m,!m){o(null);return}const v=ta(m);if(M!==m){if(v){o(v);return}o(p);return}n||o(v!=null?v:p)},[n,m,p,o]),ln("branch",c,()=>l(!1)),ps([{key:"whamBranches",action:()=>l(!0),actionMessageDescriptor:s.formatMessage({id:"wham.keyboardActions.whamBranches",defaultMessage:"Branches"}),group:ms.Chat,keyboardBinding:[Ge.Mod,"b"]}]),r.jsx("div",{className:"items-center rounded-full",children:r.jsxs(fs,{open:c,onOpenChange:l,children:[r.jsx(xs,{triggerText:n!=null?n:s.formatMessage({id:"wham.codexBranchPopover.selectABranch",defaultMessage:"Select a Branch"}),toolTip:n===""||c?"":n!=null&&n.length?n:s.formatMessage({id:"wham.codexBranchPopover.searchForYourBranchTooltip",defaultMessage:"Search for your branch"}),ariaLabel:s.formatMessage({id:"wham.codexBranchPopover.searchForYourBranchAria",defaultMessage:"Search for your branch"}),Icon:r.jsx(ss,{"aria-hidden":!0,className:"icon-sm"})}),r.jsx(gs,{align:"start",isOpen:c,closePopover:d,popoverContentRef:u,children:r.jsx(ka,{defaultBranch:p,repoId:m,searchQuery:i,setSearchQuery:a,setBranch:o,selectedBranch:n!=null?n:"",closePopover:d})})]})})}function ka({repoId:t,defaultBranch:e,setBranch:s,selectedBranch:n,searchQuery:o,setSearchQuery:i,closePopover:a}){const c=$(),l=C.useRef(null),u=Sr(o,300),d=C.useMemo(()=>t?sa(t):[],[t]),{data:m,isLoading:h,fetchNextPage:p,hasNextPage:g,isFetchingNextPage:b,error:f}=Bn({queryKey:["searchBranches",t,u],enabled:!!t,initialPageParam:null,queryFn:({pageParam:w})=>Ve.searchBranchesByRepository(t!=null?t:"",u,jr,w!=null?w:null),getNextPageParam:w=>{var _;return(_=w==null?void 0:w.cursor)!=null?_:null}}),x=C.useMemo(()=>{var L,O,A;const w=(A=(O=(L=m==null?void 0:m.pages)==null?void 0:L.flat().map(k=>k.items.flatMap(P=>P.branch)))==null?void 0:O.flat())!=null?A:[],_=new Set,B=[];e&&!_.has(e)&&(_.add(e),B.push(e));for(const k of d)_.has(k)||(_.add(k),B.push(k));for(const k of w)_.has(k)||(_.add(k),B.push(k));return B},[m,e,d]),M=w=>{s(w),a()},v=C.useMemo(()=>o!=null&&o.trim()?x.filter(w=>w.toLowerCase().includes(o.toLowerCase())):x!=null?x:[],[o,x]),{hoveredId:S,setHoveredId:E,onKeyDown:y,getItemRef:F}=un({items:v,keyExtractor:w=>w,onSelect:M});return C.useEffect(()=>{l.current&&l.current.focus()},[]),r.jsxs("div",{className:"gap flex max-h-[280px] w-90 flex-col rounded-lg p-0 md:max-h-[360px]",onClick:w=>{w.stopPropagation()},children:[r.jsx(en,{ref:l,className:"placeholder:text-token-text-tertiary !focus-within:ring-0 my-1.5 w-full border-0 bg-transparent ps-4 outline-none focus:border-0 focus:ring-0 focus:outline-none",type:"text",autoComplete:"off",inputClassName:"text-sm",name:"search-branch",value:o,suppressFocus:!0,onKeyDown:y,onChange:w=>i(w.target.value),placeholder:c.formatMessage({id:"wham.codexBranchPopover.branch",defaultMessage:"Search branches…"}),ariaLabel:c.formatMessage({id:"wham.codexBranchPopover.createBranchAria",defaultMessage:"Create a new branch"})}),r.jsx("div",{className:"bg-token-border-default h-px w-full"}),r.jsxs("div",{className:"min-h-18 w-full overflow-y-auto p-1.5",children:[v==null?void 0:v.map(w=>{const _=w===n;return r.jsx(ve,{className:"w-full max-w-full whitespace-nowrap",as:"button",onMouseEnter:()=>E(w),isVirtualHover:S===w,ref:F(w),onClick:()=>{M(w)},isSelected:_,label:w,truncateLabel:!0},w)}),f?r.jsx("div",{className:"flex items-center justify-center",children:r.jsx(T,{id:"wham.branchPopover.error",defaultMessage:"Error loading branches"})}):null,r.jsx(xa,{bgColor:"dark:bg-token-bg-secondary",hasNextPage:g,fetchNextPage:p,isFetchingNextPage:b||h})]})]})}function dn(t){var e;for(const s of t.repos){const n=(e=t.repo_map)==null?void 0:e[s];if(n!=null&&n.default_branch)return n.default_branch}return"main"}function Na(t,e){return{label:e,description:"",share_settings:"workspace",machine:"wham-public/wham-universal",repositoryId:t,workspaceDirectory:"/workspace",agentNetworkAccess:{mode:"off"},setupCommands:"",maintenanceSetupCommands:"",secrets:[],envVars:[],autoSetupSettings:null,cacheSettings:{post_setup_cache_enabled:!0}}}function Ba(){"use forget";const t=us.c(21),e=D(La),s=D(Da),n=D(Ra),o=D(Ia),i=D(_a),a=D(Fa),c=e!=null?e:"";let l;t[0]!==c?(l=["wham","repository",c],t[0]=c,t[1]=l):l=t[1];const u=!!e&&a;let d;t[2]!==e?(d=()=>Ve.getRepository(e!=null?e:""),t[2]=e,t[3]=d):d=t[3];let m;t[4]!==l||t[5]!==u||t[6]!==d?(m={queryKey:l,enabled:u,queryFn:d,staleTime:3e5},t[4]=l,t[5]=u,t[6]=d,t[7]=m):m=t[7];const{data:h}=Xs(m);let p;t[8]!==o||t[9]!==n||t[10]!==s||t[11]!==i?(p={onSuccess:S=>{if(!S)return;if(s(S.id),!D.getState().branch){const y=dn(S);n(y)}o(S.id),i(!1)}},t[8]=o,t[9]=n,t[10]=s,t[11]=i,t[12]=p):p=t[12];const{mutateAsync:g,isPending:b}=Ca(p);let f;t[13]!==g||t[14]!==h||t[15]!==e?(f=async()=>{const S=D.getState().environmentId;if(S)return S;if(!e)throw new Error("Repository is required to create an environment");if(!D.getState().useRepositoryAsEnvironment)return S;const E=h!=null?h:await Ve.getRepository(e!=null?e:"");return(await g(Na(E.id,E.name))).id},t[13]=g,t[14]=h,t[15]=e,t[16]=f):f=t[16];const x=f,M=!!e&&a;let v;return t[17]!==x||t[18]!==b||t[19]!==M?(v={isCreatingEnvironment:b,ensureEnvironment:x,hasRepository:M},t[17]=x,t[18]=b,t[19]=M,t[20]=v):v=t[20],v}function Fa(t){return t.useRepositoryAsEnvironment}function _a(t){return t.setUseRepositoryAsEnvironment}function Ia(t){return t.setAutoCreatedEnvironment}function Ra(t){return t.setBranch}function Da(t){return t.setEnvironmentId}function La(t){return t.selectedRepositoryId}function Nt(){const t=be();return ce(t,"3516223039")||void 0}function Ta({isSubmitDisabled:t,createTask:e,selectedTool:s,disabledReason:n,isFollowUp:o}){const i=$(),a=be(),c=In(),[l,u]=C.useState(!1),d=D(v=>v.environmentId),m=Nt(),{isCreatingEnvironment:h,ensureEnvironment:p,hasRepository:g}=Ba(),b=m&&!o&&!d&&g,f=ce(a,"3419038745"),x=C.useCallback(v=>{je.recordComposerAction(v?"ask":"code"),e({runEnvironmentInQaMode:v})},[e]),M=C.useCallback(async v=>{if(t){u(!0);return}if(!h){if(b){try{if(!await p())return}catch(S){return}x(v);return}x(v)}},[t,p,h,x,b]);return r.jsx("div",{className:"flex items-center gap-2 px-2",onClick:v=>v.stopPropagation(),children:f?r.jsx(fe,{label:n,open:c?l:void 0,onOpenChange:u,children:r.jsx("button",{"aria-label":i.formatMessage(Pa.submitLabel),color:"primary",type:"button",className:"composer-submit-btn composer-submit-button-color h-9 w-9",disabled:(t||h)&&!c,onClick:t?()=>u(!0):()=>M(s.runEnvironmentInQaMode),children:r.jsx(kr,{className:"icon"})})}):r.jsxs(r.Fragment,{children:[r.jsx(fe,{open:c?l:void 0,onOpenChange:u,label:n!=null?n:i.formatMessage({id:"wham.whamComposer.fasterTitle",defaultMessage:"Fast mode where the agent doesn't edit code"}),children:r.jsx(me,{color:"secondary",type:"button",className:c&&t?"opacity-50":"",disabled:(t||h)&&!c,onClick:()=>M(!0),children:r.jsx(T,{id:"wham.composer.askButton",defaultMessage:"Ask"})})}),r.jsx(fe,{label:n,children:r.jsx(me,{color:"primary",type:"button",className:c&&t?"opacity-50":"",disabled:(t||h)&&!c,onClick:()=>M(!1),children:r.jsx(T,{id:"wham.composer.codeItButton",defaultMessage:"Code"})})})]})})}const Pa=ls({submitLabel:{id:"gVT0DB",defaultMessage:"Submit"}}),Oa=4,Wa=t=>{switch(t){case 1:return r.jsx(ia,{"aria-hidden":!0,className:"icon-sm"});case 2:return r.jsx(oa,{"aria-hidden":!0,className:"icon-sm"});case 3:return r.jsx(aa,{"aria-hidden":!0,className:"icon-sm"});default:return r.jsx(ra,{"aria-hidden":!0,className:"icon-sm"})}};function Ha({attempts:t,setAttempts:e}){var u;const s=$(),[n,o]=C.useState(!1),i=C.useRef(null),a=()=>o(!1),c=be(),l=(u=Rn(c,"2179180337").value.max_attempts)!=null?u:Oa;return r.jsx($a,{children:r.jsxs(fs,{open:n,onOpenChange:o,children:[r.jsx(xs,{triggerText:s.formatMessage({id:"wham.attemptsSelector.trigger",defaultMessage:"{count}x"},{count:t}),toolTip:s.formatMessage({id:"wham.attemptsSelector.tooltip",defaultMessage:"Number of simultaneous versions"}),ariaLabel:s.formatMessage({id:"wham.attemptsSelector.ariaLabel",defaultMessage:"Open versions number selector, currently set to {count}x"},{count:t}),Icon:Wa(t),truncate:!1}),r.jsx(gs,{align:"start",isOpen:n,closePopover:a,popoverContentRef:i,children:r.jsx("div",{className:"flex w-50 flex-col rounded-lg p-1.5",children:[...Array(l)].map((d,m)=>r.jsx(ve,{className:"w-full",onClick:()=>{e(m+1),a()},isSelected:t===m+1,label:s.formatMessage({id:"wham.attemptsSelector.option",defaultMessage:"{count, plural, one {# version} other {# versions}}"},{count:m+1})},m+1))})})]})})}function $a({children:t}){const e=$(),s=Nr(),n=na(),o=s&&!s.isLoading&&s.eligible&&!n.isLoading&&!!n.data;return r.jsx(rn,{side:"bottom",theme:"bright",dismissOnOutsideClick:!0,badge:"new",show:o,sideOffset:0,className:"w-60",announcementKey:Br,title:e.formatMessage({id:"wham.composerBon.nuxTooltip.title",defaultMessage:"Best-of-N"}),description:e.formatMessage({id:"wham.composerBon.nuxTooltip.description",defaultMessage:"Generate multiple solutions so you can pick the best approach."}),onDismiss:s.markAsViewed,children:t})}function qa({repository:t,disabledRepositoryIds:e,isCreating:s,creatingRepositoryId:n,isSelected:o,onSelect:i}){var d,m;const a=(m=(d=t.repository_full_name)!=null?d:t.name)!=null?m:"",c=n===t.id,u=!!(e==null?void 0:e.has(t.id))||!!s&&!c||!!c;return r.jsx(ve,{as:"button",className:"w-full",onClick:()=>{u||i(t)},isSelected:o,isDisabled:u,label:a})}function Ga({repositories:t,isLoading:e,isError:s,error:n,search:o,onSelectRepository:i,existingEnvironmentRepositoryIds:a,showRepositoriesHeader:c}){"use no forget";const l=Ln("installations/select_target"),u=D(h=>h.selectedRepositoryId),d=D(h=>h.useRepositoryAsEnvironment),m=C.useMemo(()=>t.length?t.filter(h=>{var b,f,x,M,v;if(!h.id||a.has(h.id))return!1;if(!o)return!0;const p=((f=(b=h.repository_full_name)!=null?b:h.name)!=null?f:"").toLowerCase(),g=(v=(M=(x=h.owner)==null?void 0:x.login)==null?void 0:M.toLowerCase())!=null?v:"";return p.includes(o)||g.includes(o)}).sort((h,p)=>{var f,x,M,v;const g=(x=(f=h.repository_full_name)!=null?f:h.name)!=null?x:"",b=(v=(M=p.repository_full_name)!=null?M:p.name)!=null?v:"";return g.localeCompare(b)}):[],[a,o,t]);return r.jsxs("div",{className:"text-token-text-primary flex flex-col gap-0.5",children:[c&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"bg-token-border-default mt-2 h-px w-full"}),r.jsx(ve,{as:"div",className:"text-token-text-tertiary pointer-events-none w-full text-sm",label:r.jsx("div",{className:"flex items-center gap-2",children:r.jsx(T,{id:"wham.codexEnvironmentPopover.repositoriesWithoutEnvironments",defaultMessage:"Repositories"})})})]}),e?r.jsx("div",{className:"flex w-full items-center justify-center py-2",children:r.jsx(Ue,{className:"ms-2"})}):s?r.jsx(Dn,{as:"div",disabled:!0,className:"text-token-text-tertiary pointer-events-none w-full px-2.5",children:n!=null&&n.message?n.message:r.jsx(T,{id:"wham.codexEnvironmentPopover.repositoriesWithoutEnvironmentsError",defaultMessage:"Unable to load repositories"})}):m.length===0?r.jsx("div",{className:"p-5 text-center",children:r.jsx("p",{className:"text-token-text-tertiary text-sm",children:r.jsx(T,{id:"wham.environmentPopover.noRepositories",defaultMessage:"No repositories found"})})}):m.map(h=>r.jsx(qa,{repository:h,isSelected:d&&u===h.id,onSelect:i},h.id)),r.jsx("div",{className:"bg-token-border-default h-px w-full"}),r.jsx(ve,{as:"button",className:"w-full",onClick:()=>{window.open(l,"_blank")},label:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(T,{id:"o1jiyf",defaultMessage:"Configure Repositories on GitHub"}),r.jsx(Fr,{className:"icon-sm ms-2 inline-block"})]})})]})}function hn({className:t}){return r.jsx(_r,{className:ie("flex w-[8rem] items-center gap-1.5 rounded-full! md:w-[10rem]",t)})}function pe(t){return Array.isArray?Array.isArray(t):pn(t)==="[object Array]"}function Va(t){if(typeof t=="string")return t;let e=t+"";return e=="0"&&1/t==-1/0?"-0":e}function Ua(t){return t==null?"":Va(t)}function le(t){return typeof t=="string"}function mn(t){return typeof t=="number"}function Ka(t){return t===!0||t===!1||za(t)&&pn(t)=="[object Boolean]"}function fn(t){return typeof t=="object"}function za(t){return fn(t)&&t!==null}function te(t){return t!=null}function Qt(t){return!t.trim().length}function pn(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const Qa="Incorrect 'index' type",Xa=t=>"Invalid value for key ".concat(t),Ya=t=>"Pattern length exceeds max of ".concat(t,"."),Za=t=>"Missing ".concat(t," property in key"),Ja=t=>"Property 'weight' in key '".concat(t,"' must be a positive integer"),Os=Object.prototype.hasOwnProperty;class eo{constructor(e){this._keys=[],this._keyMap={};let s=0;e.forEach(n=>{let o=gn(n);this._keys.push(o),this._keyMap[o.id]=o,s+=o.weight}),this._keys.forEach(n=>{n.weight/=s})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function gn(t){let e=null,s=null,n=null,o=1,i=null;if(le(t)||pe(t))n=t,e=Ws(t),s=ns(t);else{if(!Os.call(t,"name"))throw new Error(Za("name"));const a=t.name;if(n=a,Os.call(t,"weight")&&(o=t.weight,o<=0))throw new Error(Ja(a));e=Ws(a),s=ns(a),i=t.getFn}return{path:e,id:s,weight:o,src:n,getFn:i}}function Ws(t){return pe(t)?t:t.split(".")}function ns(t){return pe(t)?t.join("."):t}function to(t,e){let s=[],n=!1;const o=(i,a,c)=>{if(te(i))if(!a[c])s.push(i);else{let l=a[c];const u=i[l];if(!te(u))return;if(c===a.length-1&&(le(u)||mn(u)||Ka(u)))s.push(Ua(u));else if(pe(u)){n=!0;for(let d=0,m=u.length;d<m;d+=1)o(u[d],a,c+1)}else a.length&&o(u,a,c+1)}};return o(t,le(e)?e.split("."):e,0),n?s:s[0]}const so={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},no={isCaseSensitive:!1,ignoreDiacritics:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(t,e)=>t.score===e.score?t.idx<e.idx?-1:1:t.score<e.score?-1:1},ro={location:0,threshold:.6,distance:100},ao={useExtendedSearch:!1,getFn:to,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var j=re(re(re(re({},no),so),ro),ao);const oo=/[^ ]+/g;function io(t=1,e=3){const s=new Map,n=Math.pow(10,e);return{get(o){const i=o.match(oo).length;if(s.has(i))return s.get(i);const a=1/Math.pow(i,.5*t),c=parseFloat(Math.round(a*n)/n);return s.set(i,c),c},clear(){s.clear()}}}class Cs{constructor({getFn:e=j.getFn,fieldNormWeight:s=j.fieldNormWeight}={}){this.norm=io(s,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((s,n)=>{this._keysMap[s.id]=n})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,le(this.docs[0])?this.docs.forEach((e,s)=>{this._addString(e,s)}):this.docs.forEach((e,s)=>{this._addObject(e,s)}),this.norm.clear())}add(e){const s=this.size();le(e)?this._addString(e,s):this._addObject(e,s)}removeAt(e){this.records.splice(e,1);for(let s=e,n=this.size();s<n;s+=1)this.records[s].i-=1}getValueForItemAtKeyId(e,s){return e[this._keysMap[s]]}size(){return this.records.length}_addString(e,s){if(!te(e)||Qt(e))return;let n={v:e,i:s,n:this.norm.get(e)};this.records.push(n)}_addObject(e,s){let n={i:s,$:{}};this.keys.forEach((o,i)=>{let a=o.getFn?o.getFn(e):this.getFn(e,o.path);if(te(a)){if(pe(a)){let c=[];const l=[{nestedArrIndex:-1,value:a}];for(;l.length;){const{nestedArrIndex:u,value:d}=l.pop();if(te(d))if(le(d)&&!Qt(d)){let m={v:d,i:u,n:this.norm.get(d)};c.push(m)}else pe(d)&&d.forEach((m,h)=>{l.push({nestedArrIndex:h,value:m})})}n.$[i]=c}else if(le(a)&&!Qt(a)){let c={v:a,n:this.norm.get(a)};n.$[i]=c}}}),this.records.push(n)}toJSON(){return{keys:this.keys,records:this.records}}}function xn(t,e,{getFn:s=j.getFn,fieldNormWeight:n=j.fieldNormWeight}={}){const o=new Cs({getFn:s,fieldNormWeight:n});return o.setKeys(t.map(gn)),o.setSources(e),o.create(),o}function co(t,{getFn:e=j.getFn,fieldNormWeight:s=j.fieldNormWeight}={}){const{keys:n,records:o}=t,i=new Cs({getFn:e,fieldNormWeight:s});return i.setKeys(n),i.setIndexRecords(o),i}function yt(t,{errors:e=0,currentLocation:s=0,expectedLocation:n=0,distance:o=j.distance,ignoreLocation:i=j.ignoreLocation}={}){const a=e/t.length;if(i)return a;const c=Math.abs(n-s);return o?a+c/o:c?1:a}function lo(t=[],e=j.minMatchCharLength){let s=[],n=-1,o=-1,i=0;for(let a=t.length;i<a;i+=1){let c=t[i];c&&n===-1?n=i:!c&&n!==-1&&(o=i-1,o-n+1>=e&&s.push([n,o]),n=-1)}return t[i-1]&&i-n>=e&&s.push([n,i-1]),s}const Se=32;function uo(t,e,s,{location:n=j.location,distance:o=j.distance,threshold:i=j.threshold,findAllMatches:a=j.findAllMatches,minMatchCharLength:c=j.minMatchCharLength,includeMatches:l=j.includeMatches,ignoreLocation:u=j.ignoreLocation}={}){if(e.length>Se)throw new Error(Ya(Se));const d=e.length,m=t.length,h=Math.max(0,Math.min(n,m));let p=i,g=h;const b=c>1||l,f=b?Array(m):[];let x;for(;(x=t.indexOf(e,g))>-1;){let F=yt(e,{currentLocation:x,expectedLocation:h,distance:o,ignoreLocation:u});if(p=Math.min(F,p),g=x+d,b){let w=0;for(;w<d;)f[x+w]=1,w+=1}}g=-1;let M=[],v=1,S=d+m;const E=1<<d-1;for(let F=0;F<d;F+=1){let w=0,_=S;for(;w<_;)yt(e,{errors:F,currentLocation:h+_,expectedLocation:h,distance:o,ignoreLocation:u})<=p?w=_:S=_,_=Math.floor((S-w)/2+w);S=_;let B=Math.max(1,h-_+1),L=a?m:Math.min(h+_,m)+d,O=Array(L+2);O[L+1]=(1<<F)-1;for(let k=L;k>=B;k-=1){let P=k-1,W=s[t.charAt(P)];if(b&&(f[P]=+!!W),O[k]=(O[k+1]<<1|1)&W,F&&(O[k]|=(M[k+1]|M[k])<<1|1|M[k+1]),O[k]&E&&(v=yt(e,{errors:F,currentLocation:P,expectedLocation:h,distance:o,ignoreLocation:u}),v<=p)){if(p=v,g=P,g<=h)break;B=Math.max(1,2*h-g)}}if(yt(e,{errors:F+1,currentLocation:h,expectedLocation:h,distance:o,ignoreLocation:u})>p)break;M=O}const y={isMatch:g>=0,score:Math.max(.001,v)};if(b){const F=lo(f,c);F.length?l&&(y.indices=F):y.isMatch=!1}return y}function ho(t){let e={};for(let s=0,n=t.length;s<n;s+=1){const o=t.charAt(s);e[o]=(e[o]||0)|1<<n-s-1}return e}const jt=String.prototype.normalize?t=>t.normalize("NFD").replace(/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/g,""):t=>t;class Cn{constructor(e,{location:s=j.location,threshold:n=j.threshold,distance:o=j.distance,includeMatches:i=j.includeMatches,findAllMatches:a=j.findAllMatches,minMatchCharLength:c=j.minMatchCharLength,isCaseSensitive:l=j.isCaseSensitive,ignoreDiacritics:u=j.ignoreDiacritics,ignoreLocation:d=j.ignoreLocation}={}){if(this.options={location:s,threshold:n,distance:o,includeMatches:i,findAllMatches:a,minMatchCharLength:c,isCaseSensitive:l,ignoreDiacritics:u,ignoreLocation:d},e=l?e:e.toLowerCase(),e=u?jt(e):e,this.pattern=e,this.chunks=[],!this.pattern.length)return;const m=(p,g)=>{this.chunks.push({pattern:p,alphabet:ho(p),startIndex:g})},h=this.pattern.length;if(h>Se){let p=0;const g=h%Se,b=h-g;for(;p<b;)m(this.pattern.substr(p,Se),p),p+=Se;if(g){const f=h-Se;m(this.pattern.substr(f),f)}}else m(this.pattern,0)}searchIn(e){const{isCaseSensitive:s,ignoreDiacritics:n,includeMatches:o}=this.options;if(e=s?e:e.toLowerCase(),e=n?jt(e):e,this.pattern===e){let b={isMatch:!0,score:0};return o&&(b.indices=[[0,e.length-1]]),b}const{location:i,distance:a,threshold:c,findAllMatches:l,minMatchCharLength:u,ignoreLocation:d}=this.options;let m=[],h=0,p=!1;this.chunks.forEach(({pattern:b,alphabet:f,startIndex:x})=>{const{isMatch:M,score:v,indices:S}=uo(e,b,f,{location:i+x,distance:a,threshold:c,findAllMatches:l,minMatchCharLength:u,includeMatches:o,ignoreLocation:d});M&&(p=!0),h+=v,M&&S&&(m=[...m,...S])});let g={isMatch:p,score:p?h/this.chunks.length:1};return p&&o&&(g.indices=m),g}}class we{constructor(e){this.pattern=e}static isMultiMatch(e){return Hs(e,this.multiRegex)}static isSingleMatch(e){return Hs(e,this.singleRegex)}search(){}}function Hs(t,e){const s=t.match(e);return s?s[1]:null}class mo extends we{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const s=e===this.pattern;return{isMatch:s,score:s?0:1,indices:[0,this.pattern.length-1]}}}class fo extends we{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const n=e.indexOf(this.pattern)===-1;return{isMatch:n,score:n?0:1,indices:[0,e.length-1]}}}class po extends we{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const s=e.startsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[0,this.pattern.length-1]}}}class go extends we{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const s=!e.startsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[0,e.length-1]}}}class xo extends we{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const s=e.endsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[e.length-this.pattern.length,e.length-1]}}}class Co extends we{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const s=!e.endsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[0,e.length-1]}}}class vn extends we{constructor(e,{location:s=j.location,threshold:n=j.threshold,distance:o=j.distance,includeMatches:i=j.includeMatches,findAllMatches:a=j.findAllMatches,minMatchCharLength:c=j.minMatchCharLength,isCaseSensitive:l=j.isCaseSensitive,ignoreDiacritics:u=j.ignoreDiacritics,ignoreLocation:d=j.ignoreLocation}={}){super(e),this._bitapSearch=new Cn(e,{location:s,threshold:n,distance:o,includeMatches:i,findAllMatches:a,minMatchCharLength:c,isCaseSensitive:l,ignoreDiacritics:u,ignoreLocation:d})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}}class bn extends we{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let s=0,n;const o=[],i=this.pattern.length;for(;(n=e.indexOf(this.pattern,s))>-1;)s=n+i,o.push([n,s-1]);const a=!!o.length;return{isMatch:a,score:a?0:1,indices:o}}}const rs=[mo,bn,po,go,Co,xo,fo,vn],$s=rs.length,vo=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,bo="|";function wo(t,e={}){return t.split(bo).map(s=>{let n=s.trim().split(vo).filter(i=>i&&!!i.trim()),o=[];for(let i=0,a=n.length;i<a;i+=1){const c=n[i];let l=!1,u=-1;for(;!l&&++u<$s;){const d=rs[u];let m=d.isMultiMatch(c);m&&(o.push(new d(m,e)),l=!0)}if(!l)for(u=-1;++u<$s;){const d=rs[u];let m=d.isSingleMatch(c);if(m){o.push(new d(m,e));break}}}return o})}const Mo=new Set([vn.type,bn.type]);class Eo{constructor(e,{isCaseSensitive:s=j.isCaseSensitive,ignoreDiacritics:n=j.ignoreDiacritics,includeMatches:o=j.includeMatches,minMatchCharLength:i=j.minMatchCharLength,ignoreLocation:a=j.ignoreLocation,findAllMatches:c=j.findAllMatches,location:l=j.location,threshold:u=j.threshold,distance:d=j.distance}={}){this.query=null,this.options={isCaseSensitive:s,ignoreDiacritics:n,includeMatches:o,minMatchCharLength:i,findAllMatches:c,ignoreLocation:a,location:l,threshold:u,distance:d},e=s?e:e.toLowerCase(),e=n?jt(e):e,this.pattern=e,this.query=wo(this.pattern,this.options)}static condition(e,s){return s.useExtendedSearch}searchIn(e){const s=this.query;if(!s)return{isMatch:!1,score:1};const{includeMatches:n,isCaseSensitive:o,ignoreDiacritics:i}=this.options;e=o?e:e.toLowerCase(),e=i?jt(e):e;let a=0,c=[],l=0;for(let u=0,d=s.length;u<d;u+=1){const m=s[u];c.length=0,a=0;for(let h=0,p=m.length;h<p;h+=1){const g=m[h],{isMatch:b,indices:f,score:x}=g.search(e);if(b){if(a+=1,l+=x,n){const M=g.constructor.type;Mo.has(M)?c=[...c,...f]:c.push(f)}}else{l=0,a=0,c.length=0;break}}if(a){let h={isMatch:!0,score:l/a};return n&&(h.indices=c),h}}return{isMatch:!1,score:1}}}const as=[];function yo(...t){as.push(...t)}function os(t,e){for(let s=0,n=as.length;s<n;s+=1){let o=as[s];if(o.condition(t,e))return new o(t,e)}return new Cn(t,e)}const kt={AND:"$and",OR:"$or"},is={PATH:"$path",PATTERN:"$val"},cs=t=>!!(t[kt.AND]||t[kt.OR]),Ao=t=>!!t[is.PATH],So=t=>!pe(t)&&fn(t)&&!cs(t),qs=t=>({[kt.AND]:Object.keys(t).map(e=>({[e]:t[e]}))});function wn(t,e,{auto:s=!0}={}){const n=o=>{let i=Object.keys(o);const a=Ao(o);if(!a&&i.length>1&&!cs(o))return n(qs(o));if(So(o)){const l=a?o[is.PATH]:i[0],u=a?o[is.PATTERN]:o[l];if(!le(u))throw new Error(Xa(l));const d={keyId:ns(l),pattern:u};return s&&(d.searcher=os(u,e)),d}let c={children:[],operator:i[0]};return i.forEach(l=>{const u=o[l];pe(u)&&u.forEach(d=>{c.children.push(n(d))})}),c};return cs(t)||(t=qs(t)),n(t)}function jo(t,{ignoreFieldNorm:e=j.ignoreFieldNorm}){t.forEach(s=>{let n=1;s.matches.forEach(({key:o,norm:i,score:a})=>{const c=o?o.weight:null;n*=Math.pow(a===0&&c?Number.EPSILON:a,(c||1)*(e?1:i))}),s.score=n})}function ko(t,e){const s=t.matches;e.matches=[],te(s)&&s.forEach(n=>{if(!te(n.indices)||!n.indices.length)return;const{indices:o,value:i}=n;let a={indices:o,value:i};n.key&&(a.key=n.key.src),n.idx>-1&&(a.refIndex=n.idx),e.matches.push(a)})}function No(t,e){e.score=t.score}function Bo(t,e,{includeMatches:s=j.includeMatches,includeScore:n=j.includeScore}={}){const o=[];return s&&o.push(ko),n&&o.push(No),t.map(i=>{const{idx:a}=i,c={item:e[a],refIndex:a};return o.length&&o.forEach(l=>{l(i,c)}),c})}class Ke{constructor(e,s={},n){this.options=re(re({},j),s),this.options.useExtendedSearch,this._keyStore=new eo(this.options.keys),this.setCollection(e,n)}setCollection(e,s){if(this._docs=e,s&&!(s instanceof Cs))throw new Error(Qa);this._myIndex=s||xn(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){te(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){const s=[];for(let n=0,o=this._docs.length;n<o;n+=1){const i=this._docs[n];e(i,n)&&(this.removeAt(n),n-=1,o-=1,s.push(i))}return s}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:s=-1}={}){const{includeMatches:n,includeScore:o,shouldSort:i,sortFn:a,ignoreFieldNorm:c}=this.options;let l=le(e)?le(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return jo(l,{ignoreFieldNorm:c}),i&&l.sort(a),mn(s)&&s>-1&&(l=l.slice(0,s)),Bo(l,this._docs,{includeMatches:n,includeScore:o})}_searchStringList(e){const s=os(e,this.options),{records:n}=this._myIndex,o=[];return n.forEach(({v:i,i:a,n:c})=>{if(!te(i))return;const{isMatch:l,score:u,indices:d}=s.searchIn(i);l&&o.push({item:i,idx:a,matches:[{score:u,value:i,norm:c,indices:d}]})}),o}_searchLogical(e){const s=wn(e,this.options),n=(c,l,u)=>{if(!c.children){const{keyId:m,searcher:h}=c,p=this._findMatches({key:this._keyStore.get(m),value:this._myIndex.getValueForItemAtKeyId(l,m),searcher:h});return p&&p.length?[{idx:u,item:l,matches:p}]:[]}const d=[];for(let m=0,h=c.children.length;m<h;m+=1){const p=c.children[m],g=n(p,l,u);if(g.length)d.push(...g);else if(c.operator===kt.AND)return[]}return d},o=this._myIndex.records,i={},a=[];return o.forEach(({$:c,i:l})=>{if(te(c)){let u=n(s,c,l);u.length&&(i[l]||(i[l]={idx:l,item:c,matches:[]},a.push(i[l])),u.forEach(({matches:d})=>{i[l].matches.push(...d)}))}}),a}_searchObjectList(e){const s=os(e,this.options),{keys:n,records:o}=this._myIndex,i=[];return o.forEach(({$:a,i:c})=>{if(!te(a))return;let l=[];n.forEach((u,d)=>{l.push(...this._findMatches({key:u,value:a[d],searcher:s}))}),l.length&&i.push({idx:c,item:a,matches:l})}),i}_findMatches({key:e,value:s,searcher:n}){if(!te(s))return[];let o=[];if(pe(s))s.forEach(({v:i,i:a,n:c})=>{if(!te(i))return;const{isMatch:l,score:u,indices:d}=n.searchIn(i);l&&o.push({score:u,key:e,value:i,idx:a,norm:c,indices:d})});else{const{v:i,n:a}=s,{isMatch:c,score:l,indices:u}=n.searchIn(i);c&&o.push({score:l,key:e,value:i,norm:a,indices:u})}return o}}Ke.version="7.1.0";Ke.createIndex=xn;Ke.parseIndex=co;Ke.config=j;Ke.parseQuery=wn;yo(Eo);var Xt,Gs;function Fo(){if(Gs)return Xt;Gs=1;var t=Tn(),e=Pn(),s=Hn(),n=tn(),o=On(),i=Wn(),a=Math.min;function c(l,u,d){for(var m=d?s:e,h=l[0].length,p=l.length,g=p,b=Array(p),f=1/0,x=[];g--;){var M=l[g];g&&u&&(M=n(M,o(u))),f=a(M.length,f),b[g]=!d&&(u||h>=120&&M.length>=120)?new t(g&&M):void 0}M=l[0];var v=-1,S=b[0];e:for(;++v<h&&x.length<f;){var E=M[v],y=u?u(E):E;if(E=d||E!==0?E:0,!(S?i(S,y):m(x,y,d))){for(g=p;--g;){var F=b[g];if(!(F?i(F,y):m(l[g],y,d)))continue e}S&&S.push(y),x.push(E)}}return x}return Xt=c,Xt}var Yt,Vs;function _o(){if(Vs)return Yt;Vs=1;var t=Ir();function e(s){return t(s)?s:[]}return Yt=e,Yt}var Zt,Us;function Io(){if(Us)return Zt;Us=1;var t=tn(),e=Fo(),s=Rr(),n=_o(),o=s(function(i){var a=t(i,n);return a.length&&a[0]===i[0]?e(a):[]});return Zt=o,Zt}var Ro=Io();const Do=zs(Ro);function Lo(){const{data:t,isError:e}=la(),{data:s,isLoading:n,isError:o}=ua();return{environments:s!=null?s:t,fullEnvironmentsLoading:n,isErrorEnvironments:o&&e}}function To({onCreateEnvironment:t,showBranchSelector:e=!0,filters:s=null}={}){"use no forget";var K,Fe,Ee,R;const n=$(),{environmentId:o,setEnvironmentId:i,selectedRepositoryId:a,setSelectedRepositoryId:c,setBranch:l,setUseRepositoryAsEnvironment:u,useRepositoryAsEnvironment:d}=D(),[m,h]=C.useState(!1),p=C.useRef(null),[g,b]=C.useState(!1),f=C.useRef(o),[x,M]=C.useState(null),v=Nt(),[S,E]=C.useState(""),{data:y,isLoading:F,isError:w,error:_}=ca(S),{environments:B,fullEnvironmentsLoading:L,isErrorEnvironments:O}=Lo(),A=C.useMemo(()=>s!=null&&s.repos?B==null?void 0:B.filter(I=>Do(I.repos,s.repos).length>0):B,[B,s]),k=A==null?void 0:A.find(I=>I.id===o),P=C.useCallback(I=>{var q,G;if(!I)return null;const H=(G=I.repos)!=null?G:Object.keys((q=I.repo_map)!=null?q:{});if(!H.length)return null;const[Y]=H;return Y!=null?Y:null},[]);ln("environment",m,()=>h(!1)),C.useEffect(()=>{f.current!==o&&(f.current=o,o!=null&&(b(!1),M(null)))},[o]),C.useEffect(()=>{if(!d){M(null);return}},[d]),C.useEffect(()=>{if(g||L)return;if(o&&!k){i(null),c(null);return}else if(!o&&(A!=null&&A.length)){const Y=ts(A,[G=>{var z;return!((z=G.is_pinned)!=null&&z)},G=>{var z;return-((z=G.task_count)!=null?z:0)}])[0];i(Y.id);const q=P(Y);c(q!=null?q:null);return}const I=P(k);I!=null&&I!==a?c(I):k&&I==null&&a!=null&&c(null)},[L,o,k,A,i,a,c,P,g]),C.useEffect(()=>{var H;if(!v||O||g||L||((H=A==null?void 0:A.length)!=null?H:0)>0||!(y!=null&&y.repositories.length))return;const[I]=y.repositories;if(I!=null&&I.id&&!o){if(a===I.id&&d){(x==null?void 0:x.id)!==I.id&&M(I);return}u(!0),c(I.id),M(I),l(null)}},[y,O,d,v,o,a,l,c,u,M,g,L,A==null?void 0:A.length,x==null?void 0:x.id]),ps([{key:"whamEnvironments",action:()=>h(!0),actionMessageDescriptor:n.formatMessage({id:"wham.keyboardActions.whamEnvironments",defaultMessage:"Environments"}),group:ms.Chat,keyboardBinding:[Ge.Mod,"e"]}]);const W=C.useCallback(()=>h(!1),[]),ue=C.useCallback(I=>{I!=null&&I.id&&(b(!0),i(null),u(!0),c(I.id),M(I),l(null),W())},[W,l,i,c,u]),Bt=n.formatMessage({id:"wham.codexEnvironmentPopover.selectEnvironment",defaultMessage:"Select environment"}),Ft=n.formatMessage({id:"wham.codexEnvironmentPopover.selectRepository",defaultMessage:"Select repository"}),de=n.formatMessage({id:"wham.codexEnvironmentPopover.viewAllCodeEnvironments",defaultMessage:"View all code environments"}),U=k==null?void 0:k.label,se=((K=U==null?void 0:U.length)!=null?K:0)>16,ge=d||(A==null?void 0:A.length)===0&&!L,ae=(Ee=(Fe=x==null?void 0:x.repository_full_name)!=null?Fe:x==null?void 0:x.name)!=null?Ee:Ft,ke=ae.length>16,_t=ge?ae:U!=null?U:Bt,Ne=ge?ke?ae:"":se?U!=null?U:"":U||m?"":de,Be=ge?r.jsx($n,{"aria-hidden":!0,className:"icon-sm"}):r.jsx(cn,{"aria-hidden":!0,className:"icon-sm"}),Me=C.useMemo(()=>{const I=new Set;return A==null||A.forEach(H=>{var q,G;((G=H.repos)!=null?G:Object.keys((q=H.repo_map)!=null?q:{})).forEach(z=>{z&&I.add(z)})}),I},[A]);return L&&!(A!=null&&A.length)?r.jsx("div",{className:"flex items-center gap-3 rounded-full",children:r.jsx(hn,{})}):r.jsxs("div",{className:"flex items-center gap-2 rounded-full",children:[r.jsxs(fs,{open:m,onOpenChange:h,children:[r.jsx(xs,{triggerText:_t,toolTip:Ne,ariaLabel:n.formatMessage({id:"wham.codexEnvironmentPopover.viewAll",defaultMessage:"View all code environments"}),Icon:Be}),r.jsx(gs,{align:"start",isOpen:m,closePopover:W,popoverContentRef:p,children:r.jsx(Po,{searchTerm:S,setSearchTerm:E,repositories:(R=y==null?void 0:y.repositories)!=null?R:[],isLoadingRepositories:F,isErrorRepositories:w,errorRepositories:_,isLoading:L,environments:A!=null?A:[],environmentId:o,setEnvironmentId:I=>{i(I);const H=A==null?void 0:A.find(q=>q.id===I),Y=P(H);c(Y!=null?Y:null)},closePopover:W,onSelectRepository:ue,disabledRepositoryIds:Me,onCreateEnvironment:t})})]}),k&&e&&r.jsx(ja,{environment:k})]})}function Po({searchTerm:t,setSearchTerm:e,repositories:s,isLoadingRepositories:n,isErrorRepositories:o,errorRepositories:i,isLoading:a,environments:c,environmentId:l,setEnvironmentId:u,closePopover:d,onSelectRepository:m,disabledRepositoryIds:h,onCreateEnvironment:p}){"use forget";const g=$(),b=C.useRef(null),f=B=>{u(B),d()},x=Ys(),M=c.length>0,v=Nt(),S=C.useMemo(()=>new Ke(c,{threshold:.4,keys:["label","repos"]}),[c]),E=C.useMemo(()=>{var A;if(!(t!=null&&t.trim())){const[k,P]=Dr(c,W=>W.is_pinned);return[...ts(k,W=>{var ue;return-((ue=W.task_count)!=null?ue:0)}),...ts(P,W=>{var ue;return-((ue=W.task_count)!=null?ue:0)})]}const B=t.trim().toLowerCase(),L=(A=S==null?void 0:S.search(t).map(k=>k.item))!=null?A:[],O=k=>{const P=k.toLowerCase();return P===B?0:P.startsWith(B)?1:2};return L.sort((k,P)=>{if(k.is_pinned!==P.is_pinned)return k.is_pinned?-1:1;const W=O(k.label)-O(P.label);return W!==0?W:k.label.localeCompare(P.label)})},[t,S,c]),{hoveredId:y,setHoveredId:F,onKeyDown:w,getItemRef:_}=un({items:E,keyExtractor:B=>B.id,onSelect:f});return C.useEffect(()=>{var B;(B=b.current)==null||B.focus()},[]),r.jsxs("div",{className:"flex max-h-[280px] w-80 flex-col overflow-y-auto rounded-lg md:max-h-[360px]",children:[(c.length>4||v)&&r.jsxs("div",{className:"contents",onClick:B=>{B.stopPropagation()},children:[r.jsx(en,{ref:b,className:"placeholder:text-token-text-tertiary !focus-within:ring-0 my-1.5 w-full border-0 bg-transparent ps-4 outline-none focus:border-0 focus:ring-0 focus:outline-none",inputClassName:"text-sm",type:"text",autoComplete:"off",name:"branch-to-add",value:t,onChange:B=>e(B.target.value),onKeyDown:w,suppressFocus:!0,placeholder:v&&c.length>0?g.formatMessage({id:"wham.codexEnvironmentPopover.searchEnvironmentsTooltip.envless",defaultMessage:"Search environments and repos…"}):v?g.formatMessage({id:"wham.codexEnvironmentPopover.searchEnvironmentsTooltip.envlessRepos",defaultMessage:"Search repositories…"}):g.formatMessage({id:"wham.codexEnvironmentPopover.searchEnvironmentsTooltip",defaultMessage:"Search environments…"}),ariaLabel:v?g.formatMessage({id:"wham.codexEnvironmentPopover.searchEnvironmentsAria.envless",defaultMessage:"Search environments and repos"}):g.formatMessage({id:"wham.codexEnvironmentPopover.searchEnvironmentsAria",defaultMessage:"Search environments"})}),r.jsx("div",{className:"bg-token-border-default h-px w-full"})]}),r.jsxs("div",{className:"flex min-h-0 flex-1 flex-col overflow-y-auto p-1.5",children:[v&&c.length>0&&r.jsx(ve,{as:"div",className:"text-token-text-tertiary pointer-events-none w-full text-sm",label:r.jsx("div",{className:"flex items-center gap-2",children:r.jsx(T,{id:"wham.codexEnvironmentPopover.envlessModeRepositories",defaultMessage:"Environments"})})}),a?r.jsx("div",{className:"flex w-full items-center justify-center py-2",children:r.jsx(Ue,{className:"ms-2"})}):c.length>0?E.length>0?E.map(B=>{const L=l===B.id;return r.jsx(ve,{as:"button",ref:_(B),onMouseEnter:()=>F(B.id),className:"w-full",truncateLabel:!0,onClick:()=>{f(B.id)},isVirtualHover:y===B.id,isSelected:L,label:B.label},B.id)}):r.jsx("div",{className:"p-5 text-center",children:r.jsx("p",{className:"text-token-text-tertiary text-sm",children:r.jsx(T,{id:"wham.environmentPopover.noMatches",defaultMessage:"No environments found"})})}):!v&&r.jsxs("div",{className:"p-2 text-center",children:[r.jsx("p",{className:"text-token-text-primary text-sm",children:r.jsx(T,{id:"wham.environmentPopover.noEnvironments",defaultMessage:"No environments"})}),r.jsx("p",{className:"text-token-text-secondary text-xs",children:r.jsx(T,{id:"wham.environmentPopover.missingEnvironment",defaultMessage:"Codex requires an environment to work"})})]}),v&&r.jsx(Ga,{onSelectRepository:m,existingEnvironmentRepositoryIds:h,showRepositoriesHeader:c.length>0,search:t.trim().toLowerCase(),repositories:s,isLoading:n,isError:o,error:i})]}),r.jsx("div",{className:"bg-token-border-default h-px w-full"}),r.jsx("div",{className:"bg-token-bg-tertiary flex flex-shrink-0 flex-col gap-1 px-2 py-1.5",children:r.jsx(ve,{className:"w-full",noDefaultHoverState:!0,onClick:()=>{!M&&p?p():x("/codex/settings/environments")},isSelected:!1,icon:r.jsx(qn,{className:"icon-sm"}),label:M?g.formatMessage({id:"wham.codexEnvironmentPopover.manageEnvironments",defaultMessage:"Manage environments"}):g.formatMessage({id:"wham.codexEnvironmentPopover.createEnvironment",defaultMessage:"Create environment"})},"environment-action")})]})}function Oo({onCreateEnvironment:t,showBranchSelector:e,filters:s}={}){const n=$(),{isConnected:o,isLoading:i,openGithubModal:a,error:c,refetch:l}=ds(hs.GITHUB_CONNECTOR,"github","/codex",St.CODEX),{enabled:u}=Gn(St.CODEX);return i?r.jsx(hn,{className:"h-9"}):c?r.jsx(fe,{label:n.formatMessage({id:"wham.whamComposerEnvironmentsSelector.failedClickToRetry",defaultMessage:"Click to retry"}),children:r.jsx(me,{color:"secondary",type:"button",className:"border-token-border-default flex w-fit items-center gap-1.5 rounded-full! border",onClick:l,children:r.jsxs("div",{className:"flex items-center gap-1.5",children:[r.jsx(cn,{"aria-hidden":!0,className:"icon-sm"}),r.jsx(T,{id:"wham.environmentsSelector.retry",defaultMessage:"Failed to load environments"})]})})}):u?r.jsx(r.Fragment,{children:r.jsx("div",{className:"z-0 flex w-full justify-between",children:o?r.jsx("div",{className:"flex gap-4",children:r.jsx(To,{onCreateEnvironment:t,showBranchSelector:e!=null?e:!0,filters:s!=null?s:null})}):r.jsx("div",{className:"flex gap-2",children:r.jsxs(me,{type:"button",color:"secondary",size:"small",onClick:a,children:[r.jsx(ss,{"aria-hidden":!0,className:"icon-sm me-1.5"}),r.jsx(T,{id:"wham.environmentsSelector.connectGithub",defaultMessage:"Connect GitHub"})]})})})}):r.jsx(fe,{label:n.formatMessage({id:"wham.whamComposerEnvironmentsSelector.disabledByWorkspaceAdmin",defaultMessage:"Disabled by workspace admin"}),children:r.jsxs(me,{type:"button",color:"secondary",onClick:a,disabled:!0,children:[r.jsx(ss,{"aria-hidden":!0,className:"icon-sm me-1.5"}),r.jsx(T,{id:"wham.environmentsSelector.connectGithub",defaultMessage:"Connect GitHub"})]})})}function vs(t){const e=$(),s=D(n=>{var o;return(o=n.getRateLimit())==null?void 0:o.resets_after_text});switch(t){case"enabled":return;case"rate-limit":return e.formatMessage({id:"wham.whamComposer.hitRateLimit",defaultMessage:"You have reached your rate limit. It will reset {resetsAfterText}"},{resetsAfterText:s});case"no-environment":return e.formatMessage({id:"wham.whamComposer.noEnvironment",defaultMessage:"No environment selected"});case"no-content":return e.formatMessage({id:"wham.whamComposer.noContent",defaultMessage:"Enter a prompt to continue"});case"no-github-connection":return e.formatMessage({id:"wham.whamComposer.noGitHubConnection",defaultMessage:"No GitHub connection"});case"no-repository":return e.formatMessage({id:"wham.whamComposer.noRepository",defaultMessage:"No repository selected"});case"connect-github-error":return e.formatMessage({id:"wham.whamComposer.connectGitHubError",defaultMessage:"Failed to load environments"});default:Vn(t)}}function bs({isFollowUp:t,hasComments:e}){const s=D(p=>{var g;return((g=p.getRateLimit())==null?void 0:g.remaining)===0}),n=D(({environmentId:p})=>p),o=D(({selectedRepositoryId:p})=>p),i=D(p=>p.useRepositoryAsEnvironment),a=Nt(),c=D(({branch:p})=>p),l=sn(),d=!Jt(()=>nn(l))||e,{isConnected:m,error:h}=ds(hs.GITHUB_CONNECTOR,"github","/codex",St.CODEX);if(s)return"rate-limit";if(!n&&!c&&!t){if(!a)return"no-environment";if(!o||!i)return"no-repository"}return!t&&!m?"no-github-connection":!t&&h?"connect-github-error":d?"enabled":"no-content"}function Wo(t){"use forget";const e=us.c(18),{children:s}=t,n=be(),{eligible:o,markAsViewed:i,isLoading:a}=Lr();let c;e[0]!==n?(c=ce(n,"3419038745"),e[0]=n,e[1]=c):c=e[1];const l=c,u=l&&!a&&o;let d;e[2]!==u?(d={enabled:u},e[2]=u,e[3]=d):d=e[3];const{isLoading:m,data:h}=da(d),p=l&&!a&&o&&!m&&h;let g,b;if(e[4]!==o||e[5]!==h||e[6]!==l||e[7]!==m||e[8]!==i?(g=()=>{o&&l&&!m&&!h&&i()},b=[o,l,m,h,i],e[4]=o,e[5]=h,e[6]=l,e[7]=m,e[8]=i,e[9]=g,e[10]=b):(g=e[9],b=e[10]),C.useEffect(g,b),!p){let v;return e[11]!==s?(v=r.jsx(r.Fragment,{children:s}),e[11]=s,e[12]=v):v=e[12],v}let f;e[13]===Symbol.for("react.memo_cache_sentinel")?(f=r.jsx(T,{id:"wham.combinedSubmitButtonNux.title",defaultMessage:"Ask mode is now /plan"}),e[13]=f):f=e[13];let x;e[14]===Symbol.for("react.memo_cache_sentinel")?(x=r.jsx("div",{className:"flex flex-col gap-3 text-sm",children:r.jsx("p",{children:r.jsx(T,{id:"wham.combinedSubmitButtonNux.body.combined",defaultMessage:"Type /plan or click + to ask Codex to plan changes or answer questions quickly."})})}),e[14]=x):x=e[14];let M;return e[15]!==s||e[16]!==i?(M=r.jsx(rn,{announcementKey:Tr,show:!0,side:"bottom",align:"center",sideOffset:12,theme:"bright",badge:"new",contentAlign:"start",dismissOnOutsideClick:!0,className:"max-w-xs",onDismiss:i,title:f,description:x,children:s}),e[15]=s,e[16]=i,e[17]=M):M=e[17],M}function Ho({selectableTools:t,selectedTool:e,onSelectTool:s,isGitHubConnected:n,isImageUploadEnabled:o,fileInputRef:i,onFileChange:a}){const c=$();return r.jsx(Wo,{children:r.jsxs("div",{className:"flex items-center",children:[r.jsxs(Ce.Root,{modal:!1,children:[r.jsx("div",{onPointerDown:l=>l.stopPropagation(),onClick:l=>l.stopPropagation(),children:r.jsx(Ce.Trigger,{asChild:!0,children:r.jsx("button",{type:"button",className:"composer-btn","aria-label":c.formatMessage({id:"wham.whamComposer.plusMenu",defaultMessage:"Composer actions"}),children:r.jsx(Pr,{className:"icon"})})})}),r.jsx(Ce.Portal,{children:r.jsxs(Ce.Content,{align:"start",sideOffset:8,className:"min-w-[16rem] p-1",children:[t.map(l=>r.jsxs(Ce.Item,{disabled:!l.available,className:"hover:bg-token-bg-tertiary flex items-center gap-2 rounded-lg px-3 py-2 text-start text-sm",onSelect:u=>{u.preventDefault(),l.available&&s(l.key)},children:[r.jsx("span",{className:"text-token-text-secondary",children:l.icon}),r.jsx("span",{className:ie("flex-1",l.key===e.key&&l.available?"text-token-text-brand font-medium":void 0),children:l.label})]},l.key)),n&&o&&r.jsxs(r.Fragment,{children:[t.length>0&&r.jsx(Ce.Separator,{className:"my-1"}),r.jsx(Ce.Item,{className:"hover:bg-token-bg-tertiary rounded-lg px-3 py-2 text-start text-sm",onSelect:l=>{var u;l.preventDefault(),(u=i.current)==null||u.click()},children:c.formatMessage({id:"wham.whamComposer.attachImage",defaultMessage:"Upload attachment"})})]})]})})]}),e.key!=="code"&&r.jsx(Or,{icon:e.icon,label:e.label,content:e.label,removable:!0,onRemove:()=>s("code")}),n&&o&&r.jsx("input",{ref:i,type:"file",accept:"image/*",multiple:!0,hidden:!0,onChange:a})]})})}function $o({comments:t,onClearComments:e}){const s=$();return t.length===0?null:r.jsxs("div",{className:"bg bg-token-bg-secondary mx-1 mt-1 flex items-center gap-2 rounded-t-3xl rounded-b-lg py-0.5 ps-3 pe-0.5 font-semibold text-blue-400",children:[r.jsx(an,{className:"icon"}),r.jsx("div",{className:"flex-1 text-sm",children:r.jsx(T,{id:"wham.composer.commentCount",defaultMessage:"{count, plural, one {One code comment} other {# code comments}}",values:{count:t.length}})}),r.jsx("button",{className:"text-token-text-secondary flex h-9 w-9 shrink-0 items-center justify-center",onClick:n=>{n.preventDefault(),n.stopPropagation(),e()},"aria-label":s.formatMessage({id:"wham.composer.clearComments",defaultMessage:"Clear comments"}),children:r.jsx(Un,{className:"icon"})})]})}function qo({composerController:t,layoutMode:e,slashCommands:s}){const n=$(),{refs:o,floatingStyles:i}=Kn({placement:"bottom-start",middleware:[zn({mainAxis:10,alignmentAxis:-18}),Qn({padding:6}),Xn({apply:({elements:E,availableWidth:y,availableHeight:F})=>{E.floating.style.setProperty("--radix-popper-available-width","".concat(y,"px")),E.floating.style.setProperty("--radix-popper-available-height","".concat(F,"px"))}})],whileElementsMounted:Yn}),[a,c]=C.useState(void 0);C.useEffect(()=>{const E=X(t);E.dispatch(Zn(E.state.tr,{setReferencePosition:o.setReference,onHintMatch(y){c(F=>Jn(F,y)?F:y)}}))},[t,o.setReference]);const l=C.useMemo(()=>!a||a.triggerSymbol!=="/"?[]:s.length?a.text?[Wr(s,a.text,E=>Hr(E),{locale:n.locale})]:[s.filter(E=>!E.noMatchEmpty)]:[],[a,n.locale,s]),u=C.useMemo(()=>e!=="bottom"?l:l.slice().reverse().map(E=>[...E].reverse()),[l,e]),d=C.useMemo(()=>u.flat(),[u]),[m,h]=C.useState(e==="bottom"?-1:0),p=m==null?null:(m+d.length)%d.length,g=C.useCallback(E=>{h(y=>{if(y==null)return null;const F=d.length;for(let w=0;w<F;w++){const _=(y+F+(w+1)*E)%F;if(!d[_].disabled)return _}return null})},[d]),b=C.useRef(g);b.current=g;const f=d.length===0;C.useEffect(()=>{if(f){h(null);return}e==="bottom"?(h(0),b.current(-1)):(h(-1),b.current(1))},[e,f]);const x=p==null?null:d[p],M=C.useCallback(()=>{if(a!=null&&a.range){const E=X(t);er(E,a.range.from,a.range.to)}},[t,a]),v=C.useCallback(({commandToSave:E=x,expectPerfectMatch:y})=>{var B;if(!a||!E||E.disabled)return!1;const F=a.text.toLocaleLowerCase(),w=[E.command,...(B=E.aliases)!=null?B:[]].some(L=>L.toLocaleLowerCase()===F);if(y&&!w)return!1;M();const _=X(t);return Xe(_),E.onSelect(),!0},[M,t,a,x]),S=C.useRef(v);return S.current=v,C.useEffect(()=>{if(f){const y=X(t);Xe(y);return}const E=X(t);return tr(E,y=>{if(y==="up")b.current(-1);else if(y==="down")b.current(1);else if(y==="cancel")Xe(E),sr(E);else{if(y==="submit")return Xe(E),S.current({expectPerfectMatch:!1});if(y==="checkMatch")return S.current({expectPerfectMatch:!0})}}),()=>Xe(E)},[t,f]),f?null:r.jsx(nr,{ref:o.setFloating,style:i,className:ie("max-w-[min(var(--radix-popper-available-width,100vw),--spacing(100))] overflow-y-auto [scrollbar-width:none]",d.length>6?"max-h-[min(var(--radix-popper-available-height,50svh),--spacing(1.5)+5*var(--menu-item-height))]":"max-h-[var(--radix-popper-available-height,50svh)]"),onPointerDown:E=>{E.preventDefault()},children:u.map((E,y)=>{let F=0;for(let w=0;w<y;w++)F+=u[w].length;return r.jsx(Ce.Group,{children:E.map((w,_)=>{const B=F+_;return r.jsx($r,{command:w,isHighlighted:B===p,onHighlight:()=>h(B),onClick:()=>{v({commandToSave:w,expectPerfectMatch:!1}),es(X(t))}},w.command)})},y)})})}function Go(){const t=$(),e=Ys(),{setupMfa:s}=va({redirectUrl:"/codex"});return r.jsx(rr,{isOpen:!0,onClose:()=>{},type:"warning",title:t.formatMessage({id:"wham.mfaRequiredModal.title",defaultMessage:"Enable multi-factor authentication to access Codex"}),description:t.formatMessage({id:"wham.mfaRequiredModal.description",defaultMessage:"To continue using Codex, please turn on multi-factor authentication for your account."}),testId:"modal-mfa-required",children:r.jsxs("div",{className:"flex w-full justify-end gap-2",children:[r.jsx(me,{color:"secondary",onClick:()=>{e("/")},children:r.jsx(T,{id:"wham.mfaRequiredModal.backToChatGPT",defaultMessage:"Back to ChatGPT"})}),r.jsx(me,{color:"primary",onClick:()=>{s()},children:r.jsx(T,{id:"wham.mfaRequiredModal.enableMFA",defaultMessage:"Enable MFA"})})]})})}const Vo=t=>C.createElement("svg",re({width:18,height:18,viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),C.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.5 4.5C5.68355 4.5 5.84354 4.62492 5.88806 4.80299C6.08089 5.57434 6.30775 6.04206 6.63284 6.36716C6.95794 6.69225 7.42566 6.91911 8.19701 7.11194C8.37508 7.15646 8.5 7.31645 8.5 7.5C8.5 7.68355 8.37508 7.84354 8.19701 7.88806C7.42566 8.08089 6.95794 8.30775 6.63284 8.63284C6.30775 8.95794 6.08089 9.42566 5.88806 10.197C5.84354 10.3751 5.68355 10.5 5.5 10.5C5.31645 10.5 5.15646 10.3751 5.11194 10.197C4.91911 9.42566 4.69225 8.95794 4.36716 8.63284C4.04206 8.30775 3.57434 8.08089 2.80299 7.88806C2.62492 7.84354 2.5 7.68355 2.5 7.5C2.5 7.31645 2.62492 7.15646 2.80299 7.11194C3.57434 6.91911 4.04206 6.69225 4.36716 6.36716C4.69225 6.04206 4.91911 5.57434 5.11194 4.80299C5.15646 4.62492 5.31645 4.5 5.5 4.5Z",fill:"currentColor"}),C.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12.5 2.5C12.6835 2.5 12.8435 2.62492 12.8881 2.80299C13.0809 3.57434 13.3077 4.04206 13.6328 4.36716C13.9579 4.69225 14.4257 4.91911 15.197 5.11194C15.3751 5.15646 15.5 5.31645 15.5 5.5C15.5 5.68355 15.3751 5.84354 15.197 5.88806C14.4257 6.08089 13.9579 6.30775 13.6328 6.63284C13.3077 6.95794 13.0809 7.42566 12.8881 8.19701C12.8435 8.37508 12.6835 8.5 12.5 8.5C12.3165 8.5 12.1565 8.37508 12.1119 8.19701C11.9191 7.42566 11.6923 6.95794 11.3672 6.63284C11.0421 6.30775 10.5743 6.08089 9.80299 5.88806C9.62492 5.84354 9.5 5.68355 9.5 5.5C9.5 5.31645 9.62492 5.15646 9.80299 5.11194C10.5743 4.91911 11.0421 4.69225 11.3672 4.36716C11.6923 4.04206 11.9191 3.57434 12.1119 2.80299C12.1565 2.62492 12.3165 2.5 12.5 2.5Z",fill:"currentColor"}),C.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10.5 9.5C10.6835 9.5 10.8435 9.62492 10.8881 9.80299C11.0809 10.5743 11.3077 11.0421 11.6328 11.3672C11.9579 11.6923 12.4257 11.9191 13.197 12.1119C13.3751 12.1565 13.5 12.3165 13.5 12.5C13.5 12.6835 13.3751 12.8435 13.197 12.8881C12.4257 13.0809 11.9579 13.3077 11.6328 13.6328C11.3077 13.9579 11.0809 14.4257 10.8881 15.197C10.8435 15.3751 10.6835 15.5 10.5 15.5C10.3165 15.5 10.1565 15.3751 10.1119 15.197C9.91911 14.4257 9.69225 13.9579 9.36716 13.6328C9.04206 13.3077 8.57434 13.0809 7.80299 12.8881C7.62492 12.8435 7.5 12.6835 7.5 12.5C7.5 12.3165 7.62492 12.1565 7.80299 12.1119C8.57434 11.9191 9.04206 11.6923 9.36716 11.3672C9.69225 11.0421 9.91911 10.5743 10.1119 9.80299C10.1565 9.62492 10.3165 9.5 10.5 9.5Z",fill:"currentColor"}));function vi(t){const{outputDiffs:e}=Mn(t==null?void 0:t.output_items);return{filesModified:At(e,s=>{var n;return(n=s.files_modified)!=null?n:0}),linesAdded:At(e,s=>{var n;return(n=s.lines_added)!=null?n:0}),linesRemoved:At(e,s=>{var n;return(n=s.lines_removed)!=null?n:0})}}function Mn(t){let e=!1;return t?{outputDiffs:t.map(n=>{switch(n.type){case"output_diff":return n;case"pr":return e=!!n.pre_apply_patch,n.output_diff;case"cr":return n.reviewed_diff;default:return null}}).filter(n=>n!=null),hasPreApplyPatch:e}:{outputDiffs:[],hasPreApplyPatch:e}}const Uo=ar(()=>or(()=>import("./exmp9n2h3sabhuz6.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29])).then(t=>t.SpeculativeTaskContentModal));function Ko({taskId:t,index:e,assistantTurn:s,suggestion:n,disabledReason:o,loading:i}){const{outputDiffs:a}=Mn(s.output_items),c=a[0];return r.jsx(fe,{side:"right",sideOffset:10,label:o,children:r.jsxs("div",{className:"flex w-full items-center gap-1.5 rounded-lg px-2 py-1",children:[r.jsx("span",{className:"self-start pt-[0.125rem]",children:i?r.jsx(Ue,{className:"text-token-text-tertiary icon-sm"}):r.jsx(Vo,{className:"text-token-text-tertiary icon-sm"})}),r.jsx("span",{className:"text-token-text-primary line-clamp-2 flex-1 text-start text-sm leading-snug break-words",children:n.title}),c&&c.lines_added!=null&&c.lines_removed!=null&&r.jsx(ha,{className:"text-sm",linesAdded:c.lines_added,linesRemoved:c.lines_removed}),r.jsx(zo,{taskId:t,assistantTurn:s,suggestion:n,index:e})]})})}function zo({taskId:t,assistantTurn:e,suggestion:s,index:n}){const[o,i]=C.useState(!1);return r.jsxs("div",{onClick:a=>{a.stopPropagation(),a.preventDefault()},children:[r.jsx(me,{color:"secondary",size:"small",icon:qr,onClick:a=>{a.stopPropagation(),a.preventDefault(),i(!0)},children:r.jsx(T,{id:"wham.speculativeFollowUpSuggestionRow.preview",defaultMessage:"Preview"})}),r.jsx(Uo,{taskId:t,suggestion:s,index:n,assistantTurn:e,isOpen:o,onClose:()=>i(!1)})]})}function Qo({taskId:t,turnId:e,followupVisibilityState:s,followUpSuggestions:n,hasComments:o,isSubmitting:i,onSuggestionClick:a,children:c}){const l=$(),[u,d]=C.useState(null),{data:m}=Xo({taskId:t,turnId:e}),h=bs({isFollowUp:!0,hasComments:o});let p=vs(h);h==="no-content"&&(p=void 0);const g=!!(m!=null&&m.length)&&t&&e;return C.useEffect(()=>{g&&je.recordFollowUpsSeen(t,e,n.length)},[g,t,e,n.length]),g?r.jsxs("div",{className:"bg-token-bg-tertiary flex flex-col gap-1.5 rounded-2xl p-2",children:[r.jsx(Zs,{initial:!1,children:s==="visible"&&r.jsx("div",{className:"flex flex-col",inert:i,children:m.map(({suggested_task:b,assistant_turn:f},x)=>r.jsx(Ko,{index:x,taskId:t,turnId:e,assistantTurn:f,suggestion:b,disabledReason:p,loading:u===x&&i,onClick:()=>{i||(d(x),a(b))}},x))})}),s==="collapsed"&&r.jsxs("button",{type:"button",className:"text-token-text-tertiary enabled:hover:text-token-text-secondary focus:bg-token-bg-secondary flex items-center gap-2 rounded-lg p-2 text-xs font-semibold focus:outline-none","aria-label":l.formatMessage({id:"wham.speculativeFollowUpContainer.showSuggestions",defaultMessage:"Show follow up suggestions"}),onClick:()=>{je.recordFollowUpsExpanded(t,e)},children:[r.jsx(on,{className:"icon-sm"}),r.jsx(T,{id:"wham.composer.followup.show",defaultMessage:"Suggestions"},"text")]},"collapsed"),c({isWrappedByContainer:!0})]}):c({isWrappedByContainer:!1})}function Xo({taskId:t,turnId:e}){return Xs({queryKey:["wham","speculative-turns",t,e],queryFn:async()=>{const s=await ir.safeGet("/wham/tasks/{task_id}/speculative_turns/{task_turn_id}",{parameters:{path:{task_id:t,task_turn_id:e}}}),n=s.speculative_turns;return ba(n,i=>i.assistant_turn.turn_status==="completed")?s.speculative_turns.filter(i=>!i.assistant_turn.discarded):[]},refetchInterval:s=>{var o,i;return s&&((i=(o=s.state)==null?void 0:o.data)==null?void 0:i.some(a=>a.assistant_turn.turn_status==="pending"||a.assistant_turn.turn_status==="in_progress"))?3e4:!1}})}function Yo({taskId:t,turnId:e,isComposerExpanded:s,followUpSuggestions:n,hasComments:o,isSubmitting:i,onSuggestionClick:a,children:c}){const l=be(),u=Jo(l,s),d=$(),[m,h]=C.useState(null),p=bs({isFollowUp:!0,hasComments:o});let g=vs(p);p==="no-content"&&(g=void 0);const b=!(u==="hidden"||!n.length)&&t&&e;if(C.useEffect(()=>{b&&je.recordFollowUpsSeen(t,e,n.length)},[b,t,e,n.length]),b){if(ce(l,"2007094101")&&n.find(f=>!!f.assistantTurnId))return r.jsx(Qo,{taskId:t,turnId:e,followupVisibilityState:u,followUpSuggestions:n,hasComments:o,isSubmitting:i,onSuggestionClick:a,children:({isWrappedByContainer:f})=>c({isWrappedByContainer:f})})}else return c({isWrappedByContainer:!1});return r.jsxs("div",{className:"bg-token-bg-tertiary flex flex-col gap-1.5 rounded-2xl p-2",children:[r.jsx(Zs,{initial:!1,children:u==="visible"&&r.jsx("div",{className:"flex flex-col",inert:i,children:n.map((f,x)=>r.jsx(Zo,{index:x,taskId:t,turnId:e,suggestion:f.suggestion,disabledReason:g,loading:m===x&&i,onClick:()=>{i||(h(x),a(f.suggestion))}},x))})}),u==="collapsed"&&r.jsxs("button",{type:"button",className:"text-token-text-tertiary enabled:hover:text-token-text-secondary focus:bg-token-bg-secondary flex items-center gap-2 rounded-lg p-2 text-xs font-semibold focus:outline-none","aria-label":d.formatMessage({id:"wham.followUpContainer.showSuggestions",defaultMessage:"Show follow up suggestions"}),onClick:()=>{je.recordFollowUpsExpanded(t,e)},children:[r.jsx(on,{className:"icon-sm"}),r.jsx(T,{id:"wham.composer.followup.show",defaultMessage:"Suggestions"},"text")]},"collapsed"),c({isWrappedByContainer:!0})]})}function Zo({taskId:t,turnId:e,index:s,suggestion:n,disabledReason:o,loading:i,onClick:a}){return r.jsx(fe,{side:"right",sideOffset:10,label:o,children:r.jsxs("button",{type:"button",disabled:!!o||i,className:"group hover:bg-token-bg-secondary focus:bg-token-bg-secondary -disabled:cursor-pointer flex w-full items-start gap-1.5 rounded-lg px-2 py-1 focus:outline-none disabled:cursor-not-allowed disabled:opacity-50",onClick:()=>{a(),je.recordFollowUpsClicked(t,e,s,n.severity)},children:[r.jsx("span",{className:"pt-[0.125rem]",children:i?r.jsx(Ue,{className:"text-token-text-tertiary icon-sm"}):r.jsx(an,{className:"text-token-text-tertiary icon-sm"})}),r.jsx("span",{className:"text-token-text-primary line-clamp-2 text-start text-sm leading-snug break-words",children:n.title})]})})}function Jo(t,e){return ce(t,"3485296344")||void 0?e?"collapsed":"visible":"hidden"}function ei(){const t=be(),e=D(n=>n.bestOfN);return e!=null?e:cr(t,"2398649844").get("default_attempts",1)}function bi(t){"use forget";var Ms,Es,ys,As,Ss,js;const e=us.c(131),{disableAutoFocus:s,isBigBoxMode:n,disableDuringSubmit:o,expanded:i,followUp:a,onClearComments:c,onSubmit:l,onSuccess:u,onCreateEnvironment:d,attemptIndex:m,ariaLabel:h}=t,p=s===void 0?!1:s,g=n===void 0?!1:n,b=o===void 0?!1:o,f=$(),x=Js(),[M,v]=C.useState("code"),{refetch:S}=ma(),{refetch:E}=fa(a==null?void 0:a.taskId),{refetch:y}=pa(a==null?void 0:a.taskId),F=D(li),w=D(ci),[_,B]=C.useState(!0),[L,O]=C.useState(!1),A=lr(),k=Is(ii),P=Is(Ut.hasUploadInProgress),W=ei(),ue=D(oi),[Bt,Ft]=C.useState(1),de=a?Bt:W,U=a?Ft:ue,se=be();let ge;e[0]!==se?(ge=ce(se,"3492040717"),e[0]=se,e[1]=ge):ge=e[1];const ae=ge;let ke;e[2]!==se?(ke=ce(se,"879591222")||void 0,e[2]=se,e[3]=ke):ke=e[3];const _t=ke;let Ne;e[4]!==se?(Ne=ce(se,"3536244140"),e[4]=se,e[5]=Ne):Ne=e[5];const Be=Ne,Me=ce(se,"3419038745"),K=wa(),[Fe,Ee]=C.useState(!1),R=sn();let I;e[6]!==R?(I=Gr(R),e[6]=R,e[7]=I):I=e[7];const H=Jt(I.isWhisperActive$),Y=C.useRef(null),q=D(ai),G=q&&!!a,z=G?!1:H?!0:i;let Ye;e[8]!==R||e[9]!==z?(Ye=()=>z!=null?z:!nn(R)||ur(R),e[8]=R,e[9]=z,e[10]=Ye):Ye=e[10];const xe=Jt(Ye),It=b&&L||G,ne=!!a&&((Ms=a.comments.length)!=null?Ms:0)>0;let Ze;e[11]!==A||e[12]!==f||e[13]!==x?(Ze=N=>{for(const V of N)Mt.uploadFile(A,dr(V),V,hr.Codex,[],f,x)},e[11]=A,e[12]=f,e[13]=x,e[14]=Ze):Ze=e[14];const ye=Ze;let Je;e[15]!==ye?(Je=function(V){const J=V.target.files;J&&(ye(J),V.target.value="")},e[15]=ye,e[16]=Je):Je=e[16];const Rt=Je;let et,tt;e[17]!==R||e[18]!==K||e[19]!==ye?(et=()=>{if(!K)return;const N=V=>{var ze;const J=(ze=V.clipboardData)==null?void 0:ze.items;if(!J)return;const ee=[];for(const Gt of J)if(Gt.kind==="file"){const $e=Gt.getAsFile();$e&&$e.type.startsWith("image/")&&ee.push($e)}ee.length>0&&(V.preventDefault(),ye(ee))};return mr(X(R).dom,{paste:N})},tt=[R,K,ye],e[17]=R,e[18]=K,e[19]=ye,e[20]=et,e[21]=tt):(et=e[20],tt=e[21]),C.useEffect(et,tt);let st;e[22]!==A?(st=function(){return Ut.getReadyFiles(A.getState()).flatMap(ri)},e[22]=A,e[23]=st):st=e[23];const Dt=st;let _e;e[24]!==R?(_e=()=>es(X(R)),e[24]=R,e[25]=_e):_e=e[25];let Ie;e[26]!==f?(Ie=f.formatMessage({id:"wham.keyboardActions.focusComposer",defaultMessage:"Focus chat"}),e[26]=f,e[27]=Ie):Ie=e[27];let nt;e[28]===Symbol.for("react.memo_cache_sentinel")?(nt=[Ge.Shift,Ge.Escape],e[28]=nt):nt=e[28];let Re;e[29]!==a?(Re=a?void 0:[[Ge.Mod,Ge.Shift,"o"]],e[29]=a,e[30]=Re):Re=e[30];let rt;e[31]!==_e||e[32]!==Ie||e[33]!==Re?(rt=[{key:"focusComposer",action:_e,actionMessageDescriptor:Ie,group:ms.Chat,keyboardBinding:nt,altKeyboardBindings:Re}],e[31]=_e,e[32]=Ie,e[33]=Re,e[34]=rt):rt=e[34],ps(rt);const Lt=!!a;let at;e[35]!==ne||e[36]!==Lt?(at={isFollowUp:Lt,hasComments:ne},e[35]=ne,e[36]=Lt,e[37]=at):at=e[37];const En=bs(at),{isConnected:De}=ds(hs.GITHUB_CONNECTOR,"github","/codex",St.CODEX),ot=vs(En),Le=!!ot||L&&b||P,Tt=ya.map(N=>{const V=!N.requiresGitHubConnection||De,J=!N.requiresReviewFeature,ee=V&&J&&Me;return{key:N.key,label:f.formatMessage(N.messages.label),submitLabel:f.formatMessage(N.messages.submitLabel),description:f.formatMessage(N.messages.description),environmentMode:N.environmentMode,runEnvironmentInQaMode:N.runEnvironmentInQaMode,slashCommand:N.slashCommand,slashAliases:N.slashAliases,icon:N.icon,analyticsAction:N.analyticsAction,available:ee,disabledReason:!ee&&N.messages.unavailable?f.formatMessage(N.messages.unavailable):void 0}}),ws=new Map(Tt.map(ni)),it=Tt.filter(si),yn=(Es=ws.get("code"))!=null?Es:Tt[0],he=(ys=ws.get(M))!=null?ys:yn;let ct;e[38]===Symbol.for("react.memo_cache_sentinel")?(ct=N=>({command:N.slashCommand,aliases:N.slashAliases,title:N.label,secondary:void 0,icon:N.icon,disabled:!N.available,onSelect:()=>{N.available&&v(N.key)}}),e[38]=ct):ct=e[38];const Pt=it.map(ct);let Te;e[39]!==de||e[40]!==ae||e[41]!==R||e[42]!==A||e[43]!==a||e[44]!==Dt||e[45]!==ne||e[46]!==f||e[47]!==_||e[48]!==K||e[49]!==l||e[50]!==Ee||e[51]!==x?(Te=async N=>{const{runEnvironmentInQaMode:V,promptOverride:J}=N===void 0?{runEnvironmentInQaMode:!1}:N,ee=J!=null?J:fr(X(R).state.doc).content,ze=Ut.getReadyFiles(A.getState());if(!(!!ee.length||ne))throw new Error("No content to submit");const $e=K?Dt():[];if(l==null||l(),Mt.reset(A),O(!0),a)return await Ve.createFollowUpTask(a.taskId,a.turnId,ee,a.comments,V,ae?de:void 0,$e).catch(oe=>{var Qe;throw J||(Rs(X(R),ee),Mt.restoreFiles(A,ze)),oe instanceof Et&&oe.status===429?x.danger(f.formatMessage(Ks.rateLimit),{id:a.turnId,duration:5,hasCloseButton:!0}):oe instanceof Ls?Ts(oe,a.turnId,f,x):oe instanceof Et&&oe.status===403&&((Qe=oe.detail)!=null&&Qe.toLowerCase().includes("multi-factor authentication"))?Ee(!0):x.danger(f.formatMessage({id:"wham.whamComposer.failedToCreateFollowUpTask",defaultMessage:"Failed to create follow-up"}),{id:a.turnId,duration:5,hasCloseButton:!0}),oe});{const{branch:oe,environmentId:Qe}=D.getState(),An=_;if(oe){if(!Qe)throw new Error("Environment is required for new tasks.")}else throw new Error("Branch is required");const Ae=crypto.randomUUID();return D.getState().addPendingTaskId(Ae),Ve.createNewTask(Qe,oe,ee,V,ae?de:void 0,$e).catch(Q=>{throw D.getState().removePendingTaskId(Ae),J||(pr(X(R).state.doc)?(Rs(X(R),ee),Mt.restoreFiles(A,ze)):(x.danger(f.formatMessage({id:"wham.whamComposer.failedToCreateTaskCopyToClipboard",defaultMessage:"Failed to create task. Previous prompt copied to clipboard."}),{id:Ae,duration:5,hasCloseButton:!0}),navigator.clipboard.writeText(ee))),Q}).catch(Q=>{var ks;throw Q instanceof Et&&Q.status===429?x.danger(f.formatMessage(Ks.rateLimit),{id:Ae,duration:5,hasCloseButton:!0}):Q instanceof Ls?Ts(Q,Ae,f,x):Q instanceof Et&&Q.status===403&&((ks=Q.detail)!=null&&ks.toLowerCase().includes("multi-factor authentication"))?Ee(!0):x.danger(f.formatMessage({id:"wham.whamComposer.failedToCreateTask",defaultMessage:"Failed to create task"}),{id:Ae,duration:5,hasCloseButton:!0}),Q}).then(Q=>(D.getState().assignPendingTaskToFinalTask(Ae,Q.task.id),D.getState().setRateLimit(Q.rate_limit),An&&B(!1),Q))}},e[39]=de,e[40]=ae,e[41]=R,e[42]=A,e[43]=a,e[44]=Dt,e[45]=ne,e[46]=f,e[47]=_,e[48]=K,e[49]=l,e[50]=Ee,e[51]=x,e[52]=Te):Te=e[52];let Pe;e[53]!==F||e[54]!==R||e[55]!==a||e[56]!==u||e[57]!==E||e[58]!==S||e[59]!==y||e[60]!==w?(Pe=N=>{w(!0),F(N.task.id,N.turn),N.user_turn&&F(N.task.id,N.user_turn),u==null||u(N),setTimeout(()=>{es(X(R))},0),S(),a&&(E(),y())},e[53]=F,e[54]=R,e[55]=a,e[56]=u,e[57]=E,e[58]=S,e[59]=y,e[60]=w,e[61]=Pe):Pe=e[61];let lt;e[62]===Symbol.for("react.memo_cache_sentinel")?(lt=()=>{O(!1)},e[62]=lt):lt=e[62];let ut;e[63]!==Te||e[64]!==Pe?(ut={mutationFn:Te,onSuccess:Pe,onSettled:lt},e[63]=Te,e[64]=Pe,e[65]=ut):ut=e[65];const{mutate:Z,isPending:dt}=Qs(ut);let ht;e[66]!==Me||e[67]!==Z||e[68]!==Le||e[69]!==he?(ht=N=>Le?!1:N.metaKey?(Z(Me?{runEnvironmentInQaMode:he.runEnvironmentInQaMode}:{runEnvironmentInQaMode:!1}),!0):N.altKey?(Z(Me?{runEnvironmentInQaMode:he.runEnvironmentInQaMode}:{runEnvironmentInQaMode:!0}),!0):!1,e[66]=Me,e[67]=Z,e[68]=Le,e[69]=he,e[70]=ht):ht=e[70];const mt=Vr(ht);let ft,pt;e[71]!==R||e[72]!==mt?(ft=()=>gr(X(R),{Enter:mt}),pt=[R,mt],e[71]=R,e[72]=mt,e[73]=ft,e[74]=pt):(ft=e[73],pt=e[74]),C.useEffect(ft,pt);let gt;e[75]!==a?(gt=At(a?[a.turnStatus,...a.siblingTurnStatuses]:[],ti),e[75]=a,e[76]=gt):gt=e[76];const xt=gt,Ct=!!a&&_t&&xt>0,Ot=!Ct&&(Be?!H:!0),Wt=((Ss=(As=a==null?void 0:a.siblingTurnStatuses)==null?void 0:As.length)!=null?Ss:0)>1;let vt;e[77]!==m||e[78]!==Wt||e[79]!==f?(vt=Wt&&m?f.formatMessage({id:"wham.whamComposer.followUpOnTurn",defaultMessage:"Follow-up on version {version}"},{version:m}):f.formatMessage({id:"wham.whamComposer.requestChangesOrAskAQuestion",defaultMessage:"Request changes or ask a question"}),e[77]=m,e[78]=Wt,e[79]=f,e[80]=vt):vt=e[80];const Ht=vt,$t=a==null?void 0:a.taskId,qt=a==null?void 0:a.turnId;let Oe;e[81]!==(a==null?void 0:a.followUpSuggestions)?(Oe=(js=a==null?void 0:a.followUpSuggestions)!=null?js:[],e[81]=a==null?void 0:a.followUpSuggestions,e[82]=Oe):Oe=e[82];let We;e[83]!==Z?(We=N=>{Z({runEnvironmentInQaMode:!1,promptOverride:N.body})},e[83]=Z,e[84]=We):We=e[84];let He;e[85]!==h||e[86]!==de||e[87]!==ae||e[88]!==R||e[89]!==It||e[90]!==Z||e[91]!==p||e[92]!==ot||e[93]!==a||e[94]!==Ht||e[95]!==ne||e[96]!==q||e[97]!==xt||e[98]!==f||e[99]!==g||e[100]!==dt||e[101]!==xe||e[102]!==_||e[103]!==De||e[104]!==K||e[105]!==Le||e[106]!==L||e[107]!==H||e[108]!==c||e[109]!==d||e[110]!==Rt||e[111]!==k||e[112]!==it||e[113]!==he||e[114]!==U||e[115]!==Fe||e[116]!==G||e[117]!==Ct||e[118]!==Ot||e[119]!==Pt||e[120]!==Be?(He=N=>{const{isWrappedByContainer:V}=N;return r.jsxs("div",{className:"contents",inert:It,children:[r.jsxs(Ur,{expanded:xe,canCollapseWithInput:!dt&&V,isTemporaryChat:!1,shouldUseTightRadius:V,onSubmit:()=>{dt||Z({runEnvironmentInQaMode:he.runEnvironmentInQaMode})},composerController:R,ariaLabel:h!=null?h:f.formatMessage({id:"wham.whamComposer.ariaLabel",defaultMessage:"Codex composer"}),children:[r.jsx(Kr,{children:H?r.jsx("div",{className:ie("flex max-w-full min-w-0 flex-1 items-center",g&&xe&&"min-h-30"),children:r.jsx(zr,{composerController:R,className:"h-14"})}):r.jsx(Qr,{composerController:R,disableAutoFocus:p||q,textareaMaxHeightClassName:ie(g&&xe&&"min-h-30",a?"max-h-[max(10rem,min(calc(100dvh-29rem),10rem))]":"max-h-[max(10rem,min(calc(100dvh-29rem),50dvh))]"),placeholder:a?Ht:_?f.formatMessage({id:"wham.whamComposer.describeACodingTask",defaultMessage:"Describe a task"}):f.formatMessage({id:"wham.whamComposer.describeAnotherCodingTask",defaultMessage:"Describe another task"})})}),De&&K&&k.length>0&&r.jsx(Ds,{children:r.jsx(Xr,{files:k,selectedApps:[],activeSystemHintType:void 0,disableEditButton:!0,forceSmallView:!0,className:"no-scrollbar horizontal-scroll-fade-mask flex flex-nowrap gap-2 overflow-x-auto px-2.5 pt-2.5 pb-1.5 [--edge-fade-distance:1rem]"})}),r.jsx(Yr,{children:r.jsx(Ho,{selectableTools:it,selectedTool:he,onSelectTool:v,isGitHubConnected:De,isImageUploadEnabled:K,fileInputRef:Y,onFileChange:Rt})}),ne&&r.jsx(Ds,{children:r.jsx($o,{comments:a.comments,onClearComments:c})}),!H&&r.jsx(Zr,{children:r.jsxs("div",{className:"flex gap-2",children:[!a&&r.jsx(Oo,{onCreateEnvironment:d}),ae&&De&&r.jsx(Ha,{attempts:de,setAttempts:U})]})}),r.jsxs(Jr,{children:[!G&&r.jsxs("div",{className:"flex",children:[Be&&r.jsx("div",{inert:L,children:r.jsx(ea,{composerController:R,composerType:"codex"})}),Ot&&r.jsx(Ta,{isSubmitDisabled:Le,createTask:Z,selectedTool:he,disabledReason:ot,isFollowUp:!!a}),Ct&&r.jsx(Aa,{taskId:a.taskId,hasMultipleInProgressOrStreamingTurns:xt>1})]}),G&&r.jsx(ga,{})]})]}),r.jsx(qo,{composerController:R,layoutMode:"bottom",slashCommands:Pt}),Fe&&r.jsx(Go,{})]})},e[85]=h,e[86]=de,e[87]=ae,e[88]=R,e[89]=It,e[90]=Z,e[91]=p,e[92]=ot,e[93]=a,e[94]=Ht,e[95]=ne,e[96]=q,e[97]=xt,e[98]=f,e[99]=g,e[100]=dt,e[101]=xe,e[102]=_,e[103]=De,e[104]=K,e[105]=Le,e[106]=L,e[107]=H,e[108]=c,e[109]=d,e[110]=Rt,e[111]=k,e[112]=it,e[113]=he,e[114]=U,e[115]=Fe,e[116]=G,e[117]=Ct,e[118]=Ot,e[119]=Pt,e[120]=Be,e[121]=He):He=e[121];let bt;return e[122]!==ne||e[123]!==xe||e[124]!==L||e[125]!==$t||e[126]!==qt||e[127]!==Oe||e[128]!==We||e[129]!==He?(bt=r.jsx(Yo,{taskId:$t,turnId:qt,isComposerExpanded:xe,followUpSuggestions:Oe,hasComments:ne,isSubmitting:L,onSuggestionClick:We,children:He}),e[122]=ne,e[123]=xe,e[124]=L,e[125]=$t,e[126]=qt,e[127]=Oe,e[128]=We,e[129]=He,e[130]=bt):bt=e[130],bt}function ti(t){return t==="pending"||t==="in_progress"?1:0}function si(t){return t.key!=="code"&&t.available}function ni(t){return[t.key,t]}function ri(t){const e=t.fileSpec;return e&&"width"in e&&"height"in e&&t.fileId?[{type:"image_asset_pointer",asset_pointer:xr(t.fileId),width:e.width,height:e.height,size_bytes:e.size}]:[]}function ai(t){var e;return((e=t.getRateLimit())==null?void 0:e.remaining)===0}function oi(t){return t.setBestOfN}function ii(t){return t.files}function ci(t){return t.setHasSubmittedTaskInSession}function li(t){const{addTurnToTaskMap:e}=t;return e}const Ks=ls({rateLimit:{id:"wham.whamComposer.failedToCreateTaskRateLimit",defaultMessage:"Codex is busy right now. Please try again later."}});export{cn as S,bi as W,Nt as a,Ba as b,Mn as c,vi as d,dn as g,At as s,wa as u};
//# sourceMappingURL=jx9lof8tzg97x4l9.js.map
