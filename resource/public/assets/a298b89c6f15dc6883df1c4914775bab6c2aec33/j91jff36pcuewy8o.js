var X=Object.freeze,$=Object.defineProperty,Se=Object.defineProperties;var Ce=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var W=(e,t,o)=>t in e?$(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,p=(e,t)=>{for(var o in t||(t={}))q.call(t,o)&&W(e,o,t[o]);if(O)for(var o of O(t))Z.call(t,o)&&W(e,o,t[o]);return e},b=(e,t)=>Se(e,Ce(t));var E=(e,t)=>{var o={};for(var r in e)q.call(e,r)&&t.indexOf(r)<0&&(o[r]=e[r]);if(e!=null&&O)for(var r of O(e))t.indexOf(r)<0&&Z.call(e,r)&&(o[r]=e[r]);return o};var z=(e,t)=>X($(e,"raw",{value:X(t||e.slice())}));import{r as l,j as a,b as oe,m as I,A as Ne}from"./n75kuy1cx6f5mogg.js";import{o5 as re,am as we,an as je,jx as _e,o6 as ke,jv as Ae,jw as Ie,nA as B,nB as Re,eL as Pe,bs as Le,o7 as Me}from"./ny10lj7zpuz89fvf.js";import{S as Oe,C as se,e as G,d as Be}from"./iqk1tse6yz14y9t9.js";import{T as ae,Z as D}from"./ce3hgmw4iyyhicud.js";import{dj as K,dm as ne,dp as Ge,dl as De,dq as Ke,dn as ie,dk as Ve,e as y,F as le,cq as ze,i as Fe,O as Ue,mi as He,bU as Xe,x as We}from"./ewse8exzafeu10ji.js";import{S as $e}from"./e79nci3z6bwkg1aw.js";import{u as ce}from"./j2tluvxda4ll72qx.js";import{u as qe,i as ue,a as Ze}from"./d0p97pwfptqt3nvy.js";import{i as Je}from"./hkwix64yhkotslv1.js";import{E as F,a as Ye}from"./ctddpbsbr3gj60l1.js";var Qe="Separator",J="horizontal",et=["horizontal","vertical"],de=l.forwardRef((e,t)=>{const u=e,{decorative:o,orientation:r=J}=u,s=E(u,["decorative","orientation"]),n=tt(r)?r:J,f=o?{role:"none"}:{"aria-orientation":n==="vertical"?n:void 0,role:"separator"};return a.jsx(K.div,b(p(p({"data-orientation":n},f),s),{ref:t}))});de.displayName=Qe;function tt(e){return et.includes(e)}var ot=de,U="Toolbar",[rt]=De(U,[ne,re]),H=ne(),pe=re(),[st,fe]=rt(U),me=l.forwardRef((e,t)=>{const d=e,{__scopeToolbar:o,orientation:r="horizontal",dir:s,loop:n=!0}=d,i=E(d,["__scopeToolbar","orientation","dir","loop"]),f=H(o),u=Ge(s);return a.jsx(st,{scope:o,orientation:r,dir:u,children:a.jsx(Ke,b(p({asChild:!0},f),{orientation:r,dir:u,loop:n,children:a.jsx(K.div,b(p({role:"toolbar","aria-orientation":r,dir:u},i),{ref:t}))}))})});me.displayName=U;var xe="ToolbarSeparator",he=l.forwardRef((e,t)=>{const n=e,{__scopeToolbar:o}=n,r=E(n,["__scopeToolbar"]),s=fe(xe,o);return a.jsx(ot,b(p({orientation:s.orientation==="horizontal"?"vertical":"horizontal"},r),{ref:t}))});he.displayName=xe;var at="ToolbarButton",V=l.forwardRef((e,t)=>{const n=e,{__scopeToolbar:o}=n,r=E(n,["__scopeToolbar"]),s=H(o);return a.jsx(ie,b(p({asChild:!0},s),{focusable:!e.disabled,children:a.jsx(K.button,b(p({type:"button"},r),{ref:t}))}))});V.displayName=at;var nt="ToolbarLink",it=l.forwardRef((e,t)=>{const n=e,{__scopeToolbar:o}=n,r=E(n,["__scopeToolbar"]),s=H(o);return a.jsx(ie,b(p({asChild:!0},s),{focusable:!0,children:a.jsx(K.a,b(p({},r),{ref:t,onKeyDown:Ve(e.onKeyDown,i=>{i.key===" "&&i.currentTarget.click()})}))}))});it.displayName=nt;var be="ToolbarToggleGroup",lt=l.forwardRef((e,t)=>{const i=e,{__scopeToolbar:o}=i,r=E(i,["__scopeToolbar"]),s=fe(be,o),n=pe(o);return a.jsx(we,b(p(p({"data-orientation":s.orientation,dir:s.dir},n),r),{ref:t,rovingFocus:!1}))});lt.displayName=be;var ct="ToolbarToggleItem",ut=l.forwardRef((e,t)=>{const i=e,{__scopeToolbar:o}=i,r=E(i,["__scopeToolbar"]),s=pe(o),n={__scopeToolbar:e.__scopeToolbar};return a.jsx(V,b(p({asChild:!0},n),{children:a.jsx(je,b(p(p({},s),r),{ref:t}))}))});ut.displayName=ct;var dt=me,pt=he,ft=(e=>(e.CODE="code",e.WRITING="writing",e))(ft||{});const A=({children:e,toolbarType:t})=>a.jsx(dt,{className:y("bg-token-main-surface-primary m-0 flex h-9 w-fit min-w-0 shrink items-center overflow-hidden rounded-xl px-1 dark:bg-[#353535]",ae,t==="code"?"py-0":"py-1"),children:e}),Te=({icon:e,hideLabel:t,label:o})=>a.jsxs(a.Fragment,{children:[a.jsx(e,{className:y("icon-sm",{"text-token-text-tertiary me-0.5":!t,"text-token-text-primary":t})}),!t&&a.jsx("span",{className:"text-token-text-primary truncate text-sm",children:o})]});var ee;const ge=le(V)(ee||(ee=z(["flex h-full items-center rounded-lg gap-1 px-2 hover:bg-black/5 dark:hover:bg-token-interactive-bg-secondary-hover disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-transparent"]))),mt=({label:e,icon:t,isDisabled:o=!1,hideLabel:r=!1,onClick:s,onMouseDown:n})=>a.jsx(ge,{onClick:s,"aria-label":r?e:void 0,onMouseDown:n,disabled:o,children:a.jsx(Te,{icon:t,hideLabel:r,label:e})}),xt=({icon:e,hideLabel:t,label:o,children:r,align:s="end"})=>a.jsxs(_e,{children:[a.jsx(ke,{asChild:!0,children:a.jsx(ge,{"aria-label":t?o:void 0,children:a.jsx(Te,{icon:e,hideLabel:t,label:o})})}),a.jsx(Ae,{children:a.jsx(Ie,{align:s,className:y(D.toolbar,"popover"),sideOffset:8,children:r})})]});var te;A.Separator=le(pt)(te||(te=z(["mx-1 p-0 list-none h-3 w-[1px] bg-token-border-default"])));A.Action=mt;A.Button=V;A.Popover=xt;function ve(e){const t=e();if(t==null)return;const{from:o,to:r,sourceFrom:s,sourceTo:n}=t;if(o==null||r==null||s==null||n==null){B.logError("Missing selection range on targeted edit",t);return}const i=Oe.ASK;B.logButtonClick(Re.TOOLBAR_ASK_CHATGPT,{action:i,sourceFrom:s,sourceTo:n}),se.startCommentingOn({type:G.SELECTION,from:o,to:r,sourceRange:{start:s,end:n},action:i})}function ht(e,t,o){l.useEffect(()=>{if(o)return;const r=s=>{(s.metaKey||s.ctrlKey)&&s.key.toLowerCase()==="k"&&(s.preventDefault(),ve(t))};return e==null||e.addEventListener("keydown",r),()=>e==null?void 0:e.removeEventListener("keydown",r)},[e,t,o])}var Ee=(e=>(e.ABOVE="above",e.BELOW="below",e))(Ee||{});function Y(e,t){return ze(e.coordsAtPos(t))}const Q=360,bt=250,ye=44,Tt=.5,gt=[.5,.9,1],vt=[1,.75,.2],Et=({onClose:e,onSubmit:t,opensOverDocument:o=!1,opensFromGutter:r=!1,gutterHasComments:s=!1},n)=>{const i=Fe(),f=oe(),u=l.useRef(null),d=l.useRef(!1),[x,h]=l.useState(""),[T,S]=l.useState(!0),j=()=>{document.hasFocus()&&(h(""),e==null||e(d.current))},_=(m,v=x)=>{d.current=!0,t==null||t(m,v),h("")},R=Ue(()=>o?Pe(i).width<Q+100?bt:Q:F),k={};r&&(k.top=-12),o&&r?k.right=0:k.left=0;let C="";r&&!o?C="8px 50%":r&&o?C="calc(100% + 8px) 50%":o&&(C="center left");let g=0;r&&!o&&s&&(g=Ye);const P=m=>{const{metaKey:v,shiftKey:L,key:M}=m;M==="Enter"&&!m.nativeEvent.isComposing&&x&&!(L||v)?(_(m),m.preventDefault()):M==="Escape"&&(h(""),e==null||e(!1))},N=f.formatMessage({id:"VvfbvY",defaultMessage:"Edit or explain..."});return a.jsx(I.div,{ref:Le(u,n),className:y("absolute flex items-center",D.commentComposer),style:b(p({},k),{minHeight:ye}),transition:{type:"spring",bounce:.18,duration:.48},initial:{translateX:0},animate:{translateX:g},exit:{translateX:0},children:a.jsx(I.div,{className:y("no-scrollbar border-token-border-default relative z-10 flex items-center overflow-x-hidden border",ae,{"rounded-full":T,"rounded-2xl":!T}),initial:{width:o?F:24,scale:o?void 0:Tt},animate:{width:R,scale:o?void 0:gt},exit:{filter:"blur(16px)",scale:o?void 0:vt,width:o?F:24,opacity:o?0:[1,1,0]},transition:{type:"spring",bounce:o?.14:0,duration:.28,scale:{type:"tween",duration:.2},opacity:{type:"tween",time:[0,.95,1]}},style:{transformOrigin:C},children:a.jsxs(I.div,{className:"bg-token-main-surface-primary relative z-0 flex w-full items-center px-4 py-2.5",children:[a.jsx(I.div,{className:"absolute inset-0 z-[-1] bg-gray-50/75 backdrop-blur-3xl backdrop-saturate-25 dark:bg-gray-700/75",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.2}}),a.jsx(Je,{"aria-placeholder":N,value:x,className:"text-token-text-primary placeholder:text-token-text-secondary w-full resize-none border-0 bg-transparent px-1 py-0 pe-2 outline-0 focus:ring-0 focus-visible:ring-0",autoFocus:!0,maxRows:4,onBlur:j,onHeightChange:(m,{rowHeight:v})=>{S(Math.floor(m/v)<=1)},onChange:({target:{value:m}})=>h(m),onKeyDown:P}),!x&&a.jsx("span",{"aria-hidden":!0,className:"text-token-text-secondary absolute inline-block ps-1 text-nowrap",children:N}),a.jsx(I.button,{className:y("-me-1.5 h-6 w-6 rounded-full bg-black text-center dark:bg-white",{"self-end":!T}),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.1},onMouseDown:m=>_(m),children:a.jsx(Me,{className:"h-6 w-6 text-white dark:text-black"})})]})})})},yt=l.forwardRef(Et),Bt=(e,t)=>{if((t==null?void 0:t.type)!==G.SELECTION)return null;try{const{from:o,to:r}=t,{top:s}=e.dom.getBoundingClientRect(),{bottom:n,top:i}=Y(e,o),{bottom:f}=Y(e,r),u=ue(e)?-30:-24;let d=n-s+u;const x=i-s;return d=f-s+8,{composerTop:d,loadingTop:x}}catch(o){return B.logError("Invalid position in SelectionCommentComposer",o),null}},St=({toolbarPosition:e,composerRect:t,view:o})=>{const{width:r}=t;let{height:s}=t;if(s||(s=ye),o==null||e==null)return null;const{right:n,left:i}=o.dom.getBoundingClientRect(),{left:f,top:u,aboveOrBelow:d,toolbarSize:x}=e,h=u-(d===Ee.ABOVE&&s!==0?s-x.height:0),T=Ze(o)?12:0;return{left:Math.min(f,n-i-r-T),composerTop:h,aboveOrBelow:d}},Ct=({toolbarPosition:e,commentingOn:t,isWaitingForCommentResponse:o=!1,onAddComment:r})=>{const s=qe()(),[n,i]=ce(),f=St({view:s,toolbarPosition:e,composerRect:n});if(s==null||f==null)return null;const{left:u,composerTop:d}=f,x=(h,T)=>{if((t==null?void 0:t.type)!==G.SELECTION)return;const{action:S,sourceRange:j}=t;r==null||r(h,T,S,j,t.type)};return a.jsx(Ne,{children:(t==null?void 0:t.type)===G.SELECTION&&!o&&a.jsx("div",{className:y("absolute",D.commentComposer),style:{left:u,top:d},children:a.jsx(yt,{opensOverDocument:!0,onClose:h=>{var T;h||(se.cancelCommentingOn(),s&&ue(s)&&!s.state.selection.empty&&s.dispatch(s.state.tr.setSelection(new He(s.state.selection.$from))),(T=document.getSelection())==null||T.removeAllRanges())},onSubmit:x,ref:i})},"composer")})},Nt=({isSendDisabled:e=!1,getSelectionRange:t})=>{const o=oe(),r=()=>{ve(t)};return a.jsx(A.Action,{isDisabled:e,label:o.formatMessage({id:"wOaJUU",defaultMessage:"Ask ChatGPT"}),onClick:r,icon:$e})},Gt=({getEditorDom:e,getToolbarPosition:t,getSelectionRange:o,toolbarType:r,children:s,onAddComment:n,isWaitingForCommentResponse:i=!1,isSendDisabled:f=!1,showAskChatGPT:u=!0,fixToolbarPositionOnInteraction:d=!1})=>{const[{height:x,width:h},T]=ce(),[S,j]=l.useState(!0),[_,R]=l.useState(!1),[k,C]=l.useState(!0),g=e(),P=Be(({commentingOn:c})=>c),[N,m]=l.useState(null);ht(g,o,f);const v=l.useCallback(()=>{const c=e(),w=document.getSelection();return!w||w.type!=="Range"||w.isCollapsed||!(c!=null&&c.contains(w.anchorNode))},[e]);l.useEffect(()=>{const c=Xe(()=>{R(!0)},200,{leading:!0}),w=()=>{c.cancel(),R(!1)};return g==null||g.addEventListener("pointerdown",c,{passive:!0}),document.addEventListener("pointerup",w,{passive:!0}),()=>{g==null||g.removeEventListener("pointerdown",c),document.removeEventListener("pointerup",w)}},[g]),l.useEffect(()=>{if(_){C(!1);return}const c=setTimeout(()=>C(!0),100);return()=>{clearTimeout(c)}},[_]),l.useEffect(()=>{const c=()=>{j(v())};return document.addEventListener("selectionchange",c,{passive:!0}),()=>{document.removeEventListener("selectionchange",c)}},[v]),We(()=>{if(S||v())return j(!0);try{const c=t({width:h,height:x});c!=null&&!d&&m(c)}catch(c){B.logError("Invalid position in getToolbarPosition",c)}},[x,h,S,v,t,d]);const L=a.jsxs(A,{toolbarType:r,children:[u&&a.jsx(Nt,{isSendDisabled:f,getSelectionRange:o}),s]}),M=!S&&!P&&N!=null&&k;return a.jsxs(a.Fragment,{children:[a.jsx("div",{"aria-hidden":"true",className:"pointer-events-none invisible fixed start-0 top-0 h-0 overflow-clip",children:a.jsx("div",{ref:T,children:L})}),M&&a.jsx("div",{style:{top:N.top,left:N.left},className:y("absolute",D.toolbar,_?"pointer-events-none":"pointer-events-auto"),children:L}),a.jsx(Ct,{toolbarPosition:N,commentingOn:P,isWaitingForCommentResponse:i,onAddComment:n})]})};export{Ee as A,yt as C,Gt as T,ft as a,A as b,Y as c,Bt as g};
//# sourceMappingURL=j91jff36pcuewy8o.js.map
