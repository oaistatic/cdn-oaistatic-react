import{b as E,u as ee,g as L,a as $,j as e,M as i,ae,al as te,r as W,t as se,D as ne}from"./n75kuy1cx6f5mogg.js";import{f as z,C as V,aF as v,e as ie,pk as re,b as oe,dv as le,i as de,j as f,E as me,T as b,B as p,kY as ce}from"./ewse8exzafeu10ji.js";import{e3 as ue,E as ge}from"./ny10lj7zpuz89fvf.js";import{W as he}from"./lg0bckqp15rzbs79.js";import{n as x,W as q,r as fe,i as pe,d as xe,c as ve}from"./fmsmhem5hrm2cxrs.js";import{R as Me,I,S as we}from"./hpgwyyfk56jk6sof.js";import{u as je}from"./lnzbeiiwuqqbz3sb.js";import{E as be}from"./86mj08lztju50cwk.js";import{P as Ee,a as De}from"./lptwpbjabrvjmhsj.js";import"./chdemz4xlfbm1987.js";import"./kj8rd4pu8k32z2dy.js";import"./d65yyyom1modmtdi.js";import"./fh2tsu8ocsi22jc3.js";import"./nyfr63odztw7y2ja.js";import"./heyok871zyju5auh.js";import"./ltsv6em2m484o9yy.js";import"./kas18igmwglc2mb4.js";import"./e0y2s8usszg014s2.js";import"./jocaiq9wugboh64i.js";import"./2o5l1tfalaiecrv0.js";function Pe({environmentId:s,onClose:a}){const n=E(),o=z(),l=ee(),m=L(),g=x(c=>c.setEnvironmentId),M=x(c=>c.setBranch),{mutate:t,isPending:w}=$({mutationFn:()=>q.deleteEnvironment(s),onSuccess:async()=>{fe(l,s),await pe(l),x.getState().environmentId===s&&(g(null),M(null)),o.success(n.formatMessage({id:"wham.deleteEnvironmentModal.environmentDeletedSuccessfully",defaultMessage:"Environment deleted successfully"})),a(),m("/codex/settings/environments")},onError:()=>{o.danger(n.formatMessage({id:"wham.deleteEnvironmentModal.failedToDeleteEnvironment",defaultMessage:"Failed to delete environment"}))}});return e.jsx(V,{testId:"modal-wham-delete-environment",isOpen:!0,type:"danger",title:e.jsx(i,{id:"wham.deleteEnvironmentModal.title",defaultMessage:"Delete environment"}),onClose:a,primaryButton:e.jsx(v.Button,{title:n.formatMessage({id:"wham.deleteEnvironmentModal.delete",defaultMessage:"Delete"}),color:"danger",loading:w,onClick:()=>{t()}}),secondaryButton:e.jsx(v.Button,{title:n.formatMessage({id:"wham.deleteEnvironmentModal.cancel",defaultMessage:"Cancel"}),color:"secondary",onClick:a}),children:e.jsx("div",{className:"text-sm",children:e.jsx(i,{id:"wham.deleteEnvironmentModal.message",defaultMessage:"Tasks that use it will remain, but users wonâ€™t be able to create follow-up tasks."})})})}function r({label:s,children:a,className:n}){return e.jsxs("div",{className:ie("flex flex-col gap-1",n),children:[e.jsx("dt",{className:"text-token-text-primary text-sm font-medium",children:s}),e.jsx("dd",{className:"text-token-text-primary text-sm font-normal",children:a})]})}function _e({environmentId:s,onClose:a}){const n=E(),o=z(),{mutate:l,isPending:m}=$({mutationFn:()=>q.invalidateEnvironmentCache(s),onSuccess:()=>{o.success(n.formatMessage({id:"wham.resetCacheModal.cacheResetSuccessfully",defaultMessage:"Cache reset successfully"})),a()},onError:()=>{o.danger(n.formatMessage({id:"wham.resetCacheModal.failedToResetCache",defaultMessage:"Failed to reset cache"}))}});return e.jsx(V,{testId:"modal-wham-delete-environment",isOpen:!0,type:"danger",title:e.jsx(i,{id:"wham.resetEnvironmentCacheModal.title",defaultMessage:"Reset cache"}),onClose:a,primaryButton:e.jsx(v.Button,{title:n.formatMessage({id:"wham.resetEnvironmentCacheModal.delete",defaultMessage:"Reset"}),color:"danger",loading:m,onClick:()=>{l()}}),secondaryButton:e.jsx(v.Button,{title:n.formatMessage({id:"wham.resetEnvironmentCacheModal.cancel",defaultMessage:"Cancel"}),color:"secondary",onClick:a}),children:e.jsx("div",{className:"text-sm",children:e.jsx(i,{id:"wham.resetEnvironmentCacheModal.message",defaultMessage:"All currently cached containers will be invalidated. The cache will be cleared for all users."})})})}function Ne(){const{environmentId:s}=ae(),{eligible:a}=ue();return a?e.jsx(te,{to:"/codex"}):s?e.jsx(ke,{environmentId:s}):e.jsx(re,{})}function ye(s){return s==null||s.setup==null?!1:Array.isArray(s.setup)?s.setup.length>0&&s.setup.every(a=>a!==""):s.setup!==""}function Se(s,a,n){var o,l;return s?!!((l=(o=s.permissions)==null?void 0:o.can_write)!=null&&l||n!=null&&n.isAdminOfAccount()||(a==null?void 0:a.email)===s.creator.email):!1}function Ce(s,a,n){var o,l;return s?!!((l=(o=s==null?void 0:s.permissions)==null?void 0:o.can_delete)!=null&&l||n!=null&&n.isAdminOfAccount()||(a==null?void 0:a.email)===s.creator.email):!1}function ke({environmentId:s}){var N,y,S,C,k,A,O,B,R,T;const a=E(),n=L(),[o,l]=W.useState(!1),[m,g]=W.useState(!1),M=x(d=>d.setEnvironmentId),{data:t,isLoading:w,isError:c}=xe(s),D=oe(),u=le(),h=de(),P=Se(t,D,u),_=Ce(t,D,u),U=je(),j=u==null?void 0:u.name,X=j!=null?j:a.formatMessage({id:"wham.environmentDetailsPage.workspace",defaultMessage:"Workspace"}),G=f(h,"2134057841"),H=f(h,"1535847699"),Q=f(h,"3899518838"),Y=f(h,"838019241"),Z=!ye(t)&&(t==null?void 0:t.auto_setup_settings)==null,J=(y=(N=t==null?void 0:t.auto_setup_settings)==null?void 0:N.use_auto_setup)!=null?y:Z;return e.jsxs(he,{topPadding:!0,showSidebar:!1,children:[e.jsx("div",{className:"flex flex-col px-8 md:px-16",children:w?e.jsx("div",{className:"flex h-full items-center justify-center",children:e.jsx(me,{})}):c?e.jsx(be,{title:a.formatMessage({id:"wham.environmentDetailsPage.errorLoadingEnvironment",defaultMessage:"Error loading environment"}),description:a.formatMessage({id:"wham.environmentDetailsPage.errorLoadingEnvironmentDescription",defaultMessage:"Error loading environment description"})}):t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-token-border-default flex flex-col justify-between gap-2 border-b pb-4",children:e.jsxs("div",{className:"flex flex-row items-center justify-between",children:[e.jsxs(Me,{children:[e.jsx(I,{label:a.formatMessage({id:"wham.environmentDetailsPage.environments",defaultMessage:"Environments"}),url:"/codex/settings/environments",className:"text-token-text-tertiary"}),e.jsx(we,{}),e.jsx(I,{label:t.label,url:"/codex/settings/environment/".concat(s),className:"text-token-text-primary font-medium"})]}),e.jsxs("div",{className:"flex flex-row gap-2",children:[e.jsx(b,{label:_?void 0:a.formatMessage({id:"wham.environmentDetailsPage.deleteEnvironmentTooltip",defaultMessage:"Only creators or editors of the environment, or an admin, can delete an environment"}),children:e.jsx(p,{color:"danger-outline",onClick:()=>l(!0),disabled:!_,"aria-label":a.formatMessage({id:"wham.environmentDetailsPage.deleteEnvironmentAriaLabel",defaultMessage:"Button to delete {environmentName}"},{environmentName:t.label}),children:e.jsx(i,{id:"wham.environmentDetailsPage.deleteEnvironment",defaultMessage:"Delete"})})}),e.jsx(b,{label:P?void 0:a.formatMessage({id:"wham.environmentDetailsPage.editEnvironmentTooltip",defaultMessage:"Only creators or editors of the environment, or an admin, can edit an environment"}),children:e.jsx(p,{icon:ge,onClick:()=>{n("/codex/settings/environment/".concat(s,"/edit"))},color:"secondary",disabled:!P,"aria-label":a.formatMessage({id:"wham.environmentDetailsPage.editEnvironmentAriaLabel",defaultMessage:"Button to edit {environmentName}"},{environmentName:t.label}),children:e.jsx(i,{id:"wham.environmentDetailsPage.editEnvironment",defaultMessage:"Edit"})})}),e.jsx(p,{size:"small",color:"secondary",onClick:()=>{M(s),ve.recordClickEnv(),n("/codex")},"aria-label":a.formatMessage({id:"wham.environmentDetailsPage.useEnvironmentAriaLabel",defaultMessage:"Button to use environment {environmentName} in a codex task"},{environmentName:t.label}),children:e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx(i,{id:"wham.turnInfoRow.useEnvironment",defaultMessage:"Use this"}),e.jsx(ce,{className:"icon-sm"})]})})]})]})}),e.jsx("div",{className:"text-token-text-primary py-8 text-xl",children:t.label}),e.jsxs("div",{className:"grid gap-x-12 gap-y-6 md:grid-cols-2",children:[e.jsx(r,{label:a.formatMessage({id:"wham.environmentDetailsPage.creator",defaultMessage:"Creator"}),children:t.creator.email}),e.jsx(r,{label:a.formatMessage({id:"wham.environmentDetailsPage.image",defaultMessage:"Image"}),children:t.machine.label||e.jsx(i,{id:"wham.environmentDetailsPage.noImage",defaultMessage:"No image"})}),e.jsx(r,{label:a.formatMessage({id:"wham.environmentDetailsPage.description",defaultMessage:"Description"}),children:(S=t.description)!=null?S:e.jsx(i,{id:"wham.environmentDetailsPage.noDescription",defaultMessage:"N/A"})}),G&&e.jsx(r,{label:a.formatMessage({id:"wham.environmentDetailsPage.agentNetworkAccess",defaultMessage:"Agent internet access"}),children:((C=t.agent_network_access)==null?void 0:C.mode)==="on"?t.agent_network_access.preset_allowlist===Ee?e.jsx(i,{id:"wham.environmentDetailsPage.agentNetworkAccess.unrestricted",defaultMessage:"On: unrestricted"}):t.agent_network_access.preset_allowlist===De?e.jsx(i,{id:"wham.environmentDetailsPage.agentNetworkAccess.codex",defaultMessage:"On: common dependencies"}):e.jsx(i,{id:"wham.environmentDetailsPage.agentNetworkAccess.custom",defaultMessage:"On: custom domains"}):t.agent_network_access==null||t.agent_network_access.mode==="off"?e.jsx(i,{id:"wham.environmentDetailsPage.agentNetworkAccess.off",defaultMessage:"Off"}):null}),Q&&e.jsxs(e.Fragment,{children:[e.jsx(r,{label:a.formatMessage({id:"wham.environmentDetailsPage.postSetupCaching",defaultMessage:"Post setup caching"}),children:e.jsxs("div",{className:"flex items-center gap-2",children:[((k=t.cache_settings)==null?void 0:k.post_setup_cache_enabled)===!0?e.jsx(i,{id:"wham.environmentDetailsPage.postSetupCaching.on",defaultMessage:"On"}):e.jsx(i,{id:"wham.environmentDetailsPage.postSetupCaching.off",defaultMessage:"Off"}),((A=t.cache_settings)==null?void 0:A.post_setup_cache_enabled)&&e.jsx(b,{label:a.formatMessage({id:"wham.environmentDetailsPage.resetCacheTooltip",defaultMessage:"Invalidate any currently cached containers"}),children:e.jsx(p,{size:"small",onClick:()=>g(!0),color:"secondary","aria-label":a.formatMessage({id:"wham.environmentDetailsPage.resetCacheAriaLabel",defaultMessage:"Button to invalidate cache for {environmentName}"},{environmentName:t.label}),children:e.jsx(i,{id:"wham.environmentDetailsPage.resetCache",defaultMessage:"Reset cache"})})})]})}),((O=t.cache_settings)==null?void 0:O.post_setup_cache_enabled)&&e.jsx(r,{label:a.formatMessage({id:"wham.environmentDetailsPage.maintenanceSetupScript",defaultMessage:"Maintenance setup script"}),children:e.jsx("pre",{className:"mono text-xs leading-5 break-all whitespace-pre-wrap",children:(Array.isArray(t.maintenance_setup)?t.maintenance_setup:[t.maintenance_setup]).filter(Boolean).join("\n")})})]}),e.jsx(r,{label:a.formatMessage({id:"wham.environmentDetailsPage.environmentVariables",defaultMessage:"Environment variables"}),children:e.jsx("pre",{className:"mono text-xs leading-5 break-all whitespace-pre-wrap",children:Object.keys((B=t.env_vars)!=null?B:{}).filter(d=>!d.startsWith("CODEX_ENV_")).join("\n")})}),e.jsx(r,{label:a.formatMessage({id:"wham.environmentDetailsPage.secrets",defaultMessage:"Secrets"}),children:e.jsx("pre",{className:"mono text-xs leading-5 break-all whitespace-pre-wrap",children:Object.keys((R=t.secrets)!=null?R:{}).join("\n")})}),e.jsx(r,{label:a.formatMessage({id:"wham.environmentDetailsPage.createdAt",defaultMessage:"Created at"}),children:t.created_at?e.jsx(se,{value:new Date(t.created_at*1e3),year:"numeric",month:"long",day:"numeric"}):e.jsx(i,{id:"wham.environmentDetailsPage.noCreationDate",defaultMessage:"No creation date"})}),e.jsx(r,{label:a.formatMessage({id:"wham.environmentDetailsPage.setupScript",defaultMessage:"Setup script"}),children:H&&J?e.jsx(i,{id:"wham.environmentDetailsPage.autoSetup.automatic",defaultMessage:"Automatic"}):e.jsx("pre",{className:"mono text-xs leading-5 break-all whitespace-pre-wrap",children:(Array.isArray(t.setup)?t.setup:[t.setup]).filter(Boolean).join("\n")})}),e.jsx(r,{label:a.formatMessage({id:"wham.environmentDetailsPage.repository",defaultMessage:"Repository"}),children:t.repo_map?Object.values(t.repo_map).map(d=>d.repository_full_name):e.jsx(i,{id:"wham.environmentDetailsPage.noRepository",defaultMessage:"No repository"})}),e.jsx(r,{label:a.formatMessage({id:"wham.environmentDetailsPage.numTasks",defaultMessage:"No. of tasks"}),children:(T=t.task_count)!=null?T:0}),U&&e.jsxs(e.Fragment,{children:[e.jsx(r,{label:a.formatMessage({id:"94ZVks",defaultMessage:"Share"}),children:t.share_settings==="workspace"?a.formatMessage({id:"wham.environmentDetailsPage.sharedWithWorkspace",defaultMessage:"Shared with {workspaceName}"},{workspaceName:X}):a.formatMessage({id:"wham.environmentDetailsPage.private",defaultMessage:"Private"})}),Y&&e.jsx(r,{label:a.formatMessage({id:"wham.environmentDetailsPage.shareTargets",defaultMessage:"Additional editors"}),children:t.share_targets&&t.share_targets.length>0?e.jsx("div",{className:"flex flex-col gap-1",children:t.share_targets.map((d,K)=>{var F;return e.jsx("span",{children:d.email},"".concat((F=d.type)!=null?F:"user","-").concat(d.email,"-").concat(K))})}):e.jsx(i,{id:"wham.environmentDetailsPage.shareTargetsNone",defaultMessage:"None"})})]})]})]}):e.jsx("div",{className:"flex h-full items-center justify-center",children:e.jsx(i,{id:"wham.environmentDetailsPage.environmentNotFound",defaultMessage:"Environment not found"})})}),o&&e.jsx(Pe,{environmentId:s,onClose:()=>l(!1)}),m&&e.jsx(_e,{environmentId:s,onClose:()=>g(!1)})]})}const Je=()=>[{title:"Codex"}],Ke=ne(function(){return e.jsx(Ne,{})});export{Ke as default,Je as meta};
//# sourceMappingURL=kzm3mvsmo517fbg8.js.map
