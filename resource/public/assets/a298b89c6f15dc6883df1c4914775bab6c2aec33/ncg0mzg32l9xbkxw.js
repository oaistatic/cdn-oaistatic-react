import{ae as R,j as s,al as T,b as U,g as D,u as B,a as E,M as v,D as I}from"./n75kuy1cx6f5mogg.js";import{pk as O,f as L,E as $}from"./ewse8exzafeu10ji.js";import{e3 as q}from"./ny10lj7zpuz89fvf.js";import{W as z}from"./lg0bckqp15rzbs79.js";import{R as Q,I as c,S as b}from"./hpgwyyfk56jk6sof.js";import{E as G,R as H,g as J}from"./bgla8yd7qfc7pjai.js";import{u as K}from"./lnzbeiiwuqqbz3sb.js";import{d as X,W as Y,a as Z,f as V}from"./fmsmhem5hrm2cxrs.js";import"./chdemz4xlfbm1987.js";import"./kj8rd4pu8k32z2dy.js";import"./d65yyyom1modmtdi.js";import"./fh2tsu8ocsi22jc3.js";import"./nyfr63odztw7y2ja.js";import"./heyok871zyju5auh.js";import"./ltsv6em2m484o9yy.js";import"./kas18igmwglc2mb4.js";import"./e0y2s8usszg014s2.js";import"./b2v4rtnrgumnnrka.js";import"./l7az6eau39sfbc3y.js";import"./kvd65smf2xr8kpw2.js";import"./lptwpbjabrvjmhsj.js";import"./2o5l1tfalaiecrv0.js";import"./mniabc4p4y2oz5g2.js";import"./jhe3wdj1wdglvpku.js";import"./dsuqrew0l7dkq40v.js";import"./j2tluvxda4ll72qx.js";import"./dbz6g0t5bht84999.js";import"./jocaiq9wugboh64i.js";function ee(){const{environmentId:a}=R(),{eligible:r}=q();return r?s.jsx(T,{to:"/codex"}):a?s.jsx(te,{environmentId:a}):s.jsx(O,{})}function te({environmentId:a}){var u,l,h,_,f,g,S;const r=U(),d=L(),M=D(),m=B(),{data:e,isLoading:k,isError:C}=X(a),p=(u=e==null?void 0:e.secrets)!=null?u:{},N=K()?"workspace":"private",{mutate:x,isPending:A}=E({mutationFn:t=>Y.updateEnvironment(a,t),onSuccess:async t=>{await Z(m,a),V(m,a,t),d.success(r.formatMessage({id:"wham.editEnvironment.environmentUpdatedSuccessfully",defaultMessage:"Environment updated successfully"})),M("/codex/settings/environment/".concat(a))},onError:()=>{d.danger({id:"wham.editEnvironment.failedToUpdateEnvironment",defaultMessage:"Failed to update environment",description:"Toast to show when an environment is updated unsuccessfully"},{toastId:"wham_edit_environment_failed_to_update_environment"})}});function F(t){var j,w;const n=J(t.secrets,p),W=t.envVars.reduce((o,y)=>(o[y.key]=y.value,o),{}),i=(w=(j=t.share_targets)==null?void 0:j.map(o=>o.trim()))==null?void 0:w.filter(Boolean),P=t.share_settings==="private"?[]:i==null?void 0:i.map(o=>({email:o,permission:"editor",type:"user"}));x({etag:e==null?void 0:e.etag,label:t.label,repos:[t.repositoryId],machine_id:t.machine,setup:t.setupCommands,maintenance_setup:t.maintenanceSetupCommands,workspace_dir:t.workspaceDirectory,agent_network_access:t.agentNetworkAccess,description:t.description,share_settings:t.share_settings,share_targets:P,secrets:n,env_vars:W,auto_setup_settings:t.autoSetupSettings,cache_settings:t.cacheSettings})}return s.jsx(z,{flex:!0,hideBorder:!0,showSidebar:!1,maxWidth:"w-full",children:k?s.jsx("div",{className:"flex h-full items-center justify-center",children:s.jsx($,{})}):C?s.jsx("div",{className:"flex h-full items-center justify-center",children:s.jsx(v,{id:"wham.editEnvironment.errorLoadingEnvironment",defaultMessage:"Error loading environment"})}):e?s.jsxs(s.Fragment,{children:[s.jsxs(Q,{className:"sticky top-0 px-4",children:[s.jsx(c,{label:r.formatMessage({id:"wham.editEnvironment.environments",defaultMessage:"Environments"}),url:"/codex/settings/environments",className:"text-token-text-tertiary"}),s.jsx(b,{}),s.jsx(c,{label:e.label,url:"/codex/settings/environment/".concat(a),className:"font-medium"}),s.jsx(b,{}),s.jsx(c,{label:r.formatMessage({id:"wham.editEnvironment.edit",defaultMessage:"edit"}),className:"text-token-text-tertiary"})]}),s.jsx(G,{initialEnvironmentId:a,existingEnvironment:e,initialValues:{label:e==null?void 0:e.label,description:(l=e==null?void 0:e.description)!=null?l:"",share_settings:(h=e==null?void 0:e.share_settings)!=null?h:N,share_targets:(f=(_=e==null?void 0:e.share_targets)==null?void 0:_.map(t=>t.email))!=null?f:[],machine:e==null?void 0:e.machine_id,repositoryId:e==null?void 0:e.repos[0],workspaceDirectory:(g=e==null?void 0:e.workspace_dir)!=null?g:"",agentNetworkAccess:e==null?void 0:e.agent_network_access,setupCommands:e!=null&&e.setup?Array.isArray(e==null?void 0:e.setup)?e.setup.join("\n"):e.setup:"",maintenanceSetupCommands:e!=null&&e.maintenance_setup?Array.isArray(e==null?void 0:e.maintenance_setup)?e.maintenance_setup.join("\n"):e.maintenance_setup:"",envVars:Object.entries((S=e==null?void 0:e.env_vars)!=null?S:{}).map(([t,n])=>({key:t,value:n})),secrets:Object.keys(p).map(t=>({key:t,value:H,isEditing:!1})),autoSetupSettings:e==null?void 0:e.auto_setup_settings,cacheSettings:e==null?void 0:e.cache_settings},primaryButtonText:r.formatMessage({id:"wham.editEnvironment.saveEnvironment",defaultMessage:"Save environment"}),onSubmit:F,isPending:A})]}):s.jsx("div",{className:"flex h-full items-center justify-center",children:s.jsx(v,{id:"wham.editEnvironment.environmentNotFound",defaultMessage:"Environment not found"})})})}const We=()=>[{title:"Codex"}],Pe=I(function(){return s.jsx(ee,{})});export{Pe as default,We as meta};
//# sourceMappingURL=ncg0mzg32l9xbkxw.js.map
