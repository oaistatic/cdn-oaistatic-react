const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/fyw02vlaiv2vq6cj.js","assets/kfrdmkli83ureki3.js","assets/kw08ajijqinojrwh.js","assets/root-fi49nzd2.css","assets/conversation-small-lq38g8zw.css","assets/ezd0hym0jr36348y.js","assets/e9rpltumxiot7uop.js","assets/i645xwusmfb9eqih.js","assets/nz44s7ebe5b6pll5.js","assets/lu73hcy0eyoge4v0.js","assets/iwr3smf9emayvqcc.js","assets/jalrxozsu1d7y5op.js","assets/nhix0thqskc25i68.js","assets/n70q0rscelh7atg0.js","assets/ailj2wmeuzip7d2v.js","assets/c85f6nqv8fdbbc6i.js","assets/iq6svibhj2sapdyt.js"])))=>i.map(i=>d[i]);
var mt=Object.defineProperty,ft=Object.defineProperties;var pt=Object.getOwnPropertyDescriptors;var Re=Object.getOwnPropertySymbols;var ht=Object.prototype.hasOwnProperty,xt=Object.prototype.propertyIsEnumerable;var Ne=(t,a,s)=>a in t?mt(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,i=(t,a)=>{for(var s in a||(a={}))ht.call(a,s)&&Ne(t,s,a[s]);if(Re)for(var s of Re(a))xt.call(a,s)&&Ne(t,s,a[s]);return t},R=(t,a)=>ft(t,pt(a));import{_ as N,h as ee,r as u,j as e,e as ne,M as o,b as Ze,u as Ae,i as Pe,s as Xe,d as St,o as yt,y as bt,a1 as vt}from"./kfrdmkli83ureki3.js";import{di as wt,dk as kt,x as jt,a$ as z,pQ as It,b1 as Dt,pR as Mt,pS as Be,pT as _t,pU as Ct,pV as Et,bm as Je,bn as et,t as Me,m_ as Tt,pW as At,pX as Pt,mQ as Ot,bo as Le,a_ as Rt}from"./fyw02vlaiv2vq6cj.js";import{T as Nt,a as Bt}from"./frwdgn6kjyxcdqpx.js";import{az as B,d3 as ue,p as me,aB as K,e6 as ve,eG as ie,aA as U,$ as tt,a0 as st,u as Oe,_ as F,aC as at,db as Ve,aS as Lt,d4 as _e,d5 as Ce,J as it,aZ as Vt,cy as J,cB as ge,al as qt,R as fe,e9 as Wt,dT as Ft,t4 as Ut}from"./kw08ajijqinojrwh.js";import{a as Ht,c as $t}from"./lfd6u1c3bnv1pl81.js";import{D as Kt}from"./cn1z5fx9l5xxo8vy.js";import{C as zt}from"./i645xwusmfb9eqih.js";import{W as qe}from"./dlmcd5sexjk9ru4r.js";import{u as Qt,a as Gt}from"./udy9p09dkczfkqdq.js";import"./mj0406dyy526560j.js";import"./n25jb1xrdrimv99m.js";import"./nm285usnll51g0n4.js";import"./c326bjybavj646xd.js";import"./lwyag88acem9bm0o.js";import"./lg0oi3tmjv8kv2p4.js";import"./b3ungmqo5x8kj4fh.js";import"./o5h7u1aikohecbkt.js";import"./w4rmhhxvug61xnae.js";import"./dd8hh2tmra1psngf.js";import"./moa9hw4knutxpmay.js";import"./nh6x5pasrftsddpw.js";import"./c7lf6x6u521mpx19.js";import"./hk5ml9l4i4ups2ga.js";import"./fwbhrttgqnv5nm9m.js";const Yt=B(()=>N(()=>import("./fyw02vlaiv2vq6cj.js").then(t=>t.zy),__vite__mapDeps([0,1,2,3,4])),{loading:t=>U(t)}),Zt=B(()=>N(()=>import("./ezd0hym0jr36348y.js"),__vite__mapDeps([5,1])),{loading:t=>U(t)}),Xt=B(()=>N(()=>import("./e9rpltumxiot7uop.js"),__vite__mapDeps([6,1,2,3,7,0,4]))),We={[ue.VERIFIED]:"✅",[ue.PENDING]:"⏳",[ue.EXPIRED]:"⚠️"};function Jt({onRemoveDomainClick:t,onVerifyDomainClick:a}){const s=ee();return e.jsxs(ie.Root,{children:[e.jsx(ie.Trigger,{className:"inline-flex items-center rounded px-5 py-1 whitespace-nowrap hover:bg-gray-100 hover:text-gray-700 focus:ring-2 focus:ring-blue-500 focus:outline-none",title:s.formatMessage($.manageDomainTitle),children:e.jsx(Zt,{className:"icon"})}),e.jsx(ie.Portal,{children:e.jsxs(ie.Content,{children:[e.jsx(ie.Item,{onClick:t,children:e.jsx(o,i({},$.ssoDropdownRemoveButtonText))}),e.jsx(ie.Item,{onClick:a,children:e.jsx(o,i({},$.ssoDropdownVerifyButtonText))})]})})]})}function es({domains:t,workspaceId:a,isReadOnly:s=!1}){const n=ee(),c=me(),{mutateAsync:d,isPending:g}=wt(a),{mutateAsync:k,isPending:h}=kt(a),[y,f]=u.useState(!1),[v,j]=u.useState(),[C,V]=u.useState(""),O=t.filter(r=>r.hostname.toLowerCase().includes(C.toLowerCase())),p=!s;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3 flex w-full items-center gap-3",children:[e.jsx(jt,{className:"flex-1",name:"search-domains",color:"search",containerInputClassName:"w-full",value:C,onChange:r=>V(r.target.value),placeholder:n.formatMessage($.searchDomainsPlaceholder),ariaLabel:n.formatMessage($.searchDomainsAria)}),p&&e.jsx(K,{color:"secondary",className:"mt-0",onClick:()=>{f(!0)},icon:Yt,children:e.jsx(o,i({},$.addDomainButton))})]}),e.jsxs("div",{className:"relative",children:[p&&(g||h)&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/40 dark:bg-black/40",children:e.jsx(ve,{})}),e.jsxs(z.Root,{bordered:!0,className:"w-full table-auto",children:[e.jsxs(z.Header,{children:[e.jsx(z.HeaderCell,{className:"bg-token-main-surface-primary",children:e.jsx(o,i({},$.domainTableHeader))}),e.jsx(z.HeaderCell,{className:"bg-token-main-surface-primary",children:e.jsx(o,i({},$.statusTableHeader))}),p&&e.jsx(z.HeaderCell,{className:"bg-token-main-surface-primary"})]}),e.jsx(z.Body,{children:O.map((r,I)=>{const b=We[r.status]!==void 0?We[r.status]:"";return e.jsxs("tr",{onClick:()=>{p&&j(r)},className:p?"cursor-pointer":void 0,children:[e.jsx(z.Cell,{children:r.hostname}),e.jsx(z.Cell,{children:e.jsxs("span",{children:[b," ",n.formatMessage(It[r.status])]})}),p&&e.jsx(z.Cell,{textAlign:"right",className:"overflow-visible pe-4",children:e.jsx("div",{className:"inline-block overflow-visible",onClick:A=>A.stopPropagation(),children:e.jsx(Jt,{onRemoveDomainClick:()=>{k({domainId:r.id})},onVerifyDomainClick:async()=>{let A=r;r.status===ue.EXPIRED&&(await k({domainId:r.id}),A=await d({hostname:r.hostname})),"id"in A?j(A):c.danger(n.formatMessage($.domainVerifyError,{message:A.error.message}),{toastId:"domains_table",loggingTitle:$.domainVerifyError.defaultMessage,loggingDescription:"Unable to verify domain"})}})})})]},I)})})]})]}),p&&e.jsx(Xt,{isOpen:y||v!==void 0,onClose:()=>{f(!1),j(void 0)},workspaceId:a,currentDomain:y?void 0:v,domains:t},v==null?void 0:v.id)]})}const $=ne({ssoDropdownRemoveButtonText:{id:"workspaceIdentity.ssoDropdownRemoveButtonText",defaultMessage:"Remove Domain"},ssoDropdownVerifyButtonText:{id:"workspaceIdentity.ssoDropdownVerifyButtonText",defaultMessage:"Verify"},domainTableHeader:{id:"workspaceIdentity.domainTableHeader",defaultMessage:"Domain"},statusTableHeader:{id:"workspaceIdentity.statusTableHeader",defaultMessage:"Status"},addDomainButton:{id:"workspaceIdentity.addDomainButton.0",defaultMessage:"Add domain"},manageDomainTitle:{id:"workspaceIdentity.manageDomainTitle",defaultMessage:"Manage Domain"},domainVerifyError:{id:"workspaceIdentity.domainVerifyError",defaultMessage:"Your domain could not be verified: {message}"},searchDomainsPlaceholder:{id:"workspaceIdentity.searchDomainsPlaceholder",defaultMessage:"Search domains"},searchDomainsAria:{id:"workspaceIdentity.searchDomainsAria",defaultMessage:"Search domains"}});function Se(t,a){tt.count(st.DEFAULT,"sso_setup.step_completed",i({step:t},a?{workspaceId:a}:{}))}function ts(t,a){tt.count(st.DEFAULT,"sso_setup.step_viewed",i({step:t},a?{workspaceId:a}:{}))}const ss=B(()=>N(()=>import("./nz44s7ebe5b6pll5.js"),__vite__mapDeps([8,1])),{loading:t=>U(t)});function as({isOpen:t,onClose:a}){const s=Oe();return u.useEffect(()=>{t&&F.logEventWithStatsig("Identity: Reauth Required Modal Shown","chatgpt_identity_reauth_required_modal_shown")},[t]),e.jsx(at,{testId:"modal-reauth-required",isOpen:t,onClose:a,type:"warning",title:e.jsx(o,i({},Fe.reauthRequiredTitle)),icon:ss,primaryButton:e.jsx(Ve.Button,{onClick:()=>{Lt(s,{fallbackScreenHint:"login",callbackUrl:"/admin/identity"})},color:"primary",children:e.jsx(o,{id:"qcl4gn",defaultMessage:"Login"})}),secondaryButton:e.jsx(Ve.Button,{onClick:a,children:e.jsx(o,{id:"E1vtdZ",defaultMessage:"Close"})}),children:e.jsx("label",{className:"mb-2 flex items-center text-sm",children:e.jsx(o,i({},Fe.reauthRequiredExplanation))})})}const Fe=ne({reauthRequiredTitle:{id:"workspaceIdentity.reauthRequiredTitle",defaultMessage:"Please login again"},reauthRequiredExplanation:{id:"workspaceIdentity.reauthRequiredExplanation",defaultMessage:"For your security, please reauthenticate before making changes to SSO settings. (It's been more than 30 minutes since your last login.)"}}),nt=B(()=>N(()=>import("./fyw02vlaiv2vq6cj.js").then(t=>t.zy),__vite__mapDeps([0,1,2,3,4])),{loading:t=>U(t)}),Ee=B(()=>N(()=>import("./nz44s7ebe5b6pll5.js"),__vite__mapDeps([8,1])),{loading:t=>U(t)}),Ue=B(()=>N(()=>import("./lu73hcy0eyoge4v0.js"),__vite__mapDeps([9,1])),{loading:t=>U(t)}),He=B(()=>N(()=>import("./iwr3smf9emayvqcc.js"),__vite__mapDeps([10,1])),{loading:t=>U(t)}),Te=B(()=>N(()=>import("./jalrxozsu1d7y5op.js"),__vite__mapDeps([11,1])),{loading:t=>U(t)}),is=B(()=>N(()=>import("./nhix0thqskc25i68.js"),__vite__mapDeps([12,1])),{loading:t=>U(t)}),ns=B(()=>N(()=>import("./n70q0rscelh7atg0.js"),__vite__mapDeps([13,1])),{loading:t=>U(t)}),os=B(()=>N(()=>import("./ailj2wmeuzip7d2v.js"),__vite__mapDeps([14,1])),{loading:t=>U(t)}),rs={info:{outer:"bg-token-bg-secondary text-token-text-primary",iconBg:"bg-gray-200 text-gray-600 dark:bg-gray-700 dark:text-gray-400",icon:He},neutral:{outer:"border border-token-border-medium bg-white text-token-text-primary dark:bg-token-bg-secondary",iconBg:"bg-white text-token-text-tertiary border border-token-border-light dark:bg-gray-700 dark:text-gray-400",icon:He},success:{outer:"border border-token-border-medium bg-token-bg-secondary text-token-text-primary",iconBg:"bg-green-100 text-green-700 dark:bg-green-900/40 dark:text-green-300",icon:ns},progress:{outer:"border border-token-border-medium bg-token-bg-secondary text-token-text-primary",iconBg:"bg-blue-100 text-blue-700 dark:bg-blue-900/40 dark:text-blue-300",icon:os},add:{outer:"border border-token-border-medium bg-token-bg-secondary text-token-text-primary",iconBg:"bg-blue-100 text-blue-700 dark:bg-blue-900/40 dark:text-blue-300",icon:nt},disabled:{outer:"border border-token-border-medium bg-token-bg-secondary text-token-text-primary",iconBg:"bg-gray-200 text-gray-600 dark:bg-gray-700 dark:text-gray-400",icon:is},reauth:{outer:"border border-token-border-medium bg-token-bg-secondary text-token-text-primary",iconBg:"bg-blue-100 text-blue-700 dark:bg-blue-900/40 dark:text-blue-300",icon:Te}},$e=({variant:t,children:a,action:s})=>{const{outer:n,iconBg:c,icon:d}=rs[t],g={success:e.jsx(o,i({},m.statusSuccess)),progress:e.jsx(o,i({},m.statusProgress)),add:e.jsx(o,i({},m.statusAdd)),disabled:e.jsx(o,i({},m.statusDisabled)),reauth:e.jsx(o,i({},m.statusReauth)),info:e.jsx(o,i({},m.statusInformation)),neutral:e.jsx(o,i({},m.statusInformation))};return e.jsxs("div",{className:J(n,"flex flex-col gap-4 rounded px-4 py-3 shadow-sm"),children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("span",{className:J("inline-flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-full",c),children:[e.jsx(d,{className:"icon-sm","aria-hidden":"true"}),e.jsx("span",{className:"sr-only",children:g[t]})]}),e.jsx("div",{className:"text-sm leading-5",children:a})]}),s&&e.jsx("div",{className:"flex w-full justify-start",children:s})]})};function ls({isOpen:t,onConfirm:a,onCancel:s}){const[n,c]=u.useState(!1);return u.useEffect(()=>{t||c(!1)},[t]),e.jsx(at,{testId:"modal-sso-disable-confirm",isOpen:t,onClose:s,type:"warning",title:e.jsx(o,i({},m.ssoDisableConfirmTitle)),icon:Ee,primaryButton:e.jsx(K,{color:"primary",onClick:a,disabled:!n,children:e.jsx(o,i({},m.ssoDisableConfirm))}),secondaryButton:e.jsx(K,{color:"secondary",onClick:s,children:e.jsx(o,i({},m.ssoDisableCancel))}),children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"text-token-text-secondary text-sm",children:e.jsx(o,i({},m.ssoDisableConfirmBody))}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"disable-sso-confirm-checkbox",type:"checkbox",checked:n,onChange:d=>c(d.target.checked),className:"me-2"}),e.jsx("label",{htmlFor:"disable-sso-confirm-checkbox",className:"text-sm",children:e.jsx(o,i({},m.ssoDisableConfirmCheckbox))})]})]})})}function ds({currentWorkspaceId:t}){var le,xe;u.useEffect(()=>{F.logEventWithStatsig("Identity: SSO Page Viewed","chatgpt_identity_sso_page_viewed")},[]);const a=ee(),s=Oe(),n=me(),c=Dt(),d=((le=c==null?void 0:c.length)!=null?le:0)>0,{connection:g,enabled:k,error:h,isLoading:y}=Mt(),f=!1,[v,j]=u.useState(null),[C,V]=u.useState(!0),O=f,p=u.useMemo(()=>{var w,D;return{hasSsoConnection:!!g,isSsoActive:(g==null?void 0:g.sso_connection_status)==="ACTIVE",isSsoEnabled:!!((w=g==null?void 0:g.enabled_client_names)!=null&&w.includes("chat")),isSsoEnforced:!!((D=g==null?void 0:g.enforced_client_names)!=null&&D.includes("chat")),hasVerifiedDomain:d,isReauthRequired:(h==null?void 0:h.code)==="reauth_required"||!Be(s)}},[g,d,h,s]),r=u.useMemo(()=>p,[O,p,v]),[I,b]=u.useState(!1);u.useEffect(()=>{I&&F.logEventWithStatsig("Identity: Reauth Required Modal Shown","chatgpt_identity_reauth_required_modal_shown")},[I]);const A=_e(Ce.isTeamPlan),H=_e(Ce.isEnterpriseyPlan),E=it(s,"4105779609"),L=A&&E||H,{mutateAsync:q,status:P}=_t(t),{mutateAsync:we,status:G}=Ct(t);u.useEffect(()=>{G==="error"&&(F.logEventWithStatsig("Identity: SSO Toggle Error","chatgpt_identity_sso_toggle_error"),F.logEventWithStatsig("Identity: SSO Error","chatgpt_identity_sso_error")),G==="success"&&F.logEventWithStatsig("Identity: SSO Saved","chatgpt_identity_sso_saved")},[G]);const{mutateAsync:ke,status:oe}=Et(t);u.useEffect(()=>{oe==="error"&&F.logEventWithStatsig("Identity: Enforcement Toggle Error","chatgpt_identity_enforcement_toggle_error"),oe==="success"&&F.logEventWithStatsig("Identity: Enforcement Toggle","chatgpt_identity_enforcement_toggle",{state:r.isSsoEnforced?"on":"off"})},[oe,r.isSsoEnforced]);const W=y||P==="pending"||G==="pending",Q=u.useCallback(()=>{g!=null&&g.portal_link&&window.open(g.portal_link,"_blank")},[g]),pe=u.useCallback(async()=>{const w=await q();if(w instanceof Vt&&w.code==="reauth_required"){b(!0);return}w.portal_link&&(F.logEventWithStatsig("Identity: SSO Modal Opened","chatgpt_identity_sso_modal_opened"),window.open(w.portal_link,"_blank"))},[q,b]),te=u.useCallback(function(){const D=!r.hasVerifiedDomain||!L,X={loading:W,disabled:D};return D?e.jsx(K,R(i({},X),{color:"primary",icon:Ee,children:e.jsx(o,i({},m.setupSSOButton))})):r.isReauthRequired?e.jsx(K,R(i({},X),{color:"primary",onClick:()=>b(!0),icon:Te,children:e.jsx(o,i({},m.reauthButtonLabel))})):r.hasSsoConnection?r.hasSsoConnection&&!r.isSsoActive?e.jsx(K,R(i({},X),{color:"secondary",onClick:Q,icon:Ue,children:e.jsx(o,i({},m.completeSSOSetupButton))})):e.jsx(K,R(i({},X),{color:"secondary",onClick:Q,icon:Ue,children:e.jsx(o,i({},m.manageSSOButton))})):e.jsx(K,R(i({},X),{color:"primary",onClick:pe,icon:nt,children:e.jsx(o,i({},m.setupSSOButton))}))},[W,r,L,pe,Q]),Y=u.useMemo(()=>{let w,D="neutral";return r.hasVerifiedDomain?r.isReauthRequired?(D="reauth",w=e.jsx(o,i({},m.ssoNextStepReauth))):r.hasSsoConnection?r.hasSsoConnection&&!r.isSsoActive?(D="progress",w=e.jsx(o,i({},m.ssoNextStepActivateSSO))):r.isSsoEnabled&&r.isSsoActive?(D="success",w=e.jsx(o,i({},m.ssoStatusActive))):(D=r.isSsoEnabled?"neutral":"disabled",w=r.isSsoEnabled?e.jsx(o,i({},m.ssoEnabledButInactive)):e.jsx(o,i({},m.ssoStatusDisabled))):(D="add",w=e.jsx(o,i({},m.ssoNextStepSetupSSO))):(D="info",w=e.jsx(o,i({},m.ssoRequiresVerifiedDomain))),e.jsx($e,{variant:D,action:te(),children:w})},[r,te]),[re,Z]=u.useState(!1);async function se(){await we()}async function he(w){if(!Be(s)||r.isReauthRequired){b(!0);return}if(r.isSsoEnabled&&!w){Z(!0);return}try{await se(),F.logEventWithStatsig("Identity: SSO Toggle","chatgpt_identity_sso_toggle")}catch(D){throw F.logEventWithStatsig("Identity: SSO Toggle Error","chatgpt_identity_sso_toggle_error"),D}}return u.useEffect(()=>{["verifyDomain","setupSSO","enableSSO","activateSSO"].forEach(D=>ts(D,t)),r.hasVerifiedDomain&&Se("verifyDomain",t),r.hasSsoConnection&&Se("setupSSO",t),r.isSsoEnabled&&Se("enableSSO",t),r.isSsoEnabled&&r.isSsoActive&&Se("activateSSO",t)},[r.hasVerifiedDomain,r.hasSsoConnection,r.isSsoEnabled,r.isSsoActive,t]),k?e.jsxs(Je,{className:J(!r.hasVerifiedDomain&&"text-token-text-tertiary"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{className:J("icon-sm",r.isSsoEnabled&&r.isSsoActive?"text-blue-600":"text-token-text-tertiary")}),e.jsx(et,{children:e.jsxs("div",{className:"flex flex-row",children:[e.jsx("div",{children:e.jsx(o,i({},m.ssoTitle))}),e.jsx("div",{className:"ms-2 mt-1",children:W&&e.jsx(ve,{})})]})})]}),r.hasSsoConnection&&r.isSsoActive&&e.jsx(ge,{checked:r.isSsoEnabled,disabled:W||!L,onCheckedChange:he,"aria-label":a.formatMessage(m.ssoToggleActive)})]}),!1,e.jsx("div",{className:"mt-4",children:W?e.jsx($e,{variant:"progress",children:e.jsx(o,i({},m.loadingStatus))}):Y}),r.hasSsoConnection&&r.isReauthRequired&&!1,e.jsx(Me,{icon:Ee,title:e.jsx(o,i({},m.enforceSSOTitle)),body:e.jsx(o,i({},m.enforceSSOBody)),disabled:!r.hasVerifiedDomain||!r.isSsoActive,showDivider:!1,disabledPill:r.hasVerifiedDomain?e.jsx(o,i({},m.ssoRequiredPill)):e.jsx(o,i({},m.verifiedDomainRequiredPill)),disabledMessage:r.hasVerifiedDomain?e.jsx(o,i({},m.ssoRequiredMessage)):e.jsx(o,R(i({},m.requiresVerifiedDomain),{values:{feature:a.formatMessage(m.enforceSSOTitle)}})),toggle:e.jsx(ge,{checked:r.isSsoEnforced,disabled:W||!r.hasVerifiedDomain||!r.isSsoActive,onCheckedChange:w=>ke({enforcementStatus:w}),"aria-label":a.formatMessage(m.enforceSSOLabel)})}),r.isSsoEnabled&&r.isSsoActive&&e.jsxs(e.Fragment,{children:[e.jsx(zt,{label:a.formatMessage(m.idpSignInURL),value:"".concat(location.host,"/auth/login?sso=true&connection=").concat((xe=g==null?void 0:g.sso_connection_id)!=null?xe:"dev-connection"),onCopied:()=>n.success(a.formatMessage(m.copiedIDPUrlToClipboard))}),e.jsx("div",{className:"text-token-text-secondary mt-1 text-xs",children:e.jsx(o,i({},m.idpSignInURLNote))})]}),e.jsx(ls,{isOpen:re,onCancel:()=>Z(!1),onConfirm:async()=>{Z(!1),await se()}}),e.jsx(as,{isOpen:I,onClose:()=>b(!1)})]}):null}const m=ne({statusSuccess:{id:"workspaceIdentity.statusSuccess",defaultMessage:"Success"},statusProgress:{id:"workspaceIdentity.statusProgress",defaultMessage:"In Progress"},statusAdd:{id:"workspaceIdentity.statusAdd",defaultMessage:"Add SSO Connection"},statusDisabled:{id:"workspaceIdentity.statusDisabled",defaultMessage:"SSO Disabled"},statusReauth:{id:"workspaceIdentity.statusReauth",defaultMessage:"Reauthentication Required"},statusInformation:{id:"workspaceIdentity.statusInformation",defaultMessage:"Information"},ssoTitle:{id:"workspaceIdentity.ssoTitle",defaultMessage:"Single Sign On (SSO)"},ssoToggleActive:{id:"WorkspaceIdentityPage.ssoToggleActive",defaultMessage:"Enable SSO for this workspace"},ssoStatusActive:{id:"workspaceIdentity.ssoStatusActive",defaultMessage:"Single Sign On is enabled and active. All users with a verified domain can now log in using SSO."},ssoStatusDisabled:{id:"workspaceIdentity.ssoStatusDisabled",defaultMessage:"Single Sign On is set up but currently disabled. Users will continue to log in with their existing methods, but will fail to log in if they have only used SSO to access their account."},ssoEnabledButInactive:{id:"workspaceIdentity.ssoEnabledButInactive",defaultMessage:"Single Sign On is enabled but not yet active. Please complete the SSO setup in your identity provider to activate."},ssoRequiresVerifiedDomain:{id:"workspaceIdentity.ssoRequiresVerifiedDomain",defaultMessage:"To use Single Sign On (SSO), you need to verify at least one domain for your workspace. This ensures only users with approved email domains can log in via SSO."},ssoNextStepSetupSSO:{id:"workspaceIdentity.ssoNextStepSetupSSO",defaultMessage:"Set up Single Sign On (SSO) for your workspace."},ssoNextStepActivateSSO:{id:"workspaceIdentity.ssoNextStepActivateSSO",defaultMessage:"Complete your Single Sign On (SSO) setup, to enable users to log in with your identity provider."},ssoNextStepReauth:{id:"workspaceIdentity.ssoNextStepReauth",defaultMessage:"For your security, please reauthenticate to manage SSO. This is required if it has been more than 30 minutes since your last login."},setupSSOButton:{id:"workspaceIdentity.setupSSOButton",defaultMessage:"Set up SSO"},manageSSOButton:{id:"workspaceIdentity.manageSSOButton",defaultMessage:"Manage SSO"},completeSSOSetupButton:{id:"workspaceIdentity.completeSSOSetupButton",defaultMessage:"Complete SSO Setup"},loadingStatus:{id:"workspaceIdentity.loadingStatus",defaultMessage:"Loading..."},enforceSSOTitle:{id:"workspaceIdentity.enforceSSOTitle",defaultMessage:"Enforce SSO log in"},enforceSSOBody:{id:"workspaceIdentity.enforceSSOBody",defaultMessage:"When SSO is enforced, users will only be able to log in through your organization's identity provider. Social logins will be disabled."},enforceSSOLabel:{id:"workspaceIdentity.enforceSSOLabel",defaultMessage:"Toggle to require SSO for all workspace members"},reauthButtonLabel:{id:"workspaceIdentity.reauthButtonLabel",defaultMessage:"Reauthenticate"},reauthRequiredExplanation:{id:"workspaceIdentity.reauthRequiredExplanation",defaultMessage:"For your security, please reauthenticate before making changes to SSO settings. (It's been more than 30 minutes since your last login.)"},idpSignInURL:{id:"workspaceIdentity.idpSignInURL",defaultMessage:"IDP Sign-In URL"},idpSignInURLNote:{id:"workspaceIdentity.idpSignInURLNote",defaultMessage:"This is your Identity Provider sign-in URL. It can be bookmarked or added to dashboards to allow one click sign-on to ChatGPT."},copiedIDPUrlToClipboard:{id:"workspaceIdentity.copiedIDPUrlToClipboard",defaultMessage:"Copied IDP URL to clipboard"},ssoStepActivateSSO_Toggle:{id:"workspaceIdentity.ssoStepActivateSSO_Toggle",defaultMessage:"Activate SSO for your workspace by enabling the toggle to the right."},ssoStepDone:{id:"workspaceIdentity.ssoStepDone",defaultMessage:"Done"},ssoDisableConfirmTitle:{id:"workspaceIdentity.ssoDisableConfirmTitle",defaultMessage:"Disable Single Sign On (SSO)?"},ssoDisableConfirmBody:{id:"workspaceIdentity.ssoDisableConfirmBody",defaultMessage:"Disabling Single Sign On (SSO) may prevent some users from logging in, such as if they only use SSO and have no other way to log in. Are you sure you want to disable SSO for this workspace?"},ssoDisableCancel:{id:"workspaceIdentity.ssoDisableCancel",defaultMessage:"Cancel"},ssoDisableConfirm:{id:"workspaceIdentity.ssoDisableConfirm",defaultMessage:"Disable SSO"},ssoDisableConfirmCheckbox:{id:"workspaceIdentity.ssoDisableConfirmCheckbox",defaultMessage:"I understand disabling SSO may prevent some users from logging in."},requiresVerifiedDomain:{id:"workspaceIdentity.requiresVerifiedDomain",defaultMessage:"A verified domain is required to configure {feature}."},verifiedDomainRequiredPill:{id:"workspaceIdentity.verifiedDomainRequiredPill",defaultMessage:"Verified domain required"},ssoRequiredPill:{id:"workspaceIdentity.ssoRequiredPill",defaultMessage:"SSO required"},ssoRequiredMessage:{id:"workspaceIdentity.ssoRequiredMessage",defaultMessage:"Set up and enable SSO to change these settings"}}),cs=B(()=>N(()=>import("./c85f6nqv8fdbbc6i.js"),__vite__mapDeps([15,1,0,2,3,4,16])).then(t=>t.DirectorySyncSection)),De=({title:t,children:a})=>e.jsxs(Je,{className:"border-token-border-default rounded-xl border p-6",children:[e.jsx(et,{children:t}),e.jsx("div",{className:"mt-4",children:a})]});function us({currentWorkspaceId:t}){var H,E,L,q;const[s,n]=u.useState(!1),c=ee(),{data:d,isLoading:g}=Tt(t),k=Oe(),h=qt(k),y=h==null?void 0:h.isSelfServeBusiness(),f=(H=h==null?void 0:h.isK12())!=null?H:!1,v=it(k,"3592108663"),j="https://admin.openai.com",{variables:C,mutateAsync:V}=At(t),{variables:O,mutateAsync:p}=Pt(t),r=d==null?void 0:d.domains,I=!!(r!=null&&r.some(P=>P.status===ue.VERIFIED)),b=(L=(E=O==null?void 0:O.shouldAllowExternalDomainInvites)!=null?E:d==null?void 0:d.allow_external_domain_invites)!=null?L:!0,A=d?e.jsxs(Ot,{children:[!1,e.jsxs(De,{title:e.jsxs("div",{className:"flex items-center",children:[e.jsx(o,i({},S.domainsPoliciesSubtitle)),e.jsx("a",{href:"https://help.openai.com/en/articles/8871611-domain-verification",target:"_blank",rel:"noopener noreferrer",className:"ms-2 text-sm text-gray-500 hover:underline",children:e.jsx(o,i({},S.learnMoreLink))})]}),children:[e.jsx(es,{domains:d.domains,workspaceId:t,isReadOnly:!!(d!=null&&d.tenant_sso_enabled)}),d!=null&&d.tenant_sso_enabled?e.jsx("div",{className:"mt-2 text-sm text-gray-600",children:e.jsx(o,R(i({},S.tenantEnabledDomainsDescription),{values:{adminConsoleLink:e.jsx("a",{href:j,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-gray-500 hover:underline",children:e.jsx(o,i({},S.adminConsoleLink))})}}))}):e.jsx(Le,{className:"mt-2 text-sm text-gray-600",children:e.jsx(o,i({},S.verifyDomainInfoText))})]}),s&&e.jsxs("div",{className:"mb-2 flex items-center justify-between rounded bg-blue-50 p-2 text-sm text-blue-600",children:[e.jsx("span",{children:e.jsx(o,i({},S.domainValidationTitleSkipStaging))}),e.jsx("button",{onClick:()=>n(!1),className:"ms-4 text-blue-300 hover:text-blue-700 focus:outline-none","aria-label":c.formatMessage(S.closeWarning),children:e.jsx("span",{"aria-hidden":"true",children:e.jsx(o,i({},S.closeWarningIcon))})})]}),e.jsx(De,{title:e.jsxs("div",{className:"flex items-center",children:[e.jsx(o,i({},S.identitySubtitle)),e.jsx("a",{href:"https://help.openai.com/en/articles/9534785-configuring-sso-for-chatgpt-enterprise",target:"_blank",rel:"noopener noreferrer",className:"ms-2 text-sm text-gray-500 hover:underline",children:e.jsx(o,i({},S.learnMoreLink))})]}),children:d!=null&&d.tenant_sso_enabled?e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx("span",{children:e.jsx(o,i({},S.tenantEnabledSsoDescription))}),e.jsx("a",{href:j,target:"_blank",rel:"noopener noreferrer",className:"ms-2 text-sm text-gray-500 hover:underline",children:e.jsx(o,i({},S.adminConsoleLink))})]}):e.jsxs(e.Fragment,{children:[!I&&e.jsx(Le,{className:"text-gray-600",children:e.jsx(o,R(i({},S.requiresVerifiedDomain),{values:{feature:c.formatMessage(S.ssoSubtitle)}}))}),e.jsx(ds,{currentWorkspaceId:t})]})}),e.jsxs(De,{title:e.jsxs("div",{className:"flex items-center",children:[e.jsx(o,i({},S.provisioningSubtitle)),e.jsx("a",{href:"https://help.openai.com/en/articles/10479654-understanding-your-ideal-user-management-setup#h_b2253ef5a6",target:"_blank",rel:"noopener noreferrer",className:"ms-2 text-sm text-gray-500 hover:underline",children:e.jsx(o,i({},S.learnMoreLink))})]}),children:[e.jsxs("div",{className:"mb-2 space-y-4",children:[!f&&e.jsxs(e.Fragment,{children:[e.jsx(Me,{title:e.jsx(o,i({},S.autoProvisionTitle)),body:e.jsx(o,i({},S.autoProvisionBody)),disabled:!I,disabledPill:e.jsx(o,i({},S.verifiedDomainRequiredPill)),disabledMessage:e.jsx(o,R(i({},S.requiresVerifiedDomain),{values:{feature:c.formatMessage(S.autoProvisionTitle)}})),toggle:e.jsx(ge,{disabled:!I,checked:(q=C==null?void 0:C.shouldAutoProvision)!=null?q:d.should_auto_provision,onCheckedChange:P=>{V({shouldAutoProvision:P})},"aria-label":c.formatMessage(S.toggleAutoProvisionLabel)})}),e.jsx(Me,{title:e.jsx(o,i({},S.allowExternalDomainInvitesTitle)),body:e.jsx(o,i({},S.allowExternalDomainInvitesBody)),disabled:!I,disabledPill:e.jsx(o,i({},S.verifiedDomainRequiredPill)),disabledMessage:e.jsx(o,R(i({},S.requiresVerifiedDomain),{values:{feature:c.formatMessage(S.allowExternalDomainInvitesTitle)}})),toggle:e.jsx(ge,{disabled:!I,checked:b,onCheckedChange:P=>{p({shouldAllowExternalDomainInvites:P})},"aria-label":c.formatMessage(S.toggleDisableExternalDomainInvitesLabel)})})]}),v&&e.jsx(Kt,{workspaceId:t})]}),!f&&(y?e.jsx("span",{className:"text-sm text-gray-600",children:e.jsx(o,R(i({},S.scimNotAvailable),{values:{upgradeLink:e.jsx("a",{href:"https://openai.com/contact-sales/?utm_source=chatgpt-scim-upgrade&utm_medium=identity-page&utm_campaign=scim-upgrade",target:"_blank",rel:"noopener noreferrer",className:"text-gray-600 underline",children:e.jsx(o,{id:"workspaceIdentity.scimNotAvailable.upgradeLink",defaultMessage:"Upgrade to ChatGPT Enterprise"})})}}))}):e.jsx(cs,{workspaceId:t}))]}),!1]}):null;return g?e.jsx(ve,{}):A}const S=ne({title:{id:"workspaceIdentity.title",defaultMessage:"Identity & Provisioning"},domainsPoliciesSubtitle:{id:"workspaceIdentity.domainsPoliciesSubtitle",defaultMessage:"Verified Domains"},autoProvisionTitle:{id:"workspaceIdentity.autoProvisionSubtitle",defaultMessage:"Automatic account creation (SSO)"},autoProvisionBody:{id:"workspaceIdentity.autoProvisionBody",defaultMessage:"When Auto Provisioning is enabled, anyone who signs in through SSO with an email from one of your verified domains will get a workspace account automatically, no manual invite needed."},toggleAutoProvisionLabel:{id:"workspaceIdentity.toggleAutoProvisionLabel",defaultMessage:"Enable automatic account creation"},allowExternalDomainInvitesTitle:{id:"workspaceIdentity.allowExternalDomainInvitesTitle",defaultMessage:"Allow External Domain Invites"},allowExternalDomainInvitesBody:{id:"workspaceIdentity.allowExternalDomainInvitesBody",defaultMessage:"Enable this to allow invites to users from any domain. Disable this to limit invitations to users from your verified domains only. This applies only to new invites, and won't block existing users or invites already sent."},toggleDisableExternalDomainInvitesLabel:{id:"workspaceIdentity.toggleDisableExternalDomainInvitesLabel",defaultMessage:"Enable external domain invites"},verifyDomainInfoText:{id:"workspaceIdentity.verifyDomainInfoText",defaultMessage:"Verify your email domains to unlock advanced security features such as single sign-on (SSO), user provisioning, and more..."},tenantEnabledDomainsDescription:{id:"workspaceIdentity.tenantEnabledDomainsDescription",defaultMessage:"Users with emails from these domains can access this workspace. To update domains, please go to the admin console: {adminConsoleLink}."},identitySubtitle:{id:"workspaceIdentity.identitySubtitle",defaultMessage:"Identity Management"},ssoSubtitle:{id:"workspaceIdentity.ssoSubtitle",defaultMessage:"Single Sign-On (SSO)"},learnMoreLink:{id:"workspaceIdentity.learnMoreLink",defaultMessage:"Learn more ↗"},tenantEnabledSsoDescription:{id:"workspaceIdentity.tenantEnabledSsoDescription",defaultMessage:"To view or make changes to Single Sign On (SSO), go to the global admin console."},adminConsoleLink:{id:"workspaceIdentity.adminConsoleLink",defaultMessage:"Admin Console ↗"},provisioningSubtitle:{id:"workspaceIdentity.provisioningSubtitle",defaultMessage:"User Provisioning"},scimNotAvailable:{id:"workspaceIdentity.scimNotAvailable",defaultMessage:"Your plan supports Single Sign-On (SSO). {upgradeLink} if you need Directory Sync (SCIM)."},domainValidationTitleSkipStaging:{id:"workspaceIdentity.domainValidationTitleSkipStaging",defaultMessage:"Dev/Staging Only – Instant verify your domain or add 'manual' in the name to require manual verify. (go/ssosetup)"},requiresVerifiedDomain:{id:"workspaceIdentity.requiresVerifiedDomain",defaultMessage:"A verified domain is required to configure {feature}."},verifiedDomainRequiredPill:{id:"workspaceIdentity.verifiedDomainRequiredPill",defaultMessage:"Verified domain required"},closeWarning:{id:"workspaceIdentity.closeWarning",defaultMessage:"Close warning"},closeWarningIcon:{id:"workspaceIdentity.closeWarningIcon",defaultMessage:"×"}});function gs(t){return Ze({queryKey:["workspace-ip-allowlist",t],queryFn:t?()=>fe.safeGet("/accounts/{account_id}/ip-allowlist",{parameters:{path:{account_id:t}}}):Xe})}function ms(t){return Ze({queryKey:["workspace-compliance-ip-allowlist",t],queryFn:t?()=>fe.safeGet("/accounts/{account_id}/compliance-ip-allowlist",{parameters:{path:{account_id:t}}}):Xe})}function fs(t){const a=Ae(),s=me();return Pe({mutationFn:n=>fe.safePost("/accounts/{account_id}/compliance-ip-allowlist",{parameters:{path:{account_id:t}},requestBody:n}),onSuccess:()=>{a.invalidateQueries({queryKey:["workspace-compliance-ip-allowlist",t]})},onError:n=>{s.danger(n.message,{toastId:"compliance_ip_allowlist_create",loggingTitle:n.message,loggingDescription:"Failed to update Compliance API IP Allowlist"})}})}function ps(t){const a=Ae(),s=me();return Pe({mutationFn:n=>fe.safePost("/accounts/{account_id}/ip-allowlist",{parameters:{path:{account_id:t}},requestBody:n}),onSuccess:()=>{a.invalidateQueries({queryKey:["workspace-ip-allowlist",t]})},onError:n=>{s.danger(n.message,{toastId:"ip_allowlist_create",loggingTitle:n.message,loggingDescription:"Failed to update IP allowlist"})}})}function hs(t){const a=Ae(),s=me();return Pe({mutationFn:n=>fe.safePatch("/accounts/{account_id}/ip-allowlist",{parameters:{path:{account_id:t}},requestBody:n}),onSuccess:()=>{a.invalidateQueries({queryKey:["workspace-ip-allowlist",t]})},onError:n=>{s.danger(n.message,{toastId:"ip_allowlist_toggle",loggingTitle:n.message,loggingDescription:"Failed to toggle IP allowlist"})}})}const Ke={md:{font:14,h:18,gap:6},lg:{font:14,h:20,gap:6},xl:{font:14,h:24,gap:6},"2xl":{font:16,h:24,gap:8},"3xl":{font:16,h:32,gap:8}};function ze({value:t,defaultValue:a=[],onChange:s,validator:n,placeholder:c="",disabled:d=!1,size:g="xl",rows:k=1,maxTags:h,delimiters:y=[","," "],autoFocus:f=!1,showCount:v}){const j=ee(),C=t!==void 0,[V,O]=u.useState(a),p=t!=null?t:V,r=u.useRef(null),I=u.useRef(null),b=u.useRef(null),[A,H]=u.useState(f),[E,L]=u.useState(""),[q,P]=u.useState(null),[we,G]=u.useState(new Set),[ke,oe]=u.useState(16),W=!h||p.length<h,Q=p.length===0,pe=u.useMemo(()=>{const l=Ke[g];return k*l.h+(k+1)*l.gap},[k,g]),te=u.useMemo(()=>new Set(p.map(l=>l.value)),[p]),Y=u.useCallback(l=>{s==null||s(l),C||O(l)},[s,C]),re=u.useCallback(l=>n?n(l):!0,[n]),Z=u.useCallback(l=>{G(x=>new Set(x).add(l)),window.setTimeout(()=>{G(x=>{const M=new Set(x);return M.delete(l),M})},500)},[]),se=u.useCallback(l=>{const x=l.trim();if(!x)return;if(te.has(x)){Z(x);return}const M=[...p,{value:x,valid:re(x)}];Y(M)},[p,te,re,Y,Z]),he=u.useCallback(l=>{const x=[...p];x.splice(l,1),Y(x),P(null)},[p,Y]),le=()=>{const l=r.current;return!l||l.selectionStart===0&&l.selectionEnd===0},xe=l=>{if(W)if(l.key==="ArrowLeft"||l.key==="ArrowUp")le()&&(l.preventDefault(),P(x=>x==null?p.length-1:Math.max(0,x-1)));else if(l.key==="ArrowRight"||l.key==="ArrowDown"){if(q!=null){l.preventDefault();const x=q+1;P(x>=p.length?null:x)}}else l.key==="Backspace"&&(q!=null?(l.preventDefault(),he(q)):le()&&p.length&&(l.preventDefault(),P(p.length-1)))},w=l=>{l.key==="Enter"||y.includes(l.key)?(l.preventDefault(),E&&(se(E),L(""))):l.key==="Tab"&&E&&(l.preventDefault(),se(E),L(""))},D=l=>{let M=[l.clipboardData.getData("text")];for(const _ of y){const de=[];for(const Ie of M)de.push(...Ie.split(_));M=de}if(M=M.flatMap(_=>_.split(/\r?\n/)).map(_=>_.trim()).filter(Boolean),M.length>1){l.preventDefault();const _=[...p],de=new Set(te);for(const Ie of M){const ae=Ie.trim();if(ae){if(de.has(ae)){Z(ae);continue}if(h&&_.length>=h)break;_.push({value:ae,valid:re(ae)}),de.add(ae)}}_.length!==p.length&&Y(_),L("")}},X=()=>H(!0),ot=l=>{I.current&&l.relatedTarget instanceof Node&&I.current.contains(l.relatedTarget)||(H(!1),P(null),E.trim()&&(se(E),L("")))},rt=l=>{var M;if(d)return;const x=l.target instanceof Element?l.target.closest("[data-tag]"):null;if(x){const _=Number(x.getAttribute("data-index"));P(isNaN(_)?null:_);return}l.preventDefault(),(M=r.current)==null||M.focus(),P(null)};Wt(()=>{if(!W)return;const l=b.current,x=I.current;if(!l||!x)return;l.textContent=E||(Q?c:"")||"";const M=l.getBoundingClientRect().width,_=x.getBoundingClientRect().width-32;oe(Math.max(16,Math.min(M+4,_)))},[E,c,W,Q]);const je=Ke[g],lt={"--input-font-size":"".concat(je.font,"px"),"--input-height":"".concat(je.h,"px"),"--input-tag-spacing":"".concat(je.gap,"px"),minHeight:"".concat(pe,"px")},dt="flex items-center rounded px-[6px] py-[4px] text-[var(--input-font-size)] leading-none transition-colors select-none",ct="bg-green-50 text-green-800 hover:bg-green-100",ut="bg-red-50 text-red-800 hover:bg-red-100",gt="font-bold";return e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:I,className:J("relative mb-[8px] cursor-text overflow-x-hidden overflow-y-auto rounded-xl border-2 px-4 py-2",d?"cursor-not-allowed border-neutral-200 bg-neutral-50 opacity-60":"border-neutral-300 hover:border-neutral-400"),style:lt,"data-size":g,"data-focused":A?"":void 0,"data-empty":Q?"":void 0,"data-disabled":d?"":void 0,onKeyDown:xe,onMouseDown:rt,onFocus:X,onBlur:ot,tabIndex:-1,children:e.jsxs("div",{className:"flex flex-wrap items-start gap-x-[var(--input-tag-spacing)] gap-y-[var(--input-tag-spacing)]",children:[p.map((l,x)=>{const M=q===x,_=we.has(l.value);return e.jsxs("div",{"data-tag":l.value,"data-index":x,className:J(dt,l.valid?ct:ut,M&&gt,_&&"animate-pulse"),children:[e.jsx("span",{title:l.value,children:l.value}),!d&&e.jsx("button",{type:"button","aria-label":j.formatMessage({id:"4LMrjM",defaultMessage:"Remove"}),onClick:()=>he(x),className:"ms-[2px] inline-flex h-3.5 w-3.5 items-center justify-center rounded text-xs text-neutral-500 hover:text-neutral-900",children:j.formatMessage({id:"3pDUsa",defaultMessage:"x"})})]},l.value)}),W&&e.jsxs("div",{className:"inline-flex items-center",children:[e.jsx("span",{ref:b,className:"invisible absolute -z-10 whitespace-pre text-[var(--input-font-size)]"}),e.jsx("input",{ref:r,type:"text",value:E,placeholder:Q?c:void 0,disabled:d,onChange:l=>L(l.currentTarget.value),onKeyDown:w,onPaste:D,className:J("m-0 border-none bg-transparent p-0","leading-[1.4] text-[var(--input-font-size)] caret-current","outline-none focus:outline-none focus-visible:outline-none","ring-0 focus:ring-0 focus-visible:ring-0","placeholder:text-neutral-400"),style:{width:ke},autoFocus:f})]})]})}),(h||v)&&e.jsxs("div",{className:"mt-1 w-full text-end font-mono text-[12px] tracking-widest text-neutral-500",children:[p.length,h?"/".concat(h):null]})]})}const Qe=t=>t.split(".").reduce((a,s)=>(a<<8)+parseInt(s,10),0),ye=t=>{const[a,s]=t.split("::"),n=a?a.split(":"):[],c=s?s.split(":"):[],d=new Array(8-(n.length+c.length)).fill("0");return[...n,...d,...c].reduce((k,h)=>k*BigInt(65536)+BigInt(parseInt(h||"0",16)),BigInt(0))},xs=(t,a)=>{const[s,n]=a.split("/"),c=parseInt(n,10);return Qe(t)>>32-c===Qe(s)>>32-c},Ss=(t,a)=>{const[s,n]=a.split("/"),c=parseInt(n,10);return ye(t)>>BigInt(128-c)===ye(s)>>BigInt(128-c)},Ge=(t,a)=>{const s=t.trim();return s?a.some(n=>{const c=n.trim();if(c.includes("/"))return c.includes(":")?Ss(s,c):xs(s,c);if(c.includes(":"))try{return ye(s)===ye(c)}catch(d){return!1}return s===c}):!1},be=t=>{const a=t.trim();if(!a)return!1;const s=a.split("/");if(s.length>2)return!1;const[n,c]=s;if(c==="")return!1;let d;return c!==void 0&&(d=parseInt(c,10),isNaN(d))?!1:n.includes(":")?!(!ys(n)||d!==void 0&&(d<0||d>128)):!(!/^(\d{1,3}\.){3}\d{1,3}$/.test(n)||d!==void 0&&(d<0||d>32))},ys=t=>{const a=t.split("::");if(a.length>2)return!1;const s=a[0]?a[0].split(":"):[],n=a.length===2&&a[1]?a[1].split(":"):[],c=/^[0-9a-fA-F]{1,4}$/;return s.some(d=>!c.test(d))||n.some(d=>!c.test(d))?!1:a.length===1?s.length===8:s.length+n.length<8},T=ne({title:{id:"BQ70ZO",defaultMessage:"IP allowlists"},apiSectionTitle:{id:"UoxlHB",defaultMessage:"Workspace IP Allowlist"},complianceSectionTitle:{id:"n0UHsk",defaultMessage:"Compliance API IP Allowlist"},apiHelperText:{id:"hb/u6V",defaultMessage:"When enabled, only requests from the IP addresses or ranges you specify are allowed. You can toggle the allowlist on or off for the entire workspace. Changes may take up to 15 minutes to take effect."},complianceHelperText:{id:"Kog1O7",defaultMessage:"Always enforced for Compliance API keys: usage is restricted to the specified IP addresses or ranges. There is no global on/off toggle—add or remove IPs to change access. This does not impact other API keys or workspace permissions. Changes may take up to 15 minutes to take effect."},editIpsLabel:{id:"eoBlQ3",defaultMessage:"Allowed IPs / CIDR ranges"},emptyMessage:{id:"ynbWU8",defaultMessage:"Add IP address or CIDR range…"},saveButton:{id:"8c8mEa",defaultMessage:"Save"},invalidNotice:{id:"vwaoU9",defaultMessage:"One or more IP / CIDR entries are invalid."},emptyWarning:{id:"tus3/6",defaultMessage:"You are enabling an IP allowlist with no entries. This will block all traffic. Continue?"},currentIpNotInAllowlistWarning:{id:"NxwZWj",defaultMessage:"Your current IP address ({ip}) is not in this allowlist or in any of the allowed CIDR ranges. You may lose access after changes take effect. Continue?"},toggleLabel:{id:"eIKgW3",defaultMessage:"Enable IP allowlist"}});function Ye(t){var y;const a=u.useMemo(()=>{var f;return new Set((f=t==null?void 0:t.allowed_ips)!=null?f:[])},[t]),[s,n]=u.useState((y=t==null?void 0:t.allowed_ips)!=null?y:[]);u.useEffect(()=>{t&&n(t.allowed_ips)},[t]);const c=u.useMemo(()=>s.filter(f=>!be(f)),[s]),d=c.length===0,g=u.useMemo(()=>{var f,v;if(!t)return s.length>0;if(((v=(f=t.allowed_ips)==null?void 0:f.length)!=null?v:0)!==s.length)return!0;for(const j of s)if(!a.has(j))return!0;return!1},[t,s,a]),k=u.useMemo(()=>s.map(f=>({value:f,valid:be(f)})),[s]),h=u.useCallback(f=>{n(f.map(v=>v.value))},[]);return{ips:s,setIps:n,tagValues:k,invalidEntries:c,isValid:d,isDirty:g,handleTagChange:h}}function bs({currentWorkspaceId:t,readonly:a=!1,clientIp:s=""}){const n=ee(),c=gs(t),d=ms(t),g=u.useMemo(()=>{const b=c.data;if(b)return{allowed_ips:Array.isArray(b.allowed_ips)?b.allowed_ips:[],enabled:!!b.enabled}},[c.data]),k=!!(g!=null&&g.enabled),h=u.useMemo(()=>{const b=d.data;if(b)return{allowed_ips:Array.isArray(b.allowed_ips)?b.allowed_ips:[]}},[d.data]),y=Ye(g),f=Ye(h),v=ps(t),j=fs(t),C=hs(t),V=u.useCallback(()=>{y.isValid&&(k&&s&&!Ge(s,y.ips)&&!window.confirm(n.formatMessage(T.currentIpNotInAllowlistWarning,{ip:s}))||v.mutate({allowed_ips:y.ips}))},[y.isValid,y.ips,v,s,n,k]),O=u.useCallback(()=>{f.isValid&&j.mutate({allowed_ips:f.ips})},[f.isValid,f.ips,j]),p=u.useCallback(b=>{var A;if(b){const H=(A=g==null?void 0:g.allowed_ips)!=null?A:[];if(H.length===0){if(!window.confirm(n.formatMessage(T.emptyWarning)))return}else if(s&&!Ge(s,H)&&!window.confirm(n.formatMessage(T.currentIpNotInAllowlistWarning,{ip:s})))return}C.mutate({enabled:b})},[C,g==null?void 0:g.allowed_ips,n,s]),r=c.isLoading||d.isLoading,I=c.isFetching||d.isFetching;return r?e.jsx(ve,{}):e.jsxs("div",{className:"space-y-10 pt-6",children:[g&&e.jsx(qe,{title:T.apiSectionTitle,children:e.jsxs("div",{className:"max-w-4xl space-y-6 pb-6",children:[e.jsx("p",{className:"text-sm text-neutral-500",children:n.formatMessage(T.apiHelperText)}),e.jsx("label",{className:"block text-sm font-medium text-neutral-700",children:e.jsx(o,i({},T.editIpsLabel))}),e.jsx(ze,{value:y.tagValues,onChange:y.handleTagChange,validator:be,placeholder:n.formatMessage(T.emptyMessage),disabled:a||v.isPending,size:"xl",rows:3}),e.jsxs("div",{className:"mt-2 flex w-full items-center",children:[y.invalidEntries.length>0&&e.jsx("div",{className:"text-sm text-red-600",role:"alert",children:n.formatMessage(T.invalidNotice)}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ge,{checked:!!g.enabled,disabled:a||C.isPending,onCheckedChange:p,"aria-label":n.formatMessage(T.toggleLabel)}),e.jsx("span",{className:"text-sm text-neutral-600",children:g.enabled?e.jsx(o,{id:"0eFOl8",defaultMessage:"Allowlist is active."}):e.jsx(o,{id:"4N2jsY",defaultMessage:"Allowlist is inactive."})})]}),e.jsx(K,{className:"ms-auto",onClick:V,disabled:a||!y.isDirty||!y.isValid||v.isPending||I,children:e.jsx(o,i({},T.saveButton))})]})]})}),h&&e.jsx(qe,{title:T.complianceSectionTitle,children:e.jsxs("div",{className:"max-w-4xl space-y-6 pb-6",children:[e.jsx("p",{className:"text-sm text-neutral-500",children:n.formatMessage(T.complianceHelperText)}),e.jsx("label",{className:"block text-sm font-medium text-neutral-700",children:e.jsx(o,i({},T.editIpsLabel))}),e.jsx(ze,{value:f.tagValues,onChange:f.handleTagChange,validator:be,placeholder:n.formatMessage(T.emptyMessage),disabled:a||j.isPending,size:"xl",rows:3}),e.jsxs("div",{className:"mt-2 flex w-full items-center",children:[f.invalidEntries.length>0&&e.jsx("div",{className:"text-sm text-red-600",role:"alert",children:n.formatMessage(T.invalidNotice)}),e.jsx(K,{className:"ms-auto",onClick:O,disabled:a||!f.isDirty||!f.isValid||j.isPending||I,children:e.jsx(o,i({},T.saveButton))})]})]})})]})}const vs=u.memo(bs),ws=t=>t==="identity"||t==="access";function ks({currentWorkspaceId:t,clientIp:a}){var V,O;const s=ee(),n=Ft(),c=(O=(V=n==null?void 0:n.isK12)==null?void 0:V.call(n))!=null?O:!1,d=_e(Ce.isEnterpriseyPlan),g=!!n&&n.features.includes(Ut)&&d&&!c,k=u.useMemo(()=>{const p=[{key:"identity",label:s.formatMessage(ce.identityProvisioningTab),children:e.jsx(us,{currentWorkspaceId:t})}];return g&&p.push({key:"access",label:s.formatMessage(ce.accessRestrictionsTab),children:e.jsx(vs,{currentWorkspaceId:t,clientIp:a})}),p},[t,g,s,a]),h=St(),[y]=yt(),f=y.get("tab"),[v,j]=u.useState(f&&ws(f)?f:k[0].key),C=p=>{j(p),h({pathname:window.location.pathname,search:new URLSearchParams({tab:p}).toString()})};return e.jsxs(e.Fragment,{children:[e.jsx(Rt,{children:e.jsx("title",{children:s.formatMessage(ce.title)})}),e.jsx(Ht,{title:s.formatMessage(ce.title),subtitle:s.formatMessage(ce.subtitle),tabsHeader:e.jsx(Nt,{items:k,activeTab:v,onTabChange:C})}),e.jsx($t,{children:e.jsx(Bt,{items:k,activeTab:v})})]})}const ce=ne({title:{id:"HXl5ZX",defaultMessage:"Identity & access"},subtitle:{id:"rnQ6wO",defaultMessage:"Manage identity, provisioning, and access restrictions for your workspace."},identityProvisioningTab:{id:"tJggWk",defaultMessage:"Identity & provisioning"},accessRestrictionsTab:{id:"Winyfz",defaultMessage:"Access restrictions"}}),Gs=bt(function(){const a=Qt(),{clientIp:s}=vt();return Gt(),e.jsx(ks,R(i({},a),{clientIp:s}))});export{Gs as default};
//# sourceMappingURL=hul7jbr27nles7up.js.map
