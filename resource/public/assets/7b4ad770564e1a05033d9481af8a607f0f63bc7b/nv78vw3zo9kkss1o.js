import{r as L,j as l}from"./kfrdmkli83ureki3.js";import{C as k}from"./gbvne18halyi17u1.js";import{D as K}from"./lfj020w6m7gfm8bo.js";import{u as Q,i as X,C as $,g as y}from"./fezjsdexlc6827p7.js";import{C as z,T as tt}from"./e7j9ia0bu5w3396k.js";import{C as M}from"./mywblj616r9yptxe.js";import{a as et,b as ot,c as rt,d as U}from"./hytzro4etxb8j4b5.js";import{C as nt}from"./ce3hgmw4iyyhicud.js";import{T as it,A as P}from"./nvbtsxz152qyrww5.js";import{T as st}from"./me479l0dlgxhtxr0.js";import{b as lt,fe as ct,aZ as R,lY as mt}from"./fyw02vlaiv2vq6cj.js";import{bl as at,u as ut}from"./kw08ajijqinojrwh.js";import{u as dt}from"./edhlcmww46h398kf.js";import{C as pt}from"./bmm8s4kivjzbh6zb.js";import"./cjv4tm2buxt5byw3.js";import"./f538t4a72yr8mvhj.js";import"./bj2o1htuhytjg1ta.js";import"./juhk9bg10nm4p27d.js";import"./ns51nblw8ziscsgd.js";import"./m148ha1ozi8vz2cs.js";import"./ink8x3k66s63lr27.js";import"./jnr2ibp3zs9z7xhs.js";import"./de3ceoxcpky3ng0s.js";import"./mstl8wgfzorpgdoe.js";import"./cp40hb6p64z5j02r.js";import"./kfdkis1zwf4ccfgg.js";import"./ol9d5wxhynx9q2is.js";import"./mbmcx8v24u1ao1ke.js";import"./fxom17ahenhnb7xw.js";import"./deakbbf27g8e7ba0.js";import"./ft1wtuo4ibr3do9l.js";import"./kl7c6054usfnqmd4.js";import"./k97n0y6ba9c9h39c.js";import"./f86yt77iw8uocdb0.js";import"./gf4c0f98pdaqc94a.js";import"./idxukd613qgy7urm.js";function ft(t,e){const s=t.doc.lineAt(e.from);return e.from===s.from&&e.to-1===s.to}function Ct(t){const e=t.dom.querySelector(".cm-gutters");return e?e.offsetWidth:0}const gt=({onAddComment:t,isSendDisabled:e=!1,isWaitingForCommentResponse:s=!1})=>{const n=et(),p=ot(),o=rt(),O=L.useCallback(r=>{const{height:i,width:u}=r,c=n();if(!p||!c)return null;const m=p.selection.asSingle();if(m.ranges.length===0)return null;const a=m.ranges[0],{empty:H,to:v}=a;let{head:C}=a;const{platform:I}=lt();C=I==="web"?C:v;const g=C===v;let w=C;if(g&&ft(p,a)&&(w-=1),H)return null;const{left:h,top:A,bottom:N}=c.contentDOM.getBoundingClientRect(),{left:W,top:_,bottom:b}=at(c.coordsAtPos(w,g?-1:1)),E=Ct(c);function G(){if(g)return Math.max(W-h+E-u,E);let f=W-h+E;return f+u>o&&(f=-(u-o)),f}function j(f){const S=i*2,B=f.contentHeight-(b-N)>S&&window.innerHeight-b>S,V=b-A+8,x=_-A-i-8;return g&&B||x<0?{top:V,aboveOrBelow:P.BELOW}:{top:x,aboveOrBelow:P.ABOVE}}const T=j(c);return{left:G(),top:T.top,aboveOrBelow:T.aboveOrBelow,toolbarSize:r}},[p,n,o]),D=L.useCallback(()=>{var r,i;return(i=(r=n())==null?void 0:r.dom)!=null?i:null},[n]);return l.jsx(it,{onAddComment:t,isWaitingForCommentResponse:s,isSendDisabled:e,toolbarType:st.CODE,getToolbarPosition:O,getEditorDom:D,getSelectionRange:()=>{const r=n();if(!r)return null;const{state:i}=r,u=i.selection.asSingle();if(u.ranges.length===0)return null;const c=u.ranges[0],{from:m,to:a}=c;return m==null||a==null?null:{from:m,to:a,sourceFrom:m,sourceTo:a}}})};function ht({diff:t}){var e;return Q((e=t==null?void 0:t.edits)!=null?e:[]),null}function Et(t,e,s){const n=s?y():0;return t<=1e3-n?t-(e?z:0):t-(e?tt:0)}const ee=({comments:t,currentlyStreamingLineIndex:e,isPreview:s=!1,isWaitingForCommentResponse:n=!1,isSendDisabled:p=!1,readonlyReason:o,isRequestActive:O=!1,language:D,value:r,textdocDiff:i,maxLength:u,onAcceleratorsExpandedChange:c,onAddComment:m,onAcceptComment:a,onDismissComment:H,onBlur:v,onSave:C,onChange:I,onCancelRequest:g,getStableCommentId:w=mt,commentsMode:h=M.ENABLED,hideToolbar:A,hideAccelerators:N=!1,onSubmitAccelerator:W,modelCursor:_,codemirrorRef:b})=>{var F;const E=L.useRef(null),G=ut(),j=ct(G),[{width:T},f]=dt(),S=L.useRef(null),B=t.length>0,V=S.current,x=Et(T,B,(F=X(V))!=null?F:!1),Y=U(({commentingOn:d})=>d),Z=U(({hoveredCommentId:d})=>d),q=U(({focusedCommentId:d})=>d);L.useEffect(()=>{var d;(d=E.current)==null||d.UNSAFE_setValue(r||"")},[r]);const J=T-x;return l.jsx("div",{className:nt.code,ref:R(f,S),style:j&&s?{margin:"0 16px"}:{},children:l.jsxs(k,{id:"codemirror",comments:h===M.ALL_HIDDEN?void 0:t,commentingOn:Y,currentlyStreamingLineIndex:e,hoveredCommentId:Z,focusedCommentId:q,language:D,readonlyReason:o,onChange:I,maxLength:u,value:r,textdocDiff:i,editorRef:R(E,b),width:x,modelCursor:_,isPreview:s,hideLineNumbers:j&&s,onBlur:v,onSave:C,children:[l.jsxs(k.EditorChildren,{children:[!A&&l.jsx(gt,{onAddComment:m,isSendDisabled:p,isWaitingForCommentResponse:n}),h!==M.ALL_HIDDEN&&l.jsx("div",{className:B?"me-4":"",children:l.jsx($,{getStableCommentId:w,availableWidth:J,comments:t,commentsMode:h,onAddComment:m,onAcceptComment:a,onDismissComment:H,isWaitingForCommentResponse:n,isRequestActive:O,disableBlockComments:!0})})]}),l.jsxs(k.ContextChildren,{children:[i&&l.jsx(ht,{diff:i}),!N&&l.jsx(K,{isRequestActive:O,isVisuallyHidden:p||!!(o!=null&&o.isStreamingFromNative)||(o==null?void 0:o.isReadonly)&&!o.isStreaming,onSubmit:W,onCancel:g,actions:pt,onExpandedChange:c})]})]})})};export{ee as CodeComposer};
//# sourceMappingURL=nv78vw3zo9kkss1o.js.map
