const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/dch45l9yrtbjo93p.js","assets/kfrdmkli83ureki3.js","assets/njem4hkd3vzqk90b.js","assets/l3z5gz1257zwquc2.js","assets/fyw02vlaiv2vq6cj.js","assets/kw08ajijqinojrwh.js","assets/root-fi49nzd2.css","assets/conversation-small-lq38g8zw.css"])))=>i.map(i=>d[i]);
var be=Object.defineProperty,Ee=Object.defineProperties;var Me=Object.getOwnPropertyDescriptors;var me=Object.getOwnPropertySymbols;var je=Object.prototype.hasOwnProperty,Ie=Object.prototype.propertyIsEnumerable;var ce=(a,t,n)=>t in a?be(a,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[t]=n,s=(a,t)=>{for(var n in t||(t={}))je.call(t,n)&&ce(a,n,t[n]);if(me)for(var n of me(t))Ie.call(t,n)&&ce(a,n,t[n]);return a},Q=(a,t)=>Ee(a,Me(t));import{h as X,r,j as e,M as p,e as Ce,_ as J,u as we,i as ye}from"./kfrdmkli83ureki3.js";import{cq as Se,aB as O,az as Z,cy as ve,u as fe,kS as xe,dT as he,_ as W,d7 as oe,cg as ke,aT as Re,R as Te,aA as ee}from"./kw08ajijqinojrwh.js";import{a$ as N,x as _e,J as B,w as Ne,b0 as Ae,b1 as Ve,b2 as Be,V as re}from"./fyw02vlaiv2vq6cj.js";import{E as De}from"./ftz93pccq70nox0a.js";import{I as Le}from"./m0t07ixd92668z9e.js";import{c as Pe}from"./lg0oi3tmjv8kv2p4.js";const Fe=Z(()=>J(()=>import("./dch45l9yrtbjo93p.js"),__vite__mapDeps([0,1])),{loading:a=>ee(a)}),Oe=Z(()=>J(()=>import("./njem4hkd3vzqk90b.js"),__vite__mapDeps([2,1])),{loading:a=>ee(a)}),We=Z(()=>J(()=>import("./l3z5gz1257zwquc2.js"),__vite__mapDeps([3,1])),{loading:a=>ee(a)}),He=Z(()=>J(()=>import("./fyw02vlaiv2vq6cj.js").then(a=>a.zy),__vite__mapDeps([4,1,5,6,7])),{loading:a=>ee(a)}),pe=25,ue=[],ze=({workspace:a,onSuccess:t,seatCount:n})=>{"use no forget";var F;const c=X(),M=fe(),l=xe(M),o=he(),u=a.isOwnerOfAccount(),[b,E]=r.useState(!1),I=r.useRef(null),[S,A]=r.useState(!1),[x,y]=r.useState(!0),[k,C]=r.useState(!1),[d,w]=r.useState([]),[ae,H]=r.useState([]),[U,te]=r.useState(n?Array(n).fill(""):[]),{mutateAsync:q}=Ye(a.id,t),R=Ve(),$=(F=Be())!=null?F:!0,[G,D]=r.useState(ue),_=r.useMemo(()=>o==null?void 0:o.subscriptionAnalyticsParams,[o]);r.useEffect(()=>{if(!(d!=null&&d.length)||!(R!=null&&R.length)||$){D(ue);return}const m=R.map(g=>"@"+g.hostname.toLowerCase()),j=d.map(({email:g})=>g.toLowerCase()).filter(g=>!m.some(h=>g.endsWith(h)));D(j)},[R,$,d]);const L=Qe(u),P=r.useCallback(m=>{const j={numEmailsAdded:m,uploadType:"Bulk"};W.logEvent("Account Pay: Collaborator Emails Added",s(s({},_),j))},[_]),ie=r.useCallback(async m=>{var g;A(!0);const j=(g=m.target.files)==null?void 0:g[0];if(j){const h=await Ke(j,L,b);h.status==="success"?(w(h.newRows),H(h.newRows.map(z=>({label:z.email,value:z.email,isValid:re.test(z.email)}))),E(h.hasWarning),P(h.newRows.length),m.target.files=null):h.reason==="file_too_large"?l.danger(c.formatMessage(i.fileTooLargeWarning,{maxSize:"".concat(pe,"MB")}),{duration:5,loggingTitle:"CSV Upload: File too large"}):h.reason==="invalid_file_type"&&l.danger(c.formatMessage(i.fileIncorrectTypeWarning),{duration:5,loggingTitle:"CSV Upload: File incorrect type",toastId:"csv_upload",loggingDescription:i.fileIncorrectTypeWarning.defaultMessage})}},[L,c,b,l,P]),Y=(m,j,g)=>{const h=[...d];h[m]=Q(s({},h[m]),{[j]:g}),w(h)},se=r.useCallback(m=>{W.logEvent("Account Pay: Add Collaborators Modal Clicked",s(s({},_),m))},[_]),V=r.useCallback(()=>{W.logEvent("Account Pay: Add Collaborators Upload Clicked",_)},[_]),K=r.useCallback(()=>{W.logEvent("Account Pay: Collaborator Email Removed",_)},[_]),ne=m=>{const j=[...d.slice(0,m),...d.slice(m+1)];w(j),K()},v=r.useCallback(()=>{w([]),C(!1),H([])},[]),f=r.useCallback(async()=>{C(!0);try{d.length>5&&l.info(c.formatMessage(i.inviteMessageLoading,{numRows:d.length}),{hasCloseButton:!0});const m=[["admin",oe.ADMIN],["owner",oe.OWNER],["member",oe.STANDARD]],g=(await Promise.all(ke(m.map(([h,z])=>{const de=d.filter(le=>le.role===h).map(le=>le.email);return de.length>0&&q({emails:de,role:z,resendEmails:x})})))).flat().length;g>0&&l.success(c.formatMessage(i.inviteSuccessToast,{numRows:g,userStr:g===1?"user":"users",workspaceName:Pe(c,a)})),Re(M,"chatgpt_invite_users_to_workspace",d.length,{action:"SubmitEmails",location:"modal-submit-button",text:"Submit",step:"AdminModal-CollectEmails-Submit"}),t==null||t(),v()}finally{C(!1)}},[d,M,t,v,l,c,q,x,a]),T=r.useCallback(()=>{var m,j;(m=I.current)!=null&&m.value&&(I.current.value=""),(j=I.current)==null||j.click(),typeof document<"u"&&document.activeElement&&setTimeout(()=>{var h;const g=document.activeElement;(h=g==null?void 0:g.blur)==null||h.call(g)},0),V()},[I,V]);return{INVITE_ROLES:L,clearState:v,emailInputList:U,emailTableRows:d,emailTextAreaValue:ae,emailsOutsideOfDomain:G,fileInputRef:I,handleClickImportCSV:T,handleDeleteRow:ne,handleInputChange:Y,handleSubmit:f,handleUploadCSV:ie,hasUploadedCsv:S,isInviting:k,resendEmails:x,setEmailInputList:te,setEmailTableRows:w,setEmailTextAreaValue:H,setResendEmails:y,shouldShowWarning:b,trackNavigationClick:se,trackUploadClick:V}},Ue=({email:a,index:t,emailInputList:n,setEmailInputList:c,setEmailTableRows:M})=>{const l=X(),[o,u]=r.useState(!1),b=!!a&&!o&&t>0&&n.indexOf(a)<t;return e.jsxs("div",{className:"flex w-full flex-col gap-1",children:[e.jsx(Le,{className:ve((o||b)&&"border-token-text-error"),type:"email",value:a,onBlur:()=>{u(!!a&&!re.test(a))},placeholder:l.formatMessage(i.emailInputPlaceholder),onChange:E=>c(I=>{const S=[...I];return S[t]=E.target.value,M(S.filter(Boolean).map(A=>({email:A,role:"member"}))),S})},t),o&&e.jsx("div",{className:"interactive-label-warning-secondary ms-1 flex text-xs",children:e.jsx(p,s({},i.invalidEmailWarning))}),b&&e.jsx("div",{className:"interactive-label-warning-secondary ms-1 flex text-xs",children:e.jsx(p,s({},i.duplicateEmailWarning))})]})},ge=25,qe=10;function $e(a,t,n,c){const M=Math.max(0,c),l=Math.min(Math.max(0,n),t),o=Math.max(t-l,0),u=Math.min(M,o),b=Math.max(M-u,0);if(a<l)return"bg-black/30 dark:bg-white/30";if(a<l+u)return"bg-black dark:bg-white";if(a<l+u+b)return"bg-blue-200 dark:bg-blue-500 border border-blue-600 dark:border-blue-300"}function sa({workspace:a,canResendInviteEmails:t,onCancel:n,cancelButtonText:c,onSuccess:M,fullWidthButtons:l=!1,seatCount:o,seatsUsedBaseline:u=0,enableRoleSelectionStep:b=!1}){"use no forget";const E=X(),[I,S]=r.useState(o>qe),[A,x]=r.useState(!1),{clearState:y,emailInputList:k,emailTableRows:C,emailTextAreaValue:d,emailsOutsideOfDomain:w,fileInputRef:ae,handleClickImportCSV:H,handleSubmit:U,handleUploadCSV:te,hasUploadedCsv:q,isInviting:R,resendEmails:$,setEmailInputList:G,setEmailTableRows:D,setEmailTextAreaValue:_,setResendEmails:L,trackNavigationClick:P,shouldShowWarning:ie,handleInputChange:Y,handleDeleteRow:se,INVITE_ROLES:V}=ze({workspace:a,onSuccess:M,seatCount:o}),K=e.jsx(Se,{label:E.formatMessage(i.importCSVTooltip),contentClassName:"w-[280px]",side:"top",delayDuration:200,children:e.jsx(O,{className:"ms-auto",color:"secondary",icon:Oe,onClick:H,children:e.jsx(p,s({},q?i.reimportCSVButton:i.importCSVButton))})}),ne=v=>{const f=v.filter((T,F,m)=>m.findIndex(j=>j.value===T.value)===F);_(f),D(f.map(T=>({email:T.value,role:"member"})))};return r.useEffect(()=>{const v=d.filter((f,T,F)=>F.findIndex(m=>m.value===f.value)===T);D(v.map(f=>({email:f.value,role:"member"})))},[d,D]),b&&A?e.jsxs("div",{className:"flex flex-col gap-2",children:[ie&&e.jsxs("div",{className:"flex w-full items-center rounded-xl bg-yellow-100 p-4",children:[e.jsx(Fe,{className:"icon-sm me-2 text-yellow-700"}),e.jsx("div",{className:"grow text-yellow-700",children:e.jsx(p,s({},i.unspecifiedRoleDescription))})]}),w.length>0&&e.jsx("div",{className:"flex w-full items-center bg-red-100 p-4",children:e.jsxs("div",{className:"grow text-red-700",children:[e.jsx(p,s({},i.prohibitedExternalEmailDescription)),e.jsx("pre",{className:"my-1",children:w.join(", ")}),e.jsx(p,s({},i.prohibitedExternalEmailResolution))]})}),e.jsxs(N.Root,{size:"normal",children:[e.jsxs(N.Header,{children:[e.jsx(N.HeaderCell,{children:e.jsx(p,s({},i.inviteTableHeaderEmail))}),e.jsx(N.HeaderCell,{className:"w-32 ps-3",children:e.jsx(p,s({},i.inviteTableHeaderRole))}),e.jsx(N.HeaderCell,{})]}),e.jsx(N.Body,{children:C.map((v,f)=>e.jsxs(N.Row,{children:[e.jsx(N.Cell,{children:e.jsx(_e,{ariaLabel:E.formatMessage(i.inviteTableHeaderEmail),name:"email",type:"email",value:v.email,onChange:T=>Y(f,"email",T.target.value),color:"neutral"})}),e.jsx(N.Cell,{children:e.jsxs(B.Root,{value:v.role,onValueChange:T=>Y(f,"role",T),children:[e.jsxs(B.Trigger,{className:"w-32 justify-between",children:[e.jsx(B.Value,{}),e.jsx(B.Icon,{})]}),e.jsx(B.Portal,{children:e.jsxs(B.Content,{className:"border-token-main-surface-secondary border",children:[e.jsx(B.Item,{value:V.member,children:e.jsx(p,s({},i.inviteRoleMember))}),V.admin&&e.jsx(B.Item,{value:V.admin,children:e.jsx(p,s({},i.inviteRoleAdmin))}),V.owner&&e.jsx(B.Item,{value:V.owner,children:e.jsx(p,s({},i.inviteRoleOwner))})]})})]})}),e.jsx(N.Cell,{textAlign:"right",children:e.jsx(We,{onClick:()=>se(f),className:"icon-sm text-token-text-secondary me-2 cursor-pointer"})})]},f))})]}),t&&L&&e.jsx("div",{className:"text-token-text-secondary mt-2 flex items-center text-start",children:e.jsx(Ne,{id:"resend-emails",checked:$,onChange:v=>L(v.currentTarget.checked),label:E.formatMessage(i.resendEmailsFieldName)})}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx(O,{color:"secondary",size:l?"large":"medium",onClick:()=>x(!1),children:E.formatMessage(i.inviteMemberInviteBackButton)}),e.jsx(O,{color:"primary",size:l?"large":"medium",disabled:R||C.length===0||w.length>0,onClick:()=>{U(),P({buttonType:"Send"})},children:R?E.formatMessage(i.inviteMemberInviteSubmitButtonLoading):E.formatMessage(i.inviteMemberInviteSubmitButton)})]})]}):e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("input",{ref:ae,type:"file",accept:".csv,text/csv",id:"upload-csv",className:"hidden",onChange:v=>{te(v),S(!0)}}),w.length>0&&e.jsx("div",{className:"flex w-full items-center bg-red-100 p-4",children:e.jsxs("div",{className:"grow text-red-700",children:[e.jsx(p,s({},i.prohibitedExternalEmailDescription)),e.jsx("pre",{className:"my-1",children:w.join(", ")}),e.jsx(p,s({},i.prohibitedExternalEmailResolution))]})}),I?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-8 flex w-full items-center gap-3",children:[Math.max(o,Math.min(u,o)+d.length)<=ge&&e.jsx("div",{className:"bg-token-main-surface-secondary flex h-2 grow overflow-hidden rounded-3xl",children:Array(Ae(Math.max(o,Math.min(u,o)+d.length),0,ge)).fill(0).map((v,f)=>e.jsx("div",{className:ve("border-token-bg-primary h-full grow border-e-2 last-of-type:border-0",$e(f,o,u,d.length))},f))}),e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(p,Q(s({},i.seatsInvited),{values:{seatCount:o,enteredCount:Math.max(0,u)+d.length}}))})]}),e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx("label",{htmlFor:"add-member-emails",id:"add-emails-label",className:"text-base font-medium",children:e.jsx(p,s({},i.addEmailsFieldName))}),K]}),e.jsx(Ge,{value:d,onChange:ne})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 flex flex-col gap-4",children:[e.jsx("div",{className:"text-base font-medium",children:e.jsx(p,s({},i.addEmailsFieldName))}),k.map((v,f)=>e.jsx(Ue,{email:v,index:f,emailInputList:k,setEmailInputList:G,setEmailTableRows:D},f))]}),e.jsxs("div",{className:"align-center flex justify-between",children:[e.jsx(O,{color:"secondary",onClick:()=>{G(v=>[...v,""])},icon:He,children:e.jsx(p,s({},i.addEmailButton))}),K]})]}),Math.max(0,u)+C.length-o>0&&e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(p,Q(s({},i.seatsExceeded),{values:{exceeded:Math.max(0,u)+C.length-o}}))})]}),e.jsxs("div",{className:"mt-8 flex w-full flex-col gap-2",children:[e.jsx(O,{color:"primary",size:l?"large":"medium",loading:b?!1:R,disabled:(b?!1:R)||C.length===0||w.length>0,onClick:()=>{b?x(!0):(U(),P({buttonType:"Send"}))},children:b?E.formatMessage(i.inviteMemberInviteNextButton):E.formatMessage(R?i.inviteMemberInviteSubmitButtonLoading:i.inviteMemberInviteSubmitButton)}),e.jsx(O,{color:"ghost",size:l?"large":"medium",onClick:()=>{y(),n(),P({buttonType:"Skip"})},children:c})]})]})}function Ge(a){const t=he(),n=r.useMemo(()=>t==null?void 0:t.subscriptionAnalyticsParams,[t]),c=r.useCallback(l=>{W.logEvent("Account Pay: Collaborator Emails Added",s(s({},n),l))},[n]),M=r.useCallback(l=>{W.logEvent("Account Pay: Collaborator Email Removed",s(s({},n),l))},[n]);return e.jsx(De,s({trackEmailsAdded:c,trackEmailRemoved:M},a))}function Ye(a,t){"use no forget";const n=X(),c=fe(),M=xe(c),l=we();return ye({mutationFn:async({emails:o,role:u,resendEmails:b})=>{const E=[],I=Math.max(5,Math.round(o.length/10));for(let x=0;x<o.length;x+=I)E.push(o.slice(x,x+I));const S=async x=>Te.safePost("/accounts/{account_id}/invites",{parameters:{path:{account_id:a}},requestBody:{email_addresses:x,role:u,resend_emails:b}}).then(y=>(y.errored_emails.length>0&&M.danger(n.formatMessage(i.inviteMessageFailure,{emailsStr:y.errored_emails.map(({email_address:k,error:C})=>"".concat(k,": ").concat(C)).join(", ")}),{loggingTitle:"Failed to invite members",toastId:"admin_invite",loggingDescription:i.inviteMessageFailure.defaultMessage}),y.account_invites)).catch(y=>{throw M.danger(y.message,{toastId:"admin_invite",loggingTitle:"Failed to invite members",loggingDescription:y.message}),y});return(await Promise.all(E.map(x=>S(x)))).flat()},onSuccess:()=>{l.invalidateQueries({queryKey:["workspace","invites",a]}),t==null||t()}})}function Ke(a,t,n){return new Promise(c=>{if(a.size/1048576>pe)c({status:"error",reason:"file_too_large"});else if(a.type!=="text/csv")c({status:"error",reason:"invalid_file_type"});else{const l=new FileReader;l.readAsText(a),l.onload=function(o){var A;let u=n;const E=((A=o.target)==null?void 0:A.result).split("\n"),I=new Set,S=E.reduce((x,y)=>{var d;const[k,C]=y.split(",").map(w=>w.trim());return re.test(k)&&!I.has(k)&&(t[C]===void 0&&!u&&(u=!0),x.push({email:k,role:(d=t[C])!=null?d:t.member})),I.add(k),x},[]);c({status:"success",newRows:S,hasWarning:u})}}})}const Qe=a=>{const t={member:"member"};return a&&(t.admin="admin",t.owner="owner"),t},i=Ce({addEmailsFieldName:{id:"admin-invite.addEmailsFieldName.0",defaultMessage:"Emails"},unspecifiedRoleDescription:{id:"admin-invite.unspecifiedRoleDescription",defaultMessage:"Roles that were unspecified have been changed to Member."},prohibitedExternalEmailDescription:{id:"admin-invite.prohibitedExternalEmailDescription",defaultMessage:"The following emails are not a part of your organization's verified domains:"},prohibitedExternalEmailResolution:{id:"admin-invite.prohibitedExternalEmailResolution",defaultMessage:'Either remove these emails, enable "Allow External Domain Invites" from your workspace settings, or verify these email domains.'},inviteTableHeaderEmail:{id:"admin-invite.inviteTableHeaderEmail",defaultMessage:"Email"},inviteTableHeaderRole:{id:"admin-invite.inviteTableHeaderRole",defaultMessage:"Role"},inviteRoleMember:{id:"admin-invite.inviteRoleMember",defaultMessage:"Member"},inviteRoleAdmin:{id:"admin-invite.inviteRoleAdmin",defaultMessage:"Admin"},inviteRoleOwner:{id:"admin-invite.inviteRoleOwner",defaultMessage:"Owner"},fileTooLargeWarning:{id:"admin-invite.fileTooLargeWarning",defaultMessage:"File is too large. Please upload a CSV file smaller than {maxSize}."},fileIncorrectTypeWarning:{id:"admin-invite.fileIncorrectTypeWarning",defaultMessage:"Please upload a CSV file."},resendEmailsFieldName:{id:"admin-invite.resendEmailsFieldName",defaultMessage:"Resend emails for existing invites"},inviteMessageLoading:{id:"admin-invite.inviteMessageLoading",defaultMessage:"Sending out {numRows} invites, this may take a minute..."},inviteSuccessToast:{id:"admin-invite.inviteSuccessToast",defaultMessage:"Invited {numRows} {userStr} to {workspaceName}"},inviteMemberInviteNextButton:{id:"admin-invite.inviteMemberInviteNextButton",defaultMessage:"Next"},inviteMemberInviteSubmitButton:{id:"admin-invite.inviteMemberInviteSubmitButton",defaultMessage:"Send invites"},inviteMemberInviteSubmitButtonLoading:{id:"admin-invite.inviteMemberInviteSubmitButtonLoading",defaultMessage:"Sending invites..."},inviteMemberInviteBackButton:{id:"admin-invite.inviteMemberInviteBackButton",defaultMessage:"Back"},inviteMessageFailure:{id:"admin-invite.inviteMessageFailure",defaultMessage:"Unable to invite {emailsStr}"},importCSVButton:{id:"admin-invite.importCSVButton",defaultMessage:"Upload CSV"},reimportCSVButton:{id:"admin-invite.reimportCSVButton",defaultMessage:"Re-upload CSV"},importCSVTooltip:{id:"admin-invite.importCSVTooltip",defaultMessage:"Upload a CSV file. Your file must include an email on each line."},seatsInvited:{id:"admin-invite.seatsInvited",defaultMessage:"{enteredCount} of {seatCount} users"},seatsExceeded:{id:"admin-invite.seatsExceeded",defaultMessage:"Inviting these users will bill {exceeded} additional {exceeded, plural, one {user} other {users}} on your workspace."},emailInputPlaceholder:{id:"admin-invite.emailInputPlaceholder",defaultMessage:"Email"},addEmailButton:{id:"admin-invite.addEmailButton",defaultMessage:"Add more"},duplicateEmailWarning:{id:"admin-invite.duplicateEmailWarning",defaultMessage:"This email is a duplicate."},invalidEmailWarning:{id:"admin-invite.invalidEmailWarning",defaultMessage:"Please enter a valid email address."}});export{sa as A};
//# sourceMappingURL=nrepgto7in7c3ju5.js.map
