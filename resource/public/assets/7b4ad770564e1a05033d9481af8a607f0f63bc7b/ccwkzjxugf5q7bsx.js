const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/oyksq1pvhzkxbrqr.js","assets/kfrdmkli83ureki3.js","assets/i81hvwrjk30bdh55.js","assets/okzlvevr93wa1zvp.js","assets/lh493ui1ulngkb9y.js","assets/fyw02vlaiv2vq6cj.js","assets/kw08ajijqinojrwh.js","assets/root-fi49nzd2.css","assets/conversation-small-lq38g8zw.css","assets/mxg3f3sil9dynqw0.js","assets/jhjcbr6s6gbx7tjx.js","assets/i5hk3dzmzsyxt4n2.js","assets/lrtd9knjab0hf8x5.js","assets/iyn42bfr1ydmech0.js","assets/kspsmo2l8jg7uqdj.js","assets/o6iejiso3ne57s04.js","assets/ftbklkne5vchqwja.js","assets/lvjyu0g61mv6vm3s.js","assets/hdrss3fwjz1zjmw7.js","assets/eahncmechdd0yy5s.js"])))=>i.map(i=>d[i]);
var Ho=Object.defineProperty,Go=Object.defineProperties;var Ko=Object.getOwnPropertyDescriptors;var Ts=Object.getOwnPropertySymbols;var Uo=Object.prototype.hasOwnProperty,qo=Object.prototype.propertyIsEnumerable;var Yn=(t,e,n)=>e in t?Ho(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ne=(t,e)=>{for(var n in e||(e={}))Uo.call(e,n)&&Yn(t,n,e[n]);if(Ts)for(var n of Ts(e))qo.call(e,n)&&Yn(t,n,e[n]);return t},lt=(t,e)=>Go(t,Ko(e));var Rs=(t,e,n)=>Yn(t,typeof e!="symbol"?e+"":e,n);import{_ as De,c as he,h as st,j as g,M as Ge,r as p,i as io,e as zn,n as Vo,d as Yo}from"./kfrdmkli83ureki3.js";import{markdownToPlaintext as Xo,remarkRemoveDirectives as Qo}from"./bp7aioeryj7wbfac.js";import{az as Ae,aA as Oe,ed as lo,cy as ce,_ as sn,gX as $n,$ as ao,a0 as co,eG as bt,fd as Zo,cq as rn,R as as,A as uo,l as Jo,ab as er,cw as tr,ef as fo,M as nr,V as sr,eS as go,aF as at,rE as St,lr as on,sV as Rt,t2 as yt,t3 as Jt,oY as _t,vS as Ie,v_ as or,a as rr,wj as ir,oX as en,wA as lr,u as Ct,p as Hn,eV as mo,wB as ar,rI as Xn,fV as cr,iR as po,iT as ho,iS as bo,iQ as xo,iY as yo,e9 as ns,la as ur,m6 as dr,wC as fr,ek as gr,J as Gt,rj as Cs,wD as Ns,dR as mr,d_ as pr,hq as hr,cu as br,sY as xr,sW as yr,vD as Er,ph as Mr,dv as _r,P as Sr,D as Eo,dw as kr,n1 as Ir,d as wr,aB as Tr,B as Rr,z as Cr}from"./kw08ajijqinojrwh.js";import{c as cs}from"./c80q12olrn2ogvv0.js";import{cL as Nr,xy as Ln,hb as vr,hc as Pr,B as Dr,E as Ar,xz as ss,xA as Or,xB as Lr,xC as Br,fu as Mo,xD as _o,aX as vs,aW as jr,aN as Qn,aA as Ft,aI as Zn,xE as Fr,xF as Wr,e7 as zr,xG as $r,uP as Hr,al as Gr,ak as Kr,xH as Ur,mH as qr,mI as Vr,nc as Yr,fj as Xr,e6 as Qr}from"./fyw02vlaiv2vq6cj.js";import{P as Zr,S as Jr,a as ei,h as ti,r as Ps,u as ni}from"./glg11vispnpcyq1s.js";import{l as So,c as si,d as oi,B as os,e as ri,b as ii,H as li,f as ai,I as rs,L as ci,g as ko,O as us,U as ds,S as ui,T as di,h as fi,i as gi,C as mi,s as pi,j as hi,w as Ds,t as bi}from"./hzx9fvhly6v2qmjm.js";import{N as Io,E as xi,f as yi}from"./hytzro4etxb8j4b5.js";import{P as wo,H as fs,R as Ei,T as Mi}from"./jnr2ibp3zs9z7xhs.js";import{f as _i}from"./e7j9ia0bu5w3396k.js";import{r as Si,a as ki,b as Ii,m as wi}from"./e2qiox9wm3uaxg29.js";import{r as Ti}from"./kbj1b07s2z6vxqkg.js";import{r as Ri}from"./i7t1qh3u8s8bvtb8.js";import{r as Ci}from"./bdqubk4ywd0en7sc.js";import{A as Ni,T as vi}from"./nvbtsxz152qyrww5.js";import{a as ct,T as gs}from"./me479l0dlgxhtxr0.js";import{Z as Gn,T as To}from"./ce3hgmw4iyyhicud.js";import{u as Pi}from"./edhlcmww46h398kf.js";import{s as Di}from"./ft1wtuo4ibr3do9l.js";import{C as As}from"./fxythiulbb2q3qno.js";import{d as Ai}from"./kl7c6054usfnqmd4.js";import{g as Oi}from"./k97n0y6ba9c9h39c.js";var Bn=(t=>(t.STANDARD="standard",t.EMAIL="email",t.CREATIVE="creative",t.CHAT_MESSAGE="chat_message",t.SOCIAL_POST="social_post",t.UNKNOWN="unknown",t))(Bn||{});function $c(t){return Object.values(Bn).includes(t)?t:"unknown"}const Hc=["group my-4 w-full overflow-visible rounded-2xl","bg-token-bg-primary","dark:bg-[#2a2a2a]","shadow-[0px_0px_0px_1px_rgba(0,0,0,0.08),0px_2px_2px_rgba(0,0,0,0.08),0px_4px_80px_rgba(0,0,0,0.03)]","dark:shadow-[0px_0px_0px_1px_rgba(255,255,255,0.12),0px_2px_2px_rgba(0,0,0,0.2)]"].join(" "),Li="bg-token-bg-primary/98 dark:bg-[#2a2a2a]/98",Os="placeholder:text-token-text-tertiary min-w-0 flex-1 shrink-0 truncate border-none bg-transparent focus:border-transparent focus:ring-0 focus:outline-hidden",ms="text-sm font-medium",ln=0,Gc="bg-token-bg-primary fixed inset-0 z-30 cursor-zoom-out",Kc="bg-token-bg-primary dark:bg-[#2a2a2a] fixed inset-y-0 start-1/2 z-30 flex w-full w-[100%] lg:max-w-[50rem] -translate-x-1/2 cursor-auto flex-col outline-none dark:shadow-[0px_0px_0.5px_rgba(255,255,255,1)] shadow-[0px_0px_0px_1px_rgba(0,0,0,0.1),0px_8px_480px_rgba(0,0,0,0.04)]",Bi=Ae(()=>De(()=>import("./oyksq1pvhzkxbrqr.js"),__vite__mapDeps([0,1])),{loading:t=>Oe(t)}),ji=Ae(()=>De(()=>import("./i81hvwrjk30bdh55.js"),__vite__mapDeps([2,1])),{loading:t=>Oe(t)}),Fi=Ae(()=>De(()=>import("./okzlvevr93wa1zvp.js"),__vite__mapDeps([3,1])),{loading:t=>Oe(t)}),Jn=Ae(()=>De(()=>import("./lh493ui1ulngkb9y.js"),__vite__mapDeps([4,1])),{loading:t=>Oe(t)});function Wi(t){"use forget";const e=he.c(59),{onClick:n,clientThreadId:o,messageId:s}=t,r=st();let i;e[0]!==r?(i=r.formatMessage({id:"EmailSendButton.tooltip",defaultMessage:"Open in email"}),e[0]=r,e[1]=i):i=e[1];const l=i;let a;e[2]!==o||e[3]!==s||e[4]!==n?(a=G=>{sn.logEventWithStatsig("ChatGPT Writing Block Email Send Button Clicked","chatgpt_writing_block_email_send_button_clicked",lt(Ne({},$n({clientThreadId:o,messageId:s})),{provider:G})),ao.count(co.WRITING_BLOCKS,"chatgpt_writing_block_email_send_button_clicked"),n(G)},e[2]=o,e[3]=s,e[4]=n,e[5]=a):a=e[5];const u=a,f=!lo();let d;e[6]!==r?(d=r.formatMessage({id:"BnHAsh",defaultMessage:"Open email in app"}),e[6]=r,e[7]=d):d=e[7];let m;e[8]===Symbol.for("react.memo_cache_sentinel")?(m=g.jsx(Jn,{}),e[8]=m):m=e[8];let c;e[9]!==d?(c=g.jsx("button",{className:"flex items-center gap-1 px-2 py-2 text-sm select-none","aria-label":d,children:m}),e[9]=d,e[10]=c):c=e[10];let h;e[11]!==u?(h=()=>u("gmail"),e[11]=u,e[12]=h):h=e[12];let b;e[13]===Symbol.for("react.memo_cache_sentinel")?(b=g.jsx(Fi,{}),e[13]=b):b=e[13];let k;e[14]!==r?(k=r.formatMessage({id:"2cYA6Z",defaultMessage:"Open email using Gmail"}),e[14]=r,e[15]=k):k=e[15];let _;e[16]===Symbol.for("react.memo_cache_sentinel")?(_=g.jsx(Ge,{id:"N+/ksm",defaultMessage:"Gmail"}),e[16]=_):_=e[16];let C;e[17]!==h||e[18]!==k?(C=g.jsx(bt.Item,{onSelect:h,icon:b,"aria-label":k,label:_}),e[17]=h,e[18]=k,e[19]=C):C=e[19];let w;e[20]!==u?(w=()=>u("outlook"),e[20]=u,e[21]=w):w=e[21];let I;e[22]===Symbol.for("react.memo_cache_sentinel")?(I=g.jsx(Bi,{}),e[22]=I):I=e[22];let E;e[23]!==r?(E=r.formatMessage({id:"puDMOA",defaultMessage:"Open email using Outlook"}),e[23]=r,e[24]=E):E=e[24];let R;e[25]===Symbol.for("react.memo_cache_sentinel")?(R=g.jsx(Ge,{id:"0Laq6P",defaultMessage:"Outlook"}),e[25]=R):R=e[25];let y;e[26]!==w||e[27]!==E?(y=g.jsx(bt.Item,{onSelect:w,icon:I,"aria-label":E,label:R}),e[26]=w,e[27]=E,e[28]=y):y=e[28];let x;e[29]!==u?(x=()=>u("default"),e[29]=u,e[30]=x):x=e[30];let N;e[31]===Symbol.for("react.memo_cache_sentinel")?(N=g.jsx(ji,{}),e[31]=N):N=e[31];let M;e[32]!==r?(M=r.formatMessage({id:"aW6dXc",defaultMessage:"Open email using default email app"}),e[32]=r,e[33]=M):M=e[33];let O;e[34]===Symbol.for("react.memo_cache_sentinel")?(O=g.jsx(Ge,{id:"DcalRY",defaultMessage:"Default email app"}),e[34]=O):O=e[34];let T;e[35]!==x||e[36]!==M?(T=g.jsx(bt.Item,{onSelect:x,icon:N,"aria-label":M,label:O}),e[35]=x,e[36]=M,e[37]=T):T=e[37];let v;e[38]!==l||e[39]!==C||e[40]!==y||e[41]!==T||e[42]!==c?(v=g.jsx("div",{className:"hidden md:block",children:g.jsxs(Zo,{alignOffset:-8,size:"small",tooltip:l,tooltipSideOffset:ln,triggerButton:c,children:[C,y,T]})}),e[38]=l,e[39]=C,e[40]=y,e[41]=T,e[42]=c,e[43]=v):v=e[43];let S;e[44]===Symbol.for("react.memo_cache_sentinel")?(S=ce("px-2 py-2",ms),e[44]=S):S=e[44];let A;e[45]!==r?(A=r.formatMessage({id:"5fZEc+",defaultMessage:"Open in email"}),e[45]=r,e[46]=A):A=e[46];let P;e[47]!==u?(P=()=>u("default"),e[47]=u,e[48]=P):P=e[48];let W;e[49]!==l||e[50]!==f?(W=f?g.jsx(rn,{label:l,children:g.jsx(Jn,{})}):g.jsx("div",{className:"flex items-center gap-1",children:g.jsx(Jn,{})}),e[49]=l,e[50]=f,e[51]=W):W=e[51];let L;e[52]!==A||e[53]!==P||e[54]!==W?(L=g.jsx("div",{className:"block md:hidden",children:g.jsx("button",{className:S,"aria-label":A,onClick:P,children:W})}),e[52]=A,e[53]=P,e[54]=W,e[55]=L):L=e[55];let B;return e[56]!==v||e[57]!==L?(B=g.jsxs(g.Fragment,{children:[v,L]}),e[56]=v,e[57]=L,e[58]=B):B=e[58],B}const es="my-0! border-0 border-t !border-token-border-light",Uc="!ps-5 md:!pe-10 !pe-2 !pt-3 !pb-1";function qc(t){"use forget";var Se,Ve,ze;const e=he.c(61),{writingBlock:n,clientThreadId:o,messageId:s,onChange:r,setDirty:i,flushPendingChanges:l,isStreaming:a,streamingTitle:u,streamingRecipient:f,isInlineWritingBlockEditEnabled:d}=t,m=st(),[c,h]=p.useState((Se=n.title)!=null?Se:""),[b,k]=p.useState(String((ze=(Ve=n.metadata)==null?void 0:Ve.recipient)!=null?ze:"")),_=cs(r,300);let C;e[0]!==_||e[1]!==i?(C=xe=>{i(!0),h(xe.target.value),_({title:xe.target.value})},e[0]=_,e[1]=i,e[2]=C):C=e[2];const w=C;let I;e[3]!==_||e[4]!==i?(I=xe=>{i(!0),k(xe.target.value),_({metadata:{recipient:xe.target.value}})},e[3]=_,e[4]=i,e[5]=I):I=e[5];const E=I;let R;e[6]!==_||e[7]!==l||e[8]!==i?(R=xe=>{i(!0),_({title:xe.target.value}),_.flush(),l==null||l()},e[6]=_,e[7]=l,e[8]=i,e[9]=R):R=e[9];const y=R;let x;e[10]!==_||e[11]!==l||e[12]!==i?(x=xe=>{i(!0),_({metadata:{recipient:xe.target.value}}),_.flush(),l==null||l()},e[10]=_,e[11]=l,e[12]=i,e[13]=x):x=e[13];const N=x;let M;e[14]!==b||e[15]!==c||e[16]!==n.content?(M=xe=>{const F=encodeURIComponent(Xo(n.content)),H=encodeURIComponent(b),J=encodeURIComponent(c);switch(xe){case"gmail":return"https://mail.google.com/mail/u/0/?tf=cm&to=".concat(H,"&su=").concat(J,"&body=").concat(F);case"outlook":return"https://outlook.office.com/mail/deeplink/compose?to=".concat(H,"&subject=").concat(J,"&body=").concat(F);case"default":return"mailto:".concat(b,"?subject=").concat(J,"&body=").concat(F)}},e[14]=b,e[15]=c,e[16]=n.content,e[17]=M):M=e[17];const O=M;let T;e[18]===Symbol.for("react.memo_cache_sentinel")?(T=g.jsx(Ge,{id:"PrFQxx",defaultMessage:"Email"}),e[18]=T):T=e[18];const v=T;let S;e[19]!==O?(S=xe=>window.open(O(xe),"_blank"),e[19]=O,e[20]=S):S=e[20];let A;e[21]!==o||e[22]!==s||e[23]!==S?(A=g.jsx(Wi,{clientThreadId:o,messageId:s,onClick:S}),e[21]=o,e[22]=s,e[23]=S,e[24]=A):A=e[24];const P=A;let W;e[25]===Symbol.for("react.memo_cache_sentinel")?(W=ce("text-s flex w-full min-w-0 items-center px-5 py-1.5 font-sans"),e[25]=W):W=e[25];let L;e[26]===Symbol.for("react.memo_cache_sentinel")?(L=g.jsx("div",{className:"text-sm font-medium",children:g.jsx(Ge,{id:"NPvnYL",defaultMessage:"To"})}),e[26]=L):L=e[26];const B=a||!d;let G;e[27]===Symbol.for("react.memo_cache_sentinel")?(G=ce(Os,"text-sm"),e[27]=G):G=e[27];let K;e[28]!==m?(K=m.formatMessage({id:"12HHUV",defaultMessage:"name@email.com"}),e[28]=m,e[29]=K):K=e[29];const q=a?f!=null?f:"":b;let z;e[30]!==N||e[31]!==E||e[32]!==B||e[33]!==K||e[34]!==q?(z=g.jsxs("div",{className:W,children:[L,g.jsx("input",{disabled:B,className:G,maxLength:240,placeholder:K,value:q,onChange:E,onBlur:N,onCopy:$i})]}),e[30]=N,e[31]=E,e[32]=B,e[33]=K,e[34]=q,e[35]=z):z=e[35];const U=z;let Y;e[36]===Symbol.for("react.memo_cache_sentinel")?(Y=ce("flex w-full min-w-0 items-center px-5 py-1.5 font-sans text-sm"),e[36]=Y):Y=e[36];let $;e[37]===Symbol.for("react.memo_cache_sentinel")?($=g.jsx("div",{className:"text-sm font-medium",children:g.jsx(Ge,{id:"eQGtfX",defaultMessage:"Subject"})}),e[37]=$):$=e[37];const V=a||!d;let D;e[38]===Symbol.for("react.memo_cache_sentinel")?(D=ce(Os,"text-sm"),e[38]=D):D=e[38];const Z=a?u!=null?u:"":c;let ee;e[39]!==y||e[40]!==w||e[41]!==V||e[42]!==Z?(ee=g.jsxs("div",{className:Y,children:[$,g.jsx("input",{disabled:V,className:D,value:Z,maxLength:240,onChange:w,onBlur:y,onCopy:zi})]}),e[39]=y,e[40]=w,e[41]=V,e[42]=Z,e[43]=ee):ee=e[43];const ae=ee;let We;e[44]===Symbol.for("react.memo_cache_sentinel")?(We=g.jsx("hr",{className:es}),e[44]=We):We=e[44];let ye;e[45]===Symbol.for("react.memo_cache_sentinel")?(ye=g.jsx("hr",{className:es}),e[45]=ye):ye=e[45];let _e;e[46]===Symbol.for("react.memo_cache_sentinel")?(_e=g.jsx("hr",{className:es}),e[46]=_e):_e=e[46];let be;e[47]!==ae||e[48]!==U?(be=g.jsxs("div",{children:[We,U,ye,ae,_e]}),e[47]=ae,e[48]=U,e[49]=be):be=e[49];const de=be;let we;return e[50]!==P||e[51]!==de||e[52]!==N||e[53]!==E||e[54]!==y||e[55]!==w||e[56]!==b||e[57]!==ae||e[58]!==c||e[59]!==U?(we={headerLabel:v,emailSendButton:P,toField:U,subjectField:ae,fullScreenEmailHeader:de,titleState:c,recipientState:b,handleOnTitleChange:w,handleOnTitleBlur:y,handleOnRecipientChange:E,handleOnRecipientBlur:N},e[50]=P,e[51]=de,e[52]=N,e[53]=E,e[54]=y,e[55]=w,e[56]=b,e[57]=ae,e[58]=c,e[59]=U,e[60]=we):we=e[60],we}function zi(t){return t.stopPropagation()}function $i(t){return t.stopPropagation()}function Hi({serverThreadId:t,index:e,messageId:n,writingBlock:o,dirty:s,setDirty:r,delay:i=2e3}){const[l,a]=p.useState(!1),[u,f]=p.useState(null),[d,m]=p.useState(null),[c,h]=p.useState(!1),[b,k]=p.useState(!1),_=p.useRef(0),C=p.useRef(o.content),w=p.useRef(o.title),I=p.useRef(o.metadata),E=p.useRef(!1),R=p.useRef(!1),y=p.useRef(0),x=p.useRef(null),{mutate:N}=io({mutationFn:async({content:S,title:A,metadata:P})=>{_.current+=1,_.current>1&&k(!0),!(!t||!n)&&await as.safePost("/conversation/message/writing-blocks",{requestBody:{message_id:n,conversation_id:t,index:String(e),id:o.id,writing_block:{content:S,index:String(e),variant:o.variant.toString(),metadata:P,title:A,id:o.id},updated_at:new Date().toISOString()},authOption:uo.SendIfAvailable})},onSuccess:(S,A,P)=>{x.current===(P==null?void 0:P.myVersion)&&(r(!1),m(new Date))},onMutate:()=>{_.current=0,k(!1);const S=++y.current;return x.current=S,a(!0),f(null),{myVersion:S}},onError:(S,A,P)=>{f(S.message),r(!0)},onSettled:(S,A,P,W)=>{_.current=0,k(!1),x.current===(W==null?void 0:W.myVersion)&&(a(!1),x.current=null,E.current&&M.flush())},retry:1,retryDelay:3e3}),M=cs(({content:S,title:A,metadata:P})=>{E.current=!1,h(!1),N({content:S,title:A,metadata:P})},i);p.useEffect(()=>{var S;if(o.content===C.current&&o.title===w.current&&o.metadata===I.current){R.current=!1;return}C.current=o.content,w.current=o.title,I.current=o.metadata,E.current=!0,h(!0),M({content:o.content,title:o.title,metadata:(S=o.metadata)!=null?S:{}}),R.current&&(Promise.resolve().then(()=>{M.flush()}),R.current=!1)},[o.content,o.title,o.metadata,M]),p.useEffect(()=>()=>{M.cancel(),R.current=!1,h(!1)},[M]);const O=p.useCallback(()=>{if(!s&&!E.current){R.current=!1,h(!1);return}R.current=!0,E.current&&(M.flush(),R.current=!1,h(!1))},[s,M]),T=p.useMemo(()=>!!d&&!s&&!l,[d,s,l]);return{status:p.useMemo(()=>b?"retrying":l?"saving":u?"error":c?"queued":s?"dirty":T?"saved":"idle",[b,l,u,c,s,T]),savedAt:d,error:u,flushPendingChanges:O}}const Gi=()=>({editWritingBlock:p.useCallback(({content:e,clientThreadId:n,message:o,index:s,variant:r,metadata:i,title:l,id:a})=>{var u,f;(f=(u=o.metadata)==null?void 0:u.writing_blocks)!=null&&f[a]||sn.logEventWithStatsig("ChatGPT Writing Block First Edit","chatgpt_writing_block_first_edit",Ne({},$n({clientThreadId:n,messageId:o.id}))),Jo(n,d=>er.updateTree(d,m=>{var c,h;return m.updateNodeMessageMetadata(o.id,{writing_blocks:lt(Ne({},(h=(c=o.metadata)==null?void 0:c.writing_blocks)!=null?h:{}),{[a]:{id:a,index:s,content:e,variant:r,title:l,metadata:i}})})}))},[])});function Vc({conversation:t,messageId:e,id:n,originalContent:o,index:s,variant:r,title:i,recipient:l}){var T,v;const a=tr(),u=t!=null?t:a,[f,d]=p.useState(!1),m=fo(()=>u==null?void 0:u.serverId$()),c=nr(u==null?void 0:u.id,S=>{if(!e||!S)return;const P=sr.getTree(S).getNodeIfExists(e);return P==null?void 0:P.message},{disablePerfDetector:!0}),h=(v=(T=c==null?void 0:c.metadata)==null?void 0:T.writing_blocks)==null?void 0:v[n],b=p.useMemo(()=>{var S;return(S=h==null?void 0:h.metadata)!=null?S:{recipient:l!=null?l:null}},[l,h==null?void 0:h.metadata]),k=!!h,{editWritingBlock:_}=Gi(),C=Nr(),w=m!=null&&!C,I=p.useMemo(()=>{var S,A,P;return(P=(A=(S=c==null?void 0:c.metadata)==null?void 0:S.writing_blocks)==null?void 0:A[n])!=null?P:{id:n,content:o,index:s,variant:r,title:i,metadata:b}},[c,n,o,s,r,i,b]),E=p.useMemo(()=>{var S,A;return(A=(S=c==null?void 0:c.metadata)==null?void 0:S.content_references)!=null?A:[]},[c]),{status:R,flushPendingChanges:y}=Hi({serverThreadId:m,index:s,messageId:e,dirty:f,setDirty:d,writingBlock:I}),x=p.useCallback(({content:S,title:A,metadata:P})=>{!(u!=null&&u.id)||!c||!c.id||_({content:S!=null?S:I.content,clientThreadId:u==null?void 0:u.id,message:c,index:s,variant:r,metadata:Object.assign({},b,P),title:A!=null?A:I.title,id:n})},[u==null?void 0:u.id,c,s,r,_,n,I,b]),N=p.useRef(null),M=p.useRef(null),O=p.useMemo(()=>{var S;return{serverThreadId:m,messageId:e,blockId:(S=I.id)!=null?S:String(I.index)}},[m,e,I.id,I.index]);return{serverThreadId:m,conversation:u,writingBlock:I,contentReferences:E,autosaveStatus:R,flushPendingChanges:y,handleOnChange:x,messageRef:N,editorViewRef:M,analyticsMetadata:O,hasBeenEdited:k,isWritingBlockEditingAllowed:w,setDirty:d,dirty:f}}const Ki=go(()=>({currentAIOperation$:at(null)})),Ui=t=>Ki(t).currentAIOperation$,qi=(t,e)=>{Ui(t).set(e)},Vi=new Set(["list","ordered_list"]);function Yi(t){var n;const e=t.nodes.regular_list_item;if(e)return e;for(const o of Object.values(t.nodes))if(((n=o.spec.group)!=null?n:"").split(/\s+/).filter(Boolean).includes("list_item"))return o;return null}function Ro(t){const{selection:e}=t;return e.empty&&e.$from.parent.isTextblock&&e.$from.parentOffset===0}function Xi(t){return t?Vi.has(t.type.name):!1}function Qi(t,e,n){if(!Ro(t))return!1;const{$from:o}=t.selection;for(let s=o.depth;s>0;s-=1)if(o.node(s).type===n)return So(n)(t,e);return!1}function Ls(t,e,n){let o=t+1;for(let s=0;s<n;s+=1)o+=e.child(s).nodeSize;return o}function Zi(t,e){const{selection:n,schema:o}=t;if(!Ro(t))return!1;const s=o.nodes.paragraph;if(!s)return!1;const{$from:r}=n;if(r.parent.type!==s||r.depth!==1)return!1;const i=r.before(1),l=r.after(1),a=t.doc.childBefore(i);if(!a.node||!Xi(a.node))return!1;const u=a.node;if(u.childCount===0)return!1;const f=u.childCount-1,d=u.child(f);if(d.childCount===0)return!1;const m=d.childCount-1,c=d.child(m);if(!c.type.isTextblock)return!1;const h=i-u.nodeSize,b=Ls(h,u,f),_=Ls(b,d,m)+c.nodeSize-1,C=r.parent,w=t.tr;w.delete(i,l);const I=w.mapping.map(_,-1);return C.content.size===0?(e&&(w.setSelection(on.create(w.doc,I)),e(w.scrollIntoView())),!0):(w.insert(I,C.content),e&&(w.setSelection(on.create(w.doc,I)),e(w.scrollIntoView())),!0)}const Ji=(t,e)=>{const n=Yi(t.schema);return n?Qi(t,e,n)||Zi(t,e):!1};function el(){return new St({props:{handleKeyDown(t,e){return e.defaultPrevented||e.key!=="Backspace"||e.metaKey||e.ctrlKey||e.altKey?!1:Ji(t.state,t.dispatch)}}})}const tl="data-writing-block-empty-placeholder",nl="paragraph",tn=new Rt("writingBlockEmptyNodePlaceholder");function sl(t,e){return new St({key:tn,state:{init(n,o){return{decorations:js(o.doc,o.selection,t,e),isDisabled:t,placeholderText:e}},apply(n,o){var l,a,u,f;const s=n.getMeta(tn),r=(a=(l=Bs(s)?s.isDisabled:void 0)!=null?l:o.isDisabled)!=null?a:t,i=(f=(u=Bs(s)?s.placeholderText:void 0)!=null?u:o.placeholderText)!=null?f:e;return!n.docChanged&&!n.selectionSet&&r===o.isDisabled&&i===o.placeholderText?o:{decorations:js(n.doc,n.selection,r,i),isDisabled:r,placeholderText:i}}},props:{decorations(n){var o,s;return(s=(o=tn.getState(n))==null?void 0:o.decorations)!=null?s:null}}})}function ol(t,e){return t.setMeta(tn,e)}function Bs(t){return typeof t=="object"&&t!=null&&(Object.prototype.hasOwnProperty.call(t,"isDisabled")||Object.prototype.hasOwnProperty.call(t,"placeholderText"))}function js(t,e,n,o){if(n||!e.empty)return yt.empty;const s=rl(e,o);return s?yt.create(t,[s]):yt.empty}function rl(t,e){const n=t.$from.parent;if(!n.isTextblock||n.type.name!==nl||n.content.size>0)return null;const o=t.$from.before();if(typeof o!="number")return null;const s=o+n.nodeSize;return Jt.node(o,s,{[tl]:e})}const jn="generateSuggestionId";class ps extends Io{static proseMirrorNodeName(){return"generate_suggestion"}unistNodeName(){return ps.proseMirrorNodeName()}unistToProseMirrorTest(){return!1}unistNodeToProseMirrorNodes(e){return[null]}proseMirrorNodeSpec(){return{inline:!0,group:"inline",selectable:!0,isolating:!0,marks:"",allowGapCursor:!1,content:"text*",attrs:{[jn]:{default:null}},parseDOM:[],toDOM(e){var r;const n=(r=e.attrs)==null?void 0:r[jn];return["span",{class:"writing-block-generate-suggestion","data-generate-suggestion":typeof n=="string"?n:""},0]}}}proseMirrorNodeToUnistNodes(){return[]}}const Ke=new Rt("writingBlockGenerate"),Zt=yt.empty,il={input:null,suggestion:null,decorations:Zt,lastResolvedSuggestionId:null,lastResolvedReason:null},hs=t=>typeof t=="object"&&t!=null,ll=t=>hs(t)&&typeof t.anchorPos=="number"&&typeof t.caretPos=="number"&&typeof t.blockFrom=="number"&&typeof t.blockTo=="number"&&typeof t.triggerPos=="number"&&typeof t.directiveText=="string",al=t=>hs(t)&&typeof t.id=="string"&&typeof t.from=="number"&&typeof t.to=="number",cl=t=>t==="accept"||t==="reject"||t==="cancel",ul=t=>{if(!hs(t)||typeof t.type!="string")return!1;switch(t.type){case"set-suggestion":return al(t.suggestion);case"clear-suggestion":return cl(t.reason)&&(t.suggestionId==null||typeof t.suggestionId=="string");case"open-input":return ll(t.input);case"close-input":return!0;default:return!1}},dl=(t,e,n)=>{if(!e)return null;const o=t.map(e.anchorPos,1),s=t.map(e.caretPos,1),r=t.map(e.blockFrom,-1),i=t.map(e.blockTo,1),l=t.map(e.triggerPos,-1),a=typeof e.directiveText=="string"?e.directiveText:"";return r<0||r>=n.content.size||i<r?null:{anchorPos:o,caretPos:s,blockFrom:r,blockTo:i,triggerPos:l,directiveText:a}},fl=(t,e,n)=>{var l;if(!e)return null;const o=(l=n.type.schema.nodes.generate_suggestion)!=null?l:null;if(!o)return null;const s=t.map(e.from,-1);if(s<0||s>=n.content.size)return null;const r=n.nodeAt(s);if(!r||r.type!==o)return null;const i=s+r.nodeSize;return i<=s?null:{id:e.id,from:s,to:i}},Fs=t=>{var o;const e=(o=t.type.schema.nodes.generate_suggestion)!=null?o:null;if(!e)return null;let n=null;return t.descendants((s,r)=>{var l;if(n)return!1;if(s.type!==e)return!0;const i=(l=s.attrs)==null?void 0:l[jn];return typeof i!="string"||i.length===0||(n={id:i,from:r,to:r+s.nodeSize}),!1}),n},gl=()=>new St({key:Ke,state:{init:(t,e)=>{const n=Fs(e.doc);return lt(Ne({},il),{suggestion:n})},apply(t,e){let n=e.decorations.map(t.mapping,t.doc),o=dl(t.mapping,e.input,t.doc),s=fl(t.mapping,e.suggestion,t.doc),r=e.lastResolvedSuggestionId,i=e.lastResolvedReason;t.docChanged&&e.suggestion&&!s&&(r=e.suggestion.id,i="reject");const l=t.getMeta(Ke),a=ul(l)?l:null;t.docChanged&&(a==null?void 0:a.type)!=="set-suggestion"&&o&&(o=null),(a==null?void 0:a.type)==="open-input"&&(o=a.input,r=null,i=null),(a==null?void 0:a.type)==="close-input"&&(o=null),(a==null?void 0:a.type)==="set-suggestion"&&(s=a.suggestion,n=Zt,o=null,r=null,i=null),(a==null?void 0:a.type)==="clear-suggestion"&&(s?(r=s.id,i=a.reason):a.suggestionId&&(r=a.suggestionId,i=a.reason),s=null,n=Zt);const u=Fs(t.doc);return u?(s=u,(a==null?void 0:a.type)!=="set-suggestion"&&(r=null,i=null)):(a==null?void 0:a.type)!=="set-suggestion"&&(a==null?void 0:a.type)!=="clear-suggestion"&&(s=null),!s&&n!==Zt&&(n=Zt),{input:o,suggestion:s,decorations:n,lastResolvedSuggestionId:r,lastResolvedReason:i}}},props:{decorations(t){var e;return(e=Ke.getState(t))==null?void 0:e.decorations}}}),ml=(t,e)=>{const n={type:"open-input",input:e},o=t.state.tr.setMeta(Ke,n);t.dispatch(o)},Ws=t=>{var r,i;const e=Ke.getState(t.state);let n=t.state.tr;const o=(r=e==null?void 0:e.input)!=null?r:null;if(o){const l=n.doc,a=l.content.size,u=Math.max(0,Math.min(o.caretPos,a)),f=l.resolve(u),d=(i=Ie.findFrom(f,1,!0))!=null?i:Ie.near(f,1);n.selection.eq(d)||(n=n.setSelection(d))}const s={type:"close-input"};n=n.setMeta(Ke,s),t.dispatch(n),t.hasFocus()||t.focus()},pl=({view:t,suggestionId:e,text:n})=>{var I,E;const o=Ke.getState(t.state);if(!(o!=null&&o.input))return!1;const s=(I=t.state.schema.nodes.generate_suggestion)!=null?I:null;if(!s)return!1;const{caretPos:r,blockFrom:i,blockTo:l,triggerPos:a,anchorPos:u}=o.input;if(r<i||r>l)return!1;const f=(n!=null?n:"").replace(/\r?\n/g," "),d=Math.max(u,r);let m=t.state.tr;a<d&&(m=m.delete(a,d));const c=m.mapping.map(r,-1),h=f?t.state.schema.text(f):null,b=s.create({[jn]:e},h?_t.from(h):_t.empty);m=m.insert(c,_t.from(b));const k=c,_=c+b.nodeSize,C=(E=Ie.findFrom(m.doc.resolve(_),1,!0))!=null?E:Ie.near(m.doc.resolve(_),1);m=m.setSelection(C),m.setMeta(Ln,!0);const w={type:"set-suggestion",suggestion:{id:e,from:k,to:_}};return m.setMeta(Ke,w),t.dispatch(m),!0},hl=(t,e)=>{var f,d,m;const n=Ke.getState(t.state);if(!(n!=null&&n.suggestion)||n.suggestion.id!==e)return!1;const{from:o,to:s}=n.suggestion,r=(f=t.state.schema.nodes.generate_suggestion)!=null?f:null,i=t.state.doc.nodeAt(o);let l=t.state.tr,a=null;if(r&&(i==null?void 0:i.type)===r){const c=(d=i.textContent)!=null?d:"";if(c){const h=t.state.schema.text(c);l=l.replaceRangeWith(o,s,h),a=o+h.nodeSize}else l=l.delete(o,s),a=o}if(a!=null){const c=Math.max(0,Math.min(a,l.doc.content.size)),h=l.doc.resolve(c),b=(m=Ie.findFrom(h,1,!0))!=null?m:Ie.near(h,1);l=l.setSelection(b)}const u={type:"clear-suggestion",reason:"accept",suggestionId:e};return l=l.setMeta(Ke,u),l=l.scrollIntoView(),t.dispatch(l),!0},bl=(t,e)=>{const n=Ke.getState(t.state);if(!(n!=null&&n.suggestion)||n.suggestion.id!==e)return!1;const{from:o,to:s}=n.suggestion;let r=t.state.tr.delete(o,s);const i={type:"clear-suggestion",reason:"reject",suggestionId:e};return r=r.setMeta(Ke,i),t.dispatch(r),!0},Ut="magicEditId",Fn="magicEditHighlightFrom",Wn="magicEditHighlightTo";class Co extends Io{unistToProseMirrorTest(){return!1}unistNodeToProseMirrorNodes(e){return[null]}createNodeSpec({role:e,contentEditable:n}){return{attrs:{[Ut]:{default:null},[Fn]:{default:null},[Wn]:{default:null}},group:"block",content:"block+",isolating:!0,defining:!0,selectable:!1,allowGapCursor:!1,parseDOM:[],toDOM(o){var l;const s=(l=o.attrs)==null?void 0:l[Ut],i={"data-me-role":e,"data-me-id":typeof s=="string"?s:"","data-magic-edit-block":"true"};return n||(i.contenteditable="false",i["aria-readonly"]="true"),["div",i,0]}}}}class bs extends Co{static proseMirrorNodeName(){return"magic_edit_original_block"}unistNodeName(){return bs.proseMirrorNodeName()}proseMirrorNodeSpec(){return this.createNodeSpec({role:"orig",contentEditable:!1})}proseMirrorNodeToUnistNodes(e,n){return n}}class xs extends Co{static proseMirrorNodeName(){return"magic_edit_suggested_block"}unistNodeName(){return xs.proseMirrorNodeName()}proseMirrorNodeSpec(){return this.createNodeSpec({role:"sugg",contentEditable:!0})}proseMirrorNodeToUnistNodes(){return[]}}class xl extends xi{constructor(n={}){super();Rs(this,"options");this.options=n}dependencies(){let n=!1;try{n=or(rr())}catch(o){}return[new si,new wo,new oi,new os,new ri,new ii,new fs,new li,new ai,new rs,new ci,new ko,new us,new Ei,new Mi,new ds,new ui,new yi,new di,new fi,new gi,new bs,new xs,new ps,...n?[new mi]:[]]}unifiedInitializationHook(n){var s;const o=(s=this.options.contentReferences)!=null?s:[];return n.use(Ti).use(Si).use(Ri,{singleTilde:!1}).use(Ci).use([[ki,o]]).use(Qo).use(_i).use(Ii).use(pi).use(hi)}}const zs=new Map;function yl(t={}){var s,r;const e={shouldStripDirectives:(s=t.shouldStripDirectives)!=null?s:!1,contentReferences:(r=t.contentReferences)!=null?r:[]},n=JSON.stringify(e);let o=zs.get(n);if(o==null){const i=[new xl({contentReferences:e.contentReferences})];t.shouldStripDirectives&&i.push(new Jr),o=new Zr(i),zs.set(n,o)}return o}function El(t){return typeof t=="object"&&t!=null&&Object.prototype.hasOwnProperty.call(t,"maxLength")}const zt=new Rt("writingBlockInputConstraints");function Ml(t){return new St({key:zt,state:{init(){return{maxLength:t}},apply(e,n){const o=e.getMeta(zt);return El(o)?{maxLength:typeof o.maxLength=="number"?o.maxLength:null}:n}},props:{handleTextInput(e,n,o,s){var u;const r=zt.getState(e.state),i=(u=r==null?void 0:r.maxLength)!=null?u:null;if(i==null)return!1;const l=$s(e.state,i,n,o);if(l<=0)return!0;if(s.length<=l)return!1;const a=s.slice(0,l);return a.length>0&&e.dispatch(e.state.tr.insertText(a,n,o)),!0},handlePaste(e,n){var m,c,h;const o=zt.getState(e.state),s=(m=o==null?void 0:o.maxLength)!=null?m:null;if(s==null)return!1;const r=n.clipboardData;if(!r)return!1;const i=r.getData("text/html"),l=(c=r.getData("text/plain"))!=null?c:"",{from:a,to:u}=e.state.selection,f=$s(e.state,s,a,u);if(i){if(n.preventDefault(),f<=0)return!0;const b=new window.DOMParser().parseFromString(i,"text/html");Il(b.body);const k=(h=b.body.innerText)!=null?h:"";k.length>f&&(b.body.innerHTML="",b.body.append(document.createTextNode(k.slice(0,f))));const _=e.state.schema,C=ir.fromSchema(_).parseSlice(b.body,{preserveWhitespace:!0});return e.dispatch(e.state.tr.replaceSelection(C)),!0}if(l.length===0)return!1;if(f<=0)return n.preventDefault(),!0;if(l.length<=f)return!1;n.preventDefault();const d=l.slice(0,f);return e.dispatch(e.state.tr.insertText(d,a,u)),!0}}})}function _l(t,e){return t.setMeta(zt,{maxLength:typeof e=="number"?e:null})}function $s(t,e,n,o){const s=Sl(t.doc),r=kl(t,n,o);return e-(s-r)}function Sl(t){return t.textBetween(0,t.content.size,"\n","\n").length}function kl(t,e,n){return e===n?0:t.doc.textBetween(e,n,"\n","\n").length}function Il(t){const e=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT),n=[];for(;e.nextNode();){const o=e.currentNode;if(!(o instanceof HTMLElement))continue;const s=o;s.style&&(s.style.color="",s.style.backgroundColor="",s.style.fontFamily="",s.style.fontSize="",s.style.lineHeight="",s.style.textDecoration="",s.style.textShadow=""),(s.tagName==="SPAN"||s.tagName==="FONT")&&!s.hasAttributes()&&n.push(s)}for(const o of n.reverse()){const s=o.parentNode;if(s){for(;o.firstChild;)s.insertBefore(o.firstChild,o);s.removeChild(o)}}}const wl="_keyBindingTight_12obs_88",Tl="_keyBindingHighlight_12obs_96",Rl="_magicEditLabelHighlight_12obs_100",$t={"magic-edit-selection":"_magic-edit-selection_12obs_1",keyBindingTight:wl,keyBindingHighlight:Tl,magicEditLabelHighlight:Rl},ut=new Rt("writingBlockMagicEdit");function Hs(t){return typeof t=="object"&&t!=null}function Cl(t){if(t===void 0)return!0;if(!Hs(t))return!1;const{setPinnedRange:e,removeEntryId:n}=t,o=e==null||Hs(e)&&typeof e.from=="number"&&typeof e.to=="number",s=n==null||typeof n=="string";return o&&s}function No(t,e){if(!e)return null;const n=t.map(e.from,-1),o=t.map(e.to,1);return{from:n,to:o}}function Gs(t,e){if(!e)return null;const n=No(t,e);return!n||n.to<=n.from?null:n}function vo(t){var o,s;const e=(o=t.nodes.magic_edit_original_block)!=null?o:null,n=(s=t.nodes.magic_edit_suggested_block)!=null?s:null;return!e||!n?null:{originalType:e,suggestedType:n}}function Ks(t){if(typeof t=="number")return Number.isFinite(t)?t:null;if(typeof t=="string"&&t.trim()!==""){const e=Number(t);return Number.isFinite(e)?e:null}return null}function Nl(t,e){var i,l;const n=Ks((i=t.attrs)==null?void 0:i[Fn]),o=Ks((l=t.attrs)==null?void 0:l[Wn]);if(n==null||o==null)return null;const s=e+1+Math.max(0,n),r=e+1+Math.max(0,o);return r<=s?null:{from:s,to:r}}function is(t,e){if(!t)return null;const n=e.pos+1,o=e.pos+e.nodeSize-1,s=Math.max(n,t.from),r=Math.min(o,t.to);return r<=s?null:{from:s,to:r}}function Us(t){const e=vo(t.type.schema);if(!e)return new Map;const n=new Map;t.descendants((s,r)=>{var i;if(s.type===e.originalType||s.type===e.suggestedType){const l=(i=s.attrs)==null?void 0:i[Ut];if(!l)return!1;let a=n.get(l);a||(a={},n.set(l,a));const u={pos:r,nodeSize:s.nodeSize},f=is(Nl(s,r),u),d={position:u,highlight:f};return s.type===e.originalType?a.original=d:a.suggested=d,!1}return!0});const o=new Map;return n.forEach((s,r)=>{if(!s.original||!s.suggested)return;const i=Math.min(s.original.position.pos,s.suggested.position.pos),l=Math.max(s.original.position.pos+s.original.position.nodeSize,s.suggested.position.pos+s.suggested.position.nodeSize);o.set(r,{id:r,from:i,to:l,original:s.original.position,suggested:s.suggested.position,originalHighlight:s.original.highlight,suggestedHighlight:s.suggested.highlight})}),o}function qs(t,e,n){const o=[];return e&&o.push(Jt.inline(e.from,e.to,{class:"magic-edit-selection ".concat($t["magic-edit-selection"])})),n.forEach(s=>{s.originalHighlight&&o.push(Jt.inline(s.originalHighlight.from,s.originalHighlight.to,{nodeName:"span","data-me-change":"delta"})),s.suggestedHighlight&&o.push(Jt.inline(s.suggestedHighlight.from,s.suggestedHighlight.to,{nodeName:"span","data-me-change":"delta"}))}),o.length===0?yt.empty:yt.create(t,o)}function vl(){return new St({key:ut,state:{init:(t,e)=>{const n=Us(e.doc);return{pinnedRange:null,entries:n,decorations:qs(e.doc,null,n)}},apply(t,e,n,o){let s=No(t.mapping,e.pinnedRange);const r=new Map;e.entries.forEach((d,m)=>{r.set(m,{originalHighlight:Gs(t.mapping,d.originalHighlight),suggestedHighlight:Gs(t.mapping,d.suggestedHighlight)})});const i=t.getMeta(ut),l=Cl(i)?i:void 0;l&&l.setPinnedRange!==void 0&&(s=l.setPinnedRange),l!=null&&l.removeEntryId&&r.delete(l.removeEntryId);const a=Us(o.doc),u=new Map;a.forEach((d,m)=>{var k,_;if(l!=null&&l.removeEntryId&&l.removeEntryId===m)return;const c=r.get(m),h=is((k=c==null?void 0:c.originalHighlight)!=null?k:d.originalHighlight,d.original),b=is((_=c==null?void 0:c.suggestedHighlight)!=null?_:d.suggestedHighlight,d.suggested);u.set(m,{id:d.id,from:d.from,to:d.to,original:d.original,suggested:d.suggested,originalHighlight:h,suggestedHighlight:b})});const f=qs(o.doc,s,u);return{pinnedRange:s,entries:u,decorations:f}}},props:{decorations(t){var e,n;return(n=(e=ut.getState(t))==null?void 0:e.decorations)!=null?n:yt.empty}}})}function Pl(t){const{from:e,to:n}=t.state.selection;if(e===n)return!1;const o=t.state.tr;return o.setMeta(ut,{setPinnedRange:{from:e,to:n}}),t.dispatch(o),!0}function Dl(t){const e=t.state.tr;e.setMeta(ut,{setPinnedRange:null}),t.dispatch(e)}function Al({view:t,pmu:e,range:n,magicEditId:o,replacement:s}){var q;const{state:r}=t,i=vo(r.schema);if(!i)return!1;const l=r.doc.resolve(n.from),a=r.doc.resolve(n.to),u=r.doc.slice(n.from,n.to),f=(z,U,Y)=>Math.max(U,Math.min(Y,z)),d=()=>{if(l.parent.isTextblock&&a.parent.isTextblock){const U=l.before(),Y=a.after(),$=r.doc.slice(U,Y),V=r.schema.topNodeType.createAndFill({},$.content);if(V){const D="⟦MAGICSTART⟧",Z="⟦MAGICEND⟧",ee=n.from-U,ae=n.to-U,We=we=>new en(_t.from(r.schema.text(we)),0,0),ye=V.replace(ae,ae,We(Z)).replace(ee,ee,We(D)),_e=e.serialize(ye),be=_e.indexOf(D),de=_e.indexOf(Z);if(be!==-1&&de!==-1&&be<=de){const we=_e.slice(0,be)+(s!=null?s:"")+_e.slice(de+Z.length),Se=e.parse(we);return{deletionFrom:U,deletionTo:Y,anchorPos:U,originalSliceForNode:$,selectionRelStart:ee,selectionRelEnd:ae,suggestionSlice:new en(Se.content,0,0)}}}}const z=e.parse(s!=null?s:"");return{deletionFrom:n.from,deletionTo:n.to,anchorPos:n.from,originalSliceForNode:u,selectionRelStart:0,selectionRelEnd:u.content.size,suggestionSlice:z.slice(0,z.content.size)}},{deletionFrom:m,deletionTo:c,anchorPos:h,originalSliceForNode:b,selectionRelStart:k,selectionRelEnd:_,suggestionSlice:C}=d(),w=b.content.size,I=C.content.size,E=f(k,0,w),R=f(_,E,w),y=E,x=R,N=I-w,M=f(E,0,I),O=f(E+Math.max(0,R-E+N),M,I),T=x>y,v=O>M,S=i.originalType.create({[Ut]:o,[Fn]:T?Math.floor(y):null,[Wn]:T?Math.floor(x):null},b.content),A=i.suggestedType.create({[Ut]:o,[Fn]:v?Math.floor(M):null,[Wn]:v?Math.floor(O):null},C.content),P=new en(_t.fromArray([S,A]),0,0),W=r.tr.replaceRange(m,c,P);W.setMeta(Ln,!0),W.setMeta(ut,{setPinnedRange:null});const B=W.mapping.map(h,-1)+S.nodeSize,G=Math.min(W.doc.content.size,B+1),K=(q=Ie.findFrom(W.doc.resolve(G),1,!0))!=null?q:Ie.near(W.doc.resolve(G),1);return W.setSelection(K).scrollIntoView(),t.dispatch(W),!0}function Ol(t,e,n){var b;const o=ut.getState(t.state);if(!o)return;const s=o.entries.get(e);if(!s)return;const r=t.state.doc,i=r.nodeAt(s.original.pos),l=r.nodeAt(s.suggested.pos);if(!i||!l)return;const a=Math.min(s.original.pos,s.suggested.pos),u=Math.max(s.original.pos+i.nodeSize,s.suggested.pos+l.nodeSize),f=n==="keep"?i.content:l.content,d=new en(f,0,0),m=t.state.tr.replaceRange(a,u,d);m.setMeta(ut,{setPinnedRange:null,removeEntryId:e});const c=Math.min(m.doc.content.size,a+d.size),h=(b=Ie.findFrom(m.doc.resolve(c),-1,!0))!=null?b:Ie.near(m.doc.resolve(c),-1);m.setSelection(h),m.scrollIntoView(),t.dispatch(m)}function Po(t){const e=ut.getState(t.state);if(!e)return!1;const{from:n,to:o}=t.state.selection;if(n===o)return!1;for(const s of e.entries.values())if(n>=s.from&&o<=s.to)return!0;return!1}function Ll(t){var e,n;return(n=(e=ut.getState(t.state))==null?void 0:e.pinnedRange)!=null?n:null}function Vs(t){var r,i;const e=new Map,{nodes:n}=t.type.schema,o=(r=n.magic_edit_original_block)!=null?r:null,s=(i=n.magic_edit_suggested_block)!=null?i:null;return!o||!s||t.descendants((l,a)=>{var d,m;if(l.type!==o&&l.type!==s)return!0;const u=(d=l.attrs)==null?void 0:d[Ut];if(!u)return!1;const f=(m=e.get(u))!=null?m:{hasOriginal:!1,hasSuggested:!1};return l.type===o?f.hasOriginal=!0:f.hasSuggested=!0,e.set(u,f),!1}),e}function Bl(t){if(!t)return new Set;const e=t,n=new Set;return typeof e.removeEntryId=="string"&&n.add(e.removeEntryId),n}const jl=new Rt("writingBlockMagicEditGuard");function Fl(){return new St({key:jl,filterTransaction(t,e){if(!t.docChanged||t.getMeta(ei))return!0;const n=Bl(t.getMeta(ut)),o=Vs(e.doc),s=Vs(t.doc);for(const[r,i]of o){const l=s.get(r),a=n.has(r);if(!l){if(!a)return!1;continue}if(i.hasOriginal&&!l.hasOriginal&&!a||i.hasSuggested&&!l.hasSuggested&&!a)return!1}return!0}})}const Wl="\\[[^\\[\\]]+\\]";function zl(t){var s;const e=new RegExp(Wl,"g"),n=[];let o=e.exec(t);for(;o;){const r=(s=o.index)!=null?s:-1;r>=0&&n.push({start:r,end:r+o[0].length,text:o[0]}),o=e.exec(t)}return n}const $l={class:"text-token-text-primary cursor-text","data-placeholder-token":"true",style:"background-color: color-mix(in srgb, var(--selection) 20%, transparent); padding-top: 4px; padding-bottom: 4px;"};function Hl(t){return typeof t=="object"&&t!=null&&Object.prototype.hasOwnProperty.call(t,"isDisabled")}const Ht=new Rt("writingBlockPlaceholder");function Gl(t){return new St({key:Ht,state:{init(e,n){return{decorations:Ys(n.doc,t),isDisabled:t}},apply(e,n){var r,i;const o=e.getMeta(Ht),s=(i=(r=Hl(o)?o.isDisabled:void 0)!=null?r:n.isDisabled)!=null?i:t;return!e.docChanged&&s===n.isDisabled?n:{isDisabled:s,decorations:Ys(e.doc,s)}}},props:{decorations(e){var n,o;return(o=(n=Ht.getState(e))==null?void 0:n.decorations)!=null?o:null},handleDOMEvents:{mousedown(e,n){const o=n.target;if(!(o instanceof HTMLElement))return!1;const s=o.closest("[data-placeholder-token]");if(!(s instanceof HTMLElement))return!1;const r=Ht.getState(e.state);if(r!=null&&r.isDisabled)return!1;n.preventDefault(),e.hasFocus()||e.focus();const i=e.posAtDOM(s,0),l=e.posAtDOM(s,s.childNodes.length),a=on.create(e.state.doc,i,l);return e.dispatch(e.state.tr.setSelection(a)),!0}}}})}function Kl(t,e){return t.setMeta(Ht,{isDisabled:e})}function Ys(t,e){if(e)return yt.empty;const n=[];return t.descendants((o,s)=>{if(!o.type.isText||!o.text)return;const r=zl(o.text);for(const i of r){const l=s+i.start,a=s+i.end;n.push(Jt.inline(l,a,$l))}}),yt.create(t,n)}const ys=[{id:"paragraph",command:"text paragraph normal",messageKey:"text"},{id:"heading1",command:"heading1 h1 heading 1",messageKey:"heading1"},{id:"heading2",command:"heading2 h2 heading 2",messageKey:"heading2"},{id:"heading3",command:"heading3 h3 heading 3",messageKey:"heading3"},{id:"orderedList",command:"ordered list numbered",messageKey:"orderedList"},{id:"unorderedList",command:"unordered list bulleted",messageKey:"unorderedList"}];new Map(ys.map(t=>[t.id,t]));const Ul=ys.map(t=>t.id),ql=()=>ys,Vl=t=>({id:t.id,command:t.command,disabled:!1,messageKey:t.messageKey,kind:"text-style"}),Yl=ql().map(Vl),Es=[{id:"generate",command:"magic text generate",disabled:!1,messageKey:"generate",kind:"generate"},{id:"divider",command:"divider hr horizontal rule",disabled:!1,messageKey:"divider",kind:"divider"},...Yl],Do=new Map(Es.map(t=>[t.id,t])),Xl=["generate","divider",...Ul],Ao=t=>{var e;return(e=t==null?void 0:t.includeMagicTextOption)!=null?e:!0},Oo=(t,e)=>Ao(e)?t:t.filter(n=>n.id!=="generate"),Ql=(t,e)=>Ao(e)?[...t]:t.filter(n=>n!=="generate"),Zl=t=>Oo(Es,t),Jl=t=>{var e;return(e=Do.get(t))!=null?e:null},ea=t=>{var e,n;return(n=(e=Do.get(t))==null?void 0:e.disabled)!=null?n:!0},ta=t=>{const e=t.trim().toLowerCase();return e.startsWith("/")?e.slice(1):e},na=(t,e)=>t===""?Ql(Xl,e):Oo(Es,e).filter(n=>n.command.includes(t)).map(n=>n.id),qe=new Rt("writingBlockSlashMenu"),sa=t=>typeof t=="object"&&t!=null&&"type"in t,Kt={triggerPos:null,anchorPos:null,query:"",normalizedQuery:"",visibleOptionIds:[],highlightedOptionId:null},mt=t=>(t==null?void 0:t.triggerPos)!=null&&(t==null?void 0:t.anchorPos)!=null,oa=(t,e)=>{const n=t.selection;if(!n.empty||n.from<e||t.doc.textBetween(e,e+1,"\0","\0")!=="/")return!1;const s=t.doc.resolve(e),r=t.selection.$from;return s.parent===r.parent},Xs=(t,e,n)=>{var _,C,w,I,E,R;const o=t.doc,s=o.content.size,r=Math.min(e+1,s),i=(_=n==null?void 0:n.previousState)!=null?_:null,l=(w=(C=n==null?void 0:n.anchorOverride)!=null?C:i==null?void 0:i.anchorPos)!=null?w:null,a=l!=null?l:r,u=t.selection.from,f=u>=r?u:a,d=Math.min(Math.max(f,r),s),m=d<=r?"":o.textBetween(r,d,"\0","\0"),c=ta(m),h=na(c,{includeMagicTextOption:n==null?void 0:n.includeMagicTextOption}),b=(I=i==null?void 0:i.highlightedOptionId)!=null?I:null,k=b&&h.length>0?h.includes(b)?b:(E=h[0])!=null?E:null:(R=h[0])!=null?R:null;return{triggerPos:e,anchorPos:d,query:m,normalizedQuery:c,visibleOptionIds:h,highlightedOptionId:k}},ra=t=>new St({key:qe,state:{init:()=>Kt,apply(e,n,o,s){var u,f;const r=e.getMeta(qe),i=sa(r)?r:void 0;if((i==null?void 0:i.type)==="open")return Xs(s,i.triggerPos,{previousState:n,anchorOverride:i.anchorPos,includeMagicTextOption:t==null?void 0:t.includeMagicTextOption});if((i==null?void 0:i.type)==="close")return Kt;if((i==null?void 0:i.type)==="highlight"){if(!mt(n))return n;const d=i.commandId;return d==null?lt(Ne({},n),{highlightedOptionId:(u=n.visibleOptionIds[0])!=null?u:null}):n.visibleOptionIds.includes(d)?n.highlightedOptionId===d?n:lt(Ne({},n),{highlightedOptionId:d}):n}if((i==null?void 0:i.type)==="navigate"){if(!mt(n))return n;const d=n.visibleOptionIds;if(d.length===0)return n.highlightedOptionId==null?n:lt(Ne({},n),{highlightedOptionId:null});const m=i.direction==="previous"?-1:1,c=n.highlightedOptionId?d.indexOf(n.highlightedOptionId):-1,b=((c>=0?c:0)+m+d.length)%d.length;return d[b]===n.highlightedOptionId?n:lt(Ne({},n),{highlightedOptionId:(f=d[b])!=null?f:null})}if((i==null?void 0:i.type)==="execute"||!mt(n))return n;const l=n.triggerPos!=null?e.mapping.map(n.triggerPos,-1):null,a=n.anchorPos!=null?e.mapping.map(n.anchorPos,1):null;return l==null||a==null||!oa(s,l)?Kt:Xs(s,l,{previousState:lt(Ne({},n),{triggerPos:l,anchorPos:a}),includeMagicTextOption:t==null?void 0:t.includeMagicTextOption})}},props:{handleTextInput(e,n,o,s){const r=s.lastIndexOf("/");if(r===-1)return!1;const i=e.state.tr;i.insertText(s,n,o);const l=n+r,a=n+s.length;return e.dispatch(i.setMeta(qe,{type:"open",triggerPos:l,anchorPos:a})),!0},handleKeyDown(e,n){const o=qe.getState(e.state);if(n.key==="Escape"&&mt(o)){n.preventDefault(),n.stopPropagation();const s=e.state.tr.setMeta(qe,{type:"close"});return e.dispatch(s),!0}if(!o||!mt(o))return!1;if((n.key==="ArrowUp"||n.key==="ArrowDown")&&o.visibleOptionIds.length>0){n.preventDefault(),n.stopPropagation();const s=e.state.tr.setMeta(qe,{type:"navigate",direction:n.key==="ArrowUp"?"previous":"next"});return e.dispatch(s),!0}if(n.key==="Enter"){n.preventDefault(),n.stopPropagation();const s=o.highlightedOptionId;if(!s||ea(s))return!0;const r=e.state.tr.setMeta(qe,{type:"execute",commandId:s});return e.dispatch(r),!0}return!1}}}),nn=t=>{const e=qe.getState(t.state);if(!mt(e))return;const n=t.state.tr.setMeta(qe,{type:"close"});t.dispatch(n)},ia=Ae(()=>De(()=>import("./fyw02vlaiv2vq6cj.js").then(t=>t.zE),__vite__mapDeps([5,1,6,7,8])),{loading:t=>Oe(t)});function la({buttonText:t,triggerLabel:e,options:n,selectedOptionId:o,isOpen:s,onOpenChange:r,onSelect:i,preserveSelection:l,editorRef:a}){"use no forget";const u=p.useRef(null),[f,d]=p.useState(null);p.useEffect(()=>{const c=u.current;!c||typeof document>"u"||d(c.closest('[aria-hidden="true"]')!=null)},[]);const m=g.jsxs(g.Fragment,{children:[g.jsx("span",{className:"text-sm font-medium",children:t}),g.jsx(ia,{"aria-hidden":!0,className:"icon-sm text-current"})]});return f!==!1?g.jsx("div",{ref:u,"data-toolbar-surface":"true",className:"h-full",children:g.jsx(ct.Button,{type:"button","aria-label":e,"aria-haspopup":"menu","aria-expanded":s,tabIndex:-1,"data-state":s?"open":"closed",className:ce("text-token-text-primary flex h-full items-center gap-1 rounded-lg px-2.5","dark:hover:bg-token-interactive-bg-secondary-hover hover:bg-black/5",s&&"bg-token-interactive-bg-secondary-selected"),children:m})}):g.jsx("div",{ref:u,"data-toolbar-surface":"true",className:"h-full",children:g.jsxs(vr,{open:s,onOpenChange:c=>{c&&l(),r(c)},children:[g.jsx(Pr,{asChild:!0,children:g.jsx(ct.Button,{type:"button","aria-label":e,"aria-haspopup":"menu","aria-expanded":s,className:ce("text-token-text-primary flex h-full items-center gap-1 rounded-lg px-2.5","dark:hover:bg-token-interactive-bg-secondary-hover hover:bg-black/5","data-[state=open]:bg-token-interactive-bg-secondary-selected"),onMouseDown:c=>c.preventDefault(),onPointerDownCapture:l,onKeyDownCapture:c=>{(c.key===" "||c.key==="Enter")&&l()},children:m})}),g.jsx(Dr,{children:g.jsx(Ar,{align:"start",sideOffset:8,className:ce(Gn.toolbar,"popover","bg-token-main-surface-primary w-fit rounded-2xl p-1.5",To),"data-toolbar-surface":"true",onOpenAutoFocus:c=>c.preventDefault(),onCloseAutoFocus:c=>{var h;c.preventDefault(),(h=a.current)==null||h.focus({preventScroll:!0})},children:g.jsx("div",{className:"flex flex-col gap-0.5",role:"menu",children:n.map(c=>{const h=c.id===o;return g.jsx("button",{type:"button",role:"menuitemradio","aria-checked":h,"data-selected":h?"true":void 0,className:ce("text-token-text-primary dark:hover:bg-token-main-surface-secondary rounded-[10px] px-3 py-1.5 text-start text-sm hover:bg-[#f5f5f5]",h&&"dark:bg-token-main-surface-secondary bg-[#f5f5f5] font-medium"),onPointerDown:b=>b.preventDefault(),onClick:()=>i(c.id),children:g.jsx("span",{className:"flex items-center gap-2",children:g.jsx("span",{children:c.label})})},c.id)})})})})]})})}function Lo({onDismiss:t,editorView:e,toolbarContentRef:n,isToolbarOpen:o,dismissOnPointerDown:s=!0}){const r=p.useCallback(a=>{if(!(a instanceof Node))return!1;const u=n.current;return u&&u.contains(a)?!0:a instanceof Element?a.closest('[data-toolbar-surface="true"]')!=null:!1},[n]),i=p.useCallback(a=>{if(a.key!=="Escape"||!o)return;t();const u=e.dom;u&&u.focus({preventScroll:!0})},[e,o,t]),l=p.useCallback(a=>{r(a.target)||!o||t()},[r,o,t]);return p.useEffect(()=>{var u,f;const a=(f=(u=e.dom)==null?void 0:u.ownerDocument)!=null?f:typeof document<"u"?document:null;if(a)return a.addEventListener("keydown",i),s&&a.addEventListener("pointerdown",l,{capture:!0}),()=>{a.removeEventListener("keydown",i),s&&a.removeEventListener("pointerdown",l,!0)}},[s,e,i,l]),{handleKeyDown:i}}function Ms(t,e){return aa(t)(e)}const aa=go(()=>lr(t=>{const e=at(t),n=at(null),o=at(null),s=at(null),r=at(null),i=at(null),l=at(null),a=at(null),u=at([]),f=at("pending"),d=at(null);return{magicEditId$:e,domAnchor$:n,textAnchor$:o,baseBlockVersion$:s,freeformFeedback$:r,fullBlockBodyMarkdown$:i,startIndex$:l,endIndex$:a,replacements$:u,status$:f,modelSlug$:d}}));function ca(t,e){var i;const o=((i=t.dom.ownerDocument)!=null?i:document).createRange(),s=t.domAtPos(e.from),r=t.domAtPos(e.to);return o.setStart(s.node,s.offset),o.setEnd(r.node,r.offset),o}function ua(t,e,n){const o=t.resolve(e);if(o.parent.inlineContent)return e;const s=Ie.findFrom(o,n,!0);return s?n<0?s.to:s.from:null}function Qs(t,e,n,o,s){const r=ua(t,o,s);if(r==null)throw new Error("Unable to place selection marker.");const i=new en(_t.from(t.type.schema.text(n)),0,0),l=t.replace(r,r,i),u=e.serialize(l).indexOf(n);if(u===-1)throw new Error("Failed to locate selection marker in markdown.");return u}function Bo({view:t,pmu:e,range:n}){const{state:o}=t,s=o.doc,r=s.content.size,i=e.serialize(s),l=n.from<=0,a=n.to>=r,u=l?0:Qs(s,e,"⟦MAGICSTART⟧",n.from,1),f=a?i.length:Qs(s,e,"⟦MAGICEND⟧",n.to,-1);if(u>f)throw new Error("Failed to locate selection markers in markdown.");return{fullMarkdown:i,startIndex:u,endIndex:f}}function jo(){"use forget";const t=he.c(1);let e;return t[0]===Symbol.for("react.memo_cache_sentinel")?(e={mutationFn:da},t[0]=e):e=t[0],io(e)}async function da(t){const{payload:e}=t;return await as.safePost("/conversation/message/writing-blocks/magic-edit",{requestBody:e,authOption:uo.SendIfAvailable})}async function fa({view:t,pmu:e,ctx:n,range:o,instruction:s,numVariations:r,magicEditId:i}){let l;try{l=Bo({view:t,pmu:e,range:o})}catch(c){throw new Error("Unable to serialize the current selection for magic edit.")}const a=ca(t,o),u=Or(t.dom,a),f=Lr(l.fullMarkdown,l.startIndex,l.endIndex),d=await Br(l.fullMarkdown),m=Ms(n,i);return m.domAnchor$.set(u),m.textAnchor$.set(f),m.baseBlockVersion$.set(d),m.freeformFeedback$.set(s),m.fullBlockBodyMarkdown$.set(l.fullMarkdown),m.startIndex$.set(l.startIndex),m.endIndex$.set(l.endIndex),{payload:{full_block_body_markdown:l.fullMarkdown,start_index:l.startIndex,end_index:l.endIndex,instruction:s,num_variations:r},snapshot:{domAnchor:u,textAnchor:f,baseBlockVersion:d}}}function Fo(t){"use forget";const e=he.c(23),{view:n,pmu:o}=t,s=Ct(),r=Hn(),i=st(),l=p.useRef(null),a=p.useRef(null),u=p.useRef(null),{mutateAsync:f,isPending:d}=jo();let m;e[0]!==s||e[1]!==f?(m=async(y,x)=>{const N=await f({payload:y}),M=N.choices,O=Ms(s,x);return O.replacements$.set(M),O.modelSlug$.set(N.model_slug),O.status$.set("ready"),{replacements:M,magicEditId:x}},e[0]=s,e[1]=f,e[2]=m):m=e[2];const c=m;let h;e[3]!==s||e[4]!==c||e[5]!==i||e[6]!==o||e[7]!==r||e[8]!==n?(h=async y=>{var T;const{instruction:x,numVariations:N,range:M}=y,O=N===void 0?1:N;if(!M){const v=i.formatMessage({id:"zpmbDf",defaultMessage:"Highlight text in the block to use magic edit."});return r.danger(v,{duration:2}),null}try{const v=crypto.randomUUID();u.current=v;const{payload:S,snapshot:A}=await fa({view:n,pmu:o,ctx:s,range:M,instruction:x,numVariations:O,magicEditId:v});l.current=A,a.current=S;const P=await c(S,v);return ss("ChatGPT Writing Block Magic Edit Submitted","chatgpt_writing_block_magic_edit_submitted",{magicEditId:v}),P}catch(v){const S=v,A=(T=mo(S))!=null?T:i.formatMessage({id:"oSt4Kz",defaultMessage:"An error occured during magic edit."});return r.danger(A,{duration:2}),ss("ChatGPT Writing Block Magic Edit Failed","chatgpt_writing_block_magic_edit_failed",lt(Ne({},u.current?{magicEditId:u.current}:{}),{error:S instanceof Error?S.message:"Unknown error"})),null}},e[3]=s,e[4]=c,e[5]=i,e[6]=o,e[7]=r,e[8]=n,e[9]=h):h=e[9];const b=h;let k;e[10]!==c?(k=()=>!a.current||!u.current?Promise.resolve(null):c(a.current,u.current),e[10]=c,e[11]=k):k=e[11];const _=k;let C;e[12]!==o||e[13]!==n?(C=y=>{const{magicEditId:x,replacement:N,range:M}=y;if(!l.current||!M)return!1;const T=Al({view:n,pmu:o,range:M,magicEditId:x,replacement:N});return T&&(l.current=null),T},e[12]=o,e[13]=n,e[14]=C):C=e[14];const w=C;let I;e[15]!==n?(I=()=>Po(n),e[15]=n,e[16]=I):I=e[16];const E=I;let R;return e[17]!==w||e[18]!==d||e[19]!==_||e[20]!==E||e[21]!==b?(R={isLoading:d,submitMagicEdit:b,applyMagicEditResult:w,isSelectionInsideMagicEdit:E,retry:_},e[17]=w,e[18]=d,e[19]=_,e[20]=E,e[21]=b,e[22]=R):R=e[22],R}const ga=Ae(()=>De(()=>import("./mxg3f3sil9dynqw0.js"),__vite__mapDeps([9,1])),{loading:t=>Oe(t)}),ma=Ae(()=>De(()=>import("./fyw02vlaiv2vq6cj.js").then(t=>t.ze),__vite__mapDeps([5,1,6,7,8])),{loading:t=>Oe(t)});function Wo(t){"use forget";const e=he.c(43),{value:n,onChange:o,placeholder:s,onSubmit:r,onCancel:i,isLoading:l,submitAriaLabel:a,cancelAriaLabel:u,name:f,autoFocus:d,disabled:m,selectAllOnFocus:c,inputRef:h,inputClassName:b,onKeyDownCapture:k,isSubmitDisabled:_}=t,C=c===void 0?!1:c;let w;e[0]!==l||e[1]!==_||e[2]!==n?(w=!l&&(_!=null?_:n.trim()===""),e[0]=l,e[1]=_,e[2]=n,e[3]=w):w=e[3];const I=w;let E;e[4]!==o?(E=L=>o(L.target.value),e[4]=o,e[5]=E):E=e[5];let R;e[6]!==l||e[7]!==i||e[8]!==r?(R=()=>{if(l){i();return}r()},e[6]=l,e[7]=i,e[8]=r,e[9]=R):R=e[9];let y;e[10]!==b?(y=ce("mx-0! min-w-[300px]! ps-2.5! pe-9!",b),e[10]=b,e[11]=y):y=e[11];const x=m!=null?m:l;let N;e[12]!==k?(N=L=>{k==null||k(L)},e[12]=k,e[13]=N):N=e[13];let M;e[14]!==d||e[15]!==h||e[16]!==f||e[17]!==s||e[18]!==C||e[19]!==E||e[20]!==R||e[21]!==y||e[22]!==x||e[23]!==N||e[24]!==n?(M=g.jsx(ar,{ref:h,value:n,onChange:E,placeholder:s,onSubmit:R,border:!1,className:y,name:f,autoFocus:d,disabled:x,selectAllOnFocus:C,onKeyDownCapture:N}),e[14]=d,e[15]=h,e[16]=f,e[17]=s,e[18]=C,e[19]=E,e[20]=R,e[21]=y,e[22]=x,e[23]=N,e[24]=n,e[25]=M):M=e[25];const O=l?"menu-item-input-stop-btn":"composer-submit-btn";let T;e[26]!==O?(T=ce("icon",O),e[26]=O,e[27]=T):T=e[27];let v;e[28]!==l||e[29]!==i||e[30]!==r?(v=()=>{l?i():r()},e[28]=l,e[29]=i,e[30]=r,e[31]=v):v=e[31];const S=l?u:a;let A;e[32]!==l?(A=l?g.jsx(ga,{className:"icon"}):g.jsx(ma,{className:"icon-xs"}),e[32]=l,e[33]=A):A=e[33];let P;e[34]!==I||e[35]!==T||e[36]!==v||e[37]!==S||e[38]!==A?(P=g.jsx("div",{className:"absolute end-1.5 top-1/2 flex -translate-y-1/2 items-center justify-center",children:g.jsx("button",{className:T,onClick:v,disabled:I,"aria-label":S,"data-in-menu":!0,children:A})}),e[34]=I,e[35]=T,e[36]=v,e[37]=S,e[38]=A,e[39]=P):P=e[39];let W;return e[40]!==P||e[41]!==M?(W=g.jsxs("div",{className:"relative",children:[M,P]}),e[40]=P,e[41]=M,e[42]=W):W=e[42],W}function pa(t){"use forget";const e=he.c(48),{editorView:n,pmu:o,intl:s,isMagicEditOpen:r,toggleMagicEdit:i,isMagicEditDisabled:l,handleKeyDown:a,highlightMagicEdit:u}=t,f=u===void 0?!1:u,[d,m]=p.useState(""),c=p.useRef(null),h=p.useRef(!1);let b;e[0]!==n||e[1]!==o?(b={view:n,pmu:o},e[0]=n,e[1]=o,e[2]=b):b=e[2];const{isLoading:k,submitMagicEdit:_,applyMagicEditResult:C}=Fo(b);let w;e[3]!==C||e[4]!==n||e[5]!==d||e[6]!==_||e[7]!==i?(w=async L=>{var U;h.current=!1,L==null||L.preventDefault(),L==null||L.stopPropagation();const B=d.trim(),G=Ll(n);if(!B)return;const K=await _({instruction:B,range:G});if(!K||h.current)return;const q=(U=K.replacements[0])!=null?U:"";C({magicEditId:K.magicEditId,replacement:q,range:G})&&(m(""),i(!1))},e[3]=C,e[4]=n,e[5]=d,e[6]=_,e[7]=i,e[8]=w):w=e[8];const I=w;let E;e[9]!==i?(E=()=>{h.current=!0,i(!1)},e[9]=i,e[10]=E):E=e[10];const R=E;let y;e[11]!==s?(y=s.formatMessage({id:"hZs4Yo",defaultMessage:"Describe the edit"}),e[11]=s,e[12]=y):y=e[12];const x=y;let N;e[13]!==s?(N=s.formatMessage({defaultMessage:"Submit",id:"aria.submit"}),e[13]=s,e[14]=N):N=e[14];const M=N;let O;e[15]!==s?(O=s.formatMessage({defaultMessage:"Cancel",id:"aria.cancel"}),e[15]=s,e[16]=O):O=e[16];const T=O;let v;e[17]!==s?(v=s.formatMessage({id:"fO+eDT",defaultMessage:"Magic edit"}),e[17]=s,e[18]=v):v=e[18];const S=v;if(!r){const L=f?"font-semibold":"font-medium";let B;e[19]!==f||e[20]!==L?(B=ce(L,{[$t.magicEditLabelHighlight]:f}),e[19]=f,e[20]=L,e[21]=B):B=e[21];const G=B,K=f?"".concat($t.keyBindingTight," ").concat($t.keyBindingHighlight):$t.keyBindingTight;let q;e[22]===Symbol.for("react.memo_cache_sentinel")?(q=g.jsx(Mo,{binding:_o}),e[22]=q):q=e[22];let z;e[23]!==K?(z=g.jsx("span",{className:K,children:q}),e[23]=K,e[24]=z):z=e[24];let U;e[25]!==i?(U=()=>i(!0),e[25]=i,e[26]=U):U=e[26];let Y;e[27]!==l||e[28]!==G||e[29]!==S||e[30]!==z||e[31]!==U?(Y=g.jsx(ct.Action,{label:S,labelClassName:G,subLabel:z,onClick:U,onMouseDown:ha,isDisabled:l}),e[27]=l,e[28]=G,e[29]=S,e[30]=z,e[31]=U,e[32]=Y):Y=e[32];let $;e[33]===Symbol.for("react.memo_cache_sentinel")?($=g.jsx(ct.Separator,{}),e[33]=$):$=e[33];let V;return e[34]!==Y?(V=g.jsxs(g.Fragment,{children:[Y,$]}),e[34]=Y,e[35]=V):V=e[35],V}let A;e[36]!==d?(A=d.trim(),e[36]=d,e[37]=A):A=e[37];const P=A==="";let W;return e[38]!==T||e[39]!==a||e[40]!==R||e[41]!==I||e[42]!==k||e[43]!==d||e[44]!==x||e[45]!==M||e[46]!==P?(W=g.jsx(Wo,{inputRef:c,value:d,onChange:m,placeholder:x,onSubmit:I,onCancel:R,isLoading:k,submitAriaLabel:M,cancelAriaLabel:T,name:"writing-block-magic-edit-instruction",autoFocus:!0,disabled:k,selectAllOnFocus:!1,onKeyDownCapture:a,isSubmitDisabled:P}),e[38]=T,e[39]=a,e[40]=R,e[41]=I,e[42]=k,e[43]=d,e[44]=x,e[45]=M,e[46]=P,e[47]=W):W=e[47],W}function ha(t){return t.preventDefault()}const Mt=(t,e)=>{if(!e)return!1;const{$from:n}=t.state.selection;for(let o=n.depth;o>=0;o--)if(n.node(o).type===e)return!0;return!1},ba=(t,e,n)=>{const{$from:o}=t.state.selection;for(let s=o.depth;s>=0;s--){const r=o.node(s).type;if(r===e||r===n)return!0}return!1},Tt=(t,e,n,o)=>{if(!e)return;let s=t.state.selection.$from.depth;for(;s-- >0&&ba(t,n,o)&&So(e)(t.state,t.dispatch););},ls=(t,e)=>{const{state:n,dispatch:o}=t,s=n.schema,r=s.nodes[wo.proseMirrorNodeName()],i=s.nodes[fs.proseMirrorNodeName()],l=s.nodes[us.proseMirrorNodeName()],a=s.nodes[ds.proseMirrorNodeName()],u=s.nodes[ko.proseMirrorNodeName()],f=()=>{r&&Xn(r)(n,o)};switch(e){case"paragraph":{(Mt(t,l)||Mt(t,a))&&Tt(t,u,l,a),r&&Xn(r)(n,o);break}case"heading1":case"heading2":case"heading3":{const d=e==="heading1"?1:e==="heading2"?2:3;(Mt(t,l)||Mt(t,a))&&Tt(t,u,l,a),i&&Xn(i,{level:d})(n,o);break}case"orderedList":{Mt(t,l)?Tt(t,u,l,a):(Mt(t,a)&&Tt(t,u,l,a),f(),l&&Ds(l)(t.state,t.dispatch));break}case"unorderedList":{Mt(t,a)?Tt(t,u,l,a):(Mt(t,l)&&Tt(t,u,l,a),f(),a&&Ds(a)(t.state,t.dispatch));break}}},xa=(t,e)=>{var u,f;const n=qe.getState(t.state),o=(u=n==null?void 0:n.triggerPos)!=null?u:null,s=(f=n==null?void 0:n.anchorPos)!=null?f:null;if(o==null){ls(t,e),nn(t);return}const r=Math.max(o+1,s!=null?s:o+1);let i=t.state.tr.delete(o,r);const l=Math.max(Math.min(o,i.doc.content.size),0),a=on.create(i.doc,l);i=i.setSelection(a),t.dispatch(i),ls(t,e),nn(t)},ya=Ae(()=>De(()=>import("./jhjcbr6s6gbx7tjx.js"),__vite__mapDeps([10,1])),{loading:t=>Oe(t)}),Ea=Ae(()=>De(()=>import("./i5hk3dzmzsyxt4n2.js"),__vite__mapDeps([11,1])),{loading:t=>Oe(t)}),Dn=t=>({left:t.left,top:t.top,width:t.width,height:t.height}),An=.5,On=(t,e)=>Math.abs(t.left-e.left)<An&&Math.abs(t.top-e.top)<An&&Math.abs(t.width-e.width)<An&&Math.abs(t.height-e.height)<An,Ma=(t,e)=>t==null&&e==null?!0:t==null||e==null?!1:On(t,e),_a=12,Sa=250,gt=zn({bold:{id:"Z0FJiE",defaultMessage:"Bold"},italic:{id:"Ros0Mw",defaultMessage:"Italic"},textStylesTrigger:{id:"hngz+P",defaultMessage:"Text styles"},text:{id:"fGeL2E",defaultMessage:"Text"},heading1:{id:"Z1ugOp",defaultMessage:"Heading 1"},heading2:{id:"lVfGMg",defaultMessage:"Heading 2"},heading3:{id:"c55YcX",defaultMessage:"Heading 3"},heading1Glyph:{id:"QzkS3/",defaultMessage:"H1"},heading2Glyph:{id:"F2BLPp",defaultMessage:"H2"},heading3Glyph:{id:"SVuVmp",defaultMessage:"H3"},numberedList:{id:"IGi1BS",defaultMessage:"Numbered list"},bulletedList:{id:"EkLnA6",defaultMessage:"Bulleted list"},magicEditSelectNux:{id:"H/xkLi",defaultMessage:"Ask ChatGPT for changes to any selection with Magic Edit"}}),ka=({editorView:t,intl:e,isMagicEditEnabled:n,hasActiveMagicEditEntry:o,pmu:s,toolbarContentRef:r,onToolbarOpenChange:i,onMagicEditInvoked:l,highlightMagicEdit:a=!1})=>{"use no forget";const u=Ct(),f=p.useRef(null),d=r!=null?r:f,[m,c]=p.useState(!1);p.useEffect(()=>{i==null||i(m)},[m,i]);const[h,b]=p.useState(!1),[k,_]=p.useState(!1),C=o||k,[w,I]=p.useState(!1),E=p.useRef(null),R=p.useCallback(()=>t.dom,[t]),y=p.useRef(null),x=p.useRef(null),[N,M]=p.useState(0),O=p.useRef(!1),T=p.useRef(null),[v,S]=p.useState(!1),[A,P]=p.useState(!1),[W,L]=p.useState("paragraph"),B=p.useCallback(F=>{const H=y.current;H==null&&F==null||H!=null&&F!=null&&On(H.selectionRect,F.selectionRect)&&On(H.editorRect,F.editorRect)&&On(H.containerRect,F.containerRect)&&Ma(H.caretRect,F.caretRect)&&H.isFocusAtEnd===F.isFocusAtEnd||(y.current=F,M(se=>se+1))},[]),G=p.useCallback(()=>{var je,ke,Te,fe,pe;const F=t.state,{from:H,to:J,empty:se,$from:ue}=F.selection,Ee=F.schema.marks[os.proseMirrorMarkName()],Le=F.schema.marks[rs.proseMirrorMarkName()];if(se){const re=(je=F.storedMarks)!=null?je:ue.marks(),oe=!!Ee&&!!(re!=null&&re.find(Pe=>Pe.type===Ee)),$e=!!Le&&!!(re!=null&&re.find(Pe=>Pe.type===Le));S(oe),P($e)}else{const re=F.doc.textBetween(H,J,"\n","\n"),oe=(Te=(ke=re.match(/^\s*/))==null?void 0:ke[0].length)!=null?Te:0,$e=(pe=(fe=re.match(/\s*$/))==null?void 0:fe[0].length)!=null?pe:0,Pe=H+oe,dt=J-$e;if(Pe>=dt)S(!1),P(!1);else{let He=!1,ot=!0,ft=!0;F.doc.nodesBetween(Pe,dt,Qe=>{var pt;if(Qe.isText){if(!((pt=Qe.text)!=null?pt:"").trim())return!0;He=!0;const Ze=!!Ee&&Qe.marks.some(rt=>rt.type===Ee),Je=!!Le&&Qe.marks.some(rt=>rt.type===Le);if(Ze||(ot=!1),Je||(ft=!1),!ot&&!ft)return!1}return!0}),S(He&&ot),P(He&&ft)}}let me="paragraph";const Be=F.schema.nodes[fs.proseMirrorNodeName()],Ye=F.schema.nodes[us.proseMirrorNodeName()],ve=F.schema.nodes[ds.proseMirrorNodeName()];for(let re=ue.depth;re>=0;re--){const oe=ue.node(re);if(oe.type===Ye){me="orderedList";break}if(oe.type===ve){me="unorderedList";break}if(oe.type===Be){const $e=Number(oe.attrs.level);$e===1?me="heading1":$e===2?me="heading2":me="heading3";break}}L(me)},[t]),K=p.useCallback(()=>{if(typeof window>"u")return;x.current!=null&&window.cancelAnimationFrame(x.current);const F=O.current;x.current=window.requestAnimationFrame(()=>{var ke;if(x.current=null,F)return;const H=t.dom;if(!H){B(null);return}_(Po(t));const J=window.getSelection();if(!J||J.rangeCount===0||J.isCollapsed){G(),B(null);return}const se=J.getRangeAt(0);if(!se||!H.contains(se.commonAncestorContainer)){G(),B(null);return}G();const ue=se.getBoundingClientRect();if(!ue||ue.width===0&&ue.height===0){B(null);return}const Ee=H.getBoundingClientRect(),me=((ke=H.offsetParent instanceof HTMLElement?H.offsetParent:H.parentElement)!=null?ke:H).getBoundingClientRect();let Be=null,Ye=!1;const{focusNode:ve,focusOffset:je}=J;if(ve!=null){try{const Te=document.createRange();Te.setStart(ve,je),Te.setEnd(ve,je);const fe=Te.getBoundingClientRect();fe&&(Be=Dn(fe))}catch(Te){Be=null}try{Ye=ve===se.endContainer&&je===se.endOffset}catch(Te){Ye=!1}}B({selectionRect:Dn(ue),caretRect:Be,editorRect:Dn(Ee),containerRect:Dn(me),isFocusAtEnd:Ye})})},[B,t,G]);p.useEffect(()=>{if(typeof document>"u"||typeof window>"u")return;const F=()=>{K()},H=()=>{K()};return document.addEventListener("selectionchange",F),window.addEventListener("resize",H),window.addEventListener("scroll",H,!0),K(),()=>{document.removeEventListener("selectionchange",F),window.removeEventListener("resize",H),window.removeEventListener("scroll",H,!0),x.current!=null&&(window.cancelAnimationFrame(x.current),x.current=null)}},[K]);const q=p.useCallback(F=>{const H=y.current;if(!H)return null;const{selectionRect:J,editorRect:se,containerRect:ue}=H,Ee=8,Le=J.left-se.left,me=J.width>0?J.width:F.width,Be=se.width,Ye=se.left-ue.left,ve=Le+me/2-F.width/2,ke=Math.min(Math.max(ve,0),Math.max(Be-F.width,0))+Ye,Te=J.top-se.top,fe=se.top-ue.top,re=Te-F.height-Ee+fe,oe=Ni.ABOVE;return{left:ke,top:re,aboveOrBelow:oe,toolbarSize:F}},[t,N]),z=p.useCallback(()=>{const{state:F,dispatch:H}=t,{selection:J}=F;if(J.empty)return;const se=Math.min(J.to,F.doc.content.size),ue=F.doc.resolve(se),Ee=Ie.near(ue,-1);Ee.eq(J)||H(F.tr.setSelection(Ee))},[t]),U=p.useCallback(()=>{var J,se,ue;const F=(se=(J=t.dom)==null?void 0:J.ownerDocument)!=null?se:typeof document<"u"?document:null,H=(ue=F==null?void 0:F.getSelection)==null?void 0:ue.call(F);H&&H.removeAllRanges()},[t]),Y=p.useCallback(()=>{z(),U()},[z,U]),$=p.useCallback(F=>{F?(h||l==null||l(),Pl(t),I(!0),b(!0)):(Dl(t),I(!1),b(!1))},[t,h,l]),V=p.useCallback(()=>{$(!1),Y()},[$,Y]),{handleKeyDown:D}=Lo({editorView:t,toolbarContentRef:d,isToolbarOpen:m,onDismiss:V}),Z=p.useCallback((F,H)=>{const J=t.dom;if(!J)return;const se=(H==null?void 0:H.maintainToolbarPosition)===!0;O.current=!0,typeof window<"u"&&T.current&&(window.clearTimeout(T.current),T.current=null),J.focus({preventScroll:!0});try{F(),G()}finally{typeof window<"u"?T.current=window.setTimeout(()=>{O.current=!1,T.current=null,se||K()},0):O.current=!1}},[t,K,G]),ee=p.useCallback(F=>{Z(()=>{const{state:H,dispatch:J}=t,se=H.schema.marks[F];se&&bi(H,J,se)},{maintainToolbarPosition:!0})},[t,Z]);p.useEffect(()=>()=>{typeof window<"u"&&T.current!=null&&(window.clearTimeout(T.current),T.current=null)},[]),p.useEffect(()=>{if(!n)return;const F=()=>{E.current&&(E.current.action(),E.current.limitToGroups(),E.current=null)};if(m&&!C){const{addAction:H,limitActionGroups:J}=cr(u);E.current={action:H({key:"magicEdit",action:()=>$(!0),actionMessageDescriptor:e.formatMessage({id:"MWHvyw",defaultMessage:"Toggle magic edit"}),group:vs.Chat,keyboardBinding:_o}),limitToGroups:J([vs.Chat])}}else F();return()=>{F()}},[u,e,n,m,C,$]);const ae=p.useCallback(F=>{Z(()=>{ls(t,F)})},[t,Z]),We=p.useMemo(()=>[{id:"paragraph",label:e.formatMessage(gt.text)},{id:"heading1",label:e.formatMessage(gt.heading1)},{id:"heading2",label:e.formatMessage(gt.heading2)},{id:"heading3",label:e.formatMessage(gt.heading3)},{id:"orderedList",label:e.formatMessage(gt.numberedList)},{id:"unorderedList",label:e.formatMessage(gt.bulletedList)}],[e]),ye=e.formatMessage(gt.textStylesTrigger),[_e,be]=p.useState(!1),de=p.useRef(null),we=p.useCallback(()=>{if(typeof window>"u"){de.current=null;return}const F=window.getSelection();if(!F||F.rangeCount===0){de.current=null;return}de.current=F.getRangeAt(0).cloneRange()},[]),Se=p.useCallback(()=>{if(typeof window>"u")return;const F=de.current;if(!F)return;const H=window.getSelection();H&&(H.removeAllRanges(),H.addRange(F))},[]);p.useEffect(()=>{_e||(de.current=null)},[_e]);const Ve=p.useMemo(()=>{const F=We.find(H=>H.id===W);return F?F.label:e.formatMessage(gt.text)},[W,e,We]),ze=e.formatMessage(gt.magicEditSelectNux),xe=a&&m&&!h;return g.jsxs(g.Fragment,{children:[g.jsxs(vi,{showAskChatGPT:!1,toolbarType:gs.WRITING,getEditorDom:R,getSelectionRange:()=>null,getToolbarPosition:q,savedSelection:w,toolbarContentRef:d,setIsToolbarOpen:c,isSendDisabled:!0,children:[n&&g.jsx(pa,{editorView:t,pmu:s,intl:e,isMagicEditOpen:h,toggleMagicEdit:$,isMagicEditDisabled:C,handleKeyDown:D,highlightMagicEdit:a}),!h&&g.jsxs(g.Fragment,{children:[g.jsx(ct.Action,{label:e.formatMessage(gt.bold),hideLabel:!0,icon:Ea,onClick:()=>ee(os.proseMirrorMarkName()),onMouseDown:F=>F.preventDefault(),isActive:v}),g.jsx(ct.Action,{label:e.formatMessage(gt.italic),hideLabel:!0,icon:ya,onClick:()=>ee(rs.proseMirrorMarkName()),onMouseDown:F=>F.preventDefault(),isActive:A}),g.jsx(ct.Separator,{}),g.jsx(la,{buttonText:Ve,editorRef:{current:t.dom},selectedOptionId:W,isOpen:_e,onOpenChange:F=>{F?we():de.current=null,be(F)},onSelect:F=>{Se(),ae(F),be(!1),V()},options:We,preserveSelection:we,triggerLabel:ye})]})]}),g.jsx(Ia,{toolbarRef:d,message:ze,isVisible:xe})]})},Ia=t=>{"use forget";const e=he.c(22),{toolbarRef:n,message:o,isVisible:s,transitionDurationMs:r}=t,i=r===void 0?Sa:r,[l,a]=p.useState(null);let u;e[0]!==s?(u=()=>s,e[0]=s,e[1]=u):u=e[1];const[f,d]=p.useState(u);let m;e[2]!==s?(m=()=>s,e[2]=s,e[3]=m):m=e[3];const[c,h]=p.useState(m);let b,k;e[4]!==s||e[5]!==i?(b=()=>{if(typeof window>"u")return;if(s){let M=null;const O=window.requestAnimationFrame(()=>{d(!0),M=window.requestAnimationFrame(()=>{h(!0)})});return()=>{M!=null&&window.cancelAnimationFrame(M),window.cancelAnimationFrame(O)}}const x=window.requestAnimationFrame(()=>{h(!1)}),N=window.setTimeout(()=>{d(!1),a(null)},i);return()=>{window.cancelAnimationFrame(x),window.clearTimeout(N)}},k=[s,i],e[4]=s,e[5]=i,e[6]=b,e[7]=k):(b=e[6],k=e[7]),p.useEffect(b,k);let _,C;if(e[8]!==s||e[9]!==n?(_=()=>{if(!s||typeof window>"u"||typeof document>"u")return;const x=n.current;if(!x){const T=()=>{a(null)};typeof queueMicrotask=="function"?queueMicrotask(T):window.requestAnimationFrame(T);return}const N=()=>{const T=x.getBoundingClientRect();a({left:T.left+T.width/2,top:T.top-_a})};typeof queueMicrotask=="function"?queueMicrotask(N):N(),window.addEventListener("resize",N),document.addEventListener("scroll",N,!0);let M=null;typeof ResizeObserver<"u"&&(M=new ResizeObserver(()=>{N()}),M.observe(x));let O=null;return typeof MutationObserver<"u"&&(O=new MutationObserver(()=>{N()}),O.observe(x,{attributes:!0,attributeFilter:["style","class"]})),()=>{window.removeEventListener("resize",N),document.removeEventListener("scroll",N,!0),M==null||M.disconnect(),O==null||O.disconnect()}},C=[s,n],e[8]=s,e[9]=n,e[10]=_,e[11]=C):(_=e[10],C=e[11]),p.useEffect(_,C),!f||l==null||typeof document>"u"||!document.body)return null;const w="pointer-events-none fixed z-[60] -translate-x-1/2 -translate-y-full transition-opacity ".concat(c?"opacity-100":"opacity-0"),I="".concat(i,"ms");let E;e[12]!==l.left||e[13]!==l.top||e[14]!==I?(E={left:l.left,top:l.top,transitionDuration:I},e[12]=l.left,e[13]=l.top,e[14]=I,e[15]=E):E=e[15];let R;e[16]!==o?(R=g.jsx("div",{className:"rounded-lg bg-[#007aff] px-3 py-1 text-center text-xs font-semibold text-white shadow-[0_6px_16px_rgba(0,122,255,0.25)]",children:o}),e[16]=o,e[17]=R):R=e[17];let y;return e[18]!==E||e[19]!==R||e[20]!==w?(y=Vo.createPortal(g.jsx("div",{className:w,style:E,children:R}),document.body),e[18]=E,e[19]=R,e[20]=w,e[21]=y):y=e[21],y},wa="calc(300px + 1rem)",ts=zn({placeholder:{id:"0bHFVY",defaultMessage:"Describe what to generate"},cancelLabel:{id:"dFfo1P",defaultMessage:"Cancel"},submitLabel:{id:"4jyv9s",defaultMessage:"Submit"}});function Ta(t){"use forget";const e=he.c(47),{value:n,onChange:o,onSubmit:s,onCancel:r,isLoading:i,anchorPos:l,editorView:a,editorRootRef:u}=t,f=st(),d=p.useRef(null),m=p.useRef(null);let c;e[0]!==u?(c=(z,U,Y)=>{var $;return yo(($=u.current)!=null?$:z,U,Y,{ancestorResize:!0,ancestorScroll:!0})},e[0]=u,e[1]=c):c=e[1];const h=c;let b;e[2]===Symbol.for("react.memo_cache_sentinel")?(b=[po(8),ho({fallbackPlacements:["top-start"]}),bo({padding:8})],e[2]=b):b=e[2];let k;e[3]!==h?(k={placement:"bottom-start",middleware:b,whileElementsMounted:h},e[3]=h,e[4]=k):k=e[4];const{refs:_,floatingStyles:C,update:w}=xo(k),I=_.setReference,E=_.setFloating;let R,y;e[5]!==l||e[6]!==u||e[7]!==a||e[8]!==I||e[9]!==w?(R=()=>{var U;if(!a||l==null){I(null);return}const z={contextElement:(U=u.current)!=null?U:void 0,getBoundingClientRect:()=>{try{const Y=a.coordsAtPos(l);return new DOMRect(Y.left,Y.bottom,0,0)}catch(Y){return new DOMRect}}};return I(z),w(),()=>{I(null)}},y=[l,u,a,I,w],e[5]=l,e[6]=u,e[7]=a,e[8]=I,e[9]=w,e[10]=R,e[11]=y):(R=e[10],y=e[11]),p.useEffect(R,y);let x,N;e[12]!==r?(x=()=>{const z=Y=>{const $=d.current;$&&(Y.target instanceof Node&&$.contains(Y.target)||r())},U=Y=>{const $=d.current;if(!$){r();return}Y.target instanceof Node&&$.contains(Y.target)||r()};return document.addEventListener("pointerdown",z,!0),document.addEventListener("focusin",U,!0),()=>{document.removeEventListener("pointerdown",z,!0),document.removeEventListener("focusin",U,!0)}},N=[r],e[12]=r,e[13]=x,e[14]=N):(x=e[13],N=e[14]),p.useEffect(x,N);let M,O;e[15]===Symbol.for("react.memo_cache_sentinel")?(M=()=>{var z;(z=m.current)==null||z.focus()},O=[],e[15]=M,e[16]=O):(M=e[15],O=e[16]),p.useEffect(M,O);let T;e[17]!==E?(T=z=>{d.current=z,E(z)},e[17]=E,e[18]=T):T=e[18];let v;e[19]===Symbol.for("react.memo_cache_sentinel")?(v=ce(Gn.toolbar,"absolute"),e[19]=v):v=e[19];let S;e[20]!==C?(S=lt(Ne({},C),{width:"max-content",minWidth:wa}),e[20]=C,e[21]=S):S=e[21];let A;e[22]!==f?(A=f.formatMessage(ts.placeholder),e[22]=f,e[23]=A):A=e[23];let P;e[24]!==f?(P=f.formatMessage(ts.submitLabel),e[24]=f,e[25]=P):P=e[25];let W;e[26]!==f?(W=f.formatMessage(ts.cancelLabel),e[26]=f,e[27]=W):W=e[27];let L;e[28]!==r?(L=z=>{z.key==="Escape"&&(z.preventDefault(),r())},e[28]=r,e[29]=L):L=e[29];let B;e[30]!==n?(B=n.trim(),e[30]=n,e[31]=B):B=e[31];const G=B==="";let K;e[32]!==i||e[33]!==r||e[34]!==o||e[35]!==s||e[36]!==A||e[37]!==P||e[38]!==W||e[39]!==L||e[40]!==G||e[41]!==n?(K=g.jsx(ct,{toolbarType:gs.WRITING,children:g.jsx("div",{className:"flex min-w-0 flex-1",children:g.jsx(Wo,{inputRef:m,value:n,onChange:o,placeholder:A,onSubmit:s,onCancel:r,isLoading:i,submitAriaLabel:P,cancelAriaLabel:W,autoFocus:!0,disabled:i,selectAllOnFocus:!1,onKeyDownCapture:L,isSubmitDisabled:G,inputClassName:"w-full"})})}),e[32]=i,e[33]=r,e[34]=o,e[35]=s,e[36]=A,e[37]=P,e[38]=W,e[39]=L,e[40]=G,e[41]=n,e[42]=K):K=e[42];let q;return e[43]!==T||e[44]!==S||e[45]!==K?(q=g.jsx("div",{ref:T,className:v,style:S,children:K}),e[43]=T,e[44]=S,e[45]=K,e[46]=q):q=e[46],q}const Zs=zn({accept:{id:"9u4W5n",defaultMessage:"Accept"},reject:{id:"ClnYCK",defaultMessage:"Undo"}}),Ra=8,Ca=[jr.Mod,"Enter"];function Js(t){"use forget";const e=he.c(58),{editorView:n,editorRootRef:o,activeEntryId:s,onAccept:r,onReject:i,findSuggestionElement:l}=t,a=st(),[u,f]=Pi(),{width:d}=u,m=p.useRef(null),[c,h]=p.useState(null),b=Ct();let k;e[0]===Symbol.for("react.memo_cache_sentinel")?(k=$=>{h(V=>{const D=V==null,Z=$==null;return D&&Z||!D&&!Z&&V.left===$.left&&V.top===$.top?V:$})},e[0]=k):k=e[0];const _=k;let C;e[1]!==s||e[2]!==l||e[3]!==o?(C=()=>{if(l)return l(o.current,s);const $=o.current;if(!$||!s)return null;const V=$.querySelectorAll("[data-me-role='sugg']");for(const D of V)if(D.dataset.meId===s)return D;return null},e[1]=s,e[2]=l,e[3]=o,e[4]=C):C=e[4];const w=C;let I;e[5]!==s||e[6]!==o||e[7]!==w||e[8]!==d?(I=()=>{var ye,_e;if(!s){_(null);return}const $=o.current,V=w();if(!$||!V){_(null);return}const D=$.getBoundingClientRect(),Z=V.getBoundingClientRect(),ee=(_e=d!=null?d:(ye=m.current)==null?void 0:ye.offsetWidth)!=null?_e:Z.width,ae=Math.max(0,(D.width-ee)/2),We=Z.bottom-D.top+Ra;_({left:ae,top:We})},e[5]=s,e[6]=o,e[7]=w,e[8]=d,e[9]=I):I=e[9];const E=I;let R,y;e[10]!==E?(R=()=>{E()},y=[E],e[10]=E,e[11]=R,e[12]=y):(R=e[11],y=e[12]),ns(R,y);let x,N;e[13]!==s||e[14]!==E?(x=()=>{if(!s)return;const $=()=>{E()};return window.addEventListener("resize",$),window.addEventListener("scroll",$,!0),()=>{window.removeEventListener("resize",$),window.removeEventListener("scroll",$,!0)}},N=[s,E],e[13]=s,e[14]=E,e[15]=x,e[16]=N):(x=e[15],N=e[16]),p.useEffect(x,N);const M=s!=null&&c!=null;let O;e[17]!==n||e[18]!==M||e[19]!==i?(O={editorView:n,toolbarContentRef:m,isToolbarOpen:M,onDismiss:i,dismissOnPointerDown:!1},e[17]=n,e[18]=M,e[19]=i,e[20]=O):O=e[20],Lo(O);let T;e[21]!==s||e[22]!==o||e[23]!==r?(T=()=>{var D,Z;if(!s)return;const $=(Z=(D=o.current)==null?void 0:D.ownerDocument)!=null?Z:document,V=ee=>{ur(ee)||dr(ee)!==fr()||ee.key!=="Enter"||(ee.preventDefault(),r())};return $.addEventListener("keydown",V,!0),()=>{$.removeEventListener("keydown",V,!0)}},e[21]=s,e[22]=o,e[23]=r,e[24]=T):T=e[24];let v;e[25]!==s||e[26]!==b||e[27]!==o||e[28]!==a||e[29]!==r?(v=[s,o,r,b,a],e[25]=s,e[26]=b,e[27]=o,e[28]=a,e[29]=r,e[30]=v):v=e[30],p.useEffect(T,v);let S;e[31]!==a?(S=a.formatMessage(Zs.reject),e[31]=a,e[32]=S):S=e[32];let A;e[33]===Symbol.for("react.memo_cache_sentinel")?(A=g.jsx("span",{className:"text-token-text-tertiary ms-1.5 text-sm font-medium",children:g.jsx(Ge,{id:"R6HH9/",defaultMessage:"ESC"})}),e[33]=A):A=e[33];let P;e[34]!==i||e[35]!==S?(P=g.jsx(ct.Action,{label:S,onClick:i,labelClassName:"font-semibold text-black! dark:text-gray-400!",iconClassName:"text-black! dark:text-gray-400!",subLabel:A}),e[34]=i,e[35]=S,e[36]=P):P=e[36];let W;e[37]===Symbol.for("react.memo_cache_sentinel")?(W=g.jsx(ct.Separator,{}),e[37]=W):W=e[37];let L;e[38]!==a?(L=a.formatMessage(Zs.accept),e[38]=a,e[39]=L):L=e[39];let B;e[40]===Symbol.for("react.memo_cache_sentinel")?(B=g.jsx("span",{className:ce($t.keyBindingTight,"ms-1.5"),children:g.jsx(Mo,{binding:Ca})}),e[40]=B):B=e[40];let G;e[41]!==r||e[42]!==L?(G=g.jsx(ct.Action,{label:L,onClick:r,labelClassName:"font-semibold text-blue-400!",iconClassName:"text-blue-400!",subLabel:B}),e[41]=r,e[42]=L,e[43]=G):G=e[43];let K;e[44]!==P||e[45]!==G?(K=g.jsxs(ct,{toolbarType:gs.WRITING,children:[P,W,G]}),e[44]=P,e[45]=G,e[46]=K):K=e[46];const q=K;if(!M)return null;let z;e[47]!==s||e[48]!==f||e[49]!==q?(z=s&&g.jsx("div",{"aria-hidden":"true",className:"pointer-events-none invisible fixed start-0 top-0 h-0 overflow-clip",children:g.jsx("div",{ref:f,children:q})}),e[47]=s,e[48]=f,e[49]=q,e[50]=z):z=e[50];let U;e[51]!==M||e[52]!==c||e[53]!==q?(U=M&&g.jsx("div",{ref:$=>{m.current=$},style:{left:c?c.left:0,top:c?c.top:0},className:ce("absolute",Gn.toolbar),children:q}),e[51]=M,e[52]=c,e[53]=q,e[54]=U):U=e[54];let Y;return e[55]!==z||e[56]!==U?(Y=g.jsxs(g.Fragment,{children:[z,U]}),e[55]=z,e[56]=U,e[57]=Y):Y=e[57],Y}const eo=zn({text:{id:"+lD8Gj",defaultMessage:"Text"},heading1:{id:"rIYI87",defaultMessage:"Heading 1"},heading2:{id:"TDeCdX",defaultMessage:"Heading 2"},heading3:{id:"g1V+cN",defaultMessage:"Heading 3"},orderedList:{id:"rCWWta",defaultMessage:"Numbered list"},unorderedList:{id:"TxDV7n",defaultMessage:"Bulleted list"},divider:{id:"5lM+d4",defaultMessage:"Divider"},generate:{id:"/qteYH",defaultMessage:"Magic text"},menuLabel:{id:"ZmuIH8",defaultMessage:"Insert options"}}),Na="text-token-text-primary hover:text-token-text-primary dark:hover:bg-token-main-surface-secondary rounded-[10px] px-2.5 py-1.5 text-left text-sm hover:bg-[#f5f5f5] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-token-border-strong";function zo(t){"use forget";var Y,$,V;const e=he.c(46),{state:n,style:o,floatingRef:s,dispatchSlashMenuMeta:r,disabledOptionIds:i}=t,l=st(),a=p.useRef(null);let u;e[0]!==n?(u=mt(n),e[0]=n,e[1]=u):u=e[1];const f=u;n==null||n.visibleOptionIds;let d;e[2]!==(n==null?void 0:n.visibleOptionIds)?(d=(Y=n==null?void 0:n.visibleOptionIds)!=null?Y:[],e[2]=n==null?void 0:n.visibleOptionIds,e[3]=d):d=e[3];const m=d,c=($=n==null?void 0:n.highlightedOptionId)!=null?$:null;let h;e[4]!==r?(h=()=>{r({type:"close"})},e[4]=r,e[5]=h):h=e[5];const b=h;let k;e[6]!==r?(k=D=>{r({type:"highlight",commandId:D})},e[6]=r,e[7]=k):k=e[7];const _=k;let C;e[8]!==r?(C=D=>{r({type:"execute",commandId:D})},e[8]=r,e[9]=C):C=e[9];const w=C;let I;e[10]!==i||e[11]!==w?(I=new Map,Zl().forEach(D=>{var ee;const Z=D.disabled||((ee=i==null?void 0:i.includes(D.id))!=null?ee:!1);I.set(D.id,{id:D.id,messageKey:D.messageKey,disabled:Z,onSelect:()=>{w(D.id)}})}),e[10]=i,e[11]=w,e[12]=I):I=e[12];const E=I;let R;if(e[13]!==E||e[14]!==m){let D;e[16]!==E?(D=Z=>{var ee;return(ee=E.get(Z))!=null?ee:null},e[16]=E,e[17]=D):D=e[17],R=m.map(D).filter(Da),e[13]=E,e[14]=m,e[15]=R}else R=e[15];const y=R;let x;e[18]!==_||e[19]!==c||e[20]!==y.length?(x=D=>{const Z=D.id===c;return g.jsx("button",{type:"button",role:"menuitem","data-highlighted":Z?"true":void 0,className:ce(Na,D.disabled&&"cursor-not-allowed opacity-50",Z&&"dark:bg-token-main-surface-secondary bg-[#f5f5f5]"),disabled:D.disabled,"aria-disabled":D.disabled?"true":void 0,onClick:()=>{D.disabled||(_(D.id),D.onSelect())},onPointerDown:ee=>{ee.preventDefault(),ee.stopPropagation(),D.disabled||(_(D.id),D.onSelect())},onMouseEnter:()=>{y.length>0&&_(D.id)},onFocus:()=>{y.length>0&&_(D.id)},children:g.jsx(Ge,Ne({},eo[D.messageKey]))},D.id)},e[18]=_,e[19]=c,e[20]=y.length,e[21]=x):x=e[21];const N=x,M=(V=y.find(Pa))!=null?V:null,O=y.filter(va);let T,v;e[22]!==b||e[23]!==f||e[24]!==y.length?(T=()=>{f&&(y.length>0||b())},v=[f,b,y.length],e[22]=b,e[23]=f,e[24]=y.length,e[25]=T,e[26]=v):(T=e[25],v=e[26]),p.useEffect(T,v);let S,A;e[27]!==b||e[28]!==f?(S=()=>{if(!f)return;const D=Z=>{a.current&&(Z.target instanceof Node&&a.current.contains(Z.target)||b())};return document.addEventListener("pointerdown",D,!0),()=>{document.removeEventListener("pointerdown",D,!0)}},A=[f,b],e[27]=b,e[28]=f,e[29]=S,e[30]=A):(S=e[29],A=e[30]),p.useEffect(S,A);let P,W;if(e[31]!==b||e[32]!==f?(P=()=>{if(!f)return;const D=ee=>{if(!a.current){b();return}ee.target instanceof Node&&a.current.contains(ee.target)||b()},Z=()=>{b()};return window.addEventListener("blur",Z),document.addEventListener("focusin",D,!0),()=>{window.removeEventListener("blur",Z),document.removeEventListener("focusin",D,!0)}},W=[f,b],e[31]=b,e[32]=f,e[33]=P,e[34]=W):(P=e[33],W=e[34]),p.useEffect(P,W),!f)return null;let L;e[35]!==s?(L=D=>{a.current=D,s==null||s(D)},e[35]=s,e[36]=L):L=e[36];const B="menu";let G;e[37]!==l?(G=l.formatMessage(eo.menuLabel),e[37]=l,e[38]=G):G=e[38];let K;e[39]===Symbol.for("react.memo_cache_sentinel")?(K=ce(Gn.toolbar,To,"writing-block-slash-menu popover bg-token-main-surface-primary absolute w-fit rounded-2xl p-1.5","flex flex-col gap-1"),e[39]=K):K=e[39];const q=-1,z=y.length===0?null:g.jsxs(g.Fragment,{children:[M?N(M):null,M&&O.length>0?g.jsx("div",{"aria-hidden":"true",role:"separator",className:"border-token-border-subtle w-full border-t opacity-100"}):null,O.map(D=>N(D))]});let U;return e[40]!==o||e[41]!==L||e[42]!==G||e[43]!==K||e[44]!==z?(U=g.jsx("div",{ref:L,role:B,"aria-label":G,className:K,style:o,tabIndex:q,children:z}),e[40]=o,e[41]=L,e[42]=G,e[43]=K,e[44]=z,e[45]=U):U=e[45],U}function va(t){return t.id!=="generate"}function Pa(t){return t.id==="generate"}function Da(t){return t!=null}zo.displayName="WritingBlockSlashMenu";const to=10,no=-35,Wt=8,so=(t,e,n)=>Math.max(e,Math.min(n,t)),Aa=t=>{"use forget";const e=he.c(78),{editorAreaRef:n,isInlineWritingBlockEditEnabled:o,docChangeCount:s,selectionIsCollapsed:r,isFormatToolbarOpen:i,magicEditTriggerCount:l,onSelectNuxVisibilityChange:a}=t,u=i===void 0?!1:i,f=l===void 0?0:l,d=Ct(),m=st();let c;e[0]===Symbol.for("react.memo_cache_sentinel")?(c=gr(),e[0]=c):c=e[0];const h=c,{eligible:b,isLoading:k}=Qn(Ft.hasSeenWritingInlineEditNux),{eligible:_}=Qn(Ft.hasSeenWritingInlineEditCaretNux),{eligible:C,isLoading:w}=Qn(Ft.hasSeenWritingInlineEditSelectNux),[I,E]=p.useState(!1),[R,y]=p.useState(null),[x,N]=p.useState(null),[M,O]=p.useState(!1),[T,v]=p.useState(!1),[S,A]=p.useState(!1),P=p.useRef(!1),W=p.useRef(!1),L=p.useRef(!1),B=p.useRef(null),G=p.useRef(s),K=p.useRef(f);let q;e[1]!==n?(q=()=>{var It;const X=n.current;if(!X){N(null);return}const te=document.getSelection();if(!te||te.rangeCount===0||!te.anchorNode||!te.focusNode||!te.isCollapsed||!X.contains(te.anchorNode)&&!X.contains(te.focusNode)){N(null);return}const Me=te.getRangeAt(0),ge=X.getBoundingClientRect();let ie=Me.getBoundingClientRect();if(!Number.isFinite(ie.left)||!Number.isFinite(ie.top)||ie.width===0&&ie.height===0||ie.left===0&&ie.top===0){const wt=Me.getClientRects();if(wt.length>0)ie=wt[0];else{let Xe=null;const xt=te.anchorNode;for(xt&&(Xe=xt instanceof Element?xt:(It=xt.parentElement)!=null?It:null);Xe&&Xe!==X&&!X.contains(Xe);)Xe=Xe.parentElement;ie=Xe&&X.contains(Xe)?Xe.getBoundingClientRect():ge}}let Re=ie.left-ge.left+to,ht=ie.top-ge.top+no;const Nt=Math.max(Wt,ge.width-Wt),qt=Math.max(Wt,ge.height-Wt);Re=so(Re,Wt,Nt),ht=so(ht,Wt,qt),N({x:Re,y:ht})},e[1]=n,e[2]=q):q=e[2];const z=q;let U;e[3]!==d?(U=Gt(d,"2862575767"),e[3]=d,e[4]=U):U=e[4];const $=!h&&o&&U,V=$&&b&&!I,D=$&&!b&&!k&&_&&!M,Z=D&&T&&x!=null,ee=V&&R!=null,ae=Z&&x!=null,ye=$&&!k&&!w&&!b&&!_&&C&&!S&&u,_e=ae&&I&&!M;let be;e[5]===Symbol.for("react.memo_cache_sentinel")?(be=()=>{P.current=!1},e[5]=be):be=e[5];let de;e[6]!==V?(de=[V],e[6]=V,e[7]=de):de=e[7],p.useEffect(be,de);let we;e[8]!==d?(we=()=>{E(!0),y(null),Zn(d,Ft.hasSeenWritingInlineEditNux)},e[8]=d,e[9]=we):we=e[9];const Se=we;let Ve;e[10]!==d?(Ve=()=>{W.current||(W.current=!0,O(!0),N(null),Zn(d,Ft.hasSeenWritingInlineEditCaretNux))},e[10]=d,e[11]=Ve):Ve=e[11];const ze=Ve;let xe;e[12]!==d?(xe=()=>{L.current||(L.current=!0,A(!0),Zn(d,Ft.hasSeenWritingInlineEditSelectNux))},e[12]=d,e[13]=xe):xe=e[13];const F=xe;let H;e[14]!==n?(H=X=>{const te=n.current;if(!te)return!1;if(X.composedPath().includes(te))return!0;const ge=X.target;if(ge instanceof Node&&te.contains(ge))return!0;const ie=te.getBoundingClientRect(),{clientX:et,clientY:Re}=X;return et>=ie.left&&et<=ie.right&&Re>=ie.top&&Re<=ie.bottom},e[14]=n,e[15]=H):H=e[15];const J=H;let se,ue;e[16]!==Se||e[17]!==n||e[18]!==J||e[19]!==V?(se=()=>{if(!V)return;const X=n.current;if(!X)return;const te=()=>{B.current!=null&&(window.clearTimeout(B.current),B.current=null)},Me=Re=>{te(),J(Re)||y(null)},ge=Re=>{if(te(),!J(Re)){y(null);return}P.current=!0;const ht=X.getBoundingClientRect();y({x:Re.clientX-ht.left+to,y:Re.clientY-ht.top+no})},ie=()=>{te(),B.current=window.setTimeout(()=>{y(null)},80)},et=Re=>{te(),J(Re)&&P.current&&Se()};return X.addEventListener("pointerenter",Me),X.addEventListener("pointermove",ge),X.addEventListener("pointerleave",ie),X.addEventListener("pointercancel",ie),X.addEventListener("pointerdown",et),()=>{te(),X.removeEventListener("pointerenter",Me),X.removeEventListener("pointermove",ge),X.removeEventListener("pointerleave",ie),X.removeEventListener("pointercancel",ie),X.removeEventListener("pointerdown",et)}},ue=[n,Se,J,V],e[16]=Se,e[17]=n,e[18]=J,e[19]=V,e[20]=se,e[21]=ue):(se=e[20],ue=e[21]),p.useEffect(se,ue);let Ee,Le;e[22]!==Se||e[23]!==V?(Ee=()=>{if(!V)return;const X=te=>{te.key==="Escape"&&Se()};return window.addEventListener("keydown",X),()=>window.removeEventListener("keydown",X)},Le=[Se,V],e[22]=Se,e[23]=V,e[24]=Ee,e[25]=Le):(Ee=e[24],Le=e[25]),p.useEffect(Ee,Le);let me,Be;e[26]!==n||e[27]!==D||e[28]!==z?(me=()=>{const X=n.current;if(!X)return;const te=()=>{v(!0),D&&z()},Me=ge=>{const ie=ge.relatedTarget;ie instanceof Node&&X.contains(ie)||(v(!1),N(null))};return X.addEventListener("focusin",te),X.addEventListener("focusout",Me),()=>{X.removeEventListener("focusin",te),X.removeEventListener("focusout",Me)}},Be=[n,D,z],e[26]=n,e[27]=D,e[28]=z,e[29]=me,e[30]=Be):(me=e[29],Be=e[30]),p.useEffect(me,Be);let Ye,ve;e[31]!==D||e[32]!==z?(Ye=()=>{if(D)return queueMicrotask(()=>{z()}),document.addEventListener("selectionchange",z),window.addEventListener("resize",z),document.addEventListener("scroll",z,!0),()=>{document.removeEventListener("selectionchange",z),window.removeEventListener("resize",z),document.removeEventListener("scroll",z,!0)}},ve=[D,z],e[31]=D,e[32]=z,e[33]=Ye,e[34]=ve):(Ye=e[33],ve=e[34]),p.useEffect(Ye,ve);let je,ke;e[35]!==ze||e[36]!==s||e[37]!==D?(je=()=>{if(!D){G.current=s;return}s!==G.current&&(G.current=s,queueMicrotask(()=>{ze()}))},ke=[ze,s,D],e[35]=ze,e[36]=s,e[37]=D,e[38]=je,e[39]=ke):(je=e[38],ke=e[39]),p.useEffect(je,ke);let Te,fe;e[40]!==ze||e[41]!==D||e[42]!==r?(Te=()=>{D&&(r||queueMicrotask(()=>{ze()}))},fe=[ze,D,r],e[40]=ze,e[41]=D,e[42]=r,e[43]=Te,e[44]=fe):(Te=e[43],fe=e[44]),p.useEffect(Te,fe);let pe,re;e[45]!==F||e[46]!==f?(pe=()=>{if(f===K.current||f===0){K.current=f;return}K.current=f,queueMicrotask(()=>{F()})},re=[F,f],e[45]=F,e[46]=f,e[47]=pe,e[48]=re):(pe=e[47],re=e[48]),p.useEffect(pe,re);let oe,$e;e[49]!==a||e[50]!==ye?(oe=()=>{a==null||a(ye)},$e=[a,ye],e[49]=a,e[50]=ye,e[51]=oe,e[52]=$e):(oe=e[51],$e=e[52]),p.useEffect(oe,$e);let Pe;e[53]!==m?(Pe=m.formatMessage({id:"zjMglQ",defaultMessage:"Click anywhere to edit"}),e[53]=m,e[54]=Pe):Pe=e[54];const dt=Pe;let He;e[55]!==m?(He=m.formatMessage({id:"z5OrYQ",defaultMessage:"Start typing or select text"}),e[55]=m,e[56]=He):He=e[56];const ot=He;let ft;e:{if(!ee||!R){ft=null;break e}let X;e[57]!==m?(X=m.formatMessage({id:"HJxwKm",defaultMessage:"New!"}),e[57]=m,e[58]=X):X=e[58];let te;e[59]!==X?(te=g.jsx("span",{className:"text-[#D1D5DB]",children:X}),e[59]=X,e[60]=te):te=e[60];let Me;e[61]!==dt?(Me=g.jsx("span",{children:dt}),e[61]=dt,e[62]=Me):Me=e[62];let ge;e[63]!==te||e[64]!==Me?(ge=g.jsxs(g.Fragment,{children:[te,Me]}),e[63]=te,e[64]=Me,e[65]=ge):ge=e[65];let ie;e[66]!==R||e[67]!==ge?(ie={key:"writing-inline-edit-nux",position:R,message:ge},e[66]=R,e[67]=ge,e[68]=ie):ie=e[68],ft=ie}const Qe=ft;let pt;e:{if(!ae||!x){pt=null;break e}const X=_e?"writing-inline-edit-nux":"writing-inline-edit-nux-caret";let te;e[69]!==ot||e[70]!==x||e[71]!==X?(te={key:X,position:x,message:ot},e[69]=ot,e[70]=x,e[71]=X,e[72]=te):te=e[72],pt=te}const kt=pt,Ze=Qe!=null?Qe:kt;if(h)return null;let Je;e[73]!==Ze||e[74]!==ae?(Je=Ze&&g.jsx(Oa,{position:Ze.position,message:Ze.message,interactive:ae,anchor:Ze.anchor},Ze.key),e[73]=Ze,e[74]=ae,e[75]=Je):Je=e[75];let rt;return e[76]!==Je?(rt=g.jsx(pr,{children:Je}),e[76]=Je,e[77]=rt):rt=e[77],rt},Oa=t=>{"use forget";const e=he.c(36),{position:n,message:o,interactive:s,anchor:r}=t,i=s===void 0?!1:s,l=r===void 0?"top-left":r,a=p.useRef(null);let u;e[0]===Symbol.for("react.memo_cache_sentinel")?(u={width:0,height:0},e[0]=u):u=e[0];const[f,d]=p.useState(u),m=Cs(n.x),c=Cs(n.y);let h;e[1]===Symbol.for("react.memo_cache_sentinel")?(h={stiffness:200,damping:20,mass:.6},e[1]=h):h=e[1];const b=Ns(m,h);let k;e[2]===Symbol.for("react.memo_cache_sentinel")?(k={stiffness:200,damping:20,mass:.6},e[2]=k):k=e[2];const _=Ns(c,k);let C;e[3]===Symbol.for("react.memo_cache_sentinel")?(C=()=>{const G=a.current;if(!G){d({width:0,height:0});return}const K=()=>{const z=G.getBoundingClientRect();d({width:z.width,height:z.height})};if(K(),typeof ResizeObserver>"u")return;const q=new ResizeObserver(()=>{K()});return q.observe(G),()=>{q.disconnect()}},e[3]=C):C=e[3];let w;e[4]!==o?(w=[o],e[4]=o,e[5]=w):w=e[5],ns(C,w);let I=n.x,E=n.y;(l==="top-center"||l==="bottom-center")&&(I=I-f.width/2),l==="bottom-center"&&(E=E-f.height);let R;e[6]!==I||e[7]!==E?(R={x:I,y:E},e[6]=I,e[7]=E,e[8]=R):R=e[8];const y=R;let x,N;e[9]!==y.x||e[10]!==y.y||e[11]!==b||e[12]!==_||e[13]!==m||e[14]!==c?(N=()=>{b.set(y.x),_.set(y.y),m.set(y.x),c.set(y.y)},x=[y.x,y.y,b,_,m,c],e[9]=y.x,e[10]=y.y,e[11]=b,e[12]=_,e[13]=m,e[14]=c,e[15]=x,e[16]=N):(x=e[15],N=e[16]),ns(N,x);let M,O;e[17]!==y.x||e[18]!==y.y||e[19]!==m||e[20]!==c?(M=()=>{m.set(y.x),c.set(y.y)},O=[y.x,y.y,m,c],e[17]=y.x,e[18]=y.y,e[19]=m,e[20]=c,e[21]=M,e[22]=O):(M=e[21],O=e[22]),p.useEffect(M,O);let T,v,S,A;e[23]===Symbol.for("react.memo_cache_sentinel")?(T={opacity:0,scale:.95},v={opacity:1,scale:1},S={opacity:0,scale:.95},A={type:"spring",stiffness:500,damping:45,mass:.5},e[23]=T,e[24]=v,e[25]=S,e[26]=A):(T=e[23],v=e[24],S=e[25],A=e[26]);let P;e[27]!==b||e[28]!==_?(P={x:b,y:_},e[27]=b,e[28]=_,e[29]=P):P=e[29];const W=(i?"pointer-events-auto ":"pointer-events-none ")+"flex items-center gap-1 rounded-lg bg-[#007aff] px-2 py-1 text-xs font-semibold text-white shadow-[0_6px_16px_rgba(0,122,255,0.25)]";let L;e[30]!==o||e[31]!==W?(L=g.jsx("div",{className:W,"data-testid":"writing-inline-edit-nux",children:o}),e[30]=o,e[31]=W,e[32]=L):L=e[32];let B;return e[33]!==P||e[34]!==L?(B=g.jsx(mr.div,{className:"pointer-events-none fixed z-30",initial:T,animate:v,exit:S,transition:A,style:P,ref:a,children:L}),e[33]=P,e[34]=L,e[35]=B):B=e[35],B},La=Ae(()=>De(()=>import("./lrtd9knjab0hf8x5.js"),__vite__mapDeps([12,1])),{loading:t=>Oe(t)});function Ba(t){"use forget";const e=he.c(30),{editorView:n,pmu:o}=t,s=st(),[r,i]=p.useState(""),l=p.useRef(null),a=p.useRef(!1);let u;e[0]!==n||e[1]!==o?(u={view:n,pmu:o},e[0]=n,e[1]=o,e[2]=u):u=e[2];const{isLoading:f,submitMagicEdit:d,applyMagicEditResult:m}=Fo(u);let c;e[3]!==m||e[4]!==n.state.doc.content.size||e[5]!==r||e[6]!==d?(c=async T=>{var L;a.current=!1,T==null||T.preventDefault(),T==null||T.stopPropagation();const v={from:0,to:n.state.doc.content.size},S=r.trim();if(!S)return;const A=await d({instruction:S,range:v});if(!A||a.current)return;const P=(L=A.replacements[0])!=null?L:"";m({magicEditId:A.magicEditId,replacement:P,range:v})&&i("")},e[3]=m,e[4]=n.state.doc.content.size,e[5]=r,e[6]=d,e[7]=c):c=e[7];const h=c;let b;e[8]===Symbol.for("react.memo_cache_sentinel")?(b=()=>{a.current=!0},e[8]=b):b=e[8];const k=b;let _;e[9]===Symbol.for("react.memo_cache_sentinel")?(_=T=>i(T.target.value),e[9]=_):_=e[9];let C;e[10]!==h?(C=T=>T.key==="Enter"&&h(),e[10]=h,e[11]=C):C=e[11];let w;e[12]!==s?(w=s.formatMessage({id:"o/23xf",defaultMessage:"Describe edits"}),e[12]=s,e[13]=w):w=e[13];let I;e[14]!==r||e[15]!==C||e[16]!==w?(I=g.jsx("input",{value:r,onChange:_,onKeyDown:C,placeholder:w,ref:l,type:"text",className:"text-token-text-primary placeholder:text-token-text-secondary flex-1 border-none outline-none focus:border-transparent focus:ring-0 focus:outline-none"}),e[14]=r,e[15]=C,e[16]=w,e[17]=I):I=e[17];const E=f?k:h,R=f?"writing-block-fullscreen-composer-stop-button":"writing-block-fullscreen-composer-submit-button",y=f?"composer-secondary-button-color":"composer-submit-button-color";let x;e[18]!==y?(x=ce("composer-submit-btn",y,"flex","h-8","w-8","items-center","justify-center"),e[18]=y,e[19]=x):x=e[19];let N;e[20]!==f?(N=f?g.jsx(La,{className:"icon"}):g.jsx(Fr,{className:"icon"}),e[20]=f,e[21]=N):N=e[21];let M;e[22]!==x||e[23]!==N||e[24]!==E||e[25]!==R?(M=g.jsx("button",{onClick:E,id:R,className:x,children:N}),e[22]=x,e[23]=N,e[24]=E,e[25]=R,e[26]=M):M=e[26];let O;return e[27]!==M||e[28]!==I?(O=g.jsxs("div",{className:"border-token-border-primary bg-token-bg-primary fixed start-1/2 bottom-6 z-20 flex w-[min(90vw,32rem)] -translate-x-1/2 transform items-center rounded-full border px-4 py-2 sm:bottom-10",children:[I,M]}),e[27]=M,e[28]=I,e[29]=O):O=e[29],O}const ja=({view:t,pmu:e,prompt:n,input:o})=>{const{anchorPos:s,caretPos:r,triggerPos:i,directiveText:l}=o,a={from:Math.min(i,s,r),to:Math.max(s,r)},u=Bo({view:t,pmu:e,range:a}),f=u.endIndex-u.startIndex,d=l!=null?l:"";let m=u.fullMarkdown;const c=u.startIndex;let h=u.endIndex;return d.length>0&&(m=m.slice(0,c)+d+m.slice(c),h=c+d.length+f),{full_block_body_markdown:m,start_index:c,end_index:h,instruction:n,num_variations:1}};function Fa(t){"use forget";const e=he.c(10),{view:n,pmu:o}=t,s=Hn(),r=st(),i=p.useRef(!1),{mutateAsync:l,isPending:a}=jo();let u;e[0]!==l||e[1]!==r||e[2]!==o||e[3]!==s||e[4]!==n?(u=async h=>{var C;if(!n||!o)return!1;i.current=!1;const b=h.trim();if(b==="")return!1;const k=Ke.getState(n.state);if(!(k!=null&&k.input))return!1;let _;try{_=ja({view:n,pmu:o,prompt:b,input:k.input})}catch(w){const I=r.formatMessage({id:"afsmrO",defaultMessage:"Unable to prepare generate request."});return s.danger(I,{duration:2}),!1}try{const w=await l({payload:_});if(i.current)return!1;let I="";const E=w.choices;if(Array.isArray(E)){const x=E[0];if(typeof x=="string")I=x;else if(x!=null){if(typeof x=="object"){const N=x;if("text"in N){const M=N.text;typeof M=="string"&&(I=M)}}}}const R=crypto.randomUUID();if(!pl({view:n,suggestionId:R,text:I})){const x=r.formatMessage({id:"FckTpR",defaultMessage:"Unable to insert generated text."});return s.danger(x,{duration:2}),!1}return!0}catch(w){const I=w;if(!i.current){const E=(C=mo(I))!=null?C:r.formatMessage({id:"6QyguR",defaultMessage:"An error occurred while generating text."});s.danger(E,{duration:2})}return!1}},e[0]=l,e[1]=r,e[2]=o,e[3]=s,e[4]=n,e[5]=u):u=e[5];const f=u;let d;e[6]===Symbol.for("react.memo_cache_sentinel")?(d=()=>{i.current=!0},e[6]=d):d=e[6];const m=d;let c;return e[7]!==a||e[8]!==f?(c={isLoading:a,submitGenerate:f,cancelGenerate:m},e[7]=a,e[8]=f,e[9]=c):c=e[9],c}const Wa=(t,e)=>{if(t===e)return!0;if(!t||!e)return t===e;const n=t.input,o=e.input,s=!n&&!o||n!=null&&o!=null&&n.anchorPos===o.anchorPos&&n.caretPos===o.caretPos&&n.blockFrom===o.blockFrom&&n.blockTo===o.blockTo&&n.triggerPos===o.triggerPos,r=t.suggestion,i=e.suggestion,l=!r&&!i||r!=null&&i!=null&&r.id===i.id&&r.from===i.from&&r.to===i.to;return s&&l&&t.lastResolvedSuggestionId===e.lastResolvedSuggestionId&&t.lastResolvedReason===e.lastResolvedReason},za=(t,e)=>t===e?!0:t.triggerPos!==e.triggerPos||t.anchorPos!==e.anchorPos||t.query!==e.query||t.normalizedQuery!==e.normalizedQuery||t.highlightedOptionId!==e.highlightedOptionId||t.visibleOptionIds.length!==e.visibleOptionIds.length?!1:t.visibleOptionIds.every((n,o)=>n===e.visibleOptionIds[o]),$a=t=>{var e;return!t||t.entries.size===0?null:(e=t.entries.keys().next().value)!=null?e:null},Ha={editorView:null,slashMenuState:Kt,generatePluginState:null,activeMagicEditEntryId:null,selectionSummary:{isCollapsed:!0},docChangeCount:0},Ga=(t,e)=>t.editorView===e.editorView&&za(t.slashMenuState,e.slashMenuState)&&Wa(t.generatePluginState,e.generatePluginState)&&t.activeMagicEditEntryId===e.activeMagicEditEntryId&&t.selectionSummary.isCollapsed===e.selectionSummary.isCollapsed&&t.docChangeCount===e.docChangeCount,Ka=()=>{let t=Ha;const e=new Set,n=()=>{e.forEach(s=>s())},o=s=>{const r=Ne(Ne({},t),s);Ga(t,r)||(t=r,n())};return{getSnapshot:()=>t,subscribe:s=>(e.add(s),()=>{e.delete(s)}),setView:s=>{if(!s){o({editorView:null,slashMenuState:Kt,generatePluginState:null,activeMagicEditEntryId:null,selectionSummary:{isCollapsed:!0},docChangeCount:0});return}o({editorView:s})},syncFromState:(s,r,i)=>{var c,h;const l=(c=qe.getState(s))!=null?c:Kt,a=(h=Ke.getState(s))!=null?h:null,u=r.isMagicEditEnabled?ut.getState(s):null,f=r.isMagicEditEnabled?$a(u):null,d={isCollapsed:s.selection.empty},m=i!=null&&i.docChanged?1:0;o({slashMenuState:l,generatePluginState:a,activeMagicEditEntryId:f,selectionSummary:d,docChangeCount:t.docChangeCount+m})}}},Ua=t=>{"use forget";return p.useSyncExternalStore(t.subscribe,t.getSnapshot,t.getSnapshot)},qa=t=>typeof t=="object"&&t!=null,Va=t=>{if(!qa(t)||typeof t.type!="string")return!1;switch(t.type){case"open":return typeof t.triggerPos=="number"&&typeof t.anchorPos=="number";case"close":return!0;case"navigate":return t.direction==="previous"||t.direction==="next";case"highlight":return typeof t.commandId=="string"||t.commandId==null;case"execute":return typeof t.commandId=="string";default:return!1}},Ya={accept:{applyAction:"use",eventName:"ChatGPT Writing Block Magic Edit Accepted",eventType:"chatgpt_writing_block_magic_edit_accepted"},reject:{applyAction:"keep",eventName:"ChatGPT Writing Block Magic Edit Rejected",eventType:"chatgpt_writing_block_magic_edit_rejected"}};function Xa(t,e,n){var o,s;return{writing_block_id:e.blockId,magic_edit_id:n,freeform_feedback:t.freeformFeedback$(),full_block_body_markdown:t.fullBlockBodyMarkdown$(),start_index:(o=t.startIndex$())!=null?o:-1,end_index:(s=t.endIndex$())!=null?s:-1,suggested_content:t.replacements$()[0]}}function Qa(t,e,n){var C,w,I;const{schema:o}=t.state,s=o.nodes.horizontal_rule,r=o.nodes.paragraph;if(!s)return!1;let i=t.state.tr;const l=Math.max(n!=null?n:e+1,e+1);i=i.delete(e,l);const a=i.mapping.map(e,-1),u=i.doc.childBefore(a+1),f=u.node,d=u.offset;if(r&&(f==null?void 0:f.type)===r&&f.isTextblock&&(f==null?void 0:f.content.size)===0){const E=s.create(),R=d+f.nodeSize;i=i.replaceRangeWith(d,R,E);const y=d+E.nodeSize;let x=y;if(r){const M=r.create(),O=M.nodeSize;i=i.insert(y,_t.from(M)),x=y+1;const T=y+O,v=i.doc.nodeAt(T);(v==null?void 0:v.type)===r&&v.content.size===0&&(i=i.delete(T,T+v.nodeSize))}const N=(C=Ie.findFrom(i.doc.resolve(x),1,!0))!=null?C:Ie.near(i.doc.resolve(x),1);return t.dispatch(i.setSelection(N).scrollIntoView()),!0}const c=s.create(),h=r?r.create():null,b=h?[c,h]:[c];i=i.insert(a,_t.from(b));const k=a+c.nodeSize;if(h&&r){const E=a+c.nodeSize,R=h.nodeSize,y=E+R,x=i.doc.nodeAt(y);x&&x.type===r&&x.content.size===0&&(i=i.delete(y,y+x.nodeSize));const N=(w=Ie.findFrom(i.doc.resolve(E+1),1,!0))!=null?w:Ie.near(i.doc.resolve(E+1),1);return t.dispatch(i.setSelection(N).scrollIntoView()),!0}const _=(I=Ie.findFrom(i.doc.resolve(k),1,!0))!=null?I:Ie.near(i.doc.resolve(k),1);return t.dispatch(i.setSelection(_).scrollIntoView()),!0}function Za(t){"use forget";const e=he.c(2);let n;return e[0]!==t?(n=yl({shouldStripDirectives:!0,contentReferences:t}),e[0]=t,e[1]=n):n=e[1],n}const Ja=t=>{"use forget";var _s,Ss,ks,Is;const e=he.c(174),{analyticsMetadata:n,markdown:o,onChange:s,isDisabled:r,isInlineWritingBlockEditEnabled:i,className:l,wrapperClassName:a,maxLength:u,contentReferences:f,setDirty:d,flushPendingChanges:m,editorViewRef:c,fullscreenMode:h}=t,b=h===void 0?!1:h,k=Ct(),_=st();let C;e[0]!==_?(C=_.formatMessage({id:"IohtFB",defaultMessage:"Write or type ‘/’ for commands..."}),e[0]=_,e[1]=C):C=e[1];const w=C,I=p.useRef(w),E=hr(br.MagicEditEnabled);let R;e[2]!==k?(R=Gt(k,"2459982630"),e[2]=k,e[3]=R):R=e[3];const x=E||R;let N;e[4]!==k?(N=Gt(k,"3539089402"),e[4]=k,e[5]=N):N=e[5];const M=N;let O;e[6]!==k?(O=Gt(k,"1629932585"),e[6]=k,e[7]=O):O=e[7];const T=!1,v=Za(f),S=p.useRef(null),A=p.useRef(null),P=p.useRef(null);let W;e[8]===Symbol.for("react.memo_cache_sentinel")?(W=Ka(),e[8]=W):W=e[8];const L=W,{editorView:B,slashMenuState:G,generatePluginState:K,activeMagicEditEntryId:q,selectionSummary:z,docChangeCount:U}=Ua(L),[Y,$]=p.useState(""),[V,D]=p.useState(!1),[Z,ee]=p.useState(0),[ae,We]=p.useState(!1);let ye;e[9]===Symbol.for("react.memo_cache_sentinel")?(ye=()=>{ee(ec)},e[9]=ye):ye=e[9];const _e=ye,be=cs(s,300),de=p.useRef(be),we=p.useRef(d),Se=p.useRef(m);let Ve;e[10]===Symbol.for("react.memo_cache_sentinel")?(Ve={placement:"bottom-start",middleware:[po(8),ho({fallbackPlacements:["top-start"]}),bo({padding:8})],whileElementsMounted:(j,Q,ne)=>{var le;return yo((le=S.current)!=null?le:j,Q,ne,{ancestorResize:!0,ancestorScroll:!0})}},e[10]=Ve):Ve=e[10];const{refs:ze,floatingStyles:xe,update:F}=xo(Ve),H=ze.setReference,J=ze.setFloating,se=p.useRef(null);let ue;e[11]!==c||e[12]!==H||e[13]!==F?(ue=(j,Q)=>{var Fe;const ne=c.current;if(!ne||j==null){Q.current=null,H(null);return}const le={contextElement:(Fe=S.current)!=null?Fe:void 0,getBoundingClientRect:()=>{try{const Ce=ne.coordsAtPos(j);return new DOMRect(Ce.left,Ce.bottom,0,0)}catch(Ce){return new DOMRect}}};Q.current=le,H(le),F()},e[11]=c,e[12]=H,e[13]=F,e[14]=ue):ue=e[14];const Ee=ue;let Le;e[15]!==l?(Le=ce("markdown","prose","dark:prose-invert","w-full","min-h-6","break-words","focus:outline-none",l),e[15]=l,e[16]=Le):Le=e[16];const me=Le;let Be;e[17]!==me||e[18]!==r||e[19]!==o||e[20]!==u?(Be={markdown:o,maxLength:u,isDisabled:r,editorClassName:me},e[17]=me,e[18]=r,e[19]=o,e[20]=u,e[21]=Be):Be=e[21];const Ye=p.useRef(Be),ve=p.useRef(o);let je;e[22]!==B||e[23]!==v?(je={view:B,pmu:v},e[22]=B,e[23]=v,e[24]=je):je=e[24];const{isLoading:ke,submitGenerate:Te,cancelGenerate:fe}=Fa(je),pe=(_s=K==null?void 0:K.input)!=null?_s:null,re=pe!=null,oe=(ks=(Ss=K==null?void 0:K.suggestion)==null?void 0:Ss.id)!=null?ks:null;let $e;e[25]!==c?($e=j=>{const Q=c.current;if(!Q)return;const ne=Q.state.tr.setMeta(qe,j);Q.dispatch(ne)},e[25]=c,e[26]=$e):$e=e[26];const Pe=$e;let dt;e[27]!==Pe?(dt=()=>{Pe({type:"close"})},e[27]=Pe,e[28]=dt):dt=e[28];const He=dt;let ot;e[29]!==c||e[30]!==He?(ot=()=>{const j=c.current;if(!j)return;const Q=qe.getState(j.state);if(!mt(Q))return;const{triggerPos:ne,anchorPos:le}=Q;if(!Qa(j,ne,le)){He();return}nn(j)},e[29]=c,e[30]=He,e[31]=ot):ot=e[31];const ft=ot;let Qe;e[32]!==c?(Qe=()=>{var Pn,jt;const j=c.current;if(!j)return;const Q=(Pn=Ke.getState(j.state))!=null?Pn:null;if(Q!=null&&Q.input||Q!=null&&Q.suggestion)return;const ne=qe.getState(j.state);if(!mt(ne))return;const le=ne.triggerPos;if(le==null)return;const Fe=(jt=ne.anchorPos)!=null?jt:le+1,Ce=Math.max(le+1,Fe),tt=j.state.doc.textBetween(le,Ce,"\0","\0");let Ue=j.state.tr.delete(le,Ce);const it=Math.max(Math.min(le,Ue.doc.content.size),0);Ue=Ue.setSelection(on.create(Ue.doc,it)),j.dispatch(Ue);const Et=j.state,nt=Et.selection.to,Qt=Et.doc.resolve(nt),Bt=Qt.start(),vn=Qt.end();ml(j,{anchorPos:nt,caretPos:nt,blockFrom:Bt,blockTo:vn,triggerPos:nt,directiveText:tt}),$(""),nn(j)},e[32]=c,e[33]=Qe):Qe=e[33];const pt=Qe;let kt;e[34]!==fe||e[35]!==c?(kt=()=>{var le,Fe,Ce;fe(),$("");const j=c.current;if(!j)return;const Q=Ke.getState(j.state),ne=(Fe=(le=Q==null?void 0:Q.input)==null?void 0:le.triggerPos)!=null?Fe:null;if(Ws(j),ne!=null){const tt=j.state.doc,Ue=Math.max(0,Math.min(ne,tt.content.size)),it=tt.resolve(Ue),Et=(Ce=Ie.findFrom(it,1,!0))!=null?Ce:Ie.near(it,1);if(!j.state.selection.eq(Et)){const Xt=j.state.tr.setSelection(Et);j.dispatch(Xt)}}j.hasFocus()||j.focus()},e[34]=fe,e[35]=c,e[36]=kt):kt=e[36];const Ze=kt;let Je;e[37]!==Y||e[38]!==Te?(Je=async()=>{await Te(Y)&&$("")},e[37]=Y,e[38]=Te,e[39]=Je):Je=e[39];const rt=Je;let X;e[40]!==oe||e[41]!==c?(X=()=>{if(!oe)return;const j=c.current;j&&(hl(j,oe),j.hasFocus()||j.focus())},e[40]=oe,e[41]=c,e[42]=X):X=e[42];const te=X;let Me;e[43]!==oe||e[44]!==c?(Me=()=>{if(!oe)return;const j=c.current;j&&(bl(j,oe),j.hasFocus()||j.focus())},e[43]=oe,e[44]=c,e[45]=Me):Me=e[45];const ge=Me;let ie;e[46]!==q||e[47]!==n||e[48]!==k||e[49]!==B?(ie=j=>{if(!q||!B)return;B.focus();const Q=Ms(k,q),ne=Q.modelSlug$(),le=Xa(Q,n,q),{applyAction:Fe,eventName:Ce,eventType:tt}=Ya[j];Ol(B,q,Fe),Wr(j,le,n.serverThreadId,n.messageId,ne,k),ss(Ce,tt,Ne({magicEditId:q},ne?{modelSlug:ne}:{}))},e[46]=q,e[47]=n,e[48]=k,e[49]=B,e[50]=ie):ie=e[50];const et=ie;let Re;e[51]!==et?(Re=()=>et("accept"),e[51]=et,e[52]=Re):Re=e[52];const ht=Re;let Nt;e[53]!==et?(Nt=()=>et("reject"),e[53]=et,e[54]=Nt):Nt=e[54];const qt=Nt;let It;e[55]!==c||e[56]!==pt||e[57]!==ft?(It=j=>{if(j==="divider"){ft();return}if(j==="generate"){pt();return}const Q=Jl(j);if((Q==null?void 0:Q.kind)==="text-style"){const ne=c.current;if(!ne)return;ne.focus(),xa(ne,Q.id)}},e[55]=c,e[56]=pt,e[57]=ft,e[58]=It):It=e[58];const wt=It;let Xe,xt;e[59]!==be?(Xe=()=>{de.current=be},xt=[be],e[59]=be,e[60]=Xe,e[61]=xt):(Xe=e[60],xt=e[61]),p.useEffect(Xe,xt);let Vt,an;e[62]!==d?(Vt=()=>{we.current=d},an=[d],e[62]=d,e[63]=Vt,e[64]=an):(Vt=e[63],an=e[64]),p.useEffect(Vt,an);let cn,un;e[65]!==m?(cn=()=>{Se.current=m},un=[m],e[65]=m,e[66]=cn,e[67]=un):(cn=e[66],un=e[67]),p.useEffect(cn,un);let dn,fn;e[68]!==fe||e[69]!==c||e[70]!==wt||e[71]!==He||e[72]!==x||e[73]!==M||e[74]!==v||e[75]!==H||e[76]!==T?(dn=()=>{const j=A.current;if(!j)return;const{markdown:Q,maxLength:ne,isDisabled:le,editorClassName:Fe}=Ye.current,Ce=v.parse(Q!=null?Q:"");ve.current=Q;const tt=[ti(),v.inputRulesPlugin(),...M?[ra({includeMagicTextOption:x})]:[],...M?[gl()]:[],el(),v.keymapPlugin(),xr(lt(Ne({},yr),{"Mod-z":ni,"Mod-shift-z":Ps,"Mod-y":Ps})),Gl(le),sl(le,I.current),Ml(typeof ne=="number"?ne:null)];x&&(tt.push(vl()),tt.push(Fl()));const Ue=Er.create({doc:Ce,schema:v.schema(),plugins:tt}),it=new Mr({mount:j},{state:Ue,editable:()=>!le,attributes:{class:ce("ProseMirror",Fe),"aria-disabled":String(le)},dispatchTransaction(nt){const Qt=nt.getMeta(qe),Bt=Va(Qt)?Qt:null,vn=(Bt==null?void 0:Bt.type)==="execute"?Bt.commandId:null,Pn=nt.getMeta(Ln)===!0,jt=it.state.apply(nt);if(it.updateState(jt),L.syncFromState(jt,{isMagicEditEnabled:x},{docChanged:nt.docChanged}),vn&&wt(vn),!nt.docChanged||Pn)return;const ws=v.serialize(jt.doc);ve.current=ws,we.current(!0),de.current({content:ws})}});c.current=it,L.setView(it),L.syncFromState(it.state,{isMagicEditEnabled:x});const Et=it.dom,Xt=()=>{var nt;de.current.flush(),(nt=Se.current)==null||nt.call(Se),He()};return Et.addEventListener("blur",Xt,!0),()=>{Et.removeEventListener("blur",Xt,!0),de.current.flush(),it.destroy(),c.current=null,L.setView(null),se.current=null,H(null),fe(),$("")}},fn=[v,He,H,x,M,T,wt,fe,L,c],e[68]=fe,e[69]=c,e[70]=wt,e[71]=He,e[72]=x,e[73]=M,e[74]=v,e[75]=H,e[76]=T,e[77]=dn,e[78]=fn):(dn=e[77],fn=e[78]),p.useEffect(dn,fn);let gn,mn;e[79]!==me||e[80]!==c||e[81]!==w||e[82]!==re||e[83]!==r?(gn=()=>{const j=c.current;if(!j)return;j.setProps({editable:()=>!r,attributes:{class:ce("ProseMirror",me),"aria-disabled":String(r)}});const Q=Ht.getState(j.state),ne=tn.getState(j.state),le=(Q==null?void 0:Q.isDisabled)!==r,Fe=r||re,Ce=(ne==null?void 0:ne.isDisabled)!==Fe,tt=(ne==null?void 0:ne.placeholderText)!==w;if(le||Ce||tt){let Ue=j.state.tr;le&&(Ue=Kl(Ue,r)),(Ce||tt)&&(Ue=ol(Ue,{isDisabled:Fe,placeholderText:w})),j.dispatch(Ue)}},mn=[me,w,re,r,c],e[79]=me,e[80]=c,e[81]=w,e[82]=re,e[83]=r,e[84]=gn,e[85]=mn):(gn=e[84],mn=e[85]),p.useEffect(gn,mn);let pn,hn;e[86]!==c||e[87]!==x?(pn=()=>{const j=c.current;j&&L.syncFromState(j.state,{isMagicEditEnabled:x})},hn=[x,L,c],e[86]=c,e[87]=x,e[88]=pn,e[89]=hn):(pn=e[88],hn=e[89]),p.useEffect(pn,hn);let bn,xn;e[90]!==pe||e[91]!==H||e[92]!==G||e[93]!==Ee?(bn=()=>{if(pe){se.current=null,H(null);return}if(mt(G)){Ee(G.anchorPos,se);return}se.current=null,H(null)},xn=[pe,G,H,Ee],e[90]=pe,e[91]=H,e[92]=G,e[93]=Ee,e[94]=bn,e[95]=xn):(bn=e[94],xn=e[95]),p.useEffect(bn,xn);let yn,En;e[96]!==fe||e[97]!==c||e[98]!==r?(yn=()=>{if(!r)return;const j=c.current;j&&(nn(j),Ws(j)),fe()},En=[fe,r,c],e[96]=fe,e[97]=c,e[98]=r,e[99]=yn,e[100]=En):(yn=e[99],En=e[100]),p.useEffect(yn,En);let Mn,_n;e[101]!==oe||e[102]!==q||e[103]!==k?(Mn=()=>{qi(k,q?{type:"magic-edit",id:q}:oe?{type:"generate",id:oe}:null)},_n=[oe,q,k],e[101]=oe,e[102]=q,e[103]=k,e[104]=Mn,e[105]=_n):(Mn=e[104],_n=e[105]),p.useEffect(Mn,_n);let Sn,kn;e[106]!==c||e[107]!==u?(Sn=()=>{var Ce;const j=c.current;if(!j)return;const Q=zt.getState(j.state),ne=(Ce=Q==null?void 0:Q.maxLength)!=null?Ce:null,le=typeof u=="number"?u:null;if(ne===le)return;const Fe=_l(j.state.tr,le);j.dispatch(Fe)},kn=[u,c],e[106]=c,e[107]=u,e[108]=Sn,e[109]=kn):(Sn=e[108],kn=e[109]),p.useEffect(Sn,kn);let In,wn;e[110]!==c||e[111]!==o||e[112]!==v?(In=()=>{const j=c.current;if(!j||o===ve.current)return;ve.current=o;const Q=v.parse(o!=null?o:""),ne=j.state.tr.replaceWith(0,j.state.doc.content.size,Q.content);ne.setMeta(Ln,!0),j.dispatch(ne)},wn=[o,v,c],e[110]=c,e[111]=o,e[112]=v,e[113]=In,e[114]=wn):(In=e[113],wn=e[114]),p.useEffect(In,wn);const $o=mt(G),Tn=re||q!=null||oe!=null,Kn=Tn||ke;let Rn;e[115]!==Kn?(Rn=Kn?["generate"]:void 0,e[115]=Kn,e[116]=Rn):Rn=e[116];const Un=Rn,qn=!re&&$o?xe:void 0;let Yt;e:{if(!B){Yt=null;break e}if(x&&q){let j;e[117]!==q||e[118]!==B||e[119]!==ht||e[120]!==qt?(j=g.jsx(Js,{editorView:B,editorRootRef:S,activeEntryId:q,onAccept:ht,onReject:qt}),e[117]=q,e[118]=B,e[119]=ht,e[120]=qt,e[121]=j):j=e[121],Yt=j;break e}if(oe){const j=tc;let Q;e[122]!==oe||e[123]!==B||e[124]!==te||e[125]!==ge?(Q=g.jsx(Js,{editorView:B,editorRootRef:S,activeEntryId:oe,onAccept:te,onReject:ge,findSuggestionElement:j}),e[122]=oe,e[123]=B,e[124]=te,e[125]=ge,e[126]=Q):Q=e[126],Yt=Q;break e}Yt=null}const Vn=Yt;let vt;e[127]!==a?(vt=ce("writing-block-editor markdown-new-styling relative px-5 pt-4 pb-2 md:px-14 md:pt-12 md:pb-10",a),e[127]=a,e[128]=vt):vt=e[128];let Pt;e[129]!==U||e[130]!==V||e[131]!==i||e[132]!==Z||e[133]!==z.isCollapsed?(Pt=g.jsx(Aa,{editorAreaRef:A,isInlineWritingBlockEditEnabled:i,docChangeCount:U,selectionIsCollapsed:z.isCollapsed,isFormatToolbarOpen:V,magicEditTriggerCount:Z,onSelectNuxVisibilityChange:We}),e[129]=U,e[130]=V,e[131]=i,e[132]=Z,e[133]=z.isCollapsed,e[134]=Pt):Pt=e[134];let Cn;e[135]===Symbol.for("react.memo_cache_sentinel")?(Cn=g.jsx("div",{ref:A}),e[135]=Cn):Cn=e[135];let Dt;e[136]!==Un||e[137]!==Pe||e[138]!==re||e[139]!==M||e[140]!==J||e[141]!==G||e[142]!==qn?(Dt=M&&!re&&g.jsx(zo,{state:G,floatingRef:J,style:qn,dispatchSlashMenuMeta:Pe,disabledOptionIds:Un}),e[136]=Un,e[137]=Pe,e[138]=re,e[139]=M,e[140]=J,e[141]=G,e[142]=qn,e[143]=Dt):Dt=e[143];let At;e[144]!==B||e[145]!==re||e[146]!==(pe==null?void 0:pe.anchorPos)||e[147]!==Y||e[148]!==Ze||e[149]!==rt||e[150]!==ke?(At=re&&B&&g.jsx(Ta,{value:Y,onChange:$,onSubmit:()=>{rt()},onCancel:Ze,isLoading:ke,anchorPos:(Is=pe==null?void 0:pe.anchorPos)!=null?Is:null,editorView:B,editorRootRef:S}),e[144]=B,e[145]=re,e[146]=pe==null?void 0:pe.anchorPos,e[147]=Y,e[148]=Ze,e[149]=rt,e[150]=ke,e[151]=At):At=e[151];let Ot;e[152]!==B||e[153]!==Tn||e[154]!==_||e[155]!==r||e[156]!==ke||e[157]!==x||e[158]!==ae||e[159]!==v?(Ot=!r&&B&&g.jsx(ka,{editorView:B,intl:_,isMagicEditEnabled:x,hasActiveMagicEditEntry:Tn||ke,pmu:v,toolbarContentRef:P,onToolbarOpenChange:D,onMagicEditInvoked:_e,highlightMagicEdit:ae}),e[152]=B,e[153]=Tn,e[154]=_,e[155]=r,e[156]=ke,e[157]=x,e[158]=ae,e[159]=v,e[160]=Ot):Ot=e[160];let Lt;e[161]!==B||e[162]!==b||e[163]!==x||e[164]!==v?(Lt=b&&x&&B&&g.jsx(Ba,{editorView:B,pmu:v}),e[161]=B,e[162]=b,e[163]=x,e[164]=v,e[165]=Lt):Lt=e[165];let Nn;return e[166]!==Vn||e[167]!==vt||e[168]!==Pt||e[169]!==Dt||e[170]!==At||e[171]!==Ot||e[172]!==Lt?(Nn=g.jsxs("div",{ref:S,className:vt,children:[Pt,Cn,Dt,At,Vn,Ot,Lt]}),e[166]=Vn,e[167]=vt,e[168]=Pt,e[169]=Dt,e[170]=At,e[171]=Ot,e[172]=Lt,e[173]=Nn):Nn=e[173],Nn};function ec(t){return t+1}function tc(t,e){var n;return!t||!e?null:(n=t.querySelector("[data-generate-suggestion='".concat(e,"']")))!=null?n:null}const nc=2e4,sc=t=>{"use forget";const e=he.c(12),{editorViewRef:n,analyticsMetadata:o,isInlineWritingBlockEditEnabled:s,writingBlock:r,onChange:i,isStreaming:l,setDirty:a,flushPendingChanges:u,contentReferences:f,editorWrapperClassName:d,fullscreenMode:m}=t,c=m===void 0?!1:m,h=l||!s;let b;return e[0]!==o||e[1]!==f||e[2]!==n||e[3]!==d||e[4]!==u||e[5]!==c||e[6]!==s||e[7]!==i||e[8]!==a||e[9]!==h||e[10]!==r.content?(b=g.jsx(Ja,{editorViewRef:n,setDirty:a,analyticsMetadata:o,markdown:r.content,onChange:i,isDisabled:h,isInlineWritingBlockEditEnabled:s,maxLength:nc,flushPendingChanges:u,contentReferences:f,wrapperClassName:d,fullscreenMode:c}),e[0]=o,e[1]=f,e[2]=n,e[3]=d,e[4]=u,e[5]=c,e[6]=s,e[7]=i,e[8]=a,e[9]=h,e[10]=r.content,e[11]=b):b=e[11],b},oo=Ae(()=>De(()=>import("./kw08ajijqinojrwh.js").then(t=>t.yt),__vite__mapDeps([6,1,7])),{loading:t=>Oe(t)});function oc(t){"use forget";const e=he.c(6),{clientThreadId:n,permalink:o,isStreaming:s}=t,r=Yo();let i;e[0]===Symbol.for("react.memo_cache_sentinel")?(i=g.jsx(Ge,{id:"WritingBlockCloseButton.closeTooltip",defaultMessage:"Close"}),e[0]=i):i=e[0];let l;return e[1]!==n||e[2]!==s||e[3]!==r||e[4]!==o?(l=g.jsx(rn,{sideOffset:ln,label:i,children:o?g.jsx("button",{onClick:()=>r("/c/".concat(n)),className:"flex items-center px-2 py-2 select-none",children:g.jsx(oo,{})}):g.jsx(_r,{asChild:!0,children:g.jsx("button",{className:"flex items-center px-2 py-2 select-none",disabled:s,children:g.jsx(oo,{})})})}),e[1]=n,e[2]=s,e[3]=r,e[4]=o,e[5]=l):l=e[5],l}const rc=Ae(()=>De(()=>import("./iyn42bfr1ydmech0.js"),__vite__mapDeps([13,1])),{loading:t=>Oe(t)}),ic=Ae(()=>De(()=>import("./kspsmo2l8jg7uqdj.js"),__vite__mapDeps([14,1])),{loading:t=>Oe(t)});function lc({content:t,clientThreadId:e,messageId:n,contentReferences:o}){const s=Ct(),r=st(),i=Hn(),[l,a]=p.useState(!1),u=zr();return{handleCopy:async d=>{if(l)return;sn.logEventWithStatsig("ChatGPT Writing Block Copy Button Clicked","chatgpt_writing_block_copy_button_clicked",Ne({},$n({clientThreadId:e,messageId:n}))),ao.count(co.WRITING_BLOCKS,"chatgpt_writing_block_copy_button_clicked");const m=await Di(t,{preserveContentReferences:!0}),c=Sr(e);t!=null&&c!=null&&n!=null&&(sn.logStructuredEvent($r,{conversationId:c,messageId:n}),Hr(s,{type:"copy",source:"mouse",location:"writing-block",selectedText:m,messageId:n,serverThreadId:c,contentType:"text"}));let h={"text/plain":m};try{h=wi(m,o)}catch(b){Eo.addError(b)}Gr(h,i,d),a(!0),u(()=>a(!1),2e3)},Icon:l?ic:rc,copyLabel:r.formatMessage({id:"D5UU6P",defaultMessage:"Copy"})}}function ac(t){"use forget";const e=he.c(8),{clientThreadId:n,messageId:o,content:s,contentReferences:r}=t;let i;e[0]!==n||e[1]!==s||e[2]!==r||e[3]!==o?(i={clientThreadId:n,messageId:o,content:s,contentReferences:r},e[0]=n,e[1]=s,e[2]=r,e[3]=o,e[4]=i):i=e[4];const{handleCopy:l}=lc(i);let a;e[5]===Symbol.for("react.memo_cache_sentinel")?(a=ce(ms,"font-normal","px-2 py-2"),e[5]=a):a=e[5];let u;return e[6]!==l?(u=g.jsx(Kr,{onCopy:l,iconClassName:"icon-md",className:a,iconOnly:!0,tooltipSideOffset:ln}),e[6]=l,e[7]=u):u=e[7],u}const cc=Ae(()=>De(()=>import("./o6iejiso3ne57s04.js"),__vite__mapDeps([15,1])),{loading:t=>Oe(t)}),uc=Ae(()=>De(()=>import("./ftbklkne5vchqwja.js"),__vite__mapDeps([16,1])),{loading:t=>Oe(t)}),ro=Ae(()=>De(()=>import("./lvjyu0g61mv6vm3s.js"),__vite__mapDeps([17,1])),{loading:t=>Oe(t)});function dc({serverThreadId:t,messageId:e,index:n,title:o}){const s=Hn(),r=st(),[i,l]=p.useState(!1),a=!lo();if(!t)return null;const u=r.formatMessage({id:"writingblock.downloadFileError",defaultMessage:"Download failed. Please try again."});async function f(d){var m;l(!0);try{const c=await as.safePost("/export_doc/writing_block",{requestBody:{conversation_id:t,message_id:e,index:n,export_type:d},skipJsonTransform:!0});c.ok||s.danger(u);const h=await c.blob(),b=c.headers.get("Content-Disposition"),k=(m=Oi(b))!=null?m:"".concat((o!=null?o:"Export").replaceAll("/","-"),".").concat(d);Ai(h,k)}catch(c){Eo.addError(c,{tags:["type:writing_block_download_button","export_type:".concat(d)]}),s.danger(u)}finally{l(!1)}}return g.jsxs(bt.Root,{children:[g.jsx(rn,{sideOffset:ln,label:g.jsx(Ge,{id:"WritingBlockDownloadButton.downloadTooltip",defaultMessage:"Download"}),children:g.jsx(bt.BasicTrigger,{asChild:!0,children:g.jsx("button",{className:"flex items-center gap-1 px-2 py-2 select-none",disabled:i,children:a?i?g.jsx(As,{size:16}):g.jsx(ro,{className:"block"}):g.jsx("div",{className:ce("flex items-center gap-1",ms,"font-normal"),children:i?g.jsx(As,{size:20}):g.jsx(ro,{className:"block"})})})})}),g.jsx(bt.Portal,{children:g.jsxs(bt.Content,{align:"end",children:[g.jsx(bt.Label,{children:g.jsx(Ge,{id:"WritingBlockDownloadButton.menuTitle",defaultMessage:"Download"})}),g.jsx(bt.Item,{onSelect:()=>{f("pdf")},icon:cc,label:r.formatMessage({id:"WritingBlockDownloadButton.downloadPdf.label",defaultMessage:"PDF document"}),trailing:g.jsx("span",{children:r.formatMessage({id:"WritingBlockDownloadButton.downloadPdf.ext",defaultMessage:".pdf"})})}),g.jsx(bt.Item,{onSelect:()=>{f("docx")},icon:uc,label:r.formatMessage({id:"WritingBlockDownloadButton.downloadDocx.label",defaultMessage:"Microsoft Word"}),trailing:g.jsx("span",{children:r.formatMessage({id:"WritingBlockDownloadButton.downloadDocx.ext",defaultMessage:".docx"})})})]})})]})}const fc=Ae(()=>De(()=>import("./hdrss3fwjz1zjmw7.js"),__vite__mapDeps([18,1])),{loading:t=>Oe(t)});function gc(t){"use forget";const e=he.c(4),{isStreaming:n}=t;let o;e[0]===Symbol.for("react.memo_cache_sentinel")?(o=g.jsx(Ge,{id:"WritingBlockExpandButton.expandTooltip",defaultMessage:"Expand"}),e[0]=o):o=e[0];let s;e[1]===Symbol.for("react.memo_cache_sentinel")?(s=g.jsx(fc,{}),e[1]=s):s=e[1];let r;return e[2]!==n?(r=g.jsx(rn,{sideOffset:ln,label:o,children:g.jsx(kr,{asChild:!0,children:g.jsx("button",{className:"flex items-center px-2 py-2 select-none",disabled:n,children:s})})}),e[2]=n,e[3]=r):r=e[3],r}function mc(t){"use forget";var h;const e=he.c(11),{content:n}=t,o=Ir(),s=wr(pc),r=s==null?void 0:s.selectionIsEditable;let i;e[0]!==(s==null?void 0:s.selection)?(i=(h=s==null?void 0:s.selection)==null?void 0:h.trim(),e[0]=s==null?void 0:s.selection,e[1]=i):i=e[1];const l=!!i,a=!!r;let u;e[2]!==n||e[3]!==o?(u=()=>{o&&o.insertTextFromWebContent(n)},e[2]=n,e[3]=o,e[4]=u):u=e[4];const f=u;if(!o||r===null)return null;const d=!a;let m;e[5]!==l?(m=l?g.jsx(Ge,{id:"SjFYnK",defaultMessage:"Update"}):g.jsx(Ge,{id:"8SKT1J",defaultMessage:"Insert"}),e[5]=l,e[6]=m):m=e[6];let c;return e[7]!==f||e[8]!==d||e[9]!==m?(c=g.jsx(Tr,{color:"secondary",type:"button",onClick:f,disabled:d,children:m}),e[7]=f,e[8]=d,e[9]=m,e[10]=c):c=e[10],c}function pc(){return Rr.context$()}const hc=Ae(()=>De(()=>import("./eahncmechdd0yy5s.js"),__vite__mapDeps([19,1])),{loading:t=>Oe(t)});function bc({content:t,clientThreadId:e,title:n,messageId:o,messageRef:s}){const r=st(),i=Ur(e);function l(){qr.logButtonClick(Vr.OPEN_IN_CANVAS_WRITING_BLOCK),s.current&&Yr(s.current);const a=Xr.DOCUMENT;sn.logEventWithStatsig("ChatGPT Writing Block Edit in Canvas Button Clicked","chatgpt_writing_block_edit_in_canvas_button_clicked",Ne({},$n({clientThreadId:e,messageId:o}))),i({title:n!=null?n:r.formatMessage({id:"2V9CtJ",defaultMessage:"New document"}),textdocType:a,content:t,createSource:Qr.MESSAGE_WRITING_BLOCK})}return g.jsx("button",{className:"flex items-center px-1.5 py-1 select-none",onClick:l,children:g.jsx(rn,{label:g.jsx(Ge,{id:"WritingBlockOpenCanvasButton.openTooltip",defaultMessage:"Edit in Canvas"}),children:g.jsx(hc,{className:"icon-md block"})})})}const xc=t=>{"use forget";const e=he.c(64),{primaryLabel:n,primaryAction:o,writingBlock:s,clientThreadId:r,messageId:i,isInlineWritingBlockExportEnabled:l,isWritingBlockFocusedModeEnabled:a,serverThreadId:u,shouldShowWritingBlockCanvasEdit:f,title:d,index:m,messageRef:c,autosaveStatus:h,hideDownloadButton:b,contentReferences:k,fullscreenMode:_,isStreaming:C,permalink:w,className:I}=t,E=b===void 0?!1:b,R=_===void 0?!1:_,y=Ct();let x;e[0]!==y?(x=()=>Cr(y),e[0]=y,e[1]=x):x=e[1];const N=fo(x);let M;e[2]!==y?(M=Gt(y,"1600402835"),e[2]=y,e[3]=M):M=e[3];let O;e[4]!==y?(O=Gt(y,"3877999974"),e[4]=y,e[5]=O):O=e[5];const T=O,v=!1,S="idle";let A;e:{A="text-token-text-primary/35";break e}const P=A;let W;e[6]!==R||e[7]!==T||e[8]!==N||e[9]!==s?(W=!R&&N&&s.content.trim().length>0&&T,e[6]=R,e[7]=T,e[8]=N,e[9]=s,e[10]=W):W=e[10];const L=W,B=R?"rounded-none":"rounded-2xl",G=L?"ps-3.5 pe-1.5":"ps-5 pe-2";let K;e[11]!==I||e[12]!==B||e[13]!==G?(K=ce(Li,"flex w-full items-center justify-between gap-3 py-1.5 font-sans",B,G,I),e[11]=I,e[12]=B,e[13]=G,e[14]=K):K=e[14];let q;e[15]!==n?(q=n!=null?n:g.jsx(Ge,{id:"Ui6xge",defaultMessage:"Writing"}),e[15]=n,e[16]=q):q=e[16];let z;e[17]!==P||e[18]!==S||e[19]!==v?(z=v,e[17]=P,e[18]=S,e[19]=v,e[20]=z):z=e[20];let U;e[21]!==q||e[22]!==z?(U=g.jsxs("div",{className:"text-token-text-primary flex max-w-[75%] flex-grow cursor-default items-center gap-2 text-sm font-medium",children:[q,z]}),e[21]=q,e[22]=z,e[23]=U):U=e[23];let Y;e[24]!==r||e[25]!==k||e[26]!==i||e[27]!==s?(Y=r&&i&&g.jsx(ac,{content:s.content,clientThreadId:r,messageId:i,contentReferences:k}),e[24]=r,e[25]=k,e[26]=i,e[27]=s,e[28]=Y):Y=e[28];let $;e[29]!==E||e[30]!==m||e[31]!==l||e[32]!==i||e[33]!==u||e[34]!==d?($=!E&&l&&u&&i&&g.jsx(dc,{serverThreadId:u,messageId:i,title:d,index:m}),e[29]=E,e[30]=m,e[31]=l,e[32]=i,e[33]=u,e[34]=d,e[35]=$):$=e[35];let V;e[36]!==r||e[37]!==i||e[38]!==c||e[39]!==f||e[40]!==d||e[41]!==s?(V=r&&i&&f&&g.jsx(bc,{content:s.content,clientThreadId:r,messageId:i,title:d,messageRef:c}),e[36]=r,e[37]=i,e[38]=c,e[39]=f,e[40]=d,e[41]=s,e[42]=V):V=e[42];let D;e[43]!==L||e[44]!==s?(D=L&&g.jsx("div",{className:"ps-2",children:g.jsx(mc,{content:s.content})}),e[43]=L,e[44]=s,e[45]=D):D=e[45];let Z;e[46]!==r||e[47]!==R||e[48]!==C||e[49]!==a||e[50]!==i||e[51]!==w?(Z=r&&i&&a&&g.jsx("div",{className:ce(C&&"pointer-events-none",!C&&"dark:hover:text-token-text-primary hover:text-token-text-primary"),children:R?g.jsx(oc,{clientThreadId:r,permalink:w,isStreaming:C}):g.jsx(gc,{isStreaming:C})}),e[46]=r,e[47]=R,e[48]=C,e[49]=a,e[50]=i,e[51]=w,e[52]=Z):Z=e[52];let ee;e[53]!==o||e[54]!==Y||e[55]!==$||e[56]!==V||e[57]!==D||e[58]!==Z?(ee=g.jsxs("div",{className:"flex items-center justify-between",children:[Y,$,V,o,D,Z]}),e[53]=o,e[54]=Y,e[55]=$,e[56]=V,e[57]=D,e[58]=Z,e[59]=ee):ee=e[59];let ae;return e[60]!==K||e[61]!==U||e[62]!==ee?(ae=g.jsx("div",{className:"thread-xl:-top-[var(--header-height)] sticky top-0 z-1",children:g.jsxs("div",{className:K,children:[U,ee]})}),e[60]=K,e[61]=U,e[62]=ee,e[63]=ae):ae=e[63],ae};function Yc(t){"use forget";const e=he.c(39),{analyticsMetadata:n,primaryLabel:o,primaryAction:s,subHeader:r,showHeader:i,headerClassName:l,hasBeenEdited:a,autosaveStatus:u,clientThreadId:f,messageId:d,isInlineWritingBlockExportEnabled:m,isWritingBlockFocusedModeEnabled:c,serverThreadId:h,shouldShowWritingBlockCanvasEdit:b,title:k,index:_,messageRef:C,editorViewRef:w,isInlineWritingBlockEditEnabled:I,writingBlock:E,onChange:R,isStreaming:y,setDirty:x,flushPendingChanges:N,contentReferences:M,permalink:O,editorWrapperClassName:T}=t,v=i===void 0?!0:i;let S;e[0]!==u||e[1]!==f||e[2]!==M||e[3]!==a||e[4]!==l||e[5]!==_||e[6]!==m||e[7]!==c||e[8]!==d||e[9]!==C||e[10]!==O||e[11]!==s||e[12]!==o||e[13]!==h||e[14]!==b||e[15]!==v||e[16]!==k||e[17]!==E?(S=v&&g.jsx(xc,{primaryLabel:o,primaryAction:s,hasBeenEdited:a,autosaveStatus:u,writingBlock:E,clientThreadId:f,messageId:d,isInlineWritingBlockExportEnabled:m,isWritingBlockFocusedModeEnabled:c,serverThreadId:h,shouldShowWritingBlockCanvasEdit:b,title:k,index:_,messageRef:C,contentReferences:M,fullscreenMode:!0,hideDownloadButton:E.variant===Bn.EMAIL,permalink:O,className:l}),e[0]=u,e[1]=f,e[2]=M,e[3]=a,e[4]=l,e[5]=_,e[6]=m,e[7]=c,e[8]=d,e[9]=C,e[10]=O,e[11]=s,e[12]=o,e[13]=h,e[14]=b,e[15]=v,e[16]=k,e[17]=E,e[18]=S):S=e[18];const A=E.variant===Bn.EMAIL?"pe-10":"md:p-4";let P;e[19]!==A?(P=ce("flex-1 overflow-y-auto",A),e[19]=A,e[20]=P):P=e[20];let W;e[21]!==n||e[22]!==M||e[23]!==w||e[24]!==T||e[25]!==N||e[26]!==I||e[27]!==y||e[28]!==R||e[29]!==x||e[30]!==E?(W=g.jsx(sc,{editorViewRef:w,analyticsMetadata:n,setDirty:x,isInlineWritingBlockEditEnabled:I,writingBlock:E,onChange:R,isStreaming:y,flushPendingChanges:N,contentReferences:M,editorWrapperClassName:T,fullscreenMode:!0}),e[21]=n,e[22]=M,e[23]=w,e[24]=T,e[25]=N,e[26]=I,e[27]=y,e[28]=R,e[29]=x,e[30]=E,e[31]=W):W=e[31];let L;e[32]!==P||e[33]!==W?(L=g.jsx("div",{className:P,children:W}),e[32]=P,e[33]=W,e[34]=L):L=e[34];let B;return e[35]!==r||e[36]!==S||e[37]!==L?(B=g.jsxs("div",{className:"writing-block-focused-view flex flex-1 flex-col overflow-y-auto",children:[S,r,L]}),e[35]=r,e[36]=S,e[37]=L,e[38]=B):B=e[38],B}export{Uc as E,Bn as W,qc as a,Kc as b,Yc as c,xc as d,es as e,sc as f,Gc as g,Hc as h,$c as p,Vc as u};
//# sourceMappingURL=ccwkzjxugf5q7bsx.js.map
