const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/g7h319605qm8xvdh.js","assets/kfrdmkli83ureki3.js","assets/kw08ajijqinojrwh.js","assets/root-fi49nzd2.css","assets/fyw02vlaiv2vq6cj.js","assets/conversation-small-lq38g8zw.css","assets/i5i93v71imxwxy0p.js","assets/d5bc8trtxeukg3jk.js","assets/ow8ta8vb5wq2n5po.js","assets/o106qsyr0ujbylfd.js","assets/ctib2y4ffaxo1j08.js","assets/i2xcq18jqk3a4idk.js","assets/fz0860lkhp7je3od.js","assets/gljkwjomy29v9c26.js","assets/meym1wib9md0wcei.js","assets/mq60ebbg8rx7y6z4.js","assets/koea7l5qbjcndn3s.js","assets/fbnp4n11buhgth4v.js","assets/crl8f3ggvylz4ls6.js"])))=>i.map(i=>d[i]);
var ra=Object.freeze,la=Object.defineProperty,So=Object.defineProperties;var To=Object.getOwnPropertyDescriptors;var ss=Object.getOwnPropertySymbols;var ca=Object.prototype.hasOwnProperty,ua=Object.prototype.propertyIsEnumerable;var da=(o,a,n)=>a in o?la(o,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[a]=n,X=(o,a)=>{for(var n in a||(a={}))ca.call(a,n)&&da(o,n,a[n]);if(ss)for(var n of ss(a))ua.call(a,n)&&da(o,n,a[n]);return o},be=(o,a)=>So(o,To(a));var ga=(o,a)=>{var n={};for(var s in o)ca.call(o,s)&&a.indexOf(s)<0&&(n[s]=o[s]);if(o!=null&&ss)for(var s of ss(o))a.indexOf(s)<0&&ua.call(o,s)&&(n[s]=o[s]);return n};var ys=(o,a)=>ra(la(o,"raw",{value:ra(a||o.slice())}));import{_ as Ee,r as l,j as e,M as xe,e as Co,R as Wa,o as yo}from"./kfrdmkli83ureki3.js";import{i8 as Mo,h$ as ma,bx as Ao,i9 as ha,ia as Eo,ib as pa,ic as jo,id as qa,cB as wo,cC as Po,cD as ko,ie as Fo,aN as Ro,aA as No,ig as Do,ih as Oo,ii as Ho,cF as Vo,ij as Lo,cL as $a,ik as Bo,gN as Uo,il as fa,ah as Go,im as Wo,c_ as ws,io as qo,hK as $o,ip as zo,M as Ko,iq as Qo,ir as Jo,is as Xo,it as Yo,iu as Zo,iv as ba,iw as ei,aj as va,ix as si,iy as ti,iz as ai,iA as ni,iB as oi,iC as ii,ca as ri,iD as di,iE as li,iF as ci,iG as ui,iH as gi,iI as mi,iJ as hi,az as za,ay as Ps,iK as pi,iL as fi,iM as bi,iN as vi,iO as xa,iP as xi,iQ as _i,iR as Ii,iS as Si,iT as _a,iU as Ti,iV as Ci,iW as yi,iX as Mi,iY as Ai,iZ as Ei,i_ as ji,i$ as wi,j0 as Pi,j1 as ki,j2 as Fi,e8 as Ri,j3 as Ni,j4 as Di,j5 as Oi,j6 as Hi,h0 as Ka,ey as Vi,j7 as Li,j8 as Bi,j9 as Ui,ja as Gi,jb as Wi,jc as qi,jd as $i,je as zi,gP as Ki,jf as Qi,jg as Ji,jh as Xi,ji as Yi,jj as Zi,jk as er,jl as sr,fs as Ia,jm as tr,jn as ar}from"./fyw02vlaiv2vq6cj.js";import{az as je,cv as Qa,O as ns,eZ as C,hM as Ja,V as L,ay as z,cy as ge,qq as Xa,dP as nr,mX as or,M as ve,l as _e,ab as Rs,P as Ge,jj as ir,ao as Ya,aB as Za,ia as en,R as rr,A as dr,bl as Sa,D as ks,u as Ns,dk as lr,j9 as cr,x as ur,bp as gr,fi as mr,d4 as hr,d5 as pr,i5 as fr,fF as br,d as ae,i3 as Ms,a9 as vr,J as Ne,a6 as Be,ep as xr,w as _r,kf as Ir,H as Sr,i as Tr,mY as Cr,mW as yr,aw as Mr,ak as Ar,N as Er,_ as De,aT as Ue,co as jr,a2 as ts,qr as wr,e3 as sn,ku as Pr,aa as As,qs as Ta,eA as kr,qt as Fr,av as Ca,qu as Rr,bJ as Nr,bK as Dr,dU as Or,dj as ya,jV as as,ax as Ma,bx as Hr,jN as Vr,d_ as Lr,Q as Br,p6 as Ur,mz as Gr,aA as Wr,z as Ds,bk as tn,fa as Aa,qv as qr,b as $r,aV as zr,aW as Kr,n3 as Qr,eP as Jr,f9 as Xr,fM as Yr,i6 as Zr,br as ed,lY as Ea,aN as sd}from"./kw08ajijqinojrwh.js";import{C as Fs}from"./he1xnididjbc7s63.js";import{T as td,U as ad,A as nd}from"./m93ibzwrrpoc1bdm.js";import{S as od}from"./nunatmpame7vjusr.js";import{b as id,c as rd}from"./c326bjybavj646xd.js";const ja=je(()=>Ee(()=>import("./g7h319605qm8xvdh.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(o=>o.MemoryActionResult));function wa(o,a,n){_e(o,s=>{Rs.updateTree(s,d=>{d.updateNodeMetadata(a,{inlineComparisonRating:n})})})}const Pa=({messages:o})=>{for(const{metadata:a}of o){const{paragen_display_label:n}=a!=null?a:{};if(n)return n;const{augmented_paragen_prompt_label:s}=a!=null?a:{};if(s)return s}};function ka({displayedMessages:o,message:a,conversationTurnMountTime:n,visibilityState:s}){var g,p;const d={},b=((g=a.clientMetadata)==null?void 0:g.variantsInStreamInfo)==null&&((p=a.metadata)==null?void 0:p.paragen_variants_info)!=null;return o.forEach((v,O)=>{const H=b?{load_first_token_time:n,load_end_time:n}:{load_first_token_time:v.loadFirstTokenTime,load_end_time:v.loadEndTime},u=O===0?{rendered_height:s.left_rendered_height}:{rendered_height:s.right_rendered_height};d[v.messageId]=X(X({},H),u)}),d}function dd(o){const a=l.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null,left_rendered_height:null,right_rendered_height:null}),n=l.useRef({left:null,right:null});return o.variantIds.length<2?e.jsx(an,X({setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:a,firstVisibleTokenTimestampsRef:n},o)):e.jsx(ld,be(X({},o),{visibilityStateRef:a,firstVisibleTokenTimestampsRef:n}))}function ld(o){const{conversation:a,variantIds:n,turnIndex:s,firstVisibleTokenTimestampsRef:d}=o;if(n.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const b=Xa(),g=nr(),[p,v]=n,O=l.useMemo(()=>or(p+v)()>=.5,[p,v]),[H,u]=O?[v,p]:[p,v],[B,F,w]=ve(a.id,U=>{var I,D,k,G,i,K,T,le,S,se,ce,Ie,M,E,Y,f,Q,ne,W,Se;const P=Sa(U).tree.getLeafFromNode(H).id,R=Sa(U).tree.getLeafFromNode(u).id,A=L.getConversationTurns(U,P),c=L.getConversationTurns(U,R),$=s<A.length?A[s]:null,N=s<c.length?c[s]:null;return $||ks.addError("Paragen Left turn index ".concat(s," out of bounds"),{turnIndex:s,turnCount:A.length,lastTurnRole:(I=C(A))==null?void 0:I.role,lastMessageAuthor:(k=C((D=C(A))==null?void 0:D.messages))==null?void 0:k.author,lastMessageContentType:(i=C((G=C(A))==null?void 0:G.messages))==null?void 0:i.content.content_type,lastMessageMetadata:(T=C((K=C(A))==null?void 0:K.messages))==null?void 0:T.metadata,altTurnCount:c.length,altLastTurnRole:(le=C(c))==null?void 0:le.role,altLastMessageRole:(se=C((S=C(c))==null?void 0:S.messages))==null?void 0:se.author.role}),N||ks.addError("Paragen Right turn index ".concat(s," out of bounds"),{turnIndex:s,turnCount:c.length,lastTurnRole:(ce=C(c))==null?void 0:ce.role,lastMessageAuthor:(M=C((Ie=C(c))==null?void 0:Ie.messages))==null?void 0:M.author,lastMessageContentType:(Y=C((E=C(c))==null?void 0:E.messages))==null?void 0:Y.content.content_type,lastMessageMetadata:(Q=C((f=C(c))==null?void 0:f.messages))==null?void 0:Q.metadata,altTurnCount:A.length,altLastTurnRole:(ne=C(A))==null?void 0:ne.role,altLastMessageRole:(Se=C((W=C(A))==null?void 0:W.messages))==null?void 0:Se.author.role}),[P,$,N]}),[x,_]=O?[w,F]:[F,w],J="skippable_parallel_2_in_stream:a:1.5";l.useEffect(()=>(pa.setState({displayingSideBySideFeedback:!0}),()=>{pa.setState({displayingSideBySideFeedback:!1})}),[]);const y=l.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null,left_rendered_height:null,right_rendered_height:null}),ee=l.useCallback((U,{shouldSubmitParagenFeedback:P=!0}={})=>{if(!F||!w||!x||!_)throw new Error("Expected both turns to exist");_e(a.id,k=>{Rs.setCurrentBranch(k,U)});const R=U===H,A=U===p;x.messages.length>0&&wa(a.id,x.messages[x.messages.length-1].id,A?"original":"new"),_.messages.length>0&&wa(a.id,_.messages[_.messages.length-1].id,A?"original":"new");const c=Ge(a.id),$=[F,w].map((k,G)=>{var i,K,T;return{messageId:k.messages[k.messages.length-1].id,loadFirstTokenTime:G===0?d.current.left:d.current.right,loadEndTime:(T=(K=(i=C(k.messages))==null?void 0:i.clientMetadata)==null?void 0:K.completionSampleFinishTime)!=null?T:null}}),N=R?$[0].messageId:$[1].messageId,I=L.getParentPromptNode(ns(a.id),B);if(!I)throw new Error("Expected prompt for side by side feedback");const D=ka({displayedMessages:$,message:I.message,conversationTurnMountTime:o.conversationTurnMountTime,visibilityState:y.current});P&&Oa({params:{conversation_id:c,displayed_message_ids:$.map(k=>k.messageId),message_metadatas:D,rating:"selected",selected_message_id:N,source_timestamp:Date.now(),ui_variant:1,user_prompt_message_id:I.message.id}})},[a.id,H,p,x,_,F,w,B,d,o.conversationTurnMountTime,y]);return l.useEffect(()=>ir(Ya,{requestCompletion:U=>{const P=Ge(a.id),R=L.getParentPromptNode(ns(a.id),B);if(!R)throw new Error("Expected prompt for side by side feedback");if(!F||!w)throw new Error("Expected both turns to exist");const A=[F,w].map((N,I)=>{var D,k,G;return{messageId:N.messages[N.messages.length-1].id,loadFirstTokenTime:I===0?d.current.left:d.current.right,loadEndTime:(G=(k=(D=C(N.messages))==null?void 0:D.clientMetadata)==null?void 0:k.completionSampleFinishTime)!=null?G:null}}),c=ka({displayedMessages:A,message:R.message,conversationTurnMountTime:o.conversationTurnMountTime,visibilityState:y.current}),$=U.isForSkippingParagen;Oa({params:{conversation_id:P,displayed_message_ids:A.map(N=>N.messageId),message_metadatas:c,rating:$?"explicit_skipped":"skipped",selected_message_id:null,source_timestamp:Date.now(),ui_variant:$?3:1,user_prompt_message_id:R.message.id}}),$&&ee(H,{shouldSubmitParagenFeedback:!1})}}),[F,w,B,a.id,o.conversationTurnMountTime,J,x==null?void 0:x.messages,_==null?void 0:_.messages,g,d,ee,H,y]),e.jsx(an,be(X({},o),{setPreferredFeedback:ee,leftVariantId:H,rightVariantId:u,leftTurn:F,rightTurn:w,hasActiveRequest:b,originalTurn:x,visibilityStateRef:y}))}function an(O){var H=O,{setPreferredFeedback:o,leftVariantId:a,rightVariantId:n,leftTurn:s,rightTurn:d,hasActiveRequest:b,originalTurn:g,visibilityStateRef:p}=H,v=ga(H,["setPreferredFeedback","leftVariantId","rightVariantId","leftTurn","rightTurn","hasActiveRequest","originalTurn","visibilityStateRef"]);var ce,Ie,M;const u=(ce=s&&Pa(s))!=null?ce:null,B=(Ie=d&&Pa(d))!=null?Ie:null,F=l.useMemo(()=>{var E;return(E=s==null?void 0:s.messages)!=null?E:[]},[s==null?void 0:s.messages]),w=l.useMemo(()=>{var E;return(E=d==null?void 0:d.messages)!=null?E:[]},[d==null?void 0:d.messages]),{avatarClassName:x,firstVisibleTokenTimestampsRef:_}=v,J=l.useMemo(()=>{var E;return(E=s==null?void 0:s.messageGroups)!=null?E:[]},[s==null?void 0:s.messageGroups]),y=l.useMemo(()=>{var E;return(E=d==null?void 0:d.messageGroups)!=null?E:[]},[d==null?void 0:d.messageGroups]),ee=Mo(),U=ns(v.conversation.id),P=C(s==null?void 0:s.messages),R=C(d==null?void 0:d.messages),A=Ja(L.getRequestId(U,(M=P==null?void 0:P.id)!=null?M:R==null?void 0:R.id)),c=A&&!(P!=null&&P.end_turn),$=A&&!(R!=null&&R.end_turn),N=P!=null&&ma(P),I=R!=null&&ma(R),D=N!=null?N:I,k=(s==null?void 0:s.role)===z.User,G=(d==null?void 0:d.role)===z.User,i=l.useRef(null),K=l.useRef(null),T=l.useRef(null),le=s!=null,S=d!=null;!le&&_.current.left==null&&(_.current.left=Date.now()),!S&&_.current.right==null&&(_.current.right=Date.now()),l.useEffect(()=>{if(i.current&&K.current&&T.current){const E=Array(11).fill(0).map((f,Q)=>Q/10),Y=new IntersectionObserver(f=>f.forEach(Q=>{var ne,W,Se,we,We,Oe;Q.target===K.current?((W=(ne=p.current).left_visibility_initial)!=null||(ne.left_visibility_initial=Q.intersectionRatio),p.current.left_visibility_max=Math.max((Se=p.current.left_visibility_max)!=null?Se:0,Q.intersectionRatio)):Q.target===T.current&&((We=(we=p.current).right_visibility_initial)!=null||(we.right_visibility_initial=Q.intersectionRatio),p.current.right_visibility_max=Math.max((Oe=p.current.right_visibility_max)!=null?Oe:0,Q.intersectionRatio))}),{root:i.current,threshold:E});return Y.observe(K.current),Y.observe(T.current),()=>Y.disconnect()}},[p]),l.useEffect(()=>{const E=K.current,Y=T.current;if(!E||!Y)return;let f=null;const Q=()=>{f!=null&&cancelAnimationFrame(f),f=requestAnimationFrame(()=>{if(E.isConnected){const W=Math.round(E.getBoundingClientRect().height);p.current.left_rendered_height=W}if(Y.isConnected){const W=Math.round(Y.getBoundingClientRect().height);p.current.right_rendered_height=W}})},ne=new ResizeObserver(Q);return ne.observe(E),ne.observe(Y),Q(),()=>{f!=null&&cancelAnimationFrame(f),ne.disconnect()}},[p]);const{data:se}=Ao(void 0,!1,ee);return e.jsxs("div",{className:"relative flex flex-col",children:[e.jsx("div",{className:"bg-token-main-surface-primary sticky top-[-1px] z-1 px-(--thread-content-margin) text-center text-lg text-pretty md:static","data-testid":"paragen-feedback-title",children:e.jsx(xe,{id:"KKeSJV",defaultMessage:"You're giving feedback on a new version of ChatGPT."})}),e.jsx("div",{className:"text-token-text-secondary px-(--thread-content-margin) pt-1 pb-5 text-center text-sm text-pretty",children:e.jsx(xe,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})}),e.jsx("div",{className:ge(Eo("default"),"horzScrollShadows relative -mb-2 snap-x snap-mandatory overflow-x-auto overflow-y-clip pb-4"),ref:i,children:e.jsxs("div",{className:ge("mx-auto box-content max-w-[calc(2*var(--thread-content-max-width))] min-w-min px-(--thread-content-margin)","flex items-start gap-4 sm:gap-6"),children:[e.jsxs(Fa,{rootElementRef:K,onClick:()=>{o(a)},hasActiveRequest:b,isImageGenInProgress:D,children:[e.jsxs(Na,{children:[e.jsx(ha,{messages:F,isUserTurn:k,avatarClassName:x}),e.jsx(Ra,{children:e.jsx(xe,be(X({},Ha.responseNumber),{values:{responseIndex:1,display_label:u?" ".concat(u):""}}))})]}),e.jsxs(e.Fragment,{children:[se!=null&&!k&&e.jsx(ja,{clientThreadId:v.conversation.id,messages:F,isParagen:!0}),e.jsx(Fs,be(X({},v),{allMessages:F,groupedMessagesToRender:J,allGroupedMessages:J,isUserTurn:k,isFinalUserTurn:!1,isFinalAssistantTurn:!1,isCompletionRequestInProgress:c,hasActiveRequest:b,shouldGrowContainer:!1,isParagen:!0})),e.jsx(Da,{clientThreadId:v.conversation.id,conversationTurnMountTime:v.conversationTurnMountTime,turn:s,originalTurn:g})]})]}),e.jsxs(Fa,{rootElementRef:T,onClick:()=>{o(n)},hasActiveRequest:b,isImageGenInProgress:D,children:[e.jsxs(Na,{children:[e.jsx(ha,{messages:w,isUserTurn:G,avatarClassName:x}),e.jsx(Ra,{children:e.jsx(xe,be(X({},Ha.responseNumber),{values:{responseIndex:2,display_label:B?" ".concat(B):""}}))})]}),e.jsxs(e.Fragment,{children:[se!=null&&!G&&e.jsx(ja,{clientThreadId:v.conversation.id,messages:w,isParagen:!0}),e.jsx(Fs,be(X({},v),{allMessages:w,groupedMessagesToRender:y,allGroupedMessages:y,isFinalUserTurn:!1,isFinalAssistantTurn:!1,isUserTurn:G,isCompletionRequestInProgress:$,hasActiveRequest:b,shouldGrowContainer:!1,isParagen:!0})),e.jsx(Da,{clientThreadId:v.conversation.id,conversationTurnMountTime:v.conversationTurnMountTime,turn:d,originalTurn:g})]})]})]})})]})}function Fa({rootElementRef:o,onClick:a,children:n,hasActiveRequest:s,isImageGenInProgress:d}){const b=l.useRef(null),g=l.useRef(null),p=l.useRef(null);return e.jsx("div",{"data-paragen-root":!0,className:"border-token-border-tertiary @container relative flex min-w-[min(450px,80cqw,80vw)] flex-1 snap-center flex-col gap-1 rounded-xl border text-start shadow-lg shadow-black/3",ref:o,children:e.jsxs("div",{className:ge(jo,"px-(--thread-content-margin) py-4"),children:[e.jsx("div",{className:ge("absolute top-48 right-0! left-0! h-px","invisible"),ref:b}),e.jsx("div",{className:ge("absolute top-48 right-0! bottom-0 left-0!","invisible"),ref:g}),e.jsx("div",{className:ge("absolute right-0! bottom-0 left-0! h-px","invisible"),ref:p}),n,s||d?null:e.jsx(Za,{className:"mt-4 self-start",onClick:a,"data-testid":"paragen-prefer-response-button",children:e.jsx(xe,{id:"U2EAH6",defaultMessage:"I prefer this response"})})]})})}var Ua;const Ra=Qa.div(Ua||(Ua=ys(["text-sm text-token-text-secondary font-semibold"])));var Ga;const Na=Qa.div(Ga||(Ga=ys(["flex gap-4 items-center mb-1"])));function Da({clientThreadId:o,conversationTurnMountTime:a,turn:n,originalTurn:s}){var u,B,F,w,x,_;const d=en();if(!d.showParagenMetadata||!d.showDebugConversationTurns&&!d.forceParagen||n==null)return null;let b=n===s?"ORIGINAL":"NEW";const g=n.messages[n.messages.length-1],p=(u=g==null?void 0:g.metadata)==null?void 0:u.__internal,v=(B=g==null?void 0:g.metadata)==null?void 0:B.paragen_display_label;if(p){const{model_id:J,model_definition_slug:y,model_definition_virtual_model_id:ee,alternative_model_selection_rule:U,augmented_paragen_prompt_group_id:P,augmented_paragen_prompt_id:R,augmented_paragen_prompt:A}=p;J&&(b+="\nModel ID: ".concat(J)),y&&(b+="\nModel Slug: ".concat(y)),ee&&(b+="\nVirtual Model ID: ".concat(ee)),U&&(b+="\nAlternative Model Rule: ".concat(U)),P&&(b+="\nPrompt Group ID: ".concat(P)),R&&(b+="\nPrompt ID: ".concat(R)),A&&(b+="\nPrompt: ".concat(A)),v&&(b+="\nDisplay Label: ".concat(v))}b+="\nMessage ID: ".concat(g.id);const O=L.getParentPromptNode(ns(o),n.messages[0].id);if(!O)throw new Error("Expected prompt for side by side feedback");const H=((F=O.message.clientMetadata)==null?void 0:F.variantsInStreamInfo)==null&&((w=O.message.metadata)==null?void 0:w.paragen_variants_info)!=null;return b+="\nUser prompt message ID: ".concat(O.message.id),b+="\nIs Persisted Paragen? ".concat(H),b+="\nCompletion Sample Finish Time: ".concat(H?"".concat(a," (persisted)"):(_=(x=C(n.messages))==null?void 0:x.clientMetadata)==null?void 0:_.completionSampleFinishTime),e.jsx("div",{className:"text-sm whitespace-pre-wrap text-red-500",children:b})}async function Oa({params:o}){await rr.safePost("/paragen_submission",{requestBody:o,authOption:dr.SendIfAvailable})}const Ha=Co({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}{display_label}"}}),cd=je(()=>Ee(()=>import("./d5bc8trtxeukg3jk.js"),__vite__mapDeps([7,1])),{loading:o=>Wr(o)}),ud=je(()=>Ee(()=>import("./g7h319605qm8xvdh.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(o=>o.MemoryActionResult)),gd=je(()=>Ee(()=>import("./ow8ta8vb5wq2n5po.js"),__vite__mapDeps([8,1,2,3,4,5,9])).then(o=>o.AutomationSourceHeader)),Va=je(()=>Ee(()=>import("./ctib2y4ffaxo1j08.js"),__vite__mapDeps([10,1,2,3,11,4,5])).then(o=>o.TextMessageEditor)),md=je(()=>Ee(()=>import("./fz0860lkhp7je3od.js"),__vite__mapDeps([12,1,2,3,4,5,13,14,15,16,17])).then(o=>o.ChatScreenRetrievalResultsFlyoutContent)),La=80,Es=16;function js(){return{minHeight:"calc(100dvh - ".concat(Hi,"px - 120px)")}}function hd(o){"use no forget";var pt,ft,bt,vt,xt,_t,It,St,Tt,Ct,yt,Mt,At,Et,jt,wt,Pt,kt,Ft,Rt,Nt,Dt,Ot,Ht,Vt,Lt,Bt,Ut,Gt,Wt,qt,$t,zt,Kt,Qt,Jt,Xt,Yt,Zt;const{turnIndex:a,isFinalTurn:n,conversation:s,onRequestCompletion:d,currentModelId:b,scrollToMessageId:g,scrollToMessageIsAssistant:p,dateHeaderType:v,hideUserActions:O,disableHorizontalPadding:H}=o,u=Ns(),B=qa(u),F=lr(),w=cr(),x=ur(t=>Ds(t)),_=gr(u),J=!!F&&mr(F),y=hr(pr.isBusinessWorkspace),ee=wo(),U=Po(u)||ee,P=ko(u),R=Fo(u),{eligible:A}=Ro(No.hasSeenAudioParagenPrompt),[c,$,N]=ve(s.id,t=>{const r=L.getConversationTurnAtIndex(t,a),m=a>0?L.getConversationTurnAtIndex(t,a-1):null,h=(m==null?void 0:m.role)===z.User&&m.messages.some(q=>{var Z;return(Z=q.metadata)==null?void 0:Z.visually_hide_response_from_conversation});return[r,h,m]},{disablePerfDetector:n}),{messages:I,messageGroups:D}=c,k=Do(t=>t.size===0?-1:D.findIndex(r=>r.type===Ms?r.groups.some(m=>m.messages.some(h=>t.has(h==null?void 0:h.id))):r.messages.some(m=>t.has(m==null?void 0:m.id)))),G=I[0],i=C(I),K=l.useMemo(()=>D.some(t=>t.type===fr.SearchGPTQuery),[D]),T=l.useMemo(()=>I.some(t=>{var r;return(r=t.metadata)==null?void 0:r.n7jupd_message}),[I]),le=l.useMemo(()=>{var t,r;return(r=(t=C(I))==null?void 0:t.metadata)==null?void 0:r.chatgpt_sdk_suppressed_response},[I]),S=l.useMemo(()=>T?br(I,t=>t.author.name==="n7jupd.metadata"):null,[I,T]),se=!!((pt=S==null?void 0:S.metadata)!=null&&pt.kaur1br5_mode),ce=ve(s.id,t=>!!(t!=null&&t.pulseCardId)),Ie=ae(()=>Ka(u).isFeedbackModalOpen$()||ce&&a===1),{messages:M,visibleMessages:E,messageGroups:Y,lastMessageToRender:f}=l.useMemo(()=>{const t=k!==-1&&k+1<D.length,r=t?D.slice(0,k+1):D,m=t?r.flatMap(h=>h.type===Ms?h.groups.flatMap(q=>q.messages):h.messages):I;return{messages:m,visibleMessages:m.filter(vr),messageGroups:r,lastMessageToRender:C(m)}},[I,D,k]),Q=k!==-1,ne=Ne(u,"1887864177"),W=ve(s.id,t=>L.getLastMessageSystemHints(t)),Se=ve(s.id,t=>{var r;return(r=t==null?void 0:t.hasIKConvo)!=null?r:!1}),we=(W==null?void 0:W.includes(Be.Tatertot))&&Ne(u,"28816792")&&xr(u),{capabilitySuggestionsEnabled:We}=Oo(we),Oe=l.useMemo(()=>({clientThreadId:s.id,turnIndex:a,messageId:i==null?void 0:i.id}),[s.id,a,i==null?void 0:i.id]),[Os,Hs]=l.useState(!1),[Vs,nn]=l.useState(!1),on=l.useContext(Ho)!=null,V=c.role===z.User,os=_r(),Te=Ir(s.id),is=(ft=c.gizmoId)!=null?ft:Te,Ce=Sr(is).data,rs=is&&!Tr(is)?Ce:void 0,rn=rs&&c.gizmoId!=null&&c.gizmoId!==Te&&Ne(u,"1418300125"),ds=ae(()=>tn(s)),dn=Cr(s.id),qe=Vo(ds),ln=Lo(ds,dn),ls=yr(u),[ue,cn,un,Ls,cs,gn,$e,Bs,mn,Us,us,me,ze,Ke,hn,Pe,j,pn]=ve(s.id,t=>{var ea,sa,ta,aa,na;const r=L.getParentPromptNode(t,G.id),m=(aa=(ea=r==null?void 0:r.message.clientMetadata)==null?void 0:ea.variantsInStreamInfo)!=null?aa:(sa=r==null?void 0:r.message.metadata)!=null&&sa.paragen_variant_choice||(ta=r==null?void 0:r.message.metadata)==null?void 0:ta.paragen_variants_info,h=L.getVariantIds(t,G.id),q=L.getCurrentVariantId(t,G.id),Z=q?h.indexOf(q):0,Re=m&&(t==null?void 0:t.tree)!=null&&h.some(de=>{var ia;const{errType:oa}=(ia=t.tree.getLeafFromNode(de).message.clientMetadata)!=null?ia:{};return oa!=null&&oa!=="info"}),re=L.getConversationTurns(t),fe=re.findIndex(de=>de.role===z.Assistant),_o=Aa(re,de=>de.role===z.Assistant),Io=re.slice(fe,a+1).every(de=>de.role===z.Assistant);return[r,i!=null&&!qr(i.id)&&L.isMessageTurnEnded(t,i.id),Re,Vi(t==null?void 0:t.mode,Ce==null?void 0:Ce.gizmo.id),re.findIndex(de=>de.role===z.User)===a,Aa(re,de=>de.role===z.User)===a,fe===a,_o===a,Io,L.getRequestId(t,i==null?void 0:i.id),m,h,Z,!!(t!=null&&t.continuingFromSharedPostId),t==null?void 0:t.currentLeafId,L.getSuperWidgetMessages(t,a)[0],L.lastUserMessage(t),(na=t==null?void 0:t.continuingFromSharedProjectConversationId)!=null?na:null]},{disablePerfDetector:n}),ye=$a(),Qe=ae(()=>{const t=$r(s);return(t==null?void 0:t.value)===ts.STREAMING||(t==null?void 0:t.value)===ts.REALTIME}),fn=M.some(t=>t.content.content_type===Mr.MultimodalText),bn=Ar(u,"3119715334").get("should-enable-skip",!1),Gs=!Er(u),Ws=c.messages.map(t=>t.id),oe=l.useRef(null);pd({clientThreadId:s.id,turn:c,turnIndex:a,conversationTurnWrapperRef:oe});const gs=!B&&((bt=g==null?void 0:g.length)!=null?bt:0)>2&&g!=="finalAgentTurn"&&n,te=V?C(E):void 0,ms=te==null?void 0:te.id,vn=l.useCallback(()=>{ms&&(De.logEvent("Edit Prompt",{id:ms,threadId:Ge(s.id)}),Ue(u,"chatgpt_edit_prompt"),Hs(!0))},[u,ms,s.id]),xn=l.useCallback(()=>{Hs(!1)},[]),{onChangeRating:_n}=Bo({clientThreadId:s.id,currentModelConfig:ds}),In=t=>{var q;if(!i)return;const r=(q=i.clientMetadata)==null?void 0:q.rating,h=(r==="thumbs_up"?"thumbsUp":r==="thumbs_down"?"thumbsDown":r)===t?null:t;if(_n({nodeId:i.id,messageId:i.id,rating:h}),h){const Z=Br(()=>Ur(u)),Re=Z&&D.some(re=>{var fe;return re.type!==Ms&&((fe=re.messages)==null?void 0:fe.some(Gr))});De.logEventWithStatsig(h==="thumbsDown"?"Message Feedback Thumbs Down Clicked":"Message Feedback Thumbs Up Clicked","chatgpt_thumb_feedback",X(X({id:i.id,threadId:Ge(s.id),model:b,rating:h},Z?{isCATriggered:Re}:{}),x?{isSidebar:!0}:{}))}nn(h==="thumbsDown")},[Sn]=l.useState(()=>Date.now()),Me=jr(s.id),qs=(xt=Me!=null?Me:pn)!=null?xt:ye&&(vt=s.sharedConversationId)!=null?vt:null,$s=(_t=Uo(s.id))==null?void 0:_t.value,zs=$s===ts.STREAMING,Tn=$s===ts.REALTIME,Cn=Us!=null,yn=Ja(Us),Mn=fa.useState(t=>fa.isReplayInProgress(t,hn)),ie=!cn&&yn||Q||zs||Tn||Mn&&n||I.some(t=>Go(t)),Ks=Xa(),hs=l.useRef(!1),Qs=l.useRef(void 0),An=wr({clientThreadId:s.id}),En=Wo(s.id,i)&&!An&&!!Me,[,jn]=yo(),{isOpen:Je}=ws(),Js=sn(),ke=C(N==null?void 0:N.messages.filter(Pr)),Xs=ae(()=>zr(u,Kr.AtlasAdultSearchAllowed)),Xe=qo({conversation:s,threadContent:(It=Pe==null?void 0:Pe.content)!=null?It:null,query:ke?As(ke):null,triggeredSearch:K,messageGroups:Y,allMessages:I,isAdultSearchEnabled:Xs}),{isClassifiedAdult:Ys,isSafeSearchOff:wn}=Xe,[Pn,ps]=ae(()=>[Qr(u)&&$e&&(!W||W.length===0||W.includes(Be.Search))&&!Ys,Jr(u)&&_&&c.role===z.Assistant&&Ys&&wn&&Xs]),he=(Pn||ps)&&Xe.showNavlinksWidget,fs=M.filter(Ta),kn=he&&fs.length===0&&!T,Zs=((St=j==null?void 0:j.author.metadata)==null?void 0:St.real_author)==="onboarding",et=_&&$e&&he&&Xe.showLongList;l.useEffect(()=>{const r=new URLSearchParams(window.location.search).get("message");!(r!=null&&Ws.includes(r))||!oe.current||(oe.current.scrollIntoView({behavior:"instant"}),jn(h=>(h.delete("message"),h),{replace:!0,preventScrollReset:!0}))},[]),l.useEffect(()=>{g!==Qs.current&&(hs.current=!1,Qs.current=g)},[g]),l.useEffect(()=>{if(B)return;const m=new URLSearchParams(window.location.search).get("message")!=null;if(hs.current||m||g===void 0||!oe.current||Js||Zs||et){g==="finalAgentTurn"&&n&&_e(s.id,h=>{h.scrollToMessageId=void 0});return}(Ws.includes(g)||g==="finalAgentTurn"&&n)&&(hs.current=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(oe.current)if(g==="finalAgentTurn"&&n)oe.current.scrollIntoView({behavior:"instant",block:"end"}),_e(s.id,h=>{h.scrollToMessageId=void 0});else{const h=oe.current.offsetHeight;let q=0;Je?q=-8:_?q=-1*Es:p?q=-8:h>La&&(q=La-h);const Z=$o(s).pinnedWidgetHeight$();Z!=null&&(q+=Z+Es),oe.current.style.scrollMarginTop="".concat(q+Es,"px"),oe.current.scrollIntoView({behavior:"smooth"})}})}))},[g,p,oe.current,Je,Js,Zs,et]);const{showDebugConversationTurns:Fn}=en(),Rn=!ye&&!Ke&&!os&&!V,Nn=(f==null?void 0:f.author.role)===z.Assistant?f:null,Dn=(Ct=(Tt=f==null?void 0:f.metadata)==null?void 0:Tt.system_hints)==null?void 0:Ct.includes(Be.Research),On=(Mt=(yt=f==null?void 0:f.metadata)==null?void 0:yt.system_hints)==null?void 0:Mt.includes(Be.Agent);zo({isCompletionRequestInProgress:ie,isUserTurn:V,message:Nn});const{isOpen:Hn}=ws(),Vn=Ko(u),Ye=Qo(Ls),Ln=kr(t=>t.voiceFeedbackThread),st=Me===Ln,Bn=(At=i==null?void 0:i.metadata)==null?void 0:At.async_source,Ze=n&&Cn,pe=Qe||ie||zs,Un=E.length===0&&M.some(Fr),Gn=((Et=Jo(E))==null?void 0:Et.author.name)===Ca.A8KM123&&Xo(E,t=>t.author.name===Ca.A8KM123||t.channel==="commentary"||t.author.role===z.Developer),Wn=Yo.useIsMultigenParagenVotingActive(),bs=!Os&&!M.every(Rr)&&!ye&&!Ke&&!Ye&&!Hn&&c.role!==z.Developer&&!(c.role===z.User&&O)&&!(n&&st&&pe)&&!(Ze&&pe)&&!(n&&Qe&&Bn)&&!(pe&&T)&&!(Gn&&!n)&&!((jt=i==null?void 0:i.metadata)!=null&&jt.is_auto_proceed_message)&&!((wt=i==null?void 0:i.metadata)!=null&&wt.is_takeover_ended_message)&&!((Pt=i==null?void 0:i.metadata)!=null&&Pt.disable_turn_actions)&&!kn&&!c.userContinuationSuccessorTurnId&&!le&&!Wn,qn=!bs&&!(Ze&&pe)&&(ye||Ke)&&!x,$n=M.some(t=>Nr(t)===Dr.l1239dk1),vs=ve(s.id,t=>{var h,q;const r=new Set,m=L.getParentPromptNode(t,G.id);return(q=(h=m==null?void 0:m.message.metadata)==null?void 0:h.attachments)==null||q.forEach(Z=>{var Re,re,fe;(Re=Z.mime_type)!=null&&Re.startsWith("image/")||r.add((fe=(re=Z.context_connector_info)==null?void 0:re.context_connector)!=null?fe:"file")}),r}),xs=Or(),_s=ya(u,"110789670");let Ae;xs.isLoading?Ae=void 0:xs.canUpgradeGDrive&&vs.has(as.GDRIVE)&&_s.get("enabled",!1)?Ae=as.GDRIVE:xs.canUpgradeSharepoint&&vs.has(as.O365_BUSINESS)&&_s.get("enabled",!1)?Ae=as.O365_BUSINESS:vs.has("file")&&_s.get("enabled",!1)&&(Ae="general");const zn=(f==null?void 0:f.author.role)===z.Assistant&&((Rt=(Ft=(kt=f==null?void 0:f.metadata)==null?void 0:kt.content_references)==null?void 0:Ft.length)!=null?Rt:0)>0||Se,Kn=Ze&&!ie&&!x&&!ye&&!Ke&&!$n&&(ne||Zo(u)||We||we||!!Ae),He=i!=null&&(!y||ln||J||ls)&&!Ye&&!Gs&&!os&&!((Nt=i.metadata)!=null&&Nt.b1de6e2_s),tt=Qe||ie,[Qn,Jn]=l.useState(!1),Xn=!!((Dt=j==null?void 0:j.metadata)!=null&&Dt.dictation&&((Ot=j==null?void 0:j.metadata)!=null&&Ot.dictation_asset_pointer)&&!((Ht=j==null?void 0:j.metadata)!=null&&Ht.dictation_edited)),Yn=!!(!A||Qn||(Vt=j==null?void 0:j.metadata)!=null&&Vt.audio_paragen_result||ba(j==null?void 0:j.id)),at=Xn&&!Yn,nt=at&&(!y||ls)&&He&&!tt&&!x&&!Je&&j!=null&&$e&&Ne(u,"51772912"),Zn=ei(j==null?void 0:j.id,nt),ot=nt&&Zn,Ve=!Ye&&Rn&&n&&(us==null?void 0:us.num_variants_in_stream)===2&&me.length<=2&&!((Lt=i==null?void 0:i.clientMetadata)!=null&&Lt.inlineComparisonRating)&&!un&&!at&&!ba(j==null?void 0:j.id),it=!ot&&(!y||ls)&&He&&(Ze||n&&st)&&!tt&&!x&&!Je&&!T&&!le,rt=!((ie||Qe)&&n)&&me.length>1&&!Ve,dt=V&&M.some(t=>{var r;return(r=va(t))==null?void 0:r.shouldHideContent}),eo=V&&te!=null&&!((Bt=te==null?void 0:te.metadata)!=null&&Bt.async_task_id)&&Me!=null&&!Ye&&!fn&&!dt&&!Gs&&!Dn&&!On&&!x,so=i!=null&&Ma.getAudioAssetPointers(i).length>0,to=i!=null&&((Gt=(Ut=i.clientMetadata)==null?void 0:Ut.disclaimers)!=null?Gt:[]).length===0&&!x&&(!os||so)&&!w,lt=l.useCallback(t=>{var r;_e(s.id,m=>{Rs.setCurrentBranch(m,me[t])}),De.logEvent("Change Active Node",{intent:"toggle_between"}),Ne(u,"4126691920")&&si({parent_prompt_id:(r=ue==null?void 0:ue.id)!=null?r:"",prev_branch_id:me[ze],next_branch_id:me[t]},Ge(s.id))},[s.id,me,ze,ue==null?void 0:ue.id,u]),ct=ti(c,M,Fn),ut=T&&ai(M,n),es=i==null?void 0:i.id,Is=l.useCallback(()=>{es&&ni(s,{type:"retrievalResults",turnIndex:a,messageId:es})},[s,es,a]),Fe=M.some(t=>{var r,m,h;return((r=t==null?void 0:t.metadata)==null?void 0:r.api_tool_type)==="glaux"||Hr({id:(h=(m=t==null?void 0:t.metadata)==null?void 0:m.model_slug)!=null?h:""},u)}),Ss=l.useMemo(()=>oi(c,qe,!!Te),[c,qe,Te]),ao=l.useMemo(()=>Ss&&!Fe,[Ss,Fe]),no=l.useMemo(()=>ii(c,!!Te,P),[P,Te,c]),gt=Ne(u,"2137702454"),oo=l.useMemo(()=>c.role!==z.User&&qe&&gt&&!Fe,[c,qe,gt,Fe]),io=Vr()&&CSS.supports("content-visibility: auto")&&!V&&ya(u,"1011775750").get("enabled",!1)&&!ri(M),ro=l.useMemo(()=>M.some(t=>{var r;return((r=va(t))==null?void 0:r.canRetry)===!1}),[M]),lo=(Wt=i==null?void 0:i.metadata)==null?void 0:Wt.n7jupd_button_type,co=T&&i!=null&&i.id!=null&&!lo,uo=T&&n&&pe,go=T&&n;if(!ct&&!Ve&&!he)return gs?e.jsx("div",{style:js()}):null;if(ut||$)return null;const mo=(qt=f==null?void 0:f.metadata)!=null&&qt.followup_prompts?f.metadata.followup_prompts.map(t=>({text:t,type:di.Reply})):[],ho=($t=f==null?void 0:f.metadata)==null?void 0:$t.category_suggestions,po=(zt=f==null?void 0:f.metadata)==null?void 0:zt.action_suggestions,fo=!M.some(t=>Ma.getAudioAssetPointers(t).length>0)&&!Te&&!ro&&!w&&!Ie&&!!Me,bo=!ie&&M.some(t=>{var r,m;return t.author.role===z.Assistant&&((m=(r=t.metadata)==null?void 0:r.onboarding)==null?void 0:m.main_usages)});ue==null||ue.message.id;const Ts=M.find(t=>{var r,m;return!!((m=(r=t.metadata)==null?void 0:r.onboarding)!=null&&m.examples)}),Cs=(Qt=(Kt=Ts==null?void 0:Ts.metadata)==null?void 0:Kt.onboarding)==null?void 0:Qt.examples,mt=!dt&&(!n||!ie);if(!n&&fs.length===0&&!T&&!he)return null;let Le="none";V&&cs&&(Le="first");const vo=N==null?void 0:N.messages.some(Ta);if(V&&!cs&&(vo?Le="large":Le="none"),n&&(Le="last"),!ct&&!Ve&&!he)return gs?e.jsx("div",{style:js()}):null;if(ut||$)return null;const ht=_?li(I):void 0;if(!n&&fs.length===0&&!T&&!he)return null;const xo=(()=>{if(c.userContinuationSuccessorTurnId)return"mb-1";if(V&&!bs&&!x)return"mb-10";if(!V&&x&&n)return"pb-[40px]"})();return e.jsx(ci.Provider,{value:$e,children:e.jsxs(ui,{children:[e.jsx(gi,{dateHeaderType:v,turn:c}),e.jsxs("article",{className:ge("text-token-text-primary w-full focus:outline-none","[--shadow-height:45px] has-data-writing-block:pointer-events-none has-data-writing-block:-mt-(--shadow-height) has-data-writing-block:pt-(--shadow-height) [&:has([data-writing-block])>*]:pointer-events-auto",io&&"[content-visibility:auto] supports-[content-visibility:auto]:[contain-intrinsic-size:auto_100lvh]",!B&&g==="finalAgentTurn"?"opacity-0":"",{hidden:on&&cs},V?"scroll-mt-(--header-height)":"scroll-mt-[calc(var(--header-height)+min(200px,max(70px,20svh)))]"),tabIndex:-1,style:gs?js():void 0,ref:oe,dir:"auto","data-turn-id":c.id,"data-testid":"conversation-turn-".concat(a),"data-scroll-anchor":!B&&n,"data-turn":V?"user":"assistant",children:[e.jsx(mi,{role:c.role,gizmo:rs}),e.jsx(hi,{role:c.role,children:e.jsxs(za,{horizontalPadding:Ve||H?"none":"standard",verticalPadding:Le,children:[Ve?e.jsxs(e.Fragment,{children:[e.jsx(dd,X({isFeedbackEnabled:He,variantIds:me,conversationTurnMountTime:Sn},o)),bn&&e.jsx("div",{className:"mt-4 flex w-full justify-center",children:e.jsxs(Za,{color:"secondary",className:"text-token-text-primary","data-testid":"paragen-skip-button",onClick:()=>{Ya.publish({kind:"requestCompletion",isForSkippingParagen:!0})},children:[e.jsx(cd,{className:"text-token-text-secondary me-1"}),e.jsx(xe,{id:"IuTr+b",defaultMessage:"Skip"})]})})]}):e.jsxs(Ps,{tabIndex:-1,className:ge("group/turn-messages focus-visible:outline-hidden",he&&"super-widget-visible",xo,Ri({isUserTurn:V})),children:[rn&&e.jsx(pi,{gizmo:rs}),he&&e.jsx(fi,{clientThreadId:s.id,query:ke?As(ke):null,state:Xe,isAssistantResponseSuppressed:!!ps}),oo&&e.jsx(bi,{handleShowRetrievalResults:Is,clientThreadId:s.id,turnIndex:a,responseComplete:!pe,className:"mb-6"}),!V&&e.jsx(ud,{messages:M,clientThreadId:s.id,gizmoId:Ce==null?void 0:Ce.gizmo.id}),M.some(t=>{var r,m,h;return(h=(r=t.metadata)==null?void 0:r.async_completion_id)!=null?h:V&&((m=t.metadata)==null?void 0:m.async_task_title)})&&e.jsx(vi,{message:M.find(t=>{var r,m,h;return(h=(r=t.metadata)==null?void 0:r.async_completion_id)!=null?h:V&&t.author.role===z.User&&((m=t.metadata)==null?void 0:m.async_task_title)}),clientThreadId:s.id,isUserTurn:V}),Vn&&V&&e.jsx(gd,{clientThreadId:s.id,messages:M}),Os&&te?e.jsx(Va,{message:te,clientThreadId:s.id,onRequestCompletion:d,onExitEdit:xn,disabled:Ks}):!ps&&e.jsx(Fs,be(X({allMessages:I,groupedMessagesToRender:Y,allGroupedMessages:D},o),{isUserTurn:V,isFinalUserTurn:gn,isFinalAssistantTurn:Bs,isWithinFirstAssistantTurns:mn,isCompletionRequestInProgress:ie,isFeedbackEnabled:He,isFinalTurn:n,isGlauxTurn:Fe,hasActiveRequest:Ks,isAgentTurn:T,isKAUR1BR5:se,query:ke?As(ke):null,wasInterrupted:Un,superWidgetContent:(Jt=Pe==null?void 0:Pe.content)!=null?Jt:null,lastAgentMetadataNode:S,hasSearchSystemHint:(Xt=W==null?void 0:W.includes(Be.Search))!=null?Xt:!1})),ao&&(U&&no?e.jsx(md,{turnIndex:a,clientThreadId:s.id,variant:"bottom"}):e.jsx(xa,{handleShowRetrievalResults:Is,clientThreadId:s.id,turnIndex:a,responseComplete:!pe})),co&&e.jsx(xi,{message:i,clientThreadId:s.id,turnIndex:a,referenceMessageId:i.id,responseComplete:!n||!ie}),bo&&e.jsx(_i,{clientThreadId:s.id}),Cs&&Cs.length>0&&!ie&&e.jsx(Ii,{clientThreadId:s.id,examples:Cs}),ht&&e.jsx(Si,{message:ht,className:"mt-4"}),bs&&e.jsx(td,{isUserTurn:V,alwaysShow:!0,children:V?x?null:e.jsx(ad,{activeVariantIndex:ze,clientThreadId:s.id,numVariants:me.length,onAnticipateEdit:Va.prefetch,onChangeIndex:lt,onEnterEdit:vn,showCopyButton:mt,showEditMessageButton:eo,showPagination:rt,turnIndex:a,reportableMessageId:(Yt=te==null?void 0:te.id)!=null?Yt:null,isSharedConversation:ye,serverThreadIdForReporting:qs}):e.jsxs(e.Fragment,{children:[e.jsx(nd,{activeVariantIndex:ze,clientThreadId:s.id,conversationMode:Ls,lastMessage:i,messages:M,numVariants:me.length,onChangeIndex:lt,onRate:In,showCanvasButton:En,showCopyButton:mt,showPagination:rt,showPlayButton:to,showRatingButtons:He,showRegenerateButton:fo,turn:c,turnIndex:a,parentPrompt:ue,isAgentTurn:T,isKAUR1BR5:se,reportableMessageId:(Zt=i==null?void 0:i.id)!=null?Zt:null,isSharedConversation:ye,serverThreadIdForReporting:qs}),Fe&&Ss?e.jsx(xa,{handleShowRetrievalResults:Is,clientThreadId:s.id,turnIndex:a,responseComplete:!pe}):e.jsx(e.Fragment,{children:!R&&e.jsx(_a,{clientThreadId:s.id,message:i,turnIndex:a,isAgentTurn:T})}),it&&e.jsx(Ti,{canShowInlineMessageFeedback:Vs,clientThreadId:s.id,messageForRating:i}),!1]})}),Bs&&I.some(Ci)&&!I.some(yi)&&!I.some(Mi)&&e.jsx(Ai,{isCompletionRequestInProgress:ie,conversation:s,messages:I}),uo&&e.jsx(Ei,{clientThreadId:s.id}),go&&e.jsx(ji,{clientThreadId:s.id,messages:M}),qn&&e.jsx(_a,{clientThreadId:s.id,message:i,turnIndex:a,isAgentTurn:T}),!1,it&&e.jsx(wi,{canShowInlineMessageFeedback:Vs,clientThreadId:s.id,messageForRating:i,allGroupedMessages:D,currentModelId:b}),e.jsx(Lr,{mode:"wait",children:ot&&e.jsx(Pi,{lastUserMessageId:j.id,setIsDismissed:Jn})}),Kn&&(Ae?e.jsx(ki,{clientThreadId:s.id,connectorToUpsell:Ae,analyticsMetadata:Oe}):e.jsx(Fi,{followups:mo,actionSuggestions:po,categorySuggestions:ho,clientThreadId:s.id,lastMessageId:es,analyticsMetadata:Oe,isTatertotFollowupsEnabled:we,shouldHideFollowups:zn}))]}),e.jsx(Ni,{clientThreadId:s.id,turn:c,isFinalTurn:n}),e.jsx(Di,{clientThreadId:s.id,turn:c})]})})]})]})})}const pd=({clientThreadId:o,turn:a,turnIndex:n,conversationTurnWrapperRef:s})=>{const d=Oi();l.useEffect(()=>{if(!d)return;const b=new IntersectionObserver(g=>{g.forEach(p=>{p.isIntersecting?_e(o,v=>{var O;v.turnIdsInViewpoint=[...(O=v.turnIdsInViewpoint)!=null?O:[],{turnId:a.id,turnIndex:n,role:a.role}]}):_e(o,v=>{var O;v.turnIdsInViewpoint=(O=v.turnIdsInViewpoint)==null?void 0:O.filter(({turnId:H})=>H!==a.id)})})},{root:null,threshold:.1});return s.current&&b.observe(s.current),()=>{_e(o,g=>{var p;g.turnIdsInViewpoint=(p=g.turnIdsInViewpoint)==null?void 0:p.filter(({turnId:v})=>v!==a.id)}),b.disconnect()}},[o,s,d,a.id,a.role,n])},fd=Wa.memo(hd),Ba=je(()=>Ee(()=>import("./crl8f3ggvylz4ls6.js"),__vite__mapDeps([18,1,2,3,4,5])).then(o=>o.ThreadReportConversationModal));function wd(o){const{prefetchNavlink:a,clearPrefetchNavlink:n,conversation:s,pageLoadSearchQuery:d}=o,b=Ns(),g=qa(b),p=Li(s.id),v=Bi(),O=Ui(),[H,u]=ae(()=>[sd(b),Ds(b)]),[B]=Gi(),{isOpen:F}=ws(),w=O.store.useContentAreaDimensions(Wi.Header,y=>y!=null&&y.height?y.height:void 0);let x=null;w||(x=!g&&F?"max-sm:pb-25":"pb-25",H?x=B===qi.Chat?"pb-12":"pb-13":u&&(x="pb-0"));let _=e.jsx(bd,X({isNewScrollEnabled:g},o));const J=$i();return J&&(_=e.jsx(zi,{clientThreadId:s.id,children:_})),_=e.jsx(Ki,{clientThreadId:s.id,children:_}),e.jsxs("div",{onCopy:p,className:ge("flex flex-col text-sm",J?"pt-4":u?"thread-xl:pt-0 pt-0":"thread-xl:pt-header-height",v&&"keyboard-open:pb-[calc(var(--composer-height,100px)+var(--screen-keyboard-height,0))]",x),style:{paddingBottom:w},children:[d&&e.jsx("div",{children:e.jsx(id,{query:d})}),a?e.jsx(Xr,{name:"prefetch-navlink",onError:y=>{ks.addError("Error with prefetch navlink",{error:y}),n()},children:e.jsx(l.Suspense,{fallback:null,children:e.jsx(rd,{clientThreadId:s.id,prefetchNavlink:a,clearPrefetchNavlink:n})})}):null,e.jsx(Yr,{children:_})]})}function bd({onRequestCompletion:o,conversation:a,scrollContainerRef:n,isNewScrollEnabled:s}){var G,i,K,T,le;const d=Ns(),b=ae(()=>Ds(d)),[g,p,v,O,H,u]=ve(a.id,S=>[L.getConversationTurnIds(S),S==null?void 0:S.pulseCardId,S==null?void 0:S.scrollToMessageId,S==null?void 0:S.scrollToMessageIsAssistant,L.hasUserMessage(S),L.isMessageTurnEnded(S)]),B=Ka(d),F=ae(()=>Ia(d)&&B.isCardModalOpen$()),w=ae(()=>Ia(d)&&B.isFeedbackModalOpen$()),x=ae(()=>tr(d)),{data:_}=Qi(p),J=p&&!H,y=$a(),ee=sn(),U=Zr(),P=ae(()=>tn(a));Ji({isSharedConversation:y,clientThreadId:a.id}),l.useEffect(()=>{y&&(Ue(d,"chatgpt_continue_conversation_page_loaded"),De.logEvent("Continue Conversation: Page Loaded"),Ue(d,"chatgpt_conversation_share_page_loaded"),De.logEvent("Share Public Chat: Shared Conversation Loaded"))},[d,y]);const R=ae(()=>a.id?ar(a).activeSystemHintSuggestionChips$():[]),[A,c]=l.useState(!1),[$,N]=l.useState(!1),I=l.useRef(null),D=Xi(a.id),k=ee&&!U;return e.jsxs(e.Fragment,{children:[w&&e.jsx(Yi,{}),k&&e.jsx(od,{}),y&&e.jsxs(e.Fragment,{children:[e.jsx(Ps,{children:e.jsx("p",{className:"text-xs text-gray-500",children:e.jsx(xe,{id:"threadLayout.sharedConversationCopyDisclaimer",defaultMessage:"This is a copy of a conversation between ChatGPT & Anonymous."})})}),e.jsx("div",{className:"text-token-text-primary mb-5 text-center text-xs font-semibold",children:e.jsx("button",{onPointerOver:()=>Ba.prefetch(),onClick:()=>{ed(d,Ba,{clientThreadId:a.id,serverThreadId:a.sharedConversationId,isSharedConversation:!0,isStaticSharedThread:!1}),Ue(d,"chatgpt_conversation_share_report_content_clicked",void 0,{location:"Static Shared Thread Page"}),De.logEvent("Share Public Chat: Report Content Clicked",{location:"Dynamic Shared Thread Page"})},children:e.jsx(xe,{id:"thread.reportSharedConversation",defaultMessage:"Report conversation"})})})]}),_&&e.jsx(za,{horizontalPadding:"standard",horizontalMargin:"none",children:e.jsx(Ps,{children:e.jsx(Zi,{imageSrc:(i=(G=_.image)==null?void 0:G.url)!=null?i:"",fallbackSrc:(T=(K=_.image)==null?void 0:K.fallback_url)!=null?T:"",title:(le=_.title)!=null?le:"",cardId:p})})}),g.map((S,se)=>{var ce;return e.jsx(Wa.Fragment,{children:e.jsx(fd,{isFinalTurn:se===g.length-1,turnIndex:se,conversation:a,onRequestCompletion:o,currentModelId:(ce=P==null?void 0:P.id)!=null?ce:null,scrollToMessageId:s||J?void 0:v,scrollToMessageIsAssistant:s||J?void 0:O,dateHeaderType:D(se)},S)},S)}),!s&&e.jsxs(e.Fragment,{children:[(n==null?void 0:n.current)&&e.jsx(Ea,{setIsScrolledToEdge:S=>{c(S)},options:{root:n.current,threshold:0,rootMargin:"0%"}},"threadBottomEdgeScrollObserver"),e.jsx("div",{ref:I}),F&&(n==null?void 0:n.current)&&e.jsx(Ea,{setIsScrolledToEdge:S=>{N(!S)},options:{root:n.current,threshold:0,rootMargin:"-30px 0px"}},"pulseCardModalEdgeScrollObserver"),F&&e.jsx(er,{show:$&&u}),e.jsx(sr,{show:A&&!R.length&&!b&&!w&&!x,className:ge("bottom-[calc(var(--composer-overlap-px)+--spacing(6))]"),onClick:()=>{var S;Ue(d,"chatgpt_thread_scroll_to_bottom"),(S=I.current)==null||S.scrollIntoView({behavior:"smooth",block:"end"})}})]})]})}export{fd as C,wd as T};
//# sourceMappingURL=be1f0w4doetbrndv.js.map
