const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/lrtd9knjab0hf8x5.js","assets/kfrdmkli83ureki3.js","assets/fyw02vlaiv2vq6cj.js","assets/kw08ajijqinojrwh.js","assets/root-fi49nzd2.css","assets/conversation-small-lq38g8zw.css","assets/monvnv56yufjad8z.js","assets/mjzycow04v25v11d.js","assets/ds49lnif6ph5qgdk.js","assets/h9aonizh0s2wbq5a.js","assets/ba3v27n9os9eq40q.js","assets/iz35nlf95x4k1pcg.js"])))=>i.map(i=>d[i]);
import{e as ct,j as n,_ as V,h as G,u as zt,r as x,i as Xt,M as ye,c as jt,b as gs,d as bs}from"./kfrdmkli83ureki3.js";import{J as we,az as K,p as Yt,aB as St,e6 as Jt,aA as U,cs as xs,cq as It,u as Se,bd as Cs,k1 as vs,kk as Zt,d as Tt,pK as es,i1 as ts,dZ as ss,lp as ns,eG as te,cy as lt,iQ as ws,iR as ys,iS as ks,iU as Ms,iY as Ss,jB as P,tG as Ts,tH as Es,tI as ve,tK as js,gB as Is,k7 as Et,fb as _s,tL as As,aC as Rs,d_ as Ns,dj as Fs,c8 as Ps,l4 as qt,gO as Ls,c1 as Mt,lF as Bs,j6 as at,j7 as Os,c4 as Ds,cm as Ws,u8 as qs,jT as Ht,aZ as ot,ue as Hs,kE as Qs,c5 as Vs}from"./kw08ajijqinojrwh.js";import{u7 as Gs,u8 as Ks,qQ as Us,u9 as $s,gK as zs,aI as Xs,ua as Qt,ub as Ys,bt as Js,uc as Zs,s6 as en,so as tn,aW as it,aX as sn,sK as nn,sC as an,sD as on,sE as rn,sq as Vt,ss as ln,sH as cn,st as un,sJ as dn,sI as mn}from"./fyw02vlaiv2vq6cj.js";import{W as ke,g as fn,f as pn,i as as,b as hn}from"./goxcf7vc701q04ob.js";import{W as Me,k as I,X as gn,m as _t,A as bn,y as xn,z as Cn,d as Gt,w as Kt}from"./oyvo09ze11a90qsd.js";import{g as vn,C as wn,a as yn,W as kn}from"./zmq298rl93f7s2hn.js";import{u as Mn}from"./i6j31imn3cki69v8.js";import{C as Sn}from"./fux1oumbpb3w9e7e.js";import{u as Tn}from"./lrftmyomhnslqldf.js";import{u as En}from"./ny16i6vydtz4gnvl.js";import{s as jn}from"./dn55ejno9ewvlhxs.js";function In(t){return we(t,"3651421897")}const xe=ct({codeLabel:{id:"wham.composer.tool.codeLabel",defaultMessage:"Code"},codeSubmitLabel:{id:"wham.composer.tool.codeSubmitLabel",defaultMessage:"Code"},codeDescription:{id:"wham.composer.tool.codeDescription",defaultMessage:"Generate and edit code with full environment setup."},planLabel:{id:"wham.composer.tool.planLabel",defaultMessage:"Plan"},planSubmitLabel:{id:"wham.composer.tool.askSubmitLabel",defaultMessage:"Plan"},planDescription:{id:"wham.composer.tool.planDescription",defaultMessage:"Get a quick answer without modifying the repository."}}),_n=[{key:"code",environmentMode:"code",runEnvironmentInQaMode:!1,slashCommand:"code",icon:n.jsx(Gs,{className:"icon","aria-hidden":!0}),analyticsAction:"code",messages:{label:xe.codeLabel,submitLabel:xe.codeSubmitLabel,description:xe.codeDescription}},{key:"plan",environmentMode:"ask",runEnvironmentInQaMode:!0,slashCommand:"plan",slashAliases:["qa","ask"],icon:n.jsx(Ks,{className:"icon","aria-hidden":!0}),analyticsAction:"ask",messages:{label:xe.planLabel,submitLabel:xe.planSubmitLabel,description:xe.planDescription}}],An=K(()=>V(()=>import("./lrtd9knjab0hf8x5.js"),__vite__mapDeps([0,1])),{loading:t=>U(t)});function Rn({taskId:t,hasMultipleInProgressOrStreamingTurns:e}){const r=G(),o=Yt(),l=zt(),[h,s]=x.useState(!1),{mutate:v}=Xt({mutationFn:async()=>{s(!0),await Me.cancelTask(t)},onError:()=>{o.danger(r.formatMessage({id:"wham.whamTaskRow.failedToCancelTask",defaultMessage:"Failed to cancel task"}))},onSuccess:()=>{l.refetchQueries({queryKey:["wham","task",t]}),l.invalidateQueries({queryKey:["wham","tasks"]})}});return n.jsx(St,{color:"primary",type:"button",size:"small",className:e?void 0:"h-9 w-9",icon:h?Jt:An,onClick:()=>(ke.recordCancel("task-details"),v()),disabled:h,"aria-label":r.formatMessage({id:"wham.composer.cancelTask",defaultMessage:"Cancel task"}),"data-testid":"stop-button",children:e&&n.jsx(ye,{id:"wham.composer.stopButton.multipleInProgressOrStreamingTurns",defaultMessage:"Stop all"})})}function Nn(t,e){return{label:e,description:"",share_settings:"workspace",machine:"wham-public/wham-universal",repositoryId:t,workspaceDirectory:"/workspace",agentNetworkAccess:{mode:"off"},setupCommands:"",maintenanceSetupCommands:"",secrets:[],envVars:[],autoSetupSettings:null,cacheSettings:{post_setup_cache_enabled:!0}}}function Fn(){"use forget";const t=jt.c(21),e=I(Wn),r=I(Dn),o=I(On),l=I(Bn),h=I(Ln),s=I(Pn),v=e!=null?e:"";let g;t[0]!==v?(g=["wham","repository",v],t[0]=v,t[1]=g):g=t[1];const u=!!e&&s;let c;t[2]!==e?(c=()=>Me.getRepository(e!=null?e:""),t[2]=e,t[3]=c):c=t[3];let C;t[4]!==g||t[5]!==u||t[6]!==c?(C={queryKey:g,enabled:u,queryFn:c,staleTime:3e5},t[4]=g,t[5]=u,t[6]=c,t[7]=C):C=t[7];const{data:b}=gs(C);let f;t[8]!==l||t[9]!==o||t[10]!==r||t[11]!==h?(f={onSuccess:T=>{if(!T)return;if(r(T.id),!I.getState().branch){const d=vn(T);o(d)}l(T.id),h(!1)}},t[8]=l,t[9]=o,t[10]=r,t[11]=h,t[12]=f):f=t[12];const{mutateAsync:S,isPending:k}=Mn(f);let a;t[13]!==S||t[14]!==b||t[15]!==e?(a=async()=>{const T=I.getState().environmentId;if(T)return T;if(!e)throw new Error("Repository is required to create an environment");if(!I.getState().useRepositoryAsEnvironment)return T;const i=b!=null?b:await Me.getRepository(e!=null?e:"");return(await S(Nn(i.id,i.name))).id},t[13]=S,t[14]=b,t[15]=e,t[16]=a):a=t[16];const p=a,_=!!e&&s;let A;return t[17]!==p||t[18]!==k||t[19]!==_?(A={isCreatingEnvironment:k,ensureEnvironment:p,hasRepository:_},t[17]=p,t[18]=k,t[19]=_,t[20]=A):A=t[20],A}function Pn(t){return t.useRepositoryAsEnvironment}function Ln(t){return t.setUseRepositoryAsEnvironment}function Bn(t){return t.setAutoCreatedEnvironment}function On(t){return t.setBranch}function Dn(t){return t.setEnvironmentId}function Wn(t){return t.selectedRepositoryId}const qn=K(()=>V(()=>import("./fyw02vlaiv2vq6cj.js").then(t=>t.ze),__vite__mapDeps([2,1,3,4,5])),{loading:t=>U(t)});function Hn({isSubmitDisabled:t,createTask:e,selectedTool:r,disabledReason:o,isFollowUp:l}){const h=G(),s=xs(),[v,g]=x.useState(!1),u=I(a=>a.environmentId),{isCreatingEnvironment:c,ensureEnvironment:C,hasRepository:b}=Fn(),f=!l&&!u&&b,S=x.useCallback(a=>{ke.recordComposerAction(a?"ask":"code"),e({runEnvironmentInQaMode:a})},[e]),k=x.useCallback(async a=>{if(t){g(!0);return}if(!c){if(f){try{if(!await C())return}catch(p){return}S(a);return}S(a)}},[t,C,c,S,f]);return n.jsx("div",{className:"flex items-center gap-2 px-2",onClick:a=>a.stopPropagation(),children:n.jsx(It,{label:o,open:s?v:void 0,onOpenChange:g,children:n.jsx("button",{"aria-label":h.formatMessage(Qn.submitLabel),color:"primary",type:"button",className:"composer-submit-btn composer-submit-button-color h-9 w-9",disabled:(t||c)&&!s,onClick:t?()=>g(!0):()=>k(r.runEnvironmentInQaMode),children:n.jsx(qn,{className:"icon"})})})})}const Qn=ct({submitLabel:{id:"gVT0DB",defaultMessage:"Submit"}}),Vn=K(()=>V(()=>import("./monvnv56yufjad8z.js"),__vite__mapDeps([6,1])),{loading:t=>U(t)}),Gn=K(()=>V(()=>import("./mjzycow04v25v11d.js"),__vite__mapDeps([7,1])),{loading:t=>U(t)}),Kn=K(()=>V(()=>import("./ds49lnif6ph5qgdk.js"),__vite__mapDeps([8,1])),{loading:t=>U(t)}),Un=K(()=>V(()=>import("./h9aonizh0s2wbq5a.js"),__vite__mapDeps([9,1])),{loading:t=>U(t)}),$n=4,zn=t=>{switch(t){case 1:return n.jsx(Un,{"aria-hidden":!0,className:"icon-sm"});case 2:return n.jsx(Kn,{"aria-hidden":!0,className:"icon-sm"});case 3:return n.jsx(Gn,{"aria-hidden":!0,className:"icon-sm"});default:return n.jsx(Vn,{"aria-hidden":!0,className:"icon-sm"})}};function Xn({attempts:t,setAttempts:e}){var u;const r=G(),[o,l]=x.useState(!1),h=x.useRef(null),s=()=>l(!1),v=Se(),g=(u=Cs(v,"2179180337").value.max_attempts)!=null?u:$n;return n.jsx(Yn,{children:n.jsxs(Us,{open:o,onOpenChange:l,children:[n.jsx(wn,{triggerText:r.formatMessage({id:"wham.attemptsSelector.trigger",defaultMessage:"{count}x"},{count:t}),toolTip:r.formatMessage({id:"wham.attemptsSelector.tooltip",defaultMessage:"Number of simultaneous versions"}),ariaLabel:r.formatMessage({id:"wham.attemptsSelector.ariaLabel",defaultMessage:"Open versions number selector, currently set to {count}x"},{count:t}),Icon:zn(t),truncate:!1}),n.jsx(Sn,{align:"start",isOpen:o,closePopover:s,popoverContentRef:h,children:n.jsx("div",{className:"flex w-50 flex-col rounded-lg p-1.5",children:[...Array(g)].map((c,C)=>n.jsx(yn,{className:"w-full",onClick:()=>{e(C+1),s()},isSelected:t===C+1,label:r.formatMessage({id:"wham.attemptsSelector.option",defaultMessage:"{count, plural, one {# version} other {# versions}}"},{count:C+1})},C+1))})})]})})}function Yn({children:t}){const e=Se(),r=G(),o=$s(),l=gn(),h=o&&!o.isLoading&&o.eligible&&!l.isLoading&&!!l.data;return n.jsx(zs,{side:"bottom",theme:"bright",dismissOnOutsideClick:!0,badge:"new",show:h,sideOffset:0,className:"w-60",announcementKey:Qt,title:r.formatMessage({id:"wham.composerBon.nuxTooltip.title",defaultMessage:"Best-of-N"}),description:r.formatMessage({id:"wham.composerBon.nuxTooltip.description",defaultMessage:"Generate multiple solutions so you can pick the best approach."}),onDismiss:()=>Xs(e,Qt),children:t})}function os(t){const e=G(),{data:r}=_t(),o=fn(r);switch(t){case"enabled":return;case"rate-limit":return e.formatMessage({id:"wham.whamComposer.hitRateLimit",defaultMessage:"You have reached your rate limit. It will reset at {resetsAfterText}"},{resetsAfterText:o!=null?pn(e,o):void 0});case"no-environment":return e.formatMessage({id:"wham.whamComposer.noEnvironment",defaultMessage:"No environment selected"});case"no-content":return e.formatMessage({id:"wham.whamComposer.noContent",defaultMessage:"Enter a prompt to continue"});case"no-github-connection":return e.formatMessage({id:"wham.whamComposer.noGitHubConnection",defaultMessage:"No GitHub connection"});case"no-repository":return e.formatMessage({id:"wham.whamComposer.noRepository",defaultMessage:"No repository selected"});case"connect-github-error":return e.formatMessage({id:"wham.whamComposer.connectGitHubError",defaultMessage:"Failed to load environments"});default:vs(t)}}function is({isFollowUp:t,hasComments:e}){const{data:r}=_t(),o=as(r),l=I(({environmentId:f})=>f),h=I(({selectedRepositoryId:f})=>f),s=I(f=>f.useRepositoryAsEnvironment),v=I(({branch:f})=>f),g=Zt(),c=!Tt(()=>ns(g))||e,{isConnected:C,error:b}=es(ss.GITHUB_CONNECTOR,"github","/codex",ts.CODEX);if(o)return"rate-limit";if(!l&&!v&&!t){if(!s)return"no-environment";if(!h)return"no-repository"}return!t&&!C?"no-github-connection":!t&&b?"connect-github-error":c?"enabled":"no-content"}const Jn=K(()=>V(()=>import("./fyw02vlaiv2vq6cj.js").then(t=>t.zy),__vite__mapDeps([2,1,3,4,5])),{loading:t=>U(t)});function Zn(t){"use forget";const e=jt.c(46),{selectableTools:r,selectedTool:o,onSelectTool:l,isGitHubConnected:h,isImageUploadEnabled:s,fileInputRef:v,onFileChange:g}=t,u=G();let c;e[0]!==u?(c=u.formatMessage({id:"wham.whamComposer.plusMenu",defaultMessage:"Add files and more"}),e[0]=u,e[1]=c):c=e[1];let C;e[2]===Symbol.for("react.memo_cache_sentinel")?(C=n.jsx("kbd",{className:"bg-token-bg-tertiary -me-1 inline-grid aspect-square w-4 items-center justify-center rounded-sm text-[11px]",children:n.jsx("span",{children:"/"})}),e[2]=C):C=e[2];let b;e[3]!==c?(b=n.jsxs(n.Fragment,{children:[c," ",C]}),e[3]=c,e[4]=b):b=e[4];let f;e[5]!==u?(f=u.formatMessage({id:"wham.whamComposer.plusMenu",defaultMessage:"Add files and more"}),e[5]=u,e[6]=f):f=e[6];let S;e[7]===Symbol.for("react.memo_cache_sentinel")?(S=n.jsx(Jn,{className:"icon"}),e[7]=S):S=e[7];let k;e[8]!==f?(k=n.jsx(te.BasicTrigger,{asChild:!0,children:n.jsx("button",{type:"button",className:"composer-btn","aria-label":f,children:S})}),e[8]=f,e[9]=k):k=e[9];let a;e[10]!==b||e[11]!==k?(a=n.jsx("div",{onPointerDown:ta,onClick:ea,children:n.jsx(It,{side:"bottom",label:b,children:k})}),e[10]=b,e[11]=k,e[12]=a):a=e[12];let p;if(e[13]!==l||e[14]!==r||e[15]!==o.key){let M;e[17]!==l||e[18]!==o.key?(M=j=>n.jsxs(te.Item,{disabled:!j.available,className:"hover:bg-token-bg-tertiary flex items-center gap-2 rounded-lg px-3 py-2 text-start text-sm",onSelect:N=>{N.preventDefault(),j.available&&l(j.key)},children:[n.jsx("span",{className:"text-token-text-secondary",children:j.icon}),n.jsx("span",{className:lt("flex-1",j.key===o.key&&j.available?"text-token-text-brand font-medium":void 0),children:j.label})]},j.key),e[17]=l,e[18]=o.key,e[19]=M):M=e[19],p=r.map(M),e[13]=l,e[14]=r,e[15]=o.key,e[16]=p}else p=e[16];let _;e[20]!==v||e[21]!==u||e[22]!==h||e[23]!==s||e[24]!==r.length?(_=h&&s&&n.jsxs(n.Fragment,{children:[r.length>0&&n.jsx(te.Separator,{className:"my-1"}),n.jsx(te.Item,{className:"hover:bg-token-bg-tertiary rounded-lg px-3 py-2 text-start text-sm",onSelect:M=>{var j;M.preventDefault(),(j=v.current)==null||j.click()},children:u.formatMessage({id:"wham.whamComposer.attachImage",defaultMessage:"Upload attachment"})})]}),e[20]=v,e[21]=u,e[22]=h,e[23]=s,e[24]=r.length,e[25]=_):_=e[25];let A;e[26]!==p||e[27]!==_?(A=n.jsx(te.Portal,{children:n.jsxs(te.Content,{align:"start",sideOffset:8,className:"min-w-[16rem] p-1",children:[p,_]})}),e[26]=p,e[27]=_,e[28]=A):A=e[28];let T;e[29]!==A||e[30]!==a?(T=n.jsxs(te.Root,{modal:!1,children:[a,A]}),e[29]=A,e[30]=a,e[31]=T):T=e[31];let i;e[32]!==l||e[33]!==o.icon||e[34]!==o.key||e[35]!==o.label?(i=o.key!=="code"&&n.jsx(Ys,{icon:o.icon,label:o.label,content:o.label,removable:!0,onRemove:()=>l("code")}),e[32]=l,e[33]=o.icon,e[34]=o.key,e[35]=o.label,e[36]=i):i=e[36];let d;e[37]!==v||e[38]!==h||e[39]!==s||e[40]!==g?(d=h&&s&&n.jsx("input",{ref:v,type:"file",accept:"image/*",multiple:!0,hidden:!0,onChange:g}),e[37]=v,e[38]=h,e[39]=s,e[40]=g,e[41]=d):d=e[41];let E;return e[42]!==T||e[43]!==i||e[44]!==d?(E=n.jsxs("div",{className:"flex items-center",children:[T,i,d]}),e[42]=T,e[43]=i,e[44]=d,e[45]=E):E=e[45],E}function ea(t){return t.stopPropagation()}function ta(t){return t.stopPropagation()}const sa=K(()=>V(()=>import("./kw08ajijqinojrwh.js").then(t=>t.yt),__vite__mapDeps([3,1,4])),{loading:t=>U(t)}),na=K(()=>V(()=>import("./ba3v27n9os9eq40q.js"),__vite__mapDeps([10,1])),{loading:t=>U(t)});function aa({comments:t,onClearComments:e}){const r=G();return t.length===0?null:n.jsxs("div",{className:"bg bg-token-bg-secondary mx-1 mt-1 flex items-center gap-2 rounded-t-3xl rounded-b-lg py-0.5 ps-3 pe-0.5 font-semibold text-blue-400",children:[n.jsx(na,{className:"icon"}),n.jsx("div",{className:"flex-1 text-sm",children:n.jsx(ye,{id:"wham.composer.commentCount",defaultMessage:"{count, plural, one {One code comment} other {# code comments}}",values:{count:t.length}})}),n.jsx("button",{className:"text-token-text-secondary flex h-9 w-9 shrink-0 items-center justify-center",onClick:o=>{o.preventDefault(),o.stopPropagation(),e()},"aria-label":r.formatMessage({id:"wham.composer.clearComments",defaultMessage:"Clear comments"}),children:n.jsx(sa,{className:"icon"})})]})}function oa({composerController:t,layoutMode:e,slashCommands:r}){const o=G(),{refs:l,floatingStyles:h}=ws({placement:"bottom-start",middleware:[ys({mainAxis:10,alignmentAxis:-18}),ks({padding:6}),Ms({apply:({elements:i,availableWidth:d,availableHeight:E})=>{i.floating.style.setProperty("--radix-popper-available-width","".concat(d,"px")),i.floating.style.setProperty("--radix-popper-available-height","".concat(E,"px"))}})],whileElementsMounted:Ss}),[s,v]=x.useState(void 0);x.useEffect(()=>{const i=P(t);i.dispatch(Ts(i.state.tr,{setReferencePosition:l.setReference,onHintMatch(d){v(E=>_s(E,d)?E:d)}}))},[t,l.setReference]);const g=x.useMemo(()=>!s||s.triggerSymbol!=="/"?[]:r.length?s.text?[Js(r,s.text,i=>Zs(i),{locale:o.locale})]:[r.filter(i=>!i.noMatchEmpty)]:[],[s,o.locale,r]),u=x.useMemo(()=>e!=="bottom"?g:g.slice().reverse().map(i=>[...i].reverse()),[g,e]),c=x.useMemo(()=>u.flat(),[u]),[C,b]=x.useState(e==="bottom"?-1:0),f=C==null?null:(C+c.length)%c.length,S=x.useCallback(i=>{b(d=>{if(d==null)return null;const E=c.length;for(let M=0;M<E;M++){const j=(d+E+(M+1)*i)%E;if(!c[j].disabled)return j}return null})},[c]),k=x.useRef(S);k.current=S;const a=c.length===0;x.useEffect(()=>{if(a){b(null);return}e==="bottom"?(b(0),k.current(-1)):(b(-1),k.current(1))},[e,a]);const p=f==null?null:c[f],_=x.useCallback(()=>{if(s!=null&&s.range){const i=P(t);Es(i,s.range.from,s.range.to)}},[t,s]),A=x.useCallback(({commandToSave:i=p,expectPerfectMatch:d})=>{var N;if(!s||!i||i.disabled)return!1;const E=s.text.toLocaleLowerCase(),M=[i.command,...(N=i.aliases)!=null?N:[]].some(ut=>ut.toLocaleLowerCase()===E);if(d&&!M)return!1;_();const j=P(t);return ve(j),i.onSelect(),!0},[_,t,s,p]),T=x.useRef(A);return T.current=A,x.useEffect(()=>{if(a){const d=P(t);ve(d);return}const i=P(t);return js(i,d=>{if(d==="up")k.current(-1);else if(d==="down")k.current(1);else if(d==="cancel")ve(i),As(i);else{if(d==="submit")return ve(i),T.current({expectPerfectMatch:!1});if(d==="checkMatch")return T.current({expectPerfectMatch:!0})}}),()=>ve(i)},[t,a]),a?null:n.jsx(Is,{ref:l.setFloating,style:h,className:lt("max-w-[min(var(--radix-popper-available-width,100vw),--spacing(100))] overflow-y-auto [scrollbar-width:none]",c.length>6?"max-h-[min(var(--radix-popper-available-height,50svh),--spacing(1.5)+5*var(--menu-item-height))]":"max-h-[var(--radix-popper-available-height,50svh)]"),onPointerDown:i=>{i.preventDefault()},children:u.map((i,d)=>{let E=0;for(let M=0;M<d;M++)E+=u[M].length;return n.jsx(te.Group,{children:i.map((M,j)=>{const N=E+j;return n.jsx(en,{command:M,isHighlighted:N===f,onHighlight:()=>b(N),onClick:()=>{A({commandToSave:M,expectPerfectMatch:!1}),Et(P(t))}},M.command)})},d)})})}function ia(){const t=G(),e=bs(),{setupMfa:r}=Tn({redirectUrl:"/codex"});return n.jsx(Rs,{isOpen:!0,onClose:()=>{},type:"warning",title:t.formatMessage({id:"wham.mfaRequiredModal.title",defaultMessage:"Enable multi-factor authentication to access Codex"}),description:t.formatMessage({id:"wham.mfaRequiredModal.description",defaultMessage:"To continue using Codex, please turn on multi-factor authentication for your account."}),testId:"modal-mfa-required",children:n.jsxs("div",{className:"flex w-full justify-end gap-2",children:[n.jsx(St,{color:"secondary",onClick:()=>{e("/")},children:n.jsx(ye,{id:"wham.mfaRequiredModal.backToChatGPT",defaultMessage:"Back to ChatGPT"})}),n.jsx(St,{color:"primary",onClick:()=>{r()},children:n.jsx(ye,{id:"wham.mfaRequiredModal.enableMFA",defaultMessage:"Enable MFA"})})]})})}const ra=K(()=>V(()=>import("./iz35nlf95x4k1pcg.js"),__vite__mapDeps([11,1])),{loading:t=>U(t)}),la=K(()=>V(()=>import("./ba3v27n9os9eq40q.js"),__vite__mapDeps([10,1])),{loading:t=>U(t)});function ca({taskId:t,turnId:e,isComposerExpanded:r,followUpSuggestions:o,hasComments:l,isSubmitting:h,onSuggestionClick:s,children:v}){const g=Se(),u=da(g,r),c=G(),[C,b]=x.useState(null),f=is({isFollowUp:!0,hasComments:l});let S=os(f);f==="no-content"&&(S=void 0);const k=!(u==="hidden"||!o.length)&&t&&e;return x.useEffect(()=>{k&&ke.recordFollowUpsSeen(t,e,o.length)},[k,t,e,o.length]),k?n.jsxs("div",{className:"bg-token-bg-tertiary flex flex-col gap-1.5 rounded-2xl p-2",children:[n.jsx(Ns,{initial:!1,children:u==="visible"&&n.jsx("div",{className:"flex flex-col",inert:h,children:o.map((a,p)=>n.jsx(ua,{index:p,taskId:t,turnId:e,suggestion:a.suggestion,disabledReason:S,loading:C===p&&h,onClick:()=>{h||(b(p),s(a.suggestion))}},p))})}),u==="collapsed"&&n.jsxs("button",{type:"button",className:"text-token-text-tertiary enabled:hover:text-token-text-secondary focus:bg-token-bg-secondary flex items-center gap-2 rounded-lg p-2 text-xs font-semibold focus:outline-none","aria-label":c.formatMessage({id:"wham.followUpContainer.showSuggestions",defaultMessage:"Show follow up suggestions"}),onClick:()=>{ke.recordFollowUpsExpanded(t,e)},children:[n.jsx(ra,{className:"icon-sm"}),n.jsx(ye,{id:"wham.composer.followup.show",defaultMessage:"Suggestions"},"text")]},"collapsed"),v({isWrappedByContainer:!0})]}):v({isWrappedByContainer:!1})}function ua({taskId:t,turnId:e,index:r,suggestion:o,disabledReason:l,loading:h,onClick:s}){return n.jsx(It,{side:"right",sideOffset:10,label:l,children:n.jsxs("button",{type:"button",disabled:!!l||h,className:"group hover:bg-token-bg-secondary focus:bg-token-bg-secondary -disabled:cursor-pointer flex w-full items-start gap-1.5 rounded-lg px-2 py-1 focus:outline-none disabled:cursor-not-allowed disabled:opacity-50",onClick:()=>{s(),ke.recordFollowUpsClicked(t,e,r,o.severity)},children:[n.jsx("span",{className:"pt-[0.125rem]",children:h?n.jsx(Jt,{className:"text-token-text-tertiary icon-sm"}):n.jsx(la,{className:"text-token-text-tertiary icon-sm"})}),n.jsx("span",{className:"text-token-text-primary line-clamp-2 text-start text-sm leading-snug break-words",children:o.title})]})})}function da(t,e){return we(t,"3485296344")||void 0?e?"collapsed":"visible":"hidden"}function ma(){const t=Se(),e=I(o=>o.bestOfN);return e!=null?e:Fs(t,"2398649844").get("default_attempts",1)}const rt=ct({describeTask:{id:"wham.whamComposer.describeACodingTask",defaultMessage:"Describe a task"},describeAnotherTask:{id:"wham.whamComposer.describeAnotherCodingTask",defaultMessage:"Describe another task"},askQuestionWithPlan:{id:"wham.whamComposer.askAQuestionWithPlan",defaultMessage:"Ask a question with /plan"},askQuestionWithPlanAnother:{id:"wham.whamComposer.askAQuestionWithPlanAnother",defaultMessage:"Ask a question with /plan"}}),Ut=[{firstTaskMessage:rt.describeTask,subsequentTaskMessage:rt.describeAnotherTask},{firstTaskMessage:rt.askQuestionWithPlan,subsequentTaskMessage:rt.askQuestionWithPlanAnother}];function Ra(t){"use forget";var Ft,Pt,Lt,Bt,Ot,Dt;const e=jt.c(143),{disableAutoFocus:r,isBigBoxMode:o,disableDuringSubmit:l,expanded:h,followUp:s,onClearComments:v,onSubmit:g,onSuccess:u,onCreateEnvironment:c,attemptIndex:C,ariaLabel:b}=t,f=r===void 0?!1:r,S=o===void 0?!1:o,k=l===void 0?!1:l,a=G(),p=Yt(),_=zt(),[A,T]=x.useState("code"),{refetch:i}=bn(),{refetch:d}=xn(s==null?void 0:s.taskId),{refetch:E}=Cn(s==null?void 0:s.taskId),M=I(va),j=I(Ca),[N,ut]=x.useState(!0),[Y,At]=x.useState(!1),O=Ps(),Te=qt(xa),rs=qt(Mt.hasUploadInProgress),ls=ma(),cs=I(ba),[us,ds]=x.useState(1),se=s?us:ls,dt=s?ds:cs,D=Se();let Ee;e[0]!==D?(Ee=we(D,"3492040717"),e[0]=D,e[1]=Ee):Ee=e[1];const ne=Ee;let je;e[2]!==D?(je=we(D,"879591222")||void 0,e[2]=D,e[3]=je):je=e[3];const ms=je;let Ie;e[4]!==D?(Ie=we(D,"3536244140"),e[4]=D,e[5]=Ie):Ie=e[5];const _e=Ie;let Ae;e[6]!==D?(Ae=In(D),e[6]=D,e[7]=Ae):Ae=e[7];const H=Ae,[mt,Rt]=x.useState(!1),m=Zt();let Re;e[8]!==m?(Re=tn(m),e[8]=m,e[9]=Re):Re=e[9];const re=Tt(Re.isWhisperActive$),fs=x.useRef(null),Nt=x.useRef(Ut[Math.floor(Math.random()*Ut.length)]),{data:ft}=_t();let Ne;e[10]!==ft?(Ne=as(ft),e[10]=ft,e[11]=Ne):Ne=e[11];const Fe=Ne,le=Fe&&!!s,Ce=le?!1:re?!0:h;let Pe;e[12]!==m||e[13]!==Ce?(Pe=()=>Ce!=null?Ce:!ns(m)||Bs(m),e[12]=m,e[13]=Ce,e[14]=Pe):Pe=e[14];const J=Tt(Pe),pt=k&&Y||le,W=!!s&&((Ft=s.comments.length)!=null?Ft:0)>0;let Le;e[15]!==O||e[16]!==a||e[17]!==p?(Le=w=>{for(const R of w)at.uploadFile(O,Os(R),R,Ds.Codex,[],a,p)},e[15]=O,e[16]=a,e[17]=p,e[18]=Le):Le=e[18];const ae=Le;let Be;e[19]!==ae?(Be=function(R){const F=R.target.files;F&&(ae(F),R.target.value="")},e[19]=ae,e[20]=Be):Be=e[20];const ht=Be;let Oe,De;e[21]!==m||e[22]!==H||e[23]!==ae?(Oe=()=>{if(!H)return;const w=R=>{var X;const F=(X=R.clipboardData)==null?void 0:X.items;if(!F)return;const q=[];for(const y of F)if(y.kind==="file"){const Z=y.getAsFile();Z&&Z.type.startsWith("image/")&&q.push(Z)}q.length>0&&(R.preventDefault(),ae(q))};return Ws(P(m).dom,{paste:w})},De=[m,H,ae],e[21]=m,e[22]=H,e[23]=ae,e[24]=Oe,e[25]=De):(Oe=e[24],De=e[25]),x.useEffect(Oe,De);let We;e[26]!==O?(We=function(){return Mt.getReadyFiles(O.getState()).flatMap(ga)},e[26]=O,e[27]=We):We=e[27];const gt=We;let ce;e[28]!==m?(ce=()=>Et(P(m)),e[28]=m,e[29]=ce):ce=e[29];let ue;e[30]!==a?(ue=a.formatMessage({id:"wham.keyboardActions.focusComposer",defaultMessage:"Focus chat"}),e[30]=a,e[31]=ue):ue=e[31];let qe;e[32]===Symbol.for("react.memo_cache_sentinel")?(qe=[it.Shift,it.Escape],e[32]=qe):qe=e[32];let de;e[33]!==s?(de=s?void 0:[[it.Mod,it.Shift,"o"]],e[33]=s,e[34]=de):de=e[34];let He;e[35]!==ce||e[36]!==ue||e[37]!==de?(He=[{key:"focusComposer",action:ce,actionMessageDescriptor:ue,group:sn.Chat,keyboardBinding:qe,altKeyboardBindings:de}],e[35]=ce,e[36]=ue,e[37]=de,e[38]=He):He=e[38],En(He);const bt=!!s;let Qe;e[39]!==W||e[40]!==bt?(Qe={isFollowUp:bt,hasComments:W},e[39]=W,e[40]=bt,e[41]=Qe):Qe=e[41];const ps=is(Qe),{isConnected:$}=es(ss.GITHUB_CONNECTOR,"github","/codex",ts.CODEX),Ve=os(ps),me=!!Ve||Y&&k||rs;let oe,Q,Ge;if(e[42]!==a||e[43]!==$||e[44]!==A){let w;e[48]!==a||e[49]!==$?(w=y=>{const Z=!y.requiresGitHubConnection||$,L=!y.requiresReviewFeature,ee=Z&&L;return{key:y.key,label:a.formatMessage(y.messages.label),submitLabel:a.formatMessage(y.messages.submitLabel),description:a.formatMessage(y.messages.description),environmentMode:y.environmentMode,runEnvironmentInQaMode:y.runEnvironmentInQaMode,slashCommand:y.slashCommand,slashAliases:y.slashAliases,icon:y.icon,analyticsAction:y.analyticsAction,available:ee,disabledReason:!ee&&y.messages.unavailable?a.formatMessage(y.messages.unavailable):void 0}},e[48]=a,e[49]=$,e[50]=w):w=e[50];const R=_n.map(w),F=new Map(R.map(ha));oe=R.filter(pa);const q=(Pt=F.get("code"))!=null?Pt:R[0];Q=(Lt=F.get(A))!=null?Lt:q;let X;e[51]===Symbol.for("react.memo_cache_sentinel")?(X=y=>({command:y.slashCommand,aliases:y.slashAliases,title:y.label,secondary:void 0,icon:y.icon,disabled:!y.available,onSelect:()=>{y.available&&T(y.key)}}),e[51]=X):X=e[51],Ge=oe.map(X),e[42]=a,e[43]=$,e[44]=A,e[45]=oe,e[46]=Q,e[47]=Ge}else oe=e[45],Q=e[46],Ge=e[47];const xt=Ge;let fe;e[52]!==se||e[53]!==ne||e[54]!==m||e[55]!==O||e[56]!==s||e[57]!==gt||e[58]!==W||e[59]!==a||e[60]!==N||e[61]!==H||e[62]!==g||e[63]!==_||e[64]!==p?(fe=async w=>{const{runEnvironmentInQaMode:R,promptOverride:F}=w===void 0?{runEnvironmentInQaMode:!1}:w,q=F!=null?F:qs(P(m).state.doc).content,X=Mt.getReadyFiles(O.getState());if(!(!!q.length||W))throw new Error("No content to submit");const Z=H?gt():[];if(g==null||g(),at.reset(O),At(!0),s)return await Me.createFollowUpTask(s.taskId,s.turnId,q,s.comments,R,ne?se:void 0,Z).catch(L=>{var ee;throw F||(Ht(P(m),q),at.restoreFiles(O,X)),L instanceof ot&&L.status===429?(_.invalidateQueries({queryKey:["wham","usage","rate-limit-status"]}),p.danger(a.formatMessage($t.rateLimit),{id:s.turnId,duration:5,hasCloseButton:!0})):L instanceof Gt?Kt(L,s.turnId,a,p):L instanceof ot&&L.status===403&&((ee=L.detail)!=null&&ee.toLowerCase().includes("multi-factor authentication"))?Rt(!0):p.danger(a.formatMessage({id:"wham.whamComposer.failedToCreateFollowUpTask",defaultMessage:"Failed to create follow-up"}),{id:s.turnId,duration:5,hasCloseButton:!0}),L});{const{branch:L,environmentId:ee}=I.getState(),hs=N;if(L){if(!ee)throw new Error("Environment is required for new tasks.")}else throw new Error("Branch is required");const ie=crypto.randomUUID();return I.getState().addPendingTaskId(ie),Me.createNewTask(ee,L,q,R,ne?se:void 0,Z).catch(B=>{throw I.getState().removePendingTaskId(ie),F||(Hs(P(m).state.doc)?(Ht(P(m),q),at.restoreFiles(O,X)):(p.danger(a.formatMessage({id:"wham.whamComposer.failedToCreateTaskCopyToClipboard",defaultMessage:"Failed to create task. Previous prompt copied to clipboard."}),{id:ie,duration:5,hasCloseButton:!0}),navigator.clipboard.writeText(q))),B}).catch(B=>{var Wt;throw B instanceof ot&&B.status===429?(_.invalidateQueries({queryKey:["wham","usage","rate-limit-status"]}),p.danger(a.formatMessage($t.rateLimit),{id:ie,duration:5,hasCloseButton:!0})):B instanceof Gt?Kt(B,ie,a,p):B instanceof ot&&B.status===403&&((Wt=B.detail)!=null&&Wt.toLowerCase().includes("multi-factor authentication"))?Rt(!0):p.danger(a.formatMessage({id:"wham.whamComposer.failedToCreateTask",defaultMessage:"Failed to create task"}),{id:ie,duration:5,hasCloseButton:!0}),B}).then(B=>(I.getState().assignPendingTaskToFinalTask(ie,B.task.id),_.invalidateQueries({queryKey:["wham","usage","rate-limit-status"]}),hs&&ut(!1),B))}},e[52]=se,e[53]=ne,e[54]=m,e[55]=O,e[56]=s,e[57]=gt,e[58]=W,e[59]=a,e[60]=N,e[61]=H,e[62]=g,e[63]=_,e[64]=p,e[65]=fe):fe=e[65];let pe;e[66]!==M||e[67]!==m||e[68]!==s||e[69]!==u||e[70]!==d||e[71]!==i||e[72]!==E||e[73]!==j?(pe=w=>{j(!0),M(w.task.id,w.turn),w.user_turn&&M(w.task.id,w.user_turn),u==null||u(w),setTimeout(()=>{Et(P(m))},0),i(),s&&(d(),E())},e[66]=M,e[67]=m,e[68]=s,e[69]=u,e[70]=d,e[71]=i,e[72]=E,e[73]=j,e[74]=pe):pe=e[74];let Ke;e[75]===Symbol.for("react.memo_cache_sentinel")?(Ke=()=>{At(!1)},e[75]=Ke):Ke=e[75];let Ue;e[76]!==fe||e[77]!==pe?(Ue={mutationFn:fe,onSuccess:pe,onSettled:Ke},e[76]=fe,e[77]=pe,e[78]=Ue):Ue=e[78];const{mutate:z,isPending:$e}=Xt(Ue);let ze;e[79]!==z||e[80]!==me||e[81]!==Q?(ze=w=>me?!1:w.metaKey||w.altKey?(z({runEnvironmentInQaMode:Q.runEnvironmentInQaMode}),!0):!1,e[79]=z,e[80]=me,e[81]=Q,e[82]=ze):ze=e[82];const Xe=Ls(ze);let Ye,Je;e[83]!==m||e[84]!==Xe?(Ye=()=>Qs(P(m),{Enter:Xe}),Je=[m,Xe],e[83]=m,e[84]=Xe,e[85]=Ye,e[86]=Je):(Ye=e[85],Je=e[86]),x.useEffect(Ye,Je);let Ze;e[87]!==s?(Ze=jn(s?[s.turnStatus,...s.siblingTurnStatuses]:[],fa),e[87]=s,e[88]=Ze):Ze=e[88];const et=Ze,tt=!!s&&ms&&et>0,Ct=!tt&&(_e?!re:!0),vt=((Ot=(Bt=s==null?void 0:s.siblingTurnStatuses)==null?void 0:Bt.length)!=null?Ot:0)>1;let st;e[89]!==C||e[90]!==vt||e[91]!==a?(st=vt&&C?a.formatMessage({id:"wham.whamComposer.followUpOnTurn",defaultMessage:"Follow-up on version {version}"},{version:C}):a.formatMessage({id:"wham.whamComposer.requestChangesOrAskAQuestion",defaultMessage:"Request changes or ask a question"}),e[89]=C,e[90]=vt,e[91]=a,e[92]=st):st=e[92];const wt=st,yt=s==null?void 0:s.taskId,kt=s==null?void 0:s.turnId;let he;e[93]!==(s==null?void 0:s.followUpSuggestions)?(he=(Dt=s==null?void 0:s.followUpSuggestions)!=null?Dt:[],e[93]=s==null?void 0:s.followUpSuggestions,e[94]=he):he=e[94];let ge;e[95]!==z?(ge=w=>{z({runEnvironmentInQaMode:!1,promptOverride:w.body})},e[95]=z,e[96]=ge):ge=e[96];let be;e[97]!==b||e[98]!==se||e[99]!==ne||e[100]!==m||e[101]!==pt||e[102]!==z||e[103]!==f||e[104]!==Ve||e[105]!==s||e[106]!==wt||e[107]!==W||e[108]!==Fe||e[109]!==et||e[110]!==a||e[111]!==S||e[112]!==$e||e[113]!==J||e[114]!==N||e[115]!==$||e[116]!==H||e[117]!==me||e[118]!==Y||e[119]!==re||e[120]!==v||e[121]!==c||e[122]!==ht||e[123]!==Te||e[124]!==oe||e[125]!==Q||e[126]!==dt||e[127]!==mt||e[128]!==le||e[129]!==tt||e[130]!==Ct||e[131]!==xt||e[132]!==_e?(be=w=>{const{isWrappedByContainer:R}=w;return n.jsxs("div",{className:"contents",inert:pt,children:[n.jsxs(nn,{expanded:J,canCollapseWithInput:!$e&&R,isTemporaryChat:!1,shouldUseTightRadius:R,onSubmit:()=>{$e||z({runEnvironmentInQaMode:Q.runEnvironmentInQaMode})},composerController:m,ariaLabel:b!=null?b:a.formatMessage({id:"wham.whamComposer.ariaLabel",defaultMessage:"Codex composer"}),children:[n.jsx(an,{children:re?n.jsx("div",{className:lt("flex max-w-full min-w-0 flex-1 items-center",S&&J&&"min-h-30"),children:n.jsx(on,{composerController:m,className:"h-14"})}):n.jsx(rn,{composerController:m,disableAutoFocus:f||Fe,textareaMaxHeightClassName:lt(S&&J&&"min-h-30",s?"max-h-[max(10rem,min(calc(100dvh-29rem),10rem))]":"max-h-[max(10rem,min(calc(100dvh-29rem),50dvh))]"),placeholder:s?wt:a.formatMessage(N?Nt.current.firstTaskMessage:Nt.current.subsequentTaskMessage)})}),$&&H&&Te.length>0&&n.jsx(Vt,{children:n.jsx(ln,{files:Te,selectedApps:[],activeSystemHintType:void 0,disableEditButton:!0,forceSmallView:!0,className:"no-scrollbar horizontal-scroll-fade-mask flex flex-nowrap gap-2 overflow-x-auto px-2.5 pt-2.5 pb-1.5 [--edge-fade-distance:1rem]"})}),n.jsx(cn,{children:n.jsx(Zn,{selectableTools:oe,selectedTool:Q,onSelectTool:T,isGitHubConnected:$,isImageUploadEnabled:H,fileInputRef:fs,onFileChange:ht})}),W&&n.jsx(Vt,{children:n.jsx(aa,{comments:s.comments,onClearComments:v})}),!re&&n.jsx(un,{children:n.jsxs("div",{className:"flex gap-2",children:[!s&&n.jsx(kn,{onCreateEnvironment:c}),ne&&$&&n.jsx(Xn,{attempts:se,setAttempts:dt})]})}),n.jsxs(dn,{children:[!le&&n.jsxs("div",{className:"flex",children:[_e&&n.jsx("div",{inert:Y,children:n.jsx(mn,{composerController:m,composerType:"codex"})}),Ct&&n.jsx(Hn,{isSubmitDisabled:me,createTask:z,selectedTool:Q,disabledReason:Ve,isFollowUp:!!s}),tt&&n.jsx(Rn,{taskId:s.taskId,hasMultipleInProgressOrStreamingTurns:et>1})]}),le&&n.jsx(hn,{})]})]}),n.jsx(oa,{composerController:m,layoutMode:"bottom",slashCommands:xt}),mt&&n.jsx(ia,{})]})},e[97]=b,e[98]=se,e[99]=ne,e[100]=m,e[101]=pt,e[102]=z,e[103]=f,e[104]=Ve,e[105]=s,e[106]=wt,e[107]=W,e[108]=Fe,e[109]=et,e[110]=a,e[111]=S,e[112]=$e,e[113]=J,e[114]=N,e[115]=$,e[116]=H,e[117]=me,e[118]=Y,e[119]=re,e[120]=v,e[121]=c,e[122]=ht,e[123]=Te,e[124]=oe,e[125]=Q,e[126]=dt,e[127]=mt,e[128]=le,e[129]=tt,e[130]=Ct,e[131]=xt,e[132]=_e,e[133]=be):be=e[133];let nt;return e[134]!==W||e[135]!==J||e[136]!==Y||e[137]!==yt||e[138]!==kt||e[139]!==he||e[140]!==ge||e[141]!==be?(nt=n.jsx(ca,{taskId:yt,turnId:kt,isComposerExpanded:J,followUpSuggestions:he,hasComments:W,isSubmitting:Y,onSuggestionClick:ge,children:be}),e[134]=W,e[135]=J,e[136]=Y,e[137]=yt,e[138]=kt,e[139]=he,e[140]=ge,e[141]=be,e[142]=nt):nt=e[142],nt}function fa(t){return t==="pending"||t==="in_progress"?1:0}function pa(t){return t.key!=="code"&&t.available}function ha(t){return[t.key,t]}function ga(t){const e=t.fileSpec;return e&&"width"in e&&"height"in e&&t.fileId?[{type:"image_asset_pointer",asset_pointer:Vs(t.fileId),width:e.width,height:e.height,size_bytes:e.size}]:[]}function ba(t){return t.setBestOfN}function xa(t){return t.files}function Ca(t){return t.setHasSubmittedTaskInSession}function va(t){const{addTurnToTaskMap:e}=t;return e}const $t=ct({rateLimit:{id:"wham.whamComposer.failedToCreateTaskRateLimit",defaultMessage:"Rate limit reached"}});export{Ra as W,In as i,Fn as u};
//# sourceMappingURL=nc8gen230lb13csi.js.map
