import{r as o,h as V,j as e,M as L,L as Z,_ as J}from"./kfrdmkli83ureki3.js";import{u as Q,p as ee,cw as te,d as ae,al as se,ak as oe,J as ne,_ as f,$ as g,a0 as h,aC as re,cB as ce,aB as de,R as le,oI as ie,aZ as ue}from"./kw08ajijqinojrwh.js";const fe=5*1024*1024,m=2e3,U="modal-report-bug";function _e({onClose:_,entryPointElementId:W,conversationId:b}){const k=Q(),[r,F]=o.useState(!1),[p,O]=o.useState(""),[l,x]=o.useState(null),[y,H]=o.useState(!1),I=o.useRef(!1),[w,E]=o.useState(!0),c=ee(),a=V(),M=te(),S=ae(()=>b!=null?b:M==null?void 0:M.serverId$()),v=se(k);let D=!1;v&&(D=v.isEnterprise()||v.isEdu());const z=D,K=oe(k,"2888142241").get("is_feedback_tool_shown",!1),i=ne(k,"108590566"),u=K&&!z;if(o.useEffect(()=>{u||_()},[u,_]),o.useEffect(()=>{if(!u)return;if(H(!0),!i){E(!1),x(null);return}if(I.current)return;I.current=!0;const t=async()=>{var n,s,C,R,A;if(typeof window>"u")return null;try{await((n=document.fonts)==null?void 0:n.ready)}catch(j){}try{const j=(C=(s=document.getElementById("__next"))!=null?s:document.getElementById("root"))!=null?C:document.body,{domToPng:G}=await J(async()=>{const{domToPng:d}=await import("./pegvsrqmyacv6md5.js");return{domToPng:d}},[]),X=window.innerWidth,Y=window.innerHeight,$=d=>d.closest('[data-testid="'.concat(U,'"]'))!=null,B=await G(j,{scale:(R=window.devicePixelRatio)!=null?R:1,width:X,height:Y,features:{restoreScrollPosition:!0},filter:d=>!(d instanceof Element&&$(d))}),T=(A=B.split(",")[1])!=null?A:"";return T.length*3/4-(T.endsWith("==")?2:T.endsWith("=")?1:0)>fe?(c.danger(a.formatMessage({id:"feedback.screenshotTooLarge",defaultMessage:"Screenshot too large; not included"}),{toastId:"feedback_screenshot_too_large"}),E(!1),null):B}catch(j){return f.logEventWithStatsig("Feedback: Report Modal Screenshot Failed","chatgpt_feedback_report_modal_screenshot_failed"),g.count(h.DEFAULT,"chatgpt_feedback_report_modal_screenshot_failed"),null}};(async()=>{try{const n=await t();x(n)}catch(n){x(null)}})()},[i,a,c,u]),o.useEffect(()=>{y&&(f.logEventWithStatsig("Feedback: Report Modal Shown","chatgpt_feedback_report_modal_shown"),g.count(h.DEFAULT,"chatgpt_feedback_report_modal_shown"))},[y]),!u||!y)return null;const N=async()=>{const t=p.trim();if(!t){c.danger(a.formatMessage({id:"feedback.emptyError",defaultMessage:"Please enter your feedback"}),{toastId:"feedback_empty_error"});return}if(t.length>m){c.danger(a.formatMessage({id:"feedback.tooLong",defaultMessage:"Your feedback is too long. Please enter less than {maxLength} characters."},{maxLength:m}),{toastId:"feedback_too_long"});return}F(!0);let n=!1;try{const s=w?l:null;f.logEventWithStatsig("Feedback: Report Submitted","chatgpt_feedback_report_submitted",{screenshot_included:s!=null}),g.count(h.DEFAULT,"chatgpt_feedback_report_submitted",{screenshot_included:s!=null?"true":"false"}),await le.safePost("/user_feedback/submit_feedback",{requestBody:{user_feedback_description:t,conversation_id:S!=null?S:null,user_agent:ie(),language:navigator.language,timestamp_client:Date.now(),viewport_size:{width:window.innerWidth,height:window.innerHeight},screenshot:s,entry_point_element_id:W}}),n=!0,c.success(a.formatMessage({id:"feedback.success",defaultMessage:"Thank you for your feedback!"}))}catch(s){s instanceof ue&&s.status===429?c.danger(a.formatMessage({id:"feedback.rateLimit",defaultMessage:"You're submitting feedback too fast. Please try again later."}),{toastId:"feedback_rate_limit"}):c.danger(a.formatMessage({id:"feedback.error",defaultMessage:"Failed to submit feedback. Please try again."}),{toastId:"feedback_submit_error",loggingTitle:"Failed to submit feedback",loggingDescription:"User feedback submission failed"})}finally{F(!1),n&&P(!0)}},P=(t=!1)=>{r||(f.logEventWithStatsig("Feedback: Report Modal Closed","chatgpt_feedback_report_modal_closed",{report_submitted:t}),g.count(h.DEFAULT,"chatgpt_feedback_report_modal_closed",{report_submitted:t?"true":"false"}),_())},q=t=>{t.key==="Enter"&&(t.metaKey||t.ctrlKey)&&(t.preventDefault(),N())};return e.jsx(re,{testId:U,isOpen:!0,onClose:()=>P(!1),shouldIgnoreClickOutside:r,size:"xlarge",type:"success",title:a.formatMessage({id:"feedback.modalTitle",defaultMessage:"What happened?"}),showCloseButton:!r,primaryButton:e.jsx(de,{color:"primary",fullWidth:!0,onClick:N,disabled:r,loading:r,children:e.jsx(L,{id:"feedback.send",defaultMessage:"Send"})}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{id:"feedback-textarea",value:p,onChange:t=>O(t.target.value),className:"border-token-border-default bg-token-bg-primary text-token-text-primary placeholder:text-token-text-tertiary w-full rounded-lg border p-3 pe-10 text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none",placeholder:a.formatMessage({id:"feedback.placeholder",defaultMessage:"Tell us about the issue you encountered"}),rows:10,maxLength:m,disabled:r,onKeyDown:q}),e.jsx("div",{className:"text-token-text-tertiary mt-1 text-end text-xs",children:e.jsx(L,{id:"feedback.charactersUsed",defaultMessage:"{count} / {max} characters used",values:{count:p.length,max:m}})})]})}),i&&l&&e.jsx("div",{className:"text-token-text-secondary mt-2 text-xs",children:e.jsx(L,{id:"jP5SLX",defaultMessage:"Any information you share may be reviewed to help improve ChatGPT. If you have additional questions, <link>contact support</link>.",values:{link:t=>e.jsx(Z,{to:"https://help.openai.com",target:"_blank",rel:"noopener noreferrer",className:"underline",onClick:()=>{f.logEventWithStatsig("Feedback: Contact Support Link Clicked","chatgpt_feedback_modal_contact_support_link_clicked"),g.count(h.DEFAULT,"chatgpt_feedback_modal_contact_support_link_clicked")},children:t})}})}),i&&e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("div",{className:"w-full",children:l&&e.jsxs("label",{className:"text-token-text-secondary flex items-center gap-2 text-sm",children:[e.jsx(ce,{withinLabel:!0,checked:w,onCheckedChange:E,disabled:r,"data-testid":"toggle-include-screenshot"}),e.jsx("span",{children:a.formatMessage({id:"feedback.includeScreenshot",defaultMessage:"Include screenshot in report"})})]})}),e.jsx("div",{className:"w-fit max-w-full",children:i&&w&&l&&e.jsx("div",{className:"border-token-border-default bg-token-bg-secondary text-token-text-secondary relative inline-block rounded-lg border p-1",children:e.jsx("img",{src:l,alt:a.formatMessage({id:"feedback.screenshotPreviewAlt",defaultMessage:"Screenshot preview"}),className:"object-start block h-14 w-auto rounded-lg object-contain md:h-24"})})})]})]})})}export{_e as default};
//# sourceMappingURL=nlrge08q67ir6fyz.js.map
