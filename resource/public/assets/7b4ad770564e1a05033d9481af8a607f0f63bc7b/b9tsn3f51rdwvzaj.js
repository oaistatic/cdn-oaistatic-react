var I=Object.defineProperty,S=Object.defineProperties;var D=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var w=(e,t,n)=>t in e?I(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,C=(e,t)=>{for(var n in t||(t={}))L.call(t,n)&&w(e,n,t[n]);if(j)for(var n of j(t))R.call(t,n)&&w(e,n,t[n]);return e},T=(e,t)=>S(e,D(t));import{h as E,j as r,e as U,b as A,r as h,q as P}from"./kfrdmkli83ureki3.js";import{hB as $,u as J,N as X,ho as m,eX as q,hn as H,p$ as K,aw as f,D as p,ay as Q,bb as V,dP as N,cy as g}from"./kw08ajijqinojrwh.js";import{gb as W,gc as G}from"./fyw02vlaiv2vq6cj.js";function v({jupyterMessage:e}){const t=E(),{width:n,height:a}=e;if(e.image_payload!=null)return r.jsx("img",{className:"my-1 max-h-full max-w-full object-contain",src:"data:image/png;base64,".concat(e.image_payload),alt:t.formatMessage(k.altText),width:n,height:a});if(e.image_url!=null){const o=$(e.image_url);return r.jsx(B,{fileId:o,width:n,height:a})}return null}const z=30*1e3,O=100,_=1.5,Y=Math.log(1-z*(1-_)/O)/Math.log(_);function Z(e,t){return P({queryKey:["getFileDownloadLink",e],queryFn:()=>H(e,void 0,t),staleTime:q,refetchInterval:n=>{var u;const a=n.state.dataUpdateCount;return((u=n.state.data)==null?void 0:u.status)===m.Success||a>Y||n.state.status===m.Error?!1:Math.pow(_,a)*O}})}function B({fileId:e,width:t,height:n}){const a=E(),o=J(),u=!X(o),{data:s,isLoading:l,refetch:i}=A(Z(e,u));return h.useEffect(()=>{if((s==null?void 0:s.status)===m.Success){const c=new URL(s.download_url,location.toString()).searchParams.get("se");c!=null&&!l&&new Date>new Date(c)&&i()}},[s,l,i]),(s==null?void 0:s.status)!==m.Success?null:r.jsx("img",{src:s.download_url,className:"my-1 max-h-64 max-w-full object-contain sm:max-h-80",alt:a.formatMessage(k.altText),width:t,height:n})}const k=U({altText:{id:"CodeExecutionOutputImage.altText",defaultMessage:"Output image"}});function ue({FormattedText:e,message:t,codeRendererClassName:n,forceDarkMode:a,removeTopBorderRadius:o,showActionBar:u,codeContainerClassName:s}){const l=N()||a,i=ee(t),d=h.useCallback(x=>r.jsx(W,T(C({},x),{wrapperClassName:n,codeContainerClassName:s,removeTopBorderRadius:o,showActionBar:u})),[n,s,o,u]),c=h.useMemo(()=>({code:d}),[d]);return i==null?null:r.jsx(G.Provider,{value:{isWithinDataAnalysisToolMessage:!0},children:r.jsx(e,{className:g("markdown prose dark:prose-invert w-full break-words",l?"dark":"light"),forceDarkMode:a,componentOverrides:c,children:i})})}function ee(e){var n,a,o,u,s,l,i,d;function t(c,x){return"```".concat(x,"\n").concat(c,"\n```")}if(e.author.name==="python"&&e.content.content_type===f.ExecutionOutput)return(a=(n=e.metadata)==null?void 0:n.aggregate_result)!=null&&a.code?t((u=(o=e.metadata)==null?void 0:o.aggregate_result)==null?void 0:u.code,"python"):null;if(e.author.name==="container.exec"&&e.author.role===Q.Tool)return(l=(s=e.metadata)==null?void 0:s.container_citation)!=null&&l.source_cmd?t((d=(i=e.metadata)==null?void 0:i.container_citation)==null?void 0:d.source_cmd,"bash"):null;if(e.content.content_type==="code")return t(e.content.text,"python");if(e.recipient==="python"){if(e.content.content_type!=="text")return p.addError("Unexpected content type for code message"),null;const c=e.content.parts;return c.length!==1||typeof c[0]!="string"?(p.addError("Unexpected parts for code message"),null):t(c[0],"python")}return V(3179801956,e.author.name)&&e.content.content_type===f.ExecutionOutput?t(e.content.text,"python"):(p.addAction("Unexpected code message format"),null)}function ce({message:e,showLabel:t=!0,wrapperClassName:n,codeContainerClassName:a,forceDarkMode:o}){var x;const u=E();if(e.content.content_type!==f.ExecutionOutput)return null;const s=(x=e.metadata)==null?void 0:x.aggregate_result;if(!s)return p.addError("Corrupt code execution result message"),null;const l=s.messages.filter(ne),i=l.length>0,d=s.final_expression_output!=null,c=s.in_kernel_exception!=null;return r.jsxs(r.Fragment,{children:[i&&r.jsx(M,{forceDarkMode:o,label:t?"STDOUT/STDERR":null,wrapperClassName:n,output:l.map((b,F)=>r.jsx("span",{className:b.stream_name==="stderr"?"text-red-500":"",children:b.text},"".concat(F)))}),d&&r.jsx(M,{forceDarkMode:o,wrapperClassName:n,codeContainerClassName:a,label:t?u.formatMessage({id:"codeInterpreterMessage.resultLabel",defaultMessage:"Result"}):null,output:s.final_expression_output}),c&&r.jsx(te,{traceback:s.in_kernel_exception.traceback.join("")})]})}function M({wrapperClassName:e,label:t,output:n,codeContainerClassName:a,forceDarkMode:o}){const u=N()||o;return r.jsxs("div",{className:g("bg-token-sidebar-surface-primary p-4 text-xs","overflow-x-auto",e),children:[t&&r.jsx("div",{className:"mb-1 text-gray-400",children:t}),r.jsx("div",{className:g("prose flex flex-col-reverse",u?"text-white":"text-black"),children:r.jsx("pre",{className:g("shrink-0 overflow-auto",a),children:n})})]})}function te({traceback:e}){return r.jsx("div",{className:"overflow-auto border-t border-gray-500 bg-black text-white",children:r.jsx("div",{className:"border-s-4 border-red-500 p-2 text-xs",children:r.jsx("div",{className:"scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-700 flex max-h-64 flex-col-reverse",children:r.jsx("pre",{className:"shrink-0",children:e})})})})}function le({message:e,isCoT:t=!1}){var a;if(e.content.content_type!==f.ExecutionOutput)return null;const n=(a=e.metadata)==null?void 0:a.aggregate_result;return n?t?n.messages.filter(y).map((o,u)=>r.jsx(v,{jupyterMessage:o},u)):r.jsx("div",{className:"flex flex-wrap gap-2",children:n.messages.filter(y).map((o,u)=>r.jsx("div",{className:"max-h-64 items-start justify-start sm:max-h-80",children:r.jsx(v,{jupyterMessage:o})},u))}):(p.addError("Corrupt code execution result message"),null)}function ne(e){return e.message_type==="stream"}function y(e){return e.message_type==="image"||"image_url"in e&&K(e.image_url+"")}function ie(e){var t,n,a;return(a=(n=(t=e.metadata)==null?void 0:t.aggregate_result)==null?void 0:n.messages.some(y))!=null?a:!1}export{le as C,ue as a,ce as b,M as c,B as d,Z as e,v as f,ee as g,ie as h,y as i};
//# sourceMappingURL=b9tsn3f51rdwvzaj.js.map
