const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/njem4hkd3vzqk90b.js","assets/kfrdmkli83ureki3.js","assets/l3z5gz1257zwquc2.js","assets/o0j54eux3slox97p.js","assets/fwijeax9pw5s8qxf.js","assets/kw08ajijqinojrwh.js","assets/root-fi49nzd2.css","assets/bonby2i4xf93dev1.js","assets/dpf52wv18uwxh9t9.js","assets/mv59uia51hlqeiwb.js"])))=>i.map(i=>d[i]);
var Ce=Object.defineProperty,Ee=Object.defineProperties;var Le=Object.getOwnPropertyDescriptors;var oe=Object.getOwnPropertySymbols;var Se=Object.prototype.hasOwnProperty,Ae=Object.prototype.propertyIsEnumerable;var ie=(s,n,t)=>n in s?Ce(s,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[n]=t,l=(s,n)=>{for(var t in n||(n={}))Se.call(n,t)&&ie(s,t,n[t]);if(oe)for(var t of oe(n))Ae.call(n,t)&&ie(s,t,n[t]);return s},I=(s,n)=>Ee(s,Le(n));import{j as e,M as f,d as De,v as de,_ as E,r as N,h as ue,u as Re}from"./kfrdmkli83ureki3.js";import{u as G,az as L,f7 as d,al as me,qK as Ue,am as z,qL as D,aB as pe,oK as xe,qM as fe,hu as ge,lq as B,cy as le,e6 as Oe,br as ze,fL as Ge,aA as R,pa as qe,d as he,qN as Be,p as Ve,ps as Qe,pt as He,gM as je,pu as Ke,pb as Ze,oM as Xe,oL as We,_ as $e,j7 as Je,qO as A,kI as Ye,qP as Q,qQ as H,ka as es,kJ as ss,ga as ts,gc as ns,H as os,f8 as is,aC as ls,cq as rs}from"./kw08ajijqinojrwh.js";import{g as as,D as re}from"./nh6x5pasrftsddpw.js";import{b7 as cs,jU as ye,jV as ve,jW as ds,jX as us,fI as ae,fQ as ms}from"./fyw02vlaiv2vq6cj.js";import{F as ps}from"./je694u6n7mxuffnb.js";import{f as xs}from"./m89x2zftpo6hrypr.js";import{u as fs}from"./c7lf6x6u521mpx19.js";import{CustomInstructionsModal as gs}from"./gskm8euf92v8tid9.js";const hs=L(()=>E(()=>import("./njem4hkd3vzqk90b.js"),__vite__mapDeps([0,1])),{loading:s=>R(s)}),js=L(()=>E(()=>import("./l3z5gz1257zwquc2.js"),__vite__mapDeps([2,1])),{loading:s=>R(s)}),ys=L(()=>E(()=>import("./o0j54eux3slox97p.js"),__vite__mapDeps([3,1])),{loading:s=>R(s)}),ce=L(()=>E(()=>import("./fwijeax9pw5s8qxf.js"),__vite__mapDeps([4,1,5,6])).then(s=>s.FilePreviewModal));function vs({gizmoResource:s,canEdit:n,pendingFiles:t,files:r,interpreterOnlyFileIds:o,onAddFiles:u,removePendingFile:p,pendingFileUpsertMutationsRef:m}){G();const a=s.gizmo.id,i=s.gizmo.display.name;return t.length===0&&r.length===0?e.jsx("div",{className:"h-full pb-4",children:e.jsx(Ns,{gizmoName:i,onAddFiles:u,canEdit:n})}):e.jsxs("div",{className:"pb-6",children:[e.jsx(_s,{numFiles:r.length+t.length}),e.jsx(Is,{canEdit:n,projectId:a,files:r,pendingFiles:t,interpreterOnlyFileIds:o,removePendingFile:p,pendingFileUpsertMutationsRef:m,className:"border-token-border-light overflow-hidden rounded-lg border"})]})}function _s({numFiles:s}){const n=G(),t=me(n),r=De();if(!Ue({accountPlanType:t==null?void 0:t.planType,numFiles:s}))return null;let o;return(t==null?void 0:t.planType)===z.FREE?o=e.jsx(f,I(l({},d.projectFileRateLimitBannerPlusDescription),{values:{freeFileLimit:D(z.FREE),paidFileLimit:D(z.PLUS)}})):o=e.jsx(f,I(l({},d.projectFileRateLimitBannerProDescription),{values:{paidFileLimit:D(z.PLUS),proFileLimit:D(z.PRO),planType:t==null?void 0:t.planType.valueOf()}})),e.jsxs("div",{className:"bg-token-bg-tertiary mb-3 flex flex-row items-center justify-between gap-3 rounded-xl p-3 text-sm",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-token-text-primary",children:e.jsx(f,l({},d.projectFileRateLimitBannerTitle))}),e.jsx("span",{className:"text-token-text-secondary",children:o})]}),e.jsx(pe,{color:"secondary",className:"bg-token-bg-tertiary",onClick:()=>{cs(r,"projects file upsell banner")},children:e.jsx(f,l({},d.upgradeToPlus))})]})}function Is({projectId:s,files:n,pendingFiles:t,interpreterOnlyFileIds:r,removePendingFile:o,pendingFileUpsertMutationsRef:u,canEdit:p,className:m}){const a=xe();return n.length===0&&t.length===0?null:e.jsxs("div",{className:m,children:[n.map(i=>e.jsx(Fs,{gizmoId:s,gizmoFile:i,interpreterOnly:r.includes(i.file_id),canEdit:p,onDelete:()=>{const x=new Promise(M=>{u.current.push({id:s,mutationId:de(),update:g=>{const b=g.files.filter(T=>T.file_id!==i.file_id);return I(l({},g),{files:b})},onSuccess:M})});return fe(s)({projectId:s,upsertProjectMutation:a,pendingFileUpsertMutationsRef:u}),x}},i.file_id)),t.map(i=>e.jsx(bs,{canEdit:p,interpreterOnly:r.includes(i.tempId),pendingFile:i,onDelete:async()=>o(i.tempId)},i.tempId))]})}function _e(){return e.jsx("div",{className:"truncate",children:e.jsx(f,l({},d.interpreterOnlyLabel))})}function bs({pendingFile:s,onDelete:n,interpreterOnly:t,canEdit:r}){var m,a,i;const o=s.file.name,p=(ds(s.file)&&((m=s.file)==null?void 0:m.type.startsWith("image/"))||ge(o))&&e.jsx(ye,{file:s.file,fileName:o,fileId:(a=s.fileId)!=null?a:void 0,gizmoId:(i=s.gizmoId)!=null?i:void 0});return e.jsx(Ie,{interpreterOnly:t,onDelete:n,canEdit:r,children:e.jsx(ve,{icon:p,fileName:s.file.name,loadingPercentage:s.status===B.Uploading?s.progress:void 0,customFileDescription:t?e.jsx(_e,{}):void 0})})}function Fs({gizmoFile:s,gizmoId:n,interpreterOnly:t,onDelete:r,canEdit:o}){const u=s.name,m=ge(u)&&s.file_id!=null&&e.jsx(ye,{fileName:u,fileId:s.file_id,gizmoId:n}),a=G(),i=()=>{const x=s.file_id;x&&ze(a,ce,{gizmoId:n,fileId:x,fileName:s.name,onClose:()=>Ge(a,ce)})};return e.jsx(Ie,{interpreterOnly:t,onDelete:r,canEdit:o,children:e.jsx("div",{className:"cursor-pointer",onClick:i,children:e.jsx(ve,{icon:m,fileName:s.name,customFileDescription:t?e.jsx(_e,{}):void 0})})})}function Ie({children:s,onDelete:n,canEdit:t,interpreterOnly:r}){const[o,u]=N.useState(!1);return e.jsxs("div",{className:le("group/file-row border-token-border-light flex w-full items-center justify-between border-b p-3 text-sm last:border-b-0",t?"hover:bg-token-interactive-bg-primary-selected/5":"hover:bg-transparent",r),children:[e.jsx("div",{className:"can-hover:w-full w-10/12 group-hover:w-11/12",children:s}),t&&e.jsx("button",{onClick:async()=>{n&&(u(!0),await n(),u(!1))},className:le("group/file-layout -m-2 flex aspect-square shrink-0 grow-0 items-center justify-center bg-transparent p-2",!o&&"can-hover:opacity-0 group-hover/file-row:opacity-100 focus-visible:opacity-100"),children:e.jsx("div",{className:"group-hover/file-layout:bg-token-interactive-bg-primary-selected/5 group-active/file-layout:bg-token-interactive-bg-primary-selected/15 rounded-md p-[5px]",children:o?e.jsx("div",{className:"flex h-full w-6 items-center justify-center",children:e.jsx(Oe,{})}):e.jsx(js,{className:"icon-sm text-token-secondary"})})})]})}function Ns({gizmoName:s,onAddFiles:n,canEdit:t}){return e.jsx("div",{className:"border-token-border-default active:bg-token-bg-tertiary flex h-full cursor-pointer items-center justify-center rounded-lg border px-4 py-3 pb-6",onClick:n,children:e.jsxs("div",{className:"text-token-text-secondary flex flex-col items-center gap-2 py-4 text-sm",children:[t?e.jsx(hs,{}):e.jsx(ys,{}),e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-token-text-secondary max-w-100",children:e.jsx(f,I(l({},d.emptyFileInstructions),{values:{gizmoNameText:e.jsx("span",{className:"font-bold",children:e.jsx(f,I(l({},d.emptyFileGizmoName),{values:{gizmoName:s}}))},"gizmoNameText")}}))})})]})})}const Ps=L(()=>E(()=>import("./bonby2i4xf93dev1.js"),__vite__mapDeps([7,1])),{loading:s=>R(s)}),Ts=L(()=>E(()=>import("./dpf52wv18uwxh9t9.js"),__vite__mapDeps([8,1])),{loading:s=>R(s)});function Ms({ctx:s,gizmoResource:n,canEdit:t,gizmoEditorData:r,openFileDialog:o,pendingFiles:u,setVersion:p,pendingFileUpsertMutationsRef:m,currentModelConfig:a}){var T;const i=n.gizmo.id,x=(T=r==null?void 0:r.files)!=null?T:[],j=Array.from(u.current.values()).filter(c=>x.every(k=>k.file_id!==c.fileId)),M=j.filter(c=>a!=null&&Q(a,c.file.type,c.file.name)===H.CodeInterpreter),g=x.filter(c=>a!=null&&c.type!=null&&Q(a,c.type,c.name)===H.CodeInterpreter),b=[...M.map(c=>c.tempId),...g.map(c=>c.file_id)];return e.jsx(vs,{gizmoResource:n,canEdit:t,pendingFiles:j,pendingFileUpsertMutationsRef:m,files:x,interpreterOnlyFileIds:b,onAddFiles:o,removePendingFile:c=>{u.current.delete(c),A({ctx:s,id:i,pendingFiles:{key:c,value:null}}),p(k=>k+1)}})}const ks=N.forwardRef(function({gizmo:n,accountPlanType:t,showInstructions:r=!0,onPendingFilesChange:o},u){var Y,ee;const p=D(t),m=ue(),[a,i]=N.useState(!1),x=xe(),j=us(n),M=qe(j),g=G(),b=void 0,T=he(()=>ns(g,{isGizmo:!1})),c=(Y=T.models.get(Be))!=null?Y:T&&xs(T.models.values(),S=>S.tags.includes(ts.GPT_4o)),k=Ve(),[Cs,U]=N.useState(0),_=N.useRef(new Map),V=N.useRef([]),be=Qe(c,void 0),K=_.current.size>0;N.useEffect(()=>{o==null||o(K)},[K,o]);const Fe=S=>{S.some(({errors:F})=>{var P;return F.length!==1||((P=F[0])==null?void 0:P.code)!==ae.TooManyFiles})?k.danger(d.unknownError,{duration:2,toastId:"snorlax_handle_file_rejected"}):k.danger(m.formatMessage(d.dragTooManyFilesError,{maxFileLimit:p}),{duration:2,toastId:"snorlax_handle_file_rejected",loggingTitle:"drag_too_many_files_error"})},Ne=async S=>{$e.logEvent("Upload File",{client:"web",eventSource:"mouse",intent:"gizmo"});const F=j.id;S.length>0&&await Promise.all(S.map(P=>{const q=Je(P),se={tempId:q,gizmoId:F,file:P,status:B.Uploading,progress:1,fileId:null,cdnUrl:null};_.current.set(q,se),A({ctx:g,id:F,pendingFiles:{key:q,value:se}}),Ye(q,P,m,k,{kind:ss.Gizmo,gizmoId:F},{onFileUploaded:async(h,w,C,y)=>{const v=_.current.get(h);v!=null&&v.fileId&&v!=null&&v.fileId&&(V.current.push({id:n.gizmo.id,mutationId:de(),update:O=>{var te,ne;if(!v.fileId)return O;const we=[...(te=O.files)!=null?te:[],{file_id:v.fileId,name:v.file.name,size:v.file.size,type:(ne=y==null?void 0:y.mimeType)!=null?ne:es(v.file),last_modified:v.file.lastModified,file_size_tokens:y==null?void 0:y.fileTokenSize}];return I(l({},O),{files:we})},onSuccess:()=>{_.current.delete(h),A({ctx:g,id:F,pendingFiles:{key:h,value:null}}),U(O=>O+1)}}),fe(n.gizmo.id)({projectId:n.gizmo.id,upsertProjectMutation:x,pendingFileUpsertMutationsRef:V}))},onFileCreated:(h,w,C)=>{const y=I(l({tempId:h,gizmoId:F,file:P,status:B.Uploading,progress:1},_.current.get(h)),{fileId:w,cdnUrl:C});_.current.set(h,y),A({ctx:g,id:F,pendingFiles:{key:h,value:y}}),U(v=>v+1)},onFileUploadProgress:(h,w)=>{const C=_.current.get(h);if((C==null?void 0:C.status)===B.Uploading){const y=I(l({},C),{progress:w>95?95:w});_.current.set(h,y),A({ctx:g,id:F,pendingFiles:{key:h,value:y}})}U(y=>y+1)},onError:h=>{_.current.delete(h),A({ctx:g,id:F,pendingFiles:{key:h,value:null}}),U(w=>w+1)}},{usesRetrievalIndex:c!=null&&Q(c,P.type,P.name)===H.Retrieval,contextScopes:b})}))},Z=He(be),X=as(Z),W=_.current.size+j.files.length,{canEdit:$}=je(n),{open:J,getInputProps:Pe,getRootProps:Te,isDragAccept:Me,isDragReject:ke}=fs(l({noClick:!0,noKeyboard:!0,noDragEventsBubbling:!0,onDropAccepted:Ne,onDropRejected:Fe,multiple:!0,maxSize:Ke,maxFiles:p-W,validator:()=>W>=p?{code:ae.TooManyFiles,message:"Too many files"}:null,disabled:!$},Z));return N.useImperativeHandle(u,()=>({openFileDialog:J,hasPendingFiles:()=>_.current.size>0})),e.jsxs("div",I(l({},Te({className:"h-full px-4 min-w-0"})),{children:[e.jsx("input",l({},Pe())),r&&e.jsxs(ps,{children:[e.jsx("button",{className:"w-full",onClick:()=>i(!0),children:e.jsx("div",{className:"border-token-border-default w-full rounded-lg border text-start text-sm",children:(ee=j==null?void 0:j.instructions)!=null&&ee.length?e.jsx("div",{className:"mx-4 my-3 line-clamp-4",children:j.instructions}):e.jsxs("div",{className:"text-token-text-secondary flex h-full w-full items-center px-4 py-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx(f,l({},d.addCustomInstructions))}),e.jsx(Ps,{className:"icon-sm"})]})})}),M.includes(Ze.GizmoInstructionsTooLong)?e.jsx(Xe,{className:"mt-1",children:e.jsx(f,I(l({},d.instructionsTooLong),{values:{length:We}}))}):null]}),a&&e.jsx(gs,{gizmo:n,onClose:()=>{i(!1)}}),e.jsx(Ms,{ctx:g,gizmoResource:n,canEdit:$,gizmoEditorData:j,openFileDialog:J,pendingFiles:_,pendingFileUpsertMutationsRef:V,setVersion:U,currentModelConfig:c}),Me&&e.jsxs(re,{children:[e.jsx(ms,{}),e.jsx("h3",{children:e.jsx(f,l({},d.dragInstructions))}),e.jsx("h4",{className:"w-2/3 text-center",children:X.length>0?X.join(", "):e.jsx(f,l({},d.dragAllAccepted))})]}),ke&&e.jsxs(re,{children:[e.jsx(Ts,{className:"icon-2xl"}),e.jsx("h3",{children:e.jsx(f,l({},d.dragTooManyFiles))}),e.jsx("h4",{className:"w-2/3 text-center",children:e.jsx(f,I(l({},d.dragTooManyFilesDescription),{values:{maxFileLimit:p}}))})]})]}))}),ws=L(()=>E(()=>import("./mv59uia51hlqeiwb.js"),__vite__mapDeps([9,1])),{loading:s=>R(s)});function Bs({gizmo:s,onClose:n,project:t}){var g;const r=ue(),o=N.useRef(null),u=N.useCallback(()=>{var b;(b=o.current)==null||b.openFileDialog()},[o]),p=G(),m=me(p),a=Re(),{data:i}=os(s.gizmo.id),x=i!=null?i:s,{canEdit:j}=je(x),M=he(()=>{var b;return(b=t==null?void 0:t.filesCount$())!=null?b:0});return N.useEffect(()=>{a.invalidateQueries({queryKey:is(a,x.gizmo.id).queryKey})},[x.gizmo.id,a]),e.jsx(e.Fragment,{children:e.jsx(ls,{testId:"modal-project-files",className:"min-h-72 max-w-[820px]",isOpen:!0,showCloseButton:!0,hideSeparator:!0,noPadding:!0,size:"custom",type:"success",headerAccessory:j?e.jsx(pe,{color:"secondary",onClick:u,disabled:(g=m&&M>=D(m.planType))!=null?g:!1,children:e.jsx(f,l({},d.addFilesButtonLabel))}):e.jsx(rs,{label:r.formatMessage(d.viewOnlyCustomInstructionsModalHeaderTooltip),side:"left",align:"center",children:e.jsxs("div",{className:"text-token-text-tertiary flex flex-row items-center gap-1.5 text-sm",children:[e.jsx(ws,{className:"icon"}),e.jsx(f,l({},d.viewOnlyCustomInstructionsModalHeaderLabel))]})}),title:e.jsx(f,l({},d.projectFilesModalTitle)),onClose:()=>{n()},children:e.jsx("div",{className:"grid min-h-[50dvh] grow overflow-y-auto pt-0",children:m&&e.jsx(ks,{ref:o,gizmo:x,showInstructions:!1,accountPlanType:m.planType})})})})}export{Bs as SnorlaxFileModal};
//# sourceMappingURL=gzm1jxs289k6teg6.js.map
