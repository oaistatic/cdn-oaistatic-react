var Y=Object.defineProperty;var k=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var N=(n,a,s)=>a in n?Y(n,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[a]=s,D=(n,a)=>{for(var s in a||(a={}))z.call(a,s)&&N(n,s,a[s]);if(k)for(var s of k(a))q.call(a,s)&&N(n,s,a[s]);return n};import{h as O,u as J,r as f,j as e,M as d,e as V}from"./kfrdmkli83ureki3.js";import{p as H,u as K,ak as I,pf as X,_ as u,aC as Z,e6 as $,ew as y,kg as A,J as ee,D as ae}from"./kw08ajijqinojrwh.js";import{cT as te,dQ as se,aE as oe,be as ie}from"./fyw02vlaiv2vq6cj.js";import{g as ne}from"./lbp124td1jxnga57.js";import{u as ce}from"./netr1bp4j8j7hw8s.js";import"./o5h7u1aikohecbkt.js";import"./w4rmhhxvug61xnae.js";import"./batn8nst470a68ib.js";import"./h9s5uo8l29l5vali.js";import"./l3foo5601l7fb51e.js";import"./ite26mmpefwubzx4.js";import"./m9gq49u2vlb0cjyx.js";import"./lg0oi3tmjv8kv2p4.js";import"./b3ungmqo5x8kj4fh.js";import"./iej0cupg2dqkmejt.js";import"./m0t07ixd92668z9e.js";import"./ds50f4rqnruk5v5l.js";import"./chg5zn7ivsidhse5.js";function Pe({isOpen:n,onClose:a,onClaimOfferButtonClicked:s,currentAccount:t}){const i=O(),h=H(),m=K(),{data:p}=te(),g=se(t.id),{data:S,isLoading:x,error:C}=oe({currency:t.mustGetSubscriptionBillingCurrency("GlobalSettingsModal"),ctx:m}),F=t.data.subscriptionStatus.planType,w=t.getLastActiveSubscription().subscription_id,c=t.data.subscriptionStatus.discount,l=ie(F.toLowerCase()),B=J(),j=I(m,"468168202"),T=I(m,"3170465812"),G=t.isEligibleForCancellationPromotion(),{cancellationPromoMetadata:o,isCancelPromoLoading:M}=ce(t.id,G),W=o?T.get("promo_redemption_cta_color","secondary"):"secondary",{numPeriods:Q,formattedDiscountedCost:R}=f.useMemo(()=>{var P,E;const v=t.mustGetSubscriptionBillingCurrency("GlobalSettingsModal");if(!o||!S||x||C)return{numPeriods:0,formattedDiscountedCost:""};const r=(E=(P=o.duration)==null?void 0:P.num_periods)!=null?E:1;return D({numPeriods:r},ne(i,r,o.discount,v,S))},[t,o,i,S,x,C]),_=(c==null?void 0:c.cancellation_policy)===X.IMMEDIATE&&!(c!=null&&c.discount_start_in_num_periods),U=async()=>{if(!t||!w)throw new Error("Missing current account or subscription id");await g.mutateAsync(t.id,{onError:()=>{h.danger(L.cancelFailure,{duration:5,toastId:"cancel_subscription_modal"}),u.logEventWithStatsig("Cancel Subscription Modal Cancel Failed","chatgpt_cancel_subscription_modal_cancel_failed")},onSuccess:async()=>{if(B.invalidateQueries(A()),h.info(i.formatMessage(L.cancelSuccess),{duration:5}),u.logEventWithStatsig("Cancel Subscription Modal Cancel Success","chatgpt_cancel_subscription_modal_cancel_success"),ee(m,"3376055906")){const r=new URL("https://openai.qualtrics.com/jfe/form/SV_eW3mdeRdMrpnPLw");r.searchParams.append("subscription_id",w),r.searchParams.append("plan_type",t.planType),t.authUserId?r.searchParams.append("oai_user",t.authUserId):ae.addError("authUserId missing from currentAccount"),window.open(r.toString(),"_blank")}setTimeout(()=>{a()},5e3)}})};f.useEffect(()=>{g.isSuccess&&a()},[g.isSuccess,a]),f.useEffect(()=>{u.logEventWithStatsig("Cancel Subscription Modal Shown","chatgpt_cancel_subscription_modal_shown")}),f.useEffect(()=>{o&&!M&&u.logEventWithStatsig("Cancel Subscription Modal with Cancellation Promo Shown","chatgpt_cancel_subscription_modal_with_cancellation_promo_shown",{promo_id:o.campaign_id})},[o,M]);const b=p!=null&&p.active_until?new Date(p.active_until).toLocaleDateString(i.locale,{year:"numeric",month:"short",day:"numeric"}):"";return e.jsx(Z,{testId:"modal-cancel-subscription",type:"success",isOpen:n,onClose:a,size:"custom",noPadding:!0,className:"max-w-xl",showCloseButton:!0,title:o?i.formatMessage({id:"cancelSubscriptionModal.promo.title",defaultMessage:"Are you sure you want to cancel?"}):c?_?i.formatMessage({id:"cancelSubscriptionModal.hasDiscount.titleImmediate",defaultMessage:"End {planName} access immediately?"},{planName:l}):i.formatMessage({id:"cancelSubscriptionModal.hasDiscount.title",defaultMessage:"End {planName} access on {expirationDate}?"},{planName:l,expirationDate:b}):i.formatMessage({id:"cancelSubscriptionModal.title",defaultMessage:"Subscription Cancellation"}),removePopoverStyling:!0,children:M?e.jsx("div",{className:"flex items-center justify-center p-6",children:e.jsx($,{})}):e.jsxs("div",{className:"p-5",children:[o?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-token-text-secondary",children:o.summary}),e.jsxs("div",{className:"mt-4 flex items-center justify-between rounded-xl border border-solid p-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-token-text-primary text-base font-semibold",children:o.title})}),e.jsx("p",{className:"text-token-text-secondary mt-1 text-base",children:e.jsx(d,{id:"cancelPromoModal.regularPrice",defaultMessage:"For {discountedFormattedCost}, you'll get {planName} for {numPeriods} months.",values:{discountedFormattedCost:R,planName:l,numPeriods:Q}})})]}),e.jsx("div",{children:e.jsx(y,{title:i.formatMessage({id:"cancelPromoModal.promo.getOffer",defaultMessage:"Get offer"}),color:W,onClick:s})})]}),e.jsx("p",{className:"text-token-text-secondary mt-8",children:_?e.jsx(d,{id:"cancelSubscriptionModal.promo.canceledSubscriptionBottomImmediate",defaultMessage:"To cancel your subscription, just confirm your choice below. Your access to {planName} features will end immediately.",values:{planName:l}}):e.jsx(d,{id:"cancelSubscriptionModal.promo.canceledSubscriptionBottom",defaultMessage:"To cancel your subscription, just confirm your choice below. Your access to {planName} features will end on {expirationDate}.",values:{planName:l,expirationDate:b}})})]}):e.jsx("p",{className:"text-token-text-secondary",children:c?_?e.jsx(d,{id:"cancelSubscriptionModal.hasDiscount.canceledSubscriptionImmediate",defaultMessage:"If you cancel your subscription now, your {planName} access will end immediately. Any discounts applied will be removed, and can't be used again.",values:{planName:l}}):e.jsx(d,{id:"cancelSubscriptionModal.hasDiscount.canceledSubscription",defaultMessage:"If you cancel your subscription now, your {planName} access will end on {expirationDate}. Any discounts applied will be removed, and can't be used again.",values:{planName:l,expirationDate:b}}):e.jsx(d,{id:"cancelSubscriptionModal.canceledSubscription",defaultMessage:"Your {planName} subscription will be canceled but will remain active until the end of your billing period on {expirationDate}.",values:{planName:l,expirationDate:b}})}),e.jsxs("div",{className:"mt-8 flex justify-end gap-2",children:[e.jsx(y,{title:i.formatMessage({id:"cancelSubscriptionModal.goBack",defaultMessage:"Go back"}),color:j.get("cancellation_modal_go_back_button_color","secondary"),onClick:a}),e.jsx(y,{title:i.formatMessage({id:"cancelSubscriptionModal.cancel",defaultMessage:"Cancel subscription"}),color:j.get("cancellation_modal_cancel_button_color","danger"),onClick:()=>{u.logEventWithStatsig("Cancel Subscription Modal Confirmation Button Clicked","chatgpt_cancel_subscription_modal_confirmation_button_clicked"),U()},loading:g.isPending})]})]})})}const L=V({cancelSuccess:{id:"cancelSubscriptionModal.cancelSuccess",defaultMessage:"Your subscription has been canceled."},cancelFailure:{id:"cancelSubscriptionModal.cancelFailure",defaultMessage:"Something went wrong while canceling your subscription."}});export{Pe as CancelSubscriptionModal};
//# sourceMappingURL=cl2tf2fdudyyttjl.js.map
