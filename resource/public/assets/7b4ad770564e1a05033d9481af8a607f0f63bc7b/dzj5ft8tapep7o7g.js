const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/l3z5gz1257zwquc2.js","assets/kfrdmkli83ureki3.js","assets/jqy8zfwhk6ptqvmj.js","assets/ezd0hym0jr36348y.js","assets/ailj2wmeuzip7d2v.js"])))=>i.map(i=>d[i]);
var R=Object.defineProperty;var I=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var P=(t,s,a)=>s in t?R(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,i=(t,s)=>{for(var a in s||(s={}))O.call(s,a)&&P(t,a,s[a]);if(I)for(var a of I(s))Q.call(s,a)&&P(t,a,s[a]);return t};import{h as M,j as e,M as d,e as K,b,u as _,i as p,F as L,_ as j}from"./kfrdmkli83ureki3.js";import{R as u,aB as B,aC as H,p as v,fd as z,eG as W,az as C,cq as E,as as U,aA as k}from"./kw08ajijqinojrwh.js";import{g as V}from"./irqko7c1s7qpl41n.js";import{a$ as n,da as w,h5 as G}from"./fyw02vlaiv2vq6cj.js";function $(t){return u.safeDelete("/share/post/{post_id}",{parameters:{path:{post_id:t}}})}function Y(){return u.safeDelete("/share/posts/mine")}function X({limit:t}){return u.safeGet("/share/posts/mine",{parameters:{query:{limit:t}}})}const J=C(()=>j(()=>import("./l3z5gz1257zwquc2.js"),__vite__mapDeps([0,1])),{loading:t=>k(t)}),T=C(()=>j(()=>import("./jqy8zfwhk6ptqvmj.js"),__vite__mapDeps([2,1])),{loading:t=>k(t)}),Z=C(()=>j(()=>import("./ezd0hym0jr36348y.js"),__vite__mapDeps([3,1])),{loading:t=>k(t)}),ee=C(()=>j(()=>import("./ailj2wmeuzip7d2v.js"),__vite__mapDeps([4,1])),{loading:t=>k(t)}),h={sharedConversations:["sharedConversations"],sharedTextdocs:["sharedTextdocs"],sharedPosts:["sharedPosts"]},r=K({name:{id:"sharedConversationModal.name",defaultMessage:"Name"},dateShared:{id:"sharedConversationModal.dateShared",defaultMessage:"Date shared"},type:{id:"YiHQp6",defaultMessage:"Type"},chatType:{id:"0BR1NF",defaultMessage:"Chat"},canvasType:{id:"AalPA+",defaultMessage:"Canvas"},postType:{id:"UXpwgD",defaultMessage:"Post"},imageType:{id:"i6Dtp1",defaultMessage:"Image"},loading:{id:"sharedConversationModal.loading",defaultMessage:"Loading..."},somethingWentWrong:{id:"sharedConversationModal.somethingWentWrong",defaultMessage:"Something went wrong..."},retry:{id:"sharedConversationModal.retry",defaultMessage:"Retry"},noSharedConversations:{id:"sharedConversationModal.noSharedConversations",defaultMessage:"You have no shared links."},title:{id:"sharedConversationModal.title",defaultMessage:"Shared Links"},goToOriginConversation:{id:"sharedConversationModal.goToOriginConversation",defaultMessage:"View source chat"},deleteSharedLink:{id:"sharedConversationModal.deleteSharedLink",defaultMessage:"Delete shared link"},deleteSharedLinkFailed:{id:"sharedConversationModal.deleteSharedLinkFailed",defaultMessage:"Deleting shared link failed"},deleteAllSharedLinks:{id:"sharedConversationModal.deleteSharedAllConversations",defaultMessage:"Delete all shared links"},deleteAllSharedLinksConfirm:{id:"sharedConversationModal.deleteSharedAllConversationsConfirm",defaultMessage:"Are you sure you want to delete all your shared links?"},deleteAllSharedLinksFailed:{id:"sharedConversationModal.deleteSharedAllConversationsFailed",defaultMessage:"Deleting shared links failed"}});function te(){const t=_(),s=M(),a=v(),l=w(!0),{mutate:c}=p({mutationFn:()=>Promise.allSettled([u.safeDelete("/share/all",{requestBody:{confirm:!0}}),u.safeDelete("/shared_textdocs",{}),l()?Y():Promise.resolve()]),onSettled:()=>{t.invalidateQueries({queryKey:h.sharedConversations}),t.invalidateQueries({queryKey:h.sharedTextdocs}),t.invalidateQueries({queryKey:h.sharedPosts})},onError:()=>{a.danger(r.deleteAllSharedLinksFailed,{toastId:"delete_all_shared_links_failed"})}});return e.jsx(z,{side:"bottom",sideOffset:4,triggerButton:e.jsx("button",{className:"text-token-text-tertiary hover:text-token-text-secondary radix-state-open:text-token-text-tertiary dark:radix-state-open:text-gray-400",children:e.jsx(Z,{className:"icon-sm"})}),children:e.jsx(W.Item,{onClick:()=>{window.confirm(s.formatMessage(r.deleteAllSharedLinksConfirm))&&c()},color:"danger",children:e.jsx(d,i({},r.deleteAllSharedLinks))})})}function se(){return u.safeGet("/shared_conversations",{parameters:{query:{order:"created"}}})}function ae(){return b({queryKey:h.sharedConversations,queryFn:se,refetchOnMount:"always"})}function re(){return b({queryKey:h.sharedTextdocs,queryFn:()=>u.safeGet("/shared_textdocs",{}),refetchOnMount:"always"})}function ne(){const s=w(!0)();return b({queryKey:h.sharedPosts,queryFn:()=>X({limit:1e4}),refetchOnMount:"always",enabled:s,initialData:s?{items:[],cursor:null}:void 0})}const D=({conversationId:t,onClickDelete:s})=>{const a=M();return e.jsx(n.Cell,{textAlign:"right",children:e.jsxs(n.Actions,{children:[t&&e.jsx(E,{label:a.formatMessage(r.goToOriginConversation),side:"top",children:e.jsx("a",{href:U(t),target:"_blank",rel:"noreferrer","aria-label":a.formatMessage(r.goToOriginConversation),className:"text-token-text-tertiary hover:text-token-text-secondary cursor-pointer",children:e.jsx(ee,{className:"icon-sm"})})}),e.jsx(E,{label:a.formatMessage(r.deleteSharedLink),side:"top",className:"flex h-fit",children:e.jsx("button",{onClick:s,"aria-label":a.formatMessage(r.deleteSharedLink),className:"text-token-text-tertiary hover:text-token-text-secondary",children:e.jsx(J,{className:"icon-sm"})})})]})})};function oe({sharedConversation:t}){const s=v(),a=_(),{mutate:l,isPending:c}=p({mutationFn:({sharedConversationId:x})=>u.safeDelete("/share/{shared_conversation_id}",{parameters:{path:{shared_conversation_id:x}}}),onSettled:()=>{a.invalidateQueries({queryKey:h.sharedConversations})},onError:()=>{s.danger(r.deleteSharedLinkFailed,{toastId:"delete_shared_link_failed"})}}),o=t.workspace_id!=null?"/share/e/".concat(t.id):"/share/".concat(t.id);return e.jsxs(n.Row,{disabled:c,children:[e.jsx(n.Cell,{children:e.jsxs("a",{href:o,target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-2 align-top text-blue-500 dark:text-blue-400",children:[e.jsx(T,{className:"icon-sm shrink-0"}),t.title]})}),e.jsx(n.Cell,{children:e.jsx(d,i({},r.chatType))}),e.jsx(n.Cell,{children:t.create_time!=null?e.jsx(L,{value:t.create_time,month:"long",year:"numeric",day:"numeric"}):null}),e.jsx(D,{conversationId:t.conversation_id,onClickDelete:()=>l({sharedConversationId:t.id})})]})}function ie({sharedTextdoc:t}){const{conversation_id:s,shared_textdoc_id:a}=t,l=v(),c=_(),{mutate:o,isPending:x}=p({mutationFn:async({sharedTextdocId:g})=>u.safeDelete("/textdoc/shared/{shared_textdoc_id}",{parameters:{path:{shared_textdoc_id:g}}}),onSettled:()=>{c.invalidateQueries({queryKey:h.sharedTextdocs})},onError:()=>{l.danger(r.deleteSharedLinkFailed,{toastId:"delete_shared_link_failed"})}});return e.jsxs(n.Row,{disabled:x,children:[e.jsx(n.Cell,{children:e.jsxs("a",{href:V(a),target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-2 align-top text-blue-500 dark:text-blue-400",children:[e.jsx(T,{className:"icon-sm shrink-0"}),t.name]})}),e.jsx(n.Cell,{children:e.jsx(d,i({},r.canvasType))}),e.jsx(n.Cell,{children:t.created_at!=null?e.jsx(L,{value:t.created_at,month:"long",year:"numeric",day:"numeric"}):null}),e.jsx(D,{conversationId:s,onClickDelete:()=>o({sharedTextdocId:a})})]})}function de({sharedPost:t}){var x,g;const s=v(),a=_(),{mutate:l,isPending:c}=p({mutationFn:async({postId:S})=>$(S),onSettled:()=>{a.invalidateQueries({queryKey:h.sharedPosts})},onError:()=>{s.danger(r.deleteSharedLinkFailed,{toastId:"delete_shared_post_failed"})}}),o=((g=(x=t.attachments)==null?void 0:x[0])==null?void 0:g.kind)==="media_generation"?r.imageType:r.postType;return e.jsxs(n.Row,{disabled:c,children:[e.jsx(n.Cell,{children:e.jsxs("a",{href:G(t.id),target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-2 align-top text-blue-500 dark:text-blue-400",children:[e.jsx(T,{className:"icon-sm shrink-0"}),t.text]})}),e.jsx(n.Cell,{children:e.jsx(d,i({},o))}),e.jsx(n.Cell,{children:t.posted_at!=null?e.jsx(L,{value:t.posted_at*1e3,month:"long",year:"numeric",day:"numeric"}):null}),e.jsx(D,{conversationId:void 0,onClickDelete:()=>l({postId:t.id})})]})}function me({onClose:t}){const{data:s,isLoading:a,isError:l,refetch:c}=ae(),{data:o,isLoading:x,isError:g,refetch:S}=re(),{data:f,isLoading:A,isError:q,refetch:F}=ne(),N=M();let y;return a||x||A?y=e.jsx("div",{className:"text-token-text-secondary pb-8",children:e.jsx(d,i({},r.loading))}):g||l||q?y=e.jsxs("div",{children:[e.jsx("div",{className:"mb-4 text-red-500",children:e.jsx(d,i({},r.somethingWentWrong))}),e.jsx("div",{children:e.jsx(B,{color:"secondary",onClick:()=>{c(),S(),F()},children:e.jsx(d,i({},r.retry))})})]}):(s==null?void 0:s.total)===0&&(o==null?void 0:o.shared_textdocs.length)===0&&(f==null?void 0:f.items.length)===0?y=e.jsx("div",{className:"text-token-text-tertiary pb-8",children:e.jsx(d,i({},r.noSharedConversations))}):y=e.jsxs(n.Root,{className:"max-h-[28rem]",size:"compact",children:[e.jsxs(n.Header,{children:[e.jsx(n.HeaderCell,{children:e.jsx(d,i({},r.name))}),e.jsx(n.HeaderCell,{children:e.jsx(d,i({},r.type))}),e.jsx(n.HeaderCell,{children:e.jsx(d,i({},r.dateShared))}),e.jsx(n.HeaderCell,{textAlign:"right",children:e.jsx(te,{})})]}),e.jsxs(n.Body,{children:[s==null?void 0:s.items.map(m=>e.jsx(oe,{sharedConversation:m},m.id)),o==null?void 0:o.shared_textdocs.map(m=>e.jsx(ie,{sharedTextdoc:m},m.shared_textdoc_id)),f==null?void 0:f.items.map(m=>e.jsx(de,{sharedPost:m},m.id))]})]}),e.jsx(H,{isOpen:!0,onClose:t,size:"custom",className:"max-w-5xl",type:"success",title:N.formatMessage(r.title),testId:"modal-shared-conversations",showCloseButton:!0,children:y})}export{me as default};
//# sourceMappingURL=dzj5ft8tapep7o7g.js.map
