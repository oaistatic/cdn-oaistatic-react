var ot=Object.defineProperty,at=Object.defineProperties;var it=Object.getOwnPropertyDescriptors;var He=Object.getOwnPropertySymbols;var rt=Object.prototype.hasOwnProperty,lt=Object.prototype.propertyIsEnumerable;var We=(t,e,s)=>e in t?ot(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Oe=(t,e)=>{for(var s in e||(e={}))rt.call(e,s)&&We(t,s,e[s]);if(He)for(var s of He(e))lt.call(e,s)&&We(t,s,e[s]);return t},Ue=(t,e)=>at(t,it(e));import{r as p,o as ct,h as dt,j as u,c as Ke}from"./kfrdmkli83ureki3.js";import{u as Q,d as Pe,hZ as ut,aP as ze,sx as mt,M as $e,V as Z,hM as ft,fF as ht,i3 as pt,cd as xt,i5 as Xe,f9 as gt,c9 as Ge,d_ as Ct,sy as Tt,dR as I,lS as _t}from"./kw08ajijqinojrwh.js";import{bH as Le,nd as vt,ne as Ze,e6 as yt,C as S,nf as bt,ng as It,mg as St,nh as wt,ni as Et,nj as At,nk as Rt,nc as Nt,nl as Dt,nm as Ft,nn as Ot,no as Ve,np as Je,mH as jt,u as Pt,fe as Me,nq as qe,nr as Be,ns as Lt,nt as Mt,nu as kt}from"./fyw02vlaiv2vq6cj.js";import{L as Ht}from"./mywblj616r9yptxe.js";import{T as Wt}from"./gp1ys6tmiztz1f16.js";import{g as Ut}from"./bj1ejin6tzi0v3v8.js";import"./ce3hgmw4iyyhicud.js";import"./mstl8wgfzorpgdoe.js";import"./cp40hb6p64z5j02r.js";import"./kfdkis1zwf4ccfgg.js";import"./ol9d5wxhynx9q2is.js";import"./mbmcx8v24u1ao1ke.js";import"./fxom17ahenhnb7xw.js";import"./e7j9ia0bu5w3396k.js";import"./edhlcmww46h398kf.js";import"./deakbbf27g8e7ba0.js";import"./ft1wtuo4ibr3do9l.js";import"./kl7c6054usfnqmd4.js";import"./k97n0y6ba9c9h39c.js";import"./f86yt77iw8uocdb0.js";import"./omn9nfsnpjwo50x8.js";import"./juhk9bg10nm4p27d.js";import"./ns51nblw8ziscsgd.js";import"./drmwaklva7v056il.js";import"./hytzro4etxb8j4b5.js";import"./bj2o1htuhytjg1ta.js";import"./byis8e009cwknczn.js";import"./fx4g5niv8hgtkxju.js";import"./f538t4a72yr8mvhj.js";import"./cjv4tm2buxt5byw3.js";import"./bmm8s4kivjzbh6zb.js";import"./o9u4h3iqiok9m0a8.js";import"./lfj020w6m7gfm8bo.js";import"./de3ceoxcpky3ng0s.js";import"./gf4c0f98pdaqc94a.js";import"./idxukd613qgy7urm.js";import"./he1xnididjbc7s63.js";import"./i85urdvpkzpdgj3s.js";import"./dd8hh2tmra1psngf.js";import"./irqko7c1s7qpl41n.js";import"./eix6aku103dkp2pu.js";import"./c326bjybavj646xd.js";import"./lwyag88acem9bm0o.js";import"./lg0oi3tmjv8kv2p4.js";import"./b3ungmqo5x8kj4fh.js";import"./o5h7u1aikohecbkt.js";import"./w4rmhhxvug61xnae.js";import"./dlgsnq6ip01ej7wa.js";const Ye="oai/apps/canmoreSidebarWidth",zt=.25,Gt=400,Qe=400;function et(t){return t-Gt}function Te(t,e){return mt(Qe,et(t),e!=null?e:zt*t)}function Vt(){const t=Q(),e=Pe(()=>Le(t).width),s=Te(e,ut(ze.DANGER_SECRET_FOLDERS_ONLY_getItem(Ye))),r=tt(),[n,i]=p.useState(s);p.useEffect(()=>{(n<Qe||n>et(e))&&i(Te(e,n))},[e]);function o(d){i(f=>Te(e,f+=d.delta.x))}function a(d){i(d),ze.DANGER_SECRET_FOLDERS_ONLY_setItem(Ye,d)}function l(){const d=Te(e,void 0);a(d)}const c="calc(100vw - ".concat(n,"px)");return r?{chatWidth:n,canvasWidth:e-n,canvasWidthCalc:c,viewportWidth:e,handleDrag:o,handleDoubleClick:l,persist:a}:{chatWidth:0,canvasWidth:e,canvasWidthCalc:"100vw",viewportWidth:e,handleDrag:()=>{},handleDoubleClick:()=>{},persist:()=>{}}}function tt(t){const e=Q();return Pe(()=>(t!=null?t:Le(e).width)>1e3)}const je="sharedCanvas";function qt(){const[t,e]=ct(),s=t.get(je),r=dt();p.useEffect(()=>{const n=s&&vt.createRemixTempTextdoc(s,r);if(!n)return;requestAnimationFrame(()=>{Ze(n)});const i=new URLSearchParams(t);i.delete(je),e(i);const o=new URL(window.location.href);o.searchParams.delete(je),history.replaceState(null,"",o)},[s,t,e,r])}const Bt="textdocId",Yt=t=>{const s=new URLSearchParams(window.location.search).get(Bt),r=$e(t,n=>{var i,o,a;return(a=(o=(i=Z.findNode(n,({message:l})=>{var d;const c=(d=l.metadata)==null?void 0:d.canvas;return(c==null?void 0:c.create_source)===yt.HIVE&&(s?(c==null?void 0:c.textdoc_id)===s:!0)}))==null?void 0:i.message.metadata)==null?void 0:o.canvas)==null?void 0:a.textdoc_id});p.useEffect(()=>{r&&requestAnimationFrame(()=>{Ze(r)})},[r])};function Kt(t,e){let s;return(e==null?void 0:e.type)===S.Textdoc&&(e.textdocId.startsWith(bt)||(s={type:"canvas_textdoc",id:e.textdocId})),It(t,{promptMessage:{metadata:{open_in_canvas_view:s}}})}const st=({isFullScreen:t=!1,clientThreadId:e,focusedObject:s,onClose:r,isAnimating:n=!1,width:i})=>{const{setTargetedContent:o}=St(),a=p.useRef(!1);if(p.useEffect(()=>(a.current&&o(void 0),a.current=!0,()=>{a.current=!1}),[s]),s==null)return null;switch(s.type){case S.Textdoc:return u.jsx(Wt,{isFullScreen:t,onClose:r,clientThreadId:e,focusedTextdoc:s,isAnimating:n,width:i});case S.ADAVisualization:return null}},$t=300,Xt=t=>{switch(t==null?void 0:t.type){case S.Textdoc:return t.textdocId;default:return null}};function Zt({clientThreadId:t,isDisabled:e,disabledTypes:s}){const[r,n,i,o,a]=$e(t,x=>[Z.getRequestId(x),Z.getConversationLastTurn(x),Z.isMessageTurnEnded(x),Z.getVariantIds(x).length>1,Z.lastUserMessage(x)],{disablePerfDetector:!0}),l=ft(r),c=wt(),[d,f]=p.useMemo(()=>{if(n&&o)return[void 0,null];if(e===!0)return[void 0,null];if(a!=null){const C=Et(a);if(C)return[a.id,{type:S.Textdoc,textdocId:C}]}let x;return!i&&n&&(x=ht(n.messageGroups,C=>C.type!==pt)),Jt({groupedMessage:x,isRequestActive:l,latestTextdocId:c,disabledTypes:s})},[i,n,o,e,l,c,s,a]),m=f!=null,ve=Xt(f),ye=At("canvas");p.useEffect(()=>{if(f&&d&&!xt()&&(ye(),Rt(f,d),f.type===S.Textdoc)){const{textdocId:x}=f,C=Ut(x);Nt(document.getElementById(C))}},[m,ve])}function Jt({groupedMessage:t,isRequestActive:e,latestTextdocId:s,disabledTypes:r}){var n,i;if(t!=null&&t.type&&r.includes(t.type))return[void 0,null];switch(t==null?void 0:t.type){case Xe.Canmore:{const[o,a]=t.messages;if(!Dt(o))break;const l=Ft(e,o,a!=null?a:null),c=(n=l.textdocId)!=null?n:s;if(c&&(l.function===Ot.CreateTextdoc?((i=l.content)!=null?i:"").length>$t||l.status===Ve.WAITING:l.status===Ve.STREAMING))return[l.messageId,{type:S.Textdoc,textdocId:c}];break}}return[void 0,null]}const _e={type:"spring",bounce:.12},Qt={type:"spring",bounce:0},b={duration:0},es=t=>{"use forget";const e=Ke.c(112),{clientThreadId:s,focusedObject:r,onClose:n}=t,i=Q(),{chatWidth:o,canvasWidthCalc:a,handleDrag:l,handleDoubleClick:c,persist:d}=Vt();let f;e[0]!==i?(f=Me(i),e[0]=i,e[1]=f):f=e[1];const m=f,[ve,ye]=p.useState(!m),[x,C]=p.useState(!1),be=m?b:_e,Ie=m?b:Qt,T=Lt(os);let ee;e[2]!==i?(ee=()=>Le(i),e[2]=i,e[3]=ee):ee=e[3];const{height:_,width:w}=Pe(ee);let te;e[4]!==o||e[5]!==_||e[6]!==T||e[7]!==w?(te=T!=null?T:{top:0,left:o,width:w-o,height:_},e[4]=o,e[5]=_,e[6]=T,e[7]=w,e[8]=te):te=e[8];let h=te,ke=!1;if(T&&(h.top<0||h.top+h.height>_)){ke=!0;const xe=(w-o)*.75,J=_*.75;let ge;e[9]!==xe||e[10]!==J?(ge={width:xe,height:J},e[9]=xe,e[10]=J,e[11]=ge):ge=e[11];const y=ge,De=_/2-y.height/2,Fe=(w-o-y.width)/2+o;let Ce;e[12]!==y.height||e[13]!==y.width||e[14]!==De||e[15]!==Fe?(Ce={top:De,left:Fe,width:y.width,height:y.height},e[12]=y.height,e[13]=y.width,e[14]=De,e[15]=Fe,e[16]=Ce):Ce=e[16],h=Ce}const g=T==null?void 0:T.borderRadius,v=Mt(),Se=(v==null?void 0:v.history)!=null||(v==null?void 0:v.showChangesAtVersion)!=null,nt=_t();let E;e[17]!==v||e[18]!==Se?(E=Se&&u.jsx(Ht,{onClick:()=>kt(v.textdocId),zIndexKey:"chatOverlay"}),e[17]=v,e[18]=Se,e[19]=E):E=e[19];const we=nt?-260:0;let A;e[20]!==we?(A={marginInlineEnd:we},e[20]=we,e[21]=A):A=e[21];let se;e[22]===Symbol.for("react.memo_cache_sentinel")?(se={marginInlineEnd:0},e[22]=se):se=e[22];let ne,oe,ae;e[23]===Symbol.for("react.memo_cache_sentinel")?(oe={opacity:1},ae={opacity:0},ne={opacity:[1,0]},e[23]=ne,e[24]=oe,e[25]=ae):(ne=e[23],oe=e[24],ae=e[25]);let R;e[26]!==m?(R=m?b:Ue(Oe({},_e),{delay:.22}),e[26]=m,e[27]=R):R=e[27];let N;e[28]!==R?(N=u.jsx(I.div,{initial:oe,animate:ae,exit:ne,transition:R,className:"bg-token-main-surface-primary pointer-events-none absolute start-0 top-0 z-20 h-full w-full"}),e[28]=R,e[29]=N):N=e[29];let D;e[30]!==a?(D={width:a},e[30]=a,e[31]=D):D=e[31];let ie;e[32]===Symbol.for("react.memo_cache_sentinel")?(ie={width:0},e[32]=ie):ie=e[32];let F;e[33]!==m?(F=m?b:{type:"spring",bounce:0},e[33]=m,e[34]=F):F=e[34];let O;e[35]!==D||e[36]!==F?(O=u.jsx(I.div,{className:"relative z-20 h-full",style:D,exit:ie,transition:F}),e[35]=D,e[36]=F,e[37]=O):O=e[37];let j;e[38]!==Ie||e[39]!==N||e[40]!==O||e[41]!==A?(j=u.jsxs(I.div,{initial:A,animate:se,transition:Ie,children:[N,O]}),e[38]=Ie,e[39]=N,e[40]=O,e[41]=A,e[42]=j):j=e[42];const Ee=ke?0:1;let P;e[43]!==g||e[44]!==h.height||e[45]!==h.left||e[46]!==h.top||e[47]!==h.width||e[48]!==Ee?(P={borderRadius:g,opacity:Ee,x:h.left,y:h.top,height:h.height,width:h.width},e[43]=g,e[44]=h.height,e[45]=h.left,e[46]=h.top,e[47]=h.width,e[48]=Ee,e[49]=P):P=e[49];let L;e[50]!==a||e[51]!==o||e[52]!==_?(L={opacity:1,x:o,y:0,width:a,height:_,borderRadius:0},e[50]=a,e[51]=o,e[52]=_,e[53]=L):L=e[53];let M;e[54]!==m?(M=m?b:{opacity:{type:"spring",bounce:.1}},e[54]=m,e[55]=M):M=e[55];let k;e[56]!==g||e[57]!==M?(k={scale:.64,opacity:0,filter:"blur(12px)",transition:M,borderRadius:g},e[56]=g,e[57]=M,e[58]=k):k=e[58];const Ae=x||m?b:_e;let re;e[59]===Symbol.for("react.memo_cache_sentinel")?(re=()=>ye(!1),e[59]=re):re=e[59];let H;e[60]!==g?(H={borderRadius:g},e[60]=g,e[61]=H):H=e[61];let le;e[62]===Symbol.for("react.memo_cache_sentinel")?(le={borderRadius:0},e[62]=le):le=e[62];let W;e[63]!==g?(W={borderRadius:g},e[63]=g,e[64]=W):W=e[64];let ce,de;e[65]===Symbol.for("react.memo_cache_sentinel")?(ce={opacity:.5},de={opacity:.75,width:"8px",left:"-4px"},e[65]=ce,e[66]=de):(ce=e[65],de=e[66]);let U;e[67]!==m?(U=m?b:{type:"tween",duration:.1},e[67]=m,e[68]=U):U=e[68];let ue;e[69]===Symbol.for("react.memo_cache_sentinel")?(ue={x:0,y:0,transform:"translateX(0px)"},e[69]=ue):ue=e[69];let me,fe,he;e[70]===Symbol.for("react.memo_cache_sentinel")?(me={left:0,right:0,top:0,bottom:0},fe=()=>C(!0),he=()=>C(!1),e[70]=me,e[71]=fe,e[72]=he):(me=e[70],fe=e[71],he=e[72]);let z;e[73]!==l?(z=(xe,J)=>l(J),e[73]=l,e[74]=z):z=e[74];let G;e[75]!==o||e[76]!==d?(G=()=>{C(!1),d(o)},e[75]=o,e[76]=d,e[77]=G):G=e[77];let V;e[78]!==c?(V=()=>c(),e[78]=c,e[79]=V):V=e[79];let q;e[80]!==U||e[81]!==z||e[82]!==G||e[83]!==V?(q=u.jsx(I.div,{drag:"x",className:"bg-token-text-quaternary absolute start-[-2px] z-10 h-full w-[4px] cursor-ew-resize opacity-0",whileHover:ce,whileDrag:de,transition:U,style:ue,dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:me,onPointerDown:fe,onPointerUp:he,onDrag:z,onDragEnd:G,onDoubleClick:V}),e[80]=U,e[81]=z,e[82]=G,e[83]=V,e[84]=q):q=e[84];let B;e[85]!==x?(B=x&&u.jsx("div",{className:"absolute inset-0 z-10"}),e[85]=x,e[86]=B):B=e[86];const Re=!m&&ve,Ne=w-o;let Y;e[87]!==s||e[88]!==r||e[89]!==n||e[90]!==Re||e[91]!==Ne?(Y=u.jsx(st,{onClose:n,clientThreadId:s,isAnimating:Re,focusedObject:r,width:Ne}),e[87]=s,e[88]=r,e[89]=n,e[90]=Re,e[91]=Ne,e[92]=Y):Y=e[92];let K;e[93]!==q||e[94]!==B||e[95]!==Y?(K=u.jsxs("div",{className:"h-full",children:[q,B,Y]}),e[93]=q,e[94]=B,e[95]=Y,e[96]=K):K=e[96];let $;e[97]!==H||e[98]!==W||e[99]!==K||e[100]!==be?($=u.jsx(I.div,{className:"dark:border-token-border-light border-token-border-medium h-full overflow-hidden border-s",initial:H,animate:le,exit:W,transition:be,children:K}),e[97]=H,e[98]=W,e[99]=K,e[100]=be,e[101]=$):$=e[101];let X;e[102]!==P||e[103]!==L||e[104]!==k||e[105]!==Ae||e[106]!==$?(X=u.jsx(I.div,{className:"bg-token-bg-primary absolute start-0 z-20 h-full overflow-hidden shadow-[0_0_18px_rgba(0,0,0,0.12)] dark:shadow-[0_0_18px_rgba(0,0,0,0.48)]",initial:P,animate:L,exit:k,transition:Ae,onAnimationComplete:re,children:$}),e[102]=P,e[103]=L,e[104]=k,e[105]=Ae,e[106]=$,e[107]=X):X=e[107];let pe;return e[108]!==j||e[109]!==E||e[110]!==X?(pe=u.jsxs(u.Fragment,{children:[E,j,X]}),e[108]=j,e[109]=E,e[110]=X,e[111]=pe):pe=e[111],pe},ts=p.memo(es),ss=t=>{"use forget";const e=Ke.c(9),{clientThreadId:s,focusedObject:r,onClose:n}=t,i=Q(),o=Me(i);let a,l;e[0]===Symbol.for("react.memo_cache_sentinel")?(a={scale:.98},l={scale:1},e[0]=a,e[1]=l):(a=e[0],l=e[1]);const c=o?b:_e;let d;e[2]!==s||e[3]!==r||e[4]!==n?(d=u.jsx(st,{isFullScreen:!0,clientThreadId:s,focusedObject:r,onClose:n}),e[2]=s,e[3]=r,e[4]=n,e[5]=d):d=e[5];let f;return e[6]!==c||e[7]!==d?(f=u.jsx(Tt,{open:!0,className:"fixed inset-0 z-50 h-full w-full",children:u.jsx(I.div,{className:"z-40 h-full w-full overflow-hidden shadow-xl md:border-gray-100 md:dark:border-gray-700",initial:a,animate:l,transition:c,children:d})}),e[6]=c,e[7]=d,e[8]=f):f=e[8],f},ns=({clientThreadId:t,overrideWidth:e,isAutoFocusDisabled:s=!1})=>{const r=Q(),n=Pt(),i=tt(e),o=Me(r);Zt({clientThreadId:t,isDisabled:s,disabledTypes:o?[Xe.Canmore]:[]}),qt(),Yt(t);const a=p.useRef(!1);p.useEffect(()=>{a.current?Je():a.current=!0},[t]);const l=n&&(i?u.jsx(ts,{clientThreadId:t,onClose:Be,focusedObject:n},"canvas-sidebar"):u.jsx(ss,{clientThreadId:t,onClose:Be,focusedObject:n},"canvas-modal"));p.useEffect(()=>{if(n)return qe(d=>Kt(d,n)),()=>qe(null)},[n]);const c=l!=null;return p.useEffect(()=>(Ge.setActiveStageSidebar(c),()=>{c&&Ge.setActiveStageSidebar(!1)}),[c]),o?l:u.jsx(Ct,{children:l},t)},en=t=>{const e=p.useRef(null);return u.jsx(gt,{ref:e,onError:(s,r)=>{Je(),setTimeout(()=>{var n;(n=e.current)==null||n.resetErrorBoundary()}),jt.logError("Error boundary hit",s,{componentStack:r})},name:"canmore-focused-view",children:u.jsx(ns,Oe({},t))})};function os(t){const{rect:e}=t;return e}export{en as CanvasFocusedViewManager};
//# sourceMappingURL=bkoreaa3tygyxbms.js.map
