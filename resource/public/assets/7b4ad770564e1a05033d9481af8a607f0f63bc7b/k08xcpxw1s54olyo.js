const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/kw08ajijqinojrwh.js","assets/kfrdmkli83ureki3.js","assets/root-fi49nzd2.css","assets/ffrotvb922yxp30i.js","assets/nlj7ey81i8rm36n9.js","assets/fyw02vlaiv2vq6cj.js","assets/conversation-small-lq38g8zw.css"])))=>i.map(i=>d[i]);
var le=Object.defineProperty,ce=Object.defineProperties;var ue=Object.getOwnPropertyDescriptors;var H=Object.getOwnPropertySymbols;var me=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable;var Z=(e,t,n)=>t in e?le(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,E=(e,t)=>{for(var n in t||(t={}))me.call(t,n)&&Z(e,n,t[n]);if(H)for(var n of H(t))de.call(t,n)&&Z(e,n,t[n]);return e},R=(e,t)=>ce(e,ue(t));import{r as m,h as fe,j as a,_ as C,w as he}from"./kfrdmkli83ureki3.js";import{aF as O,u as X,eE as $,cs as J,d as V,jp as xe,e9 as B,mZ as ge,hZ as pe,aT as ve,a as we,db as be,az as A,aB as G,aA as T,O as _e,fb as Q,gX as U,_ as M,hI as Ie,cy as Y,V as D,gA as ye,dR as je,cg as ke,aN as Ee}from"./kw08ajijqinojrwh.js";import{dc as Re,df as Le,cx as F,lX as L,ct as Se,c7 as Ne,mA as Me}from"./fyw02vlaiv2vq6cj.js";import{g as Ce}from"./lazh7fd24t88wsap.js";import{g as Ae,u as Te,a as Pe,b as K}from"./ci7lhbgv3s1kfbx6.js";import{g as qe}from"./et0kjfzq519mr3zi.js";const ee=m.createContext({imageList:[],activeIndex:null,isInFocusMode$:O(!1),isZoomed$:O(!1)}),P=()=>m.useContext(ee);function z(){for(var e,t=0,n="",s=arguments.length;t<s;t++)(e=arguments[t])&&typeof e=="string"&&(n+=(n&&" ")+e);return n}const Oe="_lightbox_1ruyj_1",ze={lightbox:Oe},Ve=A(()=>C(()=>import("./kw08ajijqinojrwh.js").then(e=>e.yt),__vite__mapDeps([0,1,2])),{loading:e=>T(e)}),De=A(()=>C(()=>import("./ffrotvb922yxp30i.js"),__vite__mapDeps([3,1])),{loading:e=>T(e)}),Fe=A(()=>C(()=>import("./nlj7ey81i8rm36n9.js"),__vite__mapDeps([4,1])),{loading:e=>T(e)});function We({imageList:e,forceDarkMode:t=!1,initialIndex:n,isInFocusMode$:s,onClose:i,onScrollToEnd:c,children:d}){var W;const x=X(),p=fe(),g=m.useRef(null),_=Re(x),[u,b]=m.useState(n),j=$(),I=J(),[r]=m.useState(()=>{var o,l;return O(((l=(o=window.visualViewport)==null?void 0:o.scale)!=null?l:1)!==1)}),h=V(()=>r());m.useEffect(()=>{_.signalTransitionReady()},[_]),m.useEffect(()=>{if(h)return xe(()=>{r()||requestAnimationFrame(()=>{var l,f;(f=(l=g.current)==null?void 0:l.querySelector('[data-position="'.concat(u,'"]')))==null||f.scrollIntoView({behavior:"smooth",inline:"center",block:"center"})})})},[h,u,r]),m.useEffect(()=>{var l;const o=()=>{var f,y;return r.set(((y=(f=window.visualViewport)==null?void 0:f.scale)!=null?y:1)!==1)};return(l=window.visualViewport)==null||l.addEventListener("resize",o),()=>{var f;return(f=window.visualViewport)==null?void 0:f.removeEventListener("resize",o)}},[r]),B(()=>{var o,l;(l=(o=g.current)==null?void 0:o.querySelector('[data-position="'.concat(n,'"]')))==null||l.scrollIntoView({behavior:"instant",inline:"center",block:"center"})},[n]);const v=m.useCallback(o=>{b(o),requestAnimationFrame(()=>{var f;const l=(f=e[o])==null?void 0:f.title;l&&ge.setLiveRegionPolite(l)}),o===e.length-1&&(c==null||c())},[e,c]);B(()=>{const o=g.current;if(!o)return;const l=new IntersectionObserver(f=>{const y=f.reduce((N,q)=>q.isIntersecting&&(!N||q.intersectionRatio>N.intersectionRatio)?q:N,null);y&&y.target instanceof HTMLElement&&v(pe(y.target.dataset.position))},{root:o,rootMargin:"0px -50% 0px -50%",threshold:0});for(const f of o.querySelectorAll(":scope > li"))l.observe(f);return()=>{l.disconnect()}},[e,v]);const w=e.length-1,k=m.useCallback(o=>{const l=Math.min(Math.max(u+o,0),w);v(l),requestAnimationFrame(()=>{var f,y;(y=(f=g.current)==null?void 0:f.querySelector('[data-position="'.concat(l,'"]')))==null||y.scrollIntoView({behavior:j?"instant":"smooth",block:"center",inline:"center"})})},[u,w,j,v]);m.useEffect(()=>{requestAnimationFrame(()=>{const o=document.querySelector("[data-lightbox-close-button]");o instanceof HTMLElement&&o.focus()})},[]),m.useEffect(()=>{const o=l=>{if(s!=null&&s()){l.key==="Escape"&&s.set(!1);return}l.key==="ArrowLeft"?u>0&&(l.preventDefault(),k(-1)):l.key==="ArrowRight"?u<w&&(l.preventDefault(),k(1)):l.key==="Escape"&&i(u)};return window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)}},[u,w,k,i,s]),m.useEffect(()=>{ve(we(),"chatgpt_web_image_library_lightbox_image_viewed")},[u]);const{footer:ae,items:oe,title:re,headerActions:ie}=qe(d,{title:te,items:ne,footer:se,headerActions:He});return a.jsx(ee.Provider,{value:{imageList:e,activeIndex:u,isInFocusMode$:s,isZoomed$:r},children:a.jsxs(be.Root,{testId:"modal-image-gen-lightbox",isOpen:!0,onClose:()=>i(u),shouldIgnoreClickOutside:I,className:z(I||t?"dark bg-black":"bg-token-bg-primary","flex h-dvh max-h-full w-dvw max-w-full flex-col place-content-center",ze.lightbox),children:[a.jsxs("section",{className:"grid grid-cols-[auto_1fr_auto] items-start px-1 pt-1 [view-transition-name:var(--vt-page-title)] max-md:absolute max-md:start-0 max-md:end-0 max-md:top-0 max-md:items-center md:grid-cols-[1fr_auto_1fr] md:px-2 md:pt-2",children:[a.jsx("div",{className:"w-fit",children:a.jsx(Le,{icon:Ve,"data-lightbox-close-button":!0,onClick:()=>i(u),"aria-label":p.formatMessage({id:"f08aLO",defaultMessage:"Close"})})}),!h&&re,(W=!h&&ie)!=null?W:a.jsx("div",{className:"w-8 shrink-0 basis-auto"})]}),a.jsxs("div",{className:"no-scrollbar flex h-full snap-y snap-mandatory flex-col overflow-y-scroll scroll-smooth",onScroll:o=>{o.target.scrollTop===0&&!r()&&i(u)},children:[a.jsx("div",{className:"h-[15dvh] flex-shrink-0"}),a.jsxs("ol",{ref:g,className:z("flex max-h-full min-h-0 flex-shrink-0 grow basis-full gap-[min(10dvw,_200px)] overflow-x-auto scroll-smooth [anchor-name:--carousel] [view-transition-name:var(--vt-image-carousel)] max-md:gap-0",I&&"no-scrollbar",!h&&"snap-x snap-mandatory snap-center snap-always py-15"),onClick:o=>{(o.target instanceof HTMLOListElement||o.target instanceof HTMLLIElement)&&(o.preventDefault(),i(u))},children:[a.jsx("li",{className:"w-[50vw] flex-shrink-0"}),oe,a.jsx("li",{className:"w-[50vw] flex-shrink-0"})]}),a.jsx("div",{className:"h-[15dvh] flex-shrink-0"})]}),!h&&a.jsxs("div",{className:"pointer-events-none absolute inset-5 z-20 flex items-center justify-between [view-transition-name:var(--vt-scroll-buttons)] max-md:hidden",children:[a.jsx(G,{className:"pointer-events-auto aspect-square",disabled:u===0,color:"secondary",icon:Fe,onClick:()=>k(-1),"aria-label":p.formatMessage({id:"iQsFWe",defaultMessage:"Previous image"})}),a.jsx(G,{className:"pointer-events-auto aspect-square",color:"secondary",disabled:u===w,icon:De,onClick:()=>k(1),"aria-label":p.formatMessage({id:"W7vnD4",defaultMessage:"Next image"})})]}),!h&&ae]})})}function te({children:e}){const{imageList:t,activeIndex:n}=P();if(n==null)return null;const s=t[n];return s?e(s):null}function ne({children:e}){const{imageList:t,isZoomed$:n,activeIndex:s}=P(),i=J(),c=$(),d=V(()=>n==null?void 0:n());return t.map((x,p)=>{var I;const{width:g,height:_}=x,u=g!=null&&_!=null&&g===_;let b=null;s!=null&&(p===s?b="current":p+1===s?b="before":p-1===s&&(b="after"));const j=!i&&b!=="current";return a.jsx("li",{role:j?"button":void 0,className:z("flex max-h-full max-w-[70dvw] flex-shrink-0 snap-center items-center justify-center transition-opacity duration-0 motion-safe:duration-300 max-md:w-[100dvw] max-md:max-w-[100dvw] max-md:snap-always max-md:opacity-100",u&&"aspect-square",b==="current"||d?"opacity-100":"opacity-40"),"data-position":p,onClick:j?({currentTarget:r})=>r.scrollIntoView({behavior:c?"instant":"smooth",block:"center",inline:"center"}):void 0,children:e(R(E({},x),{index:p,position:b}))},(I=x.id)!=null?I:x.url)})}function se({children:e}){const{imageList:t,activeIndex:n}=P();if(n==null)return null;const s=t[n];return s?a.jsx("footer",{className:"absolute bottom-0 z-10 flex w-full items-center justify-center px-5 pb-3 [view-transition-name:var(--vt-page-footer)] max-md:pb-6",children:e(s)}):null}function He({children:e}){const t=[];return m.Children.forEach(e,n=>{m.isValidElement(n)&&n.type===Ze&&t.push(n)}),a.jsx("div",{className:"flex items-center justify-end gap-2",children:t.map((n,s)=>a.jsx(m.Fragment,{children:n},s))})}function Ze({children:e}){const{imageList:t,activeIndex:n}=P();return n==null||t[n]==null?null:e(t[n])}const Be=A(()=>C(()=>import("./fyw02vlaiv2vq6cj.js").then(e=>e.zK),__vite__mapDeps([5,1,0,2,6])),{loading:e=>T(e)});function Ge(e,t,n=!1){const s=D.getTurnContentReferences(e,t),i=Me(s),c=Qe(e,t),d=i.concat(c);if(n){const x=Ue(e,t);d.push(...x)}return ye(d,"content_url")}function Qe(e,t){const n=D.getConversationTurnAtIndex(e,t).messages;return n?ke(n.flatMap(s=>{var i,c;return(c=(i=s.metadata)==null?void 0:i.image_results)!=null?c:[]})).map(s=>R(E({},s),{thumbnail_url:s.thumbnail_url.replace(/^http:\/\//,"https://"),content_url:s.content_url.replace(/^http:\/\//,"https://")})):[]}function Ue(e,t){return D.getSuperWidgetMessages(e,t).flatMap(s=>s.content.widgets.images)}function Ke(e,t,n,s){const{product:i}=Ce({thread:e,messageId:t,contentReferenceStartIndex:n,productIndex:s});return!i||!i.image_urls?[]:i.image_urls.map(c=>({url:c,content_url:c,thumbnail_url:c,title:i.title,content_size:{width:0,height:0},thumbnail_size:{width:0,height:0}}))}function rt({clientThreadId:e}){const t=X(),n=V(()=>Ee(t)),s=F.useCurrentImage();if(!s)return null;const{image:i,source:c,analyticsMetadata:d,contentReferenceStartIndex:x,productIndex:p}=s;if(c==null||e==null||(d==null?void 0:d.turnIndex)==null)return a.jsx(S,{image:i,analyticsMetadata:{}});const g=_e(e),_=(function(){switch(c){case L.ProductDetails:return Ke(g,d.messageId,x,p);case L.SuperWidget:case L.ImageGroup:return s.imageResults;default:return Ge(g,d.turnIndex,n)}})();return a.jsx(S,{image:i,group:_,analyticsMetadata:d})}function it(){const e=F.useCurrentImage();if(!e)return null;const{image:t,source:n}=e;if(n==null)return a.jsx(S,{image:t,analyticsMetadata:{}});switch(n){case L.ImagesTab:return a.jsx(Xe,{image:t});case L.Turn:return a.jsx($e,{image:t});default:return null}}function Xe({image:e}){const{imageResults:t}=Pe();return a.jsx(S,{image:e,group:t,analyticsMetadata:{}})}function $e({image:e}){const{imageResults:t}=Te();return a.jsx(S,{image:e,group:t,analyticsMetadata:{}})}function S({image:e,group:t,analyticsMetadata:n}){var j,I;const s=m.useRef(null),i=F.useStore();m.useEffect(()=>{var h,v;(v=(h=window==null?void 0:window.history)==null?void 0:h.state)!=null&&v.imageModalOpen||window.history.pushState({imageModalOpen:!0},"",window.location.href);const r=()=>{var w,k;(k=(w=window==null?void 0:window.history)==null?void 0:w.state)!=null&&k.imageModalOpen||i.setCurrentImage(void 0)};return window.addEventListener("popstate",r),()=>window.removeEventListener("popstate",r)},[i]);const c=e.content_url.replace(/^http:\/\//,"https://"),d=(j=t==null?void 0:t.findIndex(r=>Q(e,r)))!=null?j:0,x=(I=t==null?void 0:t.length)!=null?I:1,p=d!=null&&x>1,g=R(E({},U(n)),{url:e.url,link_type:"text",section:"image",section_location:"response",section_index:(d+1).toString()});m.useEffect(()=>{s.current!==e.url&&(s.current=e.url,M.logEventWithStatsig("Search Content Reference Shown","search_content_reference_shown",R(E({},U(n)),{type:"full_screen_image",url:e.url,image_url:c})),M.logEvent("link_action",R(E({},g),{action:"show"})))},[c]);const _=()=>{window.history.go(-1),i.setCurrentImage(void 0)},u=t!=null?t:[];he({queries:u.map(r=>Ae(r.thumbnail_url,"ImageResultModal"))});const b=m.useMemo(()=>t!=null?t:[e],[t,e]);return a.jsxs(We,{forceDarkMode:!0,imageList:b,initialIndex:d,onClose:_,children:[p&&a.jsx(te,{children:r=>{var h;return a.jsxs("div",{className:"text-token-text-tertiary -mt-0.25 shrink-0 px-4 md:mt-0 md:py-2",children:[((h=t==null?void 0:t.findIndex(v=>Q(r,v)))!=null?h:0)+1," /"," ",x]})}}),a.jsx(ne,{children:r=>a.jsx(Je,{image:r,isNewLightbox:!0})}),a.jsx(se,{children:r=>{var v,w;const h=(v=r.show_url)!=null?v:!0;return a.jsx("div",{className:"flex w-full justify-start",children:a.jsx("div",{className:"w-fit rounded-xl backdrop-blur-xl",children:a.jsx(Ie,{onClick:()=>{M.logEvent("link_action",R(E({},g),{action:"click"}))},onMouseEnter:()=>{M.logEvent("link_action",R(E({},g),{action:"hover"}))},href:r.is_proxied_image?r.content_url:r.url,className:Y("flex w-fit shrink-0 items-center gap-8 px-4 py-2 text-sm hover:opacity-70",h?"min-h-20":"min-h-16"),children:a.jsxs("div",{className:"flex grow flex-col gap-0.5 overflow-hidden pe-2",children:[h&&a.jsxs("div",{className:"text-token-text-tertiary flex items-center gap-2 truncate",children:[a.jsx(Ne,{url:r.content_url,className:"rounded-sm",size:16}),(w=r.attribution)!=null?w:Se(r.url)]}),a.jsx("div",{className:"truncate font-semibold text-white",children:r.title})]})})})})}})]})}function Je({image:e,isNewLightbox:t=!1}){const n=e.content_url.replace(/^http:\/\//,"https://"),s=e.thumbnail_url.replace(/^http:\/\//,"https://"),i=e.content_size.width/e.content_size.height,{isError:c}=K(n,"ModalImage_main"),{isError:d}=K(s,"ModalImage_thumbnail"),x=e.is_proxied_image?e.url:c?s:n;return!d||!c||e.is_proxied_image?a.jsx(je.img,{src:x,alt:e.title,style:{backgroundImage:s?"url(".concat(s,")"):void 0,backgroundSize:"contain",aspectRatio:i,backgroundPosition:"center",backgroundRepeat:"no-repeat"},initial:{opacity:0},animate:{opacity:1},className:Y(t?"h-full max-w-full object-contain":"h-full max-w-[100vw] object-contain sm:max-w-[calc(100vw-10rem)]")}):a.jsx("div",{className:"flex h-full grow items-center justify-center",children:a.jsx("div",{className:"flex h-96 w-96 items-center justify-center bg-white/10",children:a.jsx(Be,{className:"text-token-text-tertiary h-12 w-12"})})})}export{rt as ImageLightbox,it as ImageLightboxSearchGPT};
//# sourceMappingURL=k08xcpxw1s54olyo.js.map
