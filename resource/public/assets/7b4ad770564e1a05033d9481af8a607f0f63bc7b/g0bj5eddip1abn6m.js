import{r as f,j as l,h as M}from"./kfrdmkli83ureki3.js";import{eZ as x,$ as d,a0 as T,u as C,J as _,aa as E}from"./kw08ajijqinojrwh.js";import{CoTChunks as k}from"./omgheurp6qzf2dpn.js";import{ce as h}from"./fyw02vlaiv2vq6cj.js";import"./ke280zfvfnrfnfvu.js";import"./kzowh6fnaz3z8ldi.js";import"./f1g778pkk2fhpy9x.js";import"./c1jda78nitgsidb4.js";import"./meym1wib9md0wcei.js";import"./b9tsn3f51rdwvzaj.js";import"./oafyrulh7bq2qerb.js";import"./dd8hh2tmra1psngf.js";import"./b4dmcdh59zl3olaw.js";import"./ctejkiukffhtkd40.js";import"./m148ha1ozi8vz2cs.js";import"./cjv4tm2buxt5byw3.js";import"./pbl95wx6493wq92j.js";import"./fxythiulbb2q3qno.js";import"./c5rze1h9e62gir74.js";import"./fey3pq4cxpkljcdg.js";const y=(o,t)=>{if(t<=1)return o.formatMessage({id:"ZxhUq1",defaultMessage:"a second"});if(t<3)return o.formatMessage({id:"4GD7tD",defaultMessage:"a couple of seconds"});if(t<4)return o.formatMessage({id:"jx5V1u",defaultMessage:"a few seconds"});if(t>=60){const n=Math.floor(t/60),s=t%60;return"".concat(n,"m ").concat(s,"s")}return o.formatMessage({id:"p4/pTg",defaultMessage:"{seconds} seconds"},{seconds:t})},R=o=>{var n,s;let t=0;for(const e of o)t+=(s=(n=e.metadata)==null?void 0:n.finished_duration_sec)!=null?s:0;return t},I=(o,t,n)=>{var s,e,a;return t.length>1?o.formatMessage({id:"sdDgmZ",defaultMessage:"Thought for {timing}"},{timing:y(o,n)}):(a=(e=(s=x(t))==null?void 0:s.metadata)==null?void 0:e.finished_text)!=null?a:""},S=(o,t,n=!1)=>{var m;const s=[];let e={type:h.Thought,thought:{summary:"",content:""}};const a=()=>{e.thought.content.trim()&&(s.push(e),e={type:h.Thought,thought:{summary:e.thought.summary,content:""}})},u=o.split(/( {2}\n)|(\n\n)/).filter(i=>i!=null&&i.trim());if(!n&&u.length<2)return s;let c=!1;for(let i=0;i<u.length;i++){const r=u[i].trim();if(r.toLowerCase()==="none"){d.count(T.COT_SUMMARIZER,"num_none_chunks");continue}const p=r.match(/^\*\*(.*)\*\*$/);if(p)a(),e.thought.summary=(m=p[1])!=null?m:"";else if(r){if(r.startsWith("```")){if(c){e.thought.content+=e.thought.content?"\n".concat(r):r,a(),c=!1;continue}a(),c=!0}e.thought.content.trim()&&!r.startsWith("\\[")&&!r.startsWith("\\(")&&!c&&a(),e.thought.content+=e.thought.content?"\n".concat(r):r}}return e!=null&&e.thought.content.trim()&&s.push(e),n&&t&&s.push({type:h.Recap,content:t}),s},N=(o,t,n)=>{const s=!n,e=f.useMemo(()=>S(o,t,s),[o,t,s]);return f.useEffect(()=>{s&&d.hist(T.COT_SUMMARIZER,"num_cot_chunks",void 0,e.length)},[s]),e},O=({conversation:o,isStreaming:t,finishedText:n,summaryText:s,isFinalAssistantTurn:e,turnIndex:a})=>{const u=N(s,n,t),[c,m]=f.useState(!1);return l.jsx(k,{conversation:o,isStreaming:t,isFinalAssistantTurn:e,chunks:u,isExpanded:c,setIsExpanded:m,turnIndex:a})},$=8,j="\n\n",X=({conversation:o,messages:t,isStreaming:n,isFinalAssistantTurn:s,turnIndex:e})=>{const a=M(),u=C(),c=_(u,"1214379119"),m=R(t);let i="";return t.forEach(g=>{const r=E(g);i+=i?j+r:r}),c&&!n&&!i&&m<$?null:l.jsx(O,{conversation:o,finishedText:I(a,t,m),summaryText:i,isStreaming:n,isFinalAssistantTurn:s,turnIndex:e})};export{O as LegacyCoT,X as LegacyCoTMessage};
//# sourceMappingURL=g0bj5eddip1abn6m.js.map
