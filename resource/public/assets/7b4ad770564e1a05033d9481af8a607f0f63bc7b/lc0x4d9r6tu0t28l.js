const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/fyw02vlaiv2vq6cj.js","assets/kfrdmkli83ureki3.js","assets/kw08ajijqinojrwh.js","assets/root-fi49nzd2.css","assets/conversation-small-lq38g8zw.css","assets/chom7pns9qj8dxe8.js","assets/g4luqq3g92oxbbim.js","assets/o2kvjcphiwxgrxo0.js","assets/cus6e9b5l060ctey.js"])))=>i.map(i=>d[i]);
var Z=Object.defineProperty,J=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var O=(e,s,a)=>s in e?Z(e,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[s]=a,_=(e,s)=>{for(var a in s||(s={}))L.call(s,a)&&O(e,a,s[a]);if(I)for(var a of I(s))F.call(s,a)&&O(e,a,s[a]);return e},b=(e,s)=>J(e,X(s));var N=(e,s)=>{var a={};for(var r in e)L.call(e,r)&&s.indexOf(r)<0&&(a[r]=e[r]);if(e!=null&&I)for(var r of I(e))s.indexOf(r)<0&&F.call(e,r)&&(a[r]=e[r]);return a};import{h as C,j as t,r as o,_ as x,M as P}from"./kfrdmkli83ureki3.js";import{p9 as ee,cd as B,jt as te,c7 as se,pa as ae,pb as ne,pc as q,aH as U,Q as re,pd as ie,jR as oe,pe as le,cr as ce,pf as de}from"./fyw02vlaiv2vq6cj.js";import{C as ue,a as me,S as xe}from"./j2fxxw8fjw5358xk.js";import{cy as w,d_ as $,dR as W,az as f,kQ as R,aA as p,cq as fe,u as G,sR as D,ja as pe,M as he,V as ge,f1 as je,f5 as ye,p as _e,gl as V,f2 as be,l as Ne}from"./kw08ajijqinojrwh.js";import"./c1jda78nitgsidb4.js";import"./meym1wib9md0wcei.js";import"./b9tsn3f51rdwvzaj.js";import"./kzowh6fnaz3z8ldi.js";import"./f1g778pkk2fhpy9x.js";import"./oafyrulh7bq2qerb.js";import"./ctejkiukffhtkd40.js";import"./mq60ebbg8rx7y6z4.js";import"./koea7l5qbjcndn3s.js";import"./fbnp4n11buhgth4v.js";function Me({label:e,tab:s,activeTab:a,setActiveTab:r,caterpillarHeaderRef:n}){const c=o.useCallback(()=>{r(s),n.current&&n.current.scrollIntoView({behavior:"instant",block:"center"})},[r,s,n]),l=a===s;return t.jsx("button",{onClick:c,className:w("btn text-token-text-primary min-h-[36px]! min-w-[100px] rounded-full px-2 py-1 select-none",l?"bg-token-main-surface-primary shadow-sm":"bg-token-main-surface-tertiary!"),children:e})}function Se({activeTab:e,setActiveTab:s,sourcesCount:a,showAuxTab:r=!1,caterpillarHeaderRef:n}){const c=C(),l=[{tab:"activity",label:c.formatMessage({id:"9lnBJU",defaultMessage:"Activity"})},{tab:"sources",label:a>1?c.formatMessage({id:"/Ucokx",defaultMessage:"{sourcesCount} Sources"},{sourcesCount:a}):a===1?c.formatMessage({id:"CCF0z+",defaultMessage:"1 Source"}):c.formatMessage({id:"twjHy3",defaultMessage:"Sources"})}];return r&&l.unshift({tab:"report",label:c.formatMessage({id:"zF7Fu5",defaultMessage:"Report"})}),t.jsx("div",{className:w("border-token-main-surface-tertiary bg-token-main-surface-tertiary flex items-center rounded-full border-[4px] transition-all"),children:l.map(({tab:u,label:d})=>t.jsx(Me,{activeTab:e,tab:u,setActiveTab:s,label:d,caterpillarHeaderRef:n},u))})}const E=({children:e,icon:s,fillIcon:a,className:r})=>t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx("div",{className:w("mt-[3px] inline-flex h-5 w-5 shrink-0 items-center justify-center gap-2.5 rounded-[30px]",a&&"border border-black/10 bg-white",r),children:s}),e]}),we=f(()=>x(()=>import("./fyw02vlaiv2vq6cj.js").then(e=>e.zu),__vite__mapDeps([0,1,2,3,4])),{loading:e=>p(e)}),ve=f(()=>x(()=>import("./chom7pns9qj8dxe8.js"),__vite__mapDeps([5,1])),{loading:e=>p(e)}),Ie=f(()=>x(()=>import("./fyw02vlaiv2vq6cj.js").then(e=>e.zz),__vite__mapDeps([0,1,2,3,4])),{loading:e=>p(e)}),Ee=f(()=>x(()=>import("./g4luqq3g92oxbbim.js"),__vite__mapDeps([6,1])),{loading:e=>p(e)});function M({icon:e,message:s,iconClassName:a}){return t.jsx("div",{className:"loading-shimmer-pure-text flex h-8 gap-1 overflow-hidden",children:t.jsx(E,{fillIcon:!1,icon:e,className:a,children:t.jsx("div",{className:"mt-[.5px] flex h-10",children:s})})})}const ke=({finalRow:e})=>{var r;const s=C(),a=e.type==="fileOpen"?(r=ee[e.iconType])!=null?r:Ee:null;return t.jsx($,{children:t.jsx(W.div,{layout:!0,transition:{type:"spring",stiffness:300,damping:30},className:"flex flex-col items-start justify-start gap-4",children:e.type==="search"?t.jsx(M,{icon:t.jsx(we,{className:"text-token-text-primary relative h-5 w-5 opacity-50"}),message:s.formatMessage({id:"f9wsyE",defaultMessage:"Searching…"})}):e.type==="websiteOpen"?t.jsx(M,{icon:t.jsx(Ie,{className:"inline-flex h-5 w-5 items-center justify-center opacity-50"}),message:s.formatMessage({id:"8L6BBp",defaultMessage:"Reading…"})}):e.type==="fileOpen"?t.jsx(M,{icon:t.jsx(a,{className:"inline-flex h-5 w-5 items-center justify-center opacity-50"}),message:s.formatMessage({id:"h5M4/O",defaultMessage:"Reading file…"})}):e.type==="pythonAnalysis"?t.jsx(M,{icon:t.jsx(ve,{className:"inline-flex h-5 w-5 items-center justify-center opacity-50"}),message:s.formatMessage({id:"jZ7gNw",defaultMessage:"Analyzing…"})}):t.jsx(M,{icon:t.jsx(R,{className:"inline-flex h-5 w-5 items-center justify-center opacity-50"}),message:s.formatMessage({id:"bSPYmC",defaultMessage:"Thinking…"})})})})},Ae=f(()=>x(()=>import("./chom7pns9qj8dxe8.js"),__vite__mapDeps([5,1])),{loading:e=>p(e)}),Ce=({children:e})=>t.jsxs("div",{className:"flex items-start gap-2 text-start text-wrap",children:[t.jsx("div",{className:"mt-[1px] inline-flex h-5 w-5 shrink-0 items-center justify-end gap-2.5 pt-[3px]",children:t.jsx(Ae,{className:"text-token-text-primary relative h-5 w-5"})}),e]}),Re=({row:e})=>t.jsx(Ce,{children:t.jsx("div",{className:"text-token-text-primary flex text-base",children:e.analysisSummary})}),Te=f(()=>x(()=>import("./fyw02vlaiv2vq6cj.js").then(e=>e.zu),__vite__mapDeps([0,1,2,3,4])),{loading:e=>p(e)}),Oe=({children:e,showIcon:s})=>t.jsxs("div",{className:"flex items-start gap-2 text-start text-wrap",children:[t.jsx("div",{className:"mt-[1px] inline-flex h-5 w-5 shrink-0 items-center justify-end gap-2.5 pt-[3px]",children:s&&t.jsx(Te,{className:"text-token-text-primary relative h-5 w-5"})}),e]}),Le=({row:e,showIcon:s})=>{const a=e.query;return a?t.jsx(Oe,{showIcon:s,children:t.jsx("div",{className:"text-token-text-primary flex text-base",children:a})}):null};function Fe({children:e,showIcon:s=!0}){return t.jsx(E,{fillIcon:!1,icon:s?t.jsx(R,{className:"text-token-text-primary inline-flex h-5 w-5 items-center justify-center"}):null,children:e})}const Pe={strong:e=>{const n=e,{node:s,children:a}=n,r=N(n,["node","children"]);return t.jsx("strong",b(_({},r),{className:w(r.className,"text-token-text-primary font-semibold"),children:a}))},p:e=>{const n=e,{node:s,children:a}=n,r=N(n,["node","children"]);return t.jsx("p",b(_({},r),{className:w(r.className,"mb-0! text-base"),children:a}))}};function De(e){return e.replace(/^#+\s*.*$/gm,"").replace(/^\*\*.*\*\*$/gm,"").trim()}function Ve({row:e,showIcon:s=!0}){const a=e.summary;if(!a)return null;const r=De(a);return r.length===0?null:t.jsx(Fe,{showIcon:s,children:t.jsx(B,{componentOverrides:Pe,className:"w-0! flex-1 leading-6",children:r})})}const ze=f(()=>x(()=>import("./o2kvjcphiwxgrxo0.js"),__vite__mapDeps([7,1])),{loading:e=>p(e)});function Be(e){try{const{hostname:s}=new URL(e);return s}catch(s){return null}}const qe={p:e=>{const n=e,{node:s,children:a}=n,r=N(n,["node","children"]);return t.jsx("p",b(_({},r),{className:"text-token-text-primary text-start text-base",children:a}))},a:e=>{const n=e,{node:s,children:a}=n,r=N(n,["node","children"]);return t.jsx("a",b(_({},r),{className:"text-blue! text-base leading-6",children:a}))}},Ue=({website:e})=>{const s=Be(e.url);return s?t.jsxs("div",{className:"flex items-start justify-start gap-2",children:[t.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",children:t.jsx(fe,{label:s,className:"bg-token-main-surface-primary mt-[3px] flex h-5 w-5 shrink-0 cursor-pointer items-center justify-center",children:t.jsx(te,{url:e.url,size:"xsmall",className:"h-5 w-5",fallback:t.jsx(se,{url:e.url,className:"h-5 w-5 rounded-2xl border-[.5px] border-black/25",fallback:t.jsx(ze,{className:"icon-sm text-token-text-quaternary"})})})})}),t.jsx("div",{className:"text-token-text-primary mt-[1px] flex flex-col text-base",children:t.jsx(B,{componentOverrides:qe,children:e.rowText})})]}):null};function S({children:e}){return t.jsx(W.div,{className:"w-full",initial:{opacity:0},animate:{opacity:1},transition:{duration:1},children:e})}const $e=({previousRow:e,currentRow:s})=>t.jsx("div",{className:"flex flex-col items-start justify-start gap-4",children:s.type==="search"?t.jsx(S,{children:t.jsx(Le,{row:s,showIcon:!e||e.type!=="search"})},"search_".concat(s.id)):s.type==="summary"?t.jsx(S,{children:t.jsx(Ve,{row:s,showIcon:!e||e.type!=="summary"})},"summary_".concat(s.id)):s.type==="websiteOpen"?t.jsx(S,{children:t.jsx(Ue,{website:s})},"website_".concat(s.id)):s.type==="fileOpen"?t.jsx(S,{children:t.jsx(ae,{row:s})},"file_".concat(s.id)):s.type==="pythonAnalysis"?t.jsx(S,{children:t.jsx(Re,{row:s})},"python_".concat(s.id)):null}),We=f(()=>x(()=>import("./cus6e9b5l060ctey.js"),__vite__mapDeps([8,1])),{loading:e=>p(e)}),Ge=120,He=1e3*60*2;function z(e){e==null||e.scrollIntoView({block:"center",behavior:"smooth"})}function Qe({caterpillarStatusMessageTexts:e}){return t.jsx("div",{className:"p-4",children:t.jsx(U,{type:"error",title:e.failureMessage,content:e.failureBannerContentMessage})})}function Ye({caterpillarStatusMessageTexts:e}){return t.jsx("div",{className:"p-4",children:t.jsx(U,{title:e.cancelledMessage,content:""})})}function Ke({sourcesCount:e,taskInfo:s}){const a=he(s.originalConversationId,n=>{var c,l;return(l=(c=ge.findNode(n,u=>{var d,i;return((d=u.message.metadata)==null?void 0:d.b1de6e2_s)===!0&&((i=u.message.metadata)==null?void 0:i.async_task_id)===s.taskId}))==null?void 0:c.message.metadata)==null?void 0:l.async_task_status_messages}),r=o.useMemo(()=>{var n;return a!=null&&a.completed_no_time?t.jsxs(t.Fragment,{children:[(n=a==null?void 0:a.completed_with_time)!=null?n:a==null?void 0:a.completed_no_time,t.jsx(P,{id:"zxfmo/",defaultMessage:" · {sourcesCount} sources",values:{sourcesCount:e}})]}):t.jsx(P,{id:"YG7a0T",defaultMessage:"Completed · {sourcesCount} sources",values:{sourcesCount:e}})},[e,a]);return!s.updatedAt&&!(a!=null&&a.completed)?null:t.jsx(E,{icon:t.jsx(We,{className:"text-token-text-secondary"}),fillIcon:!1,children:t.jsx("div",{className:"text-token-text-tertiary",children:r})})}function Ze({taskInfo:e,caterpillarStatusMessageTexts:s,sourcesCount:a,caterpillarHeaderRef:r}){const n=G(),[c,l]=o.useState(!1),u=o.useRef(!1),d=o.useRef(null),i=o.useMemo(()=>{var m;return u.current=!!d.current&&ne(d.current,Ge),(m=e.rows)!=null?m:[]},[e.rows]);o.useEffect(()=>{if(i.length===0){const m=new Date(e.createdAt).getTime(),g=Date.now()-m,v=He-g;if(v>0){const A=setTimeout(()=>{l(!0)},v);return()=>clearTimeout(A)}else l(!0)}else l(!1)},[i,e.createdAt]),o.useEffect(()=>{u.current&&z(d.current)},[i]),o.useEffect(()=>{D(e)||setTimeout(()=>{d.current&&z(d.current)},100)},[]);const h=D(e)||pe(e),y=q(n),k=o.useMemo(()=>i.length&&!h&&!y?i.slice(0,i.length-1):i,[i,h,y]);return t.jsxs("div",{className:"flex flex-col",children:[t.jsx("div",{ref:r},"task-header"),t.jsxs("div",{className:"flex w-full flex-col gap-4",children:[t.jsx("div",{className:"text-base font-medium",children:e.title}),i.length?t.jsxs($,{initial:!1,children:[k.map((m,g)=>t.jsx($e,{previousRow:g>0?i[g-1]:null,currentRow:m},m.id)),!h&&t.jsx(ke,{finalRow:i[i.length-1]})]}):c?t.jsx(E,{fillIcon:!1,icon:t.jsx(R,{className:"text-token-text-primary inline-flex h-5 w-5 items-center justify-center"}),children:s.waitingInQueueMessage}):t.jsx(ue,{}),e.status==="failed"?t.jsx(Qe,{caterpillarStatusMessageTexts:s}):e.status==="cancelled"?t.jsx(Ye,{caterpillarStatusMessageTexts:s}):e.status==="completed"?t.jsx(Ke,{caterpillarStatusMessageTexts:s,taskInfo:e,sourcesCount:a}):null]}),t.jsx("div",{ref:d},"task-footer")]})}function xt({taskId:e,setWidth:s=void 0,initialTab:a}){const r=G(),n=je(j=>ye.getTask(e,j)),{closeThreadSidebar:c}=re(),[l,u]=o.useState(a),d=ie(),i=o.useRef(null),h=!1;o.useEffect(()=>{u(a)},[a]),o.useEffect(()=>{},[n==null?void 0:n.taskId,n==null?void 0:n.status,h]),o.useEffect(()=>{},[n==null?void 0:n.taskId,n==null?void 0:n.status,l]),o.useEffect(()=>{},[s,n,h]);const y=C(),k=_e(),m=q(r),g=oe({taskId:n==null?void 0:n.taskId,intl:y,toaster:k}),v=()=>g.mutate(),A=()=>{n&&Ne(n.originalConversationId,j=>{j.steeringAsyncTaskId=n.taskId})},{uniqueSources:H,totalSources:T}=o.useMemo(()=>{if(!(n!=null&&n.rows))return{uniqueSources:[],totalSources:0};const j=le(n.rows),Q=j.reduce((Y,K)=>Y+K.count,0);return{uniqueSources:j,totalSources:Q}},[n==null?void 0:n.rows]);return t.jsx(ce,{ariaLabel:y.formatMessage({id:"region.sidebar.caterpillar",defaultMessage:"Tasks"}),handleClose:c,trailing:n&&m&&V(n)&&t.jsx(xe,{onAddContext:A,onStopTask:v,taskIsFinalizing:n.status===be.FINALIZING}),leading:t.jsx("div",{className:"flex w-full justify-center",children:t.jsx(Se,{activeTab:l,setActiveTab:u,showAuxTab:h,sourcesCount:T,caterpillarHeaderRef:i})}),children:n&&t.jsxs(me,{children:[!1,l==="activity"&&t.jsx(Ze,{taskInfo:n,caterpillarStatusMessageTexts:d,sourcesCount:T,caterpillarHeaderRef:i}),l==="sources"&&t.jsx(de,{taskIsPending:V(n),finalMessage:n.finalMessage,sources:H,caterpillarHeaderRef:i})]})})}export{xt as CaterpillarSidebar};
//# sourceMappingURL=lc0x4d9r6tu0t28l.js.map
