const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/l3z5gz1257zwquc2.js","assets/kfrdmkli83ureki3.js","assets/ezd0hym0jr36348y.js","assets/i2fce51g7exmjyb6.js","assets/dch45l9yrtbjo93p.js","assets/lur401x4nz6oqotk.js","assets/m3hcuyb0hywkyjmr.js","assets/fyw02vlaiv2vq6cj.js","assets/kw08ajijqinojrwh.js","assets/root-fi49nzd2.css","assets/conversation-small-lq38g8zw.css","assets/dxjaf6qdyfvp7ro9.js","assets/iyn42bfr1ydmech0.js","assets/kspsmo2l8jg7uqdj.js","assets/bonby2i4xf93dev1.js"])))=>i.map(i=>d[i]);
var tt=Object.freeze,ot=Object.defineProperty,Gt=Object.defineProperties;var It=Object.getOwnPropertyDescriptors;var st=Object.getOwnPropertySymbols;var Lt=Object.prototype.hasOwnProperty,Pt=Object.prototype.propertyIsEnumerable;var rt=(t,s,r)=>s in t?ot(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r,T=(t,s)=>{for(var r in s||(s={}))Lt.call(s,r)&&rt(t,r,s[r]);if(st)for(var r of st(s))Pt.call(s,r)&&rt(t,r,s[r]);return t},ae=(t,s)=>Gt(t,It(s));var Ee=(t,s)=>tt(ot(t,"raw",{value:tt(s||t.slice())}));import{g as Ft,h as ie,u as je,i as ve,e as _e,r as m,j as e,M as i,_ as F,d as Mt,b as pt,c as zt,l as Ut}from"./kfrdmkli83ureki3.js";import{e0 as qt,e1 as Bt,tw as Vt,uX as Wt,uY as Qt,uZ as Kt,ha as $t,hH as Yt,jv as Xt,p as we,u as ke,R as se,u_ as be,kh as Jt,uW as Zt,cy as re,eG as x,az as z,_ as Y,aA as U,hI as ye,aW as Ue,al as yt,aB as ne,aC as Ce,dR as es,cq as qe,dP as ts,J as ss,cA as rs,cz as os,cv as vt,db as at}from"./kw08ajijqinojrwh.js";import{u0 as bt,u1 as as,u2 as ns,u3 as jt,by as fe,bz as ge,a$ as te,bA as he,i8 as _t,u4 as wt,u5 as is,bw as kt,gJ as Ct,bx as Nt,bt as ls,al as ds,u6 as cs,b7 as St,w as ms,bB as us}from"./fyw02vlaiv2vq6cj.js";var He,nt;function fs(){if(nt)return He;nt=1;var t=qt(),s=Bt(),r="[object RegExp]";function o(a){return s(a)&&t(a)==r}return He=o,He}var Ae,it;function hs(){if(it)return Ae;it=1;var t=fs(),s=Vt(),r=Wt(),o=r&&r.isRegExp,a=o?s(o):t;return Ae=a,Ae}var Oe,lt;function gs(){if(lt)return Oe;lt=1;var t=Qt(),s=t("length");return Oe=s,Oe}var Ge,dt;function xs(){if(dt)return Ge;dt=1;var t="\\ud800-\\udfff",s="\\u0300-\\u036f",r="\\ufe20-\\ufe2f",o="\\u20d0-\\u20ff",a=s+r+o,n="\\ufe0e\\ufe0f",h="["+t+"]",_="["+a+"]",u="\\ud83c[\\udffb-\\udfff]",v="(?:"+_+"|"+u+")",H="[^"+t+"]",C="(?:\\ud83c[\\udde6-\\uddff]){2}",w="[\\ud800-\\udbff][\\udc00-\\udfff]",R="\\u200d",p=v+"?",k="["+n+"]?",M="(?:"+R+"(?:"+[H,C,w].join("|")+")"+k+p+")*",y=k+p+M,d="(?:"+[H+_+"?",_,C,w,h].join("|")+")",f=RegExp(u+"(?="+u+")|"+d+y,"g");function D(N){for(var E=f.lastIndex=0;f.test(N);)++E;return E}return Ge=D,Ge}var Ie,ct;function Ms(){if(ct)return Ie;ct=1;var t=gs(),s=bt(),r=xs();function o(a){return s(a)?r(a):t(a)}return Ie=o,Ie}var Le,mt;function ps(){if(mt)return Le;mt=1;var t=Kt(),s=as(),r=bt(),o=$t(),a=hs(),n=Ms(),h=ns(),_=Yt(),u=Xt(),v=30,H="...",C=/\w*$/;function w(R,p){var k=v,M=H;if(o(p)){var y="separator"in p?p.separator:y;k="length"in p?_(p.length):k,M="omission"in p?t(p.omission):M}R=u(R);var d=R.length;if(r(R)){var f=h(R);d=f.length}if(k>=d)return R;var D=k-n(M);if(D<1)return M;var N=f?s(f,0,D).join(""):R.slice(0,D);if(y===void 0)return N+M;if(f&&(D+=N.length-D),a(y)){if(R.slice(D).search(y)){var E,G=N;for(y.global||(y=RegExp(y.source,u(C.exec(y))+"g")),y.lastIndex=0;E=y.exec(G);)var g=E.index;N=N.slice(0,g===void 0?D:g)}}else if(R.indexOf(t(y),D)!=D){var Q=N.lastIndexOf(y);Q>-1&&(N=N.slice(0,Q))}return N+M}return Le=w,Le}var ys=ps();const Rt=Ft(ys),vs=z(()=>F(()=>import("./l3z5gz1257zwquc2.js"),__vite__mapDeps([0,1])),{loading:t=>U(t)}),bs=z(()=>F(()=>import("./ezd0hym0jr36348y.js"),__vite__mapDeps([2,1])),{loading:t=>U(t)}),js=z(()=>F(()=>import("./i2fce51g7exmjyb6.js"),__vite__mapDeps([3,1])),{loading:t=>U(t)}),_s="https://help.openai.com/en/articles/8590148-memory-faq";function Tt({memory:t,gizmo:s,className:r,readOnly:o,showDivider:a}){var le,$;const n=ie(),h=we(),_=je(),u=ke(),v=jt(u),{mutate:H,isPending:C}=ve({mutationFn:async({memoryId:O,status:Z})=>{const{success:oe}=await se.safePatch("/memories/{memory_id}/status",{parameters:{path:{memory_id:O}},requestBody:{status:Z}});if(!oe)throw new Error("An error occurred while updating the memory status")},onSettled:()=>{_.invalidateQueries({queryKey:fe(s==null?void 0:s.id)}),_.invalidateQueries({queryKey:ge()})},onError:()=>{h.danger(B.somethingWentWrong,{id:"memoryUpdateStatusFailed",toastId:"memory_update_status_failed"})}}),{mutate:w,isPending:R}=ve({mutationFn:async O=>{const{success:Z}=await se.safeDelete("/memories/{memory_id}",{parameters:{path:{memory_id:O}},requestBody:{gizmo_id:s==null?void 0:s.id}});if(!Z)throw new Error("An error occurred while deleting the memory")},onSettled:()=>{_.invalidateQueries({queryKey:fe(s==null?void 0:s.id)}),_.invalidateQueries({queryKey:ge()})},onError:()=>{h.danger(B.deleteFailed,{id:"memoryDeleteFailed",toastId:"memory_delete_failed"})}}),[p,k]=m.useState(!1);function M(O){const Z=new Date,oe=O.getFullYear()===Z.getFullYear();try{return n.formatDate(O,T({month:"long",day:"numeric"},oe?{}:{year:"numeric"}))}catch(de){const c={month:"long",day:"numeric"};return oe||(c.year="numeric"),O.toLocaleDateString(void 0,c)}}const y=n.formatMessage(B.moreOptions),f=((le=t.status)!=null?le:be)==="cold",D=f?()=>{Y.logEvent("Memory Manage Modal Memory Unarchive Clicked"),H({memoryId:t.id,status:"warm"},{onSuccess:()=>{h.successNeutral(n.formatMessage(B.memoryPrioritized),{duration:4,hasCloseButton:!1})}})}:void 0,N=()=>{Y.logEvent("Memory Manage Modal Memory Delete Clicked"),k(!0)},E=f&&t.last_updated?B.deprioritizedOnNoReason:null,G=f&&t.last_updated?{actor:t.last_updated.actor==="user"?n.formatMessage(B.you):"ChatGPT",date:t.last_updated.timestamp!=null?(()=>{const O=Jt(t.last_updated.timestamp);return M(O)})():n.formatMessage(B.unknownDate)}:void 0,g=t.conversation_id,Q=g?"/c/".concat(g):void 0,K=t.updated_at?(()=>{const O=Zt(t.updated_at);return M(O)})():void 0,I=f?null:Q?K?B.savedOnFromChat:B.savedFromChat:K?B.savedOnNoChat:null,X=f?void 0:Q?{date:K,link:O=>e.jsx("a",{href:Q,className:"underline",target:"_blank",rel:"noreferrer",children:O})}:K?{date:K}:void 0;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:re("group border-token-border-default flex w-full flex-row items-center gap-3 border-b px-3",a===!1&&"border-b-0",(R||C)&&"pointer-events-none opacity-50",r),children:[e.jsx("div",{className:re("min-w-0 flex-1 py-3 whitespace-pre-wrap",f&&"text-token-text-tertiary"),children:t.content}),e.jsx("div",{className:"flex shrink-0 justify-end",children:e.jsx(te.Actions,{children:!o&&e.jsxs(x.Root,{children:[e.jsx(x.Trigger,{asChild:!0,children:e.jsx("button",{"aria-label":y,className:"text-token-text-tertiary hover:text-token-text-secondary pointer-events-none size-8! opacity-0 group-hover:pointer-events-auto group-hover:opacity-100",children:e.jsx(bs,{className:"icon"})})}),e.jsx(x.Portal,{children:e.jsxs(x.Content,{align:"start",size:"small",className:"max-w-[280px] min-w-0",children:[D&&v&&e.jsx(x.Item,{icon:js,onClick:D,children:n.formatMessage(B.prioritizeThisMemory)}),e.jsx(x.Item,{icon:vs,color:"danger",onClick:N,children:n.formatMessage(B.delete)}),E&&G&&e.jsx(x.Group,{children:e.jsx("div",{className:"text-token-text-tertiary px-4 py-2 text-[13px] leading-4",children:e.jsx(i,ae(T({},E),{values:G}))})}),I&&X&&e.jsx(x.Group,{children:e.jsx("div",{className:"text-token-text-tertiary px-4 py-2 text-[13px] leading-4",children:e.jsx(i,ae(T({},I),{values:X}))})})]})})]})})})]}),!o&&p&&e.jsx(he,{isOpen:!0,primaryButtonColor:"danger",title:n.formatMessage(B.deleteConfirmTitle),confirmText:n.formatMessage(B.delete),onConfirm:()=>{Y.logEvent("Memory Manage Modal Memory Delete Confirmed"),w(t.id,{onSuccess:()=>{h.successNeutral(n.formatMessage(B.memoryDeleted),{duration:4,hasCloseButton:!1})}}),k(!1)},onClose:()=>{k(!1)},children:e.jsx("div",{className:"mb-2 text-sm",children:n.formatMessage(B.deleteConfirmDescription,{name:($=s==null?void 0:s.name)!=null?$:"ChatGPT",title:e.jsx("strong",{children:Rt(t.content,{length:130,omission:"..."})}),link:O=>e.jsx("a",{href:_s,target:"_blank",rel:"noreferrer",className:"underline",children:O})})})})]})}const B=_e({deprioritizedOnNoReason:{id:"MemoryRow.deprioritizedOnNoReason",defaultMessage:"Deprioritized by {actor} on {date}."},deprioritizedOnWithReason:{id:"MemoryRow.deprioritizedOnWithReason",defaultMessage:"Deprioritized by {actor} on {date} because {reason}."},delete:{id:"MemoryRow.delete",defaultMessage:"Delete"},deleteConfirmTitle:{id:"MemoryRow.deleteConfirmTitle",defaultMessage:"Delete this memory?"},deleteConfirmDescription:{id:"MemoryRow.deleteConfirmDescription",defaultMessage:'"{title}" will be deleted. {name} may not remember this information going forward. <link>Learn more</link>'},deleteFailed:{id:"MemoryRow.deleteFailed",defaultMessage:"Failed to forget memory"},moreOptions:{id:"MemoryRow.moreOptions",defaultMessage:"More options"},savedFromChat:{id:"MemoryRow.savedFromChat",defaultMessage:"Saved from a <link>chat</link>."},savedOnFromChat:{id:"MemoryRow.savedOnFromChat",defaultMessage:"Saved on {date} from a <link>chat</link>."},savedOnNoChat:{id:"MemoryRow.savedOnNoChat",defaultMessage:"Saved on {date}."},somethingWentWrong:{id:"MemoryRow.somethingWentWrong",defaultMessage:"Something went wrong..."},memoryPrioritized:{id:"MemoryRow.memoryPrioritized",defaultMessage:"Memory prioritized"},memoryDeleted:{id:"MemoryRow.memoryDeleted",defaultMessage:"Memory deleted"},prioritizeThisMemory:{id:"MemoryRow.prioritizeThisMemory",defaultMessage:"Prioritize this memory"},unknownDate:{id:"MemoryRow.unknownDate",defaultMessage:"Unknown date"},you:{id:"MemoryRow.you",defaultMessage:"You"}}),ws=80,ks=100;function Cs(t){const s=_t(),r=wt();return s&&!r&&t!=null&&t>ws}function Ns({memoryFullPct:t,className:s}){if(!Cs(t))return null;const o=t;return e.jsx("div",{className:re("flex items-center justify-center",s),children:e.jsx("div",{className:re("flex items-center justify-center gap-0.5 rounded-[8px] p-1 text-sm leading-4 font-semibold whitespace-nowrap",o>=ks?"bg-token-bg-status-error text-token-interactive-label-danger-secondary-default":"bg-token-bg-status-warning text-token-text-status-warning"),children:e.jsx(i,{id:"R17Ykc",defaultMessage:"{memoryFullPct}% full",values:{memoryFullPct:o}})})})}const Pe=_e({disableOptimizeTitle:{id:"personalizationSettings.disableOptimizeTitle",defaultMessage:"Turn off automatic memory management?"},turnOff:{id:"common.turnOff",defaultMessage:"Turn off"},disableOptimizeDescription:{id:"personalizationSettings.disableOptimizeDescription",defaultMessage:"Once memory is full, ChatGPT won't save new memories, and responses may feel less personal. {link}"}}),Ss=({isOpen:t=!1,setShowDisableOMConfirm:s,goldenHourMutation:r})=>{const o=ie();return e.jsx(he,{isOpen:t,title:o.formatMessage(Pe.disableOptimizeTitle),confirmText:o.formatMessage(Pe.turnOff),primaryButtonColor:"danger",onConfirm:()=>{r.mutate({setting:Ue.GoldenHour,value:!1}),s(!1)},onClose:()=>{s(!1)},children:e.jsx("div",{className:"mb-2 text-sm",children:e.jsx(i,ae(T({},Pe.disableOptimizeDescription),{values:{link:a=>e.jsx(ye,{href:"https://help.openai.com/en/articles/8590148-memory-faq",className:"underline",children:a})}}))})})},Rs=z(()=>F(()=>import("./l3z5gz1257zwquc2.js"),__vite__mapDeps([0,1])),{loading:t=>U(t)}),Ts=z(()=>F(()=>import("./ezd0hym0jr36348y.js"),__vite__mapDeps([2,1])),{loading:t=>U(t)});function Ds({label:t,active:s,onClick:r}){return e.jsx("button",{onClick:r,className:"rounded-lg px-3 py-2.5 text-start text-sm "+(s?"dark:bg-token-interactive-bg-secondary-press dark:hover:bg-token-interactive-bg-secondary-hover bg-[#0000000f] hover:bg-[#0000000a]":"dark:hover:bg-token-interactive-bg-secondary-hover hover:bg-[#0000000a]"),children:e.jsx("div",{className:"font-semibold text-wrap",children:t})})}function Es({isOpen:t,onClose:s}){const r=ie(),o=ke();yt(o);const a=je(),{data:n,isLoading:h,isFetching:_,refetch:u}=is(50,t),v=m.useMemo(()=>Array.isArray(n==null?void 0:n.history)?n.history:[],[n]),H=h||_&&!n,[C,w]=m.useState(null),[R,p]=m.useState(!1),[k,M]=m.useState(!1),[y,d]=m.useState(!1),[f,D]=m.useState(!1),N=m.useCallback(async()=>{await u()},[u]),E=m.useCallback(c=>{const b=new Date((c||0)*1e3),j=b.getFullYear()===new Date().getFullYear();try{const P=r.formatDate(b,T({month:"long",day:"numeric"},j?{}:{year:"numeric"})),L=r.formatTime(b,{hour:"numeric",minute:"2-digit"});return"".concat(P,", ").concat(L)}catch(P){const L={month:"long",day:"numeric"};j||(L.year="numeric");const S=b.toLocaleDateString(void 0,L),V=b.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit"});return"".concat(S,", ").concat(V)}},[r]),G=m.useMemo(()=>v.map(c=>{var b;return{id:(b=c.id)!=null?b:"__current__",label:E(c.snapshot_time)}}),[v,E]),g=m.useMemo(()=>{var b,j,P;if(v.length===0)return null;if(C==null)return(j=(b=v.find(L=>L.id==null))!=null?b:v[0])!=null?j:null;const c=C==="__current__"?null:C;return(P=v.find(L=>{var S;return((S=L.id)!=null?S:"__current__")===(c!=null?c:"__current__")}))!=null?P:null},[v,C]),Q=m.useMemo(()=>g?E(g.snapshot_time):"",[g,E]),K=m.useCallback(()=>{!g||g.id==null||d(!0)},[g]),I=m.useCallback(async()=>{if(!(!g||g.id==null)){D(!0);try{const{success:c}=await se.safeDelete("/memories/history/{memory_history_id}",{parameters:{path:{memory_history_id:g.id}}});if(!c)throw new Error("failed");await N(),w(null)}catch(c){}finally{D(!1),d(!1)}}},[g,N]),X=(C!=null?C:"__current__")==="__current__",le=(g==null?void 0:g.id)!=null&&!X;m.useEffect(()=>{if(!t||H)return;if(v.length===0){w(j=>j===null?j:null);return}const c=new Set(v.map(j=>{var P;return(P=j.id)!=null?P:"__current__"})),b=c.has("__current__");w(j=>{var L,S;const P=j!=null?j:"__current__";return c.has(P)?j:b?null:(S=(L=v[0])==null?void 0:L.id)!=null?S:null})},[t,H,v]);function $(c){var S,V;const b=c.updated_at!=null?Date.parse(c.updated_at):NaN;let j=(S=c.last_updated)==null?void 0:S.timestamp;j=j!=null?j:(V=c.created_timestamp)!=null?V:void 0;const P=j!=null?j*1e3:NaN,L=Math.max(Number.isFinite(b)?b:-1/0,Number.isFinite(P)?P:-1/0);return Number.isFinite(L)?L:0}const{currentMemories:O,deprioritizedMemories:Z}=m.useMemo(()=>{var L,S;const c=(L=g==null?void 0:g.memories)!=null?L:[],b=[],j=[];for(const V of c)((S=V.status)!=null?S:be)==="cold"?j.push(V):b.push(V);const P=(V,ce)=>$(ce)-$(V);return{currentMemories:b.sort(P),deprioritizedMemories:j.sort(P)}},[g]),oe=m.useMemo(()=>[...O,...Z],[O,Z]);let de=null;return H?de=e.jsxs("div",{className:"border-token-border-default flex w-full flex-col rounded-lg border",children:[e.jsxs("div",{className:"border-token-border-default relative flex flex-row items-center justify-between gap-3 px-4 py-5",children:[e.jsxs("div",{className:"flex w-48 flex-col gap-2 px-3",children:[e.jsx("div",{className:"bg-token-bg-tertiary h-5 w-48 animate-pulse rounded"}),e.jsx("div",{className:"bg-token-bg-tertiary h-3 w-28 animate-pulse rounded"})]}),e.jsx("div",{className:"bg-token-bg-tertiary h-8 w-36 animate-pulse rounded-full"}),e.jsx("span",{className:"sr-only",children:e.jsx(i,T({},W.loading))})]}),e.jsx("div",{className:"flex flex-1 overflow-y-auto px-4",children:e.jsx("div",{className:"w-full",children:Array.from({length:6}).map((c,b)=>{const j=Math.floor(Math.random()*193)+128;return e.jsx("div",{className:"border-token-border-default flex items-start gap-3 border-b py-4",children:e.jsx("div",{className:"bg-token-bg-tertiary h-6 animate-pulse rounded",style:{width:"".concat(j,"px")}})},b)})})})]}):g?de=e.jsxs("div",{className:"border-token-border-default flex w-full flex-col rounded-lg border",children:[e.jsxs("div",{className:"border-token-border-default group relative flex flex-row items-center justify-between gap-2 px-4 py-5",children:[e.jsx("div",{className:"min-w-0 flex-1 px-3",children:e.jsx("div",{className:"text-lg font-semibold",children:Q})}),e.jsxs("div",{className:"flex h-full shrink-0 items-start gap-2 pe-1",children:[le?e.jsxs(x.Root,{children:[e.jsx(x.Trigger,{asChild:!0,children:e.jsx("button",{"aria-label":r.formatMessage(W.moreOptions),className:"text-token-text-tertiary hover:text-token-text-secondary size-8!",children:e.jsx(Ts,{className:"icon"})})}),e.jsx(x.Portal,{children:e.jsx(x.Content,{align:"start",size:"small",className:"max-w-[200px] min-w-0",children:e.jsx(x.Item,{icon:Rs,color:"danger",onClick:K,className:"gap-2.5! pe-3!",children:r.formatMessage(W.deleteSnapshot)})})})]}):null,e.jsx(ne,{color:"secondary",onClick:()=>p(!0),disabled:X,style:{pointerEvents:X?"none":void 0},children:g.id==null?e.jsx(i,T({},W.currentVersion)):e.jsx(i,T({},W.restoreThisVersion))})]})]}),O.length+Z.length===0?e.jsx("div",{className:"text-token-text-tertiary flex flex-1 items-center justify-center p-4 text-sm",children:e.jsx(i,T({},W.noMemories))}):e.jsx("div",{className:"flex flex-1 overflow-y-auto px-4",children:e.jsx("div",{className:"w-full text-sm",children:oe.map((c,b)=>e.jsx(Tt,{memory:c,gizmo:void 0,readOnly:!0,showDivider:b!==oe.length-1},c.id))})})]}):de=e.jsx("div",{className:"border-token-border-default text-token-text-tertiary flex h-full w-full items-center justify-center rounded-lg border p-4 text-sm",children:e.jsx(i,T({},W.noMemories))}),e.jsxs(e.Fragment,{children:[e.jsx(Ce,{testId:"modal-saved-memories-history",isOpen:t,onClose:s,size:"custom",className:"max-h-[85vh] max-md:min-h-[60vh] md:h-[740px] md:max-w-[960px]",type:"success",title:r.formatMessage(W.title),showCloseButton:!0,children:e.jsxs("div",{className:"flex h-full min-h-0 gap-4",children:[e.jsx("div",{className:"w-60 shrink-0 overflow-y-auto",children:e.jsx("div",{className:"flex flex-col pb-2",children:H?Array.from({length:6}).map((c,b)=>e.jsx("div",{className:"rounded px-3 py-2.5",children:e.jsx("div",{className:"bg-token-bg-tertiary h-4 w-40 animate-pulse rounded"})},b)):e.jsxs(e.Fragment,{children:[G.map(c=>{const b=(C!=null?C:"__current__")===c.id;return e.jsx(Ds,{label:c.label,active:b,onClick:()=>w(c.id)},c.id)}),G.length===0?e.jsx("div",{className:"text-sm",children:e.jsx(i,T({},W.noHistory))}):null]})})}),e.jsx("div",{className:"flex min-w-0 flex-1 overflow-hidden",children:de})]})}),y&&(g==null?void 0:g.id)!=null&&e.jsx(he,{isOpen:!0,title:r.formatMessage(W.confirmDeleteTitle),confirmText:r.formatMessage(W.confirmDeleteCta),primaryButtonColor:"danger",loading:f,onConfirm:I,onClose:()=>{f||d(!1)},children:e.jsx("div",{className:"text-token-text-secondary mb-2 text-sm",children:e.jsx(i,T({},W.confirmDeleteBody))})}),R&&e.jsx(he,{isOpen:!0,title:r.formatMessage(W.confirmRestoreTitle),confirmText:r.formatMessage(W.confirmRestoreCta),primaryButtonColor:"danger",loading:k,onConfirm:async()=>{if(!(!g||g.id==null)){M(!0);try{const{success:c}=await se.safePost("/memories/history/{memory_history_id}/revert",{parameters:{path:{memory_history_id:g.id}}});if(!c)throw new Error("failed");await N(),w(null),a.invalidateQueries({queryKey:["memories"]})}catch(c){}finally{p(!1),M(!1)}}},onClose:()=>p(!1),children:e.jsx("div",{className:"mb-2 text-sm",children:e.jsx(i,T({},W.confirmRestoreBody))})})]})}const W=_e({title:{id:"SavedMemoriesHistoryModal.title",defaultMessage:"Saved memories history"},loading:{id:"SavedMemoriesHistoryModal.loading",defaultMessage:"Loading..."},noHistory:{id:"SavedMemoriesHistoryModal.noHistory",defaultMessage:"No checkpoints"},noMemories:{id:"SavedMemoriesHistoryModal.noMemories",defaultMessage:"No memories"},currentVersion:{id:"SavedMemoriesHistoryModal.currentVersion",defaultMessage:"Current version"},restoreThisVersion:{id:"SavedMemoriesHistoryModal.restoreThisVersion",defaultMessage:"Restore this version"},confirmRestoreTitle:{id:"SavedMemoriesHistoryModal.confirmRestoreTitle",defaultMessage:"Restore this version?"},confirmRestoreBody:{id:"SavedMemoriesHistoryModal.confirmRestoreBody",defaultMessage:"This will replace your current saved memories."},confirmRestoreCta:{id:"SavedMemoriesHistoryModal.confirmRestoreCta",defaultMessage:"Restore"},cancel:{id:"common.cancel",defaultMessage:"Cancel"},moreOptions:{id:"SavedMemoriesHistoryModal.moreOptions",defaultMessage:"More options"},deleteSnapshot:{id:"SavedMemoriesHistoryModal.deleteSnapshot",defaultMessage:"Delete this version"},confirmDeleteTitle:{id:"SavedMemoriesHistoryModal.confirmDeleteTitle",defaultMessage:"Delete this version?"},confirmDeleteBody:{id:"SavedMemoriesHistoryModal.confirmDeleteBody",defaultMessage:"This cannot be undone."},confirmDeleteCta:{id:"SavedMemoriesHistoryModal.confirmDeleteCta",defaultMessage:"Delete"}}),Hs=z(()=>F(()=>import("./dch45l9yrtbjo93p.js"),__vite__mapDeps([4,1])),{loading:t=>U(t)}),As=z(()=>F(()=>import("./lur401x4nz6oqotk.js"),__vite__mapDeps([5,1])),{loading:t=>U(t)}),Os=80,Ne=100;function Dt(t){return t<Ne?"bg-token-bg-status-warning text-token-text-status-warning":"bg-token-bg-status-error text-token-interactive-label-danger-secondary-default"}function Et(t){return _t()&&t!=null&&t>Os}function sr({memoryFullPct:t,className:s,children:r,showInfoLabel:o,onManageMemories:a}){return Et(t)?e.jsx("div",{className:re("border-token-border-default rounded-lg border p-1 text-sm",s),children:e.jsxs(es.div,{className:re("flex h-7 items-center gap-1 overflow-hidden rounded-sm px-1.5 font-medium whitespace-nowrap",Dt(t)),initial:{width:0},animate:{width:"".concat(t,"%")},transition:{duration:.5},children:[e.jsx(As,{className:"icon-sm ms-1"}),e.jsx(i,{id:"6D2etG",defaultMessage:"{memoryFullPct}% full",values:{memoryFullPct:t}}),r,o&&e.jsx(qe,{interactive:!0,label:t<Ne?e.jsx("div",{className:"whitespace-normal",children:e.jsx(i,{id:"gxY4wi",defaultMessage:"ChatGPT's almost out of space for new saved memories. <memoryModalLink>Manage saved memories</memoryModalLink> to create more space.",values:{memoryModalLink:h=>e.jsx("a",{href:"#",className:"cursor-pointer underline",onClick:_=>{_.preventDefault(),a==null||a()},children:h})}})}):e.jsx("div",{className:"whitespace-normal",children:e.jsx(i,{id:"1JxMf3",defaultMessage:"ChatGPT's out of space for saved memories. <memoryModalLink>Manage saved memories</memoryModalLink> to create more space.",values:{memoryModalLink:h=>e.jsx("a",{href:"#",className:"cursor-pointer underline",onClick:_=>{_.preventDefault(),a==null||a()},children:h})}})}),children:e.jsx(Hs,{className:"icon-sm ms-1"})})]})}):null}function Gs({memoryFullPct:t,className:s,showUpgradeCTA:r=!1,isPaid:o=!1,onUpgrade:a}){return Et(t)?e.jsxs("div",{className:re("border-token-border-default bg-token-main-surface-primary flex items-center justify-between gap-4 rounded-lg border p-[14px]",s),children:[e.jsxs("div",{className:"inline-block gap-1",children:[e.jsx("div",{className:re("mb-1 inline-block rounded-[6px] px-[6px] py-[2px] text-sm font-semibold",Dt(t!=null?t:0)),children:e.jsx(i,{id:"56hzv4",defaultMessage:"{memoryFullPct}% full",values:{memoryFullPct:t}})}),e.jsx("div",{className:"text-token-text-secondary text-sm",children:(t!=null?t:0)>=Ne?o?e.jsx(i,{id:"HaCKNx",defaultMessage:"New memories can't be saved, so responses may feel less personalized. Delete existing memories to free up space."}):e.jsx(i,{id:"MXPinw",defaultMessage:"New memories can't be saved, so responses may feel less personalized. Upgrade to expand memory, or delete existing memories."}):o?e.jsx(i,{id:"obgK9b",defaultMessage:"Once memory is full, responses may feel less personalized. Delete existing memories to free up space."}):e.jsx(i,{id:"PDLzFM",defaultMessage:"Once memory is full, responses may feel less personalized. Upgrade to expand memory, or delete existing memories."})})]}),r&&!o&&e.jsx(ne,{color:"primary",size:"medium",onClick:a,children:e.jsx(i,{id:"1rRvWt",defaultMessage:"Upgrade"})})]}):null}function Is({memoryFullPct:t,className:s,onUpgrade:r}){const o=(t!=null?t:0)>=Ne,a=o?"bg-token-bg-status-error text-token-interactive-label-danger-secondary-default":"bg-token-bg-status-warning text-token-text-status-warning";return e.jsxs("div",{className:re("border-token-border-default bg-token-main-surface-primary flex items-center justify-between gap-4 rounded-2xl border p-[14px]",s),children:[e.jsxs("div",{className:"inline-block gap-1",children:[e.jsx("div",{className:re("mb-1 inline-block rounded-[6px] px-[6px] py-[2px] text-sm font-semibold",a),children:e.jsx(i,{id:"56hzv4",defaultMessage:"{memoryFullPct}% full",values:{memoryFullPct:t}})}),e.jsx("div",{className:"text-token-text-secondary text-xs",children:o?e.jsx(i,{id:"MXPinw",defaultMessage:"New memories can't be saved, so responses may feel less personalized. Upgrade to expand memory, or delete existing memories."}):e.jsx(i,{id:"PDLzFM",defaultMessage:"Once memory is full, responses may feel less personalized. Upgrade to expand memory, or delete existing memories."})})]}),e.jsx(ne,{color:"primary",size:"medium",onClick:r,children:e.jsx(i,{id:"1rRvWt",defaultMessage:"Upgrade"})})]})}const Ls=z(()=>F(()=>import("./m3hcuyb0hywkyjmr.js"),__vite__mapDeps([6,1])),{loading:t=>U(t)}),ut=z(()=>F(()=>import("./fyw02vlaiv2vq6cj.js").then(t=>t.zu),__vite__mapDeps([7,1,8,9,10])),{loading:t=>U(t)}),Ps=z(()=>F(()=>import("./dxjaf6qdyfvp7ro9.js"),__vite__mapDeps([11,1])),{loading:t=>U(t)}),Fs=z(()=>F(()=>import("./ezd0hym0jr36348y.js"),__vite__mapDeps([2,1])),{loading:t=>U(t)}),zs=z(()=>F(()=>import("./iyn42bfr1ydmech0.js"),__vite__mapDeps([12,1])),{loading:t=>U(t)});z(()=>F(()=>import("./fyw02vlaiv2vq6cj.js").then(t=>t.zE),__vite__mapDeps([7,1,8,9,10])),{loading:t=>U(t)});const Us=z(()=>F(()=>import("./kspsmo2l8jg7uqdj.js"),__vite__mapDeps([13,1])),{loading:t=>U(t)});var gt;const pe=vt.div(gt||(gt=Ee(["flex h-full items-center justify-center pb-8 text-sm text-token-text-tertiary rounded-lg border border-token-border-default"])));function ft(t){var n,h;const s=t.updated_at!=null?Date.parse(t.updated_at):NaN;let r=(n=t.last_updated)==null?void 0:n.timestamp;r=r!=null?r:(h=t.created_timestamp)!=null?h:void 0;const o=r!=null?r*1e3:NaN,a=Math.max(Number.isFinite(s)?s:-1/0,Number.isFinite(o)?o:-1/0);return Number.isFinite(a)?a:0}function rr({isOpen:t,onClose:s,initialGizmoId:r,contextScopes:o,memoryEntriesFilter:a,requiredContextScopes:n}){var $e,Ye,Xe,Je,Ze,et;const h=ke(),_=Mt(),u=ie(),v=ts(),H=we(),C=kt(),[w,R]=m.useState(r),[p,k]=m.useState(!1),[M,y]=m.useState(""),[d,f]=m.useState(!1),[D,N]=m.useState(!1),[E,G]=m.useState(!1),[g,Q]=m.useState(!1),[K,I]=m.useState(!1),[X,le]=m.useState(!1),$=m.useRef(null),O=Ct();ss(h,"1900515849");const Z=jt(h),{data:oe,isLoading:de}=rs(Ue.GoldenHour),c=oe!==void 0&&Z,b=wt(),j=os(!0),P=m.useCallback(l=>{if(!l&&b){I(!0);return}j.mutate({setting:Ue.GoldenHour,value:l}),Y.logEventWithStatsig("Personalization Settings Automatic Memory Management ".concat(l?"Enabled":"Disabled"),"chatgpt_personalization_settings_automatic_memory_management_".concat(l?"enabled":"disabled"))},[j,b]),L=de||j.isPending,{data:S,isLoading:V,isError:ce,refetch:Be}=Nt(w,!0,C,o,a,n),Ve=($e=S==null?void 0:S.memories)!=null?$e:[],Se=Ve.length,xe=[...Ve].sort((l,q)=>(p?1:-1)*(ft(l)-ft(q))),Re=(()=>{const l=M.trim();if(l==="")return xe;const q=new Set(ls(xe,l,ee=>({targets:[ee.content]}),{locale:u.locale,maxResults:xe.length}).map(ee=>ee.id));return xe.filter(ee=>q.has(ee.id))})(),We=Re.filter(l=>{var q;return((q=l.status)!=null?q:be)!=="cold"}),Qe=Re.filter(l=>{var q;return((q=l.status)!=null?q:be)==="cold"}),me=m.useMemo(()=>[...We,...Qe],[We,Qe]);m.useEffect(()=>()=>{$.current&&(clearTimeout($.current),$.current=null)},[]);const Ht=m.useCallback(async l=>{if(me.length===0)return;const q=me.map(ee=>{var Me;return(Me=ee.content)!=null?Me:""}).join("\n");try{await ds(q,H,l),le(!0),$.current&&clearTimeout($.current),$.current=setTimeout(()=>{le(!1),$.current=null},2e3)}catch(ee){}},[me,H]),{data:Te,refetch:Ys}=pt({queryKey:["memory_gizmos"],queryFn:()=>se.safeGet("/memories/gizmos"),refetchOnMount:"always"}),De=cs(h,(Ye=S==null?void 0:S.memoryFullPct)!=null?Ye:0)!=="control",J=[{id:void 0,name:"ChatGPT",iconUrl:null},...(Xe=Te==null?void 0:Te.items.map(({gizmo:l})=>{var q;return{id:l.id,name:l.display.name,iconUrl:(q=l.display.profile_picture_url)!=null?q:null}}))!=null?Xe:[]].find(l=>l.id===w);m.useEffect(()=>{!V&&!ce&&w!==void 0&&Se===0&&R(void 0)},[V,ce,w,Se]);const At=O&&b?A.descriptionOptimizeOn:O&&c?A.descriptionPaid:O?A.descriptionFreeMoonshine:A.descriptionFree,Ke=u.formatMessage(X?A.copiedAll:A.copyAll),Ot=l=>e.jsx(ye,{href:Fe,className:"underline",children:l});let ue;return V?ue=e.jsx(pe,{className:"border-none",children:e.jsx(i,T({},A.loading))}):ce?ue=e.jsx(pe,{className:"border-none",children:e.jsxs("div",{className:"max-w-sm text-center",children:[e.jsx("div",{className:"mb-4 text-red-500",children:e.jsx(i,{id:"MemoriesModal.somethingWentWrong",defaultMessage:"Something went wrong..."})}),e.jsx("div",{children:e.jsx(ne,{color:"secondary",size:"small",onClick:()=>{Be()},children:e.jsx(i,{id:"MemoriesModal.retry",defaultMessage:"Retry"})})})]})}):Se===0?ue=e.jsx(pe,{className:"text-token-text-primary border-none",children:C?e.jsxs("div",{className:"flex h-full max-w-sm flex-col items-center justify-center gap-0.5 text-center text-base",children:[e.jsx(Ps,{className:"icon-xl"}),e.jsx(i,ae(T({},A.noMemories),{values:{name:(Je=J==null?void 0:J.name)!=null?Je:"ChatGPT"}}))]}):e.jsx("div",{className:"flex h-full max-w-sm items-center justify-center text-center",children:e.jsx(i,T({},A.noMemoriesAndDisabled))})}):M.trim()!==""&&Re.length===0?ue=e.jsx(pe,{className:"text-token-text-tertiary border-none",children:e.jsxs("div",{className:"flex h-full max-w-sm flex-col items-center justify-center gap-2 text-center text-base",children:[e.jsx(ut,{className:"icon-lg"}),e.jsx("div",{children:e.jsx(i,ae(T({},A.searchNoResults),{values:{query:M.trim()}}))}),e.jsx("div",{children:e.jsx(ne,{color:"secondary",size:"small",onClick:()=>{G(!0)},children:e.jsx(i,T({},A.viewHistory))})})]})}):ue=e.jsx(te.Root,{size:"compact",children:e.jsx(te.Body,{children:me.map((l,q)=>{const ee=J?{id:J.id,name:J.name}:void 0,Me={memory:l,gizmo:ee,showDivider:q!==me.length-1};return e.jsx(Tt,T({},Me),l.id)})})}),e.jsxs(e.Fragment,{children:[e.jsxs(Ce,{testId:"modal-golden-hour-memories",isOpen:t,size:"custom",className:"max-h-[85vh] px-2 py-2 max-md:min-h-[60vh] md:h-[740px] md:max-w-[680px]",headerClassName:"shrink-0",contentClassName:"h-full flex flex-col",type:"success",onClose:s,title:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{children:u.formatMessage(A.title)}),!De&&e.jsx(Ns,{memoryFullPct:S==null?void 0:S.memoryFullPct})]}),description:!De&&e.jsx("div",{className:"text-token-text-secondary",children:u.formatMessage(At,{link:Ot})}),showCloseButton:!0,isScrollable:!1,children:[e.jsxs("div",{className:"border-token-border-default w-full border-b pb-4",children:[De&&e.jsx(Is,{memoryFullPct:S==null?void 0:S.memoryFullPct,onUpgrade:()=>{var l;Y.logEventWithStatsig("Memories Upgrade Button Clicked","chatgpt_memories_upgrade_button_clicked_settings",{memory_full_pct:(l=S==null?void 0:S.memoryFullPct)!=null?l:0}),St(_,"chatgpt_memories_upgrade_button")},className:"mb-6"}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"relative min-w-0 flex-1",children:[e.jsx("div",{className:"pointer-events-none absolute start-3 top-1/2 flex h-5 w-5 -translate-y-1/2 items-center justify-center",children:e.jsx(ut,{className:"icon text-token-text-tertiary"})}),e.jsx("input",{type:"text",id:"memories-search",name:"memories-search",placeholder:u.formatMessage(A.searchPlaceholder),className:"border-token-border-default placeholder:text-token-text-tertiary/70 h-9.5 w-full max-w-[320px] rounded-full border bg-transparent ps-10 pe-3 text-sm outline-none focus:shadow-none focus:ring-0 focus:outline-none",value:M,onChange:l=>y(l.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx("button",{type:"button","aria-label":Ke,title:Ke,disabled:me.length===0,onClick:Ht,className:"text-token-text-tertiary hover:text-token-text-secondary hover:bg-token-interactive-bg-tertiary-hover inline-flex size-8! items-center justify-center rounded-md disabled:cursor-not-allowed disabled:opacity-40",children:X?e.jsx(Us,{className:"icon"}):e.jsx(zs,{className:"icon"})}),e.jsxs(x.Root,{children:[e.jsx(x.Trigger,{asChild:!0,children:e.jsx("button",{"aria-label":u.formatMessage(A.sortAria),className:"text-token-text-tertiary hover:text-token-text-secondary hover:bg-token-interactive-bg-tertiary-hover inline-flex size-8! items-center justify-center rounded-md",children:e.jsx(Ls,{className:"icon"})})}),e.jsx(x.Portal,{children:e.jsxs(x.Content,{align:"start",size:"auto",className:"max-w-[280px] min-w-[165px]",children:[e.jsx(x.Group,{children:e.jsx("div",{className:"text-token-text-tertiary px-4 pt-2.5 pb-2 text-[13px] leading-4",children:e.jsx(i,T({},A.sortHeader))})}),e.jsxs(x.RadioGroup,{value:p?"oldest":"newest",onValueChange:l=>k(l==="oldest"),children:[e.jsx(x.RadioItem,{value:"newest",children:e.jsx(i,T({},A.newestFirst))}),e.jsx(x.RadioItem,{value:"oldest",children:e.jsx(i,T({},A.oldestFirst))})]})]})})]}),e.jsxs(x.Root,{children:[e.jsx(x.Trigger,{asChild:!0,children:e.jsx("button",{"aria-label":u.formatMessage(A.moreOptionsAria),className:"text-token-text-tertiary hover:text-token-text-secondary hover:bg-token-interactive-bg-tertiary-hover inline-flex size-8! items-center justify-center rounded-md",children:e.jsx(Fs,{className:"icon"})})}),e.jsx(x.Portal,{children:e.jsxs(x.Content,{align:"start",size:"small",className:"max-w-[280px] min-w-0",children:[c&&e.jsx(x.Group,{children:e.jsx(x.CheckboxItem,{label:u.formatMessage(A.autoManageTitle),checked:b,disabled:L,onCheckedChange:l=>{P(l===!0)}})}),e.jsxs(x.Group,{children:[e.jsx(x.Item,{onClick:()=>{G(!0)},children:e.jsx(i,T({},A.viewHistory))}),e.jsx(x.Item,{color:"danger",onClick:()=>{N(!1),f(!0)},children:e.jsx(i,T({},A.deleteAllMemories))})]})]})})]})]})]})]}),e.jsx("div",{className:"h-full min-w-sm overflow-y-auto",children:ue}),d&&e.jsx(he,{isOpen:!0,primaryButtonColor:"danger",title:u.formatMessage(A.deleteAllConfirmTitle),confirmText:u.formatMessage(A.deleteAllConfirmCta),loading:g,onConfirm:async()=>{Q(!0);try{const l={gizmo_id:w,context_scopes:o,required_context_scopes:n,memory_entries_filter:a,delete_history:D};w===void 0&&(l.delete_history=D),await se.safeDelete("/settings/clear_account_user_memory",{requestBody:l}),await Be()}catch(l){}finally{Q(!1),f(!1)}},onClose:()=>f(!1),children:e.jsxs("div",{className:"mb-2 flex flex-col gap-5 text-sm",children:[e.jsx("div",{className:"text-sm",children:O?e.jsx(i,ae(T({},A.deleteAllConfirmDescriptionUpdated),{values:{name:(Ze=J==null?void 0:J.name)!=null?Ze:"ChatGPT",link:l=>e.jsx(ye,{href:Fe,className:"underline",children:l})}})):e.jsx(i,ae(T({},A.deleteAllConfirmDescription),{values:{name:(et=J==null?void 0:J.name)!=null?et:"ChatGPT",link:l=>e.jsx(ye,{href:Fe,className:"underline",children:l})}}))}),e.jsxs("div",{className:"border-token-border-default flex flex-row gap-3 rounded-2xl border px-4 py-4 text-sm",children:[e.jsx(ms,{id:"delete-past-versions",checked:D,onChange:l=>N(l.target.checked),className:"border-token-border-default! h-5 w-5 shrink-0 rounded-full! border ring-0 ring-offset-0 focus:ring-0 focus:ring-offset-0 focus:outline-none",style:{backgroundColor:D?v?"transparent":"black":"transparent"}}),e.jsx("span",{children:u.formatMessage(A.alsoDeletePastVersions)})]})]})})]}),e.jsx(Es,{isOpen:E,onClose:()=>G(!1)}),c&&K&&e.jsx(Ss,{isOpen:K,setShowDisableOMConfirm:I,goldenHourMutation:j})]})}const Fe="https://help.openai.com/en/articles/8983136-what-is-memory",A=_e({descriptionFree:{id:"GoldenHourMemoriesModalFree.description",defaultMessage:"ChatGPT remembers useful details about you and your preferences so it can be more helpful. <link>Learn more</link>"},descriptionFreeMoonshine:{id:"GoldenHourMemoriesModal.description.freeMoonshine",defaultMessage:"ChatGPT tries to remember your recent chats, but it may forget things over time. Saved memories are never forgotten. <link>Learn more</link>"},descriptionPaid:{id:"GoldenHourMemoriesModal.description",defaultMessage:"ChatGPT automatically remembers useful information from chats, making responses more relevant and personal. <link>Learn more</link>"},descriptionOptimizeOn:{id:"GoldenHourMemoriesModal.description.optimizeOn",defaultMessage:"ChatGPT remembers and automatically manages useful information from chats, making responses more relevant and personal. <link>Learn more</link>"},copyAll:{id:"GoldenHourMemoriesModal.copyAll",defaultMessage:"Copy all"},copiedAll:{id:"GoldenHourMemoriesModal.copiedAll",defaultMessage:"Copied"},delete:{id:"GoldenHourMemoriesModal.delete",defaultMessage:"Delete"},deleteDescription:{id:"GoldenHourMemoriesModal.deleteDescription",defaultMessage:'"{title}" will be deleted. {name} may not remember this information going forward. <link>Learn more</link>'},history:{id:"GoldenHourMemoriesModal.history",defaultMessage:"History"},historyIntro:{id:"GoldenHourMemoriesModal.historyIntro",defaultMessage:"Revert to a previous version of your saved memories."},historyModalTitle:{id:"GoldenHourMemoriesModal.historyModalTitle",defaultMessage:"Saved memories history"},loading:{id:"GoldenHourMemoriesModal.loading",defaultMessage:"Loading..."},noHistory:{id:"GoldenHourMemoriesModal.noHistory",defaultMessage:"No checkpoints"},noMemories:{id:"GoldenHourMemoriesModal.noMemories",defaultMessage:"No saved memories"},noMemoriesAndDisabled:{id:"GoldenHourMemoriesModal.noMemoriesAndDisabled",defaultMessage:"Memory is disabled. ChatGPT won't use or save memories."},autoManageTitle:{id:"GoldenHourMemoriesModal.autoManageTitle",defaultMessage:"Automatically manage"},remove:{id:"GoldenHourMemoriesModal.remove",defaultMessage:"Remove"},retry:{id:"GoldenHourMemoriesModal.retry",defaultMessage:"Retry"},somethingWentWrong:{id:"GoldenHourMemoriesModal.somethingWentWrong",defaultMessage:"Something went wrong..."},title:{id:"GoldenHourMemoriesModal.title",defaultMessage:"Saved memories"},unknownGizmo:{id:"GoldenHourMemoriesModal.unknownGizmo",defaultMessage:"Unknown GPT"},viewHistoryTooltip:{id:"GoldenHourMemoriesModal.viewHistoryTooltip",defaultMessage:"View saved memories history"},viewingSnapshot:{id:"GoldenHourMemoriesModal.viewingSnapshot",defaultMessage:"Viewing snapshot from {date}"},searchPlaceholder:{id:"GoldenHourMemoriesModal.searchPlaceholder",defaultMessage:"Search memories"},searchNoResults:{id:"GoldenHourMemoriesModal.searchNoResults",defaultMessage:'No results found for "{query}"'},sortAria:{id:"GoldenHourMemoriesModal.sortAria",defaultMessage:"Sort"},sortHeader:{id:"GoldenHourMemoriesModal.sortHeader",defaultMessage:"Sort"},newestFirst:{id:"GoldenHourMemoriesModal.newestFirst",defaultMessage:"Newest first"},oldestFirst:{id:"GoldenHourMemoriesModal.oldestFirst",defaultMessage:"Oldest first"},moreOptionsAria:{id:"GoldenHourMemoriesModal.moreOptionsAria",defaultMessage:"More options"},viewHistory:{id:"GoldenHourMemoriesModal.viewHistory",defaultMessage:"View history"},deleteAllMemories:{id:"GoldenHourMemoriesModal.deleteAllMemories",defaultMessage:"Delete all memories"},deleteAllConfirmTitle:{id:"GoldenHourMemoriesModal.deleteAllConfirmTitle",defaultMessage:"Delete all memories?"},deleteAllConfirmCta:{id:"GoldenHourMemoriesModal.deleteAllConfirmCta",defaultMessage:"Delete all"},deleteAllConfirmDescription:{id:"GoldenHourMemoriesModal.deleteAllConfirmDescription",defaultMessage:"{name} may not remember this information going forward. To fully remove this information from memory, also delete any related chats. <link>Learn more</link>"},deleteAllConfirmDescriptionUpdated:{id:"GoldenHourMemoriesModal.deleteAllConfirmDescriptionUpdated",defaultMessage:"{name} may not remember this information going forward. To fully remove this information from memory, also delete any related chats. <link>Learn more</link>"},alsoDeletePastVersions:{id:"GoldenHourMemoriesModal.alsoDeletePastVersions",defaultMessage:"Also delete all past versions of saved memories. This cannot be undone."}});function ht({description:t,onClose:s,onConfirm:r}){const o=ie();return e.jsx(Ce,{testId:"modal-confirm-reset-memory",isOpen:!0,onClose:s,type:"success",title:o.formatMessage({id:"MemoriesModal.resetModalTitle",defaultMessage:"Are you sure?"}),description:t,primaryButton:e.jsx(at.Button,{title:o.formatMessage({id:"MemoriesModal.resetModalConfirm",defaultMessage:"Clear memory"}),color:"danger",onClick:r,"data-testid":"confirm-reset-memories-button"}),secondaryButton:e.jsx(at.Button,{title:o.formatMessage({id:"MemoriesModal.resetModalCancel",defaultMessage:"Cancel"}),color:"secondary",onClick:s})})}function qs(t){"use forget";const s=zt.c(20),{onReset:r,gizmoId:o,memoryName:a,contextScopes:n,requiredContextScopes:h,memoryEntriesFilter:_}=t,[u,v]=m.useState(!1),H=ie(),C=we(),w=Ct();let R;s[0]!==n||s[1]!==o||s[2]!==H||s[3]!==_||s[4]!==r||s[5]!==h||s[6]!==C?(R=async()=>{Y.logEvent("Memory Manage Reset Button Confirmed");try{const f={context_scopes:n,required_context_scopes:h,memory_entries_filter:_};o&&(f.gizmo_id=o),await se.safeDelete("/settings/clear_account_user_memory",{requestBody:f}),C.success(H.formatMessage({id:"ResetMemoriesButton.resetSuccess",defaultMessage:"Memory cleared."})),r&&r(),v(!1)}catch(f){C.danger(Ut({id:"ResetMemoriesButton.resetFailed",defaultMessage:"Failed to clear memory."}),{toastId:"reset_memories_button_reset_failed"})}},s[0]=n,s[1]=o,s[2]=H,s[3]=_,s[4]=r,s[5]=h,s[6]=C,s[7]=R):R=s[7];const p=R;let k;s[8]===Symbol.for("react.memo_cache_sentinel")?(k=()=>{Y.logEvent("Memory Manage Reset Button Clicked"),v(!0)},s[8]=k):k=s[8];let M;s[9]!==o?(M=e.jsx(ne,{color:"danger-outline",onClick:k,"data-testid":"reset-memories-button",children:o?e.jsx(i,{id:"ResetMemoriesButton.resetGizmo",defaultMessage:"Clear this GPT's memory"}):e.jsx(i,{id:"ResetMemoriesButton.resetChatGPT",defaultMessage:"Delete all"})}),s[9]=o,s[10]=M):M=s[10];let y;s[11]!==p||s[12]!==w||s[13]!==H||s[14]!==a||s[15]!==u?(y=u&&(w?e.jsx(ht,{description:H.formatMessage({id:"MemoriesModal.resetGizmoModalDescriptionUpdated",defaultMessage:"Deleting your saved memories means {name} may not remember this information going forward. To fully remove this information from {name}'s memory, please delete any related chats. <link>Learn more</link>"},{name:a,link:Bs}),onClose:()=>v(!1),onConfirm:p}):e.jsx(ht,{description:H.formatMessage({id:"MemoriesModal.resetGizmoModalDescription",defaultMessage:"{name} will forget everything it has remembered from your chats. This cannot be undone."},{name:a}),onClose:()=>v(!1),onConfirm:p})),s[11]=p,s[12]=w,s[13]=H,s[14]=a,s[15]=u,s[16]=y):y=s[16];let d;return s[17]!==M||s[18]!==y?(d=e.jsxs(e.Fragment,{children:[M,y]}),s[17]=M,s[18]=y,s[19]=d):d=s[19],d}function Bs(t){return e.jsx("a",{className:"underline",href:"https://help.openai.com/en/articles/8983136-what-is-memory",children:t})}const Vs=z(()=>F(()=>import("./l3z5gz1257zwquc2.js"),__vite__mapDeps([0,1])),{loading:t=>U(t)}),Ws=z(()=>F(()=>import("./bonby2i4xf93dev1.js"),__vite__mapDeps([14,1])),{loading:t=>U(t)}),Qs=z(()=>F(()=>import("./fyw02vlaiv2vq6cj.js").then(t=>t.zE),__vite__mapDeps([7,1,8,9,10])),{loading:t=>U(t)});function Ks({gizmo:t,memory:s}){var y;const r=ie(),o=we(),a=je(),[n,h]=m.useState(!1),[_,u]=m.useState(s.content),v=m.useRef(null);m.useEffect(()=>{if(n&&v.current){const d=v.current,f=d.value.length;d.focus(),d.setSelectionRange(f,f)}},[n]);const{mutate:H,isPending:C}=ve({mutationFn:async d=>{const{success:f}=await se.safeDelete("/memories/{memory_id}",{parameters:{path:{memory_id:d}},requestBody:{gizmo_id:t==null?void 0:t.id}});if(!f)throw new Error("An error occurred while deleting the memory")},onSettled:()=>{a.invalidateQueries({queryKey:fe(t==null?void 0:t.id)}),a.invalidateQueries({queryKey:ge()})},onError:()=>{o.danger({id:"MemoriesModal.deleteFailed",defaultMessage:"Failed to forget memory",description:"Toast message when deleting memory fails"},{id:"memoryDeleteFailed",toastId:"memory_delete_failed"})}}),{mutate:w,isPending:R}=ve({mutationFn:async()=>await se.safePatch("/memories/{memory_id}",{parameters:{path:{memory_id:s.id}},requestBody:{gizmo_id:t==null?void 0:t.id,content:_}}),onSuccess:d=>{const{memory_max_tokens:f,memory_num_tokens:D}=d;a.setQueryData(fe(t==null?void 0:t.id),N=>{if(!N||typeof N!="object")return N;const E=N,G=Math.min(Math.floor(100*D/f),100);return ae(T({},E),{memory_max_tokens:f,memory_num_tokens:D,memoryFullPct:G})}),a.invalidateQueries({queryKey:fe(t==null?void 0:t.id)}),a.invalidateQueries({queryKey:ge()}),h(!1)},onError:()=>{o.danger({id:"MemoriesModal.editFailed",defaultMessage:"Failed to update memory",description:"Toast message when editing memory fails"},{id:"memoryEditFailed",toastId:"memory_edit_failed"})}}),[p,k]=m.useState(!1),M=r.formatMessage({id:"N0czuB",defaultMessage:"Remove"});return e.jsxs(e.Fragment,{children:[e.jsx(te.Row,{disabled:C||R,children:n?e.jsxs(te.Cell,{colSpan:2,className:"relative pe-0",children:[e.jsx("input",{ref:v,autoFocus:!0,value:_,onChange:d=>u(d.target.value),className:"w-full rounded border-2 border-transparent py-2 pe-36 focus:outline-none",maxLength:500,onKeyDown:d=>{if(!d.nativeEvent.isComposing&&d.key==="Enter"){if(_.trim()===""){Y.logEvent("Memory Manage Modal Memory Delete Clicked"),k(!0);return}w()}}}),e.jsxs("div",{className:"absolute end-1 top-1/2 flex -translate-y-1/2 gap-1",children:[e.jsx(ne,{color:"secondary",size:"small",onClick:()=>{u(s.content),h(!1)},children:e.jsx(i,{id:"TTo8Tw",defaultMessage:"Cancel"})}),e.jsx(ne,{size:"small",onClick:()=>{if(_.trim()===""){Y.logEvent("Memory Manage Modal Memory Delete Clicked"),k(!0);return}w()},disabled:R,children:e.jsx(i,{id:"mDcKbU",defaultMessage:"Save"})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(te.Cell,{className:"pe-0",divClassName:"min-h-[40px] items-center w-full",children:e.jsx("div",{className:"border-2 border-transparent py-2 whitespace-pre-wrap",children:s.content})}),e.jsx(te.Cell,{textAlign:"right",children:e.jsxs(te.Actions,{children:[(()=>{const d=r.formatMessage({id:"EditableMemoriesModal.edit",defaultMessage:"Edit"});return e.jsx("button",{onClick:()=>h(!0),"aria-label":d,className:"text-token-text-tertiary hover:text-token-text-secondary",children:e.jsx(qe,{label:d,side:"top",className:"leading-none",children:e.jsx(Ws,{className:"icon-sm"})})})})(),e.jsx("button",{onClick:()=>{Y.logEvent("Memory Manage Modal Memory Delete Clicked"),k(!0)},"aria-label":M,className:"text-token-text-tertiary hover:text-token-text-secondary",children:e.jsx(qe,{className:"leading-none",label:M,side:"top",children:e.jsx(Vs,{className:"icon-sm"})})})]})})]})}),p&&e.jsx(he,{isOpen:!0,primaryButtonColor:"danger",title:M,confirmText:r.formatMessage({id:"fCn0ar",defaultMessage:"Forget"}),onConfirm:()=>{Y.logEvent("Memory Manage Modal Memory Delete Confirmed"),H(s.id),k(!1)},onClose:()=>{k(!1),u(s.content),h(!1)},children:e.jsx(i,{id:"j2cZHW",defaultMessage:'Remove "{title}" from {name}’s saved memories. This can’t be undone. <link>Learn more</link>',values:{name:(y=t==null?void 0:t.name)!=null?y:"ChatGPT",title:e.jsx("strong",{children:Rt(s.content,{length:130,omission:"..."})}),link:d=>e.jsx("a",{href:"https://help.openai.com/en/articles/8590148-memory-faq",target:"_blank",className:"underline",rel:"noreferrer",children:d})}})})]})}function $s({selectedGizmoId:t,onSelect:s,items:r}){const o=r.find(n=>n.id===t);function a(n){var h;return e.jsx(us,{isFirstParty:n.id===void 0,src:(h=n.iconUrl)!=null?h:null,className:"icon"})}return e.jsx("div",{className:"border-token-border-medium mb-2 inline-flex rounded-md border",children:e.jsxs(x.Root,{children:[e.jsx(x.Trigger,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[o?e.jsxs(e.Fragment,{children:[a(o),e.jsx("span",{className:"text-token-text-primary",children:o.name})]}):e.jsx(i,{id:"MemoriesModal.unknownGizmo",defaultMessage:"Unknown GPT"}),e.jsx(Qs,{className:"icon-sm text-token-text-tertiary"})]})}),e.jsx(x.Portal,{children:e.jsx(x.Content,{children:r.map(n=>e.jsxs(x.Item,{className:"flex items-center gap-3",onClick:()=>{s(n.id)},children:[a(n),n.name]},n.id))})})]})})}var xt;const ze=vt.div(xt||(xt=Ee(["flex h-full items-center justify-center pb-8 text-sm text-token-text-tertiary rounded-lg border border-token-border-default"])));function or({onClose:t,initialGizmoId:s,contextScopes:r,memoryEntriesFilter:o,requiredContextScopes:a}){var g,Q,K;const n=ie(),h=je(),_=kt(),[u,v]=m.useState(s),H=ke(),C=Mt(),w=yt(H),R=w==null?void 0:w.hasPlusFeatures();m.useEffect(()=>{Y.logEvent("Memory Modal Shown")},[]);const{data:p,isLoading:k,isError:M,refetch:y}=Nt(u,!0,_,r,o,a),d=p==null?void 0:p.memories,{data:f,refetch:D}=pt({queryKey:["memory_gizmos"],queryFn:()=>se.safeGet("/memories/gizmos"),refetchOnMount:"always"}),N=[{id:void 0,name:"ChatGPT",iconUrl:null},...(g=f==null?void 0:f.items.map(({gizmo:I})=>{var X;return{id:I.id,name:I.display.name,iconUrl:(X=I.display.profile_picture_url)!=null?X:null}}))!=null?g:[]],E=N.find(I=>I.id===u);m.useEffect(()=>{!k&&!M&&u!==void 0&&(!d||d.length===0)&&v(void 0)},[k,M,d,u]);let G;return k?G=e.jsx(ze,{children:e.jsx(i,{id:"MemoriesModal.loading",defaultMessage:"Loading..."})}):M?G=e.jsx(ze,{children:e.jsxs("div",{className:"max-w-sm text-center",children:[e.jsx("div",{className:"mb-4 text-red-500",children:e.jsx(i,{id:"MemoriesModal.somethingWentWrong",defaultMessage:"Something went wrong..."})}),e.jsx("div",{children:e.jsx(ne,{color:"secondary",onClick:()=>{y()},children:e.jsx(i,{id:"MemoriesModal.retry",defaultMessage:"Retry"})})})]})}):!d||d.length===0?G=e.jsx(ze,{children:e.jsx("div",{className:"max-w-sm text-center",children:_?e.jsx(i,{id:"MemoriesModal.noMemories.1",defaultMessage:"As you chat with {name}, the details and preferences it saves will be shown here.",values:{name:(Q=E==null?void 0:E.name)!=null?Q:"ChatGPT"}}):e.jsx(i,{id:"MemoriesModal.noMemoriesAndDisabled",defaultMessage:"Memory is disabled. ChatGPT won't use or save memories."})})}):G=e.jsx(te.Root,{className:"border-token-border-default h-full",size:"compact",bordered:!0,children:e.jsx(te.Body,{children:d.map(I=>e.jsx(Ks,{gizmo:E?{id:E.id,name:E.name}:void 0,memory:I},I.id))})}),e.jsxs(Ce,{testId:"modal-memories",isOpen:!0,onClose:t,size:"custom",className:"max-w-5xl",type:"success",title:n.formatMessage({id:"MemoriesModal.title",defaultMessage:"Saved memories"}),showCloseButton:!0,children:[R&&N.length>1&&e.jsx("div",{className:"mb-4",children:e.jsx($s,{selectedGizmoId:u,items:N,onSelect:I=>{h.invalidateQueries({queryKey:fe(I)}),h.invalidateQueries({queryKey:ge()}),v(I)}})}),e.jsx(Gs,{memoryFullPct:p==null?void 0:p.memoryFullPct,className:"mb-5",showUpgradeCTA:!1,isPaid:R,onUpgrade:()=>{Y.logEventWithStatsig("Memories Upgrade Button Clicked","chatgpt_memories_upgrade_button_clicked_settings"),St(C,"chatgpt_memories_upgrade_button")}}),e.jsx("div",{className:"h-[24rem]",children:G}),e.jsx("div",{className:"mt-5 flex justify-end",children:e.jsx(qs,{onReset:()=>{y(),D(),u&&v(void 0)},gizmoId:u,memoryName:(K=E==null?void 0:E.name)!=null?K:"ChatGPT",contextScopes:r,requiredContextScopes:a,memoryEntriesFilter:o})})]})}export{or as E,rr as G,Gs as M,qs as R,sr as a,Ns as b,Rt as t};
//# sourceMappingURL=i5i93v71imxwxy0p.js.map
