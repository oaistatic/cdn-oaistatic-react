const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/l3z5gz1257zwquc2.js","assets/kfrdmkli83ureki3.js","assets/fyw02vlaiv2vq6cj.js","assets/kw08ajijqinojrwh.js","assets/root-fi49nzd2.css","assets/conversation-small-lq38g8zw.css","assets/kyyxlt80a527gl6x.js","assets/hnt9dcet90ca5vg9.js","assets/cus6e9b5l060ctey.js"])))=>i.map(i=>d[i]);
var it=Object.defineProperty,rt=Object.defineProperties;var lt=Object.getOwnPropertyDescriptors;var Re=Object.getOwnPropertySymbols;var ot=Object.prototype.hasOwnProperty,ct=Object.prototype.propertyIsEnumerable;var De=(t,e,s)=>e in t?it(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,E=(t,e)=>{for(var s in e||(e={}))ot.call(e,s)&&De(t,s,e[s]);if(Re)for(var s of Re(e))ct.call(e,s)&&De(t,s,e[s]);return t},D=(t,e)=>rt(t,lt(e));import{i as ze,c as xe,h as Y,r as S,j as a,v as Ge,d as $e,_ as de,M as Ue}from"./kfrdmkli83ureki3.js";import{p as dt,m as Qe,C as ge,a as ut,P as pt,f as mt,D as ht,g as gt,R as ft,b as _t,c as we,u as xt,d as yt,S as Mt,e as bt}from"./kk30v9ixm0zhzjf4.js";import{l as vt,d as kt,m as Ct,e as St,g as Oe,i as ce,v as He,f as Ze,a as jt,h as wt,s as Pt,c as W,j as Se,k as Et,n as fe,o as ve,u as oe,b as ke,p as Nt}from"./i8e4tsbcdrbcc668.js";import{g as It,c as At,u as he}from"./hoo89wr86agqpm13.js";import{P as Tt,_ as J,gX as X,R as Je,db as je,aC as Pe,br as Le,bl as Be,D as Xe,dk as ye,u as Ee,cy as re,pU as Fe,L as Rt,az as ue,aA as pe,J as Dt}from"./kw08ajijqinojrwh.js";import{x as Ut,w as Ot,lW as Lt}from"./fyw02vlaiv2vq6cj.js";import{i as Ve,P as Bt}from"./hnx3m6kxd7qfeifg.js";import{a as Me,u as Ne,E as Ft,P as Vt,A as Ye}from"./mk4l60okxks92sdf.js";import{a as qt,u as Wt}from"./ejjzjfpdlx2v908r.js";import{r as zt}from"./i7t1qh3u8s8bvtb8.js";import{M as Gt}from"./m3joncw451cqbul2.js";import"./f1g778pkk2fhpy9x.js";import"./hdkg0cys1b7b4f0v.js";import"./ia54sddtrl9qa2wj.js";import"./kbj1b07s2z6vxqkg.js";import"./hu1bt0oauegdhua6.js";import"./h1em0bjkpkjv8ykw.js";import"./gy1lpvuoewmzh42c.js";import"./dm8z7bzkrzic0zmg.js";import"./ipjj058rvhjq2uu2.js";const $t=async({intl:t,store:e,clientThreadId:s})=>{var d,o,_,n;const i=window.location.href,r=i.includes("/share/");try{const u=Tt(s),p=await It(D(E({items:e.items},r?{sharedConversationUrl:i}:{conversationId:u}),{existing_customer_session_client_secret:e.preloadCustomerSessionClientSecret}));return((d=p.cart.errors)==null?void 0:d.length)>0?(J.logEventWithStatsig("product_checkout","product_checkout",D(E({},X((o=e.cartMetadata)!=null?o:{})),{action:"cart_load_failed",reason:"error_response_from_endpoint",error_message:p.cart.errors[0].message})),{error:p.cart.errors[0].message}):p.customer_session_client_secret&&p.publishable_key?(e.setInitialCart(p),p.cart.shipping_option_id&&vt(e,p.id,p.cart.shipping_options,p.cart.shipping_option_id,"prefill"),p.cart.shipping_address&&kt(e,p.id,D(E({},Ct(p.cart.shipping_address)),{complete:!0}),"prefill"),{client_secret:p.customer_session_client_secret,publishable_key:p.publishable_key}):(J.logEventWithStatsig("product_checkout","product_checkout",D(E({},X((_=e.cartMetadata)!=null?_:{})),{action:"cart_load_failed",reason:"error_response_from_endpoint",error_message:"Missing customer_session_client_secret or publishable_key"})),{error:t.formatMessage({id:"imEcZX",defaultMessage:"Failed to load cart session (1300)"})})}catch(u){return J.logEventWithStatsig("product_checkout","product_checkout",D(E({},X((n=e.cartMetadata)!=null?n:{})),{action:"cart_load_failed",reason:"error_thrown_from_endpoint",error_message:u instanceof Error?u.message:"Unknown error"})),{error:u instanceof Error?u.message:t.formatMessage({id:"S86mYy",defaultMessage:"Failed to load cart session (1301)"})}}};function Ke(){return ze({mutationFn:({phoneNumber:t,triggeringProduct:e,verificationExpiryWindowMs:s})=>Je.safePost("/accounts/v1/phone_registry/enroll/start",{requestBody:{phone_number:t,triggering_product:e,verification_expiry_window_ms:s}})})}function Qt(){return ze({mutationFn:({phoneNumber:t,triggeringProduct:e,verificationCode:s})=>Je.safePost("/accounts/v1/phone_registry/enroll/finish",{requestBody:{phone_number:t,triggering_product:e,verification_code:s}})})}function Ht(t){"use forget";const e=xe.c(89),{onClose:s,phoneNumber:i,triggeringProduct:r,onSuccess:d,onBack:o,onCancel:_}=t,n=Y(),[u,p]=S.useState(""),[x,k]=S.useState(null),[c,l]=S.useState(null),y=Qt(),g=Ke();let C;e[0]!==_||e[1]!==s?(C=()=>{_(),s()},e[0]=_,e[1]=s,e[2]=C):C=e[2];const m=C;let h;e[3]!==n?(h=ae=>{var Ae,Te;const Z=ae,be=typeof((Ae=Z==null?void 0:Z.json)==null?void 0:Ae.detail)=="string"?Z.json.detail:void 0;return(Te=be!=null?be:Z==null?void 0:Z.message)!=null?Te:n.formatMessage({id:"MbV2xj",defaultMessage:"Verification failed, please try again."})},e[3]=n,e[4]=h):h=e[4];const M=h;let f;e[5]!==u||e[6]!==y||e[7]!==s||e[8]!==d||e[9]!==i||e[10]!==M||e[11]!==r?(f=async()=>{if(u.trim().length===6)try{k(null),await y.mutateAsync({phoneNumber:i,verificationCode:u.trim(),triggeringProduct:r}),s(),d()}catch(ae){k(M(ae))}},e[5]=u,e[6]=y,e[7]=s,e[8]=d,e[9]=i,e[10]=M,e[11]=r,e[12]=f):f=e[12];const v=f;let j;e[13]!==n||e[14]!==i||e[15]!==g||e[16]!==M||e[17]!==r?(j=async()=>{try{k(null),l(null),await g.mutateAsync({phoneNumber:i,triggeringProduct:r}),l(n.formatMessage({id:"6ZdNIT",defaultMessage:"Code sent, please check your phone."}))}catch(ae){k(M(ae))}},e[13]=n,e[14]=i,e[15]=g,e[16]=M,e[17]=r,e[18]=j):j=e[18];const I=j;let R;e[19]!==o||e[20]!==s?(R=()=>{s(),o()},e[19]=o,e[20]=s,e[21]=R):R=e[21];const U=R;let b;e[22]!==n?(b=n.formatMessage({id:"Oq/uUi",defaultMessage:"Enter code"}),e[22]=n,e[23]=b):b=e[23];let P;e[24]!==b?(P=a.jsx("span",{className:"text-heading-3",children:b}),e[24]=b,e[25]=P):P=e[25];let w;e[26]!==n?(w=n.formatMessage({id:"LsrdZy",defaultMessage:"Back"}),e[26]=n,e[27]=w):w=e[27];let A;e[28]!==U||e[29]!==w?(A=a.jsx(je.Button,{color:"secondary",title:w,onClick:U}),e[28]=U,e[29]=w,e[30]=A):A=e[30];let T;e[31]!==n?(T=n.formatMessage({id:"Gjhl3C",defaultMessage:"Verify"}),e[31]=n,e[32]=T):T=e[32];let O;e[33]!==u||e[34]!==y.isPending?(O=u.trim().length!==6||y.isPending,e[33]=u,e[34]=y.isPending,e[35]=O):O=e[35];let B;e[36]!==y.isPending||e[37]!==v||e[38]!==T||e[39]!==O?(B=a.jsx(je.Button,{"data-testid":"shopping-checkout-phone-verification-step-up-modal__verify",title:T,color:"primary",disabled:O,loading:y.isPending,onClick:v}),e[36]=y.isPending,e[37]=v,e[38]=T,e[39]=O,e[40]=B):B=e[40];let L;e[41]!==v?(L=ae=>{ae.preventDefault(),v()},e[41]=v,e[42]=L):L=e[42];let Q;e[43]!==n||e[44]!==i?(Q=n.formatMessage({id:"FH0uY0",defaultMessage:"Enter the 6-digit code we sent to {phoneNumber}."},{phoneNumber:i}),e[43]=n,e[44]=i,e[45]=Q):Q=e[45];let z;e[46]!==Q?(z=a.jsx("p",{children:Q}),e[46]=Q,e[47]=z):z=e[47];let H;e[48]!==n?(H=n.formatMessage({id:"ImwJZd",defaultMessage:"Enter code"}),e[48]=n,e[49]=H):H=e[49];let F;e[50]!==x?(F=ae=>{const Z=ae.target.value.replace(/\D/g,"").slice(0,6);p(Z),x&&k(null)},e[50]=x,e[51]=F):F=e[51];let V;e[52]!==u||e[53]!==H||e[54]!==F?(V=a.jsx(Ut,{ariaLabel:!1,name:"shopping-checkout-phone-verification-code",value:u,inputMode:"numeric",maxLength:6,autoComplete:"one-time-code",placeholder:H,onChange:F}),e[52]=u,e[53]=H,e[54]=F,e[55]=V):V=e[55];let q;e[56]!==x?(q=x&&a.jsx("p",{className:"text-xs text-red-500",role:"alert",children:x}),e[56]=x,e[57]=q):q=e[57];let G;e[58]!==n?(G=n.formatMessage({id:"5hOqfV",defaultMessage:"Didn't get a code?"}),e[58]=n,e[59]=G):G=e[59];let N;e[60]!==G?(N=a.jsx("span",{children:G}),e[60]=G,e[61]=N):N=e[61];let K;e[62]!==n||e[63]!==g.isPending?(K=g.isPending?n.formatMessage({id:"GR93Ko",defaultMessage:"Sending..."}):n.formatMessage({id:"enMU6z",defaultMessage:"Send again"}),e[62]=n,e[63]=g.isPending,e[64]=K):K=e[64];let ee;e[65]!==I||e[66]!==g.isPending||e[67]!==K?(ee=a.jsx("button",{type:"button",className:"ms-1 text-blue-400",onClick:I,disabled:g.isPending,children:K}),e[65]=I,e[66]=g.isPending,e[67]=K,e[68]=ee):ee=e[68];let te;e[69]!==c?(te=c&&a.jsx("div",{className:"text-token-text-primary mt-1 text-xs",children:c}),e[69]=c,e[70]=te):te=e[70];let se;e[71]!==N||e[72]!==ee||e[73]!==te?(se=a.jsxs("div",{className:"text-token-text-secondary text-xs",children:[N,ee,te]}),e[71]=N,e[72]=ee,e[73]=te,e[74]=se):se=e[74];let le;e[75]!==z||e[76]!==V||e[77]!==q||e[78]!==se?(le=a.jsxs("div",{className:"flex flex-col gap-3",children:[z,V,q,se]}),e[75]=z,e[76]=V,e[77]=q,e[78]=se,e[79]=le):le=e[79];let $;e[80]!==L||e[81]!==le?($=a.jsx("form",{onSubmit:L,className:"text-token-text-primary w-full text-sm",children:le}),e[80]=L,e[81]=le,e[82]=$):$=e[82];let ie;return e[83]!==m||e[84]!==B||e[85]!==$||e[86]!==P||e[87]!==A?(ie=a.jsx(Pe,{testId:"modal-shopping-checkout-phone-verification-step-up",isOpen:!0,type:"success",noPadding:!0,contentClassName:"flex flex-col items-start gap-6 p-6",headerClassName:"!px-6 !py-0 !h-[76px] !items-center",showCloseButton:!0,hasSeparator:!0,onClose:m,title:P,secondaryButton:A,primaryButton:B,children:$}),e[83]=m,e[84]=B,e[85]=$,e[86]=P,e[87]=A,e[88]=ie):ie=e[88],ie}const qe=t=>t.trim().replace(/\s+/g,"").startsWith("+1");function Zt(t){"use forget";const e=xe.c(59),{onClose:s,triggeringProduct:i,onContinue:r,onCancel:d,onSkipVerification:o,initialPhoneNumber:_}=t,n=Y(),[u,p]=S.useState(_!=null?_:""),[x,k]=S.useState(null),c=Ke();let l,y,g,C;if(e[0]!==n||e[1]!==u){g=u.trim();let N;e[6]!==n?(N=n.formatMessage({id:"LGmH6v",defaultMessage:"Please enter a phone number with a +1 country code"}),e[6]=n,e[7]=N):N=e[7],l=N,y=Ve(g),C=qe(g),e[0]=n,e[1]=u,e[2]=l,e[3]=y,e[4]=g,e[5]=C}else l=e[2],y=e[3],g=e[4],C=e[5];const m=C,h=g.length>0&&y&&!m?l:null,M=x!=null?x:h;let f;e[8]!==d||e[9]!==s?(f=()=>{d(),s()},e[8]=d,e[9]=s,e[10]=f):f=e[10];const v=f;let j;e[11]!==l||e[12]!==n||e[13]!==s||e[14]!==r||e[15]!==o||e[16]!==u||e[17]!==c||e[18]!==i?(j=async()=>{var ee,te;const N=u.trim();if(!Ve(N)){k(n.formatMessage({id:"O2638w",defaultMessage:"Please enter a valid phone number"}));return}if(!qe(N)){k(l);return}let K;try{k(null),K=(await c.mutateAsync({phoneNumber:N,triggeringProduct:i})).sms_sent===!1}catch(se){const $=se,ie=typeof((ee=$==null?void 0:$.json)==null?void 0:ee.detail)=="string"?$.json.detail:void 0;k((te=ie!=null?ie:$==null?void 0:$.message)!=null?te:n.formatMessage({id:"ptsFtS",defaultMessage:"We couldn't send a code. Please check your number and try again."}));return}if(s(),K){o();return}r(N)},e[11]=l,e[12]=n,e[13]=s,e[14]=r,e[15]=o,e[16]=u,e[17]=c,e[18]=i,e[19]=j):j=e[19];const I=j;let R;e[20]!==n?(R=n.formatMessage({id:"WUzqsU",defaultMessage:"Verify your phone number"}),e[20]=n,e[21]=R):R=e[21];let U;e[22]!==R?(U=a.jsx("span",{className:"text-heading-3",children:R}),e[22]=R,e[23]=U):U=e[23];let b;e[24]!==n?(b=n.formatMessage({id:"G/pZCX",defaultMessage:"Send code"}),e[24]=n,e[25]=b):b=e[25];const P=!y||!m||c.isPending;let w;e[26]!==I||e[27]!==c.isPending||e[28]!==b||e[29]!==P?(w=a.jsx(je.Button,{"data-testid":"shopping-checkout-phone-number-step-up-modal__continue",title:b,color:"primary",disabled:P,loading:c.isPending,onClick:I}),e[26]=I,e[27]=c.isPending,e[28]=b,e[29]=P,e[30]=w):w=e[30];let A;e[31]!==I?(A=N=>{N.preventDefault(),I()},e[31]=I,e[32]=A):A=e[32];let T;e[33]!==n?(T=n.formatMessage({id:"d2OOS4",defaultMessage:"We use your phone number to confirm it's really you before completing checkout."}),e[33]=n,e[34]=T):T=e[34];let O;e[35]!==T?(O=a.jsx("p",{children:T}),e[35]=T,e[36]=O):O=e[36];let B;e[37]!==n?(B=n.formatMessage({id:"pQgrkU",defaultMessage:"Phone number"}),e[37]=n,e[38]=B):B=e[38];let L;e[39]!==x?(L=N=>{p(N!=null?N:""),x&&k(null)},e[39]=x,e[40]=L):L=e[40];let Q;e[41]===Symbol.for("react.memo_cache_sentinel")?(Q=["US"],e[41]=Q):Q=e[41];let z;e[42]===Symbol.for("react.memo_cache_sentinel")?(z={layout:"inline",showDialCodePrefix:!1,rounded:"lg",densePadding:!0,triggerShowOnlyDialCode:!0,fullWidthJustifyDialCode:!1,placeholderTextSize:"sm",dropdownPanelWidthPx:320},e[42]=z):z=e[42];const H=M!=null?M:void 0;let F;e[43]!==u||e[44]!==B||e[45]!==L||e[46]!==H?(F=a.jsx(Bt,{label:B,value:u,setValue:L,defaultCountry:"US",countries:Q,initialValueFormat:"national",appearance:z,error:H}),e[43]=u,e[44]=B,e[45]=L,e[46]=H,e[47]=F):F=e[47];let V;e[48]!==O||e[49]!==F?(V=a.jsxs("div",{className:"flex flex-col gap-3",children:[O,F]}),e[48]=O,e[49]=F,e[50]=V):V=e[50];let q;e[51]!==V||e[52]!==A?(q=a.jsx("form",{onSubmit:A,className:"text-token-text-primary w-full text-sm",children:V}),e[51]=V,e[52]=A,e[53]=q):q=e[53];let G;return e[54]!==v||e[55]!==q||e[56]!==U||e[57]!==w?(G=a.jsx(Pe,{testId:"modal-shopping-checkout-phone-number-step-up",isOpen:!0,type:"success",noPadding:!0,contentClassName:"flex flex-col items-start gap-6 p-6",headerClassName:"!px-6 !py-0 !h-[76px] !items-center",showCloseButton:!0,hasSeparator:!0,onClose:v,title:U,primaryButton:w,children:q}),e[54]=v,e[55]=q,e[56]=U,e[57]=w,e[58]=G):G=e[58],G}const We="COMMERCE";class et extends Error{constructor(e="Phone verification cancelled"){super(e),this.name="PhoneStepUpCancelledError"}}async function Jt(t){return await new Promise((e,s)=>{let i=!1;const r=n=>{i||(i=!0,n())},d=()=>{r(()=>s(new et))},o=n=>{Le(t,Zt,{triggeringProduct:We,onContinue:u=>{_(u)},onCancel:d,onSkipVerification:()=>{r(()=>e())},initialPhoneNumber:n})},_=n=>{Le(t,Ht,{phoneNumber:n,triggeringProduct:We,onBack:()=>{o(n)},onCancel:d,onSuccess:()=>{r(()=>e())}})};o()})}async function tt({store:t,merchant:e,elements:s,stripe:i,ctx:r,userEmail:d,intl:o,finalShippingAddress:_,expressPaymentType:n,paymentAttemptId:u,onConfirm:p,onComplete:x}){var c,l,y,g,C;const k=performance.now();t.setCartStatus("submitting"),u||(u=Ge());try{if(Xt({store:t,merchant:e,finalShippingAddress:_,expressPaymentType:n,paymentAttemptId:u}),!Yt({elements:s,stripe:i,userEmail:d,intl:o,store:t,paymentAttemptId:u}))return;const m=n!==void 0;let h=null;if(t.cachedPaymentDetailsResponse&&!m)h=t.cachedPaymentDetailsResponse;else if(h=await dt({stripe:Be(i),elements:Be(s),intl:o,billingName:(y=(l=_==null?void 0:_.name)!=null?l:(c=t.billingAddress)==null?void 0:c.name)!=null?y:"",billingEmail:d!=null?d:"",isExpressCheckout:m}),h!=null&&h.isError)return ne(D(E({},h),{store:t,paymentAttemptId:u}));if(h)m||t.setCachedPaymentDetailsResponse(h);else return;p==null||p(),await st({store:t,paymentMethod:h,intl:o,onComplete:x,paymentAttemptId:u,finalShippingAddress:_,startMs:k,expressPaymentType:n,ctx:r})}catch(m){const h=m;let M="payment_failed_general_error";const{stripe_error_code:f,stripe_decline_code:v}=((g=h==null?void 0:h.json)==null?void 0:g.detail)||{};let j=f&&v?await i.localizeError({code:f,decline_code:v}):void 0;h.message==="Failed to fetch"&&!j&&(M="payment_failed_network_error",j=o.formatMessage({id:"DPyhFG",defaultMessage:"Failed to submit payment (1347). Please refresh the page and try again."})),ne({store:t,action:"payment_failed",reason:M,uiMessage:(C=j!=null?j:h.message)!=null?C:o.formatMessage({id:"nyG5lS",defaultMessage:"Failed to submit payment (1350)"}),internalMessage:(f!=null?f:v)?"Stripe error code: ".concat(f,"  ::  Stripe decline code: ").concat(v):h.message,paymentAttemptId:u})}finally{t.setCartStatus("idle")}}function Xt({store:t,merchant:e,finalShippingAddress:s,expressPaymentType:i,paymentAttemptId:r}){var o,_,n,u,p,x,k,c;const d=t.shippingOptions.find(l=>l.id===t.shippingMethodId);_e(t,{merchant_name:e==null?void 0:e.title,merchant_url:e==null?void 0:e.url,totals:t.totals,total_price:t.grandTotal.value,shipping_city:(_=s==null?void 0:s.city)!=null?_:(o=t.shippingAddress)==null?void 0:o.city,shipping_state:(u=s==null?void 0:s.state)!=null?u:(n=t.shippingAddress)==null?void 0:n.state,shipping_zip:(x=s==null?void 0:s.postal_code)!=null?x:(p=t.shippingAddress)==null?void 0:p.postalCode,shipping_country:(c=s==null?void 0:s.country)!=null?c:(k=t.shippingAddress)==null?void 0:k.country,payment_method:at(t,i),shipping_method_name:d==null?void 0:d.title,shipping_method_price:d==null?void 0:d.subtotal,shipping_method_index:t.shippingOptions.findIndex(l=>l.id===t.shippingMethodId),items:t.items.map(l=>({product_id:l.id,product_title:"title"in l?l.title:void 0,variant:"variant"in l?l.variant:void 0,quantity:l.quantity,price:"price"in l?l.price:void 0})),action:"pay_button_clicked",attempt_id:r})}function Yt({elements:t,stripe:e,userEmail:s,intl:i,store:r,paymentAttemptId:d}){return!t||!e?(ne({store:r,action:"payment_failed",reason:"elements_or_stripe_null",uiMessage:i.formatMessage({id:"/MYGq8",defaultMessage:"Failed to submit payment (1340)"}),internalMessage:"elements or stripe is null",paymentAttemptId:d}),!1):s?!0:(ne({store:r,action:"payment_failed",reason:"user_email_empty",uiMessage:i.formatMessage({id:"Zs2vbs",defaultMessage:"Failed to submit payment (1346)"}),internalMessage:"userEmail is empty",paymentAttemptId:d}),!1)}async function st({store:t,paymentMethod:e,intl:s,onComplete:i,paymentAttemptId:r,finalShippingAddress:d,startMs:o,expressPaymentType:_,ctx:n,allowStepUpRetry:u=!0}){var k,c,l,y,g,C,m,h;const p=(k=e.billing_details)!=null&&k.address?Qe(e.billing_details.name,e.billing_details.address,e.billing_details.phone):t.billingAddress?St(t.billingAddress):null;if(!e.id||!e.type||!p){ne({store:t,action:"payment_failed",reason:"missing_payment_method_or_billing_address",uiMessage:s.formatMessage({id:"xYuTJ8",defaultMessage:"Failed to submit payment (1344)"}),internalMessage:"Missing payment method or billing address",extraLogData:{error_message:"Missing payment method: ".concat(e.id," with type: ").concat(e.type)},paymentAttemptId:r});return}const x=await At(t.cartId,t.items,{id:e.id,type:e.type,billing_address:p},r,d);if(x.step_up_action==="PhoneNumberVerification"){if(!u){ne({store:t,action:"payment_failed",reason:"phone_step_up_retry_failed",uiMessage:s.formatMessage({id:"bKp2EC",defaultMessage:"We couldn't verify your phone number. Please try again."}),internalMessage:"Step up requested more than once for the same checkout attempt",paymentAttemptId:r});return}try{await Jt(n)}catch(M){if(M instanceof et){ne({store:t,action:"payment_failed",reason:"phone_step_up_cancelled",uiMessage:s.formatMessage({id:"ETPsrm",defaultMessage:"Phone verification is required to complete checkout."}),internalMessage:"User cancelled phone verification flow",paymentAttemptId:r});return}throw M}await st({store:t,paymentMethod:e,intl:s,onComplete:i,paymentAttemptId:r,finalShippingAddress:d,startMs:o,expressPaymentType:_,ctx:n,allowStepUpRetry:!1});return}if(x.cart!=null){if((c=x.cart.errors)!=null&&c.length){t.setErrors(x.cart.errors),_e(t,{action:"payment_failed",reason:"openai_complete_shopping_cart_failed",error_message:x.cart.errors.map(M=>M.message).join(", "),attempt_id:r});return}if((l=x.order)!=null&&l.id&&((y=x.order)==null?void 0:y.status)==="placed")try{_e(t,{action:"payment_succeeded",attempt_id:r}),Xe.addAction("shopping_checkout.complete",{durationMs:performance.now()-o,merchant_id:(g=t.merchant)==null?void 0:g.externalId,merchant_network_id:(C=t.merchant)==null?void 0:C.networkId,cart_total:t.grandTotal.value,payment_method:at(t,_)}),typeof i=="function"&&await i(x.order),t.closeCheckout()}catch(M){ne({store:t,action:"refresh_convo_failed",uiMessage:s.formatMessage({id:"d45UJa",defaultMessage:"Failed to update conversation (1400)"}),internalMessage:M instanceof Error?M.message:"Unknown error",paymentAttemptId:r})}else ne({store:t,action:"payment_failed",reason:"openai_complete_shopping_cart_failed",uiMessage:s.formatMessage({id:"QJ9CZQ",defaultMessage:"Failed to create order (1345)"}),internalMessage:"Missing orderID",extraLogData:{error_message:"Missing orderID: ".concat((m=x.order)==null?void 0:m.id," with status: ").concat((h=x.order)==null?void 0:h.status)},paymentAttemptId:r})}}function _e(t,e){var s,i,r;J.logEventWithStatsig("product_checkout","product_checkout",E(D(E({},X((s=t.cartMetadata)!=null?s:{})),{checkout_id:t.cartId}),e)),Xe.addAction("shopping_checkout.".concat(e.action),{merchant_id:(i=t.merchant)==null?void 0:i.externalId,merchant_network_id:(r=t.merchant)==null?void 0:r.networkId,cart_total:t.grandTotal.value,reason:e.reason})}function ne({store:t,action:e,reason:s,uiMessage:i,internalMessage:r,extraLogData:d,paymentAttemptId:o}){const _=i+"";t.setErrors([{group:"general",message:_}]),_e(t,E(E(E(E({action:e},s?{reason:s}:{}),r?{error_message:r}:{}),d!=null?d:{}),(e==="payment_failed"||e==="payment_succeeded")&&o?{attempt_id:o}:{}))}function at(t,e){var s,i,r;return(r=e==null?void 0:e.toLocaleLowerCase())!=null?r:(i=(s=t.paymentDetails)==null?void 0:s.label)==null?void 0:i.toLocaleLowerCase()}const nt=({store:t,optionOverrides:e,onConfirm:s,onReady:i,onComplete:r,surface:d})=>{var C;const o=Me(),_=Ne(),n=ye(),u=n==null?void 0:n.email,p=Y(),x=$e(),k=Ee(),c=S.useRef(void 0),l=S.useRef(void 0),y=t.items,g=S.useMemo(()=>{var h,M,f,v,j,I;const m={buttonHeight:40,shippingAddressRequired:!0,billingAddressRequired:!0,allowedShippingCountries:t.allowedCountries,business:{name:(M=(h=t.merchant)==null?void 0:h.title)!=null?M:""},phoneNumberRequired:!0,paymentMethods:{applePay:(f=t==null?void 0:t.paymentTypes[d])!=null&&f.includes("apple_pay")?"always":"never",googlePay:(v=t==null?void 0:t.paymentTypes[d])!=null&&v.includes("google_pay")?"always":"never",shopPay:(j=t==null?void 0:t.paymentTypes[d])!=null&&j.includes("shop_pay")?"auto":"never",link:(I=t==null?void 0:t.paymentTypes[d])!=null&&I.includes("link")?"auto":"never"},paymentMethodOrder:["apple_pay","google_pay","shop_pay","link"],shippingRates:Oe(y,t.shippingOptions,p)};return E(E({},m),e)},[(C=t.merchant)==null?void 0:C.title,t.allowedCountries,e,d,t.paymentTypes,t.shippingOptions,p,y]);return a.jsx(Ft,{options:g,onConfirm:async m=>{var M,f,v;const h=(M=m.shippingAddress)!=null&&M.address&&((f=m.shippingAddress)!=null&&f.name)?Qe(m.shippingAddress.name,m.shippingAddress.address,(v=m.billingDetails)==null?void 0:v.phone):void 0;await tt({store:t,merchant:t.merchant,elements:o,stripe:_,ctx:k,userEmail:u,intl:p,finalShippingAddress:h,expressPaymentType:m.expressPaymentType,paymentAttemptId:c.current,onConfirm:s,onComplete:async j=>{await Ze({store:t,order:j,navigate:x}),await(r==null?void 0:r(j))}})},onReady:()=>{i==null||i()},onClick:m=>{var v;const{expressPaymentType:h,resolve:M,reject:f}=m;if(l.current=t.shippingAddress,c.current=Ge(),J.logEventWithStatsig("product_checkout","product_checkout",D(E({},X((v=t.cartMetadata)!=null?v:{})),{payment_method:h,checkout_id:t.cartId,action:"express_checkout_button_clicked",attempt_id:c.current})),He(t,p))return M();f()},onShippingAddressChange:async function({address:m,resolve:h,reject:M}){try{const f=await he(t.cartId,{items:y,shippingAddress:{name:null,addressLine1:null,addressLine2:null,city:m.city,state:m.state,postalCode:m.postal_code,country:m.country,complete:!0}});t.updateCart(f);const v=Oe(y,f.cart.shipping_options,p);if(v.length===0){M();return}o&&o.update({amount:f.cart.grand_total.value_minor}),h({shippingRates:v})}catch(f){M()}},onCancel:async()=>{try{if(ce(t,l.current)){const m=await he(t.cartId,{items:y,shippingAddress:l.current});t.updateCart(m),o&&o.update({amount:m.cart.grand_total.value_minor})}}catch(m){}},onShippingRateChange:async function({shippingRate:m,resolve:h,reject:M}){try{const f=await he(t.cartId,{items:y,shippingMethodId:m.id});t.updateCart(f),o&&o.update({amount:f.cart.grand_total.value_minor}),h()}catch(f){M()}}})},me=({cartErrors:t,section:e})=>{var i;const s=(i=t==null?void 0:t.filter(r=>e?r.group===e:!0))!=null?i:[];return s.length?a.jsx("div",{className:"flex flex-col gap-1 pt-3",children:s.map(r=>a.jsx(ge,{message:r.message},r.message))}):null},Kt=ue(()=>de(()=>import("./l3z5gz1257zwquc2.js"),__vite__mapDeps([0,1])),{loading:t=>pe(t)}),es=ue(()=>de(()=>import("./fyw02vlaiv2vq6cj.js").then(t=>t.zy),__vite__mapDeps([2,1,3,4,5])),{loading:t=>pe(t)}),ts=ue(()=>de(()=>import("./kyyxlt80a527gl6x.js"),__vite__mapDeps([6,1])),{loading:t=>pe(t)});let Ce=0;function ss({store:t,pushPane:e,loadingCartSession:s,loadingPayment:i,loadingAddress:r,cartLoadError:d,stripeLoadingError:o,merchant:_,footerMessage:n,isCurrentPane:u}){var z,H,F,V,q,G;const p=ye(),x=p==null?void 0:p.email,{cartStatus:k,paymentDetails:c,shippingAddress:l,shippingMethodId:y,shippingOptions:g,totals:C,grandTotal:m,errors:h}=t,M=jt(t.items),f=S.useMemo(()=>g.find(N=>N.id===y),[g,y]),v=!!(c!=null&&c.complete),j=!!(l!=null&&l.complete),I=(s||i||r)&&!d,R=!I&&!d,U=R&&!M,b=k==="complete",P=k==="updating",w=R&&(v||i||r),A=!!(j&&g.length>0&&f),T=!!n&&!I,O=Y(),B=S.useCallback(()=>{if(!wt(t.agreements))return Pt(t,O),!1;e("paymentMethod")},[e]),L=S.useCallback(()=>{e("shippingAddress")},[e]),Q=S.useCallback(()=>{e("shippingMethod")},[e]);return a.jsxs("div",{className:"relative flex h-full flex-col",children:[b&&a.jsx("div",{className:"bg-token-bg-primary absolute inset-0 z-50 flex items-center justify-center",children:a.jsx(ut,{className:"h-44 w-44 text-green-400",loop:!1})}),a.jsxs("div",{className:"flex flex-col px-6 pb-6",children:[a.jsx("div",{className:"mb-4",children:a.jsx(ns,{item:t.items[0],store:t,canUpdateQuantity:U,isLoading:s})}),o&&a.jsx(ge,{message:o}),d&&a.jsx(ge,{message:d}),R&&a.jsxs(a.Fragment,{children:[w&&a.jsxs("div",{className:re(t.cartStatus==="submitting"&&"pointer-events-none opacity-50"),children:[a.jsxs("div",{className:"border-token-border-light border-t",children:[a.jsx(pt,{onClick:B,isComplete:(z=c==null?void 0:c.complete)!=null?z:!1,label:(H=c==null?void 0:c.label)!=null?H:"",sublabel:(F=c==null?void 0:c.sublabel)!=null?F:"",icon:(V=c==null?void 0:c.icon)!=null?V:void 0,isLoading:i}),a.jsx(me,{cartErrors:h,section:"payment_method"})]}),a.jsxs("div",{className:"border-token-border-light border-t",children:[a.jsx(mt,{name:l==null?void 0:l.name,addressLine1:l==null?void 0:l.addressLine1,addressLine2:l==null?void 0:l.addressLine2,city:l==null?void 0:l.city,state:(q=l==null?void 0:l.state)!=null?q:void 0,isComplete:(G=l==null?void 0:l.complete)!=null?G:!1,isLoading:r,onClick:L}),a.jsx(me,{cartErrors:h,section:"shipping_address"})]}),M&&a.jsx("div",{className:"border-token-border-light border-t",children:a.jsx(ht,{emailAddress:x})}),A&&f&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"border-token-border-light border-t",children:a.jsx(gt,{method:f,onClick:Q})}),a.jsx(me,{cartErrors:h,section:"shipping_option"})]})]}),a.jsx(ls,{totals:C,grandTotal:m,isLoading:P}),a.jsx(os,{store:t}),a.jsx(me,{cartErrors:h,section:w?"general":void 0}),a.jsx(as,{store:t,merchant:_,hasValidPaymentMethod:v,isCurrentPane:u,pushPane:e})]})]}),T&&a.jsx(Ie,{className:"bg-token-bg-elevated-secondary text-token-text-tertiary border-token-border-light h-full border-t p-6 text-xs",components:{a:N=>a.jsx("a",D(E({},N),{className:re(N.className,"text-blue-400 underline"),target:"_blank",children:N.children}))},children:n})]})}const as=t=>{"use forget";var R,U;const e=xe.c(27),{store:s,merchant:i,hasValidPaymentMethod:r,isCurrentPane:d,pushPane:o}=t,_=Y(),n=Ne(),u=Me(),p=$e(),x=(R=ye())==null?void 0:R.email,k=Ee(),[c,l]=S.useState(!1);let y,g;e[0]!==r?(y=()=>{r&&l(!1)},g=[r],e[0]=r,e[1]=y,e[2]=g):(y=e[1],g=e[2]),S.useEffect(y,g);let C;e[3]!==s?(C=qt(s),e[3]=s,e[4]=C):C=e[4];const m=!C,h=s.cartStatus==="submitting",M=s.cartStatus==="updating",f=(U=i==null?void 0:i.title)!=null?U:"";let v;e[5]!==d||e[6]!==s?(v=d&&a.jsx(nt,{store:s,surface:"payment_sheet",onReady:()=>l(!0)}),e[5]=d,e[6]=s,e[7]=v):v=e[7];let j;e[8]!==k||e[9]!==u||e[10]!==_||e[11]!==i||e[12]!==p||e[13]!==s||e[14]!==n||e[15]!==x?(j=async()=>{He(s,_)&&await tt({store:s,merchant:i,elements:u,stripe:n,ctx:k,userEmail:x,intl:_,onComplete:async b=>await Ze({store:s,order:b,navigate:p})})},e[8]=k,e[9]=u,e[10]=_,e[11]=i,e[12]=p,e[13]=s,e[14]=n,e[15]=x,e[16]=j):j=e[16];let I;return e[17]!==c||e[18]!==r||e[19]!==o||e[20]!==m||e[21]!==h||e[22]!==M||e[23]!==f||e[24]!==v||e[25]!==j?(I=a.jsx(_t,{isDisabled:m,isSubmitting:h,isUpdating:M,merchantTitle:f,hasValidPaymentMethod:r,expressCheckoutElement:v,expressCheckoutElementReady:c,onClickPay:j,pushPane:o}),e[17]=c,e[18]=r,e[19]=o,e[20]=m,e[21]=h,e[22]=M,e[23]=f,e[24]=v,e[25]=j,e[26]=I):I=e[26],I},ns=({item:t,store:e,canUpdateQuantity:s,isLoading:i})=>a.jsxs("div",{className:"flex gap-4",children:[a.jsx("div",{className:"bg-token-bg-tertiary dark:bg-token-main-surface-primary-inverse overflow-clip rounded-lg",children:i?a.jsx("div",{className:"relative m-0 aspect-square h-32 w-32",children:a.jsx("div",{className:"absolute inset-0 z-3 w-full overflow-hidden",children:a.jsx("div",{className:"absolute start-[-150%] top-[-150%] h-[400%] w-[400%]",children:a.jsx("div",{className:"diagonal-sweep-gradient h-full w-full"})})})}):a.jsx("img",{className:"m-0 aspect-square h-32 w-32 object-cover mix-blend-darken",src:t.imageUrl,alt:t.title})}),a.jsxs("div",{className:"flex flex-1 flex-col",children:[a.jsx("div",{className:"text-normal line-clamp-2 min-h-6 leading-snug font-medium",title:t.title,children:i?a.jsx(Fe,{index:1,width:80,heightSize:"sm"}):t.title}),a.jsx("div",{className:"text-token-text-secondary h-[18px] text-[13px]",children:i?a.jsx(Fe,{index:2,width:60,heightSize:"sm"}):t.variant}),a.jsx("div",{className:"mt-2 flex flex-1 items-end",children:s&&!i&&a.jsx(rs,{quantity:t.quantity,store:e,itemId:t.id,isDisabled:e.cartStatus==="submitting"||e.cartStatus==="updating"})})]})]}),is=600,rs=({quantity:t,store:e,itemId:s,isDisabled:i})=>{const r=Y(),d=S.useRef(e);S.useEffect(()=>{d.current=e},[e]);const o=S.useCallback(Rt(async(n,u)=>{var k,c,l,y,g,C,m;const p=d.current;if(!p)return;const x=++Ce;p.setCartStatus("updating"),p.setErrors([]);try{const h=await he(n,{items:u,shippingMethodId:p.shippingMethodId,shippingAddress:p.shippingAddress});if(x===Ce){p.updateCart(h);const M=(g=(y=(c=(k=h.cart.line_items)==null?void 0:k[0])==null?void 0:c.item.quantity)!=null?y:(l=u[0])==null?void 0:l.quantity)!=null?g:0;J.logEventWithStatsig("product_checkout","product_checkout",D(E({},X((C=p.cartMetadata)!=null?C:{})),{checkout_id:p.cartId,product_id:s,action:"quantity_changed",new_quantity:M.toString()}))}}catch(h){x===Ce&&(p.setErrors([{group:"general",message:r.formatMessage(W.cartUpdateQuantityErrorMessage)}]),J.logEventWithStatsig("product_checkout","product_checkout",D(E({},X((m=p.cartMetadata)!=null?m:{})),{action:"cart_update_failed",reason:"error_response_from_endpoint",error_message:h})),p.setCartStatus("idle"))}},is),[]),_="bg-token-bg-tertiary hover:bg-token-bg-secondary text-token-text-primary flex items-center justify-center px-2 py-2 text-xl font-bold";return a.jsxs("div",{className:re("inline-flex items-center select-none",i&&"pointer-events-none opacity-50"),children:[a.jsx("button",{className:re(_,"rounded-s-xl"),onClick:()=>{if(t===1){confirm(r.formatMessage({id:"XvhtH9",defaultMessage:"Are you sure you want to remove this item?"}))&&Se(e,"deleted_item");return}const n=e.updateQuantity(s,Math.max(t-1,1));o(e.cartId,n)},children:t===1?a.jsx(Kt,{className:"icon"}):a.jsx(ts,{className:"icon"})}),a.jsx("span",{className:"bg-token-bg-tertiary text-token-text-primary flex h-9 w-6 items-center justify-center text-sm font-semibold",children:t}),a.jsx("button",{className:re(_,"rounded-e-xl"),onClick:()=>{const n=e.updateQuantity(s,t+1);o(e.cartId,n)},children:a.jsx(es,{className:"icon"})})]})},ls=({totals:t,grandTotal:e,isLoading:s})=>e!=null&&e.value?a.jsxs("div",{className:"flex flex-col gap-3 pt-3",children:[a.jsx("div",{children:t==null?void 0:t.map(i=>a.jsxs("div",{className:"text-token-text-secondary flex items-end justify-between text-[13px]",children:[a.jsx("span",{className:"font-medium",children:i.title}),a.jsx(Ie,{className:re("transition-opacity duration-200",s&&"opacity-50"),remarkPlugins:[[zt,{singleTilde:!1}]],children:i.formatted_value})]},i.title))}),a.jsxs("div",{className:"flex items-end justify-between",children:[a.jsxs("div",{className:"flex flex-col text-[13px]",children:[a.jsx("span",{className:"font-medium",children:e.title}),a.jsx("span",{className:"text-token-text-secondary",children:e.subtitle})]}),a.jsx("div",{className:"text-xl font-medium",children:e.value_minor>0?a.jsx(ft,{text:e.formatted_value,className:re("transition-opacity duration-200",s&&"opacity-50")}):"-"})]})]}):null,os=t=>{"use forget";const e=xe.c(2),{store:s}=t;let i;return e[0]!==s?(i=s.agreements&&s.agreements.length>0&&a.jsx("div",{className:"flex flex-col gap-2 pt-3",children:s.agreements.map(r=>a.jsx(cs,{store:s,agreement:r},r.id))}),e[0]=s,e[1]=i):i=e[1],i},cs=({agreement:t,store:e})=>{"use no forget";return S.useEffect(()=>{var s;J.logEventWithStatsig("product_checkout","product_checkout",D(E({},X((s=e.cartMetadata)!=null?s:{})),{checkout_id:e.cartId,action:"agreement_shown",agreement_id:t.id}))},[]),a.jsx(Ot,{id:t.id,checked:t.is_checked,onChange:s=>{var r;const i=s.currentTarget.checked;e.setHasAcceptedAgreement(t.id,i),J.logEventWithStatsig("product_checkout","product_checkout",D(E({},X((r=e.cartMetadata)!=null?r:{})),{checkout_id:e.cartId,action:"agreement_clicked",agreement_id:t.id,checked:i}))},labelClassName:"ps-3 text-[13px] font-medium select-none text-token",label:a.jsx(Ie,{components:{a:s=>a.jsx("a",D(E({},s),{className:re(s.className,"text-blue-400 underline"),target:"_blank",children:s.children}))},children:t.content+(t.is_required?" *":"")})},t.id)},Ie=S.memo(Gt),ds=10*1e3,us=({store:t,pushPane:e,resetPanes:s,setLoadingPayment:i,loadingAddress:r,setStripeLoadingError:d,isCurrentPane:o})=>{var I,R,U;const _=Y(),n=ye(),u=n==null?void 0:n.email,p=Me(),x=Ne(),[k,c]=S.useState(null),[l,y]=S.useState(!1),[g,C]=S.useState((I=t.paymentDetails)!=null&&I.complete?t.paymentDetails:null),[m,h]=S.useState(void 0),M=S.useRef(!0),f=S.useRef(!0),v=()=>{M.current=!1,d(_.formatMessage(W.stripeLoadingPaymentMethodError)),i(!1)};S.useEffect(()=>{const b=setTimeout(()=>{M.current&&v()},ds);return()=>clearTimeout(b)},[]);const j=async b=>{var P,w,A,T,O,B;if(c(null),M.current){if(M.current=!1,(P=t.paymentDetails)!=null&&P.complete&&((w=t.billingAddress)!=null&&w.complete)&&t.cachedPaymentDetailsResponse){ve(t,(A=t.paymentDetails)==null?void 0:A.label,"prefill"),i(!1);return}if(b.complete&&((T=b.value.payment_method)!=null&&T.id)){t.setPaymentDetails(D(E({},ke(b)),{complete:!0})),t.setCachedPaymentDetailsResponse({id:b.value.payment_method.id,type:b.value.payment_method.type,billing_details:{address:b.value.payment_method.billing_details.address,name:(O=b.value.payment_method.billing_details.name)!=null?O:""}});const L=D(E({},fe(b.value.payment_method.billing_details.address,b.value.payment_method.billing_details.name,b.value.payment_method.billing_details.phone)),{complete:!0});t.setBillingAddress(L),C(D(E({},ke(b)),{complete:b.complete})),!r&&t.isShippingAddressSameAsBilling&&L.addressLine1&&!ce(t,t.shippingAddress)&&await oe({store:t,fields:{items:t.items,shippingAddress:L},errorMessage:_.formatMessage(W.cartUpdateShippingAddressErrorMessage),source:"prefill"}),ve(t,(B=b.preview)==null?void 0:B.label,"prefill")}i(!1);return}b.complete&&C(D(E({},ke(b)),{complete:!0}))};return a.jsxs("div",{className:"flex w-full flex-col gap-4 px-6 pb-6",children:[o&&((R=t.paymentDetails)==null?void 0:R.complete)&&a.jsx("div",{className:"min-h-10",children:a.jsx(nt,{store:t,surface:"payment_sheet",optionOverrides:{layout:{maxRows:1,overflow:"auto"}},onConfirm:()=>{t.setPaymentDetails(void 0),t.setShippingAddress(void 0),s()}})}),!t.paymentTypes.payment_sheet.includes("card")&&!((U=t.paymentDetails)!=null&&U.complete)&&a.jsx("div",{className:"text-token-text-tertiary py-10 text-center text-sm",children:a.jsx(Ue,{id:"7t8tjX",defaultMessage:"No other payment methods available"})}),a.jsxs("div",{className:t.paymentTypes.payment_sheet.includes("card")?"":"hidden",children:[a.jsx(Vt,{id:"payment-element",options:{fields:{billingDetails:{email:"never",phone:"never"}},wallets:{applePay:"never",googlePay:"never"},defaultValues:{billingDetails:{email:u}},business:{name:"OpenAI"},layout:{type:"accordion",defaultCollapsed:!1}},onLoadError:()=>{M.current&&v()},onChange:j,onSavedPaymentMethodRemove:b=>{var P,w,A,T;((P=t.paymentDetails)==null?void 0:P.paymentMethodId)===((w=b.payment_method)==null?void 0:w.id)&&(t.setPaymentDetails(void 0),C(null)),Et(t,(T=(A=b.payment_method)==null?void 0:A.type)!=null?T:"")}}),k&&a.jsx("div",{className:"mt-2",children:a.jsx(ge,{message:k})}),a.jsx("div",{className:"mt-6 mb-2 text-sm font-medium",children:a.jsx(Ue,{id:"8pb7do",defaultMessage:"Billing address"})}),a.jsx(Ye,{options:{mode:"billing",allowedCountries:t.allowedCountries,fields:{phone:"always"},validation:{phone:{required:"always"}}},onChange:b=>{if(c(null),f.current){f.current=!1;return}h(D(E({},fe(b.value.address,b.value.name,b.value.phone)),{complete:!0}))}})]}),a.jsx(we,{isSaving:l,isDisabled:l,onClick:async()=>{var b;if(c(null),!p){c(_.formatMessage(W.cartUpdateGeneralErrorRetryMessage));return}try{if(!g){c(_.formatMessage(W.cartUpdateGeneralErrorMessage));return}if(!(m!=null&&m.name)){c(_.formatMessage(W.stripeLoadingBillingAddressError));return}y(!0);const{error:P,paymentMethod:w}=await x.preparePaymentMethod({elements:p,params:{allow_redisplay:"always",billing_details:{name:m.name,email:u}}});if(y(!1),P){const{code:A,decline_code:T}=P||{},O=A&&T?await x.localizeError({code:A,decline_code:T}):P.message;c(O);return}ve(t,g==null?void 0:g.label,"user"),t.setPaymentDetails(D(E({},g),{complete:!0,paymentMethodId:w==null?void 0:w.id,paymentMethodType:w==null?void 0:w.type,label:g==null?void 0:g.label,sublabel:g==null?void 0:g.sublabel})),t.setBillingAddress(m),t.setCachedPaymentDetailsResponse(w)}catch(P){c(_.formatMessage(W.cartUpdateGeneralErrorMessage)),y(!1);return}t.isShippingAddressSameAsBilling&&oe({store:t,fields:{items:t.items,shippingAddress:m},errorMessage:_.formatMessage(W.cartUpdateShippingAddressErrorMessage),source:"prefill"}),(b=t.shippingAddress)!=null&&b.addressLine1?s():e("shippingAddress")}})]})},ps=10*1e3;function ms({store:t,resetPanes:e,setLoadingAddress:s,loadingPayment:i,setStripeLoadingError:r,isCurrentPane:d}){var k,c;const o=Y(),_=S.useRef(!0),n=Me(),u=S.useRef(!1);S.useEffect(()=>{ce(t,t.shippingAddress)&&oe({store:t,fields:{items:t.items,shippingAddress:t.shippingAddress},errorMessage:o.formatMessage(W.cartUpdateShippingAddressErrorMessage),source:"prefill",skipLogging:!0});const l=setTimeout(()=>{_.current&&(_.current=!1,r(o.formatMessage(W.stripeLoadingShippingAddressError)),s(!1))},ps);return()=>clearTimeout(l)},[]);const p=async l=>{var y;if(_.current){if(_.current=!1,ce(t,t.shippingAddress)){s(!1);return}l.complete&&((y=l.value.address)!=null&&y.line1)?await oe({store:t,fields:{items:t.items,shippingAddress:D(E({},fe(l.value.address,l.value.name,l.value.phone)),{complete:l.complete})},errorMessage:o.formatMessage(W.cartUpdateShippingAddressErrorMessage),onLocalMutationComplete:()=>{s(!1)},source:"prefill"}):!i&&ce(t,t.billingAddress)&&(t.setIsShippingAddressSameAsBilling(!0),await oe({store:t,fields:{items:t.items,shippingAddress:t.billingAddress},errorMessage:o.formatMessage(W.cartUpdateShippingAddressErrorMessage),onLocalMutationComplete:()=>{s(!1)},source:"prefill"})),s(!1);return}d&&(u.current=!0),t.setIsShippingAddressSameAsBilling(l.syncAddress)},x=(k=t.additionalFields)==null?void 0:k.includes("shipping_address_phone_number");return a.jsxs("div",{className:"flex h-full flex-col gap-4 px-6 pb-6",children:[a.jsx(Ye,{id:"address-element",options:{mode:"shipping",allowedCountries:t.allowedCountries,defaultValues:(c=t.shippingAddress)!=null&&c.complete?Nt(t.shippingAddress,x):void 0,fields:{phone:x?"always":"never"},validation:E({},x&&{phone:{required:"always"}})},onChange:p,onLoadError:()=>{_.current&&(_.current=!1,r(o.formatMessage(W.stripeLoadingShippingAddressError)),s(!1))}}),a.jsx(we,{onClick:async()=>{var y;const l=await((y=n==null?void 0:n.getElement("address",{mode:"shipping"}))==null?void 0:y.getValue());if(l!=null&&l.complete){if(u.current){const g=D(E({},fe(l.value.address,l.value.name,l.value.phone)),{complete:l.complete});oe({store:t,fields:{items:t.items,shippingAddress:g},errorMessage:o.formatMessage(W.cartUpdateShippingAddressErrorMessage),source:"user"})}e()}}})]})}const hs=ue(()=>de(()=>import("./hnt9dcet90ca5vg9.js"),__vite__mapDeps([7,1])),{loading:t=>pe(t)}),gs=ue(()=>de(()=>import("./cus6e9b5l060ctey.js"),__vite__mapDeps([8,1])),{loading:t=>pe(t)});function fs({shippingMethods:t,resetPanes:e,store:s}){const i=Y(),[r,d]=S.useState(s.shippingMethodId);return a.jsxs("div",{className:"flex h-full flex-col gap-4 px-6 pb-6",children:[a.jsx("div",{className:"divide-token-border-light -mt-4 flex flex-col gap-2 divide-y",children:t.map(o=>a.jsxs("button",{type:"button",onClick:()=>{d(o.id)},className:"flex w-full items-center gap-3 rounded-lg px-4 py-3 text-start",children:[r===o.id?a.jsx(gs,{className:"text-token-text-primary h-6 w-6"}):a.jsx(hs,{className:"text-token-text-primary h-6 w-6"}),a.jsxs("div",{className:"flex flex-1 flex-col items-start",children:[a.jsx("span",{className:"text-token-text-primary flex items-center gap-2 text-base",children:o.title}),a.jsx("span",{className:"text-token-text-secondary text-sm leading-tight font-normal",children:o.subtitle})]})]},o.id))}),a.jsx(we,{onClick:()=>{r&&(oe({store:s,fields:{shippingMethodId:r,items:s.items},errorMessage:i.formatMessage(W.cartUpdateShippingAddressErrorMessage),source:"user"}),e())}})]})}function Fs(){var k,c,l,y,g,C,m,h,M,f,v,j,I,R,U,b;const t=Ee(),e=Wt(t),s=!!e.items[0],i=xt("overview"),r=Y(),{currentPane:d,pushPane:o,popPane:_,resetPanes:n}=i,u=Dt(t,"3375735072");S.useEffect(()=>{e.isCheckoutOpen||n()},[e.isCheckoutOpen,n]);const p=S.useMemo(()=>{var P,w,A,T;return[...(w=(P=e.paymentTypes)==null?void 0:P.express_checkout)!=null?w:[],...(T=(A=e.paymentTypes)==null?void 0:A.payment_sheet)!=null?T:[]]},[e.paymentTypes]),x=(k=e.cartMetadata)==null?void 0:k.clientThreadId;return!u||!e.isCheckoutOpen||!s||!x?null:a.jsx(Pe,{testId:"modal-shopping-checkout",isOpen:!0,hideSeparator:!0,showCloseButton:e.cartStatus!=="submitting",size:"large",type:"success",className:"min-h-36 max-w-[550px]!",headerClassName:"sm:p-0 sm:px-6 sm:py-4 items-center sm:-me-1",contentClassName:"!p-0 pt-3",rootClassName:"z-40",shouldIgnoreClickOutside:!0,onEscapeKeyDown:P=>{P.preventDefault(),Se(e,"closed")},onClose:()=>{Se(e,"closed")},title:a.jsx(Mt,{currentPane:d,popPane:_,url:(c=e.merchant)==null?void 0:c.url,faviconUrl:(l=e.merchant)==null?void 0:l.logoUrl,title:(g=(y=e.merchant)==null?void 0:y.title)!=null?g:"",subtitle:(m=(C=e.merchant)==null?void 0:C.subtitle)!=null?m:"",PANES:xs}),children:a.jsx(yt,{grandTotal:e.grandTotal.value_minor>0?e.grandTotal.value_minor:(f=(M=(h=e.totals)==null?void 0:h.find(P=>P.type==="subtotal"))==null?void 0:M.value_minor)!=null?f:0,merchantExternalId:(j=(v=e.merchant)==null?void 0:v.externalId)!=null?j:"",merchantNetworkId:(R=(I=e.merchant)==null?void 0:I.networkId)!=null?R:"",merchantTitle:(b=(U=e.merchant)==null?void 0:U.title)!=null?b:"",paymentMethodTypes:p,clientThreadId:x,fetchSession:()=>$t({intl:r,store:e,clientThreadId:x}),children:({loadingCartSession:P,cartLoadError:w})=>a.jsx(_s,{paneStack:i,pushPane:o,store:e,loadingCartSession:P,cartLoadError:w,resetPanes:n})})})}function _s({paneStack:t,pushPane:e,store:s,loadingCartSession:i,cartLoadError:r,resetPanes:d}){var l,y;const[o,_]=S.useState(!ce(s,s.shippingAddress)),[n,u]=S.useState(!((l=s.paymentDetails)!=null&&l.complete)),[p,x]=S.useState(null),k=Lt({namespace:"shopping_checkout"}),c=(i||n||o)&&!r;return S.useEffect(()=>{var g,C,m,h,M;if(s.isCheckoutOpen&&!c&&s.cartMetadata&&s.cartId){const f=s.items[0];J.logEventWithStatsig("product_checkout","product_checkout",D(E({},X(s.cartMetadata)),{checkout_id:s.cartId,merchant_name:(g=s.merchant)==null?void 0:g.title,merchant_url:(C=s.merchant)==null?void 0:C.url,hadSavedPaymentMethod:!!((m=s.paymentDetails)!=null&&m.complete),items:[{quantity:f.quantity.toString(),price:"price"in f?f.price:void 0,variants:"variant"in f?f.variant:void 0,product_id:f.id,product_title:"title"in f?f.title:void 0}],action:"shown"})),k.endBlock("shown",{context:{merchant_id:(h=s.merchant)==null?void 0:h.externalId,merchant_network_id:(M=s.merchant)==null?void 0:M.networkId,cart_total:s.grandTotal.value,product_id:"productId"in f?f.productId:void 0}})}},[(y=s.cartMetadata)==null?void 0:y.clientThreadId,s.isCheckoutOpen,s.cartId,c]),a.jsx("div",{className:"relative w-full",children:a.jsx(bt,{className:"min-h-[755px] w-full",paneStack:t,useDelayedEnteringPane:!0,alwaysMountedPanes:["paymentMethod","overview","shippingAddress"],renderPane:g=>{switch(g){case"overview":return a.jsx(ss,{store:s,pushPane:C=>{s.setErrors([]),x(null),e(C)},loadingCartSession:i,loadingPayment:n,loadingAddress:o,cartLoadError:r,stripeLoadingError:p,merchant:s.merchant,footerMessage:s.footerMessage,isCurrentPane:t.currentPane==="overview"});case"paymentMethod":return!i&&!r&&a.jsx(us,{store:s,pushPane:e,resetPanes:d,loadingPayment:n,setLoadingPayment:u,loadingAddress:o,setStripeLoadingError:x,isCurrentPane:t.currentPane==="paymentMethod"});case"shippingAddress":return!i&&!r&&a.jsx(ms,{store:s,resetPanes:d,setLoadingAddress:_,loadingPayment:n,setStripeLoadingError:x,isCurrentPane:t.currentPane==="shippingAddress"});case"shippingMethod":return a.jsx(fs,{shippingMethods:s.shippingOptions,store:s,resetPanes:d})}}})})}const xs={overview:{name:{id:"shopping-checkout.pane.overview.title",defaultMessage:"Overview",description:"Title for shopping checkout overview pane"}},shippingAddress:{name:{id:"shopping-checkout.pane.shippingAddress.title",defaultMessage:"Add Shipping Address",description:"Title for shopping checkout shipping address pane"}},shippingMethod:{name:{id:"shopping-checkout.pane.shippingMethod.title",defaultMessage:"Select Shipping Method",description:"Title for shopping checkout shipping method pane"}},paymentMethod:{name:{id:"shopping-checkout.pane.paymentMethod.title",defaultMessage:"Add payment method",description:"Title for shopping checkout payment method pane"}}};export{Fs as CheckoutModal};
//# sourceMappingURL=dba5p8kgio6j21sl.js.map
