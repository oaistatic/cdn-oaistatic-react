const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/monvnv56yufjad8z.js","assets/kfrdmkli83ureki3.js","assets/mjzycow04v25v11d.js","assets/ds49lnif6ph5qgdk.js","assets/h9aonizh0s2wbq5a.js","assets/l2dc1a6f6pz6h0zz.js","assets/kspsmo2l8jg7uqdj.js","assets/md1rrpvuam10a0fv.js","assets/b38dehdbdeuyw9r0.js","assets/oatq8zuo2u8yj3k6.js","assets/foic2dphldl2bjnw.js","assets/c38q3o8c9sxr04er.js","assets/odokf21e9yzx95dg.js","assets/lrtd9knjab0hf8x5.js","assets/fyw02vlaiv2vq6cj.js","assets/kw08ajijqinojrwh.js","assets/root-fi49nzd2.css","assets/conversation-small-lq38g8zw.css","assets/o8zk6g99n3l7p810.js"])))=>i.map(i=>d[i]);
var at=Object.freeze,Pt=Object.defineProperty;var nt=(e,s)=>at(Pt(e,"raw",{value:at(s||e.slice())}));import{r as x,j as t,_ as w,M as j,h as Q,d as dt,u as ce,i as ue,a as St,L as Ft}from"./kfrdmkli83ureki3.js";import{C as me}from"./fxythiulbb2q3qno.js";import{jI as It,hb as Dt,hc as Bt,df as At,B as Ot}from"./fyw02vlaiv2vq6cj.js";import{C as Vt}from"./fux1oumbpb3w9e7e.js";import{cv as Wt,d_ as Qt,dR as zt,az as y,aA as T,cy as W,e6 as ct,p as pe,aX as se,cq as ae,hP as qt,fc as $t,jb as Ht,cs as Kt,eZ as Ut,u as Lt,J as Gt,aB as Jt,da as rt}from"./kw08ajijqinojrwh.js";import{k as _,d as Xt,w as Zt,W as L,O as Yt,r as ut,P as es,A as ts,Q as ot}from"./oyvo09ze11a90qsd.js";import{u as ss,W as as,m as ns,a as rs}from"./lafhvalu919ojf7s.js";import{W as os}from"./goxcf7vc701q04ob.js";var lt;const de=Wt.div(lt||(lt=nt(["animate-pulse rounded-[4px] bg-token-main-surface-tertiary"])));function is(){return t.jsx(Qt,{children:t.jsx(zt.div,{className:"border-token-border-light overflow-y-clip border-b",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},transition:{duration:.15,ease:"easeOut"},children:t.jsxs("div",{className:"flex w-full flex-col gap-0.5 px-3 py-3.5",children:[t.jsx(de,{className:"mt-[0.425rem] mb-[0.225rem] h-[0.6rem] w-[200px]"}),t.jsx(de,{className:"mt-[0.225rem] mb-[0.425rem] h-[0.6rem] w-[100px]"})]})})})}const ls=x.memo(is),ds=y(()=>w(()=>import("./monvnv56yufjad8z.js"),__vite__mapDeps([0,1])),{loading:e=>T(e)}),cs=y(()=>w(()=>import("./mjzycow04v25v11d.js"),__vite__mapDeps([2,1])),{loading:e=>T(e)}),us=y(()=>w(()=>import("./ds49lnif6ph5qgdk.js"),__vite__mapDeps([3,1])),{loading:e=>T(e)}),ms=y(()=>w(()=>import("./h9aonizh0s2wbq5a.js"),__vite__mapDeps([4,1])),{loading:e=>T(e)});function ps({count:e,className:s}){const o=e>=4?ds:e===3?cs:e===2?us:ms;return t.jsxs("span",{className:W("border-token-border-default text-token-text-primary inline-flex h-[24px] items-center gap-1 rounded-full border px-2 py-1 text-[12px] font-medium",s),children:[t.jsx(o,{"aria-hidden":!0,className:"icon-sm"}),t.jsx(j,{id:"pNS3rO",defaultMessage:"{count}",values:{count:e}})]})}function fs({done:e,total:s,className:o}){return t.jsxs("span",{className:W("text-token-text-tertiary inline-flex items-center gap-2 text-sm",o),children:[t.jsx(j,{id:"wham.whamAttemptsProgress.progress",defaultMessage:"{done}/{total} versions",values:{done:e,total:s}}),e===0?t.jsx(me,{size:12,strokeWidth:2}):t.jsx(It,{percentage:e/s*100,thickness:1/10,className:"text-token-text-primary size-3",backgroundStrokeClassName:" stroke-token-text-primary/20",transitionDuration:"0.2s",transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)"})]})}function gs({taskId:e,latestTurnId:s,behavior:o="navigate",onFixCreated:r}){const a=Q(),d=pe(),n=dt(),i=ce(),c=_(l=>l.setLastViewedTaskId),h=_(l=>l.assignPendingTaskToFinalTask),u=_(l=>l.removePendingTaskId),k=_(l=>l.clearFixReviewTaskInFlight),m=x.useCallback(l=>{["current","all","code_review","archived"].forEach(I=>{const p=["wham","tasks",I];i.setQueryData(p,C=>se(C,D=>{D&&D.pages.forEach(ne=>{var N;(N=ne.items)==null||N.forEach(z=>{if(z.id===e){if(!z.task_status_display){z.task_status_display={fix_task_id:l};return}z.task_status_display.fix_task_id=l}})})}))})},[i,e]);return ue({mutationFn:async()=>{if(!s)throw new Error("missing_latest_turn_id");return await L.createFixReviewTask(e,s)},onSuccess:(l,f)=>{m(l.task.id),i.invalidateQueries({queryKey:["wham","tasks"]}),i.invalidateQueries({queryKey:["wham","tasks","current"]}),k(e),f!=null&&f.pendingTaskId&&h(f.pendingTaskId,l.task.id),o==="navigate"&&(c(l.task.id),n("/codex/tasks/".concat(l.task.id)),d.success(a.formatMessage({id:"wham.whamTaskRow.fixTaskCreated",defaultMessage:"Started fix task"}))),r==null||r({fixTaskId:l.task.id,pendingTaskId:f==null?void 0:f.pendingTaskId,response:l})},onError:(l,f)=>{if(k(e),f!=null&&f.pendingTaskId&&u(f.pendingTaskId),l instanceof Xt){Zt(l,e,a,d);return}d.danger(a.formatMessage({id:"wham.whamTaskRow.fixTaskCreateError",defaultMessage:"Couldn't start fix task"}))}})}function hs({taskId:e,latestTurnId:s,highlightTasksTabOnSuccess:o=!1}){const r=_(m=>m.addPendingTaskId),a=_(m=>m.shouldHighlightTasksTab),d=_(m=>m.setShouldHighlightTasksTab),n=_(m=>m.markFixReviewTaskInFlight),i=_(m=>m.clearFixReviewTaskInFlight),c=_(m=>!!m.fixReviewTasksInFlight[e]),h=gs({taskId:e,latestTurnId:s,behavior:"stay"}),u=x.useCallback(m=>{if(m.stopPropagation(),m.preventDefault(),c||h.isPending||!s)return;const l=crypto.randomUUID();r(l);const f=o&&!a;f&&d(!0),n(e),h.mutateAsync({pendingTaskId:l}).catch(()=>{f&&d(!1),i(e)})},[r,o,c,h,d,n,i,a,e,s]),k=h.isPending||c;return t.jsx("button",{type:"button",className:"border-token-border-subtle bg-token-bg-tertiary text-token-text-primary hover:bg-token-bg-secondary flex items-center gap-2 rounded-full border px-3 py-1 text-xs font-medium transition-colors disabled:cursor-not-allowed disabled:opacity-70",onClick:u,disabled:k||!s,children:k?t.jsx(ct,{className:"icon-sm"}):t.jsx(j,{id:"wham.whamTaskRow.fixButton",defaultMessage:"Fix"})})}const xs=y(()=>w(()=>import("./l2dc1a6f6pz6h0zz.js"),__vite__mapDeps([5,1])),{loading:e=>T(e)}),_s=y(()=>w(()=>import("./kspsmo2l8jg7uqdj.js"),__vite__mapDeps([6,1])),{loading:e=>T(e)});function ks({criticalIssueCount:e,highIssueCount:s,totalIssueCount:o}){"use no forget";const r=Q();if(o===0)return t.jsx(ae,{label:r.formatMessage({id:"wham.whamTaskIssuesSummary.noIssuesTooltip",defaultMessage:"Codex didn’t flag any issues"}),children:t.jsx("span",{className:"bg-token-bg-success/20 text-token-text-primary inline-flex min-w-[1.5rem] items-center justify-center gap-1 rounded-full px-2 py-0.5 text-xs font-semibold",children:t.jsx(_s,{className:"icon-sm text-[#008000]"})})});const a=[];return e>0&&a.push({severity:"critical",count:e}),s>0&&a.push({severity:"high",count:s}),a.length===0?null:t.jsx("div",{className:"flex flex-wrap items-center gap-2",children:a.map(({severity:d,count:n})=>{const i=d==="critical",c=i?r.formatMessage({id:"wham.whamTaskIssuesSummary.criticalIssueTooltip",defaultMessage:"Codex flagged {count, plural, one {# severe bug} other {# severe bugs}}"},{count:n}):r.formatMessage({id:"wham.whamTaskIssuesSummary.highIssueTooltip",defaultMessage:"Codex flagged {count, plural, one {# bug} other {# bugs}}"},{count:n});return t.jsx(ae,{label:c,children:t.jsxs("span",{className:W("inline-flex items-center gap-1.5 rounded-full px-2.5 py-1 text-xs font-medium",i?"bg-token-text-status-error/15 text-token-text-status-error":"bg-token-text-status-warning/15 text-token-text-status-warning"),children:[t.jsx(xs,{className:W("icon-sm",i?"text-token-text-status-error":"text-token-text-status-warning")}),i?t.jsx(j,{id:"wham.whamTaskIssuesSummary.criticalIssueCopy",defaultMessage:"{count, plural, one {# severe bug} other {# severe bugs}}",values:{count:n}}):t.jsx(j,{id:"wham.whamTaskIssuesSummary.highIssueCopy",defaultMessage:"{count, plural, one {# bug} other {# bugs}}",values:{count:n}})]})},"".concat(d,"-").concat(n))})})}function vs({dateString:e}){const s=Q(),[o,r]=x.useState(()=>new Date);qt(()=>r(new Date),6e4);const a=x.useMemo(()=>new Date(e),[e]),d=x.useMemo(()=>$t(o,a),[o,a]),n=x.useMemo(()=>Ht(o,a),[o,a]);return n<1?s.formatMessage({id:"wham.formattedRelativeDateTime.justNow",defaultMessage:"Just now"}):n<60?s.formatMessage({id:"wham.formattedRelativeDateTime.minAgo",defaultMessage:"{numMinsDiff} min ago"},{numMinsDiff:n}):d===0?a.toLocaleTimeString(s.locale,{hour:"numeric",minute:"2-digit"}):a.toLocaleDateString(s.locale,{month:"short",day:"numeric"})}function ws(e){return/^[0-9a-f]{40}$/i.test(e)?e.slice(-7):e.length>48?"…"+e.slice(-48):e}const ys=y(()=>w(()=>import("./md1rrpvuam10a0fv.js"),__vite__mapDeps([7,1])),{loading:e=>T(e)}),Ts=y(()=>w(()=>import("./b38dehdbdeuyw9r0.js"),__vite__mapDeps([8,1])),{loading:e=>T(e)}),bs=y(()=>w(()=>import("./oatq8zuo2u8yj3k6.js"),__vite__mapDeps([9,1])),{loading:e=>T(e)}),js=y(()=>w(()=>import("./foic2dphldl2bjnw.js"),__vite__mapDeps([10,1])),{loading:e=>T(e)}),Ns=y(()=>w(()=>import("./c38q3o8c9sxr04er.js"),__vite__mapDeps([11,1])),{loading:e=>T(e)});function Ms(e){return e?e.merged?"merged":e.state==="closed"?"closed":e.draft?"draft":"open":null}function Cs({taskAssistantTurnId:e,taskId:s,data:o,className:r}){const[a,d]=x.useState(o),n=x.useRef(!1);if(x.useEffect(()=>{async function u(){if(!(!a||!e||!s||n.current)){if(!a.merged)try{const k=await L.getTaskTurnPR(s,e);d(k.pr)}catch(k){}n.current=!0}}u()},[a,e,s]),!a)return null;const i=Ms(a);if(!i)return null;const c=a.url,h=u=>{u.stopPropagation(),u.preventDefault(),window.open(c,"_blank","noopener,noreferrer")};return t.jsxs("button",{type:"button",onClick:h,onAuxClick:u=>{u.button===1&&h(u)},className:W("inline-flex w-fit cursor-pointer items-center rounded-full px-2.5 py-1 text-[10px] font-semibold","border border-transparent","group/pill overflow-hidden",{"bg-[#C3DEC780] text-[#008C2E] dark:bg-[#6BBD6720] dark:text-[#6BBD67]":i==="open","bg-[#D6303D20] text-[#D6303D] dark:bg-[#FD756F20] dark:text-[#FD756F]":i==="closed","bg-[#8E3CF320] text-[#8E3CF3] dark:bg-[#C26FFD20] dark:text-[#C26FFD]":i==="merged","bg-[#59636E20] text-[#59636E] dark:bg-[#B2B2B220] dark:text-[#B2B2B2]":i==="draft"},r),children:[t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"icon-container relative transition-all duration-100 group-hover/pill:translate-y-full group-hover/pill:opacity-0 group-hover/pill:blur-sm",children:i==="open"?t.jsx(ys,{"aria-hidden":!0,className:"icon-xs me-1"}):i==="closed"?t.jsx(js,{"aria-hidden":!0,className:"icon-xs me-1"}):i==="merged"?t.jsx(Ts,{"aria-hidden":!0,className:"icon-xs me-1"}):t.jsx(bs,{"aria-hidden":!0,className:"icon-xs me-1"})}),t.jsx("div",{className:"absolute start-0 top-0 -translate-y-full opacity-0 transition-all duration-100 group-hover/pill:translate-y-0 group-hover/pill:opacity-100",children:t.jsx(Ns,{"aria-hidden":!0,className:"icon-xs me-1"})})]}),i==="open"?t.jsx(j,{id:"wham.prStatusBadge.open",defaultMessage:"Open"}):i==="closed"?t.jsx(j,{id:"wham.prStatusBadge.closed",defaultMessage:"Closed"}):i==="merged"?t.jsx(j,{id:"wham.prStatusBadge.merged",defaultMessage:"Merged"}):t.jsx(j,{id:"wham.prStatusBadge.draft",defaultMessage:"Draft"})]})}const Es=y(()=>w(()=>import("./odokf21e9yzx95dg.js"),__vite__mapDeps([12,1])),{loading:e=>T(e)}),Rs=y(()=>w(()=>import("./lrtd9knjab0hf8x5.js"),__vite__mapDeps([13,1])),{loading:e=>T(e)}),Ps=y(()=>w(()=>import("./fyw02vlaiv2vq6cj.js").then(e=>e.zt),__vite__mapDeps([14,1,15,16,17])),{loading:e=>T(e)});function it(e){return e==="archived"?{add:["current","all"],remove:["archived","code_review"]}:e==="code_review"?{add:["archived"],remove:["code_review","current","all"]}:{add:["archived"],remove:["current","all","code_review"]}}function Ss(e){return e&&ut(e)}function Fs(e){var s;return(s=e==null?void 0:e.filter(o=>Ss(o.turn_status)).length)!=null?s:0}function Is(e){if(e)return typeof e=="string"?e:"".concat(e.partition_key,"~").concat(e.id)}function Ds({taskListItem:e,index:s,disableFocusStyle:o,hoveredIndex:r,isCompact:a=!1,hideBorder:d=!1,onMouseEnter:n,onMouseLeave:i,linkPath:c,showArchiveButton:h=!0,currentFilter:u}){var je,Ne,Me,Ce,Ee,Re,Pe,Se,Fe,Ie,De,Be,Ae,Oe,Ve,We,Qe,ze,qe,$e,He,Ke,Ue,Le,Ge,Je,Xe,Ze,Ye,et,tt;const k=Q(),m=pe(),l=Kt(),f=_(g=>g.homeTab),I=u!=null?u:es(f),p=_(g=>g.removePendingTaskByTaskId),C=_(g=>g.setLastViewedTaskId),D=(je=e.task_status_display)==null?void 0:je.fix_task_id,ne=dt(),N=(Ce=(Me=(Ne=e.task_status_display)==null?void 0:Ne.latest_turn_status_display)==null?void 0:Me.turn_status)!=null?Ce:"pending",z=ss(e.id,N,(Re=(Ee=e.task_status_display)==null?void 0:Ee.latest_turn_status_display)==null?void 0:Re.turn_id),fe=(Ie=(Fe=(Se=(Pe=e.task_status_display)==null?void 0:Pe.latest_turn_status_display)==null?void 0:Se.diff_stats)==null?void 0:Fe.lines_added)!=null?Ie:0,ge=(Oe=(Ae=(Be=(De=e.task_status_display)==null?void 0:De.latest_turn_status_display)==null?void 0:Be.diff_stats)==null?void 0:Ae.lines_removed)!=null?Oe:0,M=(Qe=(We=(Ve=e.task_status_display)==null?void 0:Ve.latest_turn_status_display)==null?void 0:We.issue_counts)!=null?Qe:null,he=(ze=M==null?void 0:M["0"])!=null?ze:0,xe=(qe=M==null?void 0:M["1"])!=null?qe:0,mt=M?Object.values(M).reduce((g,R)=>g+R,0):0,pt=he+xe,q=Ut(e.pull_requests),b=q==null?void 0:q.pull_request,_e=Is(q==null?void 0:q.assistant_turn_id),ke=(($e=e==null?void 0:e.task_status_display)==null?void 0:$e.initial_intent)==="cr",G=ke?b:null,re=b==null?void 0:b.head,ft=(He=e.task_status_display)==null?void 0:He.branch_name,B=(Ke=re!=null?re:ft)!=null?Ke:"",ve=ws(B),gt=B&&B!==ve,ht=!l&&!!B&&B!=="master"&&B!=="main"&&(b==null?void 0:b.state)!=="closed"&&(b==null?void 0:b.state)!=="merged",oe=(Le=(Ue=e.task_status_display)==null?void 0:Ue.latest_turn_status_display)==null?void 0:Le.turn_id,xt=(Je=(Ge=e.task_status_display)==null?void 0:Ge.latest_turn_status_display)==null?void 0:Je.turn_status,_t=N==="completed"&&pt>0&&!!oe&&M!=null&&!D,we=(Ye=(Ze=(Xe=e.task_status_display)==null?void 0:Xe.latest_turn_status_display)==null?void 0:Ze.sibling_turn_ids)!=null?Ye:[],ye=we.length+1,kt=we.length>0&&(N==="pending"||N==="in_progress")&&!b,{data:ie}=Yt(e.id,oe,kt),J=(et=ie==null?void 0:ie.latest_turns)!=null?et:null,X=J?J.length:ye,vt=J?Fs(J):ut(xt)?ye:0,E=ce(),wt=x.useMemo(()=>t.jsx(me,{size:20,initialOffset:Math.random()*20*Math.PI}),[]),yt=s!==void 0&&r!=null&&s===r-1,Tt=Lt(),bt=!ke&&!l&&!a&&N!=="pending"&&N!=="in_progress"&&h,jt=Gt(Tt,"879591222")||void 0;x.useEffect(()=>{p(e.id)},[e.id,p]);const{mutate:Nt}=ue({mutationFn:({taskId:g,currentFilter:R})=>R==="archived"?L.recoverTask(g):L.archiveTask(g),onMutate:async({taskId:g,taskListItem:R,currentFilter:F})=>{var Y,st;const{add:$,remove:H}=it(F),A={},K=async P=>{A[P.join("|")]=E.getQueryData(P),await E.cancelQueries({queryKey:P})};for(const P of H){const S=["wham","tasks",P];await K(S),E.setQueryData(S,le=>se(le,V=>{V==null||V.pages.forEach(U=>{var ee;U.items=((ee=U.items)!=null?ee:[]).filter(te=>te.id!==g)})}))}for(const P of $){const S=["wham","tasks",P];await K(S),E.setQueryData(S,le=>se(le,V=>{var te;if(!V||V.pages.length===0)return;const U=V.pages[0],ee=(te=U.items)!=null?te:[];U.items=[R,...ee].filter((Mt,Ct,Et)=>Et.findIndex(Rt=>Rt.id===Mt.id)===Ct)}))}const O=["wham","task",R.id,(st=(Y=R.task_status_display)==null?void 0:Y.latest_turn_status_display)==null?void 0:st.turn_id];return A[O.join("|")]=E.getQueryData(O),await E.cancelQueries({queryKey:O}),E.setQueryData(O,P=>se(P,S=>{S&&(S.task.archived=!S.task.archived)})),{snapshots:A}},onError:(g,R,F)=>{var $;Object.entries(($=F==null?void 0:F.snapshots)!=null?$:{}).forEach(([H,A])=>{E.setQueryData(H.split("|"),A)}),m.danger(k.formatMessage({id:"wham.whamTaskRow.failedToUpdateTask",defaultMessage:"Failed to update task"}))},onSuccess:(g,R)=>{var K,O;const{taskListItem:F,currentFilter:$}=R,{add:H,remove:A}=it($);E.invalidateQueries({queryKey:["wham","task",F.id,(O=(K=F.task_status_display)==null?void 0:K.latest_turn_status_display)==null?void 0:O.turn_id]}),[...H,...A].forEach(Y=>E.invalidateQueries({queryKey:["wham","tasks",Y]}))}}),Z=M!=null?t.jsx(ks,{criticalIssueCount:he,highIssueCount:xe,totalIssueCount:mt},"issues-summary"):null,v=[];switch(N){case"pending":case"in_progress":{X>1?v.push(t.jsx(fs,{done:vt,total:X},"attempt-progress")):a?v.push(wt):(v.push(t.jsx("span",{className:"loading-shimmer-pure-text",children:ns(z,32)},"in-progress-text")),jt&&v.push(t.jsx(Os,{taskId:e.id})));break}case"failed":v.push(t.jsx("span",{className:"text-token-text-status-error",children:t.jsx(j,{id:"wham.whamTaskRow.failed",defaultMessage:"Failed"})},"failed-text"));break;case"cancelled":v.push(t.jsx("span",{className:"text-token-text-secondary",children:t.jsx(j,{id:"wham.whamTaskRow.cancelled",defaultMessage:"Cancelled"})},"cancelled-text"));break;case"completed":{Z&&v.push(Z),X>1&&!b&&v.push(t.jsx(ps,{count:X},"attempts")),b&&_e&&v.push(t.jsx(Cs,{taskAssistantTurnId:_e,taskId:e.id,data:b},"pr-status")),(fe!==0||ge!==0)&&!M&&v.push(t.jsx(as,{className:"min-w-10 justify-end",linesAdded:fe,linesRemoved:ge},"message-stats"));break}default:v.push(t.jsx("span",{className:"text-token-text-secondary",children:t.jsx(j,{id:"wham.whamTaskRow.unknown",defaultMessage:"Unknown"})},"unknown-text"));break}D?v.push(t.jsx(Jt,{type:"button",size:"small",color:"secondary",onClick:g=>{g.preventDefault(),g.stopPropagation(),C(D),ne("/codex/tasks/".concat(D))},children:t.jsx(j,{id:"wham.whamTaskRow.viewFixTask",defaultMessage:"Open fix"})},"view-fix-button")):_t&&v.push(t.jsx(hs,{taskId:e.id,latestTurnId:oe,highlightTasksTabOnSuccess:I==="code_review"},"fix-button")),N!=="completed"&&Z&&v.unshift(Z);const Te=e.updated_at?new Date(e.updated_at*1e3):null,be=(tt=e.task_status_display)==null?void 0:tt.environment_label;return t.jsx("div",{className:"group task-row-container",onMouseEnter:n,onMouseLeave:i,children:t.jsxs(Bs,{disableFocusStyle:o,taskId:e.id,linkPath:c,children:[t.jsxs("div",{className:W("border-token-border-light grid w-full grid-cols-[minmax(0,1fr)_auto] items-center gap-5 border-b px-4 py-3.5 text-sm md:px-3",(yt||d)&&"border-b-transparent"),children:[t.jsxs("div",{className:"flex flex-col gap-0.5",children:[t.jsxs("div",{className:"text-token-text-primary flex w-full min-w-0 items-center gap-1.5",children:[e.has_unread_turn&&t.jsx("div",{className:"size-1.5 rounded-full bg-blue-500"}),t.jsx("div",{className:"flex-1 truncate font-medium",children:G!=null&&G.title?t.jsx("span",{children:G.title}):t.jsx(As,{task:e})})]}),Te&&t.jsxs("div",{className:"text-token-text-tertiary flex gap-1",children:[t.jsx("span",{className:"truncate empty:hidden",children:t.jsx(vs,{dateString:Te.toISOString()})}),be&&t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-token-text-tertiary",children:"·"}),t.jsx("span",{className:"truncate empty:hidden",children:be})]}),ht&&t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-token-text-tertiary",children:"·"}),t.jsx(ae,{label:gt?B:void 0,children:t.jsx("span",{className:"max-w-[8rem] truncate md:max-w-[10rem]",children:ve})})]})]})]}),t.jsx("div",{className:"flex flex-1 items-center gap-2",children:v})]}),bt&&t.jsx("div",{role:"button",onClick:g=>{g.stopPropagation(),g.preventDefault(),Nt({taskId:e.id,taskListItem:e,currentFilter:I})},className:"before:from-token-bg-tertiary before:via-token-bg-tertiary absolute inset-y-1 end-0 z-20 flex w-20 cursor-pointer items-center justify-end pe-2 opacity-0 transition-opacity duration-0 group-hover:opacity-100 group-hover:duration-0 before:pointer-events-none before:absolute before:inset-0 before:-start-0.5 before:bg-gradient-to-l before:to-transparent before:content-['']",children:t.jsx(ae,{label:e.archived?k.formatMessage({id:"wham.whamTaskRow.unarchiveTask",defaultMessage:"Unarchive"}):k.formatMessage({id:"wham.whamTaskRow.archiveTask",defaultMessage:"Archive"}),side:"top",children:e.archived?t.jsx(Es,{className:"icon-md text-token-text-secondary hover:text-token-text-primary relative z-10"}):t.jsx(Ps,{className:"icon-md text-token-text-secondary hover:text-token-text-primary relative z-10"})})})]})})}function Bs({taskId:e,children:s,disableFocusStyle:o,linkPath:r}){const a=_(c=>c.setLastViewedTaskId),d=_(c=>c.lastViewedTaskId),n=x.useRef(null),i=St();return x.useEffect(()=>{d===e&&requestAnimationFrame(()=>{var c,h,u;(c=n.current)==null||c.scrollIntoView({behavior:"instant",block:"center"}),(h=i.state)!=null&&h.focusComposer||(u=n.current)==null||u.focus()})},[]),e?t.jsx("div",{className:W("hover:bg-token-bg-tertiary relative ring-inset",!o&&"focus-within:border-token-border-heavy focus-within:border-s-2 focus-within:ps-[-2px]"),children:t.jsx(Ft,{className:"outline-offset-[-1px] focus-within:rounded-lg",ref:n,to:r!=null?r:"/codex/tasks/".concat(e),onClick:()=>a(e),onMouseDown:c=>c.preventDefault(),children:s})}):t.jsx("div",{className:"hover:bg-token-bg-tertiary relative rounded-lg",children:s})}function As({task:e}){var h,u;const s=Q(),o=(h=e.task_status_display)==null?void 0:h.latest_turn_status_display,r=o?(u=o.turn_status)!=null?u:"pending":"failed",[a,d]=x.useState(),n=o==null?void 0:o.turn_id,i=e.has_generated_title===!1&&(r==="pending"||r==="in_progress")&&!!n,c=x.useMemo(()=>"title-".concat(e.id,"-").concat(n!=null?n:""),[e.id,n]);return rs(e.id,n,["task_title_generated"],{enabled:i,subscriberId:c,onEvent:k=>d(k.title)}),r==="failed"&&e.has_generated_title===!1?s.formatMessage({id:"wham.whamTaskRow.codexTask",defaultMessage:"Codex task"}):e.has_generated_title===!1&&!a?t.jsx(de,{className:"mt-[0.425rem] mb-[0.225rem] h-[0.6rem] w-[200px]"}):t.jsx("span",{children:a!=null?a:e.title})}function Os({taskId:e}){const s=Q(),o=pe(),r=ce(),[a,d]=x.useState(!1),{mutate:n}=ue({mutationFn:async()=>(d(!0),await L.cancelTask(e),await r.invalidateQueries({queryKey:["wham","tasks"]}),!0),onError:()=>{o.danger(s.formatMessage({id:"wham.whamTaskRow.failedToCancelTask",defaultMessage:"Failed to cancel task"}))},onSuccess:()=>{}});return t.jsx("button",{type:"button",className:"border-token-border-heavy hover:bg-token-bg-secondary flex h-6 w-6 items-center justify-center rounded-full border",onClick:i=>{i.stopPropagation(),i.preventDefault(),os.recordCancel("home"),n()},disabled:a,"aria-label":s.formatMessage({id:"wham.composer.cancelTask",defaultMessage:"Cancel task"}),"data-testid":"stop-button",children:a?t.jsx(ct,{className:"icon-sm p-0.5"}):t.jsx(Rs,{className:"icon-sm"})})}function Vs({pendingTaskIds:e,inProgressTasks:s,closePopover:o}){return!s.length&&!e.length?t.jsx("div",{className:"flex min-w-48 items-center justify-center py-5",children:t.jsx(j,{id:"+xSTVR",defaultMessage:"No pending work"})}):t.jsxs("ol",{className:"max-h-[600px] w-[450px] overflow-y-auto p-2",children:[e.map(r=>t.jsx(ls,{},r)),s.map((r,a)=>t.jsx("li",{onClick:o,children:t.jsx(Ds,{index:a,taskListItem:r,isCompact:!0,disableFocusStyle:!0,hoveredIndex:null,onMouseEnter:rt,onMouseLeave:rt,hideBorder:a===s.length-1,currentFilter:"current"})},r.id))]})}const Ws=y(()=>w(()=>import("./o8zk6g99n3l7p810.js"),__vite__mapDeps([18,1])),{loading:e=>T(e)});function Xs(){var I;const[e,s]=x.useState(!1),o=x.useRef(null),{data:r}=ts(),a=_(p=>p.pendingTaskIds),d=_(p=>p.pendingCodeReviewIds),n=(I=r==null?void 0:r.pages.flatMap(p=>{var C;return(C=p.items)!=null?C:[]}))!=null?I:[],i=n.filter(p=>!ot(p)),c=n.filter(p=>!!p.has_unread_turn),h=n.filter(p=>!!p.has_unread_turn||!ot(p)),u=Array.from(Object.values(a)).filter(p=>!n.some(C=>C.id===p)),k=Array.from(Object.values(d)).filter(p=>!n.some(C=>C.id===p)),m=[...u,...k],l=i.length+m.length,f=Q();return t.jsxs(Dt,{onOpenChange:s,children:[t.jsx(Bt,{asChild:!0,children:t.jsx(At,{"aria-label":f.formatMessage({id:"wham.notificationPopover.openNotifications",defaultMessage:"Open notifications"}),children:l===0?t.jsxs("div",{className:"relative",children:[c.length>0&&t.jsx("div",{className:"absolute start-0 top-0 size-1.5 rounded-full bg-blue-500"}),t.jsx(Ws,{})]}):t.jsx(me,{size:24,arcPercentage:e?1:.25,children:t.jsx("span",{className:"text-xs",children:l})})})}),t.jsx(Ot,{forceMount:!0,children:t.jsx(Vt,{isOpen:e,closePopover:()=>s(!1),popoverContentRef:o,align:"end",side:"bottom",sideOffset:8,alignOffset:-8,children:t.jsx(Vs,{pendingTaskIds:m,inProgressTasks:h,closePopover:()=>s(!1)})})})]})}export{Xs as N,Ds as W,ls as a,ws as g,gs as u};
//# sourceMappingURL=e96bwg1s7x4og2fp.js.map
