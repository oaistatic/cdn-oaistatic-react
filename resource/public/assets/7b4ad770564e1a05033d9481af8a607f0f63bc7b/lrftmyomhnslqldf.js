var q=Object.defineProperty,K=Object.defineProperties;var j=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var B=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var b=(r,t,e)=>t in r?q(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,c=(r,t)=>{for(var e in t||(t={}))B.call(t,e)&&b(r,e,t[e]);if(L)for(var e of L(t))G.call(t,e)&&b(r,e,t[e]);return r},k=(r,t)=>K(r,j(t));import{u as X,I as Y,nX as A,li as P,dL as I,dM as x,d6 as Z,nY as $,nZ as z}from"./kw08ajijqinojrwh.js";import{d as J,r as g,K as R}from"./kfrdmkli83ureki3.js";const Q=new Set(["google-oauth2","windowslive","apple"]),V="password";function p(){var t;return typeof window<"u"&&!!((t=window.location)!=null&&t.origin)?window.location.origin:window.location.origin}const ee=240;function M(r,t){return t!=null&&t.idp&&Q.has(t.idp)?c({connection:t.idp},t.email&&{login_hint:t.email}):(t==null?void 0:t.idp)==="auth0"?c({connection:V},t.email?{login_hint:t.email}:{[z]:"true"}):t!=null&&t.email?c({},t.email&&{login_hint:t.email}):{}}function w(r){if(!r)throw new Error("No session found, cannot enable MFA");if(r.authProvider==="mocked")throw new Error("Mock users can't enable MFA! Please setup Auth0 following the instructions in the README")}function v(r){try{return Z(r)}catch(t){throw new Error("Unable to decode access token")}}function te(r){return r.pwd_auth_time}function O(r){const t=te(r);if(!t)return!0;const e=t/1e3;return Date.now()/1e3-e>ee}function y(r){var t;return((t=r[$])==null?void 0:t.required)==="yes"}var re=(r=>(r.PushAuth="push_auth",r.Totp="totp",r.Sms="sms",r))(re||{}),ae=(r=>(r.Enable="enable",r.Disable="disable",r))(ae||{});function C(){const r=p(),t=new URL("/",r),e=I(x.Security).hash;return t.hash=e||"settings",t}function _(r){const t=C(),e=new URLSearchParams;return e.set("action","enable"),e.set("factor",r),t.search=e.toString(),t.toString()}function D(r){const t=C(),e=new URLSearchParams;return e.set("action","disable"),e.set("factor_id",r),t.search=e.toString(),t.toString()}function ce(r){var U,S;const t=X(),{session:e}=Y(t),m=J(),[T,i]=g.useState(!1),N=((U=e==null?void 0:e.user)==null?void 0:U.idp)==="auth0",H=!!((S=e==null?void 0:e.user)!=null&&S.mfa),o=g.useCallback(async(a,n=!1)=>{w(e);let l=!0;if(e!=null&&e.accessToken){const d=v(e.accessToken);l=O(d)||n&&!y(d)}return l?(i(!0),R.signIn(e==null?void 0:e.authProvider,{callbackUrl:a},c(c({max_age:"0"},A(P())),M(t,e==null?void 0:e.user))),!0):!1},[t,e]),W=g.useCallback(async(a="totp",n)=>{w(e),i(!0);const l=p();if(a==="totp"){if(!(n!=null&&n.native_modal)){const h=new URL("/auth/enroll_mfa",l);h.searchParams.set("factor",a),r.redirectUrl&&h.searchParams.set("redirect_path",r.redirectUrl);const E=h.toString();return await o(E)?!0:(window.location.href=E,i(!1),!1)}const s=_("totp");return await o(s)?!0:(i(!1),!1)}if(a==="passkey"){const s=new URL("/auth/enroll_mfa",l);s.searchParams.set("factor",a),r.redirectUrl&&s.searchParams.set("redirect_path",r.redirectUrl);const f=s.toString();return await o(f)?!0:(window.location.href=f,i(!1),!1)}if(a==="push_auth"){const s=_("push_auth");return await o(s)?!0:(i(!1),!1)}const d=_("sms");return await o(d)?!0:(i(!1),!1)},[e,r.redirectUrl,o]),F=g.useCallback(async(a="totp",n="")=>{if(w(e),a==="push_auth"||a==="sms"||a==="totp"){if(!n)throw new Error("Factor ID is required for MFA factor removal");const u=D(n);return await o(u,!0)?!0:(i(!1),!1)}if(a==="passkey"){if(!n)throw new Error("Factor ID is required for MFA factor removal");const u=new URL(D(n));return u.searchParams.set("factor","passkey"),await o(u.toString(),!0)?!0:(i(!1),!1)}const l=new URL("/auth/disable_mfa",p()).toString();let d=!0;if(e!=null&&e.accessToken){const u=v(e.accessToken);d=O(u)||!y(u)}return d?(R.signIn(e==null?void 0:e.authProvider,{callbackUrl:l},c(c({max_age:"0"},M(t,e==null?void 0:e.user)),A(P()))),!0):(m(k(c({},I(x.Security)),{pathname:"/",search:"disable_mfa=true"})),!1)},[t,e,m,o]);return{setupMfa:W,isUsernamePassword:N,isLoggedInWithMfa:H,removeMfa:F,isLoadingRedirect:T}}export{ae as M,re as a,ce as u};
//# sourceMappingURL=lrftmyomhnslqldf.js.map
