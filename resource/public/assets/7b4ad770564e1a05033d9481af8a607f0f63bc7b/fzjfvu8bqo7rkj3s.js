var j=Object.defineProperty,v=Object.defineProperties;var B=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var R=(o,t,s)=>t in o?j(o,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[t]=s,w=(o,t)=>{for(var s in t||(t={}))W.call(t,s)&&R(o,s,t[s]);if(y)for(var s of y(t))$.call(t,s)&&R(o,s,t[s]);return o},k=(o,t)=>v(o,B(t));import{y as J,h as K,d as Y,r as I,u as z,j as P,aa as M,e as Q}from"./kfrdmkli83ureki3.js";import{hY as u,u as Z,nG as X,p as V,nH as ee,l8 as te,R as h,hX as d,dY as ne,dZ as se,dJ as oe,dM as p,kv as ce,dL as ae,nI as N,_ as b,dW as U,nJ as re,aZ as ie}from"./kw08ajijqinojrwh.js";import{g as ue}from"./k9adsjcuzq0lnday.js";import{C as le}from"./fxythiulbb2q3qno.js";const _e={OAUTH_SCOPES_MISMATCH:u.OAUTH_FAILED_SCOPE_MISMATCH,EMAIL_DOMAIN_CLAIMED_BY_ANOTHER_WORKSPACE:u.OAUTH_FAILED_EMAIL_DOMAIN_ENFORCEMENT},L=Q({genericSuccess:{id:"connectorPlatformOauthRedirect.genericSuccess",defaultMessage:"{connector} is now connected"},slackAiAppSuccess:{id:"connectorPlatformOauthRedirect.slackAiAppSuccess",defaultMessage:"AI App for Slack is now installed"}}),Ce=J(function(){const t=K(),s=Z(),_=Y(),f=te("installations/select_target"),g=X(),H=V(),A=I.useRef(!1),{mutateAsync:D}=ee(),C=z();return I.useEffect(()=>{if(A.current===!0)return;A.current=!0;async function x(){var T,E,m,S;const O=ue()==="popup"||g,G=window.location.href;try{const e=await h.safePost("/aip/connectors/links/oauth/callback",{requestBody:{full_redirect_url:G}});if(await C.invalidateQueries({refetchType:"all",queryKey:["fetchConnectorLinkData"]}),!(e!=null&&e.post_auth_url)){_(d(u.OAUTH_FAILED_GENERIC));return}const n=new URL(e.post_auth_url,location.origin),r=((T=e==null?void 0:e.link)==null?void 0:T.connector_id)===ne[se.GITHUB_CONNECTOR],i=n.searchParams.get("github_onboarding")==="sync-repos";if(r&&i){const c=await h.safePost("/aip/connectors/github/search_repos",{requestBody:{query:"",limit:20,next_token:null,link_id:e.link.id}});if(!c||c.repos.length===0){window.open("".concat(f,"?state=").concat(encodeURIComponent(JSON.stringify({client_redirect_to:"".concat(window.location.origin,"/?github_onboarding=sync-repos")}))),"_self");return}}const l=oe(n.hash)===p.Connectors;if(!l){const c=ce[e.link.connector_id];c&&n.searchParams.set("add_source",c)}let a;if(l){const c=new URLSearchParams;c.set("connector",e.link.connector_id),r&&!i&&c.set("github_onboarding","configure-repos");const q=k(w({},n),{search:"",hash:ae(p.Connectors).hash+"?".concat(c.toString())});a=M(q)}else r&&!i&&n.searchParams.set("github_onboarding","configure-repos"),a=M({pathname:n.pathname,search:n.search,hash:n.hash});if(O){N({success:!0,connectorId:e.link.connector_id,linkId:e.link.id}),window.close();return}b.logEventWithStatsig("Connector OAuth Connect","chatgpt_connectors_oauth_connect_success",{success:!0,type:e.link.connector_id}),U.logOAuthCompleted({connector_id_metadata:U.createIdMetadataFromId(e.link.connector_id,"unknown_referrer"),referrer:"unknown_referrer",authType:"OAUTH",scopes:null,success:!0});const F=e.link.connector_id===re?t.formatMessage(L.slackAiAppSuccess):t.formatMessage(L.genericSuccess,{connector:e.link.name});_(d(u.CUSTOM_MSG,a,F))}catch(e){let n;try{const i=new URL(window.location.href),l=(E=i.searchParams.get("oauth_state_id"))!=null?E:i.searchParams.get("state");if(l){const a=await h.safeGet("/aip/connectors/links/oauth/state/{oauth_state_id}",{parameters:{path:{oauth_state_id:l}}});a!=null&&a.connector_id&&(n=a.connector_id)}}catch(i){}const r=e instanceof ie?(S=_e[(m=e.detail)==null?void 0:m.error_code])!=null?S:u.OAUTH_FAILED_GENERIC:u.OAUTH_FAILED_GENERIC;if(O){N({success:!1,connectorId:n!=null?n:"",errorType:r}),window.close();return}b.logEventWithStatsig("Connector OAuth Connect","chatgpt_connectors_oauth_connect_error",{errorType:r,success:!1,type:n!=null?n:"unknown"}),_(d(r,"#settings/".concat(p.Connectors)))}}x()},[s,g,f,t,_,H,D,C]),P.jsx("div",{className:"flex h-screen w-screen items-center justify-center",children:P.jsx(le,{size:36})})});export{Ce as default};
//# sourceMappingURL=fzjfvu8bqo7rkj3s.js.map
