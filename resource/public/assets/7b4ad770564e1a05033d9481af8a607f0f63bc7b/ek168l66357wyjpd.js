import{a9 as R,j as a,ag as T,h as U,d as E,u as B,i as D,l as O,M as v,y as $}from"./kfrdmkli83ureki3.js";import{N as I}from"./bri823nczhk5gr7r.js";import{p as L,e6 as q}from"./kw08ajijqinojrwh.js";import{e5 as z}from"./fyw02vlaiv2vq6cj.js";import{W as Q}from"./e1cxccp3u9us8gn7.js";import{R as G,I as c,S as M}from"./oaj1k9dxyi6fkrjm.js";import{E as H,R as J,g as K}from"./d9bxd3xb206ltjqo.js";import{u as X}from"./fx0u8y75z4qg1qfs.js";import{c as Y,W as Z,d as V,w as ee,a as te,f as ae}from"./oyvo09ze11a90qsd.js";import"./mxzgpx7wtm4zk5cj.js";import"./cn1z5fx9l5xxo8vy.js";import"./lg0oi3tmjv8kv2p4.js";import"./b3ungmqo5x8kj4fh.js";import"./i8h8r8n4rn16l2h5.js";import"./n6eim64jp78x17ti.js";import"./d24clsve229czwkp.js";import"./f1g778pkk2fhpy9x.js";import"./goxcf7vc701q04ob.js";import"./c326bjybavj646xd.js";import"./lwyag88acem9bm0o.js";import"./o5h7u1aikohecbkt.js";import"./w4rmhhxvug61xnae.js";import"./dd8hh2tmra1psngf.js";import"./e96bwg1s7x4og2fp.js";import"./fxythiulbb2q3qno.js";import"./fux1oumbpb3w9e7e.js";import"./lafhvalu919ojf7s.js";import"./jz5yvmwm8tdb0l95.js";import"./dd7t8zwhwdzcugxd.js";import"./lucy2aoyk10158lx.js";import"./ds50f4rqnruk5v5l.js";import"./lptwpbjabrvjmhsj.js";import"./abvgi6h30lz61l9g.js";import"./m62qdunuxxal8u8x.js";import"./pbjg7z6w7wj6b69y.js";import"./edhlcmww46h398kf.js";import"./g8cpkydknwwj989v.js";import"./mgt4kmm4im6a7le7.js";import"./ipjj058rvhjq2uu2.js";import"./h1em0bjkpkjv8ykw.js";import"./esgn9c4esm3mlqc4.js";import"./ab1440qk9vnud23e.js";import"./dm8z7bzkrzic0zmg.js";import"./hu1bt0oauegdhua6.js";function se(){const{environmentId:s}=R(),{eligible:r}=z();return r?a.jsx(T,{to:"/codex"}):s?a.jsx(re,{environmentId:s}):a.jsx(I,{})}function re({environmentId:s}){var u,l,h,_,f,g,S;const r=U(),i=L(),b=E(),d=B(),{data:e,isLoading:N,isError:C}=Y(s),p=(u=e==null?void 0:e.secrets)!=null?u:{},k=X()?"workspace":"private",{mutate:A,isPending:x}=D({mutationFn:t=>Z.updateEnvironment(s,t),onSuccess:async t=>{await te(d,s),ae(d,s,t),i.success(r.formatMessage({id:"wham.editEnvironment.environmentUpdatedSuccessfully",defaultMessage:"Environment updated successfully"})),b("/codex/settings/environment/".concat(s))},onError:t=>{if(t instanceof V){ee(t,"wham_edit_environment_".concat(s),r,i);return}i.danger(O({id:"wham.editEnvironment.failedToUpdateEnvironment",defaultMessage:"Failed to update environment"}),{toastId:"wham_edit_environment_failed_to_update_environment"})}});function F(t){var j,w;const n=K(t.secrets,p),W=t.envVars.reduce((o,y)=>(o[y.key]=y.value,o),{}),m=(w=(j=t.share_targets)==null?void 0:j.map(o=>o.trim()))==null?void 0:w.filter(Boolean),P=t.share_settings==="private"?[]:m==null?void 0:m.map(o=>({email:o,permission:"editor",type:"user"}));A({etag:e==null?void 0:e.etag,label:t.label,repos:[t.repositoryId],machine_id:t.machine,setup:t.setupCommands,maintenance_setup:t.maintenanceSetupCommands,workspace_dir:t.workspaceDirectory,agent_network_access:t.agentNetworkAccess,description:t.description,share_settings:t.share_settings,share_targets:P,secrets:n,env_vars:W,auto_setup_settings:t.autoSetupSettings,cache_settings:t.cacheSettings})}return a.jsx(Q,{flex:!0,hideBorder:!0,showSidebar:!1,maxWidth:"w-full",children:N?a.jsx("div",{className:"flex h-full items-center justify-center",children:a.jsx(q,{})}):C?a.jsx("div",{className:"flex h-full items-center justify-center",children:a.jsx(v,{id:"wham.editEnvironment.errorLoadingEnvironment",defaultMessage:"Error loading environment"})}):e?a.jsxs(a.Fragment,{children:[a.jsxs(G,{className:"sticky top-0 px-4",children:[a.jsx(c,{label:r.formatMessage({id:"wham.editEnvironment.environments",defaultMessage:"Environments"}),url:"/codex/settings/environments",className:"text-token-text-tertiary"}),a.jsx(M,{}),a.jsx(c,{label:e.label,url:"/codex/settings/environment/".concat(s),className:"font-medium"}),a.jsx(M,{}),a.jsx(c,{label:r.formatMessage({id:"wham.editEnvironment.edit",defaultMessage:"edit"}),className:"text-token-text-tertiary"})]}),a.jsx(H,{initialEnvironmentId:s,existingEnvironment:e,initialValues:{label:e==null?void 0:e.label,description:(l=e==null?void 0:e.description)!=null?l:"",share_settings:(h=e==null?void 0:e.share_settings)!=null?h:k,share_targets:(f=(_=e==null?void 0:e.share_targets)==null?void 0:_.map(t=>t.email))!=null?f:[],machine:e==null?void 0:e.machine_id,repositoryId:e==null?void 0:e.repos[0],workspaceDirectory:(g=e==null?void 0:e.workspace_dir)!=null?g:"",agentNetworkAccess:e==null?void 0:e.agent_network_access,setupCommands:e!=null&&e.setup?Array.isArray(e==null?void 0:e.setup)?e.setup.join("\n"):e.setup:"",maintenanceSetupCommands:e!=null&&e.maintenance_setup?Array.isArray(e==null?void 0:e.maintenance_setup)?e.maintenance_setup.join("\n"):e.maintenance_setup:"",envVars:Object.entries((S=e==null?void 0:e.env_vars)!=null?S:{}).map(([t,n])=>({key:t,value:n})),secrets:Object.keys(p).map(t=>({key:t,value:J,isEditing:!1})),autoSetupSettings:e==null?void 0:e.auto_setup_settings,cacheSettings:e==null?void 0:e.cache_settings},primaryButtonText:r.formatMessage({id:"wham.editEnvironment.saveEnvironment",defaultMessage:"Save environment"}),onSubmit:F,isPending:x})]}):a.jsx("div",{className:"flex h-full items-center justify-center",children:a.jsx(v,{id:"wham.editEnvironment.environmentNotFound",defaultMessage:"Environment not found"})})})}const Xe=()=>[{title:"Codex"}],Ye=$(function(){return a.jsx(se,{})});export{Ye as default,Xe as meta};
//# sourceMappingURL=ek168l66357wyjpd.js.map
