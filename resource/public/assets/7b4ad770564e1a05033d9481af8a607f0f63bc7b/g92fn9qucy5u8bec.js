const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/iz35nlf95x4k1pcg.js","assets/kfrdmkli83ureki3.js","assets/lgxlo3og8rhkp8l0.js","assets/fyw02vlaiv2vq6cj.js","assets/kw08ajijqinojrwh.js","assets/root-fi49nzd2.css","assets/conversation-small-lq38g8zw.css","assets/gn0yr6ivpbm62r9h.js"])))=>i.map(i=>d[i]);
var Ce=Object.defineProperty,be=Object.defineProperties;var we=Object.getOwnPropertyDescriptors;var ne=Object.getOwnPropertySymbols;var Se=Object.prototype.hasOwnProperty,_e=Object.prototype.propertyIsEnumerable;var se=(t,n,o)=>n in t?Ce(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,$=(t,n)=>{for(var o in n||(n={}))Se.call(n,o)&&se(t,o,n[o]);if(ne)for(var o of ne(n))_e.call(n,o)&&se(t,o,n[o]);return t},O=(t,n)=>be(t,we(n));import{r as d,j as e,g as ke,h as Ne,_ as V}from"./kfrdmkli83ureki3.js";import q from"./glgf3sl2j4mvtn59.js";import{e9 as Ee,co as J,V as X,O as Z,fd as Ie,e6 as ie,az as A,aC as re,eG as De,aA as L,dR as ce,d_ as le,cy as de,ax as Te}from"./kw08ajijqinojrwh.js";import{n1 as $e,n2 as Oe,n3 as Ve,gE as N,n4 as Ae,gD as Le,n5 as ue,n6 as U}from"./fyw02vlaiv2vq6cj.js";import{u as Pe,g as Re}from"./nm8ilf9kbsyolp9f.js";import{g as Fe}from"./i14budb41qztmmxp.js";import{u as ze}from"./do0kdqk6x0fa68qx.js";import{r as Be}from"./f86yt77iw8uocdb0.js";import{M as We}from"./m3joncw451cqbul2.js";import"./bxgk09qvxvkate6l.js";import"./dv0dvaedamxrvk5u.js";import"./iiok29s29bpdre61.js";import"./0gm9vowjt2kwou85.js";import"./gy1lpvuoewmzh42c.js";import"./ipjj058rvhjq2uu2.js";import"./h1em0bjkpkjv8ykw.js";import"./kbj1b07s2z6vxqkg.js";import"./hu1bt0oauegdhua6.js";const Ue=t=>t>=1e3?"".concat((t/1e3).toFixed(2),"s"):"".concat(t.toFixed(0),"ms");function Qe(t,n){const o={},i=(s,c="")=>{Object.entries(s).forEach(([h,g])=>{const u=c?"".concat(c,".").concat(h):h;g&&typeof g=="object"&&!Array.isArray(g)?i(g,u):g&&(typeof g=="number"||typeof g=="string"||g==null)&&(o[u]=g)})};i(t);const r={},l=s=>r[s]||(r[s]={}),f=s=>{if(s!=null){if(typeof s=="number")return s;if(typeof s=="string")return new Date(s).getTime()}};Object.keys(o).forEach(s=>{const c=o[s];if(c==null)return;const h=s.split(".").pop(),g=[[/^(.*)_start_time$/,"start",u=>u[1]],[/^(.*)_end_time$/,"end",u=>u[1]],[/^(.*)_sent_time$/,"start",u=>u[1]],[/^(.*)_success_time$/,"end",u=>u[1]],[/^(.*)_time$/,"start",u=>u[1]]];for(const[u,w,M]of g){const C=h.match(u);if(C){const j=M(C),I=l(j);I[w]=f(c);break}}});const m=[];Object.entries(r).forEach(([s,{start:c,end:h}])=>{c!==void 0&&h!==void 0?m.push({name:s,start:c,end:h,duration:h-c}):c!==void 0&&m.push({name:s,start:c,end:c,duration:0,noEnd:!0})});let x=m;if(n&&n.length){const s=new Set(n);x=x.filter(c=>s.has(c.name))}return x.sort((s,c)=>s.start-c.start||s.name.localeCompare(c.name)),x}const oe=["text-blue-400","text-green-400","text-purple-400","text-orange-400","text-red-400","text-pink-400","text-yellow-400","text-gray-500","text-blue-300","text-green-300"],qe=({json:t,focusNames:n,width:o,barHeight:i=18,rowGap:r=6,paddingX:l=50,paddingTop:f=20})=>{const m=d.useRef(null),[x,s]=d.useState(o||600);Ee(()=>{if(!o){const a=()=>{if(m.current){const p=m.current.clientWidth;s(Math.max(300,p))}};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)}},[o]);const c=d.useMemo(()=>Qe(t,n),[t,n]),[h,g]=d.useState({}),u=d.useCallback(a=>h[a]!==!1,[h]),w=d.useCallback(a=>g(p=>O($({},p),{[a]:p[a]===!1})),[]),M=d.useMemo(()=>c.filter(a=>u(a.name)),[c,u]),C=M.length>0,j=C?Math.min(...M.map(a=>a.start)):0,I=C?Math.max(...M.map(a=>a.end)):1,_=Math.max(I-j,1),S=f+c.length*(i+r)+r+32,xe=(c.length?Math.max(...c.map(a=>a.name.length)):0)*7+16+16,P=Math.max(l,xe),fe=l,B=(x-P-fe)/_,[pe,K]=d.useState(null),[R,H]=d.useState({visible:!1,x:0,y:0,lines:[]}),ee=(a,p)=>{if(!m.current)return;const v=m.current.getBoundingClientRect(),y=p.clientX-v.left,F=p.clientY-v.top,D=(a.start-j).toFixed(2),T=a.noEnd?void 0:(a.end-j).toFixed(2),W=T?["start: ".concat(D," ms"),"end: ".concat(T," ms"),"dur: ".concat(a.duration.toFixed(2)," ms")]:["start: ".concat(D," ms")];H({visible:!0,x:y+10,y:F+10,lines:W})},he=()=>H(a=>O($({},a),{visible:!1})),ge=d.useMemo(()=>{if(!C)return[0,_];const a=new Set;M.forEach(v=>{a.add(v.start-j),a.add(v.end-j)});const p=Array.from(a).sort((v,y)=>v-y);return p[0]!==0&&p.unshift(0),p[p.length-1]!==_&&p.push(_),p},[M,j,_,C]);return e.jsxs("div",{ref:m,className:"relative w-full",style:o?{width:"".concat(o,"px")}:void 0,children:[e.jsxs("svg",{width:x,height:S,className:"font-sans",children:[c.map((a,p)=>{const v=f+p*(i+r),y=u(a.name)?P+(a.start-j)*B:0,F=u(a.name)?Math.max(a.duration*B,1):0,D=oe[p%oe.length],T=pe===p?"opacity-80":"opacity-100",W=a.duration===0,te=!!a.noEnd,ve=k=>{u(a.name)&&(K(p),ee(a,k))},je=k=>{u(a.name)&&ee(a,k)},ye=()=>{K(null),he()};return e.jsxs("g",{onMouseEnter:ve,onMouseMove:je,onMouseLeave:ye,children:[e.jsx("foreignObject",{x:0,y:v,width:P-8,height:i,requiredExtensions:"http://www.w3.org/1999/xhtml",children:e.jsx("div",{className:"pointer-events-auto box-border flex h-full items-center justify-end gap-1 pe-1 text-[12px] text-neutral-900 select-none",children:e.jsxs("label",{className:"flex cursor-default items-center gap-1",children:[e.jsx("input",{type:"checkbox",checked:u(a.name),onChange:()=>w(a.name),className:"cursor-pointer"}),e.jsx("span",{children:a.name})]})})}),u(a.name)&&(te?(()=>{const k=v+i/2,z=i*.6/2,Me=["".concat(y,",").concat(k-z),"".concat(y+z,",").concat(k),"".concat(y,",").concat(k+z),"".concat(y-z,",").concat(k)].join(" ");return e.jsx("polygon",{points:Me,fill:"currentColor",className:"".concat(D," ").concat(T)})})():W?e.jsx("line",{x1:y,x2:y,y1:v,y2:v+i,stroke:"currentColor",strokeWidth:2,className:D}):e.jsx("rect",{x:y,y:v,width:F,height:i,fill:"currentColor",className:"".concat(D," ").concat(T)})),u(a.name)&&e.jsxs("text",{x:y+(te?i*.6:F)+4,y:v+i/2+4,fill:"currentColor",className:"text-xs text-neutral-700",children:[a.duration.toFixed(2)," ms"]})]},a.name)}),ge.map(a=>{const p=P+a*B;return e.jsx("line",{x1:p,x2:p,y1:f-3,y2:S-32,stroke:"currentColor",strokeWidth:1,className:"text-gray-200"},a)}),e.jsx("text",{x:x/2,y:S-6,textAnchor:"middle",fill:"currentColor",className:"text-xs text-neutral-600",children:"Time since first event (ms)"})]}),R.visible&&e.jsx("div",{className:"pointer-events-none absolute z-10 rounded bg-black/90 px-1.5 py-1 font-mono text-xs whitespace-nowrap text-white",style:{left:R.x,top:R.y},children:R.lines.map((a,p)=>e.jsx("div",{children:a},p))})]})};var Q,ae;function Ge(){if(ae)return Q;ae=1;var t=Be(),n=$e(),o=t(function(i,r,l){return i+(l?" ":"")+n(r)});return Q=o,Q}var Ye=Ge();const Je=ke(Ye),Xe=A(()=>V(()=>import("./iz35nlf95x4k1pcg.js"),__vite__mapDeps([0,1])),{loading:t=>L(t)});function Ze({conversationId:t}){var l;const n=J(t),o=(l=X.getCurrentNode(Z(t)))==null?void 0:l.id,i=Oe();return Ve()?e.jsx(E,{conversationId:n!=null?n:t,parentMessageId:o,status:i}):null}function E(t){var s;const n=(s=t==null?void 0:t.status)==null?void 0:s.modes,[o,i]=d.useState(!1),[r,l]=d.useState(),f=d.useCallback(c=>{l(c),i(!0)},[]),m=Ne(),x=d.useCallback(()=>i(!1),[]);return e.jsxs(e.Fragment,{children:[e.jsx(Ie,{contentAlign:"center",triggerButton:e.jsx(E.Trigger,{}),children:n?n.map(c=>d.createElement(E.Item,O($({},t),{key:c.display_name,voiceStatusMode:c,onShowModal:f}))):e.jsx("div",{role:"progressbar","aria-valuetext":m.formatMessage({defaultMessage:"Loading voice modes",id:"voiceModeButton.loadingModes"}),"aria-busy":"true","aria-live":"assertive","aria-valuemin":0,"aria-valuemax":100,children:e.jsx(ie,{"aria-hidden":"true",className:"my-4 min-w-full"})})}),e.jsx(E.Modal,{conversationId:t.conversationId,disabledModeMetadata:r,isOpen:o,onClose:x})]})}E.Modal=function(n){var l,f,m,x;const o=(f=(l=n.disabledModeMetadata)==null?void 0:l.buttons)!=null?f:[],i=ze({buttons:o,conversationId:n.conversationId,onClick:n.onClose}),r=e.jsx(We,{children:(m=n.disabledModeMetadata)==null?void 0:m.description_markdown});return e.jsx(re,{testId:"modal-voice-mode",title:(x=n.disabledModeMetadata)==null?void 0:x.title,description:r,isOpen:n.isOpen,onClose:n.onClose,type:"success",primaryButton:i.primary,secondaryButton:i.secondary})};E.Trigger=d.forwardRef(function(n,o){var r;const i=N(l=>l.voiceMode);return e.jsxs(Ae,O($({ref:o},n),{children:[(r=Je(i))!=null?r:e.jsx(ie,{}),e.jsx(Xe,{className:"icon text-token-text-tertiary"})]}))});E.Item=function({conversationId:n,parentMessageId:o,voiceStatusMode:i,onShowModal:r}){const{disabled_mode_metadata:l,mode:f}=i,{startVoiceMode:m}=Pe(),x=J(n),s=d.useCallback(async()=>{l?r(l.disabled_message):m(Re({serverThreadId:x,parentMessageId:o,isAdvancedMode:f==="advanced"&&!l,eventSource:"voice_mode_picker",clientThreadId:n,gizmoId:X.getGizmoId(Z(n)),skipCacheReason:"debug-button-clicked"}))},[n,l,f,r,o,x,m]);return e.jsx(De.Item,{onClick:s,children:e.jsxs("div",{children:[i.display_name,e.jsx("div",{className:"text-token-text-tertiary text-xs",children:i.description})]})})};const Ke=A(()=>V(()=>import("./lgxlo3og8rhkp8l0.js"),__vite__mapDeps([2,1])),{loading:t=>L(t)}),He=A(()=>V(()=>import("./fyw02vlaiv2vq6cj.js").then(t=>t.zH),__vite__mapDeps([3,1,4,5,6])),{loading:t=>L(t)}),G=A(()=>V(()=>import("./fyw02vlaiv2vq6cj.js").then(t=>t.zE),__vite__mapDeps([3,1,4,5,6])),{loading:t=>L(t)}),et=A(()=>V(()=>import("./gn0yr6ivpbm62r9h.js"),__vite__mapDeps([7,1])),{loading:t=>L(t)});function Et({conversationId:t}){const n=N(i=>i.voiceSessionId),o=N(i=>{const{sessionCreateTime:r,sessionConnectedTime:l}=i.metrics;return r&&l?l.getTime()-r.getTime():null});return e.jsx("div",{className:"relative h-full",children:e.jsx(ce.div,{className:"border-s-token-sidebar-surface-secondary bg-token-main-surface-secondary absolute hidden h-full max-w-[500px] overflow-y-auto rounded-xl border-s pt-4 shadow-inner md:block",initial:{opacity:0,x:520,width:"0px"},animate:{opacity:1,x:0,width:"500px",left:"-520px"},exit:{opacity:0,x:520,width:"0px",left:"0px"},transition:{type:"tween"},children:e.jsx(le,{children:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex w-full items-center justify-center",children:e.jsx(Ze,{conversationId:t})}),e.jsxs("div",{className:"p-4 py-2 text-sm",children:[e.jsx(b,{name:"Voice Session ID",text:n!=null?n:"n/a"}),e.jsx(tt,{conversationId:t}),e.jsx(b,{name:"Connect Latency",text:o!==null?Ue(o):"n/a"}),e.jsx(nt,{})]}),e.jsxs("div",{className:"flex h-full w-full flex-col flex-nowrap gap-4",children:[e.jsx("div",{className:"px-4",children:e.jsxs("div",{className:"flex flex-col flex-nowrap gap-4",children:[e.jsx(st,{}),e.jsx(ot,{})]})}),!1]})]})})})})}function tt({conversationId:t}){var c,h,g;const n=J(t),o=n&&Z(n),i=X.getTree(o),r=N(u=>u.server.messages.findLast(w=>w.type===ue.ConversationUpdate)),l=r==null?void 0:r.payload.parent_message_id,f=l?i.findNode(u=>u.message.author.role==="assistant"&&Te.isMultimodalTextMessage(u.message),l):void 0,{model_definition_slug:m,model_definition_virtual_model_id:x}=(h=(c=f==null?void 0:f.message.metadata)==null?void 0:c.__internal)!=null?h:{},s=(g=[m,x].filter(Boolean).join(", "))!=null?g:"pending model response";return e.jsx(b,{name:"Model ID",text:s,allowWrap:!0})}function nt(){const[t,n]=d.useState(!1),[o,i]=d.useState({}),r=Le(),l=d.useCallback(()=>{n(f=>!f)},[]);return d.useEffect(()=>{t&&Fe(r).then(i)},[t,r]),e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"cursor-pointer font-semibold text-blue-500 hover:underline dark:text-blue-300",onClick:l,children:t?"Hide Client Metrics Chart":"Show Client Metrics Chart"}),e.jsxs(re,{testId:"modal-client-metrics",title:"Client Metrics",isOpen:t,onClose:()=>n(!1),size:"fullscreen",showCloseButton:!0,children:[e.jsx(qe,{json:o}),e.jsx("pre",{className:"bg-token-bg-tertiary text-token-text-secondary m-4 overflow-x-auto rounded-md p-2 text-[10px] font-semibold",children:JSON.stringify(o,null,2)})]})]})}function st(){const[t,n]=d.useState("timestamp"),[o,i]=d.useState("asc"),r=N(s=>s.server.messages.filter(c=>c.type===ue.Performance)),l=r[r.length-1],f=d.useCallback(s=>s>=1e3?"".concat((s/1e3).toFixed(2),"s"):"".concat(s.toFixed(1),"ms"),[]),m=d.useMemo(()=>l?[...l.payload.metrics].sort((s,c)=>{const h=t==="name"?s.name.localeCompare(c.name):s.ms-c.ms;return o==="asc"?h:-h}):[],[l,t,o]),x=s=>{s===t?i(o==="asc"?"desc":"asc"):(n(s),i("asc"))};return e.jsx(me,{title:"Performance",open:!1,children:l?e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsxs("div",{className:"flex flex-row items-center",children:[e.jsx(Y,{text:"Metric"}),t==="name"?o==="asc"?e.jsx(q,{}):e.jsx(G,{}):null]}),e.jsxs("div",{className:"flex cursor-pointer flex-row items-center",onClick:()=>x("timestamp"),children:[e.jsx(Y,{text:"Timestamp"}),t==="timestamp"?o==="asc"?e.jsx(q,{}):e.jsx(G,{}):null]}),m.map(s=>e.jsxs(e.Fragment,{children:[e.jsx("span",{title:s.name,className:"line-clamp-1 block min-w-0 truncate text-sm",children:s.name},s.name),e.jsx("span",{className:"bg-token-main-surface-tertiary line-clamp-1 rounded-lg p-0.5 px-1 font-mono text-xs",children:f(s.ms)},s.name+s.ms)]}))]}):null})}function ot(){var m,x;const t=N(s=>s.server.connectionState),n=N(s=>s.dev.room),[o,i]=d.useState("Unknown"),r=n==null?void 0:n.localParticipant,l=(m=n==null?void 0:n.numParticipants)!=null?m:"Unknown",f=(x=n==null?void 0:n.activeSpeakers)!=null?x:[];return d.useEffect(()=>{if(r){const s=c=>{i(c)};return r.on("connectionQualityChanged",s),()=>{r.off("connectionQualityChanged",s)}}},[r]),e.jsxs(me,{title:"Room",open:!1,children:[e.jsx(b,{name:"Connection Quality",text:String(o)}),e.jsx(b,{name:"Connection State",text:String(t)}),e.jsx(b,{name:"Participants",text:l}),e.jsx(b,{name:"Speakers",text:f.length}),e.jsx(at,{})]})}function at(){const t=N(c=>c.dev.room),[n,o]=d.useState(null),[i,r]=d.useState(null),[l,f]=d.useState(null),m=t==null?void 0:t.getActiveDevice("audioinput"),x=t==null?void 0:t.getActiveDevice("audiooutput"),s=t==null?void 0:t.getActiveDevice("videoinput");return d.useEffect(()=>{async function c(){var j,I,_;const h=await U.getLocalDevices("audioinput"),g=await U.getLocalDevices("audiooutput"),u=await U.getLocalDevices("videoinput"),w=h.find(S=>S.deviceId===m),M=g.find(S=>S.deviceId===x),C=u.find(S=>S.deviceId===s);o((j=w==null?void 0:w.label)!=null?j:"Unknown"),r((I=M==null?void 0:M.label)!=null?I:"Unknown"),f((_=C==null?void 0:C.label)!=null?_:null)}c()},[m,x,s]),e.jsxs(e.Fragment,{children:[e.jsx(Y,{text:"Devices"}),l?e.jsx(b,{icon:et,name:"Video Input",text:l}):null,e.jsx(b,{icon:He,name:"Audio Input",text:n!=null?n:"Unknown"}),e.jsx(b,{icon:Ke,name:"Audio Output",text:i!=null?i:"Unknown"})]})}function me({title:t,titleClassName:n,children:o,open:i}){const[r,l]=d.useState(i!=null?i:!0);return e.jsxs("div",{children:[e.jsxs("h3",{className:de("text-token-text-secondary flex cursor-pointer items-center py-2 text-lg font-semibold",n),onClick:()=>l(!r),children:[e.jsx("span",{children:t}),e.jsx("span",{className:"ms-2",children:r?e.jsx(G,{className:"icon-sm"}):e.jsx(q,{className:"icon-sm"})})]}),e.jsx(le,{initial:!1,children:r&&e.jsx(ce.div,{initial:"collapsed",animate:"open",exit:"collapsed",variants:{open:{height:"auto",opacity:1},collapsed:{height:0,opacity:0}},transition:{duration:.3,ease:"easeInOut"},layout:!0,children:o},"content")})]})}function Y({text:t}){return e.jsx("h4",{className:"py-2 text-sm font-semibold",children:t})}function b(t){var n;return e.jsxs("div",{className:"flex flex-row flex-nowrap items-center gap-2",children:[e.jsx("span",{className:"opacity-85",children:t.icon?e.jsx(t.icon,{className:"h-[0.75rem] w-[0.75rem]"}):e.jsxs("span",{className:"text-sm",children:[t.name,":"]})}),(n=t.content)!=null?n:e.jsx("span",{className:de(["bg-token-main-surface-tertiary rounded-lg p-0.5 px-1 font-mono text-xs",!t.allowWrap&&"line-clamp-1"]),children:t.text})]})}export{nt as ClientMetrics,st as PerformanceStats,b as Stat,Et as VoiceModeDevPanel};
//# sourceMappingURL=g92fn9qucy5u8bec.js.map
