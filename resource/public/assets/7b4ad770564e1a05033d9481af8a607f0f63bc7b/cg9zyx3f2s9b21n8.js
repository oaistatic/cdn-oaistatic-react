const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/cklkb8csuv59azob.js","assets/kfrdmkli83ureki3.js"])))=>i.map(i=>d[i]);
var Ne=Object.defineProperty,Ae=Object.defineProperties;var Te=Object.getOwnPropertyDescriptors;var pe=Object.getOwnPropertySymbols;var Le=Object.prototype.hasOwnProperty,Pe=Object.prototype.propertyIsEnumerable;var ye=a=>{throw TypeError(a)};var ve=(a,e,t)=>e in a?Ne(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,I=(a,e)=>{for(var t in e||(e={}))Le.call(e,t)&&ve(a,t,e[t]);if(pe)for(var t of pe(e))Pe.call(e,t)&&ve(a,t,e[t]);return a},J=(a,e)=>Ae(a,Te(e));var xe=(a,e,t)=>e.has(a)||ye("Cannot "+t);var M=(a,e,t)=>(xe(a,e,"read from private field"),t?t.call(a):e.get(a)),W=(a,e,t)=>e.has(a)?ye("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(a):e.set(a,t),O=(a,e,t,s)=>(xe(a,e,"write to private field"),s?s.call(a,t):e.set(a,t),t);import{h as se,j as c,M as Ie,c as Y,g as he,b as me,_ as Re,u as Se,r as B}from"./kfrdmkli83ureki3.js";import{cy as qe,W as Z,b7 as ee,az as De,aA as Ue,p as Ce,dT as Be,dk as $e,fd as Ge,aC as We,db as be,m_ as Oe,vb as He,bG as ze,h7 as Ve}from"./kw08ajijqinojrwh.js";import{y as Qe,x as Ke,J as H}from"./fyw02vlaiv2vq6cj.js";import{r as Ye}from"./l58qw9nc0ur9qkul.js";import{r as Je}from"./fbnp4n11buhgth4v.js";const Xe={new:{id:"aardvark.status.new",defaultMessage:"New",description:"New status"},triaged:{id:"aardvark.status.triaged",defaultMessage:"Triaged",description:"Triaged status"},in_progress:{id:"aardvark.status.inProgress",defaultMessage:"In progress",description:"In progress status"},fixed:{id:"aardvark.status.fixed",defaultMessage:"Fixed",description:"Fixed status"},wontfix:{id:"aardvark.status.wontfix",defaultMessage:"Won't fix",description:"Won't fix status"},duplicate:{id:"aardvark.status.duplicate",defaultMessage:"Duplicate",description:"Duplicate status"}},Ze={critical:{id:"aardvark.crit.critical",defaultMessage:"Critical",description:"Critical severity"},high:{id:"aardvark.crit.high",defaultMessage:"High",description:"High severity"},medium:{id:"aardvark.crit.medium",defaultMessage:"Medium",description:"Medium severity"},low:{id:"aardvark.crit.low",defaultMessage:"Low",description:"Low severity"}},et={none:{id:"aardvark.assignee.none",defaultMessage:"None",description:"None assignee option label"}},we={search:{id:"aardvark.filter.assignee.search",defaultMessage:"Search by name or email",description:"Search assignees by name or email"}},St={success:{id:"aardvark.proposedPatch.generation.validation.success",defaultMessage:"Success",description:"Badge label indicating the patch generation or validation is successful."},failed:{id:"aardvark.proposedPatch.generation.validation.failed",defaultMessage:"Failed",description:"Badge label indicating the patch generation or validation is failed."},pending:{id:"aardvark.proposedPatch.generation.validation.pending",defaultMessage:"Pending",description:"Badge label indicating the patch generation or validation is pending."},running:{id:"aardvark.proposedPatch.generation.validation.running",defaultMessage:"Running",description:"Badge label indicating the patch generation or validation is running."},unknown:{id:"aardvark.proposedPatch.generation.validation.unknown",defaultMessage:"Unknown",description:"Badge label indicating the patch generation or validation is unknown."}},Ct={security:{id:"aardvark.finding.signal.security",defaultMessage:"Security",description:"Security signal"},privacy:{id:"aardvark.finding.signal.privacy",defaultMessage:"Privacy",description:"Privacy signal"},validated:{id:"aardvark.finding.signal.validated",defaultMessage:"Validated",description:"Validated signal"},patch:{id:"aardvark.finding.signal.patch",defaultMessage:"Patch generated",description:"Short chip label used in the findings list under the Vulnerability column and in the metadata Signals section to show that Aardvark generated a proposed patch for this finding. Audience: security reviewers scanning dense tables, so the label must stay a single short word with no punctuation. When present, it indicates has_patch=true; when absent, no patch is available."}},Et={committedHeader:{id:"aardvark.table.committedHeader",defaultMessage:"Committed",description:"Committed header"},detectedHeader:{id:"aardvark.table.detectedHeader",defaultMessage:"Detected",description:"Detected header"}},Ee={statusUpdate:{id:"aardvark.toast.statusError",defaultMessage:"Failed to update status: {details}",description:"Toast message shown when updating a finding's status fails"},assigneeUpdate:{id:"aardvark.toast.assigneeError",defaultMessage:"Failed to update assignee: {details}",description:"Toast message shown when updating the assignee fails"},scanSettingsSave:{id:"aardvark.toast.scanSettingsError",defaultMessage:"Failed to save scan settings: {details}",description:"Toast shown when saving scan settings fails"},findingsLoad:{id:"aardvark.toast.findingsLoadError",defaultMessage:"Failed to load findings: {details}",description:"Toast shown when the findings table fails to load"},recommendedLoad:{id:"aardvark.toast.recommendedLoadError",defaultMessage:"Failed to load recommended findings: {details}",description:"Toast shown when the recommended list fails to load"},findingLoad:{id:"aardvark.toast.findingLoadError",defaultMessage:"Failed to load finding: {details}",description:"Toast shown when the finding details page fails to load"},scanConfigLoad:{id:"aardvark.toast.scanConfigLoadError",defaultMessage:"Failed to load scan configurations: {details}",description:"Toast shown when scan configurations cannot be retrieved"},githubConnection:{id:"aardvark.toast.githubConnectionError",defaultMessage:"GitHub connection error",description:"Toast shown when the GitHub connector fails to load"},githubConnectionInline:{id:"aardvark.home.connectGithub.error",defaultMessage:"We're having trouble connecting to GitHub right now. See console for full error details.",description:"Inline message shown on the Connect GitHub card when the connector is down"},recommendedMissingScan:{id:"aardvark.recommended.missingScan",defaultMessage:"We couldn't find a configured scan for the selected repository.",description:"Inline error shown when no configured scan exists for the selected repo"},recommendedMissingScanToast:{id:"aardvark.recommended.missingScan.toast",defaultMessage:"We couldn't find a configured scan for the selected repository.",description:"Toast shown when no configured scan exists for the selected repo"},findingNotFound:{id:"aardvark.finding.details.notFound",defaultMessage:"Finding not found",description:"Message shown when the finding details page fails to load because the finding ID is invalid"}};function jt(){const a=se();return c.jsx("a",{href:"https://forms.gle/arrj4MzLN1YqdR8S6",target:"_blank",rel:"noopener noreferrer","aria-label":a.formatMessage({id:"aardvark.feedback.cta",defaultMessage:"Feedback survey"}),title:a.formatMessage({id:"aardvark.feedback.cta",defaultMessage:"Feedback survey"}),"data-testid":"aardvark-feedback-fab",className:"border-token-border-light bg-token-main-surface-primary shadow-long hover:bg-token-main-surface-secondary fixed end-4 bottom-4 z-50 flex h-10 items-center justify-center rounded-full border px-4 text-sm font-medium focus:outline-hidden",children:c.jsx(Ie,{id:"aardvark.feedback.cta",defaultMessage:"Feedback survey"})})}const tt={success:"bg-green-700/15 text-green-700 dark:bg-green-900/40 dark:text-green-300",warning:"bg-yellow-700/15 text-yellow-700 dark:bg-yellow-900/40 dark:text-yellow-300",critical:"bg-red-700/15 text-red-700 dark:bg-red-900/60 dark:text-red-300",danger:"bg-red-500/15 text-red-500 dark:bg-red-500/15 dark:text-red-300",muted:"bg-token-bg-elevated-secondary text-token-text-tertiary dark:bg-token-bg-elevated-secondary/70 dark:text-token-text-tertiary",purple:"bg-purple-400/15 text-purple-400"};function at(a){"use forget";const e=Y.c(7),{variant:t,children:s,className:i,size:n}=a,l=(n===void 0?"md":n)==="sm"?"px-1.5 py-0 text-[11px]":"px-2 py-0.5 text-xs",u=tt[t];let r;e[0]!==i||e[1]!==l||e[2]!==u?(r=qe("inline-flex items-center rounded-full",l,u,i),e[0]=i,e[1]=l,e[2]=u,e[3]=r):r=e[3];let d;return e[4]!==s||e[5]!==r?(d=c.jsx("span",{className:r,children:s}),e[4]=s,e[5]=r,e[6]=d):d=e[6],d}function Ft(a){return a.slice(0,7)}function Nt(a){if(!a)return"";try{const e=new URL(a);if(e.pathname.endsWith(".git")&&(e.pathname=e.pathname.slice(0,-4)),e.hostname.includes("github.com")){const t=e.pathname.split("/").filter(Boolean);if(t.length>=2)return"".concat(t[0],"/").concat(t[1])}return e.hostname}catch(e){return a}}function At(a,e){if(!a)return null;try{const t=new URL(a.replace(/\.git$/,""));if(t.hostname.includes("github.com"))return"".concat(t.origin).concat(t.pathname,"/commit/").concat(e)}catch(t){}return null}function st(a){try{const e=typeof a=="string"?JSON.parse(a):a;if(e&&typeof e=="object"){const t=e,s={};return Array.isArray(t.relevant_lines)&&(s.relevant_lines=t.relevant_lines),typeof t.cvss_score=="number"&&(s.cvss_score=t.cvss_score),typeof t.criticality_cvss_reason=="string"&&(s.criticality_cvss_reason=t.criticality_cvss_reason),s}}catch(e){}return null}function Tt(a){if(!a)return"—";try{const e=new Date(a);return Number.isNaN(e.getTime())?"—":e.toLocaleString()}catch(e){return"—"}}function Lt(a){if(typeof a!="number"||!Number.isFinite(a))return"—";try{const e=new Date(a*1e3);return Number.isNaN(e.getTime())?"—":e.toLocaleString()}catch(e){return"—"}}function it(a){if(!a)return null;const e=typeof a.path=="string"&&a.path.trim()||typeof a.file_path=="string"&&a.file_path.trim();return e?e.replace(/\\/g,"/"):null}function Pt(a,e=3){var n,o,l,u;const t=[...(o=(n=a.commit_analysis)==null?void 0:n.relevant_lines)!=null?o:[]];if(!t.length){const r=st((u=(l=a.commit_analysis)==null?void 0:l.proposed_patch)!=null?u:null);r!=null&&r.relevant_lines&&t.push(...r.relevant_lines)}const s=new Map;for(const r of t){const d=it(r);if(!d)continue;const f=d.lastIndexOf("/");if(f<=0)continue;const g=d.slice(0,f);if(!g)continue;const b=g.toLowerCase(),m=s.get(b);m?m.count+=1:s.set(b,{label:g,count:1})}if(s.size===0)return[];const i=Array.from(s.values()).sort((r,d)=>d.count!==r.count?d.count-r.count:r.label.localeCompare(d.label));return i.slice(0,Math.max(e,0)||i.length).map(r=>r.label)}function It(a){if(!a)return null;const e=a.trim();if(!e)return null;const t=new Date(e);return Number.isNaN(t.getTime())?null:t}function Rt(a,e){if(!e)return null;const t=a.formatDate(e,{year:"numeric",month:"long",day:"numeric"}),s=a.formatTime(e,{hour:"numeric",minute:"2-digit"});return"".concat(t," ").concat(s)}function qt(a){if(!a)return null;const e=a.getTime()-Date.now(),t=Math.abs(e),s=60*1e3,i=60*s,n=24*i,o=7*n,l=30*n,u=365*n;let r,d;t>=u?(r="year",d=e/u):t>=l?(r="month",d=e/l):t>=o?(r="week",d=e/o):t>=n?(r="day",d=e/n):t>=i?(r="hour",d=e/i):t>=s?(r="minute",d=e/s):(r="second",d=e/1e3);let f=d>0?Math.floor(d):Math.ceil(d);return f===0&&(f=d<0?-1:1),{value:f,unit:r}}function Dt(a){var i,n;const e=(i=a.commit_analysis)==null?void 0:i.validated,t=e===!0||e!=null&&String(e).toLowerCase()==="true",s=!!((n=a.commit_analysis)!=null&&n.proposed_patch_generated);return{isValidated:t,hasPatch:s}}const nt=["application/json"];function rt(a){return nt.includes(a)}function le(a){const e={};for(const[t,s]of Object.entries(a))s!=null&&(e[t]="".concat(s));return e}function ot(a,e){for(const[t,s]of Object.entries(e))a=a.replace("{".concat(t,"}"),s);return a}var q,z,V,R,D,U;const X=class X{constructor(e,t,s,i,n,o){W(this,q);W(this,z);W(this,V);W(this,R);W(this,D);W(this,U);var l;if(/\/+$/.test(s))throw new Error("The prefix is not allowed to have trailing slashes");if(/\/+$/.test(t))throw new Error("The baseUrl is not allowed to have trailing slashes");O(this,z,s),O(this,U,t),O(this,V,i),O(this,R,n),O(this,q,e),O(this,D,{fetchFn:(l=o==null?void 0:o.fetchFn)!=null?l:fetch.bind(globalThis)})}withProduces(e){return new X(M(this,q),M(this,U),M(this,z),e,M(this,R),M(this,D))}withConsumes(e){return new X(M(this,q),M(this,U),M(this,z),M(this,V),e,M(this,D))}withPrefix(e){return new X(M(this,q),M(this,U),e,M(this,V),M(this,R),M(this,D))}async _request(e,t,s,i){var f,g,b,m;let n=new URLSearchParams(le((f=s==null?void 0:s.query)!=null?f:{})).toString();n&&(n="?"+n);const o=M(this,U)+M(this,z)+t,l=s==null?void 0:JSON.stringify(s.body),u=l?{"Content-Type":M(this,V)}:null,r=await M(this,D).fetchFn(ot(o,le((g=s==null?void 0:s.path)!=null?g:{}))+n,J(I({credentials:"same-origin"},i!=null?i:{}),{method:e,headers:J(I(I(J(I({},u!=null?u:{}),{Accept:M(this,R)}),(b=i==null?void 0:i.headers)!=null?b:{}),le((m=s==null?void 0:s.headers)!=null?m:{})),{"X-OpenAI-Client":M(this,q)}),body:l})),d=r.headers.get("Content-Type");if(!d)throw new Error("Content-Type was not provided with the response");if(!rt(d))throw new Error("Unsupported return content type ".concat(d));if(d!==M(this,R))throw new Error("Return content type ".concat(d," was provided but this client only accepts ").concat(M(this,R),"."));switch(d){case"application/json":const h=await r.json();return{status:r.status,data:h,raw:r}}}async get(e,...t){return await this._request("GET",e,...t)}async post(e,...t){return await this._request("POST",e,...t)}async put(e,...t){return await this._request("PUT",e,...t)}async patch(e,...t){return await this._request("PATCH",e,...t)}async delete(e,...t){return await this._request("DELETE",e,...t)}async head(e,...t){return await this._request("HEAD",e,...t)}};q=new WeakMap,z=new WeakMap,V=new WeakMap,R=new WeakMap,D=new WeakMap,U=new WeakMap;let ge=X;class te extends ge{constructor(e,t){super("aardvark",e,"","application/json","application/json",t)}}var dt=Ye();const Ut=he(dt);function lt(a){var e;if(!(typeof a!="object"||a===null)&&typeof((e=a.error)==null?void 0:e.message)=="string")return a.error.message}function ae(a,e){var i,n;const t=lt(e),s=t!=null?t:"".concat(a," ").concat((n=(i=e.error)==null?void 0:i.code)!=null?n:"");return new Error(s)}const P=a=>a.split(",").map(e=>e.trim()).filter(e=>e&&e.toLowerCase()!=="all");function ct(a){"use forget";var s,i,n,o,l,u,r,d,f;const e=Y.c(42);let t;e:{if(!a){let k;e[0]===Symbol.for("react.memo_cache_sentinel")?(k=[],e[0]=k):k=e[0];let y;e[1]===Symbol.for("react.memo_cache_sentinel")?(y=[],e[1]=y):y=e[1];let $;e[2]===Symbol.for("react.memo_cache_sentinel")?($=[],e[2]=$):$=e[2];let G;e[3]===Symbol.for("react.memo_cache_sentinel")?(G=[],e[3]=G):G=e[3];let Q;e[4]===Symbol.for("react.memo_cache_sentinel")?(Q=[],e[4]=Q):Q=e[4];let K;e[5]===Symbol.for("react.memo_cache_sentinel")?(K={repoCsv:"",repoList:k,validationFilter:"all",patchFilter:"all",statusesCsv:"",statusList:y,critCsv:"",criticalityList:$,assigneesCsv:"",assigneeList:G,assigneeEmailsCsv:"",assigneeEmailList:Q,authorsCsv:"",authorList:[],sortParam:"",pathPrefixesCsv:"",queryText:""},e[5]=K):K=e[5],t=K;break e}let g,b,m,h,w,F,T,N,A,S,C,j,v,_,p,E,x;if(e[6]!==a){const k=new URLSearchParams(a),y=(s=k.get("repo"))!=null?s:"",$=k.get("validated"),G=k.get("has_patch"),Q=$==="true"?"validated":$==="false"?"unvalidated":"all",K=G==="true"?"with_patch":G==="false"?"without_patch":"all",ie=(i=k.get("status"))!=null?i:"",ne=(n=k.get("criticality"))!=null?n:"",re=(o=k.get("assignee"))!=null?o:"",oe=(l=k.get("assignee_email"))!=null?l:"",de=(u=k.get("author"))!=null?u:"";m=(r=k.get("sort"))!=null?r:"",g=(d=k.get("path_prefix"))!=null?d:"",b=(f=k.get("q"))!=null?f:"",h=y,S=y?P(y):[],C=Q,j=K,v=ie,_=ie?P(ie):[],p=ne,E=ne?P(ne):[],x=re,w=re?P(re):[],F=oe,T=oe?P(oe):[],N=de,A=de?P(de):[],e[6]=a,e[7]=g,e[8]=b,e[9]=m,e[10]=h,e[11]=w,e[12]=F,e[13]=T,e[14]=N,e[15]=A,e[16]=S,e[17]=C,e[18]=j,e[19]=v,e[20]=_,e[21]=p,e[22]=E,e[23]=x}else g=e[7],b=e[8],m=e[9],h=e[10],w=e[11],F=e[12],T=e[13],N=e[14],A=e[15],S=e[16],C=e[17],j=e[18],v=e[19],_=e[20],p=e[21],E=e[22],x=e[23];let L;e[24]!==g||e[25]!==b||e[26]!==m||e[27]!==h||e[28]!==w||e[29]!==F||e[30]!==T||e[31]!==N||e[32]!==A||e[33]!==S||e[34]!==C||e[35]!==j||e[36]!==v||e[37]!==_||e[38]!==p||e[39]!==E||e[40]!==x?(L={repoCsv:h,repoList:S,validationFilter:C,patchFilter:j,statusesCsv:v,statusList:_,critCsv:p,criticalityList:E,assigneesCsv:x,assigneeList:w,assigneeEmailsCsv:F,assigneeEmailList:T,authorsCsv:N,authorList:A,sortParam:m,pathPrefixesCsv:g,queryText:b},e[24]=g,e[25]=b,e[26]=m,e[27]=h,e[28]=w,e[29]=F,e[30]=T,e[31]=N,e[32]=A,e[33]=S,e[34]=C,e[35]=j,e[36]=v,e[37]=_,e[38]=p,e[39]=E,e[40]=x,e[41]=L):L=e[41],t=L}return t}function Bt(a,e){"use forget";const t=Y.c(31),{repoCsv:s,validationFilter:i,patchFilter:n,statusesCsv:o,critCsv:l,assigneesCsv:u,assigneeEmailsCsv:r,authorsCsv:d,sortParam:f,pathPrefixesCsv:g,queryText:b}=ct(a),m=e==null?void 0:e.limit,h=e==null?void 0:e.cursor,w=m!=null?m:null,F=h!=null?h:null,T=f||null,N=g||null,A=b||null;let S;t[0]!==r||t[1]!==u||t[2]!==d||t[3]!==l||t[4]!==n||t[5]!==s||t[6]!==o||t[7]!==w||t[8]!==F||t[9]!==T||t[10]!==N||t[11]!==A||t[12]!==i?(S=["aardvark","findings","scan",s,i,o,l,u,r,d,w,F,T,N,A,n],t[0]=r,t[1]=u,t[2]=d,t[3]=l,t[4]=n,t[5]=s,t[6]=o,t[7]=w,t[8]=F,t[9]=T,t[10]=N,t[11]=A,t[12]=i,t[13]=S):S=t[13];let C;t[14]!==r||t[15]!==u||t[16]!==d||t[17]!==l||t[18]!==h||t[19]!==m||t[20]!==n||t[21]!==g||t[22]!==b||t[23]!==s||t[24]!==f||t[25]!==o||t[26]!==i?(C=async()=>{const v={},_=typeof m=="number"&&Number.isFinite(m)&&m>0?m:500,p=typeof h=="number"&&Number.isFinite(h)&&h>=0,E=p?h:0;if(v.limit=String(_),p&&(v.cursor=String(E)),s){const y=P(s);y.length>0&&(v.repo=y.join(","))}if(i==="validated"?v.validated="true":i==="unvalidated"&&(v.validated="false"),n==="with_patch"?v.has_patch="true":n==="without_patch"&&(v.has_patch="false"),f&&(v.sort=f),o){const y=P(o);y.length>0&&(v.status=y.join(","))}if(l){const y=P(l);y.length>0&&(v.criticality=y.join(","))}if(u){const y=P(u);y.length>0&&(v.assignee=y.join(","))}if(r){const y=P(r);y.length>0&&(v.assignee_email=y.join(","))}if(d){const y=P(d);y.length>0&&(v.author=y.join(","))}if(g){const y=P(g);y.length>0&&(v.path_prefix=y.join(","))}const x=b.trim();x&&(v.q=x);const k=await new te(Z).get("/aardvark/scan-findings",{headers:ee(),query:v});if(k.status!==200)throw ae(k.status,k.data);return k.data},t[14]=r,t[15]=u,t[16]=d,t[17]=l,t[18]=h,t[19]=m,t[20]=n,t[21]=g,t[22]=b,t[23]=s,t[24]=f,t[25]=o,t[26]=i,t[27]=C):C=t[27];let j;return t[28]!==S||t[29]!==C?(j={queryKey:S,queryFn:C,staleTime:3e4,refetchOnWindowFocus:!0},t[28]=S,t[29]=C,t[30]=j):j=t[30],me(j)}function $t(a){"use forget";const e=Y.c(8),t=a!=null?a:null;let s;e[0]!==t?(s=["aardvark","findings","recommended",t],e[0]=t,e[1]=s):s=e[1];const i=!!t;let n;e[2]!==t?(n=async()=>{var r,d,f,g,b;if(!t)throw new Error("No configured scan id found for recommended findings");const u=await new te(Z).get("/aardvark/rankings",{headers:ee(),query:{configured_scan_id:t}});if(u.status!==200)throw ae(u.status,u.data);return{items:(d=(r=u.data.ranking_item_list)==null?void 0:r.map(ut))!=null?d:[],total:(g=(f=u.data.ranking_item_list)==null?void 0:f.length)!=null?g:0,ranking_end_time:(b=u.data.ranking_end_time)!=null?b:null}},e[2]=t,e[3]=n):n=e[3];let o;return e[4]!==s||e[5]!==i||e[6]!==n?(o={queryKey:s,enabled:i,queryFn:n,staleTime:3e4,refetchOnWindowFocus:!0},e[4]=s,e[5]=i,e[6]=n,e[7]=o):o=e[7],me(o)}function ut(a){return a}function Gt(a){"use forget";const e=Y.c(2);let t;return e[0]!==a?(t={queryKey:["aardvark","finding",a],queryFn:async()=>{const i=await new te(Z).get("/aardvark/scan-findings/{id}",{headers:ee(),path:{id:a}});if(i.status!==200)throw ae(i.status,i.data);return i.data},staleTime:3e4,refetchInterval:ft,refetchIntervalInBackground:!0,refetchOnWindowFocus:!0},e[0]=a,e[1]=t):t=e[1],me(t)}function ft(a){const e=a.state.data,t=e==null?void 0:e.proposed_patch;return t?t.status!=="finished"?5e3:t.status==="finished"&&t.success!==!0?1e4:!1:!1}function je(a,e,t){a.setQueriesData({queryKey:["aardvark","findings"],exact:!1},s=>{var n;if(!s)return s;const i=((n=s.items)!=null?n:[]).map(o=>o.hid===e?I(I({},o),t):o);return J(I({},s),{items:i})})}function Fe(a,e,t){a.setQueryData(["aardvark","finding",e],s=>s&&I(I({},s),t))}const ce=De(()=>Re(()=>import("./cklkb8csuv59azob.js"),__vite__mapDeps([0,1])),{loading:a=>Ue(a)});function ke({name:a,email:e}){var n;const t=(a!=null?a:"").trim();if(t.length>0){const o=t.split(/\s+/).filter(Boolean);return o.length>=2?(o[0][0]+o[o.length-1][0]).toUpperCase():o[0].slice(0,2).toUpperCase()}const s=(n=(e!=null?e:"").split("@")[0])!=null?n:"";if(!s)return"?";const i=s.split(/[._-]+/).filter(Boolean);return i.length>=2?(i[0][0]+i[1][0]).toUpperCase():s.slice(0,2).toUpperCase()}function Wt({finding:a}){var S,C,j,v,_;const e=Se(),t=Ce(),s=se(),i=Be(),n=i==null?void 0:i.getWorkspaceId(),o=i==null?void 0:i.normalizedAccountUserId,[l,u]=B.useState(""),[r,d]=B.useState(!1),f=$e(),{data:g,isLoading:b}=Qe(n!=null?n:void 0,0,l,100),m=B.useMemo(()=>{var p,E;return{id:o!=null?o:"",email:(p=f==null?void 0:f.email)!=null?p:"",name:(E=f==null?void 0:f.name)!=null?E:void 0}},[o,f==null?void 0:f.email,f==null?void 0:f.name]),h=B.useMemo(()=>{var E;const p=((E=g==null?void 0:g.items)!=null?E:[]).map(x=>{var L,k;return{id:x.account_user_id,email:(L=x.email)!=null?L:"",name:(k=x.name)!=null?k:void 0}}).filter(x=>x.email.length>0);return m.id&&m.email&&(p.some(L=>L.id===m.id||L.email.toLowerCase()===m.email.toLowerCase())||p.unshift(m)),p},[g==null?void 0:g.items,m]),w=(S=a.assignee_id)!=null?S:"none",F=w==="none"?"":(j=(C=a.assignee)==null?void 0:C.email)!=null?j:"",T=w==="none"?void 0:(_=(v=a.assignee)==null?void 0:v.name)!=null?_:"",N=w==="none"?"—":ke({name:T,email:F}),A=async p=>{try{d(!0);const x=await new te(Z).patch("/aardvark/scan-findings/{id}",{headers:ee(),path:{id:a.id},body:{version:a.version,assignee_user_email:p}});if(x.status!==200)throw ae(x.status,x.data);je(e,a.hid,x.data),Fe(e,a.hid,x.data),t.successNeutral(s.formatMessage({id:"aardvark.toast.assigneeUpdated",defaultMessage:"Assignee updated"}),{duration:5,hasCloseButton:!0})}catch(E){const x=E,L=s.formatMessage(Ee.assigneeUpdate,{details:x.message});t.danger(L,{duration:5,hasCloseButton:!0})}finally{d(!1)}};return r?c.jsx("button",{disabled:!0,title:F,className:"border-token-border-light bg-token-bg-primary inline-flex h-8 w-8 cursor-not-allowed items-center justify-center rounded-full border text-[11px] font-semibold opacity-60","aria-disabled":!0,children:w==="none"?c.jsx(ce,{className:"icon-sm","aria-hidden":!0}):N}):c.jsx(Ge,{triggerButton:c.jsx("button",{title:F,className:"border-token-border-light bg-token-bg-primary inline-flex h-8 w-8 items-center justify-center rounded-full border text-[11px] font-semibold","aria-busy":b,children:w==="none"?c.jsx(ce,{className:"icon-sm","aria-hidden":!0}):N}),children:c.jsxs("div",{className:"p-2.5",children:[c.jsx(Ke,{color:"search",name:"assignee-search",type:"text",value:l,onChange:p=>u(p.target.value),placeholder:s.formatMessage(we.search),ariaLabel:s.formatMessage(we.search),className:"text-token-text-tertiary flex h-8 w-full items-center rounded-sm",inputClassName:"text-token-text-primary w-full",containerInputClassName:"w-full"}),c.jsxs("div",{className:"mt-2 max-h-60 overflow-y-auto",children:[c.jsxs("button",{type:"button",onClick:()=>A(null),className:"hover:bg-token-bg-tertiary flex w-full items-center gap-2 rounded-sm px-2 py-1 text-start text-sm ".concat(w==="none"?"bg-token-bg-tertiary":""),children:[c.jsx("div",{className:"border-token-border-light bg-token-bg-primary inline-flex h-7 w-7 items-center justify-center rounded-full border text-[11px] font-semibold",children:c.jsx(ce,{className:"icon-sm","aria-hidden":!0})}),c.jsx("div",{className:"flex flex-col",children:c.jsx("span",{className:"leading-4",children:s.formatMessage(et.none)})})]},"none"),h.map(p=>{var x;const E=ke({name:p.name,email:p.email});return c.jsxs("button",{type:"button",onClick:()=>A(p.email),className:"hover:bg-token-bg-tertiary flex w-full items-center gap-2 rounded-sm px-2 py-1 text-start text-sm ".concat(p.id===w?"bg-token-bg-tertiary":""),children:[c.jsx("div",{className:"border-token-border-light bg-token-bg-primary inline-flex h-7 w-7 items-center justify-center rounded-full border text-[11px] font-semibold",children:E}),c.jsxs("div",{className:"flex flex-col",children:[c.jsx("span",{className:"leading-4",children:(x=p.name)!=null?x:p.email}),c.jsx("span",{className:"text-token-text-tertiary text-xs leading-4",children:p.email})]})]},p.id)})]})]})})}var gt=Je();const ht=he(gt);function Ot({finding:a}){const e=se(),t=a.status,s=Se(),i=Ce(),[n,o]=B.useState(!1),[l,u]=B.useState(!1),[r,d]=B.useState(null),[f,g]=B.useState(""),b=async({id:h,hid:w,payload:F,onSuccess:T,onError:N,setIsSaving:A,intl:S,queryClient:C,toaster:j})=>{try{A(!0);const _=await new te(Z).patch("/aardvark/scan-findings/{id}",{path:{id:h},body:F,headers:ee()});if(_.status!==200)throw ae(_.status,_.data);je(C,w,_.data),Fe(C,w,_.data),j.successNeutral(S.formatMessage({id:"aardvark.toast.statusUpdated",defaultMessage:"Status updated"}),{duration:5,hasCloseButton:!0}),T&&T(_.data)}catch(v){const _=v,p=S.formatMessage(Ee.statusUpdate,{details:_.message});j.danger(p),N&&N(_)}finally{A(!1)}},m=async h=>{if(h==="wontfix"||h==="fixed"||h==="duplicate"){d(h),u(!0);return}await b({id:a.id,hid:a.hid,payload:{version:a.version,status:h},setIsSaving:o,intl:e,queryClient:s,toaster:i})};return c.jsxs(c.Fragment,{children:[c.jsxs(H.Root,{value:t,onValueChange:m,disabled:n,children:[c.jsx(H.Trigger,{className:"border-token-border-light bg-token-bg-primary mr h-7 rounded-md border px-2 text-xs",children:c.jsxs("div",{className:"flex w-full items-center justify-between",children:[c.jsx("div",{className:"truncate",children:c.jsx(H.Value,{})}),c.jsx(H.Icon,{})]})}),c.jsx(H.Portal,{children:c.jsx(H.Content,{align:"start",className:"rounded-lg text-sm",children:ht(Xe,(h,w)=>c.jsx(H.Item,{value:w,children:e.formatMessage(h,{status:w})},w))})})]}),l&&c.jsx(We,{testId:"modal-wontfix-reason",isOpen:!0,onClose:()=>{u(!1),g(""),d(null)},title:r==="fixed"?e.formatMessage({id:"aardvark.findings.fixed.title",defaultMessage:"Add PR link"}):r==="duplicate"?e.formatMessage({id:"aardvark.findings.duplicate.title",defaultMessage:"Mark as duplicate"}):e.formatMessage({id:"aardvark.findings.wontfix.title",defaultMessage:"Add reason"}),showCloseButton:!0,primaryButton:c.jsx(be.Button,{title:r==="fixed"?e.formatMessage({id:"aardvark.findings.fixed.save",defaultMessage:"Save"}):e.formatMessage({id:"aardvark.findings.wontfix.save",defaultMessage:"Save"}),color:"primary",loading:n,onClick:async()=>{if(r){if(!f.trim()){i.danger(r==="fixed"?e.formatMessage({id:"aardvark.findings.fixed.required",defaultMessage:"Please paste a PR link"}):r==="duplicate"?e.formatMessage({id:"aardvark.findings.duplicate.required",defaultMessage:"Please paste a link to the original scan finding"}):e.formatMessage({id:"aardvark.findings.wontfix.required",defaultMessage:"Please enter a reason"}));return}await b({id:a.id,hid:a.hid,payload:{version:a.version,status:r,resolution_reason:f.trim()},setIsSaving:o,intl:e,queryClient:s,toaster:i,onSuccess:()=>{u(!1),g(""),d(null)}})}}}),secondaryButton:c.jsx(be.Button,{title:r==="fixed"?e.formatMessage({id:"aardvark.findings.fixed.cancel",defaultMessage:"Cancel"}):e.formatMessage({id:"aardvark.findings.wontfix.cancel",defaultMessage:"Cancel"}),color:"secondary",onClick:()=>{u(!1),g(""),d(null)}}),children:c.jsxs("div",{className:"space-y-3",children:[c.jsx("div",{children:c.jsx("div",{className:"text-token-text-secondary mt-1 text-sm",children:r==="fixed"?e.formatMessage({id:"aardvark.findings.fixed.prompt",defaultMessage:"Which PR merged the fix? Paste the URL."}):r==="duplicate"?e.formatMessage({id:"aardvark.findings.duplicate.prompt",defaultMessage:"Which scan finding does this duplicate? Paste a link to the original finding."}):e.formatMessage({id:"aardvark.findings.wontfix.prompt",defaultMessage:"Why won't this be fixed?"})})}),c.jsx("div",{children:c.jsx("textarea",{value:f,onChange:h=>g(h.target.value),className:"border-token-border-default bg-token-bg-primary text-token-text-primary placeholder:text-token-text-tertiary w-full rounded-lg border p-3 text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none",placeholder:r==="fixed"?e.formatMessage({id:"aardvark.findings.fixed.placeholder",defaultMessage:"Paste PR URL (required)"}):r==="duplicate"?e.formatMessage({id:"aardvark.findings.duplicate.placeholder",defaultMessage:"Paste link (required)"}):e.formatMessage({id:"aardvark.findings.wontfix.placeholder",defaultMessage:"Add a short reason (required)"}),rows:5})})]})})]})}var ue,Me;function mt(){if(Me)return ue;Me=1;var a=Oe();function e(t,s){var i=[];return a(t,function(n,o,l){s(n,o,l)&&i.push(n)}),i}return ue=e,ue}var fe,_e;function pt(){if(_e)return fe;_e=1;var a=He(),e=mt(),t=ze(),s=Ve();function i(n,o){var l=s(n)?a:e;return l(n,t(o,3))}return fe=i,fe}var vt=pt();const Ht=he(vt),yt={critical:"critical",high:"danger",medium:"purple",low:"warning"};function zt(a){"use forget";const e=Y.c(6),{level:t}=a,s=se(),i=yt[t];let n;e[0]!==s||e[1]!==t?(n=s.formatMessage(Ze[t]),e[0]=s,e[1]=t,e[2]=n):n=e[2];const o=n;let l;return e[3]!==o||e[4]!==i?(l=c.jsx(at,{variant:i,children:o}),e[3]=o,e[4]=i,e[5]=l):l=e[5],l}export{Wt as A,Ee as E,Ct as F,St as P,Ot as S,at as a,Ht as b,At as c,Lt as d,zt as e,Tt as f,jt as g,te as h,ae as i,Ut as j,Xe as k,Bt as l,ht as m,Pt as n,It as o,st as p,qt as q,Nt as r,Ft as s,Rt as t,Gt as u,Dt as v,Et as w,$t as x};
//# sourceMappingURL=cg9zyx3f2s9b21n8.js.map
