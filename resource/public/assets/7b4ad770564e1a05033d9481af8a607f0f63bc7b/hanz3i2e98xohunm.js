const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/m6idklazvjc7d344.js","assets/kfrdmkli83ureki3.js","assets/jqy8zfwhk6ptqvmj.js"])))=>i.map(i=>d[i]);
var Ce=Object.defineProperty,Se=Object.defineProperties;var Pe=Object.getOwnPropertyDescriptors;var te=Object.getOwnPropertySymbols;var Ie=Object.prototype.hasOwnProperty,Ee=Object.prototype.propertyIsEnumerable;var ne=(n,a,s)=>a in n?Ce(n,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[a]=s,B=(n,a)=>{for(var s in a||(a={}))Ie.call(a,s)&&ne(n,s,a[s]);if(te)for(var s of te(a))Ee.call(a,s)&&ne(n,s,a[s]);return n},oe=(n,a)=>Se(n,Pe(a));import{h as H,j as e,e as Ne,_ as Q,r as f,M as z,R as be}from"./kfrdmkli83ureki3.js";import{eG as P,e6 as W,_ as U,az as Y,aA as K,p as Le,u as le,al as ce,J as De,O as J,V as O,P as Re,cy as A,d_ as Be,dQ as Ae,R as Te,D as X}from"./kw08ajijqinojrwh.js";import{h as We,fT as Ue,b3 as $e,gX as w,gY as T,dg as ye}from"./fyw02vlaiv2vq6cj.js";import{X as Ge,L as Ve,R as Fe}from"./e3dkkco0b3958icx.js";import{d as ie}from"./kl7c6054usfnqmd4.js";import{g as ze}from"./k97n0y6ba9c9h39c.js";import{u as Xe}from"./gz2kraed79kezjd0.js";const qe=Y(()=>Q(()=>import("./m6idklazvjc7d344.js"),__vite__mapDeps([0,1])),{loading:n=>K(n)}),q=Ne({download:{id:"postSharingModal.download",defaultMessage:"Download"},downloadPdfButtonMenu:{id:"postSharingModal.download-pdf-button.menu",defaultMessage:"PDF Document (.pdf)"},downloadDocxButtonMenu:{id:"postSharingModal.download-docx-button.menu",defaultMessage:"Microsoft Word Document (.docx)"}}),Je=({downloading:n,onOdysseyFileDownload:a,disabled:s,icon:i,label:h,odysseyShareIntent:t})=>{const c=H();return t.fileName.endsWith("md")?e.jsxs(P.Root,{open:!s&&!n?void 0:!1,children:[e.jsx(P.BasicTrigger,{asChild:!0,children:e.jsxs("button",{onClick:()=>{U.logEventWithStatsig("Share Post: Social Clicked","chatgpt_post_share_link_social_clicked",{platform:"download"})},disabled:s,className:"relative flex flex-col gap-y-4 disabled:opacity-50 max-sm:gap-y-2",children:[e.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-full shadow-lg max-sm:h-12 max-sm:w-12 max-sm:shadow-md dark:shadow-md",children:e.jsx("div",{className:"pointer-events-none flex h-8 w-8 items-center justify-center max-sm:h-6 max-sm:w-6",children:n?e.jsx(W,{}):i})}),e.jsx("div",{className:"w-full text-center text-xs",children:h})]})}),e.jsx(P.Portal,{children:e.jsxs(P.Content,{align:"end",children:[e.jsx(P.Item,{onClick:r=>{r.preventDefault(),a==null||a(t.fileName,t.fileId,t.messageId,"pdf")},children:c.formatMessage(q.downloadPdfButtonMenu)}),e.jsx(P.Item,{onClick:r=>{r.preventDefault(),a==null||a(t.fileName,t.fileId,t.messageId,"docx")},children:c.formatMessage(q.downloadDocxButtonMenu)})]})})]},"download"):e.jsxs("button",{onClick:()=>{a==null||a(t.fileName,t.fileId,t.messageId,null),U.logEventWithStatsig("Share Post: Social Clicked","chatgpt_post_share_link_social_clicked",{platform:"download"})},disabled:s,className:"relative flex flex-col gap-y-4 disabled:opacity-50 max-sm:gap-y-2",children:[e.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-full shadow-lg max-sm:h-12 max-sm:w-12 max-sm:shadow-md dark:shadow-md",children:e.jsx("div",{className:"pointer-events-none flex h-8 w-8 items-center justify-center max-sm:h-6 max-sm:w-6",children:e.jsx(qe,{})})}),e.jsx("div",{className:"w-full text-center text-xs",children:c.formatMessage(q.download)})]},"download")},Oe=Y(()=>Q(()=>import("./jqy8zfwhk6ptqvmj.js"),__vite__mapDeps([2,1])),{loading:n=>K(n)}),re=Y(()=>Q(()=>import("./m6idklazvjc7d344.js"),__vite__mapDeps([0,1])),{loading:n=>K(n)});function He({showLinkCopied:n,isGeneratingShareLink:a,onClick:s,postText:i,showDownloadButton:h,odysseyShareIntent:t,isDownloadingOdyssey:c,onOdysseyFileDownload:r,disabled:g,downloadVariant:u,isConversationDownloading:M}){const p=H(),L=le(),_=ce(L),x=_==null?void 0:_.isWorkspaceAccount();let C=[{id:"copy",icon:a?e.jsx(W,{}):e.jsx(Oe,{}),label:n?p.formatMessage(w.linkCopied):p.formatMessage(w.copyLink),action:"copy"}];x?h&&C.push({id:"download",icon:u==="conversation"&&M?e.jsx(W,{}):e.jsx(re,{}),label:p.formatMessage({id:"postSharingModal.download",defaultMessage:"Download"}),action:"download",downloadVariant:u}):C=C.concat({id:"x",href:d=>"https://twitter.com/intent/tweet?url=".concat(encodeURIComponent(d),"&text=").concat(i?encodeURIComponent(i):""),icon:e.jsx(Ge,{initialFillColor:"var(--text-primary)"}),label:p.formatMessage({id:"postSharingModal.x",defaultMessage:"X"}),action:"share"},{id:"linkedin",href:d=>"https://www.linkedin.com/shareArticle?url=".concat(encodeURIComponent(d),"&text=").concat(i?encodeURIComponent(i):""),icon:e.jsx(Ve,{initialFillColor:"var(--text-primary)"}),label:p.formatMessage({id:"postSharingModal.linkedin",defaultMessage:"LinkedIn"}),action:"share"},{id:"reddit",href:d=>"https://www.reddit.com/submit?url=".concat(encodeURIComponent(d),"&title=").concat(i?encodeURIComponent(i):""),icon:e.jsx(Fe,{initialFillColor:"var(--text-primary)"}),label:p.formatMessage({id:"postSharingModal.reddit",defaultMessage:"Reddit"}),action:"share"},...h?[{id:"download",icon:u==="conversation"&&M?e.jsx(W,{}):e.jsx(re,{}),label:"[oai] Download as PDF",action:"download",downloadVariant:u}]:[]);const D=!!c;return e.jsx(e.Fragment,{children:C.map(d=>d.id==="download"&&t?e.jsx(Je,{downloading:D,onOdysseyFileDownload:r,disabled:g!=null?g:!1,icon:d.icon,label:d.label,odysseyShareIntent:t},d.id):e.jsxs("button",{onClick:async()=>{try{await s(d)}finally{U.logEventWithStatsig("Share Post: Social Clicked","chatgpt_post_share_link_social_clicked",{platform:d.id})}},disabled:g||d.downloadVariant==="conversation"&&M,className:"relative flex flex-col gap-y-4 disabled:opacity-50 max-sm:gap-y-2",children:[e.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-full shadow-lg max-sm:h-12 max-sm:w-12 max-sm:shadow-md dark:shadow-md",children:e.jsx("div",{className:"pointer-events-none flex h-8 w-8 items-center justify-center max-sm:h-6 max-sm:w-6",children:d.icon})}),e.jsx("div",{className:"w-full max-w-16 text-center text-xs",children:d.label})]},d.id))})}function Qe(n,a){const s=J(n);return s?{id:"tmp",kind:"message_slice",messages:a.map(h=>{const t=O.findNode(s,({message:c})=>c.id===h);return t?t.message:null}).filter(Boolean)}:null}function Ye(n){return{id:"tmp",kind:"message_slice",messages:[n.previewMessage]}}function ls({postSharingData:n,onClose:a}){const{clientThreadId:s,postText:i,generateShareLinkFn:h,coverImageUrl:t,messageSliceIds:c,odysseyShareIntent:r}=n,g=f.useRef(void 0),[u,M]=f.useState(!1),[p,L]=f.useState(!1),_=H(),x=Le(),[C,D]=f.useState(!0),d=le(),$=ce(d),y=$==null?void 0:$.isWorkspaceAccount();De(d,"3453150529"),f.useEffect(()=>{U.logEventWithStatsig("Share Post: Post Sharing Modal Shown","chatgpt_post_share_modal_shown")},[]),f.useEffect(()=>{g.current=void 0},[s]);const I=f.useMemo(()=>r?Ye(r):t||!c||c.length===0?null:Qe(s,c),[t,s,c,r]),E=f.useMemo(()=>{const l=J(s);return l?O.getConversationTurns(l).flatMap(m=>m.messages):[]},[s]),de=f.useMemo(()=>{if(!c||c.length===0)return[];const l=new Set(c);return E.filter(m=>typeof m.id=="string"&&l.has(m.id))},[E,c]),me=!1;f.useEffect(()=>{if(!c||c.length===0)return;const l=J(s);c.filter(N=>!O.findNode(l,({message:j})=>j.id===N)).length>0&&We(s)},[s,c]);const{hasImage:fe,hasScreenshot:he}=f.useMemo(()=>{let l=!1,m=!1;if(E.length){const N=E,j=/\.(jpe?g|png|gif|webp|bmp|tiff)$/i,b=k=>{if(!Array.isArray(k))return!1;for(const o of k)if(o.type==="image_inline"&&o.clicked_from_url&&(m=!0),o.type==="file"&&"file_name"in o){const S=o.file_name.toLowerCase();(S.endsWith(".pptx")||j.test(S))&&(l=!0)}};N.forEach(k=>{var R,ee,se,ae;const o=k.metadata;if(!o)return;const S=[...Object.values((R=o.n7jupd_crefs_by_file)!=null?R:{}).flat(),...Object.values((ee=o.content_references_by_file)!=null?ee:{}).flat()],F=[...(se=o.n7jupd_crefs)!=null?se:[],...(ae=o.content_references)!=null?ae:[]];b(S),b(F)})}return{hasImage:l,hasScreenshot:m}},[E]),G=Re(s),ge=async l=>{if(!(u||!G)&&G){if(!g.current){M(!0);try{const m=await h();m&&(g.current=m)}catch(m){x.danger(w.failedToGenerateShareLink,{toastId:"failed_to_generate_share_link"})}finally{M(!1)}}if(g.current){if(l.action==="copy")navigator.clipboard.writeText(g.current),L(!0),x.success(_.formatMessage(w.linkCopied)),setTimeout(()=>{L(!1)},3e3);else if(l.action==="share"&&l.href)window.open(l.href(g.current),"_blank","noopener,noreferrer");else if(l.action==="download"){if(l.downloadVariant==="conversation"){await ve();return}l.downloadVariant==="image"&&t&&ye({url:t,fileName:"".concat(i,".png")})}}}},ue=e.jsx("div",{className:A("flex w-full justify-center rounded-xl",t||I&&(r!=null&&r.isStandaloneAttachment)?"max-xs:max-h-[260px] h-[30vh] max-h-[550px] max-sm:max-h-[300px]":"aspect-[1200/630]",!t&&!(r!=null&&r.isStandaloneAttachment)&&"outline-token-border-light overflow-hidden shadow-sm outline outline-1"),children:t?e.jsx("img",{src:t,alt:i}):r!=null&&r.isStandaloneAttachment&&I?e.jsx(Ue,{attachments:[I],variant:"unfurl",className:"h-full w-full",clientThreadId:s}):I?e.jsx($e,{attachments:[I],clientThreadId:s,className:"h-full"}):null}),pe="normal",[xe,V]=f.useState(!1),{presentationMap:we}=Xe(),v=_.formatMessage(w.downloadFileError),[_e,Ze]=f.useState(!1),ve=f.useCallback(async()=>{},[de,me,i,_,x,v]),je=async(l,m,N,j)=>{var k;const b=G;if(!(!l||!m||!b))if(V(!0),l.endsWith("md")){if(!j)return;try{const o=await Te.safePost("/export_doc/n7jupd",{requestBody:{conversation_id:b,message_id:N,file_id:m,export_type:j},skipJsonTransform:!0});o.ok||(x.danger(v,{toastId:"post_sharing_modal_download_error",loggingTitle:v,loggingDescription:"Error message when a file download fails"}),X.addError("post_sharing_modal_download_error",{statusText:o.statusText,status:o.status}));const S=await o.blob(),F=o.headers.get("Content-Disposition"),R=(k=ze(F))!=null?k:"Agent.".concat(j);ie(S,R)}catch(o){x.danger(v,{toastId:"post_sharing_modal_download_error",loggingTitle:v,loggingDescription:"Error message when a file download fails"}),X.addError(o)}finally{V(!1)}}else{const o=we[m];if(!o||!o.fileBlob){x.danger(v,{toastId:"post_sharing_modal_download_error",loggingTitle:v,loggingDescription:"Error message when a file download fails"}),X.addError("post_sharing_modal_download_error"),V(!1);return}ie(o.fileBlob,l)}},Z=t?"image":void 0,ke=!!Z||!!r,Me=e.jsxs(e.Fragment,{children:[e.jsx("div",{className:A("flex flex-wrap justify-center space-y-4 space-x-12 max-sm:space-x-6","mt-12 max-sm:mt-6"),children:e.jsx(He,{showLinkCopied:p,isGeneratingShareLink:u,disabled:u,onClick:ge,postText:i,showDownloadButton:ke,odysseyShareIntent:r,isDownloadingOdyssey:xe,onOdysseyFileDownload:je,downloadVariant:Z,isConversationDownloading:_e})}),Ke(fe,he,y!=null?y:!1)]});return e.jsx(Be,{onExitComplete:a,children:C&&e.jsx(T.Root,{isOpen:!0,onClose:()=>{D(!1)},className:"max-w-[664px] px-4",children:e.jsx(T.Overlay,{showBackground:!0,children:e.jsxs(T.Content,{size:"normal",position:"center",className:A("flex flex-col pb-4 focus:outline-hidden",{"max-w-[640px]":pe==="normal"}),removePopoverStyling:!1,shadow:"normal",children:[e.jsx(T.Header,{title:i,type:"success",closeButton:e.jsx(Ae,{onClick:()=>D(!1)})}),e.jsxs("div",{children:[e.jsx("div",{className:A("flex justify-center",!r&&"pointer-events-none"),children:ue}),Me]})]})})})})}function Ke(n,a,s){const i=[];return s&&i.push(e.jsx(z,B({},w.shareLinkVisibleToWorkspaceOnly),"workspace")),a&&i.push(e.jsx(z,B({},w.screenshotDisclaimer),"screenshot")),n&&i.push(e.jsx(z,oe(B({},w.imageLicenseDisclaimer),{values:{nbsp:" ",link:h=>e.jsx("a",{href:"https://help.openai.com/",target:"_blank",rel:"noopener noreferrer",className:"underline",children:h})}}),"image")),i.length?e.jsx("p",{className:"text-token-text-tertiary text-center text-sm sm:mt-2",children:i.map((h,t)=>e.jsxs(be.Fragment,{children:[t>0&&e.jsx(e.Fragment,{children:" "}),h]},t))},"image-disclaimer"):null}export{ls as PostSharingModal};
//# sourceMappingURL=hanz3i2e98xohunm.js.map
