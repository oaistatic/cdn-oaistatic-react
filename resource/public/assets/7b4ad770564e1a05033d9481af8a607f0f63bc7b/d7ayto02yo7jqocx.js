const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ffrotvb922yxp30i.js","assets/kfrdmkli83ureki3.js","assets/nlj7ey81i8rm36n9.js"])))=>i.map(i=>d[i]);
var Qt=Object.defineProperty,Xt=Object.defineProperties;var Jt=Object.getOwnPropertyDescriptors;var Tt=Object.getOwnPropertySymbols;var Lt=Object.prototype.hasOwnProperty,Yt=Object.prototype.propertyIsEnumerable;var St=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e);var It=(e,t,n)=>t in e?Qt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,p=(e,t)=>{for(var n in t||(t={}))Lt.call(t,n)&&It(e,n,t[n]);if(Tt)for(var n of Tt(t))Yt.call(t,n)&&It(e,n,t[n]);return e},M=(e,t)=>Xt(e,Jt(t));var L=function(e,t){this[0]=e,this[1]=t},xt=(e,t,n)=>{var d=(s,c,l,f)=>{try{var v=n[s](c),i=(c=v.value)instanceof L,F=v.done;Promise.resolve(i?c[0]:c).then(y=>i?d(s==="return"?s:"next",c[1]?{done:y.done,value:y.value}:y,l,f):l({value:y,done:F})).catch(y=>d("throw",y,l,f))}catch(y){f(y)}},a=s=>r[s]=c=>new Promise((l,f)=>d(s,c,l,f)),r={};return n=n.apply(e,t),r[St("asyncIterator")]=()=>r,a("next"),a("throw"),a("return"),r};var et=(e,t,n)=>(t=e[St("asyncIterator")])?t.call(e):(e=e[St("iterator")](),t={},n=(d,a)=>(a=e[d])&&(t[d]=r=>new Promise((s,c,l)=>(r=a.call(e,r),l=r.done,Promise.resolve(r.value).then(f=>s({value:f,done:l}),c)))),n("next"),n("return"),t);import{c as Vt,r as u,h as Zt,j as m,_ as Mt}from"./kfrdmkli83ureki3.js";import{az as $t,cy as kt,aA as zt,P as Ft,ia as Gt,b7 as mt,W as vt,u as Wt,J as ht,bp as Kt,pU as Rt,re as te}from"./kw08ajijqinojrwh.js";import{lQ as Ut,lR as Ht,e1 as bt,lS as jt,e2 as Ot,lT as ee,lU as ne,lV as oe,cx as ie,lW as se,lX as At}from"./fyw02vlaiv2vq6cj.js";import{I as ae,P as re,a as ce,b as le,c as de,d as ue}from"./ehyvmdoziyg4axk8.js";const fe=$t(()=>Mt(()=>import("./ffrotvb922yxp30i.js"),__vite__mapDeps([0,1])),{loading:e=>zt(e)}),_e=$t(()=>Mt(()=>import("./nlj7ey81i8rm36n9.js"),__vite__mapDeps([2,1])),{loading:e=>zt(e)});function pe(e){"use forget";const t=Vt.c(58),{images:n,initialIndex:d,className:a,aspect:r,objectPosition:s,showDots:c,showArrows:l,imageClassName:f,allowLoop:v,onClick:i}=e,F=d===void 0?0:d,y=a===void 0?"":a,E=r===void 0?"aspect-[16/9]":r,G=s===void 0?"object-cover":s,B=c===void 0?!0:c,k=l===void 0?!0:l,A=f===void 0?"":f,S=v===void 0?!0:v,[_,K]=u.useState(F),[J,C]=u.useState(!1),[q,W]=u.useState(!1),V=u.useRef(null),j=Zt();let R;t[0]===Symbol.for("react.memo_cache_sentinel")?(R={active:!1,startX:0,lastX:0,dx:0,width:1,lastTime:0,velocity:0,captured:!1,programmaticTargetIndex:null},t[0]=R):R=t[0];const g=u.useRef(R),h=n.length;let b;t[1]!==S||t[2]!==h?(b=(o,x)=>{const I=x===void 0?"smooth":x,N=V.current;if(!N)return;const ct=S?ge(o,0,h-1):Pt(o,0,h-1),ft=g.current.width||N.clientWidth||1;g.current.programmaticTargetIndex=ct,N.scrollTo({left:ct*ft,behavior:I}),K(ct)},t[1]=S,t[2]=h,t[3]=b):b=t[3];const O=b;let D,H;t[4]!==k?(D=()=>{if(!k)return;W(!0);const o=window.setTimeout(()=>W(!1),2e3);return()=>window.clearTimeout(o)},H=[k],t[4]=k,t[5]=D,t[6]=H):(D=t[5],H=t[6]),u.useEffect(D,H);const $=J,T=J||q;let U;t[7]!==O?(U=o=>{O(o,"smooth")},t[7]=O,t[8]=U):U=t[8];const w=U;let z;t[9]!==w||t[10]!==_?(z=()=>w(_+1),t[9]=w,t[10]=_,t[11]=z):z=t[11];const yt=z;let nt;t[12]!==w||t[13]!==_?(nt=()=>w(_-1),t[12]=w,t[13]=_,t[14]=nt):nt=t[14];const Y=nt;let Z,tt;t[15]===Symbol.for("react.memo_cache_sentinel")?(Z=()=>{const o=V.current;if(!o)return;const x=new ResizeObserver(I=>{for(const N of I)g.current.width=N.contentRect.width||o.clientWidth||1});return x.observe(o),g.current.width=o.clientWidth||1,()=>x.disconnect()},tt=[],t[15]=Z,t[16]=tt):(Z=t[15],tt=t[16]),u.useEffect(Z,tt);let Q,P;t[17]!==_||t[18]!==h?(Q=()=>{const o=V.current;if(!o)return;const x=()=>{const I=g.current.width||o.clientWidth||1,N=o.scrollLeft||0,ct=N/I,ft=g.current.programmaticTargetIndex;if(ft!=null){const Bt=ft*I;Math.abs(N-Bt)<=2&&(g.current.programmaticTargetIndex=null);return}let wt=_;ct>_+.5?wt=Pt(_+1,0,h-1):ct<_-.5&&(wt=Pt(_-1,0,h-1)),wt!==_&&K(wt)};return o.addEventListener("scroll",x,{passive:!0}),()=>o.removeEventListener("scroll",x)},P=[h,_],t[17]=_,t[18]=h,t[19]=Q,t[20]=P):(Q=t[19],P=t[20]),u.useEffect(Q,P);const X="select-none ".concat(y," relative");let lt,dt;t[21]===Symbol.for("react.memo_cache_sentinel")?(lt=()=>C(!0),dt=()=>C(!1),t[21]=lt,t[22]=dt):(lt=t[21],dt=t[22]);const gt="relative w-full ".concat(E," overflow-clip");let ot;if(t[23]!==A||t[24]!==n||t[25]!==j||t[26]!==G||t[27]!==i){let o;t[29]!==A||t[30]!==j||t[31]!==G||t[32]!==i?(o=(x,I)=>{var N;return m.jsx("div",{onClick:()=>i==null?void 0:i(x,I),className:"relative h-full w-full shrink-0 grow-0 basis-full snap-center",children:x.content?x.content:m.jsx("img",{src:x.src,alt:(N=x.alt)!=null?N:j.formatMessage({id:"wHCsqa",defaultMessage:"Slide {index}"},{index:I+1}),className:"h-full w-full ".concat(G," ").concat(A)})},I)},t[29]=A,t[30]=j,t[31]=G,t[32]=i,t[33]=o):o=t[33],ot=n.map(o),t[23]=A,t[24]=n,t[25]=j,t[26]=G,t[27]=i,t[28]=ot}else ot=t[28];let it;t[34]!==ot?(it=m.jsx("div",{ref:V,className:"no-scrollbar flex h-full w-full touch-pan-x snap-x snap-mandatory overflow-x-scroll scroll-smooth",children:ot}),t[34]=ot,t[35]=it):it=t[35];let st;t[36]!==n.length||t[37]!==j||t[38]!==$||t[39]!==yt||t[40]!==Y||t[41]!==T||t[42]!==k?(st=k&&n.length>1&&m.jsxs(m.Fragment,{children:[m.jsx(Dt,{ariaLabel:j.formatMessage({id:"l9pylv",defaultMessage:"Previous slide"}),onClick:Y,side:"start",visible:$,children:m.jsx(_e,{className:"icon-md"})}),m.jsx(Dt,{ariaLabel:j.formatMessage({id:"L0pbQh",defaultMessage:"Next slide"}),onClick:yt,side:"end",visible:T,children:m.jsx(fe,{className:"icon-md"})})]}),t[36]=n.length,t[37]=j,t[38]=$,t[39]=yt,t[40]=Y,t[41]=T,t[42]=k,t[43]=st):st=t[43];let at;t[44]!==gt||t[45]!==it||t[46]!==st?(at=m.jsxs("div",{className:gt,children:[it,st]}),t[44]=gt,t[45]=it,t[46]=st,t[47]=at):at=t[47];let rt;t[48]!==w||t[49]!==n||t[50]!==_||t[51]!==j||t[52]!==B?(rt=B&&n.length>1&&n.length<=20&&m.jsx("div",{className:"absolute start-0 end-0 bottom-3 flex items-center justify-center gap-2",children:n.map((o,x)=>m.jsx("button",{onClick:()=>w(x),"aria-label":j.formatMessage({id:"PUV+4+",defaultMessage:"Go to slide {index}"},{index:x+1}),className:"h-1.5 w-1.5 rounded-full transition-opacity ".concat(x===_?"bg-black":"bg-gray-400 opacity-60 dark:bg-gray-600")},x))}),t[48]=w,t[49]=n,t[50]=_,t[51]=j,t[52]=B,t[53]=rt):rt=t[53];let ut;return t[54]!==X||t[55]!==at||t[56]!==rt?(ut=m.jsxs("div",{className:X,"aria-roledescription":"carousel",onMouseEnter:lt,onMouseLeave:dt,children:[at,rt]}),t[54]=X,t[55]=at,t[56]=rt,t[57]=ut):ut=t[57],ut}const Pt=(e,t,n)=>Math.min(Math.max(e,t),n),ge=(e,t,n)=>e>n?t:e<t?n:e;function Dt(e){"use forget";const t=Vt.c(8),{ariaLabel:n,onClick:d,side:a,visible:r,children:s}=e,c=a==="start"?"start-3":"end-3",l=r?"opacity-90 pointer-events-auto":"opacity-0 pointer-events-none";let f;t[0]!==c||t[1]!==l?(f=kt("btn-secondary border-token-border-default active:bg-token-bg-tertiary hover:bg-token-bg-primary absolute top-1/2 flex h-8 w-8 -translate-y-1/2 items-center justify-center rounded-full bg-clip-padding backdrop-blur transition-opacity duration-300 hover:shadow-[0px_4px_16px_0px_rgba(0,0,0,0.05)] active:opacity-100!",l,c),t[0]=c,t[1]=l,t[2]=f):f=t[2];let v;return t[3]!==n||t[4]!==s||t[5]!==d||t[6]!==f?(v=m.jsx("button",{"aria-label":n,onClick:d,className:f,children:s}),t[3]=n,t[4]=s,t[5]=d,t[6]=f,t[7]=v):v=t[7],v}const _t=new Map;async function he({productLookupKey:e}){const t=bt("".concat(vt,"/search/product_info_variants"),{method:"POST",headers:p({},mt({isAuthOptional:!0})),body:{product_lookup_key:e}});let n;try{for(var d=et(t),a,r,s;a=!(r=await d.next()).done;a=!1){const c=r.value;"data"in c&&(n=c.data)}}catch(r){s=[r]}finally{try{a&&(r=d.return)&&await r.call(d)}finally{if(s)throw s[0]}}return n}const Et=new Map;function me({clientThreadId:e,messageId:t,product:n,isInitialLoad:d}){var K,J,C,q;const a=(K=Ft(e))!=null?K:e,r=Gt(),s=Nt({conversationId:a,messageId:t,productQuery:n.title}),c=[a,t,n.title].join(":"),[l,f]=u.useState((J=_t.get(c))==null?void 0:J.productReviews),[v,i]=u.useState((C=_t.get(c))==null?void 0:C.productRationale),[F,y]=u.useState((q=_t.get(c))==null?void 0:q.__debug),[E,G]=u.useState(Et.get(s)),[B,k]=u.useState(!1),[A,S]=u.useState(!0),_=u.useRef(null);return u.useEffect(()=>{async function W({profiler:R,conversationId:g,messageId:h,productQuery:b,productLookupKey:O,updatePartial:D}){try{for(var H=et(ve({conversationId:g,messageId:h,productQuery:b,productLookupKey:O,persistConversationToUser:r.showDebugConversationTurns})),$,T,U;$=!(T=await H.next()).done;$=!1){const w=T.value;switch(w.type){case"product_reviews":{f(w),D({productReviews:w}),R.logTimingOnce("time_to_first_review"),k(!1);break}case"product_rationale":{i(w),D({productRationale:w}),R.logTimingOnce("time_to_rationale"),k(!1);break}case"__debug":{D({__debug:w}),y(w);break}}}}catch(T){U=[T]}finally{try{$&&(T=H.return)&&await T.call(H)}finally{if(U)throw U[0]}}k(!1)}async function V({profiler:R,productQuery:g,productLookupKey:h,updatePartial:b}){try{for(var O=et(be({productQuery:g,productLookupKey:h})),D,H,$;D=!(H=await O.next()).done;D=!1){const T=H.value;switch(T.type){case"product_entity":{if(s===_.current){const U=M(p({},T),{product:M(p({},T.product),{product_lookup_key:M(p({},T.product.product_lookup_key),{variant_options_query:h==null?void 0:h.variant_options_query})})});b({productEntity:U}),G(U),S(!1),R.logTimingOnce("time_to_product_entity")}break}case"__debug":{b({__debug:T}),y(T);break}}}}catch(H){$=[H]}finally{try{D&&(H=O.return)&&await H.call(O)}finally{if($)throw $[0]}}}async function j({conversationId:R,messageId:g,productQuery:h,productLookupKey:b}){var $;const O=new Ut(Ht.ProductSidebar,{context:{version:"v2"}});let D={};function H(T){D=p(p({},D),T)}try{d&&k(!0),await Promise.allSettled([W({profiler:O,conversationId:R,messageId:g,productQuery:h,productLookupKey:b,updatePartial:H}),V({profiler:O,productQuery:h,productLookupKey:b,updatePartial:H})])}finally{d&&O.logTimingOnce("sidebar_loaded"),s===_.current&&(_.current=null,S(!1));const{productReviews:T,productRationale:U,__debug:w}=D;(T||U||w)&&_t.set(c,p(p(p(p({},($=_t.get(c))!=null?$:{}),T&&{productReviews:T}),U&&{productRationale:U}),w&&{__debug:w})),D.productEntity!==void 0&&Et.set(Nt({conversationId:R,messageId:g,productQuery:h}),D.productEntity)}}(async function(){const g=_t.get(c);g&&(g.productReviews&&f(g.productReviews),g.productRationale&&i(g.productRationale),g.__debug&&y(g.__debug));const h=Et.get(s);if(h){G(h),S(!1);return}a&&t&&_.current!==s&&(_.current=s,await j({conversationId:a,messageId:t,productQuery:n.title,productLookupKey:n.product_lookup_key}))})()},[t,n.title,s,a,d]),{productInfo:{productReviews:l,productRationale:v,productEntity:E,__debug:F},isLoadingReviewsOrRationale:B,isLoadingProductEntity:A,isCached:_t.has(c)}}function ve(r){return xt(this,arguments,function*({conversationId:e,messageId:t,productQuery:n,productLookupKey:d,persistConversationToUser:a}){var l;const s=bt("".concat(vt,"/sidebar/conversation"),{method:"POST",headers:M(p({},mt({isAuthOptional:!0})),{"Content-Type":"application/json"}),body:p({conversation_id:e,message_id:t,supported_encodings:[jt.V1],category:"product",product_params:p({product_query:n},d?{product_lookup_key:d}:{})},a?{debug_params:{persist_conversation_to_user:a}}:{})});let c=!1;try{for(var f=et(Ot(s)),v,i,F;v=!(i=yield new L(f.next())).done;v=!1){const y=i.value;if(!("data"in y))continue;const{type:E,data:G}=y.data;if(!c&&E==="__debug")c=!0,yield{type:"__debug",data:{conversation_link:"/c/".concat(G.conversation_id)}};else if(E==="message"){const k=(l=G.metadata)==null?void 0:l.content_references;if(!k)continue;for(const A of k){const S=A;if(!(d!=null&&d.variant_options_query&&S.type==="product_entity"&&!S.product.variants))switch(S.type){case"product_reviews":case"product_rationale":yield S;break;default:continue}}}}}catch(i){F=[i]}finally{try{v&&(i=f.return)&&(yield new L(i.call(f)))}finally{if(F)throw F[0]}}})}function be(n){return xt(this,arguments,function*({productQuery:e,productLookupKey:t}){const d=bt("".concat(vt,"/search/product_update"),{method:"POST",headers:M(p({},mt({isAuthOptional:!0})),{"Content-Type":"application/json"}),body:p({product_query:e},t?{product_lookup_key:t}:{})});try{for(var a=et(d),r,s,c;r=!(s=yield new L(a.next())).done;r=!1){const l=s.value;"data"in l&&(yield l.data)}}catch(s){c=[s]}finally{try{r&&(s=a.return)&&(yield new L(s.call(a)))}finally{if(c)throw c[0]}}})}function Nt({conversationId:e,messageId:t,productQuery:n}){return[e,t,n].join(":")}const pt=new Map,Ct=new Map;function ye({clientThreadId:e,messageId:t,product:n,isInitialLoad:d}){var q,W,V,j;const a=(q=Ft(e))!=null?q:e,r=Wt(),s=ht(r,"966859370"),c=ht(r,"1146160621"),l=a==e,f=qt({conversationId:a,messageId:t,productQuery:n.title,product:n}),v=[a,t,n.title].join(":"),[i,F]=u.useState((W=pt.get(v))==null?void 0:W.productReviews),[y,E]=u.useState((V=pt.get(v))==null?void 0:V.productRationale),[G,B]=u.useState((j=pt.get(v))==null?void 0:j.__debug),[k,A]=u.useState(Ct.get(f)),[S,_]=u.useState(!1),[K,J]=u.useState(!0),C=u.useRef(null);return u.useEffect(()=>{async function R(){const{chatReq:h,turnstileToken:b,proofToken:O}=await ee(r,void 0);return ne(h,b,O,null)}async function g({conversationId:h,isClientThread:b,messageId:O,isGenericEndpoint:D,productQuery:H,productLookupKey:$,sentinelHeaders:T,isProductInfoVariantsEndpointEnabled:U}){var tt;const w=new Ut(Ht.ProductSidebar,{context:{version:"v1"}}),z={};try{d&&_(!0);const Q=we({conversationId:h,isClientThread:b,messageId:O,isGenericEndpoint:D,productQuery:H,productLookupKey:$,sentinelHeaders:T,isProductInfoVariantsEndpointEnabled:U});try{for(var yt=et(Q),nt,Y,Z;nt=!(Y=await yt.next()).done;nt=!1){const P=Y.value;switch(P.type){case"product_reviews":{F(P),z.productReviews=P,w.logTimingOnce("time_to_first_review");break}case"product_rationale":{E(P),z.productRationale=P,w.logTimingOnce("time_to_rationale");break}case"product_entity":{if(f===C.current){const X=M(p({},P),{product:M(p({},P.product),{product_lookup_key:M(p({},P.product.product_lookup_key),{variant_options_query:$==null?void 0:$.variant_options_query})})});z.productEntity=X,A(X),w.logTimingOnce("time_to_product_entity"),J(!1)}break}case"__debug":{z.__debug=P,B(P);break}}(P.type==="product_reviews"||P.type==="product_rationale")&&_(!1)}}catch(Y){Z=[Y]}finally{try{nt&&(Y=yt.return)&&await Y.call(yt)}finally{if(Z)throw Z[0]}}}finally{d&&w.logTimingOnce("sidebar_loaded"),f===C.current&&(C.current=null,J(!1),_(!1));const{productReviews:Q,productRationale:P,__debug:X}=z;(Q||P||X)&&pt.set(v,p(p(p(p({},(tt=pt.get(v))!=null?tt:{}),Q&&{productReviews:Q}),P&&{productRationale:P}),X&&{__debug:X})),z.productEntity!==void 0&&Ct.set(qt({conversationId:h,messageId:O,productQuery:H,product:z.productEntity.product}),z.productEntity)}}(async function(){const b=pt.get(v);b&&(b.productReviews&&F(b.productReviews),b.productRationale&&E(b.productRationale),b.__debug&&B(b.__debug));const O=Ct.get(f);if(O){A(O),J(!1);return}a&&t&&C.current!==f&&(C.current=f,await g({conversationId:a,isClientThread:l,messageId:t,isGenericEndpoint:s,productQuery:n.title,productLookupKey:n.product_lookup_key,sentinelHeaders:s?await R():null,isProductInfoVariantsEndpointEnabled:c}))})()},[t,n.title,f,a,d]),{productInfo:{productReviews:i,productRationale:y,productEntity:k,__debug:G},isLoadingReviewsOrRationale:S,isLoadingProductEntity:K,isCached:pt.has(v)}}function we(l){return xt(this,arguments,function*({conversationId:e,isClientThread:t,messageId:n,isGenericEndpoint:d,productQuery:a,productLookupKey:r,sentinelHeaders:s,isProductInfoVariantsEndpointEnabled:c}){var E;const f=!!(r!=null&&r.variant_options_query);if(c&&f){const C=bt("".concat(vt,"/search/product_info_variants"),{method:"POST",headers:p({},mt({isAuthOptional:!0})),body:{product_lookup_key:r}});try{for(var v=et(C),i,F,y;i=!(F=yield new L(v.next())).done;i=!1){const q=F.value;"data"in q&&(yield q.data)}}catch(F){y=[F]}finally{try{i&&(F=v.return)&&(yield new L(F.call(v)))}finally{if(y)throw y[0]}}}else if(d){const C=bt("".concat(vt,"/sidebar/conversation"),{method:"POST",headers:M(p(p({},mt({isAuthOptional:!0})),s!=null?s:{}),{"Content-Type":"application/json"}),body:{conversation_id:e,message_id:n,supported_encodings:[jt.V1],is_client_thread:t,category:"product",product_params:p({product_query:a},r?{product_lookup_key:r}:{})}});let q=!1;try{for(var G=et(Ot(C)),B,k,A;B=!(k=yield new L(G.next())).done;B=!1){const W=k.value;if(!("data"in W))continue;const{type:V,data:j}=W.data;if(!q&&V==="__debug")q=!0,yield{type:"__debug",data:{conversation_link:"/c/".concat(j.conversation_id)}};else if(V==="message"){const g=(E=j.metadata)==null?void 0:E.content_references;if(!g)continue;for(const h of g){const b=h;if(!(r!=null&&r.variant_options_query&&b.type=="product_entity"&&!b.product.variants))switch(b.type){case"product_reviews":case"product_rationale":case"product_entity":yield b;break;default:continue}}}}}catch(k){A=[k]}finally{try{B&&(k=G.return)&&(yield new L(k.call(G)))}finally{if(A)throw A[0]}}}else{const C=bt("".concat(vt,"/search/product_info"),{method:"POST",headers:M(p({},mt({isAuthOptional:!0})),{"Content-Type":"application/json"}),body:p({conversation_id:e,is_client_thread:t,message_id:n,product_query:a,supported_encodings:[jt.V1]},r?{product_lookup_key:r}:{})}),q=Ot(C);try{for(var S=et(q),_,K,J;_=!(K=yield new L(S.next())).done;_=!1){const W=K.value;"data"in W&&(yield W.data)}}catch(K){J=[K]}finally{try{_&&(K=S.return)&&(yield new L(K.call(S)))}finally{if(J)throw J[0]}}}})}function qt({conversationId:e,messageId:t,productQuery:n,product:d}){var a;return[e,t,n,JSON.stringify((a=d.product_lookup_key)==null?void 0:a.variant_options_query)].join(":")}function je({product:e,setUpdatedProduct:t,clientThreadId:n,messageId:d,contentReferenceStartIndex:a,productIndex:r,analyticsMetadata:s,offsetTopMargin:c=!1}){var tt,Q,P,X,lt,dt,gt,ot,it,st,at,rt,ut;const l=Wt(),f=Kt(l),v=oe(s),[i,F]=u.useState(e),y=((tt=i.product_lookup_key)==null?void 0:tt.variant_options_query)==null,[E,G]=u.useState(null),[B,k]=u.useState(!1),[A,S]=u.useState(!1),{showDebugConversationTurns:_}=Gt(),K=ie.useStore(),J=u.useRef(!1),C=ht(l,"3375735072"),q=ht(l,"232003972"),W=ht(l,"4170238021"),V=ht(l,"966859370"),j=V?me:ye,R=se({namespace:"shopping_checkout"});u.useEffect(()=>{R==null||R.reset()},[e.id,R]);const{productInfo:g,isLoadingReviewsOrRationale:h,isLoadingProductEntity:b,isCached:O}=j({clientThreadId:n,messageId:d,product:i,isInitialLoad:y}),D=u.useRef(!1);u.useEffect(()=>{var x,I;const o=(x=g.productEntity)==null?void 0:x.product;o&&(!V&&((I=i.product_lookup_key)!=null&&I.variant_options_query)&&o.variants,J.current||F(N=>M(p({},o),{title:N.title}))),g.productEntity&&!D.current&&(D.current=!0,v("Product Sidebar Entity Loaded","product_sidebar_entity_loaded","product_entity"))},[g.productEntity,v]),u.useEffect(()=>{v("Product Detail Shown","product_detail_shown","product_entity",{product_id:e.id,product_url:e.url})},[]),u.useEffect(()=>{i&&t(i)},[i,t]),u.useEffect(()=>{var x;if(!V)return;async function o(){S(!0),R==null||R.startBlock("offer_variant_reload");try{const I=await he({productLookupKey:i.product_lookup_key}),N=I==null?void 0:I.product;N&&N.variants&&(F(ct=>{var ft;return M(p({},N),{title:(ft=N.title)!=null?ft:ct.title})}),J.current=!0)}catch(I){}finally{R==null||R.endBlock("offer_variant_reload"),S(!1)}}(x=i.product_lookup_key)!=null&&x.variant_options_query&&o()},[(Q=i.product_lookup_key)==null?void 0:Q.variant_options_query]);const H=u.useRef([]),$=u.useRef([]),T=(X=(P=i==null?void 0:i.offers)!=null?P:e.offers)!=null?X:[];for(const o of T)H.current.some(x=>x.merchant_name===o.merchant_name)||H.current.push(o);const U=(dt=(lt=i==null?void 0:i.image_urls)!=null?lt:e.image_urls)!=null?dt:[];for(const o of U)$.current.includes(o)||$.current.push(o);const w=i.num_reviews,z=i.rating,yt=i.rating_grouped_citation,nt=(gt=i==null?void 0:i.variants)!=null?gt:[],Y=C?i.image_urls:(ot=$.current)!=null?ot:[],Z=Y==null?void 0:Y.map(o=>({url:o,content_url:o,thumbnail_url:o,title:i.title,content_size:{width:0,height:0},thumbnail_size:{width:0,height:0}}));return m.jsxs("div",{className:kt("bg-token-bg-primary flex w-full flex-col",c?f?"mt-[calc(var(--threadFlyOut-leading-height,var(--header-height))*-1)] min-h-screen":"mt-[calc(var(--threadFlyOut-leading-height,53px)*-1)] min-h-screen":"mt-0"),children:[W?m.jsx(pe,{images:(it=Y==null?void 0:Y.map(o=>({src:o})))!=null?it:[],aspect:"aspect-square",objectPosition:"object-contain",imageClassName:"mix-blend-darken dark:mix-blend-lighten cursor-zoom-in",onClick:o=>{K.setCurrentImage({image:{url:o.src,content_url:o.src,thumbnail_url:o.src,title:e.title,content_size:{width:0,height:0},thumbnail_size:{width:0,height:0}},source:At.ImageGroup,analyticsMetadata:s,contentReferenceStartIndex:a,productIndex:r,imageResults:Z!=null?Z:[]})}}):m.jsx(ae,{imageUrls:Y,title:e.title,onImageClick:o=>{K.setCurrentImage({image:{url:o,content_url:o,thumbnail_url:o,title:e.title,content_size:{width:0,height:0},thumbnail_size:{width:0,height:0}},source:At.ImageGroup,analyticsMetadata:s,contentReferenceStartIndex:a,productIndex:r,imageResults:Z!=null?Z:[]})}}),m.jsxs("div",{className:"border-token-border-light flex flex-col border-t px-6 pt-4",children:[m.jsx("h2",{className:"text-xl",children:i.title}),w!=null&&w>0&&z!=null&&q&&m.jsx(re,{rating:z,numReviews:w,ratingGroupedCitation:yt,trackContentReferenceEvent:v,analyticsMetadata:s})]}),C&&!b&&(nt==null?void 0:nt.length)>0&&m.jsx("div",{className:kt("px-6 pt-4",A&&"pointer-events-none opacity-50"),"aria-busy":A,children:m.jsx(ce,{options:nt,showErrors:B,updateOption:(o,x,I)=>xe({optionGroupId:o,selectedId:x,variant_index:I,statefulProduct:i,setStatefulProduct:F,trackContentReferenceEvent:v,productIndex:r,productId:e.id})})}),E&&m.jsx("div",{className:"text-token-interactive-label-danger-secondary-default text-center",children:E}),m.jsx(le,{className:"border-token-border-light -mx-3 flex flex-col px-6 pt-4",offers:C?(st=i.offers)!=null?st:[]:(at=H.current)!=null?at:[],profiler:R,contentReferenceStartIndex:a,productIndex:r,product:i,trackContentReferenceEvent:v,analyticsMetadata:s,imageUrls:C?(rt=i.image_urls)!=null?rt:[]:(ut=$.current)!=null?ut:[],isLoading:C?b||A:!1,onOpenCheckout:()=>k(!0)}),h?m.jsxs("div",{className:"flex flex-col gap-4 px-6 py-6",children:[m.jsx(Rt,{index:0,width:50,heightSize:"sm"}),m.jsxs(te,{children:[m.jsx(Rt,{index:1,width:100,heightSize:"sm"}),m.jsx(Rt,{index:2,width:100,heightSize:"sm"}),m.jsx(Rt,{index:3,width:30,heightSize:"sm"})]})]}):m.jsxs("div",{className:"bg-token-bg-primary flex flex-col pt-4",children:[m.jsx(de,{contentReference:g.productRationale,trackContentReferenceEvent:v,disableAnimation:O}),m.jsx(ue,{contentReference:g.productReviews,trackContentReferenceEvent:v,disableAnimation:O})]}),!1]})}function xe({optionGroupId:e,selectedId:t,variant_index:n,statefulProduct:d,setStatefulProduct:a,trackContentReferenceEvent:r,productIndex:s,productId:c}){var f,v,i,F;const l=(f=d.variants)==null?void 0:f.find(y=>y.id===e);r("product_detail","product_detail","product_entity",{product_index:s,product_id:c,action:"variant_selected",section:"product_detail",section_location:"sidebar",variant_name:(v=l==null?void 0:l.label)!=null?v:"",variant_value:(F=(i=l==null?void 0:l.options.find(y=>y.id===t))==null?void 0:i.label)!=null?F:"",variant_index:n}),a(y=>{var k,A;const E=(A=(k=y.variants)==null?void 0:k.map(S=>S.id===e?M(p({},S),{options:S.options.map(_=>M(p({},_),{selected:_.id===t})),selected_option_id:t}):S))!=null?A:y.variants,B=(E==null?void 0:E.every(S=>S.selected_option_id))?E==null?void 0:E.reduce((S,_)=>(_.selected_option_id&&(S[_.id]=_.selected_option_id),S),{}):null;return M(p({},y),{variants:E,product_lookup_key:M(p({},y.product_lookup_key),{variant_options_query:B,last_variant_selection_group_id:e})})})}export{je as P};
//# sourceMappingURL=d7ayto02yo7jqocx.js.map
