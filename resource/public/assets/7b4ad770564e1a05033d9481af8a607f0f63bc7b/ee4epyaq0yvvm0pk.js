var We=Object.defineProperty,ze=Object.defineProperties;var Qe=Object.getOwnPropertyDescriptors;var Ae=Object.getOwnPropertySymbols;var Xe=Object.prototype.hasOwnProperty,Ye=Object.prototype.propertyIsEnumerable;var ye=(r,e,t)=>e in r?We(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,fe=(r,e)=>{for(var t in e||(e={}))Xe.call(e,t)&&ye(r,t,e[t]);if(Ae)for(var t of Ae(e))Ye.call(e,t)&&ye(r,t,e[t]);return r},_e=(r,e)=>ze(r,Qe(e));import{c as Pe,h as Ze,r as M,e as et,v as Te,j as g}from"./kfrdmkli83ureki3.js";import{u as tt,g as st,b9 as nt,d as Ce,M as at,B as ve,aB as ke,O as Ne,V as Re,a4 as Ee,a6 as ge,aw as ee,ay as B,bS as rt,n as ot,bk as it,l as lt,aR as ct,bM as ut,cj as dt}from"./kw08ajijqinojrwh.js";import{l$ as ft,m0 as gt,de as we,m1 as Se,fk as pt,fl as mt,m2 as ht,m3 as St,cd as Mt,m4 as xt,m5 as pe,m6 as bt,m7 as me,c1 as he,m8 as At,c2 as yt}from"./fyw02vlaiv2vq6cj.js";import{g as _t}from"./dd8hh2tmra1psngf.js";function Tt(r){"use forget";const e=Pe.c(66),{prompt:t,isComplete:p,clientThreadId:i,parentMessageId:m}=r,f=tt();let n;e[0]!==i||e[1]!==f?(n=st(f,i),e[0]=i,e[1]=f,e[2]=n):n=e[2];const a=n,c=Ze(),[l,U]=M.useState(!1),H=nt();let C;e[3]!==a?(C=()=>it(a).id,e[3]=a,e[4]=C):C=e[4];const x=Ce(C);let u;e[5]!==t?(u=()=>pt(t?[t]:[]),e[5]=t,e[6]=u):u=e[6];const[d,$]=M.useState(u),y=M.useRef(null),_=at(i,vt),D=Ce(ve.agentSafeModeHasSeenNux$),s=et({startDefault:{id:"auraAgentSuggestion.startDefault",defaultMessage:"Continue"},cancel:{id:"auraAgentSuggestion.cancel",defaultMessage:"No thanks"},accepted:{id:"auraAgentSuggestion.accepted",defaultMessage:"The user has asked for agent to complete their task."}}),G=M.useRef(!1);let S,b;e[7]===Symbol.for("react.memo_cache_sentinel")?(S=()=>(y.current||(y.current=new mt([],o=>{$(o)},!0)),()=>{var o;(o=y.current)==null||o.destroy(),y.current=null}),b=[],e[7]=S,e[8]=b):(S=e[7],b=e[8]),M.useEffect(S,b);let A,v;e[9]!==p||e[10]!==t?(A=()=>{var h;const o=t?[t]:[];o.length===0&&$([]),(h=y.current)==null||h.onMessagePartsUpdated(o,!p)},v=[t,p],e[9]=p,e[10]=t,e[11]=A,e[12]=v):(A=e[11],v=e[12]),M.useEffect(A,v);const[Fe,je]=M.useState(!1);let q;e[13]===Symbol.for("react.memo_cache_sentinel")?(q=()=>{var o,h;je((h=(o=y.current)==null?void 0:o.isComplete())!=null?h:!1)},e[13]=q):q=e[13];let K;e[14]!==d?(K=[d],e[14]=d,e[15]=K):K=e[15],M.useEffect(q,K);let V,J;e[16]!==i||e[17]!==x||e[18]!==_?(V=()=>{if(G.current||!x||_)return;G.current=!0;const o=h=>{lt(i,T=>{T.conduitToken=h,T.prepareState="success"})};ht(i,x,[ge.Agent],o,{isRegen:!1,isOnboardingConversation:!1,delayAfterCompletion:!1})},J=[i,x,_],e[16]=i,e[17]=x,e[18]=_,e[19]=V,e[20]=J):(V=e[19],J=e[20]),M.useEffect(V,J);const te=D===!1,Ie=Ct,Le=()=>c.formatMessage(s.accepted);let W;e[21]!==te?(W=()=>{te&&St(!0)},e[21]=te,e[22]=W):W=e[22];const z=W;let Q;e[23]===Symbol.for("react.memo_cache_sentinel")?(Q={isAgentHintActive:!0},e[23]=Q):Q=e[23];const{agentSessionModeNuxModal:se,ensureAgentSessionModeNux:Oe,isAgentSessionModeNuxOpen:Be}=ft(Q),Me=async o=>{var be;if(l||!t)return;z();const h=Ne(i),T=h?Re.lastUserMessage(h):null;if(!T){Ee.error("AuraAgentSuggestion: Unable to find last user message",{clientThreadId:i,parentMessageId:m});return}U(!0),H(ge.Agent);const xe=o?Ie(o):void 0,qe={id:Te(),author:{role:B.Tool,name:Se},create_time:Date.now()/1e3,content:{content_type:ee.Text,parts:[Le()]},recipient:"all",status:"finished_successfully",weight:0},Ke=fe(_e(fe({},(be=T.metadata)!=null?be:{}),{is_visually_hidden_from_conversation:!0}),xe!==void 0&&{n7jupd_local_safe_mode:xe}),Ve=rt("",Ke),Je={systemHints:[ge.Agent],conversationMode:{kind:ot.PrimaryAssistant}};await we({conversation:a,promptMessage:Ve,eventSource:"mouse",prependMessages:[qe],completionMetadata:Je})};let X;e[24]!==z||e[25]!==a||e[26]!==l?(X=async()=>{if(l)return;z(),U(!0);const o={id:Te(),author:{role:B.Tool,name:Se},create_time:Date.now()/1e3,content:{content_type:ee.Text,parts:["The user has declined to use Agent, answer their question directly"]},recipient:"all",status:"finished_successfully",weight:0};await we({conversation:a,promptMessage:o,eventSource:"mouse"})},e[24]=z,e[25]=a,e[26]=l,e[27]=X):X=e[27];const ne=X;if(!t)return null;let Y;e[28]!==d?(Y=gt(d),e[28]=d,e[29]=Y):Y=e[29];const ae=Y,re=c.formatMessage(s.startDefault),oe=()=>{const o=ve.agentSessionMode$();Oe(T=>{Me(T)})||Me(o)},ie=D===!0&&!Be;let k;e[30]===Symbol.for("react.memo_cache_sentinel")?(k=_t(!1),e[30]=k):k=e[30];const Ue="text-token-text-primary mb-2 flex max-w-full flex-col gap-6",le=!p;let w;e[31]!==ae||e[32]!==le?(w=g.jsx(Mt,{className:"text-token-text-primary text-base leading-6 break-words",isActivelyStreaming:le,children:ae}),e[31]=ae,e[32]=le,e[33]=w):w=e[33];const De="flex flex-col gap-3 transition-opacity duration-200",ce=Fe?1:0;let P;e[34]!==ce?(P={opacity:ce},e[34]=ce,e[35]=P):P=e[35];const He="flex flex-col gap-2 min-[420px]:flex-row min-[420px]:items-center min-[420px]:justify-end min-[420px]:gap-3",$e="flex flex-col-reverse gap-2 min-[420px]:flex-row min-[420px]:flex-wrap min-[420px]:gap-2",ue=ke,Ge="secondary",de=c.formatMessage(s.cancel);let N;e[36]!==ue||e[37]!==ne||e[38]!==l||e[39]!==de?(N=g.jsx(ue,{color:Ge,onClick:ne,disabled:l,children:de}),e[36]=ue,e[37]=ne,e[38]=l,e[39]=de,e[40]=N):N=e[40];let R;e[41]!==oe||e[42]!==l||e[43]!==re?(R=g.jsx(ke,{color:"primary",onClick:oe,disabled:l,children:re}),e[41]=oe,e[42]=l,e[43]=re,e[44]=R):R=e[44];let E;e[45]!==N||e[46]!==R?(E=g.jsxs("div",{className:$e,children:[N,R]}),e[45]=N,e[46]=R,e[47]=E):E=e[47];let F;e[48]!==l||e[49]!==ie?(F=ie?g.jsx(xt,{disabled:l,showLeadingDivider:!0}):null,e[48]=l,e[49]=ie,e[50]=F):F=e[50];let j;e[51]!==E||e[52]!==F?(j=g.jsxs("div",{className:He,children:[E,F]}),e[51]=E,e[52]=F,e[53]=j):j=e[53];let I;e[54]!==P||e[55]!==j?(I=g.jsx("div",{className:De,style:P,children:j}),e[54]=P,e[55]=j,e[56]=I):I=e[56];let L;e[57]!==w||e[58]!==I?(L=g.jsxs("div",{className:Ue,children:[w,I]}),e[57]=w,e[58]=I,e[59]=L):L=e[59];let O;e[60]!==k||e[61]!==L?(O=g.jsx("div",{className:k,children:L}),e[60]=k,e[61]=L,e[62]=O):O=e[62];let Z;return e[63]!==se||e[64]!==O?(Z=g.jsxs(g.Fragment,{children:[O,se]}),e[63]=se,e[64]=O,e[65]=Z):Z=e[65],Z}function Ct(r){return r==="incognito"}function vt(r){var e;return(e=r==null?void 0:r.prepareRequestBlocked)!=null?e:!1}const kt={close_tabs:{inProgress:"Closing tabs",finished:"Closed tabs",error:"Failed to close tabs"},open_tabs:{inProgress:"Opening tabs",finished:"Opened tabs",error:"Failed to open tabs"},list_tabs:{inProgress:"Listing tabs",finished:"Listed tabs",error:"Failed to list tabs"},focus_tab:{inProgress:"Focusing tab",finished:"Focused tab",error:"Failed to focus tab"},navigate_current_tab:{inProgress:"Navigating current tab",finished:"Navigated current tab",error:"Failed to navigate current tab"},set_tab_pinned_state:{inProgress:"Updating tab pin state",finished:"Updated tab pin state",error:"Failed to update tab pin state"},set_preference:{inProgress:"Setting preference",finished:"Updated preference",error:"Failed to set preference"},add_bookmark:{inProgress:"Adding bookmark",finished:"Added bookmark",error:"Failed to add bookmark"},reorder_tabs:{inProgress:"Reordering tabs",finished:"Reordered tabs",error:"Failed to reorder tabs"},search_browsing_history:{inProgress:"Searching browser memories",finished:"Searching browser memories",error:"Failed to search browser memories"}},wt=Object.fromEntries(Object.entries(kt).map(([r,e])=>["".concat(ct,".").concat(r),e])),Pt={inProgress:"Running tool",finished:"Finished running tool",error:"Error running tool"};function Nt(r,e){const t=wt[r];return t?t[e]:Pt[e]}function Rt({messages:r,isRequestActive:e,isLastMessageInTurn:t,clientThreadId:p}){"use no forget";var _,D;const i=r.filter(s=>s.author.role===B.Assistant&&s.recipient&&pe(s.recipient)),m=Ne(p),f=m?Re.getConversationTurns(m).flatMap(s=>s.messages):[],n=f.findLastIndex(s=>s.author.role===B.Assistant&&s.recipient&&pe(s.recipient)),a=n>=0?f[n]:void 0,c=a&&a.recipient,l=n>=0?f.slice(n+1).filter(s=>s.author.role===B.Tool&&s.author.name===c):[],U=n>=0?f.slice(n+1).find(s=>s.author.role===B.Assistant&&(!s.recipient||!pe(s.recipient))):void 0,H=U!=null&&ut(U),C=l.length>0,x=a==null?void 0:a.id,u=bt(s=>x?s.getToolState(p,x):void 0);let d=null;C||(u==null?void 0:u.status)===me.Finished?d={key:"finished",status:he.Finished}:(u==null?void 0:u.status)===me.Error?d={key:"error",status:he.Error}:((u==null?void 0:u.status)===me.Running||e&&t&&!u)&&(d={key:"inProgress",status:he.Running});const $=M.useMemo(()=>!c||!d?null:Nt(c,d.key),[c,d]);if(i.length===0||!c||!i.some(s=>s.id===(a==null?void 0:a.id)))return null;if(c===Se){if(!a||l.length>0||H)return null;let s="";a.content.content_type===ee.Text?s=(D=(_=a.content.parts)==null?void 0:_[0])!=null?D:"":a.content.content_type===ee.Code&&(s=a.content.text);const G=a.status==="finished_successfully",[S]=At(s,v=>dt(v)),b=!S&&s.trim().length>0?s:null;b&&Ee.error("BrowserToolMessage: failed to parse SuggestAgent arguments",{args:s});let A="";return typeof(S==null?void 0:S.prompt)=="string"?A=S.prompt:b&&(A=b),{type:"suggestion",prompt:A,isComplete:G,parentMessageId:a.id}}return H||!d?null:{type:"message",message:$,display:d}}function Ot(r){"use forget";const e=Pe.c(13),{messages:t,isRequestActive:p,isLastMessageInTurn:i,clientThreadId:m}=r;let f;e[0]!==m||e[1]!==i||e[2]!==p||e[3]!==t?(f={messages:t,isRequestActive:p,isLastMessageInTurn:i,clientThreadId:m},e[0]=m,e[1]=i,e[2]=p,e[3]=t,e[4]=f):f=e[4];const n=Rt(f);if(!n)return null;if(n.type==="suggestion"){let c;return e[5]!==m||e[6]!==n.isComplete||e[7]!==n.parentMessageId||e[8]!==n.prompt?(c=g.jsx(Tt,{prompt:n.prompt,isComplete:n.isComplete,clientThreadId:m,parentMessageId:n.parentMessageId}),e[5]=m,e[6]=n.isComplete,e[7]=n.parentMessageId,e[8]=n.prompt,e[9]=c):c=e[9],c}let a;return e[10]!==n.display.status||e[11]!==n.message?(a=g.jsx(yt,{highlightedCommand:n.message,showWorkUserSetting:!1,status:n.display.status,children:null}),e[10]=n.display.status,e[11]=n.message,e[12]=a):a=e[12],a}export{Ot as BrowserToolMessage};
//# sourceMappingURL=ee4epyaq0yvvm0pk.js.map
