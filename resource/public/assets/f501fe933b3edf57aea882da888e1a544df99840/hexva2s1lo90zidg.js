import{B as Ie,dp as Qe,S as O,P as B,a as A,av as Je,aw as Ve,bd as se,dm as ge,bf as L,bY as Ce,fz as Xe,gy as Ze,d as q,gd as $e,bJ as he,ab as es,c4 as Te,c5 as ee,aE as ss,au as te,T as H,j as xe,ag as oe,U as me,ds as ts,c3 as je,s as ve,cm as as,L as ne,C as de}from"./n26mv7rx7nquqst2.js";import{c as re,r as h,j as e,M as r,L as os,aw as Ee,au as Le,a as rs,b as ls,u as Me,f as is}from"./n1tvutderx19k1zs.js";import{gD as ns,U as ds,H as cs,gE as us,gF as gs,gG as ms,gH as ke,gI as hs,cn as xs,gJ as Ms,gK as fs,gL as ps,gM as bs,go as ys,gN as Ss,gO as Cs,bK as Be,fG as we,gP as Ts,gQ as js,fm as vs,K as ks,gR as ws,ch as Us,gS as Ps,gT as _s,gU as Hs,e7 as U,gV as Ns,gW as Is,gX as Es}from"./pceg3mlzf8dzw9ob.js";function Ls({onSuccess:s,onError:t}){const o=rs();return ls({mutationFn:({userContext:n})=>oe.createOrUpdateUserSystemMessage(n),onSettled:(n,m)=>{const c=["userContext"];n!==null&&!m?o.setQueryData(c,n):o.invalidateQueries({queryKey:c})},onSuccess:s,onError:t})}function Bs(s){const t=re(),o=Ie();return Me({queryKey:["userContext"],queryFn:()=>oe.getUserSystemMessage().catch(n=>{throw o.danger(t.formatMessage({id:"userContextModal.getCustomInstructionsError",defaultMessage:"Failed to get your settings"})),n}),enabled:s,select:n=>({aboutUserMessage:n?.about_user_message??"",aboutModelMessage:n?.about_model_message??"",nameUserMessage:n?.name_user_message??"",roleUserMessage:n?.role_user_message??"",traitsModelMessage:n?.traits_model_message??"",otherUserMessage:n?.other_user_message??"",disabledTools:n?.disabled_tools??[],enabled:n?.enabled??!0})})}function As(){return Me({queryKey:["userIsInSearchHoldoutWithWebDisabled"],queryFn:()=>oe.getUserIsInSearchHoldoutWithWebDisabled().catch(s=>{throw s}),select:s=>({userIsInSearchHoldoutWithWebDisabled:s?.user_is_in_search_holdout_with_web_disabled??!1})})}const Ue={aboutUserMessage:void 0,aboutModelMessage:void 0,nameUserMessage:void 0,roleUserMessage:void 0,traitsModelMessage:void 0,otherUserMessage:void 0,disabledTools:void 0,enabled:void 0};function Zs({isModalOpen:s}){const t=re(),o=Ie(),n=ns(),[m,c]=h.useState(!1),{isLoading:g,data:v}=Bs(s),{aboutUserMessage:x="",aboutModelMessage:C="",nameUserMessage:d="",roleUserMessage:u="",traitsModelMessage:f="",otherUserMessage:M="",disabledTools:p=[],enabled:k}=v??{},[_,b]=h.useState(Ue),{aboutUserMessage:j,aboutModelMessage:T,nameUserMessage:w,roleUserMessage:N,traitsModelMessage:I,otherUserMessage:D,disabledTools:R,enabled:y}=_,S=y??!!k,[F,le]=h.useState(null),K=h.useCallback(()=>{ds.closeModal(cs.UserContext),b(Ue),le(null)},[]),{isPending:Y,mutate:fe}=Ls({onSuccess:()=>{K()},onError:i=>(i.response?.reason==="content_policy"&&i.response?.field?le(i.response?.field):o.danger(t.formatMessage({id:"userContextModal.saveError",defaultMessage:"Failed to update settings"})),i)}),[pe,be]=h.useState(!1),[Q,ze]=h.useState(!1),[ie,Fe]=h.useState([]),J=[j,T,w,N,I,D].some(i=>ae(i??"")),V=[{local:T,server:C},{local:j,server:x},{local:w,server:d},{local:N,server:u},{local:I,server:f},{local:D,server:M}].some(({local:i,server:a})=>i!==void 0&&i!==a)||R!==void 0&&!Qe(R,p)||y!==void 0&&y!==k,X=h.useCallback(()=>{O.logEvent("chatgpt_user_context_cancel_clicked"),B.logEvent(A.userContextCancelClicked),V?be(!0):K()},[K,V]),ye=h.useCallback(async()=>{if(!Y){le(null);const i={aboutUserMessage:j??"",aboutModelMessage:T??"",nameUserMessage:w??"",roleUserMessage:N??"",traitsModelMessage:I??"",otherUserMessage:D??"",disabledTools:R??[],enabled:!!y},a={name:d,role:u,traits:f,other:M},$={name:i.nameUserMessage,role:i.roleUserMessage,traits:i.traitsModelMessage,other:i.otherUserMessage,traitPillsSelected:ie};B.logEvent(A.userContextSaveCustomizeChatGPT,{previousState:a,newState:$}),O.logEvent("chatgpt_user_context_save_custom_instructions",void 0,{previousState:JSON.stringify(a),newState:JSON.stringify($)}),fe({userContext:i})}},[Y,T,j,w,N,I,D,R,y,ie,d,u,f,M,fe]),E=h.useCallback(()=>{if(J){const i=ae(j??""),a=ae(T??"");i&&(O.logEvent("chatgpt_user_context_modal__message_past_limit",void 0,{type:"about_user_message",limit:z.toString(),character_length:j?.length.toString()??""}),B.logEvent(A.userContextModelMessagePastLimit,{type:"about_user_message",limit:z.toString(),character_length:j?.length.toString()??""})),a&&(O.logEvent("chatgpt_user_context_modal__message_past_limit",void 0,{type:"about_model_message",limit:z.toString(),character_length:T?.length.toString()??""}),B.logEvent(A.userContextModelMessagePastLimit,{type:"about_model_message",limit:z.toString(),character_length:T?.length.toString()??""})),o.danger(t.formatMessage(l.messageLimitError,{limit:z}),{duration:4,hasCloseButton:!0});return}ye()},[t,J,T,j,ye,o]),{value:We}=Je("809056127"),{layer:Oe}=Ve("3206655705"),Ge=We&&Oe.get("enable_new_ux",!0),Z=h.useRef(null),[Se,qe]=h.useState(0),[Ke,Ye]=h.useState(!0);if(h.useEffect(()=>{const i=setTimeout(()=>{Ye(!1)},1e3),a=setInterval(()=>{qe($=>($+1)%ue.length)},5500);return()=>{clearInterval(a),clearTimeout(i)}},[]),h.useEffect(()=>{Q&&Z.current&&Z.current.scrollIntoView({behavior:"smooth",block:"start"})},[Q,Z]),s&&!pe&&Ge)return e.jsxs(se,{isOpen:s,onClose:X,type:"success",size:"custom",className:"max-w-xl",title:e.jsx(r,{...l.profileTitle}),description:e.jsxs("div",{className:"flex flex-row items-center text-token-text-secondary",children:[e.jsx("div",{className:"mr-1",children:e.jsx(r,{...l.profileSubtitle})}),e.jsx(ce,{primaryLabel:e.jsx("div",{className:"text-muted mx-3 mb-2 mt-2 text-sm font-normal",children:e.jsx(r,{...l.profileSubtitleTooltip,values:{link:i=>e.jsx(os,{className:"underline",target:"_blank",rel:"noreferrer",to:l.profileSubtitleTooltip.link??"",children:i})}})}),icon:e.jsx(us,{className:"h-4 w-4 text-token-text-tertiary"})})]}),children:[g?e.jsx("div",{className:"flex h-14 items-center justify-center",children:e.jsx(ge,{})}):e.jsxs("div",{className:"max-h-[60vh] overflow-y-auto md:max-h-[calc(100vh-300px)]",children:[e.jsx("p",{className:"text-muted py-2 text-sm font-medium",children:e.jsx(r,{...l.customizeName})}),e.jsx(W,{className:"mb-3",onSubmit:E,disabled:!S,hasModError:F==="name_user_message",value:w??d,placeholder:t.formatMessage(l.customizeNamePlaceholder),onChange:i=>b(a=>({aboutModelMessage:a.aboutModelMessage??C,aboutUserMessage:a.aboutUserMessage??x,nameUserMessage:i.target.value,roleUserMessage:a.roleUserMessage??u,traitsModelMessage:a.traitsModelMessage??f,otherUserMessage:a.otherUserMessage??M,enabled:a.enabled??S,disabledTools:a.disabledTools??p})),size:"sm",showCharacterCount:!1}),e.jsx("p",{className:"text-muted py-2 text-sm font-medium text-token-text-primary",children:e.jsx(r,{...l.customizeRole})}),e.jsxs("div",{className:"relative mb-3 overflow-hidden",children:[!(N??u)&&e.jsx(Ee,{mode:"wait",children:e.jsx(Le.span,{variants:Os,initial:Ke?!1:"initial",animate:"animate",exit:"exit",className:"pointer-events-none absolute left-[0.81rem] top-[0.55rem] text-sm text-gray-400",children:t.formatMessage(Ws[ue[Se]])},ue[Se])}),e.jsx(W,{onSubmit:E,disabled:!S,hasModError:F==="role_user_message",value:N??u,placeholder:"",onChange:i=>b(a=>({...a,roleUserMessage:i.target.value||"",aboutUserMessage:a.aboutUserMessage??x,aboutModelMessage:a.aboutModelMessage??C,nameUserMessage:a.nameUserMessage??d,traitsModelMessage:a.traitsModelMessage??f,otherUserMessage:a.otherUserMessage??M,disabledTools:a.disabledTools??p,enabled:a.enabled??S})),size:"sm",showCharacterCount:!1})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"text-muted mr-1 py-2 text-sm font-medium text-token-text-primary",children:e.jsx(r,{...l.customizeTraits})}),e.jsx(ce,{primaryLabel:e.jsx("div",{className:"text-muted mx-3 mb-[6px] mt-3 text-sm font-medium",children:e.jsx(r,{...l.traitsTooltipTitle})}),secondaryLabel:e.jsxs("ul",{className:"text-muted mx-2 mb-3 list-disc justify-start space-y-[6px] pl-5 text-sm text-token-text-primary",children:[e.jsx("li",{children:e.jsx(r,{...l.traitsTooltipBodyItem1})}),e.jsx("li",{children:e.jsx(r,{...l.traitsTooltipBodyItem2})}),e.jsx("li",{children:e.jsx(r,{...l.traitsTooltipBodyItem3})})]})})]}),e.jsx(W,{onSubmit:E,disabled:!S,hasModError:F==="traits_model_message",value:I??f,placeholder:t.formatMessage(l.customizeTraitsPlaceholder),onChange:i=>b(a=>({aboutUserMessage:"",aboutModelMessage:"",nameUserMessage:a.nameUserMessage??d,roleUserMessage:a.roleUserMessage??u,traitsModelMessage:i.target.value,otherUserMessage:a.otherUserMessage??M,enabled:a.enabled??S,disabledTools:a.disabledTools??p})),size:"md",showCharacterCount:!1,isNewCustomInstructionsUIEnabled:!0}),e.jsx("div",{className:"mb-4",children:e.jsx(Rs,{onSelect:i=>{b(a=>({...a,traitsModelMessage:`${a.traitsModelMessage??f} ${i}`.trim(),aboutUserMessage:"",aboutModelMessage:"",nameUserMessage:a.nameUserMessage??d,roleUserMessage:a.roleUserMessage??u,otherUserMessage:a.otherUserMessage??M,disabledTools:a.disabledTools??p,enabled:a.enabled??S}))},selectedTraits:ie,setSelectedTraits:Fe})}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"text-muted mr-1 py-2 text-sm font-medium text-token-text-primary",children:e.jsx(r,{...l.customizeOther})}),e.jsx(ce,{primaryLabel:e.jsx("div",{className:"text-muted mx-3 mb-2 mt-3 text-sm font-medium",children:e.jsx(r,{...l.otherTooltipTitle})}),secondaryLabel:e.jsxs("ul",{className:"text-muted mx-2 mb-3 list-disc justify-start space-y-[6px] pl-5 text-sm text-token-text-primary",children:[e.jsx("li",{children:e.jsx(r,{...l.otherTooltipBodyItem1})}),e.jsx("li",{children:e.jsx(r,{...l.otherTooltipBodyItem2})}),e.jsx("li",{children:e.jsx(r,{...l.otherTooltipBodyItem3})})]})})]}),e.jsx(W,{onSubmit:E,disabled:!S,hasModError:F==="other_user_message",value:D??M,placeholder:t.formatMessage(l.customizeOtherPlaceholder),onChange:i=>b(a=>({aboutUserMessage:"",aboutModelMessage:"",nameUserMessage:a.nameUserMessage??d,roleUserMessage:a.roleUserMessage??u,traitsModelMessage:a.traitsModelMessage??f,otherUserMessage:i.target.value,enabled:a.enabled??S,disabledTools:a.disabledTools??p})),size:"md",showCharacterCount:!1,isNewCustomInstructionsUIEnabled:!0}),e.jsxs("div",{className:"mt-3 pb-8",ref:Z,children:[e.jsxs("button",{onClick:()=>ze(i=>!i),className:"text-muted flex items-center justify-between py-2 text-sm font-medium text-token-text-primary",children:[e.jsx(r,{...l.advanced}),Q?e.jsx(gs,{className:"ml-1 h-5 w-5"}):e.jsx(ms,{className:"ml-1 h-5 w-5"})]}),Q&&e.jsx("div",{className:"mt-2",children:e.jsx(_e,{disabledTools:_.disabledTools??p??[],onDisabledToolsChanged:i=>b(a=>({aboutUserMessage:"",aboutModelMessage:"",nameUserMessage:a.nameUserMessage??d,roleUserMessage:a.roleUserMessage??u,traitsModelMessage:a.traitsModelMessage??f,otherUserMessage:a.otherUserMessage??M,enabled:a.enabled??S,disabledTools:i})),isNewCustomInstructionsUIEnabled:!0})})]})]}),e.jsx("div",{className:"-ml-6 -mr-6 border-t",children:e.jsxs("div",{className:"ml-6 mr-6 flex flex-grow flex-col items-stretch justify-between gap-0 pb-1 pt-2 sm:flex-row sm:items-center sm:gap-3",children:[e.jsxs("label",{className:"mt-5 flex cursor-pointer flex-row justify-between gap-2 sm:mt-4",children:[e.jsx(ke,{enabled:S,onChange:i=>{b(a=>({aboutUserMessage:"",aboutModelMessage:"",nameUserMessage:a.nameUserMessage??d,roleUserMessage:a.roleUserMessage??u,traitsModelMessage:a.traitsModelMessage??f,otherUserMessage:a.otherUserMessage??M,enabled:i,disabledTools:a.disabledTools??p}))},label:S?t.formatMessage(l.disableToggleLabel):t.formatMessage(l.enableToggleLabel)}),e.jsx("div",{className:"self-center text-sm text-token-text-primary",children:e.jsx(r,{...l.chatPreferencesEnable})})]}),e.jsx(L.Actions,{secondaryButton:e.jsx(L.Button,{onClick:X,children:e.jsx(r,{...l.cancel})}),primaryButton:e.jsx(L.Button,{loading:Y,onClick:E,color:"primary",visuallyDisabled:J,disabled:!V,children:e.jsx(r,{...l.save})})})]})})]},"user-context");if(s&&n&&!m)return e.jsx(hs,{onClose:()=>{c(!0)}});if(s&&pe){const i=()=>{be(!1),O.logEvent("chatgpt_user_context_confirm_close_clicked"),B.logEvent(A.userContextConfirmCloseClicked)};return e.jsx(se,{isOpen:!0,onClose:i,type:"success",title:t.formatMessage(l.confirmCloseTitle),primaryButton:e.jsx(L.Button,{title:t.formatMessage(l.confirmCloseOk),color:"danger",onClick:()=>{K(),i()}}),secondaryButton:e.jsx(L.Button,{title:t.formatMessage(l.confirmCloseCancel),color:"secondary",onClick:i}),children:e.jsx("div",{className:"text-sm",children:e.jsx(r,{...l.confirmCloseBody})})},"confirm-close")}return e.jsxs(se,{isOpen:s,onClose:X,type:"success",size:"custom",className:"max-w-lg xl:max-w-xl",title:e.jsx(r,{...l.profileTitle}),children:[g?e.jsx("div",{className:"flex h-14 items-center justify-center",children:e.jsx(ge,{})}):e.jsxs("div",{className:"max-h-[60vh] overflow-y-auto md:max-h-[calc(100vh-300px)]",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"text-sm font-semibold",children:e.jsx(r,{...l.customInstructionsTitle})}),e.jsx(Ae,{label:e.jsx(r,{...l.customInstructionsTooltip,values:{article:i=>e.jsx("a",{href:xs,target:"_blank",className:"underline",rel:"noreferrer",children:i})}})})]}),e.jsx("p",{className:"text-muted pb-3 pt-2 text-sm text-token-text-primary",children:e.jsx(r,{...l.aboutYouHelpText})}),e.jsx(W,{className:"mb-3",onSubmit:E,disabled:!S,tip:e.jsx(Pe,{children:e.jsxs("ul",{className:"list-disc pl-5",children:[e.jsx("li",{children:e.jsx(r,{...l.aboutUserTip1})}),e.jsx("li",{children:e.jsx(r,{...l.aboutUserTip2})}),e.jsx("li",{children:e.jsx(r,{...l.aboutUserTip3})}),e.jsx("li",{children:e.jsx(r,{...l.aboutUserTip4})}),e.jsx("li",{children:e.jsx(r,{...l.aboutUserTip5})})]})}),hasModError:F==="about_user_message",value:j??x,onChange:i=>b(a=>({aboutModelMessage:a.aboutModelMessage??C,aboutUserMessage:i.target.value,nameUserMessage:"",roleUserMessage:"",traitsModelMessage:"",otherUserMessage:"",enabled:a.enabled??S,disabledTools:a.disabledTools??p}))}),e.jsx("p",{className:"text-muted py-3 text-sm text-token-text-primary",children:e.jsx(r,{...l.modelHelpText})}),e.jsx(W,{onSubmit:E,disabled:!S,tip:e.jsx(Pe,{children:e.jsxs("ul",{className:"list-disc pl-5",children:[e.jsx("li",{children:e.jsx(r,{...l.modelTip1})}),e.jsx("li",{children:e.jsx(r,{...l.modelTip2})}),e.jsx("li",{children:e.jsx(r,{...l.modelTip3})}),e.jsx("li",{children:e.jsx(r,{...l.modelTip4})})]})}),hasModError:F==="about_model_message",value:T??C,onChange:i=>b(a=>({aboutUserMessage:a.aboutUserMessage??x,aboutModelMessage:i.target.value,nameUserMessage:"",roleUserMessage:"",traitsModelMessage:"",otherUserMessage:"",enabled:a.enabled??S,disabledTools:a.disabledTools??p}))}),e.jsx("div",{className:"my-6 h-px bg-token-border-light"}),e.jsx(_e,{disabledTools:_.disabledTools??p??[],onDisabledToolsChanged:i=>b(a=>({aboutUserMessage:a.aboutUserMessage??x,aboutModelMessage:a.aboutModelMessage??C,nameUserMessage:"",roleUserMessage:"",traitsModelMessage:"",otherUserMessage:"",enabled:a.enabled??S,disabledTools:i}))})]}),e.jsx("div",{className:"mt-4 md:mt-5",children:e.jsxs("div",{className:"flex flex-grow flex-col items-stretch justify-between gap-0 sm:flex-row sm:items-center sm:gap-3",children:[e.jsxs("label",{className:"mt-5 flex cursor-pointer flex-row justify-between gap-2 sm:mt-4",children:[e.jsx("div",{className:"self-center text-sm text-token-text-primary",children:e.jsx(r,{...l.chatPreferencesEnable})}),e.jsx(ke,{enabled:S,onChange:i=>{b(a=>({aboutUserMessage:a.aboutUserMessage??x,aboutModelMessage:a.aboutModelMessage??C,nameUserMessage:"",roleUserMessage:"",traitsModelMessage:"",otherUserMessage:"",enabled:i,disabledTools:a.disabledTools??p}))},label:S?t.formatMessage(l.disableToggleLabel):t.formatMessage(l.enableToggleLabel)})]}),e.jsx(L.Actions,{secondaryButton:e.jsx(L.Button,{onClick:X,children:e.jsx(r,{...l.cancel})}),primaryButton:e.jsx(L.Button,{loading:Y,onClick:E,color:"primary",visuallyDisabled:J,disabled:!V,children:e.jsx(r,{...l.save})})})]})})]},"user-context")}function Ds(){return Me({queryKey:["traitPills"],queryFn:async()=>{try{const s=await oe.getTraitPills();return s?Array.isArray(s)?s:[]:[]}catch{return[...zs.map(t=>({key:t,label:t,description:He[t]?.defaultMessage||""})),...Fs.map(t=>({key:t,label:t,description:He[t]?.defaultMessage||""}))]}},select:s=>{const t=Math.ceil(s.length/2-1);return{firstSet:s.slice(0,t),secondSet:s.slice(t)}}})}const Rs=({onSelect:s,selectedTraits:t,setSelectedTraits:o})=>{const{data:n,isLoading:m}=Ds(),[c,g]=h.useState(!0);if(m)return e.jsx(ge,{});if(!n)return null;const v=c?n.firstSet:n.secondSet,x=d=>{t.includes(d.key)||(o(u=>[...u,d.key]),s(d.description))},C=()=>{o([]),g(d=>!d)};return e.jsx("div",{children:e.jsxs("div",{className:"mt-2 flex flex-wrap gap-x-1 gap-y-2",children:[v.map(d=>!t.includes(d.key)&&e.jsxs(Ce,{size:"small",color:"secondary",className:"py-2 pl-2 pr-3 text-xs font-normal text-token-text-secondary",onClick:()=>x(d),children:[e.jsx(Ms,{className:"mr-[1px] h-4 w-4"}),d.label]},d.key)),e.jsx(Ce,{size:"small",color:"secondary",className:"text-token-text-secondary",onClick:C,children:e.jsx(fs,{className:"-mx-1 h-4 w-4"})})]})})},Pe=({children:s})=>e.jsx("div",{className:"whitespace-pre-line",children:s}),z=1500,ae=s=>s.length>z,W=({disabled:s,onChange:t,onSubmit:o,placeholder:n,value:m,tip:c,hasModError:g,className:v,size:x="md",showCharacterCount:C=!0,isNewCustomInstructionsUIEnabled:d=!1})=>{const u=re(),f=h.useRef(null),M=Xe(),p=Ze(),k=!M,[_,b]=h.useState(!1),[j,T]=h.useState(k),w=!k&&_&&!j,N=k&&!j,I=ae(m),D=y=>{!s&&y.key==="Enter"&&y.metaKey&&!y.shiftKey&&!y.nativeEvent.isComposing&&(y.preventDefault(),o())},R=h.useRef(null);return e.jsxs(e.Fragment,{children:[c&&e.jsx(se,{isOpen:N,type:"success",size:"custom",className:"max-w-lg",title:u.formatMessage(l.tipsHeader),showCloseButton:!0,onClose:()=>{T(!0)},children:c}),e.jsxs(ps,{open:w,children:[e.jsxs("div",{className:v,ref:R,children:[e.jsx(bs,{asChild:!0,children:e.jsx("textarea",{ref:f,className:q("w-full resize-none bg-token-main-surface-primary",{"rounded p-4":x!=="sm"&&!d,"rounded-lg border text-sm":x==="sm"||d,"border-orange-400 focus:border-orange-400":g,"border-red-500 focus:border-red-500":I&&!g,"focus-token-border-heavy border-token-border-light":!I&&!g,"opacity-30":s,"placeholder:text-gray-400":x==="sm"||d,"placeholder:text-gray-300":!d}),disabled:s,placeholder:n,onKeyDown:D,rows:x==="sm"?1:M&&!p?6:5,value:m,onChange:t,onBlur:()=>{b(!1)},onFocus:()=>{b(!0)}})}),e.jsx("div",{className:q("flex items-center justify-between px-1 text-xs tabular-nums",I?"text-red-600":"text-token-text-tertiary"),children:g?e.jsx("div",{className:"visible mt-2 text-left text-xs text-orange-400",children:e.jsx(r,{...l.modApiVoilation,values:{policyLink:y=>e.jsx("a",{href:"https://platform.openai.com/docs/usage-policies/content-policy",className:"underline",target:"_blank",rel:"noreferrer",children:y}),feedbackLink:y=>e.jsx("a",{href:"https://forms.gle/3gyAMj5r5rTEcgbs5",className:"underline",target:"_blank",rel:"noreferrer",children:y})}})}):e.jsxs(e.Fragment,{children:[C&&e.jsx("div",{children:`${m.length}/${z}`}),c&&e.jsx("button",{className:"flex items-center gap-1",onClick:()=>{f.current?.focus(),T(!j)},tabIndex:-1,children:e.jsx(Ee,{initial:!1,children:_&&e.jsx(Le.div,{className:"flex items-center gap-1",initial:{opacity:0},animate:{opacity:1,transition:{duration:.2,ease:"easeIn"}},exit:{opacity:0,transition:{duration:.2,ease:"easeIn"}},children:j?e.jsxs(e.Fragment,{children:[e.jsx(r,{...l.showTips}),e.jsx(ys,{className:"icon-xs"})]}):e.jsxs(e.Fragment,{children:[e.jsx(r,{...l.hideTips}),e.jsx($e,{className:"icon-xs"})]})},"show-hide")})})]})})]}),c&&e.jsx(Ss,{container:R.current?.ownerDocument.body,children:e.jsx(Cs,{side:"right",align:"start",sideOffset:12,className:"popover relative z-50 max-w-[220px] animate-slideLeftAndFade select-none rounded-xl border border-token-border-light bg-token-main-surface-primary p-4 text-sm text-token-text-primary shadow-[0px_4px_14px_rgba(0,0,0,0.06)] xl:max-w-xs",onOpenAutoFocus:y=>{y.preventDefault()},onCloseAutoFocus:y=>{y.preventDefault()},children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("strong",{children:e.jsx(r,{...l.tipsHeader})}),c]})})})]})]})};function ce({primaryLabel:s,secondaryLabel:t,side:o="top",icon:n=e.jsx(Be,{className:"h-4 w-4 text-token-text-tertiary"})}){return e.jsx(he,{sideOffset:4,interactive:!0,label:e.jsx("div",{children:s}),secondaryLabel:e.jsx("div",{children:t}),side:o,delayDuration:0,theme:"primary",customPrimaryLabelColorStyle:"primary",customPaddingClassName:"p-2",customBorderClassName:"border border-token-border-light",labelTextAlign:"left",children:n})}function Ae({label:s,side:t="bottom"}){return e.jsx(he,{sideOffset:4,interactive:!0,label:e.jsx("div",{children:s}),side:t,children:e.jsx(Be,{className:"h-4 w-4 text-token-text-tertiary"})})}function _e({disabledTools:s,onDisabledToolsChanged:t,isNewCustomInstructionsUIEnabled:o=!1}){h.useEffect(()=>{B.logEvent(A.userContextGpt4CapabilitiesShown)},[]);const m=es()?.isEnterprisey()??!1,c=!Te(ee.BrowsingAvailable)&&m,g=u=>{const f=s.includes(u)?s.filter(M=>M!==u):[...s,u];t(f)},v=ss(),{value:x}=te("2044826081"),C=!Te(ee.Canvas)&&m;var d;return v?.includes(ee.SearchTool)&&!v?.includes(ee.SearchToolHoldout)?d=e.jsx(G,{title:e.jsx(r,{id:"userContextModal.tools.web",defaultMessage:"Web Search"}),tooltipLabel:c?e.jsx(r,{id:"Osf0vy",defaultMessage:"Web Search is disabled by your organization"}):e.jsx(r,{id:"userContexModal.tools.webSearchTooltip",defaultMessage:"Automatically search the web to get answers"}),tool:H.BROWSER,onClick:g,Icon:we,checked:!s.includes(H.BROWSER)&&!c,disabled:c,isNewCustomInstructionsUIEnabled:o}):d=e.jsx(G,{title:e.jsx(r,{id:"userContextModal.tools.browse",defaultMessage:"Browsing"}),tooltipLabel:c?e.jsx(r,{id:"5SuA2c",defaultMessage:"Browsing is disabled by your organization"}):e.jsx(r,{id:"userContexModal.tools.browserTooltip",defaultMessage:"Browse the internet to find answers"}),tool:H.BROWSER,onClick:g,Icon:we,checked:!s.includes(H.BROWSER)&&!c,disabled:c,isNewCustomInstructionsUIEnabled:o}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:q("text-sm",{"text-muted font-medium":o,"font-semibold":!o}),children:e.jsx(r,{id:"userContextModal.gpt4CapabilitiesTitle",defaultMessage:"ChatGPT capabilities"})}),e.jsx(Ae,{label:e.jsx(r,{id:"userContextModal.tools.capabilitiesInfo.1",defaultMessage:"Choose which tools can be used with GPT-4"}),side:"top"})]}),e.jsxs("div",{className:"mt-2 flex flex-col flex-wrap gap-3 md:flex-row",children:[d,e.jsx(G,{title:e.jsx(r,{id:"userContextModal.tools.dalle",defaultMessage:"DALL·E"}),tooltipLabel:e.jsx(r,{id:"userContextModal.tools.dalleTooltip",defaultMessage:"Generate images using DALL·E"}),tool:H.DALLE,onClick:g,Icon:Ts,checked:!s.includes(H.DALLE),isNewCustomInstructionsUIEnabled:o}),e.jsx(G,{title:e.jsx(r,{id:"userContextModal.tools.codeInterpreter.1",defaultMessage:"Code"}),tooltipLabel:e.jsx(r,{id:"userContextModal.tools.codeInterpreterTooltip",defaultMessage:"Execute code using Code Interpreter"}),tool:H.PYTHON,onClick:g,Icon:js,checked:!s.includes(H.PYTHON),isNewCustomInstructionsUIEnabled:o}),x&&!C&&e.jsx(G,{title:e.jsx(r,{id:"FW2C7Y",defaultMessage:"Canvas"}),tooltipLabel:e.jsx(r,{id:"dP6U4B",defaultMessage:"Collaborate with ChatGPT on text and code"}),tool:H.CANMORE,onClick:g,Icon:vs,checked:!s.includes(H.CANMORE),isNewCustomInstructionsUIEnabled:o})]})]})}function G({tool:s,title:t,tooltipLabel:o,Icon:n,onClick:m,checked:c,disabled:g,isNewCustomInstructionsUIEnabled:v=!1}){return e.jsx(he,{className:"block",label:o,side:"top",sideOffset:4,children:e.jsxs("button",{className:q("flex w-full items-center justify-between gap-2 whitespace-nowrap rounded border border-token-border-medium p-2",{"cursor-not-allowed text-token-text-quaternary":g}),onClick:()=>m(s),disabled:g,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{className:"h-4 w-4 text-token-text-tertiary"}),e.jsx("div",{className:q("text-sm",v?"text-muted font-medium":"font-semibold"),children:t})]}),e.jsx(ks,{id:s,checked:c&&!g,disabled:g})]})})}const l=xe({tipsHeader:{id:"userContextModal.tipsHeader",defaultMessage:"Thought starters"},aboutUserTip1:{id:"userContextModal.aboutUserTip1",defaultMessage:"Where are you based?"},aboutUserTip2:{id:"userContextModal.aboutUserTip2",defaultMessage:"What do you do for work?"},aboutUserTip3:{id:"userContextModal.aboutUserTip3",defaultMessage:"What are your hobbies and interests?"},aboutUserTip4:{id:"userContextModal.aboutUserTip4",defaultMessage:"What subjects can you talk about for hours?"},aboutUserTip5:{id:"userContextModal.aboutUserTip5",defaultMessage:"What are some goals you have?"},modelTip1:{id:"userContextModal.modelTip1",defaultMessage:"How formal or casual should ChatGPT be?"},modelTip2:{id:"userContextModal.modelTip2",defaultMessage:"How long or short should responses generally be?"},modelTip3:{id:"userContextModal.modelTip3",defaultMessage:"How do you want to be addressed?"},modelTip4:{id:"userContextModal.modelTip4",defaultMessage:"Should ChatGPT have opinions on topics or remain neutral?"},save:{id:"userContextModal.save",defaultMessage:"Save"},chatPreferencesEnable:{id:"userContextModal.chatPreferencesEnable",defaultMessage:"Enable for new chats"},enableToggleLabel:{id:"userContextModal.enableToggleLabel",defaultMessage:"Enable chat preferences"},disableToggleLabel:{id:"userContextModal.disableToggleLabel",defaultMessage:"Disable chat preferences"},cancel:{id:"userContextModal.cancel",defaultMessage:"Cancel"},aboutYouHelpText:{id:"userContextModal.aboutYouHelpText",defaultMessage:"What would you like ChatGPT to know about you to provide better responses?"},modelHelpText:{id:"userContextModal.modelHelpText",defaultMessage:"How would you like ChatGPT to respond?"},profileTitle:{id:"userContextModal.title.1",defaultMessage:"Customize ChatGPT"},profileSubtitle:{id:"userContextModal.profileSubtitle",defaultMessage:"Introduce yourself to get better, more personalized responses"},profileSubtitleTooltip:{id:"userContextModal.profileSubtitleTooltip",defaultMessage:"ChatGPT will use the information you provide to tailor its responses to you. <link>Learn more</link> about how we use your data.",link:"https://help.openai.com/en/articles/8096356-custom-instructions-for-chatgpt"},customizeName:{id:"userContextModal.customizeName",defaultMessage:"What should ChatGPT call you?"},customizeNamePlaceholder:{id:"userContextModal.customizeNamePlaceholder",defaultMessage:"Name"},customizeRole:{id:"userContextModal.customizeRole",defaultMessage:"What do you do?"},customizeRolePlaceholder:{id:"userContextModal.customizeRolePlaceholder",defaultMessage:"Engineer, student, etc."},customizeTraits:{id:"userContextModal.customizeTraits",defaultMessage:"What traits should ChatGPT have?"},customizeTraitsPlaceholder:{id:"userContextModal.customizeTraitsPlaceholder",defaultMessage:"Describe or select traits"},customizeOther:{id:"userContextModal.customizeOther",defaultMessage:"Anything else ChatGPT should know about you?"},customizeOtherPlaceholder:{id:"userContextModal.customizeOtherPlaceholder",defaultMessage:"Interests, values, or preferences to keep in mind"},customInstructionsTitle:{id:"userContextModal.customInstructionsTitle",defaultMessage:"Custom Instructions"},customInstructionsTooltip:{id:"userContextModal.customInstructionsTooltip",defaultMessage:"<article>Learn more</article> about Custom Instructions and how they're used to help ChatGPT provide better responses."},traitsTooltipTitle:{id:"userContextModal.traitsTooltipTitle",defaultMessage:"You can tell ChatGPT to do things like..."},traitsTooltipBodyItem1:{id:"userContextModal.traitsTooltipBodyItem1",defaultMessage:"Use a formal, professional tone."},traitsTooltipBodyItem2:{id:"userContextModal.traitsTooltipBodyItem2",defaultMessage:"Be casual and chatty."},traitsTooltipBodyItem3:{id:"userContextModal.traitsTooltipBodyItem3",defaultMessage:"Be opinionated. If a question could have multiple answers, try to give only the best one."},otherTooltipTitle:{id:"userContextModal.otherTooltipTitle",defaultMessage:"You can share things like..."},otherTooltipBodyItem1:{id:"userContextModal.otherTooltipBodyItem1",defaultMessage:"I love hiking and jazz."},otherTooltipBodyItem2:{id:"userContextModal.otherTooltipBodyItem2",defaultMessage:"I'm vegetarian."},otherTooltipBodyItem3:{id:"userContextModal.otherTooltipBodyItem3",defaultMessage:"I'm trying to learn French."},messageLimitError:{id:"userContextModal.messageLimitError",defaultMessage:"Please limit your responses to {limit} characters or less."},showTips:{id:"userContextModal.showTips",defaultMessage:"Show tips"},hideTips:{id:"userContextModal.hideTips",defaultMessage:"Hide tips"},confirmCloseTitle:{id:"userContextModal.confirmCloseTitle",defaultMessage:"You have unsaved changes."},confirmCloseBody:{id:"userContextModal.confirmCloseBody",defaultMessage:"Are you sure you want to exit? Any changes you made will be permanently lost."},confirmCloseCancel:{id:"userContextModal.confirmCloseCancel",defaultMessage:"Back"},confirmCloseOk:{id:"userContextModal.confirmCloseOk",defaultMessage:"Exit"},modApiVoilation:{id:"userContextModal.modApiVoilation",defaultMessage:"This content may violate our <policyLink>content policy</policyLink>. If you believe this to be in error, please <feedbackLink>submit your feedback</feedbackLink> — your input will aid our research in this area."},browser:{id:"userContexModal.tools.browserTooltip",defaultMessage:"Browse the internet to find answers"},dalle:{id:"userContexModal.tools.dalleTooltip",defaultMessage:"Generate images using DALL·E"},python:{id:"userContexModal.tools.codeInterpreterTooltip",defaultMessage:"Execute code using Code Interpreter"},advanced:{id:"userContextModal.advanced",defaultMessage:"Advanced"}}),zs=["Chatty","Witty","Opinionated","StraightShooting","GenZ","Encouraging","Skeptical","ForwardThinking"],Fs=["Poetic","Respectful","Humble","Professional","Corporate","Direct","Silly","Pragmatic","Chill","OutsideTheBox"],He=xe({Chatty:{id:"userContextModal.chattySentence",defaultMessage:"Be talkative and conversational."},Witty:{id:"userContextModal.wittySentence",defaultMessage:"Use quick and clever humor when appropriate."},StraightShooting:{id:"userContextModal.straightShootingSentence",defaultMessage:"Tell it like it is; don't sugar-coat responses."},Encouraging:{id:"userContextModal.encouragingSentence",defaultMessage:"Use an encouraging tone."},GenZ:{id:"userContextModal.genZSentence",defaultMessage:"Talk like a member of Gen Z."},Skeptical:{id:"userContextModal.skepticalSentence",defaultMessage:"Adopt a skeptical, questioning approach."},ForwardThinking:{id:"userContextModal.forwardThinkingSentence",defaultMessage:"Take a forward-thinking view."},Poetic:{id:"userContextModal.poeticSentence",defaultMessage:"Use a poetic, lyrical tone."},Opinionated:{id:"userContextModal.opinionatedSentence",defaultMessage:"Readily share strong opinions."},Respectful:{id:"userContextModal.respectfulSentence",defaultMessage:"Always be respectful."},Humble:{id:"userContextModal.humbleSentence",defaultMessage:"Be humble when appropriate."},Professional:{id:"userContextModal.professionalSentence",defaultMessage:"Use a formal, professional tone."},Silly:{id:"userContextModal.sillySentence",defaultMessage:"Be playful and goofy."},Direct:{id:"userContextModal.directSentence",defaultMessage:"Get right to the point."},Pragmatic:{id:"userContextModal.pragmaticSentence",defaultMessage:"Be practical above all."},Corporate:{id:"userContextModal.corporateSentence",defaultMessage:"Respond with corporate jargon."},Chill:{id:"userContextModal.chillSentence",defaultMessage:"Keep it relaxed and easygoing."},OutsideTheBox:{id:"userContextModal.outsideTheBoxSentence",defaultMessage:"Be innovative and think outside the box."}}),Ws=xe({engineeringStudent:{id:"userContextModal.rolePlaceholder.engineeringStudent",defaultMessage:"Engineering student at University of Waterloo"},gastroenterologist:{id:"userContextModal.rolePlaceholder.gastroenterologist",defaultMessage:"Gastroenterologist"},sourdoughBaker:{id:"userContextModal.rolePlaceholder.sourdoughBaker",defaultMessage:"Small-batch home sourdough baker"},interiorDesigner:{id:"userContextModal.rolePlaceholder.interiorDesigner",defaultMessage:"Interior designer"},daycareManager:{id:"userContextModal.rolePlaceholder.daycareManager",defaultMessage:"Home daycare manager"},familyLawAttorney:{id:"userContextModal.rolePlaceholder.familyLawAttorney",defaultMessage:"Family law attorney"},excelWizard:{id:"userContextModal.rolePlaceholder.excelWizard",defaultMessage:"Excel wizard"},level10Mage:{id:"userContextModal.rolePlaceholder.level10Mage",defaultMessage:"Level 10 mage"},pharmaSales:{id:"userContextModal.rolePlaceholder.pharmaSales",defaultMessage:"Pharma sales"},freelanceCopywriter:{id:"userContextModal.rolePlaceholder.freelanceCopywriter",defaultMessage:"Freelance copywriter"},weddingPhotographer:{id:"userContextModal.rolePlaceholder.weddingPhotographer",defaultMessage:"Wedding photographer"},catHerder:{id:"userContextModal.rolePlaceholder.catHerder",defaultMessage:"Professional cat herder"},cdlDriver:{id:"userContextModal.rolePlaceholder.cdlDriver",defaultMessage:"CDL driver"},thirdGradeTeacher:{id:"userContextModal.rolePlaceholder.thirdGradeTeacher",defaultMessage:"Third-grade teacher"}}),Os={initial:{opacity:0,y:8},animate:{opacity:1,y:0,transition:{duration:.2}},exit:{opacity:0,y:-8,transition:{duration:.2}}},ue=["engineeringStudent","gastroenterologist","sourdoughBaker","interiorDesigner","daycareManager","familyLawAttorney","excelWizard","level10Mage","pharmaSales","freelanceCopywriter","weddingPhotographer","catHerder","cdlDriver","thirdGradeTeacher"];function Gs(){const s=As();return{userIsInSearchHoldoutWithWebDisabled:s.isLoading?!0:s.data?.userIsInSearchHoldoutWithWebDisabled}}function qs(s){let t=me(s,d=>d?.mode);const o=ws(),n=Us(s),m=re(),c=Ps(),g=h.useMemo(()=>{let d=o.isSuccess&&o.data?o.data:void 0;if(c){const u=_s(m);if(!d)return u;const f=d;d=[...f,...u.filter(M=>!f.some(p=>p.systemHint===M.systemHint))]}return d??[]},[m,c,o.data,o.isSuccess]),v=Hs({clientThreadId:s}),{userIsInSearchHoldoutWithWebDisabled:x}=Gs();return h.useMemo(()=>{const d=new Set(n.enabledTools||[]);return g.filter(u=>!(u.requiredFeatures.length===0||u.requiredFeatures.every(k=>d.has(k)))||u.systemHint==="search"&&x||!(u.requiredModels.length===0||u.requiredModels.some(k=>!v[k]))||!(u.requiredConversationModes.length===0||u.requiredConversationModes.some(k=>k===t?.kind))?!1:u.systemHint==="contextual_answers"?u.requiredModels?.includes(n.id):!0)},[g,n,v,t?.kind,x])}const De="persistedSystemHintsSessionState";function Re(){const s=sessionStorage.getItem(De);return s?JSON.parse(s):null}function Ks(s){sessionStorage.setItem(De,JSON.stringify(s))}function $s(s,t){const o=Re()??{};o[s]=t,Ks(o)}class P extends ts()(t=>({persistedSystemHints:new Set(t),persistedSystemHintTriggers:{}})){static getPersistedSystemHints=({persistedSystemHints:t})=>t;addPersistedSystemHint=(t,o,n)=>{t===U.Search&&B.logEventWithStatsig(A.searchModeEngaged,"search_mode_engaged",{...je(o),triggerSource:n}),this.setState(({persistedSystemHints:m,persistedSystemHintTriggers:c})=>({persistedSystemHints:new Set(m).add(t),persistedSystemHintTriggers:{...c,[t]:n}}))};removePersistedSystemHint=(t,o)=>{t===U.Search&&B.logEventWithStatsig(A.searchModeDisabled,"search_mode_disabled",je(o)),this.setState(({persistedSystemHints:n,persistedSystemHintTriggers:m})=>{const c=new Set(n);c.delete(t);const g={...m};return delete g[t],{persistedSystemHints:c,persistedSystemHintTriggers:g}})};getPersistedSystemHintTrigger=t=>{if(this.getState().persistedSystemHints.has(t))return this.getState().persistedSystemHintTriggers[t]};clearPersistedSystemHintTrigger=t=>{this.setState(({persistedSystemHints:o,persistedSystemHintTriggers:n})=>{const m={...n};return delete m[t],{persistedSystemHints:new Set(o),persistedSystemHintTriggers:m}})};clearAllPersistedSystemHintTriggers=()=>{this.setState(()=>({persistedSystemHints:new Set,persistedSystemHintTriggers:{}}))}}const et=()=>P.useState(P.getPersistedSystemHints);function Ne(s,t){const o=[];return s&&o.push(U.Search),t&&o.push(U.Think),o}function st({children:s,clientThreadId:t}){const[o]=is(),n=o.get(Ns)===U.Search,m=me(t,w=>ve.getGizmoId(w)),c=Is(t),g=Es(c,as.Search),x=qs(t).find(w=>w.systemHint===U.Think),{value:C}=te("3780975974"),{value:d}=te("759329447"),{value:u}=te("2800342425"),f=me(t,ve.getLastMessageSystemHints),M=(f.includes(U.Search)||n)&&g,p=!!(d&&x&&f.includes(U.Think));let k=Re()??{};const _=!!(g&&k[U.Search]),b=!!(d&&x&&k[U.Think]);let j=Ne(M,p);u&&(j=Ne(M||_,p||b));const[T]=h.useState(()=>new P(j));return h.useEffect(()=>{const w=T.getState().persistedSystemHints;(M||u&&_&&!m)&&!w.has(U.Search)&&T?.addPersistedSystemHint(U.Search,{clientThreadId:t,turnIndex:0}),(p||u&&b&&!m)&&!w.has(U.Think)&&C&&T?.addPersistedSystemHint(U.Think,{clientThreadId:t,turnIndex:0})},[M,p,C,T,t,u,_,b,m]),e.jsx(P.Provider,{store:T,children:s})}const Ys="prompt-textarea";function tt(){document.getElementById(Ys)?.focus()}const at={getAndReset:(s,t)=>{const o=ne.getItem(de.RestoreMessageAfterOauthRedirect);return ne.removeItem(de.RestoreMessageAfterOauthRedirect),!o||o.userId!==s||t!==o.serverThreadId||Date.now()>o.expiresAt?null:o},set:(s,t,o)=>{const n={userId:s,serverThreadId:t,inputText:o,expiresAt:Date.now()+6e4};ne.setItem(de.RestoreMessageAfterOauthRedirect,n)}},ot=()=>P.useState(P.getPersistedSystemHints).has(U.Search),rt=()=>P.useState(P.getPersistedSystemHints),lt=s=>P.useState(P.getPersistedSystemHints).has(s),it=()=>{const s=P.useStore(),t=h.useCallback(c=>s.getPersistedSystemHintTrigger(c),[s]),o=h.useCallback(c=>s.clearPersistedSystemHintTrigger(c),[s]),n=h.useCallback(()=>s.clearAllPersistedSystemHintTriggers(),[s]),m=h.useCallback((c,g,v,x)=>{(g?s.addPersistedSystemHint:s.removePersistedSystemHint)(c,v,x)},[s]);return{getSystemHintModeTrigger:t,clearSystemHintModeTrigger:o,setThreadSystemHintMode:m,clearAllSystemHintModeTriggers:n}},nt=(s,t,o,n)=>s?"file_upload_pending":n?"async_task_pending":t?o?"text_content_too_long":void 0:"empty_text_content",Qs=s=>s.replace(/[\u{E0000}-\u{E007F}]+/gu,""),dt=s=>{const t=Qs(s.getContentToSend().content);return Math.ceil(t.length/4)};function ct(s,t){return s?t===void 0?!0:t.includes(s):!1}export{st as P,Ys as T,Zs as U,et as a,it as b,Gs as c,Bs as d,lt as e,P as f,ot as g,qs as h,dt as i,at as j,ct as k,Qs as l,nt as m,$s as s,tt as t,rt as u};
//# sourceMappingURL=hexva2s1lo90zidg.js.map
