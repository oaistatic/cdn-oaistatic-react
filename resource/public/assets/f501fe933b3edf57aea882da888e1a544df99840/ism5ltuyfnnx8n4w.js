const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/mkpdv4allk4kuech.js","assets/n26mv7rx7nquqst2.js","assets/n1tvutderx19k1zs.js","assets/root-osq5e7fb.css","assets/pceg3mlzf8dzw9ob.js","assets/conversation-small-nranh1cg.css","assets/ezlmbh2lexxjbpm2.js","assets/i0lcioprs8tjrwwz.js","assets/iyoviv398ljqf1ew.js","assets/egjj718ybwa4lzxd.js","assets/hexva2s1lo90zidg.js","assets/l4c41pejol0bhhf7.js","assets/fudxsr1s5wqk63ki.js","assets/m3i9t52w2bjqxoks.js","assets/duvx3jmzsju7uw87.js","assets/ch48ne0b8201ps9r.js","assets/nxz31zqr36vgy6hm.js","assets/lvedelvd2wa5y0ah.js","assets/kodyf94rms2l778g.js","assets/nraolmtygmvq3wcf.js","assets/ecp3vwsjvu9v61q0.js","assets/jfxozbrcnsxchwcx.js","assets/da0lloekhn03bypm.js","assets/hg2pcqdl92ment5e.js","assets/ebn6bj0lor47yztv.js","assets/ml3bmxme9zwzi4dg.js","assets/m35dbrsevnzmsvv9.js","assets/ifl0nupxani7x3i4.js","assets/bei4zk14rknuqpj2.js","assets/kykf41pnxj3u2jkm.js","assets/fena7q4yinfq1jc5.js","assets/h62hagcisi6jaqob.js","assets/luscs3xv1j9ybwi2.js","assets/zs3gwhpec3gpzbzg.js","assets/lt8myo97bxkt0gi4.js","assets/fws03tm73d9qjm3m.js","assets/gbcm5ghq9ddzv4er.js","assets/gxnchqsr4k5w4z36.js","assets/fr3pvdprxejqauuy.js","assets/hdig35v8qpj0yxxm.js","assets/fob3ixm19u5bo41r.js","assets/ozlat1ypl94c5vbs.js","assets/d8mx7valoy6724sp.js","assets/jnjq4wt6v0sb6ord.js","assets/falq4gxco1cs0pxp.js","assets/ke3h37k23cmcczez.js","assets/mhlu8822bwdiwyx5.js","assets/om37sd3nqixbghdh.js","assets/mwshpzkua1oor5ak.js","assets/m89x2zftpo6hrypr.js","assets/jurl5oxctvsj2nxv.js","assets/o3h1v0olwo66q80n.js","assets/d421mpn05gtnb19a.js","assets/gohrg29ji6orhvga.js","assets/h1cvdr02rrgnl0ia.js","assets/fc1eebwzn89ijxnz.js","assets/dafzn6sg4vj6hamn.js","assets/gy64pge8qevmvg7e.js","assets/jlmk6p9qhmpdfonx.js","assets/l499zjc9lgyu7lf2.js","assets/n43edvoxt2r1qpaw.js","assets/h8hyik3us1m1le9o.js","assets/nanps14kkgvsrszm.js","assets/fzrn137102spawew.js","assets/e9lafxuzyeh4418f.js","assets/pevkepdko1ob7sgk.js","assets/cg9cr7bhamctxzet.js","assets/l3gci7wa2aa2b3gn.js"])))=>i.map(i=>d[i]);
import{U as ae,al as mt,ao as Lt,ai as Fe,s as X,bo as we,d$ as Je,aG as wi,bG as Ci,dq as Wn,P as G,a as z,bW as Q,dm as Mi,bs as ze,bt as Ge,bg as Xe,Q as ht,hF as zo,a0 as $s,N as Na,t as Ke,b9 as Ve,aw as ut,hG as Ti,d as P,hH as ki,S as je,j as Qe,c5 as Bs,ab as cs,am as qn,cd as Go,bJ as zt,au as Oe,bq as Ks,bY as Gt,ar as Mt,hI as Ea,aM as Wo,f as _i,l as Ai,C as Ft,L as yn,d_ as _n,av as qe,bK as Vn,dv as Fs,r as De,n as Ye,bm as Ni,eI as $n,er as ds,c2 as qo,cy as Ei,cw as Ii,bX as Ri,dp as Ia,a7 as Os,eF as Ra,gt as Pi,as as Di,O as Bi,B as Pa,aE as Da,dl as Hi,eM as Li,hJ as Fi,gu as Kn,eo as Oi,cm as Vo,gn as Ui,go as zi,bC as Gi,ap as is,gH as Wi,hK as qi,c6 as Yn,hL as Vi,cV as $i,D as An,fa as Ki,bE as Yi,a4 as $o,a1 as Ji,a2 as Xi,a3 as Qi,fZ as Zi,fY as Jn,gE as Xn,c3 as as,aj as Ba,aK as Ko,fz as el,ag as us,eG as Ha,H as Ht,dd as La,a5 as tl,bj as sl,hM as nl,cf as ol,ed as Nn,fI as al,q as Us,aL as rl,ee as zs,be as ks,M as Fa,a6 as Oa,aq as il,b_ as ll,u as Ua,f6 as cl,f1 as dl,bI as ul,bZ as ml,dW as hl,br as za,gz as gl,hN as pl,bD as fl}from"./n26mv7rx7nquqst2.js";import{c as ge,r as i,j as e,L as En,M as I,e as Ys,R as Qn,f as Ga,au as oe,b6 as xl,aw as ms,a as Wa,z as Sl,v as vl,b7 as bl,b3 as yl,b0 as Yo}from"./n1tvutderx19k1zs.js";import{a7 as Js,cG as Zn,h9 as Hs,hd as Wt,oc as eo,l as Tt,ji as jl,jj as wl,bT as In,an as Cl,m as Jo,ab as Ml,at as Tl,fr as kl,au as _l,aF as to,ch as Xs,iS as so,gc as Al,gU as Nl,o as El,od as dt,bC as Il,bK as qa,oe as Va,of as Rn,og as jn,oh as Rl,oi as _s,oj as Pl,gH as Dl,eM as Ue,eK as Bl,eL as $a,l$ as Hl,lP as Xo,gG as Ll,dU as Fl,ok as Ol,ir as As,ol as Ul,A as Qs,d3 as zl,u as Gl,om as Wl,fH as ql,cB as no,y as Vl,on as $l,hA as Kl,oo as Yl,op as Jl,e7 as se,oq as Ka,ae as ot,hK as oo,c4 as Xl,or as ao,eW as Ot,os as Ya,ot as Ja,eR as Ae,cp as Zs,ou as Le,gK as Xa,ov as Ql,kD as Qa,kG as Za,ge as Zl,B as ro,fS as ec,kC as tc,af as nt,ow as er,mN as sc,ox as nc,oy as Ut,jP as tr,oz as V,oA as sr,oB as nr,oC as oc,oD as ac,oE as rc,oF as ic,oG as lc,oH as cc,gb as dc,oI as uc,oJ as mc,oK as hc,oL as gc,oM as pc,oN as fc,oO as xc,oP as Sc,oQ as vc,oR as bc,oS as yc,oT as jc,oU as wc,oV as Cc,oW as Mc,oX as Tc,oY as kc,oZ as io,a5 as Gs,o_ as or,gS as ar,gT as _c,kg as rr,E as Ac,O as Nc,fJ as Ec,f4 as Ic,o$ as Rc,p0 as Pc,dY as ls,kU as Pn,p1 as Dc,p2 as Bc,p3 as ir,np as Hc,p4 as Lc,nj as Fc,p5 as Oc,p6 as lr,p7 as Uc,J as zc,dE as cr,j0 as Gc,ah as Wc,p8 as qc,cf as lo,cg as dr,dz as Vc,dA as ur,p9 as $c,pa as Qo,pb as Zo,pc as Kc,pd as Yc,cm as ea,cj as Jc,j1 as Xc,pe as Qc,pf as Zc,pg as ed,g_ as mr,ph as td,pi as sd,a6 as hr,gX as ta,g$ as gr,iO as co,e1 as nd,ci as od,pj as ad,ix as rd,k_ as id,iy as ld,iz as cd,mM as dd,ck as Ls,hQ as ud,pk as md,pl as hd,pm as gd,pn as pd,U as Ws,dS as fd,dp as xd,po as Sd,pp as vd,iL as bd,gL as yd,mp as jd,pq as wd,gN as Cd,gO as Md,pr as Td,ps as kd,pt as _d,pu as Ad,pv as Nd,pw as Ed,dk as Id,iB as Rd,gA as Pd,px as Dd,n8 as Bd,py as Hd,pz as Ld,fZ as Fd,pA as Od,pB as Dn,pC as Ud,cq as zd,pD as Gd,eU as pr,pE as Wd,pF as qd,pG as fr,jd as uo,eX as qs,pH as Vd,pI as $d,pJ as Kd,pK as Bn,d as xr,pL as sa,pM as Yd,nT as Jd,eS as Xd,pN as Qd,kK as Sr,eT as Zd,pO as eu,pP as tu,fD as su,o5 as nu,pQ as ou,pR as au,pS as ru,pT as iu,l0 as lu,pU as cu,pV as Ns,dP as vr,pW as du,gJ as uu,dX as mu,pX as br,pY as hu,hV as Vs,pZ as Hn,p_ as gu,p$ as pu,q0 as Es,cD as na,q1 as fu,cH as xu,cI as Su,bJ as yr,cW as jr,gs as wr,gu as Cr,da as vu,q2 as bu,hu as yu,mL as ju,q3 as wu,q4 as Cu,q5 as Mr,q6 as Mu,q7 as Tu,q8 as ku,q9 as _u,ce as Au,dj as Nu,hU as Eu,cE as Iu,qa as Ru,qb as Pu,ga as wn,gr as Du,gt as Bu,hn as Hu,qc as Lu,qd as Fu,qe as Ou,qf as Uu,qg as zu,qh as Gu,qi as Wu,qj as qu,qk as Vu,dn as $u,ql as Ku,qm as Yu,qn as Ju,kP as Xu,kQ as Qu,kO as Zu,qo as em,hM as tm,h0 as sm,h2 as nm,H as om,gp as am,iH as rm,iI as im,ns as lm,hf as cm,h1 as dm,gY as um,qp as mm,qq as hm,cY as gm,cX as pm,c_ as fm,qr as xm,h3 as oa,fI as Sm,cL as vm,cM as bm,il as ym,mn as jm,h6 as wm,qs as Cm,ag as Mm}from"./pceg3mlzf8dzw9ob.js";import{e as Tr,b as en,f as Tm,a as kr,s as _r,t as Ln,c as Ar,g as tn,u as mo,h as ho,T as km,i as _m,j as aa,k as Am,l as Nm,m as Em,P as Im}from"./hexva2s1lo90zidg.js";import{S as Rm,u as sn,G as Pm,L as Dm,a as Bm}from"./nxz31zqr36vgy6hm.js";import{u as Hm,k as Lm,j as Fm,S as Om,l as Um,m as zm,n as Gm,o as go,s as Wm,p as qm,q as Is,r as Vm,t as $m,v as nn,C as Nr,c as Km}from"./kodyf94rms2l778g.js";import{B as Ym}from"./jfxozbrcnsxchwcx.js";import{C as Fn,g as Jm}from"./da0lloekhn03bypm.js";function Er(t){const{currentModelId:s}=Hm(),a=Js(t),[o,n]=ae(t,m=>[X.hasUserMessage(m),X.getGizmoId(m)]),r=mt(),l=Zn(s),c=Lt(t)&&!o&&(Hs(a)||a?.kind===Fe.GizmoTest),d=Wt(n);return{showEmptyState:c,canUseNewHomepage:c&&d||c&&!n&&!l&&!r}}const ra=we.button`max-w-28 xs:max-w-40 sm:max-w-60 md:max-w-none group flex cursor-pointer items-center gap-1 rounded-lg py-1.5 ${({$shimmer:t})=>t?"loading-shimmer":""} ${({$isScreenArch:t})=>t?"text-md px-1":"px-1 text-lg"} hover:bg-token-main-surface-secondary radix-state-open:bg-token-main-surface-secondary font-semibold text-token-text-secondary overflow-hidden whitespace-nowrap`;function Xm({conversation:t,gizmoResource:s,elementRef:a}){const n=ae(t.id,r=>r?.title??null)??t.title;return e.jsx(En,{to:Tl(t.id,s),children:e.jsx(Q.Item,{onSelect:()=>{G.logEvent(z.projectsBreadcrumbPickerPickConversation)},icon:kl,children:e.jsx("div",{ref:a,children:n})},t.id)})}function Qm({gizmoId:t,clientThreadId:s,inMobileHeader:a,modelLabel:o,modelPickerContent:n}){const r=ge(),c=!eo(t),{data:d}=Tt(t),{items:p,hasNextPage:u,fetchNextPage:m,isLoading:h,isFetchingNextPage:x}=jl(t),g=i.useRef(null),b=i.useCallback(w=>{h||w==null||(g.current?.disconnect(),g.current=new IntersectionObserver(f=>{f[0].isIntersecting&&u&&m()}),g.current.observe(w))},[h,u,m]);i.useEffect(()=>()=>{g.current?.disconnect()},[]);const[k,S,v]=ae(s,w=>[w?.isLoading,w?.title??null,X.getThreadTitleSource(w)]),C=Je(),{showEmptyState:_}=Er(s),N=wl(),B=r.formatMessage(In.newChatTitle),{resolvedTitle:j,isTypingEffect:T}=Cl(s,S,!0);if(!d||_)return null;const M=j==null&&(Lt(s)||v===wi.NewChat),R=k?e.jsx(e.Fragment,{}):e.jsxs(ra,{$isScreenArch:C,$shimmer:M,children:[e.jsxs("div",{className:"truncate",children:[T?e.jsx(_l,{text:j??""}):j??B,c&&e.jsx("span",{className:"relative bottom-[1px] mx-1 inline-block rounded-md bg-token-main-surface-secondary px-1 text-xs leading-4 text-token-text-secondary",children:o})]}),e.jsx(to,{className:"icon-md text-token-text-tertiary"})]}),L=N&&d.gizmo.display.emoji?e.jsxs(e.Fragment,{children:[d.gizmo.display.emoji," ",d.gizmo.display.name]}):d.gizmo.display.name;return e.jsxs("div",{className:"flex items-center gap-0 overflow-hidden whitespace-nowrap px-2 py-1.5",children:[e.jsx(ra,{$isScreenArch:C,children:e.jsx(En,{className:"truncate",to:Jo(d),children:L})}),e.jsxs(e.Fragment,{children:[e.jsx(Ci,{className:"icon-md text-token-text-tertiary"}),e.jsxs(Wn,{contentAlign:a?"center":"start",size:"small",onOpenChange:w=>{w&&G.logEvent(z.projectsBreadcrumbPickerOpen)},triggerButton:R,contentClassName:"max-h-[50dvh] overflow-y-scroll",children:[c&&e.jsxs(Q.Sub,{onOpenChange:w=>{w&&G.logEvent(z.projectsBreadcrumbPickerModelPickerOpen)},children:[e.jsx(Q.SubMenuTrigger,{children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-1",children:[e.jsx(I,{id:"ilkdMh",defaultMessage:"Model"}),e.jsx("span",{className:"text-xs font-medium text-token-text-secondary",children:o})]})}),e.jsx(Q.Portal,{children:e.jsx(Q.SubContent,{onClick:()=>{G.logEvent(z.projectsBreadcrumbPickerModelPickerSelect)},children:n})})]}),e.jsx(En,{to:Jo(d),children:e.jsx(Q.Item,{onSelect:()=>{G.logEvent(z.projectsBreadcrumbPickerPickNewChat)},icon:Ml,children:e.jsx(I,{...In.newChatProjectDropdownItem,values:{name:`"${d.gizmo.display.name}"`}})},"new-chat")}),p.filter(w=>w.id!==s).map((w,f)=>{const D=u&&f===p.length-4?b:void 0;return e.jsx(Xm,{elementRef:D,conversation:w,gizmoResource:d},w.id)}),x&&e.jsx("div",{className:"m-4 mb-5 flex justify-center",children:e.jsx(Mi,{})})]})]})]})}const Zm=ze(()=>Ge(()=>import("./mkpdv4allk4kuech.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(t=>t.ThreadHeaderGizmoDropdown)),eh=ze(()=>Ge(()=>import("./i0lcioprs8tjrwwz.js"),__vite__mapDeps([7,2,4,1,3,5,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23])).then(t=>t.ConversationHeaderMenuItems));function th({clientThreadId:t}){const s=ge(),a=mt(),o=ae(t,X.getIsNewConversation),n=Ys(),[,r]=Ga(),l=()=>{!o&&!a?n({pathname:"/",search:new URLSearchParams({[As]:"true"}).toString()}):r(c=>(c.get(As)==="true"?c.delete(As):c.set(As,"true"),c),{replace:o,state:Ul()})};return e.jsx(Q.Item,{size:"large",className:"!pr-3",onClick:l,icon:Pl,children:e.jsxs("div",{className:"flex grow items-center justify-between gap-2",children:[e.jsx("div",{className:"flex flex-1 items-center gap-3",children:e.jsx(I,{...So.temporaryChat})}),e.jsx(Dl,{enabled:a,label:s.formatMessage({defaultMessage:"Temporary",id:"temporaryChatToggleLabel"}),testId:"temporary-chat-toggle"})]})})}function sh(t){return t.title?t.title:t.shortLabel}function po(t,s){let a=t;if(t===zo.AUTO){const r=s?.categories.filter(({defaultModel:l})=>l!==zo.AUTO);r?.length===1&&(a=r[0].defaultModel)}const o=s?.categories.find(({defaultModel:r})=>r===a);if(o){const{categoryId:r}=o,l=sh(o);return{selectedCategory:r,modelLabel:l,omitPrefix:!!o.title}}const n=s?.groups.find(({modelIds:r})=>r.includes(a));if(n){const{group:r,shortLabel:l}=n;return{selectedCategory:r,modelLabel:l}}return{selectedCategory:null,modelLabel:null}}function nh({modelLabel:t}){return e.jsx("span",{className:"overflow-x-clip text-ellipsis text-token-text-secondary",children:t})}function oh({clientThreadId:t,inMobileHeader:s}){const{isLoading:a,data:o}=ht(),n=ki(),l=Xs(t).id,c=so();Ue.markStart("ThreadModelSelector");const{modelLabel:d,omitPrefix:p}=po(l,o),u=fo(t,c),m=ge(),{isUnauthenticated:h}=Ve(),x=!h&&!n;d&&Ue.markRendered("ThreadModelSelector"),i.useEffect(()=>{a||Bl({namespace:$a.ChatPageLoad})?.logTiming("render_model_switcher")},[a]);const g=Je(),b=e.jsxs("div",{className:P(g?"overflow-x-hidden text-ellipsis":"text-token-text-secondary"),children:[p?null:`${Hl} `,x?e.jsx("span",{className:"text-token-text-secondary",children:d}):h&&d?e.jsx(nh,{modelLabel:d}):null]});return u.length?a?null:e.jsx(Wn,{sideOffset:8,size:"large",triggerButton:e.jsxs(Xo,{$isScreenArch:g,style:{viewTransitionName:"var(--vt-thread-model-switcher)"},"aria-label":d?m.formatMessage({id:"JrtGPQ",defaultMessage:"Model selector, current model is {modelLabel}"},{modelLabel:d}):"",children:[b,g?e.jsx(Ll,{className:"icon-md text-token-text-tertiary"}):e.jsx(to,{className:"icon-md text-token-text-tertiary"})]}),onOpenChange:k=>{G.logEvent(z.toggleModelSwitcher,{isOpen:k}),je.logEvent("toggle_model_switcher",null,{isOpen:String(k)})},contentAlign:s?"center":"start",testId:"model-switcher-dropdown",children:e.jsx(xo,{sections:u})}):e.jsx(Xo,{className:"cursor-default",children:b})}function ah({category:t,modelSwitcherDenialsBySlug:s,currentGizmoId:a,currentModelId:o,testId:n}){const{defaultModel:r,label:l,description:c,isBeta:d,isAlpha:p}=t,u=Fl(a??"");return e.jsx(Rn,{value:r,currentModelId:o,modelSwitcherDenialsBySlug:s,renderName:m=>e.jsx(On,{name:l,description:c,isDisabled:m,isBeta:d,isAlpha:p}),isSelected:(!a||u)&&o===r,testId:n},r)}function fo(t,s,a=!1){const o=Xs(t),n=o.id,r=Xe(t),{data:l}=ht(),{data:c}=$s(),d=Al(r),p=c&&Na(c),u=Ke(t),m=Nl({clientThreadId:t}),h=ge(),x=!u,{isUnauthenticated:g}=Ve(),b=El(),{layer:k}=ut("2723963139"),S=k.get("is_dynamic_model_enabled",!1),v=s.find(({categoryId:F})=>F===dt.ALPHA),C=s.find(({categoryId:F})=>F===dt.DATA_CAMPAIGNS),_=s.find(({categoryId:F})=>F===dt.EXPERIMENTS),N=s.find(({categoryId:F})=>F===dt.MAINLINE),B=!!v?.options?.length,j=!!C?.options?.length,T=!!_?.options?.length,M=!!N?.options?.length,R=Ys(),L=i.useCallback(()=>{G.logEvent(z.accountPayOpenPaymentFromModelPicker,{content:"gizmo-button"}),Il(R,"Thread header dropdown")},[R]),w=()=>{je.logEvent("chatgpt_model_switcher_plus_upgrade_button_clicked"),G.logEvent(z.modelSwitcherPlusUpgradeButtonClicked),g?b({shouldOpenPaymentModalOnAuth:!0,callback:F=>{G.logSignUpButtonClicked({location:"Model switcher GPT-4 upsell",provider:F})}}):L()},f=[],[D,A]=i.useState(!1),W=e.jsxs(e.Fragment,{children:[a&&e.jsx(Ti,{setIsScrolledToEdge:A}),e.jsxs("div",{className:P("mb-1 flex items-center justify-between px-5 pt-2",{"sticky top-0 z-10 bg-token-main-surface-primary py-2":a},{"[box-shadow:--sharp-edge-top-shadow]":a&&D},{"[box-shadow:--sharp-edge-top-shadow-placeholder]":a&&!D}),children:[e.jsx("span",{className:"text-sm text-token-text-tertiary",children:e.jsx(I,{id:"ilkdMh",defaultMessage:"Model"})}),e.jsx("a",{href:S?"https://help.openai.com/en/articles/9155758-what-is-the-chatgpt-plus-model-selector":"https://help.openai.com/en/articles/7102672-how-can-i-access-gpt-4",target:"_blank",rel:"noreferrer",children:e.jsx(qa,{className:"icon-md h-5 w-5 pl-0.5 text-token-text-tertiary"})})]},"header")]});if(g){const F={id:"modelSection",content:[]};F.content.push(e.jsx(Va,{statsig_login_event:"chatgpt_modelswitcher_login_button_clicked",statsig_signup_event:"chatgpt_modelswitcher_signup_button_clicked"},"noAuthUpsell")),f.push(F)}else if(!p&&!r){const F={id:"modelSection",content:[]};F.content.push(e.jsx(Rn,{value:"",currentModelId:n,onClick:w,modelSwitcherDenialsBySlug:m,isUpgradeUpsell:!0,renderName:H=>e.jsx(On,{icon:Ol,isDisabled:H,name:h.formatMessage({id:"mzDzkX",defaultMessage:"ChatGPT Plus"}),description:h.formatMessage({id:"bqTHri",defaultMessage:"Our smartest model & more"})}),isSelected:!1,showNewChatHint:!1},"plusUpgrade")),F.content.push(e.jsx(Rn,{value:jn.AUTO,currentModelId:n,modelSwitcherDenialsBySlug:m,renderName:H=>e.jsx(On,{icon:Rl,name:h.formatMessage({id:"U9E7Rx",defaultMessage:"ChatGPT"}),description:h.formatMessage({id:"n96qML",defaultMessage:"Great for everyday tasks"}),isDisabled:H}),isSelected:!r&&n===jn.AUTO,showNewChatHint:!0},jn.AUTO)),f.push(F)}else{const F={id:"modelSection",content:[]};l?.categories.length&&F.content.push(W);const H=new Map;l?.categories.forEach(K=>{const Y=e.jsx(ah,{category:K,currentGizmoId:r,currentModelId:n,modelSwitcherDenialsBySlug:m,testId:`model-switcher-${K.defaultModel}`},K.categoryId);K.subcategory?(H.has(K.subcategory)||H.set(K.subcategory,[]),H.get(K.subcategory)?.push(Y)):F.content.push(Y)}),H.forEach((K,Y)=>{const $=l?.categories.find(me=>me.subcategory===Y&&me.defaultModel===o.id);F.content.push(e.jsxs(Q.Sub,{children:[e.jsx(Q.SubMenuTrigger,{"data-testid":Y==="More models"?"more-models-submenu":void 0,children:e.jsxs("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:[Y,!!$&&e.jsx("div",{className:"truncate text-token-text-tertiary",children:$.label})]})}),e.jsx(Q.Portal,{children:e.jsx(Q.SubContent,{className:"min-w-72",children:K})})]},Y))}),f.push(F)}const Z={id:"otherOptionsSection",content:[]},{selectedCategory:E}=po(n,l);return x&&(B&&Z.content.push(e.jsx(_s,{isSelected:E===dt.ALPHA,currentModel:o,option:v,modelSwitcherDenialsBySlug:m,displayInFull_INTERNAL_USE_ONLY:!0},v.value)),j&&Z.content.push(e.jsx(_s,{isSelected:E===dt.DATA_CAMPAIGNS,currentModel:o,option:C,modelSwitcherDenialsBySlug:m,displayInFull_INTERNAL_USE_ONLY:!0},C.value)),T&&Z.content.push(e.jsx(_s,{currentModel:o,isSelected:E===dt.EXPERIMENTS,option:_,modelSwitcherDenialsBySlug:m,displayInFull_INTERNAL_USE_ONLY:!0},_.value)),M&&Z.content.push(e.jsx(_s,{isSelected:E===dt.MAINLINE,currentModel:o,option:N,modelSwitcherDenialsBySlug:m,displayInFull_INTERNAL_USE_ONLY:!0},N.value))),Z.content.length&&f.push(Z),!g&&!r&&!d&&f.push({id:"temporaryChatSection",content:[e.jsx(th,{clientThreadId:t},"tempChat")]}),f}function rh(){const t=ge();return e.jsx("div",{className:"border-token-text-quartenary items-center rounded-full border px-1 py-0.5 text-[8px] font-semibold uppercase leading-3 text-token-text-secondary dark:border-token-border-heavy dark:text-token-text-tertiary",children:t.formatMessage(So.beta)})}function ih(){const t=ge();return e.jsx("div",{className:"border-token-text-quartenary items-center rounded-full border px-1 py-0.5 text-[8px] font-semibold uppercase leading-3 text-token-text-secondary dark:border-token-border-heavy dark:text-token-text-tertiary",children:t.formatMessage(So.alpha)})}function On({isDisabled:t,name:s,icon:a,description:o,extra:n,isBeta:r=!1,isAlpha:l=!1}){let c=s;return r&&(c=e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s}),e.jsx(rh,{})]})),l&&(c=e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s}),e.jsx(ih,{})]})),e.jsxs("div",{className:"flex items-center gap-3",children:[a&&e.jsx("span",{className:"flex h-7 w-7 flex-shrink-0 items-center justify-center rounded-full bg-token-main-surface-secondary",children:e.jsx(a,{className:"h-4 w-4 text-token-text-primary"})}),e.jsxs("div",{children:[c,e.jsxs("div",{className:P(!t&&"text-token-text-secondary","text-xs"),children:[o,n]})]})]})}function xo({sections:t}){return e.jsx(e.Fragment,{children:t.map((s,a)=>e.jsxs(Qn.Fragment,{children:[a!==0?e.jsx(Q.Separator,{}):null,s.content]},s.id))})}function lh({clientThreadId:t,inMobileHeader:s=!1}){const a=Xe(t),o=Wt(a),n=eo(a),{showEmptyState:r}=Er(t),{data:l}=Tt(a),{data:c}=ht(),p=Xs(t).id,{modelLabel:u}=po(p,c),m=so(),h=fo(t,m,n),x=e.jsx(oh,{clientThreadId:t,inMobileHeader:s});return a==null?n?e.jsx(eh,{clientThreadId:t}):x:o?r&&l&&!n?x:e.jsx(Qm,{modelLabel:u??"",modelPickerContent:e.jsx(xo,{sections:h}),gizmoId:a,clientThreadId:t,inMobileHeader:s}):e.jsx(Zm,{clientThreadId:t,gizmoId:a,inMobileHeader:s})}const So=Qe({alpha:{id:"o5FsPB",defaultMessage:"Alpha"},beta:{id:"XZwFET",defaultMessage:"Beta"},gpt35ShortExplainer:{defaultMessage:"Great for everyday tasks",id:"ModelSwitcher.gpt35ShortExplainer"},modelTunerSmartSelectionTitle:{id:"czjW8I",defaultMessage:"Dynamic"},modelTunerSmartSelectionExplainer:{id:"gp/YH1",defaultMessage:"Optimized for speed and intelligence"},gpt4ShortExplainer:{defaultMessage:"With DALL·E, browsing and analysis",id:"ModelSwitcher.gpt4ShortExplainer"},gpt4ShortExplainerWithoutBrowse:{defaultMessage:"With DALL·E and analysis",id:"ModelSwitcher.gpt4ShortExplainerWithoutBrowse"},gpt4UpsellExplainer:{id:"ModelSwitcher.gpt4Upsell",defaultMessage:"Our smartest and most capable model. Includes DALL·E, browsing and more."},userUpgrade:{id:"ModelSwithcer.upgradeButton",defaultMessage:"Upgrade to Plus"},userUpgradeSignup:{id:"ModelSwitcher.signupUpgradeButton",defaultMessage:"Sign up for ChatGPT Plus"},temporaryChat:{id:"ModelSwitcher.temporaryChat",defaultMessage:"Temporary chat"},shareChat:{id:"ModelSwitcher.shareChat",defaultMessage:"Share chat"}}),ch=ze(()=>Ge(()=>import("./ebn6bj0lor47yztv.js"),__vite__mapDeps([24,2,1,3,25,26,4,5,27,28,29,30,31,18,10,19,20,32,33,34,9,35,36,37,38,16,6,39,15,17,40])).then(t=>t.GizmoUsingAsOwnerNotice)),dh=({clientThreadId:t})=>{const s=Qs(h=>h.activeStageSidebar),a=Ke(t),o=zl(Bs.WorkspaceShareLinks),{isUnauthenticated:n}=Ve(),r=mt(),l=Xe(t),c=Wt(l),d=Gl(),p=o&&a&&!n&&!r&&!c&&!d,u=Je(),m=!s&&!(!n&&u);return e.jsx("div",{className:P(!u&&"gap-2",u&&"@lg/screen-composer:gap-1","flex items-center pr-1 leading-[0]"),children:e.jsx(Lm,{showShareButton:p,showProfileDropdown:m,clientThreadId:t})})};function uh({clientThreadId:t,gizmoId:s}){const a=Wl(),{data:o}=Tt(s),n=cs();return e.jsxs(e.Fragment,{children:[e.jsxs(ql,{className:"max-md:hidden",children:[e.jsxs("div",{className:"absolute start-1/2 ltr:-translate-x-1/2 rtl:translate-x-1/2",children:[o!=null&&n?.isWorkspaceAccount()&&o.gizmo.tags?.includes(no.WorkspaceDisabled)&&e.jsx(ch,{gizmo:o}),e.jsx(Vl,{gizmoId:s,clientThreadId:t})]}),e.jsxs("div",{className:"flex items-center gap-0 overflow-hidden",children:[e.jsx(Fm,{clientThreadId:t}),e.jsx(lh,{clientThreadId:t})]}),e.jsx(dh,{clientThreadId:t})]}),a&&e.jsx($l,{})]})}function Ir({clientThreadId:t}){const s=Xe(t),a=qn(),o=Je();return a||o?null:e.jsx(uh,{gizmoId:s,clientThreadId:t})}const ia=we.div`m-8 flex flex-col items-center`;function la(t){return e.jsx(oe.div,{initial:{opacity:0,translateY:20},animate:{opacity:1,translateY:0,transition:{duration:.5,ease:"easeIn"}},...t})}function mh({clientThreadId:t}){const a=ae(t,n=>n?.promptGptRating)?.gizmoId,{data:o}=Tt(a);return a==null||o==null||!Kl(o)?null:e.jsx(hh,{gizmoId:a})}function hh({gizmoId:t}){const[s,a]=i.useState(!1),[o,n]=i.useState(!1),r=Yl(t),l=async d=>{a(!0),setTimeout(()=>{n(!0)},5e3),G.logEvent(z.submitInlineRating,{gizmo_id:t,rating:d}),await r.mutateAsync({rating:d})},c=async()=>{n(!0),G.logEvent(z.dismissInlineRating,{gizmo_id:t}),await r.mutateAsync({})};return i.useEffect(()=>{o||G.logEvent(z.showInlineRating,{gizmo_id:t})},[o,t]),o?null:s?e.jsx(ia,{children:e.jsxs(la,{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"rounded-lg border border-token-border-heavy p-4",children:e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(I,{id:"gizmo.inlineReview.reviewLeft",defaultMessage:"Feedback sent"}),e.jsx(Go,{onClick:()=>{n(!0)}})]})}),e.jsx("div",{className:"text-xs text-token-text-tertiary",children:e.jsx(I,{id:"gizmo.inlineReview.reviewLeftSubtext",defaultMessage:'To update your rating, click "Send Feedback" in the GPT Menu'})})]})}):e.jsx(ia,{children:e.jsxs(la,{className:"flex flex-col items-center gap-4 rounded-lg border border-token-border-heavy p-4",children:[e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx(I,{id:"gizmo.inlineReview.prompt",defaultMessage:"How would you rate this GPT so far?"}),e.jsx(Go,{onClick:c})]}),e.jsx(Jl,{rating:void 0,onRating:l})]})})}const Rr=new Map([[se.Think,{hover:[z.composerThinkButtonHovered,"composer_think_button_hovered"],enable:[z.composerThinkButtonEnabled,"composer_think_button_enabled"],disable:[z.composerThinkButtonDisabled,"composer_think_button_disabled"]}]]);function Pr({systemHint:t,logo:s,highlightTooltip:a,isPinnedActive:o,isDisabled:n,composerController:r,analyticsMetadata:l,onClick:c,showLabel:d=!1}){const{name:p,systemHint:u}=t,m=u,{setThreadSystemHintMode:h,clearAllSystemHintModeTriggers:x}=en(),g=Tr(m),b=!!t.composerBarButtonInfo?.upsell,k=Tm.useStore(),[S,v]=i.useState(!1),{value:C}=Oe("2454940646"),{value:_}=Oe("2800342425"),N=xl(),B=n||o,j=kr();i.useEffect(()=>{n&&j.has(m)&&h(m,!1,l)},[n,m,l,h,j]);const T=!n&&(g||a),M=e.jsxs("button",{className:P("flex h-9 min-w-8 items-center justify-center rounded-full border border-token-border-light p-2 text-[13px] font-semibold radix-state-open:bg-black/10 can-hover:hover:bg-token-main-surface-secondary dark:can-hover:hover:bg-gray-700",{"transition-all duration-150":S},{"text-token-text-secondary":!g&&!a&&!o},{"bg-blue-250 text-blue-1000 dark:bg-[#2A4A6D] dark:text-[#48AAFF]":T||o,"can-hover:hover:bg-[#BDDCF4] dark:hover:bg-[#1A416A]":T&&!o},{"focus-visible:outline-black can-hover:hover:bg-black/10 dark:focus-visible:outline-white":!B},{"opacity-30":n&&!o,"opacity-50":o}),"aria-pressed":g,"aria-label":p,disabled:B,onTransitionEnd:()=>v(!1),onClick:R=>{if(R.stopPropagation(),R.preventDefault(),b)return;v(!0);let L=!0;const w=[se.Search,se.Think].includes(m);C&&w&&((k.getState().persistedSystemHints.has(se.Search)||k.getState().persistedSystemHints.has(se.Think))&&(L=!1),_&&_r(m,!g)),L&&x(),h(m,!g,l),g||(r.removeSystemHints(),r.focus());const{enable:f,disable:D}=Rr.get(m)??{},[A,W]=(g?D:f)??[];A&&W&&G.logEventWithStatsig(A,W,l),c?.(R)},children:[s,d&&e.jsx("div",{className:"whitespace-nowrap pl-1 pr-1 [display:--force-hide-label]",children:p}),e.jsx(ms,{children:!d&&g&&e.jsx(oe.span,{initial:{x:-10,width:0,opacity:0},animate:{x:0,width:"fit-content",opacity:1},exit:{x:-10,width:0,opacity:0},transition:{ease:"easeOut",duration:N?0:.15},children:e.jsx("div",{className:"whitespace-nowrap pl-1 pr-2 [display:--force-hide-label]",children:p})})})]});return b?e.jsx(Wn,{triggerButton:M,sideOffset:0,alignOffset:0,children:e.jsx(Va,{statsig_login_event:"chatgpt_composer_upsell_login_button_clicked",statsig_signup_event:"chatgpt_composer_upsell_signup_button_clicked"})}):M}function gh({composerController:t,systemHint:s,highlightTooltip:a,composerBarButtonInfo:o,isDisabled:n,clientThreadId:r,showLabel:l,isPinnedActive:c,currentModelName:d}){const p=Tr(s.systemHint),u={clientThreadId:r};return e.jsx(xh,{composerBarButtonInfo:o,highlightTooltip:a,isThreadInSystemHintMode:p,isDisabled:n,isPinnedActive:c,analyticsMetadata:u,systemHint:s.systemHint,currentModelName:d,children:e.jsx(Pr,{highlightTooltip:a,isDisabled:n,isPinnedActive:c,systemHint:s,logo:e.jsx(Ka,{svgString:s.logo,className:"h-[18px] w-[18px]"}),composerController:t,analyticsMetadata:u,showLabel:l})})}function ph(t){const s=ao(),a=ot(t);return!a.isLoading&&a.eligible&&!s}const fh={p:t=>{const{node:s,children:a,...o}=t;return e.jsx("p",{...o,className:"text-start !text-sm !leading-6 text-white",children:a})},a:t=>{const{node:s,children:a,...o}=t;return e.jsx("a",{...o,className:"!text-sm !leading-6 !text-white !underline",children:a})}};function xh({children:t,highlightTooltip:s,isThreadInSystemHintMode:a,isDisabled:o,isPinnedActive:n,systemHint:r,composerBarButtonInfo:l,analyticsMetadata:c,currentModelName:d}){const p=ph(l.announcementKey)&&!a,u=ot(l.announcementKey),m=ge();return p?e.jsx(oo,{announcementKey:l.announcementKey,side:"bottom",show:!0,theme:"bright",dismissOnOutsideClick:!0,badge:"new",title:l.nuxTitle,onDismiss:u.markAsViewed,sideOffset:0,className:"!max-w-2xs xs:!max-w-sm",description:e.jsx(Xl,{componentOverrides:fh,children:l.nuxDescription}),children:e.jsx("div",{children:t})}):e.jsx("div",{children:e.jsx(zt,{sideOffset:0,label:o?l.disabledText:n?m.formatMessage({id:"gFCsls",defaultMessage:"You've selected a thinking model {modelName}"},{modelName:`(${d})`}):l.tooltipText,side:"right",open:s||void 0,onOpenChange:h=>{if(h){const{hover:x}=Rr.get(r)??{},[g,b]=x??[];g&&b&&G.logEventWithStatsig(g,b,c)}},children:t})})}const Rs={initial:{opacity:0,y:20,scale:.9},animate:{opacity:1,y:0,scale:1},transition:{delay:.1},exit:{opacity:0,scale:.5,transition:{duration:.2}}},Sh=({suggestions:t,onSelectingSuggestedReply:s})=>e.jsx("div",{className:"absolute bottom-full flex w-full max-w-[100vw] grow gap-2 overflow-auto px-1 pb-1 contain-inline-size sm:mb-0 sm:justify-start sm:px-2 sm:pb-0 md:static md:mb-2 md:max-w-none md:justify-center md:overflow-visible",children:t.slice(0,2).map((a,o)=>e.jsx(oe.div,{initial:Rs.initial,animate:Rs.animate,transition:{delay:(o-1)*Rs.transition.delay},exit:Rs.exit,children:e.jsx(Gt,{as:"button",color:"secondary",size:"small",onClick:()=>{s(a,t,o)},className:"group whitespace-nowrap md:whitespace-normal",children:e.jsx(bh,{suggestion:a})},o)},o))});function vh({suggestions:t,onSelectingSuggestedReply:s,clientThreadId:a}){const o=t?.length>0;i.useEffect(()=>{o&&Ot(t,a)},[o,a]);const{isUnauthenticated:n}=Ve();return o?t.every(Ya)?e.jsxs(oe.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:"flex flex-col items-center",children:[n&&e.jsx(Ks,{className:"mb-6 h-12 w-12 sm:hidden"}),e.jsx(Rm,{starterPrompts:t,onSelectStarterPrompt:s})]}):t.every(Ja)?e.jsx(Sh,{suggestions:t,onSelectingSuggestedReply:s}):null:null}function bh({suggestion:t}){return Ja(t)?e.jsx(e.Fragment,{children:t.text}):Ya(t)?e.jsxs("div",{className:"flex flex-col overflow-hidden",children:[t.title&&e.jsx("div",{className:"truncate font-semibold",children:t.title}),e.jsx("div",{className:P("truncate font-normal",t.title?"opacity-50":""),children:t.body})]}):null}function yh(){const{store:t}=Ae(),s=t.useSharedProps();return s?e.jsx(jh,{...s}):null}function jh({clientThreadId:t,suggestions:s}){const a=sn();return s===void 0||s.length===0?null:e.jsx("div",{children:e.jsx(wh,{children:e.jsx("div",{className:"grow",children:s!==void 0&&e.jsx(vh,{suggestions:s,onSelectingSuggestedReply:a,clientThreadId:t})})})})}const wh=we.div`h-full flex ml-1 md:w-full md:m-auto gap-0 md:gap-2 justify-center`,Dr=({className:t,children:s})=>e.jsx(oe.div,{className:t,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,transition:{duration:.1,delay:0}},transition:{type:"tween",duration:.3,delay:.2},children:s});function Ch({currentLeafId:t,canContinue:s,onContinueGenerating:a}){const o=i.useCallback(()=>{const r=new Zs;a(t,r),Ln()},[a,t]);let n=null;return s&&(n=e.jsx(Th,{onHandleContinueGenerating:o})),n&&e.jsx("div",{className:"flex h-full w-full items-center justify-end gap-0 py-4 md:gap-2",children:n})}function Mh({className:t}){return e.jsx(Xa,{className:P("-rotate-180",t)})}const Th=({onHandleContinueGenerating:t})=>e.jsx(Dr,{children:e.jsx(Gt,{as:"button",color:"secondary",onClick:t,className:"whitespace-nowrap py-2",icon:Mh,size:"small",children:e.jsx(I,{...Le.continueGenerating})})}),kh=({clientThreadId:t})=>{const s=Ea(),a=ae(t,X.getRequestId),o=Mt(a);i.useEffect(()=>{o&&Wo.dismissBanner()},[o]);const n=s?.is_dismissible?()=>Wo.dismissBanner():void 0;return e.jsx(ms,{children:s&&e.jsx(oe.div,{transition:{type:"tween",ease:"easeInOut",duration:.1},initial:{opacity:0,transform:"translateY(8px)"},animate:{opacity:1,transform:"translateY(0px)"},exit:{opacity:0,transform:"translateY(8px)"},children:e.jsx(Ql,{clientThreadId:t,rateLimitInfo:s,onDismiss:n})})})};function _h(t){const s=ae(t,X.getRequestId),a=Mt(s),o=Ea();return!a&&o!=null}const Un=window.sessionStorage,zn=_i(Ai(()=>({memoryFullBannerDismissed:!!Un?.getItem(Ft.MemoryFullBannerDismissed)}))),Br={dismissBanner(){zn.setState(t=>{t.memoryFullBannerDismissed=!0}),Un?.setItem(Ft.MemoryFullBannerDismissed,"true")},clearDismissedBanner(){zn.setState(t=>{t.memoryFullBannerDismissed=!1}),Un?.removeItem(Ft.MemoryFullBannerDismissed)}};function Ah(t){const s=Xe(t),a=Qa(),{data:o}=Za(s,!1,a),n=o!=null,r=n&&o.memoryFullPct>=100,[l,c]=i.useState(!1);i.useEffect(()=>{!r&&n&&(c(!0),Br.clearDismissedBanner())},[r,n]);const d=zn(p=>p.memoryFullBannerDismissed);return r&&l&&!d}function Nh(){const t=ge(),{openSettings:s}=Zl();return e.jsx(oe.div,{initial:{opacity:0},animate:{opacity:1},children:e.jsx(ro,{title:t.formatMessage(Ps.memoryFullTitle),content:t.formatMessage(Ps.memoryFullTooltip,Ps.memoryFullTooltip.values),primaryCtaText:t.formatMessage(Ps.memoryManageButton),onPrimaryCtaClick:()=>s(ec.Personalization),onDismiss:()=>Br.dismissBanner()})})}const Ps=Qe({memoryFullTitle:{id:"yRGU2/",defaultMessage:"Memory is full."},memoryManageButton:{id:"a5A88o",defaultMessage:"Manage"},memoryFullTooltip:{id:"neUc+N",defaultMessage:"New memories won’t be created until you make space. <a>Learn more</a>",values:{a:t=>e.jsx("a",{href:tc,target:"_blank",rel:"noopener noreferrer",className:"underline",children:t})}}}),vo=nt.hasSeenMemoryInSearch;function Eh(){const t=Ys();i.useEffect(()=>{G.logEventWithStatsig(z.chatgptMemoryInSearchAnnouncementShown,"chatgpt_memory_in_search_announcement_shown")},[]);const{markAsViewed:s}=ot(vo),a=i.useCallback(()=>{G.logEventWithStatsig(z.chatgptMemoryInSearchAnnouncementClosed,"chatgpt_memory_in_search_announcement_closed"),s()},[s]),o=i.useCallback(()=>{G.logEventWithStatsig(z.chatgptMemoryInSearchAnnouncementCTAClicked,"chatgpt_memory_in_search_announcement_cta_clicked"),t("#settings/Personalization"),s()},[s,t]);return e.jsx(ro,{onPrimaryCtaClick:o,primaryCtaText:e.jsx(I,{id:"8MwdJw",defaultMessage:"Settings"}),onDismiss:a,content:e.jsxs("div",{className:"flex-grow",children:[e.jsx("div",{className:"mb-0.5 font-semibold",children:e.jsx(I,{id:"Sdp8JT",defaultMessage:"Search, now with memory"})}),e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(I,{id:"a4czFu",defaultMessage:"ChatGPT can now use memories to shape searches it sends to search providers, to give you more relevant answers. You can turn this off at any time in settings. {learnMoreLink}",values:{learnMoreLink:e.jsx("a",{href:"https://help.openai.com/en/articles/9237897-chatgpt-search",target:"_blank",rel:"noopener noreferrer",className:"underline",children:e.jsx(I,{id:"JMsjZT",defaultMessage:"Learn more"})},"learn-more-link")}})})]})})}function Hr(){const t=ot(vo),{userIsInSearchHoldoutWithWebDisabled:s}=Ar();return t.eligible&&!t.isLoading&&!s}function Ih(){const{markAsViewed:t,eligible:s}=ot(vo);return s?t:void 0}const Rh=()=>{const{shouldShowSkipButton:t}=er();return t?e.jsx(Dr,{className:"flex justify-center",children:e.jsx(Gt,{as:"button",color:"secondary",onClick:()=>sc.skipParagen(),children:e.jsx(I,{...Ph.skip})})}):null},Ph=Qe({skip:{id:"dvcUbp",defaultMessage:"Skip"}}),Dh=ze(()=>Ge(()=>import("./ozlat1ypl94c5vbs.js"),__vite__mapDeps([41,2,4,1,3,5,42,43,44])).then(t=>t.JawboneNotificationsBanner)),Lr=i.memo(function({className:s}){const{store:a}=Ae(),o=a.useIsHeaderContentAreaPopulated();return e.jsx("div",{className:P(s??"absolute bottom-full left-0 right-0",nr.PromptTextareaHeader),children:e.jsx(nc,{shouldRender:o,contentArea:Ut.Header,children:e.jsxs("div",{className:"mb-2 flex flex-col gap-3.5 pt-2",children:[e.jsx(Fr,{}),e.jsx(Or,{})]})})})});function Fr(){const{store:t}=Ae(),s=t.useSharedProps(r=>r?.clientThreadId),a=t.useContentAreaId(Ut.HeaderTop),o=tr();let n;switch(a){case V.ProjectConversationTaskNoFileAccess:n=e.jsx(Fh,{});break;case V.AdvancedVoiceOnMobileAnnouncement:n=e.jsx(cc,{clientThreadId:s});break;case V.S09KM1:n=null;break;case V.ParagenControls:n=e.jsx(Rh,{});break;case V.ItemActions:n=e.jsx(yh,{});break;case V.BannerSignup:n=e.jsx(Lh,{});break;case V.BannerTermsDisclaimer:n=e.jsx(Oh,{});break;case V.PromptTextareaAction:n=e.jsx(Uh,{});break;case V.BannersRateLimit:n=e.jsx(zh,{});break;case V.BannerSidekickAnnouncement:n=e.jsx(lc,{});break;case V.SearchBrowserExtensionAnnouncement:n=e.jsx(Um,{});break;case V.MemoryInSearchAnnouncement:n=e.jsx(Eh,{});break;case V.MoonshineAnnouncement:n=e.jsx(ic,{});break;case V.SearchBrowserExtensionReactiveAnnouncement:n=e.jsx(Om,{});break;case V.BannerMemoryFull:n=e.jsx(Nh,{});break;case V.Box:n=e.jsxs("div",{className:"flex h-20 w-full items-center justify-center gap-2 bg-red-500 p-2",children:["box",e.jsxs("div",{className:"flex h-full w-full items-center justify-center gap-2 bg-blue-500 p-2",children:["inner",e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-yellow-400 text-center",children:"actual content"})]})]});break;case V.JawboneAnnouncement:o?n=e.jsx(Dh,{}):n=null;break;case V.JawboneMaxActiveAnnouncement:o?n=e.jsx(rc,{}):n=null;break;case V.PromoRedemptionAnnouncement:n=e.jsx(ac,{});break;case V.OperatorAnnouncement:n=e.jsx(oc,{});break;default:n=null;break}return n}function Or(){const{store:t}=Ae(),s=t.useContentAreaId(Ut.HeaderBottom);let a;switch(s){case sr.DallePromptControls:a=e.jsx(Hh,{});break;default:a=null;break}return a}const Bh=ze(()=>Ge(()=>import("./ke3h37k23cmcczez.js"),__vite__mapDeps([45,2,1,3,4,5,10,46])).then(t=>t.default));function Hh(){const{store:t}=Ae(),s=t.useSharedProps(a=>a?.composerController);return s?e.jsx(Bh,{composerController:s}):null}function Lh(){const{store:t}=Ae(),s=t.useSharedProps(n=>n?.clientThreadId),a=dc(),o=uc();return s?a?e.jsx(mc,{threadId:s,showSignUp:o}):e.jsx(hc,{threadId:s,showLogin:o}):null}function Fh(){return i.useEffect(()=>()=>{yn.getItem(Ft.TasksHasSeenProjectDisclaimerBanner)||yn.setItem(Ft.TasksHasSeenProjectDisclaimerBanner,!0)},[]),e.jsx(ro,{icon:e.jsx(qa,{}),title:e.jsx(I,{id:"ibX3g7",defaultMessage:"Tasks can’t access project files"}),content:e.jsx(I,{id:"fm94Tm",defaultMessage:"There’s a task in this conversation — just FYI, it won’t be able to access project files."}),onDismiss:()=>{yn.setItem(Ft.TasksHasSeenProjectDisclaimerBanner,!0)}})}function Oh(){const{store:t}=Ae(),s=t.useSharedProps(a=>a?.clientThreadId);return s?e.jsx(gc,{threadId:s}):null}function Uh(){const{store:t}=Ae(),s=t.useSharedProps();return s?e.jsx(Ch,{...s}):null}function zh(){const{store:t}=Ae(),s=t.useSharedProps(a=>a?.clientThreadId);return s?e.jsx(kh,{clientThreadId:s}):null}const Gh=5,Wh=i.memo(function(s){return qh(s),Vh(s),$h(),null});function qh(t){const{store:s}=Ae(),a=s.useSetSharedProps();_n(()=>{a(t)},[t,a])}function Vh(t){const{clientThreadId:s,canContinue:a}=t,{store:o}=Ae(),n=i.useRef({top:o.useContentAreaApi(Ut.HeaderTop),bottom:o.useContentAreaApi(Ut.HeaderBottom)}).current,r=Jh(t),l=pc(s),{shouldShowBannerSignup:c,shouldShowBannerTermsDisclaimer:d}=Xh(s),p=_h(s),u=fc(t),m=zm(t),h=Hr(),x=ao(),g=Gm(t),b=Ah(s),k=xc(),S=Sc(t),v=vc(s),C=bc(s),_=yc(s),N=jc(),B=wc(),j=ae(s,M=>M?.modelId),T=Js(s);_n(()=>{j&&T?.kind===Fe.GizmoInteraction&&T.gizmo&&kc(j,T.gizmo)?n.top.set(V.ProjectConversationTaskNoFileAccess):S.eligible?n.top.set(V.AdvancedVoiceOnMobileAnnouncement):k?n.top.set(V.ParagenControls):d?n.top.set(V.BannerTermsDisclaimer):p?n.top.set(V.BannersRateLimit):C?n.top.set(V.JawboneAnnouncement):_?n.top.set(V.JawboneMaxActiveAnnouncement):u.eligible?n.top.set(V.BannerSidekickAnnouncement):h?n.top.set(V.MemoryInSearchAnnouncement):x?n.top.set(V.MoonshineAnnouncement):m?n.top.set(V.SearchBrowserExtensionAnnouncement):g?n.top.set(V.SearchBrowserExtensionReactiveAnnouncement):N?n.top.set(V.PromoRedemptionAnnouncement):B()?n.top.set(V.OperatorAnnouncement):r?n.top.set(V.ItemActions):a?n.top.set(V.PromptTextareaAction):c?n.top.set(V.BannerSignup):b?n.top.set(V.BannerMemoryFull):v?n.top.set("CaterpillarDoneAnnouncement"):n.top.set(null)},[n,r,a,d,c,p,u,b,k,S]),_n(()=>{l&&n.bottom.set(sr.DallePromptControls)},[n,l])}function $h(){const{store:t}=Ae();i.useEffect(()=>()=>{t.reset()},[t])}function Kh(t){const s=io(),a=Vn(t),o=X.getTree(De(t)).getLastValidNode(a)?.message?.id;return s?.messageId===o?s.suggestions:[]}function Yh(t){return Kh(t).length>0}function Jh(t){const{value:s}=qe("1887864177"),a=Cc(t.clientThreadId),o=Yh(t.clientThreadId);return t.isDisabled||s?!1:t.isNewThread||a||o}function Xh(t){const{isUnauthenticated:s}=Ve(),a=Vn(t),{layer:o}=Fs("3637408529"),{layer:n}=ut("3637408529"),r=n.get("no_auth_banner_signup_rate_limit",Gh),l=o.get("should_show_no_auth_signup_banner",!0),c=Mc(g=>g.bannerDisclaimerClientThreadId),d=Tc(),p={shouldShowBannerTermsDisclaimer:!1,shouldShowBannerSignup:!1};if(!t)return p;const u=X.getTree(De(t)),m=u.countMessagesByAuthor(Ye.User),h=u.getNodeByIdOrMessageId(a),x=h?.message?.author.role===Ye.Assistant&&Ni(h.message);return p.shouldShowBannerTermsDisclaimer=x&&s&&m===1&&!d&&(c==null||c===t),p.shouldShowBannerSignup=l&&x&&s&&m>0&&m%r===0,p}const Qh=({disabled:t,clientThreadId:s})=>{Ue.markStart("ComposerModelSelectorButton",Ue.NS_COMPOSER);const a={clientThreadId:s},o=so(),n=fo(s,o,!0),{isLoading:r,data:l}=ht(),c=ae(s,x=>x?.modelId),d=Gs(l?.models,c);if(r||!d)return null;const u=l?.categories.find(x=>x.defaultModel===d.id)?.shortLabel??d.title;Ue.markRendered("ComposerModelSelectorButton",Ue.NS_COMPOSER);function m(){G.logEventWithStatsig(z.composerSystemHintButtonHovered,"composer_model_selector_button_hovered",a)}function h(){G.logEventWithStatsig(z.composerSystemHintButtonClicked,"composer_model_selector_button_clicked",a)}return e.jsx(Zh,{disabled:t,modelLabel:u,onHover:m,onOpen:h,children:e.jsx(xo,{sections:n})})},Zh=({disabled:t,children:s,modelLabel:a,onHover:o,onOpen:n})=>{const r=ge(),[l,c]=i.useState(!1);return e.jsxs(Q.Root,{open:l,onOpenChange:d=>{c(d),d&&n?.()},children:[e.jsx(eg,{disabled:!!t,children:e.jsx($n,{className:P(or.toolsButton,"flex h-8 min-w-8 items-center justify-center gap-1 rounded-lg p-1 px-2 text-sm font-semibold text-token-text-secondary hover:bg-black/10 focus-visible:outline-black disabled:opacity-30 radix-state-open:bg-black/10 dark:focus-visible:outline-white"),"aria-label":r.formatMessage({id:"njhg2P",defaultMessage:"Choose a model"}),disabled:t,onPointerOver:o,onClick:d=>{d.preventDefault()},onFocusCapture:d=>{d.stopPropagation()},children:a})}),e.jsx(Q.Portal,{children:e.jsx(Q.Content,{alignOffset:-16,onCloseAutoFocus:d=>{d.preventDefault()},className:"[--radix-popper-available-height:40dvh]",removeVerticalPadding:!0,addBottomGradient:!0,children:e.jsx("div",{className:"flex flex-col",children:s})})})]})},eg=({disabled:t,children:s})=>e.jsx(zt,{side:"right",sideOffset:0,label:t?e.jsx(I,{id:"WU1XH1",defaultMessage:"Model selector unavailable"}):e.jsx(I,{id:"7bVJwH",defaultMessage:"Choose a model"}),children:s});function tg({composerController:t,isDisabled:s,highlightTooltip:a,isPinnedActive:o,clientThreadId:n,showLabel:r}){const l=tn(),c=ge(),d=i.useMemo(()=>({clientThreadId:n}),[n]),p=i.useCallback(()=>{G.logEventWithStatsig(z.composerSearchButtonClicked,"composer_search_button_clicked",d),l&&t.trimLeadingText(/^search\b/i)},[d,t,l]),u=ar();s=s&&!u;const m=i.useMemo(()=>{const h={systemHint:se.Search,description:c.formatMessage({id:"m/oaZE",defaultMessage:"Find on the web"}),logo:"",requiredFeatures:["search"],requiredModels:[],requiredConversationModes:[Fe.PrimaryAssistant],name:c.formatMessage({id:"TbHx8d",defaultMessage:"Search"})};if(u){const x=_c(c)[1];h.composerBarButtonInfo=x.composerBarButtonInfo}return h},[c,u]);return e.jsx(ng,{highlightTooltip:a,analyticsMetadata:d,isThreadUsingSearchMode:l,isDisabled:s||o,children:e.jsx(Pr,{highlightTooltip:a,isDisabled:s||o,isPinnedActive:o,systemHint:m,logo:e.jsx(rr,{className:"h-[18px] w-[18px]"}),composerController:t,analyticsMetadata:d,onClick:p,showLabel:r})})}function sg(){const t=Hr(),s=ao(),a=ot(nt.hasSeenComposerSearchButtonTooltip);return!a.isLoading&&a.eligible&&!t&&!s}function ng({children:t,highlightTooltip:s,analyticsMetadata:a,isThreadUsingSearchMode:o,isDisabled:n}){const r=sg()&&!o,l=ot(nt.hasSeenComposerSearchButtonTooltip);return r?e.jsx(oo,{announcementKey:nt.hasSeenComposerSearchButtonTooltip,side:"right",show:!0,theme:"bright",dismissOnOutsideClick:!0,badge:"new",title:e.jsx(I,{id:"Yjduqi",defaultMessage:"Search the web"}),onDismiss:l.markAsViewed,sideOffset:0,className:"!max-w-2xs xs:!max-w-sm",description:e.jsx(I,{id:"W51Aei",defaultMessage:"Get fast answers with trusted sources. {learnMore}",values:{learnMore:e.jsx(Ac,{href:"https://openai.com/index/introducing-chatgpt-search",className:"underline",children:e.jsx(I,{id:"stA7F4",defaultMessage:"Learn more"})})}}),children:e.jsx("div",{children:t})}):e.jsx("div",{children:e.jsx(zt,{sideOffset:0,label:n?e.jsx(I,{id:"GpDAWD",defaultMessage:"Search is unavailable"}):e.jsx(I,{id:"c+4o2s",defaultMessage:"Search the web"}),side:"right",open:s||void 0,onOpenChange:c=>{c&&G.logEventWithStatsig(z.composerSearchButtonHovered,"composer_search_button_hovered",a)},children:t})})}function og({composerController:t,clientThreadId:s}){const a=ds(s),o=mo(),{setThreadSystemHintMode:n,clearAllSystemHintModeTriggers:r}=en(),{value:l}=Oe("2800342425"),c=ho(s).filter(j=>j.systemHint!==se.Think),[d,p]=i.useState([]),[u,m]=i.useState(void 0),[h,x]=i.useState(0);i.useEffect(()=>{p(u?c.filter(j=>j.name.toLocaleLowerCase().startsWith(u.text.toLocaleLowerCase())||j.systemHint.toLocaleLowerCase().startsWith(u.text.toLocaleLowerCase())):[])},[u]),i.useEffect(()=>{t.view.dispatch(Wm(t.view.state.tr,{onHintMatch(j){m(T=>Ia(T,j)?T:j)}}))},[t]);const g=!c.length||!d.length||!u;i.useEffect(()=>{g&&x(0)},[g]);const b=d.length,k=i.useCallback(j=>{x(T=>(j(T)%b+b)%b)},[b]),S=d[h],v=({hintToSave:j=S,expectPerfectMatch:T})=>{if(!u||!S||T&&j.name.toLowerCase()!==u.text.toLowerCase())return!1;G.logEvent(z.systemHintSelected,{system_hint:j.systemHint,conversation_id:a??qo});const M=u.range.from===1?j.name:u.text+j.name.slice(u.text.length),R={clientThreadId:s};return Is(t.view),o.size>0&&r(),j.systemHint===se.Search?(l&&_r(se.Search,!0),n(se.Search,!0,R,Os.CONVERSATION_COMPOSER_SLASH_SEARCH),u.range&&t.delete(u.range.from,u.range.to),t.removeSystemHints(),!0):c.filter(w=>w.composerBarButtonInfo).some(w=>w.systemHint===j.systemHint)?(n(j.systemHint,!0,R),u.range&&t.delete(u.range.from,u.range.to),t.removeSystemHints(),!0):(t.addSystemHint(j.systemHint,M,u.range.from,u.range.to),!0)},C=i.useRef(v);C.current=v;const _=i.useRef(k);_.current=k;const N=i.useRef(u);N.current=u;const B=t.view;return i.useEffect(()=>(g||qm(B,j=>{if(j==="up")_.current(T=>T-1);else if(j==="down")_.current(T=>T+1);else if(j==="cancel")Is(B),Vm(B);else{if(j==="submit")return Is(B),C.current({expectPerfectMatch:!1});if(j==="checkMatch")return C.current({expectPerfectMatch:!0})}}),()=>Is(B)),[g,B]),i.useEffect(()=>{g||G.logEvent(z.systemHintListOpened,{conversation_id:a??qo})},[g]),g?null:e.jsx(Ei,{className:"max-w-60",onMouseDown:j=>{j.preventDefault()},children:d.map((j,T)=>e.jsx("div",{onMouseOver:()=>x(T),onClick:()=>{v({hintToSave:j,expectPerfectMatch:!1}),t.focus()},children:e.jsx(Ii,{autoFocus:!1,className:"rounded-lg px-1 py-2",$spoofHovered:T===h,children:e.jsx(Ur,{title:j.name,description:j.description,logo:j.logo})})},j.systemHint))})}function Ur({title:t,description:s,logo:a,checked:o}){return e.jsxs("div",{className:"group inline-flex w-full items-center justify-start gap-2 pl-1.5 pr-3",children:[e.jsx("div",{className:"flex h-7 w-7 items-center justify-center gap-2.5",children:e.jsx(Ka,{svgString:a,className:"icon-lg text-token-text-secondary"})}),e.jsxs("div",{className:"shrink grow basis-0",children:[e.jsx("p",{className:"text-sm font-normal leading-tight text-token-text-primary",children:t}),!!s&&e.jsx("p",{className:"text-[13px] font-normal leading-[18px] text-token-text-secondary",children:s})]}),o&&e.jsx(Ri,{className:P("icon-md text-token-text-primary",{"group-hover:hidden":!o})})]})}function ag({composerController:t,clientThreadId:s}){return t instanceof go?e.jsx(og,{composerController:t,clientThreadId:s}):null}function rg({children:t,className:s,showBackground:a}){return e.jsxs("div",{className:"relative",children:[t,a&&e.jsx(oe.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20},className:P("pointer-events-none absolute bottom-0 top-0 h-8 w-8 rounded-full",s)})]})}function ig({clientThreadId:t,uploadType:s,modelAcceptedMimeTypes:a,modelSupportedImageMimeTypes:o,attachmentsProductFeature:n,getInputProps:r,openFileDialog:l,onOauthRedirect:c,historyDisabled:d,isDisabled:p,highlightTooltip:u}){const m=Nc(),{gdriveStatus:h,o365Status:x}=Ec(),g="h-[18px] w-[18px]",b=d?"text-white":u?"text-brand-blue-800":"",k=e.jsx(Ic,{ariaLabel:"",className:P(g,b)}),S=h!=="false"||x!=="false"||m;return e.jsx("div",{className:"relative",children:e.jsx(rg,{showBackground:u,className:"bg-brand-blue-800/20",children:S?e.jsx(Rc,{clientThreadId:t,icon:k,modelAcceptedMimeTypes:a,modelSupportedImageMimeTypes:o,attachmentsProductFeature:n,onOauthRedirect:c,uploadType:s,openFileDialog:l,getInputProps:r,isDisabled:p,highlightTooltip:u}):e.jsx(Pc,{clientThreadId:t,uploadType:s,openFileDialog:l,getInputProps:r,icon:k,isDisabled:p,highlightTooltip:u})})})}function lg({suggestions:t,composerController:s,onSelect:a,onChange:o}){const n=sn(),r=i.useCallback((u,m,h)=>{a?.(u,m,h),n(u,m,h)},[a,n]),[l,c]=i.useState(-1),[d,p]=i.useState(!1);return i.useEffect(()=>{const u=m=>{if(m.key==="ArrowDown"){const h=l===t.length-1?0:l+1;c(h),o?.(h,!0,t[h])}else if(m.key==="ArrowUp"){m.preventDefault();const h=l<=0?t.length-1:l-1;c(h),o?.(h,!0,t[h])}else m.key==="Enter"&&!m.shiftKey&&t[l]&&r(t[l],t,l)};return s.subscribe("keydown",u)},[t,l,o,r,s]),i.useEffect(()=>s.subscribe("blur",()=>{c(-1),o?.(-1,!1)}),[s,o]),i.useEffect(()=>{if(!d){const u=()=>{p(!0),window.removeEventListener("mousemove",u)};return window.addEventListener("mousemove",u),()=>{window.removeEventListener("mousemove",u)}}},[d]),i.useEffect(()=>{c(-1),o?.(-1,!1),p(!1)},[t,o]),e.jsx(oe.ul,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"hidden w-full flex-col p-2.5 group-focus-within:flex group-focus-within:max-lg:flex-col-reverse",children:t.map((u,m)=>e.jsxs(oe.li,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:m*.03},exit:{opacity:0,translateY:4},className:"w-full",children:[m>0&&e.jsx("div",{className:P("h-[1px] opacity-60 max-lg:hidden",l===m||l===m-1?"mx-2 bg-token-main-surface-secondary":"bg-token-border-light")}),e.jsxs("button",{className:P("flex w-full cursor-pointer items-center justify-start whitespace-pre-wrap rounded-lg px-2.5 py-3 text-start",l===m?"bg-token-main-surface-secondary":"bg-token-main-surface-primary"),onClick:h=>{h.preventDefault(),r(u,t,m)},onMouseDown:h=>{h.preventDefault()},onMouseEnter:()=>{d&&(c(m),o?.(m,!1,u))},onMouseLeave:()=>{c(-1),o?.(-1,!1,u)},children:[u.icon?e.jsx("span",{className:"mr-4 h-6 w-6 text-token-text-secondary",children:u.icon}):null,e.jsx("span",{className:"whitespace-pre-wrap",children:u.autocompletionChunks&&u.autocompletionChunks.length>0?e.jsx(e.Fragment,{children:u.autocompletionChunks.map((h,x)=>e.jsx("span",{className:P(h.isMatched?"text-token-text-tertiary":"text-token-text-primary"),children:h.text},x))}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:P(u.type===ls.Starter||u.type===ls.Trending?"text-token-text-secondary":"text-token-text-tertiary"),children:u.title}),e.jsx("span",{className:"text-token-text-primary",children:u.body})]})})]}),m>0&&e.jsx("div",{className:P("h-[1px] opacity-60 lg:hidden",l===m||l===m-1?"mx-2 bg-token-main-surface-secondary":"bg-token-border-light")})]},u.id??m))})}function cg(t,s){t=t.toLocaleLowerCase();const a=s;s=s.toLocaleLowerCase();const o=[];let n=0;for(let c=0;c<s.length&&(n<t.length&&t[n]===s[c]&&(o.push(c),n++),n!==t.length);c++);const r=[];let l=0;if(o.forEach(c=>{if(c>l){const d=a.slice(l,c);d&&r.push({text:d,isMatched:!1})}r.push({text:a[c],isMatched:!0}),l=c+1}),l<s.length){const c=a.slice(l);c&&r.push({text:c,isMatched:!1})}return dg(r)}function dg(t){if(t.length===0)return t;let s=[t[0]];for(let o=1;o<t.length;o++){const n=s[s.length-1],r=t[o];n.isMatched===r.isMatched?n.text+=r.text:s.push(r)}const a=s.filter(o=>o.isMatched).reduce((o,n)=>o+n.text.trim().length,0);return s.length<=4&&a>=2?s:[{text:s.map(o=>o.text).join(""),isMatched:!1}]}function ug(t){const{isUnauthenticated:s}=Ve(),o=Pn(v=>v.files).length>0,n=t.composerController.useState(v=>!v.isEmpty()),r=!o&&!n,{browseMode:l}=Qs(),c=Ra(),d=tn(),p=Wt(t.gizmoId),u=Hc(),m=mt(),{value:h}=qe("2360528850"),x=m&&!h,{layer:g}=ut("415386882"),b=g.get("is_voice_mode_entry_point_enabled",!1);if(t.inputState==="disabled")return null;const k=!s||s&&b,S=e.jsx(mg,{state:t.state,onSubmit:t.onSubmit,disableReason:t.disableReason,isSearchMode:d,useProduceImpl:t.useProduceImpl});return k&&!c&&!p&&r&&t.state==="disabled"&&t.clientThreadId&&l!=="gizmo-editor"&&!x?e.jsx("div",{className:"min-w-8",children:u?e.jsx(Dc,{fallback:S}):e.jsx(Bc,{clientThreadId:t.clientThreadId,fallback:S})}):S}function mg({state:t,onSubmit:s,disableReason:a,isSearchMode:o,useProduceImpl:n}){const r=t==="streaming"?Lc:Fc,l=ge(),c=ir(),d=a==="async_task_pending",p=e.jsx("button",{onClick:s,disabled:t==="disabled"||d,"aria-label":t==="streaming"?l.formatMessage(Bt.stopStreamingLabel):l.formatMessage(Bt.sendPromptLabel),"data-testid":t==="streaming"?"stop-button":"send-button",className:P("flex h-9 w-9 items-center justify-center rounded-full transition-colors hover:opacity-70 focus-visible:outline-none focus-visible:outline-black disabled:text-[#f4f4f4] disabled:hover:opacity-100 dark:focus-visible:outline-white disabled:dark:bg-token-text-quaternary dark:disabled:text-token-main-surface-secondary",n?"bg-green-600 text-white disabled:bg-green-600 disabled:bg-opacity-15 dark:bg-green-600 dark:text-white disabled:dark:bg-green-600 disabled:dark:bg-opacity-15":o?"bg-blue-1000 text-white dark:bg-blue-1000 dark:text-white":"bg-black text-white dark:bg-white dark:text-black",c&&"disabled:bg-black disabled:bg-opacity-[0.27]",!c&&"disabled:bg-[#D7D7D7]"),children:e.jsx(r,{className:P(t==="streaming"?"icon-lg":"icon-2xl")})});return a&&t==="disabled"||d?e.jsx(hg,{label:a==="file_upload_pending"?l.formatMessage(Bt.fileUploadPendingLabel):a==="empty_text_content"?l.formatMessage(Bt.emptyTextContentLabel):a==="async_task_pending"?l.formatMessage(Bt.asyncTaskInProgressLabel):l.formatMessage(Bt.textContentTooLongLabel),children:p}):p}function hg({label:t,children:s}){return e.jsx(zt,{sideOffset:14,label:t,side:"top",children:s})}const Bt=Qe({stopStreamingLabel:{id:"+yfm/p",defaultMessage:"Stop streaming"},sendPromptLabel:{id:"xfIykB",defaultMessage:"Send prompt"},emptyTextContentLabel:{id:"LCVL2q",defaultMessage:"Message is empty"},textContentTooLongLabel:{id:"kDrqDJ",defaultMessage:"Message is too long"},fileUploadPendingLabel:{id:"Qv7jQN",defaultMessage:"File upload pending"},asyncTaskInProgressLabel:{id:"a959Km",defaultMessage:"Disabled"}}),gg=i.forwardRef(function({type:s,placeholder:a,replyRegions:o,state:n,renderFiles:r,leftSideActions:l,topRightAction:c,onSubmit:d,setIsComposerOverflowing:p,inputState:u,currentLeafId:m,composerController:h,clientThreadId:x,gizmoId:g,disableReason:b},k){const S=Je(),v=Oc(),[C,_]=i.useState(void 0);let N=null;const{isLoading:B}=v;B||(N=v.modelId);const j=i.useRef(null),[T,M]=i.useState(300);i.useEffect(()=>{j.current&&M(j.current.offsetWidth)},[]),i.useEffect(()=>{B||Pi()||h.focus()},[N,h,B]);const{value:R}=Oe("3780975974"),L=w=>{bg({target:w.target,rootId:"composer-background",additonalInteractiveIds:["reply-regions"]})||h.focus()};return e.jsxs("div",{id:"composer-background",ref:k,className:P("flex w-full cursor-text flex-col rounded-3xl border border-token-border-light px-3 py-1 shadow-[0_9px_9px_0px_rgba(0,0,0,0.01),_0_2px_5px_0px_rgba(0,0,0,0.06)] transition-colors contain-inline-size dark:border-none dark:shadow-none",S&&"backdrop-blur-2xl no-transparency:backdrop-blur-none",S&&s!=="temporary"&&"bg-token-composer-surface",!S&&s!=="temporary"&&"bg-main-surface-primary dark:bg-[#303030]",s==="temporary"&&"dark bg-black"),onClick:L,style:{viewTransitionName:"var(--vt-composer)"},children:[e.jsx(ms,{initial:!1,children:o.length>0&&e.jsx(oe.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0,transition:{duration:.06}},transition:{ease:"easeOut",duration:.1},id:"reply-regions",children:e.jsx(fg,{replyRegions:o})})}),e.jsxs(e.Fragment,{children:[r,e.jsxs("div",{className:"flex min-h-[44px] items-start pl-1",children:[e.jsxs("div",{className:"min-w-0 max-w-full flex-1",ref:j,children:[!1,e.jsx("div",{className:C?"hidden":"",children:h instanceof lr?e.jsx(pg,{composerController:h,currentLeafId:m,placeholder:a,inputState:u}):e.jsx($m,{composerController:h,placeholder:a})})]}),e.jsx("div",{className:"w-[32px] pt-1",children:c})]}),e.jsxs("div",{className:"mb-2 mt-1 flex items-center justify-between sm:mt-5",ref:w=>{if(!R||!("ResizeObserver"in window))return;let f=new AbortController,D=window.innerWidth;const A=Uc({axis:"width",debounce:!0,target:w,onChange:()=>{if(!w)return;w.scrollWidth>w.clientWidth?p?.(!0):Math.abs(D-window.innerWidth)>40&&(p?.(!1),D=window.innerWidth)}});return()=>{A?.(),f.abort()}},children:[e.jsx("div",{className:"flex gap-x-1.5 text-token-text-primary",children:l}),e.jsxs("div",{className:"flex gap-x-1.5",children:[!1,e.jsx("div",{children:e.jsx(ug,{inputState:u,state:n,onSubmit:d,composerController:h,clientThreadId:x,gizmoId:g,disableReason:b})})]})]})]})]})});function pg({composerController:t,currentLeafId:s,placeholder:a,inputState:o}){const n=i.useContext(Di);return e.jsxs(e.Fragment,{children:[e.jsx(zc,{id:km,autoFocus:!0,tabIndex:0,"data-id":s,dir:"auto",ref:r=>{if(!(t instanceof lr))throw new Error("Expected TextAreaComposerController");r!=null&&(t.textArea=r,t.logPageMount())},rows:1,placeholder:a,disabled:o!=="default",className:P("m-0 resize-none border-0 bg-transparent px-0 text-token-text-primary focus:ring-0 focus-visible:ring-0",o==="disabled"&&"text-center",["max-h-[25dvh]","max-h-52"])}),e.jsx("script",{nonce:n.cspScriptNonce,suppressHydrationWarning:!0,children:"requestAnimationFrame((function(){window.__oai_logTTI?window.__oai_logTTI():window.__oai_SSR_TTI=window.__oai_SSR_TTI??Date.now()}))"})]})}function fg({replyRegions:t}){return e.jsx("div",{className:"flex cursor-auto flex-col divide-y divide-token-border-light overflow-hidden rounded-b-lg rounded-t-[20px] bg-token-main-surface-primary",children:t.map((s,a)=>{switch(s.type){case"text":return e.jsx(xg,{value:s.value,onRemoveRegion:s.onRemoveRegion},a);case"object":return e.jsx(Sg,{value:s.value,onRemoveRegion:s.onRemoveRegion},a);case"mention":case"system_hint":return e.jsx(vg,{value:s.value,icon:s.icon,onRemoveRegion:s.onRemoveRegion},a)}})})}function xg({value:t,onRemoveRegion:s}){return e.jsxs(yo,{className:"text-token-text-secondary",children:[e.jsx(jo,{children:e.jsx(cr,{className:"icon-lg-heavy"})}),e.jsx(wo,{children:`“${t}”`}),e.jsx(bo,{onClick:s})]})}function Sg({value:t,onRemoveRegion:s}){return e.jsxs(yo,{className:"text-blue-selection",children:[e.jsx(jo,{children:e.jsx(cr,{className:"icon-lg-heavy"})}),e.jsx(wo,{className:"font-semibold",children:t}),e.jsx(bo,{onClick:s})]})}function vg({value:t,icon:s,onRemoveRegion:a}){return e.jsxs(yo,{children:[e.jsx(jo,{className:"mt-0",children:s}),e.jsx(wo,{className:"font-semibold text-token-text-primary",children:t}),e.jsx(bo,{onClick:a})]})}function bo({onClick:t}){return e.jsx("button",{onClick:t,type:"button",className:"flex-shrink-0 text-token-text-secondary",children:e.jsx(Gc,{className:"icon-lg"})})}const yo=we.div`flex items-start py-2.5 gap-3 pl-3 pr-1.5 text-sm`,jo=we.span`flex-shrink-0 mt-0.5 w-7 h-6 flex justify-center items-center`,wo=we.span`flex-1 line-clamp-3 py-0.5`;function bg({target:t,rootId:s,additonalInteractiveIds:a}){let o=t;for(;o&&o!=null;){if(o.tagName==="BUTTON"||o.tagName==="INPUT"||o.tagName==="TEXTAREA"||o.isContentEditable||a.includes(o.id))return!0;if(o.id===s)return!1;o=o.parentElement}return!1}const yg=({composerController:t,disabled:s,clientThreadId:a})=>{const o=tn(),n=mo(),{setThreadSystemHintMode:r,clearAllSystemHintModeTriggers:l}=en(),c=ho(a).filter(v=>v.systemHint!==se.Think&&v.systemHint!==se.Search&&!0),d=t.useState(v=>v.getSystemHints()[0]),p=o?se.Search:n.size===1?n.values().next().value:d,{value:u}=Oe("3780975974"),[m,h]=i.useState(!1);if(i.useEffect(()=>{const v=Math.random(),C=setInterval(()=>{const _=new Date,N=_.getHours()+_.getMinutes()/60+_.getSeconds()/3600,B=Math.abs((6+N)%12-6)/6;h(Math.pow(B,15)>v)},1e3);return()=>clearInterval(C)},[]),!(t instanceof go)||c.length===0)return null;const x=t,g={clientThreadId:a};function b(){G.logEventWithStatsig(z.composerSystemHintButtonHovered,"composer_system_hint_button_hovered",g)}function k(){G.logEventWithStatsig(z.composerSystemHintButtonClicked,"composer_system_hint_button_clicked",g)}function S(v,C){if(l(),v.systemHint===se.Search){r(se.Search,C,g,Os.CONVERSATION_COMPOSER_TOOL_MENU),x.removeSystemHints(),setTimeout(()=>{x.focus()},0);return}const _=c.filter(N=>N.composerBarButtonInfo);if(_.some(N=>N.systemHint===v.systemHint)){r(v.systemHint,C,g),x.removeSystemHints(),setTimeout(()=>{x.focus()},0);return}C?(o&&r(se.Search,!1,g,Os.CONVERSATION_COMPOSER_TOOL_MENU),n.forEach(N=>{_.some(B=>B.systemHint===N)&&r(N,!1,g)}),x.addSystemHint(v.systemHint,v.name),setTimeout(()=>{x.focus()},0)):x.removeSystemHints()}return e.jsx(jg,{systemHints:c,selectedHint:p,showJack:u?!1:m,disabled:s,onHover:b,onOpen:k,onSelect:S})},jg=({systemHints:t,selectedHint:s,showJack:a,disabled:o,onHover:n,onOpen:r,onSelect:l})=>{const c=ge(),[d,p]=i.useState(!1),u=t.find(h=>h.systemHint==="contextual_answers")?.name,{value:m}=Oe("3780975974");return e.jsxs(Q.Root,{open:d,onOpenChange:h=>{p(h),h&&r?.()},children:[e.jsx(wg,{disabled:!!o,contextualAnswersHintNameIfPresent:u,children:e.jsx($n,{className:P(or.toolsButton,"flex h-9 min-w-9 items-center justify-center rounded-full border border-token-border-light p-1 text-xs font-semibold text-token-text-secondary focus-visible:outline-black disabled:opacity-30 radix-state-open:bg-black/10 can-hover:hover:bg-token-main-surface-secondary dark:focus-visible:outline-white dark:can-hover:hover:bg-gray-700"),"data-opened":ca(d),"data-jack":ca(!!a),"aria-label":c.formatMessage({id:"oDAnGy",defaultMessage:"Use a tool"}),disabled:o,onPointerOver:n,onClick:h=>{h.preventDefault()},onFocusCapture:h=>{h.stopPropagation()},children:m?e.jsx(Wc,{className:"pointer-events-none h-5 w-5"}):e.jsx(qc,{className:"pointer-events-none h-5 w-5"})})}),e.jsx(Q.Portal,{children:e.jsx(Q.Content,{alignOffset:-16,onCloseAutoFocus:h=>{h.preventDefault()},children:t.map(h=>e.jsx(Q.Item,{className:"px-1 py-2",onClick:()=>l?.(h,h.systemHint!==s),children:e.jsx(Ur,{title:h.name,description:h.description,logo:h.logo,checked:h.systemHint===s})},h.systemHint))})})]})},wg=({disabled:t,children:s,contextualAnswersHintNameIfPresent:a})=>{const o=ot(nt.hasSeenComposerSystemHintButtonTooltip),n=ot(nt.hasSeenCaSystemHint),r=!t&&!o.isLoading&&o.eligible,l=!t&&!o.isLoading&&a&&!n.isLoading&&n.eligible,c=r?{announcementKey:nt.hasSeenComposerSystemHintButtonTooltip,title:e.jsx(I,{id:"tTydhk",defaultMessage:"All your tools, in one handy place"}),onDismiss:o.markAsViewed,description:e.jsx(I,{id:"S+BFNe",defaultMessage:"Create a canvas, generate a picture, and more."})}:l?{announcementKey:nt.hasSeenCaSystemHint,title:e.jsx(I,{id:"uaC1JM",defaultMessage:"Not finding internal information?"}),onDismiss:n.markAsViewed,description:e.jsx(I,{id:"TL/S+W",defaultMessage:"If ChatGPT didn't search your files automatically, type {hintName} or select it from the menu.",values:{hintName:e.jsx("span",{className:"whitespace-nowrap font-bold",children:'"/'+a+'"'})}})}:void 0;return c?e.jsx(oo,{show:!0,side:"bottom",theme:"bright",dismissOnOutsideClick:!0,badge:"new",sideOffset:0,className:"!max-w-2xs xs:!max-w-sm",...c,children:s}):e.jsx(zt,{side:"right",sideOffset:0,label:t?e.jsx(I,{id:"uw9x80",defaultMessage:"Tools unavailable"}):e.jsx(I,{id:"mrYNGk",defaultMessage:"View tools"}),children:s})};function ca(t){return t?"":null}const Cg=1,Mg=3e3;function Tg({files:t,className:s}){const a=Yn(),o=dr(),n=Nd();return e.jsxs("div",{className:s,children:[n.map(r=>e.jsx(Ed,{textdocId:r.tempTextdocId,userCreatedTextdoc:r},r.tempTextdocId)),t.map(r=>e.jsx(Id,{borderRadius:"2xl",useV2Style:!0,width:a?"normal":"wide",onRemoveFileClick:()=>Ls.remove(o,r.tempId,"none"),file:r.file,fileId:r.fileId??void 0,contextConnectorInfo:r.contextConnectorInfo,loadingPercentage:r.status===Rd.Uploading?r.progress:void 0},r.tempId))]})}function kg({onAbortCompletion:t,onCreateNewCompletion:s,onContinueGenerating:a,currentModelId:o,clientThreadId:n,isNewThread:r,isCompletionInProgress:l,className:c,disabled:d=!1,disabledReason:p,canPause:u=!1,canContinue:m=!1,suggestions:h,isInteractableSharedThread:x,composerContainerRef:g,autocompletions:b,requiresFileUpload:k,onComposerInput:S,onComposerChange:v,onAutocompleteSelect:C,headerClassName:_,hideHeader:N,setComposerBarElement:B,onTaggingDropdownOpen:j,onTaggingDropdownClose:T}){Ue.markStart("PromptTextarea"),Ue.markRendered("PromptTextarea");const M=i.useRef(null),R=Pd(M,B),{data:L}=$s(),{data:w}=ht(),f=nn(),D=lo(),A=Bi(L),W=A?.isFree(),{isUnauthenticated:Z}=Ve(),E=ge(),F=Pa(),H=dr(),[K,Y,$]=ae(n,y=>[X.getCurrentLeafId(y),X.getRequestId(y),y?.overrideModelId]),[me]=Ga(),Ce=Ys(),{gizmoEditorData:Me,mode:Ne,getGizmoId:We}=Vc(),Ee=Da(),pe=Hi(),O=mt(),U=ur(),J=ds(n),re=!!Li(),ce=!!Fi(),ie=!!Kn(),[Te,Ie]=i.useState({}),{setThreadSystemHintMode:Be,clearSystemHintModeTrigger:de,getSystemHintModeTrigger:ne}=en(),ue=kr(),fe=ue.has(se.Search),[ke,Ze]=i.useState(!1),[et,_e]=i.useState(!1),le=Je(),He=i.useRef(!1),at=null,he=Gs(w?.models,o);let ee=Js(n),$e=ee&&"gizmo"in ee?ee.gizmo:void 0;const gt=Wt($e?.gizmo.id),on=Ih(),an=$c();let xe;$e?.gizmo.id&&(gt?xe=Qo.PROJECT:xe=Qo.GPT);const hs=eo($e?.gizmo.id),[Se,rt]=i.useState(null);Se!==null&&(ee={gizmo:Se,gizmo_id:Se.gizmo.id,kind:Fe.GizmoInteraction},$e=Se);const kt=Zo(he,ee);let gs=!1;Kc(ee)&&$e?.gizmo.id===Yc&&(gs=!0);const qt=Oi(),_t=!d&&!gs&&kt!==ea.None&&!Z,it=Jc(he,ee),Vt=Xc(he,ee);let Re=Pn(y=>y.files);const[At]=i.useState(()=>Qc());Ne==="magic"?Re=Re.filter(y=>y.gizmoId!=null):Re=Re.filter(y=>y.gizmoId==null);const ps=Zc(),Nt=Re.length>0||ps,$t=Pn(Dd.hasUploadInProgress),rn=ed(n),Kt=f.useState(y=>{const te=_m(y);return typeof he?.maxTokens=="number"&&te>he.maxTokens}),Yt=f.useState(y=>!y.isEmpty()),Et=!Kt&&!$t&&(Yt||Nt);mr(Re.length>0||$t||Yt);const pt=(kt===ea.Multimodal?td:sd)-Re.length,Jt=pt<=0,lt=Et&&!d&&!l&&!ie,[ft,ln]=i.useState(!1),xt=o??hr(L,w).id,St=Gs(w?.models,xt),It=ta(St,Vo.Search),{userIsInSearchHoldoutWithWebDisabled:Xt}=Ar(),Qt=!d&&!$e&&Ee?.includes(Bs.SearchTool)&&!Ee?.includes(Bs.SearchToolHoldout)&&!Xt&&(Ee?.includes(Bs.BrowsingAvailable)||!A?.isEnterprisey()),Zt=Qt&&It,{targetedContent:fs,setTargetedContent:vt}=gr(),be=fs?.isFocusedViewContent&&!U?void 0:fs,{rebaseSystemMessageContent:xs}=co(),bt=ho(n),cn=bt.length>0,Mo=ee?.kind===Fe.PrimaryAssistant||ee?.kind===Fe.GizmoInteraction&&gt,To=bt.find(y=>y.systemHint===se.Think),Ss=ar(),{value:vs}=Oe("3780975974"),{value:dn}=Oe("759329447"),un=vs&&To&&at==null&&ee?.kind===Fe.PrimaryAssistant&&dn,yt=cn&&Mo,[bs,mn]=i.useState(!1),hn=!W&&yt;i.useEffect(()=>{if(!D?.id)return;const y=aa.getAndReset(D?.id,J);y&&f.setText(y.inputText)},[D?.id,J,f]),i.useEffect(()=>{const y=me.get("prompt")??"";f.getCurrentText().length===0&&y.length>0&&f.setText(y)},[f,me]),i.useEffect(()=>{ft!==lt&&(ln(lt),lt&&Ui(!0).then(y=>{nd.startEnforcement(y),zi.startEnforcement(y)}))},[lt,ft,ee?.kind,Ee]);const es=od(he,ee),{handleFileAccepted:q}=ad(E,Zo(he,ee),it,"mouse",We,es?.attachments),{getInputProps:ye,open:jt}=rd({disabled:d||!_t||Jt,noClick:!0,onDropAccepted:q,onDropRejected:y=>id(y,E,F,kt),multiple:!0,maxSize:ld,maxFiles:pt,...cd(Vt)}),Rt=Gi(At),{value:gn}=Oe("1988730211"),ko=i.useCallback(()=>{f.eraseContent(),Rt.clearMessages(),f.resize(Cg),f.usedDictation=!1,is.clearOverrideModelId(n),dd();for(const y of Re)Ls.remove(H,y.tempId,"none");ud.markAllAsSent()},[f,Rt,Re,H,n]),ys=async(y,te)=>{if(y?.preventDefault(),d||!Et&&!te||!ee||De(n)?.isLoading!==!1)return;const Pe=new Zs({gizmoType:xe});Ze(!0),on?.(),an?.();const ve=f.getContentToSend(),tt=Nm(ve.content),os=new Bd($a.CompletionRequest,{expectedTimingLogs:[{name:"prompt_submitted",expectedInMs:3e3}]}),{content:Sn,attachments:Ho}=Hd(H,tt,he,ee),Lo=[],vn=[];xs&&vn.push(Vi(xs));const bn={...ee};"gizmo"in bn&&delete bn.gizmo;let Ts=f.getSystemHints();ue.size>0&&(Ts=Array.from(ue));const Fo=ne(se.Search),bi=fe?Fo??Os.CONVERSATION_COMPOSER_WEB_ICON:void 0,Oo=Ld(),Uo=Fd(),yi=f.usedDictation;let st={content:Sn,eventMetadata:{eventSource:y?"mouse":"keyboard"},completionMetadata:{suggestions:h,conversationMode:bn,systemHints:Ts,searchSource:bi},messageMetadata:{...Ho.length>0&&{attachments:Ho},...Se&&{gizmo_id:Se?.gizmo.id},...Te,...Ts.length>0&&{system_hints:Ts},...!!ve.metadata&&{serialization_metadata:ve.metadata},...Oo.length>0&&{canvas:{user_created_textdocs:Oo.map(ct=>({user_created_temp_textdoc_id:ct.tempTextdocId,type:ct.type,title:ct.title,content:ct.content,create_source:ct.create_source}))}},...Object.keys(Uo).length>0&&{__internal:{search_settings:Uo}},dictation:yi},prependMessages:Lo.length>0?Lo:void 0,appendMessages:vn.length>0?vn:void 0,turnTracker:Pe,profiler:os,requestedModelId:$};if(st=Od(st),gn&&st.completionMetadata.systemHints){let ct=!1;st.completionMetadata.systemHints=st.completionMetadata.systemHints.filter(ji=>ji===se.Search?(ct=!0,!1):!0),ct&&(st.extraStreamParams={forceUseSearch:!0})}be?.createNewCompletionParams&&(st=await be.createNewCompletionParams(st)),os.logTiming("request_params_ready"),await s(st),be?.onCreateCompletion?.({serverThreadId:J,currentLeafId:K}),be?.shouldPersistAcrossMessages!==!0&&vt(void 0),Ws.hideThreadHeader(),ko(),Ze(!1),os.logTiming("prompt_submitted"),h!==void 0&&(je.logEvent("chatgpt_prompt_ignore_suggestions"),G.logEvent(z.promptIgnoreSuggestions)),fe&&Fo&&de(se.Search)},$r=i.useRef(ys);i.useEffect(()=>{$r.current=ys});const Kr=y=>{vt(y.targetedReply),y.targetedReply&&(f.focus(),G.logEvent(z.targetedReplyButtonClicked,{conversationId:J,sourceMessageId:y.messageId}))},_o=i.useCallback(()=>{be?.onCleared?.({serverThreadId:J,currentLeafId:K}),vt(void 0),f.focus()},[K,J,be,vt,f]),Ao={Enter:{validator:y=>{const te=y.isComposing||y.keyCode===229;return!(et&&He.current)&&(y.metaKey||(pe||$i)&&!y.shiftKey&&!te)},handler:y=>{if(!lt){Kt&&F.danger("The message you submitted was too long, please submit something shorter.",{hasCloseButton:!0});return}y.preventDefault(),ys()}},Escape:{validator:y=>!y.isComposing,handler:y=>{u&&l&&(t("",Y),G.logEvent(z.pauseCompletion,{threadId:Ke(n),currentLeafId:X.getMessageId(De(n)),eventSource:"keyboard"})),y.target.value===""&&_o()}}},ts=i.useRef(Ao);ts.current=Ao;const js=md(St?.tags,ee?.kind),[pn,ws]=i.useState(!1),[fn,No]=i.useState(!1),ss=js&&pn&&!gt,Eo=f.isReady();i.useEffect(()=>f.subscribe("keydown",y=>{f.acceptLegacyKeydown()&&ts.current[y.key]?.validator(y)&&ts.current[y.key].handler(y);const Pe=f.getCurrentText();if(y.key==="@"){const ve=f.getSelectionStart(),tt=Pe.substring(0,ve);(!tt||/\s$/.test(tt)||ve===0)&&setTimeout(()=>ws(!0),10)}else pn&&ws(!1);if(y.key==="Escape"&&(rt(null),_e(!1)),Zt&&!fe){let ve;y.key==="Backspace"?ve=Pe.substring(0,Pe.length-1):ve=Pe+y.key,/^search\s?$/i.test(ve)?No(!0):fn&&No(!1)}fe&&y.key==="Escape"&&Be(se.Search,!1,{clientThreadId:n})}),[f,Eo,pn,fn,Zt,ue,fe,Be,n]),i.useEffect(()=>{const y=Object.fromEntries(Object.keys(ts.current).map(te=>[te,ve=>{const tt=ts.current[te];if(!tt||f.acceptLegacyKeydown())return!1;const{validator:os,handler:Sn}=tt;return os(ve)?(Sn(ve),!0):!1}]));f.registerKeyHandlers(y)},[f,Eo]),i.useEffect(()=>f.subscribe("paste",y=>{hd({filePickerStore:H,event:y,intl:E,toaster:F,clientThreadId:n,conversationMode:ee,currentModelConfig:he,getEditorGizmoId:We,modelSupportedImageMimeTypes:it})}),[E,n,ee,he,We,it,f,F,H]);const Yr=y=>{re||rt(y),f.trimLeadingText("@"),Ln(),ws(!1)},Jr=gd(n,At,it,es?.attachments),Xr=i.useCallback(y=>{y?.preventDefault(),t("",Y),G.logEvent(z.pauseCompletion,{threadId:Ke(n),currentLeafId:X.getMessageId(De(n)),eventSource:"mouse"}),Ln()},[t,n,Y]),Io=i.useCallback(()=>{aa.set(D?.id,J,f.getCurrentText())},[J,D?.id,f]);i.useEffect(()=>{Me||!ke&&!Wi()&&f.focus()},[ke,f]),i.useEffect(()=>{if(it.length>0)for(const te of Re)Am(te.fileSpec?.mimeType,Vt)||Ls.remove(H,te.tempId,"none");else Ls.reset(H)},[o,H]),i.useEffect(()=>{(!js&&Se||re)&&rt(null)},[js,Se,re]);const{layer:Qr}=ut("4031588851"),{layer:Ro}=ut("3637408529"),Zr=Ro.get("is_in_composer_text_exp",!1),ei=Ro.get("composer_text","MESSAGE_CHATGPT"),ti=Qr.get("composer_text","MESSAGE_CHATGPT"),si=Zr?ei:ti,[Cs,ni]=(()=>{switch(p){case"workspaceDisallowsGizmo":return[Le.disallowedByWorkspacePlaceholder,!0];case"feedbackRequired":return[Le.disabledFeedbackPlaceholder,!0];case"noModelsAvailable":return[Le.noModelsAvailablePlaceholder,!0];case"requiresPluginsToBeInstalled":return[Le.requiresPluginsToBeInstalled,!0];case"loadingPlugins":return[Le.loading,!0];case"noTestGizmoId":return[Le.noTestGizmoId,!0];default:{if(x)return[Le.placeholderWithName,!1];if(be?.placeholderTextOverride!=null)return[be.placeholderTextOverride,!1];switch(si){case"BLANK":return[null,!1];case"ASK_ANYTHING":return[Le.placeholderAskAnythingVariant,!1];case"ASK_CHATGPT_ANYTHING":return[Le.placeholderAskNameAnythingVariant,!1];default:return[Le.placeholderWithName,!1]}}}})(),oi=gt?r?E.formatMessage(In.newChatInProject):Cs?E.formatMessage(Cs,{name:"ChatGPT"}):"​":Cs?E.formatMessage(Cs,{name:Me!=null?Ne==="magic"?pd:Me.name||"GPT":$e?.gizmo.display.name??"ChatGPT"}):"​";i.useEffect(()=>f.subscribe("input",()=>{Qs.getState().isThreadHeaderVisible&&Ws.hideThreadHeader(),_e(!0)}),[f]),i.useEffect(()=>{if(S)return f.subscribe("input",()=>{S?.()})},[f,S]),i.useEffect(()=>{if(v)return f.subscribe("change",()=>{v?.()})},[f,v]),i.useEffect(()=>f.subscribe("focus",()=>{_e(!0)}),[f]);const Po=(vs||Ss)&&!bs,ai={clientThreadId:n,uploadType:kt,modelAcceptedMimeTypes:Vt,modelSupportedImageMimeTypes:it,attachmentsProductFeature:es?.attachments,getInputProps:ye,openFileDialog:jt,historyDisabled:O,onOauthRedirect:Io,highlightTooltip:k&&!Nt},Pt=[],ri=!d&&!Jt&&(_t||qt!=null)&&!fe;Pt.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-attach-file-action)"},children:e.jsx(ig,{...ai,isDisabled:!ri})},"file-upload-button")),Qt&&Pt.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-search-action)"},children:e.jsx(tg,{composerController:f,highlightTooltip:fn,clientThreadId:n,isDisabled:!Zt||Nt,showLabel:Po})},"search-button")),bt.forEach(y=>{const te=y.systemHint===se.Think;if(te&&!un||y.systemHint===se.Search&&Qt)return;const ve=te&&ce;if(y.composerBarButtonInfo){const tt=he?.tags.includes("reasoning")||he?.id.includes("o1")||he?.id.includes("o3");Pt.push(e.jsx("div",{style:{viewTransitionName:`var(--vt-composer-${y.systemHint}-action)`},children:e.jsx(gh,{composerController:f,systemHint:y,composerBarButtonInfo:y.composerBarButtonInfo,clientThreadId:n,isDisabled:!yt||ve,isPinnedActive:tt&&te,showLabel:Po,currentModelName:he?.title??""})},`system-hint-${y.systemHint}`))}}),hs&&Pt.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-system-model-selector)"},children:e.jsx(Qh,{clientThreadId:n})},"model-selector-button")),hn&&!Ss&&Pt.push(e.jsx("div",{style:{viewTransitionName:"var(--vt-composer-system-hint-action)"},children:e.jsx(yg,{composerController:f,clientThreadId:n,disabled:!yt})},"system-hint-button"));const ii=Nt&&e.jsxs(e.Fragment,{children:[Ne==="magic"&&e.jsx("div",{className:"m-2 mb-0 rounded-lg bg-token-main-surface-secondary p-2 text-xs text-token-text-secondary",children:e.jsx(I,{...Le.gizmoKnowledgeWarning})}),e.jsx(Tg,{files:Re,className:"flex flex-nowrap gap-2 overflow-x-auto p-1.5"})]}),li=ni?"disabled":"default",ci=l&&u,di=qi(),ui=!lt||ke||di,mi=Em($t,Yt,Kt,rn),Ms=ci?"streaming":ui?"disabled":"idle",ns=i.useRef(null),Dt=i.useRef(null),hi=o&&(o.startsWith("o1")||o.startsWith("o3"));i.useEffect(()=>{const y=()=>{ns.current!=null&&An.addAction("composer_state_disabled",{threadId:Ke(n),disabledReason:ns.current})};if(Et&&Ms==="disabled"){let te="unknown";d?te=p??"component_disabled_unknown":l?te="completion_in_progress":ie?te="thread_hard_blocked":ke&&(te="starting_new_completion_request"),ns.current!==te&&(Dt.current&&clearTimeout(Dt.current),Dt.current=setTimeout(y,Mg)),ns.current=te}else ns.current=null;return()=>{Dt.current&&(clearTimeout(Dt.current),Dt.current=null)}},[n,Et,Ms,d,p,l,ie,ke]);const xn=[];if(be?.label&&xn.push({type:be.type,value:be.label,onRemoveRegion:_o}),Se!==null){const y=!!Se.gizmo.tags?.includes(no.FirstParty);xn.push({type:"mention",value:Se.gizmo.display.name,icon:e.jsx(fd,{isFirstParty:y,src:Se.gizmo.display.profile_picture_url,className:"icon-md"}),onRemoveRegion:()=>{rt(null),f.focus()}})}i.useEffect(()=>{(!b||b.length===0||!et)&&(He.current=!1)},[b,et]);const gi=(y,te,Pe)=>{He.current=y>=0,te&&f.setText(Pe?`${Pe.title}${Pe.body}`:"")},Do=et&&b&&b.length>0&&!ss&&!f.hasMultipleLines()&&f.canShowAutocompletion();i.useEffect(()=>{ss?j?.():T?.()},[ss,j,T]);const Bo=Ms==="streaming"?Xr:ys,pi=ta(St,Vo.Canvas),{value:fi}=Oe("61299031"),xi=Yn(),Si=xd(),vi=pi&&fi&&!Si&&!ps&&!xi;return i.useEffect(()=>{},[at,f]),e.jsxs(Sd.Provider,{value:At,children:[e.jsx(vd,{onOauthRedirect:Io,children:e.jsx("form",{className:c,onSubmit:Bo,children:e.jsxs("div",{className:"relative flex h-full max-w-full flex-1 flex-col",children:[!N&&!le&&e.jsx(Lr,{className:_}),e.jsxs("div",{ref:g,className:"group relative flex w-full items-center",style:{"--force-hide-label":bs?"none":"block"},children:[r&&me.has("from_template_row")&&e.jsx("button",{type:"button",onClick:()=>{Ce("/")},className:"mr-2 flex h-8 w-8 items-center justify-center text-token-text-tertiary hover:text-token-text-secondary",children:e.jsx(bd,{className:"icon-lg"})}),e.jsxs(yd,{open:ss||yt||hs,children:[e.jsx(jd,{className:"w-full",children:e.jsx(gg,{type:O?"temporary":"default",ref:R,replyRegions:xn,placeholder:oi,inputState:li,setIsComposerOverflowing:mn,composerController:f,leftSideActions:Pt,topRightAction:vi&&e.jsx(wd,{composerRef:M,composerController:f,clientThreadId:n}),state:Ms,onSubmit:Bo,renderFiles:ii,currentLeafId:K,clientThreadId:n,gizmoId:$e?.gizmo.id,disableReason:mi,modelId:xt})}),e.jsx(Cd,{children:e.jsxs(Md,{side:"bottom",align:"start",sideOffset:12,children:[ss&&e.jsx(Td,{onClick:y=>Yr(y),onClose:()=>{ws(!1),f.focus()}}),yt&&e.jsx(ag,{composerController:f,clientThreadId:n})]})})]}),Do&&e.jsx("div",{className:"absolute left-0 z-10 box-border w-full bg-token-main-surface-primary pl-0 max-lg:bottom-full lg:top-full",children:e.jsx(lg,{suggestions:b,composerController:f,onSelect:C,onChange:gi})})]}),e.jsx(kd,{composerController:f,parsedDocumentHandler:Jr})]})})}),e.jsx(Wh,{canUseInlineTagging:js,isDisabled:d,clientThreadId:n,currentLeafId:K,currentRequestId:Y,canContinue:m,composerController:f,setPromptInputMetadata:Ie,suggestions:h,isNewThread:r,onCreateNewCompletion:s,onContinueGenerating:a,onResetState:ko,conversationMode:ee,isShowingAutocomplete:!!Do}),ee!=null&&!hi&&_d.includes(ee.kind)&&e.jsx(Ad,{clientThreadId:n,onTargetedReply:Kr})]})}function _g(t,s){const a=s==null&&t.message?.author.role===Ye.User&&t.message.status==="in_progress",o=t.metadata?.err!=null&&t.metadata?.errCode!==Ko.ContentPolicy,n=t.metadata?.errCode===Ko.ModelIncompatibility;return t.metadata?.canRetry===!1||n?!1:a||o}function Ag(t){return e.jsx(Nr,{clientThreadId:t.clientThreadId,children:e.jsx(Ng,{...t})})}function Ng({clientThreadId:t,isNewThread:s,currentModelId:a,showPromptStarters:o,noWrap:n,onRequestCompletion:r,composerContainerRef:l}){const d=nn(),p=qn(),u=Xn(),m=ae(t,x=>_g(X.getCurrentNode(x),null));if(fr(d),!u&&m)return e.jsx(Eg,{clientThreadId:t});const h=e.jsx(e.Fragment,{children:e.jsx(zr,{composerContainerRef:l,clientThreadId:t,currentModelId:a,isNewThread:s,showPromptStarters:o,onRequestCompletion:r})});return n?h:e.jsxs(e.Fragment,{children:[e.jsx(mh,{clientThreadId:t}),e.jsx(uo,{clientThreadId:t,isStaticSharedThread:p,verticalPadding:"none",horizontalPadding:"standard",children:e.jsx(qs,{children:h})})]})}function Eg({clientThreadId:t}){const s=Vd(t),a=ae(t,r=>X.getCurrentNode(r).metadata?.errCode===$d),o=Kd(r=>r.isoDate),n=Vn(t);return a&&o!=null&&o!==""?null:e.jsxs("div",{children:[e.jsx("div",{className:"mb-3 text-center text-xs","data-has-thread-error":!0,children:e.jsx(I,{...da.errorGeneratingResponse})}),e.jsx("div",{className:"flex items-center md:mb-4",children:e.jsx(Gt,{as:"button",color:"primary",onClick:()=>{const r=new Zs;je.logEvent("chatgpt_regenerate_due_to_error_button_clicked",void 0,as({clientThreadId:t})),s({id:n,eventMetadata:{eventSource:"mouse"},conversationMode:De(t)?.mode,turnTracker:r})},className:"m-auto",icon:Xa,"data-testid":"regenerate-thread-error-button",children:e.jsx(I,{...da.regenerateResponse})})})]})}function zr({clientThreadId:t,currentModelId:s,isNewThread:a,onRequestCompletion:o,showPromptStarters:n,composerContainerRef:r,autocompletions:l,requiresFileUpload:c,onComposerInput:d,onComposerChange:p,onAutocompleteSelect:u,headerClassName:m,hideHeader:h,onTaggingDropdownClose:x,onTaggingDropdownOpen:g}){const{data:b}=ht(),[k,S,v,C,_,N,B,j,T]=ae(t,ne=>{const ue=X.getCurrentLeafId(ne);return[ue,X.getRequestId(ne),ne?.isLoading,ne?.async_status===Ba.STREAMING,X.isMessageTurnEnded(ne),ne?.tree.getHasErrorFromNode(ue)??!1,ne?.tree.isMessageIncomplete(ue)??!1,ne?.mode,ne?.continuingFromSharedConversationId!=null]}),M=cs(),R=Dn(),{isUnauthenticated:L}=Ve(),w=Mt(S),f=Ki({clientThreadId:t}),D=!L,A=Yi(),{isOpen:W,onClose:Z}=Ud({type:"just-hit-rate-limit"}),{value:E}=Oe("1988730211"),F=mo(),H=i.useCallback((ne,ue)=>{G.logEvent(z.continueCompletion);const fe=Array.from(F),{systemHints:ke,extraStreamParams:Ze}=E?zd(fe):{systemHints:fe,extraStreamParams:{}};o({type:$o.Continue,promptId:ne,extraStreamParams:Ze,eventMetadata:{eventSource:"mouse"},cancelActiveRequests:!1,completionMetadata:{conversationMode:De(t)?.mode,systemHints:ke},turnTracker:ue})},[F,E,o,t]),K=Wa(),Y=i.useCallback(async(ne,ue)=>Gd({clientThreadId:t,currentRequestId:ue,isHistoryAndTrainingDisabled:A,queryClient:K}),[t,A,K]),me=i.useCallback(async({content:ne,eventMetadata:ue,extraStreamParams:fe,completionMetadata:ke,messageMetadata:Ze,prependMessages:et,appendMessages:_e,turnTracker:le,profiler:He,requestedModelId:at})=>{let he;Ji(t,ee=>{Xi.appendMessage(ee,Qi(ne,Ze,he))}),await o({type:$o.Next,promptId:X.getCurrentLeafId(De(t)),eventMetadata:ue,cancelActiveRequests:!0,completionMetadata:ke,extraStreamParams:fe,prependMessages:et,appendMessages:_e,turnTracker:le,profiler:He,...at?{requestedModelId:at}:{}})},[t,o,null,M?.normalizedAccountUserId]),Ce=!_&&(w||C),Me=i.useMemo(()=>Ce?!1:!N&&B,[N,B,Ce]),Ne=Ce,We=Xe(t),Ee=Tt(We).data,{promptStarters:pe,isSuccess:O}=pr(a&&!v,t,4),U=io(),J=(()=>{if(U?.messageId===X.getTree(De(t)).getLastValidNode(k)?.message?.id)return U?.suggestions;if(n&&!v&&O&&!D)return pe})(),re=Zi(),ce=Ee?.gizmo.tags?.includes(no.WorkspaceDisabled)&&!re?"workspaceDisallowsGizmo":b?.models.size===0?"noModelsAvailable":R.displayingSideBySideFeedback&&R.unskippable?"feedbackRequired":j?.kind===Fe.GizmoTest&&j.gizmo_id==null?"noTestGizmoId":null,ie=Oe("15117983")?.value,Te=Sl(),Ie=Jn(),Be=Te.action==="moderate",{value:de}=qe("1860647109");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-center",children:Ie&&Be&&de?e.jsx(Wd,{}):null}),W?e.jsx(qd,{onClose:Z}):null,ie&&j&&j.kind===Fe.PrimaryAssistant&&j.plugin_ids&&j.plugin_ids.length>0?e.jsx(Ig,{}):e.jsx(kg,{composerContainerRef:r,clientThreadId:t,onCreateNewCompletion:me,onAbortCompletion:Y,onContinueGenerating:H,currentModelId:s,isNewThread:a,isCompletionInProgress:f,className:"w-full",canContinue:Me,suggestions:J??[],disabled:!!ce,disabledReason:ce??void 0,canPause:Ne,isInteractableSharedThread:T,autocompletions:l,requiresFileUpload:c,onComposerInput:d,onComposerChange:p,onAutocompleteSelect:u,headerClassName:m,hideHeader:h,onTaggingDropdownClose:x,onTaggingDropdownOpen:g},t)]})}function Ig(){return e.jsxs("div",{className:"mx-auto flex max-w-md flex-col items-center justify-center gap-2 rounded-xl border border-token-border-light bg-token-main-surface-primary p-6 shadow-lg",children:[e.jsx("span",{className:"text-token-text-primary",children:e.jsx(I,{id:"PluginsDecrepatedNotice.pluginsDeprecationTitle",defaultMessage:"Conversations with plugins are archived"})}),e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(I,{id:"PluginsDecrepatedNotice.pluginsDeprecationSubtitle",defaultMessage:"Explore GPT Store to find a replacement"})}),e.jsxs("a",{href:"https://chat.openai.com/gpts",className:"text-green-500 hover:cursor-pointer dark:text-green-400",children:[e.jsx(I,{id:"PluginsDecrepatedNotice.pluginsDeprecationGptStoreLink",defaultMessage:"Explore GPTs"}),e.jsx("span",{className:"ml-2",children:e.jsx(I,{id:"PluginsDecrepatedNotice.pluginsDeprecationGptStoreLinkArrow",defaultMessage:"→"})})]})]})}const da=Qe({errorGeneratingResponse:{id:"PromptTextarea.errorGeneratingResponse",defaultMessage:"There was an error generating a response"},regenerateResponse:{id:"PromptTextarea.regenerateResponse",defaultMessage:"Regenerate"}}),Gr=i.memo(function(){return e.jsxs("div",{className:`mb-2 flex flex-col gap-2 empty:hidden ${nr.PromptTextareaHeader}`,children:[e.jsx(Fr,{}),e.jsx(Or,{})]})}),Pp=Object.freeze(Object.defineProperty({__proto__:null,ChatScreenComposerAlerts:Gr},Symbol.toStringTag,{value:"Module"})),ua=ze(()=>Ge(()=>import("./om37sd3nqixbghdh.js"),__vite__mapDeps([47,2,4,1,3,5,34,9,10,43,48,49,16,18,19,20,21,22,23])).then(t=>t.SnorlaxSplashScreen)),Cn=4;function Rg(){const{layer:t}=Fs("4031588851"),s=t.get("autocomplete_qualified_start_date","2099-09-13T00:00:00Z"),a=lo();return!!a&&a.created*1e3>=new Date(s).getTime()}const Mn=t=>`${t.title}${t.body}`.toLocaleLowerCase();function Pg(t){const s=Xe(t.clientThreadId),a=Wt(s);return e.jsx(Nr,{clientThreadId:t.clientThreadId,children:a&&s&&ua?e.jsx(ua,{clientThreadId:t.clientThreadId,gizmoId:s,currentModelId:t.currentModelId,onRequestCompletion:t.onRequestCompletion}):e.jsx(Lg,{...t})})}function Dg({children:t}){const{store:s}=Ae(),[a,o]=i.useState(!1),n=nn();i.useEffect(()=>n.subscribe("focus",()=>{o(!0)}),[n]),i.useEffect(()=>n.subscribe("blur",()=>{o(!1)}),[n]);const l=!!s.useSharedProps()?.isShowingAutocomplete;return t(l&&a)}function Bg({isSendBlocked:t,clientThreadId:s,headlineOption:a,shouldShowStarterPrompts:o,promptChips:n,onSelectStarterPrompt:r,starterPromptExpanded:l,setStarterPromptExpanded:c}){const d=Ha();return e.jsx(Dg,{children:p=>e.jsxs(oe.div,{initial:{opacity:0},animate:{opacity:p?0:1},exit:{opacity:0},transition:{duration:.1},className:P("justify-center",p?"pointer-events-none":"","mt-[var(--screen-optical-compact-offset-amount)] h-full flex-shrink flex-col items-center overflow-hidden text-token-text-primary [display:var(--display-hidden-until-loaded,flex)]",d?"@lg/thread:hidden":"lg:hidden"),children:[a==="CHATGPT_LOGO"?e.jsx(Ks,{className:"inline-block h-12 w-12"}):e.jsx(Wr,{headlineOption:a}),e.jsx(oe.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:P(!l&&"h-[116px]"),children:o&&e.jsx(qr,{starterPrompts:n,onSelectStarterPrompt:r,disabled:t,clientThreadId:s,onExpand:()=>c(!0),mobileLayout:!0})})]})})}function Hg(t){const s=qe("1468311859").value,a=qe("3664702598").value,{layer:o}=ut("4031588851"),n=Rg(),r=s,l=a&&n;let c="HARDCODED";if(t){const d=o.get("search_autocomplete_mode","");r&&d&&(c=d)}else l&&(c=o.get("autocomplete_mode","HARDCODED"));return c}function Lg({clientThreadId:t,currentModelId:s,isModelLoaded:a,onRequestCompletion:o,chatgptHomepageDisclaimer:n}){const r=nn(),l=Lt(t),c=ae(t,O=>O?.isLoading),d=Kn(),[p,u]=i.useState([]),m=i.useCallback(O=>{u(U=>{const J=typeof O=="function"?O(U):O;return Ia(J,U)?U:J})},[]),{trendingSuggestions:h,fetchTrendingSuggestions:x}=zg(Cn),g=i.useRef(!1),{isUnauthenticated:b}=Ve(),k=el(),[S,v]=i.useState(!1),C=tn(),_=Je();fr(r);const N=qe("589604007").value,{layer:B}=Fs("4031588851"),{layer:j}=Fs("3533083032"),{promptStarters:T,isSuccess:M}=pr(l&&!c&&a,t,8,N,!0,s??void 0),R=k&&!!p.find(O=>!!O.requires_file_upload),L=i.useCallback(O=>{const U=r.getCurrentText();return U&&Mn(O).startsWith(U.toLocaleLowerCase())},[r]),w=i.useCallback(O=>{const U=r.getCurrentText(),J=O.title+O.body;return L(O)?{...O,title:U,body:J.slice(U.length)}:{...O,title:J,body:""}},[r,L]),f=i.useCallback((O=!1)=>{m(U=>!U.some(L)&&U.length>0?[]:O?U:U.map(w))},[L,w,m]),D=(O,U,J)=>{const re=O.title;m([]),r.focus(),r.setText(re),requestAnimationFrame(()=>{const ce=(T?.filter(ie=>ie.theme===O.theme)??[]).map(ie=>{const Te=Ht(ie.oneliner),Ie=Te.startsWith(ie.title);return{...ie,title:Ie?`${ie.title} `:"",body:Ie?ie.body:Te,autocompletionChunks:cg(re,Te),type:ls.Autocomplete}});m(ce),ce.length>0&&Ot(ce,t),Xd(O,J,t)})};i.useEffect(()=>{const O=p.some(U=>U.theme===Bn.Search);C&&r.getCurrentText()===""?h.length>0?m(h):x():O&&!C&&m(U=>U.filter(J=>J.theme!==Bn.Search))},[p,C,h,x,r,m]),i.useEffect(()=>{C&&r.getCurrentText()===""&&h.length>0&&Ot(h,t)},[C,r,h,t]);const A=T?.reduce((O,U)=>(U.theme&&!O[U.theme]&&(O[U.theme]=U),O),{}),W=[];if(A)for(const O in A)W.push(A[O]);const Z=W&&W.length>0,E=!!(M&&Z&&a);Ue.markStart("StarterPromptChips",Ue.NS_COMPOSER),E&&Ue.markRendered("StarterPromptChips",Ue.NS_COMPOSER);const F=Cn-p.filter(L).length,H=Hg(C),K=b?j.get("headline_option","HELP_WITH"):B.get("headline_option","HELP_WITH"),Y=B.get("autocomplete_min_char",4),$=B.get("autocomplete_fetch_interval",200),me=i.useRef(null),Ce=i.useCallback(xr(async O=>{const U=r.getCurrentText();if(!U||U.length<Y||U.length>80||r.hasMultipleLines()){m([]);return}if(!g.current&&!(me.current&&me.current.length>Y&&U.startsWith(me.current)))try{const J=await us.generateAutocompletions(U,O,C);if(J.completions.length===0){me.current=U;return}const re=J.completions.map(ce=>({id:vl(),type:ls.Autocomplete,title:ce.slice(0,U.length),body:ce.slice(U.length),oneliner:ce,prompt:ce,source:H})).filter(L).map(w);m(ce=>{const ie=ce.filter(L),Te=re.filter(Ie=>{const Be=Mn(Ie);return!ie.some(de=>{const ne=Mn(de);if(Be===ne)return!0;const ue=/[\p{P}\p{S}]$/u,fe=Be.replace(ue,""),ke=ne.replace(ue,"");return fe===ne||Be===ke||fe===ke})}).slice(0,Cn-ie.length);return[...ie,...Te]}),re.length>0&&Ot(re,t)}catch{}},H==="BING"?150:$),[r,H,w,$]),Me=i.useCallback(()=>{f(),F>0&&Ce(F)},[Ce,f,F]);i.useEffect(()=>{g.current&&m([])},[g,m]);const Ne=i.useMemo(()=>H==="HARDCODED"?f:Me,[H,Me,f]),We=i.useCallback(()=>{r instanceof go&&f(!0),r.getCurrentText().indexOf(`
`)>0&&m([])},[r,m,f]),Ee=i.useCallback((O,U,J)=>{U.forEach(re=>{re.id===O.id&&(re.userInput=r.getCurrentText())}),m([U[J]])},[r,m]),pe=Ha();return e.jsx(e.Fragment,{children:e.jsx(ms,{children:e.jsx("div",{className:P("h-full w-full",pe?"@lg/thread:py-[18px]":"lg:py-[18px]"),children:e.jsx(uo,{isStaticSharedThread:!1,verticalPadding:"none",horizontalPadding:"standard",clientThreadId:t,fullHeight:!0,children:e.jsxs(sa,{className:"relative",children:[e.jsx("div",{className:P("mb-7 hidden text-center",pe?"@lg/thread:block":"lg:block"),children:K==="CHATGPT_LOGO"?e.jsx(Ks,{className:"inline-block h-12 w-12"}):e.jsx(Wr,{headlineOption:K})}),e.jsx(Bg,{headlineOption:K,shouldShowStarterPrompts:E,promptChips:W,onSelectStarterPrompt:D,starterPromptExpanded:S,setStarterPromptExpanded:v,isSendBlocked:d,clientThreadId:t}),e.jsx("div",{className:P(pe?"@lg/thread:absolute @lg/thread:bottom-8 @lg/thread:left-0 @lg/thread:w-full":"[display:var(--display-hidden-until-loaded,block)] lg:absolute lg:bottom-8 lg:left-0 lg:w-full"),children:e.jsx(sa,{className:"relative @lg/thread:pb-0",children:_?e.jsx(Gr,{}):e.jsx(Lr,{className:"block"})})}),e.jsx("div",{className:"w-full",children:e.jsx(zr,{clientThreadId:t,isNewThread:l,currentModelId:s,onRequestCompletion:o,showPromptStarters:!1,autocompletions:p,requiresFileUpload:R,onComposerInput:Ne,onComposerChange:We,onAutocompleteSelect:Ee,onTaggingDropdownClose:()=>{g.current=!1},onTaggingDropdownOpen:()=>{g.current=!0},hideHeader:!0})}),e.jsx(oe.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:P("hidden",pe?"@lg/thread:block":"lg:block",n&&b&&S?"":"h-[70px]"),children:E&&e.jsx(qr,{starterPrompts:W,onSelectStarterPrompt:D,disabled:d,clientThreadId:t,onExpand:()=>v(!0)})}),n&&e.jsx("div",{className:P("w-full px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden md:px-[60px]",pe?"@lg/thread:absolute @lg/thread:bottom-0 @lg/thread:left-0":"lg:absolute lg:bottom-0 lg:left-0"),children:e.jsx("div",{className:P("min-h-4"),children:n})})]})})})})})}function Wr({headlineOption:t}){const a=ge().formatMessage(Gg[t]||rs.whatCanIHelpWith);return e.jsx("div",{className:"relative inline-flex justify-center text-center text-2xl font-semibold leading-9",children:e.jsx("h1",{style:{viewTransitionName:"var(--vt-splash-screen-headline)"},children:a})})}function Fg({starterPrompt:t,starterPrompts:s,index:a,disabled:o,onSelectStarterPrompt:n}){const r=t.theme??t.title,l=sn(),{mutate:c}=Qd(),d=t.category==="onboarding"?()=>{c({key:nt.hasUsedConversationalOnboardingStarterPrompt}),l(t,s,a)}:()=>n(t,s,a);return e.jsx(Sr,{disabled:o,onClick:d,icon:e.jsx(Zd,{category:t.category,useV2Colors:!0}),label:r})}function ma({clientThreadId:t,onClick:s}){i.useEffect(()=>{eu(t)},[t]);const a=ge();return e.jsx(oe.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},className:"inline-block",children:e.jsx(Sr,{onClick:()=>{tu(t),s()},label:a.formatMessage(rs.moreStarterPrompts)})})}const Og=5,Ug=3;function qr({starterPrompts:t,onSelectStarterPrompt:s,disabled:a,clientThreadId:o,onExpand:n,mobileLayout:r=!1}){const l=r?Ug:Og,[c,d]=i.useState(l),[p,u]=i.useState(!1),m=i.useRef(null),h=t.length<=c;i.useEffect(()=>{Ot(t.slice(0,l),o)},[o]),i.useEffect(()=>{if(!p&&!h&&m.current){const g=m.current,b=g.getBoundingClientRect(),k=b.width,S=Array.from(g.children);let v=0;for(let C=0;C<S.length&&S[C].getBoundingClientRect().right-b.left<=k;C++)v++;d(v),u(!0)}},[t,h,p]);const x=()=>{const g=t.slice(c,t.length).map(b=>({...b,isAdditional:!0}));g.length>0&&Ot(g,o),d(t.length),n()};return e.jsxs("div",{className:P("mt-5 flex items-center justify-center gap-x-2 transition-opacity xl:gap-x-2.5",p&&t.length>0?"opacity-100":"opacity-[0.01]",r?"flex-wrap":"flex-nowrap"),children:[e.jsxs("ul",{className:P("relative flex items-stretch gap-x-2 gap-y-4 overflow-hidden py-2 sm:gap-y-2 xl:gap-x-2.5 xl:gap-y-2.5",h||r?"flex-wrap justify-center":"flex-nowrap justify-start"),ref:m,children:[t.slice(0,c).map((g,b)=>e.jsx(oe.li,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3,ease:"easeOut"},children:e.jsx(Fg,{starterPrompt:g,starterPrompts:t,index:b,disabled:a,onSelectStarterPrompt:s})},g.id??b)),r&&t.length>c&&e.jsx(ma,{clientThreadId:o,onClick:x})]}),!r&&t.length>c&&e.jsx(ma,{clientThreadId:o,onClick:x})]})}const zg=t=>{const[s,a]=i.useState([]),o=i.useCallback(async()=>{const r=(await us.generateTrendingSuggestions(t)).suggestions.map((l,c)=>({type:ls.Trending,title:ha(l),body:"",icon:e.jsx(Yd,{}),prompt:ha(l),id:`search-trending-${c}`,theme:Bn.Search}));a(r)},[t]);return{trendingSuggestions:s,fetchTrendingSuggestions:o}};function ha(t){return t.split(" ").map(Jd).join(" ")}const rs=Qe({whatCanIHelpWith:{id:"SplashScreenV2.whatCanIHelpWith",defaultMessage:"What can I help with?"},whereShouldWeStart:{id:"SplashScreenV2.whereShouldWeStart",defaultMessage:"Where should we start?"},askChatgptAnything:{id:"SplashScreenV2.askChatgptAnything",defaultMessage:"Ask ChatGPT anything"},moreStarterPrompts:{id:"SplashScreenV2.moreStarterPrompts",defaultMessage:"More"}}),Gg={HELP_WITH:rs.whatCanIHelpWith,WHERE_TO_START:rs.whereShouldWeStart,ASK_CHATGPT:rs.askChatgptAnything};function Wg({clientThreadId:t,currentModelId:s,isModelLoaded:a,onRequestCompletion:o,showChatgptHomepage:n,chatgptHomepageDisclaimer:r}){const l=mt();let c=e.jsx(Dm,{}),d;return l?(d=e.jsx(qg,{}),c=e.jsx(Ks,{className:"mb-6 h-12 w-12 brand:hidden"})):t!=null?(d=n?e.jsx(Pg,{clientThreadId:t,currentModelId:s,isModelLoaded:a,onRequestCompletion:o,chatgptHomepageDisclaimer:r}):e.jsx(Bm,{clientThreadId:t}),c=null):d=e.jsx(Vg,{}),e.jsxs("div",{className:"flex h-full flex-col items-center justify-center text-token-text-primary",children:[c,d]})}function qg({gizmo:t}){const s=nu(),a=t?ou(t.tools):!1,o=cs();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-5 text-2xl font-semibold","data-testid":"temporary-chat-label",children:[e.jsx(au,{id:"temporary-chat-checkbox",name:"temporary-chat-checkbox",checked:!0}),e.jsx(I,{...Ct.temporaryChat})]}),e.jsxs("div",{className:"max-w-sm text-center text-sm font-normal text-token-text-tertiary",children:[e.jsx(I,{...o?.isWorkspaceAccount()?s?Ct.temporaryChatBizMemoryAvailable:Ct.temporaryChatBizMemoryUnavailable:s?Ct.temporaryChatDescriptionMemoryAvailable:Ct.temporaryChatDescriptionMemoryUnavailable}),a&&e.jsx("div",{className:"mt-3",children:e.jsx(I,{...Ct.temporaryChatDescriptionGptActions,values:{link:n=>e.jsx("a",{href:"https://help.openai.com/en/articles/8914046-temporary-chat-faq",target:"_blank",className:"underline",rel:"noreferrer",children:n})}})})]})]})}function Vg(){return e.jsx("div",{className:"mb-5 text-2xl font-semibold",children:e.jsx(I,{...Ct.howCanIHelpYouToday})})}function $g({clientThreadId:t,currentModelId:s,isModelLoaded:a,onRequestCompletion:o,showChatgptHomepage:n,chatgptHomepageDisclaimer:r}){const l=Xe(t),c=La(),d=Kn(),{data:p}=Tt(l),u=su(),m=tl(()=>navigator.windowControlsOverlay);return(c!=null||l!=null)&&p==null?null:e.jsxs("div",{className:"relative h-full",children:[e.jsx("div",{className:m?.visible?P("absolute right-[calc(100dvw-env(titlebar-area-width,100dvw)-env(titlebar-area-x,0))]",u?"left-[env(titlebar-area-x,0)]":"left-0"):"absolute left-0 right-0",children:e.jsx(Ir,{clientThreadId:t})}),p!=null?e.jsx(Pm,{gizmo:p,showStarterPrompts:!0,disableStarterPrompts:d}):e.jsx(Wg,{clientThreadId:t,currentModelId:s,isModelLoaded:a,onRequestCompletion:o,showChatgptHomepage:n,chatgptHomepageDisclaimer:r})]})}const Ct=Qe({temporaryChat:{id:"GizmoLanding.temporaryChat",defaultMessage:"Temporary Chat"},temporaryChatBizMemoryAvailable:{id:"g1opBW",defaultMessage:"This chat won't appear in your history and won't use or create memories."},temporaryChatBizMemoryUnavailable:{id:"fQmbtG",defaultMessage:"This chat won't appear your conversation history."},temporaryChatDescriptionMemoryAvailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryAvailable",defaultMessage:"This chat won't appear in history, use or create memories, or be used to train our models. For safety purposes, we may keep a copy for up to 30 days."},temporaryChatDescriptionMemoryUnavailable:{id:"GizmoLanding.temporaryChatDescriptionMemoryUnavailable",defaultMessage:"This chat won't appear in history or be used to train our models. For safety purposes, we may keep a copy of this chat for up to 30 days."},temporaryChatDescriptionGptActions:{id:"GizmoLanding.temporaryChatDescriptionGptActions",defaultMessage:"Any data shared with a third party through GPT actions are subject to the third party's privacy policy. <link>Learn more</link>"},howCanIHelpYouToday:{id:"GizmoLanding.howCanIHelpYouToday",defaultMessage:"How can I help you today?"}});function Kg({modelSlug:t,animateModelLabelOnRender:s,isDropdownOpen:a,isRegenerateEnabled:o,isHovered:n,animateShortLabel:r}){const{data:l}=ht(),[c,d]=i.useState("initial");i.useEffect(()=>{if(s){const h=setTimeout(()=>d("show"),500),x=setTimeout(()=>d("initial"),2e3);return()=>{clearTimeout(h),clearTimeout(x)}}d("initial")},[s]);const{shorterLabel:p}=l?.categories.find(({defaultModel:h})=>h===t)??{},u={initial:{opacity:0,paddingLeft:0,width:"0"},show:{opacity:1,paddingLeft:2,width:"100%"},visible:{opacity:1,paddingLeft:2,width:"100%",transition:{delay:0,duration:0}}},m=a?"visible":n?"show":c;return e.jsxs(oe.div,{initial:"initial",animate:m,className:"flex items-center pb-0",children:[e.jsx(vr,{className:"icon-md"}),(o||r)&&e.jsx(oe.span,{className:"overflow-hidden text-clip whitespace-nowrap text-sm",variants:u,transition:{type:"tween",duration:.18},children:p}),o&&e.jsx(to,{className:"icon-sm"})]})}function Gn(t,s){const{modelSwitcherDeny:a,subscriptionLevel:o}=t;return!!a&&a.reason===sl.RATE_LIMIT&&o===nl.PLUS&&!s}const Ds="rounded-lg radix-disabled:pointer-events-auto radix-disabled:cursor-not-allowed";function Yg({className:t,clientThreadId:s,message:a,onModelSelect:o,onDropdownChange:n,canRegenerateResponse:r}){const[l,c]=i.useState(null),[d,p]=i.useState(!1),[u,m]=i.useState(!1),h=Xe(s),x=ru({clientThreadId:s,message:a}),g=a.message.metadata?.model_slug,b=a.message.id,{modelOptions:k,modelSlug:S,animateModelLabelOnRender:v,messageModelEnabledTools:C}=x,_=iu(a.message),N=C.includes(se.Search),B=i.useMemo(()=>k.find(f=>f.value===g),[k,g]),j=i.useRef(null),{data:T=null}=$s(),M=T&&Na(T),R=f=>{f||setTimeout(()=>{j.current&&j.current.blur()},10)};if(i.useEffect(()=>{R(d)},[d]),ae(s,du))return null;const w=r&&k.some(f=>Gn(f,M));return h?null:e.jsxs(Q.Root,{onOpenChange:f=>{r&&(p(f),n(f),R(f)),f&&G.logEvent(z.conversationOpenMessageModelSelector,{has_get_plus_button:w,is_new_regen_dropdown:!0})},children:[r?e.jsx(Xg,{label:e.jsx(I,{id:"wDs5sz",defaultMessage:"Switch model"}),children:e.jsx($n,{ref:j,className:P("cursor-pointer",t),onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),children:e.jsx(Kg,{modelSlug:S,animateModelLabelOnRender:v,isDropdownOpen:d,isRegenerateEnabled:r,isHovered:u})})}):null,r&&e.jsx(Q.Portal,{children:e.jsxs(Q.Content,{className:"z-30 min-w-fit origin-top-right text-token-text-primary",side:"bottom",align:"start",children:[e.jsx(Q.Item,{disabled:!0,className:"pb-0 pt-2",children:e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(I,{id:"bFLh5u",defaultMessage:"Switch model"})})}),e.jsx(Jg,{clientThreadId:s,messageId:b,onModelSelect:o,messageModelSlug:g,modelOptions:k,setHoveredOption:c,hoveredOption:l,retryOption:B,lastResponseUsedSearch:_,modelSupportsSearch:N,doesUserHaveAnyAccountsWithPlusFeatures:M})]})})]})}function Jg({clientThreadId:t,messageId:s,modelOptions:a,messageModelSlug:o,onModelSelect:n,setHoveredOption:r,hoveredOption:l,retryOption:c,lastResponseUsedSearch:d,modelSupportsSearch:p,doesUserHaveAnyAccountsWithPlusFeatures:u}){const m=ge(),[h,x]=i.useMemo(()=>lu(a,S=>S.subcategory),[a]),g=i.useMemo(()=>{const S=new Map;return h.forEach(v=>{const C=v.subcategory;C&&(S.has(C)||S.set(C,[]),S.get(C)?.push(v))}),S},[h]),b=P("icon-sm","order-10 ml-auto text-token-text-tertiary icon-md"),k=[{key:"use-search",extraStreamParams:{forceUseSearch:!0},label:m.formatMessage(Tn.search),icon:e.jsx(rr,{className:b}),condition:p&&!d,eventName:"chatgpt_regenerate_with_search_button_clicked"},{key:"use-no-search",extraStreamParams:{forceUseSearch:!1},label:m.formatMessage(Tn.nosearch),icon:e.jsx(cu,{className:b}),condition:p&&d,eventName:"chatgpt_regenerate_without_search_button_clicked"}];return e.jsxs(e.Fragment,{children:[x.map(S=>{const{value:v,...C}=S;return e.jsx(Ns,{value:v,onSelect:()=>{je.logEvent("chatgpt_regenerate_switch_model_button_clicked",v,{requestedModelId:v,...as({clientThreadId:t,messageId:s})}),n({requestedModelId:v})},includeRegenerate:!1,onMouseEnter:()=>r(v),onMouseLeave:()=>r(null),isHovered:l===v,messageModelSlug:o,includeCheck:!1,shouldShowUpsell:Gn(S,u),className:Ds,...C,icon:e.jsx("span",{className:b})},v)}),[...g.entries()].map(([S,v])=>e.jsxs(Q.Sub,{children:[e.jsx(Q.SubMenuTrigger,{children:e.jsx("div",{className:"flex grow justify-between gap-2 overflow-hidden",children:S})}),e.jsx(Q.Portal,{children:e.jsx(Q.SubContent,{className:"min-w-fit",children:v.map(C=>{const{value:_,...N}=C;return e.jsx(Ns,{value:_,onSelect:()=>{je.logEvent("chatgpt_regenerate_switch_model_button_clicked",_,{requestedModelId:_,...as({clientThreadId:t,messageId:s})}),n({requestedModelId:_})},includeRegenerate:!1,onMouseEnter:()=>r(_),onMouseLeave:()=>r(null),isHovered:l===_,messageModelSlug:o,includeCheck:!1,className:Ds,...N,icon:null,shouldShowUpsell:Gn(C,u)},S+"-"+_)})})})]},S)),!!c&&e.jsxs(e.Fragment,{children:[e.jsx(Q.Separator,{}),e.jsx(Ns,{onSelect:()=>{je.logEvent("chatgpt_regenerate_try_again_button_clicked",c.value,{requestedModelId:c.value,...as({clientThreadId:t,messageId:s})}),n({requestedModelId:c.value})},includeRegenerate:!0,onMouseEnter:()=>r(c.value),onMouseLeave:()=>r(null),messageModelSlug:o,includeCheck:!1,className:Ds,...c,label:m.formatMessage(Tn.tryAgain),subtitle:c.label,icon:e.jsx(vr,{className:b})},c.value),k.filter(S=>S.condition).map(S=>e.jsx(Ns,{onSelect:()=>{je.logEvent(S.eventName,c.value,{requestedModelId:c.value,...as({clientThreadId:t,messageId:s})}),n({requestedModelId:c.value,extraStreamParams:S.extraStreamParams})},includeRegenerate:!1,onMouseEnter:()=>r(S.key),onMouseLeave:()=>r(null),isHovered:l===S.key,messageModelSlug:o,includeCheck:!1,className:Ds,...c,label:S.label,subtitle:"",icon:S.icon},S.key))]})]})}function Xg({children:t,label:s}){return e.jsx(zt,{label:s,sideOffset:0,children:t})}const Tn=Qe({tryAgain:{id:"VbsBGW",defaultMessage:"Try again"},search:{id:"eTV6j1",defaultMessage:"Search the web"},nosearch:{id:"IvLzUk",defaultMessage:"Without web search"}}),Qg=i.memo(Yg);function Zg({followups:t}){const s=sn();return e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 font-semibold",children:e.jsx(I,{id:"3UFIQc",defaultMessage:"Follow up"})}),e.jsx("div",{children:t.slice(0,4).map((a,o)=>e.jsx(oe.div,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:o*.03},exit:{opacity:0,translateY:4},children:e.jsx(ep,{followUp:a,onSelectingSuggestedReply:s})},o))})]})}function ep({followUp:t,onSelectingSuggestedReply:s}){return e.jsxs("button",{className:"-ml-3 flex w-full items-start gap-1 rounded-lg py-2.5 hover:bg-token-main-surface-secondary",onClick:()=>s(t,[],0),children:[e.jsx("div",{className:"pl-2 opacity-30",children:e.jsx(uu,{className:"h-6 w-6"})}),e.jsx("div",{className:"gap-0.5 pr-2 text-left",children:mu(t)})]})}const ga=ze(()=>Ge(()=>import("./pceg3mlzf8dzw9ob.js").then(t=>t.s4),__vite__mapDeps([4,1,2,3,5])).then(t=>t.MemoryActionResult));function pa(t,s,a){is.updateTree(t,o=>{o.updateNodeMetadata(s,{inlineComparisonRating:a})})}const fa=({messages:t})=>{for(const{message:{metadata:s}}of t){const{augmented_paragen_prompt_label:a}=s??{};if(a)return a}};function tp(t){const s=i.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),a=i.useRef({left:null,right:null});return t.stubSideBySideFeedback?e.jsx(Vr,{setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:s,firstVisibleTokenTimestampsRef:a,...t}):e.jsx(sp,{...t,visibilityStateRef:s,firstVisibleTokenTimestampsRef:a})}function sp(t){const{clientThreadId:s,variantIds:a,variantsInStreamInfo:o,turnIndex:n,firstVisibleTokenTimestampsRef:r}=t;if(a.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const l=Co(),c=Xn(),d=ol(),[p,u]=i.useMemo(()=>br(a.join(""))()<.5?[0,1]:[1,0],[a[0],a[1]]),m=p<u?"left":"right",h=m==="left"?"right":"left",x=a[p],g=a[u],[b,k]=ae(s,M=>[Ht(M).tree.getLeafFromNode(x).id,Ht(M).tree.getLeafFromNode(g).id]),S=Ht(Nn(s,n,b)),v=Ht(Nn(s,n,k)),C=m==="left"?S:v,_=m==="left"?v:S,N=o.display_treatment==="unskippable",B=l?"skippable_parallel_2_in_stream:a:2.0":"skippable_parallel_2_in_stream:a:1.5";i.useEffect(()=>(Dn.setState({displayingSideBySideFeedback:!0,unskippable:N}),()=>{Dn.setState({displayingSideBySideFeedback:!1,unskippable:!1})}),[N]),hu();const j=i.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null});i.useEffect(()=>al(rl,{requestCompletion:()=>{const M=Ke(s),L=X.getTree(De(s)).getParentPromptNode(b),w=[S,v].map((A,W)=>({messageId:A.messages[A.messages.length-1].message.id,loadFirstTokenTime:W===0?r.current.left:r.current.right,loadEndTime:Us(A.messages)?.completionSampleFinishTime})),f={},D=L.metadata?.variantsInStreamInfo==null&&L.message.metadata?.paragen_variants_info!=null;for(const A of w)f[A.messageId]=D?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:A.loadFirstTokenTime,load_end_time:A.loadEndTime};ja({params:{conversation_id:M,displayed_message_ids:w.map(A=>A.messageId),message_metadatas:f,rating:"skipped",selected_message_id:null,source_timestamp:Date.now(),ui_variant:l?2:1,user_prompt_message_id:L.message.id}})}}),[S,v,b,s,t.conversationTurnMountTime,B,h,C?.messages,_?.messages,d,l,r]);const T=M=>{const R=X.getTree(De(s)),L=R.getLeafFromNode(M);is.setThreadCurrentLeafId(s,L.id);const w=M===x,f=w===(m==="left");C.messages.length>0&&pa(s,C.messages[C.messages.length-1].nodeId,f?"original":"new"),_.messages.length>0&&pa(s,_.messages[_.messages.length-1].nodeId,f?"original":"new");const D=Ke(s),A=[S,v].map((H,K)=>({messageId:H.messages[H.messages.length-1].message.id,loadFirstTokenTime:K===0?r.current.left:r.current.right,loadEndTime:Us(H.messages)?.completionSampleFinishTime})),W=w?A[0].messageId:A[1].messageId,Z=R.getParentPromptNode(b),E={},F=Z.metadata?.variantsInStreamInfo==null&&Z.message.metadata?.paragen_variants_info!=null;for(const H of A)E[H.messageId]=F?{load_first_token_time:t.conversationTurnMountTime,load_end_time:t.conversationTurnMountTime}:{load_first_token_time:H.loadFirstTokenTime,load_end_time:H.loadEndTime};ja({params:{conversation_id:D,displayed_message_ids:A.map(H=>H.messageId),message_metadatas:E,rating:"selected",selected_message_id:W,source_timestamp:Date.now(),ui_variant:l?2:1,user_prompt_message_id:Z.message.id}})};return e.jsx(Vr,{...t,setPreferredFeedback:T,leftVariantId:x,rightVariantId:g,leftTurn:S,rightTurn:v,hasActiveRequest:c,originalTurn:C,visibilityStateRef:j})}function np(t){if(!t.length)return!1;const s=t.filter(a=>a.type===na.Text||a.type===na.MultiText).filter(a=>a.message.message.status!=="finished_successfully"&&a.message.message.metadata?.snorkle_status!==void 0);return s.length>0&&s.every(a=>{const o=a.message.message.content;return o?.content_type===Fa.Text&&o.parts.join("")===""})}function Vr({setPreferredFeedback:t,leftVariantId:s,rightVariantId:a,leftTurn:o,rightTurn:n,hasActiveRequest:r,originalTurn:l,visibilityStateRef:c,...d}){const{defaultParagenLabel:p,shouldShowParagenLabels:u=!1}=er(),m=o&&fa(o)||p,h=n&&fa(n)||p,x=i.useMemo(()=>o?.messages??[],[o?.messages]),g=i.useMemo(()=>n?.messages??[],[n?.messages]),{avatarClassName:b,firstVisibleTokenTimestampsRef:k}=d,S=i.useMemo(()=>Vs(x),[x]),v=i.useMemo(()=>Vs(g),[g]),C=Qa(),[_,N]=i.useMemo(()=>[S,v].map(F=>np(F)),[S,v]),B=Mt(o?zs.getRequestIdFromConversationTurn(o):"")||_,j=Mt(n?zs.getRequestIdFromConversationTurn(n):"")||N,T=o?.role===Ye.User,M=n?.role===Ye.User,R=i.useRef(null),L=i.useRef(null),w=i.useRef(null),f=d.stubSideBySideFeedback||_,D=d.stubSideBySideFeedback||N;!f&&k.current.left==null&&(k.current.left=Date.now()),!D&&k.current.right==null&&(k.current.right=Date.now()),i.useEffect(()=>{if(R.current&&L.current&&w.current){const F=Array(11).fill(0).map((K,Y)=>Y/10),H=new IntersectionObserver(K=>K.forEach(Y=>{Y.target===L.current?(c.current.left_visibility_initial==null&&(c.current.left_visibility_initial=Y.intersectionRatio),c.current.left_visibility_max=Math.max(c.current.left_visibility_max??0,Y.intersectionRatio)):Y.target===w.current&&(c.current.right_visibility_initial==null&&(c.current.right_visibility_initial=Y.intersectionRatio),c.current.right_visibility_max=Math.max(c.current.right_visibility_max??0,Y.intersectionRatio))}),{root:R.current,threshold:F});return H.observe(L.current),H.observe(w.current),()=>H.disconnect()}},[c]);const{data:A}=Za(void 0,!1,C),W=Co(),Z=e.jsx("div",{className:"text-pretty px-6 pb-5 pt-1 text-center text-sm text-token-text-secondary",children:e.jsx(I,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})}),E=Je();return e.jsxs("div",{className:"relative flex flex-col",children:[e.jsxs("div",{className:P("sticky z-[1] text-pretty bg-token-main-surface-primary px-6 text-center text-lg",E&&"top-[var(--thread-leading-height)] pt-3",!E&&"top-[-1px]",W&&!E?"md:top-header-height":E?"":"md:static"),"data-testid":"paragen-feedback-title",children:[e.jsx(I,{id:"JgCHDY",defaultMessage:"You’re giving feedback on a new version of ChatGPT."}),W?Z:null]}),W?null:Z,e.jsx("div",{className:"relative -mb-2 snap-x snap-mandatory overflow-x-auto px-3 pb-4 md:px-5 lg:px-10",ref:R,children:e.jsx("div",{className:P(!E&&"min-w-fit"),children:e.jsxs("div",{className:P("mx-auto flex max-w-6xl items-start",W&&!E&&"divide-x divide-token-border-medium dark:divide-token-border-heavy",!W&&!E&&"gap-4 sm:gap-6",W&&E&&"divide-x divide-token-border-medium dark:divide-token-border-heavy",E&&!W&&"gap-4 sm:gap-6"),children:[e.jsxs(xa,{horizontalScrollContainerRef:R,rootElementRef:L,onClick:()=>{t(s)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:f,children:[e.jsxs(ba,{children:[e.jsx(Hn,{messages:x,isUserTurn:T,avatarClassName:b}),e.jsx(va,{children:u?e.jsx("span",{className:"font-bold text-token-text-primary",children:m}):e.jsx(I,{...wa.responseNumber,values:{responseIndex:1}})})]}),W&&f?e.jsx(Sa,{}):e.jsxs(e.Fragment,{children:[A!=null&&!T&&e.jsx(ga,{clientThreadId:d.clientThreadId,messages:x,isParagen:!0}),e.jsx(Fn,{...d,groupedMessagesToRender:S,allGroupedMessages:S,isEditing:!1,isUserTurn:T,isCompletionRequestInProgress:B,hasActiveRequest:r,handleEnterEdit:ks,handleExitEdit:ks,shouldGrowContainer:!1}),e.jsx(ya,{clientThreadId:d.clientThreadId,conversationTurnMountTime:d.conversationTurnMountTime,turn:o,originalTurn:l})]})]}),e.jsxs(xa,{horizontalScrollContainerRef:R,rootElementRef:w,onClick:()=>{t(a)},hasActiveRequest:r,isWaitingOnFirstUserVisibleToken:D,children:[e.jsxs(ba,{children:[e.jsx(Hn,{messages:g,isUserTurn:M,avatarClassName:b}),e.jsx(va,{children:u?e.jsx("span",{className:"font-bold text-token-text-primary",children:h}):e.jsx(I,{...wa.responseNumber,values:{responseIndex:2}})})]}),W&&D?e.jsx(Sa,{}):e.jsxs(e.Fragment,{children:[A!=null&&!M&&e.jsx(ga,{clientThreadId:d.clientThreadId,messages:g,isParagen:!0}),e.jsx(Fn,{...d,groupedMessagesToRender:v,allGroupedMessages:v,isEditing:!1,isUserTurn:M,isCompletionRequestInProgress:j,hasActiveRequest:r,handleEnterEdit:ks,handleExitEdit:ks,shouldGrowContainer:!1}),e.jsx(ya,{clientThreadId:d.clientThreadId,conversationTurnMountTime:d.conversationTurnMountTime,turn:n,originalTurn:l})]})]})]})})})]})}function xa({horizontalScrollContainerRef:t,rootElementRef:s,onClick:a,children:o,hasActiveRequest:n,isWaitingOnFirstUserVisibleToken:r}){const l=Co(),c=Je(),{scrollX:d}=bl({layoutEffect:!1,container:t,target:s}),p=gu(),u=pu(),m=i.useRef(null),h=i.useRef(null),x=i.useRef(null),[g,b]=i.useState(!1),[k,S]=i.useState(!1),[v,C]=i.useState(!1),[_,N]=i.useState(0);i.useEffect(()=>{if(!l)return;const w=new IntersectionObserver(f=>{for(const D of f)D.target===m.current?b(D.isIntersecting):D.target===x.current?C(D.isIntersecting):D.target===h.current&&S(D.isIntersecting)},{root:p?.current,rootMargin:c?`0px 0px -${_}px 0px`:void 0});return m.current&&h.current&&x.current&&(w.observe(m.current),w.observe(h.current),w.observe(x.current)),()=>{w.disconnect()}},[_,l,c,p]);const B=!v&&(k||g),j=yl(d,w=>B?-1*w:0),T=Yo(0);i.useEffect(()=>{if(!l)return;const w=new ResizeObserver(f=>{Es(f.length===1,"entryList.length === 1");const D=f[0];Es(D.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),T.set(D.contentBoxSize[0].inlineSize)});return s.current&&w.observe(s.current),()=>{w.disconnect()}},[l,T,s]);const M=Yo(0);i.useEffect(()=>{if(!l)return;const w=new ResizeObserver(f=>{Es(f.length===1,"entryList.length === 1");const D=f[0];Es(D.contentBoxSize.length===1,"item.contentBoxSize.length === 1"),M.set(D.contentBoxSize[0].blockSize+16),N(D.contentBoxSize[0].blockSize)});return u.current&&w.observe(u.current),()=>{w.disconnect()}},[l,M,u]);const R=e.jsx(Gt,{className:l?"px-5":"mt-4 self-start",onClick:a,"data-testid":"paragen-prefer-response-button",children:e.jsx(I,{id:"U2EAH6",defaultMessage:"I prefer this response"})}),L=r;return e.jsxs("div",{"data-paragen-root":!0,className:P("relative flex w-full min-w-[min(450px,80vw)] snap-center flex-col gap-1 text-left",c&&l&&"pl-3 pr-5 sm:w-[calc(100cqw-62px)] sm:pl-3 sm:pr-5 md:px-10",!c&&l&&"px-10",l?"min-h-60 py-4":"rounded-2xl border border-token-main-surface-tertiary bg-white p-5 dark:bg-gray-700"),ref:s,children:[e.jsx("div",{className:P("absolute left-0 right-0 top-48 h-px","invisible"),ref:m}),e.jsx("div",{className:P("absolute bottom-0 left-0 right-0 top-48","invisible"),ref:h}),e.jsx("div",{className:P("absolute bottom-0 left-0 right-0 h-px","invisible"),ref:x}),o,l?e.jsx("div",{className:"flex-1"}):null,l?e.jsx("div",{className:"mt-4 min-h-10",children:L?null:e.jsx(oe.div,{style:{translateX:j,width:T,bottom:M},animate:{opacity:100},initial:{opacity:0},transition:{ease:"easeOut",duration:.2,delay:.5},className:P({fixed:B,"z-20 flex w-full justify-center":!0}),children:R})}):n?null:R]})}function Sa(){return e.jsxs("div",{className:"flex w-full flex-col gap-4 pb-5 pt-3",children:[e.jsx(wt,{className:"h-4 w-[75%]"}),e.jsx(wt,{className:"h-4 w-[50%]"}),e.jsx(wt,{className:"h-4 w-[80%]"}),e.jsx(wt,{className:"h-4 w-[55%]"}),e.jsx(wt,{className:"h-4 w-[66%]"}),e.jsx(wt,{className:"h-4 w-[64%]"}),e.jsx(wt,{className:"h-4 w-[48%]"})]})}function Co(){const{layer:t}=ut("3119715334");return t.get("should-enable-hojicha",!1)}const va=we.div`text-sm text-token-text-secondary font-semibold`,ba=we.div`flex gap-4 items-center mb-1`,wt=we.div`animate-pulse rounded-[4px] bg-token-main-surface-tertiary`;function ya({clientThreadId:t,conversationTurnMountTime:s,turn:a,originalTurn:o}){const n=co();if(!n.showParagenMetadata||!n.showDebugConversationTurns&&!n.forceParagen||a==null)return null;let r=a===o?"ORIGINAL":"NEW";const l=a.messages[a.messages.length-1],c=l?.message?.metadata?.__internal;if(c){const{model_id:m,model_definition_slug:h,model_definition_virtual_model_id:x,alternative_model_selection_rule:g,augmented_paragen_prompt_group_id:b,augmented_paragen_prompt_id:k,augmented_paragen_prompt:S}=c;m&&(r+=`
Model ID: ${m}`),h&&(r+=`
Model Slug: ${h}`),x&&(r+=`
Virtual Model ID: ${x}`),g&&(r+=`
Alternative Model Rule: ${g}`),b&&(r+=`
Prompt Group ID: ${b}`),k&&(r+=`
Prompt ID: ${k}`),S&&(r+=`
Prompt: ${S}`)}r+=`
Message ID: ${l.message.id}`;const p=X.getTree(De(t)).getParentPromptNode(a.variantIds[0]),u=p.metadata?.variantsInStreamInfo==null&&p.message.metadata?.paragen_variants_info!=null;return r+=`
User prompt message ID: ${p.message.id}`,r+=`
Is Persisted Paragen? ${u}`,r+=`
Completion Sample Finish Time: ${u?`${s} (persisted)`:Us(a.messages)?.completionSampleFinishTime}`,e.jsx("div",{className:"whitespace-pre-wrap text-sm text-red-500",children:r})}async function ja({params:t}){await us.submitParagenSelectionV2(t)}const wa=Qe({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}"}});function op({handleShowRetrievalResults:t,clientThreadId:s,turnIndex:a,responseComplete:o=!1}){const[n,r]=ae(s,u=>[X.getTurnContentReferences(u,a),Oa(u?.conversationTurns[a]?.messages??[])]),l=i.useMemo(()=>({turnIndex:a,clientThreadId:s,responseComplete:o}),[s,o,a]),c=i.useRef(!1);i.useEffect(()=>{c.current||(c.current=!0,G.logEvent(z.fileSourcesFooterShown,l))},[l]);const d=i.useCallback(()=>{G.logEvent(z.fileSourcesFooterClicked,l),t()},[t,l]),p=i.useMemo(()=>{const u=new Set,m=[];function h(g){!g||u.has(g)||(u.add(g),m.push(g))}if(n.forEach(g=>{g.type==="file"?h(g.cloud_doc_url??g.extra?.cloud_doc_url):g.type==="file_navlist"&&g.items.forEach(b=>{h(b.cloud_doc_url)})}),o){for(const g of r)if(fu(g.message)){const b=xu(g.message.content.result),k=g.message.metadata?.cloud_doc_urls??[],S=b.chunks;for(let v=0;v<S.length;v++){const C=S[v];if(!C.documentId)continue;if(v<k.length){h(k[v]);continue}const _=C.documentId.endsWith("--google")?C.documentId.split("--")[1]:void 0,N=C.metadata.cloud_doc_url??(_?`https://drive.google.com/file/d/${_}`:void 0);h(N?.toString())}break}}const x=[];for(let g=0;g<m.length;g++){const b=m[g],k=Su(b);if(k&&x.push(k.Icon),x.length>=3)break}return x},[r,n,o]);return e.jsxs(e.Fragment,{children:[e.jsx(oe.div,{className:"absolute h-[60px]",initial:{opacity:0},animate:{opacity:1},children:e.jsxs("button",{className:P("not-prose group/footnote mb-2 mt-3 flex w-fit items-center gap-1.5 rounded-xl border border-token-border-light bg-token-main-surface-primary py-2 hover:bg-token-main-surface-secondary","pl-3 pr-2.5"),onClick:d,children:[e.jsx("div",{className:"flex items-center gap-0.5 text-sm font-medium",children:e.jsx(I,{id:"/48IOP",defaultMessage:"Sources"})}),p.length>0&&e.jsx("div",{className:"flex flex-row-reverse gap-1",children:p.reverse().map((u,m)=>e.jsx(oe.div,{className:P("flex items-center overflow-hidden rounded-full border-token-main-surface-primary bg-token-main-surface-primary","group-hover/footnote:border-token-main-surface-secondary","relative"),initial:{opacity:0},animate:{opacity:1},children:e.jsx(u,{className:"icon-md"})},m))})]})}),e.jsx("div",{className:"h-[60px]"})]})}const Ca=[1,2,3,4,10,20,30],ap=.5;function rp({clientThreadId:t,conversationLeafId:s}){const a=yr(jr.isBusinessWorkspace),o=i.useRef(!1),n=ds(t),r=ae(t,M=>M?.mode),{isUnauthenticated:l}=Ve(),c=i.useMemo(()=>{if(!n)return-1;const M=br(n);return M()>ap?-1:Ca[Math.floor(M()*Ca.length)]},[n]),d=il(t,s),p=d[d.length-1],u=i.useMemo(()=>zs.getRequestIdFromConversationTurn(p),[p]),m=Mt(u),[h,x]=i.useState(null),[g,b]=i.useState(!1),[k,S]=i.useState(!1),[v,C]=i.useState(!1),_=M=>{const R=Us(d)?.messages[0]?.message.id;x(M),j(R,M)},N=d.filter(M=>M.role===Ye.Assistant).length,B=p?.role===Ye.Assistant,j=i.useMemo(()=>xr((M,R)=>{n&&M&&us.submitConversationRating({conversation_id:n,message_id:M,rating:R,shown_at_assistant_turn:c}),G.logEvent(z.conversationRatingSubmitted,{rating:R,showAtAssistantTurn:c,conversationId:n}),b(!0),setTimeout(()=>{S(!0)},1500)},2e3),[n,c]),T=N!==c||m||!B||!!a||r?.kind!==Fe.PrimaryAssistant||v||l;return i.useEffect(()=>{!T&&!o.current&&(G.logEvent(z.conversationRatingShown,{showAtAssistantTurn:c,conversationId:n}),o.current=!0)},[T]),v||T?null:e.jsxs("div",{className:"mx-auto",children:[e.jsx(ms,{children:g&&!k&&e.jsx(oe.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(Ma,{$padded:!0,children:e.jsx("span",{className:"text-sm text-token-text-tertiary",children:e.jsx(I,{id:"rating.thanks",defaultMessage:"Thanks for your feedback!"})})})},"submitted")}),!g&&e.jsx(oe.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},children:e.jsxs(Ma,{$padded:!1,children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 px-4 py-3 text-sm text-token-text-secondary",children:[e.jsx(I,{id:"rating.instructions",defaultMessage:"Is this conversation helpful so far?"}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx(kn,{$selected:h==="thumbsUp",onClick:()=>_("thumbsUp"),children:e.jsx(wr,{className:"icon-md"})}),e.jsx(kn,{$selected:h==="thumbsDown",onClick:()=>_("thumbsDown"),children:e.jsx(Cr,{className:"icon-md"})})]})]}),e.jsx("div",{className:"w-px flex-1 self-stretch bg-token-main-surface-tertiary"}),e.jsx(kn,{className:"p-3",$selected:!1,onClick:()=>C(!0),children:e.jsx(ll,{className:"icon-md text-token-text-secondary hover:text-token-text-primary"})})]})},"rating")]})}const kn=we.button`
  ${t=>t.$selected?"text-token-text-primary":"text-token-text-secondary"}
  hover:text-token-text-primary
`,Ma=we.div`inline-flex rounded-xl border border-gray-100 dark:border-gray-700
${t=>t.$padded&&"py-3 px-4"}
`,ip=ze(()=>Ge(()=>import("./jurl5oxctvsj2nxv.js"),__vite__mapDeps([50,2,1,3,4,5,51])));function lp({clientThreadId:t,conversationLeafId:s,canShowInlineMessageFeedback:a,messageForRating:o,allGroupedMessages:n,currentModelId:r}){let l=null;const c=Ua(h=>{const x=X.getConversationTurns(De(t,h),s);let g=0;for(let b=x.length-1;b>=0;b--){const k=x[b];if(k.messages.some(S=>S.message.metadata?.is_indepth_feedback))return!0;if(k.messages.some(S=>S.message.author.role===Ye.Assistant)&&g++,g>=3)break}return!1}),d=ds(t),p=Qs(h=>h.voiceFeedbackThread),u=d===p,{voiceName:m}=vu();return c?null:(u&&d?(cl.feedbackShown.success({voice:m}),l=e.jsx("div",{className:"text-center",children:e.jsx(bu,{serverThreadId:d})})):o.rating&&a?l=e.jsx(ip,{clientThreadId:t,conversationMessage:o,allGroupedMessages:n,currentModelId:r}):l=e.jsx("div",{className:"text-center",children:e.jsx(rp,{clientThreadId:t,conversationLeafId:s})}),e.jsx("div",{className:"mt-3 w-full empty:hidden",children:l}))}const cp=ze(()=>Ge(()=>import("./d421mpn05gtnb19a.js"),__vite__mapDeps([52,2,1,3,53,54,4,5,55,56,57])).then(t=>t.VoicePlayButton)),dp=ze(()=>Ge(()=>import("./jlmk6p9qhmpdfonx.js"),__vite__mapDeps([58,2,4,1,3,5,59,60])).then(t=>t.AutomationSourceHeader)),Ta=80,up=16,ka={minHeight:`calc(100dvh - ${Mr}px - ${Vu}px - 100px)`};function mp(t){const{turnIndex:s,conversationLeafId:a,isFinalTurn:o,clientThreadId:n,onChangeItemInView:r,onChangeRating:l,currentModelId:c,avatarClassName:d,showAvatar:p,scrollToMessageId:u,dateHeaderType:m}=t,h=ge(),x=lo();cs()?.normalizedAccountUserId;const g=!!x&&dl(x),b=qn(),k=yr(jr.isBusinessWorkspace),S=Pa(),{value:v}=qe("2848981774"),{value:C}=qe("1456513860"),_=p??!C,N=null,{value:B}=qe("1887864177"),j=Ke(n),T=Ht(Nn(n,s,a)),{messages:M,variantIds:R,variantsInStreamInfo:L}=T,w=Vs(M),f=yu();let D=M[M.length-1];for(const q of w){const ye=Jm(q);if(ye.some(jt=>f.has(jt.message.id))){D=ye[ye.length-1];break}}const A=M.slice(0,M.indexOf(D)+1),W=!1,Z=Yn(),[E,F]=i.useState(!1),[H,K]=i.useState(!1),Y=R.findIndex(q=>A.some(ye=>ye.nodeId===q)),$=T.role===Ye.User,me=mt(),Ce=Xe(n),Me=Tt(T.gizmoId??Ce)?.data,Ne=Zn(c),We=ju(c),Ee=Je(),[pe,O,U,J,re,ce]=ae(n,q=>{const ye=q?.tree!=null&&R.some(jt=>{const Rt=q.tree.getLeafFromNode(jt);return q.tree.getHasErrorFromNode(Rt.id)});return[q?.async_status===Ba.STREAMING,X.isMessageTurnEnded(q,a),ye,$u(Oa(q?.mode),Me?.gizmo.id),q?.continuingFromSharedConversationId!=null,null]});let ie="default";const Te=!1,Ie=A.some(q=>q.message.content.content_type===Fa.MultimodalText),{layer:Be}=ut("1547743984"),de=j&&Z&&Be.get("show_share_button_inline",!1),{isUnauthenticated:ne}=Ve(),[ue,fe]=i.useState(!1),[ke,Ze]=i.useState(!1),et=T.messages.map(q=>q.message.id),_e=i.useRef(null),le=M[M.length-1],He=le.rating,at=(u?.length??0)>2&&u!=="finalAgentTurn"&&o&&v,he=()=>{A.length===1&&(G.logEvent(z.editPrompt,{id:A[0].message.id,threadId:Ke(n)}),je.logEvent("chatgpt_edit_prompt"),F(!0))},ee=i.useCallback(()=>{F(!1)},[]),$e=i.useCallback(q=>{wu(n,s,S,q)},[n,s,S]),gt=q=>{l({nodeId:le.nodeId,messageId:le.message.id,rating:q}),G.logEvent(q==="thumbsDown"?z.messageFeedbackThumbsDownClicked:z.messageFeedbackThumbsUpClicked,{id:le.message.id,threadId:Ke(n),model:c,rating:q}),K(!0)},[on]=i.useState(()=>Date.now()),an=i.useMemo(()=>zs.getRequestIdFromConversationTurn(T),[T]),xe=Mt(an)&&!O,hs=Xn(),Se=io();let rt=[];o&&!xe&&Se?.messageId&&et.includes(Se?.messageId)&&(rt=Se.suggestions);const kt=B&&rt.length>0,gs=Vs(A),qt=i.useRef(!1),_t=M?M[M.length-1]:void 0,it=Cu(n,_t);i.useEffect(()=>{if(qt.current||u===void 0||!v||!_e.current){u==="finalAgentTurn"&&o&&qt.current&&is.updateScrollToMessageId(n,void 0);return}(et.includes(u)||u==="finalAgentTurn"&&o)&&(qt.current=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(_e.current)if(u==="finalAgentTurn"&&o)_e.current.scrollIntoView({behavior:"instant",block:"end"}),is.updateScrollToMessageId(n,void 0);else{const q=_e.current.offsetHeight;let ye;q>Ta?ye=Ta-q:ye=0,_e.current.style.scrollMarginTop=`${ye+up+Mr}px`,_e.current.scrollIntoView({behavior:"smooth"})}})}))},[u,_e.current]);const{showDebugConversationTurns:Vt}=co(),Re=Mu(n,_t),At=Tu({clientThreadId:n,conversationMode:J}),ps=i.useCallback(({requestedModelId:q,systemMessage:ye,juice:jt,extraStreamParams:Rt})=>{const gn=new Zs;At({id:le.nodeId,eventMetadata:{eventSource:"mouse"},turnTracker:gn,requestedModelId:q,systemMessage:ye,juice:jt,extraStreamParams:Rt})},[le,At]),Nt=Te,$t=!b&&!re&&!me&&!$,rn=ku(),Kt=D.message.author.role===Ye.Assistant?D.message:null;_u({isCompletionRequestInProgress:xe,isUserTurn:$,message:Kt});const{isOpen:Yt}=Au(),Et=tr(),pt=Nu(J),Jt=!rn&&!pt&&$t&&o&&L?.num_variants_in_stream===2&&!le.inlineComparisonRating&&!U,lt=Eu(T),ft=Jt,ln=Jt&&!lt,xt=!$&&!b&&!re&&!pt&&!pe&&!xe&&!Yt&&N==null,St=xt&&(!k||Nt||We||g)&&!pt&&!ne&&!me&&!_t?.message.metadata?.b1de6e2_s,It=!b&&!((xe||pe)&&o)&&R.length>1&&!E&&!ft&&N==null;let Xt=!1;if($&&A.length===1){const{shouldHideContent:q}=Iu(A[0]);q&&(Xt=!0)}const Qt=$&&!pt&&!b&&!Ie&&A.length===1&&!Xt&&!E&&!ne&&N==null,Zt=q=>{r(R[q]),G.logEvent(z.changeNode,{intent:"toggle_between"})},fs=Ru(T,A,Vt),{toggleThreadSidebar:vt}=ul(),be=i.useMemo(()=>T.messages.length?T.messages[T.messages.length-1].nodeId:void 0,[T.messages]),xs=i.useCallback(()=>{be&&vt({type:"retrievalResults",clientThreadId:n,turnIndex:s,messageId:be})},[be,vt,n,s]),{value:bt}=qe("2912660649"),cn=i.useMemo(()=>bt&&Pu(T,Ne,!!Ce),[bt,Ne,Ce,T]);if(!fs&&!ft)return at?e.jsx("div",{style:ka}):null;const Ss=A.some(({message:q})=>ml.getAssetPointers(q).length>0)?null:e.jsx(Qg,{className:"h-[30px] rounded-md px-1 text-token-text-secondary hover:bg-token-main-surface-secondary",clientThreadId:n,message:le,onModelSelect:ps,onDropdownChange:fe,canRegenerateResponse:Re}),vs=!$&&!Xt&&(!o||!xe)?e.jsx(Ku,{onClick:$e}):null,dn=!$&&(!o||!xe)&&(le.disclaimers??[]).length===0&&le.nodeId?e.jsx(cp,{conversationId:n,message:le,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-xs text-token-text-tertiary hover:text-token-text-primary"}):null,un=!$&&le&&(!o||!xe)?e.jsx(Yu,{message:le,isFinalTurn:o,iconClassName:"icon-md",className:"gap-1.5 rounded-md p-1 text-token-text-tertiary hover:text-token-text-primary"}):null,yt=it&&e.jsx(Ju,{turn:T}),bs=St&&!xe?e.jsxs("div",{className:"flex",children:[He!=="thumbsDown"&&e.jsx(wn,{onClick:()=>gt("thumbsUp"),disabled:He==="thumbsUp",icon:He==="thumbsUp"?Du:wr,label:h.formatMessage({id:"ConversationTurn.goodResponseTooltip",defaultMessage:"Good response"}),testId:"good-response-turn-action-button"},`thumbsUp:${le.nodeId}`),He!=="thumbsUp"&&e.jsx(wn,{onClick:()=>gt("thumbsDown"),disabled:He==="thumbsDown",icon:He==="thumbsDown"?Bu:Cr,label:h.formatMessage({id:"ConversationTurn.badResponseTooltip",defaultMessage:"Bad response"}),testId:"bad-response-turn-action-button"},`thumbsDown:${le.nodeId}`)]}):null,mn=de&&e.jsx(wn,{onClick:()=>{Ws.openSharingModal(j)},label:h.formatMessage({id:"ConversationTurn.shareButtonTooltip",defaultMessage:"Share conversation"}),className:"sm:hidden",icon:Hu});function hn(q){return Ee?q:e.jsx(uo,{clientThreadId:n,isStaticSharedThread:b,verticalPadding:ie,horizontalPadding:ft?"none":_?"standard":"expanded",children:q})}function es(q){return Ee?q:e.jsx(qs,{children:q})}return e.jsxs(e.Fragment,{children:[e.jsx(Lu,{dateHeaderType:m,turn:T}),e.jsxs("article",{className:P("w-full text-token-text-primary focus-visible:outline-2 focus-visible:outline-offset-[-4px]",u==="finalAgentTurn"&&v?"opacity-0":""),style:at?ka:void 0,ref:_e,dir:"auto","data-testid":`conversation-turn-${s}`,"data-scroll-anchor":o,onMouseEnter:()=>Ze(!0),onMouseLeave:()=>Ze(!1),children:[e.jsx(Fu,{role:T.role}),hn(e.jsx(e.Fragment,{children:ft?e.jsx(tp,{isFeedbackEnabled:St,variantIds:R,variantsInStreamInfo:L,conversationTurnMountTime:on,stubSideBySideFeedback:ln,...t}):es(e.jsxs(e.Fragment,{children:[W,!$&&!W&&_&&e.jsx(gp,{children:e.jsx(Hn,{messages:A,isUserTurn:$,avatarClassName:d,gizmo:Me})}),e.jsx("div",{className:P("group/conversation-turn relative flex w-full min-w-0 flex-col",!$&&Ou),children:e.jsx("div",{className:"flex-col gap-1 md:gap-3",children:e.jsxs(e.Fragment,{children:[null,!$&&!b&&e.jsx(Uu,{messages:A,clientThreadId:n,gizmoId:Me?.gizmo.id}),Et&&!$&&e.jsx(dp,{clientThreadId:n,messages:A}),e.jsx(Fn,{groupedMessagesToRender:gs,allGroupedMessages:w,...t,isEditing:E,isUserTurn:$,isCompletionRequestInProgress:xe,isFeedbackEnabled:St,isFinalTurn:o,hasActiveRequest:hs,showEditButton:Qt,handleEnterEdit:he,handleExitEdit:ee}),Ne&&!bt&&e.jsx("div",{className:"mb-4",children:e.jsx(zu,{messages:A})}),cn&&e.jsx(op,{handleShowRetrievalResults:xs,clientThreadId:n,turnIndex:s,responseComplete:!(xe||pe)}),(xt||It)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:P("mb-2 flex gap-3 empty:hidden",$?"mr-1 flex-row-reverse":"-ml-2"),children:e.jsx(Gu,{alwaysShow:o,showInline:o||It,isHovered:ke||ue,pagination:It&&e.jsx(Wu,{showInline:o||It,currentPage:Y,onChangeIndex:Zt,length:R.length,className:P("self-center",R.length>1?"visible":"!invisible")}),actions:xt&&e.jsxs(e.Fragment,{children:[dn,vs,bs,yt,un,mn,Ss]})})}),xt&&!xe?e.jsx("div",{className:"pr-2 lg:pr-0",children:e.jsx(qu,{message:le,isFinalTurn:o})}):null,o&&!xe&&e.jsxs(e.Fragment,{children:[e.jsx(lp,{canShowInlineMessageFeedback:H,clientThreadId:n,conversationLeafId:a,messageForRating:le,allGroupedMessages:w,currentModelId:c}),kt&&e.jsx(Zg,{followups:rt})]})]})]})})})]}))}))]})]})}const hp=Qn.memo(mp),gp=we.div`flex-shrink-0 flex flex-col relative items-end`;function pp({onChangeItemInView:t,onRequestMoreCompletions:s,onChangeRating:a,onRequestCompletion:o,clientThreadId:n,conversationLeafId:r,hideHeader:l}){const[c,d,p,u,m]=ae(n,E=>[E?.mode,X.getConversationTurns(E,r).length,X.getThreadData(E).isArchived,E?.conversationOrigin===hl.APPLE,E?.scrollToMessageId]),h=Ae(),x=Jn(),g=Xu(),[b]=Qu(),k=Zu(),[S]=em(),v=cs(),C=Xs(n),_=h.store.useContentAreaDimensions(Ut.Header,E=>E?.height?E.height:void 0),N=h.store.useIsHeaderContentAreaPopulated(),B=tm(C.id),j=c?.kind===Fe.GizmoMagicCreate?"bg-token-main-surface-primary text-token-text-primary":B,T=ir(),[M,R]=i.useState(0),[L,w]=i.useState(!1);i.useEffect(()=>{x&&(M===0?R(d):!L&&d>M&&(w(!0),je.logEvent("chatgpt_continue_conversation_first_message_sent"),G.logEvent(z.continueConversationFirstMessageSent)))},[d,M,L,x]),i.useEffect(()=>{x&&(je.logEvent("chatgpt_continue_conversation_page_loaded"),G.logEvent(z.continueConversationPageLoaded),je.logEvent("chatgpt_conversation_share_page_loaded"),G.logEvent(z.sharedConversationPageLoaded))},[x]);const f=i.useCallback(()=>{g({behavior:"smooth"})},[g]),D=sm(n),A=T&&!p,W=nm(n,r),Z=(E,F,H,K)=>[...new Array(F-E).keys()].map(Y=>{const $=Y+E;return e.jsx(hp,{isFinalTurn:H($),turnIndex:$,clientThreadId:n,conversationLeafId:r,onChangeItemInView:t,onChangeRating:a,onRequestMoreCompletions:s,onRequestCompletion:o,currentModelId:C.id,avatarClassName:j,scrollToBottom:f,scrollToMessageId:K,dateHeaderType:W($)},$)});return e.jsxs("div",{onCopy:D,className:P("flex flex-col text-sm",A&&"pb-[120px]",_||A?null:"md:pb-9"),style:{paddingBottom:A?void 0:_},children:[!l&&v?.data&&e.jsx(Ir,{clientThreadId:n}),x&&e.jsxs(e.Fragment,{children:[e.jsx(qs,{children:e.jsx("p",{className:"text-xs text-gray-500",children:e.jsx(I,{id:"threadLayout.sharedConversationCopyDisclaimer",defaultMessage:"This is a copy of a conversation between ChatGPT & Anonymous."})})}),d-M===0&&e.jsx("div",{className:"text-center text-xs font-semibold text-token-text-primary",children:e.jsx("button",{onClick:()=>{Ws.openModal(om.ReportConversation),je.logEvent("chatgpt_conversation_share_report_content_clicked",null,{location:"Static Shared Thread Page"}),G.logEvent(z.sharedConversationReportContentClicked,{location:"Dynamic Shared Thread Page"})},children:e.jsx(I,{id:"thread.reportSharedConversation",defaultMessage:"Report content"})})}),Z(0,M,E=>E===M-1,m),e.jsx(qs,{children:e.jsxs("p",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(am,{className:"icon-xs mr-2"}),e.jsx(I,{id:"threadLayout.sharedConversationPrivateDisclaimer",defaultMessage:"Messages beyond this point are only visible to you"})]})}),Z(M,d,E=>E===d-1,m)]}),!x&&Z(0,d,E=>E===d-1,m),u&&b&&!S&&e.jsx(_a,{className:P("translate-y-[10px] md:translate-y-[30px]"),onClick:()=>{je.logEvent("chatgpt_thread_scroll_to_top"),k({behavior:"smooth"})},children:e.jsx(rm,{className:"icon-md text-token-text-primary"})}),!b&&e.jsx(_a,{className:P(_?null:"bottom-5",A?N?"translate-y-[-50px]":"translate-y-[-10px]":""),style:{bottom:T?"calc(var(--composer-bar_footer-current-height) + var(--composer-bar_current-height))":_},onClick:()=>{je.logEvent("chatgpt_thread_scroll_to_bottom"),g({behavior:"smooth"})},children:e.jsx(im,{className:"icon-md text-token-text-primary"})})]})}const _a=we.button`cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-token-text-secondary border-token-border-light right-1/2 translate-x-1/2 bg-token-main-surface-primary w-8 h-8 flex items-center justify-center`,fp=60,xp=({children:t,scrollViewClassName:s,scrollAnchorTopOffset:a=0})=>{const o=i.useRef(null);return e.jsx("div",{className:"h-full",ref:o,children:e.jsx(za,{children:e.jsx(Ym,{className:"h-full",followButtonClassName:"hidden",initialScrollBehavior:"auto",scrollViewClassName:s,scroller:()=>Sp(o,a)?0:1/0,children:t})})})},Sp=(t,s)=>{const a=vp(t.current);if(a==null)return!1;const o=a>s,n=a<s-fp;return!o&&!n};function vp(t){if(!t)return null;const s=t.querySelector('[data-scroll-anchor="true"]');if(!s)return null;const a=s.getBoundingClientRect().top,o=t.getBoundingClientRect().top;return a-o}const bp=ze(()=>Ge(()=>import("./h8hyik3us1m1le9o.js"),__vite__mapDeps([61,1,2,3,4,5,14,62,63,64,65,55,66])).then(t=>t.OpenDebugSidebarButton)),yp=ze(()=>Ge(()=>import("./l3gci7wa2aa2b3gn.js"),__vite__mapDeps([67,2,4,1,3,5]))),Aa=Qe({doNotShareSensitive:{id:"thread.modal.onboarding.title",defaultMessage:"Do not share sensitive materials with this application"},somethingWentWrong:{id:"thread.modal.unrecoverableError.title",defaultMessage:"Something went wrong"},tryAgainLater:{id:"thread.modal.unrecoverableError.description",defaultMessage:"We're sorry, but something went wrong. Please try again later."},resetThread:{id:"thread.modal.unrecoverableError.resetThread",defaultMessage:"Reset thread"},sharedConversationReportConversation:{id:"thread.sharedConversation.report",defaultMessage:"Report conversation"},latencyButton:{id:"thread.latencyButton",defaultMessage:"Latency"},archivedConversationDescription:{id:"thread.archivedConversationDescription",defaultMessage:"This conversation is archived. To continue, please unarchive it first."},unarchiveButton:{id:"thread.unarchiveButton",defaultMessage:"Unarchive"}});function jp({clientThreadId:t}){const s=Wa(),a=ds(t),o=ae(t,X.getGizmoId),n=async()=>{a&&(await us.patchConversation(a,{is_archived:!1}),s.invalidateQueries({queryKey:["conversation",t]}),Ua.setState(r=>{const l=r.threads[a];l!=null&&(l.initialThreadData.isArchived=!1)}),Mm(s,o))};return e.jsxs("div",{className:"my-6 flex flex-col items-center justify-center gap-4",children:[e.jsx("div",{className:"px-3 text-center text-sm text-token-text-secondary",children:e.jsx(I,{...Aa.archivedConversationDescription})}),e.jsx("div",{children:e.jsx(Gt,{disabled:!a,onClick:n,icon:jm,children:e.jsx(I,{...Aa.unarchiveButton})})})]})}const wp=function({clientThreadId:t,onCreate:s,preRequestCompletion:a,hideHeader:o,hideMessages:n,hideFooter:r,hideToolsOverlay:l,messagesVerticalAlign:c="top",prependThreadChildren:d,renderEmptyState:p,prefetchSearch:u}){const m=Da(),{data:h}=$s(),{data:x}=ht(),g=Js(t),b=La(),[k,S,v,C,_,N,B]=ae(t,de=>[de?.isLoading,X.getCurrentLeafId(de),X.hasUserMessage(de),de?.conversationTurns.length??0,X.getThreadData(de).isArchived,de?.modelId,de?X.getGizmoId(de):b]);gl(t),i.useEffect(()=>{k||(Lt(t)?An.addTiming("chatgpt.web.chatPage.renderNewConversation"):An.addTiming("chatgpt.web.chatPage.renderExistingConversation"))},[t,k]);const{setTargetedContent:j}=gr(),T=m?.includes(pl),{value:M}=qe("2848981774"),R=lm(),L=C>=2;mr(L);const w=Lt(t)&&!L&&Hs(g),f=Lt(t)&&!v&&(Hs(g)||g?.kind===Fe.GizmoTest),A=hr(h,x).id,W=N??A,Z=!!N,E=Zn(W),F=Gs(x?.models,W),H=cm(t,g),K=ur();dm(C,t),i.useEffect(()=>{K||j(void 0)},[t,j,K,S]);const{caModal:Y,onRequestCompletion:$,onChangeItemInView:me,onChangeRating:Ce,onRequestMoreCompletions:Me}=Km({clientThreadId:t,currentModelId:W,defaultModelId:A,onThreadCreated:s,preRequestCompletion:a}),Ne=um({clientThreadId:t,handleRequestCompletion:$,prefetchSearchPromise:u}),We=de=>M?e.jsx(za,{children:e.jsxs(i.Suspense,{fallback:null,children:[e.jsx(wm,{}),e.jsx("div",{className:"flex h-full flex-col overflow-y-auto",children:de})]})}):e.jsx(xp,{scrollAnchorTopOffset:o?0:Cm,children:c==="bottom"?e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"flex-1"}),de]}):de});i.useEffect(()=>{document.title=H??"ChatGPT"},[H]);const Ee=mt(),pe=Ra(),O=f&&!pe&&!p&&!B&&!E&&!Ee,U=Jn(),J=mm(),{reset:re,streamingContext:ce,StreamingProvider:ie}=hm();i.useEffect(()=>{J&&(ce.setOnResetContext=()=>{re()})},[J,re,ce]);const Te=i.useRef(null),Ie=i.useRef(null),Be=i.useMemo(()=>({threadContentScrollContainerElementRef:Te,footerRootContainerElementRef:Ie}),[]);return e.jsx(Im,{clientThreadId:t,children:e.jsxs(ie,{value:ce,children:[T&&e.jsx(yp,{}),e.jsx(gm,{children:H!=null&&e.jsx("title",{children:H})}),e.jsx(fl.Provider,{value:$,children:e.jsxs(pm,{children:[e.jsxs(fm,{noKeyboard:!0,clientThreadId:t,currentModelConfig:F,className:"composer-parent flex h-full flex-col focus-visible:outline-0",children:[!n&&e.jsx(xm,{value:Be,children:e.jsx(Cp,{ref:Te,children:!k&&!Ne?f?p??e.jsx($g,{clientThreadId:t,currentModelId:W,isModelLoaded:Z,onRequestCompletion:$,showChatgptHomepage:O,chatgptHomepageDisclaimer:O&&e.jsx(oa,{clientThreadId:t})}):L?We(e.jsxs(e.Fragment,{children:[d,e.jsx(pp,{onChangeItemInView:me,onRequestMoreCompletions:Me,onChangeRating:Ce,onRequestCompletion:$,clientThreadId:t,conversationLeafId:S,hideHeader:o},t)]})):null:null})}),e.jsx(Mp,{ref:Ie,children:_?e.jsx(jp,{clientThreadId:t}):e.jsxs("div",{children:[!O&&e.jsx(Ag,{clientThreadId:t,isNewThread:w,showPromptStarters:w||!v,currentModelId:W,onRequestCompletion:$}),!r&&e.jsx("div",{className:"relative w-full px-2 py-2 text-center text-xs text-token-text-secondary empty:hidden md:px-[60px]",children:Hs(g)&&!O&&e.jsx("div",{className:"min-h-4",children:e.jsx(oa,{clientThreadId:t})})})]})})]}),!l&&e.jsxs("div",{className:"group absolute bottom-2 end-2 z-20 flex flex-col gap-1 md:flex lg:bottom-3 lg:end-3",children:[R?e.jsxs(e.Fragment,{children:[e.jsx(bp,{}),!1]}):null,e.jsx(Sm,{})]}),Y,e.jsx(vm,{clientThreadId:t,isStaticSharedThread:!1,isDynamicSharedThread:U}),e.jsx(bm,{}),e.jsx(ym,{conversationId:t,isActiveWindow:!pe})]})})]})})},Dp=Qn.memo(wp),Cp=we.div`grow flex-1 overflow-hidden @container/thread`,Mp=we.div`md:pt-0 dark:border-white/20 md:border-transparent md:dark:border-transparent w-full`;export{hp as C,$g as E,Dp as M,zr as P,Pg as S,lh as T,xp as W,Ir as a,Ag as b,dh as c,Pp as d,Er as u};
//# sourceMappingURL=ism5ltuyfnnx8n4w.js.map
