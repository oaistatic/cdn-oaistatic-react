const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/iyoviv398ljqf1ew.js","assets/n26mv7rx7nquqst2.js","assets/n1tvutderx19k1zs.js","assets/root-osq5e7fb.css","assets/pceg3mlzf8dzw9ob.js","assets/conversation-small-nranh1cg.css","assets/egjj718ybwa4lzxd.js","assets/hexva2s1lo90zidg.js","assets/l4c41pejol0bhhf7.js","assets/fudxsr1s5wqk63ki.js","assets/m3i9t52w2bjqxoks.js","assets/duvx3jmzsju7uw87.js","assets/ch48ne0b8201ps9r.js","assets/nxz31zqr36vgy6hm.js","assets/lvedelvd2wa5y0ah.js"])))=>i.map(i=>d[i]);
import{bs as pe,bt as ve,b9 as Se,fH as Ce,B as Ee,fI as $,ag as E,S as O,P as y,a as b,bJ as ye,aL as be,d$ as xe,au as B,U as Te,s as Ne,ar as Re,aj as c,ak as w,dl as _e,d as D,H as Ae,aR as we,ap as De}from"./n26mv7rx7nquqst2.js";import{c as Z,r as o,a as W,e as Ie,j as t,L as F}from"./n1tvutderx19k1zs.js";import{ae as je,af as ke,ag as M,ac as K,ah as Oe,ai as Me,aj as ze,ak as ee,al as Le,am as Pe,an as He,ao as Ge,ap as X,aq as Ue,ar as qe,as as Ve,at as Q,au as Be,av as Fe,aw as Ke,ax as Xe,ay as J,az as Qe,aA as Je,aB as Ye,aC as $e}from"./pceg3mlzf8dzw9ob.js";import{G as te}from"./egjj718ybwa4lzxd.js";const Ze=pe(()=>ve(()=>import("./iyoviv398ljqf1ew.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14])).then(e=>e.GizmoConversationOptionsDropdown)),We=new Date(2024,9,11,0);function Y(e){O.checkGate("3922476776")||we.abortAllRequests(),y.logEvent(b.loadThread,{threadId:e})}function et({conversation:e,conversationTitle:d,onOpenChange:m,testId:a,inMainScreen:n=!1}){const i=Z(),{isUnauthenticated:h}=Se(),{eligible:p,markAsViewed:x}=je(ke.ArchiveConversationOnboarding),u=Ce(e.id),[v,T]=o.useState(!1);o.useState(!1);const l=W(),g=Ie(),S=Ee();if(o.useEffect(()=>$(te,{deleteChat:({serverThreadId:r})=>{r===e.id&&T(!0)},archiveChat:async({serverThreadId:r})=>{r===e.id&&(await E.patchConversation(e.id,{is_archived:!0}),M(l,e.gizmo_id),O.logEvent("chatgpt_conversation_archived"),y.logEvent(b.conversationArchived),p&&(S.info(i.formatMessage({defaultMessage:"You can view archived chats in Settings",id:"HistoryGizmoItem.archiveChatOnboarding"}),{duration:10,hasCloseButton:!0}),x()),u&&K(g))}}),[g,S,l,p,e.id,e.gizmo_id,i,u,x]),h)return null;const N=t.jsx(Ze,{conversation:e,onOpenChange:m,inMainScreen:n,children:t.jsx("button",{className:"flex items-center justify-center text-token-text-secondary transition hover:text-token-text-primary radix-state-open:text-token-text-secondary","data-testid":a,"aria-label":i.formatMessage({id:"idEcXk",defaultMessage:"Open conversation options"}),children:t.jsx(Oe,{className:"icon-md"})})});return t.jsxs(t.Fragment,{children:[t.jsx(ye,{label:i.formatMessage({id:"tJPHEQ",defaultMessage:"Options"}),sideOffset:4,side:"top",children:N}),!1,v&&t.jsx(Me,{title:d,handleDelete:()=>{E.patchConversation(e.id,{is_visible:!1}).then(()=>{M(l,e.gizmo_id),O.logEvent("chatgpt_conversation_deleted"),y.logEvent(b.conversationDeleted),be.publish({kind:"deleteConversation",serverThreadId:e.id})}),u&&K(g)},onClose:()=>{T(!1)}})]})}const se=5,tt=3e3;function st({threadId:e}){const d=W(),m=o.useRef(!1),a=o.useRef(null);return o.useEffect(()=>{async function n(){m.current=!0;const i=await $e(e);if(i.async_status===c.UNREAD){M(d,i.gizmo_id),De.initThreadFromServerData(e,i,!0,void 0,!0);return}if(i.async_status!==c.STREAMING)return;const h=i.update_time??0;ee(new Date,new Date(h*1e3))<se?a.current=window.setTimeout(n,tt):E.setConversationStatus(e)}return m.current||(y.logEvent(b.conversationPollingStarted),n()),()=>{a.current&&window.clearTimeout(a.current)}},[d,e]),null}function rt({conversation:e,className:d,hideOverflowMenu:m=!1,isActiveInMainWindow:a,isActive:n,elementRef:i,testId:h}){const p=Z(),[x,u]=o.useState(!1),[v,T]=o.useState(!1),[l,g]=o.useState(!1),S=xe(),{value:N}=B("3922476776"),{value:r}=B("232791851"),ae=ze(e.id),{value:f=null,source:R=null}=ae??{},oe=Te(e.id,Ne.getRequestId),C=Re(oe),z=ee(new Date,new Date(e.update_time??0))<se,L=Le(e.id),ne=e.update_time&&Pe(new Date(e.update_time),We),P=f===c.STREAMING&&z,ie=r&&!n&&!C&&ne&&!l&&f===c.UNREAD,H=r&&(C||P)&&!l,re=r&&!a&&L.length>0&&!l,le=r&&!a&&(C||P),ce=r&&f===c.STREAMING&&R===w.SERVER&&!C&&z,I=o.useRef(!1);o.useEffect(()=>{I.current||N&&(async()=>(I.current=!0,n&&f===c.UNREAD&&(R===w.SERVER&&await E.setConversationStatus(e.id),J(e.id,null)),!n&&R===w.CLIENT&&f===c.UNREAD&&(await E.setConversationStatus(e.id,f),J(e.id,{value:c.UNREAD,source:w.SERVER})),I.current=!1))()},[N,n,e.id,f,R,C]),o.useEffect(()=>$(te,{editTitle:({serverThreadId:s})=>{(s?s===e.id:a)&&u(!0)}}),[e.id,a]);const j=p.formatMessage({id:"mpXAeu",defaultMessage:"New chat"}),{resolvedTitle:_,isTypingEffect:de}=He(e.id,e.title,n),ue=_e(),fe=de&&n&&ue,{data:me}=Ge(),G=e.conversation_template_id!=null?me?.gizmos.find(s=>s.resource.gizmo.id===e.conversation_template_id)?.resource:void 0,U=o.useRef(null),ge=t.jsx("div",{className:D("absolute bottom-0 top-0 inline-flex items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",a||v?"flex":"invisible can-hover:group-hover:visible"),ref:U,children:t.jsx(et,{conversation:e,conversationTitle:_??e.title,onOpenChange:s=>{T(s),s&&y.logEvent(b.conversationHistoryItemOpenMenu,{conversationId:e.id})},testId:`${h}-options`})}),q=S?Qe:Je,he=(a||v)&&Ye,V=o.useRef(null);return t.jsxs("div",{draggable:X(e.gizmo_id),onDragStart:s=>{if(!X(e.gizmo_id))return;const k=Ae(V.current),A=U.current;A&&(A.style.display="none"),s.dataTransfer.setDragImage(k,k.clientWidth/3,k.clientHeight/2),A&&requestAnimationFrame(()=>{A.style.display=""}),s.dataTransfer.effectAllowed="move",Ue({kind:"conversation",conversation:e,gizmoId:e.gizmo_id})},onDragEnd:()=>{qe()},ref:V,style:{"--item-background-color":Ve(l,n,v)},className:D(q,"relative screen-arch:bg-transparent",d),onMouseEnter:()=>{g(!0)},onMouseLeave:()=>{g(!1)},children:[S&&t.jsx("div",{className:D(q,he,"pointer-events-none absolute inset-0 group-hover:bg-transparent motion-safe:group-active:scale-[98%] motion-safe:group-active:transition-transform motion-safe:group-active:duration-100")}),ce&&t.jsx(st,{threadId:e.id}),t.jsx(F,{to:Q(e.id,G),onClick:s=>{s.metaKey||s.ctrlKey||a||Y(e.id)},onDoubleClick:()=>{u(!0)},ref:i,className:"flex items-center gap-2 p-2 screen-arch:motion-safe:group-active:scale-[98%] screen-arch:motion-safe:group-active:transition-transform screen-arch:motion-safe:group-active:duration-100",style:{maskImage:"var(--sidebar-mask)"},children:t.jsx("div",{className:D("relative grow overflow-hidden whitespace-nowrap",le&&!H&&"loading-shimmer"),dir:"auto",title:_??j,children:fe?t.jsx(Be,{text:_||j}):_||j})}),x?t.jsx("div",{className:"absolute bottom-0 left-[7px] right-2 top-0 flex items-center bg-token-sidebar-surface-secondary",children:t.jsx(Fe,{conversation:e,onClose:()=>{u(!1)}})}):ie?t.jsx(F,{to:Q(e.id,G),onClick:s=>{s.metaKey||s.ctrlKey||a||Y(e.id)},children:t.jsx("div",{className:"absolute bottom-0 top-0 flex items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",children:t.jsx("div",{className:"h-2 w-2 rounded-full bg-blue-selection"})})}):re?t.jsx("div",{className:"absolute bottom-0 top-0 flex items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",children:t.jsx(Ke,{task:L[0]})}):H?t.jsx("div",{className:"absolute bottom-0 top-0 flex items-center gap-1.5 pr-2 ltr:right-0 rtl:left-0",children:t.jsx(Xe,{size:16,className:"text-token-text-primary"})}):!m&&ge]})}export{et as G,rt as H};
//# sourceMappingURL=lt8myo97bxkt0gi4.js.map
