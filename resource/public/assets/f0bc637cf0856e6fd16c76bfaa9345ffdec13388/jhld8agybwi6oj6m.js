import{C as B,dK as Y,qv as O,z as _,S as H,B as C,b2 as U,cd as p,dO as V,am as F,m7 as W}from"./lgw4q0e8zlqqfgug.js";import{f as R,r as d,j as e,d as N,M as y,a as E,J as ee,b as se,P as ae}from"./m60bpb0x3x7rg8fj.js";import{a as te,b as oe,c as ne,u as le}from"./lx0y091m5xst5og4.js";import{e as re,M as D}from"./60osdyqxxtb3t72f.js";import{u as z,a as ie,b as I,c as de,d as ce,e as me}from"./m4wtp6x2hm4t62ik.js";import{aS as n,jO as ue,bL as ge,kB as Z,aT as $,bz as xe,i8 as fe,i0 as pe}from"./ggjzadbnd3k1vu0k.js";import{G as Q}from"./1fv6oil4uoc66eui.js";import{R as he,i as T,U as je}from"./cfl0pnluz70a5jd2.js";import{T as Me,a as ve}from"./b2lwi6is3nazvxrr.js";import{d as L}from"./l1ka89a9nbqv3utj.js";import"./hbir13mtq07o9x1a.js";import"./o53bheyqocotqvus.js";import"./l9bupap4fyh5egbo.js";import"./dgb06x9f8z6d0ar9.js";import"./gohr301ka7cpfe4s.js";import"./jobqnbdildqzowzf.js";import"./ls4akj6tri7bc2dz.js";import"./glu06a3y5u0laqff.js";import"./iayy5u2a26jybmdr.js";import"./n5yj38pa2aamrsfp.js";import"./rx5cs0ja7c7phupc.js";import"./dfbgvqz3f2t2gfhn.js";import"./hzuwclo1fy1q03ik.js";import"./hb68k3oakb3tiftg.js";import"./nn6a4342otoakkr2.js";import"./h81zqbvh0a7amk0o.js";import"./jh57htegso1fdrwn.js";import"./kh7rmh4dpsh5j6sg.js";import"./lff9oru7r5vtmz06.js";import"./c2ydsdl029zi541a.js";import"./lndsi22cv7zqsitq.js";import"./etw953p5af9bs5n2.js";const be=({onClose:s,workspaceId:t,roleId:a})=>{const l=R(),[i,o]=d.useState(""),[m,u]=d.useState(0),{groups:r,isLoading:M,isPlaceholderData:h}=re({workspaceId:t,currPage:m,groupFilter:i}),{data:v}=z({workspaceId:t,roleId:a}),{assignGroup:g}=ie({workspaceId:t,roleId:a}),{unassignGroup:b}=I({workspaceId:t,roleId:a});return e.jsxs(B,{testId:"modal-role-assignment-modal",isOpen:!0,onClose:s,showCloseButton:!0,size:"large",type:"success",title:l.formatMessage(c.title),primaryButton:e.jsx(C,{onClick:()=>s(),children:l.formatMessage(c.done)}),secondaryButton:e.jsx(C,{color:"secondary",onClick:()=>s(),children:l.formatMessage(c.cancel)}),children:[e.jsxs("div",{className:"bg-token-bg-tertiary text-token-text-primary flex w-full flex-row items-center gap-4 rounded-xl p-4",children:[e.jsx(Y,{className:"icon-lg"}),e.jsx("div",{className:"text-token-text-secondary text-sm font-medium",children:l.formatMessage(c.information)})]}),e.jsx(O,{className:"mt-6 mb-6",inputClassName:"w-full",placeholder:l.formatMessage(c.searchPlaceholder),value:i,onChange:x=>o(x.target.value)}),e.jsxs("div",{className:"min-h-[18rem]",children:[e.jsxs(n.Root,{className:"min-w-full",children:[e.jsxs("colgroup",{children:[e.jsx("col",{className:"w-[80%]"}),e.jsx("col",{className:"w-[20%]"})]}),e.jsx(n.Body,{className:_((M||h)&&"opacity-50"),children:r==null?e.jsx(n.Row,{children:e.jsx(n.Cell,{colSpan:5,textAlign:"center",children:e.jsx(H,{})})}):r.items.length===0?e.jsx(n.Row,{children:e.jsx(n.Cell,{colSpan:5,textAlign:"center",children:i===""?l.formatMessage(c.noGroupFound):l.formatMessage(c.noGroupFoundWithFilter)})}):r.items.map(x=>e.jsx(Ce,{group:x,assignedGroups:v||[],onAssign:()=>g(x),onUnassign:()=>b(x.id)},x.id))})]}),r&&e.jsx("div",{className:"text-center",children:e.jsx(ue,{length:Math.ceil(r.total/D),currentPage:Math.min(m,Math.ceil(r.total/D)),onChangeIndex:x=>u(x)})})]})]})},Ce=({group:s,assignedGroups:t,onAssign:a,onUnassign:l})=>{const[i,o]=d.useState(!1),m=U(),u=R(),r=async()=>{o(!0);try{await a(),m.success(u.formatMessage(c.addSuccess),{duration:2})}catch{m.danger(c.addFailure,{duration:2,toastId:"role_assignment_modal"})}finally{o(!1)}},M=async()=>{o(!0);try{await l(),m.success(u.formatMessage(c.removedSuccess),{duration:2})}catch{m.danger(c.removeFailure,{duration:2,toastId:"role_assignment_modal"})}finally{o(!1)}};return e.jsxs(n.Row,{className:"[&>td]:py-2",children:[e.jsxs(n.Cell,{children:[e.jsx(Q,{group:s}),e.jsxs("div",{children:[e.jsx("div",{children:s.name}),e.jsx("div",{className:"text-token-text-secondary text-xs",children:e.jsx(y,{id:"15cHOa",defaultMessage:"{count} members",values:{count:s.num_members}})})]})]}),e.jsx(n.Cell,{className:"flex items-center justify-end",children:t.some(h=>h.id===s.id)?e.jsx(C,{color:"primary",icon:ge,onClick:M,loading:i,children:u.formatMessage(c.added)}):e.jsx(C,{color:"secondary",icon:Z,onClick:r,loading:i,children:u.formatMessage(c.add)})})]})},c=N({add:{id:"yso/RZ",defaultMessage:"Add"},added:{id:"O2kZcD",defaultMessage:"Added"},addSuccess:{id:"lQy6C+",defaultMessage:"Role has been successfully assigned to group."},removedSuccess:{id:"lINrRq",defaultMessage:"Role has been successfully removed from group."},addFailure:{id:"VoUYt8",defaultMessage:"Failed to assign role to group."},removeFailure:{id:"Q+GN8A",defaultMessage:"Failed to remove role from group."},noGroupFound:{id:"dE7Tu5",defaultMessage:"No groups found."},noGroupFoundWithFilter:{id:"OA7F5f",defaultMessage:"No groups found. Try changing the search query."},searchPlaceholder:{id:"sUDB3M",defaultMessage:"Search by name"},title:{id:"Rj8nZG",defaultMessage:"Assign groups to role"},information:{id:"J92l5s",defaultMessage:"Custom role permissions will override default permissions."},cancel:{id:"QykMkt",defaultMessage:"Cancel"},done:{id:"Zsm046",defaultMessage:"Done"}}),ye=({workspaceId:s,roleId:t})=>{const a=R(),[l,i]=d.useState(""),{data:o,isLoading:m,isPlaceholderData:u}=z({workspaceId:s,roleId:t}),r=o?.filter(g=>g.name.toLowerCase().includes(l.toLowerCase())),[M,h]=d.useState(!1),{unassignGroup:v}=I({workspaceId:s,roleId:t});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-6 mb-3 flex flex-row justify-between gap-2",children:[e.jsx(O,{inputClassName:"w-[250px] rounded-full! text-sm",value:l,onChange:g=>{i(g.target.value)},placeholder:a.formatMessage({id:"workspaceSettings.groups.search",defaultMessage:"Search group name"})}),e.jsx(C,{onClick:()=>h(!0),icon:Z,children:a.formatMessage(w.add)})]}),e.jsx("div",{children:e.jsxs(n.Root,{className:"min-w-full",children:[e.jsxs("colgroup",{children:[e.jsx("col",{className:"w-[80%]"}),e.jsx("col",{className:"w-[20%]"})]}),e.jsxs(n.Header,{children:[e.jsx(n.HeaderCell,{children:a.formatMessage(w.name)}),e.jsx(n.HeaderCell,{children:a.formatMessage(w.dateAdded)})]}),e.jsx(n.Body,{className:_((m||u)&&"opacity-50"),children:r==null?e.jsx(n.Row,{children:e.jsx(n.Cell,{colSpan:5,textAlign:"center",children:e.jsx(H,{})})}):r.length===0?e.jsx(n.Row,{children:e.jsx(n.Cell,{colSpan:5,textAlign:"center",children:l===""?e.jsx(y,{id:"workspaceSettings.groups.noGroups",defaultMessage:"No groups found."}):e.jsx(y,{id:"workspaceSettings.groups.noGroupsWithFIlter",defaultMessage:"No groups found. Try changing the search query."})})}):r.map(g=>e.jsx(Re,{group:g,onRemoveAssignment:b=>v(b)},g.id))})]})}),M&&e.jsx(be,{onClose:()=>h(!1),workspaceId:s,roleId:t})]})},Re=({group:s,onRemoveAssignment:t})=>{const a=E();return e.jsx(e.Fragment,{children:e.jsxs(n.Row,{className:"[&>td]:py-2",onClick:()=>a(`/admin/groups/${s.id}`),children:[e.jsxs(n.Cell,{children:[e.jsx(Q,{group:s}),e.jsxs("div",{children:[e.jsx("div",{children:s.name}),e.jsx("div",{className:"text-token-text-secondary text-xs",children:e.jsx(y,{id:"15cHOa",defaultMessage:"{count} members",values:{count:s.num_members}})})]})]}),e.jsx(n.Cell,{children:s.created_time&&e.jsx(ee,{value:s.created_time,year:"numeric",month:"short",day:"numeric"})}),e.jsx(n.Cell,{className:"text-end",children:e.jsxs(p.Root,{children:[e.jsx(p.Trigger,{className:"-my-2",children:e.jsx(V,{className:"icon-sm"})}),e.jsx(p.Portal,{children:e.jsx(p.Content,{size:"small",children:e.jsx(p.Item,{onClick:()=>{t(s.id)},icon:e.jsx($,{className:"text-token-text-status-error"}),className:"text-token-text-status-error",children:e.jsx(y,{...w.removeLabel})})})})]})})]})})},w=N({add:{id:"floy3N",defaultMessage:"Add"},name:{id:"IP/+l1",defaultMessage:"Name"},dateAdded:{id:"6BJG0j",defaultMessage:"Date Added"},removeLabel:{id:"uut7wd",defaultMessage:"Remove group from role"}}),Se=N({permissionPageTitle:{id:"1Qw6mG",defaultMessage:"Roles & permissions"}}),we=s=>s==="permissions"||s==="assignments";function Ne({currentWorkspaceId:s,roleId:t}){const a=R(),[l,i]=d.useState(!1),{data:o,refetch:m}=de({roleId:t??"",workspaceId:s}),u=U(),r=E(),[M]=se(),[h,v]=d.useState(!1),{deleteRole:g}=ce({workspaceId:s}),b=d.useCallback(async()=>{try{await g(t??""),v(!1),u.success(a.formatMessage(f.removeSuccessMessage)),r("/admin/settings?tab=roles",{replace:!0})}catch{u.danger(a.formatMessage(f.removeErrorMessage))}},[g,a,t,u,r]),{updateRole:x}=me({workspaceId:s}),A=d.useCallback(async j=>{const S=await x(j);S.id!==t&&r({pathname:`/admin/permissions/roles/${S.id}`},{replace:!0}),m()},[r,m,t,x]),P=d.useMemo(()=>{const j=[{key:"permissions",label:a.formatMessage(f.rolePermissionsLabel),children:e.jsx(he,{role:o,onSave:A})}];return o&&!T(o)&&j.push({key:"assignments",label:a.formatMessage(f.roleAssignmentsLabel),children:e.jsx(ye,{workspaceId:s,roleId:t??""})}),j},[s,a,o,A,t]),k=M.get("tab"),[G,q]=d.useState(k&&we(k)?k:P[0].key),J=j=>{q(j),r({pathname:window.location.pathname,search:new URLSearchParams({tab:j}).toString()})},X=d.useMemo(()=>[{label:a.formatMessage(Se.permissionPageTitle),href:"/admin/settings?tab=roles"},{label:o?.name??""}],[a,o?.name]),K=e.jsxs(p.Root,{children:[e.jsx(p.Trigger,{asChild:!0,className:"border-token-border-default! border!",children:e.jsxs("div",{children:[a.formatMessage(f.manageLabel),e.jsx(xe,{className:"icon-sm ms-0.5"})]})}),e.jsx(p.Portal,{children:e.jsxs(p.Content,{children:[e.jsx(p.Item,{onClick:()=>L(i)(!0),icon:fe,label:a.formatMessage(f.editRoleLabel)}),e.jsx(p.Item,{onClick:()=>L(v)(!0),icon:$,label:a.formatMessage(f.deleteRoleLabel),color:"danger"})]})})]});return o?e.jsxs(e.Fragment,{children:[e.jsx(pe,{children:e.jsx("title",{children:o.name})}),e.jsx(te,{navigation:e.jsx(oe,{items:X}),title:o.name,subtitle:o.description,actions:o&&!T(o)?K:void 0,tabsHeader:e.jsx(Me,{items:P,activeTab:G,onTabChange:J})}),e.jsx(ne,{showSpinner:!1,children:e.jsx(ve,{items:P,activeTab:G})}),l&&e.jsx(je,{onSave:({name:j,description:S})=>A({...o,name:j,description:S}),onClose:()=>i(!1),isCreate:!1,defaultData:{name:o.name,description:o.description}}),h&&e.jsx(Ae,{onClose:()=>v(!1),onDeleteConfirm:()=>b()})]}):null}const Ae=({onDeleteConfirm:s,onClose:t})=>{const a=R(),[l,i]=d.useState(!1);return e.jsx(B,{testId:"modal-remove-member",isOpen:!0,title:a.formatMessage(f.deleteRoleLabel),onClose:t,type:"success",primaryButton:e.jsx(F.Button,{title:a.formatMessage(f.confirm),color:"danger",onClick:async()=>{try{i(!0),await s()}finally{i(!1)}},loading:l}),secondaryButton:e.jsx(F.Button,{title:a.formatMessage(f.cancel),color:"secondary",onClick:t,loading:l}),children:e.jsx("div",{className:"flex flex-col items-center gap-2",children:e.jsx("div",{className:"text-token-text-tertiary",children:a.formatMessage(f.deleteConfirmationText)})})})},f=N({rolePermissionsLabel:{id:"PXsC8s",defaultMessage:"Role permissions"},manageLabel:{id:"zPUmjl",defaultMessage:"Manage"},editRoleLabel:{id:"6pHT9d",defaultMessage:"Edit role"},deleteRoleLabel:{id:"XfDjrE",defaultMessage:"Delete role"},confirm:{id:"mQb6kI",defaultMessage:"Confirm"},cancel:{id:"uNmzc2",defaultMessage:"Cancel"},deleteConfirmationText:{id:"tZZlFY",defaultMessage:"Are you sure you want to delete this role? This action cannot be undone."},removeSuccessMessage:{id:"aBZC2C",defaultMessage:"Role removed successfully."},removeErrorMessage:{id:"KthOn1",defaultMessage:"Failed to remove role."},roleAssignmentsLabel:{id:"sBMwFp",defaultMessage:"Role assignments"}}),rs=W(function(){const t=le(),{roleId:a}=ae();return e.jsx(Ne,{...t,roleId:a})});export{rs as default};
//# sourceMappingURL=jhld8agybwi6oj6m.js.map
