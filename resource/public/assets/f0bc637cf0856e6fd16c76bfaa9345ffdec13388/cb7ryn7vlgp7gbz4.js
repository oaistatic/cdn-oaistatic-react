import{j as e,M as a,r as t,f as I,h as P}from"./m60bpb0x3x7rg8fj.js";import{hi as G,fS as A,B as R,lh as L,dQ as O,pP as F,aZ as B,h9 as q,e3 as U,bT as v,bV as E,pQ as H,A as Q,C as z,pI as _,o3 as D,hn as V,aW as Y,f as W}from"./lgw4q0e8zlqqfgug.js";import{fr as w,fs as d,bI as Z,ft as $}from"./ggjzadbnd3k1vu0k.js";import{G as J}from"./ihfhk4rvbppxuc1w.js";function K({onClose:n}){const c=L("installations/select_target");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-0 mb-4 flex justify-center",children:e.jsx("div",{className:"bg-tertiary border-token-border-subtle rounded-lg border p-3",children:e.jsx(G,{className:"h-10 w-10"})})}),e.jsx("h2",{className:"mb-6 text-center text-xl font-semibold",children:e.jsx(a,{id:"e7S220",defaultMessage:"One last step"})}),e.jsxs("div",{className:"bg-tertiary border-token-border-subtle mb-6 flex items-start gap-3 rounded-lg border p-4",children:[e.jsx(A,{className:"icon mt-0.5"}),e.jsxs("div",{className:"flex flex-grow flex-col gap-1",children:[e.jsx("span",{className:"font-medium",children:e.jsx(a,{id:"MQhj3s",defaultMessage:"Configure your repositories"})}),e.jsx("span",{className:"text-token-text-tertiary text-sm",children:e.jsx(a,{id:"ZvosJF",defaultMessage:"You still need to choose the repositories ChatGPT can access."})})]})]}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs(R,{className:"w-full",size:"large",onClick:()=>{window.open(c,"_blank"),n(!1)},children:[e.jsx(a,{id:"o1jiyf",defaultMessage:"Configure Repositories on GitHub"}),e.jsx(w,{className:"icon-sm ms-2 inline-block"})]})})]})}const X=({connectorLink:n,isLoading:c,onClose:h,onContinue:i})=>{const p=I(),m=P(),[r,N]=t.useState(""),[u,M]=t.useState(new Map),x=Z(r,500),{data:f,isLoading:T,isFetchingNextPage:k,hasNextPage:b,fetchNextPage:C}=$({enabled:!!n,debouncedSearchTerm:x,linkId:n?.id??""}),{mutateAsync:y,isPending:j}=D(),g=t.useCallback(async()=>{if(n)try{await y({link:n,user_extension:{type:"GithubUserApiExtension",opted_in_repository_ids:Array.from(u.keys())}}),m.invalidateQueries({queryKey:["user_connection_sync_configuration"]}),i({reposToIndex:Array.from(u.values()).filter(s=>!s.is_code_search_indexed).map(s=>s.repository_full_name)})}catch{}},[n,y,u,m,i]),l=t.useMemo(()=>f?.pages.flatMap(s=>s.repos)??[],[f]),o=l.length>5||!!x,S=T||c;return e.jsxs(e.Fragment,{children:[e.jsx(_,{title:e.jsx(a,{id:"BhSDq8",defaultMessage:"Which repositories do you use?"}),connectorIcon:e.jsx("div",{className:"rounded-xl border-[0.5px] p-2 shadow-sm",children:e.jsx(G,{className:"icon-2xl"})}),onClose:()=>h(!1)}),e.jsx("div",{className:"text-token-text-secondary mt-2 mb-6 text-center text-sm",children:o?e.jsx(a,{id:"o+DCDE",defaultMessage:"Choose up to 5. These repositories will sync with ChatGPT for improved speed and quality. Not seeing a repository? <link>Learn more</link>",values:{link:s=>e.jsx("a",{href:"https://help.openai.com/en/articles/11145903-chatgpt-connectors",target:"_blank",rel:"noopener noreferrer",className:"underline",children:s})}}):e.jsx(a,{id:"8FVBwU",defaultMessage:"These repositories will sync with ChatGPT for improved speed and quality. Not seeing a repository? <link>Learn more</link>",values:{link:s=>e.jsx("a",{href:"https://help.openai.com/en/articles/11145903-chatgpt-connectors",target:"_blank",rel:"noopener noreferrer",className:"underline",children:s})}})}),o&&e.jsx(V,{ariaLabel:p.formatMessage({id:"D2Xhv1",defaultMessage:"Search repositories"}),autoComplete:"off",className:"mb-2",icon:Y,iconPosition:"left",name:"search-repos",onChange:s=>{N(s.target.value)},placeholder:p.formatMessage({id:"jYgjAb",defaultMessage:"Search repositories"})}),e.jsx(J,{allRepos:l,fetchNextPage:C,hasNextPage:b,isFetchingNextPage:k,isLoading:S,onChange:M,searchTerm:x,selectedRepos:u}),e.jsx(R,{className:"mt-2 w-full",disabled:S,loading:j,onClick:()=>{u.size===0?i({reposToIndex:[]}):g()},size:"large",children:e.jsx(a,{...W.continueButtonText})})]})},ee=({isLoading:n,onClose:c,reposToIndex:h})=>e.jsxs(e.Fragment,{children:[e.jsx(_,{title:e.jsx(a,{id:"hxqAFz",defaultMessage:"Complete setup"}),connectorIcon:e.jsx("div",{className:"rounded-xl border-[0.5px] p-2 shadow-sm",children:e.jsx(G,{className:"icon-2xl"})}),onClose:()=>c(!1)}),e.jsx("div",{className:"text-token-text-secondary mt-2 mb-6 text-center text-sm",children:e.jsx(a,{id:"IQqMC0",defaultMessage:"Your repositories must be indexed by GitHub before they can be accessed by ChatGPT. GitHub will open in a new tab, and automatically close. Indexing should complete in 5-10 minutes."})}),e.jsxs(R,{className:"mt-2 w-full",loading:n,onClick:()=>{window.open(`https://github.com/search?q=${h.map(i=>`repo:${i}`).join("+")}&type=code`,"_blank"),c(!1)},size:"large",children:[e.jsx(a,{id:"CfvY9y",defaultMessage:"Start indexing on GitHub"}),e.jsx(w,{className:"icon-sm ms-2 inline-block"})]})]});function ae({initialState:n=d.ConfigureRepos,onClose:c,onFinishFlow:h}){const i=O(),p=F(),m=B(),[r,N]=t.useState(n),[u,M]=t.useState([]),{platformConnectors:x,isLoading:f}=q(!0),{connectorLinks:T,isLoading:k}=U({fetchValidLinksOnly:!0}),b=x.get(v[E.GITHUB_CONNECTOR]),C=T.get(v[E.GITHUB_CONNECTOR])?.[0],{isLoading:y,isEnabled:j}=H(),g=f||k||y,l=t.useCallback(s=>{c(s)},[c]),o=t.useCallback(()=>{l(!1),h?.()},[l,h]),S=t.useMemo(()=>{switch(r){case d.ConfigureRepos:return e.jsx(K,{onClose:()=>l(!1)});case d.SyncRepos:return i&&!p&&e.jsx(X,{connector:b,connectorLink:C,isLoading:g,onContinue:({reposToIndex:s})=>{s.length>0?(M(s),N(d.IndexRepos)):o()},onClose:o});case d.IndexRepos:return e.jsx(ee,{isLoading:g,onClose:o,reposToIndex:u})}},[r,u,l,b,C,g,i,p,o]);return t.useEffect(()=>{!i&&r===d.SyncRepos&&l(!1)},[i,r,l]),t.useEffect(()=>{p&&r===d.SyncRepos&&o()},[p,r,o]),t.useEffect(()=>{!m?.isPersonalAccount()&&m?.planType!==Q.SELF_SERVE_BUSINESS&&!j&&o()},[m,o,j]),e.jsx(z,{className:"max-w-[400px] px-2",hideSeparator:!0,isOpen:!0,onClose:()=>l(!1),showCloseButton:r===d.ConfigureRepos,title:r===d.ConfigureRepos?e.jsx("span",{}):void 0,testId:"modal-github-onboarding",type:"success",children:S})}export{ae as GithubOnboardingModal};
//# sourceMappingURL=cb7ryn7vlgp7gbz4.js.map
