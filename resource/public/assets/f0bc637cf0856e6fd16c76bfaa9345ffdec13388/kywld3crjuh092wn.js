import{m7 as R,b2 as S,dk as h,dl as f,R as C}from"./lgw4q0e8zlqqfgug.js";import{a as b}from"./bcan8xe3gkb6tcfp.js";import{P as O,a as E,r}from"./m60bpb0x3x7rg8fj.js";async function k(p,t,e,s){const c=await C.safeGet("/connectors/{id}/oauth/callback",{parameters:{path:{id:p},query:{code:t,redirect_uri:e,state:s}}});return{...c,redirect_path:b(c.redirect_path).toString()}}const $=R(function(){const{pluginId:t}=O(),e=E(),s=r.useRef(!1),[c,g]=r.useState(""),{code:o,error:n,error_description:i,state:u}=Object.fromEntries(new URLSearchParams(c.substring(1)).entries());r.useEffect(()=>{g(window.location.hash)},[]),r.useEffect(()=>{if(s.current)return;if(t&&o&&u)s.current=!0;else{e("/");return}async function m(){const _=window.location.origin+`/ccc/${t}/oauth/callback`;if(!(!t||!o||!u))try{const a=await k(t,o,_,u);if(a.success){const l=new URL(h(f.OAUTH_SUCCESS,a.redirect_path),location.origin);l.searchParams.set("oauth_success","true"),e(l.pathname+l.search+l.hash)}else e(h(f.CUSTOM_ERROR,a.redirect_path,a.error??a.message))}catch{e(h(f.CUSTOM_ERROR))}}m()},[t,o,u,e]);const d=S();return r.useEffect(()=>{n&&d.danger(`${n}${i?`: ${i}`:""}`,{duration:5,toastId:"oauth_callback: CCCOauth",loggingTitle:n,loggingDescription:i??""})},[n,i,d]),null});export{$ as default};
//# sourceMappingURL=kywld3crjuh092wn.js.map
