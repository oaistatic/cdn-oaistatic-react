import{r as c,f as le,j as t,x as ce,A as V,m as X}from"./m60bpb0x3x7rg8fj.js";import{fl as z,aD as Y,cq as ee,dS as te,jt as ue,c as W,nE as de,gE as me,e7 as fe,fa as xe,am as D,bc as ne,B as $,e as se,fU as he,fV as ge,g as pe,db as G,hq as H,P as _,p as ve,cp as we,i3 as Z,bt as be,T as O,z as Ie,bF as je,fE as ye}from"./lgw4q0e8zlqqfgug.js";import{kM as ke,eh as _e,N as Se,cG as Ne,cW as Ee,kd as R,kN as k,kO as q,kP as B,cc as Q,kQ as Re,kR as Ce,kS as Me,kT as Le}from"./ggjzadbnd3k1vu0k.js";import{g as Te,u as Ae,a as Pe,b as U}from"./envm9t71cd7luwm9.js";const ae=c.createContext({imageList:[],activeIndex:null,isInFocusMode$:z(!1),isZoomed$:z(!1)}),C=()=>c.useContext(ae);function F(){for(var e,n=0,a="",s=arguments.length;n<s;n++)(e=arguments[n])&&typeof e=="string"&&(a+=(a&&" ")+e);return a}const qe="_lightbox_1ruyj_1",ze={lightbox:qe};function De({imageList:e,forceDarkMode:n=!1,initialIndex:a,isInFocusMode$:s,onClose:l,onScrollToEnd:d,children:m}){const u=le(),f=c.useRef(null),w=ke(),[o,b]=c.useState(a),g=Y(),v=ee(),[p]=c.useState(()=>z((window.visualViewport?.scale??1)!==1)),x=te(()=>p());c.useEffect(()=>{w.signalTransitionReady()},[w]),c.useEffect(()=>{if(x)return ue(()=>{p()||requestAnimationFrame(()=>{f.current?.querySelector(`[data-position="${o}"]`)?.scrollIntoView({behavior:"smooth",inline:"center",block:"center"})})})},[x,o,p]),c.useEffect(()=>{const i=()=>p.set((window.visualViewport?.scale??1)!==1);return window.visualViewport?.addEventListener("resize",i),()=>window.visualViewport?.removeEventListener("resize",i)},[p]),W(()=>{f.current?.querySelector(`[data-position="${a}"]`)?.scrollIntoView({behavior:"instant",inline:"center",block:"center"})},[a]);const S=c.useCallback(i=>{b(i),requestAnimationFrame(()=>{const h=e[i]?.title;h&&de.setLiveRegionPolite(h)}),i===e.length-1&&d?.()},[e,d]);W(()=>{const i=f.current;if(!i)return;const h=new IntersectionObserver(T=>{const A=T.reduce((E,P)=>P.isIntersecting&&(!E||P.intersectionRatio>E.intersectionRatio)?P:E,null);A&&A.target instanceof HTMLElement&&S(me(A.target.dataset.position))},{root:i,rootMargin:"0px -50% 0px -50%",threshold:0});for(const T of i.querySelectorAll(":scope > li"))h.observe(T);return()=>{h.disconnect()}},[e,S]);const j=e.length-1,I=c.useCallback(i=>{const h=Math.min(Math.max(o+i,0),j);S(h),requestAnimationFrame(()=>{f.current?.querySelector(`[data-position="${h}"]`)?.scrollIntoView({behavior:g?"instant":"smooth",block:"center",inline:"center"})})},[o,j,g,S]);c.useEffect(()=>{requestAnimationFrame(()=>{const i=document.querySelector("[data-lightbox-close-button]");i instanceof HTMLElement&&i.focus()})},[]),c.useEffect(()=>{const i=h=>{if(s?.()){h.key==="Escape"&&s.set(!1);return}h.key==="ArrowLeft"?o>0&&(h.preventDefault(),I(-1)):h.key==="ArrowRight"?o<j&&(h.preventDefault(),I(1)):h.key==="Escape"&&l(o)};return window.addEventListener("keydown",i),()=>{window.removeEventListener("keydown",i)}},[o,j,I,l,s]),c.useEffect(()=>{fe(xe(),"chatgpt_web_image_library_lightbox_image_viewed")},[o]);const{footer:M,items:r,title:y,headerActions:L}=_e(m,{title:re,items:oe,footer:ie,headerActions:Fe});return t.jsx(ae.Provider,{value:{imageList:e,activeIndex:o,isInFocusMode$:s,isZoomed$:p},children:t.jsxs(D.Root,{testId:"modal-image-gen-lightbox",isOpen:!0,onClose:()=>l(o),shouldIgnoreClickOutside:v,className:F(v||n?"dark bg-black":"bg-token-bg-primary","flex h-dvh max-h-full w-dvw max-w-full flex-col place-content-center",ze.lightbox),children:[t.jsxs("section",{className:"grid grid-cols-[auto_1fr_auto] items-start px-1.5 pt-1 [view-transition-name:var(--vt-page-title)] max-md:absolute max-md:start-0 max-md:end-0 max-md:top-0 max-md:items-center md:grid-cols-[1fr_auto_1fr] md:px-5 md:pt-2",children:[t.jsx("div",{className:"w-fit",children:t.jsx(Se,{icon:ne,"data-lightbox-close-button":!0,onClick:()=>l(o),"aria-label":u.formatMessage({id:"f08aLO",defaultMessage:"Close"})})}),!x&&y,(!x&&L)??t.jsx("div",{className:"w-8 shrink-0 basis-auto"})]}),t.jsxs("div",{className:"no-scrollbar flex h-full snap-y snap-mandatory flex-col overflow-y-scroll scroll-smooth",onScroll:i=>{i.target.scrollTop===0&&!p()&&l(o)},children:[t.jsx("div",{className:"h-[15dvh] flex-shrink-0"}),t.jsxs("ol",{ref:f,className:F("flex max-h-full min-h-0 flex-shrink-0 grow basis-full gap-[min(10dvw,_200px)] overflow-x-auto scroll-smooth [anchor-name:--carousel] [view-transition-name:var(--vt-image-carousel)] max-md:gap-0",v&&"no-scrollbar",!x&&"snap-x snap-mandatory snap-center snap-always py-15"),onClick:i=>{(i.target instanceof HTMLOListElement||i.target instanceof HTMLLIElement)&&(i.preventDefault(),l(o))},children:[t.jsx("li",{className:"w-[50vw] flex-shrink-0"}),r,t.jsx("li",{className:"w-[50vw] flex-shrink-0"})]}),t.jsx("div",{className:"h-[15dvh] flex-shrink-0"})]}),!x&&t.jsxs("div",{className:"pointer-events-none absolute inset-5 z-20 flex items-center justify-between [view-transition-name:var(--vt-scroll-buttons)] max-md:hidden",children:[t.jsx($,{className:"pointer-events-auto aspect-square",disabled:o===0,color:"secondary",icon:Ne,onClick:()=>I(-1),"aria-label":u.formatMessage({id:"iQsFWe",defaultMessage:"Previous image"})}),t.jsx($,{className:"pointer-events-auto aspect-square",color:"secondary",disabled:o===j,icon:Ee,onClick:()=>I(1),"aria-label":u.formatMessage({id:"W7vnD4",defaultMessage:"Next image"})})]}),!x&&M]})})}function re({children:e}){const{imageList:n,activeIndex:a}=C();if(a==null)return null;const s=n[a];return s?e(s):null}function oe({children:e}){const{imageList:n,isZoomed$:a,activeIndex:s}=C(),l=ee(),d=Y(),m=te(()=>a?.());return n.map((u,f)=>{const{width:w,height:o}=u,b=w!=null&&o!=null&&w===o;let g=null;s!=null&&(f===s?g="current":f+1===s?g="before":f-1===s&&(g="after"));const v=!l&&g!=="current";return t.jsx("li",{role:v?"button":void 0,className:F("flex max-h-full max-w-[70dvw] flex-shrink-0 snap-center items-center justify-center transition-opacity duration-0 motion-safe:duration-300 max-md:w-[100dvw] max-md:max-w-[100dvw] max-md:snap-always max-md:opacity-100",b&&"aspect-square",g==="current"||m?"opacity-100":"opacity-40"),"data-position":f,onClick:v?({currentTarget:p})=>p.scrollIntoView({behavior:d?"instant":"smooth",block:"center",inline:"center"}):void 0,children:e({...u,index:f,position:g})},u.id??u.url)})}function ie({children:e}){const{imageList:n,activeIndex:a}=C();if(a==null)return null;const s=n[a];return s?t.jsx("footer",{className:"absolute bottom-0 z-10 flex w-full items-center justify-center px-5 pb-3 [view-transition-name:var(--vt-page-footer)] max-md:pb-6",children:e(s)}):null}function Fe({children:e}){const n=[];return c.Children.forEach(e,a=>{c.isValidElement(a)&&a.type===Oe&&n.push(a)}),t.jsx("div",{className:"flex items-center justify-end gap-2",children:n.map((a,s)=>t.jsx(c.Fragment,{children:a},s))})}function Oe({children:e}){const{imageList:n,activeIndex:a}=C();return a==null||n[a]==null?null:e(n[a])}function Ve(e,n,a=!1){const s=O.getTurnContentReferences(e,n),l=Re(s),d=We(e,n),m=l.concat(d);if(a){const u=$e(e,n);m.push(...u)}return Ce(m,"content_url")}function We(e,n){const a=O.getConversationTurnAtIndex(e,n).messages;return a?ye(a.flatMap(s=>s.metadata?.image_results??[])).map(s=>({...s,thumbnail_url:s.thumbnail_url.replace(/^http:\/\//,"https://"),content_url:s.content_url.replace(/^http:\/\//,"https://")})):[]}function $e(e,n){return O.getSuperWidgetMessages(e,n).flatMap(s=>s.content.widgets.images)}function Ge(e,n,a,s){const{product:l}=Me({thread:e,messageId:n,contentReferenceStartIndex:a,productIndex:s});return!l||!l.image_urls?[]:l.image_urls.map(d=>({url:d,content_url:d,thumbnail_url:d,title:l.title,content_size:{width:0,height:0},thumbnail_size:{width:0,height:0}}))}function et({clientThreadId:e}){const n=se(),a=he(n)&&ge(n),s=R.useCurrentImage();if(!s)return null;const{image:l,source:d,analyticsMetadata:m,contentReferenceStartIndex:u,productIndex:f}=s;if(d==null||e==null||m?.turnIndex==null)return t.jsx(N,{image:l,analyticsMetadata:{}});const w=pe(e),o=function(){switch(d){case k.ProductDetails:return Ge(w,m.messageId,u,f);case k.SuperWidget:case k.ImageGroup:return s.imageResults;default:return Ve(w,m.turnIndex,a)}}();return t.jsx(N,{image:l,group:o,analyticsMetadata:m,groupSource:d})}function tt(){const e=R.useCurrentImage();if(!e)return null;const{image:n,source:a}=e;if(a==null)return t.jsx(N,{image:n,analyticsMetadata:{}});switch(a){case k.ImagesTab:return t.jsx(He,{image:n});case k.Turn:return t.jsx(Ze,{image:n});default:return null}}function He({image:e}){const{imageResults:n}=Pe();return t.jsx(N,{image:e,group:n,groupSource:k.ImagesTab,analyticsMetadata:{}})}function Ze({image:e}){const{imageResults:n}=Ae();return t.jsx(N,{image:e,group:n,groupSource:k.Turn,analyticsMetadata:{}})}const K=je.div`grow flex items-start p-8`,Be={enter:e=>({x:e>0?1e3:-1e3,opacity:0}),center:{zIndex:1,x:0,opacity:1},exit:e=>({zIndex:0,x:e<0?1e3:-1e3,opacity:0})},Qe=1e4,Ue=(e,n)=>Math.abs(e)*n;function N({image:e,group:n,groupSource:a,analyticsMetadata:s}){const l=c.useRef(null),d=e.attribution??q(e.url),m=R.useCurrentImage(),u=R.useStore(),f=m?.mountDirection;c.useEffect(()=>{window?.history?.state?.imageModalOpen||window.history.pushState({imageModalOpen:!0},"",window.location.href);const r=()=>{window?.history?.state?.imageModalOpen||u.setCurrentImage(void 0)};return window.addEventListener("popstate",r),()=>window.removeEventListener("popstate",r)},[u]);const w=e.content_url.replace(/^http:\/\//,"https://"),o=n?.findIndex(r=>G(e,r))??0,b=n?.length??1,g=o!=null&&b>1,v={...H(s),url:e.url,link_type:"text",section:"image",section_location:"response",section_index:(o+1).toString()};c.useEffect(()=>{l.current!==e.url&&(l.current=e.url,_.logEventWithStatsig("Search Content Reference Shown","search_content_reference_shown",{...H(s),type:"full_screen_image",url:e.url,image_url:w}),_.logEvent("link_action",{...v,action:"show"}))},[w]);const p=()=>{window.history.go(-1),u.setCurrentImage(void 0)},x=c.useCallback(r=>{if(!g||n==null)return;const y=r==="next"?(o+1)%n.length:(o-1+n.length)%n.length;u.setCurrentImage({image:n[y],source:a,mountDirection:r==="next"?B.FromRight:B.FromLeft,analyticsMetadata:s,contentReferenceStartIndex:m?.contentReferenceStartIndex,productIndex:m?.productIndex,imageResults:m?.imageResults})},[g,n,u,o,a,s,m]);ce({queries:(n??[]).map(r=>Te(r.thumbnail_url,"ImageResultModal"))});const j=se(),I=ve(j,"2804795149"),M=c.useMemo(()=>n??[e],[n,e]);return c.useEffect(()=>{if(!I)return we(document,{keydown:r=>{r.key==="ArrowRight"?x("next"):r.key==="ArrowLeft"&&x("prev")}})},[I,x]),I?t.jsxs(De,{forceDarkMode:!0,imageList:M,initialIndex:o,onClose:p,children:[g&&t.jsx(re,{children:r=>t.jsxs("div",{className:"text-token-text-tertiary shrink-0 px-4 py-2",children:[(n?.findIndex(y=>G(r,y))??0)+1," /"," ",b]})}),t.jsx(oe,{children:r=>t.jsx(J,{image:r,isNewLightbox:!0})}),t.jsx(ie,{children:r=>t.jsx("div",{className:"flex w-full justify-start",children:t.jsx("div",{className:"w-fit rounded-xl backdrop-blur-xl",children:t.jsx(Z,{onClick:()=>{_.logEvent("link_action",{...v,action:"click"})},onMouseEnter:()=>{_.logEvent("link_action",{...v,action:"hover"})},href:r.is_proxied_image?r.content_url:r.url,className:"flex min-h-20 w-fit shrink-0 items-center gap-8 px-4 py-2 text-sm hover:opacity-70",children:t.jsxs("div",{className:"flex grow flex-col gap-0.5 overflow-hidden pe-2",children:[t.jsxs("div",{className:"text-token-text-tertiary flex items-center gap-2 truncate",children:[t.jsx(Q,{url:r.content_url,className:"rounded-sm",size:16}),r.attribution??q(r.url)]}),t.jsx("div",{className:"truncate font-semibold text-white",children:r.title})]})})})})})]}):t.jsx(V,{children:e&&t.jsx(D.Root,{isOpen:!0,onClose:p,testId:"modal-image-result",children:t.jsx(D.Overlay,{children:t.jsxs(be,{className:"flex h-full w-full flex-col bg-black/95",children:[t.jsxs("div",{className:"relative flex w-full grow justify-center overflow-hidden",children:[t.jsxs("div",{className:"absolute end-4 top-4 flex items-center sm:end-6 sm:top-6",children:[g&&t.jsxs("div",{className:"text-token-text-tertiary shrink-0 px-4 py-2",children:[o+1," / ",b]}),t.jsx("button",{onClick:r=>{r.stopPropagation(),p()},className:"flex h-9 w-9 items-center justify-center outline-hidden hover:opacity-70",children:t.jsx(ne,{className:"h-6 w-6 text-gray-400"})})]}),b>1&&t.jsx(K,{className:"cursor-w-resize",onClick:r=>{r.stopPropagation(),x("prev")}}),t.jsx(V,{initial:!1,custom:f,children:t.jsx(X.div,{variants:Be,custom:f??0,className:"absolute top-24 bottom-4",initial:"enter",animate:"center",exit:"exit",transition:{x:{type:"spring",stiffness:300,damping:30},opacity:{duration:.2}},drag:b>1?"x":!1,dragConstraints:{left:0,right:0},dragElastic:1,onDragEnd:(r,{offset:y,velocity:L})=>{const i=Ue(y.x,L.x);i<-1e4?x("next"):i>Qe&&x("prev")},children:t.jsx(J,{image:e})},o)}),b>1&&t.jsx(K,{className:"cursor-e-resize",onClick:r=>{r.stopPropagation(),x("next")}})]}),t.jsx(Z,{onClick:()=>{_.logEvent("link_action",{...v,action:"click"})},onMouseEnter:()=>{_.logEvent("link_action",{...v,action:"hover"})},href:e.is_proxied_image?e.content_url:e.url,className:"flex min-h-20 w-full shrink-0 items-center gap-8 px-6 pt-8 pb-3 text-sm hover:opacity-70 sm:px-8 sm:pb-8",children:t.jsxs("div",{className:"flex grow flex-col gap-0.5 overflow-hidden pe-2",children:[t.jsxs("div",{className:"text-token-text-tertiary flex items-center gap-2 truncate",children:[t.jsx(Q,{url:e.content_url,className:"rounded-sm",size:16}),d??q(e.url)]}),t.jsx("div",{className:"truncate font-semibold text-white",children:e.title})]})})]})})})})}function J({image:e,isNewLightbox:n=!1}){const a=e.content_url.replace(/^http:\/\//,"https://"),s=e.thumbnail_url.replace(/^http:\/\//,"https://"),l=e.content_size.width/e.content_size.height,{isError:d}=U(a,"ModalImage_main"),{isError:m}=U(s,"ModalImage_thumbnail"),u=e.is_proxied_image?e.url:d?s:a;return!m||!d||e.is_proxied_image?t.jsx(X.img,{src:u,alt:e.title,style:{backgroundImage:s?`url(${s})`:void 0,backgroundSize:"contain",aspectRatio:l,backgroundPosition:"center",backgroundRepeat:"no-repeat"},initial:{opacity:0},animate:{opacity:1},className:Ie(n?"h-full max-w-full object-contain":"h-full max-w-[100vw] object-contain sm:max-w-[calc(100vw-10rem)]")}):t.jsx("div",{className:"flex h-full grow items-center justify-center",children:t.jsx("div",{className:"flex h-96 w-96 items-center justify-center bg-white/10",children:t.jsx(Le,{className:"text-token-text-tertiary h-12 w-12"})})})}export{et as ImageLightbox,tt as ImageLightboxSearchGPT};
//# sourceMappingURL=ndfsi2sgwxxkpokp.js.map
