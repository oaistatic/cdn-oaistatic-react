import{r as g,j as p,f as T}from"./m60bpb0x3x7rg8fj.js";import{cO as M,v as l,N as d,e as C,p as x,dC as k}from"./lgw4q0e8zlqqfgug.js";import{CoTChunks as _}from"./pfmeky3hgwt4ozsa.js";import{iH as m}from"./ggjzadbnd3k1vu0k.js";import"./kkg7k3irromdz83f.js";import"./lqxrayj6ap3vzwmb.js";import"./hv81c3k3l9e69foo.js";import"./cs281ckvaib8kadh.js";import"./h81zqbvh0a7amk0o.js";import"./mog17ocsx2bkw4q4.js";import"./l8y86l5s35pa16ob.js";import"./df3y7yi36gehsn95.js";import"./g5bh4mjh9t2vmm93.js";import"./j770ggbjd02m3hqj.js";import"./pbl95wx6493wq92j.js";import"./crheuewn890nts1d.js";import"./mr7j3fxti6m51rk7.js";import"./j4gbrzdh1iwlkiif.js";import"./lp550lzjbjov6tk6.js";const y=(e,t)=>{if(t<=1)return e.formatMessage({id:"ZxhUq1",defaultMessage:"a second"});if(t<3)return e.formatMessage({id:"4GD7tD",defaultMessage:"a couple of seconds"});if(t<4)return e.formatMessage({id:"jx5V1u",defaultMessage:"a few seconds"});if(t>=60){const n=Math.floor(t/60),o=t%60;return`${n}m ${o}s`}return e.formatMessage({id:"p4/pTg",defaultMessage:"{seconds} seconds"},{seconds:t})},E=e=>{let t=0;for(const n of e)t+=n.metadata?.finished_duration_sec??0;return t},R=(e,t,n)=>t.length>1?e.formatMessage({id:"sdDgmZ",defaultMessage:"Thought for {timing}"},{timing:y(e,n)}):M(t)?.metadata?.finished_text??"",I=(e,t,n=!1)=>{const o=[];let s={type:m.Thought,thought:{summary:"",content:""}};const a=()=>{s.thought.content.trim()&&(o.push(s),s={type:m.Thought,thought:{summary:s.thought.summary,content:""}})},u=e.split(/( {2}\n)|(\n\n)/).filter(i=>i!=null&&i.trim());if(!n&&u.length<2)return o;let c=!1;for(let i=0;i<u.length;i++){const r=u[i].trim();if(r.toLowerCase()==="none"){l.count(d.COT_SUMMARIZER,"num_none_chunks");continue}const f=r.match(/^\*\*(.*)\*\*$/);if(f)a(),s.thought.summary=f[1]??"";else if(r){if(r.startsWith("```")){if(c){s.thought.content+=s.thought.content?`
${r}`:r,a(),c=!1;continue}a(),c=!0}s.thought.content.trim()&&!r.startsWith("\\[")&&!r.startsWith("\\(")&&!c&&a(),s.thought.content+=s.thought.content?`
${r}`:r}}return s?.thought.content.trim()&&o.push(s),n&&t&&o.push({type:m.Recap,content:t}),o},N=(e,t,n)=>{const o=!n,s=g.useMemo(()=>I(e,t,o),[e,t,o]);return g.useEffect(()=>{o&&l.hist(d.COT_SUMMARIZER,"num_cot_chunks",void 0,s.length)},[o]),s},O=({isStreaming:e,finishedText:t,summaryText:n,isFinalAssistantTurn:o})=>{const s=N(n,t,e);return p.jsx(_,{isStreaming:e,isFinalAssistantTurn:o,chunks:s})},S=8,j=`

`,K=({messages:e,isStreaming:t,isFinalAssistantTurn:n})=>{const o=T(),s=C(),a=x(s,"1214379119"),u=E(e);let c="";return e.forEach(i=>{const h=k(i);c+=c?j+h:h}),a&&!t&&!c&&u<S?null:p.jsx(O,{finishedText:R(o,e,u),summaryText:c,isStreaming:t,isFinalAssistantTurn:n})};export{O as LegacyCoT,K as LegacyCoTMessage};
//# sourceMappingURL=jwxf616kyifxarl1.js.map
