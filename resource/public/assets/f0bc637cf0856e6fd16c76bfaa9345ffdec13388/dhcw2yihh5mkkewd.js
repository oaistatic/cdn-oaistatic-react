const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/k0o2yofpsl49x5ud.js","assets/m60bpb0x3x7rg8fj.js","assets/lgw4q0e8zlqqfgug.js","assets/root-otc54kct.css","assets/ggjzadbnd3k1vu0k.js","assets/conversation-small-j0gcsxmz.css","assets/g43t6mvc4wvemyu6.js","assets/hf4p7t05oigpiihm.js","assets/hp08qw6yu0x90xkd.js","assets/xe390if828rmv032.js","assets/lc2g6guksc7c51bw.js","assets/l9wqdp1695odsw0u.js","assets/c18xhpsreatdvyxf.js","assets/jiql7n7371z0m4r5.js","assets/hg1hygbe4ieqyyvy.js","assets/mog17ocsx2bkw4q4.js","assets/df3y7yi36gehsn95.js","assets/enuwppfnm9s2n8ir.js","assets/m9elivgqkyz3hcka.js","assets/ekc4a26ow669vmxe.js","assets/envm9t71cd7luwm9.js","assets/pc2givv05uuq8g6l.js","assets/j4gbrzdh1iwlkiif.js","assets/h81zqbvh0a7amk0o.js","assets/b64z5jg99ka1julv.js","assets/bpw2xzqmlm1jo09m.js","assets/oqyy1xfq5y51tstr.js","assets/g50ywpipiciqnnrt.js","assets/n26tu9wxezmtzr3d.js","assets/ngdk8aaa28n1ff0n.js","assets/cb9cgv53vja8utnc.js","assets/g7o69yifmkuxfsll.js","assets/o7wniqoxhh56wvjg.js","assets/czj65b9i5sztgpdb.js","assets/nyb6qzfj9cwbbq9m.js","assets/ijm2v97qh75qdidh.js","assets/loqw89wii3nszys1.js","assets/dmk30rbb7u1k7gl7.js","assets/ansi-1f6vhsjh.css","assets/crheuewn890nts1d.js","assets/imrl18sy28ygoppx.js","assets/kh89q49991ykwivd.js","assets/kl7c6054usfnqmd4.js","assets/mia7qmdupqoji40k.js","assets/fg36ujrp67ag8qf3.js","assets/mdo0nu72resalvd9.js","assets/lqxrayj6ap3vzwmb.js","assets/fka99unhlwy7iq80.js","assets/l8y86l5s35pa16ob.js","assets/ih5unt2mq3ebrtkx.js","assets/h1or1pd70sqvyo0k.js","assets/d66h1wmdf2bqey2z.js","assets/fna9z31n721lpf9f.js","assets/table-components-iztk4amh.css"])))=>i.map(i=>d[i]);
import{j as s,M as T,f as P,r as h,v as ka,i as mn,m as he,c as Ve,A as Pt,x as Ca,u as Sa,g as Ma,k as hn,R as fn,d as Bt,p as yt}from"./m60bpb0x3x7rg8fj.js";import{S as Na}from"./df3y7yi36gehsn95.js";import{M as Ta,r as $a,a as Ea,m as pn,u as gn,R as xn,b as yn,S as cs,c as Pa,I as La,d as Aa,C as Ra,e as Ia,f as Da,g as Fa,h as Oa}from"./enuwppfnm9s2n8ir.js";import{wo as za,wp as Ba,wq as bt,wr as ge,fB as bn,kc as wn,Y as Wt,sW as Wa,mA as Ha,lH as ht,ws as Ua,cR as Va,n as qa,dP as ie,dN as Ga,ci as Za,h8 as Ya,da as vn,kz as Xa,id as Ht,m9 as Ut,ib as Vt,ic as qt,wt as Ka,fm as _n,fn as Ja,fe as Qa,i8 as eo,fP as to,kD as so,sY as no,wu as ao,wv as oo,tI as ro,bL as Gt,bm as jn,sp as io,ww as lo,fw as co,lQ as uo,lR as mo,lS as ho,dm as fo,iM as po,kR as go,kN as Be,kd as Zt,wx as xo,eS as yo,kO as ft,cc as De,ky as bo,bQ as wo,s0 as kn,wy as Cn,wz as Sn,wA as vo,pA as _o,cG as jo,cW as Mn,wB as Nn,k7 as ko,lW as Co,wC as So,kY as Yt,wD as Tn,aM as $n,wE as Mo,wF as No,wG as To,ch as $o,cj as Eo,lZ as Po,iu as Lo,wH as Ao,wI as Ro,wJ as Io,wK as Do,jR as Fo,bj as Lt,jQ as En,wL as Pn,wM as Oo,wN as zo,wO as Bo,bE as Wo,c4 as Ho,aS as V,wP as Uo,sw as Vo,wQ as qo,uh as Go,wR as Zo,wS as Yo,wT as Xo,wU as Ko,c6 as Jo,tT as Qo,aH as er,hK as tr,wV as et,wW as sr,tO as nr,tq as ar}from"./ggjzadbnd3k1vu0k.js";import{z as S,wn as or,du as Ee,ap as qe,fc as rr,S as Ge,b2 as Pe,e as B,p as F,nl as Xt,cP as Kt,pe as ir,w as lr,aa as Le,b_ as Ln,b$ as Jt,dU as cr,af as dr,I as ds,hi as ur,f5 as An,cf as mr,W as Rn,M as In,aD as hr,B as ee,am as ye,bk as fr,bv as pr,bw as gr,cs as Z,fs as xr,fp as yr,qz as br,P as be,hq as pt,wo as wr,mr as vr,ms as _r,u5 as jr,m1 as kr,_ as Qt,cd as xe,R as es,eE as Ze,bC as Dn,gD as Fn,d0 as Cr,ed as Sr,hN as Mr,m as Nr,ld as Tr,T as We,cq as Ye,r as $r,fV as On,G as zn,i3 as pe,lb as Er,hD as Pr,wp as Lr,gB as Ar,g0 as Rr,mb as Ir,h1 as Xe,t as Ke,gr as Dr,sl as Fr,ds as Or,ia as zr,fh as Br,hr as Wr,jR as Hr,ik as Ur,y as Vr,gc as wt,i1 as qr,cR as Gr,bF as ts,q as Zr,wq as Yr,l0 as ss,d5 as Xr,e1 as Kr,my as Ie,ab as Bn,nF as Jr,hl as Qr,L as ei,wr as ti,dN as si,md as ni,e_ as ai,dI as Wn,fU as oi,c as ri,g as ii,qi as li,gO as ci}from"./lgw4q0e8zlqqfgug.js";import{u as ns}from"./j4gbrzdh1iwlkiif.js";import{N as di}from"./h81zqbvh0a7amk0o.js";import{g as us,F as ui,i as mi}from"./b64z5jg99ka1julv.js";import{S as hi}from"./bpw2xzqmlm1jo09m.js";import{v as fi,u as pi,P as gi,W as xi}from"./hf4p7t05oigpiihm.js";import{L as yi}from"./oqyy1xfq5y51tstr.js";import{W as bi,c as wi,b as vi,a as _i}from"./m9elivgqkyz3hcka.js";import ji from"./g50ywpipiciqnnrt.js";import{W as gt}from"./n26tu9wxezmtzr3d.js";import{W as ki}from"./ngdk8aaa28n1ff0n.js";import{W as ms}from"./cb9cgv53vja8utnc.js";import{u as Ci}from"./loqw89wii3nszys1.js";import{h as Hn,j as Si,W as Mi}from"./g7o69yifmkuxfsll.js";import{A as Ni}from"./dmk30rbb7u1k7gl7.js";import{C as Un}from"./crheuewn890nts1d.js";import{s as Ti}from"./imrl18sy28ygoppx.js";import{d as $i}from"./kl7c6054usfnqmd4.js";import{g as Ei}from"./mia7qmdupqoji40k.js";import{c as Pi}from"./fg36ujrp67ag8qf3.js";import{C as Li,c as Ai}from"./ekc4a26ow669vmxe.js";import{a as Ri}from"./mdo0nu72resalvd9.js";import{g as Ii,A as st,c as Di,D as Fi,b as At,o as Oi,I as Vn,d as zi}from"./envm9t71cd7luwm9.js";import{u as Bi}from"./hg1hygbe4ieqyyvy.js";import{u as Wi}from"./mog17ocsx2bkw4q4.js";import{S as Hi}from"./lqxrayj6ap3vzwmb.js";import{S as Ui}from"./fka99unhlwy7iq80.js";import{s as Vi}from"./l8y86l5s35pa16ob.js";import{v as hs,C as qi,A as Gi,h as Zi,j as Yi,f as Xi,p as Ki,k as Ji,n as Qi,P as el,o as tl,q as sl,L as nl}from"./ih5unt2mq3ebrtkx.js";import{u as Fe,t as fs,r as Rt,g as le}from"./h1or1pd70sqvyo0k.js";import{c as qn}from"./d66h1wmdf2bqey2z.js";import{t as ps}from"./fna9z31n721lpf9f.js";const al=qn("ChevronDownFilled","1em",["M15.8 7.73c.28.3.27.78-.03 1.06l-5.25 5a.75.75 0 0 1-1.04 0l-5.25-5a.75.75 0 0 1 1.04-1.08L10 12.2l4.73-4.5a.75.75 0 0 1 1.06.02Z"]),ol=qn("ChevronLeftFilled","1em",["M12.27 15.8a.75.75 0 0 1-1.06-.03l-5-5.25a.75.75 0 0 1 0-1.04l5-5.25a.75.75 0 1 1 1.08 1.04L7.8 10l4.5 4.73c.29.3.28.78-.02 1.06Z"]);function rl({children:e,...t}){return s.jsxs(Ta,{...t,className:"decorated-link",children:[e,s.jsx("span",{"aria-hidden":!0,className:"ms-0.5 inline-block align-middle leading-none",children:s.jsx(Na,{className:"block h-[0.75em] w-[0.75em] stroke-current stroke-[0.75]"})})]})}const gs=({children:e,"data-start":t=null,"data-end":n=null,"data-is-last-node":a,"data-is-only-node":o,tag:r})=>{const{animationTiming:i,shouldAnimate:l,shouldHide:d,isDisabled:c,onComplete:u,onReady:m}=za({isMarker:!0,tag:r,children:e,start:t,end:n,isLastNode:a,isOnlyNode:o});return c||d?s.jsx(r,{"data-start":t,"data-end":n,className:S(d&&"hidden"),children:e}):s.jsx(r,{"data-start":t,"data-end":n,className:S(bt.marker,l?bt.animate:bt.hidden),onAnimationStart:()=>m(0),onAnimationEnd:()=>u(0),style:Ba(i),children:e})},il={p:e=>s.jsx(ge,{tag:"p",...e}),h1:e=>s.jsx(ge,{tag:"h1",...e}),h2:e=>s.jsx(ge,{tag:"h2",...e}),h3:e=>s.jsx(ge,{tag:"h3",...e}),h4:e=>s.jsx(ge,{tag:"h4",...e}),h5:e=>s.jsx(ge,{tag:"h5",...e}),h6:e=>s.jsx(ge,{tag:"h6",...e}),li:e=>s.jsx(gs,{tag:"li",isListItem:!0,...e}),hr:e=>s.jsx(gs,{tag:"hr",...e})};function ll(e){const t=e.split(`
`);dl(t);const n=t.pop();if(n===":"||n==="::")t.push("");else{const a=cl(n).trimEnd();a&&t.push(a)}return t.join(`
`)}function cl(e){if(!e||/^\s*-\s*([*_]+)?\s*$/.test(e))return"";const t=[];let n="",a=0;for(;a<e.length;){if(e[a]==="*"&&e[a+1]==="*"){n+="**",t.length&&t[t.length-1]==="**"?t.pop():t.push("**"),a+=2;continue}if(e[a]==="*"||e[a]==="_"){n+=e[a];const r=e[a];t.length&&t[t.length-1]===r?t.pop():t.push(r),a++;continue}if(e[a]==="["){const r=e[a];n+=r,t.push(r),a++;continue}if(e[a]==="]"){const r=e[a];n+=r,t.length&&t[t.length-1]==="["&&t.pop(),a++;continue}if(e[a]==="("&&e[a-1]==="]"){const r=e[a];n+=r,t.push(r),a++;continue}if(e[a]===")"){const r=e[a];n+=r,t.length&&t[t.length-1]==="("&&t.pop(),a++;continue}n+=e[a],a++}if(t.length===0)return e;let o=n.trimEnd();for(;t.length;){const r=t.pop();if(r==null)break;r==="("?o+=")":o.endsWith(r)?o=o.slice(0,-r.length).trimEnd():r==="["?o+="]()":o+=r}return o}function dl(e){let t=!1;for(let n=0;n<e.length;n++){const a=e[n];if(ml(a)){t=!t;continue}if(t)continue;const o=a.trim();if(o.startsWith(":::")&&o!==":::"){const r=o.indexOf("{");if(r===-1){const i=o.slice(3).trim();if(i.length>0&&!(i in or)){e[n]=":::";continue}const l=a.replace(/\s+$/,"");e[n]=l+"{}";continue}if(!ul(o,r)){const i=a.slice(0,a.indexOf("{")).replace(/\s+$/,"");e[n]=i+"{}"}}e.length>1&&e[e.length-1]===":::"&&e[e.length-2]===":::"&&e.splice(-2)}}function ul(e,t){let n=null,a=0,o=!1;for(let r=t;r<e.length;r++){const i=e[r];if(o){o=!1;continue}if(i==="\\"){o=!0;continue}if(n){i===n&&(n=null);continue}if(i==='"'||i==="'"){n=i;continue}if(i==="{"){a++;continue}if(i==="}"){if(a--,a===0)return!0;continue}}return!1}function ml(e){return e.trimStart().startsWith("```")}function hl({citation:e}){return s.jsx(bn,{side:"top",triggerButton:s.jsx("span",{className:"inline-flex items-center font-bold",children:s.jsx(T,{id:"ZNWtPG",defaultMessage:"{startChar}clipboard {icon}{endChar}",values:{startChar:"「",icon:s.jsx(Wa,{className:"mb-1 inline-block size-5"}),endChar:"」"}})}),className:"max-w-xl",children:s.jsxs("div",{className:"flex flex-col items-stretch gap-1",children:[s.jsx("div",{className:"flex justify-end border-b",children:s.jsx(wn,{onCopy:t=>Wt(e.text,void 0,t),buttonText:!0,textPosition:"left"})}),s.jsx("div",{children:e.text})]})})}function fl({citation:e,clientThreadId:t,nodeType:n}){const a=P(),o=Ee(t),r=Ha(e.screenshot_asset_pointer,o);return n==="containerDirective"&&a.formatMessage({id:"4/Vs6a",defaultMessage:"Cited Screenshot"}),s.jsx(bn,{side:"top",triggerButton:s.jsx("span",{className:"inline-flex items-center font-bold",children:s.jsx(T,{id:"qUxKU1",defaultMessage:"{startChar}screenshot {icon}{endChar}",values:{startChar:"「",icon:s.jsx(ht,{className:"mb-1 inline-block size-5"}),endChar:"」"}})}),className:"max-w-xl",children:r?s.jsx("img",{className:"w-xl max-w-screen",src:r,alt:a.formatMessage({id:"4/Vs6a",defaultMessage:"Cited Screenshot"})}):s.jsx("div",{className:"text-sm",children:s.jsx(T,{id:"BUdJTR",defaultMessage:"Screenshot not available"})})})}function Gn({clientThreadId:e,messageId:t,fileId:n,fileName:a,processedMarkdownInfo:o,isStandaloneAttachment:r}){const i=Ee(e),l=qe(e,j=>t?j?.tree.getNodeIfExists(t)?.message:void 0),d=h.useMemo(()=>{if(!l)return null;const j={content_type:rr.Text,parts:[`{{file:${n}}}`]},_={...l?.metadata,is_synthetic_share_message:!0,is_standalone_share_attachment:r};return _.content_references=o?.displayedContentReferences.filter(f=>f.type!=="debug")??[],_.citations=[],o&&(j.parts=[o.rawText],_.n7jupd_crefs=o.n7jupdCrefs),{...l,id:ka(),content:j,metadata:_}},[l,n,o,r]),c=h.useMemo(()=>{if(!(!l||!d||!i))return{previewMessage:d,clientThreadId:e,fileId:n,messageId:l.id,serverThreadId:i,isStandaloneAttachment:r,fileName:a}},[d,e,n,l,i,r,a]),u=Ua({odysseyShareIntent:c,clientThreadId:e}),[m,b]=h.useState(!1);return{onClick:h.useCallback(async()=>{b(!0),await u(),b(!1)},[b,u]),isLoading:m,isEnabled:!!c}}function pl({clientThreadId:e,messageId:t,fileId:n,fileName:a,processedMarkdownInfo:o}){const r=P(),{onClick:i,isLoading:l,isEnabled:d}=Gn({clientThreadId:e,messageId:t,fileId:n,fileName:a,processedMarkdownInfo:o,isStandaloneAttachment:!1});return d?s.jsx(Va,{onClick:i,label:r.formatMessage({id:"ConversationTurn.sharePostButtonTooltip",defaultMessage:"Share"}),icon:l?Ge:qa}):null}function gl(e){return e.endsWith(".md")}const xl=({citation:e,clientThreadId:t,messageId:n})=>{const[a,o]=h.useState(!1),r=Ee(t),i=Pe(),[l,d]=h.useState(null),c=h.useRef(null),u=h.useCallback(y=>{i.danger(y,{toastId:"ttom_file_citation_failed_to_download_file"})},[i]),m=e.file_id,b=B(),w=F(b,"3154019201"),x=w,j=Xt(),_=ns(!0,r,m,void 0,u),f=_?.data,k=_?.isPending||!1;h.useEffect(()=>{if(f?.status==="success"&&f.download_url){c.current?.abort();const y=new AbortController;c.current=y,o(!0),(async()=>{try{const C=await fetch(f.download_url,{headers:j?{}:Kt(),signal:y.signal});if(!C.ok)throw new Error(`HTTP ${C.status}`);d(await C.text())}catch(C){C.name!=="AbortError"&&i.danger("Failed to download file",{toastId:"ttom_file_citation_failed_to_download_file"})}finally{o(!1)}})()}return()=>{c.current?.abort()}},[f,i,j]);const v=h.useContext(ie),p=h.useMemo(()=>{if(l==null)return null;const C=(v?.message?.metadata?.content_references_by_file??{})[e.cite_key]??[],M=ir(l,C);let g=M.processedText;const N=M.displayedContentReferences??[],L=(v?.message?.metadata?.n7jupd_crefs_by_file??{})[e.cite_key]??[];return L.length>0&&(g=Ga(g,L)),{processedText:g,displayedContentReferences:N,n7jupdCrefs:L,rawText:l}},[l,v,e.cite_key]);return k||a?s.jsx(Ge,{className:"inline"}):!p||!v?.message?"[Could not display report]":s.jsx(ie.Provider,{value:{...v,contentReferences:p.displayedContentReferences,n7jupdCrefs:p.n7jupdCrefs},children:s.jsxs("div",{className:"border-token-border-light dark:border-token-bg-tertiary @container relative mx-[-16px] mt-4 mb-4 flex cursor-text flex-col items-start overflow-hidden rounded-[14px] border px-4 pt-6 pb-6 contain-inline-size sm:mx-[-32px] sm:rounded-[28px] sm:px-8 sm:shadow-sm",children:[s.jsx("div",{className:"w-full pt-1 pb-1 sm:pt-4 sm:pb-3",children:s.jsx(Za,{clientThreadId:t,componentOverrides:di,children:p.processedText})}),x&&s.jsx("div",{className:"flex",children:w&&s.jsx(pl,{clientThreadId:t,messageId:n,fileId:m,fileName:e.file_name,processedMarkdownInfo:p,isStandaloneAttachment:!1})})]})})},xs=(e,t)=>{const n=new yi(new URL("{{.assetPrefix}}/assets/walnut-worker-BC7H9rU-.js",import.meta.url),{type:"module"});return new Promise((a,o)=>{n.onmessage=r=>{n.terminate(),r.data.error?o(new Error(r.data.error)):a(r.data.protoBytes??new Uint8Array)},n.onerror=r=>{n.terminate(),o(r)},n.postMessage({bytes:e.buffer,ext:t},[e.buffer])})},yl="Walnut",bl={hash:"sha256-ENlCT/XOtKa5XNmAr1edtrYfS4gAvlJ8dYy9U0/hBrI=",fingerprinting:{"DocumentFormat.OpenXml.Framework.zzrbdxy160.wasm":"DocumentFormat.OpenXml.Framework.wasm","DocumentFormat.OpenXml.9kx12hc5a3.wasm":"DocumentFormat.OpenXml.wasm","Google.Protobuf.ymcrlw7ls4.wasm":"Google.Protobuf.wasm","System.Collections.Concurrent.q7k9997daq.wasm":"System.Collections.Concurrent.wasm","System.Collections.NonGeneric.e29je1lh17.wasm":"System.Collections.NonGeneric.wasm","System.Collections.Specialized.za90e6uca4.wasm":"System.Collections.Specialized.wasm","System.Collections.l48alw8ik0.wasm":"System.Collections.wasm","System.ComponentModel.Primitives.o70rgbr7as.wasm":"System.ComponentModel.Primitives.wasm","System.ComponentModel.TypeConverter.83539jv8ad.wasm":"System.ComponentModel.TypeConverter.wasm","System.ComponentModel.0n5errmvx8.wasm":"System.ComponentModel.wasm","System.Diagnostics.DiagnosticSource.g8ajmpm5cd.wasm":"System.Diagnostics.DiagnosticSource.wasm","System.IO.Compression.y5glqpjnb8.wasm":"System.IO.Compression.wasm","System.IO.Packaging.8th4tkd3a0.wasm":"System.IO.Packaging.wasm","System.Linq.Expressions.biujz7ou20.wasm":"System.Linq.Expressions.wasm","System.Linq.6btt3su4oy.wasm":"System.Linq.wasm","System.Memory.m6pzfzg6nf.wasm":"System.Memory.wasm","System.Net.Http.5n712yykv5.wasm":"System.Net.Http.wasm","System.Net.Primitives.0h7y3g6nqf.wasm":"System.Net.Primitives.wasm","System.ObjectModel.7q79mw545v.wasm":"System.ObjectModel.wasm","System.Private.CoreLib.p01w1sybmx.wasm":"System.Private.CoreLib.wasm","System.Private.Uri.4o2ojye61w.wasm":"System.Private.Uri.wasm","System.Private.Xml.Linq.trt4nj2tpp.wasm":"System.Private.Xml.Linq.wasm","System.Private.Xml.fx4cl1bai1.wasm":"System.Private.Xml.wasm","System.Runtime.InteropServices.JavaScript.yoksv99ly5.wasm":"System.Runtime.InteropServices.JavaScript.wasm","System.Text.RegularExpressions.jeufitb0vn.wasm":"System.Text.RegularExpressions.wasm","System.m0fu6d0eya.wasm":"System.wasm","System.Xml.Linq.qsgzs1hc1j.wasm":"System.Xml.Linq.wasm","Walnut.9ahrp7ytex.wasm":"Walnut.wasm","dotnet.native.349ud2l9o5.js":"dotnet.native.js","dotnet.native.1m7zpjvglu.wasm":"dotnet.native.wasm","dotnet.js":"dotnet.js","dotnet.runtime.st3wwc8rqy.js":"dotnet.runtime.js","icudt_CJK.tjcz0u77k5.dat":"icudt_CJK.dat","icudt_EFIGS.tptq2av103.dat":"icudt_EFIGS.dat","icudt_no_CJK.lfu7j35m59.dat":"icudt_no_CJK.dat"},jsModuleNative:{"dotnet.native.349ud2l9o5.js":"sha256-XXFP8ueCRZ/9neduBaSJOons2XLlYXa2NlP5FnhUKNQ="},jsModuleRuntime:{"dotnet.runtime.st3wwc8rqy.js":"sha256-oBRKHAqZUsvCRnCzkQfB7zc45cpKLNq2NKyrG10IKx8="},wasmNative:{"dotnet.native.1m7zpjvglu.wasm":"sha256-SeYXztl9ztFuzCJUoLlFf/EtB8wHKOelu6wAJ3/gi+w="},icu:{"icudt_CJK.tjcz0u77k5.dat":"sha256-SZLtQnRc0JkwqHab0VUVP7T3uBPSeYzxzDnpxPpUnHk=","icudt_EFIGS.tptq2av103.dat":"sha256-8fItetYY8kQ0ww6oxwTLiT3oXlBwHKumbeP2pRF4yTc=","icudt_no_CJK.lfu7j35m59.dat":"sha256-L7sV7NEYP37/Qr2FPCePo5cJqRgTXRwGHuwF5Q+0Nfs="},coreAssembly:{"System.Private.CoreLib.p01w1sybmx.wasm":"sha256-18HeJL9OcGuyT9IVV5fEjllvMuAKwWG5goaCYZJDU6A=","System.Runtime.InteropServices.JavaScript.yoksv99ly5.wasm":"sha256-PpVo+nXFFVzcQmMcwj3t/pX3t8Gc+Y2rLawKTqz0jn8="},assembly:{"DocumentFormat.OpenXml.Framework.zzrbdxy160.wasm":"sha256-gewmYP6VBCfFJUjxGAmejSGxmz8pJfGHQf0NgrM6MZU=","DocumentFormat.OpenXml.9kx12hc5a3.wasm":"sha256-13lkooL5OK24XESOo9Cmv20rnNku0r0tWucBcL1Ljqw=","Google.Protobuf.ymcrlw7ls4.wasm":"sha256-ut3yq+p97V1SbQ9Zc0baUM07p9J1xZIfW02l4S3Vp5M=","System.Collections.Concurrent.q7k9997daq.wasm":"sha256-luuh8QlNVgtYEcAi6N+VXZUjrLjK5Mohr7YV2Qo44KI=","System.Collections.NonGeneric.e29je1lh17.wasm":"sha256-Wkm1IwLgktv0ufFAqQ2dmijAlJQmf+Fp4FmTlgILYXk=","System.Collections.Specialized.za90e6uca4.wasm":"sha256-5UpgSBxjmzatkMdip0WZHB3ZJJsd+zea3niJtfK/Xco=","System.Collections.l48alw8ik0.wasm":"sha256-pfzSuOk29FRrZOX567k+jaeA3dH92A/XVM7vtYtGhXg=","System.ComponentModel.Primitives.o70rgbr7as.wasm":"sha256-LDo5YlVF1j7HX6cIR9g2sO5xXkPw31mtOO8S6NnbqJc=","System.ComponentModel.TypeConverter.83539jv8ad.wasm":"sha256-fP45xSdHQOHnnNgF9GAkhkSdiLDsVHb3T/01W4ytVW8=","System.ComponentModel.0n5errmvx8.wasm":"sha256-DHujPeYswdt0JOBw03JC11hmqQ+Vtb1K9fkbgtDLtTM=","System.Diagnostics.DiagnosticSource.g8ajmpm5cd.wasm":"sha256-cMsx1BaqBdShCb2hCIIcg1cu8DpCR6mybVTUh61tCWM=","System.IO.Compression.y5glqpjnb8.wasm":"sha256-6mwr7Ug6Xh7nYE5sSoUjQtV7ehgyUiTuL+IETvfEL4U=","System.IO.Packaging.8th4tkd3a0.wasm":"sha256-1C+I5A7ESuL28X57RP+FiTL8ayuTe86SmJE6NSg4dQA=","System.Linq.Expressions.biujz7ou20.wasm":"sha256-M6AwJILP8bI0CD1p7jb1rT7DBE2E2SxUNiT+AArcV/A=","System.Linq.6btt3su4oy.wasm":"sha256-ouzI51Ta1wlktuj2h6VgfMn7RDDjWweSZ7nHHHRnV8k=","System.Memory.m6pzfzg6nf.wasm":"sha256-PsWHMVtxDG4tlLs5Ehnac6R7c/P12MhR2Hkn8UhYqfY=","System.Net.Http.5n712yykv5.wasm":"sha256-8QauHTjEWUMCHnUrtqi7oyjYh442Ih49nJaVLCyUNck=","System.Net.Primitives.0h7y3g6nqf.wasm":"sha256-rGIYM/g7mFHB4tUKXxzKAMTdeOGYJ8NmnYQ66r9vFwE=","System.ObjectModel.7q79mw545v.wasm":"sha256-XzW0DP5J4D5HhpBC9+IEXalmi7K0txtxRQRQloOFshI=","System.Private.Uri.4o2ojye61w.wasm":"sha256-fMF0tbuaB2aa9IXoBrucZrpL8wgrIr9KleX8BZeFpHE=","System.Private.Xml.Linq.trt4nj2tpp.wasm":"sha256-R42st1IgbrLRA1kwuI/YvAOjfn0pqcO7Y/eQZbtn1gg=","System.Private.Xml.fx4cl1bai1.wasm":"sha256-86zH8VBnIMhKsGkh8VEmfC3+Vm0QGzPiHxheWBPJLQQ=","System.Text.RegularExpressions.jeufitb0vn.wasm":"sha256-VSLyK4otYaCqpu8GYBmxEYokWbrAs9m/DliyakK7KMU=","System.m0fu6d0eya.wasm":"sha256-hkGLo/MuT/FJ0Xf4XUL0D2VA4dZV532GHNB1JicxLko=","System.Xml.Linq.qsgzs1hc1j.wasm":"sha256-yo+J3RWIIHIiwAhqsR9JizNkH/+hd3auB44RBmvvLoI=","Walnut.9ahrp7ytex.wasm":"sha256-v9pRmljtfvGlUOu8uLhOjO1ENn+tlaukn2WMafi2jsA="}},wl=0,vl=!0,_l="sharded",jl={mainAssemblyName:yl,resources:bl,debugLevel:wl,linkerEnabled:vl,globalizationMode:_l};let vt=null;async function kl(){const e=await fi.withConfig(jl).withResourceLoader((n,a,o,r)=>n==="dotnetjs"?o:new URL(o,location.href).origin!==location.origin?fetch(o,{credentials:"omit",integrity:r}):o).create(),t=e.getConfig().mainAssemblyName;return t?e.getAssemblyExports(t):null}function Cl(){return h.useMemo(()=>(vt||(vt=kl()),vt),[])}const Sl=Ln(()=>Jt(()=>import("./k0o2yofpsl49x5ud.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])).then(e=>e.WalnutMiniPlayer)),Ml=({citation:e,clientThreadId:t,messageId:n})=>{const a=Cl(),[o,r]=h.useState(!1),[i,l]=h.useState(null),[d,c]=h.useState(!1),u=!!h.useContext(ie)?.message.metadata?.is_standalone_share_attachment,m=Ya(),{presentationMap:b,updatePresentationMap:w,open:x}=pi(),j=B(),_=Ee(t),f=F(j,"3154019201")&&!!_,k=F(j,"638971034"),v=lr(j,"2888003541").value,p=Number(v?.max_bytes??3e7),y=Pe(),C=h.useRef(null),M=h.useCallback(D=>{y.danger(D,{toastId:"w_failed_to_download_file"})},[y]),g=!!e.file_id,N=ns(!1,t,e.file_id,()=>{},M),$=b[e.file_id]?.presentation,L=b[e.file_id]?.workbook,A=h.useCallback(async D=>{if(t!==void 0){D.preventDefault();const{data:q}=await N.refetch();if(q===void 0||q?.status!=="success"){y.danger("Failed to download file");return}const I=document.createElement("a");I.href=q.download_url,I.click()}},[t,N,y]),{refetch:R}=N,E=Xt();h.useEffect(()=>{C.current?.abort();const D=new AbortController;return C.current=D,r(!0),(async()=>{let q=!1;try{const{data:I}=await R();if(I===void 0||I?.status!=="success"){y.danger("Failed to download file");return}const z=await fetch(I.download_url,{headers:E?{}:Kt(),signal:D.signal});if(!z.ok)throw new Error(`HTTP ${z.status}`);const ue=await z.blob();if(p!==0&&ue.size>p){c(!0),l("fileTooLarge"),q=!0;return}const K=new Uint8Array(await ue.arrayBuffer()),U=us(e.file_name)??"pptx";if(U==="pptx"){let G;if(k)G=await xs(K,U);else{const Y=await a;if(!Y)return;G=Y.PptxReader.ExtractSlidesProto(K,!1)}const J=gi.decode(G);w(e.file_id,{fileBlob:ue,fileName:e.file_name,presentation:J,workbook:null,document:null,selectedSlideIdx:0,selectedSheetIdx:0})}else{let G;if(k)G=await xs(K,U);else{const Y=await a;if(!Y)return;G=Y.XlsxReader.ExtractXlsxProto(K,!1)}const J=xi.decode(G);w(e.file_id,{fileBlob:ue,fileName:e.file_name,presentation:null,workbook:J,document:null,selectedSlideIdx:0,selectedSheetIdx:0})}}catch(I){I.name!=="AbortError"&&(c(!0),Le.addError(I,{file_id:e.file_id}))}finally{r(!1),m&&!q&&x(e.file_id)}})(),()=>{C.current?.abort()}},[R,y,w,e.file_name,e.file_id,m,x,p,E,a,k]);function W(D){D.preventDefault(),x(e.file_id)}const{onClick:se,isLoading:ce,isEnabled:ne}=Gn({clientThreadId:t,messageId:n,fileId:e.file_id,fileName:e.file_name,processedMarkdownInfo:null,isStandaloneAttachment:!0}),de=u&&!m,O=us(e.file_name);return s.jsxs("div",{className:S("border-token-border-light flex max-w-[calc(0.8*var(--thread-content-max-width,40rem))] flex-col overflow-hidden rounded-lg border",u&&"mx-auto my-0"),children:[s.jsxs("div",{className:"text-token-text-secondary border-token-border-light flex flex-row justify-between gap-4 border-b p-2",children:[s.jsxs("div",{className:"flex flex-row items-center gap-2 overflow-hidden",children:[s.jsx(ui,{fileName:e.file_name}),s.jsx("div",{className:"truncate text-sm font-medium",children:O==="pptx"?s.jsx(T,{id:"HTIcmf",defaultMessage:"Presentation"}):s.jsx(T,{id:"pftlup",defaultMessage:"Spreadsheet"})})]}),s.jsxs("div",{className:"text-token-text-tertiary flex flex-row items-center",children:[!de&&s.jsxs(s.Fragment,{children:[g&&s.jsx("button",{className:"hover:text-token-text-secondary hover:bg-token-bg-tertiary rounded-full p-1",onClick:A,children:s.jsx(vn,{})}),s.jsx("button",{className:"hover:text-token-text-secondary hover:bg-token-bg-tertiary disabled:text-token-text-tertiary rounded-full p-1 disabled:cursor-not-allowed disabled:bg-transparent",disabled:!$&&!L,onClick:W,children:s.jsx(hi,{})})]}),f&&!!n&&ne&&s.jsx("button",{className:"hover:text-token-text-secondary hover:bg-token-bg-tertiary rounded-full p-1",disabled:!ne,onClick:se,children:ce?s.jsx(Ge,{}):s.jsx(Nl,{})})]})]}),s.jsxs("div",{className:"bg-token-bg-secondary group relative p-2",children:[s.jsx(Sl,{walnutId:e.file_id,isLoading:o,isError:d,isInShareModal:de,errorMessage:i,handleDownloadClick:A}),de&&s.jsx("div",{className:"absolute end-5 top-46 z-10 inline-flex flex-shrink-0 items-end justify-end",children:s.jsx(Xa,{className:S("inline h-4 w-24 text-end")})})]})]})},Nl=({className:e})=>s.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",className:e,children:[s.jsx("path",{d:"M3 12.4428V12.2806C3 11.9219 3.2843 11.631 3.63497 11.631C3.98563 11.631 4.26993 11.9219 4.26993 12.2806V12.4428C4.26993 13.1372 4.2708 13.6193 4.3007 13.994C4.33 14.3609 4.38426 14.5675 4.46108 14.7218L4.52821 14.8459C4.69655 15.1266 4.93812 15.3556 5.22657 15.5061L5.35059 15.5604C5.48786 15.6107 5.6688 15.6476 5.938 15.6701C6.30417 15.7008 6.77519 15.7007 7.45408 15.7007H12.546C13.2246 15.7007 13.6959 15.7008 14.0621 15.6701C14.4204 15.6402 14.6226 15.5846 14.7735 15.5061L14.8946 15.4364C15.169 15.2642 15.3929 15.0169 15.5399 14.7218L15.593 14.595C15.6421 14.4546 15.6782 14.2692 15.7003 13.994C15.7301 13.6193 15.73 13.1372 15.73 12.4428V12.2806C15.73 11.922 16.0145 11.6312 16.3651 11.631C16.7157 11.631 17 11.9219 17 12.2806V12.4428C17 13.1158 17.0006 13.6601 16.9655 14.0999C16.9342 14.4916 16.8722 14.8443 16.7343 15.1731L16.6709 15.3123C16.4174 15.8213 16.0318 16.2469 15.5585 16.544L15.3506 16.6632C14.9909 16.8507 14.6028 16.9281 14.1655 16.9646C13.7356 17.0006 13.2038 17 12.546 17H7.45408C6.79615 17 6.26438 17.0006 5.8345 16.9646C5.45207 16.9327 5.10749 16.8699 4.78649 16.729L4.65035 16.6632C4.1528 16.4038 3.73604 16.0094 3.44569 15.5251L3.32914 15.3123C3.14585 14.9444 3.07023 14.5473 3.03451 14.0999C2.9994 13.6601 3 13.1158 3 12.4428Z"}),s.jsx("path",{d:"M9.99993 13.2544C10.3505 13.2544 10.6348 12.9635 10.6348 12.6047V5.218L12.7337 7.36545L12.8335 7.44845C13.0799 7.61506 13.4146 7.58749 13.6316 7.36545C13.8486 7.14342 13.8756 6.80101 13.7127 6.54884L13.6316 6.44677L10.4493 3.19088C10.3302 3.06897 10.1683 3 9.99993 3C9.8316 3.0001 9.67044 3.06906 9.55138 3.19088L6.36815 6.44677C6.12048 6.70037 6.12057 7.11179 6.36815 7.36545C6.58526 7.58755 6.92077 7.61523 7.1673 7.44845L7.26707 7.36545L9.36491 5.21897V12.6047C9.36491 12.9634 9.64934 13.2542 9.99993 13.2544Z"})]}),Tl=new Set(["jpg","jpeg","png","gif","webp","svg"]),$l=e=>{const t=e.split(".").pop();return t?Tl.has(t):!1};function El({citation:e,clientThreadId:t,messageId:n}){const a=cr(),o=dr(),r=h.useRef(a!==ds.Research);h.useEffect(()=>{!r.current&&a===ds.Research&&(r.current=!0,o(null))},[a,o]);const i=B();return mi(e.file_name)&&F(i,"3392860057")?s.jsx(Ml,{citation:e,clientThreadId:t,messageId:n,children:e.label??e.file_name}):gl(e.file_name)?s.jsx(xl,{citation:e,clientThreadId:t,messageId:n}):s.jsx(Pl,{citation:e,clientThreadId:t,messageId:n})}function Pl({citation:e,clientThreadId:t}){const n=Ee(t),a=Pe(),o=h.useCallback(i=>{a.danger(i,{toastId:"fcoa_renderer_failed_to_download_file"})},[a]),{data:r}=ns(!0,n,e.file_id,void 0,o);return $l(e.file_name)&&r?.download_url?s.jsx("img",{src:r?.download_url,alt:e.label??e.file_name,className:"max-h-[350px] max-w-screen"}):s.jsx("a",{href:r?.download_url,children:e.label??e.file_name})}function Ll({citationIndex:e,clientThreadId:t,nodeType:n,messageId:a}){const o=parseInt(e,10),r=h.useContext(ie);if(!r)return null;const i=r.n7jupdCrefs?.[o];if(!i)return null;switch(i.type){case"clipboard":return s.jsx(hl,{citation:i});case"computer_output":return s.jsx(fl,{citation:i,clientThreadId:t,nodeType:n});case"file":return s.jsx(El,{citation:i,clientThreadId:t,messageId:a});case"invalid":return null}}function Al({path:e,lineRangeStart:t,lineRangeEnd:n,gitUrl:a}){const[o,r]=h.useState(!1),i=h.useContext(gt),l=h.useRef(null),d=h.useRef(null),c=h.useRef(null),u=()=>{c.current&&(clearTimeout(c.current),c.current=null),r(!0)},m=()=>{c.current=window.setTimeout(()=>{r(!1)},200)};if(!e)return null;const b=i?.fileSnapshots.find(x=>x.path===e);if(!b)return null;const w=Il(t,n,b);return w.length?s.jsxs(Ht,{open:o,onOpenChange:r,children:[s.jsx(Ut,{asChild:!0,onMouseEnter:u,onMouseLeave:m,children:s.jsx("span",{ref:l,className:"bg-token-bg-secondary text-token-text-secondary mx-0.5 inline-flex aspect-square size-min cursor-default items-center justify-center rounded-full p-1",children:s.jsx(ji,{className:"size-[10px]"})})}),s.jsx(Vt,{children:s.jsx(qt,{ref:d,className:"z-50 focus:outline-none",side:"right",onMouseEnter:u,onMouseLeave:m,onOpenAutoFocus:x=>x.preventDefault(),children:s.jsx(Rl,{snapshot:b,snippetLines:w,lineRangeStart:t,lineRangeEnd:n,gitUrl:a})})})]}):null}function Rl({snapshot:e,snippetLines:t,lineRangeStart:n,lineRangeEnd:a,gitUrl:o}){const r=e.path.split(".").pop()??"sh",i=t.reduce((d,c)=>{if(c.trim()==="")return d;const u=c.match(/^\s*/),m=u?u[0].length:0;return d===-1?m:Math.min(d,m)},-1),l=t.map(d=>i>0?d.slice(i):d).join(`
`);return s.jsxs("div",{className:"bg-token-bg-primary border-token-border-default mx-4 flex max-h-[600px] flex-col rounded-2xl border px-2 pt-2 pb-4 shadow-[0px_4px_16px_0px_rgba(0,0,0,0.05)] focus:outline-none dark:shadow-none",children:[l&&s.jsx(Ka,{wrapperClassName:"rounded-lg !bg-token-bg-tertiary !border-none mb-3 max-h-[400px] overflow-auto text-xs w-[600px] max-w-full",codeContainerClassName:"!p-2",language:r,content:l,showActionBar:!1}),s.jsxs("div",{className:"grid w-full grid-cols-[minmax(0,1fr)_auto] items-center justify-between gap-1 px-2 text-sm",children:[e.path,s.jsxs("div",{className:"text-token-text-tertiary flex items-center gap-1 whitespace-nowrap",children:[s.jsx(T,{id:"wham.citation.file.lineRange",defaultMessage:"Lines {lineRangeStart}-{lineRangeEnd}",values:{lineRangeStart:n,lineRangeEnd:a}}),o&&s.jsx("a",{className:"group flex w-full items-center gap-1 p-1",href:o,target:"_blank",rel:"noopener noreferrer",children:s.jsx(ur,{className:"icon-xs hover:text-token-text-primary"})})]})]})]})}function Il(e,t,n){if(n.contents){const i=n.contents.split(`
`),l=Math.max(0,e-1),d=t?Math.min(i.length,t):l+1;return i.slice(l,d)}const a=n.line_range_contents?.find(i=>Dl(i,e,t));if(!a)return[];const o=Math.max(e-a.line_range_start,0),r=o+(t-e+1);return a.content.slice(o,r)}function Dl(e,t,n){return t<e.line_range_start?!1:!(n>e.line_range_end)}function Fl({assetPointer:e}){const t=h.useContext(gt),n=P(),a=t?.imagePointers.find(i=>i.asset_pointer===e),o=_n({asset:{content_type:An.ImageAssetPointer,asset_pointer:a?.asset_pointer??"",size_bytes:a?.size_bytes??0,width:a?.width??0,height:a?.height??0}});if(!a||!o.data?.url)return null;const r=n.formatMessage({id:"wham.contentReference.imageAlt",defaultMessage:"Captured screenshot"});return s.jsx(Ja,{src:o.data.url,alt:r,className:"max-h-[250px] max-w-[250px]",children:s.jsx(Qa,{src:o.data.url,alt:r,width:a.width,height:a.height,className:"max-h-[250px] max-w-[250px] object-contain"})})}function Ol(){const e=Rn.getItem(In.ProposedTasks);return e&&typeof e=="object"?e:{}}const ys=mr(e=>({tasks:Ol(),store(t){e(n=>{const a={...n.tasks,[t.contentId]:t};return Rn.setItem(In.ProposedTasks,a),{tasks:a}})}}));function zl({title:e,prompt:t,environmentId:n,branch:a,contentId:o,hasHitRateLimit:r}){const[i,l]=h.useState(!1),d=hr(),{setEnvironmentId:c,setBranch:u}=Hn(),{refetch:m}=Si(),b=P(),w=Pe(),x=ys(p=>p.tasks[o]),j=ys(p=>p.store),{mutate:_,isPending:f}=mn({mutationFn:()=>Mi.createNewTask(n,a,t,!1).catch(p=>{throw w.danger({id:"wham.whamComposer.failedToCreateTask",defaultMessage:"Failed to create task",description:"Toast text shown when a task failed to create."},{id:`suggestion-${o}`,duration:5,hasCloseButton:!0,toastId:"wham_proposed_task_failed_to_create_task"}),p}),onSuccess:async p=>{await m(),k(p)}}),k=p=>{try{const y=p.task.id,C=p.turn.id,M=`/codex/tasks/${y}`;j({contentId:o,prompt:t,scheduledTaskId:y,turnId:C,url:M}),l(!1)}catch{}},v=!n||!a||f||r;return s.jsxs("div",{className:S("mt-1 mb-3 flex w-full items-center rounded-xl px-3 py-3",x?"bg-token-bg-secondary border border-transparent":"bg-token-bg-primary border-token-border-default border shadow-[0px_1px_1px_0px_rgba(0,0,0,0.05)]"),children:[s.jsxs("div",{className:S("group flex flex-1 items-center gap-1",!x&&"-my-3 py-3",!x&&!v&&"cursor-pointer"),onClick:()=>{v||x||(c(n),u(a),l(!0),ms.recordProposedTaskClicked("edit"))},children:[s.jsxs("div",{className:"flex flex-col gap-0.5",children:[s.jsx("span",{className:"text-token-text-tertiary text-xs",children:s.jsx(T,{id:"wham.whamProposedTask.title",defaultMessage:"Suggested task"})}),s.jsx("span",{className:S("text-sm font-medium",x&&"text-token-text-tertiary"),children:e})]}),!v&&!x&&s.jsx(eo,{className:"icon-sm text-token-text-secondary mb-0.5 cursor-pointer self-end opacity-0 transition-opacity group-hover:opacity-100"})]}),s.jsx("div",{className:"flex items-center justify-end gap-2 text-xs",children:x?s.jsx(ee,{size:"small",color:"secondary",as:"a",to:x?.url,openNewTab:!0,children:s.jsx("span",{className:"text-token-text-primary font-medium",children:s.jsx(T,{id:"lwqFNG",defaultMessage:"View task"})})}):s.jsx(Bl,{prompt:r?b.formatMessage({id:"wham.proposedTask.hitRateLimit",defaultMessage:"You have reached your rate limit"}):t,tooltipEnabled:!x&&!i,children:s.jsx(ee,{size:"small",color:"secondary",disabled:v,onClick:()=>{ms.recordProposedTaskClicked("create"),_()},children:s.jsxs("div",{className:"flex items-center gap-0.5",children:[s.jsx(T,{id:"b2N2Y8",defaultMessage:"Start task"}),f?s.jsx(Ge,{className:"icon-xs me-[2px]"}):s.jsx(to,{className:"icon-sm"})]})})})}),s.jsx(ye.Root,{testId:"modal-task-stub-composer",isOpen:i,onClose:()=>l(!1),children:s.jsx(ye.Overlay,{children:s.jsxs(ye.Content,{className:"flex max-w-3xl! items-center justify-center px-12 py-4 focus:outline-hidden",size:"normal",removeBackground:!0,onEscapeKeyDown:p=>{p.stopPropagation(),l(!1)},children:[s.jsxs(fr,{children:[s.jsx(pr,{children:s.jsx(T,{id:"wham.proposedTaskModel.title",defaultMessage:"Kick off a new Codex task"})}),s.jsx(gr,{children:s.jsx(T,{id:"wham.proposedTaskModel.description",defaultMessage:"Codex can propose new follow up tasks"})})]}),s.jsx(he.div,{initial:{opacity:0,translateY:20},animate:{opacity:1,translateY:0},transition:{duration:d?0:.25},className:"w-full",children:s.jsxs("div",{className:"flex flex-col items-center gap-8",children:[s.jsx("h1",{className:"text-token-text-primary dark text-[28px] font-semibold",children:s.jsx(T,{id:"wham.proposedTaskModal.title",defaultMessage:"Edit suggested task"})}),s.jsx(Wl,{prompt:t,onSuccess:k})]})})]})})})]})}function Bl({prompt:e,tooltipEnabled:t,children:n}){return t?s.jsx(Z,{side:"right",label:s.jsx("span",{className:"block p-2 text-start whitespace-pre-wrap",children:e}),wide:!0,children:n}):n}function Wl({prompt:e,onSuccess:t}){const{composerController:n}=Ci();return h.useEffect(()=>{xr(yr(n),e.trimEnd())},[n,e]),s.jsx(br.Provider,{value:n,children:s.jsx(ki,{isBigBoxMode:!0,expanded:!0,disableDuringSubmit:!0,onSuccess:t})})}function Hl({title:e,prompt:t}){const n=h.useContext(gt),a=Hn(r=>r.getRateLimit()?.remaining===0),o=h.useMemo(()=>Ul(`${n?.taskId}:${e}:${t}`),[n?.taskId,e,t]);return!n||!n.environmentId||!n.branch?null:s.jsx(zl,{title:e,prompt:t,environmentId:n.environmentId,branch:n.branch,contentId:o,hasHitRateLimit:a})}function Ul(e){let t=5381;for(let n=0;n<e.length;n++)t=(t<<5)+t^e.charCodeAt(n);return(t>>>0).toString(16).padStart(8,"0")}function Vl({chunkId:e,lineRangeStart:t,lineRangeEnd:n}){const[a,o]=h.useState(!1),i=h.useContext(gt)?.terminalMessageContents.find(x=>x.includes(e)),l=h.useRef(null),d=h.useRef(null),c=h.useRef(null);if(!i)return null;const u=Gl(i);if(!u)return null;const m=u.output.slice(t-1,n);if(!m.some(x=>!!x.length))return null;const b=()=>{c.current&&(clearTimeout(c.current),c.current=null),o(!0)},w=()=>{c.current=window.setTimeout(()=>{o(!1)},200)};return s.jsxs(Ht,{open:a,onOpenChange:o,children:[s.jsx(Ut,{asChild:!0,onMouseEnter:b,onMouseLeave:w,children:s.jsx("span",{ref:l,className:"bg-token-bg-secondary text-token-text-secondary mx-0.5 inline-flex aspect-square size-min cursor-default items-center justify-center rounded-full p-1",children:s.jsx(so,{className:"size-[10px]"})})}),s.jsx(Vt,{children:s.jsx(qt,{ref:d,className:"z-50 focus:outline-none",side:"right",onMouseEnter:b,onMouseLeave:w,onOpenAutoFocus:x=>x.preventDefault(),children:s.jsx("div",{className:"max-h-[500px] max-w-screen px-4",children:s.jsx(ql,{lines:m,lineRangeStart:t,lineRangeEnd:n})})})})]})}function ql({lines:e,lineRangeStart:t,lineRangeEnd:n}){return s.jsxs("div",{className:"bg-token-bg-primary border-token-border-default mx-4 flex flex-col overflow-auto rounded-2xl border px-2 pt-2 pb-3 shadow-[0px_4px_16px_0px_rgba(0,0,0,0.05)] focus:outline-none dark:shadow-none",children:[s.jsx(Ni,{className:"bg-token-sidebar-surface-primary dark mb-2.5 max-h-[200px] w-full overflow-auto rounded-lg p-3 font-mono text-xs whitespace-pre text-white dark:border dark:border-white/10",children:e.join(`
`)}),s.jsx("div",{className:"flex w-full justify-end gap-1 px-2 text-sm",children:s.jsx("span",{className:"text-token-text-tertiary",children:s.jsx(T,{id:"wham.citation.terminal.lineRange",defaultMessage:"Lines {lineRangeStart}-{lineRangeEnd}",values:{lineRangeStart:t,lineRangeEnd:n}})})})]})}function Gl(e){try{const t=JSON.parse(e);return!("chunk_id"in t)||typeof t.chunk_id!="string"||!("session_name"in t)||typeof t.session_name!="string"||!("start_line_no"in t)||typeof t.start_line_no!="number"?null:"output"in t?t:null}catch{return null}}var ot=(e=>(e.STANDARD="standard",e.EMAIL="email",e.UNKNOWN="unknown",e))(ot||{});function Zl(e){return Object.values(ot).includes(e)?e:"unknown"}function Yl({content:e,subject:t,recipient:n,clientThreadId:a,messageId:o}){const r=P();return s.jsx("button",{className:"hover:bg-token-interactive-bg-accent-primary-hover ms-1 rounded-full bg-[var(--theme-submit-btn-bg)] p-1 text-white","aria-label":r.formatMessage({id:"DIfdnM",defaultMessage:"Open in email client"}),onClick:()=>{be.logEventWithStatsig("ChatGPT Writing Block Email Send Button Clicked","chatgpt_writing_block_email_send_button_clicked",{...pt({clientThreadId:a,messageId:o})});const i=encodeURIComponent(t),l=encodeURIComponent(wr(e));window.open(`mailto:${n}?subject=${i}&body=${l}`,"_blank")},children:s.jsx(Z,{label:s.jsx(T,{id:"EmailSendButton.tooltip",defaultMessage:"Open in email client"}),children:s.jsx(no,{className:"icon-md block rotate-45 text-[var(--theme-submit-btn-text)]"})})})}const Xl=({markdown:e,onChange:t,isDisabled:n,className:a})=>{const o=h.useRef(null),r=h.useRef(e),i=h.useMemo(()=>{const c=new ao({codeBlockStyle:"fenced",headingStyle:"atx",bulletListMarker:"-"});return c.use(oo),c},[]),l=h.useCallback(async c=>{const u=await vr().use(_r).use(jr,{singleTilde:!1}).use($a).use(ro).use(Ea).process(c??"");return String(u)},[]);h.useEffect(()=>{if(!o.current)return;const u=o.current.innerHTML.trim()!=="";if(e===r.current&&u)return;let m=!1;return(async()=>{const w=await l(e);!o.current||m||(o.current.innerHTML!==w&&(o.current.innerHTML=w),r.current=e)})(),()=>{m=!0}},[e,l]);const d=()=>{if(!o.current)return;const c=o.current.innerHTML,u=i.turndown(c);r.current=u,t(u)};return s.jsx("div",{className:"px-4 sm:px-6",children:s.jsx("div",{ref:o,className:S(["markdown","prose","dark:prose-invert","w-full","break-words","focus:outline-none",a??""]),contentEditable:!n,suppressContentEditableWarning:!0,onInput:d})})},Zn=e=>{"use forget";const t=Ve.c(18),{isInlineWritingBlockEditEnabled:n,children:a,writingBlock:o,onChange:r,isStreaming:i,showOriginal:l,originalContent:d}=e,[c,u]=h.useState(!1),[m,b]=h.useState(l?d:o.content),w=h.useRef(l),x=h.useRef(null);let j,_;t[0]!==d||t[1]!==l||t[2]!==o.content?(j=()=>{if(w.current!==l)return;const p=l?d:o.content;b(p)},_=[o.content,d,l],t[0]=d,t[1]=l,t[2]=o.content,t[3]=j,t[4]=_):(j=t[3],_=t[4]),h.useEffect(j,_);let f,k;t[5]!==d||t[6]!==l||t[7]!==o.content?(f=()=>{if(w.current!==l)return u(!0),x.current&&window.clearTimeout(x.current),x.current=window.setTimeout(()=>{b(l?d:o.content),u(!1),w.current=l,x.current=null},450),()=>{x.current&&(window.clearTimeout(x.current),x.current=null)}},k=[l,d,o.content],t[5]=d,t[6]=l,t[7]=o.content,t[8]=f,t[9]=k):(f=t[8],k=t[9]),h.useEffect(f,k);let v;return t[10]!==a||t[11]!==m||t[12]!==n||t[13]!==i||t[14]!==c||t[15]!==r||t[16]!==l?(v=s.jsx(s.Fragment,{children:n?s.jsx(Xl,{markdown:m,onChange:r,isDisabled:i||l||c,className:S([l?"cursor-default":"cursor-text","transition-opacity duration-450 ease-in-out",c?"opacity-0":"opacity-100"])}):s.jsx("div",{className:"px-4 sm:px-6",children:a})}),t[10]=a,t[11]=m,t[12]=n,t[13]=i,t[14]=c,t[15]=r,t[16]=l,t[17]=v):v=t[17],v};function Kl({content:e,clientThreadId:t,messageId:n}){const a=B(),o=P(),r=Pe(),[i,l]=h.useState(!1),d=kr();return{handleCopy:async u=>{if(i)return;be.logEventWithStatsig("ChatGPT Writing Block Copy Button Clicked","chatgpt_writing_block_copy_button_clicked",{...pt({clientThreadId:t,messageId:n})});const m=await Ti(e),b=Ee(t);e!=null&&b!=null&&n!=null&&io(a,{type:"copy",source:"mouse",location:"writing-block",selectedText:m,messageId:n,serverThreadId:b});let w={"text/plain":m};try{w=pn(m,[])}catch(x){Le.addError(x)}Wt(w,r,u),l(!0),d(()=>l(!1),2e3)},Icon:i?Gt:jn,copyLabel:o.formatMessage({id:"D5UU6P",defaultMessage:"Copy"})}}function Jl({clientThreadId:e,messageId:t,content:n,onlyIcon:a=!1}){const{handleCopy:o,copyLabel:r}=Kl({clientThreadId:e,messageId:t,content:n}),i=!Qt(),l=a||i;return s.jsx(wn,{onCopy:o,className:"px-1.5 py-1",iconClassName:S("icon-md",!l&&"hidden"),iconOnly:l,buttonText:l?void 0:r})}function Ql({serverThreadId:e,messageId:t,index:n,title:a}){const o=Pe(),r=P(),[i,l]=h.useState(!1);if(!e)return null;const d=r.formatMessage({id:"writingblock.downloadFileError",defaultMessage:"Download failed. Please try again."});async function c(u){l(!0);try{const m=await es.safePost("/export_doc/writing_block",{requestBody:{conversation_id:e,message_id:t,index:n,export_type:u},skipJsonTransform:!0});m.ok||o.danger(d);const b=await m.blob(),w=m.headers.get("Content-Disposition"),x=Ei(w)??`${(a??"Export").replaceAll("/","-")}.${u}`;$i(b,x)}catch(m){Le.addError(m,{tags:["type:writing_block_download_button",`export_type:${u}`]}),o.danger(d)}finally{l(!1)}}return s.jsxs(xe.Root,{children:[s.jsx(xe.BasicTrigger,{asChild:!0,children:s.jsx("button",{className:"flex items-center gap-1 px-1.5 py-1 select-none",disabled:i,children:s.jsx(Z,{label:s.jsx(T,{id:"WritingBlockDownloadButton.downloadTooltip",defaultMessage:"Download"}),children:i?s.jsx(Un,{size:20}):s.jsx(vn,{className:"icon-md block"})})})}),s.jsx(xe.Portal,{children:s.jsxs(xe.Content,{align:"end",children:[s.jsx(xe.Item,{onSelect:()=>{c("pdf")},children:s.jsx(T,{id:"WritingBlockDownloadButton.downloadPdf.menu",defaultMessage:"PDF Document (.pdf)"})}),s.jsx(xe.Item,{onSelect:()=>{c("docx")},children:s.jsx(T,{id:"WritingBlockDownloadButton.downloadDocx.menu",defaultMessage:"Microsoft Word Document (.docx)"})})]})})]})}function ec({content:e,clientThreadId:t,title:n,messageId:a,messageRef:o}){const r=P(),i=lo(t);function l(){uo.logButtonClick(mo.OPEN_IN_CANVAS_WRITING_BLOCK),o.current&&ho(o.current);const d=fo.DOCUMENT;be.logEventWithStatsig("ChatGPT Writing Block Edit in Canvas Button Clicked","chatgpt_writing_block_edit_in_canvas_button_clicked",{...pt({clientThreadId:t,messageId:a})}),i({title:n??r.formatMessage({id:"2V9CtJ",defaultMessage:"New document"}),textdocType:d,content:e,createSource:po.MESSAGE_WRITING_BLOCK})}return s.jsx("button",{className:"flex items-center px-1.5 py-1 select-none",onClick:l,children:s.jsx(Z,{label:s.jsx(T,{id:"WritingBlockOpenCanvasButton.openTooltip",defaultMessage:"Edit in Canvas"}),children:s.jsx(co,{className:"icon-md block"})})})}const It="bg-token-bg-primary dark:bg-token-bg-elevated-secondary my-4 w-full overflow-visible rounded-3xl shadow-[inset_0px_0px_0px_1px_rgba(0,0,0,0.12),0px_8px_480px_rgba(0,0,0,0.04)] dark:shadow-[inset_0px_0px_0px_1px_var(--border-light)]",tc="bg-token-bg-primary dark:bg-token-bg-elevated-secondary/80",Yn=({primaryLabel:e,primaryAction:t,hasBeenEdited:n,saving:a,dirty:o,saved:r,writingBlock:i,clientThreadId:l,messageId:d,isInlineWritingBlockExportEnabled:c,serverThreadId:u,shouldShowWritingBlockCanvasEdit:m,title:b,index:w,messageRef:x,hideDownloadButton:j=!1,handleShowOriginalToggle:_,showOriginal:f})=>{const k=P();return s.jsx("div",{className:"thread-xl:-top-[var(--header-height)] sticky top-0 mx-0.5 overflow-hidden rounded-t-3xl backdrop-blur-md",children:s.jsxs("div",{className:S(tc,"flex w-full items-center justify-between gap-3 px-3.5 py-3 font-sans sm:ps-5.5 sm:pe-3.5"),children:[s.jsxs("div",{className:"text-token-text-tertiary flex max-w-[75%] flex-grow items-center text-[14px] font-medium",children:[e??s.jsx(T,{id:"xkhGbw",defaultMessage:"Write"}),n&&s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"mx-1",children:"⋅"}),s.jsx(he.button,{initial:{opacity:0,y:2},animate:{opacity:1,y:0},transition:{duration:.3,ease:[.22,1,.36,1]},onClick:_,layout:!0,className:"cursor-pointer",children:s.jsx("span",{className:"inline-block text-start",children:s.jsx(Pt,{mode:"wait",initial:!1,children:f?s.jsx(he.span,{initial:{opacity:0,y:2},animate:{opacity:1,y:0},exit:{opacity:0,y:-2},children:s.jsx(Z,{label:k.formatMessage({id:"3fjZJO",defaultMessage:"View current edits"}),children:s.jsx(T,{id:"3Gh5Be",defaultMessage:"Original"})})},"original"):s.jsx(he.span,{initial:{opacity:0,y:2},animate:{opacity:1,y:0},exit:{opacity:0,y:-2},children:s.jsx(Z,{label:k.formatMessage({id:"kPDhk6",defaultMessage:"View original"}),children:s.jsx(T,{id:"VJ9CSr",defaultMessage:"Edited"})})},"edited")})})})]})]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"text-token-text-secondary px-1.5",children:a||o?s.jsx(Z,{label:k.formatMessage({id:"aIIB4+",defaultMessage:"Saving"}),children:s.jsx(Un,{size:16})}):r&&s.jsx(Z,{label:k.formatMessage({id:"/qWJGP",defaultMessage:"Saved"}),children:s.jsx(Gt,{})})}),l&&d&&s.jsx("div",{className:"text-token-text-secondary hover:text-token-text-primary",children:s.jsx(Jl,{content:i.content,clientThreadId:l,messageId:d,onlyIcon:!0})}),!j&&c&&u&&d&&s.jsx("div",{className:"text-token-text-secondary hover:text-token-text-primary",children:s.jsx(Ql,{serverThreadId:u,messageId:d,title:b,index:w})}),l&&d&&m&&s.jsx("div",{className:"text-token-text-secondary hover:text-token-text-primary",children:s.jsx(ec,{content:i.content,clientThreadId:l,messageId:d,title:b,messageRef:x})}),t]})]})})},_t={hr:"mx-4 my-1! border-0 border-t !border-token-border-light sm:mx-6"},sc=({title:e,children:t,hasBeenEdited:n,messageId:a,clientThreadId:o,recipient:r,messageRef:i,shouldShowWritingBlockCanvasEdit:l=!1,isInlineWritingBlockEditEnabled:d,isInlineWritingBlockExportEnabled:c,writingBlock:u,index:m,originalContent:b,onChange:w,isStreaming:x,isSaving:j,saved:_,savedAt:f,dirty:k,showOriginal:v,handleShowOriginalToggle:p})=>{const y=Ze(o),C=s.jsx(T,{id:"PrFQxx",defaultMessage:"Email"}),M=s.jsx(Yl,{clientThreadId:o,messageId:a,content:u.content,subject:e??"",recipient:r??""});return s.jsxs("div",{ref:i,id:`writing-block-${a}`,className:S(It,"pt-1 pb-3"),"data-writing-block":!0,children:[s.jsx(Yn,{savedAt:f,primaryLabel:C,primaryAction:M,writingBlock:u,clientThreadId:o,messageId:a,title:e,hideDownloadButton:!0,showOriginal:v,handleShowOriginalToggle:p,hasBeenEdited:n,saving:j,saved:_,dirty:k,shouldShowWritingBlockCanvasEdit:l,isInlineWritingBlockExportEnabled:c,serverThreadId:y,index:m,messageRef:i}),s.jsx("hr",{className:_t.hr}),r&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex w-full min-w-0 items-center gap-2 px-4 py-3 font-sans sm:px-6",children:[s.jsx("div",{className:"font-medium",children:s.jsx(T,{id:"NPvnYL",defaultMessage:"To"})}),s.jsx("div",{className:"min-w-0 shrink-0 truncate",children:r})]}),s.jsx("hr",{className:_t.hr})]}),s.jsxs("div",{className:"flex w-full min-w-0 items-center gap-2 px-4 py-3 font-sans sm:px-6",children:[s.jsx("div",{className:"font-medium",children:s.jsx(T,{id:"eQGtfX",defaultMessage:"Subject"})}),s.jsx("div",{className:"max-w-[75%] min-w-0 shrink-0 truncate",children:e})]}),s.jsx("hr",{className:S(_t.hr,"mb-4!")}),s.jsx(Zn,{isInlineWritingBlockEditEnabled:d,writingBlock:u,onChange:w,isStreaming:x,showOriginal:v,originalContent:b,children:t})]})};function nc({serverThreadId:e,index:t,messageId:n,writingBlock:a,dirty:o,setDirty:r,delay:i=3e3}){const[l,d]=h.useState(!1),[c,u]=h.useState(null),[m,b]=h.useState(null),w=h.useRef(a.content),x=h.useRef(0),j=h.useRef(null),{mutate:_}=mn({mutationFn:async k=>{!e||!n||await es.safePost("/conversation/message/writing-blocks",{requestBody:{message_id:n,conversation_id:e,index:String(t),writing_block:{content:k,index:String(t)}},authOption:Dn.SendIfAvailable})},onSuccess:(k,v,p)=>{j.current===p?.myVersion&&(r(!1),b(new Date))},onMutate:()=>{const k=++x.current;return j.current=k,d(!0),u(null),{myVersion:k}},onError:(k,v,p)=>{u(k.message),r(!0)},onSettled:(k,v,p,y)=>{j.current===y?.myVersion&&(d(!1),j.current=null)},retry:2,retryDelay:5e3}),f=Pi(_,i);return h.useEffect(()=>{a.content!==w.current&&(w.current=a.content,f(a.content))},[a.content,f]),h.useEffect(()=>()=>{f.cancel()},[f]),{saving:l,saved:!!m&&!o&&!l,savedAt:m,error:c}}const ac=()=>{const e=h.useMemo(()=>Fn((t,n,a,o)=>{Cr(n,r=>Sr.updateTree(r,i=>i.updateNodeMessageMetadata(a.id,{writing_blocks:{...a.metadata?.writing_blocks??{},[o]:{index:o,content:t}}})))},500),[]);return h.useEffect(()=>()=>{e.cancel?.()},[e]),{editWritingBlock:e}},oc=({title:e,children:t,originalContent:n,messageId:a,clientThreadId:o,variant:r,recipient:i,isStreaming:l,index:d})=>{const[c,u]=h.useState(!1),m=()=>{u(!c)},[b,w]=h.useState(!1),x=Mr(Nr.EditInCanvas),j=B(),_=F(j,"2740339093"),f=F(j,"669593727"),k=Ze(o),v=qe(o,E=>a?We.getNode(E,a).message:void 0,{disablePerfDetector:!0}),p=v?.metadata?.writing_blocks?.[d],y=!!p&&p?.content!==n,{editWritingBlock:C}=ac(),M=v?.metadata?.writing_blocks?.[d]??{content:n,index:d},{saving:g,saved:N,savedAt:$}=nc({serverThreadId:k,index:d,messageId:a,dirty:b,setDirty:w,writingBlock:M}),L=E=>{!o||!v||!v.id||(w(!0),C(E,o,v,d))},A=h.useRef(null),R=e??s.jsx(T,{id:"t8R7XZ",defaultMessage:"Write"});if(l&&r===ot.UNKNOWN)return s.jsx("div",{ref:A,id:`writing-block-${a}`,className:S(It,"px-4 py-2"),"data-writing-block":!0,children:s.jsx(he.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},transition:{type:"spring",bounce:.2,duration:.5},style:{overflow:"hidden"},children:s.jsx(Tr,{lines:2})})});switch(r){case ot.EMAIL:return s.jsx(sc,{savedAt:$,hasBeenEdited:y,originalContent:n,messageRef:A,clientThreadId:o,messageId:a,recipient:i,title:R,index:d,shouldShowWritingBlockCanvasEdit:x,isInlineWritingBlockEditEnabled:_,isInlineWritingBlockExportEnabled:f,onChange:L,writingBlock:M,isStreaming:l,isSaving:g,saved:N,dirty:b,showOriginal:c,handleShowOriginalToggle:m,children:t});default:return s.jsxs("div",{ref:A,id:`writing-block-${a}`,className:S(It,"pt-1 pb-3"),"data-writing-block":!0,children:[s.jsx(Yn,{hasBeenEdited:y,saving:g,savedAt:$,dirty:b,saved:N,writingBlock:M,clientThreadId:o,messageId:a,isInlineWritingBlockExportEnabled:f,serverThreadId:k,shouldShowWritingBlockCanvasEdit:x,title:e,index:d,messageRef:A,showOriginal:c,handleShowOriginalToggle:m}),s.jsx(Zn,{isInlineWritingBlockEditEnabled:_,writingBlock:M,onChange:L,isStreaming:l,showOriginal:c,originalContent:n,children:t})]})}};function rc(e){return e&&/^turn[0-9]+ifs[0-9]+$/.test(e)}const bs=4;function ic({metadata:e,analyticsMetadata:t,trackContentReferenceEvent:n,imageSource:a,superWidgetImages:o}){const r=a??Be.Turn,i=Ye(),l=B(),d=$r(l)&&On(l),c=h.useMemo(()=>!d||!o?e.images:go(e.images.concat(o),_=>_.thumbnail_url),[e.images,d,o]),u=e.images.some(_=>_.is_proxied_image)?[]:c.map(_=>_.thumbnail_url),m=Ca({queries:u.map(_=>Ii(_,"_ImageCarousel")),combine:_=>{const f=new Set;return _.forEach((k,v)=>{k.isSuccess&&f.add(u[v])}),f}}),b=c.filter(_=>m.has(_.thumbnail_url)),w=e.images.length;if(e.images.some(_=>_.is_proxied_image)){const _=e.images.find(k=>k.is_proxied_image),f=S("mb-7 mt-1 min-w-32 max-w-[22%] rounded-xl border-[0.5px] border-token-border-default",_?.float_top?"relative block":"float-image z-10 float-end clear-end ms-7 overflow-hidden");return s.jsx(we,{image:_,imageSource:r,analyticsMetadata:t,trackContentReferenceEvent:n,eventMetadata:{imageUse:"deepResearch"},aspectRatio:st,className:f},_?.content_url)}if(w===0)return null;if(w===1){const _=e.images[0];return s.jsx(we,{image:_,imageSource:r,analyticsMetadata:t,trackContentReferenceEvent:n,eventMetadata:{imageUse:"legacyCarousel"},aspectRatio:st,className:"float-image border-token-border-default float-end clear-end ms-7 mt-1 mb-7 max-w-[22%] min-w-32 overflow-hidden rounded-xl border-[0.5px]"},_.content_url)}const x=d?null:bs,j=i||x==null?b.length:Math.min(b.length,x);return b.length>bs&&d?s.jsx(lc,{images:b.slice(0,j),imageSource:r,analyticsMetadata:t,trackContentReferenceEvent:n}):s.jsx("div",{className:"no-scrollbar mt-1 mb-6 flex min-h-36 flex-nowrap gap-0.5 overflow-auto sm:gap-1 sm:overflow-hidden xl:min-h-44",children:b.slice(0,j).map((_,f)=>s.jsx("div",{className:S("border-token-border-default relative aspect-square w-32 shrink-0 overflow-hidden rounded-xl border-[0.5px] md:shrink","max-h-48 sm:w-[calc((100%-0.5rem)/4)]",f===0&&"rounded-s-xl",f===j-1&&"rounded-e-xl"),children:s.jsx(we,{image:_,imageSource:r,analyticsMetadata:t,trackContentReferenceEvent:n,eventMetadata:{imageUse:"legacyCarousel"},aspectRatio:st,className:"h-full w-full"},_.thumbnail_url)},_.thumbnail_url))})}const as=h.memo(ic,(e,t)=>e.numImageResults===t.numImageResults&&e.analyticsMetadata===t.analyticsMetadata&&e.trackContentReferenceEvent===t.trackContentReferenceEvent&&e.metadata.images.length===t.metadata.images.length&&e.metadata.images.every((n,a)=>n.content_url===t.metadata.images[a].content_url));function we({image:e,imageSource:t,className:n,imgClassName:a,style:o,analyticsMetadata:r,trackContentReferenceEvent:i,eventMetadata:l={},badge:d,lightboxImages:c,aspectRatio:u}){const m=Di(e,{width:Fi,aspectRatio:u??void 0}),b=e?.content_url.replace(/^http:\/\//,"https://"),w=cc(e),{isSuccess:x}=At(m,"ImageCarousel_thumbnail"),{isSuccess:j,isError:_}=At(w?b:void 0,"ImageCarousel_full"),f=h.useMemo(()=>({image_url:m,title:e?.title,...l}),[m,e?.title,l]);h.useEffect(()=>{e&&x&&i("Search Content Reference Shown","search_content_reference_shown","image_v2",f)},[i,e,x,f]),h.useEffect(()=>{b&&_&&Le.addAction("Failed to download full image",{url:b,thumbnailUrl:m})},[b,_,m]);const k=Zt.useStore(),v=Oi(e?.thumbnail_crop_info??null,e?.thumbnail_size??null,u??void 0),p=!e||!(x||j||e.is_proxied_image),y=(()=>{if(!p)return e.is_proxied_image?e.url:w&&j?b:m})(),C={...o,...u?{aspectRatio:`${u.width}/${u.height}`}:{}};return s.jsxs("button",{className:S("relative overflow-hidden",n),style:C,onClick:()=>{i("Search Content Reference Clicked","search_content_reference_clicked","image_v2",f),k.setCurrentImage(e?{image:e,source:t,analyticsMetadata:r,imageResults:c}:void 0)},children:[p?s.jsx("div",{className:"bg-token-main-surface-tertiary aspect-square h-full w-full animate-pulse"}):s.jsx(Vn,{children:s.jsx("img",{src:y,alt:e?.content_url,style:v?{objectPosition:v}:{},className:S("bg-token-main-surface-tertiary m-0 h-full w-full object-cover",a)})}),d&&s.jsx("div",{className:"pointer-events-none absolute end-2 bottom-2",children:d})]})}function lc({images:e,imageSource:t,analyticsMetadata:n,trackContentReferenceEvent:a}){const o=B(),r=zn(o);return s.jsx("div",{className:S("relative mb-6",r?"-mx-[var(--thread-content-margin)]":"-mx-6"),children:s.jsx(xo,{showArrows:!0,className:S(r?"px-[var(--thread-content-margin)]":"px-6"),children:s.jsx("ul",{className:"not-prose relative flex h-48 min-h-48 list-none gap-2 px-0",children:e.map(i=>{const{width:l,height:d}=i.content_size,c=d?l/d*192:"w-[180px]";return s.jsx("li",{className:S("not-prose h-full max-w-[200px] min-w-[120px] sm:max-w-[calc((var(--thread-content-max-width)-2rem)/3)]","border-token-border-default hires:border-[0.5px] relative overflow-hidden rounded-xl border-[1px]"),style:{width:c},children:s.jsx("div",{className:"h-full w-full overflow-hidden",children:s.jsx(we,{image:i,imageSource:t,analyticsMetadata:n,trackContentReferenceEvent:a,className:"aspect-auto h-full w-full",aspectRatio:null})})},i.thumbnail_url)})})})})}function cc(e){return!e||e.is_proxied_image?!1:e.thumbnail_url.includes("images.openai.com/thumbnails")}function Xn({numImages:e}){return s.jsxs("div",{className:"flex items-center gap-1 rounded-full px-2 py-1.5 text-white backdrop-blur-md backdrop-brightness-75",children:[s.jsx(yo,{className:"h-4 w-4"}),s.jsx("span",{className:"text-xs font-semibold",children:e})]})}const Kn="mt-1 mb-5 [&:not(:first-child)]:mt-4",dc=/^image_group[\s\S]*$/;function uc({contentReference:e,trackContentReferenceEvent:t,analyticsMetadata:n}){const{images:a,layout:o="carousel",aspect_ratio:r}=e,i=dc.test(e.matched_text??""),l=xc(r??"1:1"),d={images:a,trackContentReferenceEvent:t,analyticsMetadata:n,aspectRatio:l,isReferenceComplete:i};return o==="carousel"?s.jsx(vc,{...d}):o==="bento"?s.jsx(yc,{...d}):null}const Ne={width:9,height:5},mc={width:Ne.width/3,height:Ne.height},hc={width:Ne.width/3,height:Ne.height/2};function fc(e,t){if(t)switch(e){case 0:return"rounded-tr-md rounded-br-md rounded-tl-xl rounded-bl-xl";case 1:return"rounded-md";case 2:return"rounded-tr-xl rounded-br-md rounded-tl-md rounded-bl-md";case 3:return"rounded-tr-md rounded-br-xl rounded-tl-md rounded-bl-md";default:return""}switch(e){case 0:return"rounded-tr-md rounded-br-md rounded-tl-xl rounded-bl-xl";case 1:return"rounded-tr-xl rounded-br-md rounded-tl-md rounded-bl-md";case 2:return"rounded-tr-md rounded-br-xl rounded-tl-md rounded-bl-md";default:return""}}const pc=(e,t)=>e.image_result?e.image_result.content_url:`${e.image_search_query??e.image_ref_id}-${t}`;function gc({images:e,aspectRatio:t,trackContentReferenceEvent:n,analyticsMetadata:a}){const o=t.height>t.width,r=o?4:3;return s.jsx("div",{className:S("grid grid-flow-dense grid-cols-3 grid-rows-2 gap-1",Kn),style:{aspectRatio:`${Ne.width}/${Ne.height}`},children:e.map((i,l)=>{if(l>=r)return null;const c=o&&[0,1].includes(l),u=l===Math.min(r,e.length)-1&&e.length>r;return s.jsx(we,{image:i.image_result??void 0,imageSource:Be.ImageGroup,className:S("border-token-border-default h-full w-full border-[0.5px]",c&&"col-span-1 row-span-2",!o&&l===0&&"col-span-2 row-span-2",fc(l,o)),badge:u?s.jsx(Xn,{numImages:e.length}):void 0,lightboxImages:e.map(m=>m.image_result).filter(m=>!!m),aspectRatio:c?mc:hc,trackContentReferenceEvent:n,eventMetadata:{imageUse:"imageGroup",layout:"bento"},analyticsMetadata:a},pc(i,l))})})}function xc(e){const[t,n]=e.split(":"),a=parseFloat(t),o=parseFloat(n);return a<=0||o<=0?{width:1,height:1}:{width:a,height:o}}const Jn=(e,t)=>e.images.length===t.images.length&&e.analyticsMetadata===t.analyticsMetadata&&e.trackContentReferenceEvent===t.trackContentReferenceEvent&&e.images.every((n,a)=>n.image_result?.content_url===t.images[a].image_result?.content_url),yc=h.memo(gc,Jn),bc=3,jt={width:5,height:4};function wc({images:e,analyticsMetadata:t,trackContentReferenceEvent:n,isReferenceComplete:a}){const o=Ye(),r=e.length,i=e.map(d=>d.image_result).filter(d=>!!d);if(r===0)return null;if(r===1){const d=e[0];return!d.image_result&&!a?null:s.jsxs(s.Fragment,{children:[s.jsx("span",{"aria-hidden":!0,className:"clear-both m-0 block h-0 p-0"}),s.jsx(we,{image:d?.image_result??void 0,imageSource:Be.ImageGroup,analyticsMetadata:t,trackContentReferenceEvent:n,eventMetadata:{imageUse:"imageGroup",layout:"single"},aspectRatio:st,className:"float-image border-token-border-default float-end clear-end ms-7 mt-1 mb-7 w-[22%] min-w-32 overflow-hidden rounded-xl border-[0.5px]"})]})}const l=o?e.length:Math.min(e.length,bc);return s.jsx("div",{className:S("no-scrollbar flex min-h-36 flex-nowrap gap-0.5 overflow-auto sm:gap-1 sm:overflow-hidden xl:min-h-44",Kn),children:e.slice(0,l).map((d,c)=>{const u=c===l-1;return s.jsx("div",{className:S("border-token-border-default relative w-32 shrink-0 overflow-hidden rounded-xl border-[0.5px] md:shrink","max-h-64 sm:w-[calc((100%-0.5rem)/3)]",c===0&&"rounded-s-xl",u&&"rounded-e-xl"),style:{aspectRatio:`${jt.width}/${jt.height}`},children:s.jsx(we,{image:d.image_result??void 0,imageSource:Be.ImageGroup,lightboxImages:i,analyticsMetadata:t,trackContentReferenceEvent:n,eventMetadata:{imageUse:"imageGroup",layout:"carousel"},className:"h-full w-full",badge:u&&e.length>l&&s.jsx(Xn,{numImages:e.length}),aspectRatio:jt})},d.image_result?.thumbnail_url??`${d.image_search_query}-${d.image_ref_id}-${c}`)})})}const vc=h.memo(wc,Jn),_c=200,jc=100,tt={id:"imagePill.screenshot",defaultMessage:"screenshot",description:"Brief text to be placed in a pill as generic fallback when screenshot url is missing"},Qn="m-0 p-[2px] pr-1",kc=S(Qn,"h-full rounded-lg object-contain"),Cc=S(Qn,"p-[4px]");function ws({image:e}){const[t,n]=h.useState(!1),a=Zt.useStore(),o=h.useRef(null),r=h.useRef(null),i=P(),l=e?.content_url,d=h.useMemo(()=>l?ft(l,"hostname"):null,[l]),c=h.useCallback(()=>{o.current&&clearTimeout(o.current)},[]),u=h.useCallback(()=>{e&&(c(),n(!1),a.setCurrentImage({image:e}))},[a,e,c]),m=h.useCallback(()=>{r.current&&clearTimeout(r.current)},[]),b=h.useCallback(()=>{n(!1)},[n]),w=h.useCallback(_=>{_.stopPropagation(),m(),o.current=setTimeout(()=>{n(!0)},_c)},[m]),x=h.useCallback(_=>{_.stopPropagation(),c(),r.current=setTimeout(()=>{b()},jc)},[c,b]);h.useEffect(()=>{t&&m()},[t,m]);const j=h.useMemo(()=>({onBlur:x,onMouseLeave:x,onMouseEnter:w,onFocus:w}),[x,w]);return e?s.jsxs("span",{onClick:u,className:"relative",...j,children:[s.jsxs(vs,{isOpen:t,children:[s.jsx("img",{className:kc,src:e.thumbnail_url}),s.jsx("span",{children:d??i.formatMessage(tt)})]}),t&&s.jsx("div",{className:"absolute start-0 z-50",children:s.jsxs("div",{className:S("text-token-text-secondary border-token-border-light w-[256px] cursor-pointer px-3 pt-2 pb-3 text-sm shadow-md outline-[0.5px] outline-black/5",Er),...j,children:[s.jsxs(pe,{href:e.content_url,target:"_blank",rel:"noopener",className:"z-50 mb-2 flex items-center gap-2 hover:opacity-70",onClick:_=>_.stopPropagation(),children:[s.jsx(De,{url:e.content_url,className:"m-0 size-4 p-0",size:32}),d??i.formatMessage(tt)]}),s.jsx("img",{className:"border-token-border-light m-0 cursor-pointer rounded-lg object-contain p-0 outline-[0.5px] outline-black/5",src:e.thumbnail_url,alt:d??i.formatMessage(tt),onClick:_=>{_.preventDefault(),u()}})]})})]}):s.jsxs(vs,{isOpen:!1,children:[s.jsx("span",{className:Cc,children:s.jsx(Ge,{})}),s.jsx("span",{children:d??i.formatMessage(tt)})]})}function vs({children:e,isOpen:t,...n}){return s.jsx("span",{className:S("ms-1 cursor-pointer","inline-flex max-w-full items-center","relative top-[0.2rem]","animate-[show_150ms_ease-in]"),...n,children:s.jsx("span",{className:S("text-token-text-secondary flex h-4.5 overflow-hidden rounded-xl bg-[#F4F4F4] pe-2 text-[0.5625em] font-medium dark:bg-[#303030]","hover:bg-token-text-primary! hover:text-token-text-inverted",t&&"bg-token-main-surface-tertiary text-token-text-secondary","transition-colors duration-150 ease-in-out","items-center justify-center"),children:e})})}async function Sc({conversationId:e,messageId:t,assetPointerLinks:n,sharedConversationLikeId:a}){return await es.safePost("/conversation/get_images_for_message",{requestBody:{conversation_id:e??null,share_id:a??null,message_id:t,asset_pointer_links:n},authOption:Dn.SendIfAvailable})}function Mc({reference:e,conversationId:t,messageId:n,sharedConversationLikeId:a,isN7jupdMessage:o}){return Sa({queryKey:["inline-images",e,t,n],queryFn:async()=>{if(!e.asset_pointer_links||e.asset_pointer_links.length===0||!t&&!a)return{images:[],formats:[]};const i=await Sc({conversationId:t,messageId:n,assetPointerLinks:e.asset_pointer_links,sharedConversationLikeId:a});for(let l=0;l<i.images.length;l++){const d=i.images[l],u=`image/${i.formats[l]}`,m=Nc(d,u);i.images[l]=m}return i},...o?{retry:3,retryDelay:5e3}:{}})}function Nc(e,t="",n=512){const a=atob(e),o=[];for(let i=0;i<a.length;i+=n){const l=a.slice(i,i+n),d=new Array(l.length);for(let u=0;u<l.length;u++)d[u]=l.charCodeAt(u);const c=new Uint8Array(d);o.push(c)}const r=new Blob(o,{type:t});return URL.createObjectURL(r)}const Tc=200;function $c({reference:e,clientThreadId:t,message:n,trackContentReferenceEvent:a}){const o=Ze(t),{postId:r}=h.useContext(bo),{data:i,isLoading:l,isError:d,error:c}=Mc({reference:e,conversationId:o,messageId:n.id,sharedConversationLikeId:r,isN7jupdMessage:n.metadata?.n7jupd_message}),u=h.useRef([]);h.useEffect(()=>()=>{u.current.forEach(b=>{URL.revokeObjectURL(b)}),u.current=[]},[]);const m=ea(n,e);return c||d||i&&!("images"in i)||l||!i?.images.length?null:(u.current=[],s.jsx(s.Fragment,{children:i?.images.map((b,w)=>{const x=ta(e,b,m);return s.jsx(as,{metadata:x,analyticsMetadata:{clientThreadId:t,messageId:n.id},numImageResults:1,trackContentReferenceEvent:a},`image-carousel-inline-${w}`)})}))}const Ec=(e,t)=>{const n=new RegExp(t+"\\s*([^\\n]+)","m"),a=e.match(n);return a&&a[1]?a[1].trim().length:0};function ea(e,t){return h.useMemo(()=>{let n=-1;return e.content.content_type==="text"&&(n=Ec(e.content.parts.join(""),t.matched_text)),n<Tc||n===-1},[e,t.matched_text])}function ta(e,t,n){return{matched_text:e.matched_text,start_idx:e.start_idx,end_idx:e.end_idx,safe_urls:e.safe_urls,alt:e.alt,prompt_text:e.prompt_text,type:"image_v2",refs:[],images:[{url:t,content_url:e.clicked_from_url??"",thumbnail_url:t,title:e.clicked_from_title??"",attribution:ft(e.clicked_from_url??t,"hostname"),content_size:{width:_s,height:js},thumbnail_size:{width:_s,height:js},is_proxied_image:!0,float_top:n}]}}const _s=141,js=143;function Pc({reference:e,clientThreadId:t,message:n,trackContentReferenceEvent:a}){const o=n.metadata?.n7jupd_message&&e.matched_text.includes("screenshot"),r=Ze(t),i=h.useContext(Pr)?.serverSharedThreadId??void 0,l=wo(e.asset_pointer_links[0]),d=h.useMemo(()=>({content_type:An.ImageAssetPointer,size_bytes:0,width:0,height:0,asset_pointer:l}),[l]),c=_n({asset:d,sharedThreadId:i,conversationId:r}),u=c.data?.url,m=ea(n,e),b=h.useMemo(()=>u?ta(e,u,m):null,[u,e,m]);return c.error||c.isError?null:o&&!c.data?.url&&c.isLoading?s.jsx(ws,{image:null},"image-pill-loading"):!o&&(c.isLoading||!c.data)||!b?null:o?s.jsx(ws,{image:b.images[0]}):s.jsx(as,{metadata:b,analyticsMetadata:{clientThreadId:t,messageId:n.id},numImageResults:1,trackContentReferenceEvent:a})}const H=1e-6;let Te=typeof Float32Array<"u"?Float32Array:Array;function Lc(){const e=new Te(2);return Te!=Float32Array&&(e[0]=0,e[1]=0),e}function ks(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function Ac(e,t){return e[0]=-t[0],e[1]=-t[1],e}function sa(e,t,n,a){const o=t[0],r=t[1];return e[0]=o+a*(n[0]-o),e[1]=r+a*(n[1]-r),e}(function(){const e=Lc();return function(t,n,a,o,r,i){let l,d;for(n||(n=2),a||(a=0),o?d=Math.min(o*n+a,t.length):d=t.length,l=a;l<d;l+=n)e[0]=t[l],e[1]=t[l+1],r(e,e,i),t[l]=e[0],t[l+1]=e[1];return t}})();function Rc(){const e=new Te(3);return Te!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Ic(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function Dc(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function Fc(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}const Oc=Dc;(function(){const e=Rc();return function(t,n,a,o,r,i){let l,d;for(n||(n=3),a||(a=0),o?d=Math.min(o*n+a,t.length):d=t.length,l=a;l<d;l+=n)e[0]=t[l],e[1]=t[l+1],e[2]=t[l+2],r(e,e,i),t[l]=e[0],t[l+1]=e[1],t[l+2]=e[2];return t}})();function zc(e,t){const n=t[0],a=t[1],o=t[2],r=t[3],i=t[4],l=t[5],d=t[6],c=t[7],u=t[8],m=t[9],b=t[10],w=t[11],x=t[12],j=t[13],_=t[14],f=t[15],k=n*l-a*i,v=n*d-o*i,p=n*c-r*i,y=a*d-o*l,C=a*c-r*l,M=o*c-r*d,g=u*j-m*x,N=u*_-b*x,$=u*f-w*x,L=m*_-b*j,A=m*f-w*j,R=b*f-w*_;let E=k*R-v*A+p*L+y*$-C*N+M*g;return E?(E=1/E,e[0]=(l*R-d*A+c*L)*E,e[1]=(o*A-a*R-r*L)*E,e[2]=(j*M-_*C+f*y)*E,e[3]=(b*C-m*M-w*y)*E,e[4]=(d*$-i*R-c*N)*E,e[5]=(n*R-o*$+r*N)*E,e[6]=(_*p-x*M-f*v)*E,e[7]=(u*M-b*p+w*v)*E,e[8]=(i*A-l*$+c*g)*E,e[9]=(a*$-n*A-r*g)*E,e[10]=(x*C-j*p+f*k)*E,e[11]=(m*p-u*C-w*k)*E,e[12]=(l*N-i*L-d*g)*E,e[13]=(n*L-a*N+o*g)*E,e[14]=(j*v-x*y-_*k)*E,e[15]=(u*y-m*v+b*k)*E,e):null}function kt(e,t,n){const a=t[0],o=t[1],r=t[2],i=t[3],l=t[4],d=t[5],c=t[6],u=t[7],m=t[8],b=t[9],w=t[10],x=t[11],j=t[12],_=t[13],f=t[14],k=t[15];let v=n[0],p=n[1],y=n[2],C=n[3];return e[0]=v*a+p*l+y*m+C*j,e[1]=v*o+p*d+y*b+C*_,e[2]=v*r+p*c+y*w+C*f,e[3]=v*i+p*u+y*x+C*k,v=n[4],p=n[5],y=n[6],C=n[7],e[4]=v*a+p*l+y*m+C*j,e[5]=v*o+p*d+y*b+C*_,e[6]=v*r+p*c+y*w+C*f,e[7]=v*i+p*u+y*x+C*k,v=n[8],p=n[9],y=n[10],C=n[11],e[8]=v*a+p*l+y*m+C*j,e[9]=v*o+p*d+y*b+C*_,e[10]=v*r+p*c+y*w+C*f,e[11]=v*i+p*u+y*x+C*k,v=n[12],p=n[13],y=n[14],C=n[15],e[12]=v*a+p*l+y*m+C*j,e[13]=v*o+p*d+y*b+C*_,e[14]=v*r+p*c+y*w+C*f,e[15]=v*i+p*u+y*x+C*k,e}function Dt(e,t,n){const a=n[0],o=n[1],r=n[2];let i,l,d,c,u,m,b,w,x,j,_,f;return t===e?(e[12]=t[0]*a+t[4]*o+t[8]*r+t[12],e[13]=t[1]*a+t[5]*o+t[9]*r+t[13],e[14]=t[2]*a+t[6]*o+t[10]*r+t[14],e[15]=t[3]*a+t[7]*o+t[11]*r+t[15]):(i=t[0],l=t[1],d=t[2],c=t[3],u=t[4],m=t[5],b=t[6],w=t[7],x=t[8],j=t[9],_=t[10],f=t[11],e[0]=i,e[1]=l,e[2]=d,e[3]=c,e[4]=u,e[5]=m,e[6]=b,e[7]=w,e[8]=x,e[9]=j,e[10]=_,e[11]=f,e[12]=i*a+u*o+x*r+t[12],e[13]=l*a+m*o+j*r+t[13],e[14]=d*a+b*o+_*r+t[14],e[15]=c*a+w*o+f*r+t[15]),e}function na(e,t,n){const a=n[0],o=n[1],r=n[2];return e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e[3]=t[3]*a,e[4]=t[4]*o,e[5]=t[5]*o,e[6]=t[6]*o,e[7]=t[7]*o,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Bc(e,t,n){const a=Math.sin(n),o=Math.cos(n),r=t[4],i=t[5],l=t[6],d=t[7],c=t[8],u=t[9],m=t[10],b=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=r*o+c*a,e[5]=i*o+u*a,e[6]=l*o+m*a,e[7]=d*o+b*a,e[8]=c*o-r*a,e[9]=u*o-i*a,e[10]=m*o-l*a,e[11]=b*o-d*a,e}function Wc(e,t,n){const a=Math.sin(n),o=Math.cos(n),r=t[0],i=t[1],l=t[2],d=t[3],c=t[4],u=t[5],m=t[6],b=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=r*o+c*a,e[1]=i*o+u*a,e[2]=l*o+m*a,e[3]=d*o+b*a,e[4]=c*o-r*a,e[5]=u*o-i*a,e[6]=m*o-l*a,e[7]=b*o-d*a,e}function Hc(e,t,n,a,o){const r=1/Math.tan(t/2);if(e[0]=r/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,o!=null&&o!==1/0){const i=1/(a-o);e[10]=(o+a)*i,e[14]=2*o*a*i}else e[10]=-1,e[14]=-2*a;return e}const Uc=Hc;function Cs(e,t){const n=e[0],a=e[1],o=e[2],r=e[3],i=e[4],l=e[5],d=e[6],c=e[7],u=e[8],m=e[9],b=e[10],w=e[11],x=e[12],j=e[13],_=e[14],f=e[15],k=t[0],v=t[1],p=t[2],y=t[3],C=t[4],M=t[5],g=t[6],N=t[7],$=t[8],L=t[9],A=t[10],R=t[11],E=t[12],W=t[13],se=t[14],ce=t[15];return Math.abs(n-k)<=H*Math.max(1,Math.abs(n),Math.abs(k))&&Math.abs(a-v)<=H*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(o-p)<=H*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(r-y)<=H*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(i-C)<=H*Math.max(1,Math.abs(i),Math.abs(C))&&Math.abs(l-M)<=H*Math.max(1,Math.abs(l),Math.abs(M))&&Math.abs(d-g)<=H*Math.max(1,Math.abs(d),Math.abs(g))&&Math.abs(c-N)<=H*Math.max(1,Math.abs(c),Math.abs(N))&&Math.abs(u-$)<=H*Math.max(1,Math.abs(u),Math.abs($))&&Math.abs(m-L)<=H*Math.max(1,Math.abs(m),Math.abs(L))&&Math.abs(b-A)<=H*Math.max(1,Math.abs(b),Math.abs(A))&&Math.abs(w-R)<=H*Math.max(1,Math.abs(w),Math.abs(R))&&Math.abs(x-E)<=H*Math.max(1,Math.abs(x),Math.abs(E))&&Math.abs(j-W)<=H*Math.max(1,Math.abs(j),Math.abs(W))&&Math.abs(_-se)<=H*Math.max(1,Math.abs(_),Math.abs(se))&&Math.abs(f-ce)<=H*Math.max(1,Math.abs(f),Math.abs(ce))}function Vc(){const e=new Te(4);return Te!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function qc(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function Gc(e,t,n){const a=t[0],o=t[1],r=t[2],i=t[3];return e[0]=n[0]*a+n[4]*o+n[8]*r+n[12]*i,e[1]=n[1]*a+n[5]*o+n[9]*r+n[13]*i,e[2]=n[2]*a+n[6]*o+n[10]*r+n[14]*i,e[3]=n[3]*a+n[7]*o+n[11]*r+n[15]*i,e}(function(){const e=Vc();return function(t,n,a,o,r,i){let l,d;for(n||(n=4),a||(a=0),o?d=Math.min(o*n+a,t.length):d=t.length,l=a;l<d;l+=n)e[0]=t[l],e[1]=t[l+1],e[2]=t[l+2],e[3]=t[l+3],r(e,e,i),t[l]=e[0],t[l+1]=e[1],t[l+2]=e[2],t[l+3]=e[3];return t}})();function nt(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Me(e,t){const n=Gc([],t,e);return qc(n,n,1/n[3]),n}function Ft(e,t,n){return e<t?t:e>n?n:e}function Zc(e){return Math.log(e)*Math.LOG2E}const Yc=Math.log2||Zc;function fe(e,t){if(!e)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}const X=Math.PI,aa=X/4,te=X/180,Ot=180/X,He=512,Ss=4003e4,Ms=85.051129,oa=1.5;function Xc(e){return Math.pow(2,e)}function Se(e){const[t,n]=e;fe(Number.isFinite(t)),fe(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const a=t*te,o=n*te,r=He*(a+X)/(2*X),i=He*(X+Math.log(Math.tan(aa+o*.5)))/(2*X);return[r,i]}function Oe(e){const[t,n]=e,a=t/He*(2*X)-X,o=2*(Math.atan(Math.exp(n/He*(2*X)-X))-aa);return[a*Ot,o*Ot]}function Kc(e){const{latitude:t,longitude:n,highPrecision:a=!1}=e;fe(Number.isFinite(t)&&Number.isFinite(n));const o=He,r=Math.cos(t*te),i=o/360,l=i/r,d=o/Ss/r,c={unitsPerMeter:[d,d,d],metersPerUnit:[1/d,1/d,1/d],unitsPerDegree:[i,l,d],degreesPerUnit:[1/i,1/l,1/d]};if(a){const u=te*Math.tan(t*te)/r,m=i*u/2,b=o/Ss*u,w=b/l*d;c.unitsPerDegree2=[0,m,b],c.unitsPerMeter2=[w,0,w]}return c}function Jc(e){const{height:t,pitch:n,bearing:a,altitude:o,scale:r,center:i}=e,l=nt();Dt(l,l,[0,0,-o]),Bc(l,l,-n*te),Wc(l,l,a*te);const d=r/t;return na(l,l,[d,d,d]),i&&Dt(l,l,Fc([],i)),l}function Qc(e){const{width:t,height:n,altitude:a,pitch:o=0,offset:r,center:i,scale:l,nearZMultiplier:d=1,farZMultiplier:c=1}=e;let{fovy:u=rt(oa)}=e;a!==void 0&&(u=rt(a));const m=u*te,b=o*te,w=ra(u);let x=w;i&&(x+=i[2]*l/Math.cos(b)/n);const j=m*(.5+(r?r[1]:0)/n),_=Math.sin(j)*x/Math.sin(Ft(Math.PI/2-b-j,.01,Math.PI-.01)),f=Math.sin(b)*_+x,k=x*10,v=Math.min(f*c,k);return{fov:m,aspect:t/n,focalDistance:w,near:d,far:v}}function ed(e){const{fov:t,aspect:n,near:a,far:o}=Qc(e);return Uc([],t,n,a,o)}function rt(e){return 2*Math.atan(.5/e)*Ot}function ra(e){return .5/Math.tan(.5*e*te)}function td(e,t){const[n,a,o=0]=e;return fe(Number.isFinite(n)&&Number.isFinite(a)&&Number.isFinite(o)),Me(t,[n,a,o,1])}function Ns(e,t,n=0){const[a,o,r]=e;if(fe(Number.isFinite(a)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(r))return Me(t,[a,o,r,1]);const i=Me(t,[a,o,0,1]),l=Me(t,[a,o,1,1]),d=i[2],c=l[2],u=d===c?0:((n||0)-d)/(c-d);return sa([],i,l,u)}function sd(e){const{width:t,height:n,bounds:a,minExtent:o=0,maxZoom:r=24,offset:i=[0,0]}=e,[[l,d],[c,u]]=a,m=nd(e.padding),b=Se([l,Ft(u,-85.051129,Ms)]),w=Se([c,Ft(d,-85.051129,Ms)]),x=[Math.max(Math.abs(w[0]-b[0]),o),Math.max(Math.abs(w[1]-b[1]),o)],j=[t-m.left-m.right-Math.abs(i[0])*2,n-m.top-m.bottom-Math.abs(i[1])*2];fe(j[0]>0&&j[1]>0);const _=j[0]/x[0],f=j[1]/x[1],k=(m.right-m.left)/2/_,v=(m.top-m.bottom)/2/f,p=[(w[0]+b[0])/2+k,(w[1]+b[1])/2+v],y=Oe(p),C=Math.min(r,Yc(Math.abs(Math.min(_,f))));return fe(Number.isFinite(C)),{longitude:y[0],latitude:y[1],zoom:C}}function nd(e=0){return typeof e=="number"?{top:e,bottom:e,left:e,right:e}:(fe(Number.isFinite(e.top)&&Number.isFinite(e.bottom)&&Number.isFinite(e.left)&&Number.isFinite(e.right)),e)}const Ts=Math.PI/180;function ad(e,t=0){const{width:n,height:a,unproject:o}=e,r={targetZ:t},i=o([0,a],r),l=o([n,a],r);let d,c;const u=e.fovy?.5*e.fovy*Ts:Math.atan(.5/e.altitude),m=(90-e.pitch)*Ts;return u>m-.01?(d=$s(e,0,t),c=$s(e,n,t)):(d=o([0,0],r),c=o([n,0],r)),[i,l,c,d]}function $s(e,t,n){const{pixelUnprojectionMatrix:a}=e,o=Me(a,[t,0,1,1]),r=Me(a,[t,e.height,1,1]),l=(n*e.distanceScales.unitsPerMeter[2]-o[2])/(r[2]-o[2]),d=sa([],o,r,l),c=Oe(d);return c.push(n),c}class it{constructor(t={width:1,height:1}){this.equals=f=>f instanceof it?f.width===this.width&&f.height===this.height&&Cs(f.projectionMatrix,this.projectionMatrix)&&Cs(f.viewMatrix,this.viewMatrix):!1,this.project=(f,k={})=>{const{topLeft:v=!0}=k,p=this.projectPosition(f),y=td(p,this.pixelProjectionMatrix),[C,M]=y,g=v?M:this.height-M;return f.length===2?[C,g]:[C,g,y[2]]},this.unproject=(f,k={})=>{const{topLeft:v=!0,targetZ:p=void 0}=k,[y,C,M]=f,g=v?C:this.height-C,N=p&&p*this.distanceScales.unitsPerMeter[2],$=Ns([y,g,M],this.pixelUnprojectionMatrix,N),[L,A,R]=this.unprojectPosition($);return Number.isFinite(M)?[L,A,R]:Number.isFinite(p)?[L,A,p]:[L,A]},this.projectPosition=f=>{const[k,v]=Se(f),p=(f[2]||0)*this.distanceScales.unitsPerMeter[2];return[k,v,p]},this.unprojectPosition=f=>{const[k,v]=Oe(f),p=(f[2]||0)*this.distanceScales.metersPerUnit[2];return[k,v,p]};let{width:n,height:a,altitude:o=null,fovy:r=null}=t;const{latitude:i=0,longitude:l=0,zoom:d=0,pitch:c=0,bearing:u=0,position:m=null,nearZMultiplier:b=.02,farZMultiplier:w=1.01}=t;n=n||1,a=a||1,r===null&&o===null?(o=oa,r=rt(o)):r===null?r=rt(o):o===null&&(o=ra(r));const x=Xc(d);o=Math.max(.75,o);const j=Kc({longitude:l,latitude:i}),_=Se([l,i]);_.push(0),m&&Ic(_,_,Oc([],m,j.unitsPerMeter)),this.projectionMatrix=ed({width:n,height:a,scale:x,center:_,pitch:c,fovy:r,nearZMultiplier:b,farZMultiplier:w}),this.viewMatrix=Jc({height:a,scale:x,center:_,pitch:c,bearing:u,altitude:o}),this.width=n,this.height=a,this.scale=x,this.latitude=i,this.longitude=l,this.zoom=d,this.pitch=c,this.bearing=u,this.altitude=o,this.fovy=r,this.center=_,this.meterOffset=m||[0,0,0],this.distanceScales=j,this._initMatrices(),Object.freeze(this)}_initMatrices(){const{width:t,height:n,projectionMatrix:a,viewMatrix:o}=this,r=nt();kt(r,r,a),kt(r,r,o),this.viewProjectionMatrix=r;const i=nt();na(i,i,[t/2,-n/2,1]),Dt(i,i,[1,-1,0]),kt(i,i,r);const l=zc(nt(),i);if(!l)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=i,this.pixelUnprojectionMatrix=l}projectFlat(t){return Se(t)}unprojectFlat(t){return Oe(t)}getMapCenterByLngLatPosition({lngLat:t,pos:n}){const a=Ns(n,this.pixelUnprojectionMatrix),o=Se(t),r=ks([],o,Ac([],a)),i=ks([],this.center,r);return Oe(i)}fitBounds(t,n={}){const{width:a,height:o}=this,{longitude:r,latitude:i,zoom:l}=sd(Object.assign({width:a,height:o,bounds:t},n));return new it({width:a,height:o,longitude:r,latitude:i,zoom:l})}getBounds(t){const n=this.getBoundingRegion(t),a=Math.min(...n.map(l=>l[0])),o=Math.max(...n.map(l=>l[0])),r=Math.min(...n.map(l=>l[1])),i=Math.max(...n.map(l=>l[1]));return[[a,r],[o,i]]}getBoundingRegion(t={}){return ad(this,t.z||0)}getLocationAtPoint({lngLat:t,pos:n}){return this.getMapCenterByLngLatPosition({lngLat:t,pos:n})}}function od(e,t,n={}){const a={type:"Feature"};return(n.id===0||n.id)&&(a.id=n.id),n.bbox&&(a.bbox=n.bbox),a.properties=t||{},a.geometry=e,a}function ia(e,t,n={}){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Es(e[0])||!Es(e[1]))throw new Error("coordinates must contain numbers");return od({type:"Point",coordinates:e},t,n)}function rd(e,t={}){const n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function Es(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function la(e,t,n){if(e!==null)for(var a,o,r,i,l,d,c,u=0,m=0,b,w=e.type,x=w==="FeatureCollection",j=w==="Feature",_=x?e.features.length:1,f=0;f<_;f++){c=x?e.features[f].geometry:j?e.geometry:e,b=c?c.type==="GeometryCollection":!1,l=b?c.geometries.length:1;for(var k=0;k<l;k++){var v=0,p=0;if(i=b?c.geometries[k]:c,i!==null){d=i.coordinates;var y=i.type;switch(u=0,y){case null:break;case"Point":if(t(d,m,f,v,p)===!1)return!1;m++,v++;break;case"LineString":case"MultiPoint":for(a=0;a<d.length;a++){if(t(d[a],m,f,v,p)===!1)return!1;m++,y==="MultiPoint"&&v++}y==="LineString"&&v++;break;case"Polygon":case"MultiLineString":for(a=0;a<d.length;a++){for(o=0;o<d[a].length-u;o++){if(t(d[a][o],m,f,v,p)===!1)return!1;m++}y==="MultiLineString"&&v++,y==="Polygon"&&p++}y==="Polygon"&&v++;break;case"MultiPolygon":for(a=0;a<d.length;a++){for(p=0,o=0;o<d[a].length;o++){for(r=0;r<d[a][o].length-u;r++){if(t(d[a][o][r],m,f,v,p)===!1)return!1;m++}p++}v++}break;case"GeometryCollection":for(a=0;a<i.geometries.length;a++)if(la(i.geometries[a],t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function ca(e,t={}){if(e.bbox!=null&&t.recompute!==!0)return e.bbox;const n=[1/0,1/0,-1/0,-1/0];return la(e,a=>{n[0]>a[0]&&(n[0]=a[0]),n[1]>a[1]&&(n[1]=a[1]),n[2]<a[0]&&(n[2]=a[0]),n[3]<a[1]&&(n[3]=a[1])}),n}var id=ca;function ld(e,t={}){const n=ca(e),a=(n[0]+n[2])/2,o=(n[1]+n[3])/2;return ia([a,o],t.properties,t)}var cd=ld,Ct,Ps;function dd(){if(Ps)return Ct;Ps=1;var e=Lr(),t=Ar(),n=Rr(),a=Ir(),o=e.isFinite,r=Math.min;function i(l){var d=Math[l];return function(c,u){if(c=n(c),u=u==null?0:r(t(u),292),u&&o(c)){var m=(a(c)+"e").split("e"),b=d(m[0]+"e"+(+m[1]+u));return m=(a(b)+"e").split("e"),+(m[0]+"e"+(+m[1]-u))}return d(c)}}return Ct=i,Ct}var St,Ls;function ud(){if(Ls)return St;Ls=1;var e=dd(),t=e("round");return St=t,St}var md=ud();const me=Ma(md),hd=h.createContext(null);function fd(e,t){const n=Array.isArray(e)?e[0]:e?e.x:0,a=Array.isArray(e)?e[1]:e?e.y:0,o=Array.isArray(t)?t[0]:t?t.x:0,r=Array.isArray(t)?t[1]:t?t.y:0;return n===o&&a===r}function re(e,t){if(e===t)return!0;if(!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!re(e[n],t[n]))return!1;return!0}else if(Array.isArray(t))return!1;if(typeof e=="object"&&typeof t=="object"){const n=Object.keys(e),a=Object.keys(t);if(n.length!==a.length)return!1;for(const o of n)if(!t.hasOwnProperty(o)||!re(e[o],t[o]))return!1;return!0}return!1}function pd(e){const t=e.clone();return t.pixelsToGLUnits=e.pixelsToGLUnits,t}function As(e,t){if(!e.getProjection)return;const n=e.getProjection(),a=t.getProjection();re(n,a)||t.setProjection(n)}function Rs(e){return{longitude:e.center.lng,latitude:e.center.lat,zoom:e.zoom,pitch:e.pitch,bearing:e.bearing,padding:e.padding}}function Is(e,t){const n=t.viewState||t;let a=!1;if("longitude"in n&&"latitude"in n){const o=e.center;e.center=new o.constructor(n.longitude,n.latitude),a=a||o!==e.center}if("zoom"in n){const o=e.zoom;e.zoom=n.zoom,a=a||o!==e.zoom}if("bearing"in n){const o=e.bearing;e.bearing=n.bearing,a=a||o!==e.bearing}if("pitch"in n){const o=e.pitch;e.pitch=n.pitch,a=a||o!==e.pitch}return n.padding&&!e.isPaddingEqual(n.padding)&&(a=!0,e.padding=n.padding),a}const gd=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ds(e){if(!e)return null;if(typeof e=="string"||("toJS"in e&&(e=e.toJS()),!e.layers))return e;const t={};for(const a of e.layers)t[a.id]=a;const n=e.layers.map(a=>{let o=null;"interactive"in a&&(o=Object.assign({},a),delete o.interactive);const r=t[a.ref];if(r){o=o||Object.assign({},a),delete o.ref;for(const i of gd)i in r&&(o[i]=r[i])}return o||a});return{...e,layers:n}}var Fs={};const Os={version:8,sources:{},layers:[]},zs={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Mt={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},Bs={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},xd=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],yd=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class $e{constructor(t,n,a){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=o=>{const r=this.props[Bs[o.type]];r?r(o):o.type==="error"&&console.error(o.error)},this._onPointerEvent=o=>{(o.type==="mousemove"||o.type==="mouseout")&&this._updateHover(o);const r=this.props[zs[o.type]];r&&(this.props.interactiveLayerIds&&o.type!=="mouseover"&&o.type!=="mouseout"&&(o.features=this._hoveredFeatures||this._queryRenderedFeatures(o.point)),r(o),delete o.features)},this._onCameraEvent=o=>{if(!this._internalUpdate){const r=this.props[Mt[o.type]];r&&r(o)}o.type in this._deferredEvents&&(this._deferredEvents[o.type]=!1)},this._MapClass=t,this.props=n,this._initialize(a)}get map(){return this._map}get transform(){return this._renderTransform}setProps(t){const n=this.props;this.props=t;const a=this._updateSettings(t,n);a&&this._createShadowTransform(this._map);const o=this._updateSize(t),r=this._updateViewState(t,!0);this._updateStyle(t,n),this._updateStyleComponents(t,n),this._updateHandlers(t,n),(a||o||r&&!this._map.isMoving())&&this.redraw()}static reuse(t,n){const a=$e.savedMaps.pop();if(!a)return null;const o=a.map,r=o.getContainer();for(n.className=r.className;r.childNodes.length>0;)n.appendChild(r.childNodes[0]);o._container=n;const i=o._resizeObserver;i&&(i.disconnect(),i.observe(n)),a.setProps({...t,styleDiffing:!1}),o.resize();const{initialViewState:l}=t;return l&&(l.bounds?o.fitBounds(l.bounds,{...l.fitBoundsOptions,duration:0}):a._updateViewState(l,!1)),o.isStyleLoaded()?o.fire("load"):o.once("styledata",()=>o.fire("load")),o._update(),a}_initialize(t){const{props:n}=this,{mapStyle:a=Os}=n,o={...n,...n.initialViewState,accessToken:n.mapboxAccessToken||bd()||null,container:t,style:Ds(a)},r=o.initialViewState||o.viewState||o;if(Object.assign(o,{center:[r.longitude||0,r.latitude||0],zoom:r.zoom||0,pitch:r.pitch||0,bearing:r.bearing||0}),n.gl){const u=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=u,n.gl)}const i=new this._MapClass(o);r.padding&&i.setPadding(r.padding),n.cursor&&(i.getCanvas().style.cursor=n.cursor),this._createShadowTransform(i);const l=i._render;i._render=u=>{this._inRender=!0,l.call(i,u),this._inRender=!1};const d=i._renderTaskQueue.run;i._renderTaskQueue.run=u=>{d.call(i._renderTaskQueue,u),this._onBeforeRepaint()},i.on("render",()=>this._onAfterRepaint());const c=i.fire;i.fire=this._fireEvent.bind(this,c),i.on("resize",()=>{this._renderTransform.resize(i.transform.width,i.transform.height)}),i.on("styledata",()=>{this._updateStyleComponents(this.props,{}),As(i.transform,this._renderTransform)}),i.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const u in zs)i.on(u,this._onPointerEvent);for(const u in Mt)i.on(u,this._onCameraEvent);for(const u in Bs)i.on(u,this._onEvent);this._map=i}recycle(){const n=this.map.getContainer().querySelector("[mapboxgl-children]");n?.remove(),$e.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const t=this._map;!this._inRender&&t.style&&(t._frame&&(t._frame.cancel(),t._frame=null),t._render())}_createShadowTransform(t){const n=pd(t.transform);t.painter.transform=n,this._renderTransform=n}_updateSize(t){const{viewState:n}=t;if(n){const a=this._map;if(n.width!==a.transform.width||n.height!==a.transform.height)return a.resize(),!0}return!1}_updateViewState(t,n){if(this._internalUpdate)return!1;const a=this._map,o=this._renderTransform,{zoom:r,pitch:i,bearing:l}=o,d=a.isMoving();d&&(o.cameraElevationReference="sea");const c=Is(o,{...Rs(a.transform),...t});if(d&&(o.cameraElevationReference="ground"),c&&n){const u=this._deferredEvents;u.move=!0,u.zoom||(u.zoom=r!==o.zoom),u.rotate||(u.rotate=l!==o.bearing),u.pitch||(u.pitch=i!==o.pitch)}return d||Is(a.transform,t),c}_updateSettings(t,n){const a=this._map;let o=!1;for(const r of xd)if(r in t&&!re(t[r],n[r])){o=!0;const i=a[`set${r[0].toUpperCase()}${r.slice(1)}`];i?.call(a,t[r])}return o}_updateStyle(t,n){if(t.cursor!==n.cursor&&(this._map.getCanvas().style.cursor=t.cursor||""),t.mapStyle!==n.mapStyle){const{mapStyle:a=Os,styleDiffing:o=!0}=t,r={diff:o};return"localIdeographFontFamily"in t&&(r.localIdeographFontFamily=t.localIdeographFontFamily),this._map.setStyle(Ds(a),r),!0}return!1}_updateStyleComponents(t,n){const a=this._map;let o=!1;return a.isStyleLoaded()&&("light"in t&&a.setLight&&!re(t.light,n.light)&&(o=!0,a.setLight(t.light)),"fog"in t&&a.setFog&&!re(t.fog,n.fog)&&(o=!0,a.setFog(t.fog)),"terrain"in t&&a.setTerrain&&!re(t.terrain,n.terrain)&&(!t.terrain||a.getSource(t.terrain.source))&&(o=!0,a.setTerrain(t.terrain))),o}_updateHandlers(t,n){var a,o;const r=this._map;let i=!1;for(const l of yd){const d=(a=t[l])!==null&&a!==void 0?a:!0,c=(o=n[l])!==null&&o!==void 0?o:!0;re(d,c)||(i=!0,d?r[l].enable(d):r[l].disable())}return i}_queryRenderedFeatures(t){const n=this._map,a=n.transform,{interactiveLayerIds:o=[]}=this.props;try{return n.transform=this._renderTransform,n.queryRenderedFeatures(t,{layers:o.filter(n.getLayer.bind(n))})}catch{return[]}finally{n.transform=a}}_updateHover(t){var n;const{props:a}=this;if(a.interactiveLayerIds&&(a.onMouseMove||a.onMouseEnter||a.onMouseLeave)){const r=t.type,i=((n=this._hoveredFeatures)===null||n===void 0?void 0:n.length)>0,l=this._queryRenderedFeatures(t.point),d=l.length>0;!d&&i&&(t.type="mouseleave",this._onPointerEvent(t)),this._hoveredFeatures=l,d&&!i&&(t.type="mouseenter",this._onPointerEvent(t)),t.type=r}else this._hoveredFeatures=null}_fireEvent(t,n,a){const o=this._map,r=o.transform,i=typeof n=="string"?n:n.type;return i==="move"&&this._updateViewState(this.props,!1),i in Mt&&(typeof n=="object"&&(n.viewState=Rs(r)),this._map.isMoving())?(o.transform=this._renderTransform,t.call(o,n,a),o.transform=r,o):(t.call(o,n,a),o)}_onBeforeRepaint(){const t=this._map;this._internalUpdate=!0;for(const a in this._deferredEvents)this._deferredEvents[a]&&t.fire(a);this._internalUpdate=!1;const n=this._map.transform;t.transform=this._renderTransform,this._onAfterRepaint=()=>{As(this._renderTransform,n),t.transform=n}}}$e.savedMaps=[];function bd(){let e=null;if(typeof location<"u"){const t=/access_token=([^&\/]*)/.exec(location.search);e=t&&t[1]}try{e=e||Fs.MapboxAccessToken}catch{}try{e=e||Fs.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return e}const wd=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function vd(e){if(!e)return null;const t=e.map,n={getMap:()=>t,getCenter:()=>e.transform.center,getZoom:()=>e.transform.zoom,getBearing:()=>e.transform.bearing,getPitch:()=>e.transform.pitch,getPadding:()=>e.transform.padding,getBounds:()=>e.transform.getBounds(),project:a=>{const o=t.transform;t.transform=e.transform;const r=t.project(a);return t.transform=o,r},unproject:a=>{const o=t.transform;t.transform=e.transform;const r=t.unproject(a);return t.transform=o,r},queryTerrainElevation:(a,o)=>{const r=t.transform;t.transform=e.transform;const i=t.queryTerrainElevation(a,o);return t.transform=r,i},queryRenderedFeatures:(a,o)=>{const r=t.transform;t.transform=e.transform;const i=t.queryRenderedFeatures(a,o);return t.transform=r,i}};for(const a of _d(t))!(a in n)&&!wd.includes(a)&&(n[a]=t[a].bind(t));return n}function _d(e){const t=new Set;let n=e;for(;n;){for(const a of Object.getOwnPropertyNames(n))a[0]!=="_"&&typeof e[a]=="function"&&a!=="fire"&&a!=="setEventedParent"&&t.add(a);n=Object.getPrototypeOf(n)}return Array.from(t)}const jd=typeof document<"u"?h.useLayoutEffect:h.useEffect,kd=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function Cd(e,t){for(const a of kd)a in t&&(e[a]=t[a]);const{RTLTextPlugin:n="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=t;n&&e.getRTLTextPluginStatus&&e.getRTLTextPluginStatus()==="unavailable"&&e.setRTLTextPlugin(n,a=>{a&&console.error(a)},!0)}const xt=h.createContext(null);function Sd(e,t,n){const a=h.useContext(hd),[o,r]=h.useState(null),i=h.useRef(),{current:l}=h.useRef({mapLib:null,map:null});h.useEffect(()=>{const u=e.mapLib;let m=!0,b;return Promise.resolve(u||n).then(w=>{if(!m)return;if(!w)throw new Error("Invalid mapLib");const x="Map"in w?w:w.default;if(!x.Map)throw new Error("Invalid mapLib");if(Cd(x,e),!x.supported||x.supported(e))e.reuseMaps&&(b=$e.reuse(e,i.current)),b||(b=new $e(x.Map,e,i.current)),l.map=vd(b),l.mapLib=x,r(b),a?.onMapMount(l.map,e.id);else throw new Error("Map is not supported by this browser")}).catch(w=>{const{onError:x}=e;x?x({type:"error",target:null,originalEvent:null,error:w}):console.error(w)}),()=>{m=!1,b&&(a?.onMapUnmount(e.id),e.reuseMaps?b.recycle():b.destroy())}},[]),jd(()=>{o&&o.setProps(e)}),h.useImperativeHandle(t,()=>l.map,[o]);const d=h.useMemo(()=>({position:"relative",width:"100%",height:"100%",...e.style}),[e.style]),c={height:"100%"};return h.createElement("div",{id:e.id,ref:i,style:d},o&&h.createElement(xt.Provider,{value:l},h.createElement("div",{"mapboxgl-children":"",style:c},e.children)))}const Md=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function ke(e,t){if(!e||!t)return;const n=e.style;for(const a in t){const o=t[a];Number.isFinite(o)&&!Md.test(a)?n[a]=`${o}px`:n[a]=o}}function Nd(e,t){const{map:n,mapLib:a}=h.useContext(xt),o=h.useRef({props:e});o.current.props=e;const r=h.useMemo(()=>{let j=!1;h.Children.forEach(e.children,k=>{k&&(j=!0)});const _={...e,element:j?document.createElement("div"):null},f=new a.Marker(_);return f.setLngLat([e.longitude,e.latitude]),f.getElement().addEventListener("click",k=>{var v,p;(p=(v=o.current.props).onClick)===null||p===void 0||p.call(v,{type:"click",target:f,originalEvent:k})}),f.on("dragstart",k=>{var v,p;const y=k;y.lngLat=r.getLngLat(),(p=(v=o.current.props).onDragStart)===null||p===void 0||p.call(v,y)}),f.on("drag",k=>{var v,p;const y=k;y.lngLat=r.getLngLat(),(p=(v=o.current.props).onDrag)===null||p===void 0||p.call(v,y)}),f.on("dragend",k=>{var v,p;const y=k;y.lngLat=r.getLngLat(),(p=(v=o.current.props).onDragEnd)===null||p===void 0||p.call(v,y)}),f},[]);h.useEffect(()=>(r.addTo(n.getMap()),()=>{r.remove()}),[]);const{longitude:i,latitude:l,offset:d,style:c,draggable:u=!1,popup:m=null,rotation:b=0,rotationAlignment:w="auto",pitchAlignment:x="auto"}=e;return h.useEffect(()=>{ke(r.getElement(),c)},[c]),h.useImperativeHandle(t,()=>r,[]),(r.getLngLat().lng!==i||r.getLngLat().lat!==l)&&r.setLngLat([i,l]),d&&!fd(r.getOffset(),d)&&r.setOffset(d),r.isDraggable()!==u&&r.setDraggable(u),r.getRotation()!==b&&r.setRotation(b),r.getRotationAlignment()!==w&&r.setRotationAlignment(w),r.getPitchAlignment()!==x&&r.setPitchAlignment(x),r.getPopup()!==m&&r.setPopup(m),hn.createPortal(e.children,r.getElement())}const Td=h.memo(h.forwardRef(Nd));function Ws(e){return new Set(e?e.trim().split(/\s+/):[])}function $d(e,t){const{map:n,mapLib:a}=h.useContext(xt),o=h.useMemo(()=>document.createElement("div"),[]),r=h.useRef({props:e});r.current.props=e;const i=h.useMemo(()=>{const l={...e},d=new a.Popup(l);return d.setLngLat([e.longitude,e.latitude]),d.once("open",c=>{var u,m;(m=(u=r.current.props).onOpen)===null||m===void 0||m.call(u,c)}),d},[]);if(h.useEffect(()=>{const l=d=>{var c,u;(u=(c=r.current.props).onClose)===null||u===void 0||u.call(c,d)};return i.on("close",l),i.setDOMContent(o).addTo(n.getMap()),()=>{i.off("close",l),i.isOpen()&&i.remove()}},[]),h.useEffect(()=>{ke(i.getElement(),e.style)},[e.style]),h.useImperativeHandle(t,()=>i,[]),i.isOpen()&&((i.getLngLat().lng!==e.longitude||i.getLngLat().lat!==e.latitude)&&i.setLngLat([e.longitude,e.latitude]),e.offset&&!re(i.options.offset,e.offset)&&i.setOffset(e.offset),(i.options.anchor!==e.anchor||i.options.maxWidth!==e.maxWidth)&&(i.options.anchor=e.anchor,i.setMaxWidth(e.maxWidth)),i.options.className!==e.className)){const l=Ws(i.options.className),d=Ws(e.className);for(const c of l)d.has(c)||i.removeClassName(c);for(const c of d)l.has(c)||i.addClassName(c);i.options.className=e.className}return hn.createPortal(e.children,o)}h.memo(h.forwardRef($d));function Je(e,t,n,a){const o=h.useContext(xt),r=h.useMemo(()=>e(o),[]);return h.useEffect(()=>{const i=t,l=null,d=typeof t=="function"?t:null,{map:c}=o;return c.hasControl(r)||(c.addControl(r,i?.position),l&&l(o)),()=>{d&&d(o),c.hasControl(r)&&c.removeControl(r)}},[]),r}function Ed(e){const t=Je(({mapLib:n})=>new n.AttributionControl(e),{position:e.position});return h.useEffect(()=>{ke(t._container,e.style)},[e.style]),null}h.memo(Ed);function Pd(e){const t=Je(({mapLib:n})=>new n.FullscreenControl({container:e.containerId&&document.getElementById(e.containerId)}),{position:e.position});return h.useEffect(()=>{ke(t._controlContainer,e.style)},[e.style]),null}h.memo(Pd);function Ld(e,t){const n=h.useRef({props:e}),a=Je(({mapLib:o})=>{const r=new o.GeolocateControl(e),i=r._setupUI;return r._setupUI=l=>{r._container.hasChildNodes()||i(l)},r.on("geolocate",l=>{var d,c;(c=(d=n.current.props).onGeolocate)===null||c===void 0||c.call(d,l)}),r.on("error",l=>{var d,c;(c=(d=n.current.props).onError)===null||c===void 0||c.call(d,l)}),r.on("outofmaxbounds",l=>{var d,c;(c=(d=n.current.props).onOutOfMaxBounds)===null||c===void 0||c.call(d,l)}),r.on("trackuserlocationstart",l=>{var d,c;(c=(d=n.current.props).onTrackUserLocationStart)===null||c===void 0||c.call(d,l)}),r.on("trackuserlocationend",l=>{var d,c;(c=(d=n.current.props).onTrackUserLocationEnd)===null||c===void 0||c.call(d,l)}),r},{position:e.position});return n.current.props=e,h.useImperativeHandle(t,()=>a,[]),h.useEffect(()=>{ke(a._container,e.style)},[e.style]),null}h.memo(h.forwardRef(Ld));function Ad(e){const t=Je(({mapLib:n})=>new n.NavigationControl(e),{position:e.position});return h.useEffect(()=>{ke(t._container,e.style)},[e.style]),null}h.memo(Ad);function Rd(e){const t=Je(({mapLib:r})=>new r.ScaleControl(e),{position:e.position}),n=h.useRef(e),a=n.current;n.current=e;const{style:o}=e;return e.maxWidth!==void 0&&e.maxWidth!==a.maxWidth&&(t.options.maxWidth=e.maxWidth),e.unit!==void 0&&e.unit!==a.unit&&t.setUnit(e.unit),h.useEffect(()=>{ke(t._container,o)},[o]),null}h.memo(Rd);const Id=Jt(()=>import("./l9wqdp1695odsw0u.js").then(e=>e.m),__vite__mapDeps([11,1])),Dd=h.forwardRef(function(t,n){return Sd(t,n,Id)}),Fd=Td,Od="pk.eyJ1Ijoib2FpLWRhdGEiLCJhIjoiY20yYzRzZmFtMGNqNjJscHo2dThqdnkwNCJ9.rTosfWNn9lUu4slvYfMzHg",zd=e=>h.createElement("svg",{width:20,height:20,viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",...e},h.createElement("path",{d:"M10.001 1.83594C13.9484 1.83594 17.1659 4.90441 17.166 8.9873C17.166 11.8368 15.3695 14.1317 13.7002 15.6592C12.8541 16.4334 12.0106 17.0381 11.3799 17.4492C11.0639 17.6552 10.7992 17.8141 10.6123 17.9219C10.5189 17.9757 10.4443 18.0166 10.3926 18.0449C10.3667 18.059 10.3463 18.0705 10.332 18.0781C10.3251 18.0818 10.3195 18.0848 10.3154 18.0869C10.3134 18.088 10.3118 18.0892 10.3105 18.0898L10.3086 18.0908L10.001 17.501L10.3076 18.0908C10.1144 18.1913 9.88417 18.1912 9.69141 18.0898L10.001 17.501L9.69043 18.0889L9.68848 18.0879C9.68724 18.0872 9.68554 18.086 9.68359 18.085C9.67954 18.0828 9.67396 18.0799 9.66699 18.0762C9.65272 18.0685 9.63232 18.0573 9.60645 18.043C9.55471 18.0144 9.48007 17.9733 9.38672 17.9189C9.19995 17.8102 8.93589 17.6498 8.62012 17.4424C7.98975 17.0283 7.14642 16.4199 6.30078 15.6436C4.63333 14.1126 2.83594 11.8176 2.83594 8.9873C2.83602 4.90441 6.05356 1.83594 10.001 1.83594Z",fill:"rgb(85, 84, 84)",stroke:"rgb(85, 84, 84)",strokeWidth:1,strokeLinejoin:"round",paintOrder:"stroke fill"}),h.createElement("circle",{cx:10,cy:9,r:3,fill:"white"})),Bd=e=>h.createElement("svg",{width:20,height:20,viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",...e},h.createElement("path",{d:"M10.001 1.83594C13.9484 1.83594 17.1659 4.90441 17.166 8.9873C17.166 11.8368 15.3695 14.1317 13.7002 15.6592C12.8541 16.4334 12.0106 17.0381 11.3799 17.4492C11.0639 17.6552 10.7992 17.8141 10.6123 17.9219C10.5189 17.9757 10.4443 18.0166 10.3926 18.0449C10.3667 18.059 10.3463 18.0705 10.332 18.0781C10.3251 18.0818 10.3195 18.0848 10.3154 18.0869C10.3134 18.088 10.3118 18.0892 10.3105 18.0898L10.3086 18.0908L10.001 17.501L10.3076 18.0908C10.1144 18.1913 9.88417 18.1912 9.69141 18.0898L10.001 17.501L9.69043 18.0889L9.68848 18.0879C9.68724 18.0872 9.68554 18.086 9.68359 18.085C9.67954 18.0828 9.67396 18.0799 9.66699 18.0762C9.65272 18.0685 9.63232 18.0573 9.60645 18.043C9.55471 18.0144 9.48007 17.9733 9.38672 17.9189C9.19995 17.8102 8.93589 17.6498 8.62012 17.4424C7.98975 17.0283 7.14642 16.4199 6.30078 15.6436C4.63333 14.1126 2.83594 11.8176 2.83594 8.9873C2.83602 4.90441 6.05356 1.83594 10.001 1.83594Z",fill:"white",stroke:"rgb(85, 84, 84)",strokeWidth:1,strokeLinejoin:"round",paintOrder:"stroke fill"}),h.createElement("circle",{cx:10,cy:9,r:3,fill:"rgb(85, 84, 84)"})),Hs=50,Us=20,Vs=20,qs=20,Wd=420;function Hd(e){"use forget";const t=Ve.c(37),{contentReference:n,clientThreadId:a,messageId:o,trackContentReferenceEvent:r}=e,i=n.entities,l=h.useRef(!0),d=h.useRef(null),c=h.useRef(null);let u;t[0]===Symbol.for("react.memo_cache_sentinel")?(u={longitude:0,latitude:0,zoom:12,pitch:0,bearing:0},t[0]=u):u=t[0];const[m,b]=h.useState(u),[w,x]=h.useState(-1),j=h.useRef(w);let _;t[1]===Symbol.for("react.memo_cache_sentinel")?(_=O=>{j.current=O,x(O)},t[1]=_):_=t[1];const f=_,k=!Qt(),v=h.useRef(!1);let p,y;t[2]!==r?(p=()=>{v.current||(r("Search Content Reference Shown","search_content_reference_shown","map"),v.current=!0)},y=[r],t[2]=r,t[3]=p,t[4]=y):(p=t[3],y=t[4]),h.useEffect(p,y);let C,M;t[5]===Symbol.for("react.memo_cache_sentinel")?(C=()=>{if(!d.current)return;const O=Fn(()=>{c.current?.resize()},100),D=new ResizeObserver(O);return D.observe(d.current),()=>{D.disconnect()}},M=[],t[5]=C,t[6]=M):(C=t[5],M=t[6]),h.useEffect(C,M);let g,N;t[7]!==i||t[8]!==w?(g=()=>{const O=function(){const q=function(U,G){const J=c.current;if(!J)return!1;const{width:Y,height:Ae}=J.getContainer().getBoundingClientRect(),Qe=J.unproject([Us,Hs]),ls=J.unproject([Y-Vs,Ae-qs]);return me(U,5)>=me(ls.lat,5)&&me(U,5)<=me(Qe.lat,5)&&me(G,5)>=me(Qe.lng,5)&&me(G,5)<=me(ls.lng,5)},I=rd(i.filter((K,U)=>l.current||w===-1||U===w).map(Vd)),z=id(I),ue=cd(I);if(d.current){const K=d.current.clientWidth,U=d.current.clientHeight,G=new it({width:K,height:U,longitude:ue.geometry.coordinates[0],latitude:ue.geometry.coordinates[1]}),{zoom:J,latitude:Y,longitude:Ae}=G.fitBounds([[z[0],z[1]],[z[2],z[3]]],{maxZoom:13.5,padding:{top:Hs,left:Us,right:Vs,bottom:qs}});l.current?(b(Qe=>({...Qe,zoom:J,latitude:Y,longitude:Ae})),l.current=!1):q(Y,Ae)||c.current?.flyTo({center:[Ae,Y]})}};i.length!==0&&(l.current?O():setTimeout(O,200))},N=[i,w],t[7]=i,t[8]=w,t[9]=g,t[10]=N):(g=t[9],N=t[10]),h.useEffect(g,N);const{openThreadSidebar:$}=Xe(),{resetSidebarHistory:L}=kn(),A=Cn();let R;t[11]!==a||t[12]!==n.start_idx||t[13]!==A||t[14]!==o||t[15]!==$||t[16]!==L?(R=(O,D)=>{f(O),a&&(A||L(),$({type:"entity",clientThreadId:a,debugThreadId:void 0,messageId:o,contentReferenceStartIndex:n.start_idx,query:D.name,category:"local_business"}))},t[11]=a,t[12]=n.start_idx,t[13]=A,t[14]=o,t[15]=$,t[16]=L,t[17]=R):R=t[17];const E=R,W=Ke();let se;if(t[18]!==i||t[19]!==W||t[20]!==E||t[21]!==w||t[22]!==r){let O;t[24]!==w?(O=(q,I)=>q.idx===w?1:I.idx===w?-1:q.idx-I.idx,t[24]=w,t[25]=O):O=t[25];let D;t[26]!==W||t[27]!==E||t[28]!==w||t[29]!==r?(D=q=>{const{business:I,idx:z}=q,K=z==w?zd:Bd;return s.jsx(Fd,{longitude:I.longitude,latitude:I.latitude,anchor:"bottom",children:s.jsx(Z,{label:s.jsx(qd,{business:I.entity,idx:z,trackContentReferenceEvent:r,onOpenEntity:()=>E(z,I)}),onOpenChange:U=>f(U?z:-1),delayDuration:150,theme:W?"default":"white",customPaddingClassName:"p-0",cornerRadius:"xl",customBorderClassName:"border-token-border-default border",contentClassName:"animate-show",side:"top",sideOffset:10,wide:!0,interactive:!0,children:s.jsxs("div",{className:"relative",children:[s.jsx(K,{className:"h-auto w-7"}),s.jsx("div",{className:"absolute start-1/2 top-full -translate-x-1/2 font-bold text-nowrap text-gray-700 [text-shadow:_-0.8px_-0.8px_0_#fff,_0.8px_-0.8px_0_#fff,_-0.8px_0.8px_0_#fff,_0.8px_0.8px_0_#fff]",children:I.name}),s.jsx("div",{className:"absolute inset-0 cursor-pointer rounded-xl",onClick:U=>{U.preventDefault(),f(z),E(z,I)}})]})},z)},z)},t[26]=W,t[27]=E,t[28]=w,t[29]=r,t[30]=D):D=t[30],se=i.map(Ud).sort(O).map(D),t[18]=i,t[19]=W,t[20]=E,t[21]=w,t[22]=r,t[23]=se}else se=t[23];const ce=se;let ne;t[31]!==k||t[32]!==ce||t[33]!==m?(ne=!k&&s.jsx("div",{className:"bg-token-bg-primary pt-2",children:s.jsxs("div",{style:{height:Wd},className:"bg-token-bg-primary relative w-full",ref:d,children:[s.jsx("div",{className:"relative h-full w-full overflow-hidden rounded-xl",children:s.jsx(Dd,{...m,mapboxAccessToken:Od,mapStyle:"mapbox://styles/mapbox/streets-v12",attributionControl:!1,renderWorldCopies:!1,onMove:O=>b(O.viewState),ref:c,keyboard:!1,children:ce})}),s.jsx("div",{className:"absolute start-3 top-3",children:s.jsx(Yd,{})})]})}),t[31]=k,t[32]=ce,t[33]=m,t[34]=ne):ne=t[34];let de;return t[35]!==ne?(de=s.jsx(Or,{children:s.jsx("div",{className:"not-prose","data-testid":"businesses-map-widget",children:ne})}),t[35]=ne,t[36]=de):de=t[36],de}function Ud(e,t){return{business:e,idx:t}}function Vd(e){return ia([e.longitude,e.latitude])}function qd({business:e,idx:t,trackContentReferenceEvent:n,onOpenEntity:a}){const o=!Qt(),r={section:"map",section_location:"response",section_index:t},i=`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent([e.name,e.address].join(","))}`;e.address&&n("link_action",null,"map",{...r,url:i,link_type:"button",action:"show"}),e.website_url&&n("link_action",null,"map",{...r,url:e.website_url,link_type:"button",action:"show"});function l(){return s.jsx(s.Fragment,{children:s.jsxs("div",{className:"text-token-text-primary mt-auto flex min-h-9 w-full min-w-0 flex-wrap justify-center gap-2 text-base",children:[e.address&&s.jsx(ee,{onClick:()=>{n("link_action",null,"map",{...r,url:i,link_type:"button",action:"click"})},as:"link",to:i,openNewTab:!0,rel:"noreferrer",color:"secondary",size:"small",className:"min-w-25 flex-1 rounded-full border",contentWrapperClassName:"text-token-text-primary font-semibold",children:s.jsx(T,{id:"+a2f/C",defaultMessage:"Directions"})}),e.website_url&&s.jsx(ee,{onClick:()=>{n("link_action",null,"map",{...r,url:e.website_url,link_type:"button",action:"click"})},as:"link",to:e.website_url,openNewTab:!0,rel:"noreferrer",color:"secondary",size:"small",className:"min-w-25 flex-1 rounded-full border",contentWrapperClassName:"text-token-text-primary font-semibold",children:s.jsx(T,{id:"r0oqXM",defaultMessage:"Website"})}),e.phone&&s.jsx(ee,{as:"link",to:"tel:"+e.phone,openNewTab:!0,rel:"noreferrer",color:"secondary",size:"small",className:"min-w-25 flex-1 rounded-full border",contentWrapperClassName:"text-token-text-primary font-semibold",children:s.jsx(T,{id:"B/an6M",defaultMessage:"Call"})})]})})}const d=e.image_urls?.[0];return s.jsx(he.div,{initial:{x:"0%",opacity:0,pointerEvents:"none",transition:{duration:.1,ease:"easeOut"}},animate:{x:"0%",opacity:1,pointerEvents:"auto",transition:{duration:.15,ease:"easeOut"}},children:s.jsxs("div",{className:S("bg-token-main-surface-primary relative rounded-xl text-start font-normal"),children:[s.jsxs("div",{className:"flex flex-col gap-2 p-3",children:[s.jsxs("div",{className:"flex gap-3",children:[s.jsx("div",{className:"h-23 w-23 shrink-0 cursor-pointer overflow-hidden rounded-lg",onClick:c=>{c.preventDefault(),a?.()},children:d?s.jsx("img",{className:"h-full w-full object-cover",src:d??void 0,alt:e.name}):s.jsx("div",{className:"h-full w-full bg-gray-100"})}),s.jsxs("div",{className:"flex min-w-0 flex-1 flex-col",children:[s.jsx("div",{className:"hover:entity-accent line-clamp-2 inline w-full cursor-pointer align-baseline text-base font-semibold",onClick:c=>{c.preventDefault(),a?.()},children:e.name}),s.jsx("div",{className:"text-token-text-secondary text-sm",children:s.jsx(Gd,{business:e})})]})]}),!o&&s.jsx("div",{className:"mt-1",children:l()})]}),o&&l()]})})}function Gd({business:e}){const t=P(),n=e.categories?.[0]??null,a=e.next_open_hour;let o=null,r;e.is_open!=null&&(o=e.is_open?t.formatMessage({id:"rNSVso",defaultMessage:"Open now"}):t.formatMessage({id:"3WBPtG",defaultMessage:"Closed"}),a&&(r=a.day===new Date().getDay()?t.formatMessage({id:"3IYYo+",defaultMessage:"until {time}"},{time:Gs(t,e.is_open?a.end:a.start)}):t.formatMessage({id:"R23xLn",defaultMessage:"until {day} {time}"},{day:Zd(t,a.day),time:Gs(t,e.is_open?a.end:a.start)})));const i=e.rating,l=e.price!=null?"$".repeat(e.price):e.price_str!=null?e.price_str:null;return s.jsxs("div",{className:"flex flex-col gap-0.5",children:[n&&s.jsx("div",{className:"truncate",children:n}),o&&s.jsxs("div",{children:[s.jsx("span",{className:e.is_open?"text-green-600":"text-red-600",children:o}),r&&s.jsx("span",{className:"ms-1",children:r})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[i!=null&&s.jsxs(s.Fragment,{children:[s.jsx(Sn,{className:"icon-sm text-token-text-secondary"}),s.jsx("span",{className:"text-token-text-primary",children:i.toFixed(1)})]}),l&&s.jsx("span",{className:"text-token-text-secondary mx-1 font-semibold",children:s.jsx(T,{id:"IqwxqE",defaultMessage:"·"})}),l&&s.jsx("span",{className:"text-token-text-secondary",children:l})]})]})}function Gs(e,t){const n=t.slice(0,2),a=t.slice(2,4),o=new Date(0,0,0,parseInt(n,10),parseInt(a,10));return e.formatTime(o,{hour:"numeric",minute:"2-digit"})}function Zd(e,t){return e.formatDate(new Date(0,0,t),{weekday:"short"})}function Yd(){const[e,t]=h.useState(!1),n=()=>t(o=>!o),a=e?Dr:Fr;return s.jsxs("div",{className:S("text-token-text-tertiary flex h-5 items-center justify-start overflow-hidden rounded-full text-[10px] font-light whitespace-nowrap transition-all",e?"w-full bg-white":"w-5 bg-white/50"),children:[s.jsx("button",{onClick:n,className:S("transition-all",e?"ms-1":"ms-[2px] mt-[1px]"),children:s.jsx(a,{className:"icon-sm hover:text-token-text-secondary transition-colors"})}),s.jsxs("div",{className:"ps-1 pe-2",children:["© ",s.jsx("a",{href:"https://www.mapbox.com/about/maps",target:"_blank",rel:"noreferrer",className:"text-[#2964aa]!",children:"Mapbox"})," ",s.jsx("a",{href:"https://www.mapbox.com/legal/end-user-terms",target:"_blank",rel:"noreferrer",className:"me-2 text-[#2964aa]!",children:s.jsx(T,{id:"u3dZJq",defaultMessage:"Terms"})}),"© ",s.jsx("a",{href:"http://www.openstreetmap.org/about",target:"_blank",rel:"noreferrer",className:"text-[#2964aa]!",children:"OpenStreetMap"})]})]})}const oe={TTFP:"products.ttfp",TTLT:"products.ttlt",TTF_VISIBLE_CONTENT_TOKEN:"products.ttf_visible_content_token"},os={[oe.TTFP]:new Set,[oe.TTLT]:new Set,[oe.TTF_VISIBLE_CONTENT_TOKEN]:new Set};function Nt({profiler:e,messageId:t,metric:n,overrideDurationMs:a}){os[n].add(t);const o=Br();e.logTimingOnce(n,{context:{eval_preset:o.eval_preset},overrideDurationMs:a})}function Tt({messageId:e,metric:t}){return os[t].has(e)}function da(e){"use forget";const t=Ve.c(27),{clientThreadId:n,messageId:a,products:o}=e;let r;t[0]!==a?(r=p=>[We.getRequestId(p),We.isMessageTurnEnded(p,a)],t[0]=a,t[1]=r):r=t[1];const[i,l]=qe(n,r);let d;t[2]!==n?(d={namespace:_o.ProductsCompletionRequest,clientThreadId:n},t[2]=n,t[3]=d):d=t[3];const{profiler:c,isRequestActive:u}=vo(d),m=u&&!l,b=Wi(m);let w,x;t[4]!==m||t[5]!==a||t[6]!==o.length||t[7]!==c?(w=()=>{Tt({messageId:a,metric:oe.TTFP})||c&&m&&o.length>0&&Nt({profiler:c,messageId:a,metric:oe.TTFP})},x=[m,a,o.length,c],t[4]=m,t[5]=a,t[6]=o.length,t[7]=c,t[8]=w,t[9]=x):(w=t[8],x=t[9]),h.useEffect(w,x);let j,_;t[10]!==m||t[11]!==a||t[12]!==b||t[13]!==c?(j=()=>{Tt({messageId:a,metric:oe.TTLT})||c&&b.current&&!m&&Nt({profiler:c,messageId:a,metric:oe.TTLT})},_=[a,b,m,c],t[10]=m,t[11]=a,t[12]=b,t[13]=c,t[14]=j,t[15]=_):(j=t[14],_=t[15]),h.useEffect(j,_);const f=B();let k;t[16]!==f||t[17]!==a||t[18]!==c||t[19]!==i?(k=()=>{if(Tt({messageId:a,metric:oe.TTF_VISIBLE_CONTENT_TOKEN}))return;const p=i?zr(f,i):null;if(c&&p){const y=oe.TTF_VISIBLE_CONTENT_TOKEN;os[y].add(a),Nt({profiler:c,messageId:a,metric:y,overrideDurationMs:p.turnTracker.first_visible_content_token_lat})}},t[16]=f,t[17]=a,t[18]=c,t[19]=i,t[20]=k):k=t[20];let v;t[21]!==f||t[22]!==a||t[23]!==o.length||t[24]!==c||t[25]!==i?(v=[a,c,i,o.length,f],t[21]=f,t[22]=a,t[23]=o.length,t[24]=c,t[25]=i,t[26]=v):v=t[26],h.useEffect(k,v)}function Xd({contentReference:e,clientThreadId:t,messageId:n,turnIndex:a,trackContentReferenceEvent:o}){const r=h.useCallback(()=>o("Search Content Reference Shown","search_content_reference_shown","product_entity",{content_reference_start_index:e.start_idx,product_id:e.product.id}),[o,e.start_idx,e.product.id]),i=h.useCallback(()=>o("Search Content Reference Clicked","search_content_reference_clicked","product_entity",{content_reference_start_index:e.start_idx,product_id:e.product.id}),[o,e.start_idx,e.product.id]),l=e.product;h.useEffect(()=>r(),[r]),da({clientThreadId:t,messageId:n,products:[l]});const{openThreadSidebar:d}=Xe();return s.jsx("span",{className:"entity-underline hover:entity-accent inline cursor-pointer align-baseline",onClick:()=>{if(i(),l.offers||!l.url){if(!t)return;d({type:"product",clientThreadId:t,messageId:n,turnIndex:a,contentReferenceStartIndex:e.start_idx,productIndex:0})}else window.open(l.url,"_blank")},children:s.jsx("span",{className:"whitespace-normal",children:l.title})})}function ua({items:e,targetItemCount:t,onCardRender:n,onCardShown:a,onCardClicked:o,onReplyClicked:r,allowFullWidth:i=!1,cardClassName:l,showGradient:d=!0,arrowClassName:c}){const u=h.useRef(null),[m,b]=h.useState(null),w=h.useRef(null),x=()=>{w.current=setTimeout(()=>{b(null),w.current=null},200)},j=()=>{w.current&&(clearTimeout(w.current),w.current=null)},_=h.useRef(null),[f,k]=h.useState({left:0,top:0}),v=8;h.useEffect(()=>{const g=u.current,N=_.current;if(!r||!m||!g||!N)return;const $=()=>{const L=m.card.getBoundingClientRect(),A=g.getBoundingClientRect(),R=N.getBoundingClientRect(),E=L.bottom-A.top+v;var W=L.left-A.left;W=Math.max(0,W),W=Math.min(W,A.width-R.width),k({left:W,top:E})};return $(),g.addEventListener("scroll",$),()=>g.removeEventListener("scroll",$)},[m,e,r]);const p=Ye(),y=p?2:4;if(t===void 0)t=e.length;else if(!t&&e.length<y)return null;const C=(t??e.length)>=y,M=C&&p;return s.jsxs("div",{className:"relative",children:[s.jsx("div",{ref:u,className:S("flex flex-row gap-4 py-2",M&&"mx-[-1rem] px-[1rem]",C&&"no-scrollbar snap-x snap-proximity scroll-ps-4 overflow-x-scroll scroll-smooth"),children:e.map((g,N)=>s.jsx("div",{className:S(C||!i?"thread-lg:w-61 w-50 shrink-0 snap-start":"min-w-0 flex-1"),children:s.jsx(Kd,{cardClassName:l,onShown:()=>a(g,N),onClick:()=>o(g,N),onHover:$=>{j(),$?b({card:$,item:g,index:N}):x()},children:n(g,!p&&t===1)})},N))}),C&&!M&&s.jsx(Jd,{scrollableRef:u,units:e.length,showGradient:d,arrowClassName:c}),r&&s.jsx("div",{ref:_,className:S("absolute z-10",m?"pointer-events-auto opacity-100":"pointer-events-none opacity-0","transition-[transform,opacity] duration-200"),style:{willChange:"opacity, transform",left:f.left,top:f.top,transform:m?"translateY(0)":"translateY(-8px)"},onMouseEnter:j,onMouseLeave:x,children:s.jsx(ee,{className:S(m?"pointer-events-auto":"pointer-events-none","border-light bg-clip-padding px-4 py-2 shadow-md"),size:"small",color:"secondary",onClick:()=>m&&r(m.item,m.index),children:s.jsxs("div",{className:"flex flex-row items-center gap-1",children:[s.jsx(Hi,{className:"icon-sm text-token-text-secondary"}),s.jsx(T,{id:"9TG7OR",defaultMessage:"Ask about this"})]})})})]})}function Kd({onShown:e,onClick:t,onHover:n,children:a,cardClassName:o}){const r=h.useRef(null),i=h.useRef(e);return h.useEffect(()=>{i.current=e},[e]),h.useEffect(()=>{if(!r.current)return;const l=new IntersectionObserver(([d])=>d.isIntersecting&&i.current(),{threshold:.5});return l.observe(r.current),()=>l.disconnect()},[]),s.jsx("div",{ref:r,className:S("h-full w-full","bg-token-bg-primary cursor-pointer",o),onClick:t,onMouseEnter:()=>r.current&&n(r.current),onMouseLeave:()=>n(null),children:a})}function Jd({scrollableRef:e,units:t,showGradient:n,arrowClassName:a}){const[o,r]=h.useState({left:!1,right:!1}),[i,l]=h.useState(!1);h.useEffect(()=>{const c=e.current;if(!c)return;const u=()=>{const{scrollLeft:m,scrollWidth:b,clientWidth:w}=c,x=m/(b-w);r({left:x>0,right:x<1}),!i&&m>0&&l(!0)};return u(),c.addEventListener("scroll",u),()=>c.removeEventListener("scroll",u)},[e,t,i]);const d=c=>{if(!e.current)return;l(!0);const{clientWidth:u,scrollWidth:m}=e.current,b=m/t,w=Math.floor(u/b)*b;e.current.scrollBy({left:w*c,behavior:"smooth"})};return s.jsxs("div",{className:"pointer-events-none absolute start-0 top-0 flex h-full w-full flex-row",children:[s.jsx("div",{className:S("flex h-full w-9 items-center justify-start",i&&n&&"bg-linear-to-r from-(--bg-primary) to-transparent",o.left?"opacity-100":"opacity-0","transition-opacity duration-100"),children:s.jsx(ee,{color:"secondary",size:"small",className:S("border-token-border-default active:bg-token-bg-tertiary hover:bg-token-bg-primary h-10 w-10 translate-x-[-40%] rounded-full bg-clip-padding hover:shadow-[0px_4px_16px_0px_rgba(0,0,0,0.05)] active:opacity-100!",a),onClick:()=>d(-1),children:s.jsx(jo,{className:"icon"})})}),s.jsx("div",{className:S("ms-auto flex h-full w-9 items-center justify-end",i&&n&&"bg-linear-to-l from-(--bg-primary) to-transparent",o.right?"opacity-100":"opacity-0","transition-opacity duration-200"),children:s.jsx(ee,{color:"secondary",size:"small",className:S("border-token-border-default active:bg-token-bg-tertiary hover:bg-token-bg-primary h-10 w-10 translate-x-[40%] rounded-full bg-clip-padding hover:shadow-[0px_4px_16px_0px_rgba(0,0,0,0.05)] active:opacity-100!",a),onClick:()=>d(1),children:s.jsx(Mn,{className:"icon"})})})]})}function Qd({contentReference:e,clientThreadId:t,messageId:n,turnIndex:a,analyticsMetadata:o}){const r=e.products,i=e.target_product_count;da({clientThreadId:t,messageId:n,products:r});const{showDebugConversationTurns:l}=Wr(),d=qe(t,v=>{const y=We.getNode(v,n).message.metadata?.content_references?.find(C=>C.type==="products");return e.start_idx===y?.start_idx}),c=B(),u=F(c,"3144771298"),m=F(c,"2212894775"),b=Nn(o),w=h.useCallback((v,p)=>b("Search Content Reference Shown","search_content_reference_shown","products",{content_reference_start_index:e.start_idx,product_index:p,product_id:v.id}),[b,e.start_idx]),x=h.useCallback((v,p)=>b("Search Content Reference Clicked","search_content_reference_clicked","products",{content_reference_start_index:e.start_idx,product_index:p,product_id:v.id}),[b,e.start_idx]),{openThreadSidebar:j}=Xe(),_=(v,p)=>{t&&(x(v,p),v.offers?j({type:"product",clientThreadId:t,messageId:n,turnIndex:a,contentReferenceStartIndex:e.start_idx,productIndex:p}):window.open(v.url,"_blank"))},{setTargetedContent:f}=ko(),k=(v,p)=>{be.logEventWithStatsig("Product Targeted Reply Clicked","product_targeted_reply_clicked",{...pt(o),content_reference_start_index:e.start_idx,product_index:(p+1).toString(),product_id:v.id}),f({type:"object",label:v.title,createNewCompletionParams:y=>{const C=Hr(v.title);return{...y,promptMessage:Co(y.promptMessage,{metadata:{targeted_reply:v.title,targeted_reply_label:v.title,targeted_reply_icon:"product_tag"}}),appendMessages:[...y.appendMessages??[],C]}},onCreateCompletion:({serverThreadId:y,currentLeafId:C})=>{be.logEventWithStatsig("Targeted Reply Submitted","chatgpt_targeted_reply_submitted",{conversation_id:y,current_leaf_id:C,source_message_id:n,content_reference_start_index:e.start_idx,product_index:(p+1).toString(),product_id:v.id})},onCleared:({serverThreadId:y,currentLeafId:C})=>{be.logEventWithStatsig("Targeted Reply Cleared","chatgpt_targeted_reply_cleared",{conversation_id:y,current_leaf_id:C,source_message_id:n,content_reference_start_index:e.start_idx,product_index:(p+1).toString(),product_id:v.id})}})};if(e.inline_carousel&&r.length===1){const v=r[0];return s.jsx("div",{className:"flex flex-col","data-testid":"shopping-widget",children:s.jsx(nu,{product:v,showDebug:l,onShown:()=>w(v,0),onClicked:()=>_(v,0)})})}return s.jsxs("div",{className:"flex flex-col","data-testid":"products-widget",children:[s.jsx(ua,{items:r,targetItemCount:i,onCardRender:(v,p)=>m?s.jsx(tu,{product:v,wide:p,showDebug:l}):s.jsx(eu,{product:v,wide:p,showDebug:l}),onCardShown:w,onCardClicked:_,onReplyClicked:m?void 0:k,arrowClassName:m?"translate-y-[-80%]":"",allowFullWidth:!0,showGradient:!m,cardClassName:S(m?"group":"transition-all duration-200 border-token-border-default hover:border-light border rounded-xl bg-clip-padding hover:shadow-md overflow-hidden")}),d&&u&&!m&&s.jsxs("div",{className:"text-token-text-tertiary flex text-xs hover:cursor-pointer hover:underline",onClick:()=>window.open("https://help.openai.com/en/articles/11128490","_blank"),children:[s.jsx(T,{id:"4Y5Zn5",defaultMessage:"ChatGPT chooses products independently. Learn more"}),s.jsx(Mn,{className:"icon -ms-0.5"})]})]})}function eu({product:e,wide:t,showDebug:n=!1}){const a=e.image_urls?e.image_urls[0]:void 0,[o,r]=h.useState("contain"),i=h.useRef(null);return s.jsxs("div",{className:S("flex",t?"flex-row":"flex-col"),children:[s.jsxs("div",{className:S("relative aspect-square",t?"w-1/3":"w-full","bg-token-main-surface-secondary dark:bg-token-main-surface-primary-inverse"),children:[a?s.jsx("img",{ref:i,className:`absolute inset-0 m-0 h-full w-full mix-blend-darken object-${o}`,src:a,alt:e.title,onLoad:()=>{if(!i.current)return;const{naturalWidth:l,naturalHeight:d}=i.current,c=l/d;r(Math.abs(c-1)<.25?"cover":"contain")}}):s.jsx("div",{className:"flex aspect-square items-center justify-center",children:s.jsx(ht,{className:"text-token-text-tertiary h-12 w-12"})}),e.featured_tag&&s.jsx("div",{className:"absolute start-3 end-3 bottom-3",children:s.jsxs("div",{className:"relative max-w-fit px-2 py-1",children:[s.jsx("div",{className:"absolute inset-0 rounded-full bg-white/60 backdrop-blur-xl"}),s.jsx("div",{className:"relative truncate text-xs font-semibold text-gray-950",children:e.featured_tag})]})})]}),s.jsxs("div",{className:"flex flex-1 flex-col p-4",children:[s.jsx("div",{className:"line-clamp-2 leading-snug font-semibold text-ellipsis",children:e.title}),e.description&&s.jsx("div",{className:"line-clamp-3 pt-3 text-sm text-ellipsis",children:e.description}),s.jsx("div",{className:"flex-1"}),s.jsxs("div",{className:"flex flex-row items-end pt-3",children:[s.jsxs("div",{className:"flex flex-col overflow-hidden",children:[s.jsx("div",{className:"text-md leading-snug font-semibold",children:e.price}),s.jsx("div",{className:"text-token-text-secondary overflow-hidden pt-0.5 text-xs text-ellipsis whitespace-nowrap",children:e.merchants})]}),s.jsx("div",{className:"flex-1"}),e.num_reviews&&e.num_reviews>0&&s.jsxs("div",{className:"text-token-text-secondary flex w-fit flex-row gap-1 text-sm",children:[s.jsx(So,{rating:e.rating??0/5}),(e.rating??0).toFixed(1)]})]}),!1]})]})}function tu({product:e,wide:t,showDebug:n=!1}){const a=e.image_urls?e.image_urls[0]:void 0,[o,r]=h.useState("contain"),i=h.useRef(null);return s.jsxs("div",{className:S("flex pb-2",t?"flex-row gap-3":"flex-col gap-2"),children:[s.jsx("div",{className:S("relative",t?"aspect-square w-1/4":"aspect-[13/16] w-full","bg-token-bg-tertiary dark:bg-token-text-inverted overflow-clip rounded-xl"),children:s.jsx(Vn,{className:"mix-blend-darken dark:mix-blend-lighten",children:a?s.jsx("img",{ref:i,className:`absolute inset-0 m-0 h-full w-full object-${o}`,src:a,alt:e.title,onLoad:()=>{if(!i.current)return;const{naturalWidth:l,naturalHeight:d}=i.current,c=l/d;r(Math.abs(c-1)<.6?"cover":"contain")}}):s.jsx("div",{className:"flex aspect-square items-center justify-center",children:s.jsx(ht,{className:"text-token-text-tertiary h-12 w-12"})})})}),s.jsxs("div",{className:"flex flex-col gap-1 px-1",children:[s.jsx("div",{className:S("line-clamp-2 font-medium text-ellipsis",t?"text-base":"text-sm"),children:e.title}),s.jsxs("div",{className:"text-token-text-secondary flex flex-row gap-0.25 text-sm",children:[s.jsx("div",{children:e.price}),s.jsx("div",{className:"mx-0.5",children:"•"}),s.jsx("div",{className:"truncate",children:e.merchants})]}),!1]})]})}function su({className:e,imageUrl:t,productTitle:n,onClicked:a}){const[o,r]=h.useState("contain"),i=h.useRef(null);return s.jsx("div",{className:S(e,"hover:scale-[1.005]","dark:bg-token-text-inverted bg-token-bg-primary","cursor-pointer overflow-hidden rounded-xl shadow-inner transition-all duration-200","relative aspect-square max-h-60"),onClick:a,children:t?s.jsx("img",{ref:i,className:`m-0 h-full w-full overflow-hidden object-${o} mix-blend-darken`,src:t,alt:n,onLoad:()=>{if(!i.current)return;const{naturalWidth:l,naturalHeight:d}=i.current,c=l/d;r(Math.abs(c-1)<.5?"cover":"contain")}}):s.jsx("div",{className:"flex aspect-square items-center justify-center",children:s.jsx(ht,{className:"text-token-text-tertiary h-12 w-12"})})})}function nu({product:e,showDebug:t=!1,onShown:n,onClicked:a}){return h.useEffect(()=>{n()},[n]),s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"flex flex-row gap-2 py-2",children:e.image_urls&&e.image_urls.length>0&&e.image_urls.slice(0,3).map(o=>s.jsx(su,{imageUrl:o,productTitle:e.title,onClicked:a},o))}),!1]})}function au({attribution:e,wordFadeType:t}){const n=h.useContext(ie),a=Mo(n?.message.id,e.attributable_index),o=No();return s.jsx(iu,{isHighlighted:a,isDebugMode:o&&!1,content:e.alt??"",attributableIndex:e.attributable_index,attributions:void 0,attributionsDebug:void 0,wordFadeType:t})}const ou=h.memo(Yt);function ru({content:e,isHighlighted:t,isDebugMode:n,attributableIndex:a,attributions:o,attributionsDebug:r,wordFadeType:i}){const l=i==="indexed",d=Tn(),c=h.useMemo(()=>l?{handlers:{text:(b,w,x)=>{const j=[];for(const _ of d(w.value))j.push({type:"element",tagName:"span",properties:{className:$n.fadeIn},children:[{type:"text",value:_}]});return j}}}:void 0,[l,d]),u=h.useMemo(()=>({p:({children:b})=>s.jsx(s.Fragment,{children:b})}),[]),m=s.jsx(ou,{rehypePlugins:yn,remarkPlugins:xn,urlTransform:gn,remarkRehypeOptions:c,components:u,children:e});return s.jsx(lu,{isHighlighted:t,children:m})}const iu=fn.memo(ru);function lu({isHighlighted:e,className:t,children:n}){return s.jsx("span",{className:S("relative","-mx-px my-[-0.2rem] rounded px-px py-[0.2rem]",e&&"attribution-highlight-bg","transition-colors duration-100 ease-in-out",t),children:n})}function Zs(e,t){try{return BigInt(e).toLocaleString(t)}catch{const n=Number(e);return e.includes("e")||e.includes("E")?n.toExponential():n.toLocaleString(t,{maximumFractionDigits:6})}}function cu({data:e,trackContentReferenceEvent:t}){h.useEffect(()=>{t("Search Content Reference Shown","search_content_reference_shown",e.type)},[t,e.type]);const n=Ur().locale;return e.expression&&e.result!=null?s.jsxs("div",{className:"no-scrollbar overflow-auto sm:overflow-hidden",children:[s.jsxs("div",{className:"pb-1 text-lg font-semibold",children:[e.prefix&&s.jsx("span",{children:e.prefix}),s.jsx("span",{children:Zs(e.result,n)}),e.suffix&&s.jsx("span",{children:e.suffix})]}),s.jsx("div",{className:"text-token-text-primary tracking-wide",children:`${e.expression}=${Zs(e.result,n)}`})]}):null}function ma({ref:e,onClick:t,onMouseEnter:n,onMouseLeave:a}){const o=P();return s.jsx("button",{ref:e,"aria-label":o.formatMessage({id:"citation.icon.label",defaultMessage:"Coding Citation"}),onClick:t,onMouseEnter:n,onMouseLeave:a,className:S("rounded-xl px-1","bg-token-interactive-bg-tertiary-press text-token-text-secondary hover:text-token-text-inverted hover:bg-token-interactive-bg-primary-selected"),children:s.jsx(To,{className:"icon-sm"})})}function du({codeMessage:e,codeExecutionOutputMessage:t,onDismiss:n,FormattedText:a}){const o=P();return s.jsx(ye.Root,{isOpen:!0,onClose:n,testId:"modal-code-execution",children:s.jsx(ye.Overlay,{children:s.jsxs(ye.Content,{className:"flex max-h-[75vh] max-w-lg flex-col overflow-hidden",children:[s.jsx(ye.Header,{title:o.formatMessage(uu.title),type:"success",closeButton:s.jsx(Vr,{onClick:n})}),s.jsxs("div",{className:"flex flex-1 flex-col overflow-auto",children:[s.jsx("div",{children:s.jsx($o,{FormattedText:a,message:e,codeRendererClassName:"border-none rounded-none",removeTopBorderRadius:!0})}),s.jsx("div",{children:s.jsx(Eo,{message:t})})]})]})})})}const uu=Bt({title:{id:"CodeExecutionOutputModal.title",defaultMessage:"Analysis"}});function mu({displayInfo:e,FormattedText:t,trackContentReferenceEvent:n}){const[a,o]=h.useState(!1),r=P();return h.useEffect(()=>{n("Search Content Reference Shown","search_content_reference_shown",e.type)},[n,e.type]),s.jsxs(s.Fragment,{children:[s.jsx(Z,{label:r.formatMessage(hu.viewAnalysis),side:"top",delayDuration:150,className:"align-middle",children:s.jsx(ma,{onClick:()=>o(!0)})}),a&&s.jsx(du,{FormattedText:t,codeMessage:e.codeMessage,codeExecutionOutputMessage:e.codeExecutionOutputMessage,onDismiss:()=>o(!1)})]})}const hu=Bt({viewAnalysis:{id:"viewAnalysis",defaultMessage:"View analysis"}});function fu({contentReference:e,clientThreadId:t,turnIndex:n}){const{toggleThreadSidebar:a}=Xe(),o=Po("codingCitations"),[r,i]=h.useState(!1),l=h.useRef(null),d=()=>{l.current!=null&&window.clearTimeout(l.current),i(!0)},c=()=>{l.current=window.setTimeout(()=>i(!1),100)},u=h.useCallback(()=>{t&&a({type:"codingCitations",clientThreadId:t,turnIndex:n||1,messageId:e.cited_message?.id??"",matchedText:e.matched_text},o)},[a,t,o,e,n]);if(!e.cited_message||!e.highlighted_text)return null;let m;e.type==="python"?m=e.cited_message?.metadata?.aggregate_result?.code:e.type==="container"&&(m=e.cited_message?.metadata?.container_citation?.source_cmd);const b=m?.split(`
`).length??0;return s.jsx("span",{className:"relative top-[0.1rem] inline-block align-middle",children:s.jsx("span",{className:"inline-flex items-center",children:s.jsxs(Ht,{open:r,onOpenChange:i,children:[s.jsx(Ut,{asChild:!0,children:s.jsx(ma,{onClick:u,onMouseEnter:d,onMouseLeave:c})}),s.jsx(Vt,{children:s.jsx(qt,{align:"start",sideOffset:4,onMouseEnter:d,onMouseLeave:c,className:S("border-default bg-token-bg-primary rounded-2xl border p-3"),children:s.jsxs("aside",{className:"flex flex-col gap-3",children:[s.jsx("h2",{className:S("text-token-text-secondary text-xs font-medium"),children:e.type==="python"?s.jsx(T,{id:"citation.popover.label.python",defaultMessage:"Python script · {count, number} lines",values:{count:b}}):s.jsx(T,{id:"citation.popover.label.container",defaultMessage:"Bash script · {count, number} lines",values:{count:b}})}),s.jsx("hr",{}),s.jsx("h2",{className:S("text-sm font-medium","max-w-full break-words whitespace-pre-line sm:max-w-[300px]"),children:e.highlighted_text})]})})})]})})})}const pu=e=>h.createElement("svg",{width:20,height:20,viewBox:"0 0 20 20",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e},h.createElement("path",{d:"M16.835 5.90091C16.835 5.68052 16.7115 5.4819 16.5205 5.38236L16.4346 5.34623L13.165 4.25638V14.5201L16.0654 15.4869L16.1357 15.5064C16.491 15.5782 16.835 15.3066 16.835 14.9322V5.90091ZM8.16504 5.47904V15.7437L11.835 14.5201V4.25638L8.16504 5.47904ZM18.165 14.9322C18.165 16.1576 17.0394 17.0456 15.877 16.8111L15.6445 16.7495L12.6846 15.7622C12.5946 15.7323 12.499 15.7247 12.4062 15.7398L12.3154 15.7622L8.10547 17.1656C7.76144 17.2802 7.39309 17.2946 7.04297 17.2085L6.89453 17.1656L3.14453 15.9156C2.3626 15.6549 1.83502 14.9234 1.83496 14.0992V5.06791C1.83496 3.76088 3.11551 2.83734 4.35547 3.25052L7.31543 4.23685L7.40625 4.26029C7.49905 4.27534 7.59449 4.26683 7.68457 4.23685L11.8945 2.83451L12.043 2.79154C12.3931 2.70547 12.7614 2.71982 13.1055 2.83451L16.8555 4.08451L16.999 4.13822C17.7014 4.43636 18.165 5.12808 18.165 5.90091V14.9322ZM3.16504 14.0992C3.1651 14.3509 3.32659 14.5742 3.56543 14.6538L6.83496 15.7437V5.47904L3.93457 4.51224C3.55592 4.38638 3.16504 4.66878 3.16504 5.06791V14.0992Z"}));function gu({business:e,mapUrl:t,showTitle:n=!1,showActionButtons:a=!0}){const o=e.categories&&e.categories.length>0?e.categories[0]:"";return s.jsxs("div",{className:"text-token-text-primary bg-token-bg-primary max-w-md rounded-md py-1",children:[n&&e.name&&s.jsx("div",{className:"mb-1 text-lg leading-tight font-semibold",children:e.name}),s.jsx("div",{className:"text-token-text-primary flex flex-wrap items-center text-sm font-normal",children:[e.rating?s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(Sn,{className:"text-token-text-primary h-4 w-4"}),e.rating.toFixed(1)]},"rating"):null,o?s.jsx("span",{children:o},"category"):null,e.price_str?s.jsx("span",{children:e.price_str},"price"):null,e.is_open!==void 0&&e.is_open!=null?s.jsx("span",{children:e.is_open?s.jsx(T,{id:"businessMetadata.openStatus",defaultMessage:"Open"}):s.jsx(T,{id:"businessMetadata.closedStatus",defaultMessage:"Closed"})},"open"):null].filter(Boolean).map((r,i)=>s.jsxs(fn.Fragment,{children:[i>0&&s.jsx("span",{className:"mx-1",children:"•"}),r]},i))}),a&&s.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[t&&s.jsx(wt,{type:"button",className:"bg-token-bg-primary text-token-text-primary m-0! rounded-full border px-3 py-0.5 text-xs font-medium",onClick:()=>window.open(t,"_blank","noopener,noreferrer"),children:s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(pu,{className:"text-token-text-primary h-4 w-4"}),s.jsx(T,{id:"businessMetadata.directions",defaultMessage:"Directions"})]},"rating")}),e.website_url&&s.jsx(wt,{type:"button",className:"bg-token-bg-primary text-token-text-primary m-0! rounded-full border px-3 py-0.5 text-xs font-medium",onClick:()=>{const r=e.website_url;r&&window.open(r,"_blank","noopener,noreferrer")},children:s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(Lo,{className:"text-token-text-primary h-4 w-4"}),s.jsx(T,{id:"businessMetadata.website",defaultMessage:"Website"})]},"rating")}),e.phone&&s.jsx(wt,{type:"button",className:"bg-token-bg-primary text-token-text-primary m-0! rounded-full border px-3 py-0.5 text-xs font-medium",onClick:()=>{window.location.href=`tel:${e.phone}`},children:s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(Ui,{className:"text-token-text-primary h-4 w-4"}),s.jsx(T,{id:"businessMetadata.phone",defaultMessage:"Phone"})]},"rating")})]})]})}function xu({product:e,clientThreadId:t,messageId:n,contentReferenceStartIndex:a,trackContentReferenceEvent:o,showTitle:r=!1,showImageGallery:i=!1}){const l=B(),d=F(l,"3375735072"),c=F(l,"232003972"),u=h.useMemo(()=>({clientThreadId:t,messageId:n}),[t,n]),m=Zt.useStore(),[b,w]=h.useState(!1),[x,j]=h.useState(e),[_,f]=h.useState(!1),k=r||c||d;return h.useEffect(()=>{let v=!0;return(async y=>{f(!0);try{for await(const C of yu(y))v&&j(C)}finally{v&&f(!1)}})(x),()=>{v=!1}},[x.product_lookup_key?.variant_options_query]),x?s.jsxs("div",{className:"-mx-6",children:[i&&s.jsx(Ao,{imageUrls:x.image_urls??[],title:x.title,onImageClick:v=>{m.setCurrentImage({image:{url:v,content_url:v,thumbnail_url:v,title:x.title,content_size:{width:0,height:0},thumbnail_size:{width:0,height:0}},source:Be.ProductDetails,analyticsMetadata:u,contentReferenceStartIndex:a})}}),s.jsxs("div",{className:"bg-token-bg-primary flex w-full flex-col",children:[k&&s.jsxs("div",{className:"border-token-border-light flex flex-col border-b px-6 pb-3",children:[r&&s.jsx("div",{className:"text-token-text-primary text-xl font-medium capitalize",children:x.title}),c&&x.num_reviews&&x.rating&&s.jsx(Ro,{rating:x.rating,numReviews:x.num_reviews,ratingGroupedCitation:x.rating_grouped_citation,trackContentReferenceEvent:()=>{},analyticsMetadata:u}),d&&x.variants&&x.variants.length>0&&s.jsx("div",{className:"mt-5 mb-2",children:s.jsx(Io,{options:x.variants,showErrors:b,updateOption:(v,p,y)=>j(C=>bu({optionGroupId:v,selectedId:p,variant_index:y,product:C,trackContentReferenceEvent:o}))})})]}),s.jsx(Do,{className:"border-token-border-light -pt-3 -mx-3 flex flex-col border-b px-6 pb-3",offers:e.offers??[],contentReferenceStartIndex:a,productIndex:0,product:e,sCKStore:void 0,trackContentReferenceEvent:o,analyticsMetadata:u,imageUrls:e.image_urls??[],isLoading:_,onOpenCheckout:()=>w(!0)})]})]}):null}async function*yu(e){const{product_lookup_key:t}=e;if(!!!t?.variant_options_query){yield e;return}const a=qr(`${Gr}/search/product_info_variants`,{method:"POST",headers:{...Kt({isAuthOptional:!0})},body:{product_lookup_key:e.product_lookup_key}});for await(const o of a)"data"in o&&(yield o.data.product)}function bu({optionGroupId:e,selectedId:t,variant_index:n,product:a,trackContentReferenceEvent:o}){const r=a.variants?.find(c=>c.id===e);o("product_detail","product_detail","product_entity",{product_id:a.id,action:"variant_selected",section:"product_detail",section_location:"sidebar",variant_name:r?.label??"",variant_value:r?.options.find(c=>c.id===t)?.label??"",variant_index:n});const i=a.variants?.map(c=>c.id===e?{...c,options:c.options.map(u=>({...u,selected:u.id===t})),selected_option_id:t}:c)??a.variants,d=i?.every(c=>c.selected_option_id)?i?.reduce((c,u)=>(u.selected_option_id&&(c[u.id]=u.selected_option_id),c),{}):null;return{...a,variants:i,product_lookup_key:{...a.product_lookup_key,variant_options_query:d}}}function wu({contentReference:e,clientThreadId:t,messageId:n,trackContentReferenceEvent:a}){if(h.useEffect(()=>{a("Search Content Reference Shown","search_content_reference_shown","entity_metadata",{entity_type:e.entity_type,...e.entity_type==="local_business"?{business_id:e.entity_data?.id}:e.entity_type==="product"?{product_id:e.entity_data?.id}:{}})},[a,e.entity_type,e.entity_data?.id]),!e?.entity_data)return null;if(e.entity_type==="local_business"){const o=e.layout;return s.jsx(gu,{business:e.entity_data,mapUrl:e.metadata?.map_url,showActionButtons:o!=="one-line",showTitle:o!=="one-line"})}else if(e.entity_type==="product")return s.jsx(xu,{product:e.entity_data,clientThreadId:t,messageId:n,contentReferenceStartIndex:e.start_idx,trackContentReferenceEvent:a});return null}function vu({iconRef:e,className:t,alt:n}){const a=e?.vector_url??e?.raster_url;return a?s.jsx("img",{src:a,className:t,alt:n}):s.jsx(En,{className:t})}function zt(e,t,n,a){const o=F(n,"3958255976"),r=F(n,"1424158285"),i=Fo(e.cloud_doc_url??""),l=(o?e.fff_metadata?.name:void 0)??e.name,d=(o?e.fff_metadata?.display_file_type_name:void 0)??i?.type??a.formatMessage({id:"bqY3sN",defaultMessage:"File"}),c=(o&&e.fff_metadata?.display_file_type_icon?s.jsx(vu,{alt:d,className:t,iconRef:e.fff_metadata?.display_file_type_icon}):void 0)??(i?.Icon?s.jsx(i.Icon,{alt:d,className:t}):e.cloud_doc_url?r?s.jsx(De,{url:e.cloud_doc_url,className:t,fallback:s.jsx(Lt,{alt:d,className:t})}):s.jsx(Lt,{alt:d,className:t}):void 0)??s.jsx(En,{alt:d,className:t}),u=(o?e.fff_metadata?.capabilities?.user_view:void 0)??e.cloud_doc_url;let m;o&&e.fff_metadata?.snippet&&e.fff_metadata?.snippet.content.content_type==="text"?m=e.fff_metadata.snippet.content.text:m=e.description??e.snippet;const b=(o?e.fff_metadata?.file_last_modified_time:void 0)??e.last_modified_time,w=o?e.fff_metadata?.file_created_time:void 0;return{fileName:l,fileTypeDisplayName:d,fileTypeIcon:c,url:u,snippet:m,fileLastModifiedTime:b,fileCreatedTime:w}}const Ys=32;function ha(e){const t=e.split(".");let n=e;return t.length>1&&t.slice(0,-1).some(a=>a.length>0)&&(n=t.slice(0,-1).join(".")),n.length>Ys&&(n=n.slice(0,Ys-1)+"…"),n}function _u({additionalFileRefs:e,fileRef:t,index:n,trackContentReferenceEvent:a}){const o=Zr(zn),r=Yr(),i=h.useContext(ie),l=h.useMemo(()=>({source:t.source,index:n}),[t.source,n]);h.useEffect(()=>{a("File Citation Shown","file_citation_shown","file",l)},[]);const d=h.useCallback(w=>{w?a("File Citation Hovered","file_citation_hovered","file",l):a("File Citation Unhovered","file_citation_unhovered","file",l)},[l,a]),c=h.useCallback(()=>{a("File Citation Clicked","file_citation_clicked","file",l)},[l,a]),u=h.useCallback(()=>{a("File Citation Followup Clicked","file_citation_followup_clicked","file",l)},[l,a]),m=h.useCallback(()=>r(t.id,t.name),[r,t.id,t.name]),b=qe(i?.analyticsMetadata.clientThreadId??ss,w=>w?.mode);return o&&Pn(t.id)?null:Oo(b)?b.gizmo_id&&Xr(b.gizmo_id)?s.jsx("span",{className:S(Vi,"ms-1"),title:t.name,children:ha(t.name)}):null:s.jsx(ju,{additionalFileRefs:e,fileItem:t,onClickDownloadFile:m,trackCloudLinkClick:c,trackFileCitationFollowup:u,trackTooltipOpenChange:d})}const Xs=ts.p`not-prose mt-0! mb-0! flex-auto truncate`;function ju({additionalFileRefs:e,className:t,fileItem:n,onClickDownloadFile:a,trackCloudLinkClick:o,trackFileCitationFollowup:r,trackTooltipOpenChange:i}){const l=P(),d=B(),c=F(d,"1424158285"),{fileName:u,fileTypeDisplayName:m,fileTypeIcon:b,url:w,snippet:x}=zt(n,"h-[12px] w-[12px] object-contain text-token-text-primary! flex-none",d,l),j=[{fileItem:n,fileName:u,fileTypeDisplayName:m,fileTypeIcon:b,url:w,snippet:x},...e?.map(p=>{const{fileName:y,fileTypeDisplayName:C,fileTypeIcon:M,url:g,snippet:N}=zt(p,"h-[12px] w-[12px] object-contain",d,l);return{fileItem:p,fileName:y,fileTypeDisplayName:C,fileTypeIcon:M,url:g,snippet:N}})??[]];let _=S("ms-1 flex h-[25px] text-[10px] leading-[13px] rounded-xl items-center justify-center gap-1 px-2 relative","text-token-text-secondary! hover:text-token-text-primary! hover:bg-token-bg-secondary dark:bg-token-main-surface-secondary dark:hover:bg-token-bg-secondary",t);c||(_+=" bg-[#f4f4f4] ");const f=c&&n.medical_file_reference!==null&&n.medical_file_reference?.journal_name!==null?n.medical_file_reference?.journal_name:n.name,k=`${ha(f)}${e&&e.length>0?` +${e.length}`:""}`,v=s.jsx("span",{className:"relative inline-flex items-center",children:w?s.jsxs(pe,{href:w,className:_,onClick:o,children:[b,s.jsx(Xs,{children:k})]}):Pn(n.id)?s.jsxs("button",{onClick:a,className:_,children:[b,s.jsx(Xs,{children:k})]}):s.jsx("span",{className:_,children:s.jsx(Lt,{})})});return s.jsx(ku,{items:j,contentType:m,trackFileCitationFollowup:r,trackTooltipOpenChange:i,children:v})}function ku({items:e,children:t,contentType:n,trackFileCitationFollowup:a,trackTooltipOpenChange:o}){const r=Ke(),l=h.useContext(ie)?.clientThreadId??ss,d=Xt(),c=B();Kr(l);const u=F(c,"1424158285"),m=F(c,"733205176"),b=zo(l,e[0].fileItem.id,e[0].fileName,e[0].url),w=h.useCallback((j,_)=>{_.length&&(b(j,_),a?.())},[b,a]),x=()=>s.jsxs(s.Fragment,{children:[s.jsxs(pe,{href:e[0].url,className:S("text-token-text-primary flex max-w-80 flex-col gap-1 text-start text-xs font-normal no-underline!"),children:[s.jsxs("div",{className:"flex items-center justify-center gap-1.5",children:[e[0].fileTypeIcon,s.jsx("div",{className:"text-token-text-primary flex-auto truncate",children:u?e[0].fileItem.medical_file_reference?.journal_name:n})]}),s.jsx("div",{className:"line-clamp-2 text-sm font-medium break-all",children:e[0].fileName}),u&&s.jsxs("div",{className:"line-clamp-2 text-sm break-words",children:[s.jsx("span",{className:"italic",children:e[0].fileItem.medical_file_reference?.authors_display}),s.jsx("span",{className:"ms-1 not-italic",children:e[0].fileItem.medical_file_reference?.publication_year})]}),e[0].snippet&&s.jsx("div",{className:"text-token-text-secondary line-clamp-2 text-sm",children:e[0].snippet})]}),d||m?null:s.jsx("div",{className:"flex w-full cursor-pointer flex-row items-center gap-2 pt-3 text-sm",children:s.jsx(Bo,{sendReply:w})})]});return s.jsx(Z,{label:s.jsx(x,{}),align:"start",cornerRadius:"xl",customBorderClassName:"border-token-border-default border",customPaddingClassName:"p-3",delayDuration:150,interactive:!0,onOpenChange:o,side:"bottom",theme:r?"default":"white",wide:!0,children:t})}function Cu(e,t){return new Date(e).toLocaleDateString(t,{month:"long",day:"numeric",year:"numeric"})}function Su({metadata:e,trackContentReferenceEvent:t}){return e.items.length===0?null:s.jsx("div",{className:"mt-6 flex flex-col gap-3",children:e.items.map((n,a)=>s.jsx(Mu,{item:n,index:a,trackContentReferenceEvent:t},a))})}function Mu({item:e,index:t,trackContentReferenceEvent:n}){const a=P(),o=B(),{fileName:r,fileTypeDisplayName:i,fileTypeIcon:l,snippet:d,url:c,fileLastModifiedTime:u}=zt(e,"icon object-contain",o,a),m={title:r,description:d?.toString()??"",index:t};return h.useEffect(()=>{n("Contextual Answers Content Reference Shown","contextual_answers_content_reference_shown","file_navlist",m)},[]),s.jsxs(pe,{className:"group/nav-list relative flex items-center gap-6 py-1.5",href:c??"/",onClick:()=>{n("Contextual Answers Content Reference Clicked","contextual_answers_content_reference_clicked","file_navlist",m)},children:[s.jsx("div",{className:"absolute start-0 top-0 bottom-0 w-[3px] rounded-t-lg rounded-b-lg bg-black/10"}),s.jsxs("div",{className:"ms-4 flex grow flex-col gap-1 overflow-hidden text-ellipsis",children:[s.jsxs("div",{className:"not-prose text-token-text-primary flex items-center gap-1.5 text-sm",children:[l,s.jsx("div",{className:"text-token-text-primary line-clamp-2 text-sm",children:i})]}),s.jsx("div",{className:"text-token-link decoration-token-link line-clamp-2 font-semibold group-hover/nav-list:underline",children:r}),s.jsx("div",{className:"text-token-text-primary line-clamp-2 text-sm leading-snug font-normal",children:d}),u&&s.jsx("div",{className:"text-token-text-secondary text-sm",children:Cu(u,a.locale)})]})]})}var $t={line:{color:"#F66",width:1,dashPattern:[]},sync:{enabled:!0,group:1,suppressTooltips:!1},zoom:{enabled:!0,zoomboxBackgroundColor:"rgba(66,133,244,0.2)",zoomboxBorderColor:"#48F",zoomButtonText:"Reset Zoom",zoomButtonClass:"reset-zoom"},snap:{enabled:!1},callbacks:{beforeZoom:function(e,t){return!0},afterZoom:function(e,t){}}},Nu={id:"crosshair",afterInit:function(e){if(e.config.options.scales.x){var t=e.config.options.scales.x.type;if(!(t!=="linear"&&t!=="time"&&t!=="category"&&t!=="logarithmic")){e.options.plugins.crosshair===void 0&&(e.options.plugins.crosshair=$t),e.crosshair={enabled:!1,suppressUpdate:!1,x:null,originalData:[],originalXRange:{},dragStarted:!1,dragStartX:null,dragEndX:null,suppressTooltips:!1,ignoreNextEvents:0,reset:function(){this.resetZoom(e,!1,!1)}.bind(this)};var n=this.getOption(e,"sync","enabled");n&&(e.crosshair.syncEventHandler=function(a){this.handleSyncEvent(e,a)}.bind(this),e.crosshair.resetZoomEventHandler=function(a){var o=this.getOption(e,"sync","group");a.chartId!==e.id&&a.syncGroup===o&&this.resetZoom(e,!0)}.bind(this),window.addEventListener("sync-event",e.crosshair.syncEventHandler),window.addEventListener("reset-zoom-event",e.crosshair.resetZoomEventHandler)),e.panZoom=this.panZoom.bind(this,e)}}},afterDestroy:function(e){var t=this.getOption(e,"sync","enabled");t&&(window.removeEventListener("sync-event",e.crosshair.syncEventHandler),window.removeEventListener("reset-zoom-event",e.crosshair.resetZoomEventHandler))},panZoom:function(e,t){if(e.crosshair.originalData.length!==0){var n=e.crosshair.end-e.crosshair.start,a=e.crosshair.min,o=e.crosshair.max;t<0?(e.crosshair.start=Math.max(e.crosshair.start+t,a),e.crosshair.end=e.crosshair.start===a?a+n:e.crosshair.end+t):(e.crosshair.end=Math.min(e.crosshair.end+t,e.crosshair.max),e.crosshair.start=e.crosshair.end===o?o-n:e.crosshair.start+t),this.doZoom(e,e.crosshair.start,e.crosshair.end)}},getOption:function(e,t,n){return hs(e.options.plugins.crosshair[t]?e.options.plugins.crosshair[t][n]:void 0,$t[t][n])},getXScale:function(e){return e.data.datasets.length?e.scales[e.getDatasetMeta(0).xAxisID]:null},getYScale:function(e){return e.scales[e.getDatasetMeta(0).yAxisID]},handleSyncEvent:function(e,t){var n=this.getOption(e,"sync","group");if(t.chartId!==e.id&&t.syncGroup===n){var a=this.getXScale(e);if(a){var o=t.original.native.buttons===void 0?t.original.native.which:t.original.native.buttons;t.original.type==="mouseup"&&(o=0);var r={type:t.original.type=="click"?"mousemove":t.original.type,chart:e,x:a.getPixelForValue(t.xValue),y:t.original.y,native:{buttons:o},stop:!0};e._eventHandler(r)}}},afterEvent:function(e,t){if(e.config.options.scales.x.length==0)return;let n=t.event;var a=e.config.options.scales.x.type;if(!(a!=="linear"&&a!=="time"&&a!=="category"&&xscaleType!=="logarithmic")){var o=this.getXScale(e);if(o){if(e.crosshair.ignoreNextEvents>0){e.crosshair.ignoreNextEvents-=1;return}var r=n.native.buttons===void 0?n.native.which:n.native.buttons;n.native.type==="mouseup"&&(r=0);var i=this.getOption(e,"sync","enabled"),l=this.getOption(e,"sync","group");if(!n.stop&&i){var t=new CustomEvent("sync-event");t.chartId=e.id,t.syncGroup=l,t.original=n,t.xValue=o.getValueForPixel(n.x),window.dispatchEvent(t)}var d=this.getOption(e,"sync","suppressTooltips");if(e.crosshair.suppressTooltips=n.stop&&d,e.crosshair.enabled=n.type!=="mouseout"&&n.x>o.getPixelForValue(o.min)&&n.x<o.getPixelForValue(o.max),!e.crosshair.enabled&&!e.crosshair.suppressUpdate)return n.x>o.getPixelForValue(o.max)&&(e.crosshair.suppressUpdate=!0,e.update("none")),e.crosshair.dragStarted=!1,!1;e.crosshair.suppressUpdate=!1;var c=this.getOption(e,"zoom","enabled");if(r===1&&!e.crosshair.dragStarted&&c&&(e.crosshair.dragStartX=n.x,e.crosshair.dragStarted=!0),e.crosshair.dragStarted&&r===0){e.crosshair.dragStarted=!1;var u=o.getValueForPixel(e.crosshair.dragStartX),m=o.getValueForPixel(e.crosshair.x);Math.abs(e.crosshair.dragStartX-e.crosshair.x)>1&&this.doZoom(e,u,m),e.update("none")}e.crosshair.x=n.x,e.draw()}}},afterDraw:function(e){if(e.crosshair.enabled)return e.crosshair.dragStarted?this.drawZoombox(e):(this.drawTraceLine(e),this.interpolateValues(e),this.drawTracePoints(e)),!0},beforeTooltipDraw:function(e){return!e.crosshair.dragStarted&&!e.crosshair.suppressTooltips},resetZoom:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(n){if(e.crosshair.originalData.length>0)for(var a=0;a<e.data.datasets.length;a++){var o=e.data.datasets[a];o.data=e.crosshair.originalData.shift(0)}e.crosshair.originalXRange.min?(e.options.scales.x.min=e.crosshair.originalXRange.min,e.crosshair.originalXRange.min=null):delete e.options.scales.x.min,e.crosshair.originalXRange.max?(e.options.scales.x.max=e.crosshair.originalXRange.max,e.crosshair.originalXRange.max=null):delete e.options.scales.x.max}e.crosshair.button&&e.crosshair.button.parentNode&&(e.crosshair.button.parentNode.removeChild(e.crosshair.button),e.crosshair.button=!1);var r=this.getOption(e,"sync","enabled");if(!t&&n&&r){var i=this.getOption(e,"sync","group"),l=new CustomEvent("reset-zoom-event");l.chartId=e.id,l.syncGroup=i,window.dispatchEvent(l)}n&&e.update("none")},doZoom:function(e,t,n){if(t>n){var a=t;t=n,n=a}var o=hs(e.options.plugins.crosshair.callbacks?e.options.plugins.crosshair.callbacks.beforeZoom:void 0,$t.callbacks.beforeZoom);if(!o(t,n))return!1;if(e.crosshair.dragStarted=!1,e.options.scales.x.min&&e.crosshair.originalData.length===0&&(e.crosshair.originalXRange.min=e.options.scales.x.min),e.options.scales.x.max&&e.crosshair.originalData.length===0&&(e.crosshair.originalXRange.max=e.options.scales.x.max),!e.crosshair.button){var r=document.createElement("button"),i=this.getOption(e,"zoom","zoomButtonText"),l=this.getOption(e,"zoom","zoomButtonClass"),d=document.createTextNode(i);r.appendChild(d),r.className=l,r.addEventListener("click",function(){this.resetZoom(e)}.bind(this)),e.canvas.parentNode.appendChild(r),e.crosshair.button=r}e.options.scales.x.min=t,e.options.scales.x.max=n;var c=e.crosshair.originalData.length===0,u=e.config.options.scales.x.type!=="category";if(u)for(var m=0;m<e.data.datasets.length;m++){var b=[],w=0,x=!1,j=!1;c&&(e.crosshair.originalData[m]=e.data.datasets[m].data);for(var _=e.crosshair.originalData[m],f=0;f<_.length;f++){var k=_[f],v=k.x!==void 0?k.x:NaN;v>=t&&!x&&w>0&&(b.push(_[w-1]),x=!0),v>=t&&v<=n&&b.push(k),v>n&&!j&&w<_.length&&(b.push(k),j=!0),w+=1}e.data.datasets[m].data=b}if(e.crosshair.start=t,e.crosshair.end=n,c){var p=this.getXScale(e);e.crosshair.min=p.min,e.crosshair.max=p.max}e.crosshair.ignoreNextEvents=2,e.update("none");var y=this.getOption(e,"callbacks","afterZoom");y(t,n)},drawZoombox:function(e){var t=this.getYScale(e),n=this.getOption(e,"zoom","zoomboxBorderColor"),a=this.getOption(e,"zoom","zoomboxBackgroundColor");e.ctx.beginPath(),e.ctx.rect(e.crosshair.dragStartX,t.getPixelForValue(t.max),e.crosshair.x-e.crosshair.dragStartX,t.getPixelForValue(t.min)-t.getPixelForValue(t.max)),e.ctx.lineWidth=1,e.ctx.strokeStyle=n,e.ctx.fillStyle=a,e.ctx.fill(),e.ctx.fillStyle="",e.ctx.stroke(),e.ctx.closePath()},drawTraceLine:function(e){var t=this.getYScale(e),n=this.getOption(e,"line","width"),a=this.getOption(e,"line","color"),o=this.getOption(e,"line","dashPattern"),r=this.getOption(e,"snap","enabled"),i=e.crosshair.x;r&&e._active.length&&(i=e._active[0].element.x),e.ctx.beginPath(),e.ctx.setLineDash(o),e.ctx.moveTo(i,t.getPixelForValue(t.max)),e.ctx.lineWidth=n,e.ctx.strokeStyle=a,e.ctx.lineTo(i,t.getPixelForValue(t.min)),e.ctx.stroke(),e.ctx.setLineDash([])},drawTracePoints:function(e){for(var t=0;t<e.data.datasets.length;t++){var n=e.data.datasets[t],a=e.getDatasetMeta(t),o=e.scales[a.yAxisID];a.hidden||!n.interpolate||(e.ctx.beginPath(),e.ctx.arc(e.crosshair.x,o.getPixelForValue(n.interpolatedValue),3,0,2*Math.PI,!1),e.ctx.fillStyle="white",e.ctx.lineWidth=2,e.ctx.strokeStyle=n.borderColor,e.ctx.fill(),e.ctx.stroke())}},interpolateValues:function(e){for(var t=0;t<e.data.datasets.length;t++){var n=e.data.datasets[t],a=e.getDatasetMeta(t),o=e.scales[a.xAxisID],r=o.getValueForPixel(e.crosshair.x);if(!(a.hidden||!n.interpolate)){var i=n.data,l=i.findIndex(function(m){return m.x>=r}),d=i[l-1],c=i[l];if(e.data.datasets[t].steppedLine&&d)n.interpolatedValue=d.y;else if(d&&c){var u=(c.y-d.y)/(c.x-d.x);n.interpolatedValue=d.y+(r-d.x)*u}else n.interpolatedValue=NaN}}}};const lt=(e=1)=>`rgba(48, 166, 51, ${e})`,ct=(e=1)=>`rgba(241, 77, 66, ${e})`,Ks="text-[#30a633]",Js="text-[#f14d42]",Tu=["1d","5d","1m","6m","ytd","1y","5y","max"];function $u({histories:e,selectedInterval:t,onSelectHistoryInterval:n}){const a=Object.keys(e?.quotes??{});return s.jsx("div",{className:"text-token-text-tertiary inline-flex items-start justify-between rounded-[10px] bg-[#f4f4f4] p-[3px] text-xs font-semibold sm:justify-start sm:gap-1 dark:bg-[#393939]",children:a.map(o=>s.jsx("button",{onClick:()=>{n?.(o)},className:S("border border-transparent px-3 py-1.5 text-xs font-semibold uppercase",t===o?"border-token-border-default! bg-token-main-surface-primary text-token-text-primary shadow-xxs dark:border-token-border-medium! rounded-lg":"hover:text-token-text-secondary"),children:fa[o].label},o))})}const fa={"1d":{label:"1D",formatTimestampLabel:Qs,formatTimestampTooltip:Qs,maxTicksLimit:6,lineTension:.1},"5d":{label:"5D",formatTimestampLabel:en,formatTimestampTooltip:Pu,maxTicksLimit:6,lineTension:.1},"1m":{label:"1M",formatTimestampLabel:en,formatTimestampTooltip:Lu,maxTicksLimit:6,lineTension:.1,useUtc:!0},"6m":{label:"6M",formatTimestampLabel:Et,formatTimestampTooltip:Re,maxTicksLimit:5,lineTension:.1,useUtc:!0},ytd:{label:"YTD",formatTimestampLabel:Et,formatTimestampTooltip:Re,maxTicksLimit:5,lineTension:.1,useUtc:!0},"1y":{label:"1Y",formatTimestampLabel:Et,formatTimestampTooltip:Re,maxTicksLimit:5,lineTension:.2,useUtc:!0},"5y":{label:"5Y",formatTimestampLabel:tn,formatTimestampTooltip:Re,maxTicksLimit:5,lineTension:.2,useUtc:!0},max:{label:"max",formatTimestampLabel:tn,formatTimestampTooltip:Re,maxTicksLimit:5,lineTension:.2,useUtc:!0}};function Eu(e){return e?Tu.filter(n=>n in e.quotes).find(n=>e.quotes[n].length>0):void 0}function Ce(e,t){return Fe(new Date(e*1e3),t??"America/New_York")}function Qs(e,t,n){const a=Ce(t,n);return e.formatTime(a,{hour:"numeric",minute:"numeric"})}function Pu(e,t,n){const a=Ce(t,n);return e.formatDate(a,{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"numeric"})}function Re(e,t,n){const a=Ce(t,n);return e.formatDate(a,{month:"short",day:"numeric",year:"numeric"})}function Et(e,t,n){const a=Ce(t,n);return e.formatDate(a,{month:"short",year:"numeric"})}function en(e,t,n){const a=Ce(t,n);return e.formatDate(a,{month:"short",day:"numeric"})}function Lu(e,t,n){const a=Ce(t,n);return e.formatDate(a,{weekday:"short",month:"short",day:"numeric"})}function tn(e,t,n){const a=Ce(t,n);return e.formatDate(a,{year:"numeric"})}qi.register(Gi,Zi,Yi,Xi,Ki,Ji,Qi,el,tl,Nu,sl);const Au=100,sn={color:"#b4b4b4",font:{size:10,weight:"600",family:"Menlo"}};function Ru({isUp:e,histories:t,selectedInterval:n,setHighlightedPrice:a,latestTradingPeriod:o,timezone:r}){return s.jsx(s.Fragment,{children:t&&n&&o?s.jsx(Iu,{isUp:e,histories:t,selectedInterval:n,latestTradingPeriod:o,timezone:r,setHighlightedPrice:a}):s.jsx(Ie,{className:"h-full",index:1,width:100})})}function Iu({isUp:e,histories:t,selectedInterval:n,latestTradingPeriod:a,timezone:o,setHighlightedPrice:r}){const[i,l]=h.useState(null),[d,c]=h.useState(!1),u=n==="1d",m=h.useMemo(()=>{let p=t.quotes[n].filter(y=>y.close>=0);if(u&&a){const y=a.regular.start_timestamp,C=a.regular.end_timestamp;if(p=p.filter(M=>M.timestamp>=y&&M.timestamp<=C),p.length===0||p[p.length-1].timestamp<C){let g=p.length>0?p[p.length-1].timestamp:y-600;for(;g<C;)g+=600,p.push({timestamp:g,close:null})}}return p},[t,n,u,a]),b=fa[n],{formatTimestampTooltip:w,maxTicksLimit:x,useUtc:j=!1}=b,_=P(),f=Bn(),k=Ke(),v=h.useMemo(()=>{const{formatTimestampLabel:p,lineTension:y}=b;return{labels:m.map(C=>p(_,C.timestamp,j?"UTC":o)),datasets:[{data:m.map(C=>C.close),borderColor:e?lt():ct(),pointRadius:0,pointHoverRadius:4,pointStyle:"circle",pointBackgroundColor:e?lt():ct(),pointHoverBorderWidth:2,pointHoverBorderColor:"rgba(255, 255, 255, 1)",backgroundColor:function(C){const{ctx:M,chartArea:g}=C.chart;if(g)return Fu(M,g,e)},fill:!0,borderWidth:2,lineTension:y??.4}]}},[b,m,e,j,o,_]);return s.jsx("div",{className:"flex h-full flex-col gap-6",children:s.jsxs("div",{className:"relative h-full",onMouseEnter:()=>c(!0),onMouseLeave:()=>{c(!1),r(null)},children:[s.jsx(nl,{options:{responsive:!0,maintainAspectRatio:!1,interaction:{intersect:!1,mode:"index"},hover:{mode:d?"index":"point"},animation:!1,scales:{x:{afterBuildTicks:p=>{if(p.ticks.length>x)if(u)p.ticks=p.ticks.filter((y,C)=>m[C].timestamp%(f?3600:7200)===0);else{const y=Math.ceil(p.ticks.length/(x-1));p.ticks=p.ticks.filter((C,M)=>M>0&&(M%y===0||M===p.ticks.length-1))}},grid:{display:!1},ticks:{...sn,align:"end"}},y:{ticks:{...sn,maxTicksLimit:7},border:{display:!1},grid:{color:k?"rgba(255, 255, 255, 0.1)":"rgba(229, 229, 229, 0.5)"}}},plugins:{datalabels:{display:!1},legend:{display:!1},tooltip:{enabled:!1,animation:!1,displayColors:!1,callbacks:{title:function(p){const y=p[0];if(!y)return"";const C=m[y.dataIndex]?.timestamp;return C?w(_,C,j?"UTC":o):""}},external:({tooltip:p})=>{d&&p.opacity>0&&r(ze(p.dataPoints?.[0]?.parsed?.y??0)),l(y=>{const C=p.chart.width,M=p.caretX>C-Au;return!y||y.x!==p.caretX||y.y!==p.caretY||y.opacity!==p.opacity||y.flip!==M?{...y,x:p.caretX,y:p.caretY,dateLabel:p.title?.[0],value:ze(p.dataPoints?.[0]?.parsed?.y??0),opacity:p.opacity,flip:M}:y})}},dropShadow:!1,crosshair:{line:{color:k?"rgba(255, 255, 255, 0.3)":"rgba(0, 0, 0, 0.3)",width:.5},zoom:{enabled:!1}}}},data:v}),s.jsx(Du,{tooltipData:i})]})})}function Du({tooltipData:e}){return!e||!e.opacity?null:s.jsx("div",{style:{left:e.x-5,top:10,transform:"translate(-50%, -50%)"},className:S("text-token-main-surface-primary dark:bg-token-main-surface-secondary pointer-events-none absolute translate-y-[-100%] rounded-lg bg-black px-2 py-1 font-mono font-semibold whitespace-nowrap dark:text-white"),children:s.jsx("div",{className:"text-xs",children:e.dateLabel})})}function Fu(e,t,n){const a=e.createLinearGradient(0,t.top,0,t.bottom);return a.addColorStop(0,n?lt(.4):ct(.4)),a.addColorStop(1,n?lt(0):ct(0)),a}function ze(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e)}function ae({label:e,value:t,className:n}){return s.jsxs("div",{className:S("flex w-full flex-1 flex-row justify-between text-sm",n),children:[s.jsx("span",{className:"text-token-text-secondary font-normal whitespace-nowrap",children:e}),s.jsx("span",{className:"text-token-text-primary font-normal whitespace-nowrap",children:t})]})}function Ou({metrics:e}){const t=P(),n=!!(e.marketCap&&e.peRatio&&e.eps);return s.jsx("div",{className:"border-token-border-default flex flex-col gap-1 rounded-b-lg border-t bg-[#f4f4f4] px-4 py-3 dark:bg-[#393939]",children:s.jsxs("div",{className:S("grid grid-cols-2 gap-x-10 gap-y-3 lg:grid-cols-3 lg:gap-x-6"),children:[s.jsx(ae,{label:t.formatMessage({id:"MDHEj7",defaultMessage:"Open"}),value:t.formatNumber(e.openPrice,{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}),className:"order-1"}),s.jsx(ae,{label:t.formatMessage({id:"PboNMC",defaultMessage:"Volume"}),value:t.formatNumber(e.intradayVolume,{notation:"compact",maximumFractionDigits:1}),className:S("order-2",!n&&"lg:order-last")}),s.jsxs("div",{className:"order-4 row-span-2 flex flex-col gap-3",children:[s.jsx(ae,{label:t.formatMessage({id:"bresUW",defaultMessage:"Day Low"}),value:t.formatNumber(e.intradayLow,{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})}),s.jsx(ae,{label:t.formatMessage({id:"oWyv5V",defaultMessage:"Day High"}),value:t.formatNumber(e.intradayHigh,{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})})]}),s.jsxs("div",{className:"order-5 row-span-2 flex flex-col gap-3",children:[s.jsx(ae,{label:t.formatMessage({id:"DcEYIK",defaultMessage:"Year Low"}),value:t.formatNumber(e.fiftyTwoWeekLow,{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})}),s.jsx(ae,{label:t.formatMessage({id:"ZfFtJ4",defaultMessage:"Year High"}),value:t.formatNumber(e.fiftyTwoWeekHigh,{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})})]}),e.marketCap&&s.jsx(ae,{label:t.formatMessage({id:"BzyP4Y",defaultMessage:"Market Cap"}),value:t.formatNumber(e.marketCap,{notation:"compact",maximumFractionDigits:2}),className:"order-last lg:order-3"}),e.peRatio&&e.eps&&s.jsxs(s.Fragment,{children:[s.jsx(ae,{label:t.formatMessage({id:"edGd+S",defaultMessage:"EPS (TTM)"}),value:t.formatNumber(e.eps,{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}),className:"order-last"}),s.jsx(ae,{label:t.formatMessage({id:"AhpCu1",defaultMessage:"P/E Ratio"}),value:t.formatNumber(e.peRatio,{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}),className:"order-last"})]})]})})}function zu({data:e,priceChange:t,highlightedPrice:n,extendedPriceChange:a,url:o}){function r(i,l="intraday",d=null){const{isUp:c,changePercentage:u,changeLabel:m,changeAmount:b}=i,w=Math.abs(u).toFixed(2),x=ze(b);return s.jsxs("span",{className:"flex min-w-0 items-center gap-1",children:[l==="extended_hours"&&d!=null&&s.jsx("span",{className:"font-semibold",children:s.jsx(T,{id:"HWwWpW",defaultMessage:"{price}",values:{price:d}})}),s.jsx("span",{className:S("font-semibold",c?Ks:Js),children:s.jsx(T,{id:"3x4Lkl",defaultMessage:"{sign}{changeAmount}",values:{changeAmount:x,sign:c?"+":""}})}),s.jsx("span",{className:S("font-semibold",c?Ks:Js),children:s.jsx(T,{id:"MbfF1T",defaultMessage:"({sign}{changePercentage}%)",values:{changePercentage:w,sign:c?"+":"-"}})}),l==="extended_hours"?s.jsx("span",{className:"text-token-text-primary min-w-0 truncate",children:m}):s.jsx("span",{className:"text-token-text-primary min-w-0 truncate",children:m})]})}return s.jsxs("div",{children:[s.jsx("div",{className:"mt-2 text-sm",children:e?s.jsx(T,{id:"+2WHuv",defaultMessage:"{name} ({ticker})",values:{name:e.asset.name,ticker:e.asset.ticker}}):s.jsx("div",{className:"w-32 font-medium",children:s.jsx(Ie,{index:9,width:100})})}),s.jsx("div",{className:"text-token-text-tertiary text-sm",children:e?s.jsx(s.Fragment,{children:o!=null&&s.jsxs(s.Fragment,{children:[" · ",s.jsx(pe,{href:o,className:"text-token-link hover:underline",children:ft(o,"hostname")})]})}):s.jsx("div",{className:"mt-2 w-36",children:s.jsx(Ie,{index:6,width:100})})}),s.jsx("div",{className:"mt-2 flex text-4xl font-semibold",children:e?s.jsx(T,{id:"s+1uly",defaultMessage:"{price}",values:{price:n??ze(e.price.price)}}):s.jsx("div",{className:"w-32",children:s.jsx(Ie,{index:0,width:100})})}),s.jsx("div",{className:"mt-2 flex items-center justify-start gap-1 text-sm",children:t?r(t):s.jsx("div",{className:"mt-2 w-40",children:s.jsx(Ie,{index:3,width:100})})}),s.jsx("div",{className:"mt-0.5 flex items-center justify-start gap-1 text-sm",children:e?.price?.extended_price!=null&&a!=null&&r(a,"extended_hours",ze(e.price.extended_price))})]})}function Bu({contentReference:e,trackContentReferenceEvent:t}){const n=P();h.useEffect(()=>{t("Search Content Reference Shown","search_content_reference_shown","stock")},[t]);const a=Eu(e?.stock?.histories),o=e?.stock,[r,i]=h.useState(a),[l,d]=h.useState(null),c=r==="1d",u=o?.histories?.quotes?.[r??""]?.[0],m=r&&r in at?r:void 0,b=o&&(u&&!c?{changePercentage:(o.price.price-u.close)/u.close*100,changeAmount:o.price.price-u.close,changeLabel:m?n.formatMessage(at[m]):"",isUp:o.price.price>u.close}:o.price.change_percent&&o.price.change?{changePercentage:o.price.change_percent*100,changeAmount:o.price.change,changeLabel:Hu(o.price.latest_trade_timestamp,o.asset.timezone,n),isUp:o.price.change?o.price.change>0:!1}:null),w=o&&o.price.extended_price!=null&&o.price.extended_change_percent!=null&&o.price.extended_change!=null?{changePercentage:o.price.extended_change_percent*100,changeAmount:o.price.extended_change,changeLabel:n.formatMessage(Wu(o.price.market_status)??at.extended),isUp:o.price.extended_change>0}:null,{fiftyTwoWeekHigh:x,fiftyTwoWeekLow:j}=h.useMemo(()=>{const k=o?.histories?.quotes["1y"];if(!k)return{fiftyTwoWeekHigh:null,fiftyTwoWeekLow:null};const v=k.map(y=>y.high).filter(y=>y!=null),p=k.map(y=>y.low).filter(y=>y!=null);return{fiftyTwoWeekHigh:v.length>0?Math.max(...v):null,fiftyTwoWeekLow:p.length>0?Math.min(...p):null}},[o?.histories?.quotes]),_=o?.price.open_price&&o.price.intraday_high&&o.price.intraday_low&&o.price.intraday_volume&&x&&j?{openPrice:o.price.open_price,intradayHigh:o.price.intraday_high,intradayLow:o.price.intraday_low,intradayVolume:o.price.intraday_volume,fiftyTwoWeekHigh:x,fiftyTwoWeekLow:j,marketCap:o.metrics?.market_cap??void 0,peRatio:o.metrics?.pe_ratio??void 0,eps:o.metrics?.eps??void 0}:null,f=_!=null;return s.jsxs("div",{"data-testid":"finance-widget",className:S("border-token-border-default mb-2 flex min-h-[480px] flex-col gap-8 rounded-lg border"),children:[s.jsxs("div",{className:"mx-6 flex flex-wrap items-end justify-between",children:[s.jsx(zu,{data:o??null,highlightedPrice:l,priceChange:b??null,extendedPriceChange:w??null,url:e?.url??null}),s.jsx("div",{className:"mt-4",children:s.jsx($u,{selectedInterval:r,onSelectHistoryInterval:i,histories:o?.histories})})]}),s.jsx("div",{className:"mx-6 h-[340px]",children:s.jsx(Ru,{isUp:b?.isUp??!1,selectedInterval:r,histories:o?.histories,setHighlightedPrice:d,onSelectHistoryInterval:k=>i(k),latestTradingPeriod:o?.asset.latest_trading_period,timezone:o?.asset.timezone??null})}),f&&s.jsx("div",{className:"-mt-4",children:s.jsx(Ou,{metrics:_})})]})}function Wu(e){if(e==null)return null;const t=e.toLowerCase();return t==="premarket"||t==="open"?yt({id:"By+pvF",defaultMessage:"Pre-Market"}):t==="afterhours"||t==="closed"?yt({id:"aLCg3c",defaultMessage:"After Hours"}):yt({id:"2p526c",defaultMessage:"Extended Hours"})}function Hu(e,t,n){function a(o,r){const l=Fe(new Date,r),d=n.formatDate(l,{year:"numeric",month:"2-digit",day:"2-digit"}),c=fs(o*1e3),u=Fe(c,r),m=n.formatDate(u,{year:"numeric",month:"2-digit",day:"2-digit"});return d===m}if(!e||!t||a(e,t))return n.formatMessage(at["1d"]);{const o=fs(e*1e3),r=Fe(o,t);return n.formatDate(r,{month:"long",day:"numeric"})}}const at=Bt({"1d":{id:"SMdcuo",defaultMessage:"Today"},extended:{id:"2p526c",defaultMessage:"Extended Hours"},"5d":{id:"HCA6lr",defaultMessage:"Past 5 days"},"1m":{id:"DJpPMq",defaultMessage:"Past month"},"6m":{id:"1mUJ2L",defaultMessage:"Past 6 months"},ytd:{id:"b9KkhV",defaultMessage:"Year to date"},"1y":{id:"XnvD9A",defaultMessage:"Past year"},"5y":{id:"DfI1RB",defaultMessage:"Past 5 years"},max:{id:"WzOhuU",defaultMessage:"Max"}}),Uu={google_maps:{title:"Google Maps"}};function Vu({metadata:e,trackContentReferenceEvent:t}){h.useEffect(()=>{t("Search Content Reference Shown","search_content_reference_shown",e.type)},[t,e.type]);const n=Uu[e.provider]?.title??"Maps";return s.jsx("span",{children:s.jsx(T,{id:"ZSUz1k",defaultMessage:" ({link}) ",values:{link:s.jsx(pe,{href:e.url,children:n})}})})}function qu(e){"use forget";const t=Ve.c(19),{metadata:n,trackContentReferenceEvent:a}=e,o=n.items.length>0,r=h.useRef(a);let i,l;t[0]!==a?(i=()=>{r.current=a},l=[a],t[0]=a,t[1]=i,t[2]=l):(i=t[1],l=t[2]),h.useEffect(i,l);let d,c;t[3]!==o?(d=()=>{o&&r.current("Search Content Reference Shown","search_content_reference_shown","nav_list")},c=[o],t[3]=o,t[4]=d,t[5]=c):(d=t[4],c=t[5]),h.useEffect(d,c);let u;t[6]!==a?(u=(f,k)=>{a("link_action",null,"nav_list",{...nn(f,k),action:"click"})},t[6]=a,t[7]=u):u=t[7];const m=u;let b;t[8]!==a?(b=(f,k)=>{a("link_action",null,"nav_list",{...nn(f,k),action:"show"})},t[8]=a,t[9]=b):b=t[9];const w=b;if(n.items.length===0)return null;let x;t[10]!==n.title?(x=n.title&&s.jsx("div",{className:"text-token-text-primary -mb-1 pb-3 font-semibold",children:n.title}),t[10]=n.title,t[11]=x):x=t[11];let j;t[12]!==m||t[13]!==w||t[14]!==n.items?(j=s.jsx(ua,{items:n.items,onCardRender:Gu,onCardShown:w,onCardClicked:m,cardClassName:"transition-all duration-200 border-token-border-default hover:border-light border rounded-xl bg-clip-padding hover:shadow-md overflow-hidden"}),t[12]=m,t[13]=w,t[14]=n.items,t[15]=j):j=t[15];let _;return t[16]!==x||t[17]!==j?(_=s.jsxs("div",{className:"mt-6 mb-1","data-testid":"nav-list-widget",children:[x,j]}),t[16]=x,t[17]=j,t[18]=_):_=t[18],_}function Gu(e){return s.jsx(Zu,{item:e})}function Zu({item:e}){const{isSuccess:t}=At(e.thumbnail_url??void 0,"NavListItem"),n=P(),a=Jr(n,e.pub_date);return s.jsxs(pe,{className:"flex flex-col items-center gap-4 overflow-hidden pb-6",href:e.url,children:[t&&e.thumbnail_url?s.jsx("div",{className:"relative h-36 w-full overflow-hidden",children:s.jsx("img",{src:e.thumbnail_url,className:"m-0 h-full w-full",style:{objectFit:"cover"},alt:e.title})}):s.jsxs("div",{className:"icon-bg relative flex h-36 w-full shrink-0 items-center justify-center overflow-hidden",children:[s.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-cover bg-center bg-no-repeat blur-3xl",children:s.jsx(De,{url:e.url,size:256,minSize:128,className:"mix-soft-light opacity-30 dark:opacity-20"})}),s.jsx("div",{className:"absolute flex h-10 w-10 items-center justify-center",children:s.jsx(De,{url:e.url,size:128,minSize:80,className:"icon-xl rounded-full"})})]}),s.jsxs("div",{className:"flex flex-col gap-2 overflow-hidden px-4 text-ellipsis",children:[s.jsxs("div",{className:"text-token-text-primary flex items-center gap-1.5 text-xs",children:[s.jsx(De,{url:e.url,size:32,minSize:16,className:"icon-xs my-0 rounded-full"}),e.attribution??ft(e.url)]}),s.jsx("div",{className:"text-token-text-primary decoration-token-link line-clamp-5 text-sm font-medium",children:e.title}),a&&s.jsx("div",{className:"text-token-text-secondary text-xs",children:a})]})]})}const nn=(e,t)=>({url:e.url,title:e.title,section_index:t,link_type:"text",section:"nav_list",section_location:"response"}),Yu="{{.assetPrefix}}/assets/missing-logo-h96s4tk9.webp",an={src:Yu};function pa({team:e,className:t}){const[n,a]=h.useState(e.logo??an.src),o=()=>{Le.addError("Unable to load sports widget logo",{name:e.name,logo:e.logo}),a(an.src)};return s.jsx("img",{src:n,alt:e.name,className:t,onError:o})}const Ue=["ipl"],on=6,ve="home",_e="away";function Xu({scheduleRef:e,trackContentReferenceEvent:t}){const[n,a]=h.useState(!0),o=P(),r=e.games.length>0,i=e.league.id,l=Qr(),d=Ye();if(h.useEffect(()=>{r&&t("Search Content Reference Shown","search_content_reference_shown","sports",{hasSchedule:!0})},[r]),!r)return null;const u=(o.formatDateToParts(new Date,{timeZoneName:"long"}).find(x=>x.type==="timeZoneName")?.value??Intl.DateTimeFormat().resolvedOptions().timeZone).replace(/Daylight|Standard/g,"");let m=e.games;const b=x=>Math.abs(new Date().getTime()-new Date(x.date).getTime());b(m[0])>b(m[m.length-1])&&(m=m.slice().reverse());const w=n?m.slice(0,on):m;return s.jsxs("div",{className:"not-prose mb-3","data-testid":"sports-schedule-widget",children:[s.jsx("div",{className:"font-semibold",children:s.jsx(T,{id:"LA6z9q",defaultMessage:"{league} Schedule",values:{league:e.league.display_name}})}),s.jsx("div",{className:"text-token-text-secondary text-sm",children:u}),w.length===1?s.jsx("div",{children:s.jsx(Pt,{children:s.jsx(he.div,{initial:{opacity:0,y:15},animate:{opacity:1,y:0},exit:{opacity:0,y:-15},transition:{duration:.2},children:s.jsx("div",{className:"border-token-border-medium mt-3 rounded-xl border py-3",children:s.jsx(Ju,{game:w[0],useAlias:Ue.includes(i),leagueId:i,activeTeam:w[0]?.active_team??null,isMobile:d})})})})}):s.jsx("div",{className:"grid grid-cols-1 pt-3 lg:grid-cols-2",children:s.jsx(Pt,{children:w.map((x,j)=>s.jsx(he.div,{initial:{opacity:0,y:15},animate:{opacity:1,y:0,transition:{delay:j*.04}},exit:{opacity:0,y:-15},transition:{duration:.2},children:s.jsx("div",{className:S("border-token-border-medium border-b py-3",j%2===0&&"lg:border-e lg:pe-4",j%2===1&&"lg:ps-4",Math.floor(j/2)===Math.ceil(m.length/2)-1&&"lg:border-b-0",j===m.length-1&&"border-b-0"),children:s.jsx(Ku,{game:x,useAlias:(l||d)&&Ue.includes(i),leagueId:i,activeTeam:x.active_team??null})})},j))})}),m.length>on&&s.jsx("div",{className:"mt-2 flex items-center justify-between",children:s.jsx("button",{className:"flex items-center text-sm font-semibold",onClick:()=>a(!n),children:n?s.jsx(T,{id:"BH/Ee5",defaultMessage:"Show more {icon}",values:{icon:s.jsx(Wo,{className:"mb-[-2px]"})}}):s.jsx(T,{id:"Z9BlEu",defaultMessage:"Show less {icon}",values:{icon:s.jsx(Ho,{className:"mb-[-2px]"})}})})})]})}function Ku({game:e,useAlias:t=!1,leagueId:n,activeTeam:a}){const o=xa(e),r=[e.first_team_info,e.second_team_info],i=r.find(u=>u.location===ve)??e.first_team_info,l=r.find(u=>u.location===_e)??e.second_team_info,d=o?.team.name===i?.team.name,c=o?.team.name===l?.team.name;return s.jsxs("div",{className:"flex w-full gap-1.5 py-3 text-base",children:[s.jsxs("div",{className:"flex flex-auto flex-col items-start gap-1 pe-3",children:[s.jsx(ut,{team:l.team,isWinner:c,isActive:a===_e,logoSize:"small",useAlias:t}),s.jsx(ut,{team:i.team,isWinner:d,isActive:a===ve,logoSize:"small",useAlias:t})]}),s.jsxs("div",{className:S("flex flex-none flex-col items-start gap-1",Ue.includes(n)&&"me-4"),children:[s.jsx(mt,{score:l.score,scoreSuffix:l.score_suffix,scoreParenthetical:l.score_parenthetical?{message:l.score_parenthetical,position:"right"}:null,isWinner:c,negateScore:dt(n,_e,a)}),s.jsx(mt,{score:i.score,scoreSuffix:i.score_suffix,scoreParenthetical:i.score_parenthetical?{message:i.score_parenthetical,position:"right"}:null,isWinner:d,negateScore:dt(n,ve,a)})]}),s.jsx("div",{className:"flex min-w-24 flex-none flex-col items-end justify-center gap-1 text-sm",children:s.jsx(ya,{game:e})})]})}function Ju({game:e,useAlias:t=!1,leagueId:n,activeTeam:a,isMobile:o}){const r=xa(e),i=[e.first_team_info,e.second_team_info],l=i.find(m=>m.location===ve)??e.first_team_info,d=i.find(m=>m.location===_e)??e.second_team_info,c=r?.team.name===l?.team.name,u=r?.team.name===d?.team.name;return s.jsxs("div",{className:"flex w-full py-3 text-base",children:[s.jsx("div",{className:"flex flex-1 items-center justify-center px-2",children:s.jsx(ut,{team:d.team,isWinner:u,isActive:a===_e,useAlias:t,layoutDirection:o?"column":"row"})}),s.jsx("div",{className:"ms-2 flex items-center justify-start sm:ms-8",children:s.jsx(mt,{score:d.score,scoreSuffix:d.score_suffix,scoreParenthetical:d.score_parenthetical?{message:d.score_parenthetical,position:"bottom"}:null,isWinner:u,negateScore:dt(n,_e,a),className:"text-sm font-semibold sm:text-lg"})}),s.jsx("div",{className:"mx-2 flex w-24 shrink flex-col items-center justify-center gap-1 align-middle text-sm",children:s.jsx(ya,{game:e})}),s.jsx("div",{className:"me-2 flex items-center justify-end sm:me-8",children:s.jsx(mt,{score:l.score,scoreSuffix:l.score_suffix,scoreParenthetical:l.score_parenthetical?{message:l.score_parenthetical,position:"bottom"}:null,isWinner:c,negateScore:dt(n,ve,a),className:"text-sm font-semibold sm:text-lg"})}),s.jsx("div",{className:"flex flex-1 items-center justify-center md:px-2",children:s.jsx(ut,{team:l.team,isWinner:c,isActive:a===ve,useAlias:t,layoutDirection:o?"column":"row"})})]})}function ga(e){return e.live?"live":new Date(e.date)<new Date?"complete":"scheduled"}function xa(e){return ga(e)!=="complete"||e.first_team_info.score==null||e.second_team_info.score==null?null:e.first_team_info.score>e.second_team_info.score?e.first_team_info:e.second_team_info}function dt(e,t,n){return Ue.includes(e)&&t===ve&&n===_e}function ut({team:e,isWinner:t,isActive:n,logoSize:a,useAlias:o=!1,layoutDirection:r="row"}){return s.jsxs("span",{className:S("flex items-center gap-1",t&&"font-semibold","max-w-64 lg:max-w-52 xl:max-w-64",r==="column"&&"flex-col"),children:[e.logo&&s.jsx(pa,{team:{name:e.name,logo:e.logo},className:S(a==="small"?"w-6":"w-8")}),s.jsx("span",{className:"truncate",children:o?e.alias:e.name}),n&&s.jsx("span",{className:"bg-token-surface-error inline-block h-2 w-2 rounded-full"})]})}function mt({score:e,scoreSuffix:t,scoreParenthetical:n,isWinner:a,negateScore:o=!1,className:r}){const i=P();return e==null?null:s.jsxs("span",{className:S(a&&"font-semibold",r),children:[o?i.formatMessage({id:"sports.dash",defaultMessage:"-"}):e,t&&!o&&s.jsx("span",{children:t}),n&&!o&&s.jsx("span",{className:S("text-token-text-secondary font-normal",n.position==="right"&&"ms-1",n.position==="bottom"&&"mx-auto block text-center"),children:`(${n.message})`})]})}function ya({game:e}){const t=P();switch(ga(e)){case"live":return s.jsxs(s.Fragment,{children:[s.jsx(Qu,{}),s.jsx("div",{children:e.details})]});case"complete":return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"font-semibold",children:s.jsx(T,{id:"q/iMZL",defaultMessage:"Final"})}),s.jsx("div",{className:"text-token-text-secondary",children:Rt(t,new Date(e.date))})]});case"scheduled":{const n=new Date(e.date);return isNaN(n.getTime())?null:s.jsxs(s.Fragment,{children:[s.jsx("div",{children:Rt(t,n)}),s.jsx("div",{className:"text-token-text-secondary",children:t.formatDate(n,{timeStyle:"short"})})]})}}}function Qu(){return s.jsx("div",{className:"bg-token-surface-error rounded-[4px] px-1.5 py-1 text-xs font-semibold text-white",children:s.jsx(T,{id:"vObALn",defaultMessage:"Live"})})}function em({standingsRef:e,trackContentReferenceEvent:t}){const[n,a]=h.useState(0),o=e.conferences.length>0,r=Ye(),i=e.league.id;h.useEffect(()=>{o&&t("Search Content Reference Shown","search_content_reference_shown","sports",{hasStandings:!0})},[o]);const l=e.conferences[n],d=e.conferences.length>1?e.conferences.map((c,u)=>s.jsx("button",{className:S(n===u?"text-token-text-primary":"text-token-text-tertiary","text-sm font-semibold"),onClick:()=>a(u),children:c.name},c.name)):null;return s.jsxs("div",{"data-testid":"sports-standings-widget",children:[d&&s.jsx("div",{className:"flex gap-4",children:d}),s.jsx("div",{className:"mt-3",children:l.divisions.map(c=>c.name?s.jsx("div",{className:"mt-3",children:s.jsx(rn,{division:c,teamsColumnHeader:c.name})},c.name):s.jsx(rn,{division:c,useAlias:r&&Ue.includes(i)}))})]})}function rn({division:e,teamsColumnHeader:t,useAlias:n}){const a=e.headers.map(o=>o.key);return s.jsxs(V.Root,{size:"compact",className:"not-prose",children:[s.jsxs(V.Header,{children:[s.jsx(tm,{children:t??s.jsx(T,{id:"kKSGje",defaultMessage:"Team"})}),e.headers.map(o=>s.jsx(ba,{textAlign:"center",className:"min-w-11 px-0!",children:s.jsx(ln,{data:o})},o.key))]}),s.jsx(V.Body,{children:e.teams.map(({team:o,data:r},i)=>{const l=r.reduce((d,c)=>(d[c.key]=c,d),{});return s.jsxs(V.Row,{children:[s.jsx(V.Cell,{className:"w-full border-0! py-0! ps-0!",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"text-token-text-tertiary me-2 w-4 whitespace-nowrap tabular-nums",children:i+1}),s.jsxs("div",{className:"flex items-center justify-start gap-2",children:[s.jsx(pa,{team:o,className:"w-6"}),s.jsx("span",{className:"text-base whitespace-nowrap",children:n?o.alias:o.name})]})]})}),a.map(d=>s.jsx(V.Cell,{className:"min-w-11 border-0! px-0! py-0! text-start whitespace-nowrap tabular-nums",textAlign:"center",children:s.jsx(ln,{data:l[d]})},d))]},o.name)})})]})}function ln({data:e}){switch(e.type){case"text":return s.jsx(s.Fragment,{children:e.text});default:return s.jsx(s.Fragment,{children:e.alt})}}const ba=ts(V.HeaderCell)`text-token-text-secondary font-normal! text-sm static! bg-transparent! border-token-border-default! border-t-0! border-s-0! border-e-0!`,tm=ts(ba)`text-token-text-primary ps-0!`;function sm({metadata:e,trackContentReferenceEvent:t}){h.useEffect(()=>{t("Search Content Reference Shown","search_content_reference_shown",e.type)},[t,e.type]);const n=P(),a=Fe(e.utc_time,e.utc_offset),o=n.formatDate(a,{hour:"numeric",minute:"numeric"});return s.jsx("span",{children:o})}function nm({metadata:e,trackContentReferenceEvent:t}){return h.useEffect(()=>{t("Search Content Reference Shown","search_content_reference_shown",e.type)},[t,e.type]),s.jsx("div",{children:e.url?s.jsx(Uo,{webpageItem:{url:e.url,title:e.description,pub_date:null,snippet:"",attributions:null},className:"inline-flex flex-col",children:s.jsx(pe,{href:e.url,className:"font-semibold!",children:e.description})}):s.jsx("div",{className:"font-semibold!",children:e.description})})}function am({videoId:e,title:t="YouTube video player",fallbackText:n,cookieLess:a=!0,timeoutMs:o=5e3,className:r=""}){const i=h.useRef(null),l=h.useRef(null),d=h.useRef(!1),[c,u]=h.useState("idle"),m=()=>{d.current=!0,l.current&&(clearTimeout(l.current),l.current=null)};if(h.useEffect(()=>{u("loading"),d.current=!1;let w=null;return om().then(()=>{if(!i.current)return;i.current.textContent="",w=document.createElement("div"),w.style.width="200px",w.style.height="150px",i.current.appendChild(w),l.current=window.setTimeout(()=>{d.current||u("timeout")},o);const x=a?"https://www.youtube-nocookie.com":"https://www.youtube.com";new window.YT.Player(w,{width:200,height:150,videoId:e,host:x,playerVars:{rel:0,playsinline:1,origin:window.location.origin},events:{onReady:()=>{m(),u("ready")},onError:()=>{m(),u("error")}}})}).catch(()=>u("error")),()=>{m()}},[e,a,o]),c==="error"||c==="timeout")return s.jsx("a",{href:`https://www.youtube.com/watch?v=${e}`,target:"_blank",rel:"noopener noreferrer",children:n});const b=a?"https://www.youtube-nocookie.com":"https://www.youtube.com";return s.jsxs(s.Fragment,{children:[s.jsx("div",{ref:i,"aria-hidden":!0,inert:!0,className:"hidden"}),s.jsx("iframe",{src:`${b}/embed/${e}`,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerPolicy:"strict-origin-when-cross-origin",allowFullScreen:!0,className:r,title:t})]})}function om(){return new Promise(e=>{if(window.YT?.Player)return e();const t=window.onYouTubeIframeAPIReady;if(window.onYouTubeIframeAPIReady=()=>{t?.(),e(),window.onYouTubeIframeAPIReady=t||(()=>{})},!document.querySelector("script[src*='youtube.com/iframe_api']")){const n=document.createElement("script");n.src="https://www.youtube.com/iframe_api",document.head.appendChild(n)}})}function rm({url:e,className:t,iframeClassName:n,iframeTitle:a}){const o=B(),r=F(o,"1256582879");let i;const l=S("aspect-video w-full",n),d=im(e);d&&(i=r?s.jsx(am,{className:l,videoId:d,title:a,fallbackText:a??s.jsx(T,{id:"sonic.video.youtube.title",defaultMessage:"YouTube video link"}),cookieLess:!1}):s.jsx(lm,{videoId:d,className:l,iframeTitle:a}));const c=cm(e);return c&&(i=s.jsx(dm,{videoId:c,className:l,iframeTitle:a})),i?s.jsx("div",{className:t,children:i}):null}function im(e){const t=/^(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/(?:watch\?v=|shorts\/|embed\/|v\/|live\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/,n=e.match(t);return n?n[1]:null}function lm({videoId:e,className:t,iframeTitle:n}){return s.jsx("iframe",{className:t,src:`https://www.youtube.com/embed/${e}`,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerPolicy:"strict-origin-when-cross-origin",allowFullScreen:!0,title:n})}function cm(e){const t=/vimeo\.com\/(?:channels\/(?:\w+\/)?|groups\/[^/]+\/videos\/|video\/|)(\d+)/,n=e.match(t);return n?n[1]:null}function dm({videoId:e,className:t,iframeTitle:n}){return s.jsx(s.Fragment,{children:s.jsx("iframe",{className:t,src:`https://player.vimeo.com/video/${e}`,frameBorder:"0",allow:"autoplay; fullscreen; picture-in-picture",allowFullScreen:!0,title:n})})}function um({video:e,trackContentReferenceEvent:t}){const n={url:e.url,title:e.title};return h.useEffect(()=>{t("Search Content Reference Shown","search_content_reference_shown",e.type,n)},[]),e.url==null||e.url===""?null:s.jsx("div",{className:"not-prose mb-3 flex flex-col gap-4 text-base","data-testid":"video-widget",children:s.jsx(rm,{url:e.url,iframeClassName:"rounded-lg"})})}const mm="webp",hm=96,fm=96,pm="srgb",gm=4,xm="uchar",ym=288,bm=!1,wm=!1,vm=!0,_m="{{.assetPrefix}}/assets/cloud-foggy-o4a3hmky.webp",jm={format:mm,width:hm,height:fm,space:pm,channels:gm,depth:xm,density:ym,isProgressive:bm,hasProfile:wm,hasAlpha:vm,src:_m},km="webp",Cm=96,Sm=96,Mm="srgb",Nm=4,Tm="uchar",$m=288,Em=!1,Pm=!1,Lm=!0,Am="{{.assetPrefix}}/assets/cloudy-co8vwrk7.webp",Rm={format:km,width:Cm,height:Sm,space:Mm,channels:Nm,depth:Tm,density:$m,isProgressive:Em,hasProfile:Pm,hasAlpha:Lm,src:Am},Im="webp",Dm=96,Fm=96,Om="srgb",zm=4,Bm="uchar",Wm=288,Hm=!1,Um=!1,Vm=!0,qm="{{.assetPrefix}}/assets/heavy-snow-mke52kag.webp",Gm={format:Im,width:Dm,height:Fm,space:Om,channels:zm,depth:Bm,density:Wm,isProgressive:Hm,hasProfile:Um,hasAlpha:Vm,src:qm},Zm="webp",Ym=96,Xm=96,Km="srgb",Jm=4,Qm="uchar",eh=288,th=!1,sh=!1,nh=!0,ah="{{.assetPrefix}}/assets/light-snow-mcy1l7t9.webp",oh={format:Zm,width:Ym,height:Xm,space:Km,channels:Jm,depth:Qm,density:eh,isProgressive:th,hasProfile:sh,hasAlpha:nh,src:ah},rh="webp",ih=96,lh=96,ch="srgb",dh=4,uh="uchar",mh=288,hh=!1,fh=!1,ph=!0,gh="{{.assetPrefix}}/assets/moon-drizzle-cplxr2ub.webp",xh={format:rh,width:ih,height:lh,space:ch,channels:dh,depth:uh,density:mh,isProgressive:hh,hasProfile:fh,hasAlpha:ph,src:gh},yh="webp",bh=96,wh=96,vh="srgb",_h=4,jh="uchar",kh=288,Ch=!1,Sh=!1,Mh=!0,Nh="{{.assetPrefix}}/assets/moon-hazy-jvgt25bp.webp",Th={format:yh,width:bh,height:wh,space:vh,channels:_h,depth:jh,density:kh,isProgressive:Ch,hasProfile:Sh,hasAlpha:Mh,src:Nh},$h="webp",Eh=96,Ph=96,Lh="srgb",Ah=4,Rh="uchar",Ih=288,Dh=!1,Fh=!1,Oh=!0,zh="{{.assetPrefix}}/assets/moon-mostly-cloudy-cia3do0v.webp",Bh={format:$h,width:Eh,height:Ph,space:Lh,channels:Ah,depth:Rh,density:Ih,isProgressive:Dh,hasProfile:Fh,hasAlpha:Oh,src:zh},Wh="webp",Hh=96,Uh=96,Vh="srgb",qh=4,Gh="uchar",Zh=288,Yh=!1,Xh=!1,Kh=!0,Jh="{{.assetPrefix}}/assets/moon-mostly-sunny-n3mh1b6a.webp",Qh={format:Wh,width:Hh,height:Uh,space:Vh,channels:qh,depth:Gh,density:Zh,isProgressive:Yh,hasProfile:Xh,hasAlpha:Kh,src:Jh},ef="webp",tf=96,sf=96,nf="srgb",af=4,of="uchar",rf=288,lf=!1,cf=!1,df=!0,uf="{{.assetPrefix}}/assets/moon-shower-ntzhti9o.webp",mf={format:ef,width:tf,height:sf,space:nf,channels:af,depth:of,density:rf,isProgressive:lf,hasProfile:cf,hasAlpha:df,src:uf},hf="webp",ff=96,pf=96,gf="srgb",xf=4,yf="uchar",bf=288,wf=!1,vf=!1,_f=!0,jf="{{.assetPrefix}}/assets/moon-sunny-eg2emh4d.webp",kf={format:hf,width:ff,height:pf,space:gf,channels:xf,depth:yf,density:bf,isProgressive:wf,hasProfile:vf,hasAlpha:_f,src:jf},Cf="webp",Sf=96,Mf=96,Nf="srgb",Tf=4,$f="uchar",Ef=288,Pf=!1,Lf=!1,Af=!0,Rf="{{.assetPrefix}}/assets/rain-thunder-bx7a0l5g.webp",If={format:Cf,width:Sf,height:Mf,space:Nf,channels:Tf,depth:$f,density:Ef,isProgressive:Pf,hasProfile:Lf,hasAlpha:Af,src:Rf},Df="webp",Ff=96,Of=96,zf="srgb",Bf=4,Wf="uchar",Hf=288,Uf=!1,Vf=!1,qf=!0,Gf="{{.assetPrefix}}/assets/rain-cxs76xuj.webp",Zf={format:Df,width:Ff,height:Of,space:zf,channels:Bf,depth:Wf,density:Hf,isProgressive:Uf,hasProfile:Vf,hasAlpha:qf,src:Gf},Yf="webp",Xf=96,Kf=96,Jf="srgb",Qf=4,ep="uchar",tp=288,sp=!1,np=!1,ap=!0,op="{{.assetPrefix}}/assets/sleet-gc63vwmo.webp",rp={format:Yf,width:Xf,height:Kf,space:Jf,channels:Qf,depth:ep,density:tp,isProgressive:sp,hasProfile:np,hasAlpha:ap,src:op},ip="webp",lp=96,cp=96,dp="srgb",up=4,mp="uchar",hp=288,fp=!1,pp=!1,gp=!0,xp="{{.assetPrefix}}/assets/snow-d0k6tmmc.webp",yp={format:ip,width:lp,height:cp,space:dp,channels:up,depth:mp,density:hp,isProgressive:fp,hasProfile:pp,hasAlpha:gp,src:xp},bp="webp",wp=96,vp=96,_p="srgb",jp=4,kp="uchar",Cp=288,Sp=!1,Mp=!1,Np=!0,Tp="{{.assetPrefix}}/assets/sun-drizzle-g94obr5e.webp",$p={format:bp,width:wp,height:vp,space:_p,channels:jp,depth:kp,density:Cp,isProgressive:Sp,hasProfile:Mp,hasAlpha:Np,src:Tp},Ep="webp",Pp=96,Lp=96,Ap="srgb",Rp=4,Ip="uchar",Dp=288,Fp=!1,Op=!1,zp=!0,Bp="{{.assetPrefix}}/assets/sun-hazy-c3z1j0hy.webp",Wp={format:Ep,width:Pp,height:Lp,space:Ap,channels:Rp,depth:Ip,density:Dp,isProgressive:Fp,hasProfile:Op,hasAlpha:zp,src:Bp},Hp="webp",Up=96,Vp=96,qp="srgb",Gp=4,Zp="uchar",Yp=288,Xp=!1,Kp=!1,Jp=!0,Qp="{{.assetPrefix}}/assets/sun-mostly-cloudy-d4o4zkga.webp",eg={format:Hp,width:Up,height:Vp,space:qp,channels:Gp,depth:Zp,density:Yp,isProgressive:Xp,hasProfile:Kp,hasAlpha:Jp,src:Qp},tg="webp",sg=96,ng=96,ag="srgb",og=4,rg="uchar",ig=288,lg=!1,cg=!1,dg=!0,ug="{{.assetPrefix}}/assets/sun-mostly-sunny-livrdkgu.webp",mg={format:tg,width:sg,height:ng,space:ag,channels:og,depth:rg,density:ig,isProgressive:lg,hasProfile:cg,hasAlpha:dg,src:ug},hg="webp",fg=96,pg=96,gg="srgb",xg=4,yg="uchar",bg=288,wg=!1,vg=!1,_g=!0,jg="{{.assetPrefix}}/assets/sun-shower-lvtjthah.webp",kg={format:hg,width:fg,height:pg,space:gg,channels:xg,depth:yg,density:bg,isProgressive:wg,hasProfile:vg,hasAlpha:_g,src:jg},Cg="webp",Sg=96,Mg=96,Ng="srgb",Tg=4,$g="uchar",Eg=288,Pg=!1,Lg=!1,Ag=!0,Rg="{{.assetPrefix}}/assets/sun-sunny-kqjpjzd8.webp",Ig={format:Cg,width:Sg,height:Mg,space:Ng,channels:Tg,depth:$g,density:Eg,isProgressive:Pg,hasProfile:Lg,hasAlpha:Ag,src:Rg},Dg="webp",Fg=96,Og=96,zg="srgb",Bg=4,Wg="uchar",Hg=288,Ug=!1,Vg=!1,qg=!0,Gg="{{.assetPrefix}}/assets/thunder-jgjqg9ai.webp",Zg={format:Dg,width:Fg,height:Og,space:zg,channels:Bg,depth:Wg,density:Hg,isProgressive:Ug,hasProfile:Vg,hasAlpha:qg,src:Gg},Yg="webp",Xg=96,Kg=96,Jg="srgb",Qg=4,ex="uchar",tx=288,sx=!1,nx=!1,ax=!0,ox="{{.assetPrefix}}/assets/tornado-opa24tq3.webp",rx={format:Yg,width:Xg,height:Kg,space:Jg,channels:Qg,depth:ex,density:tx,isProgressive:sx,hasProfile:nx,hasAlpha:ax,src:ox},ix="webp",lx=96,cx=96,dx="srgb",ux=4,mx="uchar",hx=288,fx=!1,px=!1,gx=!0,xx="{{.assetPrefix}}/assets/windy-mw0a3u21.webp",yx={format:ix,width:lx,height:cx,space:dx,channels:ux,depth:mx,density:hx,isProgressive:fx,hasProfile:px,hasAlpha:gx,src:xx},bx="webp",wx=96,vx=96,_x="srgb",jx=4,kx="uchar",Cx=288,Sx=!1,Mx=!1,Nx=!0,Tx="{{.assetPrefix}}/assets/cloud-foggy-fhg0jn0w.webp",$x={format:bx,width:wx,height:vx,space:_x,channels:jx,depth:kx,density:Cx,isProgressive:Sx,hasProfile:Mx,hasAlpha:Nx,src:Tx},Ex="webp",Px=96,Lx=96,Ax="srgb",Rx=4,Ix="uchar",Dx=288,Fx=!1,Ox=!1,zx=!0,Bx="{{.assetPrefix}}/assets/cloudy-disd26f3.webp",Wx={format:Ex,width:Px,height:Lx,space:Ax,channels:Rx,depth:Ix,density:Dx,isProgressive:Fx,hasProfile:Ox,hasAlpha:zx,src:Bx},Hx="webp",Ux=96,Vx=96,qx="srgb",Gx=4,Zx="uchar",Yx=288,Xx=!1,Kx=!1,Jx=!0,Qx="{{.assetPrefix}}/assets/heavy-snow-g6jjwo2d.webp",e1={format:Hx,width:Ux,height:Vx,space:qx,channels:Gx,depth:Zx,density:Yx,isProgressive:Xx,hasProfile:Kx,hasAlpha:Jx,src:Qx},t1="webp",s1=96,n1=96,a1="srgb",o1=4,r1="uchar",i1=288,l1=!1,c1=!1,d1=!0,u1="{{.assetPrefix}}/assets/light-snow-iz0efpkh.webp",m1={format:t1,width:s1,height:n1,space:a1,channels:o1,depth:r1,density:i1,isProgressive:l1,hasProfile:c1,hasAlpha:d1,src:u1},h1="webp",f1=96,p1=96,g1="srgb",x1=4,y1="uchar",b1=288,w1=!1,v1=!1,_1=!0,j1="{{.assetPrefix}}/assets/moon-drizzle-b1nfv39c.webp",k1={format:h1,width:f1,height:p1,space:g1,channels:x1,depth:y1,density:b1,isProgressive:w1,hasProfile:v1,hasAlpha:_1,src:j1},C1="webp",S1=96,M1=96,N1="srgb",T1=4,$1="uchar",E1=288,P1=!1,L1=!1,A1=!0,R1="{{.assetPrefix}}/assets/moon-hazy-nfnzea7a.webp",I1={format:C1,width:S1,height:M1,space:N1,channels:T1,depth:$1,density:E1,isProgressive:P1,hasProfile:L1,hasAlpha:A1,src:R1},D1="webp",F1=96,O1=96,z1="srgb",B1=4,W1="uchar",H1=288,U1=!1,V1=!1,q1=!0,G1="{{.assetPrefix}}/assets/moon-mostly-cloudy-e56e3z55.webp",Z1={format:D1,width:F1,height:O1,space:z1,channels:B1,depth:W1,density:H1,isProgressive:U1,hasProfile:V1,hasAlpha:q1,src:G1},Y1="webp",X1=96,K1=96,J1="srgb",Q1=4,e0="uchar",t0=288,s0=!1,n0=!1,a0=!0,o0="{{.assetPrefix}}/assets/moon-mostly-sunny-ffu4gzf4.webp",r0={format:Y1,width:X1,height:K1,space:J1,channels:Q1,depth:e0,density:t0,isProgressive:s0,hasProfile:n0,hasAlpha:a0,src:o0},i0="webp",l0=96,c0=96,d0="srgb",u0=4,m0="uchar",h0=288,f0=!1,p0=!1,g0=!0,x0="{{.assetPrefix}}/assets/moon-shower-e5dy9u48.webp",y0={format:i0,width:l0,height:c0,space:d0,channels:u0,depth:m0,density:h0,isProgressive:f0,hasProfile:p0,hasAlpha:g0,src:x0},b0="webp",w0=96,v0=96,_0="srgb",j0=4,k0="uchar",C0=288,S0=!1,M0=!1,N0=!0,T0="{{.assetPrefix}}/assets/moon-sunny-d9o08xiw.webp",$0={format:b0,width:w0,height:v0,space:_0,channels:j0,depth:k0,density:C0,isProgressive:S0,hasProfile:M0,hasAlpha:N0,src:T0},E0="webp",P0=96,L0=96,A0="srgb",R0=4,I0="uchar",D0=288,F0=!1,O0=!1,z0=!0,B0="{{.assetPrefix}}/assets/rain-thunder-eplemvu1.webp",W0={format:E0,width:P0,height:L0,space:A0,channels:R0,depth:I0,density:D0,isProgressive:F0,hasProfile:O0,hasAlpha:z0,src:B0},H0="webp",U0=96,V0=96,q0="srgb",G0=4,Z0="uchar",Y0=288,X0=!1,K0=!1,J0=!0,Q0="{{.assetPrefix}}/assets/rain-ogayr6kt.webp",ey={format:H0,width:U0,height:V0,space:q0,channels:G0,depth:Z0,density:Y0,isProgressive:X0,hasProfile:K0,hasAlpha:J0,src:Q0},ty="webp",sy=96,ny=96,ay="srgb",oy=4,ry="uchar",iy=288,ly=!1,cy=!1,dy=!0,uy="{{.assetPrefix}}/assets/sleet-o8noil7l.webp",my={format:ty,width:sy,height:ny,space:ay,channels:oy,depth:ry,density:iy,isProgressive:ly,hasProfile:cy,hasAlpha:dy,src:uy},hy="webp",fy=96,py=96,gy="srgb",xy=4,yy="uchar",by=288,wy=!1,vy=!1,_y=!0,jy="{{.assetPrefix}}/assets/snow-lq4cl3uc.webp",ky={format:hy,width:fy,height:py,space:gy,channels:xy,depth:yy,density:by,isProgressive:wy,hasProfile:vy,hasAlpha:_y,src:jy},Cy="webp",Sy=96,My=96,Ny="srgb",Ty=4,$y="uchar",Ey=288,Py=!1,Ly=!1,Ay=!0,Ry="{{.assetPrefix}}/assets/sun-drizzle-htsohv65.webp",Iy={format:Cy,width:Sy,height:My,space:Ny,channels:Ty,depth:$y,density:Ey,isProgressive:Py,hasProfile:Ly,hasAlpha:Ay,src:Ry},Dy="webp",Fy=96,Oy=96,zy="srgb",By=4,Wy="uchar",Hy=288,Uy=!1,Vy=!1,qy=!0,Gy="{{.assetPrefix}}/assets/sun-hazy-nfj7clcd.webp",Zy={format:Dy,width:Fy,height:Oy,space:zy,channels:By,depth:Wy,density:Hy,isProgressive:Uy,hasProfile:Vy,hasAlpha:qy,src:Gy},Yy="webp",Xy=96,Ky=96,Jy="srgb",Qy=4,eb="uchar",tb=288,sb=!1,nb=!1,ab=!0,ob="{{.assetPrefix}}/assets/sun-mostly-cloudy-e3pqqgs7.webp",rb={format:Yy,width:Xy,height:Ky,space:Jy,channels:Qy,depth:eb,density:tb,isProgressive:sb,hasProfile:nb,hasAlpha:ab,src:ob},ib="webp",lb=96,cb=96,db="srgb",ub=4,mb="uchar",hb=288,fb=!1,pb=!1,gb=!0,xb="{{.assetPrefix}}/assets/sun-mostly-sunny-o99k1c7a.webp",yb={format:ib,width:lb,height:cb,space:db,channels:ub,depth:mb,density:hb,isProgressive:fb,hasProfile:pb,hasAlpha:gb,src:xb},bb="webp",wb=96,vb=96,_b="srgb",jb=4,kb="uchar",Cb=288,Sb=!1,Mb=!1,Nb=!0,Tb="{{.assetPrefix}}/assets/sun-shower-ldwl4jbp.webp",$b={format:bb,width:wb,height:vb,space:_b,channels:jb,depth:kb,density:Cb,isProgressive:Sb,hasProfile:Mb,hasAlpha:Nb,src:Tb},Eb="webp",Pb=96,Lb=96,Ab="srgb",Rb=4,Ib="uchar",Db=!1,Fb=!1,Ob=!0,zb="{{.assetPrefix}}/assets/sun-sunny-kqjpjzd8.webp",Bb={format:Eb,width:Pb,height:Lb,space:Ab,channels:Rb,depth:Ib,isProgressive:Db,hasProfile:Fb,hasAlpha:Ob,src:zb},Wb="webp",Hb=96,Ub=96,Vb="srgb",qb=4,Gb="uchar",Zb=288,Yb=!1,Xb=!1,Kb=!0,Jb="{{.assetPrefix}}/assets/thunder-xzn1cku3.webp",Qb={format:Wb,width:Hb,height:Ub,space:Vb,channels:qb,depth:Gb,density:Zb,isProgressive:Yb,hasProfile:Xb,hasAlpha:Kb,src:Jb},ew="webp",tw=96,sw=96,nw="srgb",aw=4,ow="uchar",rw=288,iw=!1,lw=!1,cw=!0,dw="{{.assetPrefix}}/assets/tornado-diqu61wg.webp",uw={format:ew,width:tw,height:sw,space:nw,channels:aw,depth:ow,density:rw,isProgressive:iw,hasProfile:lw,hasAlpha:cw,src:dw},mw="webp",hw=96,fw=96,pw="srgb",gw=4,xw="uchar",yw=288,bw=!1,ww=!1,vw=!0,_w="{{.assetPrefix}}/assets/windy-n2v8wtyp.webp",jw={format:mw,width:hw,height:fw,space:pw,channels:gw,depth:xw,density:yw,isProgressive:bw,hasProfile:ww,hasAlpha:vw,src:_w},kw={foggy:{default:jm},cloudy:{default:Rm},"heavy-snow":{default:Gm},"light-snow":{default:oh},sleet:{default:rp},drizzle:{default:$p,night:xh},hazy:{default:Wp,night:Th},"mostly-cloudy":{default:eg,night:Bh},"mostly-sunny":{default:mg,night:Qh},shower:{default:kg,night:mf},sunny:{default:Ig,night:kf},"rain-thunder":{default:If},rain:{default:Zf},snow:{default:yp},thunder:{default:Zg},tornado:{default:rx},windy:{default:yx}},Cw={foggy:{default:$x},cloudy:{default:Wx},"heavy-snow":{default:e1},"light-snow":{default:m1},sleet:{default:my},drizzle:{default:Iy,night:k1},hazy:{default:Zy,night:I1},"mostly-cloudy":{default:rb,night:Z1},"mostly-sunny":{default:yb,night:r0},shower:{default:$b,night:y0},sunny:{default:Bb,night:$0},"rain-thunder":{default:W0},rain:{default:ey},snow:{default:ky},thunder:{default:Qb},tornado:{default:uw},windy:{default:jw}};function Sw({weatherCode:e,isDarkMode:t,isNight:n}){const a=t?Cw:kw,o=Mw(e),r=a[o];return r.night&&n?r.night:r.default}function Mw(e){switch(e){case 1:case 33:return"sunny";case 2:case 3:case 34:case 35:case 36:return"mostly-sunny";case 4:case 6:case 13:case 14:case 38:return"mostly-cloudy";case 5:case 37:return"hazy";case 7:case 8:return"cloudy";case 11:return"foggy";case 12:case 39:case 40:return"shower";case 15:case 16:case 17:case 41:case 42:return"thunder";case 18:return"rain";case 19:case 20:case 21:case 43:return"light-snow";case 22:case 23:case 44:return"snow";case 24:case 25:case 26:case 29:return"sleet";case 32:return"windy";default:return"cloudy"}}const Nw="C";function Tw(e,t){return Math.round(e==="F"?t*9/5+32:(t-32)*5/9)}function cn(e,t,n=Nw){return e===n?`${Math.round(t)}°`:`${Tw(e,t)}°`}const $w=7,dn=8,Ew=h.memo(function({weatherResults:t,dateRange:n,turnIndex:a,trackContentReferenceEvent:o}){const[r,i]=Ww(),l=Aw(t);h.useEffect(()=>{o("Search Content Reference Shown","search_content_reference_shown","forecast")},[o]);const{daily:d,hourly:c,historical:u}=t;let m="daily";if(n||c&&d.length<2)m="hourly";else if(d.length>0)m="daily";else if(u&&u?.length>0)m="historical";else return null;return s.jsxs("div",{className:"relative","data-testid":"weather-widget",children:[l?s.jsxs(s.Fragment,{children:[s.jsx(Lw,{weatherResults:t}),s.jsx(Rw,{weatherResults:t,temperatureUnit:r,setTemperatureUnit:i})]}):s.jsx("div",{className:"bg-token-main-surface-primary absolute end-0 top-3 z-10 rounded-sm",children:s.jsx(wa,{onTemperatureUnitChange:i,temperatureUnit:r})}),s.jsx(Ow,{turnIndex:a}),m==="hourly"&&s.jsx(Iw,{weatherResults:t,temperatureUnit:r,dateRange:n}),m==="daily"&&s.jsx(Dw,{dailyForecast:d.slice(0,$w),temperatureUnit:r}),m==="historical"&&s.jsx(Fw,{historical:u,temperatureUnit:r})]})});function Pw({weatherAlert:e}){const[t,n]=h.useState(!1),a=P(),o=Bn(),r=le(e.start_timestamp,e.utc_offset_sec),i=e.end_timestamp?le(e.end_timestamp,e.utc_offset_sec):null,l=s.jsxs(s.Fragment,{children:[s.jsx("div",{children:s.jsx(T,{id:"JnuGPS",defaultMessage:"{start}{separator}{end}",values:{start:a.formatDate(r,{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"numeric"}),separator:i?" - ":"",end:i?a.formatDate(i,{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"numeric"}):""}})}),s.jsx("div",{children:e.summary})]});return s.jsxs("button",{className:"my-2 flex w-full flex-col gap-2 rounded-xl border border-red-200 bg-red-100 px-4 py-3 text-start text-sm text-red-800",onClick:()=>n(!t),children:[s.jsxs("div",{className:"flex w-full items-center gap-4",children:[s.jsx(ni,{className:"h-9 w-9 shrink-0"}),s.jsxs("div",{className:"flex flex-col",children:[s.jsx("div",{className:"font-bold",children:s.jsx(T,{id:"y+fy/l",defaultMessage:"Severe Weather: {name}",values:{name:e.name}})}),o&&l]}),s.jsx("div",{className:"grow"}),s.jsx("div",{className:"opacity-30",children:t?s.jsx(ol,{className:"icon-lg"}):s.jsx(al,{className:"icon-lg"})})]}),t&&e.details&&s.jsxs(s.Fragment,{children:[!o&&l,s.jsx("div",{className:"mt-1 whitespace-pre-wrap",children:e.details.trim()})]})]})}function Lw({weatherResults:e}){const{severe:t}=e;return t?s.jsx("div",{className:"my-2",children:t.map((n,a)=>s.jsx(Pw,{weatherAlert:n},a))}):null}function Aw(e){const{historical:t,daily:n,hourly:a,current:o}=e;if(!o)return!1;let r=!1;const i=le(o.timestamp,o.utc_offset_sec);for(const l of[t,n,a])l&&(r=r||l?.some(d=>ti(i,le(d.timestamp,d.utc_offset_sec))));return r}function Rw({weatherResults:e,temperatureUnit:t,setTemperatureUnit:n}){const a=P(),{current:o}=e;if(!o)return null;const r=o.temperature.current,i=o.description,l=r!=null&&i&&" · ";return s.jsxs("div",{className:"not-prose flex items-center gap-4",children:[s.jsxs("div",{className:"grow",children:[s.jsxs("div",{className:"text-lg font-semibold",children:[r!=null&&s.jsx(T,{id:"FiwByI",defaultMessage:"Currently {temperature}",values:{temperature:je(a,r,t)}}),l,i.description]}),s.jsx("div",{className:"text-token-text-secondary",children:Bw(e.location)})]}),s.jsxs("div",{className:"flex",children:[s.jsx(wa,{onTemperatureUnitChange:n,temperatureUnit:t}),s.jsx(is,{weatherDescriptionData:i,isNight:o.night})]})]})}function rs({children:e}){return s.jsx("div",{className:"no-scrollbar not-prose mt-1 overflow-auto sm:overflow-hidden",children:s.jsx(V.Root,{className:"min-w-0",children:s.jsx(V.Body,{className:"border-token-border-medium border-b-[0.5px] [&_tr:last-child]:border-b-0",children:e})})})}function Iw({weatherResults:e,temperatureUnit:t,dateRange:n}){const a=P(),{hourly:o,current:r}=e;let i=o??[];n&&(i=i.filter(u=>u.timestamp>=n.start_timestamp&&u.timestamp<n.end_timestamp));const[l,d]=h.useState(!1),c=i.length>dn;if(!l&&c){const u=i[0],m=le(u.timestamp,u.utc_offset_sec);let b=!1;if(r){const w=le(r.timestamp,r.utc_offset_sec);m.getTime()-w.getTime()>8*60*60*1e3&&i.length>18&&(i=i.slice(7,18),b=!0)}b||(i=i.slice(0,dn))}return s.jsxs(rs,{children:[i.map((u,m)=>s.jsxs(V.Row,{children:[s.jsxs(Q,{className:"w-44",children:[s.jsx(is,{weatherDescriptionData:u.description,isNight:u.night,size:"small"}),s.jsx("div",{className:"ms-3 whitespace-nowrap",children:s.jsx("span",{className:"lowercase",children:zw(a,u)})})]}),s.jsx(Q,{className:"w-[60px] tabular-nums",children:s.jsx("div",{children:je(a,u.temperature.current,t)})}),s.jsx(Q,{children:u.description.description})]},m)),c&&s.jsx(V.Row,{children:s.jsx(Q,{className:"w-44",children:s.jsx(ee,{color:"secondary",onClick:()=>d(!l),size:"small",children:l?s.jsx(T,{id:"KoC8Ym",defaultMessage:"Show less"}):s.jsx(T,{id:"X8F8Y/",defaultMessage:"Show more"})})})})]})}function Dw({dailyForecast:e,temperatureUnit:t}){const n=P();return s.jsx(rs,{children:e.map((a,o)=>s.jsxs(V.Row,{children:[s.jsxs(Q,{className:"w-[7.5rem] min-w-[7.5rem]",children:[s.jsx(is,{weatherDescriptionData:a.description,isNight:a.night,size:"small"}),s.jsx("div",{className:"ms-3 whitespace-nowrap",children:Rt(n,le(a.timestamp,a.utc_offset_sec))})]}),s.jsxs(Q,{className:"tabular-nums",children:[s.jsx("div",{children:je(n,a.temperature.max,t)}),s.jsx("div",{className:"text-token-text-secondary ms-1",children:je(n,a.temperature.min,t)})]}),s.jsx(Q,{className:"min-w-80",children:a.description.description})]},o))})}function Fw({historical:e,temperatureUnit:t}){const n=P();return e?s.jsx(rs,{children:e.map((a,o)=>{const r=le(a.timestamp,a.utc_offset_sec);return s.jsxs(V.Row,{children:[s.jsx(Q,{className:"w-[250px]",children:s.jsx("div",{className:"ms-3 whitespace-nowrap",children:n.formatDate(r,{weekday:"long",month:"short",day:"numeric"})})}),s.jsx(Q,{className:"tabular-nums",children:a.temperature.max&&a.temperature.min?s.jsxs(s.Fragment,{children:[s.jsx("div",{children:je(n,a.temperature.max,t)}),s.jsx("div",{className:"text-token-text-secondary ms-1",children:je(n,a.temperature.min,t)})]}):s.jsx("div",{children:je(n,a.temperature.current,t)})}),s.jsx(Q,{})]},o)})}):null}function Q({className:e,children:t}){return s.jsx(V.Cell,{className:S("border-token-border-xlight! border-s-0! border-e-0! py-2! ps-4! pe-3! first:ps-0! last:pe-0!",e),divClassName:"items-start leading-relaxed",children:t})}function Ow({turnIndex:e}){const t=zi(a=>a.thread?.turns[e]?.use_location),[n]=Bi();return!n.useLocation&&t?s.jsx("div",{className:"mt-3",children:s.jsx(ee,{color:"secondary",icon:qo,onClick:()=>{Ri.setSettingsModalOpen(!0)},children:s.jsx(T,{id:"f47VEc",defaultMessage:"Share precise location"})})}):null}function wa({temperatureUnit:e,onTemperatureUnitChange:t}){const n=a=>e===a?"font-bold":"font-light";return s.jsx(si,{size:"small",triggerButton:s.jsx("button",{className:"text-token-text-tertiary hover:text-token-text-primary flex items-center justify-center p-1.5",children:s.jsx(Vo,{className:"icon-sm"})}),children:s.jsxs(xe.Item,{onClick:()=>{t(e==="C"?"F":"C")},className:"text-token-text-primary",children:[s.jsx(T,{id:"bQIoe/",defaultMessage:"Temperature"}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:n("F"),children:s.jsx(T,{id:"bvDeBB",defaultMessage:"°F"})}),s.jsx("div",{className:"mx-1 h-4 border-s border-gray-300"}),s.jsx("div",{className:n("C"),children:s.jsx(T,{id:"iNiz6O",defaultMessage:"°C"})})]})]})})}function is({weatherDescriptionData:e,isNight:t=!1,size:n="normal"}){const a=Ke(),o=n==="small"?30:50;return s.jsx("img",{draggable:!1,alt:e.description,src:Sw({weatherCode:e.id,isDarkMode:a,isNight:t}).src,width:o,height:o})}function zw(e,t){const n=le(t.timestamp,t.utc_offset_sec);return e.formatDate(n,{hour:"numeric"})}function je(e,t,n){return t==null?"-":cn(n?n??"F":va(e),t)}function va(e){const t=["en-US","en-BZ","en-BS","en-KY","en-PW"],n=e.locale||"en-US";return t.includes(n)?"F":"C"}function Bw(e){const t=e.name.split(",").map(n=>n.trim());return e.country&&!t.includes(e.country)&&t.push(e.country),t.join(", ")}const Ww=()=>{const e=P(),[t,n]=ei("USER_TEMPERATURE_UNIT",va(e),a=>["F","C"].includes(a));return[t,n]};function un({contentReference:e,clientThreadId:t,messageId:n,trackContentReferenceEvent:a,contentReferenceIndex:o}){const r=Cn(),i=r?"sidebar":"primary",l="metadata"in e&&e.metadata?.location?String(e.metadata.location):void 0,d=h.useMemo(()=>({content_reference_start_index:e.start_idx,entity_name:e.name,category:e.category,conversation_type:i,contentReferenceIndex:o,metadata_location:l}),[e.start_idx,e.name,e.category,i,o,l]);h.useEffect(()=>{a("Entity Anchor Content Reference Shown","entity_anchor_content_reference_shown","entity",d)},[a,d]);const{openThreadSidebar:c}=Xe(),{resetSidebarHistory:u}=kn();return s.jsx("span",{className:"hover:entity-accent entity-underline inline cursor-pointer align-baseline",onClick:m=>{m.preventDefault(),a("Entity Anchor Content Reference Clicked","entity_anchor_content_reference_clicked","entity",d),t&&(r||u(),c({type:"entity",clientThreadId:t,debugThreadId:void 0,messageId:n,contentReferenceStartIndex:e.start_idx,query:e.name,category:e.category??void 0}))},children:s.jsx("span",{className:"whitespace-normal",children:e.name})})}const Hw=Ln(()=>Jt(()=>import("./c18xhpsreatdvyxf.js"),__vite__mapDeps([12,1,2,3,4,5,13,14,15,16,17,18,19,20,21,22,23,24,25,7,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53])).then(e=>e.BusinessesMap));function Uw(e){"use forget";const t=Ve.c(151),{index:n,FormattedText:a,node:o,wordFadeType:r}=e,i=parseInt(n,10),l=h.useContext(ie),d=B();ai(l?.clientThreadId??ss);const c=Nn(l?.analyticsMetadata),u=h.useRef(!1);if(l==null)return null;const{contentReferences:m,onShowSearchResults:b,numImageResults:w,analyticsMetadata:x,message:j,superWidgetImages:_}=l,f=m?.[i];if(!f||x.turnIndex===void 0||f.type===void 0)return null;let k;t[0]===Symbol.for("react.memo_cache_sentinel")?(k={img:qw},t[0]=k):k=t[0];let v;t[1]!==f.alt?(v=s.jsx(Yt,{components:k,children:f.alt}),t[1]=f.alt,t[2]=v):v=t[2];const p=v;let y=null;e:switch(f.type){case"title_citation":{let g;t[3]!==f||t[4]!==c?(g=s.jsx(nm,{metadata:f,trackContentReferenceEvent:c}),t[3]=f,t[4]=c,t[5]=g):g=t[5],y=g;break e}case"location_search":{let g;t[6]!==f||t[7]!==c?(g=s.jsx(Vu,{metadata:f,trackContentReferenceEvent:c}),t[6]=f,t[7]=c,t[8]=g):g=t[8],y=g;break e}case"time":{let g;t[9]!==f||t[10]!==c?(g=s.jsx(sm,{metadata:f,trackContentReferenceEvent:c}),t[9]=f,t[10]=c,t[11]=g):g=t[11],y=g;break e}case"image_v2":{const g=w??0;let N;t[12]!==x||t[13]!==f||t[14]!==c||t[15]!==_||t[16]!==g?(N=s.jsx(as,{metadata:f,numImageResults:g,analyticsMetadata:x,trackContentReferenceEvent:c,superWidgetImages:_}),t[12]=x,t[13]=f,t[14]=c,t[15]=_,t[16]=g,t[17]=N):N=t[17],y=N;break e}case"nav_list":{let g;t[18]!==f||t[19]!==c?(g=s.jsx(qu,{metadata:f,trackContentReferenceEvent:c}),t[18]=f,t[19]=c,t[20]=g):g=t[20],y=g;break e}case"file_navlist":{let g;t[21]!==f||t[22]!==c?(g=s.jsx(Su,{metadata:f,trackContentReferenceEvent:c}),t[21]=f,t[22]=c,t[23]=g):g=t[23],y=g;break e}case"file":{{let g;t[29]!==f||t[30]!==c||t[31]!==i?(g=s.jsx(_u,{fileRef:f,index:i,trackContentReferenceEvent:c}),t[29]=f,t[30]=c,t[31]=i,t[32]=g):g=t[32],y=g}break e}case"grouped_webpages_model_predicted_fallback":{let g;t[33]!==f||t[34]!==l.message.id||t[35]!==c||t[36]!==i||t[37]!==o?(g=s.jsx(Zo,{webpageRef:f,node:o,trackContentReferenceEvent:c,messageId:l.message.id,index:i}),t[33]=f,t[34]=l.message.id,t[35]=c,t[36]=i,t[37]=o,t[38]=g):g=t[38],y=g;break e}case"grouped_webpages":{let g;t[39]!==f||t[40]!==l.message.id||t[41]!==c||t[42]!==i||t[43]!==o?(g=s.jsx(Go,{webpageRef:f,node:o,trackContentReferenceEvent:c,messageId:l.message.id,index:i}),t[39]=f,t[40]=l.message.id,t[41]=c,t[42]=i,t[43]=o,t[44]=g):g=t[44],y=g;break e}case"tldr":break e;case"navigation":{let g;t[45]!==f||t[46]!==c||t[47]!==b?(g=s.jsx(Ko,{navigation:f,onShowSearchResults:b,trackContentReferenceEvent:c}),t[45]=f,t[46]=c,t[47]=b,t[48]=g):g=t[48],y=g;break e}case"stock":{let g;t[49]!==f||t[50]!==c?(g=s.jsx(Bu,{contentReference:f,trackContentReferenceEvent:c}),t[49]=f,t[50]=c,t[51]=g):g=t[51],y=g;break e}case"calculator":{let g;t[52]!==f||t[53]!==c?(g=s.jsx(cu,{data:f,trackContentReferenceEvent:c}),t[52]=f,t[53]=c,t[54]=g):g=t[54],y=g;break e}case"python":case"container":{let g;t[55]!==x.turnIndex||t[56]!==f||t[57]!==l.clientThreadId?(g=s.jsx(fu,{clientThreadId:l.clientThreadId,turnIndex:x.turnIndex,contentReference:f}),t[55]=x.turnIndex,t[56]=f,t[57]=l.clientThreadId,t[58]=g):g=t[58],y=g;break e}case"code_execution":{let g;t[59]!==a||t[60]!==f||t[61]!==c?(g=s.jsx(mu,{FormattedText:a,displayInfo:f,trackContentReferenceEvent:c}),t[59]=a,t[60]=f,t[61]=c,t[62]=g):g=t[62],y=g;break e}case"forecast":{let g;t[63]!==x||t[64]!==f.date_range||t[65]!==f.forecast||t[66]!==c?(g=f?.forecast&&s.jsx(Ew,{weatherResults:f.forecast,dateRange:f.date_range,turnIndex:x.turnIndex,trackContentReferenceEvent:c}),t[63]=x,t[64]=f.date_range,t[65]=f.forecast,t[66]=c,t[67]=g):g=t[67],y=g;break e}case"businesses_map":{let g;t[68]!==f||t[69]!==c?(g=s.jsx(Hw,{contentReference:f,trackContentReferenceEvent:c}),t[68]=f,t[69]=c,t[70]=g):g=t[70],y=g;break e}case"map":{let g;t[71]!==f||t[72]!==l.clientThreadId||t[73]!==l.message.id||t[74]!==c?(g=s.jsx(Hd,{contentReference:f,trackContentReferenceEvent:c,clientThreadId:l.clientThreadId,messageId:l.message.id}),t[71]=f,t[72]=l.clientThreadId,t[73]=l.message.id,t[74]=c,t[75]=g):g=t[75],y=g;break e}case"video":{let g;t[76]!==f||t[77]!==c?(g=s.jsx(um,{video:f,trackContentReferenceEvent:c}),t[76]=f,t[77]=c,t[78]=g):g=t[78],y=g;break e}case"sports_standings":{let g;t[79]!==f||t[80]!==c?(g=s.jsx(em,{standingsRef:f,trackContentReferenceEvent:c}),t[79]=f,t[80]=c,t[81]=g):g=t[81],y=g;break e}case"sports_schedule":{let g;t[82]!==f||t[83]!==c?(g=s.jsx(Xu,{scheduleRef:f,trackContentReferenceEvent:c}),t[82]=f,t[83]=c,t[84]=g):g=t[84],y=g;break e}case"attribution":{let g;t[85]!==f||t[86]!==r?(g=s.jsx(au,{attribution:f,wordFadeType:r}),t[85]=f,t[86]=r,t[87]=g):g=t[87],y=g;break e}case"debug":{let g;t[88]!==f?(g=Object.entries(f).map(Vw),t[88]=f,t[89]=g):g=t[89];let N;t[90]!==g?(N=s.jsx(s.Fragment,{children:g}),t[90]=g,t[91]=N):N=t[91],y=N;break e}case"image_inline":{let g;t[92]!==f||t[93]!==l.clientThreadId||t[94]!==c||t[95]!==j?(g=j.metadata?.b1de6e2_rm?s.jsx($c,{reference:f,clientThreadId:l.clientThreadId,trackContentReferenceEvent:c,message:j}):s.jsx(Pc,{reference:f,clientThreadId:l.clientThreadId,trackContentReferenceEvent:c,message:j}),t[92]=f,t[93]=l.clientThreadId,t[94]=c,t[95]=j,t[96]=g):g=t[96],y=g;break e}case"image_group":{let g;t[97]!==x||t[98]!==f||t[99]!==c?(g=s.jsx(uc,{contentReference:f,trackContentReferenceEvent:c,analyticsMetadata:x}),t[97]=x,t[98]=f,t[99]=c,t[100]=g):g=t[100],y=g;break e}case"product_entity":{if(F(d,"1225428216")){let N;t[101]!==f?(N={...f,type:"entity",name:f.product.title,category:"product"},t[101]=f,t[102]=N):N=t[102];let $;t[103]!==x.turnIndex||t[104]!==l.clientThreadId||t[105]!==l.message.id||t[106]!==c||t[107]!==i||t[108]!==N?($=s.jsx(un,{contentReference:N,clientThreadId:l.clientThreadId,messageId:l.message.id,turnIndex:x.turnIndex,trackContentReferenceEvent:c,contentReferenceIndex:i}),t[103]=x.turnIndex,t[104]=l.clientThreadId,t[105]=l.message.id,t[106]=c,t[107]=i,t[108]=N,t[109]=$):$=t[109],y=$}else{let N;t[110]!==x.turnIndex||t[111]!==f||t[112]!==l.clientThreadId||t[113]!==l.message.id||t[114]!==c?(N=s.jsx(Xd,{contentReference:f,clientThreadId:l.clientThreadId,messageId:l.message.id,turnIndex:x.turnIndex,trackContentReferenceEvent:c}),t[110]=x.turnIndex,t[111]=f,t[112]=l.clientThreadId,t[113]=l.message.id,t[114]=c,t[115]=N):N=t[115],y=N}break e}case"entity_metadata":{let g;t[116]!==f||t[117]!==l.clientThreadId||t[118]!==l.message.id||t[119]!==c?(g=s.jsx(wu,{contentReference:f,clientThreadId:l.clientThreadId,messageId:l.message.id,trackContentReferenceEvent:c}),t[116]=f,t[117]=l.clientThreadId,t[118]=l.message.id,t[119]=c,t[120]=g):g=t[120],y=g;break e}case"checkout_confirmation":{let g;t[121]!==f||t[122]!==c?(g=null,t[121]=f,t[122]=c,t[123]=g):g=t[123],y=g;break e}case"entity":{let g;t[124]!==x.turnIndex||t[125]!==f||t[126]!==l.clientThreadId||t[127]!==l.message.id||t[128]!==c||t[129]!==i?(g=s.jsx(un,{contentReference:f,clientThreadId:l.clientThreadId,messageId:l.message.id,turnIndex:x.turnIndex,trackContentReferenceEvent:c,contentReferenceIndex:i}),t[124]=x.turnIndex,t[125]=f,t[126]=l.clientThreadId,t[127]=l.message.id,t[128]=c,t[129]=i,t[130]=g):g=t[130],y=g;break e}case"products":{let g;t[131]!==x||t[132]!==f||t[133]!==l.clientThreadId||t[134]!==l.message.id?(g=s.jsx(Qd,{contentReference:f,clientThreadId:l.clientThreadId,messageId:l.message.id,turnIndex:x.turnIndex,analyticsMetadata:x}),t[131]=x,t[132]=f,t[133]=l.clientThreadId,t[134]=l.message.id,t[135]=g):g=t[135],y=g;break e}case"product_reviews":{let g;t[136]!==f||t[137]!==c?(g=s.jsx(Xo,{contentReference:f,disableAnimation:!0,trackContentReferenceEvent:c}),t[136]=f,t[137]=c,t[138]=g):g=t[138],y=g;break e}case"product_rationale":{let g;t[139]!==f||t[140]!==c?(g=s.jsx(Yo,{contentReference:f,trackContentReferenceEvent:c,disableAnimation:!0}),t[139]=f,t[140]=c,t[141]=g):g=t[141],y=g;break e}case"sources_footnote":return null}"dil"in f&&f.dil&&F(d,"846037718");let C;t[144]!==p||t[145]!==f||t[146]!==c?(C=g=>(u.current||(c("Search Content Reference Failed","search_content_reference_failed",f.type),Le.addError(`Error rendering content reference: ${f.type}`,{...g,contentReference:f}),u.current=!0),f?.alt?p:s.jsx("span",{className:`errored-object-${f.type}`})),t[144]=p,t[145]=f,t[146]=c,t[147]=C):C=t[147];let M;return t[148]!==y||t[149]!==C?(M=s.jsx(Wn,{name:"content-reference-renderer",fallback:C,children:y}),t[148]=y,t[149]=C,t[150]=M):M=t[150],M}function Vw(e){const[t,n]=e;return s.jsx("sub",{className:"ms-1 w-fit rounded-md border-2 border-solid border-orange-500 px-1 leading-none",children:n},t)}function qw(e){const{src:t,alt:n}=e;return s.jsx("img",{src:t,alt:n,className:"max-h-28"})}const Gw=({onClick:e})=>{const[t,n]=h.useState(!1),a=Jo(),o=P(),r=d=>{e(d),n(!0),setTimeout(()=>{a()&&n(!1)},2e3)},i=t?Gt:jn,l=o.formatMessage({id:"uG/ayY",defaultMessage:"Copy table"});return s.jsx(Z,{label:l,side:"bottom",align:"center",alignOffset:0,children:s.jsx("button",{"aria-label":l,onClick:r,className:"hover:bg-token-bg-tertiary text-token-text-secondary my-1 rounded-sm p-1 transition-opacity group-[:not(:hover):not(:focus-within)]:pointer-events-none group-[:not(:hover):not(:focus-within)]:opacity-0",children:s.jsx(i,{className:"icon"})})})},Zw=({onClickCopy:e,children:t,...n})=>{const a=B(),o=h.useRef(null),r=h.useRef(null),l=oi(a)&&On(a);return ri(()=>{Qo({axis:"height",target:o.current?.firstElementChild,onChange:({height:d})=>{r.current&&(r.current.style.height=`${d}px`)}})},[]),s.jsx("div",{className:S(l?"-mx-6":ps.tableContainer),children:s.jsxs("div",{tabIndex:-1,className:S("group",l?"flex w-full max-w-full overflow-x-auto overscroll-x-contain px-6":S(ps.tableWrapper,"flex w-fit flex-col-reverse")),children:[s.jsx("table",{...n,className:S(l?"w-full":"w-fit min-w-(--thread-content-width)"),ref:o,children:t}),s.jsx("div",{className:S("sticky h-0 select-none",l?"end-0 self-start":"end-(--thread-content-margin) self-end"),children:s.jsx("div",{className:"absolute end-0 flex items-end",ref:r,children:s.jsx(Gw,{onClick:e})})})]})})},Yw=({node:e,children:t,...n})=>s.jsx("td",{...n,children:h.Children.map(t,(a,o)=>a==="<br>"?s.jsx("br",{},o):a)});function Xw(e){const{src:t,clientThreadId:n,...a}=e,o=Ze(n),r=h.useContext(ie),i=ar(o,t,r?.useSafeUrls);return i==null?s.jsx("div",{}):s.jsx("img",{...a,src:i})}function Kw(e){return s.jsx(Uw,{...e,FormattedText:_a})}function _a({size:e="medium",children:t,className:n,clientThreadId:a,messageId:o,isActivelyStreaming:r=!1,componentOverrides:i,isDeepResearchResultMessage:l,forceDarkMode:d,disableWordFade:c}){const u=Ke()||d,{wordFadeType:m}=er(),b=tr(),w=h.useMemo(()=>({[ci]:p=>{const y=Zl(p.variant);return s.jsx(oc,{clientThreadId:a,messageId:o,title:p.title,originalContent:p.content,variant:y,recipient:p.recipient,isStreaming:r,index:p.index,children:p.children})},pre:({children:p,"data-start":y,"data-end":C,"data-is-last-node":M})=>s.jsx("pre",{className:"overflow-visible!","data-start":y,"data-end":C,"data-is-last-node":M,children:p}),code:p=>s.jsx(nr,{...p,clientThreadId:a}),[li]:p=>s.jsx(Kw,{wordFadeType:m,...p}),[sr]:p=>a==null?null:s.jsx(Ll,{...p,clientThreadId:a,messageId:o}),[Ai]:Li,[_i]:Al,[vi]:Vl,[wi]:Hl,[bi]:Fl,a:p=>{const{node:y,children:C,...M}=p,g=y?.properties?.href;if(typeof g=="string"&&g.startsWith(cs))return a!=null&&o!=null?s.jsx(Pa,{...M,clientThreadId:a,messageId:o,href:g,children:C}):null;if(typeof g=="string"&&g===La){const N=y?.children?.map($=>typeof $.value=="string"?$.value:"").join("").trim();return s.jsx(Aa,{...p,text:N,clientThreadId:a,messageId:o,className:"cursor-pointer"})}if(typeof g=="string"&&g===Ra){const N=y?.children?.map($=>typeof $.value=="string"?$.value:"").join("").trim();return s.jsx(Ia,{...p,text:N,clientThreadId:a,messageId:o})}if(typeof g=="string"&&g===Da){const N=y?.children?.map($=>typeof $.value=="string"?$.value:"").join("").trim();return s.jsx(Fa,{...p,text:N,clientThreadId:a,messageId:o})}return g&&typeof g=="string"&&rc(g)?C:s.jsx(rl,{...p,clientThreadId:a,messageId:o})},table:({node:p,...y})=>s.jsx(Zw,{...y,onClickCopy:C=>{be.logEvent("ChatGPT Table Copy Clicked");const M=a!=null&&o!=null?We.getNode(ii(a),o).message:void 0;Wt(pn(p.markdownSource,M?.metadata?.content_references),void 0,C)}}),td:Yw,...b?{h1:({node:p,...y})=>s.jsx("h1",{"data-section-id":et(p.markdownSource),...y}),h2:({node:p,...y})=>s.jsx("h2",{"data-section-id":et(p.markdownSource),...y}),h3:({node:p,...y})=>s.jsx("h3",{"data-section-id":et(p.markdownSource),...y}),li:({node:p,...y})=>s.jsx("li",{"data-section-id":et(p.markdownSource),...y})}:{},img:({node:p,...y})=>{const C=p?.properties?.src;return typeof C=="string"&&(C.startsWith(cs)||C.startsWith("attachment:"))?null:s.jsx(Xw,{...y,clientThreadId:a})},...m==="delay"?il:[],...i}),[b,m,i,a,o,r]),x=B(),j=F(x,"1839283687"),_=h.useMemo(()=>r&&t?ll(t):t??"",[t,r]),f=Tn(),k=h.useMemo(()=>[...yn,[Oa,_]],[_]),v=h.useMemo(()=>m==="indexed"&&!c?{handlers:{text:(p,y,C)=>{const M=[];for(const g of f(y.value))M.push({type:"element",tagName:"span",properties:{className:$n.fadeIn},children:[{type:"text",value:g}]});return M}}}:void 0,[m,f,c]);return j?!1:s.jsx(Wn,{name:"formatted_text_error",fallback:()=>s.jsx(s.Fragment,{children:_}),children:s.jsx(ja,{rehypePlugins:k,remarkPlugins:xn,remarkRehypeOptions:v,className:S(n,"markdown prose dark:prose-invert w-full break-words",u?"dark":"light",e==="small"&&"prose-xs",l&&"deep-research-result","markdown-new-styling"),urlTransform:gn,components:w,children:_})})}const ja=h.memo(Yt),Av=Object.freeze(Object.defineProperty({__proto__:null,FormattedText:_a,ReactMarkdownMemo:ja},Symbol.toStringTag,{value:"Module"}));export{Av as F,Dd as M,it as W,Od as a,Fd as b,cd as c,rd as f,ia as p,me as r,id as t};
//# sourceMappingURL=dhcw2yihh5mkkewd.js.map
