import{r as u,f as C,j as e,i as w,M as x}from"./m60bpb0x3x7rg8fj.js";import{ab as k,z as P,o7 as N,bc as A,C as T,R as v,B as b}from"./lgw4q0e8zlqqfgug.js";import{cV as R}from"./ggjzadbnd3k1vu0k.js";import{JsonViewer as F}from"./mdsdqbg7dtklqnuw.js";import{T as D,a as U,b as W}from"./gjtxw5aaotq3dyvk.js";import{p as B,W as H,a as E,C as z,M as V}from"./d6raol4cdcsdp19u.js";import{W as j}from"./cb9cgv53vja8utnc.js";import{g as q,W as G,u as J}from"./g7o69yifmkuxfsll.js";import"./kj109at7ry8iempm.js";import"./jtj7tm19s85de1gz.js";import"./o7wniqoxhh56wvjg.js";import"./czj65b9i5sztgpdb.js";import"./n26tu9wxezmtzr3d.js";import"./dmk30rbb7u1k7gl7.js";import"./795byvwofdax2f6d.js";import"./m3hp25w3mcid81ib.js";import"./jii3s2n86nvi5fnj.js";import"./dp7t1jmnbbend843.js";import"./ngdk8aaa28n1ff0n.js";import"./nyb6qzfj9cwbbq9m.js";import"./ijm2v97qh75qdidh.js";import"./hvkmppraevglbeo3.js";import"./kfjcy5y4cxuymbdf.js";import"./lf8mxjdfum7t34gh.js";import"./m9elivgqkyz3hcka.js";const M=new Set;function ve({taskId:a,suggestion:o,index:l,assistantTurn:t,isOpen:i,onClose:r}){const d=u.useMemo(()=>q(t,!0).length>0,[t]),f=u.useMemo(()=>B({assistantTurn:t,followUp:d}),[t,d]),c=!d,s=C(),m=k(),[L,y]=u.useState("diff"),S="diff";u.useEffect(()=>{const n=t.id;i&&n&&!M.has(n)&&(M.add(n),G.viewSpeculativeTurn(a,n))},[i,t.id,a]);const h=e.jsx(K,{taskId:a,suggestion:o,index:l,assistantTurn:t,showFullDiff:c}),_=e.jsx("div",{className:"relative flex h-full w-full flex-col",children:e.jsxs(D,{onChange:y,currentTab:L,defaultTab:S,tabs:[{key:"chat",isHidden:m,label:s.formatMessage({id:"wham.whamTaskPageContentLoaded.conversation",defaultMessage:"Conversation"}),ariaLabel:s.formatMessage({id:"wham.whamTaskPageContentLoaded.conversationAriaLabel",defaultMessage:"Tab to view the conversation with the assistant"}),children:h},{key:"diff",isHidden:!1,label:s.formatMessage({id:"wham.whamTaskPageContentLoaded.diff",defaultMessage:"Diff"}),ariaLabel:s.formatMessage({id:"wham.whamTaskPageContentLoaded.diffAriaLabel",defaultMessage:"Tab to view the code diff"}),children:e.jsx($,{taskId:a,assistantTurn:t,index:l,diffFiles:f})},{key:"logs",label:s.formatMessage({id:"wham.whamTaskPageContentLoaded.logs",defaultMessage:"Logs"}),ariaLabel:s.formatMessage({id:"wham.whamTaskPageContentLoaded.logsAriaLabel",defaultMessage:"Tab to view the work logs"}),children:e.jsx(u.Suspense,{fallback:e.jsx("div",{className:"flex h-full w-full items-center justify-center py-8",children:e.jsx(N,{})}),children:e.jsx(H,{taskId:a,focusedAssistantTurn:t,agentNetworkAccess:t?.environment?.agent_network_access,footer:e.jsx("div",{className:"block md:hidden",children:e.jsx(p,{taskId:a,assistantTurn:t,index:l})})})})},{key:"internal_rollout",isHidden:t?.internal_only_rollouts==null||!0,label:s.formatMessage({id:"wham.whamTaskPageContentLoaded.internalRollout",defaultMessage:"Internal Rollout"}),ariaLabel:s.formatMessage({id:"wham.whamTaskPageContentLoaded.internalRolloutAriaLabel",defaultMessage:"Tab to view the internal rollout information"}),children:e.jsx("div",{className:"flex h-full w-full overflow-auto p-4",children:e.jsx(F,{json:t?.internal_only_rollouts??void 0,jsonViewProps:{collapsed:5}})})}],children:[e.jsx(U,{withUnderline:!m,className:P("p-3 max-md:py-0",!m&&"border-b"),skipTabUnderlineAnimation:!0}),e.jsx(W,{children:({content:n})=>e.jsx("div",{className:"flex h-full w-full",children:n})})]},t?.id??a)}),g=e.jsxs("div",{className:"relative flex h-full w-full flex-col",children:[_,e.jsx(R,{className:"absolute end-3 top-0 md:top-3",icon:e.jsx(A,{}),label:s.formatMessage({id:"wham.whamTaskPageContentLoaded.close",defaultMessage:"Close"}),onClick:r})]});return e.jsx(T,{testId:`modal-speculative-task-content-${t.id}`,isOpen:i,visuallyHiddenHeader:!0,size:"custom",className:"h-full w-full",contentClassName:"h-screen",noPadding:!0,onClose:r,onEscapeKeyDown:n=>{n.preventDefault(),n.stopPropagation(),r()},showCloseButton:!0,children:e.jsx("div",{className:"bg-token-bg-tertiary flex h-full w-full",children:m?e.jsx(E,{leftContent:h,rightContent:g}):g})})}function K({taskId:a,suggestion:o,index:l,assistantTurn:t,showFullDiff:i}){return e.jsxs("div",{className:"flex h-full w-full flex-col",children:[e.jsx("span",{className:"p-6 text-sm font-medium",children:o.title}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6",children:e.jsx(V,{isLatest:!0,assistantTurns:[t],selectedAssistantId:t.id,focusedAssistantTurn:t,setFocusedAssistantTurnId:()=>{},onClickFile:()=>{},startOpen:!0,currentTab:void 0,onTabChange:()=>{},permissions:"read",flushHeaderSeparator:!0,showFullDiff:i},t.id)}),e.jsx(p,{taskId:a,assistantTurn:t,index:l})]})}function $({taskId:a,assistantTurn:o,index:l,diffFiles:t}){const i=t.length>0,{data:r}=J(),f=!k()||r?.git_diff_mode==="unified";return e.jsxs("div",{className:"flex h-full w-full flex-col",children:[i&&e.jsx("div",{className:"flex w-full flex-1 flex-col gap-6 overflow-y-auto px-6 pb-6",children:t.map(c=>e.jsx(z,{diff:c,stickyHeader:!0,viewType:f?"unified":"split",enableComments:!1,buttonClassName:"bg-token-bg-tertiary"},c.diffFile._newFileName))}),e.jsx("div",{className:"block md:hidden",children:e.jsx(p,{taskId:a,assistantTurn:o,index:l})})]})}function p({taskId:a,assistantTurn:o,index:l}){const t=C(),i=()=>{window.location.reload()},{mutate:r,isPending:d}=w({mutationFn:()=>(j.recordSpeculativeSuggestionRejected(a,o.id,l),v.safePost("/wham/tasks/{task_id}/speculative_turns/{task_turn_id}/reject",{parameters:{path:{task_id:a,task_turn_id:o.id}}})),onSuccess:i}),{mutate:f,isPending:c}=w({mutationFn:()=>(j.recordSpeculativeSuggestionAccepted(a,o.id,l),v.safePost("/wham/tasks/{task_id}/speculative_turns/{task_turn_id}/accept",{parameters:{path:{task_id:a,task_turn_id:o.id}}})),onSuccess:i}),s=d||c;return e.jsxs("div",{className:"flex w-full justify-center gap-3 py-10",children:[e.jsx(b,{color:"primary",onClick:()=>f(),disabled:s,loading:c,"aria-label":t.formatMessage({id:"wham.speculative.followUp.applyAriaLabel",defaultMessage:"Button to apply the speculative follow up suggestion"}),children:e.jsx(x,{id:"wham.speculative.followUp.apply",defaultMessage:"Apply"})}),e.jsx(b,{color:"secondary",onClick:()=>r(),disabled:s,loading:d,"aria-label":t.formatMessage({id:"wham.speculative.followUp.rejectAriaLabel",defaultMessage:"Button to reject the speculative follow up suggestion"}),children:e.jsx(x,{id:"wham.speculative.followUp.reject",defaultMessage:"Reject"})})]})}export{ve as SpeculativeTaskContentModal};
//# sourceMappingURL=hwcyajhg1pvieq51.js.map
