import{f as C,d as B,j as e,r as x,M as y,h as q,i as G}from"./m60bpb0x3x7rg8fj.js";import{pn as Q,pp as Z,z as X,eZ as J,bE as N,b2 as L,am as E,aA as P,lE as M,C as Y,hn as $,py as H,pz as K,jg as V,pA as ee,kO as ae,mc as se,R as te,bc as re,hB as oe,hC as le}from"./lgw4q0e8zlqqfgug.js";import{aX as ce,ej as ne,aN as ie}from"./ggjzadbnd3k1vu0k.js";import{u as de}from"./dgb06x9f8z6d0ar9.js";function pe({onFileChange:s,className:c,message:k,mimeTypes:u}){const g=C(),n=k??g.formatMessage(R.helpText),i=j=>{if(j.length>0){const b=j[0];u&&u.includes(b.type)&&s(b)}},{open:w,getRootProps:h,getInputProps:A,isDragActive:d}=de({disabled:!1,noClick:!0,onDropAccepted:i,onDropRejected:()=>null,multiple:!1,maxSize:Z,...Q(u)});return e.jsxs("div",{className:X("flex flex-col content-center justify-center gap-3 rounded-xl border border-dashed px-6 py-16 text-center",d?"border-green-600 bg-green-600/10":"border-token-border-medium",c),...h(),children:[e.jsx("input",{...A()}),e.jsx("div",{className:"text-center dark:text-white",children:e.jsx("div",{className:"inline-block",children:e.jsx(ce,{})})}),e.jsx("div",{className:"text-center text-sm",children:n}),e.jsx("div",{className:"cursor-pointer text-center text-sm font-bold text-green-600",onClick:()=>{w()},children:g.formatMessage(R.openFilePicker)})]})}const R=B({helpText:{id:"FileUploadBox.helpText",defaultMessage:"Drop file here to upload"},openFilePicker:{id:"FileUploadBox.openFilePicker",defaultMessage:"Browse files"}}),_=192;function ue(s){const c=q(),k=C(),u=L();return G({mutationFn:({name:g,profilePictureId:n,profilePictureUrl:i})=>te.safePatch("/accounts/{account_id}",{parameters:{path:{account_id:s}},requestBody:{name:g,profile_picture_id:n??"",profile_picture_url:i??""}}).catch(w=>{u.danger(k.formatMessage(r.saveError,{error:w.message}),{toastId:"workspace_appearance_modal",loggingTitle:r.saveError.defaultMessage,loggingDescription:"Failed to save workspace appearance"})}),onSuccess:()=>{c.invalidateQueries(se())}})}function he({workspace:s}){const[c,k]=x.useState(s?.name??""),[u,g]=x.useState(!1);!u&&s&&(g(!0),c==""&&k(s?.name??""));const[n,i]=x.useState(s.profilePictureUrl),[w,h]=x.useState(s.profilePictureId),A=J(N.WorkspaceAppearance),d=C(),j=L(),b=()=>P.closeModal(N.WorkspaceAppearance),[t,m]=x.useState(void 0);async function z(o){const v=await K(o,_),W=V(v);m({tempId:W,file:v,status:M.Uploading,progress:1,fileId:null,cdnUrl:null}),ee(W,v,d,j,ae.ProfilePicture,{onFileCreated(f,p,l){m(a=>a!=="initial"&&a?.tempId===f&&a.status===M.Uploading?{...a,progress:10,fileId:p,cdnUrl:l}:a)},onFileUploadProgress(f,p){m(l=>l!=="initial"&&l?.tempId===f&&l.status===M.Uploading?{...l,progress:p}:l)},onFileUploaded(f,p,l){m(a=>a!=="initial"&&a&&a.cdnUrl&&a.tempId===f?(oe(a.fileId).then(S=>{S.status===le.Success&&(h(a.fileId),i(S.download_url))}),{...a,status:M.Ready,progress:100,fileSpec:{name:a.file.name,id:a.fileId,size:a.file.size,...l??{}}}):a)},onError(f){m(p=>{if(p!=="initial"&&p?.tempId===f){h(void 0),i(void 0),U(null);return}return p})}})}const D=ue(s.id),T=e.jsx(E.Button,{color:"primary",disabled:t!=="initial"&&t!==void 0&&t.status!==M.Ready||t!=="initial"&&t!==void 0&&t.status===M.Ready&&!n||D.isPending||c.trim().length===0,onClick:async()=>{D.mutate({name:c,profilePictureId:w,profilePictureUrl:n}),P.closeModal(N.WorkspaceAppearance)},title:d.formatMessage(r.modalSubmit)}),F=e.jsx(E.Button,{onClick:()=>{m(void 0),h(s.profilePictureId),i(s.profilePictureUrl),P.closeModal(N.WorkspaceAppearance)},title:d.formatMessage(r.modalCancel)}),[I,U]=x.useState(null);x.useEffect(()=>{if(t!=="initial"&&t!=null&&I==null){const o=new FileReader;o.addEventListener("load",()=>{const v=o.result;typeof v=="string"&&U(v)}),o.readAsDataURL(t.file)}},[t,I]);const O=()=>{h(null),i(null),m(void 0),U(null)};return e.jsxs(Y,{testId:"modal-workspace-appearance",isOpen:A,onClose:b,showCloseButton:!0,primaryButton:T,secondaryButton:F,type:"danger",title:d.formatMessage(r.modalTitle),children:[e.jsxs("div",{className:"mb-4 flex-wrap",children:[e.jsx("label",{htmlFor:"workspace-name",className:"text-token-text-primary block pb-1 font-semibold",children:e.jsx(y,{...r.workspaceName})}),e.jsx("p",{className:"font-base text-token-text-secondary text-sm",children:e.jsx(y,{...r.workspaceNameDescription})})]}),e.jsx("div",{className:"mb-4",children:e.jsx($,{ariaLabel:!1,type:"text",name:"workspace-name",value:c,onChange:o=>k(o.target.value),maxLength:64})}),e.jsxs("div",{className:"mb-4 flex-wrap",children:[e.jsx("label",{htmlFor:"workspace-avatar",className:"text-token-text-primary block pb-1 font-semibold",children:e.jsx(y,{...r.workspaceAvatar})}),e.jsx("p",{className:"font-base text-token-text-secondary text-sm",children:d.formatMessage(r.workspaceAvatarDescription,{size:_})})]}),e.jsxs("div",{className:"mb-4 flex-wrap text-center",children:[n?e.jsxs("div",{className:"relative mb-3 inline-flex",children:[e.jsx("img",{src:n,alt:"",referrerPolicy:"no-referrer",className:"block h-24 w-24 rounded-full object-cover object-center"}),e.jsx("div",{className:"absolute -end-1 -top-1",children:e.jsx(me,{onClick:O})})]}):t!=null&&t!=="initial"&&I?e.jsx("div",{className:"flex flex-col justify-center text-center",children:e.jsxs("div",{className:"relative mb-3 text-center",children:[e.jsx("img",{src:URL.createObjectURL(t.file),alt:"",referrerPolicy:"no-referrer",className:"block h-24 w-24 rounded-full object-cover object-center"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-white",children:e.jsx(ne,{percentage:t.progress,className:"h-6 w-6"})})]})}):e.jsx(pe,{onFileChange:o=>{z(o)},mimeTypes:H}),e.jsx(ie,{className:"mt-3",children:d.formatMessage(r.propagationWarning)})]})]})}function me({onClick:s}){return e.jsx("div",{className:"flex h-6 w-6 cursor-pointer flex-row flex-wrap content-center justify-center rounded-full border-2 border-white bg-black text-white",onClick:s,children:e.jsx(re,{className:"h-3 w-3"})})}const r=B({modalTitle:{id:"workspaceAppearanceModal.title",defaultMessage:"Workspace appearance"},modalSubmit:{id:"workspaceAppearanceModal.submit",defaultMessage:"Save"},modalCancel:{id:"workspaceAppearanceModal.cancel",defaultMessage:"Cancel"},workspaceName:{id:"workspaceAppearanceModal.workspaceName",defaultMessage:"Workspace name"},workspaceNameDescription:{id:"workspaceAppearanceModal.workspaceNameDescription",defaultMessage:"Update the name of the workspace."},workspaceAvatar:{id:"workspaceAppearanceModal.workspaceAvatar",defaultMessage:"Workspace image"},workspaceAvatarDescription:{id:"workspaceAppearanceModal.workspaceAvatarDescription",defaultMessage:"Upload a JPEG or PNG workspace image for your team. (Minimum {size}Ã—{size}px recommended.)"},propagationWarning:{id:"workspaceAppearanceModal.propagationWarning",defaultMessage:"Changes to the workspace name and image may take some time to take effect."},saveError:{id:"workspaceAppearanceModal.saveError",defaultMessage:"Failed to save workspace appearance"}});export{he as W,r as m,ue as u};
//# sourceMappingURL=jh57htegso1fdrwn.js.map
