import{r as g,u as A}from"./m60bpb0x3x7rg8fj.js";import{h as i,j as c,oH as L,o as _,U as D}from"./lgw4q0e8zlqqfgug.js";import{u as E}from"./hg1hygbe4ieqyyvy.js";import{bA as f}from"./ggjzadbnd3k1vu0k.js";const r="last_checked_loc",I=24*60*60*1e3,s="last_denied_loc",y=60*60*1e3,C=L.Accepted,O=L.Pending;function P(){return i.getCookie(c.DeviceId)}function T(t,o){if(!t||!o)return null;const e=t.devices?.[o];return!e||e.status===O?null:e.status===C}function U(){const[t,o]=E(),e=P(),{data:a}=_(D.PreciseLocationDeviceSettings),n=T(a,e);g.useEffect(()=>{n!=null&&t.useLocation!==n&&o(l=>({...l,useLocation:n}))},[n,o,t.useLocation]);const{data:m}=A({queryKey:["userLocation",t.useLocation],queryFn:({queryKey:[l,d]})=>S({enabled:d}),initialData:N(t.useLocation),networkMode:"always",refetchOnMount:"always",refetchOnWindowFocus:"always",staleTime:0});return m}function N(t){if(t){const o=i.getCookie(c.LastLocation);if(o)try{return JSON.parse(o)}catch{return u(),null}}return null}async function S({enabled:t}){if(!t)return u();if((await v())?.state!=="granted"){const e=localStorage.getItem(r);if(e){const a=Number(e),n=i.getCookie(c.LastLocation);if(n&&Date.now()-I<a)try{return JSON.parse(n)}catch{}}}const o=localStorage.getItem(s);if(o){const e=Number(o);if(Date.now()-y<e)return null}return await new Promise(e=>{navigator.geolocation.getCurrentPosition(a=>{const n={latitude:a.coords.latitude,longitude:a.coords.longitude,locationAccuracy:a.coords.accuracy};i.setCookie(c.LastLocation,JSON.stringify(n),{maxAge:f}),localStorage.setItem(r,Date.now().toString()),e(n)},()=>{localStorage.setItem(s,Date.now().toString()),e(u())},{enableHighAccuracy:!0,maximumAge:0})})}function x(){return S({enabled:!0})}async function v(){return navigator?.permissions?await navigator.permissions.query({name:"geolocation"}):null}const w={latitude:null,longitude:null,locationAccuracy:null};function u(){return i.setCookie(c.LastLocation,JSON.stringify(w),{maxAge:f}),localStorage.removeItem(r),localStorage.removeItem(s),null}g.createContext(null);export{u as c,T as i,x as r,U as u};
//# sourceMappingURL=jiql7n7371z0m4r5.js.map
