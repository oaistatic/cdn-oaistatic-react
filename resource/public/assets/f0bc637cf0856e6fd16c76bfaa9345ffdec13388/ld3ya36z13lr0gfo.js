import{b2 as m,aq as l}from"./lgw4q0e8zlqqfgug.js";import{W as d}from"./g7o69yifmkuxfsll.js";import{h as g,f as y,i as b}from"./m60bpb0x3x7rg8fj.js";function R(s){return!!s&&typeof s=="object"&&"pages"in s}const v=(s,t,n)=>{const u={...s,review_preference:t.review_preference,updated_at:new Date().toISOString(),last_updated_user_email:n};return t.global_review_preference!==void 0&&(u.global_review_preference=t.global_review_preference),u};function D({showToast:s=!0}={}){const t=g(),n=y(),u=m(),_=l();return b({mutationFn:o=>d.updateCodeReviewRepositories(o),onMutate:async o=>{await t.cancelQueries({queryKey:["wham","codeReviewRepositories"]});const c=t.getQueriesData({queryKey:["wham","codeReviewRepositories"]});return t.setQueriesData({queryKey:["wham","codeReviewRepositories"]},e=>{if(!e)return e;const i=new Map((o?.repo_review_settings??[]).map(r=>[r.repository,r])),p=_?.email??null;if(R(e))return{...e,pages:e.pages.map(r=>({...r,repo_review_settings:r.repo_review_settings.map(a=>{const w=i.get(a.repository.id);return w===void 0?a:v(a,w,p)})}))};const f=e;return{...f,repo_review_settings:f.repo_review_settings.map(r=>{const a=i.get(r.repository.id);return a===void 0?r:v(r,a,p)})}}),{previous:c}},onError:(o,c,e)=>{e?.previous&&e.previous.forEach(([i,p])=>{t.setQueryData(i,p)})},onSuccess:o=>{const e=o.repo_review_settings.some(i=>i.review_preference==="team"||i.global_review_preference==="review_everyone")?n.formatMessage({id:"wham.codeReviewPage.teamAutomations.toast.enabled",defaultMessage:"Enabled code review"}):n.formatMessage({id:"wham.codeReviewPage.teamAutomations.toast.disabled",defaultMessage:"Disabled code review"});s&&u.success(e,{duration:2,hasCloseButton:!0})}})}export{D as u};
//# sourceMappingURL=ld3ya36z13lr0gfo.js.map
