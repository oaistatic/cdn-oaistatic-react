import{r as d,j as t,aq as ft,ar as Qt,as as pt,E as te,G as gt,m as H,f as Mt,d as Ot,A as Y,M as ee}from"./m60bpb0x3x7rg8fj.js";import{c as oe,a as se,s as ne,g as ae,b as re,d as ie,P as Q,T as ht}from"./iu6ics6kflocby0n.js";import{cp as le,t as ce,z as B,c as de,gE as me,cr as _t,qN as yt,lH as ue,aa as fe,aF as st,cf as pe,cq as ge,_ as he}from"./lgw4q0e8zlqqfgug.js";import{b as be,S as Ee,g as xe,u as Pt,D as Te,c as ve}from"./lfugw8qvvom7caj7.js";import{b as Ae,T as Ce,a as Ne,c as k,A as bt,u as Se,i as Re,C as Ie,g as Et}from"./pclfr6lyaiirijb5.js";import{c as we}from"./cum2m9ppsxjdt1u5.js";import{M as Me,S as Oe,d as _e,e as ye,h as xt,i as Pe,C as tt}from"./5a6x9gba3iwtvxlr.js";import{k as at,g as Le,l as Lt,c as U}from"./koh2m2w2ywhm6pl3.js";import{T as Tt,Z as je,C as ke}from"./jy1u8exw8iz2slve.js";import{jW as jt,dh as kt,lQ as S,pH as He,b as Be,lR as P,fw as De,cX as Ve,bO as We,jX as Xe}from"./ggjzadbnd3k1vu0k.js";import{u as Ht}from"./9q3v44p2xpoi75pn.js";import{a as vt}from"./i4rip6yaxdxd1xd5.js";import{t as Fe,B as Ge,I as ze}from"./dj5wvooi5050kuwj.js";import{H as Ue,P as Ye}from"./cyridnrl7jpyirze.js";import"./g5bh4mjh9t2vmm93.js";import"./j770ggbjd02m3hqj.js";import"./g4h5bud8allgzrnd.js";import"./h69gi6rcjg78v64i.js";import"./kh89q49991ykwivd.js";import"./pc2givv05uuq8g6l.js";import"./n70zh1fo8aekhdb0.js";import"./lf8mxjdfum7t34gh.js";import"./d4l47j95cc16bbv9.js";import"./mlo67gs1ylzshmge.js";import"./h81zqbvh0a7amk0o.js";import"./bk8slwxjkdlmxjxm.js";import"./og0mzunrykkt4tp0.js";import"./lff9oru7r5vtmz06.js";import"./tfkm8dsw7zx8il21.js";import"./rx5cs0ja7c7phupc.js";import"./n5yj38pa2aamrsfp.js";import"./mog17ocsx2bkw4q4.js";import"./evlyokzg1xrjbsou.js";import"./n9mc8ay6b1mvrc8r.js";import"./ns51nblw8ziscsgd.js";import"./g61ghrdmm0y010eo.js";import"./kfjcy5y4cxuymbdf.js";import"./imrl18sy28ygoppx.js";import"./kl7c6054usfnqmd4.js";import"./mia7qmdupqoji40k.js";import"./cqdszxwxh9yigbop.js";import"./hs2mcew9gnq8d8k8.js";import"./ekc4a26ow669vmxe.js";import"./envm9t71cd7luwm9.js";function Ze(e,o){d.useEffect(()=>{const n=e?.current;if(n!=null)return le(n,{mousedown:m=>{o.current?.maybeFocusOnEditor(m)===!0&&m.preventDefault()}})},[o,e])}const qe=({wrapperClassName:e,value:o="",width:n,comments:m,paddingBottom:h})=>{const i=d.useRef(null),a=d.useRef(null),r=ce();return d.useEffect(()=>{const{current:c}=i;if(c)return a.current=oe({mount:c,comments:m,value:o,isDarkMode:r}),()=>{a.current?.destroy()}},[]),d.useEffect(()=>{const c=se(o,m);a.current?.updateState(c)},[o,m]),t.jsx("div",{className:e,children:t.jsx("div",{ref:jt(i),className:B(ne.main,"markdown prose dark:prose-invert focus:outline-hidden"),style:{width:n,paddingBottom:h}})})},Bt=e=>!e||"docView"in e&&e.docView==null||Ae(e.state.doc),et=100,$e={type:"spring",duration:1.5,bounce:.1},Je={type:"spring",duration:.5,bounce:0},At={type:"spring",duration:.2},Ct={type:"spring",duration:1,delay:.1},Ke={type:"spring",duration:1},Qe={type:"spring",duration:.5,bounce:0},to=({isRewriting:e=!1,value:o,previousValue:n,previousComments:m,documentWidth:h,paddingBottom:i,onStart:a})=>{const r=at(),c=ft(0),u=ft(-100),T=d.useRef(!1),[f,E]=Qt(),[{height:A},l]=Ht(),b=kt();de(()=>{const s=r();return s&&(s.dom.style.clipPath="inset(0 0 100% 0)"),()=>{const p=r();p&&(p.dom.style.clipPath="")}},[]),d.useEffect(()=>{const s=r();if(!s||Bt(s))return f?void 0:E?.();try{const p=Le(s.state.doc)?.end;if(p==null||p>o.length)return;const{top:v}=s.coordsAtPos(0),{top:N,bottom:O}=s.coordsAtPos(Math.max(s.state.doc.content.size-1,0),-1),C=O-v,R=N-v;if(c.set(C-R),!f){pt(u,C+2*c.get(),Je).then(()=>E?.());return}pt(u,C,$e)}catch(p){S.logError("Failed to set rewrite animation position",p),E?.()}},[f,o]);const g=te(u,s=>me(s)-et+2);return gt(u,"change",s=>{const p=r();!p||!s||!T.current||(p.dom.style.clipPath=`inset(0 0 calc(100% - ${s}px) 0)`)}),gt(u,"animationStart",()=>{e&&a?.()}),t.jsxs(t.Fragment,{children:[b&&t.jsx(H.div,{style:{visibility:"hidden",pointerEvents:"none",height:A},initial:!1,exit:{height:0},transition:{delay:.1,duration:.8,ease:"easeOut"}}),t.jsx(H.div,{className:"absolute top-0 z-10 w-full origin-bottom bg-linear-to-t from-[var(--canvas-bg,var(--bg-primary))] from-10% to-transparent",style:{translateY:g,height:et},initial:{opacity:0},animate:{opacity:1,transition:At},exit:{opacity:0,transition:Ct},onAnimationComplete:()=>T.current=!0},"wash-top"),t.jsx(H.div,{className:"absolute top-0 z-10 w-full bg-linear-to-b from-[var(--canvas-bg,var(--bg-primary))] to-transparent",style:{translateY:u,height:et},initial:{opacity:0},animate:{opacity:1,transition:At},exit:{opacity:0,transition:Ct}},"wash-bottom"),t.jsx(H.div,{ref:l,className:"pointer-events-none absolute z-0 max-w-full min-w-0",initial:{opacity:1},animate:{opacity:.3,transition:Ke},exit:{opacity:0,transition:Qe},children:t.jsx(qe,{value:n,width:h,comments:m,wrapperClassName:"h-fit flex",paddingBottom:i})},"previousValue")]})},eo=e=>d.createElement("svg",{width:16,height:16,viewBox:"0 0 16 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e},d.createElement("path",{d:"M4.91463 13.3C4.2134 13.3 3.80005 12.874 3.80005 12.1394V3.8533C3.80005 3.12606 4.2134 2.70001 4.91463 2.70001H8.43555C10.4359 2.70001 11.6908 3.72108 11.6908 5.3445C11.6908 6.50515 10.8197 7.47479 9.69038 7.64375V7.70252C11.1372 7.8127 12.2 8.86315 12.2 10.2662C12.2 12.1321 10.7902 13.3 8.51674 13.3H4.91463ZM6.02923 7.1075H7.63098C8.81939 7.1075 9.49847 6.58595 9.49847 5.68976C9.49847 4.83764 8.90058 4.35282 7.8598 4.35282H6.02923V7.1075ZM6.02923 11.6472H7.94838C9.23274 11.6472 9.92662 11.1036 9.92662 10.0899C9.92662 9.09822 9.2106 8.56932 7.89671 8.56932H6.02923V11.6472Z"})),oo=e=>d.createElement("svg",{width:16,height:16,viewBox:"0 0 16 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e},d.createElement("path",{d:"M9.95321 12.8207C9.90524 13.0976 9.66251 13.3 9.37844 13.3H4.93339C4.57343 13.3 4.29943 12.9807 4.35802 12.6295C4.40447 12.3511 4.64795 12.1468 4.93338 12.1468H6.59937L8.09417 3.8533H6.62059C6.26063 3.8533 5.98663 3.534 6.04523 3.1828C6.09169 2.90432 6.33517 2.70001 6.62059 2.70001H11.0668C11.4254 2.70001 11.6989 3.01687 11.6428 3.367C11.5978 3.6471 11.3536 3.8533 11.0668 3.8533H9.39658L7.90177 12.1468H9.37844C9.73986 12.1468 10.0142 12.4685 9.95321 12.8207Z"}));function Nt(e,o){if(e==null)return!1;const n=e.state.schema.marks[o];return n==null?!1:Fe(e.state,e.dispatch,n)}function ot(e,o){if(e==null)return!1;const{state:n,dispatch:m}=e,h=_t(n.schema.nodes[Ue.proseMirrorNodeName()]);return yt(h,{level:o})(n,m)}function so(e){if(e==null)return!1;const{state:o,dispatch:n}=e,m=_t(o.schema.nodes[Ye.proseMirrorNodeName()]);return yt(m)(o,n)}const no=({availableWidth:e,onAddComment:o,isSendDisabled:n=!1,isWaitingForCommentResponse:m=!1,onSubmitAccelerator:h})=>{const i=Mt(),a=at(),r=Lt(),c=He(),u=d.useCallback(l=>{const{width:b,height:g}=l,s=a();if(!r||!s||Bt(s))return null;const{to:p,empty:v,head:N}=r.selection,{platform:O}=Be(),C=O==="web"?N:p,R=C===p;if(v||!vt(s.state.doc,C))return null;const{right:L,left:_,top:V}=s.coordsAtPos(0);let y=C,W=s.state.doc.nodeAt(y);const X=R?-1:1;for(;!W?.isText&&vt(s.state.doc,y+X);)y+=X,W=s.state.doc.nodeAt(y);const{left:D,bottom:F,top:Z}=s.coordsAtPos(y,R?-1:1),G=L-_;function rt(){if(R)return Math.max(D-_-b,0);let w=D-_;return w+b>G&&(w=-(b-G)),w}function j(){const w=window.innerHeight-F>g*2;return R&&w?{top:F-V+8,aboveOrBelow:bt.BELOW}:{top:Z-V-g-8,aboveOrBelow:bt.ABOVE}}const I=j();return{left:rt(),top:I.top,aboveOrBelow:I.aboveOrBelow,toolbarSize:l}},[r,a]),T=d.useCallback(()=>a()?.dom??null,[a]),f=[{label:i.formatMessage(M.heading1),className:"text-5xl font-semibold",onClick:()=>{S.logButtonClick(P.TOOLBAR_FORMAT_HEADER1),ot(a(),1)}},{label:i.formatMessage(M.heading2),className:"text-3xl font-semibold",onClick:()=>{S.logButtonClick(P.TOOLBAR_FORMAT_HEADER2),ot(a(),2)}},{label:i.formatMessage(M.heading3),className:"text-2xl font-semibold",onClick:()=>{S.logButtonClick(P.TOOLBAR_FORMAT_HEADER3),ot(a(),3)}},{label:i.formatMessage(M.body),className:"text-base",onClick:()=>{S.logButtonClick(P.TOOLBAR_FORMAT_PARAGRAPH),so(a())}}],E=()=>{const l=a();if(!l)return null;const{state:b}=l,{from:g,to:s,sourceFrom:p,sourceTo:v}=xe(b);return g==null||s==null||p==null||v==null?(S.logError("Prosemirror getSelectionRange has null values",null,{from:g,to:s,sourceFrom:p,sourceTo:v}),null):{from:g,to:s,sourceFrom:p,sourceTo:v}},A=(l,b,g)=>{const s=a(),p=E();if(p==null)return;const{sourceFrom:v,sourceTo:N}=p,O={start:v,end:N};if(r&&s){const C=r.tr.setSelection(ue.create(r.doc,r.selection.anchor));s.dispatch(C)}S.logButtonClick(P.TOOLBAR_FORMAT_STYLE,{action:{action:g.action,id:g.id,title:g.title},prompt:b,sourceFrom:v,sourceTo:N}),h?.(l,O,i.formatMessage(b),g)};return t.jsxs(Ce,{isWaitingForCommentResponse:m,isSendDisabled:n,onAddComment:o,toolbarType:Ne.WRITING,getToolbarPosition:u,getEditorDom:T,getSelectionRange:E,children:[c&&t.jsxs(t.Fragment,{children:[t.jsx(k.Separator,{}),t.jsx(k.Popover,{label:i.formatMessage(M.format),hideLabel:e<=400,icon:De,align:"center",children:t.jsx("div",{className:B("border-token-border-default bg-token-main-surface-primary flex w-48 flex-col items-stretch rounded-xl border p-1",Tt),children:be.map(l=>{const{title:b,icon:g}=l;return t.jsxs("button",{onClick:s=>{"prompt"in l&&A(s,l.prompt,l)},className:"bg-token-main-surface-primary dark:hover:bg-token-main-surface-secondary flex flex-row items-center gap-x-2 rounded-md p-3 hover:bg-[#f5f5f5]",children:[t.jsx("div",{className:"flex",children:t.jsx(g,{className:"icon"})}),t.jsx("div",{className:"line-clamp-1 flex-auto text-start text-sm",children:i.formatMessage(b)})]},l.id)})})})]}),t.jsx(k.Separator,{}),t.jsx(k.Action,{label:i.formatMessage(M.bold),hideLabel:!0,icon:eo,onClick:()=>{S.logButtonClick(P.TOOLBAR_FORMAT_BOLD),Nt(a(),Ge.proseMirrorMarkName())},onMouseDown:l=>l.preventDefault()}),t.jsx(k.Action,{label:i.formatMessage(M.italic),hideLabel:!0,icon:oo,onClick:()=>{S.logButtonClick(P.TOOLBAR_FORMAT_ITALIC),Nt(a(),ze.proseMirrorMarkName())},onMouseDown:l=>l.preventDefault()}),t.jsx(k.Popover,{label:i.formatMessage(M.format),hideLabel:!0,icon:Ee,children:t.jsx("div",{className:B("border-token-border-default bg-token-main-surface-primary flex flex-col items-stretch rounded-xl border p-1",Tt),children:f.map(({label:l,className:b,onClick:g})=>t.jsx("button",{onClick:g,className:"hover:bg-token-main-surface-secondary w-full rounded-xl p-4 text-start",children:t.jsx("div",{className:b,children:l})},l))})})]})},M=Ot({bold:{id:"qqbk91",defaultMessage:"Bold"},italic:{id:"5oh4LV",defaultMessage:"Italic"},format:{id:"z8IGv0",defaultMessage:"Transform"},heading1:{id:"AR5o30",defaultMessage:"Heading 1"},heading2:{id:"zb/wrc",defaultMessage:"Heading 2"},heading3:{id:"xZJvLM",defaultMessage:"Heading 3"},body:{id:"Hi6z3L",defaultMessage:"Body"},caption:{id:"VXpL7v",defaultMessage:"Caption"},bullets:{id:"2vznKX",defaultMessage:"Bullets"},outline:{id:"Xmbt6r",defaultMessage:"Outline"},table:{id:"0UjL6P",defaultMessage:"Table"}});function St({position:e,numEdits:o,closestEditId:n}){const m=Pt(),h=Mt(),i=e==="top"?Ve:We,a=()=>{const c=m();if(!c||!n)return;const u=ae(c,n);if(u.length===0){fe.addError("Edit could not be found while attempting to scroll",{closestEditId:n});return}u[e==="top"?0:u.length-1].scrollIntoView({behavior:"smooth",block:"center"})},r=e==="top"?-4:4;return t.jsx(Y,{children:o>0&&t.jsx(H.div,{className:B("absolute start-1/2 z-20 select-none",{"bottom-[20px]":e==="bottom","top-[20px]":e==="top"}),initial:{scale:.95,translateY:r,translateX:"-50%",opacity:0},animate:{scale:1,translateY:0,translateX:"-50%",opacity:1},exit:{scale:.95,translateY:r,translateX:"-50%",opacity:0},transition:{type:"spring",duration:.3},children:t.jsxs("div",{className:B("flex items-center justify-center rounded-full border px-4 py-2","border-token-main-surface-tertiary bg-token-main-surface-primary hover:bg-token-main-surface-secondary shadow-md"),"aria-label":h.formatMessage(Rt.ariaLabel),role:"button",onClick:a,children:[t.jsx(ee,{...Rt.label,values:{count:o}}),t.jsx(i,{className:"icon-sm ms-2"})]})})})}const Rt=Ot({label:{id:"Pf30w4",defaultMessage:"{count, plural, one {1 more edit} other {{count} more edits}}"},ariaLabel:{id:"qTJjzl",defaultMessage:"Button to scroll the next edit into view."}});function ao({diff:e=null}){const o=Pt(),[n,m]=d.useState([]),[h,i]=d.useState([]),a=st.useState(st.selectWindowHeight),r=d.useCallback(()=>{const c=o();if(!c||!e)return;const u=[],T=[];for(const f of e.edits){const E=re(c,f.id);if(E.length>0){const A=ie(E);A.bottom<0?u.push([f.id,A]):A.top>a&&T.push([f.id,A])}}u.sort(([,f],[,E])=>f.bottom-E.bottom),T.sort(([,f],[,E])=>f.top-E.top),m(u.map(([f])=>f)),i(T.map(([f])=>f))},[e,a,o]);return Se(e?.edits??[],r),d.useEffect(()=>{const c=setTimeout(r,500);return()=>{clearTimeout(c)}},[r]),t.jsxs(t.Fragment,{children:[t.jsx(St,{position:"top",numEdits:n.length,closestEditId:n[n.length-1]}),t.jsx(St,{position:"bottom",numEdits:h.length,closestEditId:h[0]})]})}const nt=pe(()=>({rejectedEdits:new Set,hoveredEditId:null})),{setState:ss}=nt,ro=({pos:e})=>{const o=at()(),n=Lt();if(!o||!n||e==null)return null;const{doc:m}=n,{top:h,left:i}=o.coordsAtPos(0),{top:a,left:r}=o.coordsAtPos(e),c=m.nodeAt(e),u=e+(c?.nodeSize??0)-1,{top:T}=o.coordsAtPos(e+1),{top:f,bottom:E,right:A}=o.coordsAtPos(u),b=(T>=f?A:o.dom.getBoundingClientRect().right)-r,g=E-a+4;return t.jsx(H.div,{style:{top:a-h,left:r-i,height:g,width:b},className:B("absolute after:absolute after:inset-x-[-4px] after:inset-y-0 after:z-0 after:rounded-md after:bg-[Highlight] after:content-[''] dark:after:bg-[Highlight]",je.blockCommentHover),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0}})},io=({pos:e})=>t.jsx(Y,{children:e!=null&&t.jsx(ro,{pos:e})}),It=24,lo=16,co=0,mo=8,wt=4,ns=({comments:e,diff:o,readonlyReason:n,isDisabled:m=!1,isRewriting:h=!1,isSendDisabled:i=!1,previousComments:a,previousValue:r,isPreview:c=!1,isRequestActive:u=!1,isWaitingForCommentResponse:T=!1,targetedContent:f=null,onAcceleratorsExpandedChange:E,getAutocompleteSuggestion:A,getStableCommentId:l=Xe,onBlur:b,onCancelRequest:g,onChange:s,onSave:p,onAddComment:v,onSubmitAccelerator:N,onAcceptComment:O,onDismissComment:C,onExitShowChanges:R,value:L,commentsMode:_=tt.ENABLED,hideAccelerators:V=!1,hideToolbar:y=!1,hideEditOverlay:W=!1,safeUrls:X,width:D,modelCursor:F,shouldResetSelection:Z,metadata:G})=>{const j=kt()&&c,I=d.useRef(null),w=d.useRef(null);Ze(w,I);const[{width:Dt},Vt]=Ht(),it=ge(),Wt=he(),lt=d.useRef(null),[q,ct]=d.useState(!1),Xt=lt.current,Ft=Re(Xt)??!1,dt=j?Wt?Me:Oe:it?_e:ye,z=(()=>{if(D==null){const x=Ft?0:Et();return Dt-x}return D-dt*2-Et()})(),$=j?z:z>=xt+we?xt:Pe,Gt=z-$,zt=U(({commentingOn:x})=>x),Ut=U(({hoveredCommentId:x})=>x),Yt=U(({focusedCommentId:x})=>x),Zt=U(({hoveredBlockCommentLauncherPos:x})=>x),qt=nt(x=>x.hoveredEditId),$t=nt(x=>x.rejectedEdits);d.useEffect(()=>{f==null&&I.current?.revertChanges()},[f]),d.useEffect(()=>{I.current?.flushChanges(),I.current?.UNSAFE_setValue(L)},[L]);const Jt=st.useState(({windowHeight:x})=>{if(j)return wt;if(it)return c?co:lo;if(c)return It;const J=mo/100*x;return Math.max(It,J)}),Kt=({currentTarget:x,nativeEvent:J})=>{const ut=J.composedPath();for(const K of ut.slice(0,ut.indexOf(x)))if(K instanceof HTMLElement&&(K.id===ht.PROSEMIRROR_EDITOR_CONTAINER||K.id===ht.PROSEMIRROR_CONTEXT_CHILDREN))return;R?.()},mt=j?wt:c?"1rem":"max(3rem,24vh)";return t.jsx("div",{className:"h-full w-full",ref:w,onClick:Kt,children:t.jsx("div",{className:ke.document,style:{margin:`0 ${dt}px`,paddingTop:Jt},children:t.jsx("div",{ref:jt(Vt,lt),className:"z-0 flex w-full flex-col items-center",children:t.jsxs(Q,{comments:e,diff:o,editorRef:I,hoveredCommentId:Ut,focusedCommentId:Yt,hoveredEditId:qt,rejectedEdits:$t,value:h&&!q?"":L,commentingOn:zt,isDisabled:m||h||q,onBlur:b,onChange:s,onSave:p,width:$,safeUrls:X,wrapperClassName:"relative z-10 flex max-w-full h-fit",paddingBottom:mt,modelCursor:F,shouldResetSelection:Z,transparentBackground:!q,contentReferences:G?.contentReferences??[],getAutocompleteSuggestion:A,children:[t.jsxs(Q.EditorChildren,{children:[t.jsx(Y,{onExitComplete:()=>ct(!1),children:h&&t.jsx(to,{isRewriting:h,documentWidth:$,previousValue:r,previousComments:a,value:L,paddingBottom:mt,onStart:()=>ct(!0)})}),!y&&t.jsx(no,{availableWidth:z,isWaitingForCommentResponse:T,isSendDisabled:i,onAddComment:v,onSubmitAccelerator:N}),_===tt.ENABLED&&t.jsx(io,{pos:Zt}),t.jsx(Y,{children:_!==tt.ALL_HIDDEN&&t.jsx(Ie,{availableWidth:Gt,comments:e,commentsMode:_,isRequestActive:u,onAddComment:v,onAcceptComment:O,onDismissComment:C,isWaitingForCommentResponse:T,disableBlockComments:u,getStableCommentId:l})})]}),t.jsxs(Q.ContextChildren,{children:[!W&&o&&t.jsx(ao,{diff:o}),!V&&t.jsx(Te,{isRequestActive:u,onSubmit:N,isVisuallyHidden:i||!!n?.isStreamingFromNative||n?.isReadonly&&!n.isStreaming,actions:ve,onCancel:g,onExpandedChange:E})]})]})})})})};export{ns as DocumentComposer};
//# sourceMappingURL=nfp56eju7l2tzdoe.js.map
