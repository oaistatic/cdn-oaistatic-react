import{j as e,f as J,M as E,r as h}from"./m60bpb0x3x7rg8fj.js";import{e as y,p as b,q as V,fU as X,z as u,B as Y,du as _,iI as Z,gn as U,cO as ee,dC as te,h1 as se,P,d0 as ae,R as ne,T as re,g as ie,ap as le,ed as oe}from"./lgw4q0e8zlqqfgug.js";import{iC as $,ej as B,kK as F,cW as ce,kL as de,ds as me}from"./ggjzadbnd3k1vu0k.js";import{S as xe}from"./ord59db2glk2ok2n.js";import{M as A}from"./h81zqbvh0a7amk0o.js";function D({message:n,simulatedDuration:i=8*60*1e3,maxFill:s=100,isCircular:a=!1}){n?.metadata?.model_slug!=="o1-pro"&&(i=20*60*1e3);const c=n?.create_time?new Date(n.create_time*1e3):Date.now(),r=$(+c,i),o=y(),t=b(o,"3208967109");return a?e.jsx(B,{percentage:r,className:"me-4 w-full!",transitionDuration:`${(100-r)/100*5}s`,transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)"}):e.jsx(F,{percentage:Math.min(r,s),className:"me-4 w-full!",backgroundClassName:"bg-token-sidebar-surface-secondary rounded-full",barClassName:"bg-token-text-secondary rounded-full",transitionDuration:`${(100-r)/100*.2}s`,transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)",height:t?4:8})}function ue({title:n,content:i,buttons:s,time:a,icon:c,size:r="default",progressBar:o,disabled:t=!1,onClick:d}){const f=r==="small"?`w-full flex max-w-[calc(0.8*var(--thread-content-max-width,40rem))] ps-[20px] pt-[13px] pb-[10px] ${t?"":"gap-4"}`:"w-full gap-4 px-[22px] pb-[22px] pt-[18px]",j=d?"cursor-pointer":"",p=r==="small"?"text-[15px]":"",g=V(X);return e.jsxs("div",{className:u("relative inline-flex flex-col items-start justify-start rounded-2xl border","bg-token-bg-primary border-token-border-default box-content rounded-2xl border bg-clip-padding px-5 py-4",!g&&"mx-[calc(--spacing(-2)-1px)] -my-[1px] @max-3xl:-top-2 @3xl:-start-3 @3xl:-top-4",f,j,p),onClick:d,children:[e.jsxs("div",{className:u("flex flex-col items-start justify-start self-stretch",r!=="small"&&"gap-1.5"),children:[e.jsxs("div",{className:u("inline-flex items-start justify-start self-stretch",r!=="small"&&"gap-2"),children:[e.jsx("div",{className:u("shrink grow basis-0 leading-normal font-medium","text-token-text-secondary hover:text-token-text-primary"),children:n}),e.jsx("div",{className:"relative h-6 w-6"}),!t&&(c||e.jsx(xe,{className:"relative h-6 w-6"}))]}),e.jsx("div",{className:u("flex w-full flex-col items-start justify-start",r==="small"&&"mt-[-2px]"),children:e.jsx("div",{className:u("inline-flex w-full items-start justify-start self-stretch rounded-sm",r==="small"?"gap-1":"gap-2.5 py-1"),children:e.jsx("div",{className:u("w-full leading-relaxed font-normal",t?"text-token-text-tertiary":"text-token-text-secondary"),children:i})})})]}),o?e.jsxs("div",{className:u("mb-2 inline-flex items-center justify-between self-stretch",s?.length&&"mt-[-10px]"),children:[o,s]}):e.jsxs("div",{className:"inline-flex items-center justify-end self-stretch",children:[a&&e.jsx("div",{className:"text-token-text-tertiary shrink grow basis-0 text-[15px] leading-normal font-normal",children:a}),e.jsx("div",{className:"flex gap-2",children:s})]})]})}function z({message:n,isCircular:i=!1}){const s=5.333333333333334;let a=n?.metadata?.tournament_progress??0;const c=n?.metadata?.model_slug==="o1-pro"?8*60*1e3:20*60*1e3,r=n?.create_time?n.create_time*1e3:Date.now(),o=$(r,c);a=Math.max(o,a);const t=y(),d=b(t,"3208967109");return d&&(a=Math.max(a,s)),i?e.jsx(B,{percentage:a,className:"me-4 w-full!",sizeOverride:20,thickness:1/8,transitionDuration:`${(100-a)/100*5}s`,transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)"}):e.jsx(F,{percentage:a,className:"me-4 w-full!",backgroundClassName:"bg-token-sidebar-surface-secondary dark:bg-token-border-default rounded-full",barClassName:"bg-token-text-secondary rounded-full",transitionDuration:`${(100-a)/100*5}s`,transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)",height:d?4:8})}function fe({errorNotice:n,onOpenSidebarSummarizer:i,isReceivingUpdates:s,lastMessage:a,latestTitle:c,summarizationHeadline:r,handleSkipClick:o}){const t=y(),d=J(),f=b(t,"4094234945"),j=b(t,"3208967109"),p=b(t,"3327816228"),g=f?z:D,w=(a?.metadata?.bon_skipped||a?.clientMetadata?.bonSkipPending)&&s;if(j){if(w)return e.jsx("span",{className:"result-streaming pulse relative pt-1",children:e.jsx("span",{})});const m=(s?c:a?.metadata?.finished_text)??d.formatMessage({id:"hgnsat",defaultMessage:"Thinking"});return e.jsxs("div",{className:"flex items-start gap-3 pb-2",children:[e.jsxs("div",{className:"flex w-full flex-col",children:[e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx("button",{type:"button",onClick:i,className:"group inline-flex max-w-full items-center rounded-md focus:outline-none",children:e.jsxs("span",{className:s?"loading-shimmer text-token-text-secondary inline-flex max-w-full items-center gap-0.5 truncate text-base leading-5 font-medium md:text-base":"text-token-text-tertiary hover:text-token-text-primary inline-flex max-w-full items-center gap-0.5 truncate text-base leading-5 font-medium md:text-base",children:[m,e.jsx(ce,{className:"icon-xs text-token-text-tertiary group-hover:text-token-text-primary"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[s&&p&&e.jsx("button",{onClick:o,className:"text-token-text-tertiary hover:text-token-text-primary whitespace-nowrap",children:e.jsx("span",{className:"flex items-center gap-0.5 underline decoration-dotted decoration-[8%]",children:e.jsx(E,{id:"xMM6dg",defaultMessage:"Answer now"})})}),s&&e.jsx("div",{className:"ms-1 shrink-0 self-start md:hidden",children:e.jsx(g,{message:a,isCircular:!0})})]})]}),s&&e.jsx("div",{className:"mt-[22px] mb-2 hidden self-stretch md:inline-flex",children:e.jsx("div",{className:"w-full max-w-[150px]",children:e.jsx(g,{message:a,isCircular:!1})})})]}),n]})}return e.jsxs("div",{className:"flex pb-2",children:[e.jsx(ue,{buttons:s?[e.jsx(Y,{onClick:m=>{m.stopPropagation(),i()},color:"secondary",className:"text-token-text-secondary h-[38px]! text-[15px] font-normal",children:e.jsx("div",{className:"px-1",children:e.jsx(E,{id:"wQcuK8",defaultMessage:"Details"})})},"Details")]:[],time:null,title:r,icon:s?e.jsx("div",{className:""}):null,content:s?`${c}...`:a?.metadata?.finished_text??"",size:"small",disabled:!s,onClick:i,progressBar:s?f?e.jsx(z,{message:a}):e.jsx(D,{message:a}):null}),n]})}const pe=/\*\*(.*?)(?:\*\*|\n|$)/g,ge=n=>{let i=null,s;for(;(s=pe.exec(n))!=null;)i=s[1].trim();return i},he=()=>null;function ye({messages:n,isStreaming:i,isCompletionRequestInProgress:s,hasActiveRequest:a,isLastMessage:c,isFinalTurn:r,isFeedbackEnabled:o,clientThreadId:t,currentGroupedMessageIndex:d,turnIndex:f}){const[j,p]=h.useState(""),[g,w]=h.useState(!1),m=_(t),L=Z(t)?.value===U.STREAMING,G=de(_(t)),l=ee(n),R=l?.id,S=l?.metadata?.initial_text,k=l?.metadata?.summarization_headline,N=n.map(x=>te(x)).join(`

`),{toggleThreadSidebar:C}=se(),W=h.useCallback(()=>{C({type:"summarizer",clientThreadId:t,currentGroupedMessageIndex:d,turnIndex:f})},[C,t,d,f]),O=h.useCallback(()=>{m&&(P.logEventWithStatsig("chatgpt_web_pro_skip_clicked","chatgpt_web_pro_skip_clicked",{conversationId:m,messageId:l?.id}),l?.id&&ae(t,x=>{oe.updateTree(x,M=>{M.updateNodeMetadata(l.id,{bonSkipPending:!0}),M.updateNodeMessageMetadata(l.id,{bon_skipped:!0})})}),ne.safePost("/bon/{conversation_id}/skip",{parameters:{path:{conversation_id:m}}}))},[m,l,t]),q=y(),T=b(q,"3208967109");h.useEffect(()=>{const x=ge(N);if(x){p(x);return}if(T&&k!=null){p(k);return}S!=null&&p(S)},[N,k,T,S]),h.useEffect(()=>{N.length>0&&w(!0)},[N]),h.useEffect(()=>{g&&P.logEvent("Tool: Received a8km123 message",{client_thread_id:t,message_id:R,conversationId:_(t)})},[g]);const H=r&&c&&(L||i),K=he()!=null,I=re.isLastActorMessage(ie(t),n[0].id),Q=!!le(t,x=>x?.sharedConversationMetadata),v=me(n[0],I,K,s||a,Q);return!G&&l?.metadata?.finish_details?.type==="interrupted"&&l?.metadata?.finish_details?.reason!=="server_timeout"||l?.clientMetadata?.err?e.jsx("div",{children:v&&e.jsx(A,{errorState:v,nodeId:n[0].id,isFeedbackEnabled:o,clientThreadId:t,isUserTurn:!1})}):e.jsx(fe,{errorNotice:v&&e.jsx(A,{errorState:v,nodeId:n[0].id,isFeedbackEnabled:o,clientThreadId:t,isUserTurn:!1}),onOpenSidebarSummarizer:W,isReceivingUpdates:H,lastMessage:l,latestTitle:j,summarizationHeadline:k,handleSkipClick:O})}export{ye as default};
//# sourceMappingURL=fs8fskv03fy12s6d.js.map
