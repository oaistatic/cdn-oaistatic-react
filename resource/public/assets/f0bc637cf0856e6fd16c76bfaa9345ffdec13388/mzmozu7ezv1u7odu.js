import{i6 as Y,lh as X,e as O,p as B,dK as F,B as Z,hi as ee,hn as te,z as p,gh as se,cs as I,S as ae,m7 as ie,oG as ne}from"./lgw4q0e8zlqqfgug.js";import{j as e,f as L,r as v,M as n,J as T}from"./m60bpb0x3x7rg8fj.js";import{W as le,u as oe}from"./obyri1de2ezmnazh.js";import{u as _}from"./ivuooijrkuqmc9p5.js";import{al as m,fN as re,bI as de,aS as d,ak as N}from"./ggjzadbnd3k1vu0k.js";import{z as U,A as ce,u as me}from"./g7o69yifmkuxfsll.js";import ue from"./bcwugkyac7n8vqvf.js";import{I as xe}from"./czj65b9i5sztgpdb.js";import{u as pe}from"./ld3ya36z13lr0gfo.js";import{u as fe}from"./gbjc6hxbvndx1k9k.js";import"./hv81c3k3l9e69foo.js";import"./jqy1uu6573e00zh8.js";import"./rx5cs0ja7c7phupc.js";import"./n5yj38pa2aamrsfp.js";import"./cb9cgv53vja8utnc.js";import"./lycvq5rqsik44ye8.js";import"./crheuewn890nts1d.js";import"./df3y7yi36gehsn95.js";import"./jii3s2n86nvi5fnj.js";import"./m9elivgqkyz3hcka.js";function we({value:s,options:i,disabled:a,onChange:o}){const l=i.find(r=>r.value===s);return e.jsxs(m.Root,{value:s,onValueChange:r=>o(r),disabled:a,children:[e.jsxs(m.Trigger,{className:"w-full max-w-[260px] min-w-[120px] justify-between sm:max-w-[300px]",children:[e.jsx("div",{className:"truncate text-sm font-normal",children:l?.title}),e.jsx(m.Icon,{})]}),e.jsx(m.Portal,{children:e.jsx(m.Content,{className:"max-w-[340px] min-w-[220px]","data-unbound-width":"",children:i.map(r=>e.jsx(m.Item,{value:r.value,className:"items-start",children:e.jsxs("div",{className:"flex min-w-[220px] flex-col gap-1",children:[e.jsx("span",{className:"text-sm font-normal",children:r.title}),e.jsx("span",{className:"text-token-text-tertiary text-xs whitespace-normal",children:r.description})]})},r.value))})})]})}function ge({isSaving:s,initialScope:i,onChange:a,showNewReviewSettings:o=!1}){const l=L(),r=_(),[f,h]=v.useState(i),w=[{value:"never",title:l.formatMessage({id:"wham.codeReviewPage.autoReview.optionOff",defaultMessage:"Off"}),description:l.formatMessage({id:"wham.codeReviewPage.autoReview.optionOff.description",defaultMessage:"Across all repos"})},{value:"always",title:l.formatMessage({id:"wham.codeReviewPage.autoReview.optionAll",defaultMessage:"Across all repos"}),description:l.formatMessage({id:"wham.codeReviewPage.autoReview.optionAll.description",defaultMessage:"Run code reviews on my PRs in every repo"})},{value:"repo_default",title:r?l.formatMessage({id:"wham.codeReviewPage.autoReview.optionTeam",defaultMessage:"Only in team-enabled repos"}):l.formatMessage({id:"wham.codeReviewPage.autoReview.optionPersonal",defaultMessage:"Only in specific repos"}),description:r?l.formatMessage({id:"wham.codeReviewPage.autoReview.optionTeam.description",defaultMessage:"Run only in repos where my team has enabled them"}):l.formatMessage({id:"wham.codeReviewPage.autoReview.optionPersonal.description",defaultMessage:"Run only in selected repos"})}],R=[{value:"always",title:l.formatMessage({id:"wham.codeReviewPage.autoReview.optionAllNew",defaultMessage:"Always"}),description:l.formatMessage({id:"wham.codeReviewPage.autoReview.optionAllNew.description",defaultMessage:"Run code reviews on my PRs in every repo"})},{value:"repo_default",title:l.formatMessage({id:"wham.codeReviewPage.autoReview.enabledPerRepo",defaultMessage:"Enabled per repo"}),description:r?l.formatMessage({id:"wham.codeReviewPage.autoReview.enabledPerRepo.descriptionTeam",defaultMessage:"Review my pull requests in repos which have reviews enabled"}):l.formatMessage({id:"wham.codeReviewPage.autoReview.enabledPerRepoTeam.descriptionPersonal",defaultMessage:"Run only in selected repos"})}];return e.jsx("section",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"flex w-full flex-wrap items-start justify-between gap-4 sm:flex-nowrap",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("p",{className:"text-sm font-medium",children:e.jsx(n,{id:"wham.codeReviewPage.autoReviewMyPRs",defaultMessage:"Review my pull requests automatically"})}),e.jsx("p",{className:"text-token-text-secondary text-xs",children:e.jsx(n,{id:"wham.codeReviewPage.autoReviewMyPRs.description",defaultMessage:"Codex automatically suggests improvements (or reacts with 👍)"})})]}),e.jsx("div",{className:"flex w-full justify-end sm:w-auto",children:e.jsx(we,{value:f,options:o?R:w,disabled:s,onChange:c=>{h(c),a(c)}})})]})})}function ve(){return e.jsx(Y,{type:"info",className:"bg-token-bg-tertiary! rounded-2xl!",icon:e.jsx(re,{className:"icon-md text-token-text-tertiary"}),isElevated:!1,content:e.jsx("p",{className:"text-token-text-secondary text-sm leading-tight font-normal",children:e.jsx(n,{id:"wham.codeReviewPage.infoBanner.title",defaultMessage:"Mention @<b>codex</b> in your pull request to ask questions or start a task.",values:{b:s=>e.jsx("span",{className:"font-medium",children:s})}})})})}function he(s,i){const a=X("installations/select_target");if(s.length>1)return a;const o=s[0];return i?o.account_type==="user"?`https://github.com/settings/installations/${o.id}/permissions/update`:`https://github.com/organizations/${o.account_login}/settings/installations/${o.id}/permissions/update`:`https://github.com/settings/installations/${o.id}`}function je(){const s=O(),i=B(s,"2782825951"),{data:a}=U(),o=v.useMemo(()=>a?.installations_without_events??[],[a]);if(o.length===0)return null;const l=he(o,i);return e.jsx("div",{className:"pt-2",children:e.jsxs("div",{className:"bg-token-bg-status-warning outline-token-border-status-warning flex items-start justify-start gap-3 self-stretch rounded-2xl p-4 outline outline-offset-[-1px]",children:[e.jsx("div",{className:"text-token-text-status-warning relative h-5 w-5",children:e.jsx(F,{className:"icon-md"})}),e.jsxs("div",{className:"inline-flex flex-1 flex-col items-start justify-start gap-1",children:[e.jsx("div",{className:"text-token-text-status-warning text-sm leading-tight font-medium",children:e.jsx(n,{id:"wham.codeReviewPage.permissionsBanner.title",defaultMessage:"Action required"})}),e.jsx("div",{className:"justify-start self-stretch",children:e.jsx("p",{className:"text-token-text-status-warning text-sm leading-tight font-normal",children:o.length>1?e.jsx(n,{id:"wham.codeReviewPage.permissionsBanner.description.multiple",defaultMessage:"Some repos require updated GitHub permissions for code reviews to work"}):e.jsx(n,{id:"wham.codeReviewPage.permissionsBanner.description.single",defaultMessage:"Update your GitHub permissions to enable code reviews for <u>{installationName}</u>",values:{u:r=>e.jsx("span",{className:"underline",children:r}),installationName:o[0].account_login}})})})]}),e.jsx("div",{className:"inline-flex flex-col items-start justify-center gap-2 self-stretch",children:e.jsx(Z,{color:"secondary",icon:ee,onClick:()=>{window.open(l,"_blank")},children:e.jsx("div",{className:"text-token-interactive-label-secondary-default justify-start text-sm leading-tight",children:e.jsx(n,{id:"wham.codeReviewPage.permissionsBanner.updateButton",defaultMessage:"Update"})})})})]})})}const Re=["everyone","team","individuals","never"];function be(s){return Re.includes(s)}const ye={everyone:{globalReviewPreference:"review_everyone",reviewPreference:"team"},team:{globalReviewPreference:"review_if_enabled",reviewPreference:"team"},individuals:{globalReviewPreference:"review_if_enabled",reviewPreference:"never"},never:{globalReviewPreference:"never_review",reviewPreference:"never"}};function q(s){const i=s.global_review_preference;return i==="review_everyone"?"everyone":i==="never_review"?"never":s.review_preference==="team"?"team":"individuals"}function Ne(s,i){const a=q(s);return i==="all"?!0:a===i}function Pe({disabledInstallations:s=[],showNewReviewSettings:i=!0}){const a=L(),[o,l]=v.useState(""),r=de(o,300),[f,h]=v.useState("all"),[w,R]=v.useState("all"),c=_(),{data:b,isLoading:j,isFetching:V,fetchNextPage:G,hasNextPage:W,isFetchingNextPage:H}=ce(r.trim()),{mutate:A}=pe(),C=v.useMemo(()=>{const t=(b?.pages??[]).flatMap(u=>u.repo_review_settings).filter(Boolean);return i?w==="all"?t:t.filter(u=>Ne(u,w)):f==="enabled"?t.filter(u=>u.review_preference==="team"):t},[b,f,w,i]),g=c?["w-[50%] sm:w-[45%]","w-[40%] sm:w-[25%]","w-[10%] sm:w-[30%]"]:["w-[55%] sm:w-[80%]","w-[45%] sm:w-[20%]"],k=[{value:"everyone",title:a.formatMessage({id:"wham.codeReviewPage.teamAutomations.option.always",defaultMessage:"Everyone"}),description:a.formatMessage({id:"wham.codeReviewPage.teamAutomations.option.always.description",defaultMessage:"Run Codex on every pull request, even from contributors outside this workspace"})},{value:"team",title:a.formatMessage({id:"wham.codeReviewPage.teamAutomations.option.team",defaultMessage:"Team"}),description:a.formatMessage({id:"wham.codeReviewPage.teamAutomations.option.team.description",defaultMessage:"Only run on pull requests opened by members of this workspace"})},{value:"individuals",title:a.formatMessage({id:"wham.codeReviewPage.teamAutomations.option.individuals",defaultMessage:"Individuals"}),description:a.formatMessage({id:"wham.codeReviewPage.teamAutomations.option.individuals.description",defaultMessage:"Let users opt in with their personal settings"})}],D={value:"never",title:a.formatMessage({id:"wham.codeReviewPage.teamAutomations.option.never",defaultMessage:"Off"}),description:a.formatMessage({id:"wham.codeReviewPage.teamAutomations.option.never.description",defaultMessage:"Skip Codex reviews for this repository"})},z=[{value:"all",label:e.jsx(n,{id:"wham.codeReviewPage.teamAutomations.filter.all",defaultMessage:"All"})},{value:"everyone",label:e.jsx(n,{id:"wham.codeReviewPage.teamAutomations.filter.everyone",defaultMessage:"Everyone"})},{value:"team",label:e.jsx(n,{id:"wham.codeReviewPage.teamAutomations.filter.team",defaultMessage:"Team"})},{value:"individuals",label:e.jsx(n,{id:"wham.codeReviewPage.teamAutomations.filter.individuals",defaultMessage:"Individuals"})}];return e.jsxs("section",{className:"flex flex-col gap-4",children:[c&&e.jsxs("div",{className:"hidden flex-col gap-2 sm:flex",children:[e.jsx("p",{className:"text-sm font-medium",children:e.jsx(n,{id:"wham.codeReviewPage.teamAutomations",defaultMessage:"Repo code reviews"})}),e.jsx("p",{className:"text-token-text-secondary text-xs",children:e.jsx(n,{id:"wham.codeReviewPage.teamAutomations.description",defaultMessage:"Tell Codex when to automatically review pull requests"})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"max-w-72",children:e.jsx(te,{name:"team-automations-search",containerInputClassName:"w-full",className:"text-token-text-primary flex h-8 w-full items-center rounded-md!",ariaLabel:a.formatMessage({id:"wham.codeReviewPage.teamAutomations.searchRepoAria",defaultMessage:"Search repo"}),placeholder:a.formatMessage({id:"wham.codeReviewPage.teamAutomations.searchRepoPlaceholder",defaultMessage:"Search repo"}),type:"search",color:"search",value:o,onChange:t=>l(t.target.value)})}),i?e.jsx("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:z.map(t=>e.jsx("button",{type:"button",className:p("text-token-text-secondary bg-transparent p-0",w===t.value&&"text-token-text-primary underline"),onClick:()=>R(t.value),children:t.label},t.value))}):e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("button",{type:"button",className:p("text-token-text-secondary bg-transparent p-0",{underline:f==="all","text-token-text-primary":f==="all"}),onClick:()=>h("all"),children:e.jsx(n,{id:"wham.codeReviewPage.teamAutomations.filter.all",defaultMessage:"All"})}),e.jsx("span",{className:"text-token-text-tertiary",children:"•"}),e.jsx("button",{type:"button",className:p("text-token-text-secondary bg-transparent p-0",{underline:f==="enabled","text-token-text-primary":f==="enabled"}),onClick:()=>h("enabled"),children:e.jsx(n,{id:"wham.codeReviewPage.teamAutomations.filter.enabledOnly",defaultMessage:"Enabled only"})})]})]}),e.jsx("div",{children:e.jsxs(d.Root,{size:"compact",disableScroll:!0,fixed:!0,children:[e.jsxs(d.Header,{children:[e.jsx(d.HeaderCell,{textAlign:"left",className:g[0],children:e.jsx(n,{id:"wham.codeReviewPage.teamAutomations.table.repository",defaultMessage:"Repository"})}),e.jsx(d.HeaderCell,{textAlign:"left",className:g[1],children:e.jsx(n,{id:"wham.codeReviewPage.teamAutomations.table.codeReview",defaultMessage:"Code review"})}),c&&e.jsx(d.HeaderCell,{textAlign:"left",className:p(g[2],"hidden sm:table-cell"),children:e.jsx(n,{id:"wham.codeReviewPage.teamAutomations.table.lastUpdated",defaultMessage:"Last updated"})})]}),e.jsxs(d.Body,{children:[j?Array.from({length:6}).map((t,u)=>e.jsxs(d.Row,{children:[e.jsx(d.Cell,{className:p(g[0],"min-w-0"),children:e.jsxs("div",{className:"flex min-w-0 items-center gap-2",children:[e.jsx(N,{className:"h-4 w-4 rounded"}),e.jsx(N,{className:"h-4 w-48"})]})}),e.jsx(d.Cell,{textAlign:"left",className:p(g[1],"min-w-0"),children:e.jsx(N,{className:p("h-6 rounded-md",i?"w-40":"w-10")})}),c&&e.jsx(d.Cell,{textAlign:"left",className:p(g[2],"min-w-0"),children:e.jsx(N,{className:"h-4 w-32"})})]},`skeleton-${u}`)):C.length===0&&!V?e.jsx(d.Row,{children:e.jsx(d.Cell,{colSpan:c?3:2,className:"text-token-text-tertiary",textAlign:"left",children:e.jsx(n,{id:"wham.codeReviewPage.teamAutomations.noRepositories",defaultMessage:"No repositories"})})}):C.map(t=>{const u=t.repository.owner?.login,P=u?s.includes(u):!1,$=e.jsx(se,{"aria-label":a.formatMessage({id:"wham.codeReviewPage.teamAutomations.toggleRepoCodeReviewAria",defaultMessage:"Toggle code review for repository"}),checked:t.review_preference==="team",disabled:P,onCheckedChange:x=>{const y=x?"team":"never";A({repo_review_settings:[{repository:t.repository.id,review_preference:y}]})}}),M=q(t),S=M==="never"?[...k,D]:k,K=S.find(x=>x.value===M),Q=e.jsxs(m.Root,{value:M,onValueChange:x=>{if(!be(x))return;const y=ye[x];A({repo_review_settings:[{repository:t.repository.id,review_preference:y.reviewPreference,global_review_preference:y.globalReviewPreference}]})},disabled:P,children:[e.jsxs(m.Trigger,{className:"w-full max-w-[260px] min-w-[100px] justify-between sm:max-w-[300px]",children:[e.jsx("div",{className:"truncate text-sm font-normal",children:K?.title}),e.jsx(m.Icon,{})]}),e.jsx(m.Portal,{children:e.jsx(m.Content,{className:"max-w-[340px] min-w-[220px]","data-unbound-width":"",children:S.map(x=>e.jsx(m.Item,{value:x.value,className:"items-start",children:e.jsxs("div",{className:"flex min-w-[220px] flex-col gap-1",children:[e.jsx("span",{className:"text-sm font-normal",children:x.title}),e.jsx("span",{className:"text-token-text-tertiary text-xs whitespace-normal",children:x.description})]})},x.value))})})]}),E=i?Q:$,J=P?e.jsx(I,{label:e.jsx(n,{id:"wham.codeReviewPage.teamAutomations.repoDisabledTooltip",defaultMessage:"Update the {installation} GitHub installation to enable code review",values:{installation:u}}),children:E}):E;return e.jsxs(d.Row,{children:[e.jsx(d.Cell,{className:p(g[0],"min-w-0"),children:e.jsxs("div",{className:"flex min-w-0 items-center gap-2",children:[e.jsx(ue,{className:"icon-md shrink-0"}),e.jsx("p",{className:"truncate text-sm",children:t.repository.repository_full_name})]})}),e.jsx(d.Cell,{textAlign:"left",className:p(g[1],"min-w-0"),children:e.jsx("div",{className:"flex w-full min-w-0 items-center justify-end sm:justify-start",children:J})}),c&&e.jsx(d.Cell,{textAlign:"left",className:p(g[2],"min-w-0"),children:t.updated_at&&t.last_updated_user_email&&e.jsxs("div",{className:"flex min-w-0 items-center text-xs sm:text-sm",children:[e.jsxs("div",{className:"hidden min-w-0 sm:flex sm:items-center sm:gap-2",children:[e.jsx("span",{className:"whitespace-nowrap",children:e.jsx(T,{value:new Date(t.updated_at),year:"numeric",month:"short",day:"2-digit"})}),e.jsx("p",{className:"text-token-text-secondary truncate",children:e.jsx(n,{id:"wham.codeReviewPage.teamAutomations.lastUpdatedBy",defaultMessage:"by {email}",values:{email:t.last_updated_user_email}})})]}),e.jsx(I,{className:"sm:hidden",label:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs",children:e.jsx(T,{value:new Date(t.updated_at),year:"numeric",month:"short",day:"2-digit"})}),e.jsx("span",{className:"text-xs",children:e.jsx(n,{id:"wham.codeReviewPage.teamAutomations.lastUpdatedBy",defaultMessage:"by {email}",values:{email:t.last_updated_user_email}})})]}),labelTextAlign:"left",labelClassName:"text-xs",align:"start",children:e.jsx(F,{className:"icon-sm text-token-text-secondary shrink-0"})})]})})]},t.repository.id)}),!j&&e.jsx(d.Row,{children:e.jsx(d.Cell,{colSpan:c?3:2,className:"!border-b-0!",textAlign:"left",children:e.jsx(xe,{isFetchingNextPage:!!H,hasNextPage:!!W,fetchNextPage:()=>G(),bgColor:"bg-transparent"})})})]})]})})]})}function Me(){const{data:s,isLoading:i,isError:a}=me(),{mutate:o,isPending:l}=fe(),r=_(),f=O(),h=s?.code_review_preference==="repo_default"||r,w=B(f,"917648193"),R=i||a||!s,{data:c}=U(),b=v.useMemo(()=>c?.installations_without_events??[],[c]);return e.jsx(le,{topPadding:!0,children:e.jsxs("div",{className:"mx-auto flex h-full max-w-screen-xl flex-1 flex-col gap-2 ps-4 pe-12",children:[e.jsx("div",{className:"border-token-border-heavy flex items-center justify-between border-b pb-2",children:e.jsx("p",{className:"flex items-center gap-2 align-middle text-xl leading-7 font-medium",children:e.jsx(n,{id:"wham.codeReviewPage.header",defaultMessage:"Code review"})})}),e.jsx(je,{}),e.jsx(ve,{}),R?e.jsx("div",{className:"flex items-center justify-center pt-2",children:e.jsx(ae,{className:"icon me-1.5"})}):e.jsxs("div",{className:"flex flex-col gap-4 pt-2 pb-4",children:[e.jsx(ge,{isSaving:l,initialScope:s.code_review_preference,onChange:j=>{o({codeReviewPreference:j})},showNewReviewSettings:w}),e.jsx("div",{className:"bg-token-border-default h-px"}),h&&e.jsx(Pe,{disabledInstallations:b.map(j=>j.account_login),showNewReviewSettings:w})]})]})})}const $e=()=>[{title:"Codex"}],Ke=ie(function(){return oe()?e.jsx(Me,{}):e.jsx(ne,{})});export{Ke as default,$e as meta};
//# sourceMappingURL=mzmozu7ezv1u7odu.js.map
