import{r,j as t,M as y}from"./m60bpb0x3x7rg8fj.js";import{ab as H,hp as I,fx as B,fh as G,g as K,T as L,pS as R,iO as z,as as J,P as h,d0 as O,ed as U,du as V,hY as D,B as E,bF as W,dC as Y}from"./lgw4q0e8zlqqfgug.js";import{fJ as $,fK as Q}from"./ggjzadbnd3k1vu0k.js";import{E as X}from"./idueivhrpfwkhmli.js";function Z({initialText:i,clientThreadId:a,currentLeaf:c,onExitEdit:l,onRequestCompletion:p,disabled:T,attachments:o}){const[d,j]=r.useState(i??""),g=r.useRef(null),k=H(),x=I.useStore(),u=d.trim()==="",v=B(),M=r.useCallback(e=>{j(e.currentTarget.value)},[]),f=r.useCallback(e=>{if(u)return;const s={},n=G();o&&(s.attachments=o),n&&(s.__internal={search_settings:n});const S=x.getActiveSystemHintType(),{systemHints:P,extraStreamParams:w}=$(S?[S]:[]),C=K(a),A=L.getParentNode(C,c).message.id,{composerThinkingEffort$:_}=R(v),F=z(_);p({sourceEvent:e,parentMessageId:A,promptMessage:J(d,Object.keys(s).length>0?s:void 0),extraStreamParams:w,completionMetadata:{conversationMode:C?.mode,systemHints:P},thinkingEffort:F}),l(),h.logEvent("Change Active Node",{intent:"edit_save"})},[u,o,a,x,p,l,c,d,v]),m=r.useCallback(()=>{O(a,e=>{U.setCurrentBranch(e,c)}),h.logEvent("Change Active Node",{intent:"edit_cancel"}),l(),h.logEvent("Cancel Edit Prompt",{threadId:V(a)})},[c,l,a]);r.useEffect(()=>{const e=g.current;if(e){e.focus();const s=e.value.length;e.setSelectionRange(s,s)}},[]),r.useEffect(()=>{const e=g.current,s=n=>{n.isComposing||(n.key==="Enter"&&n.metaKey?f(n):n.key==="Escape"&&m())};return e&&e.addEventListener("keydown",s),()=>{e&&e.removeEventListener("keydown",s)}},[m,f]);const b=o&&o.length>0&&t.jsx(q,{children:o.map(e=>t.jsx(Q,{width:k?"wide":"normal",file:e.name,contextConnectorInfo:D(e.context_connector_info)},e.id))}),N=t.jsx("div",{className:"m-2 max-h-[25dvh] overflow-auto",children:t.jsx(X,{ref:g,value:d,onChange:M,className:"m-0 w-full resize-none border-0 bg-transparent focus:ring-0 focus-visible:ring-0"})});return t.jsxs("div",{className:"bg-token-main-surface-tertiary rounded-3xl px-3 py-3",children:[b,N,t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx(E,{as:"button",color:"secondary",onClick:m,children:t.jsx(y,{id:"D9gbPp",defaultMessage:"Cancel"})}),t.jsx(E,{as:"button",onClick:f,disabled:T||u,children:t.jsx(y,{id:"KGxIJG",defaultMessage:"Send"})})]})]})}const q=W.div`flex gap-2 flex-wrap`;function oe({message:i,...a}){return t.jsx(Z,{currentLeaf:i.id,initialText:Y(i),attachments:i.metadata?.attachments,...a})}export{oe as TextMessageEditor};
//# sourceMappingURL=k5ixj5zxhhfwyfyk.js.map
