const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/hg4cf4xjdtnguqel.js","assets/m60bpb0x3x7rg8fj.js","assets/ggjzadbnd3k1vu0k.js","assets/lgw4q0e8zlqqfgug.js","assets/root-otc54kct.css","assets/conversation-small-j0gcsxmz.css","assets/ofmk3rqjad14dft0.js"])))=>i.map(i=>d[i]);
import{R as b,e as v,bb as N,p as L,b_ as W,aC as M,dC as B,fc as C,aA as G,bE as D,b2 as K,du as V,z as E,B as S,u as z,d as w,nd as Q,H,P as T,b$ as Y,d0 as k,ed as A,bC as X}from"./lgw4q0e8zlqqfgug.js";import{r as y,h as O,u as $,j as t,M as u,i as J}from"./m60bpb0x3x7rg8fj.js";import{fy as Z,fz as ee,a_ as te,bC as oe,fA as ne,fB as se,cW as re}from"./ggjzadbnd3k1vu0k.js";import{S as ie}from"./kkey60aa7xfma56e.js";import"./ofmk3rqjad14dft0.js";const j="memories/current_memory_undo_id",U={async getCurrentMemoryUndoId(o){return await b.safeGet("/memories/current_memory_undo_id",{parameters:{query:{gizmo_id:o}}})},async undoMemoryWrite(o,e){return await b.safePost("/memories/undo_memory_write",{requestBody:{gizmo_id:o,memory_undo_id:e}})}},ae=W(()=>Y(()=>import("./hg4cf4xjdtnguqel.js"),__vite__mapDeps([0,1,2,3,4,5,6])));let R=!1;function F(o){return o.find(e=>e.author.role===M.Tool&&e.metadata?.pending_memory_info)}function de(o){return o.filter((e,n)=>{const s=o[n+1],a=s?.recipient==="assistant"&&s?.author.role===M.Tool&&s?.author.name==="bio"&&B(s).startsWith("Model set context");return e.author.role===M.Assistant&&e.recipient==="bio"&&a}).flatMap(e=>{const n=e.content.content_type;return n===C.Text?e.content.parts:n===C.Code?[e.content.text]:[]}).map(ge)}function le(o){return o.some(e=>e.author.role===M.Assistant&&e.recipient==="bio"&&e.status==="in_progress")}function ue(o){return o.find(n=>n.author.role===M.Tool&&n.author.name==="bio"&&n.recipient===M.Assistant)?.metadata?.current_memory_undo_id}function ce(o){const{eligible:e,isLoading:n}=ee(),s=y.useMemo(()=>o.length>0,[o]);y.useEffect(()=>{s&&e&&!n&&G.openModal(D.GlobalMemoryOnboarding)},[s,e,n])}function me(o){const[e,n]=y.useState(!1);return{isPopoverOpen:e,setIsPopoverOpen:n,handleTogglePopover:r=>{const a=r??!e;n(a),a&&T.logEvent("Memory Update Popover Shown",{updateCount:o.length})}}}function I({memoryWrites:o,popoverState:e,triggerButton:n,isParagen:s,gizmoId:r,memoryUndoId:a,setShowMemoriesModal:l}){return t.jsxs(se,{open:e.isPopoverOpen,sideOffset:4,side:"bottom",alignAgainstAnchor:"start",size:"none",className:"z-10 max-w-96 min-w-60 text-sm",onOpenChange:i=>e.handleTogglePopover(i),disableAutofocus:!0,triggerButton:n,children:[t.jsx("div",{className:"border-token-border-default bg-token-main-surface-secondary mb-2 rounded-sm border",children:o.map((i,d)=>t.jsx("div",{className:"border-token-border-default border-b px-3 py-2 first-letter:uppercase last:border-b-0",children:i},d))}),s?t.jsx("div",{className:"text-token-text-tertiary text-xs",children:t.jsx(u,{id:"MemoryActionResult.paragenMessage",defaultMessage:"This memory will be saved if you choose this response."})}):t.jsxs(t.Fragment,{children:[t.jsx(pe,{gizmoId:r,memoryUndoId:a}),t.jsx(q,{onClick:()=>{l(!0),T.logEvent("Memory Update Popover Manage Button Clicked",{updateCount:o.length})},children:t.jsx(u,{id:"MemoryActionResult.manageMemories",defaultMessage:"Manage"})})]})]})}function fe({clientThreadId:o,pendingMessage:e,memoryWrites:n,popoverState:s,setShowMemoriesModal:r}){const a=K(),l=V(o),i=te({clientThreadId:o}),d=n.join(" ");let h=d.slice(0,50).replace(new RegExp("^\\p{L}","u"),m=>m.toLocaleUpperCase()).replace(/\.$/,"");d.length>50&&(h+="...");const p=async m=>{if(!l)throw new Error("Failed to confirm or reject memory update: serverThreadId is not found");const c=e.metadata?.pending_memory_info;k(o,f=>{A.updateTree(f,g=>{g.updateNodeMessageMetadata(e.id,{pending_memory_info:{...c,is_pending:!1,confirm_result:m}})})});try{await b.safePost("/memories/confirm_or_reject",{requestBody:{message_id:e.id,conversation_id:l,is_confirm:m},authOption:X.SendIfAvailable})}catch{a.danger({id:"memory.confirmOrDenyFail",defaultMessage:"Failed to confirm or reject memory update",description:"Error message when confirming or rejecting memory update fails"},{toastId:"memory_confirm_or_deny_fail"}),k(o,g=>{A.updateTree(g,_=>{_.updateNodeMessageMetadata(e.id,{pending_memory_info:c})})})}};return t.jsxs("div",{className:"flex items-start",children:[t.jsx("div",{className:"text-token-text-tertiary inline-block text-sm font-semibold outline-hidden",children:t.jsx(u,{id:"MemoryActionResult.memoryConfirmation",defaultMessage:"Update memory? {memoryText}",values:{memoryText:t.jsx("div",{className:"inline-block py-1",onMouseOver:()=>s.handleTogglePopover(!0),onMouseOut:()=>s.handleTogglePopover(!1),children:t.jsx(I,{memoryWrites:n,popoverState:s,triggerButton:t.jsx("button",{className:E("text-start font-normal",s.isPopoverOpen?"text-token-text-secondary":"text-token-text-tertiary"),children:t.jsx(u,{id:"MemoryActionResult.memoryWrapper",defaultMessage:"“{memoryWrites}”",values:{memoryWrites:h}})}),setShowMemoriesModal:r})})}})}),t.jsx(S,{className:"text-token-text-tertiary hover:text-token-text-primary ms-3",size:"small",color:"secondary",disabled:i,onClick:()=>{p(!0)},children:t.jsx(u,{id:"MemoryActionResult.confirm",defaultMessage:"Yes"})}),t.jsx(S,{className:"text-token-text-tertiary hover:text-token-text-primary ms-2",size:"small",color:"secondary",disabled:i,onClick:()=>{p(!1)},children:t.jsx(u,{id:"MemoryActionResult.deny",defaultMessage:"No"})})]})}function ye({memoryWrites:o,popoverState:e,isParagen:n,memoryUndoId:s,gizmoId:r,setShowMemoriesModal:a,showTooltip:l}){const i=oe(),{eligible:d,markAsViewed:h,isLoading:p}=z(w.hasSeenMemoryUpdatedTooltip),m=!Q(),[c,f]=y.useState(!1),g=v(),x=H(g)?.hasPlusFeatures();return y.useEffect(()=>{!p&&d&&i&&l===!0&&!R?(f(!0),R=!0):!p&&!d&&f(!1)},[l,p,d,i]),o.length===0?null:t.jsxs("div",{className:"flex items-center",children:[t.jsx(ne,{announcementKey:w.hasSeenMemoryUpdatedTooltip,show:c,onDismiss:()=>{h(),T.logEventWithStatsig("Memory Updated Tooltip Dismissed","memory_updated_tooltip_dismissed")},dismissOnOutsideClick:!0,side:m?"bottom":"left",sideOffset:4,theme:"bright",badge:"none",title:t.jsx(u,{id:"MoonshineV2Tooltip.heading",defaultMessage:"Memory in ChatGPT has changed"}),description:t.jsxs(t.Fragment,{children:[x?t.jsx(u,{id:"MoonshineV2Tooltip.description",defaultMessage:"ChatGPT can now reference all chats, but you can still manage individual saved memories."}):t.jsx(u,{id:"MoonshineV2Tooltip.description.freeMoonshine",defaultMessage:"ChatGPT can now reference recent chats, but you can still manage individual saved memories."}),t.jsx("br",{}),t.jsx("a",{href:"https://help.openai.com/en/articles/10303002-how-does-memory-use-past-conversations",target:"_blank",rel:"noopener noreferrer",className:"underline",children:t.jsx(u,{id:"MoonshineV2Tooltip.learnMoreLink",defaultMessage:"Learn more"})},"learn-more-link")]}),children:t.jsx("div",{style:{width:1,height:1}})}),t.jsx("div",{className:"inline-block",onMouseOver:()=>e.handleTogglePopover(!0),onMouseOut:()=>e.handleTogglePopover(!1),children:t.jsx(I,{memoryWrites:o,popoverState:e,isParagen:n,gizmoId:r,memoryUndoId:s,triggerButton:t.jsxs("button",{className:E("my-1 flex items-center gap-1 text-sm font-semibold outline-hidden",e.isPopoverOpen?"text-token-text-secondary":"text-token-text-tertiary"),children:[t.jsx(ie,{className:"mb-[-1px]"}),o.length===1?t.jsx(u,{id:"MemoryActionResult.memoryWriteSingular.New",defaultMessage:"Updated saved memory"}):t.jsx(u,{id:"MemoryActionResult.memoryWritePlural.New",defaultMessage:"Updated saved memories"})]}),setShowMemoriesModal:a})})]})}function he(o){const e=F(o),n=e?.metadata?.pending_memory_info?.confirm_result;return e==null?null:n===!0?"confirmed":n===!1?"denied":"pending"}function ve({messages:o,clientThreadId:e,gizmoId:n,isParagen:s}){const r=de(o),a=me(r),l=le(o),i=ue(o);ce(r);const d=F(o),h=v(),m=N(h,"3983984123").get("is_memory_undo_enabled",!1);L(h,"1900515849"),Z();const c=y.useRef(!1),f=O();y.useEffect(()=>{l&&c.current===!1&&(c.current=!0),!l&&!d&&i&&c.current&&f.invalidateQueries({queryKey:[j,n]})},[l,d,i,n,f]);const{data:g}=$({queryKey:[j,n],queryFn:()=>U.getCurrentMemoryUndoId(n),enabled:m&&!l&&!d}),[_,x]=y.useState(!1),P=he(o);return P==="denied"?null:t.jsxs(t.Fragment,{children:[P==="pending"?t.jsx(fe,{clientThreadId:e,memoryWrites:r,popoverState:a,setShowMemoriesModal:x,pendingMessage:d}):t.jsx(ye,{memoryWrites:r,popoverState:a,isParagen:s,memoryUndoId:g?.current_memory_undo_id===i?i:void 0,setShowMemoriesModal:x,showTooltip:c.current&&r.length>0}),_&&t.jsx(ae,{initialGizmoId:n,onClose:()=>x(!1)})]})}function q({children:o,disabled:e,onClick:n}){return t.jsxs("button",{className:"hover:bg-token-main-surface-secondary flex w-full items-center justify-between rounded-sm px-3 py-2 font-semibold",disabled:e,onClick:n,children:[o,t.jsx(re,{className:"icon text-token-text-tertiary -me-1"})]})}function pe({gizmoId:o,memoryUndoId:e}){const n=v(),r=N(n,"3983984123").get("is_memory_undo_enabled",!1),a=O(),{isPending:l,mutate:i}=J({mutationFn:d=>U.undoMemoryWrite(o,d),onSuccess:()=>{a.invalidateQueries({queryKey:[j,o]})}});return!r||!e?null:t.jsx(q,{disabled:l,onClick:()=>{e&&i(e)},children:t.jsx(u,{id:"qeyS8G",defaultMessage:"Undo"})})}function ge(o){const e=["The user ","The user's ","User ","User's "];for(const n of e)if(o.startsWith(n))return o.slice(n.length);return o}export{ve as MemoryActionResult};
//# sourceMappingURL=jz13jsb2cpb4p95t.js.map
