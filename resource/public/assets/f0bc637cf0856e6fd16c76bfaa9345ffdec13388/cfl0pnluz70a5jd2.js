import{f as y,r as m,j as e,d as U,M as A}from"./m60bpb0x3x7rg8fj.js";import{qX as W,qY as E,C as q,hn as Z,S as H,gh as B,B as P,bH as G,n9 as X,bR as ee,pE as T,e as se,aZ as $,c6 as Q,qZ as te,p as L,q_ as ne,q$ as oe,r0 as ae,r1 as re,r2 as ie,oE as J,bT as K,bV as Y,r3 as le,r4 as ce,r5 as de,r6 as me,cs as ue,c1 as pe,r7 as ge,qv as fe}from"./lgw4q0e8zlqqfgug.js";import{f3 as xe,by as he,kF as be}from"./ggjzadbnd3k1vu0k.js";import{l as Ce}from"./c2ydsdl029zi541a.js";import{f as Ne,g as je,h as Me,i as ve}from"./m4wtp6x2hm4t62ik.js";import{W as Ee}from"./lndsi22cv7zqsitq.js";import{d as Se,e as ke,c as z}from"./etw953p5af9bs5n2.js";const Re=n=>({[E.CONTEXT_CONNECTOR_GDRIVE]:{id:E.CONTEXT_CONNECTOR_GDRIVE,icon:e.jsx(ee,{className:"h-6 w-6"}),name:n.formatMessage(k.gdriveFileUploadLabel),description:n.formatMessage(k.gdriveFileUploadDescription)},[E.CONTEXT_CONNECTOR_O365_PERSONAL]:{id:E.CONTEXT_CONNECTOR_O365_PERSONAL,icon:e.jsx(X,{className:"h-6 w-6"}),name:n.formatMessage(k.onedrivePersonalFileUploadLabel),description:n.formatMessage(k.sharepointFileUploadDescription)},[E.CONTEXT_CONNECTOR_O365_BUSINESS]:{id:E.CONTEXT_CONNECTOR_O365_BUSINESS,icon:e.jsx(X,{className:"h-6 w-6"}),name:n.formatMessage(k.sharepointFileUploadLabel),description:n.formatMessage(k.sharepointFileUploadDescription)}}),V=(n,d)=>d?.get(n)?.includes(T.UseConnector)??!1,we=({platformConnectorsWithPermission:n,contextConnectorsWithPermission:d,workspaceId:i,roleId:l,onClose:a})=>{const c=y(),h=W(),u=m.useMemo(()=>Array.from(n.values()??[]).filter(t=>t.connector.status!=="DISABLED_BY_ADMIN"),[n]),b=m.useMemo(()=>{const t=[];for(const[o,f]of Object.entries(d))t.push({connector:{...Re(c)[o],kind:"context"},permissions:f});for(const o of u)t.push({connector:{...o.connector,kind:"platform"},permissions:o.permissions});return t},[u,d,c]),p=m.useMemo(()=>{const t=new Map;for(const[o,f]of n)t.set(o,f.permissions);for(const[o,f]of Object.entries(d))t.set(o,f);return t},[n,d]),[g,R]=m.useState(""),j=m.useMemo(()=>{if(!g.trim())return b;const t=g.toLowerCase();return b.filter(o=>`${o.connector.name} ${o.connector.description??""} ${o.permissions.length>0?"true on":"false off"}`.toLowerCase().includes(t))},[b,g]),v=m.useMemo(()=>[...j].sort((t,o)=>t.connector.name.localeCompare(o.connector.name)),[j]),[N,w]=m.useState(()=>new Set),{updateRoleConnectorPermission:I}=Ne({workspaceId:i,roleId:l}),O=async t=>{const f=!V(t,p);w(S=>new Set(S).add(t));try{await I({connectorId:t,permissions:f?[T.UseConnector]:[]})}finally{w(S=>{const F=new Set(S);return F.delete(t),F})}},_=({worksWith:t})=>{const o=y();return e.jsx("span",{className:"bg-token-bg-tertiary text-token-text-secondary mx-1.5 rounded-md px-1.5 py-0.5 text-xs",children:Ce(t,o)})};return e.jsx(q,{testId:"modal-configure-connectors",title:c.formatMessage(k.title),isOpen:h,onClose:a,showCloseButton:!0,size:"custom",className:"max-w-[640px]",children:e.jsxs("div",{className:"flex max-h-[80vh] flex-col gap-4",children:[e.jsx("div",{children:e.jsx(Z,{name:"search",value:g,onChange:t=>R(t.target.value),placeholder:c.formatMessage(k.searchPlaceholder,{count:b.length}),ariaLabel:c.formatMessage({id:"NWbmR6",defaultMessage:"Search connectors"})})}),e.jsx("div",{className:"text-sm font-medium",children:e.jsx(A,{id:"2m/8vc",defaultMessage:"Connectors ({count})",values:{count:j.length}})}),e.jsx("div",{className:"bg-token-main-surface flex-1 overflow-y-auto",children:v.length===0?e.jsx(Oe,{}):v.map(t=>{const o=V(t.connector.id,p),f=N.has(t.connector.id);return e.jsxs("div",{className:"flex items-center justify-between gap-3 px-4 py-3",children:[e.jsxs("div",{className:"flex min-w-0 items-center gap-3",children:[t.connector.kind==="platform"&&e.jsx(xe,{connector:t.connector,size:"small",className:"shadow-xxs h-fit rounded-[10px] border p-2"}),t.connector.kind==="context"&&e.jsx("span",{className:"h-fit rounded-xl border-[0.5px] p-2 shadow-sm",children:t.connector.icon}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1 truncate text-sm font-medium",children:[e.jsx("span",{className:"truncate",children:t.connector.name}),t.connector.kind==="context"&&e.jsx(_,{worksWith:"fileUploads"})]}),t.connector.description?e.jsx("div",{className:"text-token-text-tertiary truncate text-xs",children:t.connector.description}):null]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[f?e.jsx(H,{className:"h-4 w-4"}):null,e.jsx(B,{checked:o,onCheckedChange:()=>O(t.connector.id),disabled:f,"aria-label":c.formatMessage({id:"8ejEtk",defaultMessage:"Enable {name}"},{name:t.connector.name})})]})]},t.connector.id)})}),e.jsxs("div",{className:"flex w-full items-center",children:[v.length!==0&&e.jsx(P,{color:"primary-inverse",children:e.jsx(G,{href:"/admin/ca",className:"text-xs",children:e.jsx(A,{id:"4Szs/A",defaultMessage:"Add or manage connectors"})})}),e.jsx("div",{className:"ms-auto",children:e.jsx(P,{onClick:a,children:e.jsx(A,{id:"0NAzDq",defaultMessage:"Done"})})})]})]})})},Oe=()=>e.jsxs("div",{className:"flex min-h-[260px] flex-col items-center justify-center gap-3 p-6 text-center","aria-live":"polite",children:[e.jsx("div",{className:"grid place-items-center rounded-full border p-3",children:e.jsx(he,{className:"text-token-text-tertiary h-5 w-5","aria-hidden":!0})}),e.jsx("div",{className:"text-sm font-medium",children:e.jsx(A,{id:"kaOW76",defaultMessage:"No connectors enabled yet"})}),e.jsx(G,{href:"/admin/ca",className:"text-xs",children:e.jsx(P,{color:"primary-inverse",children:e.jsx(A,{id:"MA5e0o",defaultMessage:"Add connectors"})})})]}),k=U({title:{id:"allowedConnectorsSection.title",defaultMessage:"Configure connectors"},searchPlaceholder:{id:"allowedConnectorsSection.searchPlaceholder",defaultMessage:"Search {count} connectors (on/off)"},gdriveFileUploadLabel:{id:"allowedConnectorsSection.gdriveFileUploadLabel",defaultMessage:"Google Drive"},gdriveFileUploadDescription:{id:"allowedConnectorsSection.gdriveFileUploadDescription",defaultMessage:"Upload Google Drive files in messages sent to ChatGPT."},sharepointFileUploadLabel:{id:"allowedConnectorsSection.sharepointFileUploadLabel",defaultMessage:"Microsoft OneDrive (work/school)"},sharepointFileUploadDescription:{id:"allowedConnectorsSection.sharepointFileUploadDescription",defaultMessage:"Upload SharePoint and OneDrive for Business files in messages sent to ChatGPT."},onedrivePersonalFileUploadLabel:{id:"allowedConnectorsSection.onedrivePersonalFileUploadLabel",defaultMessage:"Microsoft OneDrive (personal)"},onedrivePersonalFileUploadDescription:{id:"allowedConnectorsSection.onedrivePersonalFileUploadDescription",defaultMessage:"Upload personal OneDrive files in messages sent to ChatGPT."}}),Te=()=>{const n=se(),d=$(),i=Q(),l=te(),a=d?.residencyRegion==="no_constraint"&&!i,c=L(n,"614413305"),h=L(n,"773249106"),u=L(n,"417039829"),b=L(n,"2509278897"),p=L(n,"3940160259"),g=L(n,"3507761600"),R=ne(),j=oe(),v=ae(),N=re(),w=ie(),{enabled:I}=J(K[Y.GITHUB_CONNECTOR]),O=d?.isCBP()??!1,_=le(),t=ce(),o=de(),f=W(),S=me();return{isCBP:O,isRbacEnabled:o,githubConnectorEnabled:I,isInSupportedDrRegion:l,isSharedProjectsEnabled:h,showAgentInternetAccessToggle:g,showHiveToggle:u,showDeepResearchToggle:p,isAppleIntelligenceToggleEnabled:a&&b,isAppleIntelligenceMdmToggleEnabled:c,includeFeatures:R,includeModels:j,includeBetaSettings:v,includeBetaSettingsAdvanced:N,includeGizmoPermissions:w,isMDMEnabled:_,includeAgentMode:t,includeConnectorPermissions:f,includeThinkingMini:S}},Ie=({ariaLabel:n,role:d,permissionName:i,handleSaveRole:l,disabled:a=!1,disabledReason:c})=>{const h=y();if(i==="codex_github_connector")return e.jsx(_e,{});const u=e.jsx(B,{size:"normal","aria-label":n,checked:d.permissions.includes(i),onCheckedChange:b=>{let p=[...d.permissions];b?p.push(i):p=p.filter(g=>g!==i),l({...d,permissions:p})},disabled:a});return a&&c?e.jsx(ue,{label:h.formatMessage(c),children:u}):u},_e=()=>{const{enabled:n}=J(K[Y.GITHUB_CONNECTOR]);return e.jsx(B,{checked:n,disabled:!0,"aria-hidden":!0})},Le="https://help.openai.com/en/articles/11750701-rbac",Xe=({role:n,onSave:d})=>{const i=y(),l=$(),a=Q(),c=Te(),{data:h}=pe((()=>{if(l==null)throw new Error("Account must not be null");const s=l.getWorkspaceId();if(s==null)throw new Error("Workspace ID must not be null");return s})()),u=W(),{permissionsBySection:b,totalPermissionsCount:p}=m.useMemo(()=>{const r=ge({isCanvasEnabled:!0,isSearchEnabled:n.permissions.includes(T.SearchAccess),isEnterprisey:l?.isEnterprisey()??!1,...c,isQuorum:a,legacyModelsEnabled:h?.beta_settings.legacy_models??!1,includeConnectorPermissions:u,isCodexEnabledInRBACRole:n.permissions.includes(T.AllowCodexAccess)}).map(x=>({...x,entries:x.entries.filter(D=>D.rbac)})).filter(x=>x.entries.length>0),M=r.flatMap(x=>x.entries).length;return{permissionsBySection:r,totalPermissionsCount:M}},[l,c,n.permissions,h?.beta_settings,u,a]),[g,R]=m.useState(""),j=b.map(s=>({...s,entries:s.entries.filter(r=>{const M=typeof r.title=="string"?r.title:i.formatMessage(r.title),x=r.description?typeof r.description=="string"?r.description:i.formatMessage(r.description,r.descriptionValues):"";return r.rbac&&([M,x].join(" ").toLowerCase().includes(g.toLowerCase())||r.permissionName.toLowerCase().includes(g.toLowerCase()))})})).filter(s=>s.entries.length>0),{toggleAllConnectorsPermissionForRole:v,isPending:N}=je({workspaceId:l?.getWorkspaceId()??""}),{connectorsWithPermission:w,isLoading:I}=Me({accountId:l?.id??"",workspaceId:l?.getWorkspaceId()??"",roleId:n.id,enabled:u}),O=Array.from(w.values()??[]).filter(s=>s.connector.status!=="DISABLED_BY_ADMIN"),_=m.useMemo(()=>[E.CONTEXT_CONNECTOR_GDRIVE,E.CONTEXT_CONNECTOR_O365_PERSONAL,E.CONTEXT_CONNECTOR_O365_BUSINESS].filter(s=>!!h?.beta_settings[s]),[h?.beta_settings]),t=ve({workspaceId:l?.getWorkspaceId()??"",roleId:n.id,connectorIds:_,enabled:u}),o=m.useMemo(()=>{const r=Array.from(O.values()??[]).filter(x=>x.permissions.includes(T.UseConnector)),M=Object.entries(t.results??{}).filter(([x,D])=>D.includes(T.UseConnector));return[...r,...M]},[O,t.results]),[f,S]=m.useState(!1),F=s=>{const r=s.permissionName,M=typeof s.title=="string"?s.title:i.formatMessage(s.title);if(s.permissionName===T.UseConnector){const x=o.length>0;return e.jsxs(e.Fragment,{children:[f&&e.jsx(we,{platformConnectorsWithPermission:w,contextConnectorsWithPermission:t.results,workspaceId:l?.getWorkspaceId()??"",roleId:n.id,onClose:()=>S(!1)}),e.jsx(z,{children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-md",children:M}),s.description&&e.jsx("span",{className:"text-token-text-tertiary text-sm",children:typeof s.description=="string"?s.description:i.formatMessage(s.description,s.descriptionValues)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[(I||N)&&e.jsx(H,{}),s.nestedKey&&(_.length>0||O.length>0)&&e.jsx("div",{className:"text-token-text-tertiary text-sm",children:e.jsx(P,{color:"primary-inverse",onClick:()=>S(!0),children:e.jsx(A,{id:"workspaceSettings.roles.selectNestedPermission",defaultMessage:"Select..."})})}),e.jsx(B,{size:"normal","aria-label":M,checked:x,onCheckedChange:D=>v({id:n.id,state:D}),disabled:N||I})]})]})},r)]})}return e.jsx(z,{children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-md",children:M}),s.description&&e.jsx("span",{className:"text-token-text-tertiary text-sm",children:typeof s.description=="string"?s.description:i.formatMessage(s.description,s.descriptionValues)})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(Ie,{ariaLabel:M,role:n,permissionName:s.permissionName,handleSaveRole:d,disabled:s.disabled,disabledReason:s.disabledReason})})]})},r)};return e.jsxs(Se,{children:[e.jsx("div",{className:"text-token-text-secondary text-sm",children:i.formatMessage(Ae.customRoleDescription,{link:s=>e.jsx(G,{className:"underline",target:"_blank",rel:"noreferrer",href:Le,children:s})})}),e.jsx("div",{className:"flex flex-row items-center justify-between",children:e.jsx(fe,{inputClassName:"w-[250px] rounded-full! text-sm",value:g,onChange:s=>{R(s.target.value)},placeholder:i.formatMessage({id:"hRuTvi",defaultMessage:"Search {count} permissions"},{count:p})})}),j.map(s=>e.jsx(Ee,{title:s.title,description:s.description,descriptionValues:s.descriptionValues,children:e.jsx(ke,{children:s.entries.map(r=>F(r))})},String(s.title.defaultMessage)))]})},Ae=U({customRoleDescription:{id:"I9hJih",defaultMessage:"Custom role permissions override workplace-level settings. A user’s effective permissions are the sum of all their assigned custom roles. Not all settings are available as role-based permissions. <link>Learn more</link>"},save:{id:"LE9GJk",defaultMessage:"Save"},searchPlaceholder:{id:"EaN6oB",defaultMessage:"Search permissions"}}),ze=({onClose:n,onSave:d,isCreate:i,defaultData:l})=>{const a=y(),[c,h]=m.useState(l?.name||""),[u,b]=m.useState(l?.description||""),[p,g]=m.useState(""),[R,j]=m.useState(!1),v=async()=>{if(!c.trim()){g(a.formatMessage(C.roleNameError));return}j(!0);try{await d({name:c,description:u}),n()}catch{}finally{j(!1)}};return e.jsx(q,{testId:"modal-upsert-role",size:"custom",className:"max-w-lg text-sm",isOpen:!0,onClose:n,showCloseButton:!0,type:"success",title:a.formatMessage(i?C.createRoleTitle:C.editRoleTitle),primaryButton:e.jsx(P,{color:"primary",onClick:()=>v(),loading:R,children:a.formatMessage(C.buttonSaveLabel)}),secondaryButton:e.jsx(P,{onClick:n,color:"secondary",children:a.formatMessage(C.buttonCancelLabel)}),children:e.jsxs("form",{className:"flex flex-col gap-6",children:[e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-sm font-medium",children:a.formatMessage(C.roleNameLabel)}),e.jsx("input",{type:"text",className:`border-token-border-primary text-token-text-primary focus:border-token-brand focus:ring-token-brand bg-token-bg-primary mt-1 block w-full rounded-md border px-3 py-2 text-sm ${p?"border-token-text-status-error":""}`,placeholder:a.formatMessage(C.roleNameLabel),value:c,onChange:N=>{h(N.target.value),g("")}}),p&&e.jsx("span",{className:"text-token-text-status-error mt-1 text-xs",children:p})]}),e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"text-sm font-medium",children:a.formatMessage(C.descriptionLabel)}),e.jsx("span",{className:"text-token-text-tertiary ms-1 text-sm font-medium",children:a.formatMessage(C.optionalLabel)}),e.jsx("input",{type:"text",className:"border-token-border-primary text-token-text-primary focus:border-token-brand focus:ring-token-brand bg-token-bg-primary mt-1 block w-full rounded-md border px-3 py-2 text-sm",placeholder:a.formatMessage(C.descriptionLabel),value:u,onChange:N=>b(N.target.value)})]}),e.jsxs("div",{className:"bg-token-bg-tertiary text-token-text-primary mb-1 flex w-full flex-row gap-4 rounded-xl p-4",children:[e.jsx(be,{className:"icon"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:a.formatMessage(C.infomationTitle)}),e.jsx("div",{className:"text-token-text-secondary",children:a.formatMessage(C.informationText)})]})]})]})})},C=U({createRoleTitle:{id:"xmlnWv",defaultMessage:"New custom role"},editRoleTitle:{id:"6A6tgB",defaultMessage:"Edit custom role"},roleNameLabel:{id:"VGBBHP",defaultMessage:"Role name"},optionalLabel:{id:"KR/EbO",defaultMessage:"(optional)"},descriptionLabel:{id:"BnuWZw",defaultMessage:"Description"},infomationTitle:{id:"L1pBDh",defaultMessage:"What's a custom role?"},informationText:{id:"DvDdnE",defaultMessage:"Roles are a great way to control which features a user can access. When assigned, the user’s permissions will be calculated as the sum of their custom roles."},buttonCancelLabel:{id:"rMxszm",defaultMessage:"Cancel"},buttonSaveLabel:{id:"JELOdt",defaultMessage:"Save"},roleNameError:{id:"iyN7K7",defaultMessage:"Role name is required"}}),Pe="role-workspace-member",Ve=n=>n.id.startsWith(Pe)&&n.predefined_role;export{Ie as P,Xe as R,ze as U,we as a,Ve as i,Te as u};
//# sourceMappingURL=cfl0pnluz70a5jd2.js.map
