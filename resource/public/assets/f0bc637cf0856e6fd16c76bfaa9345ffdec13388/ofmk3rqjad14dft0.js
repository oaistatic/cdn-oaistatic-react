import{g as ie,j as e,m as le,M as x,r as k,f as q,h as ee,u as de,i as K}from"./m60bpb0x3x7rg8fj.js";import{ps as se,pt as me,pu as ce,gX as ue,bC as re,bB as fe,aS as w,i8 as ge,aT as he,bD as xe,bE as Me,bF as ye}from"./ggjzadbnd3k1vu0k.js";import{J as ve,K as pe,cF as je,sh as be,si as Ce,sj as ke,cL as Se,gB as we,mb as Re,z as U,cs as P,gd as _e,b2 as te,B as T,P as R,C as ae,am as Q,R as N,e as Ee,H as Te,gv as Ne,oI as E,bF as qe,cd as _}from"./lgw4q0e8zlqqfgug.js";var I,W;function Ie(){if(W)return I;W=1;var s=ve(),r=pe(),o="[object RegExp]";function a(i){return r(i)&&s(i)==o}return I=a,I}var D,J;function De(){if(J)return D;J=1;var s=Ie(),r=je(),o=be(),a=o&&o.isRegExp,i=a?r(a):s;return D=i,D}var F,V;function Fe(){if(V)return F;V=1;var s=Ce(),r=s("length");return F=r,F}var L,Y;function Le(){if(Y)return L;Y=1;var s="\\ud800-\\udfff",r="\\u0300-\\u036f",o="\\ufe20-\\ufe2f",a="\\u20d0-\\u20ff",i=r+o+a,l="\\ufe0e\\ufe0f",c="["+s+"]",u="["+i+"]",y="\\ud83c[\\udffb-\\udfff]",p="(?:"+u+"|"+y+")",b="[^"+s+"]",C="(?:\\ud83c[\\udde6-\\uddff]){2}",j="[\\ud800-\\udbff][\\udc00-\\udfff]",f="\\u200d",M=p+"?",m="["+l+"]?",v="(?:"+f+"(?:"+[b,C,j].join("|")+")"+m+M+")*",t=m+M+v,g="(?:"+[b+u+"?",u,C,j,c].join("|")+")",h=RegExp(y+"(?="+y+")|"+g+t,"g");function d(n){for(var S=h.lastIndex=0;h.test(n);)++S;return S}return L=d,L}var B,Z;function Be(){if(Z)return B;Z=1;var s=Fe(),r=se(),o=Le();function a(i){return r(i)?o(i):s(i)}return B=a,B}var G,$;function Ge(){if($)return G;$=1;var s=ke(),r=me(),o=se(),a=Se(),i=De(),l=Be(),c=ce(),u=we(),y=Re(),p=30,b="...",C=/\w*$/;function j(f,M){var m=p,v=b;if(a(M)){var t="separator"in M?M.separator:t;m="length"in M?u(M.length):m,v="omission"in M?s(M.omission):v}f=y(f);var g=f.length;if(o(f)){var h=c(f);g=h.length}if(m>=g)return f;var d=m-l(v);if(d<1)return v;var n=h?r(h,0,d).join(""):f.slice(0,d);if(t===void 0)return n+v;if(h&&(d+=n.length-d),i(t)){if(f.slice(d).search(t)){var S,oe=n;for(t.global||(t=RegExp(t.source,y(C.exec(t))+"g")),t.lastIndex=0;S=t.exec(oe);)var A=S.index;n=n.slice(0,A===void 0?d:A)}}else if(f.indexOf(s(t),d)!=d){var H=n.lastIndexOf(t);H>-1&&(n=n.slice(0,H))}return n+v}return G=j,G}var ze=Ge();const Ue=ie(ze),Pe=80,O=100;function Oe(s){return s<O?"bg-[#fcf6e0] text-yellow-500 dark:bg-yellow-600 dark:text-yellow-100":"bg-[rgba(229,76,66,0.16)] text-[#DC2626] dark:bg-[rgba(202,58,49,0.16)] dark:text-[#DC2626]"}function ne(s){return ue()&&s!=null&&s>Pe}function Ae({memoryFullPct:s,className:r,children:o,showInfoLabel:a,onManageMemories:i}){return ne(s)?e.jsx("div",{className:U("border-token-border-default rounded-lg border p-1 text-sm",r),children:e.jsxs(le.div,{className:U("flex items-center overflow-hidden rounded-sm px-2 py-1.5 whitespace-nowrap",Oe(s)),initial:{width:0},animate:{width:`${s}%`},transition:{duration:.5},children:[e.jsx(x,{id:"6D2etG",defaultMessage:"{memoryFullPct}% full",values:{memoryFullPct:s}}),o,a&&e.jsx(P,{interactive:!0,label:s<O?e.jsx("div",{className:"whitespace-normal",children:e.jsx(x,{id:"gxY4wi",defaultMessage:"ChatGPT's almost out of space for new saved memories. <memoryModalLink>Manage saved memories</memoryModalLink> to create more space.",values:{memoryModalLink:c=>e.jsx("a",{href:"#",className:"cursor-pointer underline",onClick:u=>{u.preventDefault(),i?.()},children:c})}})}):e.jsx("div",{className:"whitespace-normal",children:e.jsx(x,{id:"1JxMf3",defaultMessage:"ChatGPT's out of space for saved memories. <memoryModalLink>Manage saved memories</memoryModalLink> to create more space.",values:{memoryModalLink:c=>e.jsx("a",{href:"#",className:"cursor-pointer underline",onClick:u=>{u.preventDefault(),i?.()},children:c})}})}),children:e.jsx(_e,{className:"icon-sm ms-1"})})]})}):null}function He({memoryFullPct:s,className:r}){return ne(s)?e.jsxs("div",{className:U("flex flex-col gap-2",r),children:[e.jsx(Ae,{memoryFullPct:s}),e.jsx("div",{className:"text-token-text-secondary ps-3 text-sm",children:s<O?e.jsx(x,{id:"SnInO0",defaultMessage:"<strong>Almost full.</strong> Once full, new memories won't be saved. You can remove existing memories to make room.",values:{strong:a=>e.jsx("strong",{children:a})}}):e.jsx(x,{id:"/LO3dv",defaultMessage:"<strong>Youâ€™re out of space.</strong> Remove existing memories to make room for ChatGPT to save new memories.",values:{strong:a=>e.jsx("strong",{children:a})}})})]}):null}function X({description:s,onClose:r,onConfirm:o}){const a=q();return e.jsx(ae,{testId:"modal-confirm-reset-memory",isOpen:!0,onClose:r,type:"success",title:a.formatMessage({id:"MemoriesModal.resetModalTitle",defaultMessage:"Are you sure?"}),description:s,primaryButton:e.jsx(Q.Button,{title:a.formatMessage({id:"MemoriesModal.resetModalConfirm",defaultMessage:"Clear memory"}),color:"danger",onClick:o,"data-testid":"confirm-reset-memories-button"}),secondaryButton:e.jsx(Q.Button,{title:a.formatMessage({id:"MemoriesModal.resetModalCancel",defaultMessage:"Cancel"}),color:"secondary",onClick:r})})}function Ke({onReset:s,gizmoId:r,memoryName:o}){const[a,i]=k.useState(!1),l=q(),c=te(),u=re(),y=async()=>{R.logEvent("Memory Manage Reset Button Confirmed");try{await N.safeDelete("/settings/clear_account_user_memory",{requestBody:{gizmo_id:r}}),c.success(l.formatMessage({id:"ResetMemoriesButton.resetSuccess",defaultMessage:"Memory cleared."})),s?.(),i(!1)}catch{c.danger({id:"ResetMemoriesButton.resetFailed",defaultMessage:"Failed to clear memory.",description:"Error message for the reset memory modal"},{toastId:"reset_memories_button_reset_failed"})}};return e.jsxs(e.Fragment,{children:[e.jsx(T,{color:"danger-outline",onClick:()=>{R.logEvent("Memory Manage Reset Button Clicked"),i(!0)},"data-testid":"reset-memories-button",children:r?e.jsx(x,{id:"ResetMemoriesButton.resetGizmo",defaultMessage:"Clear this GPT's memory"}):e.jsx(x,{id:"ResetMemoriesButton.resetChatGPT",defaultMessage:"Delete all"})}),a&&(u?e.jsx(X,{description:l.formatMessage({id:"MemoriesModal.resetGizmoModalDescriptionUpdated",defaultMessage:"Deleting your saved memories means {name} may not remember this information going forward. To fully remove this information from {name}'s memory, please delete any related chats. <link>Learn more</link>"},{name:o,link:p=>e.jsx("a",{className:"underline",href:"https://help.openai.com/en/articles/8983136-what-is-memory",children:p})}),onClose:()=>i(!1),onConfirm:y}):e.jsx(X,{description:l.formatMessage({id:"MemoriesModal.resetGizmoModalDescription",defaultMessage:"{name} will forget everything it has remembered from your chats. This cannot be undone."},{name:o}),onClose:()=>i(!1),onConfirm:y}))]})}function Qe({gizmo:s,memory:r}){const o=q(),a=te(),i=ee(),[l,c]=k.useState(!1),[u,y]=k.useState(r.content),p=k.useRef(null);k.useEffect(()=>{if(l&&p.current){const t=p.current,g=t.value.length;t.focus(),t.setSelectionRange(g,g)}},[l]);const{mutate:b,isPending:C}=K({mutationFn:async t=>{const{success:g}=await N.safeDelete("/memories/{memory_id}",{parameters:{path:{memory_id:t}},requestBody:{gizmo_id:s?.id}});if(!g)throw new Error("An error occurred while deleting the memory")},onSettled:()=>{i.invalidateQueries({queryKey:E(s?.id)})},onError:()=>{a.danger({id:"MemoriesModal.deleteFailed",defaultMessage:"Failed to forget memory",description:"Toast message when deleting memory fails"},{id:"memoryDeleteFailed",toastId:"memory_delete_failed"})}}),{mutate:j,isPending:f}=K({mutationFn:async()=>await N.safePatch("/memories/{memory_id}",{parameters:{path:{memory_id:r.id}},requestBody:{gizmo_id:s?.id,content:u}}),onSuccess:t=>{const{memory_max_tokens:g,memory_num_tokens:h}=t;i.setQueryData(E(s?.id),d=>{if(!d||typeof d!="object")return d;const n=d,S=Math.min(Math.floor(100*h/g),100);return{...n,memory_max_tokens:g,memory_num_tokens:h,memoryFullPct:S}}),i.invalidateQueries({queryKey:E(s?.id)}),c(!1)},onError:()=>{a.danger({id:"MemoriesModal.editFailed",defaultMessage:"Failed to update memory",description:"Toast message when editing memory fails"},{id:"memoryEditFailed",toastId:"memory_edit_failed"})}}),[M,m]=k.useState(!1),v=o.formatMessage({id:"N0czuB",defaultMessage:"Remove"});return e.jsxs(e.Fragment,{children:[e.jsx(w.Row,{disabled:C||f,children:l?e.jsxs(w.Cell,{colSpan:2,className:"relative pe-0",children:[e.jsx("input",{ref:p,autoFocus:!0,value:u,onChange:t=>y(t.target.value),className:"w-full rounded border-2 border-transparent py-2 pe-36 focus:outline-none",maxLength:500,onKeyDown:t=>{if(!t.nativeEvent.isComposing&&t.key==="Enter"){if(u.trim()===""){R.logEvent("Memory Manage Modal Memory Delete Clicked"),m(!0);return}j()}}}),e.jsxs("div",{className:"absolute end-1 top-1/2 flex -translate-y-1/2 gap-1",children:[e.jsx(T,{color:"secondary",size:"small",onClick:()=>{y(r.content),c(!1)},children:e.jsx(x,{id:"TTo8Tw",defaultMessage:"Cancel"})}),e.jsx(T,{size:"small",onClick:()=>{if(u.trim()===""){R.logEvent("Memory Manage Modal Memory Delete Clicked"),m(!0);return}j()},disabled:f,children:e.jsx(x,{id:"mDcKbU",defaultMessage:"Save"})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(w.Cell,{className:"pe-0",divClassName:"min-h-[40px] items-center w-full",children:e.jsx("div",{className:"border-2 border-transparent py-2 whitespace-pre-wrap",children:r.content})}),e.jsx(w.Cell,{textAlign:"right",children:e.jsxs(w.Actions,{children:[(()=>{const t=o.formatMessage({id:"EditableMemoriesModal.edit",defaultMessage:"Edit"});return e.jsx("button",{onClick:()=>c(!0),"aria-label":t,className:"text-token-text-tertiary hover:text-token-text-secondary",children:e.jsx(P,{label:t,side:"top",className:"leading-none",children:e.jsx(ge,{className:"icon-sm"})})})})(),e.jsx("button",{onClick:()=>{R.logEvent("Memory Manage Modal Memory Delete Clicked"),m(!0)},"aria-label":v,className:"text-token-text-tertiary hover:text-token-text-secondary",children:e.jsx(P,{className:"leading-none",label:v,side:"top",children:e.jsx(he,{className:"icon-sm"})})})]})})]})}),M&&e.jsx(xe,{isOpen:!0,primaryButtonColor:"danger",title:v,confirmText:o.formatMessage({id:"fCn0ar",defaultMessage:"Forget"}),onConfirm:()=>{R.logEvent("Memory Manage Modal Memory Delete Confirmed"),b(r.id),m(!1)},onClose:()=>{m(!1),y(r.content),c(!1)},children:e.jsx(x,{id:"j2cZHW",defaultMessage:'Remove "{title}" from {name}â€™s saved memories. This canâ€™t be undone. <link>Learn more</link>',values:{name:s?.name??"ChatGPT",title:e.jsx("strong",{children:Ue(r.content,{length:130,omission:"..."})}),link:t=>e.jsx("a",{href:"https://help.openai.com/en/articles/8590148-memory-faq",target:"_blank",className:"underline",rel:"noreferrer",children:t})}})})]})}function We({selectedGizmoId:s,onSelect:r,items:o}){const a=o.find(l=>l.id===s);function i(l){return e.jsx(ye,{isFirstParty:l.id===void 0,src:l.iconUrl??null,className:"icon"})}return e.jsx("div",{className:"border-token-border-medium mb-2 inline-flex rounded-md border",children:e.jsxs(_.Root,{children:[e.jsx(_.Trigger,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[a?e.jsxs(e.Fragment,{children:[i(a),e.jsx("span",{className:"text-token-text-primary",children:a.name})]}):e.jsx(x,{id:"MemoriesModal.unknownGizmo",defaultMessage:"Unknown GPT"}),e.jsx(Me,{className:"icon-sm text-token-text-tertiary"})]})}),e.jsx(_.Portal,{children:e.jsx(_.Content,{children:o.map(l=>e.jsxs(_.Item,{className:"flex items-center gap-3",onClick:()=>{r(l.id)},children:[i(l),l.name]},l.id))})})]})})}const z=qe.div`flex h-full items-center justify-center pb-8 text-sm text-token-text-tertiary rounded-lg border border-token-border-default`;function Ze({onClose:s,initialGizmoId:r}){const o=q(),a=ee(),i=fe(),[l,c]=k.useState(r),u=Ee(),p=Te(u)?.hasPlusFeatures(),b=re();k.useEffect(()=>{R.logEvent("Memory Modal Shown")},[]);const{data:C,isLoading:j,isError:f,refetch:M}=Ne(l,!0,i),m=C?.memories,{data:v,refetch:t}=de({queryKey:["memory_gizmos"],queryFn:()=>N.safeGet("/memories/gizmos"),refetchOnMount:"always"}),g=[{id:void 0,name:"ChatGPT",iconUrl:null},...v?.items.map(({gizmo:n})=>({id:n.id,name:n.display.name,iconUrl:n.display.profile_picture_url??null}))??[]],h=g.find(n=>n.id===l);k.useEffect(()=>{!j&&!f&&l!==void 0&&(!m||m.length===0)&&c(void 0)},[j,f,m,l]);let d;return j?d=e.jsx(z,{children:e.jsx(x,{id:"MemoriesModal.loading",defaultMessage:"Loading..."})}):f?d=e.jsx(z,{children:e.jsxs("div",{className:"max-w-sm text-center",children:[e.jsx("div",{className:"mb-4 text-red-500",children:e.jsx(x,{id:"MemoriesModal.somethingWentWrong",defaultMessage:"Something went wrong..."})}),e.jsx("div",{children:e.jsx(T,{color:"secondary",onClick:()=>{M()},children:e.jsx(x,{id:"MemoriesModal.retry",defaultMessage:"Retry"})})})]})}):!m||m.length===0?d=e.jsx(z,{children:e.jsx("div",{className:"max-w-sm text-center",children:i?e.jsx(x,{id:"MemoriesModal.noMemories.1",defaultMessage:"As you chat with {name}, the details and preferences it saves will be shown here.",values:{name:h?.name??"ChatGPT"}}):e.jsx(x,{id:"MemoriesModal.noMemoriesAndDisabled",defaultMessage:"Memory is disabled. ChatGPT won't use or save memories."})})}):d=e.jsx(w.Root,{className:"h-full",size:"compact",bordered:!0,children:e.jsx(w.Body,{children:m.map(n=>e.jsx(Qe,{gizmo:h?{id:h.id,name:h.name}:void 0,memory:n},n.id))})}),e.jsxs(ae,{testId:"modal-memories",isOpen:!0,onClose:s,size:"custom",className:"max-w-5xl",type:"success",title:o.formatMessage({id:"MemoriesModal.title",defaultMessage:"Saved memories"}),description:e.jsx("div",{className:"text-token-text-secondary",children:b&&p?o.formatMessage({id:"MemoriesModal.description",defaultMessage:"ChatGPT tries to remember most of your chats, but it may forget things over time. Saved memories are never forgotten. <link>Learn more</link>"},{link:n=>e.jsx("a",{href:"https://help.openai.com/en/articles/8983136-what-is-memory",target:"_blank",rel:"noopener noreferrer",className:"underline",children:n})}):b?o.formatMessage({id:"MemoriesModal.description.freeMoonshine",defaultMessage:"ChatGPT tries to remember your recent chats, but it may forget things over time. Saved memories are never forgotten. <link>Learn more</link>"},{link:n=>e.jsx("a",{href:"https://help.openai.com/en/articles/8983136-what-is-memory",target:"_blank",rel:"noopener noreferrer",className:"underline",children:n})}):o.formatMessage({id:"MemoriesModalFree.description",defaultMessage:"ChatGPT remembers useful details about you and your preferences so it can be more helpful. <link>Learn more</link>"},{link:n=>e.jsx("a",{href:"https://help.openai.com/en/articles/8983136-what-is-memory",target:"_blank",rel:"noopener noreferrer",className:"underline",children:n})})}),showCloseButton:!0,children:[p&&g.length>1&&e.jsx("div",{className:"mb-4",children:e.jsx(We,{selectedGizmoId:l,items:g,onSelect:n=>{a.invalidateQueries({queryKey:E(n)}),c(n)}})}),e.jsx(He,{memoryFullPct:C?.memoryFullPct,className:"mb-5"}),e.jsx("div",{className:"h-[24rem]",children:d}),e.jsx("div",{className:"mt-5 flex justify-end",children:e.jsx(Ke,{onReset:()=>{M(),t(),l&&c(void 0)},gizmoId:l,memoryName:h?.name??"ChatGPT"})})]})}export{Ze as E,He as M,Ke as R,Ae as a,Ue as t};
//# sourceMappingURL=ofmk3rqjad14dft0.js.map
