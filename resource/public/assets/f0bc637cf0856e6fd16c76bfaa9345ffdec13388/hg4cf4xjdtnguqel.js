import{f as P,h as T,r as y,u as R,j as e,M as l,i as I}from"./m60bpb0x3x7rg8fj.js";import{bB as _,bC as B,aS as u,aT as L,bD as q,bE as z,bF as A}from"./ggjzadbnd3k1vu0k.js";import{e as Q,H as O,P as w,gv as U,C as K,oI as G,B as W,bF as H,b2 as Z,R as S,cs as J,cd as g}from"./lgw4q0e8zlqqfgug.js";import{M as V,R as X,t as Y}from"./ofmk3rqjad14dft0.js";function $({gizmo:a,memory:n}){const r=P(),o=Z(),i=T(),{mutate:s,isPending:h}=I({mutationFn:async m=>{const{success:j}=await S.safeDelete("/memories/{memory_id}",{parameters:{path:{memory_id:m}},requestBody:{gizmo_id:a?.id}});if(!j)throw new Error("An error occurred while deleting the memory")},onSettled:()=>{i.invalidateQueries({queryKey:G(a?.id)})},onError:()=>{o.danger({id:"MemoriesModal.deleteFailed",defaultMessage:"Failed to forget memory",description:"Toast message when deleting memory fails"},{id:"memoryDeleteFailed",toastId:"memory_delete_failed"})}}),[p,d]=y.useState(!1),f=r.formatMessage({id:"N0czuB",defaultMessage:"Remove"});return e.jsxs(e.Fragment,{children:[e.jsxs(u.Row,{disabled:h,children:[e.jsx(u.Cell,{children:e.jsx("div",{className:"py-2 whitespace-pre-wrap",children:n.content})}),e.jsx(u.Cell,{textAlign:"right",children:e.jsx(u.Actions,{children:e.jsx("button",{onClick:()=>{w.logEvent("Memory Manage Modal Memory Delete Clicked"),d(!0)},"aria-label":f,className:"text-token-text-tertiary hover:text-token-text-secondary",children:e.jsx(J,{className:"leading-none",label:f,side:"top",children:e.jsx(L,{className:"icon-sm"})})})})})]}),p&&e.jsx(q,{isOpen:!0,primaryButtonColor:"danger",title:f,confirmText:r.formatMessage({id:"fCn0ar",defaultMessage:"Forget"}),onConfirm:()=>{w.logEvent("Memory Manage Modal Memory Delete Confirmed"),s(n.id),d(!1)},onClose:()=>{d(!1)},children:e.jsx(l,{id:"j2cZHW",defaultMessage:'Remove "{title}" from {name}’s saved memories. This can’t be undone. <link>Learn more</link>',values:{name:a?.name??"ChatGPT",title:e.jsx("strong",{children:Y(n.content,{length:130,omission:"..."})}),link:m=>e.jsx("a",{href:"https://help.openai.com/en/articles/8590148-memory-faq",target:"_blank",className:"underline",rel:"noreferrer",children:m})}})})]})}function ee({selectedGizmoId:a,onSelect:n,items:r}){const o=r.find(s=>s.id===a);function i(s){return e.jsx(A,{isFirstParty:s.id===void 0,src:s.iconUrl??null,className:"icon"})}return e.jsx("div",{className:"border-token-border-medium mb-2 inline-flex rounded-md border",children:e.jsxs(g.Root,{children:[e.jsx(g.Trigger,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[o?e.jsxs(e.Fragment,{children:[i(o),e.jsx("span",{className:"text-token-text-primary",children:o.name})]}):e.jsx(l,{id:"MemoriesModal.unknownGizmo",defaultMessage:"Unknown GPT"}),e.jsx(z,{className:"icon-sm text-token-text-tertiary"})]})}),e.jsx(g.Portal,{children:e.jsx(g.Content,{children:r.map(s=>e.jsxs(g.Item,{className:"flex items-center gap-3",onClick:()=>{n(s.id)},children:[i(s),s.name]},s.id))})})]})})}const C=H.div`flex h-full items-center justify-center pb-8 text-sm text-token-text-tertiary rounded-lg border border-token-border-default`;function ne({onClose:a,initialGizmoId:n}){const r=P(),o=T(),i=_(),[s,h]=y.useState(n),p=Q(),d=O(p),f=d?.hasPlusFeatures(),m=B(),j=d?.hasPaidFeatures()??!1;y.useEffect(()=>{w.logEvent("Memory Modal Shown")},[]);const{data:N,isLoading:v,isError:b,refetch:F}=U(s,!0,i),c=N?.memories,{data:E,refetch:D}=R({queryKey:["memory_gizmos"],queryFn:()=>S.safeGet("/memories/gizmos"),refetchOnMount:"always"}),k=[{id:void 0,name:"ChatGPT",iconUrl:null},...E?.items.map(({gizmo:t})=>({id:t.id,name:t.display.name,iconUrl:t.display.profile_picture_url??null}))??[]],x=k.find(t=>t.id===s);y.useEffect(()=>{!v&&!b&&s!==void 0&&(!c||c.length===0)&&h(void 0)},[v,b,c,s]);let M;return v?M=e.jsx(C,{children:e.jsx(l,{id:"MemoriesModal.loading",defaultMessage:"Loading..."})}):b?M=e.jsx(C,{children:e.jsxs("div",{className:"max-w-sm text-center",children:[e.jsx("div",{className:"mb-4 text-red-500",children:e.jsx(l,{id:"MemoriesModal.somethingWentWrong",defaultMessage:"Something went wrong..."})}),e.jsx("div",{children:e.jsx(W,{color:"secondary",onClick:()=>{F()},children:e.jsx(l,{id:"MemoriesModal.retry",defaultMessage:"Retry"})})})]})}):!c||c.length===0?M=e.jsx(C,{children:e.jsx("div",{className:"max-w-sm text-center",children:i?e.jsx(l,{id:"MemoriesModal.noMemories.1",defaultMessage:"As you chat with {name}, the details and preferences it saves will be shown here.",values:{name:x?.name??"ChatGPT"}}):e.jsx(l,{id:"MemoriesModal.noMemoriesAndDisabled",defaultMessage:"Memory is disabled. ChatGPT won't use or save memories."})})}):M=e.jsx(u.Root,{className:"h-full",size:"compact",bordered:!0,children:e.jsx(u.Body,{children:c.map(t=>e.jsx($,{gizmo:x?{id:x.id,name:x.name}:void 0,memory:t},t.id))})}),e.jsxs(K,{testId:"modal-memories",isOpen:!0,onClose:a,size:"custom",className:"max-w-5xl",type:"success",title:r.formatMessage({id:"MemoriesModal.title",defaultMessage:"Saved memories"}),description:e.jsx("div",{className:"text-token-text-secondary",children:m&&j?r.formatMessage({id:"MemoriesModal.description",defaultMessage:"ChatGPT tries to remember most of your chats, but it may forget things over time. Saved memories are never forgotten. <link>Learn more</link>"},{link:t=>e.jsx("a",{href:"https://help.openai.com/en/articles/8983136-what-is-memory",target:"_blank",rel:"noopener noreferrer",className:"underline",children:t})}):m?r.formatMessage({id:"MemoriesModal.description.freeMoonshine",defaultMessage:"ChatGPT tries to remember your recent chats, but it may forget things over time. Saved memories are never forgotten. <link>Learn more</link>"},{link:t=>e.jsx("a",{href:"https://help.openai.com/en/articles/8983136-what-is-memory",target:"_blank",rel:"noopener noreferrer",className:"underline",children:t})}):r.formatMessage({id:"MemoriesModalFree.description",defaultMessage:"ChatGPT remembers useful details about you and your preferences so it can be more helpful. <link>Learn more</link>"},{link:t=>e.jsx("a",{href:"https://help.openai.com/en/articles/8983136-what-is-memory",target:"_blank",rel:"noopener noreferrer",className:"underline",children:t})})}),showCloseButton:!0,children:[f&&k.length>1&&e.jsx("div",{className:"mb-4",children:e.jsx(ee,{selectedGizmoId:s,items:k,onSelect:t=>{o.invalidateQueries({queryKey:G(t)}),h(t)}})}),e.jsx(V,{memoryFullPct:N?.memoryFullPct,className:"mb-5"}),e.jsx("div",{className:"h-[24rem]",children:M}),e.jsx("div",{className:"mt-5 flex justify-end",children:e.jsx(X,{onReset:()=>{F(),D(),s&&h(void 0)},gizmoId:s,memoryName:x?.name??"ChatGPT"})})]})}export{ne as default};
//# sourceMappingURL=hg4cf4xjdtnguqel.js.map
