const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/nnmb8mvff9a0x24u.js","assets/m60bpb0x3x7rg8fj.js","assets/lgw4q0e8zlqqfgug.js","assets/root-otc54kct.css","assets/fb0dh9wkzl7dq8ds.js","assets/joa8jajuiu4xqpzn.js"])))=>i.map(i=>d[i]);
import{dK as M,z as _,ap as R,gS as x,gR as j,nh as P,fc as F,f4 as L,aa as O,b2 as W,b_ as H,b$ as V,T as G}from"./lgw4q0e8zlqqfgug.js";import{r as c,j as n,M as b,m as U,h as z,f as q,p as K}from"./m60bpb0x3x7rg8fj.js";import{F as Q}from"./j4imjyyfxliz5sk5.js";import{cG as Z,cW as $,jo as B,k6 as J,cN as I,cO as A,k7 as X,k8 as Y,k9 as ee,ka as te,fe as ne,iE as se}from"./ggjzadbnd3k1vu0k.js";import"./haz15z4nq3d0dq7v.js";import"./mlqzrqe1i57m6im6.js";import"./d4l47j95cc16bbv9.js";import"./mlo67gs1ylzshmge.js";import"./h81zqbvh0a7amk0o.js";import"./l9bupap4fyh5egbo.js";import"./dgb06x9f8z6d0ar9.js";import"./jobqnbdildqzowzf.js";import"./ls4akj6tri7bc2dz.js";import"./glu06a3y5u0laqff.js";import"./iayy5u2a26jybmdr.js";import"./gohr301ka7cpfe4s.js";import"./hg4s4237azdb5era.js";import"./kfjcy5y4cxuymbdf.js";import"./rx5cs0ja7c7phupc.js";import"./n5yj38pa2aamrsfp.js";import"./ccw262xxu17g34lw.js";import"./hbir13mtq07o9x1a.js";import"./o53bheyqocotqvus.js";import"./dfbgvqz3f2t2gfhn.js";import"./hzuwclo1fy1q03ik.js";import"./hb68k3oakb3tiftg.js";import"./nn6a4342otoakkr2.js";function ae(){const[e,s]=c.useState({undoStack:[],currentIndex:-1});function a(t){s(r=>({undoStack:[...r.undoStack.slice(0,r.currentIndex+1),t],currentIndex:r.currentIndex+1}))}function d(){s(t=>({undoStack:t.undoStack,currentIndex:Math.max(t.currentIndex-1,-1)}))}function o(){s(t=>({undoStack:t.undoStack,currentIndex:Math.min(t.currentIndex+1,t.undoStack.length-1)}))}function i(){s({undoStack:[],currentIndex:-1})}return{currentDrawnShape:e.undoStack.length>0?e.undoStack[e.currentIndex]:null,onNewDrawnShape:a,canUndoDrawing:e.currentIndex>=0,undoDrawing:d,canRedoDrawing:e.currentIndex<e.undoStack.length-1,redoDrawing:o,clearAllDrawings:i}}function oe({mode:e,imageIndex:s,allImages:a,onSwitchImage:d,isLoadingNewImage:o}){const i=s>0,t=c.useCallback(()=>{i&&d(a[s-1])},[i,a,s,d]),r=s<a.length-1,l=c.useCallback(()=>{r&&d(a[s+1])},[r,a,s,d]);return c.useEffect(()=>{function f(u){u.target instanceof HTMLTextAreaElement||e==="default"&&(u.key==="ArrowLeft"?t():u.key==="ArrowRight"&&l())}return document.addEventListener("keydown",f),()=>{document.removeEventListener("keydown",f)}},[e,t,l]),n.jsx("div",{className:"text-token-text-secondary flex h-16 w-full items-center justify-center gap-3 font-semibold",children:e==="inpaint"?!o&&n.jsxs("div",{className:"flex items-center gap-1.5",children:[n.jsx(b,{id:"imageEditor.selectArea",defaultMessage:"Select an area to edit"}),n.jsx("a",{href:"https://help.openai.com/en/articles/9055440",target:"_blank",rel:"noreferrer",children:n.jsx(M,{className:"icon"})})]}):a.length>1?n.jsxs(n.Fragment,{children:[n.jsx("button",{disabled:!i,className:"disabled:text-token-text-tertiary",onClick:t,children:n.jsx(Z,{className:"icon"})}),n.jsx("div",{children:n.jsx(b,{id:"imageEditor.imageNumber",defaultMessage:"Image {num} of {numImages}",values:{num:s+1,numImages:a.length}})}),n.jsx("button",{disabled:!r,className:"disabled:text-token-text-tertiary",onClick:l,children:n.jsx($,{className:"icon"})})]}):null})}const ie=0,re=64;function ce({imageAsset:e,children:s,containerDimensions:a,isLoadingNewImage:d}){return n.jsxs(U.div,{className:"absolute",style:de(e,a),...B,children:[s,n.jsx("div",{className:_("bg-token-main-surface-primary absolute inset-0 flex items-center justify-center transition-opacity duration-1000",d?"pointer-events-auto opacity-60":"pointer-events-none opacity-0")})]})}function de(e,s){const{width:a,height:d}=e,{width:o,height:i}=s,t=o-2*ie,r=i-2*re,l=a/d,f=t/r,u=l>f,p=u?t:r*l,g=u?t/l:r,h=(i-g)/2,k=(o-p)/2;return{top:h,left:k,width:p,height:g}}const ue=H(()=>V(()=>import("./nnmb8mvff9a0x24u.js"),__vite__mapDeps([0,1,2,3,4,5])).then(e=>e.DynamicDrawingCanvas));function We({clientThreadId:e,messageId:s,image:a,allImages:d}){const o=R(e,G.getCurrentNode),i=[x.Dalle,x.t2uay3k].includes(j(o.message))&&!P(o.message),t=z();return c.useEffect(()=>{async function r(l,f){try{const u=await J(t,l);I.setFocusedObject({type:A.Image,image:u[0],allImages:u,messageId:f})}catch(u){O.addError(new Error("Failed to load newly created images:",{cause:u}))}}if(o!=null&&[x.Dalle,x.t2uay3k].includes(j(o.message))&&o.message.content.content_type===F.MultimodalText){const l=L.getImageAssetPointers(o.message);r(l,o.id)}},[t,o]),n.jsx(le,{image:a,allImages:d,isLoadingNewImage:i,clientThreadId:e,messageId:s})}function le({image:e,allImages:s,isLoadingNewImage:a,clientThreadId:d,messageId:o}){const[i,t]=c.useState("default"),[r,l]=c.useState({width:window.innerWidth-Q,height:window.innerHeight}),f=c.useRef(null),[u,p]=c.useState(136),g=ae(),{currentDrawnShape:h,onNewDrawnShape:k,clearAllDrawings:v}=g,C=c.useRef(null),y=q(),S=W(),{setTargetedContent:w}=X();c.useEffect(()=>{const m=new ResizeObserver(E=>{const{width:N,height:T}=E[0].contentRect;l({width:N,height:T})});return f.current&&m.observe(f.current),()=>{m.disconnect()}},[]),c.useEffect(()=>{function m(E){E.key==="Escape"&&(i==="inpaint"?t("default"):I.close())}return document.addEventListener("keydown",m),()=>{document.removeEventListener("keydown",m)}},[i]),c.useEffect(()=>(h==null?w({type:"object",placeholderTextOverride:K({id:"imageEditor.transformationTextareaPlaceholder",defaultMessage:"Edit imageâ€¦"}),shouldPersistAcrossMessages:!0,isFocusedViewContent:!0,createNewCompletionParams:m=>Y(m,e)}):w({type:"object",label:y.formatMessage({id:"imageEditor.inpaintingTargetedContentLabel",defaultMessage:"Edit selection"}),isFocusedViewContent:!0,createNewCompletionParams:async m=>await ee(m,e,C.current?.getImageData(),y,S),onCleared:()=>t("default")}),()=>{w(void 0)}),[e,y,w,h,S]),c.useEffect(()=>{i!=="inpaint"&&v()},[i]),c.useEffect(()=>{t("default")},[e]);const D=s.findIndex(m=>m.asset_pointer===e.asset_pointer);return n.jsxs("div",{ref:f,className:"flex h-full w-full flex-col justify-between",children:[n.jsx(te,{imageAsset:e,mode:i,setMode:t,clientThreadId:d,messageId:o,cursorWidth:u,setCursorWidth:p,inpaintingDrawingState:g,isLoadingNewImage:a}),n.jsx(oe,{mode:i,imageIndex:D,allImages:s,onSwitchImage:m=>{I.setFocusedObject({type:A.Image,image:m,allImages:s,messageId:o})},isLoadingNewImage:a}),n.jsxs(ce,{imageAsset:e,containerDimensions:r,isLoadingNewImage:a,children:[n.jsx(ne,{className:"h-full w-full",alt:se(e),src:e.url,width:e.width,height:e.height,fadeIn:!1}),i==="inpaint"&&n.jsx("div",{className:"absolute inset-0",children:n.jsx(ue,{drawingCanvasRef:C,color:"rgba(0, 122, 255, 0.5)",dashedOutlineColor:"rgba(255, 255, 255, 0.65)",cursorWidth:u,canvasWidth:e.width,canvasHeight:e.height,currentDrawnShape:h,onNewDrawnShape:k})})]})]})}export{We as ImageEditor};
//# sourceMappingURL=kivir7uecp2ijnx2.js.map
