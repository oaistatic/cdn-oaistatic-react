import{f as z,r as f,j as G,p as a}from"./m60bpb0x3x7rg8fj.js";import{k as U,e as V,H as W,nC as j,bI as J,of as K,ni as Q,p5 as H,gD as q,ap as X,fc as v,du as M,P as w,a5 as Y,R as Z,bC as $,hx as S,hw as l,dC as ee,m as te,T as ae,aC as se}from"./lgw4q0e8zlqqfgug.js";import{ar as ne,cS as oe,cT as le,aP as ie,cU as de}from"./ggjzadbnd3k1vu0k.js";const C=(...e)=>t=>e.some(o=>o(t)),T=({allGroupedMessages:e})=>e.some(t=>t.type===l.Browsing||t.type===l.RetrievalBrowsing||t.type===l.ParallelBrowsing),I=({allGroupedMessages:e})=>e.some(t=>t.type===l.SearchGPTQuery),ce=({allGroupedMessages:e})=>e.some(t=>t.type===l.Text&&t.messages.some(o=>o.metadata?.content_references?.some(n=>n.type==="products"||n.type==="product_entity"))),re=({allGroupedMessages:e})=>e.some(t=>t.type===l.Text&&t.messages[0]?.metadata?.followup_prompts?.length),F=({allGroupedMessages:e})=>e.some(t=>t.type===l.CodeInterpreter),ue=({allGroupedMessages:e})=>e.some(t=>t.type===l.JITPlugin);function ge(e){return!e||!e.instructions?"":typeof e.instructions=="string"?e.instructions:e.instructions.filter(t=>typeof t=="string").join("")}const x={"Didn't fully follow instructions":{tag:"Didn't fully follow instructions",label:a({id:"Rdlt9V",defaultMessage:"Didn't fully follow instructions"})}},he=[{match:ce,tag:"Shouldn't have shown products",label:a({id:"HMKFPm",defaultMessage:"Shouldn't have shown products"}),forceRefreshExcluding:"commerce"},{match:C(T,I),tag:"Shouldn't have searched the web",label:a({id:"kL047b",defaultMessage:"Shouldn't have searched the web"})},{match:re,tag:"Don't like the followups",label:a({id:"xAFgPE",defaultMessage:"Don’t like the suggested follow ups"})},{match:C(T,I),tag:"Don't like the source it cited",label:a({id:"OWjzGX",defaultMessage:"Don't like the sources it cited"})},{match:F,tag:"Shouldn't have run code",label:a({id:"53w4ay",defaultMessage:"Shouldn't have run code"})},{match:F,tag:"Couldn't handle my file",label:a({id:"EkFTQ5",defaultMessage:"Couldn't handle my file"})},{match:({allGroupedMessages:e})=>e.some(t=>t.type===l.Dalle),tag:"Shouldn't have created an image",label:a({id:"S8FRsr",defaultMessage:"Shouldn't have created an image"})},{match:ue,tag:"Tool call didn't work",label:a({id:"JvNV9L",defaultMessage:"Tool call didn't work"})},{match:({allGroupedMessages:e})=>e.some(t=>{if(t.type!==l.Text)return!1;const o=t.messages[0],{content:n}=o;return n.content_type===v.Text&&ee(o).match(/^```[\S]+\n/gm)}),tag:"Code was incorrect",label:a({id:"4EBdQk",defaultMessage:"Code was incorrect"})},{match:({systemContent:e})=>ge(e).includes("Personality")??!1,tag:"Too chatty or casual",label:a({id:"ATzJKW",defaultMessage:"Too chatty or casual"})},{match:({isBusinessWorkspace:e})=>e,tag:"File upload not working as expected",label:a({id:"Pv0EgM",defaultMessage:"File upload not working as expected"})},{match:({isBusinessWorkspace:e,hasCaConnection:t})=>e&&t,tag:"Should have triggered Internal knowledge",label:a({id:"DJc0pt",defaultMessage:"Should have triggered Internal knowledge"})},{match:({features:e})=>e.includes(te.Sunshine),tag:"Shouldn't have used Memory",label:a({id:"yfUEiz",defaultMessage:"Shouldn't have used Memory"})},{tag:"Don’t like the personality",label:a({id:"6Yz27f",defaultMessage:"Don’t like the personality"})},{tag:"Don't like the style",label:a({id:"nGxjdj",defaultMessage:"Don't like the style"})},{tag:"Not factually correct",label:a({id:"Ke7JtQ",defaultMessage:"Not factually correct"})},{...x["Didn't fully follow instructions"],match:({isBusinessWorkspace:e})=>!e},{tag:"Refused when it shouldn't have",label:a({id:"2yRS/Q",defaultMessage:"Refused when it shouldn't have"})},{match:({isBusinessWorkspace:e})=>!e,tag:"Being lazy",label:a({id:"14MPmT",defaultMessage:"Being lazy"})},{tag:"Unsafe or problematic",label:a({id:"02pXBl",defaultMessage:"Unsafe or problematic"})},{tag:"Biased",label:a({id:"pK35DW",defaultMessage:"Biased"})},{tag:"Other",label:a({id:"WiIGE+",defaultMessage:"Other"})}],fe=[{tag:"I disagree with the policy",label:a({id:"oKyDLz",defaultMessage:"I disagree with the policy"})},{tag:"This didn't violate the policy",label:a({id:"7fUkVF",defaultMessage:"This didn't violate the policy"})},{tag:"I don't understand the policy",label:a({id:"4Cdp6N",defaultMessage:"I don't understand the policy"})},{tag:"This didn't take the full context",label:a({id:"vnZJDP",defaultMessage:"This didn't take the full context"})}],be=[{tag:"Shouldn't have triggered Internal knowledge",label:a({id:"ILVpD8",defaultMessage:"Shouldn't have triggered Internal knowledge"})},{tag:"I specified what data to use and it was wrong",label:a({id:"ziFYwZ",defaultMessage:"I specified what data to use and it was wrong"})},{tag:"Missing relevant Internal knowledge",label:a({id:"PobbBn",defaultMessage:"Missing relevant Internal knowledge"})},{tag:"Inaccurate information",label:a({id:"HbcEAV",defaultMessage:"Inaccurate information"})},{tag:"Response not relevant or helpful",label:a({id:"k2/tlU",defaultMessage:"Response not relevant or helpful"})},{...x["Didn't fully follow instructions"]},{tag:"I don't like the model tone",label:a({id:"PT9XqK",defaultMessage:"I don't like the model tone"})}];function me(e,t,o){return t.filter(n=>!n.match||n.match(o)).map(n=>({value:n.tag,label:e.formatMessage(n.label),forceRefreshExcluding:n.forceRefreshExcluding}))}function pe(e){const t=ie(e);return t!=null&&(t.errCode===S.ContentPolicy||t.errCode===S.ContentOrTos)}function Se({clientThreadId:e,conversationMessage:t,currentModelId:o,allGroupedMessages:n}){const E=z(),D=U()??[],i=t.clientMetadata?.rating,_=V(),u=W(_)?.isWorkspacePlan()??!1,b=j(),m=J(),g=f.useMemo(()=>m&&n.some(s=>s.type!==K&&s.messages?.some(Q)),[n,m]),{hasConnections:R,isLoading:P}=H(),h=(R&&!P)??!1,O=ne({clientThreadId:e}),p=f.useRef(q(s=>{O(s)},500)).current,y=X(e,s=>ae.findNode(s,d=>d.message.author.role===se.System&&d.message.content.content_type==="system_content")),N=y?.message.content.content_type===v.SystemContent?y?.message.content:null,A=f.useCallback(s=>{const d=M(e);if(!d||s.tags.length===0&&!s.textFeedback)return;const c=s.tags.map(r=>r.value);w.logEvent(s.source==="inline"?"Message Feedback Inline Submitted":"Message Feedback Dialog Submitted",{id:t.id,threadId:d,tags:c,content:s.textFeedback,model:o,rating:i}),Y.logEvent(s.source==="inline"?"chatgpt_feedback_inline_submitted":"chatgpt_feedback_dialog_submitted",c?.[0]??null,{id:t.id,threadId:d,tag:c?.[0]??"",content:s.textFeedback??"",model:o??"",rating:i??"",...h?{isCaTriggered:String(g)}:{}}),i&&(u&&b?oe({rating:de(i),text:s.textFeedback,tags:c,tag_choices:s.tagChoices},d,t.id):u||Z.safePost("/conversation/message_feedback",{requestBody:{message_id:t.id,conversation_id:d,rating:i,text:s.textFeedback,tags:c,tag_choices:s.tagChoices},authOption:$.SendIfAvailable}));const k=s.tags.map(r=>r.forceRefreshExcluding).filter(r=>!!r);k.length>0&&p({sourceEvent:s.event,nodeId:t.id,extraStreamParams:{forceDisableFeatures:k}})},[e,t.id,o,p,h,u,g,b,i]),B=()=>{w.logEvent("Message Feedback More Options Clicked",{id:t.id,threadId:M(e),model:o,rating:i})},L=me(E,pe(t)?fe:g?be:he,{allGroupedMessages:n,features:D,currentModelId:o??"",systemContent:N,isBusinessWorkspace:u,hasCaConnection:h});return i==="thumbsUp"?null:G.jsx(le,{tagOptions:L,onSubmit:A,onMoreClicked:B})}export{Se as default};
//# sourceMappingURL=hc6de3k4fs56s7qj.js.map
