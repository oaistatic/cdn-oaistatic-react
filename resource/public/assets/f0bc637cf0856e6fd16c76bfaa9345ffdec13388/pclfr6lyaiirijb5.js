import{r as E,f as ht,j as a,m as k,A as H,ar as Ft}from"./m60bpb0x3x7rg8fj.js";import{jW as zt,sY as Wt,lQ as N,lR as R,sn as at,sZ as gt,ai as $t,aj as Zt,id as Qt,m9 as qt,ib as Jt,ic as te,m7 as ee}from"./ggjzadbnd3k1vu0k.js";import{i as _,f as w,k as oe,c as D,l as Et,w as ne,x as Ct,y as se,z as xt,E as re,A as ie}from"./koh2m2w2ywhm6pl3.js";import{C as ct}from"./5a6x9gba3iwtvxlr.js";import{T as bt,Z as Y}from"./jy1u8exw8iz2slve.js";import{u as U,i as $,d as ae}from"./lfugw8qvvom7caj7.js";import{cr as z,aE as ce,z as M,lH as le,di as yt,cp as ue,c as vt,cO as ot,hV as fe,aP as Z,aS as Tt,aU as de,aR as me,aV as pe,aT as St,aQ as he,bF as Ot,gD as ge}from"./lgw4q0e8zlqqfgug.js";import{p as At,q as Lt,a as Ee}from"./i4rip6yaxdxd1xd5.js";import{P as Ce,H as xe}from"./cyridnrl7jpyirze.js";import{E as tt,h as be,G as P,c as lt}from"./cum2m9ppsxjdt1u5.js";import{u as Q}from"./9q3v44p2xpoi75pn.js";import{S as ye}from"./n9mc8ay6b1mvrc8r.js";import{i as ve}from"./lf8mxjdfum7t34gh.js";var j=(t=>(t[t.up=-1]="up",t[t.down=1]="down",t))(j||{}),W=(t=>(t.COMMENT="comment",t.COMPOSER="composer",t))(W||{}),O=(t=>(t.COLLAPSED="collapsed",t.EXPANDED="expanded",t))(O||{});const Nt=([t,e],[o,s])=>{const n=t+e,r=o+s;return t<r&&o<n},nt=([t,e])=>t+e,I=t=>{if(t.type===O.COLLAPSED)return[t.offsetY??0,0];const{offsetY:e,shiftY:o=0,height:s=0}=t,n=e+o;return o<0?[n,s+Math.abs(o)]:[n,s]},Te=(t,e,o)=>{if(!Nt(t,e))return null;const[s,n]=t,r=s+n,[i,c]=e,l=i+c,u=i-r,f=l-s;return o===j.up?u:f};var Pt=(t=>(t.ABOVE="above",t.BELOW="below",t))(Pt||{});function V(t,e){return z(t.coordsAtPos(e))}const ut=360,Se=250,wt=44,Oe=.5,Ae=[.5,.9,1],Le=[1,.75,.2],Ne=({onClose:t,onSubmit:e,opensOverDocument:o=!1,opensFromGutter:s=!1,gutterHasComments:n=!1},r)=>{const i=ht(),c=E.useRef(null),l=E.useRef(!1),[u,f]=E.useState(""),[d,m]=E.useState(!0),p=()=>{document.hasFocus()&&(f(""),t?.(l.current))},h=(b,y=u)=>{l.current=!0,e?.(b,y),f("")},C=ce(({windowWidth:b})=>o?b<ut+100?Se:ut:tt,0),g={};s&&(g.top=-12),o&&s?g.right=0:g.left=0;let x="";s&&!o?x="8px 50%":s&&o?x="calc(100% + 8px) 50%":o&&(x="center left");let T=0;s&&!o&&n&&(T=be);const S=b=>{const{metaKey:y,shiftKey:A,key:X}=b;X==="Enter"&&!b.nativeEvent.isComposing&&u&&!(A||y)?(h(b),b.preventDefault()):X==="Escape"&&(f(""),t?.(!1))},v=i.formatMessage({id:"VvfbvY",defaultMessage:"Edit or explain..."});return a.jsx(k.div,{ref:zt(c,r),className:M("absolute flex items-center",Y.commentComposer),style:{...g,minHeight:wt},transition:{type:"spring",bounce:.18,duration:.48},initial:{translateX:0},animate:{translateX:T},exit:{translateX:0},children:a.jsx(k.div,{className:M("no-scrollbar border-token-border-default relative z-10 flex items-center overflow-x-hidden border",bt,{"rounded-full":d,"rounded-2xl":!d}),initial:{width:o?tt:24,scale:o?void 0:Oe},animate:{width:C,scale:o?void 0:Ae},exit:{filter:"blur(16px)",scale:o?void 0:Le,width:o?tt:24,opacity:o?0:[1,1,0]},transition:{type:"spring",bounce:o?.14:0,duration:.28,scale:{type:"tween",duration:.2},opacity:{type:"tween",time:[0,.95,1]}},style:{transformOrigin:x},children:a.jsxs(k.div,{className:"bg-token-main-surface-primary relative z-0 flex w-full items-center px-4 py-2.5",children:[a.jsx(k.div,{className:"absolute inset-0 z-[-1] bg-gray-50/75 backdrop-blur-3xl backdrop-saturate-25 dark:bg-gray-700/75",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.2}}),a.jsx(ve,{"aria-placeholder":v,value:u,className:"text-token-text-primary placeholder:text-token-text-secondary w-full resize-none border-0 bg-transparent px-1 py-0 pe-2 outline-0 focus:ring-0 focus-visible:ring-0",autoFocus:!0,maxRows:4,onBlur:p,onHeightChange:(b,{rowHeight:y})=>{m(Math.floor(b/y)<=1)},onChange:({target:{value:b}})=>f(b),onKeyDown:S}),!u&&a.jsx("span",{"aria-hidden":!0,className:"text-token-text-secondary absolute inline-block ps-1 text-nowrap",children:v}),a.jsx(k.button,{className:M("-me-1.5 h-6 w-6 rounded-full bg-black text-center dark:bg-white",{"self-end":!d}),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.1},onMouseDown:b=>h(b),children:a.jsx(Wt,{className:"h-6 w-6 text-white dark:text-black"})})]})})})},Mt=E.forwardRef(Ne),Pe=(t,e)=>{if(e?.type!==_.SELECTION)return null;try{const{from:o,to:s}=e,{top:n}=t.dom.getBoundingClientRect(),{bottom:r,top:i}=V(t,o),{bottom:c}=V(t,s),l=$(t)?-30:-24;let u=r-n+l;const f=i-n;return u=c-n+8,{composerTop:u,loadingTop:f}}catch(o){return N.logError("Invalid position in SelectionCommentComposer",o),null}},we=({toolbarPosition:t,composerRect:e,view:o})=>{const{width:s}=e;let{height:n}=e;if(n||=wt,o==null||t==null)return null;const{right:r,left:i}=o.dom.getBoundingClientRect(),{left:c,top:l,aboveOrBelow:u,toolbarSize:f}=t,d=l-(u===Pt.ABOVE&&n!==0?n-f.height:0),m=ae(o)?12:0;return{left:Math.min(c,r-i-s-m),composerTop:d,aboveOrBelow:u}},Me=({toolbarPosition:t,commentingOn:e,isWaitingForCommentResponse:o=!1,onAddComment:s})=>{const n=U()(),[r,i]=Q(),c=we({view:n,toolbarPosition:t,composerRect:r});if(n==null||c==null)return null;const{left:l,composerTop:u}=c,f=(d,m)=>{if(e?.type!==_.SELECTION)return;const{action:p,sourceRange:h}=e;s?.(d,m,p,h,e.type)};return a.jsx(H,{children:e?.type===_.SELECTION&&!o&&a.jsx("div",{className:M("absolute",Y.commentComposer),style:{left:l,top:u},children:a.jsx(Mt,{opensOverDocument:!0,onClose:d=>{d||(w.cancelCommentingOn(),n&&$(n)&&!n.state.selection.empty&&n.dispatch(n.state.tr.setSelection(new le(n.state.selection.$from))),document.getSelection()?.removeAllRanges())},onSubmit:f,ref:i})},"composer")})};function ke(t,e,o){const s=t+e;for(const n of o.values()){const r=n.start,i=n.end;if(t<i&&r<s)return!0}return!1}const De=50,je=200,_e=[Ce.proseMirrorNodeName(),xe.proseMirrorNodeName()],Be=t=>t?t.isBlock:!1,Re=t=>{if(!t)return!1;const{isBlock:e,type:{name:o}}=t;return e&&_e.includes(o)},Ie=(t,e,o,s)=>{const n=t.posAtCoords({left:e,top:o});if(n==null)return;const{pos:r,inside:i}=n;if(i===-1)return;const{state:c}=t;let l=r,u=c.doc.nodeAt(l);for(;!Be(u)&&l>=0;)l--,u=c.doc.nodeAt(l);if(!u||!Re(u))return;const f=s!=null&&ke(l,u.nodeSize,s);return{node:u,nodeHasComment:f,pos:l}};function He(t,e,o){const s=Ie(t,e.x,e.y,o);if(s==null)return null;const{node:n,pos:r,nodeHasComment:i}=s,{top:c}=t.coordsAtPos(0);function l(){const p=r+1;return Ee(t.state.doc,p)&&t.state.doc.nodeAt(p)?.isText?t.coordsAtPos(p).top:t.coordsAtPos(r).top}const u=l(),f=u-c;return{height:t.coordsAtPos(r+n.nodeSize-1).bottom-u,nodeHasComment:i,mouseEnteredAt:Date.now(),yOffset:f,pos:r}}function Ye(t){const e=E.useRef(!1),o=E.useRef(!1),[s,n]=E.useState(null),r=oe(),i=r()?.dom,c=E.useRef(!1),l=D(({visibleBlockCommentLauncher_DEBUG_ONLY:d})=>d),u=E.useCallback(yt(d=>{e.current=!0;const{commentingOn:m}=D.getState();if(o.current||m!=null)return;const p=r();if(p==null||!e.current)return n(null);const{dom:h,state:C}=p,g=At(Lt,C)?.positions;if(g==null)return n(null);const x=He(p,d,g);if(x==null||x.nodeHasComment&&t===P.COLLAPSED){n(null);return}if(c.current&&x.yOffset!==s?.yOffset){n(null);return}const T=p.coordsAtPos(0),S=h.getBoundingClientRect().width,b=(d.x-T.left)/S>=De/100;n(b?x:null)},je),[r,c,s]);E.useEffect(()=>{if(i!=null)return ue(i,{mouseenter:()=>{e.current=!0,o.current=!1},mouseleave:({relatedTarget:d})=>{if(u.cancel(),d instanceof HTMLElement&&d.closest("[data-block-comment-launcher]")){o.current=!0;return}o.current=!1,e.current=!1,D.getState().commentingOn==null&&n(null)},mousemove:u})},[r,i,t,u]);const f=E.useCallback(({relatedTarget:d})=>{const{commentingOn:m}=D.getState();m==null&&d!==i&&(o.current=!1,n(null))},[i]);return{visibleBlockComment:l??s,handleMouseLeave:f,onComposerVisibleChange:d=>{c.current=d}}}const Ge=({isWaitingForCommentResponse:t=!1,opensOverDocument:e=!1,hasComments:o=!1,activeBlockComment:s,composerRef:n,onLaunchComposer:r,onMouseLeave:i,onSubmit:c})=>{const[l,u]=E.useState(!1),{yOffset:f,height:d,pos:m}=s,p=()=>{u(!0),r?.(),N.logButtonClick(R.BLOCK_COMMENT_LAUNCHER),w.startCommentingOn({type:_.BLOCK,pos:m})},h=x=>{x||(u(!1),w.cancelCommentingOn())},C=(x,T)=>{u(!1),c?.(x,T)};E.useEffect(()=>()=>{w.mouseLeaveBlock()},[]);const g=o&&l?e?-88:88:0;return a.jsx(k.div,{className:M("pointer-events-auto absolute flex h-6 w-5 origin-[14px_50%] items-start after:absolute after:-inset-4 after:content-['']",Y.commentComposer),initial:!1,animate:{opacity:1},exit:{opacity:0},transition:{type:"spring",duration:.2,bounce:.1},style:{top:0,height:d,translateY:f},onMouseLeave:i,"data-block-comment-launcher":!0,children:a.jsxs(H,{children:[l?a.jsx(Mt,{ref:n,opensFromGutter:!0,onClose:h,onSubmit:C,gutterHasComments:o,opensOverDocument:e},"composer"):null,a.jsx(k.button,{initial:{opacity:0},animate:{opacity:l?0:1,translateX:g},transition:{duration:.15,translateX:{type:"spring",bounce:.18,duration:.48}},className:"group absolute z-10 flex h-6 gap-1 bg-transparent after:absolute after:-inset-y-4 after:-right-4 after:-left-1 after:content-['']",onClick:p,onMouseEnter:()=>w.mouseEnterBlock(m),onMouseLeave:()=>w.mouseLeaveBlock(),disabled:l||t,children:a.jsx(ne,{isLoading:t})},"launcer")]})})},Ve=({isWaitingForCommentResponse:t=!1,isRequestActive:e=!1,hasComments:o=!1,composerRef:s,gutterMode:n,onAddComment:r})=>{const i=Et(),{visibleBlockComment:c,handleMouseLeave:l,onComposerVisibleChange:u}=Ye(n),f=(d,m)=>{if(!c||!i)return;const{doc:p}=i,{pos:h}=c,C=p.nodeAt(h);if(!C)return;const{attrs:{start:g,end:x}}=C;r?.(d,m,Ct.ASK,{start:g,end:x},_.BLOCK)};return a.jsx(H,{onExitComplete:()=>u(!1),children:c&&i&&(t||!e)&&a.jsx(Ge,{composerRef:s,isWaitingForCommentResponse:t,opensOverDocument:n===P.COLLAPSED,activeBlockComment:c,hasComments:o,onSubmit:f,onMouseLeave:l,onLaunchComposer:()=>u(!0)},"launcher")})},Ue=({onAcceptComment:t,onDismissComment:e,disableActions:o=!1,entry:s,isGutterCollapsed:n=!1,isHovered:r=!1,isFocused:i=!1,isSomeCommentFocused:c=!1})=>{const{offsetY:l,type:u}=s,[f,d]=Ft();let m=null;if(u===O.COLLAPSED)m=!i&&a.jsx(se,{offsetY:l,count:s.count,onClick:()=>{N.logButtonClick(R.COLLAPSED_COMMENT),w.focusComment(s.children[0])}},"collapsed");else{const{comment:p}=s;if(p==null||p.content===""||p.status===at.DISMISSED)m=null;else if(p.status===at.ACCEPT_INITIATED)m=a.jsx("div",{className:"absolute",style:{top:l},children:a.jsx(xt,{})},"loading");else{const{id:h}=p;m=a.jsx(re,{isSomeCommentFocused:c,isHovered:r,isFocused:i,offsetY:l,disableActions:o,onClick:()=>{N.logButtonClick(R.EXPANDED_COMMENT),w.focusComment(h)},onMouseEnter:()=>w.mouseEnterComment(h),onMouseLeave:()=>w.mouseLeaveComment(),comment:p,onAccept:C=>{N.logButtonClick(R.COMMENT_ACCEPT,{commentId:h}),t?.(C,h)},onDismiss:()=>{N.logButtonClick(R.COMMENT_DISMISS,{commentId:h}),e?.(h)},opensOverDocument:n},"expanded")}}return a.jsx(H,{onExitComplete:()=>d?.(),children:f&&m})},ft=({onMeasureHeight:t,comment:e,isFocused:o=!1})=>{const[{height:s},n]=Q();return vt(()=>{t?.(s)},[s]),a.jsx(ie,{ref:n,comment:e,isFocused:o,disableAnimations:!0})},Xe=({comments:t,onMeasure:e,getStableCommentId:o})=>{const s=E.useRef(new Map),n=E.useRef(new Map),r=E.useRef(null),i=(c,l,u=!1)=>{l&&(u?n.current.set(o(c),l):s.current.set(o(c),l),r.current&&cancelAnimationFrame(r.current),r.current=requestAnimationFrame(()=>{e?.({focusedHeights:new Map(n.current),heights:new Map(s.current)}),r.current=null}))};return t?.length?a.jsxs("div",{className:"pointer-events-none invisible fixed start-0 top-0 overflow-clip","aria-hidden":"true",children:[t.map(c=>a.jsx(ft,{comment:c,onMeasureHeight:l=>i(c.id,l)},o(c.id))),t.map(c=>a.jsx(ft,{isFocused:!0,comment:c,onMeasureHeight:l=>i(c.id,l,!0)},`${o(c.id)}-focused`))]}):null},dt=(t,e,o)=>{let s=o+e;for(;e===j.down?s<t.length:s>-1;){const n=t[s],r=t[s-e],i=Te(I(n),I(r),e);if(i!=null&&n.type!==O.COLLAPSED)n.shiftY+=i;else break;s+=e}},mt=(t,e)=>{for(const o of e){const{index:s,amount:n}=o,r=t[s];r.type===O.EXPANDED&&(r.shiftY+=n),dt(t,j.down,s),dt(t,j.up,s);for(const i of t)i.type!==O.COLLAPSED&&(i.offsetY+=i.shiftY,i.shiftY=0)}},Ke=(t,e)=>{const o=[],[s,n]=e,r=s+n;for(let i=0;i<t.length;i++){const c=t[i],[l]=I(c),u=[l,c.type===O.EXPANDED?c.height:0],[f,d]=u;if(Nt(u,e)){const m=f+d,p=s-m,h=r-f,g=(Math.abs(p)<Math.abs(h)?j.up:j.down)===j.up?p:h;o.push({index:i,amount:g})}}return o},Fe=({gutterMode:t,focusedCommentId:e,gutterPositions:o,getCommentKey:s,getComment:n})=>{if(!o?.size)return[];const r=new Map,i=[];let c=null,l=-1;for(const f of o.values()){if(f.type===W.COMPOSER){c=[f.offsetY,f.height];continue}const{commentId:d,height:m,collapsedOffsetY:p,offsetY:h}=f;if(t===P.EXPANDED){const x=ot(i),T=x?nt(I(x)):0;let S=h;x&&S<=T&&(S=T),r.set(d,{originalOffsetY:h,offsetY:S}),e===d&&(l=i.length),i.push({key:s(d),comment:n(d),type:O.EXPANDED,height:m,offsetY:S,shiftY:0});continue}let C=i.findIndex(({offsetY:x,type:T})=>T===O.COLLAPSED&&x===p),g=i[C]??null;if(!g)g={key:i.length,type:O.COLLAPSED,offsetY:h,count:1,children:[d]},C=i.length,i.push(g);else{if(g.type!==O.COLLAPSED)throw new Error("Collapsed parent type expected to be collapsed");g.count+=1,g.children.push(d),g.offsetY=p}e===d&&(l=C)}const u=i[l];if(t===P.COLLAPSED&&u?.type===O.COLLAPSED){const f=[];for(let d=0;d<u.children.length;d++){const m=u.children[d];m===e&&(l+=d+1);const p=ot(f),h=p?nt(I(p)):0,C=o.get(m)?.offsetY??0,g=Math.max(h,C);r.set(m,{originalOffsetY:C,offsetY:g}),f.push({type:O.EXPANDED,key:s(m),comment:n(m),offsetY:g,height:o.get(m)?.height??0,shiftY:0})}i.splice(l,0,...f)}if(e){const f=r.get(e);if(!f)return i;const{offsetY:d,originalOffsetY:m}=f,p=m-d,h=[{amount:p,index:l}];let C=l+1;for(;C<i.length;){const g=i[C],{type:x}=g;let T=p;if(x===O.EXPANDED&&g.comment?.id){const{offsetY:S,originalOffsetY:v}=z(r.get(g.comment.id));if(S===v)break;T=Math.max(v-S,p)}else break;h.push({amount:T,index:C}),C++}h.length&&mt(i,h)}else if(t!==P.COLLAPSED&&c){const f=Ke(i,c);mt(i,f)}return i},ze=t=>{try{return Fe(t)}catch(e){return N.logError("Generating comment gutter entries",e),[]}},We=t=>"length"in t?t.length===0:t.nodeSize===0,et=12,$e=({composerHeight:t,getCommentHeight:e,getCollapsedStartPos:o,commentingOn:s,commentPositions:n,view:r})=>{if(!n||!r||We(r.state.doc))return null;const{top:i}=r.dom.getBoundingClientRect(),c=Array.from(n.entries()).sort(([u,f],[d,m])=>f.start-m.start),l=new Map;for(const[u,{start:f}]of c)try{const d=o?.(f)??f,{top:m}=V(r,d),{top:p}=V(r,f),h=p-i,C=m-i,g=(e(u)??0)+et;l.set(u,{commentId:u,height:g,collapsedOffsetY:C,offsetY:h,type:W.COMMENT})}catch{continue}if(s?.type===_.BLOCK){const{pos:u}=s;try{const{top:f}=V(r,u),m=f-i-et;l.set("block-composer",{type:W.COMPOSER,height:(t??0)+et,offsetY:m})}catch{}}return l},kt=(t,e)=>e.nodeAt(t)?.isBlock?t+1:kt(t-1,e);function Ze(t){const e=Et(),s=U()?.();if(!s)return null;if($(s)){if(!e)return null;const n=At(Lt,e);return n?n.positions:null}return new Map(t.map(n=>[n.id,n.at]))}const Qe=({gutterMode:t,focusedCommentId:e,commentingOn:o,comments:s,getStableId:n})=>{const[{height:r},i]=Q(),c=U(),[l,u]=E.useState(()=>new Map),[f,d]=E.useState(()=>new Map),m=E.useCallback(({focusedHeights:v,heights:b})=>{u(v),d(b)},[]),p=v=>{const b=n(v);return v===e?l.get(b)??0:f.get(b)??0},h=c(),C=h!=null&&$(h)?v=>kt(v,h.state.doc):void 0,g=new Map(s?.map(v=>[n(v.id),v])),x=Ze(s),T=$e({composerHeight:r,commentingOn:o,getCommentHeight:p,getCollapsedStartPos:C,commentPositions:x,view:h}),S=ze({gutterMode:t,gutterPositions:T,focusedCommentId:e,getComment:v=>g.get(n(v))??null,getCommentKey:n});return{blockComposerRef:i,onMeasureComments:m,gutterEntries:S}};function qe(){const e=U()(),o=D(({commentingOn:r})=>r),n=e==null?null:Pe(e,o);return n==null?null:a.jsx(k.div,{className:"absolute",style:{top:n.loadingTop},initial:!1,animate:{opacity:1,scale:1},exit:{opacity:0,scale:0},transition:{delay:.2},children:a.jsx(xt,{})},"selection-loading")}const Je=t=>a.jsx("div",{className:"absolute",style:{top:nt(I(t))},children:a.jsx("div",{className:"h-[max(3rem,18vh)] w-1"})}),jo=({availableWidth:t,comments:e,commentsMode:o,disableBlockComments:s=!1,isRequestActive:n=!1,isWaitingForCommentResponse:r=!1,onAddComment:i,onAcceptComment:c,onDismissComment:l,getStableCommentId:u})=>{const f=D(({focusedCommentId:L})=>L),d=D(({hoveredCommentId:L})=>L),m=D(({commentingOn:L})=>L),p=fe(),h=t<lt?P.COLLAPSED:P.EXPANDED,{onMeasureComments:C,blockComposerRef:g,gutterEntries:x}=Qe({comments:e,getStableId:u,gutterMode:h,focusedCommentId:f,commentingOn:m}),T=x.length>0,S=m!=null&&!r&&m.type!=="selection"||T,b=(()=>{if(!S)return 0;switch(h){case P.COLLAPSED:return 0;case P.EXPANDED:return lt}})(),y=m?.type==="selection",A=ot(x),X=o===ct.ENABLED&&p&&!y&&!s;return a.jsxs(k.div,{className:M("pointer-events-none relative flex h-full shrink-0",Y.commentGutter,h===P.COLLAPSED&&b?"basis-[32px]":"basis-0"),initial:{width:0,opacity:0},animate:{width:b,opacity:1},exit:{width:0,opacity:0},children:[a.jsx(Xe,{getStableCommentId:u,comments:e,onMeasure:C}),a.jsxs("div",{className:M("pointer-events-auto absolute start-0 top-0 bottom-0 w-0 overflow-visible",{"ps-2":S||!s}),children:[a.jsx(H,{children:x.map(L=>{const{key:Ut,type:it}=L,Xt=!!f&&it===O.EXPANDED&&L.comment?.id===f,Kt=!!f&&L.type===O.COLLAPSED&&L.children.includes(f);return a.jsx(Ue,{isGutterCollapsed:h===P.COLLAPSED,isSomeCommentFocused:!!m||!!f,isHovered:it===O.EXPANDED&&L.comment?.id===d,isFocused:Xt||Kt,entry:L,disableActions:n||r||o===ct.COMMENTS_READONLY,onAcceptComment:(K,B)=>{try{c?.(K,z(e?.find(J=>J.id===B)))}catch(J){N.logError(`Comment ${B} not found`,J)}},onDismissComment:K=>{try{l?.(z(e?.find(B=>B.id===K)))}catch(B){N.logError(`Comment ${K} not found`,B)}}},Ut)})}),T&&A&&a.jsx(Je,{...A}),X&&a.jsx(Ve,{composerRef:g,gutterMode:h,onAddComment:i,isWaitingForCommentResponse:r,isRequestActive:n,hasComments:T}),r&&y&&a.jsx(qe,{})]})]})};var to="Separator",pt="horizontal",eo=["horizontal","vertical"],Dt=E.forwardRef((t,e)=>{const{decorative:o,orientation:s=pt,...n}=t,r=oo(s)?s:pt,c=o?{role:"none"}:{"aria-orientation":r==="vertical"?r:void 0,role:"separator"};return a.jsx(Z.div,{"data-orientation":r,...c,...n,ref:e})});Dt.displayName=to;function oo(t){return eo.includes(t)}var no=Dt,st="Toolbar",[so,_o]=me(st,[Tt,gt]),rt=Tt(),jt=gt(),[ro,_t]=so(st),Bt=E.forwardRef((t,e)=>{const{__scopeToolbar:o,orientation:s="horizontal",dir:n,loop:r=!0,...i}=t,c=rt(o),l=de(n);return a.jsx(ro,{scope:o,orientation:s,dir:l,children:a.jsx(pe,{asChild:!0,...c,orientation:s,dir:l,loop:r,children:a.jsx(Z.div,{role:"toolbar","aria-orientation":s,dir:l,...i,ref:e})})})});Bt.displayName=st;var Rt="ToolbarSeparator",It=E.forwardRef((t,e)=>{const{__scopeToolbar:o,...s}=t,n=_t(Rt,o);return a.jsx(no,{orientation:n.orientation==="horizontal"?"vertical":"horizontal",...s,ref:e})});It.displayName=Rt;var io="ToolbarButton",q=E.forwardRef((t,e)=>{const{__scopeToolbar:o,...s}=t,n=rt(o);return a.jsx(St,{asChild:!0,...n,focusable:!t.disabled,children:a.jsx(Z.button,{type:"button",...s,ref:e})})});q.displayName=io;var ao="ToolbarLink",co=E.forwardRef((t,e)=>{const{__scopeToolbar:o,...s}=t,n=rt(o);return a.jsx(St,{asChild:!0,...n,focusable:!0,children:a.jsx(Z.a,{...s,ref:e,onKeyDown:he(t.onKeyDown,r=>{r.key===" "&&r.currentTarget.click()})})})});co.displayName=ao;var Ht="ToolbarToggleGroup",lo=E.forwardRef((t,e)=>{const{__scopeToolbar:o,...s}=t,n=_t(Ht,o),r=jt(o);return a.jsx($t,{"data-orientation":n.orientation,dir:n.dir,...r,...s,ref:e,rovingFocus:!1})});lo.displayName=Ht;var uo="ToolbarToggleItem",fo=E.forwardRef((t,e)=>{const{__scopeToolbar:o,...s}=t,n=jt(o),r={__scopeToolbar:t.__scopeToolbar};return a.jsx(q,{asChild:!0,...r,children:a.jsx(Zt,{...n,...s,ref:e})})});fo.displayName=uo;var mo=Bt,po=It,ho=(t=>(t.CODE="code",t.WRITING="writing",t))(ho||{});const G=({children:t,toolbarType:e})=>a.jsx(mo,{className:M("border-token-border-default bg-token-main-surface-primary m-0 flex h-10 w-fit min-w-0 shrink items-center overflow-hidden rounded-full border px-2",bt,e==="code"?"py-0":"py-1"),children:t}),Yt=({icon:t,hideLabel:e,label:o})=>a.jsxs(a.Fragment,{children:[a.jsx(t,{className:M("icon-sm",{"text-token-text-tertiary me-0.5":!e,"text-token-text-primary":e})}),!e&&a.jsx("span",{className:"text-token-text-primary truncate text-sm",children:o})]}),Gt=Ot(q)`flex h-full items-center gap-1 rounded-lg px-2.5 hover:bg-[#f5f5f5] disabled:opacity-50 disabled:cursor-not-allowed dark:hover:bg-token-main-surface-secondary disabled:hover:bg-transparent`,go=({label:t,icon:e,isDisabled:o=!1,hideLabel:s=!1,onClick:n,onMouseDown:r})=>a.jsx(Gt,{onClick:n,"aria-label":s?t:void 0,onMouseDown:r,disabled:o,children:a.jsx(Yt,{icon:e,hideLabel:s,label:t})}),Eo=({icon:t,hideLabel:e,label:o,children:s,align:n="end"})=>a.jsxs(Qt,{children:[a.jsx(qt,{asChild:!0,children:a.jsx(Gt,{"aria-label":e?o:void 0,children:a.jsx(Yt,{icon:t,hideLabel:e,label:o})})}),a.jsx(Jt,{children:a.jsx(te,{align:n,className:M(Y.toolbar,"popover"),sideOffset:8,children:s})})]});G.Separator=Ot(po)`mx-1 p-0 list-none h-full w-[1px] bg-token-border-default`;G.Action=go;G.Button=q;G.Popover=Eo;function Vt(t){const e=t();if(e==null)return;const{from:o,to:s,sourceFrom:n,sourceTo:r}=e;if(o==null||s==null||n==null||r==null){N.logError("Missing selection range on targeted edit",e);return}const i=Ct.ASK;N.logButtonClick(R.TOOLBAR_ASK_CHATGPT,{action:i,sourceFrom:n,sourceTo:r}),w.startCommentingOn({type:_.SELECTION,from:o,to:s,sourceRange:{start:n,end:r},action:i})}function Co(t,e,o){E.useEffect(()=>{if(o)return;const s=n=>{(n.metaKey||n.ctrlKey)&&n.key.toLowerCase()==="k"&&(n.preventDefault(),Vt(e))};return t?.addEventListener("keydown",s),()=>t?.removeEventListener("keydown",s)},[t,e,o])}const xo=({isSendDisabled:t=!1,getSelectionRange:e})=>{const o=ht(),s=()=>{Vt(e)};return a.jsx(G.Action,{isDisabled:t,label:o.formatMessage({id:"wOaJUU",defaultMessage:"Ask ChatGPT"}),onClick:s,icon:ye})},Bo=({getEditorDom:t,getToolbarPosition:e,getSelectionRange:o,toolbarType:s,children:n,onAddComment:r,isWaitingForCommentResponse:i=!1,isSendDisabled:c=!1})=>{const[{height:l,width:u},f]=Q(),[d,m]=E.useState(!0),[p,h]=E.useState(!1),C=t(),g=D(({commentingOn:y})=>y),[x,T]=E.useState(null);Co(C,o,c);const S=E.useCallback(()=>{const y=t(),A=document.getSelection();return!A||A.type!=="Range"||A.isCollapsed||!y?.contains(A.anchorNode)},[t]);E.useEffect(()=>{const y=ge(()=>{h(!0)},200,{leading:!0}),A=()=>{y.cancel(),h(!1)};return C?.addEventListener("pointerdown",y,{passive:!0}),document.addEventListener("pointerup",A,{passive:!0}),()=>{C?.removeEventListener("pointerdown",y),document.removeEventListener("pointerup",A)}},[C]),E.useEffect(()=>{const y=()=>{m(S())};return document.addEventListener("selectionchange",y,{passive:!0}),()=>{document.removeEventListener("selectionchange",y)}},[S]),vt(()=>{if(d||S())return m(!0);try{const y=e({width:u,height:l});y!=null&&T(y)}catch(y){N.logError("Invalid position in getToolbarPosition",y)}},[l,u,d,S,e]);const v=a.jsxs(G,{toolbarType:s,children:[a.jsx(xo,{isSendDisabled:c,getSelectionRange:o}),n]}),b=!d&&!g&&x!=null;return a.jsxs(a.Fragment,{children:[a.jsx("div",{"aria-hidden":"true",className:"pointer-events-none invisible fixed start-0 top-0 h-0 overflow-clip",children:a.jsx("div",{ref:f,children:v})}),a.jsx(H,{children:b&&a.jsx(k.div,{initial:{opacity:0,scale:.95},animate:{opacity:p?0:1,scale:p?.95:1},style:{top:x.top,left:x.left},exit:{opacity:0,scale:.95},transition:{type:"spring",bounce:.1,duration:.1,delay:p?0:.1},className:M("absolute",Y.toolbar,p?"pointer-events-none":"pointer-events-auto"),children:v})}),a.jsx(Me,{toolbarPosition:x,commentingOn:g,isWaitingForCommentResponse:i,onAddComment:r})]})};function bo(t){let e=t;for(;e;){const s=window.getComputedStyle(e).overflowY;if(s==="auto"||s==="scroll")return e;e=e.parentElement}return null}function Ro(t,e){const o=U(),s=ee(),n=o();E.useEffect(()=>{const r=n?.dom;if(!r||t.length===0)return;const i=bo(r),c=e?yt(e,100):null;return i&&c&&i.addEventListener("scroll",c,{passive:!0}),()=>{c&&(i&&i.removeEventListener("scroll",c),c.cancel())}},[n,s,t,e])}let F=null;function Io(){if(F!=null)return F;if(typeof window>"u")return 0;const t=document.createElement("div");t.style.width="100px",t.style.height="100px",t.style.overflow="scroll",t.style.position="absolute",t.style.top="-9999px",document.body.appendChild(t);try{F=t.offsetWidth-t.clientWidth}finally{document.body.removeChild(t)}return F}function Ho(t){return t==null?null:t.scrollHeight>t.clientHeight}export{Pt as A,jo as C,Bo as T,ho as a,We as b,G as c,Io as g,Ho as i,Ro as u};
//# sourceMappingURL=pclfr6lyaiirijb5.js.map
