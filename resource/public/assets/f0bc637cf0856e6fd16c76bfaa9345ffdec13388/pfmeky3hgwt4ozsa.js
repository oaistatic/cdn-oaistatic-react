import{r as c,j as t,m as S,M as W,f as H,B as cs,u as us,c as ds,d as Rt,A as ue,aq as dt,E as mt,as as Le,R as De}from"./m60bpb0x3x7rg8fj.js";import{uo as V,z as I,hH as ms,B as At,ef as Be,cO as We,I as fs,fc as X,t as Et,ho as ps,Y as hs,hz as gs,hC as xs,aW as Ot,P as Ie,i3 as ys,v as qe,N as Xe,c as Lt,gI as ws,hw as A,aC as Ve,aa as xe,hl as Dt,nl as Pt,gV as vs,l as js,j1 as bs,j2 as Cs,j3 as _s,j9 as Ns,ah as Ms,du as Ft,e as zt,p as Ht,gR as Ss,dK as ks,rc as Ts,f5 as ft,h9 as Is,dU as Rs,q as As,G as Es,ap as Os}from"./lgw4q0e8zlqqfgug.js";import{a as Ls,b as Ds,u as Ps,C as Fs}from"./kkg7k3irromdz83f.js";import{iH as x,tJ as zs,tK as Qe,tL as $t,cc as _e,iu as Hs,tM as Bt,mA as ke,tN as $s,ci as Wt,tO as Bs,tP as Ws,iC as Vs,ej as Us,cg as Gs,ch as qs,cj as Xs,ce as Qs,tQ as Ys,cf as Zs,tR as Js,tS as Te,kO as Ks,jR as ea,tT as ta,aI as sa,tU as aa,tV as na,tW as ra,tX as oa,tY as ia,tZ as la,t_ as ca,t$ as Ye,id as ua,m9 as da,ib as ma,ic as fa,u0 as pa,h8 as ha,u1 as ga,fP as xa,f0 as ya,f1 as wa,u2 as va,f2 as ja,u3 as ba,u4 as pt,u5 as Pe,u6 as ht,u7 as gt,aP as Ca,u8 as _a,as as Na,j as Ma,u9 as Sa}from"./ggjzadbnd3k1vu0k.js";import{M as ka}from"./h81zqbvh0a7amk0o.js";import{S as Ta}from"./cs281ckvaib8kadh.js";import{u as Ia}from"./mog17ocsx2bkw4q4.js";import{s as Ra,l as Aa}from"./l8y86l5s35pa16ob.js";import{S as Ea}from"./df3y7yi36gehsn95.js";import{S as Oa,C as La,H as Da,t as ce}from"./g5bh4mjh9t2vmm93.js";import{shell as Pa}from"./pbl95wx6493wq92j.js";import{E as Ue,b as Fa,V as za,R as Ha,D as Vt}from"./j770ggbjd02m3hqj.js";import{C as $a}from"./crheuewn890nts1d.js";import{D as Ba}from"./mr7j3fxti6m51rk7.js";import{u as Wa}from"./j4gbrzdh1iwlkiif.js";import{S as Va}from"./lp550lzjbjov6tk6.js";import"./lqxrayj6ap3vzwmb.js";import"./hv81c3k3l9e69foo.js";function ye(e,s,n,r,a,o){if(r&&a&&!n)return e.formatMessage({id:"xvTcn5",defaultMessage:"Stopping"});if("title"in s&&s.title)return s.title;switch(s.type){case x.Thought:return s.thought.summary;case x.Recap:return s.content;case x.N7jupdAPI:return Ce({action:s.action,source:s.source,intl:e});case x.Browsing:return Ut({contextualAnswerSources:s.sources,intl:e});case x.Search:return n?e.formatMessage({id:"+a5J9x",defaultMessage:"Searched the web"}):e.formatMessage({id:"GamH3R",defaultMessage:"Searching the web"});case x.CodeAnalysis:return n?e.formatMessage({id:"SGdXPO",defaultMessage:"Analyzed"}):e.formatMessage({id:"rEhiFx",defaultMessage:"Analyzing"});case x.ImageAnalysis:return n?e.formatMessage({id:"fjqIXj",defaultMessage:"Analyzed image"}):e.formatMessage({id:"D//PTx",defaultMessage:"Analyzing image"});case x.ComputerOutput:return n?e.formatMessage({id:"PlB7p/",defaultMessage:"Browsed the web"}):s.thoughts?.at(-1)??e.formatMessage({id:"HFx/8x",defaultMessage:"Browsing the web"});case x.e1ld0dvz:return s.tasks.every(i=>i.status==="completed")?e.formatMessage({id:"WUrSuY",defaultMessage:"Completed tasks"}):e.formatMessage({id:"tH3LAN",defaultMessage:"Running tasks"});case x.N7jupdLoading:return Ga(e,o);case x.Glaux:return Ua(e,s,n)}}const Ua=(e,s,n)=>{if(s.queries.length>1){const a="*",o=new Map;if(s.queries.forEach(({connectorName:u})=>{o.set(u,(o.get(u)??0)+1)}),o.has(a))return n?e.formatMessage({id:"x+iQ54",defaultMessage:"Searched across connectors"}):e.formatMessage({id:"jsjYQX",defaultMessage:"Searching across connectors"});let i=Array.from(o.entries()).toSorted(([u,d],[m,f])=>f-d).map(([u])=>u);if(i.length>3){const u=i.length-2;i=[...i.slice(0,2),e.formatMessage({id:"45+rh1",defaultMessage:"{number} others"},{number:u})]}const l=e.formatList(i);return n?e.formatMessage({id:"OvXUzx",defaultMessage:"Searched {connectorNames}"},{connectorNames:l}):e.formatMessage({id:"r44Nbg",defaultMessage:"Searching {connectorNames}"},{connectorNames:l})}else return n?e.formatMessage({id:"olKix8",defaultMessage:'Searched for "{query}"'},{query:s.queries[0].query}):e.formatMessage({id:"1TTELb",defaultMessage:'Searching for "{query}"'},{query:s.queries[0].query})},Ga=(e,s)=>s===V.Research?e.formatMessage({id:"CsSGJm",defaultMessage:"Starting research"}):s===V.Autoswitch?e.formatMessage({id:"9CDId8",defaultMessage:"Thinking longer with agent mode"}):s===V.KAUR1BR5?e.formatMessage({id:"QqaVzm",defaultMessage:"Getting started..."}):e.locale.startsWith("en")&&s===V.Random?qa(e):e.formatMessage({id:"gw6x6T",defaultMessage:"Setting up my desktop"}),xt=[{text:"Pouring a cup of coffee",weight:1},{text:"Sharpening pencils",weight:1},{text:"Consulting the rubber duck",weight:1},{text:"Negotiating with servers",weight:1},{text:"Tuning caffeine levels",weight:1},{text:"Untangling the wires",weight:1},{text:"Refilling the printer paper",weight:1},{text:"Baking cookies â€” HTTP only, of course",weight:1},{text:"Looking for snacks",weight:1},{text:"Warming up the neurons",weight:1},{text:"Folding the transformer layers neatly",weight:1},{text:"Plugging into the matrix",weight:1},{text:"Downloading the extended trilogy",weight:1},{text:"Putting on my super suit",weight:1},{text:"Building additional pylons",weight:1},{text:"Reticulating splines",weight:1},{text:"Blowing dust out of the cartridge",weight:1},{text:"Installing the flux capacitor",weight:1},{text:"Ordering extra pizza for the Turtles",weight:1},{text:"Refining the data",weight:1}];function qa(e){const s=xt.reduce((r,a)=>r+a.weight,2e3);let n=Math.random()*s;for(const{text:r,weight:a}of xt){if(n<a)return r;n-=a}return e.formatMessage({id:"gw6x6T",defaultMessage:"Setting up my desktop"})}const Ce=({action:e,source:s,intl:n})=>e==="n7jupd_as"?n.formatMessage({id:"np3RkB",defaultMessage:"Checking available APIs"}):e==="n7jupd_ag"?n.formatMessage({id:"Q0QNzM",defaultMessage:"Reading API documentation"}):e==="n7jupd_cf"&&!s?n.formatMessage({id:"soOFxK",defaultMessage:"Reading from API"}):e==="n7jupd_cf"&&s?n.formatMessage({id:"1ETpL6",defaultMessage:"Reading from {source}"},{source:s.name}):e==="n7jupd_cs"&&s?n.formatMessage({id:"nqEMzN",defaultMessage:"Searching {source}"},{source:s.name}):n.formatMessage({id:"soOFxK",defaultMessage:"Reading from API"}),Ut=({contextualAnswerSources:e,intl:s})=>{if(e.length===0)return s.formatMessage({id:"browsingMessage.startingRetrieval",defaultMessage:"Reading documents"});const n=e.map(r=>zs[r]).filter(Boolean);return e.length===1?s.formatMessage({id:"Jzt2om",defaultMessage:"Reading {source}"},{source:n[0]}):e.length===2?s.formatMessage({id:"wTM7gR",defaultMessage:"Reading {source1} and {source2}"},{source1:n[0],source2:n[1]}):s.formatMessage({id:"xnwjH1",defaultMessage:"Reading {source1}, {source2} and more"},{source1:n[0],source2:n[1]})},Xa=({url:e,withBorder:s=!1})=>{const{isSuccess:n,isError:r}=Qe($t(e,32)),[a]=c.useState(n);return r?null:t.jsx(S.div,{initial:{opacity:a?1:0},animate:{opacity:n?1:0},className:I("bg-primary -ms-3 box-content size-4 shrink-0 overflow-hidden rounded-full first:-ms-1",s&&"border-token-main-surface-secondary group-hover:border-token-text-primary dark:group-hover:border-token-text-primary border"),children:t.jsx(_e,{url:e,size:32,className:"m-0"})})};function Qa({tabs:e,activeTab:s,setActiveTab:n,initializing:r=!1}){const a=t.jsx(W,{id:"odyssey.tabBar.newTab",defaultMessage:"New tab"});return r?t.jsx("nav",{className:"bg-token-bg-tertiary flex flex-1 items-center gap-1 rounded-t-xl",children:t.jsx("div",{className:"flex flex-1 items-center gap-1",children:t.jsx(wt,{onClick:()=>{},active:!0,children:a})})}):t.jsx("nav",{className:"bg-token-bg-tertiary flex flex-1 items-center gap-1 rounded-t-xl",children:t.jsx("div",{className:"flex flex-1 items-center gap-1",children:e.map(o=>t.jsx(wt,{active:s===o.label,icon:o.icon,onClick:()=>n(o.label),children:o.label},o.icon))})})}function yt({side:e}){return t.jsx("span",{"aria-hidden":!0,className:I("pointer-events-none absolute bottom-0 h-3 w-3 bg-transparent z-10",e==="left"?"end-full rounded-ee-[50%] shadow-[4px_0_0_0_var(--bg-primary)]":"start-full rounded-es-[50%] shadow-[-4px_0_0_0_var(--bg-primary)]")})}function wt({active:e=!1,icon:s,children:n,onClick:r}){return t.jsxs("div",{className:I("relative rounded-t-xl py-2 ps-4 pe-4.5 text-[11px] leading-[13px] font-medium whitespace-nowrap",e?"bg-token-bg-primary text-token-text-primary":"text-token-text-secondary hover:bg-token-bg-primary/60 hover:text-token-text-primary"),onClick:r,children:[e&&t.jsxs(t.Fragment,{children:[t.jsx(yt,{side:"left"}),t.jsx(yt,{side:"right"})]}),t.jsxs("div",{className:"flex flex-row items-center gap-1",children:[s?t.jsx(Xa,{url:s}):t.jsx(Hs,{className:"size-4"}),n]})]})}const Ya=({chunk:e,isFinalAssistantTurn:s,hidePowTombstone:n,isKAUR1BR5:r})=>{const a=e.screenshots.at(-1),{origin:o,domain:i}=c.useMemo(()=>Bt(a),[a]),l=ke(a,void 0),{open:u,isVNCEnabled:d}=ms(),[m,f]=c.useState(null),[p,h]=c.useState(!1);return c.useEffect(()=>{if(!l)return;let g=!1;h(!1);const _=new Image;return _.src=l,_.onload=()=>!g&&f(l),_.onerror=()=>{g||(h(!0),f(null))},()=>{g=!0}},[l]),s?t.jsxs(S.div,{className:"group border-token-border-heavy relative flex max-w-md flex-1 cursor-default flex-col gap-2 overflow-hidden rounded-2xl border",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.4,ease:"easeInOut"},children:[t.jsxs("div",{className:"bg-token-bg-tertiary flex flex-col",children:[t.jsx("div",{className:"align-start flex flex-row gap-1 px-1 pt-1 text-sm",children:t.jsx(Qa,{tabs:[{icon:o??"",label:i??""}],activeTab:i,setActiveTab:()=>{},initializing:!1})}),t.jsx("div",{className:"group relative aspect-[1024/698] w-full",children:m?t.jsx("img",{src:m,alt:"Screenshot that shows the model used the computer",className:"absolute inset-0 h-full w-full object-cover object-bottom"},m):t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsx("div",{className:"border-token-border-heavy h-4 w-4 animate-spin rounded-full border-2 border-t-transparent"})})})]}),d&&t.jsx("div",{className:"absolute inset-0 z-100 flex h-full w-full items-center justify-center bg-black/50 opacity-0 transition-opacity group-hover:opacity-100",children:t.jsx(At,{color:"primary-inverse",onClick:()=>u(),children:t.jsx("div",{className:"flex items-center gap-1",children:r?t.jsx(W,{id:"ahugQu",defaultMessage:"Open tabs"}):t.jsx(W,{id:"Kj2mXr",defaultMessage:"Take over"})})})})]},"proof-of-work"):n?null:t.jsx(Za,{})},Za=()=>t.jsxs(S.div,{className:"border-token-border-default group flex max-w-xs items-center gap-2 rounded-2xl border p-4 select-none",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.25,ease:"easeInOut"},children:[t.jsx(Ta,{className:"icon"}),t.jsx("span",{className:"flex-1 truncate text-sm font-medium",children:t.jsx(W,{id:"cot.proofofwork.tombstone",defaultMessage:"Used the browser"})})]},"tombstone"),Ja=({chunks:e,isExpanded:s,isFinalAssistantTurn:n,hidePowTombstone:r,isKAUR1BR5:a})=>{const o=c.useMemo(()=>en(e),[e]);return o?t.jsx(tn,{chunk:o,isExpanded:s,isFinalAssistantTurn:n,hidePowTombstone:r,isKAUR1BR5:a}):null},Ka=c.memo(Ja),en=e=>Be(e,s=>s.type===x.ComputerOutput&&!s.isBlank&&s.screenshots?.length>0),tn=({chunk:e,isExpanded:s,isFinalAssistantTurn:n,hidePowTombstone:r,isKAUR1BR5:a})=>{switch(e.type){case x.ComputerOutput:return t.jsx(Ya,{chunk:e,isExpanded:s,isFinalAssistantTurn:n,hidePowTombstone:r,isKAUR1BR5:a});default:return null}};function sn(e,s,n,r,a){const[o,i]=c.useState(V.Setup),l=c.useMemo(()=>e.every(d=>d.type===x.N7jupdLoading)&&s,[e,s]),u=c.useMemo(()=>{const d=We(e);return d?.type!==x.N7jupdLoading?!1:d?.needs_startup},[e]);return c.useEffect(()=>{const d=setTimeout(()=>{i(V.Random)},7e3),m=setTimeout(()=>{i(V.Animation)},15e3);return()=>{clearTimeout(d),clearTimeout(m)}},[]),r&&l?V.Autoswitch:n===fs.Research&&l?V.Research:l?u?o:a?V.KAUR1BR5:V.Thinking:V.Done}const an=24,vt=12,Fe=4,nn=5e3;function rn(e){const s=new Set,n=new Set;for(const r of e)if(r.type===x.Search){for(const a of r.queries)s.add(a.q);for(const a of r.sources)n.add(a.domain)}return{queries:s.size,sources:n.size}}const on=({chunk:e,isExpanded:s,isComplete:n})=>{const r=H(),a=e.assistantMessage,o=e.toolMessage,i=a!=null&&Gt(a)!=null;return t.jsxs("div",{className:"flex w-full flex-col gap-2 text-sm",children:[s&&ye(r,e,n),i&&t.jsxs("div",{children:[t.jsx(ln,{message:a,forceDarkMode:!0,showActionBar:!1,codeRendererClassName:I("rounded-md max-h-[calc(clamp(20px,1/4*var(--thread-safe-area-height,100lvh),400px))] overflow-auto",o&&"rounded-b-none"),codeContainerClassName:"overflow-visible!"}),o&&t.jsx(cn,{forceDarkMode:!0,wrapperClassName:"max-h-[calc(clamp(20px,1/8*var(--thread-safe-area-height,100lvh),200px))] w-full overflow-auto dark rounded-b-md",codeContainerClassName:"whitespace-pre-wrap",message:o})]})]})};function Gt(e){function s(r,a,o){return`\`\`\`${o}
agent@chatgpt:${r}$ ${a}
\`\`\``}function n(r){const a=JSON.parse(r);if(!a.cmd)return null;const o=a.workdir??"/";return a.cmd.length===3&&a.cmd[0]==="bash"&&a.cmd[1]==="-lc"?s(o,a.cmd[2],a.cmd[2].startsWith("python")?"python":"bash"):s(o,a.cmd.join(" "),"bash")}if(e.recipient!=="container.exec")return null;switch(e.content.content_type){case X.Code:return n(e.content.text);case X.Text:return n(e.content.parts.join(""));default:return null}}function ln({message:e,codeRendererClassName:s,forceDarkMode:n,removeTopBorderRadius:r,showActionBar:a,codeContainerClassName:o}){const i=Et()||n,l=Gt(e);return l==null?null:t.jsx($s.Provider,{value:{isWithinDataAnalysisToolMessage:!0},children:t.jsx(Wt,{className:I("markdown prose dark:prose-invert w-full break-words",i?"dark":"light"),forceDarkMode:n,componentOverrides:{code:u=>t.jsx(Bs,{...u,wrapperClassName:s,codeContainerClassName:o,removeTopBorderRadius:r,showActionBar:a})},children:l})})}function cn({message:e,wrapperClassName:s,codeContainerClassName:n,forceDarkMode:r}){const a=e.content.content_type==="text"?e.content.parts.join(""):null;return a?t.jsx(Ws,{forceDarkMode:r,wrapperClassName:s,codeContainerClassName:n,output:a,label:null}):null}function un(){return Date.now()}function dn({tasks:e}){return t.jsxs("div",{className:"flex w-full flex-col gap-1",children:[t.jsx("div",{className:"text-token-text-secondary mb-1 text-sm",children:t.jsx(W,{id:"FTmQVN",defaultMessage:"Delegated Tasks"})}),t.jsx("div",{className:"flex flex-col divide-y divide-gray-200 rounded-lg border border-gray-200",children:e.map(s=>t.jsx(mn,{task:s},String(s.id)))})]})}function mn({task:e}){const s=e.startedAtMs??un(),n=Vs(s,90*1e3),r=e.status==="completed"?t.jsx(ps,{className:"icon text-token-text-secondary h-4 w-4"}):e.status==="gathering"||e.status==="running"?t.jsx(Us,{percentage:n,thickness:1/12,className:"text-token-text-tertiary h-4 w-4",backgroundStrokeClassName:"stroke-token-main-surface-tertiary",transitionDuration:`${(100-n)/100*.2}s`,transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)"}):t.jsx("div",{className:"h-4 w-4"});return t.jsxs("div",{className:"grid grid-cols-[1fr_auto] items-center gap-2 p-2",children:[t.jsx("div",{className:"min-w-0",children:t.jsx("div",{className:"text-token-text-tertiary truncate text-xs",children:e.instruction??e.model})}),t.jsx("div",{className:"flex items-center justify-center",children:r})]})}const fn=({chunk:e,isExpanded:s,isComplete:n})=>{const r=H(),a=e.assistantMessage,o=e.toolMessage,i=a!=null&&Gs(a)!=null;return t.jsxs("div",{className:"flex w-full flex-col gap-2 text-sm",children:[s&&ye(r,e,n),i&&t.jsxs("div",{children:[t.jsx(qs,{message:a,forceDarkMode:!0,FormattedText:Wt,showActionBar:!1,codeRendererClassName:I("rounded-md max-h-[calc(clamp(20px,1/4*var(--thread-safe-area-height,100lvh),400px))] overflow-auto",o&&"rounded-b-none"),codeContainerClassName:"overflow-visible!"}),o&&t.jsx(Xs,{forceDarkMode:!0,wrapperClassName:"max-h-[calc(clamp(20px,1/8*var(--thread-safe-area-height,100lvh),200px))] w-full overflow-auto dark rounded-b-md",codeContainerClassName:"whitespace-pre-wrap",message:o,showLabel:!1})]})]})},pn=({chunk:e,isExpanded:s,isComplete:n})=>{const r=H(),a=e.toolMessage,o=cs(),{isUnauthenticated:i}=hs();let l;const u=a.author.name?.includes("container")??!1;if(a.author.name?.includes("python")){const h=a.metadata?.aggregate_result?.messages.find(Qs);l=h?.image_url&&gs(h.image_url)}else u&&(l=a.metadata?.attachments?.[0]?.id);const{data:d}=us(l?Js(l,i):{enabled:!1,queryKey:[]}),m=d?.status===xs.Success?d.download_url:void 0,{isSuccess:f}=Qe(m),[p]=c.useState(f);return t.jsxs("div",{className:"flex w-full flex-col gap-2 text-sm",children:[s&&ye(r,e,n),t.jsxs("div",{className:"bg-token-bg-secondary relative flex h-[calc(clamp(150px,1/4*var(--thread-safe-area-height,100lvh),400px))] justify-center overflow-hidden rounded-md p-2",children:[m&&t.jsx(S.div,{initial:{opacity:p?.5:0,scale:1.1},animate:{opacity:f?.5:0,scale:n||o?1.1:[1.1,1.25,1.1]},transition:{opacity:{ease:"easeInOut"},scale:n?{type:"spring",stiffness:300,damping:20}:{duration:2.5,repeat:1/0,ease:"easeInOut"}},className:"absolute inset-0 bg-cover bg-center bg-no-repeat opacity-40 blur-lg filter",style:{backgroundImage:`url(${JSON.stringify(m)})`}}),t.jsx(S.div,{initial:{opacity:p?1:0},animate:{opacity:f?1:0},className:"relative *:m-0 *:h-full *:w-full *:rounded-md *:object-center *:shadow-lg",children:l&&(u?t.jsx(Ys,{fileId:l}):t.jsx(Zs,{isCoT:!0,message:a}))})]})]})},hn=4,gn=3,xn=3,yn={hidden:{opacity:0},visible:{opacity:1}},jt={hidden:{opacity:0,x:-5},visible:{opacity:1,x:0}},wn=({chunk:e,isExpanded:s,isComplete:n})=>{const r=H();if(!e.searchResults&&!e.fetchResult)return s&&t.jsx(Te,{content:Ce({action:e.action,source:e.source,intl:r})});const a=[];let o=[];if(e.action==="n7jupd_cs"&&e.searchResults)o=e.searchResults.map(l=>({entries:[{url:l.url,title:l.title,snippet:"",attribution:l.title}]}));else if(e.action==="n7jupd_cf"&&e.fetchResult)o=[{entries:[{url:e.fetchResult?.url,title:e.fetchResult?.title,snippet:"",attribution:e.fetchResult?.title}]}];else return null;const i={type:x.Search,queries:a,sources:o};return s&&t.jsx(Ze,{chunk:i,isExpanded:s,isComplete:n,headlineContents:Ce({action:e.action,source:e.source,intl:r}),useCloudDocIcons:!0})},vn=({chunk:e,isExpanded:s,isComplete:n})=>{const r=H();return t.jsx(Ze,{chunk:e,isExpanded:s,isComplete:n,headlineContents:ye(r,e,n),useCloudDocIcons:!1})},Ze=({chunk:e,isExpanded:s,isComplete:n,headlineContents:r,useCloudDocIcons:a,isSmall:o,isVisualCoT:i=!1})=>{const{queries:l,sources:u}=e,[d,m]=c.useState(n),f=i?S.div:"div";return t.jsxs(f,{className:I("flex min-w-0 flex-col gap-2 text-sm",i&&"overflow-hidden"),...i?{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},transition:{duration:.25,ease:"easeOut"}}:{},children:[s&&r,t.jsxs("div",{className:"flex min-w-0 flex-col gap-1",children:[t.jsx(bt,{isComplete:n,items:l,max:xn,getKey:p=>p.q,Item:jn,ShowMoreButton:_n,onAnimationComplete:()=>m(!0),isSmall:o,isVisualCoT:i}),t.jsx(bt,{isComplete:n,items:d?u:[],max:hn,getKey:p=>p.entries[0].url,Item:bn,ShowMoreButton:Cn,useCloudDocIcons:a,isSmall:o,isVisualCoT:i})]})]})},bt=({isComplete:e,items:s,max:n,getKey:r,Item:a,ShowMoreButton:o,onAnimationComplete:i,useCloudDocIcons:l,isSmall:u,isVisualCoT:d=!1})=>{const[m,f]=c.useState(!1),[p,h]=s.length>n?[s.slice(0,n-1),s.slice(n-1)]:[s];return t.jsxs(S.div,{className:I("flex flex-wrap items-center gap-1",d&&"justify-center"),initial:d?"hidden":e?"visible":"hidden",animate:"visible",transition:{duration:.25,staggerChildren:.1,delayChildren:.3},onAnimationComplete:i,children:[p.map(g=>t.jsx(S.div,{variants:yn,className:"flex max-w-full items-center",children:t.jsx(a,{item:g,isComplete:e,useCloudDocIcons:l,isSmall:u,isVisualCoT:d})},r(g))),m&&t.jsx(S.div,{className:"contents",initial:"hidden",animate:"visible",transition:{duration:.2,staggerChildren:.02},children:h?.map(g=>t.jsx(S.div,{variants:jt,className:"flex max-w-full items-center",children:t.jsx(a,{item:g,isComplete:e,useCloudDocIcons:l,isSmall:u,isVisualCoT:d})},r(g)))}),h&&t.jsx(S.div,{variants:jt,className:"flex items-center",children:t.jsx(o,{moreItems:h,isShowingMore:m,onClick:()=>f(g=>!g),useCloudDocIcons:l,isSmall:u})},"more")]})},jn=({item:e,isSmall:s})=>t.jsxs(Ae,{componentType:"span",isSmall:s,children:[t.jsx(Ot,{className:"-ms-1 h-3 w-3 shrink-0"}),t.jsx("span",{className:"max-w-[8rem] overflow-hidden text-ellipsis whitespace-nowrap",children:e.q})]}),bn=({item:e,isComplete:s,useCloudDocIcons:n,isSmall:r,isVisualCoT:a})=>{const o=e.entries[0],i=c.useMemo(()=>({url:o.url,title:o.title}),[o.url,o.title]);c.useEffect(()=>{Ie.logEvent("link_action",{...i,action:"show"})},[i]);const l=()=>{Ie.logEvent("link_action",{...i,action:"click"})},u=o.attribution??Ks(o.url);return t.jsxs(Ae,{componentType:ys,href:o.url,onClick:l,animateScan:!s,isSmall:r,children:[t.jsx(qt,{url:o.url,useCloudDocIcons:n}),a?t.jsx("div",{className:"max-w-[8rem] truncate",children:u}):u]})},qt=({url:e,withBorder:s=!1,useCloudDocIcons:n})=>{const{isSuccess:r,isError:a}=Qe($t(e,32)),[o]=c.useState(r);if(a)return null;if(n){const i=ea(e);if(i?.Icon!=null)return t.jsx(S.div,{initial:{opacity:o?1:0},animate:{opacity:r?1:0},className:I("bg-token-main-surface-primary -ms-3 box-content h-3 w-3 shrink-0 overflow-hidden rounded-full first:-ms-1",s&&"border-token-main-surface-secondary group-hover:border-token-text-primary dark:group-hover:border-token-text-primary border"),children:t.jsx(i.Icon,{className:"m-0 h-3 w-3"})})}return t.jsx(S.div,{initial:{opacity:o?1:0},animate:{opacity:r?1:0},className:I("bg-token-main-surface-primary -ms-3 box-content h-3 w-3 shrink-0 overflow-hidden rounded-full first:-ms-1",s&&"border-token-main-surface-secondary group-hover:border-token-text-primary dark:group-hover:border-token-text-primary border"),children:t.jsx(_e,{url:e,size:32,minSize:16,className:"m-0 h-3 w-3"})})},Cn=({moreItems:e,isShowingMore:s,onClick:n,useCloudDocIcons:r,isSmall:a})=>t.jsx(Ae,{onClick:n,isSmall:a,children:s?t.jsx(W,{id:"19fGXl",defaultMessage:"Show less"}):t.jsxs(t.Fragment,{children:[e.slice(0,gn).map((o,i)=>t.jsx(qt,{url:o.entries[0].url,withBorder:!0,useCloudDocIcons:r},i)),t.jsx("div",{className:"max-w-[8rem] truncate",children:t.jsx(W,{id:"5ob5C8",defaultMessage:"{count} more",values:{count:e.length}})})]})}),_n=({moreItems:e,isShowingMore:s,onClick:n,isSmall:r})=>t.jsx(Ae,{onClick:n,isSmall:r,children:s?t.jsx(W,{id:"0SWns2",defaultMessage:"Show less"}):t.jsx(W,{id:"PpZw7t",defaultMessage:"{count} more",values:{count:e.length}})}),Nn=1500,Ae=e=>{"use forget";const s=ds.c(26);let n,r,a,o,i,l;s[0]!==e?({className:a,componentType:i,children:r,animateScan:n,isSmall:l,...o}=e,s[0]=e,s[1]=n,s[2]=r,s[3]=a,s[4]=o,s[5]=i,s[6]=l):(n=s[1],r=s[2],a=s[3],o=s[4],i=s[5],l=s[6]);const u=i===void 0?"button":i,d=l===void 0?!1:l,[m,f]=c.useState(!1),p=Math.random()*Nn;let h,g;s[7]!==n?(h=()=>{n&&(f(!1),requestAnimationFrame(()=>f(!0)))},g=[n,p],s[7]=n,s[8]=h,s[9]=g):(h=s[8],g=s[9]),c.useEffect(h,g);const _=d?Ra:Aa,N=n&&"dark:border-token-main-surface-secondary border border-[#f4f4f4] bg-transparent dark:bg-transparent",k=(o.href!=null||o.onClick!=null)&&"hover:bg-token-main-surface-primary-inverse hover:text-token-text-inverted dark:hover:bg-token-text-primary";let E;s[10]!==a||s[11]!==_||s[12]!==N||s[13]!==k?(E=I(_,"group relative max-w-full overflow-hidden",N,k,a),s[10]=a,s[11]=_,s[12]=N,s[13]=k,s[14]=E):E=s[14];let y;s[15]!==n||s[16]!==m?(y=n&&t.jsx("span",{className:I("dark:bg-token-main-surface-secondary absolute start-0 top-0 z-[-1] h-full rounded-se-full rounded-ee-full bg-[#f4f4f4] transition-[width] ease-in-out",m?"w-full":"w-0"),style:{transitionDuration:`${p}ms`}}),s[15]=n,s[16]=m,s[17]=y):y=s[17];let R;s[18]!==r?(R=t.jsx("div",{className:"z-1 inline-flex items-center gap-1",children:r}),s[18]=r,s[19]=R):R=s[19];let F;return s[20]!==u||s[21]!==o||s[22]!==R||s[23]!==E||s[24]!==y?(F=t.jsxs(u,{className:E,...o,children:[y,R]}),s[20]=u,s[21]=o,s[22]=R,s[23]=E,s[24]=y,s[25]=F):F=s[25],F},Ct=null,Mn=()=>null;var Xt=(e=>(e.STATIC="static",e.ENTER="enter",e.STAGE="stage",e))(Xt||{});const Sn=({index:e,chunk:s,onClick:n,onMeasure:r,onAnimationComplete:a,gap:o=0,showBullet:i=!1,isExpanded:l=!1,isAnimationComplete:u=!1,isLast:d=!1,isKAUR1BR5:m=!1,hasGlauxMessages:f=!1})=>{const p=d||l,h=!d||u,g=d?0:o,_=h?"static":"stage",N=h?"static":"enter",k=c.useRef(null);k.current=()=>{a?.(e,"enter")},c.useEffect(()=>{if(N!=="enter")return;const R=setTimeout(()=>{qe.count(Xe.COT_SUMMARIZER,"cot_chunk_timeout"),k.current?.()},nn);return()=>clearTimeout(R)},[N]);const E=N==="static",y=c.useRef(null);return Lt(()=>ta({axis:"height",target:y.current,onChange:({height:R})=>r(e,R)}),[]),t.jsx(S.div,{role:l?void 0:"button",variants:{static:{opacity:1,scale:1,position:"static",translateY:0},enter:{position:"static",translateY:0,scale:1,opacity:1},stage:{position:"absolute",translateY:-24,scale:.95,opacity:0}},initial:_,animate:N,exit:l?void 0:{opacity:0,pointerEvents:"none",position:"absolute",translateY:an,filter:"blur(8px)"},style:{zIndex:e},transition:u||N==="static"?{duration:0}:{type:"spring",bounce:.05},className:I("text-token-text-secondary start-0 end-0 top-0 flex origin-left",!p&&"pointer-events-none"),onAnimationComplete:R=>R!=="enter"&&a(e,R),onClick:n,ref:y,children:t.jsx(sa,{onComplete:k.current,isDisabled:E,defaultDelayPerSegmentMs:20,children:i?t.jsxs("div",{className:I("relative flex w-full items-start gap-2 overflow-clip",Ct),children:[Ct,t.jsxs("div",{className:"flex h-full w-4 shrink-0 flex-col items-center",children:[t.jsx("div",{className:"flex h-5 shrink-0 items-center justify-center",children:t.jsx(Ls,{chunk:s,size:"small"})}),!d&&t.jsx(S.div,{initial:{translateY:-24,opacity:0},animate:{translateY:0,opacity:1},className:"bg-token-border-heavy h-full w-[1px] rounded-full"})]}),t.jsx("div",{className:"w-full",style:{marginBottom:g},children:t.jsx(_t,{chunk:s,isExpanded:l,isComplete:h,isLast:d,isKAUR1BR5:m,hasGlauxMessages:f})})]}):t.jsx("div",{className:"w-full",style:{marginBottom:g},children:t.jsx(_t,{chunk:s,isExpanded:l,isComplete:h,isLast:d,isKAUR1BR5:m})})})})},kn=c.memo(Sn),_t=({chunk:e,isExpanded:s,isComplete:n,isLast:r,isKAUR1BR5:a,hasGlauxMessages:o})=>{const i=H();switch(e.type){case x.Thought:return t.jsx(Te,{content:e.thought.content.trim()||e.thought.summary});case x.Recap:return e.content.includes("Stopped")?t.jsx("div",{className:"text-token-text-secondary text-sm",children:t.jsx(W,{id:"sOsSsn",defaultMessage:"Stopped"})}):o&&!r?t.jsx("div",{className:"text-token-text-secondary text-sm",children:e.content}):t.jsx("div",{className:"text-token-text-secondary text-sm",children:t.jsx(W,{id:"Eo2n2s",defaultMessage:"Done"})});case x.Search:return t.jsx(vn,{chunk:e,isExpanded:s,isComplete:n});case x.CodeAnalysis:{const l=e.assistantMessage,u=e.toolMessage;return l?.recipient==="container.exec"&&l?.metadata?.n7jupd_message&&u?.metadata?.n7jupd_message?t.jsx(on,{chunk:e,isExpanded:s,isComplete:n}):t.jsx(fn,{chunk:e,isExpanded:s,isComplete:n})}case x.N7jupdAPI:return e.action==="n7jupd_as"||e.action==="n7jupd_ag"?s&&t.jsx(Te,{content:Ce({action:e.action,source:e.source,intl:i})}):t.jsx(wn,{chunk:e,isExpanded:s,isComplete:n});case x.Browsing:return s&&t.jsx(Te,{content:Ut({contextualAnswerSources:e.sources,intl:i})});case x.ImageAnalysis:return t.jsx(pn,{chunk:e,isExpanded:s,isComplete:n});case x.ComputerOutput:return t.jsx(aa,{chunk:e,isKAUR1BR5:a});case x.N7jupdLoading:return null;case x.e1ld0dvz:return t.jsx(dn,{tasks:e.tasks});case x.Glaux:return t.jsx(Mn,{chunk:e,isExpanded:s,isComplete:n})}},Nt=new WeakMap;function Tn(e){const s=[];let n=!1;return e.forEach((r,a)=>{const o=a===e.length-1;let i=Nt.get([r,o]);i||(i=In(r,o),i&&Nt.set([r,o],i)),i&&s.push(...i),n||(n=n||r.messages.some(l=>l.metadata?.n7jupd_message&&l.author.name!==ws.n7jupd_m&&l.content.content_type!==X.StructuredThoughts&&l.content.content_type!==X.ReasoningRecap))}),{chunks:s,isAgentVisualCoT:n}}function In(e,s){switch(e.type){case A.ReasoningRecap:{const n=e.messages[e.messages.length-1].content.content;return[{type:x.Recap,content:n}]}case A.Browsing:case A.RetrievalBrowsing:{const n=ca({messages:e.messages});return[{type:x.Browsing,sources:n,isRetrieval:e.type===A.RetrievalBrowsing,title:e.messages[0].metadata?.reasoning_title}]}case A.StructuredThoughts:{const n=[];for(const r of e.messages){const{thoughts:a}=r.content;for(const o of a)!o.content&&!o.summary||n.push({type:x.Thought,thought:o})}return n}case A.CodeInterpreter:case A.Container:{let n=e.messages.slice(1);const r=e.messages[0];let a=!0;if(r.author.role===Ve.Tool)n=e.messages,a=!1;else if(r.author.role!==Ve.Assistant){xe.addError(new Error("[cot] out of order code tool messages"));break}return n.map((i,l)=>({type:i!=null&&(la(i)||i.metadata?.attachments?.length)?x.ImageAnalysis:x.CodeAnalysis,toolMessage:i,assistantMessage:l===0&&a?r:void 0,messages:e.messages,title:l===0&&a?r.metadata?.reasoning_title:void 0}))}case A.CoTSearchTool:{const n={type:x.Search,queries:[],sources:[]};for(const r of e.messages)if(r.metadata?.reasoning_title&&(n.title=r.metadata.reasoning_title),r.metadata?.search_queries?.length&&(n.queries=r.metadata.search_queries),r.metadata?.search_result_groups?.length)for(const a of r.metadata.search_result_groups)n?.sources?.some(o=>o.domain===a.domain)||n.sources?.push(a);return[n]}case A.n7jupd:return ia(e.messages,s);case A.n7jupd_x:return oa(e);case A.n7jupd_a:return ra(e);case A.n7jupd_native_api_tool:return na(e);case A.e1ld0dvz:{const n=[],r=new Map;for(const a of e.messages)if(a.content.content_type===X.Code){if(a.metadata?.e1ld0dvz_tasks)for(const o of a.metadata.e1ld0dvz_tasks)r.set(o.id,{id:o.id,status:"running",model:o.model,instruction:o.instruction,startedAtMs:a.metadata?.e1ld0dvz_task_create_time?a.metadata?.e1ld0dvz_task_create_time:Date.now()});else if(a.metadata?.e1ld0dvz_task_ids)for(const o of a.metadata.e1ld0dvz_task_ids)if(r.has(o)){const i=r.get(o);i&&r.set(o,{...i,status:"gathering"})}else r.set(o,{id:o,status:"gathering"})}else if(a.metadata?.e1ld0dvz_status==="completed"&&a.metadata?.e1ld0dvz_task_id){const o=a.metadata.e1ld0dvz_task_id,i=r.get(o);i?r.set(o,{...i,status:"completed"}):r.set(o,{id:o,status:"completed"})}return n.push({type:x.e1ld0dvz,tasks:Array.from(r.values())}),n}case A.Glaux:{const n=[],r=[];for(const a of n){if(a.call==="unhandled")continue;const o=a.call.isMixer?a.call.queries.map(l=>({connectorName:l.connectorName,query:l.query})):[{connectorName:a.call.connectorName,query:a.call.query}];if(!o.length)continue;const i=a.results.map(l=>({...l}));r.push({type:x.Glaux,queries:o,results:i})}return r}}}const Rn=({radius:e=8,className:s=""})=>t.jsx("svg",{width:e,height:e,viewBox:`0 0 ${e} ${e}`,className:s,xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:`
        M 0 0 H ${e} V ${e} H 0 Z
        M ${e} 0
          A ${e} ${e} 0 0 1 0 ${e}
          L 0 0 Z
      `,fill:"currentColor",fillRule:"evenodd"})}),An=({radius:e=8,className:s=""})=>t.jsx("svg",{width:e,height:e,viewBox:`0 0 ${e} ${e}`,className:s,xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:`
        M 0 0 H ${e} V ${e} H 0 Z
        M 0 0
          A ${e} ${e} 0 0 0 ${e} ${e}
          L ${e} 0 Z
      `,fill:"currentColor",fillRule:"evenodd"})}),En=e=>c.createElement("svg",{width:16,height:16,viewBox:"0 0 16 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e},c.createElement("path",{d:"M10.4143 3.78804C11.2308 3.06073 12.5437 3.20285 13.1298 4.19364L13.469 4.77827C14.2729 6.19616 15.151 8.02487 15.1871 9.82449L15.1968 10.0908C15.2024 10.7193 15.0819 11.3931 14.7678 11.971C14.4183 12.6138 13.8308 13.126 12.9833 13.2848L12.8108 13.3115C12.326 13.3724 11.5719 13.3799 11.0197 13.3343L10.7964 13.3115C9.72823 13.1772 8.85301 12.4163 8.56337 11.3935L8.51324 11.1858C8.4115 10.6741 8.38934 10.1051 8.49305 9.56017C8.1699 9.47939 7.82797 9.47883 7.50477 9.55952C7.59002 10.0069 7.59095 10.4704 7.53212 10.9052L7.48524 11.1858C7.2753 12.2418 6.45372 13.0609 5.41297 13.277L5.20204 13.3115C4.71723 13.3724 3.96318 13.3799 3.41102 13.3343L3.18771 13.3115C2.24691 13.1932 1.60336 12.6565 1.23068 11.971C0.877576 11.3214 0.770462 10.5505 0.810761 9.859H0.81011C0.839224 7.78961 1.99128 5.6781 2.86936 4.19364L2.92795 4.09989C3.53924 3.19422 4.79402 3.0843 5.5842 3.78804L5.66167 3.86095L5.70725 3.91173C5.92082 4.17352 5.90559 4.55955 5.66167 4.80366C5.41756 5.04777 5.03095 5.06354 4.76909 4.84989L4.71896 4.80366L4.67534 4.76525C4.46743 4.59925 4.18745 4.64454 4.04514 4.83035L4.01649 4.87202C3.54668 5.66627 3.06093 6.54731 2.70139 7.44624C2.83303 7.40655 2.96918 7.37694 3.10894 7.3577L3.34852 7.33035C3.94296 7.27665 4.76074 7.28612 5.28081 7.3577L5.46831 7.38895C6.13623 7.52414 6.63592 7.86838 6.97873 8.32384C7.64014 8.11335 8.35785 8.11455 9.01909 8.32515C9.3932 7.82749 9.9545 7.46279 10.7177 7.3577L10.9572 7.33035C11.5517 7.27666 12.3695 7.2861 12.8895 7.3577L13.0061 7.37593C13.105 7.39399 13.2018 7.41774 13.2964 7.44624C13.0224 6.76121 12.6758 6.08637 12.3179 5.45275L11.982 4.87202C11.8431 4.63734 11.5047 4.57945 11.2802 4.80366L11.2294 4.84989C10.9675 5.06347 10.5809 5.04774 10.3368 4.80366C10.0767 4.5433 10.0766 4.12122 10.3368 3.86095L10.4143 3.78804ZM5.09917 8.67801C4.68473 8.62096 3.97381 8.61439 3.48524 8.65718L3.29058 8.67801C2.70261 8.75906 2.24423 9.21765 2.15516 9.7952L2.14214 9.91173C2.10767 10.437 2.19594 10.9542 2.40256 11.3343C2.5955 11.6891 2.88945 11.9302 3.35438 11.9886L3.53537 12.0068C3.99075 12.0434 4.64767 12.0373 5.03602 11.9886L5.14149 11.971C5.66169 11.8629 6.07228 11.4538 6.1773 10.9261L6.2118 10.7197C6.27602 10.2392 6.2307 9.76471 6.07248 9.40197C5.91713 9.04599 5.6531 8.78438 5.19357 8.69429L5.09917 8.67801ZM12.7079 8.67801C12.2935 8.62095 11.5826 8.6144 11.094 8.65718L10.8993 8.67801C10.381 8.74939 10.0917 9.0223 9.926 9.40197C9.74517 9.81659 9.71209 10.3774 9.82118 10.9261L9.84592 11.0296C9.99067 11.541 10.4284 11.9214 10.9625 11.9886L11.1441 12.0068C11.5995 12.0434 12.2564 12.0373 12.6447 11.9886L12.8108 11.9586C13.1813 11.8685 13.4277 11.6449 13.5966 11.3343C13.7773 11.0018 13.8669 10.5643 13.8635 10.1083L13.8563 9.91173C13.8174 9.31963 13.3933 8.82966 12.8238 8.69949L12.7079 8.67801Z"})),K=Rt({live:{id:"odyssey.live",defaultMessage:"LIVE"},search:{id:"odyssey.search",defaultMessage:"Search"},restoringDesktop:{id:"odyssey.restoringDesktop",defaultMessage:"Restoring my virtual desktop..."},terminal:{id:"odyssey.terminal",defaultMessage:"Terminal"},newTab:{id:"odyssey.newTab",defaultMessage:"New tab"},libreoffice:{id:"odyssey.libreoffice",defaultMessage:"LibreOffice"},reader:{id:"odyssey.reader",defaultMessage:"Browser"},readingMode:{id:"odyssey.readingMode",defaultMessage:"Reading mode"},imageViewer:{id:"odyssey.imageViewer",defaultMessage:"Image Viewer"},stopAgent:{id:"odyssey.stopAgent",defaultMessage:"Stop agent"},generatingImage:{id:"odyssey.generatingImage",defaultMessage:"Generating image"}}),On=({lines:e=10,speed:s=5,width:n="100%",height:r=400,className:a=""})=>{const i=Dt()?4:3,l=c.useMemo(()=>Array.from({length:e+i},()=>`${60+Math.random()*40}%`),[e,i]),u="bg-token-bg-tertiary rounded-md h-6",d=()=>t.jsxs("div",{className:"flex shrink-0 flex-col gap-4 pb-4",style:{width:"100%",height:r},children:[t.jsxs("div",{className:"flex w-full flex-row items-start gap-4",children:[t.jsx("div",{style:{width:"25%",aspectRatio:"1 / 1",position:"relative"},children:t.jsx("div",{className:u,style:{position:"absolute",inset:0,width:"100%",height:"100%"}})}),t.jsx("div",{className:"flex h-full flex-1 flex-col gap-4",style:{height:"100%"},children:Array.from({length:i}).map((f,p)=>t.jsx("div",{className:u,style:{width:l[p],flex:1}},p))})]}),l.slice(i).map((f,p)=>t.jsx("div",{className:u,style:{width:f}},p+i))]}),m=typeof r=="number"?`${r}px`:r;return c.useEffect(()=>{const f=document.createElement("style");return f.innerHTML=`
      @keyframes ws-scroll {
        0% {
          transform: translateY(calc(-1 * var(--ws-page-h)));
        }
        100% {
          /* Move up exactly one page height */
          transform: translateY(calc(-2* var(--ws-page-h)));
        }
      }
      .animate-ws-scroll {
        animation-name: ws-scroll;
        animation-timing-function: ease-in-out;
        animation-iteration-count: infinite;
      }
    `,document.head.appendChild(f),()=>{document.head.removeChild(f)}},[]),t.jsx("div",{className:`relative ${a}`,style:{width:n,height:m},children:t.jsxs("div",{className:"animate-ws-scroll absolute inset-0 flex flex-col",style:{"--ws-page-h":m,animationDuration:`${s}s`},children:[t.jsx(d,{}),t.jsx(d,{})," ",t.jsx(d,{})," "]})})},we=({children:e,isKAUR1BR5:s=!1})=>t.jsx("div",{className:I("bg-token-bg-tertiary flex h-7 w-full flex-row px-1",s?"h-12 shrink-0":"pt-1 text-[11px]"),children:e}),ne=({children:e,className:s,isActive:n=!0,isKAUR1BR5:r=!1})=>{const[a,o]=c.useState(!1);c.useEffect(()=>{o(!0)},[]);const i=a?.5:.8,l=r?.9:.8,u=r?n?[l,1,1]:l:[l,1,1];return t.jsx("div",{className:I("flex w-full shrink-0 flex-row p-4",s),children:t.jsx(S.div,{className:"text-token-text-secondary bg-token-bg-primary flex size-full shrink-0 flex-col overflow-hidden rounded-lg shadow-md",initial:{opacity:0,scale:l,y:20},animate:{opacity:[0,1,1],scale:u,y:[20,0,0]},transition:{delay:i,duration:.55,times:[0,.75,1],ease:[.16,1,.3,1]},children:e})})};function Ln({title:e,url:s,domain:n}){const{formatMessage:r}=H();return t.jsxs(ne,{children:[t.jsx(we,{children:t.jsx("div",{className:"flex w-full flex-row items-center justify-center text-center",children:r(K.reader)})}),t.jsx("div",{className:"flex flex-1 flex-col bg-black/10 px-16 pt-16",children:t.jsx(Qt,{title:e})})]})}function Qt({title:e}){const{formatMessage:s}=H();return t.jsx("div",{className:"bg-token-bg-primary justify-top relative flex h-full w-full flex-col items-center rounded-t-xl",children:t.jsxs("div",{className:"w-full overflow-clip",children:[t.jsxs("div",{className:"bg-token-bg-primary relative z-2 flex flex-col items-center justify-start rounded-t-xl pt-0 pb-0",style:{WebkitMaskImage:"linear-gradient(to top, transparent 0px, black 12px, black 12px, black 100%)",maskImage:"linear-gradient(to top, transparent 0px, black 12px, black 12px, black 100%)"},children:[t.jsxs("div",{className:"text-token-text-secondary z-2 flex flex-row items-center gap-2 py-2 text-xs font-medium",children:[t.jsx(En,{className:"text-token-text-secondary size-4"}),s(K.readingMode)]}),t.jsx("div",{className:"text-token-text-primary z-1 mb-4 line-clamp-3 w-full px-4 text-start text-2xl font-semibold overflow-ellipsis lg:text-3xl",children:e})]}),t.jsx("div",{className:"inset-0 z-0 w-full overflow-visible px-4",children:t.jsx(On,{})})]})})}function Dn({tabMetadata:e,signedScreenshotUrl:s,newTabTitle:n,isReaderMode:r,domain:a,title:o,tetherData:i,isKAUR1BR5:l,isActive:u,serverThreadId:d}){const m=Ye(s),f=r?a:e?.domain??n,p=r?a:e?.origin??"";return t.jsxs(ne,{isActive:u,isKAUR1BR5:l,className:I(l&&"p-0!"),children:[t.jsx(we,{isKAUR1BR5:l,children:l?t.jsx(Fn,{isReaderMode:r,windowBarDomain:f,windowBarFaviconUrl:p,tetherData:i,serverThreadId:d}):t.jsx(Pn,{isReaderMode:r,windowBarDomain:f,windowBarFaviconUrl:p,tetherData:i})}),t.jsxs("div",{className:"bg-token-bg-primary dark:bg-token-bg-secondary relative aspect-[1024/697] w-full overflow-hidden rounded-b-lg",children:[m&&t.jsx("img",{src:m,alt:"",className:"absolute inset-0 h-full w-full object-cover object-bottom"},m),t.jsx(ue,{children:r&&t.jsx(S.div,{className:"absolute inset-0 flex items-center justify-center overflow-hidden rounded-b-md bg-black/20 backdrop-blur-[2px] dark:bg-black/50",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.4},children:t.jsx(S.div,{className:"flex h-full w-full px-8 pt-4 lg:px-16 lg:pt-8",initial:{y:"100%",opacity:0},animate:{y:0,opacity:1},exit:{y:"100%",opacity:0,transition:{y:{duration:.6}}},transition:{type:"spring",stiffness:400,damping:32},children:t.jsx(Qt,{domain:a,title:o})})})})]})]})}function Pn({isReaderMode:e,windowBarDomain:s,windowBarFaviconUrl:n,tetherData:r}){const{formatMessage:a}=H();return t.jsxs("div",{className:"bg-token-bg-primary dark:bg-token-bg-secondary relative flex items-center rounded-t-[4px] px-2 shadow-md",children:[t.jsxs("div",{className:"flex items-center gap-1 text-[10px]",children:[t.jsx(_e,{className:"size-3",url:e?r?.url??"":n??"",size:32}),t.jsx("span",{className:"max-w-16 truncate",children:e?r?.domain:s||a(Yt.newTab)})]}),t.jsx(Rn,{radius:4,className:"text-token-bg-primary dark:text-token-bg-secondary absolute start-[-4px] bottom-0"}),t.jsx(An,{radius:4,className:"text-token-bg-primary dark:text-token-bg-secondary absolute end-[-4px] bottom-0"})]})}function Fn({isReaderMode:e,windowBarDomain:s,windowBarFaviconUrl:n,tetherData:r,serverThreadId:a}){const{formatMessage:o}=H(),i=Pt();return t.jsxs("div",{className:"relative flex w-full items-center justify-between px-1.5",children:[t.jsxs("div",{className:"flex items-center gap-1.5 text-sm",children:[t.jsx(_e,{className:"size-5",url:e?r?.url??"":n??"",size:32}),t.jsx("span",{className:"max-w-32 truncate",children:e?r?.domain:s||o(Yt.newTab)})]}),t.jsxs(At,{color:"ghost",className:"bg-token-bg-primary h-7 min-h-0! rounded-lg",onClick:()=>{try{return vs()?.tryOpenAgentViewer(a)??!1}catch{js.error("Failed to open local agent viewer - error thrown")}},children:[t.jsx(Ea,{className:"me-1 size-3.5"}),!i&&t.jsx(W,{defaultMessage:"Open tab",id:"odyssey.browserWindow.openTab"})]})]})}const Yt=Rt({newTab:{defaultMessage:"New tab",id:"odyssey.browserWindow.newTab"}}),zn=e=>c.createElement("svg",{width:48,height:48,viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},c.createElement("g",{filter:"url(#filter0_d_7210_123625)"},c.createElement("path",{d:"M10.3791 11.9027C9.5965 9.71137 11.7123 7.59552 13.9037 8.37814L38.9999 17.3411C41.53 18.2447 41.4129 21.862 38.8297 22.6001L29.2361 25.3411C28.3199 25.6029 27.6038 26.319 27.3421 27.2351L24.601 36.8287C23.863 39.4119 20.2457 39.529 19.3421 36.999L10.3791 11.9027Z",fill:"black"}),c.createElement("path",{d:"M8.9668 12.4072C7.7585 9.02399 11.025 5.75752 14.4082 6.96582L39.5049 15.9287C43.4078 17.323 43.2271 22.903 39.2422 24.042L29.6484 26.7832C29.2306 26.9026 28.9036 27.2296 28.7842 27.6475L26.043 37.2412C24.904 41.2261 19.324 41.4068 17.9297 37.5039L8.9668 12.4072Z",stroke:"white",strokeWidth:3})),c.createElement("defs",null,c.createElement("filter",{id:"filter0_d_7210_123625",x:3.31076,y:3.25792,width:44.4195,height:44.4195,filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB"},c.createElement("feFlood",{floodOpacity:0,result:"BackgroundImageFix"}),c.createElement("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),c.createElement("feOffset",{dy:1.94814}),c.createElement("feGaussianBlur",{stdDeviation:1.94814}),c.createElement("feComposite",{in2:"hardAlpha",operator:"out"}),c.createElement("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"}),c.createElement("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_7210_123625"}),c.createElement("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_7210_123625",result:"shape"})))),Hn=({text:e,cadence:s=.1,fadeDuration:n=.5,className:r="",numLines:a=4})=>{const o=c.useMemo(()=>e.trim().split(/\s+/),[e]),i=c.useRef(null),l=c.useRef([]),[u,d]=c.useState(-1),[,m]=c.useState([]),f=c.useRef([]),[p,h]=c.useState(1),[g,_]=c.useState(0),[N,k]=c.useState(!1),[E,y]=c.useState(0),R=c.useRef(null),F=c.useRef(null),$=c.useRef(1),P=c.useRef(p);c.useEffect(()=>{P.current=p},[p]);const re=Dt();c.useEffect(()=>{d(-1),m([]),f.current=[],f.current[0]=1,h(1),_(0),k(!1),l.current=[],y(U=>U+1),R.current=null,F.current=null,$.current=1},[e,re]),c.useEffect(()=>{if(o.length===0)return;let U,q;const T=v=>{if(!f.current[v]){const M=l.current[v];if(M){const w=M.offsetTop;R.current==null?(R.current=w,F.current=w,$.current=1):w>(F.current??0)&&($.current+=1,F.current=w),f.current[v]=$.current,m([...f.current])}}d(v);const C=f.current[v]??$.current;C>P.current&&(C<=a?h(C):_(C-a)),v<o.length-1?U=window.setTimeout(()=>T(v+1),s*1e3):q=window.setTimeout(()=>k(!0),(n+1)*1e3)};return T(0),()=>{clearTimeout(U),clearTimeout(q)}},[o,s,n,a,re]);const[Q,oe]=c.useState(null);Lt(()=>{if(i.current&&Q==null){const U=parseFloat(getComputedStyle(i.current).lineHeight);oe(U)}},[Q]);const L=Q?-g*Q:0,Y=g===0?0:Math.min(100,s*500),ae={lineHeight:"1.4em",height:`calc(1.4em * ${Math.min(p,a)})`,transition:"height 0.25s cubic-bezier(0.4, 0, 0.2, 1)"};return t.jsx("div",{className:"cursor-chat-bubble text-token-text-primary border-[hsba(0,0%,5%,0.2) bg-token-bg-elevated-primary w-full overflow-hidden rounded-lg border p-2 text-xs shadow-[0px_20px_25.000001907348633px_-5px_rgba(0,0,0,0.10)] lg:text-sm",style:{opacity:N||e.length===0?0:1,transition:`opacity ${n}s ease-in-out`},children:t.jsx("div",{ref:i,className:`teleprompter ${r}`,style:ae,children:t.jsx("div",{className:"teleprompter-inner",style:{transform:`translateY(${L}px)`,transition:`transform ${Y}ms linear`},children:o.map((U,q)=>t.jsxs("span",{ref:T=>{l.current[q]=T},style:{opacity:q<=u&&(f.current[q]??1/0)>g?1:0,transition:`opacity ${n}s`,animation:"none"},className:"teleprompter-word",children:[U,"Â "]},q))},E)})})},$n=768,Bn=1024;function Zt(e,s){return{top:e/$n*100,left:s/Bn*100}}const Wn=120,Vn=1.2,Un="right",Gn=.2,qn=.75,Mt=.08,Xn=100,Qn=80,Yn=1.2,Se=(e=0)=>new Promise(s=>setTimeout(s,e));function Zn(e,s=120){const[n,r]=De.useState(e),[a,o]=De.useState(!1);return De.useEffect(()=>{o(!0);const i=setTimeout(()=>{r(e),o(!1)},s);return()=>clearTimeout(i)},[e,s]),[n,a]}const Jn=({top:e,left:s,params:n={},text:r,actions:a,isKAUR1BR5:o})=>{const{forearmLength:i=Wn,speed:l=Vn,handBias:u=Un,curveFactor:d=Gn,shortMoveSlowdown:m=.8,slowDistance:f=100,dragSlowdown:p=Yn}=n,[h,g]=c.useState({x:s,y:e}),_=dt(1),N=dt(0),k=c.useRef(null),E=c.useRef(h),y=c.useRef({p0:h,p1:h,p2:h}),R=(v,C,M,w)=>{const b=1-w;return{x:b*b*v.x+2*b*w*C.x+w*w*M.x,y:b*b*v.y+2*b*w*C.y+w*w*M.y}},F=c.useRef(1),$=c.useRef(!1),P=mt(N,v=>{const{p0:C,p1:M,p2:w}=y.current;return`${R(C,M,w,v).x}%`}),re=mt(N,v=>{const{p0:C,p1:M,p2:w}=y.current;return`${R(C,M,w,v).y}%`}),[Q,oe]=Zn(r,150),L=oe?"":Q,{x:Y,y:ae,refs:{setReference:U,setFloating:q},strategy:T}=bs({placement:"right-start",whileElementsMounted:(v,C,M)=>Ns(v,C,M,{animationFrame:!0}),middleware:[Cs({mainAxis:4,crossAxis:24}),_s({padding:8,crossAxis:!0})]});return c.useEffect(()=>{const v=h,C=E.current;if(v.x===C.x&&v.y===C.y){k.current?.(),k.current=null;return}const M=v.x-C.x,w=v.y-C.y,b=Math.hypot(M,w),Z={x:C.x+M/2,y:C.y+w/2},B=(()=>{const me={x:-w,y:M},ve=Math.hypot(me.x,me.y)||1;return{x:me.x/ve,y:me.y/ve}})(),z=(M>=0?1:-1)*(u==="right"?1:-1),O=Math.min(i,b/1.5)*d*z,J={x:Z.x+B.x*O,y:Z.y+B.y*O};y.current={p0:C,p1:J,p2:v};const ie=Math.max(Qn/1e3,b/(l*120))*F.current,pe=1+m*Math.max(0,1-b/f),Ne=ie*pe;N.stop(),N.set(0);const he=Le(N,1,{duration:Ne,ease:$.current?"linear":[.42,0,.58,1],onComplete:()=>{k.current?.(),k.current=null}});return E.current=v,()=>he.stop()},[h,i,l,u,d,m,f,N]),c.useEffect(()=>{if(!a||a.length===0)return;const v=a.filter(B=>["click","move","drag"].includes(B.action));if(v.length===0)return;const C=(B,z)=>{const{top:te,left:O}=Zt(z,B);return new Promise(J=>{if(E.current.x===O&&E.current.y===te){Se().then(J);return}k.current=J,g({x:O,y:te})})},M=async()=>{await Le(_,qn,{duration:Mt}).finished},w=async()=>{await Le(_,1,{duration:Mt}).finished},b=async()=>{await M(),await Se(Xn),await w()};let Z=!1;return(async()=>{try{for(const B of v){if($.current=!1,Z)break;switch(B.action){case"click":{const z=B;await C(z.x,z.y),await Se(200),await b();break}case"move":{const z=B;await C(z.x,z.y);break}case"drag":{const z=B;if(z.path.length===0)break;const[te,...O]=z.path;await C(te[0],te[1]),await Se(100),await M(),$.current=!0,F.current=p;for(let J=0;J<O.length;J++){const[ie,pe]=O[J];J===O.length-1&&(F.current=1,$.current=!1),await C(ie,pe)}await w();break}default:break}}}catch(B){xe.addError(B)}})(),()=>{Z=!0}},[a,_,p]),t.jsx("div",{className:I("absolute inset-0",o?"mt-2":"m-4 mb-12"),children:t.jsx("div",{className:I("relative",o?"aspect-[1024/777]":"aspect-[1024/755]"),children:t.jsxs("div",{className:"absolute inset-0",children:[t.jsx(S.div,{ref:U,style:{left:P,top:re,scale:_},className:"pointer-events-none absolute z-10 -translate-x-[30%] -translate-y-[55%]",children:t.jsx(zn,{className:"size-6"})}),t.jsx("div",{ref:q,className:"pointer-events-none absolute z-9 flex w-[240px] items-center justify-center lg:w-[320px]",style:{position:T,top:ae??0,left:Y??0},children:t.jsx(Hn,{text:L})})]})})})},Kn=({searchQuery:e,searchResults:s})=>{const[r,a]=c.useState(""),[o,i]=c.useState(null),l=c.useRef(null);c.useEffect(()=>{let d=!1;const m=p=>new Promise(h=>setTimeout(h,p));return(async()=>{if(await m(1e3),d)return;a(""),i(null);const p=[...e],h=p.length?1e3/p.length:1e3;for(let g=1;g<=p.length;g++){if(d)return;a(e.slice(0,g)),await m(h)}if(!d&&(i(s),await m(3e3),!d&&l.current)){const g=Math.floor(Math.random()*90)+10,_=(l.current.scrollHeight-l.current.clientHeight)*(g/100);l.current.scrollBy({top:_,behavior:"smooth"})}})(),()=>{d=!0}},[e,s]);const u=H();return t.jsxs(ne,{className:"flex flex-col p-10",children:[t.jsx("div",{className:"border-token-border-default border-b p-2",children:t.jsxs("div",{className:"relative",children:[t.jsx(Ot,{className:"icon text-token-text-primary absolute start-2 top-1/2 mt-[1px] size-4 -translate-y-1/2"}),t.jsx("input",{type:"text",className:"text-token-text-primary text-s w-full border-none bg-transparent px-2 py-1 ps-7 outline-none focus:ring-0",value:r,placeholder:u.formatMessage(Ms.searchPlaceholder),readOnly:!0,tabIndex:-1})]})}),t.jsx("div",{ref:l,className:"flex flex-1 flex-col gap-4 overflow-auto px-4 py-4",children:t.jsx(ue,{initial:!1,children:o?.map((d,m)=>t.jsxs(S.div,{layout:!0,initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0},transition:{delay:m*.06,duration:.25},className:"mb-2 flex max-w-full flex-col",children:[t.jsxs("a",{className:"text-token-text-secondary flex max-w-full items-center gap-1 text-xs",href:d.rawUrl,target:"_blank",rel:"noopener noreferrer",children:[t.jsx("div",{className:"flex w-5 shrink-0 items-center justify-start",children:t.jsx(_e,{className:"size-4",url:d.rawUrl??"",size:128})}),t.jsx("div",{className:"flex min-w-0 flex-1 flex-row items-center gap-1",children:d.url})]}),t.jsx("span",{className:"text-token-text-secondary text-s mt-1 truncate",children:d.title})]},m))})})]})},er=Da.define([{tag:ce.keyword,color:"#C280DF"},{tag:ce.string,color:"#A1C281"},{tag:ce.number,color:"#C99C6E"},{tag:ce.bool,color:"#DFC184"},{tag:ce.comment,color:"#5C6370",fontStyle:"italic"},{tag:ce.variableName,color:"#D27378"},{tag:ce.operator,color:"#73ABE5"},{tag:ce.invalid,color:"#FFFFFF"}]),Re="chatgpt-agent % ",Ge="cm-input-line",Jt="cm-input-prefix",tr=()=>c.useMemo(()=>Ue.theme({"&":{color:"#B0B6C3",backgroundColor:"#292C33",fontSize:"10px",height:"100%",width:"100%"},".cm-content":{caretColor:"#528BFF"},".cm-cursor, .cm-dropCursor":{borderLeftColor:"#528BFF"},".cm-selected":{backgroundColor:"#3E4451"},".cm-gutters":{backgroundColor:"#21252B",display:"none"},".cm-editor, .cm-scroller":{height:"100%"},".cm-scroller":{overflow:"auto"},".cm-line":{whiteSpace:"pre"},[`.${Ge} *`]:{color:"#B0B6C3 !important"},[`.${Ge} .${Jt}`]:{color:"#73ABE5 !important"},".cm-content, .cm-line":{fontWeight:600,textRendering:"optimizeLegibility",WebkitFontSmoothing:"antialiased"}},{dark:!0}),[]),sr=Vt.line({class:Ge}),ar=Vt.mark({class:Jt}),nr=za.fromClass(class{decorations;constructor(e){this.decorations=this.build(e)}update(e){(e.docChanged||e.viewportChanged)&&(this.decorations=this.build(e.view))}build(e){const s=new Ha;for(const{from:n,to:r}of e.visibleRanges){let a=n;for(;a<=r;){const o=e.state.doc.lineAt(a);o.text.startsWith(Re)&&(s.add(o.from,o.from,sr),s.add(o.from,o.from+Re.length,ar)),a=o.to+1}}return s.finish()}},{decorations:e=>e.decorations});function rr({title:e,code:s}){const n=c.useRef(null),r=c.useRef(null),{docInstant:a,docDelayed:o,needsDelay:i}=c.useMemo(()=>{const u=s.map(d=>d.type==="input"?`${Re}${d.content}`:d.content).join(`
`);return s.length>0&&s[s.length-1].type==="input"?{docInstant:u,docDelayed:`${u}
`,needsDelay:!0}:{docInstant:`${u}
${Re}`,docDelayed:"",needsDelay:!1}},[s]),l=tr();return c.useEffect(()=>{!n.current||r.current||(r.current=new Ue({state:Fa.create({doc:a,extensions:[Oa.define(Pa),La(er),Ue.editable.of(!1),l,nr]}),parent:n.current}))},[a,l]),c.useEffect(()=>{const u=r.current;if(u){if(u.dispatch({changes:{from:0,to:u.state.doc.length,insert:a}}),i){const d=setTimeout(()=>{u.dispatch({changes:{from:0,to:u.state.doc.length,insert:o}}),u.scrollDOM.scrollTop=u.scrollDOM.scrollHeight},500);return()=>clearTimeout(d)}requestAnimationFrame(()=>{u.scrollDOM.scrollTop=u.scrollDOM.scrollHeight})}},[a,o,i]),t.jsxs(ne,{children:[t.jsx(we,{children:t.jsx("div",{className:"flex w-full flex-row items-center justify-center text-center",children:e})}),t.jsx("div",{className:"flex flex-1 bg-[#282C34]",style:{minHeight:0},children:t.jsx("div",{ref:n,className:"h-full w-full flex-1",style:{minHeight:0}})})]})}const or=({id:e,children:s,content:n,side:r="bottom",sideOffset:a=4,align:o="center",className:i,triggerClassName:l,dismissOnOutsideClick:u=!0,allowReopen:d=!1})=>{const m=`only-once-tooltip-dismissed:${e}`,[f,p]=c.useState(!1),h=c.useRef(!1);c.useEffect(()=>{if(!h.current){h.current=!0;try{localStorage.getItem(m)==="true"||p(!0)}catch{p(!0)}}},[m]);const g=_=>{if(_){if(!d)try{if(localStorage.getItem(m)==="true")return}catch{}p(!0);return}try{localStorage.setItem(m,"true")}catch{}p(!1)};return t.jsxs(ua,{open:f,onOpenChange:g,children:[t.jsx(da,{asChild:!0,className:l,children:t.jsx("span",{children:s})}),t.jsx(ma,{children:t.jsxs(fa,{side:r,sideOffset:a,align:o,onPointerDownOutside:u?void 0:_=>_.preventDefault(),updatePositionStrategy:"always",className:I("animate-slideLeftAndFade z-30 rounded-xl border bg-blue-400 p-4 text-white shadow-sm",i),children:[n,t.jsx(pa,{asChild:!0,children:t.jsx("div",{className:"relative top-[-6px] h-3 w-3 rotate-45 transform rounded-ee-sm bg-blue-400"})})]})})]})},St="shadow-[0_5px_8px_3px_rgba(0,0,0,0.05),_0_0.5px_1px_0px_rgba(0,0,0,0.09)] outline outline-[0.5px] outline-black/5";function ir(){return t.jsx("div",{className:"flex items-center justify-center gap-1",children:[0,1,2].map(e=>t.jsx("div",{className:"bg-token-border-heavy animate-dot-fade h-[6px] w-[6px] rounded-full opacity-50",style:{animationDelay:`${e*.2}s`}},e))})}const lr=52,cr={hidden:{opacity:0,scale:.8},visible:{opacity:1,scale:1,transition:{type:"spring",stiffness:260,damping:20}}},ur={initial:()=>({x:0}),animate:e=>({x:e?lr:0,transition:{type:"spring",stiffness:260,damping:20}})},dr={initial:{opacity:0,scale:.8,x:0},animate:{opacity:1,scale:1,x:-52,transition:{type:"spring",stiffness:260,damping:20}},exit:{opacity:0,scale:.8,x:0}},mr=({connector:e,action:s,connectorFetchResult:n,connectorSearchResults:r})=>{const a=H(),o=Et(),i=c.useMemo(()=>s?Ce({action:s,source:e??void 0,intl:a}):null,[s,e,a]);let l=o?e?.logo_url_dark:e?.logo_url;return o&&!l&&(l=e?.logo_url),t.jsxs(ne,{className:"p-12",children:[t.jsx(we,{children:t.jsx("div",{className:"flex w-full flex-row items-center justify-center gap-2 text-center",children:t.jsx(W,{id:"cua.cot.agent.connectors",defaultMessage:"Connectors"})})}),t.jsxs("div",{className:"flex w-full flex-1 flex-col items-center justify-center gap-4",children:[t.jsxs("div",{className:"relative h-16 w-32",children:[t.jsx(ue,{children:l&&t.jsx(S.div,{className:"absolute inset-0 flex items-center justify-center",variants:dr,initial:"initial",animate:"animate",exit:"exit",children:t.jsx("div",{className:I("bg-token-bg-elevated-primary rounded-lg p-2",St),children:t.jsx("img",{src:l,alt:e?.name,className:"h-8 w-8 select-none"})})})}),t.jsx(ue,{children:l&&t.jsx(S.div,{className:"absolute inset-0 flex items-center justify-center",variants:cr,initial:"hidden",animate:"visible",exit:"hidden",children:t.jsx(ir,{})})}),t.jsx(S.div,{className:"absolute inset-0 z-10 flex items-center justify-center",variants:ur,custom:l,initial:"initial",animate:"animate",children:t.jsx("div",{className:I("bg-token-bg-elevated-primary rounded-lg p-3",St),children:t.jsx(Ds,{className:"text-token-text-primary h-6 w-6",matchTextColor:!0})})})]}),t.jsx("div",{className:"relative z-10 h-6 w-full",children:t.jsx(ue,{mode:"sync",children:t.jsx(S.div,{className:"text-token-text-secondary pointer-events-none absolute inset-0 flex items-center justify-center text-center text-sm font-medium",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.25},children:i},i)})}),e&&(n||r)&&t.jsx("div",{className:"flex w-full flex-col items-center justify-center px-8",children:t.jsx(fr,{connectorFetchResult:n,connectorSearchResults:r,action:s})})]})]})},fr=({connectorFetchResult:e,connectorSearchResults:s,action:n})=>{const r=[];let a=[];if(n==="n7jupd_cs"&&s)a=s.map(i=>({entries:[{url:i.url,title:i.title,snippet:"",attribution:i.title}]}));else if(n==="n7jupd_cf"&&e)a=[{entries:[{url:e?.url,title:e?.title,snippet:"",attribution:e?.title}]}];else return null;const o={type:x.Search,queries:r,sources:a};return t.jsx(Ze,{chunk:o,isExpanded:!0,isComplete:!0,useCloudDocIcons:!0,isSmall:!1,isVisualCoT:!0})},pr="_frostedContainer_1rwq4_1",hr="_blurStack_1rwq4_8",gr="_blur_1rwq4_8",xr="_layer0_1rwq4_42",yr="_layer1_1rwq4_47",wr="_layer2_1rwq4_52",vr="_layer3_1rwq4_57",jr="_layer4_1rwq4_62",br="_layer5_1rwq4_67",G={frostedContainer:pr,blurStack:hr,blur:gr,layer0:xr,layer1:yr,layer2:wr,layer3:vr,layer4:jr,layer5:br};function Cr({file_id:e,title:s,clientThreadId:n}){const[r,a]=c.useState(!1),o=Ft(n),{data:i}=Wa(!0,o,e,void 0,()=>{});return t.jsx("div",{className:"bg-token-bg-tertiary flex h-full w-full flex-col items-center justify-center",children:t.jsxs("div",{className:`${G.frostedContainer} relative flex h-full w-full flex-row items-center justify-center text-center text-sm`,children:[t.jsx("div",{className:"text-token-text-secondary absolute top-0 z-10 flex w-full flex-row items-center justify-center py-2 text-xs font-medium",children:s}),!r&&t.jsx("img",{src:i?.download_url,alt:"",className:"h-full w-full object-cover",onError:()=>a(!0)}),t.jsxs("div",{className:G.blurStack,children:[t.jsx("div",{className:`${G.blur} ${G.layer0}`}),t.jsx("div",{className:`${G.blur} ${G.layer1}`}),t.jsx("div",{className:`${G.blur} ${G.layer2}`}),t.jsx("div",{className:`${G.blur} ${G.layer3}`}),t.jsx("div",{className:`${G.blur} ${G.layer4}`}),t.jsx("div",{className:`${G.blur} ${G.layer5}`})]})]})})}const _r=({file_id:e,title:s,clientThreadId:n,prompt:r})=>{const{formatMessage:a}=H();return e?t.jsx(ne,{children:t.jsx("div",{className:"flex min-h-0 w-full flex-1 flex-col items-center justify-center",children:t.jsx(Cr,{file_id:e,title:s,clientThreadId:n})})}):t.jsx(ne,{children:t.jsxs("div",{className:"bg-token-bg-tertiary flex h-full flex-col items-center justify-center",children:[t.jsx("div",{className:"flex w-full flex-row items-center justify-center py-2 text-center text-xs",children:a(K.generatingImage)}),t.jsxs("div",{className:"flex min-h-0 w-full flex-1 flex-col items-center justify-center gap-4",children:[t.jsx($a,{children:t.jsx(Ba,{matchTextColor:!0})}),t.jsx("div",{className:"text-token-text-secondary line-clamp-5 px-12 text-center text-xs italic",children:r})]})]})})},Nr=({signedScreenshotUrl:e})=>{const{formatMessage:s}=H(),n=Ye(e);return t.jsxs(ne,{children:[t.jsx(we,{children:t.jsx("div",{className:"flex w-full flex-row items-center justify-center text-center",children:s(K.imageViewer)})}),t.jsx("div",{className:"flex min-h-0 w-full flex-1 flex-col items-center justify-center",children:n&&t.jsx("img",{src:n,alt:"",className:"max-h-full object-contain"})})]})};function Mr({signedScreenshotUrl:e}){const{formatMessage:s}=H(),n=Ye(e);return t.jsxs(ne,{children:[t.jsx(we,{children:t.jsx("div",{className:"flex w-full flex-row items-center justify-center text-center",children:s(K.libreoffice)})}),n&&t.jsx("div",{className:"bg-primary relative aspect-[1024/768] w-full overflow-hidden rounded-b-lg",children:t.jsx("img",{src:n,alt:"",className:"absolute inset-0 h-full w-full object-cover object-bottom"},n)})]})}const de=e=>typeof e=="object"&&e!=null,ee=e=>typeof e=="number",Kt=e=>typeof e=="string",Sr=e=>de(e)&&e.action==="drag"&&Array.isArray(e.path)&&e.path.every(s=>ee(s[0])&&ee(s[1])),kr=e=>de(e)&&e.action==="move"&&ee(e.x)&&ee(e.y),Tr=e=>de(e)&&e.action==="scroll"&&ee(e.x)&&ee(e.y)&&ee(e.scroll_y)&&ee(e.scroll_x),Ir=e=>de(e)&&e.action==="click"&&ee(e.x)&&ee(e.y)&&ee(e.button),Rr=e=>de(e)&&e.action==="type"&&Kt(e.text),Ar=e=>de(e)&&e.action==="keypress"&&Array.isArray(e.keys)&&e.keys.every(Kt),Er=e=>de(e)&&e.action==="wait",Or=e=>Tr(e)||Ir(e)||Rr(e)||Ar(e)||Er(e)||Sr(e)||kr(e);function Lr(e){const s=e.indexOf("{");if(s<0)return;let n;try{n=JSON.parse(e.slice(s))}catch(a){xe.addError(a);return}if(!de(n)||!Array.isArray(n.actions))return;const r=n.actions.filter(Or);return r.length>0?{actions:r}:void 0}const Dr=({value:e,max:s,isPlaying:n,onChange:r,onPlayPause:a,onRestart:o,onLive:i,isLive:l,isComplete:u,isKAUR1BR5:d})=>{const{formatMessage:m}=H(),f=Pt(),p=ha();return f||p?null:t.jsxs("div",{className:I("z-10 flex w-full items-center gap-2 px-4 py-0 pb-4 text-xs select-none",d?"absolute bottom-0 opacity-0 transition-opacity duration-300 group-hover:opacity-100":"relative"),children:[t.jsx("div",{className:I("absolute start-0 w-full bg-gradient-to-t from-gray-950/90 to-gray-500/0",d?"-top-5 h-20":"top-0 h-16")}),u&&t.jsx("button",{className:"border-token-border-light hover:bg-token-surface-primary/20 relative z-10 rounded text-white",onClick:l?o:a,children:n?t.jsx(ga,{className:"size-4"}):l?t.jsx(Va,{className:"size-4"}):t.jsx(xa,{className:"size-4"})}),t.jsxs(ya,{className:"group relative flex flex-1 items-center",min:0,max:s,step:1,value:[e],onValueChange:([h])=>r(h),children:[t.jsx(wa,{className:"relative h-[4px] w-full grow cursor-pointer rounded-full bg-black/20",children:t.jsx(va,{className:"absolute h-full rounded-full bg-white/90"})}),t.jsx(ja,{className:"touch:h-3 touch:w-3 relative block h-1.5 w-1.5 scale-100 cursor-pointer rounded-full border bg-white shadow-md transition-transform group-hover:scale-200 before:pointer-events-auto before:absolute before:inset-[-12px] before:rounded-full before:bg-transparent before:content-[''] focus:outline-none"})]}),!u&&t.jsx("span",{className:I("z-1 cursor-pointer font-medium text-white uppercase opacity-50",l&&"text-gray-500 opacity-100"),onClick:i,children:m(K.live)})]})},Pr="file:///home/oai/redirect.html",Fr=0,kt=35,Tt=20;function ze(e,s){const{cursorTop:n,cursorLeft:r}=e;return n<s.top||n>s.top+s.height||r<s.left||r>s.left+s.width?(e.cursorTop=Math.random()*s.height+s.top,e.cursorLeft=Math.random()*s.width+s.left,!0):!1}const He={image_viewer:{top:80,left:0,width:100,height:20},api_tool:{top:0,left:50,width:50,height:10}},zr=(e,s,n)=>{let r=0;const{message:a,groupType:o}=s;let i=!1;const l=u=>{const d=e.openApps.indexOf(u);d!==-1?e.currentWindowIndex=d:(e.openApps.push(u),e.currentWindowIndex=e.openApps.length-1)};switch(o){case A.StructuredThoughts:break;case A.CodeInterpreter:if(l("terminal"),a.author.role==="tool"&&a.author.name==="container.exec"&&a.content.content_type==="text"){const u=a.content.parts.map(d=>({type:"output",content:d}));e.code.push(...u)}else if(a.author.role==="assistant"&&a.recipient==="container.exec"&&a.content.content_type==="code")try{const u=JSON.parse(a.content.text).cmd;e.code.push({type:"input",content:u.join(" ")})}catch(u){xe.addError(u)}r=2e3;break;case A.n7jupd:if(a.content.content_type===X.ComputerOutput){const u=a.metadata?.n7jupd_v?.title,d=a.metadata?.n7jupd_v?.application,m={...a.content.screenshot,vmMetadata:a.metadata?.n7jupd_v,messageId:a.id};d==="Browser"?(e.isReaderMode=!1,l("browser"),e.screenshots.push(m)):d?.startsWith("LibreOffice")||d?.startsWith("Select a Template")?(e.isReaderMode=!1,l("libreoffice"),e.libreOfficeScreenshots.push(m)):(e.isReaderMode=!1,l("browser"),e.screenshots.push(m)),e.tabMetadata=Bt(m),e.computerApplication=d??null,e.computerTitle=u??null,r=2e3}if(a.content.content_type===X.StructuredThoughts&&(e.thought=a.content.thoughts.map(u=>u.content).join(""),r=1e3),a.recipient!=="computer.switch_app"){if(a.recipient?.includes("computer")&&a.content.content_type===X.Code){const u=a.content.text,d=Lr(u);e.actions=d?.actions??[],r=1e3,d&&(d.actions.forEach(m=>{switch(m.action){case"click":{i=!0;const{top:f,left:p}=Zt(m.y,m.x);e.cursorTop=f,e.cursorLeft=p,e.isCursorInInitialPosition=!1,r+=1e3;break}case"type":break;case"scroll":break;case"keypress":break;case"wait":break;case"move":break;case"drag":r+=1e3;break}}),r=Math.min(r,4e3))}}break;case A.n7jupd_x:if(a.author.name==="browser.search"){l("search");const u=a.metadata?.n7jupd_title?.match(/`(.*)`/)?.[1]??"",d=a.metadata?.n7jupd_titles?.map((m,f)=>{const p=a.metadata?.n7jupd_urls?.[f]??"",g=gt(p)?.hostname.replace(/^www\./,"").split(".")[0],_=g&&g.charAt(0).toUpperCase()+g.slice(1);return{title:m,url:g,name:_,rawUrl:p}});e.searchResults=d??null,e.searchQuery=u,r=6e3}else if(a.author.name==="browser.open"&&a.content.content_type==="tether_browsing_display"){l("browser"),e.isReaderMode=!0;const u=a.metadata?.n7jupd_url??"";let d=a.metadata?.n7jupd_title??null,m=u;if(/\.pdf(?:[?#].*)?$/i.test(u)||u.startsWith("http://localhost:8451/")){const h=u.startsWith("http://localhost:8451/")?u.replace(/^http:\/\/localhost:8451\//,""):u;m=h;const g=h.match(/([^\/]+\.pdf)(?:[?#].*)?$/i);g&&(d=g[1])}const p=gt(m)?.hostname?.replace(/^www\./,"").split("/")[0];e.tetherData={summary:a.content.summary??null,result:a.content.result??null,domain:p??null,title:d,url:m},e.tetherData.title===Pr&&(e.isReaderMode=!1),r=6e3}break;case A.n7jupd_a:{const u=a.metadata?.n7jupd_subtool,d=pt();u?.subtool?.includes("search")?e.apiAction="n7jupd_as":u?.subtool?.includes("api_doc")&&(e.apiAction="n7jupd_ag");let f=a.metadata?.n7jupd_subtool?.generic_api_func?.match(Pe)?.[0]??void 0;f||(f=a.metadata?.n7jupd_url?.match(Pe)?.[0]??void 0);const p=d?.get(f??"");if(!f||!p)e.apiAction="n7jupd_cf";else if(a.metadata?.connector_source&&a.content.content_type===X.TetherBrowsingDisplay){a.metadata?.display_url&&a.metadata?.display_title&&(e.apiAction="n7jupd_cf",e.connector=p,e.connectorFetchResult={url:a.metadata?.display_url,title:a.metadata?.display_title});const h=ht(a.content.result);h.length&&(e.apiAction="n7jupd_cs",e.connector=p,e.connectorSearchResults=h.map(([g,_])=>({url:g,title:_})))}l("api_tool"),ze(e,He.api_tool),r=1e3,p&&(e.connector=p);break}case A.n7jupd_native_api_tool:{const u=a.recipient;if(u?.includes("list_resources")||u?.includes("search_tools")?e.apiAction="n7jupd_as":(u?.includes("read_resources")||u?.includes("get_resource"))&&(e.apiAction="n7jupd_ag"),a.content.content_type!==X.CitableCodeOutput)e.apiAction="n7jupd_cf";else{const d=pt();e.apiAction="n7jupd_cf";let m=a.content.metadata?.connector_id??void 0;m||(m=a.content.output_str.match(Pe)?.[0]??void 0);const f=d?.get(m??"");f&&(e.connector=f),a.content.metadata?.display_url&&a.content.metadata?.display_title&&(e.connectorFetchResult={url:a.content.metadata?.display_url,title:a.content.metadata?.display_title});const p=ht(a.content.output_str);p.length&&(e.apiAction="n7jupd_cs",e.connectorSearchResults=p.map(([h,g])=>({url:h,title:g})))}l("api_tool"),ze(e,He.api_tool),r=1e3;break}case A.Container:a.content.content_type===X.MultimodalText&&(l("image_viewer"),ze(e,He.image_viewer),a.content.parts.forEach(u=>{typeof u!="string"&&u.content_type===ft.ImageAssetPointer&&e.imageViewerScreenshots.push({...u,messageId:a.id})}),r=3e3);break;case A.t2uay3k:if(!n)break;if(a.author.name==="t2uay3k.sj1i4kz"&&a.content.content_type===X.MultimodalText){const u=a.content.parts.at(0);if(typeof u=="string")break;u?.content_type===ft.ImageAssetPointer?(e.imageGenFileId=u.asset_pointer,r=2e3):xe.addError("Error parsing image gen file id",{message:a}),e.imageGenTitle=a.metadata?.image_gen_title??null,r=2e3}break;case A.Debug:{if(!n)break;if(a.recipient==="imagegen.make_image"&&a.content.content_type==="code"){l("image_gen"),e.imageGenFileId=null,r=1e3,e.imageGenTitle=a.metadata?.image_gen_title??null;try{e.imageGenPrompt=JSON.parse(a.content.text).prompt}catch(u){xe.addError("Error parsing image gen prompt",{e:u,text:a.content.text})}}break}}return!i&&(e.isCursorInInitialPosition||Math.random()<Fr)&&e.openApps.length&&(e.isCursorInInitialPosition=!1,e.cursorTop=Math.random()*30+20,e.cursorLeft=Math.random()*60+20),r},Hr=({messageGroups:e,isStreaming:s,isFinalAssistantTurn:n,isComplete:r,clientThreadId:a,enableVisualReaderMode:o=!1,isKAUR1BR5:i=!1})=>{const l=Ft(a),u=zt(),d=Ht(u,"3639187874"),m=c.useMemo(()=>e.flatMap(C=>C.messages.map(M=>({message:M,groupType:C.type}))).map(C=>({message:C.message,messageType:Ss(C.message),groupType:C.groupType})),[e]),[f,p]=c.useState([]),[h,g]=c.useState(0),[_,N]=c.useState(s),[k,E]=c.useState(!0),[y,R]=c.useState(null),F=ba(a),$=c.useRef(null),P=ke(y?.screenshot,l),re=ke(y?.libreOfficeScreenshots.at(-1),l),Q=ke(y?.imageViewerScreenshots.at(-1),l),oe=c.useCallback((v,C)=>{const M=[...v];let w=M.length>0?M[M.length-1]:null,b;w?b={cursorTop:w.cursorTop,cursorLeft:w.cursorLeft,thought:w.thought,openApps:[...w.openApps],currentWindowIndex:w.currentWindowIndex,screenshots:w.screenshot?[w.screenshot]:[],libreOfficeScreenshots:w.libreOfficeScreenshots??[],searchResults:w.searchResults??null,searchQuery:w.searchQuery??null,code:[...w.code],tabMetadata:w.tabMetadata??null,isCursorInInitialPosition:!1,tetherData:w.tetherData??null,lastVisualAppSwitch:w.lastVisualAppSwitch??null,imageViewerScreenshots:w.imageViewerScreenshots??[],connector:w.connector??null,computerApplication:w.computerApplication??null,computerTitle:w.computerTitle??null,isReaderMode:w.isReaderMode??!1,actions:null,imageGenTitle:w.imageGenTitle??null,imageGenFileId:w.imageGenFileId??null,imageGenPrompt:null}:b={cursorTop:kt,cursorLeft:Tt,thought:"",openApps:[],currentWindowIndex:0,screenshots:[],searchResults:null,searchQuery:null,code:[],tabMetadata:null,isCursorInInitialPosition:!0,isReaderMode:!1,tetherData:null,libreOfficeScreenshots:[],lastVisualAppSwitch:null,imageViewerScreenshots:[],connector:null,computerApplication:null,computerTitle:null,actions:null,imageGenTitle:null,imageGenFileId:null,imageGenPrompt:null};for(let Z=M.length;Z<=C;Z++){const B=zr(b,m[Z],d),z={cursorTop:b.cursorTop,cursorLeft:b.cursorLeft,thought:b.thought,openApps:[...b.openApps],currentWindowIndex:b.currentWindowIndex,screenshot:(b.screenshots??[]).at(-1)??null,searchResults:b.searchResults,searchQuery:b.searchQuery,code:[...b.code],tabMetadata:b.tabMetadata,isReaderMode:b.isReaderMode,tetherData:b.tetherData,libreOfficeScreenshots:[...b.libreOfficeScreenshots],lastVisualAppSwitch:b.lastVisualAppSwitch,imageViewerScreenshots:[...b.imageViewerScreenshots],connector:b.connector,apiAction:b.apiAction,connectorFetchResult:b.connectorFetchResult,connectorSearchResults:b.connectorSearchResults,delayMs:B,computerApplication:b.computerApplication,computerTitle:b.computerTitle,actions:b.actions,imageGenTitle:b.imageGenTitle,imageGenFileId:b.imageGenFileId,imageGenPrompt:b.imageGenPrompt};w&&(z.lastVisualAppSwitch=w.lastVisualAppSwitch),M.push(z),w=z}return{newFrames:M}},[m,d]);c.useEffect(()=>{if(f.length<m.length){const{newFrames:v}=oe(f,m.length-1);p(v)}k&&g(m.length-1)},[m.length,oe,f,k]);const L=c.useCallback(()=>{if(h>=f.length-1){r&&(N(!1),E(!0));return}const v=f[h];$.current&&clearTimeout($.current),$.current=setTimeout(()=>{g(C=>C+1)},v.delayMs)},[h,f,r]);c.useEffect(()=>{if(!k)return _&&L(),()=>{$.current&&clearTimeout($.current)}},[_,h,f.length,L,k]),c.useEffect(()=>{const v=f[h];v&&R(v)},[h,f]);const{formatMessage:Y}=H(),ae=y?.currentWindowIndex===y?.openApps.findIndex(v=>v==="browser"),U={browser:t.jsx(Dn,{tabMetadata:y?.tabMetadata??null,signedScreenshotUrl:P,newTabTitle:Y(K.newTab),isReaderMode:y?.isReaderMode??!1,url:y?.tetherData?.url??"",domain:y?.tetherData?.domain??"",title:y?.tetherData?.title??"",tetherData:y?.tetherData??null,isKAUR1BR5:i,isActive:ae,serverThreadId:l??""}),terminal:t.jsx(rr,{title:Y(K.terminal),code:y?.code??[]}),search:t.jsx(Kn,{searchQuery:y?.searchQuery??"",searchResults:y?.searchResults??null}),libreoffice:t.jsx(Mr,{title:Y(K.libreoffice),signedScreenshotUrl:re}),tether_browser:o?null:t.jsx(Ln,{url:y?.tetherData?.url??"",domain:y?.tetherData?.domain??"",title:y?.tetherData?.title??""}),image_viewer:t.jsx(Nr,{signedScreenshotUrl:Q}),api_tool:t.jsx(mr,{connector:y?.connector??null,connectorFetchResult:y?.connectorFetchResult,connectorSearchResults:y?.connectorSearchResults,action:y?.apiAction}),image_gen:t.jsx(_r,{file_id:y?.imageGenFileId??"",title:y?.imageGenTitle??"",clientThreadId:a,prompt:y?.imageGenPrompt??""})},q=y?.openApps.map(v=>U[v]),T=s&&n&&F;return t.jsxs("div",{className:"group flex w-full flex-col gap-2",children:[t.jsx("div",{className:I("border-token-border-default bg-token-surface-primary relative flex w-full flex-col items-center overflow-hidden rounded-2xl border",T&&"outline-2 outline-offset-1 outline-orange-500"),children:t.jsxs("div",{className:"relative flex w-full flex-col overflow-hidden",children:[t.jsx("div",{className:"absolute start-0 end-0 top-0 bottom-0 dark:hue-rotate-180 dark:invert",children:t.jsx("video",{className:"h-full w-full object-cover",autoPlay:!0,loop:!0,muted:!0,playsInline:!0,children:t.jsx("source",{src:"https://persistent.oaistatic.com/deep-research/d9a42348470e-bg.mp4",type:"video/mp4"})})}),t.jsx(Jn,{top:y?.cursorTop??kt,left:y?.cursorLeft??Tt,text:y?.thought??"",actions:y?.actions??[],isKAUR1BR5:i}),t.jsx("div",{className:"relative flex h-full w-full flex-row",style:{transform:`translateX(-${(y?.currentWindowIndex??0)*100}%)`,transition:"transform 0.5s cubic-bezier(0.4,0,0.2,1)",width:"100%",paddingTop:i?"calc((714 / 1024 * 100%) + 38px)":"calc((697 / 1024 * 100%) + 38px)"},children:t.jsx("div",{className:"absolute inset-0 flex h-full flex-row",children:q})}),t.jsx(Dr,{value:h,max:Math.max(f.length-1,0),isPlaying:_,onChange:v=>{N(!1),g(v),v===f.length-1?E(!0):E(!1)},onPlayPause:()=>N(v=>!v),onRestart:()=>{g(0),N(!0),E(!1)},onLive:()=>{g(f.length-1),N(!0),E(!0)},isLive:k,isComplete:r,isKAUR1BR5:i})]})}),T&&t.jsxs("div",{className:"flex flex-row items-center justify-start gap-1",children:[t.jsx(or,{id:"risky-domain-warning",side:"top",sideOffset:-8,allowReopen:!0,className:"max-w-sm",content:t.jsxs("div",{className:"flex flex-col gap-1 text-sm",children:[t.jsx("div",{className:"font-semibold",children:t.jsx(W,{id:"OZapq8",defaultMessage:"Watch while ChatGPT works with sensitive data"})}),t.jsx("div",{children:t.jsx(W,{id:"1orBxj",defaultMessage:"ChatGPT is working with {riskyDomain}, which contains sensitive data. If you notice anything bad happening, you can stop the task.",values:{riskyDomain:t.jsx("span",{className:"font-medium",children:F})}})})]}),children:t.jsxs("div",{className:"flex flex-row items-center gap-1 text-orange-500",children:[t.jsx(ks,{className:"size-4 cursor-pointer"}),t.jsx(W,{id:"51tzX5",defaultMessage:"Sensitive data Â· Something not right?"})]})}),t.jsx("button",{className:"text-token-text-secondary underline","aria-label":Y(K.stopAgent),onClick:async()=>{await Ts(a,void 0,{clientInitiated:!0,reason:"watch_mode_stop",isLastTurnAgent:!0})},children:Y(K.stopAgent)})]})]})},$r=({isAgentTurn:e,clientThreadId:s,children:n,messageGroups:r,isExpanded:a,visualMode:o,isStreaming:i,isComplete:l,isStopping:u,isFinalAssistantTurn:d,isKAUR1BR5:m,enableVisualReaderMode:f=!1})=>{if(!e)return n;if(!a&&!i||u)return null;const p=o==="visual-cot",h=o==="list-cot";return t.jsxs("div",{className:"flex flex-col",children:[p&&t.jsx(Hr,{clientThreadId:s,messageGroups:r,isStreaming:i,isComplete:l,isFinalAssistantTurn:d,enableVisualReaderMode:f,isKAUR1BR5:m}),h&&t.jsx(Br,{children:n})]})},Br=({children:e})=>{const s=c.useRef(null),[n,r]=c.useState(!0);return c.useEffect(()=>{const a=s.current;if(!a)return;const o=()=>{const i=a.scrollHeight-a.scrollTop-a.clientHeight;r(i<=1)};return a.addEventListener("scroll",o,{passive:!0}),()=>a.removeEventListener("scroll",o)},[]),c.useEffect(()=>{const a=s.current;!a||!n||requestAnimationFrame(()=>{a.scrollTop=a.scrollHeight})},[e,n]),t.jsx("div",{ref:s,className:"border-token-border-light flex aspect-[614/493] flex-col overflow-auto rounded-lg border p-4",children:t.jsx("div",{className:"flex flex-col",children:e})})},It={duration:.3,ease:"easeInOut"},$e=.2,po=({isStreaming:e,isFinalAssistantTurn:s,messageGroups:n,nextMessageGroup:r,prevMessageGroup:a,isAutoswitchOptOutEnabled:o,handleSkipClick:i,isAgentTurn:l,isKAUR1BR5:u,latestError:d,wasInterrupted:m,lastAgentMetadataNode:f})=>{const p=c.useMemo(()=>n.some(k=>k.type===A.n7jupd_a||k.type===A.n7jupd_native_api_tool),[n]),{platformConnectors:h}=Is(p),{chunks:g,isAgentVisualCoT:_}=c.useMemo(()=>Tn(n),[n]),N=r?.messages.some(k=>Ca(k));return d&&!N?t.jsx(ka,{errorState:d,nodeId:d.messageId,isFeedbackEnabled:!1,clientThreadId:d.clientThreadId,isUserTurn:!1}):t.jsx(_a,{value:{platformConnectors:h},children:t.jsx(Vr,{isStreaming:e,isFinalAssistantTurn:s,chunks:g,isAutoswitchOptOutEnabled:o,isAgentTurn:l,handleSkipClick:i,nextMessageGroup:r,prevMessageGroup:a,messageGroups:n,isAgentVisualCoT:_,isKAUR1BR5:u,wasInterrupted:m,lastAgentMetadataNode:f})})},Wr=e=>{for(const{messages:s}of e)for(const{metadata:n}of s)if(n?.skip_reasoning_title)return n.skip_reasoning_title},Vr=({isStreaming:e,isFinalAssistantTurn:s,chunks:n,isAutoswitchOptOutEnabled:r,isAgentTurn:a,handleSkipClick:o,nextMessageGroup:i,prevMessageGroup:l,messageGroups:u=[],isAgentVisualCoT:d,isKAUR1BR5:m,wasInterrupted:f,lastAgentMetadataNode:p})=>{const h=H(),g=zt(),_=p?.metadata?.agent_entrypoint==="autoswitcher",N=a?_:r,k=N?Wr(u):void 0,E=Rs(),y=sn(n,e,E,_,m??!1),R=a?y!==V.Done:!1,F=As(Es),P=Ht(g,"1668913216")&&d&&!F,re=c.useMemo(()=>{let j="visual-cot";return p&&(j=p?.metadata?.default_view??"visual-cot"),j},[p]),[Q,oe]=c.useState(re),[L,Y]=c.useState(!1),[ae,U]=c.useState([]),q=c.useMemo(()=>rn(n),[n]),T=!e,v=c.useMemo(()=>a?n.filter(D=>D.type!==x.Recap&&D.type!==x.Thought).slice(-3).some(D=>D.type===x.ComputerOutput):!1,[n,a]),C=c.useMemo(()=>a&&n.some(j=>j.type===x.Recap&&j.content.includes("Stopped")),[n,a]),M=j=>j.metadata?.content_references?.length?j.metadata?.content_references?.length>0:j.metadata?.n7jupd_crefs?.length?j.metadata?.n7jupd_crefs?.length>0:!1,w=j=>j.metadata?.n7jupd_button_type!==void 0,b=c.useMemo(()=>a&&i?.messages.some(j=>M(j)),[i,a]),Z=c.useMemo(()=>a&&i?.messages.some(j=>w(j)),[i,a]),B=(v||Z)&&!C&&T&&!b&&!F&&!m,z=(l?.type===A.Text||l?.type===A.MultiText)&&l?.messages[0].author.role===Ve.Assistant,te=Na(n,j=>j.type!==x.Recap),[O,J]=c.useState(e?-1:n.length),ie=O===-1?void 0:n[O],pe=O<te||O===te&&!e,Ne=e?te:n.length,he=Gr(ie),[me,ve]=c.useState(!e||O<0),Je=c.useRef(performance.now()),Ke=c.useRef(performance.now());c.useEffect(()=>{Je.current=performance.now()},[O]),c.useEffect(()=>{Ke.current=performance.now()},[ie]);const[et]=c.useState(e);c.useEffect(()=>{if(et&&pe&&(me||d)){const j=performance.now(),D=Math.max(0,Ur(ie)-(j-Je.current),he-(j-Ke.current));setTimeout(()=>{J(Ne),ve(!1)},D)}},[et,pe,me,he,ie,Ne,d]);const ge=Ps(),se=T||P||ge?n:n.slice(0,O+1),{clientThreadId:tt}=Ma(),fe=Os(tt,j=>j?.interruptionInProgress),je=c.useMemo(()=>{const j=We(se);if(T)return j?.type===x.Recap?j:void 0;if(j?.type===x.Thought)return Be(se,D=>D.type===x.Thought&&D.thought.summary!=null&&D.thought.summary.length>0);if(j?.type===x.CodeAnalysis&&a){const D=Be(se.slice(0,-1),le=>le.type===x.Thought?le.thought.summary&&le.thought.summary.length>0:le.type!==x.CodeAnalysis);if(D)return D}return j},[T,se,a]),st=[...se.entries()],at=L||P?st:st.slice(-1);qr(O,T);const nt=se.some(j=>j.type===x.Glaux),be=se.length>0&&(n[0].type!==x.Recap||nt),rt=We(se),es=rt?.type===x.Browsing&&!L||rt?.type===x.N7jupdAPI&&!L,ts=be&&(!T&&(a||!ge)||L)&&!es&&!R&&(a?!fe:!0),Me=!ge&&(be||N)&&!T&&!L&&!R&&!(a&&fe)&&!P,ss=Sa(ae)+(ae.length-1)*vt+2*Fe,as=T||P?"auto":L?ss:(ae[O]??0)+2*Fe,Ee=se.length<2&&!ge,ot=je&&ye(h,je,T,fe,!0,y),ns=c.useCallback((j,D)=>{j===O&&D===Xt.ENTER&&setTimeout(()=>{ve(!0)},he)},[O,he]),Oe=c.useCallback((j,D)=>{Y(j),qe.count(Xe.COT_SUMMARIZER,j?"expand":"collapse",[{key:"is_streaming",value:String(e)},{key:"source",value:D}]),Ie.logEventWithStatsig(j?"CoT Expanded":"CoT Collapsed",j?"chatgpt_cot_expanded":"chatgpt_cot_collapsed",{is_streaming:String(e),source:D})},[e]),rs=c.useCallback(()=>{Ee||Oe(!0,"chunk")},[Oe,Ee]),os=c.useCallback((j,D)=>{U(le=>{const ut=[...le];return ut[j]=D,ut})},[]);c.useEffect(()=>{T||O<0||Ie.logEventWithStatsig(L?"Streamed CoT Chunk Viewed":"Streamed CoT Chunk Ignored",L?"chatgpt_streamed_cot_chunk_viewed":"chatgpt_streamed_cot_chunk_ignored")},[O,T,L,e]);const it=T&&!be,is=e&&(!be||Me)&&!N||a&&y===V.Thinking,lt=(be||N)&&(!a||y!==V.Thinking),ls=(a||!ge)&&!(a&&fe)&&!P,ct=t.jsxs(t.Fragment,{children:[!z&&t.jsx(Xr,{}),t.jsxs("div",{className:I("relative my-1 min-h-6",z?Me&&lt?"mt-6":"mt-3":void 0),children:[is&&t.jsx(S.div,{className:"loading-shimmer text-token-text-secondary absolute start-2 top-0 mx-[calc(--spacing(-2)-1px)] select-none",initial:e&&{translateX:-8,opacity:0},animate:{translateX:0,opacity:1},transition:{ease:"easeInOut",duration:$e},children:t.jsx(W,{id:"hgnsat",defaultMessage:"Thinking"})}),lt&&t.jsxs(S.div,{className:I("relative flex max-w-[calc(0.8*var(--thread-content-max-width,40rem))] origin-top-left flex-col gap-2 overflow-x-clip",Me&&"bg-token-main-surface-primary border-token-border-default thread-md:-start-3 thread-md:-top-4 -top-2 mx-[calc(--spacing(-2)-1px)] -my-[1px] box-content rounded-2xl border bg-clip-padding px-5 py-4",R&&"mx-[calc(--spacing(-2)-1px)]",Me&&N&&"@3xl:mx-[calc(--spacing(2)-1px)]",a&&"overflow-x-visible"),initial:e&&(a||!ge)&&{opacity:0,scale:.85},animate:{opacity:1,scale:1},transition:{ease:"easeOut",duration:$e},children:[R&&!N?t.jsx(S.div,{className:"loading-shimmer text-token-text-secondary absolute start-2 top-0 select-none",initial:e&&{translateX:-8,opacity:0},animate:{translateX:0,opacity:1},transition:{ease:"easeInOut",duration:$e},children:ot},ot):t.jsx(Fs,{isAgentVisualCoT:d,latestHeadline:je&&ye(h,je,T,fe,a,y),latestChunk:je,counters:q,onToggleExpanded:()=>Oe(!L,"header"),showChunkIcon:ls,isExpanded:L,isExpandDisabled:Ee,isComplete:T,onSkip:N?o:void 0,skipTitle:k,shouldDisplayVisualCoT:P,agentVisualMode:Q,setAgentVisualMode:oe,isStreaming:e,interruptionInProgress:fe,isKAUR1BR5:m,wasInterrupted:f}),t.jsx($r,{clientThreadId:tt,isAgentTurn:!!P,isFinalAssistantTurn:s,messageGroups:u,isExpanded:L,visualMode:Q,isStreaming:e,isComplete:T,isStopping:!!fe,isKAUR1BR5:!!m,children:t.jsx(ue,{children:(ts||P)&&t.jsx(S.div,{className:"relative z-0",initial:T?{opacity:0,height:P?"auto":0,overflowY:"hidden"}:!1,animate:{opacity:1,height:as},exit:{height:P?"auto":0,opacity:0,pointerEvents:"none",overflowY:"hidden",filter:T?"blur(8px)":void 0,translateY:-24},transition:It,children:t.jsx("div",{className:"relative flex h-full flex-col",style:{margin:`${Fe}px 0`},children:t.jsx(ue,{children:at.map(([j,D],le)=>t.jsx(kn,{index:j,chunk:D,gap:vt,isLast:at.length-1===le,onClick:rs,onAnimationComplete:ns,onMeasure:os,isAnimationComplete:T,isExpanded:L||P,showBullet:L||P,isKAUR1BR5:m,hasGlauxMessages:nt},j))})})})})}),B&&t.jsx(Ka,{chunks:se,isExpanded:L,isFinalAssistantTurn:s,hidePowTombstone:!!P,isKAUR1BR5:!!m})]})]})]});return a?t.jsx(ue,{mode:"wait",children:!it&&t.jsx(S.div,{initial:!1,animate:{height:"auto",opacity:1,scale:1},exit:{height:0,opacity:0,scale:.9,filter:"blur(6px)"},transition:{height:It,opacity:{duration:0,ease:"linear"}},children:ct},"cot-wrapper")}):it?null:ct};function Ur(e){return e?.type===x.Thought?Math.min(3e3,1e3+e.thought.content.length*3.5):1200}function Gr(e){return e?.type===x.Thought?500:0}function qr(e,s){const n=c.useRef(null),r=Ia(e),a=c.useCallback(()=>{if(n.current!=null){const o=performance.now()-n.current;qe.hist(Xe.COT_SUMMARIZER,"cot_chunk_display_time",void 0,o)}},[r]);c.useEffect(()=>{if(s){a();return}e!==-1&&(a(),n.current=performance.now())},[e,s,a])}function Xr(){return t.jsx(S.div,{className:"absolute flex h-8 w-3 origin-center items-center justify-center",initial:{scale:1,opacity:1},animate:{scale:0,opacity:0},transition:{ease:"easeInOut",duration:.2},children:t.jsx("div",{className:"bg-token-text-primary h-3 w-3 rounded-full"})})}export{po as CoT,Vr as CoTChunks};
//# sourceMappingURL=pfmeky3hgwt4ozsa.js.map
