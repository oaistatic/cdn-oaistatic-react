import{r as l,ao as Q,b as Z,f as J,j as i,A as ee,m as C}from"./m60bpb0x3x7rg8fj.js";import{aF as _,gE as te,W,ap as H,T as I,gN as se,ef as ae,of as oe,fj as ne,hw as U,dI as ie,aA as O,rd as re,aE as ce,m8 as de}from"./lgw4q0e8zlqqfgug.js";import{lT as le,lU as V,iM as ue,C as v,lV as me,lW as he,k7 as pe,lX as fe,lY as ge,lZ as xe,l_ as Ce,lS as ve,l$ as Te,m0 as Ie,m1 as we,m2 as j,m3 as G,lQ as be,u as Ee,dh as D,m4 as L,m5 as P,m6 as Se,m7 as ye,m8 as _e}from"./ggjzadbnd3k1vu0k.js";import{L as Ae}from"./5a6x9gba3iwtvxlr.js";import{T as Re}from"./lfugw8qvvom7caj7.js";import{g as Ne}from"./btagl6w1gub4aw61.js";import"./jy1u8exw8iz2slve.js";import"./g61ghrdmm0y010eo.js";import"./kfjcy5y4cxuymbdf.js";import"./cum2m9ppsxjdt1u5.js";import"./ns51nblw8ziscsgd.js";import"./9q3v44p2xpoi75pn.js";import"./imrl18sy28ygoppx.js";import"./kh89q49991ykwivd.js";import"./kl7c6054usfnqmd4.js";import"./mia7qmdupqoji40k.js";import"./cqdszxwxh9yigbop.js";import"./koh2m2w2ywhm6pl3.js";import"./hs2mcew9gnq8d8k8.js";import"./j770ggbjd02m3hqj.js";import"./g4h5bud8allgzrnd.js";import"./n70zh1fo8aekhdb0.js";import"./lf8mxjdfum7t34gh.js";import"./d4l47j95cc16bbv9.js";import"./mlo67gs1ylzshmge.js";import"./h81zqbvh0a7amk0o.js";import"./bk8slwxjkdlmxjxm.js";import"./og0mzunrykkt4tp0.js";import"./lff9oru7r5vtmz06.js";import"./tfkm8dsw7zx8il21.js";import"./rx5cs0ja7c7phupc.js";import"./n5yj38pa2aamrsfp.js";import"./mog17ocsx2bkw4q4.js";import"./evlyokzg1xrjbsou.js";const k="oai/apps/canmoreSidebarWidth",Me=.25,De=400,z=400;function B(e){return e-De}function S(e,a){return Q(z,B(e),a??Me*e)}function Fe(){const e=_.useState(_.selectWindowWidth),a=S(e,te(W.DANGER_SECRET_FOLDERS_ONLY_getItem(k))),s=q(),[t,n]=l.useState(a);l.useEffect(()=>{(t<z||t>B(e))&&n(S(e,t))},[e]);function c(m){n(T=>S(e,T+=m.delta.x))}function o(m){n(m),W.DANGER_SECRET_FOLDERS_ONLY_setItem(k,m)}function r(){const m=S(e,void 0);o(m)}const d=`calc(100vw - ${t}px)`;return s?{chatWidth:t,canvasWidth:e-t,canvasWidthCalc:d,viewportWidth:e,handleDrag:c,handleDoubleClick:r,persist:o}:{chatWidth:0,canvasWidth:e,canvasWidthCalc:"100vw",viewportWidth:e,handleDrag:()=>{},handleDoubleClick:()=>{},persist:()=>{}}}function q(e){const a=_.useState(_.selectWindowWidth);return(e??a)>1e3}const M="sharedCanvas";function We(){const[e,a]=Z(),s=e.get(M),t=J();l.useEffect(()=>{const n=s&&le.createRemixTempTextdoc(s,t);if(!n)return;requestAnimationFrame(()=>{V(n)});const c=new URLSearchParams(e);c.delete(M),a(c);const o=new URL(window.location.href);o.searchParams.delete(M),history.replaceState(null,"",o)},[s,e,a,t])}const Oe="textdocId",je=e=>{const s=new URLSearchParams(window.location.search).get(Oe),t=H(e,n=>I.findNode(n,({message:c})=>{const o=c.metadata?.canvas;return o?.create_source===ue.HIVE&&(s?o?.textdoc_id===s:!0)})?.message.metadata?.canvas?.textdoc_id);l.useEffect(()=>{t&&requestAnimationFrame(()=>{V(t)})},[t])};function Le(e,a){let s;return a?.type===v.Textdoc&&(a.textdocId.startsWith(me)||(s={type:"canvas_textdoc",id:a.textdocId})),he(e,{promptMessage:{metadata:{open_in_canvas_view:s}}})}const Y=({isFullScreen:e=!1,clientThreadId:a,focusedObject:s,onClose:t,isAnimating:n=!1,width:c})=>{const{setTargetedContent:o}=pe(),r=l.useRef(!1);if(l.useEffect(()=>(r.current&&o(void 0),r.current=!0,()=>{r.current=!1}),[s]),s==null)return null;switch(s.type){case v.Textdoc:return i.jsx(Re,{isFullScreen:e,onClose:t,clientThreadId:a,focusedTextdoc:s,isAnimating:n,width:c});case v.ADAVisualization:return null}},Pe=300,ke=e=>{switch(e?.type){case v.Textdoc:return e.textdocId;default:return null}};function He({clientThreadId:e,isDisabled:a,disabledTypes:s}){const[t,n,c,o,r]=H(e,u=>[I.getRequestId(u),I.getConversationLastTurn(u),I.isMessageTurnEnded(u),I.getVariantIds(u).length>1,I.lastUserMessage(u)],{disablePerfDetector:!0}),d=se(t),m=fe(),[T,p]=l.useMemo(()=>{if(n&&o)return[void 0,null];if(a===!0)return[void 0,null];if(r!=null){const h=ge(r);if(h)return[r.id,{type:v.Textdoc,textdocId:h}]}let u;return!c&&n&&(u=ae(n.messageGroups,h=>h.type!==oe)),Ue({groupedMessage:u,isRequestActive:d,latestTextdocId:m,disabledTypes:s})},[c,n,o,a,d,m,s,r]),w=p!=null,A=ke(p),R=xe("canvas");l.useEffect(()=>{if(p&&T&&!ne()&&(R(),Ce(p,T),p.type===v.Textdoc)){const{textdocId:u}=p,h=Ne(u);ve(document.getElementById(h))}},[w,A])}function Ue({groupedMessage:e,isRequestActive:a,latestTextdocId:s,disabledTypes:t}){if(e?.type&&t.includes(e.type))return[void 0,null];switch(e?.type){case U.Canmore:{const[n,c]=e.messages;if(!Te(n))break;const o=Ie(a,n,c??null),r=o.textdocId??s;if(r&&(o.function===we.CreateTextdoc?(o.content??"").length>Pe||o.status===j.WAITING:o.status===j.STREAMING))return[o.messageId,{type:v.Textdoc,textdocId:r}];break}}return[void 0,null]}const y={type:"spring",bounce:.12,duration:.64},Ve={type:"spring",bounce:0,duration:.58},x={duration:0},Ge=({clientThreadId:e,focusedObject:a,onClose:s})=>{const{chatWidth:t,canvasWidthCalc:n,handleDrag:c,handleDoubleClick:o,persist:r}=Fe(),d=D(),[m,T]=l.useState(!d),[p,w]=l.useState(!1),A=d?x:y,R=d?x:Ve,u=Se(({rect:f})=>f),{windowHeight:h,windowWidth:b}=ce(f=>f,{windowWidth:0,windowHeight:0});let g=u??{top:0,left:t,width:b-t,height:h},F=!1;if(u&&(g.top<0||g.top+g.height>h)){F=!0;const f={width:(b-t)*.75,height:h*.75};g={top:h/2-f.height/2,left:(b-t-f.width)/2+t,width:f.width,height:f.height}}const E=u?.borderRadius,N=ye(),K=N?.history!=null||N?.showChangesAtVersion!=null,X=de();return i.jsxs(i.Fragment,{children:[K&&i.jsx(Ae,{onClick:()=>_e(N.textdocId),zIndexKey:"chatOverlay"}),i.jsxs(C.div,{initial:{marginInlineEnd:X?-260:0},animate:{marginInlineEnd:0},transition:R,children:[i.jsx(C.div,{initial:{opacity:1},animate:{opacity:0},exit:{opacity:[1,0]},transition:d?x:{...y,delay:.22},className:"bg-token-main-surface-primary pointer-events-none absolute start-0 top-0 z-20 h-full w-full"}),i.jsx(C.div,{className:"relative z-20 h-full",style:{width:n},exit:{width:0},transition:d?x:{type:"spring",bounce:0,duration:.1}})]}),i.jsx(C.div,{className:"bg-token-bg-primary absolute start-0 z-20 h-full overflow-hidden shadow-[0_0_18px_rgba(0,0,0,0.12)] dark:shadow-[0_0_18px_rgba(0,0,0,0.48)]",initial:{borderRadius:E,opacity:F?0:1,x:g.left,y:g.top,height:g.height,width:g.width},animate:{opacity:1,x:t,y:0,width:n,height:h,borderRadius:0},exit:{scale:.64,opacity:0,filter:"blur(12px)",transition:d?x:{opacity:{duration:.14,bounce:.1}},borderRadius:E},transition:p||d?x:y,onAnimationComplete:()=>T(!1),children:i.jsx(C.div,{className:"dark:border-token-border-light border-token-border-medium h-full overflow-hidden border-s",initial:{borderRadius:E},animate:{borderRadius:0},exit:{borderRadius:E},transition:A,children:i.jsxs("div",{className:"h-full",children:[i.jsx(C.div,{drag:"x",className:"bg-token-text-quaternary absolute start-[-2px] z-10 h-full w-[4px] cursor-ew-resize opacity-0",whileHover:{opacity:.5},whileDrag:{opacity:.75,width:"8px",left:"-4px"},transition:d?x:{type:"tween",duration:.1},style:{x:0,y:0,transform:"translateX(0px)"},dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:{left:0,right:0,top:0,bottom:0},onPointerDown:()=>w(!0),onPointerUp:()=>w(!1),onDrag:(f,$)=>c($),onDragEnd:()=>{w(!1),r(t)},onDoubleClick:()=>o()}),p&&i.jsx("div",{className:"absolute inset-0 z-10"}),i.jsx(Y,{onClose:s,clientThreadId:e,isAnimating:!d&&m,focusedObject:a,width:b-t})]})})})]})},ze=l.memo(Ge),Be=({clientThreadId:e,focusedObject:a,onClose:s})=>{const t=D();return i.jsx(re,{open:!0,className:"fixed inset-0 z-50 h-full w-full",children:i.jsx(C.div,{className:"z-40 h-full w-full overflow-hidden shadow-xl md:border-gray-100 md:dark:border-gray-700",initial:{scale:.98},animate:{scale:1},transition:t?x:y,children:i.jsx(Y,{isFullScreen:!0,clientThreadId:e,focusedObject:a,onClose:s})})})},qe=({clientThreadId:e,overrideWidth:a,isAutoFocusDisabled:s=!1})=>{const t=Ee(),n=q(a),c=D();He({clientThreadId:e,isDisabled:s,disabledTypes:c?[U.Canmore]:[]}),We(),je(e);const o=l.useRef(!1);l.useEffect(()=>{o.current?G():o.current=!0},[e]);const r=t&&(n?i.jsx(ze,{clientThreadId:e,onClose:P,focusedObject:t},"canvas-sidebar"):i.jsx(Be,{clientThreadId:e,onClose:P,focusedObject:t},"canvas-modal"));l.useEffect(()=>{if(t)return L(m=>Le(m,t)),()=>L(null)},[t]);const d=r!=null;return l.useEffect(()=>(O.setActiveStageSidebar(d),()=>{d&&O.setActiveStageSidebar(!1)}),[d]),c?r:i.jsx(ee,{children:r},e)},_t=e=>{const a=l.useRef(null);return i.jsx(ie,{ref:a,onError:(s,t)=>{G(),setTimeout(()=>{a.current?.resetErrorBoundary()}),be.logError("Error boundary hit",s,{componentStack:t})},name:"canmore-focused-view",children:i.jsx(qe,{...e})})};export{_t as CanvasFocusedViewManager};
//# sourceMappingURL=lmmncseuw4iapdij.js.map
