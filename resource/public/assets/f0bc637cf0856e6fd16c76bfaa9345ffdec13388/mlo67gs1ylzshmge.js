import{r as o,j as d,R as x}from"./m60bpb0x3x7rg8fj.js";import{dn as M,dp as v,dq as C,dr as T,ds as R,aH as P}from"./ggjzadbnd3k1vu0k.js";import{T as y}from"./h81zqbvh0a7amk0o.js";import{gM as p,dC as D,T as S,g as A,ap as B,pa as E}from"./lgw4q0e8zlqqfgug.js";function I(e){const{bufferType:f,isActivelyStreaming:r,messages:c,parts:s,...n}=e,a=c[c.length-1].id,[u,i]=o.useState(p(s)),t=o.useRef(void 0);if(t.current===void 0)switch(f){case"Adaptive":t.current=new C(s,i,r);break;case"ChunkedCatchup":t.current=new v(s,i,r);break;case"Punctuation":t.current=new M(s,i,r);break}return o.useEffect(()=>{t.current!=null&&(t.current.onMessagePartsUpdated(s,r),t.current.isBuffering()&&T.addDelayedRenderingMessage(a))},[s,a,r]),o.useEffect(()=>{t.current!=null&&t.current.removeDelayedRender()&&T.removeDelayedRenderingMessage(a)},[u,a]),o.useEffect(()=>()=>T.removeDelayedRenderingMessage(a),[a]),o.useEffect(()=>()=>{t.current?.destroy(),t.current=void 0},[]),d.jsx(y,{...n,messages:c,parts:s,displayParts:u,isActivelyStreaming:r||!!t.current?.isBuffering()})}function j({message:e,isCompletionInProgress:f,hasActiveRequest:r,clientThreadId:c,className:s,isUserTurn:n,isFinalUserTurn:a,turnIndex:u,isFeedbackEnabled:i,prevGroupedMessageType:t,prevGroupedMessages:g,citableMessages:m,superWidgetImages:l}){const h=o.useMemo(()=>"parts"in e.content?e.content.parts:[D(e)],[e]);return d.jsxs(d.Fragment,{children:[d.jsx(k,{parts:h,messages:[e],hasActiveRequest:r,isCompletionInProgress:f,className:s,citations:e.metadata?.citations,contentReferences:e.metadata?.content_references,attachments:e.metadata?.attachments,isUserTurn:n,isFinalUserTurn:a,turnIndex:u,id:e.id,isFeedbackEnabled:i,clientThreadId:c,prevGroupedMessageType:t,prevGroupedMessages:g,citableMessages:m,superWidgetImages:l}),!1]})}const G=x.memo(j),b=()=>null;function k(e){const f=b()!=null,r=e.messages.length>1,c=S.isLastActorMessage(A(e.clientThreadId),e.messages[0].id),s=!!B(e.clientThreadId,l=>l?.sharedConversationMetadata),n=r?void 0:R(e.messages[0],c,f,e.isCompletionInProgress||e.hasActiveRequest,s),a=n?.flagSeverity!=="danger"&&e.isCompletionInProgress,u=!e.parts.some(l=>l!==""),{bufferType:i,wordFadeType:t}=P(),[g,m]=o.useState(()=>t!=="indexed"&&i!=="none"&&!e.isUserTurn&&(e.isCompletionInProgress||u&&!n));return n&&g&&m(!1),g?d.jsx(I,{...e,bufferType:i,isActivelyStreaming:a,errorState:n}):d.jsx(y,{...e,displayParts:E({isUserTurn:e.isUserTurn,parts:e.parts}),isActivelyStreaming:a,errorState:n})}export{G as T,k as a};
//# sourceMappingURL=mlo67gs1ylzshmge.js.map
