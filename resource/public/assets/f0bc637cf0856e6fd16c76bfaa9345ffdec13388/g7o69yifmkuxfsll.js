import{sr as k,k3 as O,cf as G,W as l,M as h,ei as S,R as i,kI as C,aa as R,kH as E,cj as L,iz as j,ss as N,c as K,cq as H,cs as $,z as y,md as Q,aD as U}from"./lgw4q0e8zlqqfgug.js";import{kR as z,ib as V,ic as Z,pI as x,pJ as M}from"./ggjzadbnd3k1vu0k.js";import{n as v,o as J,u as m,r as c,j as p,f as X,M as b,A as Y,m as ee}from"./m60bpb0x3x7rg8fj.js";import{W as P,a as I,b as A}from"./m9elivgqkyz3hcka.js";function we(s,e=!1){return s?.output_items?.map(t=>!e&&t.type==="output_diff"?t.diff:e&&t.type==="follow_up_diff"||!e&&t.type==="pr"?t.output_diff.diff:!e&&t.type==="cr"?t.reviewed_diff.diff:null)?.filter(t=>!!t)??[]}function te(s){if(s==null)return"";const e=s?.environment?.repos?.[0],t=e?s?.environment?.repo_map?.[e]:null,a=t&&ae(t)?se(t.git_url):null,n=s?.branch;return s.output_items.filter(r=>r.type==="message").flatMap(r=>r.content).map(r=>{switch(r.content_type){case"text":return r.text;case"terminal_chunk_citation":return`${k}:${A}[${A}]{line_range_start=${r.line_range_start} line_range_end=${r.line_range_end} terminal_chunk_id=${r.terminal_chunk_id}}${k}`;case"repo_file_citation":{const u=a?`${a}/blob/${n}/${r.path}#L${r.line_range_start}-L${r.line_range_end}`:null;return`${k}:${I}[${I}]{line_range_start=${r.line_range_start} line_range_end=${r.line_range_end} path=${r.path}${u?` git_url="${u}"`:""}}${k}`}case"image_asset_pointer":return"";case"image_asset_pointer_citation":return`${k}:${P}[${P}]{asset_pointer=${r.asset_pointer}}${k}`;case void 0:return""}return""}).join("")}function se(s){return s.replace(/\.git$/,"").replace("git://","https://")}function ae(s){return s?.id?.startsWith("github")||(s?.git_url?.indexOf("github.com")??-1)>=0}function F(s){return"output_items"in s}function ye(s){return"input_items"in s}function re(s){return s?s.input_items?.flatMap(e=>"content"in e?e?.content:[])?.map(e=>e.content_type==="text"?e.text:"")?.join("")??"":""}function ve(s){return s?F(s)?te(s):re(s):""}function ne(s){return s.type==="cr"}function Te(s){if(!s||!F(s)||!s.output_items)return[];const e=[];for(const t of s.output_items)ne(t)&&e.push(...t.comments);return e}function qe(s){return s?.turn!=null}function Re(s){return B(s.task_status_display?.latest_turn_status_display?.turn_status)}function B(s){switch(s){case null:case void 0:case"completed":case"failed":case"cancelled":return!0;case"pending":case"in_progress":return!1;default:O(s)}}const ie=()=>{const s=l.getItem(h.WhamLastRepositoryId);return typeof s=="string"?s:null},w=G()((s,e)=>({environmentId:l.getItem(h.LastEnvironment),branch:null,manuallyAddedBranches:[],promptDraft:l.getItem(h.PromptDraft)??"",selectedRepositoryId:ie()??null,tasksFilter:"current",taskTurnMap:{},showReactQueryDevtools:!1,lastClickedChangelogDate:l.getItem(h.WhamChangelogClickedDate)??null,pendingTaskIds:{},hasSubmittedTaskInSession:!1,lastViewedTaskId:null,bestOfN:l.getItem(h.WhamBestOfN),codexOnboardingState:l.getItem(h.WhamCodexOnboardingState),preferredEditor:function(){const t=l.getItem(h.WhamPreferredEditor);return["cursor","vscode","windsurf"].includes(t)?t:"vscode"}(),homeTab:"all",_fetchedRateLimit:null,_forcedRateLimit:function(){return null}(),setShowReactQueryDevtools:t=>{l.setItem(h.ReactQueryDevtoolsVisible,t),s({showReactQueryDevtools:t})},setLastClickedChangelogDate:t=>{l.setItem(h.WhamChangelogClickedDate,t),s({lastClickedChangelogDate:t})},setPromptDraft:t=>{l.setItem(h.PromptDraft,t),s({promptDraft:t})},setEnvironmentId:t=>{t==null?l.removeItem(h.LastEnvironment):l.setItem(h.LastEnvironment,t),s({environmentId:t})},setBranch:t=>s({branch:t}),setSelectedRepositoryId:t=>{l.setItem(h.WhamLastRepositoryId,t),s({selectedRepositoryId:t})},addManuallyAddedBranch:t=>s(a=>a.manuallyAddedBranches.includes(t)?{}:{manuallyAddedBranches:[t,...a.manuallyAddedBranches]}),setTasksFilter:t=>s({tasksFilter:t}),setHomeTabValue:t=>s({homeTab:t}),setLastViewedTaskId:t=>s({lastViewedTaskId:t}),setHasSubmittedTaskInSession:t=>s({hasSubmittedTaskInSession:t}),addTurnToTaskMap:(t,a)=>{s(n=>{const r=n.taskTurnMap[t],o=r?{...r}:{};return o[a.id]=a,{taskTurnMap:{...n.taskTurnMap,[t]:o}}})},updateTurnDiscarded:(t,a,n)=>{s(r=>{const o=r.taskTurnMap[t],u=o?.[a];return!o||!u?{}:{taskTurnMap:{...r.taskTurnMap,[t]:{...o,[a]:{...u,discarded:n}}}}})},getTurnsForTask:t=>{const a=e().taskTurnMap[t]??[];return Object.values(a).sort((n,r)=>n.created_at-r.created_at)},addPendingTaskId:t=>{const a={...e().pendingTaskIds};a[t]=t,s({pendingTaskIds:a})},removePendingTaskId:t=>{const a={...e().pendingTaskIds};delete a[t],s({pendingTaskIds:a})},removePendingTaskByTaskId:t=>{const a=e().pendingTaskIds,[n]=Object.entries(a).find(([r,o])=>o===t)??[];if(n){const r={...a};delete r[n],s({pendingTaskIds:r})}},assignPendingTaskToFinalTask:(t,a)=>s(n=>({pendingTaskIds:{...n.pendingTaskIds,[t]:a}})),getRateLimit:()=>e()._fetchedRateLimit,setRateLimit:t=>s({_fetchedRateLimit:t}),forceRateLimit:t=>{},setBestOfN:t=>{l.setItem(h.WhamBestOfN,t),s({bestOfN:t})},setPreferredEditor:t=>{l.setItem(h.WhamPreferredEditor,t),s({preferredEditor:t})},setCodexOnboardingState:t=>{l.setItem(h.WhamCodexOnboardingState,t),s({codexOnboardingState:t})}}));function be(s,e,t,a){switch(s.type){case"repo_not_accessible":a.danger(t.formatMessage({id:"wham.whamComposer.repoNotAccessible",defaultMessage:"Can’t access GitHub repository. Verify your repository access on GitHub, or reconnect your GitHub account in Codex Settings."}),{id:e,duration:10,hasCloseButton:!0,loggingTitle:"Can't access GitHub repository. Verify your repository access on GitHub, or reconnect your GitHub account in Codex Settings."});return;case"missing_github_connector_link":a.danger(t.formatMessage({id:"wham.whamComposer.missingGithubConnectorLink",defaultMessage:"No GitHub connection. Please reconnect your GitHub account in Codex Settings."}),{id:e,duration:10,hasCloseButton:!0,loggingTitle:"No GitHub connection. Please reconnect your GitHub account in Codex Settings."});return;case"non_terminal_turn":a.danger(t.formatMessage({id:"wham.whamComposer.nonTerminalTurn",defaultMessage:"Task already has a running turn"}),{id:e,duration:10,hasCloseButton:!0,loggingTitle:"Task already has a running turn"});return;case"repo_not_initialized":a.danger(t.formatMessage({id:"wham.whamComposer.repoNotInitialized",defaultMessage:"GitHub Repository must be initialized to be used within Codex"}),{id:e,duration:10,hasCloseButton:!0,loggingTitle:"GitHub Repository must be initialized to be used within Codex"});return;case"branch_creation_not_allowed":a.danger(t.formatMessage({id:"wham.whamComposer.branchCreationNotAllowed",defaultMessage:"Branch creation unauthorized for this repository. Please check your GitHub permissions."}),{loggingTitle:"Branch creation unauthorized for this repository. Please check your GitHub permissions."});return;case"pull_request_not_allowed":a.danger(t.formatMessage({id:"wham.whamComposer.pullRequestNotAllowed",defaultMessage:"Repository does not allow pull requests from Codex. Please check your GitHub permissions."}),{loggingTitle:"Repository does not allow pull requests from Codex. Please check your GitHub permissions."});return;case"verified_commits_required":a.danger(t.formatMessage({id:"wham.whamComposer.verifiedCommitsRequired",defaultMessage:"Codex does not currently support PRs in repositories that require verified commits"}),{loggingTitle:"Codex does not currently support PRs in repositories that require verified commits"});return;case"binary_files_not_supported":a.danger(t.formatMessage({id:"wham.whamComposer.binaryFilesNotSupported",defaultMessage:"Binary files are not supported"}),{id:e,duration:10,hasCloseButton:!0});return;case"commit_pattern_required":a.danger(t.formatMessage({id:"wham.whamComposer.commitPatternRequired",defaultMessage:"Commit message must match a given regex pattern"}),{id:e,duration:10,hasCloseButton:!0});return;case"pull_request_updated_outside_of_codex":a.danger(t.formatMessage({id:"wham.whamComposer.pullRequestUpdatedOutsideOfCodex",defaultMessage:"Codex does not currently support updating PRs that are updated outside of Codex. For now, please create a new PR."}),{id:e,duration:10,hasCloseButton:!0});return;case"pull_request_not_open":a.danger(t.formatMessage({id:"wham.whamComposer.pullRequestNotOpen",defaultMessage:"Pull request is no longer open. Refreshing status…"}),{id:e,duration:10,hasCloseButton:!0});return;case"branch_no_longer_exists":a.danger(t.formatMessage({id:"wham.whamComposer.branchNoLongerExists",defaultMessage:"Existing PR branch appears to no longer exist. Please create a new PR."}),{id:e,duration:10,hasCloseButton:!0});return;case"pull_request_not_found_on_task":a.danger(t.formatMessage({id:"wham.whamComposer.pullRequestNotFoundOnTask",defaultMessage:"Pull request not found for task"}),{id:e,duration:10,hasCloseButton:!0,loggingTitle:"Binary files are not supported"});return;default:return null}}class oe extends S{type;payload;constructor(e,t,a,n,r){super(e.message,t,a,n,r),this.type=e.type,this.payload=e}}function ue(s){const e=s.detail;if(e&&typeof e.type=="string"&&typeof e.message=="string"){const t={type:e.type,message:e.message};throw new oe(t,s.status,{},s.requestId,s.rawError)}throw s}class d{static async _wrapWhamRequest(e){try{return await e()}catch(t){throw t instanceof S&&ue(t),t}}static getTasks(e=10,t=null,a="current"){return this._wrapWhamRequest(()=>i.safeGet("/wham/tasks",{parameters:{query:{limit:e,cursor:t,task_filter:a}}}))}static getTasksForList(e=10,t=null,a="current"){return this._wrapWhamRequest(()=>i.safeGet("/wham/tasks/list",{parameters:{query:{limit:e,cursor:t,task_filter:a}}}))}static getTaskDetails(e){return this._wrapWhamRequest(()=>i.safeGet("/wham/tasks/{task_id}",{parameters:{path:{task_id:e}}}))}static getTaskTurnPR(e,t){return this._wrapWhamRequest(()=>i.safeGet("/wham/tasks/{task_id}/turns/{task_turn_id}/pr",{parameters:{path:{task_id:e,task_turn_id:t}}}))}static getUserHandle(){return this._wrapWhamRequest(()=>i.safeGet("/wham/task_suggestions/github/user_handle",{}))}static getTaskTurn(e,t){return this._wrapWhamRequest(()=>i.safeGet("/wham/tasks/{task_id}/turns/{task_turn_id}",{parameters:{path:{task_id:e,task_turn_id:t}}}))}static getSiblingTurns(e,t){return this._wrapWhamRequest(()=>i.safeGet("/wham/tasks/{task_id}/turns/{task_turn_id}/sibling_turns",{parameters:{path:{task_id:e,task_turn_id:t}}}))}static getGithubInstallations(){return this._wrapWhamRequest(()=>i.safeGet("/wham/github/installations",{}))}static getGithubInstallationsV2(){return this._wrapWhamRequest(()=>i.safeGet("/wham/github/installations/v2",{}))}static getGithubInstallationEvents(){return this._wrapWhamRequest(()=>i.safeGet("/wham/github/installations/events",{}))}static getGithubInstallationEventsV2(){return this._wrapWhamRequest(()=>i.safeGet("/wham/github/installations/events/v2",{}))}static feedback({thumbRating:e,text:t,taskId:a,turnId:n,shareUrl:r,pullRequestUrl:o,category:u}){return this._wrapWhamRequest(()=>i.safePost("/wham/feedback",{requestBody:{thumb_rating:e,text:t,conversation_id:null,message_id:null,task_id:a,turn_id:n,share_url:r,pull_request_url:o,category:u}}))}static archiveTask(e){return this._wrapWhamRequest(()=>i.safePost("/wham/tasks/{task_id}/archive",{parameters:{path:{task_id:e}}}))}static recoverTask(e){return this._wrapWhamRequest(()=>i.safePost("/wham/tasks/{task_id}/recover",{parameters:{path:{task_id:e}}}))}static updatePr(e,t,a){return this._wrapWhamRequest(()=>i.safePatch("/wham/tasks/{task_id}/turns/{task_turn_id}/pr/{pr_id}",{parameters:{path:{task_id:e,task_turn_id:t,pr_id:a}}}))}static createPr(e,t,a,n){return this._wrapWhamRequest(()=>i.safePost("/wham/tasks/{task_id}/turns/{task_turn_id}/pr",{parameters:{path:{task_id:e,task_turn_id:t}},requestBody:{mode:a,add_codex_tag:n}}))}static getRepositoriesByInstallationId(e,t,a){return this._wrapWhamRequest(()=>i.safeGet("/wham/github/repositories/v2/{installation_id}",{parameters:{path:{installation_id:e},query:{page:t,per_page:a}}}))}static getSampleTasks(e=20,t=null){return this._wrapWhamRequest(()=>i.safeGet("/share/codex/task_samples",{parameters:{query:{limit:e,cursor:t}}}))}static getRepository(e){return this._wrapWhamRequest(()=>i.safeGet("/wham/github/repositories/{repo_id}",{parameters:{path:{repo_id:e}}}))}static getUserPullRequests(e,{limit:t=20,state:a="open",includeDiff:n=!1,includeComments:r=!1}={}){return this._wrapWhamRequest(()=>i.safeGet("/wham/github/repositories/{repo_id}/pull-requests",{parameters:{path:{repo_id:e},query:{limit:t,state:a,include_diff:n,include_comments:r}}}))}static searchBranchesByRepository(e,t,a=10,n=null){return this._wrapWhamRequest(()=>i.safeGet("/wham/github/branches/{repo_id}/search",{parameters:{path:{repo_id:e},query:{query:t,page_size:a,cursor:n}}}))}static getEnvironmentWithCreatorAndMachine(e){return this._wrapWhamRequest(()=>i.safeGet("/wham/environments/{environment_id}/with-creator-and-machine",{parameters:{path:{environment_id:e}}}))}static getEnvironmentWithCreators(e=10,t=null,a=!1){return this._wrapWhamRequest(()=>i.safeGet("/wham/environments/with-creators",{parameters:{query:{limit:e,cursor:t,enforce_repo_access:a}}}))}static updateEnvironment(e,t){return this._wrapWhamRequest(()=>i.safePatch("/wham/environments/{environment_id}",{parameters:{path:{environment_id:e}},requestBody:t}))}static deleteEnvironment(e){return this._wrapWhamRequest(()=>i.safeDelete("/wham/environments/{environment_id}",{parameters:{path:{environment_id:e}}}))}static getEnvironments(){return this._wrapWhamRequest(()=>i.safeGet("/wham/environments",{}))}static getRecentEnvironments(){return this._wrapWhamRequest(()=>i.safeGet("/wham/environments/recent",{}))}static getMachines(){return this._wrapWhamRequest(()=>i.safeGet("/wham/machines",{}))}static createEnvironment(e){const t=e.envVars.reduce((n,r)=>(n[r.key]=r.value,n),{}),a=e.secrets.reduce((n,r)=>(n[r.key]=r.value,n),{});return this._wrapWhamRequest(()=>i.safePost("/wham/environments",{requestBody:{label:e.label,machine_id:e.machine,repos:[e.repositoryId],description:e.description,setup:e.setupCommands,maintenance_setup:e.maintenanceSetupCommands,workspace_dir:e.workspaceDirectory,agent_network_access:e.agentNetworkAccess,share_settings:e.share_settings,env_vars:t,secrets:a,auto_setup_settings:e.autoSetupSettings,cache_settings:e.cacheSettings}}))}static runEnvironmentTestCommand(e){return this._wrapWhamRequest(()=>i.safePost("/wham/environments/test/{test_session_id}/command",{parameters:{path:{test_session_id:e.testSessionId}},requestBody:{command:e.command}}))}static getUserPreferences(){return this._wrapWhamRequest(()=>i.safeGet("/wham/settings/user",{}))}static getUserPreferencesConfig(){return this._wrapWhamRequest(()=>i.safeGet("/wham/settings/configs/user-preferences",{}))}static getCodeReviewRepositories({page:e=1,perPage:t=100,search:a,nextToken:n}){return this._wrapWhamRequest(()=>i.safeGet("/wham/settings/code_review",{parameters:{query:{page:e,per_page:t,search:a,next_token:n}}}))}static updateCodeReviewRepositories(e){return this._wrapWhamRequest(()=>i.safePatch("/wham/settings/code_review",{requestBody:e}))}static updateUserPreferences(e){return this._wrapWhamRequest(()=>i.safePatch("/wham/settings/user",{requestBody:{branch_format:e.branchFormat,git_diff_mode:e.diffView,custom_instructions:e.customInstructions,code_review_preference:e.codeReviewPreference}}))}static getTurns(e){return this._wrapWhamRequest(()=>i.safeGet("/wham/tasks/{task_id}/turns",{parameters:{path:{task_id:e}}}))}static getTurnLogs(e,t){return this._wrapWhamRequest(()=>i.safeGet("/wham/tasks/{task_id}/turns/{task_turn_id}/logs",{parameters:{path:{task_id:e,task_turn_id:t}}}))}static async createNewTask(e,t,a,n=!1,r,o=[],u=[]){const _=[{type:"message",role:"user",content:[{content_type:"text",text:a}]},...o,...u],T=await C("codex_create_task_turn").catch(g=>{R.addError(g)}),q=E(null,null,null,T);return this._wrapWhamRequest(()=>i.safePost("/wham/tasks",{requestBody:{new_task:{environment_id:e,branch:t,run_environment_in_qa_mode:n},...r?{metadata:{best_of_n:r}}:{},input_items:_},additionalHeaders:q}))}static async createNewTaskWithEditedPrompt(e,t,a,n,r=!1){const o=await d.createNewTask(t,a,n,r);return d.archiveTask(e).catch(()=>{}),o}static createCodeReviewTask({installationId:e,repoId:t,prNumber:a}){return this._wrapWhamRequest(()=>i.safePost("/wham/github/installations/{installation_id}/repositories/{repo_id}/pull-request/{pr_number}/task",{parameters:{path:{installation_id:e,repo_id:t,pr_number:a}},requestBody:{action:"review"}}))}static async createFollowUpTask(e,t,a,n,r=!1,o=1,u=[]){const _=[{type:"message",role:"user",content:[{content_type:"text",text:a}]},...u];n.forEach(g=>{_.push({type:"comment",position:g.position,content:g.content})});const T=await C("codex_create_task_turn").catch(g=>{R.addError(g)}),q=E(null,null,null,T);return this._wrapWhamRequest(()=>i.safePost("/wham/tasks",{requestBody:{follow_up:{task_id:e,turn_id:t,run_environment_in_qa_mode:r},metadata:{best_of_n:o},input_items:_},additionalHeaders:q}))}static cancelTurnDeprecated(e,t){return this._wrapWhamRequest(()=>i.safePost("/wham/tasks/{task_id}/turns/{task_turn_id}/cancel",{parameters:{path:{task_id:e,task_turn_id:t}}}))}static cancelTask(e){return this._wrapWhamRequest(()=>i.safePost("/wham/tasks/{task_id}/cancel",{parameters:{path:{task_id:e}}}))}static markTurnAsRead(e){return this._wrapWhamRequest(()=>i.safePost("/wham/tasks/{task_id}/mark_read",{parameters:{path:{task_id:e}}}))}static markTurnViewed(e,t){return this._wrapWhamRequest(()=>i.safePost("/wham/tasks/{task_id}/turns/{task_turn_id}/viewed",{parameters:{path:{task_id:e,task_turn_id:t}}}))}static viewSpeculativeTurn(e,t){return this._wrapWhamRequest(()=>i.safePost("/wham/tasks/{task_id}/speculative_turns/{task_turn_id}/view",{parameters:{path:{task_id:e,task_turn_id:t}}}))}static discardTurn(e,t){return this._wrapWhamRequest(()=>i.safePost("/wham/tasks/{task_id}/turns/{task_turn_id}/discard",{parameters:{path:{task_id:e,task_turn_id:t}}}))}static undoDiscardedTurns(e,t){return this._wrapWhamRequest(()=>i.safePost("/wham/tasks/{task_id}/turns/{task_turn_id}/undo_all_discards_for_siblings",{parameters:{path:{task_id:e,task_turn_id:t}}}))}static copyGitApply(e,t,a){return this._wrapWhamRequest(()=>i.safePost("/wham/tasks/{task_id}/turns/{task_turn_id}/copy_git_apply",{parameters:{path:{task_id:e,task_turn_id:t}},requestBody:{includes_apply_command:a}}))}static forkSharedTask(e){return this._wrapWhamRequest(()=>i.safePost("/wham/tasks/{task_id}/fork",{parameters:{path:{task_id:e}}}))}static getRateLimit(){return i.safeGet("/wham/tasks/rate_limit")}static invalidateEnvironmentCache(e){return this._wrapWhamRequest(()=>i.safePost("/wham/environments/{environment_id}/reset-cache",{parameters:{path:{environment_id:e}}}))}}const We=(s,e,t)=>({staleTime:0,queryKey:["wham","task",s,e],enabled:!!s&&!!e,queryFn:()=>d.getTaskTurn(s??"",e??""),...t||{}}),ce=(s,e)=>({queryKey:["wham","task",s],staleTime:0,enabled:!!s,queryFn:async()=>await d.getTaskDetails(s??""),...e||{}}),Le=(s,e)=>{const t=ce(s,e);return m(t)},de=19;function D(s){return J({queryKey:["wham","tasks",s],queryFn:({pageParam:e})=>d.getTasksForList(de,e??null,s),initialPageParam:null,getNextPageParam:({cursor:e})=>e,staleTime:15*1e3})}function Ce({filter:s,enabled:e=!0,refetchOnMount:t=!1,refetchOnWindowFocus:a=!1}={}){const n=w(({tasksFilter:o})=>o);return v({...D(s??n),enabled:e,refetchOnMount:t,refetchOnWindowFocus:a})}function Ee(){return m({queryKey:["wham","tasks","has-any"],queryFn:async()=>((await d.getTasksForList(1,null,"all")).items?.length??0)>0})}function xe(){return v({...D("all"),select:s=>(s.pages[0]?.items?.length??0)>=5})}function Me({retry:s=0}={}){return m({queryKey:["wham","environments"],queryFn:()=>d.getEnvironments(),retry:s})}function Pe({retry:s=0}={}){return m({queryKey:["wham","recent_environments"],queryFn:()=>d.getRecentEnvironments(),retry:s})}function Ie({pageSize:s=20,retry:e=0,enforceRepoAccess:t=!1}={}){return v({queryKey:["wham","environments","with-creators"],initialPageParam:null,queryFn:({pageParam:a})=>d.getEnvironmentWithCreators(s,a,t),getNextPageParam:a=>a.cursor??null,retry:e})}function Ae(){return m({queryKey:["wham","githubLogin"],queryFn:()=>d.getUserHandle()})}function Ge(){return m({queryKey:["wham","githubInstallationsV2"],queryFn:()=>d.getGithubInstallationsV2(),staleTime:0,refetchOnWindowFocus:!0,refetchOnMount:!0})}function Se(s,{enabled:e=!0,state:t="open",limit:a=20}={}){return m({queryKey:["wham","pullRequests",s,t,a],enabled:e&&!!s,queryFn:()=>d.getUserPullRequests(s??"",{state:t,limit:a})})}function Fe(){return m({queryKey:["wham","tasks","samples"],queryFn:()=>d.getSampleTasks(10,null)})}function Be(s,e,t){s.setQueryData(["wham","environments"],a=>a?[e,...a]:[e]),s.setQueryData(["wham","environments","with-creators"],a=>{if(!a)return a;const n={...e,creator:t};return L(a,r=>{r.pages.length>0&&r.pages[0].items.unshift(n)})})}function De(s,e){s.setQueryData(["wham","environments"],t=>t?.filter(a=>a.id!==e)),s.setQueryData(["wham","environments","with-creators"],t=>t&&L(t,a=>{a.pages.forEach(n=>{n.items=n.items.filter(r=>r.id!==e)})}))}function Oe(s,e,t){s.setQueryData(["wham","environments"],a=>a?.map(n=>n.id===e?t:n)),s.setQueryData(["wham","environments","with-creators"],a=>a&&L(a,n=>{n.pages.forEach(r=>{r.items=r.items.map(o=>o.id===e?{...o,...t}:o)})})),s.setQueryData(["environments",e,"withCreatorAndMachine"],a=>a?{...a,...t}:void 0)}function je(s){return m({queryKey:["environments",s,"withCreatorAndMachine"],queryFn:()=>d.getEnvironmentWithCreatorAndMachine(s)})}function Ne(s){return m({queryKey:["wham","repository",s],enabled:!!s,queryFn:()=>d.getRepository(s??"")})}function Ke(){return m({queryKey:["wham","userPreferences"],queryFn:()=>d.getUserPreferences()})}function He(){return m({queryKey:["wham","githubInstallationEventsV2"],queryFn:()=>d.getGithubInstallationEventsV2(),staleTime:0,refetchOnWindowFocus:!0,refetchOnMount:!0})}function $e(s){return v({queryKey:["wham","codeReviewRepositories","v2",s],initialPageParam:void 0,queryFn:({pageParam:e})=>d.getCodeReviewRepositories({search:s||void 0,nextToken:e}),getNextPageParam:e=>e?.next_token??void 0,refetchOnWindowFocus:!0})}function Qe(){return m({queryKey:["wham","userPreferencesConfig"],queryFn:()=>d.getUserPreferencesConfig()})}function Ue(s){return s.invalidateQueries({queryKey:["wham","environments"]})}function ze(s,e){return s.invalidateQueries({queryKey:["environment",e]})}function Ve(s){return s.invalidateQueries({queryKey:["wham","userPreferences"]})}function Ze(s){const e=w(t=>t.addTurnToTaskMap);return m({queryKey:["wham","task",s,"turns"],queryFn:async()=>{const t=await d.getTurns(s??"");return Object.values(t.turn_mapping).forEach(a=>{e(s??"",a.turn)}),t},enabled:!!s,staleTime:15*1e3,refetchOnWindowFocus:!0,refetchOnMount:!0})}function Je(s,e){return m({queryKey:["wham","task",s,"turns",e,"logs"],queryFn:()=>d.getTurnLogs(s??"",e??""),enabled:!!s&&!!e})}function Xe(s,e,t){return m({queryKey:["wham","task",s,"turns",e,"completed_count"],enabled:t&&!!s&&!!e,queryFn:()=>d.getSiblingTurns(s??"",e??""),staleTime:0,refetchInterval:({state:a})=>a.data&&a.data?.sibling_turns?.every(o=>B(o.turn_status))?!1:5e3})}function me({refetchOnWindowFocus:s=!1,refetchInterval:e}={}){return m({queryKey:["wham","rateLimit"],queryFn:()=>d.getRateLimit(),staleTime:0,refetchOnWindowFocus:s,refetchInterval:e})}function le(s,e,t){const a=j(),n=s.map(r=>{const{keyboardBinding:o}=r;let u=o.join("+");if(r.altKeyboardBindings){u=[u];const f=r.altKeyboardBindings.map(_=>_.join("+"));u=u.concat(f)}return N(u,{byKey:!0})});K(()=>{if(t?.enabled===!1)return;const r=f=>{if(!f.repeat)for(let _=0;_<n.length;_++)n[_](f)&&(s[_].enabled===void 0||s[_].enabled)&&(f.preventDefault(),e(s[_]),s[_].action(f))},o=f=>{f.key!==void 0&&r(f)},u=a?.document??document;return u.addEventListener("keydown",o),()=>{u.removeEventListener("keydown",o)}},[s,t])}const W=G(s=>({actions:[],addActionsActions:e=>s(t=>({actions:z([...t.actions,...e],a=>a.key)})),removeActionsActions:e=>{const t=e.map(a=>a.key);return s(a=>({actions:a.actions.filter(n=>!t.includes(n.key))}))}})),he=s=>le(s,e=>{R.addAction("wham_keyboard_shortcut",{keyboardActionKey:e.key})},{enabled:!0});function Ye(){return W(s=>s.actions)}function et(s=[]){const e=W(a=>a.addActionsActions),t=W(a=>a.removeActionsActions);c.useEffect(()=>(e(s),()=>t(s)),[s,e,t]),he(s)}function tt(){const s=w(r=>r.getRateLimit()),e=w(r=>r.setRateLimit),t=w(r=>!!r._forcedRateLimit),a=s&&s.remaining<=5,{data:n}=me({refetchInterval:a?6e4:void 0,refetchOnWindowFocus:!0});return c.useEffect(()=>{n&&e(n)},[n,e]),!s||!a?null:p.jsx(pe,{remaining:s.remaining,resetsAfterText:s.resets_after_text,hasForcedRateLimit:t})}function pe({remaining:s,resetsAfterText:e,hasForcedRateLimit:t=!1}){const a=X(),n=H(),[r,o]=c.useState(!1);return p.jsx($,{open:n?r:void 0,onOpenChange:o,label:a.formatMessage({id:"BKAKLB",defaultMessage:"More available {resetsAfterText}"},{resetsAfterText:e}),children:p.jsxs("div",{className:y("inline-flex items-center gap-1.5 rounded-full px-3 py-2 text-sm font-medium",s===0?"bg-token-text-status-error/15 text-token-text-status-error":"bg-token-text-status-warning/15 text-token-text-status-warning"),onClick:n?()=>o(u=>!u):void 0,children:[p.jsx(Q,{className:"icon"}),n?s:p.jsx(b,{id:"e7gj6g",defaultMessage:"{remaining, plural, =0 {No tasks left} one {One task left} other {# tasks left}}",values:{remaining:s}}),!1]})})}const st=({children:s,sideOffset:e=6,isOpen:t,closePopover:a,popoverContentRef:n,...r})=>{const o=U();return c.useEffect(()=>{if(!t)return;const u=f=>{f.key==="Escape"&&a()};return document.addEventListener("keydown",u,{capture:!0,passive:!0}),()=>document.removeEventListener("keydown",u,{capture:!0})},[t,a]),p.jsx(V,{children:p.jsx(Z,{forceMount:!0,asChild:!0,align:"center",sideOffset:e,onOpenAutoFocus:u=>{u.preventDefault()},...r,style:{...r.style??{},zIndex:60},children:p.jsx("div",{ref:n,className:y(!t&&"pointer-events-none","z-20"),children:p.jsx(Y,{mode:"sync",children:t&&p.jsx(ee.div,{className:y("popover bg-token-main-surface-primary dark:bg-token-main-surface-primary shadow-long overflow-auto rounded-2xl bg-clip-padding"),variants:{open:{opacity:1,y:0,transition:o?x:{...M,duration:.1}},closed:{opacity:0,y:-4,transition:o?x:{...M,duration:.1}}},initial:"closed",animate:"open",exit:"closed",children:s})})})})})},at=s=>c.createElement("svg",{width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},c.createElement("path",{d:"M8 6.5L14 4.5L8 2.5L2 4.5L8 6.5Z",stroke:"currentColor",strokeWidth:1.3,strokeLinecap:"round",strokeLinejoin:"round"}),c.createElement("path",{d:"M2 11.5L8 13.5L14 11.5",stroke:"currentColor",strokeOpacity:.3,strokeWidth:1.3,strokeLinecap:"round",strokeLinejoin:"round"}),c.createElement("path",{d:"M2 9.16699L8 11.167L14 9.16699",stroke:"currentColor",strokeOpacity:.3,strokeWidth:1.3,strokeLinecap:"round",strokeLinejoin:"round"}),c.createElement("path",{d:"M2 6.83301L8 8.83301L14 6.83301",stroke:"currentColor",strokeOpacity:.3,strokeWidth:1.3,strokeLinecap:"round",strokeLinejoin:"round"})),rt=s=>c.createElement("svg",{width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},c.createElement("path",{d:"M8 6.5L14 4.5L8 2.5L2 4.5L8 6.5Z",stroke:"currentColor",strokeWidth:1.3,strokeLinecap:"round",strokeLinejoin:"round"}),c.createElement("path",{d:"M2 6.83301L8 8.83301L14 6.83301",stroke:"currentColor",strokeWidth:1.3,strokeLinecap:"round",strokeLinejoin:"round"}),c.createElement("path",{d:"M2 9.16699L8 11.167L14 9.16699",stroke:"currentColor",strokeOpacity:.3,strokeWidth:1.3,strokeLinecap:"round",strokeLinejoin:"round"}),c.createElement("path",{d:"M2 11.5L8 13.5L14 11.5",stroke:"currentColor",strokeOpacity:.3,strokeWidth:1.3,strokeLinecap:"round",strokeLinejoin:"round"})),nt=s=>c.createElement("svg",{width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},c.createElement("path",{d:"M8 6.5L14 4.5L8 2.5L2 4.5L8 6.5Z",stroke:"currentColor",strokeWidth:1.3,strokeLinecap:"round",strokeLinejoin:"round"}),c.createElement("path",{d:"M2 6.83301L8 8.83301L14 6.83301",stroke:"currentColor",strokeWidth:1.3,strokeLinecap:"round",strokeLinejoin:"round"}),c.createElement("path",{d:"M2 9.16699L8 11.167L14 9.16699",stroke:"currentColor",strokeWidth:1.3,strokeLinecap:"round",strokeLinejoin:"round"}),c.createElement("path",{d:"M2 11.5L8 13.5L14 11.5",stroke:"currentColor",strokeOpacity:.3,strokeWidth:1.3,strokeLinecap:"round",strokeLinejoin:"round"})),it=s=>c.createElement("svg",{width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},c.createElement("path",{d:"M8 6.5L14 4.5L8 2.5L2 4.5L8 6.5Z",stroke:"currentColor",strokeWidth:1.3,strokeLinecap:"round",strokeLinejoin:"round"}),c.createElement("path",{d:"M2 6.83301L8 8.83301L14 6.83301",stroke:"currentColor",strokeWidth:1.3,strokeLinecap:"round",strokeLinejoin:"round"}),c.createElement("path",{d:"M2 9.16699L8 11.167L14 9.16699",stroke:"currentColor",strokeWidth:1.3,strokeLinecap:"round",strokeLinejoin:"round"}),c.createElement("path",{d:"M2 11.5L8 13.5L14 11.5",stroke:"currentColor",strokeWidth:1.3,strokeLinecap:"round",strokeLinejoin:"round"}));function ot({className:s,linesAdded:e,linesRemoved:t}){return!e&&!t?null:p.jsxs("div",{className:y("flex flex-row gap-1 font-medium",s),children:[p.jsx("span",{className:"text-green-500",children:p.jsx(b,{id:"wham.message.modal.repoAndDiffStats.linesAdded",defaultMessage:"+{linesAdded}",values:{linesAdded:e}})}),p.jsx("span",{className:"text-red-500",children:p.jsx(b,{id:"wham.message.modal.repoAndDiffStats.linesRemoved",defaultMessage:"-{linesRemoved}",values:{linesRemoved:t}})})]})}export{$e as A,tt as B,st as C,Ee as D,Ye as E,nt as F,rt as G,at as H,Xe as I,Re as J,Fe as K,Ne as L,Se as M,D as N,xe as O,Pe as P,ye as Q,F as R,it as S,ne as T,Je as U,qe as V,d as W,ve as X,ze as a,Ve as b,je as c,Oe as d,We as e,oe as f,we as g,w as h,Ue as i,Ce as j,ot as k,B as l,Ge as m,Ae as n,Me as o,Be as p,Ie as q,De as r,Le as s,Ze as t,Ke as u,Te as v,be as w,et as x,Qe as y,He as z};
//# sourceMappingURL=g7o69yifmkuxfsll.js.map
