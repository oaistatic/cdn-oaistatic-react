import{r as E,j as e,M as d,d as Te,L as _e,f as te,h as Jt,u as Ze,a as Zt}from"./m60bpb0x3x7rg8fj.js";import{P as b,Z as Re,A as f,f as U,B as Ne,dp as Xt,z as H,rh as yt,C as Ue,gd as ea,am as lt,cf as ta,sc as xe,g1 as Pt,g2 as Mt,g3 as St,g4 as _t,g5 as Xe,g6 as Ct,g7 as et,g8 as xt,g9 as bt,b2 as wt,aZ as aa,l as Dt,kw as Ae,a5 as ct,mc as sa,W as ut,M as dt,S as jt,c2 as ye,rn as na,ro as oa,eD as ra,e as vt,i as ia,kh as re,sd as la,kJ as Fe,se as ca,rf as ua,rg as da,rl as ma,cs as Ge,ri as Et,e7 as Ie,sf as pa,R as ga,b0 as kt,H as fa,ki as ha,bb as ya,iA as Pa,aA as Ma,sg as Sa}from"./lgw4q0e8zlqqfgug.js";import{af as _a,mc as tt,pk as V,e9 as ze,e7 as Ve,e5 as We,e3 as qe,e1 as $e,mf as mt,pl as Ca,mm as xa,pm as ba,pn as It,bt as at,po as I,d$ as wa,ag as Da,pp as ja,pq as Ce,pr as he,mb as pt,mi as va,cy as Ea,cA as ka,et as Ia,eu as Na,ev as Fa,eE as K,eF as oe,me as He,el as Ta}from"./ggjzadbnd3k1vu0k.js";import{u as Nt}from"./ha73j9iy5pkvdx6y.js";import{u as Ra}from"./fnje4v6gzdtvboh3.js";import{u as Ua}from"./jozqsyj8lvw2y89i.js";import{i as Aa,C as La}from"./oo5ncbfpx577zaun.js";const Ft=()=>{b.logEvent("Account Portal: Click Get Help")};function Oa(t){if(Xt(t))return"secondary";switch(t){case f.FREE:return"green";case f.GO:return"green";case f.PLUS:return"green";case f.SELF_SERVE_BUSINESS:return"primary";case f.PRO:return"primary";case f.QUORUM:return"primary"}}function Qe({isCurrentPlan:t=!1,planType:s,disabled:a,loading:o=!1,onClick:n,children:i,testId:c,activeColor:m,...p}){return e.jsx(Ne,{fullWidth:!0,size:"large",color:t?"secondary":m||Oa(s),disabled:a,loading:o,onClick:n,"data-testid":c,className:a?"bg-token-sidebar-surface-tertiary text-token-text-primary hover:bg-token-sidebar-surface-tertiary dark:bg-token-text-tertiary border-none font-semibold":"font-semibold",...p,children:i})}function Tt(t,s){const[a,o]=E.useState(!1);E.useEffect(()=>{if(!a){o(!0);return}t?b.logEventWithStatsig("Email Verify Popup Shown","chatgpt_email_verify_popup_shown",s):b.logEventWithStatsig("Email Verify Popup Hidden","chatgpt_email_verify_popup_hidden",s)},[t])}function Rt({ctx:t,shouldLogExposure:s}){return Re(t,"2273762597",{disableExposureLog:!s})}function Ya({ctx:t,shouldLogExposure:s}){return Rt({ctx:t,shouldLogExposure:s}).get("web_plus_intro_offer_coupon","none")}function Ba({ctx:t,shouldLogExposure:s}){return Rt({ctx:t,shouldLogExposure:s}).get("is_plus_intro_offer_enabled",!1)}function Ga({ctx:t,planType:s}){const o=Re(t,"978971143").get("cta_type","default");if(s===f.PLUS)switch(o){case"long_ctas":return U.longCtaPlus;case"upgrade_to_x":return U.upgradeToPlus;case"join_x":return U.joinPlus;case"unlock_x":return U.unlockPlus;default:return U.getPlus}else switch(o){case"long_ctas":return U.longCtaPro;case"upgrade_to_x":return U.upgradeToPro;case"join_x":return U.joinPro;case"unlock_x":return U.unlockPro;default:return U.getPro}}const fs=({billingDetails:t,isWebRedesign:s,shouldUseComparisonSpacing:a,shouldUseOnboardingFeatures:o,className:n,cta:i})=>{const c=_a({isWebRedesign:s,shouldUseOnboardingFeatures:o});return e.jsx(tt,{className:n,planType:f.FREE,pricingPlan:c,shouldUseComparisonSpacing:a,callToActionButton:i??e.jsx(Ne,{color:"secondary",disabled:!0,size:"large",className:H(s?"btn-secondary disabled:bg-token-bg-primary w-[100%]":"bg-token-sidebar-surface-tertiary text-token-text-primary hover:bg-token-sidebar-surface-tertiary dark:bg-token-text-tertiary dark:text-token-text-primary dark:hover:bg-token-text-tertiary w-[100%] border-none font-semibold"),children:e.jsx(d,{...c.callToAction.inactive})}),additionalLinks:[e.jsx(d,{...Ha.haveExistingPlan,values:{link:m=>e.jsx(_e,{target:"_blank",to:yt,onClick:Ft,className:H("underline",s&&"font-medium"),children:m},"row-plus-plan-help-link")}},"existing-plan-help")],billingDetails:t,isWebRedesign:s})},Ha=Te({haveExistingPlan:{id:"FreeColumn.haveExistingPlan",defaultMessage:"Have an existing plan? <link>See billing help</link>"}});function za({isOpen:t,onClose:s,onContinue:a,analyticsParams:o}){E.useEffect(()=>{t&&b.logEventWithStatsig("Mobile Subscription Warning Modal Shown","chatgpt_mobile_subscription_warning_modal_shown",o)},[o,t]);const n=()=>{b.logEventWithStatsig("Mobile Subscription Warning Modal Continue Clicked","chatgpt_mobile_subscription_warning_modal_continue_clicked",o),a()},i=()=>{b.logEventWithStatsig("Mobile Subscription Warning Modal Close Clicked","chatgpt_mobile_subscription_warning_modal_close_clicked",o),s()};return e.jsx(Ue,{testId:"modal-mobile-subscription-warning",isOpen:t,onClose:i,type:"warning",icon:ea,title:e.jsx(d,{...ke.checkSubscriptionHeader}),primaryButton:e.jsx(lt.Button,{title:ke.dismissModal.defaultMessage,color:"primary",onClick:i}),secondaryButton:e.jsx(lt.Button,{title:ke.continueToNextStep.defaultMessage,color:"secondary",onClick:n}),children:e.jsx("span",{className:"gap-2 text-gray-600",children:ke.checkSubscriptionBody.defaultMessage})})}const ke=Te({checkSubscriptionHeader:{id:"mobileSubscriptionWarningModal.checkSubscriptionHeader",defaultMessage:"Check your App Store subscription"},checkSubscriptionBody:{id:"mobileSubscriptionWarningModal.checkSubscriptionBody",defaultMessage:"Your subscription through the Apple App Store is currently on pause due to a payment issue. Please resolve that issue to resume using ChatGPT Plus and avoid duplicate charges."},dismissModal:{id:"mobileSubscriptionWarningModal.dismissModal",defaultMessage:"Cancel"},continueToNextStep:{id:"mobileSubscriptionWarningModal.continueToNextStep",defaultMessage:"I understand, continue anyways"}}),Ut=ta(t=>({recentlyDowngraded:!1,recentlyUpgraded:!1,recentlyCanceled:!1,setRecentlyDowngraded:s=>t({recentlyDowngraded:s}),setRecentlyUpgraded:s=>t({recentlyUpgraded:s}),setRecentlyCanceled:s=>t({recentlyCanceled:s})}));function Ke(t,s,a,o){let n,i;o===Pt?(n=ze,i=Mt):o===St?(n=Ve,i=_t):o===Xe?(n=We,i=Ct):o===et?(n=qe,i=xt):(n=$e,i=bt);const c=n*s;let m;if("percentage"in a)m=c*(1-a.percentage/100);else if("value"in a)m=c-a.value;else throw new Error("Invalid discount type");return{formattedDiscountedCost:t.formatNumber(m,{style:"currency",currency:o,minimumFractionDigits:0,maximumFractionDigits:2}),currencySymbol:i}}function At(t,s,a,o){const n={...s};let i;if(o&&(o.period==="year"?o.num_periods===1?i=t.formatMessage({id:"pricingPlanConstants.promoCostSubtitleForSingleYear",defaultMessage:"for the first year"}):i=t.formatMessage({id:"pricingPlanConstants.promoCostSubtitleForPluralYears",defaultMessage:"for the first {num_years} years"},{num_years:o.num_periods}):o.num_periods===1?i=t.formatMessage({id:"pricingPlanConstants.promoCostSubtitleForSingleMonth",defaultMessage:"for the first month"}):i=t.formatMessage({id:"pricingPlanConstants.promoCostSubtitleForPluralMonths",defaultMessage:"for the first {num_months} months"},{num_months:o.num_periods})),n.costDuration={id:"promoCostDuration",defaultMessage:i,description:"Cost duration for promo plan"},"percentage"in a||"discount_type"in a&&a.discount_type===xe.PERCENTAGE){const c=("percentage"in a?a.percentage:a.amount)/100;n.costInDollars={id:"discountedCost",defaultMessage:V((1-c)*$e).toString()},n.costInEuros={id:"discountedCostEuros",defaultMessage:V((1-c)*ze).toString()},n.costInPounds={id:"discountedCostPounds",defaultMessage:V((1-c)*Ve).toString()},n.costInINR={id:"discountedCostInr",defaultMessage:V((1-c)*We).toString()},n.costInIDR={id:"discountedCostIDR",defaultMessage:V((1-c)*qe).toString()}}else if("value"in a||a.discount_type===xe.FIXED){const c="value"in a?a.value:a.amount;n.costInDollars={id:"discountedCost",defaultMessage:V($e-c).toString()},n.costInEuros={id:"discountedCostEuros",defaultMessage:V(ze-c).toString()},n.costInPounds={id:"discountedCostPounds",defaultMessage:V(Ve-c).toString()},n.costInINR={id:"discountedCostInr",defaultMessage:V(We-c).toString()},n.costInIDR={id:"discountedCostIDR",defaultMessage:V(qe-c).toString()}}return n}function Lt(t){switch(t){case f.FREE:return"chatgptfreeplan";case f.GO:return"chatgptgoplan";case f.PLUS:return"chatgptplusplan";case f.PRO:return"chatgptpro";case f.SELF_SERVE_BUSINESS:return"chatgptteamplan";default:throw new Error(`Invalid plan type: ${t}`)}}function ee(t){return at(t.toLowerCase())}function Va({isOpen:t,onClose:s,accountId:a,initialPlanType:o,updatedPlanType:n,billingDetails:i,promoMetadata:c,promoCode:m,fullPriceResumeDateString:p,onPromoClose:h}){const u=te(),l=wt(),r=aa(),[g,M]=E.useState(!1),y=c?.plan_type_change==="equal",D=o===n&&!y,F=mt(o)<mt(n),A=Lt(n);E.useEffect(()=>{b.logTogglePlanManagementModal({isOpen:!0})},[]);const C=()=>{b.logTogglePlanManagementModal({isOpen:!1}),s()},Y=Ca(a),j=xa(a),ae=ba(a),{data:L,isError:W,isLoading:_}=It(a,void 0,A,void 0,y);!D&&W&&(r?.planType===f.SELF_SERVE_BUSINESS?l.warning(u.formatMessage({id:"planManagement.errorUpgradingTeam",defaultMessage:"Updates to {capitalizedUpdatedPlanType} aren't yet supported for users with Team subscriptions"},{capitalizedUpdatedPlanType:ee(n)}),{hasCloseButton:!0}):l.warning(u.formatMessage({id:"planManagement.errorFetchingPreview",defaultMessage:"There was a problem updating your subscription"}),{hasCloseButton:!0}),s());const w=q=>{const $=Ae(new Date,q);return new Intl.DateTimeFormat(u.locale,{year:"numeric",month:"short",day:"numeric"}).format($)},P=r?.getDaysUntilPlanRenews();let x=P?w(P):"";const v=r?.getDaysUntilSubscriptionCancelAt();P&&v&&v>P&&(x=w(v));const{recentlyCanceled:J,setRecentlyUpgraded:T,setRecentlyDowngraded:ie}=Ut(),Z=r?.willRenewSubscription()||J,[B,X]=E.useState(!1),le=Jt();if(!r)return null;const Pe=L?.renewal_date,ce=Pe?new Date(Pe).toLocaleDateString(u.locale,{year:"numeric",month:"long",day:"numeric"}):u.formatMessage(U.notApplicable),ue=p?new Date(p).toLocaleDateString(u.locale,{year:"numeric",month:"long",day:"numeric"}):u.formatMessage(U.notApplicable),{goCost:be,plusCost:we,proCost:de,currencySymbol:me}=es(i.currency),z=c?.duration?.num_periods??1,{formattedDiscountedCost:se}=c?.discount?Ke(u,z,c.discount,me.code.defaultMessage?.toString()):{formattedDiscountedCost:null},ne=async q=>{M(!0);try{if(D)await j.mutateAsync(a),l.success(x===""?u.formatMessage({id:"planManagement.successfullyRenewedSubscription2",defaultMessage:"Your subscription has been renewed."}):u.formatMessage({id:"planManagement.successfullyRenewedSubscription",defaultMessage:"Your subscription has been renewed. Your subscription will auto-renew on {renewalDate}."},{renewalDate:x}),{hasCloseButton:!0}),b.logEvent("Renew Plan Success",{planType:q}),ct.logEvent("chatgpt_renew_plan_success",null,{planType:q});else if(y&&m)await Y.mutateAsync({accountId:a,updatedPlan:void 0,updatedPriceInterval:void 0,updatedSeats:void 0,updatedPromoCode:m}),l.success(x===""?u.formatMessage({id:"planManagement.successfullyRenewedSubscriptionPromotion",defaultMessage:"Your subscription has been updated and will auto-renew at the promotional rate of {promotionalCost} during your next billing cycle."},{promotionalCost:se}):u.formatMessage({id:"planManagement.successfullyRenewedSubscriptionPromotion2",defaultMessage:"Your subscription has been updated and will auto-renew at your promotional rate of {promotionalCost} on {renewalDate}."},{renewalDate:x,promotionalCost:se}),{hasCloseButton:!0});else{Z||(await j.mutateAsync(a),X(!0));const pe=m?void 0:A;await Y.mutateAsync({accountId:a,updatedPlan:pe,updatedPriceInterval:void 0,updatedSeats:void 0,updatedPromoCode:m??void 0});const ge=F?u.formatMessage({id:"planManagement.successfullyUpdatedSubscription",defaultMessage:"You're now subscribed to ChatGPT {capitalizedUpdatedPlanType}"},{capitalizedUpdatedPlanType:ee(n)}):u.formatMessage({id:"planManagement.updatedSubscriptionToPlus",defaultMessage:"Your subscription has been updated. Your subscription will change to {capitalizedUpdatedPlanType} on {renewalDateFormatted}."},{renewalDateFormatted:ce,capitalizedUpdatedPlanType:ee(n)});if(q!==n){const Le=F?"Upgrade Plan Success":"Downgrade Plan Success",Oe=F?"chatgpt_upgrade_plan_success":"chatgpt_downgrade_plan_success";b.logEvent(Le,{fromPlan:q,toPlan:n}),ct.logEvent(Oe,null,{fromPlan:q,toPlan:n}),F?T(!0):ie(!0),l.success(ge,{hasCloseButton:!0})}localStorage.setItem(`subscriptionUpdateMessage_${r.id}`,ge)}le.invalidateQueries(sa());const $=ut.getItem(dt.CheckoutFrom);Aa($)&&(ut.removeItem(dt.CheckoutFrom),window.location.href=La[$]),s()}catch($){$?.detail?.error_type==="card_declined"?l.warning(u.formatMessage({id:"planManagement.cardDeclinedError",defaultMessage:"Payment error. Your card may be invalid or authentication may be needed."}),{hasCloseButton:!0}):l.warning(u.formatMessage({id:"planManagement.errorUpdatingSubscription",defaultMessage:"There was a problem updating your subscription"}),{hasCloseButton:!0}),B&&await ae.mutateAsync(a),s()}finally{M(!1),m&&h?.()}};let k=we;return n===f.GO?k=be:n===f.PRO?k=de:n!==f.PLUS&&Dt.error(`Invalid target plan type: ${n}`),e.jsx(Ue,{testId:"modal-plan-management",type:"success",isOpen:t,onClose:C,size:"custom",noPadding:!0,className:"max-w-xl",showCloseButton:!0,title:u.formatMessage({id:"planManagementModal.title",defaultMessage:"Confirm changes"}),removePopoverStyling:!0,children:_?e.jsx(Ot,{}):y||D&&r?e.jsx(Xa,{account:r,renewalDate:x,handleUpdate:()=>ne(o),isUpdating:g,onClose:C,targetPlanCost:k,currencySymbol:me,promoMetadata:c,fullPriceResumeDateFormatted:ue,formattedDiscountedCost:se}):W||!L?null:F?e.jsx(qa,{accountId:a,handleUpdate:()=>ne(o),isUpdating:g,onClose:C,initialPlanType:o,updatedPlanType:n,currencySymbol:me}):e.jsx(Za,{renewalDate:L.renewal_date,handleUpdate:()=>ne(o),isUpdating:g,onClose:C,targetPlanCost:k,currentPlanType:o,updatedPlanType:n,currencySymbol:me,promoMetadata:c,fullPriceResumeDateFormatted:ue,formattedDiscountedCost:se})})}function Ot(){return e.jsx("div",{className:"flex items-center justify-center p-6",children:e.jsx(jt,{})})}function Wa({adjustmentMessage:t,proratedCreditMessage:s,proratedCreditInfoMessage:a}){return e.jsxs("div",{children:[e.jsxs("div",{className:"mt-4 flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:t}),e.jsx("span",{className:"font-semibold text-green-600",children:s})]}),e.jsx("span",{className:"text-token-text-secondary text-sm",children:a})]})}function qa({accountId:t,handleUpdate:s,isUpdating:a,onClose:o,currencySymbol:n,updatedPlanType:i,initialPlanType:c}){const m=te(),{data:p,isError:h,isLoading:u}=It(t,void 0,Lt(i));if(u)return e.jsx(Ot,{});if(h||!p)return null;const l=$a({data:p,intl:m,currencySymbol:n,currentPlanType:c});return e.jsxs("div",{className:"p-6",children:[e.jsx(Qa,{data:p,currencySymbol:n,updatedPlanType:i}),l.filter(r=>r.value!==0).map((r,g)=>e.jsx(Wa,{adjustmentMessage:r.adjustmentMessage,proratedCreditMessage:r.proratedCreditMessage,proratedCreditInfoMessage:r.proratedCreditInfoMessage},g)),e.jsx("hr",{className:"mt-4 mb-4"}),e.jsx(Ka,{data:p,currencySymbol:n}),p.default_payment_method&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"mt-4 mb-4"}),e.jsx(Ja,{defaultPaymentMethod:p.default_payment_method})]}),e.jsxs("div",{className:"mt-8 flex justify-end gap-2",children:[e.jsx(ye,{title:m.formatMessage({id:"planUpgradeModal.cancel",defaultMessage:"Cancel"}),color:"secondary",onClick:o}),e.jsx(ye,{title:m.formatMessage({id:"planUpgradeModal.payNow",defaultMessage:"Pay now"}),color:"primary",onClick:s,loading:a})]})]})}function $a({data:t,intl:s,currencySymbol:a,currentPlanType:o}){return[{adjustmentMessage:e.jsx(d,{id:"planUpgradeModal.adjustment",defaultMessage:"Adjustment"}),proratedCreditMessage:e.jsx(d,{id:"planUpgradeModal.proratedCredit",defaultMessage:"-{currencySign}{adjustment}",values:{currencySign:s.formatMessage(a.sign),adjustment:(-t.negative_line_item_total/100).toFixed(2)}}),proratedCreditInfoMessage:e.jsx(d,{id:"planUpgradeModal.proratedCreditInfo",defaultMessage:"Prorated credit for the remainder of your {currentPlanType} subscription",values:{currentPlanType:o}}),value:t.negative_line_item_total},{adjustmentMessage:e.jsx(d,{id:"planUpgradeModal.discount",defaultMessage:"Adjustment"}),proratedCreditMessage:e.jsx(d,{id:"planUpgradeModal.discountAmount",defaultMessage:"-{currencySign}{discount}",values:{currencySign:s.formatMessage(a.sign),discount:(t.discount_amount/100).toFixed(2)}}),proratedCreditInfoMessage:e.jsx(d,{id:"planUpgradeModal.discountInfo",defaultMessage:"Account discount applied"}),value:t.discount_amount},{adjustmentMessage:e.jsx(d,{id:"planUpgradeModal.credits",defaultMessage:"Adjustments"}),proratedCreditMessage:e.jsx(d,{id:"planUpgradeModal.creditsAmount",defaultMessage:"-{currencySign}{credits}",values:{currencySign:s.formatMessage(a.sign),credits:(t.applied_balance/100).toFixed(2)}}),proratedCreditInfoMessage:e.jsx(d,{id:"planUpgradeModal.creditsInfo",defaultMessage:"Credits applied"}),value:t.applied_balance}]}function Qa({data:t,currencySymbol:s,updatedPlanType:a}){const o=te();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:e.jsx(d,{id:"planUpgradeModal.subscription",defaultMessage:"ChatGPT {capitalizedUpdatedPlanType} subscription",values:{capitalizedUpdatedPlanType:ee(a)}})}),e.jsx("span",{className:"font-semibold",children:e.jsx(d,{id:"planUpgradeModal.subscriptionCost",defaultMessage:"{currencySign}{totalCost}",values:{currencySign:o.formatMessage(s.sign),totalCost:(t.positive_line_item_total/100).toFixed(2)}})})]}),e.jsx("span",{className:"text-token-text-secondary text-sm",children:e.jsx(d,{id:"planUpgradeModal.billingCycle",defaultMessage:"Billed monthly, starting today"})})]})}function Ka({data:t,currencySymbol:s}){const a=te();return e.jsxs(e.Fragment,{children:[t.amount_due.tax_amount>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-4 flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:e.jsx(d,{id:"planUpgradeModal.subTotal",defaultMessage:"Subtotal"})}),e.jsx("span",{children:e.jsx(d,{id:"planUpgradeModal.subtotalPrice",defaultMessage:"{currencySign}{totalCost}",values:{currencySign:a.formatMessage(s.sign),totalCost:(t.amount_due.amount_excluding_tax/100).toFixed(2)}})})]}),e.jsxs("div",{className:"mt-2 flex justify-between",children:[e.jsxs("span",{className:"font-semibold",children:[e.jsx(d,{id:"planUpgradeModal.tax",defaultMessage:"Tax"}),e.jsx("span",{className:"text-token-text-secondary font-normal",children:e.jsx(d,{id:"planUpgradeModal.taxPercent",defaultMessage:" {taxPercent}%",values:{taxPercent:(t.amount_due.tax_amount/t.amount_due.amount_excluding_tax*100).toFixed(0)}})})]}),e.jsx("span",{children:e.jsx(d,{id:"planUpgradeModal.taxAmount",defaultMessage:"{currencySign}{tax}",values:{currencySign:a.formatMessage(s.sign),tax:(t.amount_due.tax_amount/100).toFixed(2)}})})]})]}),e.jsxs("div",{className:"mt-2 flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:e.jsx(d,{id:"planUpgradeModal.totalDueToday",defaultMessage:"Total due today"})}),e.jsx("span",{className:"font-semibold",children:e.jsx(d,{id:"planUpgradeModal.totalDueTodayAmount",defaultMessage:"{currencySign}{totalCost}",values:{currencySign:a.formatMessage(s.sign),totalCost:(t.amount_due.amount/100).toFixed(2)}})})]})]})}function Ja({defaultPaymentMethod:t}){return e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:e.jsx(d,{id:"planUpgradeModal.paymentMethod",defaultMessage:"Payment Method"})}),e.jsxs("span",{className:"text-token-text-secondary",children:[t.card_brand?.toUpperCase()," *",t.card_last4]})]})}function Za({renewalDate:t,handleUpdate:s,isUpdating:a,onClose:o,targetPlanCost:n,currentPlanType:i,currencySymbol:c,updatedPlanType:m,promoMetadata:p,fullPriceResumeDateFormatted:h,formattedDiscountedCost:u}){const l=te(),r=p?.plan_type_change==="downgrade",g=p?.duration?.period??"month",M=t?new Date(t).toLocaleDateString(l.locale,{year:"numeric",month:"long",day:"numeric"}):l.formatMessage(U.notApplicable);return e.jsxs("div",{className:"p-6",children:[e.jsx("p",{className:"text-token-text-secondary",children:e.jsx(d,{id:"planDowngradeModal.currentSubscription",defaultMessage:"Your current {currentPlanType} subscription will remain active until {renewalDateFormatted}, when it will change to {nextPlanType}.",values:{renewalDateFormatted:M,currentPlanType:ee(i),nextPlanType:ee(m)}})}),e.jsxs("div",{className:"bg-token-main-surface-secondary mt-4 flex flex-col gap-1 rounded-md border-[1px] p-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:r?"text-token-text-primary text-[15px]":"font-semibold",children:e.jsx(d,{id:"planDowngradeModal.newPlan",defaultMessage:"ChatGPT {capitalizedUpdatedPlanType}",values:{capitalizedUpdatedPlanType:ee(m)}})}),r?e.jsx("span",{className:"text-token-text-primary text-[15px]",children:e.jsx(d,{id:"planDowngradeModal.newPlanCostOfPromo",defaultMessage:"{promotionalCost} w/ promo",values:{promotionalCost:u}})}):e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(d,{id:"planDowngradeModal.newPlanCost",defaultMessage:"{currencyCode} {currencySign}{planCost}/month",values:{currencyCode:l.formatMessage(c.code),currencySign:l.formatMessage(c.sign),planCost:l.formatMessage(n)}})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:H("text-token-text-secondary",r&&"text-token-text-secondary text-xs"),children:r?Je({fullPriceResumeDateFormatted:h,period:g,type:"billingStartAfterPromo"}):e.jsx(d,{id:"planDowngradeModal.billingStart",defaultMessage:"Billing will start on {renewalDateFormatted}",values:{renewalDateFormatted:M}})}),r&&e.jsx("span",{className:"text-token-text-secondary text-xs",children:e.jsx(d,{id:"planDowngradeModal.newPlanCostAfterPromo",defaultMessage:"{currencySign}{planCost}/month after",values:{currencySign:l.formatMessage(c.sign),planCost:l.formatMessage(n)}})})]})]}),e.jsxs("div",{className:"mt-8 flex justify-end gap-2",children:[e.jsx(ye,{title:l.formatMessage({id:"planDowngradeModal.cancel",defaultMessage:"Cancel"}),color:"secondary",onClick:o}),e.jsx(ye,{title:l.formatMessage({id:"planDowngradeModal.confirm",defaultMessage:"Confirm"}),color:"primary",onClick:s,loading:a})]})]})}function Xa({account:t,renewalDate:s,handleUpdate:a,isUpdating:o,onClose:n,targetPlanCost:i,currencySymbol:c,promoMetadata:m,fullPriceResumeDateFormatted:p,formattedDiscountedCost:h}){const u=te(),l=t.data.subscriptionStatus.planType,r=ee(l),g=m?.plan_type_change==="equal",M=m?.duration?.period??"month";return e.jsxs("div",{className:H("p-6",g&&"px-4 pt-[6px]"),children:[e.jsx("p",{className:"text-token-text-secondary",children:g?Je({fullPriceResumeDateFormatted:p,period:M,type:"currentSubscriptionPromo",planName:r,currencySign:u.formatMessage(c.sign),planCost:u.formatMessage(i)}):e.jsx(d,{id:"planRenewalModal.currentSubscription",defaultMessage:"Your current {planName} subscription will auto-renew on {renewalDate}.",values:{planName:r,renewalDate:s}})}),e.jsxs("div",{className:"bg-token-main-surface-secondary mt-4 flex flex-col gap-1 rounded-md border-[1px] p-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:g?"text-token-text-primary text-[15px]":"font-semibold",children:e.jsx(d,{id:"planRenewalModal.newPlan",defaultMessage:"ChatGPT {planName}",values:{planName:r}})}),g?e.jsx("span",{className:"text-token-text-primary text-[15px]",children:e.jsx(d,{id:"planRenewalModal.newPlanCostAfterPromo",defaultMessage:"{promotionalCost} w/ promo",values:{promotionalCost:h}})}):e.jsx("span",{className:"text-token-text-secondary",children:e.jsx(d,{id:"planRenewalModal.newPlanCost",defaultMessage:"{currencyCode} {currencySign}{planCost}/month",values:{currencyCode:u.formatMessage(c.code),currencySign:u.formatMessage(c.sign),planCost:u.formatMessage(i)}})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:H("text-token-text-secondary",g&&"text-token-text-secondary text-xs"),children:g?e.jsx(d,{id:"planRenewalModal.billingStartAfterPromo",defaultMessage:"Billing will start on {fullPriceResumeDateFormatted}",values:{fullPriceResumeDateFormatted:p}}):e.jsx(d,{id:"planRenewalModal.billingStart",defaultMessage:"Billing will auto-renew on {renewalDate}",values:{renewalDate:s}})}),g&&e.jsx("span",{className:"text-token-text-secondary text-xs",children:Je({period:M,type:"newPlanCostAfterPromo",currencySign:u.formatMessage(c.sign),planCost:u.formatMessage(i)})})]})]}),e.jsxs("div",{className:"mt-8 flex justify-end gap-2",children:[e.jsx(ye,{title:u.formatMessage({id:"planRenewalModal.cancel",defaultMessage:"Cancel"}),color:"secondary",onClick:n}),e.jsx(ye,{title:u.formatMessage({id:"planRenewalModal.confirm",defaultMessage:"Confirm"}),color:"primary",onClick:a,loading:o})]})]})}function es(t){return t===Pt?{goCost:I.go.goCostInEuros,plusCost:I.plus.plusCostInEuros,proCost:I.pro.proCostInEuros,currencySymbol:Mt}:t===St?{goCost:I.go.goCostInPounds,plusCost:I.plus.plusCostInPounds,proCost:I.pro.proCostInPounds,currencySymbol:_t}:t===Xe?{goCost:I.go.goCostInINR,plusCost:I.plus.plusCostInINR,proCost:I.pro.proCostInINR,currencySymbol:Ct}:t===et?{goCost:I.go.goCostInIDR,plusCost:I.plus.plusCostInIDR,proCost:I.pro.proCostInIDR,currencySymbol:xt}:{goCost:I.go.goCost,plusCost:I.plus.plusCost,proCost:I.pro.proCost,currencySymbol:bt}}function Je({fullPriceResumeDateFormatted:t,period:s,type:a,planName:o,currencySign:n,planCost:i}){switch(["month","year"].includes(s)||Dt.warn("Invalid period passed to PlanManagementModal.getPeriodFormattedMessage",{period:s}),a){case"billingStartAfterPromo":return e.jsx(d,{id:"planDowngradeModal.billingResumeAfterPromo",defaultMessage:"Billing will resume on {fullPriceResumeDateFormatted}",values:{fullPriceResumeDateFormatted:t}});case"currentSubscriptionPromo":if(s==="month")return e.jsx(d,{id:"planRenewalModal.currentSubscriptionPromoMonth",defaultMessage:"You'll keep your promotional subscription until {fullPriceResumeDateFormatted}. Then, you'll be charged {currencySign}{planCost}/month for ChatGPT {planName}",values:{fullPriceResumeDateFormatted:t,planName:o,currencySign:n,planCost:i}});if(s==="year")return e.jsx(d,{id:"planRenewalModal.currentSubscriptionPromoYear",defaultMessage:"You'll keep your promotional subscription until {fullPriceResumeDateFormatted}. Then, you'll be charged {currencySign}{planCost}/year for ChatGPT {planName}",values:{fullPriceResumeDateFormatted:t,planName:o,currencySign:n,planCost:i}});break;case"newPlanCostAfterPromo":if(s==="month")return e.jsx(d,{id:"planDowngradeModal.newPlanCostAfterPromoMonth",defaultMessage:"{currencySign}{planCost}/month after",values:{currencySign:n,planCost:i}});if(s==="year")return e.jsx(d,{id:"planDowngradeModal.newPlanCostAfterPromoYear",defaultMessage:"{currencySign}{planCost}/year after",values:{currencySign:n,planCost:i}});break}}function gt(t,s){const a=Ae(new Date,t);return new Intl.DateTimeFormat(s,{year:"numeric",month:"short",day:"numeric"}).format(a)}function ts({isWebRedesign:t,currentAccount:s,intl:a,billingDetails:o,pricingPlan:n,promoMetadata:i,columnPlanType:c}){if(i||!s.data.subscriptionStatus.discount)return{activeDiscountMetadata:null,scheduledAdditionalLink:null};const m=s.getDaysUntilPlanDiscountExpires(),p=s.data.subscriptionStatus.discount,h=s.planType,u=s.getNextPlanType(),l=p.discount_start_in_num_periods??0,r=l>0&&h===c&&!u,g=l>0&&u===c,M=a.formatNumber(p.amount,{style:"currency",currency:o.currency,minimumFractionDigits:0,maximumFractionDigits:2});return r||g?{activeDiscountMetadata:null,scheduledAdditionalLink:e.jsx("div",{className:"mb-3 w-full",children:e.jsx("div",{className:H(t?"font-medium text-[#615EEB]":"text-green-600","px-1 text-sm"),children:p.discount_type===xe.PERCENTAGE?e.jsx(d,{id:"PlusColumn.scheduledPercentDiscount",defaultMessage:"Your {discountPercent}% discount will apply in {numPeriods, plural, one {the next billing period} other {# billing periods}}.",values:{discountPercent:p.amount,numPeriods:l}}):e.jsx(d,{id:"PlusColumn.scheduledFixedDiscount",defaultMessage:"Your {discountFixed} discount will apply in {numPeriods, plural, one {the next billing period} other {# billing periods}}.",values:{discountFixed:M,numPeriods:l}})})})}:l>0||c!==s.data.subscriptionStatus.planType?{activeDiscountMetadata:null,scheduledAdditionalLink:null}:(n.cost=At(a,n.cost,p),p.discount_type===xe.PERCENTAGE?{activeDiscountMetadata:{discount:{percentage:p.amount,expires_at:m?gt(m,a.locale):void 0}},scheduledAdditionalLink:null}:p.discount_type===xe.FIXED?{activeDiscountMetadata:{discount:{value:p.amount,expires_at:m?gt(m,a.locale):void 0}},scheduledAdditionalLink:null}:{activeDiscountMetadata:null,scheduledAdditionalLink:null})}function ft(t,s,a,o){let n;switch(t){case"month":n=oa(new Date,s);break;case"year":n=na(new Date,s);break}return o&&n&&(n=Ae(n,o)),new Intl.DateTimeFormat(a,{year:"numeric",month:"short",day:"numeric"}).format(n)}function as({intl:t,pricingPlan:s,planName:a,promoMetadata:o,currency:n,currentAccount:i}){const{costTitle:c,currencySymbol:m}=wa(s,n),p=c?.defaultMessage?.toString()??"20",h=at(a.toLowerCase()),{schedule:u}=o,l=o.duration?.period??"month",r=o.duration?.num_periods??1,g=u?.start_after_num_periods??0,M=u?.period??l,y=g>0?ft(M,g,t.locale):void 0,D=ft(l,r+(g>0?g:0),t.locale,i?.getDaysUntilPlanRenews()),F=At(t,s.cost,o.discount,o.duration??{num_periods:1,period:"month"}),A=m.code.defaultMessage?.toString()??"USD",C=t.formatNumber(parseFloat(p)||0,{style:"currency",currency:A,minimumFractionDigits:0,maximumFractionDigits:2}),Y=o?.no_auto_renewal_at_discount_end===!0;let j;switch(l){case"month":g>0?r===1?j=t.formatMessage(S.promoPlanDisclaimerScheduledForSingleMonth,{start_date:y,end_date:D,cost:C,plan_name:h}):j=t.formatMessage(S.promoPlanDisclaimerScheduledForPluralMonths,{num_months:r,start_date:y,end_date:D,cost:C,plan_name:h}):r===1?j=Y?t.formatMessage(S.promoPlanDisclaimerNoRenewForSingleMonth,{}):t.formatMessage(S.promoPlanDisclaimerForSingleMonth,{date:D,cost:C,plan_name:h}):j=Y?t.formatMessage(S.promoPlanDisclaimerNoRenewForPluralMonths,{num_months:r}):t.formatMessage(S.promoPlanDisclaimerForPluralMonths,{num_months:r,date:D,cost:C,plan_name:h});break;case"year":g>0?r===1?j=t.formatMessage(S.promoPlanDisclaimerScheduledForSingleYear,{start_date:y,end_date:D,cost:C,plan_name:h}):j=t.formatMessage(S.promoPlanDisclaimerScheduledForPluralYears,{num_years:r,start_date:y,end_date:D,cost:C,plan_name:h}):r===1?j=Y?t.formatMessage(S.promoPlanDisclaimerNoRenewForSingleYear,{}):t.formatMessage(S.promoPlanDisclaimerForSingleYear,{date:D,cost:C,plan_name:h}):j=Y?t.formatMessage(S.promoPlanDisclaimerNoRenewForPluralYears,{num_years:r}):t.formatMessage(S.promoPlanDisclaimerForPluralYears,{num_years:r,date:D,cost:C,plan_name:h});break;case"hour":throw new Error("Period 'hour' is not supported")}const ae="<article>"+t.formatMessage(S.termsApply)+"</article> "+j;let L=o.summary;if(g>0){const{formattedDiscountedCost:_}=Ke(t,1,o.discount,n),w=_;switch(l){case"month":r===1?L=t.formatMessage(S.promoSummaryScheduledForSingleMonth,{discounted_cost:w}):L=t.formatMessage(S.promoSummaryScheduledForPluralMonths,{discounted_cost:w,num_months:r});break;case"year":r===1?L=t.formatMessage(S.promoSummaryScheduledForSingleYear,{discounted_cost:w}):L=t.formatMessage(S.promoSummaryScheduledForPluralYears,{discounted_cost:w,num_years:r});break}}let W=F;if(g>0){const{formattedDiscountedCost:_}=Ke(t,1,o.discount,n);let w;switch(l){case"month":r===1?w=t.formatMessage(S.promoCostSubtitleScheduledForSingleMonth,{start_date:y,discounted_cost:_}):w=t.formatMessage(S.promoCostSubtitleScheduledForPluralMonths,{start_date:y,discounted_cost:_,num_months:r});break;case"year":r===1?w=t.formatMessage(S.promoCostSubtitleScheduledForSingleYear,{start_date:y,discounted_cost:_}):w=t.formatMessage(S.promoCostSubtitleScheduledForPluralYears,{start_date:y,discounted_cost:_,num_years:r});break}W={...s.cost,costDuration:{id:"promoCostDurationScheduled",defaultMessage:w,description:"Cost duration subtitle for scheduled promo indicating when discount starts and for how long"}}}return s={...s,summary:{id:"promoSummary",defaultMessage:L},disclaimer:{id:"promoDisclaimer",defaultMessage:ae,article:"https://help.openai.com/en/articles/10492689-chatgpt-plus-promotions-referrals"},fullPriceResumeDateString:D,cost:W,callToAction:{...s.callToAction,promo:{id:"pricingPlanConstants.promo.callToAction",defaultMessage:"Apply to My Subscription",description:"Payment call to action for existing subscribers adding a discount to their plan"}}},s}const S=Te({specialOffer:{id:"pricingPlanConstants.specialOffer",defaultMessage:"SPECIAL OFFER"},promoPlanDisclaimerForPluralMonths:{id:"pricingPlanConstants.promoPlanDisclaimerForPluralMonths",defaultMessage:"Promo pricing applies for {num_months} months. Starting {date}, ChatGPT {plan_name} will continue at {cost}/month. Cancel anytime."},promoPlanDisclaimerScheduledForPluralMonths:{id:"pricingPlanConstants.promoPlanDisclaimerScheduledForPluralMonths",defaultMessage:"Promo pricing applies for {num_months} months starting {start_date}. Starting {end_date}, ChatGPT {plan_name} will continue at {cost}/month. Cancel anytime."},promoPlanDisclaimerScheduledForSingleMonth:{id:"pricingPlanConstants.promoPlanDisclaimerScheduledForSingleMonth",defaultMessage:"Promo pricing applies for 1 month starting {start_date}. Starting {end_date}, ChatGPT {plan_name} will continue at {cost}/month. Cancel anytime."},promoPlanDisclaimerScheduledForPluralYears:{id:"pricingPlanConstants.promoPlanDisclaimerScheduledForPluralYears",defaultMessage:"Promo pricing applies for {num_years} years starting {start_date}. Starting {end_date}, ChatGPT {plan_name} will continue at {cost}/year. Cancel anytime."},promoPlanDisclaimerScheduledForSingleYear:{id:"pricingPlanConstants.promoPlanDisclaimerScheduledForSingleYear",defaultMessage:"Promo pricing applies for 1 year starting {start_date}. Starting {end_date}, ChatGPT {plan_name} will continue at {cost}/year. Cancel anytime."},promoPlanDisclaimerForSingleMonth:{id:"pricingPlanConstants.promoPlanDisclaimerForSingleMonth",defaultMessage:"Promo pricing applies for 1 month. Starting {date}, ChatGPT {plan_name} will continue at {cost}/month. Cancel anytime."},promoPlanDisclaimerNoRenewForPluralMonths:{id:"pricingPlanConstants.promoPlanDisclaimerNoRenewForPluralMonths",defaultMessage:"Promo pricing applies for {num_months} months."},promoPlanDisclaimerNoRenewForSingleMonth:{id:"pricingPlanConstants.promoPlanDisclaimerNoRenewForSingleMonth",defaultMessage:"Promo pricing applies for 1 month."},promoCostSubtitleScheduledForPluralMonths:{id:"pricingPlanConstants.promoCostSubtitleScheduledForPluralMonths",defaultMessage:"Starting {start_date}: {discounted_cost}/month for {num_months} months"},promoCostSubtitleScheduledForSingleMonth:{id:"pricingPlanConstants.promoCostSubtitleScheduledForSingleMonth",defaultMessage:"Starting {start_date}: {discounted_cost}/month for 1 month"},promoCostSubtitleScheduledForPluralYears:{id:"pricingPlanConstants.promoCostSubtitleScheduledForPluralYears",defaultMessage:"Starting {start_date}: {discounted_cost}/year for {num_years} years"},promoCostSubtitleScheduledForSingleYear:{id:"pricingPlanConstants.promoCostSubtitleScheduledForSingleYear",defaultMessage:"Starting {start_date}: {discounted_cost}/year for 1 year"},promoPlanDisclaimerForPluralYears:{id:"pricingPlanConstants.promoPlanDisclaimerForPluralYears",defaultMessage:"Promo pricing applies for {num_years} years. Starting {date}, ChatGPT {plan_name} will continue at {cost}/year. Cancel anytime."},promoPlanDisclaimerForSingleYear:{id:"pricingPlanConstants.promoPlanDisclaimerForSingleYear",defaultMessage:"Promo pricing applies for 1 year. Starting {date}, ChatGPT {plan_name} will continue at {cost}/year. Cancel anytime."},promoPlanDisclaimerNoRenewForPluralYears:{id:"pricingPlanConstants.promoPlanDisclaimerNoRenewForPluralYears",defaultMessage:"Promo pricing applies for {num_years} years."},promoPlanDisclaimerNoRenewForSingleYear:{id:"pricingPlanConstants.promoPlanDisclaimerNoRenewForSingleYear",defaultMessage:"Promo pricing applies for 1 year."},termsApply:{id:"pricingPlanConstants.termsApply",defaultMessage:"Terms apply."},promoSummaryScheduledForPluralMonths:{id:"pricingPlanConstants.promoSummaryScheduledForPluralMonths",defaultMessage:"Pay for the first month, then the next {num_months} months are {discounted_cost}."},promoSummaryScheduledForSingleMonth:{id:"pricingPlanConstants.promoSummaryScheduledForSingleMonth",defaultMessage:"Pay for the first month, then the next month is {discounted_cost}."},promoSummaryScheduledForPluralYears:{id:"pricingPlanConstants.promoSummaryScheduledForPluralYears",defaultMessage:"Pay for the first year, then the next {num_years} years are {discounted_cost}."},promoSummaryScheduledForSingleYear:{id:"pricingPlanConstants.promoSummaryScheduledForSingleYear",defaultMessage:"Pay for the first year, then the next year is {discounted_cost}."}}),fe=f.PLUS,ss=()=>Ze({queryKey:["has-app-store-subscription-in-billing-retry"],queryFn:async()=>await ga.safeGet("/subscriptions/has_app_store_subscription_in_billing_retry")});function ns(t,s){const a=t.data.subscriptionStatus.planType,o=t.getNextPlanType();let n=t.getDaysUntilPlanChanges(),i=o===f.PLUS&&a===f.PRO||o===f.GO&&[f.PRO,f.PLUS].includes(a);return s&&!i&&(n=t.getDaysUntilPlanRenews(),i=!0),{daysUntilPlanChanges:n,isDowngradeScheduled:i,nextPlanType:o}}function os(t,s){const a=Ae(new Date,t);return new Intl.DateTimeFormat(s,{year:"numeric",month:"short",day:"numeric"}).format(a)}function ht(t){return pa.includes(t)?t:"USD"}function rs(t,s,a,o){if(t==="plus-10-for-3-months")switch(a.currency){case"USD":{const n={value:10,currency_code:ht(a.currency)};return{plan_name:re.PLUS,title:"",summary:s.formatMessage(o?Ce.headline:he.plusSummary),discount:n,duration:{num_periods:3,period:"month"},price_period:"recurring",promotion_type:"discount",promotion_type_label:null}}case"EUR":case"GBP":return{plan_name:re.PLUS,title:"",summary:s.formatMessage(o?Ce.headline:he.plusSummary),discount:{percentage:52.18},duration:{num_periods:3,period:"month"},price_period:"recurring",promotion_type:"discount",promotion_type_label:null};case"INR":return null;case"IDR":return null}else if(t==="plus-10-for-12-mos")switch(a.currency){case"USD":{const n={value:10,currency_code:ht(a.currency)};return{plan_name:re.PLUS,title:"",summary:s.formatMessage(o?Ce.headline:he.plusSummary),discount:n,duration:{num_periods:12,period:"month"},price_period:"recurring",promotion_type:"discount",promotion_type_label:null}}case"EUR":case"GBP":return{plan_name:re.PLUS,title:"",summary:s.formatMessage(o?Ce.headline:he.plusSummary),discount:{percentage:52.18},duration:{num_periods:12,period:"month"},price_period:"recurring",promotion_type:"discount",promotion_type_label:null};case"INR":return null;case"IDR":return null}return null}const hs=({analyticsParams:t,className:s,currentAccount:a,planLoading:o,isPromoLoading:n,onUpgradeButtonClick:i,setPlanLoading:c,plusPricingPlan:m=null,shouldShowAdditionalLinks:p=!0,billingDetails:h,promoCode:u=null,promoMetadata:l=null,onClose:r,disableForMobile:g=!1,type:M,isWebRedesign:y,shouldUseComparisonSpacing:D,autoUpgrade:F=!1,fromiOSWebview:A=!1})=>{const{data:C}=ra(),{data:Y,refetch:j}=Ze(kt),{data:{value:ae}={}}=ss(),{trackSelectedPixels:L}=Ra({key:f.PLUS}),W=a.features,_=vt(),w=!ia(_),P=te(),x=wt();let v=m||Da({isWebRedesign:y});const J=Ya({ctx:_,shouldLogExposure:!1}),{data:T}=Nt(J);l==null&&T?.coupon===J&&T?.state==="eligible"&&Ba({ctx:_,shouldLogExposure:!0})&&(l=rs(J,P,h,y),u=J);const{eligible:ie,campaignId:Z}=ja();let B;l==null&&ie&&(!u&&Z&&(B=Z),l={plan_name:re.PLUS,title:"",summary:P.formatMessage(y?Ce.headline:he.plusSummary),discount:{percentage:100},duration:{num_periods:1,period:"month"},price_period:"recurring",promotion_type:"discount",promotion_type_label:P.formatMessage(G.specialOffer)});const X=E.useRef(!1),le=E.useRef(!1),[Pe,ce]=E.useState(!1),[ue,be]=E.useState(!1),[we,de]=E.useState(!1),{recentlyDowngraded:me}=Ut();let z=[];const se=a.isOrWasPaidCustomer(),ne=a.hasPaidSubscription(),k=ne&&a.isPlus(),q=ne&&a.isPro(),$=a.getLastActiveSubscription(),pe=Re(_,"3950229590"),{prepareCheckoutSession:ge,navigateToCheckout:Le}=Ua(),Oe=la(C),Ye=W.includes("disable_plus_upgrade_ui")&&!se,{daysUntilPlanChanges:st,isDowngradeScheduled:Yt,nextPlanType:nt}=ns(a,me),O=E.useMemo(()=>({...t,promoCode:u,promoCampaign:B,planType:fe,isUpgradeUiDisabled:Ye}),[t,u,B,Ye]),Bt=!!Y?.email,Me=E.useRef(new Map),Be=E.useRef(null);E.useEffect(()=>{if(!k&&pe.get("enabled_prefetch_checkout_for_plus",!1)){const R={plan_name:re.PLUS,billing_details:h,promo_code:u,promo_campaign:B},N=JSON.stringify(R);if(!Me.current.has(N)){b.logEventWithStatsig("Account Pay: Prefetch Checkout Session","chatgpt_account_payment_modal_prefetch_checkout_session",O),Me.current.clear();const Q=pe.get("skip_sentinel_checkout",!1),Ee=ge(R,{skipSentinelCheckout:Q,fromiOSWebview:A});Me.current.set(N,Ee)}}},[ge,O,h,u,W,k,pe,Z,B,A]);const Gt=()=>{const R={plan_name:re.PLUS,billing_details:h,promo_code:u,promo_campaign:B},N=Me.current.get(JSON.stringify(R));if(N)return b.logEventWithStatsig("Account Pay: Using Prefetched Checkout Session","chatgpt_account_payment_modal_using_prefetched_checkout_session",O),N;b.logEventWithStatsig("Account Pay: Click to Fetch Checkout Session","chatgpt_account_payment_modal_click_to_fetch_checkout_session",O),Me.current.clear();const Q=pe.get("skip_sentinel_checkout",!1);return ge(R,{skipSentinelCheckout:Q,fromiOSWebview:A})},Ht=async({skipEmailCheck:R})=>{if(!Bt&&!R){de(!0);return}c?.(f.PLUS),b.logEvent("Account Pay: Payment Checkout Clicked",O),Ie(_,"chatgpt_account_payment_modal_upgrade_button_click",fe),Be.current=Date.now();try{const N=await Gt();let Q;Be.current&&(Q=Date.now()-Be.current),b.logEvent("Account Pay: Navigating to Payment Checkout",{...O,url:N.url??"",latency_ms:Q});const Ee={url:String(N.url??"")};Q!==void 0&&(Ee.latency_ms=Q.toString()),Ie(_,"chatgpt_account_payment_modal_navigating_to_checkout",fe,Ee),await Le(N)}catch{x.warning(P.formatMessage(G.paymentErrorWarning),{hasCloseButton:!0})}c?.(null)},zt=()=>{b.logEvent("Account Portal: Click iOS Manage Subscription",O)},Vt=()=>{b.logEvent("Account Portal: Click Android Manage Subscription",O)},Wt=k&&$.purchase_origin_platform===Fe.MOBILE_IOS,qt=k&&$.purchase_origin_platform===Fe.MOBILE_ANDROID;Oe&&!k&&z.push(e.jsx(_e,{to:ca,target:"_blank",className:H(y?"px-1 font-medium":"px-2","underline"),children:e.jsx(d,{...G.limitsApply})},"row-plus-plan-usage-limits")),Wt&&z.push(e.jsx(_e,{to:ua,target:"_blank",onClick:zt,className:H(y?"px-1 font-medium":"px-2","underline"),children:P.formatMessage(pt.manageSubscriptionIos.callToAction)},"row-plus-plan-manage-ios")),qt&&z.push(e.jsx(_e,{to:da,target:"_blank",onClick:Vt,className:H(y?"px-1 font-medium":"px-2","underline"),children:P.formatMessage(pt.manageSubscriptionAndroid.callToAction)},"row-plus-plan-manage-android")),k&&se&&z.push(e.jsx(_e,{target:"_blank",to:yt,onClick:Ft,className:H(y?"px-1 font-medium":"px-2","underline"),children:e.jsx(d,{...G.billingHelp})},"row-plus-plan-help-link"));const De=({skipAppStoreSubscriptionInBillingRetryCheck:R=!1,skipEmailCheck:N=!1}={})=>{if(ae&&!R)return ce(!0);if(i)return i(h,O);ne&&!k&&!a.isActiveSubscriptionGratis()?(b.logEvent("Account Pay: Payment Checkout Clicked",O),Ie(_,"chatgpt_account_payment_modal_upgrade_button_click",fe),be(!0)):(L(),Ht({skipEmailCheck:N}))};E.useEffect(()=>{!F||le.current||(le.current=!0,De())},[F]);const je=(R,N)=>e.jsx(Qe,{planType:fe,isCurrentPlan:k&&!ve,disabled:R,onClick:N,testId:"select-plan-button-plus-upgrade",activeColor:q?"secondary":y&&M==="highlight"||M==="promo"?"purple":M==="standard"||$t?"primary":void 0,children:o===f.PLUS&&!ue?e.jsx(jt,{}):ve&&k&&v.callToAction.promo?P.formatMessage(v.callToAction.promo):k?P.formatMessage(v.callToAction.active):ot&&w&&v.callToAction.inactiveUnauthenticated?P.formatMessage(v.callToAction.inactiveUnauthenticated):P.formatMessage(Ga({ctx:_,planType:f.PLUS}))});Tt(we,{plan:O});const ve=l!=null,$t=l?.promotion_type==="student_discount",ot=l!=null&&"referrer_name"in l,Qt=(!k||ve)&&o==null;z=ve?[]:z;const{activeDiscountMetadata:rt,scheduledAdditionalLink:it}=ts({isWebRedesign:y,currentAccount:a,intl:P,billingDetails:h,pricingPlan:v,promoMetadata:l,columnPlanType:f.PLUS});if(it&&z.unshift(it),rt&&(v.summary=he.plusSummaryWithDiscount),l&&(v=as({intl:P,pricingPlan:v,promoMetadata:l,currency:h.currency,planName:f.PLUS,currentAccount:a})),n!=null&&n)return null;const Kt=is(a);return e.jsxs(e.Fragment,{children:[e.jsx(tt,{planType:fe,elementId:ma,pricingPlan:v,shouldUseComparisonSpacing:D,callToActionButton:Ye?e.jsx("div",{className:"relative w-full",children:e.jsx(Ge,{side:"bottom",sideOffset:20,label:P.formatMessage(G.highDemandDisabledText),children:je(!0,()=>{})})}):g&&Kt?e.jsx("div",{children:e.jsx(Ge,{side:"top",sideOffset:20,label:P.formatMessage({id:"I2JCGZ",defaultMessage:"Mobile subscriptions are currently not eligible for this promotion."}),onOpenChange:R=>{R&&!X.current&&(ot&&va.logMobileSubscriptionTooltipOpen(),X.current=!0)},children:e.jsx("div",{children:je(!0,()=>{})})})}):e.jsxs("div",{children:[st&&Yt&&nt?e.jsx(Ge,{side:"top",sideOffset:20,label:e.jsx(d,{id:"Rd9wuM",defaultMessage:"Your subscription will change to {nextPlanType} on {date}.",values:{date:os(st,P.locale),nextPlanType:at(nt.toLowerCase())}}),children:je(!0,()=>{})}):je(!Qt,De),e.jsx(za,{isOpen:Pe,onClose:()=>ce(!1),onContinue:()=>De({skipAppStoreSubscriptionInBillingRetryCheck:!0}),analyticsParams:O}),ue&&e.jsx(Va,{isOpen:ue,onClose:()=>be(!1),accountId:a.id,initialPlanType:a.planType,updatedPlanType:f.PLUS,billingDetails:h,promoMetadata:l,promoCode:u,onPromoClose:r,fullPriceResumeDateString:v.fullPriceResumeDateString})]}),secondaryCallToActionButton:M==="promo"?e.jsx(Ne,{size:"large",color:"secondary",onClick:r,children:e.jsx(d,{...G.notNow})}):null,additionalLinks:p?z:[],type:M,promoMetadata:l,activeDiscountMetadata:rt,billingDetails:h,className:s,isWebRedesign:y}),e.jsx(Ue,{testId:"modal-add-email",isOpen:we,onClose:()=>de(!1),type:"success",className:"max-w-sm",children:e.jsx(Et,{enterEmailTitle:P.formatMessage(G.addEmailTitle),enterEmailDescription:P.formatMessage(G.addEmailDescription),onVerified:()=>{j(),de(!1),De({skipEmailCheck:!0})},cancelFlowButton:e.jsx(Ne,{className:"w-full rounded-md",color:"secondary",onClick:()=>de(!1),children:e.jsx(d,{...G.cancelAddEmail})})})})]})};function is(t){const s=t.hasPaidSubscription(),a=t.getLastActiveSubscription(),o=s&&a.purchase_origin_platform===Fe.MOBILE_IOS,n=s&&a.purchase_origin_platform===Fe.MOBILE_ANDROID;return o||n}const G=Te({specialOffer:{id:"pricingPlanConstants.specialOffer",defaultMessage:"SPECIAL OFFER"},addEmailTitle:{id:"AccountPaymentModal.addEmailTitle",defaultMessage:"Email required"},addEmailDescription:{id:"AccountPaymentModal.addEmailDescription",defaultMessage:"You'll be able to login with this email. It will also be used for account updates (like password resets) and information about OpenAI services."},cancelAddEmail:{id:"AccountPaymentModal.cancelAddEmail",defaultMessage:"Cancel"},haveExistingPlan:{id:"AccountPaymentModal.haveExistingPlan",defaultMessage:"Have an existing plan?"},billingHelp:{id:"AccountPaymentModel.billingHelp",defaultMessage:"I need help with a billing issue"},paymentErrorWarning:{id:"AccountPaymentModal.paymentErrorWarning",defaultMessage:"The payments page encountered an error. Please try again. If the problem continues, please visit help.openai.com."},accountErrorWarning:{id:"AccountPaymentModal.accountErrorWarning",defaultMessage:"The account management page encountered an error. Please try again. If the problem continues, please visit help.openai.com."},limitsApply:{id:"xda4i3",defaultMessage:"Limits apply"},notNow:{id:"AccountPaymentModal.notNow",defaultMessage:"Not Now"},highDemandDisabledText:{id:"AccountPaymentModal.highDemandDisabledText",defaultMessage:"Due to high demand, we've temporarily paused upgrades."}}),Se=f.SELF_SERVE_BUSINESS,ys=({analyticsParams:t,planLoading:s,billingDetails:a,isWebRedesign:o,isUnifiedPricingPage:n,type:i=He.standard,shouldUseComparisonSpacing:c,shouldUseOnboardingFeatures:m,className:p,cta:h})=>{const{data:u,refetch:l}=Ze(kt),r=te(),g=vt(),M=fa(g),y=Zt(),D=Ta(),[F,A]=E.useState(!1),C=M?.isTeam(),Y=M?.isPlus(),j={...t,planType:Se},ae=!!u?.email,_=ha().includes("de-DE")&&ya(g,"433209173").get("enabled",!1),w=!_&&Re(g,"111733276").get("show_upgrade_page_v2_copy",!1),P=Ea();let x=ka({isWebRedesign:o,shouldShowLocalizedFeatures:_,isBusinessUpgradeV2CopyEnabled:w,shouldUseOnboardingFeatures:m,isTrialEnabled:P.eligible,isUnifiedPricingPage:n});const v=Ia(),{data:J}=Nt(v??""),T=J??(P.eligible?{coupon:P.campaignId,state:"eligible"}:void 0),ie=T?.coupon===Na&&T?.state==="eligible",Z=T&&Fa(T?.coupon)&&T?.state==="eligible";let B=null;(ie||Z)&&(B={plan_name:"chatgptteamplan",title:"",summary:"",discount:{value:0,currency_code:"USD"},duration:{num_periods:1,period:"month"},price_period:"recurring",promotion_type:"discount",promotion_type_label:null}),ie?x={...x,cost:{...x.cost,costInDollars:K.promoCost,costInPounds:K.promoCost,costInEuros:K.promoCost,costInINR:K.promoCostINR,costInIDR:K.promoCostIDR,costDuration:K.promoCostDuration},disclaimer:a.currency===Xe?K.team1dollarPromoDisclaimerINR:a.currency===et?K.team1dollarPromoDisclaimerIDR:K.team1dollarPromoDisclaimer}:Z&&(x={...x,cost:{...x.cost,costInDollars:oe.promoCost,costInPounds:oe.promoCost,costInEuros:oe.promoCost,costInINR:oe.promoCostINR,costInIDR:oe.promoCost,costDuration:oe.promoCostDuration},disclaimer:oe.teamFreeTrialPromoDisclaimerWithPerSeatMonthlyPrice});const X=le=>{if(!ae&&!le){A(!0);return}b.logEvent("Account Pay: Payment Checkout Clicked",j),Ie(g,"chatgpt_account_payment_modal_upgrade_button_click",Se);const ce=new URLSearchParams(window.location.search).get("referrer")??document.referrer;Ma.setPurchaseWorkspaceData({minimumSeats:D,billingDetails:a,promoData:T?.state==="eligible"?T:void 0,referrer:ce}),Sa(y)};return Tt(F,{plan:j}),e.jsxs(e.Fragment,{children:[e.jsx(tt,{planType:Se,isWebRedesign:o,className:H(p,o&&"md:max-w-117"),elementId:Pa,pricingPlan:x,promoData:T,promoMetadata:B,type:i,shouldUseComparisonSpacing:c,isUnifiedPricingPage:n,isBusinessUpgradeV2CopyEnabled:w,useRecommendedBadge:i===He.highlight,callToActionButton:e.jsxs("div",{className:"flex flex-col gap-2",children:[C&&e.jsx(Qe,{planType:Se,isCurrentPlan:!0,disabled:s!=null||C,onClick:()=>X(),testId:"select-plan-button-teams-upgrade",children:r.formatMessage(x.callToAction.active)}),h??e.jsx(Qe,{className:"w-full",planType:Se,disabled:s!=null,activeColor:i===He.highlight?"purple":void 0,onClick:()=>X(),testId:"select-plan-button-teams-create",children:C||Y?r.formatMessage(x.callToAction.create):r.formatMessage(x.callToAction.inactive)})]}),billingDetails:a}),e.jsx(Ue,{testId:"modal-add-email",isOpen:F,onClose:()=>A(!1),type:"success",className:"max-w-sm",children:e.jsx(Et,{enterEmailTitle:r.formatMessage(G.addEmailTitle),enterEmailDescription:r.formatMessage(G.addEmailDescription),onVerified:async()=>{A(!1),await l(),X(!0)}})})]})};export{Wa as A,fs as F,za as M,Va as P,Qe as S,ys as T,Tt as a,Ga as b,as as c,ts as d,hs as e,os as f,ns as g,Ft as h,Ke as i,es as j,Ka as k,Ja as l,G as m,Ut as u};
//# sourceMappingURL=m40e1ct7so23v704.js.map
