const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jz13jsb2cpb4p95t.js","assets/lgw4q0e8zlqqfgug.js","assets/m60bpb0x3x7rg8fj.js","assets/root-otc54kct.css","assets/ggjzadbnd3k1vu0k.js","assets/conversation-small-j0gcsxmz.css","assets/kkey60aa7xfma56e.js","assets/ofmk3rqjad14dft0.js","assets/lx144r3bof1f1kvh.js","assets/lqxrayj6ap3vzwmb.js","assets/haixfva7lt2zsn6y.js","assets/k5ixj5zxhhfwyfyk.js","assets/idueivhrpfwkhmli.js"])))=>i.map(i=>d[i]);
import{r,j as e,M as H,d as mt,R as Va,b as La,A as Ba}from"./m60bpb0x3x7rg8fj.js";import{b_ as me,b$ as he,bF as os,g as Ne,cO as x,gN as ht,T as y,nB as Ls,aC as G,gv as Wa,z as V,q3 as pt,t as qa,nD as $a,ap as oe,d0 as J,ed as is,du as ge,iX as za,dv as ft,B as bt,hr as xt,R as Ka,bC as Qa,cr as Bs,aa as Ws,e as De,dT as qs,aq as Xa,q as Tt,fU as Ja,G as vt,gg as Ya,aH as Za,c0 as en,u as sn,d as tn,of as Ze,hw as an,ef as nn,mB as on,p as ae,I as ue,ad as rn,eK as ln,kk as dn,ez as cn,d5 as un,e_ as gn,no as mn,nk as hn,np as pn,nC as fn,nl as bn,dS as rs,fc as xn,Z as Tn,Y as vn,P as es,e7 as _n,p5 as In,eE as Sn,iI as Mn,gn as je,q4 as yn,av as Cn,q5 as wn,gR as En,gS as Rn,bP as kn,bb as Pn,jT as Fe,kA as An,q6 as ls,fV as Ue,h1 as jn,aj as Fn,f4 as Nn,q7 as $s,dC as ss,ni as Un,q8 as Dn,q9 as Gn,gm as On,r as Hn,hp as Vn,af as Ln}from"./lgw4q0e8zlqqfgug.js";import{gX as Bn,gY as zs,gZ as Wn,g_ as Ks,g$ as qn,h0 as $n,h1 as zn,h2 as Kn,h3 as Qn,h4 as Xn,h5 as Jn,h6 as Qs,h7 as Yn,cv as Xs,h8 as Zn,aO as eo,h9 as so,ao as to,ha as ao,hb as Js,hc as no,aP as Ys,hd as oo,he as io,hf as ro,hg as lo,hh as co,hi as uo,hj as go,hk as mo,hl as ho,hm as po,hn as fo,ho as _t,hp as bo,hq as xo,hr as To,hs as vo,ht as _o,hu as Io,hv as So,hw as Mo,hx as yo,hy as Co,hz as Zs,hA as wo,hB as Eo,hC as Ro,hD as ko,hE as Po,hF as Ao,hG as jo,hH as Fo,hI as No,hJ as Uo,hK as Do,hL as Go,hM as Oo,as as et,hN as Ho,hO as Vo,hP as Lo,hQ as It,hR as St,hS as Mt,hT as Bo,hU as Wo,hV as qo,hW as $o,hX as zo,hY as Ko,hZ as ts}from"./ggjzadbnd3k1vu0k.js";import{C as as}from"./d4l47j95cc16bbv9.js";const st=me(()=>he(()=>import("./jz13jsb2cpb4p95t.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(o=>o.MemoryActionResult));function tt(o,t,n){J(o,s=>{is.updateTree(s,i=>{i.updateNodeMetadata(t,{inlineComparisonRating:n})})})}const at=({messages:o})=>{for(const{metadata:t}of o){const{paragen_display_label:n}=t??{};if(n)return n;const{augmented_paragen_prompt_label:s}=t??{};if(s)return s}};function Qo(o){const t=r.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),n=r.useRef({left:null,right:null});return o.variantIds.length<2?e.jsx(yt,{setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:t,firstVisibleTokenTimestampsRef:n,...o}):e.jsx(Xo,{...o,visibilityStateRef:t,firstVisibleTokenTimestampsRef:n})}function Xo(o){const{clientThreadId:t,variantIds:n,turnIndex:s,firstVisibleTokenTimestampsRef:i}=o;if(n.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const g=pt(),m=qa(),[d,u]=n,c=r.useMemo(()=>$a(d+u)()>=.5,[d,u]),[p,w]=c?[u,d]:[d,u],[R,k,T]=oe(t,P=>{const O=Bs(P).tree.getLeafFromNode(p).id,S=Bs(P).tree.getLeafFromNode(w).id,b=y.getConversationTurns(P,O),I=y.getConversationTurns(P,S),F=s<b.length?b[s]:null,l=s<I.length?I[s]:null;return F||Ws.addError(`Paragen Left turn index ${s} out of bounds`,{turnIndex:s,turnCount:b.length,lastTurnRole:x(b)?.role,lastMessageAuthor:x(x(b)?.messages)?.author,lastMessageContentType:x(x(b)?.messages)?.content.content_type,lastMessageMetadata:x(x(b)?.messages)?.metadata,altTurnCount:I.length,altLastTurnRole:x(I)?.role,altLastMessageRole:x(x(I)?.messages)?.author.role}),l||Ws.addError(`Paragen Right turn index ${s} out of bounds`,{turnIndex:s,turnCount:I.length,lastTurnRole:x(I)?.role,lastMessageAuthor:x(x(I)?.messages)?.author,lastMessageContentType:x(x(I)?.messages)?.content.content_type,lastMessageMetadata:x(x(I)?.messages)?.metadata,altTurnCount:b.length,altLastTurnRole:x(b)?.role,altLastMessageRole:x(x(b)?.messages)?.author.role}),[O,F,l]}),[N,j]=c?[T,k]:[k,T],$="skippable_parallel_2_in_stream:a:1.5";r.useEffect(()=>(Ks.setState({displayingSideBySideFeedback:!0}),()=>{Ks.setState({displayingSideBySideFeedback:!1})}),[]);const ie=r.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null}),h=r.useCallback((P,{shouldSubmitParagenFeedback:O=!0}={})=>{if(!k||!T||!N||!j)throw new Error("Expected both turns to exist");J(t,v=>{is.setCurrentBranch(v,P)});const S=P===p,b=P===d;N.messages.length>0&&tt(t,N.messages[N.messages.length-1].id,b?"original":"new"),j.messages.length>0&&tt(t,j.messages[j.messages.length-1].id,b?"original":"new");const I=ge(t),F=[k,T].map((v,z)=>({messageId:v.messages[v.messages.length-1].id,loadFirstTokenTime:z===0?i.current.left:i.current.right,loadEndTime:x(v.messages)?.clientMetadata?.completionSampleFinishTime})),l=S?F[0].messageId:F[1].messageId,M=y.getParentPromptNode(Ne(t),R);if(!M)throw new Error("Expected prompt for side by side feedback");const B={},Y=M.message.clientMetadata?.variantsInStreamInfo==null&&M.message.metadata?.paragen_variants_info!=null;for(const v of F)B[v.messageId]=Y?{load_first_token_time:o.conversationTurnMountTime,load_end_time:o.conversationTurnMountTime}:{load_first_token_time:v.loadFirstTokenTime,load_end_time:v.loadEndTime};O&&lt({params:{conversation_id:I,displayed_message_ids:F.map(v=>v.messageId),message_metadatas:B,rating:"selected",selected_message_id:l,source_timestamp:Date.now(),ui_variant:1,user_prompt_message_id:M.message.id}})},[t,p,d,N,j,k,T,R,i,o.conversationTurnMountTime]);return r.useEffect(()=>za(ft,{requestCompletion:P=>{const O=ge(t),S=y.getParentPromptNode(Ne(t),R);if(!S)throw new Error("Expected prompt for side by side feedback");if(!k||!T)throw new Error("Expected both turns to exist");const b=[k,T].map((M,B)=>({messageId:M.messages[M.messages.length-1].id,loadFirstTokenTime:B===0?i.current.left:i.current.right,loadEndTime:x(M.messages)?.clientMetadata?.completionSampleFinishTime})),I={},F=S.message.clientMetadata?.variantsInStreamInfo==null&&S.message.metadata?.paragen_variants_info!=null;for(const M of b)I[M.messageId]=F?{load_first_token_time:o.conversationTurnMountTime,load_end_time:o.conversationTurnMountTime}:{load_first_token_time:M.loadFirstTokenTime,load_end_time:M.loadEndTime};const l=P.isForSkippingParagen;lt({params:{conversation_id:O,displayed_message_ids:b.map(M=>M.messageId),message_metadatas:I,rating:l?"explicit_skipped":"skipped",selected_message_id:null,source_timestamp:Date.now(),ui_variant:l?3:1,user_prompt_message_id:S.message.id}}),l&&h(p,{shouldSubmitParagenFeedback:!1})}}),[k,T,R,t,o.conversationTurnMountTime,$,N?.messages,j?.messages,m,i,h,p]),e.jsx(yt,{...o,setPreferredFeedback:h,leftVariantId:p,rightVariantId:w,leftTurn:k,rightTurn:T,hasActiveRequest:g,originalTurn:N,visibilityStateRef:ie})}function yt({setPreferredFeedback:o,leftVariantId:t,rightVariantId:n,leftTurn:s,rightTurn:i,hasActiveRequest:g,originalTurn:m,visibilityStateRef:d,...u}){const c=(s&&at(s))??null,p=(i&&at(i))??null,w=r.useMemo(()=>s?.messages??[],[s?.messages]),R=r.useMemo(()=>i?.messages??[],[i?.messages]),{avatarClassName:k,firstVisibleTokenTimestampsRef:T}=u,N=r.useMemo(()=>s?.messageGroups??[],[s?.messageGroups]),j=r.useMemo(()=>i?.messageGroups??[],[i?.messageGroups]),$=Bn(),ie=Ne(u.clientThreadId),h=x(s?.messages),P=x(i?.messages),O=ht(y.getRequestId(ie,h?.id??P?.id)),S=O&&!h?.end_turn,b=O&&!P?.end_turn,I=h!=null&&Ls(h),F=P!=null&&Ls(P),l=I??F,M=s?.role===G.User,B=i?.role===G.User,Y=r.useRef(null),v=r.useRef(null),z=r.useRef(null),pe=s!=null,A=i!=null;!pe&&T.current.left==null&&(T.current.left=Date.now()),!A&&T.current.right==null&&(T.current.right=Date.now()),r.useEffect(()=>{if(Y.current&&v.current&&z.current){const fe=Array(11).fill(0).map((be,W)=>W/10),U=new IntersectionObserver(be=>be.forEach(W=>{W.target===v.current?(d.current.left_visibility_initial==null&&(d.current.left_visibility_initial=W.intersectionRatio),d.current.left_visibility_max=Math.max(d.current.left_visibility_max??0,W.intersectionRatio)):W.target===z.current&&(d.current.right_visibility_initial==null&&(d.current.right_visibility_initial=W.intersectionRatio),d.current.right_visibility_max=Math.max(d.current.right_visibility_max??0,W.intersectionRatio))}),{root:Y.current,threshold:fe});return U.observe(v.current),U.observe(z.current),()=>U.disconnect()}},[d]);const{data:re}=Wa(void 0,!1,$);return e.jsxs("div",{className:"relative flex flex-col",children:[e.jsx("div",{className:"bg-token-main-surface-primary sticky top-[-1px] z-1 px-(--thread-content-margin) text-center text-lg text-pretty md:static","data-testid":"paragen-feedback-title",children:e.jsx(H,{id:"KKeSJV",defaultMessage:"You're giving feedback on a new version of ChatGPT."})}),e.jsx("div",{className:"text-token-text-secondary px-(--thread-content-margin) pt-1 pb-5 text-center text-sm text-pretty",children:e.jsx(H,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})}),e.jsx("div",{className:V(Wn("default"),"horzScrollShadows relative -mb-2 snap-x snap-mandatory overflow-x-auto overflow-y-clip pb-4"),ref:Y,children:e.jsxs("div",{className:V("mx-auto box-content max-w-[calc(2*var(--thread-content-max-width))] min-w-min px-(--thread-content-margin)","flex items-start gap-4 sm:gap-6"),children:[e.jsxs(nt,{rootElementRef:v,onClick:()=>{o(t)},hasActiveRequest:g,isImageGenInProgress:l,children:[e.jsxs(it,{children:[e.jsx(zs,{messages:w,isUserTurn:M,avatarClassName:k}),e.jsx(ot,{children:e.jsx(H,{...dt.responseNumber,values:{responseIndex:1,display_label:c?` ${c}`:""}})})]}),e.jsxs(e.Fragment,{children:[re!=null&&!M&&e.jsx(st,{clientThreadId:u.clientThreadId,messages:w,isParagen:!0}),e.jsx(as,{...u,allMessages:w,groupedMessagesToRender:N,allGroupedMessages:N,isUserTurn:M,isFinalUserTurn:!1,isFinalAssistantTurn:!1,isCompletionRequestInProgress:S,hasActiveRequest:g,shouldGrowContainer:!1,isParagen:!0}),e.jsx(rt,{clientThreadId:u.clientThreadId,conversationTurnMountTime:u.conversationTurnMountTime,turn:s,originalTurn:m})]})]}),e.jsxs(nt,{rootElementRef:z,onClick:()=>{o(n)},hasActiveRequest:g,isImageGenInProgress:l,children:[e.jsxs(it,{children:[e.jsx(zs,{messages:R,isUserTurn:B,avatarClassName:k}),e.jsx(ot,{children:e.jsx(H,{...dt.responseNumber,values:{responseIndex:2,display_label:p?` ${p}`:""}})})]}),e.jsxs(e.Fragment,{children:[re!=null&&!B&&e.jsx(st,{clientThreadId:u.clientThreadId,messages:R,isParagen:!0}),e.jsx(as,{...u,allMessages:R,groupedMessagesToRender:j,allGroupedMessages:j,isFinalUserTurn:!1,isFinalAssistantTurn:!1,isUserTurn:B,isCompletionRequestInProgress:b,hasActiveRequest:g,shouldGrowContainer:!1,isParagen:!0}),e.jsx(rt,{clientThreadId:u.clientThreadId,conversationTurnMountTime:u.conversationTurnMountTime,turn:i,originalTurn:m})]})]})]})})]})}function nt({rootElementRef:o,onClick:t,children:n,hasActiveRequest:s,isImageGenInProgress:i}){const g=r.useRef(null),m=r.useRef(null),d=r.useRef(null);return e.jsx("div",{"data-paragen-root":!0,className:"border-token-border-tertiary @container relative flex min-w-[min(450px,80cqw,80vw)] flex-1 snap-center flex-col gap-1 rounded-xl border text-start shadow-lg shadow-black/3",ref:o,children:e.jsxs("div",{className:V(qn,"px-(--thread-content-margin) py-4"),children:[e.jsx("div",{className:V("absolute top-48 right-0! left-0! h-px","invisible"),ref:g}),e.jsx("div",{className:V("absolute top-48 right-0! bottom-0 left-0!","invisible"),ref:m}),e.jsx("div",{className:V("absolute right-0! bottom-0 left-0! h-px","invisible"),ref:d}),n,s||i?null:e.jsx(bt,{className:"mt-4 self-start",onClick:t,"data-testid":"paragen-prefer-response-button",children:e.jsx(H,{id:"U2EAH6",defaultMessage:"I prefer this response"})})]})})}const ot=os.div`text-sm text-token-text-secondary font-semibold`,it=os.div`flex gap-4 items-center mb-1`;function rt({clientThreadId:o,conversationTurnMountTime:t,turn:n,originalTurn:s}){const i=xt();if(!i.showParagenMetadata||!i.showDebugConversationTurns&&!i.forceParagen||n==null)return null;let g=n===s?"ORIGINAL":"NEW";const m=n.messages[n.messages.length-1],d=m?.metadata?.__internal,u=m?.metadata?.paragen_display_label;if(d){const{model_id:w,model_definition_slug:R,model_definition_virtual_model_id:k,alternative_model_selection_rule:T,augmented_paragen_prompt_group_id:N,augmented_paragen_prompt_id:j,augmented_paragen_prompt:$}=d;w&&(g+=`
Model ID: ${w}`),R&&(g+=`
Model Slug: ${R}`),k&&(g+=`
Virtual Model ID: ${k}`),T&&(g+=`
Alternative Model Rule: ${T}`),N&&(g+=`
Prompt Group ID: ${N}`),j&&(g+=`
Prompt ID: ${j}`),$&&(g+=`
Prompt: ${$}`),u&&(g+=`
Display Label: ${u}`)}g+=`
Message ID: ${m.id}`;const c=y.getParentPromptNode(Ne(o),n.messages[0].id);if(!c)throw new Error("Expected prompt for side by side feedback");const p=c.message.clientMetadata?.variantsInStreamInfo==null&&c.message.metadata?.paragen_variants_info!=null;return g+=`
User prompt message ID: ${c.message.id}`,g+=`
Is Persisted Paragen? ${p}`,g+=`
Completion Sample Finish Time: ${p?`${t} (persisted)`:x(n.messages)?.clientMetadata?.completionSampleFinishTime}`,e.jsx("div",{className:"text-sm whitespace-pre-wrap text-red-500",children:g})}async function lt({params:o}){await Ka.safePost("/paragen_submission",{requestBody:o,authOption:Qa.SendIfAvailable})}const dt=mt({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}{display_label}"}}),Jo=me(()=>he(()=>import("./jz13jsb2cpb4p95t.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(o=>o.MemoryActionResult)),Yo=me(()=>he(()=>import("./lx144r3bof1f1kvh.js"),__vite__mapDeps([8,2,1,3,9,4,5,10])).then(o=>o.AutomationSourceHeader)),ct=me(()=>he(()=>import("./k5ixj5zxhhfwyfyk.js"),__vite__mapDeps([11,2,1,3,4,5,12])).then(o=>o.TextMessageEditor)),Zo=me(()=>he(()=>import("./ggjzadbnd3k1vu0k.js").then(o=>o.x1),__vite__mapDeps([4,1,2,3,5])).then(o=>o.ChatScreenRetrievalResultsFlyoutContent)),ut=80,gt=16;function ns(){return{minHeight:`calc(100dvh - ${Oo}px - 120px)`}}function ei(o){const{turnIndex:t,isFinalTurn:n,clientThreadId:s,onRequestCompletion:i,currentModelId:g,scrollToMessageId:m,dateHeaderType:d,hideUserActions:u}=o,c=De(),p=qs(c,s),w=$n(c),R=Xa(),[k,T]=Tt(a=>[Ja(a),vt(a)]),N=!!R&&Ya(R),j=Za(en.isBusinessWorkspace),$=Go(),{eligible:ie}=sn(tn.hasSeenAudioParagenPrompt),[h,P,O]=oe(s,a=>{const _=y.getConversationTurnAtIndex(a,t),C=t>0?y.getConversationTurnAtIndex(a,t-1):null,f=C?.role===G.User&&C.messages.some(D=>D.metadata?.visually_hide_response_from_conversation);return[_,f,C]},{disablePerfDetector:n}),{messages:S,messageGroups:b}=h,I=zn(a=>a.size===0?-1:b.findIndex(_=>_.type===Ze?_.groups.some(C=>C.messages.some(f=>a.has(f?.id))):_.messages.some(C=>a.has(C?.id)))),F=S[0],l=x(S),M=r.useMemo(()=>b.some(a=>a.type===an.SearchGPTQuery),[b]),[B,Y]=r.useState(!1),v=r.useMemo(()=>S.some(a=>a.metadata?.n7jupd_message),[S]),z=r.useMemo(()=>v?nn(S,a=>a.author.name==="n7jupd.metadata"):null,[S,v]),pe=!!z?.metadata?.kaur1br5_mode,{messages:A,visibleMessages:re,messageGroups:fe,lastMessageToRender:U}=r.useMemo(()=>{const a=I!==-1&&I+1<b.length,_=a?b.slice(0,I+1):b,C=a?_.flatMap(f=>f.type===Ze?f.groups.flatMap(D=>D.messages):f.messages):S;return{messages:C,visibleMessages:C.filter(on),messageGroups:_,lastMessageToRender:x(C)}},[S,b,I]),be=I!==-1,W=ae(c,"1887864177"),Ct=Kn(),xe=oe(s,a=>y.getLastMessageSystemHints(a)),Ge=xe?.includes(ue.Tatertot)&&ae(c,"28816792")&&rn(c),{capabilitySuggestionsEnabled:wt}=Qn(Ge),ds=r.useMemo(()=>({clientThreadId:s,turnIndex:t,messageId:l?.id}),[s,t,l?.id]),[cs,us]=r.useState(!1),[gs,Et]=r.useState(!1),Rt=r.useContext(Xn)!=null,E=h.role===G.User,ms=ln(),Z=dn(s),Oe=h.gizmoId??Z,He=cn(Oe).data,Ve=Oe&&!un(Oe)?He:void 0,kt=Ve&&h.gizmoId!=null&&h.gizmoId!==Z&&ae(c,"1418300125"),Le=gn(s),Pt=mn(s),Te=hn(Le),At=pn(Le,Pt),Be=fn(),[We,jt,Ft,hs,qe,Nt,$e,Ut,ps,Dt,K,ve,_e,Gt,fs,Q]=oe(s,a=>{const _=y.getParentPromptNode(a,F.id),C=_?.message.clientMetadata?.variantsInStreamInfo??(_?.message.metadata?.paragen_variant_choice?void 0:_?.message.metadata?.paragen_variants_info),f=y.getVariantIds(a,F.id),D=y.getCurrentVariantId(a,F.id),te=D?f.indexOf(D):0,Oa=C&&a?.tree!=null&&f.some(X=>{const{errType:Vs}=a.tree.getLeafFromNode(X).message.clientMetadata??{};return Vs!=null&&Vs!=="info"}),Ae=y.getConversationTurns(a),Ha=et(Ae,X=>X.role===G.Assistant);return[_,l!=null&&!Gn(l.id)&&y.isMessageTurnEnded(a,l.id),Oa,Dn(a?.mode,He?.gizmo.id),Ae.findIndex(X=>X.role===G.User)===t,et(Ae,X=>X.role===G.User)===t,Ae.findIndex(X=>X.role===G.Assistant)===t,Ha===t,y.getRequestId(a,l?.id),C,f,te,!!a?.continuingFromSharedPostId,a?.currentLeafId,y.getSuperWidgetMessages(a,t)[0],y.lastUserMessage(a)]},{disablePerfDetector:n}),Ie=bn(),Se=rs(()=>{const a=On(p);return a?.value===je.STREAMING||a?.value===je.REALTIME}),Ot=A.some(a=>a.content.content_type===xn.MultimodalText),Ht=Tn(c,"3119715334").get("should-enable-skip",!1),{isUnauthenticated:bs}=vn(),xs=h.messages.map(a=>a.id),L=r.useRef(null);si({clientThreadId:s,turn:h,turnIndex:t,conversationTurnWrapperRef:L});const Ts=!w&&(m?.length??0)>2&&m!=="finalAgentTurn"&&n&&$,Me=E?x(re):void 0,ze=Me?.id,Vt=r.useCallback(()=>{ze&&(es.logEvent("Edit Prompt",{id:ze,threadId:ge(s)}),_n(c,"chatgpt_edit_prompt"),us(!0))},[c,ze,s]),Lt=r.useCallback(()=>{us(!1)},[]),{hasConnections:vs}=In(),{onChangeRating:Bt}=Jn({clientThreadId:s,currentModelConfig:Le}),Wt=a=>{if(!l)return;const _=l.clientMetadata?.rating,f=(_==="thumbs_up"?"thumbsUp":_==="thumbs_down"?"thumbsDown":_)===a?null:a;if(Bt({nodeId:l.id,messageId:l.id,rating:f}),f){const D=vs&&b.some(te=>te.type!==Ze&&te.messages?.some(Un));es.logEventWithStatsig(f==="thumbsDown"?"Message Feedback Thumbs Down Clicked":"Message Feedback Thumbs Up Clicked","chatgpt_thumb_feedback",{id:l.id,threadId:ge(s),model:g,rating:f,...vs?{isCATriggered:D}:{},...T?{isSidebar:!0}:{}})}Et(f==="thumbsDown")},[qt]=r.useState(()=>Date.now()),_s=Sn(s),Is=Mn(s)?.value,$t=Is===je.STREAMING,zt=Is===je.REALTIME,Kt=ps!=null,Qt=ht(ps),Xt=Qs.useState(a=>Qs.isReplayInProgress(a,Gt)),q=!jt&&Qt||be||zt||Xt&&n,Ke=pt(),Ss=r.useRef(!1),Jt=yn({clientThreadId:s}),Yt=Yn(s,l)&&!Jt,[,Zt]=La(),{isOpen:ye}=Xs(),Ms=Zn();r.useEffect(()=>{const _=new URLSearchParams(window.location.search).get("message");!(_!=null&&xs.includes(_))||!L.current||(L.current.scrollIntoView({behavior:"instant"}),Zt(f=>(f.delete("message"),f),{replace:!0,preventScrollReset:!0}))},[]),r.useEffect(()=>{if(w)return;const C=new URLSearchParams(window.location.search).get("message")!=null;if(Ss.current||C||m===void 0||!L.current||Ms){m==="finalAgentTurn"&&n&&J(s,f=>{f.scrollToMessageId=void 0});return}(xs.includes(m)||m==="finalAgentTurn"&&n)&&(Ss.current=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{if(L.current)if(m==="finalAgentTurn"&&n)L.current.scrollIntoView({behavior:"instant",block:"end"}),J(s,f=>{f.scrollToMessageId=void 0});else{const f=L.current.offsetHeight;let D=0;ye?D=-8:f>ut&&(D=ut-f);const te=eo(qs(c,s)).pinnedWidgetHeight$();te!=null&&(D+=te+gt),L.current.style.scrollMarginTop=`${D+gt}px`,L.current.scrollIntoView({behavior:"smooth"})}})}))},[m,L.current,ye,Ms]);const{showDebugConversationTurns:ea}=xt(),sa=!Ie&&!_e&&!ms&&!E,ta=U?.author.role===G.Assistant?U:null,aa=U?.metadata?.system_hints?.includes(ue.Research),na=U?.metadata?.system_hints?.includes(ue.Agent);so({isCompletionRequestInProgress:q,isUserTurn:E,message:ta});const{isOpen:oa}=Xs(),ia=to(),Ce=ao(hs),ra=Cn(a=>a.voiceFeedbackThread),ys=_s===ra,la=l?.metadata?.async_source,we=n&&Kt,ee=Se||q||$t,Cs=re.length===0&&A.some(wn),Ee=!cs&&!Cs&&!Ie&&!_e&&!Ce&&!oa&&h.role!==G.Developer&&!(h.role===G.User&&u)&&!(n&&ys&&ee)&&!(we&&ee)&&!(n&&Se&&la)&&!(ee&&v)&&!l?.metadata?.is_auto_proceed_message&&!l?.metadata?.is_takeover_ended_message,da=!Ee&&!(we&&ee)&&(Ie||_e)&&!T,ca=A.some(a=>En(a)===Rn.l1239dk1),Qe=oe(s,a=>{const _=new Set;return y.getParentPromptNode(a,F.id)?.message.metadata?.attachments?.forEach(f=>{f.mime_type?.startsWith("image/")||_.add(f.context_connector_info?.context_connector??"file")}),_}),Xe=kn(),Je=Pn(c,"110789670");let se;Xe.isLoading?se=void 0:Xe.canUpgradeGDrive&&Qe.has(Fe.GDRIVE)&&Je.get("enabled",!1)?se=Fe.GDRIVE:Xe.canUpgradeSharepoint&&Qe.has(Fe.O365_BUSINESS)&&Je.get("enabled",!1)?se=Fe.O365_BUSINESS:Qe.has("file")&&Je.get("enabled",!1)&&(se="general");const ua=we&&!q&&!T&&!Ie&&!_e&&!ca&&(W||Ct||wt||Ge||!!se),le=l!=null&&(!j||At||N||Be)&&!Ce&&!bs&&!ms&&!l.metadata?.b1de6e2_s,ws=Se||q,[ga,ma]=r.useState(!1),ha=!!(Q?.metadata?.dictation&&Q?.metadata?.dictation_asset_pointer&&!Q?.metadata?.dictation_edited),pa=!!(!ie||ga||Q?.metadata?.audio_paragen_result||Js(Q?.id)),Es=ha&&!pa,Rs=Es&&(!j||Be)&&le&&!ws&&!T&&!ye&&Q!=null&&$e&&ae(c,"51772912"),fa=no(Q?.id,Rs),ks=Rs&&fa,Re=!Ce&&sa&&n&&Dt?.num_variants_in_stream===2&&K.length<=2&&!l?.clientMetadata?.inlineComparisonRating&&!Ft&&!Es&&!Js(Q?.id),Ps=!ks&&(!j||Be)&&le&&(we||n&&ys)&&!ws&&!T&&!ye&&!v,As=!((q||Se)&&n)&&K.length>1&&!Re,js=E&&A.some(a=>Ys(a)?.shouldHideContent),ba=E&&Me!=null&&_s!=null&&!Ce&&!Ot&&!js&&!bs&&!aa&&!na&&!T,xa=l!=null&&(l.clientMetadata?.disclaimers??[]).length===0&&!T,ke=x(O?.messages.filter(An)),Fs=ls(c)&&$e&&(!xe||xe.length===0||xe.includes(ue.Search)),Ta=Ue(c)&&Fs,Ns=r.useCallback(a=>{J(s,_=>{is.setCurrentBranch(_,K[a])}),es.logEvent("Change Active Node",{intent:"toggle_between"}),ae(c,"4126691920")&&oo({parent_prompt_id:We?.id??"",prev_branch_id:K[ve],next_branch_id:K[a]},ge(s))},[s,K,ve,We?.id,c]),va=io(h,A,ea),{toggleThreadSidebar:Us}=jn(),Pe=l?.id,Ds=r.useCallback(()=>{Pe&&Us({type:"retrievalResults",clientThreadId:s,turnIndex:t,messageId:Pe})},[Pe,Us,s,t]),_a=r.useMemo(()=>ro(h,Te,!!Z),[Te,Z,h]),Ia=r.useMemo(()=>lo(h,!!Z),[Z,h]),Gs=!1,Os=ae(c,"2137702454"),Sa=r.useMemo(()=>h.role!==G.User&&Te&&Os||Gs,[h,Te,Os,Gs]),Ma=r.useMemo(()=>A.some(a=>Ys(a)?.canRetry===!1),[A]),ya=l?.metadata?.n7jupd_button_type,Ca=v&&l!=null&&l.id!=null&&!ya,wa=v&&n&&ee,Ea=v&&n;if(!va&&!Re)return Ts?e.jsx("div",{style:ns()}):null;if(P)return null;const Ra=U?.metadata?.followup_prompts?U.metadata.followup_prompts.map(a=>({text:a,type:Fn.Reply})):[],ka=U?.metadata?.category_suggestions,Pa=U?.metadata?.action_suggestions,Aa=U?.metadata?.pineapple_tool_suggestions,ja=!A.some(a=>Nn.getAudioAssetPointers(a).length>0)&&!Z&&!Ma,Fa=!q&&A.some(a=>a.author.role===G.Assistant&&a.metadata?.onboarding?.main_usages),Ye=A.find(a=>!!a.metadata?.onboarding?.examples)?.metadata?.onboarding?.examples,Hs=!js&&(!n||!q),Na=A.filter($s);if(!n&&Na.length===0&&!v)return null;let de="none";E&&qe&&(de="first");const Ua=O?.messages.some($s);E&&!qe&&(Ua?de="large":de="none"),n&&(de="last");const Da=(()=>{if(E&&!Ee&&Ue(c)&&k)return"mb-4";if(E&&!Ee&&!T)return"mb-10";if(!E&&T&&n)return"pb-[40px]"})(),Ga=ae(c,"1424158285");return e.jsx(co.Provider,{value:$e,children:e.jsxs(uo,{children:[e.jsx(go,{dateHeaderType:d,turn:h}),e.jsxs("article",{className:V("text-token-text-primary w-full focus:outline-none",!w&&m==="finalAgentTurn"&&$?"opacity-0":"",{hidden:Rt&&qe},E?"scroll-mt-(--header-height)":"scroll-mt-[calc(var(--header-height)+min(200px,max(70px,20svh)))]"),tabIndex:-1,style:Ts?ns():void 0,ref:L,dir:"auto","data-turn-id":h.id,"data-testid":`conversation-turn-${t}`,"data-scroll-anchor":!w&&n,"data-turn":E?"user":"assistant",children:[e.jsx(mo,{role:h.role,gizmo:Ve}),e.jsx(ho,{role:h.role,children:e.jsxs(po,{horizontalPadding:Re?"none":"standard",verticalPadding:de,children:[Re?e.jsxs(e.Fragment,{children:[e.jsx(Qo,{isFeedbackEnabled:le,variantIds:K,conversationTurnMountTime:qt,...o}),Ht&&e.jsx("div",{className:"mt-4 flex w-full justify-center",children:e.jsxs(bt,{color:"secondary",className:"text-token-text-primary","data-testid":"paragen-skip-button",onClick:()=>{ft.publish({kind:"requestCompletion",isForSkippingParagen:!0})},children:[e.jsx(fo,{className:"text-token-text-secondary me-1"}),e.jsx(H,{id:"IuTr+b",defaultMessage:"Skip"})]})})]}):e.jsxs(_t,{tabIndex:-1,className:V("group/turn-messages focus-visible:outline-hidden",B&&"super-widget-visible",Da,Fo({isUserTurn:E})),children:[kt&&e.jsx(bo,{gizmo:Ve}),Fs&&e.jsx(xo,{clientThreadId:s,threadContent:fs?.content??null,query:ke?ss(ke):null,triggeredSearch:M,turnIndex:t,isRequestActive:Ke,isLastTurnInConversation:n,messageGroups:fe,allMessages:S,onNavLinksWidgetDidShow:a=>{a&&Y(!0)},className:"mb-4!"}),Sa&&e.jsx(To,{handleShowRetrievalResults:Ds,clientThreadId:s,turnIndex:t,responseComplete:!ee,className:"mb-6"}),!E&&e.jsx(Jo,{messages:A,clientThreadId:s,gizmoId:He?.gizmo.id}),ia&&E&&e.jsx(Yo,{clientThreadId:s,messages:A}),cs&&Me?e.jsx(ct,{message:Me,clientThreadId:s,onRequestCompletion:i,onExitEdit:Lt,disabled:Ke}):e.jsx(as,{allMessages:S,groupedMessagesToRender:fe,allGroupedMessages:b,...o,isUserTurn:E,isFinalUserTurn:Nt,isFinalAssistantTurn:Ut,isCompletionRequestInProgress:q,isFeedbackEnabled:le,isFinalTurn:n,hasActiveRequest:Ke,isAgentTurn:v,isKAUR1BR5:pe,query:ke?ss(ke):null,wasInterrupted:Cs,superWidgetImages:fs?.content.widgets.images??null,lastAgentMetadataNode:z,hideSearchGPTQuery:Ta}),_a&&(Ga&&Ia?e.jsx(Zo,{turnIndex:t,clientThreadId:s,variant:"bottom"}):e.jsx(vo,{handleShowRetrievalResults:Ds,clientThreadId:s,turnIndex:t,responseComplete:!ee})),Ca&&e.jsx(_o,{message:l,clientThreadId:s,turnIndex:t,referenceMessageId:l.id,responseComplete:!n||!q}),Fa&&e.jsx(Io,{clientThreadId:s}),Ye&&Ye.length>0&&!q&&e.jsx(So,{clientThreadId:s,examples:Ye}),Ee&&e.jsx(Mo,{isUserTurn:E,alwaysShow:!0,children:E?T?null:e.jsx(yo,{activeVariantIndex:ve,clientThreadId:s,numVariants:K.length,onAnticipateEdit:ct.prefetch,onChangeIndex:Ns,onEnterEdit:Vt,showCopyButton:Hs,showEditMessageButton:ba,showPagination:As,turnIndex:t}):e.jsxs(e.Fragment,{children:[e.jsx(Co,{activeVariantIndex:ve,clientThreadId:s,conversationMode:hs,lastMessage:l,messages:A,numVariants:K.length,onChangeIndex:Ns,onRate:Wt,showCanvasButton:Yt,showCopyButton:Hs,showPagination:As,showPlayButton:xa,showRatingButtons:le,showRegenerateButton:ja,turn:h,turnIndex:t,parentPrompt:We,isAgentTurn:v,isKAUR1BR5:pe}),e.jsx(Zs,{clientThreadId:s,message:l,turnIndex:t}),Ps&&e.jsx(wo,{canShowInlineMessageFeedback:gs,clientThreadId:s,messageForRating:l}),!1]})}),wa&&e.jsx(Eo,{clientThreadId:s}),Ea&&e.jsx(Ro,{clientThreadId:s,messages:A}),da&&e.jsx(Zs,{clientThreadId:s,message:l,turnIndex:t}),Ps&&e.jsx(ko,{canShowInlineMessageFeedback:gs,clientThreadId:s,messageForRating:l,allGroupedMessages:b,currentModelId:g}),e.jsx(Ba,{mode:"wait",children:ks&&e.jsx(Po,{lastUserMessageId:Q.id,setIsDismissed:ma})}),ua&&(se?e.jsx(Ao,{clientThreadId:s,connectorToUpsell:se,analyticsMetadata:ds}):e.jsx(jo,{followups:Ra,actionSuggestions:Pa,pineappleToolSuggestions:Aa,categorySuggestions:ka,clientThreadId:s,lastMessageId:Pe,analyticsMetadata:ds,isTatertotFollowupsEnabled:Ge}))]}),e.jsx(No,{clientThreadId:s,turn:h,isFinalTurn:n}),e.jsx(Uo,{clientThreadId:s,turn:h})]})})]})]})})}const si=({clientThreadId:o,turn:t,turnIndex:n,conversationTurnWrapperRef:s})=>{const i=Do();r.useEffect(()=>{if(!i)return;const g=new IntersectionObserver(m=>{m.forEach(d=>{d.isIntersecting?J(o,u=>{u.turnIdsInViewpoint=[...u.turnIdsInViewpoint??[],{turnId:t.id,turnIndex:n,role:t.role}]}):J(o,u=>{u.turnIdsInViewpoint=u.turnIdsInViewpoint?.filter(({turnId:c})=>c!==t.id)})})},{root:null,threshold:.1});return s.current&&g.observe(s.current),()=>{J(o,m=>{m.turnIdsInViewpoint=m.turnIdsInViewpoint?.filter(({turnId:d})=>d!==t.id)}),g.disconnect()}},[o,s,i,t.id,t.role,n])},mi=Va.memo(ei);function hi(){const[o,t]=Tt(i=>[Hn(i),vt(i)]),n=Ho(),s=Vo();return o&&!t&&!n&&!s}function pi({className:o,textClassName:t}){const n=De(),s=Ue(n),i=rs(()=>ts()),g=Vn.useStore(),m=Ln(),d=ls(n);function u(c){if(ts.set(c),c!=="answer"){const p=g.getActiveSystemHintType();p&&p!==ue.Search&&m(null)}}return d?s?e.jsx(qo,{selectedTab:i,selectTab:u,className:o,textClassName:t}):e.jsxs("div",{className:V("flex gap-8.5",o),children:[e.jsx(ce,{className:t,$selected:i==="answer",onClick:()=>u("answer"),children:e.jsx(H,{...ne.chatTab})}),e.jsx(ce,{className:t,$selected:i==="web",onClick:()=>u("web"),children:e.jsx(H,{...ne.linksTab})}),e.jsx(ce,{className:t,$selected:i==="images",onClick:()=>u("images"),children:e.jsx(H,{...ne.imagesTab})}),e.jsx(ce,{className:t,$selected:i==="videos",onClick:()=>u("videos"),children:e.jsx(H,{...ne.videosTab})}),e.jsx(ce,{className:t,$selected:i==="news",onClick:()=>u("news"),children:e.jsx(H,{...ne.newsTab})})]}):null}const ce=os.button`
  ${({$selected:o})=>o?"text-token-text-primary font-medium":"text-token-text-tertiary hover:text-token-text-secondary"}
`,ti={answer:()=>null,web:Wo,images:Mt,videos:St,news:It},ai={answer:()=>null,web:Bo,images:Mt,videos:St,news:It};function ni({userMessages:o,superWidgetMessageContents:t,tab:n,scrollToMessageId:s}){const i=De(),g=r.useRef({});function m(p,w="smooth"){const R=g.current[p];R&&R.scrollIntoView({behavior:w,block:"start"})}r.useEffect(()=>{requestAnimationFrame(()=>{if(o.length>0){const p=o[o.length-1];p&&m(p.id,"instant")}})},[]),r.useEffect(()=>{setTimeout(()=>{s&&m(s)},50)},[s]);const d=Ue(i),u=d?ai[n]:ti[n],c=n==="web"||n==="videos"||n==="news";return e.jsx("div",{className:V("flex w-full flex-col pt-2",d&&"thread-sm:px-2 px-4",c?"gap-4":"gap-10"),children:Lo(o.length,p=>e.jsxs("div",{className:"w-full",children:[p>0&&e.jsx("hr",{className:V("border-heavy w-full",d?"pb-4.5":"pb-1.5")}),e.jsx("div",{className:V(d?c?"mb-4":"mb-6":c?"mb-2.5":"mb-6","flex items-center text-base",d?"scroll-mt-6":"scroll-mt-4",p>0&&"mt-2.5"),ref:w=>{g.current[o[p].id]=w},children:e.jsx(oi,{userMessage:o[p],tab:n,isKirklandEnabled:d})}),t[p]?e.jsx(u,{content:t[p],turnIndex:p}):e.jsx("div",{style:ns(),children:e.jsx("div",{className:"result-streaming pulse",children:e.jsx("span",{})})})]},p))})}function oi({userMessage:o,tab:t,isKirklandEnabled:n}){const s=ss(o);return s?n?e.jsx($o,{queryText:s,tabType:t,searchIt:e.jsx(zo,{href:Ko(s,t)})}):e.jsx("div",{dir:"auto",className:"text-token-text-tertiary flex max-w-[var(--user-chat-width,70%)] min-w-0 text-start text-sm",children:e.jsx(H,{...ne.resultsFor,values:{prefix:i=>e.jsx("span",{className:"shrink-0",children:i}),query:e.jsx("span",{className:"min-w-0 flex-1 truncate",children:s}),trailingQuote:i=>e.jsx("span",{"aria-hidden":"true",className:"shrink-0",children:i})}})}):null}function fi({clientThreadId:o,children:t}){const n=De(),s=rs(()=>ts()),[i,g,m]=oe(o,d=>[y.getUserMessages(d).filter(u=>!u.metadata?.is_visually_hidden_from_conversation),y.getSuperWidgetMessages(d),d?.scrollToMessageId]);return ls(n)?e.jsxs("div",{children:[e.jsx("div",{id:"mini-chat-content",className:s==="answer"?"block":"hidden",children:t}),e.jsx(_t,{children:s!=="answer"&&e.jsx(ni,{userMessages:i,superWidgetMessageContents:g.map(d=>d.content),tab:s,scrollToMessageId:m},s)})]}):t}const ne=mt({chatTab:{id:"CSsJbp",defaultMessage:"Chat"},linksTab:{id:"U43uU/",defaultMessage:"Links"},imagesTab:{id:"ZY9oIP",defaultMessage:"Images"},videosTab:{id:"C8mH8+",defaultMessage:"Videos"},newsTab:{id:"RxIkHj",defaultMessage:"News"},resultsFor:{id:"V5ZXix",defaultMessage:"<prefix>Results for “</prefix>{query}<trailingQuote>”</trailingQuote>"}});export{mi as C,fi as S,pi as a,hi as u};
//# sourceMappingURL=mlqzrqe1i57m6im6.js.map
