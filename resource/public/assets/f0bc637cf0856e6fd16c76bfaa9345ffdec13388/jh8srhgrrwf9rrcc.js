import{r as w,e as Ce,R as Ze,a as et,f as q,j as e,b as tt,M as u}from"./m60bpb0x3x7rg8fj.js";import{cB as at,et as te,eu as A,ev as D,ew as z,ex as Q,cD as J,el as ae,ey as _e,ez as Z,eA as Ee,cy as Me,eB as we,eC as Ne,eD as je,eE as v,eF as k,aY as st,eG as nt,eH as ve,eI as G,eJ as _,eK as fe,eL as V,eM as pe,eN as Ae,eO as ke,eP as ot,eQ as xe}from"./ggjzadbnd3k1vu0k.js";import{e as H,aZ as se,aA as ye,aq as Le,b2 as Be,A as lt,g5 as rt,av as it,P as U,bb as ct,C as Se,aY as mt,i6 as Te,z as ee,c2 as K,i as Re,X as Fe,aa as ne,bF as dt}from"./lgw4q0e8zlqqfgug.js";import{c as Oe}from"./iej0cupg2dqkmejt.js";import{u as oe,P as ut}from"./ha73j9iy5pkvdx6y.js";import{u as gt}from"./fnje4v6gzdtvboh3.js";import{u as Ie}from"./jozqsyj8lvw2y89i.js";import{a as ht,b as ft,u as pt}from"./glu06a3y5u0laqff.js";const xt=Oe(J),yt=({promoData:r,initialPromoCoupon:i,initialSeats:b}={})=>{const P=H(),p=ae(),n=at(P),a=te()??i,{data:l}=oe(a??"");let h=r;!r&&l&&(h=l);const t=h?.coupon===A&&h.state==="eligible",d=h&&D(h.coupon)&&h.state==="eligible",s=typeof window<"u"?new URLSearchParams(window?.location.search):new URLSearchParams,c=s.get(z),x=s.get(Q),f=t?J.FLEXIBLE:x&&xt(x)?x:J.FLEXIBLE,[C,y]=w.useState(f),[S,g]=w.useState(b??(c&&!isNaN(parseInt(c,10))?parseInt(c,10):Math.max(n,p)));return{promoData:h,selectedPlan:C,setSelectedPlan:y,numSeats:S,setNumSeats:g,minTeamSeats:p,TEAM1DOLLAR_COUPON_IsEligible:t,TEAM_FREE_TRIAL_COUPON_IsEligible:d}};var Ue=(r=>(r.FLEXIBLE="month",r.ANNUAL="year",r))(Ue||{});const be=Oe(Ue),vt=r=>{const i=w.useRef(!1),b=Ce(),P=b.hash.split("#")[1]===_e||b.hash.split("#")[1]===Z,p=se(),n=!i.current&&P&&p&&!r,{country:a}=ht(),l=ft({country:a,currentAccount:p,location:"team-workspace-purchase-modal"}),h=te(),{data:t,isLoading:d}=oe(h??"");H();const s=ae(),c=Ze.useRef(void 0);w.useEffect(()=>{n&&(ye.setPurchaseWorkspaceData({minimumSeats:s,billingDetails:l,promoData:t}),i.current=!0)},[p,l,s,P,r,h,t,n]),w.useEffect(()=>{const x=c.current;c.current=d,!(d||!i.current)&&x&&ye.setPurchaseWorkspaceData({minimumSeats:s,billingDetails:l,promoData:t})},[t,d,s,l])},Pe=dt.p`text-base font-medium mb-3`,De=({isOpen:r,onClose:i,onSubmit:b,minimumSeats:P,billingDetails:p,isDirectFlow:n=!1,promoData:a=void 0})=>{const l=se(),{trackSelectedPixels:h}=gt({key:lt.SELF_SERVE_BUSINESS}),{selectedPlan:t,setSelectedPlan:d,numSeats:s,setNumSeats:c,minTeamSeats:x,TEAM1DOLLAR_COUPON_IsEligible:f,TEAM_FREE_TRIAL_COUPON_IsEligible:C}=yt({promoData:a}),[y,S]=w.useState(!1),g=q(),m=p.currency,T=Math.max(P,x),{flexibleBillingPlan:E,annualBillingPlan:le}=we(m);let N=E,re=null;if(f||C){re=a?.coupon===A?Ne(m):je(m);let o,M;f?(o={...m===rt?v.team1dollarMonthlyCostINR:v.team1dollarMonthlyCost},M={...v.team1dollarMonthlyStructure,defaultMessage:`Then ${g.formatMessage(N.currencySign)}${N.monthlyCost} seat/mo after 1 month`,id:"promo.team1dollar.monthlyPlanStructure",description:"Subsequent pricing description for team1dollar promo. Describing the monthly then the annual price after."}):(o={...k.teamFreeTrialMonthlyCost},M={...k.teamFreeTrialMonthlyStructure,defaultMessage:`Then ${g.formatMessage(N.currencySign)}${N.monthlyCost} seat/mo after 1 month`,id:"promo.teamFreeTrial.monthlyPlanStructure",description:"Subsequent pricing description for teamFreeTrial promo. Describing the monthly then the annual price after."}),N={...N,cost:o,costStructure:M,discountedMonthlyCost:re??N.discountedMonthlyCost}}const L=a?.coupon===A,He=a&&D(a?.coupon),O=L||He,ie=a?.state==="not_eligible"&&O,ce=a?.state==="temporary_disabled"&&O,We=a?.state==="offline"&&O,B=st(isNaN(s)?0:s,T,nt),R=w.useMemo(()=>l?.subscriptionAnalyticsParams,[l]),W=it(o=>o.purchaseWorkspaceData);w.useEffect(()=>{const o=W?.referrer??document.referrer;U.logEvent("Account Pay: Select Team Plan Modal Show",{...R,referrer:o})},[R,W?.referrer]);const me=o=>{switch(o){case"month":U.logEvent("Account Pay: Team Plan Selection Clicked",{...R,buttonType:"Continue",numberOfSeats:s,planLength:xe.MONTHLY});break;case"year":U.logEvent("Account Pay: Select Team Plan Modal Clicked",{...R,buttonType:"Continue",numberOfSeats:s,planLength:xe.ANNUAL});break}},$e=(o,M)=>{U.logEventWithStatsig("Account Pay: Select Team Plan Modal Clicked","chatgpt_select_team_plan_modal_continue_to_billing_clicked",{...R,buttonType:"Continue",numberOfSeats:M,planLength:o}),ne.addAction("chatgpt_funnel.team_plan_modal_checkout_initiated",{planLength:o,numberOfSeats:M.toString(),accountId:l?.id}),a?.state==="eligible"&&O&&ut.logCouponApplied(a.coupon)},Ye=()=>{U.logEvent("Account Pay: Select Team Plan Modal Dismiss",R)},j=Ce(),$=w.useMemo(()=>j.hash.split("#")[1]===Z,[j.hash]);w.useEffect(()=>{const o=new URLSearchParams;o.set(z,B.toString()),o.set(Q,t),o.set("referrer",W?.referrer??document.referrer);const M=a?.coupon&&a.coupon!==ve?a.coupon:null;M&&o.set(G,M);const he=n||$?`#${Z}`:`#${_e}`,Ge=`${j.pathname}?${o.toString()}${he}`,Y=new URL(window.location.href).searchParams,Ke=Y.get(z)===B.toString(),ze=Y.get(Q)===t,Qe=M==null&&!Y.has(G)||Y.get(G)===M,Je=window.location.hash===he;(!Ke||!ze||!Qe||!Je)&&window.history.pushState({from:j.pathname+j.search},"",Ge)},[B,n,$,j.pathname,j.search,j.hash,t,a?.coupon,W?.referrer]);let I;ie?I=L?v.team1dollarNotEligible:k.teamFreeTrialNotEligible:ce?I=L?v.team1dollarTemporarilyDisabled:k.teamFreeTrialTemporarilyDisabled:I=L?v.team1dollarOffline:k.teamFreeTrialOffline;const de=ie||ce||We,ue=async()=>{S(!0),$e(t,B),h(),await b(t,B),S(!1)},Ve=()=>{i(),Ye()},qe=H(),X=!(n||$)&&ct(qe,"2307162844").get("enabled",!1),ge=e.jsx(St,{numSeats:B,selectedPlan:t,billingDetails:p,totalLabel:_.allPlansTodayTotal,billDate:e.jsx(u,{..._.today}),promoData:a}),F=f||C;if(n||$||X)return e.jsx(Se,{testId:"modal-workspace-purchase",type:"success",isOpen:r,onClose:i,size:"fullscreen",noPadding:!0,removePopoverStyling:!0,showCloseButton:!0,children:e.jsxs("div",{className:"grid grid-flow-row grid-cols-1 md:h-full md:grid-cols-2",children:[e.jsx("div",{className:"flex-column col-span-1 flex justify-center p-5 md:grid-cols-2",children:e.jsxs("div",{className:"flex w-full max-w-[400px] flex-col items-center md:max-w-[600px]",children:[e.jsx(mt,{className:"mt-8 mb-6 h-8 w-8 md:fixed md:start-4 md:top-4 md:mt-0 md:h-6 md:w-6"}),de&&e.jsx("div",{className:"mb-4 w-full","data-testid":"team-promo-banner",children:e.jsx(Te,{content:g.formatMessage(I),type:"info"})}),e.jsx("div",{className:"mb-8 text-3xl font-medium md:mt-[120px]",children:e.jsx(u,{id:"selectTeamPlanModal.title",defaultMessage:"Pick your plan"})}),e.jsxs(fe,{className:ee("col-span-3 mb-6 grid w-full gap-4 md:col-span-2 md:grid-cols-2"),defaultValue:t,onValueChange:o=>{be(o)&&(d(o),me(o))},children:[e.jsx(V,{billingType:"year",...le,selectedValue:t,hideSavingsMessage:F,hideDetails:!X}),e.jsx(V,{billingType:"month",...N,selectedValue:t,hideDetails:!X,hideSavingsMessage:F,showWelcomeOfferLabel:F})]}),e.jsx(pe,{numSeats:s,minSeats:T,setNumSeats:c}),e.jsx("div",{className:"text-token-text-secondary self-start text-xs",children:g.formatMessage({id:"selectTeamPlanModal.seatsDescription",defaultMessage:"Add more seats at any time. Minimum of {minSeats} seats."},{minSeats:x})})]})}),e.jsx("div",{className:"col-span-3 flex h-full flex-col items-center overflow-hidden p-6 md:col-span-1 md:shadow-lg",children:e.jsxs("div",{className:"flex w-full max-w-[400px] flex-col md:mt-[120px]",children:[e.jsx(Pe,{className:"mb-8 text-xl font-medium",children:e.jsx(u,{..._.summaryTitle})}),ge,e.jsx(K,{title:g.formatMessage(_.continueToBillingButton),onClick:ue,loading:y,color:"green",className:"mt-8 w-full rounded-xl"}),e.jsx(K,{title:g.formatMessage(_.cancel),onClick:Ve,color:"ghost",className:"mt-4 w-full rounded-xl"})]})})]})});const Xe=L?Ae:ke;return e.jsxs(Se,{testId:"modal-select-team-plan",type:"success",isOpen:r,onClose:i,size:"custom",noPadding:!0,removePopoverStyling:!0,className:"max-w-4xl",showCloseButton:!0,hasSeparator:!0,title:g.formatMessage(_.selectTeamPlanModalTitle),children:[de&&e.jsx("div",{className:"px-5 pt-4","data-testid":"team-promo-banner",children:e.jsx(Te,{content:g.formatMessage(I),type:"info"})}),e.jsxs("div",{className:"grid grid-flow-row grid-cols-3",children:[e.jsxs("div",{className:"flex-column col-span-3 p-5 md:col-span-2 md:grid-cols-2",children:[e.jsx(pe,{numSeats:s,minSeats:T,setNumSeats:c}),O&&a?.state==="eligible"&&t==="month"&&s>Xe&&e.jsx("div",{className:"text-token-text-secondary mt-1 self-start text-xs","data-testid":"team-promo-overseats-disclaimer",children:e.jsx(u,{...L?v.team1dollarOverSeatsDisclaimer:k.teamFreeTrialOverSeatsDisclaimer})}),e.jsxs(fe,{className:ee("col-span-3 mt-5 grid gap-4 md:col-span-2 md:grid-cols-2"),defaultValue:t,onValueChange:o=>{be(o)&&(d(o),me(o))},children:[e.jsx(V,{billingType:"year",...le,selectedValue:t,hideSavingsMessage:F}),e.jsx(V,{billingType:"month",...N,selectedValue:t,hideSavingsMessage:F,showWelcomeOfferLabel:F})]})]}),e.jsxs("div",{className:"border-token-main-surface-tertiary bg-token-bg-elevated-secondary col-span-3 flex h-full flex-col overflow-hidden border-s p-6 md:col-span-1",children:[e.jsx(Pe,{children:e.jsx(u,{..._.summaryTitle})}),ge,e.jsx(K,{title:g.formatMessage(_.continueToBillingButton),onClick:ue,loading:y,color:"primary",className:"mt-8 w-full rounded-xl"})]})]})]})},St=({numSeats:r,selectedPlan:i,billingDetails:b,totalLabel:P,billDate:p,promoData:n,extraDiscountAmount:a})=>{const l=q(),{flexibleBillingPlan:h,annualBillingPlan:t}=we(b.currency),d=h,s=i==="month"?d:t,c=ot[i],x=(r||0)*(i==="year"?t.monthlyCost*12:d.monthlyCost);let f=(r||0)*s.unitCost,C=x-f,y=0,S=x,g=!1;if(n!=null&&(n.coupon===A||D(n.coupon))&&n.state==="eligible"&&i==="month"){g=!0;const T=n?.coupon===A?Ne(b.currency):je(b.currency),E=n?.coupon===A?Ae:ke;r<=E?(y=T,S=r*d.monthlyCost,C=S-y,f=y):(y=T+(r-E)*d.monthlyCost,S=r*d.monthlyCost,C=S-y,f=y)}a&&a>0&&(C+=a,f=Math.max(f-a,0));let m;return n!=null&&D(n.coupon)&&n.coupon!==ve&&n.state==="eligible"&&i==="month"&&(m={title:{id:"promo.teamFreeTrial.temporaryCardHold",defaultMessage:"Temporary card hold",description:"Label for the temporary card hold line item in the billing summary"},description:{id:"promo.teamFreeTrial.temporaryCardHoldDescription",defaultMessage:"Used to verify payment â€” we'll refund it",description:"Description for the temporary card hold line item in the billing summary"},amount:1},f+=1),e.jsxs("div",{className:"flex grow flex-col text-sm",children:[e.jsxs("div",{className:"text-token-text-secondary flex w-full justify-between text-sm",children:[e.jsx("div",{className:"flex",children:e.jsx(u,{...c.name})}),e.jsx("div",{className:"flex",children:e.jsx(u,{..._.allPlansPreDiscountTotal,values:{currencySign:l.formatMessage(s.currencySign),preDiscountTotalAmount:x.toLocaleString()}})})]}),e.jsxs("div",{className:"text-token-text-tertiary flex w-full justify-between text-xs",children:[e.jsx("div",{className:"flex",children:e.jsx(u,{...c.breakdown,values:{numSeats:r}})}),e.jsx("div",{className:"flex",children:e.jsx(u,{..._.breakdownAmount,values:{currencySign:l.formatMessage(s.currencySign),amount:s.monthlyCost}})})]}),m&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-token-text-secondary mt-3 flex w-full justify-between text-sm",children:[e.jsx("div",{className:"flex",children:e.jsx(u,{...m.title})}),e.jsx("div",{className:"flex",children:e.jsx(u,{id:"promo.teamFreeTrial.temporaryCardHoldAmount",defaultMessage:"{currencySign}{amount}",description:"Amount for the temporary card hold line item (e.g., $1). Keep the currency sign and numeric amount placeholders; translators may reorder them per locale.",values:{currencySign:l.formatMessage(s.currencySign),amount:m.amount.toLocaleString()}})})]}),m.description&&e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(u,{...m.description})})]}),e.jsxs("div",{className:"text-token-text-secondary mt-3 flex w-full justify-between text-sm",children:[e.jsx("div",{className:"flex",children:e.jsx(u,{..._.planDiscountLabel})}),e.jsx("div",{className:ee("flex",C>0&&"font-medium text-[#10A37F]"),children:e.jsx(u,{...c.discountAmount,values:{currencySign:l.formatMessage(d.currencySign),discountAmount:C.toLocaleString()}})})]}),n!=null&&(n.coupon===A||D(n.coupon))&&n.state==="eligible"&&i==="month"&&e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(u,{...n?.coupon===A?v.team1dollarBelowDiscount:k.teamFreeTrialBelowDiscount})}),c.discountDescription&&t.discountedMonthlyCost<t.monthlyCost&&i==="year"&&e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(u,{...c.discountDescription,values:{discountPercentage:Math.floor((1-t.discountedMonthlyCost/t.monthlyCost)*100)}})}),e.jsx("hr",{className:"border-token-border-default my-3"}),e.jsxs("div",{className:"flex w-full justify-between text-base font-medium",children:[e.jsx("div",{className:"flex",children:e.jsx(u,{...P})}),e.jsx("div",{className:"flex",children:g?e.jsxs(e.Fragment,{children:[l.formatMessage(s.currencyCode)," ",l.formatMessage(s.currencySign),f.toLocaleString()]}):e.jsx(u,{...c.total,values:{currencyCode:l.formatMessage(s.currencyCode),currencySign:l.formatMessage(s.currencySign),totalAmount:f.toLocaleString()}})})]}),e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx("div",{className:"text-token-text-tertiary mt-2 text-xs",children:g?e.jsx(u,{id:"ngnBJG",defaultMessage:"After promotional period {currencySign}{amount} per month",values:{currencySign:l.formatMessage(d.currencySign),amount:S.toLocaleString()}}):e.jsx(u,{...c.billed,values:{billDate:p}})})})]})};function At(){const r=se(),i=et(),{prepareCheckoutSession:b,navigateToCheckout:P}=Ie(),p=H(),n=ae(),{initialBillingDetails:a}=pt(r,!0),l=q(),h=Le(),t=Ee(l,void 0,h),d=Be(),s=te(),{data:c}=oe(s??""),{eligible:x,campaignId:f}=Me(),y=c??(!s&&x?{coupon:f,state:"eligible"}:void 0),S=async(m,T)=>{if(!Re(p)){Fe(p,{fallbackScreenHint:"login",callbackUrl:window.location.href});return}try{const E=await b({plan_name:"chatgptteamplan",team_plan_data:{workspace_name:t,price_interval:m,seat_quantity:T},billing_details:a,promo_campaign:m==="month"?y?.coupon:null});await P(E)}catch(E){ne.addError(E),d.warning(l.formatMessage(_.paymentErrorWarning),{hasCloseButton:!0})}},g=()=>{i("/")};return e.jsx(De,{isOpen:!0,onClose:g,onSubmit:(m,T)=>S(m,T),isDirectFlow:!0,minimumSeats:n,billingDetails:a,promoData:y})}const kt=({isOpen:r,onClose:i,minimumSeats:b,billingDetails:P,existingAccount:p=void 0,promoData:n=void 0})=>{const a=q(),l=Be(),h=Le(),{prepareCheckoutSession:t,navigateToCheckout:d}=Ie(),s=H(),[c]=tt(),x=c.get("from_webview")==="ios",f=Ee(a,p,h),{eligible:C,campaignId:y}=Me(),S=n??(C?{coupon:y,state:"eligible"}:void 0),g=async(m,T)=>{if(!Re(s)){Fe(s,{fallbackScreenHint:"login",callbackUrl:window.location.href});return}try{const E=await t({plan_name:"chatgptteamplan",team_plan_data:{workspace_name:f,price_interval:m,seat_quantity:T,existing_workspace_id:p?.id},billing_details:P,cancel_url:window.location.href,promo_campaign:m==="month"?S?.coupon:null},{fromiOSWebview:x});await d(E)}catch(E){ne.addError(E),l.warning(a.formatMessage(_.paymentErrorWarning),{hasCloseButton:!0})}};return e.jsx(De,{isOpen:r,onClose:i,onSubmit:(m,T)=>g(m,T),minimumSeats:b,billingDetails:P,promoData:S})};export{St as B,At as T,vt as a,kt as b,yt as u};
//# sourceMappingURL=jh8srhgrrwf9rrcc.js.map
