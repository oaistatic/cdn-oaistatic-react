import{f as Z,j as t,d as X,r as _,M as T,u as nt,v as Le,p as A,b as at}from"./m60bpb0x3x7rg8fj.js";import{D as ot,B as D,bF as W,sE as it,g as Ie,du as Re,ar as Be,dL as Oe,el as rt,cU as lt,e3 as ct,h9 as Ve,dK as dt,i1 as mt,fa as ut,mm as ft,gb as gt,sF as pt,sG as ht,fj as xt,sH as yt,fl as _t,jQ as bt,cr as ye,dS as G,ds as vt,e as jt,a_ as wt,dT as kt,aE as Ct,sI as Mt,z as Nt,bc as Ce,T as St,sJ as Tt,aa as Pt,fc as K,aC as ve,h0 as Ft,R as At,kk as Dt,ap as Et,ez as zt,pN as Me,ha as Lt,ky as It,bU as Rt,hY as Bt,dI as Ot,cW as Vt,nh as $t,sK as Gt,dC as Wt,d0 as Ut,hj as qt,b8 as Ht,bH as Kt,q8 as Qt}from"./lgw4q0e8zlqqfgug.js";import{L as _e,i as Yt,a as Jt}from"./hs2mcew9gnq8d8k8.js";import{f3 as $e,kc as Zt,Y as Xt,kV as le,jW as es,p$ as ts,aO as ss,q0 as ns,q1 as as,ha as os,ca as N,aU as is,c9 as Ne,fK as Ge,bE as We,i8 as rs}from"./ggjzadbnd3k1vu0k.js";import{S as ls}from"./fxwiivjy9rf81dg2.js";import{S as cs}from"./795byvwofdax2f6d.js";import{b as Se}from"./g61ghrdmm0y010eo.js";import{M as ds,E as ms}from"./ns51nblw8ziscsgd.js";const us=W.div`h-px bg-token-border-default`,R=W.div`text-sm font-medium py-3 leading-6`,fs=W.div`my-4 p-5 w-full rounded-2xl popover bg-token-main-surface-primary shadow-lg border border-token-border-default`,he=":",gs=({to:e,cc:s,bcc:n,subject:a,body:o,onClick:i,isDraft:r=!0,isCanceled:m=!1})=>{const u=Z(),d=[];return e&&d.push(t.jsx("div",{children:t.jsxs("div",{className:"flex",children:[t.jsxs(R,{className:"text-token-text-tertiary me-1",children:[u.formatMessage($.draftToFieldLabel),he]}),t.jsx(R,{children:e})]})},"to")),s&&d.push(t.jsx("div",{children:t.jsxs("div",{className:"flex",children:[t.jsxs(R,{className:"text-token-text-tertiary me-1",children:[u.formatMessage($.draftCcFieldLabel),he]}),t.jsx(R,{children:s})]})},"cc")),n&&d.push(t.jsx("div",{children:t.jsxs("div",{className:"flex",children:[t.jsxs(R,{className:"text-token-text-tertiary me-1",children:[u.formatMessage($.draftBccFieldLabel),he]}),t.jsx(R,{children:n})]})},"bcc")),a&&d.push(t.jsx(R,{children:a},"subject")),o&&d.push(t.jsx(R,{className:"whitespace-pre-line",children:o},"body")),t.jsxs(fs,{children:[t.jsxs("div",{className:"mb-4 flex items-center",children:[t.jsx(ot,{className:"icon-sm me-4"}),t.jsx("div",{className:"font-semibold",children:r?u.formatMessage($.draftMessageLabel):u.formatMessage($.sentMessageLabel)})]}),d.map((g,y)=>t.jsxs(_.Fragment,{children:[t.jsx(us,{}),g]},y)),r&&!m&&t.jsx("div",{className:"mt-2 flex justify-end gap-4",children:t.jsx(D,{color:"primary",className:"py-2",onClick:i,children:u.formatMessage($.sendButton)})}),m&&t.jsx("div",{className:"mt-2 flex justify-end gap-4",children:t.jsx(D,{color:"primary",className:"py-2",disabled:!0,children:u.formatMessage($.canceledButton)})})]})},$=X({draftMessageLabel:{id:"emailView.draftMessageLabel",defaultMessage:"Draft Message"},sentMessageLabel:{id:"emailView.sentMessageLabel",defaultMessage:"Sent Message"},sendButton:{id:"emailView.sendButton",defaultMessage:"Send"},draftToFieldLabel:{id:"emailView.draftToLabel",defaultMessage:"To"},draftCcFieldLabel:{id:"emailView.draftCcLabel",defaultMessage:"Cc"},draftBccFieldLabel:{id:"emailView.draftBccLabel",defaultMessage:"Bcc"},canceledButton:{id:"emailView.canceledButton",defaultMessage:"Canceled"}});function ps({action:e,handleUserAction:s,userActionParams:n,displayParams:a,rememberAnswer:o}){return e.type==="deny"?t.jsx(D,{color:"secondary",size:"small",onClick:i=>{s({sourceEvent:i,...n,actionData:{type:"deny",...e.deny,remember_answer:o}})},children:t.jsx(T,{...e.name==="decline"?B.decline:B.deny})}):e.type==="allow"?t.jsx(D,{color:"primary",size:"small",onClick:i=>{s({sourceEvent:i,...n,actionData:{type:"allow",...e.allow,remember_answer:o}})},children:t.jsx(T,{...e.name==="allow"?B.allow:B.confirm})}):e.type==="always_allow"?t.jsx(D,{color:"secondary",size:"small",onClick:i=>{s({sourceEvent:i,...n,actionData:{type:"always_allow",...e.always_allow}})},children:t.jsx(T,{...B.alwaysAllow})}):e.type==="oauth_redirect"?t.jsx(D,{color:"primary",size:"small",onClick:()=>{xs(e.oauth_redirect,n.clientThreadId,n.turnGizmo)},children:t.jsx(T,{...B.signInButton,values:{domain:a.domain}})}):e.type==="contact_gizmo"?t.jsx(D,{color:"secondary",size:"small",onClick:i=>{s({sourceEvent:i,...n,actionData:{type:"contact_gizmo",...e.contact_gizmo}})},children:t.jsx(T,{...B.allow})}):null}function hs({connector:e,onClick:s}){const n=Z();return e&&t.jsxs("div",{className:"flex w-80 flex-col items-center rounded-xl border p-6 text-center",children:[t.jsx($e,{connector:e,size:"large",className:"bg-primary shadow-xxs max-h-fit rounded-2xl border bg-clip-padding p-2"}),t.jsx("div",{className:"text-token-text-primary mt-3 text-lg font-semibold",children:it(e.name,n)}),t.jsx("div",{className:"text-token-text-secondary mt-1 text-sm",children:e.description}),t.jsx(D,{className:"mt-4 w-full",color:"secondary",onClick:s,children:t.jsx(T,{...B.connectButton})})]})}function xs(e,s,n){const a=Ie(s),o=Re(s),i=a?.mode?.kind===Be.GizmoTest,r=o&&!i?Oe(o,n):window.location.href;e.gizmo_id==="FAKE_PLUGIN_GIZMO"?rt({id:e.gizmo_action_id},r):lt.doOAuthRedirect(e.gizmo_id,e.gizmo_action_id,e.domain,r,i)}const B=X({alwaysAllow:{id:"jitPluginMessage.alwaysAllow",defaultMessage:"Always Allow"},allow:{id:"jitPluginMessage.allow",defaultMessage:"Allow"},decline:{id:"jitPluginMessage.decline",defaultMessage:"Decline"},confirm:{id:"jitPluginMessage.confirm",defaultMessage:"Confirm"},deny:{id:"jitPluginMessage.deny",defaultMessage:"Deny"},signInButton:{id:"jitPluginMessage.signInButton",defaultMessage:"Sign in with {domain}"},connectButton:{id:"jitPluginMessage.connectButton",defaultMessage:"Connect"}});function ys({functionName:e,params:s,result:n,isWrite:a}){const o=ct(),i=Ve(),{namespace:r,actionName:m}=_s(e);if(r==="api_tool"&&m==="call_tool"&&s&&"path"in s&&"args"in s&&typeof s.path=="string"&&(typeof s.args=="object"||typeof s.args=="string")&&s.args!=null){const[u,d,g]=s.path.split("/").filter(Boolean);if(u&&d&&g){const y=[...o.connectorLinks.values()].flat().find(w=>w.id===d),l=y&&i.platformConnectors.get(y.connector_id);return t.jsx(Te,{connector:{name:l?.name??u,logo_url:l?.logo_url??null},actionName:g,isWrite:a,params:typeof s.args=="object"?s.args:JSON.parse(s.args),result:n})}}return t.jsx(Te,{connector:{name:r,logo_url:null},actionName:m,isWrite:a,params:s,result:n})}function _s(e){const s=e.indexOf("."),n=s===-1?e:e.slice(0,s),a=s===-1?"":e.slice(s+1);return{namespace:n,actionName:a}}function Te({connector:e,actionName:s,params:n,result:a,isWrite:o}){return t.jsxs("div",{className:"border-token-border-default bg-token-bg-default mt-1 mb-4 grid max-w-xl gap-4 rounded-xl border p-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx($e,{connector:{name:e.name,logo_url:e.logo_url},size:"large"}),t.jsxs("div",{className:"flex flex-1 flex-col",children:[t.jsx("div",{className:"text-token-text-secondary text-xs",children:e.name}),t.jsx("div",{className:"text-token-text-primary text-sm",children:s})]}),o&&t.jsx("div",{className:"border-token-text-quartenary text-token-text-secondary dark:border-token-border-heavy dark:text-token-text-tertiary items-center rounded-full border px-1 py-0.5 text-[8px] leading-3 font-semibold uppercase",children:t.jsx(T,{id:"APIToolCallCard.write",defaultMessage:"Write"})})]}),n!=null&&t.jsx(Pe,{isInitialLevelExpanded:o,name:Fe.request,params:n}),a!=null&&t.jsx(Pe,{name:Fe.response,params:a}),o&&t.jsxs("div",{className:"text-token-text-secondary text-sm",children:[t.jsx(dt,{className:"icon-sm me-1 mb-0.5 inline-block"}),t.jsx(T,{id:"APIToolCallCard.writeWarning",defaultMessage:"Write actions come with risks. <link>Learn more</link>",values:{link:i=>t.jsx("a",{href:"https://platform.openai.com/docs/mcp#risks-and-safety",className:"underline underline-offset-2",target:"_blank",rel:"noopener noreferrer",children:i},"link")}})]})]})}function Pe({name:e,params:s,isInitialLevelExpanded:n=!1}){const a=Z();return t.jsxs("div",{className:"bg-token-bg-secondary/30 max-w-full min-w-0 space-y-3 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-center justify-between gap-3",children:[t.jsx("div",{className:"text-token-text-secondary text-xs",children:a.formatMessage(e)}),t.jsx(Zt,{buttonText:!0,className:"text-token-text-secondary text-xs",onCopy:()=>Xt(typeof s=="string"?s:JSON.stringify(s))})]}),typeof s=="string"?t.jsx("div",{className:"text-token-text-primary line-clamp-3 font-mono text-sm",children:s}):t.jsx(_e,{isInitialLevelExpanded:n,value:s})]})}const Fe=X({request:{id:"APIToolCallCard.request",defaultMessage:"Request"},response:{id:"APIToolCallCard.response",defaultMessage:"Response"}}),bs=e=>{const{r:s,g:n,b:a}=Se.toRGBA(Se.parse(e));return(s*299+n*587+a*114)/1e3<125};function Ue(e){return e.modelPreferences?.hints?.[0]?.name||"unknown-model"}function qe(e,s,n){const a=window.location.origin+"/backend-api/ecosystem/completion",o=new AbortController,i=mt(a,{ctx:ut(),method:"POST",body:{method:"sampling/createMessage",params:{messages:e.messages,modelPreferences:e.modelPreferences,systemPrompt:e.systemPrompt,metadata:{...e.metadata??{},app_uri:s}}},signal:o.signal,accessToken:n});return{stream:vs(ft(i)),controller:o}}async function*vs(e){for await(const s of e)s&&typeof s=="object"&&"data"in s&&s.data&&typeof s.data=="object"&&"content"in s.data&&(yield s.data.content)}async function*js(e,s,n){const a=Ue(e),{stream:o,controller:i}=qe(e,s,n);try{for await(const r of o)r.type==="text"&&(yield{content:{type:"text",text:r.text},model:a,role:"assistant"})}finally{try{i.abort("Widget canceled reading completion stream")}catch{}}}async function ws(e,s,n){const a=Ue(e),{stream:o,controller:i}=qe(e,s,n);try{let r="";for await(const m of o)m.type==="text"&&(r=m.text);return{content:{type:"text",text:r},model:a,role:"assistant"}}finally{try{i.abort("Widget canceled reading completion call stream")}catch{}}}const ks=()=>{let e="unknown";return gt()?e="mobile":pt()?e="tablet":ht()&&(e="desktop"),{device:{type:e},capabilities:{hover:yt(),touch:xt()}}},Cs=(e,s)=>"?"+["",`app=${e}`,`locale=${s}`].filter(Boolean).join("&"),Ms=({host:e="chatgpt",isInert:s=!1,title:n,ref:a,api:o,locale:i})=>{const[r]=_.useState(()=>_t(null)),m=le(async(y,...l)=>(await bt(()=>!!r()),ye(r()?.[y],`Method ${String(y)} not found`)(...l))),u=G(()=>r());_.useImperativeHandle(a,()=>new Proxy({},{get:(y,l)=>(...w)=>m(l,...w)}),[m,u]);const d=le((y,...l)=>{const w=o[y];if(!w){console.warn("HostAPI method not found",y);return}return w(...l)}),g=le(y=>y?(Yt(y,{drawBoundingBoxes:(...l)=>d("drawBoundingBoxes",...l),notifyBackgroundColor:(...l)=>d("notifyBackgroundColor",...l),notifyIntrinsicHeight:(...l)=>d("notifyIntrinsicHeight",...l),sendInstrument:(...l)=>d("sendInstrument",...l),getDownloadURL:(...l)=>d("getDownloadURL",...l),callTool:(...l)=>d("callTool",...l),streamCompletion:async function*(...w){yield*d("streamCompletion",...w)},callCompletion:(...l)=>d("callCompletion",...l),notifySecurityPolicyViolation:(...l)=>d("notifySecurityPolicyViolation",...l),notifyEnvironmentError:(...l)=>d("notifyEnvironmentError",...l),updateWidgetState:(...l)=>d("updateWidgetState",...l),sendFollowUpMessage:(...l)=>d("sendFollowUpMessage",...l),requestDisplayMode:(...l)=>d("requestDisplayMode",...l),notifyNavigation:(...l)=>d("notifyNavigation",...l)},["runUserCode","runWidgetCode"]).then(l=>{r.set(l)}),()=>{r.set(null)}):r.set(null));return t.jsx(vt,{children:t.jsx("iframe",{title:n,inert:s,src:`${Jt}/index.html${Cs(e,i)}`,ref:g,sandbox:"allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox allow-forms",className:"h-full w-full max-w-full"},"sandbox")})},Ns={insets:{top:0,bottom:0,left:0,right:0}},Ss=({host:e,ref:s,html:n,accessToken:a,safeArea:o=Ns,widgetId:i,widgetParent:r,widgetState:m=null,toolInput:u=null,toolOutput:d=null,maxHeight:g,theme:y,title:l,api:w,locale:Q,displayMode:b="inline",onReady:E})=>{const F=_.useRef(null);_.useEffect(()=>{(async()=>{if(!n||!i)return;const O=F.current?.runWidgetCode({html:n,widgetId:i,widgetState:m,toolInput:u,toolOutput:d,maxHeight:g,theme:y,displayMode:b,safeArea:o,userAgent:ks(),csp:null});if(O)for await(const P of await O)P.type===ds.ENVIRONMENT_STATUS&&P.status===ms.RUNNING_CODE&&E?.()})()},[n]);const k=le(j=>{F.current?.setAdditionalGlobals({additionalGlobals:j})});return _.useEffect(()=>{i&&F.current?.setWidgetProps({widgetId:i,widgetState:m,toolInput:u,toolOutput:d})},[k,i,m,u,d]),_.useEffect(()=>{k({maxHeight:g})},[k,g]),_.useEffect(()=>{k({displayMode:b})},[k,b]),_.useEffect(()=>{k({safeArea:o})},[k,o]),t.jsx(Ms,{title:l,host:e,api:{...w,streamCompletion:async function*(j){yield*js(j,ye(r),a)},callCompletion:async function(j){return await ws(j,ye(r),a)}},ref:es(F,s),locale:Q})},Ts=({messages:e,clientThreadId:s,onRequestCompletion:n})=>{const a=ts(e),[o,i]=_.useState(null),r=jt(),{locale:m}=wt(r),u=_.useRef(null),d=p=>{const M=St.getRequestId(Ie(s));if(!Tt(M)){if(!p.prompt){Pt.addError("No prompt provided to sendFollowUpMessage");return}n({completionType:Ft.Next,promptMessage:{id:Le(),author:{role:ve.User,name:"user"},content:{content_type:K.Text,parts:[p.prompt]},recipient:"all",metadata:{is_visually_hidden_from_conversation:!0}},eventSource:"mouse"})}},{html_asset_pointer:g,resolved_pineapple_uri:y,rendered_template:l}=a.metadata,{data:w}=nt({queryKey:["htmlAsset",g],queryFn:()=>g&&At.safeGet("/kanzi/__internal__/app/html_asset",{parameters:{query:{file_id:g,uri:y}}}),enabled:!!g}),Q=w??l,b=ss(kt(r,s)),E=G(()=>b.title$()),F=G(()=>b.isPinned$(a)),k=G(()=>b.isPinOrigin$(a)),j=G(()=>b.isPinOrigin$(a)?b.displayMode$():"inline"),[O,P]=_.useState(!1),L=(p,M)=>(P(!0),ns({forceFlushSync:!0,className:as["pinned-widget"],update:()=>{b.setDisplayMode$(a,p,M)}}).finished.then(()=>{P(!1)}),{mode:p}),{widgetParent:ee,widgetType:U}=a,{toolInput:h,toolOutput:v,widgetState:de}=G(()=>b.getWidgetStateAndPropsForMessage$(a)),te=G(()=>b.getActiveContent$(a).widgetId),se=Ct(({windowHeight:p})=>j==="pip"?p/2:j==="fullscreen"?p-164:p),[ne,me]=_.useState(!1),[ae,ue]=_.useState(!1),[fe,V]=_.useState(!1),[ge,q]=_.useState(!1),C=Mt(),oe=_.useMemo(()=>({insets:{top:0,bottom:0,left:0,right:0}}),[]);if(F&&!k)return null;const z=j==="fullscreen",Y=p=>{z||O||(i(p),b.setPinnedWidgetHeight(p))},I=t.jsxs("div",{className:Nt("no-scrollbar overflow-hidden rounded-2xl shadow-[0px_0px_0px_1px_var(--border-heavy),0px_4px_10px_rgba(0,0,0,0.06)] transition-[opacity,transform] duration-500 ease-out sm:rounded-3xl",ge&&"dark",O&&"[view-transition-name:pinned-kanzi-widget]",!k&&"relative my-2",j==="inline"&&"w-full",j==="pip"&&"thread-xl:top-4 fixed start-0 end-0 top-(--header-height) z-50 mx-auto w-full max-w-(--thread-content-max-width)",z&&"fixed start-4 end-4 top-(--header-height) bottom-[164px] z-50 mx-auto w-auto",ne?"scale-100 opacity-100":"scale-90 opacity-0"),style:{maxHeight:se,height:z?"100%":o?`${o}px`:"auto"},children:[F&&!z&&t.jsx("button",{className:"absolute start-4 top-4 rounded-full bg-black/20 p-1.5 text-white backdrop-blur-lg hover:bg-black/50 dark:bg-white/20 dark:hover:bg-white/50",onClick:()=>L("inline"),children:t.jsx(Ce,{})}),F&&z&&t.jsxs("div",{className:"border-token-border-secondary flex h-10 items-center gap-3 border-b p-5",children:[t.jsx("button",{className:"hover:bg-token-main-surface-secondary start-4 top-4 rounded-full p-1.5 backdrop-blur-lg",onClick:()=>L("inline"),children:t.jsx(Ce,{className:"icon"})}),t.jsx("div",{className:"text-base",children:E})]}),t.jsx(Ss,{ref:u,host:"chatgpt",title:U,locale:m,html:Q??null,widgetId:te,widgetType:U,widgetParent:ee,widgetState:de,toolInput:h,toolOutput:v,maxHeight:se,theme:C??"light",displayMode:j??"inline",safeArea:oe,onReady:()=>me(!0),api:{notifyBackgroundColor:p=>q(bs(p)),notifyNavigation:({canGoBack:p,canGoForward:M})=>{ue(p),V(M)},notifyIntrinsicHeight:Y,sendFollowUpMessage:d,updateWidgetState:(p,M)=>b.setWidgetState$(p,M),requestDisplayMode:({mode:p,title:M})=>L(p,M),callTool:(p,M)=>b.callTool$(ee,p,M)}}),z&&t.jsx("div",{className:"pointer-events-none absolute start-2 end-2 bottom-2 z-10 flex justify-end",children:t.jsxs("div",{className:"pointer-events-auto mx-auto flex gap-2",children:[t.jsx("button",{className:"rounded-full bg-black/20 p-1.5 text-white hover:enabled:bg-black/50 disabled:opacity-50 dark:bg-white/20 dark:hover:enabled:bg-white/50",onClick:()=>{ae?u.current?.navigate({delta:-1}):L("inline")},children:t.jsx(ls,{})}),t.jsx("button",{disabled:!fe,className:"rounded-full bg-black/20 p-1.5 text-white hover:enabled:bg-black/50 disabled:opacity-50 dark:bg-white/20 dark:hover:enabled:bg-white/50",onClick:()=>u.current?.navigate({delta:1}),children:t.jsx(cs,{})})]})})]});return t.jsxs(t.Fragment,{children:[z&&t.jsx("div",{className:"bg-token-bg-primary fixed start-0 end-0 top-0 bottom-0 z-10"}),I]})},Ps=W.div`h-px bg-token-border-default`,Ae=W.div`text-sm font-medium py-3 leading-6`,Fs=W.div`my-4 p-5 w-full rounded-2xl popover bg-token-main-surface-primary shadow-lg border border-token-border-default`,As=":",Ds=({functionName:e,parameters:s,onClick:n,isDraft:a=!0,isCanceled:o=!1})=>{const i=Z(),r=Object.entries(s).filter(([m,u])=>!u||m==="timezone_str"&&u===Intl.DateTimeFormat().resolvedOptions().timeZone?!1:u.length>0);return t.jsxs(Fs,{children:[t.jsx("div",{className:"mb-4 flex items-center font-semibold",children:t.jsx("div",{children:a?be(e):Es(e,i)})}),r.map(([m,u])=>t.jsxs("div",{children:[t.jsx(Ps,{}),t.jsxs("div",{className:"flex",children:[t.jsxs(Ae,{className:"text-token-text-tertiary me-1",children:[be(m),As]}),t.jsx(Ae,{className:"whitespace-pre-line",children:He(u,i)})]})]},m)),a&&!o&&t.jsx("div",{className:"mt-2 flex justify-end gap-4",children:t.jsx(D,{color:"primary",className:"py-2",onClick:n,children:i.formatMessage(ce.approveButton)})}),o&&t.jsx("div",{className:"mt-2 flex justify-end gap-4",children:t.jsx(D,{color:"primary",className:"py-2",disabled:!0,children:i.formatMessage(ce.canceledButton)})})]})},Es=(e,s)=>{switch(e){case"create_event":return"Created Event ✅";default:return`${be(e)} ${s.formatMessage(ce.completedAction)} ✅`}},be=e=>{switch(e){case"timezone_str":return"Timezone";default:return e.split("_").map(s=>s.charAt(0).toUpperCase()+s.slice(1).toLowerCase()).join(" ")}},He=(e,s)=>{if(Array.isArray(e))return e.map(o=>He(o,s)).join(s.formatMessage(ce.valueSeparator));if(typeof e=="object")return JSON.stringify(e);if(e.match(/^\s*\d{4}-\d{2}-\d{2}/)==null)return e;const a=new Date(e);return Number.isNaN(a.getTime())?e:s.formatDate(a,{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"numeric"})},ce=X({approveButton:{id:"ParametersView.approveButton",defaultMessage:"Approve"},completedAction:{id:"ParametersView.completedAction",defaultMessage:"Completed"},canceledButton:{id:"ParametersView.canceledButton",defaultMessage:"Canceled"},valueSeparator:{id:"ParametersView.valueSeparator",defaultMessage:","}});var c=(e=>(e[e.Running=0]="Running",e[e.Finished=1]="Finished",e[e.Error=2]="Error",e[e.Stopped=3]="Stopped",e[e.OauthLogin=4]="OauthLogin",e[e.UserConfirmation=5]="UserConfirmation",e[e.Denied=6]="Denied",e[e.Hidden=7]="Hidden",e))(c||{});function zs(e,s,n,a,o){return s=Ls(s,a,o),s?e.formatMessage(s,n):null}function Ls(e,s,n){if(![c.Finished,c.Running,c.Stopped].includes(n)||!s)return e;switch(s){case"ecosystem_demo.daw":case"ecosystem_demo.daw_drums":return n===c.Finished||n===c.Stopped?A({id:"BYgUCC",defaultMessage:"Composed track"}):A({id:"9n1xDI",defaultMessage:"Composing track"});case"ecosystem_demo.flashcards":return n===c.Finished||n===c.Stopped?A({id:"szZeVr",defaultMessage:"Created flashcards"}):A({id:"NYOjya",defaultMessage:"Creating flashcards"});case"api_tool.list_resources":return n===c.Finished||n===c.Stopped?A({id:"OdEouq",defaultMessage:"Looked for available tools"}):A({id:"hSyoq0",defaultMessage:"Looking for available tools"});case"api_tool.search_tools":return n===c.Finished||n===c.Stopped?A({id:"4et5qC",defaultMessage:"Searched tools"}):A({id:"V0IDh0",defaultMessage:"Searching tools"});case"api_tool.call_tool":return n===c.Finished||n===c.Stopped?A({id:"NTASw4",defaultMessage:"Called tool"}):A({id:"gc64KQ",defaultMessage:"Calling tool"})}return e}const Ke="openaiFileIdRefs",Is=["send_email","batch_modify_email","create_event","update_event","delete_event"];function en({messages:e,nextMessage:s,clientThreadId:n,isLastMessageInTurn:a,isLastTurnInConversation:o,connectorFixture:i,allowInspectingArguments:r,onRequestCompletion:m}){const[u,d]=at(),[g,...y]=e,l=y.filter(f=>f.author.role===ve.Tool),w=Z(),Q=Dt(n),b=g.metadata?.gizmo_id??Q,E=Et(n,f=>Qt(f?.mode,b)),F=os(E)&&E.gizmo_id===b,k=zt(b,F)?.data,[j,O]=_.useState(!1),P=Me(g.recipient);let L;if(P?.functionName!=null&&k?.tools!=null){for(const f of k.tools)if($s(f,P.functionName)){L=f;break}}const ee=l.filter(f=>f.metadata?.jit_plugin_data?.from_server?.type==="debug"),U=l.filter(f=>!["debug","send_test"].some(x=>x===f.metadata?.jit_plugin_data?.from_server?.type)),{uiState:h,jitPluginData:v,fileAttachments:de,invokedPlugin:te}=Os(g,U,a),se=Me(s?.recipient)?.namespace,{connectorId:ne,connectorToolStatus:me,connectorStatusMessage:ae,showConnectorConnect:ue}=Vs(P?.namespace,se,l,o),fe=Ve(!0,Lt.JIT_PLUGIN),V=i??fe.platformConnectors.get(ne??""),ge=It();let q;for(let f=U.length-1;f>=0;f--){const x=U[f].metadata?.jit_plugin_data;if(x?.from_server?.type==="confirm_action"){q=x;break}}let C=v?.from_server?.type!=="denied_by_user"?v?.from_server?.body.domain:L?.metadata?.domain,oe=null;if(!C&&P?.functionName&&P.namespace==="kanzi_app"){const[f,x]=P.functionName.split("/");C=f.replace(/_/g," "),oe=t.jsx(Kt,{openNewTab:!0,className:"text-token-text-secondary pt-1 opacity-0 transition-opacity duration-200 group-hover/tool-message:opacity-100",href:`/kanzi/studio/c/${x}`,children:t.jsx(rs,{})})}C?C.endsWith("__jit_plugin")&&(C=C.slice(0,-12)):C="connector";const z=L?.metadata?.privacy_policy_url;_.useEffect(()=>{if(Qe(v?.from_client)?.type==="oauth_success")return;const f=u.get("oauth_success");if(v?.from_server?.type==="oauth_required"&&f){d(x=>(x.delete("oauth_success"),x),{replace:!0});for(const x of v.from_server.body.actions)if(x.type==="oauth_redirect"){xe({eventSource:"url",assistantMessage:g,onRequestCompletion:m,actionData:{type:"oauth_success",target_message_id:x.oauth_redirect.target_message_id},conversationMode:E});return}}},[E,g,e,n,m,v,o,u,d]);const Y=l[l.length-1];Y?.metadata?.chatgpt_sdk?.tool_domain&&(C=Y.metadata.chatgpt_sdk.tool_domain);let I=N.Running,p=C?S.running:S.starting,M={domain:C};if(h===c.Hidden)return null;h===c.OauthLogin||h===c.UserConfirmation?(I=N.Paused,p=S.confirmingSimple,M={...{gizmoName:k?.gizmo.display.name??"ChatGPT",domain:C},title:x=>t.jsxs("div",{className:"inline-flex items-center gap-1 text-sm",children:[x,t.jsx(We,{className:"icon-sm"})]}),subtitle:x=>t.jsx("div",{className:"text-xs",children:x})}):h===c.Finished?(I=N.Finished,p=S.finished,M={domain:C}):h===c.Error?(I=N.Error,p=S.error):(h===c.Stopped||h===c.Denied)&&(I=N.Stopped,p=h===c.Denied?S.declined:S.stopped);const je={assistantMessage:g,allMessages:e,clientThreadId:n,turnGizmo:k,onRequestCompletion:m,conversationMode:E},Ye={domain:C},we=v?.from_server?.type!=="denied_by_user"?v?.from_server?.body.actions.map((f,x)=>t.jsx(ps,{action:f,displayParams:Ye,handleUserAction:xe,userActionParams:je,rememberAnswer:j},x)):null,Je=zs(w,p,M,g.recipient??"",h),Ze=W.div`flex gap-2 flex-wrap mt-1 empty:hidden`,ie=ze(v)??ze(q)??Gs(g),pe=Ws(Y),Xe=ie?.[Ke]??[],et=r&&(!!ie||!!pe||Xe.length>0);let re=t.jsx(t.Fragment,{});const J=De(v,te)??De(q,void 0)??"";if(Is.includes(J)&&(h===c.UserConfirmation||h===c.Finished||h===c.Stopped||h===c.Denied)){const f=h!==c.Finished,x=(h===c.Stopped||h===c.Denied)&&!o,H=Ee(v,te)??Ee(q,void 0),ke=tt=>{v?.from_server?.type==="confirm_action"&&v?.from_server?.body?.actions?.[0].type==="allow"&&(xe({...je,sourceEvent:tt,actionData:{type:"allow",...v?.from_server?.body?.actions?.[0].allow,remember_answer:j}}),Ut(n,st=>{st.scrollToMessageId=n}))};switch(J){case"send_email":re=t.jsx(gs,{to:H?.to,cc:H?.cc,bcc:H?.bcc,subject:H?.subject,body:H?.body,onClick:h===c.UserConfirmation?ke:()=>{},isDraft:f,isCanceled:x});break;default:re=t.jsx(Ds,{functionName:J??"",parameters:H??{},onClick:h===c.UserConfirmation?ke:()=>{},isDraft:f,isCanceled:x});break}}else(h===c.UserConfirmation||h===c.OauthLogin)&&we&&(re=t.jsx(t.Fragment,{children:t.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[we,v?.from_server?.type==="confirm_action"&&(v?.from_server?.body?.offer_remember_answer||!0)?t.jsx("div",{className:"flex gap-2 text-sm",children:t.jsx(is,{id:"dont-ask-again",label:t.jsx(T,{...S.rememberForThisConversation}),checked:j,onChange:f=>O(f.target.checked)})}):null]})}));return ne?t.jsxs(t.Fragment,{children:[ae&&t.jsx(Ne,{highlightedCommand:V?w.formatMessage(ae,{domain:V.name}):t.jsx("br",{}),status:me,showWorkUserSetting:!1}),ue&&V&&t.jsx("div",{className:"mb-2 flex gap-2",children:t.jsx(hs,{connector:V,onClick:()=>{const f=Re(n),x=f?new URL(Oe(f),window.location.origin):new URL(window.location.href);x.searchParams.set("oauth_success","true"),ge({connectorId:V.id,redirectAfter:x.toString(),referrer:Rt.JitPluginMessage})}})})]}):t.jsxs(t.Fragment,{children:[t.jsx(Bs,{debugMessages:ee}),t.jsx("span",{className:"group/tool-message",children:t.jsx(Ne,{highlightedCommand:Je,status:I,showWorkUserSetting:!1,accessory:oe,forceExpanded:h===c.UserConfirmation,children:et?P?.namespace==="api_tool"?t.jsx(ys,{isWrite:h===c.UserConfirmation,functionName:g.recipient??J,params:ie,result:pe}):t.jsx(Us,{privacyPolicyUrl:z,name:g.recipient??J,params:ie,result:pe,isPromptingForPermission:I===N.Paused}):null})}),t.jsx(Ze,{children:de?.map(f=>t.jsx(Ge,{file:f.name,fileId:f.id,width:"wide",alwaysShowData:!0,showDownloadButton:!0,downloadLink:f.download_url,contextConnectorInfo:Bt(f.context_connector_info)},f.id))}),e.some(f=>!!f.metadata?.chatgpt_sdk)&&t.jsx(Ot,{name:"ChatSDKContent",children:t.jsx(Ts,{clientThreadId:n,messages:e,onRequestCompletion:m})}),re]})}function Rs({messageMetadata:e}){const[s,n]=_.useState(!1);return t.jsxs("div",{className:"my-2 flex flex-col text-sm",children:[t.jsxs("div",{className:"flex flex-row items-center hover:cursor-pointer",onClick:()=>{n(!s)},children:[s?t.jsx(We,{className:"icon-sm"}):t.jsx(Ht,{className:"icon-sm"}),t.jsx("div",{className:"font-semibold",children:e.display_message})]}),s&&t.jsx("pre",{children:JSON.stringify(e.data,null,2)})]})}function Bs({debugMessages:e}){return e.length===0?null:t.jsx("div",{children:e.map((s,n)=>{const a=s.metadata?.jit_plugin_data?.from_server;return a&&a.type==="debug"?t.jsx(Rs,{messageMetadata:a.body},n):null})})}function De(e,s){return e?.from_server?.type==="confirm_action"?e?.from_server?.body?.operation:s?.parsed_function_call?.name}function Ee(e,s){return e?.from_server?.type==="confirm_action"?e?.from_server?.body?.params:s?.parsed_function_call?.kwargs}function Os(e,s,n){if(e.metadata?.jit_plugin_data?.from_server?.type==="send_test")return{uiState:c.Hidden};if(s.some(a=>a.content.content_type===K.SystemError))return{uiState:c.Error};if($t(e))return{uiState:c.Stopped};for(let a=s.length-1;a>=0;a--){const o=s[a];if(o.metadata?.invoked_plugin){const m=[];return s.forEach(u=>{const d=u.metadata?.attachments?.filter(g=>g.display_files_from_actions_ext);d&&m.push(...d)}),{uiState:c.Finished,jitPluginData:o.metadata.jit_plugin_data,invokedPlugin:o.metadata.invoked_plugin,fileAttachments:m}}const i=Qe(o.metadata?.jit_plugin_data?.from_client);if(i!=null){if(i?.type==="contact_gizmo")return{uiState:c.Finished,jitPluginData:s[a-1]?.metadata?.jit_plugin_data};if(i?.type==="deny")return{uiState:c.Denied};if(i?.type==="oauth_success")return{uiState:c.Running,jitPluginData:o.metadata?.jit_plugin_data};break}const r=o.metadata?.jit_plugin_data?.from_server;if(r?.type==="preview"&&n)return{uiState:c.Running,jitPluginData:o.metadata?.jit_plugin_data};if(r?.type==="confirm_action"&&n)return{uiState:c.UserConfirmation,jitPluginData:o.metadata?.jit_plugin_data};if(r?.type==="oauth_required"&&n)return{uiState:c.OauthLogin,jitPluginData:o.metadata?.jit_plugin_data}}return{uiState:n?c.Running:c.Stopped}}function Vs(e,s,n,a){var o=Gt(e,n)??void 0;if(!o)return{connectorId:void 0,connectorToolStatus:null,connectorStatusMessage:null,showConnectorConnect:!1};if(s===e)return{connectorId:o,connectorToolStatus:null,connectorStatusMessage:null,showConnectorConnect:!1};var i=N.Running,r=null,m=!1;const u=n[n.length-1],d=u?.metadata?.jit_plugin_data;return n.some(g=>g.content.content_type===K.SystemError)?(i=N.Error,r=S.error):u?d?.from_server?.type==="oauth_required"&&a?(i=N.Paused,r=null,m=!0):d?.from_server?.type==="oauth_required"&&!a?(i=N.Stopped,r=S.connectorDeclined):d?.from_client?.type==="deny"?(i=N.Stopped,r=S.connectorDeclined):d?.from_client?.type==="oauth_success"?(i=N.Stopped,r=null):u?.metadata?.invoked_plugin?(i=N.Finished,r=S.finished):(i=N.Stopped,r=S.stopped):(i=N.Running,r=S.running),{connectorId:o,connectorToolStatus:i,connectorStatusMessage:r,showConnectorConnect:m}}function xe({actionData:e,assistantMessage:s,turnGizmo:n,onRequestCompletion:a,conversationMode:o,...i}){const r={id:Le(),author:{role:ve.Tool,name:s.recipient},content:{content_type:K.Text,parts:[""]},recipient:"all",metadata:{jit_plugin_data:{from_client:e},gizmo_id:n?.gizmo.id},clientMetadata:{completionSampleFinishTime:Date.now()}};a({...i,promptMessage:r,completionMetadata:{conversationMode:o??{kind:Be.PrimaryAssistant}}})}function $s(e,s){if(e.type!==Vt.JIT_PLUGIN||!e.metadata.json_schema)return!1;let n=!1;function a(o){for(const i in o)i==="operationId"&&o[i]===s&&(n=!0),o[i]&&typeof o[i]=="object"&&a(o[i])}return a(e.metadata.json_schema),n}function ze(e){if(e&&(e.from_server?.type==="confirm_action"||e.from_server?.type==="oauth_required"||e.from_server?.type==="preview"))return e.from_server.body.params}function Gs(e){const s=Wt(e);if(s)try{return JSON.parse(s)}catch{return{text:s}}}function Ws(e){if(!e)return;const s=e.content.content_type===K.Text?e.content.parts[0]:e.content.content_type===K.Code?e.content.text:void 0;if(s)try{return JSON.parse(s)}catch{return s}}function Us({name:e,params:s,result:n,privacyPolicyUrl:a,isPromptingForPermission:o}){const r=(s?.[Ke]??[]).map((m,u)=>{const d=m.name.startsWith("dalle-");let g=m.name;return d&&(g=`${g}.webp`),t.jsx(Ge,{file:g,fileId:m.id},u)});return t.jsxs("div",{className:"divide-token-border-default border-token-border-default mt-1 mb-4 divide-y overflow-hidden rounded-xl border",children:[e&&t.jsx("div",{className:"bg-token-bg-tertiary text-token-text-secondary px-4 py-2 text-sm",children:t.jsx(T,{id:"JITPluginMessage.params.toolCall",defaultMessage:"Tool call: {name}",values:{name:t.jsx("span",{className:"text-token-text-primary",children:e})}})}),s&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"bg-token-bg-tertiary text-token-text-secondary flex justify-between px-4 py-2 text-sm",children:[o?t.jsx(T,{id:"JITPluginMessage.params.sharing.present",defaultMessage:"The following will be shared:"}):t.jsx(T,{id:"JITPluginMessage.params.sharing.past",defaultMessage:"The following was shared:"}),a&&t.jsx("a",{href:qt(a),className:"text-token-text-primary",target:"_blank",rel:"noreferrer",children:t.jsx(T,{...S.privacyPolicyLink})})]}),t.jsx("div",{className:"px-4 py-2",children:t.jsx(_e,{value:s})}),r.length>0&&t.jsx("div",{className:"px-4 py-2",children:r})]}),n&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"bg-token-bg-tertiary text-token-text-secondary flex justify-between px-4 py-2 text-sm",children:t.jsx(T,{id:"JITPluginMessage.params.result",defaultMessage:"Result:"})}),t.jsx("div",{className:"px-4 py-2",children:t.jsx(_e,{value:n})})]})]})}function Qe(e){if(e&&"user_action"in e){const s=e.user_action;e={...e,...s.data},"target_message_id"in e&&s.target_message_id&&(e.target_message_id=s.target_message_id)}return e}const S=X({starting:{id:"jitPluginMessage.starting",defaultMessage:"Starting action"},confirmingSimple:{id:"jitPluginMessage.confirming.simple",defaultMessage:"{gizmoName} wants to talk to {domain}"},confirmingSubtitle:{id:"jitPluginMessage.confirming.subtitle",defaultMessage:"Only allow sites you trust."},running:{id:"jitPluginMessage.runningV4",defaultMessage:"Talking to {domain}"},finished:{id:"jitPluginMessage.finishedV4",defaultMessage:"Talked to {domain}"},stopped:{id:"jitPluginMessage.stoppedV4",defaultMessage:"Stopped talking to {domain}"},error:{id:"jitPluginMessage.errorV5",defaultMessage:"Error talking to {domain}"},declined:{id:"jitPluginMessage.declined",defaultMessage:"You declined this action"},ranTest:{id:"jitPluginMessage.ranTest",defaultMessage:"Tested {operationName}"},confirmParamsTitle:{id:"jitPluginMessage.confirmParamsTitleV3",defaultMessage:"{gizmoName} wants to share this info with {domain}"},sentParamsTitle:{id:"jitPluginMessage.sentParamsTitleV2",defaultMessage:"{gizmoName} sent this info to {domain}"},privacyPolicyLink:{id:"jitPluginMessage.privacyPolicyLinkV2",defaultMessage:"Privacy policy"},connectorDeclined:{id:"jitPluginMessage.connectorDeclined",defaultMessage:"Declined connection to {domain}"},rememberForThisConversation:{id:"jitPluginMessage.rememberForThisConversation",defaultMessage:"Remember for this conversation"}});export{en as JITPluginMessage};
//# sourceMappingURL=gcsd3mtkow76sdqw.js.map
