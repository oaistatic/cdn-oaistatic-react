import{jw as S,b2 as E,qz as R,ds as q,m7 as I}from"./lgw4q0e8zlqqfgug.js";import{h as K,r as e,f as L,a as w,j as i,ai as O,e as B,P as U}from"./m60bpb0x3x7rg8fj.js";import{W as N}from"./esc7nocjlg2ip2xz.js";import{s as z,t as H,h as Q,W as $,l as G,v as J,x as V,j as X}from"./g7o69yifmkuxfsll.js";import{kd as Y,iq as T,ir as M}from"./ggjzadbnd3k1vu0k.js";import{u as Z}from"./lycvq5rqsik44ye8.js";import{a as tt,T as st,W as et,b as rt}from"./ccdmd6bzhnx5atrg.js";import{u as ot}from"./d6raol4cdcsdp19u.js";import{u as nt}from"./loqw89wii3nszys1.js";import"./l9bupap4fyh5egbo.js";import"./dgb06x9f8z6d0ar9.js";import"./ngdk8aaa28n1ff0n.js";import"./cb9cgv53vja8utnc.js";import"./o7wniqoxhh56wvjg.js";import"./czj65b9i5sztgpdb.js";import"./nyb6qzfj9cwbbq9m.js";import"./ijm2v97qh75qdidh.js";import"./m9elivgqkyz3hcka.js";import"./crheuewn890nts1d.js";import"./df3y7yi36gehsn95.js";import"./jii3s2n86nvi5fnj.js";import"./9q3v44p2xpoi75pn.js";import"./mdsdqbg7dtklqnuw.js";import"./kj109at7ry8iempm.js";import"./jtj7tm19s85de1gz.js";import"./gjtxw5aaotq3dyvk.js";import"./ll84t6t68j83ysyi.js";import"./tfkm8dsw7zx8il21.js";import"./kkyb18g9gdccsonu.js";import"./fxwiivjy9rf81dg2.js";import"./og0mzunrykkt4tp0.js";import"./lff9oru7r5vtmz06.js";import"./n26tu9wxezmtzr3d.js";import"./dmk30rbb7u1k7gl7.js";import"./795byvwofdax2f6d.js";import"./m3hp25w3mcid81ib.js";import"./dp7t1jmnbbend843.js";import"./hvkmppraevglbeo3.js";import"./kfjcy5y4cxuymbdf.js";import"./lf8mxjdfum7t34gh.js";function at(s){const r=K(),n=S(),a=ot(),{data:t,error:m}=z(s,{refetchOnWindowFocus:!0,refetchOnMount:!0}),{isLoading:p}=H(s),c=Q(({getTurnsForTask:u})=>u(s))??[],{focusedAssistantTurn:o,setFocusedAssistantTurnId:g}=tt({taskId:s,task:t?.task,currentUserTurn:t?.current_user_turn??null,currentAssistantTurn:t?.current_assistant_turn??null}),C=t?.task?.current_turn_id,l=!!t?.task.has_unread_turn&&C===t?.current_assistant_turn?.id,f=t?.current_assistant_turn?.turn_status==="completed";e.useEffect(()=>{if(!n)return;const u=t?.task?.title;if(!u)return;const d=document.title;return document.title=u,()=>{document.title=d}},[n,t?.task?.title]),e.useEffect(()=>{!l||!f||$.markTurnAsRead(s).then(()=>{r.invalidateQueries({queryKey:["wham","tasks"]}),r.invalidateQueries({queryKey:["wham","task",s]})})},[l,f,s,r]);const k=e.useMemo(()=>{const u=o?G(o.turn_status):!1,d=o?.sibling_turn_ids?.includes(t?.current_assistant_turn?.id??"")||o?.id===t?.current_assistant_turn?.id,h=!t?.current_diff_task_turn;return u&&(d||h)},[o,t?.current_assistant_turn,t?.current_diff_task_turn]);return{taskDetails:t,taskDetailsError:m,loadingTurnMapping:p,turns:c,focusedAssistantTurn:o,setFocusedAssistantTurnId:g,canFollowUp:k,isCommentFocused:a}}function it(){const[s,r]=e.useState([]),[n,a]=e.useState(!1),t=e.useCallback(()=>{r([])},[]),m=e.useCallback(({onClose:p,isComposerEmpty:c})=>({force:o=!1}={})=>{if(o||s.length===0&&c){t(),p();return}a(!0)},[s.length,t]);return{comments:s,setComments:r,confirmClose:n,setConfirmClose:a,clearComments:t,createCloseHandler:m}}function ut({taskId:s,onClose:r}){const n=E(),a=L(),t=w(),{composerController:m,isComposerEmpty:p}=nt(),{taskDetails:c,taskDetailsError:o,loadingTurnMapping:g,turns:C,focusedAssistantTurn:l,setFocusedAssistantTurnId:f,canFollowUp:k,isCommentFocused:u}=at(s),d=e.useMemo(()=>J(l),[l]),h=e.useMemo(()=>({taskId:s,task:c?.task,pastTurns:C,canFollowUp:k,focusedAssistantTurn:l,setFocusedAssistantTurnId:f}),[s,c,C,k,l,f]),{comments:_,setComments:x,confirmClose:W,setConfirmClose:j,clearComments:b,createCloseHandler:v}=it(),P=e.useMemo(()=>({comments:_,setComments:x,clearComments:b,readonlyComments:d}),[_,x,b,d]),A=Y.useCurrentImage()!=null,y=v({onClose:r,isComposerEmpty:p});Z(),V([{key:"newTask",action:()=>{t("/codex",{state:{focusComposer:!0}})},actionMessageDescriptor:a.formatMessage({id:"wham.keyboardActions.newTask",defaultMessage:"New task"}),group:M.Chat,keyboardBinding:[T.Mod,T.Shift,"o"]},{key:"closeTask",action:()=>{t("/codex")},actionMessageDescriptor:a.formatMessage({id:"wham.keyboardActions.closeTask",defaultMessage:"Close task"}),group:M.Chat,keyboardBinding:[T.Escape],enabled:!A&&!u}]);const D=e.useCallback(({force:F=!1}={})=>{y({force:F})},[y]);return o?(n.danger({id:"wham.task-details.error",defaultMessage:"Error loading task",description:"Error message for failed to load task details"},{id:`wham-task-details-error-${s}`,hasCloseButton:!0,duration:3,toastId:"wham_task_page_content_error"}),i.jsx(O,{to:"/codex"})):i.jsx(R.Provider,{value:m,children:i.jsx(st,{value:P,children:i.jsx(et,{value:h,children:i.jsx(rt,{permissions:"write",turnId:c?.current_assistant_turn?.id??"",confirmClose:W,setConfirmClose:j,handleClose:D,loadingTurnMapping:g})})})})}function mt(){const s=w(),r=B(),{taskId:n}=U();X();const a=r.state??{},{backgroundLocation:t}=a,m=e.useCallback(()=>{s(t?-1:"/codex")},[t,s]);return n?i.jsx(q,{children:i.jsx(N,{children:i.jsx(ut,{taskId:n,onClose:m})})}):null}const Vt=()=>[{title:"Codex"}],Xt=I(function(){return i.jsx(mt,{})});export{Xt as default,Vt as meta};
//# sourceMappingURL=l2c1be0hytl4ptyj.js.map
