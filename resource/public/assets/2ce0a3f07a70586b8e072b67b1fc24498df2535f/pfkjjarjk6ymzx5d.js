import{j as e,M as a,r as n,b as O,h as P}from"./n97h6so7iblif4c5.js";import{kp as E,h0 as k,cN as L,B as R,eS as A,o0 as B,gT as F,f0 as q,dN as v,dO as w,C as H,o1 as _,mQ as U,h6 as z,b4 as D,aR as Q}from"./cim4usely8ixso70.js";import{d8 as I,d9 as c,al as Y,da as V}from"./ivbsxyeeopn30y8l.js";import{G as $}from"./eo9i015vih87ul2f.js";function J({onClose:t}){const l=E();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-0 mb-4 flex justify-center",children:e.jsx("div",{className:"bg-tertiary border-token-border-subtle rounded-lg border p-3",children:e.jsx(k,{className:"h-10 w-10"})})}),e.jsx("h2",{className:"mb-6 text-center text-xl font-semibold",children:e.jsx(a,{id:"e7S220",defaultMessage:"One last step"})}),e.jsxs("div",{className:"bg-tertiary border-token-border-subtle mb-6 flex items-start gap-3 rounded-lg border p-4",children:[e.jsx(L,{className:"icon mt-0.5"}),e.jsxs("div",{className:"flex flex-grow flex-col gap-1",children:[e.jsx("span",{className:"font-medium",children:e.jsx(a,{id:"MQhj3s",defaultMessage:"Configure your repositories"})}),e.jsx("span",{className:"text-token-text-tertiary text-sm",children:e.jsx(a,{id:"ZvosJF",defaultMessage:"You still need to choose the repositories ChatGPT can access."})})]})]}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs(R,{className:"w-full",size:"large",onClick:()=>{window.open(l,"_blank"),t(!1)},children:[e.jsx(a,{id:"o1jiyf",defaultMessage:"Configure Repositories on GitHub"}),e.jsx(I,{className:"icon-sm ms-2 inline-block"})]})})]})}const K=({connectorLink:t,isLoading:l,onClose:m,onContinue:i})=>{const u=O(),o=P(),[y,f]=n.useState(""),[p,N]=n.useState(new Map),x=Y(y,500),{data:b,isLoading:S,isFetchingNextPage:C,hasNextPage:j,fetchNextPage:g}=V({enabled:!!t,debouncedSearchTerm:x,linkId:t?.id??""}),{mutateAsync:r,isPending:d}=U(),M=n.useCallback(async()=>{if(t)try{await r({link:t,user_extension:{type:"GithubUserApiExtension",opted_in_repository_ids:Array.from(p.keys())}}),o.invalidateQueries({queryKey:["user_connection_sync_configuration"]}),i({reposToIndex:Array.from(p.values()).filter(s=>!s.is_code_search_indexed).map(s=>s.repository_full_name)})}catch{}},[t,r,p,o,i]),h=n.useMemo(()=>b?.pages.flatMap(s=>s.repos)??[],[b]),T=h.length>5||!!x,G=S||l;return e.jsxs(e.Fragment,{children:[e.jsx(_,{title:e.jsx(a,{id:"BhSDq8",defaultMessage:"Which repositories do you use?"}),connectorIcon:e.jsx("div",{className:"rounded-xl border-[0.5px] p-2 shadow-sm",children:e.jsx(k,{className:"icon-2xl"})}),onClose:()=>m(!1)}),e.jsx("div",{className:"text-token-text-secondary mt-2 mb-6 text-center text-sm",children:T?e.jsx(a,{id:"o+DCDE",defaultMessage:"Choose up to 5. These repositories will sync with ChatGPT for improved speed and quality. Not seeing a repository? <link>Learn more</link>",values:{link:s=>e.jsx("a",{href:"https://help.openai.com/en/articles/11145903-chatgpt-connectors",target:"_blank",rel:"noopener noreferrer",className:"underline",children:s})}}):e.jsx(a,{id:"8FVBwU",defaultMessage:"These repositories will sync with ChatGPT for improved speed and quality. Not seeing a repository? <link>Learn more</link>",values:{link:s=>e.jsx("a",{href:"https://help.openai.com/en/articles/11145903-chatgpt-connectors",target:"_blank",rel:"noopener noreferrer",className:"underline",children:s})}})}),T&&e.jsx(z,{ariaLabel:u.formatMessage({id:"D2Xhv1",defaultMessage:"Search repositories"}),autoComplete:"off",className:"mb-2",icon:D,iconPosition:"left",name:"search-repos",onChange:s=>{f(s.target.value)},placeholder:u.formatMessage({id:"jYgjAb",defaultMessage:"Search repositories"})}),e.jsx($,{allRepos:h,fetchNextPage:g,hasNextPage:j,isFetchingNextPage:C,isLoading:G,onChange:N,searchTerm:x,selectedRepos:p}),e.jsx(R,{className:"mt-2 w-full",disabled:G,loading:d,onClick:()=>{p.size===0?i({reposToIndex:[]}):M()},size:"large",children:e.jsx(a,{...Q.continueButtonText})})]})},W=({isLoading:t,onClose:l,reposToIndex:m})=>e.jsxs(e.Fragment,{children:[e.jsx(_,{title:e.jsx(a,{id:"hxqAFz",defaultMessage:"Complete setup"}),connectorIcon:e.jsx("div",{className:"rounded-xl border-[0.5px] p-2 shadow-sm",children:e.jsx(k,{className:"icon-2xl"})}),onClose:()=>l(!1)}),e.jsx("div",{className:"text-token-text-secondary mt-2 mb-6 text-center text-sm",children:e.jsx(a,{id:"IQqMC0",defaultMessage:"Your repositories must be indexed by GitHub before they can be accessed by ChatGPT. GitHub will open in a new tab, and automatically close. Indexing should complete in 5-10 minutes."})}),e.jsxs(R,{className:"mt-2 w-full",loading:t,onClick:()=>{window.open(`https://github.com/search?q=${m.map(i=>`repo:${i}`).join("+")}&type=code`,"_blank"),l(!1)},size:"large",children:[e.jsx(a,{id:"CfvY9y",defaultMessage:"Start indexing on GitHub"}),e.jsx(I,{className:"icon-sm ms-2 inline-block"})]})]});function te({initialState:t=c.ConfigureRepos,onClose:l,onFinishFlow:m}){const i=A(),u=B(),[o,y]=n.useState(t),[f,p]=n.useState([]),{platformConnectors:N,isLoading:x}=F(!0),{connectorLinks:b,isLoading:S}=q({fetchValidLinksOnly:!0}),C=N.get(v[w.GITHUB_CONNECTOR]),j=b.get(v[w.GITHUB_CONNECTOR])?.[0],g=x||S,r=n.useCallback(h=>{l(h)},[l]),d=n.useCallback(()=>{r(!1),m?.()},[r,m]),M=n.useMemo(()=>{switch(o){case c.ConfigureRepos:return e.jsx(J,{onClose:()=>r(!1)});case c.SyncRepos:return i&&!u&&e.jsx(K,{connector:C,connectorLink:j,isLoading:g,onContinue:({reposToIndex:h})=>{h.length>0?(p(h),y(c.IndexRepos)):d()},onClose:d});case c.IndexRepos:return e.jsx(W,{isLoading:g,onClose:d,reposToIndex:f})}},[o,f,r,C,j,g,i,u,d]);return n.useEffect(()=>{!i&&o===c.SyncRepos&&r(!1)},[i,o,r]),n.useEffect(()=>{u&&o===c.SyncRepos&&d()},[u,o,d]),e.jsx(H,{className:"max-w-[400px] px-2",hideSeparator:!0,isOpen:!0,onClose:()=>r(!1),showCloseButton:o===c.ConfigureRepos,title:o===c.ConfigureRepos?e.jsx("span",{}):void 0,testId:"modal-github-onboarding",type:"success",children:M})}export{te as GithubOnboardingModal};
//# sourceMappingURL=pfkjjarjk6ymzx5d.js.map
