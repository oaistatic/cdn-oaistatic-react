const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/fb6yr4uneie0f4oc.js","assets/n97h6so7iblif4c5.js","assets/cim4usely8ixso70.js","assets/root-c9lkqywj.css","assets/ivbsxyeeopn30y8l.js","assets/conversation-small-dhmr708a.css","assets/cx5cw3adpli8kxwm.js","assets/joa8jajuiu4xqpzn.js"])))=>i.map(i=>d[i]);
import{d as P,c7 as K,cT as U,fK as $,o6 as Y,aD as Z,a as B,a$ as Q,b1 as J,ac as X,o7 as ee,cs as te,av as se,ad as ne}from"./cim4usely8ixso70.js";import{j as t,m as M,r as s}from"./n97h6so7iblif4c5.js";import{c0 as ae,bj as oe,bm as re,fu as ie,w as ce,d5 as le,fv as ue,bl as S,fw as de,fx as me,fp as b,cU as he,A as fe,y as pe,x as ge}from"./ivbsxyeeopn30y8l.js";import{P as xe}from"./o9aygkglauyctw2w.js";import"./dl6wm3f4iy2ldybm.js";import"./ib76cquqlyjrlt71.js";import"./g86fwc5245pbdtof.js";import"./kgkkjgk15rr7n5rs.js";import"./dtltw5so60m9d99q.js";const we=0,Ie=48;function ve({imageAsset:e,children:a,containerDimensions:n,isLoadingNewImage:r}){return t.jsxs(M.div,{className:"absolute",style:Ce(e,n),...ae,children:[a,t.jsx("div",{className:P("bg-token-main-surface-primary absolute inset-0 flex items-center justify-center transition-opacity duration-1000",r?"pointer-events-auto opacity-60":"pointer-events-none opacity-0")})]})}function Ce(e,a){const{width:n,height:r}=e,{width:u,height:d}=a,m=u-2*we,h=d-2*Ie,l=n/r,i=m/h,c=l>i,g=c?m:h*l,x=c?m/l:h;return{top:"50%",left:"50%",width:g,height:x,transform:"translate(-50%, -50%)"}}const Ae=({onEscape:e})=>{s.useEffect(()=>{function a(n){n.key==="Escape"&&e()}return document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)}},[e])},ye=X(()=>ne(()=>import("./fb6yr4uneie0f4oc.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(e=>e.DynamicDrawingCanvas)),N=126,Ee=63,je=136,Re=50;function De({delay:e=Re,height:a,width:n}){const[r,u]=s.useState(!1);return s.useEffect(()=>{const d=setTimeout(()=>{u(!0)},e);return()=>{clearTimeout(d)}},[e]),r?t.jsx("div",{className:"flex max-h-full max-w-full items-center justify-center",style:{width:n,height:a,aspectRatio:`${n} / ${a}`},children:t.jsx("div",{className:"bg-token-border-default h-full w-full animate-pulse"})}):null}function ke({image:e,isLoadingNewImage:a,clientThreadId:n,onClose:r,messageId:u,onRequestCompletion:d,editorControls:m,footer:h}){const l=K(n),[i,c]=s.useState("default"),[g,x]=s.useState({width:window.innerWidth,height:window.innerHeight-N}),_=U(),[L,T]=s.useState(!1),I=oe(),{currentDrawnShape:w,onNewDrawnShape:G,clearAllDrawings:k}=I,v=s.useRef(null),W=s.useMemo(()=>new $(Y()),[]),C=s.useRef(void 0),f=s.useMemo(()=>re({pointer:e,conversationId:l,messageId:u,source:"editor"}),[e,u,l]),O=ie(o=>{const{width:p,height:D}=o.contentRect;x({width:p,height:_?D-N:D-Ee})});Ae(s.useMemo(()=>({onEscape:()=>{i==="inpaint"?c("default"):r()}}),[i,r])),ce(s.useMemo(()=>({image:e,currentDrawnShape:w,onCleared:()=>c("default"),getImageData:()=>v.current?.getImageData()}),[e,w])),s.useEffect(()=>{i!=="inpaint"&&k()},[i]),s.useEffect(()=>{c("default")},[e]);const A=le(n),y=s.useCallback(o=>{c("default"),A(o),r()},[A,r]),E=s.useMemo(()=>d||y,[d,y]),[H]=Z(n,o=>[o?.modelId]),j=ue({imageAssetPointer:e,serverThreadId:l}),F=s.useCallback(()=>{c("inpaint"),S.inpaintClick({analyticsContext:f})},[f]),z=s.useCallback(o=>{const p=o.deltaY<0?"in":"out";o.ctrlKey&&C.current!==p&&(S.zoom({zoomType:p,analyticsContext:f}),C.current=p)},[f]),V=B(),{data:R}=Q(),q=R&&J(R);return t.jsx(de.Provider,{value:f,children:t.jsxs("div",{ref:O,className:"flex h-full w-full flex-col items-center justify-between",onWheel:z,children:[m??t.jsx(me,{clientThreadId:n,imageAsset:e,mode:i,setMode:c,inpaintingDrawingState:I,isLoadingNewImage:a,onClose:r,onInpaintClick:F,messageId:u,serverThreadId:l}),t.jsx("div",{className:"relative flex w-full grow items-center justify-center",children:t.jsxs(ve,{imageAsset:e,containerDimensions:g,isLoadingNewImage:a,children:[j&&i!=="inpaint"&&t.jsx("img",{alt:b(e),className:"absolute inset-0 z-1 opacity-0",src:j}),!L&&t.jsx(De,{width:e.width,height:e.height}),t.jsx(he,{className:"h-full w-full",alt:b(e),onLoad:()=>{T(!0)},src:e.url,width:e.width,height:e.height,fadeIn:!1}),t.jsx("div",{className:P("absolute inset-0",i==="inpaint"?"":"hidden"),children:t.jsx(ye,{drawingCanvasRef:v,color:"rgba(0, 122, 255, 0.5)",dashedOutlineColor:"rgba(255, 255, 255, 0.65)",cursorWidth:je,canvasWidth:e.width,canvasHeight:e.height,currentDrawnShape:w,onNewDrawnShape:G})})]})}),t.jsx("div",{className:"flex min-h-[132px] w-full flex-col items-center justify-end max-sm:min-h-[84px]",children:t.jsx(M.div,{className:"mb-6 flex w-[90%] items-center justify-center lg:w-[53%]",layout:!0,transition:{duration:.2,ease:"easeInOut"},children:h??t.jsx(fe,{value:{isImageGenEditor:!0,isInpainting:i==="inpaint",onCancelInpaint:()=>c("default")},children:t.jsx(ee.Provider,{value:W,children:t.jsx(xe,{clientThreadId:n,isNewThread:se(n),currentModelId:H??te(V,q),onContinueGenerating:o=>E(ge(o)),onRequestCompletion:async o=>E(await pe(o)),hideHeader:!0})})})})})]})})}export{ke as ImageGenNewEditor,De as ShimmerLoader};
//# sourceMappingURL=kex6cs8ebljk8i05.js.map
