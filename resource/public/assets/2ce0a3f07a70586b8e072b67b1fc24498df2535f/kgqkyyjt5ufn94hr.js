import{at as R,j2 as B,o5 as F,fK as O,o6 as q,bu as L,o7 as N,cQ as Q,l9 as U}from"./cim4usely8ixso70.js";import{h as $,b as I,a as y,r as e,j as r,ah as G,f as z,O as H}from"./n97h6so7iblif4c5.js";import{W as J}from"./n4tsbq93vx9gfhx3.js";import{m as V,n as X,j as Y,W as Z,u as tt,o as st,k as et}from"./div7mikai9oktr1k.js";import{u as rt,W as ot}from"./jf0n0m1f0ndn0is6.js";import{u as at}from"./d4sun4qb1kdekaz8.js";import{K as d,d as x}from"./ivbsxyeeopn30y8l.js";import"./dtltw5so60m9d99q.js";import"./kgkkjgk15rr7n5rs.js";import"./h42ntto8gdpvwg72.js";import"./eiqndj5deifk5sx6.js";import"./j6dwj57mete4hl4s.js";import"./k45qpq5qounxd734.js";import"./ox1akcpm1f0j5d6a.js";import"./hu8l46l2cp0vm3yv.js";import"./gdos2bpc3gh55vkr.js";import"./gqfz6erng10c6vcd.js";import"./byjv95ft85soro10.js";import"./gbteqpxwv8l2z6qy.js";import"./fzrn137102spawew.js";import"./gh166jh358aafqk2.js";import"./g53q3aq6phlzyyxi.js";import"./ggc8598ndo8rm83w.js";import"./1x1n8bm92h1lz5ud.js";import"./k4l1dpzf5fkrs339.js";import"./b84ezng13dzite1x.js";import"./br155adl8dczy115.js";import"./ond0ck4gkjbbzc2w.js";import"./dkmxfpfv7adi2gnr.js";import"./lptwpbjabrvjmhsj.js";import"./fjinov8j0tzit9my.js";import"./hl263mv5vjd6fe09.js";import"./hh6y2dm7afl4jnkn.js";import"./glzukr9syvu7sajr.js";import"./dgg0wzb8m3bwp1ob.js";import"./dc0g1vvwfzc619ae.js";import"./lln26ytjpbr3ilrw.js";import"./iwqs8qhqagaobv5t.js";import"./0pr0i2ofpxcgwml5.js";import"./qt8c9lenu31o2obp.js";import"./bcnsse8l7ak9ome8.js";function nt({taskId:t,onClose:u}){const o=$(),l=R(),n=I(),m=y(),{data:s,error:b}=V(t),{isLoading:w}=X(t),W=Y(({getTurnsForTask:a})=>a(t)),c=B(),f=e.useMemo(()=>c?new O(q()):new F,[c]),k=L(f.isEmpty$),[C,p]=e.useState([]),[M,g]=e.useState(!1),{focusedAssistantTurn:i,setFocusedAssistantTurnId:j}=rt({taskId:t,task:s?.task,currentUserTurn:s?.current_user_turn??null,currentAssistantTurn:s?.current_assistant_turn??null}),S=s?.task?.current_turn_id,h=!!s?.task.has_unread_turn&&S===s.current_assistant_turn?.id,_=s?.current_assistant_turn?.turn_status==="completed";e.useEffect(()=>{if(!c)return;const a=s?.task?.title;if(a){const K=document.title;return document.title=a,()=>{document.title=K}}},[c,s?.task?.title]),e.useEffect(()=>{h&&_&&Z.markTurnAsRead(t).then(()=>{o.invalidateQueries({queryKey:["wham","tasks"]}),o.invalidateQueries({queryKey:["wham","task",t]})})},[h,_,t,o]),at(),tt([{key:"newTask",action:()=>{m("/codex",{state:{focusComposer:!0}})},actionMessageDescriptor:n.formatMessage({id:"wham.keyboardActions.newTask",defaultMessage:"New task"}),group:x.Chat,keyboardBinding:[d.Mod,d.Shift,"o"]},{key:"closeTask",action:()=>{m("/codex")},actionMessageDescriptor:n.formatMessage({id:"wham.keyboardActions.closeTask",defaultMessage:"Close task"}),group:x.Chat,keyboardBinding:[d.Escape]}]);const T=C.length>0,v=e.useCallback(({force:a=!1}={})=>{if(a||!T&&k){p([]),u();return}g(!0)},[u,T,k]),A=i?st(i.turn_status):!1,E=i?.sibling_turn_ids?.includes(s?.current_assistant_turn?.id??"")||i?.id===s?.current_assistant_turn?.id,P=!s?.current_diff_task_turn,D=A&&(E||P);return b?(l.danger({id:"wham.task-details.error",defaultMessage:"Error loading task",description:"Error message for failed to load task details"},{id:`wham-task-details-error-${t}`,hasCloseButton:!0,duration:3,toastId:"wham_task_page_content_error"}),r.jsx(G,{to:"/codex"})):r.jsx(N.Provider,{value:f,children:r.jsx(ot,{permissions:"write",taskId:t,turnId:s?.current_assistant_turn?.id??"",confirmClose:M,setConfirmClose:g,task:s?.task,focusedAssistantTurn:i,pastTurns:W,clearComments:()=>p([]),setComments:p,comments:C,canFollowUp:D,handleClose:v,setFocusedAssistantTurnId:j,loadingTurnMapping:w})})}function it(){const t=y(),u=z(),{taskId:o}=H();et();const l=u.state??{},{backgroundLocation:n}=l,m=e.useCallback(()=>{t(n?-1:"/codex")},[n,t]);return o?r.jsx(Q,{children:r.jsx(J,{children:r.jsx(nt,{taskId:o,onClose:m})})}):null}const Jt=()=>[{title:"Codex"}],Vt=U(function(){return r.jsx(it,{})});export{Vt as default,Jt as meta};
//# sourceMappingURL=kgqkyyjt5ufn94hr.js.map
