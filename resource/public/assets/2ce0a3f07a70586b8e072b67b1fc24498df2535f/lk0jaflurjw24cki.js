import{r as c,b as ie,j as t,z as le,A as O,m as J}from"./n97h6so7iblif4c5.js";import{h9 as ce,bV as ue,bp as de,dD as me,dn as fe,iK as R,iL as k,iM as z,iN as V,aG as W,iO as xe,iP as he,iQ as ge,iR as pe}from"./ivbsxyeeopn30y8l.js";import{bw as q,hP as X,aC as Y,bu as ee,kZ as ve,ic as Z,m0 as we,go as be,f3 as je,ih as ye,bx as D,bj as te,B as $,aJ as Ie,ev as G,h9 as H,P as _,a as ke,c as _e,e9 as Se,hW as B,aj as Ne,aI as ne,d as Ee,al as Re,bV as Ce}from"./cim4usely8ixso70.js";import{g as Le,u as Me,a as Te,b as Q}from"./k3ltkyteir6xs0v7.js";const se=c.createContext({imageList:[],activeIndex:null,isInFocusMode$:q(!1),isZoomed$:q(!1)}),C=()=>c.useContext(se);function F(){for(var e,n=0,s="",o=arguments.length;n<o;n++)(e=arguments[n])&&typeof e=="string"&&(s+=(s&&" ")+e);return s}const Ae="_lightbox_1ruyj_1",Pe={lightbox:Ae};function ze({imageList:e,forceDarkMode:n=!1,initialIndex:s,isInFocusMode$:o,onClose:l,onScrollToEnd:m,children:g}){const u=ie(),d=c.useRef(null),j=ce(),[r,w]=c.useState(s),h=X(),v=Y(),[p]=c.useState(()=>q((window.visualViewport?.scale??1)!==1)),f=ee(()=>p());c.useEffect(()=>{j.signalTransitionReady()},[j]),c.useEffect(()=>{if(f)return ve(()=>{p()||requestAnimationFrame(()=>{d.current?.querySelector(`[data-position="${r}"]`)?.scrollIntoView({behavior:"smooth",inline:"center",block:"center"})})})},[f,r,p]),c.useEffect(()=>{const i=()=>p.set((window.visualViewport?.scale??1)!==1);return window.visualViewport?.addEventListener("resize",i),()=>window.visualViewport?.removeEventListener("resize",i)},[p]),Z(()=>{d.current?.querySelector(`[data-position="${s}"]`)?.scrollIntoView({behavior:"instant",inline:"center",block:"center"})},[s]);const S=c.useCallback(i=>{w(i),requestAnimationFrame(()=>{const x=e[i]?.title;x&&we.setLiveRegionPolite(x)}),i===e.length-1&&m?.()},[e,m]);Z(()=>{const i=d.current;if(!i)return;const x=new IntersectionObserver(T=>{const A=T.reduce((E,P)=>P.isIntersecting&&(!E||P.intersectionRatio>E.intersectionRatio)?P:E,null);A&&A.target instanceof HTMLElement&&S(be(A.target.dataset.position))},{root:i,rootMargin:"0px -50% 0px -50%",threshold:0});for(const T of i.querySelectorAll(":scope > li"))x.observe(T);return()=>{x.disconnect()}},[e,S]);const y=e.length-1,b=c.useCallback(i=>{const x=Math.min(Math.max(r+i,0),y);S(x),requestAnimationFrame(()=>{d.current?.querySelector(`[data-position="${x}"]`)?.scrollIntoView({behavior:h?"instant":"smooth",block:"center",inline:"center"})})},[r,y,h,S]);c.useEffect(()=>{requestAnimationFrame(()=>{const i=document.querySelector("[data-lightbox-close-button]");i instanceof HTMLElement&&i.focus()})},[]),c.useEffect(()=>{const i=x=>{if(o?.()){x.key==="Escape"&&o.set(!1);return}x.key==="ArrowLeft"?r>0&&(x.preventDefault(),b(-1)):x.key==="ArrowRight"?r<y&&(x.preventDefault(),b(1)):x.key==="Escape"&&l(r)};return window.addEventListener("keydown",i),()=>{window.removeEventListener("keydown",i)}},[r,y,b,l,o]),c.useEffect(()=>{je(ye(),"chatgpt_web_image_library_lightbox_image_viewed")},[r]);const{footer:L,items:a,title:I,headerActions:M}=ue(g,{title:oe,items:ae,footer:re,headerActions:qe});return t.jsx(se.Provider,{value:{imageList:e,activeIndex:r,isInFocusMode$:o,isZoomed$:p},children:t.jsxs(D.Root,{testId:"modal-image-gen-lightbox",isOpen:!0,onClose:()=>l(r),shouldIgnoreClickOutside:v,className:F(v||n?"dark bg-black":"bg-token-bg-primary","flex h-dvh max-h-full w-dvw max-w-full flex-col place-content-center",Pe.lightbox),children:[t.jsxs("section",{className:"grid grid-cols-[auto_1fr_auto] items-start px-1.5 pt-1 [view-transition-name:var(--vt-page-title)] max-md:absolute max-md:start-0 max-md:end-0 max-md:top-0 max-md:items-center md:grid-cols-[1fr_auto_1fr] md:px-5 md:pt-2",children:[t.jsx("div",{className:"w-fit",children:t.jsx(de,{icon:te,"data-lightbox-close-button":!0,onClick:()=>l(r),"aria-label":u.formatMessage({id:"f08aLO",defaultMessage:"Close"})})}),!f&&I,(!f&&M)??t.jsx("div",{className:"w-8 shrink-0 basis-auto"})]}),t.jsxs("div",{className:"no-scrollbar flex h-full snap-y snap-mandatory flex-col overflow-y-scroll scroll-smooth",onScroll:i=>{i.target.scrollTop===0&&!p()&&l(r)},children:[t.jsx("div",{className:"h-[15dvh] flex-shrink-0"}),t.jsxs("ol",{ref:d,className:F("flex max-h-full min-h-0 flex-shrink-0 grow basis-full gap-[min(10dvw,_200px)] overflow-x-auto scroll-smooth [anchor-name:--carousel] [view-transition-name:var(--vt-image-carousel)] max-md:gap-0",v&&"no-scrollbar",!f&&"snap-x snap-mandatory snap-center snap-always py-15"),onClick:i=>{(i.target instanceof HTMLOListElement||i.target instanceof HTMLLIElement)&&(i.preventDefault(),l(r))},children:[t.jsx("li",{className:"w-[50vw] flex-shrink-0"}),a,t.jsx("li",{className:"w-[50vw] flex-shrink-0"})]}),t.jsx("div",{className:"h-[15dvh] flex-shrink-0"})]}),!f&&t.jsxs("div",{className:"pointer-events-none absolute inset-5 z-20 flex items-center justify-between [view-transition-name:var(--vt-scroll-buttons)] max-md:hidden",children:[t.jsx($,{className:"pointer-events-auto aspect-square",disabled:r===0,color:"secondary",icon:me,onClick:()=>b(-1),"aria-label":u.formatMessage({id:"iQsFWe",defaultMessage:"Previous image"})}),t.jsx($,{className:"pointer-events-auto aspect-square",color:"secondary",disabled:r===y,icon:fe,onClick:()=>b(1),"aria-label":u.formatMessage({id:"W7vnD4",defaultMessage:"Next image"})})]}),!f&&L]})})}function oe({children:e}){const{imageList:n,activeIndex:s}=C();if(s==null)return null;const o=n[s];return o?e(o):null}function ae({children:e}){const{imageList:n,isZoomed$:s,activeIndex:o}=C(),l=Y(),m=X(),g=ee(()=>s?.());return n.map((u,d)=>{const{width:j,height:r}=u,w=j!=null&&r!=null&&j===r;let h=null;o!=null&&(d===o?h="current":d+1===o?h="before":d-1===o&&(h="after"));const v=!l&&h!=="current";return t.jsx("li",{role:v?"button":void 0,className:F("flex max-h-full max-w-[70dvw] flex-shrink-0 snap-center items-center justify-center transition-opacity duration-0 motion-safe:duration-300 max-md:w-[100dvw] max-md:max-w-[100dvw] max-md:snap-always max-md:opacity-100",w&&"aspect-square",h==="current"||g?"opacity-100":"opacity-40"),"data-position":d,onClick:v?({currentTarget:p})=>p.scrollIntoView({behavior:m?"instant":"smooth",block:"center",inline:"center"}):void 0,children:e({...u,index:d,position:h})},u.id??u.url)})}function re({children:e}){const{imageList:n,activeIndex:s}=C();if(s==null)return null;const o=n[s];return o?t.jsx("footer",{className:"absolute bottom-0 z-10 flex w-full items-center justify-center px-5 pb-3 [view-transition-name:var(--vt-page-footer)] max-md:pb-6",children:e(o)}):null}function qe({children:e}){const n=[];return c.Children.forEach(e,s=>{c.isValidElement(s)&&s.type===De&&n.push(s)}),t.jsx("div",{className:"flex items-center justify-end gap-2",children:n.map((s,o)=>t.jsx(c.Fragment,{children:s},o))})}function De({children:e}){const{imageList:n,activeIndex:s}=C();return s==null||n[s]==null?null:e(n[s])}function Fe(e,n){const s=ne.getTurnContentReferences(e,n),o=xe(s),l=Oe(e,n);return he(o.concat(l),"content_url")}function Oe(e,n){const s=ne.getConversationTurnAtIndex(e,n).messages;return s?Ce(s.flatMap(o=>o.metadata?.image_results??[])).map(o=>({...o,thumbnail_url:o.thumbnail_url.replace(/^http:\/\//,"https://"),content_url:o.content_url.replace(/^http:\/\//,"https://")})):[]}function Ve(e,n,s,o){const{product:l}=ge({thread:e,messageId:n,contentReferenceStartIndex:s,productIndex:o});return!l||!l.image_urls?[]:l.image_urls.map(m=>({url:m,content_url:m,thumbnail_url:m,title:l.title,content_size:{width:0,height:0},thumbnail_size:{width:0,height:0}}))}function Je({clientThreadId:e}){const n=R.useCurrentImage();if(!n)return null;const{image:s,source:o,analyticsMetadata:l,contentReferenceStartIndex:m,productIndex:g}=n;if(o==null||e==null||l?.turnIndex==null)return t.jsx(N,{image:s,analyticsMetadata:{}});const u=Ie(e),d=function(){switch(o){case k.ProductDetails:return Ve(u,l.messageId,m,g);case k.SuperWidget:case k.ImageGroup:return n.imageResults;default:return Fe(u,l.turnIndex)}}();return t.jsx(N,{image:s,group:d,analyticsMetadata:l,groupSource:o})}function Xe(){const e=R.useCurrentImage();if(!e)return null;const{image:n,source:s}=e;if(s==null)return t.jsx(N,{image:n,analyticsMetadata:{}});switch(s){case k.ImagesTab:return t.jsx(We,{image:n});case k.Turn:return t.jsx(Ze,{image:n});default:return null}}function We({image:e}){const{imageResults:n}=Te();return t.jsx(N,{image:e,group:n,groupSource:k.ImagesTab,analyticsMetadata:{}})}function Ze({image:e}){const{imageResults:n}=Me();return t.jsx(N,{image:e,group:n,groupSource:k.Turn,analyticsMetadata:{}})}const K=Re.div`grow flex items-start p-8`,$e={enter:e=>({x:e>0?1e3:-1e3,opacity:0}),center:{zIndex:1,x:0,opacity:1},exit:e=>({zIndex:0,x:e<0?1e3:-1e3,opacity:0})},Ge=1e4,He=(e,n)=>Math.abs(e)*n;function N({image:e,group:n,groupSource:s,analyticsMetadata:o}){const l=c.useRef(null),m=e.attribution??z(e.url),g=R.useCurrentImage(),u=R.useStore(),d=g?.mountDirection;c.useEffect(()=>{window?.history?.state?.imageModalOpen||window.history.pushState({imageModalOpen:!0},"",window.location.href);const a=()=>{window?.history?.state?.imageModalOpen||u.setCurrentImage(void 0)};return window.addEventListener("popstate",a),()=>window.removeEventListener("popstate",a)},[u]);const j=e.content_url.replace(/^http:\/\//,"https://"),r=n?.findIndex(a=>G(e,a))??0,w=n?.length??1,h=r!=null&&w>1,v={...H(o),url:e.url,link_type:"text",section:"image",section_location:"response",section_index:(r+1).toString()};c.useEffect(()=>{l.current!==e.url&&(l.current=e.url,_.logEventWithStatsig("Search Content Reference Shown","search_content_reference_shown",{...H(o),type:"full_screen_image",url:e.url,image_url:j}),_.logEventWithStatsig("link_action","link_action",{...v,action:"show"}))},[j]);const p=()=>{window.history.go(-1),u.setCurrentImage(void 0)},f=c.useCallback(a=>{if(!h||n==null)return;const I=a==="next"?(r+1)%n.length:(r-1+n.length)%n.length;u.setCurrentImage({image:n[I],source:s,mountDirection:a==="next"?V.FromRight:V.FromLeft,analyticsMetadata:o,contentReferenceStartIndex:g?.contentReferenceStartIndex,productIndex:g?.productIndex,imageResults:g?.imageResults})},[h,n,u,r,s,o,g]);le({queries:(n??[]).map(a=>Le(a.thumbnail_url))});const y=ke(),b=_e(y,"2804795149"),L=c.useMemo(()=>n??[e],[n,e]);return c.useEffect(()=>{if(!b)return Se(document,{keydown:a=>{a.key==="ArrowRight"?f("next"):a.key==="ArrowLeft"&&f("prev")}})},[b,f]),b?t.jsxs(ze,{forceDarkMode:!0,imageList:L,initialIndex:r,onClose:p,children:[h&&t.jsx(oe,{children:a=>t.jsxs("div",{className:"text-token-text-tertiary shrink-0 px-4 py-2",children:[(n?.findIndex(I=>G(a,I))??0)+1," /"," ",w]})}),t.jsx(ae,{children:a=>t.jsx(U,{image:a,isNewLightbox:!0})}),t.jsx(re,{children:a=>t.jsx("div",{className:"flex w-full justify-start",children:t.jsx("div",{className:"w-fit rounded-xl backdrop-blur-xl",children:t.jsx(B,{onClick:()=>{_.logEventWithStatsig("link_action","link_action",{...v,action:"click"})},onMouseEnter:()=>{_.logEventWithStatsig("link_action","link_action",{...v,action:"hover"})},href:a.is_proxied_image?a.content_url:a.url,className:"flex min-h-20 w-fit shrink-0 items-center gap-8 px-4 py-2 text-sm hover:opacity-70",children:t.jsxs("div",{className:"flex grow flex-col gap-0.5 overflow-hidden pe-2",children:[t.jsxs("div",{className:"text-token-text-tertiary flex items-center gap-2 truncate",children:[t.jsx(W,{url:a.content_url,className:"rounded-sm",size:16}),a.attribution??z(a.url)]}),t.jsx("div",{className:"truncate font-semibold text-white",children:a.title})]})})})})})]}):t.jsx(O,{children:e&&t.jsx(D.Root,{isOpen:!0,onClose:p,testId:"modal-image-result",children:t.jsx(D.Overlay,{children:t.jsxs(Ne,{className:"flex h-full w-full flex-col bg-black/95",children:[t.jsxs("div",{className:"relative flex w-full grow justify-center overflow-hidden",children:[t.jsxs("div",{className:"absolute end-4 top-4 flex items-center sm:end-6 sm:top-6",children:[h&&t.jsxs("div",{className:"text-token-text-tertiary shrink-0 px-4 py-2",children:[r+1," / ",w]}),t.jsx("button",{onClick:a=>{a.stopPropagation(),p()},className:"flex h-9 w-9 items-center justify-center outline-hidden hover:opacity-70",children:t.jsx(te,{className:"h-6 w-6 text-gray-400"})})]}),w>1&&t.jsx(K,{className:"cursor-w-resize",onClick:a=>{a.stopPropagation(),f("prev")}}),t.jsx(O,{initial:!1,custom:d,children:t.jsx(J.div,{variants:$e,custom:d??0,className:"absolute top-24 bottom-4",initial:"enter",animate:"center",exit:"exit",transition:{x:{type:"spring",stiffness:300,damping:30},opacity:{duration:.2}},drag:w>1?"x":!1,dragConstraints:{left:0,right:0},dragElastic:1,onDragEnd:(a,{offset:I,velocity:M})=>{const i=He(I.x,M.x);i<-1e4?f("next"):i>Ge&&f("prev")},children:t.jsx(U,{image:e})},r)}),w>1&&t.jsx(K,{className:"cursor-e-resize",onClick:a=>{a.stopPropagation(),f("next")}})]}),t.jsx(B,{onClick:()=>{_.logEventWithStatsig("link_action","link_action",{...v,action:"click"})},onMouseEnter:()=>{_.logEventWithStatsig("link_action","link_action",{...v,action:"hover"})},href:e.is_proxied_image?e.content_url:e.url,className:"flex min-h-20 w-full shrink-0 items-center gap-8 px-6 pt-8 pb-3 text-sm hover:opacity-70 sm:px-8 sm:pb-8",children:t.jsxs("div",{className:"flex grow flex-col gap-0.5 overflow-hidden pe-2",children:[t.jsxs("div",{className:"text-token-text-tertiary flex items-center gap-2 truncate",children:[t.jsx(W,{url:e.content_url,className:"rounded-sm",size:16}),m??z(e.url)]}),t.jsx("div",{className:"truncate font-semibold text-white",children:e.title})]})})]})})})})}function U({image:e,isNewLightbox:n=!1}){const s=e.content_url.replace(/^http:\/\//,"https://"),o=e.thumbnail_url.replace(/^http:\/\//,"https://"),l=e.content_size.width/e.content_size.height,{isError:m}=Q(s),{isError:g}=Q(o),u=e.is_proxied_image?e.url:m?o:s;return!g||!m||e.is_proxied_image?t.jsx(J.img,{src:u,alt:e.title,style:{backgroundImage:o?`url(${o})`:void 0,backgroundSize:"contain",aspectRatio:l,backgroundPosition:"center",backgroundRepeat:"no-repeat"},initial:{opacity:0},animate:{opacity:1},className:Ee(n?"h-full max-w-full object-contain":"h-full max-w-[100vw] object-contain sm:max-w-[calc(100vw-10rem)]")}):t.jsx("div",{className:"flex h-full grow items-center justify-center",children:t.jsx("div",{className:"flex h-96 w-96 items-center justify-center bg-white/10",children:t.jsx(pe,{className:"text-token-text-tertiary h-12 w-12"})})})}export{Je as ImageLightbox,Xe as ImageLightboxSearchGPT};
//# sourceMappingURL=lk0jaflurjw24cki.js.map
