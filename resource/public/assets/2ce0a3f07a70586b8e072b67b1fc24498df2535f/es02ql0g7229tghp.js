import{r as u,j as o,A as w,M as h}from"./n97h6so7iblif4c5.js";import{aD as E,cA as D,m4 as T,cD as N,fA as A,aZ as $,a as U,c as W,P as F,d as v,aI as k}from"./cim4usely8ixso70.js";import{aW as z,aX as M,aY as G,aZ as y,a_ as L,a$ as O,b0 as B,aG as P}from"./ivbsxyeeopn30y8l.js";import{F as Z}from"./meak775b8bjpwsue.js";function j(t,e){const r=new RegExp(`<\\s*${e}\\s*>([\\s\\S]*?)<\\s*/\\s*${e}\\s*>`,"i"),d=t.match(r);return d&&d[1]?d[1].trim():t}function V(t){if(t===void 0)return;const e="Content Snippet:",r=t.indexOf(e);return r===-1?t:t.substring(r+e.length).trim()}function Y(t,e){e.text=V(t.contents),t.documentId?.includes("ks--slack")||e.cloud_doc_url?.match(/^https:\/\/github\.com\/[^/]+\/[^/]+\/(issues|pull)\/\d+/)?(e.text=void 0,e.name=`#${e.name}`):e.cloud_doc_url?.startsWith("https://docs.google.com/spreadsheets/")&&e.text!==void 0?e.text=j(e.text,"sheet_summary"):e.cloud_doc_url?.match(/^https:\/\/github\.com\/[^/]+\/[^/]+\/commit\//)&&e.text!==void 0?e.text=j(e.text,"git_summary"):e.cloud_doc_url?.match(/^https:\/\/github\.com\/[^/]+\/[^/]+\/blob\//)&&e.text!==void 0&&(e.text=j(e.text,"code_summary")),e.text&&(e.text=e.text.slice(0,250))}function H({turnIndex:t,clientThreadId:e}){const[r,d]=E(e,l=>[k.getTurnContentReferences(l,t),k.getConversationTurnAtIndex(l,t).messages]),p=D(e),m=u.useMemo(()=>({turnIndex:t,clientThreadId:e}),[e,t]),f=u.useMemo(()=>{const l=[],n=new Set;return r.forEach(s=>{s.type==="file"&&!n.has(s.id)?(l.push({id:s.id,name:s.name,cloud_doc_url:s.cloud_doc_url??s.extra?.cloud_doc_url,text:s.text}),n.add(s.id)):s.type==="file_navlist"&&s.items.forEach(c=>{n.has(c.id)||(l.push({name:c.name,cloud_doc_url:c.cloud_doc_url,text:c.description,id:c.id,lastModifiedTime:c.last_modified_time}),n.add(c.id))})}),l},[r]),i=T(p),_=u.useMemo(()=>{if(!i)return[];const l=[],n=new Set;for(const s of d)if(s.author.role===N.Tool&&s.author.name==="file_search"&&s.content.content_type===A.TetherBrowsingDisplay){const c=z(s.content.result),g=s.metadata?.cloud_doc_urls??[];c.chunks.forEach((a,b)=>{if(!a.documentId||n.has(a.documentId))return;n.add(a.documentId);let x;a.metadata.cloud_doc_url?x=a.metadata.cloud_doc_url.toString():b<g.length?x=g[b]:a.documentId.endsWith("--google")&&(x=`https://drive.google.com/file/d/${a.documentId.split("--")[1]}`);const S=a.metadata["File last modified at"]??a.metadata["File created at"],C={id:a.documentId,name:a.title,cloud_doc_url:x,text:a.contents,lastModifiedTime:S?S.toString():void 0};Y(a,C),l.push(C)})}return l},[i,d]);return o.jsx(w,{children:o.jsxs("div",{className:"bg-token-main-surface-primary mt-[calc(var(--threadFlyOut-leading-height,57px)*-1)] flex w-full flex-col",children:[o.jsx(I,{title:o.jsx(h,{id:"dlVlo6",defaultMessage:"Citations"}),items:f,clientThreadId:e,sectionId:"citations",analyticsMetadata:m}),o.jsx(I,{title:o.jsx(h,{id:"njZblE",defaultMessage:"Search Results"}),items:_,clientThreadId:e,sectionId:"search-results",analyticsMetadata:m})]})})}function I({title:t,items:e,scrollToHeader:r,shouldAnimateScroll:d,clientThreadId:p,analyticsMetadata:m,sectionId:f}){const i=u.useRef(null),_=u.useMemo(()=>m?{...m,sectionId:f,numResultsInSection:e.length}:void 0,[m,e.length,f]);return u.useEffect(()=>{i.current&&r&&setTimeout(()=>{i.current&&i.current.scrollIntoView({behavior:d?"smooth":"instant"})},300)},[r,d]),!e||e.length===0?null:o.jsxs("div",{ref:i,children:[o.jsx(M,{className:"border-token-border-sharp bg-token-main-surface-primary text-token-text-primary sticky top-0 z-1 flex h-[calc(var(--header-height,3.5rem)+1px)] items-center border-b px-6 pt-4 pb-4 text-sm font-medium",children:t}),o.jsx("div",{className:"flex list-none flex-col px-3 py-2",children:e.map((l,n)=>o.jsx(M,{index:n,children:o.jsx(q,{positionInSection:n,item:l,analyticsMetadata:_,clientThreadId:p},n)},`${t}-${n}`))})]})}function q({item:t,analyticsMetadata:e,positionInSection:r,clientThreadId:d}){const p=$(),m=U(),f=W(m,"1424158285"),i=G(t.cloud_doc_url??"");let _=i?.type??o.jsx(h,{id:"bqY3sN",defaultMessage:"File"}),l=i?.Icon??(t.cloud_doc_url?y:L);!t.cloud_doc_url&&!O(t.id)&&(_=o.jsx(h,{id:"hGgoxF",defaultMessage:"Source"}),l=y);const[n,s]=u.useState(!1),c=t.cloud_doc_url?t.cloud_doc_url:"";f&&c.length>0&&(l=({className:x})=>o.jsx(P,{url:c,className:v(x,"object-cover"),size:32,minSize:20,fallback:o.jsx(y,{className:x})}));const g=u.useCallback(()=>{e&&F.logEventWithStatsig("File Sources Sidebar Item Clicked","file_sources_sidebar_link_clicked",{...e,positionInSection:r,sourceType:i?.type,hasUrl:!!t.cloud_doc_url})},[e,t.cloud_doc_url,i?.type,r]),a=u.useCallback(()=>{e&&F.logEventWithStatsig("File Source Sidebar Item Followup Clicked","file_sources_sidebar_item_followup_clicked",{...e,positionInSection:r,sourceType:i?.type,hasUrl:!!t.cloud_doc_url})},[e,t.cloud_doc_url,i?.type,r]);return o.jsx(o.Fragment,{children:o.jsxs("a",{href:t.cloud_doc_url,target:"_blank",rel:"noreferrer",onClick:g,className:v("group relative flex flex-col gap-0.5 rounded-xl px-3 py-2.5","hover:bg-token-main-surface-secondary",n&&"bg-token-main-surface-secondary"),children:[o.jsxs("div",{className:"line-clamp-1 flex h-6 items-center gap-2 text-xs",children:[l&&o.jsx(l,{className:"icon-sm bg-token-main-surface-primary rounded-full object-cover"}),_]}),o.jsx("div",{className:"line-clamp-2 text-sm font-semibold break-words",children:t.name}),(t.text??t.lastModifiedTime)&&o.jsxs("div",{className:"text-token-text-secondary line-clamp-2 text-sm leading-snug font-normal",children:[t.lastModifiedTime&&o.jsxs("span",{children:[o.jsx(B,{date:new Date(t.lastModifiedTime.trim())}),t.text&&" â€” "]}),t.text]}),p?null:o.jsx(Z,{className:v("absolute end-2 top-2 flex h-7 w-7 items-center justify-center rounded-sm p-1 transition","text-token-text-secondary group-hover:text-token-text-primary","invisible group-hover:visible","bg-token-main-surface-secondary hover:bg-token-main-surface-tertiary",n&&"bg-token-main-surface-tertiary text-token-text-primary visible"),clientThreadId:d,fileId:t.id,fileName:t.name,fileCloudDocUrl:t.cloud_doc_url,isFollowupMenuOpen:n,setIsFollowupMenuOpen:s,trackFileSourceFollowup:a})]})})}export{H as ChatScreenRetrievalResultsFlyoutContent,I as SourcesListGroup};
//# sourceMappingURL=es02ql0g7229tghp.js.map
