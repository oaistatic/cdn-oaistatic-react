import{l9 as N,a as E,cr as P,n3 as M,R as v,aw as b,P as l,aS as W,n4 as T,B as w}from"./cim4usely8ixso70.js";import{r as h,N as U,l as I,j as e,b as _,M as o}from"./n97h6so7iblif4c5.js";import{$ as L}from"./ivbsxyeeopn30y8l.js";import{N as g,U as d,W as R,a as B,C as O}from"./bhddj8o0r8yu170k.js";function $(t,n){setTimeout(()=>{window.location.href=n},t*1e3)}const V=N(function(){const n=E(),[r,c]=h.useState(!1),{session:u,isLoading:m}=P(),{phoneNumber:s,proof:S,nextAction:f,entityId:j}=U(),k=f===g.Authenticate,C=f===g.LinkAccount&&!r,y=f===g.LinkAccount&&r,{mutate:p,isPending:A}=I({mutationFn:async a=>{try{if(a===d.Cancel)return{success:!1};if(!u||m)return{success:!1,errorCode:M.SessionExpired};const{success:x,error_code:i}=await v.safePost("/moodeng/account_linking",{requestBody:{proof:S,identifier:s},authOption:b.Required});return{success:x,errorCode:i}}catch{return{success:!1}}},onSuccess:(a,x)=>{if(!a.success&&x===d.Cancel){window.location.href=R;return}else if(!a.success){const i=new URLSearchParams;i.set("reason",a.errorCode??""),i.set("wid",j??""),window.location.href=`/account-link/error?${i.toString()}`;return}return c(!0),$(2,B)}});return h.useEffect(()=>{if(k){if(!s)return;l.logEventWithStatsig("Account Link: Redirect to Authenticate","chatgpt_account_link_redirect_authenticate"),W(n,{authType:"signup",callbackUrl:`${location.pathname}${location.search}${location.hash}`,additionalAuthParams:{[T]:"true"}})}},[k,s,n]),e.jsxs("div",{className:"mx-auto w-full max-w-sm sm:max-w-md",children:[C&&e.jsx(H,{phoneNumber:s,onAllowClick:()=>p(d.Allow),onCancelClick:()=>p(d.Cancel),isOnAllowClickPending:A,isOnCancelClickPending:A}),y&&e.jsx(q,{})]})});function H({phoneNumber:t,onAllowClick:n,onCancelClick:r,isOnAllowClickPending:c,isOnCancelClickPending:u}){const m=_();return h.useEffect(()=>{l.logEventWithStatsig("Account Link: Confirm UI Shown","chatgpt_account_link_confirm_ui_shown")},[]),e.jsxs("div",{className:"flex w-full flex-col items-center justify-center px-4 py-10",children:[e.jsx("header",{className:"oai-header",children:e.jsx(L,{alt:m.formatMessage({id:"login.openAiLogo",defaultMessage:"OpenAI Logo"}),className:"h-10 w-10"})}),e.jsx("h1",{className:"mt-10 text-center text-3xl font-semibold",children:e.jsx(o,{id:"account-link.confirm.title",defaultMessage:"Confirm account linking"})}),e.jsx("p",{className:"text-token-text-secondary mt-6 text-center",children:e.jsx(o,{id:"account-link.confirm-link.description",defaultMessage:'By clicking "Allow", your WhatsApp number {phoneValue} and conversations will be linked to your ChatGPT account and subject to data cotrols in your account settings. <learnMoreLink>Learn more.</learnMoreLink>',values:{phoneValue:t,learnMoreLink:s=>e.jsx("a",{href:O,target:"_blank",rel:"noopener noreferrer",className:"text-token-link hover:text-token-link-hover",children:s})}})}),e.jsxs("div",{className:"mt-6 flex w-full flex-col gap-3",children:[e.jsx(w,{className:"w-full rounded-md",color:"green",type:"submit",onClick:()=>{l.logEventWithStatsig('Account Link: "Allow WhatsApp Linking" Button Clicked',"chatgpt_account_link_allow_clicked"),n()},disabled:c||u,loading:c,children:e.jsx(o,{id:"account-link.confirm.button",defaultMessage:"Allow"})}),e.jsx(w,{className:"w-full rounded-md",color:"secondary",onClick:()=>{l.logEventWithStatsig('Account Link: "Cancel WhatsApp Linking" Button Clicked',"chatgpt_account_link_cancel_clicked"),r()},disabled:u||c,children:e.jsx(o,{id:"account-link.confirm.cancel",defaultMessage:"Cancel"})})]})]})}function q(){const t=_();return h.useEffect(()=>{l.logEventWithStatsig("Account Link: Success","chatgpt_account_link_success")},[]),e.jsxs("div",{className:"flex w-full flex-col items-center justify-center px-4 py-10",children:[e.jsx("header",{className:"oai-header",children:e.jsx(L,{alt:t.formatMessage({id:"login.openAiLogo",defaultMessage:"OpenAI Logo"}),className:"h-10 w-10"})}),e.jsx("h1",{className:"mt-10 text-center text-3xl font-semibold",children:e.jsx(o,{id:"account-link.success.title",defaultMessage:"Successfully linked your ChatGPT account"})}),e.jsx("p",{className:"text-token-text-secondary mt-6 text-center",children:e.jsx(o,{id:"account-link.success.description",defaultMessage:"You can now close this window and return to WhatsApp, or you will be automatically redirected momentarily."})})]})}export{V as default};
//# sourceMappingURL=lgqkv5leydo3skgf.js.map
