import{r as l,ao as Q,o as Z,b as ee,j as o,A as te,m as v}from"./n97h6so7iblif4c5.js";import{hh as _,go as se,aV as W,aD as H,aI as w,gx as ae,aL as ne,i9 as oe,fH as ie,hp as O,eM as re,fL as ce,bW as j,q0 as de,ny as le,ob as ue}from"./cim4usely8ixso70.js";import{kk as me,ln as V,lo as he,C as f,lp as pe,lq as fe,h7 as ge,lr as xe,u as U,ls as Ce,lt as ve,lm as Te,lu as be,lv as we,lw as Ie,lx as k,ly as G,lk as Se,lz as ye,bH as M,lA as L,lB as P,lC as Ee,lD as Ae,lE as _e}from"./ivbsxyeeopn30y8l.js";import{L as Ne}from"./ltncr5s1j4b4kz0c.js";import{T as Re}from"./hxd4ri96xuxv35dx.js";import{g as De}from"./btagl6w1gub4aw61.js";import"./jy1u8exw8iz2slve.js";import"./hl263mv5vjd6fe09.js";import"./mrd3z2p5ccxe8mcf.js";import"./i8vgytiaizzymmdx.js";import"./bcnsse8l7ak9ome8.js";import"./grt0jtahkb4l594u.js";import"./bfek75jeyiiysrf0.js";import"./fn23ljzmd7fz7cdu.js";import"./hd79rgnyf5hfs3gj.js";import"./gy64pge8qevmvg7e.js";import"./lnrdu7695dtoyi0c.js";import"./d7iwo69sk89c6my3.js";import"./c4vbhkqdiicfwhk9.js";import"./mfrmh8iqcq7c5rho.js";import"./dv0x3wwg6vtgq24d.js";import"./hh6y2dm7afl4jnkn.js";import"./bk8slwxjkdlmxjxm.js";import"./0pr0i2ofpxcgwml5.js";import"./qt8c9lenu31o2obp.js";import"./k5qf6pgck1wqkdil.js";import"./jdpqs7fyetm56n9m.js";import"./nswfjkfs26me74ly.js";import"./os50xu2ctps3mt97.js";import"./cxo3s9z32l5kx9bi.js";const z="oai/apps/canmoreSidebarWidth",Me=.25,Fe=400,B=400;function q(e){return e-Fe}function E(e,s){return Q(B,q(e),s??Me*e)}function We(){const e=_.useState(_.selectWindowWidth),s=E(e,se(W.DANGER_SECRET_FOLDERS_ONLY_getItem(z))),a=K(),[t,i]=l.useState(s);l.useEffect(()=>{(t<B||t>q(e))&&i(E(e,t))},[e]);function r(u){i(h=>E(e,h+=u.delta.x))}function n(u){i(u),W.DANGER_SECRET_FOLDERS_ONLY_setItem(z,u)}function c(){const u=E(e,void 0);n(u)}const d=`calc(100vw - ${t}px)`;return a?{chatWidth:t,canvasWidth:e-t,canvasWidthCalc:d,viewportWidth:e,handleDrag:r,handleDoubleClick:c,persist:n}:{chatWidth:0,canvasWidth:e,canvasWidthCalc:"100vw",viewportWidth:e,handleDrag:()=>{},handleDoubleClick:()=>{},persist:()=>{}}}function K(e){const s=_.useState(_.selectWindowWidth);return(e??s)>1e3}const D="sharedCanvas";function Oe(){const[e,s]=Z(),a=e.get(D),t=ee();l.useEffect(()=>{const i=a&&me.createRemixTempTextdoc(a,t);if(!i)return;requestAnimationFrame(()=>{V(i)});const r=new URLSearchParams(e);r.delete(D),s(r);const n=new URL(window.location.href);n.searchParams.delete(D),history.replaceState(null,"",n)},[a,e,s,t])}const je="textdocId",ke=e=>{const a=new URLSearchParams(window.location.search).get(je),t=H(e,i=>w.findNode(i,({message:r})=>{const n=r.metadata?.canvas;return n?.create_source===he.HIVE&&(a?n?.textdoc_id===a:!0)})?.message.metadata?.canvas?.textdoc_id);l.useEffect(()=>{t&&requestAnimationFrame(()=>{V(t)})},[t])};function Le(e,s){let a;return s?.type===f.Textdoc?s.textdocId.startsWith(pe)||(a={type:"canvas_textdoc",id:s.textdocId}):s?.type===f.Kanzi&&(a={type:"canvas_kanzi",id:s.kanziTurnId}),fe(e,{promptMessage:{metadata:{open_in_canvas_view:a}}})}const Y=({isFullScreen:e=!1,clientThreadId:s,focusedObject:a,onClose:t,isAnimating:i=!1,width:r})=>{const{setTargetedContent:n}=ge(),c=l.useRef(!1);if(l.useEffect(()=>(c.current&&n(void 0),c.current=!0,()=>{c.current=!1}),[a]),a==null)return null;switch(a.type){case f.Textdoc:return o.jsx(Re,{isFullScreen:e,onClose:t,clientThreadId:s,focusedTextdoc:a,isAnimating:i,width:r});case f.Kanzi:break;case f.ADAVisualization:return null}},Pe=300,ze=e=>{switch(e?.type){case f.Textdoc:return e.textdocId;case f.Kanzi:return null;default:return null}};function He(e,s){const[a,t,i,r]=H(e,m=>[w.getRequestId(m),w.getConversationLastTurn(m),w.isMessageTurnEnded(m),w.getVariantIds(m).length>1],{disablePerfDetector:!0}),n=ae(a),c=xe(),d=U(),[u,h]=l.useMemo(()=>{if(t&&r)return[void 0,null];if(s===!0)return[void 0,null];let m;return!i&&t&&(m=ne(t.messageGroups,C=>C.type!==oe)),Ve({groupedMessage:m,currentlyFocusedObject:d,isRequestActive:n,latestTextdocId:c})},[i,t,r,d,s,n,c]),I=h!=null,T=ze(h),N=Ce("canvas");l.useEffect(()=>{if(h&&u&&!ie()&&(N(),ve(h,u),h.type===f.Textdoc)){const{textdocId:m}=h,C=De(m);Te(document.getElementById(C))}},[I,T])}function Ve({groupedMessage:e,currentlyFocusedObject:s,isRequestActive:a,latestTextdocId:t}){switch(e?.type){case O.Canmore:{const[i,r]=e.messages;if(!be(i))break;const n=we(a,i,r??null),c=n.textdocId??t;if(c&&(n.function===Ie.CreateTextdoc?(n.content??"").length>Pe||n.status===k.WAITING:n.status===k.STREAMING))return[n.messageId,{type:f.Textdoc,textdocId:c}];break}case O.kanzi:break}return[void 0,null]}const A={type:"spring",bounce:.12,duration:.64},Ue={type:"spring",bounce:0,duration:.58},x={duration:0},Ge=({clientThreadId:e,focusedObject:s,onClose:a})=>{const{chatWidth:t,canvasWidthCalc:i,handleDrag:r,handleDoubleClick:n,persist:c}=We(),d=M(),[u,h]=l.useState(!d),[I,T]=l.useState(!1),N=d?x:A,m=d?x:Ue,C=Ee(({rect:p})=>p),{windowHeight:b,windowWidth:S}=le(p=>p,{windowWidth:0,windowHeight:0});let g=C??{top:0,left:t,width:S-t,height:b},F=!1;if(C&&(g.top<0||g.top+g.height>b)){F=!0;const p={width:(S-t)*.75,height:b*.75};g={top:b/2-p.height/2,left:(S-t-p.width)/2+t,width:p.width,height:p.height}}const y=C?.borderRadius,R=Ae(),X=R?.history!=null||R?.showChangesAtVersion!=null,$=ue();return o.jsxs(o.Fragment,{children:[X&&o.jsx(Ne,{onClick:()=>_e(R.textdocId),zIndexKey:"chatOverlay"}),o.jsxs(v.div,{initial:{marginInlineEnd:$?-260:0},animate:{marginInlineEnd:0},transition:m,children:[o.jsx(v.div,{initial:{opacity:1},animate:{opacity:0},exit:{opacity:[1,0]},transition:d?x:{...A,delay:.22},className:"bg-token-main-surface-primary pointer-events-none absolute start-0 top-0 z-20 h-full w-full"}),o.jsx(v.div,{className:"relative z-20 h-full",style:{width:i},exit:{width:0},transition:d?x:{type:"spring",bounce:0,duration:.1}})]}),o.jsx(v.div,{className:"bg-token-bg-primary absolute start-0 z-20 h-full overflow-hidden transition-shadow",initial:{borderRadius:y,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)",opacity:F?0:1,x:g.left,y:g.top,height:g.height,width:g.width},animate:{opacity:1,x:t,y:0,width:i,height:b,borderRadius:0,boxShadow:"0px 0px 18px rgba(0,0,0,0.075)"},exit:{scale:.64,opacity:0,filter:"blur(12px)",transition:d?x:{opacity:{duration:.14,bounce:.1}},borderRadius:y,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)"},transition:I||d?x:A,onAnimationComplete:()=>h(!1),children:o.jsx(v.div,{className:"dark:border-token-border-medium h-full overflow-hidden border-s border-gray-100",initial:{borderRadius:y},animate:{borderRadius:0},exit:{borderRadius:y},transition:N,children:o.jsxs("div",{className:"h-full",children:[o.jsx(v.div,{drag:"x",className:"bg-token-text-quaternary absolute start-[-2px] z-10 h-full w-[4px] cursor-ew-resize opacity-0",whileHover:{opacity:.5},whileDrag:{opacity:.75,width:"8px",left:"-4px"},transition:d?x:{type:"tween",duration:.1},style:{x:0,y:0,transform:"translateX(0px)"},dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:{left:0,right:0,top:0,bottom:0},onPointerDown:()=>T(!0),onPointerUp:()=>T(!1),onDrag:(p,J)=>r(J),onDragEnd:()=>{T(!1),c(t)},onDoubleClick:()=>n()}),I&&o.jsx("div",{className:"absolute inset-0 z-10"}),o.jsx(Y,{onClose:a,clientThreadId:e,isAnimating:!d&&u,focusedObject:s,width:S-t})]})})})]})},Be=l.memo(Ge),qe=({clientThreadId:e,focusedObject:s,onClose:a})=>{const t=M();return o.jsx(de,{open:!0,className:"fixed inset-0 z-50 h-full w-full",children:o.jsx(v.div,{className:"z-40 h-full w-full overflow-hidden shadow-xl md:border-gray-100 md:dark:border-gray-700",initial:{scale:.98},animate:{scale:1},transition:t?x:A,children:o.jsx(Y,{isFullScreen:!0,clientThreadId:e,focusedObject:s,onClose:a})})})},Ke=({clientThreadId:e,overrideWidth:s,isAutoFocusDisabled:a=!1})=>{const t=U(),i=K(s)&&!ce(ye,t?.type),r=M();He(e,a||r),Oe(),ke(e),l.useEffect(()=>{G()},[e]);const n=t&&(i?o.jsx(Be,{clientThreadId:e,onClose:P,focusedObject:t},"canvas-sidebar"):o.jsx(qe,{clientThreadId:e,onClose:P,focusedObject:t},"canvas-modal"));l.useEffect(()=>{if(t)return L(d=>Le(d,t)),()=>L(null)},[t]);const c=n!=null;return l.useEffect(()=>(j.setActiveStageSidebar(c),()=>{c&&j.setActiveStageSidebar(!1)}),[c]),r?o.jsx("div",{children:n},e):o.jsx(te,{children:n},e)},St=e=>{const s=l.useRef(null);return o.jsx(re,{ref:s,onError:(a,t)=>{G(),setTimeout(()=>{s.current?.resetErrorBoundary()}),Se.logError("Error boundary hit",a,{componentStack:t})},name:"canmore-focused-view",children:o.jsx(Ke,{...e})})};export{St as CanvasFocusedViewManager};
//# sourceMappingURL=d0o9rh040g5gsnnk.js.map
