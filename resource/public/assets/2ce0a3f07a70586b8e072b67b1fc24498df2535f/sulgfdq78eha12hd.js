import{hv as _,i as p,hG as h,hu as w,bb as g,a as y,p as S,m1 as b,aU as l,aV as u,aD as F,aI as E,F as c,v as m,x as d,nj as I,R as V,ad as x}from"./cim4usely8ixso70.js";import{u as f,r as i}from"./n97h6so7iblif4c5.js";import{aI as T}from"./ivbsxyeeopn30y8l.js";function H(){const t=g(),a=y(),e=S(a);return t&&!b(t)&&e?.isEnterprisey()}function R(){return _(p.ChartSerialization)}function q(t,a){const e=t==="chart"?l.HasSeenAdaInteractiveChart:l.HasSeenAdaInteractiveTable,[s,o]=i.useState(u.getItem(e,{userId:a})??!1),n=i.useCallback(()=>{o(!0),u.setItem(e,!0,{userId:a})},[e,a]);return[s,n]}function M(t){const[a,e]=i.useState([]),s=F(t,E.getBranch);return i.useEffect(()=>{const o=A(s);o.length!==a.length&&e(o)},[a.length,t,s]),a}function z(t){const a=t.metadata?.aggregate_result?.messages.filter(T)??[];let e=0;const s=(t.metadata?.ada_visualizations??[]).map(n=>{let r=n;return n.type=="chart"&&(r={...n,fallback_image:a[e++]}),r}),o=(t.metadata?.attachments??[]).filter(n=>h(n.name)).map(n=>({type:"table",file_id:n.id??"",title:w(n),file_name:n.name,context_connector_info:n.context_connector_info}));return[...s,...o]}function A(t){return t.filter(e=>e.message?.author.role==="tool"&&e.message?.author.name==="python"||(e.message?.metadata?.attachments??[]).length>0).flatMap(e=>z(e.message))}async function L(t,a,e){const s=await t.text(),{parse:o}=await x(async()=>{const{parse:r}=await import("./oeujip5i1ptrxie5.js");return{parse:r}},[]),n=o(s);return{content:{columnNames:n.shift(),columnTypes:n[0].map(()=>"string"),rows:n},file_name:a,download_url:e}}function v(t){const a=t[0].values.length,e=[];for(let s=0;s<a;s++){const o=t.map(n=>n.values[s]);e.push(o)}return e}function O(t){return f({queryKey:["ada-visualization","chart",t.file_id],queryFn:async()=>{const a=await m(t.file_id);if(a.status===d.Success){const e=await fetch(a.download_url);if(e.status!==200)throw new Error("Failed to download chart json from interpreter");const s=await e.json();return{content:{chart_type:s.type,title:s.title,labels:s.labels,datasets:s.datasets,x_label:s.x_label,y_label:s.y_label},file_name:a.file_name??"",download_url:a.download_url}}else throw new Error("Failed to download chart json from interpreter")},staleTime:c})}function j(t){return f({queryKey:["ada-visualization","table",t.file_id],queryFn:async()=>{if(t.file_name&&I(t.file_name)){const a=await V.safeGet("/ada/parse_xls/{file_id}",{parameters:{path:{file_id:t.file_id}}});return{content:a.sheets.map(e=>({name:e.name,columnNames:e.columns.map(s=>s.name),columnTypes:e.columns.map(()=>"string"),rows:v(e.columns)})),download_url:a.download_url,file_name:t.file_name}}else{const a=await m(t.file_id);if(a.status===d.Success){const e=await fetch(a.download_url);return L(e,a.file_name??"",a.download_url)}else throw new Error("Failed to download from interpreter")}},staleTime:c,throwOnError:!1})}export{M as a,j as b,O as c,H as d,q as e,z as g,R as u};
//# sourceMappingURL=sulgfdq78eha12hd.js.map
