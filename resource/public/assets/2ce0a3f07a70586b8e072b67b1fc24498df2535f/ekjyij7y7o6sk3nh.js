import{b as B,r as f,j as G,n as a}from"./n97h6so7iblif4c5.js";import{h as z,a as W,p as j,l_ as U,dC as V,i9 as K,lN as L,m5 as Q,gl as J,aD as q,fA as v,aG as M,P as w,a6 as H,R as X,aw as Y,hd as S,hp as l,eG as Z,i as $,aI as ee,cD as te}from"./cim4usely8ixso70.js";import{b6 as ae,b7 as se,b8 as ne,b9 as oe,ba as le}from"./ivbsxyeeopn30y8l.js";const I=(...e)=>t=>e.some(o=>o(t)),C=({allGroupedMessages:e})=>e.some(t=>t.type===l.Browsing||t.type===l.RetrievalBrowsing||t.type===l.ParallelBrowsing),T=({allGroupedMessages:e})=>e.some(t=>t.type===l.SearchGPTQuery),ie=({allGroupedMessages:e})=>e.some(t=>t.type===l.Text&&t.messages.some(o=>o.metadata?.content_references?.some(n=>n.type==="products"||n.type==="product_entity"))),de=({allGroupedMessages:e})=>e.some(t=>t.type===l.Text&&t.messages[0]?.metadata?.followup_prompts?.length),F=({allGroupedMessages:e})=>e.some(t=>t.type===l.CodeInterpreter);function ce(e){return!e||!e.instructions?"":typeof e.instructions=="string"?e.instructions:e.instructions.filter(t=>typeof t=="string").join("")}const x={"Didn't fully follow instructions":{tag:"Didn't fully follow instructions",label:a({id:"Rdlt9V",defaultMessage:"Didn't fully follow instructions"})}},re=[{match:ie,tag:"Shouldn't have shown products",label:a({id:"HMKFPm",defaultMessage:"Shouldn't have shown products"}),forceRefreshExcluding:"commerce"},{match:I(C,T),tag:"Shouldn't have searched the web",label:a({id:"kL047b",defaultMessage:"Shouldn't have searched the web"})},{match:de,tag:"Don't like the followups",label:a({id:"xAFgPE",defaultMessage:"Don’t like the suggested follow ups"})},{match:I(C,T),tag:"Don't like the source it cited",label:a({id:"OWjzGX",defaultMessage:"Don't like the sources it cited"})},{match:F,tag:"Shouldn't have run code",label:a({id:"53w4ay",defaultMessage:"Shouldn't have run code"})},{match:F,tag:"Couldn't handle my file",label:a({id:"EkFTQ5",defaultMessage:"Couldn't handle my file"})},{match:({allGroupedMessages:e})=>e.some(t=>t.type===l.Dalle),tag:"Shouldn't have created an image",label:a({id:"S8FRsr",defaultMessage:"Shouldn't have created an image"})},{match:({allGroupedMessages:e})=>e.some(t=>{if(t.type!==l.Text)return!1;const o=t.messages[0],{content:n}=o;return n.content_type===v.Text&&Z(o).match(/^```[\S]+\n/gm)}),tag:"Code was incorrect",label:a({id:"4EBdQk",defaultMessage:"Code was incorrect"})},{match:({systemContent:e})=>ce(e).includes("Personality")??!1,tag:"Too chatty or casual",label:a({id:"ATzJKW",defaultMessage:"Too chatty or casual"})},{match:({isBusinessWorkspace:e})=>e,tag:"File upload not working as expected",label:a({id:"Pv0EgM",defaultMessage:"File upload not working as expected"})},{match:({isBusinessWorkspace:e,hasCaConnection:t})=>e&&t,tag:"Should have triggered Internal knowledge",label:a({id:"DJc0pt",defaultMessage:"Should have triggered Internal knowledge"})},{match:({features:e})=>e.includes($.Sunshine),tag:"Shouldn't have used Memory",label:a({id:"yfUEiz",defaultMessage:"Shouldn't have used Memory"})},{tag:"Don’t like the personality",label:a({id:"6Yz27f",defaultMessage:"Don’t like the personality"})},{tag:"Don't like the style",label:a({id:"nGxjdj",defaultMessage:"Don't like the style"})},{tag:"Not factually correct",label:a({id:"Ke7JtQ",defaultMessage:"Not factually correct"})},{...x["Didn't fully follow instructions"],match:({isBusinessWorkspace:e})=>!e},{tag:"Refused when it shouldn't have",label:a({id:"2yRS/Q",defaultMessage:"Refused when it shouldn't have"})},{match:({isBusinessWorkspace:e})=>!e,tag:"Being lazy",label:a({id:"14MPmT",defaultMessage:"Being lazy"})},{tag:"Unsafe or problematic",label:a({id:"02pXBl",defaultMessage:"Unsafe or problematic"})},{tag:"Biased",label:a({id:"pK35DW",defaultMessage:"Biased"})},{tag:"Other",label:a({id:"WiIGE+",defaultMessage:"Other"})}],ue=[{tag:"I disagree with the policy",label:a({id:"oKyDLz",defaultMessage:"I disagree with the policy"})},{tag:"This didn't violate the policy",label:a({id:"7fUkVF",defaultMessage:"This didn't violate the policy"})},{tag:"I don't understand the policy",label:a({id:"4Cdp6N",defaultMessage:"I don't understand the policy"})},{tag:"This didn't take the full context",label:a({id:"vnZJDP",defaultMessage:"This didn't take the full context"})}],ge=[{tag:"Shouldn't have triggered Internal knowledge",label:a({id:"ILVpD8",defaultMessage:"Shouldn't have triggered Internal knowledge"})},{tag:"I specified what data to use and it was wrong",label:a({id:"ziFYwZ",defaultMessage:"I specified what data to use and it was wrong"})},{tag:"Missing relevant Internal knowledge",label:a({id:"PobbBn",defaultMessage:"Missing relevant Internal knowledge"})},{tag:"Inaccurate information",label:a({id:"HbcEAV",defaultMessage:"Inaccurate information"})},{tag:"Response not relevant or helpful",label:a({id:"k2/tlU",defaultMessage:"Response not relevant or helpful"})},{...x["Didn't fully follow instructions"]},{tag:"I don't like the model tone",label:a({id:"PT9XqK",defaultMessage:"I don't like the model tone"})}];function he(e,t,o){return t.filter(n=>!n.match||n.match(o)).map(n=>({value:n.tag,label:e.formatMessage(n.label),forceRefreshExcluding:n.forceRefreshExcluding}))}function fe(e){const t=oe(e);return t!=null&&(t.errCode===S.ContentPolicy||t.errCode===S.ContentOrTos)}function ke({clientThreadId:e,conversationMessage:t,currentModelId:o,allGroupedMessages:n}){const E=B(),D=z()??[],i=t.clientMetadata?.rating,_=W(),u=j(_)?.isWorkspacePlan()??!1,b=U(),m=V(),g=f.useMemo(()=>m&&n.some(s=>s.type!==K&&s.messages?.some(L)),[n,m]),h=Q()??!1,R=ae({clientThreadId:e}),p=f.useRef(J(s=>{R(s)},500)).current,y=q(e,s=>ee.findNode(s,d=>d.message.author.role===te.System&&d.message.content.content_type==="system_content")),P=y?.message.content.content_type===v.SystemContent?y?.message.content:null,O=f.useCallback(s=>{const d=M(e);if(!d||s.tags.length===0&&!s.textFeedback)return;const c=s.tags.map(r=>r.value);w.logEvent(s.source==="inline"?"Message Feedback Inline Submitted":"Message Feedback Dialog Submitted",{id:t.id,threadId:d,tags:c,content:s.textFeedback,model:o,rating:i}),H.logEvent(s.source==="inline"?"chatgpt_feedback_inline_submitted":"chatgpt_feedback_dialog_submitted",c?.[0]??null,{id:t.id,threadId:d,tag:c?.[0]??"",content:s.textFeedback??"",model:o??"",rating:i??"",...h?{isCaTriggered:String(g)}:{}}),i&&(u&&b?se({rating:le(i),text:s.textFeedback,tags:c,tag_choices:s.tagChoices},d,t.id):u||X.safePost("/conversation/message_feedback",{requestBody:{message_id:t.id,conversation_id:d,rating:i,text:s.textFeedback,tags:c,tag_choices:s.tagChoices},authOption:Y.SendIfAvailable}));const k=s.tags.map(r=>r.forceRefreshExcluding).filter(r=>!!r);k.length>0&&p({sourceEvent:s.event,nodeId:t.id,extraStreamParams:{forceDisableFeatures:k}})},[e,t.id,o,p,h,u,g,b,i]),A=()=>{w.logEvent("Message Feedback More Options Clicked",{id:t.id,threadId:M(e),model:o,rating:i})},N=he(E,fe(t)?ue:g?ge:re,{allGroupedMessages:n,features:D,currentModelId:o??"",systemContent:P,isBusinessWorkspace:u,hasCaConnection:h});return i==="thumbsUp"?null:G.jsx(ne,{tagOptions:N,onSubmit:O,onMoreClicked:A})}export{ke as default};
//# sourceMappingURL=ekjyij7y7o6sk3nh.js.map
