import{r as g,j as p,b as d}from"./n97h6so7iblif4c5.js";import{ee as M,s as l,N as T,a as C,c as x,eG as k}from"./cim4usely8ixso70.js";import{CoTChunks as _}from"./b3zyvsdy1s0ei6e5.js";import{ft as m}from"./ivbsxyeeopn30y8l.js";import"./m0dk7i2kwnhyvwyt.js";import"./kds0rrlel320n5ae.js";import"./mtefsnq6d12ypkte.js";import"./os50xu2ctps3mt97.js";import"./ixryggzbp977s3m2.js";import"./iwqs8qhqagaobv5t.js";import"./eubb74czncv4xjhk.js";import"./hd79rgnyf5hfs3gj.js";import"./pbl95wx6493wq92j.js";import"./lln26ytjpbr3ilrw.js";import"./lyannwbj1f1pd85x.js";import"./dv71uknfxug29wpq.js";import"./l6ymubw2n3zpsirn.js";const y=(e,t)=>{if(t<=1)return e.formatMessage({id:"ZxhUq1",defaultMessage:"a second"});if(t<3)return e.formatMessage({id:"4GD7tD",defaultMessage:"a couple of seconds"});if(t<4)return e.formatMessage({id:"jx5V1u",defaultMessage:"a few seconds"});if(t>=60){const o=Math.floor(t/60),n=t%60;return`${o}m ${n}s`}return e.formatMessage({id:"p4/pTg",defaultMessage:"{seconds} seconds"},{seconds:t})},E=e=>{let t=0;for(const o of e)t+=o.metadata?.finished_duration_sec??0;return t},R=(e,t,o)=>t.length>1?e.formatMessage({id:"sdDgmZ",defaultMessage:"Thought for {timing}"},{timing:y(e,o)}):M(t)?.metadata?.finished_text??"",I=(e,t,o=!1)=>{const n=[];let s={type:m.Thought,thought:{summary:"",content:""}};const a=()=>{s.thought.content.trim()&&(n.push(s),s={type:m.Thought,thought:{summary:s.thought.summary,content:""}})},u=e.split(/( {2}\n)|(\n\n)/).filter(i=>i!=null&&i.trim());if(!o&&u.length<2)return n;let c=!1;for(let i=0;i<u.length;i++){const r=u[i].trim();if(r.toLowerCase()==="none"){l.count(T.COT_SUMMARIZER,"num_none_chunks");continue}const f=r.match(/^\*\*(.*)\*\*$/);if(f)a(),s.thought.summary=f[1]??"";else if(r){if(r.startsWith("```")){if(c){s.thought.content+=s.thought.content?`
${r}`:r,a(),c=!1;continue}a(),c=!0}s.thought.content.trim()&&!r.startsWith("\\[")&&!r.startsWith("\\(")&&!c&&a(),s.thought.content+=s.thought.content?`
${r}`:r}}return s?.thought.content.trim()&&n.push(s),o&&t&&n.push({type:m.Recap,content:t}),n},N=(e,t,o)=>{const n=!o,s=g.useMemo(()=>I(e,t,n),[e,t,n]);return g.useEffect(()=>{n&&l.hist(T.COT_SUMMARIZER,"num_cot_chunks",void 0,s.length)},[n]),s},S=({isStreaming:e,finishedText:t,summaryText:o,isFinalAssistantTurn:n})=>{const s=N(o,t,e);return p.jsx(_,{isStreaming:e,isFinalAssistantTurn:n,chunks:s})},O=8,j=`

`,H=({messages:e,isStreaming:t,isFinalAssistantTurn:o})=>{const n=d(),s=C(),a=x(s,"1214379119"),u=E(e);let c="";return e.forEach(i=>{const h=k(i);c+=c?j+h:h}),a&&!t&&!c&&u<O?null:p.jsx(S,{finishedText:R(n,e,u),summaryText:c,isStreaming:t,isFinalAssistantTurn:o})};export{S as LegacyCoT,H as LegacyCoTMessage};
//# sourceMappingURL=jaiilyyx7cg3u8rg.js.map
