const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/kex6cs8ebljk8i05.js","assets/cim4usely8ixso70.js","assets/n97h6so7iblif4c5.js","assets/root-c9lkqywj.css","assets/ivbsxyeeopn30y8l.js","assets/conversation-small-dhmr708a.css","assets/o9aygkglauyctw2w.js","assets/dl6wm3f4iy2ldybm.js","assets/ib76cquqlyjrlt71.js","assets/g86fwc5245pbdtof.js","assets/kgkkjgk15rr7n5rs.js","assets/dtltw5so60m9d99q.js"])))=>i.map(i=>d[i]);
import{at as G,R as H,bx as E,bj as Q,ac as W,ad as J,cL as ee,ao as te,bZ as se,a as V,ls as A,fy as B,fz as U,fC as ae,aG as ne,aa as oe,iS as z,fx as re,i_ as ie,aM as le,fA as T,D as de,b9 as ce}from"./cim4usely8ixso70.js";import{b as D,a as L,r as n,j as e,M as O,m as ue}from"./n97h6so7iblif4c5.js";import{bj as pe,bk as me,bn as ge,bp as x,bq as fe,br as he,bw as xe,bx as je,bW as Y,F as X,bX as be,bY as Z,bc as Me,a2 as we,a3 as ve,a4 as Ie,bZ as Ce,z as ye,b_ as Re,b$ as Pe,c0 as _e,c1 as ke,c2 as Se,c3 as Ne}from"./ivbsxyeeopn30y8l.js";import{I as De}from"./h55ppl11pikjl825.js";const Fe=({image:t,onClose:o,onRequestCompletion:a,clientThreadId:r,currentModelId:c,post:u,canDelete:g,onOpenReport:i})=>{const s=D(),f=G(),b=L(),[p,M]=n.useState("default"),d=pe(),j=n.useRef(null),w=n.useRef(d);n.useEffect(()=>{w.current=d},[d]);const v=n.useCallback(()=>me(s),[s]),y=n.useCallback(()=>{t&&M("inpaint")},[t]),R=n.useCallback(()=>{M("default"),w.current.clearAllDrawings()},[]),P=n.useCallback(()=>{t&&ge({url:t.url,fileName:v()})},[t,v]),_=n.useCallback(()=>j.current?.getImageData(),[]),F=n.useCallback(async()=>{if(window.confirm(s.formatMessage({id:"postReceiverModal.deletePostConfirmation",defaultMessage:"Are you sure you want to delete this post?"})))try{await H.safeDelete("/share/post/{post_id}",{parameters:{path:{post_id:u.id}}}),b("/",{replace:!0})}catch{f.danger({id:"postReceiverModal.deletePostError",defaultMessage:"Failed to delete the post",description:"Error message for deleting a post"},{toastId:"post_receiver_modal.delete_post_error"})}},[u.id,s,f,b]),k=p==="inpaint"?s.formatMessage({id:"TjVqYb",defaultMessage:"Edit Selection"}):u.text??s.formatMessage({id:"htGxHc",defaultMessage:"Image"}),I=n.useCallback(C=>{C.key==="Escape"&&(o(),C.preventDefault())},[o]);return n.useEffect(()=>(document.addEventListener("keydown",I),()=>document.removeEventListener("keydown",I)),[I]),e.jsx(E.Root,{isOpen:!0,onClose:o,testId:"modal-lightbox-post-share",shouldIgnoreClickOutside:p==="inpaint",children:e.jsx(E.Overlay,{children:e.jsxs(E.Content,{size:"fullscreen",removePopoverStyling:!0,className:"grid min-h-0 grid-rows-[auto_minmax(0,1fr)] overflow-hidden",children:[e.jsxs("header",{className:"flex h-14 w-full items-center justify-between gap-2 px-2 md:px-4",children:[e.jsxs("div",{className:"flex min-w-0 items-center gap-2",children:[e.jsx(x,{icon:Q,onClick:o,"aria-label":s.formatMessage({id:"EYLKSm",defaultMessage:"Close"})}),e.jsx("h2",{className:"line-clamp-1 text-base font-medium",children:k})]}),e.jsx("div",{className:"flex items-center gap-2",children:p==="inpaint"?e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"aspect-square",icon:fe,onClick:d.undoDrawing,disabled:!d.canUndoDrawing,"aria-label":s.formatMessage({id:"OmaTPx",defaultMessage:"Undo"})}),e.jsx(x,{className:"aspect-square",icon:he,onClick:d.redoDrawing,disabled:!d.canRedoDrawing,"aria-label":s.formatMessage({id:"ZUr4oh",defaultMessage:"Redo"})}),e.jsx(x,{className:"w-auto px-3",onClick:R,children:s.formatMessage({id:"D9xvar",defaultMessage:"Cancel"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"aspect-square",icon:xe,onClick:y,"aria-label":s.formatMessage({id:"pRGwlp",defaultMessage:"Edit image"})}),e.jsx(x,{className:"aspect-square",icon:je,onClick:P,"aria-label":s.formatMessage({id:"9DNHka",defaultMessage:"Download image"})}),e.jsx(x,{className:"aspect-square",icon:Y,onClick:i,"aria-label":s.formatMessage({id:"2gNXdX",defaultMessage:"Report content"})}),g&&e.jsx(x,{className:"aspect-square",icon:X,onClick:F,"aria-label":s.formatMessage({id:"rzlDpj",defaultMessage:"Delete post"})})]})})]}),e.jsxs("div",{className:"grid h-full w-full grid-rows-[1fr_auto] items-center overflow-y-auto overscroll-contain",children:[e.jsx("div",{className:"flex h-full w-full items-center justify-center px-4 pb-4",children:t&&e.jsxs("div",{className:"relative inline-block max-h-full rounded bg-neutral-100",children:[e.jsx("img",{src:t.url,alt:k,className:"h-full max-h-[70vh] w-auto max-w-full rounded object-contain",fetchPriority:"high"}),p==="inpaint"&&e.jsx(be,{image:t,drawingState:d,drawingCanvasRef:j})]})}),e.jsx("div",{className:"flex w-full justify-center px-4 pb-8",children:e.jsx("div",{className:"w-full max-w-[768px]",children:e.jsx(De,{clientThreadId:r,currentModelId:c,onRequestCompletion:a,onClose:o,activeImage:t,inpainting:p==="inpaint"&&d.currentDrawnShape!=null,currentDrawnShape:d.currentDrawnShape,getImageData:_,onCancelInpaint:R})})})]})]})})})},Ee=W(()=>J(()=>import("./kex6cs8ebljk8i05.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11])).then(t=>t.ImageGenNewEditor));function Be({postWithProfile:t,clientThreadId:o,onClose:a}){return t.post.attachments[0]?.kind==="media_generation"?e.jsx(Te,{postWithProfile:t,clientThreadId:o,onClose:a}):t.post.attachments[0]?.kind==="message_slice"?e.jsx(Oe,{postWithProfile:t,onClose:a}):null}function Te({postWithProfile:t,clientThreadId:o,onClose:a}){const r=n.useRef(null),[c,u]=n.useState(!1),g=L(),{post:i}=t,s=i.attachments[i.attachments.length-1],f={url:s.url,content_type:U.ImageAssetPointer,asset_pointer:s.asset_pointer??B(s.id),size_bytes:0,width:s.width,height:s.height},b=D(),p=ae(),M=ne(o),d=G(),j=n.useCallback(m=>p.getState().files.find(l=>l.tempId===m),[p]),w=s.url,v=n.useCallback(async m=>{if(r.current){const l=await r.current,h=l?j(l?.tempId):null;if(h)return h}return r.current=fetch(m).then(l=>l.blob()).then(l=>{const h=new File([l],"image.png",{type:"image/png"}),S=oe(h);return z.uploadFile(p,S,h,re.Multimodal,[h.type],b,d).then(()=>{const N=j(S);return N&&N.status===ie.Ready&&N.fileId?N:null})}),r.current},[p,b,d,j]),{onRequestCompletion:y,currentModelId:R}=Ce(),{isUnauthenticated:P}=le(),_=n.useCallback(async m=>{if(!(!m.promptMessage||P))try{const l=await v(w);if(!l||!l.fileId||!l.fileSpec)return;const h=[{content_type:U.ImageAssetPointer,asset_pointer:B(l.fileId),size_bytes:l.fileSpec.size,width:s.width,height:s.height},...m.promptMessage.content.content_type===T.MultimodalText||m.promptMessage.content.content_type===T.Text?m.promptMessage.content.parts:[]],S={...m,promptMessage:{...m.promptMessage,content:{content_type:T.MultimodalText,parts:h}},extraStreamParams:{...m.extraStreamParams??{},continueFromSharedPostId:i.id}};y(S),z.reset(p)}catch(l){de.addError(new Error("post_receiver_handle_request_failed",{cause:l})),d.danger({id:"postReceiverModal.editImageError",defaultMessage:"Failed to edit the image",description:"Error message for editing an image"},{toastId:"post_receiver_modal.edit_image_error"})}},[s.height,s.width,v,y,p,w,P,d,i.id]),F=V(),k=ce(F).checkGate("2780352974"),I={id:i.id,archived:!1,transformationId:null,url:f.url,assetPointer:f.asset_pointer,thumbnail:null,width:f.width,height:f.height,title:null,conversationId:M,messageId:i.id},C=n.useCallback(()=>{a(),g("/",{replace:!0})},[a,g]);if(k)return e.jsxs(e.Fragment,{children:[e.jsx(Fe,{image:I,onClose:C,onRequestCompletion:_,clientThreadId:o,currentModelId:R,post:i,canDelete:!!i.permissions.can_delete,onOpenReport:()=>u(!0)}),c&&e.jsx(q,{post:i,onClose:()=>u(!1)})]});const $=e.jsx(K,{post:i,setIsReportModalOpen:u,onClose:a,additionalButtons:e.jsx(Pe,{imageAsset:f,serverThreadId:M})});return e.jsxs("div",{className:"bg-token-bg-primary absolute start-0 end-0 top-0 bottom-0 h-full w-full",children:[e.jsx(ye,{children:e.jsx(Ee,{image:f,isLoadingNewImage:!1,clientThreadId:o,onClose:()=>{a(),g("/",{replace:!0})},onRequestCompletion:_,editorControls:$,messageId:i.id})}),c&&e.jsx(q,{post:i,onClose:()=>u(!1)})]})}function Oe({postWithProfile:t,onClose:o}){const[a,r]=n.useState(!1),{post:c}=t;return e.jsxs("div",{className:"bg-token-bg-primary absolute start-0 end-0 top-0 bottom-0 h-full w-full",children:[e.jsx(K,{post:c,setIsReportModalOpen:r,onClose:o}),e.jsx(Re,{attachments:c.attachments,variant:"fullscreen"}),a&&e.jsx(q,{post:c,onClose:()=>r(!1)})]})}function K({post:t,setIsReportModalOpen:o,onClose:a,additionalButtons:r}){const c=L(),u=D(),g=G(),i=n.useCallback(async()=>{if(window.confirm(u.formatMessage({id:"postReceiverModal.deletePostConfirmation",defaultMessage:"Are you sure you want to delete this post?"})))try{await H.safeDelete("/share/post/{post_id}",{parameters:{path:{post_id:t.id}}}),c("/",{replace:!0})}catch{g.danger({id:"postReceiverModal.deletePostError",defaultMessage:"Failed to delete the post",description:"Error message for deleting a post"},{toastId:"post_receiver_modal.delete_post_error"})}},[t.id,u,g,c]);return e.jsx(e.Fragment,{children:e.jsxs(ue.div,{className:"flex h-16 w-full px-2 sm:px-4",..._e,children:[e.jsx("div",{className:"flex items-center justify-self-start text-start",children:e.jsx(ke,{onClose:()=>{a(),c("/",{replace:!0})}})}),e.jsx("div",{className:"flex w-full flex-1 flex-col items-center justify-center justify-self-stretch",children:e.jsx(Se,{areButtonsFullWidth:!0,post:t,setIsReportModalOpen:o})}),e.jsxs("div",{className:"flex items-center justify-self-end text-end",children:[t.permissions.can_delete&&e.jsx(Ne,{tooltip:u.formatMessage({id:"postReceiverModal.deletePost",defaultMessage:"Delete"}),onClick:i,children:e.jsx(X,{})}),r]})]})})}function q({post:t,onClose:o}){const a=V(),{data:r}=we(a,A.Post),c=D(),u=ve(a,c,t.id,A.Post);if(r==null)return null;const g=`Report ${t.text??"Post"}`;return e.jsx(Ie,{reasons:r.reasons,submitReport:u,title:g,onClose:o,header:r.header,subHeader:r.header_explanation})}function Ue(){const t=n.useContext(Z),o=t?.postWithProfile?.post,a=t?.setIsReportModalOpen;return!o||!a?null:e.jsxs("div",{className:"outline-token-border-default mx-4 flex items-center justify-between gap-2.5 rounded-2xl py-1 ps-4 pe-0.5 outline-1 outline-offset-[-1px]",children:[e.jsx("span",{className:"text-token-text-secondary justify-center text-sm leading-tight",children:e.jsx(O,{id:"e2L5bY",defaultMessage:"Content created using ChatGPT"})}),e.jsx(ee,{size:"default",contentAlign:"end",sideOffset:4,triggerButton:e.jsx(Me,{className:"rounded-full",label:"",icon:e.jsx(se,{className:"icon-sm"})}),children:e.jsx(te.Item,{icon:Y,onClick:()=>a(!0),children:e.jsx(O,{id:"jHHbcM",defaultMessage:"Flag content as unsafe"})})})]})}function ze(){const t=n.useContext(Z),o=t?.postWithProfile?.post,a=t?.setIsReportModalOpen;return!o||!a?null:e.jsx("div",{className:"text-token-text-secondary text-sm",children:e.jsx(O,{id:"iRpGVT",defaultMessage:"Content created using ChatGPT. <reportButton>Report</reportButton> if unsafe.",values:{reportButton:r=>e.jsx("button",{className:"text-token-text-primary decoration-token-text-primary underline",onClick:()=>{a(!0)},children:r})}})})}export{Be as P,Ue as S,ze as a,q as b};
//# sourceMappingURL=n8gf07a745v1aikq.js.map
