import{j as s,A as ee,m as te,b as A,r as i,M as B,g as se,a as V,t as ne,v as ae,R as oe,c as E}from"./n97h6so7iblif4c5.js";import{bx as D,d as j,b as re,aj as ce,P as ie,lb as le,aC as G,bW as ue,eD as de,a as L,o as J,eP as W,R as fe,gl as me,c as Q,b4 as he,C as xe,p as ge,bj as ye}from"./cim4usely8ixso70.js";import{u as pe,F as K}from"./g3mhotgl765argdp.js";import{u as N,F as b,a as C,b as ve}from"./im4lacmmdnhx67y2.js";import{cP as X,e4 as ke,ml as be,od as we,a1 as je}from"./ivbsxyeeopn30y8l.js";function Ce({children:t,rootClassName:e,className:a,description:n,icon:r,isOpen:o=!1,onClose:c,primaryButton:d,secondaryButton:l,size:g="normal",title:f,type:h,noPadding:m=!1,hideSeparator:p=!1,showCloseButton:y=!1,shouldIgnoreClickOutside:u=!1,closeButton:v,isScrollable:k=!0,position:S="center",removePopoverStyling:R=!1,showOverlayBackground:q=!0,shadow:T="normal"}){const _=!!f,M=!!t,H=_&&M&&!p;return s.jsx(ee,{children:o&&s.jsx(D.Root,{testId:"modal-fanny-pack",isOpen:!0,onClose:c,shouldIgnoreClickOutside:u,className:e,children:s.jsx(D.Overlay,{showBackground:q,children:s.jsxs(Ne,{size:g,position:S,className:j("flex flex-col focus:outline-hidden",{"max-w-md":g==="normal"},a),removePopoverStyling:R,shadow:T,children:[s.jsx(D.Header,{icon:r,title:f,type:h,closeButton:y&&(v??s.jsx(re,{onClick:()=>c(!0)})),description:n,hasSeparator:H}),s.jsxs("div",{className:j("grow",k?"overflow-y-auto":"overflow-y-hidden",{"p-4 sm:p-6":g!=="fullscreen"&&!m,"md:pt-0!":!M}),children:[t,d!=null||l!=null?s.jsx(D.Actions,{primaryButton:d,secondaryButton:l,modalHasContent:M}):null]})]})})})})}function Ne({className:t,children:e,position:a="center",size:n,removePopoverStyling:r=!1,shadow:o="normal"}){return s.jsx(te.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},exit:{opacity:0,y:14},transition:{duration:.175,ease:"easeInOut",exit:{opacity:{duration:.1,ease:"easeOut"},y:{duration:.175,ease:"easeOut"}}},className:j("z-50 h-full w-full overflow-y-auto",n!=="fullscreen"&&"grid grid-cols-[10px_1fr_10px]",n!=="fullscreen"&&a==="center"&&"grid-rows-[minmax(10px,1fr)_auto_minmax(10px,1fr)] md:grid-rows-[minmax(20px,1fr)_auto_minmax(20px,1fr)]",n!=="fullscreen"&&a==="bottom"&&"grid-rows-[minmax(10px,1fr)_auto_10px] md:grid-rows-[minmax(20px,1fr)_auto_20px]"),children:s.jsx(ce,{className:j(!r&&"popover","bg-token-main-surface-primary relative start-1/2 col-auto col-start-2 row-auto row-start-2 h-full w-full text-start ltr:-translate-x-1/2 rtl:translate-x-1/2",n!=="fullscreen"&&"rounded-2xl",o==="normal"&&"shadow-xl",t),children:e})})}function Se(){const t=A(),e=N(n=>n.query),a=i.useRef(null);return s.jsx("input",{className:"placeholder:text-token-text-tertiary w-full border-none bg-transparent focus:border-transparent focus:ring-0 focus:outline-hidden",placeholder:t.formatMessage({id:"FannyPack.SearchPlaceholder",defaultMessage:"Search chats..."}),onChange:n=>b.setQuery(n.target.value),onKeyDown:n=>{!n.shiftKey&&(n.key==="ArrowUp"||n.key==="ArrowDown")&&n.preventDefault()},value:e,ref:a})}function F({className:t,isActive:e=!1,icon:a,children:n,onClick:r,onMouseEnter:o,onMouseLeave:c}){const d=N(l=>l.mouseInteractionsDisabled);return s.jsx("div",{className:j("cursor-pointer",t),onMouseEnter:d?void 0:o,onMouseLeave:d?void 0:c,onClick:r,children:s.jsxs("div",{className:j("group relative flex items-center rounded-xl px-4 py-3",e&&"dark:bg-token-main-surface-secondary bg-[#f4f4f4]"),children:[a,s.jsx("div",{className:j("relative grow overflow-hidden whitespace-nowrap",a?"ps-2":""),children:n})]})})}function Z(t){return t.formatMessage({id:"fannyPack.DefaultChatTitle",defaultMessage:"New chat"})}function Re({historyResult:t,index:e}){const a=A(),{item:n,onSelect:r}=t,o=N(c=>c.activeIndex);return s.jsx(F,{isActive:o===e,icon:s.jsx(X,{className:"icon"}),onClick:()=>{C.logClick(n.id,e,"history"),r&&r()},onMouseEnter:()=>b.setActiveIndex(e),onMouseLeave:()=>b.setActiveIndex(void 0),children:s.jsx("div",{className:"text-sm",children:n.title??Z(a)})})}function Me({labelResult:t}){return s.jsx("div",{className:"group text-token-text-tertiary relative my-2 px-4 pt-2 text-xs leading-4",children:t.text})}function Pe({newChatResult:t,query:e=void 0,index:a}){const{onSelect:n}=t,r=N(o=>o.activeIndex);return s.jsx(F,{isActive:r===a,onClick:()=>{ie.logNewChatButtonClicked({location:"Fanny Pack"}),n&&n()},onMouseEnter:()=>b.setActiveIndex(a),onMouseLeave:()=>b.setActiveIndex(void 0),icon:s.jsx(ke,{className:"icon"}),children:s.jsx("div",{className:"text-sm",children:e?s.jsx(B,{id:"iQsutJ",defaultMessage:'New chat "{query}"',values:{query:e}}):s.jsx(B,{id:"FannyPack.NewChat",defaultMessage:"New chat"})})})}function Ee(t){return i.useMemo(()=>{if(!t)return null;const e=new Date(t*1e3),a=new Date;return e.toDateString()===a.toDateString()?"Today":new Date(new Date().setDate(a.getDate()-1)).toDateString()===e.toDateString()?"Yesterday":e.getFullYear()===a.getFullYear()?e.toLocaleDateString(void 0,{month:"short",day:"numeric"}):e.toLocaleDateString(void 0,{year:"2-digit",month:"numeric",day:"numeric"})},[t])}var O,Y;function Fe(){if(Y)return O;Y=1;var t=le(),e=/[\\^$.*+?()[\]{}|]/g,a=RegExp(e.source);function n(r){return r=t(r),r&&a.test(r)?r.replace(e,"\\$&"):r}return O=n,O}var Ie=Fe();const _e=se(Ie),De=8;function Ae(t){return t.isArchived?{titleClassName:"text-sm text-token-text-tertiary",titleHighlightedClassName:"text-token-text-secondary font-semibold",messageClassName:"text-xs text-token-text-tertiary",messageHighlightedClassName:"text-token-text-secondary font-medium"}:{titleClassName:"text-sm text-token-text-primary",titleHighlightedClassName:"text-token-text-primary font-semibold",messageClassName:"text-xs text-token-text-secondary",messageHighlightedClassName:"text-token-text-primary font-medium"}}function U({text:t,textToHighlight:e,shouldAdjustStart:a=!1,highlightClassName:n}){const r=i.useMemo(()=>{if(!a||!e)return t;const c=t.toLowerCase().indexOf(e?.toLowerCase());if(c===-1)return t;const d=Math.max(c-De,0),l=t.substring(d);return d===0?l:"â€¦"+l},[t,e,a]),o=i.useMemo(()=>{const c=new RegExp(`(${_e(e)})`,"gi");return r.split(c)},[r,e]);return!e||e.length===0?s.jsx("span",{children:t}):s.jsx("div",{className:"truncate",children:o.map((c,d)=>c.toLowerCase()===e.toLowerCase()?s.jsx("span",{className:n,children:c},d):c)})}function Le({searchResult:t,index:e,elementRef:a}){const{item:n,onSelect:r,query:o}=t,c=A(),d=Ee(n.updateTime),l=Ae(n),f=N(m=>m.activeIndex)===e,h=i.useRef(null);return i.useEffect(()=>{let m;const p=setTimeout(()=>{m=new IntersectionObserver(y=>{y.forEach(u=>{u.isIntersecting&&(C.logImpression(n.source,e,n.conversationId),m&&m.disconnect())})},{threshold:.5}),h.current&&m.observe(h.current)},250);return()=>{m&&m.disconnect(),clearTimeout(p)}},[h,n,o,e]),s.jsx("div",{ref:h,children:s.jsx(F,{isActive:f,icon:n.isArchived?s.jsx(be,{className:"icon text-token-text-tertiary"}):s.jsx(X,{className:"icon"}),onClick:()=>{C.logClick(n.conversationId,e,n.source),r&&r()},onMouseEnter:()=>b.setActiveIndex(e),onMouseLeave:()=>b.setActiveIndex(void 0),children:s.jsxs("div",{className:"flex items-center",ref:a,children:[s.jsxs("div",{className:"relative grow overflow-hidden whitespace-nowrap",children:[s.jsx("div",{className:l.titleClassName,children:s.jsx(U,{text:n.title&&n.title.length>0?n.title:Z(c),textToHighlight:o.length>=3?o:void 0,highlightClassName:l.titleHighlightedClassName})}),s.jsx("div",{className:j("pt-1",l.messageClassName),children:s.jsx(U,{text:n.snippet??"",textToHighlight:o.length>=3?o:void 0,shouldAdjustStart:!0,highlightClassName:l.messageHighlightedClassName})})]}),f&&s.jsx("div",{className:"text-token-text-secondary ps-6 text-xs",children:d})]})})})}function I(){return i.useMemo(()=>({closeFannyPackModal:t=>{C.logClose(t),b.setIsActive(!1)}}),[])}function $(){const t=V(),e=G(),{closeFannyPackModal:a}=I();return i.useCallback(n=>{e&&ue.closeActiveSidebar(),t(n),a("click")},[t,a,e])}function qe(){const{conversations:t}=de(i.useMemo(()=>({}),[])),e=L(),{closeFannyPackModal:a}=I(),n=J(e,"550560761").value,r=Number(n?.history_results_limit??6),o=i.useMemo(()=>t.slice(0,Math.min(t.length,r)),[t,r]),c=we(o,0),d=$(),l=V(),g=i.useMemo(()=>({kind:"newChat",onSelect:()=>{je(l),a("button")}}),[l,a]);return i.useMemo(()=>{const h=[g];return h.push(...[c.recent,c.dynamicMonths,c.dynamicYears].reduce((m,p)=>(Object.entries(p).forEach(([y,{items:u,label:v}])=>{u.length>0&&(m.push({kind:"label",text:v}),u.forEach(k=>{m.push({kind:"history",onSelect:()=>{d(W(k.id))},item:k})}))}),m),[])),h},[g,c,d])}async function Te({query:t,cursor:e}){return fe.safeGet("/conversations/search",{parameters:{query:{query:t,cursor:e}}})}function Oe(){const t=N(x=>x.query),e=$(),[a,n]=i.useState(""),[r,o]=i.useState(!1),c=i.useRef(me(x=>{o(!1),n(x)},250)).current,d=i.useCallback(x=>{x!==a&&(o(!0),c(x))},[a,c]);i.useEffect(()=>{d(t)},[t,d]);const{data:l,isError:g,isLoading:f,isFetchingNextPage:h,hasNextPage:m,fetchNextPage:p}=ne({queryKey:["conversationSearch",{query:a}],queryFn:({pageParam:x})=>Te({query:a,cursor:x}),initialPageParam:"",getNextPageParam:x=>x.cursor??void 0,enabled:!!a});i.useEffect(()=>{f&&C.logQuery()},[f]),i.useEffect(()=>{g&&C.logQueryError()},[g]),i.useEffect(()=>{h&&C.logQueryMore()},[h]);const y=i.useMemo(()=>l?.pages.flatMap(x=>x.items)??[],[l]),u=i.useRef(null),v=i.useCallback(x=>{f||x==null||(u.current?.disconnect(),u.current=new IntersectionObserver(w=>{w[0].isIntersecting&&!h&&m&&p()}),u.current.observe(x))},[f,h,m,p]);i.useEffect(()=>()=>{u.current?.disconnect()},[]);const k=y&&a===t,S=t.length>0&&(r||f||h),R=L(),q=J(R,"550560761").value,T=Number(q?.local_results_limit??0),_=pe(t,T),M=i.useMemo(()=>{const x=_;return k&&y.forEach(w=>{x.has(w.conversation_id)||x.set(w.conversation_id,{conversationId:w.conversation_id,nodeId:w.current_node_id,title:w.title,isArchived:w.is_archived,updateTime:w.update_time,snippet:w.payload.snippet,source:"remote"})}),Array.from(x.values())},[_,y,k]);return{searchResults:i.useMemo(()=>M.map(x=>({kind:"search",onSelect:()=>{e(`${W(x.conversationId)}?src=history_search`)},item:x,query:t})),[M,e,t]),shouldShowLoading:S,infiniteScrollTriggerElementRef:v}}function Be(t,e,a){switch(t.kind){case"history":return s.jsx(Re,{historyResult:t,index:e});case"label":return s.jsx(Me,{labelResult:t});case"loading":return s.jsx(Ke,{loadingResults:t});case"newChat":return s.jsx(Pe,{newChatResult:t,query:t.query,index:e});case"noResults":return s.jsx(He,{});case"search":return s.jsx(Le,{searchResult:t,index:e,elementRef:a})}}function Qe(t,e){const a=i.useCallback(()=>{for(let o=(t??-1)+1;o<e.length;o++)if(e[o].onSelect)return o;return t},[t,e]),n=i.useCallback(()=>{for(let o=(t??e.length)-1;o>=0;o--)if(e[o].onSelect)return o;return t},[t,e]),r=i.useCallback(()=>{t!==void 0&&e[t]&&e[t].onSelect&&e[t].onSelect()},[t,e]);i.useEffect(()=>{const o=c=>{c.isComposing||(c.key==="ArrowUp"&&!c.shiftKey?b.setActiveIndex(n()):c.key==="ArrowDown"&&!c.shiftKey?b.setActiveIndex(a()):(c.key==="Enter"||c.key==="Return")&&(c.preventDefault(),r()))};return window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)}},[n,a,r]),i.useEffect(()=>{const o=()=>{ve.getMouseInteractionsDisabled()&&b.setMouseInteractionsDisabled(!1)};return window.addEventListener("mousemove",o),()=>{window.removeEventListener("mousemove",o)}},[])}function $e(t,e){const a=i.useRef([]);return i.useEffect(()=>{a.current=e.map(()=>oe.createRef())},[e]),i.useEffect(()=>{a.current.forEach((n,r)=>{t===r&&n?.current&&n.current.scrollIntoView({behavior:"instant",block:"nearest"})})},[t,a]),a}function He(){return s.jsx(F,{className:"text-token-text-tertiary text-sm",icon:s.jsx(he,{className:"icon"}),children:s.jsx(B,{id:"FannyPack.Noresults",defaultMessage:"No results"})})}function P(){return s.jsx(F,{icon:s.jsx("div",{className:"loading-results-shimmer bg-token-main-surface-secondary h-[14px] w-[14px] rounded-full"}),children:s.jsxs("div",{className:"flex min-h-[40px] flex-col justify-center",children:[s.jsx("div",{className:"loading-results-shimmer bg-token-main-surface-secondary h-2 w-1/4 rounded-full"}),s.jsx("div",{className:"loading-results-shimmer bg-token-main-surface-secondary mt-3 h-2 w-1/2 rounded-full"})]})})}function Ke({loadingResults:t}){return t.shouldShowMultiple?s.jsxs(s.Fragment,{children:[s.jsx(P,{}),s.jsx(P,{}),s.jsx(P,{}),s.jsx(P,{}),s.jsx(P,{})]}):s.jsx(P,{})}function Ye(){const t=$(),{searchResults:e,shouldShowLoading:a,infiniteScrollTriggerElementRef:n}=Oe(),r=qe(),o=N(u=>u.query),c=o.length>0,d=L(),l=Q(d,"1741586789");i.useEffect(()=>{C.setQuerySessionId(ae())},[o]);const g=i.useMemo(()=>({kind:"newChat",query:o,onSelect:()=>{t(`/?q=${o}`)}}),[o,t]),f=i.useMemo(()=>{const u=[];return o&&l&&u.push(g),c?u.push(...e):u.push(...r),a?u.push({kind:"loading",shouldShowMultiple:u.length===0}):u.length===0&&u.push({kind:"noResults"}),u},[o,l,g,c,a,e,r]),h=N(u=>u.activeIndex);Qe(h,f);const m=$e(h,f),p=i.useRef(null);i.useEffect(()=>{b.setActiveIndex(0),p.current&&(p.current.scrollTop=0)},[o]);const y=i.useRef(!0);return i.useEffect(()=>{y.current&&!a&&f.length===1&&f[0].kind==="noResults"&&C.logNoResults(),y.current=a},[a,f]),s.jsx("div",{ref:p,children:s.jsx("ol",{className:"mx-2",children:f.map((u,v)=>s.jsx("li",{ref:m.current[v],children:Be(u,v,v===f.length-1?n:void 0)},v))})})}function tt(){"use forget";const t=E.c(3),e=N(Ue),a=G();let n;return t[0]!==e||t[1]!==a?(n=a?s.jsx(Ge,{isOpen:e}):s.jsx(Je,{isOpen:e}),t[0]=e,t[1]=a,t[2]=n):n=t[2],n}function Ue(t){return t.isActive}function Ve(t){"use forget";const e=E.c(9),{onClick:a,className:n}=t,r=A();let o;e[0]!==n?(o=j("hover:bg-token-main-surface-secondary focus-visible:ring-token-text-quaternary dark:hover:bg-token-main-surface-tertiary flex items-center justify-center rounded-full bg-transparent p-1 focus-visible:ring-2 focus-visible:ring-offset-1 focus-visible:ring-offset-transparent focus-visible:outline-hidden",n),e[0]=n,e[1]=o):o=e[1];let c;e[2]!==r?(c=r.formatMessage({id:"Px7S/2",defaultMessage:"Close"}),e[2]=r,e[3]=c):c=e[3];let d;e[4]===Symbol.for("react.memo_cache_sentinel")?(d=s.jsx(ye,{className:"icon text-token-text-tertiary hover:text-token-text-primary"}),e[4]=d):d=e[4];let l;return e[5]!==a||e[6]!==o||e[7]!==c?(l=s.jsx("button",{className:o,"aria-label":c,onClick:a,children:d}),e[5]=a,e[6]=o,e[7]=c,e[8]=l):l=e[8],l}function z(t){"use forget";const e=E.c(21),{className:a}=t,{closeFannyPackModal:n}=I(),r=L();let o;e[0]!==r?(o=ge(r),e[0]=r,e[1]=o):o=e[1];const c=o,d=i.useRef(!1);let l;e[2]!==r?(l=Q(r,"3678527908"),e[2]=r,e[3]=l):l=e[3];const g=l;let f;e[4]!==r?(f=Q(r,"1422501431"),e[4]=r,e[5]=f):f=e[5];const h=f;let m,p;e[6]!==c||e[7]!==g||e[8]!==h?(m=()=>{!d.current&&g&&c&&(h?K.setCurrentAccountV2(c):K.setCurrentAccount(c),d.current=!0)},p=[g,c,h],e[6]=c,e[7]=g,e[8]=h,e[9]=m,e[10]=p):(m=e[9],p=e[10]),i.useEffect(m,p);let y;e[11]!==a?(y=j("flex flex-col",a),e[11]=a,e[12]=y):y=e[12];let u;e[13]===Symbol.for("react.memo_cache_sentinel")?(u=s.jsx(Se,{}),e[13]=u):u=e[13];let v;e[14]!==n?(v=s.jsxs("div",{className:"ms-6 me-4 flex max-h-[64px] min-h-[64px] items-center justify-between",children:[u,s.jsx(Ve,{className:"ms-4",onClick:()=>{n("button")}})]}),e[14]=n,e[15]=v):v=e[15];let k;e[16]===Symbol.for("react.memo_cache_sentinel")?(k=s.jsx("hr",{className:"border-token-border-default"}),e[16]=k):k=e[16];let S;e[17]===Symbol.for("react.memo_cache_sentinel")?(S=s.jsx("div",{className:"my-2 grow overflow-y-auto",children:s.jsx(Ye,{})}),e[17]=S):S=e[17];let R;return e[18]!==y||e[19]!==v?(R=s.jsxs("div",{className:y,children:[v,k,S]}),e[18]=y,e[19]=v,e[20]=R):R=e[20],R}function Ge(t){"use forget";const e=E.c(6),{isOpen:a}=t,{closeFannyPackModal:n}=I();let r;e[0]!==n?(r=()=>{n("modal")},e[0]=n,e[1]=r):r=e[1];let o;e[2]===Symbol.for("react.memo_cache_sentinel")?(o=s.jsx(z,{}),e[2]=o):o=e[2];let c;return e[3]!==a||e[4]!==r?(c=s.jsx(xe,{testId:"modal-fanny-pack-mobile",isOpen:a,onClose:r,size:"fullscreen",showCloseButton:!0,type:"success",noPadding:!0,children:o}),e[3]=a,e[4]=r,e[5]=c):c=e[5],c}function Je(t){"use forget";const e=E.c(6),{isOpen:a}=t,{closeFannyPackModal:n}=I();let r;e[0]!==n?(r=()=>{n("modal")},e[0]=n,e[1]=r):r=e[1];let o;e[2]===Symbol.for("react.memo_cache_sentinel")?(o=s.jsx(z,{className:"max-h-[440px] min-h-[440px]"}),e[2]=o):o=e[2];let c;return e[3]!==a||e[4]!==r?(c=s.jsx(Ce,{className:"border-token-border-default border bg-clip-padding shadow-[0_14px_62px_0_rgba(0,0,0,0.25)] md:max-w-[680px] md:min-w-[680px]",isOpen:a,onClose:r,showCloseButton:!0,type:"success",noPadding:!0,showOverlayBackground:!1,shadow:"custom",children:o}),e[3]=a,e[4]=r,e[5]=c):c=e[5],c}export{tt as FannyPackModalContainer};
//# sourceMappingURL=cm20x82p8xpvosxz.js.map
