const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/k8h8lxtf0t3g7yrt.js","assets/n97h6so7iblif4c5.js","assets/ivbsxyeeopn30y8l.js","assets/cim4usely8ixso70.js","assets/root-c9lkqywj.css","assets/conversation-small-dhmr708a.css","assets/h55ppl11pikjl825.js","assets/o9aygkglauyctw2w.js","assets/dl6wm3f4iy2ldybm.js","assets/ib76cquqlyjrlt71.js","assets/g86fwc5245pbdtof.js","assets/kgkkjgk15rr7n5rs.js","assets/dtltw5so60m9d99q.js","assets/kex6cs8ebljk8i05.js"])))=>i.map(i=>d[i]);
import{d as F,B as Ee,b3 as Ge,aR as Pe,aT as Ue,aU as re,jd as le,qM as De,le as ce,iE as Te,je as de,a as pe,b7 as Oe,aE as ze,bM as Se,al as Le,m as Be,aM as He,D as ue,qN as v,aD as Fe,gx as qe,P as Ve,aI as te,aJ as Ie,R as $e,cb as Ke,f9 as Qe,qO as We,c7 as Je,qP as ge,qQ as Xe,qR as Ye,lZ as Ze,b9 as et,cA as tt,aF as nt,ac as we,C as at,ad as ve}from"./cim4usely8ixso70.js";import{j as n,m as V,b as $,a as st,r as a,A as it,h as be,o as ot}from"./n97h6so7iblif4c5.js";import{I as Z,D as Me,u as rt}from"./kwfo8kh2zd30aqvv.js";import{mX as lt,fm as ct,c5 as dt,nO as ut,bt as gt,bl as H,bv as mt,bx as ft,bn as ht,nP as xt,nQ as pt,fv as St,aQ as Ce,bm as _e,fw as It,i9 as wt,nR as ne,bZ as vt}from"./ivbsxyeeopn30y8l.js";import{C as ye}from"./lln26ytjpbr3ilrw.js";import{D as bt}from"./lyannwbj1f1pd85x.js";import{C as Mt}from"./m0dk7i2kwnhyvwyt.js";import"./mtefsnq6d12ypkte.js";import"./kds0rrlel320n5ae.js";const je=({children:e,isDimensionsUnknown:t})=>n.jsxs(V.div,{className:F(["relative max-w-[480px] rounded-2xl",t&&"aspect-square overflow-hidden"]),children:[n.jsx("div",{className:"bg-token-main-surface-secondary pointer-events-none absolute inset-0"}),n.jsx("div",{className:"relative h-full",children:e})]}),Ct=({children:e,isDimensionsUnknown:t,width:s,height:r})=>n.jsxs(V.div,{layout:!0,transition:{duration:.3,ease:"easeInOut"},exit:{opacity:0,transition:{duration:.1,ease:"easeInOut"}},className:F(["relative max-w-[480px] overflow-hidden rounded-2xl",t&&"aspect-square"]),style:{width:s??"auto",height:r??"auto"},children:[n.jsx("div",{className:"bg-token-main-surface-secondary pointer-events-none absolute inset-0"}),n.jsx("div",{className:"relative h-full",children:e})]}),_t=()=>{const e=$(),t=st();return n.jsxs("div",{className:"absolute start-0 bottom-0 flex w-full items-center justify-between bg-white/10 p-4",children:[n.jsxs("div",{className:"flex min-w-0 flex-col",children:[n.jsx("span",{className:"text-sm font-medium text-white",children:e.formatMessage({id:"PlfJ+x",defaultMessage:"Creation might take a moment"})}),n.jsx("span",{className:"text-sm font-normal text-white/80",children:e.formatMessage({id:"4JG8yC",defaultMessage:"Upgrade to create faster"})})]}),n.jsx(Ee,{size:"medium",color:"primary-inverse",onClick:()=>Ge(t,"Image Gen Latency Upsell"),children:e.formatMessage(Pe.getPlus)})]})};function yt(e){const[t,s]=Ue(re.ImageGenProgressUpsellV2,null,o=>o!=null&&typeof o=="object"&&(typeof o.lastSeenUpsellAt=="number"||o.lastSeenUpsellAt==null)&&(typeof o.lastUsedImageGen=="number"||o.lastUsedImageGen==null)&&(typeof o.lastMessageId=="string"||o.lastMessageId==null)&&(typeof o.lastCanBeSeen=="boolean"||o.lastCanBeSeen==null)),r=t&&t.lastSeenUpsellAt?le(t.lastSeenUpsellAt):null,i=t&&t.lastUsedImageGen?le(t.lastUsedImageGen):null,c=e?t&&t.lastMessageId===e?t.lastCanBeSeen:(r==null||De(r,ce(new Date,3)))&&i!=null&&Te(i,ce(new Date,1)):!1;return{canBeSeen:c,markImageGenUsed:()=>{if(e){const o={lastSeenUpsellAt:c?de(new Date):t?.lastSeenUpsellAt??null,lastUsedImageGen:de(new Date),lastMessageId:e??null,lastCanBeSeen:c};s(o),localStorage.setItem(re.ImageGenProgressUpsellV2,JSON.stringify(o))}}}}function jt(){const[t,s]=a.useState(new Date);a.useEffect(()=>{s(new Date)},[]);const r=ct(+t,12e4);return n.jsx(dt,{percentage:r,sizeOverride:30,thickness:1/15,className:"text-white",backgroundStrokeClassName:"stroke-white/20",transitionDuration:`${(100-r)/100*.2}s`,transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)"})}const Re=({isGettingStarted:e,messageId:t})=>{const s=pe(),i=Oe()?.isFree()??!1,{canBeSeen:c,markImageGenUsed:l}=yt(t),o=i&&c&&ze(s,"1997515563").get("should_show_image_gen_latency_upsell",!1);lt(()=>{l()});const m=$(),u=a.useMemo(()=>e?m.formatMessage({id:"SxQKjt",defaultMessage:"Getting started"}):m.formatMessage({id:"Y3ETLn",defaultMessage:"Creating image"}),[e,m]),g=Se(s,"3019066937").get("should_show_cot_header",!1),S=a.useMemo(()=>e?n.jsx(ye,{size:30,arcPercentage:.2,strokeWidth:2}):n.jsx(jt,{}),[e]);return n.jsxs("div",{className:F("absolute inset-0 flex justify-between px-6 py-6",o?"items-start":"items-end"),children:[n.jsxs(it,{mode:"popLayout",children:[g&&n.jsx(V.span,{className:F("flex items-center gap-1 align-middle text-lg",!e&&"text-white"),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,overflow:"hidden",whiteSpace:"nowrap"},transition:{duration:.1,ease:"easeInOut"},children:u},u),n.jsx("div",{className:"flex flex-1 items-center justify-end",children:S})]}),o&&n.jsx(_t,{})]})},me=Le.div`invisible absolute top-3 flex gap-1 group-hover/paragen-image:visible z-2
  ${({$rightAlign:e})=>e?"end-3":"start-3"}
  ${({$alwaysVisible:e})=>e?"visible":""}`,Rt=({imageUrl:e})=>{const[t,s]=a.useState(void 0),r=$(),i=ut(),c=a.useCallback(()=>{const l=new Date;return`${r.formatDate(l,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}.png`},[r]);return n.jsxs("div",{className:"group/paragen-image absolute inset-0 z-3",children:[n.jsxs(me,{$alwaysVisible:!0,children:[t!==!1&&n.jsx(Z,{icon:gt,selected:t===!0,variant:"large",onClick:l=>{l.stopPropagation(),H.paragenImageRated({liked:!0,analyticsContext:i}),s(!0)}}),t!==!0&&n.jsx(Z,{icon:mt,selected:t===!1,variant:"large",onClick:l=>{l.stopPropagation(),H.paragenImageRated({liked:!1,analyticsContext:i}),s(!1)}})]}),n.jsx(me,{$alwaysVisible:!0,$rightAlign:!0,children:n.jsx(Z,{icon:ft,variant:"large",onClick:l=>{l.stopPropagation(),H.paragenDownload({analyticsContext:i}),ht({url:e,fileName:c()})}})})]})};function ke({withLottie:e}){const s=$().formatMessage({id:"imagegen.progressIndicator.ariaLabel",defaultMessage:"Generating image..."});return n.jsx("div",{className:"absolute start-0 top-0 flex h-full w-full items-center justify-center rounded-full","aria-label":s,children:n.jsx(ye,{size:40,arcPercentage:.2,children:n.jsx(bt,{animate:e,matchTextColor:!0,className:"h-6 w-6"})})})}const Ne=300,kt=1.3,fe=.05,Nt=/blur\(([\d.]+)px\)/,At={duration:Ne/1e3,ease:"linear"};function ee(e,t,s){e.sort((l,o)=>l.lastSrcReceivedTime-o.lastSrcReceivedTime);const r=new Array(e.length).fill(0);for(let l=0;l<=e.length;l+=1){const o=l-1,m=l,u=e[o]?.availablePercentComplete??0,g=e[m]?.availablePercentComplete??1;if(t>=u&&t<=g&&u!==g){const S=(t-u)/(g-u);r[o]=1-S,r[m]=S}}const i=r[r.length-1],c=r[r.length-2];return i===1&&c===0&&(r[r.length-2]=.01),s&&t<=e[0]?.availablePercentComplete&&(r[0]=1),r}const Et=({alt:e,src:t,availablePercentComplete:s,onAnimationUpdate:r,ignoreFirstChunk:i=!1,isTransparent:c=!1,dimensions:l,onError:o,unconstrainedWidth:m=!1,progressLoaderProps:u})=>{const g=Be(),S=a.useMemo(()=>`url(${g?xt:pt})`,[g]),[b,C]=a.useState(!1),[p,E]=a.useState(1e3),[I,P]=a.useState(s??0),[f,M]=a.useState(s===1?1:0),N=a.useRef(performance.now()),h=a.useRef(0),x=a.useRef([]),[U,R]=a.useState([0]),[L,D]=a.useState(s===1),T=a.useRef(!1),A=a.useRef(null),k=I===1,_=s===1&&L,O=l?l.width/l.height:1;a.useEffect(()=>{!b&&s&&(C(!0),h.current=performance.now())},[b,s]),a.useEffect(()=>{const w=x.current[x.current.length-1]?.src;if(t&&t!==w){const d=x.current.findIndex(y=>y.availablePercentComplete===s);d!==-1?x.current[d]={src:t,availablePercentComplete:s??0,lastSrcReceivedTime:performance.now()}:x.current.push({src:t,availablePercentComplete:s??0,lastSrcReceivedTime:performance.now()}),R(ee(x.current,I,i))}},[t,I,i,s]);const K=a.useCallback(()=>{A.current&&s&&(E(_?Ne:(performance.now()-N.current)*kt),(!i||T.current||s>=fe)&&s!==1&&M(s),T.current=!0,N.current=performance.now(),u?.setHasImageReady(!0))},[s,_,i,u]),W=a.useCallback(w=>{const d=parseFloat(w.height)/100;r?.(d),P(d),R(ee(x.current,parseFloat(w.height)/100,i))},[r,i]),q=a.useCallback(w=>{const d=w.filter.toString().match(Nt)?.[1]??"0",G=(16-parseFloat(d))/16,X=1-f,J=f+X*G;r?.(J),P(J),R(ee(x.current,J,i))},[i,f,r]);if(!b)return n.jsx(je,{isDimensionsUnknown:!0,children:n.jsx(ke,{withLottie:!0})});const B={duration:p/1e3,ease:"linear"},z=s!==1||!c;return n.jsxs("div",{className:F("relative z-0 cursor-pointer overflow-hidden",O<1?"max-w-[400px]":"max-w-[480px]",!k&&"pointer-events-none",!T.current&&"bg-token-main-surface-secondary",m&&"max-w-full"),"aria-label":e,style:{aspectRatio:O},children:[!u?.shouldHideDiagonalShimmer&&s&&s<fe&&n.jsx("div",{className:"absolute inset-0 z-3 w-full overflow-hidden",children:n.jsx("div",{className:"absolute start-[-150%] top-[-150%] h-[400%] w-[400%]",children:n.jsx("div",{className:"diagonal-sweep-gradient h-full w-full"})})}),n.jsxs(V.div,{className:"absolute start-0 end-0 top-0 z-2 w-full overflow-hidden transition-[mask] ease-linear",initial:_?!1:{height:"0%"},animate:k?{height:"100%"}:{height:`${f*100}%`},onUpdate:_?void 0:W,transition:_?{duration:0,ease:"linear"}:B,style:k?void 0:{mask:"linear-gradient(rgb(0,0,0) 0%, rgb(0,0,0) calc(100% - 24px), rgba(0,0,0,0) 100%)"},children:[t&&n.jsx("img",{ref:A,src:t,onLoad:K,onError:o,alt:e,className:"absolute top-0 z-1 w-full",style:{aspectRatio:O}}),c&&n.jsx("div",{className:"absolute inset-0 z-0 w-full overflow-hidden opacity-0 transition-opacity duration-300 group-hover/imagegen-image:opacity-100 group-focus/imagegen-image:opacity-100",children:n.jsx("div",{className:"absolute inset-0 bg-repeat",style:{backgroundImage:S,backgroundSize:"auto"}})})]}),n.jsx(V.div,{className:"relative z-1 w-full overflow-hidden",initial:{filter:"blur(16px)"},animate:_?{filter:"blur(0px)"}:void 0,transition:_?At:void 0,onUpdate:_?q:void 0,style:{aspectRatio:O},children:x.current.map((w,d)=>{const y=U[d],G=w.availablePercentComplete===1;return y!==0||G?n.jsx("img",{src:w.src,alt:e,style:{opacity:y,willChange:"opacity",aspectRatio:O},className:!_&&u?.shouldShowPulseAnimation?"bg-scale-pulse":"",onLoad:G?()=>D(!0):void 0},w.src):null})}),n.jsx(V.div,{className:"absolute inset-0 z-0 scale-110 overflow-hidden blur-2xl",style:{aspectRatio:O},children:z&&x.current.filter((w,d)=>U[d]!==0).map(w=>n.jsx("img",{src:w.src,alt:e,className:"absolute top-0 w-full"},w.src))})]})},he=2,Y=({pointer:e,altLabel:t,isEditorAvailable:s,onPercentageRendered:r,messageId:i,imageIndex:c,clientThreadId:l,serverThreadId:o,onEditorClick:m,compact:u,progressLoaderProps:g})=>{const S=be(),[b,C]=a.useState(void 0),p=a.useRef(void 0),E=e.metadata?.generation?.gen_id,I=e.metadata?.generation?.height??void 0,P=e.height,f=(I??0)/P,M=a.useRef({}),[N]=ot(),{isUnauthenticated:h}=He(),[x,U]=a.useState(!1),R=a.useContext(Me),L=e.width/e.height,D=St({imageAssetPointer:e,serverThreadId:o}),A=a.useCallback((d=!1)=>{!d&&p.current===e.asset_pointer||(p.current=e.asset_pointer,Ce.fetch(S,{asset:e,conversationId:o,force:d,isUnauthenticated:h}).then(y=>{C(y)}).finally(()=>{p.current=void 0}))},[e,S,o,h,null]);a.useEffect(()=>{const d=e.asset_pointer!==b?.asset_pointer;(!b||d)&&A()},[b,e.asset_pointer,A]);const k=a.useMemo(()=>_e({pointer:b,conversationId:o,messageId:i,source:R?"paragen":"chat",imageIndex:c.toString()}),[b,o,i,R,c]),_=a.useRef(f);a.useEffect(()=>{f===1&&_.current<1&&H.renderingComplete({analyticsContext:k})},[f,k]);const O=a.useCallback(()=>{b&&m?.({image:b,messageId:i,analyticsContext:k})},[b,i,m,k]),K=a.useMemo(()=>({width:e.width,height:e.height}),[e]),W=a.useCallback(()=>{const d=(M.current[e.asset_pointer]??0)+1;if(M.current[e.asset_pointer]=d,M.current[e.asset_pointer]>he)return ue.addAction("image-gen-asset-error",{name:"retries-exhausted",conversation_id:o,asset_pointer:e.asset_pointer,max_retries:he});ue.addAction("image-gen-asset-retry",{name:"retry-attempted",conversation_id:o,asset_pointer:e.asset_pointer,current_retry:d}),M.current[e.asset_pointer]=d,A(!0)},[e.asset_pointer,A,o]),q=a.useCallback(d=>{d===1&&U(!0),r?.(d)},[r]),Q=a.useRef(null),B=a.useRef(null);a.useEffect(()=>{if(Q.current&&g?.setContainerSize){const d=Q.current.getBoundingClientRect(),y={width:d.width,height:d.height},G=B.current;(!G||G.width!==y.width||G.height!==y.height)&&(B.current=y,g.setContainerSize(y))}},[g]);const z=b?.url,w=D??z;return n.jsx(It.Provider,{value:k,children:n.jsxs("div",{ref:Q,className:F("group/imagegen-image relative w-full overflow-hidden",L<1?"max-w-[400px]":"max-w-[480px]",u?"rounded-lg":"rounded-2xl",R&&"max-w-full",i===N.get("image")&&"[view-transition-name:var(--vt-active-image)]"),id:`image-${i}`,style:{aspectRatio:L},onClick:s?O:void 0,tabIndex:0,children:[D&&n.jsx("img",{alt:t,className:"absolute inset-0 z-1 opacity-0",src:D}),n.jsx(Et,{alt:t,src:z,availablePercentComplete:f,onAnimationUpdate:q,isEditorAvailable:s,ignoreFirstChunk:!0,isTransparent:e.metadata?.generation?.transparent_background,dimensions:K,onError:W,unconstrainedWidth:R,progressLoaderProps:g},E),g?.state&&g?.state!==v.Complete&&!x&&g?.hasImageReady&&n.jsx(Re,{isGettingStarted:!1,messageId:i}),x&&!u&&(R?n.jsx(Rt,{imageUrl:z??""}):n.jsx(wt,{imageAssetPointer:z,imageUrl:w,messageId:i,clientThreadId:l,serverThreadId:o,shouldShowOverflow:D!==void 0}))]},E)})},Gt=({imageGenerationState:e,isInterrupted:t,asyncMessage:s,imageAssetPointer:r,altLabel:i,clientThreadId:c,serverThreadId:l,onEditorClick:o,isEditorAvailable:m,setAnimationPercentage:u,messageId:g})=>{const[S,b]=a.useState(null),C=S==null,[p,E]=a.useState(!0),I=e===v.Thinking||e===v.AsyncGenerating&&!s?.metadata?.is_visually_hidden_from_conversation,P=e===v.Generating||e===v.Complete;return a.useEffect(()=>{I&&E(!1)},[I]),t?null:n.jsxs(n.Fragment,{children:[(I||!p)&&n.jsx(Ct,{isDimensionsUnknown:C,width:S?.width,height:S?.height,children:C&&n.jsx(Re,{isGettingStarted:!0,messageId:g})}),P&&n.jsx(V.div,{className:"pb-2",variants:{hidden:{opacity:0},visible:{opacity:1}},initial:"hidden",animate:p?"visible":"hidden",exit:"hidden",children:r&&n.jsx(Y,{pointer:r,altLabel:i,isEditorAvailable:m,onPercentageRendered:u,messageId:g,clientThreadId:c,serverThreadId:l,imageIndex:0,onEditorClick:o,progressLoaderProps:{state:e,setContainerSize:b,hasImageReady:p,setHasImageReady:E,shouldHideDiagonalShimmer:!0,shouldShowPulseAnimation:!0}})})]})};function Pt({title:e,description:t,shimmer:s}){return!e&&!t?null:n.jsxs("div",{className:"border-token-border-default my-2 max-w-[480px] min-w-72 rounded-2xl border p-6",children:[!!e&&n.jsx("p",{className:F("text-lg font-medium",s&&"loading-shimmer-pure-text-inverted",!!t&&"mb-1"),children:e}),!!t&&n.jsx("p",{children:t})]})}const Ut=({cotMessages:e,visualPercentComplete:t,isInterrupted:s=!1,state:r})=>{const c=$().formatMessage({id:"imagegen.thinkingHeader.interrupted",defaultMessage:"Stopped creating image"}),l=r===v.Complete||t===1,o=a.useMemo(()=>{if(s)return c;if(!e)return;if(l)return e.complete;if(t){const m=Object.keys(e.generating);for(let u=0;u<m.length;u+=1){const g=parseFloat(m[u]);if(t<g)return e.generating[m[u]]}}else return e.thinking;return e.complete},[e,c,s,l,t]);return o&&n.jsx(Mt,{latestHeadline:o,isComplete:l||s,showChunkIcon:!1,isExpandDisabled:!0})},Dt=({pointersToRender:e,altLabel:t,isEditorAvailable:s,updatePercentageRendered:r,toolCallMessage:i,toolOutputMessageIds:c,clientThreadId:l,serverThreadId:o,handleEditorClick:m})=>{const u=ne.useStore(),g=ne.useSelectedIndex();a.useEffect(()=>{u.setSelectedIndex(Math.max(c.findIndex(f=>f===i?.metadata?.selected_image_message_id),0))},[]);const S=a.useRef({}),b=a.useCallback(f=>M=>{S.current[f]=M;const N=Object.keys(S.current).length,h=Object.values(S.current).reduce((x,U)=>x+U,0);r?.(h/N)},[r]),[C,p]=a.useState(null),E=Fe(l,te.getRequestId),I=qe(E);a.useEffect(()=>{!I&&C!=null&&i!=null&&o!=null&&(xe(i.id,c[C],l,o),p(null))},[I]);const P=a.useCallback(f=>{u.setSelectedIndex(f);const M=Object.values(S.current);Ve.logEventWithStatsig("chatgpt_image_switched","chatgpt_image_switched",{conversationId:o,messageId:c[f],imageIndex:f.toString(),isLoading:(M.length===0||M.some(x=>x<1)).toString()});const h=te.getConversationLastTurn(Ie(l))?.messages.find(x=>x.id===i?.id)!=null;i!=null&&o!=null&&(h&&I?p(f):xe(i.id,c[f],l,o))},[i,c,l,o,u,I,p]);return n.jsxs("div",{className:"flex gap-2",children:[n.jsx(Y,{pointer:e[g],altLabel:t,isEditorAvailable:s,messageId:c[g],imageIndex:g,clientThreadId:l,serverThreadId:o,onEditorClick:m}),n.jsx("div",{className:"flex flex-col gap-2",children:e.map((f,M)=>n.jsx(Tt,{pointer:f,altLabel:t,isSelected:M===g,onClick:()=>P(M),onPercentageRendered:f.metadata?.generation?.gen_id?b(f.metadata.generation.gen_id):void 0,messageId:c[M],imageIndex:M,clientThreadId:l,serverThreadId:o},f.metadata?.generation?.gen_id))})]})},Tt=({pointer:e,altLabel:t,isSelected:s,onClick:r,onPercentageRendered:i,messageId:c,imageIndex:l,clientThreadId:o,serverThreadId:m})=>n.jsxs("button",{type:"button",onClick:r,className:"relative w-14 rounded-lg p-1",children:[n.jsx("div",{className:F(s&&"opacity-70"),children:n.jsx(Y,{pointer:e,altLabel:t,isEditorAvailable:!1,onPercentageRendered:i,messageId:c,imageIndex:l,clientThreadId:o,serverThreadId:m,compact:!0})}),s&&n.jsx("div",{className:"border-token-border-default pointer-events-none absolute inset-0 rounded-xl border-2"})]});async function xe(e,t,s,r){const i=await $e.safePost("/image-gen/message-select",{requestBody:{message_id:e,selected_image_message_id:t,conversation_id:r}}),c=i.id;c!=null&&Ke(s,l=>{Qe.updateTree(l,o=>{o.updateNodeMessage(c,i)})})}function Ot(e){const t=e.find(l=>l.author.role==="tool"&&l.author.name===We&&l.content.content_type==="text"),[s,...r]=t?.content.content_type==="text"?t.content.parts:[],i=r.pop(),c=r.length;return s&&i&&r.length>0?{thinking:s,complete:i,generating:r.reduce((l,o,m)=>{const u=(m+1)/c;return l[u.toFixed(2)]=o,l},{})}:void 0}const zt=e=>{const t=$(),{size:s="image",count:r=1}=e||{};return r>1?{thinking:t.formatMessage({id:"cdnmKo",defaultMessage:"Getting started"}),generating:{"0.33":t.formatMessage({id:"aTbInH",defaultMessage:"Creating images. May take a moment."}),"0.67":t.formatMessage({id:"WRM3Yw",defaultMessage:"Creating images. May take a moment."}),"1.00":t.formatMessage({id:"8ZydRG",defaultMessage:"Creating images. May take a moment."})},complete:t.formatMessage({id:"XQ81dl",defaultMessage:"Images created"})}:s==="xlimage"?{thinking:t.formatMessage({id:"y7op2E",defaultMessage:"Getting started"}),generating:{"0.33":t.formatMessage({id:"cdrDJH",defaultMessage:"Creating image. May take a moment."}),"0.67":t.formatMessage({id:"RP4bRn",defaultMessage:"Adding details"}),"1.00":t.formatMessage({id:"o36MSQ",defaultMessage:"Finishing touches"})},complete:t.formatMessage({id:"QsnnBN",defaultMessage:"Image created"})}:{thinking:t.formatMessage({id:"6c7+kN",defaultMessage:"Getting started"}),generating:{"0.33":t.formatMessage({id:"DP6/8y",defaultMessage:"Creating image"}),"0.67":t.formatMessage({id:"k9y1TT",defaultMessage:"Creating image"}),"1.00":t.formatMessage({id:"GpR7v3",defaultMessage:"Creating image"})},complete:t.formatMessage({id:"l2Izz4",defaultMessage:"Image created"})}},Lt=we(()=>ve(()=>import("./k8h8lxtf0t3g7yrt.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12])).then(e=>e.ImageGenConversationLightboxNew)),Bt=we(async()=>ve(()=>import("./kex6cs8ebljk8i05.js"),__vite__mapDeps([13,3,1,4,2,5,7,8,9,10,11,12])).then(e=>e.ImageGenNewEditor)),Ht=[v.Empty,v.Errored],Zt=({messages:e,clientThreadId:t,isLastTurnInConversation:s,isParagen:r=!1})=>{const i=Je(t),c=$(),l=c.formatMessage({id:"imagegen.message.altLabel",defaultMessage:"Generated image"}),[o,m]=a.useState(!1),[u,g]=a.useState(null),[S,b]=a.useState(null),{messageIds:C,imageAssetPointers:p}=a.useMemo(()=>ge(e),[e]),E=e.find(Xe),I=ne.useSelectedIndex(),P=p?.[I]?.metadata?.generation?.gen_size,f=zt({size:P??"image",count:p?.length??1}),M=a.useMemo(()=>Ot(e)??f,[e,f]),N=e.find(d=>d.metadata?.image_gen_async),h=a.useMemo(()=>Ye(e,s),[e,s]),x=a.useRef(!1),U=a.useRef(!1),R=a.useRef(null),L=a.useMemo(()=>_e({pointer:p[I],conversationId:i,messageId:C[I],source:r?"paragen":"chat",imageIndex:I.toString()}),[p,C,I,i,r]);a.useEffect(()=>{if(!x.current&&(h===v.Thinking||h===v.Generating))x.current=!0,R.current=performance.now();else if(x.current&&!U.current)if(h===v.Complete){const d=R.current?performance.now()-R.current:void 0;H.generationSuccess({analyticsContext:L,durationMs:d}),U.current=!0}else h===v.Errored&&(H.generationFailure({analyticsContext:L,errorReason:"assistant_error"}),U.current=!0)},[h,L]);const D=e[e.length-1],T=a.useMemo(()=>D&&Ze(D),[D]),A=pe(),k=et(A).checkGate("3287225511"),{onRequestCompletion:_}=vt(),K=tt(t)?.id??null,W=Se(A,"3019066937").get("should_use_new_ui",!1),q=rt({clientThreadId:t})&&h===v.Complete,[Q,B]=a.useState(0),z=be(),w=a.useCallback(async({image:d,messageId:y,analyticsContext:G})=>{if(k){const X=Ie(t),J=X?te.getConversationTurns(X).flatMap(j=>j.messages):e,{imageAssetPointers:Ae,messageIds:ae}=ge(J,{skipSort:!0}),se=(r?[d]:await Promise.all(Ae.map(j=>Ce.fetch(z,{asset:j,conversationId:i})))).map((j,oe)=>({id:j.metadata?.generation?.gen_id??ae[oe],archived:!1,transformationId:j.metadata?.generation?.gen_id??null,url:j.url,assetPointer:j.asset_pointer,thumbnail:null,width:j.width,height:j.height,title:null,conversationId:i,messageId:ae[oe]}));H.editorClick({sourceOperation:d.metadata?.dalle?.edit_op??"none",analyticsContext:G});const ie=se.findIndex(j=>j.assetPointer===d.asset_pointer);nt(A,({onClose:j})=>n.jsx(Lt,{images:se,initialIndex:ie===-1?0:ie,onClose:j,onRequestCompletion:_,clientThreadId:t,currentModelId:K}))}else g(d),b(y),m(!0),H.editorClick({sourceOperation:d.metadata?.dalle?.edit_op??"none",analyticsContext:G})},[e,i,A,_,t,K,z,k,r]);return Ht.includes(h)?null:n.jsxs(Me.Provider,{value:r,children:[n.jsx("div",{className:"flex flex-col",children:W?n.jsx(Gt,{imageGenerationState:h,isInterrupted:T,asyncMessage:N,imageAssetPointer:p[0],altLabel:l,clientThreadId:t,serverThreadId:i,onEditorClick:w,setAnimationPercentage:B,isEditorAvailable:q,messageId:C[0]}):n.jsxs(n.Fragment,{children:[h!==v.Unavailable&&h!==v.AsyncGenerating&&h!==v.AsyncHanging&&n.jsx("div",{className:"pb-3",children:n.jsx(Ut,{cotMessages:M,visualPercentComplete:Q,isInterrupted:T,state:h})}),h===v.Thinking&&!T&&n.jsx(je,{isDimensionsUnknown:!0,children:n.jsx(ke,{withLottie:!0})}),h===v.AsyncGenerating&&!N?.metadata?.is_visually_hidden_from_conversation&&n.jsx(Pt,{shimmer:!0,title:N?.metadata?.ui_card_title,description:N?.metadata?.ui_card_description}),(h===v.Generating||h===v.Complete)&&!T&&n.jsx("div",{className:"pb-2",children:p.length>1?n.jsx(Dt,{pointersToRender:p,altLabel:l,isEditorAvailable:q,updatePercentageRendered:B,toolCallMessage:E,toolOutputMessageIds:C,clientThreadId:t,serverThreadId:i,handleEditorClick:w}):n.jsx(Y,{pointer:p[0],altLabel:l,isEditorAvailable:q,onPercentageRendered:B,messageId:C[0],imageIndex:0,clientThreadId:t,serverThreadId:i,onEditorClick:w})})]})}),!k&&n.jsx(at,{testId:"modal-image-gen-content",type:"success",size:"fullscreen",isOpen:o,onClose:()=>m(!1),title:c.formatMessage({id:"imagegen.message.contentModalTitle",defaultMessage:"Edit image"}),visuallyHiddenHeader:!0,className:"dark:bg-(--gray-800)",children:u&&n.jsx(Bt,{image:u,isLoadingNewImage:!1,clientThreadId:t,onClose:()=>m(!1),messageId:S??""})})]})};export{Zt as ImageGenMessage};
//# sourceMappingURL=ojl6rg4kdlrqw0al.js.map
