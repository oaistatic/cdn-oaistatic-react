import{r as f,b as L,j as e,M as d}from"./n97h6so7iblif4c5.js";import{j3 as _,dn as U}from"./ivbsxyeeopn30y8l.js";import{d as y,B as S,cL as W,ao as u,bZ as K,m as G,at as $,cO as Z}from"./cim4usely8ixso70.js";import{C as q,S as J,i as Q,g as X,D as Y,N as ee}from"./ggc8598ndo8rm83w.js";import{i as te}from"./c4vbhkqdiicfwhk9.js";import{S as se,a as ae}from"./n3yg6x086kovwjnv.js";import{F as ie}from"./hyd0xfhv1phzro2t.js";import{l as oe}from"./div7mikai9oktr1k.js";function B({filePath:t,side:o,lineNumber:g,onSubmit:v,onDelete:h,onClose:c,initialComment:a}){const b=a?T(a):"",[n,w]=f.useState(a?T(a):""),[s,p]=f.useState(!a),[F,j]=f.useState(!1),x=f.useRef(null),N=L(),C=()=>{if(!n)return;const l=a?{...a,content:[{content_type:"text",text:n}]}:{id:crypto.randomUUID(),type:"comment",content:[{content_type:"text",text:n}],position:{side:o===J.old?"left":"right",path:t,line:g}};v?.(l),p(!1),x.current?.blur(),c?.()};return f.useEffect(()=>{!F&&a&&n===b&&setTimeout(()=>{p(!1)},100),F&&(p(!0),x.current?.focus())},[F,a,n,b]),e.jsx("div",{className:"gap-2 bg-gray-100/50 p-4 font-sans dark:bg-gray-900",id:a?.id,children:e.jsxs("div",{className:y("flex flex-col gap-2",q),children:[e.jsx(te,{ref:x,className:"border-token-border-medium bg-token-main-surface-primary text-token-text-primary border-1.5 w-full resize-none rounded-lg p-4 text-sm ring-0 focus:border-black focus:outline-hidden dark:focus:border-white","data-wham-comment-textarea":!0,onFocus:()=>j(!0),onBlur:()=>j(!1),placeholder:N.formatMessage({id:"code.diff.addComment",defaultMessage:"Add a comment"}),minRows:1,maxRows:10,autoFocus:!a,onSubmit:()=>{},value:n,onChange:l=>w(l.target.value),onKeyDown:l=>{l.key==="Enter"&&l.metaKey&&(l.preventDefault(),C()),l.key==="Escape"&&(l.preventDefault(),c?.())}}),s&&e.jsxs("div",{className:y("mt-2 flex items-center justify-between gap-2",!h&&"justify-end"),children:[h&&e.jsx(S,{color:"danger",onClick:()=>h?.(),children:e.jsx(d,{id:"code.diffComment.delete",defaultMessage:"Delete"})}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(S,{color:"secondary",onClick:()=>{c?.(),p(!1),a&&w(T(a))},children:e.jsx(d,{id:"code.diffComment.cancel",defaultMessage:"Cancel"})}),e.jsx(S,{color:"primary",disabled:!n,onClick:C,children:a?e.jsx(d,{id:"code.diffComment.save",defaultMessage:"Save"}):e.jsx(d,{id:"code.diffComment.comment",defaultMessage:"Comment"})})]})]})]})})}function T(t){return t.content.map(o=>o.content_type==="text"?o.text:"").join("")}function ne({copyDiffToClipboard:t,copyPatchToClipboard:o,unifiedDiff:g,setUnifiedDiff:v,showFullDiff:h=!1,setShowFullDiff:c}){const[a,b]=f.useState(!1),n=L(),w=s=>p=>{p.preventDefault(),p.stopPropagation(),s==="diff"?t():o()};return e.jsxs(W,{open:a,onOpenChange:b,contentAlign:"end",sideOffset:8,modal:!0,triggerButton:e.jsx("button",{type:"button",onClick:s=>{s.preventDefault(),s.stopPropagation(),b(!0)},className:"hover:bg-token-border-light rounded p-1","aria-label":n.formatMessage({id:"wham.copyFileActionDropdown.openMenu",defaultMessage:"Open diff actions menu"}),children:e.jsx(K,{className:"icon"})}),children:[e.jsx(u.Item,{icon:_,onClick:w("diff"),children:e.jsx(d,{id:"wham.copyFile.apply",defaultMessage:"Copy git apply"})}),e.jsx(u.Item,{icon:_,onClick:w("patch"),children:e.jsx(d,{id:"wham.copyFile.patch",defaultMessage:"Copy patch"})}),e.jsx(u.Separator,{}),e.jsxs(u.RadioGroup,{value:g?"unified":"split",onValueChange:s=>v(s==="unified"),onClick:s=>s.stopPropagation(),children:[e.jsx(u.RadioItem,{value:"split",onClick:s=>s.stopPropagation(),children:e.jsxs("div",{className:"text-token-text-primary flex items-center gap-3",children:[e.jsx(se,{className:"icon"}),e.jsx(d,{id:"wham.message.modal.footer.splitDiff",defaultMessage:"Split diff"})]})}),e.jsx(u.RadioItem,{value:"unified",onClick:s=>s.stopPropagation(),children:e.jsxs("div",{className:"text-token-text-primary flex items-center gap-3",children:[e.jsx(ae,{className:"icon"}),e.jsx(d,{id:"wham.message.modal.footer.unifiedDiff",defaultMessage:"Unified diff"})]})})]}),c&&e.jsxs(e.Fragment,{children:[e.jsx(u.Separator,{}),e.jsxs(u.RadioGroup,{value:h?"full":"latest",onValueChange:s=>c(s==="full"),onClick:s=>{s.stopPropagation()},children:[e.jsx(u.RadioItem,{value:"full",children:e.jsx(d,{id:"wham.copyFile.showFullDiff",defaultMessage:"Full diff"})}),e.jsx(u.RadioItem,{value:"latest",children:e.jsx(d,{id:"wham.copyFile.showLatestCommit",defaultMessage:"Incremental diff"})})]})]})]})}const le="_diffView_avtz7_1",re={diffView:le},E="wham-toggle-all-diffs";function de(t){return f.useEffect(()=>{function o(g){t(g.detail.open)}return window.addEventListener(E,o),()=>{window.removeEventListener(E,o)}},[t]),f.useCallback(o=>{window.dispatchEvent(new CustomEvent(E,{detail:{open:o}}))},[])}function be({diff:t,viewType:o,stickyHeader:g,showFullDiff:v=!1,setShowFullDiff:h,enableComments:c=!1,comments:a,buttonClassName:b,onCommentCreate:n,onCommentDelete:w,onCommentUpdate:s,setUnifiedDiff:p}){const F=G(),j=L(),[x,N]=f.useState(()=>!Q(t.diffFile)),[C,l]=f.useState(!1),I=$(),O=de(N);f.useEffect(()=>{t.diffFile.initTheme(F?"dark":"light")},[t.diffFile,F]);const k=(a??[]).reduce((i,r)=>{const m=r.position.path,R=r.position.side,D=r.position.line;i[m]||(i[m]={oldFile:{},newFile:{}});const V=R==="left"?i[m].oldFile:i[m].newFile;return V&&(V[D]={data:r}),i},{}),M=X(t.diffFile),P=()=>{const i=t.diffFile._newFileName===ee?t.diffFile._oldFileName:t.diffFile._newFileName;navigator.clipboard.writeText(i),l(!0),setTimeout(()=>{l(!1)},1e3)},A=async()=>{t.hunksText&&(await navigator.clipboard.writeText(` (cd "$(git rev-parse --show-toplevel)" && git apply --3way <<'EOF' 
${t.hunksText} 
EOF
)`),I.success(j.formatMessage({id:"wham.message.modal.footer.copiedToClipboard",defaultMessage:"Copied git apply command to clipboard"}),{duration:3,hasCloseButton:!0}))},z=async()=>{t.hunksText&&(await navigator.clipboard.writeText(t.hunksText),I.success(j.formatMessage({id:"wham.codeDiff.copiedPatchToClipboard",defaultMessage:"Copied patch to clipboard"}),{duration:3,hasCloseButton:!0}))},H=!t.diffFile.unifiedLineLength&&!t.diffFile.splitLineLength;return e.jsxs("div",{"data-diff-header":M,className:y("flex flex-col pt-1",re.diffView),children:[e.jsx("div",{role:"button",onClick:i=>{const r=!x;i.altKey?O(r):N(r)},className:y("focus-visible:outline-none",g&&"sticky top-0 z-1",b),children:e.jsxs("div",{className:y("bg-token-bg-primary border-token-border-default relative flex items-center rounded-t-2xl border px-4 py-3 text-sm font-medium before:absolute before:inset-x-[-1px] before:top-[-1px] before:bottom-0 before:z-[-1] before:bg-[var(--right-bg)] before:content-['']",!x&&"rounded-b-2xl"),children:[e.jsx(U,{className:y("icon me-3 transition-transform duration-200",x&&"rotate-90")}),e.jsx("span",{className:"me-1 truncate text-start select-text",title:M,children:M}),e.jsx(ie,{diffFile:t.diffFile}),e.jsx(Z,{label:j.formatMessage({id:"wham.codeDiff.copiedFileName",defaultMessage:"Copied File Name"}),open:C,children:e.jsx("div",{role:"button",onClick:i=>{i.preventDefault(),i.stopPropagation(),P()},className:"hover:bg-token-border-light rounded p-1","aria-label":j.formatMessage({id:"wham.codeDiff.copyFileName",defaultMessage:"Copy file name"}),children:e.jsx(_,{className:"icon-xs"})})}),e.jsxs("div",{className:"ms-auto flex items-center gap-1 ps-1",children:[e.jsx(oe,{linesAdded:t.diffFile.additionLength,linesRemoved:t.diffFile.deletionLength}),!t.isBinary&&e.jsx(ne,{copyDiffToClipboard:A,copyPatchToClipboard:z,unifiedDiff:o==="unified",setUnifiedDiff:p,showFullDiff:v,setShowFullDiff:h})]})]})}),x&&(H||t.isBinary?e.jsx("div",{className:"text-token-text-secondary bg-token-bg-secondary flex h-full justify-center rounded-b-2xl py-4 text-sm font-medium",children:t.isBinary?e.jsx(d,{id:"wham.diff.binaryFile",defaultMessage:"Binary file not shown"}):e.jsx(d,{id:"wham.diff.noContent",defaultMessage:"No content"})}):e.jsx(Y,{className:y("relative overflow-clip rounded-b-2xl transition-opacity duration-300","after:border-token-border-default after:pointer-events-none after:absolute after:inset-0 after:rounded-b-2xl after:border-s after:border-e after:border-b after:content-['']"),diffViewFontSize:12,diffFile:t.diffFile,diffViewTheme:F?"dark":"light",diffViewHighlight:!0,diffViewMode:o==="split"?3:4,diffViewWrap:!0,diffViewAddWidget:c,extendData:k[t.diffFile._newFileName],renderExtendLine:({lineNumber:i,side:r,data:m})=>!c||!(r===1?k[t.diffFile._newFileName]?.oldFile:k[t.diffFile._newFileName]?.newFile)?null:e.jsx(B,{initialComment:m,onSubmit:D=>s?.(D),onDelete:()=>w?.(m),filePath:t.diffFile._newFileName,side:r,lineNumber:i}),renderWidgetLine:({onClose:i,lineNumber:r,side:m})=>!c||!n?null:e.jsx(B,{onSubmit:n,onClose:i,filePath:t.diffFile._newFileName,side:m,lineNumber:r})}))]})}export{be as C};
//# sourceMappingURL=fqsblu76f88rb6n0.js.map
