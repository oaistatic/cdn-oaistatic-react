import{r as S,j as n}from"./n97h6so7iblif4c5.js";import{C as G}from"./duq1pnveyl56wgvu.js";import{D as J,a as K}from"./hxd4ri96xuxv35dx.js";import{T as Q,a as X,A as M,u as Y,i as Z,C as $,g as z}from"./l3a1zonyay67v90a.js";import{C as tt,c as et}from"./mrd3z2p5ccxe8mcf.js";import{C as V}from"./ltncr5s1j4b4kz0c.js";import{u as ot,a as rt,b as nt,c as k}from"./bfek75jeyiiysrf0.js";import{C as it}from"./jy1u8exw8iz2slve.js";import{g as st,bH as lt,hN as U,hO as at}from"./ivbsxyeeopn30y8l.js";import{ea as ct}from"./cim4usely8ixso70.js";import{u as mt}from"./bcnsse8l7ak9ome8.js";import"./hd79rgnyf5hfs3gj.js";import"./eubb74czncv4xjhk.js";import"./04xv6xbz1fo9vjli.js";import"./nrw3240lakumkaii.js";import"./d7iwo69sk89c6my3.js";import"./c4vbhkqdiicfwhk9.js";import"./mfrmh8iqcq7c5rho.js";import"./dv0x3wwg6vtgq24d.js";import"./gy64pge8qevmvg7e.js";import"./hh6y2dm7afl4jnkn.js";import"./bk8slwxjkdlmxjxm.js";import"./0pr0i2ofpxcgwml5.js";import"./qt8c9lenu31o2obp.js";import"./k5qf6pgck1wqkdil.js";import"./jdpqs7fyetm56n9m.js";import"./nswfjkfs26me74ly.js";import"./os50xu2ctps3mt97.js";import"./cxo3s9z32l5kx9bi.js";import"./i8vgytiaizzymmdx.js";import"./hl263mv5vjd6fe09.js";import"./grt0jtahkb4l594u.js";import"./fn23ljzmd7fz7cdu.js";import"./lnrdu7695dtoyi0c.js";function dt(t,e){const r=t.doc.lineAt(e.from);return e.from===r.from&&e.to-1===r.to}function ut(t){const e=t.dom.querySelector(".cm-gutters");return e?e.offsetWidth:0}const ft=({onAddComment:t,isSendDisabled:e=!1,isWaitingForCommentResponse:r=!1})=>{const o=ot(),f=rt(),c=nt(),L=S.useCallback(i=>{const{height:m,width:d}=i,s=o();if(!f||!s)return null;const l=f.selection.asSingle();if(l.ranges.length===0)return null;const a=l.ranges[0],{empty:H,to:O}=a;let{head:p}=a;const{platform:N}=st();p=N==="web"?p:O;const g=p===O;let v=p;if(g&&dt(f,a)&&(v-=1),H)return null;const{left:h,top:x,bottom:R}=s.contentDOM.getBoundingClientRect(),{left:w,top:_,bottom:E}=ct(s.coordsAtPos(v,g?-1:1)),C=ut(s);function A(){if(g)return Math.max(w-h+C-d,C);let u=w-h+C;return u+d>c&&(u=-(d-c)),u}function W(u){const b=m*2,y=u.contentHeight-(E-R)>b&&window.innerHeight-E>b,B=E-x+8,I=_-x-m-8;return g&&y||I<0?{top:B,aboveOrBelow:M.BELOW}:{top:I,aboveOrBelow:M.ABOVE}}const j=W(s);return{left:A(),top:j.top,aboveOrBelow:j.aboveOrBelow,toolbarSize:i}},[f,o,c]),D=S.useCallback(()=>o()?.dom??null,[o]);return n.jsx(Q,{onAddComment:t,isWaitingForCommentResponse:r,isSendDisabled:e,toolbarType:X.CODE,getToolbarPosition:L,getEditorDom:D,getSelectionRange:()=>{const i=o();if(!i)return null;const{state:m}=i,d=m.selection.asSingle();if(d.ranges.length===0)return null;const s=d.ranges[0],{from:l,to:a}=s;return l==null||a==null?null:{from:l,to:a,sourceFrom:l,sourceTo:a}}})};function pt({diff:t}){return Y(t?.edits??[]),null}function gt(t,e,r){const o=r?z():0;return t<=1e3-o?t-(e?tt:0):t-(e?et:0)}const Yt=({comments:t,currentlyStreamingLineIndex:e,isPreview:r=!1,isWaitingForCommentResponse:o=!1,isSendDisabled:f=!1,readonlyReason:c,isRequestActive:L=!1,language:D,value:i,textdocDiff:m,maxLength:d,onAcceleratorsExpandedChange:s,onAddComment:l,onAcceptComment:a,onDismissComment:H,onBlur:O,onSave:p,onChange:N,onCancelRequest:g,getStableCommentId:v=at,commentsMode:h=V.ENABLED,hideToolbar:x,hideAccelerators:R=!1,onSubmitAccelerator:w,modelCursor:_,codemirrorRef:E})=>{const C=S.useRef(null),A=lt(),[{width:W},j]=mt(),u=S.useRef(null),b=t.length>0,y=u.current,B=gt(W,b,Z(y)??!1),I=k(({commentingOn:T})=>T),F=k(({hoveredCommentId:T})=>T),P=k(({focusedCommentId:T})=>T);S.useEffect(()=>{C.current?.UNSAFE_setValue(i||"")},[i]);const q=W-B;return n.jsx("div",{className:it.code,ref:U(j,u),style:A&&r?{margin:"0 16px"}:{},children:n.jsxs(G,{id:"codemirror",comments:h===V.ALL_HIDDEN?void 0:t,commentingOn:I,currentlyStreamingLineIndex:e,hoveredCommentId:F,focusedCommentId:P,language:D,readonlyReason:c,onChange:N,maxLength:d,value:i,textdocDiff:m,editorRef:U(C,E),width:B,modelCursor:_,isPreview:r,hideLineNumbers:A&&r,onBlur:O,onSave:p,children:[n.jsxs(G.EditorChildren,{children:[!x&&n.jsx(ft,{onAddComment:l,isSendDisabled:f,isWaitingForCommentResponse:o}),h!==V.ALL_HIDDEN&&n.jsx("div",{className:b?"me-4":"",children:n.jsx($,{getStableCommentId:v,availableWidth:q,comments:t,commentsMode:h,onAddComment:l,onAcceptComment:a,onDismissComment:H,isWaitingForCommentResponse:o,isRequestActive:L,disableBlockComments:!0})})]}),n.jsxs(G.ContextChildren,{children:[m&&n.jsx(pt,{diff:m}),!R&&n.jsx(J,{isRequestActive:L,isVisuallyHidden:f||!!c?.isStreamingFromNative||c?.isReadonly&&!c.isStreaming,onSubmit:w,onCancel:g,actions:K,onExpandedChange:s})]})]})})};export{Yt as CodeComposer};
//# sourceMappingURL=d49p13thy8tfk6xs.js.map
