import{R as b,at as k,p8 as w,a as G,b7 as N,dX as O,p9 as W,c as y,pa as K,pb as U,pc as z,pd as H,pe as V,na as v,dN as j,dO as T,pf as J,pg as Z,ph as X,pi as $,cI as L,cO as I,gf as Y,pj as ee,dB as se,oK as te,C as ae,B as E}from"./cim4usely8ixso70.js";import{u as S,h as M,l as _,b as R,j as t,r as x,d as A}from"./n97h6so7iblif4c5.js";import{W as re}from"./f1p6129lssyhwlv5.js";import{d as ne,e as oe,c as ie}from"./hwthtm84lx2e2tl4.js";import{aw as le}from"./ivbsxyeeopn30y8l.js";const Me=({workspaceId:e,roleId:a})=>S({queryKey:[e,"role",a],enabled:!!a,queryFn:async()=>(await b.safeGet("/rbac/workspace/{workspace_id}/roles/{role_id}",{parameters:{query:{account_id:e,consistency:"strong"},path:{workspace_id:e,role_id:a}}})).role,staleTime:1e3*60*5}),_e=({workspaceId:e})=>S({queryKey:[e,"roles"],queryFn:()=>b.safeGet("/rbac/workspace/{workspace_id}/roles",{parameters:{query:{account_id:e,consistency:"strong"},path:{workspace_id:e}}})}),Re=({workspaceId:e,currentRoles:a})=>{const s=M(),l=k(),o=R(),{mutateAsync:r}=_({mutationFn:i=>b.safePost("/rbac/workspace/{workspace_id}/roles",{parameters:{query:{account_id:e},path:{workspace_id:e}},requestBody:{role_name:i.name,description:i.description}}),onMutate:({name:i,description:u})=>{s.cancelQueries({queryKey:[e,"roles"]});const p=a;return s.setQueryData([e,"roles"],d=>(d||(d={data:[],object:"list",has_more:!1}),{...d,data:[{id:"new",name:i,permissions:[],resource_type:"workspace",predefined_role:!1,description:u,created_at:Date.now(),updated_at:Date.now(),created_by:"system",metadata:{}},...d.data]})),{previousRoles:p}},onError:(i,u,p)=>{s.setQueryData([e,"roles"],p?.previousRoles),s.invalidateQueries({refetchType:"all",queryKey:[e,"roles"]}),i.message==="Role with this name already exists."&&l.warning(o.formatMessage({id:"Hn9Qxu",defaultMessage:"Role with this name already exists"}),{duration:1})},onSuccess:()=>{s.invalidateQueries({refetchType:"all",queryKey:[e,"roles"]})}});return{createRole:r}},Ce=({workspaceId:e})=>{const a=M(),{mutateAsync:s}=_({mutationFn:async l=>await b.safeDelete("/rbac/workspace/{workspace_id}/roles/{role_id}",{parameters:{query:{account_id:e},path:{workspace_id:e,role_id:l}}}),onSettled:()=>{a.invalidateQueries({refetchType:"all",queryKey:[e,"roles"]})}});return{deleteRole:s}},we=({workspaceId:e})=>{const a=M(),s=k(),l=R(),{mutateAsync:o}=_({mutationFn:async r=>(r.permissions.includes(w.SearchAccess)||(r.permissions=r.permissions.filter(i=>i!==w.AgentModeAccess)),await b.safePatch("/rbac/workspace/{workspace_id}/roles/{role_id}",{parameters:{query:{account_id:e},path:{workspace_id:e,role_id:r.id}},requestBody:{role_name:r.name,description:r.description,permissions:r.permissions}})),onMutate:({id:r,name:i,permissions:u})=>{const p=a.getQueryData([e,"role",r]);return a.setQueryData([e,"role",r],d=>({...d,name:i,permissions:u})),{previousRoles:p}},onError:(r,i,u)=>{a.setQueryData([e,"role",i.id],u?.previousRoles),r.message==="Role with this name already exists."?s.warning(l.formatMessage({id:"EDzkz/",defaultMessage:"Role with this name already exists"}),{duration:1}):s.danger(l.formatMessage({id:"ezIZZO",defaultMessage:"Failed to update permission"}),{duration:1})},onSuccess:()=>{a.invalidateQueries({refetchType:"all",queryKey:[e,"roles"]}),s.success(l.formatMessage({id:"L59KWu",defaultMessage:"Successfully updated permission"}),{duration:1})}});return{updateRole:o}},Se=({workspaceId:e,roleId:a})=>S({queryKey:[e,a,"role-groups"],queryFn:async()=>(await b.safeGet("/rbac/workspace/{workspace_id}/roles/{role_id}/principals",{parameters:{query:{account_id:e,consistency:"strong"},path:{workspace_id:e,role_id:a}}})).groups}),Ee=({workspaceId:e,roleId:a})=>{const s=M(),{mutateAsync:l}=_({mutationFn:async({id:o})=>await b.safePost("/rbac/workspace/{workspace_id}/role-assignments",{parameters:{query:{account_id:e},path:{workspace_id:e}},requestBody:{role_id:a,principal_id:o,principal_type:"group"}}),onSuccess:(o,r)=>{const i=[e,a,"role-groups"];s.setQueryData(i,u=>[...u,{id:r.id,name:r.name??"",num_members:r.num_members??0,created_time:new Date().toDateString()}]),s.invalidateQueries({refetchType:"all",queryKey:i})}});return{assignGroup:l}},ke=({workspaceId:e,roleId:a})=>{const s=M(),{mutateAsync:l}=_({mutationFn:async o=>await b.safeDelete("/rbac/workspace/{workspace_id}/role-assignments",{parameters:{query:{account_id:e,role_id:a,principal_id:o,principal_type:"group"},path:{workspace_id:e}}}),onSuccess:(o,r)=>{const i=[e,a,"role-groups"];s.setQueryData(i,u=>u?u.filter(p=>p.id!==r):[]),s.invalidateQueries({refetchType:"all",queryKey:i})}});return{unassignGroup:l}},ce=()=>{const e=G(),a=N(),s=O(),l=W(),o=a?.residencyRegion==="no_constraint"&&!s,r=y(e,"614413305"),i=y(e,"773249106"),u=y(e,"417039829"),p=y(e,"2509278897"),d=y(e,"3940160259"),h=y(e,"3507761600"),c=K(),n=U(),f=z(),m=H(),C=V(),{enabled:B}=v(j[T.GITHUB_CONNECTOR]),D=a?.isCBP()??!1,q=J(),P=Z(),Q=X(),F=$();return{isCBP:D,isRbacEnabled:F,githubConnectorEnabled:B,isInSupportedDrRegion:l,isSharedProjectsEnabled:i,showAgentInternetAccessToggle:h,showHiveToggle:u,showDeepResearchToggle:d,isAppleIntelligenceToggleEnabled:o&&p,isAppleIntelligenceMdmToggleEnabled:r,includeFeatures:c,includeModels:n,includeBetaSettings:f,includeBetaSettingsAdvanced:m,includeGizmoPermissions:C,isMDMEnabled:q,includeAgentMode:P,includeGPT5AndLegacyModels:Q}},ue=({ariaLabel:e,role:a,permissionName:s,handleSaveRole:l,disabled:o=!1,disabledReason:r})=>{const i=R();if(s==="codex_github_connector")return t.jsx(de,{});const u=t.jsx(L,{size:"normal","aria-label":e,checked:o?!1:a.permissions.includes(s),onCheckedChange:p=>{let d=[...a.permissions];p?d.push(s):d=d.filter(h=>h!==s),l({...a,permissions:d})},disabled:o});return o&&r?t.jsx(I,{label:i.formatMessage(r),children:u}):u},de=()=>{const{enabled:e}=v(j[T.GITHUB_CONNECTOR]);return t.jsx(L,{checked:e,disabled:!0,"aria-hidden":!0})},me="https://help.openai.com/en/articles/11750701-rbac",Ne=({role:e,onSave:a})=>{const s=R(),l=N(),o=ce(),{data:r}=Y((()=>{if(l==null)throw new Error("Account must not be null");const c=l.getWorkspaceId();if(c==null)throw new Error("Workspace ID must not be null");return c})()),{permissionsBySection:i,totalPermissionsCount:u}=x.useMemo(()=>{const n=ee({isCanvasEnabled:!0,isSearchEnabled:e.permissions.includes(w.SearchAccess),isEnterprisey:l?.isEnterprisey()??!1,...o,isQuorumM0:!1,isQuorumM1:!1,legacyModelsEnabled:r?.beta_settings.legacy_models??!1}).map(m=>({...m,entries:m.entries.filter(C=>C.rbac)})).filter(m=>m.entries.length>0),f=n.flatMap(m=>m.entries).length;return{permissionsBySection:n,totalPermissionsCount:f}},[l,o,e.permissions,r?.beta_settings]),[p,d]=x.useState(""),h=i.map(c=>({...c,entries:c.entries.filter(n=>{const f=typeof n.title=="string"?n.title:s.formatMessage(n.title),m=n.description?typeof n.description=="string"?n.description:s.formatMessage(n.description,n.descriptionValues):"";return n.rbac&&([f,m].join(" ").toLowerCase().includes(p.toLowerCase())||n.permissionName.toLowerCase().includes(p.toLowerCase()))})})).filter(c=>c.entries.length>0);return t.jsxs(ne,{children:[t.jsx("div",{className:"text-token-text-secondary text-sm",children:s.formatMessage(pe.customRoleDescription,{link:c=>t.jsx(se,{className:"underline",target:"_blank",rel:"noreferrer",href:me,children:c})})}),t.jsx("div",{className:"flex flex-row items-center justify-between",children:t.jsx(te,{inputClassName:"w-[250px] rounded-full! text-sm",value:p,onChange:c=>{d(c.target.value)},placeholder:s.formatMessage({id:"hRuTvi",defaultMessage:"Search {count} permissions"},{count:u})})}),h.map(c=>t.jsx(re,{title:c.title,description:c.description,descriptionValues:c.descriptionValues,children:t.jsx(oe,{children:c.entries.map(n=>{const f=n.permissionName,m=typeof n.title=="string"?n.title:s.formatMessage(n.title);return t.jsx(ie,{children:t.jsxs("div",{className:"flex w-full items-center justify-between gap-4",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-md",children:m}),n.description&&t.jsx("span",{className:"text-token-text-tertiary text-sm",children:typeof n.description=="string"?n.description:s.formatMessage(n.description,n.descriptionValues)})]}),t.jsx(ue,{ariaLabel:m,role:e,permissionName:n.permissionName,handleSaveRole:a,disabled:n.disabled,disabledReason:n.disabledReason})]})},f)})})},String(c.title.defaultMessage)))]})},pe=A({customRoleDescription:{id:"I9hJih",defaultMessage:"Custom role permissions override workplace-level settings. A userâ€™s effective permissions are the sum of all their assigned custom roles. Not all settings are available as role-based permissions. <link>Learn more</link>"},discardChangesLabel:{id:"0gdhtj",defaultMessage:"Discard changes"},save:{id:"LE9GJk",defaultMessage:"Save"},searchPlaceholder:{id:"EaN6oB",defaultMessage:"Search permissions"}}),ve=({onClose:e,onSave:a,isCreate:s,defaultData:l})=>{const o=R(),[r,i]=x.useState(l?.name||""),[u,p]=x.useState(l?.description||""),[d,h]=x.useState(""),[c,n]=x.useState(!1),f=async()=>{if(!r.trim()){h(o.formatMessage(g.roleNameError));return}n(!0);try{await a({name:r,description:u}),e()}catch{}finally{n(!1)}};return t.jsx(ae,{testId:"modal-upsert-role",size:"custom",className:"max-w-lg text-sm",isOpen:!0,onClose:e,showCloseButton:!0,type:"success",title:o.formatMessage(s?g.createRoleTitle:g.editRoleTitle),primaryButton:t.jsx(E,{color:"primary",onClick:()=>f(),loading:c,children:o.formatMessage(g.buttonSaveLabel)}),secondaryButton:t.jsx(E,{onClick:e,color:"secondary",children:o.formatMessage(g.buttonCancelLabel)}),children:t.jsxs("form",{className:"flex flex-col gap-6",children:[t.jsxs("label",{className:"block",children:[t.jsx("span",{className:"text-sm font-medium",children:o.formatMessage(g.roleNameLabel)}),t.jsx("input",{type:"text",className:`border-token-border-primary text-token-text-primary focus:border-token-brand focus:ring-token-brand bg-token-bg-primary mt-1 block w-full rounded-md border px-3 py-2 text-sm ${d?"border-token-text-status-error":""}`,placeholder:o.formatMessage(g.roleNameLabel),value:r,onChange:m=>{i(m.target.value),h("")}}),d&&t.jsx("span",{className:"text-token-text-status-error mt-1 text-xs",children:d})]}),t.jsxs("label",{className:"block",children:[t.jsx("span",{className:"text-sm font-medium",children:o.formatMessage(g.descriptionLabel)}),t.jsx("span",{className:"text-token-text-tertiary ms-1 text-sm font-medium",children:o.formatMessage(g.optionalLabel)}),t.jsx("input",{type:"text",className:"border-token-border-primary text-token-text-primary focus:border-token-brand focus:ring-token-brand bg-token-bg-primary mt-1 block w-full rounded-md border px-3 py-2 text-sm",placeholder:o.formatMessage(g.descriptionLabel),value:u,onChange:m=>p(m.target.value)})]}),t.jsxs("div",{className:"bg-token-bg-tertiary text-token-text-primary mb-1 flex w-full flex-row gap-4 rounded-xl p-4",children:[t.jsx(le,{className:"icon"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium",children:o.formatMessage(g.infomationTitle)}),t.jsx("div",{className:"text-token-text-secondary",children:o.formatMessage(g.informationText)})]})]})]})})},g=A({createRoleTitle:{id:"xmlnWv",defaultMessage:"New custom role"},editRoleTitle:{id:"6A6tgB",defaultMessage:"Edit custom role"},roleNameLabel:{id:"VGBBHP",defaultMessage:"Role name"},optionalLabel:{id:"KR/EbO",defaultMessage:"(optional)"},descriptionLabel:{id:"BnuWZw",defaultMessage:"Description"},infomationTitle:{id:"L1pBDh",defaultMessage:"What's a custom role?"},informationText:{id:"DvDdnE",defaultMessage:"Roles are a great way to control which features a user can access. When assigned, the userâ€™s permissions will be calculated as the sum of their custom roles."},buttonCancelLabel:{id:"rMxszm",defaultMessage:"Cancel"},buttonSaveLabel:{id:"JELOdt",defaultMessage:"Save"},roleNameError:{id:"iyN7K7",defaultMessage:"Role name is required"}}),ge="role-workspace-member",je=e=>e.id.startsWith(ge)&&e.predefined_role;export{ue as P,Ne as R,ve as U,Ee as a,ke as b,Me as c,Ce as d,we as e,_e as f,Re as g,ce as h,je as i,Se as u};
//# sourceMappingURL=gmhnna4l04odhw7v.js.map
