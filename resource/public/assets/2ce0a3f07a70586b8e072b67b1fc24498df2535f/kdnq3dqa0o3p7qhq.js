import{r,j as t,M as y}from"./n97h6so7iblif4c5.js";import{cT as A,h8 as H,fF as _,aJ as F,aI as I,d5 as G,P as x,cb as B,f9 as L,aG as R,hH as z,B as C,al as J,eG as K}from"./cim4usely8ixso70.js";import{dw as U,dx as V}from"./ivbsxyeeopn30y8l.js";import{E as D}from"./klgqvvgd4qwfvke3.js";function O({initialText:c,clientThreadId:n,currentLeaf:i,onExitEdit:d,onRequestCompletion:h,disabled:j,attachments:o}){const[l,M]=r.useState(c??""),u=r.useRef(null),E=A(),p=H.useStore(),g=l.trim()==="",b=r.useCallback(e=>{M(e.currentTarget.value)},[]),m=r.useCallback(e=>{if(g)return;const s={},a=_();o&&(s.attachments=o),a&&(s.__internal={search_settings:a});const v=p.getActiveSystemHintType(),{systemHints:N,extraStreamParams:w}=U(v?[v]:[]),S=F(n),P=I.getParentNode(S,i).message.id;h({sourceEvent:e,parentMessageId:P,promptMessage:G(l,Object.keys(s).length>0?s:void 0),extraStreamParams:w,completionMetadata:{conversationMode:S?.mode,systemHints:N}}),d(),x.logEvent("Change Active Node",{intent:"edit_save"})},[g,o,n,p,h,d,i,l]),f=r.useCallback(()=>{B(n,e=>{L.setCurrentBranch(e,i)}),x.logEvent("Change Active Node",{intent:"edit_cancel"}),d(),x.logEvent("Cancel Edit Prompt",{threadId:R(n)})},[i,d,n]);r.useEffect(()=>{const e=u.current;if(e){e.focus();const s=e.value.length;e.setSelectionRange(s,s)}},[]),r.useEffect(()=>{const e=u.current,s=a=>{a.isComposing||(a.key==="Enter"&&a.metaKey?m(a):a.key==="Escape"&&f())};return e&&e.addEventListener("keydown",s),()=>{e&&e.removeEventListener("keydown",s)}},[f,m]);const T=o&&o.length>0&&t.jsx(W,{children:o.map(e=>t.jsx(V,{width:E?"wide":"normal",file:e.name,contextConnectorInfo:z(e.context_connector_info)},e.id))}),k=t.jsx("div",{className:"m-2 max-h-[25dvh] overflow-auto",children:t.jsx(D,{ref:u,value:l,onChange:b,className:"m-0 w-full resize-none border-0 bg-transparent focus:ring-0 focus-visible:ring-0"})});return t.jsxs("div",{className:"bg-token-main-surface-tertiary rounded-3xl px-3 py-3",children:[T,k,t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx(C,{as:"button",color:"secondary",onClick:f,children:t.jsx(y,{id:"D9gbPp",defaultMessage:"Cancel"})}),t.jsx(C,{as:"button",onClick:m,disabled:j||g,children:t.jsx(y,{id:"KGxIJG",defaultMessage:"Send"})})]})]})}const W=J.div`flex gap-2 flex-wrap`;function ee({message:c,...n}){return t.jsx(O,{currentLeaf:c.id,initialText:K(c),attachments:c.metadata?.attachments,...n})}export{ee as TextMessageEditor};
//# sourceMappingURL=kdnq3dqa0o3p7qhq.js.map
