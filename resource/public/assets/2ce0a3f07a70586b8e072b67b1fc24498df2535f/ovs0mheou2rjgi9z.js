const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/f7snbkoqmhyldzab.js","assets/n97h6so7iblif4c5.js"])))=>i.map(i=>d[i]);
import{ac as ee,d as te,bj as de,ad as se,a as ue,at as me,p as pe,bb as xe,nX as fe,es as h,nY as q,C as ge,ex as he,B as $,nZ as D,ev as ae,fT as ye,b7 as je,ao as v,ew as ve,R as be}from"./cim4usely8ixso70.js";import{j as t,b as V,r as I,h as Se,M as y,c as B,u as Me,n as z}from"./n97h6so7iblif4c5.js";import{at as we,cG as T,k as ne,cH as ie,aq as Ce,cI as H,av as ke,cJ as _e,i as Ne,cK as Le,cL as Ee,bA as Q,cM as Re,cN as J,cO as Ie,cP as Z}from"./ivbsxyeeopn30y8l.js";import{a as Ae}from"./ok0v4utan8f8dzts.js";import{c as Pe,E as Oe}from"./fohx4vo3qyr0edh2.js";import{S as Ue,c as X}from"./dzjn1hzm825wa74f.js";import"./d3y72ugnrmac5z1v.js";import"./mfrmh8iqcq7c5rho.js";const Te=ee(()=>se(()=>import("./f7snbkoqmhyldzab.js"),__vite__mapDeps([0,1])).then(s=>s.DirectorySyncResourceManagedIndication));function De({value:s,onChange:e,options:i,onSearch:p,placeholder:u,trailingComponent:o,isLoading:m,classNames:n}){const x=a=>t.jsx(X.IndicatorsContainer,{...a,children:o}),c=(a,d)=>d.context==="value"?a.label:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"font-semibold",children:a.label}),a.sublabel&&t.jsx("span",{className:"text-token-text-secondary text-xs",children:a.sublabel})]}),a.kind==="group"&&a.isScimManaged&&t.jsx(Te,{})]}),f=a=>{const{isFocused:d,isSelected:b,innerProps:M,innerRef:w,data:k}=a;return t.jsx("div",{...M,ref:w,className:te("cursor-pointer rounded-xs p-2",b?"bg-token-interactive-bg-secondary-press":d?"bg-token-interactive-bg-secondary-hover":"bg-transparent"),children:c(k,{context:"menu"})})},l=a=>t.jsx(X.MultiValue,{...a,children:t.jsx("button",{className:"text-token-text-primary bg-token-main-surface-secondary hover:border-token-border-medium hover:bg-token-main-surface-tertiary m-1 rounded-full border py-1 ps-3 pe-2 text-sm",onClick:d=>{a.removeProps.onClick?.(d),d.preventDefault()},children:t.jsxs("span",{className:"flex min-w-0 items-center gap-1",children:[t.jsx("span",{className:"min-w-0",children:a.children}),t.jsx(de,{className:"icon-sm"})]})})});return t.jsx(Ue,{className:"react-select-container min-w-0",classNamePrefix:"react-select",isMulti:!0,isClearable:!1,isLoading:m,options:i,value:s,classNames:n,getOptionValue:a=>`${a.kind}:${a.id}`,getOptionLabel:a=>a.label,onChange:a=>e(a),onInputChange:(a,d)=>{d.action!=="menu-close"&&d.action!=="input-blur"&&p(a)},placeholder:u,openMenuOnFocus:!0,openMenuOnClick:!0,hideSelectedOptions:!1,closeMenuOnSelect:!1,backspaceRemovesValue:!0,controlShouldRenderValue:!0,components:{DropdownIndicator:()=>null,ClearIndicator:()=>null,IndicatorsContainer:x,MultiValue:l,Option:f,MultiValueRemove:()=>null},formatOptionLabel:c,filterOption:(a,d)=>a.data.label.toLowerCase().includes(d.toLowerCase())||(a.data.sublabel??"").toLowerCase().includes(d.toLowerCase())})}const qe=ee(()=>se(()=>import("./f7snbkoqmhyldzab.js"),__vite__mapDeps([0,1])).then(s=>s.DirectorySyncResourceManagedIndication));function G(s,e){return s===void 0||e===void 0?!1:s.split("__")[0]===e.split("__")[0]}function Y(s){return s.toLowerCase().trim()}function Ve(s,e){return s===void 0||e===void 0?!1:Y(s)===Y(e)}function re(s,e){const i=new Set,p=new Set,u=new Set,o=new Set,m=[...s];for(const n of s)n.type===h.USER?i.add(n.user_id):n.type===h.EMAIL?u.add(n.user_email):n.type===h.GROUP?p.add(n.group_id):o.add(n.type);for(const n of e)if(n.type===h.EMAIL){if(u.has(n.user_email))continue;u.add(n.user_email),m.push(n)}else if(n.type===h.USER){if(i.has(n.user_id))continue;i.add(n.user_id),m.push(n)}else if(n.type===h.GROUP){if(p.has(n.group_id))continue;p.add(n.group_id),m.push(n)}else{if(o.has(n.type))continue;o.add(n.type),m.push(n)}return m}function We(s,e){const i=s.filter(p=>[h.ALL].indexOf(p.type)===-1);return e!=null&&i.push(e),i}function ze(s){return s.find(e=>e.type===h.ALL)?J.Link:J.Private}function oe(s){return s.can_write?"edit":"view"}function Ge(s){switch(s){case h.ALL:return"all";default:return"invite"}}function rt({gizmo:s,publishedGizmo:e,onClose:i}){"use forget";const p=ue(),u=V(),o=me(),m=pe(p),n=m?.isWorkspaceAccount()??!1,x=xe(),c=we(),[f,l]=I.useState(s.sharing?.subjects??[]),[a,d]=I.useState(!1),b=Se(),{canEdit:M}=fe(e);function w(r,j,S){return r.type===h.USER&&r.user_id.indexOf("__")===-1?{...r,user_id:r.user_id+"__"+m?.getWorkspaceId()}:r}async function k(r,j,S){if(a)return;d(!0);const E=j?S.map(w):S,O=ze(E);try{const U=await c.mutateAsync({id:r,update:{sharing:{recipient:O,subjects:E},sharingRecipient:O}});U?.resource&&l(Le(U.resource).sharing.subjects)}catch(U){const ce=ye(U);o.warning(ce??"Error",{duration:2}),l(s.sharing?.subjects??[])}d(!1),b.invalidateQueries({queryKey:["gizmos"]}),b.refetchQueries({queryKey:["gizmos","discovery"]}),b.refetchQueries({queryKey:["gizmo",{gizmoId:r}]}),b.invalidateQueries({queryKey:["gizmo","userActionSettings",{gizmoId:r}]}),b.invalidateQueries({queryKey:["workspace"]})}const L=G(e.gizmo.author.user_id.split("__")[0],x?.id),_=T(f),R=n||_?.type!==h.ALL,P=R?ne:ie,A=T(f)?.type!==h.ALL?t.jsx(y,{id:"fAE/rP",defaultMessage:"Only those invited"}):t.jsx(y,{id:"Mr1Pk0",defaultMessage:"Anyone with a link"}),g=t.jsx(F,{capabilities:_?.capabilities??q,onChange:r=>{const j=f.map(S=>S===_?{...S,capabilities:r}:S);l(j),k(e.gizmo.id,n,j)},triggerClassNames:"text-token-text-primary"}),N=r=>t.jsx("span",{className:"text-token-text-primary pe-4 text-sm",children:t.jsx(y,{...W(r.capabilities)})}),C=r=>t.jsxs(v.Root,{children:[t.jsxs(v.Trigger,{color:"secondary",className:"text-token-text-primary text-normal hover:bg-token-interactive-bg-secondary-hover radix-state-open:bg-token-interactive-bg-secondary-press whitespace-nowrap",disabled:a,children:[t.jsx(y,{...W(r.capabilities)}),t.jsx(Q,{className:"icon-sm"})]}),t.jsx(v.Portal,{children:t.jsxs(v.Content,{className:"max-w-[320px]",children:[t.jsx(v.RadioGroup,{value:oe(r.capabilities),onValueChange:j=>{const S=f.map(E=>E===r?{...E,capabilities:j==="edit"?D:q}:E);l(S),k(e.gizmo.id,n,S)},children:[q,D].map((j,S)=>t.jsx(le,{capabilities:j,selected:ae(j,r.capabilities)},S))}),t.jsx(v.Item,{onClick:()=>{const j=f.filter(S=>S!==r);l(j),k(e.gizmo.id,n,j)},color:"danger",icon:Re,children:t.jsx(y,{id:"HEaMqG",defaultMessage:"Remove from project"})})]})})]});return t.jsx(ge,{testId:"modal-share-project",type:"success",className:"max-w-[600px]",size:"custom",isOpen:!0,onClose:i,footerIsSpacedBetween:!0,primaryButton:t.jsx($,{color:"primary",icon:Ne,onClick:r=>_e(p,e,o,r,u.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"})),children:t.jsx(y,{id:"bbhdTf",defaultMessage:"Copy link"})}),footerContent:t.jsx("span",{className:"text-token-text-secondary relative top-2 pe-14 text-xs",children:t.jsx(y,{id:"Vw/jUJ",defaultMessage:"Project files and instructions are shared. When you share a project, ChatGPT will not be able to reference memories from outside chats."})}),title:u.formatMessage(ke.projectShareTitle),showCloseButton:!0,children:t.jsxs("div",{className:"flex flex-col space-y-4",children:[n&&M?t.jsx($e,{newSharingSubjects:f,setNewSharingSubjects:l,publishedGizmo:e,isSaving:a,saveGizmo:k}):M?t.jsx(Be,{newSharingSubjects:f,setNewSharingSubjects:l,publishedGizmo:e,isSaving:a,saveGizmo:k}):null,t.jsx("div",{className:"text-token-text-secondary text-sm font-normal",children:t.jsx(y,{id:"eMoeS0",defaultMessage:"Who has access"})}),t.jsxs("div",{className:"max-h-[200px] space-y-2 overflow-y-auto",children:[t.jsx(K,{icon:t.jsx(P,{className:"h-6 w-6"}),trailing:!R&&_?.type!==h.ALL?g:null,children:M?t.jsx(Je,{newSharingSubjects:f,setNewSharingSubjects:l,saveGizmo:k,publishedGizmo:e,isBusinessWorkspace:n,isSaving:a}):A}),t.jsx(K,{icon:L?t.jsx(Ce,{user:x}):t.jsx(H,{name:e.gizmo.author.display_name??"User",initialsCount:2}),trailing:t.jsx("span",{className:"text-token-text-primary pe-4 text-sm",children:t.jsx(y,{id:"qb439J",defaultMessage:"Owner"})}),children:L?t.jsx(y,{id:"I6hNog",defaultMessage:"{userName} {you}",values:{userName:x?.name??x?.email,you:t.jsx("span",{className:"text-token-text-secondary",children:t.jsx(y,{id:"VZNoWp",defaultMessage:"(you)"})})}}):t.jsx(y,{id:"Xjm7cK",defaultMessage:"{userName}",values:{userName:e.gizmo.author.display_name}})}),f.map((r,j)=>he(r)&&t.jsx(K,{icon:t.jsx(H,{name:r.type===h.GROUP?r.group_name:`${r.user_name} ${r.user_email}`,initialsCount:r.type===h.USER||r.type===h.EMAIL?2:1}),trailing:L?C(r):N(r),children:t.jsxs("div",{className:"flex flex-col justify-center",children:[n&&t.jsxs("span",{className:"flex flex-row items-center",children:[t.jsx("span",{className:"text-token-text-primary truncate text-sm leading-tight",children:r.type===h.GROUP?r.group_name:t.jsx(y,{id:"B3bf3E",defaultMessage:"{userName} {you}",values:{userName:r.user_name,you:G(r.user_id,x?.id)?t.jsx("span",{className:"text-token-text-secondary",children:t.jsx(y,{id:"VZNoWp",defaultMessage:"(you)"})}):null}})}),r.type===h.GROUP&&r.is_scim_managed&&t.jsx(qe,{})]}),!n&&(r.type===h.USER||r.type===h.EMAIL)&&t.jsx("span",{className:"text-token-text-primary truncate text-sm leading-tight",children:t.jsx(y,{id:"oj/38v",defaultMessage:"{email} {you}",values:{email:r.user_email??"",you:Ve(r.user_email,x?.email)||G(r.user_id,x?.id)?t.jsx("span",{className:"text-token-text-secondary",children:t.jsx(y,{id:"VZNoWp",defaultMessage:"(you)"})}):null}})})]})},j))]}),t.jsx("hr",{className:"border-token-border-light"})]})})}function F(s){"use forget";const e=B.c(23),{capabilities:i,onChange:p,triggerClassNames:u}=s;let o;e[0]!==u?(o=te("text-token-text-secondary hover:bg-token-interactive-bg-secondary-hover radix-state-open:bg-token-interactive-bg-secondary-press whitespace-nowrap",u),e[0]=u,e[1]=o):o=e[1];let m;e[2]!==i?(m=W(i),e[2]=i,e[3]=m):m=e[3];let n;e[4]!==m?(n=t.jsx(y,{...m}),e[4]=m,e[5]=n):n=e[5];let x;e[6]===Symbol.for("react.memo_cache_sentinel")?(x=t.jsx(Q,{className:"icon-sm"}),e[6]=x):x=e[6];let c;e[7]!==o||e[8]!==n?(c=t.jsxs(v.Trigger,{color:"secondary",className:o,children:[n,x]}),e[7]=o,e[8]=n,e[9]=c):c=e[9];let f;e[10]!==i?(f=oe(i),e[10]=i,e[11]=f):f=e[11];let l;e[12]!==p?(l=M=>{p(M==="edit"?D:q)},e[12]=p,e[13]=l):l=e[13];let a;e[14]!==i?(a=[q,D].map((M,w)=>t.jsx(le,{capabilities:M,selected:ae(M,i)},w)),e[14]=i,e[15]=a):a=e[15];let d;e[16]!==f||e[17]!==l||e[18]!==a?(d=t.jsx(v.Portal,{children:t.jsx(v.Content,{className:"max-w-[320px]",children:t.jsx(v.RadioGroup,{value:f,onValueChange:l,children:a})})}),e[16]=f,e[17]=l,e[18]=a,e[19]=d):d=e[19];let b;return e[20]!==c||e[21]!==d?(b=t.jsxs(v.Root,{children:[c,d]}),e[20]=c,e[21]=d,e[22]=b):b=e[22],b}function W(s){return s.can_write?z({id:"vsUknl",defaultMessage:"Can edit"}):s.can_view_config?z({id:"4ceJzB",defaultMessage:"Can chat"}):z({id:"x2E8ET",defaultMessage:"Unknown"})}function Ke(s){return s.can_write?Ie:s.can_view_config?Z:Z}function le(s){"use forget";const e=B.c(14),{capabilities:i,selected:p}=s,u=V();let o;e[0]!==i.can_write?(o=i.can_write?t.jsx(y,{id:"IShl7Y",defaultMessage:"Chat and edit project content"}):t.jsx(y,{id:"Ux4GYU",defaultMessage:"Chat and view project content"}),e[0]=i.can_write,e[1]=o):o=e[1];const m=o,n=i.can_write?"edit":"view",x=p?"selected":"default";let c;e[2]!==i?(c=Ke(i),e[2]=i,e[3]=c):c=e[3];let f;e[4]===Symbol.for("react.memo_cache_sentinel")?(f=t.jsx(v.RadioItemCheck,{}),e[4]=f):f=e[4];let l;e[5]!==i||e[6]!==u?(l=u.formatMessage(W(i)),e[5]=i,e[6]=u,e[7]=l):l=e[7];let a;return e[8]!==m||e[9]!==n||e[10]!==x||e[11]!==c||e[12]!==l?(a=t.jsx(v.RadioItem,{value:n,color:x,icon:c,trailing:f,label:l,secondary:m}),e[8]=m,e[9]=n,e[10]=x,e[11]=c,e[12]=l,e[13]=a):a=e[13],a}function $e({newSharingSubjects:s,setNewSharingSubjects:e,publishedGizmo:i,isSaving:p,saveGizmo:u}){"use forget";const o=je(),m=V(),[n,x]=I.useState(""),[c,f]=I.useState([]),[l,a]=I.useState({...D}),[d]=Ae(n,100),b=Ee(o?.id,0,d,10),M=I.useMemo(()=>b.data?.items?.filter(g=>g.account_user_id!==i?.gizmo.author.user_id).map(g=>({kind:"user",id:g.account_user_id,label:g.name??"Unknown User",sublabel:g.email??""}))??[],[b.data?.items,i]),{data:w,isLoading:k}=Me({queryKey:[o?.id,"groups","filtered",d],queryFn:o?()=>be.safeGet("/accounts/{account_id}/groups",{parameters:{path:{account_id:o.id},query:{query:d,offset:0,orderby:"@score",limit:20}}}):void 0,enabled:d.trim()!==""&&o!=null&&!!o.getWorkspaceId()}),L=I.useMemo(()=>w?.items.slice(0,10).map(g=>({kind:"group",id:g.id,label:g.name,sublabel:m.formatMessage({id:"r3Rx6X",defaultMessage:"{numMembers, plural, one {1 member} other {# members}}"},{numMembers:g.num_members??0}),isScimManaged:!!g.is_scim_managed}))??[],[w,m]),_=g=>`${g.kind}:${g.id}`,R=new Set(c.map(_)),P=[...M,...L].filter(g=>!R.has(_(g))),A=()=>{const g=c.map(C=>C.kind==="user"?{type:h.USER,user_id:C.id,user_name:C.label,user_email:C.sublabel??"",capabilities:{...l}}:{type:h.GROUP,group_id:C.id,group_name:C.label,is_scim_managed:!!C.isScimManaged,capabilities:{...l}}),N=re(s,g);e(N),f([]),u(i.gizmo.id,!0,N)};return t.jsxs("div",{className:"flex w-full min-w-0 items-center space-x-3",children:[t.jsx("div",{className:"min-w-0 flex-1",children:t.jsx(De,{value:c,classNames:{control:()=>"h-auto! min-h-[40px]! max-h-[192px] items-start overflow-y-auto"},onChange:g=>f([...g]),onSearch:x,options:P,placeholder:"Search people or groups",trailingComponent:t.jsx(F,{capabilities:l,onChange:a,triggerClassNames:"text-token-text-secondary"}),isLoading:b.isLoading||k})}),t.jsx("div",{className:"shrink-0",children:t.jsx($,{color:"blue",disabled:p||c.length===0,onClick:A,children:t.jsx(y,{id:"IzWABi",defaultMessage:"Invite"})})})]})}function Be(s){"use forget";const e=B.c(28),{newSharingSubjects:i,setNewSharingSubjects:p,publishedGizmo:u,saveGizmo:o,isSaving:m}=s,n=V();let x;e[0]===Symbol.for("react.memo_cache_sentinel")?(x={...D},e[0]=x):x=e[0];const[c,f]=I.useState(x);let l;e[1]===Symbol.for("react.memo_cache_sentinel")?(l=[],e[1]=l):l=e[1];const[a,d]=I.useState(l);let b;e[2]!==a?(b=a.map(He),e[2]=a,e[3]=b):b=e[3];const M=b;let w;e[4]===Symbol.for("react.memo_cache_sentinel")?(w=E=>{const O=E.map(Fe);d(Ze(O))},e[4]=w):w=e[4];const k=w;let L;e[5]!==n?(L=n.formatMessage({id:"Mabh3o",defaultMessage:"Email, separated by commas"}),e[5]=n,e[6]=L):L=e[6];const _=L;let R;e[7]!==a||e[8]!==i||e[9]!==u.gizmo.id||e[10]!==o||e[11]!==c||e[12]!==p?(R=()=>{const E=a.map(U=>({type:h.EMAIL,user_email:U,capabilities:{...c}})),O=re(i,E);p(O),d([]),o(u.gizmo.id,!1,O)},e[7]=a,e[8]=i,e[9]=u.gizmo.id,e[10]=o,e[11]=c,e[12]=p,e[13]=R):R=e[13];const P=R;let A;e[14]===Symbol.for("react.memo_cache_sentinel")?(A={control:Qe},e[14]=A):A=e[14];let g;e[15]!==c?(g=t.jsx(F,{capabilities:c,onChange:f,triggerClassNames:"text-token-text-secondary"}),e[15]=c,e[16]=g):g=e[16];let N;e[17]!==M||e[18]!==_||e[19]!==g?(N=t.jsx("div",{className:"min-w-0 flex-1",children:t.jsx(Oe,{value:M,onChange:k,placeholder:_,classNames:A,trailingComponent:g})}),e[17]=M,e[18]=_,e[19]=g,e[20]=N):N=e[20];const C=m||a.length===0;let r;e[21]===Symbol.for("react.memo_cache_sentinel")?(r=t.jsx(y,{id:"eC8UhE",defaultMessage:"Add"}),e[21]=r):r=e[21];let j;e[22]!==P||e[23]!==C?(j=t.jsx("div",{className:"shrink-0",children:t.jsx($,{color:"blue",onClick:P,disabled:C,children:r})}),e[22]=P,e[23]=C,e[24]=j):j=e[24];let S;return e[25]!==j||e[26]!==N?(S=t.jsxs("div",{className:"flex w-full min-w-0 flex-row items-center space-x-3",children:[N,j]}),e[25]=j,e[26]=N,e[27]=S):S=e[27],S}function Qe(){return"h-auto! min-h-[40px]! max-h-[192px] items-start overflow-y-auto"}function Fe(s){return s.value}function He(s){return Pe(s??"")}function Je({newSharingSubjects:s,setNewSharingSubjects:e,saveGizmo:i,publishedGizmo:p,isBusinessWorkspace:u,isSaving:o}){const m=V();return u?t.jsx("div",{className:"flex min-h-9 items-center",children:t.jsx(y,{id:"fAE/rP",defaultMessage:"Only those invited"})}):t.jsxs(v.Root,{children:[t.jsxs(v.Trigger,{className:"px-0","data-no-hover-bg":!0,disabled:o,children:[T(s)?.type!==h.ALL?t.jsx(y,{id:"fAE/rP",defaultMessage:"Only those invited"}):t.jsx(y,{id:"Mr1Pk0",defaultMessage:"Anyone with a link"}),t.jsx(Q,{className:"icon-sm"})]}),t.jsx(v.Portal,{children:t.jsx(v.Content,{children:t.jsxs(v.RadioGroup,{value:Ge(T(s)?.type??h.USER),onValueChange:n=>{const x=We(s,n==="all"?{type:h.ALL,capabilities:ve}:null);e(x),i(p.gizmo.id,u,x)},children:[t.jsx(v.RadioItem,{icon:ne,value:"invite",label:m.formatMessage({id:"fAE/rP",defaultMessage:"Only those invited"}),trailing:t.jsx(v.RadioItemCheck,{}),color:T(s)?.type===h.USER?"selected":"default"}),t.jsx(v.RadioItem,{icon:ie,value:"all",label:m.formatMessage({id:"Mr1Pk0",defaultMessage:"Anyone with a link"}),trailing:t.jsx(v.RadioItemCheck,{}),color:T(s)?.type===h.ALL?"selected":"default"})]})})})]})}function K({icon:s,children:e,trailing:i,className:p=""}){return t.jsxs("div",{className:`mb-4 flex flex-row items-center justify-between space-x-3 ${p}`,children:[t.jsx("div",{className:"shrink-0 grow-0",children:s}),t.jsx("div",{className:"text-token-text-primary grow truncate text-sm",children:e}),i&&t.jsx("div",{children:i})]})}function Ze(s){const e=new Set,i=[];for(const p of s){const u=p.toLowerCase();e.has(u)||(e.add(u),i.push(u))}return i}export{rt as ShareProjectModal};
//# sourceMappingURL=ovs0mheou2rjgi9z.js.map
