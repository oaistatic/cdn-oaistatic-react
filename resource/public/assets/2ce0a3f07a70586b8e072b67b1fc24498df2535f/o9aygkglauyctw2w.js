const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/lpzg5cch4pha0ne4.js","assets/n97h6so7iblif4c5.js","assets/ivbsxyeeopn30y8l.js","assets/cim4usely8ixso70.js","assets/root-c9lkqywj.css","assets/conversation-small-dhmr708a.css","assets/w1hy7jl6qozvpkka.js","assets/dv7cqw89v242idd1.js","assets/pfkjjarjk6ymzx5d.js","assets/eo9i015vih87ul2f.js","assets/i3kdjp3gzwosm8nc.js"])))=>i.map(i=>d[i]);
import{b as ys,r as c,j as e,M as W,o as pa,a as fa,O as ga}from"./n97h6so7iblif4c5.js";import{b7 as ha,a as He,u as $e,iR as Sa,j6 as Kn,d as Ie,aD as je,kC as Aa,k as Ps,cm as ks,ac as Ms,ad as js,P as pe,aO as xa,aV as st,aU as tt,eO as Ca,ic as it,a4 as Yn,eT as mt,A as pt,a_ as Ye,pk as ba,aM as $n,aE as xs,d0 as Cs,aI as G,cD as qn,pl as ya,fC as Qn,at as ft,ao as Ae,fx as Ke,au as Pa,pm as ka,d1 as Ts,bb as Ma,aY as Jn,fN as ja,h as Ta,as as Ra,c7 as va,pn as _a,fR as wa,d2 as Ea,c as xe,iT as Rn,h8 as Ba,dC as Fa,o0 as Da,dF as Ia,po as La,gU as vn,gT as Xn,eW as Ha,pp as Na,cl as Ua,fs as Oa,fv as _n,ka as za,b8 as Ga,hF as Wa,c_ as Va,q as x,fH as wn,fw as Ka,nJ as Ya,kR as En,pq as $a,bu as Ce,nF as qa,nG as Qa,iu as Ja,aG as hs,ga as Bn,kV as Xa,e$ as Fn,hq as As,pr as Dn,cb as Me,dO as Za,aF as Zn,mB as er,ps as In,f1 as Ss,oE as sr,oF as tr,kH as nr,jY as or,nI as ar,nK as rr,iS as nt,p as gt,bM as ir,l as cr,pt as eo,pu as lr,cM as ur,pv as dr,cE as De,kD as mr,pw as pr,px as fr,c4 as gr,cG as hr,py as Sr,aJ as ct,eF as Ar,pz as xr,kS as Cr,jf as D,i$ as br,pA as yr,d8 as Pr,bW as Ln,h3 as kr,pB as Mr,pC as jr,pD as Tr,ft as lt,gl as Rr,pE as vr,pF as _r,eV as wr,m1 as Er,j as Br,U as Fr,c1 as Dr,d3 as Ir,pG as Lr,pH as Hr,pI as Nr,pJ as Ur,D as Or,s as zr,N as Gr,cn as so,fu as Wr,pK as Vr,i_ as Kr,c8 as Yr,i8 as $r,cp as qr,g4 as Qr,aZ as to,gI as Jr,pL as Xr,d6 as Zr,d7 as ei,cT as si,pM as ti,o as ni,nH as oi,m6 as ai,pN as ri,dN as ii,f2 as ci,pO as li,jA as ui,pP as di,lx as mi}from"./cim4usely8ixso70.js";import{j7 as pi,j8 as fi,j9 as ot,B as no,n as oo,o as ao,ja as gi,gJ as X,gK as Le,jb as m,jc as hi,jd as Si,fh as Ai,je as xi,jf as Ci,jg as bi,jh as yi,ji as Pi,jj as ki,jk as Mi,jl as ji,jm as Ti,jn as Ri,jo as vi,jp as _i,jq as wi,jr as Ei,js as Bi,jt as Fi,ju as Di,jv as ro,jw as Ii,jx as Li,jy as Hi,jz as Ni,jA as Ui,jB as Oi,jC as zi,jD as Gi,fo as Wi,jE as Vi,jF as Ki,jG as Yi,jH as $i,jI as qi,jJ as Qi,jK as Ji,jL as Xi,jM as Zi,jN as ec,jO as sc,jP as tc,jQ as nc,jR as oc,jS as ac,jT as rc,jU as ic,jV as cc,jW as lc,jX as io,jY as uc,jZ as dc,j_ as mc,b5 as pc,j$ as co,h as fc,k0 as gc,k1 as hc,dZ as Hn,k2 as Sc,k3 as Ac,c_ as xc,d0 as Cc,k4 as bc,k5 as yc,k6 as Pc,k7 as kc,k8 as Mc,k9 as jc,ka as Tc,kb as Rc,kc as vc,kd as _c,ke as wc,kf as Ec,kg as Bc,kh as Fc,ki as Dc,h7 as Ic,kj as Lc,d9 as Ve,kk as Hc,kl as Nc,km as Uc,kn as Oc,ko as zc,kp as Gc,kq as Wc,av as Vc,kr as Kc,ks as Yc,kt as at,bT as $c,ku as qc,kv as Qc,kw as Jc,kx as Xc,ky as Zc,kz as rt,kA as Nn,kB as el,kC as sl,kD as tl,bS as nl,kE as ol,kF as Un,kG as al,f0 as On,aZ as rl,kH as il,kI as cl,iP as ll,kJ as ul,kK as dl,kL as ml,kM as pl,db as fl,kN as zn,kO as Gn,kP as Wn,kQ as gl,kR as hl,kS as Vn,f6 as Sl,f3 as Al,kT as xl,f4 as Cl,f5 as bl,kU as yl,kV as Pl,kW as kl,kX as Ml,kY as jl,kZ as Tl,dj as Rl,k_ as vl,k$ as _l,l0 as wl,l1 as El,ie as Bl,dp as Fl,l2 as Dl,dc as Il,x as Ll,l3 as Hl,l4 as Nl,l5 as Ul,fR as ut,fQ as dt,l6 as Ol,y as zl,l7 as Gl,h5 as Wl,l8 as Vl,l9 as Kl}from"./ivbsxyeeopn30y8l.js";import{P as Yl,u as $l}from"./dl6wm3f4iy2ldybm.js";import{u as ql}from"./ib76cquqlyjrlt71.js";import{getTabScreenshot as Ql}from"./g86fwc5245pbdtof.js";import{u as Jl}from"./kgkkjgk15rr7n5rs.js";import{P as Xl,u as Zl,h as eu}from"./dtltw5so60m9d99q.js";const bs="month",lo="year";function su(){const t=ha(),o=He(),l=ys(),{markAsViewed:u}=$e(pi),{initialBillingDetails:r}=ql(t,!0),f=c.useMemo(()=>({...t?.subscriptionAnalyticsParams,referrer:document.referrer}),[t]);async function g(){try{await gi(r,f)}catch{}}const{shouldShowBanner:n,discountValue:i,discountDuration:p}=fi();if(c.useEffect(()=>{n&&i&&p&&ot.logShowReferrerRedemptionBanner()},[n,i,p]),!n||!i||!p)return null;const y=tu(l,r,i,p),b=nu(l,r,i,p),M=e.jsxs("div",{className:"grow",children:[e.jsx("div",{className:"mb-0.5 font-semibold",children:y}),e.jsx("span",{className:"text-token-text-secondary",children:b})]});return e.jsx(no,{onPrimaryCtaClick:()=>{u(),ot.logClickReferrerRedeemButton(),g()},primaryCtaText:e.jsx(W,{...Sa(o)}),onDismiss:()=>{u(),ot.logCloseReferrerRedemptionBanner()},content:M})}function tu(t,o,l,u){const{currencySymbol:r}=oo(ao(),o.currency),f=u?u.period:bs,g=u?u.num_periods:1,n=r.code.defaultMessage?.toString()??Kn,i=t.formatNumber(l.value,{style:"currency",currency:n,minimumFractionDigits:0,maximumFractionDigits:2});let p;return f===bs?p=g===1?e.jsx(W,{id:"referrerRedemptionBannerTitleForSingleMonth",defaultMessage:"Your {discount} credit is ready",values:{discount:i}}):e.jsx(W,{id:"referrerRedemptionBannerTitleForPluralMonths",defaultMessage:"Redeem your {discount} referral reward",values:{discount:i}}):f===lo&&(p=g===1?e.jsx(W,{id:"referrerRedemptionBannerTitleForSingleYear",defaultMessage:"Redeem your {discount} referral reward",values:{discount:i}}):e.jsx(W,{id:"referrerRedemptionBannerTitleForPluralYears",defaultMessage:"Redeem your {discount} referral reward",values:{discount:i}})),p}function nu(t,o,l,u){const{currencySymbol:r}=oo(ao(),o.currency),f=u?u.period:bs,g=u?u.num_periods:1,n=r.code.defaultMessage?.toString()??Kn,i=t.formatNumber(l.value,{style:"currency",currency:n,minimumFractionDigits:0,maximumFractionDigits:2});let p;return f===bs?p=g===1?e.jsx(W,{id:"referrerRedemptionBannerContentForSingleMonth",defaultMessage:"Your referral link was used — claim your free month of Plus."}):e.jsx(W,{id:"referrerRedemptionBannerContentForPluralMonths",defaultMessage:"Your referral link earned you {discount} off {num_months} months of Plus.",values:{discount:i,num_months:g}}):f===lo&&(p=g===1?e.jsx(W,{id:"referrerRedemptionBannerContentForSingleYear",defaultMessage:"Your referral link earned you {discount} off a year of Plus.",values:{discount:i}}):e.jsx(W,{id:"referrerRedemptionBannerContentForPluralYears",defaultMessage:"Your referral link earned you {discount} off {num_years} years of Plus.",values:{discount:i,num_years:g}})),p}const ou=Ms(()=>js(()=>import("./lpzg5cch4pha0ne4.js"),__vite__mapDeps([0,1,2,3,4,5,6])).then(t=>t.JawboneNotificationsBanner)),uo=c.memo(function({className:o}){const{store:l}=X(),u=l.useIsHeaderContentAreaPopulated(),f=l.useContentAreaId(Le.HeaderTop)===m.AgentModeAnnouncementBanner?"z-0":hi.PromptTextareaHeader;return e.jsx("div",{className:Ie(o??"absolute start-0 end-0 bottom-full",f),children:e.jsx(Si,{shouldRender:u,contentArea:Le.Header,children:e.jsxs("div",{className:"mb-2 flex flex-col gap-3.5 pt-2",children:[e.jsx(au,{}),e.jsx(ru,{})]})})})});function au(){const{store:t}=X(),o=t.useSharedProps(p=>p?.clientThreadId),l=t.useContentAreaId(Le.HeaderTop),u=Ai(),r=je(o,p=>p?.modelId),f=xi.useStore(),g=Aa(),n=Ps(ks);let i;switch(l){case m.ProjectConversationTaskNoFileAccess:i=e.jsx(uu,{});break;case m.AdvancedVoiceOnMobileAnnouncement:i=e.jsx(Di,{clientThreadId:o});break;case m.S09KM1:i=null;break;case m.BannerSignup:i=e.jsx(lu,{});break;case m.BannerTermsDisclaimer:i=e.jsx(du,{});break;case m.PromptTextareaAction:i=e.jsx(mu,{});break;case m.BannersRateLimit:i=e.jsx(pu,{});break;case m.BannersBeaconUI:i=e.jsx(fu,{});break;case m.BannerSidekickAnnouncement:i=e.jsx(Fi,{});break;case m.SearchBrowserExtensionAnnouncement:i=e.jsx(Bi,{});break;case m.MoonshineAnnouncement:i=e.jsx(Ei,{});break;case m.SearchBrowserExtensionReactiveAnnouncement:i=e.jsx(wi,{});break;case m.BannerMemoryFull:i=e.jsx(_i,{});break;case m.Box:i=e.jsxs("div",{id:"Box",className:"flex h-20 w-full items-center justify-center gap-2 bg-red-500 p-2",children:["box",e.jsxs("div",{className:"flex h-full w-full items-center justify-center gap-2 bg-blue-500 p-2",children:["inner",e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-yellow-400 text-center",children:"actual content"})]})]});break;case m.JawboneAnnouncement:u?i=e.jsx(ou,{}):i=null;break;case m.JawboneMaxActiveAnnouncement:u?i=e.jsx(vi,{}):i=null;break;case m.PromoRedemptionAnnouncement:i=e.jsx(Yl,{});break;case m.OperatorAnnouncement:i=e.jsx(Ri,{});break;case m.BannerPlusUpsell:i=e.jsx(Ti,{});break;case m.ReferrerRedemptionAvailableAnnouncement:i=e.jsx(su,{});break;case m.RefereeRedemptionAvailableAnnouncement:i=e.jsx(ji,{});break;case m.ReferralProgramUpsellAnnouncement:i=e.jsx(Mi,{});break;case m.TatertotIntakeFormAnnouncement:i=!1;break;case m.StudentsUpsellAnnouncement:i=e.jsx(ki,{});break;case m.ModelDeprecationBanner:i=Pi(r);break;case m.TeamsContextualAnswersUpsell:i=e.jsx(yi,{});break;case m.KanziConfig:i=!1;break;case m.AgentModeAnnouncementBanner:i=g&&!n&&e.jsx(bi,{});break;case m.LanguageUpsellBanner:i=e.jsx(Ci,{onDismissSideEffect:()=>{pe.logEventWithStatsig("Language Upsell Banner Dismissed","chatgpt_web_language_upsell_banner_dismissed"),f.closeBanner()},onPrimaryCtaClickSideEffect:()=>{pe.logEventWithStatsig("Language Upsell Banner Primary CTA Clicked","chatgpt_web_language_upsell_banner_primary_cta_clicked"),f.closeBanner()}});break;default:i=null;break}return i}function ru(){const{store:t}=X(),o=t.useContentAreaId(Le.HeaderBottom);let l;switch(o){case ro.DallePromptControls:l=e.jsx(cu,{});break;default:l=null;break}return l}const iu=Ms(()=>js(()=>import("./dv7cqw89v242idd1.js"),__vite__mapDeps([7,1,3,4,2,5])).then(t=>t.default));function cu(){const{store:t}=X(),o=t.useSharedProps(l=>l?.composerController);return o?e.jsx(iu,{composerController:o}):null}function lu(){const{store:t}=X(),o=t.useSharedProps(r=>r?.clientThreadId),l=xa(),u=Ii();return o?l?e.jsx(Li,{threadId:o,showSignUp:u}):e.jsx(Hi,{threadId:o,showLogin:u}):null}function uu(){return c.useEffect(()=>()=>{st.getItem(tt.TasksHasSeenProjectDisclaimerBanner)||st.setItem(tt.TasksHasSeenProjectDisclaimerBanner,!0)},[]),e.jsx(no,{icon:e.jsx(Ca,{}),title:e.jsx(W,{id:"ibX3g7",defaultMessage:"Tasks can’t access project files"}),content:e.jsx(W,{id:"fm94Tm",defaultMessage:"There’s a task in this conversation — just FYI, it won’t be able to access project files."}),onDismiss:()=>{st.setItem(tt.TasksHasSeenProjectDisclaimerBanner,!0)}})}function du(){const{store:t}=X(),o=t.useSharedProps(l=>l?.clientThreadId);return o?e.jsx(Ni,{threadId:o}):null}function mu(){const{store:t}=X(),o=t.useSharedProps();return o?e.jsx(Ui,{...o}):null}function pu(){const{store:t}=X(),o=t.useSharedProps(u=>u?.clientThreadId),l=t.useSharedProps(u=>u?.composerController);return!o||!l?null:e.jsx(Oi,{clientThreadId:o,composerController:l})}function fu(){const{store:t}=X(),o=t.useSharedProps(u=>u?.clientThreadId),l=t.useSharedProps(u=>u?.composerController);return!o||!l?null:e.jsx(zi,{clientThreadId:o})}const gu=5,hu=c.memo(function(o){return Su(o),Au(o),Gi({clientThreadId:o.clientThreadId}),xu(),null});function Su(t){const{store:o}=X(),l=o.useSetSharedProps();it(()=>{l(t)},[t,l])}function Au(t){const{clientThreadId:o,canContinue:l}=t,{store:u}=X(),r=c.useRef({top:u.useContentAreaApi(Le.HeaderTop),bottom:u.useContentAreaApi(Le.HeaderBottom)}).current,f=Wi(o),{shouldShowBannerSignup:g,shouldShowBannerTermsDisclaimer:n}=Cu(o),i=Vi(o,t.composerController),p=Ki(o),y=Yi(t);$i(t);const b=qi(),M=Qi(t),v=Ji(o),Z=Xi(t),te=Zi(o),ne=ec(o),oe=$l(),{eligible:ee}=$e(sc),V=tc(),_=nc(),w=oc(),h=ac(),ce=rc(o),P=ic(o),H=cc(),K=lc(o),a=je(o,N=>N?.modelId),I=Yn(o),ae=mt(),fe=io(),{eligible:be}=$e(pt.hasSeenAgentModeAnnouncementBanner),ge=be&&fe&&ae!==Cs;it(()=>{a&&I?.kind===Ye.GizmoInteraction&&I.gizmo&&ba(a,I.gizmo)?r.top.set(m.ProjectConversationTaskNoFileAccess):Z.eligible?r.top.set(m.AdvancedVoiceOnMobileAnnouncement):n?r.top.set(m.BannerTermsDisclaimer):i?r.top.set(m.BannersRateLimit):p?r.top.set(m.BannersBeaconUI):H?r.top.set(m.BannerPlusUpsell):te?r.top.set(m.JawboneAnnouncement):ne?r.top.set(m.JawboneMaxActiveAnnouncement):y.eligible?r.top.set(m.BannerSidekickAnnouncement):b?r.top.set(m.MoonshineAnnouncement):M?r.top.set(m.SearchBrowserExtensionReactiveAnnouncement):oe?r.top.set(m.PromoRedemptionAnnouncement):ee?r.top.set(m.OperatorAnnouncement):w?r.top.set(m.ReferralProgramUpsellAnnouncement):l?r.top.set(m.PromptTextareaAction):g?r.top.set(m.BannerSignup):v?r.top.set(m.BannerMemoryFull):V?r.top.set(m.ReferrerRedemptionAvailableAnnouncement):_?r.top.set(m.RefereeRedemptionAvailableAnnouncement):h?r.top.set(m.StudentsUpsellAnnouncement):ce?r.top.set(m.ModelDeprecationBanner):P?r.top.set(m.TeamsContextualAnswersUpsell):K?r.top.set(m.LanguageUpsellBanner):ge?r.top.set(m.AgentModeAnnouncementBanner):r.top.set(null)},[r,ae,l,n,g,i,y,v,Z,ge]),it(()=>{f&&r.bottom.set(ro.DallePromptControls)},[r,f])}function xu(){const{store:t}=X();c.useEffect(()=>()=>{t.reset()},[t])}function Cu(t){const o=He(),{isUnauthenticated:l}=$n(),u=xs(o,"3637408529",{disableExposureLog:!0}),f=xs(o,"3637408529").get("no_auth_banner_signup_rate_limit",gu),g=u.get("should_show_no_auth_signup_banner",!0),n=uc(M=>M.bannerDisclaimerClientThreadId),i=dc(),p={shouldShowBannerTermsDisclaimer:!1,shouldShowBannerSignup:!1},[y,b]=je(t,M=>[G.getConversationTurns(M).filter(v=>v.role===qn.User).length,bu(G.getCurrentNode(M)?.message)]);return t&&(p.shouldShowBannerTermsDisclaimer=b&&l&&y===1&&!i&&(n==null||n===t),p.shouldShowBannerSignup=g&&b&&l&&y>0&&y%f===0),p}function bu(t){return t?.author.role===qn.Assistant&&ya(t)}function yu({modelSupportedImageMimeTypes:t}){const o=Ps(ks),l=Qn(),u=ft(),r=ys();return o?e.jsx(Ae.Item,{icon:mc,onClick:async()=>{const f=await Ql();if(f)try{const g=atob(f.base64image),n=g.length,i=new Uint8Array(n);for(let y=0;y<n;y++)i[y]=g.charCodeAt(y);const p=new File([i],f.filename,{type:f.mimetype});pc.uploadFile(l,p,t,r,u,void 0,void 0,Ke.Multimodal)}catch{}},children:e.jsx(W,{id:"HiFPUD",defaultMessage:"Attach screenshot"})},"attach_screenshot"):null}function Pu({clientThreadId:t,modelSupportedImageMimeTypes:o,openFileDialog:l,historyDisabled:u,isDisabled:r,highlightTooltip:f,disabledReason:g,currentModelName:n,isLoadingConnectors:i,connectorConfig:p,onSelectConnector:y,onConnectorOauthRedirect:b,showLabel:M,showUpsell:v,hideBorder:Z,isSmall:te,showMenuForNoAuth:ne,visualTreatment:oe}){const ee=Pa(),{gdriveStatus:V,o365Status:_}=ka(),{isUnauthenticated:w}=$n(),h=u?"text-white":f?"text-brand-blue-800":"",ce=!v&&(V!=="false"||_!=="false"||ee),P=w?co:fc,H=e.jsx(P,{"aria-label":"",className:Ie("icon",h)}),K=o.length>0,a=ce?e.jsx(hc,{clientThreadId:t,icon:H,showLabel:w&&M,modelSupportedImageMimeTypes:o,isLoadingConnectors:i,connectorConfig:p,onSelectConnector:y,onConnectorOauthRedirect:b,openFileDialog:l,isDisabled:r,highlightTooltip:f,disabledReason:g,currentModelName:n}):e.jsx(Xl,{isSmall:te,hideBorder:Z,clientThreadId:t,openFileDialog:l,showLabel:M,showUpsell:v,icon:H,isDisabled:r,highlightTooltip:f,disabledReason:g,currentModelName:n,visualTreatment:oe,showMenuForNoAuth:ne,modelSupportsImages:K});return e.jsx(gc,{showBackground:f,className:"bg-brand-blue-800/20",children:a})}const ku=Ms(()=>js(()=>import("./pfkjjarjk6ymzx5d.js"),__vite__mapDeps([8,1,3,4,2,5,9])).then(t=>t.GithubOnboardingModal)),Mu=Ms(()=>js(()=>import("./i3kdjp3gzwosm8nc.js"),__vite__mapDeps([10,1,3,4,2,5])).then(t=>t.ImageGenComposer)),ju=()=>null,Tu=1,Ru=3e3,vu="manage-prompts";function _u({onCreateNewCompletion:t,onContinueGenerating:o,account:l,currentModelId:u,currentModelConfig:r,disableDraftPersistence:f=!1,areModelsLoading:g,clientThreadId:n,isNewThread:i,isCompletionInProgress:p,className:y,disabled:b=!1,disabledReason:M,canPause:v=!1,canContinue:Z=!1,isInteractableSharedThread:te,onAutocompleteSelect:ne,headerClassName:oe,hideHeader:ee,onlyAllowImageUploads:V,layoutMode:_,modelsData:w}){"use forget";Hn.markStart("PromptTextarea"),Hn.markRendered("PromptTextarea");const h=He(),ce=c.useRef(null),[P,H]=pa(),K=fa(),a=Ts();Sc(a),Ac();const I=Ma(),ae=l?.isTeam(),fe=l?.isEnterprisey(),be=l?.isBusiness(),ge=l?.isEdu(),N=Jn(h),L=ys(),U=ft(),O=Qn(),Rs=xc.useStore(),vs=!!(ae||fe||be||ge),[Te,qe,Qe,z,le,re,Re]=je(n,s=>[G.getCurrentLeafId(s),G.getRequestId(s),G.findNode(s,d=>!!d.message.metadata?.b1de6e2_s),G.getIsNewConversation(s),G.lastUserMessage(s)?.metadata?.system_hints?.includes(x.Agent),!!s?.interruptionInProgress&&!!G.getCurrentNode(s)?.message.metadata?.n7jupd_message,s?.startedWithMcp]),{gizmoEditorData:ue,mode:ve,getGizmoId:ye}=ja(),Ne=Ta(),he=Ra(),de=Cc(),me=va(n),Je=!!_a(),mo=bc.useIsEnabled(n),Xe=!!wa(),A=mt(),F=Ea(),po=io(),fo=$e(pt.hasSeenAgentModeAnnouncementBanner),ht=xe(h,"222095887"),{fullyCollapsedToolMenu:Ze,showSlashHint:go}=Rn(),St=Ba.useState(({locked:s})=>s),ho=Fa(),At=Da(),{connectionInstanceData:_s,isLoading:So}=Ia({skip:!ho}),{selectedSources:xt,selectedMCPSources:es,addSource:ws}=yc(n);c.useEffect(()=>{const s=P.get("add_source");s&&A&&(ws(s),P.delete("add_source"),H(P))},[A,ws,P,H]);const Ct=Pc(h);La({skip:!Ct,productSku:vn.PROMPT_TEXT_AREA});const{platformConnectors:Es}=Xn(Ct&&(es?.size??0)>0,vn.PROMPT_TEXT_AREA),{allAutoConnectors:Ao}=Ha({getDisabledAutoConnectors:!1});Na({platformConnectors:Es,enabled:Ao.length>0&&vs});const bt=c.useMemo(()=>Array.from(es??[]).map(s=>Es.get(s)).filter(s=>s!==void 0),[Es,es]),Bs=c.useRef(0),ss=c.useRef(!1);let C=Yn(n),ts=C&&"gizmo"in C?C.gizmo:void 0;const xo=Ua(),ns=ts?.gizmo.id??xo,yt=Oa(ns),Co=kc(),Pt=Mc(n),[Y,os]=c.useState(null);Y!==null&&(C={gizmo:Y,gizmo_id:Y.gizmo.id,kind:Ye.GizmoInteraction},ts=Y);const _e=_n(r,C,A),Ue=za(),bo=Ue!=null,kt=Ga(h).flags,as=kt?.includes(Wa.NoAuthEnableFileUploads),{systemHints:Mt}=Va(),yo=!xe(h,"3084799213"),jt=z||(le??!1)||yo,k=c.useMemo(()=>Mt?.filter(s=>jc({systemHint:s,modelConfig:r,conversationMode:C,isTemporaryChat:he}))?.filter(s=>s.systemHint!==x.Agent?!0:jt),[Mt,r,C,he,jt]),Po=k==null||k.length>0,$=c.useMemo(()=>(A&&k?.find(s=>s.systemHint===A))??null,[k,A]),Fs=c.useCallback(s=>{wn()&&s?.preventDefault(),F(null,{analyticsMetadata:{clientThreadId:n}})},[F,n]),Ds=Tc(u,$?.systemHint??null),ko=!b&&(_e!==Ke.None||g)&&(N||as),q=Ka(r,C),Is=Ya(r,C);let Q=En(s=>s.files);const[rs]=c.useState(()=>Rc());ve==="magic"?Q=Q.filter(s=>s.gizmoId!=null):Q=Q.filter(s=>s.gizmoId==null);const Mo=vc(),we=Q.length>0||Mo,Tt=En(Wr.hasUploadInProgress),Rt=_c(s=>s.selectedApps),jo=wc()&&Rt.length>0,To=Ec(n),Ls=a.useState(s=>$a({currentModelConfig:r,composerController:s})),vt=Ce(a.isEmpty$),_t=!vt,is=!Ls&&!Tt&&(_t||we),wt=(_e===Ke.Multimodal?qa:Qa)-Q.length,Et=wt<=0,Ro=$?.systemHint===x.Research,vo=xe(h,"3544641259"),{selectedRepos:Hs}=Bc(n),Bt=(Ro||Ds)&&vo&&xt?.size===0&&es?.size===0,Ft=Qe?.message.metadata?.async_task_id,Ns=Fc(s=>Ft?s.tasks[Ft]:null),Us=Ns?.status===Dc.RUNNING,Dt=Ja(hs(n)||n)?.value,_o=Dt===Bn.STREAMING,wo=Dt===Bn.REALTIME,cs=p&&v||_o||wo||Us,Ee=is&&!b&&!Xe&&(!cs||Pt)&&!Bt,[It,Eo]=c.useState(!1),{targetedContent:Lt,setTargetedContent:ls}=Ic(),J=Lt?.isFocusedViewContent&&!de?void 0:Lt;c.useEffect(()=>{!J||$s.composer.autofocusDisabled$()||requestAnimationFrame(()=>requestAnimationFrame(()=>a.focus()))},[J]);const{getUpsellLabelType:Bo,getUpsellShowsAttach:Fo}=Lc(),{isToolsInPlusMenu:Os,showConnectedApps:us,isSingleLine:Ht,hasAddFileSlashCommand:Nt,supportsCollapsedMoreMenu:Ut}=Rn(),Be=Po&&!St&&(C==null||C?.kind===Ye.PrimaryAssistant||C?.kind===Ye.GizmoInteraction&&yt),Do=Be&&N&&(!ae||!So)&&!Fn(A)&&!Os,ds=As(a.store,s=>s.controlsDisabled),Io=!1;c.useEffect(()=>{if(!I?.id)return;const s=Dn.getAndReset(I.id,me);s&&a.setText(s.inputText)},[I?.id,me,a]),c.useEffect(()=>{const s=P.get("prompt")??"";a.getCurrentText().length===0&&s.length>0&&a.setText(s)},[a,P]);const zs=c.useCallback(()=>{A!==x.Slurm&&A!=null&&!k?.some(s=>s.systemHint===x.Slurm)||($==null&&F(x.Slurm),Me(n,s=>{const d=s.selectedSources?.get(x.Slurm)??new Set;s.selectedSources??=new Map,s.selectedSources.set(x.Slurm,new Set([...d,Za.GITHUB_CONNECTOR]))}))},[A,$,n,F,k]);c.useEffect(()=>{if(P.has("github_onboarding")){const s=P.get("github_onboarding");let d=Ve.ConfigureRepos;s&&[Ve.ConfigureRepos,Ve.SyncRepos,Ve.IndexRepos].includes(s)&&(d=s),At&&d!==Ve.ConfigureRepos?zs():Zn(h,ku,{initialState:d,onFinishFlow:zs}),H(S=>(S.delete("github_onboarding"),S))}},[P,H,h,A,$,n,F,k,zs,At]),c.useEffect(()=>{const s=er(P),d=A??s[0],S=d===x.Slurm,T=d===x.Research;if(!S&&!T)return;const E=P.getAll("sources");if(!E.length)return;const B=P.get("redirect_source"),R=E.map(ie=>ie.trim()).filter(In),j=new Set(R.filter(ie=>!Ss(ie))),ma=new Set(R.filter(Ss));Me(n,ie=>{ie.selectedSources=new Map([[d,j]]),ie.selectedMCPSources=new Map([[d,ma]]),ie.hasModifiedSources=!0}),H(ie=>(ie.delete("sources"),ie)),B==="suggested_ca_prompts"&&pe.logEventWithStatsig("chatgpt_contextual_answers_connector_activated","chatgpt_contextual_answers_connector_activated",{source:"suggested_ca_prompts"})},[n,ws,P,F,H,A]),c.useEffect(()=>{It!==Ee&&(Eo(Ee),Ee&&sr(!0).then(s=>{tr.startEnforcement(s),nr.startEnforcement(s)}))},[Ee,It,C?.kind,Ne]);const ms=or(r,C),{handleFileAccepted:Ot}=Zl(L,_n(r,C,A),q,"mouse",ye,ms?.attachments),Lo=c.useCallback((s,d)=>(requestAnimationFrame(()=>{requestAnimationFrame(()=>{a.focus()})}),Ot(s,d)),[a,Ot]),se=!b&&!Et&&ko&&Ue==null,{getInputProps:zt,open:Gt,inputRef:Wt}=Jl({disabled:!se,noClick:!0,onDropAccepted:Lo,onDropRejected:s=>eu(s,L,U,_e),multiple:!0,maxSize:rr,maxFiles:wt,...ar(!N||V?q:Is)}),Pe=c.useCallback(()=>{se&&(pe.logEventWithStatsig("Open File Viewer","chatgpt_web_file_viewer_opened",{intent:_e.toString()}),Gt())},[se,Gt,_e]),Vt=As(rs),Kt=c.useCallback(()=>{a.eraseContent(),Vt.clearMessages(),a.resize(Tu),a.usedDictation=!1,a.dictationEdited=!1,a.dictationAssetPointer=null,a.dictationAssetTTL=null;for(const d of Q)nt.remove(O,d.tempId,"none");if(Hc.markAllAsSent(),gt(h)){const d=ir(h,"269676899"),S=d.get("skip_search",!1);if(d.get("clear_all",!1)){const E=[x.Slurm,x.Tatertot,x.Think];S&&E.push(x.Search),E.push(Cs),A&&!E.includes(A)&&F(null)}}},[a,Vt,h,Q,O,A,F]),[Yt,Gs]=Ps(s=>[cr(s),ks(s)]),Ho=c.useMemo(()=>{if(Gs)return eo;if(Yt)return lr;if(ur())return dr},[Gs,Yt]),No=Ce(De.sidebarUrlTrayOpen$),Uo=Ce(De.sidebarUrlTrayForcedOpen$),$t=Ce(De.context$),Oo=$t?.blocked===!0,qt=Gs&&No&&(!Oo||Uo),zo=mr(),Qt=(s,d)=>{if(s.preventDefault(),b||!is&&!d||!C||re)return;const S=a.getContentToSend(),T=Vr(S.content),{content:E,attachments:B}=Tl(O,T,r,C,A);Me(n,R=>{R.hasModifiedSources=!1,R.hasModifiedGithubRepos=!1,R.startedWithMcp===void 0&&(R.startedWithMcp=bt.length>0)}),Co(),t({sourceEvent:s,attachments:B,content:E,contentToSend:S,conversationMode:C,hasSelectedApps:jo,isMessageFollowupsEnabled:mo,selectedApps:Rt,desktopOrigin:Ho,shouldCollectSidebarContext:qt,desktopSidebarContext:$t,selectedGizmoTag:Y,selectedRepos:{selectedAllRepos:Hs.selectedAllRepos,selectedRepos:Hs.selectedRepos?[...Hs.selectedRepos]:null},selectedSources:xt,selectedMCPConnectors:bt,startedWithMcp:Re===!0,systemHints:A?[A]:[],usedDictation:a.usedDictation,dictationEdited:a.dictationEdited,dictationAssetPointer:a.dictationAssetPointer,dictationAssetTTL:a.dictationAssetTTL,isN7jupdActive:Ds,isForceAllowCustomMcpModeEnabled:zo}),J?.onCreateCompletion?.({serverThreadId:me,currentLeafId:Te}),J?.shouldPersistAcrossMessages!==!0&&ls(void 0),Ln.hideThreadHeader();for(const R of Q)R.status===Kr.Ready&&Rs.addFile(R);Kt(),po&&A===Cs&&fo.markAsViewed()},Go=s=>{ls(s.targetedReply),s.targetedReply&&pe.logEventWithStatsig("Targeted Reply Button Clicked","chatgpt_targeted_reply_button_clicked",{conversationId:me,sourceMessageId:s.messageId})},{maybeSetWaitingForRealtimeOnAbort:Jt,isWatingForRealtimeStatusChange:Wo}=Nc(n),Ws=c.useCallback(s=>{Jt(),pr(s,void 0,!0)},[Jt]),Xt=c.useCallback(()=>{J?.onCleared?.({serverThreadId:me,currentLeafId:Te}),ls(void 0),a.focus()},[Te,me,J,ls,a]),Oe=fr(r?.tags,C?.kind),{isFocused:Vo,autocompletions:Se}=As(a.store),ze=Vo&&Se.length>0;c.useEffect(()=>a.subscribe("input",()=>{Uc(n)&&Oc(n)}),[a,n]);const Ko=a.isReady(),Yo=gr(),Vs=hr(w)?.id??null,Zt={Enter:Gc({toaster:U,isAutocompletionActive:()=>ze&&ss.current,canSubmit:Ee,isTextContentTooLong:Ls,requestCompletion:Qt}),Escape:zc({canAbortCompletion:v&&p,clientThreadId:n,isAutocompletionActive:()=>ze&&ss.current,clearAutocompletions:()=>a.setAutocompletions([]),abortCompletion:()=>Ws(n),isEmpty:vt,hasTargetedContent:J!=null,clearTargetedContent:Xt,hasSystemHint:$!=null,removeSystemHint:Fs,hasSelectedTarget:Y!=null,removeSelectedTarget:()=>os(null),hasNonDefaultModel:u!==Vs&&ht,removeNonDefaultModel:()=>{Yo({modelId:Vs??"",location:"Escape key with non-default model"}),Yr(Vs??"")}})},Ks=c.useRef(Zt);Ks.current=Zt,c.useEffect(()=>{const s=Object.fromEntries(Object.keys(Ks.current).map(d=>[d,T=>{const E=Ks.current[d];return E?E(T):!1}]));a.registerKeyHandlers(s),a.registerFileInput({openFileDialog:Pe,inputRef:Wt})},[a,Pe,Wt,Ko]),c.useEffect(()=>a.subscribe("paste",s=>{Wc({filePickerStore:O,event:s,intl:L,toaster:U,clientThreadId:n,conversationMode:C,currentModelConfig:r,getEditorGizmoId:ye,modelSupportedImageMimeTypes:q,activeSystemHintType:A,setActiveSystemHintType:F,ctx:h})}),[L,n,C,r,ye,q,a,U,O,A,F,h]);const en=c.useCallback(s=>{if(a.trimLeadingText("@"),s===vu){K("/library?tab=prompts");return}if(Me(n,d=>{d.isUsingPromptTemplate=!0}),pe.logEventWithStatsig("chatgpt_web_prompt_used","chatgpt_web_prompt_used",{referer:"at_cmd",hint:s.system_hint??"none",sources:(s.sources??[]).join(",")}),a.appendText(s.prompt),s.system_hint&&(F(s.system_hint),s.sources?.length)){const d=s.sources.map(B=>B.trim()).filter(In),S=s.system_hint,T=new Set(d.filter(B=>!Ss(B))),E=new Set(d.filter(Ss));Me(n,B=>{B.selectedSources=new Map([[S,T]]),B.selectedMCPSources=new Map([[S,E]]),B.hasModifiedSources=!0})}},[a,K,F,n]),$o=Sr(n,rs,q,ms?.attachments),qo=c.useCallback(s=>{s.preventDefault(),Ws(n),pe.logEventWithStatsig("Pause Completion","chatgpt_pause_completion",{threadId:hs(n),currentLeafId:G.getCurrentNode(ct(n)).message.id,eventSource:"mouse"}),Ar()},[n,Ws]),Ys=c.useCallback(()=>{Dn.set(I?.id,me,a.getCurrentText())},[me,I?.id,a]),$s=Xa(h);c.useEffect(()=>{ue||$s.composer.autofocusDisabled$()||a.focus()},[a]),c.useEffect(()=>{if(q.length>0)for(const d of Q)xr(d.fileSpec?.mimeType,Is)||nt.remove(O,d.tempId,"none");else nt.reset(O)},[u,O]),c.useEffect(()=>{(!Oe&&Y||Je)&&os(null)},[Oe,Y,Je]);const Qo=xs(h,"4031588851"),sn=xs(h,"3637408529"),Jo=sn.get("is_in_composer_text_exp",!1),Xo=sn.get("composer_text","MESSAGE_CHATGPT"),Zo=Qo.get("composer_text","MESSAGE_CHATGPT"),ea=Jo?Xo:Zo,[ps,sa]=(()=>{const s=M?Cr(M):void 0;if(s)return[s.placeholder,s.isLastingDisabledStyle];if(te)return[D.placeholderWithName,!1];if(J?.placeholderTextOverride!=null)return[J.placeholderTextOverride,!1];if(r?.id===br)return[D.n7jupdSystemHintPlaceholder,!1];if($){if(Fn($.systemHint))return cs?[D.n7jupdActivePlaceholder,!1]:[D.n7jupdSystemHintPlaceholder,!1];switch($.systemHint){case x.Search:return[D.searchPlaceholder,!1];case x.Think:return[D.thinkPlaceholder,!1];case x.Slurm:return[D.connectorPlaceholder,!1];case x.Research:return[D.researchPlaceholder,!1];case x.Canvas:return[D.canvasPlaceholder,!1];case x.Picture:return[D.picturePlaceholder,!1];case x.PictureV2:return[D.pictureV2Placeholder,!1];case x.ContextualAnswers:return[D.contextualAnswersPlaceholder,!1];case x.Tatertot:return[D.tatertotPlaceholder,!1]}}switch(ea){case"BLANK":return[null,!1];case"ASK_ANYTHING":return[D.placeholderAskAnythingVariant,!1];case"ASK_CHATGPT_ANYTHING":return[D.placeholderAskNameAnythingVariant,!1];default:return[D.placeholderWithName,!1]}})(),tn=yt?i?L.formatMessage(Vc.newChatInProject,{projectName:ts?.gizmo.display.name??"this project"}):ps?L.formatMessage(ps,{name:"ChatGPT"}):"​":ps?L.formatMessage(ps,{name:ue!=null?ve==="magic"?yr:ue.name||"GPT":ts?.gizmo.display.name??"ChatGPT"}):"​";c.useEffect(()=>a.subscribe("input",()=>{Pr.getState().isThreadHeaderVisible&&Ln.hideThreadHeader()}),[a]),c.useEffect(()=>a.subscribe("input",()=>{Bs.current=performance.now()}),[a]);const qs=kr()&&!!Se.find(s=>!!s.requires_file_upload),{connectorConfig:ke,isLoading:nn}=Mr(),{onSelectConnector:fs,onConnectorOauthRedirect:Qs}=Kc({connectorConfig:ke,modelSupportedImageMimeTypes:q,modelAcceptedMimeTypes:Is,attachmentsProductFeature:ms?.attachments,onOauthRedirect:Ys});Yc(ke,fs);let on=null;const gs=[],an=[],rn=Fo(),ta=N||rn||as,Js=_e===Ke.None&&!g?at.ModelNotSupported:Et?at.HasReachedMaxFiles:Ue!=null?at.RateLimitReached:void 0,na=jr("(width <= 510px)",Tr);_||(_=i&&!na?"center":"bottom");const cn=q.length>0;if(N&&Os){const s=[e.jsxs(Ae.Group,{children:[e.jsx($c,{openFileDialog:Pe,modelSupportsImages:cn,showMenuForNoAuth:!1,isDisabled:!se,disabledReason:Js,currentModelName:r?.title,rateLimitInfo:Ue}),se&&cn&&e.jsx(qc,{modelSupportedImageMimeTypes:q}),se&&(us?e.jsx(Qc,{includeAction:!0,shortName:!0,connectorConfig:ke,onConnectorClick:fs}):e.jsx(Jc,{isLoadingConnectors:nn,connectorConfig:ke,onConnectorClick:fs,onOauthRedirect:Qs})),e.jsx(Xc,{}),e.jsx(yu,{modelSupportedImageMimeTypes:q})]},"add-files")],d=4,S=Ut&&Be&&(us&&Zc(ke)||k&&k.length>d+1),T=us&&e.jsx(Ae.Group,{children:e.jsx(yl,{includeSeparator:!1,includeAction:!0,shortName:!0,connectorConfig:ke,onConnectorClick:Qs})},"connect-apps"),E=[],B=[];if(Be&&k)if(Ze)s.push(e.jsx(Ae.Separator,{},"tools-separator")),B.push(e.jsx(rt,{systemHints:k,selectedHintType:A,onSelectHintType:R=>{F(R,{analyticsMetadata:{clientThreadId:n}})}},"tools-items-system-hints")),us&&B.push(T);else{const R=k&&(S?k.slice(0,d):k);s.push(e.jsxs(Ae.Group,{children:[e.jsx(rt,{systemHints:R,selectedHintType:A,onSelectHintType:j=>{F(j,{analyticsMetadata:{clientThreadId:n}})}}),S&&e.jsxs(Nn,{layoutMode:_,children:[e.jsx(Ae.Group,{children:e.jsx(rt,{systemHints:k?.slice(d),selectedHintType:A,onSelectHintType:j=>{F(j,{analyticsMetadata:{clientThreadId:n}})}})}),T]},"plus-more-menu")]},"system-hints"))}Ze&&B.length>0?s.push(e.jsx(el,{layoutMode:_,items:B},"collapsed-tool-menu")):S&&E.length>0&&s.push(e.jsx(Nn,{layoutMode:_,children:E},"plus-more-menu")),ht&&(Ze||s.push(e.jsx(Ae.Separator,{},"models-divider")),s.push(e.jsx(sl,{selectedModelId:u},"models-menu"))),T&&!S&&!Ze&&s.push(T),go&&(s.push(e.jsx(Ae.Separator,{},"tools-separator")),s.push(e.jsx("div",{className:"text-token-text-tertiary p-2 text-center text-sm",children:L.formatMessage({id:"composer.plusMenu.typeSlashForQuickAccess",defaultMessage:"Type '/' for quick access"})}))),_==="bottom"&&!Ut&&s.reverse(),on=e.jsx(tl,{onCloseAutoFocus:R=>{$s.composer.autofocusDisabled$()||(R.preventDefault(),a.focus())},items:s,fileUploadRateLimited:bo,children:e.jsx(nl,{disabled:b,clientThreadId:n,rateLimitPopup:Os?null:Ue,highlightTooltip:qs&&!we,label:L.formatMessage({id:"composer.plusMenu.label",defaultMessage:"Add files and more"}),secondaryLabel:e.jsx("kbd",{className:"bg-token-bg-tertiary -me-1 inline-grid aspect-square w-4 items-center justify-center rounded-sm text-[11px]",children:e.jsx("span",{children:"/"})}),children:e.jsx(ol,{onDoubleClick:se?Pe:void 0,onPointerDown:R=>{if(!wn())return;const j=Un(h);j.isKeyboardOpen()&&(R.preventDefault(),j.closeKeyboard(()=>{al(h).open.set(!0)}))},disabled:ds})})})}else if(ta){const s=e.jsx("div",{"data-testid":"composer-action-file-upload",style:{viewTransitionName:"var(--vt-composer-attach-file-action)"},children:e.jsx(Pu,{clientThreadId:n,modelSupportedImageMimeTypes:q,openFileDialog:Pe,historyDisabled:he,highlightTooltip:qs&&!we,isLoadingConnectors:nn,connectorConfig:ke,onSelectConnector:fs,onConnectorOauthRedirect:Qs,showLabel:Bo()==="all",showUpsell:rn&&!as,showMenuForNoAuth:as,isDisabled:!se||ds,disabledReason:Js,currentModelName:r?.title??"",visualTreatment:N?"composer-btn":"legacy"})},"file-upload-button");gs.push(s),an.push(s)}N?Do&&gs.push(e.jsx(kl,{activeSystemHintType:A,systemHints:k,composerController:a,clientThreadId:n,disabled:ds})):gs.push(e.jsx(Pl,{account:l,clientBootstrapFlags:kt,features:Ne,currentModelConfig:r,isDisabled:!!ds,clientThreadId:n,composerController:a,gizmoId:ns}));const[oa,ln]=c.useState(!1),un=sa||Wo?"disabled":"default",aa=!Ee,dn=Ur({promptDisabledReason:M,hasPendingFiles:Tt,hasTextContent:_t,isTextContentTooLong:Ls,hasAsyncTaskPending:To,noSourceSelectedDr:!Bt,isDeepResearchTaskStreaming:Us,isThreadHardBlocked:Xe}),Ge=cs?"streaming":aa?"disabled":"idle",We=c.useRef(null),Fe=c.useRef(null),ra=xe(h,"222560275")||u&&!u.startsWith("o1")&&!u.startsWith("o3");c.useEffect(()=>{const s=()=>{We.current!=null&&Or.addAction("composer_state_disabled",{threadId:hs(n),disabledReason:We.current})};if(is&&Ge==="disabled"){let d="unknown";b?d=M??"component_disabled_unknown":p?d="completion_in_progress":Xe&&(d="thread_hard_blocked"),We.current!==d&&(Fe.current&&clearTimeout(Fe.current),Fe.current=setTimeout(s,Ru)),We.current=d}else We.current=null;return()=>{Fe.current&&(clearTimeout(Fe.current),Fe.current=null)}},[n,is,Ge,b,M,p,Xe]);const Xs=[];if(J?.label&&Xs.push({type:J.type,value:J.label,onRemoveRegion:Xt}),Y!==null){const s=!!Y.gizmo.tags?.includes(lt.FirstParty);Xs.push({type:"mention",value:Y.gizmo.display.name,icon:e.jsx(On,{isFirstParty:s,src:Y.gizmo.display.profile_picture_url,className:"icon"}),onRemoveRegion:()=>{os(null),a.focus()}})}c.useEffect(()=>{(!Se||Se.length===0||!ze)&&(ss.current=!1)},[Se,ze]);const ia=c.useCallback((s,d,S)=>{ss.current=s>=0,d&&a.setText(S?`${S.title}${S.body}`:"")},[a]),ca=Un(h),la=Ce(ca.supportsVirtualKeyboardApi),mn=ze&&Se&&Se.length>0&&$?.systemHint!==x.Research&&$?.systemHint!==x.Slurm&&!Ds&&!a.hasMultipleLines()&&a.canShowAutocompletion(),Zs=s=>{if(s.preventDefault(),s.stopPropagation(),Bs.current>0){const d=performance.now()-Bs.current;zr.hist(Gr.DEFAULT,"final_user_input_to_submit_ms",[],d)}Ge==="streaming"&&(!Pt||a.isEmpty())?Us?ln(!0):qo(s):Qt(s)};c.useEffect(()=>{const s=hs(n),d=l?.normalizedAccountUserId;if(!d||f)return;const S=Rr(()=>{const T=a.getContentToSend().content;T===""?vr(s):_r(s,T,d)},1e3);return a.subscribe("change",S)},[l,n,a,f,me]);const{connectedTypes:et}=wr(),pn=I&&Er(I),{data:fn}=Br(Fr.DeveloperMode),gn=c.useMemo(()=>{const s=[];se&&Nt&&s.push({command:"upload",aliases:["file","attach"],title:L.formatMessage({id:"composer.add.label",defaultMessage:"Add photos & files"}),icon:e.jsx(co,{"aria-label":"",className:"icon"}),onSelect:Pe});const d=_s?.connection_statuses.filter(S=>S.user_connection_details.activation_status==="activated"&&["google_drive_oauth","google_drive_dwd"].includes(S.user_connection_details.knowledge_connector_type)).map(S=>S.user_connection_details.connection_type)??[];return pn&&(et.size>0||d.length>0)&&s.push({command:"all-connectors",aliases:["find","connectors","use"],title:L.formatMessage({id:"6YT2cp",defaultMessage:"Use all connectors"}),icon:e.jsx(rl,{}),onSelect:()=>{F(x.Slurm,{analyticsMetadata:{clientThreadId:n}}),Me(n,S=>{const T=S.selectedSources?.get(x.Slurm)??new Set;S.selectedSources??=new Map,S.selectedSources.set(x.Slurm,new Set([...T,...et,...d]))})}}),fn&&s.push({command:"add-mcp",aliases:["mcp"],title:"Add MCP",icon:e.jsx(il,{}),onSelect:()=>{K(Dr(Ir.Connectors))}}),s},[se,fn,Nt,_s?.connection_statuses,pn,et,L,Pe,F,n,K]),hn=xe(h,"773249106"),{data:Sn,isLoading:An}={data:null,isLoading:!1},xn=c.useMemo(()=>[],[An,Io,Sn?.prompts,en]),Cn=c.useMemo(()=>Lr(()=>{if(!Oe)return[];const s=Hr(h),d=Nr(h),S=cl(h),{data:T}=s(),{data:E}=d(),{data:B}=S();return ll([...T?.items??[],...E?.list.items?.map(j=>j.resource)??[],...hn?B?.items?.map(j=>j.gizmo)??[]:[]],j=>j.gizmo.id).map(j=>({command:j.gizmo.display.name,title:j.gizmo.display.name,disabled:Je,icon:e.jsx(On,{simple:!0,isFirstParty:j.gizmo.tags?.includes(lt.FirstParty)===!0,src:j.gizmo.display.profile_picture_url,className:"icon",alt:""}),onSelect:()=>{pe.logEventWithStatsig("Composer GPT Selected","chatgpt_web_composer_gpt_selected",{gizmo:j.gizmo.id}),os(j)}}))}),[h,Je,Oe,hn]),bn=e.jsx(hu,{canUseInlineTagging:Oe,isDisabled:b,clientThreadId:n,currentLeafId:Te,currentRequestId:qe,canContinue:Z,composerController:a,isNewThread:i,onContinueGenerating:s=>o({event:s,conversationMode:ct(n)?.mode,systemHints:A?[A]:[]}),onResetState:Kt,conversationMode:C,isShowingAutocomplete:!!mn}),yn=!cs&&C!=null&&ra&&ul.includes(C.kind)&&e.jsx(dl,{clientThreadId:n,onTargetedReply:Go}),Pn=mn&&e.jsx("div",{className:Ie("absolute start-0 z-[-1] box-border w-full ps-0",_==="center"?"top-full":"bottom-full",la&&"keyboard-open:fixed keyboard-open:bottom-[calc(var(--screen-keyboard-height,0px)+var(--composer-height,100px)+12px)] keyboard-open:px-4"),children:e.jsx(ml,{suggestions:Se,composerController:a,onSelect:ne,onChange:ia})}),kn=e.jsx(Ml,{composerController:a,parsedDocumentHandler:$o}),Mn=!ee&&e.jsx(uo,{className:oe}),jn=e.jsx(pl,{modelSupportedImageMimeTypes:q,uploadType:Ke.Multimodal,attachmentsProductFeature:ms?.attachments}),{isImageGenEditor:ua}=fl(),Tn=xe(h,"3760395675"),da=xe(h,"3127600850");return ua?e.jsxs(zn.Provider,{value:rs,children:[e.jsx(Gn,{defaultOpen:Tn,children:e.jsxs("form",{id:"prompt",className:y,onSubmit:Zs,children:[e.jsxs("div",{className:"relative z-1 flex h-full max-w-full flex-1 flex-col",children:[e.jsx(Wn,{onOauthRedirect:Ys}),Mn,e.jsxs("div",{className:"group relative z-1 flex w-full items-center",children:[e.jsxs(Sl,{open:Be,children:[e.jsx(Al,{className:"w-full",children:e.jsx(Mu,{type:he?"temporary":"default",ref:ce,placeholder:tn,inputState:un,composerController:a,leftSideActions:an,state:Ge,onSubmit:Zs,renderFiles:we&&e.jsxs(e.Fragment,{children:[ve==="magic"&&e.jsx("div",{className:"bg-token-main-surface-secondary text-token-text-secondary m-2 mb-0 rounded-lg p-2 text-xs",children:e.jsx(W,{...D.gizmoKnowledgeWarning})}),e.jsx(xl,{files:Q,className:"-ms-1.5 flex flex-nowrap gap-2 overflow-x-auto p-1.5"})]}),clientThreadId:n,gizmoId:ns,disableReason:dn,modelId:u})}),e.jsx(Cl,{children:e.jsx(bl,{side:"bottom",align:"start",sideOffset:12,onOpenAutoFocus:s=>s.preventDefault(),children:Be&&k&&e.jsx(Vn,{gptsSlashCommands:Cn,libraryPromptSlashCommands:xn,slashCommands:gn,systemHints:k,composerController:a,clientThreadId:n,layoutMode:_,modelsData:w})})})]}),Pn]}),kn,jn]}),e.jsx("input",{...zt({className:"hidden"})})]})}),bn,yn]}):e.jsx(zn.Provider,{value:rs,children:e.jsxs(Gn,{defaultOpen:Tn,children:[e.jsxs("div",{className:"max-xs:[--force-hide-label:none] relative z-1 flex h-full max-w-full flex-1 flex-col",children:[e.jsx(Wn,{onOauthRedirect:Ys}),da&&e.jsx(ju,{}),Mn,Ns&&oa&&e.jsx(gl,{taskId:Ns.taskId,clientThreadId:n,onClose:()=>ln(!1)}),e.jsx(hl,{hasFiles:we,pendingFiles:Q,isUploadDisabled:!se,clientThreadId:n,highlightUploadTooltip:qs&&!we,disableReason:dn,uploadButtonDisabledReason:Js,currentModel:r,conversationMode:C,state:Ge,inputState:un,gizmoId:ns,includeSidebarContextTray:qt,isTemporaryChat:he,placeholder:tn,composerController:a,onSubmit:Zs,replyRegions:Xs,leadingAction:on,legacyFooterActions:gs,activeSystemHint:$,hideSystemHint:St,onRemoveSystemHint:Fs,contextualAnswerUserConnectionData:_s,fileInput:e.jsx("input",{...zt()}),expanded:Ht?void 0:!0,expandOnMultilineInput:Ht}),Be&&k&&e.jsx(Vn,{gptsSlashCommands:Cn,libraryPromptSlashCommands:xn,slashCommands:gn,systemHints:k,composerController:a,clientThreadId:n,layoutMode:_,modelsData:w}),!1,Pn]}),kn,bn,yn,jn,A&&k&&e.jsx(wu,{availableSystemHints:k,systemHintType:A,onRemoveSystemHint:Fs})]})})}const wu=({availableSystemHints:t,systemHintType:o,onRemoveSystemHint:l})=>{const u=t!=null&&t.every(p=>p.systemHint!==o),{externalModelsLoading:r,fullModelsLoading:f}=so(),{isBlocked:g}=jl(o),n=He(),i=!Jn(n);return c.useEffect(()=>{r||f||(u||g)&&!i&&l()},[u,g,i,l,o,r,f]),null},Wu=({clientThreadId:t,isNewThread:o,isGizmoThread:l,isProjectThread:u,isModelLoaded:r,currentModelId:f,onRequestCompletion:g,shouldUseUnifiedComposer:n,onlyAllowImageUploads:i})=>{const p=Ts(),{pageType:y}=Bl(),b=y?.type==="landing-page",M=Xr(y?.type),v=Fl(t).isOdysseyMode,Z=c.useContext(Zr),te=ei(Z),ne=si(),oe=ft(),ee=ys(),V=He(),_=gt(V);Dl(p);const w=Ps(ks),h=Ce(De.sidebarUrlTrayOpen$),ce=Ce(De.sidebarUrlTrayForcedOpen$),P=Ce(De.context$),H=P?.blocked===!0,K=w&&h&&(!H||ce),{platformConnectors:a}=Xn(),I=$e(pt.hasSeenOdysseyConnectorsModal),ae=mt(),fe=je(t,z=>G.getConversationTurns(z).some(le=>le.messages.some(re=>re.metadata?.n7jupd_message))),be=to(),ge=Il(),N=(be||ge)&&fe;ti(async()=>{if(K)return await di(P,eo)});const L=async z=>{if(ct(t)?.isLoading!==!1)return;const le=()=>{p.delete(0,p.getContentLength()),p.appendText(z.contentToSend.content),p.focus()},re=await zl(z),Re=re.completionMetadata?.systemHints?.includes(Cs),ue=Array.from(z.selectedSources??[]).filter(ye=>ye!=="web")[0];if(Re&&ue&&I.eligible){const ye=ii[ue]??ue,Ne=a.get(ye);if(Ne){let he=!1;Zn(V,Gl,{connector:Ne,onConfirm:()=>{I.markAsViewed(),he=!0,g(re)},onTurnOffConnectors:()=>{Me(t,de=>{de.selectedSources??=new Map,de.selectedSources.set(ae,new Set(["web"])),de.selectedMCPSources??=new Map,de.selectedMCPSources.set(ae,new Set),de.mentionedSources=new Set,ci({selectedSourcesMap:de.selectedSources,selectedMCPSourcesMap:de.selectedMCPSources,scope:{userId:_?.authUserId,workspaceId:_?.id}})})},onClose:()=>{he||le()}});return}}w&&li()?.triggerProductEvent("messageSent"),U(re.promptMessage?.metadata?.attachments??[])&&g(re)},U=c.useCallback(z=>{let le=oi;const re=z.reduce((ue,ve)=>ue+(ve.size??0),0);v&&(le=ni(V,"1504865540").get("max_file_size_mb",25));const Re=re<=le*1024*1024;return Re||oe.danger(ee.formatMessage({id:"odyssey.fileTooLarge",defaultMessage:"The attached files are too large. The maximum size is {maxFileSizeMB}MB."},{maxFileSizeMB:le})),Re},[V,ee,v,oe]),O=c.useCallback(z=>{pe.logEvent("Continue Completion"),g(Ll(z))},[g]),Rs=Hl.useState(z=>z.isReplayEnabled),vs=ai({clientThreadId:t}),Te=ri({clientThreadId:t});if(vs)return e.jsx(Nl,{safetyLimited:Te});const qe=e.jsxs(e.Fragment,{children:[e.jsx(Ul,{clientThreadId:t}),e.jsx(ut,{verticalMargin:"none",verticalPadding:te?"last-standard":"none",horizontalPadding:w?"none":"standard",children:e.jsx(dt,{children:Rs?e.jsx(Ol,{clientThreadId:t},t):N?null:e.jsx(Bu,{clientThreadId:t,currentModelId:f,isNewThread:o,hideHeader:o,onRequestCompletion:L,onContinueGenerating:O,onAutocompleteSelect:p.onAutocompleteSelect,onlyAllowImageUploads:i})})})]}),Qe=o&&e.jsx("div",{className:Ie("[display:var(--display-hidden-until-loaded,block)] md:absolute md:start-0 md:bottom-6 md:w-full"),children:e.jsx(ut,{verticalMargin:"none",verticalPadding:"none",horizontalPadding:"standard",children:e.jsx(dt,{children:e.jsx(uo,{className:"block flex-1"})})})});return n?e.jsxs(e.Fragment,{children:[!ne&&Qe,e.jsx("div",{id:"thread-bottom",children:qe}),ne&&Qe,o&&!b&&!l&&!M&&!v&&!u&&e.jsx(Eu,{clientThreadId:t,currentModelId:f,isModelLoaded:r})]}):qe},Eu=({clientThreadId:t,currentModelId:o,isModelLoaded:l})=>{const u=Ts(),{isFocused:r,autocompletions:f}=As(u.store),g=r&&f.length>0,n=ui(),i=Wl();return e.jsxs("div",{className:Ie(g&&"hidden"),children:[e.jsx(ut,{verticalMargin:"none",verticalPadding:"none",horizontalPadding:"standard",children:e.jsxs(dt,{children:[!1,e.jsx(Vl,{clientThreadId:t,currentModelId:o,isModelLoaded:l})]})}),i&&e.jsx("div",{className:Ie("mt-5 hidden",n?"@lg/thread:block":"lg:block"),children:e.jsx(Kl,{})})]})};function Bu({clientThreadId:t,currentModelId:o,disableDraftPersistence:l=!1,isNewThread:u,onRequestCompletion:r,onContinueGenerating:f,onAutocompleteSelect:g,headerClassName:n,hideHeader:i,onlyAllowImageUploads:p,layoutMode:y}){const{modelsData:b,externalModelsLoading:M}=so(),[v,Z,te,ne,oe]=je(t,U=>{const O=G.getCurrentNode(U);return[O.message.clientMetadata?.errType!=null&&O.message.clientMetadata.errType!=="info",mi(G.getCurrentNode(U).message),U?.mode,U?.continuingFromSharedConversationId!=null,!!U?.continuingFromSharedPostId]}),ee=He(),V=gt(ee),_=Ts(),w=Rl({clientThreadId:t}),{isOpen:h,onClose:ce}=vl({type:"just-hit-rate-limit"}),P=c.useMemo(()=>w?!1:!v&&Z,[v,Z,w]),H=w,K=$r(t),a=je(t,G.hasRecentPIMWarning),I=qr(K).data,ae=Qr(),fe=a?"pimBlock":I?.gizmo.tags?.includes(lt.WorkspaceDisabled)&&!ae?"workspaceDisallowsGizmo":b?.models.size===0?"noModelsAvailable":te?.kind===Ye.GizmoTest&&te.gizmo_id==null?"noTestGizmoId":null,be=ga(),ge=to(),N=be.action==="moderate",L=xe(ee,"1860647109");return e.jsxs(e.Fragment,{children:[e.jsx(_l,{composerController:_,clientThreadId:t,currentModelId:o,isCompletionInProgress:w}),e.jsx("div",{className:"flex justify-center empty:hidden",children:ge&&N&&L?e.jsx(wl,{}):null}),h?e.jsx(El,{onClose:ce}):null,e.jsx(_u,{clientThreadId:t,disableDraftPersistence:l,onCreateNewCompletion:r,onContinueGenerating:f,currentModelId:o,account:V,currentModelConfig:Jr(b?.models,o),areModelsLoading:M,isNewThread:u,isCompletionInProgress:w,className:"w-full",canContinue:P,disabled:!!fe,disabledReason:fe??void 0,canPause:H,isInteractableSharedThread:ne||oe,onAutocompleteSelect:g,headerClassName:n,hideHeader:i,onlyAllowImageUploads:p,layoutMode:y,modelsData:b},t)]})}export{Bu as P,Wu as T};
//# sourceMappingURL=o9aygkglauyctw2w.js.map
